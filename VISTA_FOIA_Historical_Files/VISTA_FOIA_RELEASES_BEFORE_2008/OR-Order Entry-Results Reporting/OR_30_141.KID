KIDS Distribution saved on Nov 14, 2002@15:55:29
OR_30_141V21 11/14/2002 1554MT
**KIDS**:OR*3.0*141^

**INSTALL NAME**
OR*3.0*141
"BLD",15287,0)
OR*3.0*141^ORDER ENTRY/RESULTS REPORTING^0^3021114^y
"BLD",15287,4,0)
^9.64PA^8989.51^6
"BLD",15287,4,100,0)
100
"BLD",15287,4,100,2,0)
^9.641^100^1
"BLD",15287,4,100,2,100,0)
ORDER  (File-top level)
"BLD",15287,4,100,2,100,1,0)
^9.6411^.02^3
"BLD",15287,4,100,2,100,1,.02,0)
OBJECT OF ORDER
"BLD",15287,4,100,2,100,1,15,0)
EVENT
"BLD",15287,4,100,2,100,1,68,0)
DC EVENT
"BLD",15287,4,100,222)
y^n^p^^^^n
"BLD",15287,4,100.2,0)
100.2
"BLD",15287,4,100.2,222)
y^y^f^^^^n
"BLD",15287,4,100.5,0)
100.5
"BLD",15287,4,100.5,2,0)
^9.641^100.51^2
"BLD",15287,4,100.5,2,100.5,0)
OE/RR RELEASE EVENTS  (File-top level)
"BLD",15287,4,100.5,2,100.5,1,0)
^9.6411^14^3
"BLD",15287,4,100.5,2,100.5,1,1,0)
INACTIVATED
"BLD",15287,4,100.5,2,100.5,1,8,0)
DISPLAY TEXT
"BLD",15287,4,100.5,2,100.5,1,14,0)
PARENT
"BLD",15287,4,100.5,2,100.51,0)
INCLUDED TREATING SPECIALTIES  (sub-file)
"BLD",15287,4,100.5,2,100.51,1,0)
^9.6411^1^1
"BLD",15287,4,100.5,2,100.51,1,1,0)
DEFAULT
"BLD",15287,4,100.5,222)
y^n^p^^^^n
"BLD",15287,4,101.41,0)
101.41
"BLD",15287,4,101.41,222)
n^n^f^^y^^y^r^n
"BLD",15287,4,101.41,224)
I $$DLGSEND^ORY141ED($P(^(0),U))
"BLD",15287,4,8989.51,0)
8989.51
"BLD",15287,4,8989.51,222)
n^y^f^^y^^y^r^n
"BLD",15287,4,8989.51,224)
I Y=200!(Y=4753)!(Y=4754)!(Y=4755)!(Y=4758)!(Y=4759)
"BLD",15287,4,8989.52,0)
8989.52
"BLD",15287,4,8989.52,222)
n^n^f^^y^^y^r^n
"BLD",15287,4,8989.52,224)
I $P(^(0),U)="ORP ORDER MISC"
"BLD",15287,4,"APDD",100,100)

"BLD",15287,4,"APDD",100,100,.02)

"BLD",15287,4,"APDD",100,100,15)

"BLD",15287,4,"APDD",100,100,68)

"BLD",15287,4,"APDD",100.5,100.5)

"BLD",15287,4,"APDD",100.5,100.5,1)

"BLD",15287,4,"APDD",100.5,100.5,8)

"BLD",15287,4,"APDD",100.5,100.5,14)

"BLD",15287,4,"APDD",100.5,100.51)

"BLD",15287,4,"APDD",100.5,100.51,1)

"BLD",15287,4,"B",100,100)

"BLD",15287,4,"B",100.2,100.2)

"BLD",15287,4,"B",100.5,100.5)

"BLD",15287,4,"B",101.41,101.41)

"BLD",15287,4,"B",8989.51,8989.51)

"BLD",15287,4,"B",8989.52,8989.52)

"BLD",15287,"ABPKG")
n
"BLD",15287,"INI")
PRE^ORY141
"BLD",15287,"INID")
^n^n
"BLD",15287,"INIT")
POST^ORY141
"BLD",15287,"KRN",0)
^9.67PA^19^17
"BLD",15287,"KRN",.4,0)
.4
"BLD",15287,"KRN",.4,"NM",0)
^9.68A^^
"BLD",15287,"KRN",.401,0)
.401
"BLD",15287,"KRN",.402,0)
.402
"BLD",15287,"KRN",.402,"NM",0)
^9.68A^3^3
"BLD",15287,"KRN",.402,"NM",1,0)
OREV CHILD EVENT    FILE #100.5^100.5^0
"BLD",15287,"KRN",.402,"NM",2,0)
OREV EVENT    FILE #100.5^100.5^0
"BLD",15287,"KRN",.402,"NM",3,0)
OREV AUTO DC    FILE #100.6^100.6^0
"BLD",15287,"KRN",.402,"NM","B","OREV AUTO DC    FILE #100.6",3)

"BLD",15287,"KRN",.402,"NM","B","OREV CHILD EVENT    FILE #100.5",1)

"BLD",15287,"KRN",.402,"NM","B","OREV EVENT    FILE #100.5",2)

"BLD",15287,"KRN",.403,0)
.403
"BLD",15287,"KRN",.5,0)
.5
"BLD",15287,"KRN",.84,0)
.84
"BLD",15287,"KRN",3.6,0)
3.6
"BLD",15287,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",15287,"KRN",3.8,0)
3.8
"BLD",15287,"KRN",9.2,0)
9.2
"BLD",15287,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",15287,"KRN",9.8,0)
9.8
"BLD",15287,"KRN",9.8,"NM",0)
^9.68A^93^83
"BLD",15287,"KRN",9.8,"NM",1,0)
ORCACT^^0^B16893781
"BLD",15287,"KRN",9.8,"NM",2,0)
ORCACT0^^0^B42124576
"BLD",15287,"KRN",9.8,"NM",3,0)
ORCACT2^^0^B53543972
"BLD",15287,"KRN",9.8,"NM",4,0)
ORCACT3^^0^B6858691
"BLD",15287,"KRN",9.8,"NM",5,0)
ORCACT4^^0^B38256140
"BLD",15287,"KRN",9.8,"NM",6,0)
ORCD^^0^B49775980
"BLD",15287,"KRN",9.8,"NM",7,0)
ORCDFH^^0^B49069461
"BLD",15287,"KRN",9.8,"NM",8,0)
ORCDFHTF^^0^B16786096
"BLD",15287,"KRN",9.8,"NM",9,0)
ORCDLG^^0^B72292989
"BLD",15287,"KRN",9.8,"NM",10,0)
ORCDLR1^^0^B80731782
"BLD",15287,"KRN",9.8,"NM",11,0)
ORCDPS1^^0^B67515562
"BLD",15287,"KRN",9.8,"NM",12,0)
ORCDRA^^0^B30425287
"BLD",15287,"KRN",9.8,"NM",13,0)
ORCDRA1^^0^B9865804
"BLD",15287,"KRN",9.8,"NM",14,0)
ORCHANG2^^0^B26765487
"BLD",15287,"KRN",9.8,"NM",15,0)
ORCHANG3^^0^B6280279
"BLD",15287,"KRN",9.8,"NM",16,0)
ORCHANGE^^0^B40408625
"BLD",15287,"KRN",9.8,"NM",17,0)
ORCHART^^0^B70975123
"BLD",15287,"KRN",9.8,"NM",18,0)
ORCHECK^^0^B38547153
"BLD",15287,"KRN",9.8,"NM",19,0)
ORCHTAB1^^0^B65235851
"BLD",15287,"KRN",9.8,"NM",20,0)
ORCHTAB3^^0^B43924925
"BLD",15287,"KRN",9.8,"NM",21,0)
ORCMED^^0^B37573595
"BLD",15287,"KRN",9.8,"NM",22,0)
ORCMENU^^0^B39400354
"BLD",15287,"KRN",9.8,"NM",23,0)
ORCSAVE^^0^B54674269
"BLD",15287,"KRN",9.8,"NM",24,0)
ORCSEND^^0^B55503809
"BLD",15287,"KRN",9.8,"NM",25,0)
ORCXPND2^^0^B58372818
"BLD",15287,"KRN",9.8,"NM",26,0)
OREVNT^^0^B71307159
"BLD",15287,"KRN",9.8,"NM",27,0)
OREVNT1^^0^B43493020
"BLD",15287,"KRN",9.8,"NM",28,0)
OREVNTX^^0^B72274467
"BLD",15287,"KRN",9.8,"NM",29,0)
OREVNTX1^^0^B75426379
"BLD",15287,"KRN",9.8,"NM",30,0)
ORMEVNT^^0^B66893320
"BLD",15287,"KRN",9.8,"NM",31,0)
ORMEVNT1^^0^B47568929
"BLD",15287,"KRN",9.8,"NM",32,0)
ORQ1^^0^B9817671
"BLD",15287,"KRN",9.8,"NM",33,0)
ORQ11^^0^B56849675
"BLD",15287,"KRN",9.8,"NM",34,0)
ORQ13^^0^B7872245
"BLD",15287,"KRN",9.8,"NM",35,0)
ORQ2^^0^B34261575
"BLD",15287,"KRN",9.8,"NM",36,0)
ORQ20^^0^B44143849
"BLD",15287,"KRN",9.8,"NM",38,0)
ORWOR^^0^B29680452
"BLD",15287,"KRN",9.8,"NM",39,0)
ORX8^^0^B12860545
"BLD",15287,"KRN",9.8,"NM",40,0)
ORMORG^^0^B5388826
"BLD",15287,"KRN",9.8,"NM",41,0)
ORWDX^^0^B71500323
"BLD",15287,"KRN",9.8,"NM",43,0)
ORWDXM1^^0^B68134137
"BLD",15287,"KRN",9.8,"NM",44,0)
ORWORDG^^0^B3668340
"BLD",15287,"KRN",9.8,"NM",45,0)
ORWORR^^0^B56781073
"BLD",15287,"KRN",9.8,"NM",46,0)
ORYDLG^^0^B8247584
"BLD",15287,"KRN",9.8,"NM",47,0)
ORWDFH^^0^B31281164
"BLD",15287,"KRN",9.8,"NM",48,0)
ORY141ED^^0^B73105019
"BLD",15287,"KRN",9.8,"NM",52,0)
ORWCIRN^^0^B3842701
"BLD",15287,"KRN",9.8,"NM",53,0)
ORWOR2^^0^B36026297
"BLD",15287,"KRN",9.8,"NM",56,0)
ORY141^^0^B6122701
"BLD",15287,"KRN",9.8,"NM",57,0)
ORWDXR^^0^B18777992
"BLD",15287,"KRN",9.8,"NM",58,0)
ORCACT01^^0^B53565570
"BLD",15287,"KRN",9.8,"NM",59,0)
ORCSAVE1^^0^B27554529
"BLD",15287,"KRN",9.8,"NM",60,0)
ORWDPS2^^0^B58189610
"BLD",15287,"KRN",9.8,"NM",61,0)
ORWRA^^0^B7700527
"BLD",15287,"KRN",9.8,"NM",62,0)
ORECS01^^0^B887894
"BLD",15287,"KRN",9.8,"NM",65,0)
ORWDXM3^^0^B26993740
"BLD",15287,"KRN",9.8,"NM",66,0)
ORMPS^^0^B65024731
"BLD",15287,"KRN",9.8,"NM",68,0)
ORWDXA^^0^B56623345
"BLD",15287,"KRN",9.8,"NM",69,0)
ORWTPD^^0^B12593329
"BLD",15287,"KRN",9.8,"NM",70,0)
ORWDRA32^^0^B19101663
"BLD",15287,"KRN",9.8,"NM",71,0)
ORCACT02^^0^B9304192
"BLD",15287,"KRN",9.8,"NM",72,0)
ORWDLR32^^0^B49348139
"BLD",15287,"KRN",9.8,"NM",73,0)
ORWDLR33^^0^B16060018
"BLD",15287,"KRN",9.8,"NM",74,0)
ORCFLAG^^0^B21828604
"BLD",15287,"KRN",9.8,"NM",75,0)
ORY141EC^^0^B6295445
"BLD",15287,"KRN",9.8,"NM",76,0)
ORWDPS1^^0^B20839496
"BLD",15287,"KRN",9.8,"NM",77,0)
ORWPS^^0^B15790542
"BLD",15287,"KRN",9.8,"NM",78,0)
ORQ21^^0^B18693448
"BLD",15287,"KRN",9.8,"NM",79,0)
ORWDPS4^^0^B9779474
"BLD",15287,"KRN",9.8,"NM",80,0)
OREV^^0^B79805634
"BLD",15287,"KRN",9.8,"NM",81,0)
OREV2^^0^B75420310
"BLD",15287,"KRN",9.8,"NM",82,0)
ORWDXC^^0^B20447328
"BLD",15287,"KRN",9.8,"NM",83,0)
ORKPS^^0^B68668942
"BLD",15287,"KRN",9.8,"NM",84,0)
ORWOR1^^0^B14074512
"BLD",15287,"KRN",9.8,"NM",85,0)
ORMBLDPS^^0^B46124521
"BLD",15287,"KRN",9.8,"NM",86,0)
ORDV02^^0^B68179336
"BLD",15287,"KRN",9.8,"NM",87,0)
ORPR07^^0^B54102863
"BLD",15287,"KRN",9.8,"NM",88,0)
ORWORR1^^0^B4670764
"BLD",15287,"KRN",9.8,"NM",89,0)
ORM^^0^B17067461
"BLD",15287,"KRN",9.8,"NM",90,0)
OREV3^^0^B85742054
"BLD",15287,"KRN",9.8,"NM",91,0)
OREV1^^0^B80113784
"BLD",15287,"KRN",9.8,"NM",92,0)
OREV4^^0^B23656896
"BLD",15287,"KRN",9.8,"NM",93,0)
ORCDADT^^0^B1694697
"BLD",15287,"KRN",9.8,"NM","B","ORCACT",1)

"BLD",15287,"KRN",9.8,"NM","B","ORCACT0",2)

"BLD",15287,"KRN",9.8,"NM","B","ORCACT01",58)

"BLD",15287,"KRN",9.8,"NM","B","ORCACT02",71)

"BLD",15287,"KRN",9.8,"NM","B","ORCACT2",3)

"BLD",15287,"KRN",9.8,"NM","B","ORCACT3",4)

"BLD",15287,"KRN",9.8,"NM","B","ORCACT4",5)

"BLD",15287,"KRN",9.8,"NM","B","ORCD",6)

"BLD",15287,"KRN",9.8,"NM","B","ORCDADT",93)

"BLD",15287,"KRN",9.8,"NM","B","ORCDFH",7)

"BLD",15287,"KRN",9.8,"NM","B","ORCDFHTF",8)

"BLD",15287,"KRN",9.8,"NM","B","ORCDLG",9)

"BLD",15287,"KRN",9.8,"NM","B","ORCDLR1",10)

"BLD",15287,"KRN",9.8,"NM","B","ORCDPS1",11)

"BLD",15287,"KRN",9.8,"NM","B","ORCDRA",12)

"BLD",15287,"KRN",9.8,"NM","B","ORCDRA1",13)

"BLD",15287,"KRN",9.8,"NM","B","ORCFLAG",74)

"BLD",15287,"KRN",9.8,"NM","B","ORCHANG2",14)

"BLD",15287,"KRN",9.8,"NM","B","ORCHANG3",15)

"BLD",15287,"KRN",9.8,"NM","B","ORCHANGE",16)

"BLD",15287,"KRN",9.8,"NM","B","ORCHART",17)

"BLD",15287,"KRN",9.8,"NM","B","ORCHECK",18)

"BLD",15287,"KRN",9.8,"NM","B","ORCHTAB1",19)

"BLD",15287,"KRN",9.8,"NM","B","ORCHTAB3",20)

"BLD",15287,"KRN",9.8,"NM","B","ORCMED",21)

"BLD",15287,"KRN",9.8,"NM","B","ORCMENU",22)

"BLD",15287,"KRN",9.8,"NM","B","ORCSAVE",23)

"BLD",15287,"KRN",9.8,"NM","B","ORCSAVE1",59)

"BLD",15287,"KRN",9.8,"NM","B","ORCSEND",24)

"BLD",15287,"KRN",9.8,"NM","B","ORCXPND2",25)

"BLD",15287,"KRN",9.8,"NM","B","ORDV02",86)

"BLD",15287,"KRN",9.8,"NM","B","ORECS01",62)

"BLD",15287,"KRN",9.8,"NM","B","OREV",80)

"BLD",15287,"KRN",9.8,"NM","B","OREV1",91)

"BLD",15287,"KRN",9.8,"NM","B","OREV2",81)

"BLD",15287,"KRN",9.8,"NM","B","OREV3",90)

"BLD",15287,"KRN",9.8,"NM","B","OREV4",92)

"BLD",15287,"KRN",9.8,"NM","B","OREVNT",26)

"BLD",15287,"KRN",9.8,"NM","B","OREVNT1",27)

"BLD",15287,"KRN",9.8,"NM","B","OREVNTX",28)

"BLD",15287,"KRN",9.8,"NM","B","OREVNTX1",29)

"BLD",15287,"KRN",9.8,"NM","B","ORKPS",83)

"BLD",15287,"KRN",9.8,"NM","B","ORM",89)

"BLD",15287,"KRN",9.8,"NM","B","ORMBLDPS",85)

"BLD",15287,"KRN",9.8,"NM","B","ORMEVNT",30)

"BLD",15287,"KRN",9.8,"NM","B","ORMEVNT1",31)

"BLD",15287,"KRN",9.8,"NM","B","ORMORG",40)

"BLD",15287,"KRN",9.8,"NM","B","ORMPS",66)

"BLD",15287,"KRN",9.8,"NM","B","ORPR07",87)

"BLD",15287,"KRN",9.8,"NM","B","ORQ1",32)

"BLD",15287,"KRN",9.8,"NM","B","ORQ11",33)

"BLD",15287,"KRN",9.8,"NM","B","ORQ13",34)

"BLD",15287,"KRN",9.8,"NM","B","ORQ2",35)

"BLD",15287,"KRN",9.8,"NM","B","ORQ20",36)

"BLD",15287,"KRN",9.8,"NM","B","ORQ21",78)

"BLD",15287,"KRN",9.8,"NM","B","ORWCIRN",52)

"BLD",15287,"KRN",9.8,"NM","B","ORWDFH",47)

"BLD",15287,"KRN",9.8,"NM","B","ORWDLR32",72)

"BLD",15287,"KRN",9.8,"NM","B","ORWDLR33",73)

"BLD",15287,"KRN",9.8,"NM","B","ORWDPS1",76)

"BLD",15287,"KRN",9.8,"NM","B","ORWDPS2",60)

"BLD",15287,"KRN",9.8,"NM","B","ORWDPS4",79)

"BLD",15287,"KRN",9.8,"NM","B","ORWDRA32",70)

"BLD",15287,"KRN",9.8,"NM","B","ORWDX",41)

"BLD",15287,"KRN",9.8,"NM","B","ORWDXA",68)

"BLD",15287,"KRN",9.8,"NM","B","ORWDXC",82)

"BLD",15287,"KRN",9.8,"NM","B","ORWDXM1",43)

"BLD",15287,"KRN",9.8,"NM","B","ORWDXM3",65)

"BLD",15287,"KRN",9.8,"NM","B","ORWDXR",57)

"BLD",15287,"KRN",9.8,"NM","B","ORWOR",38)

"BLD",15287,"KRN",9.8,"NM","B","ORWOR1",84)

"BLD",15287,"KRN",9.8,"NM","B","ORWOR2",53)

"BLD",15287,"KRN",9.8,"NM","B","ORWORDG",44)

"BLD",15287,"KRN",9.8,"NM","B","ORWORR",45)

"BLD",15287,"KRN",9.8,"NM","B","ORWORR1",88)

"BLD",15287,"KRN",9.8,"NM","B","ORWPS",77)

"BLD",15287,"KRN",9.8,"NM","B","ORWRA",61)

"BLD",15287,"KRN",9.8,"NM","B","ORWTPD",69)

"BLD",15287,"KRN",9.8,"NM","B","ORX8",39)

"BLD",15287,"KRN",9.8,"NM","B","ORY141",56)

"BLD",15287,"KRN",9.8,"NM","B","ORY141EC",75)

"BLD",15287,"KRN",9.8,"NM","B","ORY141ED",48)

"BLD",15287,"KRN",9.8,"NM","B","ORYDLG",46)

"BLD",15287,"KRN",19,0)
19
"BLD",15287,"KRN",19,"NM",0)
^9.68A^6^6
"BLD",15287,"KRN",19,"NM",1,0)
OR PARAM AUTODC^^1^
"BLD",15287,"KRN",19,"NM",2,0)
OR CPRS GUI CHART^^0
"BLD",15287,"KRN",19,"NM",3,0)
OR DELAYED ORDERS^^0
"BLD",15287,"KRN",19,"NM",4,0)
OR DELAYED ORDERS EDITOR^^0
"BLD",15287,"KRN",19,"NM",5,0)
OR PATIENT EVENT INQUIRY^^0
"BLD",15287,"KRN",19,"NM",6,0)
OR EVENT PARAMETERS^^0
"BLD",15287,"KRN",19,"NM","B","OR CPRS GUI CHART",2)

"BLD",15287,"KRN",19,"NM","B","OR DELAYED ORDERS",3)

"BLD",15287,"KRN",19,"NM","B","OR DELAYED ORDERS EDITOR",4)

"BLD",15287,"KRN",19,"NM","B","OR EVENT PARAMETERS",6)

"BLD",15287,"KRN",19,"NM","B","OR PARAM AUTODC",1)

"BLD",15287,"KRN",19,"NM","B","OR PATIENT EVENT INQUIRY",5)

"BLD",15287,"KRN",19.1,0)
19.1
"BLD",15287,"KRN",101,0)
101
"BLD",15287,"KRN",101,"NM",0)
^9.68A^46^46
"BLD",15287,"KRN",101,"NM",1,0)
ORC DELAYED ORDERS^^0
"BLD",15287,"KRN",101,"NM",2,0)
ORC RELEASE ORDERS^^0
"BLD",15287,"KRN",101,"NM",3,0)
ORC DELAY EVENT^^0
"BLD",15287,"KRN",101,"NM",4,0)
ORC ADD INPT MED^^0
"BLD",15287,"KRN",101,"NM",5,0)
ORC ADD OUTPT MED^^0
"BLD",15287,"KRN",101,"NM",6,0)
ORC ADD IV MED^^0
"BLD",15287,"KRN",101,"NM",7,0)
ORCHANGE EVENT^^0
"BLD",15287,"KRN",101,"NM",8,0)
ORU PATIENT MOVMT^^0
"BLD",15287,"KRN",101,"NM",9,0)
ORB BLANK LINE^^4^
"BLD",15287,"KRN",101,"NM",10,0)
ORCHANGE ORDERS SHORT^^2
"BLD",15287,"KRN",101,"NM",11,0)
ORCHANGE ORDERS LONG^^2
"BLD",15287,"KRN",101,"NM",12,0)
ORC ORES ORDER ACTIONS^^0
"BLD",15287,"KRN",101,"NM",13,0)
ORC ORELSE ORDER ACTIONS^^0
"BLD",15287,"KRN",101,"NM",14,0)
ORC DELAYED ORDER ACTIONS^^0
"BLD",15287,"KRN",101,"NM",15,0)
ORC ALERT RESULTS^^4^
"BLD",15287,"KRN",101,"NM",16,0)
ORC CHANGE ORDERS^^4^
"BLD",15287,"KRN",101,"NM",17,0)
ORC COMPLETE ORDERS^^4^
"BLD",15287,"KRN",101,"NM",18,0)
ORC DETAILED DISPLAY^^4^
"BLD",15287,"KRN",101,"NM",19,0)
ORC DISCONTINUE ORDERS^^4^
"BLD",15287,"KRN",101,"NM",20,0)
ORC FLAG ORDERS^^4^
"BLD",15287,"KRN",101,"NM",21,0)
ORC HOLD ORDERS^^4^
"BLD",15287,"KRN",101,"NM",22,0)
ORC PRINT ORDERS^^4^
"BLD",15287,"KRN",101,"NM",23,0)
ORC RENEW ORDERS^^4^
"BLD",15287,"KRN",101,"NM",24,0)
ORC SIGN ORDERS^^4^
"BLD",15287,"KRN",101,"NM",25,0)
ORC UNFLAG ORDERS^^4^
"BLD",15287,"KRN",101,"NM",26,0)
ORC UNHOLD ORDERS^^4^
"BLD",15287,"KRN",101,"NM",27,0)
ORC VERIFY MENU^^4^
"BLD",15287,"KRN",101,"NM",28,0)
ORC WARD COMMENTS^^4^
"BLD",15287,"KRN",101,"NM",29,0)
ORC DELAY ACTIONS^^0
"BLD",15287,"KRN",101,"NM",30,0)
ORC DELAY DC^^1^
"BLD",15287,"KRN",101,"NM",31,0)
ORC DELAY EDIT TS^^1^
"BLD",15287,"KRN",101,"NM",32,0)
ORC DELAY RELEASE^^1^
"BLD",15287,"KRN",101,"NM",33,0)
ORC REWRITE ORDERS^^4^
"BLD",15287,"KRN",101,"NM",34,0)
ORC RESULTS DISPLAY^^4^
"BLD",15287,"KRN",101,"NM",35,0)
OREV CHANGE DISPLAY^^0
"BLD",15287,"KRN",101,"NM",36,0)
OREV DETAILED MENU^^0
"BLD",15287,"KRN",101,"NM",37,0)
OREV EDIT EVENT DELAY PARAMS^^0
"BLD",15287,"KRN",101,"NM",38,0)
OREV ENTER/EDIT AUTO DC MENU^^0
"BLD",15287,"KRN",101,"NM",39,0)
OREV ENTER/EDIT ENTRIES^^0
"BLD",15287,"KRN",101,"NM",40,0)
OREV ENTER/EDIT ENTRIES IN DETAIL^^0
"BLD",15287,"KRN",101,"NM",41,0)
OREV ENTER/EDIT EVENTS MENU^^0
"BLD",15287,"KRN",101,"NM",42,0)
OREV INCLUDE HISTORIES^^0
"BLD",15287,"KRN",101,"NM",43,0)
OREV MAIN DETAILED DISPLAY^^0
"BLD",15287,"KRN",101,"NM",44,0)
OREV SWITCH^^0
"BLD",15287,"KRN",101,"NM",45,0)
OREV SWITCH IN DETAIL^^0
"BLD",15287,"KRN",101,"NM",46,0)
OREV ADD CHILD^^0
"BLD",15287,"KRN",101,"NM","B","ORB BLANK LINE",9)

"BLD",15287,"KRN",101,"NM","B","ORC ADD INPT MED",4)

"BLD",15287,"KRN",101,"NM","B","ORC ADD IV MED",6)

"BLD",15287,"KRN",101,"NM","B","ORC ADD OUTPT MED",5)

"BLD",15287,"KRN",101,"NM","B","ORC ALERT RESULTS",15)

"BLD",15287,"KRN",101,"NM","B","ORC CHANGE ORDERS",16)

"BLD",15287,"KRN",101,"NM","B","ORC COMPLETE ORDERS",17)

"BLD",15287,"KRN",101,"NM","B","ORC DELAY ACTIONS",29)

"BLD",15287,"KRN",101,"NM","B","ORC DELAY DC",30)

"BLD",15287,"KRN",101,"NM","B","ORC DELAY EDIT TS",31)

"BLD",15287,"KRN",101,"NM","B","ORC DELAY EVENT",3)

"BLD",15287,"KRN",101,"NM","B","ORC DELAY RELEASE",32)

"BLD",15287,"KRN",101,"NM","B","ORC DELAYED ORDER ACTIONS",14)

"BLD",15287,"KRN",101,"NM","B","ORC DELAYED ORDERS",1)

"BLD",15287,"KRN",101,"NM","B","ORC DETAILED DISPLAY",18)

"BLD",15287,"KRN",101,"NM","B","ORC DISCONTINUE ORDERS",19)

"BLD",15287,"KRN",101,"NM","B","ORC FLAG ORDERS",20)

"BLD",15287,"KRN",101,"NM","B","ORC HOLD ORDERS",21)

"BLD",15287,"KRN",101,"NM","B","ORC ORELSE ORDER ACTIONS",13)

"BLD",15287,"KRN",101,"NM","B","ORC ORES ORDER ACTIONS",12)

"BLD",15287,"KRN",101,"NM","B","ORC PRINT ORDERS",22)

"BLD",15287,"KRN",101,"NM","B","ORC RELEASE ORDERS",2)

"BLD",15287,"KRN",101,"NM","B","ORC RENEW ORDERS",23)

"BLD",15287,"KRN",101,"NM","B","ORC RESULTS DISPLAY",34)

"BLD",15287,"KRN",101,"NM","B","ORC REWRITE ORDERS",33)

"BLD",15287,"KRN",101,"NM","B","ORC SIGN ORDERS",24)

"BLD",15287,"KRN",101,"NM","B","ORC UNFLAG ORDERS",25)

"BLD",15287,"KRN",101,"NM","B","ORC UNHOLD ORDERS",26)

"BLD",15287,"KRN",101,"NM","B","ORC VERIFY MENU",27)

"BLD",15287,"KRN",101,"NM","B","ORC WARD COMMENTS",28)

"BLD",15287,"KRN",101,"NM","B","ORCHANGE EVENT",7)

"BLD",15287,"KRN",101,"NM","B","ORCHANGE ORDERS LONG",11)

"BLD",15287,"KRN",101,"NM","B","ORCHANGE ORDERS SHORT",10)

"BLD",15287,"KRN",101,"NM","B","OREV ADD CHILD",46)

"BLD",15287,"KRN",101,"NM","B","OREV CHANGE DISPLAY",35)

"BLD",15287,"KRN",101,"NM","B","OREV DETAILED MENU",36)

"BLD",15287,"KRN",101,"NM","B","OREV EDIT EVENT DELAY PARAMS",37)

"BLD",15287,"KRN",101,"NM","B","OREV ENTER/EDIT AUTO DC MENU",38)

"BLD",15287,"KRN",101,"NM","B","OREV ENTER/EDIT ENTRIES",39)

"BLD",15287,"KRN",101,"NM","B","OREV ENTER/EDIT ENTRIES IN DETAIL",40)

"BLD",15287,"KRN",101,"NM","B","OREV ENTER/EDIT EVENTS MENU",41)

"BLD",15287,"KRN",101,"NM","B","OREV INCLUDE HISTORIES",42)

"BLD",15287,"KRN",101,"NM","B","OREV MAIN DETAILED DISPLAY",43)

"BLD",15287,"KRN",101,"NM","B","OREV SWITCH",44)

"BLD",15287,"KRN",101,"NM","B","OREV SWITCH IN DETAIL",45)

"BLD",15287,"KRN",101,"NM","B","ORU PATIENT MOVMT",8)

"BLD",15287,"KRN",409.61,0)
409.61
"BLD",15287,"KRN",409.61,"NM",0)
^9.68A^5^5
"BLD",15287,"KRN",409.61,"NM",1,0)
OR DELAYED ORDERS^^0
"BLD",15287,"KRN",409.61,"NM",2,0)
OR CHART^^0
"BLD",15287,"KRN",409.61,"NM",3,0)
OREV AUTO-DC ACTIONS^^0
"BLD",15287,"KRN",409.61,"NM",4,0)
OREV EVENT ACTIONS^^0
"BLD",15287,"KRN",409.61,"NM",5,0)
OREV DETAILED DISPLAY^^0
"BLD",15287,"KRN",409.61,"NM","B","OR CHART",2)

"BLD",15287,"KRN",409.61,"NM","B","OR DELAYED ORDERS",1)

"BLD",15287,"KRN",409.61,"NM","B","OREV AUTO-DC ACTIONS",3)

"BLD",15287,"KRN",409.61,"NM","B","OREV DETAILED DISPLAY",5)

"BLD",15287,"KRN",409.61,"NM","B","OREV EVENT ACTIONS",4)

"BLD",15287,"KRN",771,0)
771
"BLD",15287,"KRN",870,0)
870
"BLD",15287,"KRN",8994,0)
8994
"BLD",15287,"KRN",8994,"NM",0)
^9.68A^59^59
"BLD",15287,"KRN",8994,"NM",1,0)
ORQOR DETAIL^^0
"BLD",15287,"KRN",8994,"NM",2,0)
OREVNTX PAT^^0
"BLD",15287,"KRN",8994,"NM",3,0)
OREVNTX ACTIVE^^0
"BLD",15287,"KRN",8994,"NM",4,0)
OREVNTX1 PUTEVNT^^0
"BLD",15287,"KRN",8994,"NM",5,0)
OREVNTX1 GTEVT^^0
"BLD",15287,"KRN",8994,"NM",6,0)
OREVNTX1 GTEVT1^^0
"BLD",15287,"KRN",8994,"NM",7,0)
OREVNTX1 WRLSTED^^0
"BLD",15287,"KRN",8994,"NM",8,0)
OREVNTX1 EVT^^0
"BLD",15287,"KRN",8994,"NM",9,0)
OREVNTX1 EXISTS^^0
"BLD",15287,"KRN",8994,"NM",10,0)
OREVNTX1 NAME^^0
"BLD",15287,"KRN",8994,"NM",11,0)
OREVNTX1 MATCH^^0
"BLD",15287,"KRN",8994,"NM",12,0)
OREVNTX1 EMPTY^^0
"BLD",15287,"KRN",8994,"NM",13,0)
OREVNTX1 DELPTEVT^^0
"BLD",15287,"KRN",8994,"NM",14,0)
OREVNTX1 DFLTEVT^^0
"BLD",15287,"KRN",8994,"NM",15,0)
OREVNTX1 DIV^^0
"BLD",15287,"KRN",8994,"NM",16,0)
OREVNTX1 DIV1^^0
"BLD",15287,"KRN",8994,"NM",17,0)
OREVNTX1 LOC^^0
"BLD",15287,"KRN",8994,"NM",18,0)
OREVNTX1 LOC1^^0
"BLD",15287,"KRN",8994,"NM",19,0)
OREVNTX1 CHGEVT^^0
"BLD",15287,"KRN",8994,"NM",20,0)
OREVNTX1 GETDLG^^0
"BLD",15287,"KRN",8994,"NM",21,0)
OREVNTX1 CURSPE^^0
"BLD",15287,"KRN",8994,"NM",22,0)
OREVNTX1 DONE^^0
"BLD",15287,"KRN",8994,"NM",23,0)
ORWDX SENDED^^0
"BLD",15287,"KRN",8994,"NM",24,0)
OREVNTX1 CPACT^^0
"BLD",15287,"KRN",8994,"NM",25,0)
OREVNTX1 PRMPTID^^0
"BLD",15287,"KRN",8994,"NM",26,0)
OREVNTX LIST^^0
"BLD",15287,"KRN",8994,"NM",27,0)
OREVNTX1 ISDCOD^^0
"BLD",15287,"KRN",8994,"NM",28,0)
OREVNTX1 SETDFLT^^0
"BLD",15287,"KRN",8994,"NM",29,0)
ORECS01 CHKESSO^^0
"BLD",15287,"KRN",8994,"NM",30,0)
ORECS01 VSITID^^0
"BLD",15287,"KRN",8994,"NM",31,0)
ORECS01 ECRPT^^0
"BLD",15287,"KRN",8994,"NM",32,0)
ORECS01 ECPRINT^^0
"BLD",15287,"KRN",8994,"NM",33,0)
ORWOR PKIUSE^^0
"BLD",15287,"KRN",8994,"NM",34,0)
ORWOR1 CHKDIG^^0
"BLD",15287,"KRN",8994,"NM",35,0)
ORWOR1 GETDSIG^^0
"BLD",15287,"KRN",8994,"NM",36,0)
ORWOR1 GETDTEXT^^0
"BLD",15287,"KRN",8994,"NM",37,0)
ORWOR1 SIG^^0
"BLD",15287,"KRN",8994,"NM",38,0)
ORWDPS1 HASOIPI^^0
"BLD",15287,"KRN",8994,"NM",39,0)
OREVNTX1 DEFLTS^^0
"BLD",15287,"KRN",8994,"NM",40,0)
OREVNTX1 MULTS^^0
"BLD",15287,"KRN",8994,"NM",41,0)
ORWOR RESULT HISTORY^^0
"BLD",15287,"KRN",8994,"NM",42,0)
OREVNTX1 PROMPT IDS^^0
"BLD",15287,"KRN",8994,"NM",43,0)
ORWCIRN CHECKLINK^^0
"BLD",15287,"KRN",8994,"NM",44,0)
ORWDPS1 HASROUTE^^0
"BLD",15287,"KRN",8994,"NM",45,0)
OREVNTX1 DELDFLT^^0
"BLD",15287,"KRN",8994,"NM",46,0)
OREVNTX1 DFLTDLG^^0
"BLD",15287,"KRN",8994,"NM",47,0)
ORECS01 GETDIV^^0
"BLD",15287,"KRN",8994,"NM",48,0)
OREVNTX1 TYPEXT^^0
"BLD",15287,"KRN",8994,"NM",49,0)
ORWORR RGET^^0
"BLD",15287,"KRN",8994,"NM",50,0)
OREVNTX1 AUTHMREL^^0
"BLD",15287,"KRN",8994,"NM",51,0)
OREVNTX1 HAVEPRT^^0
"BLD",15287,"KRN",8994,"NM",52,0)
OREVNTX1 CMEVTS^^0
"BLD",15287,"KRN",8994,"NM",53,0)
OREVNTX1 ODPTEVID^^0
"BLD",15287,"KRN",8994,"NM",54,0)
ORWOR PKISITE^^0
"BLD",15287,"KRN",8994,"NM",55,0)
OREVNTX1 ISHDORD^^0
"BLD",15287,"KRN",8994,"NM",56,0)
OREVNTX1 COMP^^0
"BLD",15287,"KRN",8994,"NM",57,0)
OREVNTX1 ISPASS^^0
"BLD",15287,"KRN",8994,"NM",58,0)
OREVNTX1 ISPASS1^^0
"BLD",15287,"KRN",8994,"NM",59,0)
OREVNTX1 DLGIEN^^0
"BLD",15287,"KRN",8994,"NM","B","ORECS01 CHKESSO",29)

"BLD",15287,"KRN",8994,"NM","B","ORECS01 ECPRINT",32)

"BLD",15287,"KRN",8994,"NM","B","ORECS01 ECRPT",31)

"BLD",15287,"KRN",8994,"NM","B","ORECS01 GETDIV",47)

"BLD",15287,"KRN",8994,"NM","B","ORECS01 VSITID",30)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX ACTIVE",3)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX LIST",26)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX PAT",2)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 AUTHMREL",50)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 CHGEVT",19)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 CMEVTS",52)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 COMP",56)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 CPACT",24)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 CURSPE",21)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DEFLTS",39)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DELDFLT",45)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DELPTEVT",13)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DFLTDLG",46)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DFLTEVT",14)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DIV",15)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DIV1",16)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DLGIEN",59)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 DONE",22)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 EMPTY",12)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 EVT",8)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 EXISTS",9)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 GETDLG",20)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 GTEVT",5)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 GTEVT1",6)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 HAVEPRT",51)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 ISDCOD",27)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 ISHDORD",55)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 ISPASS",57)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 ISPASS1",58)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 LOC",17)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 LOC1",18)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 MATCH",11)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 MULTS",40)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 NAME",10)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 ODPTEVID",53)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 PRMPTID",25)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 PROMPT IDS",42)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 PUTEVNT",4)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 SETDFLT",28)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 TYPEXT",48)

"BLD",15287,"KRN",8994,"NM","B","OREVNTX1 WRLSTED",7)

"BLD",15287,"KRN",8994,"NM","B","ORQOR DETAIL",1)

"BLD",15287,"KRN",8994,"NM","B","ORWCIRN CHECKLINK",43)

"BLD",15287,"KRN",8994,"NM","B","ORWDPS1 HASOIPI",38)

"BLD",15287,"KRN",8994,"NM","B","ORWDPS1 HASROUTE",44)

"BLD",15287,"KRN",8994,"NM","B","ORWDX SENDED",23)

"BLD",15287,"KRN",8994,"NM","B","ORWOR PKISITE",54)

"BLD",15287,"KRN",8994,"NM","B","ORWOR PKIUSE",33)

"BLD",15287,"KRN",8994,"NM","B","ORWOR RESULT HISTORY",41)

"BLD",15287,"KRN",8994,"NM","B","ORWOR1 CHKDIG",34)

"BLD",15287,"KRN",8994,"NM","B","ORWOR1 GETDSIG",35)

"BLD",15287,"KRN",8994,"NM","B","ORWOR1 GETDTEXT",36)

"BLD",15287,"KRN",8994,"NM","B","ORWOR1 SIG",37)

"BLD",15287,"KRN",8994,"NM","B","ORWORR RGET",49)

"BLD",15287,"KRN","B",.4,.4)

"BLD",15287,"KRN","B",.401,.401)

"BLD",15287,"KRN","B",.402,.402)

"BLD",15287,"KRN","B",.403,.403)

"BLD",15287,"KRN","B",.5,.5)

"BLD",15287,"KRN","B",.84,.84)

"BLD",15287,"KRN","B",3.6,3.6)

"BLD",15287,"KRN","B",3.8,3.8)

"BLD",15287,"KRN","B",9.2,9.2)

"BLD",15287,"KRN","B",9.8,9.8)

"BLD",15287,"KRN","B",19,19)

"BLD",15287,"KRN","B",19.1,19.1)

"BLD",15287,"KRN","B",101,101)

"BLD",15287,"KRN","B",409.61,409.61)

"BLD",15287,"KRN","B",771,771)

"BLD",15287,"KRN","B",870,870)

"BLD",15287,"KRN","B",8994,8994)

"BLD",15287,"QUES",0)
^9.62^^
"BLD",15287,"REQB",0)
^9.611^16^13
"BLD",15287,"REQB",2,0)
OR*3.0*134^2
"BLD",15287,"REQB",3,0)
OR*3.0*142^2
"BLD",15287,"REQB",5,0)
OR*3.0*94^2
"BLD",15287,"REQB",6,0)
TIU*1.0*124^2
"BLD",15287,"REQB",8,0)
OR*3.0*148^2
"BLD",15287,"REQB",9,0)
OR*3.0*123^2
"BLD",15287,"REQB",10,0)
OR*3.0*146^2
"BLD",15287,"REQB",11,0)
OR*3.0*139^2
"BLD",15287,"REQB",12,0)
OR*3.0*152^2
"BLD",15287,"REQB",13,0)
PSJ*5.0*86^2
"BLD",15287,"REQB",14,0)
SR*3.0*110^2
"BLD",15287,"REQB",15,0)
FH*5.0*37^2
"BLD",15287,"REQB",16,0)
OR*3.0*161^2
"BLD",15287,"REQB","B","FH*5.0*37",15)

"BLD",15287,"REQB","B","OR*3.0*123",9)

"BLD",15287,"REQB","B","OR*3.0*134",2)

"BLD",15287,"REQB","B","OR*3.0*139",11)

"BLD",15287,"REQB","B","OR*3.0*142",3)

"BLD",15287,"REQB","B","OR*3.0*146",10)

"BLD",15287,"REQB","B","OR*3.0*148",8)

"BLD",15287,"REQB","B","OR*3.0*152",12)

"BLD",15287,"REQB","B","OR*3.0*161",16)

"BLD",15287,"REQB","B","OR*3.0*94",5)

"BLD",15287,"REQB","B","PSJ*5.0*86",13)

"BLD",15287,"REQB","B","SR*3.0*110",14)

"BLD",15287,"REQB","B","TIU*1.0*124",6)

"DATA",101.41,1,0)
RA OERR EXAM^Imaging^^D^31^2^18^1^2
"DATA",101.41,1,3)
D EN^ORCDRA
"DATA",101.41,1,3.1)
D ENA^ORCDRA
"DATA",101.41,1,4)
D EX^ORCDRA
"DATA",101.41,1,5)
^^^Imaging^160
"DATA",101.41,1,10,0)
^101.412IA^15^15
"DATA",101.41,1,10,1,0)
1^4^^Procedure: ^^1^^^^S.XRAY;C.XRAY
"DATA",101.41,1,10,1,1)
Enter the imaging procedure to be ordered for this patient.^LKP;ORCDRA
"DATA",101.41,1,10,1,2)
1
"DATA",101.41,1,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT),'(ORBROAD&($P($G(^("RA")),U,2)="B"))
"DATA",101.41,1,10,1,5)
D BROAD^ORCDRA(+Y)
"DATA",101.41,1,10,1,6)
N SCR,IDX S SCR=ORDIALOG(PROMPT,"S"),IDX="S."_$P(ORDG,U,4) D XHELP^ORDD43(IDX,SCR),LIST^ORCDRA:$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,1,10,1,9)
D NEXTPROC^ORCDRA Q:$G(ORQUIT)  I '$G(ORDIALOG(PROMPT,INST)) D COMMON^ORCDRA,LIST^ORCDRA:$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,1,10,1,10)
N OI S OI=+$G(ORDIALOG(PROMPT,INST)) D:OI ORDMSG^ORCD(OI)
"DATA",101.41,1,10,1,"W")
cboProcedure^131^S.RAD
"DATA",101.41,1,10,2,0)
2^5^^Procedure Modifier: ^^0^1^^^^^^Procedure Modifiers: 
"DATA",101.41,1,10,2,1)
Select the procedure modifiers necessary to further define the procedure ordered.
"DATA",101.41,1,10,2,2)
2
"DATA",101.41,1,10,2,3)
I $D(^RAMIS(71.2,"AB",ORIMTYPE))
"DATA",101.41,1,10,2,5)
D CKPTYPE^ORCDRA1 Q:'$G(DONE)  I $$DUP^ORCD(PROMPT,ORI) K DONE W $C(7),!,"This procedure modifier has already been selected!",!
"DATA",101.41,1,10,2,"W")
lstSelectMod^^MOD
"DATA",101.41,1,10,3,0)
7^6^^Date Desired: ^^^^^W
"DATA",101.41,1,10,3,1)
Enter the date desired for this procedure to be performed.
"DATA",101.41,1,10,3,7)
S Y="TODAY"
"DATA",101.41,1,10,3,"W")
txtRequestDate
"DATA",101.41,1,10,3,"W7")
S Y="Today"
"DATA",101.41,1,10,4,0)
10^7^^^^^^1^^S.RA
"DATA",101.41,1,10,4,1)
Enter the urgency for this request.
"DATA",101.41,1,10,4,2)
3^^ROUTINE
"DATA",101.41,1,10,4,7)
S Y=9
"DATA",101.41,1,10,4,"W")
cboUrgency^^URG
"DATA",101.41,1,10,4,"W7")
S Y="Routine"
"DATA",101.41,1,10,5,0)
11^8^^Submit request to: ^^1
"DATA",101.41,1,10,5,1)
Enter the imaging location this request should be sent to.
"DATA",101.41,1,10,5,3)
I $$GET^XPAR("ALL^DIV.`"_$G(ORDIV),"RA SUBMIT PROMPT",1,"Q"),+$G(ORDIALOG(PROMPT,"LIST"))>1
"DATA",101.41,1,10,5,6)
D LIST^ORCD
"DATA",101.41,1,10,5,7)
S:+$G(ORDIALOG(PROMPT,"LIST"))=1 Y=+$G(ORDIALOG(PROMPT,"LIST",1))
"DATA",101.41,1,10,5,9)
I $G(ORIMLOC) M ORDIALOG(PROMPT,"LIST")=ORIMLOC
"DATA",101.41,1,10,5,"W")
cboSubmit^^SUB
"DATA",101.41,1,10,6,0)
8^9^^^^^^1
"DATA",101.41,1,10,6,1)
Enter the transportation mode of the patient for this exam.
"DATA",101.41,1,10,6,6)
D SETLIST^ORCD
"DATA",101.41,1,10,6,7)
S Y=$$MODE^ORCDRA1 K:'$L(Y) Y
"DATA",101.41,1,10,6,"W")
cboTransport^^TRANS
"DATA",101.41,1,10,7,0)
4^10^^^^^^1
"DATA",101.41,1,10,7,1)
Enter the category of the patient for this exam.
"DATA",101.41,1,10,7,5)
I $D(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) D CHNGCAT^ORCDRA1
"DATA",101.41,1,10,7,6)
D SETLIST^ORCD
"DATA",101.41,1,10,7,7)
S:$G(ORTYPE)'="Z" Y=$S($$INPT^ORCD:"I",1:"O")
"DATA",101.41,1,10,7,"W")
cboCategory^^CAT
"DATA",101.41,1,10,7,"W7")
S Y=$S($G(ORWARD):"Inpatient",1:"Outpatient")
"DATA",101.41,1,10,8,0)
4.2^11^^^^1
"DATA",101.41,1,10,8,1)
Enter the contract or sharing agreement responsible for this exam.
"DATA",101.41,1,10,8,3)
N X S X=$$VAL^ORCD("CATEGORY") I $L(X),"CS"[X
"DATA",101.41,1,10,8,"W")
^^SHARE
"DATA",101.41,1,10,8,"W3")
I "CS"[$$VAL^ORGGDRA("CATEGORY")
"DATA",101.41,1,10,9,0)
4.3^12^^^^1
"DATA",101.41,1,10,9,1)
Enter the name of the research project responsible for this exam.
"DATA",101.41,1,10,9,3)
I $$VAL^ORCD("CATEGORY")="R"
"DATA",101.41,1,10,9,"W")
^^SOURCE
"DATA",101.41,1,10,9,"W3")
I $$VAL^ORGGDRA("CATEGORY")="R"
"DATA",101.41,1,10,10,0)
5^13^^^^^^1
"DATA",101.41,1,10,10,1)
Enter the date/time this patient is scheduled for pre-op.
"DATA",101.41,1,10,10,3)
I $$SCHEDULD^ORCDRA1
"DATA",101.41,1,10,11,0)
6^14
"DATA",101.41,1,10,11,1)
Answer if this patient is pregnant at this time, as precisely as known.
"DATA",101.41,1,10,11,3)
I $G(ORSEX)="F",'FIRST!((ORAGE'<12)&(ORAGE'>55))
"DATA",101.41,1,10,11,6)
D SETLIST^ORCD
"DATA",101.41,1,10,11,7)
I $G(ORSEX)="F",((ORAGE<12)!(ORAGE>55)) S Y="N"
"DATA",101.41,1,10,11,9)
I $G(ORSEX)="F",$G(ORTYPE)'="Z" S REQD=1
"DATA",101.41,1,10,11,"W")
chkPregnant^^YN
"DATA",101.41,1,10,11,"W3")
I $G(ORSEX)="F"
"DATA",101.41,1,10,11,"W7")
S Y="No"
"DATA",101.41,1,10,12,0)
3^15^^History and Reason for Exam: ^^1
"DATA",101.41,1,10,12,1)
Enter the clinical history of this patient, as it relates to this order.
"DATA",101.41,1,10,12,5)
N ROOT S ROOT=$TR(ORDIALOG(PROMPT,INST),")",",") I '$$VALIDWP^ORCDRA1(ROOT) K DONE W $C(7),!!,"A valid clinical history is required!" S:$$DONE^ORCDLG2 ORQUIT=1
"DATA",101.41,1,10,12,7)
I $D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORWORD",$J,PROMPT,INST)=^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST) S Y="^TMP(""ORWORD"",$J,"_PROMPT_","_INST_")"
"DATA",101.41,1,10,12,"W")
memReason
"DATA",101.41,1,10,13,0)
9^177^^Is patient on isolation procedures? ^^^^^^^^^Isolation Procedures: 
"DATA",101.41,1,10,13,1)
Enter YES if this patient is currently on some type of isolation procedures.
"DATA",101.41,1,10,13,7)
S:$G(ORTYPE)'="Z" Y=$S($$IP^ORMBLD:1,1:0)
"DATA",101.41,1,10,14,0)
4.1^183^^Ordering Location: ^^1
"DATA",101.41,1,10,14,1)
Enter the ordering location for this exam.
"DATA",101.41,1,10,14,3)
N X S X=$$VAL^ORCD("CATEGORY") I "IO"[X,'$$MATCH^ORCDRA1(X)
"DATA",101.41,1,10,15,0)
12^17^^Approving Rad/Nuc Med Phys: ^^1^^^W
"DATA",101.41,1,10,15,1)
Enter the name of the approving imaging service physician; personnel must be classified as Interpreting Staff Physician.
"DATA",101.41,1,10,15,3)
N OI S OI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1)) I OI,$P($G(^ORD(101.43,OI,0)),U,7)=2
"DATA",101.41,1,10,15,4)
I $D(^VA(200,"ARC","S",+Y)),'$P($G(^VA(200,+Y,"RA")),U,3)!($P($G(^("RA")),U,3)>DT)
"DATA",101.41,1,99)
59060,54737
"DATA",101.41,2,0)
LR OTHER LAB TESTS^Laboratory^^D^5^2^6^1^2
"DATA",101.41,2,3)
D EN^ORCDLR1
"DATA",101.41,2,3.1)
D EN^ORCDLR1
"DATA",101.41,2,4)
D EX^ORCDLR1
"DATA",101.41,2,5)
^^^Lab Tests^120
"DATA",101.41,2,7)
I '$$VALID^ORCDLR1(ORIFN) S ORQUIT=1 W !!,"Order will not be signed/released." H 2
"DATA",101.41,2,9)
I '$$LB^ORCDLR(ORIFN),$G(^OR(100,ORIFN,4)) S Y="LB #"_$P(^(4),";")
"DATA",101.41,2,10,0)
^101.412IA^10^9
"DATA",101.41,2,10,1,0)
1^4^^Lab Test: ^^1^^^^S.LAB
"DATA",101.41,2,10,1,1)
Enter a lab test to be ordered for this patient.
"DATA",101.41,2,10,1,2)
1
"DATA",101.41,2,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)
"DATA",101.41,2,10,1,5)
I $G(ORESET),ORESET'=+Y D CHANGED^ORCDLR("OI") K ORTEST
"DATA",101.41,2,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,2,10,1,9)
K:FIRST ORTEST
"DATA",101.41,2,10,1,10)
D CKTYP^ORCDLR Q:$G(ORQUIT)  D TEST^ORCDLR ;Setup test parameters
"DATA",101.41,2,10,1,"W")
lstSelectTest
"DATA",101.41,2,10,3,0)
2^28^^Collected By: ^^1^^^C
"DATA",101.41,2,10,3,1)
Enter the method of collection for this sample.
"DATA",101.41,2,10,3,2)
6^1~1
"DATA",101.41,2,10,3,5)
D CKTYPE^ORCDLR1
"DATA",101.41,2,10,3,6)
D HELPTYPE^ORCDLR1
"DATA",101.41,2,10,3,7)
S Y=$$COLLTYPE^ORCDLR1 K:'$L(Y) Y
"DATA",101.41,2,10,3,10)
S ORCOLLCT=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,2,10,3,"W")
cboCollType
"DATA",101.41,2,10,4,0)
5^6^^Collection Date/Time: ^^1^^^W
"DATA",101.41,2,10,4,.1)
I ORCOLLCT="LC",X'?1.N,"AMNEXT"'[$$UP^XLFSTR(X),$L(X,".")'>1,$L(X,"@")'>1 S X=X_"@"_$S($$DATE^ORCDLR(X)=DT:$G(ORTIME("NEXT")),1:$G(ORTIME("AM")))
"DATA",101.41,2,10,4,1)
Enter the date/time the sample(s) should be collected.
"DATA",101.41,2,10,4,5)
I $G(ORESET)'=$P(Y,U) N OK S OK=$S(ORCOLLCT="LC":$$LABCOLL^ORCDLR1($P(Y,U)),ORCOLLCT="I":$$IMMCOLL^ORCDLR1($P(Y,U)),1:$$CKDATE^ORCDLR1($P(Y,U))) I 'OK W $C(7),!,$P(OK,U,2) K DONE
"DATA",101.41,2,10,4,6)
D FTDHELP^ORCD D:ORCOLLCT="LC" LISTCOLL^ORCDLR1,LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")) D:ORCOLLCT="I" IMMTIMES^ORCDLR1
"DATA",101.41,2,10,4,7)
I $G(ORTYPE)'="Z" S Y=$$DEFTIME^ORCDLR1 K:'$L(Y) Y
"DATA",101.41,2,10,4,9)
D COLLTIME^ORCDLR1 ;,LIST^ORCD:ORCOLLCT="LC"&$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,2,10,4,"W")
cboCollTime
"DATA",101.41,2,10,5,0)
8^29^^How often: ^^^^^^APLR
"DATA",101.41,2,10,5,1)
Enter an administration schedule for how often this test is to be done.
"DATA",101.41,2,10,5,2)
8^^ONE TIME
"DATA",101.41,2,10,5,3)
I $G(ORTYPE)="Z"!ORMAX
"DATA",101.41,2,10,5,4)
I "CDO"[$P(^(0),U,5)
"DATA",101.41,2,10,5,5)
I $G(ORESET),ORESET'=ORDIALOG(PROMPT,ORI) K ORDIALOG($$PTR^ORCD("OR GTX DURATION"),ORI)
"DATA",101.41,2,10,5,6)
D XSCH^ORCDLR
"DATA",101.41,2,10,5,7)
I $G(ORTYPE)'="Z",$D(LRFSCH)!ORMAX S Y=$O(^PS(51.1,"APLR","ONE TIME",0)) S:$D(LRFSCH)&Y EDITONLY=1 K:Y'>0 Y
"DATA",101.41,2,10,5,9)
I $G(ORTYPE)'="Z",ORMAX'>0 K ORDIALOG(PROMPT,INST)
"DATA",101.41,2,10,5,10)
S ORSCH=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,2,10,5,"W")
cboFrequency
"DATA",101.41,2,10,6,0)
6^180^^^^^^^C
"DATA",101.41,2,10,6,1)
Enter the urgency of this test.
"DATA",101.41,2,10,6,2)
4^^ROUTINE
"DATA",101.41,2,10,6,3)
I $$ASKURG^ORCDLR
"DATA",101.41,2,10,6,6)
D LIST^ORCD
"DATA",101.41,2,10,6,7)
I $G(ORTYPE)'="Z" S Y=+$G(ORTEST("Default Urgency")) I 'Y S Y=$S($L($G(LRFURG)):LRFURG,1:$$DEFURG^LR7OR3) S:$G(LRFURG) EDITONLY=1
"DATA",101.41,2,10,6,9)
D URGENCY^ORCDLR
"DATA",101.41,2,10,6,"W")
cboUrgency
"DATA",101.41,2,10,7,0)
3^126^^^^1^^^C^B;D
"DATA",101.41,2,10,7,1)
Enter the sample to be collected for this test.
"DATA",101.41,2,10,7,2)
2
"DATA",101.41,2,10,7,3)
I $$ASKSAMP^ORCDLR
"DATA",101.41,2,10,7,5)
I $G(ORESET),ORESET'=+Y N PTR S PTR=$$PTR^ORCD("OR GTX SPECIMEN") K ORDIALOG(PTR,1),ORDIALOG(PTR,"LIST")
"DATA",101.41,2,10,7,6)
D XHELP^ORCDLR(PROMPT)
"DATA",101.41,2,10,7,7)
S Y=$$SAMPLE^ORCDLR K:Y'>0 Y
"DATA",101.41,2,10,7,9)
D ENSAMP^ORCDLR
"DATA",101.41,2,10,7,10)
N ORS S ORS=+$G(ORDIALOG(PROMPT,INST)) D SHOWCOMM^ORCDLR(ORS)
"DATA",101.41,2,10,7,"W")
cboCollSamp
"DATA",101.41,2,10,8,0)
4^127^^^^1^^^C^B;D
"DATA",101.41,2,10,8,1)
Enter the specimen on which this test is to be performed.
"DATA",101.41,2,10,8,2)
3^=126
"DATA",101.41,2,10,8,3)
I '$$SPECIMEN^ORCDLR
"DATA",101.41,2,10,8,6)
D SPECHELP^ORCDLR
"DATA",101.41,2,10,8,7)
S Y=$$SPECIMEN^ORCDLR K:Y'>0 Y
"DATA",101.41,2,10,8,"W")
cboSpecimen
"DATA",101.41,2,10,9,0)
7^15^^^^^^^C
"DATA",101.41,2,10,9,1)
Enter any additional comments or instructions for this test and specimen.
"DATA",101.41,2,10,9,2)
9^^^^^1
"DATA",101.41,2,10,9,3)
I '$$REQDCOMM^ORCDLR
"DATA",101.41,2,10,9,"W")
txtComment
"DATA",101.41,2,10,10,0)
9^153^^How long: ^^1
"DATA",101.41,2,10,10,1)
Enter the number of days or X_number of times to execute this order.
"DATA",101.41,2,10,10,3)
I $G(ORSCH),"CD"[$P($G(^PS(51.1,ORSCH,0)),U,5) ;cont or day of week only
"DATA",101.41,2,10,10,5)
N OK S OK=$$CKMAX^ORCDLR(Y) I 'OK K DONE W $C(7),!,$P(OK,U,2),!
"DATA",101.41,2,10,10,9)
D SHOWMAX^ORCDLR
"DATA",101.41,2,10,10,"W")
txtDays
"DATA",101.41,2,99)
59060,54737
"DATA",101.41,119,0)
OR GXMOVE ADMIT PATIENT^Admit Patient^^D^15^2^22
"DATA",101.41,119,2,0)
^101.411^2^2^3020913^^^^
"DATA",101.41,119,2,1,0)
This allows admission of a patient as a generic order (does no interaction
"DATA",101.41,119,2,2,0)
with MAS).
"DATA",101.41,119,4)
K OREVNT
"DATA",101.41,119,10,0)
^101.412IA^5^5
"DATA",101.41,119,10,1,0)
1^620^^^^1^^^^C
"DATA",101.41,119,10,1,1)
Enter the movement you wish to order for this patient.
"DATA",101.41,119,10,1,2)
1^8~8
"DATA",101.41,119,10,1,3)
N X S X=$S($G(OREVT):0,1:1) I X ;uneditable if defined
"DATA",101.41,119,10,1,4)
I $S($P(^(0),U,2)="A":1,'$P(^(0),U,12):0,$P($G(^ORD(100.5,+$P(^(0),U,12),0)),U,2)="A":1,1:0)
"DATA",101.41,119,10,1,7)
S:$G(OREVT) Y=+OREVT
"DATA",101.41,119,10,1,10)
N X S X=$G(ORDIALOG(PROMPT,INST)) S:X OREVNT=+X
"DATA",101.41,119,10,2,0)
2^16^^^^^^^C
"DATA",101.41,119,10,2,1)
Enter the treating specialty this patient is to be admitted to.
"DATA",101.41,119,10,2,2)
2^^^Specialty: ^^1
"DATA",101.41,119,10,2,4)
I $$ACTIVE^DGACT(45.7,Y)
"DATA",101.41,119,10,2,6)
D XHELP^ORCDADT(PROMPT)
"DATA",101.41,119,10,2,7)
I $G(OREVNT) S Y=$$DEFTS^ORCDADT(OREVNT) K:Y<1 Y
"DATA",101.41,119,10,2,9)
D ENTS^ORCDADT(OREVNT)
"DATA",101.41,119,10,3,0)
3^17^^Attending: ^^1^^^C^AK.PROVIDER
"DATA",101.41,119,10,3,1)
Enter the attending provider for this patient.
"DATA",101.41,119,10,3,2)
3^^^Attending:^^1
"DATA",101.41,119,10,4,0)
5^19^^Instructions: ^^^^^C
"DATA",101.41,119,10,4,1)
Enter any special instructions for this order, up to 240 characters.
"DATA",101.41,119,10,4,2)
5^^^^^1
"DATA",101.41,119,10,5,0)
4^181^^Primary: ^^^^^C^AK.PROVIDER
"DATA",101.41,119,10,5,1)
Enter the primary provider for this patient.
"DATA",101.41,119,10,5,2)
4^^^Primary:^^1
"DATA",101.41,119,99)
59060,54754
"DATA",101.41,120,0)
OR GXMOVE TREATING SPECIALTY^Change Treating Specialty^^D^15^2^22
"DATA",101.41,120,2,0)
^101.411^2^2^3020913^^^^
"DATA",101.41,120,2,1,0)
This allows the treating specialty to be changed as a generic order (does
"DATA",101.41,120,2,2,0)
not interact with MAS package).
"DATA",101.41,120,4)
K OREVNT
"DATA",101.41,120,10,0)
^101.412IA^5^5
"DATA",101.41,120,10,1,0)
1^620^^^^1^^^^C
"DATA",101.41,120,10,1,1)
Enter the movement you wish to order for this patient.
"DATA",101.41,120,10,1,2)
1^8~8
"DATA",101.41,120,10,1,3)
N X S X=$S($G(OREVT):0,1:1) I X ;uneditable if defined
"DATA",101.41,120,10,1,4)
I $S($P(^(0),U,2)="T":1,'$P(^(0),U,12):0,$P($G(^ORD(100.5,+$P(^(0),U,12),0)),U,2)="T":1,1:0)
"DATA",101.41,120,10,1,7)
S:$G(OREVT) Y=+OREVT
"DATA",101.41,120,10,1,10)
N X S X=$G(ORDIALOG(PROMPT,INST)) S:X OREVNT=+X
"DATA",101.41,120,10,2,0)
2^16^^^^^^^C
"DATA",101.41,120,10,2,1)
Enter the treating specialty this patient is to be changed to.
"DATA",101.41,120,10,2,2)
2^^^Specialty: ^^1
"DATA",101.41,120,10,2,4)
I $$ACTIVE^DGACT(45.7,Y)
"DATA",101.41,120,10,2,6)
D XHELP^ORCDADT(PROMPT)
"DATA",101.41,120,10,2,7)
I $G(OREVNT) S Y=$$DEFTS^ORCDADT(OREVNT) K:Y<1 Y
"DATA",101.41,120,10,2,9)
D ENTS^ORCDADT(OREVNT)
"DATA",101.41,120,10,3,0)
3^17^^Attending: ^^1^^^C^AK.PROVIDER
"DATA",101.41,120,10,3,1)
Enter the attending provider for this patient.
"DATA",101.41,120,10,3,2)
3^^^Attending:^^1
"DATA",101.41,120,10,4,0)
5^19^^Instructions: ^^^^^C
"DATA",101.41,120,10,4,1)
Enter any special instructions for this order, up to 240 characters.
"DATA",101.41,120,10,4,2)
5^^^^^1
"DATA",101.41,120,10,5,0)
4^181^^Primary: ^^^^^C^AK.PROVIDER
"DATA",101.41,120,10,5,1)
Enter the primary provider for this patient.
"DATA",101.41,120,10,5,2)
4^^^Primary:^^1
"DATA",101.41,120,99)
59060,54754
"DATA",101.41,121,0)
OR GXMOVE DISCHARGE^Discharge Patient^^D^15^2^22
"DATA",101.41,121,2,0)
^^2^2^2990701^^^
"DATA",101.41,121,2,1,0)
This allows a patient to be discharged, as a generic order (does not
"DATA",101.41,121,2,2,0)
interact with MAS).
"DATA",101.41,121,10,0)
^101.412IA^3^3
"DATA",101.41,121,10,1,0)
1^620^^^^1^^^^C
"DATA",101.41,121,10,1,1)
Enter the movement you wish to order for this patient.
"DATA",101.41,121,10,1,2)
1^8~8
"DATA",101.41,121,10,1,3)
N X S X=$S($G(OREVT):0,1:1) I X ;uneditable if defined
"DATA",101.41,121,10,1,4)
I $S($P(^(0),U,2)="D":1,'$P(^(0),U,12):0,$P($G(^ORD(100.5,+$P(^(0),U,12),0)),U,2)="D":1,1:0)
"DATA",101.41,121,10,1,7)
S:$G(OREVT) Y=+OREVT
"DATA",101.41,121,10,2,0)
2^160^^Discharge Type: ^^^^^C
"DATA",101.41,121,10,2,1)
Enter the type of discharge for this patient.
"DATA",101.41,121,10,2,2)
2
"DATA",101.41,121,10,2,4)
I $P(^(0),U,2)=3,$P(^(0),U,4) ;Type=Discharge, Active
"DATA",101.41,121,10,3,0)
3^19^^Instructions: ^^^^^C
"DATA",101.41,121,10,3,1)
Enter any special instructions for this order, up to 240 characters.
"DATA",101.41,121,10,3,2)
3^^^Instructions:
"DATA",101.41,121,99)
59060,54754
"DATA",101.41,122,0)
OR GXMOVE TRANSFER^Transfer Patient^^D^15^2^22
"DATA",101.41,122,2,0)
^^2^2^2950720^
"DATA",101.41,122,2,1,0)
This allows a patient to be transferred as a generic order (does not
"DATA",101.41,122,2,2,0)
interact with MAS).
"DATA",101.41,122,5)
^^^Transfer
"DATA",101.41,122,10,0)
^101.412IA^2^2
"DATA",101.41,122,10,1,0)
1^620^^^^1^^^^C
"DATA",101.41,122,10,1,1)
Enter the movement you wish to order for this patient.
"DATA",101.41,122,10,1,2)
1^8~8
"DATA",101.41,122,10,1,3)
N X S X=$S($G(OREVT):0,1:1) I X ;uneditable if defined
"DATA",101.41,122,10,1,4)
I $S($P(^(0),U,2)="T":1,'$P(^(0),U,12):0,$P($G(^ORD(100.5,+$P(^(0),U,12),0)),U,2)="T":1,1:0)
"DATA",101.41,122,10,1,7)
S:$G(OREVT) Y=+OREVT
"DATA",101.41,122,10,2,0)
2^19^^Instructions: ^^^^^C
"DATA",101.41,122,10,2,1)
Enter any special instructions for this order, up to 240 characters.
"DATA",101.41,122,10,2,2)
2
"DATA",101.41,122,99)
59060,54754
"DATA",101.41,129,0)
PSJ OR PAT OE^Inpatient Medications^^D^23^2^60^1^2
"DATA",101.41,129,3)
D PROVIDER^ORCDPSIV Q:$G(ORQUIT)  D EN^ORCDPS1("I")
"DATA",101.41,129,3.1)
D EN1^ORCDPS1
"DATA",101.41,129,4)
D EXIT^ORCDPS1
"DATA",101.41,129,5)
^^^Meds, Inpatient^130
"DATA",101.41,129,7)
D SC^ORCDPS3
"DATA",101.41,129,10,0)
^101.412IA^21^21
"DATA",101.41,129,10,1,0)
1^4^^Medication: ^^1^^^^S.UD RX
"DATA",101.41,129,10,1,1)
Enter the medication you wish to order for this patient.
"DATA",101.41,129,10,1,2)
1^@1350
"DATA",101.41,129,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)
"DATA",101.41,129,10,1,5)
D DEA^ORCDPS1 Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPS1("OI")
"DATA",101.41,129,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,129,10,1,9)
D ENOI^ORCDPS1
"DATA",101.41,129,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPS1(OROI),NFI^ORCDPS1(OROI)
"DATA",101.41,129,10,2,0)
2^136^^Dose: ^^1^1^^C^^^^Instructions: 
"DATA",101.41,129,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,129,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)  D DEFCONJ^ORCDPS1
"DATA",101.41,129,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,129,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,129,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,129,10,3,0)
2.1^137^^^^1^^^C^^136
"DATA",101.41,129,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,129,10,3,2)
^1~3
"DATA",101.41,129,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,129,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,129,10,3,7)
D DEFRTE^ORCDPS1
"DATA",101.41,129,10,3,9)
D ROUTES^ORCDPS1
"DATA",101.41,129,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,129,10,4,0)
2.2^170^^^^1^^^C^^136
"DATA",101.41,129,10,4,1)
Enter either a standard administration schedule or one of your own, up to 70 characters and no more than 2 spaces.
"DATA",101.41,129,10,4,5)
D CKSCH^ORCDPS1
"DATA",101.41,129,10,4,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D DQ^DICQ
"DATA",101.41,129,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,129,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,129,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,129,10,5,0)
8^7^^Priority: ^^1^^^C^S.PSO
"DATA",101.41,129,10,5,1)
Enter the urgency of this order.
"DATA",101.41,129,10,5,2)
6^^ROUTINE DONE
"DATA",101.41,129,10,5,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,129,10,5,9)
S ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.PSJ",1:"S.PSO")
"DATA",101.41,129,10,6,0)
10^15^^Comments: ^^^^^C
"DATA",101.41,129,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,129,10,6,2)
7
"DATA",101.41,129,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,129,10,7,0)
1.1^613^^^^^^^^^4
"DATA",101.41,129,10,7,2)
^@1350
"DATA",101.41,129,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,129,10,8,0)
5.5^149^^^^^^^C
"DATA",101.41,129,10,8,1)
Enter the amount (number of tablets, e.g.) to be dispensed.
"DATA",101.41,129,10,8,2)
8^^^Quantity:^^1
"DATA",101.41,129,10,8,3)
I ORCAT="O"
"DATA",101.41,129,10,8,7)
I $G(ORCAT)="O",$G(ORTYPE)'="Z" S Y=$$QTY^ORCDPS1 K:Y'>0 Y
"DATA",101.41,129,10,8,9)
I ORCAT="O" W:$L($G(ORQTY)) !,ORQTY S ORDIALOG(PROMPT,"A")="Quantity"_$S($L($G(ORQTYUNT)):" ("_ORQTYUNT_"): ",1:": ")
"DATA",101.41,129,10,9,0)
7^148^^Pick Up: ^^1^^^RC
"DATA",101.41,129,10,9,1)
Enter if the patient is to receive this medication by mail, at the window, or in the clinic.
"DATA",101.41,129,10,9,3)
I ORCAT="O"
"DATA",101.41,129,10,9,6)
D SETLIST^ORCD
"DATA",101.41,129,10,9,7)
I ORCAT="O",$G(ORTYPE)'="Z" S Y=$S($G(OREVENT):"W",$D(^PSX(550,"C")):"M",1:"W") I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)) S Y=^(INST),EDITONLY=1
"DATA",101.41,129,10,10,0)
6^150^^Refills: ^^1^^^RC
"DATA",101.41,129,10,10,1)
Enter the number of refills to allow for this order.
"DATA",101.41,129,10,10,2)
9^^^Refills:
"DATA",101.41,129,10,10,3)
I ORCAT="O",$G(OREFILLS)>0
"DATA",101.41,129,10,10,9)
I ORCAT="O",'$G(OREFILLS) D MAXREFS^ORCDPS1
"DATA",101.41,129,10,11,0)
9^151^^Is this medication for a SC condition? ^^^^^CW^^^^SC: 
"DATA",101.41,129,10,11,1)
If this medication is for treatment of a service-connected condition, enter YES.
"DATA",101.41,129,10,11,3)
I ORCAT="O",$G(ORCOPAY),$G(ORSC)
"DATA",101.41,129,10,11,6)
N DFN S DFN=+ORVP D DIS^DGRPDB
"DATA",101.41,129,10,11,7)
I $G(ORTYPE)'="Z",ORCAT="O",$G(ORCOPAY),$G(ORSC) S Y=$S($P(ORSC,U,2)>50:1,1:0)
"DATA",101.41,129,10,11,9)
I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1 I ORCOPAY,$G(ORSC),'$D(ORDIALOG(PROMPT,INST)) N DFN S DFN=+ORVP D:$P(ORSC,U,2)'>50 DIS^DGRPDB S:$P(ORSC,U,2)>50 $P(ORDIALOG(PROMPT,0),U)="YA",EDITONLY=1 ; Req'd
"DATA",101.41,129,10,12,0)
2.3^153^^How long: ^^^^^C^^136
"DATA",101.41,129,10,12,1)
Enter the length of time over which this dose is to be administered as '4 HOURS', '7 DAYS', '2 WEEKS', or '1 MONTH'.
"DATA",101.41,129,10,12,2)
^^^FOR
"DATA",101.41,129,10,12,3)
I $$ASKDUR^ORCDPS3
"DATA",101.41,129,10,12,5)
D DUR^ORCDPS3
"DATA",101.41,129,10,12,7)
Q  I $G(ORTYPE)'="Z",$G(ORCAT)="I",$G(ORCOMPLX),$P($G(ORSD),U,3) S Y=+$P(ORSD,U,3)_" DAYS"
"DATA",101.41,129,10,13,0)
4^6^^Start: ^^^^1^C
"DATA",101.41,129,10,13,1)
Enter the date this order should begin.
"DATA",101.41,129,10,13,3)
I $G(ORCAT)="O",$G(OREVENT) ;discharge orders only
"DATA",101.41,129,10,13,7)
Q  I $G(ORTYPE)'="Z",ORCAT'="O" S Y=$P($G(ORSD),U) K:'$L(Y) Y
"DATA",101.41,129,10,13,9)
D START^ORCDPS3 ;I 'FIRST,$G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)) D LIST^ORCD ;editonly
"DATA",101.41,129,10,14,0)
3^614^^Text: 
"DATA",101.41,129,10,14,2)
2^^^^^1^0
"DATA",101.41,129,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,129,10,15,0)
2.5^615^^^^^^^*^^136
"DATA",101.41,129,10,15,2)
^@
"DATA",101.41,129,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,129,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,129,10,16,0)
2.6^138^^^^^^^*
"DATA",101.41,129,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,129,10,17,0)
5^616^^^^1^^^C
"DATA",101.41,129,10,17,1)
Enter the number of days for which the patient needs this medication.
"DATA",101.41,129,10,17,3)
I $G(ORCAT)="O"
"DATA",101.41,129,10,17,5)
I $G(ORESET),+ORESET'=+Y D CHANGED^ORCDPS1("DS")
"DATA",101.41,129,10,17,9)
I $G(ORCAT)="O" D DSUP^ORCDPS1
"DATA",101.41,129,10,17,10)
S:$G(ORCAT)="O" ORDSUP=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,129,10,18,0)
1.5^618
"DATA",101.41,129,10,18,2)
1.5
"DATA",101.41,129,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,129,10,19,0)
2.4^617^^^^^^^C^^136
"DATA",101.41,129,10,19,1)
Enter AND if the next dose is to be administered concurrently with this one, or THEN if it is to follow after.
"DATA",101.41,129,10,19,3)
I $G(ORCOMPLX)
"DATA",101.41,129,10,19,5)
I $G(ORESET)'=$P(Y,U) D CHANGED^ORCDPS1("QUANTITY")
"DATA",101.41,129,10,19,9)
D ENCONJ^ORCDPS1
"DATA",101.41,129,10,19,10)
I $G(ORCOMPLX),'$L($G(ORDIALOG(PROMPT,INST))),FIRST S MAX=1 ;stop prompting dose multiple
"DATA",101.41,129,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,129,10,20,2)
3
"DATA",101.41,129,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,129,10,20,9)
D PI^ORCDPS2
"DATA",101.41,129,10,21,0)
4.5^1359
"DATA",101.41,129,10,21,2)
10^^^First Dose^^1
"DATA",101.41,129,10,21,3)
I 0 ;set via Entry Action
"DATA",101.41,129,10,21,9)
D NOW^ORCDPS3
"DATA",101.41,129,99)
59060,54763
"DATA",101.41,147,0)
PSO OERR^Outpatient Medications^^D^4^2^15^1^2
"DATA",101.41,147,3)
D PROVIDER^ORCDPSIV Q:$G(ORQUIT)  D EN^ORCDPS1("O")
"DATA",101.41,147,3.1)
D EN1^ORCDPS1
"DATA",101.41,147,4)
D EXIT^ORCDPS1
"DATA",101.41,147,5)
^^^Meds, Outpatient^140
"DATA",101.41,147,7)
D SC^ORCDPS3
"DATA",101.41,147,10,0)
^101.412IA^21^21
"DATA",101.41,147,10,1,0)
1^4^^Medication: ^^1^^^^S.O RX
"DATA",101.41,147,10,1,1)
Enter the medication you wish to order for this patient.
"DATA",101.41,147,10,1,2)
1^@1350
"DATA",101.41,147,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)
"DATA",101.41,147,10,1,5)
D DEA^ORCDPS1 Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPS1("OI")
"DATA",101.41,147,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,147,10,1,9)
D ENOI^ORCDPS1
"DATA",101.41,147,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPS1(OROI),NFI^ORCDPS1(OROI)
"DATA",101.41,147,10,2,0)
2^136^^Dose: ^^1^1^^C^^^^Instructions: 
"DATA",101.41,147,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,147,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)  D DEFCONJ^ORCDPS1
"DATA",101.41,147,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,147,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,147,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,147,10,3,0)
2.1^137^^^^1^^^C^^136
"DATA",101.41,147,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,147,10,3,2)
^1~3
"DATA",101.41,147,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,147,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,147,10,3,7)
D DEFRTE^ORCDPS1
"DATA",101.41,147,10,3,9)
D ROUTES^ORCDPS1
"DATA",101.41,147,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,147,10,4,0)
2.2^170^^^^1^^^C^^136
"DATA",101.41,147,10,4,1)
Enter either a standard administration schedule or one of your own, up to 70 characters and no more than 2 spaces.
"DATA",101.41,147,10,4,5)
D CKSCH^ORCDPS1
"DATA",101.41,147,10,4,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D DQ^DICQ
"DATA",101.41,147,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,147,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,147,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,147,10,5,0)
8^7^^Priority: ^^1^^^C^S.PSO
"DATA",101.41,147,10,5,1)
Enter the urgency of this order.
"DATA",101.41,147,10,5,2)
6^^ROUTINE DONE
"DATA",101.41,147,10,5,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,147,10,5,9)
S ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.PSJ",1:"S.PSO")
"DATA",101.41,147,10,6,0)
10^15^^Comments: ^^^^^C
"DATA",101.41,147,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,147,10,6,2)
7
"DATA",101.41,147,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,147,10,7,0)
1.1^613^^^^^^^^^4
"DATA",101.41,147,10,7,2)
^@1350
"DATA",101.41,147,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,147,10,8,0)
5.5^149^^^^^^^C
"DATA",101.41,147,10,8,1)
Enter the amount (number of tablets, e.g.) to be dispensed.
"DATA",101.41,147,10,8,2)
8^^^Quantity:^^1
"DATA",101.41,147,10,8,3)
I ORCAT="O"
"DATA",101.41,147,10,8,7)
I $G(ORCAT)="O",$G(ORTYPE)'="Z" S Y=$$QTY^ORCDPS1 K:Y'>0 Y
"DATA",101.41,147,10,8,9)
I ORCAT="O" W:$L($G(ORQTY)) !,ORQTY S ORDIALOG(PROMPT,"A")="Quantity"_$S($L($G(ORQTYUNT)):" ("_ORQTYUNT_"): ",1:": ")
"DATA",101.41,147,10,9,0)
7^148^^Pick Up: ^^1^^^RC
"DATA",101.41,147,10,9,1)
Enter if the patient is to receive this medication by mail, at the window, or in the clinic.
"DATA",101.41,147,10,9,3)
I ORCAT="O"
"DATA",101.41,147,10,9,6)
D SETLIST^ORCD
"DATA",101.41,147,10,9,7)
I ORCAT="O",$G(ORTYPE)'="Z" S Y=$S($G(OREVENT):"W",$D(^PSX(550,"C")):"M",1:"W") I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)) S Y=^(INST),EDITONLY=1
"DATA",101.41,147,10,10,0)
6^150^^Refills: ^^1^^^RC
"DATA",101.41,147,10,10,1)
Enter the number of refills to allow for this order.
"DATA",101.41,147,10,10,2)
9^^^Refills:
"DATA",101.41,147,10,10,3)
I ORCAT="O",$G(OREFILLS)>0
"DATA",101.41,147,10,10,9)
I ORCAT="O",'$G(OREFILLS) D MAXREFS^ORCDPS1
"DATA",101.41,147,10,11,0)
9^151^^Is this medication for a SC condition? ^^^^^CW^^^^SC: 
"DATA",101.41,147,10,11,1)
If this medication is for treatment of a service-connected condition, enter YES.
"DATA",101.41,147,10,11,3)
I ORCAT="O",$G(ORCOPAY),$G(ORSC)
"DATA",101.41,147,10,11,6)
N DFN S DFN=+ORVP D DIS^DGRPDB
"DATA",101.41,147,10,11,7)
I $G(ORTYPE)'="Z",ORCAT="O",$G(ORCOPAY),$G(ORSC) S Y=$S($P(ORSC,U,2)>50:1,1:0)
"DATA",101.41,147,10,11,9)
I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1 I ORCOPAY,$G(ORSC),'$D(ORDIALOG(PROMPT,INST)) N DFN S DFN=+ORVP D:$P(ORSC,U,2)'>50 DIS^DGRPDB S:$P(ORSC,U,2)>50 $P(ORDIALOG(PROMPT,0),U)="YA",EDITONLY=1 ; Req'd
"DATA",101.41,147,10,12,0)
2.3^153^^How long: ^^^^^C^^136
"DATA",101.41,147,10,12,1)
Enter the length of time over which this dose is to be administered as '4 HOURS', '7 DAYS', '2 WEEKS', or '1 MONTH'.
"DATA",101.41,147,10,12,2)
^^^FOR
"DATA",101.41,147,10,12,3)
I $$ASKDUR^ORCDPS3
"DATA",101.41,147,10,12,5)
D DUR^ORCDPS3
"DATA",101.41,147,10,12,7)
Q  I $G(ORTYPE)'="Z",$G(ORCAT)="I",$G(ORCOMPLX),$P($G(ORSD),U,3) S Y=+$P(ORSD,U,3)_" DAYS"
"DATA",101.41,147,10,13,0)
4^6^^Start: ^^^^1^C
"DATA",101.41,147,10,13,1)
Enter the date this order should begin.
"DATA",101.41,147,10,13,3)
I $G(ORCAT)="O",$G(OREVENT) ;discharge orders only
"DATA",101.41,147,10,13,7)
Q  I $G(ORTYPE)'="Z",ORCAT'="O" S Y=$P($G(ORSD),U) K:'$L(Y) Y
"DATA",101.41,147,10,13,9)
D START^ORCDPS3 ;I 'FIRST,$G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)) D LIST^ORCD ;editonly
"DATA",101.41,147,10,14,0)
3^614
"DATA",101.41,147,10,14,2)
2^^^^^1^0
"DATA",101.41,147,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,147,10,15,0)
2.5^615^^^^^^^*^^136
"DATA",101.41,147,10,15,2)
^@
"DATA",101.41,147,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,147,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,147,10,16,0)
2.6^138^^^^^^^*
"DATA",101.41,147,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,147,10,17,0)
5^616^^^^1^^^C
"DATA",101.41,147,10,17,1)
Enter the number of days for which the patient needs this medication.
"DATA",101.41,147,10,17,3)
I $G(ORCAT)="O"
"DATA",101.41,147,10,17,5)
I $G(ORESET),+ORESET'=+Y D CHANGED^ORCDPS1("DS")
"DATA",101.41,147,10,17,9)
I $G(ORCAT)="O" D DSUP^ORCDPS1
"DATA",101.41,147,10,17,10)
S:$G(ORCAT)="O" ORDSUP=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,147,10,18,0)
1.5^618
"DATA",101.41,147,10,18,2)
1.5
"DATA",101.41,147,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,147,10,19,0)
2.4^617^^^^^^^C^^136
"DATA",101.41,147,10,19,1)
Enter AND if the next dose is to be administered concurrently with this one, or THEN if it is to follow after.
"DATA",101.41,147,10,19,3)
I $G(ORCOMPLX)
"DATA",101.41,147,10,19,5)
I $G(ORESET)'=$P(Y,U) D CHANGED^ORCDPS1("QUANTITY")
"DATA",101.41,147,10,19,9)
D ENCONJ^ORCDPS1
"DATA",101.41,147,10,19,10)
I $G(ORCOMPLX),'$L($G(ORDIALOG(PROMPT,INST))),FIRST S MAX=1 ;stop prompting dose multiple
"DATA",101.41,147,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,147,10,20,2)
3
"DATA",101.41,147,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,147,10,20,9)
D PI^ORCDPS2
"DATA",101.41,147,10,21,0)
4.5^1359
"DATA",101.41,147,10,21,2)
10^^^First Dose^^1
"DATA",101.41,147,10,21,3)
I 0 ;set via Entry Action
"DATA",101.41,147,10,21,9)
D NOW^ORCDPS3
"DATA",101.41,147,99)
59060,54763
"DATA",101.41,171,0)
PSO SUPPLY^Supplies^^D^28^2^15^1^2
"DATA",101.41,171,3)
D PROVIDER^ORCDPSIV Q:$G(ORQUIT)  D EN^ORCDPS1("O")
"DATA",101.41,171,3.1)
D EN1^ORCDPS1
"DATA",101.41,171,4)
D EXIT^ORCDPS1
"DATA",101.41,171,5)
^^^Meds, Supplies^140
"DATA",101.41,171,7)
D SC^ORCDPS3
"DATA",101.41,171,10,0)
^101.412IA^21^21
"DATA",101.41,171,10,1,0)
1^4^^Medication: ^^1^^^^S.SPLY
"DATA",101.41,171,10,1,1)
Enter the item or device you wish to order for this patient.
"DATA",101.41,171,10,1,2)
1^@1350
"DATA",101.41,171,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)
"DATA",101.41,171,10,1,5)
D DEA^ORCDPS1 Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPS1("OI")
"DATA",101.41,171,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,171,10,1,9)
D ENOI^ORCDPS1
"DATA",101.41,171,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPS1(OROI),NFI^ORCDPS1(OROI)
"DATA",101.41,171,10,2,0)
2^136^^Dose: ^^1^1^^C^^^^Instructions: 
"DATA",101.41,171,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,171,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)  D DEFCONJ^ORCDPS1
"DATA",101.41,171,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,171,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,171,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,171,10,3,0)
2.1^137^^^^0^^^C^^136
"DATA",101.41,171,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,171,10,3,2)
^1~3
"DATA",101.41,171,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,171,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,171,10,3,7)
D DEFRTE^ORCDPS1
"DATA",101.41,171,10,3,9)
D ROUTES^ORCDPS1
"DATA",101.41,171,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,171,10,4,0)
2.2^170^^^^1^^^C^^136
"DATA",101.41,171,10,4,1)
Enter either a standard administration schedule or one of your own, up to 70 characters and no more than 2 spaces.
"DATA",101.41,171,10,4,5)
D CKSCH^ORCDPS1
"DATA",101.41,171,10,4,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D DQ^DICQ
"DATA",101.41,171,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,171,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,171,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,171,10,5,0)
8^7^^Priority: ^^1^^^C^S.PSO
"DATA",101.41,171,10,5,1)
Enter the urgency of this order.
"DATA",101.41,171,10,5,2)
6^^ROUTINE DONE
"DATA",101.41,171,10,5,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,171,10,5,9)
S ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.PSJ",1:"S.PSO")
"DATA",101.41,171,10,6,0)
10^15^^Comments: ^^^^^C
"DATA",101.41,171,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,171,10,6,2)
7
"DATA",101.41,171,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,171,10,7,0)
1.1^613^^^^^^^^^4
"DATA",101.41,171,10,7,2)
^@1350
"DATA",101.41,171,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,171,10,8,0)
5.5^149^^^^^^^C
"DATA",101.41,171,10,8,1)
Enter the amount (number of tablets, e.g.) to be dispensed.
"DATA",101.41,171,10,8,2)
8^^^Quantity:^^1
"DATA",101.41,171,10,8,3)
I ORCAT="O"
"DATA",101.41,171,10,8,7)
I $G(ORCAT)="O",$G(ORTYPE)'="Z" S Y=$$QTY^ORCDPS1 K:Y'>0 Y
"DATA",101.41,171,10,8,9)
I ORCAT="O" W:$L($G(ORQTY)) !,ORQTY S ORDIALOG(PROMPT,"A")="Quantity"_$S($L($G(ORQTYUNT)):" ("_ORQTYUNT_"): ",1:": ")
"DATA",101.41,171,10,9,0)
7^148^^Pick Up: ^^1^^^RC
"DATA",101.41,171,10,9,1)
Enter if the patient is to receive this medication by mail, at the window, or in the clinic.
"DATA",101.41,171,10,9,3)
I ORCAT="O"
"DATA",101.41,171,10,9,6)
D SETLIST^ORCD
"DATA",101.41,171,10,9,7)
I ORCAT="O",$G(ORTYPE)'="Z" S Y=$S($G(OREVENT):"W",$D(^PSX(550,"C")):"M",1:"W") I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)) S Y=^(INST),EDITONLY=1
"DATA",101.41,171,10,10,0)
6^150^^Refills: ^^1^^^RC
"DATA",101.41,171,10,10,1)
Enter the number of refills to allow for this order.
"DATA",101.41,171,10,10,2)
9^^^Refills:
"DATA",101.41,171,10,10,3)
I ORCAT="O",$G(OREFILLS)>0
"DATA",101.41,171,10,10,9)
I ORCAT="O",'$G(OREFILLS) D MAXREFS^ORCDPS1
"DATA",101.41,171,10,11,0)
9^151^^Is this medication for a SC condition? ^^^^^CW^^^^SC: 
"DATA",101.41,171,10,11,1)
If this medication is for treatment of a service-connected condition, enter YES.
"DATA",101.41,171,10,11,3)
I ORCAT="O",$G(ORCOPAY),$G(ORSC)
"DATA",101.41,171,10,11,6)
N DFN S DFN=+ORVP D DIS^DGRPDB
"DATA",101.41,171,10,11,7)
I $G(ORTYPE)'="Z",ORCAT="O",$G(ORCOPAY),$G(ORSC) S Y=$S($P(ORSC,U,2)>50:1,1:0)
"DATA",101.41,171,10,11,9)
I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1 I ORCOPAY,$G(ORSC),'$D(ORDIALOG(PROMPT,INST)) N DFN S DFN=+ORVP D:$P(ORSC,U,2)'>50 DIS^DGRPDB S:$P(ORSC,U,2)>50 $P(ORDIALOG(PROMPT,0),U)="YA",EDITONLY=1 ; Req'd
"DATA",101.41,171,10,12,0)
2.3^153^^How long: ^^^^^C^^136
"DATA",101.41,171,10,12,1)
Enter the length of time over which this dose is to be administered as '4 HOURS', '7 DAYS', '2 WEEKS', or '1 MONTH'.
"DATA",101.41,171,10,12,2)
^^^FOR
"DATA",101.41,171,10,12,3)
I $$ASKDUR^ORCDPS3
"DATA",101.41,171,10,12,5)
D DUR^ORCDPS3
"DATA",101.41,171,10,12,7)
Q  I $G(ORTYPE)'="Z",$G(ORCAT)="I",$G(ORCOMPLX),$P($G(ORSD),U,3) S Y=+$P(ORSD,U,3)_" DAYS"
"DATA",101.41,171,10,13,0)
4^6^^Start: ^^^^1^C
"DATA",101.41,171,10,13,1)
Enter the date this order should begin.
"DATA",101.41,171,10,13,3)
I $G(ORCAT)="O",$G(OREVENT) ;discharge orders only
"DATA",101.41,171,10,13,7)
Q  I $G(ORTYPE)'="Z",ORCAT'="O" S Y=$P($G(ORSD),U) K:'$L(Y) Y
"DATA",101.41,171,10,13,9)
D START^ORCDPS3 ;I 'FIRST,$G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)) D LIST^ORCD ;editonly
"DATA",101.41,171,10,14,0)
3^614
"DATA",101.41,171,10,14,2)
2^^^^^1^0
"DATA",101.41,171,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,171,10,15,0)
2.5^615^^^^^^^*^^136
"DATA",101.41,171,10,15,2)
^@
"DATA",101.41,171,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,171,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,171,10,16,0)
2.6^138^^^^^^^*
"DATA",101.41,171,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,171,10,17,0)
5^616^^^^1^^^C
"DATA",101.41,171,10,17,1)
Enter the number of days for which the patient needs this medication.
"DATA",101.41,171,10,17,3)
I $G(ORCAT)="O"
"DATA",101.41,171,10,17,5)
I $G(ORESET),+ORESET'=+Y D CHANGED^ORCDPS1("DS")
"DATA",101.41,171,10,17,9)
I $G(ORCAT)="O" D DSUP^ORCDPS1
"DATA",101.41,171,10,17,10)
S:$G(ORCAT)="O" ORDSUP=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,171,10,18,0)
1.5^618
"DATA",101.41,171,10,18,2)
1.5
"DATA",101.41,171,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,171,10,19,0)
2.4^617^^^^^^^C^^136
"DATA",101.41,171,10,19,1)
Enter AND if the next dose is to be administered concurrently with this one, or THEN if it is to follow after.
"DATA",101.41,171,10,19,3)
I $G(ORCOMPLX)
"DATA",101.41,171,10,19,5)
I $G(ORESET)'=$P(Y,U) D CHANGED^ORCDPS1("QUANTITY")
"DATA",101.41,171,10,19,9)
D ENCONJ^ORCDPS1
"DATA",101.41,171,10,19,10)
I $G(ORCOMPLX),'$L($G(ORDIALOG(PROMPT,INST))),FIRST S MAX=1 ;stop prompting dose multiple
"DATA",101.41,171,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,171,10,20,2)
3
"DATA",101.41,171,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,171,10,20,9)
D PI^ORCDPS2
"DATA",101.41,171,10,21,0)
4.5^1359
"DATA",101.41,171,10,21,2)
10^^^First Dose^^1
"DATA",101.41,171,10,21,3)
I 0 ;set via Entry Action
"DATA",101.41,171,10,21,9)
D NOW^ORCDPS3
"DATA",101.41,171,99)
59060,54763
"DATA",101.41,612,0)
PS MEDS^Medications^^D^2^2^360^1^2
"DATA",101.41,612,3)
D PROVIDER^ORCDPSIV Q:$G(ORQUIT)  D EN^ORCDPS1("")
"DATA",101.41,612,3.1)
D EN1^ORCDPS1
"DATA",101.41,612,4)
D EXIT^ORCDPS1
"DATA",101.41,612,5)
^^^Medications^135
"DATA",101.41,612,7)
D SC^ORCDPS3
"DATA",101.41,612,10,0)
^101.412IA^21^21
"DATA",101.41,612,10,1,0)
1^4^^Medication: ^^1^^^^S.RX
"DATA",101.41,612,10,1,1)
Enter the medication you wish to order for this patient.
"DATA",101.41,612,10,1,2)
1^@1350
"DATA",101.41,612,10,1,4)
I '$G(^(.1))!($G(^(.1))>$$NOW^XLFDT)
"DATA",101.41,612,10,1,5)
D DEA^ORCDPS1 Q:'$G(DONE)  I $G(ORESET)'=+Y D CHANGED^ORCDPS1("OI")
"DATA",101.41,612,10,1,6)
N IDX,SCR S IDX=$G(ORDIALOG(PROMPT,"D")),SCR=$G(ORDIALOG(PROMPT,"S")) D XHELP^ORDD43(IDX,SCR)
"DATA",101.41,612,10,1,9)
D ENOI^ORCDPS1
"DATA",101.41,612,10,1,10)
S OROI=+$G(ORDIALOG(PROMPT,INST)) D ORDITM^ORCDPS1(OROI),NFI^ORCDPS1(OROI) S ORPKG=+$O(^DIC(9.4,"C",$S(ORCAT="I":"PSJ",1:"PSO"),0))
"DATA",101.41,612,10,2,0)
2^136^^Dose: ^^1^1^^C^^^^Instructions: 
"DATA",101.41,612,10,2,1)
Enter the dosage instructions for this order, as an amount and units.
"DATA",101.41,612,10,2,5)
D CHDOSE^ORCDPS2 Q:'$G(DONE)  D DEFCONJ^ORCDPS1
"DATA",101.41,612,10,2,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST")),F^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))
"DATA",101.41,612,10,2,9)
D DOSES^ORCDPS2 I $G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)),'$G(ORENEW) D LIST^ORCD
"DATA",101.41,612,10,2,10)
D EXDOSE^ORCDPS2
"DATA",101.41,612,10,3,0)
2.1^137^^^^1^^^C^^136
"DATA",101.41,612,10,3,1)
Enter the route of administration for this drug.
"DATA",101.41,612,10,3,2)
^1~3
"DATA",101.41,612,10,3,4)
I $P(^(0),U,4)
"DATA",101.41,612,10,3,6)
D LIST^ORCD:$G(ORDIALOG(PROMPT,"LIST"))&(X="?"),P^ORCDLGH:'$G(ORDIALOG(PROMPT,"LIST"))!(X'="?")
"DATA",101.41,612,10,3,7)
D DEFRTE^ORCDPS1
"DATA",101.41,612,10,3,9)
D ROUTES^ORCDPS1
"DATA",101.41,612,10,3,10)
S OROUTE=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,612,10,4,0)
2.2^170^^^^1^^^C^^136
"DATA",101.41,612,10,4,1)
Enter either a standard administration schedule or one of your own, up to 70 characters and no more than 2 spaces.
"DATA",101.41,612,10,4,5)
D CKSCH^ORCDPS1
"DATA",101.41,612,10,4,6)
N DIC,D,DZ S DIC="^PS(51.1,",DIC(0)="EQS",D="APPSJ",DZ="??" D DQ^DICQ
"DATA",101.41,612,10,4,7)
S:$L($G(^TMP("PSJSCH",$J))) Y=^($J)
"DATA",101.41,612,10,4,9)
S:ORCAT="I" REQD=$$SCHREQ^PSJORPOE(OROUTE,OROI,$G(ORDRUG))
"DATA",101.41,612,10,4,10)
S ORSCH=$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,612,10,5,0)
8^7^^Priority: ^^1^^^C^S.PSO
"DATA",101.41,612,10,5,1)
Enter the urgency of this order.
"DATA",101.41,612,10,5,2)
6^^ROUTINE DONE
"DATA",101.41,612,10,5,7)
S Y=+$$RECALL^ORCD(PROMPT) S:Y EDITONLY=1 S:'Y Y=9
"DATA",101.41,612,10,5,9)
S ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.PSJ",1:"S.PSO")
"DATA",101.41,612,10,6,0)
10^15^^Comments: ^^^^^C
"DATA",101.41,612,10,6,1)
Enter any additional instructions for this order.
"DATA",101.41,612,10,6,2)
7
"DATA",101.41,612,10,6,3)
I '$G(PSJNOPC)!($G(ORTYPE)="Z")
"DATA",101.41,612,10,7,0)
1.1^613^^^^^^^^^4
"DATA",101.41,612,10,7,2)
^@1350
"DATA",101.41,612,10,7,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,612,10,8,0)
5.5^149^^^^^^^C
"DATA",101.41,612,10,8,1)
Enter the amount (number of tablets, e.g.) to be dispensed.
"DATA",101.41,612,10,8,2)
8^^^Quantity:^^1
"DATA",101.41,612,10,8,3)
I ORCAT="O"
"DATA",101.41,612,10,8,7)
I $G(ORCAT)="O",$G(ORTYPE)'="Z" S Y=$$QTY^ORCDPS1 K:Y'>0 Y
"DATA",101.41,612,10,8,9)
I ORCAT="O" W:$L($G(ORQTY)) !,ORQTY S ORDIALOG(PROMPT,"A")="Quantity"_$S($L($G(ORQTYUNT)):" ("_ORQTYUNT_"): ",1:": ")
"DATA",101.41,612,10,9,0)
7^148^^Pick Up: ^^1^^^RC
"DATA",101.41,612,10,9,1)
Enter if the patient is to receive this medication by mail, at the window, or in the clinic.
"DATA",101.41,612,10,9,3)
I ORCAT="O"
"DATA",101.41,612,10,9,6)
D SETLIST^ORCD
"DATA",101.41,612,10,9,7)
I ORCAT="O",$G(ORTYPE)'="Z" S Y=$S($G(OREVENT):"W",$D(^PSX(550,"C")):"M",1:"W") I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT,INST)) S Y=^(INST),EDITONLY=1
"DATA",101.41,612,10,10,0)
6^150^^Refills: ^^1^^^RC
"DATA",101.41,612,10,10,1)
Enter the number of refills to allow for this order.
"DATA",101.41,612,10,10,2)
9^^^Refills:
"DATA",101.41,612,10,10,3)
I ORCAT="O",$G(OREFILLS)>0
"DATA",101.41,612,10,10,9)
I ORCAT="O",'$G(OREFILLS) D MAXREFS^ORCDPS1
"DATA",101.41,612,10,11,0)
9^151^^Is this medication for a SC condition? ^^^^^CW^^^^SC: 
"DATA",101.41,612,10,11,1)
If this medication is for treatment of a service-connected condition, enter YES.
"DATA",101.41,612,10,11,3)
I ORCAT="O",$G(ORCOPAY),$G(ORSC)
"DATA",101.41,612,10,11,6)
N DFN S DFN=+ORVP D DIS^DGRPDB
"DATA",101.41,612,10,11,7)
I $G(ORTYPE)'="Z",ORCAT="O",$G(ORCOPAY),$G(ORSC) S Y=$S($P(ORSC,U,2)>50:1,1:0)
"DATA",101.41,612,10,11,9)
I ORCAT="O" S ORCOPAY=$$ASKSC^ORCDPS1 I ORCOPAY,$G(ORSC),'$D(ORDIALOG(PROMPT,INST)) N DFN S DFN=+ORVP D:$P(ORSC,U,2)'>50 DIS^DGRPDB S:$P(ORSC,U,2)>50 $P(ORDIALOG(PROMPT,0),U)="YA",EDITONLY=1 ; Req'd
"DATA",101.41,612,10,12,0)
2.3^153^^How long: ^^^^^C^^136
"DATA",101.41,612,10,12,1)
Enter the length of time over which this dose is to be administered as '4 HOURS', '7 DAYS', '2 WEEKS', or '1 MONTH'.
"DATA",101.41,612,10,12,2)
^^^FOR
"DATA",101.41,612,10,12,3)
I $$ASKDUR^ORCDPS3
"DATA",101.41,612,10,12,5)
D DUR^ORCDPS3
"DATA",101.41,612,10,12,7)
Q  I $G(ORTYPE)'="Z",$G(ORCAT)="I",$G(ORCOMPLX),$P($G(ORSD),U,3) S Y=+$P(ORSD,U,3)_" DAYS"
"DATA",101.41,612,10,13,0)
4^6^^Start: ^^^^1^C
"DATA",101.41,612,10,13,1)
Enter the date this order should begin.
"DATA",101.41,612,10,13,3)
I $G(ORCAT)="O",$G(OREVENT) ;discharge orders only
"DATA",101.41,612,10,13,7)
Q  I $G(ORTYPE)'="Z",ORCAT'="O" S Y=$P($G(ORSD),U) K:'$L(Y) Y
"DATA",101.41,612,10,13,9)
D START^ORCDPS3 ;I 'FIRST,$G(ORDIALOG(PROMPT,"LIST")),'$O(ORDIALOG(PROMPT,0)) D LIST^ORCD ;editonly
"DATA",101.41,612,10,14,0)
3^614^^Text: 
"DATA",101.41,612,10,14,2)
2^^^^^1^0
"DATA",101.41,612,10,14,3)
I 0 ;created by Instructions, if Outpt order
"DATA",101.41,612,10,15,0)
2.5^615^^^^^^^*^^136
"DATA",101.41,612,10,15,2)
^@
"DATA",101.41,612,10,15,3)
I 0 ;created by Instructions
"DATA",101.41,612,10,15,7)
S Y=$$ID^ORCDPS K:'$L(Y) Y
"DATA",101.41,612,10,16,0)
2.6^138^^^^^^^*
"DATA",101.41,612,10,16,3)
I 0 ;created by Instructions
"DATA",101.41,612,10,17,0)
5^616^^^^1^^^C
"DATA",101.41,612,10,17,1)
Enter the number of days for which the patient needs this medication.
"DATA",101.41,612,10,17,3)
I $G(ORCAT)="O"
"DATA",101.41,612,10,17,5)
I $G(ORESET),+ORESET'=+Y D CHANGED^ORCDPS1("DS")
"DATA",101.41,612,10,17,9)
I $G(ORCAT)="O" D DSUP^ORCDPS1
"DATA",101.41,612,10,17,10)
S:$G(ORCAT)="O" ORDSUP=+$G(ORDIALOG(PROMPT,INST))
"DATA",101.41,612,10,18,0)
1.5^618
"DATA",101.41,612,10,18,2)
1.5
"DATA",101.41,612,10,18,3)
I 0 ;stuffed in via Instructions
"DATA",101.41,612,10,19,0)
2.4^617^^^^^^^C^^136
"DATA",101.41,612,10,19,1)
Enter AND if the next dose is to be administered concurrently with this one, or THEN if it is to follow after.
"DATA",101.41,612,10,19,3)
I $G(ORCOMPLX)
"DATA",101.41,612,10,19,5)
I $G(ORESET)'=$P(Y,U) D CHANGED^ORCDPS1("QUANTITY")
"DATA",101.41,612,10,19,9)
D ENCONJ^ORCDPS1
"DATA",101.41,612,10,19,10)
I $G(ORCOMPLX),'$L($G(ORDIALOG(PROMPT,INST))),FIRST S MAX=1 ;stop prompting dose multiple
"DATA",101.41,612,10,20,0)
3.5^1358^^^^^^^C
"DATA",101.41,612,10,20,2)
3
"DATA",101.41,612,10,20,3)
I 0 ;text stuffed via Entry Action
"DATA",101.41,612,10,20,9)
D PI^ORCDPS2
"DATA",101.41,612,10,21,0)
4.5^1359
"DATA",101.41,612,10,21,2)
10^^^First Dose^^1
"DATA",101.41,612,10,21,3)
I 0 ;set via Entry Action
"DATA",101.41,612,10,21,9)
D NOW^ORCDPS3
"DATA",101.41,612,99)
59060,54763
"DATA",8989.51,200,0)
OREVNT DEFAULT^Default Release Event^^^Release Event
"DATA",8989.51,200,1)
P^100.5^Enter a RELEASE EVENT for your default when writing new delayed orders.
"DATA",8989.51,200,20,0)
^8989.512^3^3^3020916^^^
"DATA",8989.51,200,20,1,0)
This parameter is used to provide a default Release Event in the event
"DATA",8989.51,200,20,2,0)
listbox presented when the user clicks on the 'Write Delayed Orders'
"DATA",8989.51,200,20,3,0)
button in CPRS GUI.
"DATA",8989.51,200,30,0)
^8989.513I^6^6
"DATA",8989.51,200,30,1,0)
1^200
"DATA",8989.51,200,30,2,0)
2^8930
"DATA",8989.51,200,30,3,0)
3^100.21
"DATA",8989.51,200,30,4,0)
4^44
"DATA",8989.51,200,30,5,0)
5^49
"DATA",8989.51,200,30,6,0)
6^4
"DATA",8989.51,4753,0)
OREVNT MANUAL RELEASE^Allow use of manual release option^^^Allow manual release
"DATA",8989.51,4753,1)
Y^^Enter "yes" to allow manual release of delayed orders.
"DATA",8989.51,4753,20,0)
^8989.512^5^5^3020913^^^^
"DATA",8989.51,4753,20,1,0)
This parameter will control the ability to use the release delayed orders 
"DATA",8989.51,4753,20,2,0)
action if the OREVNT MANUAL RELEASE CONTROL parameter is set to Parameter 
"DATA",8989.51,4753,20,3,0)
or Both (Parameter and Keys).  If set to No or left blank then manual 
"DATA",8989.51,4753,20,4,0)
release will not be allowed.  If set to Yes then the manual release 
"DATA",8989.51,4753,20,5,0)
action my abe used.
"DATA",8989.51,4753,30,0)
^8989.513I^7^7
"DATA",8989.51,4753,30,1,0)
1^200
"DATA",8989.51,4753,30,2,0)
2^8930
"DATA",8989.51,4753,30,3,0)
3^100.21
"DATA",8989.51,4753,30,4,0)
4^44
"DATA",8989.51,4753,30,5,0)
5^49
"DATA",8989.51,4753,30,6,0)
6^4
"DATA",8989.51,4753,30,7,0)
7^4.2
"DATA",8989.51,4754,0)
OREVNT MANUAL RELEASE CONTROL^Manual release control setting^^^Manual release controlled by
"DATA",8989.51,4754,1)
S^K:Keys Only (ORES/ORELSE);P:Manual Release Paramater Only (OREVENT MANUAL RELEASE);B:Both (K and P)^Select how the use of the manual release action should be controlled.
"DATA",8989.51,4754,20,0)
^^23^23^3020920^
"DATA",8989.51,4754,20,1,0)
This parameter defines how access to the manual release action is 
"DATA",8989.51,4754,20,2,0)
controlled.  There are three possible settings:
"DATA",8989.51,4754,20,3,0)
 
"DATA",8989.51,4754,20,4,0)
1: Keys Only - In this setting only holders of the ORES and ORELSE key 
"DATA",8989.51,4754,20,5,0)
may manually release a delayed order.  This is how the system previously 
"DATA",8989.51,4754,20,6,0)
controlled access to this action.  If the OREVNT MANUAL RELEASE CONTROL 
"DATA",8989.51,4754,20,7,0)
parameter is not set then this will be the default setting.
"DATA",8989.51,4754,20,8,0)
 
"DATA",8989.51,4754,20,9,0)
2: Manual Release Parameter Only - In this setting the OREVNT MANUAL 
"DATA",8989.51,4754,20,10,0)
RELEASE parameter controls who is allowed to manually release a delayed  
"DATA",8989.51,4754,20,11,0)
order.  The OREVNT MANUAL RELEASE parameter is distributed with no 
"DATA",8989.51,4754,20,12,0)
settings, which effectively denies access to manual release if the 
"DATA",8989.51,4754,20,13,0)
control parameter is set to P. In order to have the OREVNT MANUAL RELEASE
"DATA",8989.51,4754,20,14,0)
parameter control access to the manual release action you must set some
"DATA",8989.51,4754,20,15,0)
level of the parameter to a positive (YES) value.
"DATA",8989.51,4754,20,16,0)
 
"DATA",8989.51,4754,20,17,0)
3: Both Keys and Parameter - In this setting a check is first made to see 
"DATA",8989.51,4754,20,18,0)
if the user has either the ORES or ORELSE key.  If they do not then a 
"DATA",8989.51,4754,20,19,0)
check is made to see if the user will have access through the parameter 
"DATA",8989.51,4754,20,20,0)
settings.  In this setting, if the user does not hold either the ORES or 
"DATA",8989.51,4754,20,21,0)
ORELSE key they could still have access to the action based on your 
"DATA",8989.51,4754,20,22,0)
parameter settings, which may be more liberal than you'd like.  Be sure 
"DATA",8989.51,4754,20,23,0)
to check your settings.
"DATA",8989.51,4754,30,0)
^8989.513I^2^2
"DATA",8989.51,4754,30,1,0)
1^4
"DATA",8989.51,4754,30,2,0)
2^4.2
"DATA",8989.51,4755,0)
OREVNT COMMON LIST^List of common release events^1^Entry number^Release Event
"DATA",8989.51,4755,1)
P^100.5^Enter release event to be added to common list
"DATA",8989.51,4755,2)

"DATA",8989.51,4755,3)
I '$G(^(1))&('$D(^ORD(100.5,"DAD",Y)))
"DATA",8989.51,4755,6)
N^^
"DATA",8989.51,4755,7)

"DATA",8989.51,4755,20,0)
^8989.512^8^8^3020917^^^^
"DATA",8989.51,4755,20,1,0)
Release events defined by this parameter will appear first in the list 
"DATA",8989.51,4755,20,2,0)
box when the user is writing delayed orders.  These commonly used release 
"DATA",8989.51,4755,20,3,0)
events will appear above a line with the rest of the available release 
"DATA",8989.51,4755,20,4,0)
events appearing below the line.
"DATA",8989.51,4755,20,5,0)
 
"DATA",8989.51,4755,20,6,0)
Before the list is presented to the user events that are inactive and 
"DATA",8989.51,4755,20,7,0)
events that are inappropriate for display (for example, transfer types 
"DATA",8989.51,4755,20,8,0)
when the patient is still an outpatient) will be removed from the list.
"DATA",8989.51,4755,30,0)
^8989.513I^6^6
"DATA",8989.51,4755,30,1,0)
1^200
"DATA",8989.51,4755,30,2,0)
2^8930
"DATA",8989.51,4755,30,3,0)
3^100.21
"DATA",8989.51,4755,30,4,0)
4^44
"DATA",8989.51,4755,30,5,0)
5^49
"DATA",8989.51,4755,30,6,0)
6^4
"DATA",8989.51,4758,0)
OREVNT EXCLUDE DGRP^Excluded groups for copy active order^1^Entry Number^Display Group
"DATA",8989.51,4758,1)
P^100.98^enter display group
"DATA",8989.51,4758,6)
N
"DATA",8989.51,4758,20,0)
^8989.512^5^5^3020920^
"DATA",8989.51,4758,20,1,0)
If the "copy active orders" field of a release event is set to YES then 
"DATA",8989.51,4758,20,2,0)
any orders that belong to the display groups listed in this parameter 
"DATA",8989.51,4758,20,3,0)
will NOT be presented in the list of orders to copy.  This parameter 
"DATA",8989.51,4758,20,4,0)
allows you to screen certain types of orders from being copied when 
"DATA",8989.51,4758,20,5,0)
writing delayed orders.
"DATA",8989.51,4758,30,0)
^8989.513I^2^2
"DATA",8989.51,4758,30,1,0)
1^4
"DATA",8989.51,4758,30,2,0)
2^4.2
"DATA",8989.51,4759,0)
ORWOR PKI SITE^PKI Functionality Site Enabled^^^Yes/No
"DATA",8989.51,4759,1)
Y^Y:yes;N:no^Enter 'yes' to turn on PKI Digital Signature at site.
"DATA",8989.51,4759,20,0)
^8989.512^1^1^3021009^^^^
"DATA",8989.51,4759,20,1,0)
'Yes' indicates that PKI Digital Signature functionality is enabled.
"DATA",8989.51,4759,30,0)
^8989.513I^3^2
"DATA",8989.51,4759,30,2,0)
2^4
"DATA",8989.51,4759,30,3,0)
3^4.2
"DATA",8989.52,9,0)
ORP ORDER MISC^Miscellaneous OE/RR Definition^4.2
"DATA",8989.52,9,10,0)
^8989.521IA^16^14
"DATA",8989.52,9,10,1,0)
1^105
"DATA",8989.52,9,10,2,0)
3^187
"DATA",8989.52,9,10,3,0)
4^176
"DATA",8989.52,9,10,4,0)
5^107
"DATA",8989.52,9,10,5,0)
7^99
"DATA",8989.52,9,10,6,0)
8^180
"DATA",8989.52,9,10,7,0)
11^177
"DATA",8989.52,9,10,8,0)
12^104
"DATA",8989.52,9,10,9,0)
14^102
"DATA",8989.52,9,10,10,0)
16^224
"DATA",8989.52,9,10,11,0)
13^230
"DATA",8989.52,9,10,13,0)
15^250
"DATA",8989.52,9,10,14,0)
10^256
"DATA",8989.52,9,10,16,0)
2^265
"FIA",100)
ORDER
"FIA",100,0)
^OR(100,
"FIA",100,0,0)
100I
"FIA",100,0,1)
y^n^p^^^^n
"FIA",100,0,10)

"FIA",100,0,11)

"FIA",100,0,"RLRO")

"FIA",100,0,"VR")
3.0^OR
"FIA",100,100)
1
"FIA",100,100,.02)

"FIA",100,100,15)

"FIA",100,100,68)

"FIA",100.2)
OE/RR PATIENT EVENT
"FIA",100.2,0)
^ORE(100.2,
"FIA",100.2,0,0)
100.2IP
"FIA",100.2,0,1)
y^y^f^^^^n
"FIA",100.2,0,10)

"FIA",100.2,0,11)

"FIA",100.2,0,"RLRO")

"FIA",100.2,0,"VR")
3.0^OR
"FIA",100.2,100.2)
0
"FIA",100.2,100.25)
0
"FIA",100.2,100.26)
0
"FIA",100.2,100.27)
0
"FIA",100.5)
OE/RR RELEASE EVENTS
"FIA",100.5,0)
^ORD(100.5,
"FIA",100.5,0,0)
100.5I
"FIA",100.5,0,1)
y^n^p^^^^n
"FIA",100.5,0,10)

"FIA",100.5,0,11)

"FIA",100.5,0,"RLRO")

"FIA",100.5,0,"VR")
3.0^OR
"FIA",100.5,100.5)
1
"FIA",100.5,100.5,1)

"FIA",100.5,100.5,8)

"FIA",100.5,100.5,14)

"FIA",100.5,100.51)
1
"FIA",100.5,100.51,1)

"FIA",101.41)
ORDER DIALOG
"FIA",101.41,0)
^ORD(101.41,
"FIA",101.41,0,0)
101.41I
"FIA",101.41,0,1)
n^n^f^^y^^y^r^n
"FIA",101.41,0,10)

"FIA",101.41,0,11)
I $$DLGSEND^ORY141ED($P(^(0),U))
"FIA",101.41,0,"RLRO")

"FIA",101.41,0,"VR")
3.0^OR
"FIA",101.41,101.41)
0
"FIA",101.41,101.411)
0
"FIA",101.41,101.412)
0
"FIA",101.41,101.41218)
0
"FIA",101.41,101.415)
0
"FIA",101.41,101.416)
0
"FIA",101.41,101.4162)
0
"FIA",8989.51)
PARAMETER DEFINITION
"FIA",8989.51,0)
^XTV(8989.51,
"FIA",8989.51,0,0)
8989.51I
"FIA",8989.51,0,1)
n^y^f^^y^^y^r^n
"FIA",8989.51,0,10)

"FIA",8989.51,0,11)
I Y=200!(Y=4753)!(Y=4754)!(Y=4755)!(Y=4758)!(Y=4759)
"FIA",8989.51,0,"RLRO")

"FIA",8989.51,0,"VR")
3.0^OR
"FIA",8989.51,8989.51)
0
"FIA",8989.51,8989.512)
0
"FIA",8989.51,8989.513)
0
"FIA",8989.51,8989.514)
0
"FIA",8989.52)
PARAMETER TEMPLATE
"FIA",8989.52,0)
^XTV(8989.52,
"FIA",8989.52,0,0)
8989.52I
"FIA",8989.52,0,1)
n^n^f^^y^^y^r^n
"FIA",8989.52,0,10)

"FIA",8989.52,0,11)
I $P(^(0),U)="ORP ORDER MISC"
"FIA",8989.52,0,"RLRO")

"FIA",8989.52,0,"VR")
3.0^OR
"FIA",8989.52,8989.52)
0
"FIA",8989.52,8989.521)
0
"FRV1",101.41,"1,0",5)
IMAGING
"FRV1",101.41,"1,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"1,0",7)
RADIOLOGY/NUCLEAR MEDICINE
"FRV1",101.41,"1,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"1,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"1,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,10,0",2)
OR GTX PRE-OP SCHEDULED DATE/TIME
"FRV1",101.41,"1,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,11,0",2)
OR GTX PREGNANT
"FRV1",101.41,"1,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,12,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"1,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,13,0",2)
OR GTX YES/NO
"FRV1",101.41,"1,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,14,0",2)
OR GTX LOCATION
"FRV1",101.41,"1,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,15,0",2)
OR GTX PROVIDER
"FRV1",101.41,"1,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,2,0",2)
OR GTX MODIFIERS
"FRV1",101.41,"1,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,3,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"1,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,4,0",2)
OR GTX URGENCY
"FRV1",101.41,"1,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,5,0",2)
OR GTX IMAGING LOCATION
"FRV1",101.41,"1,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,6,0",2)
OR GTX MODE OF TRANSPORT
"FRV1",101.41,"1,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,7,0",2)
OR GTX CATEGORY
"FRV1",101.41,"1,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,8,0",2)
OR GTX CONTRACT/SHARING SOURCE
"FRV1",101.41,"1,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"1,10,9,0",2)
OR GTX RESEARCH SOURCE
"FRV1",101.41,"1,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"119,0",5)
M.A.S.
"FRV1",101.41,"119,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"119,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"119,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"119,10,1,0",2)
OR GTX EVENT
"FRV1",101.41,"119,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"119,10,2,0",2)
OR GTX TREATING SPECIALTY
"FRV1",101.41,"119,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"119,10,3,0",2)
OR GTX PROVIDER
"FRV1",101.41,"119,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"119,10,4,0",2)
OR GTX FREE TEXT 1
"FRV1",101.41,"119,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"119,10,5,0",2)
OR GTX PROVIDER 1
"FRV1",101.41,"119,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"120,0",5)
M.A.S.
"FRV1",101.41,"120,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"120,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"120,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"120,10,1,0",2)
OR GTX EVENT
"FRV1",101.41,"120,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"120,10,2,0",2)
OR GTX TREATING SPECIALTY
"FRV1",101.41,"120,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"120,10,3,0",2)
OR GTX PROVIDER
"FRV1",101.41,"120,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"120,10,4,0",2)
OR GTX FREE TEXT 1
"FRV1",101.41,"120,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"120,10,5,0",2)
OR GTX PROVIDER 1
"FRV1",101.41,"120,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"121,0",5)
M.A.S.
"FRV1",101.41,"121,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"121,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"121,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"121,10,1,0",2)
OR GTX EVENT
"FRV1",101.41,"121,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"121,10,2,0",2)
OR GTX MOVEMENT TYPE
"FRV1",101.41,"121,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"121,10,3,0",2)
OR GTX FREE TEXT 1
"FRV1",101.41,"121,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"122,0",5)
M.A.S.
"FRV1",101.41,"122,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"122,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"122,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"122,10,1,0",2)
OR GTX EVENT
"FRV1",101.41,"122,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"122,10,2,0",2)
OR GTX FREE TEXT 1
"FRV1",101.41,"122,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,0",5)
UNIT DOSE MEDICATIONS
"FRV1",101.41,"129,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"129,0",7)
INPATIENT MEDICATIONS
"FRV1",101.41,"129,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"129,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"129,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,10,0",2)
OR GTX REFILLS
"FRV1",101.41,"129,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,11,0",2)
OR GTX SERVICE CONNECTED
"FRV1",101.41,"129,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,12,0",2)
OR GTX DURATION
"FRV1",101.41,"129,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,12,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,12,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"129,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"129,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"129,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"129,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,17,0",2)
OR GTX DAYS SUPPLY
"FRV1",101.41,"129,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"129,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,19,0",2)
OR GTX AND/THEN
"FRV1",101.41,"129,10,19,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,19,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,19,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"129,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,21,0",2)
OR GTX NOW
"FRV1",101.41,"129,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"129,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"129,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"129,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,5,0",2)
OR GTX URGENCY
"FRV1",101.41,"129,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"129,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"129,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"129,10,7,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,8,0",2)
OR GTX QUANTITY
"FRV1",101.41,"129,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"129,10,9,0",2)
OR GTX ROUTING
"FRV1",101.41,"129,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,0",5)
OUTPATIENT MEDICATIONS
"FRV1",101.41,"147,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"147,0",7)
OUTPATIENT PHARMACY
"FRV1",101.41,"147,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"147,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"147,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,10,0",2)
OR GTX REFILLS
"FRV1",101.41,"147,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,11,0",2)
OR GTX SERVICE CONNECTED
"FRV1",101.41,"147,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,12,0",2)
OR GTX DURATION
"FRV1",101.41,"147,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,12,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,12,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"147,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"147,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"147,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"147,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,17,0",2)
OR GTX DAYS SUPPLY
"FRV1",101.41,"147,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"147,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,19,0",2)
OR GTX AND/THEN
"FRV1",101.41,"147,10,19,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,19,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,19,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"147,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,21,0",2)
OR GTX NOW
"FRV1",101.41,"147,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"147,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"147,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"147,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,5,0",2)
OR GTX URGENCY
"FRV1",101.41,"147,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"147,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"147,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"147,10,7,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,8,0",2)
OR GTX QUANTITY
"FRV1",101.41,"147,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"147,10,9,0",2)
OR GTX ROUTING
"FRV1",101.41,"147,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,0",5)
SUPPLIES/DEVICES
"FRV1",101.41,"171,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"171,0",7)
OUTPATIENT PHARMACY
"FRV1",101.41,"171,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"171,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"171,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,10,0",2)
OR GTX REFILLS
"FRV1",101.41,"171,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,11,0",2)
OR GTX SERVICE CONNECTED
"FRV1",101.41,"171,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,12,0",2)
OR GTX DURATION
"FRV1",101.41,"171,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,12,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,12,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"171,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"171,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"171,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"171,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,17,0",2)
OR GTX DAYS SUPPLY
"FRV1",101.41,"171,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"171,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,19,0",2)
OR GTX AND/THEN
"FRV1",101.41,"171,10,19,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,19,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,19,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"171,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,21,0",2)
OR GTX NOW
"FRV1",101.41,"171,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"171,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"171,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"171,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,5,0",2)
OR GTX URGENCY
"FRV1",101.41,"171,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"171,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"171,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"171,10,7,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,8,0",2)
OR GTX QUANTITY
"FRV1",101.41,"171,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"171,10,9,0",2)
OR GTX ROUTING
"FRV1",101.41,"171,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,0",5)
LABORATORY
"FRV1",101.41,"2,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"2,0",7)
LAB SERVICE
"FRV1",101.41,"2,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"2,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"2,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,10,0",2)
OR GTX DURATION
"FRV1",101.41,"2,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,3,0",2)
OR GTX COLLECTION TYPE
"FRV1",101.41,"2,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,4,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"2,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,5,0",2)
OR GTX ADMIN SCHEDULE
"FRV1",101.41,"2,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,6,0",2)
OR GTX LAB URGENCY
"FRV1",101.41,"2,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,7,0",2)
OR GTX COLLECTION SAMPLE
"FRV1",101.41,"2,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,8,0",2)
OR GTX SPECIMEN
"FRV1",101.41,"2,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"2,10,9,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"2,10,9,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,0",5)
PHARMACY
"FRV1",101.41,"612,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"612,0",7)
PHARMACY DATA MANAGEMENT
"FRV1",101.41,"612,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"612,10,1,0",2)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"612,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,10,0",2)
OR GTX REFILLS
"FRV1",101.41,"612,10,10,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,11,0",2)
OR GTX SERVICE CONNECTED
"FRV1",101.41,"612,10,11,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,12,0",2)
OR GTX DURATION
"FRV1",101.41,"612,10,12,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,12,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,12,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,13,0",2)
OR GTX START DATE/TIME
"FRV1",101.41,"612,10,13,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,14,0",2)
OR GTX SIG
"FRV1",101.41,"612,10,14,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,15,0",2)
OR GTX DOSE
"FRV1",101.41,"612,10,15,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,15,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,15,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,16,0",2)
OR GTX DISPENSE DRUG
"FRV1",101.41,"612,10,16,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,17,0",2)
OR GTX DAYS SUPPLY
"FRV1",101.41,"612,10,17,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,18,0",2)
OR GTX DRUG NAME
"FRV1",101.41,"612,10,18,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,19,0",2)
OR GTX AND/THEN
"FRV1",101.41,"612,10,19,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,19,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,19,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,2,0",2)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,20,0",2)
OR GTX PATIENT INSTRUCTIONS
"FRV1",101.41,"612,10,20,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,21,0",2)
OR GTX NOW
"FRV1",101.41,"612,10,21,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,3,0",2)
OR GTX ROUTE
"FRV1",101.41,"612,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,3,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,3,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,4,0",2)
OR GTX SCHEDULE
"FRV1",101.41,"612,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,4,0",11)
OR GTX INSTRUCTIONS
"FRV1",101.41,"612,10,4,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,5,0",2)
OR GTX URGENCY
"FRV1",101.41,"612,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,6,0",2)
OR GTX WORD PROCESSING 1
"FRV1",101.41,"612,10,6,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,7,0",2)
OR GTX STRENGTH
"FRV1",101.41,"612,10,7,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,7,0",11)
OR GTX ORDERABLE ITEM
"FRV1",101.41,"612,10,7,0",11,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,8,0",2)
OR GTX QUANTITY
"FRV1",101.41,"612,10,8,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"612,10,9,0",2)
OR GTX ROUTING
"FRV1",101.41,"612,10,9,0",2,"F")
;ORD(101.41,
"FRV1",8989.52,"9,0",3)
DOMAIN
"FRV1",8989.52,"9,0",3,"F")
;DIC(
"FRV1",8989.52,"9,10,1,0",2)
ORPF ACTIVE ORDERS CONTEXT HRS
"FRV1",8989.52,"9,10,1,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,10,0",2)
OR SIGNED ON CHART
"FRV1",8989.52,"9,10,10,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,11,0",2)
ORPF SHOW LAB #
"FRV1",8989.52,"9,10,11,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,13,0",2)
OR SIGNATURE DEFAULT ACTION
"FRV1",8989.52,"9,10,13,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,14,0",2)
ORPF NEW ORDERS DEFAULT
"FRV1",8989.52,"9,10,14,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,16,0",2)
OR OREMAS MED ORDERS
"FRV1",8989.52,"9,10,16,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,2,0",2)
ORPF AUTO UNFLAG
"FRV1",8989.52,"9,10,2,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,3,0",2)
ORPF CONFIRM PROVIDER
"FRV1",8989.52,"9,10,3,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,4,0",2)
ORPF DEFAULT PROVIDER
"FRV1",8989.52,"9,10,4,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,5,0",2)
ORPF ERROR DAYS
"FRV1",8989.52,"9,10,5,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,6,0",2)
ORPF GRACE DAYS BEFORE PURGE
"FRV1",8989.52,"9,10,6,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,7,0",2)
ORPF RESTRICT REQUESTOR
"FRV1",8989.52,"9,10,7,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,8,0",2)
ORPF REVIEW ON PATIENT MVMT
"FRV1",8989.52,"9,10,8,0",2,"F")
;XTV(8989.51,
"FRV1",8989.52,"9,10,9,0",2)
ORPF SHOW STATUS DESCRIPTION
"FRV1",8989.52,"9,10,9,0",2,"F")
;XTV(8989.51,
"INI")
PRE^ORY141
"INIT")
POST^ORY141
"IX",100,100,"AEVNT",0)
100^AEVNT^Orders delayed for release until Event occurs^R^^R^IR^I^100^^^^^S
"IX",100,100,"AEVNT",1)
S ^OR(100,"AEVNT",X(1),X(2),DA)=""
"IX",100,100,"AEVNT",2)
K ^OR(100,"AEVNT",X(1),X(2),DA)
"IX",100,100,"AEVNT",2.5)
K ^OR(100,"AEVNT")
"IX",100,100,"AEVNT",11.1,0)
^.114IA^2^2
"IX",100,100,"AEVNT",11.1,1,0)
1^F^100^.02^^1^F
"IX",100,100,"AEVNT",11.1,1,3)

"IX",100,100,"AEVNT",11.1,2,0)
2^F^100^15^^2^F
"IX",100,100,"AEVNT",11.1,2,3)

"IX",100.2,100.2,"AC",0)
100.2^AC^Processed events by patient, reverse date/time^R^^R^IR^I^100.2^^^^^S
"IX",100.2,100.2,"AC",1)
S ^ORE(100.2,"AC",X(1),X(2),DA)=""
"IX",100.2,100.2,"AC",2)
K ^ORE(100.2,"AC",X(1),X(2),DA)
"IX",100.2,100.2,"AC",2.5)
K ^ORE(100.2,"AC")
"IX",100.2,100.2,"AC",11.1,0)
^.114IA^2^2
"IX",100.2,100.2,"AC",11.1,1,0)
1^F^100.2^.01^^1^F
"IX",100.2,100.2,"AC",11.1,1,3)

"IX",100.2,100.2,"AC",11.1,2,0)
2^F^100.2^11^^2^F
"IX",100.2,100.2,"AC",11.1,2,2)
S X=9999999-X
"IX",100.2,100.2,"AC",11.1,2,3)

"IX",100.2,100.2,"ADT",0)
100.2^ADT^Activity on MAS movements^MU^^R^IR^I^100.2^^^^^S
"IX",100.2,100.2,"ADT",1)
N I,XD S I=0 F  S I=+$O(^ORE(100.2,DA,10,I)) Q:I<1  S XD=+$P($G(^(I,0)),U) S:XD ^ORE(100.2,"ADT",X(1),XD,DA,I)=""
"IX",100.2,100.2,"ADT",2)
N I,XD S I=0 F  S I=+$O(^ORE(100.2,DA,10,I)) Q:I<1  S XD=+$P($G(^(I,0)),U) K:XD ^ORE(100.2,"ADT",X(1),XD,DA,I)
"IX",100.2,100.2,"ADT",2.5)
K ^ORE(100.2,"ADT")
"IX",100.2,100.2,"ADT",11.1,0)
^.114IA^1^1
"IX",100.2,100.2,"ADT",11.1,1,0)
1^F^100.2^12^^1^F
"IX",100.2,100.2,"ADT",11.1,1,3)

"IX",100.2,100.2,"AE",0)
100.2^AE^Pending events by patient^R^^R^IR^I^100.2^^^^^S
"IX",100.2,100.2,"AE",1)
S ^ORE(100.2,"AE",X(1),X(2),DA)=""
"IX",100.2,100.2,"AE",1.4)
S X=$S(X(3):0,1:1)
"IX",100.2,100.2,"AE",2)
K ^ORE(100.2,"AE",X(1),X(2),DA)
"IX",100.2,100.2,"AE",2.4)
S X=$S(X(3):0,1:1)
"IX",100.2,100.2,"AE",2.5)
K ^ORE(100.2,"AE")
"IX",100.2,100.2,"AE",11.1,0)
^.114IA^3^3
"IX",100.2,100.2,"AE",11.1,1,0)
1^F^100.2^.01^^1^F
"IX",100.2,100.2,"AE",11.1,1,3)

"IX",100.2,100.2,"AE",11.1,2,0)
2^F^100.2^2^^2^F
"IX",100.2,100.2,"AE",11.1,2,3)

"IX",100.2,100.2,"AE",11.1,3,0)
3^F^100.2^11^^^F
"IX",100.2,100.2,"AE",11.1,3,3)

"IX",100.5,100.5,"C",0)
100.5^C^Active events^MU^^R^IR^I^100.5^^^^^LS
"IX",100.5,100.5,"C",1)
S ^ORD(100.5,"C",$$UP^XLFSTR($E(X(1),1,60)),DA)=""
"IX",100.5,100.5,"C",1.4)
S X=$S(X(2):0,1:1)
"IX",100.5,100.5,"C",2)
K ^ORD(100.5,"C",$$UP^XLFSTR($E(X(1),1,60)),DA)
"IX",100.5,100.5,"C",2.4)
S X=$S(X(2):0,1:1)
"IX",100.5,100.5,"C",2.5)
K ^ORD(100.5,"C")
"IX",100.5,100.5,"C",11.1,0)
^.114IA^2^2
"IX",100.5,100.5,"C",11.1,1,0)
1^F^100.5^8^60^1^F
"IX",100.5,100.5,"C",11.1,2,0)
2^F^100.5^1^^^F
"KRN",.402,1977,-1)
0^2
"KRN",.402,1977,0)
OREV EVENT^3020911.1513^@^100.5^^@^3021016
"KRN",.402,1977,"DIAB",1,0,100.5,3)
3;"MANUAL RELEASE WITHIN DIVISION"
"KRN",.402,1977,"DIAB",3,0,100.5,2)
3;"ADMIT TO DIVISION"
"KRN",.402,1977,"DIAB",6,0,100.5,2)
3;"DISCHARGE FROM DIVISION"
"KRN",.402,1977,"DIAB",9,0,100.5,2)
3;"TRANSFER TO/WITHIN DIVISION"
"KRN",.402,1977,"DIAB",12,0,100.5,2)
3;"SURGERY WITHIN DIVISION"
"KRN",.402,1977,"DR",1,100.5)
I $G(^ORD(100.5,DA,1))&($G(NEW)) W !,"You will not be allowed to ^ out until the required fields are entered.",! S DIE("NO^")="NO EXIT, NO JUMP";I '$G(DIE("NO^"))="" S DIE("NO^")="OUTOK";.01;8;
"KRN",.402,1977,"DR",1,100.5,1)
I '$G(^ORD(100.5,DA,1)) W !!,"The TYPE OF EVENT and DIVISION fields can only be edited",!,"when the entry is inactive.",! S Y="@6";2;S ETYPE=$P($G(^ORD(100.5,DA,0)),U,2);
"KRN",.402,1977,"DR",1,100.5,2)
S Y=$S(ETYPE="A":"@1",ETYPE="D":"@2",ETYPE="T":"@3",ETYPE="O":"@4",1:"@5");@1;3ADMIT TO DIVISION~;S Y="@6";@2;3DISCHARGE FROM DIVISION~;S Y="@6";@3;3TRANSFER TO/WITHIN DIVISION~;S Y="@6";@4;3SURGERY WITHIN DIVISION~;S Y="@6";@5;
"KRN",.402,1977,"DR",1,100.5,3)
3MANUAL RELEASE WITHIN DIVISION~;@6;I "^A^T^D^"'[("^"_$P($G(^ORD(100.5,DA,0)),U,2)_"^") S Y="@7";7;@7;S ATS=0;I "^A^T^"'[("^"_$P($G(^ORD(100.5,DA,0)),U,2)_"^") S Y="@9";
"KRN",.402,1977,"DR",1,100.5,4)
I "^1^2^3^"[("^"_$P($G(^ORD(100.5,DA,0)),U,7)_"^") D DELMUL^OREV1(100.5,DA,"""LOC"""),DELMUL^OREV1(100.5,DA,"""TS""") S Y="@9";I "^22^23^24^"[("^"_$P($G(^ORD(100.5,DA,0)),U,7)_"^") D DELMUL^OREV1(100.5,DA,"""LOC""") S ATS=1;10;
"KRN",.402,1977,"DR",1,100.5,5)
I $G(ATS) S Y="@8";11;@8;I $G(ORTYPE)'="" S REQD=$$HASREQD^OREV1() I 'REQD S DIE("NO^")="NO EXIT, NO JUMP" W !!,"Locations or treating specialties must be entered for this event type.",! S Y="@7";
"KRN",.402,1977,"DR",1,100.5,6)
I $G(REQD)=2 W !!,"*Warning: You have defined locations and treating specialties for this event.",!,"As such, both must be true for orders to be released.  Be sure this is what you want.";@9;
"KRN",.402,1977,"DR",1,100.5,7)
I $G(NEW) W !!,"You have now entered the required fields and may ^ to exit.",! S DIE("NO^")="OUTOK";.1;4;5;6;9;13;D EDITPAR^XPAREDIT("ORWDX WRITE ORDERS EVENT LIST");
"KRN",.402,1977,"DR",2,100.51)
.01;1;
"KRN",.402,1977,"DR",2,100.511)
.01;
"KRN",.402,1978,-1)
0^3
"KRN",.402,1978,0)
OREV AUTO DC^3021028.1353^@^100.6^^@^3021028
"KRN",.402,1978,"DIAB",1,0,100.6,2)
3;"ADMIT TO DIVISION"
"KRN",.402,1978,"DIAB",4,0,100.6,2)
3;"DISCHARGE FROM DIVISION"
"KRN",.402,1978,"DIAB",7,0,100.6,2)
3;"TRANSFER TO/WITHIN DIVISION"
"KRN",.402,1978,"DIAB",10,0,100.6,2)
3;"SURGERY WITHIN DIVISION"
"KRN",.402,1978,"DIAB",13,0,100.6,2)
3;"T.S. CHANGE WITHIN DIVISION"
"KRN",.402,1978,"DR",1,100.6)
I $G(^ORD(100.6,DA,1))&($G(NEW)) W !,"You will not be allowed to ^ out until the required fields are entered.",! S DIE("NO^")="NO EXIT, NO JUMP";S:$G(DIE("NO^"))="" DIE("NO^")="OUTOK";.01;5;S ETYPE=$P($G(^ORD(100.6,DA,0)),U,2);
"KRN",.402,1978,"DR",1,100.6,1)
I '$G(^ORD(100.6,DA,1)) W !!,"The TYPE OF EVENT, MAS MOVEMENT TYPE, and DIVISION fields can only be",!,"edited when the entry is inactive.",! S Y="@8";2;S Y=$S(ETYPE="A":"@1",ETYPE="D":"@2",ETYPE="T":"@3",ETYPE="O":"@4",1:"@5");@1;
"KRN",.402,1978,"DR",1,100.6,2)
3ADMIT TO DIVISION~;S Y="@6";@2;3DISCHARGE FROM DIVISION~;S Y="@6";@3;3TRANSFER TO/WITHIN DIVISION~;S Y="@6";@4;3SURGERY WITHIN DIVISION~;S Y="@6";@5;3T.S. CHANGE WITHIN DIVISION~;@6;I ETYPE="O" S Y="@8";@7;30;
"KRN",.402,1978,"DR",1,100.6,3)
S REQD=$$HASREQD^OREV1() I REQD=0!(REQD=2) S DIE("NO^")="NO EXIT, NO JUMP";I REQD=0 W !!,"MAS MOVEMENT TYPE is required for this type of event.",! S Y="@7";
"KRN",.402,1978,"DR",1,100.6,4)
I REQD=2 W !!,"Interward Transfer may not be used with any other type of transfer.",!,"Either delete it or delete the additional entries",! S Y="@7";@8;
"KRN",.402,1978,"DR",1,100.6,5)
I $G(NEW) W !!,"You have now entered the required fields and may ^ to exit.",! S DIE("NO^")="OUTOK";I "^D^T^"'[("^"_ETYPE_"^")!('$$ASKOBS^OREV1) S Y="@9";6;@9;4;I ETYPE'="S" S Y="@10";40;@10;
"KRN",.402,1978,"DR",1,100.6,6)
I ETYPE'="T"!(ETYPE="T"&('$$IWT^OREV2(DA))) S Y="@13";50;60;@13;70;100;80;
"KRN",.402,1978,"DR",2,100.62)
.01;S DIE("NO^")="NO EXIT, NO JUMP";1;I X=1 S Y="@11";2;@11;3;I X=1 S Y="@12";4;@12;S DIEFIRE="L";S DIE("NO^")="OUTOK";D FROMTO^OREV4("L",DA(1),DA);
"KRN",.402,1978,"DR",2,100.63)
.01;
"KRN",.402,1978,"DR",2,100.64)
.01:1;D FROMTO^OREV4("S",DA(1),DA);
"KRN",.402,1978,"DR",2,100.65)
.01;
"KRN",.402,1978,"DR",2,100.66)
.01;
"KRN",.402,1978,"DR",2,100.67)
.01;
"KRN",.402,1978,"DR",2,100.68)
.01;
"KRN",.402,1978,"DR",3,100.641)
.01
"KRN",.402,1979,-1)
0^1
"KRN",.402,1979,0)
OREV CHILD EVENT^3020828.1458^@^100.5^^@^3020913
"KRN",.402,1979,"DR",1,100.5)
I $G(NEW) W !!,"You will not be allowed to ^ out until the required fields are entered.",! S DIE("NO^")="NO EXIT, NO JUMP";.01;8;I $G(NEW) W !!,"You have now entered the required fields and may ^ to exit.",! S DIE("NO^")="OUTOK";5;
"KRN",.402,1979,"DR",1,100.5,1)
.1;13;9;D EDITPAR^XPAREDIT("ORWDX WRITE ORDERS EVENT LIST");
"KRN",19,10082,-1)
0^2
"KRN",19,10082,0)
OR CPRS GUI CHART^CPRSChart version 1.0.20.21^^B^^^^^^^^
"KRN",19,10082,1,0)
^19.06^2^2^3020906^^^^
"KRN",19,10082,1,1,0)
This option is required by the Kernel Broker to give access to the
"KRN",19,10082,1,2,0)
RPCs used by the CPRS GUI (CPRSChart.EXE).
"KRN",19,10082,99.1)
59122,48366
"KRN",19,10082,"RPC",0)
^19.05P^1843^1843
"KRN",19,10082,"RPC",1,0)
GMRC LIST CONSULT REQUESTS
"KRN",19,10082,"RPC",218,0)
XWB GET VARIABLE VALUE
"KRN",19,10082,"RPC",219,0)
TIU AUTHORIZATION
"KRN",19,10082,"RPC",220,0)
TIU CAN CHANGE COSIGNER?
"KRN",19,10082,"RPC",221,0)
TIU CREATE ADDENDUM RECORD
"KRN",19,10082,"RPC",222,0)
TIU CREATE RECORD
"KRN",19,10082,"RPC",223,0)
TIU DELETE RECORD
"KRN",19,10082,"RPC",224,0)
TIU DETAILED DISPLAY
"KRN",19,10082,"RPC",225,0)
TIU DOCUMENTS BY CONTEXT
"KRN",19,10082,"RPC",226,0)
TIU GET ADDITIONAL SIGNERS
"KRN",19,10082,"RPC",227,0)
TIU GET ALERT INFO
"KRN",19,10082,"RPC",228,0)
TIU GET DOCUMENT PARAMETERS
"KRN",19,10082,"RPC",229,0)
TIU GET DS TITLES
"KRN",19,10082,"RPC",230,0)
TIU GET DS URGENCIES
"KRN",19,10082,"RPC",231,0)
TIU GET PERSONAL PREFERENCES
"KRN",19,10082,"RPC",232,0)
TIU GET PN TITLES
"KRN",19,10082,"RPC",233,0)
TIU GET RECORD TEXT
"KRN",19,10082,"RPC",234,0)
TIU IDENTIFY CONSULTS CLASS
"KRN",19,10082,"RPC",235,0)
TIU IS THIS A CONSULT?
"KRN",19,10082,"RPC",236,0)
TIU JUSTIFY DELETE?
"KRN",19,10082,"RPC",237,0)
TIU LOAD BOILERPLATE TEXT
"KRN",19,10082,"RPC",238,0)
TIU LOAD RECORD FOR EDIT
"KRN",19,10082,"RPC",239,0)
TIU LOCK RECORD
"KRN",19,10082,"RPC",240,0)
TIU LONG LIST CONSULT TITLES
"KRN",19,10082,"RPC",241,0)
TIU LONG LIST OF TITLES
"KRN",19,10082,"RPC",242,0)
TIU NOTES
"KRN",19,10082,"RPC",243,0)
TIU NOTES 16 BIT
"KRN",19,10082,"RPC",244,0)
TIU NOTES BY VISIT
"KRN",19,10082,"RPC",245,0)
TIU PERSONAL TITLE LIST
"KRN",19,10082,"RPC",246,0)
TIU PRINT RECORD
"KRN",19,10082,"RPC",247,0)
TIU REQUIRES COSIGNATURE
"KRN",19,10082,"RPC",248,0)
TIU SIGN RECORD
"KRN",19,10082,"RPC",249,0)
TIU SUMMARIES
"KRN",19,10082,"RPC",250,0)
TIU SUMMARIES BY VISIT
"KRN",19,10082,"RPC",251,0)
TIU UNLOCK RECORD
"KRN",19,10082,"RPC",252,0)
TIU UPDATE ADDITIONAL SIGNERS
"KRN",19,10082,"RPC",253,0)
TIU UPDATE RECORD
"KRN",19,10082,"RPC",254,0)
TIU WHICH SIGNATURE ACTION
"KRN",19,10082,"RPC",1032,0)
ORB DELETE ALERT
"KRN",19,10082,"RPC",1033,0)
ORB FOLLOW-UP ARRAY
"KRN",19,10082,"RPC",1034,0)
ORB FOLLOW-UP STRING
"KRN",19,10082,"RPC",1035,0)
ORB FOLLOW-UP TYPE
"KRN",19,10082,"RPC",1036,0)
ORB SORT METHOD
"KRN",19,10082,"RPC",1037,0)
ORK TRIGGER
"KRN",19,10082,"RPC",1038,0)
ORQ NULL LIST
"KRN",19,10082,"RPC",1039,0)
ORQOR DETAIL
"KRN",19,10082,"RPC",1040,0)
TIU TEMPLATE CHECK BOILERPLATE
"KRN",19,10082,"RPC",1041,0)
TIU TEMPLATE CREATE/MODIFY
"KRN",19,10082,"RPC",1042,0)
TIU TEMPLATE DELETE
"KRN",19,10082,"RPC",1045,0)
TIU TEMPLATE GETPROOT
"KRN",19,10082,"RPC",1049,0)
TIU TEMPLATE LISTOWNR
"KRN",19,10082,"RPC",1050,0)
TIU TEMPLATE SET ITEMS
"KRN",19,10082,"RPC",1051,0)
TIU GET LIST OF OBJECTS
"KRN",19,10082,"RPC",1052,0)
ORQOR LIST
"KRN",19,10082,"RPC",1053,0)
ORQORB SORT
"KRN",19,10082,"RPC",1054,0)
ORQPT ATTENDING/PRIMARY
"KRN",19,10082,"RPC",1055,0)
ORQPT CLINIC PATIENTS
"KRN",19,10082,"RPC",1056,0)
ORQPT CLINICS
"KRN",19,10082,"RPC",1057,0)
ORQPT DEFAULT LIST SOURCE
"KRN",19,10082,"RPC",1058,0)
ORQPT DEFAULT PATIENT LIST
"KRN",19,10082,"RPC",1059,0)
ORQPT PATIENT TEAM PROVIDERS
"KRN",19,10082,"RPC",1060,0)
ORQPT PROVIDER PATIENTS
"KRN",19,10082,"RPC",1061,0)
ORQPT PROVIDERS
"KRN",19,10082,"RPC",1062,0)
ORQPT SPECIALTIES
"KRN",19,10082,"RPC",1063,0)
ORQPT SPECIALTY PATIENTS
"KRN",19,10082,"RPC",1064,0)
ORQPT TEAM PATIENTS
"KRN",19,10082,"RPC",1065,0)
ORQPT TEAMS
"KRN",19,10082,"RPC",1066,0)
ORQPT WARD PATIENTS
"KRN",19,10082,"RPC",1067,0)
ORQPT WARDRMBED
"KRN",19,10082,"RPC",1068,0)
ORQPT WARDS
"KRN",19,10082,"RPC",1069,0)
ORQQAL DETAIL
"KRN",19,10082,"RPC",1070,0)
ORQQAL LIST
"KRN",19,10082,"RPC",1071,0)
ORQQAL LIST REPORT
"KRN",19,10082,"RPC",1072,0)
ORQQCN ADDCMT
"KRN",19,10082,"RPC",1073,0)
ORQQCN ADMIN COMPLETE
"KRN",19,10082,"RPC",1074,0)
ORQQCN DETAIL
"KRN",19,10082,"RPC",1075,0)
ORQQCN DISCONTINUE
"KRN",19,10082,"RPC",1076,0)
ORQQCN FIND CONSULT
"KRN",19,10082,"RPC",1077,0)
ORQQCN FORWARD
"KRN",19,10082,"RPC",1078,0)
ORQQCN GET CONSULT
"KRN",19,10082,"RPC",1079,0)
ORQQCN GET ORDER NUMBER
"KRN",19,10082,"RPC",1080,0)
ORQQCN GET PROC SVCS
"KRN",19,10082,"RPC",1081,0)
ORQQCN LIST
"KRN",19,10082,"RPC",1082,0)
ORQQCN LOAD FOR EDIT
"KRN",19,10082,"RPC",1083,0)
ORQQCN MED RESULTS
"KRN",19,10082,"RPC",1084,0)
ORQQCN PRINT SF513
"KRN",19,10082,"RPC",1085,0)
ORQQCN RECEIVE
"KRN",19,10082,"RPC",1086,0)
ORQQCN RESUBMIT
"KRN",19,10082,"RPC",1087,0)
ORQQCN SET ACT MENUS
"KRN",19,10082,"RPC",1088,0)
ORQQCN SHOW SF513
"KRN",19,10082,"RPC",1089,0)
ORQQCN SIGFIND
"KRN",19,10082,"RPC",1090,0)
ORQQCN STATUS
"KRN",19,10082,"RPC",1091,0)
ORQQCN SVCLIST
"KRN",19,10082,"RPC",1092,0)
ORQQCN SVCTREE
"KRN",19,10082,"RPC",1093,0)
ORQQCN URGENCIES
"KRN",19,10082,"RPC",1094,0)
ORQQCN2 GET CONTEXT
"KRN",19,10082,"RPC",1095,0)
ORQQCN2 SAVE CONTEXT
"KRN",19,10082,"RPC",1096,0)
ORQQLR DETAIL
"KRN",19,10082,"RPC",1097,0)
ORQQLR SEARCH RANGE INPT
"KRN",19,10082,"RPC",1098,0)
ORQQLR SEARCH RANGE OUTPT
"KRN",19,10082,"RPC",1099,0)
ORQQPL ADD SAVE
"KRN",19,10082,"RPC",1100,0)
ORQQPL AUDIT HIST
"KRN",19,10082,"RPC",1101,0)
ORQQPL CHECK DUP
"KRN",19,10082,"RPC",1102,0)
ORQQPL CLIN FILTER LIST
"KRN",19,10082,"RPC",1103,0)
ORQQPL CLIN SRCH
"KRN",19,10082,"RPC",1104,0)
ORQQPL DELETE
"KRN",19,10082,"RPC",1105,0)
ORQQPL DETAIL
"KRN",19,10082,"RPC",1106,0)
ORQQPL EDIT LOAD
"KRN",19,10082,"RPC",1107,0)
ORQQPL EDIT SAVE
"KRN",19,10082,"RPC",1108,0)
ORQQPL INACTIVATE
"KRN",19,10082,"RPC",1109,0)
ORQQPL INIT PT
"KRN",19,10082,"RPC",1110,0)
ORQQPL INIT USER
"KRN",19,10082,"RPC",1111,0)
ORQQPL LIST
"KRN",19,10082,"RPC",1112,0)
ORQQPL PROB COMMENTS
"KRN",19,10082,"RPC",1113,0)
ORQQPL PROBLEM LEX SEARCH
"KRN",19,10082,"RPC",1114,0)
ORQQPL PROBLEM LIST
"KRN",19,10082,"RPC",1115,0)
ORQQPL PROV FILTER LIST
"KRN",19,10082,"RPC",1116,0)
ORQQPL PROVIDER LIST
"KRN",19,10082,"RPC",1117,0)
ORQQPL REPLACE
"KRN",19,10082,"RPC",1118,0)
ORQQPL SAVEVIEW
"KRN",19,10082,"RPC",1119,0)
ORQQPL SERV FILTER LIST
"KRN",19,10082,"RPC",1120,0)
ORQQPL SRVC SRCH
"KRN",19,10082,"RPC",1121,0)
ORQQPL UPDATE
"KRN",19,10082,"RPC",1122,0)
ORQQPL USER PROB CATS
"KRN",19,10082,"RPC",1123,0)
ORQQPL USER PROB LIST
"KRN",19,10082,"RPC",1124,0)
ORQQPL VERIFY
"KRN",19,10082,"RPC",1125,0)
ORQQPP LIST
"KRN",19,10082,"RPC",1126,0)
ORQQPS DETAIL
"KRN",19,10082,"RPC",1127,0)
ORQQPS LIST
"KRN",19,10082,"RPC",1133,0)
ORQQPX REMINDER DETAIL
"KRN",19,10082,"RPC",1135,0)
ORQQPX REMINDERS LIST
"KRN",19,10082,"RPC",1136,0)
ORQQVI NOTEVIT
"KRN",19,10082,"RPC",1137,0)
ORQQVI VITALS
"KRN",19,10082,"RPC",1138,0)
ORQQVI VITALS FOR DATE RANGE
"KRN",19,10082,"RPC",1139,0)
ORQQVI1 DETAIL
"KRN",19,10082,"RPC",1140,0)
ORQQVI1 GRID
"KRN",19,10082,"RPC",1141,0)
ORQQVI2 VITALS HELP
"KRN",19,10082,"RPC",1142,0)
ORQQVI2 VITALS RATE CHECK
"KRN",19,10082,"RPC",1144,0)
ORQQVI2 VITALS VAL & STORE
"KRN",19,10082,"RPC",1145,0)
ORQQVI2 VITALS VALIDATE
"KRN",19,10082,"RPC",1146,0)
ORQQVI2 VITALS VALIDATE TYPE
"KRN",19,10082,"RPC",1147,0)
ORQQVS DETAIL NOTES
"KRN",19,10082,"RPC",1148,0)
ORQQVS DETAIL SUMMARY
"KRN",19,10082,"RPC",1149,0)
ORQQVS VISITS/APPTS
"KRN",19,10082,"RPC",1150,0)
ORQQXMB MAIL GROUPS
"KRN",19,10082,"RPC",1151,0)
ORQQXQA PATIENT
"KRN",19,10082,"RPC",1152,0)
ORQQXQA USER
"KRN",19,10082,"RPC",1153,0)
ORWCH LOADALL
"KRN",19,10082,"RPC",1154,0)
ORWCH LOADSIZ
"KRN",19,10082,"RPC",1155,0)
ORWCH SAVEALL
"KRN",19,10082,"RPC",1156,0)
ORWCH SAVESIZ
"KRN",19,10082,"RPC",1157,0)
ORWCS LIST OF CONSULT REPORTS
"KRN",19,10082,"RPC",1158,0)
ORWCS PRINT REPORT
"KRN",19,10082,"RPC",1159,0)
ORWCS REPORT TEXT
"KRN",19,10082,"RPC",1160,0)
ORWCV DTLVST
"KRN",19,10082,"RPC",1161,0)
ORWCV LAB
"KRN",19,10082,"RPC",1162,0)
ORWCV POLL
"KRN",19,10082,"RPC",1163,0)
ORWCV START
"KRN",19,10082,"RPC",1164,0)
ORWCV STOP
"KRN",19,10082,"RPC",1165,0)
ORWCV VST
"KRN",19,10082,"RPC",1166,0)
ORWD DEF
"KRN",19,10082,"RPC",1167,0)
ORWD DT
"KRN",19,10082,"RPC",1168,0)
ORWD FORMID
"KRN",19,10082,"RPC",1169,0)
ORWD GET4EDIT
"KRN",19,10082,"RPC",1170,0)
ORWD KEY
"KRN",19,10082,"RPC",1171,0)
ORWD OI
"KRN",19,10082,"RPC",1172,0)
ORWD PROVKEY
"KRN",19,10082,"RPC",1173,0)
ORWD SAVE
"KRN",19,10082,"RPC",1174,0)
ORWD SAVEACT
"KRN",19,10082,"RPC",1175,0)
ORWD SIGN
"KRN",19,10082,"RPC",1176,0)
ORWD VALIDACT
"KRN",19,10082,"RPC",1177,0)
ORWD1 PARAM
"KRN",19,10082,"RPC",1178,0)
ORWD1 PRINTGUI
"KRN",19,10082,"RPC",1179,0)
ORWD1 RVPRINT
"KRN",19,10082,"RPC",1180,0)
ORWD2 DEVINFO
"KRN",19,10082,"RPC",1181,0)
ORWD2 MANUAL
"KRN",19,10082,"RPC",1182,0)
ORWDAL32 ALLERGY MATCH
"KRN",19,10082,"RPC",1183,0)
ORWDAL32 DEF
"KRN",19,10082,"RPC",1184,0)
ORWDAL32 SYMPTOMS
"KRN",19,10082,"RPC",1185,0)
ORWDCN32 DEF
"KRN",19,10082,"RPC",1186,0)
ORWDCN32 ORDRMSG
"KRN",19,10082,"RPC",1187,0)
ORWDCN32 PROCEDURES
"KRN",19,10082,"RPC",1188,0)
ORWDCSLT DEF
"KRN",19,10082,"RPC",1189,0)
ORWDCSLT LOOK200
"KRN",19,10082,"RPC",1190,0)
ORWDFH ADDLATE
"KRN",19,10082,"RPC",1191,0)
ORWDFH ATTR
"KRN",19,10082,"RPC",1192,0)
ORWDFH CURISO
"KRN",19,10082,"RPC",1193,0)
ORWDFH DIETS
"KRN",19,10082,"RPC",1194,0)
ORWDFH FINDTYP
"KRN",19,10082,"RPC",1195,0)
ORWDFH ISOIEN
"KRN",19,10082,"RPC",1196,0)
ORWDFH ISOLIST
"KRN",19,10082,"RPC",1197,0)
ORWDFH PARAM
"KRN",19,10082,"RPC",1198,0)
ORWDFH QTY2CC
"KRN",19,10082,"RPC",1199,0)
ORWDFH TFPROD
"KRN",19,10082,"RPC",1200,0)
ORWDFH TXT
"KRN",19,10082,"RPC",1201,0)
ORWDGX LOAD
"KRN",19,10082,"RPC",1202,0)
ORWDGX VMDEF
"KRN",19,10082,"RPC",1203,0)
ORWDLR ABBSPEC
"KRN",19,10082,"RPC",1204,0)
ORWDLR ALLSAMP
"KRN",19,10082,"RPC",1205,0)
ORWDLR DEF
"KRN",19,10082,"RPC",1206,0)
ORWDLR LOAD
"KRN",19,10082,"RPC",1207,0)
ORWDLR OIPARAM
"KRN",19,10082,"RPC",1208,0)
ORWDLR STOP
"KRN",19,10082,"RPC",1209,0)
ORWDLR32 ABBSPEC
"KRN",19,10082,"RPC",1210,0)
ORWDLR32 ALLSAMP
"KRN",19,10082,"RPC",1211,0)
ORWDLR32 ALLSPEC
"KRN",19,10082,"RPC",1212,0)
ORWDLR32 DEF
"KRN",19,10082,"RPC",1213,0)
ORWDLR32 IC DEFAULT
"KRN",19,10082,"RPC",1214,0)
ORWDLR32 IC VALID
"KRN",19,10082,"RPC",1215,0)
ORWDLR32 IMMED COLLECT
"KRN",19,10082,"RPC",1216,0)
ORWDLR32 LAB COLL TIME
"KRN",19,10082,"RPC",1217,0)
ORWDLR32 LOAD
"KRN",19,10082,"RPC",1218,0)
ORWDLR32 MAXDAYS
"KRN",19,10082,"RPC",1219,0)
ORWDLR32 ONE SAMPLE
"KRN",19,10082,"RPC",1220,0)
ORWDLR32 ONE SPECIMEN
"KRN",19,10082,"RPC",1221,0)
ORWDLR32 STOP
"KRN",19,10082,"RPC",1222,0)
ORWDOR VMSLCT
"KRN",19,10082,"RPC",1227,0)
ORWDPS32 ALLROUTE
"KRN",19,10082,"RPC",1228,0)
ORWDPS32 AUTH
"KRN",19,10082,"RPC",1229,0)
ORWDPS32 DLGSLCT
"KRN",19,10082,"RPC",1230,0)
ORWDPS32 DOSES
"KRN",19,10082,"RPC",1231,0)
ORWDPS32 DRUGMSG
"KRN",19,10082,"RPC",1232,0)
ORWDPS32 FORMALT
"KRN",19,10082,"RPC",1233,0)
ORWDPS32 ISSPLY
"KRN",19,10082,"RPC",1234,0)
ORWDPS32 IVAMT
"KRN",19,10082,"RPC",1235,0)
ORWDPS32 MEDISIV
"KRN",19,10082,"RPC",1236,0)
ORWDPS32 OISLCT
"KRN",19,10082,"RPC",1237,0)
ORWDPS32 SCSTS
"KRN",19,10082,"RPC",1238,0)
ORWDPS32 VALQTY
"KRN",19,10082,"RPC",1239,0)
ORWDPS32 VALRATE
"KRN",19,10082,"RPC",1240,0)
ORWDPS32 VALSCH
"KRN",19,10082,"RPC",1241,0)
ORWDRA DEF
"KRN",19,10082,"RPC",1242,0)
ORWDRA32 APPROVAL
"KRN",19,10082,"RPC",1243,0)
ORWDRA32 DEF
"KRN",19,10082,"RPC",1244,0)
ORWDRA32 IMTYPSEL
"KRN",19,10082,"RPC",1245,0)
ORWDRA32 ISOLATN
"KRN",19,10082,"RPC",1246,0)
ORWDRA32 LOCTYPE
"KRN",19,10082,"RPC",1247,0)
ORWDRA32 PROCMSG
"KRN",19,10082,"RPC",1248,0)
ORWDRA32 RADSRC
"KRN",19,10082,"RPC",1249,0)
ORWDRA32 RAORDITM
"KRN",19,10082,"RPC",1250,0)
ORWDX AGAIN
"KRN",19,10082,"RPC",1251,0)
ORWDX DGRP
"KRN",19,10082,"RPC",1252,0)
ORWDX DISMSG
"KRN",19,10082,"RPC",1253,0)
ORWDX DLGDEF
"KRN",19,10082,"RPC",1254,0)
ORWDX DLGID
"KRN",19,10082,"RPC",1255,0)
ORWDX DLGQUIK
"KRN",19,10082,"RPC",1256,0)
ORWDX FORMID
"KRN",19,10082,"RPC",1257,0)
ORWDX LOADRSP
"KRN",19,10082,"RPC",1258,0)
ORWDX LOCK
"KRN",19,10082,"RPC",1259,0)
ORWDX MSG
"KRN",19,10082,"RPC",1260,0)
ORWDX ORDITM
"KRN",19,10082,"RPC",1261,0)
ORWDX SAVE
"KRN",19,10082,"RPC",1262,0)
ORWDX SEND
"KRN",19,10082,"RPC",1263,0)
ORWDX SENDP
"KRN",19,10082,"RPC",1264,0)
ORWDX UNLOCK
"KRN",19,10082,"RPC",1265,0)
ORWDX WRLST
"KRN",19,10082,"RPC",1266,0)
ORWDXA ALERT
"KRN",19,10082,"RPC",1267,0)
ORWDXA COMPLETE
"KRN",19,10082,"RPC",1268,0)
ORWDXA DC
"KRN",19,10082,"RPC",1269,0)
ORWDXA DCREASON
"KRN",19,10082,"RPC",1270,0)
ORWDXA DCREQIEN
"KRN",19,10082,"RPC",1271,0)
ORWDXA FLAG
"KRN",19,10082,"RPC",1272,0)
ORWDXA FLAGTXT
"KRN",19,10082,"RPC",1273,0)
ORWDXA HOLD
"KRN",19,10082,"RPC",1274,0)
ORWDXA UNFLAG
"KRN",19,10082,"RPC",1275,0)
ORWDXA UNHOLD
"KRN",19,10082,"RPC",1276,0)
ORWDXA VALID
"KRN",19,10082,"RPC",1277,0)
ORWDXA VERIFY
"KRN",19,10082,"RPC",1278,0)
ORWDXA WCGET
"KRN",19,10082,"RPC",1279,0)
ORWDXA WCPUT
"KRN",19,10082,"RPC",1280,0)
ORWDXC ACCEPT
"KRN",19,10082,"RPC",1281,0)
ORWDXC DELAY
"KRN",19,10082,"RPC",1282,0)
ORWDXC DELORD
"KRN",19,10082,"RPC",1283,0)
ORWDXC DISPLAY
"KRN",19,10082,"RPC",1284,0)
ORWDXC FILLID
"KRN",19,10082,"RPC",1285,0)
ORWDXC ON
"KRN",19,10082,"RPC",1286,0)
ORWDXC SAVECHK
"KRN",19,10082,"RPC",1287,0)
ORWDXC SESSION
"KRN",19,10082,"RPC",1288,0)
ORWDXM AUTOACK
"KRN",19,10082,"RPC",1289,0)
ORWDXM DLGNAME
"KRN",19,10082,"RPC",1290,0)
ORWDXM FORMID
"KRN",19,10082,"RPC",1291,0)
ORWDXM LOADSET
"KRN",19,10082,"RPC",1292,0)
ORWDXM MENU
"KRN",19,10082,"RPC",1293,0)
ORWDXM MSTYLE
"KRN",19,10082,"RPC",1294,0)
ORWDXM PROMPTS
"KRN",19,10082,"RPC",1295,0)
ORWDXM1 BLDQRSP
"KRN",19,10082,"RPC",1296,0)
ORWDXM2 CLRRCL
"KRN",19,10082,"RPC",1297,0)
ORWDXQ DLGNAME
"KRN",19,10082,"RPC",1298,0)
ORWDXQ DLGSAVE
"KRN",19,10082,"RPC",1299,0)
ORWDXQ GETQLST
"KRN",19,10082,"RPC",1300,0)
ORWDXQ GETQNAM
"KRN",19,10082,"RPC",1301,0)
ORWDXQ PUTQLST
"KRN",19,10082,"RPC",1302,0)
ORWDXQ PUTQNAM
"KRN",19,10082,"RPC",1303,0)
ORWDXR ISREL
"KRN",19,10082,"RPC",1304,0)
ORWDXR RENEW
"KRN",19,10082,"RPC",1305,0)
ORWDXR RNWFLDS
"KRN",19,10082,"RPC",1306,0)
ORWGEPT CLINRNG
"KRN",19,10082,"RPC",1307,0)
ORWLR CUMULATIVE REPORT
"KRN",19,10082,"RPC",1308,0)
ORWLR CUMULATIVE SECTION
"KRN",19,10082,"RPC",1309,0)
ORWLR REPORT LISTS
"KRN",19,10082,"RPC",1310,0)
ORWLRR ALLTESTS
"KRN",19,10082,"RPC",1311,0)
ORWLRR ATESTS
"KRN",19,10082,"RPC",1312,0)
ORWLRR ATG
"KRN",19,10082,"RPC",1313,0)
ORWLRR ATOMICS
"KRN",19,10082,"RPC",1314,0)
ORWLRR CHART
"KRN",19,10082,"RPC",1315,0)
ORWLRR CHEMTEST
"KRN",19,10082,"RPC",1316,0)
ORWLRR GRID
"KRN",19,10082,"RPC",1317,0)
ORWLRR INTERIM
"KRN",19,10082,"RPC",1318,0)
ORWLRR INTERIMG
"KRN",19,10082,"RPC",1319,0)
ORWLRR INTERIMS
"KRN",19,10082,"RPC",1320,0)
ORWLRR MICRO
"KRN",19,10082,"RPC",1321,0)
ORWLRR NEWOLD
"KRN",19,10082,"RPC",1322,0)
ORWLRR PARAM
"KRN",19,10082,"RPC",1323,0)
ORWLRR SPEC
"KRN",19,10082,"RPC",1324,0)
ORWLRR TG
"KRN",19,10082,"RPC",1325,0)
ORWLRR USERS
"KRN",19,10082,"RPC",1326,0)
ORWLRR UTGA
"KRN",19,10082,"RPC",1327,0)
ORWLRR UTGD
"KRN",19,10082,"RPC",1328,0)
ORWLRR UTGR
"KRN",19,10082,"RPC",1329,0)
ORWMC PATIENT PROCEDURES
"KRN",19,10082,"RPC",1330,0)
ORWOR RESULT
"KRN",19,10082,"RPC",1331,0)
ORWOR SHEETS
"KRN",19,10082,"RPC",1332,0)
ORWOR TSALL
"KRN",19,10082,"RPC",1333,0)
ORWORB AUTOUNFLAG ORDERS
"KRN",19,10082,"RPC",1334,0)
ORWORB FASTUSER
"KRN",19,10082,"RPC",1335,0)
ORWORB GET TIU ALERT INFO
"KRN",19,10082,"RPC",1336,0)
ORWORB GETDATA
"KRN",19,10082,"RPC",1337,0)
ORWORB KILL UNSIG ORDERS ALERT
"KRN",19,10082,"RPC",1338,0)
ORWORB URGENLST
"KRN",19,10082,"RPC",1339,0)
ORWORDG ALLTREE
"KRN",19,10082,"RPC",1340,0)
ORWORDG GRPSEQB
"KRN",19,10082,"RPC",1341,0)
ORWORDG IEN
"KRN",19,10082,"RPC",1342,0)
ORWORDG MAPSEQ
"KRN",19,10082,"RPC",1343,0)
ORWORDG REVSTS
"KRN",19,10082,"RPC",1344,0)
ORWORR AGET
"KRN",19,10082,"RPC",1345,0)
ORWORR GET
"KRN",19,10082,"RPC",1346,0)
ORWORR GET4LST
"KRN",19,10082,"RPC",1347,0)
ORWORR GETBYIFN
"KRN",19,10082,"RPC",1348,0)
ORWORR GETTXT
"KRN",19,10082,"RPC",1349,0)
ORWPCE ACTIVE PROV
"KRN",19,10082,"RPC",1350,0)
ORWPCE ACTPROB
"KRN",19,10082,"RPC",1351,0)
ORWPCE CPTREQD
"KRN",19,10082,"RPC",1352,0)
ORWPCE DELETE
"KRN",19,10082,"RPC",1353,0)
ORWPCE DIAG
"KRN",19,10082,"RPC",1354,0)
ORWPCE GET EDUCATION TOPICS
"KRN",19,10082,"RPC",1355,0)
ORWPCE GET EXAM TYPE
"KRN",19,10082,"RPC",1356,0)
ORWPCE GET HEALTH FACTORS TY
"KRN",19,10082,"RPC",1357,0)
ORWPCE GET IMMUNIZATION TYPE
"KRN",19,10082,"RPC",1358,0)
ORWPCE GET SET OF CODES
"KRN",19,10082,"RPC",1359,0)
ORWPCE GET SKIN TEST TYPE
"KRN",19,10082,"RPC",1360,0)
ORWPCE GET TREATMENT TYPE
"KRN",19,10082,"RPC",1361,0)
ORWPCE HF
"KRN",19,10082,"RPC",1362,0)
ORWPCE IMM
"KRN",19,10082,"RPC",1363,0)
ORWPCE LEX
"KRN",19,10082,"RPC",1364,0)
ORWPCE LEXCODE
"KRN",19,10082,"RPC",1366,0)
ORWPCE NOTEVSTR
"KRN",19,10082,"RPC",1367,0)
ORWPCE PCE4NOTE
"KRN",19,10082,"RPC",1368,0)
ORWPCE PED
"KRN",19,10082,"RPC",1369,0)
ORWPCE PROC
"KRN",19,10082,"RPC",1370,0)
ORWPCE SAVE
"KRN",19,10082,"RPC",1371,0)
ORWPCE SCDIS
"KRN",19,10082,"RPC",1372,0)
ORWPCE SCSEL
"KRN",19,10082,"RPC",1373,0)
ORWPCE SK
"KRN",19,10082,"RPC",1374,0)
ORWPCE TRT
"KRN",19,10082,"RPC",1375,0)
ORWPCE VISIT
"KRN",19,10082,"RPC",1376,0)
ORWPCE XAM
"KRN",19,10082,"RPC",1377,0)
ORWPS ACTIVE
"KRN",19,10082,"RPC",1378,0)
ORWPS COVER
"KRN",19,10082,"RPC",1379,0)
ORWPS DETAIL
"KRN",19,10082,"RPC",1380,0)
ORWPS1 NEWDLG
"KRN",19,10082,"RPC",1381,0)
ORWPS1 PICKUP
"KRN",19,10082,"RPC",1382,0)
ORWPS1 REFILL
"KRN",19,10082,"RPC",1383,0)
ORWPT ADMITLST
"KRN",19,10082,"RPC",1384,0)
ORWPT APPTLST
"KRN",19,10082,"RPC",1385,0)
ORWPT CLINRNG
"KRN",19,10082,"RPC",1386,0)
ORWPT CWAD
"KRN",19,10082,"RPC",1387,0)
ORWPT DFLTSRC
"KRN",19,10082,"RPC",1388,0)
ORWPT DIEDON
"KRN",19,10082,"RPC",1389,0)
ORWPT DISCHARGE
"KRN",19,10082,"RPC",1390,0)
ORWPT ENCTITL
"KRN",19,10082,"RPC",1391,0)
ORWPT FULLSSN
"KRN",19,10082,"RPC",1392,0)
ORWPT ID INFO
"KRN",19,10082,"RPC",1393,0)
ORWPT LAST5
"KRN",19,10082,"RPC",1394,0)
ORWPT LIST ALL
"KRN",19,10082,"RPC",1395,0)
ORWPT PTINQ
"KRN",19,10082,"RPC",1396,0)
ORWPT SAVDFLT
"KRN",19,10082,"RPC",1397,0)
ORWPT SELCHK
"KRN",19,10082,"RPC",1398,0)
ORWPT SELECT
"KRN",19,10082,"RPC",1399,0)
ORWPT SHARE
"KRN",19,10082,"RPC",1400,0)
ORWPT TOP
"KRN",19,10082,"RPC",1401,0)
ORWPT1 PCDETAIL
"KRN",19,10082,"RPC",1402,0)
ORWPT1 PRCARE
"KRN",19,10082,"RPC",1403,0)
ORWPT16 ADMITLST
"KRN",19,10082,"RPC",1404,0)
ORWPT16 APPTLST
"KRN",19,10082,"RPC",1405,0)
ORWPT16 DEMOG
"KRN",19,10082,"RPC",1406,0)
ORWPT16 GETVSIT
"KRN",19,10082,"RPC",1407,0)
ORWPT16 ID INFO
"KRN",19,10082,"RPC",1408,0)
ORWPT16 LIST ALL
"KRN",19,10082,"RPC",1409,0)
ORWPT16 LOOKUP
"KRN",19,10082,"RPC",1410,0)
ORWPT16 PSCNVT
"KRN",19,10082,"RPC",1411,0)
ORWRA DEFAULT EXAM SETTINGS
"KRN",19,10082,"RPC",1412,0)
ORWRA IMAGING EXAMS
"KRN",19,10082,"RPC",1413,0)
ORWRA PRINT REPORT
"KRN",19,10082,"RPC",1414,0)
ORWRA REPORT TEXT
"KRN",19,10082,"RPC",1415,0)
ORWRP PRINT LAB REPORTS
"KRN",19,10082,"RPC",1416,0)
ORWRP PRINT REPORT
"KRN",19,10082,"RPC",1417,0)
ORWRP REPORT LISTS
"KRN",19,10082,"RPC",1418,0)
ORWRP REPORT TEXT
"KRN",19,10082,"RPC",1419,0)
ORWRP1 LISTNUTR
"KRN",19,10082,"RPC",1420,0)
ORWRP16 REPORT LISTS
"KRN",19,10082,"RPC",1421,0)
ORWRP16 REPORT TEXT
"KRN",19,10082,"RPC",1422,0)
ORWTIU GET DCSUMM CONTEXT
"KRN",19,10082,"RPC",1423,0)
ORWTIU GET TIU CONTEXT
"KRN",19,10082,"RPC",1424,0)
ORWTIU SAVE DCSUMM CONTEXT
"KRN",19,10082,"RPC",1425,0)
ORWTIU SAVE TIU CONTEXT
"KRN",19,10082,"RPC",1426,0)
ORWU CLINLOC
"KRN",19,10082,"RPC",1427,0)
ORWU DEVICE
"KRN",19,10082,"RPC",1428,0)
ORWU DT
"KRN",19,10082,"RPC",1429,0)
ORWU EXTNAME
"KRN",19,10082,"RPC",1430,0)
ORWU GBLREF
"KRN",19,10082,"RPC",1431,0)
ORWU GENERIC
"KRN",19,10082,"RPC",1432,0)
ORWU HASKEY
"KRN",19,10082,"RPC",1433,0)
ORWU HOSPLOC
"KRN",19,10082,"RPC",1434,0)
ORWU INPLOC
"KRN",19,10082,"RPC",1435,0)
ORWU NEWPERS
"KRN",19,10082,"RPC",1436,0)
ORWU NPHASKEY
"KRN",19,10082,"RPC",1437,0)
ORWU PATCH
"KRN",19,10082,"RPC",1438,0)
ORWU TOOLMENU
"KRN",19,10082,"RPC",1439,0)
ORWU USERINFO
"KRN",19,10082,"RPC",1440,0)
ORWU VALDT
"KRN",19,10082,"RPC",1441,0)
ORWU VALIDSIG
"KRN",19,10082,"RPC",1442,0)
ORWU VERSRV
"KRN",19,10082,"RPC",1443,0)
ORWU16 DEVICE
"KRN",19,10082,"RPC",1444,0)
ORWU16 HOSPLOC
"KRN",19,10082,"RPC",1445,0)
ORWU16 NEWPERS
"KRN",19,10082,"RPC",1446,0)
ORWU16 USERINFO
"KRN",19,10082,"RPC",1447,0)
ORWU16 VALDT
"KRN",19,10082,"RPC",1448,0)
ORWU16 VALIDSIG
"KRN",19,10082,"RPC",1449,0)
ORWUH POPUP
"KRN",19,10082,"RPC",1450,0)
ORWUX SYMTAB
"KRN",19,10082,"RPC",1451,0)
ORWUXT LST
"KRN",19,10082,"RPC",1452,0)
ORWUXT REF
"KRN",19,10082,"RPC",1453,0)
ORWUXT VAL
"KRN",19,10082,"RPC",1454,0)
ORQQCN DEFAULT REQUEST REASON
"KRN",19,10082,"RPC",1455,0)
ORWDX LOCK ORDER
"KRN",19,10082,"RPC",1456,0)
ORWDX UNLOCK ORDER
"KRN",19,10082,"RPC",1457,0)
ORWDCN32 NEWDLG
"KRN",19,10082,"RPC",1458,0)
ORQQCN GET SERVICE IEN
"KRN",19,10082,"RPC",1459,0)
ORQQCN PROVDX
"KRN",19,10082,"RPC",1460,0)
TIU TEMPLATE ACCESS LEVEL
"KRN",19,10082,"RPC",1461,0)
TIU GET DOCUMENT TITLE
"KRN",19,10082,"RPC",1462,0)
ORWPT BYWARD
"KRN",19,10082,"RPC",1463,0)
ORQQPX GET HIST LOCATIONS
"KRN",19,10082,"RPC",1464,0)
ORQQPX NEW REMINDERS ACTIVE
"KRN",19,10082,"RPC",1465,0)
ORWPCE GET VISIT
"KRN",19,10082,"RPC",1480,0)
TIU GET REQUEST
"KRN",19,10082,"RPC",1481,0)
ORWORB KILL EXPIR MED ALERT
"KRN",19,10082,"RPC",1482,0)
DG CHK BS5 XREF ARRAY
"KRN",19,10082,"RPC",1483,0)
DG CHK BS5 XREF Y/N
"KRN",19,10082,"RPC",1484,0)
DG CHK PAT/DIV MEANS TEST
"KRN",19,10082,"RPC",1485,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,10082,"RPC",1486,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,10082,"RPC",1487,0)
ORQQCN CANEDIT
"KRN",19,10082,"RPC",1488,0)
ORQQCN EDIT DEFAULT REASON
"KRN",19,10082,"RPC",1489,0)
ORQQCN SF513 WINDOWS PRINT
"KRN",19,10082,"RPC",1490,0)
ORWCIRN FACLIST
"KRN",19,10082,"RPC",1491,0)
ORWDLR32 GET LAB TIMES
"KRN",19,10082,"RPC",1492,0)
ORWPT LEGACY
"KRN",19,10082,"RPC",1493,0)
ORWRP GET DEFAULT PRINTER
"KRN",19,10082,"RPC",1494,0)
ORWRP PRINT WINDOWS REPORT
"KRN",19,10082,"RPC",1495,0)
ORWRP SAVE DEFAULT PRINTER
"KRN",19,10082,"RPC",1496,0)
ORWRP WINPRINT DEFAULT
"KRN",19,10082,"RPC",1497,0)
ORWRP WINPRINT LAB REPORTS
"KRN",19,10082,"RPC",1498,0)
ORWTIU WINPRINT NOTE
"KRN",19,10082,"RPC",1500,0)
ORWPCE GAFOK
"KRN",19,10082,"RPC",1501,0)
ORWPCE MHCLINIC
"KRN",19,10082,"RPC",1502,0)
ORWPCE LOADGAF
"KRN",19,10082,"RPC",1503,0)
ORWPCE SAVEGAF
"KRN",19,10082,"RPC",1504,0)
ORWPCE FORCE
"KRN",19,10082,"RPC",1505,0)
TIU GET DEFAULT PROVIDER
"KRN",19,10082,"RPC",1506,0)
TIU GET SITE PARAMETERS
"KRN",19,10082,"RPC",1507,0)
TIU IS USER A PROVIDER?
"KRN",19,10082,"RPC",1508,0)
ORWOR VWGET
"KRN",19,10082,"RPC",1509,0)
ORWOR VWSET
"KRN",19,10082,"RPC",1510,0)
ORWU PARAM
"KRN",19,10082,"RPC",1511,0)
ORWDOR LKSCRN
"KRN",19,10082,"RPC",1512,0)
ORWDOR VALNUM
"KRN",19,10082,"RPC",1513,0)
ORWDPS32 VALROUTE
"KRN",19,10082,"RPC",1515,0)
ORWORB UNSIG ORDERS FOLLOWUP
"KRN",19,10082,"RPC",1516,0)
ORWTIU GET LISTBOX ITEM
"KRN",19,10082,"RPC",1517,0)
ORWRP2 HS COMP FILES
"KRN",19,10082,"RPC",1518,0)
ORWRP2 HS COMPONENTS
"KRN",19,10082,"RPC",1519,0)
ORWRP2 HS FILE LOOKUP
"KRN",19,10082,"RPC",1520,0)
ORWRP2 HS REPORT TEXT
"KRN",19,10082,"RPC",1521,0)
ORWRP2 HS SUBITEMS
"KRN",19,10082,"RPC",1522,0)
ORWPCE HASCPT
"KRN",19,10082,"RPC",1523,0)
ORWPCE ASKPCE
"KRN",19,10082,"RPC",1524,0)
ORWPCE MHTESTOK
"KRN",19,10082,"RPC",1525,0)
ORWPCE GAFURL
"KRN",19,10082,"RPC",1526,0)
ORQQPXRM DIALOG PROMPTS
"KRN",19,10082,"RPC",1527,0)
ORQQPXRM EDUCATION SUBTOPICS
"KRN",19,10082,"RPC",1528,0)
ORQQPXRM EDUCATION SUMMARY
"KRN",19,10082,"RPC",1529,0)
ORQQPXRM EDUCATION TOPIC
"KRN",19,10082,"RPC",1530,0)
ORQQPXRM MENTAL HEALTH
"KRN",19,10082,"RPC",1531,0)
ORQQPXRM MENTAL HEALTH RESULTS
"KRN",19,10082,"RPC",1532,0)
ORQQPXRM MENTAL HEALTH SAVE
"KRN",19,10082,"RPC",1533,0)
ORQQPXRM PROGRESS NOTE HEADER
"KRN",19,10082,"RPC",1534,0)
ORQQPXRM REMINDER CATEGORIES
"KRN",19,10082,"RPC",1535,0)
ORQQPXRM REMINDER DETAIL
"KRN",19,10082,"RPC",1536,0)
ORQQPXRM REMINDER DIALOG
"KRN",19,10082,"RPC",1537,0)
ORQQPXRM REMINDER EVALUATION
"KRN",19,10082,"RPC",1538,0)
ORQQPXRM REMINDER INQUIRY
"KRN",19,10082,"RPC",1539,0)
ORQQPXRM REMINDER WEB
"KRN",19,10082,"RPC",1540,0)
ORQQPXRM REMINDERS APPLICABLE
"KRN",19,10082,"RPC",1541,0)
ORQQPXRM REMINDERS UNEVALUATED
"KRN",19,10082,"RPC",1542,0)
ORWLRR INFO
"KRN",19,10082,"RPC",1543,0)
TIU GET PRINT NAME
"KRN",19,10082,"RPC",1544,0)
TIU WAS THIS SAVED?
"KRN",19,10082,"RPC",1545,0)
ORWD1 COMLOC
"KRN",19,10082,"RPC",1546,0)
ORWD1 SIG4ANY
"KRN",19,10082,"RPC",1547,0)
ORWD1 SIG4ONE
"KRN",19,10082,"RPC",1548,0)
ORWOR UNSIGN
"KRN",19,10082,"RPC",1549,0)
ORWPT INPLOC
"KRN",19,10082,"RPC",1553,0)
ORQQCN2 GET PREREQUISITE
"KRN",19,10082,"RPC",1554,0)
ORQQCN2 SCHEDULE CONSULT
"KRN",19,10082,"RPC",1555,0)
YS GAF API
"KRN",19,10082,"RPC",1556,0)
TIU LONG LIST BOILERPLATED
"KRN",19,10082,"RPC",1557,0)
ORWDLR33 FUTURE LAB COLLECTS
"KRN",19,10082,"RPC",1558,0)
ORWRP PRINT REMOTE REPORT
"KRN",19,10082,"RPC",1559,0)
ORWRP PRINT WINDOWS REMOTE
"KRN",19,10082,"RPC",1560,0)
ORWRP PRINT LAB REMOTE
"KRN",19,10082,"RPC",1561,0)
ORWRP PRINT WINDOWS LAB REMOTE
"KRN",19,10082,"RPC",1562,0)
ORQQPXRM DIALOG ACTIVE
"KRN",19,10082,"RPC",1563,0)
ORWPCE MH TEST AUTHORIZED
"KRN",19,10082,"RPC",1564,0)
TIU GET BOILERPLATE
"KRN",19,10082,"RPC",1565,0)
ORWRP2 HS COMPONENT SUBS
"KRN",19,10082,"RPC",1566,0)
ORWCH SAVFONT
"KRN",19,10082,"RPC",1567,0)
ORWDLR33 LASTTIME
"KRN",19,10082,"RPC",1568,0)
ORWD1 SVONLY
"KRN",19,10082,"RPC",1569,0)
ORWPCE HASVISIT
"KRN",19,10082,"RPC",1570,0)
ORWPCE GETMOD
"KRN",19,10082,"RPC",1571,0)
ORWPCE CPTMODS
"KRN",19,10082,"RPC",1572,0)
XWB REMOTE CLEAR
"KRN",19,10082,"RPC",1573,0)
XWB REMOTE GETDATA
"KRN",19,10082,"RPC",1574,0)
XWB REMOTE RPC
"KRN",19,10082,"RPC",1575,0)
XWB REMOTE STATUS CHECK
"KRN",19,10082,"RPC",1576,0)
ORQQCN ASSIGNABLE MED RESULTS
"KRN",19,10082,"RPC",1577,0)
ORQQCN ATTACH MED RESULTS
"KRN",19,10082,"RPC",1578,0)
ORQQCN GET MED RESULT DETAILS
"KRN",19,10082,"RPC",1579,0)
ORQQCN REMOVABLE MED RESULTS
"KRN",19,10082,"RPC",1580,0)
ORQQCN REMOVE MED RESULTS
"KRN",19,10082,"RPC",1581,0)
ORQQCN SVC W/SYNONYMS
"KRN",19,10082,"RPC",1582,0)
ORWCV1 COVERSHEET LIST
"KRN",19,10082,"RPC",1583,0)
ORWORB KILL EXPIR OI ALERT
"KRN",19,10082,"RPC",1584,0)
ORWPCE GETSVC
"KRN",19,10082,"RPC",1585,0)
ORWRP LAB REPORT LISTS
"KRN",19,10082,"RPC",1586,0)
ORWTPL GETNSORT
"KRN",19,10082,"RPC",1587,0)
ORWTPN GETCLASS
"KRN",19,10082,"RPC",1588,0)
ORWTPN GETTC
"KRN",19,10082,"RPC",1589,0)
ORWTPO CSARNGD
"KRN",19,10082,"RPC",1590,0)
ORWTPO CSLABD
"KRN",19,10082,"RPC",1591,0)
ORWTPO GETTABS
"KRN",19,10082,"RPC",1592,0)
ORWTPP ADDLIST
"KRN",19,10082,"RPC",1593,0)
ORWTPP CHKSURR
"KRN",19,10082,"RPC",1594,0)
ORWTPP CLDAYS
"KRN",19,10082,"RPC",1595,0)
ORWTPP CLEARNOT
"KRN",19,10082,"RPC",1596,0)
ORWTPP CLRANGE
"KRN",19,10082,"RPC",1597,0)
ORWTPP CSARNG
"KRN",19,10082,"RPC",1598,0)
ORWTPP CSLAB
"KRN",19,10082,"RPC",1599,0)
ORWTPP DELLIST
"KRN",19,10082,"RPC",1600,0)
ORWTPP GETCOMBO
"KRN",19,10082,"RPC",1601,0)
ORWTPP GETCOS
"KRN",19,10082,"RPC",1602,0)
ORWTPP GETDCOS
"KRN",19,10082,"RPC",1603,0)
ORWTPP GETNOT
"KRN",19,10082,"RPC",1604,0)
ORWTPP GETNOTO
"KRN",19,10082,"RPC",1605,0)
ORWTPP GETOC
"KRN",19,10082,"RPC",1606,0)
ORWTPP GETOTHER
"KRN",19,10082,"RPC",1607,0)
ORWTPP GETREM
"KRN",19,10082,"RPC",1608,0)
ORWTPP GETSUB
"KRN",19,10082,"RPC",1609,0)
ORWTPP GETSURR
"KRN",19,10082,"RPC",1610,0)
ORWTPP GETTD
"KRN",19,10082,"RPC",1611,0)
ORWTPP GETTU
"KRN",19,10082,"RPC",1612,0)
ORWTPP LSDEF
"KRN",19,10082,"RPC",1613,0)
ORWTPP NEWLIST
"KRN",19,10082,"RPC",1614,0)
ORWTPP PLISTS
"KRN",19,10082,"RPC",1615,0)
ORWTPP PLTEAMS
"KRN",19,10082,"RPC",1616,0)
ORWTPP REMLIST
"KRN",19,10082,"RPC",1617,0)
ORWTPP SAVECD
"KRN",19,10082,"RPC",1618,0)
ORWTPP SAVECS
"KRN",19,10082,"RPC",1619,0)
ORWTPP SAVELIST
"KRN",19,10082,"RPC",1620,0)
ORWTPP SAVENOT
"KRN",19,10082,"RPC",1621,0)
ORWTPP SAVENOTO
"KRN",19,10082,"RPC",1622,0)
ORWTPP SAVEOC
"KRN",19,10082,"RPC",1623,0)
ORWTPP SAVEPLD
"KRN",19,10082,"RPC",1624,0)
ORWTPP SAVESURR
"KRN",19,10082,"RPC",1625,0)
ORWTPP SAVET
"KRN",19,10082,"RPC",1626,0)
ORWTPP SETCOMBO
"KRN",19,10082,"RPC",1627,0)
ORWTPP SETDCOS
"KRN",19,10082,"RPC",1628,0)
ORWTPP SETOTHER
"KRN",19,10082,"RPC",1629,0)
ORWTPP SETREM
"KRN",19,10082,"RPC",1630,0)
ORWTPP SETSUB
"KRN",19,10082,"RPC",1631,0)
ORWTPP SORTDEF
"KRN",19,10082,"RPC",1632,0)
ORWTPP TEAMS
"KRN",19,10082,"RPC",1633,0)
ORWTPT ATEAMS
"KRN",19,10082,"RPC",1634,0)
ORWTPT GETTEAM
"KRN",19,10082,"RPC",1635,0)
TIU TEMPLATE GET DEFAULTS
"KRN",19,10082,"RPC",1636,0)
TIU TEMPLATE GET DESCRIPTION
"KRN",19,10082,"RPC",1637,0)
TIU TEMPLATE SET DEFAULTS
"KRN",19,10082,"RPC",1638,0)
ORWTIU IDNOTES INSTALLED
"KRN",19,10082,"RPC",1639,0)
ORQQPX GET FOLDERS
"KRN",19,10082,"RPC",1640,0)
ORQQPX SET FOLDERS
"KRN",19,10082,"RPC",1641,0)
TIU FIELD CAN EDIT
"KRN",19,10082,"RPC",1642,0)
TIU FIELD DELETE
"KRN",19,10082,"RPC",1643,0)
TIU FIELD EXPORT
"KRN",19,10082,"RPC",1644,0)
TIU FIELD IMPORT
"KRN",19,10082,"RPC",1645,0)
TIU FIELD LIST
"KRN",19,10082,"RPC",1646,0)
TIU FIELD LOAD
"KRN",19,10082,"RPC",1647,0)
TIU FIELD LOAD BY IEN
"KRN",19,10082,"RPC",1648,0)
TIU FIELD LOCK
"KRN",19,10082,"RPC",1649,0)
TIU FIELD NAME IS UNIQUE
"KRN",19,10082,"RPC",1650,0)
TIU FIELD SAVE
"KRN",19,10082,"RPC",1651,0)
TIU FIELD UNLOCK
"KRN",19,10082,"RPC",1652,0)
ORWDPS1 CHK94
"KRN",19,10082,"RPC",1653,0)
ORWDPS1 ODSLCT
"KRN",19,10082,"RPC",1654,0)
ORWDPS1 SCHALL
"KRN",19,10082,"RPC",1655,0)
ORWDPS2 ADMIN
"KRN",19,10082,"RPC",1656,0)
ORWDPS2 DAY2QTY
"KRN",19,10082,"RPC",1657,0)
ORWDPS2 OISLCT
"KRN",19,10082,"RPC",1658,0)
ORWDPS2 REQST
"KRN",19,10082,"RPC",1659,0)
ORWDX DGNM
"KRN",19,10082,"RPC",1660,0)
ORWUL FV4DG
"KRN",19,10082,"RPC",1661,0)
ORWUL FVIDX
"KRN",19,10082,"RPC",1662,0)
ORWUL FVSUB
"KRN",19,10082,"RPC",1663,0)
ORWUL QV4DG
"KRN",19,10082,"RPC",1664,0)
ORWUL QVIDX
"KRN",19,10082,"RPC",1665,0)
ORWUL QVSUB
"KRN",19,10082,"RPC",1666,0)
ORWDPS1 DFLTSPLY
"KRN",19,10082,"RPC",1668,0)
PXRM REMINDER DIALOG (TIU)
"KRN",19,10082,"RPC",1669,0)
ORWPCE ANYTIME
"KRN",19,10082,"RPC",1670,0)
ORQQPX GET DEF LOCATIONS
"KRN",19,10082,"RPC",1671,0)
ORWTPP GETIMG
"KRN",19,10082,"RPC",1672,0)
ORWTPP SETIMG
"KRN",19,10082,"RPC",1673,0)
ORWTPO GETIMGD
"KRN",19,10082,"RPC",1674,0)
ORQQPX REM INSERT AT CURSOR
"KRN",19,10082,"RPC",1675,0)
TIU REMINDER DIALOGS
"KRN",19,10082,"RPC",1676,0)
TIU REM DLG OK AS TEMPLATE
"KRN",19,10082,"RPC",1677,0)
ORWDPS2 MAXREF
"KRN",19,10082,"RPC",1678,0)
ORWDPS2 SCHREQ
"KRN",19,10082,"RPC",1679,0)
ORWRP COLUMN HEADERS
"KRN",19,10082,"RPC",1680,0)
TIU FIELD DOLMTEXT
"KRN",19,10082,"RPC",1681,0)
TIU TEMPLATE PERSONAL OBJECTS
"KRN",19,10082,"RPC",1682,0)
ORWPCE AUTO VISIT TYPE SELECT
"KRN",19,10082,"RPC",1683,0)
ORWDPS2 QTY2DAY
"KRN",19,10082,"RPC",1684,0)
ORWU HAS OPTION ACCESS
"KRN",19,10082,"RPC",1685,0)
TIU TEMPLATE LOCK
"KRN",19,10082,"RPC",1686,0)
ORQQPX LVREMLST
"KRN",19,10082,"RPC",1687,0)
ORQQPX NEW COVER SHEET ACTIVE
"KRN",19,10082,"RPC",1688,0)
ORQQPX NEW COVER SHEET REMS
"KRN",19,10082,"RPC",1689,0)
ORQQPX SAVELVL
"KRN",19,10082,"RPC",1690,0)
PXRM REMINDER CATEGORY
"KRN",19,10082,"RPC",1691,0)
PXRM REMINDERS AND CATEGORIES
"KRN",19,10082,"RPC",1692,0)
TIU DIV AND CLASS INFO
"KRN",19,10082,"RPC",1693,0)
TIU TEMPLATE GETBOIL
"KRN",19,10082,"RPC",1694,0)
TIU TEMPLATE GETITEMS
"KRN",19,10082,"RPC",1695,0)
TIU TEMPLATE GETROOTS
"KRN",19,10082,"RPC",1696,0)
TIU TEMPLATE GETTEXT
"KRN",19,10082,"RPC",1697,0)
TIU TEMPLATE ISEDITOR
"KRN",19,10082,"RPC",1698,0)
TIU TEMPLATE UNLOCK
"KRN",19,10082,"RPC",1699,0)
TIU USER CLASS LONG LIST
"KRN",19,10082,"RPC",1700,0)
ORWPCE ALWAYS CHECKOUT
"KRN",19,10082,"RPC",1701,0)
ORWPCE GET EXCLUDED
"KRN",19,10082,"RPC",1702,0)
ORWDPS1 FORMALT
"KRN",19,10082,"RPC",1703,0)
ORQPT DEFAULT LIST SORT
"KRN",19,10082,"RPC",1704,0)
ORWDPS1 DOSEALT
"KRN",19,10082,"RPC",1705,0)
ORWTPR OCDESC
"KRN",19,10082,"RPC",1706,0)
ORWTPR NOTDESC
"KRN",19,10082,"RPC",1707,0)
ORWDPS1 FAILDEA
"KRN",19,10082,"RPC",1708,0)
ORQPT DEFAULT CLINIC DATE RANG
"KRN",19,10082,"RPC",1709,0)
ORWTIU CANLINK
"KRN",19,10082,"RPC",1710,0)
TIU ID ATTACH ENTRY
"KRN",19,10082,"RPC",1711,0)
TIU ID CAN ATTACH
"KRN",19,10082,"RPC",1712,0)
TIU ID CAN RECEIVE
"KRN",19,10082,"RPC",1713,0)
TIU ID DETACH ENTRY
"KRN",19,10082,"RPC",1714,0)
ORWCOM GETOBJS
"KRN",19,10082,"RPC",1715,0)
ORWCOM DETAILS
"KRN",19,10082,"RPC",1716,0)
ORWCOM PTOBJ
"KRN",19,10082,"RPC",1718,0)
TIU TEMPLATE GETLINK
"KRN",19,10082,"RPC",1719,0)
TIU TEMPLATE ALL TITLES
"KRN",19,10082,"RPC",1720,0)
ORWSR LIST
"KRN",19,10082,"RPC",1721,0)
ORWSR SHOW SURG TAB
"KRN",19,10082,"RPC",1722,0)
ORWSR GET SURG CONTEXT
"KRN",19,10082,"RPC",1723,0)
ORWSR SAVE SURG CONTEXT
"KRN",19,10082,"RPC",1724,0)
ORWSR ONECASE
"KRN",19,10082,"RPC",1725,0)
ORWSR OPTOP
"KRN",19,10082,"RPC",1726,0)
ORWSR OPTOP NON-OR
"KRN",19,10082,"RPC",1727,0)
ORWSR SHOW OPTOP WHEN SIGNING
"KRN",19,10082,"RPC",1728,0)
ORWSR IS NON-OR PROCEDURE
"KRN",19,10082,"RPC",1729,0)
ORWSR CASELIST
"KRN",19,10082,"RPC",1730,0)
ORQQCN GET PROC IEN
"KRN",19,10082,"RPC",1731,0)
ORWRP PRINT V REPORT
"KRN",19,10082,"RPC",1732,0)
ORWRP3 EXPAND COLUMNS
"KRN",19,10082,"RPC",1733,0)
ORWTPD ACTDF
"KRN",19,10082,"RPC",1734,0)
ORWTPD DELDFLT
"KRN",19,10082,"RPC",1735,0)
ORWTPD GETDFLT
"KRN",19,10082,"RPC",1736,0)
ORWTPD RSDFLT
"KRN",19,10082,"RPC",1737,0)
ORWTPD SUDF
"KRN",19,10082,"RPC",1738,0)
ORWTPD SUINDV
"KRN",19,10082,"RPC",1739,0)
ORWTPD GETSETS
"KRN",19,10082,"RPC",1740,0)
ORWCOM ORDEROBJ
"KRN",19,10082,"RPC",1741,0)
ORWRP2 COMPABV
"KRN",19,10082,"RPC",1742,0)
ORWRP2 GETLKUP
"KRN",19,10082,"RPC",1743,0)
ORWRP2 SAVLKUP
"KRN",19,10082,"RPC",1744,0)
ORWRP2 COMPDISP
"KRN",19,10082,"RPC",1745,0)
ORWPCE ISCLINIC
"KRN",19,10082,"RPC",1746,0)
ORWCH SAVECOL
"KRN",19,10082,"RPC",1747,0)
ORWSR RPTLIST
"KRN",19,10082,"RPC",1748,0)
ORQQPXRM MST UPDATE
"KRN",19,10082,"RPC",1749,0)
ORWMC PATIENT PROCEDURES1
"KRN",19,10082,"RPC",1750,0)
ORWRA IMAGING EXAMS1
"KRN",19,10082,"RPC",1751,0)
ORWRA REPORT TEXT1
"KRN",19,10082,"RPC",1752,0)
ORWDPS4 CPINFO
"KRN",19,10082,"RPC",1753,0)
ORWDPS4 CPLST
"KRN",19,10082,"RPC",1754,0)
ORWORB KILL UNVER MEDS ALERT
"KRN",19,10082,"RPC",1755,0)
ORWORB KILL UNVER ORDERS ALERT
"KRN",19,10082,"RPC",1756,0)
ORWPCE HNCOK
"KRN",19,10082,"RPC",1757,0)
ORWPS MEDHIST
"KRN",19,10082,"RPC",1758,0)
TIU FIELD CHECK
"KRN",19,10082,"RPC",1759,0)
TIU FIELD LIST ADD
"KRN",19,10082,"RPC",1760,0)
TIU FIELD LIST IMPORT
"KRN",19,10082,"RPC",1761,0)
TIU SET DOCUMENT TEXT
"KRN",19,10082,"RPC",1762,0)
ORWDPS2 CHKPI
"KRN",19,10082,"RPC",1763,0)
ORWDXR GTORITM
"KRN",19,10082,"RPC",1764,0)
ORWDPS2 CHKGRP
"KRN",19,10082,"RPC",1765,0)
ORWDPS2 QOGRP
"KRN",19,10082,"RPC",1766,0)
ORWDXR GETPKG
"KRN",19,10082,"RPC",1767,0)
ORQPT MAKE RPL
"KRN",19,10082,"RPC",1768,0)
ORQPT READ RPL
"KRN",19,10082,"RPC",1769,0)
ORQPT KILL RPL
"KRN",19,10082,"RPC",1770,0)
ORWTIU GET SAVED CP FIELDS
"KRN",19,10082,"RPC",1771,0)
ORWDPS1 LOCPICK
"KRN",19,10082,"RPC",1772,0)
ORWPT LAST5 RPL
"KRN",19,10082,"RPC",1773,0)
ORWPT FULLSSN RPL
"KRN",19,10082,"RPC",1774,0)
ORWOR PKIUSE
"KRN",19,10082,"RPC",1775,0)
ORWOR1 SIG
"KRN",19,10082,"RPC",1776,0)
ORWOR1 CHKDIG
"KRN",19,10082,"RPC",1777,0)
ORWOR1 GETDTEXT
"KRN",19,10082,"RPC",1778,0)
ORWOR1 GETDSIG
"KRN",19,10082,"RPC",1779,0)
ORWTPD GETIMG
"KRN",19,10082,"RPC",1780,0)
OREVNTX1 PRMPTID
"KRN",19,10082,"RPC",1781,0)
ORECS01 CHKESSO
"KRN",19,10082,"RPC",1782,0)
ORECS01 VSITID
"KRN",19,10082,"RPC",1784,0)
OREVNTX LIST
"KRN",19,10082,"RPC",1785,0)
OREVNTX PAT
"KRN",19,10082,"RPC",1786,0)
OREVNTX1 GTEVT
"KRN",19,10082,"RPC",1787,0)
OREVNTX1 CPACT
"KRN",19,10082,"RPC",1788,0)
OREVNTX1 CURSPE
"KRN",19,10082,"RPC",1789,0)
OREVNTX1 CHGEVT
"KRN",19,10082,"RPC",1790,0)
OREVNTX1 DELPTEVT
"KRN",19,10082,"RPC",1791,0)
OREVNTX1 DFLTEVT
"KRN",19,10082,"RPC",1792,0)
OREVNTX ACTIVE
"KRN",19,10082,"RPC",1793,0)
OREVNTX1 PUTEVNT
"KRN",19,10082,"RPC",1794,0)
OREVNTX1 WRLSTED
"KRN",19,10082,"RPC",1795,0)
OREVNTX1 EVT
"KRN",19,10082,"RPC",1796,0)
OREVNTX1 NAME
"KRN",19,10082,"RPC",1797,0)
OREVNTX1 MATCH
"KRN",19,10082,"RPC",1798,0)
OREVNTX1 EMPTY
"KRN",19,10082,"RPC",1799,0)
OREVNTX1 EXISTS
"KRN",19,10082,"RPC",1800,0)
OREVNTX1 GTEVT1
"KRN",19,10082,"RPC",1801,0)
OREVNTX1 DIV
"KRN",19,10082,"RPC",1802,0)
OREVNTX1 DIV1
"KRN",19,10082,"RPC",1803,0)
OREVNTX1 LOC
"KRN",19,10082,"RPC",1804,0)
OREVNTX1 LOC1
"KRN",19,10082,"RPC",1805,0)
ORWDX SENDED
"KRN",19,10082,"RPC",1806,0)
OREVNTX1 GETDLG
"KRN",19,10082,"RPC",1807,0)
ORECS01 ECPRINT
"KRN",19,10082,"RPC",1811,0)
ORECS01 ECRPT
"KRN",19,10082,"RPC",1812,0)
OREVNTX1 ISDCOD
"KRN",19,10082,"RPC",1813,0)
OREVNTX1 SETDFLT
"KRN",19,10082,"RPC",1815,0)
TIU IS THIS A CLINPROC?
"KRN",19,10082,"RPC",1816,0)
TIU IDENTIFY CLINPROC CLASS
"KRN",19,10082,"RPC",1817,0)
TIU LONG LIST CLINPROC TITLES
"KRN",19,10082,"RPC",1819,0)
ORWDPS1 HASOIPI
"KRN",19,10082,"RPC",1821,0)
OREVNTX1 DEFLTS
"KRN",19,10082,"RPC",1822,0)
OREVNTX1 MULTS
"KRN",19,10082,"RPC",1823,0)
OREVNTX1 DONE
"KRN",19,10082,"RPC",1824,0)
OREVNTX1 PROMPT IDS
"KRN",19,10082,"RPC",1825,0)
ORWCIRN CHECKLINK
"KRN",19,10082,"RPC",1826,0)
XWB DIRECT RPC
"KRN",19,10082,"RPC",1827,0)
ORWDPS1 HASROUTE
"KRN",19,10082,"RPC",1828,0)
OREVNTX1 DELDFLT
"KRN",19,10082,"RPC",1829,0)
OREVNTX1 DFLTDLG
"KRN",19,10082,"RPC",1830,0)
ORECS01 GETDIV
"KRN",19,10082,"RPC",1831,0)
ORWOR RESULT HISTORY
"KRN",19,10082,"RPC",1832,0)
OREVNTX1 TYPEXT
"KRN",19,10082,"RPC",1833,0)
OREVNTX1 AUTHMREL
"KRN",19,10082,"RPC",1834,0)
OREVNTX1 HAVEPRT
"KRN",19,10082,"RPC",1835,0)
ORWORR RGET
"KRN",19,10082,"RPC",1836,0)
OREVNTX1 CMEVTS
"KRN",19,10082,"RPC",1837,0)
OREVNTX1 ODPTEVID
"KRN",19,10082,"RPC",1838,0)
ORWOR PKISITE
"KRN",19,10082,"RPC",1839,0)
OREVNTX1 COMP
"KRN",19,10082,"RPC",1840,0)
OREVNTX1 ISHDORD
"KRN",19,10082,"RPC",1841,0)
OREVNTX1 ISPASS
"KRN",19,10082,"RPC",1842,0)
OREVNTX1 ISPASS1
"KRN",19,10082,"RPC",1843,0)
OREVNTX1 DLGIEN
"KRN",19,10082,"U")
CPRSCHART VERSION 1.0.20.21
"KRN",19,11448,-1)
0^3
"KRN",19,11448,0)
OR DELAYED ORDERS^Event Delayed Orders Menu^^M^^^^^^^^
"KRN",19,11448,1,0)
^^2^2^3020911^
"KRN",19,11448,1,1,0)
This menu contains all the options for setting up and maintaining the 
"KRN",19,11448,1,2,0)
event delayed orders functionality.
"KRN",19,11448,10,0)
^19.01IP^3^3
"KRN",19,11448,10,1,0)
11467^DO
"KRN",19,11448,10,1,"^")
OR DELAYED ORDERS EDITOR
"KRN",19,11448,10,2,0)
11466^IN
"KRN",19,11448,10,2,"^")
OR PATIENT EVENT INQUIRY
"KRN",19,11448,10,3,0)
11468^EP
"KRN",19,11448,10,3,"^")
OR EVENT PARAMETERS
"KRN",19,11448,25)

"KRN",19,11448,99)
59063,49589
"KRN",19,11448,"U")
EVENT DELAYED ORDERS MENU
"KRN",19,11466,-1)
0^5
"KRN",19,11466,0)
OR PATIENT EVENT INQUIRY^Inquire to OE/RR Patient Event File^^R^^^^^^^^^^
"KRN",19,11466,1,0)
^19.06^5^5^3020909^^
"KRN",19,11466,1,1,0)
This option gives a fileman inquiry of an entry from the patient event 
"KRN",19,11466,1,2,0)
file.  This file holds information related to orders placed on delay.  
"KRN",19,11466,1,3,0)
Included in this information are orders released and auto-dcd due to an 
"KRN",19,11466,1,4,0)
event occurring as well as an audit trail of MAS actions taken related to 
"KRN",19,11466,1,5,0)
this delayed event.
"KRN",19,11466,20)

"KRN",19,11466,25)
OREV4
"KRN",19,11466,"U")
INQUIRE TO OE/RR PATIENT EVENT
"KRN",19,11467,-1)
0^4
"KRN",19,11467,0)
OR DELAYED ORDERS EDITOR^Delayed Orders/Auto-DC Set-up^^R^^^^^^^^
"KRN",19,11467,1,0)
^19.06^7^7^3020910^^^^
"KRN",19,11467,1,1,0)
This option invokes the auto-dc rules/release events editor.  Use this 
"KRN",19,11467,1,2,0)
option to define and maintain your auto-discontinue rules as well as your 
"KRN",19,11467,1,3,0)
delayed order release events.
"KRN",19,11467,1,4,0)
 
"KRN",19,11467,1,5,0)
Whether or not orders auto-discontinue will depend on how you have your 
"KRN",19,11467,1,6,0)
rules defined.  In addition, orders that are being written for delayed 
"KRN",19,11467,1,7,0)
release can only be delayed to the release events that you've defined.
"KRN",19,11467,25)
OREV
"KRN",19,11467,"U")
DELAYED ORDERS/AUTO-DC SET-UP
"KRN",19,11468,-1)
0^6
"KRN",19,11468,0)
OR EVENT PARAMETERS^Parameters for event delayed orders^^R^^^^^^^^
"KRN",19,11468,1,0)
^^2^2^3020911^
"KRN",19,11468,1,1,0)
This option will allow you to edit the parameters related to event 
"KRN",19,11468,1,2,0)
delayed orders.
"KRN",19,11468,25)
PARAM^OREV3
"KRN",19,11468,"U")
PARAMETERS FOR EVENT DELAYED O
"KRN",19,11487,-1)
1^1
"KRN",19,11487,0)
OR PARAM AUTODC
"KRN",101,18,-1)
4^9
"KRN",101,18,0)
ORB BLANK LINE
"KRN",101,1049,-1)
0^8
"KRN",101,1049,0)
ORU PATIENT MOVMT^Review Orders on Patient Movement^^A^^^^^^^^
"KRN",101,1049,1,0)
^^2^2^2960720^^^^
"KRN",101,1049,1,1,0)
This is the option used to review orders when a patient is discharged or
"KRN",101,1049,1,2,0)
transferred.
"KRN",101,1049,1,"B","This is the option used to rev",1)

"KRN",101,1049,1,"B","transferred.",2)

"KRN",101,1049,20)
I '$D(ORACTION) D REV^ORCHART(DFN)
"KRN",101,1049,99)
59016,47523
"KRN",101,3898,-1)
0^12
"KRN",101,3898,0)
ORC ORES ORDER ACTIONS^Order action menu for ORES key holders^^M^^^^^^^^
"KRN",101,3898,4)
20^2
"KRN",101,3898,10,0)
^101.01PA^37^37
"KRN",101,3898,10,16,0)
3913^^11^
"KRN",101,3898,10,16,"^")
ORC CHANGE ORDERS
"KRN",101,3898,10,17,0)
3915^^12^
"KRN",101,3898,10,17,"^")
ORC RENEW ORDERS
"KRN",101,3898,10,18,0)
3914^^21^
"KRN",101,3898,10,18,"^")
ORC SIGN ORDERS
"KRN",101,3898,10,21,0)
3916^^34^
"KRN",101,3898,10,21,"^")
ORC WARD COMMENTS
"KRN",101,3898,10,22,0)
3917^^41^^^
"KRN",101,3898,10,22,"^")
ORC DETAILED DISPLAY
"KRN",101,3898,10,23,0)
3922^^14^
"KRN",101,3898,10,23,"^")
ORC DISCONTINUE ORDERS
"KRN",101,3898,10,25,0)
3924^^23^
"KRN",101,3898,10,25,"^")
ORC HOLD ORDERS
"KRN",101,3898,10,26,0)
3925^^32^^^
"KRN",101,3898,10,26,"^")
ORC FLAG ORDERS
"KRN",101,3898,10,28,0)
4016^^44^
"KRN",101,3898,10,28,"^")
ORC PRINT ORDERS
"KRN",101,3898,10,29,0)
4018^^24^
"KRN",101,3898,10,29,"^")
ORC UNHOLD ORDERS
"KRN",101,3898,10,30,0)
4019^^33^
"KRN",101,3898,10,30,"^")
ORC UNFLAG ORDERS
"KRN",101,3898,10,32,0)
4072^^43^
"KRN",101,3898,10,32,"^")
ORC ALERT RESULTS
"KRN",101,3898,10,34,0)
4071^^22^
"KRN",101,3898,10,34,"^")
ORC COMPLETE ORDERS
"KRN",101,3898,10,35,0)
5173^^31^
"KRN",101,3898,10,35,"^")
ORC DELAY EVENT
"KRN",101,3898,10,36,0)
4084^^13^
"KRN",101,3898,10,36,"^")
ORC REWRITE ORDERS
"KRN",101,3898,10,37,0)
4047^^42^
"KRN",101,3898,10,37,"^")
ORC RESULTS DISPLAY
"KRN",101,3898,15)
D DESELECT^ORCHART(ORNMBR):'$G(OREBUILD)
"KRN",101,3898,20)
S XQORM(0)="1AD\",(XQORM("?"),XQORM("??"))="D ITEMHELP^ORCHART",VALMBCK="",ORNMBR=$P(XQORNOD(0),"=",2) D SELECT^ORCHART(ORNMBR)
"KRN",101,3898,26)
W ""
"KRN",101,3898,27)

"KRN",101,3898,28)
Select Action: 
"KRN",101,3898,99)
59035,37965
"KRN",101,3913,-1)
4^16
"KRN",101,3913,0)
ORC CHANGE ORDERS
"KRN",101,3914,-1)
4^24
"KRN",101,3914,0)
ORC SIGN ORDERS
"KRN",101,3915,-1)
4^23
"KRN",101,3915,0)
ORC RENEW ORDERS
"KRN",101,3916,-1)
4^28
"KRN",101,3916,0)
ORC WARD COMMENTS
"KRN",101,3917,-1)
4^18
"KRN",101,3917,0)
ORC DETAILED DISPLAY
"KRN",101,3922,-1)
4^19
"KRN",101,3922,0)
ORC DISCONTINUE ORDERS
"KRN",101,3924,-1)
4^21
"KRN",101,3924,0)
ORC HOLD ORDERS
"KRN",101,3925,-1)
4^20
"KRN",101,3925,0)
ORC FLAG ORDERS
"KRN",101,3951,-1)
2^10
"KRN",101,3951,0)
ORCHANGE ORDERS SHORT^Change Short Format Orders List^^M^1362^^^^^^^
"KRN",101,3951,10,0)
^101.01PA^8^8
"KRN",101,3951,10,7,0)
5175^^13^
"KRN",101,3951,10,7,"^")
ORCHANGE EVENT
"KRN",101,3951,10,8,0)
18^^23^
"KRN",101,3951,10,8,"^")
ORB BLANK LINE
"KRN",101,4016,-1)
4^22
"KRN",101,4016,0)
ORC PRINT ORDERS
"KRN",101,4018,-1)
4^26
"KRN",101,4018,0)
ORC UNHOLD ORDERS
"KRN",101,4019,-1)
4^25
"KRN",101,4019,0)
ORC UNFLAG ORDERS
"KRN",101,4046,-1)
0^6
"KRN",101,4046,0)
ORC ADD IV MED^IV Fluids^^A^^^^^^^^
"KRN",101,4046,15)

"KRN",101,4046,20)
N X,OREVENT S ORDIALOG="PSJI OR PAT FLUID OE",X=$$DELAY^ORCACT Q:X="^"  S OREVENT=$S(X:$$PTEVENT^OREVNT(+ORVP),1:"") Q:OREVENT="^"  D NW^ORCMED
"KRN",101,4046,99)
59016,47523
"KRN",101,4047,-1)
4^34
"KRN",101,4047,0)
ORC RESULTS DISPLAY
"KRN",101,4057,-1)
2^11
"KRN",101,4057,0)
ORCHANGE ORDERS LONG^Change Long Format Orders List^^M^1362^^^^^^^
"KRN",101,4057,10,0)
^101.01PA^8^8
"KRN",101,4057,10,7,0)
5175^^13^
"KRN",101,4057,10,7,"^")
ORCHANGE EVENT
"KRN",101,4057,10,8,0)
18^^23^
"KRN",101,4057,10,8,"^")
ORB BLANK LINE
"KRN",101,4059,-1)
0^13
"KRN",101,4059,0)
ORC ORELSE ORDER ACTIONS^Order action menu for ORELSE key holders^^M^^^^^^^^
"KRN",101,4059,4)
20^2
"KRN",101,4059,10,0)
^101.01PA^36^36
"KRN",101,4059,10,16,0)
3913^^11^
"KRN",101,4059,10,16,"^")
ORC CHANGE ORDERS
"KRN",101,4059,10,17,0)
3915^^12^
"KRN",101,4059,10,17,"^")
ORC RENEW ORDERS
"KRN",101,4059,10,18,0)
3914^^21^^^Sign/On Chart
"KRN",101,4059,10,18,"^")
ORC SIGN ORDERS
"KRN",101,4059,10,21,0)
3916^^34^
"KRN",101,4059,10,21,"^")
ORC WARD COMMENTS
"KRN",101,4059,10,22,0)
3917^^42^^^
"KRN",101,4059,10,22,"^")
ORC DETAILED DISPLAY
"KRN",101,4059,10,23,0)
3922^^14^
"KRN",101,4059,10,23,"^")
ORC DISCONTINUE ORDERS
"KRN",101,4059,10,24,0)
4412^^31^
"KRN",101,4059,10,24,"^")
ORC VERIFY MENU
"KRN",101,4059,10,25,0)
3924^^23^
"KRN",101,4059,10,25,"^")
ORC HOLD ORDERS
"KRN",101,4059,10,26,0)
3925^^32^
"KRN",101,4059,10,26,"^")
ORC FLAG ORDERS
"KRN",101,4059,10,28,0)
4016^^44^
"KRN",101,4059,10,28,"^")
ORC PRINT ORDERS
"KRN",101,4059,10,29,0)
4018^^24^
"KRN",101,4059,10,29,"^")
ORC UNHOLD ORDERS
"KRN",101,4059,10,30,0)
4019^^33^
"KRN",101,4059,10,30,"^")
ORC UNFLAG ORDERS
"KRN",101,4059,10,32,0)
4071^^22^^^
"KRN",101,4059,10,32,"^")
ORC COMPLETE ORDERS
"KRN",101,4059,10,34,0)
5173^^41^
"KRN",101,4059,10,34,"^")
ORC DELAY EVENT
"KRN",101,4059,10,35,0)
4084^^13^
"KRN",101,4059,10,35,"^")
ORC REWRITE ORDERS
"KRN",101,4059,10,36,0)
4047^^43^
"KRN",101,4059,10,36,"^")
ORC RESULTS DISPLAY
"KRN",101,4059,15)
D DESELECT^ORCHART(ORNMBR):'$G(OREBUILD)
"KRN",101,4059,20)
S XQORM(0)="1AD\",(XQORM("?"),XQORM("??"))="D ITEMHELP^ORCHART",VALMBCK="",ORNMBR=$P(XQORNOD(0),"=",2) D SELECT^ORCHART(ORNMBR)
"KRN",101,4059,26)
W ""
"KRN",101,4059,28)
Select Action: 
"KRN",101,4059,99)
59016,47524
"KRN",101,4071,-1)
4^17
"KRN",101,4071,0)
ORC COMPLETE ORDERS
"KRN",101,4072,-1)
4^15
"KRN",101,4072,0)
ORC ALERT RESULTS
"KRN",101,4080,-1)
0^29
"KRN",101,4080,0)
ORC DELAY ACTIONS^Delayed Order action menu^^M^^^^^^^^
"KRN",101,4080,4)
40^5
"KRN",101,4080,10,0)
^101.01PA^5^5
"KRN",101,4080,10,1,0)
5176^^11^
"KRN",101,4080,10,1,"^")
ORC RELEASE ORDERS
"KRN",101,4080,10,2,0)
3922^^21^^^Cancel
"KRN",101,4080,10,2,"^")
ORC DISCONTINUE ORDERS
"KRN",101,4080,10,4,0)
3917^^41^
"KRN",101,4080,10,4,"^")
ORC DETAILED DISPLAY
"KRN",101,4080,10,5,0)
5173^^31^
"KRN",101,4080,10,5,"^")
ORC DELAY EVENT
"KRN",101,4080,15)
D DESELECT^ORCHART(ORNMBR):'$G(OREBUILD) K ORNMBR,OREBUILD
"KRN",101,4080,20)
S VALMBCK="",XQORM(0)="1AD\",(XQORM("?"),XQORM("??"))="D ITEMHELP^ORCHART",ORNMBR=$P(XQORNOD(0),"=",2) D SELECT^ORCHART(ORNMBR)
"KRN",101,4080,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),U),24)) ^(24)
"KRN",101,4080,26)
W ""
"KRN",101,4080,28)
Select action: 
"KRN",101,4080,99)
59066,61721
"KRN",101,4084,-1)
4^33
"KRN",101,4084,0)
ORC REWRITE ORDERS
"KRN",101,4104,-1)
0^4
"KRN",101,4104,0)
ORC ADD INPT MED^Inpatient Meds^^A^^^^^^^^
"KRN",101,4104,15)

"KRN",101,4104,20)
N X,OREVENT S ORDIALOG="PSJ OR PAT OE",X=$$DELAY^ORCACT Q:X="^"  S OREVENT=$S(X:$$PTEVENT^OREVNT(+ORVP),1:"") Q:OREVENT="^"  D NW^ORCMED
"KRN",101,4104,99)
59016,47524
"KRN",101,4105,-1)
0^5
"KRN",101,4105,0)
ORC ADD OUTPT MED^Outpatient Meds^^A^^^^^^^^
"KRN",101,4105,20)
N X,OREVENT S ORDIALOG="PSO OERR",X=$S($G(ORWARD):$$DELAY^ORCACT,1:"") Q:X="^"  S OREVENT=$S(X:$$PTEVENT^OREVNT(+ORVP),1:"") Q:OREVENT="^"  D NW^ORCMED
"KRN",101,4105,99)
59016,47524
"KRN",101,4412,-1)
4^27
"KRN",101,4412,0)
ORC VERIFY MENU
"KRN",101,5163,-1)
0^38
"KRN",101,5163,0)
OREV ENTER/EDIT AUTO DC MENU^Enter/Edit Auto DC...^^M^^^^^^^^
"KRN",101,5163,4)
25^4
"KRN",101,5163,10,0)
^101.01PA^4^4
"KRN",101,5163,10,1,0)
5164^AE^^
"KRN",101,5163,10,1,"^")
OREV ENTER/EDIT ENTRIES
"KRN",101,5163,10,2,0)
5165^DD^^
"KRN",101,5163,10,2,"^")
OREV MAIN DETAILED DISPLAY
"KRN",101,5163,10,3,0)
5166^AI^^
"KRN",101,5163,10,3,"^")
OREV SWITCH
"KRN",101,5163,10,4,0)
5178^CD^^
"KRN",101,5163,10,4,"^")
OREV CHANGE DISPLAY
"KRN",101,5163,15)

"KRN",101,5163,20)
D LIST^OREV,CHKSEL^OREV
"KRN",101,5163,26)
D PHDR^OREV
"KRN",101,5163,28)
Select action: 
"KRN",101,5163,99)
59066,56372
"KRN",101,5164,-1)
0^39
"KRN",101,5164,0)
OREV ENTER/EDIT ENTRIES^Add/Edit^^A^^^^^^^^
"KRN",101,5164,4)
^
"KRN",101,5164,10,0)
^101.01PA
"KRN",101,5164,15)
D DESELECT^OREV K ^TMP("OREDO",$J)
"KRN",101,5164,20)
D EEE^OREV
"KRN",101,5164,26)

"KRN",101,5164,99)
59063,49029
"KRN",101,5165,-1)
0^43
"KRN",101,5165,0)
OREV MAIN DETAILED DISPLAY^Detailed Display^^A^^^^^^^^
"KRN",101,5165,4)

"KRN",101,5165,15)
D DESELECT^OREV
"KRN",101,5165,20)
D EN^VALM("OREV DETAILED DISPLAY")
"KRN",101,5165,26)

"KRN",101,5165,99)
59063,49029
"KRN",101,5166,-1)
0^44
"KRN",101,5166,0)
OREV SWITCH^Activate/Inactivate^^A^^^^^^^^
"KRN",101,5166,15)
D DESELECT^OREV
"KRN",101,5166,20)
D ACT^OREV1
"KRN",101,5166,99)
59063,49029
"KRN",101,5167,-1)
0^37
"KRN",101,5167,0)
OREV EDIT EVENT DELAY PARAMS^Edit Event Delay Params^^A^^^^^^^^
"KRN",101,5167,15)
D DESELECT^OREV
"KRN",101,5167,20)
D PARAM^OREV3
"KRN",101,5167,99)
59063,49586
"KRN",101,5168,-1)
0^36
"KRN",101,5168,0)
OREV DETAILED MENU^^^M^^^^^^^^
"KRN",101,5168,4)
25^5
"KRN",101,5168,10,0)
^101.01PA^3^3
"KRN",101,5168,10,1,0)
5169^AI^^
"KRN",101,5168,10,1,"^")
OREV SWITCH IN DETAIL
"KRN",101,5168,10,2,0)
5170^AE^^
"KRN",101,5168,10,2,"^")
OREV ENTER/EDIT ENTRIES IN DETAIL
"KRN",101,5168,10,3,0)
5177^HIS^^
"KRN",101,5168,10,3,"^")
OREV INCLUDE HISTORIES
"KRN",101,5168,15)

"KRN",101,5168,20)

"KRN",101,5168,26)
D SHOW^VALM
"KRN",101,5168,99)
59063,49029
"KRN",101,5169,-1)
0^45
"KRN",101,5169,0)
OREV SWITCH IN DETAIL^Activate/Inactivate^^A^^^^^^^^
"KRN",101,5169,15)
D DET^OREV2
"KRN",101,5169,20)
D ACT^OREV1
"KRN",101,5169,99)
59063,49029
"KRN",101,5170,-1)
0^40
"KRN",101,5170,0)
OREV ENTER/EDIT ENTRIES IN DETAIL^Add/Edit^^A^^^^^^^^
"KRN",101,5170,15)
D DET^OREV2
"KRN",101,5170,20)
D EEE^OREV
"KRN",101,5170,99)
59063,49029
"KRN",101,5171,-1)
0^41
"KRN",101,5171,0)
OREV ENTER/EDIT EVENTS MENU^Enter/Edit OE/RR Events...^^M^^^^^^^^
"KRN",101,5171,4)
25^4
"KRN",101,5171,10,0)
^101.01PA^6^6
"KRN",101,5171,10,1,0)
5164^AE^^
"KRN",101,5171,10,1,"^")
OREV ENTER/EDIT ENTRIES
"KRN",101,5171,10,2,0)
5165^DD^^
"KRN",101,5171,10,2,"^")
OREV MAIN DETAILED DISPLAY
"KRN",101,5171,10,3,0)
5166^AI^^
"KRN",101,5171,10,3,"^")
OREV SWITCH
"KRN",101,5171,10,4,0)
5167^EP^^
"KRN",101,5171,10,4,"^")
OREV EDIT EVENT DELAY PARAMS
"KRN",101,5171,10,5,0)
5178^CD^^
"KRN",101,5171,10,5,"^")
OREV CHANGE DISPLAY
"KRN",101,5171,10,6,0)
5187^CC^^
"KRN",101,5171,10,6,"^")
OREV ADD CHILD
"KRN",101,5171,20)
D LIST^OREV,CHKSEL^OREV
"KRN",101,5171,26)
D PHDR^OREV
"KRN",101,5171,28)
Select action: 
"KRN",101,5171,99)
59063,49587
"KRN",101,5172,-1)
0^1
"KRN",101,5172,0)
ORC DELAYED ORDERS^Delayed Orders^^A^^^^^^^^
"KRN",101,5172,2,0)
^101.02A^1^1
"KRN",101,5172,2,1,0)
TD
"KRN",101,5172,2,"B","TD",1)

"KRN",101,5172,15)
S:$D(^TMP("OR",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"KRN",101,5172,20)
D EN^OREVNT
"KRN",101,5172,24)

"KRN",101,5172,99)
59016,47524
"KRN",101,5173,-1)
0^3
"KRN",101,5173,0)
ORC DELAY EVENT^Edit Release Event^^A^^^^^^^^
"KRN",101,5173,15)
D EX^ORCACT
"KRN",101,5173,20)
D ED^OREVNT
"KRN",101,5173,99)
59016,47524
"KRN",101,5174,-1)
0^14
"KRN",101,5174,0)
ORC DELAYED ORDER ACTIONS^Order action menu for delayed order views^^M^^^^^^^^
"KRN",101,5174,4)
20^2
"KRN",101,5174,10,0)
^101.01PA^11^11
"KRN",101,5174,10,1,0)
3913^^11^
"KRN",101,5174,10,1,"^")
ORC CHANGE ORDERS
"KRN",101,5174,10,2,0)
5173^^13^
"KRN",101,5174,10,2,"^")
ORC DELAY EVENT
"KRN",101,5174,10,3,0)
3914^^21^
"KRN",101,5174,10,3,"^")
ORC SIGN ORDERS
"KRN",101,5174,10,4,0)
3916^^33^
"KRN",101,5174,10,4,"^")
ORC WARD COMMENTS
"KRN",101,5174,10,5,0)
3917^^41^^^Details
"KRN",101,5174,10,5,"^")
ORC DETAILED DISPLAY
"KRN",101,5174,10,6,0)
3922^^23^^^Cancel
"KRN",101,5174,10,6,"^")
ORC DISCONTINUE ORDERS
"KRN",101,5174,10,7,0)
5176^^22^^^
"KRN",101,5174,10,7,"^")
ORC RELEASE ORDERS
"KRN",101,5174,10,8,0)
3925^^31^
"KRN",101,5174,10,8,"^")
ORC FLAG ORDERS
"KRN",101,5174,10,9,0)
4016^^43^
"KRN",101,5174,10,9,"^")
ORC PRINT ORDERS
"KRN",101,5174,10,10,0)
4019^^32^
"KRN",101,5174,10,10,"^")
ORC UNFLAG ORDERS
"KRN",101,5174,10,11,0)
4072^^42^
"KRN",101,5174,10,11,"^")
ORC ALERT RESULTS
"KRN",101,5174,15)
I '$G(OREBUILD),$G(ORNMBR) D DESELECT^ORCHART(ORNMBR)
"KRN",101,5174,20)
Q:$$DONE^OREVNT1  S XQORM(0)="1AD\",(XQORM("?"),XQORM("??"))="D ITEMHELP^ORCHART",VALMBCK="",ORNMBR=$P(XQORNOD(0),"=",2) D SELECT^ORCHART(ORNMBR)
"KRN",101,5174,26)
W ""
"KRN",101,5174,28)
Select Action: 
"KRN",101,5174,99)
59035,38332
"KRN",101,5175,-1)
0^7
"KRN",101,5175,0)
ORCHANGE EVENT^Auto DC/Release Event^^A^^^^^^^^
"KRN",101,5175,20)
D EVT^ORCHANG3
"KRN",101,5175,99)
59036,48868
"KRN",101,5176,-1)
0^2
"KRN",101,5176,0)
ORC RELEASE ORDERS^Release Orders^^A^^^^^^^^
"KRN",101,5176,15)
D EX^ORCACT
"KRN",101,5176,20)
D EN^OREVNT1
"KRN",101,5176,99)
59035,38332
"KRN",101,5177,-1)
0^42
"KRN",101,5177,0)
OREV INCLUDE HISTORIES^Add/Remove Histories^^A^^^^^^^^
"KRN",101,5177,15)
S VALMBG=1 D DET^OREV2
"KRN",101,5177,20)
D INCHIST^OREV2
"KRN",101,5177,99)
59063,49029
"KRN",101,5178,-1)
0^35
"KRN",101,5178,0)
OREV CHANGE DISPLAY^Change display^^A^^^^^^^^
"KRN",101,5178,15)
D HDR^OREV
"KRN",101,5178,20)
D CD^OREV2
"KRN",101,5178,99)
59063,49587
"KRN",101,5187,-1)
0^46
"KRN",101,5187,0)
OREV ADD CHILD^Create Child Event^^A^^^^^^^^
"KRN",101,5187,15)
D DESELECT^OREV K ^TMP("OREDO",$J)
"KRN",101,5187,20)
D ACE^OREV3
"KRN",101,5187,99)
59063,49587
"KRN",101,5223,-1)
1^30
"KRN",101,5223,0)
ORC DELAY DC
"KRN",101,5224,-1)
1^31
"KRN",101,5224,0)
ORC DELAY EDIT TS
"KRN",101,5225,-1)
1^32
"KRN",101,5225,0)
ORC DELAY RELEASE
"KRN",409.61,374,-1)
0^2
"KRN",409.61,374,0)
OR CHART^1^^240^6^18^1^1^^ORCHART ORDERS MENU^Patient Chart^4^^1
"KRN",409.61,374,1)
^ORC HIDDEN ACTIONS
"KRN",409.61,374,"ARRAY")
 ^TMP("OR",$J,"CURRENT")
"KRN",409.61,374,"COL",0)
^409.621^5^4
"KRN",409.61,374,"COL",1,0)
NUMBER^1^3^^H
"KRN",409.61,374,"COL",3,0)
ITEM^6^41^^^1
"KRN",409.61,374,"COL",4,0)
DATA^48^33
"KRN",409.61,374,"COL",5,0)
MORE^81^33
"KRN",409.61,374,"COL","AIDENT",1,3)

"KRN",409.61,374,"COL","B","DATA",4)

"KRN",409.61,374,"COL","B","ITEM",3)

"KRN",409.61,374,"COL","B","MORE",5)

"KRN",409.61,374,"COL","B","NUMBER",1)

"KRN",409.61,374,"FNL")
D EXIT^ORCHART
"KRN",409.61,374,"HDR")
D HDR^ORCHART
"KRN",409.61,374,"HLP")
D HELP^ORCHART
"KRN",409.61,374,"INIT")
D INIT^ORCHART
"KRN",409.61,381,-1)
0^1
"KRN",409.61,381,0)
OR DELAYED ORDERS^1^^240^6^20^1^1^Order^ORC DELAY ORDERS MENU^Delayed Orders^4^^1
"KRN",409.61,381,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,381,"ARRAY")
 ^TMP("OR",$J,"CURRENT")
"KRN",409.61,381,"COL",0)
^409.621^3^3
"KRN",409.61,381,"COL",1,0)
NUMBER^1^3^^H
"KRN",409.61,381,"COL",2,0)
ITEM^6^41^Item Ordered^^1
"KRN",409.61,381,"COL",3,0)
DATA^48^33^Delayed Until
"KRN",409.61,381,"COL","AIDENT",1,2)

"KRN",409.61,381,"COL","B","DATA",3)

"KRN",409.61,381,"COL","B","ITEM",2)

"KRN",409.61,381,"COL","B","NUMBER",1)

"KRN",409.61,381,"FNL")
D EXIT^ORCACT3
"KRN",409.61,381,"HDR")
D HDR^ORCHART
"KRN",409.61,381,"HLP")
D HELP^ORCACT3
"KRN",409.61,381,"INIT")
D INIT^ORCACT3
"KRN",409.61,559,-1)
0^4
"KRN",409.61,559,0)
OREV EVENT ACTIONS^1^^132^4^20^0^1^^OREV ENTER/EDIT EVENTS MENU^Release events^1^^1
"KRN",409.61,559,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,559,"ARRAY")
 ^TMP("OREDO",$J)
"KRN",409.61,559,"COL",0)
^409.621^5^4
"KRN",409.61,559,"COL",1,0)
NAME^5^40^Event Name^
"KRN",409.61,559,"COL",3,0)
ACT^67^8^Active?
"KRN",409.61,559,"COL",4,0)
EVENT^76^5^Event
"KRN",409.61,559,"COL",5,0)
DISPTXT^46^20^Display Text
"KRN",409.61,559,"COL","B","ACT",3)

"KRN",409.61,559,"COL","B","DISPTXT",5)

"KRN",409.61,559,"COL","B","EVENT",4)

"KRN",409.61,559,"COL","B","NAME",1)

"KRN",409.61,559,"FNL")
D EXIT^OREV
"KRN",409.61,559,"HDR")
D HDR^OREV
"KRN",409.61,559,"HLP")
D HELP^OREV
"KRN",409.61,559,"INIT")
D INIT^OREV
"KRN",409.61,560,-1)
0^5
"KRN",409.61,560,0)
OREV DETAILED DISPLAY^1^^90^2^21^0^1^^OREV DETAILED MENU^Detailed Display^1^^1
"KRN",409.61,560,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,560,"ARRAY")
 ^TMP("ORCXPND",$J)
"KRN",409.61,560,"FNL")

"KRN",409.61,560,"HDR")

"KRN",409.61,560,"HLP")

"KRN",409.61,560,"INIT")
D DET^OREV2
"KRN",409.61,561,-1)
0^3
"KRN",409.61,561,0)
OREV AUTO-DC ACTIONS^1^^132^4^20^0^1^^OREV ENTER/EDIT AUTO DC MENU^Auto-DC events/rules^1^^1
"KRN",409.61,561,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,561,"ARRAY")
 ^TMP("OREDO",$J)
"KRN",409.61,561,"COL",0)
^409.621^4^4
"KRN",409.61,561,"COL",1,0)
NAME^5^40^Auto-DC Rule Name^
"KRN",409.61,561,"COL",2,0)
DISPTXT^46^20^Display Text
"KRN",409.61,561,"COL",3,0)
ACT^67^8^Active?
"KRN",409.61,561,"COL",4,0)
EVENT^76^5^Event
"KRN",409.61,561,"COL","B","ACT",3)

"KRN",409.61,561,"COL","B","DISPTXT",2)

"KRN",409.61,561,"COL","B","EVENT",4)

"KRN",409.61,561,"COL","B","NAME",1)

"KRN",409.61,561,"FNL")
D EXIT^OREV
"KRN",409.61,561,"HDR")
D HDR^OREV
"KRN",409.61,561,"HLP")
D HELP^OREV
"KRN",409.61,561,"INIT")
D INIT^OREV
"KRN",8994,141,-1)
0^1
"KRN",8994,141,0)
ORQOR DETAIL^DETAIL^ORWOR^4^S^^^1
"KRN",8994,141,1,0)
^8994.01^1^1^3020228^^^^
"KRN",8994,141,1,1,0)
Returns detailed information regarding an order.
"KRN",8994,141,2,0)
^8994.02A^2^1
"KRN",8994,141,2,2,0)
ORDER^1^16^1
"KRN",8994,141,2,2,1,0)
^8994.021^1^1^3020228^^^^
"KRN",8994,141,2,2,1,1,0)
Order identifier/number from file #100.
"KRN",8994,141,2,"B","ORDER",2)

"KRN",8994,141,3,0)
^8994.03^1^1^3020228^^^^
"KRN",8994,141,3,1,0)
Array of detailed order information.
"KRN",8994,1124,-1)
0^33
"KRN",8994,1124,0)
ORWOR PKIUSE^PKIUSE^ORWOR^1
"KRN",8994,1127,-1)
0^34
"KRN",8994,1127,0)
ORWOR1 CHKDIG^CHKDIG^ORWOR1^1
"KRN",8994,1127,1,0)
^8994.01^1^1^3020403^^
"KRN",8994,1127,1,1,0)
Returns true if an order requires a digital signature.
"KRN",8994,1128,-1)
0^36
"KRN",8994,1128,0)
ORWOR1 GETDTEXT^GETDTEXT^ORWOR1^2
"KRN",8994,1128,1,0)
^8994.01^1^1^3020403^^^
"KRN",8994,1128,1,1,0)
Returns the external text of an existing order.
"KRN",8994,1129,-1)
0^35
"KRN",8994,1129,0)
ORWOR1 GETDSIG^GETDSIG^ORWOR1^1
"KRN",8994,1129,1,0)
^8994.01^1^1^3020403^^^^
"KRN",8994,1129,1,1,0)
Returns the digital signature of an existing order.
"KRN",8994,1130,-1)
0^37
"KRN",8994,1130,0)
ORWOR1 SIG^SIG^ORWOR1^1
"KRN",8994,1130,1,0)
^8994.01^1^1^3020404^^^^
"KRN",8994,1130,1,1,0)
Returns 1 if signature gets stored.
"KRN",8994,1201,-1)
0^41
"KRN",8994,1201,0)
ORWOR RESULT HISTORY^RESHIST^ORWOR^4^^^^1
"KRN",8994,1201,1,0)
^8994.01^1^1^3020507^^
"KRN",8994,1201,1,1,0)
Returns a result history of a CPRS order.
"KRN",8994,1202,-1)
0^43
"KRN",8994,1202,0)
ORWCIRN CHECKLINK^CHKLNK^ORWCIRN^1
"KRN",8994,1202,1,0)
^^1^1^3020507^
"KRN",8994,1202,1,1,0)
Check to see if HL7 TCP link is active.
"KRN",8994,1203,-1)
0^2
"KRN",8994,1203,0)
OREVNTX PAT^PAT^OREVNTX^2^^^^1
"KRN",8994,1204,-1)
0^3
"KRN",8994,1204,0)
OREVNTX ACTIVE^ACTIVE^OREVNTX^2^^^^1
"KRN",8994,1205,-1)
0^4
"KRN",8994,1205,0)
OREVNTX1 PUTEVNT^PUTEVNT^OREVNTX1^1^^^^1
"KRN",8994,1206,-1)
0^5
"KRN",8994,1206,0)
OREVNTX1 GTEVT^GTEVT^OREVNTX1^1^^^^1
"KRN",8994,1207,-1)
0^7
"KRN",8994,1207,0)
OREVNTX1 WRLSTED^WRLSTED^OREVNTX1^2^^^^1
"KRN",8994,1208,-1)
0^8
"KRN",8994,1208,0)
OREVNTX1 EVT^EVT^OREVNTX1^1^^^^1
"KRN",8994,1209,-1)
0^9
"KRN",8994,1209,0)
OREVNTX1 EXISTS^EXISTS^OREVNTX1^1
"KRN",8994,1210,-1)
0^10
"KRN",8994,1210,0)
OREVNTX1 NAME^NAME^OREVNTX1^1^^^^1
"KRN",8994,1211,-1)
0^11
"KRN",8994,1211,0)
OREVNTX1 MATCH^MATCH^OREVNTX1^1
"KRN",8994,1212,-1)
0^6
"KRN",8994,1212,0)
OREVNTX1 GTEVT1^GTEVT1^OREVNTX1^1^^^^1
"KRN",8994,1213,-1)
0^15
"KRN",8994,1213,0)
OREVNTX1 DIV^DIV^OREVNTX1^1^^^^1
"KRN",8994,1214,-1)
0^16
"KRN",8994,1214,0)
OREVNTX1 DIV1^DIV1^OREVNTX1^1^^^^1
"KRN",8994,1215,-1)
0^17
"KRN",8994,1215,0)
OREVNTX1 LOC^LOC^OREVNTX1^1^^^^1
"KRN",8994,1216,-1)
0^18
"KRN",8994,1216,0)
OREVNTX1 LOC1^LOC1^OREVNTX1^1^^^^1
"KRN",8994,1217,-1)
0^19
"KRN",8994,1217,0)
OREVNTX1 CHGEVT^CHGEVT^OREVNTX1^1
"KRN",8994,1218,-1)
0^12
"KRN",8994,1218,0)
OREVNTX1 EMPTY^EMPTY^OREVNTX1^1
"KRN",8994,1219,-1)
0^13
"KRN",8994,1219,0)
OREVNTX1 DELPTEVT^DELPTEVT^OREVNTX1^1
"KRN",8994,1220,-1)
0^23
"KRN",8994,1220,0)
ORWDX SENDED^SENDED^ORWDX^2^^^^1
"KRN",8994,1221,-1)
0^20
"KRN",8994,1221,0)
OREVNTX1 GETDLG^GETDLG^OREVNTX1^1^^^^1
"KRN",8994,1222,-1)
0^21
"KRN",8994,1222,0)
OREVNTX1 CURSPE^CURSPE^OREVNTX1^1^^^^1
"KRN",8994,1222,2,0)
^8994.02A^^0
"KRN",8994,1223,-1)
0^14
"KRN",8994,1223,0)
OREVNTX1 DFLTEVT^DFLTEVT^OREVNTX1^1^^^^1
"KRN",8994,1224,-1)
0^22
"KRN",8994,1224,0)
OREVNTX1 DONE^DONE^OREVNTX1^1
"KRN",8994,1225,-1)
0^24
"KRN",8994,1225,0)
OREVNTX1 CPACT^CPACT^OREVNTX1^1
"KRN",8994,1226,-1)
0^25
"KRN",8994,1226,0)
OREVNTX1 PRMPTID^PRMPTID^OREVNTX1^1^^^^1
"KRN",8994,1227,-1)
0^29
"KRN",8994,1227,0)
ORECS01 CHKESSO^CHKESSO^ORECS01^1
"KRN",8994,1228,-1)
0^30
"KRN",8994,1228,0)
ORECS01 VSITID^VSITID^ORECS01^1
"KRN",8994,1229,-1)
0^26
"KRN",8994,1229,0)
OREVNTX LIST^LIST^OREVNTX^2^^^^1
"KRN",8994,1230,-1)
0^32
"KRN",8994,1230,0)
ORECS01 ECPRINT^ECPRINT^ORECS01^1^^^^1
"KRN",8994,1231,-1)
0^31
"KRN",8994,1231,0)
ORECS01 ECRPT^ECRPT^ORECS01^4^S^^^1
"KRN",8994,1232,-1)
0^27
"KRN",8994,1232,0)
OREVNTX1 ISDCOD^ISDCOD^OREVNTX1^1
"KRN",8994,1233,-1)
0^28
"KRN",8994,1233,0)
OREVNTX1 SETDFLT^SETDFLT^OREVNTX1^1^^^^1
"KRN",8994,1234,-1)
0^38
"KRN",8994,1234,0)
ORWDPS1 HASOIPI^HASOIPI^ORWDPS1^1
"KRN",8994,1235,-1)
0^39
"KRN",8994,1235,0)
OREVNTX1 DEFLTS^DEFLTS^OREVNTX1^1^^^^1
"KRN",8994,1236,-1)
0^40
"KRN",8994,1236,0)
OREVNTX1 MULTS^MULTS^OREVNTX1^2^^^^1
"KRN",8994,1237,-1)
0^42
"KRN",8994,1237,0)
OREVNTX1 PROMPT IDS^PRTIDS^OREVNTX1^1^^^^1
"KRN",8994,1238,-1)
0^44
"KRN",8994,1238,0)
ORWDPS1 HASROUTE^HASROUTE^ORWDPS1^1
"KRN",8994,1239,-1)
0^45
"KRN",8994,1239,0)
OREVNTX1 DELDFLT^DELDFLT^OREVNTX1^1
"KRN",8994,1240,-1)
0^46
"KRN",8994,1240,0)
OREVNTX1 DFLTDLG^DFLTDLG^OREVNTX1^1^^^^1
"KRN",8994,1241,-1)
0^47
"KRN",8994,1241,0)
ORECS01 GETDIV^GETDIV^ORECS01^1
"KRN",8994,1241,3,0)
^^1^1^3020819^
"KRN",8994,1241,3,1,0)
&^
"KRN",8994,1254,-1)
0^48
"KRN",8994,1254,0)
OREVNTX1 TYPEXT^TYPEXT^OREVNTX1^1
"KRN",8994,1255,-1)
0^49
"KRN",8994,1255,0)
ORWORR RGET^RGET^ORWORR^4^^^^1
"KRN",8994,1256,-1)
0^50
"KRN",8994,1256,0)
OREVNTX1 AUTHMREL^AUTHMREL^OREVNTX1^1
"KRN",8994,1257,-1)
0^51
"KRN",8994,1257,0)
OREVNTX1 HAVEPRT^HAVEPRT^OREVNTX1^1
"KRN",8994,1258,-1)
0^52
"KRN",8994,1258,0)
OREVNTX1 CMEVTS^CMEVTS^OREVNTX1^2^^^^1
"KRN",8994,1259,-1)
0^53
"KRN",8994,1259,0)
OREVNTX1 ODPTEVID^ODPTEVID^OREVNTX1^1
"KRN",8994,1260,-1)
0^54
"KRN",8994,1260,0)
ORWOR PKISITE^PKISITE^ORWOR^1
"KRN",8994,1261,-1)
0^56
"KRN",8994,1261,0)
OREVNTX1 COMP^COMP^OREVNTX1^1
"KRN",8994,1262,-1)
0^55
"KRN",8994,1262,0)
OREVNTX1 ISHDORD^ISHDORD^OREVNTX1^1
"KRN",8994,1266,-1)
0^57
"KRN",8994,1266,0)
OREVNTX1 ISPASS^ISPASS^OREVNTX1^1
"KRN",8994,1267,-1)
0^58
"KRN",8994,1267,0)
OREVNTX1 ISPASS1^ISPASS1^OREVNTX1^1
"KRN",8994,1268,-1)
0^59
"KRN",8994,1268,0)
OREVNTX1 DLGIEN^DLGIEN^OREVNTX1^1
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PGL",101.41,0,5,5)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"PGL",101.41,0,7,7)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"PGL",101.41,5,9,59)
URL^P101.14^ORD(101.14,^5;9^Q
"PGL",101.412,0,2,2)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"PGL",101.412,0,11,1)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"PGL",101.415,0,2,2)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"PGL",101.416,0,2,.02)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"PGL",8989.52,0,3,.03)
USE ENTITY FROM^*P1'^DIC(^0;3^S DIC("S")="I $$ALLOW^XPARDD1(Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",8989.52,0,4,.04)
USE INSTANCE FROM^P8989.51'^XTV(8989.51,^0;4^Q
"PGL",8989.521,0,2,.02)
PARAMETER^P8989.51'^XTV(8989.51,^0;2^Q
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
141^3021114^1362
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
83
"RTN","ORCACT")
0^1^B16893781
"RTN","ORCACT",1,0)
ORCACT ; SLC/MKB - Act on orders ;4/2/02  16:41
"RTN","ORCACT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,48,92,94,141**;Dec 17, 1997
"RTN","ORCACT",3,0)
ADD ; -- add new order via NW on pkg results tab
"RTN","ORCACT",4,0)
 ;    Requires ORDIALOG = name of pkg dialog
"RTN","ORCACT",5,0)
 N ORPTLK,OREVENT,X S VALMBCK="" G:'$L($G(ORDIALOG)) ADQ
"RTN","ORCACT",6,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCACT",7,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCACT",8,0)
 I $G(ORTAB)'="COVER" S X=$$DELAY G:X="^" ADQ I X D  G:X="^" ADQ
"RTN","ORCACT",9,0)
 . S X=$$PTEVENT^OREVNT(+ORVP,1)
"RTN","ORCACT",10,0)
 . S:X'="^" OREVENT=+X
"RTN","ORCACT",11,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" ADQ
"RTN","ORCACT",12,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 G:ORL["^" ADQ
"RTN","ORCACT",13,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",$E(ORDIALOG,1,63),0)) G:'ORDIALOG ADQ
"RTN","ORCACT",14,0)
 D ADD^ORCDLG,REBLD^ORCMENU:$D(^TMP("ORNEW",$J))
"RTN","ORCACT",15,0)
 K ORDIALOG,^TMP("ORWORD",$J),^TMP("ORECALL",$J) S VALMBCK="R"
"RTN","ORCACT",16,0)
ADQ S:$D(^TMP("OR",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","ORCACT",17,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCACT",18,0)
 Q
"RTN","ORCACT",19,0)
 ;
"RTN","ORCACT",20,0)
EDIT ; -- change orders
"RTN","ORCACT",21,0)
 D EN("XX") Q
"RTN","ORCACT",22,0)
 ;
"RTN","ORCACT",23,0)
RENEW ; -- renew orders
"RTN","ORCACT",24,0)
 D EN("RN") Q
"RTN","ORCACT",25,0)
 ;
"RTN","ORCACT",26,0)
REWRITE ; -- rewrite orders
"RTN","ORCACT",27,0)
 N OREVENT,X S X=$$DELAY Q:X="^"  I X D  Q:X="^"
"RTN","ORCACT",28,0)
 . S X=$$PTEVENT^OREVNT(+ORVP,1)
"RTN","ORCACT",29,0)
 . S:X'="^" OREVENT=+X
"RTN","ORCACT",30,0)
 D EN("RW") Q
"RTN","ORCACT",31,0)
 ;
"RTN","ORCACT",32,0)
HOLD ; -- hold orders
"RTN","ORCACT",33,0)
 D EN("HD") Q
"RTN","ORCACT",34,0)
 ;
"RTN","ORCACT",35,0)
UNHOLD ; -- release hold on orders
"RTN","ORCACT",36,0)
 D EN("RL") Q
"RTN","ORCACT",37,0)
 ;
"RTN","ORCACT",38,0)
EN(ORACT) ; -- start here with:
"RTN","ORCACT",39,0)
 ;    ORNMBR = #,#,...,# of selected orders
"RTN","ORCACT",40,0)
 ;    ORACT  = action to be taken on orders
"RTN","ORCACT",41,0)
 ;
"RTN","ORCACT",42,0)
 ;    OREBUILD defined on return if Orders tab needs to be rebuilt
"RTN","ORCACT",43,0)
 ;
"RTN","ORCACT",44,0)
 N ORI,NMBR,ORQUIT,ORIFN,ORIG,ORSIG,OREL,ORPTLK,ORLK,IDX,ORDITM,ORPRINT,ORERR,ORDER,ORSTS,ORPRNT,ORNOW,ORDG,ORXNP S VALMBCK=""
"RTN","ORCACT",45,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCACT",46,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR ENQ
"RTN","ORCACT",47,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","ORCACT",48,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" ENQ
"RTN","ORCACT",49,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 G:ORL="^" ENQ
"RTN","ORCACT",50,0)
EN1 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCACT",51,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR))
"RTN","ORCACT",52,0)
 . S ORIFN=$S(ORTAB="MEDS":$P(IDX,U,4),1:$P(IDX,U)) Q:'ORIFN
"RTN","ORCACT",53,0)
 . I '$D(^OR(100,+ORIFN,0)) W !,"This order has been deleted!" H 2 Q
"RTN","ORCACT",54,0)
 . S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";"_+$P($G(^OR(100,+ORIFN,3)),U,7)
"RTN","ORCACT",55,0)
 . S ORIG=+ORIFN,ORDITM=$$ORDITEM(ORIFN) D SUBHDR(ORDITM)
"RTN","ORCACT",56,0)
 . I '$$VALID^ORCACT0(ORIFN,ORACT,.ORERR) W !,ORERR H 2 Q
"RTN","ORCACT",57,0)
 . I $$NMSP^ORCD(+$P(^OR(100,+ORIFN,0),U,14))="PS" D PROVIDER^ORCDPSIV Q:$G(ORQUIT)
"RTN","ORCACT",58,0)
 . S ORLK=$S('$D(^TMP("ORNEW",$J,ORIG)):$$LOCK1^ORX2(ORIG),1:1) I 'ORLK W !,$P(ORLK,U,2) H 2 Q
"RTN","ORCACT",59,0)
 . D @(ORACT_"^ORCACT4") ;sets ^TMP("ORNEW",$J,ORIFN),[ORIFN]
"RTN","ORCACT",60,0)
 . D:'$O(^TMP("ORNEW",$J,ORIG,0)) UNLK1^ORX2(ORIG) ;unlk if not chngd
"RTN","ORCACT",61,0)
 S:$O(^TMP("ORNEW",$J,0)) OREBUILD=1
"RTN","ORCACT",62,0)
ENQ D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCACT",63,0)
 S:$G(ORXNP) ORNP=ORXNP
"RTN","ORCACT",64,0)
 Q
"RTN","ORCACT",65,0)
 ;
"RTN","ORCACT",66,0)
ORDITEM(ID) ; -- Returns order text
"RTN","ORCACT",67,0)
 ;N X,I,MORE S X=""
"RTN","ORCACT",68,0)
 ;I $P(ID,";",2)>1 S I=$P($G(^OR(100,+ID,8,+$P(ID,";",2),0)),U,2),X=$S(I="DC":"Discontinue ",I="HD":"Hold ",1:"")
"RTN","ORCACT",69,0)
 ;S I=$O(^OR(100,+ID,1,0)) Q:'I "" S MORE=$O(^(I)),X=X_$G(^(I,0))
"RTN","ORCACT",70,0)
 ;I $L(X)>68 S MORE=1,X=$E(X,1,68)
"RTN","ORCACT",71,0)
 ;S:MORE X=X_" ..."
"RTN","ORCACT",72,0)
 N X,ORX D TEXT^ORQ12(.ORX,ID,68) S X=ORX(1)_$S(ORX>1:" ...",1:"")
"RTN","ORCACT",73,0)
 Q X
"RTN","ORCACT",74,0)
 ;
"RTN","ORCACT",75,0)
SUBHDR(X) ; -- Display subheader of order being acted on
"RTN","ORCACT",76,0)
 W !!,?(36-($L(X)\2)),"-- "_X_" --",!
"RTN","ORCACT",77,0)
 Q
"RTN","ORCACT",78,0)
 ;
"RTN","ORCACT",79,0)
DELAY() ; -- Delay release of orders?
"RTN","ORCACT",80,0)
 I '$D(^ORD(100.5,"C")) Q 0 ;no active events
"RTN","ORCACT",81,0)
 N X,Y,DIR S DIR(0)="YA",DIR("B")="NO"
"RTN","ORCACT",82,0)
 S DIR("A")="Delay release of these orders? "
"RTN","ORCACT",83,0)
 S DIR("?")="Enter NO to release these orders immediately upon signature; YES will delay release of these orders until the specified patient movement occurs."
"RTN","ORCACT",84,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","ORCACT",85,0)
 Q Y
"RTN","ORCACT",86,0)
 ;
"RTN","ORCACT",87,0)
EX ; -- exit action
"RTN","ORCACT",88,0)
 I $G(OREBUILD) D  ;rebuild tabs
"RTN","ORCACT",89,0)
 . I $G(ORTAB)="ORDERS"!($G(ORTAB)="DELAY") D  Q
"RTN","ORCACT",90,0)
 .. N TAB D TAB^ORCHART(ORTAB,1)
"RTN","ORCACT",91,0)
 .. F TAB="MEDS","CONSULTS" S:$D(^TMP("OR",$J,TAB,0)) $P(^(0),U)=""
"RTN","ORCACT",92,0)
 . S:$D(^TMP("OR",$J,"ORDERS",0)) $P(^(0),U)="" ;rebld next time
"RTN","ORCACT",93,0)
 . D:$G(ORTAB)="NEW" INIT^ORCMENU2 ;when called from RV
"RTN","ORCACT",94,0)
 I $G(ORTAB)'="NEW",$D(^TMP("OR",$J,"CURRENT","MENU")) S XQORM("HIJACK")=^("MENU")
"RTN","ORCACT",95,0)
 Q
"RTN","ORCACT0")
0^2^B42124576
"RTN","ORCACT0",1,0)
ORCACT0 ;SLC/MKB-Validate order action ;02:46 PM  26 Jan 2001
"RTN","ORCACT0",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,72,86,92,94,141**;Dec 17, 1997
"RTN","ORCACT0",3,0)
VALID(IFN,ACTION,ERROR,NATR) ; -- Determines if action is valid for order IFN
"RTN","ORCACT0",4,0)
 N OR0,OR3,ORA0,AIFN,PKG,DG,ORDSTS,ACTSTS,VER,X,Y,MEDPARM K ERROR
"RTN","ORCACT0",5,0)
 S OR0=$G(^OR(100,+IFN,0)),OR3=$G(^(3)),PKG=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORCACT0",6,0)
 S MEDPARM=$S($G(NATR)="A":2,PKG'="PS":2,'$D(^XUSEC("OREMAS",DUZ)):2,1:$$GET^XPAR("ALL","OR OREMAS MED ORDERS"))
"RTN","ORCACT0",7,0)
 S AIFN=$P(IFN,";",2) S:'AIFN AIFN=+$P(OR3,U,7)
"RTN","ORCACT0",8,0)
 S ORA0=$G(^OR(100,+IFN,8,AIFN,0)),ACTSTS=$P(ORA0,U,15)
"RTN","ORCACT0",9,0)
 S ORDSTS=$P(OR3,U,3),VER=$S($P(OR0,U,5)["101.41":3,1:2)
"RTN","ORCACT0",10,0)
 S DG=$P($G(^ORD(100.98,+$P(OR0,U,11),0)),U,3)
"RTN","ORCACT0",11,0)
CM I ACTION="CM" G VQ ; ward comments - no restrictions
"RTN","ORCACT0",12,0)
FL I ACTION="FL" D  G VQ ; flag
"RTN","ORCACT0",13,0)
 . I +$G(^OR(100,+IFN,8,AIFN,3)) S ERROR="This order is already flagged!" Q
"RTN","ORCACT0",14,0)
UF I ACTION="UF" D  G VQ ; unflag
"RTN","ORCACT0",15,0)
 . I '+$G(^OR(100,+IFN,8,AIFN,3)) S ERROR="This order is not flagged!" Q
"RTN","ORCACT0",16,0)
DC1 I ACTION="DC",ACTSTS D  G VQ ; discontinue/cancel unrel or canc order
"RTN","ORCACT0",17,0)
 . I (ACTSTS=11)!(ACTSTS=10) D  Q  ; unreleased
"RTN","ORCACT0",18,0)
 .. I 'MEDPARM S ERROR="You are not authorized to cancel med orders!" Q
"RTN","ORCACT0",19,0)
 .. I $G(NATR)="A" S X=$O(^ORE(100.2,"AO",+IFN,0)) I X,'$G(^ORE(100.2,X,1)) S ERROR="Future event orders may not be auto-discontinued!" Q
"RTN","ORCACT0",20,0)
 . I ACTSTS=12 S ERROR="This order has been dc'd due to edit!" Q
"RTN","ORCACT0",21,0)
 . I ACTSTS=13 S ERROR="This order has been cancelled!" Q
"RTN","ORCACT0",22,0)
ES I (ACTION="ES")!(ACTION="OC")!(ACTION="RS")!(ACTION="DS") D ES^ORCACT01 G VQ ; sign
"RTN","ORCACT0",23,0)
VR I ACTION="VR" D  G VQ ; verify
"RTN","ORCACT0",24,0)
 . I $G(ORVER)="N",$P(ORA0,U,9) S ERROR="This order has been verified!" Q
"RTN","ORCACT0",25,0)
 . I $G(ORVER)="C",$P(ORA0,U,11) S ERROR="This order has been verified!" Q
"RTN","ORCACT0",26,0)
 . I $G(ORVER)="R",$P(ORA0,U,19) S ERROR="This order has been reviewed!" Q
"RTN","ORCACT0",27,0)
 . I (ACTSTS=11)!(ACTSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT0",28,0)
 . I AIFN=1,ORDSTS=5,PKG="PS" S X=$$DISABLED I X S ERROR=$P(X,U,2) Q
"RTN","ORCACT0",29,0)
DIS S X=$$DISABLED I X S ERROR=$P(X,U,2) G VQ
"RTN","ORCACT0",30,0)
MN I ACTION="MN" D  G VQ ; manually release (delayed)
"RTN","ORCACT0",31,0)
 . I ACTSTS'=10,ACTSTS'=11 S ERROR="This order has already been released!" Q
"RTN","ORCACT0",32,0)
 . I $P(OR0,U,12)="I",'$G(^DPT(+ORVP,.105)) S ERROR="This patient is not currently admitted!"
"RTN","ORCACT0",33,0)
GMRA I PKG="GMRA" S ERROR="This action is not allowed on an allergy/adverse reaction!" G VQ ; no actions allowed on Allergies
"RTN","ORCACT0",34,0)
MEDS I PKG="PS",'MEDPARM S ERROR="You are not authorized to enter med orders!" G VQ
"RTN","ORCACT0",35,0)
RW I ACTION="RW" D RW^ORCACT01 G VQ ; rewrite/copy
"RTN","ORCACT0",36,0)
XFR I ACTION="XFR" D XFR^ORCACT01 G VQ ; transfer to in/outpt
"RTN","ORCACT0",37,0)
RN I ACTION="RN" D RN^ORCACT01 G VQ ; renew
"RTN","ORCACT0",38,0)
TRM I $$DONE G VQ ; ORDSTS=1,2,7,12,13
"RTN","ORCACT0",39,0)
EV I ACTION="EV" D  G VQ ; change delay event
"RTN","ORCACT0",40,0)
 . I ORDSTS'=10,ORDSTS'=11 S ERROR="This order has been released!" Q
"RTN","ORCACT0",41,0)
 . I $$EVTORDER^OREVNTX(IFN) S ERROR="The release event for this order may not be changed!" Q
"RTN","ORCACT0",42,0)
 . S X=$P(ORA0,U,4) I X'=2,X'=3 S ERROR="Signed orders may not be delayed to another event!" Q
"RTN","ORCACT0",43,0)
DC2 I ACTION="DC",ACTSTS="" D  G VQ ; DC released order
"RTN","ORCACT0",44,0)
 . I $G(NATR)="A" D  Q:$D(ERROR)
"RTN","ORCACT0",45,0)
 .. S X=$O(^ORE(100.2,"AO",+IFN,0)) I X S:'$G(^ORE(100.2,X,1)) ERROR="Future event orders may not be auto-discontinued!" Q
"RTN","ORCACT0",46,0)
 .. I $P($G(^SC(+$P(OR0,U,10),0)),U,3)="C" S ERROR="Only inpatient orders may be auto-discontinued!" Q
"RTN","ORCACT0",47,0)
 . I PKG="RA",ORDSTS=6 S ERROR="Active Radiology orders cannot be discontinued!" Q
"RTN","ORCACT0",48,0)
 . I PKG="LR" D  Q
"RTN","ORCACT0",49,0)
 .. I $$COLLECTD S ERROR="Lab orders that have been collected may not be discontinued!" Q
"RTN","ORCACT0",50,0)
 .. I $G(NATR)="A",$$VALUE^ORX8(+IFN,"COLLECT")="SP",$P(OR0,U,8)'<DT S ERROR="Future Send Patient orders may not be auto-discontinued!" Q
"RTN","ORCACT0",51,0)
 . I PKG="GMRC",ORDSTS=9 S ERROR="Consults orders with partial results cannot be discontinued!" Q
"RTN","ORCACT0",52,0)
 . I DG="DO",$G(DGPMT)'=3,ORDSTS=6,'$$NPO(+IFN) S ERROR="Active Diets cannot be discontinued; please order a new diet!" Q
"RTN","ORCACT0",53,0)
RL I ACTION="RL" D  G VQ  ; release hold
"RTN","ORCACT0",54,0)
 . I ORDSTS'=3 S ERROR="Orders not on hold cannot be released!" Q
"RTN","ORCACT0",55,0)
 . I ACTSTS S ERROR=$$ACTION($P(ORA0,U,2))_" orders cannot be released from hold!" Q
"RTN","ORCACT0",56,0)
 . N NATR,ACT S ACT=$S($P(ORA0,U,2)="HD":AIFN,1:+$P(OR3,U,7))
"RTN","ORCACT0",57,0)
 . S NATR=+$P($G(^OR(100,+IFN,8,ACT,0)),U,12),ACT=$P($G(^(0)),U,2)
"RTN","ORCACT0",58,0)
 . I PKG="RA"!(ACT'="HD")!($P($G(^ORD(100.02,NATR,0)),U,2)="S") S ERROR="Orders held by a service must be released from hold through the service!" Q
"RTN","ORCACT0",59,0)
AIFN S X=$P(ORA0,U,2) I AIFN>1,ACTSTS S ERROR="This action is not allowed on a "_$$ACTION(X)_" order!" G VQ
"RTN","ORCACT0",60,0)
RF I ACTION="RF" D  G VQ
"RTN","ORCACT0",61,0)
 . I DG'="O RX" S ERROR="Only Outpatient Med orders may be refilled!" Q
"RTN","ORCACT0",62,0)
 . I ORDSTS=5 S ERROR="Pending orders may not be refilled!" Q
"RTN","ORCACT0",63,0)
 . N X,PSIFN S PSIFN=$G(^OR(100,+IFN,4))
"RTN","ORCACT0",64,0)
 . S X=$$REFILL^PSOREF(PSIFN) I X'>0 S ERROR=$P(X,U,2) Q
"RTN","ORCACT0",65,0)
CP I ACTION="CP" D  G VQ ; complete
"RTN","ORCACT0",66,0)
 . I PKG'="OR" S ERROR="Only generic text orders may be completed through this option!" Q
"RTN","ORCACT0",67,0)
 . I ORDSTS=11!(ORDSTS=10) S ERROR="This order has not been released!" Q
"RTN","ORCACT0",68,0)
AL I ACTION="AL" D  G VQ
"RTN","ORCACT0",69,0)
 . I PKG'="LR",PKG'="RA",PKG'="GMRC" S ERROR="This order does not generate results!" Q
"RTN","ORCACT0",70,0)
 . I $P(OR3,U,10) S ERROR="This order is already flagged to alert the provider when resulted!" Q
"RTN","ORCACT0",71,0)
XX I ACTION="XX" D XX^ORCACT01 G VQ ; edit/change
"RTN","ORCACT0",72,0)
HD I ACTION="HD" D  G VQ ; hold
"RTN","ORCACT0",73,0)
 . I PKG="FH" S ERROR="Diet orders cannot be held!" Q
"RTN","ORCACT0",74,0)
 . I PKG="LR" S ERROR="Lab orders cannot be held!" Q
"RTN","ORCACT0",75,0)
 . I PKG="RA" S ERROR="Radiology orders cannot be held!" Q
"RTN","ORCACT0",76,0)
 . I PKG="GMRC" S ERROR="Consult orders cannot be held!" Q
"RTN","ORCACT0",77,0)
 . I ORDSTS=3 S ERROR="This order is already on hold!" Q
"RTN","ORCACT0",78,0)
 . I ORDSTS'=6,PKG="PS" S ERROR="Only active Pharmacy orders may be held!" Q
"RTN","ORCACT0",79,0)
 . I (ORDSTS=11)!(ORDSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT0",80,0)
VQ S Y=$S($D(ERROR):0,1:1)
"RTN","ORCACT0",81,0)
 Q Y
"RTN","ORCACT0",82,0)
 ;
"RTN","ORCACT0",83,0)
ACTION(X) ; -- Return text of action X
"RTN","ORCACT0",84,0)
 N Y S Y=$S(X="NW":"New",X="DC":"Discontinue",X="HD":"Hold",X="RL":"Release Hold",X="RN":"Renew",1:X)
"RTN","ORCACT0",85,0)
 Q Y
"RTN","ORCACT0",86,0)
 ;
"RTN","ORCACT0",87,0)
NPO(ORIFN) ; -- Returns 1 or 0, if order ORIFN is for NPO
"RTN","ORCACT0",88,0)
 N X,Y S X=$$VALUE^ORX8(+ORIFN,"ORDERABLE",1,"E")
"RTN","ORCACT0",89,0)
 S Y=$S($E(X,1,3)="NPO":1,1:0)
"RTN","ORCACT0",90,0)
 Q Y
"RTN","ORCACT0",91,0)
 ;
"RTN","ORCACT0",92,0)
COLLECTD() ; -- Lab order collected/active (incl all children)?
"RTN","ORCACT0",93,0)
 I (ORDSTS=11)!(ORDSTS=10) Q 0 ; unreleased
"RTN","ORCACT0",94,0)
 I '$O(^OR(100,+IFN,2,0)) Q (ORDSTS'=5)
"RTN","ORCACT0",95,0)
 ;I ORDSTS'=6 Q 1 ; Parent -> active instead of pending
"RTN","ORCACT0",96,0)
 N Y,Z S Y=1,Z=0
"RTN","ORCACT0",97,0)
 F  S Z=$O(^OR(100,+IFN,2,Z)) Q:Z'>0  I $P($G(^OR(100,Z,3)),U,3)=5 S Y=0 Q
"RTN","ORCACT0",98,0)
 Q Y
"RTN","ORCACT0",99,0)
 ;
"RTN","ORCACT0",100,0)
DONE() ; -- sets ERROR if terminal status
"RTN","ORCACT0",101,0)
 I ORDSTS=1 S ERROR="This order has been discontinued!" Q 1
"RTN","ORCACT0",102,0)
 I ORDSTS=2 S ERROR="This order has been completed!" Q 1
"RTN","ORCACT0",103,0)
 I ORDSTS=7 S ERROR="This order has expired!" Q 1
"RTN","ORCACT0",104,0)
 I ORDSTS=12 S ERROR="This order has been changed!" Q 1
"RTN","ORCACT0",105,0)
 I ORDSTS=13 S ERROR="This order has been cancelled!" Q 1
"RTN","ORCACT0",106,0)
 I ORDSTS=14 S ERROR="This order has lapsed!" Q 1
"RTN","ORCACT0",107,0)
 I ORDSTS=15 S ERROR="This order has been renewed!" Q 1
"RTN","ORCACT0",108,0)
 Q 0
"RTN","ORCACT0",109,0)
 ;
"RTN","ORCACT0",110,0)
DISABLED() ; -- Order dialog [or protocol] disabled?
"RTN","ORCACT0",111,0)
 N X,DLG S DLG=$P(OR0,U,5),X=0 I +DLG'>0 Q X
"RTN","ORCACT0",112,0)
 I VER'<3,DLG?1.N1";ORD(101.41," S X=$$MSG^ORXD(+DLG) Q X
"RTN","ORCACT0",113,0)
 S DLG=$S(PKG="RA":"RA OERR EXAM",PKG="GMRC":"GMRCOR CONSULT",1:"")
"RTN","ORCACT0",114,0)
 I $L(DLG) S DLG=+$O(^ORD(101.41,"AB",DLG,0)),X=$$MSG^ORXD(DLG)
"RTN","ORCACT0",115,0)
 Q X
"RTN","ORCACT01")
0^58^B53565570
"RTN","ORCACT01",1,0)
ORCACT01        ;SLC/MKB-Validate order actions cont ;3/12/02  13:14
"RTN","ORCACT01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,134,141**;Dec 17, 1997
"RTN","ORCACT01",3,0)
 ;
"RTN","ORCACT01",4,0)
ES ; -- sign [on chart]
"RTN","ORCACT01",5,0)
 I ORDSTS=11,VER<3,PKG'="OR" S ERROR="This order cannot be released and must be discontinued!" Q
"RTN","ORCACT01",6,0)
 N X I ACTSTS=11!(ACTSTS=10) D  Q:$L($G(ERROR))
"RTN","ORCACT01",7,0)
 . I $P(ORA0,U,2)="DC",$$DONE^ORCACT0 D CANCEL^ORCSEND(+IFN),UNOTIF^ORCSIGN S OREBUILD=1 Q
"RTN","ORCACT01",8,0)
 . S X=$$DISABLED^ORCACT0 I X S ERROR=$P(X,U,2) Q
"RTN","ORCACT01",9,0)
 S X=$P(ORA0,U,4) I X=3 S:ACTSTS'=11&(ACTSTS'=10) ERROR="This order does not require a signature!" Q
"RTN","ORCACT01",10,0)
 I X'=2 S ERROR="This order has been signed!" Q
"RTN","ORCACT01",11,0)
 I DG="O RX",ACTION'="ES",ACTION'="DS",$G(NATR)'="I" S ERROR="Outpatient meds may not be released without a clinician's signature!" Q
"RTN","ORCACT01",12,0)
 I (ACTION="ES"!(ACTION="DS")),$D(^XUSEC("ORELSE",DUZ)),$P(OR0,U,16)'<2 S ERROR="You are not privileged to sign this order!" Q
"RTN","ORCACT01",13,0)
 I ACTION="OC" S:MEDPARM<2 ERROR="You are not authorized to release med orders!" Q
"RTN","ORCACT01",14,0)
 I ACTION="RS" D  Q:$D(ERROR)  Q:$G(NATR)'="I"
"RTN","ORCACT01",15,0)
 . Q:ACTSTS=11  Q:ACTSTS=10  ;unreleased - ok
"RTN","ORCACT01",16,0)
 . S ERROR="This order has already been released!"
"RTN","ORCACT01",17,0)
ES1 I PKG="PS" D  ;authorized to write meds?
"RTN","ORCACT01",18,0)
 . N TYPE,OI,PSOI,DEAFLG S X=$G(^VA(200,DUZ,"PS"))
"RTN","ORCACT01",19,0)
 . I '$P(X,U) S ERROR="You are not authorized to sign med orders!" Q
"RTN","ORCACT01",20,0)
 . I $P(X,U,4),$$NOW^XLFDT>$P(X,U,4) S ERROR="You are no longer authorized to sign med orders!" Q
"RTN","ORCACT01",21,0)
 . Q:DG="IV RX"  Q:$P(ORA0,U,2)="DC"  ;don't need to ck DEA#
"RTN","ORCACT01",22,0)
 . S OI=+$$VALUE^ORX8(+IFN,"ORDERABLE")
"RTN","ORCACT01",23,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2) Q:PSOI'>0
"RTN","ORCACT01",24,0)
 . S TYPE=$S($P(DG," ")="O":"O",1:"I"),DEAFLG=$$OIDEA^PSSUTLA1(PSOI,TYPE)
"RTN","ORCACT01",25,0)
 . I DEAFLG>0,'$L($P(X,U,2)),'$L($P(X,U,3)) S ERROR="You must have a DEA# or VA# to sign this order!" Q
"RTN","ORCACT01",26,0)
 Q
"RTN","ORCACT01",27,0)
 ;
"RTN","ORCACT01",28,0)
XFR ; -- transfer to inpt/outpt [IFN=order to be transferred]
"RTN","ORCACT01",29,0)
 N OI,PS I DG="TPN" S ERROR="TPN orders may not be copied!" Q
"RTN","ORCACT01",30,0)
 I $$INACTIVE S ERROR="Orders for inactive orderables may not be transferred; please enter a new order!" Q
"RTN","ORCACT01",31,0)
 S OI=+$O(^OR(100,+IFN,.1,"B",0)),ORPS=$G(^ORD(101.43,OI,"PS"))
"RTN","ORCACT01",32,0)
 I DG="UD RX",'$P(ORPS,U,2) S ERROR="This drug may not be ordered for an outpatient!" Q
"RTN","ORCACT01",33,0)
 I DG="O RX" D  Q:$L($G(ERROR))
"RTN","ORCACT01",34,0)
 . I '$P(ORPS,U) S ERROR="This drug may not be ordered for an inpatient!" Q
"RTN","ORCACT01",35,0)
 . D:$O(^OR(100,+IFN,4.5,"ID","MISC",0)) DOSES^ORCACT02(+IFN)
"RTN","ORCACT01",36,0)
 Q
"RTN","ORCACT01",37,0)
 ;
"RTN","ORCACT01",38,0)
RW ; -- rewrite/copy
"RTN","ORCACT01",39,0)
 I ACTSTS=12 S ERROR="Orders that have been dc'd due to editing may not be copied!" Q
"RTN","ORCACT01",40,0)
 I DG="TPN" S ERROR="TPN orders may not be rewritten!" Q
"RTN","ORCACT01",41,0)
 I DG="UD RX",$$NTBG(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be rewritten!" Q
"RTN","ORCACT01",42,0)
 I $$INACTIVE S ERROR="Orders for inactive orderables may not be copied; please enter a new order!" Q
"RTN","ORCACT01",43,0)
 I PKG="PS",'$$MEDOK S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",44,0)
 I DG="O RX",$O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old form
"RTN","ORCACT01",45,0)
 Q
"RTN","ORCACT01",46,0)
 ;
"RTN","ORCACT01",47,0)
RN ; -- renew
"RTN","ORCACT01",48,0)
 I PKG'="PS",PKG'="OR" S ERROR="This order may not be renewed!" Q
"RTN","ORCACT01",49,0)
 I (ORDSTS=11)!(ORDSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT01",50,0)
 I ACTSTS=12 S ERROR="Orders that have been dc'd due to editing may not be renewed!" Q
"RTN","ORCACT01",51,0)
 I $P(OR3,U,6) S ERROR="This order has already been "_$S($P($G(^OR(100,+$P(OR3,U,6),3)),U,11)=1:"changed!",1:"renewed!") Q
"RTN","ORCACT01",52,0)
 I PKG="OR" D  Q  ;Generic orders
"RTN","ORCACT01",53,0)
 . I $$INACTIVE S ERROR="Orders for inactive orderables may not be renewed!" Q
"RTN","ORCACT01",54,0)
 . I DG="ADT" S ERROR="M.A.S. orders may not be renewed!" Q
"RTN","ORCACT01",55,0)
 . I "^1^2^6^7^"[(U_ORDSTS_U) Q  ;ok
"RTN","ORCACT01",56,0)
 . S ERROR="This order may not be renewed!"
"RTN","ORCACT01",57,0)
 I '$$MEDOK S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",58,0)
RN1 N PSIFN S PSIFN=$G(^OR(100,+IFN,4))
"RTN","ORCACT01",59,0)
 I DG="O RX" D  Q  ;Outpt Meds
"RTN","ORCACT01",60,0)
 . N ORZ,ORD S ORZ=$L($T(RENEW^PSORENW),",")
"RTN","ORCACT01",61,0)
 . I ORZ>1 S ORD=+$$VALUE^ORX8(+IFN,"DRUG"),X=$$RENEW^PSORENW(PSIFN,ORD)
"RTN","ORCACT01",62,0)
 . S:ORZ'>1 X=$$RENEW^PSORENW(PSIFN) I X<1 S ERROR=$P(X,U,2) Q
"RTN","ORCACT01",63,0)
 . S X=+$P(X,U,2) D:X RESET(+IFN,X)
"RTN","ORCACT01",64,0)
 . I $O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old format
"RTN","ORCACT01",65,0)
 I DG="UD RX",$$NTBG(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be renewed!" Q
"RTN","ORCACT01",66,0)
 I ORDSTS=7,'$$IV,$P(OR0,U,9)<$$FMADD^XLFDT(DT,-4)  S ERROR="Inpatient med orders may not be renewed more than 4 days after expiration!" Q
"RTN","ORCACT01",67,0)
 I ORDSTS'=6,ORDSTS'=7 S ERROR="This order may not be renewed!" Q
"RTN","ORCACT01",68,0)
 I PSIFN'>0 S ERROR=$S($O(^OR(100,+IFN,2,0)):"Complex orders may not be renewed!",1:"Missing or invalid order number!") Q
"RTN","ORCACT01",69,0)
 ;I DG="TPN" S ERROR="TPN orders may not be renewed!" Q
"RTN","ORCACT01",70,0)
 S X=$$ACTIVE^PSJORREN(+ORVP,PSIFN) Q:+X=1  ;Ok
"RTN","ORCACT01",71,0)
 I +X>1,$P(X,U,2) D RESET(+IFN,+$P(X,U,2)) Q  ;replace OI
"RTN","ORCACT01",72,0)
 ;I +X>1,$P(X,U,2) S $P(X,U,2)="Inactive orderable item(s)"
"RTN","ORCACT01",73,0)
 S ERROR="This order may not be renewed: "_$P(X,U,2)
"RTN","ORCACT01",74,0)
 Q
"RTN","ORCACT01",75,0)
 ;
"RTN","ORCACT01",76,0)
XX ; -- edit/change
"RTN","ORCACT01",77,0)
 I PKG="RA",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Radiology cannot be changed!" Q
"RTN","ORCACT01",78,0)
 I PKG="LR",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Lab cannot be changed!" Q
"RTN","ORCACT01",79,0)
 I PKG="FH",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Dietetics cannot be changed!" Q
"RTN","ORCACT01",80,0)
 I PKG="GMRC",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Consults cannot be changed!" Q
"RTN","ORCACT01",81,0)
 I DG="TPN" S ERROR="TPN orders may not be changed!" Q
"RTN","ORCACT01",82,0)
 I ORDSTS=3 S ERROR="Orders on hold may not be changed!" Q
"RTN","ORCACT01",83,0)
 I DG="UD RX",$$NTBG(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be changed!" Q
"RTN","ORCACT01",84,0)
 I $O(^OR(100,+IFN,2,0)) S ERROR="Complex orders may not be changed!" Q
"RTN","ORCACT01",85,0)
 I $P(OR3,U,6) S ERROR="This order may not be changed - a "_$S($P($G(^OR(100,+$P(OR3,U,6),3)),U,11)=1:"change",1:"renewal")_" order already exists!" Q
"RTN","ORCACT01",86,0)
 I $P(OR3,U,11)=2 D  Q:$D(ERROR)
"RTN","ORCACT01",87,0)
 . I ORDSTS=10!(ORDSTS=11) S ERROR="Unreleased renewals may not be changed!" Q
"RTN","ORCACT01",88,0)
 . I PKG="PS",ORDSTS=5 S ERROR="Pending renewals may not be changed!" Q
"RTN","ORCACT01",89,0)
 I $$INACTIVE S ERROR="Orders for inactive orderables may not be changed; please enter a new order!" Q
"RTN","ORCACT01",90,0)
 I PKG="PS",'$$MEDOK S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",91,0)
 I DG="O RX",$O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old form
"RTN","ORCACT01",92,0)
 Q
"RTN","ORCACT01",93,0)
 ;
"RTN","ORCACT01",94,0)
INACTIVE() ; -- Returns 1 or 0, if OI is now inactive
"RTN","ORCACT01",95,0)
 N I,OI,X,Y,ORNOW,DD,PSOI S Y=0,ORNOW=$$NOW^XLFDT
"RTN","ORCACT01",96,0)
 S I=0 F  S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D  Q:Y
"RTN","ORCACT01",97,0)
 . S OI=+$G(^OR(100,+IFN,4.5,I,1))
"RTN","ORCACT01",98,0)
 . I OI S X=$G(^ORD(101.43,OI,.1)) I X,X<ORNOW S Y=1
"RTN","ORCACT01",99,0)
 I Y,PKG="PS",DG'="IV RX" D  ;replacement OI?
"RTN","ORCACT01",100,0)
 . S I=+$O(^OR(100,+IFN,4.5,"ID","DRUG",0)) Q:I'>0  ;first
"RTN","ORCACT01",101,0)
 . S DD=+$G(^OR(100,+IFN,4.5,I,1)) Q:DD'>0  Q:$G(OI)'>0
"RTN","ORCACT01",102,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2),X=$$ITEM^PSSUTIL1(PSOI,DD)
"RTN","ORCACT01",103,0)
 . Q:X'>0  S X=+$O(^ORD(101.43,"ID",+$P(X,U,2)_";99PSP",0)) Q:X'>0
"RTN","ORCACT01",104,0)
 . I $G(^ORD(101.43,X,.1)),$G(^(.1))<ORNOW Q  ;make sure new OI is active
"RTN","ORCACT01",105,0)
 . S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT01",106,0)
 . S:I ^OR(100,+IFN,4.5,I,1)=X,Y=0 ;reset
"RTN","ORCACT01",107,0)
 Q Y
"RTN","ORCACT01",108,0)
 ;
"RTN","ORCACT01",109,0)
MEDOK() ; -- Returns 1 or 0, if med OI usage=Y
"RTN","ORCACT01",110,0)
 N Y,OI,ORPS,X S Y=1,X=$P(OR0,U,12)
"RTN","ORCACT01",111,0)
 S OI=+$O(^OR(100,+IFN,.1,"B",0)),ORPS=$G(^ORD(101.43,OI,"PS"))
"RTN","ORCACT01",112,0)
 I DG="SPLY",'$P(ORPS,U,5) S Y=0
"RTN","ORCACT01",113,0)
 I DG="O RX",'(X="O"&$P(ORPS,U,2)),'(X="I"&($P(ORPS,U)=2)) S Y=0
"RTN","ORCACT01",114,0)
 I DG="I RX"!(DG="UD RX"),'$P(ORPS,U) S Y=0
"RTN","ORCACT01",115,0)
 I DG="IV RX" D
"RTN","ORCACT01",116,0)
 . N I,X0,X1 S I=0
"RTN","ORCACT01",117,0)
 . F  S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",I)) Q:I<1  D  Q:Y<1
"RTN","ORCACT01",118,0)
 .. S X0=$G(^OR(100,+IFN,4.5,I,0)),X1=+$G(^(1))
"RTN","ORCACT01",119,0)
 .. I $P($G(^ORD(101.41,+$P(X0,U,2),0)),U)["ADDITIVE" S:'$P($G(^ORD(101.43,X1,"PS")),U,4) Y=0 Q
"RTN","ORCACT01",120,0)
 .. S:'$P($G(^ORD(101.43,X1,"PS")),U,3) Y=0
"RTN","ORCACT01",121,0)
 Q Y
"RTN","ORCACT01",122,0)
 ;
"RTN","ORCACT01",123,0)
IV() ; -- IV order, either Inpt or Fluid?
"RTN","ORCACT01",124,0)
 I DG="IV RX" Q 1
"RTN","ORCACT01",125,0)
 N I,OI,X S I=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT01",126,0)
 S OI=+$G(^OR(100,IFN,4.5,+I,1)),X=$P($G(^ORD(101.43,+OI,"PS")),U)
"RTN","ORCACT01",127,0)
 Q (X>1)
"RTN","ORCACT01",128,0)
 ;
"RTN","ORCACT01",129,0)
NTBG(ORIFN) ; -- Inpt order marked as 'Not to be Given'?
"RTN","ORCACT01",130,0)
 N PSIFN,Y,ORI,ORCH S Y=""
"RTN","ORCACT01",131,0)
 S PSIFN=$G(^OR(100,+ORIFN,4)) I PSIFN>0 Q $$ENNG^PSJORUT2(+ORVP,PSIFN)
"RTN","ORCACT01",132,0)
 S ORI=0 F  S ORI=$O(^OR(100,+ORIFN,2,ORI)) Q:ORI'>0  S ORCH=+$G(^(ORI,0)),PSIFN=$G(^OR(100,ORCH,4)) I PSIFN>0 S Y=$$ENNG^PSJORUT2(+ORVP,PSIFN) Q:Y
"RTN","ORCACT01",133,0)
 Q Y
"RTN","ORCACT01",134,0)
 ;
"RTN","ORCACT01",135,0)
RESET(IFN,NEWOI)   ; -- Update OI if changed before renewing
"RTN","ORCACT01",136,0)
 Q:'$G(IFN)  Q:'$D(^OR(100,+IFN,0))  Q:'$G(NEWOI)
"RTN","ORCACT01",137,0)
 N I,ORIT S ORIT=+$O(^ORD(101.43,"ID",NEWOI_";99PSP",0)) Q:ORIT'>0
"RTN","ORCACT01",138,0)
 S I=$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT01",139,0)
 S:I ^OR(100,+IFN,4.5,I,1)=ORIT
"RTN","ORCACT01",140,0)
 Q
"RTN","ORCACT02")
0^71^B9304192
"RTN","ORCACT02",1,0)
ORCACT02        ;SLC/MKB-Validation dose conversion for POE
"RTN","ORCACT02",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORCACT02",3,0)
 ;
"RTN","ORCACT02",4,0)
DOSES(IFN) ; -- Convert outpt doses, if needed
"RTN","ORCACT02",5,0)
 N ORIT,ORPSOI,ORDRUG,ORDOSE,CONJ,DOSE,ORP,ORI,ORX,UD,UNT,IDX,X,Y,DA,DIK,MATCH,DRUG,STR,MED
"RTN","ORCACT02",6,0)
 S ORIT=+$$VALUE^ORX8(+IFN,"ORDERABLE"),ORDRUG=+$$VALUE^ORX8(+IFN,"DRUG")
"RTN","ORCACT02",7,0)
 S ORPSOI=+$P($G(^ORD(101.43,ORIT,0)),U,2),DOSE=$$PTR^ORCD("OR GTX DOSE")
"RTN","ORCACT02",8,0)
 D DOSE^PSSORUTL(.ORDOSE,ORPSOI,"O",+ORVP)
"RTN","ORCACT02",9,0)
 S CONJ=$P($G(ORDOSE("MISC")),U,3) S:$L(CONJ) CONJ=" "_CONJ
"RTN","ORCACT02",10,0)
 F ORP="INSTR","MISC" S ORI=0 D  ;setup ORX(instance,ID)=DA ^ value
"RTN","ORCACT02",11,0)
 . F  S ORI=$O(^OR(100,+IFN,4.5,"ID",ORP,ORI)) Q:ORI'>0  D
"RTN","ORCACT02",12,0)
 .. S X=$G(^OR(100,+IFN,4.5,ORI,0)),ORX($P(X,U,3),ORP)=ORI_U_$G(^(1))
"RTN","ORCACT02",13,0)
 ;
"RTN","ORCACT02",14,0)
D1 S ORI=0 F  S ORI=$O(ORX(ORI)) Q:ORI'>0  D
"RTN","ORCACT02",15,0)
 . S UD=$P($G(ORX(ORI,"INSTR")),U,2),UNT=$P($G(ORX(ORI,"MISC")),U,2)
"RTN","ORCACT02",16,0)
 . S:UD="1/2" UD=.5 S:UD="1/3" UD=.33 S:UD="1/4" UD=.25 S:UD="3/4" UD=.75
"RTN","ORCACT02",17,0)
 . S:UNT?1.U1"(S)" UNT=$P(UNT,"(")_$S(UD>1:"S",1:"") ;strip trailing (s)
"RTN","ORCACT02",18,0)
 . K MATCH S MATCH=0,IDX="ORDOSE(0)"
"RTN","ORCACT02",19,0)
 . F  S IDX=$Q(@IDX) Q:IDX'?1"ORDOSE("1.N.",".N1")"  D
"RTN","ORCACT02",20,0)
 .. S Y=@IDX I $P(Y,U,3)?1"0."1.N,UD?1"."1.N S UD="0"_UD ;add leading 0 ;134
"RTN","ORCACT02",21,0)
 .. S X=UD_$S('$L(UNT):"",$P(Y,U,3):U_UNT,1:" "_UNT) S X=$$UP^XLFSTR(X)
"RTN","ORCACT02",22,0)
 .. I $P(Y,U,3,4)'=X,$P(Y,U,5)'=X Q  ;no match
"RTN","ORCACT02",23,0)
 .. I ORDRUG,$P(Y,U,6)'=ORDRUG Q  ;diff disp drug - no match
"RTN","ORCACT02",24,0)
 .. S MATCH=MATCH+1,MATCH(MATCH)=Y
"RTN","ORCACT02",25,0)
 . ;save re-formatted instructions
"RTN","ORCACT02",26,0)
 . I MATCH=1 D  Q
"RTN","ORCACT02",27,0)
 .. S Y=MATCH(1),X=$P(Y,U,5),DRUG=$G(ORDOSE("DD",+$P(Y,U,6)))
"RTN","ORCACT02",28,0)
 .. S:'Y X=X_CONJ_" "_$S($P(DRUG,U,5):$TR($P(DRUG,U,5,6),"^"),1:$P(DRUG,U))
"RTN","ORCACT02",29,0)
 .. S DA=+$G(ORX(ORI,"INSTR")) S:DA ^OR(100,+IFN,4.5,DA,1)=X
"RTN","ORCACT02",30,0)
 .. S Y=$P(Y,U,1,6)_U_$P(DRUG,U,5,6),Y=$TR(Y,"^","&")
"RTN","ORCACT02",31,0)
 .. S DA=+$G(ORX(ORI,"MISC")) Q:'DA  K ^OR(100,+IFN,4.5,"ID","MISC",DA)
"RTN","ORCACT02",32,0)
 .. S ^OR(100,+IFN,4.5,DA,0)="15^"_DOSE_U_ORI_"^DOSE",^(1)=Y
"RTN","ORCACT02",33,0)
 .. S ^OR(100,+IFN,4.5,"ID","DOSE",DA)=""
"RTN","ORCACT02",34,0)
 . S X=UD_$S($L(UNT):" "_UNT,1:""),Y=""
"RTN","ORCACT02",35,0)
 . S DA=+$G(ORX(ORI,"INSTR")) S:DA ^OR(100,+IFN,4.5,DA,1)=X
"RTN","ORCACT02",36,0)
 . S DA=+$G(ORX(ORI,"MISC")),DIK="^OR(100,"_+IFN_",4.5,",DA(1)=+IFN
"RTN","ORCACT02",37,0)
 . D:DA ^DIK ;remove old units prompt
"RTN","ORCACT02",38,0)
D2 ; -- set STR or DRUGNAME, convert DAYS
"RTN","ORCACT02",39,0)
 I ORDRUG D
"RTN","ORCACT02",40,0)
 . S DRUG=$G(ORDOSE("DD",+ORDRUG)),STR=$P(DRUG,U,5)_$P(DRUG,U,6)
"RTN","ORCACT02",41,0)
 . I STR'>0 D:'$G(ORDOSE(1)) ADD("DRUG NAME",18,$P(DRUG,U)) Q
"RTN","ORCACT02",42,0)
 . S MED=$P($G(^ORD(101.43,+$G(ORIT),0)),U)
"RTN","ORCACT02",43,0)
 . I MED'[STR D ADD("STRENGTH",7,STR)
"RTN","ORCACT02",44,0)
 S ORI=+$O(^OR(100,+IFN,4.5,"ID","DAYS",0)),X=$G(^OR(100,+IFN,4.5,ORI,1))
"RTN","ORCACT02",45,0)
 S:+X=X ^OR(100,+IFN,4.5,ORI,1)=+X_" DAYS"
"RTN","ORCACT02",46,0)
 Q
"RTN","ORCACT02",47,0)
 ;
"RTN","ORCACT02",48,0)
ADD(PRMT,DA,VAL)        ; -- Add new value to Responses
"RTN","ORCACT02",49,0)
 N HDR,TOT,I,ID,PTR
"RTN","ORCACT02",50,0)
 S HDR=$G(^OR(100,+IFN,4.5,0)),TOT=+$P(HDR,U,4)+1
"RTN","ORCACT02",51,0)
 S I=+$O(^OR(100,+IFN,4.5,"ID"),-1),I=I+1,$P(HDR,U,3,4)=I_U_TOT
"RTN","ORCACT02",52,0)
 S PTR=+$$PTR^ORCD("OR GTX "_PRMT),ID=$P($G(^ORD(101.41,PTR,1)),U,3)
"RTN","ORCACT02",53,0)
 S ^OR(100,+IFN,4.5,0)=HDR,^(I,0)=DA_U_PTR_"^1^"_ID,^(1)=VAL
"RTN","ORCACT02",54,0)
 S:$L(ID) ^OR(100,+IFN,4.5,"ID",ID,I)=""
"RTN","ORCACT02",55,0)
 Q
"RTN","ORCACT2")
0^3^B53543972
"RTN","ORCACT2",1,0)
ORCACT2 ;SLC/MKB-DC orders ; 08 May 2002  2:12 PM
"RTN","ORCACT2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,48,79,92,108,94,141**;Dec 17, 1997
"RTN","ORCACT2",3,0)
DC ; -- start here with:
"RTN","ORCACT2",4,0)
 ;    ORNMBR = #,#,...,# of selected orders
"RTN","ORCACT2",5,0)
 ;
"RTN","ORCACT2",6,0)
 ;    OREBUILD defined on return if Orders tab needs to be rebuilt
"RTN","ORCACT2",7,0)
 ;
"RTN","ORCACT2",8,0)
 N ORACT,ORI,NMBR,ORQUIT,ORIFN,ORDC,OREVT,ORNATR,ORPTLK,ORLK,IDX,ORDITM,ORPRINT,ORERR,ORSTS,ORPRNT,ORCLNUP,ORDA,ORCREATE,OR0,OR3,OREASON,ORXNP,ORX S VALMBCK=""
"RTN","ORCACT2",9,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCACT2",10,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR DCQ
"RTN","ORCACT2",11,0)
 D FREEZE^ORCMENU S ORACT="DC",VALMBCK="R" K OREBUILD
"RTN","ORCACT2",12,0)
DC1 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCACT2",13,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR))
"RTN","ORCACT2",14,0)
 . S ORIFN=$S(ORTAB="MEDS":$P(IDX,U,4),1:$P(IDX,U)) Q:'ORIFN
"RTN","ORCACT2",15,0)
 . I '$D(^OR(100,+ORIFN,0)) W !,"This order has been deleted!" H 1 Q
"RTN","ORCACT2",16,0)
 . S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";"_+$P($G(^OR(100,+ORIFN,3)),U,7)
"RTN","ORCACT2",17,0)
 . S ORDITM=$$ORDITEM(ORIFN) D SUBHDR(ORDITM)
"RTN","ORCACT2",18,0)
 . I '$$VALID^ORCACT0(ORIFN,ORACT,.ORERR) W !,ORERR H 1 Q
"RTN","ORCACT2",19,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 1 Q
"RTN","ORCACT2",20,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)),ORSTS=$P($G(^(8,+$P(ORIFN,";",2),0)),U,15)
"RTN","ORCACT2",21,0)
 . S:$P(OR0,U,17) OREVT(+$P(OR0,U,17))="" ;ck event when done
"RTN","ORCACT2",22,0)
 . I (ORSTS=10)!(ORSTS=11) D UNREL Q  ;delete unreleased orders
"RTN","ORCACT2",23,0)
 . I $P(OR0,U,11)=$O(^ORD(100.98,"B","TF",0)),$P(OR3,U,3)=6 D RESUME(ORIFN) Q:$G(ORQUIT)
"RTN","ORCACT2",24,0)
DC2 . S ORDC(ORI)=ORIFN I $$NMSP^ORCD(+$P(OR0,U,14))="PS" S ORX=1 D  ;meds
"RTN","ORCACT2",25,0)
 .. N ORY,ORJ,ORV,ORTX,DA,DIK D DELAYED^ORX8(.ORY,+ORIFN) Q:ORY'>0
"RTN","ORCACT2",26,0)
 .. W !,+ORY_" delayed order(s) for the same medication were found:"
"RTN","ORCACT2",27,0)
 .. S ORJ=0 F  S ORJ=$O(ORY(ORJ)) Q:ORJ'>0  S ORV=ORY(ORJ) D TEXT^ORQ12(.ORTX,ORJ) W !,$E(ORTX(1),1,75)_$S($L(ORTX(1))>75:"...",1:""),!,"  >> delayed until "_$P(ORV,U,2)
"RTN","ORCACT2",28,0)
 .. I '$$OK(+ORY) W ! Q
"RTN","ORCACT2",29,0)
 .. W !,"Orders not signed or released to the service will be deleted.",!
"RTN","ORCACT2",30,0)
 .. S DIK="^OR(100,",DA=0 F  S DA=$O(ORY(DA)) Q:DA'>0  D
"RTN","ORCACT2",31,0)
 ... N ORJ,ORSIG,STS,ORLKD
"RTN","ORCACT2",32,0)
 ... S ORLKD=$$LOCK1^ORX2(+DA) I 'ORLKD W !,$P(ORLKD,U,2) H 1 Q
"RTN","ORCACT2",33,0)
 ... S STS=$P($G(^OR(100,DA,3)),U,3),ORSIG=$S($P($G(^(8,1,0)),U,4)=2:0,1:1)
"RTN","ORCACT2",34,0)
 ... I STS'=10 S ORJ=$L(ORNMBR,",")+1 S:ORJ'>$O(ORDC(""),-1) ORJ=$O(ORDC(""),-1)+1 S ORDC(ORJ)=DA Q  ;released - add to list
"RTN","ORCACT2",35,0)
 ... D CLRDLY(DA):ORSIG,^DIK:'ORSIG S OREVT(+ORY(DA))=""
"RTN","ORCACT2",36,0)
 ... I $D(^TMP("ORNEW",$J,DA,1)) K ^(1) D UNLK1^ORX2(DA) ;unlock again
"RTN","ORCACT2",37,0)
 G:'$O(ORDC(0)) DCQ
"RTN","ORCACT2",38,0)
DC3 S OREASON=$$DCREASON I OREASON'>0 D UNLOCK G DCQ
"RTN","ORCACT2",39,0)
 S ORNATR=$P(OREASON,U,3),ORCREATE=$$CREATE^ORX1(ORNATR)
"RTN","ORCACT2",40,0)
 I 'ORCREATE,$G(ORX),$D(^XUSEC("OREMAS",DUZ)),$$GET^XPAR("ALL","OR OREMAS MED ORDERS")<2 W $C(7),!,"You are not authorized to release med orders.",! G DC3
"RTN","ORCACT2",41,0)
 I ORCREATE D  I (ORNP="^")!($G(ORL)="^") D UNLOCK G DCQ
"RTN","ORCACT2",42,0)
 . S ORNP=$$PROVIDER^ORCMENU1 Q:ORNP="^"  ;S:ORNP=DUZ ORNATR="E"
"RTN","ORCACT2",43,0)
 . I $G(ORX) D PROVIDER^ORCDPSIV I $G(ORQUIT) S ORNP="^" Q
"RTN","ORCACT2",44,0)
 . S:'$G(ORL) ORL=$$LOCATION^ORCMENU1
"RTN","ORCACT2",45,0)
 W ! W:'ORCREATE "Discontinuing orders ..."
"RTN","ORCACT2",46,0)
 S ORPRNT=$$PRINT(ORNATR),ORCLNUP=$S(ORNATR="D":1,ORNATR="M":1,1:0)
"RTN","ORCACT2",47,0)
 S (ORI,ORPRINT)=0 F  S ORI=$O(ORDC(ORI)) Q:ORI'>0  S ORIFN=ORDC(ORI) D
"RTN","ORCACT2",48,0)
 . I ORCREATE S ORDA=$$ACTION^ORCSAVE("DC",+ORIFN,ORNP) Q:'ORDA  D SET(+ORIFN,ORNATR,+OREASON,$P(OREASON,U,2)) S ^TMP("ORNEW",$J,+ORIFN,ORDA)="" W "." Q
"RTN","ORCACT2",49,0)
 . ; release -> no order or ES req'd
"RTN","ORCACT2",50,0)
 . D EN^ORCSEND(+ORIFN,ORACT,3,1,ORNATR,+OREASON,.ORERR),UNLK1^ORX2(+ORIFN)
"RTN","ORCACT2",51,0)
 . I '$G(ORERR) S:$P(ORPRNT,U)!$P(ORPRNT,U,5) ORPRINT=ORPRINT+1,ORPRINT(ORPRINT)=+ORIFN_";" W "." Q
"RTN","ORCACT2",52,0)
 . W !,$$ORDITEM(+ORIFN)_" not discontinued."
"RTN","ORCACT2",53,0)
 . W:$L($P($G(ORERR),U,2)) !,"  >> "_$P(ORERR,U,2) W ! H 1
"RTN","ORCACT2",54,0)
 W:ORCREATE "... discontinue order(s) placed." H 1
"RTN","ORCACT2",55,0)
 I $O(ORPRINT(0)) D PRINT^ORPR02(ORVP,.ORPRINT,,ORL,ORPRNT)
"RTN","ORCACT2",56,0)
 S OREBUILD=1 ; rebuild orders list
"RTN","ORCACT2",57,0)
DCQ D:$G(OREBUILD) UNOTIF^ORCSIGN ; undo notif?
"RTN","ORCACT2",58,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCACT2",59,0)
 S:$G(ORXNP) ORNP=ORXNP ;reset provider if needed
"RTN","ORCACT2",60,0)
 D:$D(OREVT) EVENT ;cancel any events?
"RTN","ORCACT2",61,0)
 Q
"RTN","ORCACT2",62,0)
 ;
"RTN","ORCACT2",63,0)
UNLOCK ; -- Unlock orders in ORDC(ORI)=ORIFN
"RTN","ORCACT2",64,0)
 N ORI,ORIFN S ORI=0
"RTN","ORCACT2",65,0)
 F  S ORI=$O(ORDC(ORI)) Q:ORI'>0  S ORIFN=+ORDC(ORI) D UNLK1^ORX2(ORIFN)
"RTN","ORCACT2",66,0)
 Q
"RTN","ORCACT2",67,0)
 ;
"RTN","ORCACT2",68,0)
OK(NUM) ; -- Ok to DC delayed order(s) too?
"RTN","ORCACT2",69,0)
 N X,Y,DIR S DIR(0)="YA",DIR("B")="NO"
"RTN","ORCACT2",70,0)
 S DIR("A")="Do you want to discontinue "_$S(NUM>1:"these orders",1:"this order")_" too? "
"RTN","ORCACT2",71,0)
 S DIR("?")="Enter YES to also cancel the delayed order(s), or NO to allow the order(s) to be activated when the designated event occurs."
"RTN","ORCACT2",72,0)
 W ! D ^DIR
"RTN","ORCACT2",73,0)
 Q +Y
"RTN","ORCACT2",74,0)
 ;
"RTN","ORCACT2",75,0)
PRINT(NATR) ; -- Ok to print order?
"RTN","ORCACT2",76,0)
 N I,OR1,Y S I=$O(^ORD(100.02,"C",NATR,0)),OR1=$G(^ORD(100.02,I,1))
"RTN","ORCACT2",77,0)
 S Y=$P(OR1,U,2)_"^^^^"_$P(OR1,U,5)
"RTN","ORCACT2",78,0)
 Q Y
"RTN","ORCACT2",79,0)
 ;
"RTN","ORCACT2",80,0)
ORDITEM(ID) ; -- Returns order text
"RTN","ORCACT2",81,0)
 ;N X,I,MORE S X=""
"RTN","ORCACT2",82,0)
 ;I $P(ID,";",2)>1 S I=$P($G(^OR(100,+ID,8,+$P(ID,";",2),0)),U,2),X=$S(I="DC":"Discontinue ",I="HD":"Hold ",1:"")
"RTN","ORCACT2",83,0)
 ;S I=$O(^OR(100,+ID,1,0)) Q:'I "" S MORE=$O(^(I)),X=X_$G(^(I,0))
"RTN","ORCACT2",84,0)
 ;I $L(X)>68 S X=$E(X,1,68),MORE=1
"RTN","ORCACT2",85,0)
 ;S:MORE X=X_" ..."
"RTN","ORCACT2",86,0)
 N X,ORX D TEXT^ORQ12(.ORX,ID,68) S X=ORX(1)_$S(ORX>1:" ...",1:"")
"RTN","ORCACT2",87,0)
 Q X
"RTN","ORCACT2",88,0)
 ;
"RTN","ORCACT2",89,0)
SUBHDR(X) ; -- Display subheader of order being acted on
"RTN","ORCACT2",90,0)
 W !!,?(36-($L(X)\2)),"-- "_X_" --",!
"RTN","ORCACT2",91,0)
 Q
"RTN","ORCACT2",92,0)
 ;
"RTN","ORCACT2",93,0)
DCREASON() ; -- Returns Reason for DC
"RTN","ORCACT2",94,0)
 N X,Y,DIC
"RTN","ORCACT2",95,0)
 ;I $D(^XUSEC("ORES",DUZ)) S Y=+$O(^ORD(100.03,"C","ORREQ",0)) I Y S Y(0)=$G(^ORD(100.03,Y,0)),Y=Y_U_$P(Y(0),U) G DCRQ ; silent
"RTN","ORCACT2",96,0)
 S DIC="^ORD(100.03,",DIC(0)="AEMQZ",DIC("B")=+$O(^ORD(100.03,"C","ORREQ",0)),DIC("W")="W:$L($P(^(0),U))>30 $E($P(^(0),U),31,999)" K:DIC("B")'>0 DIC("B")
"RTN","ORCACT2",97,0)
 S DIC("S")="I '$P(^(0),U,4),$P(^(0),U,5)="_+$O(^DIC(9.4,"C","OR",0))_",$P(^(0),U,7)'="_+$O(^ORD(100.02,"C","A",0)),DIC("A")="REASON FOR DC: "
"RTN","ORCACT2",98,0)
 D ^DIC
"RTN","ORCACT2",99,0)
DCRQ S:Y>0 Y=Y_U_$S($P(Y(0),U,7):$P($G(^ORD(100.02,+$P(Y(0),U,7),0)),U,2),1:"W") ; ^nature
"RTN","ORCACT2",100,0)
 Q Y
"RTN","ORCACT2",101,0)
 ;
"RTN","ORCACT2",102,0)
SET(ORDER,NATURE,REASON,TEXT) ; -- Set DC Reason into 6-node
"RTN","ORCACT2",103,0)
 Q:'$G(ORDER)  Q:'$D(^OR(100,+ORDER,0))  S ORDER=+ORDER
"RTN","ORCACT2",104,0)
 I $L($G(NATURE)),NATURE'>0 S NATURE=$O(^ORD(100.02,"C",NATURE,0))
"RTN","ORCACT2",105,0)
 S ^OR(100,ORDER,6)=$G(NATURE)_U_DUZ_U_$E($$NOW^XLFDT,1,12)_U_$G(REASON)_U_$G(TEXT)
"RTN","ORCACT2",106,0)
 Q
"RTN","ORCACT2",107,0)
 ;
"RTN","ORCACT2",108,0)
RESUME(ORDER) ; -- Resume tray service when dc'ing tubefeeding ORDER?
"RTN","ORCACT2",109,0)
 N X,Y,DIR,DIC,DA S X=$$RESUME^FHWORR(+ORVP)
"RTN","ORCACT2",110,0)
 I '$L(X) W !,"NOTE: NO current diet order exists for this patient!" Q
"RTN","ORCACT2",111,0)
 Q:'X  I X=2 W !,"Note: Patient is on a WITHHOLD SERVICE order!"
"RTN","ORCACT2",112,0)
 S DIR(0)="YA",DIR("A")="Do you wish to resume tray service? "
"RTN","ORCACT2",113,0)
 S DIR("?")="Enter YES to resume the previous diet order",DIR("B")="NO"
"RTN","ORCACT2",114,0)
 D ^DIR I Y'=1 S:$D(DTOUT)!(X["^") ORQUIT=1
"RTN","ORCACT2",115,0)
 D:Y=1 RESUME^ORCSAVE(+ORDER)
"RTN","ORCACT2",116,0)
 Q
"RTN","ORCACT2",117,0)
 ;
"RTN","ORCACT2",118,0)
UNREL ; -- Process unreleased/delayed order
"RTN","ORCACT2",119,0)
 N ORA,ORA0,ORDEL,DA,DR,DIE
"RTN","ORCACT2",120,0)
 S ORA=+$P(ORIFN,";",2),ORA0=$G(^OR(100,+ORIFN,8,ORA,0))
"RTN","ORCACT2",121,0)
 S ORDEL=$S(ORSTS=11:1,$P(ORA0,U,4)=2:1,1:0)
"RTN","ORCACT2",122,0)
 W !,"This order was not released "_$S(ORDEL:"to the service and will be deleted.",1:"but signed and will be cancelled.") H 1 I ORDEL D
"RTN","ORCACT2",123,0)
 . K:$P(ORA0,U,2)="DC" ^OR(100,+ORIFN,6) I $P(ORA0,U,2)="NW" D
"RTN","ORCACT2",124,0)
 .. S:$P(OR3,U,5) $P(^OR(100,+$P(OR3,U,5),3),U,6)=""
"RTN","ORCACT2",125,0)
 .. I $P(OR0,U,17) S DA=+$O(^ORE(100.2,"AO",+ORIFN,0)) I DA S DR="4///@",DIE=100.2 D ^DIE
"RTN","ORCACT2",126,0)
 . D DELETE^ORCSAVE2(ORIFN)
"RTN","ORCACT2",127,0)
 D CLRDLY(+ORIFN):'ORDEL,UNLK1^ORX2(+ORIFN) S OREBUILD=1
"RTN","ORCACT2",128,0)
 I $D(^TMP("ORNEW",$J,+ORIFN,ORA)) K ^(ORA) D UNLK1^ORX2(+ORIFN) ;decrement lock again
"RTN","ORCACT2",129,0)
 Q
"RTN","ORCACT2",130,0)
 ;
"RTN","ORCACT2",131,0)
EVENT ; -- Cancel event too?
"RTN","ORCACT2",132,0)
 N EVT,X
"RTN","ORCACT2",133,0)
 S EVT=0 F  S EVT=$O(OREVT(EVT)) Q:EVT<1  D  Q:$G(ORQUIT)
"RTN","ORCACT2",134,0)
 . Q:$G(^ORE(100.2,EVT,1))  Q:'$$EMPTY^OREVNTX(EVT)  ;done or has orders
"RTN","ORCACT2",135,0)
 . ;W !!,$P($$NAME^OREVNTX(EVT)," ",2,99)_" has no more delayed orders."
"RTN","ORCACT2",136,0)
 . ;S DIR(0)="YA",DIR("A")="Do you want to cancel this event? "
"RTN","ORCACT2",137,0)
 . ;S DIR("?")="Enter NO if you wish to enter new delayed orders for this event, otherwise enter YES to terminate it."
"RTN","ORCACT2",138,0)
 . ;S DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT) S ORQUIT=1 Q
"RTN","ORCACT2",139,0)
 . D CANCEL^OREVNTX(EVT) S X=$P($$NAME^OREVNTX(EVT)," ",2,99)
"RTN","ORCACT2",140,0)
 . W !,"   ... "_X_" event cancelled." H 1
"RTN","ORCACT2",141,0)
 . I $G(OREVENT),OREVENT=EVT D EX^OREVNT ;Return to Active Orders
"RTN","ORCACT2",142,0)
 Q
"RTN","ORCACT2",143,0)
 ;
"RTN","ORCACT2",144,0)
DCD(IFN) ; -- order discontinued already?
"RTN","ORCACT2",145,0)
 N STS,Y,I S Y=0 I '$G(IFN) Q 1
"RTN","ORCACT2",146,0)
 S STS=+$P($G(^OR(100,+IFN,3)),U,3)
"RTN","ORCACT2",147,0)
 I "^1^2^7^12^13^14^"[(U_STS_U) S Y=1 G DQ ;terminal sts
"RTN","ORCACT2",148,0)
 ;look for existing DC action awaiting ES:
"RTN","ORCACT2",149,0)
 S I=0 F  S I=+$O(^OR(100,+IFN,8,"C","DC",I)) Q:I<1  I $P($G(^OR(100,+IFN,8,I,0)),U,15)=11 S Y=1 Q
"RTN","ORCACT2",150,0)
DQ Q Y
"RTN","ORCACT2",151,0)
 ;
"RTN","ORCACT2",152,0)
CLRDLY(IFN) ; -- [old Clear delayed fields] Cancel delayed [event]order
"RTN","ORCACT2",153,0)
 N STS,ORX S IFN=+$G(IFN) Q:IFN'>0
"RTN","ORCACT2",154,0)
 Q:'$D(^OR(100,IFN,0))  S STS=$P($G(^(3)),U,3)
"RTN","ORCACT2",155,0)
 S ORX="Delayed "_$S(STS=10:"Order",1:"Release Event")_" Cancelled"
"RTN","ORCACT2",156,0)
 S ^OR(100,IFN,6)=$O(^ORD(100.02,"C","M",0))_U_DUZ_U_+$E($$NOW^XLFDT,1,12)_U_U_ORX
"RTN","ORCACT2",157,0)
 D STATUS^ORCSAVE2(IFN,13) S $P(^OR(100,IFN,8,1,0),U,15)=13
"RTN","ORCACT2",158,0)
 Q
"RTN","ORCACT3")
0^4^B6858691
"RTN","ORCACT3",1,0)
ORCACT3 ;SLC/MKB-Delayed Orders ; 08 May 2002  2:12 PM
"RTN","ORCACT3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,45,48,79,141**;Dec 17, 1997
"RTN","ORCACT3",3,0)
EN ; -- main entry point
"RTN","ORCACT3",4,0)
 K ORVP D EN^ORQPT Q:'$G(ORVP)
"RTN","ORCACT3",5,0)
 S ORTAB="DELAY" D EN^VALM("OR DELAYED ORDERS")
"RTN","ORCACT3",6,0)
 Q
"RTN","ORCACT3",7,0)
 ;
"RTN","ORCACT3",8,0)
EN1(ORVP) ; -- entry point for use with DGPM MOVEMENT EVENTS
"RTN","ORCACT3",9,0)
 Q:'$$ACCESS^ORCHTAB  ;CPRS not in user's option menu tree
"RTN","ORCACT3",10,0)
 Q:'$G(ORVP)  Q:'$$REVIEW(DFN)
"RTN","ORCACT3",11,0)
 N ORTAB,DFN ;protect DFN within event protocol
"RTN","ORCACT3",12,0)
 S DFN=+ORVP,ORVP=DFN_";DPT(",ORTAB="DELAY" D SLCT1^ORQPT
"RTN","ORCACT3",13,0)
 D EN^VALM("OR DELAYED ORDERS")
"RTN","ORCACT3",14,0)
 Q
"RTN","ORCACT3",15,0)
 ;
"RTN","ORCACT3",16,0)
REVIEW(PAT) ; -- Want to review delayed orders?
"RTN","ORCACT3",17,0)
 N X,Y,DIR Q:'$D(^OR(100,"AEVNT",PAT_";DPT(")) 0
"RTN","ORCACT3",18,0)
 S DIR(0)="YA",DIR("A")="Review delayed orders? ",DIR("B")="YES"
"RTN","ORCACT3",19,0)
 S DIR("?")="Answer YES to review this patient's delayed orders"
"RTN","ORCACT3",20,0)
 D ^DIR
"RTN","ORCACT3",21,0)
 Q +Y
"RTN","ORCACT3",22,0)
 ;
"RTN","ORCACT3",23,0)
INIT ; -- init variables and list array
"RTN","ORCACT3",24,0)
 D TAB^ORCHART(ORTAB)
"RTN","ORCACT3",25,0)
 Q
"RTN","ORCACT3",26,0)
 ;
"RTN","ORCACT3",27,0)
PHDR ; -- protocol menu header code
"RTN","ORCACT3",28,0)
 N ORM,ORI,ORS,ORSYN
"RTN","ORCACT3",29,0)
 S VALMSG=$$MSG^ORCHART D SHOW^VALM
"RTN","ORCACT3",30,0)
 S ORM=+$O(^ORD(101,"B","ORC DELAY ACTIONS",0))
"RTN","ORCACT3",31,0)
 S XQORM("#")=ORM_"^1:"_+$P($G(^TMP("OR",$J,"DELAY",0)),U,2),ORI=0
"RTN","ORCACT3",32,0)
 F  S ORI=+$O(^ORD(101,ORM,10,"B",ORI)) Q:ORI<1  I $D(^ORD(101,ORI,2)) D
"RTN","ORCACT3",33,0)
 . S ORS=0 F  S ORS=$O(^ORD(101,ORI,2,ORS)) Q:ORS'>0  S ORSYN=$G(^(ORS,0)) S:$L(ORSYN) XQORM("KEY",ORSYN)=+ORI_"^1"
"RTN","ORCACT3",34,0)
 Q
"RTN","ORCACT3",35,0)
 ;
"RTN","ORCACT3",36,0)
HELP ; -- help code
"RTN","ORCACT3",37,0)
 N X W !!,"Enter the display numbers of the items you wish to act on; a menu of"
"RTN","ORCACT3",38,0)
 W !,"available actions will then be presented for selection."
"RTN","ORCACT3",39,0)
 W !,"Press <return> to continue ..." R X:DTIME S VALMBCK=""
"RTN","ORCACT3",40,0)
 Q
"RTN","ORCACT3",41,0)
 ;
"RTN","ORCACT3",42,0)
EXIT ; -- exit code
"RTN","ORCACT3",43,0)
 D UNLOCK^ORX2(+ORVP) K ^TMP("OR",$J),^TMP("LRRR",$J)
"RTN","ORCACT3",44,0)
 K VALMCNT,VALMHDR,VALMBG,ORQUIT,ORVP,ORSEX,ORTAB,ORPNM,ORSSN,ORL,ORDOB,ORAGE,ORPD,ORNP,ORSC,ORTS,ORWARD,ORATTEND,ORNMBR,ORACTION,OREBUILD,OREVENT
"RTN","ORCACT3",45,0)
 Q
"RTN","ORCACT3",46,0)
 ;
"RTN","ORCACT3",47,0)
DC ; -- cancel orders
"RTN","ORCACT3",48,0)
 W !!,"This action is no longer supported." H 2
"RTN","ORCACT3",49,0)
 S VALMBCK=""
"RTN","ORCACT3",50,0)
 Q
"RTN","ORCACT3",51,0)
 ;
"RTN","ORCACT3",52,0)
RELEASE ; -- Release orders to the service
"RTN","ORCACT3",53,0)
 W !!,"This action is no longer supported." H 2
"RTN","ORCACT3",54,0)
 S VALMBCK=""
"RTN","ORCACT3",55,0)
 Q
"RTN","ORCACT3",56,0)
 ;
"RTN","ORCACT3",57,0)
TS ; -- Edit treating specialty
"RTN","ORCACT3",58,0)
 W !!,"This action is no longer supported." H 2
"RTN","ORCACT3",59,0)
 S VALMBCK=""
"RTN","ORCACT3",60,0)
 Q
"RTN","ORCACT4")
0^5^B38256140
"RTN","ORCACT4",1,0)
ORCACT4 ;SLC/MKB-Act on orders cont ; 08 May 2002  2:12 PM
"RTN","ORCACT4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,116,141**;Dec 17, 1997
"RTN","ORCACT4",3,0)
XX ; -- Edit/Change order ORIFN
"RTN","ORCACT4",4,0)
 N ORDIALOG,ORQUIT,FIRST,X,OREDIT,ORCHECK,ORSTS,ORDA,OR0,ORDG,ORNMSP,OREVENT,ORDUZ,ORLOG,ORTYPE
"RTN","ORCACT4",5,0)
 K ^TMP("ORWORD",$J) S FIRST=0,ORTYPE="D"
"RTN","ORCACT4",6,0)
 S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P(^(3),U,3),ORDG=$P(OR0,U,11)
"RTN","ORCACT4",7,0)
 I $P(OR0,U,17),ORSTS=10 S OREVENT=$P(OR0,U,17)
"RTN","ORCACT4",8,0)
 S OREDIT=$S(ORSTS=11:0,ORSTS=10:0,1:1),ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORCACT4",9,0)
 S X=$P(OR0,U,5) I X'["101.41" D  ; 2.5
"RTN","ORCACT4",10,0)
 . N X,WP S ORDIALOG=$$PTR^ORCD("OR GXTEXT WORD PROCESSING ORDER")
"RTN","ORCACT4",11,0)
 . D GETDLG^ORCD(ORDIALOG) S WP=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORCACT4",12,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"","_$J_","_WP_",1)"
"RTN","ORCACT4",13,0)
 . M ^TMP("ORWORD",$J,WP,1)=^OR(100,+ORIFN,1) ; edit order text
"RTN","ORCACT4",14,0)
 . S X=$O(^TMP("ORWORD",$J,WP,1,0)) I X,$E(^(X,0),1,3)=">> " S ^TMP("ORWORD",$J,WP,1,X,0)=$E(^OR(100,+ORIFN,1,X,0),4,999)
"RTN","ORCACT4",15,0)
 I X["101.41" S ORDIALOG=+X S:$P($G(^ORD(101.41,+X,0)),U,4)'="D" ORDIALOG=+$P($G(^ORD(100.98,+$P(OR0,U,11),0)),U,4) D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(+ORIFN)
"RTN","ORCACT4",16,0)
 X:$D(^ORD(101.41,+ORDIALOG,3)) ^(3) G:$G(ORQUIT) XXQ ; entry action
"RTN","ORCACT4",17,0)
 D DISPLAY^ORCHECK ;pkg order checks
"RTN","ORCACT4",18,0)
XX1 D DIALOG^ORCDLG G:$G(ORQUIT)&FIRST XXQ
"RTN","ORCACT4",19,0)
 I '$$CHANGED W !!,"Nothing changed!" H 2 Q
"RTN","ORCACT4",20,0)
 D ACCEPT^ORCHECK(),DISPLAY^ORCDLG S X=$$OK(ORACT)
"RTN","ORCACT4",21,0)
 G:X="^" XXQ I X="E" K ORCHECK G XX1
"RTN","ORCACT4",22,0)
 I X="C" W !?10,"... changes cancelled.",! G XXQ
"RTN","ORCACT4",23,0)
 I X="P" D XX^ORCSAVE W !?10,$S(ORIFN:"... changes placed.",1:"ERROR"),! S:ORIFN ^TMP("ORNEW",$J,ORIFN,1)=""
"RTN","ORCACT4",24,0)
XXQ X:$D(^ORD(101.41,+ORDIALOG,4)) ^(4) K ^TMP("ORWORD",$J) ; exit action
"RTN","ORCACT4",25,0)
 Q
"RTN","ORCACT4",26,0)
 ;
"RTN","ORCACT4",27,0)
CHANGED() ; -- Returns 1 or 0, if order was actually changed
"RTN","ORCACT4",28,0)
 N OROLD,P,I,Y D GETORDER^ORCD(+ORIFN,"OROLD") S Y=0
"RTN","ORCACT4",29,0)
 S P=0 F  S P=$O(ORDIALOG(P)) Q:P'>0  D  Q:Y
"RTN","ORCACT4",30,0)
 . S I=0 F  S I=$O(OROLD(P,I)) Q:I'>0  D CHK Q:Y
"RTN","ORCACT4",31,0)
 . Q:Y  S I=0 F  S I=$O(ORDIALOG(P,I)) Q:I'>0  D CHK Q:Y
"RTN","ORCACT4",32,0)
 Q Y
"RTN","ORCACT4",33,0)
 ;
"RTN","ORCACT4",34,0)
CHK N OLD,NEW S OLD=$G(OROLD(P,I)),NEW=$G(ORDIALOG(P,I)) S:NEW'=OLD Y=1
"RTN","ORCACT4",35,0)
 ;I $E(ORDIALOG(P,0))'="W" S:NEW'=OLD Y=1 Q
"RTN","ORCACT4",36,0)
 ;I @OLD@(0)'=@NEW@(0) S Y=1
"RTN","ORCACT4",37,0)
 Q
"RTN","ORCACT4",38,0)
 ;
"RTN","ORCACT4",39,0)
RN ; -- Renew order ORIFN
"RTN","ORCACT4",40,0)
 N ORDIALOG,ORQUIT,FIRST,ORENEW,ORCHECK,ORDA,OR0,ORDG,ORNMSP,ORDUZ,ORLOG,ORTYPE,X
"RTN","ORCACT4",41,0)
 K ^TMP("ORWORD",$J) S FIRST=0,ORENEW=1,ORTYPE="D"
"RTN","ORCACT4",42,0)
 S OR0=$G(^OR(100,+ORIFN,0)),ORNMSP=$$NMSP^ORCD($P(OR0,U,14)),ORDG=$P(OR0,U,11),ORDIALOG=+$P(OR0,U,5)
"RTN","ORCACT4",43,0)
 I $P(OR0,U,5)["101.41" S:$P($G(^ORD(101.41,ORDIALOG,0)),U,4)'="D" ORDIALOG=+$P($G(^ORD(100.98,+$P(OR0,U,11),0)),U,4) D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(+ORIFN)
"RTN","ORCACT4",44,0)
 I $P(OR0,U,5)'["101.41" D  ; protocol -> use WP dialog for renewal
"RTN","ORCACT4",45,0)
 . N STOP,WP,X S ORDIALOG=$$PTR^ORCD("OR GXTEXT WORD PROCESSING ORDER")
"RTN","ORCACT4",46,0)
 . D GETDLG^ORCD(ORDIALOG)
"RTN","ORCACT4",47,0)
 . S WP=$$PTR^ORCD("OR GTX WORD PROCESSING 1"),ORDIALOG(WP,1)="^TMP(""ORWORD"","_$J_","_WP_",1)" M ^TMP("ORWORD",$J,WP,1)=^OR(100,+ORIFN,1)
"RTN","ORCACT4",48,0)
 . S X=$O(^TMP("ORWORD",$J,WP,1,0)) I X,$E(^(X,0),1,3)=">> " S ^TMP("ORWORD",$J,WP,1,X,0)=$E(^OR(100,+ORIFN,1,X,0),4,999)
"RTN","ORCACT4",49,0)
 . S STOP=$P(OR0,U,9) I STOP,STOP>$$NOW^XLFDT S ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)=STOP
"RTN","ORCACT4",50,0)
 X:$D(^ORD(101.41,+ORDIALOG,3)) ^(3) G:$G(ORQUIT) RNQ ; entry action
"RTN","ORCACT4",51,0)
 D DISPLAY^ORCHECK ;pkg order checks
"RTN","ORCACT4",52,0)
RN1 D DIALOG^ORCDLG G:$G(ORQUIT) RNQ
"RTN","ORCACT4",53,0)
 D ACCEPT^ORCHECK() S X="P"
"RTN","ORCACT4",54,0)
 I $G(ORCHECK) D DISPLAY^ORCDLG S X=$$OK(ORACT) G:X="^" RNQ
"RTN","ORCACT4",55,0)
 I X="C" W !?10,"... renewal cancelled.",! G RNQ
"RTN","ORCACT4",56,0)
 I X="P" D RN^ORCSAVE W !?10,$S(ORIFN:"... order renewed.",1:"ERROR"),! S:ORIFN ^TMP("ORNEW",$J,ORIFN,1)=""
"RTN","ORCACT4",57,0)
RNQ X:$D(^ORD(101.41,+ORDIALOG,4)) ^(4) K ^TMP("ORWORD",$J)
"RTN","ORCACT4",58,0)
 Q
"RTN","ORCACT4",59,0)
 ;
"RTN","ORCACT4",60,0)
RW ; -- Rewrite order ORIFN
"RTN","ORCACT4",61,0)
 N ORDIALOG,ORQUIT,FIRST,OREWRITE,ORCHECK,ORDA,OR0,ORDG,ORNMSP,ORDUZ,ORLOG,ORTYPE,X
"RTN","ORCACT4",62,0)
 K ^TMP("ORWORD",$J) S FIRST=1,OREWRITE=1,ORTYPE="D"
"RTN","ORCACT4",63,0)
 S OR0=$G(^OR(100,+ORIFN,0)),ORNMSP=$$NMSP^ORCD($P(OR0,U,14)),ORDG=$P(OR0,U,11),ORDIALOG=+$P(OR0,U,5)
"RTN","ORCACT4",64,0)
 I $P(OR0,U,5)["101.41" D  ;get dialog, responses
"RTN","ORCACT4",65,0)
 . S:$P($G(^ORD(101.41,ORDIALOG,0)),U,4)'="D" ORDIALOG=+$P($G(^ORD(100.98,+$P(OR0,U,11),0)),U,4)
"RTN","ORCACT4",66,0)
 . I ORNMSP="PS",$G(OREVENT) D  ;use generic Meds dlg
"RTN","ORCACT4",67,0)
 .. N X S X=$P($G(^ORD(100.98,+ORDG,0)),U,3)
"RTN","ORCACT4",68,0)
 .. Q:X="IV RX"  Q:X="SPLY"  ;don't switch these
"RTN","ORCACT4",69,0)
 .. S ORDIALOG=+$O(^ORD(101.41,"AB","PS MEDS",0))
"RTN","ORCACT4",70,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(+ORIFN)
"RTN","ORCACT4",71,0)
 I $P(OR0,U,5)'["101.41" D  ; protocol -> use WP dialog for renewal
"RTN","ORCACT4",72,0)
 . N WP,X S ORDIALOG=$$PTR^ORCD("OR GXTEXT WORD PROCESSING ORDER")
"RTN","ORCACT4",73,0)
 . D GETDLG^ORCD(ORDIALOG)
"RTN","ORCACT4",74,0)
 . S WP=$$PTR^ORCD("OR GTX WORD PROCESSING 1"),ORDIALOG(WP,1)="^TMP(""ORWORD"","_$J_","_WP_",1)" M ^TMP("ORWORD",$J,WP,1)=^OR(100,+ORIFN,1)
"RTN","ORCACT4",75,0)
 . S X=$O(^TMP("ORWORD",$J,WP,1,0)) I X,$E(^(X,0),1,3)=">> " S ^TMP("ORWORD",$J,WP,1,X,0)=$E(^OR(100,+ORIFN,1,X,0),4,999)
"RTN","ORCACT4",76,0)
 X:$D(^ORD(101.41,+ORDIALOG,3)) ^(3) G:$G(ORQUIT) RWQ
"RTN","ORCACT4",77,0)
 D DISPLAY^ORCHECK ;pkg order checks
"RTN","ORCACT4",78,0)
RW1 D DIALOG^ORCDLG G:$G(ORQUIT)&FIRST RWQ
"RTN","ORCACT4",79,0)
 D ACCEPT^ORCHECK() ;($S(FIRST:"ALL",1:""))
"RTN","ORCACT4",80,0)
 I $G(OREVENT),$G(^ORE(100.2,+OREVENT,1)) D  ;event occurred
"RTN","ORCACT4",81,0)
 . W !!,"This release event has occurred since you started copying delayed orders."
"RTN","ORCACT4",82,0)
 . W !,"The orders that were signed have now been released; this and any other"
"RTN","ORCACT4",83,0)
 . W !,"unsigned orders will be released immediately upon signature."
"RTN","ORCACT4",84,0)
 . N X W !!,"Press <return> to continue ..." R X:DTIME K OREVENT
"RTN","ORCACT4",85,0)
 D DISPLAY^ORCDLG S X=$$OK^ORCDLG G:X="^" RWQ
"RTN","ORCACT4",86,0)
 I X="E" S FIRST=0 K ORCHECK G RW1
"RTN","ORCACT4",87,0)
 I X="C" W !?10,"... order cancelled.",! G RWQ
"RTN","ORCACT4",88,0)
 I X="P" D
"RTN","ORCACT4",89,0)
 . N OLDIFN S OLDIFN=+ORIFN K ORIFN D EN^ORCSAVE
"RTN","ORCACT4",90,0)
 . W !?10,$S($G(ORIFN):"... order rewritten.",1:"ERROR"),!
"RTN","ORCACT4",91,0)
 . I $G(ORIFN) S ^TMP("ORNEW",$J,ORIFN,1)="" S:$D(^OR(100,OLDIFN,5)) ^OR(100,ORIFN,5)=^OR(100,OLDIFN,5)
"RTN","ORCACT4",92,0)
RWQ X:$D(^ORD(101.41,+ORDIALOG,4)) ^(4) K ^TMP("ORWORD",$J)
"RTN","ORCACT4",93,0)
 Q
"RTN","ORCACT4",94,0)
 ;
"RTN","ORCACT4",95,0)
HD ; -- Hold order ORIFN
"RTN","ORCACT4",96,0)
 N X S X=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP) Q:'X
"RTN","ORCACT4",97,0)
 S ^TMP("ORNEW",$J,+ORIFN,X)=""
"RTN","ORCACT4",98,0)
 W !?10,"... hold order placed."
"RTN","ORCACT4",99,0)
 Q
"RTN","ORCACT4",100,0)
 ;
"RTN","ORCACT4",101,0)
RL ; -- Release hold on order ORIFN
"RTN","ORCACT4",102,0)
 N X S X=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP) Q:'X
"RTN","ORCACT4",103,0)
 S ^TMP("ORNEW",$J,+ORIFN,X)=""
"RTN","ORCACT4",104,0)
 W !?10,"... release hold order placed."
"RTN","ORCACT4",105,0)
 Q
"RTN","ORCACT4",106,0)
 ;
"RTN","ORCACT4",107,0)
OK(ACT) ; -- Ready to save?
"RTN","ORCACT4",108,0)
 N X,Y,DIR
"RTN","ORCACT4",109,0)
 S DIR(0)="SA^P:PLACE;C:CANCEL;"_$S(ACT'="RN":"E:EDIT;",1:"")
"RTN","ORCACT4",110,0)
 S:ACT="XX" DIR("A")="(P)lace, (E)dit, or (C)ancel changes? ",DIR("?")="Enter P to save the changes to this order, or E to change any of the displayed values; enter C to quit without changing this order"
"RTN","ORCACT4",111,0)
 S:ACT="RN" DIR("A")="(P)lace or (C)ancel renewal? ",DIR("?")="Enter P to save this renewal or C to quit without renewing this order"
"RTN","ORCACT4",112,0)
 S DIR("B")="PLACE" D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCACT4",113,0)
 Q Y
"RTN","ORCD")
0^6^B49775980
"RTN","ORCD",1,0)
ORCD ; SLC/MKB - Order Dialog utilities ;11/14/02  10:11
"RTN","ORCD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,38,68,94,161,141**;Dec 17, 1997
"RTN","ORCD",3,0)
INPT() ; -- Return 1 or 0, if patient/order sheet = inpatient
"RTN","ORCD",4,0)
 N Y S Y=+$G(ORWARD) I $G(OREVENT) D
"RTN","ORCD",5,0)
 . N X,X0 S X=$$EVT^OREVNTX(+OREVENT),X0=$G(^ORD(100.5,+X,0)),Y=1
"RTN","ORCD",6,0)
 . I $P(X0,U,2)="D",$P(X0,U,7)'=41 S Y=0 Q  ;From ASIH=Inpt
"RTN","ORCD",7,0)
 . I $P(X0,U,2)="T",$P(X0,U,7),$P(X0,U,7)<4 S Y=0 ;pass
"RTN","ORCD",8,0)
 Q Y
"RTN","ORCD",9,0)
 ;
"RTN","ORCD",10,0)
EXT(P,I,F) ; -- Returns external value of ORDIALOG(Prompt,Instance)
"RTN","ORCD",11,0)
 N TYPE,PARAM,FNUM,IENS,X,Y,J,Z
"RTN","ORCD",12,0)
 S TYPE=$E(ORDIALOG(P,0)),PARAM=$P(ORDIALOG(P,0),U,2),X=ORDIALOG(P,I)
"RTN","ORCD",13,0)
 I "FNW"[TYPE Q X
"RTN","ORCD",14,0)
 I TYPE="Y" Q $S(X:"YES",X=0:"NO",1:"")
"RTN","ORCD",15,0)
 I TYPE="D" S:'$L($G(F)) F=1 Q $$FMTE^XLFDT(X,F)
"RTN","ORCD",16,0)
 I TYPE="R" Q $$FTDATE(X,$G(F)) ; DAY@TIME
"RTN","ORCD",17,0)
 I TYPE="P" D  Q Y
"RTN","ORCD",18,0)
 . S PARAM=$P(PARAM,":"),FNUM=$S(PARAM:+PARAM,1:+$P(@(U_PARAM_"0)"),U,2))
"RTN","ORCD",19,0)
 . S IENS=+X_",",J=$L(PARAM,",") I J>2 F  S J=J-2 Q:J'>0  S Z=$P(PARAM,",",J),IENS=IENS_$S(Z:Z,1:+$P(Z,"(",2))_","
"RTN","ORCD",20,0)
 . S:'+$G(F) F=.01 S Y=$$GET1^DIQ(FNUM,IENS,+F)
"RTN","ORCD",21,0)
 . I Y="",F'=.01 S Y=$$GET1^DIQ(FNUM,IENS,.01)
"RTN","ORCD",22,0)
 I TYPE="S" F J=1:1:$L(PARAM,";") S Z=$P(PARAM,";",J) I $P(Z,":")=X S Y=$S(+$G(F):X,1:$P(Z,":",2)) Q
"RTN","ORCD",23,0)
 Q $G(Y)
"RTN","ORCD",24,0)
 ;
"RTN","ORCD",25,0)
FTDATE(X,F) ; -- Returns free text form of date (i.e. TODAY)
"RTN","ORCD",26,0)
 N D,T,P,Y I X="" Q ""
"RTN","ORCD",27,0)
 S X=$$UP^XLFSTR(X),D=$P(X,"@"),T=$P(X,"@",2) ; D=date,T=time parts
"RTN","ORCD",28,0)
 I "NOW"[X Q "NOW"
"RTN","ORCD",29,0)
 I "NOON"[X Q "NOON"
"RTN","ORCD",30,0)
 I $E("MIDNIGHT",1,$L(X))=X Q "MIDNIGHT"
"RTN","ORCD",31,0)
 I (X="AM")!(X="NEXT") Q X_" Lab collection"
"RTN","ORCD",32,0)
 I (X="NEXTA")!(X="CLOSEST") Q $S(X="NEXTA":"NEXT",1:X)_" administration time"
"RTN","ORCD",33,0)
 I $E(D)'="T",$E(D)'="V",($E(D)'="N"!($E(D,1,3)="NOV")) D  Q $$FMTE^XLFDT(X,F)
"RTN","ORCD",34,0)
 . N %DT S %DT="TX" D ^%DT S:Y>0 X=Y S:'$G(F) F=1
"RTN","ORCD",35,0)
 S P=$S(D["+":"+",D["-":"-",1:"")
"RTN","ORCD",36,0)
 I P="" S Y=$S($E(D)="T":"TODAY",$E(D)="V":"NEXT VISIT",1:"NOW")
"RTN","ORCD",37,0)
FTD1 E  D
"RTN","ORCD",38,0)
 . N OFFSET,NUM,UNIT
"RTN","ORCD",39,0)
 . S OFFSET=$P(D,P,2),NUM=+OFFSET,UNIT=$E($P(OFFSET,NUM,2)) ; +/-#D
"RTN","ORCD",40,0)
 . I $E(D)="T",NUM=1 S Y=$S(P="+":"TOMORROW",1:"YESTERDAY") Q
"RTN","ORCD",41,0)
 . S Y=NUM_" "_$S(UNIT="'":"MINUTE",UNIT="H":"HOUR",UNIT="W":"WEEK",UNIT="M":"MONTH",1:"DAY")
"RTN","ORCD",42,0)
 . S:NUM>1 Y=Y_"S" ; plural
"RTN","ORCD",43,0)
 . S:$E(D)="N" Y=Y_" "_$S(P="+":"FROM NOW",1:"AGO")
"RTN","ORCD",44,0)
 . S:$E(D)="T" Y=Y_" "_$S(P="+":"FROM TODAY",1:"AGO")
"RTN","ORCD",45,0)
 . S:$E(D)="V" Y=Y_" "_$S(P="+":"AFTER",1:"BEFORE")_" NEXT VISIT"
"RTN","ORCD",46,0)
 I $L(T) S Y=Y_"@"_$$TIME(T)
"RTN","ORCD",47,0)
 Q Y
"RTN","ORCD",48,0)
 ;
"RTN","ORCD",49,0)
FTDHELP ; -- Displays ??-help for R-type prompts
"RTN","ORCD",50,0)
 G R^ORCDLGH
"RTN","ORCD",51,0)
 Q
"RTN","ORCD",52,0)
 ;
"RTN","ORCD",53,0)
FTDCOMP(X1,X2,OPER) ; -- Compares free text dates from prompts X1 & X2
"RTN","ORCD",54,0)
 ;    Returns 1 or 0, IF $$VAL(X1)<OPER>$$VAL(X2) is true
"RTN","ORCD",55,0)
 N X,Y,Y1,Y2,Z,%DT
"RTN","ORCD",56,0)
 S X=$$VAL(X1),%DT="TX" D ^%DT S Y1=Y ; Y'>0 ??
"RTN","ORCD",57,0)
 S X=$$VAL(X2),%DT="TX" D ^%DT S Y2=Y ; Y'>0 ??
"RTN","ORCD",58,0)
 S Z="I "_Y1_OPER_Y2 X Z
"RTN","ORCD",59,0)
 Q $T
"RTN","ORCD",60,0)
 ;
"RTN","ORCD",61,0)
TIME(X) ; -- Returns 00:00 PM formatted time
"RTN","ORCD",62,0)
 N Y,Z,%DT
"RTN","ORCD",63,0)
 I "NOON"[X Q X
"RTN","ORCD",64,0)
 I "MIDNIGHT"[X Q "MIDNIGHT"
"RTN","ORCD",65,0)
 I X?1U,"BNE"[X Q $S(X="B":"BREAKFAST",X="N":"NOON",X="E":"EVENING",1:"")
"RTN","ORCD",66,0)
 S X="T@"_X,%DT="TX" D ^%DT I Y'>0 Q ""
"RTN","ORCD",67,0)
 S Z=$$FMTE^XLFDT(Y,"2P"),Z=$P(Z," ",2)_$$UP^XLFSTR($P(Z," ",3))
"RTN","ORCD",68,0)
 Q Z
"RTN","ORCD",69,0)
 ;
"RTN","ORCD",70,0)
VAL(TEXT,INST) ; -- Returns internal form of TEXT's current value
"RTN","ORCD",71,0)
 N I,X S X="" S:'$G(INST) INST=1
"RTN","ORCD",72,0)
 I '$D(ORDIALOG("B",TEXT)) S I=$O(ORDIALOG("B",TEXT)) Q:$E(I,1,$L(TEXT))'=TEXT X S TEXT=I ; partial match
"RTN","ORCD",73,0)
 S X=$P($G(ORDIALOG("B",TEXT)),U,2) ; ptr
"RTN","ORCD",74,0)
 Q $G(ORDIALOG(X,INST))
"RTN","ORCD",75,0)
 ;
"RTN","ORCD",76,0)
ORDMSG(OI) ; -- Display order message for orderable OI
"RTN","ORCD",77,0)
 Q:'$O(^ORD(101.43,OI,8,0))  ; no order message
"RTN","ORCD",78,0)
 N I S I=0 W !
"RTN","ORCD",79,0)
 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  W !,$G(^(I,0))
"RTN","ORCD",80,0)
 W ! Q
"RTN","ORCD",81,0)
 ;
"RTN","ORCD",82,0)
PTR(NAME) ; -- Returns pointer to Dialog file for prompt NAME
"RTN","ORCD",83,0)
 Q +$O(^ORD(101.41,"AB",$E(NAME,1,63),0))
"RTN","ORCD",84,0)
 ;
"RTN","ORCD",85,0)
NMSP(PKG) ; -- Returns package namespace from pointer
"RTN","ORCD",86,0)
 N Y S Y=$$GET1^DIQ(9.4,+PKG_",",1)
"RTN","ORCD",87,0)
 S:$E(Y,1,2)="PS" Y="PS" S:Y="GMRV" Y="OR"
"RTN","ORCD",88,0)
 Q Y
"RTN","ORCD",89,0)
 ;
"RTN","ORCD",90,0)
GETQDLG(QIFN) ; -- define ORDIALOG(PROMPT) for quick order QIFN
"RTN","ORCD",91,0)
 S ORDIALOG=$$DEFDLG(QIFN) Q:'ORDIALOG
"RTN","ORCD",92,0)
 D GETDLG(ORDIALOG),GETORDER("^ORD(101.41,"_QIFN_",6)")
"RTN","ORCD",93,0)
 X:$D(^ORD(101.41,QIFN,3)) ^(3) ; entry action for quick order
"RTN","ORCD",94,0)
 Q
"RTN","ORCD",95,0)
 ;
"RTN","ORCD",96,0)
DEFDLG(QDLG) ; -- Returns default dialog for QDLG
"RTN","ORCD",97,0)
 N DG,DLG,TOP S DG=+$P($G(^ORD(101.41,+QDLG,0)),U,5)
"RTN","ORCD",98,0)
 S DLG=+$P($G(^ORD(100.98,DG,0)),U,4) ; default dialog
"RTN","ORCD",99,0)
 I 'DLG S TOP=+$O(^ORD(100.98,"AD",DG,0)),DLG=+$P($G(^ORD(100.98,TOP,0)),U,4)
"RTN","ORCD",100,0)
 Q DLG
"RTN","ORCD",101,0)
 ;
"RTN","ORCD",102,0)
GETDLG(IFN) ; -- define ORDIALOG(PROMPT) for dialog IFN
"RTN","ORCD",103,0)
 N SEQ,DA,ITEM,PTR,PROMPT,TEXT,INDEX,HELP,XHELP,SCREEN,ORD,INPUTXFM,LKP
"RTN","ORCD",104,0)
 S SEQ=0 K ^TMP("ORWORD",$J)
"RTN","ORCD",105,0)
 F  S SEQ=$O(^ORD(101.41,IFN,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,IFN,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORCD",106,0)
 . S ITEM=$G(^ORD(101.41,IFN,10,DA,0)),INPUTXFM=$G(^(.1)),HELP=$G(^(1)),SCREEN=$G(^(4)),XHELP=$G(^(6))
"RTN","ORCD",107,0)
 . S PTR=$P(ITEM,U,2),TEXT=$P(ITEM,U,4),INDEX=$P(ITEM,U,10) Q:'PTR
"RTN","ORCD",108,0)
 . S:'$L(TEXT) TEXT=$P(^ORD(101.41,PTR,0),U,2) K ORD
"RTN","ORCD",109,0)
 . S PROMPT=$G(^ORD(101.41,PTR,1)),ORD=DA_U_$P(PROMPT,U,3)
"RTN","ORCD",110,0)
 . S ORD(0)=$P(PROMPT,U)_$S($P(PROMPT,U)="S":"M",1:"")_U_$P(PROMPT,U,2)_$S($L(INPUTXFM):U_INPUTXFM,1:"")
"RTN","ORCD",111,0)
 . S ORD("A")=TEXT S:$L($P(ITEM,U,13)) ORD("TTL")=$P(ITEM,U,13)
"RTN","ORCD",112,0)
 . I $P(ITEM,U,7) S ORD("MAX")=$P(ITEM,U,12),ORD("MORE")=$P(ITEM,U,14) ; fields for multiples
"RTN","ORCD",113,0)
 . I $L(HELP) S LKP=$P(HELP,U,2),HELP=$P(HELP,U) S:$L(HELP) ORD("?")=HELP S:$L(LKP) ORD("LKP")=$S($L(LKP,";")>1:$TR(LKP,";","^"),1:U_LKP)
"RTN","ORCD",114,0)
 . S:$L(XHELP) ORD("??")=U_XHELP
"RTN","ORCD",115,0)
 . S:$L(INDEX) ORD("D")=INDEX
"RTN","ORCD",116,0)
 . S:$L(SCREEN) ORD("S")=SCREEN
"RTN","ORCD",117,0)
 . S ORDIALOG("B",$$UP^XLFSTR($P(TEXT,":")))=SEQ_U_PTR
"RTN","ORCD",118,0)
 . M ORDIALOG(PTR)=ORD
"RTN","ORCD",119,0)
 Q
"RTN","ORCD",120,0)
 ;
"RTN","ORCD",121,0)
GETDLG1(IFN) ; -- basic ORDIALOG(PROMPT) for dialog IFN
"RTN","ORCD",122,0)
 N SEQ,DA,PROMPT,PTR,WINCTRL
"RTN","ORCD",123,0)
 K ^TMP("ORWORD",$J) S SEQ=0
"RTN","ORCD",124,0)
 F  S SEQ=$O(^ORD(101.41,IFN,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,IFN,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORCD",125,0)
 . S PTR=$P($G(^ORD(101.41,IFN,10,DA,0)),U,2) Q:'PTR
"RTN","ORCD",126,0)
 . S WINCTRL=$P($G(^ORD(101.41,IFN,10,DA,"W")),U)
"RTN","ORCD",127,0)
 . S PROMPT=$G(^ORD(101.41,PTR,1)) Q:'$L(PROMPT)
"RTN","ORCD",128,0)
 . S ORDIALOG(PTR)=DA_U_$P(PROMPT,U,3)_U_WINCTRL
"RTN","ORCD",129,0)
 . S ORDIALOG(PTR,0)=$P(PROMPT,U,1,2)
"RTN","ORCD",130,0)
 Q
"RTN","ORCD",131,0)
 ;
"RTN","ORCD",132,0)
GETORDER(ROOT,ARRAY) ; -- retrieve order values from RESPONSES in ARRAY()
"RTN","ORCD",133,0)
 N ORI,ID,PTR,INST,TYPE,DA,X,ORTXT S:'$L($G(ARRAY)) ARRAY="ORDIALOG"
"RTN","ORCD",134,0)
 I +ROOT=ROOT S ROOT="^OR(100,"_ROOT_",4.5)" ; assume Orders file IFN
"RTN","ORCD",135,0)
 S ORI=0 F  S ORI=$O(@ROOT@(ORI)) Q:ORI'>0  S ID=$G(@ROOT@(ORI,0)) D
"RTN","ORCD",136,0)
 . S DA=$P(ID,U),PTR=$P(ID,U,2),INST=$P(ID,U,3) S:'INST INST=1
"RTN","ORCD",137,0)
 . S:'PTR PTR=$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,2) Q:'PTR
"RTN","ORCD",138,0)
 . Q:'$D(ORDIALOG(PTR))  S TYPE=$E($G(ORDIALOG(PTR,0))) Q:'$L(TYPE)
"RTN","ORCD",139,0)
 . I TYPE'="W" S X=$G(@ROOT@(ORI,1)) S:$L(X) @ARRAY@(PTR,INST)=X Q
"RTN","ORCD",140,0)
 . D RESTXT ;resolve objects
"RTN","ORCD",141,0)
 . I ARRAY="ORDIALOG" M ^TMP("ORWORD",$J,PTR,INST)=@ORTXT S @ARRAY@(PTR,INST)="^TMP(""ORWORD"","_$J_","_PTR_","_INST_")"
"RTN","ORCD",142,0)
 . I ARRAY'="ORDIALOG" M @ARRAY@(PTR,INST)=@ORTXT S @ARRAY@(PTR,INST)=$NA(@ARRAY@(PTR,INST))
"RTN","ORCD",143,0)
 . K @ORTXT
"RTN","ORCD",144,0)
 Q
"RTN","ORCD",145,0)
 ;
"RTN","ORCD",146,0)
RESTXT ; -- resolve objects in text [from GETORDER+8]
"RTN","ORCD",147,0)
 I $G(ORTYPE)="Z" M ^TMP("ORX",$J)=@ROOT@(ORI,2) S ORTXT=$NA(^TMP("ORX",$J)) Q  ;return text unresolved
"RTN","ORCD",148,0)
 N ARRAY,PTR,INST
"RTN","ORCD",149,0)
 D BLRPLT^TIUSRVD(.ORTXT,,+$G(ORVP),,$NA(@ROOT@(ORI,2)))
"RTN","ORCD",150,0)
 Q
"RTN","ORCD",151,0)
 ;
"RTN","ORCD",152,0)
DUP(PROMPT,CURRENT) ; -- Compare CURRENT instance of PROMPT for duplicates
"RTN","ORCD",153,0)
 N X,Y,I
"RTN","ORCD",154,0)
 S X=ORDIALOG(PROMPT,CURRENT),Y=0
"RTN","ORCD",155,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  I I'=CURRENT,$P(ORDIALOG(PROMPT,I),U)=$P(ORDIALOG(PROMPT,CURRENT),U) S Y=1 Q
"RTN","ORCD",156,0)
 Q Y
"RTN","ORCD",157,0)
 ;
"RTN","ORCD",158,0)
LIST ; -- Show contents of ORDIALOG(PROMPT,"LIST")
"RTN","ORCD",159,0)
 N NUM S NUM=$G(ORDIALOG(PROMPT,"LIST")) Q:'NUM
"RTN","ORCD",160,0)
 W !,"Choose from"_$S('$P(NUM,U,2):" (or enter another):",1:":")
"RTN","ORCD",161,0)
LIST1 N I,DONE,CNT S (I,CNT,DONE)=0
"RTN","ORCD",162,0)
 F  S I=$O(ORDIALOG(PROMPT,"LIST",I)) Q:I'>0  D  Q:DONE
"RTN","ORCD",163,0)
 . S CNT=CNT+1 I CNT>(IOSL-2) S CNT=0 I '$$MORE S DONE=1 Q
"RTN","ORCD",164,0)
 . W !,$J(I,6)_"   "_$P(ORDIALOG(PROMPT,"LIST",I),U,2)
"RTN","ORCD",165,0)
 Q
"RTN","ORCD",166,0)
 ;
"RTN","ORCD",167,0)
SETLIST ; -- Show allowable set of codes
"RTN","ORCD",168,0)
 W !,"Choose from:"
"RTN","ORCD",169,0)
SETLST1 N I,X F I=1:1:$L(DOMAIN,";") S X=$P(DOMAIN,";",I) I $L(X) D
"RTN","ORCD",170,0)
 . W !,?5,$P(X,":"),?15,$P(X,":",2)
"RTN","ORCD",171,0)
 Q
"RTN","ORCD",172,0)
 ;
"RTN","ORCD",173,0)
MORE() ; -- show more?
"RTN","ORCD",174,0)
 N X,Y,DIR
"RTN","ORCD",175,0)
 S DIR(0)="EA",DIR("A")="    press <return> to continue or ^ to exit ..."
"RTN","ORCD",176,0)
 D ^DIR
"RTN","ORCD",177,0)
 Q +Y
"RTN","ORCD",178,0)
 ;
"RTN","ORCD",179,0)
FIRST(P,I) ; -- Returns 1 or 0, if current instance I is first of multiple
"RTN","ORCD",180,0)
 Q '$O(ORDIALOG(P,I),-1)
"RTN","ORCD",181,0)
 ;
"RTN","ORCD",182,0)
RECALL(P,I) ; -- Returns first value for prompt P, instance I
"RTN","ORCD",183,0)
 N Y S:'$G(I) I=1 S Y=$G(^TMP("ORECALL",$J,+ORDIALOG,P,I))
"RTN","ORCD",184,0)
 Q Y
"RTN","ORCDADT")
0^93^B1694697
"RTN","ORCDADT",1,0)
ORCDADT ;SLC/MKB-Utility functions for ADT dialogs ;9/13/02  08:31 [9/25/02 4:28pm]
"RTN","ORCDADT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**142,141**;Dec 17, 1997
"RTN","ORCDADT",3,0)
 ;DBIA reference section
"RTN","ORCDADT",4,0)
 ;10015- DIQ
"RTN","ORCDADT",5,0)
 ;
"RTN","ORCDADT",6,0)
ENTS(EVT) ; -- Get list of specialties from EVT (#100.5)
"RTN","ORCDADT",7,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  Q:'$G(EVT)
"RTN","ORCDADT",8,0)
 N I,CNT,IEN,X,Y S (I,CNT)=0
"RTN","ORCDADT",9,0)
 S IEN=$S($P($G(^ORD(100.5,+EVT,0)),U,12):+$P(^(0),U,12),1:+EVT)
"RTN","ORCDADT",10,0)
 F  S I=$O(^ORD(100.5,IEN,"TS",I)) Q:I<1  S X=+$G(^(I,0)) D
"RTN","ORCDADT",11,0)
 . S Y=$$GET1^DIQ(45.7,X_",",.01)
"RTN","ORCDADT",12,0)
 . S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=X_U_Y
"RTN","ORCDADT",13,0)
 . S ORDIALOG(PROMPT,"LIST","B",Y)=X
"RTN","ORCDADT",14,0)
 S:CNT ORDIALOG(PROMPT,"LIST")=CNT_"^1"
"RTN","ORCDADT",15,0)
 Q
"RTN","ORCDADT",16,0)
 ;
"RTN","ORCDADT",17,0)
DEFTS(EVT) ; -- Return default specialty for EVT (#100.5)
"RTN","ORCDADT",18,0)
 N I,Y,IEN S Y=""
"RTN","ORCDADT",19,0)
 ;If child event then get parent event for default:
"RTN","ORCDADT",20,0)
 S IEN=$S($P($G(^ORD(100.5,+$G(EVT),0)),U,12):+$P(^(0),U,12),1:+$G(EVT))
"RTN","ORCDADT",21,0)
 S I=+$O(^ORD(100.5,IEN,"TS","DEF",1,0))
"RTN","ORCDADT",22,0)
 S:I Y=+$G(^ORD(100.5,IEN,"TS",I,0)) ;default selection
"RTN","ORCDADT",23,0)
 Q Y
"RTN","ORCDADT",24,0)
 ;
"RTN","ORCDADT",25,0)
XHELP(PTR) ; -- Xecutable help
"RTN","ORCDADT",26,0)
 I $D(ORDIALOG(PTR,"LIST")),X="?"!$P(ORDIALOG(PTR,"LIST"),U,2) D LIST^ORCD Q
"RTN","ORCDADT",27,0)
 D P^ORCDLGH ; ??-help
"RTN","ORCDADT",28,0)
 Q
"RTN","ORCDFH")
0^7^B49069461
"RTN","ORCDFH",1,0)
ORCDFH ;SLC/MKB-Utility functions for FH dialogs ; 08 May 2002  2:12 PM
"RTN","ORCDFH",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,73,92,141**;Dec 17, 1997
"RTN","ORCDFH",3,0)
EN ; -- entry action
"RTN","ORCDFH",4,0)
 I '$$INPT^ORCD W $C(7),!!,"This patient is not an inpatient!" S ORQUIT=1 H 2 Q
"RTN","ORCDFH",5,0)
 D:'$G(OREVENT) EN^FHWOR8(+ORVP,.ORPARAM) I $G(OREVENT) D
"RTN","ORCDFH",6,0)
 . N X S X=$$LOC^OREVNTX(OREVENT)  Q:X<1
"RTN","ORCDFH",7,0)
 . S X=+$G(^SC(+X,42)) I X,$T(EN1^FHWOR8) D EN1^FHWOR8(X,.ORPARAM)
"RTN","ORCDFH",8,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T" ;for now
"RTN","ORCDFH",9,0)
 Q
"RTN","ORCDFH",10,0)
 ;
"RTN","ORCDFH",11,0)
CKFUTURE ; -- Ck for future diet orders
"RTN","ORCDFH",12,0)
 N DG,ORDT,ORSTRT,ORIFN,ORTX
"RTN","ORCDFH",13,0)
 S DG=$O(^ORD(100.98,"B","DO",0)),ORDT=$$NOW^XLFDT
"RTN","ORCDFH",14,0)
 F  S ORDT=$O(^OR(100,"AW",ORVP,DG,ORDT)) Q:ORDT'>0  S ORIFN=0 D
"RTN","ORCDFH",15,0)
 . F  S ORIFN=$O(^OR(100,"AW",ORVP,DG,ORDT,ORIFN)) Q:ORIFN'>0  I $P($G(^OR(100,+ORIFN,3)),U,3)=8 S ORSTRT(ORDT)=ORIFN ;incl only if still sched
"RTN","ORCDFH",16,0)
 Q:'$D(ORSTRT)  W !,"Future Diet Orders: ",! S ORDT=0
"RTN","ORCDFH",17,0)
 F  S ORDT=$O(ORSTRT(ORDT)) Q:ORDT'>0  D TEXT^ORQ12(.ORTX,+ORSTRT(ORDT)) W !,$$FMTE^XLFDT(ORDT,2)_"    "_$G(ORTX(1))
"RTN","ORCDFH",18,0)
 W !!,"A new order with no expiration date will CANCEL these diets."
"RTN","ORCDFH",19,0)
 Q:$$CONT  S ORQUIT=1
"RTN","ORCDFH",20,0)
 W !!,"Diet Order for this Patient is UNCHANGED -- No order entered!" H 2
"RTN","ORCDFH",21,0)
 Q
"RTN","ORCDFH",22,0)
 ;
"RTN","ORCDFH",23,0)
CONT() ; -- Ok to continue?
"RTN","ORCDFH",24,0)
 N X,Y,DIR
"RTN","ORCDFH",25,0)
 S DIR(0)="YA",DIR("A")="Do you wish to CONTINUE? ",DIR("B")="NO"
"RTN","ORCDFH",26,0)
 D ^DIR
"RTN","ORCDFH",27,0)
 Q +Y
"RTN","ORCDFH",28,0)
 ;
"RTN","ORCDFH",29,0)
EN2 ; -- Reformat ORPARAM() into ORTIME(<tray>,<meal>,1-3)=ext^ext
"RTN","ORCDFH",30,0)
 N X,M,T,I,CNT,OFFSET,TIMES,EARLY,LATE
"RTN","ORCDFH",31,0)
 S TIMES=$G(ORPARAM(1)),OFFSET=0 Q:TIMES=""
"RTN","ORCDFH",32,0)
 F I="EARLY","LATE" S @I=+$O(^ORD(101.43,"S.E/L T",I_" TRAY",0))
"RTN","ORCDFH",33,0)
 F M="B","N","E" F T=EARLY,LATE S CNT=0 D
"RTN","ORCDFH",34,0)
 . F I=1:1:3 S X=$P(TIMES,U,I+OFFSET) S:X CNT=CNT+1,ORTIME(T,M,I)=X_U_X,ORTIME(T,M,"B",X)=X,ORTIME(T,M,"C",X)=I
"RTN","ORCDFH",35,0)
 . S OFFSET=OFFSET+3 S:CNT ORTIME(T,M)=CNT_"^1"
"RTN","ORCDFH",36,0)
 Q
"RTN","ORCDFH",37,0)
 ;
"RTN","ORCDFH",38,0)
FMTIME(X) ; -- Returns FM format of time
"RTN","ORCDFH",39,0)
 N Y,%DT S %DT="TX" D ^%DT
"RTN","ORCDFH",40,0)
 Q "."_$P(Y,".",2)
"RTN","ORCDFH",41,0)
 ;
"RTN","ORCDFH",42,0)
EX ; -- exit action
"RTN","ORCDFH",43,0)
 K ORPARAM,ORTIME,ORNPO,ORTRAIL
"RTN","ORCDFH",44,0)
 Q
"RTN","ORCDFH",45,0)
 ;
"RTN","ORCDFH",46,0)
DIET(DFN) ; -- Returns patient DFN's current diet order
"RTN","ORCDFH",47,0)
 N ADM,X1,FHORD,FHLD,FHOR,X,Y,FHDU,%,A1,D3
"RTN","ORCDFH",48,0)
 S ADM=+$G(^DPT(DFN,.105)),Y="" I $G(DFN),ADM D CUR^FHORD7
"RTN","ORCDFH",49,0)
 Q Y
"RTN","ORCDFH",50,0)
 ;
"RTN","ORCDFH",51,0)
VALID() ; -- Returns 1 or 0, if selected diet modification is valid
"RTN","ORCDFH",52,0)
 N Y,NUM,I,TOTAL,OI
"RTN","ORCDFH",53,0)
 S Y=1,TOTAL=+$G(ORDIALOG(PROMPT,"TOT"))
"RTN","ORCDFH",54,0)
 S OI=$P($G(^ORD(101.43,+ORDIALOG(PROMPT,ORI),0)),U)
"RTN","ORCDFH",55,0)
 I (OI="REGULAR")!(OI="NPO") D  Q Y
"RTN","ORCDFH",56,0)
 . I '$D(ORESET),TOTAL=0 S ORDIALOG(PROMPT,"MAX")=1,MAX=1 Q  ; add first
"RTN","ORCDFH",57,0)
 . I $G(ORESET),TOTAL'>1 S ORDIALOG(PROMPT,"MAX")=1,MAX=1 Q  ; edit first
"RTN","ORCDFH",58,0)
 . S Y=0 W $C(7),!,OI_" may not be ordered with other diets!"
"RTN","ORCDFH",59,0)
 S ORDIALOG(PROMPT,"MAX")=5,MAX=5
"RTN","ORCDFH",60,0)
 I $$DUP^ORCD(PROMPT,ORI) W $C(7),"This diet has already been selected!" Q 0
"RTN","ORCDFH",61,0)
 S NUM=$P($G(^ORD(101.43,+ORDIALOG(PROMPT,ORI),"FH")),U,2) ; precedence #
"RTN","ORCDFH",62,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D  Q:Y'>0
"RTN","ORCDFH",63,0)
 . Q:I=ORI  Q:$P($G(^ORD(101.43,+ORDIALOG(PROMPT,I),"FH")),U,2)'=NUM  ;ok
"RTN","ORCDFH",64,0)
 . S Y=0 W $C(7),!,"This diet is not orderable with those already selected!",!
"RTN","ORCDFH",65,0)
 Q Y
"RTN","ORCDFH",66,0)
 ;
"RTN","ORCDFH",67,0)
CURRENT(DG) ; -- Returns order number of currently active DG order
"RTN","ORCDFH",68,0)
 N TYPE,START,ORIFN
"RTN","ORCDFH",69,0)
 S TYPE=$O(^ORD(100.98,"B",DG,0)),START=$$NOW^XLFDT
"RTN","ORCDFH",70,0)
 F  S START=$O(^OR(100,"AW",ORVP,TYPE,START),-1) Q:START'>0  S ORIFN=$O(^(START,0)) Q:$P($G(^OR(100,ORIFN,3)),U,3)=6  K ORIFN
"RTN","ORCDFH",71,0)
 Q $G(ORIFN)
"RTN","ORCDFH",72,0)
 ;
"RTN","ORCDFH",73,0)
FUTURE(FLD) ; -- Returns 1 or 0, if date from FLD is future
"RTN","ORCDFH",74,0)
 N X,Y,Z,%DT
"RTN","ORCDFH",75,0)
 S X=$$VAL^ORCD(FLD),%DT="TX" D ^%DT S Z=$S($P(Y,".")>DT:1,1:0)
"RTN","ORCDFH",76,0)
 Q Z
"RTN","ORCDFH",77,0)
 ;
"RTN","ORCDFH",78,0)
SCHEDOK(X) ; -- Validates days of the week
"RTN","ORCDFH",79,0)
 N Y,I S X=$$UP^XLFSTR(X),Y=1
"RTN","ORCDFH",80,0)
 F I=1:1:$L(X) I "^M^T^W^R^F^S^X^"'[(U_$E(X,I)_U) S Y=0 Q
"RTN","ORCDFH",81,0)
 Q Y
"RTN","ORCDFH",82,0)
 ;
"RTN","ORCDFH",83,0)
MEALS ; -- Sets meal times into ORDIALOG(PROMPT,"LIST")
"RTN","ORCDFH",84,0)
 K ORDIALOG(PROMPT,"LIST") Q:'$L($G(ORMEAL))  Q:'$G(ORTRAY)
"RTN","ORCDFH",85,0)
 M ORDIALOG(PROMPT,"LIST")=ORTIME(ORTRAY,ORMEAL)
"RTN","ORCDFH",86,0)
 Q
"RTN","ORCDFH",87,0)
 ;
"RTN","ORCDFH",88,0)
NOTIMES(MEAL,TIME) ; -- If no tray times defined, write msg and reask
"RTN","ORCDFH",89,0)
 N I,Y,PAST S Y=0 G:'$L($G(MEAL)) NTQ G:'$G(TIME) NTQ
"RTN","ORCDFH",90,0)
 I '$D(ORTIME(TIME,MEAL)) K DONE W $C(7),!,"There are no "_$P($G(^ORD(101.43,TIME,0)),U)_" times defined for the "_$S(MEAL="B":"breakfast ",MEAL="N":"noon ",MEAL="E":"evening ",1:"")_"meal at this location!",! S Y=1 G NTQ
"RTN","ORCDFH",91,0)
 G:$G(ORDATE)'=DT NTQ S PAST=1,NOW="."_$P($$NOW^XLFDT,".",2)
"RTN","ORCDFH",92,0)
 F I=1:1:3 S X=$G(ORTIME(TIME,MEAL,I)) I X,$$FMTIME($P(X,U))>NOW S PAST=0 Q
"RTN","ORCDFH",93,0)
 I PAST K DONE W $C(7),!,"All "_$P($G(^ORD(101.43,TIME,0)),U)_" times have passed for the "_$S(MEAL="B":"breakfast ",MEAL="N":"noon ",MEAL="E":"evening ",1:"")_"meal at this location!",! S Y=1
"RTN","ORCDFH",94,0)
NTQ Q Y
"RTN","ORCDFH",95,0)
 ;
"RTN","ORCDFH",96,0)
CKTIME ; -- Validate meal time
"RTN","ORCDFH",97,0)
 Q:$G(ORDATE)'=DT  N NOW,X S NOW="."_$P($$NOW^XLFDT,".",2)
"RTN","ORCDFH",98,0)
 S X=ORDIALOG(PROMPT,ORI),X=$$FMTIME(X)
"RTN","ORCDFH",99,0)
 I X'>NOW W $C(7),!,"This time has already passed!",! K DONE Q
"RTN","ORCDFH",100,0)
 Q
"RTN","ORCDFH",101,0)
 ;
"RTN","ORCDFH",102,0)
DELIVERY ; -- Set available delivery/service types by location
"RTN","ORCDFH",103,0)
 I $G(ORNPO) K ORDIALOG(PROMPT,INST) Q
"RTN","ORCDFH",104,0)
 Q:$D(ORDIALOG(PROMPT,"LIST"))
"RTN","ORCDFH",105,0)
 N X,Y,Z,I S X=$G(ORPARAM(3))
"RTN","ORCDFH",106,0)
 S Z="" F I=1:1:$L(X) S Y=$E(X,I) S Z=Z_Y_":"_$S(Y="T":"TRAY",Y="C":"CAFETERIA",Y="D":"DINING ROOM",1:"")_";"
"RTN","ORCDFH",107,0)
 S:$L(Z) $P(ORDIALOG(PROMPT,0),U,2)=Z
"RTN","ORCDFH",108,0)
 S ORDIALOG(PROMPT,"LIST")=$L(X)
"RTN","ORCDFH",109,0)
 Q
"RTN","ORCDFH",110,0)
 ;
"RTN","ORCDFH",111,0)
CANCEL(ORIFN) ; -- Return 1 or 0, if future trays should be cancelled
"RTN","ORCDFH",112,0)
 N DA,Y S DA=$O(^OR(100,+ORIFN,4.5,"ID","CANCEL",0)),Y=0
"RTN","ORCDFH",113,0)
 S:DA Y=+$G(^OR(100,+ORIFN,4.5,+DA,1))
"RTN","ORCDFH",114,0)
 Q Y
"RTN","ORCDFH",115,0)
 ;
"RTN","ORCDFH",116,0)
RESUME(ORDER) ; -- Returns 1 or 0, if tray service should be resumed
"RTN","ORCDFH",117,0)
 N I,X S I=$O(^OR(100,+ORDER,4.5,"ID","RESUME",0)),X=0
"RTN","ORCDFH",118,0)
 I I S X=+$G(^OR(100,+ORDER,4.5,+I,1))
"RTN","ORCDFH",119,0)
 Q X
"RTN","ORCDFH",120,0)
 ;
"RTN","ORCDFH",121,0)
LATETRAY ; -- Order a late tray with diet ORIFN? [from VALID^ORCSIGN]
"RTN","ORCDFH",122,0)
 Q:'$G(ORIFN)  Q:$E($$VALUE^ORX8(ORIFN,"ORDERABLE",1,"E"),1,3)="NPO"
"RTN","ORCDFH",123,0)
 N X,Y,%DT,ORSTRT,ORDATE,ORNP
"RTN","ORCDFH",124,0)
 S X=$O(^OR(100,ORIFN,4.5,"ID","START",0)),X=$G(^OR(100,ORIFN,4.5,+X,1))
"RTN","ORCDFH",125,0)
 Q:X=""  S %DT="TX" D ^%DT Q:Y'>0  Q:$P(Y,".")>DT  ;invalid or future
"RTN","ORCDFH",126,0)
 S ORDATE=$P(Y,"."),ORSTRT=+$E($P(Y,".",2)_"0000",1,4)
"RTN","ORCDFH",127,0)
 S ORNP=$P(^OR(100,ORIFN,0),U,4)
"RTN","ORCDFH",128,0)
LTRAY ; -- enter here w/ORDATE,ORSTRT,ORNP [reinstated diet after dc'ing NPO]
"RTN","ORCDFH",129,0)
 N ORPARAM,ORTIME,I,ORMEAL,ORTRAY
"RTN","ORCDFH",130,0)
 D EN^FHWOR8(+ORVP,.ORPARAM),EN2 Q:'$D(ORPARAM(2))
"RTN","ORCDFH",131,0)
 F I=1,3,5 I $P(ORPARAM(2),U,I)<ORSTRT,ORSTRT<$P(ORPARAM(2),U,I+1)  S ORMEAL=I Q
"RTN","ORCDFH",132,0)
 Q:'$G(ORMEAL)  S ORMEAL=$S(ORMEAL=1:"B",ORMEAL=3:"N",ORMEAL=5:"E",1:U)
"RTN","ORCDFH",133,0)
 Q:ORMEAL="^"  S ORTRAY=+$O(^ORD(101.43,"S.E/L T","LATE TRAY",0))
"RTN","ORCDFH",134,0)
 F I=1:1:3 S Z=$G(ORTIME(ORTRAY,ORMEAL,I)) I Z S Z=$$FMTIME($P(Z,U)),Z=+$E($P(Z,".",2)_"0000",1,4) I Z>ORSTRT S OK=1 Q
"RTN","ORCDFH",135,0)
 Q:'$G(OK)  Q:'$$ORDTRAY(ORMEAL)  ;Else, continue w/order for late tray
"RTN","ORCDFH",136,0)
LT1 N ORIFN,ORDIALOG,ORDG,ORTYPE,ORCHECK,ORQUIT,ORDUZ,ORLOG,SEQ,DA,FIRST
"RTN","ORCDFH",137,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW2",0)) Q:'ORDIALOG
"RTN","ORCDFH",138,0)
 S ORTYPE="D",FIRST=1,ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORCDFH",139,0)
 D GETDLG^ORCD(ORDIALOG) S ORDIALOG($$PTR^ORCD("OR GTX MEAL"),1)=ORMEAL
"RTN","ORCDFH",140,0)
 S ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1)=ORTRAY
"RTN","ORCDFH",141,0)
 S ORDIALOG($$PTR^ORCD("OR GTX START DATE"),1)=ORDATE,ORDIALOG($$PTR^ORCD("OR GTX STOP DATE"),1)=ORDATE
"RTN","ORCDFH",142,0)
 F SEQ=6,7 S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,0)) Q:'DA  D EN^ORCDLG1(DA) Q:$G(ORQUIT)  ; prompt for meal time, bagged meal
"RTN","ORCDFH",143,0)
 I $G(ORQUIT) W $C(7),!!,"No late tray ordered!",! H 2 Q
"RTN","ORCDFH",144,0)
 D EN^ORCSAVE Q:'$G(ORIFN)  S ORES(ORIFN_";1")=""
"RTN","ORCDFH",145,0)
 W !?10,"... order placed.",!
"RTN","ORCDFH",146,0)
 Q
"RTN","ORCDFH",147,0)
 ;
"RTN","ORCDFH",148,0)
ORDTRAY(M) ; -- Want to order tray for meal M?
"RTN","ORCDFH",149,0)
 N X,Y,DIR
"RTN","ORCDFH",150,0)
 S DIR(0)="YA",DIR("A",1)="You have missed the "_$S(M="B":"breakfast",M="N":"noon",M="E":"evening",1:"")_" cut-off.",DIR("A")="Do you wish to order a late tray? ",DIR("B")="YES"
"RTN","ORCDFH",151,0)
 D ^DIR
"RTN","ORCDFH",152,0)
 Q +Y
"RTN","ORCDFH",153,0)
 ;
"RTN","ORCDFH",154,0)
ASKSTOP() ; -- Ck OI's for parameter
"RTN","ORCDFH",155,0)
 N I,OI,Y S OI=+$$PTR^ORCD("OR GTX ORDERABLE ITEM"),Y=0
"RTN","ORCDFH",156,0)
 S I=0 F  S I=$O(ORDIALOG(OI,I)) Q:I'>0  I $P($G(^ORD(101.43,+ORDIALOG(OI,I),"FH")),U,3)="Y" S Y=1 Q
"RTN","ORCDFH",157,0)
 Q Y
"RTN","ORCDFHTF")
0^8^B16786096
"RTN","ORCDFHTF",1,0)
ORCDFHTF ; SLC/MKB - Utility functions for FH Tubefeeding dialog ; 08 May 2002  2:12 PM
"RTN","ORCDFHTF",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,141**;Dec 17, 1997
"RTN","ORCDFHTF",3,0)
EN ; -- entry action
"RTN","ORCDFHTF",4,0)
 I '$$INPT^ORCD W $C(7),!!,"This patient is not an inpatient!" S ORQUIT=1 H 2 Q
"RTN","ORCDFHTF",5,0)
 D:'$G(OREVENT) EN^FHWOR8(+ORVP,.ORPARAM) I $G(OREVENT) D
"RTN","ORCDFHTF",6,0)
 . N X S X=$$LOC^OREVNTX(OREVENT)  Q:X<1
"RTN","ORCDFHTF",7,0)
 . S X=+$G(^SC(+X,42)) I X,$T(EN1^FHWOR8) D EN1^FHWOR8(X,.ORPARAM)
"RTN","ORCDFHTF",8,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T" ; for now
"RTN","ORCDFHTF",9,0)
 ; -- show current TF order
"RTN","ORCDFHTF",10,0)
 N ORTF,ORTX,I S ORTF=$$CURRENT^ORCDFH("TF") Q:ORTF'>0
"RTN","ORCDFHTF",11,0)
 W !!,"An ACTIVE TUBEFEEDING ORDER exists for this patient:",!
"RTN","ORCDFHTF",12,0)
 D TEXT^ORQ12(.ORTX,ORTF,80) F I=1:1:ORTX W !,ORTX(I)
"RTN","ORCDFHTF",13,0)
 W !,"Total Quantity: "_$$TOTALQTY(ORTF)_" cc",!
"RTN","ORCDFHTF",14,0)
 Q
"RTN","ORCDFHTF",15,0)
 ;
"RTN","ORCDFHTF",16,0)
EX ; -- exit action
"RTN","ORCDFHTF",17,0)
 K ORPARAM,ORTIME
"RTN","ORCDFHTF",18,0)
 Q
"RTN","ORCDFHTF",19,0)
 ;
"RTN","ORCDFHTF",20,0)
QUANTITY ; -- Validation code for TF quantity
"RTN","ORCDFHTF",21,0)
 N X,ORQTY,I,TOT S X=ORDIALOG(PROMPT,ORI)
"RTN","ORCDFHTF",22,0)
 S ORQTY=$$VALIDQTY(X) I '$L(ORQTY) K DONE,ORDIALOG(PROMPT,ORI) Q
"RTN","ORCDFHTF",23,0)
 S ORDIALOG(PROMPT,ORI)=ORQTY
"RTN","ORCDFHTF",24,0)
 W "   (Amount: "_$$CC(ORI)_"cc)"
"RTN","ORCDFHTF",25,0)
 S (I,TOT)=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  S TOT=TOT+$$CC(I)
"RTN","ORCDFHTF",26,0)
 I TOT>5000 W $C(7),!!,"WARNING: Total quantity ordered is "_TOT_"cc which exceeds the limit of 5000cc!",!
"RTN","ORCDFHTF",27,0)
 Q
"RTN","ORCDFHTF",28,0)
 ;
"RTN","ORCDFHTF",29,0)
VALIDQTY(X) ; -- Validates quantity X=amt units/freq X times
"RTN","ORCDFHTF",30,0)
 N X1,X2,AMT,N,UNITS,F,D,FREQ,DUR
"RTN","ORCDFHTF",31,0)
 S X=$$UP^XLFSTR(X),X=$$STRIP^XLFSTR(X," ") ; uppercase, no spaces
"RTN","ORCDFHTF",32,0)
 S AMT=+X,X1=$P(X,"/"),X2=$P(X,"/",2) Q:'AMT ""
"RTN","ORCDFHTF",33,0)
 S N=$P(X1,AMT,2),UNITS="" F X="^KCAL^K^","^CC^ML^C^","^OZ^O^","^UNITS^BOTTLES^CANS^PKG^U^","^TBSP^","^GM^GMS^GRAMS^G^" I X[(U_N_U) S UNITS=$P(X,U,2) Q
"RTN","ORCDFHTF",34,0)
 Q:'$L(UNITS) "" S F=$P(X2,"X"),D=$P(X2,"X",2) S:'$L(F) F="QD"
"RTN","ORCDFHTF",35,0)
 S FREQ="" F X="^QD^DAY^","^QH^HOUR^HR^","^BID^","^TID^","^QID^","^Q2H^","^Q3H^","^Q4H^","^Q6H^" I X[(U_F_U) S FREQ=$P(X,U,2) Q
"RTN","ORCDFHTF",36,0)
 Q:'$L(FREQ) "" S DUR="" S:D DUR=+D_$S(D'["F":"HR",1:"")
"RTN","ORCDFHTF",37,0)
 Q AMT_" "_UNITS_"/"_FREQ_$S(DUR:" X "_DUR,1:"")
"RTN","ORCDFHTF",38,0)
 ;
"RTN","ORCDFHTF",39,0)
CC(INST) ; -- Returns #cc ordered for INSTance
"RTN","ORCDFHTF",40,0)
 N X,X1,X2,DUR
"RTN","ORCDFHTF",41,0)
 S X=ORDIALOG($$PTR^ORCD("OR GTX INSTRUCTIONS"),INST)
"RTN","ORCDFHTF",42,0)
 S X1=ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),INST)
"RTN","ORCDFHTF",43,0)
 S X1=+$P($G(^ORD(101.43,+X1,0)),U,2)_"-"_ORDIALOG($$PTR^ORCD("OR GTX STRENGTH FH"),INST),X2=+X_"&"_$E($P(X," ",2))_U_$P($P(X,"/",2)," "),DUR=$P(X," X ",2)
"RTN","ORCDFHTF",44,0)
 I $L(DUR) S DUR=$S(DUR["H":"H",1:"X")_+DUR,X2=X2_U_DUR
"RTN","ORCDFHTF",45,0)
 S X=$$QUAN^FHWOR5R(X1,X2)
"RTN","ORCDFHTF",46,0)
 Q X
"RTN","ORCDFHTF",47,0)
 ;
"RTN","ORCDFHTF",48,0)
QUANHELP ; -- ??-help for Quantity
"RTN","ORCDFHTF",49,0)
 W !!,"Units may be K for Kcals, C for cc's, O For oz. or U for units (e.g. cans)."
"RTN","ORCDFHTF",50,0)
 W !,"Frequency may be DAY, HOUR, QD, QH, BID, TID, QID, Q2H, Q3H, Q4H, or Q6H."
"RTN","ORCDFHTF",51,0)
 W !,"May also input 100CC/HR X 16 for 16 hours.  Valid quantity for powder form"
"RTN","ORCDFHTF",52,0)
 W !,"product can be ""# GRAMS"" as 20 G, GRAMS, or GMS, or as 1 PKG or 1 U, and the"
"RTN","ORCDFHTF",53,0)
 W !,"frequency (e.g. 20 GRAMS/DAY or 1 PKG/TID)."
"RTN","ORCDFHTF",54,0)
 Q
"RTN","ORCDFHTF",55,0)
 ;
"RTN","ORCDFHTF",56,0)
TOTALQTY(ORDER) ; -- Returns total cc's for ORDER
"RTN","ORCDFHTF",57,0)
 N ORDIALOG,ORIT,ORTOTAL,ORI
"RTN","ORCDFHTF",58,0)
 S ORDIALOG=+$P($G(^OR(100,+ORDER,0)),U,5) D GETDLG1^ORCD(ORDIALOG)
"RTN","ORCDFHTF",59,0)
 S ORIT=$$PTR^ORCD("OR GTX ORDERABLE ITEM")
"RTN","ORCDFHTF",60,0)
 D GETORDER^ORCD(+ORDER) S (ORTOTAL,ORI)=0
"RTN","ORCDFHTF",61,0)
 F  S ORI=$O(ORDIALOG(ORIT,ORI)) Q:ORI'>0  S ORTOTAL=ORTOTAL+$$CC(ORI)
"RTN","ORCDFHTF",62,0)
 Q ORTOTAL
"RTN","ORCDFHTF",63,0)
 ;
"RTN","ORCDFHTF",64,0)
CANCEL ; -- Cancel active TF with new diet? [Called from FHW1 Exit Action]
"RTN","ORCDFHTF",65,0)
 N ORTF,ORTX,DIR,X,Y,ORDA,OREASON,ORNATR,I
"RTN","ORCDFHTF",66,0)
 S ORTF=$$CURRENT^ORCDFH("TF") Q:'ORTF  ;no active tubefeeding order
"RTN","ORCDFHTF",67,0)
 Q:$$FUTURE^ORCDFH("EFFECTIVE DATE/TIME")  ;future diet order
"RTN","ORCDFHTF",68,0)
 W !!,"An active tubefeeding order exists for this patient:"
"RTN","ORCDFHTF",69,0)
 D TEXT^ORQ12(.ORTX,+ORTF,80) F I=1:1:ORTX W !,ORTX(I)
"RTN","ORCDFHTF",70,0)
 S DIR(0)="YA",DIR("A")="Do you wish to cancel this order? "
"RTN","ORCDFHTF",71,0)
 S DIR("?")="Enter YES to place a DC order for this tubefeeding"
"RTN","ORCDFHTF",72,0)
 W ! D ^DIR Q:Y'=1  ;quit if not YES
"RTN","ORCDFHTF",73,0)
 S ORDA=$$ACTION^ORCSAVE("DC",ORTF,ORNP),^TMP("ORNEW",$J,ORTF,ORDA)=""
"RTN","ORCDFHTF",74,0)
 S OREASON=+$O(^ORD(100.03,"C","ORREQ",0)),ORNATR=$S(ORNP=DUZ:"E",1:"W")
"RTN","ORCDFHTF",75,0)
 D SET^ORCACT2(+ORTF,ORNATR,OREASON) ;set ^(6) node
"RTN","ORCDFHTF",76,0)
 Q
"RTN","ORCDLG")
0^9^B72292989
"RTN","ORCDLG",1,0)
ORCDLG ;SLC/MKB-Order dialogs ; 08 May 2002  2:12 PM
"RTN","ORCDLG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,7,46,60,79,94,141**;Dec 17, 1997
"RTN","ORCDLG",3,0)
 ;
"RTN","ORCDLG",4,0)
EN(ORDIALOG) ; -- process ORDIALOG
"RTN","ORCDLG",5,0)
 Q:'ORDIALOG  N TITLE,TYPE,MSG K ^TMP("ORWORD",$J)
"RTN","ORCDLG",6,0)
 S TITLE=$G(^ORD(101.41,ORDIALOG,0)),TYPE=$P(TITLE,U,4),MSG=$P(TITLE,U,3),TITLE=$P(TITLE,U,2)
"RTN","ORCDLG",7,0)
 W !!,?(36-($L(TITLE)\2)),"-- "_TITLE_" --"
"RTN","ORCDLG",8,0)
 I $L(MSG) W $C(7),!!,MSG H 2 Q  ;disabled
"RTN","ORCDLG",9,0)
 D SET:TYPE="O",MENU:TYPE="M",ADD:(TYPE="D")!(TYPE="Q")!(TYPE="A")
"RTN","ORCDLG",10,0)
 K ^TMP("ORWORD",$J)
"RTN","ORCDLG",11,0)
 Q
"RTN","ORCDLG",12,0)
 ;
"RTN","ORCDLG",13,0)
SET ; -- prompt for new order set
"RTN","ORCDLG",14,0)
 N ORSET,ORSEQ,ORSITM,ORSTOP,ORPARENT,ORCHLD,ORS0,ORSIFN,ORPIFN,ORLAST,ORSLOG,X,OREV0
"RTN","ORCDLG",15,0)
 S ORSET=+ORDIALOG Q:'ORSET  Q:'$D(^ORD(101.41,ORSET))
"RTN","ORCDLG",16,0)
 I $G(OREVENT) S X=+$P($G(^ORE(100.2,OREVENT,0)),U,2),OREV0=$G(^ORD(100.5,X,0))
"RTN","ORCDLG",17,0)
 X:$D(^ORD(101.41,ORSET,3)) ^(3) ; Entry action
"RTN","ORCDLG",18,0)
 S ORPARENT=$P($G(^ORD(101.41,ORSET,5)),U,6) ;,ORHDR=$P($G(^(5)),U,7)
"RTN","ORCDLG",19,0)
 S ORSLOG=+$E($$NOW^XLFDT,1,12) D:ORPARENT SET^ORCSAVE(+ORDIALOG) ;Parent
"RTN","ORCDLG",20,0)
S1 S ORSEQ=0 F  S ORSEQ=$O(^ORD(101.41,ORSET,10,"B",ORSEQ)) Q:ORSEQ'>0!($G(ORSTOP))  S ORSITM=0 F  S ORSITM=$O(^ORD(101.41,ORSET,10,"B",ORSEQ,ORSITM)) Q:'ORSITM  D  Q:$G(ORSTOP)
"RTN","ORCDLG",21,0)
 . S ORS0=$G(^ORD(101.41,ORSET,10,ORSITM,0)) K ORSIFN
"RTN","ORCDLG",22,0)
 . I $G(OREVENT),$G(ORDSET),+$P(ORS0,U,2)=+$P(OREV0,U,4) Q  ;Evt Ord Dlg
"RTN","ORCDLG",23,0)
 . D:$P(ORS0,U,2) EN(+$P(ORS0,U,2))
"RTN","ORCDLG",24,0)
 . I $G(ORSTOP) Q:$G(DIROUT)  K:$$CONT ORSTOP Q
"RTN","ORCDLG",25,0)
 . I ORPARENT,$G(ORSIFN) S ORCHLD=+$G(ORCHLD)+1,ORCHLD(ORSIFN,0)=ORSIFN,ORLAST=ORSIFN
"RTN","ORCDLG",26,0)
S2 I $G(ORSTOP) D  G SQ ; delete orders
"RTN","ORCDLG",27,0)
 . N DA,DIK
"RTN","ORCDLG",28,0)
 . S DA=0 F  S DA=$O(ORCHLD(DA)) Q:DA'>0  S DIK="^OR(100," D ^DIK
"RTN","ORCDLG",29,0)
 . W !?10,"... orders cancelled.",! H 1
"RTN","ORCDLG",30,0)
 I ORPARENT,$G(ORCHLD) M ^OR(100,ORPIFN,2)=ORCHLD S ^OR(100,ORPIFN,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCDLG",31,0)
 ;W !?10,"... orders placed.",! H 1
"RTN","ORCDLG",32,0)
SQ X:$D(^ORD(101.41,ORSET,4)) ^(4) ; Exit action
"RTN","ORCDLG",33,0)
 Q
"RTN","ORCDLG",34,0)
 ;
"RTN","ORCDLG",35,0)
MENU ; -- prompt for menu
"RTN","ORCDLG",36,0)
 N ORI,ORY,XQORM
"RTN","ORCDLG",37,0)
 S ORI=$$LOCK^ORDD41(ORDIALOG) I 'ORI W !!,$P(ORI,U,2) H 2 Q
"RTN","ORCDLG",38,0)
 X:$D(^ORD(101.41,ORDIALOG,3)) ^(3) G:$G(ORQUIT) MNQ ;Entry action
"RTN","ORCDLG",39,0)
 S XQORM("W")="W $S($P(X,U,5)=""H"":IOUON,1:"""")_$P(X,U,3)_IOUOFF"
"RTN","ORCDLG",40,0)
 S ORI=$G(^ORD(101.41,ORDIALOG,5)) S:$P(ORI,U,2) XQORM("M")=$P(ORI,U,2)
"RTN","ORCDLG",41,0)
 S XQORM=ORDIALOG_";ORD(101.41,",XQORM(0)="AD" D EN^XQORM
"RTN","ORCDLG",42,0)
 I Y'>0 S:$G(ORSET)&(X["^") ORSTOP=1 G MNQ
"RTN","ORCDLG",43,0)
 M ORY=Y S ORI=0 F  S ORI=$O(ORY(ORI)) Q:ORI'>0  D EN(+$P(ORY(ORI),U,2))
"RTN","ORCDLG",44,0)
MNQ X:$D(^ORD(101.41,ORDIALOG,4)) ^(4) ;Exit action
"RTN","ORCDLG",45,0)
 D UNLOCK^ORDD41(ORDIALOG)
"RTN","ORCDLG",46,0)
 Q
"RTN","ORCDLG",47,0)
 ;
"RTN","ORCDLG",48,0)
ORDER(ORDIALOG) ; -- Execute ORDIALOG, return ORIFN or ^ if unsuccessful
"RTN","ORCDLG",49,0)
 K ^TMP("ORWORD",$J) Q:'$G(ORDIALOG) "^"
"RTN","ORCDLG",50,0)
 N TITLE,TYPE,MSG,NODE0,FIRST,ORDG,ORQUIT,VERIFY,ACTION,ASK,AUTO,ORIFN,ORTYPE,ORCHECK,ORNMSP,ORDUZ,ORLOG
"RTN","ORCDLG",51,0)
 S TITLE=$G(^ORD(101.41,ORDIALOG,0)),TYPE=$P(TITLE,U,4),MSG=$P(TITLE,U,3),TITLE=$P(TITLE,U,2)
"RTN","ORCDLG",52,0)
 W !!,?(36-($L(TITLE)\2)),"-- "_TITLE_" --"
"RTN","ORCDLG",53,0)
 I $L(MSG) W $C(7),!!,MSG H 2 Q "^" ;disabled
"RTN","ORCDLG",54,0)
 I TYPE'="D",TYPE'="Q" W $C(7),!!,"Invalid order dialog!" H 2 Q "^"
"RTN","ORCDLG",55,0)
 D ADD0 S:'$G(ORIFN) ORIFN="^"
"RTN","ORCDLG",56,0)
 K ^TMP("ORWORD",$J)
"RTN","ORCDLG",57,0)
 Q ORIFN
"RTN","ORCDLG",58,0)
 ;
"RTN","ORCDLG",59,0)
ADD ; -- prompt for new order
"RTN","ORCDLG",60,0)
 ;    Requires:  ORDIALOG = Order Dialog ifn
"RTN","ORCDLG",61,0)
 ;               ORNP     = Ordering Provider (ifn in #200)
"RTN","ORCDLG",62,0)
 ;               ORVP     = Patient (vptr to #2)
"RTN","ORCDLG",63,0)
 ;    Optional:  ORL      = Patient Location (vptr to #44)
"RTN","ORCDLG",64,0)
 ;               ORTS     = Treating Specialty (ifn in #45.7)
"RTN","ORCDLG",65,0)
 ;               ORSET    = Order Set (ifn in #101.41, from SET)
"RTN","ORCDLG",66,0)
 ;    $$ORDER enters at ADD0 to be able to return ORIFN
"RTN","ORCDLG",67,0)
 ;
"RTN","ORCDLG",68,0)
 N NODE0,FIRST,ORDG,ORQUIT,VERIFY,ACTION,ASK,AUTO,ORIFN,ORTYPE,ORCHECK,ORNMSP,ORDUZ,ORLOG
"RTN","ORCDLG",69,0)
ADD0 S VALMBCK="R",FIRST=1 Q:'ORDIALOG
"RTN","ORCDLG",70,0)
 S NODE0=$G(^ORD(101.41,ORDIALOG,0)),AUTO=$P($G(^(5)),U,8)
"RTN","ORCDLG",71,0)
 S ORTYPE=$P(NODE0,U,4),ORDG=+$P(NODE0,U,5),ORDUZ=DUZ
"RTN","ORCDLG",72,0)
 S ORLOG=+$$NOW,VERIFY=$P(NODE0,U,8),ASK=$P(NODE0,U,9)
"RTN","ORCDLG",73,0)
 D @("GET"_$S(ORTYPE="Q":"Q",1:"")_"DLG^ORCD(+ORDIALOG)")
"RTN","ORCDLG",74,0)
 I ORDIALOG'>0 W $C(7),!!,"Invalid dialog - cannot place order!" H 1 Q
"RTN","ORCDLG",75,0)
 S ORNMSP=$P($G(^ORD(101.41,ORDIALOG,0)),U,7),ORNMSP=$$NMSP^ORCD(ORNMSP)
"RTN","ORCDLG",76,0)
 I '$$ACTIVE W $C(7),!!,"Inactive orderable item(s) - cannot place order!" H 1 Q
"RTN","ORCDLG",77,0)
 X:$D(^ORD(101.41,+ORDIALOG,3)) ^(3) G:$G(ORQUIT) ADDQ ; entry action
"RTN","ORCDLG",78,0)
 G:ORTYPE="A" ADDQ ; action only
"RTN","ORCDLG",79,0)
 D DISPLAY^ORCHECK ; pkg order check
"RTN","ORCDLG",80,0)
ADD1 D DIALOG ; Loop thru prompts or components
"RTN","ORCDLG",81,0)
 I $G(ORQUIT) S:$G(ORSET) ORSTOP=1 G:$G(ORSTOP)!$G(DIROUT)!FIRST ADDQ K ORQUIT
"RTN","ORCDLG",82,0)
 D ACCEPT^ORCHECK() S ACTION="P"
"RTN","ORCDLG",83,0)
 I $G(OREVENT),$G(^ORE(100.2,+OREVENT,1)) D  ;event occurred
"RTN","ORCDLG",84,0)
 . W !!,"This release event has occurred since you started writing delayed orders."
"RTN","ORCDLG",85,0)
 . W !,"The orders that were signed have now been released; this and any other"
"RTN","ORCDLG",86,0)
 . W !,"unsigned orders will be released immediately upon signature.  The Orders"
"RTN","ORCDLG",87,0)
 . W !,"tab will be refreshed in the Active Orders view when finished."
"RTN","ORCDLG",88,0)
 . K OREVENT S $P(^TMP("OR",$J,"ORDERS",0),U,3,4)="^1" ;default view
"RTN","ORCDLG",89,0)
 . N X W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDLG",90,0)
 I VERIFY!$G(ORCHECK) D DISPLAY S ACTION=$$OK G:ACTION="^" ADDQ
"RTN","ORCDLG",91,0)
 I ACTION="E" S FIRST=0 K ORCHECK G ADD1
"RTN","ORCDLG",92,0)
 I ACTION="C" W !?10,"... order cancelled.",! ;G ADDQ
"RTN","ORCDLG",93,0)
 I ACTION="P" D EN^ORCSAVE D
"RTN","ORCDLG",94,0)
 . I '$G(ORIFN) W !?10,"... ERROR - unable to place order.",! H 1 Q
"RTN","ORCDLG",95,0)
 . S ^TMP("ORNEW",$J,ORIFN,1)="" S:$G(ORSET) ORSIFN=ORIFN
"RTN","ORCDLG",96,0)
 . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^(ORDIALOG)=ORDIALOG M:$D(^TMP("ORWORD",$J)) ^TMP("ORECALL",$J,ORDIALOG)=^TMP("ORWORD",$J) ;1st values
"RTN","ORCDLG",97,0)
 . W !?10,"... order placed.",!
"RTN","ORCDLG",98,0)
 I ASK,$$ANOTHER D KVALUES S FIRST=1,ORLOG=+$$NOW G ADD1
"RTN","ORCDLG",99,0)
ADDQ X:$D(^ORD(101.41,+ORDIALOG,4)) ^(4) ; exit action
"RTN","ORCDLG",100,0)
 Q
"RTN","ORCDLG",101,0)
 ;
"RTN","ORCDLG",102,0)
DIALOG ; -- loop through prompts in dialog
"RTN","ORCDLG",103,0)
 N SEQ,DA K ORQUIT
"RTN","ORCDLG",104,0)
 I $G(ORTYPE)'="A" S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0!($G(ORQUIT))  S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D  Q:$G(ORQUIT)
"RTN","ORCDLG",105,0)
 . Q:$P(^ORD(101.41,+ORDIALOG,10,DA,0),U,11)  ; child
"RTN","ORCDLG",106,0)
 . D EN^ORCDLG1(DA)
"RTN","ORCDLG",107,0)
 Q
"RTN","ORCDLG",108,0)
 ;
"RTN","ORCDLG",109,0)
ANOTHER() ; -- Add another order?
"RTN","ORCDLG",110,0)
 I ASK>1 Q 1 ; Don't ask, go right to another order
"RTN","ORCDLG",111,0)
 N X,Y,DIR
"RTN","ORCDLG",112,0)
 S DIR("A")="Add another "_$P(^ORD(101.41,+ORDIALOG,0),U,2)_" order? "
"RTN","ORCDLG",113,0)
 S DIR(0)="YA",DIR("B")="NO" D ^DIR
"RTN","ORCDLG",114,0)
 Q +Y
"RTN","ORCDLG",115,0)
 ;
"RTN","ORCDLG",116,0)
CONT() ; -- continue w/set?
"RTN","ORCDLG",117,0)
 N X,Y,DIR
"RTN","ORCDLG",118,0)
 S DIR(0)="YA",DIR("A")="Do you want to continue with this order set? "
"RTN","ORCDLG",119,0)
 S DIR("?")="Enter NO if you wish to cancel the entire order set; YES will cancel only this one order."
"RTN","ORCDLG",120,0)
 S DIR("B")="YES" D ^DIR
"RTN","ORCDLG",121,0)
 Q +Y
"RTN","ORCDLG",122,0)
 ;
"RTN","ORCDLG",123,0)
DISPLAY ; -- Display new order on screen
"RTN","ORCDLG",124,0)
 N SEQ,DA,X,PROMPT,MULT,I,TITLE
"RTN","ORCDLG",125,0)
 W !!,$$REPEAT^XLFSTR("-",79)
"RTN","ORCDLG",126,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORCDLG",127,0)
 . S X=$G(^ORD(101.41,+ORDIALOG,10,DA,0)) Q:$P(X,U,11)  ;child
"RTN","ORCDLG",128,0)
 . S PROMPT=$P(X,U,2),MULT=$P(X,U,7) Q:$P(X,U,9)["*"  ;hide
"RTN","ORCDLG",129,0)
 . Q:'PROMPT  S I=$O(ORDIALOG(PROMPT,0)) Q:'I  ; no values
"RTN","ORCDLG",130,0)
 . S TITLE=$S($L($G(ORDIALOG(PROMPT,"TTL"))):ORDIALOG(PROMPT,"TTL"),1:ORDIALOG(PROMPT,"A"))
"RTN","ORCDLG",131,0)
 . W !,$J(TITLE,30)
"RTN","ORCDLG",132,0)
 . I $E(ORDIALOG(PROMPT,0))="W" W $E($G(^TMP("ORWORD",$J,PROMPT,I,1,0)),1,40)_$S($L($G(^(0)))>40:" ...",$O(^TMP("ORWORD",$J,PROMPT,I,1)):" ...",1:"") Q
"RTN","ORCDLG",133,0)
 . W $$ITEM(PROMPT,I) Q:'MULT  Q:'$O(ORDIALOG(PROMPT,I))  ; done
"RTN","ORCDLG",134,0)
 . F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  W !?30,$$ITEM(PROMPT,I)
"RTN","ORCDLG",135,0)
 W !,$$REPEAT^XLFSTR("-",79),!
"RTN","ORCDLG",136,0)
 I $G(ORCHECK) W "Order Checks:" D LIST^ORCHECK("NEW")
"RTN","ORCDLG",137,0)
 Q
"RTN","ORCDLG",138,0)
 ;
"RTN","ORCDLG",139,0)
ITEM(P,I) ; -- Display each item in dialog
"RTN","ORCDLG",140,0)
 N ITEM,SEQ,DA,IFN,X,ORDTXT
"RTN","ORCDLG",141,0)
 S ITEM=$$EXT^ORCD(P,I) I $E(ORDIALOG(P,0))="R",$G(ORTYPE)'="Z",'$G(OREVENT) S X=ORDIALOG(P,I) S:'X ITEM=ITEM_$$DATE(X)
"RTN","ORCDLG",142,0)
 I $D(^ORD(101.41,+ORDIALOG,10,"DAD",P)) S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",P,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D
"RTN","ORCDLG",143,0)
 . S IFN=$P(^ORD(101.41,+ORDIALOG,10,DA,0),U,2),ORDTXT=$G(^(2)) Q:$P(^(0),U,9)["*"
"RTN","ORCDLG",144,0)
 . Q:'$D(ORDIALOG(IFN,I))  Q:$E(ORDIALOG(IFN,0))="W"
"RTN","ORCDLG",145,0)
 . S X=$$EXT^ORCD(IFN,I) Q:'$L(X)
"RTN","ORCDLG",146,0)
 . S:$L($P(ORDTXT,U,4)) X=$$GETXT^ORCSAVE1($P(ORDTXT,U,4))_" "_X
"RTN","ORCDLG",147,0)
 . S:$L($P(ORDTXT,U,5)) X=X_" "_$$GETXT^ORCSAVE1($P(ORDTXT,U,5))
"RTN","ORCDLG",148,0)
 . S ITEM=ITEM_" "_X
"RTN","ORCDLG",149,0)
 Q ITEM
"RTN","ORCDLG",150,0)
 ;
"RTN","ORCDLG",151,0)
DATE(X) ; -- Returns resolved date
"RTN","ORCDLG",152,0)
 N Y,%DT S %DT="T"
"RTN","ORCDLG",153,0)
 D AM^ORCSAVE2:X="AM",NEXT^ORCSAVE2:X="NEXT"
"RTN","ORCDLG",154,0)
 D ADMIN^ORCSAVE2("NEXT"):X="NEXTA",ADMIN^ORCSAVE2("CLOSEST"):X="CLOSEST"
"RTN","ORCDLG",155,0)
 D ^%DT S:Y'>0 Y="" I Y>0 S Y=" ("_$$FMTE^XLFDT(Y,2)_")"
"RTN","ORCDLG",156,0)
 Q Y
"RTN","ORCDLG",157,0)
 ;
"RTN","ORCDLG",158,0)
OK() ; -- Ready to save?
"RTN","ORCDLG",159,0)
 N X,Y,DIR
"RTN","ORCDLG",160,0)
 S DIR(0)="SA^P:PLACE;E:EDIT;C:CANCEL;",DIR("A")="(P)lace, (E)dit, or (C)ancel this order? ",DIR("B")="PLACE"
"RTN","ORCDLG",161,0)
 S DIR("?")="Enter P to place this order, or E to change any of the displayed values; enter C to quit without placing this order"
"RTN","ORCDLG",162,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCDLG",163,0)
 Q Y
"RTN","ORCDLG",164,0)
 ;
"RTN","ORCDLG",165,0)
KVALUES ; -- kill ORDIALOG("ORDERABLE ITEM",#) value nodes
"RTN","ORCDLG",166,0)
 N PTR,INST K ORIFN,ORCHECK,^TMP("ORWORD",$J)
"RTN","ORCDLG",167,0)
 S PTR=0 F  S PTR=$O(ORDIALOG(PTR)) Q:PTR'>0  D
"RTN","ORCDLG",168,0)
 . K ORDIALOG(PTR,"LIST") S INST=0
"RTN","ORCDLG",169,0)
 . F  S INST=$O(ORDIALOG(PTR,INST)) Q:INST'>0  K ORDIALOG(PTR,INST)
"RTN","ORCDLG",170,0)
 Q
"RTN","ORCDLG",171,0)
 ;
"RTN","ORCDLG",172,0)
NOW() ; -- Returns current Date Ordered for new order
"RTN","ORCDLG",173,0)
 N Y I $G(ORSLOG) S Y=ORSLOG ; timestamp for order set
"RTN","ORCDLG",174,0)
 E  S Y=+$E($$NOW^XLFDT,1,12)
"RTN","ORCDLG",175,0)
 Q Y
"RTN","ORCDLG",176,0)
 ;
"RTN","ORCDLG",177,0)
ACTIVE()        ; -- Returns 1 or 0, if orderable item(s) are active
"RTN","ORCDLG",178,0)
 ;       [Uses ORDIALOG(),ORDG,ORNMSP]
"RTN","ORCDLG",179,0)
 N OI,NOW,I,ITM,X,Y
"RTN","ORCDLG",180,0)
 S OI=+$$PTR^ORCD("OR GTX ORDERABLE ITEM"),NOW=$$NOW^XLFDT,Y=1
"RTN","ORCDLG",181,0)
 S I=0 F  S I=+$O(ORDIALOG(OI,I)) Q:I'>0  D  Q:'Y
"RTN","ORCDLG",182,0)
 . S ITM=+$G(ORDIALOG(OI,I)) Q:ITM'>0
"RTN","ORCDLG",183,0)
 . S X=$G(^ORD(101.43,ITM,.1)) I X,X<NOW S Y=0 Q  ;inactive
"RTN","ORCDLG",184,0)
 I 'Y,ORNMSP?1"PS".E D  ;ck for new OI, if PS
"RTN","ORCDLG",185,0)
 . Q:$P($G(^ORD(100.98,+$G(ORDG),0)),U,3)="IV RX"  ;skip fluids
"RTN","ORCDLG",186,0)
 . Q:$G(ORCAT)="I"&$G(ORENEW)  ;skip Inpt renewals
"RTN","ORCDLG",187,0)
 . N DD,J,DRUG,PSOI S DD=+$$PTR^ORCD("OR GTX DISPENSE DRUG")
"RTN","ORCDLG",188,0)
 . S J=+$O(ORDIALOG(DD,0)),DRUG=+$G(ORDIALOG(DD,J)) ;first one
"RTN","ORCDLG",189,0)
 . S PSOI=+$P($G(^ORD(101.43,+$G(ORDIALOG(OI,1)),0)),U,2)
"RTN","ORCDLG",190,0)
 . S X=$$ITEM^PSSUTIL1(PSOI,DRUG) Q:X'>0
"RTN","ORCDLG",191,0)
 . S ITM=+$O(^ORD(101.43,"ID",+$P(X,U,2)_";99PSP",0)) Q:ITM'>0
"RTN","ORCDLG",192,0)
 . S X=$G(^ORD(101.43,ITM,.1)) I X,X<NOW Q  ;just checking
"RTN","ORCDLG",193,0)
 . S ORDIALOG(OI,1)=ITM,Y=1
"RTN","ORCDLG",194,0)
 Q Y
"RTN","ORCDLR1")
0^10^B80731782
"RTN","ORCDLR1",1,0)
ORCDLR1 ;SLC/MKB,JFR - Utility fcns for LR dialogs cont ;8/29/02  14:45
"RTN","ORCDLR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,29,49,61,79,141**;Dec 17, 1997
"RTN","ORCDLR1",3,0)
 ;
"RTN","ORCDLR1",4,0)
EN ; -- Entry Action for LR OTHER LAB TESTS order dialog
"RTN","ORCDLR1",5,0)
 D GETIMES S ORMAX=0
"RTN","ORCDLR1",6,0)
 S:$G(ORL) ORMAX=$$GET^XPAR("LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORCDLR1",7,0)
 Q
"RTN","ORCDLR1",8,0)
 ;
"RTN","ORCDLR1",9,0)
EX ; -- Exit Action for order dialog
"RTN","ORCDLR1",10,0)
 K ORTIME,ORCOLLCT,ORMAX,ORTEST,ORDIV,ORIMTIME,ORSMAX,ORSTMS,ORSCH,ORCAT
"RTN","ORCDLR1",11,0)
 I $G(ORXL) S ORL=ORXL K ORXL
"RTN","ORCDLR1",12,0)
 Q
"RTN","ORCDLR1",13,0)
 ;
"RTN","ORCDLR1",14,0)
GETIMES ; -- Set list of routine collections into ORTIME($H)=FMtime
"RTN","ORCDLR1",15,0)
 N I,X,CNT,ON K ORTIME
"RTN","ORCDLR1",16,0)
 I '$D(VALIDT) D
"RTN","ORCDLR1",17,0)
 . S I=$$PTR^ORCD("OR GTX START DATE/TIME"),X=$P(ORDIALOG(I,0),U,2)
"RTN","ORCDLR1",18,0)
 . S X="T::ETX",$P(ORDIALOG(I,0),U,2)=X ; reset lower bound
"RTN","ORCDLR1",19,0)
 S ORDIV=+$P($G(^SC(+$G(ORL),0)),U,4) S:'ORDIV ORDIV=+$G(DUZ(2))
"RTN","ORCDLR1",20,0)
 I $G(OREVENT) S ORDIV=+$$DIV^OREVNTX(OREVENT),ORXL=$G(ORL),ORL=$$LOC^OREVNTX(OREVENT)
"RTN","ORCDLR1",21,0)
 D GETLST^XPAR(.ORTIME,ORDIV_";DIC(4,","LR PHLEBOTOMY COLLECTION","N")
"RTN","ORCDLR1",22,0)
 S (I,CNT)=0 F  S I=$O(ORTIME(I)) Q:I'>0  S CNT=CNT+1,X=$P(ORTIME(I),U),ORTIME(I)=X,ORTIME("B",+("."_X))=I ; ORTIME($H time)=0000 FM time, ORTIME("B",.0000)=$H time of cut-off
"RTN","ORCDLR1",23,0)
 S ORTIME=CNT,I=$O(ORTIME(0)) S:I ORTIME("AM")=ORTIME(I) ; 1st collection
"RTN","ORCDLR1",24,0)
 S I=$O(ORTIME($P($H,",",2))) S:I ORTIME("NEXT")=ORTIME(I) ;NEXT coll
"RTN","ORCDLR1",25,0)
 S ON=$$ON^LR7OV4(ORDIV) D:ON SHOW^LR7OV4(ORDIV,.ORIMTIME)
"RTN","ORCDLR1",26,0)
 I 'ON,'$D(VALIDT) S I=$$PTR^ORCD("OR GTX COLLECTION TYPE"),X=$P(ORDIALOG(I,0),U,2),$P(ORDIALOG(I,0),U,2)=$P(X,";",1,3) ;Remove Immed if '$$ON
"RTN","ORCDLR1",27,0)
 Q
"RTN","ORCDLR1",28,0)
 ;
"RTN","ORCDLR1",29,0)
DEFTIME() ; -- Returns default collection time
"RTN","ORCDLR1",30,0)
 I $L($G(LRFDATE)) S EDITONLY=1 Q LRFDATE
"RTN","ORCDLR1",31,0)
 N Y S Y="" I $D(^TMP("ORECALL",$J,ORDIALOG,PROMPT)) D  Q:$L(Y) Y
"RTN","ORCDLR1",32,0)
 . S Y=$$RECALL^ORCD(PROMPT)
"RTN","ORCDLR1",33,0)
 . I '$S(ORCOLLCT="LC":$$LABCOLL(Y),ORCOLLCT="I":$$IMMCOLL(Y),1:$$CKDATE(Y)) S Y="" Q
"RTN","ORCDLR1",34,0)
 . S EDITONLY=1
"RTN","ORCDLR1",35,0)
 ;I $G(ORTYPE)="Q" Q $S(ORCOLLCT="LC":"AM",1:"")
"RTN","ORCDLR1",36,0)
 D LIST^ORCD:ORCOLLCT="LC"&$G(ORDIALOG(PROMPT,"LIST"))
"RTN","ORCDLR1",37,0)
 D IMMTIMES:ORCOLLCT="I"&$O(ORIMTIME(0))
"RTN","ORCDLR1",38,0)
 Q $S(ORCOLLCT="LC":"NEXT",ORCOLLCT="I":$$IMMDEF,ORCOLLCT="WC":"NOW",1:"TODAY")
"RTN","ORCDLR1",39,0)
 ;
"RTN","ORCDLR1",40,0)
IMMDEF() ; -- Returns immediate collect default
"RTN","ORCDLR1",41,0)
 N X,Y S X=$$DEFTIME^LR7OV4(ORDIV)
"RTN","ORCDLR1",42,0)
 S Y=$S($P(X,U,3):"NOW+"_$P(X,U,3)_"'",1:$P(X,U))
"RTN","ORCDLR1",43,0)
 Q Y
"RTN","ORCDLR1",44,0)
 ;
"RTN","ORCDLR1",45,0)
COLLTIME ; -- Get list of common collection times
"RTN","ORCDLR1",46,0)
 I ORCOLLCT="I" D:'$D(ORIMTIME) SHOW^LR7OV4(ORDIV,.ORIMTIME)
"RTN","ORCDLR1",47,0)
 I ORCOLLCT'="LC" K ORDIALOG(PROMPT,"LIST") Q
"RTN","ORCDLR1",48,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  Q:'$O(ORTIME(0))
"RTN","ORCDLR1",49,0)
 N I,X,CNT,NEXT,DAY,NOW S NOW=$P($H,",",2)
"RTN","ORCDLR1",50,0)
 S NEXT=$O(ORTIME(NOW)),DAY=$$NEXTCOLL($S(NEXT:"T",1:"T+1")) Q:DAY=""
"RTN","ORCDLR1",51,0)
 S:'NEXT!(DAY["+") NEXT=$O(ORTIME(0))
"RTN","ORCDLR1",52,0)
 S CNT=1,ORDIALOG(PROMPT,"LIST",1)="NEXT^NEXT Lab collection ("_DAY_"@"_$$TIME(ORTIME(NEXT))_")",ORDIALOG(PROMPT,"LIST","B","NEXT LAB COLLECTION")="NEXT"
"RTN","ORCDLR1",53,0)
 S ORDIALOG(PROMPT,"LIST","B","AM LAB COLLECTION")="AM"
"RTN","ORCDLR1",54,0)
 G:ORTIME'>1 CTMQ ; only NEXT
"RTN","ORCDLR1",55,0)
 S I=NEXT F  S I=$O(ORTIME(I)) Q:I'>0  S X=DAY_"@"_$$TIME(ORTIME(I)),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=X_"^Routine Lab collection ("_X_")",ORDIALOG(PROMPT,"LIST","B","ROUTINE LAB COLLECTION")=X
"RTN","ORCDLR1",56,0)
 I NEXT>$O(ORTIME(0)) D  ;add morning times before NEXT to T+1
"RTN","ORCDLR1",57,0)
 . S DAY="T+"_(+$P(DAY,"+",2)+1),DAY=$$NEXTCOLL(DAY),I=$O(ORTIME(0))
"RTN","ORCDLR1",58,0)
 . S X=DAY_"@"_$$TIME(ORTIME("AM")),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)="AM^AM Lab collection ("_X_")"
"RTN","ORCDLR1",59,0)
 . F  S I=$O(ORTIME(I)) Q:(I'>0)!(I'<NEXT)  S X=DAY_"@"_$$TIME(ORTIME(I)),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=X_"^Routine Lab collection ("_X_")",ORDIALOG(PROMPT,"LIST","B","ROUTINE LAB COLLECTION")=X
"RTN","ORCDLR1",60,0)
CTMQ S ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDLR1",61,0)
 Q
"RTN","ORCDLR1",62,0)
 ;
"RTN","ORCDLR1",63,0)
NEXTCOLL(START) ; -- Returns the next day that routine lab collects are done
"RTN","ORCDLR1",64,0)
 N X,Y,%DT,OFFSET,ORDAYS,PARAM I '$O(ORTIME(0)) Q "" ; no Lab collect
"RTN","ORCDLR1",65,0)
 S:'$D(START) START="T" S OFFSET=+$P(START,"+",2),START=$P(START,"+")
"RTN","ORCDLR1",66,0)
 F ORDAYS=1:1:7 D  Q:$D(X)  S OFFSET=OFFSET+1 ; ck up to a week
"RTN","ORCDLR1",67,0)
 . S %DT="X",X=START_$S(OFFSET:"+"_OFFSET,1:"")
"RTN","ORCDLR1",68,0)
 . D ^%DT I Y'>0 K X Q
"RTN","ORCDLR1",69,0)
 . I $G(ORL),$$GET^XPAR("ALL^LOC.`"_+ORL,"LR EXCEPTED LOCATIONS") Q
"RTN","ORCDLR1",70,0)
 . S PARAM="LR COLLECT "_$$UP^XLFSTR($$DOW^XLFDT(Y))
"RTN","ORCDLR1",71,0)
 . I '$$GET^XPAR("ALL",PARAM) K X Q
"RTN","ORCDLR1",72,0)
 . I '$$GET^XPAR("ALL","LR IGNORE HOLIDAYS"),$D(^HOLIDAY($P(Y,"."))) K X Q
"RTN","ORCDLR1",73,0)
 S Y=$S($D(X):X,1:"")
"RTN","ORCDLR1",74,0)
 Q Y
"RTN","ORCDLR1",75,0)
 ;
"RTN","ORCDLR1",76,0)
TIME(X) ; -- Returns 00:00AM from 0000 FileMan time
"RTN","ORCDLR1",77,0)
 N HOUR,MIN,XM,Y
"RTN","ORCDLR1",78,0)
 S HOUR=$E(X,1,2),MIN=$E(X,3,4),XM="AM"
"RTN","ORCDLR1",79,0)
 I HOUR'<12 S XM="PM" S:HOUR>12 HOUR=HOUR-12
"RTN","ORCDLR1",80,0)
 S:$E(HOUR)="0" HOUR=$E(HOUR,2) ; strip leading 0
"RTN","ORCDLR1",81,0)
 S Y=HOUR_":"_MIN_XM
"RTN","ORCDLR1",82,0)
 Q Y
"RTN","ORCDLR1",83,0)
 ;
"RTN","ORCDLR1",84,0)
LISTCOLL ; -- Lists the routine collection times for ??-help
"RTN","ORCDLR1",85,0)
 I '$O(ORTIME(0)) W !,"No routine lab collection times defined." Q
"RTN","ORCDLR1",86,0)
 N I,X S I=0,X=""
"RTN","ORCDLR1",87,0)
 F  S I=$O(ORTIME(I)) Q:I'>0  S X=X_$S($L(X):", ",1:"")_$$TIME(ORTIME(I))
"RTN","ORCDLR1",88,0)
 W !,"Routine collection times are "_X_"."
"RTN","ORCDLR1",89,0)
 W !,"You may also enter AM for the morning collection, or NEXT for the next",!,"routine collection time."
"RTN","ORCDLR1",90,0)
 Q
"RTN","ORCDLR1",91,0)
 ;
"RTN","ORCDLR1",92,0)
IMMTIMES ; -- Show the valid date/times for immediate collect
"RTN","ORCDLR1",93,0)
 N I S I=0
"RTN","ORCDLR1",94,0)
 F  S I=$O(ORIMTIME(I)) Q:I'>0  W !,ORIMTIME(I)
"RTN","ORCDLR1",95,0)
 Q
"RTN","ORCDLR1",96,0)
 ;
"RTN","ORCDLR1",97,0)
CKDATE(X) ; -- Valid coll time for SP or WC?
"RTN","ORCDLR1",98,0)
 S X=$$UP^XLFSTR(X) I ("NOW"[X)!("TODAY"[X) Q 1
"RTN","ORCDLR1",99,0)
 I X?1"T+"1.3N,+$P(X,"+",2)'>370 Q 1
"RTN","ORCDLR1",100,0)
 N Y,%DT,D
"RTN","ORCDLR1",101,0)
 I X'?7N.1".".6N S %DT="TX" D ^%DT S:Y>0 X=Y I Y'>0 Q "0^Invalid date/time"
"RTN","ORCDLR1",102,0)
 S D=$P(X,".") I D<DT Q "0^Cannot order for past days"
"RTN","ORCDLR1",103,0)
 I $P(X,".",2),X<$$NOW^XLFDT,'$G(OREVENT),$G(ORTYPE)'="Z" Q "0^The requested collection time has passed"
"RTN","ORCDLR1",104,0)
 I D>$$FMADD^XLFDT(DT,370) Q "0^Cannot order more than 370 days in advance"
"RTN","ORCDLR1",105,0)
 Q 1
"RTN","ORCDLR1",106,0)
 ;
"RTN","ORCDLR1",107,0)
IMMCOLL(X) ; -- Valid immediate collection date/time?
"RTN","ORCDLR1",108,0)
 I X?1"NOW+"1.N1"'" Q 1
"RTN","ORCDLR1",109,0)
 I X'?7N.1".".6N N Y,%DT S %DT="T" D ^%DT S:Y>0 X=Y I Y'>0 Q "0^Invalid date/time"
"RTN","ORCDLR1",110,0)
 Q $$VALID^LR7OV4(ORDIV,X)
"RTN","ORCDLR1",111,0)
 ;
"RTN","ORCDLR1",112,0)
LABCOLL(ORXTIM) ; -- Valid lab collection date/time?
"RTN","ORCDLR1",113,0)
 ;    Returns valid flag of 1 or 0^message
"RTN","ORCDLR1",114,0)
 N I,X,Y,%DT,ORD,ORT,PARAM,ORDY
"RTN","ORCDLR1",115,0)
 I '$O(ORTIME(0)) Q "0^There are no lab collection times defined!"
"RTN","ORCDLR1",116,0)
 I (ORXTIM="AM")!(ORXTIM="NEXT") Q 1
"RTN","ORCDLR1",117,0)
 I ORXTIM'?7N.1".".6N S %DT="T",X=ORXTIM D ^%DT S:Y>0 ORXTIM=Y I Y'>0 Q "0^Invalid date/time"
"RTN","ORCDLR1",118,0)
 ;I ORXTIM?1"V".E S T="."_$P(ORXTIM,"@",2) G D1 ; Visit - ignore day (D ^%DT ??)
"RTN","ORCDLR1",119,0)
 S ORD=$P(ORXTIM,"."),ORT="."_$P(ORXTIM,".",2)
"RTN","ORCDLR1",120,0)
 S:ORT="." ORT=+("."_$G(ORTIME("AM")))
"RTN","ORCDLR1",121,0)
 I '$D(ORTIME("B",ORT)) Q "0^Invalid lab collection time"
"RTN","ORCDLR1",122,0)
LC1 ; -- check date
"RTN","ORCDLR1",123,0)
 I ORD<DT Q "0^Can not order for past days."
"RTN","ORCDLR1",124,0)
 I ORXTIM<$$NOW^XLFDT,'$G(OREVENT) Q "0^Cannot order in the past"
"RTN","ORCDLR1",125,0)
 I $G(ORTYPE)'="Z",'$G(OREVENT),ORD=DT,$P($H,",",2)>ORTIME("B",ORT) Q "0^The cut-off time for this collection has passed"
"RTN","ORCDLR1",126,0)
 S ORDY=7 I $D(^XTV(8989.51,"B","LR LAB COLLECT FUTURE")),$G(ORL) S ORDY=+$$GET^XPAR("ALL^DIV.`"_ORDIV_"^LOC.`"_+ORL,"LR LAB COLLECT FUTURE",1,"I")
"RTN","ORCDLR1",127,0)
 I ORXTIM>$$FMADD^XLFDT($$NOW^XLFDT,ORDY) Q "0^Cannot order a lab collection more than "_ORDY_" days in advance"
"RTN","ORCDLR1",128,0)
 I $G(ORL),$$GET^XPAR("ALL^LOC.`"_+ORL,"LR EXCEPTED LOCATIONS") Q 1
"RTN","ORCDLR1",129,0)
 S PARAM="LR COLLECT "_$$UP^XLFSTR($$DOW^XLFDT(ORD))
"RTN","ORCDLR1",130,0)
 I $G(ORTYPE)'="Z",'$$GET^XPAR("ALL",PARAM) Q "0^There are no lab collections that day"
"RTN","ORCDLR1",131,0)
 I $G(ORTYPE)'="Z",'$$GET^XPAR("ALL","LR IGNORE HOLIDAYS"),$D(^HOLIDAY(ORD)) Q "0^There are no lab collections on holidays"
"RTN","ORCDLR1",132,0)
 Q 1
"RTN","ORCDLR1",133,0)
 ;
"RTN","ORCDLR1",134,0)
LABSAMP() ; -- Lab Collect sample?
"RTN","ORCDLR1",135,0)
 N X,Y S X=+$$VAL^ORCD("COLLECTION SAMPLE"),Y=$P($G(^LAB(62,X,0)),U,7)
"RTN","ORCDLR1",136,0)
 Q Y
"RTN","ORCDLR1",137,0)
 ;
"RTN","ORCDLR1",138,0)
COLLTYPE() ; -- Returns default collection type
"RTN","ORCDLR1",139,0)
 N Y I $G(ORTYPE)="Z" S Y="" G CTQ
"RTN","ORCDLR1",140,0)
 I $L($G(LRFZX)) S Y=LRFZX,EDITONLY=1 G CTQ
"RTN","ORCDLR1",141,0)
 I $D(^TMP("ORECALL",$J,+ORDIALOG,PROMPT)) D  G CTQ
"RTN","ORCDLR1",142,0)
 . S Y=$$RECALL^ORCD(PROMPT),EDITONLY=1
"RTN","ORCDLR1",143,0)
 S:$G(ORL) Y=$$GET^XPAR("ALL^"_ORL,"LR DEFAULT TYPE QUICK")
"RTN","ORCDLR1",144,0)
 I '$L($G(Y)) S Y=$S('$$INPT^ORCD:"SP",$G(ORTYPE)="Q":"LC",1:"WC")
"RTN","ORCDLR1",145,0)
CTQ I Y="I",'$O(ORIMTIME(0))!('$G(ORTEST("Lab CollSamp"))) S Y="WC"
"RTN","ORCDLR1",146,0)
 I Y="LC",'$O(ORTIME(0))!('$G(ORTEST("Lab CollSamp"))) S Y="WC"
"RTN","ORCDLR1",147,0)
 ;S:$G(ORTYPE)="Q" EDITONLY=1
"RTN","ORCDLR1",148,0)
 I '(FIRST&EDITONLY) D HELPTYPE
"RTN","ORCDLR1",149,0)
 Q Y
"RTN","ORCDLR1",150,0)
 ;
"RTN","ORCDLR1",151,0)
CKTYPE ; -- Valid type for time, sample?
"RTN","ORCDLR1",152,0)
 I Y="LC",'$O(ORTIME(0)) W $C(7),!,"There are no lab collection times defined!" K DONE Q
"RTN","ORCDLR1",153,0)
 I Y="I",'$O(ORIMTIME(0)) W $C(7),!,"There are no immediate collection times defined!" K DONE Q
"RTN","ORCDLR1",154,0)
 I (Y="LC"!(Y="I")),'$G(ORTEST("Lab CollSamp")) W $C(7),!,"There is no lab collection sample defined for this test!",! K DONE Q
"RTN","ORCDLR1",155,0)
 I $D(ORESET),ORESET'=Y,("ILC"[ORESET)!("ILC"[Y) D CHANGED^ORCDLR("TYPE") K ORDIALOG($$PTR^ORCD("OR GTX LAB URGENCY"),"LIST")
"RTN","ORCDLR1",156,0)
 Q
"RTN","ORCDLR1",157,0)
 ;
"RTN","ORCDLR1",158,0)
HELPTYPE ; -- Xecutable help for Coll Type
"RTN","ORCDLR1",159,0)
 W !!,"SEND TO LAB - Means the patient is ambulatory and will be sent to the",!,"Laboratory draw room to have blood drawn."
"RTN","ORCDLR1",160,0)
 W !,"WARD COLLECT - Means that either the physician or a nurse will be collecting",!,"the sample on the ward."
"RTN","ORCDLR1",161,0)
 W !,"LAB BLOOD TEAM - Means the phlebotomist from Lab will draw the blood on the",!,"ward.  This method is limited to laboratory defined collection times."
"RTN","ORCDLR1",162,0)
 W:$$ON^LR7OV4(ORDIV) !,"IMMEDIATE COLLECT BY BLOOD TEAM - Means the phlebotomist from Lab is on",!,"call to draw blood on the ward.  This method is available during times",!,"defined by Laboratory." W !
"RTN","ORCDLR1",163,0)
 N DOMAIN S DOMAIN=$P(ORDIALOG(PROMPT,0),U,2) D SETLST1^ORCD
"RTN","ORCDLR1",164,0)
 Q
"RTN","ORCDLR1",165,0)
VALID(ORDER) ;check collection time on release
"RTN","ORCDLR1",166,0)
 N VALIDT,OREVENT,COLLTYPE,COLLDT,OK,ORDIV,ORTXT,ORPTLK,ORTIME,ORIMTIME,ORACT
"RTN","ORCDLR1",167,0)
 S VALIDT="" D GETIMES
"RTN","ORCDLR1",168,0)
 S COLLDT=$$VALUE^ORCSAVE2(ORDER,"START")
"RTN","ORCDLR1",169,0)
 S COLLTYPE=$$VALUE^ORCSAVE2(ORDER,"COLLECT")
"RTN","ORCDLR1",170,0)
 I $L($P(^OR(100,+ORIFN,0),U,17)) S OREVENT=$P(^(0),U,17)
"RTN","ORCDLR1",171,0)
 I "NOWAMNEXT"[COLLDT D:'$G(OREVENT) MULT Q 1 ;OK
"RTN","ORCDLR1",172,0)
 S OK=$S(COLLTYPE="LC":$$LABCOLL(COLLDT),COLLTYPE="I":$$IMMCOLL(COLLDT),1:$$CKDATE(COLLDT))
"RTN","ORCDLR1",173,0)
 I OK D:'$G(OREVENT) MULT Q 1 ;COLLDT passed checks
"RTN","ORCDLR1",174,0)
 W !!,$C(7),$P(OK,U,2)
"RTN","ORCDLR1",175,0)
 D TEXT^ORQ12(.ORTXT,ORDER) W !,$G(ORTXT(1)) K ORTXT
"RTN","ORCDLR1",176,0)
 W !,"must be edited before signing/release." K VALIDT D
"RTN","ORCDLR1",177,0)
 . N ORDIV,ORIMTIME,ORTIME,ORNP
"RTN","ORCDLR1",178,0)
 . S ORNP=$P(^OR(100,ORDER,0),U,4)
"RTN","ORCDLR1",179,0)
 . S ORACT="XX" D XX^ORCACT4 ;edit order
"RTN","ORCDLR1",180,0)
 I $$VALUE^ORCSAVE2(ORDER,"START")'=COLLDT D:'$G(OREVENT) MULT Q 1 ;OK
"RTN","ORCDLR1",181,0)
 Q 0
"RTN","ORCDLR1",182,0)
 ;
"RTN","ORCDLR1",183,0)
MULT ; -- ck child orders
"RTN","ORCDLR1",184,0)
 N CHGD S CHGD=$$MULT^ORCDLR(ORDER,COLLTYPE,COLLDT) Q:'CHGD
"RTN","ORCDLR1",185,0)
 W !!,$P(CHGD,U,2) H 2
"RTN","ORCDLR1",186,0)
 Q
"RTN","ORCDPS1")
0^11^B67515562
"RTN","ORCDPS1",1,0)
ORCDPS1 ;SLC/MKB-Pharmacy dialog utilities ; 08 May 2002  2:12 PM
"RTN","ORCDPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,117,141**;Dec 17, 1997
"RTN","ORCDPS1",3,0)
EN(TYPE) ; -- entry action for Meds dialogs
"RTN","ORCDPS1",4,0)
 S ORINPT=$$INPT^ORCD,ORCAT=$G(TYPE) I ORCAT="" D
"RTN","ORCDPS1",5,0)
 . I $G(ORENEW)!$G(OREWRITE)!$D(OREDIT),$L($P($G(OR0),U,12)) S ORCAT=$P(OR0,U,12) Q  ;use value from order, via ORCACT4
"RTN","ORCDPS1",6,0)
 . S ORCAT=$S(ORINPT:"I",1:"O")
"RTN","ORCDPS1",7,0)
 S ORDG=+$O(^ORD(100.98,"B",$S(ORCAT="I":"UD RX",1:"O RX"),0))
"RTN","ORCDPS1",8,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",9,0)
 I $G(ORENEW)!$G(OREWRITE)!$D(OREDIT)!$G(ORXFER) D
"RTN","ORCDPS1",10,0)
 . K ORDIALOG($$PTR("START DATE/TIME"),1)
"RTN","ORCDPS1",11,0)
 . K ORDIALOG($$PTR("NOW"),1)
"RTN","ORCDPS1",12,0)
 . I $D(OREDIT),ORCAT="O",'$O(ORDIALOG($$PTR^ORCD("OR GTX INSTRUCTIONS"),0)) K ^TMP("ORWORD",$J)
"RTN","ORCDPS1",13,0)
 I ORINPT,ORCAT="O" W $C(7),!!,"NOTE: This will create an outpatient prescription for an inpatient!",!
"RTN","ORCDPS1",14,0)
 Q
"RTN","ORCDPS1",15,0)
 ;
"RTN","ORCDPS1",16,0)
EN1 ; -- setup Meds dialog for quick order editor using ORDG
"RTN","ORCDPS1",17,0)
 N DG S DG=$P($G(^ORD(100.98,+$G(ORDG),0)),U,3)
"RTN","ORCDPS1",18,0)
 I $P(DG," ")="O" S ORINPT=0,ORCAT="O"
"RTN","ORCDPS1",19,0)
 E  S ORINPT=1,ORCAT="I"
"RTN","ORCDPS1",20,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",21,0)
 Q
"RTN","ORCDPS1",22,0)
 ;
"RTN","ORCDPS1",23,0)
ENOI ; -- setup OI prompt
"RTN","ORCDPS1",24,0)
 N D S D=$G(ORDIALOG(PROMPT,"D"))
"RTN","ORCDPS1",25,0)
 S:D="S.RX" ORDIALOG(PROMPT,"D")=$S(ORCAT="I":"S.UD RX",1:"S.O RX")
"RTN","ORCDPS1",26,0)
 I ORCAT="I",'ORINPT,D="S.UD RX" D  ;limit to IV meds for outpt's
"RTN","ORCDPS1",27,0)
 . S ORDG=+$O(^ORD(100.98,"B","O RX",0)),ORDIALOG(PROMPT,"D")="S.IVM RX"
"RTN","ORCDPS1",28,0)
 . S ORDIALOG(PROMPT,"?")="Enter the IV medication you wish to order for this patient."
"RTN","ORCDPS1",29,0)
 Q
"RTN","ORCDPS1",30,0)
 ;
"RTN","ORCDPS1",31,0)
DEA ; -- ck DEA# of ordering provider if SchedII drug
"RTN","ORCDPS1",32,0)
 Q:$G(ORTYPE)="Z"  N DEAFLG,PSOI
"RTN","ORCDPS1",33,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(Y),0)),U,2) Q:PSOI'>0
"RTN","ORCDPS1",34,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,ORCAT) Q:DEAFLG'>0  ;ok
"RTN","ORCDPS1",35,0)
 I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" K DONE Q
"RTN","ORCDPS1",36,0)
 I DEAFLG=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS1",37,0)
 Q
"RTN","ORCDPS1",38,0)
 ;
"RTN","ORCDPS1",39,0)
CHANGED(X) ; -- Kill dependent values when prompt X changes
"RTN","ORCDPS1",40,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPS1",41,0)
 S PROMPTS=X I X="OI" D
"RTN","ORCDPS1",42,0)
 . S PROMPTS="INSTRUCTIONS^ROUTE^SCHEDULE^START DATE/TIME^DURATION^AND/THEN^DOSE^DISPENSE DRUG^SIG^PATIENT INSTRUCTIONS^DAYS SUPPLY^QUANTITY^REFILLS^SERVICE CONNECTED"
"RTN","ORCDPS1",43,0)
 . K ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,ORQTY,ORQTYUNT,OREFILLS,ORCOPAY
"RTN","ORCDPS1",44,0)
 . K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",45,0)
 I X="DS" S PROMPTS="QUANTITY^REFILLS" K OREFILLS
"RTN","ORCDPS1",46,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPS1",47,0)
 . S PTR=$$PTR(NAME) Q:'PTR
"RTN","ORCDPS1",48,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPS1",49,0)
 . K ORDIALOG(PTR,"LIST"),^TMP("ORWORD",$J,PTR)
"RTN","ORCDPS1",50,0)
 Q
"RTN","ORCDPS1",51,0)
 ;
"RTN","ORCDPS1",52,0)
ORDITM(OI) ; -- Check OI inactive date & type, get dependent info
"RTN","ORCDPS1",53,0)
 Q:OI'>0  ;quit - no value
"RTN","ORCDPS1",54,0)
 N ORPS,PSOI S ORPS=$G(^ORD(101.43,+OI,"PS")),PSOI=+$P($G(^(0)),U,2)
"RTN","ORCDPS1",55,0)
 S ORIV=$S($P(ORPS,U)=2:1,1:0)
"RTN","ORCDPS1",56,0)
 I $G(ORCAT)="O",'$P(ORPS,U,2) W $C(7),!,"This drug may not be used in an outpatient order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",57,0)
 I $G(ORCAT)="I" D  Q:$G(ORQUIT)
"RTN","ORCDPS1",58,0)
 . I $G(ORINPT),'$P(ORPS,U) W $C(7),!,"This drug may not be used in an inpatient order." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",59,0)
 . I '$G(ORINPT),'ORIV W $C(7),!,"This drug may not be ordered for an outpatient." S ORQUIT=1 D WAIT Q
"RTN","ORCDPS1",60,0)
 I $G(ORTYPE)="Q" D  I $G(ORQUIT) D WAIT Q
"RTN","ORCDPS1",61,0)
 . N DEAFLG S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,ORCAT) Q:DEAFLG'>0  ;ok
"RTN","ORCDPS1",62,0)
 . I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S ORQUIT=1 Q
"RTN","ORCDPS1",63,0)
 . I DEAFLG=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPS1",64,0)
OI1 ; -ck NF status
"RTN","ORCDPS1",65,0)
 I $P(ORPS,U,6),'$G(ORENEW) D  ;prompt for alternative
"RTN","ORCDPS1",66,0)
 . W !!,"*** This medication is not in the formulary! ***"
"RTN","ORCDPS1",67,0)
 . N PSX,CNT,ORX,DIR,X,Y,DTOUT,DUOUT
"RTN","ORCDPS1",68,0)
 . D EN1^PSSUTIL1(.PSOI,ORCAT) I '$O(PSOI(0)) D  Q
"RTN","ORCDPS1",69,0)
 .. W !,"    There are no formulary alternatives entered for this item."
"RTN","ORCDPS1",70,0)
 .. W !,"    Please consult with your pharmacy before ordering it."
"RTN","ORCDPS1",71,0)
 . S PSX=0,CNT=0 F  S PSX=$O(PSOI(PSX)) Q:PSX'>0  D
"RTN","ORCDPS1",72,0)
 .. S ORX=+$O(^ORD(101.43,"ID",PSX_";99PSP",0)) Q:ORX'>0
"RTN","ORCDPS1",73,0)
 .. S CNT=CNT+1,PSOI("OI",CNT)=ORX_U_PSX
"RTN","ORCDPS1",74,0)
 .. S DIR("A",CNT)=$J(CNT,3)_" "_$P($G(^ORD(101.43,ORX,0)),U)
"RTN","ORCDPS1",75,0)
 . S DIR(0)="NAO^1:"_CNT,DIR("A")="Select alternative (or <return> to continue): "
"RTN","ORCDPS1",76,0)
 . S DIR("?")="The medication selected is not in the formulary; you may select one of the above listed alternatives instead, or press <return> to continue processing this order."
"RTN","ORCDPS1",77,0)
 . Q:CNT'>0  W !,"    Formulary alternatives:" D ^DIR
"RTN","ORCDPS1",78,0)
 . I Y'>0 S:$D(DTOUT)!$D(DUOUT) ORQUIT=1 Q
"RTN","ORCDPS1",79,0)
 . D:OI'=+PSOI("OI",+Y) CHANGED("OI") ;reset parameters if different
"RTN","ORCDPS1",80,0)
 . S OI=+PSOI("OI",+Y),ORDIALOG(PROMPT,INST)=OI,OROI=OI
"RTN","ORCDPS1",81,0)
 . S PSOI=+$P(PSOI("OI",+Y),U,2)
"RTN","ORCDPS1",82,0)
OI2 ; -get selectable routes, doses [also called from NF^ORCDPS]
"RTN","ORCDPS1",83,0)
 D:'$D(^TMP("PSJMR",$J)) START^PSSJORDF(PSOI,$G(ORCAT))
"RTN","ORCDPS1",84,0)
 I '$D(ORDOSE) D
"RTN","ORCDPS1",85,0)
 . D DOSE^PSSORUTL(.ORDOSE,PSOI,$S($G(ORCAT)="I":"U",1:"O"),+ORVP)
"RTN","ORCDPS1",86,0)
 . K:$G(ORDOSE(1))=-1 ORDOSE
"RTN","ORCDPS1",87,0)
 Q
"RTN","ORCDPS1",88,0)
 ;
"RTN","ORCDPS1",89,0)
NFI(OI) ; -- Show NFI restrictions, if exist
"RTN","ORCDPS1",90,0)
 N PSOI,I,J,LCNT,MAX,X,STOP
"RTN","ORCDPS1",91,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORCDPS1",92,0)
 D EN^PSSDIN(PSOI,"") Q:'$D(^TMP("PSSDIN",$J,"OI",PSOI))
"RTN","ORCDPS1",93,0)
 S I=0,LCNT=0,MAX=$S($G(IOBM)&$G(IOTM):IOBM-IOTM+1,1:24) W !
"RTN","ORCDPS1",94,0)
 F  S I=$O(^TMP("PSSDIN",$J,"OI",PSOI,I)) Q:I'>0  D
"RTN","ORCDPS1",95,0)
 . S J=0 F  S J=$O(^TMP("PSSDIN",$J,"OI",PSOI,I,J)) Q:J'>0  S X=$G(^(J)) D  Q:$G(STOP)
"RTN","ORCDPS1",96,0)
 .. S LCNT=LCNT+1 I LCNT'<MAX S:'$$CONT STOP=1 Q:$G(STOP)  S LCNT=1
"RTN","ORCDPS1",97,0)
 .. W !,X
"RTN","ORCDPS1",98,0)
 W ! K ^TMP("PSSDIN",$J,"OI",PSOI)
"RTN","ORCDPS1",99,0)
 Q
"RTN","ORCDPS1",100,0)
 ;
"RTN","ORCDPS1",101,0)
CONT() ; -- Press return to cont or ^ to stop
"RTN","ORCDPS1",102,0)
 N X,Y,DIR,DUOUT,DTOUT,DIRUT,DIROUT S DIR(0)="EA"
"RTN","ORCDPS1",103,0)
 S DIR("A")="Press <return> to continue or ^ to stop ..."
"RTN","ORCDPS1",104,0)
 D ^DIR S:$D(DUOUT)!$D(DTOUT) Y=""
"RTN","ORCDPS1",105,0)
 Q +Y
"RTN","ORCDPS1",106,0)
 ;
"RTN","ORCDPS1",107,0)
WAIT ; -- Wait for user
"RTN","ORCDPS1",108,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDPS1",109,0)
 Q
"RTN","ORCDPS1",110,0)
 ;
"RTN","ORCDPS1",111,0)
ROUTES ; -- Get allowable med routes
"RTN","ORCDPS1",112,0)
 Q:$G(ORDIALOG(PROMPT,"LIST"))  N I,X,CNT S (I,CNT)=0
"RTN","ORCDPS1",113,0)
 F  S I=$O(^TMP("PSJMR",$J,I)) Q:I'>0  S X=^(I),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=$P(X,U,3)_U_$P(X,U,1,2),ORDIALOG(PROMPT,"LIST","B",$P(X,U))=$P(X,U,3)
"RTN","ORCDPS1",114,0)
 S:$G(CNT) ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDPS1",115,0)
 S:$G(ORTYPE)'="Z" REQD=$S(ORCAT="I":1,$P($G(^ORD(101.43,+$G(OROI),"PS")),U,5):0,1:1)
"RTN","ORCDPS1",116,0)
 Q
"RTN","ORCDPS1",117,0)
 ;
"RTN","ORCDPS1",118,0)
DEFRTE ; -- Get default route
"RTN","ORCDPS1",119,0)
 N INST1 S INST1=$O(ORDIALOG(PROMPT,0)) S:INST1'>0 INST1=INST ;1st inst
"RTN","ORCDPS1",120,0)
 I INST1=INST S Y=+$P($G(^TMP("PSJMR",$J,1)),U,3) K:Y'>0 Y Q
"RTN","ORCDPS1",121,0)
 S Y=+$G(ORDIALOG(PROMPT,INST1)) K:Y'>0 Y S:$G(Y) EDITONLY=1
"RTN","ORCDPS1",122,0)
 Q
"RTN","ORCDPS1",123,0)
 ;
"RTN","ORCDPS1",124,0)
CKSCH ; -- validate schedule [Called from P-S Action]
"RTN","ORCDPS1",125,0)
 N ORX S ORX=ORDIALOG(PROMPT,ORI) Q:ORX=$G(ORESET)  K ORSD ;reset
"RTN","ORCDPS1",126,0)
 D EN^PSSGS0(.ORX,$G(ORCAT))
"RTN","ORCDPS1",127,0)
 I $D(ORX) S ORDIALOG(PROMPT,ORI)=ORX D CHANGED("QUANTITY") Q  ;ok
"RTN","ORCDPS1",128,0)
 W $C(7),!,"Enter either a standard administration schedule or one of your own,",!,"up to 70 characters and no more than 2 spaces.",!
"RTN","ORCDPS1",129,0)
 K DONE
"RTN","ORCDPS1",130,0)
 Q
"RTN","ORCDPS1",131,0)
 ;
"RTN","ORCDPS1",132,0)
DEFCONJ ; -- Set default conjuction for previous instance
"RTN","ORCDPS1",133,0)
 ;    (Called from P-S Action of Instructions prompt)
"RTN","ORCDPS1",134,0)
 N LAST,DUR,CONJ
"RTN","ORCDPS1",135,0)
 S LAST=$O(ORDIALOG(PROMPT,ORI),-1) Q:LAST'>0  ;first instance
"RTN","ORCDPS1",136,0)
 S CONJ=$$PTR("AND/THEN") Q:$L($G(ORDIALOG(CONJ,LAST)))
"RTN","ORCDPS1",137,0)
 S DUR=$G(ORDIALOG($$PTR("DURATION"),LAST))
"RTN","ORCDPS1",138,0)
 S ORDIALOG(CONJ,LAST)=$S(+DUR'>0:"A",1:"T")
"RTN","ORCDPS1",139,0)
 Q
"RTN","ORCDPS1",140,0)
 ;
"RTN","ORCDPS1",141,0)
ENCONJ ; -- Get allowable values, if req'd for INST
"RTN","ORCDPS1",142,0)
 N P S P=$$PTR("INSTRUCTIONS")
"RTN","ORCDPS1",143,0)
 S REQD=$S($O(ORDIALOG(P,INST)):1,1:0)
"RTN","ORCDPS1",144,0)
 S ORDIALOG(PROMPT,"A")="And/then"_$S(ORCAT="O":"/except: ",1:": ")
"RTN","ORCDPS1",145,0)
 S $P(ORDIALOG(PROMPT,0),U,2)="A:AND;T:THEN;"_$S(ORCAT="O":"X:EXCEPT;",1:"")
"RTN","ORCDPS1",146,0)
 Q
"RTN","ORCDPS1",147,0)
 ;
"RTN","ORCDPS1",148,0)
DSUP ; -- Get max/default days supply
"RTN","ORCDPS1",149,0)
 N ORX,Y
"RTN","ORCDPS1",150,0)
 S ORX("PATIENT")=+$G(ORVP),ORX("DRUG")=+$G(ORDRUG)
"RTN","ORCDPS1",151,0)
 D DSUP^PSOSIGDS(.ORX) S Y=+$G(ORX("DAYS SUPPLY")) S:Y'>0 Y=90
"RTN","ORCDPS1",152,0)
 ;S $P(ORDIALOG(PROMPT,0),U,2)="1:"_Y ;max allowed
"RTN","ORCDPS1",153,0)
 I '$G(ORDIALOG(PROMPT,1)),$G(ORTYPE)'="Z" S ORDIALOG(PROMPT,1)=Y
"RTN","ORCDPS1",154,0)
 Q
"RTN","ORCDPS1",155,0)
 ;
"RTN","ORCDPS1",156,0)
QTY() ; -- Return default quantity [Expects ORDSUP]
"RTN","ORCDPS1",157,0)
 N INSTR,DOSE,DUR,SCH,I,ORX,X,Y
"RTN","ORCDPS1",158,0)
 S Y="" I $G(ORDSUP)'>0!'$G(ORDRUG) G QTYQ ;need days supply, disp drug
"RTN","ORCDPS1",159,0)
 S INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORCDPS1",160,0)
 S DOSE=$$PTR("DOSE"),CONJ=$$PTR("AND/THEN")
"RTN","ORCDPS1",161,0)
 S DUR=$$PTR("DURATION"),SCH=$$PTR("SCHEDULE")
"RTN","ORCDPS1",162,0)
 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D  Q:'$D(ORX)
"RTN","ORCDPS1",163,0)
 . S X=$P($G(ORDIALOG(DOSE,I)),"&",3) I X'>0 K ORX Q
"RTN","ORCDPS1",164,0)
 . S ORX("DOSE ORDERED",I)=X,ORX("SCHEDULE",I)=$G(ORDIALOG(SCH,I))
"RTN","ORCDPS1",165,0)
 . S X=$G(ORDIALOG(DUR,I)),ORX("DURATION",I)=$$HL7DUR^ORMBLDPS
"RTN","ORCDPS1",166,0)
 . S ORX("CONJUNCTION",I)=$G(ORDIALOG(CONJ,I))
"RTN","ORCDPS1",167,0)
 G:'$D(ORX) QTYQ ;no doses
"RTN","ORCDPS1",168,0)
 S ORX("PATIENT")=+$G(ORVP),ORX("DRUG")=+$G(ORDRUG)
"RTN","ORCDPS1",169,0)
 S ORX("DAYS SUPPLY")=+$G(ORDSUP)
"RTN","ORCDPS1",170,0)
 D QTYX^PSOSIG(.ORX) S Y=$G(ORX("QTY"))
"RTN","ORCDPS1",171,0)
QTYQ Q Y
"RTN","ORCDPS1",172,0)
 ;
"RTN","ORCDPS1",173,0)
MAXREFS ; -- Get max refills allowed [Entry Action]
"RTN","ORCDPS1",174,0)
 Q:$G(ORCAT)'="O"  N ORX,X
"RTN","ORCDPS1",175,0)
 S ORX("ITEM")=+$P($G(^ORD(101.43,+$G(OROI),0)),U,2)
"RTN","ORCDPS1",176,0)
 S ORX("DRUG")=+$G(ORDRUG),ORX("PATIENT")=+$G(ORVP)
"RTN","ORCDPS1",177,0)
 I $G(OREVENT),$$TYPE^OREVNTX(OREVENT)="D" S ORX("DISCHARGE")=1
"RTN","ORCDPS1",178,0)
 S ORX("DAYS SUPPLY")=$G(ORDSUP) D MAX^PSOSIGDS(.ORX)
"RTN","ORCDPS1",179,0)
 S OREFILLS=$G(ORX("MAX")),X=$G(ORDIALOG(PROMPT,INST))
"RTN","ORCDPS1",180,0)
 I OREFILLS'>0 K ORDIALOG(PROMPT,INST) W !,"No refills allowed." Q
"RTN","ORCDPS1",181,0)
 S $P(ORDIALOG(PROMPT,0),U,2)="0:"_OREFILLS
"RTN","ORCDPS1",182,0)
 S ORDIALOG(PROMPT,"A")="Refills (0-"_OREFILLS_"): "
"RTN","ORCDPS1",183,0)
 I X,X>OREFILLS S ORDIALOG(PROMPT,INST)=OREFILLS
"RTN","ORCDPS1",184,0)
 Q
"RTN","ORCDPS1",185,0)
 ;
"RTN","ORCDPS1",186,0)
ASKSC() ; -- Return 1 or 0, if SC prompt should be asked
"RTN","ORCDPS1",187,0)
 I $$SC^PSOCP(+ORVP,+$G(ORDRUG)) Q 0
"RTN","ORCDPS1",188,0)
 ;I $$RXST^IBARXEU(+ORVP)>0 Q 0 ;exempt from copay
"RTN","ORCDPS1",189,0)
 Q 1
"RTN","ORCDPS1",190,0)
 ;
"RTN","ORCDPS1",191,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORCDPS1",192,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORCDPS1",193,0)
 ;
"RTN","ORCDPS1",194,0)
EXIT ; -- exit action for Meds dialogs
"RTN","ORCDPS1",195,0)
 S:$G(ORXNP) ORNP=ORXNP
"RTN","ORCDPS1",196,0)
 K ORXNP,ORINPT,ORCAT,ORPKG,OROI,ORIV,ORDRUG,ORDOSE,OROUTE,ORSCH,ORSD,ORDSUP,OREFILLS,ORQTY,ORQTYUNT,ORCOPAY,PSJNOPC,ORCOMPLX
"RTN","ORCDPS1",197,0)
 K ^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J)
"RTN","ORCDPS1",198,0)
 Q
"RTN","ORCDRA")
0^12^B30425287
"RTN","ORCDRA",1,0)
ORCDRA ; SLC/MKB - Utility functions for RA dialogs ;7/23/01  11:47
"RTN","ORCDRA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**8,53,95,141**;Dec 17, 1997
"RTN","ORCDRA",3,0)
 ;
"RTN","ORCDRA",4,0)
EN ; -- Entry action for RA OERR EXAM order dialog
"RTN","ORCDRA",5,0)
 D LAST7:$G(ORTAB)="ORDERS"
"RTN","ORCDRA",6,0)
ENA N ENT D ITYPE ;enter here for Quick Setup (editor) instead
"RTN","ORCDRA",7,0)
 S ENT="ALL"_$S($G(ORDIV):"^DIV.`"_ORDIV,1:"")
"RTN","ORCDRA",8,0)
 S ORBROAD=$$GET^XPAR(ENT,"RA REQUIRE DETAILED",1,"Q")
"RTN","ORCDRA",9,0)
 Q
"RTN","ORCDRA",10,0)
 ;
"RTN","ORCDRA",11,0)
EX ; -- Exit action for RA OERR EXAM order dialog
"RTN","ORCDRA",12,0)
 K ORBROAD,ORIMTYPE,ORIMLOC,ORMORE,ORDIV
"RTN","ORCDRA",13,0)
 Q
"RTN","ORCDRA",14,0)
 ;
"RTN","ORCDRA",15,0)
LAST7 ; -- Display last 7 days of exams for patient
"RTN","ORCDRA",16,0)
 N IDT,EXDT,EXAM,STS,Y
"RTN","ORCDRA",17,0)
 Q:$G(ORTYPE)="Q"  Q:$G(ORACT)="XX"  Q:$G(ORACT)="RN"
"RTN","ORCDRA",18,0)
 K ^TMP($J,"RAE7") D EN2^RAO7PC1(+ORVP)
"RTN","ORCDRA",19,0)
 Q:'$O(^TMP($J,"RAE7",+ORVP,0))  S IDT=0 ; no exams
"RTN","ORCDRA",20,0)
 W !!,"Case #    Exams Over the Last 7 Days   Exam Date   Status of Exam  Imaging Loc.",!,"------    --------------------------   ---------   --------------  ------------"
"RTN","ORCDRA",21,0)
 F  S IDT=$O(^TMP($J,"RAE7",+ORVP,IDT)) Q:IDT'>0  S EXAM=$G(^(IDT)) D
"RTN","ORCDRA",22,0)
 . S Y=$P(9999999-$P(IDT,"-"),".") X ^DD("DD")
"RTN","ORCDRA",23,0)
 . S STS=$P(EXAM,U,3),STS=$S(STS="V":"VERIFIED",STS="R":"RELEASED/UNVER",STS="N":"NO REPORT",STS="P":"PARTIAL",1:"")
"RTN","ORCDRA",24,0)
 . W !,$E($P(EXAM,U,2),1,9),?10,$E($P(EXAM,U),1,28),?39,Y_" "_STS,?67,$E($P(EXAM,U,5),1,12)
"RTN","ORCDRA",25,0)
 K ^TMP($J,"RAE7") W !
"RTN","ORCDRA",26,0)
 Q
"RTN","ORCDRA",27,0)
 ;
"RTN","ORCDRA",28,0)
ITYPE ; -- Select Imaging Type for ordering, sets ORIMTYPE
"RTN","ORCDRA",29,0)
 N XRAY,DA,DG,DG0,ABBREV,CNT,ITYPE,DIC,X,Y,I,NAME,OI,IFN,ORY
"RTN","ORCDRA",30,0)
 I $G(ORTYPE)="Q" S ORDG=ORDG_U_$G(^ORD(100.98,+ORDG,0)) G ITQ
"RTN","ORCDRA",31,0)
 I $G(ORIFN) S DG=+$P(^OR(100,+ORIFN,0),U,11),ORDG=DG_U_$G(^ORD(100.98,DG,0)) G ITQ  ; edit
"RTN","ORCDRA",32,0)
 S XRAY=$O(^ORD(100.98,"B","XRAY",0)),(DA,CNT)=0
"RTN","ORCDRA",33,0)
 I $G(ORTYPE)="Z",ORDG'=XRAY S ORDG=ORDG_U_$G(^ORD(100.98,+ORDG,0)) G ITQ
"RTN","ORCDRA",34,0)
 F  S DA=$O(^ORD(100.98,XRAY,1,DA)) Q:DA'>0  S DG=$G(^(DA,0)) D
"RTN","ORCDRA",35,0)
 . S DG0=$G(^ORD(100.98,DG,0)),ABBREV=$P(DG0,U,3)
"RTN","ORCDRA",36,0)
 . ;I $D(^ORD(101.43,"S."_ABBREV)) S CNT=CNT+1,ITYPE(ABBREV)=DG_U_DG0
"RTN","ORCDRA",37,0)
 . I $$ACTIVE(ABBREV) S CNT=CNT+1,ITYPE(ABBREV)=DG_U_DG0
"RTN","ORCDRA",38,0)
 I 'CNT W $C(7),!!,"No active Imaging Types defined!",! H 3 S ORQUIT=1 Q
"RTN","ORCDRA",39,0)
 I CNT=1 S I=$O(ITYPE("")),ORDG=ITYPE(I) G ITQ
"RTN","ORCDRA",40,0)
 W !!,"Select one of the following imaging types:"
"RTN","ORCDRA",41,0)
 S I="" F  S I=$O(ITYPE(I)) Q:I=""  W !,"   "_$P(ITYPE(I),U,2)
"RTN","ORCDRA",42,0)
 S DIC="^RA(79.2,",DIC(0)="AEQMZ",DIC("A")="Select IMAGING TYPE: "
"RTN","ORCDRA",43,0)
 S DIC("S")="I $D(ITYPE($P(^(0),U,3)))" W !
"RTN","ORCDRA",44,0)
 D ^DIC I $D(DTOUT)!$D(DUOUT)!(Y<0) S ORQUIT=1 Q
"RTN","ORCDRA",45,0)
 S ORDG=ITYPE($P(Y(0),U,3))
"RTN","ORCDRA",46,0)
ITQ S NAME=$P(ORDG,U,3),OI=$$PTR^ORCD("OR GTX ORDERABLE ITEM")
"RTN","ORCDRA",47,0)
 S ORDIALOG(OI,"A")=NAME_" Procedure: ",ORDIALOG(OI,"?")="Enter the "_NAME_" procedure to be ordered for this patient"
"RTN","ORCDRA",48,0)
 S ITYPE=$P(ORDG,U,4),ORIMTYPE=$O(^RA(79.2,"C",ITYPE,0))
"RTN","ORCDRA",49,0)
 S ORDIALOG(OI,"D")="S."_ITYPE_";C."_ITYPE
"RTN","ORCDRA",50,0)
 I ORIMTYPE D  ; screen modifiers on ImType
"RTN","ORCDRA",51,0)
 . N PTR S PTR=$$PTR^ORCD("OR GTX MODIFIERS") Q:'PTR
"RTN","ORCDRA",52,0)
 . S ORDIALOG(PTR,"S")="I $D(^RAMIS(71.2,""AB"","_ORIMTYPE_",+Y))"
"RTN","ORCDRA",53,0)
 S ORDIV=$$DIV^ORCDRA1 D EN4^RAO7PC1(ITYPE,"ORY")
"RTN","ORCDRA",54,0)
 S (IFN,CNT)=0 F  S IFN=$O(ORY(IFN)) Q:IFN'>0  S CNT=CNT+1,ORIMLOC(CNT)=ORY(IFN),ORIMLOC("B",$P(ORY(IFN),U,2))=IFN ; I $P(ORY(IFN),U,3)=ORDIV
"RTN","ORCDRA",55,0)
 I '$$GET^XPAR("ALL^DIV.`"_ORDIV,"RA SUBMIT PROMPT",1,"Q"),CNT>1 K ORIMLOC ; don't present any choices
"RTN","ORCDRA",56,0)
 E  S ORIMLOC=CNT_"^1"
"RTN","ORCDRA",57,0)
 Q
"RTN","ORCDRA",58,0)
 ;
"RTN","ORCDRA",59,0)
ACTIVE(DG) ; -- Returns 1 or 0, if active OI's exist for DG
"RTN","ORCDRA",60,0)
 N X,Y,IDX,ROOT,NOW S Y=0
"RTN","ORCDRA",61,0)
 G:'$L($G(DG)) ACTQ G:'$D(^ORD(101.43,"S."_DG)) ACTQ
"RTN","ORCDRA",62,0)
 S IDX="^ORD(101.43,""S."_DG_""")",ROOT=$TR(IDX,")",","),NOW=$$NOW^XLFDT
"RTN","ORCDRA",63,0)
 F  S IDX=$Q(@IDX) Q:$E(IDX,1,$L(ROOT))'=ROOT  S X=$P(@IDX,U,3) I 'X!(X>NOW) S Y=1 Q  ;at least one active orderable in index
"RTN","ORCDRA",64,0)
ACTQ Q Y
"RTN","ORCDRA",65,0)
 ;
"RTN","ORCDRA",66,0)
COMMON ; -- Build ORDIALOG(PROMPT,"LIST") of Common Procedures
"RTN","ORCDRA",67,0)
 N CNT,ITYPE,NAME,DA K ORDIALOG(PROMPT,"LIST")
"RTN","ORCDRA",68,0)
 S:'$D(ORDG) ORDG=$P(^ORD(101.41,+ORDIALOG,0),U,5),ORDG=ORDG_U_$G(^ORD(100.98,+ORDG,0))
"RTN","ORCDRA",69,0)
 S ITYPE=$P(^ORD(100.98,+ORDG,0),U,3) Q:'$D(^ORD(101.43,"COMMON",ITYPE))
"RTN","ORCDRA",70,0)
 S NAME="",CNT=0
"RTN","ORCDRA",71,0)
 F  S NAME=$O(^ORD(101.43,"COMMON",ITYPE,NAME)) Q:NAME=""  S DA=$O(^(NAME,0)),CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=DA_U_NAME
"RTN","ORCDRA",72,0)
 S ORDIALOG(PROMPT,"LIST")=CNT
"RTN","ORCDRA",73,0)
 S:CNT $P(ORDIALOG(PROMPT,"?"),";",2)=" select either the number of a common procedure listed above or the name of any "_$$LOW^XLFSTR($P(ORDG,U,2))_" procedure"
"RTN","ORCDRA",74,0)
 Q
"RTN","ORCDRA",75,0)
 ;
"RTN","ORCDRA",76,0)
LIST ; -- List Common Procedures in ORDIALOG(PROMPT,"LIST") for selection
"RTN","ORCDRA",77,0)
 N NUM,DA,HALF,DIR,Y Q:'$O(ORDIALOG(PROMPT,"LIST",0))
"RTN","ORCDRA",78,0)
 S HALF=ORDIALOG(PROMPT,"LIST")\2
"RTN","ORCDRA",79,0)
 I ORDIALOG(PROMPT,"LIST")\2*2'=ORDIALOG(PROMPT,"LIST") S HALF=HALF+1
"RTN","ORCDRA",80,0)
 W !!,"Common "_$$LOWER^VALM1($P(ORDG,U,2))_" Procedures: "
"RTN","ORCDRA",81,0)
 S Y=1 F NUM=1:1:HALF D  Q:'+Y
"RTN","ORCDRA",82,0)
 . S DA=ORDIALOG(PROMPT,"LIST",NUM)
"RTN","ORCDRA",83,0)
 . W !,$J(NUM,3)_" "_$E($P(ORDIALOG(PROMPT,"LIST",NUM),U,2),1,36)
"RTN","ORCDRA",84,0)
 . S DA=$G(ORDIALOG(PROMPT,"LIST",NUM+HALF)) Q:'DA
"RTN","ORCDRA",85,0)
 . W ?40,$J(NUM+HALF,3)_" "_$E($P(ORDIALOG(PROMPT,"LIST",NUM+HALF),U,2),1,36)
"RTN","ORCDRA",86,0)
 .I (NUM+$G(VALM("TM"))=24)&(NUM'=$S($G(SCR)'=""&($G(ORTAB)="ORDERS"):19,1:20)) S DIR(0)="E" D ^DIR K DIR
"RTN","ORCDRA",87,0)
 Q
"RTN","ORCDRA",88,0)
 ;
"RTN","ORCDRA",89,0)
BROAD(PROC) ; -- Ck PROC type vs ORBROAD
"RTN","ORCDRA",90,0)
 Q:'ORBROAD  Q:$P($G(^ORD(101.43,+PROC,"RA")),U,2)'="B"
"RTN","ORCDRA",91,0)
 K DONE W $C(7),!,"You may not select a broad procedure!",!
"RTN","ORCDRA",92,0)
 Q
"RTN","ORCDRA",93,0)
 ;
"RTN","ORCDRA",94,0)
LKP ; -- Special lookup on [common] procedures
"RTN","ORCDRA",95,0)
 N ORX,I,J,Z,BEG,END K ORMORE
"RTN","ORCDRA",96,0)
 I X'[",",X'["-" S Y=$$FIND^ORCDLG2("ORDIALOG("_PROMPT_",""LIST"")",X) D:'$L(Y) DIC^ORCDLG2 Q
"RTN","ORCDRA",97,0)
 S ORX=X F I=1:1:$L(ORX,",") S X=$P(ORX,",",I) I $L(X) D
"RTN","ORCDRA",98,0)
 . I 'X S ORMORE=+$G(ORMORE)+1,ORMORE(ORMORE)=U_X Q
"RTN","ORCDRA",99,0)
 . I X'?1.2N,X'?1.N1"-"1.N Q
"RTN","ORCDRA",100,0)
 . S BEG=+X,END=+$P(X,"-",2) S:'END END=X
"RTN","ORCDRA",101,0)
 . F J=BEG:1:END S Z=$G(ORDIALOG(PROMPT,"LIST",J)) S:Z ORMORE=+$G(ORMORE)+1,ORMORE(ORMORE)=Z
"RTN","ORCDRA",102,0)
 D NEXTPROC
"RTN","ORCDRA",103,0)
 Q
"RTN","ORCDRA",104,0)
 ;
"RTN","ORCDRA",105,0)
NEXTPROC ; -- Gets next procedure in ORMORE()
"RTN","ORCDRA",106,0)
 Q:$G(ORDIALOG(PROMPT,INST))
"RTN","ORCDRA",107,0)
 N I,X S I=$O(ORMORE(0)) I 'I K ORMORE Q
"RTN","ORCDRA",108,0)
 S X=$G(ORMORE(I)),ORMORE=ORMORE-1 K ORMORE(I)
"RTN","ORCDRA",109,0)
 W !!,"For "_$P(ORDIALOG(PROMPT,"A"),":")_" "_$P(X,U,2)_":"
"RTN","ORCDRA",110,0)
 S:X Y=X,ORDIALOG(PROMPT,INST)=+X,EDITONLY=1
"RTN","ORCDRA",111,0)
 I 'X S X=$P(X,U,2) D DIC^ORCDLG2 S:Y'>0 ORQUIT=1 S:Y>0 ORDIALOG(PROMPT,INST)=+Y,EDITONLY=1
"RTN","ORCDRA",112,0)
 Q
"RTN","ORCDRA1")
0^13^B9865804
"RTN","ORCDRA1",1,0)
ORCDRA1 ;SLC/MKB-Utility functions for RA dialogs ; 08 May 2002  2:12 PM
"RTN","ORCDRA1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,75,141**;Dec 17, 1997
"RTN","ORCDRA1",3,0)
DIV() ; -- Returns division of ordering location
"RTN","ORCDRA1",4,0)
 N Y I $G(ORL),'$G(OREVENT) S Y=+$P($G(^SC(+ORL,0)),U,15),Y=+$$SITE^VASITE(DT,Y)
"RTN","ORCDRA1",5,0)
 I $G(OREVENT) S Y=+$$DIV^OREVNTX(OREVENT)
"RTN","ORCDRA1",6,0)
 S:$G(Y)'>0 Y=+$G(DUZ(2))
"RTN","ORCDRA1",7,0)
DIVQ Q Y
"RTN","ORCDRA1",8,0)
 ;
"RTN","ORCDRA1",9,0)
CKPTYPE ; -- Check procedure for Series type
"RTN","ORCDRA1",10,0)
 N PTYPE S PTYPE=$P($G(^ORD(101.43,+$$VAL^ORCD("PROCEDURE"),"RA")),U,2)
"RTN","ORCDRA1",11,0)
 Q:PTYPE'="S"  Q:'$L($P($G(^RAMIS(71.2,+Y,0)),U,2))
"RTN","ORCDRA1",12,0)
 W $C(7),!,"This procedure modifier may not be selected with a procedure series!",!
"RTN","ORCDRA1",13,0)
 K DONE,ORDIALOG(PROMPT,ORI)
"RTN","ORCDRA1",14,0)
 Q
"RTN","ORCDRA1",15,0)
 ;
"RTN","ORCDRA1",16,0)
VALIDWP(ROOT) ; -- Validate wp field (borrowed from VALWP^RAUTL5)
"RTN","ORCDRA1",17,0)
 ; Pass back '1' is data is valid, '0' if not valid.
"RTN","ORCDRA1",18,0)
 Q:'$L($G(ROOT)) 0 Q:'$O(@(ROOT_"0)")) 0
"RTN","ORCDRA1",19,0)
 N CHAR,CNT,WL,WPFLG,X,Y,Z
"RTN","ORCDRA1",20,0)
 S (WPFLG,X)=0
"RTN","ORCDRA1",21,0)
 F  S X=$O(@(ROOT_X_")")) Q:X'>0  D  Q:WPFLG
"RTN","ORCDRA1",22,0)
 . S (CNT,WL)=0
"RTN","ORCDRA1",23,0)
 . S Y=$G(@(ROOT_X_",0)")) Q:Y']""
"RTN","ORCDRA1",24,0)
 . S WL=$L(Y)
"RTN","ORCDRA1",25,0)
 . F Z=1:1:WL D  Q:WPFLG
"RTN","ORCDRA1",26,0)
 .. S CHAR=$E(Y,Z) S:CHAR?1AN CNT=CNT+1
"RTN","ORCDRA1",27,0)
 .. S:CHAR'?1AN&(CNT>0) CNT=0 S:CNT=2 WPFLG=1
"RTN","ORCDRA1",28,0)
 Q WPFLG
"RTN","ORCDRA1",29,0)
 ;
"RTN","ORCDRA1",30,0)
CHNGCAT ; -- Kill dependent values if Category changes
"RTN","ORCDRA1",31,0)
 N P,PTR
"RTN","ORCDRA1",32,0)
 F P="LOCATION","CONTRACT/SHARING SOURCE","RESEARCH SOURCE" D
"RTN","ORCDRA1",33,0)
 . S PTR=+$O(^ORD(101.41,"AB",$E("OR GTX "_P,1,63),0))
"RTN","ORCDRA1",34,0)
 . K:PTR ORDIALOG(PTR,1),ORDIALOG(PTR,"S") ; kill value,screen
"RTN","ORCDRA1",35,0)
 Q
"RTN","ORCDRA1",36,0)
 ;
"RTN","ORCDRA1",37,0)
MATCH(CATG) ; -- Category match pt location type?
"RTN","ORCDRA1",38,0)
 I $G(OREVENT) Q 1 ; location will be stuffed
"RTN","ORCDRA1",39,0)
 N TYPE,SCREEN,Y S TYPE=$P($G(^SC(+$G(ORL),0)),U,3),Y=1
"RTN","ORCDRA1",40,0)
 S:CATG="I"&(TYPE'="W") SCREEN="I $P(^(0),U,3)=""W"",'$P($G(^(""OOS"")),""^"")"
"RTN","ORCDRA1",41,0)
 S:CATG="O"&(TYPE="W") SCREEN="I $P(^(0),U,3)'=""W"",'$P($G(^(""OOS"")),""^"")"
"RTN","ORCDRA1",42,0)
 I $D(SCREEN) S Y=0,ORDIALOG($$PTR^ORCD("OR GTX LOCATION"),"S")=SCREEN
"RTN","ORCDRA1",43,0)
 Q Y
"RTN","ORCDRA1",44,0)
 ;
"RTN","ORCDRA1",45,0)
SCHEDULD() ; -- Returns 1 or 0, if patient is scheduled for pre-op
"RTN","ORCDRA1",46,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","ORCDRA1",47,0)
 I $G(ORDIALOG(PROMPT,1)) Q 1 ; don't ask - already have date
"RTN","ORCDRA1",48,0)
 S DIR(0)="YAO",DIR("A")="Is this patient scheduled for pre-op? "
"RTN","ORCDRA1",49,0)
 S DIR("B")="NO" D ^DIR S:$D(DTOUT)!($D(DUOUT)) ORQUIT=1
"RTN","ORCDRA1",50,0)
 Q +Y
"RTN","ORCDRA1",51,0)
 ;
"RTN","ORCDRA1",52,0)
MODE() ; -- Returns default mode of transport
"RTN","ORCDRA1",53,0)
 Q:$G(ORTYPE)="Z" "" N I,M,P
"RTN","ORCDRA1",54,0)
 S I=0,M=$O(^ORD(101.41,"AB","OR GTX MODIFIERS",0))
"RTN","ORCDRA1",55,0)
 S P=$O(^RAMIS(71.2,"B","PORTABLE EXAM",0))
"RTN","ORCDRA1",56,0)
 F  S I=$O(ORDIALOG(M,I)) Q:I'>0  I ORDIALOG(M,I)=P S Y="P" Q
"RTN","ORCDRA1",57,0)
 S:'$D(Y) Y=$S($G(ORWARD):"W",1:"A")
"RTN","ORCDRA1",58,0)
 Q Y
"RTN","ORCDRA1",59,0)
 ;
"RTN","ORCDRA1",60,0)
ILOC ; -- Get allowable imaging locations
"RTN","ORCDRA1",61,0)
 N ITYPE,ORY,IFN,CNT K ORDIALOG(PROMPT,"LIST")
"RTN","ORCDRA1",62,0)
 S ITYPE=$P(ORDG,U,4) D EN4^RAO7PC1(ITYPE,"ORY")
"RTN","ORCDRA1",63,0)
 S (IFN,CNT)=0 F  S IFN=$O(ORY(IFN)) Q:IFN'>0  D
"RTN","ORCDRA1",64,0)
 . S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",CNT)=ORY(IFN)_U_IFN
"RTN","ORCDRA1",65,0)
 . S ORDIALOG(PROMPT,"LIST","B",$P(ORY(IFN),U,2))=IFN
"RTN","ORCDRA1",66,0)
 S:CNT ORDIALOG(PROMPT,"LIST")=CNT_"^1",Y=+ORDIALOG(PROMPT,"LIST",1)
"RTN","ORCDRA1",67,0)
 Q
"RTN","ORCDRA1",68,0)
 ;
"RTN","ORCDRA1",69,0)
DEFLOC() ; -- Returns default imaging location
"RTN","ORCDRA1",70,0)
 N X,I S X=+$G(ORDIALOG(PROMPT,"LIST",1))
"RTN","ORCDRA1",71,0)
 I $G(ORDIV) S I=0 F  S I=$O(ORDIALOG(PROMPT,"LIST",I)) Q:I'>0  I $P(ORDIALOG(PROMPT,"LIST",I),U,3)=ORDIV S X=+ORDIALOG(PROMPT,"LIST",I) Q
"RTN","ORCDRA1",72,0)
 Q X
"RTN","ORCFLAG")
0^74^B21828604
"RTN","ORCFLAG",1,0)
ORCFLAG ; SLC/MKB - Flag orders ;6/2/97  10:44
"RTN","ORCFLAG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORCFLAG",3,0)
 ;
"RTN","ORCFLAG",4,0)
EN1(ORIFN) ; -- standalone entry point to un/flag order ORIFN
"RTN","ORCFLAG",5,0)
 N ORLK,ORERR,VA,VADM,VAERR,DFN,ORVP,ORPNM,ORSSN,ORAGE,ORACTN,ORPS
"RTN","ORCFLAG",6,0)
 Q:'$G(ORIFN)  S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";1"
"RTN","ORCFLAG",7,0)
 S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2),DFN=+ORVP I 'ORVP!'$D(^(8,+$P(ORIFN,";",2),0)) W !,"Missing or invalid order!" H 1 Q
"RTN","ORCFLAG",8,0)
 D DEM^VADPT S ORPNM=VADM(1),ORSSN=$P(VADM(2),U,2),ORAGE=VADM(4)
"RTN","ORCFLAG",9,0)
 S ORACTN=$S($G(^OR(100,+ORIFN,8,+$P(ORIFN,";",2),3)):"UF",1:"FL")
"RTN","ORCFLAG",10,0)
 I '$$VALID^ORCACT0(ORIFN,ORACTN,.ORERR) W !,ORERR H 1 Q
"RTN","ORCFLAG",11,0)
 S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 1 Q
"RTN","ORCFLAG",12,0)
 S ORACTN=$S(ORACTN="UF":"UN",1:"EN"),ORPS=1
"RTN","ORCFLAG",13,0)
 D @ORACTN,UNLK1^ORX2(+ORIFN)
"RTN","ORCFLAG",14,0)
 Q
"RTN","ORCFLAG",15,0)
 ;
"RTN","ORCFLAG",16,0)
EN ; -- Flag order ORIFN
"RTN","ORCFLAG",17,0)
 N OREASON,DA,ORB,ORNP,ORNOW S ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCFLAG",18,0)
 S DA=$P(ORIFN,";",2) I 'DA W !,"Unable to flag!" H 1 Q
"RTN","ORCFLAG",19,0)
 S OREASON=$$REASON Q:OREASON="^"
"RTN","ORCFLAG",20,0)
 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3),ORNP=$$PROV(ORNP) Q:ORNP="^"
"RTN","ORCFLAG",21,0)
 D BULLETIN ;use ORNP?
"RTN","ORCFLAG",22,0)
 K ^OR(100,+ORIFN,8,DA,3) S ^(3)="1^"_$G(XMZ)_U_ORNOW_U_DUZ_U_OREASON_"^^^^"_ORNP
"RTN","ORCFLAG",23,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT,OREBUILD=1 ; Last Activity
"RTN","ORCFLAG",24,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^1" D EN^OCXOERR(ORB) ; notification
"RTN","ORCFLAG",25,0)
 W !?10,"... order flagged." H 1 D KILL^XM,MSG(ORIFN)
"RTN","ORCFLAG",26,0)
 Q
"RTN","ORCFLAG",27,0)
 ;
"RTN","ORCFLAG",28,0)
UN ; -- Unflag order ORIFN
"RTN","ORCFLAG",29,0)
 N OREASON,DA,ORB,ORNP,ORNOW S ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCFLAG",30,0)
 S DA=$P(ORIFN,";",2) I 'DA W !,"Unable to unflag order!" H 1 Q
"RTN","ORCFLAG",31,0)
 D SHOWFLAG S OREASON=$$COMMENT Q:OREASON="^"
"RTN","ORCFLAG",32,0)
 S $P(^OR(100,+ORIFN,8,DA,3),U)=0,$P(^(3),U,6,8)=ORNOW_U_DUZ_U_OREASON
"RTN","ORCFLAG",33,0)
 S ORNP=+$P(^OR(100,+ORIFN,8,DA,3),U,9) S:'ORNP ORNP=+$P($G(^(0)),U,3)
"RTN","ORCFLAG",34,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^0" D EN^OCXOERR(ORB) ; notification
"RTN","ORCFLAG",35,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT,OREBUILD=1 ; Last Activity
"RTN","ORCFLAG",36,0)
 W !?10,"... order unflagged." H 1 D MSG(ORIFN)
"RTN","ORCFLAG",37,0)
 Q
"RTN","ORCFLAG",38,0)
 ;
"RTN","ORCFLAG",39,0)
SHOWFLAG ; -- Display [last] flag for order ORIFN
"RTN","ORCFLAG",40,0)
 N FLAG
"RTN","ORCFLAG",41,0)
 S FLAG=$G(^OR(100,+ORIFN,8,DA,3))
"RTN","ORCFLAG",42,0)
 W !," FLAGGED: "_$$LTIM($P(FLAG,U,3))_" by "_$P($G(^VA(200,+$P(FLAG,U,4),0)),U)
"RTN","ORCFLAG",43,0)
 W !?10,$P(FLAG,U,5) ; reason
"RTN","ORCFLAG",44,0)
 Q
"RTN","ORCFLAG",45,0)
 ;
"RTN","ORCFLAG",46,0)
REASON() ; -- Reason for flag
"RTN","ORCFLAG",47,0)
 N X,Y,DIR
"RTN","ORCFLAG",48,0)
 S DIR(0)="FA^1:80",DIR("A")="REASON FOR FLAG: " ; ck E3R
"RTN","ORCFLAG",49,0)
 S DIR("?")="A reason must be entered to flag this order."
"RTN","ORCFLAG",50,0)
 D ^DIR
"RTN","ORCFLAG",51,0)
 Q Y
"RTN","ORCFLAG",52,0)
 ;
"RTN","ORCFLAG",53,0)
COMMENT() ; -- Comments on unflag
"RTN","ORCFLAG",54,0)
 N X,Y,DIR
"RTN","ORCFLAG",55,0)
 S DIR(0)="FAO^1:80",DIR("A")="COMMENTS: "
"RTN","ORCFLAG",56,0)
 S DIR("?")="A comment may be entered to clarify this order."
"RTN","ORCFLAG",57,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","ORCFLAG",58,0)
 Q Y
"RTN","ORCFLAG",59,0)
 ;
"RTN","ORCFLAG",60,0)
PROV(ORDR) ; -- Get provider to alert
"RTN","ORCFLAG",61,0)
 N X,Y,DIC
"RTN","ORCFLAG",62,0)
 S DIC=200,DIC(0)="AEQM",DIC("A")="Send alert to: "
"RTN","ORCFLAG",63,0)
 I $G(ORDR) S ORDR=$P($G(^VA(200,+ORDR,0)),U) S:$L(ORDR) DIC("B")=ORDR
"RTN","ORCFLAG",64,0)
 S DIC("S")="N ORT S ORT=$P(^(0),U,11) I 'ORT!(ORT>DT)"
"RTN","ORCFLAG",65,0)
 D ^DIC S:Y>0 Y=+Y I Y'>0 S Y="^"
"RTN","ORCFLAG",66,0)
 Q Y
"RTN","ORCFLAG",67,0)
 ;
"RTN","ORCFLAG",68,0)
BULLETIN ; -- Send bulletin re: flag
"RTN","ORCFLAG",69,0)
 N OR0,OR3,ORDTXT,XMB,XMY,XMDUZ,ORENT,BULL,ORSRV,ORUSR
"RTN","ORCFLAG",70,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)) ;ORUSR=+$P(OR0,U,4)
"RTN","ORCFLAG",71,0)
 S ORUSR=+$G(ORNP),ORSRV=+$P($G(^VA(200,ORUSR,5)),U)
"RTN","ORCFLAG",72,0)
 S ORENT="USR.`"_ORUSR_"^SRV.`"_ORSRV_"^DIV^SYS^PKG"
"RTN","ORCFLAG",73,0)
 S BULL=$$GET^XPAR(ORENT,"ORB FLAGGED ORDERS BULLETIN",1,"Q")
"RTN","ORCFLAG",74,0)
 Q:$G(BULL)'="Y"   ;quit if parameter value is not 'Y'es
"RTN","ORCFLAG",75,0)
 ;
"RTN","ORCFLAG",76,0)
 W !,"Sending bulletin to "_$P($G(^VA(200,ORUSR,0)),U)_"..."
"RTN","ORCFLAG",77,0)
 S XMB="OR FLAGGED ORDER",XMDUZ=DUZ,XMY(ORUSR)=""
"RTN","ORCFLAG",78,0)
 S XMB(1)=ORPNM,XMB(2)=ORSSN,XMB(3)=ORAGE,XMB(4)=$$LTIM($P(OR0,U,7))
"RTN","ORCFLAG",79,0)
 D TEXT^ORQ12(.ORDTXT,+ORIFN,80)
"RTN","ORCFLAG",80,0)
 S XMB(5)=$G(ORDTXT(1)),XMB(6)=$G(ORDTXT(2)),XMB(7)=$G(ORDTXT(3))
"RTN","ORCFLAG",81,0)
 S XMB(8)=$$LTIM($P(OR0,U,8)),XMB(9)=$$LTIM($P(OR0,U,9)),XMB(10)=OREASON
"RTN","ORCFLAG",82,0)
 S XMB(11)=$P($G(^ORD(100.01,+$P(OR3,U,3),0)),U)
"RTN","ORCFLAG",83,0)
 D EN^XMB
"RTN","ORCFLAG",84,0)
 Q
"RTN","ORCFLAG",85,0)
 ;
"RTN","ORCFLAG",86,0)
LTIM(X) ; -- format FM date/time into MM/DD HH:MM
"RTN","ORCFLAG",87,0)
 N Y S Y=""
"RTN","ORCFLAG",88,0)
 S:X Y=$E(X,4,5)_"/"_$E(X,6,7)
"RTN","ORCFLAG",89,0)
 S:X["." Y=Y_" "_$E(X_"0",9,10)_":"_$E(X_"000",11,12)
"RTN","ORCFLAG",90,0)
 Q Y
"RTN","ORCFLAG",91,0)
 ;
"RTN","ORCFLAG",92,0)
MSG(ORDER)      ; -- Sends HL7 message to Pharmacy when order is un/flagged
"RTN","ORCFLAG",93,0)
 Q:'$L($T(OBR^PSJHL4))  ;needs PSJ*5*85
"RTN","ORCFLAG",94,0)
 Q:'$G(ORDER)  Q:'$D(^OR(100,+ORDER,0))  Q:'$P(ORDER,";",2)
"RTN","ORCFLAG",95,0)
 N OR0,OR3,ORMSG,ORVP,ORX,ORFLAG
"RTN","ORCFLAG",96,0)
 S OR0=$G(^OR(100,+ORDER,0)),OR3=$G(^(8,+$P(ORDER,";",2),3))
"RTN","ORCFLAG",97,0)
 Q:"^PSJ^PSIV^"'[(U_$$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)_U)  ;Inpt or IV
"RTN","ORCFLAG",98,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORU","PS")
"RTN","ORCFLAG",99,0)
 S ORVP=$P(OR0,U,2),ORMSG(2)=$$PID^ORMBLD(ORVP)
"RTN","ORCFLAG",100,0)
 S ORMSG(3)=$$PV1^ORMBLD(ORVP,$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORCFLAG",101,0)
 S ORX=$S(OR3:$P(OR3,U,3,5),1:$P(OR3,U,6,8))
"RTN","ORCFLAG",102,0)
 S ORFLAG=$S(OR3:"FL",1:"UF")_"|||"_$$HL7DATE^ORMBLD($P(ORX,U))_"||||||"_$P(ORX,U,3)_"|||"_+$P(ORX,U,2)
"RTN","ORCFLAG",103,0)
 S:$G(ORPS) ORFLAG=ORFLAG_"||||||||PHR" ;action taken by pharmacist
"RTN","ORCFLAG",104,0)
 S ORMSG(4)="OBR|1|"_ORDER_"^OR|"_$G(^OR(100,+ORDER,4))_"^PS|"_ORFLAG
"RTN","ORCFLAG",105,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORCFLAG",106,0)
 Q
"RTN","ORCHANG2")
0^14^B26765487
"RTN","ORCHANG2",1,0)
ORCHANG2 ;SLC/MKB-Change View status ; 08 May 2002  2:12 PM
"RTN","ORCHANG2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,72,68,141**;Dec 17, 1997
"RTN","ORCHANG2",3,0)
ORDERS ; -- Select new order status
"RTN","ORCHANG2",4,0)
 N X,Y,HDR,I,DOMAIN,DEFAULT,PROMPT,HELP,STS
"RTN","ORCHANG2",5,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),DEFAULT=""
"RTN","ORCHANG2",6,0)
 F I=1:1 S X=$T(ORDSTS+I) Q:$P(X,";",4)="ZZZZ"  D SET
"RTN","ORCHANG2",7,0)
 S DOMAIN(0)=I-1,PROMPT="Select Order Status: "
"RTN","ORCHANG2",8,0)
 S HELP="Enter the status of orders you wish to see listed here."
"RTN","ORCHANG2",9,0)
 D EN Q:Y="^"  S STS=+$G(DOMAIN(Y))
"RTN","ORCHANG2",10,0)
 I "^8^9^10^20^"[(U_STS_U) D  Q:Y="^"
"RTN","ORCHANG2",11,0)
 . N STRT,STOP,Z
"RTN","ORCHANG2",12,0)
 . S STRT=$$START^ORCHANGE("NOW-24H") I STRT="^" S Y="^" Q
"RTN","ORCHANG2",13,0)
 . S STOP=$$STOP^ORCHANGE("NOW") I STOP="^" S Y="^" Q
"RTN","ORCHANG2",14,0)
 . I STOP<STRT S Z=STRT,STRT=STOP,STOP=Z
"RTN","ORCHANG2",15,0)
 . S $P(HDR,";",1,2)=$P(STRT,U,2)_";"_$P(STOP,U,2)
"RTN","ORCHANG2",16,0)
 S $P(HDR,";",3)=STS,$P(HDR,";",8)="" S:STS=2 $P(HDR,";",1,2)=";"
"RTN","ORCHANG2",17,0)
 I STS=6,$P(HDR,";")="" S $P(HDR,";",1,2)="T;T@23:59"
"RTN","ORCHANG2",18,0)
 S $P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANG2",19,0)
 Q
"RTN","ORCHANG2",20,0)
 ;
"RTN","ORCHANG2",21,0)
STSLST(ORY)     ; -- Returns array of order views as 
"RTN","ORCHANG2",22,0)
 ;            ORY(n) = id ^ name ^ parent id [^+ if has members]
"RTN","ORCHANG2",23,0)
 N I,X,CNT S CNT=0
"RTN","ORCHANG2",24,0)
 F I=1:1 S X=$T(ORDSTS+I) Q:$P(X,";",4)="ZZZZ"  S CNT=CNT+1,ORY(CNT)=$TR($P(X,";",3,6),";","^")
"RTN","ORCHANG2",25,0)
 ; include specific patient events??
"RTN","ORCHANG2",26,0)
 Q
"RTN","ORCHANG2",27,0)
 ;
"RTN","ORCHANG2",28,0)
ORDSTS ;;#;Name of Order Context
"RTN","ORCHANG2",29,0)
 ;;1;All;0;+
"RTN","ORCHANG2",30,0)
 ;;2;Active (includes pending, recent activity);1
"RTN","ORCHANG2",31,0)
 ;;23;Current (Active & Pending status only);1
"RTN","ORCHANG2",32,0)
 ;;3;Discontinued;1
"RTN","ORCHANG2",33,0)
 ;;4;Completed/Expired;1
"RTN","ORCHANG2",34,0)
 ;;5;Expiring;1
"RTN","ORCHANG2",35,0)
 ;;7;Pending;1
"RTN","ORCHANG2",36,0)
 ;;18;On Hold;1
"RTN","ORCHANG2",37,0)
 ;;19;New Orders;1
"RTN","ORCHANG2",38,0)
 ;;11;Unsigned;1
"RTN","ORCHANG2",39,0)
 ;;8;Unverified by anyone;1;+
"RTN","ORCHANG2",40,0)
 ;;9;Unverified by Nursing;8
"RTN","ORCHANG2",41,0)
 ;;10;Unverified by Clerk;8
"RTN","ORCHANG2",42,0)
 ;;20;Unverified/Chart Review;8
"RTN","ORCHANG2",43,0)
 ;;13;Verbal/Phoned;1;+
"RTN","ORCHANG2",44,0)
 ;;14;Verbal/Phoned unsigned;13
"RTN","ORCHANG2",45,0)
 ;;12;Flagged;1
"RTN","ORCHANG2",46,0)
 ;;6;Recent Activity (defaults to today's orders);1
"RTN","ORCHANG2",47,0)
 ;;24;Delayed (all events);1;+
"RTN","ORCHANG2",48,0)
 ;;15;Delayed Admission;24
"RTN","ORCHANG2",49,0)
 ;;17;Delayed Transfer;24
"RTN","ORCHANG2",50,0)
 ;;16;Delayed Discharge;24
"RTN","ORCHANG2",51,0)
 ;;25;Delayed Return from O.R.;24
"RTN","ORCHANG2",52,0)
 ;;26;Delayed for Manual Release;24
"RTN","ORCHANG2",53,0)
 ;;22;Lapsed (never processed);1
"RTN","ORCHANG2",54,0)
 ;;;ZZZZ
"RTN","ORCHANG2",55,0)
 ;
"RTN","ORCHANG2",56,0)
STS ; -- Select new [order or consult] status
"RTN","ORCHANG2",57,0)
 N HDR,DEFAULT,DOMAIN,PROMPT,HELP,X,Y,I
"RTN","ORCHANG2",58,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),DEFAULT=""
"RTN","ORCHANG2",59,0)
 S (I,Y)=0 F  S I=$O(^ORD(100.01,I)) Q:I'>0  Q:I=99  S X=$G(^(I,0)) D
"RTN","ORCHANG2",60,0)
 . Q:"^1^2^5^6^8^9^13^"'[(U_I_U)  S Y=Y+1
"RTN","ORCHANG2",61,0)
 . S DOMAIN(Y)=I_U_$$LOWER^VALM1($P(X,U)),DOMAIN("B",$P(X,U))=Y
"RTN","ORCHANG2",62,0)
 . S:I=$P(HDR,";",3) DEFAULT=$P(DOMAIN(Y),U,2)
"RTN","ORCHANG2",63,0)
 S Y=Y+1,DOMAIN(Y)="^All Statuses",DOMAIN("B","ALL STATUSES")=Y
"RTN","ORCHANG2",64,0)
 S DOMAIN(0)=Y,PROMPT="Select Consult Status: "
"RTN","ORCHANG2",65,0)
 S HELP="Enter the status of consults you wish to see listed here."
"RTN","ORCHANG2",66,0)
 D EN Q:Y="^"
"RTN","ORCHANG2",67,0)
 S $P(HDR,";",3)=$P(DOMAIN(Y),U),$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANG2",68,0)
 Q
"RTN","ORCHANG2",69,0)
 ;
"RTN","ORCHANG2",70,0)
TIU ; -- Select new document status
"RTN","ORCHANG2",71,0)
 N X,Y,ORY,I,CNT,HDR,DOMAIN,DEFAULT,PROMPT,HELP
"RTN","ORCHANG2",72,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),DEFAULT=$P(HDR,";",3)
"RTN","ORCHANG2",73,0)
 D STATUS^TIUSRVL(.ORY)
"RTN","ORCHANG2",74,0)
 S (I,CNT)=0 F  S I=$O(ORY(I)) Q:I'>0  S CNT=CNT+1,DOMAIN(CNT)=ORY(I),DOMAIN("B",$$UP^XLFSTR($P(ORY(I),U,2)))=CNT
"RTN","ORCHANG2",75,0)
 S DOMAIN(0)=CNT,PROMPT="Select Signature Status: "
"RTN","ORCHANG2",76,0)
 S HELP="Enter the signature status you would like to screen on"
"RTN","ORCHANG2",77,0)
 D EN Q:Y="^"
"RTN","ORCHANG2",78,0)
 S $P(HDR,";",3)=$P(DOMAIN(Y),U,2),$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANG2",79,0)
 Q
"RTN","ORCHANG2",80,0)
 ;
"RTN","ORCHANG2",81,0)
PLIST ; -- Select problem status
"RTN","ORCHANG2",82,0)
 N X,Y,HDR,I,ID,NAME,DOMAIN,DEFAULT,PROMPT,HELP
"RTN","ORCHANG2",83,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3)
"RTN","ORCHANG2",84,0)
 F I=1:1 S X=$T(PLSTS+I) Q:$P(X,";",4)="ZZZZ"  D SET
"RTN","ORCHANG2",85,0)
 S DOMAIN(0)=I-1,PROMPT="Select Problem Status: "
"RTN","ORCHANG2",86,0)
 S HELP="Enter the status of the problems you wish to see listed here."
"RTN","ORCHANG2",87,0)
 D EN Q:Y="^"
"RTN","ORCHANG2",88,0)
 S $P(HDR,";",3)=$P(DOMAIN(Y),U),$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANG2",89,0)
 Q
"RTN","ORCHANG2",90,0)
 ;
"RTN","ORCHANG2",91,0)
PLSTS ;;I;name
"RTN","ORCHANG2",92,0)
 ;;A;active
"RTN","ORCHANG2",93,0)
 ;;I;inactive
"RTN","ORCHANG2",94,0)
 ;;B;both active & inactive
"RTN","ORCHANG2",95,0)
 ;;;ZZZZ
"RTN","ORCHANG2",96,0)
 ;
"RTN","ORCHANG2",97,0)
SET ; -- set DOMAIN(I)=ID^NAME, DEFAULT from X=";;ID;NAME"
"RTN","ORCHANG2",98,0)
 N ID,NAME
"RTN","ORCHANG2",99,0)
 S ID=$P(X,";",3),NAME=$P(X,";",4)
"RTN","ORCHANG2",100,0)
 S DOMAIN(I)=ID_U_NAME,DOMAIN("B",$$UP^XLFSTR(NAME))=I
"RTN","ORCHANG2",101,0)
 S:ID=$P(HDR,";",3) DEFAULT=NAME
"RTN","ORCHANG2",102,0)
 Q
"RTN","ORCHANG2",103,0)
 ;
"RTN","ORCHANG2",104,0)
EN ; -- Select new status via DOMAIN(), PROMPT, DEFAULT, HELP
"RTN","ORCHANG2",105,0)
 N DONE S DONE=0,Y="" F  D  Q:DONE
"RTN","ORCHANG2",106,0)
 . W !,PROMPT_$S($L(DEFAULT):DEFAULT_"//",1:"")
"RTN","ORCHANG2",107,0)
 . R X:DTIME S:'$T X="^" I X["^" S Y="^",DONE=1 Q
"RTN","ORCHANG2",108,0)
 . S:X="" X=DEFAULT I X="" S Y="^",DONE=1 Q
"RTN","ORCHANG2",109,0)
 . I X["?" W !!,HELP D LIST Q
"RTN","ORCHANG2",110,0)
 . D  I 'Y W $C(7),!,HELP Q
"RTN","ORCHANG2",111,0)
 . . N XP,XY,CNT,MATCH,DIR,I
"RTN","ORCHANG2",112,0)
 . . S X=$$UP^XLFSTR(X),Y=+$G(DOMAIN("B",X)) Q:Y  ; done
"RTN","ORCHANG2",113,0)
 . . S CNT=0,XP=X F  S XP=$O(DOMAIN("B",XP)) Q:XP=""  Q:$E(XP,1,$L(X))'=X  S CNT=CNT+1,XY=+DOMAIN("B",XP),MATCH(CNT)=XY_U_$P(DOMAIN(XY),U,2)
"RTN","ORCHANG2",114,0)
 . . Q:'CNT
"RTN","ORCHANG2",115,0)
 . . I CNT=1 S Y=+MATCH(1),XP=$P(MATCH(1),U,2) W $E(XP,$L(X)+1,$L(XP)) Q
"RTN","ORCHANG2",116,0)
 . . S DIR(0)="NAO^1:"_CNT,DIR("A")="Select 1-"_CNT_": "
"RTN","ORCHANG2",117,0)
 . . F I=1:1:CNT S DIR("A",I)=$J(I,3)_" "_$P(MATCH(I),U,2)
"RTN","ORCHANG2",118,0)
 . . S DIR("?")="Select the desired value, by number"
"RTN","ORCHANG2",119,0)
 . . I CNT>3 D FULL^VALM1 S VALMBCK="R" ;need to scroll
"RTN","ORCHANG2",120,0)
 . . D ^DIR I $D(DIRUT) S Y="" Q
"RTN","ORCHANG2",121,0)
 . . S Y=+MATCH(Y) W "  "_$P(DOMAIN(Y),U,2)
"RTN","ORCHANG2",122,0)
 . S DONE=1
"RTN","ORCHANG2",123,0)
 Q
"RTN","ORCHANG2",124,0)
 ;
"RTN","ORCHANG2",125,0)
LIST ; -- List order statuses in DOMAIN
"RTN","ORCHANG2",126,0)
 N I,Z,CNT,DONE D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANG2",127,0)
 S CNT=0 W !,"Choose from:"
"RTN","ORCHANG2",128,0)
 F I=1:1:DOMAIN(0) D  Q:$G(DONE)
"RTN","ORCHANG2",129,0)
 . S CNT=CNT+1 W ! I CNT>(IOSL-3) D  Q:$G(DONE)
"RTN","ORCHANG2",130,0)
 .. W ?3,"'^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1 S CNT=1
"RTN","ORCHANG2",131,0)
 . W $C(13),"  "_$P(DOMAIN(I),U,2)
"RTN","ORCHANG2",132,0)
 Q
"RTN","ORCHANG3")
0^15^B6280279
"RTN","ORCHANG3",1,0)
ORCHANG3        ;SLC/MKB - Change view by event ; 08 May 2002  2:12 PM
"RTN","ORCHANG3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORCHANG3",3,0)
 ;
"RTN","ORCHANG3",4,0)
EVT ; -- Select new event
"RTN","ORCHANG3",5,0)
 N X,Y,HDR,DOMAIN,DEFAULT,I,PROMPT,HELP,EVT
"RTN","ORCHANG3",6,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),DEFAULT=""
"RTN","ORCHANG3",7,0)
 D LIST^OREVNTX(.DOMAIN,+ORVP)
"RTN","ORCHANG3",8,0)
 I $G(DOMAIN(0))<1 W !,"No events available for this patient.",! H 1 Q
"RTN","ORCHANG3",9,0)
 F I=1:1:DOMAIN(0) S X=$P(DOMAIN(I),U,2)_"  "_$$FMTE^XLFDT($P(DOMAIN(I),U,3),"2P"),DOMAIN("B",$$UP^XLFSTR(X))=I
"RTN","ORCHANG3",10,0)
 S PROMPT="Select Patient Event: "
"RTN","ORCHANG3",11,0)
 S HELP="Enter the event whose orders you wish to see listed here."
"RTN","ORCHANG3",12,0)
 D EN Q:Y="^"  S EVT=+$G(DOMAIN(Y))
"RTN","ORCHANG3",13,0)
 S:EVT $P(HDR,";",3)="",$P(HDR,";",8)=EVT,DEFAULT=""
"RTN","ORCHANG3",14,0)
 I EVT<1,'$P(HDR,";",3) S DEFAULT=1
"RTN","ORCHANG3",15,0)
 S $P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U_DEFAULT
"RTN","ORCHANG3",16,0)
 Q
"RTN","ORCHANG3",17,0)
 ;
"RTN","ORCHANG3",18,0)
EN ; -- Select new event via DOMAIN(), PROMPT, DEFAULT, HELP
"RTN","ORCHANG3",19,0)
 N DONE S DONE=0,Y="" F  D  Q:DONE
"RTN","ORCHANG3",20,0)
 . W !,PROMPT_$S($L(DEFAULT):DEFAULT_"//",1:"")
"RTN","ORCHANG3",21,0)
 . R X:DTIME S:'$T X="^" I X["^" S Y="^",DONE=1 Q
"RTN","ORCHANG3",22,0)
 . S:X="" X=DEFAULT I X="" S Y="^",DONE=1 Q
"RTN","ORCHANG3",23,0)
 . I X="@" S Y="",DONE=1 Q
"RTN","ORCHANG3",24,0)
 . I X["?" W !!,HELP D LIST Q
"RTN","ORCHANG3",25,0)
 . D  I 'Y W $C(7),!,HELP Q
"RTN","ORCHANG3",26,0)
 . . N XP,XY,CNT,MATCH,DIR,I
"RTN","ORCHANG3",27,0)
 . . S X=$$UP^XLFSTR(X),Y=+$G(DOMAIN("B",X)) Q:Y  ; done
"RTN","ORCHANG3",28,0)
 . . S CNT=0,XP=X F  S XP=$O(DOMAIN("B",XP)) Q:XP=""  Q:$E(XP,1,$L(X))'=X  S CNT=CNT+1,XY=+DOMAIN("B",XP),MATCH(CNT)=XY_U_$P(DOMAIN(XY),U,2)
"RTN","ORCHANG3",29,0)
 . . Q:'CNT
"RTN","ORCHANG3",30,0)
 . . I CNT=1 S Y=+MATCH(1),XP=$P(MATCH(1),U,2) W $E(XP,$L(X)+1,$L(XP)) Q
"RTN","ORCHANG3",31,0)
 . . S DIR(0)="NAO^1:"_CNT,DIR("A")="Select 1-"_CNT_": "
"RTN","ORCHANG3",32,0)
 . . F I=1:1:CNT S DIR("A",I)=$J(I,3)_" "_$P(MATCH(I),U,2)
"RTN","ORCHANG3",33,0)
 . . S DIR("?")="Select the desired value, by number"
"RTN","ORCHANG3",34,0)
 . . I CNT>3 D FULL^VALM1 S VALMBCK="R" ;need to scroll
"RTN","ORCHANG3",35,0)
 . . D ^DIR I $D(DIRUT) S Y="" Q
"RTN","ORCHANG3",36,0)
 . . S Y=+MATCH(Y) W "  "_$P(DOMAIN(Y),U,2)
"RTN","ORCHANG3",37,0)
 . S DONE=1
"RTN","ORCHANG3",38,0)
 Q
"RTN","ORCHANG3",39,0)
 ;
"RTN","ORCHANG3",40,0)
LIST ; -- List order events in DOMAIN
"RTN","ORCHANG3",41,0)
 N I,Z,CNT,DONE D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANG3",42,0)
 S CNT=0 W !,"Choose from:"
"RTN","ORCHANG3",43,0)
 F I=1:1:DOMAIN(0) D  Q:$G(DONE)
"RTN","ORCHANG3",44,0)
 . S CNT=CNT+1 W ! I CNT>(IOSL-3) D  Q:$G(DONE)
"RTN","ORCHANG3",45,0)
 .. W ?3,"'^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1 S CNT=1
"RTN","ORCHANG3",46,0)
 . W $C(13),"  "_$P(DOMAIN(I),U,2)_"  "_$$FMTE^XLFDT($P(DOMAIN(I),U,3),"2P")
"RTN","ORCHANG3",47,0)
 Q
"RTN","ORCHANGE")
0^16^B40408625
"RTN","ORCHANGE",1,0)
ORCHANGE ;SLC/MKB-Change View utilities ; 08 May 2002  2:12 PM
"RTN","ORCHANGE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,72,141**;Dec 17, 1997
"RTN","ORCHANGE",3,0)
EN ; -- Change view of current list
"RTN","ORCHANGE",4,0)
 N XQORM,Y,ORI
"RTN","ORCHANGE",5,0)
 S XQORM=$G(^TMP("OR",$J,"CURRENT","CHANGE")),VALMBCK=""
"RTN","ORCHANGE",6,0)
 I 'XQORM W !!,"No other views of this list currently available" H 2 Q
"RTN","ORCHANGE",7,0)
 S Y=$S(ORTAB="NOTES"!(ORTAB="SUMMRIES"):"1\",ORTAB="ORDERS":"\",1:"")
"RTN","ORCHANGE",8,0)
 S XQORM(0)=Y_"AD" K Y
"RTN","ORCHANGE",9,0)
 S XQORM("A")=$S($L($G(^ORD(101,+XQORM,28))):^(28),1:"Select attribute(s) to change: ")
"RTN","ORCHANGE",10,0)
 D EN^XQORM S ORI=0
"RTN","ORCHANGE",11,0)
 F  S ORI=$O(Y(ORI)) Q:ORI'>0  X:$D(^ORD(101,+$P(Y(ORI),U,2),20)) ^(20)
"RTN","ORCHANGE",12,0)
 I $G(^TMP("OR",$J,"CURRENT",0))'=$G(^TMP("OR",$J,ORTAB,0)) K VALMBG D TAB^ORCHART(ORTAB,1)
"RTN","ORCHANGE",13,0)
 Q
"RTN","ORCHANGE",14,0)
 ;
"RTN","ORCHANGE",15,0)
RANGE ; -- Get new date range for list
"RTN","ORCHANGE",16,0)
 N HDR,OLD,NEW,REQ
"RTN","ORCHANGE",17,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3)
"RTN","ORCHANGE",18,0)
 S REQ=$S(ORTAB="XRAYS":1,ORTAB="REPORTS":1,1:0)
"RTN","ORCHANGE",19,0)
 I $P(HDR,";",3)=2 D  Q
"RTN","ORCHANGE",20,0)
 . N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","ORCHANGE",21,0)
 . W !,"Date range can not be selected when viewing only active orders"
"RTN","ORCHANGE",22,0)
 . S DIR(0)="E" D ^DIR
"RTN","ORCHANGE",23,0)
 S OLD=$P(HDR,";"),NEW=$$START(OLD,REQ) Q:NEW="^"  S BEG=NEW
"RTN","ORCHANGE",24,0)
 I BEG="" S END="" G RQ
"RTN","ORCHANGE",25,0)
 S OLD=$P(HDR,";",2),NEW=$$STOP(OLD,REQ) Q:NEW="^"  S END=NEW
"RTN","ORCHANGE",26,0)
 I END<BEG S NEW=END,END=BEG,BEG=NEW ; switch
"RTN","ORCHANGE",27,0)
RQ S $P(HDR,";",1,2)=$P(BEG,U,2)_";"_$P(END,U,2)
"RTN","ORCHANGE",28,0)
 S $P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANGE",29,0)
 Q
"RTN","ORCHANGE",30,0)
 ;
"RTN","ORCHANGE",31,0)
START(CURRENT,REQD) ; -- Return new beginning date
"RTN","ORCHANGE",32,0)
 N X,Y,DIR
"RTN","ORCHANGE",33,0)
 S DIR(0)="DA"_$S('$G(REQD):"O",1:"")_"^::ETX",DIR("A")="Beginning Date[/time]: "
"RTN","ORCHANGE",34,0)
 S:$L($G(CURRENT)) DIR("B")=$S(CURRENT?7N.1".".6N:$$FMTE^XLFDT(CURRENT),1:CURRENT)
"RTN","ORCHANGE",35,0)
 S DIR("?")="Enter the earliest date [and time] from which you want to see data; a null response will return all data on this patient"
"RTN","ORCHANGE",36,0)
 D ^DIR S:$D(DTOUT) Y="^" S:X="@" Y="" S:Y Y=Y_U_X
"RTN","ORCHANGE",37,0)
 Q Y
"RTN","ORCHANGE",38,0)
 ;
"RTN","ORCHANGE",39,0)
STOP(CURRENT,REQD) ; -- Return new ending date
"RTN","ORCHANGE",40,0)
 N X,Y,DIR
"RTN","ORCHANGE",41,0)
 S DIR(0)="DA"_$S('$G(REQD):"O",1:"")_"^::ETX",DIR("A")="Ending Date[/time]: "
"RTN","ORCHANGE",42,0)
 S:$L($G(CURRENT)) DIR("B")=$S(CURRENT?7N.1".".6N:$$FMTE^XLFDT(CURRENT),1:CURRENT)
"RTN","ORCHANGE",43,0)
 S DIR("?")="Enter the latest date [and time] for which you want to see data; a null response will assume TODAY"
"RTN","ORCHANGE",44,0)
 D ^DIR S:$D(DTOUT) Y="^" S:X="@" Y="" S:Y Y=Y_U_X
"RTN","ORCHANGE",45,0)
 Q Y
"RTN","ORCHANGE",46,0)
 ;
"RTN","ORCHANGE",47,0)
MAX ; -- Get new max # of items to list
"RTN","ORCHANGE",48,0)
 N X,Y,DIR
"RTN","ORCHANGE",49,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),X=$P(HDR,";",5)
"RTN","ORCHANGE",50,0)
 S DIR(0)="NAO^1:999" S:X DIR("B")=X
"RTN","ORCHANGE",51,0)
 S DIR("A")="Maximum # of items to display: "
"RTN","ORCHANGE",52,0)
 S DIR("?")="Enter the total number of items you wish to be displayed here"
"RTN","ORCHANGE",53,0)
 D ^DIR Q:'Y
"RTN","ORCHANGE",54,0)
 S $P(HDR,";",5)=Y,$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANGE",55,0)
 Q
"RTN","ORCHANGE",56,0)
 ;
"RTN","ORCHANGE",57,0)
AUTHOR(USER) ; -- Select new author of note
"RTN","ORCHANGE",58,0)
 N X,Y,DIC D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANGE",59,0)
 S DIC=200,DIC(0)="AEQM",DIC("A")="Select AUTHOR: "
"RTN","ORCHANGE",60,0)
 S:$G(USER) DIC("B")=$P($G(^VA(200,+USER,0)),U)
"RTN","ORCHANGE",61,0)
 D ^DIC S:Y'>0 Y=""
"RTN","ORCHANGE",62,0)
 Q +Y
"RTN","ORCHANGE",63,0)
 ;
"RTN","ORCHANGE",64,0)
LISTHDR ; -- List available subhdrs
"RTN","ORCHANGE",65,0)
 N HDR,DONE,CNT D FULL^VALM1
"RTN","ORCHANGE",66,0)
 W !!,"Choose from:" S HDR="",(CNT,DONE)=0,VALMBCK="R"
"RTN","ORCHANGE",67,0)
 F  S HDR=$O(^TMP("OR",$J,"CURRENT","HDR",HDR)) Q:HDR=""  D  Q:DONE
"RTN","ORCHANGE",68,0)
 . S CNT=CNT+1 I CNT>(IOSL-2) S CNT=0 I '$$MORE^ORCD S DONE=1 Q
"RTN","ORCHANGE",69,0)
 . W !,"  "_HDR
"RTN","ORCHANGE",70,0)
 Q
"RTN","ORCHANGE",71,0)
 ;
"RTN","ORCHANGE",72,0)
LRSUB ; -- Return lab subscript to jump to in list
"RTN","ORCHANGE",73,0)
 ;    Available subscripts in ^TMP("OR",$J,"IDX",name)=line #
"RTN","ORCHANGE",74,0)
 I '$D(^TMP("OR",$J,"CURRENT","HDR")) W !!,"There are no section headers defined for this report." H 3 Q
"RTN","ORCHANGE",75,0)
 N X,Y,DIR,XP,P,CNT,MATCH D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANGE",76,0)
LRS S DIR(0)="FAO^1:30",DIR("A")="Select Lab Section: "
"RTN","ORCHANGE",77,0)
 S DIR("A",1)="Available sections in this report:",X=""
"RTN","ORCHANGE",78,0)
 F I=2:1 S X=$O(^TMP("OR",$J,"CURRENT","HDR",X)) Q:X=""  S DIR("A",I)="   "_X
"RTN","ORCHANGE",79,0)
 S DIR("?")="Enter the lab section from which to wish to see results; the display will scroll to the top of the selected section" ;,DIR("??")="^D LISTHDR^ORCHANGE"
"RTN","ORCHANGE",80,0)
 D ^DIR Q:"^"[Y
"RTN","ORCHANGE",81,0)
 S XP=$$UP^XLFSTR(X)
"RTN","ORCHANGE",82,0)
 I $G(^TMP("OR",$J,"CURRENT","HDR",XP)) S VALMBG=^(XP),VALMBCK="R" Q
"RTN","ORCHANGE",83,0)
 S CNT=0,P=XP F  S P=$O(^TMP("OR",$J,"CURRENT","HDR",P)) Q:$E(P,1,$L(XP))'=XP  S CNT=CNT+1,MATCH(CNT)=+$G(^(P))_U_P ; line# ^ hdr name
"RTN","ORCHANGE",84,0)
 I 'CNT W $C(7),"  ??" G LRS
"RTN","ORCHANGE",85,0)
 I CNT=1 S VALMBG=+MATCH(CNT),VALMBCK="R",P=$P(MATCH(1),U,2) W $E(P,$L(X)+1,$L(P)) Q
"RTN","ORCHANGE",86,0)
LRS1 K DIR S DIR(0)="NAO^1:"_CNT,DIR("A")="Select 1-"_CNT_": "
"RTN","ORCHANGE",87,0)
 F I=1:1:CNT S DIR("A",I)=I_"  "_$P(MATCH(I),U,2)
"RTN","ORCHANGE",88,0)
 S DIR("?")="Select the lab section you want to go to, by number"
"RTN","ORCHANGE",89,0)
 D ^DIR Q:$D(DTOUT)!($D(DUOUT))  I 'Y K DIR G LRS
"RTN","ORCHANGE",90,0)
 S VALMBG=+MATCH(Y),VALMBCK="R"
"RTN","ORCHANGE",91,0)
 Q
"RTN","ORCHANGE",92,0)
 ;
"RTN","ORCHANGE",93,0)
DGROUP ; -- Select new service (display group)
"RTN","ORCHANGE",94,0)
 N X,Y,Z,ZZ,DIC,HDR,DONE,HELP
"RTN","ORCHANGE",95,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","ORCHANGE",96,0)
 S HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),Z=$P(HDR,";",4),ZZ=+$O(^ORD(100.98,"B",$S($L(Z):Z,1:"ALL"),0))
"RTN","ORCHANGE",97,0)
 S HELP="Enter the service or section from which you wish to see orders for this patient."
"RTN","ORCHANGE",98,0)
 S DONE=0 F  D  Q:DONE
"RTN","ORCHANGE",99,0)
 . W !!,"Select Service/Section: "_$P(^ORD(100.98,+ZZ,0),U)_"//"
"RTN","ORCHANGE",100,0)
 . R X:DTIME S:'$T X="^" I X["^" S DONE=1 Q
"RTN","ORCHANGE",101,0)
 . I X="" S DONE=1 Q  ; no change
"RTN","ORCHANGE",102,0)
 . I X["?" W !!,HELP,!,"Choose from:" D DG^ORCHANG1(1,"DISP") Q
"RTN","ORCHANGE",103,0)
 . S DIC=100.98,DIC(0)="NEQZ" D ^DIC S:Y>0 Z=$P(Y(0),U,3),ZZ=+Y,DONE=1
"RTN","ORCHANGE",104,0)
 S $P(HDR,";",4)=Z,$P(^TMP("OR",$J,ORTAB,0),U,3,4)=HDR_U
"RTN","ORCHANGE",105,0)
 Q
"RTN","ORCHANGE",106,0)
 ;
"RTN","ORCHANGE",107,0)
CS ; -- Select new consult service
"RTN","ORCHANGE",108,0)
 N GMRCDG,GMRCBUF,GMRCACT,GMRCQUT,GMRCGRP,HDR
"RTN","ORCHANGE",109,0)
 D FULL^VALM1,ASRV^GMRCASV S VALMBCK="R" Q:$D(GMRCQUT)
"RTN","ORCHANGE",110,0)
 S:$G(GMRCDG) HDR=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),$P(HDR,";",4)=GMRCDG,$P(^(0),U,3,4)=HDR_U
"RTN","ORCHANGE",111,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","ORCHANGE",112,0)
 Q
"RTN","ORCHANGE",113,0)
 ;
"RTN","ORCHANGE",114,0)
REMOVE ; -- Remove preferred view
"RTN","ORCHANGE",115,0)
 N ORDEL S ORDEL=1
"RTN","ORCHANGE",116,0)
SAVE ; -- Save current view as preferred
"RTN","ORCHANGE",117,0)
 Q:'$$OK($G(ORDEL))  N X,Y,PARAM
"RTN","ORCHANGE",118,0)
 S X=$S($G(ORDEL):"@",1:$P($G(^TMP("OR",$J,ORTAB,0)),U,3)),Y=""
"RTN","ORCHANGE",119,0)
 ;S:$G(ORTAB)="MEDS" Y=$S($P(X,";",3):"IN",1:"OUT")_"PT "
"RTN","ORCHANGE",120,0)
 S:$G(ORTAB)="LABS" Y=$S($G(ORWARD):"IN",1:"OUT")_"PT "
"RTN","ORCHANGE",121,0)
 S PARAM="ORCH CONTEXT "_Y_$G(ORTAB)
"RTN","ORCHANGE",122,0)
 D EN^XPAR("USR",PARAM,1,X) W " ...done." H 1
"RTN","ORCHANGE",123,0)
 Q
"RTN","ORCHANGE",124,0)
 ;
"RTN","ORCHANGE",125,0)
OK(DEL) ; -- Are you sure you want to save/remove view of ORTAB?
"RTN","ORCHANGE",126,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","ORCHANGE",127,0)
 S DIR("A")="Are you sure you want to "_$S($G(DEL):"remove",1:"save the current view as")_" your preference? "
"RTN","ORCHANGE",128,0)
 S:$G(DEL) DIR("?",1)="Enter YES if you wish to remove your preferred view of this chart tab and use",DIR("?")="the default view next time, or NO to quit without changing anything."
"RTN","ORCHANGE",129,0)
 S:'$G(DEL) DIR("?",1)="Enter YES if you wish to use these same parameters again the next time the ",DIR("?")=$$LOWER^VALM1(ORTAB)_" tab is created for you, or NO to quit without saving anything."
"RTN","ORCHANGE",130,0)
 D ^DIR
"RTN","ORCHANGE",131,0)
 Q +Y
"RTN","ORCHANGE",132,0)
 ;
"RTN","ORCHANGE",133,0)
RETURN ; -- Return to preferred view of ORTAB
"RTN","ORCHANGE",134,0)
 S $P(^TMP("OR",$J,ORTAB,0),U,4)=1
"RTN","ORCHANGE",135,0)
 Q
"RTN","ORCHART")
0^17^B70975123
"RTN","ORCHART",1,0)
ORCHART ;SLC/MKB-OE/RR ; 08 May 2002  2:12 PM
"RTN","ORCHART",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,70,72,92,141**;Dec 17, 1997
"RTN","ORCHART",3,0)
EN ; -- main entry point
"RTN","ORCHART",4,0)
 K ^TMP("OR",$J) ;ensure fresh start
"RTN","ORCHART",5,0)
 D EN^ORQPT Q:+$G(ORVP)'>0
"RTN","ORCHART",6,0)
 D EN^VALM("OR CHART") G:'$G(OREXIT) EN
"RTN","ORCHART",7,0)
 K OREXIT
"RTN","ORCHART",8,0)
 Q
"RTN","ORCHART",9,0)
 ;
"RTN","ORCHART",10,0)
INIT ; -- init variables and list array
"RTN","ORCHART",11,0)
 S:'$D(ORTAB) ORTAB=$$UP^XLFSTR($$GET^XPAR("ALL","ORCH INITIAL TAB",1,"E"))
"RTN","ORCHART",12,0)
 S:ORTAB="DCSUMM" ORTAB="SUMMRIES" S:'$L(ORTAB) ORTAB="COVER"
"RTN","ORCHART",13,0)
 S ORACTION=0 D TAB(ORTAB)
"RTN","ORCHART",14,0)
 Q
"RTN","ORCHART",15,0)
 ;
"RTN","ORCHART",16,0)
PHDR ; -- protocol header code
"RTN","ORCHART",17,0)
 N ORM,ORI,ORS,ORSYN K ORNMBR,OREBUILD
"RTN","ORCHART",18,0)
 S:$G(ORTAB)'="LABS" VALMSG=$$MSG D SHOW^VALM
"RTN","ORCHART",19,0)
 S:XQORM("B")="Quit" XQORM("B")=$S('$G(DGPMT):"Chart Contents",1:"Close Patient Chart")
"RTN","ORCHART",20,0)
 S:$G(^TMP("OR",$J,"CURRENT","#")) XQORM("#")=^("#")
"RTN","ORCHART",21,0)
 S ORM=$S(ORTAB="CONSULTS":+$O(^ORD(101,"B","ORC CONSULT SERVICE MENU",0)),1:+$G(XQORM("#"))),ORI=0 ;set XQORM("KEY",<synonym>)
"RTN","ORCHART",22,0)
 F  S ORI=$O(^ORD(101,ORM,10,"B",ORI)) Q:ORI'>0  I $D(^ORD(101,+ORI,2)) D
"RTN","ORCHART",23,0)
 . S ORS=0 F  S ORS=$O(^ORD(101,+ORI,2,ORS)) Q:ORS'>0  S ORSYN=$G(^(ORS,0)) S:$L(ORSYN) XQORM("KEY",ORSYN)=+ORI_"^1"
"RTN","ORCHART",24,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","ORC EXIT",0))_"^1"
"RTN","ORCHART",25,0)
 S XQORM("KEY","NEXT")=$O(^ORD(101,"B","ORC NEXT SCREEN",0))_"^1"
"RTN","ORCHART",26,0)
 S XQORM("KEY","PL")=$O(^ORD(101,"B","ORC PRINT LIST",0))_"^1"
"RTN","ORCHART",27,0)
 Q
"RTN","ORCHART",28,0)
 ;
"RTN","ORCHART",29,0)
HDR ; -- header code
"RTN","ORCHART",30,0)
 ;    Expects ORPNM, ORSSN, ORL, ORDOB, ORAGE [, ORPD]
"RTN","ORCHART",31,0)
 ;    N DFN S DFN=+ORVP D SLCT1^ORQPT if any are missing ??
"RTN","ORCHART",32,0)
 N ORX,ORX1,ORX2,ORX3,ORCWAD,L,SP K VALMHDR
"RTN","ORCHART",33,0)
 S ORX1=$P($G(^DPT(+ORVP,0)),U,3),ORX3=$$FMTE^XLFDT(ORX1,2)_"("_ORAGE_")"
"RTN","ORCHART",34,0)
 S ORX2="" I +$G(ORL) D  S:$L($G(ORL(1))) ORX2=ORX2_"/"_ORL(1)
"RTN","ORCHART",35,0)
 . S L=$G(^SC(+ORL,0)),ORX2=$P(L,U,2)
"RTN","ORCHART",36,0)
 . S:'$L(ORX2) ORX2=$E($P(L,U),1,4)
"RTN","ORCHART",37,0)
 S L=80-$L(ORPNM)-$L(ORSSN)-$L(ORX2)-$L(ORX3),SP=$$REPEAT^XLFSTR(" ",L\3)
"RTN","ORCHART",38,0)
 S ORX1=ORPNM_SP_ORSSN_SP_ORX2,VALMHDR(1)=ORX1_$J(ORX3,80-$L(ORX1))
"RTN","ORCHART",39,0)
 S ORX1=$S(ORATTEND:"Attend: "_$$LNAMEF^ORCHTAB(ORATTEND),1:"")
"RTN","ORCHART",40,0)
 S ORX2="PrimCare: "_$$LNAMEF^ORCHTAB(+$$OUTPTPR^SDUTL3(+ORVP))
"RTN","ORCHART",41,0)
 S ORX3="PCTeam: "_$P($$OUTPTTM^SDUTL3(+ORVP),U,2)
"RTN","ORCHART",42,0)
 S ORX=$S($L(ORX1):$$LJ^XLFSTR(ORX1,20),1:"")_ORX2,VALMHDR(2)=$$LJ^XLFSTR(ORX,42)_ORX3
"RTN","ORCHART",43,0)
 S ORCWAD=$$CWAD^ORQPT2(+ORVP) S:ORCWAD]"" ORCWAD="<"_ORCWAD_">"
"RTN","ORCHART",44,0)
 S ORX=$S($G(ORTAB)="COVER":"",$G(ORTAB)="REPORTS":"",1:$$VIEW),VALMHDR(3)=ORX_$J(ORCWAD,80-$L(ORX))
"RTN","ORCHART",45,0)
 Q
"RTN","ORCHART",46,0)
 ;
"RTN","ORCHART",47,0)
MSG() ; -- LMgr message bar
"RTN","ORCHART",48,0)
 Q "Enter the numbers of the items you wish to act on."
"RTN","ORCHART",49,0)
 ;
"RTN","ORCHART",50,0)
HELP ; -- help code
"RTN","ORCHART",51,0)
 N X,DX,DY D FULL^VALM1
"RTN","ORCHART",52,0)
 W !!,"Enter the display numbers of the items you wish to change or act on; a menu of",!,"available actions will then be presented for selection."
"RTN","ORCHART",53,0)
 W !!,"To see a different 'page' of the chart, enter CC; if you'd like another view of",!,"the current page, by date range for example, enter CV.  You may add new orders"
"RTN","ORCHART",54,0)
 W !,"for this patient from any page in the chart by entering AD and review them",!,"using RV.  Enter ?? to see a list of actions available for navigating the list."
"RTN","ORCHART",55,0)
 W:ORTAB="PROBLEMS" !!,"* = Acute problem",!,"$ = Unverified problem"
"RTN","ORCHART",56,0)
 W:(ORTAB="SUMMRIES")!(ORTAB="NOTES") !!,"+ = Addenda attached"
"RTN","ORCHART",57,0)
 W:(ORTAB="ORDERS")!(ORTAB="MEDS") !!,"* = Order has been updated by service"
"RTN","ORCHART",58,0)
 W:ORTAB="ORDERS" !,"+ = Sub-orders exist"
"RTN","ORCHART",59,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCHART",60,0)
 S VALMBCK="R" S:$G(ORTAB)'="LABS" VALMSG=$$MSG
"RTN","ORCHART",61,0)
 S (DX,DY)=0 X ^%ZOSF("XY")
"RTN","ORCHART",62,0)
 Q
"RTN","ORCHART",63,0)
 ;
"RTN","ORCHART",64,0)
ITEMHELP ; -- help code for action menus
"RTN","ORCHART",65,0)
 N X
"RTN","ORCHART",66,0)
 W !!,"Enter the action you wish to take on the items selected and highlighted",!,"above; each item will be processed in order, one at a time."
"RTN","ORCHART",67,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCHART",68,0)
 S X="?" D DISP^XQORM1 W !
"RTN","ORCHART",69,0)
 Q
"RTN","ORCHART",70,0)
 ;
"RTN","ORCHART",71,0)
EXIT ; -- exit code
"RTN","ORCHART",72,0)
 I $G(ORVP),$$MORE^ORCMENU2 D  ;unsig orders
"RTN","ORCHART",73,0)
 . ;I '$D(^TMP("ORNEW",$J)),'$D(^XUSEC("ORES",DUZ)) Q  ;msg like 2.5??
"RTN","ORCHART",74,0)
 . W !!,"You have new or unsigned orders for this patient!" H 1
"RTN","ORCHART",75,0)
 . S ORRV=1 D EN1^ORCMENU2,NOTIF^ORCMENU2 ;sign, notif if not all signed
"RTN","ORCHART",76,0)
 D UNLOCK^ORX2(+ORVP) K ^TMP("OR",$J),^TMP("ORNEW",$J),^TMP("LRRR",$J)
"RTN","ORCHART",77,0)
 K VALMCNT,VALMHDR,VALMBG,ORQUIT,ORVP,ORSEX,ORTAB,ORPNM,ORSSN,ORL,ORDOB,ORAGE,ORPD,ORNP,ORSC,ORTS,ORWARD,ORATTEND,ORNMBR,ORACTION,OREBUILD,OREBLD,ORRV,OREVENT
"RTN","ORCHART",78,0)
 Q
"RTN","ORCHART",79,0)
 ;
"RTN","ORCHART",80,0)
TAB(NEWTAB,REBUILD) ; -- switch focus to new chart tab from ORTAB
"RTN","ORCHART",81,0)
 S VALMBCK="",VALMBG=$S($G(ORTAB)'=NEWTAB:1,'$G(VALMBG):1,1:VALMBG)
"RTN","ORCHART",82,0)
 S ORTAB=NEWTAB I '$G(^TMP("OR",$J,ORTAB,0))!($G(REBUILD)) D
"RTN","ORCHART",83,0)
 . W !,"Searching the patient's chart ..."
"RTN","ORCHART",84,0)
 . D FULL^VALM1,EN^ORCHTAB ; [re]build list
"RTN","ORCHART",85,0)
 D CLEAN^VALM10 M ^TMP("OR",$J,"CURRENT")=^TMP("OR",$J,ORTAB)
"RTN","ORCHART",86,0)
 M ^TMP("VALM VIDEO",$J,VALMEVL)=^TMP("OR",$J,"CURRENT","VIDEO")
"RTN","ORCHART",87,0)
 I $D(^TMP("OR",$J,"CURRENT","CAPTION")) D
"RTN","ORCHART",88,0)
 . N FLD,LBL S FLD=""
"RTN","ORCHART",89,0)
 . F  S FLD=$O(^TMP("OR",$J,"CURRENT","CAPTION",FLD)) Q:FLD=""  S LBL=$G(^(FLD)) D CHGCAP^VALM(FLD,LBL)
"RTN","ORCHART",90,0)
 S VALM("TITLE")=$G(^TMP("OR",$J,"CURRENT","TITLE")),VALM("RM")=^("RM")
"RTN","ORCHART",91,0)
 S:$D(^TMP("OR",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","ORCHART",92,0)
 S VALMCNT=+$G(^TMP("OR",$J,"CURRENT",0)),VALMLFT=$P(VALMDDF("DATA"),U,2)
"RTN","ORCHART",93,0)
 D HDR S VALMBCK="R" ; reset VALMHDR nodes
"RTN","ORCHART",94,0)
 Q
"RTN","ORCHART",95,0)
 ;
"RTN","ORCHART",96,0)
NEWPAT ; -- Select new patient
"RTN","ORCHART",97,0)
 I $$MORE^ORCMENU2 D  ;unsigned orders
"RTN","ORCHART",98,0)
 . ;I '$D(^TMP("ORNEW",$J)),'$D(^XUSEC("ORES",DUZ)) Q
"RTN","ORCHART",99,0)
 . W !!,"You have new or unsigned orders for this patient!" H 1
"RTN","ORCHART",100,0)
 . S ORRV=1 D EN1^ORCMENU2,NOTIF^ORCMENU2 ;sign, notif if not all signed
"RTN","ORCHART",101,0)
 N TAB,OLD,T,ORT,CTXT K ORRV S OLD=+ORVP,TAB=ORTAB
"RTN","ORCHART",102,0)
 D EN^ORQPT I OLD=+ORVP S VALMBCK="R" D:$G(OREBUILD) REBLD^ORCMENU K OREBUILD Q  ; no change
"RTN","ORCHART",103,0)
 S T="" F  S T=$O(^TMP("OR",$J,T)) Q:T=""  D
"RTN","ORCHART",104,0)
 . I T="MEDS" K ^TMP("OR",$J,T) Q
"RTN","ORCHART",105,0)
 . S CTXT=$P($G(^TMP("OR",$J,T,0)),U,3) S:$L(CTXT) ORT(T,0)="^^"_$S(T="NOTES"&($P(CTXT,";",3)=1):"",1:CTXT)_U_$P(^(0),U,4) ; save tab contexts
"RTN","ORCHART",106,0)
 D UNLOCK^ORX2(+ORVP) K ^TMP("OR",$J),^TMP("ORNEW",$J),^TMP("LRRR",$J)
"RTN","ORCHART",107,0)
 K VALMHDR,ORTAB,ORNEW,OREBUILD,OREBLD
"RTN","ORCHART",108,0)
 M ^TMP("OR",$J)=ORT D TAB(TAB) S VALMBCK="R"
"RTN","ORCHART",109,0)
 Q
"RTN","ORCHART",110,0)
 ;
"RTN","ORCHART",111,0)
ORDERS(ACTION) ; -- Return order numbers to act on, if action chosen first
"RTN","ORCHART",112,0)
 N X,Y,DIR,MAX S:'$L($G(ACTION)) ACTION="act on"
"RTN","ORCHART",113,0)
 S MAX=+$P($G(^TMP("OR",$J,ORTAB,0)),U,2) Q:MAX'>0 "^"
"RTN","ORCHART",114,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select item(s): " S:MAX=1 DIR("B")=1
"RTN","ORCHART",115,0)
 S DIR("?")="Enter the items you wish to "_ACTION_", as a range or list of numbers"
"RTN","ORCHART",116,0)
 D ^DIR S:$D(DTOUT)!(Y="") Y="^"
"RTN","ORCHART",117,0)
 Q Y
"RTN","ORCHART",118,0)
 ;
"RTN","ORCHART",119,0)
ALL ; -- Return all items on ORTAB
"RTN","ORCHART",120,0)
 N X,Y,DIR,MAX
"RTN","ORCHART",121,0)
 S MAX=+$P($G(^TMP("OR",$J,ORTAB,0)),U,2) Q:MAX'>0 ""
"RTN","ORCHART",122,0)
 S DIR(0)="L^1:"_MAX,DIR("V")="",X="1-"_MAX D ^DIR
"RTN","ORCHART",123,0)
 Q Y
"RTN","ORCHART",124,0)
 ;
"RTN","ORCHART",125,0)
SELECT(NMBR) ; -- rev video on selected items
"RTN","ORCHART",126,0)
 N ORI,ORJ,NUM,ROW,ROWS,VALID S VALID=0
"RTN","ORCHART",127,0)
 F ORI=1:1:$L(NMBR,",") S NUM=$P(NMBR,",",ORI) I NUM D
"RTN","ORCHART",128,0)
 . I '$L($P($G(@VALMAR@("IDX",NUM)),U)) W !,NUM_" is not a valid selection." H 2 Q
"RTN","ORCHART",129,0)
 . S VALID=1
"RTN","ORCHART",130,0)
 . S ROW=$P(@VALMAR@("IDX",NUM),U,2),ROWS=$P(^(NUM),U,3)
"RTN","ORCHART",131,0)
 . F ORJ=ROW:1:(ROW+ROWS-1) I ORJ'<VALMBG,ORJ'>(VALMBG+VALM("LINES")-1) D
"RTN","ORCHART",132,0)
 . . K ^TMP("VALM VIDEO",$J,VALMEVL,ORJ)
"RTN","ORCHART",133,0)
 . . D CNTRL^VALM10(ORJ,1,80,IORVON,IORVOFF)
"RTN","ORCHART",134,0)
 . . D WRITE^VALM10(ORJ)
"RTN","ORCHART",135,0)
 I 'VALID S XQORQUIT=1
"RTN","ORCHART",136,0)
 Q
"RTN","ORCHART",137,0)
 ;
"RTN","ORCHART",138,0)
DESELECT(NMBR) ; -- norm video on selected items
"RTN","ORCHART",139,0)
 N ORI,ORJ,NUM,IFN,ROW,ROWS,ON,OFF,I,IDX
"RTN","ORCHART",140,0)
 F ORI=1:1:$L(NMBR,",") S NUM=$P(NMBR,",",ORI) I NUM D
"RTN","ORCHART",141,0)
 . S IDX=$G(@VALMAR@("IDX",NUM)) Q:'$L(IDX)  ;invalid NUM
"RTN","ORCHART",142,0)
 . S IFN=$P(IDX,U),ROW=$P(IDX,U,2),ROWS=$P(IDX,U,3)
"RTN","ORCHART",143,0)
 . F ORJ=ROW:1:(ROW+ROWS-1) I ORJ'<VALMBG,ORJ'>(VALMBG+VALM("LINES")-1) D
"RTN","ORCHART",144,0)
 . . K ^TMP("VALM VIDEO",$J,VALMEVL,ORJ) Q:'$L(IFN)  ;deleted
"RTN","ORCHART",145,0)
 . . S ON=IOINHI,OFF=IOINORM
"RTN","ORCHART",146,0)
 . . I ORTAB="ORDERS",$G(^OR(100,+IFN,8,+$P(IFN,";",2),3)) S ON=IORVON,OFF=IORVOFF ; flagged
"RTN","ORCHART",147,0)
 . . D CNTRL^VALM10(ORJ,1,5,ON,OFF)
"RTN","ORCHART",148,0)
 . . I ORTAB="ORDERS" S I=$F(^TMP("OR",$J,ORTAB,ORJ,0),"*UNSIGNED*") I I D CNTRL^VALM10(ORJ,I-10,10,IOINHI,IOINORM)
"RTN","ORCHART",149,0)
 . . I ORTAB="XRAYS" S I=$F(^TMP("OR",$J,ORTAB,ORJ,0),"*ABNORMAL*") I I D CNTRL^VALM10(ORJ,I-10,10,IOINHI,IOINORM)
"RTN","ORCHART",150,0)
 . . I ORTAB="LABS" D CNTRL^VALM10(ORJ,24,2,IOINHI,IOINORM)
"RTN","ORCHART",151,0)
 . . D:VALMBCK="" WRITE^VALM10(ORJ)
"RTN","ORCHART",152,0)
 Q
"RTN","ORCHART",153,0)
 ;
"RTN","ORCHART",154,0)
CHANGE ; -- Change view of current list
"RTN","ORCHART",155,0)
 G EN^ORCHANGE
"RTN","ORCHART",156,0)
 Q
"RTN","ORCHART",157,0)
 ;
"RTN","ORCHART",158,0)
REV(ORVP) ; -- Review orders for patient
"RTN","ORCHART",159,0)
 Q:'$G(ORVP)  Q:$D(ZTQUEUED)  Q:$G(DGQUIET)  ;silent
"RTN","ORCHART",160,0)
 I $D(SDAMEVT) Q:$S(SDAMEVT=1:0,1:1)  ;continue if new appt
"RTN","ORCHART",161,0)
 Q:'$$GET^XPAR("ALL","ORPF REVIEW ON PATIENT MVMT")
"RTN","ORCHART",162,0)
 Q:'$$ACCESS^ORCHTAB  ;CPRS not in user's option menu tree
"RTN","ORCHART",163,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,DFN ;protect DFN
"RTN","ORCHART",164,0)
 S DFN=+ORVP,ORVP=DFN_";DPT("  Q:'$D(^OR(100,"AC",ORVP))  ; no orders
"RTN","ORCHART",165,0)
 S DIR(0)="YA",DIR("A")="Review active orders? ",DIR("B")="YES"
"RTN","ORCHART",166,0)
 S DIR("?")="Answer YES to review this patient's active orders"
"RTN","ORCHART",167,0)
 D ^DIR Q:Y'>0  K DIR
"RTN","ORCHART",168,0)
 D SLCT1^ORQPT Q:'$G(ORVP)
"RTN","ORCHART",169,0)
 S ORTAB="ORDERS" D EN^VALM("OR CHART")
"RTN","ORCHART",170,0)
 Q
"RTN","ORCHART",171,0)
 ;
"RTN","ORCHART",172,0)
VIEW() ; -- return line 3 of header w/current view of tab 
"RTN","ORCHART",173,0)
 N BEGIN,END,ITEMS,STS,TEXT,X
"RTN","ORCHART",174,0)
 I $G(ORTAB)']"" Q ""
"RTN","ORCHART",175,0)
 S X=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),TEXT=""
"RTN","ORCHART",176,0)
 S BEGIN=$P(X,";"),END=$P(X,";",2),STS=$P(X,";",3),ITEMS=$P(X,";",5)
"RTN","ORCHART",177,0)
 I ORTAB="NOTES",(STS'=5) S TEXT=$S(ITEMS:"up to "_ITEMS,1:"all")_$S(STS=1:" notes",STS=2:" unsigned notes",STS=3:" uncosigned notes",STS=4:" signed notes by author",1:"")
"RTN","ORCHART",178,0)
 E  D
"RTN","ORCHART",179,0)
 . S:$L(BEGIN)!$L(END) TEXT=$$FDATE^VALM1($$DT^ORCHTAB1(BEGIN))_" thru "_$$FDATE^VALM1($$DT^ORCHTAB1(END))
"RTN","ORCHART",180,0)
 . I ORTAB="XRAYS",ITEMS>0 S TEXT=$S($L(TEXT):TEXT_", ",1:"")_"limit "_ITEMS
"RTN","ORCHART",181,0)
 S:$L(TEXT) TEXT="Current View: "_TEXT,TEXT=$J(TEXT,40+($L(TEXT)\2))
"RTN","ORCHART",182,0)
 Q TEXT
"RTN","ORCHECK")
0^18^B38547153
"RTN","ORCHECK",1,0)
ORCHECK ;SLC/MKB-Order checking calls ; 08 May 2002  2:12 PM
"RTN","ORCHECK",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,56,70,94,141**;Dec 17, 1997
"RTN","ORCHECK",3,0)
DISPLAY ; -- DISPLAY event [called from ORCDLG,ORCACT4,ORCMED]
"RTN","ORCHECK",4,0)
 ;    Expects ORVP, ORNMSP, ORTAB, [ORWARD]
"RTN","ORCHECK",5,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",6,0)
 N ORX,ORY,I
"RTN","ORCHECK",7,0)
 I ORNMSP="PS" D  ;reset to PSJ, PSJI, or PSO
"RTN","ORCHECK",8,0)
 . I $G(ORDG) S I=$P($G(^ORD(100.98,+ORDG,0)),U,3),I=$P(I," ") Q:'$L(I)  S ORNMSP="PS"_$S(I="UD":"I",1:I) Q
"RTN","ORCHECK",9,0)
 . I $G(ORXFER) S I=$P($P(^TMP("OR",$J,ORTAB,0),U,3),";",3) S:I="" I=$G(ORWARD) S ORNMSP="PS"_$S(I:"O",1:"I") ;opposite of list
"RTN","ORCHECK",10,0)
 S ORX(1)="|"_ORNMSP,ORX=1
"RTN","ORCHECK",11,0)
 D EN^ORKCHK(.ORY,+ORVP,.ORX,"DISPLAY") Q:'$D(ORY)
"RTN","ORCHECK",12,0)
 S I=0 F  S I=$O(ORY(I)) Q:I'>0  W !,$P(ORY(I),U,4) ; display only
"RTN","ORCHECK",13,0)
 Q
"RTN","ORCHECK",14,0)
 ;
"RTN","ORCHECK",15,0)
SELECT ; -- SELECT event
"RTN","ORCHECK",16,0)
 ;    Expects ORVP, ORDAILOG(PROMPT,ORI), ORNMSP
"RTN","ORCHECK",17,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",18,0)
 N ORX,ORY,OI
"RTN","ORCHECK",19,0)
 S OI=+$G(ORDIALOG(PROMPT,ORI))
"RTN","ORCHECK",20,0)
 S ORX=1,ORX(1)=OI_"|"_ORNMSP_"|"_$$USID^ORMBLD(OI)
"RTN","ORCHECK",21,0)
 D EN^ORKCHK(.ORY,+ORVP,.ORX,"SELECT"),RETURN:$D(ORY)
"RTN","ORCHECK",22,0)
 Q
"RTN","ORCHECK",23,0)
 ;
"RTN","ORCHECK",24,0)
ACCEPT(MODE) ; -- ACCEPT event [called from ORCDLG,ORCACT4,ORCMED]
"RTN","ORCHECK",25,0)
 ;    Expects ORVP, ORDIALOG(), ORNMSP
"RTN","ORCHECK",26,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",27,0)
 N ORX,ORY,ORZ,OI,ORSTRT,ORI,ORIT,ORID,ORSP
"RTN","ORCHECK",28,0)
 S:'$L($G(MODE)) MODE="ACCEPT"
"RTN","ORCHECK",29,0)
 S OI=$$PTR^ORCD("OR GTX ORDERABLE ITEM"),ORSTRT=$$START,ORX=0
"RTN","ORCHECK",30,0)
 S ORI=0 F  S ORI=$O(ORDIALOG(OI,ORI)) Q:ORI'>0  D STUF
"RTN","ORCHECK",31,0)
 I $G(ORDG)=+$O(^ORD(100.98,"B","IV RX",0)) S OI=$$PTR^ORCD("OR GTX ADDITIVE"),ORI=0 F  S ORI=$O(ORDIALOG(OI,ORI)) Q:ORI'>0  D STUF
"RTN","ORCHECK",32,0)
 D EN^ORKCHK(.ORY,+ORVP,.ORX,MODE),RETURN:$D(ORY)
"RTN","ORCHECK",33,0)
 Q
"RTN","ORCHECK",34,0)
STUF S ORIT=ORDIALOG(OI,ORI),ORSP=""
"RTN","ORCHECK",35,0)
 S:ORNMSP="LR" ORSP=+$G(ORDIALOG($$PTR^ORCD("OR GTX SPECIMEN"),ORI))
"RTN","ORCHECK",36,0)
 S ORID=$S($E(ORNMSP,1,2)="PS":$$DRUG(ORIT,OI),1:$$USID^ORMBLD(ORIT))
"RTN","ORCHECK",37,0)
 S ORZ=1,ORZ(1)=ORIT_"|"_ORNMSP_"|"_ORID
"RTN","ORCHECK",38,0)
 I MODE'="ALL" D EN^ORKCHK(.ORY,+ORVP,.ORZ,"SELECT"),RETURN:$D(ORY)
"RTN","ORCHECK",39,0)
 S ORX=ORX+1,ORX(ORX)=ORZ(1)_"|"_ORSTRT_"||"_ORSP K ORY,ORZ
"RTN","ORCHECK",40,0)
 Q
"RTN","ORCHECK",41,0)
 ;
"RTN","ORCHECK",42,0)
DELAY(MODE) ; -- Delayed ACCEPT event [called from ORMEVNT]
"RTN","ORCHECK",43,0)
 ;    Expects ORVP, ORIFN
"RTN","ORCHECK",44,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",45,0)
 N ORX,ORY,ORCHECK S:'$L($G(MODE)) MODE="NOTIF"
"RTN","ORCHECK",46,0)
 D BLD(+ORIFN),EN^ORKCHK(.ORY,+ORVP,.ORX,MODE) Q:'$D(ORY)
"RTN","ORCHECK",47,0)
 D RETURN I MODE="NOTIF" S ORCHECK("OK")="Notification sent to provider" D OC^ORCSAVE2 Q  ; silent
"RTN","ORCHECK",48,0)
 Q
"RTN","ORCHECK",49,0)
 ;
"RTN","ORCHECK",50,0)
SESSION ; -- SESSION event [called from ORCSIGN]
"RTN","ORCHECK",51,0)
 ;    Expects ORVP, ORES()
"RTN","ORCHECK",52,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")'="E"
"RTN","ORCHECK",53,0)
 N ORX,ORY,ORIFN,I,X,Y
"RTN","ORCHECK",54,0)
 S ORIFN=0 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN'>0  I +$P(ORIFN,";",2)'>1 D
"RTN","ORCHECK",55,0)
 . I "^10^11^"'[(U_$P($G(^OR(100,+ORIFN,3)),U,3)_U) Q  ;unreleased
"RTN","ORCHECK",56,0)
 . D BLD(+ORIFN) Q:'$D(^OR(100,+ORIFN,9))
"RTN","ORCHECK",57,0)
 . S ORCHECK("IFN")=+$G(ORCHECK("IFN"))+1
"RTN","ORCHECK",58,0)
 . S I=0 F  S I=$O(^OR(100,+ORIFN,9,I)) Q:I'>0  S X=$G(^(I,0)),Y=$G(^(1)),ORCHECK=+$G(ORCHECK)+1,ORCHECK(+ORIFN,$S($P(X,U,2):$P(X,U,2),1:99),ORCHECK)=$P(X,U,1,2)_U_Y
"RTN","ORCHECK",59,0)
 I $D(ORX) D EN^ORKCHK(.ORY,+ORVP,.ORX,"SESSION"),RETURN:$D(ORY)
"RTN","ORCHECK",60,0)
 Q
"RTN","ORCHECK",61,0)
 ;
"RTN","ORCHECK",62,0)
BLD(ORDER) ; -- Build new ORX(#) for ORDER
"RTN","ORCHECK",63,0)
 Q:'$G(ORDER)  Q:'$D(^OR(100,ORDER,0))  ;Q:$P($G(^(3)),U,11)  ;edit/renew
"RTN","ORCHECK",64,0)
 N PKG,START,ORI,ITEM,USID,SPEC,ORDG,PTR,INST
"RTN","ORCHECK",65,0)
 S ORDG=$P(^OR(100,ORDER,0),U,11),PKG=$$GET1^DIQ(9.4,$P(^(0),U,14)_",",1)
"RTN","ORCHECK",66,0)
 I PKG="PS",$G(ORDG) S ORI=$P($G(^ORD(100.98,+ORDG,0)),U,3),ORI=$P(ORI," "),PKG=PKG_$S(ORI="UD":"I",1:ORI)
"RTN","ORCHECK",67,0)
 S START=$$START(ORDER),ORI=0
"RTN","ORCHECK",68,0)
 F  S ORI=$O(^OR(100,ORDER,4.5,"ID","ORDERABLE",ORI)) Q:ORI'>0  D
"RTN","ORCHECK",69,0)
 . S INST=$P($G(^OR(100,ORDER,4.5,ORI,0)),U,3),PTR=$P($G(^(0)),U,2),ITEM=+$G(^(1))
"RTN","ORCHECK",70,0)
 . S USID=$S(PKG?1"PS".E:$$DRUG(ITEM,PTR,ORDER),1:$$USID^ORMBLD(ITEM))
"RTN","ORCHECK",71,0)
 . S SPEC=$S(PKG="LR":$$VALUE^ORCSAVE2(ORDER,"SPECIMEN",INST),1:"")
"RTN","ORCHECK",72,0)
 . S ORX=+$G(ORX)+1,ORX(ORX)=ITEM_"|"_PKG_"|"_USID_"|"_START_"|"_ORDER_"|"_SPEC
"RTN","ORCHECK",73,0)
 Q
"RTN","ORCHECK",74,0)
 ;
"RTN","ORCHECK",75,0)
RETURN ; -- Return checks in ORCHECK(ORIFN,CDL,#)
"RTN","ORCHECK",76,0)
 N I,IFN,CDL S I=0 F  S I=$O(ORY(I)) Q:I'>0  D
"RTN","ORCHECK",77,0)
 . S IFN=+$P(ORY(I),U) S:'IFN IFN="NEW"
"RTN","ORCHECK",78,0)
 . S CDL=+$P(ORY(I),U,3) S:'CDL CDL=99
"RTN","ORCHECK",79,0)
 . S:'$D(ORCHECK(IFN)) ORCHECK("IFN")=+$G(ORCHECK("IFN"))+1 ; count
"RTN","ORCHECK",80,0)
 . S ORCHECK=+$G(ORCHECK)+1,ORCHECK(IFN,CDL,ORCHECK)=$P(ORY(I),U,2,4)
"RTN","ORCHECK",81,0)
 Q
"RTN","ORCHECK",82,0)
 ;
"RTN","ORCHECK",83,0)
START(DA) ; -- Returns start date/time
"RTN","ORCHECK",84,0)
 N I,X,Y,%DT S Y=""
"RTN","ORCHECK",85,0)
 I $G(DA) S X=$O(^OR(100,DA,4.5,"ID","START",0)),X=$G(^OR(100,DA,4.5,+X,1))
"RTN","ORCHECK",86,0)
 E  D  ; look in ORDIALOG instead
"RTN","ORCHECK",87,0)
 . S I=0 F  S I=$O(ORDIALOG(I)) Q:I'>0  Q:$P(ORDIALOG(I),U,2)="START"
"RTN","ORCHECK",88,0)
 . S X=$S(I:$G(ORDIALOG(I,1)),1:"")
"RTN","ORCHECK",89,0)
 D AM^ORCSAVE2:X="AM",NEXT^ORCSAVE2:X="NEXT"
"RTN","ORCHECK",90,0)
 D ADMIN^ORCSAVE2("NEXT"):X="NEXTA",ADMIN^ORCSAVE2("CLOSEST"):X="CLOSEST"
"RTN","ORCHECK",91,0)
 I $L(X) S %DT="TX" D ^%DT S:Y'>0 Y=""
"RTN","ORCHECK",92,0)
 Q Y
"RTN","ORCHECK",93,0)
 ;
"RTN","ORCHECK",94,0)
DRUG(OI,PTR,IFN) ; -- Returns 6 ^-piece identifier for Dispense Drug
"RTN","ORCHECK",95,0)
 N ORDD,ORNDF,Y
"RTN","ORCHECK",96,0)
 I ORDG=+$O(^ORD(100.98,"B","IV RX",0)) S ORDD=$$IV G D1
"RTN","ORCHECK",97,0)
 I $G(IFN) S ORDD=$O(^OR(100,IFN,4.5,"ID","DRUG",0)),ORDD=+$G(^OR(100,IFN,4.5,+ORDD,1))
"RTN","ORCHECK",98,0)
 E  S ORDD=+$G(ORDIALOG($$PTR^ORCD("OR GTX DISPENSE DRUG"),1))
"RTN","ORCHECK",99,0)
D1 Q:'ORDD "" S ORNDF=$$ENDCM^PSJORUTL(ORDD)
"RTN","ORCHECK",100,0)
 S Y=$P(ORNDF,U,3)_"^^99NDF^"_ORDD_U_$P($G(^PSDRUG(ORDD,0)),U)_"^99PSD"
"RTN","ORCHECK",101,0)
 Q Y
"RTN","ORCHECK",102,0)
 ;
"RTN","ORCHECK",103,0)
IV() ; -- Get Dispense Drug for IV orderable
"RTN","ORCHECK",104,0)
 N PSOI,TYPE,VOL,ORY
"RTN","ORCHECK",105,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2),VOL=""
"RTN","ORCHECK",106,0)
 S TYPE=$S(PTR=$$PTR^ORCD("OR GTX ADDITIVE"):"A",1:"B")
"RTN","ORCHECK",107,0)
 S:TYPE="B" VOL=$S($G(IFN):$$VALUE^ORCSAVE2(IFN,"VOLUME"),1:+$G(ORDIALOG($$PTR^ORCD("OR GTX VOLUME"),1)))
"RTN","ORCHECK",108,0)
 D ENDDIV^PSJORUTL(PSOI,TYPE,VOL,.ORY)
"RTN","ORCHECK",109,0)
 Q +$G(ORY)
"RTN","ORCHECK",110,0)
 ;
"RTN","ORCHECK",111,0)
LIST(IFN) ; -- Displays list of ORCHECK(IFN) checks
"RTN","ORCHECK",112,0)
 N ORI,ORJ,ORZ,ORMAX,ORTX,ON,OFF
"RTN","ORCHECK",113,0)
 S ORZ=0 F  S ORZ=$O(ORCHECK(IFN,ORZ)) Q:ORZ'>0  D
"RTN","ORCHECK",114,0)
 . S:ORZ=1 ON=IOINHI,OFF=IOINORM S:ORZ'=1 (ON,OFF)="" ; use bold if High
"RTN","ORCHECK",115,0)
 . S ORI=0 F  S ORI=$O(ORCHECK(IFN,ORZ,ORI)) Q:ORI'>0  D
"RTN","ORCHECK",116,0)
 . . S X=$P(ORCHECK(IFN,ORZ,ORI),U,3) I $L(X)<75 W !,ON_">>>  "_X_OFF Q
"RTN","ORCHECK",117,0)
 . . S ORMAX=74 K ORTX D TXT^ORCHTAB Q:'$G(ORTX)  ; wrap
"RTN","ORCHECK",118,0)
 . . F ORJ=1:1:ORTX W !,ON_$S(ORJ=1:">>>  ",1:"      ")_ORTX(ORJ)_OFF
"RTN","ORCHECK",119,0)
 W !
"RTN","ORCHECK",120,0)
 Q
"RTN","ORCHECK",121,0)
 ;
"RTN","ORCHECK",122,0)
CANCEL() ; -- Returns 1 or 0: Cancel order(s)?
"RTN","ORCHECK",123,0)
 N X,Y,DIR,NUM
"RTN","ORCHECK",124,0)
 S NUM=+$G(ORCHECK("IFN")),DIR(0)="YA"
"RTN","ORCHECK",125,0)
 S DIR("A")="Do you want to cancel "_$S(NUM>1:"any of the new orders? ",1:"the new order? ")
"RTN","ORCHECK",126,0)
 S DIR("?",1)="Enter YES to cancel "_$S(NUM>1:"an",1:"the")_" order.  If you wish to override these order checks"
"RTN","ORCHECK",127,0)
 S DIR("?",2)="and release "_$S(NUM>1:"these orders",1:"this order")_", enter NO; you will be prompted for a justification",DIR("?")="if there are any highlighted critical order checks."
"RTN","ORCHECK",128,0)
 D ^DIR
"RTN","ORCHECK",129,0)
 Q +Y
"RTN","ORCHECK",130,0)
 ;
"RTN","ORCHECK",131,0)
REASON() ; -- Reason for overriding order checks
"RTN","ORCHECK",132,0)
 ; I '$D(^XUSEC("ORES",DUZ)),'$D(^XUSEC("ORELSE",DUZ)) Q  ??
"RTN","ORCHECK",133,0)
 N X,Y,DIR
"RTN","ORCHECK",134,0)
 S DIR(0)="FA^2:80^K:X?1."" "" X",DIR("A")="REASON FOR OVERRIDE: "
"RTN","ORCHECK",135,0)
 S DIR("?")="Enter a justification for overriding these order checks, up to 80 characters"
"RTN","ORCHECK",136,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT) S Y="^"
"RTN","ORCHECK",137,0)
 Q Y
"RTN","ORCHTAB1")
0^19^B65235851
"RTN","ORCHTAB1",1,0)
ORCHTAB1 ;SLC/MKB-Build Chart-tabs cont ;6/14/02  12:49
"RTN","ORCHTAB1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**2,27,58,72,141**;Dec 17, 1997
"RTN","ORCHTAB1",3,0)
EN ; -- rebuild ORTAB listing
"RTN","ORCHTAB1",4,0)
 Q:'$L($T(@ORTAB))  G @ORTAB
"RTN","ORCHTAB1",5,0)
 Q
"RTN","ORCHTAB1",6,0)
 ;
"RTN","ORCHTAB1",7,0)
DT(X) ; -- Returns FM date for X
"RTN","ORCHTAB1",8,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORCHTAB1",9,0)
 Q Y
"RTN","ORCHTAB1",10,0)
 ;
"RTN","ORCHTAB1",11,0)
COVER ; -- cover sheet
"RTN","ORCHTAB1",12,0)
 N LBL,X
"RTN","ORCHTAB1",13,0)
 F LBL="GMRA","CWAD","GMRV","IMM","SC" D @(LBL_"^ORCHTAB2"),BLANK^ORCHTAB
"RTN","ORCHTAB1",14,0)
 S ORMENU="ORCHART COVER MENU",DEFCXT=1
"RTN","ORCHTAB1",15,0)
 S ORTITLE="Cover Sheet",ORACTNS="ORC COVER ACTIONS",ORRM=81
"RTN","ORCHTAB1",16,0)
 S ORCAPTN("ITEM")="Item",ORCAPTN("DATA")="Entered",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",17,0)
 Q
"RTN","ORCHTAB1",18,0)
 ;
"RTN","ORCHTAB1",19,0)
NOTES ; -- progress notes
"RTN","ORCHTAB1",20,0)
 N BEG,END,STS,AUTHOR,ORY,ORI,ORX,OCCLIM,SUBJ
"RTN","ORCHTAB1",21,0)
 I '$L(CONTEXT) S CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT NOTES"),DEFCXT=1,OCCLIM=$P($$PERSPRF^TIULE(DUZ),U,10) S:+OCCLIM>0 $P(CONTEXT,";",5)=OCCLIM
"RTN","ORCHTAB1",22,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),STS=$P(CONTEXT,";",3),AUTHOR=$P(CONTEXT,";",4),OCCLIM=$P(CONTEXT,";",5),SUBJ=$P(CONTEXT,";",6)
"RTN","ORCHTAB1",23,0)
 D CONTEXT^TIUSRVLO(.ORY,3,STS,+ORVP,BEG,END,AUTHOR,OCCLIM) S ORI=0
"RTN","ORCHTAB1",24,0)
 I $L($G(ORY)) F  S ORI=$O(@ORY@(ORI)) Q:ORI'>0  S ORX=@ORY@(ORI) D NOTE^ORCHTAB2
"RTN","ORCHTAB1",25,0)
 S ORTITLE=$S(STS=2:"Unsigned",STS=3:"Uncosigned",1:"Signed")_" Notes"_$S(AUTHOR:" by "_$$LNAMEF^ORCHTAB(AUTHOR),1:"")
"RTN","ORCHTAB1",26,0)
 S ORCAPTN("ITEM")="Title",ORCAPTN("DATA")="Written         Author      SigSt",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",27,0)
 S ORACTNS="ORC TIU ACTIONS",ORCHANGE="ORCHANGE NOTES",ORRM=81
"RTN","ORCHTAB1",28,0)
 S ORMENU="ORCHART NOTES MENU" K @ORY
"RTN","ORCHTAB1",29,0)
 Q
"RTN","ORCHTAB1",30,0)
 ;
"RTN","ORCHTAB1",31,0)
SUMMRIES ; -- discharge summary
"RTN","ORCHTAB1",32,0)
 N BEG,END,STS,AUTHOR,ORY,ORI,ORX
"RTN","ORCHTAB1",33,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT SUMMRIES"),DEFCXT=1
"RTN","ORCHTAB1",34,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),STS=$P(CONTEXT,";",3),AUTHOR=$P(CONTEXT,";",4)
"RTN","ORCHTAB1",35,0)
 D CONTEXT^TIUSRVLO(.ORY,244,STS,+ORVP,BEG,END,AUTHOR) S ORI=0
"RTN","ORCHTAB1",36,0)
 I $L($G(ORY)) F  S ORI=$O(@ORY@(ORI)) Q:ORI'>0  S ORX=@ORY@(ORI) D SUMM^ORCHTAB2
"RTN","ORCHTAB1",37,0)
 S ORCAPTN("ITEM")="Title",ORCAPTN("DATA")="Ref Date     Author         SigSt",ORCAPTN("MORE")="Admitted  Discharged             "
"RTN","ORCHTAB1",38,0)
 S ORACTNS="ORC TIU ACTIONS",ORMENU="ORCHART SUMMARIES MENU",ORCHANGE="ORCHANGE NOTES",ORRM=114
"RTN","ORCHTAB1",39,0)
 S ORTITLE=$S(STS=2:"Unsigned",STS=3:"Uncosigned",1:"Signed")_" D/C Summaries"_$S(AUTHOR:" by "_$$LNAMEF^ORCHTAB(AUTHOR),1:"") K @ORY
"RTN","ORCHTAB1",40,0)
 Q
"RTN","ORCHTAB1",41,0)
 ;
"RTN","ORCHTAB1",42,0)
PROBLEMS ; -- problem list
"RTN","ORCHTAB1",43,0)
 N COMM,ST,ORY,ORI,ORX
"RTN","ORCHTAB1",44,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT PROBLEMS"),DEFCXT=1
"RTN","ORCHTAB1",45,0)
 S ST=$P(CONTEXT,";",3),COMM=$P(CONTEXT,";",4) ;,PROV=$P(CONTEXT,";",5)
"RTN","ORCHTAB1",46,0)
 D LIST^GMPLUTL2(.ORY,+ORVP,ST,COMM)
"RTN","ORCHTAB1",47,0)
 S ORI=0 F  S ORI=$O(ORY(ORI)) Q:ORI'>0  S ORX=ORY(ORI) D PROB^ORCHTAB2
"RTN","ORCHTAB1",48,0)
 S ORCAPTN("ITEM")="Problem",ORCAPTN("DATA")="Onset     Updated   Status",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",49,0)
 S ORTITLE=$S(ST="A":"Active",ST="I":"Inactive",1:"All")_" Problems"
"RTN","ORCHTAB1",50,0)
 S ORACTNS="ORC PROBLEM ACTIONS",ORCHANGE="ORCHANGE PROBLEMS",ORRM=81
"RTN","ORCHTAB1",51,0)
 S ORMENU="ORCHART PROBLEMS MENU"
"RTN","ORCHTAB1",52,0)
 Q
"RTN","ORCHTAB1",53,0)
 ;
"RTN","ORCHTAB1",54,0)
NEW ; -- new orders in ORNEW()
"RTN","ORCHTAB1",55,0)
 N OREVENT S CONTEXT=";;19;ALL;L",DEFCXT=1 G ORDERS
"RTN","ORCHTAB1",56,0)
DELAY ; -- delayed orders [from ORCACT3]
"RTN","ORCHTAB1",57,0)
 N OREVENT S CONTEXT=";;24;ALL;L",DEFCXT=1 G ORDERS
"RTN","ORCHTAB1",58,0)
 ;
"RTN","ORCHTAB1",59,0)
ORDERS ; -- orders
"RTN","ORCHTAB1",60,0)
 N DGRP,STS,BEG,END,ORLIST,ORIFN,ORI,MULT,ORYD,FRMT,DELAY,EVT
"RTN","ORCHTAB1",61,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT ORDERS"),DEFCXT=1
"RTN","ORCHTAB1",62,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2))
"RTN","ORCHTAB1",63,0)
 S DGRP=$P(CONTEXT,";",4),FRMT=$P(CONTEXT,";",5),EVT=$P(CONTEXT,";",8)
"RTN","ORCHTAB1",64,0)
 S:'$L(DGRP) DGRP="ALL" S DGRP=+$O(^ORD(100.98,"B",DGRP,0))
"RTN","ORCHTAB1",65,0)
 S STS=+$P(CONTEXT,";",3),DELAY=$S("^15^16^17^24^25^26^"[(U_STS_U):1,'EVT:0,$P($G(^ORE(100.2,+EVT,1)),U,5):1,$O(^ORE(100.2,"DAD",+EVT,0)):1,1:0)
"RTN","ORCHTAB1",66,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_STS_U):1,1:0)
"RTN","ORCHTAB1",67,0)
 S ORTITLE=$$STATUS(STS,EVT)_$S(DGRP>1:" "_$P($G(^ORD(100.98,+DGRP,0)),U,2),1:"")_" Orders",ORRM=114
"RTN","ORCHTAB1",68,0)
 S ORCAPTN("ITEM")="Item Ordered",ORCAPTN("MORE")="NRS    CLK    Chart             "
"RTN","ORCHTAB1",69,0)
 S:FRMT="S" ORCAPTN("DATA")="Start Date      Order Status"
"RTN","ORCHTAB1",70,0)
 S:FRMT'="S" ORCAPTN("DATA")="Provider    Start      Stop  Sts"
"RTN","ORCHTAB1",71,0)
 D EN^ORQ1(ORVP,DGRP,+STS,,BEG,END,,MULT,,,EVT),ORYD^ORDD100 ;Get list
"RTN","ORCHTAB1",72,0)
 S ORI=0 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI'>0  S ORIFN=$G(^(ORI)) D ORDER^ORCHTAB3:'DELAY,DELAYED^ORCHTAB3:DELAY
"RTN","ORCHTAB1",73,0)
 S DELAY=$S("^15^16^17^24^25^26^"[(U_STS_U):1,$G(OREVENT):1,1:0)
"RTN","ORCHTAB1",74,0)
 S ORACTNS="ORC "_$S(ORTAB="NEW":"NEW",DELAY:"DELAYED ORDER",$D(^XUSEC("ORES",DUZ)):"ORES ORDER",$D(^XUSEC("ORELSE",DUZ)):"ORELSE ORDER",$D(^XUSEC("OREMAS",DUZ)):"OREMAS ORDER",1:"ORDER")_" ACTIONS"
"RTN","ORCHTAB1",75,0)
 I ORTAB'="NEW" S ORCHANGE="ORCHANGE ORDERS "_$S(FRMT="L":"LONG",1:"SHORT")
"RTN","ORCHTAB1",76,0)
 K ^TMP("ORR",$J,ORLIST)
"RTN","ORCHTAB1",77,0)
 Q
"RTN","ORCHTAB1",78,0)
 ;
"RTN","ORCHTAB1",79,0)
STATUS(X,Y) ; -- Return name of context/status number
"RTN","ORCHTAB1",80,0)
 N Z I $G(Y) S Z=$$NAME^OREVNTX(Y),Z=$$LOWER^VALM1(Z) Q Z  ;Event
"RTN","ORCHTAB1",81,0)
 S Z="All^Active^Discontinued^Completed/Expired^Expiring^Recent^Pending^Unverified^Unverified^Unverified^Unsigned^Flagged^Verbal^Unsigned Verbal^Admission^Discharge^Transfer^Held^New^Unverified^^Lapsed^Current^Delayed^O.R.^Delayed"
"RTN","ORCHTAB1",82,0)
 Q $P(Z,U,+X)
"RTN","ORCHTAB1",83,0)
 ;
"RTN","ORCHTAB1",84,0)
MEDS ; -- medications
"RTN","ORCHTAB1",85,0)
 N BEG,END,INPT,ORI,ORJ,ORX
"RTN","ORCHTAB1",86,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT MEDS"),DEFCXT=1
"RTN","ORCHTAB1",87,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2))
"RTN","ORCHTAB1",88,0)
 S INPT=$P(CONTEXT,";",3) S:'$L(INPT) INPT=$S($G(ORWARD):1,1:0)
"RTN","ORCHTAB1",89,0)
 D OCL^PSOORRL(+ORVP,BEG,END),SORT^ORCHTAB3(INPT)
"RTN","ORCHTAB1",90,0)
 S ORJ=0 F  S ORJ=$O(^TMP("ORPS",$J,ORJ)) Q:ORJ'>0  S ORI=0 F  S ORI=$O(^TMP("ORPS",$J,ORJ,ORI)) Q:ORI'>0  S ORX=$G(^TMP("PS",$J,ORI,0)) D MEDS^ORCHTAB3
"RTN","ORCHTAB1",91,0)
 S ORCAPTN("ITEM")="Medication",ORCAPTN("MORE")="",ORRM=81
"RTN","ORCHTAB1",92,0)
 S:INPT ORCAPTN("DATA")="Start     Stop      Status"
"RTN","ORCHTAB1",93,0)
 S:'INPT ORCAPTN("DATA")="Requestor   Expires   Status"
"RTN","ORCHTAB1",94,0)
 S ORACTNS="ORC "_$S(INPT:"IN",1:"OUT")_"PT MED ACTIONS",ORMENU="ORCHART MEDS MENU"
"RTN","ORCHTAB1",95,0)
 S ORCHANGE="ORCHANGE MEDS "_$S(INPT:"INPT",1:"OUTPT")
"RTN","ORCHTAB1",96,0)
 S ORTITLE=$S($L(BEG)!$L(END):"",1:"Active ")_$S(INPT:"In",1:"Out")_"patient Medications"
"RTN","ORCHTAB1",97,0)
 K ^TMP("PS",$J),^TMP("ORPS",$J)
"RTN","ORCHTAB1",98,0)
 Q
"RTN","ORCHTAB1",99,0)
 ;
"RTN","ORCHTAB1",100,0)
LABS ; -- laboratory
"RTN","ORCHTAB1",101,0)
 N BEG,END,TYPE,SUB,X
"RTN","ORCHTAB1",102,0)
 I '$L(CONTEXT) S CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT "_$S($G(ORWARD):"IN",1:"OUT")_"PT LABS"),DEFCXT=1
"RTN","ORCHTAB1",103,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),TYPE=$P(CONTEXT,";",3),ORRM=81
"RTN","ORCHTAB1",104,0)
 I TYPE="C" D LRCUM^ORCHTAB4 Q  ; cum
"RTN","ORCHTAB1",105,0)
 D RR^LR7OR1(+ORVP,,BEG,END)
"RTN","ORCHTAB1",106,0)
 S SUB="CH" D LABS^ORCHTAB4,BLANK^ORCHTAB ; MI,AP,BB ??
"RTN","ORCHTAB1",107,0)
 S ORTITLE="Lab Tests" ;,ORACTNS="ORC LAB ACTIONS"
"RTN","ORCHTAB1",108,0)
 S ORCAPTN("ITEM")="Test       Result    Units      Range"
"RTN","ORCHTAB1",109,0)
 S ORCAPTN("DATA")="Collected       Accession     Sts",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",110,0)
 S ORCHANGE="ORCHANGE LAB LIST",ORMENU="ORCHART LABS MENU"
"RTN","ORCHTAB1",111,0)
 K ^TMP("LRRR",$J)
"RTN","ORCHTAB1",112,0)
 Q
"RTN","ORCHTAB1",113,0)
 ;
"RTN","ORCHTAB1",114,0)
XRAYS ; -- radiology
"RTN","ORCHTAB1",115,0)
 N BEG,END,MAX,ORI,ORX
"RTN","ORCHTAB1",116,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT XRAYS"),DEFCXT=1
"RTN","ORCHTAB1",117,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),MAX=$P(CONTEXT,";",5)
"RTN","ORCHTAB1",118,0)
 S ORX=$L($T(EN1^RAO7PC1),",") D EN1^RAO7PC1(+ORVP,BEG,END,MAX):ORX=4
"RTN","ORCHTAB1",119,0)
 D EN1^RAO7PC1(+ORVP,BEG,END,MAX,1):ORX>4 ;incl cancelled exams
"RTN","ORCHTAB1",120,0)
 S ORI=0 F  S ORI=$O(^TMP($J,"RAE1",+ORVP,ORI)) Q:ORI'>0  S ORX=$G(^(ORI)) D XRAY^ORCHTAB4
"RTN","ORCHTAB1",121,0)
 S ORCAPTN("ITEM")="Procedure",ORCAPTN("DATA")="Exam Date       Case  Report Sts",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",122,0)
 S ORACTNS="ORC XRAY ACTIONS",ORCHANGE="ORCHANGE XRAYS",ORRM=81
"RTN","ORCHTAB1",123,0)
 S ORTITLE="Imaging Procedures",ORMENU="ORCHART XRAYS MENU"
"RTN","ORCHTAB1",124,0)
 K ^TMP($J,"RAE1")
"RTN","ORCHTAB1",125,0)
 Q
"RTN","ORCHTAB1",126,0)
 ;
"RTN","ORCHTAB1",127,0)
CONSULTS ; -- consults
"RTN","ORCHTAB1",128,0)
 N BEG,END,STS,SERV,ORI,ORX
"RTN","ORCHTAB1",129,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT CONSULTS"),DEFCXT=1
"RTN","ORCHTAB1",130,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),STS=$P(CONTEXT,";",3),SERV=$P(CONTEXT,";",4)
"RTN","ORCHTAB1",131,0)
 S ORTITLE=$S($L(STS,",")>1:"Selected",STS:$$LOWER^VALM1($P(^ORD(100.01,+STS,0),U)),1:"All")_" "_$S('SERV:"",$L($G(^GMR(123.5,+SERV,.1))):^(.1)_" ",1:$P($G(^GMR(123.5,+SERV,0)),U)_" ")_"Consults"
"RTN","ORCHTAB1",132,0)
 D OER^GMRCSLM1(+ORVP,SERV,BEG,END,STS)
"RTN","ORCHTAB1",133,0)
 S ORI=0 F  S ORI=$O(^TMP("GMRCR",$J,"CS",ORI)) Q:ORI'>0  S ORX=$G(^(ORI,0)) Q:$E(ORX)="<"  D CSLT^ORCHTAB4
"RTN","ORCHTAB1",134,0)
 S ORCAPTN("ITEM")="Consult/Procedure",ORCAPTN("DATA")="Requested    No.  Status",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",135,0)
 S ORACTNS="ORC CONSULT ACTIONS",ORCHANGE="ORCHANGE CONSULTS",ORRM=81
"RTN","ORCHTAB1",136,0)
 S ORMENU="ORCHART CONSULTS MENU"
"RTN","ORCHTAB1",137,0)
 K ^TMP("GMRCR",$J)
"RTN","ORCHTAB1",138,0)
 Q
"RTN","ORCHTAB1",139,0)
 ;
"RTN","ORCHTAB1",140,0)
REPORTS ; -- patient profiles
"RTN","ORCHTAB1",141,0)
 N X,BEG,END,MAX D RPT^ORCHTAB4
"RTN","ORCHTAB1",142,0)
 S:'$L(CONTEXT) CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT REPORTS"),DEFCXT=1 S X="Radiology"
"RTN","ORCHTAB1",143,0)
 S BEG=$$DT($P(CONTEXT,";")),END=$$DT($P(CONTEXT,";",2)),MAX=$P(CONTEXT,";",5)
"RTN","ORCHTAB1",144,0)
 S X="Imaging ("_$$DATE^ORCHTAB(BEG)_" to "_$$DATE^ORCHTAB(END)_$S(MAX:", limit "_MAX,1:"")_")"
"RTN","ORCHTAB1",145,0)
 D BLANK^ORCHTAB,SUBHDR^ORCHTAB(X),XRAYS
"RTN","ORCHTAB1",146,0)
 I $L($T(EN^MCARPS2)) D BLANK^ORCHTAB,SUBHDR^ORCHTAB("Summary of Patient Procedures"),MED^ORCHTAB5
"RTN","ORCHTAB1",147,0)
 S ORCAPTN("ITEM")="Report",ORCAPTN("DATA")="Date            Case  Status",ORCAPTN("MORE")=""
"RTN","ORCHTAB1",148,0)
 S ORACTNS="ORC REPORT ACTIONS",ORMENU="ORCHART REPORTS MENU",ORRM=81
"RTN","ORCHTAB1",149,0)
 S ORCHANGE="ORCHANGE REPORTS",ORTITLE="Reports"
"RTN","ORCHTAB1",150,0)
 Q
"RTN","ORCHTAB3")
0^20^B43924925
"RTN","ORCHTAB3",1,0)
ORCHTAB3 ;SLC/MKB,dcm-Add item to tab listing ; 08 May 2002  2:12 PM
"RTN","ORCHTAB3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,45,86,92,110,141**;Dec 17, 1997
"RTN","ORCHTAB3",3,0)
ORDER ; -- order
"RTN","ORCHTAB3",4,0)
 N ID,ORACT,OR0,OR3,ORA0,DATES,TIMES,STATUS,PROV,ORVER,DATA,ORIGVIEW,ORTX,IDX,ORJ,J
"RTN","ORCHTAB3",5,0)
 S ID=ORIFN,ORACT=+$P(ORIFN,";",2) S:'ORACT ORACT=1
"RTN","ORCHTAB3",6,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)),ORA0=$G(^(8,ORACT,0))
"RTN","ORCHTAB3",7,0)
 D DATES S ORVER=$$VERIFIED ;set DATES, [TIMES], ORVER
"RTN","ORCHTAB3",8,0)
 S STATUS=$S($P(ORA0,U,15):$P(ORA0,U,15),1:$P(OR3,U,3))
"RTN","ORCHTAB3",9,0)
 I $P(ORA0,U,15)=10,$P(OR3,U,3)=14 S STATUS=14 ;delayed-lapsed order
"RTN","ORCHTAB3",10,0)
 S:FRMT="S" STATUS=$$LOW^XLFSTR($P($G(^ORD(100.01,+STATUS,0)),U)),DATA(1)=$$PAD^ORCHTAB(DATES,16)_$$PAD^ORCHTAB(STATUS,17)_ORVER,DATA=1
"RTN","ORCHTAB3",11,0)
ORD1 I FRMT'="S" D
"RTN","ORCHTAB3",12,0)
 . S STATUS=$P($G(^ORD(100.01,+STATUS,0)),U,2)
"RTN","ORCHTAB3",13,0)
 . S PROV=+$S($P(ORA0,U,5):$P(ORA0,U,5),1:$P(ORA0,U,3))
"RTN","ORCHTAB3",14,0)
 . S DATA(1)=$$PAD^ORCHTAB($$LNAMEF^ORCHTAB(PROV),12)_$$PAD^ORCHTAB(DATES,17)_$$PAD^ORCHTAB(STATUS,4)_ORVER,DATA=1
"RTN","ORCHTAB3",15,0)
 . I $L($G(TIMES)) S DATA=2,DATA(2)="            "_TIMES
"RTN","ORCHTAB3",16,0)
 S ORIGVIEW=$S(MULT:0,$P(CONTEXT,";",3)'=2:1,'ORYD:1,$P(ORA0,U)'<ORYD:0,1:1)
"RTN","ORCHTAB3",17,0)
 D TEXT^ORQ12(.ORTX,ORIFN,40) ; get order text
"RTN","ORCHTAB3",18,0)
ORD2 D ADD^ORCHTAB S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NUM))
"RTN","ORCHTAB3",19,0)
 I $O(^OR(100,+ORIFN,2,0)) S ORJ=+$P(IDX,U,2),$E(^TMP("OR",$J,ORTAB,ORJ,0),5)="+" ;child orders exist
"RTN","ORCHTAB3",20,0)
 I $P(ORA0,U,14)>1 S ORJ=+$P(IDX,U,2),$E(^TMP("OR",$J,ORTAB,ORJ,0),5)="*" ;pkg updated
"RTN","ORCHTAB3",21,0)
 I $P($G(^OR(100,+ORIFN,8,ORACT,3)),U) D  ; flagged
"RTN","ORCHTAB3",22,0)
 . S ORJ=+$P(IDX,U,2) K ^TMP("OR",$J,ORTAB,"VIDEO",ORJ)
"RTN","ORCHTAB3",23,0)
 . D SETVIDEO^ORCHTAB(ORJ,1,3,IORVON,IORVOFF)
"RTN","ORCHTAB3",24,0)
 F ORJ=+$P(IDX,U,2):1:($P(IDX,U,2)+$P(IDX,U,3)-1) D  ; unsigned
"RTN","ORCHTAB3",25,0)
 . S J=$F(^TMP("OR",$J,ORTAB,ORJ,0),"*UNSIGNED*")
"RTN","ORCHTAB3",26,0)
 . D:J SETVIDEO^ORCHTAB(ORJ,J-10,10,IOINHI,IOINORM)
"RTN","ORCHTAB3",27,0)
 Q
"RTN","ORCHTAB3",28,0)
 ;
"RTN","ORCHTAB3",29,0)
DELAYED ; -- Delayed order
"RTN","ORCHTAB3",30,0)
 N OR0,ORA0,OR3,ORIGVIEW,ORTX,PROV,EVNT,ID,IDX,ORJ,J,STATUS,START,ORVER,DATA
"RTN","ORCHTAB3",31,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)),ORA0=$G(^(8,1,0))
"RTN","ORCHTAB3",32,0)
 S PROV=+$S($P(ORA0,U,5):$P(ORA0,U,5),1:$P(ORA0,U,3)),ORIGVIEW=1
"RTN","ORCHTAB3",33,0)
 S STATUS=+$S($P(ORA0,U,15):$P(ORA0,U,15),1:$P(OR3,U,3))
"RTN","ORCHTAB3",34,0)
 S STATUS=$$LOW^XLFSTR($P($G(^ORD(100.01,STATUS,0)),U,2))
"RTN","ORCHTAB3",35,0)
 S EVNT=$$SHORTNM^OREVNTX(+$P(OR0,U,17)),ORVER=$$VERIFIED
"RTN","ORCHTAB3",36,0)
 I $P(OR3,U,3)=6 S START=$$DATETIME^ORCHTAB($P(OR0,U,8)),EVNT=$E(START,1,15)
"RTN","ORCHTAB3",37,0)
 ;S ORD=$S(STS=16:STATUS,1:SPEC),ORC=$S(STS=16:"Status",1:"To Specialty")
"RTN","ORCHTAB3",38,0)
 ;I FRMT="S" S DATA(1)=$$PAD^ORCHTAB(ORD,33)_ORVER,ORCAPTN("DATA")=ORC
"RTN","ORCHTAB3",39,0)
 S DATA(1)=$$PAD^ORCHTAB($$LNAMEF^ORCHTAB(PROV),12)_$$PAD^ORCHTAB(EVNT,17)_$$PAD^ORCHTAB(STATUS,4)_ORVER,ORCAPTN("DATA")="Provider    Start/Event      Sts"
"RTN","ORCHTAB3",40,0)
 D TEXT^ORQ12(.ORTX,ORIFN,40) S ID=ORIFN,DATA=1
"RTN","ORCHTAB3",41,0)
 D ADD^ORCHTAB S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NUM))
"RTN","ORCHTAB3",42,0)
 F ORJ=+$P(IDX,U,2):1:($P(IDX,U,2)+$P(IDX,U,3)-1) D  ; unsigned
"RTN","ORCHTAB3",43,0)
 . S J=$F(^TMP("OR",$J,ORTAB,ORJ,0),"*UNSIGNED*")
"RTN","ORCHTAB3",44,0)
 . D:J SETVIDEO^ORCHTAB(ORJ,J-10,10,IOINHI,IOINORM)
"RTN","ORCHTAB3",45,0)
 Q
"RTN","ORCHTAB3",46,0)
 ;
"RTN","ORCHTAB3",47,0)
DATES ; -- Return start and stop dates for display in DATES [,TIMES]
"RTN","ORCHTAB3",48,0)
 N SHORT,ACT,START,STOP,T1,T2
"RTN","ORCHTAB3",49,0)
 S DATES="",SHORT=(FRMT="S"),ACT=$P(ORA0,U,2)
"RTN","ORCHTAB3",50,0)
 S START=$S($P(OR3,U,3)=11:$$VALUE^ORX8(+ORIFN,"START"),ACT="NW"!(ACT="XX")!(ACT="RL"):$P(OR0,U,8),ACT="DC":"",1:$P(ORA0,U))
"RTN","ORCHTAB3",51,0)
 S STOP=$S(SHORT:"",$P(OR3,U,3)=11:$$VALUE^ORX8(+ORIFN,"STOP"),ACT="HD":$P($G(^OR(100,+ORIFN,8,ORACT,2)),U),1:$P(OR0,U,9))
"RTN","ORCHTAB3",52,0)
 I '$L(STOP) D  Q  ;Short format or no Stop date/time
"RTN","ORCHTAB3",53,0)
 . S START=$$DATETIME^ORCHTAB(START) S:SHORT DATES=$E(START,1,14)
"RTN","ORCHTAB3",54,0)
 . S:'SHORT DATES=$E($P(START," "),1,14),TIMES=$E($P(START," ",2),1,14)
"RTN","ORCHTAB3",55,0)
 S STOP=$$DATETIME^ORCHTAB(STOP),T2=$P(STOP," ",2)
"RTN","ORCHTAB3",56,0)
 I '$L(START) D  Q  ;Long format but no Start date/time
"RTN","ORCHTAB3",57,0)
 . S DATES=$J($E($P(STOP," "),1,14),15)
"RTN","ORCHTAB3",58,0)
 . S:$L(T2) TIMES=$J($E(T2,1,14),15)
"RTN","ORCHTAB3",59,0)
 S START=$$DATETIME^ORCHTAB(START,1),T1=$P(START," ",2)
"RTN","ORCHTAB3",60,0)
 S DATES=$$LJ^XLFSTR($E($P(START," "),1,5),5)_"  "_$J($E($P(STOP," "),1,8),8)
"RTN","ORCHTAB3",61,0)
 S:$L(T1)!$L(T2) TIMES=$$LJ^XLFSTR($E(T1,1,5),10)_$J($E(T2,1,5),5)
"RTN","ORCHTAB3",62,0)
 Q
"RTN","ORCHTAB3",63,0)
 ;
"RTN","ORCHTAB3",64,0)
VERIFIED() ; -- Returns string of verifiers' initials
"RTN","ORCHTAB3",65,0)
 N ORV,ORX,ORVER S ORVER=""
"RTN","ORCHTAB3",66,0)
 F ORV=8,10,18 D  ;ck nurse, clerk, and chart reviewers
"RTN","ORCHTAB3",67,0)
 . S ORX=$P(ORA0,U,ORV) I ORX'>0 S ORVER=ORVER_"       " Q
"RTN","ORCHTAB3",68,0)
 . S ORX=$$INITIALS(ORX),ORVER=ORVER_$$LJ^XLFSTR(ORX,7)
"RTN","ORCHTAB3",69,0)
 Q ORVER
"RTN","ORCHTAB3",70,0)
 ;
"RTN","ORCHTAB3",71,0)
INITIALS(USER) ; -- Return initials of USER
"RTN","ORCHTAB3",72,0)
 N X,Y S X=$G(^VA(200,+$G(USER),0)),Y=$P(X,U,2)
"RTN","ORCHTAB3",73,0)
 S:'$L(Y) Y=" x "
"RTN","ORCHTAB3",74,0)
 Q Y
"RTN","ORCHTAB3",75,0)
 ;
"RTN","ORCHTAB3",76,0)
MEDS ; -- medications
"RTN","ORCHTAB3",77,0)
 N ID,START,STOP,STATUS,ORIFN,TYPE,DATA,ORTX,PROV,I,X,IDX,ORJ
"RTN","ORCHTAB3",78,0)
 S ID=$P(ORX,U),STOP=$P(ORX,U,4),ORIFN=$P(ORX,U,8)
"RTN","ORCHTAB3",79,0)
 S PROV=$S($G(^TMP("PS",$J,ORI,"P",0)):+^(0),1:+$P($G(^OR(100,+ORIFN,0)),U,4))
"RTN","ORCHTAB3",80,0)
 S STATUS=$$LOW^XLFSTR($P(ORX,U,9)) S:STATUS["(edit)" STATUS="dc/edit"
"RTN","ORCHTAB3",81,0)
 S:STATUS="suspended" STATUS="active/susp"
"RTN","ORCHTAB3",82,0)
 S:'INPT DATA(1)=$$PAD^ORCHTAB($$LNAMEF^ORCHTAB(PROV),12)_$$PAD^ORCHTAB($$DATE^ORCHTAB(STOP),10)_STATUS,DATA=1 I INPT D
"RTN","ORCHTAB3",83,0)
 . S START=$P($G(^OR(100,+ORIFN,0)),U,8),START=$$DATETIME^ORCHTAB(START)
"RTN","ORCHTAB3",84,0)
 . S STOP=$$DATETIME^ORCHTAB(STOP)
"RTN","ORCHTAB3",85,0)
 . S DATA(1)=$$PAD^ORCHTAB($P(START," "),10)_$$PAD^ORCHTAB($P(STOP," "),10)_STATUS
"RTN","ORCHTAB3",86,0)
 . S DATA=2,DATA(2)=$$PAD^ORCHTAB($P(START," ",2),10)_$P(STOP," ",2)
"RTN","ORCHTAB3",87,0)
 S TYPE=$S($O(^TMP("PS",$J,ORI,"B",0)):"IV",$O(^TMP("PS",$J,ORI,"A",0)):"IV",1:"DRUG") D @TYPE
"RTN","ORCHTAB3",88,0)
 D ADD^ORCHTAB K ORTX,DATA I INPT D
"RTN","ORCHTAB3",89,0)
 . S I=0 F  S I=$O(^TMP("PS",$J,ORI,"SIO",I)) Q:I'>0  S X=$G(^(I,0)) D:$L(X) TXT^ORCHTAB
"RTN","ORCHTAB3",90,0)
 . S I=0 F  S I=$O(ORTX(I)) Q:I'>0  S X=ORTX(I) D:$L(X) LINE^ORCHTAB
"RTN","ORCHTAB3",91,0)
 I 'INPT,$P(ORX,U,10) D
"RTN","ORCHTAB3",92,0)
 . S X=" Last Filled: "_$$DATE^ORCHTAB($P(ORX,U,10))_", "_+$P(ORX,U,5)_" refill(s) left"
"RTN","ORCHTAB3",93,0)
 . D LINE^ORCHTAB
"RTN","ORCHTAB3",94,0)
 S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NUM))
"RTN","ORCHTAB3",95,0)
 I $O(^OR(100,+ORIFN,8,"C","XX",0)) S ORJ=+$P(IDX,U,2),$E(^TMP("OR",$J,ORTAB,ORJ,0),5)="*" ;pkg updated
"RTN","ORCHTAB3",96,0)
 Q
"RTN","ORCHTAB3",97,0)
 ;
"RTN","ORCHTAB3",98,0)
DRUG ; -- UD or Outpt med
"RTN","ORCHTAB3",99,0)
 N I,X,NODE S X=$P(ORX,U,2),NODE="" ; drug name
"RTN","ORCHTAB3",100,0)
 I 'INPT,$P(ORX,U,12) S X=X_"  Qty: "_$P(ORX,U,12)_$S($P(ORX,U,11):" for "_$P(ORX,U,11)_" days",1:"")
"RTN","ORCHTAB3",101,0)
 S:$L(X)'>ORMAX ORTX=1,ORTX(1)=X I $L(X)>ORMAX D TXT^ORCHTAB
"RTN","ORCHTAB3",102,0)
 S ORTX=ORTX+1,ORTX(ORTX)=$S(INPT:" Give:",1:" Sig:")_$S($P(ORX,U,13):" *** NOT TO BE GIVEN ***",1:"")
"RTN","ORCHTAB3",103,0)
 I INPT S X=$S($L($P(ORX,U,6)):$P(ORX,U,6),1:$P(ORX,U,7)) I $L(X) D TXT^ORCHTAB G D1
"RTN","ORCHTAB3",104,0)
 S NODE=$S(INPT:"SIG",$O(^TMP("PS",$J,ORI,"SIG",0)):"SIG",1:"SIO")
"RTN","ORCHTAB3",105,0)
 S I=0 F  S I=$O(^TMP("PS",$J,ORI,NODE,I)) Q:I'>0  S X=$G(^(I,0)) D:$L(X) TXT^ORCHTAB ; instructions or sig
"RTN","ORCHTAB3",106,0)
D1 I 'INPT,NODE'="SIO" Q  ; done
"RTN","ORCHTAB3",107,0)
 S I=$O(^TMP("PS",$J,ORI,"MDR",0)),X=$G(^(+I,0)) D:$L(X) TXT^ORCHTAB
"RTN","ORCHTAB3",108,0)
 S I=$O(^TMP("PS",$J,ORI,"SCH",0)),X=$P($G(^(+I,0)),U) D:$L(X) TXT^ORCHTAB
"RTN","ORCHTAB3",109,0)
 Q
"RTN","ORCHTAB3",110,0)
 ;
"RTN","ORCHTAB3",111,0)
IV ; -- IV Fluid
"RTN","ORCHTAB3",112,0)
 N I,X,X0,Y
"RTN","ORCHTAB3",113,0)
 S I=0,X="" F  S I=$O(^TMP("PS",$J,ORI,"A",I)) Q:I'>0  S X=X_$S($L(X):", ",1:"")_$TR(^(I,0),"^"," ")
"RTN","ORCHTAB3",114,0)
 I $L(X) S X=X_" in" D TXT^ORCHTAB
"RTN","ORCHTAB3",115,0)
 S I=0,X="" F  S I=$O(^TMP("PS",$J,ORI,"B",I)) Q:I'>0  S X0=$G(^(I,0)) D
"RTN","ORCHTAB3",116,0)
 . S Y=$P(X0,U)_" "_$S($L($P(X0,U,3)):$P(X0,U,3)_" ",1:"")_$P(X0,U,2)
"RTN","ORCHTAB3",117,0)
 . S X=X_$S($L(X):", ",1:"")_Y
"RTN","ORCHTAB3",118,0)
 D:$L(X) TXT^ORCHTAB S I=$O(^TMP("PS",$J,ORI,"SCH",0))
"RTN","ORCHTAB3",119,0)
 I I S X=$P($G(^(I,0)),U) D:$L(X) TXT^ORCHTAB Q  ;add schedule and Q if exists
"RTN","ORCHTAB3",120,0)
 S X=$P(ORX,U,3) D:$L(X) TXT^ORCHTAB ;infusion rate
"RTN","ORCHTAB3",121,0)
 Q
"RTN","ORCHTAB3",122,0)
 ;
"RTN","ORCHTAB3",123,0)
SORT(TYPE) ; -- sort Meds tab by status into ^TMP("ORPS",$J,STS)
"RTN","ORCHTAB3",124,0)
 N ACTIVE,NONACT,NONVER,I,X,ID,STS,SUB
"RTN","ORCHTAB3",125,0)
 S ACTIVE="^ACTIVE^REINSTATED^RENEWED^HOLD^ON CALL^SUSPENDED^REFILL^PROVIDER HOLD^",NONVER="^PENDING^NON-VERIFIED^NON VERIFIED^INCOMPLETE^DRUG INTERACTIONS^"
"RTN","ORCHTAB3",126,0)
 S NONACT="^DONE^EXPIRED^DISCONTINUED^DELETED^PURGE^DISCONTINUED (EDIT)^DISCONTINUED (RENEWAL)^DISCONTINUED BY PROVIDER^"
"RTN","ORCHTAB3",127,0)
 S I=0 F  S I=$O(^TMP("PS",$J,I)) Q:I'>0  S X=$G(^(I,0)) D
"RTN","ORCHTAB3",128,0)
 . S ID=$P(X,U) Q:INPT&($P(ID,";",2)'="I")  Q:'INPT&($P(ID,";",2)="I")
"RTN","ORCHTAB3",129,0)
 . S STS=U_$P(X,U,9)_U,SUB=$S(ACTIVE[STS:1,NONVER[STS:2,1:3),^TMP("ORPS",$J,SUB,I)=""
"RTN","ORCHTAB3",130,0)
 Q
"RTN","ORCMED")
0^21^B37573595
"RTN","ORCMED",1,0)
ORCMED ;SLC/MKB-Medication actions ;4/2/02  16:45
"RTN","ORCMED",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,7,38,48,94,141**;Dec 17, 1997
"RTN","ORCMED",3,0)
XFER ; -- transfer to in/outpt meds
"RTN","ORCMED",4,0)
 N ORPTLK,ORTYPE,ORXFER,ORCAT,OREVENT,X,ORINPT,ORIDLG,ORODLG,ORIVDLG,ORNMSP,ORCNT,ORI,NMBR,ORIFN,OLDIFN,ORDIALOG,ORDG,ORCHECK,ORQUIT,ORDUZ,ORLOG,FIRST,ORDITM,ORD,ORERR
"RTN","ORCMED",5,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK D  G XFQ ; lock pt chart
"RTN","ORCMED",6,0)
 . W !!,$C(7),$P(ORPTLK,U,2) H 2
"RTN","ORCMED",7,0)
 . S:'$D(VALMBCK) VALMBCK=""
"RTN","ORCMED",8,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("transfer") G:'ORNMBR XFQ
"RTN","ORCMED",9,0)
 D FULL^VALM1 S VALMBCK="R",ORTYPE="Q",ORXFER=1,ORDUZ=DUZ
"RTN","ORCMED",10,0)
 S X=$P($P($G(^TMP("OR",$J,"CURRENT",0)),U,3),";",3) S:X="" X=$G(ORWARD)
"RTN","ORCMED",11,0)
 S ORCAT=$S(X:"O",1:"I") I ORCAT="I"!$G(ORWARD) D  Q:$G(OREVENT)="^"
"RTN","ORCMED",12,0)
 . W !!,$$CURRENT^OREVNT
"RTN","ORCMED",13,0)
 . S X=$$DELAY^ORCACT I X="^" S OREVENT="^" Q
"RTN","ORCMED",14,0)
 . S:X OREVENT=+$$PTEVENT^OREVNT(+ORVP,1)
"RTN","ORCMED",15,0)
 I '$G(ORL) S ORL=$S($G(OREVENT):$$LOC^OREVNTX(OREVENT),1:$$LOCATION^ORCMENU1) G:ORL="^" XFQ
"RTN","ORCMED",16,0)
 S ORINPT=$$INPT^ORCD,ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" XFQ
"RTN","ORCMED",17,0)
 S ORIDLG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORCMED",18,0)
 S ORODLG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORCMED",19,0)
 S ORIVDLG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORCMED",20,0)
 D PROVIDER^ORCDPSIV G:$G(ORQUIT) XFQ ;X:$D(^ORD(101.41,ORDIALOG,3)) ^(3)
"RTN","ORCMED",21,0)
 S ORNMSP="PS" D DISPLAY^ORCHECK
"RTN","ORCMED",22,0)
 S ORCNT=$L(ORNMBR,",") S:$P(ORNMBR,",",ORCNT)'>0 ORCNT=ORCNT-1
"RTN","ORCMED",23,0)
XF1 F ORI=1:1:ORCNT S NMBR=$P(ORNMBR,",",ORI) D:NMBR  I $D(ORQUIT),ORI<ORCNT Q:'$$CONT  ;if not last one, ask
"RTN","ORCMED",24,0)
 . K ORIFN,ORDIALOG,ORDG,ORDOSE,ORCHECK,ORQUIT,ORERR
"RTN","ORCMED",25,0)
 . K ^TMP("PSJMR",$J),^TMP("ORWORD",$J),^TMP("ORSIG",$J)
"RTN","ORCMED",26,0)
 . S OLDIFN=+$P($G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),U,4)
"RTN","ORCMED",27,0)
 . S ORDITM=$$ORDITEM^ORCACT(OLDIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCMED",28,0)
 . I '$$VALID^ORCACT0(OLDIFN,"XFR",.ORERR) W !,ORERR H 2 Q
"RTN","ORCMED",29,0)
 . S ORD=$P($G(^OR(100,OLDIFN,0)),U,5) Q:ORD'["101.41"  ;error msg?
"RTN","ORCMED",30,0)
 . S ORDIALOG=$S(+ORD=ORIVDLG:ORIVDLG,ORCAT="I":ORIDLG,1:ORODLG)
"RTN","ORCMED",31,0)
 . S ORDG=+$P($G(^ORD(101.41,ORDIALOG,0)),U,5)
"RTN","ORCMED",32,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(OLDIFN)
"RTN","ORCMED",33,0)
 . I ORDIALOG'=ORIVDLG D OUT:ORCAT="I",IN:ORCAT="O" ;convert data
"RTN","ORCMED",34,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)
"RTN","ORCMED",35,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX NOW"),1)
"RTN","ORCMED",36,0)
 . S ORLOG=+$E($$NOW^XLFDT,1,12),FIRST=1
"RTN","ORCMED",37,0)
XF2 . D DIALOG^ORCDLG Q:$G(ORQUIT)&FIRST  K ORQUIT
"RTN","ORCMED",38,0)
 . D ACCEPT^ORCHECK(),DISPLAY^ORCDLG S X=$$OK^ORCDLG I X="^" S ORQUIT=1 Q
"RTN","ORCMED",39,0)
 . I X="E" K ORCHECK S FIRST=0 G XF2
"RTN","ORCMED",40,0)
 . I X="C" W !?10,"... order cancelled.",! Q
"RTN","ORCMED",41,0)
 . I X="P" D
"RTN","ORCMED",42,0)
 . . D EN^ORCSAVE W !?10,$S(ORIFN:"... order placed.",1:"ERROR"),!
"RTN","ORCMED",43,0)
 . . S:$G(ORIFN) ^TMP("ORNEW",$J,ORIFN,1)=""
"RTN","ORCMED",44,0)
 . . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^(ORDIALOG)=ORDIALOG M:$D(^TMP("ORWORD",$J)) ^TMP("ORECALL",$J,ORDIALOG)=^TMP("ORWORD",$J) ;save 1st values
"RTN","ORCMED",45,0)
XFQ D EXIT^ORCDPS1 ;X:$D(^ORD(101.41,ORDIALOG,4)) ^(4)
"RTN","ORCMED",46,0)
 K ^TMP("ORWORD",$J),^TMP("ORSIG",$J)
"RTN","ORCMED",47,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMED",48,0)
 Q
"RTN","ORCMED",49,0)
 ;
"RTN","ORCMED",50,0)
IN ; -- Kill extra values, Reset ID's/DD from Inpt dialog
"RTN","ORCMED",51,0)
 N P F P="START DATE/TIME","NOW" K ORDIALOG($$PTR(P),1)
"RTN","ORCMED",52,0)
 D DOSES("O")
"RTN","ORCMED",53,0)
 Q
"RTN","ORCMED",54,0)
 ;
"RTN","ORCMED",55,0)
OUT ; -- Kill extra values, Reset ID's/DD from Outpt dialog
"RTN","ORCMED",56,0)
 N P I '$O(ORDIALOG($$PTR("INSTRUCTIONS"),0)) D  ;old sig in comments
"RTN","ORCMED",57,0)
 . N WP S WP=$$PTR("WORD PROCESSING 1") K ^TMP("ORSIG",$J)
"RTN","ORCMED",58,0)
 . M ^TMP("ORSIG",$J)=^TMP("ORWORD",$J,WP,1)
"RTN","ORCMED",59,0)
 . K ORDIALOG(WP,1),^TMP("ORWORD",$J,WP,1)
"RTN","ORCMED",60,0)
 F P="PATIENT INSTRUCTIONS","START DATE/TIME","DAYS SUPPLY","QUANTITY","REFILLS","ROUTING","SERVICE CONNECTED" K ORDIALOG($$PTR(P),1)
"RTN","ORCMED",61,0)
 I $G(ORDIALOG($$PTR("URGENCY"),1))=99 K ORDIALOG($$PTR("URGENCY"),1)
"RTN","ORCMED",62,0)
 D DOSES("I")
"RTN","ORCMED",63,0)
 Q
"RTN","ORCMED",64,0)
 ;
"RTN","ORCMED",65,0)
DOSES(TYPE)     ; -- Convert doses to new TYPE, reset ID strings
"RTN","ORCMED",66,0)
 N PSOI,PROMPT,DOSE,I,X,DD,ID
"RTN","ORCMED",67,0)
 F I="DISPENSE DRUG","STRENGTH","DRUG NAME","SIG" K ORDIALOG($$PTR(I),1)
"RTN","ORCMED",68,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(ORDIALOG($$PTR("ORDERABLE ITEM"),1)),0)),U,2)
"RTN","ORCMED",69,0)
 D DOSE^PSSORUTL(.ORDOSE,PSOI,TYPE,+ORVP) I $G(ORDOSE(1))=-1 K ORDOSE ;Q
"RTN","ORCMED",70,0)
 S PROMPT=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE") D D1^ORCDPS2
"RTN","ORCMED",71,0)
 S I=0 F  S I=$O(ORDIALOG(PROMPT,I)) Q:I'>0  D
"RTN","ORCMED",72,0)
 . K ORDIALOG(DOSE,I) S X=$G(ORDIALOG(PROMPT,I)) Q:'$L(X)
"RTN","ORCMED",73,0)
 . S X=$$UP^XLFSTR(X),DD=+$G(ORDIALOG(PROMPT,"LIST","D",X))
"RTN","ORCMED",74,0)
 . S:DD ORDIALOG(DOSE,I)=$TR($G(ORDOSE("DD",DD,X)),"^","&")
"RTN","ORCMED",75,0)
 Q
"RTN","ORCMED",76,0)
 ;
"RTN","ORCMED",77,0)
CONT() ; -- Want to continue processing orders?
"RTN","ORCMED",78,0)
 N X,Y,DIR
"RTN","ORCMED",79,0)
 S DIR(0)="YA",DIR("A")="Do you want to continue transferring orders? ",DIR("B")="YES"
"RTN","ORCMED",80,0)
 S DIR("?")="Enter YES to continue transferring the remaining orders selected, or NO to quit this option."
"RTN","ORCMED",81,0)
 D ^DIR
"RTN","ORCMED",82,0)
 Q +Y
"RTN","ORCMED",83,0)
 ;
"RTN","ORCMED",84,0)
SHOWSIG ; -- Show old sig for transfer in ^TMP("ORSIG",$J)
"RTN","ORCMED",85,0)
 N ORTX,I,X,ORMAX S ORMAX=72
"RTN","ORCMED",86,0)
 S I=0 F  S I=$O(^TMP("ORSIG",$J,I)) Q:I'>0  S X=$G(^(I,0)) D:$L(X) TXT^ORCHTAB
"RTN","ORCMED",87,0)
 S I=0 F  S I=$O(ORTX(I)) Q:I'>0  W !,$S(I=1:"(Sig: ",1:"      ")_ORTX(I)
"RTN","ORCMED",88,0)
 W ")"
"RTN","ORCMED",89,0)
 Q
"RTN","ORCMED",90,0)
 ;
"RTN","ORCMED",91,0)
PTR(NAME) ; -- Returns pointer to OR GTX NAME
"RTN","ORCMED",92,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORCMED",93,0)
 ;
"RTN","ORCMED",94,0)
REFILLS ; -- Request a refill for med orders
"RTN","ORCMED",95,0)
 ;    ORNMBR = #,#,...,# of selected orders
"RTN","ORCMED",96,0)
 ;
"RTN","ORCMED",97,0)
 N ORLK,ORI,NMBR,IDX,ORIFN,ORDITM,ORERR,ORQUIT,OROUT
"RTN","ORCMED",98,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR RFQ
"RTN","ORCMED",99,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCMED",100,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" RFQ
"RTN","ORCMED",101,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 G:ORL="^" RFQ
"RTN","ORCMED",102,0)
 S OROUT=$$ROUTING G:OROUT="^" RFQ
"RTN","ORCMED",103,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","ORCMED",104,0)
 . S IDX=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR)),ORIFN=+$P(IDX,U,4)
"RTN","ORCMED",105,0)
 . Q:'ORIFN  I '$D(^OR(100,ORIFN,0)) W !,"Invalid order number!" H 2 Q
"RTN","ORCMED",106,0)
 . S ORDITM=$$ORDITEM^ORCACT(ORIFN) D SUBHDR^ORCACT(ORDITM)
"RTN","ORCMED",107,0)
 . I '$$VALID^ORCACT0(ORIFN,"RF",.ORERR) W !,ORERR H 2 Q
"RTN","ORCMED",108,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !,$P(ORLK,U,2) H 2 Q
"RTN","ORCMED",109,0)
 . D REF^ORMBLDPS(ORIFN,OROUT),UNLK1^ORX2(+ORIFN)
"RTN","ORCMED",110,0)
 . W !?10,"... refill requested.",$$RETURN
"RTN","ORCMED",111,0)
RFQ Q
"RTN","ORCMED",112,0)
 ;
"RTN","ORCMED",113,0)
RETURN() ; -- press return to cont
"RTN","ORCMED",114,0)
 N X W !,"Press <return> to continue ..." R X:DTIME
"RTN","ORCMED",115,0)
 Q ""
"RTN","ORCMED",116,0)
 ;
"RTN","ORCMED",117,0)
ROUTING() ; -- Routing for refill
"RTN","ORCMED",118,0)
 N X,Y,DIR S DIR(0)="SAM^W:WINDOW;M:MAIL;C:ADMINISTERED IN CLINIC;"
"RTN","ORCMED",119,0)
 S DIR("A")="Routing: ",DIR("B")=$S($D(^PSX(550,"C")):"MAIL",1:"WINDOW")
"RTN","ORCMED",120,0)
 S DIR("?")="Select how the patient is to receive this refill, by mail or at the window or in the clinic"
"RTN","ORCMED",121,0)
 D ^DIR S:$D(DTOUT)!(X["^") Y="^"
"RTN","ORCMED",122,0)
 Q Y
"RTN","ORCMED",123,0)
 ;
"RTN","ORCMED",124,0)
NW ; -- Order New Medication from Meds tab
"RTN","ORCMED",125,0)
 ;    Requires ORDIALOG      = name of pkg dialog
"RTN","ORCMED",126,0)
 ;             OREVENT       = event, if delaying orders
"RTN","ORCMED",127,0)
 ;             OREVENT("TS") = treating spec, if admission or transfer
"RTN","ORCMED",128,0)
 N ORPTLK G:'$L($G(ORDIALOG)) NWQ
"RTN","ORCMED",129,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","ORCMED",130,0)
 D FREEZE^ORCMENU S VALMBCK="R"
"RTN","ORCMED",131,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" NWQ
"RTN","ORCMED",132,0)
 I '$G(ORL) S ORL=$S($G(OREVENT):$$LOC^OREVNTX(OREVENT),1:$$LOCATION^ORCMENU1) G:ORL["^" NWQ
"RTN","ORCMED",133,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",$E(ORDIALOG,1,63),0)) G:'ORDIALOG NWQ
"RTN","ORCMED",134,0)
 D ADD^ORCDLG,REBLD^ORCMENU:$D(^TMP("ORNEW",$J))
"RTN","ORCMED",135,0)
 K ORDIALOG,^TMP("ORWORD",$J),^TMP("ORECALL",$J) S VALMBCK="R"
"RTN","ORCMED",136,0)
NWQ D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMED",137,0)
 Q
"RTN","ORCMENU")
0^22^B39400354
"RTN","ORCMENU",1,0)
ORCMENU ;SLC/MKB-Add Orders menus ; 08 May 2002  2:12 PM
"RTN","ORCMENU",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,41,46,48,141**;Dec 17, 1997
"RTN","ORCMENU",3,0)
 ;
"RTN","ORCMENU",4,0)
EN ; -- main entry point
"RTN","ORCMENU",5,0)
 Q:'+$G(ORVP)  ;I '+$G(ORVP) D EN^ORQPT Q:'+$G(ORVP)
"RTN","ORCMENU",6,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK D  Q  ; lock pt chart
"RTN","ORCMENU",7,0)
 . W !!,$C(7),$P(ORPTLK,U,2) H 2 S VALMBCK=""
"RTN","ORCMENU",8,0)
 I $G(OREVENT),$G(^ORE(100.2,+OREVENT,1)) W !!,$C(7),$$NAME^OREVNTX(OREVENT)_" has been terminated!" H 2 S VALMBCK="" Q
"RTN","ORCMENU",9,0)
 D FULL^VALM1 S VALMBCK="R",ORACTION=0
"RTN","ORCMENU",10,0)
 W !!,"<"_$S($G(OREVENT):"Delayed ",1:"")_"Orders for "_$P($G(^DPT(+ORVP,0)),U)_">"
"RTN","ORCMENU",11,0)
 I $G(OREVENT) D  ;show delay message
"RTN","ORCMENU",12,0)
 . W !!,"Now writing orders for "_$$NAME^OREVNTX(OREVENT)
"RTN","ORCMENU",13,0)
 . W !,"(To add orders for current release rather than delayed, quit the following"
"RTN","ORCMENU",14,0)
 . W !,"menu and return to viewing Active Orders via the Delayed Orders action.)"
"RTN","ORCMENU",15,0)
 . W !!,"Press <return> to continue ..." N X R X:DTIME
"RTN","ORCMENU",16,0)
 I '$G(ORL),'$G(OREVENT) S ORL=$$LOCATION^ORCMENU1 G:ORL["^" ENQ
"RTN","ORCMENU",17,0)
 S ORNP=$$PROVIDER^ORCMENU1 G:ORNP="^" ENQ
"RTN","ORCMENU",18,0)
 S ORENT="ALL^"_$G(ORL)_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","ORCMENU",19,0)
 S ORMENU=$$GET^XPAR(ORENT,"OR ADD ORDERS MENU") Q:ORMENU'>0
"RTN","ORCMENU",20,0)
 D EN^VALM("OR ADD ORDERS MENU"),REBLD:$D(ORTAB)
"RTN","ORCMENU",21,0)
ENQ K ORPTLK,OREBUILD,ORMENU,ORENT,^TMP("ORMENU",$J),^TMP("ORECALL",$J),ZTSAVE
"RTN","ORCMENU",22,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) ;unlock if no new orders
"RTN","ORCMENU",23,0)
 Q
"RTN","ORCMENU",24,0)
 ;
"RTN","ORCMENU",25,0)
REBLD ; -- Rebuild tab listings
"RTN","ORCMENU",26,0)
 I $G(ORTAB)="ORDERS" D TAB^ORCHART(ORTAB,1) Q
"RTN","ORCMENU",27,0)
 S:$D(^TMP("OR",$J,"ORDERS",0)) $P(^(0),U)="" ; force rebld of Orders tab
"RTN","ORCMENU",28,0)
 D:$G(ORTAB)="NEW" INIT^ORCMENU2 ; called from RV - rebuild list
"RTN","ORCMENU",29,0)
 Q
"RTN","ORCMENU",30,0)
 ;
"RTN","ORCMENU",31,0)
INIT ; -- init variables and list array
"RTN","ORCMENU",32,0)
 ;    Requires ORMENU  = IFN of menu in Order Dialog file #101.41
"RTN","ORCMENU",33,0)
 ;    Optional OREVENT = Event pointer
"RTN","ORCMENU",34,0)
 ;
"RTN","ORCMENU",35,0)
 N X,CW,MW,TITLE,ROWS,ROW,COL,Z,CNT,MNEM,TEXT,POS,ITEM,IFN,PROTOCL,FLAG,XQORM
"RTN","ORCMENU",36,0)
 S Z=$$MSG^ORXD(+ORMENU) I Z W !!,$P(Z,U,2) S VALMQUIT=1 H 2 Q  ;disabled
"RTN","ORCMENU",37,0)
 S Z=$$LOCK^ORDD41(+ORMENU) I 'Z W !!,$P(Z,U,2) S VALMQUIT=1 H 2 Q
"RTN","ORCMENU",38,0)
 X:$D(^ORD(101.41,ORMENU,3)) ^(3) I $D(ORFORGET) D  K ORFORGET
"RTN","ORCMENU",39,0)
 . I ORFORGET K ^TMP("ORECALL",$J,+ORFORGET) ;kill dlg
"RTN","ORCMENU",40,0)
 . E  K ^TMP("ORECALL",$J) ;kill all
"RTN","ORCMENU",41,0)
 S CW=$P($G(^ORD(101.41,ORMENU,5)),U),MW=$P($G(^(5)),U,2),TITLE=$P(^(0),U,2)
"RTN","ORCMENU",42,0)
 S:'CW CW=80 S:'MW MW=5 S ROWS=$$ROWS(ORMENU) I 'ROWS S VALMQUIT=1 Q
"RTN","ORCMENU",43,0)
 S PROTOCL=$O(^ORD(101,"B","ORC ADD ITEM",0))_"^1"
"RTN","ORCMENU",44,0)
 S (POS,CNT)=0,XQORM=ORMENU_";ORD(101.41,"
"RTN","ORCMENU",45,0)
IN1 F  S POS=$O(^XUTL("XQORM",XQORM,POS)) Q:POS'>0  S ITEM=^(POS,0) D
"RTN","ORCMENU",46,0)
 . S ROW=$P(POS,"."),COL=$$COLUMN($P(POS,".",2),CW) Q:ROW'>0
"RTN","ORCMENU",47,0)
 . S IFN=$P(ITEM,U,2),TEXT=$P(ITEM,U,3),MNEM=$P(ITEM,U,4),FLAG=$P(ITEM,U,5)
"RTN","ORCMENU",48,0)
 . I FLAG="H" S Z=$E(TEXT,1,CW) D SETVIDEO(ROW,COL,$L(Z),IOUON,IOUOFF)
"RTN","ORCMENU",49,0)
 . I FLAG'="H" S Z=MNEM_$E("         ",1,MW-$L(MNEM))_$E(TEXT,1,CW-MW)
"RTN","ORCMENU",50,0)
 . S X(ROW,0)=$$SETSTR^VALM1(Z,$G(X(ROW,0)),COL,CW),CNT=CNT+1
"RTN","ORCMENU",51,0)
 . I $L(MNEM) S X("KEY",MNEM)=PROTOCL S:'$L(FLAG)&IFN X("IDX",MNEM)=IFN_U_POS D SETVIDEO(ROW,COL,MW,IOINHI,IOINORM)
"RTN","ORCMENU",52,0)
 S X("KEY","ALL")=$O(^ORD(101,"B","ORC ADD ALL ITEMS",0))_"^1"
"RTN","ORCMENU",53,0)
 S X("KEY","CWAD")=$O(^ORD(101,"B","ORC CWAD DISPLAY",0))_"^1"
"RTN","ORCMENU",54,0)
 S X("KEY","PI")=$O(^ORD(101,"B","ORC PATIENT INQUIRY",0))_"^1"
"RTN","ORCMENU",55,0)
INQ S X(0)=ROWS_U_CNT_U_CW_U_MW_U_$G(OREVENT),VALMCNT=ROWS
"RTN","ORCMENU",56,0)
 M ^TMP("ORMENU",$J,ORMENU)=X,^TMP("VALM VIDEO",$J,VALMEVL)=X("VIDEO")
"RTN","ORCMENU",57,0)
 I $L(TITLE),$$UP^XLFSTR(TITLE)'?1"ADD ".E S TITLE="Add "_TITLE
"RTN","ORCMENU",58,0)
 S VALM("TITLE")=$S($L(TITLE):TITLE,1:"Add New Orders")_$S($G(OREVENT):" for Delay",1:"")
"RTN","ORCMENU",59,0)
 Q
"RTN","ORCMENU",60,0)
 ;
"RTN","ORCMENU",61,0)
ROWS(MENU) ; -- Returns the number of rows in MENU
"RTN","ORCMENU",62,0)
 N MAX,I,R S MAX=0
"RTN","ORCMENU",63,0)
 S I=0 F  S I=$O(^ORD(101.41,MENU,10,"B",I)) Q:I=""  S R=$P(I,".") I R>MAX S MAX=R
"RTN","ORCMENU",64,0)
 Q MAX
"RTN","ORCMENU",65,0)
 ;
"RTN","ORCMENU",66,0)
COLUMN(NUM,WIDTH) ; -- Returns position of column NUM per WIDTH
"RTN","ORCMENU",67,0)
 N Y S:'$G(NUM) NUM=1 S:'$G(WIDTH) WIDTH=80
"RTN","ORCMENU",68,0)
 S Y=(NUM-1)*WIDTH+1
"RTN","ORCMENU",69,0)
 Q Y
"RTN","ORCMENU",70,0)
 ;
"RTN","ORCMENU",71,0)
SETVIDEO(LINE,COL,WIDTH,ON,OFF) ; -- set video attributes
"RTN","ORCMENU",72,0)
 S X("VIDEO",LINE,COL,WIDTH)=ON,X("VIDEO",LINE,COL+WIDTH,0)=OFF
"RTN","ORCMENU",73,0)
 Q
"RTN","ORCMENU",74,0)
 ;
"RTN","ORCMENU",75,0)
MSG() ; -- Message bar
"RTN","ORCMENU",76,0)
 Q "Enter the number of each item you wish to order."
"RTN","ORCMENU",77,0)
 ;
"RTN","ORCMENU",78,0)
HELP ; -- help code
"RTN","ORCMENU",79,0)
 N X D FULL^VALM1 S VALMBCK="R"
"RTN","ORCMENU",80,0)
 W !!,"Enter the items you wish to order for this patient, as a list or range of",!,"numbers.  When you are done placing orders, enter Q to return to the",!,"patient's chart."
"RTN","ORCMENU",81,0)
 W !!,"You may also enter PI to get additional patient information, or CWAD for",!,"access to this patient's crisis and warning notes."
"RTN","ORCMENU",82,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCMENU",83,0)
 Q
"RTN","ORCMENU",84,0)
 ;
"RTN","ORCMENU",85,0)
KILL ; -- Cleanup after Add New Orders option
"RTN","ORCMENU",86,0)
 I $D(^TMP("ORNEW",$J)) D EN^ORCMENU2,NOTIF^ORCMENU2 ; sign & release
"RTN","ORCMENU",87,0)
 K ORVP,ORSEX,ORPNM,ORSSN,ORL,ORDOB,ORAGE,ORPD,ORNP,ORSC,ORTS,ORWARD,ORATTEND,OREBUILD,^TMP("ORNEW",$J)
"RTN","ORCMENU",88,0)
 Q
"RTN","ORCMENU",89,0)
 ;
"RTN","ORCMENU",90,0)
EXIT ; -- exit code
"RTN","ORCMENU",91,0)
 X:$D(^ORD(101.41,ORMENU,4)) ^(4) ; exit action
"RTN","ORCMENU",92,0)
 K ^TMP("ORMENU",$J,ORMENU) D UNLOCK^ORDD41(+ORMENU)
"RTN","ORCMENU",93,0)
 Q
"RTN","ORCMENU",94,0)
 ;
"RTN","ORCMENU",95,0)
ALT ; -- XQORM("ALT") lookup
"RTN","ORCMENU",96,0)
 N XQORM,Y,ORX,ORY,ORI,IFN,POS,ITEM
"RTN","ORCMENU",97,0)
 S ORX=X D FULL^VALM1 S VALMBCK="R",X=ORX
"RTN","ORCMENU",98,0)
 S XQORM=+ORMENU_";ORD(101.41,",XQORM(0)="E"
"RTN","ORCMENU",99,0)
 D EN^XQORM Q:Y'>0  M ORY=Y S ORI=0
"RTN","ORCMENU",100,0)
 F  S ORI=$O(ORY(ORI)) Q:ORI'>0  S X=$P(ORY(ORI),U,4),IFN=$P(ORY(ORI),U,2),ITEM=$G(^ORD(101.41,+ORMENU,10,+$P(ORY(ORI),U),0)),POS=$P(ITEM,U) D ITM Q:$G(XQORPOP)
"RTN","ORCMENU",101,0)
 Q
"RTN","ORCMENU",102,0)
 ;
"RTN","ORCMENU",103,0)
ALL ; -- process all menu items
"RTN","ORCMENU",104,0)
 N ORI,ITEM,X,IFN,POS S ORI=""
"RTN","ORCMENU",105,0)
 F  S ORI=$O(^TMP("ORMENU",$J,+ORMENU,"IDX",ORI)) Q:ORI=""  S X=ORI,ITEM=$G(^(ORI)),IFN=+$P(ITEM,U),POS=$P(ITEM,U,2) D ITM Q:$G(XQORPOP)
"RTN","ORCMENU",106,0)
 Q
"RTN","ORCMENU",107,0)
 ;
"RTN","ORCMENU",108,0)
ITEM ; -- process menu item
"RTN","ORCMENU",109,0)
 N X,ITEM,IFN,POS S VALMBCK="R"
"RTN","ORCMENU",110,0)
 S X=$P(XQORNOD(0),U,3),ITEM=$G(^TMP("ORMENU",$J,ORMENU,"IDX",X))
"RTN","ORCMENU",111,0)
 S IFN=+$P(ITEM,U) Q:'IFN  S POS=$P(ITEM,U,2)
"RTN","ORCMENU",112,0)
ITM ; -- may enter here with IFN=Dlg, POS=position
"RTN","ORCMENU",113,0)
 N ROW,COL,CW,MW,TYPE,ORIT,PS S VALMBCK="R"
"RTN","ORCMENU",114,0)
 S ROW=$P(POS,"."),COL=$P(POS,".",2) S:'COL COL=1
"RTN","ORCMENU",115,0)
 S CW=$P(^TMP("ORMENU",$J,ORMENU,0),U,3),MW=$P(^(0),U,4),COL=COL-1*CW+1
"RTN","ORCMENU",116,0)
 D CNTRL^VALM10(ROW,COL+MW,CW-MW,IORVON,IORVOFF)
"RTN","ORCMENU",117,0)
 S TYPE=$P($G(^ORD(101.41,IFN,0)),U,4)
"RTN","ORCMENU",118,0)
 D MENU:TYPE="M" I TYPE'="M" S ORIT=IFN D FREEZE,EN^ORCDLG(IFN)
"RTN","ORCMENU",119,0)
 S:$G(DIROUT) XQORPOP=1 ; stop processing items
"RTN","ORCMENU",120,0)
 S PS=$P($G(^ORD(101.41,ORMENU,5)),U,3),VALMBCK=$S(PS:"R",1:"Q")
"RTN","ORCMENU",121,0)
 Q
"RTN","ORCMENU",122,0)
 ;
"RTN","ORCMENU",123,0)
MENU ; -- display sub-menu
"RTN","ORCMENU",124,0)
 N ORMENU S ORMENU=IFN
"RTN","ORCMENU",125,0)
 D EN^VALM("OR ADD ORDERS MENU")
"RTN","ORCMENU",126,0)
 Q
"RTN","ORCMENU",127,0)
 ;
"RTN","ORCMENU",128,0)
ORDER ; -- place order(s)
"RTN","ORCMENU",129,0)
 N ORDIALOG,ORIT,TITLE D FREEZE
"RTN","ORCMENU",130,0)
 S (ORIT,ORDIALOG)=IFN,TITLE=$P($G(^ORD(101.41,+ORDIALOG,0)),U,2)
"RTN","ORCMENU",131,0)
 W !!,?(36-($L(TITLE)\2)),"-- "_TITLE_" --"
"RTN","ORCMENU",132,0)
 D SET^ORCDLG:TYPE="O",ADD^ORCDLG:TYPE'="O" ; order set or single order?
"RTN","ORCMENU",133,0)
 K ^TMP("ORWORD",$J)
"RTN","ORCMENU",134,0)
 Q
"RTN","ORCMENU",135,0)
 ;
"RTN","ORCMENU",136,0)
SEARCH ; -- free text search of Orderable Items file
"RTN","ORCMENU",137,0)
 N ORDIALOG,DIC,OI
"RTN","ORCMENU",138,0)
 S OI=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0)),VALMBCK="R"
"RTN","ORCMENU",139,0)
 S DIC=101.43,DIC(0)="AEQM",DIC("A")="Select ORDER: "
"RTN","ORCMENU",140,0)
 D FULL^VALM1,^DIC Q:Y'>0
"RTN","ORCMENU",141,0)
 S ORDIALOG(OI,1)=Y ;,ORDIALOG=DG default dialog
"RTN","ORCMENU",142,0)
 D ADD^ORCDLG
"RTN","ORCMENU",143,0)
 S VALMBCK="R"
"RTN","ORCMENU",144,0)
 Q
"RTN","ORCMENU",145,0)
 ;
"RTN","ORCMENU",146,0)
FREEZE ; -- Freeze header, reset right margin
"RTN","ORCMENU",147,0)
 Q:'VALMCC  N X S X=IOM X ^%ZOSF("RM")
"RTN","ORCMENU",148,0)
 S IOTM=VALM("TM"),IOBM=IOSL W IOSC,@IOSTBM,IORC
"RTN","ORCMENU",149,0)
 Q
"RTN","ORCSAVE")
0^23^B54674269
"RTN","ORCSAVE",1,0)
ORCSAVE ;SLC/MKB-Save [ 08/09/96  11:28 PM ] ; 08 May 2002  2:12 PM
"RTN","ORCSAVE",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,56,70,73,92,94,116,141**;Dec 17, 1997
"RTN","ORCSAVE",3,0)
NEW(ORDIALOG,ORDG,ORPKG,ORCAT,OREVENT,ORDUZ,ORLOG) ; -- New order
"RTN","ORCSAVE",4,0)
 ; Returns ORIFN = [new] order number, if created/saved
"RTN","ORCSAVE",5,0)
 D EN
"RTN","ORCSAVE",6,0)
 Q
"RTN","ORCSAVE",7,0)
 ;
"RTN","ORCSAVE",8,0)
XX ; -- save new/unreleased edited order into Orders file
"RTN","ORCSAVE",9,0)
 ;    Requires: ORDIALOG() = array of dialog values
"RTN","ORCSAVE",10,0)
 ;              ORIFN      = IFN of original order that was edited
"RTN","ORCSAVE",11,0)
 ;  
"RTN","ORCSAVE",12,0)
 N OLDIFN S ORIFN=+ORIFN
"RTN","ORCSAVE",13,0)
 I $S($P(^OR(100,ORIFN,3),U,3)=11:0,$P(^(3),U,3)'=10:1,$P(^(8,1,0),U,4)=2:0,1:1) S OLDIFN=ORIFN K ORIFN ; create new order if released or delayed&signed
"RTN","ORCSAVE",14,0)
 D EN Q:'ORIFN  S:'$G(ORDA) ORDA=1
"RTN","ORCSAVE",15,0)
 I $G(OLDIFN) D  ;save links between orders
"RTN","ORCSAVE",16,0)
 . S $P(^OR(100,ORIFN,3),U,5)=OLDIFN,$P(^(3),U,11)=1
"RTN","ORCSAVE",17,0)
 . S $P(^OR(100,OLDIFN,3),U,6)=ORIFN S:$D(^(5)) ^OR(100,ORIFN,5)=^OR(100,OLDIFN,5)
"RTN","ORCSAVE",18,0)
 Q
"RTN","ORCSAVE",19,0)
 ;
"RTN","ORCSAVE",20,0)
RN ; -- save new/unreleased renewal order into Orders file
"RTN","ORCSAVE",21,0)
 ;    Requires: ORDIALOG() = array of new dialog values
"RTN","ORCSAVE",22,0)
 ;              ORIFN      = IFN of original order that was renewed
"RTN","ORCSAVE",23,0)
 ; 
"RTN","ORCSAVE",24,0)
 N OLDIFN S OLDIFN=+ORIFN K ORIFN
"RTN","ORCSAVE",25,0)
 D EN Q:'ORIFN  S:'$G(ORDA) ORDA=1
"RTN","ORCSAVE",26,0)
 S $P(^OR(100,ORIFN,3),U,5)=OLDIFN,$P(^(3),U,11)=2
"RTN","ORCSAVE",27,0)
 S $P(^OR(100,OLDIFN,3),U,6)=ORIFN S:$D(^(5)) ^OR(100,ORIFN,5)=^OR(100,OLDIFN,5)
"RTN","ORCSAVE",28,0)
 Q
"RTN","ORCSAVE",29,0)
 ;
"RTN","ORCSAVE",30,0)
EN ; -- save new/unreleased order in ORDIALOG() into Orders file
"RTN","ORCSAVE",31,0)
 ;    Requires: ORVP, ORNP [and ORL, ORTS if available]
"RTN","ORCSAVE",32,0)
 ;
"RTN","ORCSAVE",33,0)
 N PKG,NOW,NODE,CNT,CDL,I,X,STS,SIGNREQD,LOC,TRSPEC,NATR,CATG,DG,LOG,USR
"RTN","ORCSAVE",34,0)
 Q:'$G(ORVP)  Q:'$G(ORDIALOG)  Q:'$D(^ORD(101.41,+ORDIALOG,0))
"RTN","ORCSAVE",35,0)
 S NOW=$$NOW^XLFDT,SIGNREQD=+$P(^ORD(101.41,+ORDIALOG,0),U,6)
"RTN","ORCSAVE",36,0)
 S CATG=$S($L($G(ORCAT)):ORCAT,1:$S($$INPT^ORCD:"I",1:"O"))
"RTN","ORCSAVE",37,0)
 I $G(ORIFN),$D(^OR(100,ORIFN,0)) S STS=$P(^(3),U,3) G EN2 ; unrel order
"RTN","ORCSAVE",38,0)
 S PKG=$S($G(ORPKG):ORPKG,1:$P(^ORD(101.41,+ORDIALOG,0),U,7))
"RTN","ORCSAVE",39,0)
 S DG=$S($G(ORDG):+ORDG,1:$P(^ORD(101.41,+ORDIALOG,0),U,5))
"RTN","ORCSAVE",40,0)
 I $G(OREVENT),$$GET1^DIQ(9.4,+PKG_",",1)'="PSO" S LOC="",TRSPEC=""
"RTN","ORCSAVE",41,0)
 E  S LOC=$G(ORL),TRSPEC=$G(ORTS)
"RTN","ORCSAVE",42,0)
 S LOG=$S($G(ORLOG):ORLOG,1:+$E(NOW,1,12)),USR=$S($G(ORDUZ):ORDUZ,1:DUZ)
"RTN","ORCSAVE",43,0)
 S NATR=+$O(^ORD(100.02,"C","E",0)) ;assume Elec Entered until changed
"RTN","ORCSAVE",44,0)
 S STS=$S($G(OREVENT):10,1:11),ORIFN=$$NEXTIFN Q:'ORIFN
"RTN","ORCSAVE",45,0)
EN1 S ^OR(100,ORIFN,0)=ORIFN_U_ORVP_U_U_$G(ORNP)_U_+ORDIALOG_";ORD(101.41,^"_USR_U_LOG_U_U_U_LOC_U_DG_U_CATG_U_TRSPEC_U_PKG_U_U_SIGNREQD_U_$G(OREVENT)
"RTN","ORCSAVE",46,0)
 S ^OR(100,ORIFN,3)=LOG_"^90^"_STS_U_$S($G(ORIT):ORIT_";ORD(101.41,",1:"")_U_$G(ORDIALOG("PREV"))_"^^1^^^^0"
"RTN","ORCSAVE",47,0)
 S ^OR(100,ORIFN,8,0)="^100.008DA^1^1",^OR(100,ORIFN,8,1,0)=LOG_"^NW^"_$G(ORNP)_U_$S(SIGNREQD:2,1:3)_"^^^^^^^^"_NATR_U_USR_"^1^"_STS,^OR(100,ORIFN,8,"C","NW",1)=""
"RTN","ORCSAVE",48,0)
 S ^OR(100,"AF",LOG,ORIFN,1)=""
"RTN","ORCSAVE",49,0)
 S ^OR(100,"ACT",ORVP,9999999-LOG,+DG,ORIFN,1)=""
"RTN","ORCSAVE",50,0)
 S:STS'=10 ^OR(100,"AC",ORVP,9999999-LOG,ORIFN,1)=""
"RTN","ORCSAVE",51,0)
 S:SIGNREQD ^OR(100,"AS",ORVP,9999999-LOG,ORIFN,1)=""
"RTN","ORCSAVE",52,0)
 S:$G(OREVENT) ^OR(100,"AEVNT",ORVP,OREVENT,ORIFN)=""
"RTN","ORCSAVE",53,0)
EN2 S ORIFN=+ORIFN D RESPONSE ; save responses
"RTN","ORCSAVE",54,0)
 K ^OR(100,ORIFN,8,1,.1) D ORDTEXT^ORCSAVE1(ORIFN_";1") ; order text
"RTN","ORCSAVE",55,0)
 S NODE=$G(^OR(100,ORIFN,0)) D  S ^OR(100,ORIFN,0)=NODE
"RTN","ORCSAVE",56,0)
 . S $P(NODE,U,4)=$G(ORNP) ; COST?
"RTN","ORCSAVE",57,0)
 . S I=$O(^OR(100,ORIFN,4.5,"ID","LOCATION",0))
"RTN","ORCSAVE",58,0)
 . I I,$P(NODE,U,10) S X=+$G(^OR(100,ORIFN,4.5,+I,1)) S:X $P(NODE,U,10)=X_";SC(" ;reset Loc if prev value
"RTN","ORCSAVE",59,0)
 . S I=$O(^OR(100,ORIFN,4.5,"ID","CLASS",0))
"RTN","ORCSAVE",60,0)
 . I I S X=$G(^OR(100,ORIFN,4.5,+I,1)) S:"^I^O^"[(U_X_U) $P(NODE,U,12)=X
"RTN","ORCSAVE",61,0)
 S $P(^OR(100,ORIFN,3),U)=NOW
"RTN","ORCSAVE",62,0)
 K ^OR(100,ORIFN,9) I $G(ORCHECK) D  ; save order checks
"RTN","ORCSAVE",63,0)
 . S (CNT,CDL)=0 F  S CDL=$O(ORCHECK("NEW",CDL)) Q:CDL'>0  S I=0 D
"RTN","ORCSAVE",64,0)
 . . F  S I=$O(ORCHECK("NEW",CDL,I)) Q:I'>0  S X=ORCHECK("NEW",CDL,I) D
"RTN","ORCSAVE",65,0)
 . . . S CNT=CNT+1,^OR(100,ORIFN,9,"B",+X,CNT)=""
"RTN","ORCSAVE",66,0)
 . . . S ^OR(100,ORIFN,9,CNT,0)=$P(X,U,1,2),^(1)=$E($P(X,U,3),1,245)
"RTN","ORCSAVE",67,0)
 . S:CNT ^OR(100,ORIFN,9,0)="^100.09PA^"_CNT_U_CNT
"RTN","ORCSAVE",68,0)
ENQ Q
"RTN","ORCSAVE",69,0)
 ;
"RTN","ORCSAVE",70,0)
NEXTIFN() ; -- Returns next available ORIFN
"RTN","ORCSAVE",71,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","ORCSAVE",72,0)
 F I=1:1:10 L +^OR(100,0):1 Q:$T  H 2
"RTN","ORCSAVE",73,0)
 I '$T Q "^"
"RTN","ORCSAVE",74,0)
 S HDR=$G(^OR(100,0)),TOTAL=+$P(HDR,U,4),LAST=$O(^OR(100,"?"),-1)
"RTN","ORCSAVE",75,0)
 S I=LAST\1 F I=(I+1):1 Q:'$D(^OR(100,I,0))
"RTN","ORCSAVE",76,0)
 S DA=I,^OR(100,DA,0)=DA,$P(HDR,U,3,4)=DA_U_(TOTAL+1)
"RTN","ORCSAVE",77,0)
 S ^OR(100,0)=HDR L -^OR(100,0)
"RTN","ORCSAVE",78,0)
 Q DA
"RTN","ORCSAVE",79,0)
 ;
"RTN","ORCSAVE",80,0)
RESPONSE ; -- Save responses in ORDIALOG() into ^OR(100,ORIFN,4.5)
"RTN","ORCSAVE",81,0)
 N PROMPT,CNT,ITM,TYPE,INST,VALUE,I,START,PAT,X
"RTN","ORCSAVE",82,0)
 S PAT=$P(^OR(100,ORIFN,0),U,2),START=$P(^(0),U,8) K ^(4.5)
"RTN","ORCSAVE",83,0)
 S (PROMPT,CNT)=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:PROMPT'>0  D
"RTN","ORCSAVE",84,0)
 . S ITM=$G(ORDIALOG(PROMPT)) Q:'ITM
"RTN","ORCSAVE",85,0)
 . S TYPE=$E($G(ORDIALOG(PROMPT,0))) Q:'$L(TYPE)
"RTN","ORCSAVE",86,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  D
"RTN","ORCSAVE",87,0)
 . . S VALUE=$G(ORDIALOG(PROMPT,INST)) Q:VALUE=""  S CNT=CNT+1
"RTN","ORCSAVE",88,0)
 . . S ^OR(100,ORIFN,4.5,CNT,0)=+ITM_U_PROMPT_U_INST_U_$P(ITM,U,2)
"RTN","ORCSAVE",89,0)
 . . S:$L($P(ITM,U,2)) ^OR(100,ORIFN,4.5,"ID",$P(ITM,U,2),CNT)=""
"RTN","ORCSAVE",90,0)
 . . S:TYPE'="W" ^OR(100,ORIFN,4.5,CNT,1)=VALUE
"RTN","ORCSAVE",91,0)
 . . M:TYPE="W" ^OR(100,ORIFN,4.5,CNT,2)=@VALUE ; array root
"RTN","ORCSAVE",92,0)
 S ^OR(100,ORIFN,4.5,0)="^100.045A^"_CNT_U_CNT
"RTN","ORCSAVE",93,0)
R1 ; [Reset] Orderables
"RTN","ORCSAVE",94,0)
 I $D(^OR(100,ORIFN,.1)) S I=0 F  S I=$O(^OR(100,ORIFN,.1,I)) Q:I'>0  S X=$G(^(I,0)) I X,PAT,START K ^OR(100,"AOI",X,PAT,9999999-START,ORIFN) ; kill xref
"RTN","ORCSAVE",95,0)
 K ^OR(100,ORIFN,.1) I $D(^OR(100,ORIFN,4.5,"ID","ORDERABLE")) D
"RTN","ORCSAVE",96,0)
 . S (I,CNT)=0
"RTN","ORCSAVE",97,0)
 . F  S I=$O(^OR(100,ORIFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D
"RTN","ORCSAVE",98,0)
 . . S X=$G(^OR(100,ORIFN,4.5,I,1)) Q:'X
"RTN","ORCSAVE",99,0)
 . . S CNT=CNT+1,^OR(100,ORIFN,.1,CNT,0)=X,^OR(100,ORIFN,.1,"B",X,CNT)=""
"RTN","ORCSAVE",100,0)
 . . I PAT,START S ^OR(100,"AOI",X,PAT,9999999-START,ORIFN)=""
"RTN","ORCSAVE",101,0)
 . S ^OR(100,ORIFN,.1,0)="^100.001PA^"_CNT_U_CNT
"RTN","ORCSAVE",102,0)
 Q
"RTN","ORCSAVE",103,0)
 ;
"RTN","ORCSAVE",104,0)
RESUME(IFN) ; -- add Response nodes for RESUME tray service
"RTN","ORCSAVE",105,0)
 ; S ^OR(100,+IFN,4.5,<next>,0)=DT_"^^^RESUME",^(1)=1
"RTN","ORCSAVE",106,0)
 ;
"RTN","ORCSAVE",107,0)
 N X,Y,DA,DIC
"RTN","ORCSAVE",108,0)
 S DIC="^OR(100,"_+IFN_",4.5,",DIC(0)="LX",DA(1)=+IFN,X=DT
"RTN","ORCSAVE",109,0)
 S DIC("DR")=".04///RESUME",DIC("P")=$P(^DD(100,4.5,0),U,2)
"RTN","ORCSAVE",110,0)
 D ^DIC S:Y ^OR(100,+IFN,4.5,+Y,1)=1
"RTN","ORCSAVE",111,0)
 Q
"RTN","ORCSAVE",112,0)
 ;
"RTN","ORCSAVE",113,0)
PROVIDER(ORDER,PROV) ; -- Change PROVider assigned to ORDER
"RTN","ORCSAVE",114,0)
 Q:'$G(ORDER)  Q:'$G(PROV)
"RTN","ORCSAVE",115,0)
 N ORACT S ORACT=+$P(ORDER,";",2) S:'ORACT ORACT=1
"RTN","ORCSAVE",116,0)
 S $P(^OR(100,+ORDER,8,ORACT,0),U,3)=PROV
"RTN","ORCSAVE",117,0)
 S:ORACT=1 $P(^OR(100,+ORDER,0),U,4)=PROV
"RTN","ORCSAVE",118,0)
 Q
"RTN","ORCSAVE",119,0)
 ;
"RTN","ORCSAVE",120,0)
ACTION(CODE,DA,PROV,REASON,WHEN,WHO) ; -- save new action
"RTN","ORCSAVE",121,0)
 N NEXT,TOTAL,HDR,LAST,X,PAT,DGRP,SIG,NATR,TXT S DA=+DA
"RTN","ORCSAVE",122,0)
 Q:'$D(^OR(100,DA,0)) 0 Q:$G(CODE)'?2U 0
"RTN","ORCSAVE",123,0)
 S:'$G(WHEN) WHEN=+$E($$NOW^XLFDT,1,12) S:'$G(WHO) WHO=DUZ
"RTN","ORCSAVE",124,0)
 S NATR=+$O(^ORD(100.02,"C","E",0)) ;assume Elec Entered until changed
"RTN","ORCSAVE",125,0)
 S PAT=$P(^OR(100,DA,0),U,2),DGRP=$P(^(0),U,11),SIG=$P(^(0),U,16),X=+$P($G(^(3)),U,7),HDR=$G(^(8,0))
"RTN","ORCSAVE",126,0)
 S:X'>0 X=1 S TXT=$P($G(^OR(100,DA,8,X,0)),U,14) ;current actn's txt ptr
"RTN","ORCSAVE",127,0)
 S:HDR="" HDR="^100.008DA^^" S TOTAL=+$P(HDR,U,4)
"RTN","ORCSAVE",128,0)
 S LAST=$O(^OR(100,DA,8,"C",CODE,"?"),-1) I LAST D
"RTN","ORCSAVE",129,0)
 . S X=$G(^OR(100,DA,8,LAST,0)) Q:$P(X,U,15)'=11  Q:$P(X,U,4)'=2
"RTN","ORCSAVE",130,0)
 . S NEXT=LAST I PAT,$P(X,U) D  ; kill old xref entries
"RTN","ORCSAVE",131,0)
 . . K:DGRP ^OR(100,"ACT",PAT,(9999999-$P(X,U)),DGRP,DA,NEXT)
"RTN","ORCSAVE",132,0)
 . . K ^OR(100,"AC",PAT,(9999999-$P(X,U)),DA,NEXT),^OR(100,"AS",PAT,(9999999-$P(X,U)),DA,NEXT),^OR(100,"AF",$P(X,U),DA,NEXT)
"RTN","ORCSAVE",133,0)
 S:'$G(NEXT) NEXT=$O(^OR(100,DA,8,"?"),-1)+1,TOTAL=TOTAL+1
"RTN","ORCSAVE",134,0)
 S ^OR(100,DA,8,NEXT,0)=WHEN_U_CODE_U_$G(PROV)_U_$S(SIG:2,1:3)_"^^^^^^^^"_NATR_U_WHO_U_TXT_"^11",^OR(100,DA,8,"C",CODE,NEXT)=""
"RTN","ORCSAVE",135,0)
 S ^OR(100,"AF",WHEN,DA,NEXT)=""
"RTN","ORCSAVE",136,0)
 I PAT,DGRP S ^OR(100,"ACT",PAT,9999999-WHEN,DGRP,DA,NEXT)=""
"RTN","ORCSAVE",137,0)
 I PAT S ^OR(100,"AC",PAT,9999999-WHEN,DA,NEXT)=""
"RTN","ORCSAVE",138,0)
 I SIG S ^OR(100,"AS",PAT,9999999-WHEN,DA,NEXT)=""
"RTN","ORCSAVE",139,0)
 S:$L($G(REASON)) ^OR(100,DA,8,NEXT,1)=REASON
"RTN","ORCSAVE",140,0)
 S $P(HDR,U,3,4)=NEXT_U_TOTAL,^OR(100,DA,8,0)=HDR
"RTN","ORCSAVE",141,0)
 Q NEXT
"RTN","ORCSAVE",142,0)
 ;
"RTN","ORCSAVE",143,0)
SET(DLG) ; -- Create new parent for order set ORDIALOG
"RTN","ORCSAVE",144,0)
 ; Returns ORPIFN = ifn of new parent order for set
"RTN","ORCSAVE",145,0)
 ;
"RTN","ORCSAVE",146,0)
 Q:'$G(ORVP)  Q:'$G(DLG)  N OR0,PKG,NOW,CATG,STS,ORLOC,TRSPEC,X
"RTN","ORCSAVE",147,0)
 S OR0=$G(^ORD(101.41,DLG,0)) Q:OR0=""  S ORPIFN=$$NEXTIFN Q:'ORPIFN
"RTN","ORCSAVE",148,0)
 S PKG=$O(^DIC(9.4,"C","OR",0)),CATG=$S($$INPT^ORCD:"I",1:"O"),STS=$S($G(OREVENT):10,1:11),NOW=$S($G(ORSLOG):ORSLOG,1:+$E($$NOW^XLFDT,1,12))
"RTN","ORCSAVE",149,0)
 I $G(OREVENT) S ORLOC="",TRSPEC=""
"RTN","ORCSAVE",150,0)
 S ^OR(100,ORPIFN,0)=ORPIFN_U_ORVP_U_U_$G(ORNP)_U_DLG_";ORD(101.41,^"_DUZ_U_NOW_U_U_U_ORLOC_U_U_CATG_U_TRSPEC_U_PKG_"^^^"_$G(OREVENT),^(3)=NOW_"^90^"_STS_U_$S($G(ORIT):ORIT_"ORD(101.41,",1:"")_"^^^1^^^^0^^"_+$P(OR0,U,6)
"RTN","ORCSAVE",151,0)
 S ^OR(100,ORPIFN,8,0)="^100.008DA^1^1",^(1,0)=NOW_"^NW^"_$G(ORNP)_"^^^^^^^^^^"_DUZ_"^^"_STS,^OR(100,ORPIFN,8,"C","NW",1)="",^OR(100,"AF",NOW,ORPIFN,1)=""
"RTN","ORCSAVE",152,0)
 S ^OR(100,"ACT",ORVP,9999999-NOW,ORPIFN,1)=""
"RTN","ORCSAVE",153,0)
 S:STS=11 ^OR(100,"AC",ORVP,9999999-NOW,ORPIFN,1)=""
"RTN","ORCSAVE",154,0)
 ; AEVNT ??
"RTN","ORCSAVE",155,0)
 S ^OR(100,ORPIFN,1,0)="^100.011^1^1",^(1,0)=$P(OR0,U,2) ; Order text
"RTN","ORCSAVE",156,0)
 Q
"RTN","ORCSAVE1")
0^59^B27554529
"RTN","ORCSAVE1",1,0)
ORCSAVE1 ; SLC/MKB - Save Order Text ;7/21/97  15:47
"RTN","ORCSAVE1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**92,132,141**;Dec 17, 1997
"RTN","ORCSAVE1",3,0)
 ;
"RTN","ORCSAVE1",4,0)
 ; ^ORD(101.41,+ORDIALOG,10,ITM,2)=Seq#^Format^Omit^Lead Text^Trail Text
"RTN","ORCSAVE1",5,0)
 ; ^ORD(101.41,+ORDIALOG,10,"ATXT",Seq#,ITM)=""
"RTN","ORCSAVE1",6,0)
 ;
"RTN","ORCSAVE1",7,0)
ORDTEXT(ORDER) ; -- Build and save order text from ORDIALOG() into ORDER
"RTN","ORCSAVE1",8,0)
 N ORTX,I,IFN,ACT,ORSET
"RTN","ORCSAVE1",9,0)
 D ORTX(240) Q:'$G(ORTX)
"RTN","ORCSAVE1",10,0)
 S IFN=+ORDER,ACT=+$P(ORDER,";",2) S:ACT'>0 ACT=1
"RTN","ORCSAVE1",11,0)
 F I=1:1:ORTX S ^OR(100,IFN,8,ACT,.1,I,0)=ORTX(I)
"RTN","ORCSAVE1",12,0)
 S ^OR(100,IFN,8,ACT,.1,0)=U_U_ORTX_U_ORTX_U_DT_U
"RTN","ORCSAVE1",13,0)
 I $E($G(ORDEA))=2 D  ;PKI Drug Schedule - in future may allow 2-5
"RTN","ORCSAVE1",14,0)
 . S ORSET=0
"RTN","ORCSAVE1",15,0)
 . D DIGTEXT(IFN)
"RTN","ORCSAVE1",16,0)
 . F I=1:1:ORSET S ^OR(100,IFN,8,ACT,.2,I,0)=ORSET(I)
"RTN","ORCSAVE1",17,0)
 . I ORSET>0 S ^OR(100,IFN,8,ACT,.2,0)=U_U_ORSET_U_ORSET_U_DT_U
"RTN","ORCSAVE1",18,0)
 Q
"RTN","ORCSAVE1",19,0)
 ;
"RTN","ORCSAVE1",20,0)
ORTX(WIDTH) ; -- May enter here to return order text in ORTX()
"RTN","ORCSAVE1",21,0)
 N ORP,SEQ,ITEM,ORMAX
"RTN","ORCSAVE1",22,0)
 K ORTX S ORMAX=$S(+$G(WIDTH):WIDTH,1:240)
"RTN","ORCSAVE1",23,0)
 D EXT ; get external form of values
"RTN","ORCSAVE1",24,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"ATXT",SEQ)) Q:SEQ'>0  S ITEM=$O(^(SEQ,0)) D TEXT(ITEM)
"RTN","ORCSAVE1",25,0)
 Q
"RTN","ORCSAVE1",26,0)
 ;
"RTN","ORCSAVE1",27,0)
TEXT(DA) ; -- Includes text of item DA
"RTN","ORCSAVE1",28,0)
 Q:$P(^ORD(101.41,ORDIALOG,10,DA,0),U,11)  Q:'$O(ORP(DA,0))
"RTN","ORCSAVE1",29,0)
 N NEWLN,INST,TYPE,PTR,CHSEQ,CHILD,ORI,X,Y
"RTN","ORCSAVE1",30,0)
 S:'$G(ORTX) ORTX=1,ORTX(1)=""
"RTN","ORCSAVE1",31,0)
 S NEWLN=+$P(ORP(DA),U,4),INST=$O(ORP(DA,0)),Y=""
"RTN","ORCSAVE1",32,0)
 I NEWLN,$L(ORTX(ORTX)) S ORTX=ORTX+1,ORTX(ORTX)="",Y=" "
"RTN","ORCSAVE1",33,0)
 S X=$$GETXT($P(ORP(DA),U,2)) I $L(X) S X=Y_X,Y="" D TXT^ORCHTAB ;lead tx
"RTN","ORCSAVE1",34,0)
 S PTR=+ORP(DA),TYPE=$E(ORDIALOG(PTR,0))
"RTN","ORCSAVE1",35,0)
TXT1 I TYPE'="W" S X=Y_ORP(DA,INST),Y="" D TXT^ORCHTAB
"RTN","ORCSAVE1",36,0)
 I TYPE="W" S ORI=0 F  S ORI=$O(ORP(DA,INST,ORI)) Q:ORI'>0  D  S Y=""
"RTN","ORCSAVE1",37,0)
 . S Y=$S(Y=" ":" ",$P(ORP(DA),U,5):" ",1:"") ;new line, or as stored
"RTN","ORCSAVE1",38,0)
 . S X=Y_ORP(DA,INST,ORI,0),Y="" I $E(X)'=" " D TXT^ORCHTAB Q  ; wrap
"RTN","ORCSAVE1",39,0)
 . S:$L(ORTX(ORTX)) ORTX=ORTX+1,ORTX(ORTX)="" ; force new line
"RTN","ORCSAVE1",40,0)
 . I X?1." " S ORTX(ORTX)=" ",ORTX=ORTX+1,ORTX(ORTX)="" ; blank line
"RTN","ORCSAVE1",41,0)
 . E  D TXT^ORCHTAB
"RTN","ORCSAVE1",42,0)
 D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PTR)) CHILD(PTR)
"RTN","ORCSAVE1",43,0)
 S INST=$O(ORP(DA,INST)) ; multiple?
"RTN","ORCSAVE1",44,0)
 I INST S ORTX(ORTX)=ORTX(ORTX)_",",Y="" S:NEWLN ORTX=ORTX+1,ORTX(ORTX)="",Y=" " G TXT1
"RTN","ORCSAVE1",45,0)
 S X=$$GETXT($P(ORP(DA),U,3)) D:$L(X) TXT^ORCHTAB ; trailing text
"RTN","ORCSAVE1",46,0)
 Q
"RTN","ORCSAVE1",47,0)
 ;
"RTN","ORCSAVE1",48,0)
CHILD(PARENT) ; -- add child values
"RTN","ORCSAVE1",49,0)
 N CHSEQ,CHILD S CHSEQ=0
"RTN","ORCSAVE1",50,0)
 F  S CHSEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,CHSEQ)) Q:CHSEQ'>0  S CHILD=$O(^(CHSEQ,0)) D
"RTN","ORCSAVE1",51,0)
 . Q:'$L($G(ORP(CHILD,INST)))
"RTN","ORCSAVE1",52,0)
 . S X=$$GETXT($P(ORP(CHILD),U,2)) D:$L(X) TXT^ORCHTAB ; lead text
"RTN","ORCSAVE1",53,0)
 . S X=ORP(CHILD,INST) D TXT^ORCHTAB
"RTN","ORCSAVE1",54,0)
 . S X=$$GETXT($P(ORP(CHILD),U,3)) D:$L(X) TXT^ORCHTAB ; trail text
"RTN","ORCSAVE1",55,0)
 Q
"RTN","ORCSAVE1",56,0)
 ;
"RTN","ORCSAVE1",57,0)
GETXT(X) ; -- Returns text of X
"RTN","ORCSAVE1",58,0)
 I $E(X)="@" N VAR S VAR=$E(X,2,99),X=$G(@VAR) K @VAR ; variable w/text
"RTN","ORCSAVE1",59,0)
 Q X
"RTN","ORCSAVE1",60,0)
 ;
"RTN","ORCSAVE1",61,0)
EXT ; -- Build ORP(DA) array of external forms
"RTN","ORCSAVE1",62,0)
 N PROMPT,INST,DA,NODE,FORMAT,OMIT,X,Y,TYPE,PTR
"RTN","ORCSAVE1",63,0)
 S PROMPT=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:PROMPT'>0  D
"RTN","ORCSAVE1",64,0)
 . S DA=+$G(ORDIALOG(PROMPT)),TYPE=$E($G(ORDIALOG(PROMPT,0))) Q:'$L(TYPE)
"RTN","ORCSAVE1",65,0)
 . Q:'DA  S NODE=$G(^ORD(101.41,ORDIALOG,10,DA,2)),FORMAT=$P(NODE,U,2),OMIT=$P(NODE,U,3)
"RTN","ORCSAVE1",66,0)
 . S:$D(ORDIALOG(PROMPT,"FORMAT")) FORMAT=ORDIALOG(PROMPT,"FORMAT")
"RTN","ORCSAVE1",67,0)
 . I $E(FORMAT)="@" S PTR=+$E(FORMAT,2,99) Q:'PTR  ; Don't include
"RTN","ORCSAVE1",68,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  D
"RTN","ORCSAVE1",69,0)
 . . Q:ORDIALOG(PROMPT,INST)=""
"RTN","ORCSAVE1",70,0)
 . . I $E(FORMAT)="@",$L($G(ORDIALOG(PTR,INST))) Q  ; use PTR instead
"RTN","ORCSAVE1",71,0)
 . . I $E(FORMAT)="*" S PTR=+$E(FORMAT,2,99) I '$L($G(ORDIALOG(PTR,INST))) Q  ; must have PTR too
"RTN","ORCSAVE1",72,0)
 . . I $E(FORMAT)="=" S PTR=+$E(FORMAT,2,99) I PTR,$L($G(ORDIALOG(PTR,INST))) S Y=$$EXT^ORCD(PTR,INST),X=$$EXT^ORCD(PROMPT,INST) I (X=Y)!(X[Y)!(Y[X) Q
"RTN","ORCSAVE1",73,0)
 . . I TYPE="W" M ORP(DA,INST)=@ORDIALOG(PROMPT,INST)
"RTN","ORCSAVE1",74,0)
 . . E  S X=$$EXT^ORCD(PROMPT,INST,FORMAT) Q:X=""  Q:OMIT[X  S ORP(DA,INST)=X
"RTN","ORCSAVE1",75,0)
 . . S ORP(DA)=PROMPT_U_$P(NODE,U,4,7) ; ptr^lead^trail^new line^wrap
"RTN","ORCSAVE1",76,0)
 Q
"RTN","ORCSAVE1",77,0)
DIGTEXT(ORDER)  ;Build text used to create Digital Signature
"RTN","ORCSAVE1",78,0)
 ;ORSET(1)=1)Date of Prescription (RX) -Date Ordered HL7 format 2)Full Patient Name 3)Patient SSN 4)DFN
"RTN","ORCSAVE1",79,0)
 ;ORSET(2)=5)Patient Street1 6)Patient Street2 7)Patient Street3 8)Patient City 9)Patient State 10)Patient Zip 11)???
"RTN","ORCSAVE1",80,0)
 ;ORSET(3)=12)Drug name_strength_dosage form 13)Drug IEN (file 50) 14)Drug quantity prescribed 15)Schedule of medication 16)DEA Schedule
"RTN","ORCSAVE1",81,0)
 ;ORSET(4)=17)Direction for use
"RTN","ORCSAVE1",82,0)
 ;ORSET(5)=18)Practitioner's name 19)DUZ 20)Practitioner's (DEA) registration number 21) VA-DEA number
"RTN","ORCSAVE1",83,0)
 ;ORSET(6)=22)SiteName 23)SiteStreet1 24)SiteStreet2 25)SiteCity 26)SiteState 27)SiteZip
"RTN","ORCSAVE1",84,0)
 ;ORSET(7)=28)$H
"RTN","ORCSAVE1",85,0)
 N I,DFN,OR80,ORPNM,ORSSN,ORXDT,VAERR,VAPA,X0,X1,X4,X5,X6,X8,X9,X10,X11,X12,X13,X14,SIG
"RTN","ORCSAVE1",86,0)
 S OR80=$G(^OR(100,ORDER,8,1,0)) Q:'$L(OR80)  Q:'$P(OR80,"^",3)
"RTN","ORCSAVE1",87,0)
 S $P(^OR(100,ORDER,8,1,2),"^",4,5)=ORDEA_"^"_1 ;Flag to signing process to get digital signature
"RTN","ORCSAVE1",88,0)
 S ORXDT=$P(^OR(100,ORDER,8,1,0),"^"),X1=$$FMTHL7^XLFDT(ORXDT),X4="",X14="",X10="",DFN=+ORVP
"RTN","ORCSAVE1",89,0)
 D ADD^VADPT
"RTN","ORCSAVE1",90,0)
 S ORPNM=^DPT(+ORVP,0),ORSSN=$P(ORPNM,"^",9),ORPNM=$P(ORPNM,"^")
"RTN","ORCSAVE1",91,0)
 F I=1:1:6 S X4=X4_$S($L($G(VAPA(I))):$S((I=5):$P(VAPA(I),"^",2),1:VAPA(I)),1:"")_"^"
"RTN","ORCSAVE1",92,0)
 S X11=$P($G(^VA(200,$P(OR80,"^",3),0)),"^") Q:'$L(X11)
"RTN","ORCSAVE1",93,0)
 S X12=$P($G(^VA(200,$P(OR80,"^",3),"PS")),"^",2),X13=$P($G(^("PS")),"^",3)
"RTN","ORCSAVE1",94,0)
 S X0=$G(^DIC(4,+$G(DUZ(2)),0)),X=$G(^(1))
"RTN","ORCSAVE1",95,0)
 I $L(X0) S X14=$P(X0,"^")_"^" D
"RTN","ORCSAVE1",96,0)
 . F I=1:1:3 S X14=X14_$S($L($P(X,"^",I)):$P(X,"^",I),1:"")_"^"
"RTN","ORCSAVE1",97,0)
 . S X14=X14_$S($P(X0,"^",2):$P($G(^DIC(5,+$P(X0,"^",2),0)),"^"),1:"")_"^"_$S($L($P(X,"^",4)):$P(X,"^",4),1:"")
"RTN","ORCSAVE1",98,0)
 S X5=$$VALUE^ORX8(ORDER,"DRUG",,"E"),X6=$$VALUE^ORX8(ORDER,"DRUG"),X8=$$VALUE^ORX8(ORDER,"QTY",,"E"),X9=$$VALUE^ORX8(ORDER,"SCHEDULE",,"E")
"RTN","ORCSAVE1",99,0)
 S SIG=+$O(^OR(100,ORDER,4.5,"ID","SIG",0)) I SIG,$L($G(^OR(100,ORDER,4.5,SIG,2,1,0))) S X10=^(0)
"RTN","ORCSAVE1",100,0)
 S ORSET(1)=X1_"^"_ORPNM_"^"_ORSSN_"^"_+ORVP_"^"
"RTN","ORCSAVE1",101,0)
 S ORSET(2)=X4_"^"
"RTN","ORCSAVE1",102,0)
 S ORSET(3)=X5_"^"_X6_"^"_X8_"^"_X9_"^"_ORDEA_"^"
"RTN","ORCSAVE1",103,0)
 S ORSET(4)=X10_"^"
"RTN","ORCSAVE1",104,0)
 S ORSET(5)=X11_"^"_$P(OR80,"^",3)_"^"_X12_"^"_X13_"^"
"RTN","ORCSAVE1",105,0)
 S ORSET(6)=X14
"RTN","ORCSAVE1",106,0)
 S ORSET(7)=$H
"RTN","ORCSAVE1",107,0)
 S ORSET=7
"RTN","ORCSAVE1",108,0)
 Q
"RTN","ORCSEND")
0^24^B55503809
"RTN","ORCSEND",1,0)
ORCSEND ;SLC/MKB-Release orders ; 08 May 2002  2:12 PM
"RTN","ORCSEND",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,27,45,79,92,141**;Dec 17, 1997
"RTN","ORCSEND",3,0)
 ;
"RTN","ORCSEND",4,0)
EN(ORIFN,ACTION,SIGSTS,RELSTS,NATURE,REASON,ORERR) ; -- Release [actions on] orders
"RTN","ORCSEND",5,0)
 N ORDA,ORNOW,SIGNREQD,SIGNED,SIGNER
"RTN","ORCSEND",6,0)
 S SIGNREQD=+$P($G(^OR(100,+ORIFN,0)),U,16),ORERR=""
"RTN","ORCSEND",7,0)
 S SIGNED=$S(SIGSTS=2:0,1:1),SIGNER=$S(SIGSTS=1:DUZ,SIGSTS=7:DUZ,1:"")
"RTN","ORCSEND",8,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN,ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND",9,0)
 S:"ES"[$G(ACTION) ACTION=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2)
"RTN","ORCSEND",10,0)
 I SIGNREQD,ORDA,"^NW^RW^XX^RN^DC^HD^RL^"[(U_ACTION_U) D  ; sign/alert
"RTN","ORCSEND",11,0)
 . I 'SIGNED D NOTIF^ORCSIGN Q
"RTN","ORCSEND",12,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",13,0)
 . D:SIGSTS=4 CHART^ORCSIGN ; not used anymore
"RTN","ORCSEND",14,0)
 I '$L(ACTION) S ORERR="1^Invalid order action" Q
"RTN","ORCSEND",15,0)
 I $$READY(ORIFN,ORDA) D:$L($T(@ACTION)) @ACTION I 'ORERR,ACTION="NW" D
"RTN","ORCSEND",16,0)
 . N OREVT S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17) Q:OREVT<1
"RTN","ORCSEND",17,0)
 . I '$$EVTORDER^OREVNTX(ORIFN) D SAVE^ORMEVNT1(ORIFN,OREVT,2,"ES")
"RTN","ORCSEND",18,0)
 Q
"RTN","ORCSEND",19,0)
 ;
"RTN","ORCSEND",20,0)
EN1(ORDER,ORERR) ; -- Delayed Release [from RELEASE^ORMEVNT]
"RTN","ORCSEND",21,0)
 ;
"RTN","ORCSEND",22,0)
 Q:$P($G(^OR(100,+ORDER,3)),U,3)'=10
"RTN","ORCSEND",23,0)
 N ORPKG,ORA0,ORNOW,ORIFN,ORDA,ORNP,ORNATR,ORQUIT,ORDUZ,SIGSTS,RELSTS
"RTN","ORCSEND",24,0)
 S ORPKG=$P($G(^OR(100,+ORDER,0)),U,14),ORA0=$G(^(8,1,0))
"RTN","ORCSEND",25,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORIFN=+ORDER,ORDA=1,ORNP=$P(ORA0,U,3)
"RTN","ORCSEND",26,0)
 S SIGSTS=$P(ORA0,U,4),ORNATR=$P($G(^ORD(100.02,+$P(ORA0,U,12),0)),U,2)
"RTN","ORCSEND",27,0)
 S RELSTS=$S(SIGSTS'=2:1,"^V^P^"[(U_ORNATR_U):1,1:0) I RELSTS D
"RTN","ORCSEND",28,0)
 . D STARTDT^ORCSAVE2(ORIFN),PKGSTUFF^ORCSEND1(ORPKG) Q:$G(ORQUIT)
"RTN","ORCSEND",29,0)
 . S ORDUZ=$S(SIGSTS=0:$P(ORA0,U,7),SIGSTS=1:$P(ORA0,U,5),SIGSTS=2:$P(ORA0,U,17),SIGSTS=3:$P(ORA0,U,13),1:DUZ)
"RTN","ORCSEND",30,0)
 . D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,ORDUZ),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND",31,0)
 . I "^10^13^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U) S ORERR=1 ;error
"RTN","ORCSEND",32,0)
 I 'RELSTS!$G(ORERR),$P($G(^OR(100,ORIFN,3)),U,3)=10 D STATUS^ORCSAVE2(ORIFN,11) S $P(^OR(100,ORIFN,8,1,0),U,15)=11
"RTN","ORCSEND",33,0)
 Q
"RTN","ORCSEND",34,0)
 ;
"RTN","ORCSEND",35,0)
EN2(ORIFN,SIGSTS,NATURE,ORERR)  ; -- Manual Release [from OREVNT1,SENDED^ORWDX]
"RTN","ORCSEND",36,0)
 N ORDA,ORNOW,OREVT,ORA0,ORNP,SIGNREQD,SIGNED,RELSTS
"RTN","ORCSEND",37,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN S:ORDA<1 ORDA=1
"RTN","ORCSEND",38,0)
 S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17),ORA0=$G(^(8,ORDA,0))
"RTN","ORCSEND",39,0)
 S ORNP=$P(ORA0,U,3),SIGNREQD=($P(ORA0,U,4)'=3),(SIGNED,RELSTS)=1
"RTN","ORCSEND",40,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORERR="" I $P(ORA0,U,4)=2 D  ;needs ES
"RTN","ORCSEND",41,0)
 . N SIGNER S SIGNER=$S(SIGSTS=1:DUZ,1:"")
"RTN","ORCSEND",42,0)
 . I SIGSTS=2 D NOTIF^ORCSIGN S SIGNED=0 Q  ;still unsigned
"RTN","ORCSEND",43,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",44,0)
 D NW I 'ORERR D SAVE^ORMEVNT1(+ORIFN,OREVT,2,"MN")
"RTN","ORCSEND",45,0)
 Q
"RTN","ORCSEND",46,0)
 ;
"RTN","ORCSEND",47,0)
NW ; -- New order ORIFN
"RTN","ORCSEND",48,0)
RW ; -- Rewritten order ORIFN
"RTN","ORCSEND",49,0)
XX ; -- Changed order ORIFN
"RTN","ORCSEND",50,0)
RN ; -- Renewed order ORIFN
"RTN","ORCSEND",51,0)
 N ORQUIT,STS,TYPE,OR0,OR3,CODE,ORIG,ORSAVE
"RTN","ORCSEND",52,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG,OREBUILD=1 Q
"RTN","ORCSEND",53,0)
 S:'ORDA ORDA=1 S ORSAVE=ORIFN
"RTN","ORCSEND",54,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)) D STARTDT^ORCSAVE2(ORIFN)
"RTN","ORCSEND",55,0)
 S TYPE=$P(OR3,U,11),CODE=$S(TYPE=1:"XO",1:"NW"),ORIG=$P(OR3,U,5)
"RTN","ORCSEND",56,0)
 I TYPE=1,ORIG S ^OR(100,ORIG,6)=$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",57,0)
 D PKGSTUFF^ORCSEND1(+$P(OR0,U,14)) Q:$G(ORQUIT)
"RTN","ORCSEND",58,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",59,0)
 D NEW^ORMBLD(ORIFN,CODE) S ORIFN=ORSAVE,STS=$P($G(^OR(100,ORIFN,3)),U,3)
"RTN","ORCSEND",60,0)
 I (STS=1)!(STS=13) S ORERR="1^"_$$WHY(ORIFN,1) D:'SIGNED&SIGNREQD NOSIG K:ORIG ^OR(100,ORIG,6)
"RTN","ORCSEND",61,0)
 I STS=11 S ORERR="1^ERROR"
"RTN","ORCSEND",62,0)
 Q
"RTN","ORCSEND",63,0)
 ;
"RTN","ORCSEND",64,0)
DC ; -- DC order ORIFN
"RTN","ORCSEND",65,0)
 N PKG,CODE,ORCHLD,ORCHDA,STS,ORIDA,ORSAVE,OR3
"RTN","ORCSEND",66,0)
 I '$G(REASON),$G(NATURE)="D" S REASON=+$O(^ORD(100.03,"C","ORDUP",0))
"RTN","ORCSEND",67,0)
 S:$G(REASON) ^OR(100,ORIFN,6)=$S($G(NATURE):NATURE,$L($G(NATURE)):$O(^ORD(100.02,"C",NATURE,0)),1:"")_"^^^"_+REASON_U_$P(^ORD(100.03,+REASON,0),U)
"RTN","ORCSEND",68,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",69,0)
 S $P(^OR(100,ORIFN,6),U,2,3)=$S($G(DGPMT):"",1:DUZ)_U_ORNOW,ORSAVE=ORIFN S:'$G(REASON) REASON=$P(^(6),U,4)
"RTN","ORCSEND",70,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),PKG=$P($G(^(0)),U,14),PKG=$$NMSP^ORCD(PKG),CODE=$S(PKG="LR":"CA",(PKG="PS")&(STS=5):"CA",(PKG="FH")&(STS=8):"CA",1:"DC")
"RTN","ORCSEND",71,0)
 D:ORDA RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",72,0)
DC1 I $O(^OR(100,ORIFN,2,0)) D  G DC2 ; DC children
"RTN","ORCSEND",73,0)
 . S ORCHLD=0 F  S ORCHLD=$O(^OR(100,ORIFN,2,ORCHLD)) Q:ORCHLD'>0  I $$VALID^ORCACT0(ORCHLD,"DC") D  Q:$G(ORERR)
"RTN","ORCSEND",74,0)
 . . S ORCHDA=$S(ORDA:$$ACTION^ORCSAVE("DC",ORCHLD,ORNP),1:0)
"RTN","ORCSEND",75,0)
 . . D:ORCHDA SIGN^ORCSAVE2(ORCHLD,,,"",ORCHDA) ;Sig on Parent only
"RTN","ORCSEND",76,0)
 . . D MSG^ORMBLD((ORCHLD_";"_ORCHDA),CODE,$G(REASON))
"RTN","ORCSEND",77,0)
 . . I "^1^13^"'[(U_$P(^OR(100,ORCHLD,3),U,3)_U) S ORERR="1^"_$$WHY(ORCHLD,ORCHDA)
"RTN","ORCSEND",78,0)
 . ;D:'$G(ORERR) STATUS^ORCSAVE2(ORIFN,1)
"RTN","ORCSEND",79,0)
 . S:$G(ORERR) ^OR(100,ORIFN,8,ORDA,1)=$P(ORERR,U,2)
"RTN","ORCSEND",80,0)
 D MSG^ORMBLD((ORIFN_";"_ORDA),CODE,$G(REASON))
"RTN","ORCSEND",81,0)
DC2 S ORIFN=ORSAVE,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND",82,0)
 I STS'=1,STS'=13,STS'=2 D  Q
"RTN","ORCSEND",83,0)
 . S ORERR="1^"_$S(ORDA:$$WHY(ORIFN,ORDA),1:"Unable to discontinue")
"RTN","ORCSEND",84,0)
 . I ORDA,'SIGNED&SIGNREQD D NOSIG ; sig no longer reqd
"RTN","ORCSEND",85,0)
 . K ^OR(100,ORIFN,6)
"RTN","ORCSEND",86,0)
 S $P(^OR(100,ORIFN,3),U,7)=$S(ORDA:ORDA,'$$ACTV^ORX1($G(NATURE)):0,1:$P(OR3,U,7))
"RTN","ORCSEND",87,0)
 D CANCEL(ORIFN),SETALL^ORDD100(ORIFN)
"RTN","ORCSEND",88,0)
 I $P(OR3,U,11)=2 D  ; dc a renewal
"RTN","ORCSEND",89,0)
 . N ORIG,ORIG3,NATR S ORIG=$P(OR3,U,5),ORIG3=$G(^OR(100,ORIG,3)) Q:'ORIG
"RTN","ORCSEND",90,0)
 . I CODE="CA" S $P(^OR(100,ORIG,3),U,6)="" Q  ;pend - remove fwd ptr
"RTN","ORCSEND",91,0)
 . Q:"^1^7^12^13^"[(U_$P(ORIG3,U,3)_U)  S NATR=$O(^ORD(100.02,"C","A",0))
"RTN","ORCSEND",92,0)
 . S ^OR(100,ORIG,6)=NATR_U_DUZ_U_ORNOW_"^^Renewal cancelled"
"RTN","ORCSEND",93,0)
 . D MSG^ORMBLD(ORIG,"DC") I "^1^13^"'[$P(^OR(100,ORIG,3),U,3) K ^(6) Q
"RTN","ORCSEND",94,0)
 . S:'$$ACTV^ORX1(NATR) $P(^OR(100,ORIG,3),U,7)=0
"RTN","ORCSEND",95,0)
 Q
"RTN","ORCSEND",96,0)
 ;
"RTN","ORCSEND",97,0)
CANCEL(IFN) ; -- Cancel any outstanding actions for order IFN 
"RTN","ORCSEND",98,0)
 N I S I=0
"RTN","ORCSEND",99,0)
 F  S I=$O(^OR(100,IFN,8,I)) Q:I'>0  I $P(^(I,0),U,15)=11 S $P(^(0),U,15)=13 D:$P(^(0),U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,I) ; cancelled, sig not reqd now
"RTN","ORCSEND",100,0)
 Q
"RTN","ORCSEND",101,0)
 ;
"RTN","ORCSEND",102,0)
HD ; -- Hold order ORIFN
"RTN","ORCSEND",103,0)
 N STS,ORSAVE I 'ORDA S ORERR="1^Unable to hold" Q
"RTN","ORCSEND",104,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",105,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",106,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"HD") S ORIFN=ORSAVE
"RTN","ORCSEND",107,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3) I STS=3 S $P(^(3),U,7)=ORDA D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",108,0)
 I STS'=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",109,0)
 Q
"RTN","ORCSEND",110,0)
 ;
"RTN","ORCSEND",111,0)
RL ; -- Release hold on order ORIFN
"RTN","ORCSEND",112,0)
 N STS,ORSAVE,ORHD I 'ORDA S ORERR="1^Unable to release hold" Q
"RTN","ORCSEND",113,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",114,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",115,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"RL") S ORIFN=ORSAVE
"RTN","ORCSEND",116,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),ORHD=+$P($G(^(3)),U,7)
"RTN","ORCSEND",117,0)
 I STS'=3 S $P(^OR(100,ORIFN,3),U,7)=ORDA,$P(^(8,ORHD,2),U,1,2)=ORNOW_U_DUZ D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",118,0)
 I STS=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",119,0)
 Q
"RTN","ORCSEND",120,0)
 ;
"RTN","ORCSEND",121,0)
FL ; -- Flag order ORIFN
"RTN","ORCSEND",122,0)
 Q
"RTN","ORCSEND",123,0)
 ;
"RTN","ORCSEND",124,0)
UF ; -- Unflag order ORIFN
"RTN","ORCSEND",125,0)
 Q
"RTN","ORCSEND",126,0)
 ;
"RTN","ORCSEND",127,0)
CM ; -- Add Ward comments to order ORIFN
"RTN","ORCSEND",128,0)
 Q
"RTN","ORCSEND",129,0)
 ;
"RTN","ORCSEND",130,0)
VR ; -- Verify order ORIFN
"RTN","ORCSEND",131,0)
 I 'ORDA!(SIGSTS=2) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",132,0)
 I "^N^C^R^"'[(U_$G(ORVER)_U) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",133,0)
 D VERIFY^ORCSAVE2(ORIFN,ORDA,ORVER,DUZ,ORNOW)
"RTN","ORCSEND",134,0)
 ; -- send HL7 msg to Pharmacy if Nurse-Verified, [Sts=pending]
"RTN","ORCSEND",135,0)
 Q:ORVER'="N"  N ORSTS,ORPKG,ORX
"RTN","ORCSEND",136,0)
 S ORX=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2) Q:ORX'="NW"&(ORX'="XX")
"RTN","ORCSEND",137,0)
 S ORPKG=+$P($G(^OR(100,ORIFN,0)),U,14),ORSTS=$P($G(^(3)),U,3)
"RTN","ORCSEND",138,0)
 ;I ORSTS=5!$L($T(ZV^ORMPS)),$$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",139,0)
 I $$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",140,0)
 Q
"RTN","ORCSEND",141,0)
 ;
"RTN","ORCSEND",142,0)
NEEDSIG() ; -- Msg
"RTN","ORCSEND",143,0)
 Q "1^This order requires a signature."
"RTN","ORCSEND",144,0)
 ;
"RTN","ORCSEND",145,0)
WHY(IFN,DA) ; -- Return reason request was rejected
"RTN","ORCSEND",146,0)
 N X S X=$G(^OR(100,IFN,8,DA,1))
"RTN","ORCSEND",147,0)
 S:'$L(X) X="Unable to "_$S(ACTION="HD":"hold",ACTION="RL":"release hold",ACTION="DC":"discontinue",ACTION="XX":"change",ACTION="RN":"renew",1:"release")
"RTN","ORCSEND",148,0)
 Q X
"RTN","ORCSEND",149,0)
 ;
"RTN","ORCSEND",150,0)
NOSIG ; -- Mark order as Sig not Req'd due to cancel/reject
"RTN","ORCSEND",151,0)
 D SIGN^ORCSAVE2(ORIFN,"","",5,ORDA) S SIGNREQD=0
"RTN","ORCSEND",152,0)
 Q
"RTN","ORCSEND",153,0)
 ;
"RTN","ORCSEND",154,0)
READY(IFN,ACT) ; -- Ready to release?
"RTN","ORCSEND",155,0)
 N X,Y,OR0,OR3,ORA
"RTN","ORCSEND",156,0)
 I ACTION="VR" S Y=1 G RQ ; no action to release
"RTN","ORCSEND",157,0)
 I 'ACT,ACTION="DC" S Y=1 G RQ ; cancel a duplicate
"RTN","ORCSEND",158,0)
 S Y=0,OR0=$G(^OR(100,IFN,0)),OR3=$G(^(3)),ORA=$G(^(8,ACT,0))
"RTN","ORCSEND",159,0)
 I $P(ORA,U,15)=11 S Y=1 G RQ ; unreleased
"RTN","ORCSEND",160,0)
 I $P(ORA,U,15)=10 D  G RQ ; delayed
"RTN","ORCSEND",161,0)
 . I $G(^DPT(+ORVP,.105)),$$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)="PSO" S Y=1 Q
"RTN","ORCSEND",162,0)
 . Q:'RELSTS  N ORIG S ORIG=+$P(OR3,U,5)
"RTN","ORCSEND",163,0)
 . I 'SIGNED,$L($G(NATURE)) S $P(ORA,U,17)=DUZ,$P(ORA,U,12)=$S(NATURE:NATURE,1:+$O(^ORD(100.02,"C",NATURE,0))),^OR(100,IFN,8,ACT,0)=ORA
"RTN","ORCSEND",164,0)
 . Q:$P(OR3,U,11)'=1!('ORIG)  ;dc original if signed edit
"RTN","ORCSEND",165,0)
 . D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORCSEND",166,0)
 . S ^OR(100,ORIG,6)=+$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",167,0)
 . S $P(^OR(100,ORIG,3),U,7)=0,$P(^(8,1,0),U,15)=12 D:$P($G(^(0)),U,4)=2 SIGN^ORCSAVE2(ORIG,,,5,1)
"RTN","ORCSEND",168,0)
 I $P(OR3,U,3)=11,$P(ORA,U,2)="NW" S Y=1 ; Action Sts = "" (old)
"RTN","ORCSEND",169,0)
RQ Q Y
"RTN","ORCXPND2")
0^25^B58372818
"RTN","ORCXPND2",1,0)
ORCXPND2 ; SLC/MKB - Expanded display cont ; 08 May 2002  2:12 PM
"RTN","ORCXPND2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**34,53,75,94,141**;Dec 17, 1997
"RTN","ORCXPND2",3,0)
ALLERGY ; -- allergies
"RTN","ORCXPND2",4,0)
 N I,J,X,Y,DATE,SEV,SOURCE D EN1^GMRAOR2(ID,"Y")
"RTN","ORCXPND2",5,0)
 D ITEM^ORCXPND($P(Y,U)),BLANK^ORCXPND
"RTN","ORCXPND2",6,0)
 S I=$O(Y("S",0)),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="     Signs/Symptoms: "_$G(Y("S",+I))
"RTN","ORCXPND2",7,0)
 I $O(Y("S",I)) F  S I=$O(Y("S",I)) Q:I'>0  D
"RTN","ORCXPND2",8,0)
 . S LCNT=LCNT+1
"RTN","ORCXPND2",9,0)
 . S ^TMP("ORXPND",$J,LCNT,0)=$$REPEAT^XLFSTR(" ",21)_Y("S",I)
"RTN","ORCXPND2",10,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="               Type: "_$P(Y,U,7)
"RTN","ORCXPND2",11,0)
 I $O(Y("V",0)) S I=0 F  S I=$O(Y("V",I)) Q:I'>0  D
"RTN","ORCXPND2",12,0)
 . S LCNT=LCNT+1
"RTN","ORCXPND2",13,0)
 . S ^TMP("ORXPND",$J,LCNT,0)=$$REPEAT^XLFSTR(" ",23)_$P(Y("V",I),U,2)
"RTN","ORCXPND2",14,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="             Status: "_$P(Y,U,4)
"RTN","ORCXPND2",15,0)
A1 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Observed/Historical: "_$P(Y,U,5)
"RTN","ORCXPND2",16,0)
 I $O(Y("O",0)) S I=0 F  S I=$O(Y("O",I)) Q:I'>0  D  ; obs dates
"RTN","ORCXPND2",17,0)
 . S DATE=$P(Y("O",I),U),SEV=$P(Y("O",I),U,2)
"RTN","ORCXPND2",18,0)
 . S X=$$REPEAT^XLFSTR(" ",23)_$$DATE(DATE)_$S($L(SEV):" ("_SEV_")",1:"")
"RTN","ORCXPND2",19,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND2",20,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="         Originator: "_$P(Y,U,2)
"RTN","ORCXPND2",21,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$$REPEAT^XLFSTR(" ",21)_$P(Y,U,3)
"RTN","ORCXPND2",22,0)
 I $O(Y("C",0)) S I=0 F  S I=$O(Y("C",I)) Q:I'>0  D  ; comments
"RTN","ORCXPND2",23,0)
 . D BLANK^ORCXPND
"RTN","ORCXPND2",24,0)
 . S DATE=$P(Y("C",I),U),SOURCE=$P(Y("C",I),U,2)
"RTN","ORCXPND2",25,0)
 . S:SOURCE="ORIGINATOR" SOURCE=$P(Y,U,2) ; use name
"RTN","ORCXPND2",26,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$J($$DATE(DATE),20)_" "_SOURCE
"RTN","ORCXPND2",27,0)
 . S J=0 F  S J=$O(Y("C",I,J)) Q:J'>0  D
"RTN","ORCXPND2",28,0)
 . . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=Y("C",I,J,0)
"RTN","ORCXPND2",29,0)
 Q
"RTN","ORCXPND2",30,0)
 ;
"RTN","ORCXPND2",31,0)
XRAY ; -- Single xray report per procedure
"RTN","ORCXPND2",32,0)
 N CASE,PROC
"RTN","ORCXPND2",33,0)
 S CASE=0 F  S CASE=$O(^TMP($J,"RAE2",+ORVP,CASE)) Q:CASE'>0  D
"RTN","ORCXPND2",34,0)
 . S PROC="" F  S PROC=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC)) Q:PROC=""  D ITEM^ORCXPND(PROC),BLANK^ORCXPND,XRPT,BLANK^ORCXPND
"RTN","ORCXPND2",35,0)
 Q
"RTN","ORCXPND2",36,0)
 ;
"RTN","ORCXPND2",37,0)
XRSET ; -- Print set of one report for many procedures
"RTN","ORCXPND2",38,0)
 N CASE,PROC
"RTN","ORCXPND2",39,0)
 S CASE=0 F  S CASE=$O(^TMP($J,"RAE2",+ORVP,CASE)) Q:CASE'>0  D
"RTN","ORCXPND2",40,0)
 . S PROC=$O(^TMP($J,"RAE2",+ORVP,CASE,"")) D ITEM^ORCXPND(PROC)
"RTN","ORCXPND2",41,0)
 S CASE=$O(^TMP($J,"RAE2",+ORVP,0)),PROC=$O(^(CASE,"")) ;1st case
"RTN","ORCXPND2",42,0)
 D BLANK^ORCXPND,XRPT,BLANK^ORCXPND
"RTN","ORCXPND2",43,0)
 Q
"RTN","ORCXPND2",44,0)
 ;
"RTN","ORCXPND2",45,0)
XRPT ; -- body of report for CASE, PROC
"RTN","ORCXPND2",46,0)
 N NODE,ST,ORD,X,I,ORIFN,REQPROV
"RTN","ORCXPND2",47,0)
 S ORD=$S($L($G(^TMP($J,"RAE2",+ORVP,"ORD"))):^("ORD"),$L($G(^("ORD",CASE))):^(CASE),1:"") I $L(ORD),ORD'=PROC S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Proc Ordered  : "_ORD
"RTN","ORCXPND2",48,0)
 I $G(EXAMDATE) S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Exam Date     : "_$$DATETIME^ORCHTAB(EXAMDATE)
"RTN","ORCXPND2",49,0)
 I $D(CASENMBR) D  ; Case number(s)
"RTN","ORCXPND2",50,0)
 . S X="" I $G(CASENMBR)<0 S X=$P(CASENMBR,U,2)
"RTN","ORCXPND2",51,0)
 . E  S I="" F  S I=$O(CASENMBR(I)) Q:I=""  S X=X_$S($L(X):", ",1:"")_I
"RTN","ORCXPND2",52,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Case No.      : "_X
"RTN","ORCXPND2",53,0)
 S NODE=$G(^TMP($J,"RAE2",+ORVP,CASE,PROC)),ORIFN=$P(NODE,U,3)
"RTN","ORCXPND2",54,0)
 I ORIFN S REQPROV=+$P($G(^OR(100,+ORIFN,0)),U,4) S:REQPROV LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Req Provider  : "_$P($G(^VA(200,REQPROV,0)),U)
"RTN","ORCXPND2",55,0)
 S ST=$P(NODE,U),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Report Status : "_ST
"RTN","ORCXPND2",56,0)
 I $P(NODE,U,2)="Y" S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="             ** ABNORMAL RESULTS **" D:$D(IOINHI) CNTRL^VALM10(LCNT,13,22,IOINHI,IOINORM)
"RTN","ORCXPND2",57,0)
 D BLANK^ORCXPND S X="Exam Modifiers: "
"RTN","ORCXPND2",58,0)
 I '$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"M",0)) S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X_"none"
"RTN","ORCXPND2",59,0)
 E  S I=0 F  S I=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"M",I)) Q:I'>0  S X=X_^(I),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X,X="                "
"RTN","ORCXPND2",60,0)
XR1 Q:$$UP^XLFSTR(ST)="NO REPORT"
"RTN","ORCXPND2",61,0)
 D XRTEXT("Clinical History: ","H")
"RTN","ORCXPND2",62,0)
 D XRTEXT("Report: ","R")
"RTN","ORCXPND2",63,0)
 D XRTEXT("Impression: ","I")
"RTN","ORCXPND2",64,0)
 D XRTEXT("Diagnostic Code: ","D"),BLANK^ORCXPND
"RTN","ORCXPND2",65,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Verified by: "_$P($G(^TMP($J,"RAE2",+ORVP,CASE,PROC,"V")),U,2)
"RTN","ORCXPND2",66,0)
 Q
"RTN","ORCXPND2",67,0)
 ;
"RTN","ORCXPND2",68,0)
XRTEXT(CAPTION,SUB) ; -- include wp text
"RTN","ORCXPND2",69,0)
 N DIWL,DIWF,DIWR,ORI,X D BLANK^ORCXPND
"RTN","ORCXPND2",70,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=CAPTION
"RTN","ORCXPND2",71,0)
 S DIWL=1,DIWF="C75" K ^UTILITY($J,"W")
"RTN","ORCXPND2",72,0)
 S ORI=0 F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,SUB,ORI)) Q:ORI'>0  S X=^(ORI) D ^DIWP
"RTN","ORCXPND2",73,0)
 S ORI=0 F  S ORI=$O(^UTILITY($J,"W",DIWL,ORI)) Q:ORI'>0  S X=^(ORI,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORCXPND2",74,0)
 K ^UTILITY($J,"W")
"RTN","ORCXPND2",75,0)
 Q
"RTN","ORCXPND2",76,0)
 ;
"RTN","ORCXPND2",77,0)
ORDERS ; -- orders
"RTN","ORCXPND2",78,0)
 N ORYY,I
"RTN","ORCXPND2",79,0)
 S ORYY="^TMP(""ORTXT"",$J)"
"RTN","ORCXPND2",80,0)
 D DETAIL^ORQ2(.ORYY,+ID)
"RTN","ORCXPND2",81,0)
 S I=0 F  S I=$O(@ORYY@(I)) Q:I'>0  D
"RTN","ORCXPND2",82,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=@ORYY@(I)
"RTN","ORCXPND2",83,0)
 . I $D(@ORYY@("VIDEO",I)) M ^TMP("ORXPND",$J,"VIDEO",LCNT)=@ORYY@("VIDEO",I)
"RTN","ORCXPND2",84,0)
 Q
"RTN","ORCXPND2",85,0)
 ;
"RTN","ORCXPND2",86,0)
DATE(X) ; -- Return formatted date
"RTN","ORCXPND2",87,0)
 N Y S Y=""
"RTN","ORCXPND2",88,0)
 S:X Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","ORCXPND2",89,0)
 S:$P(X,".",2) Y=Y_" "_$E(X,9,10)_":"_$E(X,11,12)
"RTN","ORCXPND2",90,0)
 Q Y
"RTN","ORCXPND2",91,0)
 ;
"RTN","ORCXPND2",92,0)
DRUG ; -- UD or Outpt med
"RTN","ORCXPND2",93,0)
 N INPT,X,Y,PROV,DRUG,I,FILLD,RXN
"RTN","ORCXPND2",94,0)
 S INPT=($P(ID,";",2)="I"),DRUG=$P(NODE,U),PROV=$G(^TMP("PS",$J,"P",0))
"RTN","ORCXPND2",95,0)
 D ITEM^ORCXPND(DRUG),BLANK^ORCXPND
"RTN","ORCXPND2",96,0)
 S RXN=$G(^TMP("PS",$J,"RXN",0)) I RXN S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Prescription#:      "_$P(RXN,U)
"RTN","ORCXPND2",97,0)
 S:PROV LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Prescriber:         "_$P(PROV,U,2)
"RTN","ORCXPND2",98,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Total Dose:         "_$P(NODE,U,9)
"RTN","ORCXPND2",99,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Units/Dose:         "_$P(NODE,U,10)
"RTN","ORCXPND2",100,0)
 D MULT("MDR","Route:")
"RTN","ORCXPND2",101,0)
 D MULT("SCH","Schedule:")
"RTN","ORCXPND2",102,0)
 S X=$S(INPT:"Instructions:",1:"Sig:") D WP("SIG",X)
"RTN","ORCXPND2",103,0)
 D WP("PC","Provider Comments:"),WP("SIO","Other Instructions:")
"RTN","ORCXPND2",104,0)
 D BLANK^ORCXPND
"RTN","ORCXPND2",105,0)
D1 I 'INPT D
"RTN","ORCXPND2",106,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Days Supply:        "_$P(NODE,U,7)
"RTN","ORCXPND2",107,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Quantity:           "_$P(NODE,U,8)
"RTN","ORCXPND2",108,0)
 . S:$P(NODE,U,12) LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Last Filled:        "_$$FMTE^XLFDT($P(NODE,U,12),2)
"RTN","ORCXPND2",109,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Refills Remaining:  "_$P(NODE,U,4)
"RTN","ORCXPND2",110,0)
D2 . I $P(RXN,U,6)!$G(^TMP("PS",$J,"REF",0)) S X="Filled:             " D
"RTN","ORCXPND2",111,0)
 .. I $P(RXN,U,6) S FILLD=$P(RXN,U,6)_"^^^"_$P(RXN,U,7)_U_$P(RXN,U,3,4) D FILLED("R")
"RTN","ORCXPND2",112,0)
 .. S I=0 F  S I=$O(^TMP("PS",$J,"REF",I)) Q:I'>0  S FILLD=$G(^(I,0)) D FILLED("R")
"RTN","ORCXPND2",113,0)
 . I $G(^TMP("PS",$J,"PAR",0)) S I=0,X="Partial Fills:      " F  S I=$O(^TMP("PS",$J,"PAR",I)) Q:I'>0  S FILLD=$G(^(I,0)) D FILLED("P")
"RTN","ORCXPND2",114,0)
D3 I INPT,$D(^TMP("PS",$J,"ADM")) D
"RTN","ORCXPND2",115,0)
 . N I,X S X="Admin Times:        ",I=0
"RTN","ORCXPND2",116,0)
 . F  S I=$O(^TMP("PS",$J,"ADM",I)) Q:I'>0  S Y=$G(^(I,0)) S:$L(Y) LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X_Y,X="                    "
"RTN","ORCXPND2",117,0)
 D BLANK^ORCXPND,SDATES
"RTN","ORCXPND2",118,0)
 Q
"RTN","ORCXPND2",119,0)
 ;
"RTN","ORCXPND2",120,0)
FILLED(TYPE) ; -- add FILLD data
"RTN","ORCXPND2",121,0)
 N Y S Y=$$FMTE^XLFDT($P(FILLD,U),2)_" ("_$$ROUTING($P(FILLD,U,5))_")"
"RTN","ORCXPND2",122,0)
 S:TYPE="R"&$P(FILLD,U,4) Y=Y_" released "_$$FMTE^XLFDT($P(FILLD,U,4),2)
"RTN","ORCXPND2",123,0)
 S:TYPE="P"&$P(FILLD,U,3) Y=Y_" Qty: "_$P(FILLD,U,3)
"RTN","ORCXPND2",124,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X_Y,X="                    "
"RTN","ORCXPND2",125,0)
 S:$L($P(FILLD,U,6)) LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X_$P(FILLD,U,6)
"RTN","ORCXPND2",126,0)
 Q
"RTN","ORCXPND2",127,0)
 ;
"RTN","ORCXPND2",128,0)
ROUTING(X) ; -- Returns external form
"RTN","ORCXPND2",129,0)
 N Y S Y=$S($G(X)="M":"Mail",$G(X)="W":"Window",1:$G(X))
"RTN","ORCXPND2",130,0)
 Q Y
"RTN","ORCXPND2",131,0)
 ;
"RTN","ORCXPND2",132,0)
IV ; -- IV Fluid
"RTN","ORCXPND2",133,0)
 N PROV S PROV=$G(^TMP("PS",$J,"P",0))
"RTN","ORCXPND2",134,0)
 D ITEM^ORCXPND("IV Fluid"),BLANK^ORCXPND
"RTN","ORCXPND2",135,0)
 S:PROV LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Prescriber:         "_$P(PROV,U,2)
"RTN","ORCXPND2",136,0)
 D MULT("B","Solution:")
"RTN","ORCXPND2",137,0)
 D MULT("A","Additive:")
"RTN","ORCXPND2",138,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Infusion Rate:      "_$P(NODE,U,2)
"RTN","ORCXPND2",139,0)
 D WP("PC","Provider Comments:"),BLANK^ORCXPND
"RTN","ORCXPND2",140,0)
 D SDATES
"RTN","ORCXPND2",141,0)
 Q
"RTN","ORCXPND2",142,0)
 ;
"RTN","ORCXPND2",143,0)
 ;
"RTN","ORCXPND2",144,0)
MULT(SUB,CAPTION) ; -- add multiple valued item
"RTN","ORCXPND2",145,0)
 N I,FIRST,SPACES,X S FIRST=1,I=0,SPACES="                    "
"RTN","ORCXPND2",146,0)
 F  S I=$O(^TMP("PS",$J,SUB,I)) Q:I'>0  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$S(FIRST:CAPTION,1:"")_$E(SPACES,1,20-$L(CAPTION))_$TR(X,"^"," "),FIRST=0,CAPTION=""
"RTN","ORCXPND2",147,0)
 Q
"RTN","ORCXPND2",148,0)
 ;
"RTN","ORCXPND2",149,0)
WP(SUB,CAPTION) ; -- add wp item
"RTN","ORCXPND2",150,0)
 N ORI,FIRST,SPACES,DIWL,DIWR,DIWF,X
"RTN","ORCXPND2",151,0)
 S DIWL=1,DIWR=60,DIWF="C60",ORI=0 K ^UTILITY($J,"W")
"RTN","ORCXPND2",152,0)
 F  S ORI=$O(^TMP("PS",$J,SUB,ORI)) Q:ORI'>0  S X=^(ORI,0) D ^DIWP
"RTN","ORCXPND2",153,0)
 S FIRST=1,ORI=0,SPACES="                    "
"RTN","ORCXPND2",154,0)
 F  S ORI=$O(^UTILITY($J,"W",DIWL,ORI)) Q:ORI'>0  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$S(FIRST:CAPTION,1:"")_$E(SPACES,1,20-$L(CAPTION))_^(ORI,0),FIRST=0,CAPTION=""
"RTN","ORCXPND2",155,0)
 K ^UTILITY($J,"W")
"RTN","ORCXPND2",156,0)
 Q
"RTN","ORCXPND2",157,0)
SDATES ; -- add start & stop dates, status
"RTN","ORCXPND2",158,0)
 N RXN S RXN=$G(^TMP("PS",$J,"RXN",0))
"RTN","ORCXPND2",159,0)
 I $P(RXN,U,5) S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Pharmacist:         "_$P($G(^VA(200,+$P(RXN,U,5),0)),U)
"RTN","ORCXPND2",160,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Start Date:         "_$$FMTE^XLFDT($P(NODE,U,5),"2P")
"RTN","ORCXPND2",161,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Stop Date:          "_$$FMTE^XLFDT($P(NODE,U,3),"2P")
"RTN","ORCXPND2",162,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Status:             "_$P(NODE,U,6)
"RTN","ORCXPND2",163,0)
 S:$P(NODE,U,11) LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Order #"_+$P(NODE,U,11)
"RTN","ORCXPND2",164,0)
 Q
"RTN","ORDV02")
0^86^B68179336
"RTN","ORDV02",1,0)
ORDV02 ; slc/dcm - OE/RR Report Extracts ; 11 Jun 2002  7:44 AM
"RTN","ORDV02",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,118,146,141**;Dec 17, 1997
"RTN","ORDV02",3,0)
 ;LAB Components
"RTN","ORDV02",4,0)
LO(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)      ; Lab Order Component
"RTN","ORDV02",5,0)
 ;External calls to ^GMTSLROE
"RTN","ORDV02",6,0)
 N D,SN,ORX0,MAX,GMTS1,GMTS2,GMTSBEG,GMTSEND,ORSITE,SITE,GO
"RTN","ORDV02",7,0)
 Q:'$L(OREXT)
"RTN","ORDV02",8,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV02",9,0)
 Q:'$L($T(@GO))
"RTN","ORDV02",10,0)
 S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS1=OROMEGA,GMTS2=ORALPHA,GMTSBEG=ORDBEG,GMTSEND=ORDEND
"RTN","ORDV02",11,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV02",12,0)
 K ^TMP("LR",$J),^TMP("LRO",$J),^TMP("ORDATA",$J)
"RTN","ORDV02",13,0)
 D @GO
"RTN","ORDV02",14,0)
 S (CTR,D)=0
"RTN","ORDV02",15,0)
 F  S D=$O(^TMP("LRO",$J,D)) Q:'D  D
"RTN","ORDV02",16,0)
 . S SN=0
"RTN","ORDV02",17,0)
 . F  S SN=$O(^TMP("LRO",$J,D,SN)) Q:'SN  S ORX0=^(SN) I $L(ORX0) D
"RTN","ORDV02",18,0)
 .. S SITE=$S($L($G(^TMP("LRO",$J,D,SN,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV02",19,0)
 .. S ^TMP("ORDATA",$J,D,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV02",20,0)
 .. S ^TMP("ORDATA",$J,D,"WP",2)="2^"_$P(ORX0,U) ;collection date
"RTN","ORDV02",21,0)
 .. S ^TMP("ORDATA",$J,D,"WP",3)="3^"_$P($P(ORX0,U,2),";",2) ;test name
"RTN","ORDV02",22,0)
 .. S ^TMP("ORDATA",$J,D,"WP",4)="4^"_$P($P(ORX0,U,2),";") ;test ien
"RTN","ORDV02",23,0)
 .. S ^TMP("ORDATA",$J,D,"WP",5)="5^"_$P($P(ORX0,U,3),";",2) ;specimen name
"RTN","ORDV02",24,0)
 .. S ^TMP("ORDATA",$J,D,"WP",6)="6^"_$P($P(ORX0,U,3),";") ;specimen ien
"RTN","ORDV02",25,0)
 .. S ^TMP("ORDATA",$J,D,"WP",7)="7^"_$P(ORX0,U,4) ;urgency
"RTN","ORDV02",26,0)
 .. S ^TMP("ORDATA",$J,D,"WP",8)="8^"_$P($P(ORX0,U,6),";",2) ;provider name
"RTN","ORDV02",27,0)
 .. S ^TMP("ORDATA",$J,D,"WP",9)="9^"_$P($P(ORX0,U,6),";") ;provider ien
"RTN","ORDV02",28,0)
 .. S ^TMP("ORDATA",$J,D,"WP",10)="10^"_$P(ORX0,U,7) ;order date/time
"RTN","ORDV02",29,0)
 .. S ^TMP("ORDATA",$J,D,"WP",11)="11^"_$P(ORX0,U,8) ;accession number
"RTN","ORDV02",30,0)
 .. S ^TMP("ORDATA",$J,D,"WP",12)="12^"_$P(ORX0,U,9) ;available date/time
"RTN","ORDV02",31,0)
 .. S ^TMP("ORDATA",$J,D,"WP",13)="13^"_$P(ORX0,U,5) ;status
"RTN","ORDV02",32,0)
 K ^TMP("LRO",$J)
"RTN","ORDV02",33,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV02",34,0)
 Q
"RTN","ORDV02",35,0)
LRO ;GCPR Launch for Lab Order Component
"RTN","ORDV02",36,0)
 Q:'$L($T(GCPR^OMGCOAS1))
"RTN","ORDV02",37,0)
 N BEG,END,MAX
"RTN","ORDV02",38,0)
 Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV02",39,0)
 S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV02",40,0)
 S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV02",41,0)
 D GCPR^OMGCOAS1(DFN,"LRO",BEG,END,MAX)
"RTN","ORDV02",42,0)
 Q
"RTN","ORDV02",43,0)
CH(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)     ;Chemistry/Hematology
"RTN","ORDV02",44,0)
 ;External references to ^DPT(DFN,"LR"),^LR(LRDFN, ^GMTSLRCE
"RTN","ORDV02",45,0)
 N CTR,ORI,TST,PC,ORX0,GMCFLAG,GMCMNT,GMW,IX0,IX,LRDFN,CNT,PTR,MAX,GMTS1,GMTS2,GMTSAGE,ORSITE,SEX,SITE,GO,VA,VAIN,VAERR,VAIN
"RTN","ORDV02",46,0)
 Q:'$L(OREXT)
"RTN","ORDV02",47,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV02",48,0)
 Q:'$L($T(@GO))
"RTN","ORDV02",49,0)
 S LRDFN=+$G(^DPT(DFN,"LR"))
"RTN","ORDV02",50,0)
 I GO["GMTSLRCE" Q:'LRDFN
"RTN","ORDV02",51,0)
 D OERR^VADPT
"RTN","ORDV02",52,0)
 S GMTSAGE=$S(+VADM(4)>0:+VADM(4),1:99),SEX=$P(VADM(5),"^")
"RTN","ORDV02",53,0)
 S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS1=OROMEGA,GMTS2=ORALPHA
"RTN","ORDV02",54,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV02",55,0)
 K ^TMP("LRC",$J),^TMP("ORDATA",$J)
"RTN","ORDV02",56,0)
 D @GO
"RTN","ORDV02",57,0)
 S CTR=0,ORI=GMTS1
"RTN","ORDV02",58,0)
 F  S ORI=$O(^TMP("LRC",$J,ORI)) Q:'ORI!(ORI>GMTS2)  D
"RTN","ORDV02",59,0)
 . S TST=""
"RTN","ORDV02",60,0)
 . F  S TST=$O(^TMP("LRC",$J,ORI,TST)) Q:TST=""  D
"RTN","ORDV02",61,0)
 .. I TST S ORX0=$G(^TMP("LRC",$J,ORI,TST)) Q:ORX0=""  D
"RTN","ORDV02",62,0)
 ... S SITE=$S($L($G(^TMP("LRC",$J,ORI,TST,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV02",63,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV02",64,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",2)="2^"_$P(ORX0,U) ;collection date
"RTN","ORDV02",65,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",3)="3^"_$P(ORX0,U,3) ;test name
"RTN","ORDV02",66,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",4)="4^"_$P(ORX0,U,2) ;specimen
"RTN","ORDV02",67,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",5)="5^"_$P(ORX0,U,4) ;result
"RTN","ORDV02",68,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",6)="6^"_$P(ORX0,U,5) ;indicator
"RTN","ORDV02",69,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",7)="7^"_$P(ORX0,U,6) ;units
"RTN","ORDV02",70,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",8)="8^"_$P(ORX0,U,7) ;ref low
"RTN","ORDV02",71,0)
 ... S ^TMP("ORDATA",$J,ORI,TST,"WP",9)="9^"_$P(ORX0,U,8) ;ref high
"RTN","ORDV02",72,0)
 ... D SPMRG^ORDVU("^TMP(""LRC"","_$J_","_ORI_",""C"")","^TMP(""ORDATA"","_$J_","_ORI_","_TST_",""WP"",10)",10) ;comments
"RTN","ORDV02",73,0)
 ... I $O(^TMP("LRC",$J,ORI,"C",0)) S ^TMP("ORDATA",$J,ORI,TST,"WP",11)="11^[+]" ;flag for details
"RTN","ORDV02",74,0)
 .. S CTR=CTR+1
"RTN","ORDV02",75,0)
 K ^TMP("LRC",$J)
"RTN","ORDV02",76,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV02",77,0)
 Q
"RTN","ORDV02",78,0)
LRC ;GCPR Launch for Lab Chem/Hem component
"RTN","ORDV02",79,0)
 Q:'$L($T(GCPR^OMGCOAS1))
"RTN","ORDV02",80,0)
 N BEG,END,MAX
"RTN","ORDV02",81,0)
 Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV02",82,0)
 S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV02",83,0)
 S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV02",84,0)
 D GCPR^OMGCOAS1(DFN,"LRC",BEG,END,MAX)
"RTN","ORDV02",85,0)
 Q
"RTN","ORDV02",86,0)
SP(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)      ;Surgical Pathology
"RTN","ORDV02",87,0)
 ;External references to ^DPT(DFN,"LR"), ^GMTSLRAE, 
"RTN","ORDV02",88,0)
 N ORDT,ORX0,ORCNT,GMI,MAX,LRDFN,IX,X,IX0,GMTS1,GMTS2,ORSITE,SITE,GO
"RTN","ORDV02",89,0)
 Q:'$L(OREXT)
"RTN","ORDV02",90,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV02",91,0)
 Q:'$L($T(@GO))
"RTN","ORDV02",92,0)
 S LRDFN=+$G(^DPT(DFN,"LR"))
"RTN","ORDV02",93,0)
 I GO["GMTSLRAE" Q:'LRDFN
"RTN","ORDV02",94,0)
 S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS1=OROMEGA,GMTS2=ORALPHA
"RTN","ORDV02",95,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV02",96,0)
 K ^TMP("LRA",$J),^TMP("ORDATA",$J)
"RTN","ORDV02",97,0)
 D @GO
"RTN","ORDV02",98,0)
 S ORDT=GMTS1,ORCNT=0
"RTN","ORDV02",99,0)
 F  S ORDT=$O(^TMP("LRA",$J,ORDT)) Q:(ORDT'>0)!(ORDT>GMTS2)  S ORX0=^(ORDT,0) D
"RTN","ORDV02",100,0)
 . S SITE=$S($L($G(^TMP("LRA",$J,ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV02",101,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV02",102,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",2)="2^"_$P(ORX0,U) ;collection date
"RTN","ORDV02",103,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",4)="4^"_$P(ORX0,U,2) ;accession number
"RTN","ORDV02",104,0)
 . D SPMRG^ORDVU("^TMP(""LRA"","_$J_","_ORDT_",.1)","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",3)",3) ;specimen
"RTN","ORDV02",105,0)
 . D SPMRG^ORDVU("^TMP(""LRA"","_$J_","_ORDT_",.2)","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",5)",5) ;brief Clinical Hx
"RTN","ORDV02",106,0)
 . D SPMRG^ORDVU("^TMP(""LRA"","_$J_","_ORDT_",1)","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",6)",6) ;gross Description
"RTN","ORDV02",107,0)
 . D SPMRG^ORDVU("^TMP(""LRA"","_$J_","_ORDT_",1.1)","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",7)",7) ;microscopic Exam
"RTN","ORDV02",108,0)
 . I $D(^TMP("LRA",$J,ORDT,1.2,1,0)) S X=^(0) D
"RTN","ORDV02",109,0)
 .. S ^TMP("LRA",$J,ORDT,1.2,1,0)=$$DATE^ORDVU(X)
"RTN","ORDV02",110,0)
 .. D SPMRG^ORDVU("^TMP(""LRA"","_$J_","_ORDT_",1.2)","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",8)",8) ;supplemetary Report
"RTN","ORDV02",111,0)
 . D SPMRG^ORDVU("^TMP(""LRA"","_$J_","_ORDT_",1.3)","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",9)",9) ;frozen Section
"RTN","ORDV02",112,0)
 . D SPMRG^ORDVU("^TMP(""LRA"","_$J_","_ORDT_",1.4)","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",10)",10) ;surgical path Dx
"RTN","ORDV02",113,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",11)="11^[+]" ;flag for detail
"RTN","ORDV02",114,0)
 K ^TMP("LRA",$J)
"RTN","ORDV02",115,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV02",116,0)
 Q
"RTN","ORDV02",117,0)
SPG ;GCPR Launch for Surgical Path Component
"RTN","ORDV02",118,0)
 Q:'$L($T(GCPR^OMGCOAS1))
"RTN","ORDV02",119,0)
 N BEG,END,MAX
"RTN","ORDV02",120,0)
 Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV02",121,0)
 S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV02",122,0)
 S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV02",123,0)
 D GCPR^OMGCOAS1(DFN,"SP",BEG,END,MAX)
"RTN","ORDV02",124,0)
 Q
"RTN","ORDV02",125,0)
CY(ROOT,ORALPHA,OROMEGA,ORMAX,ORDBEG,ORDEND,OREXT)      ;Cytopathology
"RTN","ORDV02",126,0)
 ;External references to ^DPT(DFN,"LR"), ^GMTSLRPE 
"RTN","ORDV02",127,0)
 N ORDT,ORX0,GMI,IX0,MAX,LRDFN,IX,GMTS1,GMTS2,ORSITE,SITE,GO,ORMORE
"RTN","ORDV02",128,0)
 Q:'$L(OREXT)
"RTN","ORDV02",129,0)
 S GO=$P(OREXT,";")_"^"_$P(OREXT,";",2)
"RTN","ORDV02",130,0)
 Q:'$L($T(@GO))
"RTN","ORDV02",131,0)
 S LRDFN=+$G(^DPT(DFN,"LR"))
"RTN","ORDV02",132,0)
 I GO["GMTSLRPE" Q:'LRDFN
"RTN","ORDV02",133,0)
 S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999),GMTS1=OROMEGA,GMTS2=ORALPHA
"RTN","ORDV02",134,0)
 S ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV02",135,0)
 K ^TMP("LRCY",$J),^TMP("ORDATA",$J)
"RTN","ORDV02",136,0)
 D @GO
"RTN","ORDV02",137,0)
 S ORDT=GMTS1,ORSITE=$$SITE^VASITE,ORSITE=$P(ORSITE,"^",2)_";"_$P(ORSITE,"^",3)
"RTN","ORDV02",138,0)
 F  S ORDT=$O(^TMP("LRCY",$J,ORDT)) Q:(ORDT'>0)!(ORDT>GMTS2)  S ORX0=$G(^(ORDT,0)) D
"RTN","ORDV02",139,0)
 . S ORMORE=0,SITE=$S($L($G(^TMP("LRCY",$J,ORDT,"facility"))):^("facility"),1:ORSITE)
"RTN","ORDV02",140,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",1)="1^"_SITE ;Station ID
"RTN","ORDV02",141,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",2)="2^"_$P(ORX0,U)       ;collection date
"RTN","ORDV02",142,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",5)="5^"_$P(ORX0,U,2)     ;accession number
"RTN","ORDV02",143,0)
 . S ^TMP("ORDATA",$J,ORDT,"WP",4)="4^"_$$DATE^ORDVU($P($G(^TMP("LRCY",$J,ORDT,1)),U,2)) ;report release date
"RTN","ORDV02",144,0)
 . I $O(^TMP("LRCY",$J,ORDT,1,0)) S ORMORE=1 D SPMRG^ORDVU("^TMP(""LRCY"","_$J_","_ORDT_",1)","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",3)",3) ;specimen
"RTN","ORDV02",145,0)
 . I $O(^TMP("LRCY",$J,ORDT,"AH",0)) S ORMORE=1 D SPMRG^ORDVU("^TMP(""LRCY"","_$J_","_ORDT_",""AH"")","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",6)",6) ;brief Clinical Hx
"RTN","ORDV02",146,0)
 . I $O(^TMP("LRCY",$J,ORDT,"G",0)) S ORMORE=1 D SPMRG^ORDVU("^TMP(""LRCY"","_$J_","_ORDT_",""G"")","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",7)",7) ;gross Description
"RTN","ORDV02",147,0)
 . I $O(^TMP("LRCY",$J,ORDT,"MI",0)) S ORMORE=1 D SPMRG^ORDVU("^TMP(""LRCY"","_$J_","_ORDT_",""MI"")","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",8)",8) ;microscopic Exam
"RTN","ORDV02",148,0)
 . I $O(^TMP("LRCY",$J,ORDT,"NDX",0)) S ORMORE=1 D SPMRG^ORDVU("^TMP(""LRCY"","_$J_","_ORDT_",""NDX"")","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",9)",9) ;cythopathology DX
"RTN","ORDV02",149,0)
 . I $O(^TMP("LRCY",$J,ORDT,"SR",0)) S ORMORE=1 D SPMRG^ORDVU("^TMP(""LRCY"","_$J_","_ORDT_",""SR"")","^TMP(""ORDATA"","_$J_","_ORDT_",""WP"",10)",10) ;supplemetary Report
"RTN","ORDV02",150,0)
 . I ORMORE S ^TMP("ORDATA",$J,ORDT,"WP",11)="11^[+]" ;flag for detail
"RTN","ORDV02",151,0)
 K ^TMP("LRCY",$J)
"RTN","ORDV02",152,0)
 S ROOT=$NA(^TMP("ORDATA",$J))
"RTN","ORDV02",153,0)
 Q
"RTN","ORDV02",154,0)
CYG ;GCPR Launch for Cytology Component
"RTN","ORDV02",155,0)
 Q:'$L($T(GCPR^OMGCOAS1))
"RTN","ORDV02",156,0)
 N BEG,END,MAX
"RTN","ORDV02",157,0)
 Q:'$G(ORALPHA)  Q:'$G(OROMEGA)
"RTN","ORDV02",158,0)
 S MAX=$S(+$G(ORMAX)>0:ORMAX,1:999)
"RTN","ORDV02",159,0)
 S BEG=9999999-OROMEGA,END=9999999-ORALPHA
"RTN","ORDV02",160,0)
 D GCPR^OMGCOAS1(DFN,"CY",BEG,END,MAX)
"RTN","ORDV02",161,0)
 Q
"RTN","ORDV02",162,0)
TEST ;Test SP/CY/CH call
"RTN","ORDV02",163,0)
 S DFN=16,OROMEGA=9999999-2850001,ORALPHA=9999999-3011101
"RTN","ORDV02",164,0)
 S OREXT=";GMTSLRPE" D CY(.ROOT,OROMEGA,ORALPHA,999,,,OREXT)
"RTN","ORDV02",165,0)
 ;S OREXT=";GMTSLRAE" D SP(.ROOT,ORALPHA,OROMEGA,999,,,OREXT)
"RTN","ORDV02",166,0)
 ;S OREXT=";GMTSLRCE" D CH(.ROOT,OROMEGA,ORALPHA,999,,,OREXT)
"RTN","ORDV02",167,0)
 Q
"RTN","ORECS01")
0^62^B887894
"RTN","ORECS01",1,0)
ORECS01 ;SLC/JDL-CPRS utility for Event Capture System; 5/21/02 10:00AM ;6/14/02  13:04
"RTN","ORECS01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORECS01",3,0)
 ;
"RTN","ORECS01",4,0)
CHKESSO(ORY,CHK) ;--1=ESSO installed on site  0=not installed
"RTN","ORECS01",5,0)
 S ORY=$$PATCH^XPDUTL("XWB*1.1*26")
"RTN","ORECS01",6,0)
 Q
"RTN","ORECS01",7,0)
 ;
"RTN","ORECS01",8,0)
VSITID(ORY,VSTSTR) ;--Return Visit IEN ptr to #9000010
"RTN","ORECS01",9,0)
 ;VSTSTR=HospLoc;DateTime;Category;PtIEN
"RTN","ORECS01",10,0)
 N DTREF,PTID
"RTN","ORECS01",11,0)
 S ORY=0
"RTN","ORECS01",12,0)
 S DTREF=9999999-$P($P(VSTSTR,";",2),".")_"."_$P($P(VSTSTR,";",2),".",2)
"RTN","ORECS01",13,0)
 S PTID=+$P(VSTSTR,";",4)
"RTN","ORECS01",14,0)
 S:$D(^AUPNVSIT("AA",PTID,DTREF)) ORY=$O(^(DTREF,0))
"RTN","ORECS01",15,0)
 Q
"RTN","ORECS01",16,0)
 ;
"RTN","ORECS01",17,0)
ECRPT(ORY,ORECARY) ;--EC report
"RTN","ORECS01",18,0)
 Q:'$D(ORECARY)
"RTN","ORECS01",19,0)
 D RPTEN^ECRRPC(.ORY,.ORECARY)
"RTN","ORECS01",20,0)
 Q
"RTN","ORECS01",21,0)
 ;
"RTN","ORECS01",22,0)
ECPRINT(ORY,ORECARY) ;--Print ECS report to Device
"RTN","ORECS01",23,0)
 Q:'$D(ORECARY)
"RTN","ORECS01",24,0)
 D RPTEN^ECRRPC(.ORY,.ORECARY)
"RTN","ORECS01",25,0)
 Q
"RTN","ORECS01",26,0)
 ;
"RTN","ORECS01",27,0)
GETDIV(ORY,USR) ;--Get user's division
"RTN","ORECS01",28,0)
 S ORY=0
"RTN","ORECS01",29,0)
 S:$G(DUZ(2)) ORY=DUZ(2)
"RTN","ORECS01",30,0)
 Q
"RTN","OREV")
0^80^B79805634
"RTN","OREV",1,0)
OREV ;SLC/DAN Event delayed orders set up ;10/25/02  13:46
"RTN","OREV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**142,141**;Dec 17, 1997
"RTN","OREV",3,0)
 ;DBIA reference section
"RTN","OREV",4,0)
 ;2336 - XPAREDIT, which is used in OREV EVENT input template
"RTN","OREV",5,0)
 ;10102- XQORM1
"RTN","OREV",6,0)
 ;10104- XLFSTR
"RTN","OREV",7,0)
 ;10103- XLFDT
"RTN","OREV",8,0)
 ;519  - ^DIC(45.7
"RTN","OREV",9,0)
 ;10116- VALM1
"RTN","OREV",10,0)
 ;10026- DIR
"RTN","OREV",11,0)
 ;10117- VALM10
"RTN","OREV",12,0)
 ;10118- VALM
"RTN","OREV",13,0)
 ;10006- DIC
"RTN","OREV",14,0)
 ;10018- DIE
"RTN","OREV",15,0)
 ;10013- DIK
"RTN","OREV",16,0)
EN ; -- main entry point for OR DELAYED ORDERS
"RTN","OREV",17,0)
 N DIR,Y,ORTYPE,XQORNOD,VALMHDR,VALMSG,VALMBCK,VALMBG,VALMWD,XQORM,ORNMBR
"RTN","OREV",18,0)
 F  D  Q:+Y'>0  D SWITCH
"RTN","OREV",19,0)
 .S DIR(0)="SO^1:Auto-DC Rules;2:Release Events" D ^DIR K DIR
"RTN","OREV",20,0)
 .Q:+Y'>0  S ORTYPE=$S(Y=1:"A",1:"E")
"RTN","OREV",21,0)
 Q
"RTN","OREV",22,0)
 ;
"RTN","OREV",23,0)
SWITCH D EN^VALM($S(ORTYPE="A":"OREV AUTO-DC ACTIONS",1:"OREV EVENT ACTIONS"))
"RTN","OREV",24,0)
 Q
"RTN","OREV",25,0)
 ;
"RTN","OREV",26,0)
HDR ; -- header code
"RTN","OREV",27,0)
 N LST,DSP
"RTN","OREV",28,0)
 S DSP=$G(^TMP("ORDSP",$J,DUZ))
"RTN","OREV",29,0)
 S LST=$G(^TMP("ORLIST",$J,DUZ))
"RTN","OREV",30,0)
 S VALMHDR(1)=$S(ORTYPE="E":"Event ",1:"Auto-DC ")_"set up and maintenance"
"RTN","OREV",31,0)
 S VALMHDR(1)=VALMHDR(1)_" - "_$S(LST="I":"Inactive",LST="A":"Active",1:"All")_" entries/"_$S(DSP:"Expanded",1:"Truncated")_" view"
"RTN","OREV",32,0)
 Q
"RTN","OREV",33,0)
 ;
"RTN","OREV",34,0)
PHDR ;
"RTN","OREV",35,0)
 S VALMSG=$S($G(ORTYPE)'="":"Select number or enter action desired",1:"")
"RTN","OREV",36,0)
 S XQORM("#")=$S(ORTYPE="E":$O(^ORD(101,"B","OREV ENTER/EDIT EVENTS MENU",0)),1:$O(^ORD(101,"B","OREV ENTER/EDIT AUTO DC MENU",0)))
"RTN","OREV",37,0)
 D SHOW^VALM
"RTN","OREV",38,0)
 Q
"RTN","OREV",39,0)
 ;
"RTN","OREV",40,0)
INIT ;
"RTN","OREV",41,0)
 S VALMBCK="",VALMBG=$S($G(VALMBG)'="":VALMBG,1:1),VALMCNT=0,VALMWD=80
"RTN","OREV",42,0)
 K ^TMP("OREDO",$J),^TMP("ORCXPND",$J)
"RTN","OREV",43,0)
 Q
"RTN","OREV",44,0)
 ;
"RTN","OREV",45,0)
LIST ; -- produce list of existing events/rules
"RTN","OREV",46,0)
 N ORI,ORCNT,ORGLOB,ORJ,NAME,DSP,LST
"RTN","OREV",47,0)
 K ^TMP("OREDO",$J) ;Delete list before building
"RTN","OREV",48,0)
 S DSP=$G(^TMP("ORDSP",$J,DUZ)) ;Display full text if DSP =1 else truncate
"RTN","OREV",49,0)
 S LST=$G(^TMP("ORLIST",$J,DUZ)) ;List shows active, inactive or all
"RTN","OREV",50,0)
 S ORGLOB="^ORD(100."_$S(ORTYPE="E":"5)",1:"6)")
"RTN","OREV",51,0)
 S VALMBCK="R"
"RTN","OREV",52,0)
 S ORI="" F  S ORI=$O(@ORGLOB@("B",ORI)) Q:ORI=""  D
"RTN","OREV",53,0)
 .S ORJ="" F  S ORJ=$O(@ORGLOB@("B",ORI,ORJ)) Q:ORJ=""  Q:ORTYPE="E"&($P($G(@ORGLOB@(ORJ,0)),U,12))  D GETENTRY(ORJ,DSP,LST,.ORCNT,ORGLOB)
"RTN","OREV",54,0)
 ;set column headers to match display width
"RTN","OREV",55,0)
 S VALMDDF("NAME")="NAME^5^"_$S(DSP:50,1:40)_"^Event Name"
"RTN","OREV",56,0)
 S VALMDDF("DISPTXT")="DISPTXT^"_$S(DSP:58,1:46)_"^"_$S(DSP:60,1:20)_"^Display Text"
"RTN","OREV",57,0)
 S VALMDDF("ACT")="ACT^"_$S(DSP:119,1:67)_"^8^Active?"
"RTN","OREV",58,0)
 S VALMDDF("EVENT")="EVENT^"_$S(DSP:127,1:76)_"^5^Event"
"RTN","OREV",59,0)
 D CHGCAP^VALM("DISPTXT","Display Text") ;Causes caption line to be updated to new values set above
"RTN","OREV",60,0)
 S VALMCNT=+$G(ORCNT)
"RTN","OREV",61,0)
 Q
"RTN","OREV",62,0)
 ;
"RTN","OREV",63,0)
GETENTRY(ENTRY,DSP,LST,ORCNT,ORGLOB) ;
"RTN","OREV",64,0)
 ;
"RTN","OREV",65,0)
 N ZNODE,NAME,DN,ACT,ECODE,SP,CHILD,CHENTRY
"RTN","OREV",66,0)
 I LST'="" Q:LST="A"&($G(@ORGLOB@(ENTRY,1)))  Q:LST="I"&('$G(@ORGLOB@(ENTRY,1)))  ;If not all then only active or inactive
"RTN","OREV",67,0)
 S ZNODE=@ORGLOB@(ENTRY,0)
"RTN","OREV",68,0)
 S CHILD=$S($P(ZNODE,U,12):1,1:0)
"RTN","OREV",69,0)
 S NAME=$P(ZNODE,U) S:'DSP NAME=$E(NAME,1,$S(CHILD:38,1:40)) ;display is truncated
"RTN","OREV",70,0)
 S DN=$S(ORGLOB["5":8,1:5),DN=$P(ZNODE,U,DN) S:'DSP DN=$E(DN,1,20) ;display is truncated
"RTN","OREV",71,0)
 S ACT=$S($P($G(@ORGLOB@(ENTRY,1)),U):"N",1:"Y") ;rule active?
"RTN","OREV",72,0)
 S ECODE=$P(ZNODE,U,2) S:ECODE=""&(CHILD) ECODE=$P(^ORD(100.5,$P(ZNODE,U,12),0),U,2) ;event code
"RTN","OREV",73,0)
 S ORCNT=$G(ORCNT)+1,SP=$$REPEAT^XLFSTR(" ",$S(CHILD:6,1:4)-$L(ORCNT))
"RTN","OREV",74,0)
 D SET^VALM10(ORCNT,ORCNT_SP_NAME_$$REPEAT^XLFSTR(" ",($S(DSP&('CHILD):53,DSP&(CHILD):51,'DSP&('CHILD):41,1:39)-$L(NAME)))_DN_$$REPEAT^XLFSTR(" ",($S(DSP:63,1:23)-$L(DN)))_ACT_"       "_ECODE,ENTRY)
"RTN","OREV",75,0)
 I $D(^ORD(100.5,"DAD",ENTRY))&(ORTYPE="E") D
"RTN","OREV",76,0)
 .S CHENTRY=0 F  S CHENTRY=$O(^ORD(100.5,"DAD",ENTRY,CHENTRY)) Q:'+CHENTRY  D GETENTRY(CHENTRY,DSP,LST,.ORCNT,ORGLOB) ;Recursive call to list children
"RTN","OREV",77,0)
 Q
"RTN","OREV",78,0)
 ;
"RTN","OREV",79,0)
CHKSEL ;Evaluate selection if done by number
"RTN","OREV",80,0)
 N ORJ,ORTMP,DIR,NUM,X,Y
"RTN","OREV",81,0)
 S NUM=$P($G(XQORNOD(0)),"=",2) ;get currently selected entries
"RTN","OREV",82,0)
 I NUM'="" D
"RTN","OREV",83,0)
 .I NUM=$G(ORNMBR) D DESELECT Q  ;If user selects same entry without taking an entry, unhighlight and stop processing
"RTN","OREV",84,0)
 .D DESELECT:$G(ORNMBR) ;If user previously selected entries but took no action, unhighlight before highlighting new choices
"RTN","OREV",85,0)
 .S ORNMBR=$P(XQORNOD(0),"=",2),DIR(0)="L^"_"1:"_VALMCNT,X=ORNMBR,DIR("V")="" D ^DIR K DIR
"RTN","OREV",86,0)
 .I Y="" D FULL^VALM1 W !,"Invalid selection." S DIR(0)="E" D ^DIR K ORNMBR,DIR Q  ;Selection out of range, stop processing
"RTN","OREV",87,0)
 .F ORJ=1:1:$L(ORNMBR,",")-1 S ORTMP=$P(ORNMBR,",",ORJ) D CNTRL^VALM10(ORTMP,1,+$G(VALMWD),IORVON,IORVOFF)
"RTN","OREV",88,0)
 Q
"RTN","OREV",89,0)
 ;
"RTN","OREV",90,0)
HELP ; -- help code
"RTN","OREV",91,0)
 N X
"RTN","OREV",92,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","OREV",93,0)
 Q
"RTN","OREV",94,0)
 ;
"RTN","OREV",95,0)
EXIT ; -- exit code
"RTN","OREV",96,0)
 K ^TMP("OREDO",$J),^TMP("ORCXPND",$J),^UTILITY("DIQ1",$J),^TMP("ORHIST",$J),^TMP("ORDSP",$J,DUZ),^TMP("ORLIST",$J,DUZ),ORNMBR D FULL^VALM1 Q
"RTN","OREV",97,0)
 ;
"RTN","OREV",98,0)
EEE ;Enter/edit events
"RTN","OREV",99,0)
 N DIC,DLAYGO,ORJ,ORTMP,DA,DIE,DR,ORGLOB,NEW,TYPE,Y,DIDEL
"RTN","OREV",100,0)
 D FULL^VALM1 ;get full screen
"RTN","OREV",101,0)
 S VALMBCK="R"
"RTN","OREV",102,0)
 S ORGLOB=$S(ORTYPE="E":"^ORD(100.5,",1:"^ORD(100.6,")
"RTN","OREV",103,0)
 S DIDEL=$S(ORTYPE="E":100.5,1:100.6)
"RTN","OREV",104,0)
 S DIC=ORGLOB
"RTN","OREV",105,0)
 I $G(ORNMBR)="" S ORNMBR=$$ORDERS^OREV1("edit") Q:ORNMBR="^"  ;If action selected before items, get items
"RTN","OREV",106,0)
 I $G(ORNMBR)="" D  Q
"RTN","OREV",107,0)
 .S DLAYGO=$S(ORTYPE="E":100.5,1:100.6),DIC(0)="AEMQL"
"RTN","OREV",108,0)
 .D ^DIC Q:Y=-1  S NEW=$S($L(Y,"^")=3:1,1:0),DIE=DIC,DA=+Y
"RTN","OREV",109,0)
 .L +@(ORGLOB_DA_")"):1 I '$T W !!,"This entry is being edited by another user." H 3 Q
"RTN","OREV",110,0)
 .I NEW D COPY(DA) S DR="1///"_$$NOW^XLFDT D ^DIE W !!,"NOTE: New entries start INACTIVATED.",! ;New entries start inactivated
"RTN","OREV",111,0)
 .I 'NEW S TYPE=$P(@(ORGLOB_DA_",0)"),U,2)
"RTN","OREV",112,0)
 .I ORTYPE="E" I $$RELEVNTS^OREV1(DA) W !!,$C(7),"** This event has delayed orders associated with it! **",!,"Editing will affect these delayed events.",!
"RTN","OREV",113,0)
 .I ORTYPE="A" W !!,"Editing auto-dc rules takes effect immediately.",!
"RTN","OREV",114,0)
 .S DR="[OREV "_$S(ORTYPE="E"&($P($G(^ORD(100.5,DA,0)),U,12)):"CHILD EVENT",ORTYPE="E":"EVENT",1:"AUTO DC") D ^DIE
"RTN","OREV",115,0)
 .I $G(DA) I 'NEW I $G(TYPE)'=$P(@(ORGLOB_DA_",0)"),U,2) D CHKTYP^OREV1(DA) ;If new event and type changed then check event type for extraneous entries
"RTN","OREV",116,0)
 .I $G(DA) I 'NEW I TYPE="T",ORTYPE="A",'$D(^ORD(100.6,DA,3,"B",4)) D DELMUL^OREV1(100.6,DA,5),DELMUL^OREV1(100.6,DA,6) ;If not new entry and type is transfer and MAS MOVEMENT TYPE is not interward transfer then delete locations and divisions
"RTN","OREV",117,0)
 .I $G(DA) D AUDIT(DA,$S($G(NEW):"N",1:"E")) ;If entry not deleted add to audit history
"RTN","OREV",118,0)
 .I $G(DA) L -@(ORGLOB_DA_")")
"RTN","OREV",119,0)
 ;
"RTN","OREV",120,0)
 F ORJ=1:1:$L(ORNMBR,",")-1 S ORTMP=$P(ORNMBR,",",ORJ),DA=$O(^TMP("OREDO",$J,"IDX",ORTMP,0)) D
"RTN","OREV",121,0)
 .W ! W:ORJ'=1 !,"**NOW EDITING NEXT ENTRY**",!
"RTN","OREV",122,0)
 .L +@(ORGLOB_DA_")"):1 I '$T W !!,"This entry is being edited by another user." H 3 Q  ;Lock global
"RTN","OREV",123,0)
 .I ORTYPE="E" I $$RELEVNTS^OREV1(DA) W !!,$C(7),"** This event has delayed orders associated with it! **",!,"Editing will affect these delayed events.",!
"RTN","OREV",124,0)
 .I ORTYPE="A" W !!,"Editing auto-dc rules takes effect immediately.",!
"RTN","OREV",125,0)
 .S TYPE=$P(@(ORGLOB_DA_",0)"),U,2)
"RTN","OREV",126,0)
 .S DIE=DIC,DR="[OREV "_$S(ORTYPE="E"&($P($G(^ORD(100.5,DA,0)),U,12)):"CHILD EVENT",ORTYPE="E":"EVENT",1:"AUTO DC") D ^DIE
"RTN","OREV",127,0)
 .I $G(DA) I $G(TYPE)'=$P(@(ORGLOB_DA_",0)"),U,2) D CHKTYP^OREV1(DA) ;If entry not deleted check event type and add to audit history
"RTN","OREV",128,0)
 .I $G(DA) I TYPE="T",ORTYPE="A",'$D(^ORD(100.6,DA,3,"B",4)) D DELMUL^OREV1(100.6,DA,5),DELMUL^OREV1(100.6,DA,6) ;If not new entry and type is transfer and MAS MOVEMENT TYPE is not interward transfer then delete locations and divisions
"RTN","OREV",129,0)
 .I $G(DA) D AUDIT(DA,"E") ;If entry not deleted add to audit history
"RTN","OREV",130,0)
 .I $G(DA) L -@(ORGLOB_DA_")") ;Unlock global
"RTN","OREV",131,0)
 K DIE("NO^") Q
"RTN","OREV",132,0)
 ;
"RTN","OREV",133,0)
DESELECT ;Un-highlight selected choices
"RTN","OREV",134,0)
 N ORJ,ORTMP
"RTN","OREV",135,0)
 F ORJ=1:1:$L($G(ORNMBR),",")-1 S ORTMP=$P(ORNMBR,",",ORJ) D CNTRL^VALM10(ORTMP,1,+$G(VALMWD),IORVOFF,IORVOFF)
"RTN","OREV",136,0)
 K ORNMBR
"RTN","OREV",137,0)
 Q
"RTN","OREV",138,0)
 ;
"RTN","OREV",139,0)
COPY(NEWENT) ;Allow new entries to copy from existing entries
"RTN","OREV",140,0)
 N DIR,DLAYGO,DIC,DA,DIK,DIE,NAME,DIVISN,DR,Y
"RTN","OREV",141,0)
 S DIR(0)="Y",DIR("A")="Do you want to copy from an existing entry",DIR("B")="NO",DIR("?")="Enter Yes to copy an existing entry to this one" D ^DIR Q:Y'=1
"RTN","OREV",142,0)
 S DIC(0)="AEMQ",DIC=ORGLOB,DIC("S")="I Y'=NEWENT,$P(@(ORGLOB_+Y_"",0)""),U,2)=$P(@(ORGLOB_NEWENT_"",0)""),U,2)" D ^DIC Q:Y=-1  ;Quit if no selection made
"RTN","OREV",143,0)
 W !,"Copying..."
"RTN","OREV",144,0)
 S NAME=$P(@(ORGLOB_NEWENT_",0)"),U) ;get name of new entry
"RTN","OREV",145,0)
 S DIVISN=$P(@(ORGLOB_NEWENT_",0)"),U,3) ;get division of new entry
"RTN","OREV",146,0)
 M @(ORGLOB_NEWENT_")")=@(ORGLOB_+Y_")")
"RTN","OREV",147,0)
 K @(ORGLOB_NEWENT_",2)") ;Delete activation history that was copied
"RTN","OREV",148,0)
 K @(ORGLOB_NEWENT_",9)") ;Delete audit history that was copied.
"RTN","OREV",149,0)
 S DIK=DIC,DA=+Y D IX1^DIK ;set all xrefs for new entry
"RTN","OREV",150,0)
 S DIE=ORGLOB,DA=NEWENT,DR=".01///"_NAME_";3///"_DIVISN D ^DIE ;reset name and division of new entry
"RTN","OREV",151,0)
 Q
"RTN","OREV",152,0)
 ;
"RTN","OREV",153,0)
AUDIT(ENTRY,TYPE) ;Adds audit history for entry
"RTN","OREV",154,0)
 N DIC,DA,DIE,X,Y,DR
"RTN","OREV",155,0)
 S DA(1)=ENTRY,DIC(0)="L",X=$$NOW^XLFDT,DIC=ORGLOB_DA(1)_",9,"
"RTN","OREV",156,0)
 D ^DIC Q:Y=-1  ;Stop processing if entry not added
"RTN","OREV",157,0)
 S DIE=DIC K DIC
"RTN","OREV",158,0)
 S DA=+Y
"RTN","OREV",159,0)
 S DR="1///"_$S($G(DUZ):"`"_DUZ,1:"")_";2///"_TYPE D ^DIE
"RTN","OREV",160,0)
 Q
"RTN","OREV",161,0)
 ;
"RTN","OREV1")
0^91^B80113784
"RTN","OREV1",1,0)
OREV1 ;DAN/SLC Event delayed orders set up continued ;10/28/02  13:49
"RTN","OREV1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**142,141**;Dec 17, 1997
"RTN","OREV1",3,0)
 ;DBIA reference section
"RTN","OREV1",4,0)
 ;2686 - ^XTV(8989.5 and ^XTV(8989.51
"RTN","OREV1",5,0)
 ;519  - ^DIC(45.7
"RTN","OREV1",6,0)
 ;2263  - XPAR
"RTN","OREV1",7,0)
 ;10039- ^DIC(42
"RTN","OREV1",8,0)
 ;10009- DICN
"RTN","OREV1",9,0)
 ;10018- DIE
"RTN","OREV1",10,0)
 ;10026- DIR
"RTN","OREV1",11,0)
 ;10116- VALM1
"RTN","OREV1",12,0)
 ;10103- XLFDT
"RTN","OREV1",13,0)
SCR ;Sets DIC("S") for MAS MOVEMENT TYPE field of either file
"RTN","OREV1",14,0)
 N FILE
"RTN","OREV1",15,0)
 S FILE="^ORD("_$O(DR(1,0))_","
"RTN","OREV1",16,0)
 S DIC("S")="S TMP=$P("_FILE_"DA,0),U,2),TTP=$E($P(^DG(405.3,$P(^DG(405.2,Y,0),U,2),0),U)) I $S(TMP=TTP:1,1:0)"_$S('$G(@(FILE_DA_",1)")):"&('$$INUSEDC^OREV1())",1:"")
"RTN","OREV1",17,0)
 Q
"RTN","OREV1",18,0)
 ;
"RTN","OREV1",19,0)
ACT ;Inactivate or reactivate an event or auto dc rule
"RTN","OREV1",20,0)
 N ORJ,Y,ORTMP,DA,DIC,ORGLOB
"RTN","OREV1",21,0)
 S VALMBCK="R" D FULL^VALM1
"RTN","OREV1",22,0)
 S ORGLOB="^ORD(100."_$S(ORTYPE="E":"5,",1:"6,")
"RTN","OREV1",23,0)
 I $G(ORNMBR)="" S ORNMBR=$$ORDERS("activate/inactivate")
"RTN","OREV1",24,0)
 F ORJ=1:1:$L(ORNMBR,",")-1 S ORTMP=$P(ORNMBR,",",ORJ),DA=$O(^TMP("OREDO",$J,"IDX",ORTMP,0)) D FLIP(DA)
"RTN","OREV1",25,0)
 Q
"RTN","OREV1",26,0)
 ;
"RTN","OREV1",27,0)
FLIP(DA) ;Check status and flip if necessary
"RTN","OREV1",28,0)
 N STAT,DIR,DIE,DR,Y,NAME,CDT,MULT,IEN,SUB,USED,EVNTYPE
"RTN","OREV1",29,0)
 S NAME=$P(@(ORGLOB_DA_",0)"),U),EVNTYPE=$P(^(0),U,2)
"RTN","OREV1",30,0)
 S CDT=$$NOW^XLFDT
"RTN","OREV1",31,0)
 S STAT=$S($G(@(ORGLOB_DA_",1)")):^(1),1:0) ;Status is date/time if already inactivated
"RTN","OREV1",32,0)
 W !!,NAME," is currently ",$S(STAT:"IN",1:"")_"ACTIVE."
"RTN","OREV1",33,0)
 I ORTYPE="E",$$RELEVNTS(DA),'STAT W !!,"There are delayed orders awaiting release that are associated with this event.",!,"This event, even if inactivated, will still be applied to these delayed orders.",!!
"RTN","OREV1",34,0)
 I ORTYPE="A",'STAT W !!,"Inactivating auto-dc rules takes effect immediately.",!
"RTN","OREV1",35,0)
 I STAT,$G(EVNTYPE)="O",$$ACTSURG^OREV4(ORTYPE,DA) D  Q
"RTN","OREV1",36,0)
 .W !,NAME,!,"can not be activated because you already have an active surgery rule for this",!,"division.  Only one active surgery rule per division is allowed.",!
"RTN","OREV1",37,0)
 .S DIR(0)="E",DIR("A")="Press enter to continue" D ^DIR K DIR
"RTN","OREV1",38,0)
 I STAT,ORTYPE="E",$P($G(^ORD(100.5,DA,0)),U,12),$G(^ORD(100.5,$P(^(0),U,12),1)) D  Q  ;If inactive child event and parent is inactive don't activate child
"RTN","OREV1",39,0)
 .W !,NAME,!,"can not be activated until its parent event is active.",!
"RTN","OREV1",40,0)
 .S DIR(0)="E",DIR("A")="Press enter to continue" D ^DIR K DIR
"RTN","OREV1",41,0)
 I STAT,ORTYPE="E",'$$CANACT(DA,.USED) D  Q
"RTN","OREV1",42,0)
 .W !,NAME,!,"can not be activated because the following locations",!,"and/or treating specialties are currently in use by other entries.",!
"RTN","OREV1",43,0)
 .F MULT="LOC","TS" W:$D(USED(MULT)) !,$S(MULT="LOC":"LOCATIONS:",1:"TREATING SPECIALTIES:"),! D
"RTN","OREV1",44,0)
 ..S IEN=0 F  S IEN=$O(USED(MULT,IEN)) Q:'+IEN  D
"RTN","OREV1",45,0)
 ...S SUB=0 F  S SUB=$O(USED(MULT,IEN,SUB)) Q:'+SUB  D
"RTN","OREV1",46,0)
 ....W !,$S(MULT="LOC":$P($G(^DIC(42,SUB,0)),"^"),1:$P($G(^DIC(45.7,SUB,0)),"^"))," is in use by ",$P($G(@(ORGLOB_IEN_",0)")),"^"),!
"RTN","OREV1",47,0)
 .W !,"For active entries, LOCATIONS and TREATING SPECIALTIES",!,"must be unique within division and event type."
"RTN","OREV1",48,0)
 .S DIR(0)="E",DIR("A")="Press enter to continue" D ^DIR K DIR
"RTN","OREV1",49,0)
 I STAT I ORTYPE="A" I '$$CANACT(DA,.USED) D  Q
"RTN","OREV1",50,0)
 .W !,NAME,!,"can not be activated because the following MAS movements",!,"are currently in use by other entries.",!
"RTN","OREV1",51,0)
 .S IEN=0 F  S IEN=$O(USED(IEN)) Q:'+IEN  D
"RTN","OREV1",52,0)
 ..S SUB=0 F  S SUB=$O(USED(IEN,SUB)) Q:'+SUB  D
"RTN","OREV1",53,0)
 ...W !,$P($G(^DG(405.2,IEN,0)),U)," is in use by ",$P($G(^ORD(100.6,SUB,0)),U)
"RTN","OREV1",54,0)
 .W !,"For active entries, MAS movements within DIVISION must be unique."
"RTN","OREV1",55,0)
 .S DIR(0)="E",DIR("A")="Press return to continue" D ^DIR K DIR
"RTN","OREV1",56,0)
 ;
"RTN","OREV1",57,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Are you sure you want to "_$S(STAT:"",1:"IN")_"ACTIVATE this entry" D ^DIR
"RTN","OREV1",58,0)
 I Y'=1 W !,"Nothing changed!" Q
"RTN","OREV1",59,0)
 S DIE=ORGLOB,DR="1///"_$S(STAT:"@",1:CDT) D ^DIE W !,NAME," is now "_$S(STAT:"",1:"IN")_"ACTIVATED!"
"RTN","OREV1",60,0)
 I 'STAT S DA(1)=DA,DA=$O(@(ORGLOB_DA(1)_",2,"_"""ACT"""_",0)")),DIE=ORGLOB_DA(1)_",2,",DR="1///"_CDT D ^DIE D:ORTYPE="E" UPDTCHLD^OREV3(DA(1),CDT) Q
"RTN","OREV1",61,0)
 D SET(DA,CDT)
"RTN","OREV1",62,0)
 Q
"RTN","OREV1",63,0)
 ;
"RTN","OREV1",64,0)
SET(MIEN,X) ;add new multiple to activation history
"RTN","OREV1",65,0)
 N DIC,DA
"RTN","OREV1",66,0)
 S DA(1)=MIEN
"RTN","OREV1",67,0)
 S DIC=ORGLOB_DA(1)_",2,",DIC(0)="L"
"RTN","OREV1",68,0)
 D FILE^DICN
"RTN","OREV1",69,0)
 Q
"RTN","OREV1",70,0)
 ;
"RTN","OREV1",71,0)
INUSE(MULT) ;determine if location or treating specialty is already in use
"RTN","OREV1",72,0)
 N ACTIVE,USED,NAME,TYPE,DIV
"RTN","OREV1",73,0)
 S USED=0,NAME=""
"RTN","OREV1",74,0)
 S TYPE=$P($G(^ORD(100.5,DA,0)),"^",2) ;movement type of entry being checked
"RTN","OREV1",75,0)
 S DIV=$P($G(^ORD(100.5,DA,0)),"^",3) ;division of entry being checked
"RTN","OREV1",76,0)
 F  S NAME=$O(^ORD(100.5,"C",NAME)) Q:NAME=""!(USED)  D
"RTN","OREV1",77,0)
 .S ACTIVE=0 F  S ACTIVE=$O(^ORD(100.5,"C",NAME,ACTIVE)) Q:'+ACTIVE!USED  D
"RTN","OREV1",78,0)
 ..Q:DIV'=$P($G(^ORD(100.5,ACTIVE,0)),"^",3)  ;stop processing if not same division
"RTN","OREV1",79,0)
 ..Q:TYPE'=$P($G(^ORD(100.5,ACTIVE,0)),"^",2)  ;stop processing if not the same type
"RTN","OREV1",80,0)
 ..S USED=$D(^ORD(100.5,ACTIVE,MULT,"B",Y)) I USED S WHO=ACTIVE
"RTN","OREV1",81,0)
 Q USED
"RTN","OREV1",82,0)
 ;
"RTN","OREV1",83,0)
CANACT(DA,USED) ;Function returns whether or not an entry can be activated.
"RTN","OREV1",84,0)
 ;For EVENTS, locations and specialties must be unique within division
"RTN","OREV1",85,0)
 ;and EVENT TYPE.  For AUTO DC, movement types must be unique within
"RTN","OREV1",86,0)
 ;division.
"RTN","OREV1",87,0)
 N MULT,SUB,Y,CANACT,WHO
"RTN","OREV1",88,0)
 S CANACT=1
"RTN","OREV1",89,0)
 I ORTYPE="E" F MULT="LOC","TS" D
"RTN","OREV1",90,0)
 .S SUB=0 F  S SUB=$O(^ORD(100.5,DA,MULT,SUB)) Q:'+SUB  D
"RTN","OREV1",91,0)
 ..S Y=$G(^(SUB,0)) I Y I $$INUSE(MULT) S CANACT=0,USED(MULT,WHO,Y)=""
"RTN","OREV1",92,0)
 ;
"RTN","OREV1",93,0)
 I ORTYPE="A" D
"RTN","OREV1",94,0)
 .S SUB=0 F  S SUB=$O(^ORD(100.6,DA,3,SUB)) Q:'+SUB  D
"RTN","OREV1",95,0)
 ..S Y=+$G(^(SUB,0)) I Y I $$INUSEDC() S CANACT=0,USED(Y,WHO)=""
"RTN","OREV1",96,0)
 Q CANACT
"RTN","OREV1",97,0)
 ;
"RTN","OREV1",98,0)
INUSEDC() ;Checks AUTO-DC rules for unique movement types
"RTN","OREV1",99,0)
 N DIV,USED
"RTN","OREV1",100,0)
 S USED=0
"RTN","OREV1",101,0)
 S DIV=+$P($G(^ORD(100.6,DA,0)),U,3)
"RTN","OREV1",102,0)
 I DIV I $D(^ORD(100.6,"AC",DIV,Y)) S WHO=$O(^(Y,0)),USED=1
"RTN","OREV1",103,0)
 Q USED
"RTN","OREV1",104,0)
 ;
"RTN","OREV1",105,0)
HASREQD() ;Function returns whether entry has required entries or not
"RTN","OREV1",106,0)
 N REQD
"RTN","OREV1",107,0)
 S REQD=0
"RTN","OREV1",108,0)
 I ORTYPE="E" D
"RTN","OREV1",109,0)
 .I "^22^23^24^"[("^"_$P($G(^ORD(100.5,DA,0)),U,7)_"^") S REQD=1 Q  ;From pass (transfer) doesn't require treating specialty
"RTN","OREV1",110,0)
 .I $O(^ORD(100.5,DA,"LOC",0))>0!($O(^ORD(100.5,DA,"TS",0))>0) S REQD=1 ;Has locations or treating specialties
"RTN","OREV1",111,0)
 .I $O(^ORD(100.5,DA,"LOC",0))>0&($O(^ORD(100.5,DA,"TS",0))>0) S REQD=2 ;Warn user that both must be true if both defined.
"RTN","OREV1",112,0)
 I ORTYPE="A" D
"RTN","OREV1",113,0)
 .I $P($G(^ORD(100.6,DA,0)),U,2)="O" S REQD=1 ;If type is operating room then movements not required
"RTN","OREV1",114,0)
 .I $P($G(^ORD(100.6,DA,0)),U,2)'="O"&($O(^ORD(100.6,DA,3,0))>0) S REQD=1 ;movement type exists
"RTN","OREV1",115,0)
 .I $P($G(^ORD(100.6,DA,0)),U,2)="T",$D(^ORD(100.6,DA,3,"B",4)),$P($G(^ORD(100.6,DA,3,0)),U,4)>1 S REQD=2 ;If transfer type and interward transfer type not by itself
"RTN","OREV1",116,0)
 Q REQD
"RTN","OREV1",117,0)
 ;
"RTN","OREV1",118,0)
CHKTYP(IEN) ;Check type of event and delete fields that are no longer needed based on the event type
"RTN","OREV1",119,0)
 N J,DR,DIE,DA,DIC,TYPE
"RTN","OREV1",120,0)
 I ORTYPE="E" D  Q
"RTN","OREV1",121,0)
 .S TYPE=$P(^ORD(100.5,IEN,0),U,2)
"RTN","OREV1",122,0)
 .I TYPE'="A"&(TYPE'="T") D DELMUL(100.5,IEN,"""LOC"""),DELMUL(100.5,IEN,"""TS""") ;if not admit or transfer delete locations and treating specialties
"RTN","OREV1",123,0)
 .S DA=IEN,DIE=100.5,DR="7///@" D ^DIE ;Delete MAS MOVEMENT when type changes as movement types are associated with event type
"RTN","OREV1",124,0)
 ;If not event type must be auto-dc
"RTN","OREV1",125,0)
 S TYPE=$P(^ORD(100.6,IEN,0),U,2)
"RTN","OREV1",126,0)
 I TYPE'="D" S DA=IEN,DIE=100.6,DR="6///@" D ^DIE ;Delete 'except from observation" if not discharge type
"RTN","OREV1",127,0)
 D DELMUL(100.6,IEN,3) ;delete MAS MOVEMENT
"RTN","OREV1",128,0)
 I TYPE'="S" D DELMUL(100.6,IEN,4) ;If not specialty type delete excluded treating specialties
"RTN","OREV1",129,0)
 I TYPE'="T" D DELMUL(100.6,IEN,5),DELMUL(100.6,IEN,6) ;If not transfer type delete included locations and included divisions
"RTN","OREV1",130,0)
 Q
"RTN","OREV1",131,0)
 ;
"RTN","OREV1",132,0)
ORDERS(ACTION) ; -- Return order numbers to act on, if action chosen first
"RTN","OREV1",133,0)
 N X,Y,DIR,MAX
"RTN","OREV1",134,0)
 S MAX=$G(VALMCNT) Q:MAX'>0 ""
"RTN","OREV1",135,0)
 I ACTION="edit" W !!,"Enter item number to edit or press enter to create a new entry"
"RTN","OREV1",136,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select item(s): "
"RTN","OREV1",137,0)
 S DIR("?")="Enter the items you wish to "_ACTION_", as a range or list of numbers."_$S(ACTION="edit":" Press enter to create a NEW entry",1:"")
"RTN","OREV1",138,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","OREV1",139,0)
 I $D(Y(1)) W !,">>>Too many entries selected, try using smaller ranges" H 2 S Y="^"
"RTN","OREV1",140,0)
 Q Y
"RTN","OREV1",141,0)
 ;
"RTN","OREV1",142,0)
 ;
"RTN","OREV1",143,0)
CANDEL(FILE) ;Determines if event or rule can be deleted
"RTN","OREV1",144,0)
 N DEL,EVENT,LIST,I,J
"RTN","OREV1",145,0)
 S DEL=1
"RTN","OREV1",146,0)
 S EVENT=$O(^XTV(8989.51,"B","ORWDX WRITE ORDERS EVENT LIST",0))
"RTN","OREV1",147,0)
 S LIST=$O(^XTV(8989.51,"B","OREVNT COMMON LIST",0))
"RTN","OREV1",148,0)
 I FILE=100.5 D
"RTN","OREV1",149,0)
 .I $O(^ORE(100.2,"E",DA,0)) W !,"< Can't delete this event because file 100.2 is pointing to it >  " S DEL=0 Q
"RTN","OREV1",150,0)
 .I $D(^ORD(100.5,"DAD",DA)) W !,"< Can't delete parent events that have children >  " S DEL=0 Q
"RTN","OREV1",151,0)
 .S FND=0
"RTN","OREV1",152,0)
 .K LST D ENVAL^XPAR(.LST,LIST)
"RTN","OREV1",153,0)
 .S I="" F  S I=$O(LST(I)) Q:I=""!(FND)  D
"RTN","OREV1",154,0)
 ..S J="" F  S J=$O(LST(I,J)) Q:J=""!(FND)  I LST(I,J)=DA S FND=1
"RTN","OREV1",155,0)
 .I 'FND K LST D ENVAL^XPAR(.LST,EVENT) D
"RTN","OREV1",156,0)
 ..S I="" F  S I=$O(LST(I)) Q:I=""!(FND)  D
"RTN","OREV1",157,0)
 ...S J="" F  S J=$O(LST(I,J)) Q:J=""!(FND)  I DA=J S FND=1
"RTN","OREV1",158,0)
 .I FND W !,"< Can't delete event because parameters are pointing to it >  " S DEL=0
"RTN","OREV1",159,0)
 ;
"RTN","OREV1",160,0)
 I FILE=100.6 D
"RTN","OREV1",161,0)
 .I $O(^ORE(100.2,"DC",DA,0)) S DEL=0 W !,"< Can't delete this rule because file 100.2 is pointing to it >  " Q
"RTN","OREV1",162,0)
 ;
"RTN","OREV1",163,0)
 Q 'DEL  ;Reverse value of DEL so that $T is set correctly for fileman to determine if entry can be deleted.  Code is in ^DD(file#,.01,"DEL",.01,0)
"RTN","OREV1",164,0)
 ;
"RTN","OREV1",165,0)
ASKOBS() ;Function to determine if 'except from observation' field should be asked.
"RTN","OREV1",166,0)
 N ANS
"RTN","OREV1",167,0)
 S ANS=1
"RTN","OREV1",168,0)
 I ETYPE="D" I $D(^ORD(100.6,DA,3,"B",12))!($D(^ORD(100.6,DA,3,"B",38))) S ANS=0 ;Don't ask if MAS MOVEMENT TYPE is 12 (death) or 38 (death with autopsy)
"RTN","OREV1",169,0)
 I ETYPE="T" I '$D(^ORD(100.6,DA,3,"B",14)) S ANS=0 ;If MAS MOVEMENT TYPE doesn't contain FROM ASIH (VAH) when type is transfer then don't ask
"RTN","OREV1",170,0)
 Q ANS
"RTN","OREV1",171,0)
 ;
"RTN","OREV1",172,0)
DELMUL(FILE,IEN,LOC) ;Delete multiple entries for entry IEN in file FILE stored at location LOC
"RTN","OREV1",173,0)
 N I,DR,DIE,DA,DIC,GLOB,Y,DQ,DP,DL,DM,DI,DK
"RTN","OREV1",174,0)
 S GLOB="^ORD("_FILE_","_IEN_","
"RTN","OREV1",175,0)
 S I=0 F  S I=$O(@(GLOB_LOC_","_I_")")) Q:'+I  S DA(1)=IEN,DA=I,DR=".01///@",DIE="^ORD("_FILE_",DA(1),"_LOC_"," D ^DIE
"RTN","OREV1",176,0)
 Q
"RTN","OREV1",177,0)
 ;
"RTN","OREV1",178,0)
RELEVNTS(DA) ;Check to see if release event is currently being pointed to
"RTN","OREV1",179,0)
 N DFN,EVENT
"RTN","OREV1",180,0)
 S (DFN,EVENT)=0
"RTN","OREV1",181,0)
 F  S DFN=$O(^ORE(100.2,"AE",DFN)) Q:'+DFN  I $D(^ORE(100.2,"AE",DFN,DA)) S EVENT=1 Q
"RTN","OREV1",182,0)
 Q EVENT
"RTN","OREV2")
0^81^B75420310
"RTN","OREV2",1,0)
OREV2 ;SLC/DAN Event delayed orders set up ;10/28/02  14:00
"RTN","OREV2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**142,141**;Dec 17, 1997
"RTN","OREV2",3,0)
 ;DBIA reference section
"RTN","OREV2",4,0)
 ;10060- ^VA(200
"RTN","OREV2",5,0)
 ;2336 - XPAREDIT
"RTN","OREV2",6,0)
 ;10026- DIR
"RTN","OREV2",7,0)
 ;10116- VALM1
"RTN","OREV2",8,0)
 ;2052 - DID
"RTN","OREV2",9,0)
 ;10015- DIQ
"RTN","OREV2",10,0)
 ;10117- VALM10
"RTN","OREV2",11,0)
 ;10103- XLFDT
"RTN","OREV2",12,0)
 ;10104- XLFSTR
"RTN","OREV2",13,0)
DET ;Detailed display 
"RTN","OREV2",14,0)
 N DIC,Y,ORJ,ORTMP,DA,CNT
"RTN","OREV2",15,0)
 S CNT=1,VALMBCK="R" K ^UTILITY("DIQ1",$J),^TMP("ORCXPND",$J),^TMP("VALM VIDEO",$J)
"RTN","OREV2",16,0)
 I $G(ORNMBR)="" S ORNMBR=$$ORDERS^OREV1("display")
"RTN","OREV2",17,0)
 F ORJ=1:1:$L(ORNMBR,",")-1 S ORTMP=$P(ORNMBR,",",ORJ),DA=$O(^TMP("OREDO",$J,"IDX",ORTMP,0)) D
"RTN","OREV2",18,0)
 .I ORJ'=1 S ^TMP("ORCXPND",$J,CNT,0)=$$REPEAT^XLFSTR("*",79),CNT=CNT+1 S ^TMP("ORCXPND",$J,CNT,0)="   ",CNT=CNT+1
"RTN","OREV2",19,0)
 .D SETG(DA)
"RTN","OREV2",20,0)
 S VALMCNT=CNT-1 S:VALMCNT=0 VALMBCK="Q" S:ORNMBR="^" VALMQUIT="Q"
"RTN","OREV2",21,0)
 Q
"RTN","OREV2",22,0)
 ;
"RTN","OREV2",23,0)
SETG(IEN) ;Set details into global
"RTN","OREV2",24,0)
 N DIC,DA,ORI,DR,GLOB,NAME,I,HASPRNT,ETYPE,PIECE
"RTN","OREV2",25,0)
 K ^UTILITY("DIQ1",$J)
"RTN","OREV2",26,0)
 S (DIC,GLOB)=$S(ORTYPE="E":100.5,1:100.6)
"RTN","OREV2",27,0)
 S DA=IEN
"RTN","OREV2",28,0)
 I '$D(@("^ORD("_GLOB_","_DA_",0)")) Q
"RTN","OREV2",29,0)
 I ORTYPE="E" D
"RTN","OREV2",30,0)
 .S HASPRNT=+$P($G(^ORD(100.5,IEN,0)),U,12)
"RTN","OREV2",31,0)
 .S ETYPE=$P(^ORD(100.5,$S(HASPRNT:HASPRNT,1:IEN),0),U,2)
"RTN","OREV2",32,0)
 .I HASPRNT D  Q
"RTN","OREV2",33,0)
 ..S ^TMP("ORCXPND",$J,CNT,0)="This is a CHILD entry. (p) indicates value is from its parent entry.",CNT=CNT+1,^TMP("ORCXPND",$J,CNT,0)="",CNT=CNT+1
"RTN","OREV2",34,0)
 ..S DR=".01;.1;1;5;8;9;13;14"
"RTN","OREV2",35,0)
 ..D EN^DIQ1
"RTN","OREV2",36,0)
 ..S DA=HASPRNT ;Get parent information to display with child
"RTN","OREV2",37,0)
 ..S DR="2;3;4;6"_$S("^A^D^T^"[("^"_ETYPE_"^"):";7",1:"")
"RTN","OREV2",38,0)
 ..D EN^DIQ1
"RTN","OREV2",39,0)
 ..S PIECE="" F I=1:1:$L(DR,";") S PIECE=$P(DR,";",I) S ^UTILITY("DIQ1",$J,GLOB,IEN,PIECE)=^UTILITY("DIQ1",$J,GLOB,DA,PIECE)
"RTN","OREV2",40,0)
 ..S DA=IEN ;Reset DA to child IEN
"RTN","OREV2",41,0)
 .;
"RTN","OREV2",42,0)
 .S DR=".01:6"_$S("^A^T^D^"[("^"_ETYPE_"^"):";7:9",1:";8:9")_";13"
"RTN","OREV2",43,0)
 .D EN^DIQ1
"RTN","OREV2",44,0)
 I ORTYPE="A" D
"RTN","OREV2",45,0)
 .S ETYPE=$P(^ORD(100.6,DA,0),U,2)
"RTN","OREV2",46,0)
 .S DR=".01:"_$S("^D^T^"[("^"_$P(^ORD(100.6,IEN,0),U,2)_"^")&($$ASKOBS^OREV1):"6",1:"5")
"RTN","OREV2",47,0)
 .D EN^DIQ1
"RTN","OREV2",48,0)
 S ORI=0 F  S ORI=$O(^UTILITY("DIQ1",$J,GLOB,DA,ORI)) Q:ORI=""  D
"RTN","OREV2",49,0)
 .S NAME=$$GET1^DID(GLOB,ORI,,"LABEL")
"RTN","OREV2",50,0)
 .I NAME="DIVISION" S NAME=$S(ETYPE="A":"ADMIT TO",ETYPE="D":"DISCHARGE FROM",ETYPE="T":"TRANS TO/WITHIN",ETYPE="O":"SURGERY WITHIN",ETYPE="S":"TR SP CHANGE WITHIN",1:"MAN. REL. WITHIN")_" "_NAME
"RTN","OREV2",51,0)
 .S:$G(HASPRNT)&("^2^3^4^6^7^"[("^"_ORI_"^")) NAME=NAME_" (P)"
"RTN","OREV2",52,0)
 .S NAME=NAME_":"
"RTN","OREV2",53,0)
 .S ^TMP("ORCXPND",$J,CNT,0)=$$LJ^XLFSTR($E(NAME)_$$LOW^XLFSTR($E(NAME,2,$L(NAME))),30)_$G(^UTILITY("DIQ1",$J,GLOB,IEN,ORI)),CNT=CNT+1
"RTN","OREV2",54,0)
 I ORTYPE="E",$D(^ORD(100.5,"DAD",DA)) D GETCHILD ;If parent then show children
"RTN","OREV2",55,0)
 D GETMULT($S($G(HASPRNT):HASPRNT,1:IEN))
"RTN","OREV2",56,0)
 I $G(^TMP("ORHIST",$J,DUZ)) D GETHIST(ORTYPE),GETAHIST(ORTYPE)
"RTN","OREV2",57,0)
 K ^UTILITY("DIQ1",$J)
"RTN","OREV2",58,0)
 Q
"RTN","OREV2",59,0)
 ;
"RTN","OREV2",60,0)
GETMULT(IEN) ;Retrieve values from multiples
"RTN","OREV2",61,0)
 N ORK,I,J,DCNT,GLOB,LOC0,ORI,SUB
"RTN","OREV2",62,0)
 ;Multiples for release event file
"RTN","OREV2",63,0)
 I ORTYPE="E" D  Q
"RTN","OREV2",64,0)
 .F ORK="LOC","TS" D
"RTN","OREV2",65,0)
 ..S GLOB=$S(ORK="LOC":"^DIC(42,",1:"^DIC(45.7,")
"RTN","OREV2",66,0)
 ..I $O(^ORD(100.5,IEN,ORK,0))>0 D
"RTN","OREV2",67,0)
 ...S ^TMP("ORCXPND",$J,CNT,0)="   ",CNT=CNT+1
"RTN","OREV2",68,0)
 ...S ^TMP("ORCXPND",$J,CNT,0)=$S(ORK="LOC":"Included Locations",1:"Included Treating Specialties")_$S($G(HASPRNT):" (p)",1:"")_":"
"RTN","OREV2",69,0)
 ...D:$D(IOUON)&($D(IOUOFF)) CNTRL^VALM10(CNT,1,$L(^(0)),IOUON,IOUOFF)
"RTN","OREV2",70,0)
 ...S CNT=CNT+1
"RTN","OREV2",71,0)
 ...S ORI=0 F  S ORI=$O(^ORD(100.5,IEN,ORK,ORI)) Q:'+ORI  D
"RTN","OREV2",72,0)
 ....S DEF=$P(^ORD(100.5,IEN,ORK,ORI,0),"^",2) ;Is this the default?
"RTN","OREV2",73,0)
 ....S ^TMP("ORCXPND",$J,CNT,0)=$P($G(@(GLOB_+$P(^ORD(100.5,IEN,ORK,ORI,0),"^")_",0)")),"^")_$S(DEF:" (Default)",1:""),CNT=CNT+1
"RTN","OREV2",74,0)
 ;Multiples for auto-dc file
"RTN","OREV2",75,0)
 ;Get movements, divisions, packages, display groups, and orderable items
"RTN","OREV2",76,0)
 F SUB=3,6,7,10,8 D
"RTN","OREV2",77,0)
 .I $O(^ORD(100.6,IEN,SUB,0))>0 D
"RTN","OREV2",78,0)
 ..S ^TMP("ORCXPND",$J,CNT,0)=" ",CNT=CNT+1
"RTN","OREV2",79,0)
 ..S ^TMP("ORCXPND",$J,CNT,0)=$S(SUB=3:"Movement Types:",SUB=6:"From Divisions:",SUB=7:"Included Packages:",SUB=10:"Excluded Display Groups:",1:"Excluded Orderable Items:")
"RTN","OREV2",80,0)
 ..D:$D(IOUON)&($D(IOUOFF)) CNTRL^VALM10(CNT,1,$L(^(0)),IOUON,IOUOFF)
"RTN","OREV2",81,0)
 ..S CNT=CNT+1
"RTN","OREV2",82,0)
 ..S GLOB=$S(SUB=3:"^DG(405.2,",SUB=6:"^DIC(4,",SUB=7:"^DIC(9.4,",SUB=10:"^ORD(100.98,",1:"^ORD(101.43,")
"RTN","OREV2",83,0)
 ..S I=0 F  S I=$O(^ORD(100.6,IEN,SUB,I)) Q:'+I  D
"RTN","OREV2",84,0)
 ...S ^TMP("ORCXPND",$J,CNT,0)=$P($G(@(GLOB_+$P(^ORD(100.6,IEN,SUB,I,0),U)_",0)")),U)
"RTN","OREV2",85,0)
 ...I SUB=8,$G(@(GLOB_+$P(^ORD(100.6,IEN,SUB,I,0),U)_",.1)")) S ^TMP("ORCXPND",$J,CNT,0)=^TMP("ORCXPND",$J,CNT,0)_" (* INACTIVE *)"
"RTN","OREV2",86,0)
 ...S CNT=CNT+1
"RTN","OREV2",87,0)
 ;
"RTN","OREV2",88,0)
 ;Get Treating Specialties
"RTN","OREV2",89,0)
 I $O(^ORD(100.6,IEN,4,0))>0 D
"RTN","OREV2",90,0)
 .S ^TMP("ORCXPND",$J,CNT,0)=" ",CNT=CNT+1
"RTN","OREV2",91,0)
 .S ^TMP("ORCXPND",$J,CNT,0)="Excluding From Treating Specialties:    To Treating Specialties:"
"RTN","OREV2",92,0)
 .D:$D(IOUON)&($D(IOUOFF)) CNTRL^VALM10(CNT,1,$L(^(0)),IOUON,IOUOFF)
"RTN","OREV2",93,0)
 .S CNT=CNT+1
"RTN","OREV2",94,0)
 .S GLOB="^DIC(45.7,"
"RTN","OREV2",95,0)
 .S I=0 F  S I=$O(^ORD(100.6,IEN,4,I)) Q:'+I  D
"RTN","OREV2",96,0)
 ..S ^TMP("ORCXPND",$J,CNT,0)=$$LJ^XLFSTR($P($G(@(GLOB_+$P(^ORD(100.6,IEN,4,I,0),U)_",0)")),U),40)
"RTN","OREV2",97,0)
 ..S DCNT=0
"RTN","OREV2",98,0)
 ..S J=0 F  S J=$O(^ORD(100.6,IEN,4,I,1,J)) Q:'+J  D
"RTN","OREV2",99,0)
 ...S:DCNT'=0 CNT=CNT+1
"RTN","OREV2",100,0)
 ...S ^TMP("ORCXPND",$J,CNT,0)=$S(DCNT=0:^TMP("ORCXPND",$J,CNT,0),1:$$REPEAT^XLFSTR(" ",40))_$P($G(@(GLOB_+$P(^ORD(100.6,IEN,4,I,1,J,0),U)_",0)")),U)
"RTN","OREV2",101,0)
 ...S DCNT=1
"RTN","OREV2",102,0)
 ..S CNT=CNT+1
"RTN","OREV2",103,0)
 ;Locations
"RTN","OREV2",104,0)
 I $O(^ORD(100.6,IEN,5,0)) D
"RTN","OREV2",105,0)
 .S ^TMP("ORCXPND",$J,CNT,0)=" ",CNT=CNT+1
"RTN","OREV2",106,0)
 .S ^TMP("ORCXPND",$J,CNT,0)="Including From Locations:"_$$REPEAT^XLFSTR(" ",15)_"To Locations:"
"RTN","OREV2",107,0)
 .D:$D(IOUON)&($D(IOUOFF)) CNTRL^VALM10(CNT,1,$L(^(0)),IOUON,IOUOFF)
"RTN","OREV2",108,0)
 .S CNT=CNT+1
"RTN","OREV2",109,0)
 .S GLOB="^SC("
"RTN","OREV2",110,0)
 .S I=0 F  S I=$O(^ORD(100.6,IEN,5,I)) Q:'+I  D
"RTN","OREV2",111,0)
 ..S LOC0=^ORD(100.6,IEN,5,I,0)
"RTN","OREV2",112,0)
 ..S ^TMP("ORCXPND",$J,CNT,0)=$$LJ^XLFSTR($S($P(LOC0,U,2)=1:"* (All Locations)",1:$P($G(@(GLOB_+$P(LOC0,U,3)_",0)")),U)),40)
"RTN","OREV2",113,0)
 ..S ^TMP("ORCXPND",$J,CNT,0)=^TMP("ORCXPND",$J,CNT,0)_$S($P(LOC0,U,4)=1:"* (All Locations)",1:$P($G(@(GLOB_+$P(LOC0,U,5)_",0)")),U)),CNT=CNT+1
"RTN","OREV2",114,0)
 Q
"RTN","OREV2",115,0)
 ;
"RTN","OREV2",116,0)
GETHIST(TYPE) ;Print activation history on detailed report
"RTN","OREV2",117,0)
 N ORGLOB,I,VALUE
"RTN","OREV2",118,0)
 S ORGLOB="^ORD(100."_$S(ORTYPE="E":"5,",1:"6,")
"RTN","OREV2",119,0)
 I $D(@(ORGLOB_IEN_",2)")) S ^TMP("ORCXPND",$J,CNT,0)=" ",CNT=CNT+1,^TMP("ORCXPND",$J,CNT,0)="Activation History:" D
"RTN","OREV2",120,0)
 .D:$D(IOUON)&($D(IOUOFF)) CNTRL^VALM10(CNT,1,$L(^(0)),IOUON,IOUOFF)
"RTN","OREV2",121,0)
 .S CNT=CNT+1
"RTN","OREV2",122,0)
 S I=0 F  S I=$O(@(ORGLOB_IEN_",2,"_I_")")) Q:'+I  D
"RTN","OREV2",123,0)
 .S VALUE=$G(^(I,0)) Q:VALUE=""
"RTN","OREV2",124,0)
 .S ^TMP("ORCXPND",$J,CNT,0)="Activated: "_$$FMTE^XLFDT($P(VALUE,U),1)_"  Inactivated: "_$$FMTE^XLFDT($P(VALUE,U,2),1),CNT=CNT+1
"RTN","OREV2",125,0)
 Q
"RTN","OREV2",126,0)
 ;
"RTN","OREV2",127,0)
GETAHIST(TYPE) ;Print audit history on detailed report
"RTN","OREV2",128,0)
 N ORGLOB,ORI,VALUE,DIC,DR,DA,DIQ,NAME
"RTN","OREV2",129,0)
 S ORGLOB="^ORD(100."_$S(ORTYPE="E":"5,",1:"6,")
"RTN","OREV2",130,0)
 I $D(@(ORGLOB_IEN_",9)")) S ^TMP("ORCXPND",$J,CNT,0)=" ",CNT=CNT+1,^TMP("ORCXPND",$J,CNT,0)="Add/Edit History:" D
"RTN","OREV2",131,0)
 .D:$D(IOUON)&($D(IOUOFF)) CNTRL^VALM10(CNT,1,$L(^(0)),IOUON,IOUOFF)
"RTN","OREV2",132,0)
 .S CNT=CNT+1
"RTN","OREV2",133,0)
 S ORI=0 F  S ORI=$O(@(ORGLOB_IEN_",9,"_ORI_")")) Q:'+ORI  D
"RTN","OREV2",134,0)
 .S VALUE=$G(^(ORI,0)) Q:VALUE=""
"RTN","OREV2",135,0)
 .K NAME S DIC=200,DR=".01",DA=+$P(VALUE,U,2),DIQ="NAME",DIQ(0)="E" D EN^DIQ1
"RTN","OREV2",136,0)
 .S ^TMP("ORCXPND",$J,CNT,0)=$S($P(VALUE,U,3)="N":"Added",1:"Edited")_" on "_$$FMTE^XLFDT($P(VALUE,U),1)_" by "_$G(NAME(200,DA,.01,"E")),CNT=CNT+1
"RTN","OREV2",137,0)
 Q
"RTN","OREV2",138,0)
 ;
"RTN","OREV2",139,0)
IWT(DA) ;Function to determine if MAS MOVEMENT Interward transfer is being used by itself.  It may not be used in conjunction with other transfer types
"RTN","OREV2",140,0)
 N IWT
"RTN","OREV2",141,0)
 S IWT=0
"RTN","OREV2",142,0)
 I $P($G(^ORD(100.6,DA,0)),U,2)="T",$P($G(^ORD(100.6,DA,3,0)),U,4)=1,$D(^ORD(100.6,DA,3,"B",4)) S IWT=1
"RTN","OREV2",143,0)
 Q IWT
"RTN","OREV2",144,0)
 ;
"RTN","OREV2",145,0)
INCHIST ;Toggles audit and activation histories for inclusion on the detailed display
"RTN","OREV2",146,0)
 N INC,DIR,Y
"RTN","OREV2",147,0)
 S INC=$G(^TMP("ORHIST",$J,DUZ))
"RTN","OREV2",148,0)
 S VALMBCK="R" D FULL^VALM1
"RTN","OREV2",149,0)
 W !!,"Currently, the audit and activation histories are "_$S('INC:"not ",1:"")_"appearing",!,"on the detailed display.",!
"RTN","OREV2",150,0)
 S DIR(0)="Y",DIR("A")="Do you want to "_$S('INC:"include them on",1:"remove them from")_" the detailed display",DIR("B")="N" D ^DIR
"RTN","OREV2",151,0)
 I Y'=1 W !,"Nothing changed!" Q
"RTN","OREV2",152,0)
 W !,"Histories are now "_$S('INC:"included.",1:"removed.")
"RTN","OREV2",153,0)
 I 'INC S ^TMP("ORHIST",$J,DUZ)=1
"RTN","OREV2",154,0)
 I INC K ^TMP("ORHIST",$J,DUZ)
"RTN","OREV2",155,0)
 Q
"RTN","OREV2",156,0)
 ;
"RTN","OREV2",157,0)
FULLDSP ;Toggle between expanded and truncated display
"RTN","OREV2",158,0)
 N DSP,DIR,Y,DIRUT
"RTN","OREV2",159,0)
 S DSP=$G(^TMP("ORDSP",$J,DUZ))
"RTN","OREV2",160,0)
 W !!,"Currently, the display is "_$S('DSP:"truncated.",1:"expanded."),!
"RTN","OREV2",161,0)
 S DIR(0)="Y",DIR("A")="Do you want to "_$S(DSP:"truncate",1:"expand")_" this display",DIR("B")="N" D ^DIR K DIR
"RTN","OREV2",162,0)
 W:Y'=1 !,"Nothing changed!",! Q:$D(DIRUT)
"RTN","OREV2",163,0)
 W:Y=1 !,"List is now "_$S('DSP:"expanded.",1:"truncated."),!
"RTN","OREV2",164,0)
 I Y&('DSP) S ^TMP("ORDSP",$J,DUZ)=1
"RTN","OREV2",165,0)
 I Y&(DSP) K ^TMP("ORDSP",$J,DUZ)
"RTN","OREV2",166,0)
 S DIR(0)="Y",DIR("A")="Terminal emulator in 80 column mode",DIR("B")="Y"
"RTN","OREV2",167,0)
 S DIR("?")="Enter yes for 80 column or no for 132 column mode.  Display will be updated to relfect your answer."
"RTN","OREV2",168,0)
 D ^DIR Q:$D(DIRUT)
"RTN","OREV2",169,0)
 S VALMWD=$S(Y=1:80,1:132)
"RTN","OREV2",170,0)
 Q
"RTN","OREV2",171,0)
 ;
"RTN","OREV2",172,0)
LIST ;Change which entries appear in list
"RTN","OREV2",173,0)
 N LST,Y,DIR,DIRUT
"RTN","OREV2",174,0)
 S LST=$G(^TMP("ORLIST",$J,DUZ))
"RTN","OREV2",175,0)
 W !!,"Currently, the list includes "_$S(LST="A":"only active",LST="I":"only inactive",1:"all")_" entries."
"RTN","OREV2",176,0)
 S DIR(0)="SO^1:Active entries only;2:Inactive entries only;3:All entries",DIR("A")="Select which entries should appear on the list"
"RTN","OREV2",177,0)
 D ^DIR
"RTN","OREV2",178,0)
 Q:+Y'>0
"RTN","OREV2",179,0)
 I Y=3 K ^TMP("ORLIST",$J,DUZ) Q
"RTN","OREV2",180,0)
 S ^TMP("ORLIST",$J,DUZ)=$E(Y(0))
"RTN","OREV2",181,0)
 I LST'=$G(^TMP("ORLIST",$J,DUZ)) S VALMBG=1
"RTN","OREV2",182,0)
 Q
"RTN","OREV2",183,0)
 ;
"RTN","OREV2",184,0)
CD ;Change display
"RTN","OREV2",185,0)
 S VALMBCK="R" D FULL^VALM1
"RTN","OREV2",186,0)
 D FULLDSP,LIST
"RTN","OREV2",187,0)
 Q
"RTN","OREV2",188,0)
 ;
"RTN","OREV2",189,0)
GETCHILD ;
"RTN","OREV2",190,0)
 N I
"RTN","OREV2",191,0)
 S ^TMP("ORCXPND",$J,CNT,0)="",CNT=CNT+1
"RTN","OREV2",192,0)
 S ^TMP("ORCXPND",$J,CNT,0)="Child events:"
"RTN","OREV2",193,0)
 D:$D(IOUON)&($D(IOUOFF)) CNTRL^VALM10(CNT,1,$L(^(0)),IOUON,IOUOFF)
"RTN","OREV2",194,0)
 S CNT=CNT+1
"RTN","OREV2",195,0)
 S I=0 F  S I=$O(^ORD(100.5,"DAD",DA,I)) Q:'+I  S ^TMP("ORCXPND",$J,CNT,0)=$P(^ORD(100.5,I,0),U),CNT=CNT+1
"RTN","OREV2",196,0)
 Q
"RTN","OREV3")
0^90^B85742054
"RTN","OREV3",1,0)
OREV3 ;SLC/DAN Event delayed orders set up continued ;10/4/02  10:55
"RTN","OREV3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","OREV3",3,0)
 ;DBIA reference section
"RTN","OREV3",4,0)
 ;10116 - VALM1
"RTN","OREV3",5,0)
 ;2324  - USRLM
"RTN","OREV3",6,0)
 ;10009 - DICN
"RTN","OREV3",7,0)
 ;2056  - DIQ
"RTN","OREV3",8,0)
 ;2336  - XPAREDIT
"RTN","OREV3",9,0)
 ;2263  - XPAR
"RTN","OREV3",10,0)
 ;10006 - DIC
"RTN","OREV3",11,0)
 ;10026 - DIR
"RTN","OREV3",12,0)
 ;10018 - DIE
"RTN","OREV3",13,0)
 ;10103 - XLFDT
"RTN","OREV3",14,0)
 ;
"RTN","OREV3",15,0)
ACE ;Add child events to existing events
"RTN","OREV3",16,0)
 N DIC,ORJ,ORTMP,DA,Y,ORGLOB,ADD
"RTN","OREV3",17,0)
 D FULL^VALM1 ;get full screen
"RTN","OREV3",18,0)
 S VALMBCK="R"
"RTN","OREV3",19,0)
 S (DIC,ORGLOB)="^ORD(100.5,"
"RTN","OREV3",20,0)
 I $G(ORNMBR)="" S ORNMBR=$$ORDERS^OREV1("add child events to") Q:ORNMBR="^"  ;If action selected before items, get items
"RTN","OREV3",21,0)
 I $G(ORNMBR)="" D  Q
"RTN","OREV3",22,0)
 .S DIC(0)="AEMQ",DIC("S")="I '+$P($G(^(0)),U,12)" ;Screen children from being parents
"RTN","OREV3",23,0)
 .D ^DIC Q:Y=-1  S DA=+Y
"RTN","OREV3",24,0)
 .Q:'$$PARENTOK^OREV4
"RTN","OREV3",25,0)
 .L +@(ORGLOB_DA_")"):1 I '$T W !!,"This entry is being edited by another user." H 3 Q
"RTN","OREV3",26,0)
 .W !!,"Adding children to parent ",$P(^ORD(100.5,DA,0),U)
"RTN","OREV3",27,0)
 .D ADDCHLD(DA,.ADD) ;Add child to selected event
"RTN","OREV3",28,0)
 .I $G(ADD) D AUDIT^OREV(DA,"E"),CHKPRM^OREV4 ;If child event added update audit history and check parameters
"RTN","OREV3",29,0)
 .L -@(ORGLOB_DA_")")
"RTN","OREV3",30,0)
 F ORJ=1:1:$L(ORNMBR,",")-1 S ORTMP=$P(ORNMBR,",",ORJ),DA=$O(^TMP("OREDO",$J,"IDX",ORTMP,0)) D
"RTN","OREV3",31,0)
 .I $P($G(^ORD(100.5,DA,0)),U,12) W !!,"You may not add child events to events that are already children.",!,$P($G(^ORD(100.5,DA,0)),U)," - SKIPPED!",! H 3 Q
"RTN","OREV3",32,0)
 .Q:'$$PARENTOK^OREV4
"RTN","OREV3",33,0)
 .L +@(ORGLOB_DA_")"):1 I '$T W !!,"This entry is being edited by another user." H 3 Q  ;Lock global
"RTN","OREV3",34,0)
 .W !!,"Adding children to parent ",$P(^ORD(100.5,DA,0),U)
"RTN","OREV3",35,0)
 .D ADDCHLD(DA,.ADD) ;Add child to selected event
"RTN","OREV3",36,0)
 .I $G(ADD) D AUDIT^OREV(DA,"E"),CHKPRM^OREV4 ;If child event added update audit history and check paramters
"RTN","OREV3",37,0)
 .L -@(ORGLOB_DA_")") ;Unlock global
"RTN","OREV3",38,0)
 Q
"RTN","OREV3",39,0)
 ;
"RTN","OREV3",40,0)
ADDCHLD(ENTRY,ADD) ;Add child(ren) to event
"RTN","OREV3",41,0)
 ;ENTRY - Internal entry number of event that will be the parent
"RTN","OREV3",42,0)
 ;ADD - Will be set to 1 if a child is successfully added
"RTN","OREV3",43,0)
 ;
"RTN","OREV3",44,0)
 N DIR,Y,DIC,DIE,DA,DR,DIRUT,X,NEW
"RTN","OREV3",45,0)
 F  D  Q:$G(DIRUT)
"RTN","OREV3",46,0)
 .W !
"RTN","OREV3",47,0)
 .S DIR(0)="FAO^3:50"
"RTN","OREV3",48,0)
 .S DIR("A")="OE/RR CHILD RELEASE EVENT NAME: "
"RTN","OREV3",49,0)
 .S DIR("?")="Enter the name of the child event you wish to create.  It must be free text between 3 and 50 characters and be unique."
"RTN","OREV3",50,0)
 .D ^DIR
"RTN","OREV3",51,0)
 .Q:$G(DIRUT)
"RTN","OREV3",52,0)
 .I $D(^ORD(100.5,"B",Y)) W !,"There is already an entry with this name.  Please select a different name." Q
"RTN","OREV3",53,0)
 .S DIC="^ORD(100.5,",DIC(0)="",X=Y D FILE^DICN ;Add child to file
"RTN","OREV3",54,0)
 .Q:Y=-1
"RTN","OREV3",55,0)
 .S DIE=DIC
"RTN","OREV3",56,0)
 .S DR="[OREV CHILD EVENT"
"RTN","OREV3",57,0)
 .S DA=+Y
"RTN","OREV3",58,0)
 .S NEW=1
"RTN","OREV3",59,0)
 .D ^DIE
"RTN","OREV3",60,0)
 .Q:'$G(DA)  ;Child event deleted, stop processing
"RTN","OREV3",61,0)
 .D AUDIT^OREV(DA,"N") ;Update audit history for child
"RTN","OREV3",62,0)
 .S DR="1///"_$$NOW^XLFDT_";14///`"_ENTRY D ^DIE ;Add parent pointer to child entry
"RTN","OREV3",63,0)
 .S ADD=1 ;Indicate that child was added
"RTN","OREV3",64,0)
 .W !!,"Enter next child name or press enter to stop adding children."
"RTN","OREV3",65,0)
 Q
"RTN","OREV3",66,0)
 ;
"RTN","OREV3",67,0)
UPDTCHLD(PARENT,CDT) ;Update children to inactive when parent is inactivated
"RTN","OREV3",68,0)
 N DA,DIE,CHILD,DR,DONE
"RTN","OREV3",69,0)
 S DONE=0
"RTN","OREV3",70,0)
 S CHILD="" F  S CHILD=$O(^ORD(100.5,"DAD",PARENT,CHILD)) Q:'+CHILD  D
"RTN","OREV3",71,0)
 .I 'DONE W !!,"Updating children..." S DONE=1
"RTN","OREV3",72,0)
 .Q:$G(^ORD(100.5,CHILD,1))  ;Child is already inactive
"RTN","OREV3",73,0)
 .S DA=CHILD
"RTN","OREV3",74,0)
 .S DIE="^ORD(100.5,"
"RTN","OREV3",75,0)
 .S DR="1///"_CDT
"RTN","OREV3",76,0)
 .D ^DIE ;Sets inactivated date/time for child
"RTN","OREV3",77,0)
 .;
"RTN","OREV3",78,0)
 .S DA(1)=DA
"RTN","OREV3",79,0)
 .S DA=$O(^ORD(100.5,DA(1),2,"ACT",0))
"RTN","OREV3",80,0)
 .S DIE="^ORD(100.5,DA(1),2,"
"RTN","OREV3",81,0)
 .S DR="1///"_CDT
"RTN","OREV3",82,0)
 .D ^DIE ;Update inactivated date/time of activation multiple for child
"RTN","OREV3",83,0)
 Q
"RTN","OREV3",84,0)
 ;
"RTN","OREV3",85,0)
PARAM ;Allow user to edit event delayed order parameters
"RTN","OREV3",86,0)
 N DIR,Y
"RTN","OREV3",87,0)
 S VALMBCK="R" D FULL^VALM1
"RTN","OREV3",88,0)
 F  D  Q:'Y
"RTN","OREV3",89,0)
 .S DIR(0)="SO^1:Write orders list by event;2:Default release event;3:Common release event list;4:Manual release controlled by;5:Set manual release parameter;6:Exclude display groups from copy"
"RTN","OREV3",90,0)
 .S DIR("A")="Select parameter to edit"
"RTN","OREV3",91,0)
 .D ^DIR Q:'Y
"RTN","OREV3",92,0)
 .I Y=2!(Y=3) D:Y=2 SETDFLT() D:Y=3 EVENTLST Q
"RTN","OREV3",93,0)
 .D EDITPAR^XPAREDIT($S(Y=1:"ORWDX WRITE ORDERS EVENT LIST",Y=4:"OREVNT MANUAL RELEASE CONTROL",Y=5:"OREVNT MANUAL RELEASE",1:"OREVNT EXCLUDE DGRP"))
"RTN","OREV3",94,0)
 Q
"RTN","OREV3",95,0)
 ;
"RTN","OREV3",96,0)
CANREL() ;Function to determine if delayed order can be manually released
"RTN","OREV3",97,0)
 N ORMAN
"RTN","OREV3",98,0)
 S ORMAN=$$GET^XPAR("ALL","OREVNT MANUAL RELEASE CONTROL")
"RTN","OREV3",99,0)
 S:ORMAN="" ORMAN="K" ;If no value found, default to checking for keys
"RTN","OREV3",100,0)
 I ORMAN="K",'$$KEY Q 0
"RTN","OREV3",101,0)
 I ORMAN="P",'$$MANPARAM Q 0
"RTN","OREV3",102,0)
 I ORMAN="B",'$$KEY,'$$MANPARAM Q 0
"RTN","OREV3",103,0)
 Q 1
"RTN","OREV3",104,0)
 ;
"RTN","OREV3",105,0)
KEY() ;Check for ORES or ORELSE keys
"RTN","OREV3",106,0)
 I '$D(^XUSEC("ORES",DUZ))&('$D(^XUSEC("ORELSE",DUZ))) Q 0
"RTN","OREV3",107,0)
 Q 1
"RTN","OREV3",108,0)
 ;
"RTN","OREV3",109,0)
MANPARAM() ;Check setting of OREVNT MANUAL RELEASE parameter
"RTN","OREV3",110,0)
 N LST,I,FND,PRM,X,Y,DIC,EXP,STR
"RTN","OREV3",111,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT MANUAL RELEASE" D ^DIC
"RTN","OREV3",112,0)
 I Y=-1 Q 0  ;Parameter not found so quit
"RTN","OREV3",113,0)
 S PRM=+Y
"RTN","OREV3",114,0)
 ;Check USER level
"RTN","OREV3",115,0)
 I $$GET^XPAR("USR",PRM) Q 1
"RTN","OREV3",116,0)
 ;Check USER CLASS
"RTN","OREV3",117,0)
 D WHATIS^USRLM(DUZ,"LST")
"RTN","OREV3",118,0)
 I $O(LST(0))'="" D  I FND Q 1
"RTN","OREV3",119,0)
 .S FND=0
"RTN","OREV3",120,0)
 .S I=0 F  S I=$O(LST(I)) Q:I=""!(FND)  S EXP=+$P(LST(I),U,5),STR=+$P(LST(I),U,4) I $G(^XTV(8989.5,"AC",PRM,$P(LST(I),U)_";USR(8930,",1)) I 'EXP!(EXP'<DT) I 'STR!(STR'>DT) S FND=1
"RTN","OREV3",121,0)
 ;Check OE/RR Teams
"RTN","OREV3",122,0)
 K LST
"RTN","OREV3",123,0)
 D TEAMPR^ORQPTQ1(.LST,DUZ)
"RTN","OREV3",124,0)
 I +$G(LST(1)) D  I FND Q 1
"RTN","OREV3",125,0)
 .S FND=0
"RTN","OREV3",126,0)
 .S I=0 F  S I=$O(LST(I)) Q:I=""!(FND)  I $G(^XTV(8989.5,"AC",PRM,$P(LST(I),U)_";OR(100.21,",1)) S FND=1
"RTN","OREV3",127,0)
 ;Check location
"RTN","OREV3",128,0)
 I +$G(LOC),$$GET^XPAR("LOC.`"_+$G(LOC),PRM) Q 1
"RTN","OREV3",129,0)
 ;Check Service
"RTN","OREV3",130,0)
 I $G(^XTV(8989.5,"AC",PRM,+$$GET1^DIQ(200,DUZ,29,"I")_";DIC(49,",1)) Q 1
"RTN","OREV3",131,0)
 ;Check Division and System
"RTN","OREV3",132,0)
 I $$GET^XPAR("DIV^SYS",PRM) Q 1
"RTN","OREV3",133,0)
 Q 0
"RTN","OREV3",134,0)
 ;
"RTN","OREV3",135,0)
DEFHELP ;Provide detailed help for setting default treating specialty
"RTN","OREV3",136,0)
 N DEF,DEFTS,DEFTSNM
"RTN","OREV3",137,0)
 I $D(^ORD(100.5,DA(1),"TS","DEF")) D  Q
"RTN","OREV3",138,0)
 .S DEF=$O(^ORD(100.5,DA(1),"TS","DEF",1,0))
"RTN","OREV3",139,0)
 .I DEF=DA Q  ;Default is current entry
"RTN","OREV3",140,0)
 .S DEFTS=$P(^ORD(100.5,DA(1),"TS",DEF,0),U)
"RTN","OREV3",141,0)
 .S DEFTSNM=$$GET1^DIQ(45.7,DEFTS_",",.01)
"RTN","OREV3",142,0)
 .W !?5,"You may not set this treating specialty as the default because"
"RTN","OREV3",143,0)
 .W !?5,DEFTSNM," is already set as the default."
"RTN","OREV3",144,0)
 .W !?5,"If you would like to change the default you must first delete the",!?5,"default designation from the above mentioned treating specialty.",!
"RTN","OREV3",145,0)
 ;
"RTN","OREV3",146,0)
 W !?5,"Currently there is no default treating specialty set for this event.",!
"RTN","OREV3",147,0)
 Q
"RTN","OREV3",148,0)
 ;
"RTN","OREV3",149,0)
EVENTLST ;Allow user to edit OREVNT COMMON LIST parameter and set a default for that list
"RTN","OREV3",150,0)
 N DIC,X,Y,PRM,ORENT
"RTN","OREV3",151,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT COMMON LIST" D ^DIC
"RTN","OREV3",152,0)
 Q:Y=-1  ;Parameter doesn't exist
"RTN","OREV3",153,0)
 S PRM=Y
"RTN","OREV3",154,0)
 D GETENT^XPAREDIT(.ORENT,PRM)
"RTN","OREV3",155,0)
 Q:ORENT=""  ;Nothing selected
"RTN","OREV3",156,0)
 D EDIT^XPAREDIT(ORENT,PRM) ;edit selected entity
"RTN","OREV3",157,0)
 Q:$G(DUOUT)!($G(DTOUT))  ;User ^ or timed out
"RTN","OREV3",158,0)
 I '$D(^XTV(8989.5,"AC",+PRM,ORENT)) Q  ;No value stored for entity don't ask for default
"RTN","OREV3",159,0)
 D SETDFLT(ORENT,PRM)
"RTN","OREV3",160,0)
 Q
"RTN","OREV3",161,0)
 ;
"RTN","OREV3",162,0)
SETDFLT(ORENT,PRM) ;Set default for given list
"RTN","OREV3",163,0)
 N DIC,Y,X,PRMD,DEF,I,J,DIR,FND,ORLST
"RTN","OREV3",164,0)
 I $G(PRM)="" S DIC=8989.51,DIC(0)="MX",X="OREVNT COMMON LIST" D ^DIC Q:Y=-1  S PRM=Y
"RTN","OREV3",165,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT DEFAULT" D ^DIC
"RTN","OREV3",166,0)
 Q:Y=-1  ;Parameter doesn't exist
"RTN","OREV3",167,0)
 S PRMD=Y
"RTN","OREV3",168,0)
 I $G(ORENT)="" D GETENT^XPAREDIT(.ORENT,PRMD) Q:ORENT=""  ;Nothing selected
"RTN","OREV3",169,0)
 D GETLST^XPAR(.ORLST,ORENT,+PRM)
"RTN","OREV3",170,0)
 I ORLST=0 W !!,"No common list is defined for this entity and therefore a default",!,"may not be set.  Create a common list first.",! Q
"RTN","OREV3",171,0)
 S DEF=$$GET^XPAR(ORENT,+PRMD,,"B") F I=1:1:ORLST I $P(ORLST(I),U,2)=+DEF S FND=1
"RTN","OREV3",172,0)
 I '$G(FND) S DEF="" D EN^XPAR(ORENT,+PRMD,,"@") ;Delete default if no longer in list
"RTN","OREV3",173,0)
 W !!,$S(DEF'="":"Current DEFAULT is "_$P(DEF,U,2)_$S($G(^ORD(100.5,+DEF,1)):" (*INACTIVE*)",1:""),1:"No DEFAULT has been set yet.")
"RTN","OREV3",174,0)
 W ! F J=1:1:ORLST W !,J,") ",$P(^ORD(100.5,$P(ORLST(J),U,2),0),U),$S($G(^(1)):" (*INACTIVE*)",1:"")
"RTN","OREV3",175,0)
 I DEF'="" S ORLST=ORLST+1 W !!,ORLST,") DELETE CURRENT DEFAULT"
"RTN","OREV3",176,0)
 W ! S DIR(0)="NO^1:"_ORLST,DIR("A")="Select default release event"_$S(DEF'="":" or delete current event",1:"") D ^DIR
"RTN","OREV3",177,0)
 I 'Y Q  ;No selection made
"RTN","OREV3",178,0)
 I Y=ORLST&(DEF'="") D EN^XPAR(ORENT,+PRMD,,"@") W !,"Default deleted" Q
"RTN","OREV3",179,0)
 I $G(^ORD(100.5,$P(ORLST(Y),U,2),1)) W !,"You cannot set an inactive event as the default." Q  ;No inactive defaults can be set
"RTN","OREV3",180,0)
 ;write updated parameter
"RTN","OREV3",181,0)
 D EN^XPAR(ORENT,+PRMD,,"`"_$P(ORLST(Y),"^",2))
"RTN","OREV3",182,0)
 Q
"RTN","OREV3",183,0)
 ;
"RTN","OREV3",184,0)
GETLST(LST) ;Return common list and default event
"RTN","OREV3",185,0)
 N I,FND,PRM,X,Y,DIC,TLST,ORCLST,ENT,EXP,STR
"RTN","OREV3",186,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT COMMON LIST" D ^DIC
"RTN","OREV3",187,0)
 I Y=-1 Q  ;Parameter not found so quit
"RTN","OREV3",188,0)
 S PRM=+Y
"RTN","OREV3",189,0)
 D ENVAL^XPAR(.ORCLST,PRM) Q:ORCLST=0  ;Nothing defined at any level
"RTN","OREV3",190,0)
 ;Check USER level
"RTN","OREV3",191,0)
 S ENT=DUZ_";VA(200," I $D(ORCLST(ENT)) D RETLST Q
"RTN","OREV3",192,0)
 ;Check USER CLASS
"RTN","OREV3",193,0)
 D WHATIS^USRLM(DUZ,"TLST")
"RTN","OREV3",194,0)
 I $O(TLST(0))'="" D  I FND Q
"RTN","OREV3",195,0)
 .S FND=0
"RTN","OREV3",196,0)
 .S I=0 F  S I=$O(TLST(I)) Q:I=""!(FND)  S ENT=$P(TLST(I),U)_";USR(8930," S EXP=+$P(TLST(I),U,5),STR=+$P(TLST(I),U,4) I 'EXP!(EXP'<DT) I 'STR!(STR'>DT) I $D(ORCLST(ENT)) D RETLST S FND=1
"RTN","OREV3",197,0)
 ;Check OE/RR Teams
"RTN","OREV3",198,0)
 K TLST
"RTN","OREV3",199,0)
 D TEAMPR^ORQPTQ1(.TLST,DUZ)
"RTN","OREV3",200,0)
 I +$G(TLST(1)) D  I FND Q
"RTN","OREV3",201,0)
 .S FND=0
"RTN","OREV3",202,0)
 .S I=0 F  S I=$O(TLST(I)) Q:I=""!(FND)  S ENT=$P(TLST(I),U)_"OR(100.21," I $D(ORCLST(ENT)) D RETLST S FND=1
"RTN","OREV3",203,0)
 ;Check location
"RTN","OREV3",204,0)
 I +$G(LOC) S ENT=+LOC_";SC(" I $D(ORCLST(ENT)) D RETLST Q
"RTN","OREV3",205,0)
 ;Check Service
"RTN","OREV3",206,0)
 S ENT=$$GET1^DIQ(200,DUZ,29,"I")_";DIC(49,"
"RTN","OREV3",207,0)
 I $D(ORCLST(ENT)) D RETLST Q
"RTN","OREV3",208,0)
 ;Check Division 
"RTN","OREV3",209,0)
 S ENT=DUZ(2)_";DIC(4," I $D(ORCLST(ENT)) D RETLST Q
"RTN","OREV3",210,0)
 Q
"RTN","OREV3",211,0)
 ;
"RTN","OREV3",212,0)
RETLST ;Sets up list for entity
"RTN","OREV3",213,0)
 N DEF,Y,DIC,I,CNT,X
"RTN","OREV3",214,0)
 S DIC=8989.51,DIC(0)="MQ",X="OREVNT DEFAULT" D ^DIC
"RTN","OREV3",215,0)
 Q:'Y  ;Stop if parameter doesn't exist
"RTN","OREV3",216,0)
 S CNT=1
"RTN","OREV3",217,0)
 S DEF=$$GET^XPAR(ENT,+Y,,"B")
"RTN","OREV3",218,0)
 S I=0 F  S I=$O(CLST(ENT,I)) Q:'+I  I '$G(^ORD(100.5,CLST(ENT,I),1))&('$D(^ORD(100.5,"DAD",CLST(ENT,I)))) S LST(CNT)=CLST(ENT,I) S:CLST(ENT,I)=+DEF $P(LST(CNT),U,2)=1 S CNT=CNT+1
"RTN","OREV3",219,0)
 Q
"RTN","OREV4")
0^92^B23656896
"RTN","OREV4",1,0)
OREV4 ;SLC/DAN Event delayed orders cont ;10/25/02  13:54
"RTN","OREV4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","OREV4",3,0)
 ;DBIA reference section
"RTN","OREV4",4,0)
 ;10006 - DIC
"RTN","OREV4",5,0)
 ;10018 - DIE
"RTN","OREV4",6,0)
 ;10013 - DIK
"RTN","OREV4",7,0)
 ;10103 - XLFDT
"RTN","OREV4",8,0)
 ;2056  - DIQ
"RTN","OREV4",9,0)
 ;2263  - XPAR
"RTN","OREV4",10,0)
 ;
"RTN","OREV4",11,0)
 N Y,DIC,ZTSAVE,IEN
"RTN","OREV4",12,0)
 S DIC="^ORE(100.2,",DIC(0)="AEMQ" D ^DIC
"RTN","OREV4",13,0)
 Q:Y=-1  ;Quit if no selection made
"RTN","OREV4",14,0)
 S IEN=+Y
"RTN","OREV4",15,0)
 W !
"RTN","OREV4",16,0)
 S ZTSAVE("IEN")="",ZTSAVE("DIC")="",ZTSAVE("IO*")=""
"RTN","OREV4",17,0)
 D QUE^ORUTL1("DQI^OREV4","Patient event inquiry",.ZTSAVE) ;Get device to print on
"RTN","OREV4",18,0)
 Q
"RTN","OREV4",19,0)
 ;
"RTN","OREV4",20,0)
DQI ;Tasked entry point or continue if not queued
"RTN","OREV4",21,0)
 U IO
"RTN","OREV4",22,0)
 S DA=IEN
"RTN","OREV4",23,0)
 D EN^DIQ
"RTN","OREV4",24,0)
 Q
"RTN","OREV4",25,0)
 ;
"RTN","OREV4",26,0)
CHKPRM ;Checks to see if event is defined in either the OREVNT DEFAULT
"RTN","OREV4",27,0)
 ;or the OREVNT COMMON LIST parameter.  If so, then it will be removed
"RTN","OREV4",28,0)
 ;from the parameters as PARENT type events are not allowed in these
"RTN","OREV4",29,0)
 ;parameters.  This API is called when an event becomes a parent.
"RTN","OREV4",30,0)
 N DIC,Y,X,PRMC,PRMD,PARAM,I,J
"RTN","OREV4",31,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT COMMON LIST" D ^DIC
"RTN","OREV4",32,0)
 Q:Y=-1  ;Parameter doesn't exist
"RTN","OREV4",33,0)
 S PRMC=+Y
"RTN","OREV4",34,0)
 S X="OREVNT DEFAULT" D ^DIC
"RTN","OREV4",35,0)
 Q:Y=-1  ;Parameter doesn't exist
"RTN","OREV4",36,0)
 S PRMD=+Y
"RTN","OREV4",37,0)
 F PARAM=PRMC,PRMD D
"RTN","OREV4",38,0)
 .K ORLST
"RTN","OREV4",39,0)
 .D ENVAL^XPAR(.ORLST,PRMC) ;get list of values
"RTN","OREV4",40,0)
 .Q:ORLST=0  ;No values
"RTN","OREV4",41,0)
 .S I="" F  S I=$O(ORLST(I)) Q:I=""  D
"RTN","OREV4",42,0)
 ..S J="" F  S J=$O(ORLST(I,J)) Q:J=""  D
"RTN","OREV4",43,0)
 ...I ORLST(I,J)=DA D EN^XPAR(I,PARAM,J,"@") ;delete event from parameter
"RTN","OREV4",44,0)
 Q
"RTN","OREV4",45,0)
 ;
"RTN","OREV4",46,0)
DELAYED(DFN) ;Display list of delayed events for a patient, identified by DFN
"RTN","OREV4",47,0)
 N EVT,IFN,DISP
"RTN","OREV4",48,0)
 I '$D(^ORE(100.2,"AE",DFN)) Q  ;Quit if no delayed orders exist for the patient
"RTN","OREV4",49,0)
 S EVT=0,DISP=0
"RTN","OREV4",50,0)
 F  S EVT=$O(^ORE(100.2,"AE",DFN,EVT)) Q:'+EVT  D
"RTN","OREV4",51,0)
 .S IFN=$O(^ORE(100.2,"AE",DFN,EVT,0))
"RTN","OREV4",52,0)
 .Q:$$LAPSED^OREVNTX(IFN)  ;quit if event has lapsed
"RTN","OREV4",53,0)
 .W:'DISP !!,"Delayed orders exist for this patient!",$C(7) S DISP=1
"RTN","OREV4",54,0)
 .W !,"EVENT: ",$P($G(^ORD(100.5,+$P(^ORE(100.2,IFN,0),U,2),0)),U,8),", created on ",$$FMTE^XLFDT($P(^ORE(100.2,IFN,0),U,5),1)
"RTN","OREV4",55,0)
 Q
"RTN","OREV4",56,0)
 ;
"RTN","OREV4",57,0)
PARENTOK() ;This function determines if the event can be a parent
"RTN","OREV4",58,0)
 ;if an event has future delayed orders tied to it then it can't be
"RTN","OREV4",59,0)
 ;a parent
"RTN","OREV4",60,0)
 N OK,SUB,RIEN,PIEN
"RTN","OREV4",61,0)
 S OK=1
"RTN","OREV4",62,0)
 S SUB="^ORE(100.2,""AE"")"
"RTN","OREV4",63,0)
 F  S SUB=$Q(@SUB) Q:SUB'["AE"!('OK)  D
"RTN","OREV4",64,0)
 .S RIEN=$P(SUB,",",4) ;Release event ID
"RTN","OREV4",65,0)
 .S PIEN=$P(SUB,",",5) ;Patient event ID
"RTN","OREV4",66,0)
 .Q:$$LAPSED^OREVNTX(PIEN)  ;quit if event has lapsed
"RTN","OREV4",67,0)
 .I RIEN=DA W !!,"You may not make ",$P($G(^ORD(100.5,DA,0)),U)," a parent",!,"at this time because there are unprocessed delayed orders assigned to it." H 3 S OK=0
"RTN","OREV4",68,0)
 Q OK
"RTN","OREV4",69,0)
 ;
"RTN","OREV4",70,0)
ACTSURG(ORTYPE,DA) ;Function returns 1 if an active surgery event already exists
"RTN","OREV4",71,0)
 N ACT,DIV,I
"RTN","OREV4",72,0)
 S ACT=0
"RTN","OREV4",73,0)
 I ORTYPE="E" D
"RTN","OREV4",74,0)
 .S DIV=$P($G(^ORD(100.5,DA,0)),U,3)
"RTN","OREV4",75,0)
 .S I=0 F  S I=$O(^ORD(100.5,"ADT","O",I)) Q:'+I  I DA'=I I DIV=$P($G(^ORD(100.5,I,0)),U,3)&('$G(^ORD(100.5,I,1))) S ACT=1
"RTN","OREV4",76,0)
 .Q
"RTN","OREV4",77,0)
 I ORTYPE="A" D
"RTN","OREV4",78,0)
 .S DIV=$P($G(^ORD(100.6,DA,0)),U,3)
"RTN","OREV4",79,0)
 .S I=0 F  S I=$O(^ORD(100.6,"AE",DIV,"O",I)) Q:'+I  I I'=DA S ACT=1
"RTN","OREV4",80,0)
 .Q
"RTN","OREV4",81,0)
 Q ACT
"RTN","OREV4",82,0)
 ;
"RTN","OREV4",83,0)
FROMTO(MUL,SUB1,SUB2) ;Check FROM - TO entries in file 100.6
"RTN","OREV4",84,0)
 N DA,DIK,LOC0,X,Y,DEL,ERR
"RTN","OREV4",85,0)
 I MUL="S" D  Q
"RTN","OREV4",86,0)
 .I '$D(^ORD(100.6,SUB1,4,SUB2,1,"B")) D  ;Check for TO entries in specialties multiple
"RTN","OREV4",87,0)
 ..W !!,"ERROR - Missing TO entry - ",$P($G(^DIC(45.7,$P(^ORD(100.6,SUB1,4,SUB2,0),U),0)),U)," DELETED.",!
"RTN","OREV4",88,0)
 ..S DA(1)=SUB1,DA=SUB2,DIK="^ORD(100.6,"_DA(1)_",4," D ^DIK
"RTN","OREV4",89,0)
 ;
"RTN","OREV4",90,0)
 I MUL="L" D
"RTN","OREV4",91,0)
 .S LOC0=^ORD(100.6,SUB1,5,SUB2,0)
"RTN","OREV4",92,0)
 .I +$P(LOC0,U,2)=0&($P(LOC0,U,3)="") S DEL=1,ERR=1
"RTN","OREV4",93,0)
 .I +$P(LOC0,U,4)=0&($P(LOC0,U,5)="") S DEL=1,ERR=1
"RTN","OREV4",94,0)
 .I $G(ERR) W !!,"ERROR - Missing FROM or TO location - '",$P(LOC0,U),"' DELETED.",! Q
"RTN","OREV4",95,0)
 .I $P(LOC0,U,2) D CLEAR(SUB1,SUB2,2) ;If user selects "all" clear "from" field
"RTN","OREV4",96,0)
 .I $P(LOC0,U,4) D CLEAR(SUB1,SUB2,4) ;If user selects "all" clear "to" field
"RTN","OREV4",97,0)
 .I $P(LOC0,U,2)&($P(LOC0,U,4)) W !!,"WARNING - You've defined a 'FROM ALL' locations to 'TO ALL' locations entry",!,"and it will supercede all other entries.",! Q
"RTN","OREV4",98,0)
 .I $O(^ORD(100.6,SUB1,5,"ADC",$S($P(LOC0,U,2)=1:"ALL",1:$P(LOC0,U,3)),$S($P(LOC0,U,4)=1:"ALL",1:$P(LOC0,U,5)),SUB2)) S DEL=1,ERR=1
"RTN","OREV4",99,0)
 .I $O(^ORD(100.6,SUB1,5,"ADC",$S($P(LOC0,U,2)=1:"ALL",1:$P(LOC0,U,3)),$S($P(LOC0,U,4)=1:"ALL",1:$P(LOC0,U,5)),SUB2),-1) S DEL=1,ERR=1
"RTN","OREV4",100,0)
 .I $G(ERR) W !!,"ERROR - Duplicate entry exists - '",$P(LOC0,U),"' DELETED.",!
"RTN","OREV4",101,0)
 I $G(DEL) S DIK="^ORD(100.6,"_SUB1_",5,",DA=SUB2,DA(1)=SUB1 D ^DIK
"RTN","OREV4",102,0)
 Q
"RTN","OREV4",103,0)
 ;
"RTN","OREV4",104,0)
CLEAR(TENT,MENT,FIELD) ;Clear selected fields
"RTN","OREV4",105,0)
 N DA,DIE,Y,X,FILE
"RTN","OREV4",106,0)
 S FILE(100.62,MENT_","_TENT_",",FIELD)="@" D FILE^DIE("","FILE")
"RTN","OREV4",107,0)
 Q
"RTN","OREVNT")
0^26^B71307159
"RTN","OREVNT",1,0)
OREVNT ; SLC/MKB - Event delayed orders ; 25 Apr 2002 10:07 PM
"RTN","OREVNT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","OREVNT",3,0)
 ;
"RTN","OREVNT",4,0)
EN ; -- view/add delayed orders
"RTN","OREVNT",5,0)
 N X,ORP,ORQUIT S VALMBCK=""
"RTN","OREVNT",6,0)
 I $G(OREVENT) D  Q:$G(ORQUIT)
"RTN","OREVNT",7,0)
 . S X=$$ACTIVE I X D EX S ORQUIT=1 Q  ;return to Active Orders
"RTN","OREVNT",8,0)
 . I X="^" S ORQUIT=1 Q
"RTN","OREVNT",9,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","OREVNT",10,0)
 W !!,$$CURRENT
"RTN","OREVNT",11,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 Q:ORL="^"
"RTN","OREVNT",12,0)
 S ORP=$$PTEVENT(+ORVP) Q:ORP="^"
"RTN","OREVNT",13,0)
 S $P(^TMP("OR",$J,"ORDERS",0),U,3,4)=";;;;;;;"_+ORP_U,OREVENT=+ORP
"RTN","OREVNT",14,0)
 D TAB^ORCHART(ORTAB,1) ;redisplay new order sheet/view
"RTN","OREVNT",15,0)
 Q
"RTN","OREVNT",16,0)
 ;
"RTN","OREVNT",17,0)
EX ; -- Return to Active Orders view
"RTN","OREVNT",18,0)
 I +$G(OREVENT),'$G(^ORE(100.2,OREVENT,1)),$$EMPTY^OREVNTX(OREVENT) D CANCEL^OREVNTX(OREVENT) ;cancel empty events
"RTN","OREVNT",19,0)
 K OREVENT S $P(^TMP("OR",$J,"ORDERS",0),U,3,4)="^1" ;default view
"RTN","OREVNT",20,0)
 D TAB^ORCHART(ORTAB,1)
"RTN","OREVNT",21,0)
 Q
"RTN","OREVNT",22,0)
 ;
"RTN","OREVNT",23,0)
ED ; -- Change delay event
"RTN","OREVNT",24,0)
 N ORI,NMBR,IDX,ORIFN,ORLK,ORDERS,OREVT,ORQUIT,X,EVT
"RTN","OREVNT",25,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("change the delay event") Q:'ORNMBR
"RTN","OREVNT",26,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","OREVNT",27,0)
 F ORI=1:1:$L(ORNMBR) S NMBR=$P(ORNMBR,",",ORI) D:NMBR  Q:$D(ORQUIT)
"RTN","OREVNT",28,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),ORIFN=$P(IDX,U)
"RTN","OREVNT",29,0)
 . Q:'ORIFN  S:'$P(ORIFN,";",2) ORIFN=+ORIFN_";1" ;unsign/unrel only
"RTN","OREVNT",30,0)
 . I '$$VALID^ORCACT0(ORIFN,"EV",.ORERR) W !!,$$ORDITEM^ORCACT(ORIFN)_" invalid.",!,"  >> "_ORERR H 1 Q
"RTN","OREVNT",31,0)
 . S ORLK=$$LOCK1^ORX2(+ORIFN) I 'ORLK W !!,$$ORDITEM^ORCACT(ORIFN)_" invalid.",!,"  >> "_$P(ORLK,U,2) H 1 Q
"RTN","OREVNT",32,0)
 . S ORDERS(+ORIFN)=""
"RTN","OREVNT",33,0)
ED1 Q:'$O(ORDERS(0))  I $$DELAYED D  Q:$G(ORQUIT)  G:$G(OREBUILD) ED3
"RTN","OREVNT",34,0)
 . S X=$$NODELAY ;remove event?
"RTN","OREVNT",35,0)
 . I X="^" W !,"Nothing changed!" D UNLOCK S ORQUIT=1 H 1 Q
"RTN","OREVNT",36,0)
 . Q:'X  W !!,"Removing release event ..."
"RTN","OREVNT",37,0)
 . S ORIFN=0 F  S ORIFN=$O(ORDERS(ORIFN)) Q:ORIFN<1  D
"RTN","OREVNT",38,0)
 .. S EVT=+$P($G(^OR(100,ORIFN,0)),U,17),OREVT(EVT)=""
"RTN","OREVNT",39,0)
 .. D CHGEVT^OREVNTX(ORIFN,""),UNLK1^ORX2(ORIFN) W "."
"RTN","OREVNT",40,0)
 . W " done." S OREBUILD=1
"RTN","OREVNT",41,0)
ED2 W !!,$$CURRENT S ORP=$$PTEVENT(+ORVP,1)
"RTN","OREVNT",42,0)
 I ORP="^" W !,"Nothing changed!" D UNLOCK H 1 Q
"RTN","OREVNT",43,0)
 W !!,"Setting release event to "_$P(ORP,U,2)_" ..."
"RTN","OREVNT",44,0)
 S ORIFN=0 F  S ORIFN=$O(ORDERS(ORIFN)) Q:ORIFN<1  D
"RTN","OREVNT",45,0)
 . S EVT=+$P($G(^OR(100,ORIFN,0)),U,17) Q:EVT=+ORP  S OREVT(EVT)=""
"RTN","OREVNT",46,0)
 . D CHGEVT^OREVNTX(ORIFN,+ORP),UNLK1^ORX2(ORIFN) W "."
"RTN","OREVNT",47,0)
 W " done." S OREBUILD=1
"RTN","OREVNT",48,0)
ED3 S EVT=0 F  S EVT=$O(OREVT(EVT)) Q:EVT<1  D  ;terminate any events?
"RTN","OREVNT",49,0)
 . Q:$G(^ORE(100.2,EVT,1))  Q:'$$EMPTY^OREVNTX(EVT)  ;active,empty
"RTN","OREVNT",50,0)
 . ;W !!,$P($$NAME^OREVNTX(EVT)," ",2,99)_" has no more delayed orders."
"RTN","OREVNT",51,0)
 . ;S DIR(0)="YA",DIR("A")="Do you want to cancel this event? "
"RTN","OREVNT",52,0)
 . ;S DIR("?")="Enter NO if you wish to enter new delayed orders for this event, otherwise enter YES to terminate it."
"RTN","OREVNT",53,0)
 . ;S DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT) S ORQUIT=1 Q
"RTN","OREVNT",54,0)
 . D CANCEL^OREVNTX(EVT) S X=$P($$NAME^OREVNTX(EVT)," ",2,99)
"RTN","OREVNT",55,0)
 . W !,"   ... "_X_" event cancelled." H 1
"RTN","OREVNT",56,0)
 . D:$G(OREVENT) EX ;Change view back to Active
"RTN","OREVNT",57,0)
 Q
"RTN","OREVNT",58,0)
 ;
"RTN","OREVNT",59,0)
ACTIVE() ; -- Return to Active orders?
"RTN","OREVNT",60,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","OREVNT",61,0)
 S DIR("A")="Return to viewing Active Orders? ",DIR("B")="YES"
"RTN","OREVNT",62,0)
 S DIR("?")="Enter NO to select another delayed order sheet to view, or YES to exit delayed mode and return to your default Orders view."
"RTN","OREVNT",63,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","OREVNT",64,0)
 Q Y
"RTN","OREVNT",65,0)
 ;
"RTN","OREVNT",66,0)
DELAYED() ; -- Return 1 or 0, if current view=delayed orders
"RTN","OREVNT",67,0)
 I $G(OREVENT) Q 1
"RTN","OREVNT",68,0)
 N X,Y S X=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),X=$P(X,";",3)
"RTN","OREVNT",69,0)
 S Y=$S("^15^16^17^24^25^"[(U_X_U):1,1:0)
"RTN","OREVNT",70,0)
 Q Y
"RTN","OREVNT",71,0)
 ;
"RTN","OREVNT",72,0)
NODELAY() ; -- Return 1 or 0, if delay event should be removed
"RTN","OREVNT",73,0)
 N X,Y,DIR S DIR(0)="YA"
"RTN","OREVNT",74,0)
 S DIR("A")="Remove the release event from these orders? ",DIR("B")="NO"
"RTN","OREVNT",75,0)
 S DIR("?")="Enter YES to allow these orders to be released immediately upon signature, or NO to continue and keep this event or select another."
"RTN","OREVNT",76,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","OREVNT",77,0)
 Q Y
"RTN","OREVNT",78,0)
 ;
"RTN","OREVNT",79,0)
UNLOCK ; -- Unlock orders after ^
"RTN","OREVNT",80,0)
 F  S ORIFN=$O(ORDERS(ORIFN)) Q:ORIFN'>0  D UNLK1^ORX2(+ORIFN)
"RTN","OREVNT",81,0)
 Q
"RTN","OREVNT",82,0)
 ;
"RTN","OREVNT",83,0)
CURRENT() ; -- Display current patient data
"RTN","OREVNT",84,0)
 N Y S Y=ORPNM_" is currently"_$S('$G(ORWARD):" not",1:"")_" admitted"_$S($G(ORWARD)&$G(ORTS):" to "_$P($G(^DIC(45.7,+ORTS,0)),U),1:"")_"."
"RTN","OREVNT",85,0)
 Q Y
"RTN","OREVNT",86,0)
 ;
"RTN","OREVNT",87,0)
PTEVENT(DFN,DLGONLY) ; -- Select Patient Event [or create new one]
"RTN","OREVNT",88,0)
 ;    Pass in DLGONLY=1 to skip new event's Order Set (from Copy, Xfer)
"RTN","OREVNT",89,0)
 ;    Returns Pt Evt ien ^ Event name
"RTN","OREVNT",90,0)
 I '$G(DFN)!'$D(^DPT(+$G(DFN),0)) Q "^" ;invalid patient
"RTN","OREVNT",91,0)
 N ORPTEVT,OREVT,X,Y,DIR,DTOUT,DUOUT,ORDIV,DOMAIN,OREV0,ORDAD,ORDIALOG,ORDSET,ORIFN,ORPTLK,OREBUILD,OREVENT
"RTN","OREVNT",92,0)
 I $D(^ORE(100.2,"AE",DFN)) D  ;pending events
"RTN","OREVNT",93,0)
 . N CNT,EVT S (CNT,EVT)=0,DOMAIN=100.2 K ORPTEVT,DIR
"RTN","OREVNT",94,0)
 . F  S EVT=+$O(^ORE(100.2,"AE",DFN,EVT)) Q:EVT'>0  S Y=+$O(^(EVT,0)) D
"RTN","OREVNT",95,0)
 .. Q:$G(^ORE(100.2,Y,1))  Q:$$LAPSED^OREVNTX(Y)  Q:$D(^ORE(100.2,"DAD",Y))
"RTN","OREVNT",96,0)
 .. S X=$P($G(^ORD(100.5,EVT,0)),U,8),CNT=CNT+1,ORPTEVT(CNT)=Y_U_X
"RTN","OREVNT",97,0)
 .. S X=$$UP^XLFSTR(X),ORPTEVT("B",X)=Y
"RTN","OREVNT",98,0)
 . Q:CNT'>0  S DIR("A",1)="Delayed orders exist for "_ORPNM_" for the following events:"
"RTN","OREVNT",99,0)
 . F I=1:1:CNT S DIR("A",I+1)=$J(I,5)_"  "_$P(ORPTEVT(I),U,2)
"RTN","OREVNT",100,0)
 . S DIR("A",CNT+2)="To review or add delayed orders, select from (1-"_CNT_") or enter a new event."
"RTN","OREVNT",101,0)
 S X=+$$GET^XPAR("ALL","OREVNT DEFAULT")
"RTN","OREVNT",102,0)
 I X S Y=$P($G(^ORD(100.5,X,0)),U,8),DIR("B")=$$UP^XLFSTR(Y)
"RTN","OREVNT",103,0)
PT1 S I=0 F  S I=+$O(DIR("A",I)) Q:I<1  W !,DIR("A",I)
"RTN","OREVNT",104,0)
 W !,"Select RELEASE EVENT: "_$S($L($G(DIR("B"))):DIR("B")_"//",1:"")
"RTN","OREVNT",105,0)
 R X:DTIME I '$T!(X["^")!(X=""&'$D(DIR("B"))) Q "^"
"RTN","OREVNT",106,0)
 S:X="" X=$G(DIR("B")) I X["?" D HELP^OREVNT(X) G PT1
"RTN","OREVNT",107,0)
 I $O(DIR("A",0)) S ORPTEVT=$$FIND^ORCDLG2("ORPTEVT",X) G:$L(ORPTEVT) PTQ
"RTN","OREVNT",108,0)
 S OREVT="" D  I OREVT<1 G PT1 ;reask
"RTN","OREVNT",109,0)
 . N DIC,DIR,D S DIC="^ORD(100.5,",DIC(0)="EQZS",D="C",DIC("W")=""
"RTN","OREVNT",110,0)
 . S DIC("S")="I '$D(^ORD(100.5,""DAD"",Y))"
"RTN","OREVNT",111,0)
 . ;S:'$G(ORWARD) DIC("S")="I $P(^(0),U,2)=""A"""
"RTN","OREVNT",112,0)
 . D IX^DIC S:Y>0 OREVT=+Y_U_$P(Y(0),U,8)
"RTN","OREVNT",113,0)
 I $$MATCH(DFN,+OREVT),'$$CONT G PT1 ;reask
"RTN","OREVNT",114,0)
 S OREV0=$G(^ORD(100.5,+OREVT,0)),ORDAD=+$P(OREV0,U,12)
"RTN","OREVNT",115,0)
 S ORDIALOG=+$P(OREV0,U,4),ORDSET=+$P(OREV0,U,5)
"RTN","OREVNT",116,0)
 I 'ORDIALOG,'ORDSET!$G(DLGONLY),'ORDAD S ORPTEVT=$$NEW(DFN,+OREVT) S:ORPTEVT<1 ORPTEVT="^" G PTQ
"RTN","OREVNT",117,0)
PT2 S ORPTLK=$$LOCK^ORX2(DFN) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q "^"
"RTN","OREVNT",118,0)
 S ORNP=$$PROVIDER^ORCMENU1 I ORNP="^" Q "^"
"RTN","OREVNT",119,0)
 I ORDAD D  I $G(ORIFN)="^" Q "^"  ;parent
"RTN","OREVNT",120,0)
 . N OREVT S OREVT=ORDAD,ORDIALOG=+$P($G(^ORD(100.5,ORDAD,0)),U,4)
"RTN","OREVNT",121,0)
 . I ORDIALOG S ORIFN=+$$ORDER^ORCDLG(ORDIALOG) I ORIFN<1 S ORIFN="^" Q
"RTN","OREVNT",122,0)
 . S ORPTEVT=$$NEW(DFN,ORDAD,$G(ORIFN)),ORDIALOG="" K ORIFN
"RTN","OREVNT",123,0)
 I ORDIALOG S ORIFN=+$$ORDER^ORCDLG(ORDIALOG) I ORIFN<1 Q "^"
"RTN","OREVNT",124,0)
 S ORPTEVT=$$NEW(DFN,+OREVT,$G(ORIFN)) I ORPTEVT<1 Q "^"
"RTN","OREVNT",125,0)
 I ORDSET,'$G(DLGONLY) S OREVENT=+ORPTEVT D EN^ORCDLG(ORDSET) K ^TMP("ORECALL",$J)
"RTN","OREVNT",126,0)
 D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(DFN) ;unlock if no new orders
"RTN","OREVNT",127,0)
PTQ Q ORPTEVT
"RTN","OREVNT",128,0)
 ;
"RTN","OREVNT",129,0)
HELP(RSP) ; -- ?help for DIR Event lookup to list Events
"RTN","OREVNT",130,0)
 N X,Y,Z,CNT,DONE
"RTN","OREVNT",131,0)
 W !,"Select the release event for which you wish to delay orders."
"RTN","OREVNT",132,0)
 W !,"Choose from:" S CNT=1
"RTN","OREVNT",133,0)
 S X="" F  S X=$O(^ORD(100.5,"C",X)) Q:X=""  D  Q:$G(DONE)
"RTN","OREVNT",134,0)
 . S Y=0 F  S Y=$O(^ORD(100.5,"C",X,Y)) Q:Y<1  D  Q:$G(DONE)
"RTN","OREVNT",135,0)
 .. Q:$O(^ORD(100.5,"DAD",Y,0))  ;Parent event
"RTN","OREVNT",136,0)
 .. S TYPE=$P($G(^ORD(100.5,Y,0)),U,2)
"RTN","OREVNT",137,0)
 .. I RSP="?" Q:TYPE="A"&$G(ORWARD)  Q:TYPE'="A"&'$G(ORWARD)
"RTN","OREVNT",138,0)
 .. W !,"   "_X S CNT=CNT+1 Q:CNT'>(IOSL-3)  S CNT=0
"RTN","OREVNT",139,0)
 .. W !,"   '^' TO STOP: " R Z:DTIME S:'$T!(Z["^") DONE=1
"RTN","OREVNT",140,0)
 Q
"RTN","OREVNT",141,0)
 ;
"RTN","OREVNT",142,0)
NEW(DFN,EVT,IFN) ; -- Create new Patient Event in #100.2
"RTN","OREVNT",143,0)
 I '$G(DFN) Q "^"
"RTN","OREVNT",144,0)
 N I,HDR,LAST,TOTAL,DA,ADM,DAD,X0
"RTN","OREVNT",145,0)
 F I=1:1:10 L +^ORE(100.2,0):1 Q:$T  H 2
"RTN","OREVNT",146,0)
 I '$T Q "^"
"RTN","OREVNT",147,0)
 S HDR=$G(^ORE(100.2,0)),TOTAL=+$P(HDR,U,4),LAST=$O(^ORE(100.2,"?"),-1)
"RTN","OREVNT",148,0)
 S I=LAST F I=(I+1):1 Q:'$D(^ORE(100.2,I,0))
"RTN","OREVNT",149,0)
 S DA=I,$P(HDR,U,3,4)=DA_U_(TOTAL+1),DFN=+DFN
"RTN","OREVNT",150,0)
 S ^ORE(100.2,0)=HDR L -^ORE(100.2,0)
"RTN","OREVNT",151,0)
 S X0=$G(^ORD(100.5,+$G(EVT),0)) I $P(X0,U,12) D  ;link to parent event
"RTN","OREVNT",152,0)
 . S DAD=+$P(X0,U,12),$P(X0,U,2)=$P($G(^ORD(100.5,DAD,0)),U,2)
"RTN","OREVNT",153,0)
 . S DAD=+$O(^ORE(100.2,"AE",DFN,DAD,0)) Q:DAD<1
"RTN","OREVNT",154,0)
 . S $P(^ORE(100.2,DA,1),U,5)=DAD,^ORE(100.2,"DAD",DAD,DA)=""
"RTN","OREVNT",155,0)
 S ADM=$S('$G(EVT):$G(VAIP(13)),$P(X0,U,2)="A":"",$P(X0,U,2)="T"&$$NHCU(EVT):"",1:+$G(^DPT(DFN,.105)))
"RTN","OREVNT",156,0)
 S ^ORE(100.2,"B",DFN,DA)="" S:$G(IFN) IFN=+IFN
"RTN","OREVNT",157,0)
 S ^ORE(100.2,DA,0)=DFN_U_$G(EVT)_U_ADM_U_$G(IFN)_U_+$E($$NOW^XLFDT,1,12)_U_$G(DUZ)
"RTN","OREVNT",158,0)
 S:$G(EVT) ^ORE(100.2,"E",EVT,DA)="",^ORE(100.2,"AE",DFN,EVT,DA)=""
"RTN","OREVNT",159,0)
 I $G(IFN) S ^ORE(100.2,"AO",IFN,DA)="",$P(^OR(100,IFN,0),U,17)=DA,^OR(100,"AEVNT",DFN_";DPT(",DA,IFN)=""
"RTN","OREVNT",160,0)
 Q DA
"RTN","OREVNT",161,0)
 ;
"RTN","OREVNT",162,0)
NHCU(OREVT) ; -- Returns 1 or 0, if EVT is to NHCU
"RTN","OREVNT",163,0)
 N ORI,ORX,ORY S (ORI,ORY)=0
"RTN","OREVNT",164,0)
 F  S ORI=$O(^ORD(100.5,+$G(OREVT),"TS",ORI)) Q:ORI<1  S ORX=+$G(^(ORI,0)) I $$GET1^DIQ(45.7,ORX_",","SPECIALTY:SERVICE")="NHCU" S ORY=1 Q  ;DBIA #1154
"RTN","OREVNT",165,0)
 Q ORY
"RTN","OREVNT",166,0)
 ;
"RTN","OREVNT",167,0)
DELETE(DA) ; -- Delete Patient Event
"RTN","OREVNT",168,0)
 N DIK S DIK="^ORE(100.2," D:$G(DA) ^DIK
"RTN","OREVNT",169,0)
 Q
"RTN","OREVNT",170,0)
 ;
"RTN","OREVNT",171,0)
MATCH(DFN,EVT) ; -- Does Pt's current data match selected Event?
"RTN","OREVNT",172,0)
 N X0,Y,LOC,WD,TS S X0=$G(^ORD(100.5,EVT,0)),Y=1
"RTN","OREVNT",173,0)
 I "^D^O^M^"[(U_$P(X0,U,2)_U) S Y=0 G MQ
"RTN","OREVNT",174,0)
 S LOC=$S($G(ORL):+ORL,1:+$$CURRLOC(DFN)),WD=+$G(^SC(LOC,42))
"RTN","OREVNT",175,0)
 I $$DIV^ORMEVNT(LOC)'=$P(X0,U,3) S Y=0 G MQ
"RTN","OREVNT",176,0)
 S TS=$S($G(ORTS):+ORTS,1:+$G(^DPT(DFN,.103)))
"RTN","OREVNT",177,0)
 I $O(^ORD(100.5,EVT,"TS",0)),'$D(^("B",TS)) S Y=0 G MQ
"RTN","OREVNT",178,0)
 I $O(^ORD(100.5,EVT,"LOC",0)),'$D(^("B",WD)) S Y=0 G MQ
"RTN","OREVNT",179,0)
MQ Q Y
"RTN","OREVNT",180,0)
 ;
"RTN","OREVNT",181,0)
CURRLOC(DFN) ; -- Return current Hospital Location (ptr to #44) of patient DFN
"RTN","OREVNT",182,0)
 N X,Y S X=$P($G(^DPT(DFN,.1)),U),Y=""
"RTN","OREVNT",183,0)
 I $L(X) S X=+$O(^DIC(42,"B",X,0)),Y=+$G(^DIC(42,X,44))
"RTN","OREVNT",184,0)
 Q Y
"RTN","OREVNT",185,0)
 ;
"RTN","OREVNT",186,0)
CONT() ; -- ok to continue?
"RTN","OREVNT",187,0)
 N X,Y,DIR
"RTN","OREVNT",188,0)
 S DIR("A",1)=ORPNM_" is already assigned to "_$P($G(^DIC(45.7,+$G(ORTS),0)),U)_" on "_$P($G(^SC(+$G(ORL),0)),U)_"!"
"RTN","OREVNT",189,0)
 S DIR(0)="YA",DIR("A")="Do you still want to add future orders? "
"RTN","OREVNT",190,0)
 S DIR("?")="Enter YES to add orders that will be delayed until this event occurs in the future, or NO to quit."
"RTN","OREVNT",191,0)
 S DIR("B")="NO" W ! D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","OREVNT",192,0)
 Q Y
"RTN","OREVNT1")
0^27^B43493020
"RTN","OREVNT1",1,0)
OREVNT1 ;SLC/MKB - Release delayed orders ;9/13/02  08:58
"RTN","OREVNT1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","OREVNT1",3,0)
 ;
"RTN","OREVNT1",4,0)
EN ; -- start here
"RTN","OREVNT1",5,0)
 I '$$CANREL^OREV3() W !,"Insufficient privilege!" H 1 Q
"RTN","OREVNT1",6,0)
 N ORPTLK,ORLR,ORACT,ORNATR,ORI,NMBR,IDX,ORDER,ORIFN,ORDA,ORQUIT,ORES,ORWAIT,ORSIG,OREL,ORPRNT,ORPRINT,ORCHART,ORWORK,ORLAB,OR0,ORA0,ORERR,ORCL,OREVT
"RTN","OREVNT1",7,0)
 S ORPTLK=$$LOCK^ORX2(+ORVP) I 'ORPTLK W !!,$C(7),$P(ORPTLK,U,2) H 2 Q
"RTN","OREVNT1",8,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") G:'ORNMBR ENQ
"RTN","OREVNT1",9,0)
 D FREEZE^ORCMENU S VALMBCK="R" K OREBUILD
"RTN","OREVNT1",10,0)
 S ORL=$$LOCATION^ORCMENU1 G:ORL="^" ENQ ;I '$G(ORL)
"RTN","OREVNT1",11,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0)),(ORACT,ORNATR)=""
"RTN","OREVNT1",12,0)
 I $$NEEDSIG S ORACT=$S($D(^XUSEC("ORES",DUZ)):"ES",$D(^XUSEC("OREMAS",DUZ)):"OC",$D(^XUSEC("ORELSE",DUZ)):$$SELSIG^ORCSIGN,1:"^") G:ORACT="^" ENQ
"RTN","OREVNT1",13,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) I NMBR D
"RTN","OREVNT1",14,0)
 . S IDX=$G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),ORDER=$P(IDX,U)
"RTN","OREVNT1",15,0)
 . Q:'ORDER  S:'$P(ORDER,";",2) ORDER=+ORDER_";1"
"RTN","OREVNT1",16,0)
 . S ORIFN=+ORDER,ORDA=+$P(ORDER,";",2) K ORQUIT
"RTN","OREVNT1",17,0)
 . D VALID Q:$G(ORQUIT)  S ORES(ORDER)=""
"RTN","OREVNT1",18,0)
 . S:$P($G(^OR(100,ORIFN,0)),U,14)=ORLR ORES("LAB")=1
"RTN","OREVNT1",19,0)
EN1 G:'$O(ORES(0)) ENQ K ORQUIT,ORWAIT
"RTN","OREVNT1",20,0)
 ;D ORDCHK^ORCMENU1 G:'$O(ORES(0)) ENQ0
"RTN","OREVNT1",21,0)
 ;I $G(ORQUIT) D UNLOCK G ENQ ;quit - ^ at override reason
"RTN","OREVNT1",22,0)
 S ORSIG=$S($G(ORES("ES")):2,1:""),OREL=$S(ORSIG:0,1:1)
"RTN","OREVNT1",23,0)
 I ORSIG D  I ORSIG=2,'OREL W !,"Nothing signed or released!" D UNLOCK H 2 G ENQ
"RTN","OREVNT1",24,0)
 . I ORACT="ES" S:$$ESIG^ORCSIGN ORSIG=1,OREL=1 Q
"RTN","OREVNT1",25,0)
 . I ORACT="OC" S:$$ONCHART^ORCSIGN ORSIG=0,OREL=1,ORNATR="W" Q
"RTN","OREVNT1",26,0)
 . S ORNATR=$$NATURE^ORCSIGN Q:ORNATR="^"  ;ORACT="RS"
"RTN","OREVNT1",27,0)
 . W:ORNATR'="I" !!,"A signature is required to RELEASE these orders; the responsible provider will",!,"be alerted to electronically sign them."
"RTN","OREVNT1",28,0)
 . S:$$ESIG^ORCSIGN ORSIG=$S(ORNATR="I":1,1:$$SIGSTS^ORX1(ORNATR)),OREL=1
"RTN","OREVNT1",29,0)
 S ORPRNT=$$GET^XPAR("ALL","ORPF PRINT CHART COPY WHEN")
"RTN","OREVNT1",30,0)
 S (ORPRINT,ORCHART,ORWORK,ORLAB)=0
"RTN","OREVNT1",31,0)
 I '$D(^XUSEC("ORES",DUZ))!$$GET^XPAR("ALL","ORPF SHOW LAB #") S ORLAB=ORLR ;show Lab# when released
"RTN","OREVNT1",32,0)
 W !!,"Processing orders ..." D:$G(ORES("LAB")) BHS^ORMBLD(ORVP)
"RTN","OREVNT1",33,0)
EN2 S ORDER=0 F  S ORDER=$O(ORES(ORDER)) Q:ORDER'>0  D
"RTN","OREVNT1",34,0)
 . S OR0=$G(^OR(100,+ORDER,0)),ORA0=$G(^(8,+$P(ORDER,";",2),0))
"RTN","OREVNT1",35,0)
 . N ORNP S ORNP=$P(ORA0,U,3),ORIFN=+ORDER,ORDA=+$P(ORDER,";",2)
"RTN","OREVNT1",36,0)
 . S:$G(ORL) $P(^OR(100,ORIFN,0),U,10)=ORL ;set location
"RTN","OREVNT1",37,0)
 . S:$G(ORTS) $P(^OR(100,ORIFN,0),U,13)=ORTS ;set specialty
"RTN","OREVNT1",38,0)
 . D EN2^ORCSEND(ORDER,ORSIG,ORNATR,.ORERR),UNLK1^ORX2(ORIFN)
"RTN","OREVNT1",39,0)
 . I $D(^TMP("ORNEW",$J,ORIFN,ORDA)) K ^(ORDA) D UNLK1^ORX2(ORIFN)
"RTN","OREVNT1",40,0)
 . I $G(ORERR) D  S ORWAIT=1 Q
"RTN","OREVNT1",41,0)
 . . W !!,$$ORDITEM^ORCACT(ORDER)_" "_$$STATUS^ORCSIGN(ORDER)
"RTN","OREVNT1",42,0)
 . . W:$L($P($G(ORERR),U,2)) !,"  >> "_$P(ORERR,U,2)
"RTN","OREVNT1",43,0)
 . I $P(OR0,U,14)=ORLAB,$G(^OR(100,ORIFN,4)) W !,$$ORDITEM^ORCACT(ORIFN)_"  (LB #"_+^OR(100,ORIFN,4)_")" S ORWAIT=1
"RTN","OREVNT1",44,0)
 . S ORV=+$P(OR0,U,17),OREVT(ORV)="" D SETPRINT(ORNATR)
"RTN","OREVNT1",45,0)
 . D:$$TYPE^OREVNTX(ORV)="M" SAVE^ORMEVNT1(ORIFN,ORV,2) W "."
"RTN","OREVNT1",46,0)
 D:$G(ORES("LAB")) BTS^ORMBLD(ORVP)
"RTN","OREVNT1",47,0)
EN3 I $O(ORCHART(0))!$O(ORPRINT(0)) S ORCL=$$LOC^ORMEVNT I ORCL,ORCL'=ORL D
"RTN","OREVNT1",48,0)
 . N X,Y,DIR S DIR(0)="YA",DIR("B")="YES"
"RTN","OREVNT1",49,0)
 . S DIR("A",1)="This patient's location has been changed to "_$P($G(^SC(+ORCL,0)),U)_"."
"RTN","OREVNT1",50,0)
 . S DIR("A")="Should the orders be printed using the new location? "
"RTN","OREVNT1",51,0)
 . S DIR("?")="Enter NO to continue using "_$P($G(^SC(+ORL,0)),U)_" for ordering and printing, or YES to switch to the patient's current location instead"
"RTN","OREVNT1",52,0)
 . D ^DIR S:Y ORL=ORCL
"RTN","OREVNT1",53,0)
 D:$O(ORCHART(0)) PRINT^ORPR02(ORVP,.ORCHART,,ORL,"1^0^0^0^0")
"RTN","OREVNT1",54,0)
 D:$O(ORPRINT(0)) PRINT^ORPR02(ORVP,.ORPRINT,,ORL,"0^1^1^1^0")
"RTN","OREVNT1",55,0)
 D:$O(ORWORK(0)) PRINT^ORPR02(ORVP,.ORWORK,,ORL,"0^0^0^0^1")
"RTN","OREVNT1",56,0)
ENQ0 D UNOTIF^ORCSIGN,EMPTY S OREBUILD=1
"RTN","OREVNT1",57,0)
ENQ D:'$D(^TMP("ORNEW",$J)) UNLOCK^ORX2(+ORVP) D:$G(ORWAIT) READ ;output
"RTN","OREVNT1",58,0)
 Q
"RTN","OREVNT1",59,0)
 ;
"RTN","OREVNT1",60,0)
SETPRINT(NATR) ; -- Set print arrays
"RTN","OREVNT1",61,0)
 S:'$L(NATR)!($P(ORA0,U,4)'=2) NATR=$P(ORA0,U,12)
"RTN","OREVNT1",62,0)
 S ORPRINT=ORPRINT+1,ORPRINT(ORPRINT)=ORDER
"RTN","OREVNT1",63,0)
 I ("R"[ORPRNT)!(ORPRNT="S"&($P(ORA0,U,4)=2)&(ORSIG'=2)),$$CHART^ORX1(NATR) S ORCHART=ORCHART+1,ORCHART(ORCHART)=ORDER
"RTN","OREVNT1",64,0)
 S:$$WORK(NATR) ORWORK=ORWORK+1,ORWORK(ORWORK)=ORDER
"RTN","OREVNT1",65,0)
 Q
"RTN","OREVNT1",66,0)
 ;
"RTN","OREVNT1",67,0)
WORK(NATR) ; -- Returns 1 or 0, to print work copies for NATR
"RTN","OREVNT1",68,0)
 S:$G(NATR)="" NATR="E" S:'NATR NATR=+$O(^ORD(100.02,"C",NATR,0))
"RTN","OREVNT1",69,0)
 Q +$P($G(^ORD(100.02,NATR,1)),U,5)
"RTN","OREVNT1",70,0)
 ;
"RTN","OREVNT1",71,0)
NEEDSIG()       ; -- Return 1 or 0, if any selected orders need ES
"RTN","OREVNT1",72,0)
 N ORI,NMBR,ORIFN,ORDA,Y S Y=0
"RTN","OREVNT1",73,0)
 F ORI=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",ORI) I NMBR D  Q:Y
"RTN","OREVNT1",74,0)
 . S ORIFN=$P($G(^TMP("OR",$J,ORTAB,"IDX",NMBR)),U) Q:'ORIFN
"RTN","OREVNT1",75,0)
 . S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN S:'ORDA ORDA=1
"RTN","OREVNT1",76,0)
 . S:$P($G(^OR(100,ORIFN,8,ORDA,0)),U,4)=2 ORES("ES")=1,Y=1
"RTN","OREVNT1",77,0)
 Q Y
"RTN","OREVNT1",78,0)
 ;
"RTN","OREVNT1",79,0)
VALID ; -- validate ORDER for signature/release
"RTN","OREVNT1",80,0)
 I '$$VALID^ORCACT0(ORDER,"MN",.ORERR) W !!,"Cannot release "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_ORERR S (ORQUIT,ORWAIT)=1 Q
"RTN","OREVNT1",81,0)
 I $L(ORACT),$P($G(^OR(100,ORIFN,8,ORDA,0)),U,4)=2,'$$VALID^ORCACT0(ORDER,ORACT,.ORERR,ORNATR) W !!,"Cannot sign "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_ORERR S (ORQUIT,ORWAIT)=1 Q
"RTN","OREVNT1",82,0)
 N ORLK,ORDIALOG S ORLK=$$LOCK1^ORX2(ORIFN)
"RTN","OREVNT1",83,0)
 I 'ORLK W !!,"Cannot release "_$$ORDITEM^ORCACT(ORDER),!,"  >> "_$P(ORLK,U,2) S (ORQUIT,ORWAIT)=1 Q  ;order locked
"RTN","OREVNT1",84,0)
 S ORDIALOG=+$P($G(^OR(100,ORIFN,0)),U,5)
"RTN","OREVNT1",85,0)
 I $L($G(^ORD(101.41,ORDIALOG,7))) X ^(7) D:$G(ORQUIT) UNLK1^ORX2(ORIFN)
"RTN","OREVNT1",86,0)
 Q
"RTN","OREVNT1",87,0)
 ;
"RTN","OREVNT1",88,0)
EMPTY ; -- check if no more orders for events in OREVT()
"RTN","OREVNT1",89,0)
 N EVT,X
"RTN","OREVNT1",90,0)
 S EVT=0 F  S EVT=$O(OREVT(EVT)) Q:EVT<1  D  ;terminate any events?
"RTN","OREVNT1",91,0)
 . Q:$G(^ORE(100.2,EVT,1))  Q:'$$EMPTY^OREVNTX(EVT)  ;active,empty
"RTN","OREVNT1",92,0)
 . ;W !!,$P($$NAME^OREVNTX(EVT)," ",2,99)_" has no more delayed orders."
"RTN","OREVNT1",93,0)
 . ;S DIR(0)="YA",DIR("A")="Do you want to terminate this event? "
"RTN","OREVNT1",94,0)
 . ;S DIR("?")="Enter NO if you wish to enter new delayed orders for this event, otherwise enter YES to terminate it."
"RTN","OREVNT1",95,0)
 . ;S DIR("B")="YES" D ^DIR I $D(DTOUT)!$D(DUOUT) S ORQUIT=1 Q
"RTN","OREVNT1",96,0)
 . D DONE^OREVNTX(EVT),ACTLOG^OREVNTX(EVT,"MN")
"RTN","OREVNT1",97,0)
 . S X=$P($$NAME^OREVNTX(EVT)," ",2,99)
"RTN","OREVNT1",98,0)
 . W !,"   ... "_X_" event completed." H 1
"RTN","OREVNT1",99,0)
 . D:$G(OREVENT) EX^OREVNT ;return view to Active
"RTN","OREVNT1",100,0)
 Q
"RTN","OREVNT1",101,0)
 ;
"RTN","OREVNT1",102,0)
UNLOCK ; -- Unlock orders in ORES(ORDER)
"RTN","OREVNT1",103,0)
 N ORIFN S ORIFN=0
"RTN","OREVNT1",104,0)
 F  S ORIFN=$O(ORES(ORIFN)) Q:ORIFN'>0  D UNLK1^ORX2(+ORIFN)
"RTN","OREVNT1",105,0)
 Q
"RTN","OREVNT1",106,0)
 ;
"RTN","OREVNT1",107,0)
READ ; -- Press return to continue
"RTN","OREVNT1",108,0)
 N X,Y,DIR
"RTN","OREVNT1",109,0)
 S DIR(0)="EA",DIR("A")="Press <return> to continue ..."
"RTN","OREVNT1",110,0)
 D ^DIR
"RTN","OREVNT1",111,0)
 Q
"RTN","OREVNT1",112,0)
 ;
"RTN","OREVNT1",113,0)
DONE() ; -- OREVENT done?
"RTN","OREVNT1",114,0)
 Q:'$G(^ORE(100.2,+$G(OREVENT),1)) 0  ;not done yet
"RTN","OREVNT1",115,0)
 D FULL^VALM1
"RTN","OREVNT1",116,0)
 W !!,"The event "_$$NAME^OREVNTX(OREVENT)_" has occurred since"
"RTN","OREVNT1",117,0)
 W !,"you started writing delayed orders.  The orders that were signed have now been"
"RTN","OREVNT1",118,0)
 W !,"released; any unsigned orders will be released immediately upon signature."
"RTN","OREVNT1",119,0)
 W !!,"To write new delayed orders for this event you must select the Delayed Orders"
"RTN","OREVNT1",120,0)
 W !,"action and this release event again.  Orders delayed to this same event will"
"RTN","OREVNT1",121,0)
 W !,"remain delayed until the event occurs again."
"RTN","OREVNT1",122,0)
 W !!,"The Orders tab will now be refreshed in the Active Orders view; you may then"
"RTN","OREVNT1",123,0)
 W !,"write active orders for this patient as usual."
"RTN","OREVNT1",124,0)
 D READ S XQORQUIT=1 D EX^OREVNT ;return view to Active
"RTN","OREVNT1",125,0)
 Q 1
"RTN","OREVNTX")
0^28^B72274467
"RTN","OREVNTX",1,0)
OREVNTX ; SLC/MKB - Event delayed orders RPC's ; 08 May 2002  2:12 PM
"RTN","OREVNTX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","OREVNTX",3,0)
 ;
"RTN","OREVNTX",4,0)
PAT(ORY,DFN)    ; -- Returns currently delayed events for patient DFN
"RTN","OREVNTX",5,0)
 N EVT,CNT,X,Y S DFN=+$G(DFN),(EVT,CNT)=0
"RTN","OREVNTX",6,0)
 F  S EVT=+$O(^ORE(100.2,"AE",DFN,EVT)) Q:EVT<1  S Y=+$O(^(EVT,0)) D
"RTN","OREVNTX",7,0)
 . I $G(^ORE(100.2,Y,1)) K ^ORE(100.2,"AE",DFN,EVT,Y) Q
"RTN","OREVNTX",8,0)
 . Q:$$LAPSED(Y)  ;I $$EMPTY(Y) D CANCEL(Y) Q
"RTN","OREVNTX",9,0)
 . Q:$O(^ORE(100.2,"DAD",Y,0))  ;has children
"RTN","OREVNTX",10,0)
 . S X=$P($G(^ORD(100.5,EVT,0)),U,8),X="Delayed "_$$LOWER^VALM1(X)
"RTN","OREVNTX",11,0)
 . S CNT=CNT+1,ORY(CNT)=Y_U_X
"RTN","OREVNTX",12,0)
 S:CNT ORY(0)=CNT
"RTN","OREVNTX",13,0)
 Q
"RTN","OREVNTX",14,0)
 ;
"RTN","OREVNTX",15,0)
EXISTS(DFN,EVT) ; -- Returns 1 if patient DFN has delayed orders for EVT,
"RTN","OREVNTX",16,0)
 ;    or 2 if parent/sibling event has delayed orders, else 0
"RTN","OREVNTX",17,0)
 ;
"RTN","OREVNTX",18,0)
 N X,Y,I S Y=0 I '$G(DFN)!'$G(EVT) G EXQ
"RTN","OREVNTX",19,0)
 I $O(^ORE(100.2,"AE",+DFN,+EVT,0)) S Y=1 G EXQ
"RTN","OREVNTX",20,0)
 S X=+$P($G(^ORD(100.5,+EVT,0)),U,12) I X D  G EXQ ;ck parent,siblings
"RTN","OREVNTX",21,0)
 . I $O(^ORE(100.2,"AE",+DFN,X,0)) S Y=2 Q
"RTN","OREVNTX",22,0)
 . S I=0 F  S I=+$O(^ORD(100.5,"DAD",X,I)) Q:I<1  I $O(^ORE(100.2,"AE",+DFN,I,0)) S Y=2 Q
"RTN","OREVNTX",23,0)
EXQ Q Y
"RTN","OREVNTX",24,0)
 ;
"RTN","OREVNTX",25,0)
LIST(ORY,DFN)   ; -- Returns all processed events for patient DFN as
"RTN","OREVNTX",26,0)
 ;    ORY(#) = PatEvtIEN ^ Display Text ^ EvtDateTime
"RTN","OREVNTX",27,0)
 ;             in reverse chronological order
"RTN","OREVNTX",28,0)
 N IDT,DA,CNT,X0,X1,EVT,DC,X
"RTN","OREVNTX",29,0)
 S DFN=+$G(DFN),(IDT,CNT)=0
"RTN","OREVNTX",30,0)
 F  S IDT=$O(^ORE(100.2,"AC",DFN,IDT)) Q:IDT<1  D
"RTN","OREVNTX",31,0)
 . S DA=0 F  S DA=+$O(^ORE(100.2,"AC",DFN,IDT,DA)) Q:DA<1  D
"RTN","OREVNTX",32,0)
 .. S X0=$G(^ORE(100.2,DA,0)),X1=$G(^(1)) Q:$P(X1,U,5)  ;has parent
"RTN","OREVNTX",33,0)
 .. S EVT=+$P(X0,U,2),DC=+$P(X1,U,3)
"RTN","OREVNTX",34,0)
 .. I '$P(X0,U,4),'$O(^ORE(100.2,DA,2,0)),'$O(^ORE(100.2,DA,3,0)),'$D(^OR(100,"AEVNT",DFN_";DPT(",DA)) Q  ;no orders
"RTN","OREVNTX",35,0)
 .. S I=+$O(^ORE(100.2,DA,10,"B"),-1),X=$P($G(^(I,0)),U,2) I X="LP"!(X="CA") Q  ;lapsed or cancelled
"RTN","OREVNTX",36,0)
 .. ;Q if not current admission?
"RTN","OREVNTX",37,0)
 .. S X=$S(EVT:$P($G(^ORD(100.5,EVT,0)),U,8),DC:$P($G(^ORD(100.6,DC,0)),U,5),1:"UNSPECIFIED EVENT")
"RTN","OREVNTX",38,0)
 .. S X=$$LOWER^VALM1(X),CNT=CNT+1,ORY(CNT)=DA_U_X_U_$P(X1,U)
"RTN","OREVNTX",39,0)
 S:CNT ORY(0)=CNT
"RTN","OREVNTX",40,0)
 Q
"RTN","OREVNTX",41,0)
 ;
"RTN","OREVNTX",42,0)
COMP(PTEVT) ; -- Returns 1 or 0, if PTEVT has been completed
"RTN","OREVNTX",43,0)
 N Y,I S Y=$S($G(^ORE(100.2,+$G(PTEVT),1)):1,1:0)
"RTN","OREVNTX",44,0)
 I Y S I=+$O(^ORE(100.2,+$G(PTEVT),10,0)) S:$P($G(^(I,0)),U,2)="CA" Y=0
"RTN","OREVNTX",45,0)
 Q Y
"RTN","OREVNTX",46,0)
 ;
"RTN","OREVNTX",47,0)
ACTIVE(ORY,TYPE)     ; -- Returns all active events [of TYPE] from #100.5
"RTN","OREVNTX",48,0)
 ;  where TYPE=string containing any of the codes from the TYPE field
"RTN","OREVNTX",49,0)
 N NM,IEN,CNT,X0,X S CNT=0,TYPE=$G(TYPE)
"RTN","OREVNTX",50,0)
 S NM="" F  S NM=$O(^ORD(100.5,"C",NM)) Q:NM=""  D
"RTN","OREVNTX",51,0)
 . S IEN=0 F  S IEN=+$O(^ORD(100.5,"C",NM,IEN)) Q:IEN<1  D
"RTN","OREVNTX",52,0)
 .. S X0=$G(^ORD(100.5,IEN,0)) I '$L($P(X0,U,2)) D  ;Child event
"RTN","OREVNTX",53,0)
 ... S X=$P(X0,U,12) S:X $P(X0,U,2)=$P($G(^ORD(100.5,+X,0)),U,2)
"RTN","OREVNTX",54,0)
 .. I $L(TYPE),TYPE'[$P(X0,U,2) Q
"RTN","OREVNTX",55,0)
 .. Q:$O(^ORD(100.5,"DAD",IEN,0))  ;Parent event
"RTN","OREVNTX",56,0)
 .. S CNT=CNT+1,ORY(CNT)=IEN_U_X0
"RTN","OREVNTX",57,0)
 S:CNT ORY(0)=CNT
"RTN","OREVNTX",58,0)
 Q
"RTN","OREVNTX",59,0)
 ;
"RTN","OREVNTX",60,0)
NAME(PTEVT)     ; -- Return name of Patient Event
"RTN","OREVNTX",61,0)
 N X,Y,Z S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2),Z=$G(^(1))
"RTN","OREVNTX",62,0)
 S:X Y=$P($G(^ORD(100.5,X,0)),U,8)
"RTN","OREVNTX",63,0)
 I 'X S X=+$P(Z,U,3),Y=$P($G(^ORD(100.6,X,0)),U,5)
"RTN","OREVNTX",64,0)
 S Y=$S('Z:"Delayed ",1:"")_$$LOWER^VALM1(Y)
"RTN","OREVNTX",65,0)
 Q Y
"RTN","OREVNTX",66,0)
 ;
"RTN","OREVNTX",67,0)
SHORTNM(PTEVT)  ; -- Return Short Name of Patient Event
"RTN","OREVNTX",68,0)
 ;   or first 15 characters of Event Name if unspecified
"RTN","OREVNTX",69,0)
 N X,Y,Y0 S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2) I X D
"RTN","OREVNTX",70,0)
 . S Y0=$G(^ORD(100.5,X,0)),Y=$P(Y0,U,10)
"RTN","OREVNTX",71,0)
 . S:'$L(Y) Y=$E($P(Y0,U,8),1,15)
"RTN","OREVNTX",72,0)
 I 'X S X=+$P($G(^ORE(100.2,+$G(PTEVT),1)),U,3),Y=$E($P($G(^ORD(100.6,X,0)),U,5),1,15)
"RTN","OREVNTX",73,0)
 Q Y
"RTN","OREVNTX",74,0)
 ;
"RTN","OREVNTX",75,0)
EVT(PTEVT)      ; -- Return Event ptr #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX",76,0)
 Q +$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2)
"RTN","OREVNTX",77,0)
 ;
"RTN","OREVNTX",78,0)
DC(PTEVT) ; -- Return DC Rule ptr #100.6, given PTEVT ptr #100.2
"RTN","OREVNTX",79,0)
 I $P($G(^ORE(100.2,+$G(PTEVT),1)),U,5) S PTEVT=$P(^(1),U,5) ;use parent
"RTN","OREVNTX",80,0)
 Q +$P($G(^ORE(100.2,+$G(PTEVT),1)),U,3)
"RTN","OREVNTX",81,0)
 ;
"RTN","OREVNTX",82,0)
TYPE(PTEVT)     ; -- Return Type of Patient Event (i.e. A/D/T)
"RTN","OREVNTX",83,0)
 N X,Y S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2)
"RTN","OREVNTX",84,0)
 I $P($G(^ORD(100.5,X,0)),U,12) S X=$P(^(0),U,12) ;use parent
"RTN","OREVNTX",85,0)
 S Y=$S(X:$P($G(^ORD(100.5,X,0)),U,2),1:"DC")
"RTN","OREVNTX",86,0)
 Q Y
"RTN","OREVNTX",87,0)
 ;
"RTN","OREVNTX",88,0)
DIV(PTEVT)      ; -- Return Division for PTEVT
"RTN","OREVNTX",89,0)
 N X,Y S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2)
"RTN","OREVNTX",90,0)
 I $P($G(^ORD(100.5,X,0)),U,12) S X=$P(^(0),U,12) ;use parent
"RTN","OREVNTX",91,0)
 S Y=+$P($G(^ORD(100.5,X,0)),U,3) S:Y<1 Y=+$G(DUZ(2))
"RTN","OREVNTX",92,0)
 Q Y
"RTN","OREVNTX",93,0)
 ;
"RTN","OREVNTX",94,0)
LOC(PTEVT)      ; -- Return Default Ordering Location for PTEVT
"RTN","OREVNTX",95,0)
 N X,X0,Y S X=+$P($G(^ORE(100.2,+$G(PTEVT),0)),U,2)
"RTN","OREVNTX",96,0)
 S X0=$G(^ORD(100.5,X,0)),Y=+$P(X0,U,9)_";SC("
"RTN","OREVNTX",97,0)
 I Y<1,$P(X0,U,12) S Y=+$P($G(^ORD(100.5,+$P(X0,U,12),0)),U,9)_";SC("
"RTN","OREVNTX",98,0)
 S:Y<1 Y=$G(ORL)
"RTN","OREVNTX",99,0)
 Q Y
"RTN","OREVNTX",100,0)
 ;
"RTN","OREVNTX",101,0)
EMPTY(PTEVT)    ; -- Returns 1 or 0, if PTEVT has delayed orders
"RTN","OREVNTX",102,0)
 N Y,OR0,PAT,TYPE,PSO,IFN,STS S Y=1 I '$G(PTEVT) Q Y
"RTN","OREVNTX",103,0)
 S OR0=$G(^ORE(100.2,+PTEVT,0)),PAT=+$P(OR0,U)_";DPT("
"RTN","OREVNTX",104,0)
 S TYPE=$$TYPE(PTEVT) I TYPE="D" S PSO=+$O(^DIC(9.4,"C","PSO",0))
"RTN","OREVNTX",105,0)
 S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,PTEVT,IFN)) Q:IFN<1  D  Q:'Y
"RTN","OREVNTX",106,0)
 . S STS=$P($G(^OR(100,IFN,3)),U,3) I STS=10 S Y=0 Q
"RTN","OREVNTX",107,0)
 . ;I IFN=+$P(OR0,U,4),STS=11!(STS=6) S Y=0 Q
"RTN","OREVNTX",108,0)
 . I TYPE="D",$P($G(^OR(100,IFN,0)),U,14)=PSO,STS=5!(STS=6) S Y=0 Q
"RTN","OREVNTX",109,0)
 I Y,$D(^ORE(100.2,"DAD",PTEVT)) D  ;ck child events
"RTN","OREVNTX",110,0)
 . N CHLD S CHLD=0
"RTN","OREVNTX",111,0)
 . F  S CHLD=+$O(^ORE(100.2,"DAD",PTEVT,CHLD)) Q:CHLD<1  D  Q:'Y
"RTN","OREVNTX",112,0)
 .. S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,CHLD,IFN)) Q:IFN<1  I $P($G(^OR(100,IFN,3)),U,3)=10 S Y=0 Q
"RTN","OREVNTX",113,0)
 Q Y
"RTN","OREVNTX",114,0)
 ;
"RTN","OREVNTX",115,0)
EVTORDER(ORDER) ; -- Returns 1 or 0, if ORDER is for event
"RTN","OREVNTX",116,0)
 ;    Will return 0 if action DA is included but not NW
"RTN","OREVNTX",117,0)
 N X0,X,Y S X0=$G(^OR(100,+ORDER,0)),X=+$P(ORDER,";",2),Y=0
"RTN","OREVNTX",118,0)
 I $P(X0,U,17),X'>1 D
"RTN","OREVNTX",119,0)
 . I $P($G(^ORE(100.2,+$P(X0,U,17),0)),U,4)=+ORDER S Y=1 Q
"RTN","OREVNTX",120,0)
 . S DAD=+$P($G(^ORE(100.2,+$P(X0,U,17),1)),U,5) ;has parent?
"RTN","OREVNTX",121,0)
 . I DAD,$P($G(^ORE(100.2,DAD,0)),U,4)=+ORDER S Y=1
"RTN","OREVNTX",122,0)
 Q Y
"RTN","OREVNTX",123,0)
 ;
"RTN","OREVNTX",124,0)
MANREL(ORDER)   ; -- Returns 1 or 0, if ORDER was manually released
"RTN","OREVNTX",125,0)
 N EVT,Y,RELDT,TYPE,EVTDT S Y=0
"RTN","OREVNTX",126,0)
 S EVT=+$P($G(^OR(100,+ORDER,0)),U,17),RELDT=+$P($G(^(8,1,0)),U,16)
"RTN","OREVNTX",127,0)
 G:EVT<1 MNQ G:RELDT<1 MNQ ;not delayed or released
"RTN","OREVNTX",128,0)
 I '$D(^ORE(100.2,EVT,2,+ORDER)) S Y=1 G MNQ ;not rel'd by event
"RTN","OREVNTX",129,0)
 S TYPE=$$TYPE(EVT),EVTDT=+$G(^ORE(100.2,EVT,1))
"RTN","OREVNTX",130,0)
 I TYPE="M",$$FMDIFF^XLFDT(EVTDT,RELDT,2)<300 S Y=1
"RTN","OREVNTX",131,0)
MNQ Q Y
"RTN","OREVNTX",132,0)
 ;
"RTN","OREVNTX",133,0)
CANCEL(PTEVT)   ; -- Cancel empty PTEVT, event order
"RTN","OREVNTX",134,0)
 S PTEVT=+$G(PTEVT) D DONE(PTEVT),ACTLOG(PTEVT,"CA")
"RTN","OREVNTX",135,0)
 N IFN,DAD S IFN=+$P($G(^ORE(100.2,PTEVT,0)),U,4)
"RTN","OREVNTX",136,0)
 I IFN<1 D  ;ck for parent w/event order
"RTN","OREVNTX",137,0)
 . S DAD=+$P($G(^ORE(100.2,PTEVT,1)),U,5) Q:DAD<1
"RTN","OREVNTX",138,0)
 . Q:'$G(^ORE(100.2,DAD,1))  ;parent still active
"RTN","OREVNTX",139,0)
 . S IFN=+$P($G(^ORE(100.2,DAD,0)),U,4)
"RTN","OREVNTX",140,0)
 I IFN D:'$$DCD^ORCACT2(IFN) CLRDLY^ORCACT2(IFN) ;cancel event order
"RTN","OREVNTX",141,0)
 Q
"RTN","OREVNTX",142,0)
 ;
"RTN","OREVNTX",143,0)
DONE(PTEVT,WHEN,MVT,OR)    ; -- Terminate PTEVT
"RTN","OREVNTX",144,0)
 Q:'$G(PTEVT)  Q:'$D(^ORE(100.2,PTEVT,0))
"RTN","OREVNTX",145,0)
 N X0,X1,PAT,EVT,DAD
"RTN","OREVNTX",146,0)
 S:'$G(WHEN) WHEN=+$E($$NOW^XLFDT,1,12) D D1
"RTN","OREVNTX",147,0)
 S DAD=$P(X1,U,5) I DAD,$$ALLDONE(DAD) S PTEVT=DAD D D1 Q
"RTN","OREVNTX",148,0)
 S DAD=PTEVT,PTEVT=0 ;if PTEVT=parent, terminate children too
"RTN","OREVNTX",149,0)
 F  S PTEVT=+$O(^ORE(100.2,"DAD",DAD,PTEVT)) Q:PTEVT<1  D D1
"RTN","OREVNTX",150,0)
 Q
"RTN","OREVNTX",151,0)
D1 S X0=$G(^ORE(100.2,+PTEVT,0)),X1=$G(^(1)) Q:'$L(X0)
"RTN","OREVNTX",152,0)
 S PAT=+$P(X0,U),EVT=+$P(X0,U,2) ;,ORD=+$P(X0,U,4)
"RTN","OREVNTX",153,0)
 S $P(X1,U,1,2)=WHEN_U_$G(MVT),$P(X1,U,4)=$G(OR),^ORE(100.2,PTEVT,1)=X1
"RTN","OREVNTX",154,0)
 S ^ORE(100.2,"AC",PAT,9999999-WHEN,PTEVT)=""
"RTN","OREVNTX",155,0)
 S:$G(OR) ^ORE(100.2,"ASR",OR,PTEVT)=""
"RTN","OREVNTX",156,0)
 K:EVT ^ORE(100.2,"AE",PAT,EVT,PTEVT)
"RTN","OREVNTX",157,0)
 Q
"RTN","OREVNTX",158,0)
 ;
"RTN","OREVNTX",159,0)
ALLDONE(DAD) ; -- Returns 1 or 0, if all child events are done
"RTN","OREVNTX",160,0)
 N I,Y S Y=1,I=0
"RTN","OREVNTX",161,0)
 F  S I=+$O(^ORE(100.2,"DAD",+$G(DAD),I)) Q:I<1  I '$G(^ORE(100.2,I,1)) S Y=0 Q
"RTN","OREVNTX",162,0)
 Q Y
"RTN","OREVNTX",163,0)
 ;
"RTN","OREVNTX",164,0)
CHGEVT(IFN,NEWEVT)      ; -- Change the Patient Event for order IFN to NEWEVT
"RTN","OREVNTX",165,0)
 ;    Includes adding or removing event pointer to order
"RTN","OREVNTX",166,0)
 Q:'$G(IFN)  N PAT,OLDEVT,OR3 S:$G(NEWEVT) NEWEVT=+NEWEVT
"RTN","OREVNTX",167,0)
 S PAT=$P($G(^OR(100,+IFN,0)),U,2),OLDEVT=$P($G(^(0)),U,17),OR3=$G(^(3))
"RTN","OREVNTX",168,0)
 Q:OLDEVT=NEWEVT  K:OLDEVT ^OR(100,"AEVNT",PAT,OLDEVT,+IFN)
"RTN","OREVNTX",169,0)
 S $P(^OR(100,+IFN,0),U,17)=NEWEVT S:NEWEVT ^OR(100,"AEVNT",PAT,NEWEVT,+IFN)=""
"RTN","OREVNTX",170,0)
 I NEWEVT,$P(OR3,U,3)'=10 S $P(^OR(100,+IFN,3),U,3)=10,$P(^(8,1,0),U,15)=10
"RTN","OREVNTX",171,0)
 I 'NEWEVT,$P(OR3,U,3)=10 S $P(^OR(100,+IFN,3),U,3)=11,$P(^(8,1,0),U,15)=11 D SET^ORDD100(+IFN,1)
"RTN","OREVNTX",172,0)
 Q
"RTN","OREVNTX",173,0)
 ;
"RTN","OREVNTX",174,0)
ACTLOG(PTEVT,ACTION,EVTYPE,SAVE)  ; -- Log a note for ACTION on PTEVT
"RTN","OREVNTX",175,0)
 ;    SAVE => new data in VAIP() will be saved
"RTN","OREVNTX",176,0)
 Q:'$G(PTEVT)  Q:'$D(^ORE(100.2,PTEVT,0))  Q:'$L($G(ACTION))
"RTN","OREVNTX",177,0)
 N I,HDR,LAST,TOTAL,DA,ORNOW,MVT
"RTN","OREVNTX",178,0)
 F I=1:1:10 L +^ORE(100.2,PTEVT,10,0):1 Q:$T  H 2
"RTN","OREVNTX",179,0)
 Q:'$T "^" S HDR=$G(^ORE(100.2,PTEVT,10,0)) S:'$L(HDR) HDR="^100.25DA^^"
"RTN","OREVNTX",180,0)
 S TOTAL=+$P(HDR,U,4),LAST=+$O(^ORE(100.2,PTEVT,10,"B"),-1)
"RTN","OREVNTX",181,0)
 S I=LAST F I=(I+1):1 Q:'$D(^ORE(100.2,PTEVT,10,I,0))
"RTN","OREVNTX",182,0)
 S DA=I,$P(HDR,U,3,4)=DA_U_(TOTAL+1)
"RTN","OREVNTX",183,0)
 S ^ORE(100.2,PTEVT,10,0)=HDR L -^ORE(100.2,PTEVT,10,0)
"RTN","OREVNTX",184,0)
 S ORNOW=+$$NOW^XLFDT,^ORE(100.2,PTEVT,10,"B",ORNOW,DA)=""
"RTN","OREVNTX",185,0)
 S ^ORE(100.2,PTEVT,10,DA,0)=ORNOW_U_ACTION_U_$S(ACTION="LP":"",1:$G(DUZ))_U_$G(EVTYPE)
"RTN","OREVNTX",186,0)
 S MVT=+$P($G(^ORE(100.2,PTEVT,1)),U,2)
"RTN","OREVNTX",187,0)
 S:MVT ^ORE(100.2,"ADT",MVT,ORNOW,PTEVT,DA)=""
"RTN","OREVNTX",188,0)
 I $G(SAVE),$G(VAIP(4)) S $P(^ORE(100.2,PTEVT,10,DA,0),U,5,7)=+VAIP(4)_U_+VAIP(8)_U_+VAIP(5)
"RTN","OREVNTX",189,0)
 Q
"RTN","OREVNTX",190,0)
 ;
"RTN","OREVNTX",191,0)
LAPSED(PTEVT)   ; -- Ck if PTEVT has lapsed, if so lapse all orders
"RTN","OREVNTX",192,0)
 N Y,X0,EVT,ENTERED,DAYS S Y=0
"RTN","OREVNTX",193,0)
 I $G(^ORE(100.2,PTEVT,1)) G LPQ ;already terminated
"RTN","OREVNTX",194,0)
 S X0=$G(^ORE(100.2,PTEVT,0)),EVT=+$P(X0,U,2),ENTERED=+$P(X0,U,5)
"RTN","OREVNTX",195,0)
 S:$P($G(^ORD(100.5,EVT,0)),U,12) EVT=+$P(^(0),U,12) ;parent
"RTN","OREVNTX",196,0)
 S DAYS=+$P($G(^ORD(100.5,EVT,0)),U,6) I DAYS<1 G LPQ ;doesn't lapse
"RTN","OREVNTX",197,0)
 I ENTERED>$$FMADD^XLFDT(DT,(0-DAYS)) G LPQ ;not lapsed yet
"RTN","OREVNTX",198,0)
 D LP1(PTEVT) S Y=1 ;lapse orders, event
"RTN","OREVNTX",199,0)
LPQ Q Y
"RTN","OREVNTX",200,0)
 ;
"RTN","OREVNTX",201,0)
LP1(PTEVT) ; -- Lapse orders, event PTEVT
"RTN","OREVNTX",202,0)
 N X0,PAT,IFN,STS
"RTN","OREVNTX",203,0)
 S X0=$G(^ORE(100.2,PTEVT,0)),PAT=+$P(X0,U)_";DPT("
"RTN","OREVNTX",204,0)
 S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,PTEVT,IFN)) Q:IFN<1  D
"RTN","OREVNTX",205,0)
 . S STS=$P($G(^OR(100,IFN,3)),U,3) I (STS=10)!(STS=11)!(IFN=+$P(X0,U,4)) D
"RTN","OREVNTX",206,0)
 .. D STATUS^ORCSAVE2(IFN,14)
"RTN","OREVNTX",207,0)
 .. S $P(^OR(100,IFN,8,1,0),U,15)="" D:$P(^(0),U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,1)
"RTN","OREVNTX",208,0)
 D DONE(PTEVT),ACTLOG(PTEVT,"LP")
"RTN","OREVNTX",209,0)
 Q
"RTN","OREVNTX1")
0^29^B75426379
"RTN","OREVNTX1",1,0)
OREVNTX1 ; SLC/JLI - Event delayed orders RPC's ;9/19/02  13:35
"RTN","OREVNTX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","OREVNTX1",3,0)
 ;
"RTN","OREVNTX1",4,0)
PUTEVNT(ORY,DFN,EVT,ORIFN) ; Save new patient delayed events to file 100.2
"RTN","OREVNTX1",5,0)
 ;DFN:   PATIENT DFN
"RTN","OREVNTX1",6,0)
 ;EVT:   POINTER TO 100.5
"RTN","OREVNTX1",7,0)
 ;ORIFN: ORDER'S IFN
"RTN","OREVNTX1",8,0)
 S ORY=$$NEW^OREVNT(DFN,EVT,ORIFN)
"RTN","OREVNTX1",9,0)
 Q
"RTN","OREVNTX1",10,0)
 ;
"RTN","OREVNTX1",11,0)
GTEVT(ORY,PTEVT) ; Return Event infomation based on PTEVT ptr #100.2
"RTN","OREVNTX1",12,0)
 ;EVTID     ptr #100.5
"RTN","OREVNTX1",13,0)
 ;EVTTYPE   "A;T;D"
"RTN","OREVNTX1",14,0)
 ;EVTNAME   #100.5
"RTN","OREVNTX1",15,0)
 Q:'+PTEVT
"RTN","OREVNTX1",16,0)
 N EVTID,EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",17,0)
 S (EVTTYPE,EVTNAME,EVTDISP,PRTEVT)=""
"RTN","OREVNTX1",18,0)
 S EVTDLG=0
"RTN","OREVNTX1",19,0)
 I '$P(^ORE(100.2,+$G(PTEVT),0),U,2) Q
"RTN","OREVNTX1",20,0)
 S EVTID=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",21,0)
 S PRTEVT=$P(^ORD(100.5,EVTID,0),U,12)
"RTN","OREVNTX1",22,0)
 I PRTEVT S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",23,0)
 E  S EVTTYPE=$P(^ORD(100.5,EVTID,0),U,2)
"RTN","OREVNTX1",24,0)
 I $D(^ORD(100.5,EVTID,0)) D
"RTN","OREVNTX1",25,0)
 . S EVTNAME=$P(^ORD(100.5,EVTID,0),U,1)
"RTN","OREVNTX1",26,0)
 . S EVTDISP=$P(^ORD(100.5,EVTID,0),U,8)
"RTN","OREVNTX1",27,0)
 . S EVTDLG=$P(^ORD(100.5,EVTID,0),U,4)
"RTN","OREVNTX1",28,0)
 S ORY=EVTTYPE_U_EVTID_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",29,0)
 Q
"RTN","OREVNTX1",30,0)
GTEVT1(ORY,EVT) ; Return Event information based on EVT ptr #100.5
"RTN","OREVNTX1",31,0)
 ;EVT    ptr #100.5
"RTN","OREVNTX1",32,0)
 Q:'+EVT
"RTN","OREVNTX1",33,0)
 N EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",34,0)
 S (EVTDLG,PRTEVT)=0
"RTN","OREVNTX1",35,0)
 S PRTEVT=$P(^ORD(100.5,+EVT,0),U,12)
"RTN","OREVNTX1",36,0)
 I PRTEVT>0 S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",37,0)
 E  S EVTTYPE=$P(^ORD(100.5,+EVT,0),U,2)
"RTN","OREVNTX1",38,0)
 S EVTNAME=$P($G(^ORD(100.5,+EVT,0)),U,1)
"RTN","OREVNTX1",39,0)
 S EVTDISP=$P($G(^ORD(100.5,+EVT,0)),U,8)
"RTN","OREVNTX1",40,0)
 S EVTDLG=$P($G(^ORD(100.5,+EVT,0)),U,4)
"RTN","OREVNTX1",41,0)
 S ORY=EVTTYPE_U_EVT_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",42,0)
 Q
"RTN","OREVNTX1",43,0)
 ;
"RTN","OREVNTX1",44,0)
EVT(ORY,PTEVT) ; Return Event ptr #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",45,0)
 Q:'+PTEVT
"RTN","OREVNTX1",46,0)
 S ORY=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",47,0)
 Q
"RTN","OREVNTX1",48,0)
 ; 
"RTN","OREVNTX1",49,0)
EXISTS(ORY,DFN,EVT) ;Returns PtEvtID ptr #100.2 if patient already has delayed orders
"RTN","OREVNTX1",50,0)
 ;                for event EVT, else 0
"RTN","OREVNTX1",51,0)
 ;DFN: Patient DFN
"RTN","OREVNTX1",52,0)
 ;EVT: Ptr to #100.5
"RTN","OREVNTX1",53,0)
 I '+EVT S ORY=0 Q
"RTN","OREVNTX1",54,0)
 N PTEVT S (PTEVT,ORY)=0
"RTN","OREVNTX1",55,0)
 S PTEVT=$O(^ORE(100.2,"AE",+DFN,+EVT,PTEVT))
"RTN","OREVNTX1",56,0)
 I PTEVT>0 S ORY=PTEVT
"RTN","OREVNTX1",57,0)
 Q
"RTN","OREVNTX1",58,0)
 ;
"RTN","OREVNTX1",59,0)
TYPEXT(ORY,DFN,EVT) ; does EVT has delayed orders?
"RTN","OREVNTX1",60,0)
 ; 1 if Patient DFN has delayed orders for EVT
"RTN","OREVNTX1",61,0)
 ; 2 if Parent/Sibling event has delayed orders
"RTN","OREVNTX1",62,0)
 ; 0 if No delayed orders for EVT
"RTN","OREVNTX1",63,0)
 Q:'+EVT
"RTN","OREVNTX1",64,0)
 S ORY=$$EXISTS^OREVNTX(DFN,EVT)
"RTN","OREVNTX1",65,0)
 Q
"RTN","OREVNTX1",66,0)
 ;
"RTN","OREVNTX1",67,0)
MATCH(ORY,DFN,EVT) ;If Pt's current data match selected event
"RTN","OREVNTX1",68,0)
 ;DFN: patient DFN
"RTN","OREVNTX1",69,0)
 ;EVT: ptr to #100.5
"RTN","OREVNTX1",70,0)
 S ORY=0
"RTN","OREVNTX1",71,0)
 Q:('+DFN)!('+EVT)
"RTN","OREVNTX1",72,0)
 S ORY=$$MATCH^OREVNT(DFN,EVT)
"RTN","OREVNTX1",73,0)
 N TS,TSNM
"RTN","OREVNTX1",74,0)
 S TS=$S($G(ORTS):+ORTS,1:+$G(^DPT(DFN,.103)))
"RTN","OREVNTX1",75,0)
 S TSNM=$P($G(^DIC(45.7,TS,0)),U)
"RTN","OREVNTX1",76,0)
 S:ORY ORY=ORY_U_TSNM
"RTN","OREVNTX1",77,0)
 Q
"RTN","OREVNTX1",78,0)
 ;
"RTN","OREVNTX1",79,0)
NAME(ORY,PTEVT) ; Return Event name from #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",80,0)
 I PTEVT'>0 S ORY="" Q
"RTN","OREVNTX1",81,0)
 S ORY=$$NAME^OREVNTX(PTEVT)
"RTN","OREVNTX1",82,0)
 Q
"RTN","OREVNTX1",83,0)
 ;
"RTN","OREVNTX1",84,0)
DIV(ORY,PTEVT) ; Return division for PTEVT ptr #100.2
"RTN","OREVNTX1",85,0)
 Q:'+PTEVT
"RTN","OREVNTX1",86,0)
 S ORY=$$DIV^OREVNTX(PTEVT)
"RTN","OREVNTX1",87,0)
 Q
"RTN","OREVNTX1",88,0)
 ;
"RTN","OREVNTX1",89,0)
DIV1(ORY,EVT) ; Return division for EVT ptr #100.5
"RTN","OREVNTX1",90,0)
 Q:'+EVT
"RTN","OREVNTX1",91,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,3) S:ORY<1 ORY=+$G(DUZ(2))
"RTN","OREVNTX1",92,0)
 Q
"RTN","OREVNTX1",93,0)
 ;
"RTN","OREVNTX1",94,0)
LOC(ORY,PTEVT) ; Return default hospital location ^SC( for PTEVT ptr #100.2
"RTN","OREVNTX1",95,0)
 Q:'+PTEVT
"RTN","OREVNTX1",96,0)
 S ORY=$$LOC^OREVNTX(PTEVT)
"RTN","OREVNTX1",97,0)
 S ORY=+ORY
"RTN","OREVNTX1",98,0)
 Q
"RTN","OREVNTX1",99,0)
 ;
"RTN","OREVNTX1",100,0)
LOC1(ORY,EVT) ; Return default hospital location ^SC( for EVT ptr #100.5
"RTN","OREVNTX1",101,0)
 Q:'+EVT
"RTN","OREVNTX1",102,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,9) S:ORY<1 ORY=+$G(ORL)
"RTN","OREVNTX1",103,0)
 Q
"RTN","OREVNTX1",104,0)
 ;
"RTN","OREVNTX1",105,0)
CHGEVT(ORY,NEWEVT,ORIDS) ; Change order's event
"RTN","OREVNTX1",106,0)
 N ORI
"RTN","OREVNTX1",107,0)
 S ORI=0
"RTN","OREVNTX1",108,0)
 F  S ORI=$O(ORIDS(ORI)) Q:'+ORI  D
"RTN","OREVNTX1",109,0)
 . D CHGEVT^OREVNTX(+$G(ORIDS(ORI)),NEWEVT)
"RTN","OREVNTX1",110,0)
 Q
"RTN","OREVNTX1",111,0)
 ;
"RTN","OREVNTX1",112,0)
EMPTY(ORY,PTEVT) ; Return 1 if PTEVT doesn't have any orders
"RTN","OREVNTX1",113,0)
 Q:'+PTEVT
"RTN","OREVNTX1",114,0)
 S ORY=$$EMPTY^OREVNTX(PTEVT)
"RTN","OREVNTX1",115,0)
 Q
"RTN","OREVNTX1",116,0)
 ;
"RTN","OREVNTX1",117,0)
DELPTEVT(ORY,PTEVT) ; Delete Patient Event in #100.2
"RTN","OREVNTX1",118,0)
 Q:'+PTEVT
"RTN","OREVNTX1",119,0)
 D CANCEL^OREVNTX(PTEVT)
"RTN","OREVNTX1",120,0)
 ;D DONE^OREVNTX(PTEVT),ACTLOG^OREVNTX(PTEVT,"CA")
"RTN","OREVNTX1",121,0)
 ;N ORD S ORD=+$P($G(^ORE(100.2,PTEVT,0)),U,4)
"RTN","OREVNTX1",122,0)
 ;D:'$$DCD^ORCACT2(ORD) CLRDLY^ORCACT2(ORD) ;cancel event order
"RTN","OREVNTX1",123,0)
 Q
"RTN","OREVNTX1",124,0)
 ;
"RTN","OREVNTX1",125,0)
UPDTOR(ORY,PTIFN,ORIFN,PTEVT) ; If delayed order was DCed, then update the EVENT and "AEVNT"
"RTN","OREVNTX1",126,0)
 ;                                       cross reference fields to empty
"RTN","OREVNTX1",127,0)
 Q  ;Don't ever need to do this!
"RTN","OREVNTX1",128,0)
CURSPE(ORY,PTIFN) ; Return current treating specialty
"RTN","OREVNTX1",129,0)
 Q:'PTIFN
"RTN","OREVNTX1",130,0)
 N SPCID
"RTN","OREVNTX1",131,0)
 I $D(^DPT(PTIFN,.103)) D
"RTN","OREVNTX1",132,0)
 . S SPCID=$G(^DPT(PTIFN,.103))
"RTN","OREVNTX1",133,0)
 . S:SPCID ORY=$P($G(^DIC(45.7,SPCID,0)),U)_U_SPCID
"RTN","OREVNTX1",134,0)
 Q
"RTN","OREVNTX1",135,0)
DFLTEVT(ORY,PVIFN) ; Return default release event based on provider IFN
"RTN","OREVNTX1",136,0)
 N CMEVTLST,IDX
"RTN","OREVNTX1",137,0)
 S CMEVTLST="",IDX=0
"RTN","OREVNTX1",138,0)
 D GETLST^OREV3(.CMEVTLST)
"RTN","OREVNTX1",139,0)
 F  S IDX=$O(CMEVTLST(IDX)) Q:'IDX  D
"RTN","OREVNTX1",140,0)
 . I $P($G(CMEVTLST(IDX)),U,2) S ORY=$P($G(CMEVTLST(IDX)),U) Q
"RTN","OREVNTX1",141,0)
 Q
"RTN","OREVNTX1",142,0)
CMEVTS(ORY,PVIFN) ;Return common event list
"RTN","OREVNTX1",143,0)
 N IDX,X0,X
"RTN","OREVNTX1",144,0)
 S IDX=0
"RTN","OREVNTX1",145,0)
 S ORY=""
"RTN","OREVNTX1",146,0)
 D GETLST^OREV3(.ORY)
"RTN","OREVNTX1",147,0)
 F  S IDX=$O(ORY(IDX)) Q:'IDX  D
"RTN","OREVNTX1",148,0)
 . S X0=""
"RTN","OREVNTX1",149,0)
 . S:$L($G(^ORD(100.5,+ORY(IDX),0))) X0=$G(^(0))
"RTN","OREVNTX1",150,0)
 . I '$L($P(X0,U,2)) D
"RTN","OREVNTX1",151,0)
 .. S X=$P(X0,U,12) S:X $P(X0,U,2)=$P($G(^ORD(100.5,+X,0)),U,2)
"RTN","OREVNTX1",152,0)
 . S:$L(X0) ORY(IDX)=+ORY(IDX)_U_X0
"RTN","OREVNTX1",153,0)
 Q
"RTN","OREVNTX1",154,0)
 ;
"RTN","OREVNTX1",155,0)
DELDFLT(ORY,PVIFN) ; Delete default release event
"RTN","OREVNTX1",156,0)
 Q:'PVIFN
"RTN","OREVNTX1",157,0)
 N ORERR
"RTN","OREVNTX1",158,0)
 S ORERR=""
"RTN","OREVNTX1",159,0)
 D DEL^XPAR(PVIFN_";VA(200,","OREVNT DEFAULT",1,.ORERR)
"RTN","OREVNTX1",160,0)
 Q
"RTN","OREVNTX1",161,0)
WRLSTED(LST,LOC,EVTID) ; Return list of dialogs for writing event delayed orders
"RTN","OREVNTX1",162,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","OREVNTX1",163,0)
WRLST1 N ANENT
"RTN","OREVNTX1",164,0)
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
"RTN","OREVNTX1",165,0)
 S ANENT="ALL^USR.`"_DUZ_"^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","OREVNTX1",166,0)
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
"RTN","OREVNTX1",167,0)
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS EVENT LIST",EVTID,"I") Q:'MNU
"RTN","OREVNTX1",168,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
"RTN","OREVNTX1",169,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
"RTN","OREVNTX1",170,0)
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
"RTN","OREVNTX1",171,0)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
"RTN","OREVNTX1",172,0)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
"RTN","OREVNTX1",173,0)
 . . S:'$L(TXT) TXT=$P(X,U,2)
"RTN","OREVNTX1",174,0)
 . . I TYP="M" S:'FID FID=1001
"RTN","OREVNTX1",175,0)
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","OREVNTX1",176,0)
 Q
"RTN","OREVNTX1",177,0)
 ;
"RTN","OREVNTX1",178,0)
GETDLG(LST,DLGID) ; Return dialog infomation based on the DLGID
"RTN","OREVNTX1",179,0)
 N DIEN,DFID,DTXT,DTYP,DGRP,X0,X5
"RTN","OREVNTX1",180,0)
 S DLGID=+DLGID
"RTN","OREVNTX1",181,0)
 Q:'DLGID
"RTN","OREVNTX1",182,0)
 S X0=^ORD(101.41,DLGID,0),X5=$G(^(5))
"RTN","OREVNTX1",183,0)
 S DGRP=+$P(X0,U,5),DFID=+$P(X5,U,5),DTXT=$P(X5,U,4),DTYP=$P(X0,U,4)
"RTN","OREVNTX1",184,0)
    S:'$L(DTXT) DTXT=$P(X0,U,2)
"RTN","OREVNTX1",185,0)
 I $P(X0,U,4)="M" S:'DFID DFID=1001
"RTN","OREVNTX1",186,0)
 S LST=DLGID_";"_DFID_";"_DGRP_";"_DTYP_U_DTXT
"RTN","OREVNTX1",187,0)
 Q
"RTN","OREVNTX1",188,0)
DONE(LST,PTEVT) ; Terminate PTEvt
"RTN","OREVNTX1",189,0)
 Q:'PTEVT
"RTN","OREVNTX1",190,0)
 D DONE^OREVNTX(PTEVT)
"RTN","OREVNTX1",191,0)
 D ACTLOG^OREVNTX(PTEVT,"MN")
"RTN","OREVNTX1",192,0)
 Q
"RTN","OREVNTX1",193,0)
SETDFLT(ORY,EVT) ;Set personal default event
"RTN","OREVNTX1",194,0)
 N ERR,VAL S ERR=""
"RTN","OREVNTX1",195,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",196,0)
 S VAL=$P(^ORD(100.5,EVT,0),U)
"RTN","OREVNTX1",197,0)
 W !,"DUZ="_DUZ_" VAL="_VAL
"RTN","OREVNTX1",198,0)
 D EN^XPAR(DUZ_";VA(200,","OREVNT DEFAULT",1,VAL,ERR)
"RTN","OREVNTX1",199,0)
 S ORY=ERR
"RTN","OREVNTX1",200,0)
 Q
"RTN","OREVNTX1",201,0)
CPACT(ORY,EVT) ; Return True/False to display active orders for copy
"RTN","OREVNTX1",202,0)
 ; EVT ptr to #100.5
"RTN","OREVNTX1",203,0)
 Q:'EVT
"RTN","OREVNTX1",204,0)
 S ORY=0
"RTN","OREVNTX1",205,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",206,0)
 S ORY=$P(^ORD(100.5,EVT,0),U,11)
"RTN","OREVNTX1",207,0)
 Q
"RTN","OREVNTX1",208,0)
PRMPTID(ORY,PRTNM) ;Return event prompt IEN for OR GTX EVENT
"RTN","OREVNTX1",209,0)
 S:$D(^ORD(101.41,"B","OR GTX EVENT")) ORY=$O(^("OR GTX EVENT",0))
"RTN","OREVNTX1",210,0)
 Q
"RTN","OREVNTX1",211,0)
ISDCOD(ORY,ORIFN) ;True: the order need to be filtered out
"RTN","OREVNTX1",212,0)
 N PAS,X3,X0,ORGRPLST,THEGRP,IDX,ODGRP
"RTN","OREVNTX1",213,0)
 S (ORY,IDX)=0
"RTN","OREVNTX1",214,0)
 Q:'$D(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",215,0)
 S X0=$G(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",216,0)
 S ODGRP=$P(X0,U,11)
"RTN","OREVNTX1",217,0)
 D GETLST^XPAR(.ORGRPLST,"ALL","OREVNT EXCLUDE DGRP")
"RTN","OREVNTX1",218,0)
 F  S IDX=$O(ORGRPLST(IDX)) Q:'IDX!ORY  D
"RTN","OREVNTX1",219,0)
 . S THEGRP=$P($G(ORGRPLST(IDX)),U,2)
"RTN","OREVNTX1",220,0)
 . I $$GRPCHK(THEGRP,ODGRP) S ORY=1
"RTN","OREVNTX1",221,0)
 I ORY Q
"RTN","OREVNTX1",222,0)
 S PAS=";1;"
"RTN","OREVNTX1",223,0)
 S:$D(^OR(100,+ORIFN,3)) X3=^OR(100,+ORIFN,3)
"RTN","OREVNTX1",224,0)
 S:(PAS'[(";"_$P(X3,U,3)_";")) ORY=0
"RTN","OREVNTX1",225,0)
 Q
"RTN","OREVNTX1",226,0)
DEFLTS(ORY,EVTID) ;Return default specialty for EVTID(#100.5)
"RTN","OREVNTX1",227,0)
 Q:'+EVTID
"RTN","OREVNTX1",228,0)
 N PRTEVT
"RTN","OREVNTX1",229,0)
 S PRTEVT=0
"RTN","OREVNTX1",230,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",231,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",232,0)
 S ORY=$$DEFTS^ORCDADT(EVTID)
"RTN","OREVNTX1",233,0)
 Q
"RTN","OREVNTX1",234,0)
 ;
"RTN","OREVNTX1",235,0)
MULTS(ORY,EVTID) ;Return specialty list for the EVTID(#100.5)
"RTN","OREVNTX1",236,0)
 Q:'+EVTID
"RTN","OREVNTX1",237,0)
 N I,CNT,X,Y S (I,CNT)=0
"RTN","OREVNTX1",238,0)
 N PRTEVT
"RTN","OREVNTX1",239,0)
 S PRTEVT=0
"RTN","OREVNTX1",240,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",241,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",242,0)
 F  S I=$O(^ORD(100.5,+$G(EVTID),"TS",I)) Q:I<1  S X=+$G(^(I,0)) D
"RTN","OREVNTX1",243,0)
 . S Y=$$GET1^DIQ(45.7,X_",",.01)
"RTN","OREVNTX1",244,0)
 . S CNT=CNT+1,ORY(CNT)=X_U_Y
"RTN","OREVNTX1",245,0)
 Q
"RTN","OREVNTX1",246,0)
 ;
"RTN","OREVNTX1",247,0)
PRTIDS(ORY,IDS) ;Return some prompt ids from #101.41
"RTN","OREVNTX1",248,0)
 ; treating specialty Id^attending provider id
"RTN","OREVNTX1",249,0)
 N IDX,ORTS,ORATT
"RTN","OREVNTX1",250,0)
 S (ORY,ORTS,ORATT)=""
"RTN","OREVNTX1",251,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX TREATING SPECIALTY",0))
"RTN","OREVNTX1",252,0)
 S:$D(^ORD(101.41,IDX,1)) ORTS=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",253,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX PROVIDER",0))
"RTN","OREVNTX1",254,0)
 S:$D(^ORD(101.41,IDX,1)) ORATT=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",255,0)
 S ORY=ORTS_"~"_ORATT
"RTN","OREVNTX1",256,0)
 Q
"RTN","OREVNTX1",257,0)
 ;
"RTN","OREVNTX1",258,0)
DFLTDLG(ORY,EVTID) ;Return event default dialog IEN
"RTN","OREVNTX1",259,0)
 S ORY=0
"RTN","OREVNTX1",260,0)
 Q:'$D(^ORD(100.5,+EVTID,0))
"RTN","OREVNTX1",261,0)
 S ORY=$P(^ORD(100.5,+EVTID,0),U,4)
"RTN","OREVNTX1",262,0)
 Q
"RTN","OREVNTX1",263,0)
AUTHMREL(ORY,USER) ;1: user can manual release delayed orders 0: can't
"RTN","OREVNTX1",264,0)
 S ORY=$$CANREL^OREV3
"RTN","OREVNTX1",265,0)
 Q
"RTN","OREVNTX1",266,0)
HAVEPRT(ORY,PTEVT) ;return parent patient event from #100.2
"RTN","OREVNTX1",267,0)
 Q:'+PTEVT
"RTN","OREVNTX1",268,0)
 S ORY=""
"RTN","OREVNTX1",269,0)
 S:$L($G(^ORE(100.2,PTEVT,1))) ORY=$P(^(1),U,5)
"RTN","OREVNTX1",270,0)
 Q
"RTN","OREVNTX1",271,0)
GRPCHK(DG,AGRP) ;If an order's group belong to DG group
"RTN","OREVNTX1",272,0)
 N RST
"RTN","OREVNTX1",273,0)
 S RST=0
"RTN","OREVNTX1",274,0)
 N ORGRP
"RTN","OREVNTX1",275,0)
 D GRP^ORQ1(DG)
"RTN","OREVNTX1",276,0)
 S RST=$S($D(ORGRP(AGRP)):1,1:0)
"RTN","OREVNTX1",277,0)
 Q RST
"RTN","OREVNTX1",278,0)
ODPTEVID(ORY,ORID) ;Return PtEvtID based on the ORID
"RTN","OREVNTX1",279,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",280,0)
 S ORY=$P($G(^OR(100,+ORID,0)),U,17)
"RTN","OREVNTX1",281,0)
 Q
"RTN","OREVNTX1",282,0)
COMP(ORY,PTEVT) ;Return 1 or 0 if PTEVT completed or not
"RTN","OREVNTX1",283,0)
 Q:'+PTEVT
"RTN","OREVNTX1",284,0)
 S ORY=$$COMP^OREVNTX(+PTEVT)
"RTN","OREVNTX1",285,0)
 Q
"RTN","OREVNTX1",286,0)
ISHDORD(ORY,ORID) ;Return 1 if it's on-hold med order
"RTN","OREVNTX1",287,0)
 Q:'+ORID
"RTN","OREVNTX1",288,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",289,0)
 N STS,HDSTS,ODGP,INPT,OUPT,MEDS,IVMD
"RTN","OREVNTX1",290,0)
 S HDSTS=$O(^ORD(100.01,"B","HOLD",0))
"RTN","OREVNTX1",291,0)
 S STS=$P($G(^OR(100,+ORID,3)),U,3)
"RTN","OREVNTX1",292,0)
 S INPT=$O(^ORD(100.98,"B","UD RX",0))
"RTN","OREVNTX1",293,0)
 S OUPT=$O(^ORD(100.98,"B","O RX",0))
"RTN","OREVNTX1",294,0)
 S MEDS=$O(^ORD(100.98,"B","RX",0))
"RTN","OREVNTX1",295,0)
 S IVMD=$O(^ORD(100.98,"B","IV RX",0))
"RTN","OREVNTX1",296,0)
 S ODGP=$P(^OR(100,+ORID,0),U,11)
"RTN","OREVNTX1",297,0)
 I (U_INPT_U_OUPT_U_MEDS_U_IVMD_U[U_ODGP_U),(HDSTS=STS) S ORY=1
"RTN","OREVNTX1",298,0)
 Q
"RTN","OREVNTX1",299,0)
ISPASS(ORY,PTEVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",300,0)
 S ORY=$$EVT^OREVNTX(PTEVTID)
"RTN","OREVNTX1",301,0)
 S ORY=$P($G(^ORD(100.5,+ORY,0)),U,7)
"RTN","OREVNTX1",302,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",303,0)
 E  S ORY=0
"RTN","OREVNTX1",304,0)
 Q
"RTN","OREVNTX1",305,0)
ISPASS1(ORY,EVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",306,0)
 S ORY=$P($G(^ORD(100.5,+EVTID,0)),U,7)
"RTN","OREVNTX1",307,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",308,0)
 E  S ORY=0
"RTN","OREVNTX1",309,0)
 Q
"RTN","OREVNTX1",310,0)
DLGIEN(ORY,DLGNAME) ;Retrun Order Dialog IEN based on name
"RTN","OREVNTX1",311,0)
 Q:'$D(^ORD(101.41,"B",DLGNAME))
"RTN","OREVNTX1",312,0)
 S ORY=$O(^ORD(101.41,"B",DLGNAME,0))
"RTN","OREVNTX1",313,0)
 Q
"RTN","ORKPS")
0^83^B68668942
"RTN","ORKPS",1,0)
ORKPS ; slc/CLA - Order checking support procedures for medications ;12/15/97
"RTN","ORKPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,74,94,123,141**;Dec 17, 1997
"RTN","ORKPS",3,0)
 Q
"RTN","ORKPS",4,0)
CHECK(YY,DFN,MED,OI,ORKDG) ; return drug order checks: drug-drug interactions,
"RTN","ORKPS",5,0)
 ; duplicate drug, duplicate class
"RTN","ORKPS",6,0)
 ;YY:    returned array of data
"RTN","ORKPS",7,0)
 ;DFN:   patient id
"RTN","ORKPS",8,0)
 ;MED:   drug ien [file #50]
"RTN","ORKPS",9,0)
 ;OI:    orderable item ien [file #101.43
"RTN","ORKPS",10,0)
 ;ORKDG: display group (should be PSI, PSIV or PSO)
"RTN","ORKPS",11,0)
 ; returned info: varies for ^TMP($J x-ref - refer to listings below
"RTN","ORKPS",12,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC")
"RTN","ORKPS",13,0)
 N ORDFN S ORDFN=DFN
"RTN","ORKPS",14,0)
 D EN^PSOORDRG(DFN,MED)
"RTN","ORKPS",15,0)
 D PROCESS(OI,ORDFN,ORKDG)
"RTN","ORKPS",16,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC")
"RTN","ORKPS",17,0)
 Q
"RTN","ORKPS",18,0)
CHKSESS(YY,DFN,MED,OI,ORKPDATA,ORKDG) ; return drug order checks for a session
"RTN","ORKPS",19,0)
 N ORKDGI,ORKDRUG,ORKDRUGA,ORKORN,HOR,SEQ,CNT,CNTX,ORKOI
"RTN","ORKPS",20,0)
 N ORKFLG,ORSESS,ORPSPKG,ORPSA,ORKDD,ORSNUM,ORNUM
"RTN","ORKPS",21,0)
 N ORDFN S ORDFN=DFN
"RTN","ORKPS",22,0)
 S ORKFLG=0
"RTN","ORKPS",23,0)
 S ORNUM=$P(ORKA,"|",5)
"RTN","ORKPS",24,0)
 ;
"RTN","ORKPS",25,0)
 ;get other med orders in current session:
"RTN","ORKPS",26,0)
 I $D(^TMP("ORKA",$J)) D
"RTN","ORKPS",27,0)
 .S CNT=^TMP("ORKA",$J) F CNTX=1:1:CNT D
"RTN","ORKPS",28,0)
 ..S ORSESS=$G(^TMP("ORKA",$J,CNTX))
"RTN","ORKPS",29,0)
 ..Q:'$L(ORSESS)
"RTN","ORKPS",30,0)
 ..S ORPSPKG=$P(ORSESS,"|",2)
"RTN","ORKPS",31,0)
 ..Q:'$L(ORPSPKG)
"RTN","ORKPS",32,0)
 ..Q:$E(ORPSPKG,1,2)'="PS"
"RTN","ORKPS",33,0)
 ..S ORSNUM=$P(ORSESS,"|",5)
"RTN","ORKPS",34,0)
 ..S ORKOI=$P(ORSESS,"|")
"RTN","ORKPS",35,0)
 ..;quit if same order/oi (IV additives have same order num but diff ois)
"RTN","ORKPS",36,0)
 ..Q:((+$G(ORNUM)=+$G(ORSNUM))&(+$G(OI)=+$G(ORKOI)))
"RTN","ORKPS",37,0)
 ..S:ORPSPKG="PSJ" ORPSPKG="PSI"
"RTN","ORKPS",38,0)
 ..S ORKDRUG=$P($P(ORSESS,"|",3),U,4)
"RTN","ORKPS",39,0)
 ..;
"RTN","ORKPS",40,0)
 ..;if no disp drug selected get disp drug(s) from OI (ORKOI)
"RTN","ORKPS",41,0)
 ..I +$G(ORKDRUG)<1,$L(ORKOI) D
"RTN","ORKPS",42,0)
 ...I "IO"[$E(ORPSPKG,3) D OI2DD(.ORPSA,ORKOI,$E(ORPSPKG,3)) D
"RTN","ORKPS",43,0)
 ....S ORKDD=0 F  S ORKDD=$O(ORPSA(ORKDD)) Q:'ORKDD  D
"RTN","ORKPS",44,0)
 .....S ORKDRUG=+ORKDD
"RTN","ORKPS",45,0)
 .....S:+$G(ORKDRUG)>0 ORKDRUGA(ORKDRUG_";"_ORPSPKG)=ORSNUM
"RTN","ORKPS",46,0)
 ...K ORPSA  ;need to clean out between calls to OI2DD
"RTN","ORKPS",47,0)
 ..;
"RTN","ORKPS",48,0)
 ..Q:+$G(ORKDRUG)<1
"RTN","ORKPS",49,0)
 ..;if dispense drug selected add it to the array:
"RTN","ORKPS",50,0)
 ..S ORKDRUGA(ORKDRUG_";"_ORPSPKG)=ORSNUM
"RTN","ORKPS",51,0)
 ..;I (+$G(ORKOI)'=OI)!(ORKFLG=1) S ORKDRUGA(ORKDRUG)=""
"RTN","ORKPS",52,0)
 ..;I +$G(ORKDRUG)=MED S ORKFLG=1  ;MED has been processed once
"RTN","ORKPS",53,0)
 ;
"RTN","ORKPS",54,0)
 ;get all unsigned medication orders:
"RTN","ORKPS",55,0)
 S HOR=0,SEQ=0
"RTN","ORKPS",56,0)
 S HOR=$O(^TMP("ORR",$J,HOR)) I +$G(HOR)>0 D
"RTN","ORKPS",57,0)
 .F  S SEQ=$O(^TMP("ORR",$J,HOR,SEQ)) Q:+SEQ<1  D
"RTN","ORKPS",58,0)
 ..S ORKORN=+$P(^TMP("ORR",$J,HOR,SEQ),U)
"RTN","ORKPS",59,0)
 ..Q:+$G(ORKORN)<1
"RTN","ORKPS",60,0)
 ..Q:+ORKORN=+ORNUM
"RTN","ORKPS",61,0)
 ..Q:$P(^OR(100,+ORKORN,8,$P(^OR(100,+ORKORN,8,0),U,3),0),U,2)="DC"
"RTN","ORKPS",62,0)
 ..S ORKDRUG=$$VALUE^ORCSAVE2(+ORKORN,"DRUG") ;get disp drug for order
"RTN","ORKPS",63,0)
 ..;only process against unsigned med order if disp drug is assoc w/order:
"RTN","ORKPS",64,0)
 ..Q:+$G(ORKDRUG)<1
"RTN","ORKPS",65,0)
 ..S ORPSPKG=$$DGRX^ORQOR2(+ORKORN)
"RTN","ORKPS",66,0)
 ..S ORPSPKG=$S(ORPSPKG="UNIT DOSE MEDICATIONS":"PSI",ORPSPKG="OUTPATIENT MEDICATIONS":"PSO",ORPSPKG="IV MEDICATIONS":"PSIV",1:"")
"RTN","ORKPS",67,0)
 ..Q:$D(ORKDRUGA(+ORKDRUG_";"_ORPSPKG))  ;quit if already processed drug
"RTN","ORKPS",68,0)
 ..S ORKDRUGA(+ORKDRUG_";"_ORPSPKG)=ORKORN
"RTN","ORKPS",69,0)
 ;
"RTN","ORKPS",70,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC")
"RTN","ORKPS",71,0)
 ;S MED=MED_";"_ORKDG
"RTN","ORKPS",72,0)
 I $D(ORKDRUGA) D DRGCHK^PSOORDRG(DFN,MED,.ORKDRUGA)
"RTN","ORKPS",73,0)
 D PROCESS(OI,ORDFN,ORKDG)
"RTN","ORKPS",74,0)
 K ^TMP($J,"DI"),^TMP($J,"DD"),^TMP($J,"DC")
"RTN","ORKPS",75,0)
 Q
"RTN","ORKPS",76,0)
PROCESS(OI,DFN,ORKDG) ;process data returned from pharmacy order check API
"RTN","ORKPS",77,0)
 Q:'$D(^TMP($J))
"RTN","ORKPS",78,0)
 N II,XX,ZZ,ZZD,ORTYPE,ORMTYPE,ORN,ORZ
"RTN","ORKPS",79,0)
 S II=1,XX=0,ZZ="",ZZD=""
"RTN","ORKPS",80,0)
 ;
"RTN","ORKPS",81,0)
 ;check to determine if inpatient or outpatient:
"RTN","ORKPS",82,0)
 I $L(ORKDG) S ORTYPE=$S($G(ORKDG)="PSI":"I",$G(ORKDG)="PSO":"O",$G(ORKDG)="PSIV":"I",1:"")
"RTN","ORKPS",83,0)
 I '$L(ORTYPE) D  ;if no display group
"RTN","ORKPS",84,0)
 .D ADM^VADPT2
"RTN","ORKPS",85,0)
 .S ORTYPE=$S(+$G(VADMVT)>0:"I",1:"O")
"RTN","ORKPS",86,0)
 .K VADMVT
"RTN","ORKPS",87,0)
 ;
"RTN","ORKPS",88,0)
 ; drug-drug interactions:
"RTN","ORKPS",89,0)
 F  S XX=$O(^TMP($J,"DI",XX)) Q:XX<1  D
"RTN","ORKPS",90,0)
 .S ZZ=$G(^TMP($J,"DI",XX,0))
"RTN","ORKPS",91,0)
 .S ORN=$P($P(ZZ,U,7),";"),ORZ=""
"RTN","ORKPS",92,0)
 .I $L(ORN),$D(^OR(100,ORN,8,0)) S ORZ=^OR(100,ORN,8,0)
"RTN","ORKPS",93,0)
 .I $L($G(ORZ)),($P(^OR(100,ORN,8,$P(ORZ,U,3),0),U,2)="DC") Q
"RTN","ORKPS",94,0)
 .I ZZ'="" S YY(II)="DI^"_ZZ,II=II+1
"RTN","ORKPS",95,0)
 ;
"RTN","ORKPS",96,0)
 ; duplicate drugs:
"RTN","ORKPS",97,0)
 Q:$$SOLUT(OI)  ;quit if the orderable item is a solution (RX EP specs
"RTN","ORKPS",98,0)
 ;require that we do not perform dup drug/class OCs for solutions)
"RTN","ORKPS",99,0)
 S XX=0,ZZ=""
"RTN","ORKPS",100,0)
 F  S XX=$O(^TMP($J,"DD",XX)) Q:XX<1  D
"RTN","ORKPS",101,0)
 .S ZZ=$G(^TMP($J,"DD",XX,0)),ORMTYPE=$P($P(ZZ,U,4),";",2)
"RTN","ORKPS",102,0)
 .Q:$G(ORTYPE)'=$G(ORMTYPE)  ;QUIT if med type isn't order or pt type
"RTN","ORKPS",103,0)
 .S ORN=$P($P(ZZ,U,3),";"),ORZ=""
"RTN","ORKPS",104,0)
 .Q:+$G(ORN)=+$G(ORIFN)  ;QUIT if dup med ord # = current ord #
"RTN","ORKPS",105,0)
 .I $L(ORN),$D(^OR(100,ORN,8,0)) S ORZ=^OR(100,ORN,8,0)
"RTN","ORKPS",106,0)
 .I $L($G(ORZ)),($P(^OR(100,ORN,8,$P(ORZ,U,3),0),U,2)="DC") Q
"RTN","ORKPS",107,0)
 .I ZZ'="" S YY(II)="DD^"_ZZ,II=II+1
"RTN","ORKPS",108,0)
 ;
"RTN","ORKPS",109,0)
 ; duplicate classes:
"RTN","ORKPS",110,0)
 Q:$$SUPPLY(OI)  ;quit if the orderable item is a supply
"RTN","ORKPS",111,0)
 S XX=0,ZZ=""
"RTN","ORKPS",112,0)
 F  S XX=$O(^TMP($J,"DC",XX)) Q:XX<1  D
"RTN","ORKPS",113,0)
 .S ZZ=$G(^TMP($J,"DC",XX,0)),ORMTYPE=$P($P(ZZ,U,6),";",2)
"RTN","ORKPS",114,0)
 .Q:$G(ORTYPE)'=$G(ORMTYPE)  ;QUIT if med type isn't order or pt type
"RTN","ORKPS",115,0)
 .S ORN=$P($P(ZZ,U,5),";"),ORZ=""
"RTN","ORKPS",116,0)
 .Q:+$G(ORN)=+$G(ORIFN)  ;QUIT if dup class ord # = current ord #
"RTN","ORKPS",117,0)
 .I $L(ORN),$D(^OR(100,ORN,8,0)) S ORZ=^OR(100,ORN,8,0)
"RTN","ORKPS",118,0)
 .I $L($G(ORZ)),($P(^OR(100,ORN,8,$P(ORZ,U,3),0),U,2)="DC") Q
"RTN","ORKPS",119,0)
 .I ZZ'="" S YY(II)="DC^"_ZZ,II=II+1
"RTN","ORKPS",120,0)
 Q
"RTN","ORKPS",121,0)
TAKEMED(ORKDFN,ORKMED) ;extrinsic function returns med orderable item if any
"RTN","ORKPS",122,0)
 ;active med patient is taking contains any piece of ORKMED
"RTN","ORKPS",123,0)
 ;ORKDFN   patient DFN
"RTN","ORKPS",124,0)
 ;ORKMED   meds to check vs. active med list in format MED1^MED2^MED3...
"RTN","ORKPS",125,0)
 Q:'$L($G(ORKDFN)) "0^Patient not identified."
"RTN","ORKPS",126,0)
 Q:'$L($G(ORKMED)) "0^Medication not identified."
"RTN","ORKPS",127,0)
 N ORKARX,ORKY,ORI,ORJ,ORCNT,ORKMEDP,ORKRSLT
"RTN","ORKPS",128,0)
 D LIST^ORQQPS(.ORKY,ORKDFN,"","")
"RTN","ORKPS",129,0)
 Q:$P(ORKY(1),U)="" "0^No active meds found."
"RTN","ORKPS",130,0)
 S ORKRSLT="0^No matching meds found."
"RTN","ORKPS",131,0)
 S ORCNT=$L(ORKMED,U)
"RTN","ORKPS",132,0)
 S ORI=0 F  S ORI=$O(ORKY(ORI)) Q:ORI<1  D
"RTN","ORKPS",133,0)
 .S ORKARX=$P(ORKY(ORI),U,2)
"RTN","ORKPS",134,0)
 .F ORJ=1:1:ORCNT S ORKMEDP=$P(ORKMED,U,ORJ) D
"RTN","ORKPS",135,0)
 ..I $L(ORKMEDP),(ORKARX[ORKMEDP) S ORKRSLT="1^"_ORKARX
"RTN","ORKPS",136,0)
 Q ORKRSLT
"RTN","ORKPS",137,0)
SOLUT(OI) ;extrinsic function returns 1 (true) if the orderable item is
"RTN","ORKPS",138,0)
 ; a solution (IV Base)
"RTN","ORKPS",139,0)
 Q:+$G(OI)<1 ""
"RTN","ORKPS",140,0)
 N OITEXT
"RTN","ORKPS",141,0)
 S OITEXT=$G(^ORD(101.43,OI,0))
"RTN","ORKPS",142,0)
 Q:'$L(OITEXT) ""
"RTN","ORKPS",143,0)
 S OITEXT=$P(OITEXT,U)
"RTN","ORKPS",144,0)
 Q:$D(^ORD(101.43,"S.IVB RX",OITEXT)) 1
"RTN","ORKPS",145,0)
 Q ""
"RTN","ORKPS",146,0)
POLYRX(DFN) ;extrins funct rtns 1 if patient exceeds polypharmacy, 0 if not
"RTN","ORKPS",147,0)
 N ORSLT,ORENT,ORLOC,ORPAR,ORMEDS
"RTN","ORKPS",148,0)
 S ORSLT=0
"RTN","ORKPS",149,0)
 Q:'$L(DFN) ORSLT
"RTN","ORKPS",150,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","ORKPS",151,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","ORKPS",152,0)
 S VA200="" D OERR^VADPT
"RTN","ORKPS",153,0)
 S ORLOC=+$G(^DIC(42,+VAIN(4),44))
"RTN","ORKPS",154,0)
 K VA200,VAIN
"RTN","ORKPS",155,0)
 S ORENT=+$G(ORLOC)_";SC(^DIV^SYS^PKG"
"RTN","ORKPS",156,0)
 S ORPAR=$$GET^XPAR(ORENT,"ORK POLYPHARMACY",1,"I")
"RTN","ORKPS",157,0)
 S ORMEDS=$$NUMRX(DFN)
"RTN","ORKPS",158,0)
 I $G(ORMEDS)>$G(ORPAR) S ORSLT=1
"RTN","ORKPS",159,0)
 Q ORSLT
"RTN","ORKPS",160,0)
GLCREAT(DFN) ;extrinsic function returns patient's (DFN) most recent serum
"RTN","ORKPS",161,0)
 ; creatinine within # of days from parameter ORK GLUCOPHAGE CREATININE
"RTN","ORKPS",162,0)
 ; results format: test id^result units flag ref range collect d/t^result
"RTN","ORKPS",163,0)
 ; used by order check GLUCOPHAGE-LAB RESULTS
"RTN","ORKPS",164,0)
 N ORLOC,ORPAR,ORDAYS
"RTN","ORKPS",165,0)
 N BDT,CDT,ORY,ORX,ORZ,TEST,ORI,ORJ,CREARSLT,LABFILE,SPECFILE,SPECIMEN
"RTN","ORKPS",166,0)
 Q:'$L(DFN) "0^"
"RTN","ORKPS",167,0)
 S ORDAYS=$$GCDAYS(DFN)
"RTN","ORKPS",168,0)
 Q:'$L(ORDAYS) "0^"
"RTN","ORKPS",169,0)
 D NOW^%DTC
"RTN","ORKPS",170,0)
 S BDT=$$FMADD^XLFDT(%,"-"_ORDAYS,"","","")
"RTN","ORKPS",171,0)
 K %
"RTN","ORKPS",172,0)
 Q:'$L($G(BDT)) "0^"
"RTN","ORKPS",173,0)
 S LABFILE=$$TERMLKUP^ORB31(.ORY,"SERUM CREATININE")
"RTN","ORKPS",174,0)
 Q:'$D(ORY) "0^" ;no link between SERUM CREATININE and local lab test
"RTN","ORKPS",175,0)
 Q:$G(LABFILE)'=60 "0^"
"RTN","ORKPS",176,0)
 S SPECFILE=$$TERMLKUP^ORB31(.ORX,"SERUM SPECIMEN")
"RTN","ORKPS",177,0)
 Q:'$D(ORX) "0^" ;no link between SERUM SPECIMEN and local specimen
"RTN","ORKPS",178,0)
 Q:$G(SPECFILE)'=61 "0^"
"RTN","ORKPS",179,0)
 F ORI=1:1:ORY I +$G(CREARSLT)<1 D
"RTN","ORKPS",180,0)
 .S TEST=$P(ORY(ORI),U)
"RTN","ORKPS",181,0)
 .Q:+$G(TEST)<1
"RTN","ORKPS",182,0)
 .F ORJ=1:1:ORX I +$G(CREARSLT)<1 D
"RTN","ORKPS",183,0)
 ..S SPECIMEN=$P(ORX(ORJ),U)
"RTN","ORKPS",184,0)
 ..Q:+$G(SPECIMEN)<1
"RTN","ORKPS",185,0)
 ..S ORZ=$$LOCL^ORQQLR1(DFN,TEST,SPECIMEN)
"RTN","ORKPS",186,0)
 ..Q:'$L($G(ORZ))
"RTN","ORKPS",187,0)
 ..S CDT=$P(ORZ,U,7)
"RTN","ORKPS",188,0)
 ..I CDT'<BDT S CREARSLT=1
"RTN","ORKPS",189,0)
 Q:+$G(CREARSLT)<1 "0^"
"RTN","ORKPS",190,0)
 Q $P(ORZ,U)_U_$P(ORZ,U,3)_" "_$P(ORZ,U,4)_" "_$P(ORZ,U,5)_" ("_$P(ORZ,U,6)_")  "_$$FMTE^XLFDT(CDT,"2P")_U_$P(ORZ,U,3)
"RTN","ORKPS",191,0)
GCDAYS(DFN) ;extrinsic function to return number of days to look for 
"RTN","ORKPS",192,0)
 ; glucophage serum creatinine result
"RTN","ORKPS",193,0)
 Q:'$L(DFN) ""
"RTN","ORKPS",194,0)
 N ORLOC,ORENT,ORDAYS
"RTN","ORKPS",195,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","ORKPS",196,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","ORKPS",197,0)
 S VA200="" D OERR^VADPT
"RTN","ORKPS",198,0)
 S ORLOC=+$G(^DIC(42,+VAIN(4),44))
"RTN","ORKPS",199,0)
 K VA200,VAIN
"RTN","ORKPS",200,0)
 S ORENT=+$G(ORLOC)_";SC(^DIV^SYS^PKG"
"RTN","ORKPS",201,0)
 S ORDAYS=$$GET^XPAR(ORENT,"ORK GLUCOPHAGE CREATININE",1,"I")
"RTN","ORKPS",202,0)
 Q:$L(ORDAYS) ORDAYS
"RTN","ORKPS",203,0)
 Q ""
"RTN","ORKPS",204,0)
SUPPLY(OI) ;extrinsic function returns 1 (true) if the orderable item is
"RTN","ORKPS",205,0)
 ; a supply
"RTN","ORKPS",206,0)
 Q:+$G(OI)<1 ""
"RTN","ORKPS",207,0)
 N OITEXT
"RTN","ORKPS",208,0)
 S OITEXT=$G(^ORD(101.43,OI,0))
"RTN","ORKPS",209,0)
 Q:'$L(OITEXT) ""
"RTN","ORKPS",210,0)
 S OITEXT=$P(OITEXT,U)
"RTN","ORKPS",211,0)
 Q:$D(^ORD(101.43,"S.SPLY",OITEXT)) 1
"RTN","ORKPS",212,0)
 Q ""
"RTN","ORKPS",213,0)
NUMRX(DFN) ;extrinsic funct returns number of active meds patient is taking
"RTN","ORKPS",214,0)
 N NUMRX,ORPTYPE,ORX,ORY,ORS,ORNUM,ORPRENEW
"RTN","ORKPS",215,0)
 S NUMRX=0
"RTN","ORKPS",216,0)
 Q:+$G(DFN)<1 NUMRX
"RTN","ORKPS",217,0)
 ;
"RTN","ORKPS",218,0)
 ;check to determine if inpatient or outpatient:
"RTN","ORKPS",219,0)
 D ADM^VADPT2
"RTN","ORKPS",220,0)
 S ORPTYPE=$S(+$G(VADMVT)>0:"I",1:"O")
"RTN","ORKPS",221,0)
 ;
"RTN","ORKPS",222,0)
 K ^TMP("PS",$J)
"RTN","ORKPS",223,0)
 D OCL^PSOORRL(DFN,"","")  ;if no date range, returns active meds for pt
"RTN","ORKPS",224,0)
 N X
"RTN","ORKPS",225,0)
 S X=0
"RTN","ORKPS",226,0)
 F  S X=$O(^TMP("PS",$J,X)) Q:X<1  D
"RTN","ORKPS",227,0)
 .S ORX=$G(^TMP("PS",$J,X,0))
"RTN","ORKPS",228,0)
 .S ORY=$P(ORX,U)
"RTN","ORKPS",229,0)
 .S ORNUM=$P(ORX,U,8) ;order entry order number
"RTN","ORKPS",230,0)
 .S ORS=$P(ORX,U,9) ;medication status from pharmacy
"RTN","ORKPS",231,0)
 .S ORPRENEW=$P(ORX,U,14)  ;pending renewal flag (1: pending renewal)
"RTN","ORKPS",232,0)
 .Q:+ORX<1
"RTN","ORKPS",233,0)
 .Q:$P(ORY,";",2)'=ORPTYPE  ;quit if med is not pt type (inpt/outpt)
"RTN","ORKPS",234,0)
 .;quit if status is a non-active type:
"RTN","ORKPS",235,0)
 .Q:$G(ORS)="EXPIRED"
"RTN","ORKPS",236,0)
 .Q:$G(ORS)["DISCONTINUE"
"RTN","ORKPS",237,0)
 .Q:$G(ORS)="DELETED"
"RTN","ORKPS",238,0)
 .Q:+$G(ORPRENEW)>0
"RTN","ORKPS",239,0)
 .Q:$$SUPPLY($$OI^ORQOR2(ORNUM))=1  ;quit if a supply
"RTN","ORKPS",240,0)
 .S NUMRX=NUMRX+1
"RTN","ORKPS",241,0)
 K ^TMP("PS",$J)
"RTN","ORKPS",242,0)
 Q NUMRX
"RTN","ORKPS",243,0)
OI2DD(ORPSA,OROI,ORPSPKG)       ;rtn dispense drugs for a PS OI
"RTN","ORKPS",244,0)
 N PSOI
"RTN","ORKPS",245,0)
 Q:'$D(^ORD(101.43,OROI,0))
"RTN","ORKPS",246,0)
 S PSOI=$P($P(^ORD(101.43,OROI,0),U,2),";")
"RTN","ORKPS",247,0)
 Q:+$G(PSOI)<1
"RTN","ORKPS",248,0)
 D DRG^PSSUTIL1(.ORPSA,PSOI,ORPSPKG)
"RTN","ORKPS",249,0)
 Q
"RTN","ORM")
0^89^B17067461
"RTN","ORM",1,0)
ORM ; SLC/MKB - ORM msg router ;11/17/00  10:58 [9/16/02 3:02pm]
"RTN","ORM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,97,141**;Dec 17, 1997
"RTN","ORM",3,0)
EN(MSG) ; -- main entry point for OR RECEIVE where MSG contains HL7 msg
"RTN","ORM",4,0)
 N ORMSG,ORNMSP,ORTYPE,MSH,PID,PV1,ORC,ORVP,ORTS,ORL,ORCAT
"RTN","ORM",5,0)
 S ORMSG=$S($L($G(MSG)):MSG,1:"MSG") ; MSG="NAME" or MSG(#)=message
"RTN","ORM",6,0)
 I '$O(@ORMSG@(0)) D EN^ORERR("Missing HL7 message",.ORMSG) Q
"RTN","ORM",7,0)
 S MSH=0 F  S MSH=$O(@ORMSG@(MSH)) Q:MSH'>0  Q:$E(@ORMSG@(MSH),1,3)="MSH"
"RTN","ORM",8,0)
 I 'MSH D EN^ORERR("Missing or invalid MSH segment",.ORMSG) Q
"RTN","ORM",9,0)
 S ORNMSP=$$NMSP($P(@ORMSG@(MSH),"|",3)),ORTYPE=$P(@ORMSG@(MSH),"|",9)
"RTN","ORM",10,0)
 I '$L(ORNMSP) D EN^ORERR("Missing or invalid sending application",.ORMSG) Q
"RTN","ORM",11,0)
 D PID I '$G(ORVP) D EN^ORERR("Missing or invalid patient ID",.ORMSG) Q
"RTN","ORM",12,0)
 D PV1 S ORC=PID
"RTN","ORM",13,0)
EN1 F  S ORC=$O(@ORMSG@(+ORC)) Q:ORC'>0  I $E(@ORMSG@(ORC),1,3)="ORC" D
"RTN","ORM",14,0)
 . N ORDCNTRL,ORDSTS,PKGIFN,ORIFN,ORNP,ORTN,ORERR,ORLOG,ORDUZ,ORQT,ORSTRT,ORSTOP,ORURG,ORNATR,OREASON
"RTN","ORM",15,0)
 . S ORC=ORC_U_@ORMSG@(ORC),ORDCNTRL=$TR($P(ORC,"|",2),"@","P")
"RTN","ORM",16,0)
 . I '$L(ORDCNTRL) S ORERR="Invalid control code" D ERROR Q
"RTN","ORM",17,0)
 . S ORIFN=$P($P(ORC,"|",3),U),PKGIFN=$P($P(ORC,"|",4),U)
"RTN","ORM",18,0)
 . I ORIFN,$D(^OR(100,+ORIFN,0)),$P(^(0),U,2)'=ORVP S ORERR="Patient doesn't match" D ERROR Q
"RTN","ORM",19,0)
 . S ORDSTS=$P(ORC,"|",6),ORQT=$P(ORC,"|",8)
"RTN","ORM",20,0)
 . S ORSTRT=$$FMDATE($P(ORQT,U,4)),ORSTOP=$$FMDATE($P(ORQT,U,5))
"RTN","ORM",21,0)
 . S ORURG=$$URGENCY($P(ORQT,U,6)),ORLOG=$$FMDATE($P(ORC,"|",10))
"RTN","ORM",22,0)
 . S ORDUZ=+$P(ORC,"|",11),ORNP=+$P(ORC,"|",13),OREASON=$P(ORC,"|",17)
"RTN","ORM",23,0)
 . S ORNATR=$S($P(OREASON,U,3)="99ORN":$P(OREASON,U),1:"")
"RTN","ORM",24,0)
 . S ORTN="EN^ORM"_ORNMSP D @ORTN I $D(ORERR) D ERROR Q
"RTN","ORM",25,0)
 . I ORDCNTRL="SN",$G(ORIFN) D MSG^ORMBLD(ORIFN,"NA")
"RTN","ORM",26,0)
 . I $G(DGPMT),ORDCNTRL="OD"!(ORDCNTRL="OC") D XTMP
"RTN","ORM",27,0)
 Q
"RTN","ORM",28,0)
 ;
"RTN","ORM",29,0)
NMSP(NAME) ; -- Returns pkg namespace
"RTN","ORM",30,0)
 I NAME="RADIOLOGY"!(NAME="IMAGING") Q "RA"
"RTN","ORM",31,0)
 I NAME="LABORATORY" Q "LR"
"RTN","ORM",32,0)
 I NAME="DIETETICS" Q "FH"
"RTN","ORM",33,0)
 I NAME="PHARMACY" Q "PS"
"RTN","ORM",34,0)
 I NAME="CONSULTS" Q "GMRC"
"RTN","ORM",35,0)
 I NAME="PROCEDURES" Q "GMRC"
"RTN","ORM",36,0)
 I NAME="ORDER ENTRY" Q "ORG"
"RTN","ORM",37,0)
 Q ""
"RTN","ORM",38,0)
 ;
"RTN","ORM",39,0)
PID ; -- Returns patient from PID segment in current msg
"RTN","ORM",40,0)
 ;    Sets PID, ORVP, ORTS if valid patient
"RTN","ORM",41,0)
 N I,DFN,SEG S I=MSH,PID=""
"RTN","ORM",42,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="PID" D  Q
"RTN","ORM",43,0)
 . S DFN=+$P(@ORMSG@(I),"|",4),PID=I
"RTN","ORM",44,0)
 . I $D(^DPT(DFN,0)) S ORVP=DFN_";DPT(",ORTS=$G(^DPT(DFN,.103)) Q
"RTN","ORM",45,0)
 . S:$L($P(@ORMSG@(I),"|",5)) ORVP=$P(@ORMSG@(I),"|",5) ; alt ID for Lab
"RTN","ORM",46,0)
 Q
"RTN","ORM",47,0)
 ;
"RTN","ORM",48,0)
PV1 ; -- Returns patient location in PV1 segment in current msg
"RTN","ORM",49,0)
 ;    Sets PV1, ORCAT, & ORL if valid location
"RTN","ORM",50,0)
 N I,X,SEG S I=PID,PV1=""
"RTN","ORM",51,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="PV1" D  Q
"RTN","ORM",52,0)
 . S X=+$P(@ORMSG@(I),"|",4),ORCAT=$P(@ORMSG@(I),"|",3),PV1=I
"RTN","ORM",53,0)
 . S:$D(^SC(X,0)) ORL=X_";SC("
"RTN","ORM",54,0)
 Q
"RTN","ORM",55,0)
 ;
"RTN","ORM",56,0)
ORDITEM(USID) ; -- Returns pointer to Orderable Item file for USID
"RTN","ORM",57,0)
 N ID,OI
"RTN","ORM",58,0)
 S ID=$P(USID,U,4)_";"_$P(USID,U,6)
"RTN","ORM",59,0)
 S OI=+$O(^ORD(101.43,"ID",ID,0))
"RTN","ORM",60,0)
 Q OI
"RTN","ORM",61,0)
 ;
"RTN","ORM",62,0)
URGENCY(CODE) ; -- Return ptr to Order Urgency file #101.42
"RTN","ORM",63,0)
 S:'$L(CODE) CODE="R"
"RTN","ORM",64,0)
 Q $O(^ORD(101.42,"C",CODE,0))
"RTN","ORM",65,0)
 ;
"RTN","ORM",66,0)
FMDATE(Y) ; -- Convert HL7 date/time to FM format
"RTN","ORM",67,0)
 Q $$HL7TFM^XLFDT(Y)  ;**97
"RTN","ORM",68,0)
 ;
"RTN","ORM",69,0)
ERROR ; -- Sends a DE reply to current msg
"RTN","ORM",70,0)
 ; Uses ORVP, ORNMSP, ORDUZ, ORIFN, ORERR, and PKGIFN
"RTN","ORM",71,0)
 N ORV S ORV("XQY0")="" D EN^ORERR(ORERR,.ORMSG,.ORV)
"RTN","ORM",72,0)
 Q:ORTYPE="ORR"  Q:'$L($G(ORNMSP))
"RTN","ORM",73,0)
 N OREMSG,ORVP,ORTS S:'$G(ORDUZ) ORDUZ=DUZ D:'$G(ORVP) PID
"RTN","ORM",74,0)
 S OREMSG(1)=$$MSH^ORMBLD("ORR",ORNMSP),OREMSG(2)=$$PID^ORMBLD($G(ORVP))
"RTN","ORM",75,0)
 S OREMSG(3)="ORC|DE|"_$S($G(ORIFN):ORIFN_"^OR",1:"")_"|"_$S($L($G(PKGIFN)):PKGIFN_U_ORNMSP,1:"")_"|||||||"_ORDUZ_"||||||"_ORERR
"RTN","ORM",76,0)
 D MSG^XQOR("OR EVSEND "_ORNMSP,.OREMSG)
"RTN","ORM",77,0)
 Q
"RTN","ORM",78,0)
 ;
"RTN","ORM",79,0)
FIND(SEG,PIECE) ; -- Returns value in $P(@ORMSG@(SEG),"|",PIECE)
"RTN","ORM",80,0)
 N X,Y,FLDS,I,DONE
"RTN","ORM",81,0)
 S X=$G(@ORMSG@(SEG)),FLDS=$L(X,"|"),Y="",(I,DONE)=0
"RTN","ORM",82,0)
 F  D  Q:DONE
"RTN","ORM",83,0)
 . I PIECE<FLDS S Y=$P(X,"|",PIECE),DONE=1 Q
"RTN","ORM",84,0)
 . I PIECE=FLDS D  Q
"RTN","ORM",85,0)
 . . S Y=$P(X,"|",PIECE),I=$O(@ORMSG@(SEG,I)),DONE=1
"RTN","ORM",86,0)
 . . I I S Y=Y_$P($G(@ORMSG@(SEG,I)),"|")
"RTN","ORM",87,0)
 . S I=$O(@ORMSG@(SEG,I)) I 'I S Y="",DONE=1 Q
"RTN","ORM",88,0)
 . S PIECE=PIECE-(FLDS-1),X=$G(@ORMSG@(SEG,I)),FLDS=$L(X,"|")
"RTN","ORM",89,0)
FQ Q Y
"RTN","ORM",90,0)
 ;
"RTN","ORM",91,0)
XTMP ; -- Save package auto-dc'd order numbers in ^XTMP
"RTN","ORM",92,0)
 ;    Uses ORIFN, ORNMSP
"RTN","ORM",93,0)
 Q:'$G(ORIFN)  Q:"^1^13^"'[($P($G(^OR(100,+ORIFN,3)),U,3)_U)
"RTN","ORM",94,0)
 N ORNOW,ORDC S ORNOW=+$$NOW^XLFDT,ORDC="ORDC-"_$G(DGPMDA)
"RTN","ORM",95,0)
 I $G(^XTMP(ORDC,0)),+^(0)<ORNOW K ^XTMP(ORDC)
"RTN","ORM",96,0)
 I '$G(^XTMP(ORDC,0)) D
"RTN","ORM",97,0)
 . N ORNOW1H S ORNOW1H=$$FMADD^XLFDT(ORNOW,,1)
"RTN","ORM",98,0)
 . S ^XTMP(ORDC,0)=ORNOW1H_U_ORNOW_"^Orders AutoDC'd by Packages on Discharge"
"RTN","ORM",99,0)
 S ^XTMP(ORDC,+ORIFN)=$G(ORNMSP)
"RTN","ORM",100,0)
 Q
"RTN","ORMBLDPS")
0^85^B46124521
"RTN","ORMBLDPS",1,0)
ORMBLDPS ;SLC/MKB-Build outgoing Pharmacy ORM msgs ;11:26 AM  2 Apr 2001
"RTN","ORMBLDPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,38,54,86,97,94,116,129,141**;Dec 17, 1997
"RTN","ORMBLDPS",3,0)
PTR(NAME) ; -- Returns ptr value of prompt in Dialog file
"RTN","ORMBLDPS",4,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMBLDPS",5,0)
 ;
"RTN","ORMBLDPS",6,0)
OUT ; -- new Outpt Meds order
"RTN","ORMBLDPS",7,0)
 ;    fall through to UD: same msg, +3 fields
"RTN","ORMBLDPS",8,0)
UD ; -- new Inpt (Unit Dose) Meds order
"RTN","ORMBLDPS",9,0)
 N OI,DRUG,INSTR,DOSE,ROUTE,SCHED,DUR,URG,PROVCOMM,PI,DISPENSE,X,Y,I,J,K,L,QT1,QT2,QT3,QT4,QT6,QT9,CONJ,ORC,SC,OUTPT
"RTN","ORMBLDPS",10,0)
 S OUTPT=$S($P(OR0,U,12)="O":1,1:0) ;outpt flag
"RTN","ORMBLDPS",11,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",12,0)
 S OI=$$PTR("ORDERABLE ITEM"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMBLDPS",13,0)
 S INSTR=$$PTR("INSTRUCTIONS"),SCHED=$$PTR("SCHEDULE")
"RTN","ORMBLDPS",14,0)
 S DUR=$$PTR("DURATION"),URG=$$PTR("URGENCY"),DOSE=$$PTR("DOSE")
"RTN","ORMBLDPS",15,0)
 S ROUTE=$$PTR("ROUTE"),PROVCOMM=$$PTR("WORD PROCESSING 1")
"RTN","ORMBLDPS",16,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMBLDPS",17,0)
 S J=1,ORC(J)=$P(ORMSG(4),"|",1,7)_"|"
"RTN","ORMBLDPS",18,0)
UD1 S I=0 F  S I=$O(ORDIALOG(INSTR,I)) Q:I'>0  D
"RTN","ORMBLDPS",19,0)
 . S QT2=$G(ORDIALOG(SCHED,I)),QT3=$$HL7DUR,X=$G(ORDIALOG(DOSE,I))
"RTN","ORMBLDPS",20,0)
 . ;S QT1=$S($L(X):$P(X,"&",1,4)_"&"_$P(X,"&",6),1:"")
"RTN","ORMBLDPS",21,0)
 . S QT1=$S($L(X):$P(X,"&",1,6),1:"")
"RTN","ORMBLDPS",22,0)
 . S QT6=$P($G(^ORD(101.42,+$G(ORDIALOG(URG,I)),0)),U,2)
"RTN","ORMBLDPS",23,0)
 . S QT9=$G(ORDIALOG(CONJ,I))_"~" S:$E(QT9)="T" QT9="S~"
"RTN","ORMBLDPS",24,0)
 . S J=J+1,ORC(J)=QT1_U_QT2_U_QT3_"^^^"_QT6_"^^"_$$INSTR_U_QT9
"RTN","ORMBLDPS",25,0)
 I $L($P(OR0,U,8)) S $P(ORC(2),U,4)=$$FMTHL7^XLFDT($P(OR0,U,8)) S:J<2 J=2
"RTN","ORMBLDPS",26,0)
 S J=J+1,ORC(J)="|"_$P(ORMSG(4),"|",9,999),ORC=J,X="ORMSG(4)",ORMSG(4)="",I=0
"RTN","ORMBLDPS",27,0)
 F J=1:1:ORC S Y=ORC(J) D  ;add to ORMSG(4)
"RTN","ORMBLDPS",28,0)
 . I $L(@X)+$L(Y)'>245 S @X=@X_Y
"RTN","ORMBLDPS",29,0)
 . E  S L=245-$L(@X),@X=@X_$E(Y,1,L),I=I+1,X="ORMSG(4,"_I_")",@X=$E(Y,L+1,$L(Y))
"RTN","ORMBLDPS",30,0)
 I $G(ORDIALOG(DRUG,1)) S X=$$ENDCM^PSJORUTL(ORDIALOG(DRUG,1)),DISPENSE=$P(X,U,3)_"^^99NDF^"_ORDIALOG(DRUG,1)_"^^99PSD"
"RTN","ORMBLDPS",31,0)
 S ORMSG(5)="RXO|"_$$USID^ORMBLD($G(ORDIALOG(OI,1)))_"|||||||||"_$G(DISPENSE)
"RTN","ORMBLDPS",32,0)
UD2 I $G(OUTPT) D
"RTN","ORMBLDPS",33,0)
 . N QTY,REFS,DSPY
"RTN","ORMBLDPS",34,0)
 . S QTY=$$PTR("QUANTITY"),REFS=$$PTR("REFILLS"),DSPY=$$PTR("DAYS SUPPLY")
"RTN","ORMBLDPS",35,0)
 . S ORMSG(5)=ORMSG(5)_"|"_$G(ORDIALOG(QTY,1))_"||"_$G(ORDIALOG(REFS,1))_"||||D"_$G(ORDIALOG(DSPY,1))
"RTN","ORMBLDPS",36,0)
 S I=5 I $L($G(ORDIALOG(PROVCOMM,1))) D
"RTN","ORMBLDPS",37,0)
 . S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,0)) Q:'J
"RTN","ORMBLDPS",38,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$G(^TMP("ORWORD",$J,PROVCOMM,1,J,0))
"RTN","ORMBLDPS",39,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PROVCOMM,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=$G(^(J,0))
"RTN","ORMBLDPS",40,0)
 I $G(OUTPT),$L($G(ORDIALOG(PI,1))) D
"RTN","ORMBLDPS",41,0)
 . S J=$O(^TMP("ORWORD",$J,PI,1,0)) Q:'J
"RTN","ORMBLDPS",42,0)
 . S I=I+1,ORMSG(I)="NTE|7|P|"_$G(^TMP("ORWORD",$J,PI,1,J,0))
"RTN","ORMBLDPS",43,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,PI,1,J)) Q:J'>0  S K=K+1,ORMSG(I,K)=$G(^(J,0))
"RTN","ORMBLDPS",44,0)
UD3 S J=0 F  S J=$O(ORDIALOG(ROUTE,J)) Q:J'>0  S I=I+1,ORMSG(I)=$$RXR($G(ORDIALOG(ROUTE,J)))
"RTN","ORMBLDPS",45,0)
 I $D(^OR(100,IFN,9)) D ORDCHKS
"RTN","ORMBLDPS",46,0)
 S I=I+1,ORMSG(I)=$$ZRX(IFN)
"RTN","ORMBLDPS",47,0)
 I $G(OUTPT) D  ;add SC data
"RTN","ORMBLDPS",48,0)
 . N OR5 S OR5=$G(^OR(100,IFN,5))
"RTN","ORMBLDPS",49,0)
 . I $L(OR5),OR5'?5"^" S I=I+1,ORMSG(I)="ZSC|"_$TR(OR5,"^","|") Q
"RTN","ORMBLDPS",50,0)
 . S SC=$$PTR("SERVICE CONNECTED") S:$D(ORDIALOG(SC,1)) I=I+1,ORMSG(I)="ZSC|"_$S(ORDIALOG(SC,1):"SC",1:"NSC")
"RTN","ORMBLDPS",51,0)
 Q
"RTN","ORMBLDPS",52,0)
 ;
"RTN","ORMBLDPS",53,0)
INSTR()  ; -- Return text instructions for QT-8, instance I
"RTN","ORMBLDPS",54,0)
 N Y S Y=$P($G(ORDIALOG(DOSE,I)),"&",5)
"RTN","ORMBLDPS",55,0)
 I $G(ORDIALOG(DRUG,1)),$L(Y) Q Y
"RTN","ORMBLDPS",56,0)
 S Y=$G(ORDIALOG(INSTR,I)) I $G(OUTPT) D
"RTN","ORMBLDPS",57,0)
 . N UNITS,UNT S UNITS=$$PTR("FREE TEXT"),UNT=$G(ORDIALOG(UNITS,I))
"RTN","ORMBLDPS",58,0)
 . S:$L(UNT) Y=Y_" "_UNT ;old format
"RTN","ORMBLDPS",59,0)
 Q Y
"RTN","ORMBLDPS",60,0)
 ;
"RTN","ORMBLDPS",61,0)
HL7DUR()  ; -- Returns HL7 form of duration X
"RTN","ORMBLDPS",62,0)
 N X,X1,X2,Y S X=$G(ORDIALOG(DUR,I))
"RTN","ORMBLDPS",63,0)
 S X1=+$G(X),Y="" G:X1'>0 HDQ
"RTN","ORMBLDPS",64,0)
 S X2=$$UP^XLFSTR($P(X,X1,2)) S:$E(X2)=" " X2=$E(X2,2,99)
"RTN","ORMBLDPS",65,0)
 S Y=$S($E(X2,1,2)="MO":"L",'$L(X2):"D",1:$E(X2))_X1
"RTN","ORMBLDPS",66,0)
HDQ Q Y
"RTN","ORMBLDPS",67,0)
 ;
"RTN","ORMBLDPS",68,0)
IV ; -- new IV Meds order
"RTN","ORMBLDPS",69,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,WP,QT,I,X1,X2,INST
"RTN","ORMBLDPS",70,0)
 S RATE=$$PTR("INFUSION RATE"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMBLDPS",71,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMBLDPS",72,0)
 S WP=$$PTR("WORD PROCESSING 1"),VOL=$$PTR("VOLUME")
"RTN","ORMBLDPS",73,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),URG=+$G(ORDIALOG($$PTR("URGENCY"),1))
"RTN","ORMBLDPS",74,0)
 S QT=U_$G(ORDIALOG(+$$PTR("SCHEDULE"),1))_"^^^^"
"RTN","ORMBLDPS",75,0)
 S:URG QT=QT_$P($G(^ORD(101.42,URG,0)),U,2) S $P(ORMSG(4),"|",8)=QT
"RTN","ORMBLDPS",76,0)
 S X=$G(^OR(100,IFN,8,1,0)) I $P(X,U,5),$P(X,U,5)'=$P(X,U,3) S $P(ORMSG(4),"|",13)=$P(X,U,5) ; Send signer instead of orderer if different
"RTN","ORMBLDPS",77,0)
 S RATE=$G(ORDIALOG(RATE,1)) S:$E(RATE,$L(RATE))=" " RATE=$E(RATE,1,($L(RATE)-1)) S ORMSG(5)="RXO|^^^PS-1^IV^99OTH|"_RATE ;strip any trailing spaces
"RTN","ORMBLDPS",78,0)
 S I=5 I $L($G(ORDIALOG(WP,1))) D
"RTN","ORMBLDPS",79,0)
 . N J,K S J=$O(^TMP("ORWORD",$J,WP,1,0)) Q:'J
"RTN","ORMBLDPS",80,0)
 . S I=6,ORMSG(6)="NTE|6|P|"_$G(^TMP("ORWORD",$J,WP,1,J,0))
"RTN","ORMBLDPS",81,0)
 . S K=0 F  S J=$O(^TMP("ORWORD",$J,WP,1,J)) Q:J'>0  S K=K+1,ORMSG(6,K)=^(J,0)
"RTN","ORMBLDPS",82,0)
IV1 S INST=0 F  S INST=$O(ORDIALOG(SOLN,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",83,0)
 . S X1="B",X2=+$G(ORDIALOG(SOLN,INST))
"RTN","ORMBLDPS",84,0)
 . I $P($G(^ORD(101.43,X2,"PS")),U,4) S X1=X1_"A" ;pre-mix
"RTN","ORMBLDPS",85,0)
 . S I=I+1,ORMSG(I)="RXC|"_X1_"|"_$$USID^ORMBLD(X2)_"|"_$G(ORDIALOG(VOL,INST))_"|"_$$HL7UNIT("ML")
"RTN","ORMBLDPS",86,0)
 I $O(ORDIALOG(ADDS,0)) D
"RTN","ORMBLDPS",87,0)
 . S INST=0 F  S INST=$O(ORDIALOG(ADDS,INST)) Q:INST'>0  D
"RTN","ORMBLDPS",88,0)
 . . S X1=$G(ORDIALOG(ADDS,INST)),X2=$G(ORDIALOG(UNITS,INST))
"RTN","ORMBLDPS",89,0)
 . . S I=I+1,ORMSG(I)="RXC|A|"_$$USID^ORMBLD(X1)_"|"_$G(ORDIALOG(STR,INST))_"|"_$$HL7UNIT(X2)
"RTN","ORMBLDPS",90,0)
 I $D(^OR(100,IFN,9)) D ORDCHKS
"RTN","ORMBLDPS",91,0)
 S I=I+1,ORMSG(I)=$$ZRX(IFN)
"RTN","ORMBLDPS",92,0)
 Q
"RTN","ORMBLDPS",93,0)
 ;
"RTN","ORMBLDPS",94,0)
RXR(ROUTE) ; -- Returns RXR segment
"RTN","ORMBLDPS",95,0)
 N NAME S NAME=$$GET1^DIQ(51.2,+ROUTE_",",.01)
"RTN","ORMBLDPS",96,0)
 Q "RXR|^^^"_+ROUTE_U_NAME_"^99PSR"
"RTN","ORMBLDPS",97,0)
 ;
"RTN","ORMBLDPS",98,0)
ZRX(IFN) ; -- Returns ZRX segment
"RTN","ORMBLDPS",99,0)
 N NATURE,TYPE,ORIG,PSORIG,ZRX
"RTN","ORMBLDPS",100,0)
 S TYPE=$P($G(^OR(100,IFN,3)),U,11),NATURE=$P($G(^(8,1,0)),U,12)
"RTN","ORMBLDPS",101,0)
 S:NATURE NATURE=$P($G(^ORD(100.02,+NATURE,0)),U,2) ;code
"RTN","ORMBLDPS",102,0)
 S PSORIG="" I (TYPE=1)!(TYPE=2) D
"RTN","ORMBLDPS",103,0)
 . S ORIG=$P($G(^OR(100,IFN,3)),U,5),PSORIG=$G(^OR(100,+ORIG,4))
"RTN","ORMBLDPS",104,0)
 . I PSORIG'>0 S PSORIG="",TYPE=0 ;edit of unreleased order
"RTN","ORMBLDPS",105,0)
 S ZRX="ZRX|"_PSORIG_"|"_NATURE_"|"_$S(TYPE=1:"E",TYPE=2:"R",1:"N")
"RTN","ORMBLDPS",106,0)
 I $G(OUTPT) S ZRX=ZRX_"|"_$G(ORDIALOG($$PTR("ROUTING"),1))_$S($L($P($G(^OR(100,ORIFN,8,1,2)),"^",3)):"|||1",1:"")
"RTN","ORMBLDPS",107,0)
 Q ZRX
"RTN","ORMBLDPS",108,0)
 ;
"RTN","ORMBLDPS",109,0)
ORDCHKS ; -- Include order checks in OBX segments
"RTN","ORMBLDPS",110,0)
 N OC,X,X1 S OC=0
"RTN","ORMBLDPS",111,0)
 F  S OC=$O(^OR(100,IFN,9,OC)) Q:OC'>0  S X=$G(^(OC,0)),X1=$G(^(1)) D
"RTN","ORMBLDPS",112,0)
 . S I=I+1,ORMSG(I)="OBX|"_OC_"|TX|^^^"_+X_"^^99OCX||"_$S($L(X1):X1,1:$P(X,U,3))_"|||||||||"_$$FMTHL7^XLFDT($P(X,U,6))_"||"_$P(X,U,5)
"RTN","ORMBLDPS",113,0)
 . I $L($P(X,U,4)) S I=I+1,ORMSG(I)="NTE|"_OC_"|P|"_$P(X,U,4)
"RTN","ORMBLDPS",114,0)
 Q
"RTN","ORMBLDPS",115,0)
 ;
"RTN","ORMBLDPS",116,0)
HL7UNIT(X) ; -- Return coded element for volume/strength units
"RTN","ORMBLDPS",117,0)
 N I,UNIT,Y
"RTN","ORMBLDPS",118,0)
 F I=1:1:$L(X) I $E(X,I)?1A Q  ; first letter
"RTN","ORMBLDPS",119,0)
 S UNIT=$$UP^XLFSTR($E(X,I,$L(X))),Y=""
"RTN","ORMBLDPS",120,0)
 F I=1:1:11 S X=$T(UNITS+I) I UNIT=$P(X,";",3) S Y="^^^PSIV-"_I_U_UNIT_"^99OTH" Q
"RTN","ORMBLDPS",121,0)
 Q Y
"RTN","ORMBLDPS",122,0)
 ;
"RTN","ORMBLDPS",123,0)
UNITS ; -- allowable PS units
"RTN","ORMBLDPS",124,0)
 ;;ML
"RTN","ORMBLDPS",125,0)
 ;;LITER
"RTN","ORMBLDPS",126,0)
 ;;MCG
"RTN","ORMBLDPS",127,0)
 ;;MG
"RTN","ORMBLDPS",128,0)
 ;;GM
"RTN","ORMBLDPS",129,0)
 ;;UNITS
"RTN","ORMBLDPS",130,0)
 ;;IU
"RTN","ORMBLDPS",131,0)
 ;;MEQ
"RTN","ORMBLDPS",132,0)
 ;;MM
"RTN","ORMBLDPS",133,0)
 ;;MU
"RTN","ORMBLDPS",134,0)
 ;;THOUU
"RTN","ORMBLDPS",135,0)
HL7TIME(X) ; -- Return HL7 formatted duration
"RTN","ORMBLDPS",136,0)
 N I,Y S Y=""
"RTN","ORMBLDPS",137,0)
 F I=1:1:$L(X) I $E(X,I)?1A S Y=$$UP^XLFSTR($E(X,I)) Q  ; first letter
"RTN","ORMBLDPS",138,0)
 S Y=Y_+X
"RTN","ORMBLDPS",139,0)
 Q Y
"RTN","ORMBLDPS",140,0)
 ;
"RTN","ORMBLDPS",141,0)
VER(IFN) ; -- Send msg for nurse-verified orders
"RTN","ORMBLDPS",142,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="I"  ;Inpt only
"RTN","ORMBLDPS",143,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",144,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),$P(OR0,U,12),+$P(OR0,U,10))
"RTN","ORMBLDPS",145,0)
 S ORMSG(4)="ORC|ZV|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS||||||||"_DUZ_"||||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",146,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",147,0)
 Q
"RTN","ORMBLDPS",148,0)
 ;
"RTN","ORMBLDPS",149,0)
REF(IFN,ROUTING,CLINIC) ; -- Send msg for refill request
"RTN","ORMBLDPS",150,0)
 N OR0,ORMSG S OR0=$G(^OR(100,+IFN,0)) Q:$P(OR0,U,12)'="O"
"RTN","ORMBLDPS",151,0)
 S:'$G(CLINIC) CLINIC=$S($G(ORL):+ORL,1:+$P(OR0,U,10))
"RTN","ORMBLDPS",152,0)
 S ORMSG(1)=$$MSH^ORMBLD("ORM","PS"),ORMSG(2)=$$PID^ORMBLD($P(OR0,U,2))
"RTN","ORMBLDPS",153,0)
 S ORMSG(3)=$$PV1^ORMBLD($P(OR0,U,2),"O",CLINIC)
"RTN","ORMBLDPS",154,0)
 S ORMSG(4)="ORC|ZF|"_IFN_"^OR|"_$G(^OR(100,+IFN,4))_"^PS|||||||"_DUZ_"||"_$G(ORNP)_"|||"_$$FMTHL7^XLFDT($$NOW^XLFDT)
"RTN","ORMBLDPS",155,0)
 S ORMSG(5)="ZRX||||"_ROUTING
"RTN","ORMBLDPS",156,0)
 D MSG^XQOR("OR EVSEND PS",.ORMSG)
"RTN","ORMBLDPS",157,0)
 Q
"RTN","ORMEVNT")
0^30^B66893320
"RTN","ORMEVNT",1,0)
ORMEVNT ;SLC/MKB-Trigger HL7 msg off MAS events ; 22 Aug 2002 11:44 AM
"RTN","ORMEVNT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**24,45,70,79,141**;Dec 17, 1997
"RTN","ORMEVNT",3,0)
 ;
"RTN","ORMEVNT",4,0)
EN1 ; -- tasked entry point
"RTN","ORMEVNT",5,0)
 Q:'$G(DFN)  Q:$D(DGPMPC)  Q:DGPMT=4!(DGPMT=5)  ;skip lodger mvts
"RTN","ORMEVNT",6,0)
 N ZTDESC,ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTSK,I
"RTN","ORMEVNT",7,0)
 S ZTDESC="Auto-DC and/or Release orders on MAS movement",ZTIO=""
"RTN","ORMEVNT",8,0)
 S ZTRTN="EN^ORMEVNT",ZTDTH=$H,ZTSAVE("^UTILITY(""DGPM"",$J,")=""
"RTN","ORMEVNT",9,0)
 F I="DFN","DGPMDA","DGPMA","DGPMP","DGPMT" S ZTSAVE(I)=""
"RTN","ORMEVNT",10,0)
 D ^%ZTLOAD ;D EN^ORYDGPM
"RTN","ORMEVNT",11,0)
 Q
"RTN","ORMEVNT",12,0)
 ;
"RTN","ORMEVNT",13,0)
EN ; -- main entry point
"RTN","ORMEVNT",14,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ORMEVNT",15,0)
 Q:'$G(DFN)  Q:$D(DGPMPC)  Q:DGPMT=4!(DGPMT=5)
"RTN","ORMEVNT",16,0)
 N XQORQUIT,XQORPOP,DTOUT,DUOUT,DIRUT,DIROUT ;protect protocol context
"RTN","ORMEVNT",17,0)
 N VAIP,DONE,ORVP,ORWARD,ORTS,ORL,ORDIV,ORLAST,X,Y,I,ORCURRNT,OREVENT,ORDCRULE,ORACT,ORPRINT
"RTN","ORMEVNT",18,0)
 S VAIP("E")=DGPMDA D IN5^VADPT M ORVP=VAIP I '$G(DGPMA) D  Q  ;deleted
"RTN","ORMEVNT",19,0)
 . N LAST,OREVT S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",20,0)
 . S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0))
"RTN","ORMEVNT",21,0)
 . D ACTLOG^OREVNTX(OREVT,"DL")
"RTN","ORMEVNT",22,0)
A ;
"RTN","ORMEVNT",23,0)
 S ORVP=+DFN_";DPT(",ORTS=+$G(^DPT(DFN,.103)),ORWARD=$G(^(.1))
"RTN","ORMEVNT",24,0)
 S ORWARD=$S($L(ORWARD):+$O(^DIC(42,"B",ORWARD,0)),1:0)
"RTN","ORMEVNT",25,0)
 S ORL=$S(ORWARD:+$G(^DIC(42,ORWARD,44))_";SC(",1:""),ORDIV=$$DIV(+ORL)
"RTN","ORMEVNT",26,0)
 S ORLAST("TS")=$$PREVTS,X=+VAIP(15,4) F I="WD","LOC","DIV" S ORLAST(I)=""
"RTN","ORMEVNT",27,0)
 S:X ORLAST("WD")=X,Y=+$G(^DIC(42,X,44)),ORLAST("LOC")=Y_";SC(",ORLAST("DIV")=$$DIV(Y)
"RTN","ORMEVNT",28,0)
 S ORCURRNT=$$CURRENT,OREVENT=$$PATEVT,ORACT=$S($G(DGPMP):"ED",1:"NW")
"RTN","ORMEVNT",29,0)
 I $G(DGPMP),$D(^ORE(100.2,"ADT",DGPMDA)) D  Q:$G(DONE)  ;edited
"RTN","ORMEVNT",30,0)
 . N LAST,OREVT,DA,X,I S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",31,0)
 . S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0)),DA=+$O(^(OREVT,0))
"RTN","ORMEVNT",32,0)
 . S X=$G(^ORE(100.2,OREVT,10,DA,0)) ;last activity on movement
"RTN","ORMEVNT",33,0)
 . I $P(X,U,5)=+$G(VAIP(4)),$P(X,U,6)=+$G(VAIP(8)),$P(X,U,7)=+$G(VAIP(5)) S DONE=1 Q  ;no change
"RTN","ORMEVNT",34,0)
 . I 'OREVENT D ACTLOG^OREVNTX(OREVT,"ED",$$TYPE(DGPMT),1) S DONE=1
"RTN","ORMEVNT",35,0)
B ;
"RTN","ORMEVNT",36,0)
 I '$G(DGPMP),ORCURRNT D  ;new mvt - autoDC
"RTN","ORMEVNT",37,0)
 . I $D(^ORE(100.2,"ADT",DGPMDA)) D  Q  ;ReEntered
"RTN","ORMEVNT",38,0)
 .. S ORACT="RE" Q:OREVENT  ;log on new event instead
"RTN","ORMEVNT",39,0)
 .. N LAST,OREVT S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",40,0)
 .. S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0))
"RTN","ORMEVNT",41,0)
 .. D ACTLOG^OREVNTX(OREVT,ORACT,$$TYPE(DGPMT),1)
"RTN","ORMEVNT",42,0)
 . I DGPMT=3 D COMP("ALG") ;keep until GMRA*4*15 gets out
"RTN","ORMEVNT",43,0)
 . S ORDCRULE=$$DCEVT D:ORDCRULE AUTODC^ORMEVNT1(ORDCRULE,$P(DGPMA,U))
"RTN","ORMEVNT",44,0)
 . I DGPMT=1,$G(^XTMP("ORDCOBS-"_+ORVP,0)) D REINST
"RTN","ORMEVNT",45,0)
C ;
"RTN","ORMEVNT",46,0)
 I OREVENT D  ;release delayed orders, complete event
"RTN","ORMEVNT",47,0)
 . D RELEASE^ORMEVNT1(OREVENT),DONE^OREVNTX(OREVENT,$P(DGPMA,U),DGPMDA)
"RTN","ORMEVNT",48,0)
 . I '$G(VAIP(1)) M VAIP=ORVP ;reset for ACTLOG use
"RTN","ORMEVNT",49,0)
 . D ACTLOG^OREVNTX(OREVENT,ORACT,$$TYPE(DGPMT),1)
"RTN","ORMEVNT",50,0)
 . I DGPMT=1,'$P($G(^ORE(100.2,+OREVENT,0)),U,3) S $P(^(0),U,3)=DGPMDA
"RTN","ORMEVNT",51,0)
 I $O(ORPRINT(0)),$G(ORL) D PRINTS^ORWD1(.ORPRINT,+ORL)
"RTN","ORMEVNT",52,0)
 I DGPMT=3,ORCURRNT,'$G(DGPMP) D DISCH ;lapse remaining events
"RTN","ORMEVNT",53,0)
 I '$G(DFN),$G(ORVP) S DFN=+ORVP ;just in case
"RTN","ORMEVNT",54,0)
 Q
"RTN","ORMEVNT",55,0)
 ;
"RTN","ORMEVNT",56,0)
CURRENT() ; -- Returns 1 or 0, if DGPMDA is the latest movement
"RTN","ORMEVNT",57,0)
 N Y,LAST,LASTYPE,LASTDT S Y=0
"RTN","ORMEVNT",58,0)
 S LAST=+VAIP(14),LASTDT=+VAIP(14,1),LASTYPE=+VAIP(14,2)
"RTN","ORMEVNT",59,0)
 ; VAIP(14) = last physical movement for the admission
"RTN","ORMEVNT",60,0)
 I DGPMT=6 D  G CQ
"RTN","ORMEVNT",61,0)
 . N CA,IDT I LAST,LASTDT>+VAIP(3) Q  ;last physical mvt
"RTN","ORMEVNT",62,0)
 . S CA=+VAIP(13),IDT=9999999.9999999-VAIP(3)
"RTN","ORMEVNT",63,0)
 . I '$O(^DGPM("ATS",DFN,CA,IDT),-1) S Y=1 Q  ;last TS mvt
"RTN","ORMEVNT",64,0)
 I DGPMT=3 D  ;get last mvt overall
"RTN","ORMEVNT",65,0)
 . N VAIP,Y S VAIP("D")="LAST" D IN5^VADPT
"RTN","ORMEVNT",66,0)
 . S LAST=+VAIP(14),LASTYPE=+VAIP(14,2) ;reset
"RTN","ORMEVNT",67,0)
 I LAST=DGPMDA S Y=1 G CQ ;primary mvt
"RTN","ORMEVNT",68,0)
 I $D(^UTILITY("DGPM",$J,LASTYPE,LAST)) S Y=1 ;secondary mvt
"RTN","ORMEVNT",69,0)
CQ Q Y
"RTN","ORMEVNT",70,0)
 ;
"RTN","ORMEVNT",71,0)
PREVTS() ; -- Returns previous treating specialty
"RTN","ORMEVNT",72,0)
 N TS,TSP,CA,ID,LAST,Y
"RTN","ORMEVNT",73,0)
 S TS=+$O(^UTILITY("DGPM",$J,6,0)),TSP=$G(^(TS,"P"))
"RTN","ORMEVNT",74,0)
 I $G(TSP) S Y=+$P(TSP,U,9) G PRVQ ;edited TS mvt
"RTN","ORMEVNT",75,0)
 ; look for TS mvt since last phys mvt
"RTN","ORMEVNT",76,0)
 S CA=$P(DGPMA,U,14),ID=9999999.9999999-DGPMA
"RTN","ORMEVNT",77,0)
 S LAST=+$O(^DGPM("ATS",DFN,CA,ID)),Y=$S(LAST:+$O(^(LAST,0)),1:+VAIP(15,6))
"RTN","ORMEVNT",78,0)
PRVQ Q Y
"RTN","ORMEVNT",79,0)
 ;
"RTN","ORMEVNT",80,0)
TYPE(X) ; -- Return type of event from MAS code
"RTN","ORMEVNT",81,0)
 N Y S Y=$S(X=1:"A",X=2:"T",X=3:"D",X=6:"S",1:"")
"RTN","ORMEVNT",82,0)
 Q Y
"RTN","ORMEVNT",83,0)
 ;
"RTN","ORMEVNT",84,0)
DIV(LOC) ; -- Return Institution file #4 ptr for LOC
"RTN","ORMEVNT",85,0)
 N X0,Y S X0=$G(^SC(+LOC,0))
"RTN","ORMEVNT",86,0)
 S Y=$S($P(X0,U,4):$P(X0,U,4),$P(X0,U,15):$$SITE^VASITE(DT,$P(X0,U,15)),1:+$G(DUZ(2)))
"RTN","ORMEVNT",87,0)
 Q Y
"RTN","ORMEVNT",88,0)
 ;
"RTN","ORMEVNT",89,0)
PATEVT() ; -- Find match to new data in Patient Event file
"RTN","ORMEVNT",90,0)
 N TYPE,MVTYPE,EVT,IFN,X0,Y S Y="" G:'$G(ORCURRNT) PTQ
"RTN","ORMEVNT",91,0)
 S TYPE=$S(DGPMT=1:"A",DGPMT=3:"D",DGPMT=2!(DGPMT=6):"T",1:""),EVT=0
"RTN","ORMEVNT",92,0)
 S MVTYPE=$P(DGPMA,U,18),TYPE(1)="",MVTYPE(1)=""
"RTN","ORMEVNT",93,0)
 I DGPMT=2,MVTYPE=13 S TYPE(1)="A",MVTYPE(1)=40 ;To ASIH
"RTN","ORMEVNT",94,0)
 I DGPMT=3,MVTYPE=41 S TYPE(1)="T",MVTYPE(1)=14 ;From ASIH
"RTN","ORMEVNT",95,0)
 I DGPMT'=3,$$GET1^DIQ(45.7,+$G(ORTS)_",","SPECIALTY:SERVICE")="NHCU" S TYPE(1)=$S(TYPE="A":"T",1:"A") ;DBIA #1154
"RTN","ORMEVNT",96,0)
 F  S EVT=+$O(^ORE(100.2,"AE",DFN,EVT)) Q:EVT<1  S IFN=+$O(^(EVT,0)) D  Q:Y
"RTN","ORMEVNT",97,0)
 . Q:$$LAPSED^OREVNTX(+IFN)  Q:$P($G(^ORE(100.2,IFN,1)),U,5)
"RTN","ORMEVNT",98,0)
 . S X0=$G(^ORD(100.5,EVT,0)) Q:$P(X0,U,3)'=ORDIV
"RTN","ORMEVNT",99,0)
 . I $P(X0,U,2)'=TYPE,$P(X0,U,2)'=TYPE(1) Q  ;Xaction type
"RTN","ORMEVNT",100,0)
 . I $P(X0,U,7),$P(X0,U,7)'=MVTYPE,$P(X0,U,7)'=MVTYPE(1) Q  ;Mvt type
"RTN","ORMEVNT",101,0)
 . I $O(^ORD(100.5,EVT,"TS",0)) Q:'$D(^("B",ORTS))  Q:ORTS=ORLAST("TS")&(ORDIV=ORLAST("DIV"))
"RTN","ORMEVNT",102,0)
 . I $O(^ORD(100.5,EVT,"LOC",0)) Q:'$D(^("B",ORWARD))  Q:ORWARD=ORLAST("WD")
"RTN","ORMEVNT",103,0)
 . S Y=+IFN ;ok
"RTN","ORMEVNT",104,0)
PTQ Q Y
"RTN","ORMEVNT",105,0)
 ;
"RTN","ORMEVNT",106,0)
DCEVT() ; -- Find match to event in AutoDC Rules file for [new] ORDIV,ORTS,ORL
"RTN","ORMEVNT",107,0)
 N MVTYPE,DIV,XFER,ORY,EXC,OBS
"RTN","ORMEVNT",108,0)
 S OBS=$S(DGPMT=3:$$MVT^DGPMOBS(DGPMDA),1:0) ;observation mvt
"RTN","ORMEVNT",109,0)
 S MVTYPE=+$P(DGPMA,U,18) S:MVTYPE=41 MVTYPE=14 ;ASIH
"RTN","ORMEVNT",110,0)
 S XFER=$S(DGPMT=2:1,DGPMT=6:1,MVTYPE'=14:0,OBS:0,1:1) ;transfer
"RTN","ORMEVNT",111,0)
 I XFER,ORLAST("TS")'=ORTS,$D(^ORD(100.6,"AC",ORDIV,20)) S MVTYPE=20 ;TS
"RTN","ORMEVNT",112,0)
 S DIV=ORDIV I DGPMT=3,MVTYPE'=14 S DIV=ORLAST("DIV") ;discharge
"RTN","ORMEVNT",113,0)
 S ORY=+$O(^ORD(100.6,"AC",ORDIV,MVTYPE,0)) G:ORY<1 DCQ
"RTN","ORMEVNT",114,0)
 I MVTYPE=20,$D(^ORD(100.6,ORY,4,ORLAST("TS"),1,ORTS))!(ORTS=ORLAST("TS")) S ORY=0 G DCQ
"RTN","ORMEVNT",115,0)
 I MVTYPE=4 D  G DCQ ;ck Div and Loc multiples
"RTN","ORMEVNT",116,0)
 . I ORLAST("DIV")'=ORDIV S:'$D(^ORD(100.6,ORY,6,ORLAST("DIV"))) ORY=0 Q
"RTN","ORMEVNT",117,0)
 . N OLD,INCL S INCL=0 ;ck incl loc's
"RTN","ORMEVNT",118,0)
 . F OLD=+ORLAST("LOC"),"ALL" I $D(^ORD(100.6,ORY,5,"ADC",OLD,+ORL))!$D(^("ALL")) S INCL=1 Q
"RTN","ORMEVNT",119,0)
 . S:'INCL ORY=0
"RTN","ORMEVNT",120,0)
 I DGPMT=3,OBS D  ;readmitting from observation?
"RTN","ORMEVNT",121,0)
 . S EXC=+$P($G(^ORD(100.6,ORY,0)),U,6) S:EXC=2 ORY=0 ;ignore rule
"RTN","ORMEVNT",122,0)
 . I EXC=1,'$D(ZTQUEUED),$$READMIT S ORY=0
"RTN","ORMEVNT",123,0)
 . K:ORY ^XTMP("ORDCOBS-"_+ORVP) ;have rule -> dc, don't reinstate meds
"RTN","ORMEVNT",124,0)
DCQ Q ORY
"RTN","ORMEVNT",125,0)
 ;
"RTN","ORMEVNT",126,0)
READMIT() ; -- Return 1 or 0, if patient is being readmitted
"RTN","ORMEVNT",127,0)
 N X,Y,DIR
"RTN","ORMEVNT",128,0)
 S DIR(0)="YA",DIR("A")="Will the patient be re-admitted immediately? "
"RTN","ORMEVNT",129,0)
 S DIR("?")="Enter YES if the patient is to be admitted to the hospital immediately following this discharge from observation."
"RTN","ORMEVNT",130,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","ORMEVNT",131,0)
 Q Y
"RTN","ORMEVNT",132,0)
 ;
"RTN","ORMEVNT",133,0)
COMP(ORDG) ; -- Complete orders on event [Keep until GMRA*4*15]
"RTN","ORMEVNT",134,0)
 N ORI,ORLIST,ORIFN,OREDT
"RTN","ORMEVNT",135,0)
 I 'ORDG S:ORDG?1.U ORDG=+$O(^ORD(100.98,"B",ORDG,0)) Q:ORDG'>0
"RTN","ORMEVNT",136,0)
 D EN^ORQ1(ORVP,ORDG,2) S ORI=0,OREDT=$P(DGPMA,U)
"RTN","ORMEVNT",137,0)
 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI'>0  S ORIFN=^(ORI) D STATUS^ORCSAVE2(+ORIFN,2) S:$G(OREDT) $P(^OR(100,+ORIFN,3),U)=OREDT,$P(^(6),U,6)=OREDT
"RTN","ORMEVNT",138,0)
 Q
"RTN","ORMEVNT",139,0)
 ;
"RTN","ORMEVNT",140,0)
LOC(NODE) ; -- Returns [new] patient location from NODE
"RTN","ORMEVNT",141,0)
 N X,Y S X=$P($G(NODE),U,6)
"RTN","ORMEVNT",142,0)
 I X'>0 S X=$P($G(^DPT(+ORVP,.1)),U) S:$L(X) X=$O(^DIC(42,"B",X,0))
"RTN","ORMEVNT",143,0)
 S Y=+$G(^DIC(42,+X,44))_";SC("
"RTN","ORMEVNT",144,0)
 Q Y
"RTN","ORMEVNT",145,0)
 ;
"RTN","ORMEVNT",146,0)
DISCH ; -- Lapse/cancel outstanding events on discharge
"RTN","ORMEVNT",147,0)
 N X,ADM,EVT,ORP,X0,IFN,STS,X8,ORNOW S ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORMEVNT",148,0)
 S X=$P(DGPMA,U,18),ADM=$S(X=12!(X=38):"",1:+$G(VAIP(13))),EVT=0
"RTN","ORMEVNT",149,0)
 F  S EVT=+$O(^ORE(100.2,"AE",+ORVP,EVT)) Q:EVT<1  S ORP=+$O(^(EVT,0)) D
"RTN","ORMEVNT",150,0)
 . I $G(^ORE(100.2,ORP,1)) K ^ORE(100.2,"AE",+ORVP,EVT,ORP) Q
"RTN","ORMEVNT",151,0)
 . Q:$$LAPSED^OREVNTX(ORP)  I $$EMPTY^OREVNTX(ORP) D CANCEL^OREVNTX(ORP) Q
"RTN","ORMEVNT",152,0)
 . I ADM,$P($G(^ORE(100.2,ORP,0)),U,3)'=ADM Q  ;ck adm if not death
"RTN","ORMEVNT",153,0)
 . ;D LP1^OREVNTX(ORP) ;lapse orders/event
"RTN","ORMEVNT",154,0)
 . S X0=$G(^ORE(100.2,ORP,0))
"RTN","ORMEVNT",155,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",ORVP,ORP,IFN)) Q:IFN<1  D
"RTN","ORMEVNT",156,0)
 .. S STS=$P($G(^OR(100,IFN,3)),U,3) I (STS=10)!(IFN=+$P(X0,U,4)) D
"RTN","ORMEVNT",157,0)
 ... D STATUS^ORCSAVE2(IFN,13) S X8=$G(^OR(100,IFN,8,1,0))
"RTN","ORMEVNT",158,0)
 ... S:$P(X8,U,15) $P(^OR(100,IFN,8,1,0),U,15)=13
"RTN","ORMEVNT",159,0)
 ... D:$P(X8,U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,1)
"RTN","ORMEVNT",160,0)
 ... S ^OR(100,IFN,6)=+$O(^ORD(100.02,"C","A",0))_U_U_ORNOW_U_+$O(^ORD(100.03,"C","ORDIS",0))_U_U_U_U_$G(OREVENT)
"RTN","ORMEVNT",161,0)
 . D DONE^OREVNTX(ORP),ACTLOG^OREVNTX(ORP,"CA")
"RTN","ORMEVNT",162,0)
 Q
"RTN","ORMEVNT",163,0)
 ;
"RTN","ORMEVNT",164,0)
XTMP ; -- Save ORIFN to possibly reinstate on admission
"RTN","ORMEVNT",165,0)
 ;    Also uses ORVP, DGPMDA
"RTN","ORMEVNT",166,0)
 Q:'$G(DGPMDA)  Q:'$G(ORIFN)  Q:'$G(ORVP)
"RTN","ORMEVNT",167,0)
 N ORNOW S ORNOW=+$$NOW^XLFDT
"RTN","ORMEVNT",168,0)
 I $G(^XTMP("ORDCOBS-"_+ORVP,0)),+^(0)<ORNOW K ^XTMP("ORDCOBS-"_+ORVP)
"RTN","ORMEVNT",169,0)
 I '$G(^XTMP("ORDCOBS-"_+ORVP,0)) D
"RTN","ORMEVNT",170,0)
 . N ORNOW1H S ORNOW1H=$$FMADD^XLFDT(ORNOW,,1)
"RTN","ORMEVNT",171,0)
 . S ^XTMP("ORDCOBS-"_+ORVP,0)=ORNOW1H_U_ORNOW_"^InptMeds AutoDC'd on Discharge from Observation"
"RTN","ORMEVNT",172,0)
 S ^XTMP("ORDCOBS-"_+ORVP,+ORIFN)=$G(^OR(100,+ORIFN,4))
"RTN","ORMEVNT",173,0)
 S ^XTMP("ORDCOBS-"_+ORVP,"DISCHARGE")=DGPMDA
"RTN","ORMEVNT",174,0)
 Q
"RTN","ORMEVNT",175,0)
 ;
"RTN","ORMEVNT",176,0)
REINST ; -- Reinstate meds from observation
"RTN","ORMEVNT",177,0)
 I '$L($T(ENR^PSJOERI)) K ^XTMP("ORDCOBS-"_+ORVP) Q
"RTN","ORMEVNT",178,0)
 N ORIDT,ORLASTDC,X0,ORIFN,PSIFN
"RTN","ORMEVNT",179,0)
 S ORIDT=+$O(^DGPM("ATID3",+ORVP,0)) Q:ORIDT<1  S ORLASTDC=+$O(^(ORIDT,0))
"RTN","ORMEVNT",180,0)
 Q:$G(^XTMP("ORDCOBS-"_+ORVP,"DISCHARGE"))'=ORLASTDC  S X0=$G(^(0))
"RTN","ORMEVNT",181,0)
 Q:+X0<1  ;I $P(X0,U)<$$NOW^XLFDT K ^XTMP("ORDCOBS-"_+ORVP) Q  ;too long
"RTN","ORMEVNT",182,0)
 S ORIFN=0 F  S ORIFN=+$O(^XTMP("ORDCOBS-"_+ORVP,ORIFN))  Q:ORIFN<1  S PSIFN=$G(^(ORIFN)) D:PSIFN ENR^PSJOERI(+ORVP,PSIFN,+ORWARD)
"RTN","ORMEVNT",183,0)
 K ^XTMP("ORDCOBS-"_+ORVP)
"RTN","ORMEVNT",184,0)
 Q
"RTN","ORMEVNT",185,0)
 ;
"RTN","ORMEVNT",186,0)
 ; -- Moved code:
"RTN","ORMEVNT",187,0)
EXP(ORDER,ORSTOP) G EXP^ORMEVNT1
"RTN","ORMEVNT",188,0)
ACTIVE(ORDER,ORSTRT) G ACT^ORMEVNT1
"RTN","ORMEVNT",189,0)
PURGE(ORDER) G PUR^ORMEVNT1
"RTN","ORMEVNT1")
0^31^B47568929
"RTN","ORMEVNT1",1,0)
ORMEVNT1 ;SLC/MKB-Trigger HL7 msg off OR events,ORMTIME ; 08 May 2002  2:12 PM
"RTN","ORMEVNT1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORMEVNT1",3,0)
 ;
"RTN","ORMEVNT1",4,0)
OR2(ORSRDA) ; -- Kill logic, from Surgery package [DBIA #3558]
"RTN","ORMEVNT1",5,0)
 ;    ^SRF reads allowed by DBIA #3559
"RTN","ORMEVNT1",6,0)
 N X,Y,DA,OREVT,ORSRF,ORACT
"RTN","ORMEVNT1",7,0)
 S OREVT=+$O(^ORE(100.2,"ASR",+$G(ORSRDA),0)) Q:OREVT<1
"RTN","ORMEVNT1",8,0)
 S ORSRF=$G(^SRF(+ORSRDA,.2)),ORACT=$S($L($P(ORSRF,U,12)):"ED",1:"DL")
"RTN","ORMEVNT1",9,0)
 D ACTLOG^OREVNTX(OREVT,ORACT)
"RTN","ORMEVNT1",10,0)
 Q
"RTN","ORMEVNT1",11,0)
 ;
"RTN","ORMEVNT1",12,0)
OR1(ORSRDA,ORSRX) ; -- Set logic, from Surgery package [DBIA #3558]
"RTN","ORMEVNT1",13,0)
 ;    ^SRF reads allowed by DBIA #3559
"RTN","ORMEVNT1",14,0)
 I $G(^SRF(+$G(ORSRDA),"CON")),$D(^ORE(100.2,"ASR",+^("CON"))) Q  ;concurrent
"RTN","ORMEVNT1",15,0)
 Q:$D(^ORE(100.2,"ASR",+$G(ORSRDA)))  Q:'$$CURRENT  ;edit
"RTN","ORMEVNT1",16,0)
 ;
"RTN","ORMEVNT1",17,0)
 N ORSR0,DFN,VAIP,VAERR,X,Y,DA,ORVP,ORL,ORDIV,ORTS,OREVENT,ORDCRULE,ORPRINT
"RTN","ORMEVNT1",18,0)
 S ORSR0=$G(^SRF(+$G(ORSRDA),0)),DFN=+$P(ORSR0,U)
"RTN","ORMEVNT1",19,0)
 D IN5^VADPT Q:'$G(VAIP(13))  ;not admitted
"RTN","ORMEVNT1",20,0)
 S ORL=$P($G(^SRS(+$P(ORSR0,U,2),0)),U)_";SC(",ORDIV=$$DIV(+ORL) ;DBIA #3362
"RTN","ORMEVNT1",21,0)
 S ORTS=+$G(VAIP(8)) ; need surg spec too?  DBIA #991
"RTN","ORMEVNT1",22,0)
 S ORVP=DFN_";DPT(",OREVENT=$$PATEVT,ORDCRULE=$$DCEVT
"RTN","ORMEVNT1",23,0)
 D:ORDCRULE AUTODC(ORDCRULE,ORSRX) I OREVENT D
"RTN","ORMEVNT1",24,0)
 . D RELEASE(OREVENT),DONE^OREVNTX(OREVENT,ORSRX,,ORSRDA)
"RTN","ORMEVNT1",25,0)
 . D ACTLOG^OREVNTX(OREVENT,"NW","O")
"RTN","ORMEVNT1",26,0)
 I $O(ORPRINT(0)),$G(ORL) D PRINTS^ORWD1(.ORPRINT,+ORL)
"RTN","ORMEVNT1",27,0)
 Q
"RTN","ORMEVNT1",28,0)
 ;
"RTN","ORMEVNT1",29,0)
DIV(LOC) ; -- Return Institution file #4 ptr for LOC
"RTN","ORMEVNT1",30,0)
 N X0,Y S X0=$G(^SC(+LOC,0))
"RTN","ORMEVNT1",31,0)
 S Y=$S($P(X0,U,4):$P(X0,U,4),$P(X0,U,15):$$SITE^VASITE(DT,$P(X0,U,15)),1:+$G(DUZ(2)))
"RTN","ORMEVNT1",32,0)
 Q Y
"RTN","ORMEVNT1",33,0)
 ;
"RTN","ORMEVNT1",34,0)
CURRENT() ; -- Is posted mvt the latest one?
"RTN","ORMEVNT1",35,0)
 N Y S Y=$S((DT-X)<1:1,1:0)
"RTN","ORMEVNT1",36,0)
 Q Y
"RTN","ORMEVNT1",37,0)
 ;
"RTN","ORMEVNT1",38,0)
PATEVT() ; -- Find match to new data in Patient Event file
"RTN","ORMEVNT1",39,0)
 N EVT,IFN,X0,Y S EVT=0,Y=""
"RTN","ORMEVNT1",40,0)
 F  S EVT=+$O(^ORE(100.2,"AE",+ORVP,EVT)) Q:EVT<1  S IFN=$O(^(EVT,0)) D  Q:Y
"RTN","ORMEVNT1",41,0)
 . Q:$$LAPSED^OREVNTX(+IFN)  ;don't release orders
"RTN","ORMEVNT1",42,0)
 . S X0=$G(^ORD(100.5,EVT,0))
"RTN","ORMEVNT1",43,0)
 . I $P(X0,U,2)="O",$P(X0,U,3)=ORDIV S Y=+IFN Q
"RTN","ORMEVNT1",44,0)
 Q Y
"RTN","ORMEVNT1",45,0)
 ;
"RTN","ORMEVNT1",46,0)
DCEVT() ; -- Find match to event in AutoDC Rules file for [new] ORDIV
"RTN","ORMEVNT1",47,0)
 N Y I '$G(^DPT(+ORVP,.105)) Q 0 ;no auto-dc's if not admitted
"RTN","ORMEVNT1",48,0)
 S Y=+$O(^ORD(100.6,"AE",ORDIV,"O",0))
"RTN","ORMEVNT1",49,0)
 Q Y
"RTN","ORMEVNT1",50,0)
 ;
"RTN","ORMEVNT1",51,0)
AUTODC(ORDC,ORDT) ; -- DC orders based on rule ORDC [also from ORMEVNT]
"RTN","ORMEVNT1",52,0)
 ;    Expects VAIP array with current admission data
"RTN","ORMEVNT1",53,0)
 N ORADM,ORNOW,ORN,X,OREASON,ORNATR,ORCREATE,ORPRNT,ORSIG,ORDG,ORI,ORPKG,ORLIST,ORIFN,OR0,ORDER,ORERR
"RTN","ORMEVNT1",54,0)
 S OREASON=+$P($G(^ORD(100.6,ORDC,0)),U,4) I OREASON<1 D
"RTN","ORMEVNT1",55,0)
 . S OREASON=$S('$G(DGPMT):"OROR",DGPMT=1:"ORADMIT",DGPMT=2:"ORTRANS",DGPMT=3:"ORDIS",1:"ORSPEC")
"RTN","ORMEVNT1",56,0)
 . S OREASON=+$O(^ORD(100.03,"C",OREASON,0))
"RTN","ORMEVNT1",57,0)
 S ORNATR=+$P($G(^ORD(100.03,+$G(OREASON),0)),U,7)
"RTN","ORMEVNT1",58,0)
 S:ORNATR'>0 ORNATR=+$O(^ORD(100.02,"C","A",0))
"RTN","ORMEVNT1",59,0)
 S X=$G(^ORD(100.02,ORNATR,1)),ORCREATE=+$P(X,U),ORPRNT=+$P(X,U,2)
"RTN","ORMEVNT1",60,0)
 S ORSIG=$S('ORCREATE:"",1:$P(X,U,4)),ORDG=$O(^ORD(100.98,"B","ALL",0))
"RTN","ORMEVNT1",61,0)
 S ORI=0 F  S ORI=$O(^ORD(100.6,ORDC,7,"B",ORI)) Q:ORI<1  S ORPKG(ORI)=1
"RTN","ORMEVNT1",62,0)
 S ORADM=+$G(VAIP(13,1)),ORNOW=$$NOW^XLFDT,ORN="A",ORI=6
"RTN","ORMEVNT1",63,0)
 I $G(DGPMT)=3,"^12^38^"[(U_$P(DGPMA,U,18)_U) S ORI=2,ORADM="",ORN=""
"RTN","ORMEVNT1",64,0)
 D EN^ORQ1(ORVP,ORDG,ORI,,ORADM,ORNOW) S ORI=0
"RTN","ORMEVNT1",65,0)
DC1 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI'>0  S ORIFN=^(ORI) D
"RTN","ORMEVNT1",66,0)
 . ;Q:$P(ORIFN,";",2)>1  ; or DC/Delete actions ??
"RTN","ORMEVNT1",67,0)
 . Q:"^1^2^7^11^12^13^"[(U_$P(^OR(100,+ORIFN,3),U,3)_U)  S OR0=$G(^(0))
"RTN","ORMEVNT1",68,0)
 . Q:'$G(ORPKG($P(OR0,U,14)))  Q:$D(^ORD(100.6,ORDC,10,"B",+$P(OR0,U,11)))
"RTN","ORMEVNT1",69,0)
 . S X=+$$VALUE^ORX8(+ORIFN,"ORDERABLE") Q:$D(^ORD(100.6,ORDC,8,"B",X))
"RTN","ORMEVNT1",70,0)
 . Q:'$$VALID^ORCACT0(ORIFN,"DC",,ORN)  ;ok to auto-dc order?
"RTN","ORMEVNT1",71,0)
 . I '$G(OREVENT) S OREVENT=+$$NEW^OREVNT(+ORVP) ;no delayed orders
"RTN","ORMEVNT1",72,0)
 . S ORDER=+ORIFN_$S(ORCREATE:";"_$$ACTION^ORCSAVE("DC",+ORIFN,$G(ORNP),,$G(ORDT)),1:"")
"RTN","ORMEVNT1",73,0)
 . D EN^ORCSEND(ORDER,"DC",ORSIG,1,ORNATR,$G(OREASON),.ORERR) Q:$G(ORERR)
"RTN","ORMEVNT1",74,0)
 . S $P(^OR(100,+ORIFN,6),U,8)=OREVENT D SAVE(ORIFN,OREVENT,3)
"RTN","ORMEVNT1",75,0)
 . S:ORPRNT ORPRINT=$G(ORPRINT)+1,ORPRINT(ORPRINT)=ORDER_"^1"
"RTN","ORMEVNT1",76,0)
DC2 I $G(OREVENT) D
"RTN","ORMEVNT1",77,0)
 . S $P(^ORE(100.2,OREVENT,1),U,3)=ORDC,^ORE(100.2,"DC",ORDC,OREVENT)=""
"RTN","ORMEVNT1",78,0)
 . I $G(DGPMDA),$D(^XTMP("ORDC-"_DGPMDA)) D XTMP ;save order#'s
"RTN","ORMEVNT1",79,0)
 K ^TMP("ORR",$J,ORLIST),^XTMP("ORDC-"_$G(DGPMDA))
"RTN","ORMEVNT1",80,0)
 Q
"RTN","ORMEVNT1",81,0)
 ;
"RTN","ORMEVNT1",82,0)
RELEASE(OREVT) ; -- release orders for OREVT [also from ORMEVNT]
"RTN","ORMEVNT1",83,0)
 ;    Returns ORPRINT(#)=order^prints for orders released
"RTN","ORMEVNT1",84,0)
 Q:'$G(OREVT)  N ORPARM,ORLR,ORX,ORI,ORV,ORIFN,ORERR,OR0,OR3,ORLAB
"RTN","ORMEVNT1",85,0)
 S ORPARM="" I $G(ORL) F ORI="CHART COPY","LABELS","REQUISITIONS","SERVICE","WORK COPY" S ORPARM=ORPARM_U_$S(ORI="SERVICE":1,1:+$$GET^XPAR("ALL^"_ORL,"ORPF PROMPT FOR "_ORI,1,"I"))
"RTN","ORMEVNT1",86,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0)),ORX=OREVT,ORI=0
"RTN","ORMEVNT1",87,0)
 F  S ORI=+$O(^ORE(100.2,"DAD",OREVT,ORI)) Q:ORI<1  S ORX=ORX_U_ORI
"RTN","ORMEVNT1",88,0)
 F ORV=1:1:$L(ORX,U) S OREVT=$P(ORX,U,ORV) D  ;event[+children]
"RTN","ORMEVNT1",89,0)
 . F  S ORI=$O(^OR(100,"AEVNT",ORVP,OREVT,ORI)) Q:ORI'>0  D
"RTN","ORMEVNT1",90,0)
 .. S ORIFN=ORI,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3))
"RTN","ORMEVNT1",91,0)
 .. I ORIFN=+$P($G(^ORE(100.2,OREVT,0)),U,4) D  Q  ;event order
"RTN","ORMEVNT1",92,0)
 ... Q:$$TYPE^OREVNTX(OREVT)="D"  Q:$P(OR3,U,3)=11
"RTN","ORMEVNT1",93,0)
 ... S ORPRINT=+$G(ORPRINT)+1,ORPRINT(ORPRINT)=ORIFN_";1^1^1^1^1^1"
"RTN","ORMEVNT1",94,0)
 .. Q:$P(OR3,U,3)'=10  ;released or cancelled
"RTN","ORMEVNT1",95,0)
 .. S:$G(ORL) $P(^OR(100,ORIFN,0),U,10)=ORL ;set location
"RTN","ORMEVNT1",96,0)
 .. S:$G(ORTS) $P(^OR(100,ORIFN,0),U,13)=ORTS ;set specialty
"RTN","ORMEVNT1",97,0)
 .. I $P(OR0,U,14)=ORLR,'$G(ORLAB) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORMEVNT1",98,0)
 .. K ORERR D EN1^ORCSEND(ORIFN,.ORERR) Q:$G(ORERR)
"RTN","ORMEVNT1",99,0)
 .. Q:"^10^11^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U)  D SAVE(ORIFN,OREVT,2)
"RTN","ORMEVNT1",100,0)
 .. S ORPRINT=+$G(ORPRINT)+1,ORPRINT(ORPRINT)=ORIFN_";1"_ORPARM
"RTN","ORMEVNT1",101,0)
 D BTS^ORMBLD(ORVP):$G(ORLAB) ;send batch hdr/tlr segments for labs
"RTN","ORMEVNT1",102,0)
 Q
"RTN","ORMEVNT1",103,0)
 ;
"RTN","ORMEVNT1",104,0)
XTMP ; -- Save auto-dc'd by package order numbers
"RTN","ORMEVNT1",105,0)
 N ORDC,ORIFN,X Q:'$G(OREVENT)
"RTN","ORMEVNT1",106,0)
 S ORDC="ORDC-"_$G(DGPMDA),ORIFN=0
"RTN","ORMEVNT1",107,0)
 F  S ORIFN=+$O(^XTMP(ORDC,ORIFN)) Q:ORIFN<1  S X=$G(^(ORIFN)) D
"RTN","ORMEVNT1",108,0)
 . D SAVE(ORIFN,OREVENT,3,X)
"RTN","ORMEVNT1",109,0)
 . S $P(^OR(100,+ORIFN,6),U,8)=OREVENT
"RTN","ORMEVNT1",110,0)
 Q
"RTN","ORMEVNT1",111,0)
 ;
"RTN","ORMEVNT1",112,0)
SAVE(IFN,EVT,NODE,PKG) ; -- Save order# IFN with EVT at NODE
"RTN","ORMEVNT1",113,0)
 ;    NODE=2: Released orders, NODE=3: Auto-DC'd orders
"RTN","ORMEVNT1",114,0)
 Q:'$G(IFN)!'$G(EVT)!'$G(NODE)  ;missing data
"RTN","ORMEVNT1",115,0)
 Q:$D(^ORE(100.2,EVT,NODE,+IFN,0))  ;already saved
"RTN","ORMEVNT1",116,0)
 N I,HDR,TOTAL
"RTN","ORMEVNT1",117,0)
 F I=1:1:10 L +^ORE(100.2,EVT,NODE,0):1 Q:$T  H 2
"RTN","ORMEVNT1",118,0)
 Q:'$T  S HDR=$G(^ORE(100.2,EVT,NODE,0))
"RTN","ORMEVNT1",119,0)
 I '$L(HDR) S:NODE=2 HDR="^100.26PA^^" S:NODE=3 HDR="^100.27PA^^"
"RTN","ORMEVNT1",120,0)
 Q:'$L(HDR)  S TOTAL=+$P(HDR,U,4),$P(HDR,U,3,4)=+IFN_U_(TOTAL+1)
"RTN","ORMEVNT1",121,0)
 S ^ORE(100.2,EVT,NODE,0)=HDR L -^ORE(100.2,EVT,NODE,0)
"RTN","ORMEVNT1",122,0)
 S ^ORE(100.2,EVT,NODE,+IFN,0)=+IFN_$S($D(PKG):U_PKG,1:"")
"RTN","ORMEVNT1",123,0)
 Q
"RTN","ORMEVNT1",124,0)
 ;
"RTN","ORMEVNT1",125,0)
EXP ; -- expire an order from ORMTIME
"RTN","ORMEVNT1",126,0)
 ;    from EXP^ORMEVNT(ORDER,ORSTOP)
"RTN","ORMEVNT1",127,0)
 G:'$D(^OR(100,+ORDER,0)) EXPQ
"RTN","ORMEVNT1",128,0)
 N OR0,ORNMSP,ORSTS
"RTN","ORMEVNT1",129,0)
 S OR0=$G(^OR(100,+ORDER,0)),ORSTS=$P($G(^(3)),U,3)
"RTN","ORMEVNT1",130,0)
 I "^1^2^7^12^13^14^"[(U_ORSTS_U) G EXPQ ; already expired or done
"RTN","ORMEVNT1",131,0)
 I $O(^OR(100,+ORDER,2,0)) G EXPQ ; parent
"RTN","ORMEVNT1",132,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORMEVNT1",133,0)
 D:ORNMSP="PS"!(ORNMSP="FH") MSG^ORMBLD(+ORDER,"SS")
"RTN","ORMEVNT1",134,0)
 I ORNMSP="OR"!(ORNMSP="FH"),"^1^7^"'[(U_ORSTS_U) D STATUS^ORCSAVE2(+ORDER,7) ;ck FH order status after SS update
"RTN","ORMEVNT1",135,0)
EXPQ K ^OR(100,"AE",ORSTOP,ORDER)
"RTN","ORMEVNT1",136,0)
 Q
"RTN","ORMEVNT1",137,0)
 ;
"RTN","ORMEVNT1",138,0)
ACT ; -- activate an order from ORMTIME
"RTN","ORMEVNT1",139,0)
 ;    from ACTIVE^ORMEVNT(ORDER,ORSTRT)
"RTN","ORMEVNT1",140,0)
 G:'$D(^OR(100,+ORDER,0)) ACTQ
"RTN","ORMEVNT1",141,0)
 N OR0,ORNMSP,ORSTS
"RTN","ORMEVNT1",142,0)
 S OR0=$G(^OR(100,+ORDER,0)),ORSTS=$P($G(^(3)),U,3)
"RTN","ORMEVNT1",143,0)
 I "^1^2^6^7^12^13^14^"[(U_ORSTS_U) G ACTQ ; already active or done
"RTN","ORMEVNT1",144,0)
 I $O(^OR(100,+ORDER,2,0)) G ACTQ ; parent
"RTN","ORMEVNT1",145,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORMEVNT1",146,0)
 D:ORNMSP="PS"!(ORNMSP="FH") MSG^ORMBLD(+ORDER,"SS")
"RTN","ORMEVNT1",147,0)
 I ORNMSP="OR"!(ORNMSP="FH"),ORSTS=8 D STATUS^ORCSAVE2(+ORDER,6) ;ck FH
"RTN","ORMEVNT1",148,0)
ACTQ K ^OR(100,"AD",ORSTRT,ORDER)
"RTN","ORMEVNT1",149,0)
 Q
"RTN","ORMEVNT1",150,0)
 ;
"RTN","ORMEVNT1",151,0)
PUR ; -- purge an order
"RTN","ORMEVNT1",152,0)
 ;    from PURGE^ORMEVNT(ORDER)
"RTN","ORMEVNT1",153,0)
 N ORSTS,ORPK,ORNMSP,ORCHLD Q:'$D(^OR(100,ORDER))
"RTN","ORMEVNT1",154,0)
 S ORSTS=$P($G(^OR(100,ORDER,3)),U,3),ORPK=$G(^(4)),ORNMSP=$P($G(^(0)),U,14),ORNMSP=$$NMSP^ORCD(ORNMSP)
"RTN","ORMEVNT1",155,0)
 I '$L(ORPK)!(ORSTS=11)!(ORNMSP="OR")!(ORNMSP="LR"&('ORPK)) D DELETE^ORCSAVE2(ORDER) Q
"RTN","ORMEVNT1",156,0)
 I '$D(^OR(100,ORDER,2)) D MSG^ORMBLD(ORDER,"Z@") Q
"RTN","ORMEVNT1",157,0)
 S ORCHLD=0 F  S ORCHLD=$O(^OR(100,ORDER,2,ORCHLD)) Q:ORCHLD'>0  D MSG^ORMBLD(ORCHLD,"Z@")
"RTN","ORMEVNT1",158,0)
 I '$O(^OR(100,ORDER,2,0)) D DELETE^ORCSAVE2(ORDER) ; delete parent
"RTN","ORMEVNT1",159,0)
 Q
"RTN","ORMORG")
0^40^B5388826
"RTN","ORMORG",1,0)
ORMORG ; SLC/MKB - Receive Generic Orders messages ; 08 May 2002  2:12 PM
"RTN","ORMORG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,79,141**;Dec 17, 1997
"RTN","ORMORG",3,0)
 ;
"RTN","ORMORG",4,0)
EN ; -- entry point for ORG msgs
"RTN","ORMORG",5,0)
 I '$L($T(@ORDCNTRL)) S ORERR="Invalid order control code" Q
"RTN","ORMORG",6,0)
 I 'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMORG",7,0)
 D @ORDCNTRL
"RTN","ORMORG",8,0)
 Q
"RTN","ORMORG",9,0)
 ;
"RTN","ORMORG",10,0)
XO ; -- edited order
"RTN","ORMORG",11,0)
NW ; -- new order
"RTN","ORMORG",12,0)
 N OR0,OR3,ORSTS,ORSTRT,ORSTOP,ORIG,ORTYP,ORNOW,OREVT
"RTN","ORMORG",13,0)
 S ^OR(100,+ORIFN,4)=+ORIFN,OR0=$G(^(0)),OR3=$G(^(3))
"RTN","ORMORG",14,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORSTRT=$P(OR0,U,8),OREVT=+$P(OR0,U,17)
"RTN","ORMORG",15,0)
 I 'ORSTRT S ORSTRT=ORNOW D DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMORG",16,0)
 S ORSTS=$S(ORSTRT>ORNOW:8,1:6) D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMORG",17,0)
 ;I OREVT,$P($G(^ORE(100.2,OREVT,0)),U,4)=+ORIFN,$G(^(1)) D COMP^ORCSAVE2(ORIFN)
"RTN","ORMORG",18,0)
 S ORIG=+$P(OR3,U,5),ORTYP=$P(OR3,U,11) I ORIG,ORTYP D  ;edit or renewal
"RTN","ORMORG",19,0)
 . S (ORSTOP,ORSTS)=""
"RTN","ORMORG",20,0)
 . S:ORTYP=1 ORSTOP=ORNOW,ORSTS=12 I ORTYP=2 D
"RTN","ORMORG",21,0)
 .. N STOP,STS S STOP=$P($G(^OR(100,ORIG,0)),U,9),STS=$P($G(^(3)),U,3)
"RTN","ORMORG",22,0)
 .. I "^1^2^7^12^13^"[(U_STS_U),STOP'>ORNOW Q  ;already terminated
"RTN","ORMORG",23,0)
 .. S ORSTOP=$S(STOP'>ORNOW:"",ORSTRT<ORNOW:ORNOW,1:ORSTRT)
"RTN","ORMORG",24,0)
 .. S ORSTS=$S("^1^2^7^12^13^"[(U_STS_U):"",ORSTOP>ORNOW:15,1:7)
"RTN","ORMORG",25,0)
 . D:ORSTOP DATES^ORCSAVE2(ORIG,,ORSTOP)
"RTN","ORMORG",26,0)
 . D:ORSTS STATUS^ORCSAVE2(ORIG,ORSTS)
"RTN","ORMORG",27,0)
 . S:'OREVT OREVT=+$P($G(^OR(100,ORIG,0)),U,17)
"RTN","ORMORG",28,0)
 . I OREVT,$P($G(^ORE(100.2,OREVT,0)),U,4)=ORIG,'$G(^(1)) D
"RTN","ORMORG",29,0)
 .. K ^ORE(100.2,"AO",OREVT,ORIG)
"RTN","ORMORG",30,0)
 .. S $P(^ORE(100.2,OREVT,0),U,4)=+ORIFN,^ORE(100.2,"AO",OREVT,+ORIFN)=""
"RTN","ORMORG",31,0)
 .. S:'$P(OR0,U,17) $P(^OR(100,+ORIFN,0),U,17)=OREVT,^OR(100,"AEVNT",ORVP,OREVT,+ORIFN)=""
"RTN","ORMORG",32,0)
 Q
"RTN","ORMORG",33,0)
 ;
"RTN","ORMORG",34,0)
CA ; -- cancel
"RTN","ORMORG",35,0)
DC ; -- discontinue
"RTN","ORMORG",36,0)
 D STATUS^ORCSAVE2(+ORIFN,1) ;also sets stop date
"RTN","ORMORG",37,0)
 Q
"RTN","ORMORG",38,0)
 ;
"RTN","ORMORG",39,0)
HD ; -- hold
"RTN","ORMORG",40,0)
 D STATUS^ORCSAVE2(+ORIFN,3)
"RTN","ORMORG",41,0)
 Q
"RTN","ORMORG",42,0)
 ;
"RTN","ORMORG",43,0)
RL ; -- release hold
"RTN","ORMORG",44,0)
 N STS,NOW,ORSTRT,ORSTOP
"RTN","ORMORG",45,0)
 S ORSTRT=$P(^OR(100,+ORIFN,0),U,8),ORSTOP=$P(^(0),U,9),NOW=$$NOW^XLFDT
"RTN","ORMORG",46,0)
 S STS=$S(ORSTRT>NOW:8,'ORSTOP:6,ORSTOP'>NOW:7,1:6)
"RTN","ORMORG",47,0)
 D STATUS^ORCSAVE2(+ORIFN,STS)
"RTN","ORMORG",48,0)
 Q
"RTN","ORMPS")
0^66^B65024731
"RTN","ORMPS",1,0)
ORMPS ; SLC/MKB - Process Pharmacy ORM msgs ;3/8/02  13:05
"RTN","ORMPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,54,62,86,92,94,116,138,152,141**;Dec 17, 1997
"RTN","ORMPS",3,0)
EN ; -- entry point for PS messages
"RTN","ORMPS",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMPS",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZC",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMPS",6,0)
 N ORSTS,RXE,ZRX,ORWHO,ORNOW
"RTN","ORMPS",7,0)
 S ORSTS=$$STATUS(ORDSTS),RXE=$$RXE,ZRX=$$ZRX D QT^ORMPS1 ;QT in RXE
"RTN","ORMPS",8,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORWHO=+$P(ZRX,"|",6) S:'ORWHO ORWHO=DUZ
"RTN","ORMPS",9,0)
 S:ORLOG ORLOG=+$E(ORLOG,1,12) ;no seconds
"RTN","ORMPS",10,0)
 S:'$L(ORNATR) ORNATR=$P(ZRX,"|",3) S:OREASON["^" OREASON=$P(OREASON,U,5)
"RTN","ORMPS",11,0)
 I ORNATR="D",'$L(OREASON) S OREASON="DUPLICATE"
"RTN","ORMPS",12,0)
 D @ORDCNTRL
"RTN","ORMPS",13,0)
 Q
"RTN","ORMPS",14,0)
 ;
"RTN","ORMPS",15,0)
ZV ; -- Verified
"RTN","ORMPS",16,0)
 N ORDA,ORUSR S ORDA=+$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORMPS",17,0)
 Q:$P($G(^OR(100,+ORIFN,8,ORDA,0)),U,8)  ;already verified
"RTN","ORMPS",18,0)
 S ORUSR=+$P(ORC,"|",12) Q:'ORUSR
"RTN","ORMPS",19,0)
 D VERIFY^ORCSAVE2(+ORIFN,ORDA,"N",ORUSR,ORLOG)
"RTN","ORMPS",20,0)
 Q
"RTN","ORMPS",21,0)
 ;
"RTN","ORMPS",22,0)
ZP ; -- Purged
"RTN","ORMPS",23,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMPS",24,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^15^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ;Remove pkg reference, sts=lapsed if still active
"RTN","ORMPS",25,0)
 Q
"RTN","ORMPS",26,0)
 ;
"RTN","ORMPS",27,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMPS",28,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMPS",29,0)
 Q
"RTN","ORMPS",30,0)
 ;
"RTN","ORMPS",31,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMPS",32,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ;update Last Activity
"RTN","ORMPS",33,0)
 Q
"RTN","ORMPS",34,0)
 ;
"RTN","ORMPS",35,0)
XR ; -- Changed as requested [ack]
"RTN","ORMPS",36,0)
 N ORIG S ORIG=$P(^OR(100,+ORIFN,3),U,5) I ORIG,$P(^OR(100,ORIG,3),U,3)'=12 D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORMPS",37,0)
OK ; -- Order accepted, PS order # assigned [ack]
"RTN","ORMPS",38,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ;PS identifier
"RTN","ORMPS",39,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",40,0)
 Q
"RTN","ORMPS",41,0)
 ;
"RTN","ORMPS",42,0)
ZC ; -- Convert existing 2.5 orders to 3.0 format
"RTN","ORMPS",43,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT
"RTN","ORMPS",44,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",45,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",46,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",47,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J)
"RTN","ORMPS",48,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1")
"RTN","ORMPS",49,0)
ZC1 ; continue ... save responses, post reply
"RTN","ORMPS",50,0)
 Q:$D(ORERR)  I 'ORIFN!('$D(^OR(100,+ORIFN,0))) D  Q  ;create
"RTN","ORMPS",51,0)
 . K ORIFN D SN1 Q:'$G(ORIFN)  S ORDCNTRL="SN"
"RTN","ORMPS",52,0)
 . I ORSTOP,ORSTOP<ORNOW S $P(^OR(100,ORIFN,3),U)=ORSTOP
"RTN","ORMPS",53,0)
 S ORIFN=+ORIFN D RESPONSE^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",54,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(0),U,5)=+ORDIALOG_";ORD(101.41,"
"RTN","ORMPS",55,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP),STATUS^ORCSAVE2(ORIFN,ORSTS):ORSTS
"RTN","ORMPS",56,0)
 Q
"RTN","ORMPS",57,0)
 ;
"RTN","ORMPS",58,0)
SN ; -- New backdoor order, return OE# via NA msg
"RTN","ORMPS",59,0)
 I $$FINISHED^ORMPS2 D RO^ORMPS2 Q  ;change action instead
"RTN","ORMPS",60,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT,ZSC
"RTN","ORMPS",61,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",62,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",63,0)
 ; I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMPS",64,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",65,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J),ORIFN
"RTN","ORMPS",66,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS",67,0)
SN1 ; continue ... save order, post messsage
"RTN","ORMPS",68,0)
 D EN^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",69,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMPS",70,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4) I ORIG D  ;set fwd/bwd ptrs
"RTN","ORMPS",71,0)
 . S TYPE=$S(TYPE="E":1,TYPE="R":2,1:0)
"RTN","ORMPS",72,0)
 . S $P(^OR(100,ORIFN,3),U,5)=ORIG,$P(^(3),U,11)=TYPE
"RTN","ORMPS",73,0)
 . I $D(^OR(100,ORIG,0)) S $P(^(3),U,6)=ORIFN,EVNT=$P(^(0),U,17) I $L(EVNT),TYPE=1 S $P(^OR(100,ORIFN,0),U,17)=EVNT
"RTN","ORMPS",74,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",75,0)
SN2 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",76,0)
 D:ORSTS STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMPS",77,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR)
"RTN","ORMPS",78,0)
 ; if unsigned edit, leave ORIFN unsigned & mark ORIG as Sig Not Req'd
"RTN","ORMPS",79,0)
 S ORSIG=$S('ORIG:1,TYPE'=1:1,$P($G(^OR(100,ORIG,8,1,0)),U,4)'=2:1,1:0)
"RTN","ORMPS",80,0)
 D SIGSTS^ORCSAVE2(ORIFN,1):ORSIG,SIGN^ORCSAVE2(ORIG,,,5,1):'ORSIG
"RTN","ORMPS",81,0)
 I ORDCNTRL="SN" D  ;print
"RTN","ORMPS",82,0)
 . S:ORNATR="" $P(^OR(100,ORIFN,8,1,0),U,12)="" ;CHCS/OP orders
"RTN","ORMPS",83,0)
 . S ORP(1)=ORIFN_";1"_$S(ORNATR="":"^^^^1",$G(ORL):"^1",1:"")
"RTN","ORMPS",84,0)
 . I ORP(1)["^" D PRINTS^ORWD1(.ORP,+$G(ORL))
"RTN","ORMPS",85,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMPS",86,0)
 Q
"RTN","ORMPS",87,0)
 ;
"RTN","ORMPS",88,0)
XX ; -- Changed (new order not necessary)
"RTN","ORMPS",89,0)
 Q:$P($G(^OR(100,+ORIFN,3)),U,3)=5  ;pending - update when finished
"RTN","ORMPS",90,0)
 I '$$CHANGED^ORMPS2 D SC Q  ;ck sts/dates only
"RTN","ORMPS",91,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS",92,0)
 S:ORNATR="" ORNATR="S" D RO^ORMPS2
"RTN","ORMPS",93,0)
 Q
"RTN","ORMPS",94,0)
 ;
"RTN","ORMPS",95,0)
SC ; -- Status changed (verified, expired, suspended, renewed, reinstate)
"RTN","ORMPS",96,0)
 N OR0,OR3,ZSC S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORMPS",97,0)
 I $P(OR3,U,3)=5,ORSTS=6,$$CHANGED^ORMPS2 S ORNATR="S" D RO^ORMPS2 Q
"RTN","ORMPS",98,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",99,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",100,0)
 I ORSTS=$P(OR3,U,3),ORSTOP'=$P(OR0,U,9) D SETALL^ORDD100(+ORIFN) ;AC xrf
"RTN","ORMPS",101,0)
 S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",102,0)
 I "^1^13^"[(U_$P(OR3,U,3)_U),"^3^5^6^15^"[(U_ORSTS_U) D  ;reinstated
"RTN","ORMPS",103,0)
 . I $P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="DC" S ^(2)=ORNOW_U_ORWHO ; When^Who reinstated order
"RTN","ORMPS",104,0)
 . S I="?" F  S I=$O(^OR(100,+ORIFN,8,I),-1) Q:'+I  I $P(^(I,0),U,15)="" S $P(^OR(100,+ORIFN,3),U,7)=I Q  ;138 Finds current action
"RTN","ORMPS",105,0)
 . K ^OR(100,+ORIFN,6) D SETALL^ORDD100(+ORIFN)
"RTN","ORMPS",106,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,+ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",107,0)
 Q
"RTN","ORMPS",108,0)
 ;
"RTN","ORMPS",109,0)
STATUS(X) ; -- Returns order status from HL7 code
"RTN","ORMPS",110,0)
 N Y S Y=$S(X="IP":5,X="CM":6,X="DC":1,X="ZE":7,X="HD":3,X="ZX":11,X="RP":12,X="ZZ":15,X="ZS":6,X="ZU":6,1:"")
"RTN","ORMPS",111,0)
 Q Y
"RTN","ORMPS",112,0)
 ;
"RTN","ORMPS",113,0)
DE ; -- Data Errors in SS msg
"RTN","ORMPS",114,0)
 Q
"RTN","ORMPS",115,0)
 ;
"RTN","ORMPS",116,0)
UA ; -- Unable to accept [ack]
"RTN","ORMPS",117,0)
UX ; -- Unable to change [ack]
"RTN","ORMPS",118,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMPS",119,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORNOW_U_U_OREASON
"RTN","ORMPS",120,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr if pending renewal
"RTN","ORMPS",121,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMPS",122,0)
UC ; -- Unable to cancel [ack]
"RTN","ORMPS",123,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMPS",124,0)
UH ; -- Unable to hold [ack]
"RTN","ORMPS",125,0)
UR ; -- Unable to release hold [ack]
"RTN","ORMPS",126,0)
 N ORDA S ORDA=+$P(ORIFN,";",2) I ORDA D
"RTN","ORMPS",127,0)
 . S $P(^OR(100,+ORIFN,8,ORDA,0),U,15)=13 ;request rejected
"RTN","ORMPS",128,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,ORDA,1)=OREASON
"RTN","ORMPS",129,0)
 Q
"RTN","ORMPS",130,0)
 ;
"RTN","ORMPS",131,0)
OC ; -- Cancelled (prior to pharmacist's verification)
"RTN","ORMPS",132,0)
 G:ORTYPE="ORR" UA S:ORNATR="A" ORWHO=""
"RTN","ORMPS",133,0)
 S:'ORSTS ORSTS=13 S:ORSTS=12 ORNATR="S"
"RTN","ORMPS",134,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",135,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr when pending renewal cancelled
"RTN","ORMPS",136,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",137,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",138,0)
 Q
"RTN","ORMPS",139,0)
 ;
"RTN","ORMPS",140,0)
CR ; -- Cancelled [ack]
"RTN","ORMPS",141,0)
 D STATUS^ORCSAVE2(+ORIFN,13) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",142,0)
 Q
"RTN","ORMPS",143,0)
 ;
"RTN","ORMPS",144,0)
OD ; -- Discontinued (cancelled after pharmacist's verification)
"RTN","ORMPS",145,0)
 S:'ORSTS ORSTS=1 S:ORSTS=12 ORNATR="C"
"RTN","ORMPS",146,0)
 I ORNATR="A" S ORWHO="" I $G(DGPMT)=3,$$MVT^DGPMOBS(DGPMDA) D XTMP^ORMEVNT ;save order#
"RTN","ORMPS",147,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",148,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",149,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",150,0)
 Q
"RTN","ORMPS",151,0)
 ;
"RTN","ORMPS",152,0)
DR ; -- Discontinued [ack]
"RTN","ORMPS",153,0)
 D STATUS^ORCSAVE2(+ORIFN,1) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",154,0)
 Q
"RTN","ORMPS",155,0)
 ;
"RTN","ORMPS",156,0)
OH ; -- Held
"RTN","ORMPS",157,0)
 S:'ORSTS ORSTS=3 D UPDATE(ORSTS,"HD")
"RTN","ORMPS",158,0)
 Q
"RTN","ORMPS",159,0)
 ;
"RTN","ORMPS",160,0)
HR ; -- Held [ack]
"RTN","ORMPS",161,0)
 D STATUS^ORCSAVE2(+ORIFN,3)
"RTN","ORMPS",162,0)
 Q
"RTN","ORMPS",163,0)
 ;
"RTN","ORMPS",164,0)
RL ; -- Released hold
"RTN","ORMPS",165,0)
OE ; -- Released hold
"RTN","ORMPS",166,0)
 N ORDA S ORDA=+$P(^OR(100,+ORIFN,3),U,7)
"RTN","ORMPS",167,0)
 I $P($G(^OR(100,+ORIFN,8,ORDA,0)),U,2)="HD" S $P(^(2),U,1,2)=ORNOW_U_ORWHO
"RTN","ORMPS",168,0)
 S:'$G(ORSTS) ORSTS=6 D UPDATE(ORSTS,"RL")
"RTN","ORMPS",169,0)
 Q
"RTN","ORMPS",170,0)
 ;
"RTN","ORMPS",171,0)
OR ; -- Released / [ack]
"RTN","ORMPS",172,0)
 S:'ORSTS ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",173,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",174,0)
 Q
"RTN","ORMPS",175,0)
 ;
"RTN","ORMPS",176,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMPS",177,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",178,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",179,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMPS",180,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORNOW,ORWHO)
"RTN","ORMPS",181,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS",182,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS",183,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMPS",184,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS",185,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMPS",186,0)
 I 'ORX,ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMPS",187,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMPS",188,0)
 Q
"RTN","ORMPS",189,0)
 ;
"RTN","ORMPS",190,0)
RXO() ; -- Return subscript of RXO segment
"RTN","ORMPS",191,0)
 N I,X S X="",I=$O(@ORMSG@(+ORC))
"RTN","ORMPS",192,0)
 I I,$E(@ORMSG@(I),1,3)="RXO" S X=I_U_@ORMSG@(I)
"RTN","ORMPS",193,0)
 Q X
"RTN","ORMPS",194,0)
 ;
"RTN","ORMPS",195,0)
RXE() ; -- Return subscript of RXE segment
"RTN","ORMPS",196,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",197,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXE" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",198,0)
 Q X
"RTN","ORMPS",199,0)
 ;
"RTN","ORMPS",200,0)
RXR() ; -- Return subscript of RXR segment
"RTN","ORMPS",201,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",202,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXR" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",203,0)
 Q X
"RTN","ORMPS",204,0)
 ;
"RTN","ORMPS",205,0)
RXC() ; -- Return subscript of [first] RXC segment
"RTN","ORMPS",206,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",207,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXC" S X=I Q
"RTN","ORMPS",208,0)
 Q X
"RTN","ORMPS",209,0)
 ;
"RTN","ORMPS",210,0)
ZRX() ; -- Return subscript of ZRX segment
"RTN","ORMPS",211,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",212,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZRX" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",213,0)
 Q X
"RTN","ORPR07")
0^87^B54102863
"RTN","ORPR07",1,0)
ORPR07 ; slc/dcm - Printless in Tuscaloosa ;6/10/97  15:36
"RTN","ORPR07",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**15,11,94,141**;Dec 17, 1997
"RTN","ORPR07",3,0)
ORDT(IFN,ACT) ;Get order date
"RTN","ORPR07",4,0)
 ;IFN=ORIFN
"RTN","ORPR07",5,0)
 ;ACT=DA of action
"RTN","ORPR07",6,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",7,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",8,0)
 N X,Y
"RTN","ORPR07",9,0)
 S X="" I $G(ACT) S Y=$$ACT(IFN,ACT) Q +Y
"RTN","ORPR07",10,0)
 S X=$P(^OR(100,IFN,0),"^",7)
"RTN","ORPR07",11,0)
 Q X
"RTN","ORPR07",12,0)
ACT(IFN,ACT) ;This is an action
"RTN","ORPR07",13,0)
 N X
"RTN","ORPR07",14,0)
 Q:'$D(^OR(100,+$G(IFN),8,+$G(ACT),0)) "" S X=^(0)
"RTN","ORPR07",15,0)
 Q X
"RTN","ORPR07",16,0)
VNURSE(IFN,ACT) ;Get verifying nurse data
"RTN","ORPR07",17,0)
 ;Returns 1^name^initials^title^date/time verified if data, "" if not
"RTN","ORPR07",18,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",19,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",20,0)
 N X,Y,Z S X=""
"RTN","ORPR07",21,0)
 I $G(ACT) S Y=$$ACT(IFN,ACT),Z=$G(^VA(200,+$P(Y,"^",8),0)) I $L(Z) S X=1_"^"_$P(Z,"^")_"^"_$P(Z,"^",2)_"^"_$P($G(^DIC(3.1,+$P(Z,"^",9),0)),"^")_"^"_$P(Y,"^",9)
"RTN","ORPR07",22,0)
 Q X
"RTN","ORPR07",23,0)
VCLERK(IFN,ACT) ;Get verifying clerk data
"RTN","ORPR07",24,0)
 ;Returns 1^name^initials^title^date/time verified if data, "" if not
"RTN","ORPR07",25,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",26,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",27,0)
 N X,Y,Z S X=""
"RTN","ORPR07",28,0)
 I $G(ACT) S Y=$$ACT(IFN,ACT),Z=$G(^VA(200,+$P(Y,"^",10),0)) I $L(Z) S X=1_"^"_$P(Z,"^")_"^"_$P(Z,"^",2)_"^"_$P($G(^DIC(3.1,+$P(Z,"^",9),0)),"^")_"^"_$P(Y,"^",11)
"RTN","ORPR07",29,0)
 Q X
"RTN","ORPR07",30,0)
RVIEW(IFN,ACT) ;Get Chart reviewed by data
"RTN","ORPR07",31,0)
 ;Returns 1^name^initials^titel^date/time reviewed, "" if not
"RTN","ORPR07",32,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",33,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",34,0)
 N X,Y,Z S X=""
"RTN","ORPR07",35,0)
 I $G(ACT) S Y=$$ACT(IFN,ACT),Z=$G(^VA(200,+$P(Y,"^",18),0)) I $L(Z) S X=1_"^"_$P(Z,"^")_"^"_$P(Z,"^",2)_"^"_$P($G(^DIC(3.1,+$P(Z,"^",9),0)),"^")_"^"_$P(Y,"^",19)
"RTN","ORPR07",36,0)
 Q X
"RTN","ORPR07",37,0)
ORDOC(IFN,ACT) ;Get Ordering provider
"RTN","ORPR07",38,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",39,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",40,0)
 N X,Y,Z
"RTN","ORPR07",41,0)
 S X=""
"RTN","ORPR07",42,0)
 I $G(ACT) S Y=$$ACT(IFN,ACT),Z=$G(^VA(200,+$P(Y,"^",3),0)) I $L(Z) S X=$P(Z,"^")
"RTN","ORPR07",43,0)
 I '$L(X) S Y=$P(^OR(100,IFN,0),"^",4),Z=$G(^VA(200,+Y,0)) I $L(Z) S X=$P(Z,"^")
"RTN","ORPR07",44,0)
 Q X
"RTN","ORPR07",45,0)
PHONE(IFN,ACT,PIECE) ;Get Ordering provider's phone number (multiple choice)
"RTN","ORPR07",46,0)
 ;PIECE=the piece of data to get from node ^VA(200,DUZ,.13)
"RTN","ORPR07",47,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",48,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",49,0)
 Q:'$G(PIECE)
"RTN","ORPR07",50,0)
 N X,Y,Z
"RTN","ORPR07",51,0)
 S X=""
"RTN","ORPR07",52,0)
 I $G(ACT) S Y=$$ACT(IFN,ACT),Z=$G(^VA(200,+$P(Y,"^",3),.13)) I $L(Z) S X=$P(Z,"^",PIECE) Q X
"RTN","ORPR07",53,0)
 S Y=$P(^OR(100,IFN,0),"^",4) S:Y X=$P($G(^VA(200,Y,.13)),"^",PIECE)
"RTN","ORPR07",54,0)
 Q X
"RTN","ORPR07",55,0)
NAT(IFN,ACT) ;Get Nature of order
"RTN","ORPR07",56,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",57,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",58,0)
 N X,Y
"RTN","ORPR07",59,0)
 S X=""
"RTN","ORPR07",60,0)
 I $G(ACT) S Y=$P($$ACT(IFN,ACT),"^",12),X=$S($D(^ORD(100.02,+Y,0)):$P(^(0),"^"),1:"")
"RTN","ORPR07",61,0)
 Q X
"RTN","ORPR07",62,0)
ESNAME(IFN,ACT) ;Get Electronic Sig Name
"RTN","ORPR07",63,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",64,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",65,0)
 N X,Y
"RTN","ORPR07",66,0)
 S X=""
"RTN","ORPR07",67,0)
 I $G(ACT) S Y=$$ACT(IFN,ACT) D  Q X
"RTN","ORPR07",68,0)
 . I $P(Y,"^",5) S X=$P($G(^VA(200,$P(Y,"^",5),20)),"^",2) S:$L(X) X=$S($P(Y,"^",4)=7:"/ds/",1:"/es/")_X Q
"RTN","ORPR07",69,0)
 . I $P(Y,"^",4),"42"[$P(Y,"^",4) S X="_______________" Q
"RTN","ORPR07",70,0)
 Q X
"RTN","ORPR07",71,0)
ESTIT(IFN,ACT) ;Get Electronic Sig Title
"RTN","ORPR07",72,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",73,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",74,0)
 N X,Y
"RTN","ORPR07",75,0)
 S X="" I $G(ACT) S Y=$$ACT(IFN,ACT) S:$P(Y,"^",5) X=$E($P($G(^VA(200,$P(Y,"^",5),20)),"^",3),1,20)
"RTN","ORPR07",76,0)
 Q X
"RTN","ORPR07",77,0)
ESDATE(IFN,ACT) ;Get Electronic Sig Date
"RTN","ORPR07",78,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",79,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",80,0)
 N X
"RTN","ORPR07",81,0)
 S X=""
"RTN","ORPR07",82,0)
 I $G(ACT) S X=$P($$ACT(IFN,ACT),"^",6)
"RTN","ORPR07",83,0)
 Q X
"RTN","ORPR07",84,0)
ESODATE(IFN,ACT) ;Get Date/time Signed online
"RTN","ORPR07",85,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",86,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",87,0)
 N X
"RTN","ORPR07",88,0)
 S X=""
"RTN","ORPR07",89,0)
 I $G(ACT),$P($$ACT(IFN,ACT),"^",4)=1 S X=$P($$ACT(IFN,ACT),"^",6)
"RTN","ORPR07",90,0)
 Q X
"RTN","ORPR07",91,0)
ENTBY(IFN,ACT) ;Get Entered by
"RTN","ORPR07",92,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",93,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",94,0)
 N X,Y
"RTN","ORPR07",95,0)
 S X="" I $G(ACT) S Y=$$ACT(IFN,ACT) S:$P(Y,"^",13) X=$P($G(^VA(200,$P(Y,"^",13),0)),"^") Q X
"RTN","ORPR07",96,0)
 S X=$P(^OR(100,IFN,0),"^",6) S:X X=$P(^VA(200,X,0),"^")
"RTN","ORPR07",97,0)
 Q X
"RTN","ORPR07",98,0)
ENTINT(IFN,ACT) ;Get Entered by Initials
"RTN","ORPR07",99,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",100,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",101,0)
 N X,Y
"RTN","ORPR07",102,0)
 S X="" I $G(ACT) S Y=$$ACT(IFN,ACT) S:$P(Y,"^",13) X=$P($G(^VA(200,$P(Y,"^",13),0)),"^",2) Q X
"RTN","ORPR07",103,0)
 S X=$P(^OR(100,IFN,0),"^",6) S:X X=$P(^VA(200,X,0),"^",2)
"RTN","ORPR07",104,0)
 Q X
"RTN","ORPR07",105,0)
ENTIT(IFN,ACT) ;Get Electronic Sig Title of Entering Person
"RTN","ORPR07",106,0)
 Q:'$G(IFN) ""
"RTN","ORPR07",107,0)
 Q:'$D(^OR(100,IFN,0)) ""
"RTN","ORPR07",108,0)
 N X,Y
"RTN","ORPR07",109,0)
 S X="" I $G(ACT) S Y=$$ACT(IFN,ACT) S:$P(Y,"^",13) X=$E($P($G(^VA(200,$P(Y,"^",13),20)),"^",3),1,20) Q X
"RTN","ORPR07",110,0)
 S X=$P(^OR(100,IFN,0),"^",6) S:X X=$E($P(^VA(200,X,20),"^",3),1,20)
"RTN","ORPR07",111,0)
 Q X
"RTN","ORPR07",112,0)
BY(ORIFN) ;Get DC info for DC by & when PRINT FIELD
"RTN","ORPR07",113,0)
 Q:'$G(ORIFN) ""
"RTN","ORPR07",114,0)
 N Y,Z,X6,X1,ORDCBY
"RTN","ORPR07",115,0)
 I $P($G(^OR(100,ORIFN,6)),"^",2) S X6=^(6) D  Q ORDCBY
"RTN","ORPR07",116,0)
 . S Y=+$J($P(X6,"^",3),0,4),Z=$G(^VA(200,+$P(X6,"^",2),0)) I $L(Z) S X1=$P(Z,"^")_$S($P(Z,"^",9):" ("_$E($P(^DIC(3.1,$P(Z,"^",9),0),"^"),1,10)_")",1:""),Y=$$DATE^ORU(Y)_" "_$$TIME^ORU(Y)
"RTN","ORPR07",117,0)
 . S ORDCBY="DC'ed "_$S(+$P(X6,"^",4):"("_$P(^ORD(100.03,+$P(X6,"^",4),0),"^")_")",1:"")_" by:"_X1_" "_Y
"RTN","ORPR07",118,0)
 Q ""
"RTN","ORPR07",119,0)
WARDREM(ORIFN) ;Get Ward Remarks
"RTN","ORPR07",120,0)
 N ORI,X
"RTN","ORPR07",121,0)
 S X=""
"RTN","ORPR07",122,0)
 I $G(ORIFN) S ORI=$O(^OR(100,ORIFN,4.5,"ID","COMMENT",0)) I ORI S X="^OR(100,"_+ORIFN_",4.5,"_ORI_",2)"
"RTN","ORPR07",123,0)
 Q X
"RTN","ORPR07",124,0)
RX(IFN,FLD,Y) ;Get Pharmacy Fields
"RTN","ORPR07",125,0)
 ;IFN=internal # of 100
"RTN","ORPR07",126,0)
 ;FLD=code for RX field to lookup
"RTN","ORPR07",127,0)
 ;Y=output returned in Y
"RTN","ORPR07",128,0)
 Q:'$G(IFN)  Q:'$L($G(FLD))
"RTN","ORPR07",129,0)
 Q:'$D(^OR(100,IFN,0))
"RTN","ORPR07",130,0)
 N X,X4,PKG,DFN,I S X=^OR(100,IFN,0),X4=$G(^(4)) Q:'$L(X4)
"RTN","ORPR07",131,0)
 S PKG=$P(X,"^",14) Q:'PKG
"RTN","ORPR07",132,0)
 S PKG=$S($P(^DIC(9.4,PKG,0),"^")="INPATIENT MEDICATIONS":"I",$P(^(0),"^")="OUTPATIENT MEDICATIONS":"O",$P(^(0),"^")="IV MEDICATIONS":"I",$P(^(0),"^")="UNIT DOSE MEDICATIONS":"I",1:"") Q:'$L(PKG)
"RTN","ORPR07",133,0)
 S DFN=+$P(X,"^",2)
"RTN","ORPR07",134,0)
 D OEL^PSOORRL(DFN,X4_";"_PKG)
"RTN","ORPR07",135,0)
 I FLD="SI" S Y=$P($G(^TMP("PS",$J,"SI")),"^",1,99) Q  ;Special Instructions
"RTN","ORPR07",136,0)
 I FLD="SCH" S I=0 D  Q  ;Schedule & Admin Times
"RTN","ORPR07",137,0)
 . F  S I=$O(^TMP("PS",$J,"SCH",I)) Q:I<1  S Y(I)=$P(^(I,0),"^") ;_"  "_$P(^(0),"^",2)
"RTN","ORPR07",138,0)
 I FLD="OTH" S Y=$P($G(^TMP("PS",$J,"OPI")),1,99) Q  ;Other print info
"RTN","ORPR07",139,0)
 I FLD="DRUG" S Y=$P($G(^TMP("PS",$J,0)),"^") Q  ;Drug
"RTN","ORPR07",140,0)
 I FLD="INF" S Y=$P($G(^TMP("PS",$J,0)),"^",2) Q  ;Infusion rate
"RTN","ORPR07",141,0)
 I FLD="STOP" S Y=$P($G(^TMP("PS",$J,0)),"^",3) Q  ;Stop date
"RTN","ORPR07",142,0)
 I FLD="REFIL" S Y=$P($G(^TMP("PS",$J,0)),"^",4) Q  ;Refills
"RTN","ORPR07",143,0)
 I FLD="MDRT" S I=0 D  Q  ;Med Route
"RTN","ORPR07",144,0)
 . F  S I=$O(^TMP("PS",$J,"MDR",I)) Q:I<1  S Y(I)=^(I,0)
"RTN","ORPR07",145,0)
 I FLD="SIG" S I=0 D  Q  ;SIG (outpat) Instructions (inpat)
"RTN","ORPR07",146,0)
 . F  S I=$O(^TMP("PS",$J,"SIG",I)) Q:I<1  S Y(I)=^(I,0)
"RTN","ORPR07",147,0)
 I FLD="PC" S I=0 D  Q  ;Provider comments
"RTN","ORPR07",148,0)
 . F  S I=$O(^TMP("PS",$J,"PC",I)) Q:I<1  S Y(I)=^(I,0)
"RTN","ORPR07",149,0)
 I FLD="ADD" S I=0 D  Q  ;Additive, amount, bottle
"RTN","ORPR07",150,0)
 . F  S I=$O(^TMP("PS",$J,"A",I)) Q:I<1  S Y(I)=$P(^(I,0),"^")_"  "_$P(^(0),"^",2)_"  #"_$P(^(0),"^",3)
"RTN","ORPR07",151,0)
 I FLD="SOL" S I=0 D  Q  ;Solution & amount
"RTN","ORPR07",152,0)
 . F  S I=$O(^TMP("PS",$J,"B",I)) Q:I<1  S Y(I)=$P(^(I,0),"^")_"  "_$P(^(0),"^",2)
"RTN","ORPR07",153,0)
 Q
"RTN","ORPR07",154,0)
TEST ;Test RX call
"RTN","ORPR07",155,0)
 W !,"Enter Pharmacy Order # (ORIFN): " R X:DTIME Q:X=""!(X["^")  I '$D(^OR(100,+$G(X),0)) W !,$C(7),X_" does not exist" G TEST
"RTN","ORPR07",156,0)
 S ORIFN=X F ORI="SCH","SI","ADM","OTH","DRUG","INF","STOP","REFIL","MDRT","SIG","PC","ADD","SOL" K TEST D RX(ORIFN,ORI,.TEST) I $D(TEST) W !,ORI_"- " ;ZW TEST
"RTN","ORPR07",157,0)
 Q
"RTN","ORPR07",158,0)
LABEL(Y,ORIFN,QUIET,OACTION) ;Print pharmacy label
"RTN","ORPR07",159,0)
 I $G(ORTEST) D TEST1 Q
"RTN","ORPR07",160,0)
 N X,X4,ORC
"RTN","ORPR07",161,0)
 Q:'$D(^OR(100,+$G(ORIFN),0))  Q:'$L($G(^(4)))  S X=^(0),X4=^(4)
"RTN","ORPR07",162,0)
 I $S($P($G(^DIC(9.4,+$P(X,"^",14),0)),"^")="INPATIENT MEDICATIONS":0,$P($G(^DIC(9.4,+$P(X,"^",14),0)),"^")="IV MEDICATIONS":0,$P($G(^DIC(9.4,+$P(X,"^",14),0)),"^")="UNIT DOSE MEDICATIONS":0,1:1) Q
"RTN","ORPR07",163,0)
 N LINES,ORXPTMP,I,ACT
"RTN","ORPR07",164,0)
 I $G(OACTION),$D(^OR(100,+$G(ORIFN),8,OACTION,0)) S ACT=$P(^(0),"^",2)
"RTN","ORPR07",165,0)
 I $L($T(MAR^PSJORMAR),",")>4 D MAR^PSJORMAR(+$P(X,"^",2),$P(X4,"^"),1,.LINES,$G(ACT))
"RTN","ORPR07",166,0)
 I $L($T(MAR^PSJORMAR),",")'>4 D MAR^PSJORMAR(+$P(X,"^",2),$P(X4,"^"),1,.LINES)
"RTN","ORPR07",167,0)
 I $G(QUIET) K Y S (I,Y)=0 D  Q
"RTN","ORPR07",168,0)
 . F  S I=$O(LINES(I)) Q:'I  S Y(I,0)=LINES(I),ORPICKUP=I
"RTN","ORPR07",169,0)
 S (ORC,I)=0
"RTN","ORPR07",170,0)
 I '$D(ORIOSL) N ORIOSL S ORIOSL=$S($D(IOSL):IOSL,1:50)
"RTN","ORPR07",171,0)
 I '$D(ORIOF) N ORIOF S ORIOF=$S($D(IOF):IOF,1:"!")
"RTN","ORPR07",172,0)
 F  S I=$O(LINES(I)) Q:I<1  S ORC=ORC+1 D
"RTN","ORPR07",173,0)
 . I $Y>(ORIOSL-2) W @ORIOF S ORC=1
"RTN","ORPR07",174,0)
 . W:ORC>1 ! W LINES(I)
"RTN","ORPR07",175,0)
 Q
"RTN","ORPR07",176,0)
TEST1 ;Print test label
"RTN","ORPR07",177,0)
 W !,"03/03 |            |               (F1990)|"
"RTN","ORPR07",178,0)
 W !,"Test Pharmacy Label"
"RTN","ORPR07",179,0)
 W !,"Give: 1GM TOP QD"
"RTN","ORPR07",180,0)
 W !!,"                       RPH: _____RN: _____|"
"RTN","ORPR07",181,0)
 Q
"RTN","ORQ1")
0^32^B9817671
"RTN","ORQ1",1,0)
ORQ1 ;slc/dcm-Get orders for a patient. ; 08 May 2002  2:12 PM
"RTN","ORQ1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,72,78,141**;Dec 17, 1997
"RTN","ORQ1",3,0)
EN(PAT,GROUP,FLG,EXPAND,SDATE,EDATE,DETAIL,MULT,XREF,GETKID,EVENT) ;Get orders
"RTN","ORQ1",4,0)
 ; Returns orders in ^TMP("ORR",$J,ORLIST,i) for defined context:
"RTN","ORQ1",5,0)
 ;
"RTN","ORQ1",6,0)
 ; PAT  =patient variable ptr in format "DFN;DPT("
"RTN","ORQ1",7,0)
 ; GROUP=Display group
"RTN","ORQ1",8,0)
 ; FLG  =#:                Includes status:
"RTN","ORQ1",9,0)
 ; 1. All               => 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
"RTN","ORQ1",10,0)
 ; 2. Active/Current    =>     3,4,5,6,  8,9,   11,         15
"RTN","ORQ1",11,0)
 ;    Includes CONTEXT HRS 1,2,7,13 & Action Status=13
"RTN","ORQ1",12,0)
 ;                         Orders in ^OR(100,"AC",PAT,TM,IFN,ACTION)
"RTN","ORQ1",13,0)
 ; 3. Discontinued      => 1                       12,13
"RTN","ORQ1",14,0)
 ; 4. Completed/Expired =>   2,        7
"RTN","ORQ1",15,0)
 ; 5. Expiring          =>     3,4,5,6,  8,9
"RTN","ORQ1",16,0)
 ; 6. Recent Activity   => 1,2,3,4,5,6,7,8,9,      12,      15
"RTN","ORQ1",17,0)
 ;                         Orders in ^OR(100,"AR",PAT,TM,IFN,ACTION)
"RTN","ORQ1",18,0)
 ; 7. Pending           =>         5
"RTN","ORQ1",19,0)
 ; 8. Unverified        => 1,  3,4,5,6,  8,9,               15
"RTN","ORQ1",20,0)
 ; 9. Unverified/Nurse  => 1,  3,4,5,6,  8,9,               15
"RTN","ORQ1",21,0)
 ;10. Unverified/Clerk  => 1,  3,4,5,6,  8,9,               15
"RTN","ORQ1",22,0)
 ;11. Unsigned          => 1,2,3,4,5,6,7,8,9,10,11,   13,14,15
"RTN","ORQ1",23,0)
 ;                         Orders in ^OR(100,"AS",PAT,TM,IFN)
"RTN","ORQ1",24,0)
 ;12. Flagged           => 1,2,3,4,5,6,7,8,9,      12,13,14,15
"RTN","ORQ1",25,0)
 ;13. Verbal/Phoned     => 1,2,3,4,5,6,7,8,9,         13,14,15
"RTN","ORQ1",26,0)
 ;                         Nature of order of verbal or phoned
"RTN","ORQ1",27,0)
 ;14. Verb/Phn unsigned => 1,2,3,4,5,6,7,8,9,         13,14,15
"RTN","ORQ1",28,0)
 ;                         Nature of order V or P & unsigned
"RTN","ORQ1",29,0)
 ;15. Admission         =>           6,      10
"RTN","ORQ1",30,0)
 ;16. Discharge         =>           6,      10
"RTN","ORQ1",31,0)
 ;17. Transfer          =>           6,      10
"RTN","ORQ1",32,0)
 ;                         Orders in ^OR(100,"AEVNT",PAT,EVENT,IFN)
"RTN","ORQ1",33,0)
 ;18. On Hold           =>     3
"RTN","ORQ1",34,0)
 ;19. New Orders        =>                   10,11
"RTN","ORQ1",35,0)
 ;                         Orders in ^TMP("ORNEW",$J,ORIFN)
"RTN","ORQ1",36,0)
 ;20. Chart Review      => 1,  3,4,5,6,  8,9,               15
"RTN","ORQ1",37,0)
 ;21. Chart Copy Summary=> same as All w/screen on Nature of order
"RTN","ORQ1",38,0)
 ;22. Lapsed            =>                               14
"RTN","ORQ1",39,0)
 ;23. Active status     =>         5,6
"RTN","ORQ1",40,0)
 ;24. All Delayed       =>           6,      10
"RTN","ORQ1",41,0)
 ;25. Out of OR         =>           6,      10
"RTN","ORQ1",42,0)
 ;26. Manual Release    =>           6,      10
"RTN","ORQ1",43,0)
 ;                         Orders in ^OR(100,"AEVNT",PAT,EVENT,IFN)
"RTN","ORQ1",44,0)
EN0 ; where order status=#:
"RTN","ORQ1",45,0)
 ; 1 => Discontinued (dc) 6 => Active (a)           11 => Unreleased (u)
"RTN","ORQ1",46,0)
 ; 2 => Complete (c)      7 => Expired (e)          12 => DC/Edit (dce)
"RTN","ORQ1",47,0)
 ; 3 => Hold (h)          8 => Scheduled (s)        13 => Cancelled (x)
"RTN","ORQ1",48,0)
 ; 4 => Flagged (?)       9 => Partial Results (pr) 14 => Lapsed (l)
"RTN","ORQ1",49,0)
 ; 5 => Pending (p)      10 => Delayed (d)          15 => Renewed (rn)
"RTN","ORQ1",50,0)
 ;                                                  99 => No Status (')
"RTN","ORQ1",51,0)
 ; EXPAND=ifn of parent order, used to expand child orders
"RTN","ORQ1",52,0)
 ; SDATE =Start date
"RTN","ORQ1",53,0)
 ; EDATE =End date
"RTN","ORQ1",54,0)
 ; DETAIL=Data to be returned (optional, default=0):
"RTN","ORQ1",55,0)
 ;     0 => ^TMP("ORR",$J,ORLIST,i) = order #
"RTN","ORQ1",56,0)
 ;     1 => ^TMP("ORR",$J,ORLIST,i) = order #^display group^when entered^
"RTN","ORQ1",57,0)
 ;                                    start d/t^stop d/t^status^sts abbrv
"RTN","ORQ1",58,0)
 ;          ^TMP("ORR",$J,ORLIST,i,"TX",j) = order text
"RTN","ORQ1",59,0)
 ; MULT  =0:Don't allow multiple occurrances of order
"RTN","ORQ1",60,0)
 ;       =1:Allow multiple occurances
"RTN","ORQ1",61,0)
 ; XREF  =cross reference to use instead of ACT (AW for completed orders)
"RTN","ORQ1",62,0)
 ; GETKID=includes children of multiple orders
"RTN","ORQ1",63,0)
 ; EVENT =ptr to Patient Event file #100.2, for orders tied to an event
"RTN","ORQ1",64,0)
 ;
"RTN","ORQ1",65,0)
EN1 ; -- start here
"RTN","ORQ1",66,0)
 Q:'$G(PAT)  N X,ORLST,ORGRP,LAPSE
"RTN","ORQ1",67,0)
 S:'$G(GROUP) GROUP=$O(^ORD(100.98,"B","ALL SERVICES",0))
"RTN","ORQ1",68,0)
 S:'$G(FLG) FLG=2 S:'$G(DETAIL) DETAIL=0 S:'$G(MULT) MULT=0
"RTN","ORQ1",69,0)
 I $G(EDATE)<$G(SDATE) S X=EDATE,EDATE=SDATE,SDATE=X
"RTN","ORQ1",70,0)
 I $G(EDATE) S EDATE=$S($L(EDATE,".")=2:EDATE+.0001,1:EDATE+1)
"RTN","ORQ1",71,0)
 I $G(SDATE) S SDATE=$S($L(SDATE,".")=2:SDATE-.0001,1:SDATE)
"RTN","ORQ1",72,0)
 S SDATE=9999999-$S($G(SDATE):SDATE,FLG=6:DT-.7641,1:0),EDATE=9999999-$S($G(EDATE):EDATE,FLG=6:DT+.2359,1:9999998)
"RTN","ORQ1",73,0)
 S ORLST=0,X=EDATE,EDATE=SDATE,SDATE=X D GRP(GROUP),LIST
"RTN","ORQ1",74,0)
 S LAPSE=+$$GET^XPAR("ALL","OR DELAYED ORDERS LAPSE DAYS")
"RTN","ORQ1",75,0)
 S:LAPSE LAPSE=$$FMADD^XLFDT(DT,(0-LAPSE)) ;=0 or cutoff date
"RTN","ORQ1",76,0)
 I "^15^16^17^24^25^26^"[(U_FLG_U)!$G(EVENT) D EN^ORQ13 G ENQ
"RTN","ORQ1",77,0)
 D @($S(FLG=2:"CUR",FLG=5:"EXG","^6^8^9^10^20^"[(U_FLG_U):"ACT",FLG=11:"SIG",FLG=19:"NEW","^1^3^4^7^12^13^14^18^21^22^23^"[(U_FLG_U):"LOOP",1:"QUIT")_"^ORQ11")
"RTN","ORQ1",78,0)
ENQ K ^TMP("ORGOTIT",$J)
"RTN","ORQ1",79,0)
 Q
"RTN","ORQ1",80,0)
 ;
"RTN","ORQ1",81,0)
LIST ;Get entry in ^TMP("ORR",$J,ORLIST)
"RTN","ORQ1",82,0)
 S ORLIST=$H
"RTN","ORQ1",83,0)
 L +^TMP("ORR",$J,ORLIST)
"RTN","ORQ1",84,0)
 I $D(^TMP("ORR",$J,ORLIST)) L -^TMP("ORR",$J,ORLIST) H 1 G LIST
"RTN","ORQ1",85,0)
 S ^TMP("ORR",$J,ORLIST)=""
"RTN","ORQ1",86,0)
 L -^TMP("ORR",$J,ORLIST)
"RTN","ORQ1",87,0)
 Q
"RTN","ORQ1",88,0)
 ;
"RTN","ORQ1",89,0)
GRP(DG) ;Setup display groups
"RTN","ORQ1",90,0)
 ;DG=Display group to expand
"RTN","ORQ1",91,0)
 N STK,MEM
"RTN","ORQ1",92,0)
 S ORGRP(DG)="",STK=1,STK(STK)=DG_"^0",STK(0)=0,MEM=0
"RTN","ORQ1",93,0)
 F  S MEM=$O(^ORD(100.98,+STK(STK),1,MEM)) D @$S(+MEM'>0:"POP",1:"PROC") Q:STK<1
"RTN","ORQ1",94,0)
 Q
"RTN","ORQ1",95,0)
 ;
"RTN","ORQ1",96,0)
POP S STK=STK-1,MEM=$P(STK(STK),"^",2)
"RTN","ORQ1",97,0)
 Q
"RTN","ORQ1",98,0)
PROC S $P(STK(STK),"^",2)=MEM,DG=$P(^ORD(100.98,+STK(STK),1,MEM,0),"^",1)
"RTN","ORQ1",99,0)
 S ORGRP(DG)="",STK=STK+1,STK(STK)=DG_"^0",MEM=0
"RTN","ORQ1",100,0)
 Q
"RTN","ORQ11")
0^33^B56849675
"RTN","ORQ11",1,0)
ORQ11 ;slc/dcm-Get patient orders in context ; 08 May 2002  2:12 PM
"RTN","ORQ11",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,72,78,99,94,148,141**;Dec 17, 1997
"RTN","ORQ11",3,0)
LOOP ; -- main loop through "ACT" x-ref
"RTN","ORQ11",4,0)
 I $G(XREF)="AW" D AW Q
"RTN","ORQ11",5,0)
 K ^TMP("ORGOTIT",$J)
"RTN","ORQ11",6,0)
AWIN ;Jump in here to add active orders to AW context
"RTN","ORQ11",7,0)
 N TM,TO,IFN,X0,X3,X7,X8,STS,USTS,NOW,ACTOR,X
"RTN","ORQ11",8,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TM=SDATE
"RTN","ORQ11",9,0)
 F  S TM=$O(^OR(100,"ACT",PAT,TM)) Q:'TM!(TM>EDATE)  S TO=0 F  S TO=$O(^OR(100,"ACT",PAT,TM,TO)) Q:'TO  I $D(ORGRP(TO)) D
"RTN","ORQ11",10,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"ACT",PAT,TM,TO,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT),$D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",11,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,TM,TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13!(FLG=1) S X8=^(0),X7=$G(^(7)) D LP1
"RTN","ORQ11",12,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",13,0)
 Q
"RTN","ORQ11",14,0)
AW ; -- loop through "AW" x-ref
"RTN","ORQ11",15,0)
 K ^TMP("ORGOTIT",$J),^TMP("ORSORT",$J)
"RTN","ORQ11",16,0)
 N TM,TO,IFN,X0,X3,X7,X8,STS,USTS,NOW,ACTOR,X
"RTN","ORQ11",17,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TO=0,SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ11",18,0)
 F  S TO=$O(^OR(100,"AW",PAT,TO)) Q:'TO  I $D(ORGRP(TO)) S TM=EDATE F  S TM=$O(^OR(100,"AW",PAT,TO,TM)) Q:'TM!(TM>SDATE)!(+TM<EDATE)  D
"RTN","ORQ11",19,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AW",PAT,TO,TM,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT) D
"RTN","ORQ11",20,0)
 .. S ^TMP("ORSORT",$J,9999999-TM,TO,IFN)=""
"RTN","ORQ11",21,0)
 S TM=0 F  S TM=$O(^TMP("ORSORT",$J,TM)) Q:'TM  S TO=0 F  S TO=$O(^TMP("ORSORT",$J,TM,TO)) Q:'TO  D
"RTN","ORQ11",22,0)
 . S IFN=0 F  S IFN=$O(^TMP("ORSORT",$J,TM,TO,IFN)) Q:'IFN  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D 
"RTN","ORQ11",23,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,9999999-$P(X0,U,7),TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0),X7=$G(^(7)) D LP1
"RTN","ORQ11",24,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",25,0)
 I +$$GET^XPAR("SYS","OR ORDER SUMMARY CONTEXT",1,"I")=2 S SDATE=9999999-SDATE,EDATE=9999999-EDATE D AWIN
"RTN","ORQ11",26,0)
 K ^TMP("ORSORT",$J),^TMP("ORGOTIT",$J)
"RTN","ORQ11",27,0)
 Q
"RTN","ORQ11",28,0)
LP1 ; -- main secondary loop
"RTN","ORQ11",29,0)
 Q:$P(X3,U,8)  Q:$P(X3,U,3)=99  S STS=$P(X3,U,3)
"RTN","ORQ11",30,0)
 I '$G(GETKID),$P(X3,U,9),'$P($G(^OR(100,$P(X3,U,9),3)),U,8),FLG'=11 Q
"RTN","ORQ11",31,0)
 I $L($P(X0,U,17)),"^10^11^"[(U_STS_U) S X=$$LAPSED^OREVNTX($P(X0,U,17))
"RTN","ORQ11",32,0)
 D @($S(FLG=2:"CUR1",FLG=3:"DC1",FLG=4:"COM1",FLG=5:"EXG1",FLG=7:"PEN1",FLG=8:"UVR1",FLG=9:"UVN1",FLG=10:"UVC1",FLG=12:"FLG1",FLG=13:"VP1",FLG=14:"VPU1",FLG=18:"HLD1",FLG=20:"CHT1",FLG=21:"CHTSUM",FLG=22:"LPS1",FLG=23:"AVT1",1:"ALL1"))
"RTN","ORQ11",33,0)
 Q
"RTN","ORQ11",34,0)
 ; ** FLG context specific loops:
"RTN","ORQ11",35,0)
 ;
"RTN","ORQ11",36,0)
ALL1 ; 1 -- secondary pass for All, Recent Orders, Unsigned
"RTN","ORQ11",37,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,$G(ACTOR))
"RTN","ORQ11",38,0)
 Q
"RTN","ORQ11",39,0)
 ;
"RTN","ORQ11",40,0)
CUR ; 2 -- Active/Current
"RTN","ORQ11",41,0)
 N X,X0,X1,X2,X3,%H,YD,%,TM,IFN,ACTOR
"RTN","ORQ11",42,0)
 I $G(GROUP)=$O(^ORD(100.98,"B","ALL SERVICES",0)),$G(ORWARD) S X=$O(^ORD(100.98,"B","O RX",0)) K:X ORGRP(X) ; screen out Outpt Meds if inpt
"RTN","ORQ11",43,0)
 S X2=+$$GET^XPAR("SYS","ORPF ACTIVE ORDERS CONTEXT HRS",1,"I"),X=$H,X=+X*24+($P(X,",",2)/3600),X1=X-X2,X3=X1#24,X1=X1\24,X2=$J(X3*3600,0,0),%H=X1_","_X2 D YMD^%DTC S YD=+(X_%)
"RTN","ORQ11",44,0)
 S TM=SDATE F  S TM=$O(^OR(100,"AC",PAT,TM)) Q:TM<1!(TM>EDATE)  S IFN=0 F  S IFN=$O(^OR(100,"AC",PAT,TM,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D
"RTN","ORQ11",45,0)
 . Q:'$D(ORGRP($P(X0,U,11)))  S ACTOR=0
"RTN","ORQ11",46,0)
 . F  S ACTOR=$O(^OR(100,"AC",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  I $D(^OR(100,IFN,8,ACTOR,0)) S X=^(0) D
"RTN","ORQ11",47,0)
 .. I $P(X,U,15)=13,$P(X,U)<YD K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",48,0)
 .. I $P(X,U,15)="",ACTOR'=$P(X3,U,7) K ^OR(100,"AC",PAT,TM,IFN,ACTOR) Q
"RTN","ORQ11",49,0)
 .. D LP1
"RTN","ORQ11",50,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",51,0)
 Q
"RTN","ORQ11",52,0)
CUR1 ; 2 -- secondary pass for Active/Current
"RTN","ORQ11",53,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",54,0)
 I STS=10 K ^OR(100,"AC",PAT,TM,IFN) Q  ;no delayed orders
"RTN","ORQ11",55,0)
 I '$D(YD),"^1^2^7^12^13^14^"[(U_STS_U) K ^OR(100,"AC",PAT,TM,IFN) Q
"RTN","ORQ11",56,0)
 I $D(YD),"^1^2^7^12^13^14^"[(U_STS_U),STOP<YD K ^OR(100,"AC",PAT,TM,IFN) Q
"RTN","ORQ11",57,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",58,0)
 Q
"RTN","ORQ11",59,0)
 ;
"RTN","ORQ11",60,0)
DC1 ; 3 -- secondary pass for DC
"RTN","ORQ11",61,0)
 I STS=1!(STS=13)!(STS=12) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",62,0)
 Q
"RTN","ORQ11",63,0)
 ;
"RTN","ORQ11",64,0)
COM1 ; 4 -- secondary pass for Completed/Expired
"RTN","ORQ11",65,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",66,0)
 I STS=2!(STS=7)!($L(STOP)&(STOP<NOW)&(STS'=1)&(STS'=13)&(STS'=12)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",67,0)
 Q
"RTN","ORQ11",68,0)
 ;
"RTN","ORQ11",69,0)
EXG ; 5 -- Expiring
"RTN","ORQ11",70,0)
 N ORNG,ORDT,ORDW,ORHOL,X,Y,%DT,DIC,TMW,NOW,STS
"RTN","ORQ11",71,0)
 F ORNG=1:1 D  I ORHOL=0,ORDW=0 Q
"RTN","ORQ11",72,0)
 . S ORDT=$$FMADD^XLFDT(DT,ORNG),ORDW=$S($H-4+ORNG#7>4:1,1:0)
"RTN","ORQ11",73,0)
 . S DIC="^HOLIDAY(",X=$P(ORDT,".")
"RTN","ORQ11",74,0)
 . D ^DIC S ORHOL=$S(+$G(Y)>0:1,1:0)
"RTN","ORQ11",75,0)
 S %DT="",X="T+"_ORNG D ^%DT
"RTN","ORQ11",76,0)
 S TMW=Y_".9999",NOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORQ11",77,0)
 D CUR ;D LOOP
"RTN","ORQ11",78,0)
 Q
"RTN","ORQ11",79,0)
EXG1 ; 5 -- secondary pass for Expiring
"RTN","ORQ11",80,0)
 N STOP S STOP=$P(X0,U,9)
"RTN","ORQ11",81,0)
 I STS'=1,STS'=2,STS'=7,STS'>9,STOP>NOW,STOP'>TMW D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",82,0)
 Q
"RTN","ORQ11",83,0)
 ;
"RTN","ORQ11",84,0)
ACT ; 6 -- Recent Activity (Order Summary)
"RTN","ORQ11",85,0)
 ;N ORLSIGN S ORLSIGN=$$GET^XPAR("ALL","OR ORDER REVIEW DT","`"_+PAT,"Q")
"RTN","ORQ11",86,0)
 N TM,IFN,X0,X3,ACTOR,X8
"RTN","ORQ11",87,0)
 S TM=SDATE F  S TM=$O(^OR(100,"AR",PAT,TM)) Q:TM<1!(TM>EDATE)  D
"RTN","ORQ11",88,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AR",PAT,TM,IFN)) Q:IFN<1  S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)) I $D(ORGRP(+$P(X0,U,11))) D
"RTN","ORQ11",89,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"AR",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  I $D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0) D LP1
"RTN","ORQ11",90,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",91,0)
 Q
"RTN","ORQ11",92,0)
 ;
"RTN","ORQ11",93,0)
PEN1 ; 7 -- secondary pass for Pending
"RTN","ORQ11",94,0)
 I STS=5 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",95,0)
 Q
"RTN","ORQ11",96,0)
 ;
"RTN","ORQ11",97,0)
UVR1 ; 8 -- secondary pass for Unverified
"RTN","ORQ11",98,0)
 ;      Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",99,0)
 I '$P(X8,U,9),'$P(X8,U,11),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",100,0)
 Q
"RTN","ORQ11",101,0)
 ;
"RTN","ORQ11",102,0)
UVN1 ; 9 -- secondary pass for Unverified/Nurse
"RTN","ORQ11",103,0)
 ;      Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",104,0)
 I '$P(X8,U,9),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",105,0)
 Q
"RTN","ORQ11",106,0)
 ;
"RTN","ORQ11",107,0)
UVC1 ; 10 -- secondary pass for Unverified/Clerk
"RTN","ORQ11",108,0)
 ;       Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",109,0)
 I '$P(X8,U,11),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",110,0)
 Q
"RTN","ORQ11",111,0)
 ;
"RTN","ORQ11",112,0)
INPT() ; -- Returns 1 or 0, if inpt order using X0=^OR(100,IFN,0)
"RTN","ORQ11",113,0)
 I ($P(X0,U,12)="I")!($P(X0,U,17)="D") Q 1
"RTN","ORQ11",114,0)
 I $P($G(^SC(+$P(X0,U,10),0)),U,3)="W" Q 1
"RTN","ORQ11",115,0)
 Q 0
"RTN","ORQ11",116,0)
 ;
"RTN","ORQ11",117,0)
SIG ; 11 -- Unsigned
"RTN","ORQ11",118,0)
 N TM,IFN,X0,X3,ACTOR S TM=SDATE
"RTN","ORQ11",119,0)
 F  S TM=$O(^OR(100,"AS",PAT,TM)) Q:TM<1!(TM>EDATE)  S IFN=0 F  S IFN=$O(^OR(100,"AS",PAT,TM,IFN)) Q:IFN<1  D
"RTN","ORQ11",120,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3))
"RTN","ORQ11",121,0)
 . I X0="" K ^OR(100,"AS",PAT,TM,IFN) Q  ;deleted
"RTN","ORQ11",122,0)
 . Q:'$D(ORGRP(+$P(X0,U,11)))  ;not a selected DispGrp
"RTN","ORQ11",123,0)
 . S ACTOR=0 F  S ACTOR=$O(^OR(100,"AS",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  D
"RTN","ORQ11",124,0)
 .. I $P($G(^OR(100,IFN,8,ACTOR,0)),U,4)'=2 K ^OR(100,"AS",PAT,TM,IFN,ACTOR) Q  ;signed or deleted
"RTN","ORQ11",125,0)
 .. D LP1
"RTN","ORQ11",126,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",127,0)
 Q
"RTN","ORQ11",128,0)
 ;
"RTN","ORQ11",129,0)
FLG1 ; 12 -- secondary pass for Flagged
"RTN","ORQ11",130,0)
 I +$G(^OR(100,IFN,8,ACTOR,3)) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",131,0)
 Q
"RTN","ORQ11",132,0)
 ;
"RTN","ORQ11",133,0)
VP1 ; 13 -- secondary pass for Verbal/Phone
"RTN","ORQ11",134,0)
 N ORNATR S ORNATR=$P(X8,U,12)
"RTN","ORQ11",135,0)
 I ORNATR,"PV"[$P($G(^ORD(100.02,+ORNATR,0)),U,2) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;STS'=12
"RTN","ORQ11",136,0)
 Q
"RTN","ORQ11",137,0)
 ;
"RTN","ORQ11",138,0)
VPU1 ; 14 -- secondary pass for Verbal/Phone Unsigned
"RTN","ORQ11",139,0)
 N ORNATR S ORNATR=$P(X8,U,12)
"RTN","ORQ11",140,0)
 I ORNATR,"PV"[$P($G(^ORD(100.02,+ORNATR,0)),U,2),'$P(X8,U,5),$P(X8,U,4)=2 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;STS'=12
"RTN","ORQ11",141,0)
 Q
"RTN","ORQ11",142,0)
 ;
"RTN","ORQ11",143,0)
HLD1 ; 18 -- secondary pass for On Hold
"RTN","ORQ11",144,0)
 I STS=3 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",145,0)
 Q
"RTN","ORQ11",146,0)
 ;
"RTN","ORQ11",147,0)
NEW ; 19 -- New Orders, plus other unsigned orders by current provider
"RTN","ORQ11",148,0)
 N IFN,ACTOR,TM,X0,X3,X8,ORENT,ORPAR
"RTN","ORQ11",149,0)
 S IFN=0 F  S IFN=$O(^TMP("ORNEW",$J,IFN)) Q:IFN'>0  D  ;New orders
"RTN","ORQ11",150,0)
 . S ACTOR=0 F  S ACTOR=$O(^TMP("ORNEW",$J,IFN,ACTOR)) Q:ACTOR'>0  D
"RTN","ORQ11",151,0)
 .. Q:'$D(^OR(100,IFN,0))  Q:'$D(^(8,ACTOR,0))  ;deleted
"RTN","ORQ11",152,0)
 .. D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",153,0)
 G:'$D(^XUSEC("ORES",DUZ)) NW1 ;ck parameter for add'l orders
"RTN","ORQ11",154,0)
 S ORENT="ALL"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+^(5),1:"")
"RTN","ORQ11",155,0)
 S ORPAR=$$GET^XPAR(ORENT,"OR UNSIGNED ORDERS ON EXIT")
"RTN","ORQ11",156,0)
 I ORPAR S TM=SDATE F  S TM=$O(^OR(100,"AS",PAT,TM)) Q:TM<1!(TM>EDATE)  D
"RTN","ORQ11",157,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AS",PAT,TM,IFN)) Q:IFN<1  D
"RTN","ORQ11",158,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"AS",PAT,TM,IFN,ACTOR)) Q:ACTOR<1  D
"RTN","ORQ11",159,0)
 ... Q:$D(^TMP("ORNEW",$J,IFN,ACTOR))  ;already included
"RTN","ORQ11",160,0)
 ... S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACTOR,0))
"RTN","ORQ11",161,0)
 ... I $S(ORPAR=1&($P(X8,U,3)=DUZ):1,ORPAR=2:1,1:0) D LP1
"RTN","ORQ11",162,0)
NW1 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ11",163,0)
 Q
"RTN","ORQ11",164,0)
 ;
"RTN","ORQ11",165,0)
CHT1 ; 20 -- secondary pass for Chart Review
"RTN","ORQ11",166,0)
 ;       Include if: unverified, released, inpt, not repl/canc/lapsed
"RTN","ORQ11",167,0)
 I '$P(X8,U,19),$P(X8,U,15)="",$$INPT,"^12^13^14^"'[(U_STS_U) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",168,0)
 Q
"RTN","ORQ11",169,0)
 ;
"RTN","ORQ11",170,0)
CHTSUM ; 21 -- secondary pass for Chart copy summary
"RTN","ORQ11",171,0)
 ;       Included based on Nature of Order
"RTN","ORQ11",172,0)
 N XP,NAT
"RTN","ORQ11",173,0)
 S XP=+$$GET^XPAR("SYS","OR PRINT ALL ORDERS CHART SUM",1,"I")
"RTN","ORQ11",174,0)
 I XP=2 D  Q  ;depends on Nature of Order
"RTN","ORQ11",175,0)
 . S NAT=$P($G(^OR(100,IFN,6)),U)
"RTN","ORQ11",176,0)
 . I 'NAT S NAT=$P(X8,U,12)
"RTN","ORQ11",177,0)
 . I NAT,$$CHART^ORX1(NAT) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",178,0)
 I XP=0 D  Q  ;If original printed, print on sum
"RTN","ORQ11",179,0)
 . I X7 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",180,0)
 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR) ;XP=1 gets All orders
"RTN","ORQ11",181,0)
 Q
"RTN","ORQ11",182,0)
 ;
"RTN","ORQ11",183,0)
LPS1 ; 22 -- secondary pass for Lapsed
"RTN","ORQ11",184,0)
 I STS=14 D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",185,0)
 Q
"RTN","ORQ11",186,0)
 ;
"RTN","ORQ11",187,0)
AVT1 ; 23 -- secondary pass for Active/Pending sts only
"RTN","ORQ11",188,0)
 I (STS=6)!(STS=5) D GET^ORQ12(IFN,ORLIST,DETAIL,ACTOR)
"RTN","ORQ11",189,0)
 Q
"RTN","ORQ11",190,0)
 ;
"RTN","ORQ11",191,0)
QUIT ; -- stop
"RTN","ORQ11",192,0)
 Q
"RTN","ORQ13")
0^34^B7872245
"RTN","ORQ13",1,0)
ORQ13 ;slc/dcm-Get patient orders in context ; 08 May 2002  2:12 PM
"RTN","ORQ13",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORQ13",3,0)
 ;
"RTN","ORQ13",4,0)
EN ; -- Event Delayed: 24=All Delayed orders, or
"RTN","ORQ13",5,0)
 ;     15=Admission, 16=Discharge, 17=Transfer, 25=OR, 26=Manual
"RTN","ORQ13",6,0)
 ;     or EVENT=ptr to Patient Event in #100.2
"RTN","ORQ13",7,0)
 D UNDO I $G(EVENT) D EN1 Q
"RTN","ORQ13",8,0)
 N TYPE,EVT,EVENT,IFN,X0,TM,STS
"RTN","ORQ13",9,0)
 S TYPE=$S(FLG=15:"A",FLG=16:"D",FLG=17:"T",FLG=25:"O",FLG=26:"M",1:"ADTOM")
"RTN","ORQ13",10,0)
 S EVT=0 F  S EVT=+$O(^ORE(100.2,"AE",+PAT,EVT)) Q:EVT<1  S EVENT=+$O(^(EVT,0)) D
"RTN","ORQ13",11,0)
 . Q:TYPE'[$P($G(^ORD(100.5,EVT,0)),U,2)  ;Q:$$LAPSED^OREVNTX(EVENT)
"RTN","ORQ13",12,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,EVENT,IFN)) Q:IFN<1  D ADD(IFN)
"RTN","ORQ13",13,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ13",14,0)
 Q
"RTN","ORQ13",15,0)
 ;
"RTN","ORQ13",16,0)
EN1 ; -- Delayed for EVENT [and related Pt Events]
"RTN","ORQ13",17,0)
 N DAD,CHLD S DAD=+$P($G(^ORE(100.2,EVENT,1)),U,5) ;EVENT=child
"RTN","ORQ13",18,0)
 I DAD<1,$O(^ORE(100.2,"DAD",EVENT,0)) S DAD=EVENT ;EVENT=parent
"RTN","ORQ13",19,0)
 D:DAD<1 EVNT(EVENT) I DAD D
"RTN","ORQ13",20,0)
 . D EVNT(DAD) S CHLD=0
"RTN","ORQ13",21,0)
 . F  S CHLD=+$O(^ORE(100.2,"DAD",DAD,CHLD)) Q:CHLD<1  D EVNT(CHLD)
"RTN","ORQ13",22,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ13",23,0)
 Q
"RTN","ORQ13",24,0)
 ;
"RTN","ORQ13",25,0)
EVNT(EVENT) ; -- Orders tied to EVENT in #100.2
"RTN","ORQ13",26,0)
 N DONE,IFN,I,X,ORDER
"RTN","ORQ13",27,0)
 S DONE=$G(^ORE(100.2,EVENT,1)) D:DONE  ;get released, dc'd orders
"RTN","ORQ13",28,0)
 . S I=+$O(^ORE(100.2,EVENT,10,"B"),-1),X=$P($G(^(I,0)),U,2) Q:X="LP"!(X="CA")  ;skip if lapsed or cancelled
"RTN","ORQ13",29,0)
 . S ORDER=+$P($G(^ORE(100.2,EVENT,0)),U,4) D:ORDER ADD(ORDER,"RL")
"RTN","ORQ13",30,0)
 . S IFN=0 F  S IFN=$O(^ORE(100.2,EVENT,2,IFN)) Q:IFN<1  D ADD(IFN,"RL")
"RTN","ORQ13",31,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,EVENT,IFN)) Q:IFN<1  I IFN'=ORDER,'$D(^ORE(100.2,EVENT,2,IFN)) D ADD(IFN,"RL")
"RTN","ORQ13",32,0)
 . S IFN=0 F  S IFN=$O(^ORE(100.2,EVENT,3,IFN)) Q:IFN<1  D ADD(IFN,"DC")
"RTN","ORQ13",33,0)
 I 'DONE S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,EVENT,IFN)) Q:IFN<1  D ADD(IFN)
"RTN","ORQ13",34,0)
 Q
"RTN","ORQ13",35,0)
 ;
"RTN","ORQ13",36,0)
ADD(IFN,TYPE)        ; -- add EVENT order to list?
"RTN","ORQ13",37,0)
 N X0,X3,DA,X8,TM,CURR
"RTN","ORQ13",38,0)
 S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)) Q:'$D(ORGRP(+$P(X0,U,11)))
"RTN","ORQ13",39,0)
 I $P(X3,U,3)=12,$P($G(^OR(100,+$P(X3,U,6),0)),U,17)=EVENT Q  ;changed
"RTN","ORQ13",40,0)
 S CURR=$P(X3,U,7) S:CURR<1 CURR=+$O(^OR(100,IFN,8,"?"),-1) ;current/last
"RTN","ORQ13",41,0)
 S DA=0 F  S DA=+$O(^OR(100,IFN,8,DA)) Q:DA<1  S X8=$G(^(DA,0)) D
"RTN","ORQ13",42,0)
 . S TM=$P(X8,U) Q:TM<SDATE  Q:TM>EDATE
"RTN","ORQ13",43,0)
 . I DA'=CURR,$P(X8,U,15)'=11 Q  ;current or unrel action
"RTN","ORQ13",44,0)
 . I DETAIL<2!'$L($G(TYPE)) D GET^ORQ12(IFN,ORLIST,DETAIL,DA) Q
"RTN","ORQ13",45,0)
 . S ORLST=ORLST+1,^TMP("ORGOTIT",$J,IFN,DA)=""
"RTN","ORQ13",46,0)
 . S ^TMP("ORR",$J,ORLIST,EVENT,TYPE,ORLST)=IFN_";"_DA
"RTN","ORQ13",47,0)
 Q
"RTN","ORQ13",48,0)
 ;
"RTN","ORQ13",49,0)
UNDO ; -- un-invert dates from ORQ1
"RTN","ORQ13",50,0)
 N X S X=EDATE,EDATE=SDATE,SDATE=X
"RTN","ORQ13",51,0)
 S SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ13",52,0)
 Q
"RTN","ORQ13",53,0)
 ;
"RTN","ORQ13",54,0)
QUIT ; -- stop
"RTN","ORQ13",55,0)
 Q
"RTN","ORQ2")
0^35^B34261575
"RTN","ORQ2",1,0)
ORQ2 ; SLC/MKB - Detailed Order Report ;8/29/02  14:50
"RTN","ORQ2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,56,75,94,141**;Dec 17, 1997
"RTN","ORQ2",3,0)
DETAIL(ORY,ORIFN) ; -- Returns details of order ORIFN in ORY(#)
"RTN","ORQ2",4,0)
 N X,X2,I,CNT,ORDIALOG,OR0,OR3,OR6,SEQ,ITEM,PRMT,MULT,FIRST,TITLE,INST,DIWL,DIWR,DIWF,ACTION,VAIN,ORIGVIEW,ORNMSP,ORYT
"RTN","ORQ2",5,0)
 S CNT=0,ORIFN=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6))
"RTN","ORQ2",6,0)
 K @ORY,ORYT S ORIGVIEW=1 D TEXT^ORQ12(.ORYT,+ORIFN_";"_+$P(OR3,U,7),80) ;CurrTx
"RTN","ORQ2",7,0)
 M @ORY=ORYT ;Move text to global
"RTN","ORQ2",8,0)
 S I=0 F CNT=1:1 S I=$O(ORYT(I)) Q:I'>0  D:$D(IORVON) SETVIDEO(I,1,$L(ORYT(I)),IORVON,IORVOFF)
"RTN","ORQ2",9,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",10,0)
D1 I $O(^OR(100,+ORIFN,2,0)) D
"RTN","ORQ2",11,0)
 . S CNT=CNT+1,@ORY@(CNT)="Sub Orders:"
"RTN","ORQ2",12,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,11,IOUON,IOUOFF)
"RTN","ORQ2",13,0)
 . N IFN S IFN=0
"RTN","ORQ2",14,0)
 . F  S IFN=+$O(^OR(100,+ORIFN,2,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)) D SUB(IFN)
"RTN","ORQ2",15,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",16,0)
 I $P(OR3,U,9),$D(^OR(100,+$P(OR3,U,9),0)) D
"RTN","ORQ2",17,0)
 . S CNT=CNT+1,@ORY@(CNT)="Parent Order:"
"RTN","ORQ2",18,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,12,IOUON,IOUOFF)
"RTN","ORQ2",19,0)
 . D SUB(+$P(OR3,U,9))
"RTN","ORQ2",20,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",21,0)
 I $P(OR3,U,11)=1,$P(OR3,U,5) D  ;Changed - show previous order
"RTN","ORQ2",22,0)
 . S CNT=CNT+1,@ORY@(CNT)="Previous Order:"
"RTN","ORQ2",23,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,15,IOUON,IOUOFF) ;prev order original text
"RTN","ORQ2",24,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,+$P(OR3,U,5),55)
"RTN","ORQ2",25,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Order Text:        "_$G(ORZ(1))
"RTN","ORQ2",26,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ2",27,0)
D2 S CNT=CNT+1,@ORY@(CNT)="Activity:"
"RTN","ORQ2",28,0)
 D:$D(IOUON) SETVIDEO(CNT,1,9,IOUON,IOUOFF)
"RTN","ORQ2",29,0)
 S DIWL=1,DIWR=64,DIWF="C64",ORI=0 K ^UTILITY($J,"W")
"RTN","ORQ2",30,0)
 F  S ORI=$O(^OR(100,ORIFN,8,ORI)) Q:ORI'>0  S ACTION=$G(^(ORI,0)) D ACT^ORQ20
"RTN","ORQ2",31,0)
 I "^1^12^13^"[(U_$P(OR3,U,3)_U),$L(OR6),$P(ACTION,U,2)'="DC" D DC^ORQ20
"RTN","ORQ2",32,0)
 I $P(OR3,U,3)=2,$P(OR6,U,6) S CNT=CNT+1,@ORY@(CNT)=$$DATE^ORQ20($P(OR6,U,6))_"  Completed"_$S($P(OR6,U,7):" by "_$$USER^ORQ20($P(OR6,U,7)),1:"")
"RTN","ORQ2",33,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",34,0)
D3 S CNT=CNT+1,@ORY@(CNT)="Current Data:"
"RTN","ORQ2",35,0)
 D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",36,0)
 D VA I $G(VAIN(2)) S CNT=CNT+1,@ORY@(CNT)="Current Primary Provider:     "_$P(VAIN(2),"^",2)
"RTN","ORQ2",37,0)
 I $G(VAIN(11)) S CNT=CNT+1,@ORY@(CNT)="Current Attending Physician:  "_$P(VAIN(11),"^",2)
"RTN","ORQ2",38,0)
 S CNT=CNT+1,@ORY@(CNT)="Treating Specialty:           "_$P($G(^DIC(45.7,+$P(OR0,U,13),0)),U)
"RTN","ORQ2",39,0)
 S CNT=CNT+1,@ORY@(CNT)="Ordering Location:            "_$P($G(^SC(+$P(OR0,U,10),0)),U)
"RTN","ORQ2",40,0)
 S CNT=CNT+1,@ORY@(CNT)="Start Date/Time:              "_$S($P(OR0,U,8):$$DATE^ORQ20($P(OR0,U,8)),1:"")
"RTN","ORQ2",41,0)
 S CNT=CNT+1,@ORY@(CNT)="Stop Date/Time:               "_$S($P(OR0,U,9):$$DATE^ORQ20($P(OR0,U,9)),1:"")
"RTN","ORQ2",42,0)
 S CNT=CNT+1,@ORY@(CNT)="Current Status:               "_$S($D(^ORD(100.01,+$P(OR3,U,3),0)):$P(^(0),"^"),1:"-")
"RTN","ORQ2",43,0)
 I $$GET^XPAR("ALL","ORPF SHOW STATUS DESCRIPTION",1,"I"),$P(OR3,U,3),$D(^ORD(100.01,$P(OR3,U,3),0)) N J S J=0 F  S J=$O(^ORD(100.01,$P(OR3,U,3),1,J)) Q:J<1  S CNT=CNT+1,@ORY@(CNT)="  "_^(J,0)
"RTN","ORQ2",44,0)
 S CNT=CNT+1,@ORY@(CNT)="Order #"_ORIFN
"RTN","ORQ2",45,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",46,0)
D4 S CNT=CNT+1,@ORY@(CNT)="Order:" D:$D(IOUON) SETVIDEO(CNT,1,6,IOUON,IOUOFF)
"RTN","ORQ2",47,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORQ2",48,0)
 I '$O(^OR(100,ORIFN,4.5,0)),ORNMSP="RA" D RAD^ORQ21("") Q
"RTN","ORQ2",49,0)
 S ORDIALOG=$P(OR0,U,5) Q:$P(ORDIALOG,";",2)="ORD(101,"  ; 2.5 order
"RTN","ORQ2",50,0)
 D GETDLG^ORCD(+ORDIALOG),GETORDER^ORCD(ORIFN)
"RTN","ORQ2",51,0)
 S DIWL=1,DIWR=50,DIWF="C50"
"RTN","ORQ2",52,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORQ2",53,0)
 . S ITEM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)) Q:$P(ITEM,U,11)  ; child
"RTN","ORQ2",54,0)
 . S PRMT=$P(ITEM,U,2),MULT=$P(ITEM,U,7) Q:$P(ITEM,U,9)["*"  ;hide
"RTN","ORQ2",55,0)
 . S FIRST=$O(ORDIALOG(PRMT,0)) Q:'FIRST  ; no values
"RTN","ORQ2",56,0)
 . S TITLE=$S(MULT&$L($G(ORDIALOG(PRMT,"TTL"))):ORDIALOG(PRMT,"TTL"),1:ORDIALOG(PRMT,"A"))
"RTN","ORQ2",57,0)
 . S TITLE=TITLE_$$REPEAT^XLFSTR(" ",30-$L(TITLE))
"RTN","ORQ2",58,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PRMT,INST)) Q:INST'>0  D
"RTN","ORQ2",59,0)
 . . I $E(ORDIALOG(PRMT,0))="W" D WP Q
"RTN","ORQ2",60,0)
 . . K ^UTILITY($J,"W") S X=$$EXT^ORCD(PRMT,INST) D ^DIWP
"RTN","ORQ2",61,0)
 . . D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PRMT)) CHILDREN(PRMT)
"RTN","ORQ2",62,0)
 . . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$S((INST=FIRST)&(I=1):TITLE,1:$$REPEAT^XLFSTR(" ",30))_^(I,0)
"RTN","ORQ2",63,0)
 I ORNMSP="GMRC",$G(^OR(100,ORIFN,4)) S CNT=CNT+1,@ORY@(CNT)="Consult No.:                  "_+^(4)
"RTN","ORQ2",64,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",65,0)
 D RAD^ORQ21(1):ORNMSP="RA",MED^ORQ21:ORNMSP="PS" ;add'l data
"RTN","ORQ2",66,0)
D5 I $O(^OR(100,+ORIFN,9,0)) D
"RTN","ORQ2",67,0)
 . N CK,OK,X0,X,CDL,I S CNT=CNT+1,@ORY@(CNT)="Order Checks:"
"RTN","ORQ2",68,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",69,0)
 . S CK=0 F  S CK=$O(^OR(100,+ORIFN,9,CK)) Q:CK'>0  S X0=$G(^(CK,0)),X=$G(^(1)) D
"RTN","ORQ2",70,0)
 .. S CDL=$$CDL($P(X0,U,2)) I $P(X0,U,6),'$D(OK) S OK=$P(X0,U,4,6)
"RTN","ORQ2",71,0)
 .. I $L(X)'>68 S CNT=CNT+1,@ORY@(CNT)=CDL_X Q
"RTN","ORQ2",72,0)
 .. S DIWL=1,DIWR=68,DIWF="C68" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",73,0)
 .. S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=CDL_^(I,0),CDL="            "
"RTN","ORQ2",74,0)
 . Q:'$L($G(OK))  S CNT=CNT+1,@ORY@(CNT)="Override:   "_$S($P(OK,U,2):$$USER^ORQ20($P(OK,U,2))_" on ",1:"")_$$DATE^ORQ20($P(OK,U,3))
"RTN","ORQ2",75,0)
 . I $L($P(OK,U))'>68 S CNT=CNT+1,@ORY@(CNT)="            "_$P(OK,U) Q
"RTN","ORQ2",76,0)
 . S DIWL=1,DIWR=68,DIWF="C68",X=$P(OK,U) K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",77,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="            "_^(I,0)
"RTN","ORQ2",78,0)
 K ^TMP("ORWORD",$J),^UTILITY($J,"W")
"RTN","ORQ2",79,0)
 Q
"RTN","ORQ2",80,0)
 ;
"RTN","ORQ2",81,0)
SUB(IFN) ; -- add suborder or parent
"RTN","ORQ2",82,0)
 N ORCY,STS,STRT,IG D TEXT^ORQ12(.ORCY,IFN,58)
"RTN","ORQ2",83,0)
 S STS=$G(^ORD(100.01,+$P($G(^OR(100,IFN,3)),U,3),.1))
"RTN","ORQ2",84,0)
 S STRT=$P(^OR(100,IFN,0),U,8) S:STRT'="" STRT=$$DATE^ORQ20(STRT)
"RTN","ORQ2",85,0)
 S IG=0 F  S IG=$O(ORCY(IG)) Q:IG<1  S CNT=CNT+1,@ORY@(CNT)=$J(STS,4)_" "_ORCY(IG)_" "_STRT,(STS,STRT)=" "
"RTN","ORQ2",86,0)
 Q
"RTN","ORQ2",87,0)
 ;
"RTN","ORQ2",88,0)
WP ; -- add word-processing
"RTN","ORQ2",89,0)
 N WP,ORI,X M WP=@ORDIALOG(PRMT,INST)
"RTN","ORQ2",90,0)
 S CNT=CNT+1,@ORY@(CNT)=TITLE
"RTN","ORQ2",91,0)
 S ORI=0 F  S ORI=$O(WP(ORI)) Q:ORI'>0  S X=WP(ORI,0) S:X'="" CNT=CNT+1,@ORY@(CNT)="  "_X
"RTN","ORQ2",92,0)
 Q
"RTN","ORQ2",93,0)
 ;
"RTN","ORQ2",94,0)
CHILDREN(PARENT) ; -- add children
"RTN","ORQ2",95,0)
 N SEQ,DA,ITM,PRMT,TYPE,X
"RTN","ORQ2",96,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D
"RTN","ORQ2",97,0)
 . S ITM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)),PRMT=$P(ITM,U,2)
"RTN","ORQ2",98,0)
 . Q:$G(ORDIALOG(PRMT,INST))=""  Q:$P(ITM,U,9)["*"  ;no value or hide
"RTN","ORQ2",99,0)
 . S TYPE=$E(ORDIALOG(PRMT,0)) D:TYPE="W" WP
"RTN","ORQ2",100,0)
 . I TYPE'="W" S X=$$EXT^ORCD(PRMT,INST) D ^DIWP
"RTN","ORQ2",101,0)
 Q
"RTN","ORQ2",102,0)
 ;
"RTN","ORQ2",103,0)
SETVIDEO(LINE,COL,WIDTH,ON,OFF) ; -- set video attributes
"RTN","ORQ2",104,0)
 S ORY("VIDEO",LINE,COL,WIDTH)=ON
"RTN","ORQ2",105,0)
 S ORY("VIDEO",LINE,COL+WIDTH,0)=OFF
"RTN","ORQ2",106,0)
 Q
"RTN","ORQ2",107,0)
 ;
"RTN","ORQ2",108,0)
VA ; -- Call VADPT
"RTN","ORQ2",109,0)
 N ORY,DFN,Y S DFN=+$P(OR0,"^",2) D OERR^VADPT
"RTN","ORQ2",110,0)
 Q
"RTN","ORQ2",111,0)
 ;
"RTN","ORQ2",112,0)
CDL(X) ; -- Returns Clinical Danger Level X
"RTN","ORQ2",113,0)
 N Y S Y=$S(X=1:"HIGH:",X=2:"MODERATE:",X=3:"LOW:",1:"NONE:")
"RTN","ORQ2",114,0)
 S Y=$E(Y_"        ",1,12)
"RTN","ORQ2",115,0)
 Q Y
"RTN","ORQ2",116,0)
 Q Y
"RTN","ORQ20")
0^36^B44143849
"RTN","ORQ20",1,0)
ORQ20 ; SLC/MKB - Detailed Order Report cont ; 08 May 2002  2:12 PM
"RTN","ORQ20",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,27,92,94,116,141**;Dec 17, 1997
"RTN","ORQ20",3,0)
ACT ; -- add Activity [from ^ORQ2]
"RTN","ORQ20",4,0)
 N ORACT S ORACT=$P(ACTION,U,2)
"RTN","ORQ20",5,0)
 S CNT=CNT+1,@ORY@(CNT)=$$DATE($P(ACTION,U))_"  "_$$ACTION(ORACT)
"RTN","ORQ20",6,0)
 I $P(ACTION,U,13) S @ORY@(CNT)=@ORY@(CNT)_" entered by "_$$USER(+$P(ACTION,U,13))
"RTN","ORQ20",7,0)
 I ORACT="NW" D  ;Show original order text
"RTN","ORQ20",8,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,ORIFN_";1",55)
"RTN","ORQ20",9,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Order Text:        "_$G(ORZ(1))
"RTN","ORQ20",10,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ20",11,0)
 I ORACT="XX" D  ;Changed - show new text
"RTN","ORQ20",12,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,ORIFN_";"_ORI,55)
"RTN","ORQ20",13,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Changed to:        "_$G(ORZ(1))
"RTN","ORQ20",14,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ20",15,0)
A1 I $P(ACTION,U,12) D  ;Nature of Order/Release
"RTN","ORQ20",16,0)
 . N ORZ S ORZ=$G(^ORD(100.02,+$P(ACTION,U,12),0))
"RTN","ORQ20",17,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Nature of Order:   "_$P(ORZ,U)
"RTN","ORQ20",18,0)
 . I $P(OR0,U,17),(ORACT="NW") Q  ;see event
"RTN","ORQ20",19,0)
 . I "^V^P^"[(U_$P(ORZ,U,2)_U),$P(ACTION,U,16) S CNT=CNT+1,@ORY@(CNT)="     Released by:       "_$$USER(+$P(ACTION,U,17))_" on "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",20,0)
 I $P(OR0,U,17)&(ORACT="NW") D  ;Delayed Release Event
"RTN","ORQ20",21,0)
 . N EVT,X,ORV,I S EVT=+$P(OR0,U,17),X=$$NAME^OREVNTX(EVT)
"RTN","ORQ20",22,0)
 . S:$E(X,1,8)="Delayed " X=$E(X,9,99)
"RTN","ORQ20",23,0)
 . I $G(^ORE(100.2,EVT,1)),'$P(ACTION,U,16) S X=X_" on "_$$DATE(+^(1))
"RTN","ORQ20",24,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Delayed Until:     "_X Q:'$P(ACTION,U,16)
"RTN","ORQ20",25,0)
 . D EVENT(.ORV) S CNT=CNT+1,@ORY@(CNT)="     Released by:       "_ORV(1)
"RTN","ORQ20",26,0)
 . S I=1 F  S I=$O(ORV(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORV(I))
"RTN","ORQ20",27,0)
A2 I $P(ACTION,U,5) S CNT=CNT+1,@ORY@(CNT)=$S($P(ACTION,U,4)=7:"      Dig",1:"     Elec")_" Signature:    "_$$USER(+$P(ACTION,U,5))_" on "_$$DATE($P(ACTION,U,6))
"RTN","ORQ20",28,0)
 I '$P(ACTION,U,5)!($P(ACTION,U,3)'=$P(ACTION,U,5)),'$$SERVCORR S CNT=CNT+1,@ORY@(CNT)="     Ordered by:        "_$$USER(+$P(ACTION,U,3))
"RTN","ORQ20",29,0)
 I '$P(ACTION,U,5),$L($P(ACTION,U,4)) S CNT=CNT+1,@ORY@(CNT)="     Signature:         "_$$SIG($P(ACTION,U,4))
"RTN","ORQ20",30,0)
 I $P(ACTION,U,9) S CNT=CNT+1,@ORY@(CNT)="     Nurse Verified:    "_$S($P(ACTION,U,8):$$USER(+$P(ACTION,U,8))_" on ",1:"")_$$DATE($P(ACTION,U,9))
"RTN","ORQ20",31,0)
 I $P(ACTION,U,11) S CNT=CNT+1,@ORY@(CNT)="     Clerk Verified:    "_$S($P(ACTION,U,10):$$USER(+$P(ACTION,U,10))_" on ",1:"")_$$DATE($P(ACTION,U,11))
"RTN","ORQ20",32,0)
 I $P(ACTION,U,19) S CNT=CNT+1,@ORY@(CNT)="     Chart Reviewed:    "_$S($P(ACTION,U,18):$$USER(+$P(ACTION,U,18))_" on ",1:"")_$$DATE($P(ACTION,U,19))
"RTN","ORQ20",33,0)
A3 I $P(ACTION,U,2)="DC",$L(OR6) S X=$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),$P(OR6,U):$P($G(^ORD(100.02,+$P(OR6,U),0)),U),1:"") S:$L(X) CNT=CNT+1,@ORY@(CNT)="     Reason for DC:     "_X
"RTN","ORQ20",34,0)
 I $L($G(^OR(100,ORIFN,8,ORI,1))) S X=^(1) D  ;add backdoor comments
"RTN","ORQ20",35,0)
 . N LBL,I S LBL=""
"RTN","ORQ20",36,0)
 . I $P(ACTION,U,15)="",$P(ACTION,U,2)'="DC" S LBL="     Comments:          " ;DC shown above
"RTN","ORQ20",37,0)
 . I $P(ACTION,U,15)=13,$P(ACTION,U,2)'="NW" S LBL="     Cancelled:         " ;NW shown in ORQ2
"RTN","ORQ20",38,0)
 . Q:'$L(LBL)  I $L(X)'>56 S CNT=CNT+1,@ORY@(CNT)=LBL_X Q
"RTN","ORQ20",39,0)
 . S DIWL=1,DIWR=56,DIWF="C56" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ20",40,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=LBL_^(I,0),LBL="                        "
"RTN","ORQ20",41,0)
 I $D(^OR(100,ORIFN,8,ORI,5)) D  ;Ward comments
"RTN","ORQ20",42,0)
 . N X,ORJ K ^UTILITY($J,"W")
"RTN","ORQ20",43,0)
 . S ORJ=0 F  S ORJ=$O(^OR(100,ORIFN,8,ORI,5,ORJ)) Q:ORJ'>0  S X=^(ORJ,0) D ^DIWP
"RTN","ORQ20",44,0)
 . S ORJ=0 F  S ORJ=$O(^UTILITY($J,"W",DIWL,ORJ)) Q:ORJ'>0  S CNT=CNT+1,@ORY@(CNT)=$S(ORJ=1:"     Ward/Clinic Cmmts: ",1:"                        ")_^(ORJ,0)
"RTN","ORQ20",45,0)
 . K ^UTILITY($J,"W")
"RTN","ORQ20",46,0)
A4 I $P(ACTION,U,2)="HD",$G(^OR(100,ORIFN,8,ORI,2)) S X2=^(2),CNT=CNT+1,@ORY@(CNT)="     Hold Released:     "_$$FMTE^XLFDT($P(X2,U),"2P")_" by "_$$USER($P(X2,U,2))
"RTN","ORQ20",47,0)
 I $D(^OR(100,ORIFN,8,ORI,3)) D  ;Un-/Flagged
"RTN","ORQ20",48,0)
 . N X S X=$G(^OR(100,ORIFN,8,ORI,3))
"RTN","ORQ20",49,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Flagged by:        "_$$USER(+$P(X,U,4))_" on "_$$DATE($P(X,U,3))
"RTN","ORQ20",50,0)
 . S CNT=CNT+1,@ORY@(CNT)="                        "_$P(X,U,5)
"RTN","ORQ20",51,0)
 . Q:X  S CNT=CNT+1,@ORY@(CNT)="     Unflagged by:      "_$$USER(+$P(X,U,7))_" on "_$$DATE($P(X,U,6))
"RTN","ORQ20",52,0)
 . S CNT=CNT+1,@ORY@(CNT)="                        "_$P(X,U,8)
"RTN","ORQ20",53,0)
 Q
"RTN","ORQ20",54,0)
 ;
"RTN","ORQ20",55,0)
DC ; -- Add Reason for DC
"RTN","ORQ20",56,0)
 S CNT=CNT+1,@ORY@(CNT)=$$DATE($P(OR6,U,3))_$S($P(OR6,U,8):"  Auto-",1:"  ")_"Discontinued"
"RTN","ORQ20",57,0)
 I $P(OR6,U,8) D  Q
"RTN","ORQ20",58,0)
 . N EVT,PKG,ORV,I
"RTN","ORQ20",59,0)
 . S EVT=$P(OR6,U,8),PKG=$P($G(^ORE(100.2,+EVT,3,ORIFN,0)),U,2)
"RTN","ORQ20",60,0)
 . S @ORY@(CNT)=@ORY@(CNT)_" by "_$S(PKG="FH":"DIETETICS",PKG="LR":"LABORATORY",PKG="PS":"PHARMACY",1:"CPRS")
"RTN","ORQ20",61,0)
 . D EVENT(.ORV,1) S CNT=CNT+1,@ORY@(CNT)="     Patient Movement:  "_ORV(1)
"RTN","ORQ20",62,0)
 . S I=1 F  S I=$O(ORV(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORV(I))
"RTN","ORQ20",63,0)
 I $P(OR6,U,2),$P($G(^ORD(100.02,+$P(OR6,U),0)),U,2)'="A" S @ORY@(CNT)=@ORY@(CNT)_" by "_$$USER($P(OR6,U,2)) ;don't show user name if auto-dc
"RTN","ORQ20",64,0)
 N X S X=$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),$P(OR6,U):$P($G(^ORD(100.02,+$P(OR6,U),0)),U),1:"") S:$L(X) CNT=CNT+1,@ORY@(CNT)="     Reason for DC:     "_X
"RTN","ORQ20",65,0)
 Q
"RTN","ORQ20",66,0)
 ;
"RTN","ORQ20",67,0)
ACTION(CODE) ; -- Return name of action CODE
"RTN","ORQ20",68,0)
 N NAME S NAME=$S(CODE="NW":"New Order",CODE="DC":"Discontinue",CODE="HD":"Hold",CODE="RL":"Release Hold",CODE="RN":"Renewal",CODE="XX":"Change",1:"")
"RTN","ORQ20",69,0)
 I CODE="NW",$P(OR3,U,11) S NAME=NAME_$S($P(OR3,U,11)=1:" (Change)",$P(OR3,U,11)=2:" (Renewal)",1:"")
"RTN","ORQ20",70,0)
 Q NAME
"RTN","ORQ20",71,0)
 ;
"RTN","ORQ20",72,0)
XACT(X) ; -- Return name of transaction code X
"RTN","ORQ20",73,0)
 N Y S X=$G(X)
"RTN","ORQ20",74,0)
 S Y=$S(X="XX":"Edited",X="DC":"Discontinued",X="HD":"Held",X="RL":"Hold Released",X="FW":"Forwarded",X="CA":"Cancelled",1:"")
"RTN","ORQ20",75,0)
 Q Y
"RTN","ORQ20",76,0)
 ;
"RTN","ORQ20",77,0)
DATE(X) ; -- Return date formatted as 00/00/0000 00:00
"RTN","ORQ20",78,0)
 N T,Y  S T=$P(X,".",2)_"0000"
"RTN","ORQ20",79,0)
 S Y=$E(X,4,5)_"/"_$E(X,6,7)_"/"_(1700+$E(X,1,3))
"RTN","ORQ20",80,0)
 I T S Y=Y_" "_$E(T,1,2)_":"_$E(T,3,4)
"RTN","ORQ20",81,0)
 Q Y
"RTN","ORQ20",82,0)
 ;
"RTN","ORQ20",83,0)
USER(X) ; -- Returns NAME (TITLE) of New Person X
"RTN","ORQ20",84,0)
 N X0,Y S X0=$G(^VA(200,+X,0)),Y=$P(X0,U)
"RTN","ORQ20",85,0)
 S:$P(X0,U,9) Y=Y_" ("_$E($P($G(^DIC(3.1,+$P(X0,U,9),0)),U),1,15)_")"
"RTN","ORQ20",86,0)
 Q Y
"RTN","ORQ20",87,0)
 ;
"RTN","ORQ20",88,0)
SIG(X) ; -- Returns text of signature status X
"RTN","ORQ20",89,0)
 N Y S Y=""
"RTN","ORQ20",90,0)
 I X=0 S Y="ON CHART WITH WRITTEN ORDERS"
"RTN","ORQ20",91,0)
 I X=1 S Y="ELECTRONICALLY SIGNED"
"RTN","ORQ20",92,0)
 I X=2 S Y="NOT SIGNED"
"RTN","ORQ20",93,0)
 I X=3 S Y="NOT REQUIRED"
"RTN","ORQ20",94,0)
 I X=4 S Y="ON CHART WITH PRINTED ORDERS"
"RTN","ORQ20",95,0)
 I X=5 S Y="NOT REQUIRED DUE TO SERVICE CANCEL"
"RTN","ORQ20",96,0)
 I X=6 S Y="SERVICE CORRECTION TO SIGNED ORDER"
"RTN","ORQ20",97,0)
 Q Y
"RTN","ORQ20",98,0)
 ;
"RTN","ORQ20",99,0)
SERVCORR()      ; -- Returns 1 or 0, if current ACTION is a serv corr change
"RTN","ORQ20",100,0)
 N Y,NATURE,I,X S Y=0
"RTN","ORQ20",101,0)
 G:ORACT'="XX" SCQ
"RTN","ORQ20",102,0)
 S NATURE=+$P(ACTION,U,12),NATURE=$P($G(^ORD(100.02,NATURE,0)),U,2)
"RTN","ORQ20",103,0)
 I "^S^I^"'[(U_NATURE_U) G SCQ
"RTN","ORQ20",104,0)
 S I=$O(^OR(100,ORIFN,8,ORI),-1),X=$G(^(I,0))
"RTN","ORQ20",105,0)
 I $P(X,U,3)'=$P(ACTION,U,3),$P(X,U,5)'=$P(ACTION,U,3) G SCQ ;show prov
"RTN","ORQ20",106,0)
 S Y=1
"RTN","ORQ20",107,0)
SCQ Q Y
"RTN","ORQ20",108,0)
 ;
"RTN","ORQ20",109,0)
EVENT(ORTX,DC) ; -- Returns patient event info for EVT
"RTN","ORQ20",110,0)
 N EVT1,REL,X,Y,I,ORMAX
"RTN","ORQ20",111,0)
 S EVT1=$G(^ORE(100.2,EVT,1)),REL=$G(^ORE(100.2,EVT,2,ORIFN,0))
"RTN","ORQ20",112,0)
 ; Return event data if AutoDC or auto-released by an event:
"RTN","ORQ20",113,0)
 I $G(DC)!(REL&'$L($P(REL,U,2))&($P(EVT1,U,2)!$P(EVT1,U,4))) D  Q
"RTN","ORQ20",114,0)
 . S Y=$S($P(EVT1,U,5):$P(EVT1,U,5),1:EVT) ;parent owns Activity
"RTN","ORQ20",115,0)
 . S Y=+$O(^ORE(100.2,+Y,10,0)),Y=$G(^(Y,0)),X=$P(Y,U,4) Q:'$L(X)
"RTN","ORQ20",116,0)
 . S X=$S(X="A":"ADMISSION",X="T":"TRANSFER",X="D":"DISCHARGE",X="S":"SPECIALTY CHANGE",1:"OUT OF O.R.")_" on "_$$DATE($P(EVT1,U))
"RTN","ORQ20",117,0)
 . S ORTX(1)=X,ORTX=1,ORMAX=56
"RTN","ORQ20",118,0)
 . I $P(Y,U,6) S X=$S($P(Y,U,4)="D":"from ",1:"to ")_$$GET1^DIQ(45.7,+$P(Y,U,6)_",",.01) D TXT^ORCHTAB
"RTN","ORQ20",119,0)
 . I $P(Y,U,7) S X="on "_$$GET1^DIQ(42,+$P(Y,U,7)_",",.01) D TXT^ORCHTAB
"RTN","ORQ20",120,0)
 S X=$$USER(+$P(ACTION,U,17))_" on "_$$DATE($P(ACTION,U,16))
"RTN","ORQ20",121,0)
 I ORIFN'=+$P($G(^ORE(100.2,EVT,0)),U,4),$P(REL,U,2)="MN" S X=X_" (manually released)"
"RTN","ORQ20",122,0)
 S ORTX(1)=X
"RTN","ORQ20",123,0)
 Q
"RTN","ORQ21")
0^78^B18693448
"RTN","ORQ21",1,0)
ORQ21 ; SLC/MKB - Detailed Order Report cont ; 08 May 2002  2:12 PM
"RTN","ORQ21",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORQ21",3,0)
 ;
"RTN","ORQ21",4,0)
RAD(TCOM) ; -- add RA data for 2.5 orders
"RTN","ORQ21",5,0)
 N RAIFN,CASE,PROC,ORD,ORI,X,ORTTL,ORB
"RTN","ORQ21",6,0)
 S RAIFN=$G(^OR(100,ORIFN,4)) Q:RAIFN'>0
"RTN","ORQ21",7,0)
 D EN30^RAO7PC1(RAIFN) Q:'$D(^TMP($J,"RAE2",+ORVP))
"RTN","ORQ21",8,0)
 S ORD=$G(^TMP($J,"RAE2",+ORVP,"ORD")),CASE=$O(^(0)) Q:'CASE  S PROC=$O(^(CASE,""))
"RTN","ORQ21",9,0)
 I '$G(TCOM) D  ;else add only Tech Comments
"RTN","ORQ21",10,0)
 . S CNT=CNT+1,@ORY@(CNT)=$$LJ^XLFSTR("Procedure:",30)_$S($L(ORD):ORD,1:PROC)
"RTN","ORQ21",11,0)
 . S ORI=0,ORTTL="Procedure Modifiers:          ",ORB=1
"RTN","ORQ21",12,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"M",ORI)) Q:ORI'>0  S CNT=CNT+1,@ORY@(CNT)=ORTTL_^(ORI),ORTTL=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",13,0)
 . S CNT=CNT+1,@ORY@(CNT)="History and Reason for Exam:"
"RTN","ORQ21",14,0)
 . F  S ORI=$O(^TMP($J,"RAE2",+ORVP,CASE,PROC,"H",ORI)) Q:ORI'>0  S CNT=CNT+1,@ORY@(CNT)="  "_^(ORI)
"RTN","ORQ21",15,0)
RAD1 I $L($G(^TMP($J,"RAE2",+ORVP,CASE,PROC,"TCOM",1))) S X=^(1) D
"RTN","ORQ21",16,0)
 . N DIWL,DIWR,DIWF,I K ^UTILITY($J,"W")
"RTN","ORQ21",17,0)
 . S DIWL=1,DIWR=72,DIWF="C72" D ^DIWP
"RTN","ORQ21",18,0)
 . S CNT=CNT+1,@ORY@(CNT)="Technologist's Comment:",ORB=1
"RTN","ORQ21",19,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="  "_^(I,0)
"RTN","ORQ21",20,0)
 K ^TMP($J,"RAE2",+ORVP),^UTILITY($J,"W")
"RTN","ORQ21",21,0)
 S:$G(ORB) CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ21",22,0)
 Q
"RTN","ORQ21",23,0)
 ;
"RTN","ORQ21",24,0)
MED ; -- Add Pharmacy order data
"RTN","ORQ21",25,0)
 N TYPE,NODE,RXN,OR5 S TYPE=$P(OR0,U,12)
"RTN","ORQ21",26,0)
 I '$D(^TMP("PS",$J,0)) D  ;get PS data
"RTN","ORQ21",27,0)
 . N PSIFN S PSIFN=$G(^OR(100,ORIFN,4))
"RTN","ORQ21",28,0)
 . S:TYPE="O" PSIFN=$TR(PSIFN,"S","P")_$S(PSIFN?1.N:"R",1:"")
"RTN","ORQ21",29,0)
 . D OEL^PSOORRL(+ORVP,PSIFN_";"_TYPE)
"RTN","ORQ21",30,0)
 S NODE=$G(^TMP("PS",$J,0)),RXN=$G(^("RXN",0))
"RTN","ORQ21",31,0)
 I '$L(NODE) K ^TMP("PS",$J) Q  ;error
"RTN","ORQ21",32,0)
 I $O(^TMP("PS",$J,"DD",0)) D  ;Disp Drugs
"RTN","ORQ21",33,0)
 . N I,X,Y S X="Dispense Drugs (units/dose):  ",I=0
"RTN","ORQ21",34,0)
 . F  S I=$O(^TMP("PS",$J,"DD",I)) Q:I'>0  S Y=$G(^(I,0)) S:Y CNT=CNT+1,@ORY@(CNT)=X_$$GET1^DIQ(50,+Y_",",.01)_" ("_$P(Y,U,2)_")"
"RTN","ORQ21",35,0)
 S:$P(NODE,U,9) CNT=CNT+1,@ORY@(CNT)="Total Dose:                   "_$P(NODE,U,9)
"RTN","ORQ21",36,0)
M1 I TYPE="I" D  ;admin data
"RTN","ORQ21",37,0)
 . N I,X,Y I $O(^TMP("PS",$J,"B",0)) D
"RTN","ORQ21",38,0)
 .. S X="IV Print Name:                ",I=0
"RTN","ORQ21",39,0)
 .. F  S I=$O(^TMP("PS",$J,"B",I)) Q:I<1  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_$P(Y,U),X=$$REPEAT^XLFSTR(" ",30) I $L($P(Y,U,3)) S CNT=CNT+1,@ORY@(CNT)=X_" "_$P(Y,U,3)
"RTN","ORQ21",40,0)
 . S I=+$O(^TMP("PS",$J,"SCH",0)),X=$P($G(^(I,0)),U,2)
"RTN","ORQ21",41,0)
 . S:$L(X) CNT=CNT+1,@ORY@(CNT)="Schedule Type:                "_X
"RTN","ORQ21",42,0)
 . S X="Administration Times:         ",I=0
"RTN","ORQ21",43,0)
 . F  S I=$O(^TMP("PS",$J,"ADM",I)) Q:I'>0  S Y=$G(^(I,0)) S:$L(Y) CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",44,0)
M2 I TYPE="O" D  ;fill history
"RTN","ORQ21",45,0)
 . N FILLD,X,Y,I
"RTN","ORQ21",46,0)
 . S:$P(NODE,U,12) CNT=CNT+1,@ORY@(CNT)="Last Filled:                  "_$$FMTE^XLFDT($P(NODE,U,12),2)
"RTN","ORQ21",47,0)
 . S CNT=CNT+1,@ORY@(CNT)="Refills Remaining:            "_$P(NODE,U,4)
"RTN","ORQ21",48,0)
 . I $P(RXN,U,6)!$G(^TMP("PS",$J,"REF",0)) S X="Filled:                       " D
"RTN","ORQ21",49,0)
 .. I $P(RXN,U,6) S FILLD=$P(RXN,U,6)_"^^^"_$P(RXN,U,7)_U_$P(RXN,U,3,4) D FILLED("R")
"RTN","ORQ21",50,0)
 .. S I=0 F  S I=$O(^TMP("PS",$J,"REF",I)) Q:I'>0  S FILLD=$G(^(I,0)) D FILLED("R")
"RTN","ORQ21",51,0)
 . I $G(^TMP("PS",$J,"PAR",0)) S I=0,X="Partial Fills:      " F  S I=$O(^TMP("PS",$J,"PAR",I)) Q:I'>0  S FILLD=$G(^(I,0)) D FILLED("P")
"RTN","ORQ21",52,0)
 . S:RXN CNT=CNT+1,@ORY@(CNT)="Prescription#:                "_$P(RXN,U)
"RTN","ORQ21",53,0)
M3 S:$P(RXN,U,5) CNT=CNT+1,@ORY@(CNT)="Pharmacist:                   "_$P($G(^VA(200,+$P(RXN,U,5),0)),U)
"RTN","ORQ21",54,0)
 S:$P(NODE,U,13) CNT=CNT+1,@ORY@(CNT)="NOT TO BE GIVEN" K ^TMP("PS",$J)
"RTN","ORQ21",55,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ21",56,0)
 S OR5=$G(^OR(100,ORIFN,5)) I $L(OR5) D  ;SC data
"RTN","ORQ21",57,0)
 . N X,Y,I S X="For conditions related to:    "
"RTN","ORQ21",58,0)
 . F I=1:1:6 S Y=$P(OR5,U,I) I Y S CNT=CNT+1,@ORY@(CNT)=X_$$SC(I),X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",59,0)
 Q
"RTN","ORQ21",60,0)
 ;
"RTN","ORQ21",61,0)
FILLED(TYPE) ; -- add FILLD data
"RTN","ORQ21",62,0)
 N Y S Y=$$FMTE^XLFDT($P(FILLD,U),2)_" ("_$$ROUTING($P(FILLD,U,5))_")"
"RTN","ORQ21",63,0)
 S:TYPE="R"&$P(FILLD,U,4) Y=Y_" released "_$$FMTE^XLFDT($P(FILLD,U,4),2)
"RTN","ORQ21",64,0)
 S:TYPE="P"&$P(FILLD,U,3) Y=Y_" Qty: "_$P(FILLD,U,3)
"RTN","ORQ21",65,0)
 S CNT=CNT+1,@ORY@(CNT)=X_Y,X=$$REPEAT^XLFSTR(" ",30)
"RTN","ORQ21",66,0)
 S:$L($P(FILLD,U,6)) CNT=CNT+1,@ORY@(CNT)=X_$P(FILLD,U,6)
"RTN","ORQ21",67,0)
 Q
"RTN","ORQ21",68,0)
 ;
"RTN","ORQ21",69,0)
ROUTING(X) ; -- Returns external form
"RTN","ORQ21",70,0)
 N Y S Y=$S($G(X)="M":"Mail",$G(X)="W":"Window",1:$G(X))
"RTN","ORQ21",71,0)
 Q Y
"RTN","ORQ21",72,0)
 ;
"RTN","ORQ21",73,0)
SC(J) ; -- Returns name of SC field by piece number
"RTN","ORQ21",74,0)
 I '$G(J) Q ""
"RTN","ORQ21",75,0)
 I J=1 Q "SERVICE CONNECTED CONDITION"
"RTN","ORQ21",76,0)
 I J=2 Q "MILITARY SEXUAL TRAUMA"
"RTN","ORQ21",77,0)
 I J=3 Q "AGENT ORANGE EXPOSURE"
"RTN","ORQ21",78,0)
 I J=4 Q "IONIZING RADIATION EXPOSURE"
"RTN","ORQ21",79,0)
 I J=5 Q "ENVIRONMENTAL CONTAMINANTS"
"RTN","ORQ21",80,0)
 I J=6 Q "HEAD OR NECK CANCER"
"RTN","ORQ21",81,0)
 Q ""
"RTN","ORWCIRN")
0^52^B3842701
"RTN","ORWCIRN",1,0)
ORWCIRN ; slc/dcm,REV - Functions for GUI CIRN ACTIONS ;22-NOV-1999 07:27:24
"RTN","ORWCIRN",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,101,109,132,141**;October 28, 1997
"RTN","ORWCIRN",3,0)
 ;
"RTN","ORWCIRN",4,0)
FACLIST(ORY,ORDFN) ; Return list of remote facilities for patient
"RTN","ORWCIRN",5,0)
 ;Check to see if CIRN PD/MPI installed
"RTN","ORWCIRN",6,0)
 N X,ORSITES,I,IFN,LOCAL
"RTN","ORWCIRN",7,0)
 S X="MPIF001" X ^%ZOSF("TEST")
"RTN","ORWCIRN",8,0)
 I '$T S ORY(0)="-1^CIRN MPI not installed." Q
"RTN","ORWCIRN",9,0)
 S X="VAFCTFU1" X ^%ZOSF("TEST")
"RTN","ORWCIRN",10,0)
 I '$T S ORY(0)="-1^Remote data view not installed." Q
"RTN","ORWCIRN",11,0)
 S X=$$GET^XPAR("ALL","ORWRP CIRN REMOTE DATA ALLOW",1,"I")
"RTN","ORWCIRN",12,0)
 I 'X S ORY(0)="-1^Remote access not allowed" Q
"RTN","ORWCIRN",13,0)
 D TFL^VAFCTFU1(.ORY,ORDFN)
"RTN","ORWCIRN",14,0)
 I $$GET^XPAR("ALL","ORWRP CIRN SITES ALL",1,"I") D
"RTN","ORWCIRN",15,0)
 . S I=0
"RTN","ORWCIRN",16,0)
 . F  S I=$O(ORY(I)) Q:'I  S $P(ORY(I),"^",5)=1 I $P(ORY(I),"^")=776!($P(ORY(I),"^")=200) S $P(ORY(I),"^",2)="DEPT. OF DEFENSE"
"RTN","ORWCIRN",17,0)
 D GETLST^XPAR(.ORSITES,"ALL","ORWRP CIRN SITES","I")
"RTN","ORWCIRN",18,0)
 S I=0,LOCAL=$P($$SITE^VASITE,"^",3)
"RTN","ORWCIRN",19,0)
 F  S I=$O(ORY(I)) Q:'I  D
"RTN","ORWCIRN",20,0)
 . I +ORY(I)=+LOCAL K ORY(I) Q
"RTN","ORWCIRN",21,0)
 . S IFN=$O(^DIC(4,"D",+ORY(I),0)) I IFN,$G(ORSITES(IFN)) S $P(ORY(I),"^",5)=1
"RTN","ORWCIRN",22,0)
 I '$L($O(ORY(""))) S ORY(0)="-1^Only local data exists for this patient"
"RTN","ORWCIRN",23,0)
 Q
"RTN","ORWCIRN",24,0)
RESTRICT(ORY,PATID) ;Check for sensitive patient
"RTN","ORWCIRN",25,0)
 N DFN,ICN,SITE
"RTN","ORWCIRN",26,0)
 I '$G(PATID) S ORY(1)="-1",ORY(2)="Invalid Patient ID" Q
"RTN","ORWCIRN",27,0)
 S ICN=$P(PATID,";",2)
"RTN","ORWCIRN",28,0)
 I 'ICN S ORY(1)="-1",ORY(2)="Invalid ICN" Q
"RTN","ORWCIRN",29,0)
 S SITE=$$SITE^VASITE,SITE=$P(SITE,"^",2)_";"_$P(SITE,"^",3)
"RTN","ORWCIRN",30,0)
 S DFN=+$$GETDFN^MPIF001(ICN)
"RTN","ORWCIRN",31,0)
 I DFN<0 S ORY(1)="-1",ORY(2)="Patient not found on remote system ("_SITE_")" Q
"RTN","ORWCIRN",32,0)
 D PTSEC^DGSEC4(.ORY,DFN)
"RTN","ORWCIRN",33,0)
 Q
"RTN","ORWCIRN",34,0)
CHKLNK(ORY) ;Check for active HL7 TCP link on local system
"RTN","ORWCIRN",35,0)
 S ORY=$$STAT^HLCSLM
"RTN","ORWCIRN",36,0)
 Q
"RTN","ORWDFH")
0^47^B31281164
"RTN","ORWDFH",1,0)
ORWDFH ; SLC/KCM/JLI - Diet Order calls for Windows Dialogs ;12/12/00  14:44
"RTN","ORWDFH",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,141**;Dec 17, 1997
"RTN","ORWDFH",3,0)
TXT(LST,DFN)    ; Return text of current & future diets for a patient
"RTN","ORWDFH",4,0)
 S LST(1)="Current Diet:  "_$$DIET^ORCDFH(DFN)
"RTN","ORWDFH",5,0)
 N FUTLST D FUT(.FUTLST,DFN) I $D(FUTLST)>1 D
"RTN","ORWDFH",6,0)
 . S LST(2)="Future Diet Orders:",ILST=2
"RTN","ORWDFH",7,0)
 . S I=0 F  S I=$O(FUTLST(I)) Q:'I  D
"RTN","ORWDFH",8,0)
 . . S X=$$FMTE^XLFDT(I,2)_"  "_$P(FUTLST(I),U,2)
"RTN","ORWDFH",9,0)
 . . S LST(ILST)=$S(ILST=2:"Future Diet Orders:  "_X,1:"   "_X)
"RTN","ORWDFH",10,0)
 . . S ILST=ILST+1
"RTN","ORWDFH",11,0)
 Q
"RTN","ORWDFH",12,0)
FUT(LST,DFN)    ; Return a list of future diet orders
"RTN","ORWDFH",13,0)
 N DGRP,NXTDT,ORIFN,ORVP,ORTX
"RTN","ORWDFH",14,0)
 S ORVP=DFN_";DPT(",DGRP=$O(^ORD(100.98,"B","DO",0)),NXTDT=$$NOW^XLFDT
"RTN","ORWDFH",15,0)
 F  S NXTDT=$O(^OR(100,"AW",ORVP,DGRP,NXTDT)) Q:NXTDT'>0  D
"RTN","ORWDFH",16,0)
 . S ORIFN=+$O(^OR(100,"AW",ORVP,DGRP,NXTDT,0))
"RTN","ORWDFH",17,0)
 . I $P($G(^OR(100,ORIFN,3)),U,3)'=8 Q  ; only scheduled diets
"RTN","ORWDFH",18,0)
 . D TEXT^ORQ12(.ORTX,ORIFN) S LST(NXTDT)=NXTDT_U_$G(ORTX(1))
"RTN","ORWDFH",19,0)
 Q
"RTN","ORWDFH",20,0)
PARAM(ORLST,ORVP,ORLOC)  ; Return dietetics parameters for a patient at a location
"RTN","ORWDFH",21,0)
 ; ORLOC: hospital location ptr to ^SC #44
"RTN","ORWDFH",22,0)
 ; ORLST(1)=EB1^EB2^EB3^LB1^LB2^LB3^EN1^EN2^...LE2^LE3
"RTN","ORWDFH",23,0)
 ; ORLST(2)=BAB^BAE^NAB^NAE^EAB^EAE^BegB^BegN^BegE^Bagged
"RTN","ORWDFH",24,0)
 ; ORLST(3)=type of service^RegIEN^NPOIEN^EarlyIEN^LateIEN^TFIFN
"RTN","ORWDFH",25,0)
 Q:'+ORVP
"RTN","ORWDFH",26,0)
 S ORVP=+ORVP_";DPT(",ORLOC=+ORLOC
"RTN","ORWDFH",27,0)
 I $D(^SC(ORLOC,42)) S ORLOC=$G(^SC(ORLOC,42))
"RTN","ORWDFH",28,0)
 E  S ORLOC=0
"RTN","ORWDFH",29,0)
 D:ORLOC>0 EN1^FHWOR8(ORLOC,.ORLST)
"RTN","ORWDFH",30,0)
 I '$L($G(ORLST(3))) S ORLST(3)="T"
"RTN","ORWDFH",31,0)
 S $P(ORLST(3),U,2)=$O(^ORD(101.43,"S.DIET","REGULAR",0))
"RTN","ORWDFH",32,0)
 S $P(ORLST(3),U,3)=$O(^ORD(101.43,"S.DIET","NPO",0))
"RTN","ORWDFH",33,0)
 S $P(ORLST(3),U,4)=$O(^ORD(101.43,"S.E/L T","EARLY TRAY",0))
"RTN","ORWDFH",34,0)
 S $P(ORLST(3),U,5)=$O(^ORD(101.43,"S.E/L T","LATE TRAY",0))
"RTN","ORWDFH",35,0)
 N TF S TF=$$CURRENT^ORCDFH("TF") I $L(TF,";")=1 S TF=TF_";1"
"RTN","ORWDFH",36,0)
 I TF,'$$FUTURE^ORCDFH("EFFECTIVE DATE/TIME") S $P(ORLST(3),U,6)=TF
"RTN","ORWDFH",37,0)
 Q
"RTN","ORWDFH",38,0)
ATTR(REC,OI)    ; Return OI^Text^Type^Precedence^AskExpire for a diet
"RTN","ORWDFH",39,0)
 S REC=OI_U_$P($G(^ORD(101.43,OI,0)),U)_U_$G(^("FH"))
"RTN","ORWDFH",40,0)
 Q
"RTN","ORWDFH",41,0)
DIETS(Y,FROM,DIR)       ; Return a subset of active diets, including NPO
"RTN","ORWDFH",42,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDFH",43,0)
 N I,IEN,CNT,X,CURTM
"RTN","ORWDFH",44,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDFH",45,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,"S.DIET",FROM),DIR) Q:FROM=""  D
"RTN","ORWDFH",46,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.43,"S.DIET",FROM,IEN)) Q:'IEN  D
"RTN","ORWDFH",47,0)
 . . S X=^ORD(101.43,"S.DIET",FROM,IEN)
"RTN","ORWDFH",48,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDFH",49,0)
 . . I $P($G(^ORD(101.43,IEN,"FH")),U)'="D",($P($G(^(0)),U)'="NPO") Q
"RTN","ORWDFH",50,0)
 . . S I=I+1
"RTN","ORWDFH",51,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDFH",52,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDFH",53,0)
 Q
"RTN","ORWDFH",54,0)
TFPROD(Y)     ; Return a list of active tubefeeding products
"RTN","ORWDFH",55,0)
 N I,IEN,NAM,X,CURTM
"RTN","ORWDFH",56,0)
 S I=0,NAM="",CURTM=$$NOW^XLFDT
"RTN","ORWDFH",57,0)
 F  S NAM=$O(^ORD(101.43,"S.TF",NAM)) Q:NAM=""  D
"RTN","ORWDFH",58,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.43,"S.TF",NAM,IEN)) Q:'IEN  D
"RTN","ORWDFH",59,0)
 . . S X=^ORD(101.43,"S.TF",NAM,IEN)
"RTN","ORWDFH",60,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDFH",61,0)
 . . S I=I+1
"RTN","ORWDFH",62,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDFH",63,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDFH",64,0)
 Q
"RTN","ORWDFH",65,0)
QTY2CC(VAL,PRD,STR,QTY)     ; Return cc's given a product, strength, & quantity
"RTN","ORWDFH",66,0)
 N X,VQTY,DUR
"RTN","ORWDFH",67,0)
 S VQTY=$$VALIDQTY^ORCDFHTF(QTY) I '$L(VQTY)!('PRD)!('STR) S VAL="" Q
"RTN","ORWDFH",68,0)
 S PRD=+$P($G(^ORD(101.43,PRD,0)),U,2)
"RTN","ORWDFH",69,0)
 S DUR=$P(VQTY," X ",2) I $L(DUR) S DUR=$S(DUR["H":"H",1:"X")_+DUR
"RTN","ORWDFH",70,0)
 S X=+VQTY_"&"_$E($P(VQTY," ",2))_U_$P($P(VQTY,"/",2)," ")_U_DUR
"RTN","ORWDFH",71,0)
 S VAL=$$QUAN^FHWOR5R(PRD_"-"_STR,X)_U_VQTY
"RTN","ORWDFH",72,0)
 Q
"RTN","ORWDFH",73,0)
FINDTYP(VAL,DGRP)       ; Return type of dietetics order based on display group
"RTN","ORWDFH",74,0)
 S VAL=$P($G(^ORD(100.98,DGRP,0)),U,3)
"RTN","ORWDFH",75,0)
 S:VAL="D AO" VAL="A" S VAL=$E(VAL)
"RTN","ORWDFH",76,0)
 Q
"RTN","ORWDFH",77,0)
ISOIEN(VAL)     ; Return IEN for the Isolation/Precaution orderable item
"RTN","ORWDFH",78,0)
 S VAL=$O(^ORD(101.43,"S.PREC","ISOLATION PROCEDURES",0))
"RTN","ORWDFH",79,0)
 Q
"RTN","ORWDFH",80,0)
CURISO(VAL,ORVP) ; Return a patient's current isolation
"RTN","ORWDFH",81,0)
 S ORVP=ORVP_";DPT(" S VAL=$P($$IP^ORMBLD,U,2)
"RTN","ORWDFH",82,0)
 I '$L(VAL) S VAL="<none>"
"RTN","ORWDFH",83,0)
 Q
"RTN","ORWDFH",84,0)
ISOLIST(LST)    ; Return list of active isolations/precautions
"RTN","ORWDFH",85,0)
 N I,X,IEN
"RTN","ORWDFH",86,0)
 S I=0,X="" F  S X=$O(^FH(119.4,"B",X)) Q:X=""  S IEN=$O(^(X,0)) D
"RTN","ORWDFH",87,0)
 . I '$D(^FH(119.4,IEN,"I")) S I=I+1,LST(I)=IEN_U_X
"RTN","ORWDFH",88,0)
 Q
"RTN","ORWDFH",89,0)
MILTM(X)        ; return military time for am/pm time
"RTN","ORWDFH",90,0)
 N TM
"RTN","ORWDFH",91,0)
 S TM=$P(X,":",1)_+$P(X,":",2)
"RTN","ORWDFH",92,0)
 I X["P",TM<1200 S TM=TM+1200
"RTN","ORWDFH",93,0)
 I X["A",TM>1200 S TM=TM-1200
"RTN","ORWDFH",94,0)
 Q TM
"RTN","ORWDFH",95,0)
 ;
"RTN","ORWDFH",96,0)
ASKLATE(REC,DFN,ORIFN)        ; Return info for ordering late tray for diet order
"RTN","ORWDFH",97,0)
 ; REC=0  or  1^meal^bagged^time^time^time
"RTN","ORWDFH",98,0)
 S REC=0 Q:'$G(ORIFN)  Q:$E($$VALUE^ORX8(ORIFN,"ORDERABLE",1,"E"),1,3)="NPO"
"RTN","ORWDFH",99,0)
 N X,Y,%DT,STRT,DATE,PARAM,I,MEAL,MEALTIME
"RTN","ORWDFH",100,0)
 S X=$O(^OR(100,ORIFN,4.5,"ID","START",0)),X=$G(^OR(100,ORIFN,4.5,+X,1))
"RTN","ORWDFH",101,0)
 Q:X=""  S %DT="TX" D ^%DT Q:Y'>0  Q:$P(Y,".")>DT  ;invalid or future
"RTN","ORWDFH",102,0)
 S DATE=$P(Y,"."),STRT=+$E($P(Y,".",2)_"0000",1,4),MEAL=0
"RTN","ORWDFH",103,0)
 D EN^FHWOR8(DFN,.PARAM) Q:'$D(PARAM(2))
"RTN","ORWDFH",104,0)
 F I=1,3,5 I $P(PARAM(2),U,I)<STRT,STRT<$P(PARAM(2),U,I+1) S MEAL=I Q
"RTN","ORWDFH",105,0)
 S MEAL=$S(MEAL=1:4,MEAL=3:10,MEAL=5:16,1:0) Q:'MEAL
"RTN","ORWDFH",106,0)
 S MEALTIME=$P(PARAM(1),U,MEAL,MEAL+2)
"RTN","ORWDFH",107,0)
 S MEAL=$S(MEAL=4:"B",MEAL=10:"N",MEAL=16:"E",1:"")
"RTN","ORWDFH",108,0)
 F I=1:1:3 S X=$$MILTM($P(MEAL,U,I)) I X<STRT S $P(MEAL,U,I)=""
"RTN","ORWDFH",109,0)
 S REC="1"_U_MEAL_U_$P(PARAM(2),U,10)_U_MEALTIME
"RTN","ORWDFH",110,0)
 I $P(REC,U,2,4)="^^" S REC=0
"RTN","ORWDFH",111,0)
 Q
"RTN","ORWDFH",112,0)
ADDLATE(REC,ORVP,ORNP,ORL,MEAL,TIME,BAG)      ; Add late tray order
"RTN","ORWDFH",113,0)
 N ORIFN,ORNEW,ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORCHECK,ORLOG
"RTN","ORWDFH",114,0)
 N ORDIALOG,ORDG,ORTYPE,DA,FIRST,TRAY
"RTN","ORWDFH",115,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDFH",116,0)
 S ORTYPE="D",FIRST=1,ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORWDFH",117,0)
 S TRAY=+$O(^ORD(101.43,"S.E/L T","LATE TRAY",0))
"RTN","ORWDFH",118,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","FHW2",0))
"RTN","ORWDFH",119,0)
 D GETDLG^ORCD(ORDIALOG)
"RTN","ORWDFH",120,0)
 S ORDIALOG($$PTR^ORCD("OR GTX MEAL"),1)=MEAL
"RTN","ORWDFH",121,0)
 S ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1)=TRAY
"RTN","ORWDFH",122,0)
 S ORDIALOG($$PTR^ORCD("OR GTX START DATE"),1)=DT
"RTN","ORWDFH",123,0)
 S ORDIALOG($$PTR^ORCD("OR GTX STOP DATE"),1)=DT
"RTN","ORWDFH",124,0)
 S ORDIALOG($$PTR^ORCD("OR GTX MEAL TIME"),1)=TIME
"RTN","ORWDFH",125,0)
 S ORDIALOG($$PTR^ORCD("OR GTX YES/NO"),1)=BAG
"RTN","ORWDFH",126,0)
 D EN^ORCSAVE
"RTN","ORWDFH",127,0)
 S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDFH",128,0)
 Q
"RTN","ORWDFH",129,0)
  
"RTN","ORWDLR32")
0^72^B49348139
"RTN","ORWDLR32",1,0)
ORWDLR32 ; SLC/KCM/REV/JDL - Lab Calls 6/28/2002
"RTN","ORWDLR32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,141**;Dec 17, 1997
"RTN","ORWDLR32",3,0)
 ;
"RTN","ORWDLR32",4,0)
DEF(LST,ALOC,ADIV) ; procedure
"RTN","ORWDLR32",5,0)
 ; For Event Delay Order
"RTN","ORWDLR32",6,0)
 ;  ALOC: Delay Event's default location
"RTN","ORWDLR32",7,0)
 ;  ADIV: Delay Event's default division
"RTN","ORWDLR32",8,0)
 ; get dialog definition specific to lab
"RTN","ORWDLR32",9,0)
 S ILST=0
"RTN","ORWDLR32",10,0)
 S LST($$NXT)="~ShortList" D SHORT
"RTN","ORWDLR32",11,0)
 S LST($$NXT)="~Lab Collection Times" D LCOLLTM
"RTN","ORWDLR32",12,0)
 S LST($$NXT)="~Ward Collection Times" D WCOLLTM
"RTN","ORWDLR32",13,0)
 S LST($$NXT)="~Send Patient Times" D SENDTM
"RTN","ORWDLR32",14,0)
 S LST($$NXT)="~Collection Types" D COLLTYP
"RTN","ORWDLR32",15,0)
 S LST($$NXT)="~Default Urgency" D URGENCY
"RTN","ORWDLR32",16,0)
 S LST($$NXT)="~Schedules" D SCHED
"RTN","ORWDLR32",17,0)
 S LST($$NXT)="~Common" D COMMON
"RTN","ORWDLR32",18,0)
 Q
"RTN","ORWDLR32",19,0)
SHORT ; from DEF, get short list of lab quick orders
"RTN","ORWDLR32",20,0)
 N I,ORTMP
"RTN","ORWDLR32",21,0)
 S I=$O(^ORD(100.98,"B","LAB",0))
"RTN","ORWDLR32",22,0)
 D GETQLST^ORWDXQ(.ORTMP,I,"Q")
"RTN","ORWDLR32",23,0)
 S I=0 F  S I=$O(ORTMP(I)) Q:'I  D
"RTN","ORWDLR32",24,0)
 . S LST($$NXT)="i"_ORTMP(I)
"RTN","ORWDLR32",25,0)
 Q
"RTN","ORWDLR32",26,0)
LCOLLTM ; get collection times
"RTN","ORWDLR32",27,0)
 N TDAY,TMRW,IGNOR,CNT,ICTM,ORCTM,DOW,AMPM,DAY,TIME,TXDT
"RTN","ORWDLR32",28,0)
 S TDAY=DT,TDAY("DOW")=$H#7,TDAY("H")=$H,TDAY("TX")="T"
"RTN","ORWDLR32",29,0)
 M TMRW=TDAY D INCDATE(.TMRW)
"RTN","ORWDLR32",30,0)
 I $G(ALOC),'$$GET^XPAR(ALOC_";SC(","LR EXCEPTED LOCATIONS",1,"Q") D
"RTN","ORWDLR32",31,0)
 . S IGNOR=$$GET^XPAR("ALL","LR IGNORE HOLIDAYS",1,"Q")
"RTN","ORWDLR32",32,0)
 . S DOW(0)=$$GET^XPAR("ALL","LR COLLECT THURSDAY",1,"Q")
"RTN","ORWDLR32",33,0)
 . S DOW(1)=$$GET^XPAR("ALL","LR COLLECT FRIDAY",1,"Q")
"RTN","ORWDLR32",34,0)
 . S DOW(2)=$$GET^XPAR("ALL","LR COLLECT SATURDAY",1,"Q")
"RTN","ORWDLR32",35,0)
 . S DOW(3)=$$GET^XPAR("ALL","LR COLLECT SUNDAY",1,"Q")
"RTN","ORWDLR32",36,0)
 . S DOW(4)=$$GET^XPAR("ALL","LR COLLECT MONDAY",1,"Q")
"RTN","ORWDLR32",37,0)
 . S DOW(5)=$$GET^XPAR("ALL","LR COLLECT TUESDAY",1,"Q")
"RTN","ORWDLR32",38,0)
 . S DOW(6)=$$GET^XPAR("ALL","LR COLLECT WEDNESDAY",1,"Q")
"RTN","ORWDLR32",39,0)
 . S CNT=0 F  Q:(DOW(TDAY("DOW"))=1)&((IGNOR=1)!('$D(^HOLIDAY(TDAY,0))))  D  Q:CNT>6
"RTN","ORWDLR32",40,0)
 . . D INCDATE(.TDAY) S CNT=CNT+1
"RTN","ORWDLR32",41,0)
 . S CNT=0 F  Q:(DOW(TMRW("DOW"))=1)&((IGNOR=1)!('$D(^HOLIDAY(TMRW,0))))  D  Q:CNT>6
"RTN","ORWDLR32",42,0)
 . . D INCDATE(.TMRW) S CNT=CNT+1
"RTN","ORWDLR32",43,0)
 I $G(ADIV) D GETLST^XPAR(.ORCTM,ADIV_";DIC(4,^SYS","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR32",44,0)
 E  D GETLST^XPAR(.ORCTM,"ALL","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR32",45,0)
 ;S DUZ(2)=TMPDIV
"RTN","ORWDLR32",46,0)
 S LST($$NXT)="iLNEXT^Next scheduled lab collection"
"RTN","ORWDLR32",47,0)
 S ICTM=0 F  S ICTM=$O(ORCTM(ICTM)) Q:'ICTM  D
"RTN","ORWDLR32",48,0)
 . I $P(ORCTM(ICTM),U)>$P($H,",",2) D
"RTN","ORWDLR32",49,0)
 . . S TXDT=TDAY("TX")
"RTN","ORWDLR32",50,0)
 . . I +TDAY("H")=+$H S DAY="Today"
"RTN","ORWDLR32",51,0)
 . . I TDAY("H")-$H=1 S DAY="Tomorrow"
"RTN","ORWDLR32",52,0)
 . . I TDAY("H")-$H>1 S DAY=$$DOWNAME(TDAY("DOW"))
"RTN","ORWDLR32",53,0)
 . E  D
"RTN","ORWDLR32",54,0)
 . . S TXDT=TMRW("TX")
"RTN","ORWDLR32",55,0)
 . . S DAY=$S(TMRW("H")-$H>1:$$DOWNAME(TMRW("DOW")),1:"Tomorrow")
"RTN","ORWDLR32",56,0)
 . S AMPM=$S($P(ORCTM(ICTM),U,2)>1159:"PM",1:"AM")
"RTN","ORWDLR32",57,0)
 . S TXDT=TXDT_"@"_$P(ORCTM(ICTM),"^",2)
"RTN","ORWDLR32",58,0)
 . S TIME=$P(ORCTM(ICTM),U,2),TIME=$E(TIME,1,2)_":"_$E(TIME,3,4)
"RTN","ORWDLR32",59,0)
 . S LST($$NXT)="iL"_TXDT_U_AMPM_" Collection: "_TIME_" ("_DAY_")"
"RTN","ORWDLR32",60,0)
 . S ^TMP($J,"WC",ILST)="iW"_TXDT_U_TIME_" "_AMPM_" ("_DAY_") Ward collect"
"RTN","ORWDLR32",61,0)
 ; D NOW^%DTC
"RTN","ORWDLR32",62,0)
 ;S LST($$NXT)="iWNOW^Now (Collect on ward)"
"RTN","ORWDLR32",63,0)
 S LST($$NXT)="iLO^Future"
"RTN","ORWDLR32",64,0)
 Q
"RTN","ORWDLR32",65,0)
WCOLLTM ; get Ward Collect times
"RTN","ORWDLR32",66,0)
 S I=""
"RTN","ORWDLR32",67,0)
 F  S I=$O(^TMP($J,"WC",I)) Q:I=""  D
"RTN","ORWDLR32",68,0)
 . S LST($$NXT)=^TMP($J,"WC",I)
"RTN","ORWDLR32",69,0)
 S LST($$NXT)="iWNOW^Now (Collect on ward)"
"RTN","ORWDLR32",70,0)
 ;S LST($$NXT)="iWO^Other"
"RTN","ORWDLR32",71,0)
 K ^TMP($J,"WC")
"RTN","ORWDLR32",72,0)
 Q
"RTN","ORWDLR32",73,0)
SENDTM ; get send patient times
"RTN","ORWDLR32",74,0)
 ;N X,X1,X2
"RTN","ORWDLR32",75,0)
 S LST($$NXT)="iLT^Today"
"RTN","ORWDLR32",76,0)
 ;S X1=DT,X2=1 D C^%DTC
"RTN","ORWDLR32",77,0)
 S LST($$NXT)="iLT+1^Tomorrow"
"RTN","ORWDLR32",78,0)
 ;S LST($$NXT)="iLO^Other"
"RTN","ORWDLR32",79,0)
 Q
"RTN","ORWDLR32",80,0)
COLLTYP ; Collection Types in effect for this division
"RTN","ORWDLR32",81,0)
 N Y S Y=""
"RTN","ORWDLR32",82,0)
 S LST($$NXT)="iLC^Lab Collect"
"RTN","ORWDLR32",83,0)
 S LST($$NXT)="iWC^Ward Collect"
"RTN","ORWDLR32",84,0)
 S LST($$NXT)="iSP^Send Patient to Lab"
"RTN","ORWDLR32",85,0)
 I +$$ON^LR7OV4(DUZ(2)) S LST($$NXT)="iI^Immediate Collect"
"RTN","ORWDLR32",86,0)
 S:$G(ALOC) Y=$$GET^XPAR("ALL^"_ALOC_";SC(","LR DEFAULT TYPE QUICK")
"RTN","ORWDLR32",87,0)
 I $L(Y) S LST($$NXT)="d"_Y
"RTN","ORWDLR32",88,0)
 Q
"RTN","ORWDLR32",89,0)
INCDATE(ADATE) ; called from COLLTM, increments date nodes in .ADATE
"RTN","ORWDLR32",90,0)
 N X,X1,X2,%H
"RTN","ORWDLR32",91,0)
 S X1=ADATE,X2=1 D C^%DTC S ADATE=X
"RTN","ORWDLR32",92,0)
 S ADATE("H")=ADATE("H")+1
"RTN","ORWDLR32",93,0)
 S ADATE("DOW")=ADATE("H")#7
"RTN","ORWDLR32",94,0)
 S ADATE("TX")="T+"_($P(ADATE("TX"),"+",2)+1)
"RTN","ORWDLR32",95,0)
 Q
"RTN","ORWDLR32",96,0)
DOWNAME(DOW) ; function
"RTN","ORWDLR32",97,0)
 ; Returns Day of Week name (DOW should be $H#7)
"RTN","ORWDLR32",98,0)
 I DOW=0 Q "Thursday"
"RTN","ORWDLR32",99,0)
 I DOW=1 Q "Friday"
"RTN","ORWDLR32",100,0)
 I DOW=2 Q "Saturday"
"RTN","ORWDLR32",101,0)
 I DOW=3 Q "Sunday"
"RTN","ORWDLR32",102,0)
 I DOW=4 Q "Monday"
"RTN","ORWDLR32",103,0)
 I DOW=5 Q "Tuesday"
"RTN","ORWDLR32",104,0)
 I DOW=6 Q "Wednesday"
"RTN","ORWDLR32",105,0)
 Q ""
"RTN","ORWDLR32",106,0)
URGENCY ; return default urgency for lab
"RTN","ORWDLR32",107,0)
 N URG
"RTN","ORWDLR32",108,0)
 S URG=$$DEFURG^LR7OR3
"RTN","ORWDLR32",109,0)
 S LST($$NXT)="i"_URG_U_$P(^LAB(62.05,URG,0),U,1)
"RTN","ORWDLR32",110,0)
 S LST($$NXT)="d"_URG_U_$P(^LAB(62.05,URG,0),U,1)
"RTN","ORWDLR32",111,0)
 Q
"RTN","ORWDLR32",112,0)
SCHED ; return list of schedules available for lab tests
"RTN","ORWDLR32",113,0)
 N X,X0,IEN
"RTN","ORWDLR32",114,0)
 S X="" F  S X=$O(^PS(51.1,"APLR",X)) Q:X=""  S IEN=$O(^(X,0)) I IEN D
"RTN","ORWDLR32",115,0)
 . S X0=$G(^PS(51.1,IEN,0)) Q:X0=""
"RTN","ORWDLR32",116,0)
 . I (($P(X0,U,5)="C")!($P(X0,U,5)="D")),(+$P(X0,U,3)=0) Q
"RTN","ORWDLR32",117,0)
 . S LST($$NXT)="i"_IEN_U_X_U_$P(X0,U,5)_U_$P(X0,U,3)
"RTN","ORWDLR32",118,0)
 . I X="ONE TIME" S LST($$NXT)="d"_IEN_U_X
"RTN","ORWDLR32",119,0)
 Q
"RTN","ORWDLR32",120,0)
COMMON ; return list of commonly ordered lab tests
"RTN","ORWDLR32",121,0)
 N ORLST,IEN,I
"RTN","ORWDLR32",122,0)
 D GETLST^XPAR(.ORLST,"ALL","ORWD COMMON LAB INPT")
"RTN","ORWDLR32",123,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDLR32",124,0)
 . S IEN=$P(ORLST(I),U,2)
"RTN","ORWDLR32",125,0)
 . S LST($$NXT)="i"_IEN_U_$P(^ORD(101.43,IEN,0),U,1)
"RTN","ORWDLR32",126,0)
 Q
"RTN","ORWDLR32",127,0)
LOAD(LST,TESTID) ; procedure
"RTN","ORWDLR32",128,0)
 ; Return sample, specimen, & urgency info about a lab test
"RTN","ORWDLR32",129,0)
 N I,J,X,ORY,ILST,PARAM S ILST=0
"RTN","ORWDLR32",130,0)
 S LST($$NXT)="~Test Name"
"RTN","ORWDLR32",131,0)
 S LST($$NXT)="d"_$P(^ORD(101.43,TESTID,0),U,1)
"RTN","ORWDLR32",132,0)
 S X=$P($P(^ORD(101.43,TESTID,0),U,2),";",1)
"RTN","ORWDLR32",133,0)
 S X=$P(^LAB(60,X,0),U,4)
"RTN","ORWDLR32",134,0)
 S LST(ILST)=LST(ILST)_U_X
"RTN","ORWDLR32",135,0)
 I $D(^ORD(101.43,TESTID,8))>1 S LST($$NXT)="~OIMessage"
"RTN","ORWDLR32",136,0)
 S I=0 F  S I=$O(^ORD(101.43,TESTID,8,I)) Q:'I  S LST($$NXT)="t"_^(I,0)
"RTN","ORWDLR32",137,0)
 S TESTID=+$P(^ORD(101.43,TESTID,0),U,2)
"RTN","ORWDLR32",138,0)
 D TEST^LR7OR3(TESTID,.ORY)
"RTN","ORWDLR32",139,0)
 S PARAM="" F  S PARAM=$O(ORY(PARAM)) Q:PARAM=""  D
"RTN","ORWDLR32",140,0)
 . S LST($$NXT)="~"_PARAM
"RTN","ORWDLR32",141,0)
 . I PARAM="ReqCom" D
"RTN","ORWDLR32",142,0)
 . . S LST($$NXT)="d"_$G(ORY("ReqCom")) Q
"RTN","ORWDLR32",143,0)
 . I PARAM="Default CollSamp" D
"RTN","ORWDLR32",144,0)
 . . S LST($$NXT)="d"_$G(ORY("Default CollSamp")) Q
"RTN","ORWDLR32",145,0)
 . I PARAM="Unique CollSamp" D
"RTN","ORWDLR32",146,0)
 . . S LST($$NXT)="d"_$G(ORY("Unique CollSamp")) Q
"RTN","ORWDLR32",147,0)
 . I PARAM="Default Urgency" D
"RTN","ORWDLR32",148,0)
 . . S LST($$NXT)="d"_$G(ORY("Default Urgency")) Q
"RTN","ORWDLR32",149,0)
 . I PARAM="Lab CollSamp" D
"RTN","ORWDLR32",150,0)
 . . S LST($$NXT)="d"_$G(ORY("Lab CollSamp")) Q
"RTN","ORWDLR32",151,0)
 . I $D(ORY(PARAM))>1 S I=0 F  S I=$O(ORY(PARAM,I)) Q:'I  D
"RTN","ORWDLR32",152,0)
 . . I PARAM="Specimens" S LST($$NXT)="i"_ORY(PARAM,I) Q
"RTN","ORWDLR32",153,0)
 . . I PARAM="Urgencies" S LST($$NXT)="i"_ORY(PARAM,I) Q
"RTN","ORWDLR32",154,0)
 . . I PARAM="GenWardInstructions" S LST($$NXT)="t"_ORY(PARAM,I,0) Q
"RTN","ORWDLR32",155,0)
 . . S LST($$NXT)="i"_I_U_ORY(PARAM,I)
"RTN","ORWDLR32",156,0)
 . . I PARAM="CollSamp" D
"RTN","ORWDLR32",157,0)
 . . . I $G(ORY("Lab CollSamp")) S $P(LST(ILST),U,8)=1
"RTN","ORWDLR32",158,0)
 . . . S X=+$P(ORY(PARAM,I),U,3)
"RTN","ORWDLR32",159,0)
 . . . I X S $P(LST(ILST),U,10)=$P($G(^LAB(61,X,0)),U,1)
"RTN","ORWDLR32",160,0)
 . . I $D(ORY(PARAM,I,"WP")) S J=0 F  S J=$O(ORY(PARAM,I,"WP",J)) Q:'J  D
"RTN","ORWDLR32",161,0)
 . . . S LST($$NXT)="t"_ORY(PARAM,I,"WP",J,0)
"RTN","ORWDLR32",162,0)
 Q
"RTN","ORWDLR32",163,0)
ALLSAMP(LST) ; procedure
"RTN","ORWDLR32",164,0)
 ; returns all collection samples
"RTN","ORWDLR32",165,0)
 ; n^SampIEN^SampName^SpecPtr^TubeTop^^^LabCollect^^SpecName
"RTN","ORWDLR32",166,0)
 N SMP,SPC,ILST,IEN,X,X0
"RTN","ORWDLR32",167,0)
 S ILST=0,LST($$NXT)="~CollSamp"
"RTN","ORWDLR32",168,0)
 S SMP="" F  S SMP=$O(^LAB(62,"B",SMP)) Q:SMP=""  D
"RTN","ORWDLR32",169,0)
 . S IEN=0 F  S IEN=$O(^LAB(62,"B",SMP,IEN)) Q:'IEN  D
"RTN","ORWDLR32",170,0)
 . . S X0=^LAB(62,IEN,0)
"RTN","ORWDLR32",171,0)
 . . S X="i"_U_IEN_U_SMP_U_$P(X0,U,2)_U_$P(X0,U,3)_U_U_U_$P(X0,U,7)
"RTN","ORWDLR32",172,0)
 . . I $P(X0,U,2) D
"RTN","ORWDLR32",173,0)
 . . . S $P(X,U,10)=$P(^LAB(61,+$P(X0,U,2),0),U,1)
"RTN","ORWDLR32",174,0)
 . . . S SPC($P(X,U,4))=$P(X,U,10)
"RTN","ORWDLR32",175,0)
 . . S LST($$NXT)=X
"RTN","ORWDLR32",176,0)
 S LST($$NXT)="~Specimens"
"RTN","ORWDLR32",177,0)
 S SPC=0 F  S SPC=$O(SPC(SPC)) Q:'SPC  S LST($$NXT)=SPC_U_SPC(SPC)
"RTN","ORWDLR32",178,0)
 Q
"RTN","ORWDLR32",179,0)
ONESAMP(LST,IEN) ;Return data for one colelction sample
"RTN","ORWDLR32",180,0)
 ; n^SampIEN^SampName^SpecPtr^TubeTop^^^LabCollect^^SpecName
"RTN","ORWDLR32",181,0)
 N SPC,ILST,X,X0
"RTN","ORWDLR32",182,0)
 Q:+$G(IEN)=0
"RTN","ORWDLR32",183,0)
 S ILST=0,LST($$NXT)="~CollSamp"
"RTN","ORWDLR32",184,0)
 S X0=^LAB(62,IEN,0)
"RTN","ORWDLR32",185,0)
 S X="i1"_U_IEN_U_$P(X0,U,1)_U_$P(X0,U,2)_U_$P(X0,U,3)_U_U_U_$P(X0,U,7)
"RTN","ORWDLR32",186,0)
 I $P(X0,U,2) D
"RTN","ORWDLR32",187,0)
 . S $P(X,U,10)=$P(^LAB(61,+$P(X0,U,2),0),U,1)
"RTN","ORWDLR32",188,0)
 . S SPC($P(X,U,4))=$P(X,U,10)
"RTN","ORWDLR32",189,0)
 S LST($$NXT)=X
"RTN","ORWDLR32",190,0)
 S LST($$NXT)="~Specimens"
"RTN","ORWDLR32",191,0)
 S SPC=0 F  S SPC=$O(SPC(SPC)) Q:'SPC  S LST($$NXT)=SPC_U_SPC(SPC)
"RTN","ORWDLR32",192,0)
 Q
"RTN","ORWDLR32",193,0)
ONESPEC(LST,IEN) ;return one specimen
"RTN","ORWDLR32",194,0)
 Q:(+$G(IEN)=0)!('$D(^LAB(61,IEN,0)))
"RTN","ORWDLR32",195,0)
 S LST=IEN_U_$P(^LAB(61,IEN,0),U,1)
"RTN","ORWDLR32",196,0)
 Q
"RTN","ORWDLR32",197,0)
ABBSPEC(LST) ; procedure
"RTN","ORWDLR32",198,0)
 ; returns specimens with abbreviation (uses 'E' xref)
"RTN","ORWDLR32",199,0)
 N X,IEN,ILST S ILST=0
"RTN","ORWDLR32",200,0)
 S X="" F  S X=$O(^LAB(61,"E",X)) Q:X=""  S IEN=$O(^(X,0)) D
"RTN","ORWDLR32",201,0)
 . S LST($$NXT)=IEN_U_$P(^LAB(61,IEN,0),U,1)
"RTN","ORWDLR32",202,0)
 Q
"RTN","ORWDLR32",203,0)
NXT() ; called by TESTINFO, increments ILST
"RTN","ORWDLR32",204,0)
 S ILST=ILST+1
"RTN","ORWDLR32",205,0)
 Q ILST
"RTN","ORWDLR32",206,0)
 ;
"RTN","ORWDLR33")
0^73^B16060018
"RTN","ORWDLR33",1,0)
ORWDLR33 ; SLC/KCM/REV/JDL - Lab Calls ; 7/1/2002 11AM
"RTN","ORWDLR33",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,141**;Dec 17, 1997
"RTN","ORWDLR33",3,0)
 ;
"RTN","ORWDLR33",4,0)
STOP(VAL,X2)       ; return a calculated stop date
"RTN","ORWDLR33",5,0)
 N X1,X
"RTN","ORWDLR33",6,0)
 S X1=DT D C^%DTC S VAL=X
"RTN","ORWDLR33",7,0)
 Q
"RTN","ORWDLR33",8,0)
MAXDAYS(Y,LOC,SCHED) ; Return max number of days for a continuing order
"RTN","ORWDLR33",9,0)
 N TMP1,TMP2
"RTN","ORWDLR33",10,0)
 S TMP1=$$GET^XPAR("ALL^LOC.`"_+LOC,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORWDLR33",11,0)
 I +TMP1=0 S Y="-1" Q
"RTN","ORWDLR33",12,0)
 I +$G(SCHED)>0 S TMP2=$P($G(^PS(51.1,SCHED,0)),U,7)
"RTN","ORWDLR33",13,0)
 E  S TMP2=0
"RTN","ORWDLR33",14,0)
 I +TMP1=0,+TMP2>0 S Y=TMP2 Q
"RTN","ORWDLR33",15,0)
 I +TMP2=0,+TMP1>0 S Y=TMP1 Q
"RTN","ORWDLR33",16,0)
 S Y=$S(+TMP1>+TMP2:+TMP2,+TMP2>+TMP1:+TMP1,+TMP1=+TMP2:+TMP1,1:0)
"RTN","ORWDLR33",17,0)
 Q
"RTN","ORWDLR33",18,0)
ALLSPEC(Y,FROM,DIR) ; Return a set of specimens from topography file
"RTN","ORWDLR33",19,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORWDLR33",20,0)
 F  Q:I'<CNT  S FROM=$O(^LAB(61,"B",FROM),DIR) Q:FROM=""  D
"RTN","ORWDLR33",21,0)
 . S IEN=0 F  S IEN=$O(^LAB(61,"B",FROM,IEN)) Q:'IEN  D
"RTN","ORWDLR33",22,0)
 . . S I=I+1,Y(I)=IEN_U_FROM_"  ("_$P($G(^LAB(61,IEN,0)),U,2)_")"
"RTN","ORWDLR33",23,0)
 Q
"RTN","ORWDLR33",24,0)
LABCOLTM(ORYN,ORDATE,ORLOC) ; Is this a routine lab collect time for this location?
"RTN","ORWDLR33",25,0)
 N ORDA,ORTI,ORDOW,ORCTM,I,X,Y
"RTN","ORWDLR33",26,0)
 S ORYN=0 Q:'$G(ORDATE)!($G(ORDATE)<0)!('$G(ORLOC))
"RTN","ORWDLR33",27,0)
 S ORDA=$P(ORDATE,".",1),ORTI=$P(ORDATE,".",2)
"RTN","ORWDLR33",28,0)
 S I=0 F  S I=$L(ORTI) Q:I>3  S ORTI=ORTI_"0"
"RTN","ORWDLR33",29,0)
 S X=ORDA D DW^%DTC S ORDOW=X
"RTN","ORWDLR33",30,0)
 D GETLST^XPAR(.ORCTM,"ALL","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR33",31,0)
 S I=0 F  S I=$O(ORCTM(I)) Q:'I  D
"RTN","ORWDLR33",32,0)
 . S:$P(ORCTM(I),U,2)=ORTI ORYN=1
"RTN","ORWDLR33",33,0)
 Q:ORYN=0
"RTN","ORWDLR33",34,0)
 I $G(ORLOC),$$GET^XPAR(ORLOC_";SC(","LR EXCEPTED LOCATIONS",1,"Q") S ORYN=1 Q
"RTN","ORWDLR33",35,0)
 I '$$GET^XPAR("ALL","LR IGNORE HOLIDAYS",1,"Q"),$D(^HOLIDAY(ORDA,0)) S ORYN=0 Q
"RTN","ORWDLR33",36,0)
 I $$GET^XPAR("ALL","LR COLLECT "_ORDOW,1,"Q") S ORYN=1 Q
"RTN","ORWDLR33",37,0)
 S ORYN=0
"RTN","ORWDLR33",38,0)
 Q
"RTN","ORWDLR33",39,0)
IMMCOLL(ORY) ; Return help screen showing immediate collect times
"RTN","ORWDLR33",40,0)
 D SHOW^LR7OV4(DUZ(2),.ORY)
"RTN","ORWDLR33",41,0)
 Q
"RTN","ORWDLR33",42,0)
ICDEFLT(ORY) ;Return default immediate collect time
"RTN","ORWDLR33",43,0)
 S ORY=$$DEFTIME^LR7OV4(DUZ(2))
"RTN","ORWDLR33",44,0)
 Q
"RTN","ORWDLR33",45,0)
ICVALID(ORY,ORTIME) ;Is the time a valid immediate collect time?
"RTN","ORWDLR33",46,0)
 S ORTIME=$P(ORTIME,".",1)_"."_$E($P(ORTIME,".",2),1,4)
"RTN","ORWDLR33",47,0)
 S ORY=$$VALID^LR7OV4(DUZ(2),ORTIME)
"RTN","ORWDLR33",48,0)
 Q
"RTN","ORWDLR33",49,0)
GETLABTM(ORY,ORDATE,ORLOC) ;Return list of lab collect times for a date and location
"RTN","ORWDLR33",50,0)
 N ORDA,ORTI,ORNOW,ORDOW,ORCTM,ORTI,X,%,%H
"RTN","ORWDLR33",51,0)
 S ORY(0)=0 Q:'$G(ORDATE)!($G(ORDATE)<0)!('$G(ORLOC))
"RTN","ORWDLR33",52,0)
 S ORDA=$P(ORDATE,".",1)
"RTN","ORWDLR33",53,0)
 S ORNOW=$$NOW^XLFDT,ORTI=$P(ORNOW,".",2)
"RTN","ORWDLR33",54,0)
 I ORDA<$P(ORNOW,".",1) S ORY(0)="-1^Dates in the past are not allowed." Q
"RTN","ORWDLR33",55,0)
 I '+$$GET^XPAR(ORLOC_";SC(","LR EXCEPTED LOCATIONS",1,"Q") D
"RTN","ORWDLR33",56,0)
 . S X=ORDA D DW^%DTC S ORDOW=X
"RTN","ORWDLR33",57,0)
 . I '+$$GET^XPAR("ALL","LR COLLECT "_ORDOW,1,"Q") S ORY(0)="-1^No collections on "_ORDOW Q
"RTN","ORWDLR33",58,0)
 . I '+$$GET^XPAR("ALL","LR IGNORE HOLIDAYS",1,"Q"),$D(^HOLIDAY(ORDA,0)) S ORY(0)="-1^No holiday collections" Q
"RTN","ORWDLR33",59,0)
 I +ORY(0)>-1 D 
"RTN","ORWDLR33",60,0)
 . D GETLST^XPAR(.ORY,"ALL","LR PHLEBOTOMY COLLECTION","Q")
"RTN","ORWDLR33",61,0)
 . I +$G(ORY)=0 S ORY(0)="-1^No lab collect times defined for this division" Q
"RTN","ORWDLR33",62,0)
 S I=0 F  S I=$O(ORY(I)) Q:'I  D
"RTN","ORWDLR33",63,0)
 . D NOW^%DTC S ORTI=%,%H=+%H_","_+ORY(I) D YMD^%DTC
"RTN","ORWDLR33",64,0)
 . I (ORDA=$P(ORTI,".",1)),(+(ORDA+%)<+ORTI) K ORY(I) S ORY=ORY-1 Q   ; cutoff time has passed for this collect time
"RTN","ORWDLR33",65,0)
 . S ORY(I)=$P(ORY(I),U,2)
"RTN","ORWDLR33",66,0)
 I +$G(ORY)=0,('$D(ORY(0))) S ORY(0)="-1^All of today's collection times have passed."
"RTN","ORWDLR33",67,0)
 Q
"RTN","ORWDLR33",68,0)
LCFUTR(ORDY,ORLOC,ORDIV)  ;Get # of days for future Lab Collects
"RTN","ORWDLR33",69,0)
 ; For Event Delay Order
"RTN","ORWDLR33",70,0)
 ;  --ORLOC Event default location
"RTN","ORWDLR33",71,0)
 ;  --ORDIV Event default division
"RTN","ORWDLR33",72,0)
 S ORDY=0
"RTN","ORWDLR33",73,0)
 Q:'$D(^XTV(8989.51,"B","LR LAB COLLECT FUTURE"))
"RTN","ORWDLR33",74,0)
 I $G(ORDIV) S ORDY=+$$GET^XPAR(+$G(ORLOC)_";SC("_"^"_+$G(ORDIV)_";DIC(4,^SYS^PKG","LR LAB COLLECT FUTURE",1,"I")
"RTN","ORWDLR33",75,0)
 E  S ORDY=+$$GET^XPAR(+$G(ORLOC)_";SC("_"^DIV^SYS^PKG","LR LAB COLLECT FUTURE",1,"I")
"RTN","ORWDLR33",76,0)
 ;S DUZ(2)=TMPDIV
"RTN","ORWDLR33",77,0)
 Q
"RTN","ORWDLR33",78,0)
LASTTIME(ORY)   ; Get last collection time used from ^TMP("ORECALL",$J) array
"RTN","ORWDLR33",79,0)
 N ORDIALOG,ORTYPE,ORTIME
"RTN","ORWDLR33",80,0)
 S ORDIALOG=$O(^ORD(101.41,"B","LR OTHER LAB TESTS",0))
"RTN","ORWDLR33",81,0)
 S ORTYPE=$O(^ORD(101.41,"B","OR GTX COLLECTION TYPE",0))
"RTN","ORWDLR33",82,0)
 S ORTIME=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWDLR33",83,0)
 S ORY=$$RECALL^ORCD(ORTYPE,1)_U_$$RECALL^ORCD(ORTIME,1)
"RTN","ORWDLR33",84,0)
 Q
"RTN","ORWDPS1")
0^76^B20839496
"RTN","ORWDPS1",1,0)
ORWDPS1 ; SLC/KCM/JLI - Pharmacy Calls for Windows Dialog; 7/3/2002 3PM
"RTN","ORWDPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,132,141**;Dec 17, 1997
"RTN","ORWDPS1",3,0)
 ;
"RTN","ORWDPS1",4,0)
ODSLCT(LST,PSTYPE,DFN,LOC) ; return default lists for dialog
"RTN","ORWDPS1",5,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORWDPS1",6,0)
 N ILST S ILST=0
"RTN","ORWDPS1",7,0)
 S ILST=ILST+1,LST(ILST)="~Priority" D PRIOR
"RTN","ORWDPS1",8,0)
 S ILST=ILST+1,LST(ILST)="~DispMsg"
"RTN","ORWDPS1",9,0)
 S ILST=ILST+1,LST(ILST)="d"_$$DISPMSG
"RTN","ORWDPS1",10,0)
 ;
"RTN","ORWDPS1",11,0)
 ; I PSTYPE="F" D  Q                           ; IV Fluids
"RTN","ORWDPS1",12,0)
 ; . S ILST=ILST+1,LST(ILST)="~ShortList" D SHORT
"RTN","ORWDPS1",13,0)
 ;
"RTN","ORWDPS1",14,0)
 I PSTYPE="O" D                                ; Outpatient
"RTN","ORWDPS1",15,0)
 . S ILST=ILST+1,LST(ILST)="~Refills"
"RTN","ORWDPS1",16,0)
 . S ILST=ILST+1,LST(ILST)="d0^0"
"RTN","ORWDPS1",17,0)
 . S ILST=ILST+1,LST(ILST)="~Pickup"
"RTN","ORWDPS1",18,0)
 . S ILST=ILST+1,LST(ILST)="d"_$$DEFPICK($G(LOC))
"RTN","ORWDPS1",19,0)
 . ; S ILST=ILST+1,LST(ILST)="~Supply"
"RTN","ORWDPS1",20,0)
 . ; S ILST=ILST+1,LST(ILST)="d^"_$$DEFSPLY(DFN)
"RTN","ORWDPS1",21,0)
 Q
"RTN","ORWDPS1",22,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORWDPS1",23,0)
 N X,XREF
"RTN","ORWDPS1",24,0)
 S XREF=$S(PSTYPE="O":"S.PSO",1:"S.PSJ")
"RTN","ORWDPS1",25,0)
 S X="" F  S X=$O(^ORD(101.42,XREF,X)) Q:'$L(X)  D
"RTN","ORWDPS1",26,0)
 . S ILST=ILST+1,LST(ILST)="i"_$O(^ORD(101.42,XREF,X,0))_U_X
"RTN","ORWDPS1",27,0)
 S ILST=ILST+1,LST(ILST)="d"_$O(^ORD(101.42,"B","ROUTINE",0))_U_"ROUTINE"
"RTN","ORWDPS1",28,0)
 Q
"RTN","ORWDPS1",29,0)
DEFPICK(LOC)       ; return default routing
"RTN","ORWDPS1",30,0)
 N X,DLG,PRMT
"RTN","ORWDPS1",31,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORWDPS1",32,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORWDPS1",33,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORWDPS1",34,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORWDPS1",35,0)
 ;
"RTN","ORWDPS1",36,0)
 ;S X=$$GET^XPAR("ALL^"_"LOC.`"_LOC,"ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",37,0)
 S X=$$GET^XPAR("LOC.`"_LOC_"^SYS","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",38,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORWDPS1",39,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORWDPS1",40,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORWDPS1",41,0)
 I X="N" S X=""            G XPICK
"RTN","ORWDPS1",42,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORWDPS1",43,0)
XPICK Q X
"RTN","ORWDPS1",44,0)
 ;
"RTN","ORWDPS1",45,0)
DEFSPLY(DFN)    ; return default days supply for this patient
"RTN","ORWDPS1",46,0)
 N ORWX
"RTN","ORWDPS1",47,0)
 S ORWX("PATIENT")=DFN
"RTN","ORWDPS1",48,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORWDPS1",49,0)
 Q $G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS1",50,0)
 ;
"RTN","ORWDPS1",51,0)
DFLTSPLY(VAL,UPD,SCH,PAT,DRG)        ; return days supply given quantity
"RTN","ORWDPS1",52,0)
 ; VAL: default days supply
"RTN","ORWDPS1",53,0)
 N ORWX,I
"RTN","ORWDPS1",54,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS1",55,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS1",56,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS1",57,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS1",58,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS1",59,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORWDPS1",60,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS1",61,0)
 Q
"RTN","ORWDPS1",62,0)
DISPMSG()       ; return 1 to suppress dispense message
"RTN","ORWDPS1",63,0)
 Q +$$GET^XPAR("ALL","ORWDPS SUPPRESS DISPENSE MSG",1,"I")
"RTN","ORWDPS1",64,0)
 ;
"RTN","ORWDPS1",65,0)
SCHALL(LST)     ; return all schedules
"RTN","ORWDPS1",66,0)
 N ILST,SCH,IEN,EXP,TYP,X0
"RTN","ORWDPS1",67,0)
 S ILST=0,SCH=""
"RTN","ORWDPS1",68,0)
 F  S SCH=$O(^PS(51.1,"APPSJ",SCH)) Q:SCH=""  D
"RTN","ORWDPS1",69,0)
 . S IEN=0,EXP=""
"RTN","ORWDPS1",70,0)
 . F  S IEN=$O(^PS(51.1,"APPSJ",SCH,IEN)) Q:'IEN  D  Q:$L(EXP)
"RTN","ORWDPS1",71,0)
 . . S X0=$G(^PS(51.1,IEN,0)),EXP=$P(X0,U,8),TYP=$P(X0,U,5)
"RTN","ORWDPS1",72,0)
 . S ILST=ILST+1,LST(ILST)=SCH_U_EXP_U_TYP
"RTN","ORWDPS1",73,0)
 Q
"RTN","ORWDPS1",74,0)
FORMALT(ORLST,IEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORWDPS1",75,0)
 N PSID,I
"RTN","ORWDPS1",76,0)
 S IEN=+$P(^ORD(101.43,IEN,0),U,2)
"RTN","ORWDPS1",77,0)
 D EN1^PSSUTIL1(.IEN,PSTYPE)
"RTN","ORWDPS1",78,0)
 S PSID=0,I=0
"RTN","ORWDPS1",79,0)
 F  S PSID=$O(IEN(PSID)) Q:'PSID  D
"RTN","ORWDPS1",80,0)
 . S OI=+$O(^ORD(101.43,"ID",PSID_";99PSP",0))
"RTN","ORWDPS1",81,0)
 . I OI S I=I+1,ORLST(I)=OI,$P(ORLST(I),U,2)=$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS1",82,0)
 Q
"RTN","ORWDPS1",83,0)
DOSEALT(LST,DDRUG,CUROI,PSTYPE) ; return a list of formulary alternatives for dose
"RTN","ORWDPS1",84,0)
 N I,OI,ORWLST,ILST S ILST=0
"RTN","ORWDPS1",85,0)
 D ENRFA^PSJORUTL(DDRUG,PSTYPE,.ORWLST)
"RTN","ORWDPS1",86,0)
 S I=0 F  S I=$O(ORWLST(I)) Q:'I  D
"RTN","ORWDPS1",87,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORWLST(I),U,4)_";99PSP",0))
"RTN","ORWDPS1",88,0)
 . I OI,OI'=CUROI S ILST=ILST+1,LST(ILST)=OI_U_$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS1",89,0)
 Q
"RTN","ORWDPS1",90,0)
FAILDEA(FAIL,OI,ORNP,PSTYPE)    ; return 1 if DEA check fails for this provider
"RTN","ORWDPS1",91,0)
 N DEAFLG,PSOI,TPKG
"RTN","ORWDPS1",92,0)
 S FAIL=0,TPKG=$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORWDPS1",93,0)
 Q:TPKG'["PS"
"RTN","ORWDPS1",94,0)
 S PSOI=+TPKG Q:PSOI'>0
"RTN","ORWDPS1",95,0)
 I '$L($T(OIDEA^PSSUTLA1)) Q
"RTN","ORWDPS1",96,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,PSTYPE) Q:DEAFLG'>0
"RTN","ORWDPS1",97,0)
 I '$L($P($G(^VA(200,+$G(ORNP),"PS")),U,2)),'$L($P($G(^("PS")),U,3)) S FAIL=1
"RTN","ORWDPS1",98,0)
 Q
"RTN","ORWDPS1",99,0)
CHK94(VAL)      ; return 1 if patch 94 has been installed
"RTN","ORWDPS1",100,0)
 S VAL=0
"RTN","ORWDPS1",101,0)
 I $O(^ORD(101.41,"B","PS MEDS",0)) S VAL=1
"RTN","ORWDPS1",102,0)
 Q
"RTN","ORWDPS1",103,0)
LOCPICK(Y,LOC) ; return default Location level routing
"RTN","ORWDPS1",104,0)
 S Y=""
"RTN","ORWDPS1",105,0)
 S Y=$$GET^XPAR("LOC.`"_LOC_"^SYS","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",106,0)
 I Y="C" S Y="C^in Clinic"
"RTN","ORWDPS1",107,0)
 I Y="M" S Y="M^by Mail"
"RTN","ORWDPS1",108,0)
 I Y="W" S Y="W^at Window"
"RTN","ORWDPS1",109,0)
 I Y="N" S Y=""
"RTN","ORWDPS1",110,0)
 Q
"RTN","ORWDPS1",111,0)
HASOIPI(Y,QOID) ; Check if QO put orderable item's PI into Sig
"RTN","ORWDPS1",112,0)
 N PIIEN,OIX
"RTN","ORWDPS1",113,0)
 S Y=0
"RTN","ORWDPS1",114,0)
 Q:'$D(^ORD(101.41,QOID,0))
"RTN","ORWDPS1",115,0)
 S PIIEN=$O(^ORD(101.41,"B","OR GTX PATIENT INSTRUCTIONS",0))
"RTN","ORWDPS1",116,0)
 Q:'PIIEN
"RTN","ORWDPS1",117,0)
 S OIX=0
"RTN","ORWDPS1",118,0)
 Q:'$D(^ORD(101.41,QOID,6,"D"))
"RTN","ORWDPS1",119,0)
 F  S OIX=$O(^ORD(101.41,+QOID,6,"D",OIX)) Q:'OIX  D
"RTN","ORWDPS1",120,0)
 . I OIX=PIIEN S Y=1 Q
"RTN","ORWDPS1",121,0)
 Q
"RTN","ORWDPS1",122,0)
HASROUTE(Y,QOID) ;Check if QO has a ROUTE defined
"RTN","ORWDPS1",123,0)
 N ROUTID
"RTN","ORWDPS1",124,0)
 S Y=0,ROUTID=0
"RTN","ORWDPS1",125,0)
 S ROUTID=$O(^ORD(101.41,"B","OR GTX ROUTING",0))
"RTN","ORWDPS1",126,0)
 Q:'ROUTID
"RTN","ORWDPS1",127,0)
 Q:'$D(^ORD(101.41,+QOID))
"RTN","ORWDPS1",128,0)
 I $D(^ORD(101.41,+QOID,6,"D",ROUTID)) S Y=1
"RTN","ORWDPS1",129,0)
 Q
"RTN","ORWDPS2")
0^60^B58189610
"RTN","ORWDPS2",1,0)
ORWDPS2 ; SLC/KCM/JLI - Pharmacy Calls for Windows Dialog ;7/3/02 4:30PM
"RTN","ORWDPS2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,116,125,131,132,148,141**;Dec 17, 1997
"RTN","ORWDPS2",3,0)
 ;
"RTN","ORWDPS2",4,0)
OISLCT(LST,OI,PSTYPE,ORVP,NEEDPI,PKIACTIV) ; return for defaults for pharmacy orderable item
"RTN","ORWDPS2",5,0)
 N ILST,ORDOSE,ORWPSOI,ORWDOSES,X1,X2
"RTN","ORWDPS2",6,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS2",7,0)
 S ILST=0
"RTN","ORWDPS2",8,0)
 S ORWPSOI=0
"RTN","ORWDPS2",9,0)
 S:+OI ORWPSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",10,0)
 D START^PSSJORDF(ORWPSOI,$S(PSTYPE="U":"I",1:"O")) ; dflt route, schedule, etc.
"RTN","ORWDPS2",11,0)
 I '$L($T(DOSE^PSSOPKI1)) D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses
"RTN","ORWDPS2",12,0)
 I $L($T(DOSE^PSSOPKI1)) D DOSE^PSSOPKI1(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses NEW PKI CODE from pharmacy
"RTN","ORWDPS2",13,0)
 D EN^PSSDIN(ORWPSOI)                               ; nfi text
"RTN","ORWDPS2",14,0)
 S ILST=ILST+1,LST(ILST)="~Medication"
"RTN","ORWDPS2",15,0)
 S ILST=ILST+1,LST(ILST)="d"_OI_U_$S(+OI:$P(^ORD(101.43,OI,0),U),1:"")
"RTN","ORWDPS2",16,0)
 S ILST=ILST+1,LST(ILST)="~Verb"
"RTN","ORWDPS2",17,0)
 S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("MISC")),U)
"RTN","ORWDPS2",18,0)
 S ILST=ILST+1,LST(ILST)="~Preposition"
"RTN","ORWDPS2",19,0)
 S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("MISC")),U,2)
"RTN","ORWDPS2",20,0)
 I $D(NEEDPI),(NEEDPI="Y") S ILST=ILST+1,LST(ILST)="~PtInstr" D PTINSTR
"RTN","ORWDPS2",21,0)
 ;S:NEEDPI="Y" ILST=ILST+1,LST(ILST)="~PtInstr"   D PTINSTR
"RTN","ORWDPS2",22,0)
 S ILST=ILST+1,LST(ILST)="~AllDoses"  D ALLDOSE ; must do before DOSAGE
"RTN","ORWDPS2",23,0)
 S ILST=ILST+1,LST(ILST)="~Dosage"    D DOSAGE
"RTN","ORWDPS2",24,0)
 S ILST=ILST+1,LST(ILST)="~Dispense"  D DISPLST
"RTN","ORWDPS2",25,0)
 S ILST=ILST+1,LST(ILST)="~Route"     D ROUTE
"RTN","ORWDPS2",26,0)
 S ILST=ILST+1,LST(ILST)="~Schedule"  D SCHED
"RTN","ORWDPS2",27,0)
 S ILST=ILST+1,LST(ILST)="~Guideline" D GUIDE
"RTN","ORWDPS2",28,0)
 S ILST=ILST+1,LST(ILST)="~Message"   D OIMSG
"RTN","ORWDPS2",29,0)
 S ILST=ILST+1,LST(ILST)="~DEASchedule" ;PKI
"RTN","ORWDPS2",30,0)
 ;S ILST=ILST+1,LST(ILST)="d"_$P($G(ORDOSE("DEA")),U) ;PKI
"RTN","ORWDPS2",31,0)
 S ILST=ILST+1,LST(ILST)="d" ;PKI
"RTN","ORWDPS2",32,0)
 I $D(ORDOSE("DEA")) S X="",X1=$P(ORDOSE("DEA"),";"),X2=$P(ORDOSE("DEA"),";",2) D
"RTN","ORWDPS2",33,0)
 . I '$L(X2) Q
"RTN","ORWDPS2",34,0)
 . I $G(PKIACTIV)="Y" S X=X2
"RTN","ORWDPS2",35,0)
 S LST(ILST)=LST(ILST)_X
"RTN","ORWDPS2",36,0)
 I PSTYPE="U" D
"RTN","ORWDPS2",37,0)
 . ; start, expires, next admin
"RTN","ORWDPS2",38,0)
 I PSTYPE="O" D
"RTN","ORWDPS2",39,0)
 . ; days supply, quantity, refills
"RTN","ORWDPS2",40,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS2",41,0)
 Q
"RTN","ORWDPS2",42,0)
 ;
"RTN","ORWDPS2",43,0)
PTINSTR ; from OISLCT, set up patient instructions
"RTN","ORWDPS2",44,0)
 N I
"RTN","ORWDPS2",45,0)
 S I=0 F  S I=$O(ORDOSE("PI",I)) Q:I'>0  S ILST=ILST+1,LST(ILST)="t"_ORDOSE("PI",I)
"RTN","ORWDPS2",46,0)
 Q
"RTN","ORWDPS2",47,0)
DOSAGE ; from OISLCT, set up the list of dosages
"RTN","ORWDPS2",48,0)
 ; LST(n)=iDrugName^Strength^NF^... (see BLDDOSE)
"RTN","ORWDPS2",49,0)
 ; must be called after ALLDOSE so ORWDOSES is set up
"RTN","ORWDPS2",50,0)
 N I
"RTN","ORWDPS2",51,0)
 S I=0 F  S I=$O(ORWDOSES(I)) Q:I'>0  S ILST=ILST+1,LST(ILST)=ORWDOSES(I)
"RTN","ORWDPS2",52,0)
 Q
"RTN","ORWDPS2",53,0)
DISPLST ; from OISLCT, set up list of dispense drugs
"RTN","ORWDPS2",54,0)
 ; DrugIEN^Strength^Units^Name^Split
"RTN","ORWDPS2",55,0)
 N DD
"RTN","ORWDPS2",56,0)
 S DD=0 F  S DD=$O(ORDOSE("DD",DD)) Q:'DD  D
"RTN","ORWDPS2",57,0)
 . S ILST=ILST+1
"RTN","ORWDPS2",58,0)
 . S LST(ILST)="i"_DD_U_$P(ORDOSE("DD",DD),U,5,6)_U_$P(ORDOSE("DD",DD),U)_U_$P(ORDOSE("DD",DD),U,11)
"RTN","ORWDPS2",59,0)
 Q
"RTN","ORWDPS2",60,0)
ALLDOSE ; from OISLCT, set up a list of all possible doses
"RTN","ORWDPS2",61,0)
 ; LST(n)=iDrugName^Strength^NF^... (see BLDDOSE)
"RTN","ORWDPS2",62,0)
 N I,J,CONJ,DD,DRUG,DDNM,LDOSE,TEXT,STREN,UD,COST,NF,ID,X
"RTN","ORWDPS2",63,0)
 S CONJ=$P($G(ORDOSE("MISC")),U,3),ORWDOSES=0
"RTN","ORWDPS2",64,0)
 S:$L(CONJ) CONJ=" "_CONJ_" " S:'$L(CONJ) CONJ=" "
"RTN","ORWDPS2",65,0)
 S I=0 F  S I=$O(ORDOSE(I)) Q:I'>0  D
"RTN","ORWDPS2",66,0)
 . S X=$$BLDDOSE(ORDOSE(I))
"RTN","ORWDPS2",67,0)
 . S ORWDOSES=ORWDOSES+1,ORWDOSES(ORWDOSES)=X
"RTN","ORWDPS2",68,0)
 . S ILST=ILST+1
"RTN","ORWDPS2",69,0)
 . S LST(ILST)="i"_$P(X,U,5)_U_$P($P(X,U,4),"&",6)_U_$P(X,U,4)
"RTN","ORWDPS2",70,0)
 . S J=0 F  S J=$O(ORDOSE(I,J)) Q:J'>0  D
"RTN","ORWDPS2",71,0)
 . . S X=$$BLDDOSE(ORDOSE(I,J))
"RTN","ORWDPS2",72,0)
 . . S ILST=ILST+1
"RTN","ORWDPS2",73,0)
 . . S LST(ILST)="i"_$P(X,U,5)_U_$P($P(X,U,4),"&",6)_U_$P(X,U,4)
"RTN","ORWDPS2",74,0)
 Q
"RTN","ORWDPS2",75,0)
BLDDOSE(X)  ; build dose info where X is ORDOSE node
"RTN","ORWDPS2",76,0)
 ; from ALLDOSE
"RTN","ORWDPS2",77,0)
 ;    X=TotalDose^Units^U/D^Noun^LocalDose^DispDrugIEN
"RTN","ORWDPS2",78,0)
 ;    Y=iDrugName^Strength^NF^TDose&Units&U/D&Noun&LDose&Drug&Stren&Units^
"RTN","ORWDPS2",79,0)
 ;      DoseText^CostText^MaxRefills^DispUnits^CanSplit
"RTN","ORWDPS2",80,0)
 ; DRUG=Name^Cost^NF^DispUnit^Strength^Units^DoseForm^MaxRefills^
"RTN","ORWDPS2",81,0)
 ; No TotalDose,           use LocalDose
"RTN","ORWDPS2",82,0)
 ; TotalDose & Strength,   use LocalDose+Conjunction+Strength+Units
"RTN","ORWDPS2",83,0)
 ; TotalDose, No Strength, use LocalDose+Conjunction+DispenseName
"RTN","ORWDPS2",84,0)
 S DD=+$P(X,U,6),DRUG=ORDOSE("DD",DD),DDNM=$P(DRUG,U),ID=$P(X,U,1,6)
"RTN","ORWDPS2",85,0)
 S LDOSE=$P(X,U,5),TEXT=LDOSE,STREN=$P(DRUG,U,5)_$P(DRUG,U,6)
"RTN","ORWDPS2",86,0)
 S $P(ID,U,7)=$P(DRUG,U,5) S $P(ID,U,8)=$P(DRUG,U,6) ; add strength
"RTN","ORWDPS2",87,0)
 I '$L($P(X,U)),$L($P(DRUG,U,5))  S TEXT=TEXT_CONJ_STREN
"RTN","ORWDPS2",88,0)
 I '$L($P(X,U)),'$L($P(DRUG,U,5)) S TEXT=TEXT_CONJ_$P(DRUG,U)
"RTN","ORWDPS2",89,0)
 S UD=$P(X,U,3),COST=$P(X,U,7),NF=$S($P(DRUG,U,3):"NF",1:"")
"RTN","ORWDPS2",90,0)
 ;I UD S COST="$"_$J(UD*$P(DRUG,U,2),1,3) ;_" per "_UD_" "_$P(X,U,4)
"RTN","ORWDPS2",91,0)
 S Y="i"_DDNM_U_STREN_U_NF_U_$TR(ID,U,"&")_U_TEXT_U_COST_U_$P(DRUG,U,8)_U_$P(DRUG,U,4)
"RTN","ORWDPS2",92,0)
 Q Y
"RTN","ORWDPS2",93,0)
ROUTE ; from OISLCT, get list of routes for the drug form
"RTN","ORWDPS2",94,0)
 ; ** NEED BOTH ABBREVIATION & NAME IN LIST BOX
"RTN","ORWDPS2",95,0)
 N I,CNT,ABBR,IEN,ROUT,EXP,X
"RTN","ORWDPS2",96,0)
 S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS2",97,0)
 . S X=^TMP("PSJMR",$J,I)
"RTN","ORWDPS2",98,0)
 . S ROUT=$P(X,U),ABBR=$P(X,U,2),IEN=$P(X,U,3),EXP=$P(X,U,4)
"RTN","ORWDPS2",99,0)
 . S ILST=ILST+1,LST(ILST)="i"_IEN_U_ROUT_U_ABBR_U_EXP_U_$P(X,U,5)
"RTN","ORWDPS2",100,0)
 . I I=1,IEN S ILST=ILST+1,LST(ILST)="d"_IEN_U_ROUT ;_U_ABBR ; assume first always default
"RTN","ORWDPS2",101,0)
 ; add abbreviations to list of routes, commented out for 15.5 on
"RTN","ORWDPS2",102,0)
 ; S I="" F  S I=$O(^TMP("PSJMR",$J,I)) Q:I=""  D
"RTN","ORWDPS2",103,0)
 ; . S X=^TMP("PSJMR",$J,I)
"RTN","ORWDPS2",104,0)
 ; . S ROUT=$P(X,U),ABBR=$P(X,U,2),IEN=$P(X,U,3),EXP=$P(X,U,4)
"RTN","ORWDPS2",105,0)
 ; . I $L(ABBR),(ABBR'=ROUT) S ILST=ILST+1,LST(ILST)="i"_IEN_U_ABBR_" ("_ROUT_")"_U_ABBR_U_EXP
"RTN","ORWDPS2",106,0)
 Q
"RTN","ORWDPS2",107,0)
SCHED ; from OISLCT, get default schedule for this medication
"RTN","ORWDPS2",108,0)
 I $L($G(^TMP("PSJSCH",$J))) S ILST=ILST+1,LST(ILST)="d"_^($J)
"RTN","ORWDPS2",109,0)
 Q
"RTN","ORWDPS2",110,0)
GUIDE ; from OISLCT, get guidelines associated with this medication
"RTN","ORWDPS2",111,0)
 N IEN,I
"RTN","ORWDPS2",112,0)
 S IEN=0 F  S IEN=$O(^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN)) Q:'IEN  D
"RTN","ORWDPS2",113,0)
 . S I=0 F  S I=$O(^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN,I)) Q:'I  D
"RTN","ORWDPS2",114,0)
 . . S ILST=ILST+1,LST(ILST)="t"_^TMP("PSSDIN",$J,"OI",ORWPSOI,IEN,I)
"RTN","ORWDPS2",115,0)
 Q
"RTN","ORWDPS2",116,0)
OIMSG ; from OISLCT, get the orderable item message for this medication
"RTN","ORWDPS2",117,0)
 S I=0 F  S I=$O(^ORD(101.43,OI,8,I)) Q:I'>0  S ILST=ILST+1,LST(ILST)="t"_^(I,0)
"RTN","ORWDPS2",118,0)
 Q
"RTN","ORWDPS2",119,0)
ADMIN(REC,DFN,SCH,OI,LOC)       ; return administration time info
"RTN","ORWDPS2",120,0)
 ; REC: StartText^StartTime^Duration^FirstAdmin
"RTN","ORWDPS2",121,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",122,0)
 S LOC=+$G(^SC(LOC,42)),REC=""
"RTN","ORWDPS2",123,0)
 I $L($G(^DPT(DFN,.1))) S REC=$$FIRST^ORCDPS3(DFN,LOC,OI,SCH)
"RTN","ORWDPS2",124,0)
 Q
"RTN","ORWDPS2",125,0)
REQST(VAL,DFN,SCH,OI,LOC,TXT)   ; return requested start time
"RTN","ORWDPS2",126,0)
 ; VAL: FirstAdmin time
"RTN","ORWDPS2",127,0)
 S VAL=""
"RTN","ORWDPS2",128,0)
 Q:'$L($G(SCH))  Q:'$G(OI)
"RTN","ORWDPS2",129,0)
 S OI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS2",130,0)
 S LOC=+$G(^SC(LOC,42))
"RTN","ORWDPS2",131,0)
 S VAL=$P($$RESOLVE^PSJORPOE(DFN,SCH,OI,TXT,LOC),U,2)
"RTN","ORWDPS2",132,0)
 Q
"RTN","ORWDPS2",133,0)
DAY2QTY(VAL,DAY,UPD,SCH,DUR,PAT,DRG)        ; return qty for days supply
"RTN","ORWDPS2",134,0)
 ; VAL: quantity
"RTN","ORWDPS2",135,0)
 N ORWX,I,X,ADUR,ADURNM
"RTN","ORWDPS2",136,0)
 S ORWX("DAYS SUPPLY")=DAY
"RTN","ORWDPS2",137,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",138,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS2",139,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS2",140,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS2",141,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS2",142,0)
 . S ADUR=$P(DUR,U,I),ADURNM=$P($P(ADUR," ",2),"~")
"RTN","ORWDPS2",143,0)
 . S:ADURNM="MONTHS" X=+ADUR_"L"
"RTN","ORWDPS2",144,0)
 . S:ADURNM'="MONTHS" X=+ADUR_$E($P(ADUR," ",2))
"RTN","ORWDPS2",145,0)
 . I $L(X) S ORWX("DURATION",I)=X
"RTN","ORWDPS2",146,0)
 . S X=$E($P(ADUR,"~",2))
"RTN","ORWDPS2",147,0)
 . I $L(X) S ORWX("CONJUNCTION",I)=X
"RTN","ORWDPS2",148,0)
 D QTYX^PSOSIG(.ORWX)
"RTN","ORWDPS2",149,0)
 S VAL=$G(ORWX("QTY"))
"RTN","ORWDPS2",150,0)
 Q
"RTN","ORWDPS2",151,0)
QTY2DAY(VAL,QTY,UPD,SCH,DUR,PAT,DRG)        ; return days supply given quantity
"RTN","ORWDPS2",152,0)
 ; VAL: days supply
"RTN","ORWDPS2",153,0)
 N ORWX,I,X,ADUR
"RTN","ORWDPS2",154,0)
 S ORWX("QTY")=QTY
"RTN","ORWDPS2",155,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",156,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS2",157,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS2",158,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS2",159,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS2",160,0)
 . S ADUR=$P(DUR,U,I),X=+ADUR_$E($P(ADUR," ",2))
"RTN","ORWDPS2",161,0)
 . I $L(X) S ORWX("DURATION",I)=X
"RTN","ORWDPS2",162,0)
 . S X=$E($P(ADUR,"~",2))
"RTN","ORWDPS2",163,0)
 . I $L(X) S ORWX("CONJUNCTION",I)=X
"RTN","ORWDPS2",164,0)
 D QTYX^PSOSIG(.ORWX)
"RTN","ORWDPS2",165,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS2",166,0)
 Q
"RTN","ORWDPS2",167,0)
MAXREF(VAL,PAT,DRG,SUP,OI,OUT)      ; return the maximum number of refills
"RTN","ORWDPS2",168,0)
 ; PAT=Patient DFN, DRG=ptr50, SUP=days supply, OI=orderable item
"RTN","ORWDPS2",169,0)
 ; VAL: maximum refills allowed
"RTN","ORWDPS2",170,0)
 N ORWX
"RTN","ORWDPS2",171,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS2",172,0)
 I $G(DRG) S ORWX("DRUG")=+DRG
"RTN","ORWDPS2",173,0)
 I $G(SUP) S ORWX("DAYS SUPPLY")=SUP
"RTN","ORWDPS2",174,0)
 I $G(OI)  S ORWX("ITEM")=OI
"RTN","ORWDPS2",175,0)
 I $G(OUT) S ORWX("DISCHARGE")=1
"RTN","ORWDPS2",176,0)
 D MAX^PSOSIGDS(.ORWX)
"RTN","ORWDPS2",177,0)
 S VAL=$G(ORWX("MAX"))
"RTN","ORWDPS2",178,0)
 Q
"RTN","ORWDPS2",179,0)
SCHREQ(VAL,OI,RTE,DRG)  ; return 1 if schedule is required
"RTN","ORWDPS2",180,0)
 ; OI=orderable item, RTE=ptr route, DRG=ptr dispense drug
"RTN","ORWDPS2",181,0)
 S VAL=1
"RTN","ORWDPS2",182,0)
 Q:'$G(OI)  Q:'$G(RTE)
"RTN","ORWDPS2",183,0)
 S VAL=$$SCHREQ^PSJORPOE(RTE,OI,+$G(DRG))
"RTN","ORWDPS2",184,0)
 Q
"RTN","ORWDPS2",185,0)
CHKPI(VAL,ODIFN) ; return pre-existing patient instruct
"RTN","ORWDPS2",186,0)
 N IDNUM,IDPI
"RTN","ORWDPS2",187,0)
 S (IDNUM,IDPI)=0,VAL=""
"RTN","ORWDPS2",188,0)
 I '$D(^OR(100,ODIFN,4.5,"ID","PI")) S VAL="" Q
"RTN","ORWDPS2",189,0)
 F  S IDNUM=$O(^OR(100,ODIFN,4.5,"ID","PI",IDNUM)) Q:'IDNUM  D
"RTN","ORWDPS2",190,0)
 . F  S IDPI=$O(^OR(100,ODIFN,4.5,IDNUM,2,IDPI)) Q:'IDPI  D
"RTN","ORWDPS2",191,0)
 .. S VAL=VAL_^OR(100,ODIFN,4.5,IDNUM,2,IDPI,0)
"RTN","ORWDPS2",192,0)
 K IDNUM,IDPI
"RTN","ORWDPS2",193,0)
 Q
"RTN","ORWDPS2",194,0)
CHKGRP(VAL,ORIFN) ;
"RTN","ORWDPS2",195,0)
 ;If order belong to Inpatient Med Order Group: return 1
"RTN","ORWDPS2",196,0)
 ;If order belong to Outpatient Med Order Grpoup: return 2 
"RTN","ORWDPS2",197,0)
 ;Otherwise, return 0
"RTN","ORWDPS2",198,0)
 S VAL=0
"RTN","ORWDPS2",199,0)
 I '$L(ORIFN) Q
"RTN","ORWDPS2",200,0)
 N UDGRP,IPGRP,OPGRP,ODGRP,ODID
"RTN","ORWDPS2",201,0)
 S ODID=+ORIFN
"RTN","ORWDPS2",202,0)
 Q:ODID<1
"RTN","ORWDPS2",203,0)
 S (UDGRP,IPGRP,OPGRP,ODGRP)=0
"RTN","ORWDPS2",204,0)
 S UDGRP=$O(^ORD(100.98,"B","UD RX",UDGRP))
"RTN","ORWDPS2",205,0)
 S OPGRP=$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",OPGRP))
"RTN","ORWDPS2",206,0)
 S IPGRP=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IPGRP))
"RTN","ORWDPS2",207,0)
 S:IPGRP=0 IPGRP=$O(^ORD(100.98,"B","I RX",IPGRP))
"RTN","ORWDPS2",208,0)
 I $L($G(^OR(100,ODID,0)))<1 Q
"RTN","ORWDPS2",209,0)
 S ODGRP=$P(^OR(100,ODID,0),U,11)
"RTN","ORWDPS2",210,0)
 I UDGRP=ODGRP S VAL=1
"RTN","ORWDPS2",211,0)
 I IPGRP=ODGRP S VAL=1
"RTN","ORWDPS2",212,0)
 I OPGRP=ODGRP S VAL=2
"RTN","ORWDPS2",213,0)
 K UDGRP,ODGRP,OPGRP,IPGRP,ODID
"RTN","ORWDPS2",214,0)
 Q
"RTN","ORWDPS2",215,0)
QOGRP(VAL,QOIFN) ;
"RTN","ORWDPS2",216,0)
 ;If quick order belong to Inpatient Med Order Group: return 1
"RTN","ORWDPS2",217,0)
 ;Otherwise, return 0
"RTN","ORWDPS2",218,0)
 S VAL=0
"RTN","ORWDPS2",219,0)
 I '$L(QOIFN) Q
"RTN","ORWDPS2",220,0)
 N UDGRP,IPGRP,QOGRP,QOID
"RTN","ORWDPS2",221,0)
 S QOID=+QOIFN
"RTN","ORWDPS2",222,0)
 Q:QOID<1
"RTN","ORWDPS2",223,0)
 S (UDGRP,IPGRP,QOGRP)=0
"RTN","ORWDPS2",224,0)
 S UDGRP=$O(^ORD(100.98,"B","UD RX",UDGRP))
"RTN","ORWDPS2",225,0)
 S IPGRP=$O(^ORD(100.98,"B","INPATIENT MEDICATIONS",IPGRP))
"RTN","ORWDPS2",226,0)
 S:IPGRP=0 IPGRP=$O(^ORD(100.98,"B","I RX",IPGRP))
"RTN","ORWDPS2",227,0)
 I $L($G(^ORD(101.41,QOID,0)))<1 Q
"RTN","ORWDPS2",228,0)
 S QOGRP=$P(^ORD(101.41,QOID,0),U,5)
"RTN","ORWDPS2",229,0)
 I UDGRP=QOGRP S VAL=1
"RTN","ORWDPS2",230,0)
 I IPGRP=QOGRP S VAL=1
"RTN","ORWDPS2",231,0)
 K UDGRP,QOGRP,QOID,IPGRP
"RTN","ORWDPS2",232,0)
 Q
"RTN","ORWDPS4")
0^79^B9779474
"RTN","ORWDPS4",1,0)
ORWDPS4 ;; SLC/JDL - Order Dialogs CO-PAY;[12/31/01 6:38pm]
"RTN","ORWDPS4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**116,125,131,141**;Dec 17, 1997
"RTN","ORWDPS4",3,0)
 ;
"RTN","ORWDPS4",4,0)
CPLST(TEST,PTIFN,ORIFNS) ; --Get CP questions
"RTN","ORWDPS4",5,0)
 N ORIFN,ORDA,ORI,ORPSO,CPX
"RTN","ORWDPS4",6,0)
 S ORI=0,ORPSO=+$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDPS4",7,0)
 F  S ORI=$O(ORIFNS(ORI)) Q:'ORI  D
"RTN","ORWDPS4",8,0)
 .S ORIFN=+ORIFNS(ORI),ORDA=$P(ORIFNS(ORI),";",2)
"RTN","ORWDPS4",9,0)
 .I $D(^OR(100,ORIFN,0)),($P(^OR(100,ORIFN,0),U,14)=ORPSO) D
"RTN","ORWDPS4",10,0)
 ..S CPX=$$SC(ORIFN)
"RTN","ORWDPS4",11,0)
 ..I $L(CPX)>1 S TEST(ORIFN)=ORIFN_";"_ORDA_CPX
"RTN","ORWDPS4",12,0)
 K PTIFN,ORIFN,ORDA,ORI,CPX
"RTN","ORWDPS4",13,0)
 Q
"RTN","ORWDPS4",14,0)
 ;
"RTN","ORWDPS4",15,0)
CPINFO(Y,ORINFO) ; -- Save reponses to CP questions
"RTN","ORWDPS4",16,0)
 Q:'$D(ORINFO)
"RTN","ORWDPS4",17,0)
 N ORIFN,ORI,ORX,ANS S ORI=0
"RTN","ORWDPS4",18,0)
 F  S ORI=$O(ORINFO(ORI)) Q:'ORI  D
"RTN","ORWDPS4",19,0)
 .S ORIFN=$P($P(ORINFO(ORI),U,1),";",1)
"RTN","ORWDPS4",20,0)
 .S ANS=$P(ORINFO(ORI),U,2)
"RTN","ORWDPS4",21,0)
 .D REFMT(.ORX,ANS)
"RTN","ORWDPS4",22,0)
 .D SC^ORCSAVE2(.ORX,ORIFN)
"RTN","ORWDPS4",23,0)
 S Y=1
"RTN","ORWDPS4",24,0)
 K ORIFN,ORX,ORI,ANS
"RTN","ORWDPS4",25,0)
 Q
"RTN","ORWDPS4",26,0)
 ;
"RTN","ORWDPS4",27,0)
SC(ORIFN) ; -- Dialog validation, to ask CP questions
"RTN","ORWDPS4",28,0)
 ;Expects ORIFN and ORDA
"RTN","ORWDPS4",29,0)
 ;
"RTN","ORWDPS4",30,0)
 N DR S DR=""
"RTN","ORWDPS4",31,0)
 I '$L($T(SCNEW^PSOCP))!('$G(ORIFN))!('$G(ORDA)) Q DR
"RTN","ORWDPS4",32,0)
 I $P($G(^OR(100,ORIFN,8,ORDA,0)),U,2)'="NW" Q DR
"RTN","ORWDPS4",33,0)
 ;
"RTN","ORWDPS4",34,0)
 N OR3,ORDRUG,ORENEW,ORX,I,X,Y,CPNODE,ASC,AAO,AIR,AEC,AMST,AHNC
"RTN","ORWDPS4",35,0)
 S ORX=""
"RTN","ORWDPS4",36,0)
 ;--Only new, renew, edited, copied outpatient order can continue...
"RTN","ORWDPS4",37,0)
 S OR3=$G(^OR(100,ORIFN,3)),X=$P(OR3,U,11) I (X'=0)&((X'=2)&(X'=1)) Q DR
"RTN","ORWDPS4",38,0)
 I (X=1)&($D(^OR(100,ORIFN,5))=0) Q DR
"RTN","ORWDPS4",39,0)
 I $D(^OR(100,ORIFN,5))>0 D
"RTN","ORWDPS4",40,0)
 .S CPNODE=$G(^OR(100,ORIFN,5))
"RTN","ORWDPS4",41,0)
 .S ASC=$S($L($P(CPNODE,"^",1)):"SC;"_$P(CPNODE,"^",1),1:"")
"RTN","ORWDPS4",42,0)
 .S DR=$S($L(ASC):DR_U_ASC,1:DR)
"RTN","ORWDPS4",43,0)
 .S AAO=$S($L($P(CPNODE,"^",3)):"AO;"_$P(CPNODE,"^",3),1:"")
"RTN","ORWDPS4",44,0)
 .S DR=$S($L(AAO):DR_U_AAO,1:DR)
"RTN","ORWDPS4",45,0)
 .S AIR=$S($L($P(CPNODE,"^",4)):"IR;"_$P(CPNODE,"^",4),1:"")
"RTN","ORWDPS4",46,0)
 .S DR=$S($L(AIR):DR_U_AIR,1:DR)
"RTN","ORWDPS4",47,0)
 .S AEC=$S($L($P(CPNODE,"^",5)):"EC;"_$P(CPNODE,"^",5),1:"")
"RTN","ORWDPS4",48,0)
 .S DR=$S($L(AEC):DR_U_AEC,1:DR)
"RTN","ORWDPS4",49,0)
 .S AMST=$S($L($P(CPNODE,"^",2)):"MST;"_$P(CPNODE,"^",2),1:"")
"RTN","ORWDPS4",50,0)
 .S DR=$S($L(AMST):DR_U_AMST,1:DR)
"RTN","ORWDPS4",51,0)
 .S AHNC=$S($L($P(CPNODE,"^",6)):"HNC;"_$P(CPNODE,"^",6),1:"")
"RTN","ORWDPS4",52,0)
 .S DR=$S($L(AHNC):DR_U_AHNC,1:DR)
"RTN","ORWDPS4",53,0)
 .D CPCOMP(.DR)
"RTN","ORWDPS4",54,0)
 .K ASC,AAO,AIR,AEC,AMST,AHNC,CPNODE
"RTN","ORWDPS4",55,0)
 I $L(DR)>0 Q DR
"RTN","ORWDPS4",56,0)
 I X=2 S Y=$P(OR3,U,5),ORENEW=$G(^OR(100,Y,4)) ;get PS# if renewal
"RTN","ORWDPS4",57,0)
 S ORDRUG=$$VALUE^ORCSAVE2(ORIFN,"DRUG")
"RTN","ORWDPS4",58,0)
 D SCNEW^PSOCP(.ORX,+PTIFN,ORDRUG,$G(ORENEW)) I '$D(ORX) Q DR
"RTN","ORWDPS4",59,0)
 F I="SC","AO","IR","EC","MST","HNC" D
"RTN","ORWDPS4",60,0)
 . I $D(ORX(I)) S DR=DR_U_I_$S($L(ORX(I)):";"_ORX(I),1:"")
"RTN","ORWDPS4",61,0)
 Q DR
"RTN","ORWDPS4",62,0)
REFMT(ORX,INFO) ;
"RTN","ORWDPS4",63,0)
 ;"U": Unchecked ("NO") 
"RTN","ORWDPS4",64,0)
 ;"C": Checked ("YES")
"RTN","ORWDPS4",65,0)
 ;"N" : Question not asked
"RTN","ORWDPS4",66,0)
 N RST,RST1
"RTN","ORWDPS4",67,0)
 S RST=""
"RTN","ORWDPS4",68,0)
 F I=1:1:$L(INFO)  S RST=RST_U_$S($E(INFO,I)="U":0,$E(INFO,I)="C":1,1:"")
"RTN","ORWDPS4",69,0)
 S RST1=$E(RST,2,$L(RST))
"RTN","ORWDPS4",70,0)
 S ORX("SC")=$P(RST1,U,1)
"RTN","ORWDPS4",71,0)
 S ORX("MST")=$P(RST1,U,5)
"RTN","ORWDPS4",72,0)
 S ORX("AO")=$P(RST1,U,2)
"RTN","ORWDPS4",73,0)
 S ORX("IR")=$P(RST1,U,3)
"RTN","ORWDPS4",74,0)
 S ORX("EC")=$P(RST1,U,4)
"RTN","ORWDPS4",75,0)
 S ORX("HNC")=$P(RST1,U,6)
"RTN","ORWDPS4",76,0)
 K RST,RST1
"RTN","ORWDPS4",77,0)
 Q
"RTN","ORWDPS4",78,0)
CPCOMP(PREX) ; -- Compare the existed exemptions with new exemption questions
"RTN","ORWDPS4",79,0)
 N ORX1,ORDRUG1,CPI
"RTN","ORWDPS4",80,0)
 S ORDRUG1=$$VALUE^ORCSAVE2(ORIFN,"DRUG")
"RTN","ORWDPS4",81,0)
 D SCNEW^PSOCP(.ORX1,+PTIFN,ORDRUG1,$G(ORENEW)) I '$D(ORX1) Q
"RTN","ORWDPS4",82,0)
 F CPI="SC","AO","IR","EC","MST","HNC" D
"RTN","ORWDPS4",83,0)
 . I $D(ORX1(CPI)) D
"RTN","ORWDPS4",84,0)
 . . I PREX'[CPI S PREX=PREX_U_CPI
"RTN","ORWDPS4",85,0)
 K ORX1,ORDRUG1,CPI
"RTN","ORWDPS4",86,0)
 Q
"RTN","ORWDRA32")
0^70^B19101663
"RTN","ORWDRA32",1,0)
ORWDRA32 ; SLC/KCM/REV/JDL - Radiology calls to support windows [6/28/02]
"RTN","ORWDRA32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,116,141**;Dec 17, 1997
"RTN","ORWDRA32",3,0)
 ;
"RTN","ORWDRA32",4,0)
DEF(LST,PATID,EVTDIV,IMGTYP) ; Get dialog data for radiology
"RTN","ORWDRA32",5,0)
 N ILST,I,X S ILST=0
"RTN","ORWDRA32",6,0)
 S LST($$NXT)="~ShortList"  D SHORT
"RTN","ORWDRA32",7,0)
 S IMGTYP=$$IMTYPE(IMGTYP)
"RTN","ORWDRA32",8,0)
 S LST($$NXT)="~Common Procedures" D COMMPRO
"RTN","ORWDRA32",9,0)
 S LST($$NXT)="~Modifiers" D MODIFYR
"RTN","ORWDRA32",10,0)
 S LST($$NXT)="~Urgencies" D URGENCY
"RTN","ORWDRA32",11,0)
 S LST($$NXT)="~Transport" D TRNSPRT
"RTN","ORWDRA32",12,0)
 S LST($$NXT)="~Category" D CATEGRY
"RTN","ORWDRA32",13,0)
 S LST($$NXT)="~Submit to" D SUBMIT
"RTN","ORWDRA32",14,0)
 S LST($$NXT)="~Last 7 Days" D LAST7
"RTN","ORWDRA32",15,0)
 Q
"RTN","ORWDRA32",16,0)
MODIFYR ; Get the modifiers (should be by imaging type)
"RTN","ORWDRA32",17,0)
 S I=$O(^RA(79.2,"C",IMGTYP,0)) Q:'I
"RTN","ORWDRA32",18,0)
 S X=0 F  S X=$O(^RAMIS(71.2,"AB",I,X)) Q:'X  S LST($$NXT)="i"_X_U_$P(^RAMIS(71.2,X,0),U)
"RTN","ORWDRA32",19,0)
 Q
"RTN","ORWDRA32",20,0)
SHORT ; from DEF, get short list of imaging quick orders
"RTN","ORWDRA32",21,0)
 N I,TMP
"RTN","ORWDRA32",22,0)
 D GETQLST^ORWDXQ(.TMP,IMGTYP,"Q")
"RTN","ORWDRA32",23,0)
 S I=0 F  S I=$O(TMP(I)) Q:'I  D
"RTN","ORWDRA32",24,0)
 . S LST($$NXT)="i"_TMP(I)
"RTN","ORWDRA32",25,0)
 Q
"RTN","ORWDRA32",26,0)
COMMPRO ; Get the common procedures
"RTN","ORWDRA32",27,0)
 S X=""
"RTN","ORWDRA32",28,0)
 F  S X=$O(^ORD(101.43,"COMMON",IMGTYP,X)) Q:X=""  D
"RTN","ORWDRA32",29,0)
 . S I=$O(^ORD(101.43,"COMMON",IMGTYP,X,0))
"RTN","ORWDRA32",30,0)
 . I $$REQDET,$P($G(^ORD(101.43,I,"RA")),U,2)="B" Q
"RTN","ORWDRA32",31,0)
 . S LST($$NXT)="i"_I_U_X_U_U_$$REQAPPR(I)
"RTN","ORWDRA32",32,0)
 Q
"RTN","ORWDRA32",33,0)
URGENCY ; Get the allowable urgencies and default
"RTN","ORWDRA32",34,0)
 S X="",I=0
"RTN","ORWDRA32",35,0)
 F  S X=$O(^ORD(101.42,"S.RA",X)) Q:X=""  D
"RTN","ORWDRA32",36,0)
 . S I=$O(^ORD(101.42,"S.RA",X,0))
"RTN","ORWDRA32",37,0)
 . S LST($$NXT)="i"_I_U_X
"RTN","ORWDRA32",38,0)
 S I=$O(^ORD(101.42,"B","ROUTINE",0))
"RTN","ORWDRA32",39,0)
 S LST($$NXT)="d"_I_U_"ROUTINE"
"RTN","ORWDRA32",40,0)
 Q
"RTN","ORWDRA32",41,0)
TRNSPRT ; Get the modes of transport
"RTN","ORWDRA32",42,0)
 F X="A^AMBULATORY","P^PORTABLE","S^STRETCHER","W^WHEELCHAIR" D
"RTN","ORWDRA32",43,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDRA32",44,0)
 ; figure default on windows side
"RTN","ORWDRA32",45,0)
 Q
"RTN","ORWDRA32",46,0)
CATEGRY ; Get the categories of exam  
"RTN","ORWDRA32",47,0)
 F X="I^INPATIENT","O^OUTPATIENT","E^EMPLOYEE","C^CONTRACT","S^SHARING","R^RESEARCH" D
"RTN","ORWDRA32",48,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDRA32",49,0)
 ; figure default on windows side
"RTN","ORWDRA32",50,0)
 Q
"RTN","ORWDRA32",51,0)
SUBMIT ; Get the locations to which the request may be submitted
"RTN","ORWDRA32",52,0)
 N TMPLST,ASK,X
"RTN","ORWDRA32",53,0)
 D EN4^RAO7PC1(IMGTYP,"TMPLST")
"RTN","ORWDRA32",54,0)
 S I=0 F  S I=$O(TMPLST(I)) Q:'I  S LST($$NXT)="i"_TMPLST(I)
"RTN","ORWDRA32",55,0)
 I $D(TMPLST) S I=$O(TMPLST(0)),X=$P(TMPLST(I),U,1,2),LST($$NXT)="d"_X
"RTN","ORWDRA32",56,0)
 S LST($$NXT)="~Ask Submit"
"RTN","ORWDRA32",57,0)
 I $G(EVTDIV) S X=$$GET^XPAR(+$G(EVTDIV)_";DIC(4,^SYS^PKG","RA SUBMIT PROMPT",1,"Q")
"RTN","ORWDRA32",58,0)
 E  S X=$$GET^XPAR("ALL","RA SUBMIT PROMPT",1,"Q")
"RTN","ORWDRA32",59,0)
 ;S DUZ(2)=TMPDIV
"RTN","ORWDRA32",60,0)
 S ASK=$S($L(X):X,1:1)
"RTN","ORWDRA32",61,0)
 S LST($$NXT)="d"_ASK_U_$S(ASK=1:"YES",ASK=0:"NO",1:"YES")
"RTN","ORWDRA32",62,0)
 Q
"RTN","ORWDRA32",63,0)
LAST7 ; Get exams for the last 7 days
"RTN","ORWDRA32",64,0)
 K ^TMP($J,"RAE7") D EN2^RAO7PC1(PATID)
"RTN","ORWDRA32",65,0)
 S I=0 F  S I=$O(^TMP($J,"RAE7",PATID,I)) Q:'I  D 
"RTN","ORWDRA32",66,0)
 . S LST($$NXT)="i"_I_U_^TMP($J,"RAE7",PATID,I)
"RTN","ORWDRA32",67,0)
 K ^TMP($J,"RAE7")
"RTN","ORWDRA32",68,0)
 Q
"RTN","ORWDRA32",69,0)
PROCMSG(Y,IEN) ; return order message for a procedure
"RTN","ORWDRA32",70,0)
 N I
"RTN","ORWDRA32",71,0)
 S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S Y(I)=^(I,0)
"RTN","ORWDRA32",72,0)
 Q
"RTN","ORWDRA32",73,0)
NXT() ; Increment index of LST
"RTN","ORWDRA32",74,0)
 S ILST=ILST+1
"RTN","ORWDRA32",75,0)
 Q ILST
"RTN","ORWDRA32",76,0)
RAORDITM(Y,FROM,DIR,IMGTYP) ; Return a subset of orderable items
"RTN","ORWDRA32",77,0)
 ; .Return Array, Starting Text, Direction, Cross Reference (S.xxx)
"RTN","ORWDRA32",78,0)
 N I,IEN,CNT,X,DTXT,REQDET,REQAPPR,XREF S I=0,CNT=44
"RTN","ORWDRA32",79,0)
 S XREF="S."_$$IMTYPE(IMGTYP)
"RTN","ORWDRA32",80,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""  D
"RTN","ORWDRA32",81,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN)) Q:'IEN  D
"RTN","ORWDRA32",82,0)
 . . I $$REQDET,$P($G(^ORD(101.43,IEN,"RA")),U,2)="B" Q
"RTN","ORWDRA32",83,0)
 . . S X=^ORD(101.43,XREF,FROM,IEN)
"RTN","ORWDRA32",84,0)
 . . I +$P(X,U,3),$P(X,U,3)<DT Q
"RTN","ORWDRA32",85,0)
 . . S I=I+1
"RTN","ORWDRA32",86,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)_U_$$REQAPPR(IEN)
"RTN","ORWDRA32",87,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_" <"_$P(X,U,4)_">"_U_$P(X,U,4)_U_$$REQAPPR(IEN)
"RTN","ORWDRA32",88,0)
 Q
"RTN","ORWDRA32",89,0)
REQDET() ; Are "broad" procedures allowed for this division?
"RTN","ORWDRA32",90,0)
 N TMPDIV,RESULT
"RTN","ORWDRA32",91,0)
 S TMPDIV=DUZ(2)
"RTN","ORWDRA32",92,0)
 I $D(EVTDIV),$G(EVTDIV) S DUZ(2)=EVTDIV
"RTN","ORWDRA32",93,0)
 S RESULT=$$GET^XPAR("ALL","RA REQUIRE DETAILED",1,"Q")
"RTN","ORWDRA32",94,0)
 S DUZ(2)=TMPDIV
"RTN","ORWDRA32",95,0)
 Q RESULT
"RTN","ORWDRA32",96,0)
 ;
"RTN","ORWDRA32",97,0)
REQAPPR(IEN) ;  does procedure require radiologist approval?
"RTN","ORWDRA32",98,0)
 N RAIEN
"RTN","ORWDRA32",99,0)
 S RAIEN=$P($P($G(^ORD(101.43,IEN,0)),U,2),";",1)
"RTN","ORWDRA32",100,0)
 I +RAIEN=0 Q ""
"RTN","ORWDRA32",101,0)
 Q $P($G(^RAMIS(71,RAIEN,0)),U,11)
"RTN","ORWDRA32",102,0)
 ;
"RTN","ORWDRA32",103,0)
ISOLATN(Y,DFN) ;Is patient on isolation procedures?
"RTN","ORWDRA32",104,0)
 N ORVP
"RTN","ORWDRA32",105,0)
 S ORVP=DFN_";DPT("
"RTN","ORWDRA32",106,0)
 S Y=$$IP^ORMBLD
"RTN","ORWDRA32",107,0)
 Q
"RTN","ORWDRA32",108,0)
APPROVAL(Y,DUMMY) ; RETURNS LIST OF RADIOLOGISTS WHO MAY APPROVE A
"RTN","ORWDRA32",109,0)
 ;                       PROCEDURE WHEN REQUIRED
"RTN","ORWDRA32",110,0)
 N X,I
"RTN","ORWDRA32",111,0)
 S I="" F  S I=$O(^VA(200,"ARC","S",I)) Q:I=""  D
"RTN","ORWDRA32",112,0)
 . S X=$P($G(^VA(200,I,0)),U)
"RTN","ORWDRA32",113,0)
 . S Y(I)=I_U_X
"RTN","ORWDRA32",114,0)
 Q
"RTN","ORWDRA32",115,0)
IMTYPE(DGRP) ; return the mnemonic for the imaging type
"RTN","ORWDRA32",116,0)
 Q $P(^ORD(100.98,DGRP,0),U,3)
"RTN","ORWDRA32",117,0)
IMTYPSEL(Y,DUMMY) ;return list of active imaging types
"RTN","ORWDRA32",118,0)
 N X,I,IEN,DGRP,MNEM,NAME
"RTN","ORWDRA32",119,0)
 S X=""
"RTN","ORWDRA32",120,0)
 F I=1:1  S X=$O(^RA(79.2,"C",X)) Q:X=""  D
"RTN","ORWDRA32",121,0)
 . I '$D(^ORD(101.43,"S."_X)) Q
"RTN","ORWDRA32",122,0)
 . S IEN=$O(^RA(79.2,"C",X,0))
"RTN","ORWDRA32",123,0)
 . S NAME=$P(^RA(79.2,IEN,0),U,1)
"RTN","ORWDRA32",124,0)
 . S MNEM=$P(^RA(79.2,IEN,0),U,3)
"RTN","ORWDRA32",125,0)
 . S DGRP=$O(^ORD(100.98,"B",MNEM,0))
"RTN","ORWDRA32",126,0)
 . S Y(I)=IEN_U_NAME_U_MNEM_U_DGRP
"RTN","ORWDRA32",127,0)
 Q
"RTN","ORWDRA32",128,0)
RADSRC(Y,SRCTYPE) ; return list of available contract/sharing/research sources
"RTN","ORWDRA32",129,0)
 S X=0
"RTN","ORWDRA32",130,0)
 F I=1:1 S X=$O(^DIC(34,X)) Q:+X=0  D
"RTN","ORWDRA32",131,0)
 . Q:($P(^DIC(34,X,0),U,2)'=SRCTYPE)
"RTN","ORWDRA32",132,0)
 . I $D(^DIC(34,X,"I")),(^DIC(34,X,"I")<$$NOW^XLFDT) Q
"RTN","ORWDRA32",133,0)
 . S Y(I)=I_U_$P(^DIC(34,X,0),U,1)
"RTN","ORWDRA32",134,0)
 Q
"RTN","ORWDRA32",135,0)
LOCTYPE(Y,ORLOC) ; Returns type of location (C,W)
"RTN","ORWDRA32",136,0)
 S Y=-1
"RTN","ORWDRA32",137,0)
 Q:$G(ORLOC)=""
"RTN","ORWDRA32",138,0)
 S Y=$P($G(^SC(+$G(ORLOC),0)),U,3)
"RTN","ORWDRA32",139,0)
 Q
"RTN","ORWDX")
0^41^B71500323
"RTN","ORWDX",1,0)
ORWDX ; SLC/KCM/REV/JLI - Order dailog utilities ;10/31/02  10:51 [11/4/02 1:52pm]
"RTN","ORWDX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,132,141**;Dec 17, 1997
"RTN","ORWDX",3,0)
NXT() ; -- Gets index in array
"RTN","ORWDX",4,0)
 S ILST=ILST+1
"RTN","ORWDX",5,0)
 Q ILST
"RTN","ORWDX",6,0)
ORDITM(Y,FROM,DIR,XREF) ; Subset of orderable items
"RTN","ORWDX",7,0)
 ; Y(n)=IEN^.01 Name^.01 Name  -or-  IEN^Synonym <.01 Name>^.01 Name
"RTN","ORWDX",8,0)
 N I,IEN,CNT,X,DTXT,CURTM
"RTN","ORWDX",9,0)
 S I=0,CNT=44,CURTM=$$NOW^XLFDT
"RTN","ORWDX",10,0)
 F  Q:I'<CNT  S FROM=$O(^ORD(101.43,XREF,FROM),DIR) Q:FROM=""  D
"RTN","ORWDX",11,0)
 . S IEN="" F  S IEN=$O(^ORD(101.43,XREF,FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWDX",12,0)
 . . S X=^ORD(101.43,XREF,FROM,IEN)
"RTN","ORWDX",13,0)
 . . I +$P(X,U,3),$P(X,U,3)<CURTM Q
"RTN","ORWDX",14,0)
 . . S I=I+1
"RTN","ORWDX",15,0)
 . . I 'X S Y(I)=IEN_U_$P(X,U,2)_U_$P(X,U,2)
"RTN","ORWDX",16,0)
 . . E  S Y(I)=IEN_U_$P(X,U,2)_$C(9)_"<"_$P(X,U,4)_">"_U_$P(X,U,4)
"RTN","ORWDX",17,0)
 Q
"RTN","ORWDX",18,0)
ODITMBC(Y,XREF,ODLST) ; --Info based on Orderable ItemIen
"RTN","ORWDX",19,0)
 N CNT,NM,XRF
"RTN","ORWDX",20,0)
 S CNT=0,NM=0,XRF=XREF
"RTN","ORWDX",21,0)
 F  S CNT=$O(ODLST(CNT)) Q:'CNT  D FNDINFO(.Y,ODLST(CNT))
"RTN","ORWDX",22,0)
 Q
"RTN","ORWDX",23,0)
FNDINFO(Y,ODIEN) ;
"RTN","ORWDX",24,0)
 N ODI,CRTM,FRM,XX
"RTN","ORWDX",25,0)
 S FRM="",CRTM=$$NOW^XLFDT
"RTN","ORWDX",26,0)
 F  S FRM=$O(^ORD(101.43,XRF,FRM)) Q:FRM=""  D
"RTN","ORWDX",27,0)
 . S ODI=0 F  S ODI=$O(^ORD(101.43,XRF,FRM,ODI)) Q:'ODI  D
"RTN","ORWDX",28,0)
 .. S XX=^ORD(101.43,XRF,FRM,ODI)
"RTN","ORWDX",29,0)
 .. I +$P(XX,U,3),$P(XX,U,3)<CRTM Q
"RTN","ORWDX",30,0)
 .. I ODI=ODIEN D
"RTN","ORWDX",31,0)
 ... S NM=NM+1
"RTN","ORWDX",32,0)
 ... I 'XX S Y(NM)=ODIEN_U_$P(XX,U,2)_U_$P(XX,U,2)
"RTN","ORWDX",33,0)
 ... E  S Y(NM)=ODIEN_U_$P(XX,U,2)_$C(9)_"<"_$P(XX,U,4)_">"_U_$P(XX,U,4)
"RTN","ORWDX",34,0)
 Q
"RTN","ORWDX",35,0)
DLGDEF(LST,DLG) ; Format mapping for a dlg
"RTN","ORWDX",36,0)
 N I,IEN,ILST,X0,X2,XW  S ILST=0
"RTN","ORWDX",37,0)
 I $O(^ORD(101.41,"AB",DLG,0))>0 S DLG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",38,0)
 E  S DLG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",39,0)
 Q:'DLG
"RTN","ORWDX",40,0)
 S I=0 F  S I=$O(^ORD(101.41,DLG,10,I)) Q:I'>0  D
"RTN","ORWDX",41,0)
 . S X0=$G(^ORD(101.41,DLG,10,I,0)),X2=$G(^(2)),IEN=+$P(X0,U,2)
"RTN","ORWDX",42,0)
 . S ILST=ILST+1,LST(ILST)=U_IEN_U_$P(X2,U,1,7)
"RTN","ORWDX",43,0)
 . I $P(X0,U,11) S $P(LST(ILST),U,11)=1
"RTN","ORWDX",44,0)
 . S $P(LST(ILST),U)=$P($G(^ORD(101.41,IEN,1)),U,3)
"RTN","ORWDX",45,0)
 . I $P($G(^ORD(101.41,IEN,0)),U)="OR GTX ADDITIVE" S $P(LST(ILST),U)="ADDITIVE"
"RTN","ORWDX",46,0)
 . I $L($P(LST(ILST),U))=0 S $P(LST(ILST),U)="ID"_IEN
"RTN","ORWDX",47,0)
 . I $D(^ORD(101.41,DLG,10,"DAD",IEN)) D
"RTN","ORWDX",48,0)
 .. N SEQ,DA,CHILD S CHILD=""
"RTN","ORWDX",49,0)
 .. S SEQ=0 F  S SEQ=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ)) Q:'SEQ  D
"RTN","ORWDX",50,0)
 ... S DA=0 F  S DA=$O(^ORD(101.41,DLG,10,"DAD",IEN,SEQ,DA)) Q:'DA  D
"RTN","ORWDX",51,0)
 .... S CHILD=CHILD_+$P($G(^ORD(101.41,DLG,10,DA,0)),U,2)_"~"
"RTN","ORWDX",52,0)
 .. S $P(LST(ILST),U,10)=CHILD
"RTN","ORWDX",53,0)
 Q
"RTN","ORWDX",54,0)
DLGQUIK(LST,QO) ; Responses for quick order  (NOT USED)
"RTN","ORWDX",55,0)
 D LOADRSP(.LST,QO)
"RTN","ORWDX",56,0)
 Q
"RTN","ORWDX",57,0)
LOADRSP(LST,RSPID)      ; Load responses from 101.41 or 100
"RTN","ORWDX",58,0)
 ; RSPID:  C123456;1-3243 = cached copy,   134-3234 = cached quick
"RTN","ORWDX",59,0)
 ;         X123456;1      = change order,  134      = quick dialog
"RTN","ORWDX",60,0)
 N I,J,DLG,INST,ID,VAL,ILST,ROOT S ROOT=""
"RTN","ORWDX",61,0)
 I RSPID["-" S ROOT="^TMP(""ORWDXMQ"",$J,"""_RSPID_""")" G XROOT
"RTN","ORWDX",62,0)
 I $E(RSPID)="X" S ROOT="^OR(100,"_+$P(RSPID,"X",2)_",4.5)"  G XROOT
"RTN","ORWDX",63,0)
 I +RSPID=RSPID  S ROOT="^ORD(101.41,"_+RSPID_",6)" G XROOT
"RTN","ORWDX",64,0)
 Q:ROOT=""
"RTN","ORWDX",65,0)
XROOT S (ILST,I)=0 F  S I=$O(@ROOT@(I)) Q:I'>0  D
"RTN","ORWDX",66,0)
 . S DLG=$P(@ROOT@(I,0),U,2),INST=$P(^(0),U,3)
"RTN","ORWDX",67,0)
 . S ID=$P($G(^ORD(101.41,DLG,1)),U,3)
"RTN","ORWDX",68,0)
 . I '$L(ID) S ID="ID"_DLG
"RTN","ORWDX",69,0)
 . S VAL=$G(@ROOT@(I,1))
"RTN","ORWDX",70,0)
 . I $P($G(^ORD(101.41,DLG,0)),U)="OR GTX ADDITIVE" S ID="ADDITIVE"
"RTN","ORWDX",71,0)
 . I $E(RSPID)="C",(ID="START"),VAL Q  ; skip literal start time on copy
"RTN","ORWDX",72,0)
 . S LST($$NXT)="~"_DLG_U_INST_U_ID
"RTN","ORWDX",73,0)
 . I $L(VAL) D
"RTN","ORWDX",74,0)
 .. S LST($$NXT)="i"_VAL,LST($$NXT)="e"_$$EXTVAL(VAL,DLG)
"RTN","ORWDX",75,0)
 . I $D(@ROOT@(I,2))>1 D
"RTN","ORWDX",76,0)
 .. S J=0 F  S J=$O(@ROOT@(I,2,J)) Q:J'>0  D
"RTN","ORWDX",77,0)
 ... S LST($$NXT)="t"_$G(@ROOT@(I,2,J,0))
"RTN","ORWDX",78,0)
 I $E(ROOT,1,4)="^TMP" K ^TMP("ORWDXMQ",$J)
"RTN","ORWDX",79,0)
 Q
"RTN","ORWDX",80,0)
SAVE(REC,ORVP,ORNP,ORL,DLG,ORDG,ORIT,ORIFN,ORDIALOG,ORDEA) ;
"RTN","ORWDX",81,0)
 ; ORVP=DFN, ORNP=Provider, ORL=Location, DLG=Order Dialog,
"RTN","ORWDX",82,0)
 ; ORDG=Display Group, ORIT=Quick Order Dialog,
"RTN","ORWDX",83,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORLEAD,ORTRAIL,ORPKG,ORWP94,ORCATFN,OREVTYPE,ONPASS
"RTN","ORWDX",84,0)
 S ORCATFN=""
"RTN","ORWDX",85,0)
 I $L($P(DLG,U,2)) S ORCATFN=$P(DLG,U,2),DLG=$P(DLG,U,1)
"RTN","ORWDX",86,0)
 I $G(ORDIALOG("ORTS")) S ORTS=ORDIALOG("ORTS") K ORDIALOG("ORTS")
"RTN","ORWDX",87,0)
 I $G(ORDIALOG("ORSLOG")) S ORLOG=ORDIALOG("ORSLOG") K ORDIALOG("ORSLOG")
"RTN","ORWDX",88,0)
 I $D(ORDIALOG("OREVENT")) S OREVENT=ORDIALOG("OREVENT") K ORDIALOG("OREVENT")
"RTN","ORWDX",89,0)
 I $L($G(OREVENT)) D
"RTN","ORWDX",90,0)
 . S ONPASS=0
"RTN","ORWDX",91,0)
 . S OREVTYPE=$$TYPE^OREVNTX(OREVENT)
"RTN","ORWDX",92,0)
 . I OREVTYPE="T" D ISPASS^OREVNTX1(.ONPASS,+OREVENT,"T")
"RTN","ORWDX",93,0)
 . S ORCAT=$S(OREVTYPE="A":"I",OREVTYPE="T":"I",ONPASS=1:"O",1:"O")
"RTN","ORWDX",94,0)
 E  S ORCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDX",95,0)
 I DLG="PS MEDS" S ORWP94=1 D
"RTN","ORWDX",96,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO SUPPLY",0)) S DLG="PSO SUPPLY"
"RTN","ORWDX",97,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSO OERR",0)) S DLG="PSO OERR"
"RTN","ORWDX",98,0)
 . I ORIT=$O(^ORD(101.41,"AB","PSJ OR PAT OE",0)) S DLG="PSJ OR PAT OE"
"RTN","ORWDX",99,0)
 I DLG="PSO OERR" S ORCAT="O" I $G(OREVENT("EFFECTIVE")) D
"RTN","ORWDX",100,0)
 . S ORDIALOG($O(^ORD(101.41,"B","OR GTX START DATE"_$S($G(ORWP94):"/TIME",1:""),0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDX",101,0)
 I DLG="PSJ OR PAT OE" S ORCAT="I"
"RTN","ORWDX",102,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDX",103,0)
 K:'ORDG ORDG K:'ORIT ORIT ; Dgrp & Quick must be non-zero
"RTN","ORWDX",104,0)
 M ORCHECK=ORDIALOG("ORCHECK") K ORDIALOG("ORCHECK")
"RTN","ORWDX",105,0)
 S ORDIALOG=$O(^ORD(101.41,"AB",DLG,0))
"RTN","ORWDX",106,0)
 I 'ORDIALOG S ORDIALOG=$O(^ORD(101.41,"B",DLG,0))
"RTN","ORWDX",107,0)
 I $D(ORDIALOG("ORLEAD")) S ORLEAD=ORDIALOG("ORLEAD")
"RTN","ORWDX",108,0)
 I $D(ORDIALOG("ORTRAIL")) S ORTRAIL=ORDIALOG("ORTRAIL")
"RTN","ORWDX",109,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORWDX",110,0)
 I $L(ORCATFN) S ORCAT=ORCATFN
"RTN","ORWDX",111,0)
 I $G(ORWP94) D
"RTN","ORWDX",112,0)
 . N SIGPRMT S SIGPRMT=$O(^ORD(101.41,"B","OR GTX SIG",0))
"RTN","ORWDX",113,0)
 . N INSPRMT S INSPRMT=$O(^ORD(101.41,"B","OR GTX INSTRUCTIONS",0))
"RTN","ORWDX",114,0)
 . I $L($G(ORDIALOG(SIGPRMT,1))) S ORDIALOG(INSPRMT,"FORMAT")="@"
"RTN","ORWDX",115,0)
 . I ORCAT="O" S ORPKG=$O(^DIC(9.4,"C","PSO",0))
"RTN","ORWDX",116,0)
 . I ORCAT="I" S ORPKG=$O(^DIC(9.4,"C","PSJ",0))
"RTN","ORWDX",117,0)
 I $G(ORIFN)="" D  ; new order
"RTN","ORWDX",118,0)
 . D EN^ORCSAVE
"RTN","ORWDX",119,0)
 . S REC="" I ORIFN D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",120,0)
 . I '$D(^TMP("ORECALL",$J,ORDIALOG)) M ^TMP("ORECALL",$J,ORDIALOG)=ORDIALOG
"RTN","ORWDX",121,0)
 E  D
"RTN","ORWDX",122,0)
 . N OR0
"RTN","ORWDX",123,0)
 . S OR0=$G(^OR(100,+ORIFN,0)),ORSTS=$P($G(^(3)),U,3),ORDG=$P(OR0,U,11)
"RTN","ORWDX",124,0)
 . I $L($P(OR0,U,17)),ORSTS=10 S OREVENT=$P(OR0,U,17),OREVENT("TS")=$P(OR0,U,13)
"RTN","ORWDX",125,0)
 . D XX^ORCSAVE ; edit order
"RTN","ORWDX",126,0)
 . S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDX",127,0)
 Q
"RTN","ORWDX",128,0)
SENDED(ORWLST,ORIENS,TS,LOC) ; Release EDOs to svc
"RTN","ORWDX",129,0)
 N OK,ORVP,ORWERR,ORSIGST,ORDA,ORNATURE,ORIX,X,PTEVT,ORIFN
"RTN","ORWDX",130,0)
 S ORWERR="",ORIX=0,LOC=LOC_";SC("
"RTN","ORWDX",131,0)
 F  S ORIX=$O(ORIENS(ORIX)) Q:'ORIX  D
"RTN","ORWDX",132,0)
 . S ORIFN=ORIENS(ORIX)
"RTN","ORWDX",133,0)
 . S ORDA=$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORWDX",134,0)
 . S ORVP=$P($G(^OR(100,+ORIFN,0)),U,2)
"RTN","ORWDX",135,0)
 . I $D(^OR(100,+ORIFN,8,ORDA,0)) D
"RTN","ORWDX",136,0)
 .. S ORSIGST=$P($G(^(0)),U,4)
"RTN","ORWDX",137,0)
 .. S ORNATURE=$P($G(^(0)),U,12)
"RTN","ORWDX",138,0)
 . S:$G(LOC) $P(^OR(100,+ORIFN,0),U,10)=LOC ;set location
"RTN","ORWDX",139,0)
 . S:$G(TS) $P(^OR(100,+ORIFN,0),U,13)=TS ;set specialty
"RTN","ORWDX",140,0)
 . S OK=$$LOCK1^ORX2(ORIFN) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",141,0)
 . I OK D EN2^ORCSEND(ORIENS(ORIX),ORSIGST,ORNATURE,.ORWERR),UNLK1^ORX2(ORIENS(ORIX))
"RTN","ORWDX",142,0)
 . S ORWLST(ORIX)=ORIENS(ORIX)
"RTN","ORWDX",143,0)
 . I $L(ORWERR) S ORWLST(ORIX)=ORWLST(ORIX)_"^E^"_ORWERR Q
"RTN","ORWDX",144,0)
 . E  D
"RTN","ORWDX",145,0)
 .. S PTEVT=$P($G(^OR(100,+ORIENS(ORIX),0)),U,17)
"RTN","ORWDX",146,0)
 .. D:$$TYPE^OREVNTX(PTEVT)="M" SAVE^ORMEVNT1(ORIENS(ORIX),PTEVT,2)
"RTN","ORWDX",147,0)
 . S X="RS"
"RTN","ORWDX",148,0)
 . S $P(ORWLST(ORIX),U,2)=X
"RTN","ORWDX",149,0)
 Q
"RTN","ORWDX",150,0)
SEND(ORWLST,DFN,ORNP,ORL,ES,ORWREC) ; Sign
"RTN","ORWDX",151,0)
 ; DFN=Patient, ORNP=Provider, ORL=Location, ES=Encrypted ES code
"RTN","ORWDX",152,0)
 ; ORWREC(n)=ORIFN;Action^Signature Sts^Release Sts^Nature of Order
"RTN","ORWDX",153,0)
SEND1 N ORVP,ORWI,ORWERR,ORWREL,ORWSIG,ORWNATR,ORDERID,ORBEF,ORLR,ORLAB,X
"RTN","ORWDX",154,0)
 S ORVP=DFN_";DPT(",ORL=ORL_";SC(",ORL(2)=ORL,ORWLST=0
"RTN","ORWDX",155,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0))
"RTN","ORWDX",156,0)
 S ORWI=0 F  S ORWI=$O(ORWREC(ORWI)) Q:'ORWI  D
"RTN","ORWDX",157,0)
 . S X=ORWREC(ORWI),ORWERR=""
"RTN","ORWDX",158,0)
 . S ORDERID=$P(X,U),ORWSIG=$P(X,U,2),ORWREL=$P(X,U,3),ORWNATR=$P(X,U,4)
"RTN","ORWDX",159,0)
 . S ORBEF=0
"RTN","ORWDX",160,0)
 . I $D(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0)) S ORBEF=$P(^OR(100,+ORDERID,8,+$P(ORDERID,";",2),0),U,15)
"RTN","ORWDX",161,0)
 . S ORWNATR=$S($P(^(0),"^",4)=3:"",1:ORWNATR) ;If order doesn't require signature leave nature at electronic --added with patch 110
"RTN","ORWDX",162,0)
 . S ORWERR=$$CHKACT^ORWDXR(ORDERID,ORWSIG,ORWREL,ORWNATR)
"RTN","ORWDX",163,0)
 . I $L(ORWERR) S ORWERR="1^"_ORWERR
"RTN","ORWDX",164,0)
 . I '$L(ORWERR) D
"RTN","ORWDX",165,0)
 .. I $P(^OR(100,+ORDERID,0),U,14)=ORLR,'$G(ORLAB) D  ; lab batch start
"RTN","ORWDX",166,0)
 ... I $L($T(BHS^ORMBLD)) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORWDX",167,0)
 .. N OK S OK=$$LOCK1^ORX2(ORDERID) I 'OK S ORWERR="1^"_$P(OK,U,2)
"RTN","ORWDX",168,0)
 .. I OK D EN^ORCSEND(ORDERID,"",ORWSIG,ORWREL,ORWNATR,"",.ORWERR),UNLK1^ORX2(ORDERID)
"RTN","ORWDX",169,0)
 . S ORWLST(ORWI)=ORDERID,X=""
"RTN","ORWDX",170,0)
 . I $L(ORWERR) S ORWLST(ORWI)=ORWLST(ORWI)_"^E^"_ORWERR Q
"RTN","ORWDX",171,0)
 . I ORWREL,((ORBEF=10)!(ORBEF=11)),($P(^OR(100,+ORDERID,3),U,3)'=10) S X="R"
"RTN","ORWDX",172,0)
 . I ORWSIG'=2 S X=X_"S"
"RTN","ORWDX",173,0)
 . S $P(ORWLST(ORWI),U,2)=X
"RTN","ORWDX",174,0)
 I $G(ORLAB) D BTS^ORMBLD(ORVP)
"RTN","ORWDX",175,0)
 Q
"RTN","ORWDX",176,0)
EXTVAL(IVAL,DLG) ; External value given a dlg ptr
"RTN","ORWDX",177,0)
 N ORDIALOG
"RTN","ORWDX",178,0)
 S ORDIALOG(DLG,0)=$P($G(^ORD(101.41,DLG,1)),U,1,2)
"RTN","ORWDX",179,0)
 S ORDIALOG(DLG,1)=IVAL
"RTN","ORWDX",180,0)
 I $E(ORDIALOG(DLG,0))="R",(+IVAL'=IVAL) Q IVAL  ; free text date/time
"RTN","ORWDX",181,0)
 Q $$EXT^ORCD(DLG,1)  ; all others
"RTN","ORWDX",182,0)
DLGID(VAL,ORIFN) ; return dlg IEN for order
"RTN","ORWDX",183,0)
 S VAL=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",184,0)
 S VAL=$S($P(VAL,";",2)="ORD(101.41,":+VAL,1:0)
"RTN","ORWDX",185,0)
 Q
"RTN","ORWDX",186,0)
FORMID(VAL,ORIFN)  ; Base dlg FormID for an order
"RTN","ORWDX",187,0)
 N DLG
"RTN","ORWDX",188,0)
 S VAL=0,DLG=$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORWDX",189,0)
 Q:$P(DLG,";",2)'="ORD(101.41,"
"RTN","ORWDX",190,0)
 D FORMID^ORWDXM(.VAL,+DLG)
"RTN","ORWDX",191,0)
 Q
"RTN","ORWDX",192,0)
AGAIN(VAL,DLG)  ; return true to keep dlg for another order
"RTN","ORWDX",193,0)
 S VAL=''$P($G(^ORD(101.41,DLG,0)),U,9)
"RTN","ORWDX",194,0)
 Q
"RTN","ORWDX",195,0)
DGRP(VAL,DLG)   ; Display grp pointer for a dlg
"RTN","ORWDX",196,0)
 S DLG=$S($E(DLG)="`":+$P(DLG,"`",2),1:$O(^ORD(101.41,"AB",DLG,0))) ;kcm
"RTN","ORWDX",197,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,5)
"RTN","ORWDX",198,0)
 Q
"RTN","ORWDX",199,0)
DGNM(VAL,NM) ; Display grp pointer for name
"RTN","ORWDX",200,0)
 S VAL=$O(^ORD(100.98,"B",NM,0))
"RTN","ORWDX",201,0)
 Q
"RTN","ORWDX",202,0)
WRLST(LST,LOC) ; List of dlgs for writing orders
"RTN","ORWDX",203,0)
 G WRLST1^ORWDX1 ;moved to new routine
"RTN","ORWDX",204,0)
MSG(LST,IEN) ; Msg text for orderable item
"RTN","ORWDX",205,0)
 N I
"RTN","ORWDX",206,0)
 S I=0 F  S I=$O(^ORD(101.43,IEN,8,I)) Q:I'>0  S LST(I)=^(I,0)
"RTN","ORWDX",207,0)
 Q
"RTN","ORWDX",208,0)
DISMSG(VAL,IEN) ; Disabled mge for ordering dlg
"RTN","ORWDX",209,0)
 S VAL=$P($G(^ORD(101.41,+IEN,0)),U,3)
"RTN","ORWDX",210,0)
 Q
"RTN","ORWDX",211,0)
LOCK(OK,DFN) ; Attempt to lock pt for ordering
"RTN","ORWDX",212,0)
 S OK=$$LOCK^ORX2(DFN)
"RTN","ORWDX",213,0)
 Q
"RTN","ORWDX",214,0)
UNLOCK(OK,DFN) ; Unlock pt for ordering
"RTN","ORWDX",215,0)
 D UNLOCK^ORX2(DFN) S OK=1
"RTN","ORWDX",216,0)
 Q
"RTN","ORWDX",217,0)
LOCKORD(OK,ORIFN) ; Attempt to lock order
"RTN","ORWDX",218,0)
 S OK=$$LOCK1^ORX2(ORIFN)
"RTN","ORWDX",219,0)
 Q
"RTN","ORWDX",220,0)
UNLKORD(OK,ORIFN) ; Unlock order
"RTN","ORWDX",221,0)
 D UNLK1^ORX2(ORIFN) S OK=1
"RTN","ORWDX",222,0)
 Q
"RTN","ORWDXA")
0^68^B56623345
"RTN","ORWDXA",1,0)
ORWDXA ; SLC/KCM/JLI - Utilites for Order Actions; 7/5/2002 12PM
"RTN","ORWDXA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,148,141**;Dec 17, 1997
"RTN","ORWDXA",3,0)
 ;
"RTN","ORWDXA",4,0)
VALID(VAL,ORID,ACTION,ORNP,ORWNAT) ; Return error message if not valid action for order
"RTN","ORWDXA",5,0)
 N ORACT,ORVP,ORVER,ORIFN S VAL=""
"RTN","ORWDXA",6,0)
 I +ORID=0 S VAL="This order has been deleted." Q
"RTN","ORWDXA",7,0)
 I '$D(^OR(100,+ORID,0)) S VAL="This order has been deleted!" Q
"RTN","ORWDXA",8,0)
 I ACTION="XFR",'$L($T(XFR^ORCACT01)) S ACTION="RW" ; for pre-POE
"RTN","ORWDXA",9,0)
 S ORIFN=ORID,ORVP=$P(^OR(100,+ORID,0),U,2)  ; ORCACT0 expects defined
"RTN","ORWDXA",10,0)
 I (ACTION="RN") D  Q:$L(VAL)  ; ** There's got to be a better way!
"RTN","ORWDXA",11,0)
 . N DLG S DLG=$P(^OR(100,+ORID,0),U,5) Q:DLG'[";ORD(101.41,"
"RTN","ORWDXA",12,0)
 . I $G(^ORD(101.41,+DLG,3))'["PROVIDER^ORCDPSIV" Q
"RTN","ORWDXA",13,0)
 . D AUTH^ORWDPS32(.VAL,ORNP)
"RTN","ORWDXA",14,0)
 . I VAL S VAL=$P(VAL,U,2)
"RTN","ORWDXA",15,0)
 . E  S VAL=""
"RTN","ORWDXA",16,0)
 S ORVER=$S(ACTION="CR":"R",$D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:"^")
"RTN","ORWDXA",17,0)
 I ACTION="CR" S ACTION="VR"
"RTN","ORWDXA",18,0)
 I (ACTION="ES")!(ACTION="OC")!(ACTION="RS") S ORACT=ACTION ; why not defined???
"RTN","ORWDXA",19,0)
 I (ACTION="VR"),'($D(^XUSEC("ORELSE",DUZ))!$D(^XUSEC("OREMAS",DUZ))) D  Q
"RTN","ORWDXA",20,0)
 . S VAL="You are not authorized to verify these orders."
"RTN","ORWDXA",21,0)
 I (ACTION="RW")!(ACTION="XX")!(ACTION="XFR") D  Q:$L(VAL)
"RTN","ORWDXA",22,0)
 . N DLG,FRM
"RTN","ORWDXA",23,0)
 . S DLG=$P(^OR(100,+ORID,0),U,5),FRM=0
"RTN","ORWDXA",24,0)
 . I $P(DLG,";",2)'="ORD(101.41," S DLG=0
"RTN","ORWDXA",25,0)
 . I DLG D FORMID^ORWDXM(.FRM,+DLG)
"RTN","ORWDXA",26,0)
 . I '(DLG&FRM) D
"RTN","ORWDXA",27,0)
 . . S VAL="Copy & Change are not implemented for this order that predates CPRS."
"RTN","ORWDXA",28,0)
 N OREBUILD  ; sometimes left defined by $$VALID
"RTN","ORWDXA",29,0)
 I $$VALID^ORCACT0(ORID,ACTION,.VAL,$G(ORWNAT)) S VAL="" ; VAL=error
"RTN","ORWDXA",30,0)
 Q
"RTN","ORWDXA",31,0)
HOLD(REC,ORID,ORNP)  ; Place an order on hold
"RTN","ORWDXA",32,0)
 N ACTDA
"RTN","ORWDXA",33,0)
 S ACTDA=$$ACTION^ORCSAVE("HD",+ORID,ORNP)
"RTN","ORWDXA",34,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",35,0)
 Q
"RTN","ORWDXA",36,0)
UNHOLD(REC,ORID,ORNP)  ; Release an order from hold
"RTN","ORWDXA",37,0)
 N ACTDA
"RTN","ORWDXA",38,0)
 S ACTDA=$$ACTION^ORCSAVE("RL",+ORID,ORNP)
"RTN","ORWDXA",39,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",40,0)
 Q
"RTN","ORWDXA",41,0)
DC(REC,ORID,ORNP,ORL,REASON)   ; Discontinue/Cancel/Delete an order
"RTN","ORWDXA",42,0)
 N NATURE,CREATE,PRINT,STATUS,ACTDA,SIGSTS
"RTN","ORWDXA",43,0)
 N X3,X8,CURRACT
"RTN","ORWDXA",44,0)
 S CURRACT=0
"RTN","ORWDXA",45,0)
 S ORL(2)=ORL_";SC(",ORL=ORL(2),NATURE=""
"RTN","ORWDXA",46,0)
 I REASON S NATURE=$P(^ORD(100.02,$P(^ORD(100.03,REASON,0),U,7),0),U,2)
"RTN","ORWDXA",47,0)
 S:NATURE="" NATURE="W"  ; S:ORNP=DUZ NATURE="E" 
"RTN","ORWDXA",48,0)
 S CREATE=$$CREATE^ORX1(NATURE),PRINT=$$PRINT^ORCACT2(NATURE)
"RTN","ORWDXA",49,0)
 S X3=$G(^OR(100,+ORID,3))
"RTN","ORWDXA",50,0)
 S CURRACT=$P(X3,U,7) S:CURRACT<1 CURRACT=+$O(^OR(100,+ORID,8,"?"),-1)
"RTN","ORWDXA",51,0)
 I '$D(^OR(100,+ORID,8,+$P(ORID,";",2),0)) D
"RTN","ORWDXA",52,0)
 . S X8=$G(^OR(100,+ORID,8,CURRACT,0))
"RTN","ORWDXA",53,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",54,0)
 . S $P(ORID,";",2)=CURRACT
"RTN","ORWDXA",55,0)
 E  D
"RTN","ORWDXA",56,0)
 . S X8=^OR(100,+ORID,8,+$P(ORID,";",2),0)
"RTN","ORWDXA",57,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",58,0)
 I '$D(SIGSTS) S SIGSTS=1
"RTN","ORWDXA",59,0)
 S STATUS=$P(^OR(100,+ORID,8,+$P(ORID,";",2),0),U,15)
"RTN","ORWDXA",60,0)
 I (STATUS=10)!(STATUS=11) D  Q   ; delete/cancel unreleased order
"RTN","ORWDXA",61,0)
 . N RPLORD
"RTN","ORWDXA",62,0)
 . S RPLORD=$P($G(^OR(100,+ORID,3)),U,5)    ; replaced order
"RTN","ORWDXA",63,0)
 . D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",64,0)
 . I STATUS=10,($P(X8,U,4)'=2) D  ; CANCEL signed, delayed, unreleased
"RTN","ORWDXA",65,0)
 . . ; taken from CLRDLY^ORCACT2
"RTN","ORWDXA",66,0)
 . . I REASON D SET^ORCACT2(+ORID,NATURE,REASON)
"RTN","ORWDXA",67,0)
 . . I 'REASON D SET^ORCACT2(+ORID,"M","","Delayed Order Cancelled")
"RTN","ORWDXA",68,0)
 . . D STATUS^ORCSAVE2(+ORID,13) S $P(^OR(100,+ORID,8,1,0),U,15)=13
"RTN","ORWDXA",69,0)
 . E  D                           ; DELETE unsigned, unreleased
"RTN","ORWDXA",70,0)
 . . I $P(X8,U,2)="DC" K ^OR(100,+ORID,6)
"RTN","ORWDXA",71,0)
 . . ; delete fwd ptr to order about to be deleted
"RTN","ORWDXA",72,0)
 . . I RPLORD,$P(X8,U,2)="NW" S $P(^OR(100,RPLORD,3),U,6)=""
"RTN","ORWDXA",73,0)
 . . ; delete ptr to order in Patient Event file #100.2
"RTN","ORWDXA",74,0)
 . . N EVT S EVT=$P($G(^OR(100,+ORID,0)),U,17) I EVT,EVT=+$O(^ORE(100.2,"AO",+ORID,0)) S $P(^ORE(100.2,EVT,0),U,4)="" K ^ORE(100.2,"AO",+ORID,EVT)
"RTN","ORWDXA",75,0)
 . . D DELETE^ORCSAVE2(ORID)
"RTN","ORWDXA",76,0)
 . I RPLORD,'(SIGSTS=1) S ORID=RPLORD  ; for Renews & Changes, show replaced order
"RTN","ORWDXA",77,0)
 . I '$D(^OR(100,+ORID)) D
"RTN","ORWDXA",78,0)
 . . S $P(REC(1),U)="~0",REC(2)="tDELETED: "_$E(REC(2),2,245)
"RTN","ORWDXA",79,0)
 . E  D
"RTN","ORWDXA",80,0)
 . . K REC
"RTN","ORWDXA",81,0)
 . . D GETBYIFN^ORWORR(.REC,+ORID_";"_$P($G(^OR(100,+ORID,3)),U,7))
"RTN","ORWDXA",82,0)
 . S $P(REC(1),U,14)=2 ; DCType = deletion
"RTN","ORWDXA",83,0)
 I CREATE D
"RTN","ORWDXA",84,0)
 . S ACTDA=$$ACTION^ORCSAVE("DC",+ORID,ORNP)
"RTN","ORWDXA",85,0)
 . D SET^ORCACT2(+ORID,NATURE,REASON)
"RTN","ORWDXA",86,0)
 E  D 
"RTN","ORWDXA",87,0)
 . D EN^ORCSEND(+ORID,"DC",3,1,NATURE,REASON)
"RTN","ORWDXA",88,0)
 . S ACTDA=$P(ORID,";",2)
"RTN","ORWDXA",89,0)
 . I PRINT ; do something to print this
"RTN","ORWDXA",90,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",91,0)
 S $P(REC(1),U,14)=$S(CREATE:1,1:3)  ;DCType - 1=NewOrder, 3=NewStatus
"RTN","ORWDXA",92,0)
 Q
"RTN","ORWDXA",93,0)
DCREASON(LST)   ; Return a list of DC reasons
"RTN","ORWDXA",94,0)
 N IEN,ILST,X
"RTN","ORWDXA",95,0)
 S ILST=1,LST(ILST)="~DCReason"
"RTN","ORWDXA",96,0)
 S IEN=0 F  S IEN=$O(^ORD(100.03,IEN)) Q:'IEN  S X=^(IEN,0) D
"RTN","ORWDXA",97,0)
 . I $P(X,U,4) Q                              ; inactive
"RTN","ORWDXA",98,0)
 . I $P(X,U,5)'=+$O(^DIC(9.4,"C","OR",0)) Q   ; not OR pkg
"RTN","ORWDXA",99,0)
 . I $P(X,U,7)=+$O(^ORD(100.02,"C","A",0)) Q  ; nature=auto
"RTN","ORWDXA",100,0)
 . S ILST=ILST+1,LST(ILST)="i"_IEN_U_$P(X,U)
"RTN","ORWDXA",101,0)
 S IEN=$O(^ORD(100.03,"C","ORREQ",0))
"RTN","ORWDXA",102,0)
 I IEN S ILST=ILST+1,LST(ILST)="d"_IEN_U_$P(^ORD(100.03,IEN,0),U)
"RTN","ORWDXA",103,0)
 Q
"RTN","ORWDXA",104,0)
DCREQIEN(VAL)   ; Return the IEN for Requesting Physician Cancelled reason
"RTN","ORWDXA",105,0)
 S VAL=$O(^ORD(100.03,"S","REQ",0))
"RTN","ORWDXA",106,0)
 Q
"RTN","ORWDXA",107,0)
COMPLETE(REC,ORID,ESCODE)      ; Complete an order (generic orders)
"RTN","ORWDXA",108,0)
 ;N X S X=+$E($$NOW^XLFDT,1,12)
"RTN","ORWDXA",109,0)
 ;D DATES^ORCSAVE2(+ORID,,X)
"RTN","ORWDXA",110,0)
 ;D STATUS^ORCSAVE2(+ORID,2)
"RTN","ORWDXA",111,0)
 ; validate ESCode
"RTN","ORWDXA",112,0)
 D COMP^ORCSAVE2(ORID)
"RTN","ORWDXA",113,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",114,0)
 Q
"RTN","ORWDXA",115,0)
VERIFY(REC,ORID,ESCODE,ORVER) ; Verify an order
"RTN","ORWDXA",116,0)
 ; validate ESCode
"RTN","ORWDXA",117,0)
 S ORVER=$G(ORVER,$S($D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:U))
"RTN","ORWDXA",118,0)
 I ORVER'=U D EN^ORCSEND(ORID,"VR","","")
"RTN","ORWDXA",119,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",120,0)
 ; !! to match 56, need to VERIFY any replaced orders
"RTN","ORWDXA",121,0)
 Q
"RTN","ORWDXA",122,0)
ALERT(DUMMY,ORID,ORDUZ)       ;send alert to user (ORDUZ) when order (ORID) resulted
"RTN","ORWDXA",123,0)
 ;if no user passed from GUI, use ordering provider:
"RTN","ORWDXA",124,0)
 I $G(ORDUZ)<1 S ORDUZ=+$$ORDERER^ORQOR2(+ORID)
"RTN","ORWDXA",125,0)
 I $L($G(ORDUZ))<1 S ORDUZ=DUZ
"RTN","ORWDXA",126,0)
 S DUMMY=1,$P(^OR(100,+ORID,3),U,10)=ORDUZ
"RTN","ORWDXA",127,0)
 Q
"RTN","ORWDXA",128,0)
FLAG(REC,ORIFN,OREASON,ORNP)   ; Flag an order
"RTN","ORWDXA",129,0)
 N ORB,ORVP,DA,ORPS
"RTN","ORWDXA",130,0)
 D BULLETIN
"RTN","ORWDXA",131,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",132,0)
 K ^OR(100,+ORIFN,8,DA,3) S ^(3)="1^"_$G(XMZ)_U_+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON
"RTN","ORWDXA",133,0)
 D KILL^XM,MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",134,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; Last Activity
"RTN","ORWDXA",135,0)
 I +$G(ORNP)<1 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",136,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^1" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",137,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",138,0)
 Q
"RTN","ORWDXA",139,0)
BULLETIN        ; Send flagged order bulletin (USED BY FLAG)
"RTN","ORWDXA",140,0)
 N OR0,OR3,ORDTXT,XMB,XMY,XMDUZ,ORENT,BULL,ORSRV,ORUSR
"RTN","ORWDXA",141,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORWDXA",142,0)
 ;CLA - 3/21/96:
"RTN","ORWDXA",143,0)
 S ORUSR=+$P(OR0,U,4)
"RTN","ORWDXA",144,0)
 S ORSRV=$G(^VA(200,ORUSR,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWDXA",145,0)
 S ORENT="USR.`"_ORUSR_"^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG"
"RTN","ORWDXA",146,0)
 S BULL=$$GET^XPAR(ORENT,"ORB FLAGGED ORDERS BULLETIN",1,"Q")
"RTN","ORWDXA",147,0)
 Q:$G(BULL)'="Y"   ;quit if parameter value is not 'Y'es
"RTN","ORWDXA",148,0)
 ;
"RTN","ORWDXA",149,0)
 S XMB="OR FLAGGED ORDER",XMDUZ=DUZ,XMY(+$P(OR0,U,4))=""
"RTN","ORWDXA",150,0)
 S XMB(1)=$P(^DPT(+$P(OR0,U,2),0),U),XMB(2)=$P(^(0),U,9),XMB(3)="" ;sb AGE
"RTN","ORWDXA",151,0)
 S XMB(4)=$$FMTE^XLFDT($P(OR0,U,7))
"RTN","ORWDXA",152,0)
 D TEXT^ORQ12(.ORDTXT,+ORIFN,80)
"RTN","ORWDXA",153,0)
 S XMB(5)=$G(ORDTXT(1)),XMB(6)=$G(ORDTXT(2)),XMB(7)=$G(ORDTXT(3))
"RTN","ORWDXA",154,0)
 S XMB(8)=$$FMTE^XLFDT($P(OR0,U,8)),XMB(9)=$$FMTE^XLFDT($P(OR0,U,9)),XMB(10)=OREASON
"RTN","ORWDXA",155,0)
 S XMB(11)=$P($G(^ORD(100.01,+$P(OR3,U,3),0)),U)
"RTN","ORWDXA",156,0)
 D EN^XMB
"RTN","ORWDXA",157,0)
 Q
"RTN","ORWDXA",158,0)
UNFLAG(REC,ORIFN,OREASON)       ; Unflag an order
"RTN","ORWDXA",159,0)
 N DA,ORB,ORNP,ORVP,ORPS
"RTN","ORWDXA",160,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",161,0)
 S $P(^OR(100,+ORIFN,8,DA,3),U)=0,$P(^(3),U,6,8)=+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON D MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",162,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT  ; Last Activity
"RTN","ORWDXA",163,0)
 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",164,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^0" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",165,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",166,0)
 Q
"RTN","ORWDXA",167,0)
FLAGTXT(LST,ORID)      ; Return flag reason
"RTN","ORWDXA",168,0)
 N FLAG
"RTN","ORWDXA",169,0)
 S FLAG=$G(^OR(100,+ORID,8,$P(ORID,";",2),3))
"RTN","ORWDXA",170,0)
 S LST(1)="FLAGGED: "_$$FMTE^XLFDT($P(FLAG,U,3))_" by "_$P($G(^VA(200,+$P(FLAG,U,4),0)),U)
"RTN","ORWDXA",171,0)
 S LST(2)=$P(FLAG,U,5) ; reason
"RTN","ORWDXA",172,0)
 Q
"RTN","ORWDXA",173,0)
WCGET(LST,ORID) ; Return ward comments
"RTN","ORWDXA",174,0)
 N I,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",175,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,8,ACT,5,I)) Q:'I  S LST(I)=$G(^(I,0))
"RTN","ORWDXA",176,0)
 Q
"RTN","ORWDXA",177,0)
WCPUT(ERR,ORID,WCLST) ; Set ward comments for order
"RTN","ORWDXA",178,0)
 N DIERR,ERRLST,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",179,0)
 D WP^DIE(100.008,ACT_","_ORIFN_",",50,"","WCLST","ERRLST")
"RTN","ORWDXA",180,0)
 S ERR="" I $D(DIERR) S ERR="An error occurred while saving comments."
"RTN","ORWDXA",181,0)
 Q
"RTN","ORWDXC")
0^82^B20447328
"RTN","ORWDXC",1,0)
ORWDXC ; SLC/KCM - Utilities for Order Checking
"RTN","ORWDXC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,141**;Dec 17, 1997
"RTN","ORWDXC",3,0)
 ;
"RTN","ORWDXC",4,0)
ON(VAL) ; returns E if order checking enabled, otherwise D
"RTN","ORWDXC",5,0)
 S VAL=$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE")
"RTN","ORWDXC",6,0)
 Q
"RTN","ORWDXC",7,0)
FILLID(VAL,DLG) ; Return the FillerID (namespace) for a dialog
"RTN","ORWDXC",8,0)
 N DGRP
"RTN","ORWDXC",9,0)
 S VAL="",DGRP=$P($G(^ORD(101.41,DLG,0)),U,5) Q:'DGRP
"RTN","ORWDXC",10,0)
 S DLG=$$DEFDLG^ORWDXQ(DGRP)
"RTN","ORWDXC",11,0)
 S VAL=$P($G(^ORD(101.41,DLG,0)),U,7),VAL=$$NMSP^ORCD(VAL)
"RTN","ORWDXC",12,0)
 I VAL="PS" D
"RTN","ORWDXC",13,0)
 . N X
"RTN","ORWDXC",14,0)
 . S X=$P($P($G(^ORD(100.98,DGRP,0)),U,3)," ")
"RTN","ORWDXC",15,0)
 . I $L(X) S VAL="PS"_$S(X="UD":"I",1:X)
"RTN","ORWDXC",16,0)
 Q
"RTN","ORWDXC",17,0)
DISPLAY(LST,DFN,FID) ; Return list of Order Checks for a FillerID (namespace)
"RTN","ORWDXC",18,0)
 N I,ORX,ORY
"RTN","ORWDXC",19,0)
 S ORX=1,ORX(1)="|"_FID
"RTN","ORWDXC",20,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"DISPLAY")
"RTN","ORWDXC",21,0)
 S I=0 F  S I=$O(ORY(I)) Q:I'>0  S LST(I)=$P(ORY(I),U,4)
"RTN","ORWDXC",22,0)
 Q
"RTN","ORWDXC",23,0)
ACCEPT(LST,DFN,FID,STRT,ORL,OIL,ORIFN)    ; Return list of Order Checks on Accept Order
"RTN","ORWDXC",24,0)
 ; OIL(n)=OIptr^PS|PSIV|LR^PkgInfo
"RTN","ORWDXC",25,0)
 N X,Y,USID,ORCHECK,ORI,ORX,ORY
"RTN","ORWDXC",26,0)
 ; convert relative start date to real start date
"RTN","ORWDXC",27,0)
 S ORL=ORL_";SC(",X=STRT,STRT=""
"RTN","ORWDXC",28,0)
 D:X="AM" AM^ORCSAVE2 D:X="NEXT" NEXT^ORCSAVE2
"RTN","ORWDXC",29,0)
 I $L(X) S %DT="FTX" D ^%DT S:Y'>0 Y="" S STRT=Y
"RTN","ORWDXC",30,0)
 ; do the SELECT order checks
"RTN","ORWDXC",31,0)
 S ORI=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",32,0)
 . S USID=$$USID(OIL(ORI))
"RTN","ORWDXC",33,0)
 . S OIL(ORI,"USID")=USID
"RTN","ORWDXC",34,0)
 . S ORX=1,ORX(1)=+OIL(ORI)_"|"_FID_"|"_USID
"RTN","ORWDXC",35,0)
 . D EN^ORKCHK(.ORY,DFN,.ORX,"SELECT")
"RTN","ORWDXC",36,0)
 . I $D(ORY) D RETURN^ORCHECK ; expects ORY, ORCHECK
"RTN","ORWDXC",37,0)
 . K ORX,ORY
"RTN","ORWDXC",38,0)
 ; do the ACCEPT order checks
"RTN","ORWDXC",39,0)
 S (ORI,ORX)=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",40,0)
 . S ORX=ORX+1
"RTN","ORWDXC",41,0)
 . S ORX(ORX)=+OIL(ORI)_"|"_FID_"|"_OIL(ORI,"USID")_"|"_STRT
"RTN","ORWDXC",42,0)
 . I $P(OIL(ORI),U,2)="LR" S $P(ORX(ORX),"|",6)=$P(OIL(ORI),U,3)
"RTN","ORWDXC",43,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"ACCEPT")
"RTN","ORWDXC",44,0)
 I $D(ORY) D RETURN^ORCHECK   ; expects ORY, ORCHECK
"RTN","ORWDXC",45,0)
 ; return ORCHECK as 1 dimensional list
"RTN","ORWDXC",46,0)
 D CHK2LST
"RTN","ORWDXC",47,0)
 Q
"RTN","ORWDXC",48,0)
DELAY(LST,DFN,FID,STRT,ORL,OIL) ; Return list of Order Checks on Accept Delayed
"RTN","ORWDXC",49,0)
 ; OIL(n)=OIptr^PS|PSIV|LR^PkgInfo
"RTN","ORWDXC",50,0)
 N X,Y,ORCHECK,ORI,ORX,ORY
"RTN","ORWDXC",51,0)
 ; convert relative start date to real start date
"RTN","ORWDXC",52,0)
 S ORL=ORL_";SC(",X=STRT,STRT=""
"RTN","ORWDXC",53,0)
 D:X="AM" AM^ORCSAVE2 D:X="NEXT" NEXT^ORCSAVE2
"RTN","ORWDXC",54,0)
 I $L(X) S %DT="FTX" D ^%DT S:Y'>0 Y="" S STRT=Y
"RTN","ORWDXC",55,0)
 ; do the ACCEPT order checks
"RTN","ORWDXC",56,0)
 S (ORI,ORX)=0 F  S ORI=$O(OIL(ORI)) Q:'ORI  D
"RTN","ORWDXC",57,0)
 . S ORX=ORX+1
"RTN","ORWDXC",58,0)
 . S ORX(ORX)=+OIL(ORI)_"|"_FID_"|"_$$USID(OIL(ORI))_"|"_STRT
"RTN","ORWDXC",59,0)
 . I $P(OIL(ORI),U,2)="LR" S $P(ORX(ORX),"|",6)=$P(OIL(ORI),U,3)
"RTN","ORWDXC",60,0)
 D EN^ORKCHK(.ORY,DFN,.ORX,"ALL")
"RTN","ORWDXC",61,0)
 I $D(ORY) D RETURN^ORCHECK   ; expects ORY, ORCHECK
"RTN","ORWDXC",62,0)
 ; return ORCHECK as 1 dimensional list
"RTN","ORWDXC",63,0)
 D CHK2LST
"RTN","ORWDXC",64,0)
 Q
"RTN","ORWDXC",65,0)
SESSION(LST,ORVP,ORLST)  ; Return list of Order Checks on Release Order
"RTN","ORWDXC",66,0)
 N ORES,ORCHECK
"RTN","ORWDXC",67,0)
 S ORVP=+ORVP_";DPT("
"RTN","ORWDXC",68,0)
 S I=0 F  S I=$O(ORLST(I)) Q:'I  D
"RTN","ORWDXC",69,0)
 . I +$P(ORLST(I),";",2)'=1 Q  ; order not new
"RTN","ORWDXC",70,0)
 . I $P(ORLST(I),U,3)="0" Q    ; order not being released
"RTN","ORWDXC",71,0)
 . S ORES($P(ORLST(I),U))=""
"RTN","ORWDXC",72,0)
 D SESSION^ORCHECK
"RTN","ORWDXC",73,0)
 D CHK2LST
"RTN","ORWDXC",74,0)
 Q
"RTN","ORWDXC",75,0)
SAVECHK(OK,ORVP,RSN,LST)    ; Save order checks for session
"RTN","ORWDXC",76,0)
 N ORCHECK,ORIFN S OK=1
"RTN","ORWDXC",77,0)
 D LST2CHK
"RTN","ORWDXC",78,0)
 I $L(RSN)>0 S ORCHECK("OK")=RSN
"RTN","ORWDXC",79,0)
 S ORIFN=0 F  S ORIFN=$O(ORCHECK(ORIFN)) Q:'ORIFN  D OC^ORCSAVE2
"RTN","ORWDXC",80,0)
 Q
"RTN","ORWDXC",81,0)
DELORD(OK,ORIFN)      ; Delete order
"RTN","ORWDXC",82,0)
 N STS,DIK,DA
"RTN","ORWDXC",83,0)
 S STS=$P(^OR(100,+ORIFN,8,1,0),U,15),OK=0
"RTN","ORWDXC",84,0)
 I (STS=10)!(STS=11) D  Q  ; makes sure it's an unreleased order
"RTN","ORWDXC",85,0)
 . S DA=+ORIFN,DIK="^OR(100," Q:'DA
"RTN","ORWDXC",86,0)
 . D ^DIK
"RTN","ORWDXC",87,0)
 . S OK=1
"RTN","ORWDXC",88,0)
 Q
"RTN","ORWDXC",89,0)
USID(ORITMX) ; Return universal svc ID for an orderable item
"RTN","ORWDXC",90,0)
 ; ORITMX = OI^NMSP^PKGINFO
"RTN","ORWDXC",91,0)
 N RSLT,ORDRUG S RSLT=""
"RTN","ORWDXC",92,0)
 I $E($P(ORITMX,U,2),1,2)="PS" D
"RTN","ORWDXC",93,0)
 . I $P(ORITMX,U,2)="PSIV" D
"RTN","ORWDXC",94,0)
 . . N PSOI,TYPE,VOL S VOL=""
"RTN","ORWDXC",95,0)
 . . S PSOI=+$P($G(^ORD(101.43,+ORITMX,0)),U,2)
"RTN","ORWDXC",96,0)
 . . S TYPE=$P($P(ORITMX,U,3),";")
"RTN","ORWDXC",97,0)
 . . I TYPE="B" S VOL=$P($P(ORITMX,U,3),";",2)
"RTN","ORWDXC",98,0)
 . . D ENDDIV^PSJORUTL(PSOI,TYPE,VOL,.ORDRUG)
"RTN","ORWDXC",99,0)
 . . S ORDRUG=+ORDRUG
"RTN","ORWDXC",100,0)
 . E  S ORDRUG=+$P(ORITMX,U,3)
"RTN","ORWDXC",101,0)
 . S RSLT=$$ENDCM^PSJORUTL(ORDRUG)
"RTN","ORWDXC",102,0)
 . S RSLT=$P(RSLT,U,3)_"^^99NDF^"_ORDRUG_U_$P($G(^PSDRUG(ORDRUG,0)),U)_"^99PSD"
"RTN","ORWDXC",103,0)
 E  S RSLT=$$USID^ORMBLD(+ORITMX)
"RTN","ORWDXC",104,0)
 I +$P(RSLT,U)=0,+($P(RSLT,U,4)=0) S RSLT="" ; has to be null (why?) 
"RTN","ORWDXC",105,0)
 Q RSLT
"RTN","ORWDXC",106,0)
 ;
"RTN","ORWDXC",107,0)
CHK2LST ; creates list that can be passed to broker from ORCHECK array
"RTN","ORWDXC",108,0)
 ; expects ORCHECK to be present and populates LST
"RTN","ORWDXC",109,0)
 N ORIFN,ORID,CDL,I,ILST S ILST=0
"RTN","ORWDXC",110,0)
 S ORIFN="" F  S ORIFN=$O(ORCHECK(ORIFN)) Q:ORIFN=""  D
"RTN","ORWDXC",111,0)
 . S CDL=0 F  S CDL=$O(ORCHECK(ORIFN,CDL)) Q:'CDL  D
"RTN","ORWDXC",112,0)
 . . S I=0 F  S I=$O(ORCHECK(ORIFN,CDL,I)) Q:'I  D
"RTN","ORWDXC",113,0)
 . . . S ORID=ORIFN I +ORID,(+ORID=ORID) S ORID=ORID_";1"
"RTN","ORWDXC",114,0)
 . . . I '$P(ORCHECK(ORIFN,CDL,I),U,2) Q  ; CDL="" means don't show
"RTN","ORWDXC",115,0)
 . . . S ILST=ILST+1,LST(ILST)=ORID_U_ORCHECK(ORIFN,CDL,I)
"RTN","ORWDXC",116,0)
 Q
"RTN","ORWDXC",117,0)
LST2CHK ; create ORCHECK array from list passed by broker
"RTN","ORWDXC",118,0)
 N ORIFN,CDL,I,ILST S I=0
"RTN","ORWDXC",119,0)
 S ILST=0 F  S ILST=$O(LST(ILST)) Q:'ILST  D
"RTN","ORWDXC",120,0)
 . S X=LST(ILST)
"RTN","ORWDXC",121,0)
 . S ORIFN=$P(X,U),CDL=$P(X,U,3),I=I+1
"RTN","ORWDXC",122,0)
 . S ORCHECK(+ORIFN,CDL,I)=$P(X,U,2,4)
"RTN","ORWDXC",123,0)
 Q
"RTN","ORWDXM1")
0^43^B68134137
"RTN","ORWDXM1",1,0)
ORWDXM1 ; SLC/KCM/JLI - Order Dialogs, Menus;7/12/02  11:54 ;8/30/02  14:38
"RTN","ORWDXM1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,131,132,141**;Dec 17, 1997
"RTN","ORWDXM1",3,0)
BLDQRSP(LST,ORIT,FLDS) ; Build responses for an order
"RTN","ORWDXM1",4,0)
 ; LST=QuickLevel^ResponseID(ORIT;$H)^Dialog^Type^FormID^DGrp
"RTN","ORWDXM1",5,0)
 ; LST(n)=verify text or rejection text
"RTN","ORWDXM1",6,0)
 ; ORIT= ptr to 101.41 for quick order, 100 for copy
"RTN","ORWDXM1",7,0)
 ;       1   2    3    4   5   6    7    8        11-20
"RTN","ORWDXM1",8,0)
 ; FLDS=DFN^LOC^ORNP^INPT^SEX^AGE^EVENT^SC%^^^Key Variables...
"RTN","ORWDXM1",9,0)
 ; ORIT=+ORIT: ptr to 101.41, $E(ORIT)=C: copy $E(ORIT)=X: change
"RTN","ORWDXM1",10,0)
 ; !! SHOULD ALSO CHECK for PRE-CPRS ORDERS (treat as text?)
"RTN","ORWDXM1",11,0)
 K ^TMP("ORWDXMQ",$J)
"RTN","ORWDXM1",12,0)
 N ORWMODE ; 0:Dialog,Quick 1:copy order 2:change order
"RTN","ORWDXM1",13,0)
 N TEMPCAT ; patient category from DPT file
"RTN","ORWDXM1",14,0)
 N ISXFER ; If it is transfer order   
"RTN","ORWDXM1",15,0)
 S ORWMODE=0,ISXFER=""
"RTN","ORWDXM1",16,0)
 S:$E(ORIT)="C" ORWMODE=1 S:$E(ORIT)="T" ORWMODE=1,ISXFER=";T" ;treat xfer as copy for now
"RTN","ORWDXM1",17,0)
 S:$E(ORIT)="X" ORWMODE=2
"RTN","ORWDXM1",18,0)
 I ORWMODE S ORIT=$E(ORIT,2,999)
"RTN","ORWDXM1",19,0)
 S LST(0)=""
"RTN","ORWDXM1",20,0)
 D CHKDSBL^ORWDXM3(.LST,ORIT,ORWMODE) Q:+LST(0)=8  ;disable
"RTN","ORWDXM1",21,0)
 D CHKVACT^ORWDXM3(.LST,ORIT,ORWMODE,$P(FLDS,U,3)) Q:+LST(0)=8  ;action
"RTN","ORWDXM1",22,0)
 I ORWMODE=1 D CHKCOPY^ORWDXM3(.LST,ORIT,FLDS) Q:+LST(0)=8  ;no copy
"RTN","ORWDXM1",23,0)
 I ORWMODE=2 D BLD4CHG^ORWDXM3(.LST,ORIT,FLDS) Q  ;change
"RTN","ORWDXM1",24,0)
 ;only continue past here if copy, quick order, or generic order
"RTN","ORWDXM1",25,0)
 I 'ORWMODE,($P(^ORD(101.41,+ORIT,0),U,4)="D"),'($O(^DIC(9.4,"C","OR",0))[$P(^ORD(101.41,+ORIT,0),U,7)) S LST(0)="0^0^"_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER) Q
"RTN","ORWDXM1",26,0)
 ;radilogy specific variables
"RTN","ORWDXM1",27,0)
 N ORIMTYPE
"RTN","ORWDXM1",28,0)
 ;lab specific variables
"RTN","ORWDXM1",29,0)
 N LRFZX,LRFSAMP,LRFSPEC,LRFDATE,LRFURG,LRFSCH
"RTN","ORWDXM1",30,0)
 N ORTIME,ORCOLLCT,ORMAX,ORTEST,ORIMTIME,ORSMAX,ORSTMS,ORSCH
"RTN","ORWDXM1",31,0)
 ;pharmacy specific variables
"RTN","ORWDXM1",32,0)
 N PSJNOPC,ORMORE,ORINPT,ORXNP,ORSCHED,ORQTY,ORNOUNS,ORXNP,OREFILLS
"RTN","ORWDXM1",33,0)
 N ORCOMPLX,ORQTY,ORCOPAY,ORDRUG,ORWPSPIK,ORWPSWRG,ORSD,ORDSUP,ORWP94
"RTN","ORWDXM1",34,0)
 ;dietetics specific variables
"RTN","ORWDXM1",35,0)
 N ORPARAM,ORNPO,ORTIME,ORMEAL,ORTRAY,ORDATE
"RTN","ORWDXM1",36,0)
 ;consults specific variables
"RTN","ORWDXM1",37,0)
 N GMRCNOPD,GMRCNOAT,GMRCREAF
"RTN","ORWDXM1",38,0)
 ; -- setup general environment
"RTN","ORWDXM1",39,0)
 N ORTYPE,ORVP,ORL,ORNP,ORSEX,ORAGE,ORWARD,OREVENT,ORDIV,ORSC,KEYVAR
"RTN","ORWDXM1",40,0)
 N ORDG,ORDIALOG,ORCAT,FIRST,ORQUIT,X,ORTRAIL,ORLEAD,RSPREF,AUTOACK
"RTN","ORWDXM1",41,0)
 N OREVNTYP
"RTN","ORWDXM1",42,0)
 S ORWP94=$O(^ORD(101.41,"AB","PS MEDS",0))>0
"RTN","ORWDXM1",43,0)
 S ORVP=$P(FLDS,U,1)_";DPT(",ORNP=+$P(FLDS,U,3),ORSC=$P(FLDS,U,8)
"RTN","ORWDXM1",44,0)
 S ORL=$P(FLDS,U,2)_";SC(",ORL(2)=ORL
"RTN","ORWDXM1",45,0)
 S ORSEX=$P(FLDS,U,5),ORAGE=$P(FLDS,U,6),ORTYPE="Q",FIRST=1
"RTN","ORWDXM1",46,0)
 I $P(FLDS,U,4),$G(^SC(+ORL,42)) S ORWARD=+^SC(+ORL,42)
"RTN","ORWDXM1",47,0)
 I $L($P(FLDS,U,7))  D
"RTN","ORWDXM1",48,0)
 . S OREVENT=$P(FLDS,U,7)
"RTN","ORWDXM1",49,0)
 . S OREVNTYP=$P(OREVENT,";",2)
"RTN","ORWDXM1",50,0)
 . S OREVENT("TS")=$P(OREVENT,";",3)
"RTN","ORWDXM1",51,0)
 . S OREVENT("EFFECTIVE")=$P(OREVENT,";",4)
"RTN","ORWDXM1",52,0)
 . S OREVENT=+$P(OREVENT,";",1)
"RTN","ORWDXM1",53,0)
 I 'ORWMODE D
"RTN","ORWDXM1",54,0)
 . D SETKEYV^ORWDXM3($P(FLDS,U,11,20)) ; from menu path
"RTN","ORWDXM1",55,0)
 . S KEYVAR=$$KEYVAR^ORWDXM3(ORIT) ; from entry action
"RTN","ORWDXM1",56,0)
 . D SETKEYV^ORWDXM3(KEYVAR)
"RTN","ORWDXM1",57,0)
 K ^TMP("ORWORD",$J)
"RTN","ORWDXM1",58,0)
 ; -- initialize return record based on auto-accept
"RTN","ORWDXM1",59,0)
 I ORWMODE S LST(0)="2^"_ORIT ;verify on copy 
"RTN","ORWDXM1",60,0)
 E  S LST(0)=+$P($G(^ORD(101.41,ORIT,5)),U,8)_U_ORIT
"RTN","ORWDXM1",61,0)
 S TEMPCAT=$S($L($P($G(^DPT(+ORVP,.1)),U)):"I",1:"O")
"RTN","ORWDXM1",62,0)
 I $L($G(OREVNTYP)) D
"RTN","ORWDXM1",63,0)
 . S ORCAT=$S(OREVNTYP="A":"I",OREVNTYP="T":"I",OREVNTYP="O":TEMPCAT,OREVNTYP="M":TEMPCAT,OREVNTYP="C":TEMPCAT,1:"O") I $G(OREVENT) D
"RTN","ORWDXM1",64,0)
 .. N X S X=$$EVT^OREVNTX(OREVENT),X=$P($G(^ORD(100.5,+X,0)),U,7)
"RTN","ORWDXM1",65,0)
 .. I OREVNTYP="T",X,X<4 S ORCAT="O" ;To pass=outpt
"RTN","ORWDXM1",66,0)
 .. I OREVNTYP="D",X=41 S ORCAT="I" ;From ASIH=inpt
"RTN","ORWDXM1",67,0)
 E  S ORCAT=TEMPCAT
"RTN","ORWDXM1",68,0)
 D SETUP^ORWDXM4 Q:+LST(0)=8
"RTN","ORWDXM1",69,0)
 S X=$S($G(ORWP94):"OR GTX START DATE/TIME",1:"OR GTX START DATE")
"RTN","ORWDXM1",70,0)
 I ORWMODE,(ORDG=+$O(^ORD(100.98,"B","O RX",0))) K ORDIALOG($$PTR^ORCD(X),1)
"RTN","ORWDXM1",71,0)
 ;    pharmacy uses ORCAT to know which package the order goes to
"RTN","ORWDXM1",72,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO OERR",0)) S ORCAT="O"
"RTN","ORWDXM1",73,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)) D
"RTN","ORWDXM1",74,0)
 . I ORCAT="O" S ORWPSWRG="" ; not auto-ack, pt not inpt
"RTN","ORWDXM1",75,0)
 . S ORCAT="I"
"RTN","ORWDXM1",76,0)
 I ORCAT="O",$D(OREVENT("EFFECTIVE")),(ORDG=+$O(^ORD(100.98,"B","O RX",0))) D
"RTN","ORWDXM1",77,0)
 . S ORDIALOG($O(^ORD(101.41,"B",X,0)),1)=OREVENT("EFFECTIVE")
"RTN","ORWDXM1",78,0)
 I ORDIALOG=$O(^ORD(101.41,"B","RA OERR EXAM",0))         D RA^ORWDXM2 G XENV
"RTN","ORWDXM1",79,0)
 I ORDIALOG=$O(^ORD(101.41,"B","LR OTHER LAB TESTS",0))   D LR^ORWDXM2 G XENV
"RTN","ORWDXM1",80,0)
 I ORDIALOG=$O(^ORD(101.41,"B","FHW1",0))                 D DO^ORWDXM2 G XENV
"RTN","ORWDXM1",81,0)
 I ORDIALOG=$O(^ORD(101.41,"B","FHW2",0))                 D EL^ORWDXM2 G XENV
"RTN","ORWDXM1",82,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJ OR PAT OE",0))        D UD^ORWDXM2 G XENV
"RTN","ORWDXM1",83,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0)) D IV^ORWDXM2 G XENV
"RTN","ORWDXM1",84,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO OERR",0))             D OP^ORWDXM2 G XENV
"RTN","ORWDXM1",85,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PSO SUPPLY",0))           D OP^ORWDXM2 G XENV
"RTN","ORWDXM1",86,0)
 I ORDIALOG=$O(^ORD(101.41,"B","PS MEDS",0))              D PS^ORWDPS3 G XENV
"RTN","ORWDXM1",87,0)
 I ORDIALOG=$O(^ORD(101.41,"B","GMRAOR ALLERGY ENTER/EDIT",0)) S ORQUIT=1
"RTN","ORWDXM1",88,0)
XENV ;    end case
"RTN","ORWDXM1",89,0)
 Q:+LST(0)=8
"RTN","ORWDXM1",90,0)
 I $G(ORQUIT) S LST(0)="0^0^"_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER)_"^"_$G(KEYVAR) Q
"RTN","ORWDXM1",91,0)
 N SEQ,DA,XCODE,MUSTASK,PROMPT,INST,KEY,IVFID
"RTN","ORWDXM1",92,0)
 S IVFID=$O(^ORD(101.41,"B","PSJI OR PAT FLUID OE",0))
"RTN","ORWDXM1",93,0)
 S AUTOACK=$S($D(ORWPSWRG):0,1:1)
"RTN","ORWDXM1",94,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:'SEQ  D
"RTN","ORWDXM1",95,0)
 . S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORWDXM1",96,0)
 . . ; -- skip if this is a child prompt
"RTN","ORWDXM1",97,0)
 . . I $P(^ORD(101.41,+ORDIALOG,10,DA,0),U,11) Q
"RTN","ORWDXM1",98,0)
 . . ; -- set default for prompt, see if needs to be interactive
"RTN","ORWDXM1",99,0)
 . . S PROMPT=$P(^ORD(101.41,+ORDIALOG,10,DA,0),U,2)
"RTN","ORWDXM1",100,0)
 . . D SETITEM(DA,PROMPT,1,.MUSTASK)
"RTN","ORWDXM1",101,0)
 . . I MUSTASK S AUTOACK=0 Q
"RTN","ORWDXM1",102,0)
 . . ; -- iterate through the child items if parent and editonly
"RTN","ORWDXM1",103,0)
 . . Q:'$D(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT))
"RTN","ORWDXM1",104,0)
 . . N CSEQ,CDA,CPROMPT,INST,ORQUIT
"RTN","ORWDXM1",105,0)
 . . S CSEQ=0 F  S CSEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,CSEQ)) Q:'CSEQ  D  Q:$G(ORQUIT)
"RTN","ORWDXM1",106,0)
 . . . S CDA=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PROMPT,CSEQ,0))
"RTN","ORWDXM1",107,0)
 . . . S CPROMPT=$P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,2)
"RTN","ORWDXM1",108,0)
 . . . ; -- if required and no instances then need interaction
"RTN","ORWDXM1",109,0)
 . . . I $P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,6),ORDIALOG'=IVFID,'$O(ORDIALOG(CPROMPT,0)) S AUTOACK=0
"RTN","ORWDXM1",110,0)
 . . . S INST=0 F  S INST=$O(ORDIALOG(CPROMPT,INST)) Q:'INST  D
"RTN","ORWDXM1",111,0)
 . . . . ; -- set default for each child prompt, if necessary
"RTN","ORWDXM1",112,0)
 . . . . D SETITEM(CDA,CPROMPT,INST,.MUSTASK)
"RTN","ORWDXM1",113,0)
 . . . . ; -- if no val and child prmpt required then need interaction
"RTN","ORWDXM1",114,0)
 . . . . I MUSTASK,$P(^ORD(101.41,+ORDIALOG,10,CDA,0),U,6) S AUTOACK=0
"RTN","ORWDXM1",115,0)
 S KEY=$S(ORWMODE:"C",1:"")_ORIT_"-"_$P($H,",",2),SEQ=0
"RTN","ORWDXM1",116,0)
 S PROMPT=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:'PROMPT  D
"RTN","ORWDXM1",117,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D
"RTN","ORWDXM1",118,0)
 . . S SEQ=SEQ+1,^TMP("ORWDXMQ",$J,KEY,SEQ,0)=U_PROMPT_U_INST
"RTN","ORWDXM1",119,0)
 . . ; -- save word processing value
"RTN","ORWDXM1",120,0)
 . . I $E(ORDIALOG(PROMPT,0))="W",$L(ORDIALOG(PROMPT,INST)) D
"RTN","ORWDXM1",121,0)
 . . .  M ^TMP("ORWDXMQ",$J,KEY,SEQ,2)=@ORDIALOG(PROMPT,INST)
"RTN","ORWDXM1",122,0)
 . . ; -- save other types of values
"RTN","ORWDXM1",123,0)
 . . E  S ^TMP("ORWDXMQ",$J,KEY,SEQ,1)=ORDIALOG(PROMPT,INST)
"RTN","ORWDXM1",124,0)
 I AUTOACK D
"RTN","ORWDXM1",125,0)
 . I ORWMODE S AUTOACK=2
"RTN","ORWDXM1",126,0)
 . I 'ORWMODE,($P(^ORD(101.41,ORIT,0),U,8)!'LST(0)) S AUTOACK=2
"RTN","ORWDXM1",127,0)
 ;JD new line COPY/TRANSFER Out->In for event delay
"RTN","ORWDXM1",128,0)
 I $L($G(OREVNTYP)) D
"RTN","ORWDXM1",129,0)
 . I ('AUTOACK),("A,O,T,M"[OREVNTYP),($$MEDORDER(ORIT)) S AUTOACK=2
"RTN","ORWDXM1",130,0)
 I AUTOACK=2 D VERTXT^ORWDXM2
"RTN","ORWDXM1",131,0)
 S LST(0)=AUTOACK_U_KEY_U_$$DLGINFO^ORWDXM3(ORIT,ORWMODE_ISXFER)_"^"_$G(KEYVAR)
"RTN","ORWDXM1",132,0)
 I $P(LST(0),U,4)="D" S $P(LST(0),U,4)="Q"
"RTN","ORWDXM1",133,0)
 I ORWMODE=1 S $P(LST(0),U,4)="C"
"RTN","ORWDXM1",134,0)
 K ^TMP("ORWORD",$J)
"RTN","ORWDXM1",135,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J)
"RTN","ORWDXM1",136,0)
 Q
"RTN","ORWDXM1",137,0)
SETITEM(DA,PROMPT,INST,MUSTASK) ; set default value & return if must prompt
"RTN","ORWDXM1",138,0)
 N EDITONLY,Y,XCODE
"RTN","ORWDXM1",139,0)
 S MUSTASK=0,EDITONLY=0 ;,PROMPT=$P(^ORD(101.41,+ORDIALOG,10,DA,0),U,2)
"RTN","ORWDXM1",140,0)
 I $D(^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)) D
"RTN","ORWDXM1",141,0)
 . I $E(ORDIALOG(PROMPT,0))="W" D
"RTN","ORWDXM1",142,0)
 . . S ^TMP("ORWORD",$J,PROMPT,INST,1,0)=^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)
"RTN","ORWDXM1",143,0)
 . . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORWDXM1",144,0)
 . E  S ORDIALOG(PROMPT,INST)=^TMP("ORWDHTM",$J,ORDIALOG,PROMPT)
"RTN","ORWDXM1",145,0)
 I $D(^TMP("ORWDHTM",$J,ORIT,PROMPT)) D
"RTN","ORWDXM1",146,0)
 . S ORDIALOG(PROMPT,INST)=^TMP("ORWDHTM",$J,ORIT,PROMPT)
"RTN","ORWDXM1",147,0)
 . ; NEED TO CLEAN UP ^TMP("ORWDHTM") after processing order set!!!
"RTN","ORWDXM1",148,0)
 ;
"RTN","ORWDXM1",149,0)
 ; skip if a value already exists for this prompt and not WP
"RTN","ORWDXM1",150,0)
 Q:$D(ORDIALOG(PROMPT,INST))&($E(ORDIALOG(PROMPT,0))'="W")
"RTN","ORWDXM1",151,0)
 ; execute default action if no value in QO, checking EDITONLY afterwards
"RTN","ORWDXM1",152,0)
 I '$D(ORDIALOG(PROMPT,INST)) D
"RTN","ORWDXM1",153,0)
 . I $E(ORDIALOG(PROMPT,0))="W",$D(^ORD(101.41,+ORDIALOG,10,DA,8))>9 D
"RTN","ORWDXM1",154,0)
 . . M ^TMP("ORWORD",$J,PROMPT,INST)=^ORD(101.41,+ORDIALOG,10,DA,8)
"RTN","ORWDXM1",155,0)
 . . S ORDIALOG(PROMPT,INST)="^TMP(""ORWORD"","_$J_","_PROMPT_","_INST_")"
"RTN","ORWDXM1",156,0)
 . E  D
"RTN","ORWDXM1",157,0)
 . . S XCODE=$$SUBCODE($G(^ORD(101.41,+ORDIALOG,10,DA,7)))
"RTN","ORWDXM1",158,0)
 . . I $L(XCODE) X XCODE S:$D(Y) ORDIALOG(PROMPT,INST)=Y
"RTN","ORWDXM1",159,0)
 Q:$G(EDITONLY)
"RTN","ORWDXM1",160,0)
 I 'ORWMODE,$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,8) Q
"RTN","ORWDXM1",161,0)
 I ORWMODE,($P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,9)'["W"),'$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,6)!$D(ORDIALOG(PROMPT,INST)) Q
"RTN","ORWDXM1",162,0)
 I 'ORWMODE,LST(0),$D(ORDIALOG(PROMPT,INST)),($E(ORDIALOG(PROMPT,0))="W") Q
"RTN","ORWDXM1",163,0)
 I 'ORWMODE,LST(0),'$P($G(^ORD(101.41,+ORDIALOG,10,DA,0)),U,6) Q
"RTN","ORWDXM1",164,0)
 S XCODE=$$SUBCODE($G(^ORD(101.41,+ORDIALOG,10,DA,3)))
"RTN","ORWDXM1",165,0)
 I $L(XCODE) X XCODE Q:'$T
"RTN","ORWDXM1",166,0)
 S MUSTASK=1
"RTN","ORWDXM1",167,0)
 Q
"RTN","ORWDXM1",168,0)
SUBCODE(X)      ; substitute code
"RTN","ORWDXM1",169,0)
 I X["$$REQDCOMM^ORCDLR" Q "I $$LRRQCM^ORWDXM2"
"RTN","ORWDXM1",170,0)
 I X["$$ASKSAMP^ORCDLR" Q "I $$LRASMP^ORWDXM2"
"RTN","ORWDXM1",171,0)
 I X["$$SCHEDULD^ORCDRA1" Q "I $$SCHEDULD^ORWDXM2"
"RTN","ORWDXM1",172,0)
 I X["(^PSX(550,""C"")" Q "S Y=$E($$DEFPICK^ORWDPS32) K:'$L(Y) Y"
"RTN","ORWDXM1",173,0)
 Q X
"RTN","ORWDXM1",174,0)
MEDORDER(ORIT) ;is it a medication order
"RTN","ORWDXM1",175,0)
 N ISMED,INPTGRP,OUTPTGRP,MEDSGRP,ORTO
"RTN","ORWDXM1",176,0)
 S ISMED=0
"RTN","ORWDXM1",177,0)
 Q:'$D(^OR(100,+ORIT,0)) ISMED
"RTN","ORWDXM1",178,0)
 S ORTO=0
"RTN","ORWDXM1",179,0)
 S ORTO=$P(^OR(100,+ORIT,0),U,11)
"RTN","ORWDXM1",180,0)
 S INPTGRP=$O(^ORD(101.41,"B","PSJ OR PAT OE",0))
"RTN","ORWDXM1",181,0)
 S INPTGRP=$P(^ORD(101.41,INPTGRP,0),U,5)
"RTN","ORWDXM1",182,0)
 S OUTPTGRP=$O(^ORD(101.41,"B","PSO OERR",0))
"RTN","ORWDXM1",183,0)
 S OUTPTGRP=$P(^ORD(101.41,OUTPTGRP,0),U,5)
"RTN","ORWDXM1",184,0)
 S MEDSGRP=$O(^ORD(101.41,"B","PS MEDS",0))
"RTN","ORWDXM1",185,0)
 S MEDSGRP=$P(^ORD(101.41,MEDSGRP,0),U,5)
"RTN","ORWDXM1",186,0)
 I (ORTO=INPTGRP)!(ORTO=OUTPTGRP)!(ORTO=MEDSGRP) S ISMED=1
"RTN","ORWDXM1",187,0)
 Q ISMED
"RTN","ORWDXM3")
0^65^B26993740
"RTN","ORWDXM3",1,0)
ORWDXM3 ; SLC/KCM/JLI - Quick Orders ;10:42 AM 6/20/2002
"RTN","ORWDXM3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,131,132,141**;Dec 17, 1997
"RTN","ORWDXM3",3,0)
 ;
"RTN","ORWDXM3",4,0)
KEYVAR(DLG)  ; Parse entry action for key variables & return in string
"RTN","ORWDXM3",5,0)
 ; RV=CollTp^Samp^Spec^CollDt^Urg^Sched^NoComm^NoDiag^NoProv^NoRsn
"RTN","ORWDXM3",6,0)
 N XCODE,RV,POS,Z
"RTN","ORWDXM3",7,0)
 S XCODE=$G(^ORD(101.41,DLG,3)),RV=""
"RTN","ORWDXM3",8,0)
 I '$L(XCODE) Q ""
"RTN","ORWDXM3",9,0)
 S POS=$F(XCODE,"LRFZX=")    I POS S $P(RV,U,1)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",10,0)
 S POS=$F(XCODE,"LRFSAMP=")  I POS S $P(RV,U,2)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",11,0)
 S POS=$F(XCODE,"LRFSPEC=")  I POS S $P(RV,U,3)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",12,0)
 S POS=$F(XCODE,"LRFDATE=")  I POS S $P(RV,U,4)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",13,0)
 S POS=$F(XCODE,"LRFURG=")   I POS S $P(RV,U,5)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",14,0)
 S POS=$F(XCODE,"LRFSCH=")   I POS S $P(RV,U,6)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",15,0)
 S POS=$F(XCODE,"PSJNOPC=")  I POS S $P(RV,U,7)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",16,0)
 S POS=$F(XCODE,"GMRCNOPD=") I POS S $P(RV,U,8)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",17,0)
 S POS=$F(XCODE,"GMRCNOAT=") I POS S $P(RV,U,9)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",18,0)
 S POS=$F(XCODE,"GMRCREAF=") I POS S $P(RV,U,10)=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",19,0)
 S POS=$F(XCODE,"ORFORGET=") I POS D
"RTN","ORWDXM3",20,0)
 . ; need to change this so that it is executed in SETKEYV so
"RTN","ORWDXM3",21,0)
 . ; that it is executed each time menu is revisited
"RTN","ORWDXM3",22,0)
 . N ORFORGET S ORFORGET=$$VALUE(XCODE,POS)
"RTN","ORWDXM3",23,0)
 . I ORFORGET K ^TMP("ORECALL",$J,+ORFORGET)
"RTN","ORWDXM3",24,0)
 . E  K ^TMP("ORECALL",$J)
"RTN","ORWDXM3",25,0)
 Q RV
"RTN","ORWDXM3",26,0)
VALUE(STR,BEG) ; Return value of "var=" (copied from ORCONVRT)
"RTN","ORWDXM3",27,0)
 N X,Y,I S X=$E(STR,BEG,999),Y=""
"RTN","ORWDXM3",28,0)
 S:$E(X)="""" X=$E(X,2,999) ; strip leading "
"RTN","ORWDXM3",29,0)
 F I=1:1:$L(X) S Z=$E(X,I) Q:(Z=",")!(Z=" ")!(Z="""")  S Y=Y_Z
"RTN","ORWDXM3",30,0)
 Q $TR(Y,U,"")
"RTN","ORWDXM3",31,0)
 ;
"RTN","ORWDXM3",32,0)
SETKEYV(X)      ; Set the key variables based on contents of X
"RTN","ORWDXM3",33,0)
 I $L($P(X,U,1))  S LRFZX=$P(X,U,1)
"RTN","ORWDXM3",34,0)
 I $L($P(X,U,2))  S LRFSAMP=$P(X,U,2)
"RTN","ORWDXM3",35,0)
 I $L($P(X,U,3))  S LRFSPEC=$P(X,U,3)
"RTN","ORWDXM3",36,0)
 I $L($P(X,U,4))  S LRFDATE=$P(X,U,4)
"RTN","ORWDXM3",37,0)
 I $L($P(X,U,5))  S LRFURG=$P(X,U,5)
"RTN","ORWDXM3",38,0)
 I $L($P(X,U,6))  S LRFSCH=$P(X,U,6)
"RTN","ORWDXM3",39,0)
 I $L($P(X,U,7))  S PSJNOPC=$P(X,U,7)
"RTN","ORWDXM3",40,0)
 I $L($P(X,U,8))  S GMRCNOPD=$P(X,U,8)
"RTN","ORWDXM3",41,0)
 I $L($P(X,U,9))  S GMRCNOAT=$P(X,U,9)
"RTN","ORWDXM3",42,0)
 I $L($P(X,U,10)) S GMRCREAF=$P(X,U,10)
"RTN","ORWDXM3",43,0)
 Q
"RTN","ORWDXM3",44,0)
DLGINFO(IEN,MODE)    ; return information about a dialog
"RTN","ORWDXM3",45,0)
 ; IEN=DlgIEN or ORIFN, MODE=0:Dlg,1:Copy,2:Change
"RTN","ORWDXM3",46,0)
 ; RESULT=DlgIEN^DlgType^FormID^DGrp
"RTN","ORWDXM3",47,0)
 ; If MODE="1;T",don't check "PS MEDS" for transfer order
"RTN","ORWDXM3",48,0)
 ; PSMDGP=1: Unit/Dose  Group
"RTN","ORWDXM3",49,0)
 ; PSMDGP=2: OutPatient Group
"RTN","ORWDXM3",50,0)
 N X0,DLGIEN,TYP,FID,DGRP,PSMDGP,ISXF
"RTN","ORWDXM3",51,0)
 S PSMDGP=0,ISXF=""
"RTN","ORWDXM3",52,0)
 S ISXF=$P(MODE,";",2)
"RTN","ORWDXM3",53,0)
 S MODE=+MODE
"RTN","ORWDXM3",54,0)
 S DLGIEN=IEN I MODE,(ISXF'="T") D
"RTN","ORWDXM3",55,0)
 . S DLGIEN=+$P($G(^OR(100,+IEN,0)),U,5)
"RTN","ORWDXM3",56,0)
 . I $P(^ORD(101.41,DLGIEN,0),U)="PS MEDS" D
"RTN","ORWDXM3",57,0)
 . . N PTCAT S PTCAT=$P($G(^OR(100,+IEN,0)),U,12)
"RTN","ORWDXM3",58,0)
 . . I PTCAT="I" S DLGIEN=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)),PSMDGP=1
"RTN","ORWDXM3",59,0)
 . . I PTCAT="O" S DLGIEN=$O(^ORD(101.41,"B","PSO OERR",0)),PSMDGP=2
"RTN","ORWDXM3",60,0)
 I MODE,(ISXF="T") S DLGIEN=+$P($G(^OR(100,+IEN,0)),U,5)
"RTN","ORWDXM3",61,0)
 S X0=$G(^ORD(101.41,DLGIEN,0)),TYP=$P(X0,U,4),DGRP=$P(X0,U,5)
"RTN","ORWDXM3",62,0)
 I MODE S DGRP=+$P($G(^OR(100,+IEN,0)),U,11)
"RTN","ORWDXM3",63,0)
 ;JD NEW START 11/13/02
"RTN","ORWDXM3",64,0)
 I DLGIEN=$O(^ORD(101.41,"B","PSJ OR PAT OE",0)) S PSMDGP=1
"RTN","ORWDXM3",65,0)
 I DLGIEN=$O(^ORD(101.41,"B","PSO OERR",0)) S PSMDGP=2
"RTN","ORWDXM3",66,0)
 ;JD NEW END 11/13/02
"RTN","ORWDXM3",67,0)
 ; for copy or change, if the base dialog has changed, use it's info 
"RTN","ORWDXM3",68,0)
 I MODE,$G(ORDIALOG),(+DLGIEN'=+ORDIALOG),(PSMDGP=0) D
"RTN","ORWDXM3",69,0)
 . S DLGIEN=+ORDIALOG,DGRP=$P(^ORD(101.41,+ORDIALOG,0),U,5)
"RTN","ORWDXM3",70,0)
 D FORMID^ORWDXM(.FID,DLGIEN)
"RTN","ORWDXM3",71,0)
 Q DLGIEN_U_TYP_U_FID_U_DGRP
"RTN","ORWDXM3",72,0)
 ;
"RTN","ORWDXM3",73,0)
CHKDSBL(LST,ID,MODE)  ; return message if dialog disabled
"RTN","ORWDXM3",74,0)
 ; ID=DlgIEN or ORIFN, MODE=0:Dialog,1:Copy,2:Change
"RTN","ORWDXM3",75,0)
 ; LST=QL_REJECT + disabled message or unchanged
"RTN","ORWDXM3",76,0)
 S DLGIEN=+ID I MODE S DLGIEN=+$P($G(^OR(100,+ID,0)),U,5)
"RTN","ORWDXM3",77,0)
 S X0=$G(^ORD(101.41,DLGIEN,0)),X=$P(X0,U,3)
"RTN","ORWDXM3",78,0)
 I '$L(X),($P(X0,U,4)="Q") D  ; check default dialog
"RTN","ORWDXM3",79,0)
 . S DLGIEN=+$$DEFDLG^ORWDXQ($P(X0,U,5))
"RTN","ORWDXM3",80,0)
 . S X=$P($G(^ORD(101.41,DLGIEN,0)),U,3)
"RTN","ORWDXM3",81,0)
 I $L(X) D
"RTN","ORWDXM3",82,0)
 . I MODE D GETTXT^ORWORR(.LST,ID) S LST(.6)="",LST(.7)="Cannot "_$S(MODE=1:"Copy",1:"Change")_" -"
"RTN","ORWDXM3",83,0)
 . S LST(0)="8^0",LST(.5)="Dialog Disabled:  "_X
"RTN","ORWDXM3",84,0)
 Q
"RTN","ORWDXM3",85,0)
CHKVACT(LST,ID,MODE,ORNP)  ; return message if action not valid
"RTN","ORWDXM3",86,0)
 ; ID=DlgIEN or ORIFN, MODE=0:Dialog,1:Copy,2:Change
"RTN","ORWDXM3",87,0)
 ; LST=QL_REJECT + invalid action message or unchanged
"RTN","ORWDXM3",88,0)
 Q:'MODE  ; not an action on an order
"RTN","ORWDXM3",89,0)
 N X,ACT S ACT=$S(MODE=1:"RW",MODE=2:"XX",1:"")
"RTN","ORWDXM3",90,0)
 D VALID^ORWDXA(.X,ID,ACT,ORNP)
"RTN","ORWDXM3",91,0)
 I $L(X) D GETTXT^ORWORR(.LST,ID) D
"RTN","ORWDXM3",92,0)
 . S LST(0)="8^0",LST(.5)=X,LST(.6)="",LST(.7)="Cannot "_$S(MODE=1:"Copy",1:"Change")_" -"
"RTN","ORWDXM3",93,0)
 Q
"RTN","ORWDXM3",94,0)
CHKCOPY(LST,ID,FLDS)  ; return message if can't copy this order
"RTN","ORWDXM3",95,0)
 ; ID=ORIFN;ACT FLDS=EventType in 7th piece
"RTN","ORWDXM3",96,0)
 ; LST=QL_REJECT + cannot copy message or unchanged
"RTN","ORWDXM3",97,0)
 I "^A^D^T^"'[(U_$E($P(FLDS,U,7))_U) Q             ; not event delayed
"RTN","ORWDXM3",98,0)
 N PKG S PKG=$P($G(^OR(100,+ID,0)),U,14)
"RTN","ORWDXM3",99,0)
 S PKG=$$NMSP^ORCD(PKG) I PKG="OR"!(PKG="PS") Q    ; xfer meds, generics
"RTN","ORWDXM3",100,0)
 N ORWCAT S ORWCAT=$P($G(^OR(100,+ID,0)),U,12)
"RTN","ORWDXM3",101,0)
 I ORWCAT="I",("^A^T^"[(U_$E($P(FLDS,U,7))_U)) Q   ; admit, xfer inpt
"RTN","ORWDXM3",102,0)
 I ORWCAT="O",$E($P(FLDS,U,7))="D" Q               ; discharge outpt
"RTN","ORWDXM3",103,0)
 D GETTXT^ORWORR(.LST,ID)
"RTN","ORWDXM3",104,0)
 I ORWCAT="I" S LST(.5)="inpatient order to outpatient -"
"RTN","ORWDXM3",105,0)
 I ORWCAT="O" S LST(.5)="outpatient order to inpatient -"
"RTN","ORWDXM3",106,0)
 S:$D(LST(.5)) LST(.5)="Cannot copy the following "_LST(.5)
"RTN","ORWDXM3",107,0)
 S LST(0)="8^0",LST(.7)=""
"RTN","ORWDXM3",108,0)
 Q
"RTN","ORWDXM3",109,0)
BLD4CHG(LST,ID,FLDS)  ; build responses for an edit
"RTN","ORWDXM3",110,0)
 ; ID=ORIFN;ACT FLDS=unused right now
"RTN","ORWDXM3",111,0)
 ; LST(0)=Qlvl^RespID(XOrderID)^DlgIEN^DlgType^FormID^DGrp
"RTN","ORWDXM3",112,0)
 N OIDX,OI,CNT
"RTN","ORWDXM3",113,0)
 S (OI,OIDX,CNT)=0
"RTN","ORWDXM3",114,0)
 S:$D(^OR(100,+ID,4.5,"ID","ORDERABLE")) OIDX=$O(^OR(100,+ID,4.5,"ID","ORDERABLE",0))
"RTN","ORWDXM3",115,0)
 I $D(^OR(100,+ID,4.5,OIDX)) D
"RTN","ORWDXM3",116,0)
 . F  S CNT=$O(^OR(100,+ID,4.5,OIDX,CNT)) Q:'CNT  D
"RTN","ORWDXM3",117,0)
 . . S OI=^(CNT) D VALDOI
"RTN","ORWDXM3",118,0)
 I +LST(0)=8 S LST(.5)="You can not change this order." Q
"RTN","ORWDXM3",119,0)
 S LST(0)="0^X"_ID_U_$$DLGINFO(+ID,2)
"RTN","ORWDXM3",120,0)
 S $P(LST(0),U,4)="X"
"RTN","ORWDXM3",121,0)
 Q
"RTN","ORWDXM3",122,0)
VALDOI ; Validate the Orderable Items
"RTN","ORWDXM3",123,0)
 N ORQUIT,ORPS
"RTN","ORWDXM3",124,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDXM3",125,0)
 . S ORQUIT=1
"RTN","ORWDXM3",126,0)
 . S LST(0)="8^0"
"RTN","ORWDXM3",127,0)
 I $D(ORQUIT) Q:ORQUIT
"RTN","ORWDXM3",128,0)
 S ORPS=$G(^ORD(101.43,+OI,"PS"))
"RTN","ORWDXM3",129,0)
 I $P(ORPS,U,1,4)="0^0^0^0" S LST(0)="8^0"
"RTN","ORWDXM3",130,0)
 Q
"RTN","ORWDXR")
0^57^B18777992
"RTN","ORWDXR",1,0)
ORWDXR ; SLC/KCM/JDL - Utilites for Order Actions;05:33 AM  20 May 1998
"RTN","ORWDXR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,134,141**;Dec 17, 1997
"RTN","ORWDXR",3,0)
 ;
"RTN","ORWDXR",4,0)
ISREL(VAL,ORIFN)        ; Return true if an order has been released
"RTN","ORWDXR",5,0)
 N STS S STS=$P(^OR(100,+ORIFN,3),U,3)
"RTN","ORWDXR",6,0)
 S VAL=$S(STS=10:0,STS=11:0,1:1)  ; false if delayed or unreleased order
"RTN","ORWDXR",7,0)
 Q
"RTN","ORWDXR",8,0)
RENEW(REC,ORIFN,ORVP,ORNP,ORL,FLDS) ; Renew an order
"RTN","ORWDXR",9,0)
 N ORDG
"RTN","ORWDXR",10,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORPKG
"RTN","ORWDXR",11,0)
 N ORDIALOG,PRMT,X0
"RTN","ORWDXR",12,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDXR",13,0)
 S X0=^OR(100,+ORIFN,0)
"RTN","ORWDXR",14,0)
 S ORDG=$P(X0,U,11)
"RTN","ORWDXR",15,0)
 S ORPKG=$P(X0,U,14)
"RTN","ORWDXR",16,0)
 I $P(X0,U,5)["101.41," D                        ; version 3
"RTN","ORWDXR",17,0)
 . S ORDIALOG=+$P(X0,U,5),ORCAT=$P(^OR(100,+ORIFN,0),U,12)
"RTN","ORWDXR",18,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(+ORIFN)
"RTN","ORWDXR",19,0)
 E  D                                            ; version 2.5 generic
"RTN","ORWDXR",20,0)
 . S ORDIALOG=$O(^ORD(101.41,"B","OR GXTEXT WORD PROCESSING ORDE",0))
"RTN","ORWDXR",21,0)
 . D GETDLG^ORCD(ORDIALOG)
"RTN","ORWDXR",22,0)
 . S PRMT=$O(^ORD(101.41,"B","OR GTX WORD PROCESSING 1",0))
"RTN","ORWDXR",23,0)
 . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWDXR",24,0)
 . M ^TMP("ORWORD",$J,PRMT,1)=^OR(100,+ORIFN,1)
"RTN","ORWDXR",25,0)
 . S PRMT=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWDXR",26,0)
 . I $P(X0,U,9) S ORDIALOG(PRMT,1)=$P(X0,U,9)
"RTN","ORWDXR",27,0)
 I +FLDS(1)=999 D  ; generic order
"RTN","ORWDXR",28,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)=$P(FLDS(1),U,2)
"RTN","ORWDXR",29,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX STOP DATE/TIME"),1)=$P(FLDS(1),U,3)
"RTN","ORWDXR",30,0)
 I ($O(^ORD(101.41,"AB","PS MEDS",0))>0),(+FLDS(1)=130)!(+FLDS(1)=135)!(+FLDS(1)=140),'$L($G(ORDIALOG($$PTR^ORCD("OR GTX SIG"),1))) D
"RTN","ORWDXR",31,0)
 . N ORDOSE,ORDRUG,ORCAT,ORWPSOI,PROMPT,DRUG
"RTN","ORWDXR",32,0)
 . S ORCAT=$P($G(^OR(100,+ORIFN,0)),U,12)
"RTN","ORWDXR",33,0)
 . S PROMPT=$$PTR^ORCD("OR GTX INSTRUCTIONS")
"RTN","ORWDXR",34,0)
 . S ORDRUG=$G(ORDIALOG($$PTR^ORCD("OR GTX DISPENSE DRUG"),1))
"RTN","ORWDXR",35,0)
 . S ORWPSOI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORWDXR",36,0)
 . I ORWPSOI S ORWPSOI=+$P($G(^ORD(101.43,+ORWPSOI,0)),U,2)
"RTN","ORWDXR",37,0)
 . D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,$S(ORCAT="I":"U",1:"O"),ORVP)       ; dflt doses
"RTN","ORWDXR",38,0)
 . D D1^ORCDPS2  ; set up ORDOSE
"RTN","ORWDXR",39,0)
 . S DRUG=$G(ORDOSE("DD",+ORDRUG))
"RTN","ORWDXR",40,0)
 . I DRUG,ORCAT="O" D RESETID^ORCDPS
"RTN","ORWDXR",41,0)
 . D SIG^ORCDPS2
"RTN","ORWDXR",42,0)
 I +FLDS(1)=140 D  ; outpatient meds
"RTN","ORWDXR",43,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX START DATE"),1) ; remove effective dt
"RTN","ORWDXR",44,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX REFILLS"),1)=$P(FLDS(1),U,4)
"RTN","ORWDXR",45,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX ROUTING"),1)=$P(FLDS(1),U,5)
"RTN","ORWDXR",46,0)
 . S PRMT=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORWDXR",47,0)
 . K ^TMP("ORWORD",$J,PRMT,1)
"RTN","ORWDXR",48,0)
 . S I=1 F  S I=$O(FLDS(I)) Q:'I  S ^TMP("ORWORD",$J,PRMT,1,I-1,0)=FLDS(I)
"RTN","ORWDXR",49,0)
 . S ^TMP("ORWORD",$J,PRMT,1,0)=U_U_(I-1)_U_(I-1)_U_DT_U
"RTN","ORWDXR",50,0)
 . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWDXR",51,0)
 D RN^ORCSAVE
"RTN","ORWDXR",52,0)
 S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXR",53,0)
 Q
"RTN","ORWDXR",54,0)
RNWFLDS(LST,ORIFN)      ; Return fields for renew action
"RTN","ORWDXR",55,0)
 ; LST(0)=RenewType^Start^Stop^Refills^Pickup  LST(n)=Comments
"RTN","ORWDXR",56,0)
 N X0,DG,PKG,RNWTYPE,START,STOP,REFILLS
"RTN","ORWDXR",57,0)
 S ORIFN=+ORIFN,X0=^OR(100,ORIFN,0),DG=$P(X0,U,11),PKG=$P(X0,U,14)
"RTN","ORWDXR",58,0)
 S PKG=$E($P(^DIC(9.4,PKG,0),U,2),1,2),DG=$P(^ORD(100.98,DG,0),U,3)
"RTN","ORWDXR",59,0)
 S LST(0)=$S(PKG="OR":999,PKG="PS"&(DG="O RX"):140,PKG="PS"&(DG="UD RX"):130,1:0)
"RTN","ORWDXR",60,0)
 I +LST(0)=140 D
"RTN","ORWDXR",61,0)
 . S LST(0)=LST(0)_U_U_U_+$$VAL(ORIFN,"REFILLS")_U_$$VAL(ORIFN,"PICKUP")
"RTN","ORWDXR",62,0)
 . D WPVAL(.LST,ORIFN,"COMMENT")
"RTN","ORWDXR",63,0)
 I +LST(0)=999 S LST(0)=LST(0)_U_$$VAL(ORIFN,"START")_U_$$VAL(ORIFN,"STOP")
"RTN","ORWDXR",64,0)
 ; make sure start/stop times are relative times, otherwise use NOW, no Stop
"RTN","ORWDXR",65,0)
 I +$P(LST(0),U,2) S $P(LST(0),U,2)="NOW"
"RTN","ORWDXR",66,0)
 I +$P(LST(0),U,3)!($P(LST(0),U,3)="0") S $P(LST(0),U,3)=""
"RTN","ORWDXR",67,0)
 Q
"RTN","ORWDXR",68,0)
VAL(ORIFN,ID)   ; Return value for order response
"RTN","ORWDXR",69,0)
 N DA S DA=+$O(^OR(100,ORIFN,4.5,"ID",ID,0))
"RTN","ORWDXR",70,0)
 Q $G(^OR(100,ORIFN,4.5,DA,1))
"RTN","ORWDXR",71,0)
WPVAL(TXT,ORIFN,ID)    ; Return word processing value
"RTN","ORWDXR",72,0)
 N DA S DA=+$O(^OR(100,ORIFN,4.5,"ID",ID,0))
"RTN","ORWDXR",73,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,4.5,DA,2,I)) Q:'I  S TXT(I)=^(I,0)
"RTN","ORWDXR",74,0)
 Q
"RTN","ORWDXR",75,0)
CHKACT(ORDERID,ORWSIG,ORWREL,ORWNATR) ; Return error if can't sign/release order
"RTN","ORWDXR",76,0)
 N ORACT,ORWERR
"RTN","ORWDXR",77,0)
 ; begin case
"RTN","ORWDXR",78,0)
 S ORACT=""
"RTN","ORWDXR",79,0)
 I (ORWSIG=1),$D(^XUSEC("ORES",DUZ)) S ORACT="ES" G XC1
"RTN","ORWDXR",80,0)
 I (ORWSIG=7),$D(^XUSEC("ORES",DUZ)) S ORACT="DS" G XC1
"RTN","ORWDXR",81,0)
 I ORWREL,(ORWNATR="W") S ORACT="OC" G XC1
"RTN","ORWDXR",82,0)
 I ORWREL S ORACT="RS" S:$P($G(^OR(100,+ORDERID,0)),U,16)<2 ORACT="ES"
"RTN","ORWDXR",83,0)
XC1 ; end case
"RTN","ORWDXR",84,0)
 S ORWERR=""
"RTN","ORWDXR",85,0)
 I $L(ORACT),$$VALID^ORCACT0(ORDERID,ORACT,.ORWERR,ORWNATR) S ORWERR=""
"RTN","ORWDXR",86,0)
 Q ORWERR
"RTN","ORWDXR",87,0)
GTORITM(Y,ORIFN)        ;-- Get back the orderable item IEN
"RTN","ORWDXR",88,0)
 S ORIFN=+ORIFN
"RTN","ORWDXR",89,0)
 S Y=$$VALUE^ORCSAVE2(ORIFN,"ORDERABLE")
"RTN","ORWDXR",90,0)
 Q
"RTN","ORWDXR",91,0)
GETPKG(Y,IFN) ;Get package for an order
"RTN","ORWDXR",92,0)
 N ORDERID,PKGID
"RTN","ORWDXR",93,0)
 Q:+IFN<1
"RTN","ORWDXR",94,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWDXR",95,0)
 S PKGID=$P(^OR(100,ORDERID,0),U,14)
"RTN","ORWDXR",96,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWDXR",97,0)
 Q
"RTN","ORWOR")
0^38^B29680452
"RTN","ORWOR",1,0)
ORWOR ; SLC/KCM - Orders Calls;10:54 PM  26 Feb 1998
"RTN","ORWOR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,132,141**;Dec 17, 1997
"RTN","ORWOR",3,0)
 ;
"RTN","ORWOR",4,0)
CURRENT(LST,DFN) ; Get Current Orders for a Patient
"RTN","ORWOR",5,0)
 ; Returns two lists in ^TMP("ORW",$J), fields and text
"RTN","ORWOR",6,0)
 N TM,IEN,X,X0,X3,CTR,IDX,I
"RTN","ORWOR",7,0)
 K ^TMP("ORW",$J)
"RTN","ORWOR",8,0)
 S IDX=0,DFN=DFN_";DPT("
"RTN","ORWOR",9,0)
 S TM=0 F  S TM=$O(^OR(100,"AC",DFN,TM)) Q:TM<1  D
"RTN","ORWOR",10,0)
 . S IEN=0 F  S IEN=$O(^OR(100,"AC",DFN,TM,IEN)) Q:IEN<1  D
"RTN","ORWOR",11,0)
 . . S X0=^OR(100,IEN,0),X3=^(3)
"RTN","ORWOR",12,0)
 . . S X=IEN_U_$P(X0,U,7)_U_$P(X0,U,11)_U_$P(X3,U,6)_U_$P(X3,U,3)
"RTN","ORWOR",13,0)
 . . S ^TMP("ORW",$J,IDX+1)=X
"RTN","ORWOR",14,0)
 . . S (CTR,I)=0,X=""
"RTN","ORWOR",15,0)
 . . F  S I=$O(^OR(100,IEN,1,I)) Q:I<1  D  Q:CTR>244
"RTN","ORWOR",16,0)
 . . . S X=X_$E(^OR(100,IEN,1,I,0),1,(245-CTR)),CTR=$L(X)
"RTN","ORWOR",17,0)
 . . S ^TMP("ORW",$J,IDX+2)=X,IDX=IDX+2
"RTN","ORWOR",18,0)
 ; S LST=$NA(^TMP("ORW",$J))
"RTN","ORWOR",19,0)
 M LST=^TMP("ORW",$J)
"RTN","ORWOR",20,0)
 Q
"RTN","ORWOR",21,0)
DETAIL(LST,ORID,DFN)    ; Return details of ORID (shell to kill VIDEO subs)
"RTN","ORWOR",22,0)
 I $G(DFN) N ORVP S ORVP=DFN_";DPT("
"RTN","ORWOR",23,0)
 S LST="^TMP(""ORTXT"",$J)"
"RTN","ORWOR",24,0)
 D DETAIL^ORQ2(.LST,ORID)
"RTN","ORWOR",25,0)
 K @LST@("VIDEO")
"RTN","ORWOR",26,0)
 S LST=$NA(^TMP("ORTXT",$J)),@LST=""
"RTN","ORWOR",27,0)
 Q
"RTN","ORWOR",28,0)
RESULT(REF,DFN,ORID,ID)      ; Return results of order identified by ID
"RTN","ORWOR",29,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWOR",30,0)
 N ORESULTS,ORVP,LCNT S ORESULTS=1,LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWOR",31,0)
 D ORDERS^ORCXPND1
"RTN","ORWOR",32,0)
 K ^TMP("ORXPND",$J,"VIDEO")
"RTN","ORWOR",33,0)
 S REF=$NA(^TMP("ORXPND",$J))
"RTN","ORWOR",34,0)
 Q
"RTN","ORWOR",35,0)
RESHIST(REF,DFN,ORID,ID)      ; Return result history of associated tests identified by ID
"RTN","ORWOR",36,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWOR",37,0)
 N ORESULTS,ORVP,LCNT
"RTN","ORWOR",38,0)
 S ORESULTS=1,LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWOR",39,0)
 D ORDHIST^ORWOR2
"RTN","ORWOR",40,0)
 K ^TMP("ORXPND",$J,"VIDEO")
"RTN","ORWOR",41,0)
 S REF=$NA(^TMP("ORXPND",$J))
"RTN","ORWOR",42,0)
 Q
"RTN","ORWOR",43,0)
TSALL(LST)      ; Return list of treating specialties
"RTN","ORWOR",44,0)
 N Y S Y=0
"RTN","ORWOR",45,0)
 F  S Y=$O(^DIC(45.7,Y)) Q:'Y  I $$ACTIVE^DGACT(45.7,Y) S LST(Y)=Y_U_$P(^DIC(45.7,Y,0),U)
"RTN","ORWOR",46,0)
 Q
"RTN","ORWOR",47,0)
DT(X) ; -- Returns FM date for X (SEE ORCHTAB1)
"RTN","ORWOR",48,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORWOR",49,0)
 Q +Y
"RTN","ORWOR",50,0)
VWSET(ANERR,VIEW)       ; Set the preferred view for orders
"RTN","ORWOR",51,0)
 ; VIEW:  semi-colon delimited record
"RTN","ORWOR",52,0)
 ;        1 - Relative From Date/Time or ""
"RTN","ORWOR",53,0)
 ;        2 - Relative Thru Date/Time or ""
"RTN","ORWOR",54,0)
 ;        3 - Filter
"RTN","ORWOR",55,0)
 ;        4 - Display Group Pointer
"RTN","ORWOR",56,0)
 ;        5 - Format (preserve for list manager)
"RTN","ORWOR",57,0)
 ;        6 - chronological display (R or F)
"RTN","ORWOR",58,0)
 ;        7 - sort by display group
"RTN","ORWOR",59,0)
 N FMT
"RTN","ORWOR",60,0)
 ; use short name for display group instead of pointer
"RTN","ORWOR",61,0)
 S $P(VIEW,";",4)=$P($G(^ORD(100.98,+$P(VIEW,";",4),0)),U,3)
"RTN","ORWOR",62,0)
 ; use last saved format, since this is used only by LM
"RTN","ORWOR",63,0)
 S FMT=$P($$GET^XPAR("ALL","ORCH CONTEXT ORDERS",1,"I"),";",5)
"RTN","ORWOR",64,0)
 S:'$L(FMT) FMT="L" S $P(VIEW,";",5)=FMT
"RTN","ORWOR",65,0)
 ; and save the parameter
"RTN","ORWOR",66,0)
 D EN^XPAR(DUZ_";VA(200,","ORCH CONTEXT ORDERS",1,VIEW,.ANERR)
"RTN","ORWOR",67,0)
 Q
"RTN","ORWOR",68,0)
VWGET(REC)      ; Get the preferred view for orders
"RTN","ORWOR",69,0)
 N FROM,THRU,FILTER,DGRP,FRMT,CHRN,BYGRP,S,VNAME,FL
"RTN","ORWOR",70,0)
 S REC=$$GET^XPAR("ALL","ORCH CONTEXT ORDERS",1,"I"),S=";"
"RTN","ORWOR",71,0)
 S FROM=$$DT($P(REC,S)),THRU=$$DT($P(REC,S,2)),FILTER=$P(REC,S,3)
"RTN","ORWOR",72,0)
 S DGRP=$P(REC,S,4),FRMT=$P(REC,S,5),CHRN=$P(REC,S,6),BYGRP=$P(REC,S,7)
"RTN","ORWOR",73,0)
 S:'$L(DGRP) DGRP="ALL" S DGRP=+$O(^ORD(100.98,"B",DGRP,0))
"RTN","ORWOR",74,0)
 I FILTER="" S FILTER=2  ; active orders
"RTN","ORWOR",75,0)
 I CHRN="" S CHRN="R"    ; reverse chronological
"RTN","ORWOR",76,0)
 I BYGRP="" S BYGRP=1    ; sort by display group
"RTN","ORWOR",77,0)
 ; set up view name
"RTN","ORWOR",78,0)
 D REVSTS^ORWORDG(.FL)
"RTN","ORWOR",79,0)
 S I=0 F  S I=$O(FL(I)) Q:'I  Q:+FL(I)=FILTER
"RTN","ORWOR",80,0)
 S VNAME=$P($G(FL(+I)),U,2)
"RTN","ORWOR",81,0)
 I '("^6^8^9^10^19^20^"[(U_FILTER_U)) S VNAME=VNAME_" Orders"
"RTN","ORWOR",82,0)
 I FILTER=2 S VNAME="Active Orders (includes Pending & Recent Activity)"
"RTN","ORWOR",83,0)
 I FILTER=23 S VNAME="Current Orders (Active & Pending Status Only)"
"RTN","ORWOR",84,0)
 S VNAME=VNAME_" - "_$P($G(^ORD(100.98,DGRP,0)),U)
"RTN","ORWOR",85,0)
 I (FROM>0)!(THRU>0) D
"RTN","ORWOR",86,0)
 . S VNAME=VNAME_" ("_$$FMTE^XLFDT(FROM,"2D")_" thru "
"RTN","ORWOR",87,0)
 . S VNAME=VNAME_$S(THRU>0:$$FMTE^XLFDT(THRU,"2D"),1:"")_")"
"RTN","ORWOR",88,0)
 S REC=FROM_S_THRU_S_FILTER_S_DGRP_S_FRMT_S_CHRN_S_BYGRP_S_VNAME
"RTN","ORWOR",89,0)
 Q
"RTN","ORWOR",90,0)
SHEETS(LST,ORVP) ; Return Order Sheets for a patient
"RTN","ORWOR",91,0)
 N ELST,ETYP,ORIFN,TS,I
"RTN","ORWOR",92,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWOR",93,0)
 S ETYP="" F  S ETYP=$O(^OR(100,"AEVNT",ORVP,ETYP)) Q:ETYP=""  D
"RTN","ORWOR",94,0)
 . S ORIFN=0 F  S ORIFN=$O(^OR(100,"AEVNT",ORVP,ETYP,ORIFN)) Q:'ORIFN  D
"RTN","ORWOR",95,0)
 . . I (ETYP="A")!(ETYP="T") S ELST(ETYP,$P($G(^OR(100,+ORIFN,0)),U,13))=""
"RTN","ORWOR",96,0)
 S LST(1)="C;O^Current View",I=1
"RTN","ORWOR",97,0)
 S TS="" F  S TS=$O(ELST("A",TS)) Q:TS=""  D
"RTN","ORWOR",98,0)
 . S I=I+1,LST(I)="A;"_TS_U_"Admit to "_$P($G(^DIC(45.7,TS,0)),U)
"RTN","ORWOR",99,0)
 S I=I+1,LST(I)="A;-1^Admit..."
"RTN","ORWOR",100,0)
 S TS="" F  S TS=$O(ELST("T",TS)) Q:TS=""  D
"RTN","ORWOR",101,0)
 . S I=I+1,LST(I)="T;"_TS_U_"Transfer to "_$P($G(^DIC(45.7,TS,0)),U)
"RTN","ORWOR",102,0)
 I $L($G(^DPT(+ORVP,.1))) D
"RTN","ORWOR",103,0)
 . S I=I+1,LST(I)="T;-1^Transfer..."
"RTN","ORWOR",104,0)
 . S I=I+1,LST(I)="D;0^Discharge"
"RTN","ORWOR",105,0)
 Q
"RTN","ORWOR",106,0)
EVENTS(LST,EVT) ; Return general delayed events categories for a patient
"RTN","ORWOR",107,0)
 N EVTI
"RTN","ORWOR",108,0)
 S EVTI=0
"RTN","ORWOR",109,0)
 S EVTI=EVTI+1,LST(EVTI)="A;-1^Admit..."
"RTN","ORWOR",110,0)
 S EVTI=EVTI+1,LST(EVTI)="T;-1^Transfer..."
"RTN","ORWOR",111,0)
 S EVTI=EVTI+1,LST(EVTI)="D;0^Discharge"
"RTN","ORWOR",112,0)
 Q
"RTN","ORWOR",113,0)
UNSIGN(LST,ORVP,HAVE)   ; Return Unsigned Orders that are not on client
"RTN","ORWOR",114,0)
 N IFN,ACT,X8,ENT,LVL,TM,ILST S ILST=0
"RTN","ORWOR",115,0)
 Q:'$D(^XUSEC("ORES",DUZ))
"RTN","ORWOR",116,0)
 S ORVP=ORVP_";DPT("
"RTN","ORWOR",117,0)
 S ENT="ALL"_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+^(5),1:"")
"RTN","ORWOR",118,0)
 S LVL=$$GET^XPAR(ENT,"OR UNSIGNED ORDERS ON EXIT")
"RTN","ORWOR",119,0)
 Q:'LVL
"RTN","ORWOR",120,0)
 S TM=0 F  S TM=$O(^OR(100,"AS",ORVP,TM)) Q:TM<1  D
"RTN","ORWOR",121,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AS",ORVP,TM,IFN)) Q:IFN<1  D
"RTN","ORWOR",122,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AS",ORVP,TM,IFN,ACT)) Q:ACT<1  D
"RTN","ORWOR",123,0)
 . . . Q:$D(HAVE(IFN_";"_ACT))                        ;in Changes
"RTN","ORWOR",124,0)
 . . . S X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWOR",125,0)
 . . . I '$S(LVL=1&($P(X8,U,3)=DUZ):1,LVL=2:1,1:0) Q  ;chk user
"RTN","ORWOR",126,0)
 . . . S ILST=ILST+1,LST(ILST)=IFN_";"_ACT
"RTN","ORWOR",127,0)
 Q
"RTN","ORWOR",128,0)
PKIUSE(RETURN) ; RPC determines user can use PKI Digital Signature
"RTN","ORWOR",129,0)
 S RETURN=0
"RTN","ORWOR",130,0)
 I $$GET^XPAR("ALL^USR.`"_DUZ,"ORWOR PKI USE",1,"Q") S RETURN=1
"RTN","ORWOR",131,0)
 Q
"RTN","ORWOR",132,0)
PKISITE(RETURN) ; RPC determines if PKI is turned on at the site
"RTN","ORWOR",133,0)
 S RETURN=0
"RTN","ORWOR",134,0)
 Q:'$L($T(STORESIG^XUSSPKI))  ;Check for Kernel piece
"RTN","ORWOR",135,0)
 Q:'$L($T(DOSE^PSSOPKI1))  ;Check for Pharmacy piece
"RTN","ORWOR",136,0)
 I $$GET^XPAR("ALL","ORWOR PKI SITE",1,"Q") S RETURN=1
"RTN","ORWOR",137,0)
 Q
"RTN","ORWOR1")
0^84^B14074512
"RTN","ORWOR1",1,0)
ORWOR1 ; slc/dcm - PKI RPC functions
"RTN","ORWOR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**132,141**;Dec 17, 1997
"RTN","ORWOR1",3,0)
SIG(RET,ID,X1,X2,X3,X4,ORX5,X6) ;Store the signature.
"RTN","ORWOR1",4,0)
 ;ID = orifn;action
"RTN","ORWOR1",5,0)
 ;X1 = Hash
"RTN","ORWOR1",6,0)
 ;X2 = Length of the array
"RTN","ORWOR1",7,0)
 ;X3 = Datafile (100)
"RTN","ORWOR1",8,0)
 ;X4 = Provider DUZ
"RTN","ORWOR1",9,0)
 ;ORX5 = Array for the sig
"RTN","ORWOR1",10,0)
 ;X6 = CRLURL
"RTN","ORWOR1",11,0)
 N Y1,ORIFN,ACT
"RTN","ORWOR1",12,0)
 S Y1=$$STORESIG^XUSSPKI(X1,X2,.ORX5,X4,X3)
"RTN","ORWOR1",13,0)
 I +Y1>0,$L($G(X6)) S Y1=$$CRLURL^XUSSPKI(X6)
"RTN","ORWOR1",14,0)
 I +Y1>0 D
"RTN","ORWOR1",15,0)
 . S ORIFN=+ID,ACT=$P(ID,";",2)
"RTN","ORWOR1",16,0)
 . S $P(^OR(100,ORIFN,8,+ACT,2),"^",3)=X1
"RTN","ORWOR1",17,0)
 S RET=Y1
"RTN","ORWOR1",18,0)
 Q
"RTN","ORWOR1",19,0)
CRLURL(RET,X1) ;Store the URL's
"RTN","ORWOR1",20,0)
 S RET=$$CRLURL^XUSSPKI(X1)
"RTN","ORWOR1",21,0)
 Q
"RTN","ORWOR1",22,0)
VERIFY(RET,ORDER,DFN)       ;Verify PKI Data
"RTN","ORWOR1",23,0)
 ;DBIA #3750
"RTN","ORWOR1",24,0)
 ;ORDER = ORIFN;ACTION - NOTE: if no ACTION then 1 (new order) is assumed
"RTN","ORWOR1",25,0)
 ;Returned values: "1" if digital signature verifies
"RTN","ORWOR1",26,0)
 ;                 "-1^error message" if DS fails during initial parameter checking
"RTN","ORWOR1",27,0)
 ;                 "898020xx^message" if DS fails during verification
"RTN","ORWOR1",28,0)
 N ORIFN,ORACTION,HASH,DATE
"RTN","ORWOR1",29,0)
 K ^TMP("ORPKIDATA",$J)
"RTN","ORWOR1",30,0)
 I '$G(ORDER) S RET="-1^No order number passed" Q
"RTN","ORWOR1",31,0)
 I '$G(DFN) S RET="-1^No DFN passed" Q
"RTN","ORWOR1",32,0)
 S ORIFN=$P(ORDER,";"),ORACTION=$P(ORDER,";",2)
"RTN","ORWOR1",33,0)
 I 'ORACTION S ORACTION=1
"RTN","ORWOR1",34,0)
 I '$D(^OR(100,ORIFN,0)) S RET="-1^Invalid order number" Q
"RTN","ORWOR1",35,0)
 I DFN'=+$P(^OR(100,ORIFN,0),"^",2) S RET="-1^DFN does not match patient on order" Q
"RTN","ORWOR1",36,0)
 I '$D(^OR(100,ORIFN,8,ORACTION)) S RET="-1^Invalid order action passed" Q
"RTN","ORWOR1",37,0)
 S HASH=$P($G(^OR(100,ORIFN,8,ORACTION,2)),"^",3)
"RTN","ORWOR1",38,0)
 I '$L(HASH) S RET="-1^Order has no PKI Hash" Q
"RTN","ORWOR1",39,0)
 I '$O(^OR(100,ORIFN,8,ORACTION,.2,0)) S RET="-1^Order has no PKI Data" Q
"RTN","ORWOR1",40,0)
 S DATE=$P($G(^OR(100,ORIFN,8,ORACTION,.2,1,0)),"^")
"RTN","ORWOR1",41,0)
 I '$L(DATE) S RET="-1^No date associated with PKI Data" Q
"RTN","ORWOR1",42,0)
 S DATE=$$HL7TFM^XLFDT(DATE),I=0
"RTN","ORWOR1",43,0)
 F  S I=$O(^OR(100,ORIFN,8,ORACTION,.2,I)) Q:'I  S ^TMP("ORPKIDATA",$J,I)=^(I,0)
"RTN","ORWOR1",44,0)
 S RET=$$VERIFY^XUSSPKI(HASH,$NA(^TMP("ORPKIDATA",$J)),DATE)
"RTN","ORWOR1",45,0)
 I RET="OK" S RET=1 Q
"RTN","ORWOR1",46,0)
 I $E(RET,1,7)="-898020" S RET=$E(RET,2,99)
"RTN","ORWOR1",47,0)
 Q
"RTN","ORWOR1",48,0)
CHKDIG(REQ,ORDER)       ;Check if Digital Signature is required
"RTN","ORWOR1",49,0)
 N IFN,ACTION
"RTN","ORWOR1",50,0)
 S REQ=0,IFN=+ORDER,ACTION=$P(ORDER,";",2)
"RTN","ORWOR1",51,0)
 I +$P($G(^OR(100,+IFN,8,+ACTION,2)),U,5) S REQ=1
"RTN","ORWOR1",52,0)
 Q
"RTN","ORWOR1",53,0)
GETDTEXT(TEXT,ORDER)    ;Get External Text
"RTN","ORWOR1",54,0)
 N IFN,ACTION
"RTN","ORWOR1",55,0)
 S IFN=+ORDER,ACTION=$P(ORDER,";",2),I=0
"RTN","ORWOR1",56,0)
 F  S I=$O(^OR(100,+IFN,8,+ACTION,.2,I)) Q:'I  S TEXT(I)=^(I,0)
"RTN","ORWOR1",57,0)
 Q
"RTN","ORWOR1",58,0)
GETDSIG(SIG,ORDER)      ;Get Digital Signature
"RTN","ORWOR1",59,0)
 N IFN,ACTION
"RTN","ORWOR1",60,0)
 S SIG=0,IFN=+ORDER,ACTION=$P(ORDER,";",2)
"RTN","ORWOR1",61,0)
 I +$P($G(^OR(100,+IFN,8,+ACTION,2)),U,3) S SIG=$P(^(2),"^",3)
"RTN","ORWOR1",62,0)
 Q
"RTN","ORWOR1",63,0)
GETDATA(Y,ORDER,DFN)    ;Get PKI Data
"RTN","ORWOR1",64,0)
 ;DBIA #3750
"RTN","ORWOR1",65,0)
 ;On error: Y = -1^Error message
"RTN","ORWOR1",66,0)
 ;Else: Y = 1^ Order # ^ Nature of order ^ Order Status ^ Date Signed
"RTN","ORWOR1",67,0)
 ;Y(1) = Patient name ^ Street1 ^ Street2 ^ Street3 ^ City ^ State ^ Zip
"RTN","ORWOR1",68,0)
 ;Y(2) = Drug name_strength_dosage form ^ Drug IEN (file 50) ^ Drug quantity prescribed ^ Schedule of medication ^ DEA Schedule
"RTN","ORWOR1",69,0)
 ;Y(3) = Directions for use (SIG)
"RTN","ORWOR1",70,0)
 ;Y(4) = Practitioner's name ^ DUZ ^ Practitioner's (DEA) registration number ^ VA-DEA number
"RTN","ORWOR1",71,0)
 ;Y(5) = SiteName ^ SiteStreet1  ^ SiteStreet2 ^ SiteCity  ^ SiteState ^ SiteZip
"RTN","ORWOR1",72,0)
 N X0,X1,X2,X3,X4,X5,X6,ORNAT,ORSTAT
"RTN","ORWOR1",73,0)
 I '$D(^OR(100,+$G(ORDER),0)) S Y="-1^INVALID ORDER #" Q
"RTN","ORWOR1",74,0)
 I $G(DFN)'=+$P(^OR(100,ORDER,0),"^",2) S Y="-1^INVALID PATIENT ID" Q
"RTN","ORWOR1",75,0)
 I '$D(^OR(100,ORDER,8,1,.2,0)) S Y="-1^MISSING DIGITAL SIGNATURE TEXT" Q
"RTN","ORWOR1",76,0)
 S X0=$G(^OR(100,ORDER,8,1,0))
"RTN","ORWOR1",77,0)
 I $P($G(^OR(100,ORDER,8,1,0)),"^",4)'=7 S Y="-1^ORDER HAS NOT BEEN DIGITALLY SIGNED" Q
"RTN","ORWOR1",78,0)
 S X1=$G(^OR(100,ORDER,8,1,.2,1,0))
"RTN","ORWOR1",79,0)
 I DFN'=$P(X1,"^",4) S Y="-1^PKI PATIENT ID DOES NOT MATCH DFN" Q
"RTN","ORWOR1",80,0)
 S ORNAT=$P(X0,"^",12),ORSTAT=$P($G(^OR(100,ORDER,3)),"^",3)
"RTN","ORWOR1",81,0)
 I ORNAT S ORNAT=$P($G(^ORD(100.02,ORNAT,0)),"^")
"RTN","ORWOR1",82,0)
 I ORSTAT S ORSTAT=ORSTAT_";"_$P(^ORD(100.01,ORSTAT,0),"^")
"RTN","ORWOR1",83,0)
 S Y="1^"_ORDER_"^"_ORNAT_"^"_ORSTAT_"^"_$P(X0,"^",6)
"RTN","ORWOR1",84,0)
 S X2=$G(^OR(100,ORDER,8,1,.2,2,0)),X3=$G(^OR(100,ORDER,8,1,.2,3,0)),X4=$G(^OR(100,ORDER,8,1,.2,4,0)),X5=$G(^OR(100,ORDER,8,1,.2,5,0)),X6=$G(^OR(100,ORDER,8,1,.2,6,0))
"RTN","ORWOR1",85,0)
 S Y(1)=$P(X1,"^",2)_"^"_X2
"RTN","ORWOR1",86,0)
 S Y(2)=X3,Y(3)=X4,Y(4)=X5,Y(5)=X6
"RTN","ORWOR1",87,0)
 Q
"RTN","ORWOR2")
0^53^B36026297
"RTN","ORWOR2",1,0)
ORWOR2 ; slc/dcm - Result RPC functions
"RTN","ORWOR2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORWOR2",3,0)
ORDHIST  ; -- orders - compare with ORDERS^ORCXPND1
"RTN","ORWOR2",4,0)
 I '$G(ORESULTS) D ORDERS^ORCXPND2 Q
"RTN","ORWOR2",5,0)
 ; -- Result History Display (Add more packages as available)
"RTN","ORWOR2",6,0)
 N PKG,TAB,ORIFN
"RTN","ORWOR2",7,0)
 S PKG=+$P($G(^OR(100,+ID,0)),"^",14),PKG=$$NMSP^ORCD(PKG)
"RTN","ORWOR2",8,0)
 S TAB=$S(PKG="LR":"LABS",PKG="GMRC":"CONSULTS",PKG="RA":"XRAYS",1:"")
"RTN","ORWOR2",9,0)
 I '$L(TAB)!(ID'>0) D  Q  ; no display available
"RTN","ORWOR2",10,0)
 . N ORY,I
"RTN","ORWOR2",11,0)
 . D TEXT^ORQ12(.ORY,+ID,80)
"RTN","ORWOR2",12,0)
 . S I=0 F  S I=$O(ORY(I)) Q:I'>0  D ITEM^ORCXPND(ORY(I))
"RTN","ORWOR2",13,0)
 . D BLANK^ORCXPND
"RTN","ORWOR2",14,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="There are no results to report in this time range."
"RTN","ORWOR2",15,0)
 I $O(^OR(100,+ID,2,0)) S ORIFN=+ID,ID=0 F  S ID=$O(^OR(100,ORIFN,2,ID)) Q:ID<1  I $D(^OR(100,ID,0)) D @TAB
"RTN","ORWOR2",16,0)
 I '$O(^OR(100,+ID,2,0)) D @TAB
"RTN","ORWOR2",17,0)
 Q
"RTN","ORWOR2",18,0)
LABS ; -- laboratory [RESULTS ONLY for ID=OE order #]
"RTN","ORWOR2",19,0)
 N ORIFN,X,Y,SUB,NAME,SS,IDE,IVDT,TST,CC,ORCY,IG,TCNT,ITEM,ORY,SDATE,EDATE,ITDATE,ITMDATE,NDT,STAR,LNM
"RTN","ORWOR2",20,0)
 K ^TMP("LRRR",$J),^TMP("LRAPI",$J)
"RTN","ORWOR2",21,0)
 S ORIFN=+ID,IDE=$G(^OR(100,+ID,4))
"RTN","ORWOR2",22,0)
 Q:'$L(IDE)  ; OE# -> Lab#
"RTN","ORWOR2",23,0)
 S ITEM=$$VALUE^ORX8(ID,"ORDERABLE",,"I"),ITMDATE=$S($P(ID,";",2):$P($G(^OR(100,ORIFN,8,$P(ID,";",2),0)),"^",16),1:$P(^OR(100,ORIFN,0),"^",8)),ITDATE=$$FMTE^XLFDT(ITMDATE,"1M")
"RTN","ORWOR2",24,0)
 Q:'ITEM
"RTN","ORWOR2",25,0)
 S ITEM=+$P($G(^ORD(101.43,+ITEM,0)),"^",2)
"RTN","ORWOR2",26,0)
 S $P(IDE,";",1,3)=";;"
"RTN","ORWOR2",27,0)
 S SDATE=9999999-$S($P(IDE,";",5):$P(IDE,";",5),1:ITMDATE),EDATE=$$FMADD^XLFDT(DT,-1825) ;Set for previous 5 years
"RTN","ORWOR2",28,0)
 D RR^LR7OR1(+ORVP,,SDATE,EDATE,,ITEM,,5)
"RTN","ORWOR2",29,0)
 K ORCY D TEXT^ORQ12(.ORCY,ORIFN,80)
"RTN","ORWOR2",30,0)
 S IG=0 F  S IG=$O(ORCY(IG)) Q:IG<1  S X=ORCY(IG) D ITEM^ORCXPND(X)
"RTN","ORWOR2",31,0)
 D BLANK^ORCXPND
"RTN","ORWOR2",32,0)
 I '$D(^TMP("LRRR",$J,+ORVP)) S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="No data available." Q
"RTN","ORWOR2",33,0)
 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Order Released: "_ITDATE_$S('$P(IDE,";",5):" (Results not yet available for this order)",1:"  (* Results for this order)")
"RTN","ORWOR2",34,0)
 S CC=0,SS="",TCNT=0
"RTN","ORWOR2",35,0)
 F  S SS=$O(^TMP("LRRR",$J,+ORVP,SS)) Q:SS=""  S IVDT=0 F  S IVDT=$O(^TMP("LRRR",$J,+ORVP,SS,IVDT)) Q:'IVDT  D  Q:SS="MI"  Q:SS="BB"
"RTN","ORWOR2",36,0)
 . S NDT=1,STAR=" "
"RTN","ORWOR2",37,0)
 . I SS="BB" K ^TMP("LRC",$J) D EN1^LR7OSBR(+ORVP) Q:'$D(^TMP("LRC",$J))  D  Q
"RTN","ORWOR2",38,0)
 .. N I S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORWOR2",39,0)
 .. K ^TMP("LRC",$J)
"RTN","ORWOR2",40,0)
 . I SS="MI" K ^TMP("LRC",$J) D EN^LR7OSMZ0(+ORVP) Q:'$D(^TMP("LRC",$J))  D  Q
"RTN","ORWOR2",41,0)
 .. S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Previous 5 sets of related results within 5 years... "
"RTN","ORWOR2",42,0)
 .. N I S I=0 F  S I=$O(^TMP("LRC",$J,I)) Q:I<1  S X=^(I,0),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORWOR2",43,0)
 .. K ^TMP("LRC",$J)
"RTN","ORWOR2",44,0)
 . I SS="CH",$O(^TMP("LRRR",$J,+ORVP,SS,IVDT,0)) D  Q
"RTN","ORWOR2",45,0)
 .. S TST=0 F  S TST=$O(^TMP("LRRR",$J,+ORVP,SS,IVDT,TST)) Q:TST=""  S CC=0,Y="",TCNT=TCNT+1,X=$S(TST:^TMP("LRRR",$J,+ORVP,SS,IVDT,TST),1:"") D
"RTN","ORWOR2",46,0)
 ... I TCNT=1 D
"RTN","ORWOR2",47,0)
 .... S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Previous 5 sets of related results within 5 years... "
"RTN","ORWOR2",48,0)
 .... D BLANK^ORCXPND
"RTN","ORWOR2",49,0)
 .... S CC=0,LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$$S(1,CC," ")_$$S(1,CC,"Collection Time")_$$S(21,CC,"Test Name")_$$S(34,CC,"Result")_$$S(42,CC,"Units")_$$S(58,CC,"Range")
"RTN","ORWOR2",50,0)
 .... S CC=0,LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=$$S(1,CC," ")_$$S(1,CC,"------------------")_$$S(21,CC,"---------")_$$S(34,CC,"------")_$$S(42,CC,"-----")_$$S(58,CC,"-----")
"RTN","ORWOR2",51,0)
 ... I TST S X=^TMP("LRRR",$J,+ORVP,SS,IVDT,TST),CC=0 I +X D
"RTN","ORWOR2",52,0)
 .... I NDT=1,$P(IDE,";",5)=IVDT S STAR="*"
"RTN","ORWOR2",53,0)
 .... S LCNT=LCNT+1,LNM=$S($D(^LAB(60,+X,.1)):$P(^(.1),U),1:$P(^(0),U))
"RTN","ORWOR2",54,0)
 .... S ^TMP("ORXPND",$J,LCNT,0)=STAR_$S(NDT=1:$$S(1,CC,$$FMTE^XLFDT(9999999-IVDT,"1M")),1:$$S(1,CC,"   "))_$$S(20,CC,LNM)_$$S(30,CC,$J($P(X,U,2),7))
"RTN","ORWOR2",55,0)
 .... I $L($P(X,U,2))<8 S ^TMP("ORXPND",$J,LCNT,0)=^TMP("ORXPND",$J,LCNT,0)_$$S(36,CC,$S($L($P(X,U,3)):$P(X,U,3),1:""))_$$S(41,CC,$P(X,U,4))_$$S(47,CC,$J($P(X,U,5),15))
"RTN","ORWOR2",56,0)
 .... E  S CC=0,LCNT=LCNT+1,$P(Y," ",38)="",^TMP("ORXPND",$J,LCNT,0)=$$S(1,CC,Y)_$$S(36,CC,$S($L($P(X,U,3)):$P(X,U,3),1:""))_$$S(42,CC,$P(X,U,4))_$$S(58,CC,$J($P(X,U,5),15))
"RTN","ORWOR2",57,0)
 .... S NDT=0
"RTN","ORWOR2",58,0)
 ... I TST="N" S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="  Comments: " D
"RTN","ORWOR2",59,0)
 .... N CMT S CMT=0 F  S CMT=$O(^TMP("LRRR",$J,+ORVP,SS,IVDT,"N",CMT)) Q:'CMT  S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="   "_^TMP("LRRR",$J,+ORVP,SS,IVDT,"N",CMT)
"RTN","ORWOR2",60,0)
 K ^TMP("LRRR",$J),^TMP("LRAPI",$J)
"RTN","ORWOR2",61,0)
 Q
"RTN","ORWOR2",62,0)
CONSULTS ; -- consults
"RTN","ORWOR2",63,0)
 N I,X,SUB,ORTX
"RTN","ORWOR2",64,0)
 I $G(ORTAB)="CONSULTS" S X=$P($G(^TMP("OR",$J,ORTAB,"IDX",NUM)),U,4)
"RTN","ORWOR2",65,0)
 E  D TEXT^ORQ12(.ORTX,+ID) S X=ORTX(1),ID=+$G(^OR(100,+ID,4)) ; OE->GMRC order#
"RTN","ORWOR2",66,0)
 D ITEM^ORCXPND(X),BLANK^ORCXPND
"RTN","ORWOR2",67,0)
 I ID'>0 S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="No data available." Q
"RTN","ORWOR2",68,0)
 I '$G(ORESULTS) D  ;DT action
"RTN","ORWOR2",69,0)
 . S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Consult No.:           "_ID
"RTN","ORWOR2",70,0)
 . N GMRCOER S GMRCOER=2 D DT^GMRCSLM2(ID) S SUB="DT"
"RTN","ORWOR2",71,0)
 I $G(ORESULTS) D RT^GMRCGUIA(ID,"^TMP(""GMRCR"",$J,""RT"")") S SUB="RT"
"RTN","ORWOR2",72,0)
 S I=0 F  S I=$O(^TMP("GMRCR",$J,SUB,I)) Q:I'>0  S X=$G(^(I,0)),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X
"RTN","ORWOR2",73,0)
 K ^TMP("GMRCR",$J)
"RTN","ORWOR2",74,0)
 Q
"RTN","ORWOR2",75,0)
 ;
"RTN","ORWOR2",76,0)
XRAYS ; -- Radiology
"RTN","ORWOR2",77,0)
 I '$G(ORESULTS) S ID=+ORVP_U_$TR(ID,"-","^") D EN3^RAO7PC3(ID)
"RTN","ORWOR2",78,0)
 I $G(ORESULTS) S ID=+$G(^OR(100,+ID,4)) D EN30^RAO7PC3(ID)
"RTN","ORWOR2",79,0)
 N CASE,PROC,PSET
"RTN","ORWOR2",80,0)
 S PSET=$D(^TMP($J,"RAE3",+ORVP,"PRINT_SET")),CASE=0
"RTN","ORWOR2",81,0)
 F  S CASE=$O(^TMP($J,"RAE3",+ORVP,CASE)) Q:CASE'>0  D
"RTN","ORWOR2",82,0)
 . I PSET S PROC=$O(^TMP($J,"RAE3",+ORVP,CASE,"")) D ITEM^ORCXPND(PROC) Q
"RTN","ORWOR2",83,0)
 . S PROC="" F  S PROC=$O(^TMP($J,"RAE3",+ORVP,CASE,PROC)) Q:PROC=""  D ITEM^ORCXPND(PROC),BLANK^ORCXPND,XRPT,BLANK^ORCXPND
"RTN","ORWOR2",84,0)
 I PSET S CASE=$O(^TMP($J,"RAE3",+ORVP,0)),PROC=$O(^(CASE,"")) D BLANK^ORCXPND,XRPT,BLANK^ORCXPND ;printset=list all procs, then one report
"RTN","ORWOR2",85,0)
 K ^TMP($J,"RAE3",+ORVP) S VALM("RM")=81
"RTN","ORWOR2",86,0)
 Q
"RTN","ORWOR2",87,0)
XRPT ; -- body of report for CASE, PROC
"RTN","ORWOR2",88,0)
 N ORD,X,I
"RTN","ORWOR2",89,0)
 S ORD=$S($L($G(^TMP($J,"RAE3",+ORVP,"ORD"))):^("ORD"),$L($G(^("ORD",CASE))):^(CASE),1:"") I $L(ORD),ORD'=PROC S LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)="Proc Ord: "_ORD
"RTN","ORWOR2",90,0)
 S I=1 F  S I=$O(^TMP($J,"RAE3",+ORVP,CASE,PROC,I)) Q:I'>0  S X=^(I),LCNT=LCNT+1,^TMP("ORXPND",$J,LCNT,0)=X ;Skip pt ID on line 1
"RTN","ORWOR2",91,0)
 Q
"RTN","ORWOR2",92,0)
 ;
"RTN","ORWOR2",93,0)
S(X,Y,Z) ;Pad over
"RTN","ORWOR2",94,0)
 ;X=Column #
"RTN","ORWOR2",95,0)
 ;Y=Current length
"RTN","ORWOR2",96,0)
 ;Z=Text
"RTN","ORWOR2",97,0)
 ;SP=TEXT SENT
"RTN","ORWOR2",98,0)
 ;CC=Line position after input text
"RTN","ORWOR2",99,0)
 I '$D(Z) Q ""
"RTN","ORWOR2",100,0)
 N SP S SP=Z I X,Y,X>Y S SP=$E("                                                                             ",1,X-Y)_Z
"RTN","ORWOR2",101,0)
 S CC=$$INC(CC,SP)
"RTN","ORWOR2",102,0)
 Q SP
"RTN","ORWOR2",103,0)
INC(X,Y) ;Character position count
"RTN","ORWOR2",104,0)
 ;X=Current count
"RTN","ORWOR2",105,0)
 ;Y=Text
"RTN","ORWOR2",106,0)
 N INC S INC=X+$L(Y)
"RTN","ORWOR2",107,0)
 Q INC
"RTN","ORWORDG")
0^44^B3668340
"RTN","ORWORDG",1,0)
ORWORDG ; SLC/KCM/JLI - Organize display groups;11:25 AM  11 Mar 1998 3/2/02 4PM
"RTN","ORWORDG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,141**;Dec 17, 1997
"RTN","ORWORDG",3,0)
 ;
"RTN","ORWORDG",4,0)
MAPSEQ(Y) ; similar to GRPSEQB, for 32bit
"RTN","ORWORDG",5,0)
 N C,I,X
"RTN","ORWORDG",6,0)
 D GRPSEQ(.X)
"RTN","ORWORDG",7,0)
 S C=0,I=0
"RTN","ORWORDG",8,0)
 F  S I=$O(X(I)) Q:I=""  S C=C+1,Y(C)=I_"="_X(I)_U_$P(^ORD(100.98,I,0),U,2)
"RTN","ORWORDG",9,0)
 Q
"RTN","ORWORDG",10,0)
GRPSEQB(Y) ;
"RTN","ORWORDG",11,0)
 ; Call GRPSEQ, format for broker:
"RTN","ORWORDG",12,0)
 ;   Y(n)=Ptr to Display Group ^ Sequence ^ Top Level Display Group Name
"RTN","ORWORDG",13,0)
 N C,I,X
"RTN","ORWORDG",14,0)
 D GRPSEQ(.X)
"RTN","ORWORDG",15,0)
 S C=0,I=0
"RTN","ORWORDG",16,0)
 F  S I=$O(X(I)) Q:I=""  S C=C+1,Y(C)=I_U_X(I)
"RTN","ORWORDG",17,0)
 Q
"RTN","ORWORDG",18,0)
GRPSEQ(BYGRP) ;
"RTN","ORWORDG",19,0)
 ; Expanded list of display groups with sequence as value
"RTN","ORWORDG",20,0)
 N I,ORY,TOPINFO
"RTN","ORWORDG",21,0)
 D GETLST^XPAR(.ORY,"ALL","ORWOR CATEGORY SEQUENCE")
"RTN","ORWORDG",22,0)
 S I=0 F  S I=$O(ORY(I)) Q:I=""  D
"RTN","ORWORDG",23,0)
 . S BYGRP($P(ORY(I),U,2))=$P(ORY(I),U,1)_U_$P(^ORD(100.98,$P(ORY(I),U,2),0),U,2)
"RTN","ORWORDG",24,0)
 S I=0 F  S I=$O(BYGRP(I)) Q:I=""  S TOPINFO=BYGRP(I) D EXPAND(I)
"RTN","ORWORDG",25,0)
 Q
"RTN","ORWORDG",26,0)
EXPAND(GROUP) ;
"RTN","ORWORDG",27,0)
 ; (used by GRPSEQ)
"RTN","ORWORDG",28,0)
 N I,CHILD
"RTN","ORWORDG",29,0)
 S I=0 F  S I=$O(^ORD(100.98,GROUP,1,I)) Q:I<1  D
"RTN","ORWORDG",30,0)
 . S CHILD=$P(^ORD(100.98,GROUP,1,I,0),"^",1)
"RTN","ORWORDG",31,0)
 . I '$D(BYGRP(CHILD)) S BYGRP(CHILD)=TOPINFO D EXPAND(CHILD)
"RTN","ORWORDG",32,0)
 Q
"RTN","ORWORDG",33,0)
ALLTREE(LST) ; Return the tree for all display groups
"RTN","ORWORDG",34,0)
 N ROOT,ILST
"RTN","ORWORDG",35,0)
 S ILST=0,ROOT=$O(^ORD(100.98,"B","ALL",0))
"RTN","ORWORDG",36,0)
 S ILST=ILST+1,LST(ILST)=ROOT_U_"ALL SERVICES^0^+"
"RTN","ORWORDG",37,0)
 D LSTCHLD(ROOT)
"RTN","ORWORDG",38,0)
 Q
"RTN","ORWORDG",39,0)
LSTCHLD(PARENT) ; list descendends of this node (recursive)
"RTN","ORWORDG",40,0)
 N CHILD,I
"RTN","ORWORDG",41,0)
 S I=0 F  S I=$O(^ORD(100.98,PARENT,1,I)) Q:'I  D
"RTN","ORWORDG",42,0)
 . S CHILD=+^ORD(100.98,PARENT,1,I,0)
"RTN","ORWORDG",43,0)
 . S ILST=ILST+1,LST(ILST)=CHILD_U_$P(^ORD(100.98,CHILD,0),U)_U_PARENT
"RTN","ORWORDG",44,0)
 . I $D(^ORD(100.98,CHILD,1))>1 D
"RTN","ORWORDG",45,0)
 . . S LST(ILST)=LST(ILST)_"^+"
"RTN","ORWORDG",46,0)
 . . D LSTCHLD(CHILD)
"RTN","ORWORDG",47,0)
 Q
"RTN","ORWORDG",48,0)
REVSTS(LST) ; Return the status flags available for review orders
"RTN","ORWORDG",49,0)
 ;N I,X,T S ILST=0
"RTN","ORWORDG",50,0)
 ;F I=1:1 S T="ORDSTS+"_I_"^ORCHANG2" S X=$T(@T) Q:$P(X,";",4)="ZZZZ"  D
"RTN","ORWORDG",51,0)
 ;. S ILST=ILST+1,LST(ILST)=$P(X,";",3)_U_$P(X,";",4)
"RTN","ORWORDG",52,0)
 D STSLST^ORCHANG2(.LST)
"RTN","ORWORDG",53,0)
 Q
"RTN","ORWORDG",54,0)
IEN(VAL,X) ; Return IEN for a display group
"RTN","ORWORDG",55,0)
 S VAL=$O(^ORD(100.98,"B",X,0))
"RTN","ORWORDG",56,0)
 Q
"RTN","ORWORR")
0^45^B56781073
"RTN","ORWORR",1,0)
ORWORR ; SLC/KCM/JLI - Retrieve Orders for Broker ;7/5/02 3PM
"RTN","ORWORR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,92,116,110,132,141**;Dec 17, 1997
"RTN","ORWORR",3,0)
 ;
"RTN","ORWORR",4,0)
GET(LST,DFN,FILTER,GROUPS) ; procedure
"RTN","ORWORR",5,0)
 Q  ; don't call until using same treating specialty logic as AGET
"RTN","ORWORR",6,0)
 ;    also until MULT, ORWARD, & ORIGVIEW implemented
"RTN","ORWORR",7,0)
 ;    also until the date ranges are implemented
"RTN","ORWORR",8,0)
 ; Get orders for a patient
"RTN","ORWORR",9,0)
 ;        1   2    3     4      5     6   7   8   9   10     11    12    13    14     15     16  17    18
"RTN","ORWORR",10,0)
 ; .LST=~IFN^Grp^ActTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^ActDA^Flag^DCType^ChrtRev^DEA#^VA#^Schedule
"RTN","ORWORR",11,0)
 ; .LST=tOrder Text (repeating as necessary)
"RTN","ORWORR",12,0)
 ;     DFN=Patient ID
"RTN","ORWORR",13,0)
 ;  FILTER=number indicates which orders to return, default=2 (current)
"RTN","ORWORR",14,0)
 ;  GROUPS=display group of orders to show (default=ALL)
"RTN","ORWORR",15,0)
 ; -- this section uses ORQ1 to get the orders list rather than XGET --
"RTN","ORWORR",16,0)
 N ORLIST,ORIFN,X0,X3,X8,IDX,IFN,ACT,PRV,LN,TXT,STRT,STOP,CSTS,EYE,DEA ;PKI
"RTN","ORWORR",17,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",18,0)
 S (IDX,LST)=0 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",19,0)
 D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"","","",0,1)
"RTN","ORWORR",20,0)
 S EYE=0 F  S EYE=$O(^TMP("ORR",$J,ORLIST,EYE)) Q:'EYE  S IFN=^(EYE) D
"RTN","ORWORR",21,0)
 . S ACT=$P(IFN,";",2),IFN=+IFN,X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",22,0)
 . D GETFLDS
"RTN","ORWORR",23,0)
 K ^TMP("ORR",$J)
"RTN","ORWORR",24,0)
 G EXIT
"RTN","ORWORR",25,0)
AGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Get an abbreviated event delayed order list for a patient 
"RTN","ORWORR",26,0)
 ; returns ^TMP("ORR",$J,ORLIST,n)=IFN^DGrp^ActTm
"RTN","ORWORR",27,0)
 ; see above for input parameters
"RTN","ORWORR",28,0)
 ; -- from ORWORR
"RTN","ORWORR",29,0)
 ; -- this section uses ORQ1 to get the orders list rather than XGET --
"RTN","ORWORR",30,0)
 N ORLIST,ORIFN,IFN,I,ORWTS,TOT,MULT,ORWARD,TXTVW,ORYD,PTEVTID,EVTNAME
"RTN","ORWORR",31,0)
 S (PTEVTID,EVTNAME)=""
"RTN","ORWORR",32,0)
 K ^TMP("ORR",$J),^TMP("ORRJD",$J)
"RTN","ORWORR",33,0)
 S:'$D(GROUPS) GROUPS=1 S:'$D(FILTER) FILTER=2
"RTN","ORWORR",34,0)
 S ORWTS=+$P(FILTER,U,2),FILTER=+FILTER
"RTN","ORWORR",35,0)
 S MULT=$S("^1^6^8^9^10^11^13^14^20^22^"[(U_FILTER_U):1,1:0)
"RTN","ORWORR",36,0)
 I $L($G(^DPT(DFN,.1))) S ORWARD=1 ; should normally be ptr to 42
"RTN","ORWORR",37,0)
 S:'$L($G(DTFROM)) DTFROM=0
"RTN","ORWORR",38,0)
 S:'$L($G(DTTHRU)) DTTHRU=0
"RTN","ORWORR",39,0)
 S:'$L($G(EVENT)) EVENT=0
"RTN","ORWORR",40,0)
 I $G(EVTDCREL)="TRUE" D
"RTN","ORWORR",41,0)
 .D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,2,MULT,"","",EVENT)
"RTN","ORWORR",42,0)
 . D GET2^ORWORR1
"RTN","ORWORR",43,0)
 E  D
"RTN","ORWORR",44,0)
 .D EN^ORQ1(DFN_";DPT(",GROUPS,FILTER,"",DTFROM,DTTHRU,0,MULT,"","",EVENT)
"RTN","ORWORR",45,0)
 . D GET1^ORWORR1
"RTN","ORWORR",46,0)
 Q
"RTN","ORWORR",47,0)
RGET(REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT) ;Orders of AutoDC/Release Event
"RTN","ORWORR",48,0)
 N EVTDCREL
"RTN","ORWORR",49,0)
 S EVTDCREL="TRUE"
"RTN","ORWORR",50,0)
 D AGET(.REF,DFN,FILTER,GROUPS,DTFROM,DTTHRU,EVENT)
"RTN","ORWORR",51,0)
 Q
"RTN","ORWORR",52,0)
XGET ; -- this was the retrieval algorithm before all the AC xref changes
"RTN","ORWORR",53,0)
 N X,X0,X3,IDX,IFN,LN,TIME,DGRP,MASK,TXT,ACT,PRV,ID,DEA ;PKI
"RTN","ORWORR",54,0)
 S DFN=DFN_";DPT(",IDX=0,LST=0
"RTN","ORWORR",55,0)
 I '$G(FILTER) S FILTER=2                    ; Default: Current/Active
"RTN","ORWORR",56,0)
 I $D(GROUPS)=1 D
"RTN","ORWORR",57,0)
 . S:'GROUPS GROUPS=$O(^ORD(100.98,"B",GROUPS,0))
"RTN","ORWORR",58,0)
 . D XPND(GROUPS)
"RTN","ORWORR",59,0)
 I FILTER=1  D DOALL G EXIT                  ; All
"RTN","ORWORR",60,0)
 I FILTER=2  D DOCUR G EXIT                  ; Current
"RTN","ORWORR",61,0)
 I FILTER=3  S PASS=";1;"                    ; Discontinued
"RTN","ORWORR",62,0)
 I FILTER=4  S PASS=";2;7;"                  ; Comp/Expired
"RTN","ORWORR",63,0)
 I FILTER=5  S PASS=";3;4;5;6;8;9;"          ; Expiring
"RTN","ORWORR",64,0)
 I FILTER=6  S PASS=";1;2;3;4;5;6;7;8;9;11;" ; New Activity
"RTN","ORWORR",65,0)
 I FILTER=7  S PASS=";5;"                    ; Pending
"RTN","ORWORR",66,0)
 I FILTER=8  Q                               ; Expanded
"RTN","ORWORR",67,0)
 I FILTER=9  S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Nurse
"RTN","ORWORR",68,0)
 I FILTER=10 S PASS=";3;4;5;6;8;9;11;"       ; Unverified by Clerk
"RTN","ORWORR",69,0)
 I FILTER=11 S PASS=";3;4;5;6;7;8;11;"       ; Unsigned
"RTN","ORWORR",70,0)
 I FILTER=12 S PASS=";4;"                    ; Flagged
"RTN","ORWORR",71,0)
 I FILTER=13 S PASS=""                       ; Verbal/Phone
"RTN","ORWORR",72,0)
 I FILTER=14 S PASS=""                       ; Verbal/Phone Unsigned
"RTN","ORWORR",73,0)
 D DOGET
"RTN","ORWORR",74,0)
EXIT I LST=0 D
"RTN","ORWORR",75,0)
 . N %,X,%I D NOW^%DTC
"RTN","ORWORR",76,0)
 . S LST(1)="~0^0^"_%_"^^^97",LST(2)="tNo Orders Found."
"RTN","ORWORR",77,0)
 Q
"RTN","ORWORR",78,0)
DOGET ; Come here if need to filter the orders 
"RTN","ORWORR",79,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",80,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",81,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",82,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",83,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",84,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",85,0)
 . . . I $L(PASS),(PASS'[(";"_$P(X3,U,3)_";")) Q  ;filter by status
"RTN","ORWORR",86,0)
 . . . ; do any other filtering
"RTN","ORWORR",87,0)
 . . . D GETFLDS
"RTN","ORWORR",88,0)
 Q
"RTN","ORWORR",89,0)
DOALL ; Come here if retrieve all orders (no filter by status)
"RTN","ORWORR",90,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AO",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",91,0)
 . S DGRP=0 F  S DGRP=$O(^OR(100,"AO",DFN,TIME,DGRP)) Q:'DGRP  D
"RTN","ORWORR",92,0)
 . . I $D(GROUPS)>1 Q:'$D(GROUPS(DGRP))           ;filter by display grp
"RTN","ORWORR",93,0)
 . . S IFN=0 F  S IFN=$O(^OR(100,"AO",DFN,TIME,DGRP,IFN)) Q:'IFN  D
"RTN","ORWORR",94,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3)                ;get main nodes
"RTN","ORWORR",95,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!($P(X3,U,3)=99) Q  ;skip veil,chld,sts=99
"RTN","ORWORR",96,0)
 . . . D GETFLDS
"RTN","ORWORR",97,0)
 Q
"RTN","ORWORR",98,0)
DOCUR ; Come here to retrieve all current orders
"RTN","ORWORR",99,0)
 N AOCTXT,STS,STOP,%
"RTN","ORWORR",100,0)
 S X=-$$GET^XPAR("ALL","ORPF ACTIVE ORDERS CONTEXT HRS")
"RTN","ORWORR",101,0)
 S %H=$H,X=(%H*86400+$P(%H,",",2))+(X*3600),%H=(X\86400)_","_(X#86400)
"RTN","ORWORR",102,0)
 D YMD^%DTC S AOCTXT=X_%
"RTN","ORWORR",103,0)
 S MASK="110000100101110"   ; mask out STS=1,2,7,10,12,13,14
"RTN","ORWORR",104,0)
 S TIME=0 F  S TIME=$O(^OR(100,"AC",DFN,TIME)) Q:'TIME  D
"RTN","ORWORR",105,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AC",DFN,TIME,IFN)) Q:'IFN  D
"RTN","ORWORR",106,0)
 . . ; filter out display groups here
"RTN","ORWORR",107,0)
 . . S ACT=0 F  S ACT=$O(^OR(100,"AC",DFN,TIME,IFN,ACT)) Q:'ACT  D
"RTN","ORWORR",108,0)
 . . . S X0=^OR(100,IFN,0),X3=^(3),X8=^(8,ACT,0)
"RTN","ORWORR",109,0)
 . . . S STS=$P(X3,U,3),STOP=$P(X0,U,9)
"RTN","ORWORR",110,0)
 . . . I $P(X3,U,8)!$P(X3,U,9)!(STS=99) Q
"RTN","ORWORR",111,0)
 . . . I $P(X8,U,15)=13,($P(X8,U)<AOCTXT) D ACKILL Q
"RTN","ORWORR",112,0)
 . . . I $P(X8,U,15)=13!($P(X8,U,15)=""),("RN^XX"[$P(X8,U,2)) D ACKILL Q
"RTN","ORWORR",113,0)
 . . . I $E(MASK,STS),STOP<AOCTXT D ACKILL Q
"RTN","ORWORR",114,0)
 . . . D GETFLDS
"RTN","ORWORR",115,0)
 Q
"RTN","ORWORR",116,0)
ACKILL ; called only from DOCUR - kill AC xref
"RTN","ORWORR",117,0)
 ; K ^OR(100,"AC",DFN,TIME,IFN,ACT)  ; let ORQ1 kill if for now
"RTN","ORWORR",118,0)
 Q
"RTN","ORWORR",119,0)
GET4V11(LST,TXTVW,ORYD,IFNLST) ; get the order fields TEMPORARY
"RTN","ORWORR",120,0)
 G GET41
"RTN","ORWORR",121,0)
GET4LST(LST,IFNLST)     ; get the order fields for a list of orders
"RTN","ORWORR",122,0)
GET41 N ACT,ACTID,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,IFN,IFNIDX,ORIGVIEW,DEA ;PKI
"RTN","ORWORR",123,0)
 S (IDX,LST,IFNIDX)=0
"RTN","ORWORR",124,0)
 F  S IFNIDX=$O(IFNLST(IFNIDX)) Q:'IFNIDX  S IFN=IFNLST(IFNIDX) D
"RTN","ORWORR",125,0)
 . S ACT=$S($P(IFN,";",2):$P(IFN,";",2),1:1),IFN=+IFN
"RTN","ORWORR",126,0)
 . S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)),X8=$G(^(8,ACT,0))
"RTN","ORWORR",127,0)
 . D GETFLDS
"RTN","ORWORR",128,0)
 Q
"RTN","ORWORR",129,0)
GETBYIFN(LST,IFN) ; procedure
"RTN","ORWORR",130,0)
 ; get the fields for a single order
"RTN","ORWORR",131,0)
 ; .LST(n)=as described above in GET
"RTN","ORWORR",132,0)
 ;     IFN=internal entry number for order
"RTN","ORWORR",133,0)
 I 'IFN Q
"RTN","ORWORR",134,0)
 N ACT,IDX,X0,X3,X8,PRV,ID,LN,TXT,STRT,STOP,CSTS,ACTID,ORIGVIEW,ORYD,TXTVW,DEA ;PKI
"RTN","ORWORR",135,0)
 S IDX=0,LST=0,ORYD=0
"RTN","ORWORR",136,0)
 S X0=$G(^OR(100,+IFN,0)),X3=$G(^(3))
"RTN","ORWORR",137,0)
 S ACT=$S($P(IFN,";",2):$P(IFN,";",2),$P(X3,U,7):$P(X3,U,7),1:1)
"RTN","ORWORR",138,0)
 S IFN=+IFN,X8=$G(^OR(100,IFN,8,ACT,0))
"RTN","ORWORR",139,0)
GETFLDS ; used by entry points to place order fields into list
"RTN","ORWORR",140,0)
 ; expects IDX=sequence #, IFN=order, X0=node 0, X3=node 3, LST=results
"RTN","ORWORR",141,0)
 ; LST(IDX)=~IFN^Grp^OrdTm^StrtTm^StopTm^Sts^Sig^Nrs^Clk^PrvID^PrvNam^Act^Flagged[^DCType]^ChartRev^DEA#^VA#^DigSig
"RTN","ORWORR",142,0)
 S PRV=$P(X8,U,5) S:'PRV PRV=$P(X8,U,3) S PRV=PRV_U
"RTN","ORWORR",143,0)
 I PRV S PRV=PRV_$P(^VA(200,+PRV,0),U)
"RTN","ORWORR",144,0)
 S DEA=$S($D(^VA(200,DUZ,"PS")):$P(^("PS"),U,2)_U_$P(^("PS"),U,3),1:"")  ; get user DEA info - PKI
"RTN","ORWORR",145,0)
 S IDX=IDX+1,LST=LST+1,ID=IFN_";"_ACT,ACTID=$P(X8,U,2)
"RTN","ORWORR",146,0)
 S CSTS=$S($P(X8,U,15):$P(X8,U,15),1:$P(X3,U,3))
"RTN","ORWORR",147,0)
 I $P(X8,U,15)=10,$P(X3,U,3)=14 S CSTS=14 ;delayed-lapsed order
"RTN","ORWORR",148,0)
 S STRT=$S($P(X3,U,3)=11:$$RSTRT,ACTID="NW"!(ACTID="XX")!(ACTID="RL"):$P(X0,U,8),ACTID="DC":"",1:$P(X8,U)) ;110
"RTN","ORWORR",149,0)
 S STOP=$S($P(X3,U,3)=11:$$RSTOP,ACTID="HD":$P($G(^OR(100,+IFN,8,ACT,2)),U),1:$P(X0,U,9))
"RTN","ORWORR",150,0)
 S LST(IDX)="~"_ID_U_$P(X0,U,11)_U_$P(X8,U)_U_STRT_U_STOP_U_CSTS_U_$P(X8,U,4)_U_$P(X8,U,8)_U_$P(X8,U,10)_U_PRV
"RTN","ORWORR",151,0)
 S $P(LST(IDX),U,13)=+$G(^OR(100,IFN,8,ACT,3))    ; flagged
"RTN","ORWORR",152,0)
 I +$P(X8,U,8) S $P(LST(IDX),U,8)=$$INITIALS^ORCHTAB2(+$P(X8,U,8))    ;nurse
"RTN","ORWORR",153,0)
 I +$P(X8,U,10) S $P(LST(IDX),U,9)=$$INITIALS^ORCHTAB2(+$P(X8,U,10))  ;clerk
"RTN","ORWORR",154,0)
 I +$P(X8,U,18) S $P(LST(IDX),U,15)=$$INITIALS^ORCHTAB2(+$P(X8,U,18)) ;chart review
"RTN","ORWORR",155,0)
 I $L($G(DEA)) S $P(LST(IDX),U,16)=DEA ;PKI- DEA has 2 pieces (DEA#^VA#)
"RTN","ORWORR",156,0)
 I $P($G(^OR(100,IFN,8,ACT,2)),"^",5) S $P(LST(IDX),U,18)=$P(^(2),"^",4)
"RTN","ORWORR",157,0)
 S ORIGVIEW=$S($G(TXTVW)=0:0,$G(TXTVW)=1:1,ORYD=-1:1,'ORYD:1,$P(X8,U)'<ORYD:0,1:1)
"RTN","ORWORR",158,0)
 K TXT D TEXT^ORQ12(.TXT,ID,255)                  ; optimize this later
"RTN","ORWORR",159,0)
 I $O(^OR(100,+IFN,2,0)) S LN=$O(TXT(0)),TXT(LN)="+"_TXT(LN)
"RTN","ORWORR",160,0)
 I $O(^OR(100,+IFN,8,"C","XX",0)) S LN=$O(TXT(0)),TXT(LN)="*"_TXT(LN)
"RTN","ORWORR",161,0)
 S LN=0 F  S LN=$O(TXT(LN)) Q:'LN  S IDX=IDX+1,LST(IDX)="t"_TXT(LN)
"RTN","ORWORR",162,0)
 I $O(^OR(100,+IFN,8,1,.2,0)) S IDX=IDX+1,LST(IDX)="|" D  ;PKI XMLText
"RTN","ORWORR",163,0)
 . S I=0 F  S I=$O(^OR(100,+IFN,8,1,.2,I)) Q:'I  S IDX=IDX+1,LST(IDX)="x"_^(I,0)
"RTN","ORWORR",164,0)
 Q
"RTN","ORWORR",165,0)
RSTRT() ; return start date from responses
"RTN","ORWORR",166,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","START",0)),1))
"RTN","ORWORR",167,0)
RSTOP() ; return stop date from responses
"RTN","ORWORR",168,0)
 Q $G(^OR(100,IFN,4.5,+$O(^OR(100,IFN,4.5,"ID","STOP",0)),1))
"RTN","ORWORR",169,0)
GETTXT(LST,IFN)     ; get the text of an order
"RTN","ORWORR",170,0)
 I $L(IFN,";")=1 S IFN=IFN_";1"
"RTN","ORWORR",171,0)
 D TEXT^ORQ12(.LST,IFN,255)
"RTN","ORWORR",172,0)
 Q
"RTN","ORWORR",173,0)
XPND(AGRP) ; procedure
"RTN","ORWORR",174,0)
 ; Expand a display group (GROUPS must be defined outside of call)
"RTN","ORWORR",175,0)
 N I,CHLD
"RTN","ORWORR",176,0)
 S GROUPS(AGRP)=^ORD(100.98,AGRP,0),I=0
"RTN","ORWORR",177,0)
 F  S I=$O(^ORD(100.98,AGRP,1,I)) Q:'I  S CHLD=$P(^(I,0),U) D XPND(CHLD)
"RTN","ORWORR",178,0)
 Q
"RTN","ORWORR",179,0)
GETPKG(Y,IFN) ; get package for an order
"RTN","ORWORR",180,0)
 N ORDERID,PKGID
"RTN","ORWORR",181,0)
 Q:+IFN<1
"RTN","ORWORR",182,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWORR",183,0)
 S PKGID=$P(OR(100,ORDERID,0),U,14)
"RTN","ORWORR",184,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWORR",185,0)
 Q
"RTN","ORWORR1")
0^88^B4670764
"RTN","ORWORR1",1,0)
ORWORR1 ; SLC/JLI - Utilities for Retrieve Orders for Broker ;9/10/02 3PM [9/16/02 2:56pm]
"RTN","ORWORR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORWORR1",3,0)
 ;Called from ORWORR
"RTN","ORWORR1",4,0)
GET1 ; 
"RTN","ORWORR1",5,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR1",6,0)
 S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  S IFN=^(I) D
"RTN","ORWORR1",7,0)
 . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) K ^TMP("ORR",$J,ORLIST,I) S TOT=TOT-1 Q
"RTN","ORWORR1",8,0)
 . S PTEVTID=$P($G(^OR(100,+IFN,0)),U,17)
"RTN","ORWORR1",9,0)
 . S:PTEVTID>0 EVTNAME=$$NAME^OREVNTX(PTEVTID)
"RTN","ORWORR1",10,0)
 . S ^TMP("ORR",$J,ORLIST,I)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)_U_PTEVTID_U_EVTNAME
"RTN","ORWORR1",11,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR1",12,0)
 S ^TMP("ORR",$J,ORLIST,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR1",13,0)
 S REF=$NA(^TMP("ORR",$J,ORLIST))
"RTN","ORWORR1",14,0)
 Q
"RTN","ORWORR1",15,0)
GET2 ; For AUTO DC/Event Release Orders
"RTN","ORWORR1",16,0)
 N JDND,JDIX,JDCNT,DCSPLIT
"RTN","ORWORR1",17,0)
 S JDCNT=1,DCSPLIT=0
"RTN","ORWORR1",18,0)
 S TOT=^TMP("ORR",$J,ORLIST,"TOT") K ^TMP("ORR",$J,ORLIST,"TOT")
"RTN","ORWORR1",19,0)
 F JDND="RL","DC" D
"RTN","ORWORR1",20,0)
 . S I=.1 F  S I=$O(^TMP("ORR",$J,ORLIST,I)) Q:'I  D
"RTN","ORWORR1",21,0)
 . . I '$D(^TMP("ORR",$J,ORLIST,I,JDND)) Q
"RTN","ORWORR1",22,0)
 . . S JDIX=0 F  S JDIX=$O(^TMP("ORR",$J,ORLIST,I,JDND,JDIX)) Q:'JDIX  S IFN=^(JDIX)  D
"RTN","ORWORR1",23,0)
 . . . I 'DCSPLIT,(JDND="DC") D
"RTN","ORWORR1",24,0)
 . . . . S ^TMP("ORRJD",$J,JDCNT)="DC START"
"RTN","ORWORR1",25,0)
 . . . . S DCSPLIT=1,JDCNT=JDCNT+1,TOT=TOT+1
"RTN","ORWORR1",26,0)
 . . . I ORWTS,(+$P($G(^OR(100,+IFN,0)),U,13)'=ORWTS) S TOT=TOT-1 Q
"RTN","ORWORR1",27,0)
 . . . S PTEVTID=$P($G(^OR(100,+IFN,0)),U,17)
"RTN","ORWORR1",28,0)
 . . . S:PTEVTID>0 EVTNAME=$$NAME^OREVNTX(PTEVTID)
"RTN","ORWORR1",29,0)
 . . . S ^TMP("ORRJD",$J,JDCNT)=IFN_U_$P($G(^OR(100,+IFN,0)),U,11)_U_$P($G(^(8,+$P(IFN,";",2),0)),U)_U_PTEVTID_U_EVTNAME
"RTN","ORWORR1",30,0)
 . . . S JDCNT=JDCNT+1
"RTN","ORWORR1",31,0)
 S TXTVW=$S(MULT:0,FILTER=2:2,1:1) D:FILTER=2 ORYD^ORDD100
"RTN","ORWORR1",32,0)
 S ^TMP("ORRJD",$J,.1)=TOT_U_TXTVW_U_$G(ORYD,0)
"RTN","ORWORR1",33,0)
 S REF=$NA(^TMP("ORRJD",$J))
"RTN","ORWORR1",34,0)
 Q
"RTN","ORWPS")
0^77^B15790542
"RTN","ORWPS",1,0)
ORWPS ; SLC/KCM/JLI - Meds Tab; 7/11/02
"RTN","ORWPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,141**;Dec 17, 1997
"RTN","ORWPS",3,0)
COVER(LST,DFN)  ; retrieve meds for cover sheet
"RTN","ORWPS",4,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",5,0)
 D OCL^PSOORRL(DFN,"","")
"RTN","ORWPS",6,0)
 N ILST,ITMP,X S ILST=0
"RTN","ORWPS",7,0)
 S ITMP="" F  S ITMP=$O(^TMP("PS",$J,ITMP)) Q:'ITMP  D
"RTN","ORWPS",8,0)
 . S X=^TMP("PS",$J,ITMP,0)
"RTN","ORWPS",9,0)
 . I '$L($P(X,U,2)) S X="??"  ; show something if drug empty
"RTN","ORWPS",10,0)
 . S LST($$NXT)=$P(X,U,1,2)_U_$P(X,U,8,9)
"RTN","ORWPS",11,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",12,0)
 Q
"RTN","ORWPS",13,0)
ACTIVE(LST,DFN) ; retrieve active inpatient & outpatient meds
"RTN","ORWPS",14,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",15,0)
 D OCL^PSOORRL(DFN,"","")
"RTN","ORWPS",16,0)
 N ITMP,FIELDS,INSTRUCT,COMMENTS,TYPE,ILST,J S ILST=0
"RTN","ORWPS",17,0)
 S ITMP="" F  S ITMP=$O(^TMP("PS",$J,ITMP),-1) Q:'ITMP  D
"RTN","ORWPS",18,0)
 . K INSTRUCT,COMMENTS
"RTN","ORWPS",19,0)
 . S (INSTRUCT,COMMENTS)="",FIELDS=^TMP("PS",$J,ITMP,0)
"RTN","ORWPS",20,0)
 . I +$P(FIELDS,"^",8),$D(^OR(100,+$P(FIELDS,"^",8),8,"C","XX")) D
"RTN","ORWPS",21,0)
 . . S $P(^TMP("PS",$J,ITMP,0),"^",2)="*"_$P(^TMP("PS",$J,ITMP,0),"^",2) ;dan testing
"RTN","ORWPS",22,0)
 . S TYPE=$S($P($P(FIELDS,U),";",2)="O":"OP",1:"UD")
"RTN","ORWPS",23,0)
 . I $O(^TMP("PS",$J,ITMP,"A",0))>0 S TYPE="IV"
"RTN","ORWPS",24,0)
 . I $O(^TMP("PS",$J,ITMP,"B",0))>0 S TYPE="IV"
"RTN","ORWPS",25,0)
 . I TYPE="UD" D UDINST(.INSTRUCT,ITMP)
"RTN","ORWPS",26,0)
 . I TYPE="OP" D OPINST(.INSTRUCT,ITMP)
"RTN","ORWPS",27,0)
 . I TYPE="IV" D IVINST(.INSTRUCT,ITMP)
"RTN","ORWPS",28,0)
 . I (TYPE="UD")!(TYPE="IV") D SETMULT(.COMMENTS,ITMP,"SIO")
"RTN","ORWPS",29,0)
 . I $D(COMMENTS(1)) S COMMENTS(1)="\"_COMMENTS(1)
"RTN","ORWPS",30,0)
 . S LST($$NXT)="~"_TYPE_U_FIELDS
"RTN","ORWPS",31,0)
 . S J=0 F  S J=$O(INSTRUCT(J)) Q:'J  S LST($$NXT)=INSTRUCT(J)
"RTN","ORWPS",32,0)
 . S J=0 F  S J=$O(COMMENTS(J)) Q:'J  S LST($$NXT)="t"_COMMENTS(J)
"RTN","ORWPS",33,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",34,0)
 Q
"RTN","ORWPS",35,0)
NXT() ; increment ILST
"RTN","ORWPS",36,0)
 S ILST=ILST+1
"RTN","ORWPS",37,0)
 Q ILST
"RTN","ORWPS",38,0)
 ;
"RTN","ORWPS",39,0)
UDINST(Y,INDEX) ; assembles instructions for a unit dose order
"RTN","ORWPS",40,0)
 N I,X
"RTN","ORWPS",41,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",42,0)
 S Y(1)=" "_$P(X,U,2),Y=1
"RTN","ORWPS",43,0)
 S X=$S($L($P(X,U,6)):$P(X,U,6),1:$P(X,U,7))
"RTN","ORWPS",44,0)
 I $L(X) S Y=2,Y(2)=X
"RTN","ORWPS",45,0)
 E  S Y=1 D SETMULT(.Y,INDEX,"SIG")
"RTN","ORWPS",46,0)
 S Y(2)="\Give: "_$G(Y(2)),Y=$G(Y,2)
"RTN","ORWPS",47,0)
 D SETMULT(.Y,INDEX,"MDR"),SETMULT(.Y,INDEX,"SCH")
"RTN","ORWPS",48,0)
 F I=3:1:Y S Y(I)=" "_Y(I)
"RTN","ORWPS",49,0)
 Q
"RTN","ORWPS",50,0)
OPINST(Y,INDEX) ; assembles instructions for an outpatient prescription
"RTN","ORWPS",51,0)
 N I,X
"RTN","ORWPS",52,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",53,0)
 S Y(1)=" "_$P(X,U,2),Y=1
"RTN","ORWPS",54,0)
 I $L($P(X,U,12)) S Y(1)=Y(1)_"  Qty: "_$P(X,U,12)
"RTN","ORWPS",55,0)
 I $L($P(X,U,11)) S Y(1)=Y(1)_" for "_$P(X,U,11)_" days"
"RTN","ORWPS",56,0)
 D SETMULT(.Y,INDEX,"SIG")
"RTN","ORWPS",57,0)
 I Y=1 D
"RTN","ORWPS",58,0)
 . D SETMULT(.Y,INDEX,"SIO")
"RTN","ORWPS",59,0)
 . D SETMULT(.Y,INDEX,"MDR")
"RTN","ORWPS",60,0)
 . D SETMULT(.Y,INDEX,"SCH")
"RTN","ORWPS",61,0)
 S Y(2)="\ Sig: "_$G(Y(2))
"RTN","ORWPS",62,0)
 F I=3:1:Y S Y(I)=" "_Y(I)
"RTN","ORWPS",63,0)
 Q
"RTN","ORWPS",64,0)
IVINST(Y,INDEX) ; assembles instructions for an IV order
"RTN","ORWPS",65,0)
 N SOLN1,I
"RTN","ORWPS",66,0)
 S Y=0 D SETMULT(.Y,INDEX,"A") S SOLN1=Y+1
"RTN","ORWPS",67,0)
 D SETMULT(.Y,INDEX,"B")
"RTN","ORWPS",68,0)
 I $D(Y(SOLN1)),$L($P(FIELDS,U,2)) S Y(SOLN1)="in "_Y(SOLN1)
"RTN","ORWPS",69,0)
 S SOLN1=Y+1
"RTN","ORWPS",70,0)
 D SETMULT(.Y,INDEX,"SCH") S:$D(Y(SOLN1)) Y(SOLN1)=" "_Y(SOLN1)
"RTN","ORWPS",71,0)
 F I=1:1:Y S Y(I)="\"_$TR(Y(I),U," ")
"RTN","ORWPS",72,0)
 I $D(Y(1)) S Y(1)=" "_$E(Y(1),2,999)
"RTN","ORWPS",73,0)
 S Y(Y)=Y(Y)_" "_$P(^TMP("PS",$J,INDEX,0),U,3)
"RTN","ORWPS",74,0)
 Q
"RTN","ORWPS",75,0)
SETMULT(Y,INDEX,SUB) ; appends the multiple at the subscript to Y
"RTN","ORWPS",76,0)
 N I S I=0 F  S I=$O(^TMP("PS",$J,INDEX,SUB,I)) Q:'I  D
"RTN","ORWPS",77,0)
 . S Y=Y+1,Y(Y)=^TMP("PS",$J,INDEX,SUB,I,0)
"RTN","ORWPS",78,0)
 Q
"RTN","ORWPS",79,0)
COMPRESS(Y) ; concatenate Y subscripts into smallest possible number
"RTN","ORWPS",80,0)
 N I,J,X S J=1,X(J)=""
"RTN","ORWPS",81,0)
 S I=0 F  S I=$O(Y(I)) Q:'I  D
"RTN","ORWPS",82,0)
 . I ($L(Y(I))+$L(X(J)))>245 S J=J+1,X(J)=""
"RTN","ORWPS",83,0)
 . S X(J)=X(J)_$S($L(X(J)):" ",1:"")_Y(I)
"RTN","ORWPS",84,0)
 K Y M Y=X
"RTN","ORWPS",85,0)
 Q
"RTN","ORWPS",86,0)
DETAIL(ROOT,DFN,ID) ; -- show details for a med order
"RTN","ORWPS",87,0)
 N LCNT,ORVP
"RTN","ORWPS",88,0)
 S LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWPS",89,0)
 D MEDS^ORCXPND1
"RTN","ORWPS",90,0)
 S ROOT=$NA(^TMP("ORXPND",$J))
"RTN","ORWPS",91,0)
 Q
"RTN","ORWPS",92,0)
MEDHIST(ORROOT,DFN,ORIFN)       ; -- show admin history for a med  (RV)
"RTN","ORWPS",93,0)
 N ORPSID,IVPKG
"RTN","ORWPS",94,0)
 S ORPSID=+$P($$OI^ORX8(ORIFN),U,3),IVPKG=0
"RTN","ORWPS",95,0)
 S ORROOT=$NA(^TMP("ORHIST",$J)) K @ORROOT
"RTN","ORWPS",96,0)
 S IVPKG=$O(^DIC(9.4,"B","IV MEDICATIONS",IVPKG))                 ; DBIA #2058
"RTN","ORWPS",97,0)
 I $P($G(^OR(100,+ORIFN,0)),U,14)=IVPKG D  Q
"RTN","ORWPS",98,0)
 . S @ORROOT@(0)="Medication Administration History is not available at this time for IV fluids."
"RTN","ORWPS",99,0)
 I $L($T(HISTORY^PSBMLHS)) D HISTORY^PSBMLHS(.ORROOT,DFN,ORPSID)  ; DBIA #3459 for BCMA v2.0
"RTN","ORWPS",100,0)
 I '$L($T(HISTORY^PSBMLHS)) D HISTORY^PSBML(.ORROOT,DFN,ORPSID)   ; DBIA #3448,  for BCMA v1.0
"RTN","ORWPS",101,0)
 Q
"RTN","ORWRA")
0^61^B7700527
"RTN","ORWRA",1,0)
ORWRA ; ALB/MJK/REV/JDL -Imaging Calls ;8/6/02  1:30
"RTN","ORWRA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,135,132,148,154,141**;Dec 17, 1997
"RTN","ORWRA",3,0)
EXAMS(ROOT,DFN) ; Return imaging exams
"RTN","ORWRA",4,0)
 ; RPC: ORWRA IMAGING EXAMS
"RTN","ORWRA",5,0)
 ;  See RPC definition for details on input and output parameters
"RTN","ORWRA",6,0)
 D GET(0)
"RTN","ORWRA",7,0)
 Q
"RTN","ORWRA",8,0)
EXAMS1(ROOT,DFN) ; Return imaging exams
"RTN","ORWRA",9,0)
 ; RPC: ORWRA IMAGING EXAMS1
"RTN","ORWRA",10,0)
 ;  See RPC definition for details on input and output parameters
"RTN","ORWRA",11,0)
 D GET(1)
"RTN","ORWRA",12,0)
 Q
"RTN","ORWRA",13,0)
GET(GSITE)      ;Get the data
"RTN","ORWRA",14,0)
 N I,ID,RADATA,STRING,SITE,ORCX
"RTN","ORWRA",15,0)
 S RADATA=$NA(^TMP($J,"RAE1",DFN))
"RTN","ORWRA",16,0)
 S ROOT=$NA(^TMP($J,"ORAEXAMS"))
"RTN","ORWRA",17,0)
 S ORCX=1  ;show cancelled reports
"RTN","ORWRA",18,0)
 K @RADATA,@ROOT
"RTN","ORWRA",19,0)
 ;
"RTN","ORWRA",20,0)
 ; -- set date range
"RTN","ORWRA",21,0)
 D GETDEFG(.STRING)
"RTN","ORWRA",22,0)
 D EN1^RAO7PC1(DFN,$P(STRING,U),$P(STRING,"^",2),$P(STRING,"^",3),ORCX)
"RTN","ORWRA",23,0)
 ;
"RTN","ORWRA",24,0)
 ; -- reformat data array for rpc
"RTN","ORWRA",25,0)
 S I=0,ID="",SITE=""
"RTN","ORWRA",26,0)
 I $G(GSITE) S SITE=$$SITE^VASITE,SITE=$P(SITE,"^",2)_";"_$P(SITE,"^",3)_U
"RTN","ORWRA",27,0)
 F  S ID=$O(@RADATA@(ID)) Q:ID=""  D
"RTN","ORWRA",28,0)
 . S I=I+1
"RTN","ORWRA",29,0)
 . S @ROOT@(I)=SITE_ID_U_(9999999.9999-ID)_U_@RADATA@(ID)
"RTN","ORWRA",30,0)
 K @RADATA
"RTN","ORWRA",31,0)
 Q
"RTN","ORWRA",32,0)
 ;
"RTN","ORWRA",33,0)
GETDEFG(Y) ; -- get default context settings for GUI imaging reports
"RTN","ORWRA",34,0)
 N BEG,END,MAX
"RTN","ORWRA",35,0)
 ;if called from CAPRI, show all reports
"RTN","ORWRA",36,0)
 D OP^XQCHK
"RTN","ORWRA",37,0)
 I $P($G(XQCY0),"^",1)="DVBA CAPRI GUI" D
"RTN","ORWRA",38,0)
 . S BEG=$$DT^ORCHTAB1("T-36500")
"RTN","ORWRA",39,0)
 . S END=$$DT^ORCHTAB1("T")
"RTN","ORWRA",40,0)
 . S MAX="9999"
"RTN","ORWRA",41,0)
 . S Y=BEG_"^"_END_"^"_MAX
"RTN","ORWRA",42,0)
 ; if not CAPRI, use CPRS defaults
"RTN","ORWRA",43,0)
 E  I $P($G(XQCY0),"^",1)'="DVBA CAPRI GUI" D GETIMG^ORWTPD(.Y,"")
"RTN","ORWRA",44,0)
 Q
"RTN","ORWRA",45,0)
GETDEF(Y) ; -- get default context settings for LM imaging reports
"RTN","ORWRA",46,0)
 N BEG,CONTEXT,END,MAX
"RTN","ORWRA",47,0)
 S CONTEXT=$$GET^XPAR("ALL","ORCH CONTEXT REPORTS")
"RTN","ORWRA",48,0)
 S BEG=$$DT^ORCHTAB1($P(CONTEXT,";"))
"RTN","ORWRA",49,0)
 S END=$$DT^ORCHTAB1($P(CONTEXT,";",2))
"RTN","ORWRA",50,0)
 S MAX=$P(CONTEXT,";",5)
"RTN","ORWRA",51,0)
 D OP^XQCHK
"RTN","ORWRA",52,0)
 I $P($G(XQCY0),"^",1)="DVBA CAPRI GUI" D
"RTN","ORWRA",53,0)
 .S BEG=$$DT^ORCHTAB1("T-36500")
"RTN","ORWRA",54,0)
 .S END=$$DT^ORCHTAB1("T")
"RTN","ORWRA",55,0)
 .S MAX="9999"
"RTN","ORWRA",56,0)
 S Y=BEG_"^"_END_"^"_MAX
"RTN","ORWRA",57,0)
 Q
"RTN","ORWRA",58,0)
 ;
"RTN","ORWRA",59,0)
RPT1(ROOT,DFN,ORID,ALPHA,OMEGA,DTRANGE,REMOTE,ORMAX) ; -- return imaging report
"RTN","ORWRA",60,0)
 D RPT(.ROOT,.DFN,.ORID,.ALPHA,.OMEGA,.DTRANGE,.REMOTE)
"RTN","ORWRA",61,0)
 Q
"RTN","ORWRA",62,0)
RPT(ROOT,DFN,ORID,ALPHA,OMEGA,DTRANGE,REMOTE) ; -- return imaging report
"RTN","ORWRA",63,0)
 ;  RPC: ORWRA REPORT TEXT
"RTN","ORWRA",64,0)
 ;  See RPC definition for details on input and output parameters
"RTN","ORWRA",65,0)
 ; -- init locals and globals
"RTN","ORWRA",66,0)
 N ID,LCNT,ORVP,EXAMDATE,CASENMBR
"RTN","ORWRA",67,0)
 S RADATA=$NA(^TMP($J,"RAE3"))
"RTN","ORWRA",68,0)
 S ROOT=$NA(^TMP("ORXPND",$J))
"RTN","ORWRA",69,0)
 K @RADATA,@ROOT
"RTN","ORWRA",70,0)
 ; 
"RTN","ORWRA",71,0)
 ; -- set up exam id and call to get report text
"RTN","ORWRA",72,0)
 S ID=$TR(ORID,"-",U)
"RTN","ORWRA",73,0)
 ;
"RTN","ORWRA",74,0)
 ; -- set up counter and vp local for dfn for formating call
"RTN","ORWRA",75,0)
 S LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWRA",76,0)
 D XRAYS^ORCXPND1
"RTN","ORWRA",77,0)
 K @RADATA
"RTN","ORWRA",78,0)
 Q
"RTN","ORWRA",79,0)
 ;
"RTN","ORWRA",80,0)
TEST ; -- test to get exam list
"RTN","ORWRA",81,0)
 N I,ROOT,DFN
"RTN","ORWRA",82,0)
 S DFN=16
"RTN","ORWRA",83,0)
 D EXAMS1(.ROOT,DFN)
"RTN","ORWRA",84,0)
 W !,"Root: ",ROOT
"RTN","ORWRA",85,0)
 S I=0 F  S I=$O(@ROOT@(I)) Q:'I  W !,@ROOT@(I)
"RTN","ORWRA",86,0)
 Q
"RTN","ORWRA",87,0)
 ;
"RTN","ORWRA",88,0)
TEST1 ; -- test to print reprt for first 3 exams
"RTN","ORWRA",89,0)
 N ORI,ROOT,ROOT1,L,X,DFN
"RTN","ORWRA",90,0)
 S DFN=16
"RTN","ORWRA",91,0)
 D EXAMS1(.ROOT,DFN)
"RTN","ORWRA",92,0)
 S ORI=0 F  S ORI=$O(@ROOT@(ORI)) Q:'ORI  D  Q:ORI=3
"RTN","ORWRA",93,0)
 . S X=@ROOT@(ORI)
"RTN","ORWRA",94,0)
 . D RPT1(.ROOT1,DFN,$P(X,U))
"RTN","ORWRA",95,0)
 . S L=0 F  S L=$O(@ROOT1@(L)) Q:'L  W !,@ROOT1@(L,0)
"RTN","ORWRA",96,0)
 Q
"RTN","ORWTPD")
0^69^B12593329
"RTN","ORWTPD",1,0)
ORWTPD ; slc/jdl - Personal Reference Tool ;6/20/02 11:40am
"RTN","ORWTPD",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**109,120,132,148,141**;Dec 17,1997
"RTN","ORWTPD",3,0)
 ;; Allow user to customize the CPRS reports date/time
"RTN","ORWTPD",4,0)
 ;; and max occurences setting
"RTN","ORWTPD",5,0)
 ;
"RTN","ORWTPD",6,0)
SUDF(Y,VALUE) ;----Set user default for all CPRS reports
"RTN","ORWTPD",7,0)
 N ORERR S ORERR=""
"RTN","ORWTPD",8,0)
 I VALUE=$$GET^XPAR("DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I") D DEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,.ORERR) K ORERR Q
"RTN","ORWTPD",9,0)
 E  D EN^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,VALUE,.ORERR)
"RTN","ORWTPD",10,0)
 S Y=1
"RTN","ORWTPD",11,0)
 K ORERR,VALUES1
"RTN","ORWTPD",12,0)
 Q
"RTN","ORWTPD",13,0)
 ;
"RTN","ORWTPD",14,0)
 ;
"RTN","ORWTPD",15,0)
SUINDV(Y,RPTS,VALUE) ;----Set user individual time/occ setting
"RTN","ORWTPD",16,0)
 ; RPTS format: RPTIen^RPTIen^RPTIen such as 1^2^3
"RTN","ORWTPD",17,0)
 I $L(RPTS)=0 Q
"RTN","ORWTPD",18,0)
 N ORERR,RPTID,P1,P7 S ORERR=0
"RTN","ORWTPD",19,0)
 S (P1,P7)=""
"RTN","ORWTPD",20,0)
 F I=1:1:$L(RPTS,"^") S RPTID=$P(RPTS,U,I) D
"RTN","ORWTPD",21,0)
 . S P1=$P($G(^ORD(101.24,RPTID,0)),U),P7=$P($G(^(0)),U,7)
"RTN","ORWTPD",22,0)
 . I "02345"[P7,(P1'="ORRP IMAGING") D DEL^XPAR("USR.`"_DUZ,"ORWRP TIME/OCC LIMITS INDV",RPTID,.ORERR) Q
"RTN","ORWTPD",23,0)
 . D EN^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS INDV",RPTID,VALUE,.ORERR)
"RTN","ORWTPD",24,0)
 Q
"RTN","ORWTPD",25,0)
 ;
"RTN","ORWTPD",26,0)
 ;
"RTN","ORWTPD",27,0)
GETIMG(Y,RPT) ; ----Get Image (local only) Time/Occ
"RTN","ORWTPD",28,0)
 N IMGID,BEG,END,MAX
"RTN","ORWTPD",29,0)
 S IMGID=0,Y=""
"RTN","ORWTPD",30,0)
 S IMGID=$O(^ORD(101.24,"B","ORRP IMAGING",0))
"RTN","ORWTPD",31,0)
 D GETINDV(.Y,IMGID)
"RTN","ORWTPD",32,0)
 I $L(Y) D
"RTN","ORWTPD",33,0)
 . S BEG=$$DT^ORCHTAB1($P(Y,";"))
"RTN","ORWTPD",34,0)
 . S END=$$DT^ORCHTAB1($P(Y,";",2))
"RTN","ORWTPD",35,0)
 . S MAX=$P(Y,";",3)
"RTN","ORWTPD",36,0)
 . S Y=BEG_"^"_END_"^"_MAX
"RTN","ORWTPD",37,0)
 I Y="" D GETDEF^ORWRA(.Y)
"RTN","ORWTPD",38,0)
 Q
"RTN","ORWTPD",39,0)
 ;
"RTN","ORWTPD",40,0)
 ;
"RTN","ORWTPD",41,0)
GETINDV(Y,RPT) ;----Get time/occ limits for this report
"RTN","ORWTPD",42,0)
 ;RPT:  Report IEN of 101.24
"RTN","ORWTPD",43,0)
 N CTX,X0,X4,X,IMGCTX
"RTN","ORWTPD",44,0)
 S X0=$G(^ORD(101.24,RPT,0)),X4=$G(^(4))
"RTN","ORWTPD",45,0)
 I "02345"[($P(X0,U,7)),($P(X0,U)'="ORRP IMAGING") Q
"RTN","ORWTPD",46,0)
 S CTX="^DIV^SYS^PKG"
"RTN","ORWTPD",47,0)
 S Y=$$GET^XPAR("USR.`"_DUZ_CTX,"ORWRP TIME/OCC LIMITS INDV",RPT,"I")
"RTN","ORWTPD",48,0)
 S:'$L(Y) Y=$$GET^XPAR("USR.`"_DUZ_CTX,"ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",49,0)
 I $P(^ORD(101.24,RPT,0),U,7)=1 S $P(Y,";",3)=""
"RTN","ORWTPD",50,0)
 I $P(X4,"^",2) S X=$P($P(Y,";"),"-",2) I X,X>$P(X4,"^",2) S Y="T-"_$P(X4,"^",2)_";"_$P(Y,";",2,99)
"RTN","ORWTPD",51,0)
 Q
"RTN","ORWTPD",52,0)
 ;
"RTN","ORWTPD",53,0)
 ;
"RTN","ORWTPD",54,0)
GETSETS(Y) ;----Get time/occ limit set for each report
"RTN","ORWTPD",55,0)
 N I,CNT,CAT S I=0,CNT=1,RST=""
"RTN","ORWTPD",56,0)
 F  S I=$O(^ORD(101.24,I)) Q:'I   D
"RTN","ORWTPD",57,0)
 .I $P($G(^ORD(101.24,I,0)),U,8)="R",$P($G(^ORD(101.24,I,0)),U,12)'="M" D
"RTN","ORWTPD",58,0)
 ..S CAT=$P(^ORD(101.24,I,0),U,7) I $S(CAT=1:1,CAT=6:1,1:0)!($P(^(0),U)="ORRP IMAGING") D
"RTN","ORWTPD",59,0)
 ...D GETINDV(.RST,I)
"RTN","ORWTPD",60,0)
 ...I $L($P(^ORD(101.24,I,2),U,4))>0 S Y(CNT)=I_U_$P(^ORD(101.24,I,2),U,4)_U_RST
"RTN","ORWTPD",61,0)
 ...E  S Y(CNT)=I_U_$P(^ORD(101.24,I,2),U,3)_U_RST
"RTN","ORWTPD",62,0)
 ... S CNT=CNT+1
"RTN","ORWTPD",63,0)
 K I,CNT,RST,CAT
"RTN","ORWTPD",64,0)
 Q
"RTN","ORWTPD",65,0)
 ;
"RTN","ORWTPD",66,0)
GETDFLT(Y) ;----Get default time/occ limits for all reports
"RTN","ORWTPD",67,0)
 N VALUE
"RTN","ORWTPD",68,0)
 S Y=$$GET^XPAR("USR.`"_DUZ_"^DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",69,0)
 K VALUE
"RTN","ORWTPD",70,0)
 Q
"RTN","ORWTPD",71,0)
 ;
"RTN","ORWTPD",72,0)
 ;
"RTN","ORWTPD",73,0)
RSDFLT(Y) ;----Retrieve sys/pkg level default time/occ setting
"RTN","ORWTPD",74,0)
 N VALUE
"RTN","ORWTPD",75,0)
 S Y=$$GET^XPAR("DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",76,0)
 Q
"RTN","ORWTPD",77,0)
 ;
"RTN","ORWTPD",78,0)
 ;
"RTN","ORWTPD",79,0)
DELDFLT(Y) ;----Delete user's default setting 
"RTN","ORWTPD",80,0)
 N ORERR S ORERR=""
"RTN","ORWTPD",81,0)
 D NDEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS INDV",.ORERR)
"RTN","ORWTPD",82,0)
 D DEL^XPAR(DUZ_";VA(200,","ORWRP TIME/OCC LIMITS ALL",1,.ORERR)
"RTN","ORWTPD",83,0)
 K ORERR
"RTN","ORWTPD",84,0)
 Q
"RTN","ORWTPD",85,0)
 ;
"RTN","ORWTPD",86,0)
 ;
"RTN","ORWTPD",87,0)
ACTDF(Y) ;----Make default setting take action for each report
"RTN","ORWTPD",88,0)
 N IND,DFLT,VALUE,X,X0,X4,MAX,DFLT1
"RTN","ORWTPD",89,0)
 S DFLT=$$GET^XPAR("USR.`"_DUZ_"^DIV^SYS^PKG","ORWRP TIME/OCC LIMITS ALL",1,"I")
"RTN","ORWTPD",90,0)
 S IND=0,X=$P($P(DFLT,";"),"-",2)
"RTN","ORWTPD",91,0)
 F  S IND=$O(^ORD(101.24,IND)) Q:'IND  S X0=$G(^(IND,0)),X4=$G(^(4)) D
"RTN","ORWTPD",92,0)
 . I $P(X0,"^",8)="R",$P(X0,"^",12)'="M" D
"RTN","ORWTPD",93,0)
 .. S MAX=$P(X4,"^",2),DFLT1=DFLT
"RTN","ORWTPD",94,0)
 .. I MAX,X,X>MAX S DFLT1="T-"_MAX_";"_$P(DFLT,";",2,99)
"RTN","ORWTPD",95,0)
 .. D SUINDV(.Y,IND,DFLT1)
"RTN","ORWTPD",96,0)
 Q
"RTN","ORX8")
0^39^B12860545
"RTN","ORX8",1,0)
ORX8 ; slc/dcm,MKB - OE/RR Orders file extracts ; 08 May 2002  2:12 PM
"RTN","ORX8",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**13,21,48,68,92,141**;Dec 17, 1997
"RTN","ORX8",3,0)
EN(ORIFN) ;Returns data from file 100 in the ORUPCHUK array [DBIA#871]
"RTN","ORX8",4,0)
 Q:'$D(ORIFN)  Q:'$D(^OR(100,+ORIFN,0))  K ORUPCHUK
"RTN","ORX8",5,0)
 D A
"RTN","ORX8",6,0)
 K ORTX,X0,X3,%X,%Y,J,ORINDX,X
"RTN","ORX8",7,0)
 Q
"RTN","ORX8",8,0)
A S X0=^OR(100,ORIFN,0),X3=^(3),ORUPCHUK("ORPK")=$S($D(^(4)):^(4),1:"")
"RTN","ORX8",9,0)
 S ORUPCHUK("ORVP")=$P(X0,"^",2),ORUPCHUK("ORPCL")=$P(X0,"^",5),X=$P(X0,"^",6),ORUPCHUK("ORDUZ")=X_"^"_$S($D(^VA(200,+X,0)):$P(^(0),"^"),1:""),ORUPCHUK("ORODT")=$P(X0,"^",7),ORUPCHUK("ORSTOP")=$P(X0,"^",9),ORUPCHUK("ORL")=$P(X0,"^",10)
"RTN","ORX8",10,0)
 S X=$P(X0,"^",11),ORUPCHUK("ORTO")=X_"^"_$S($D(^ORD(100.98,+X,0)):$P(^(0),"^"),1:"")
"RTN","ORX8",11,0)
 S X=$P(X3,"^",3),ORUPCHUK("ORSTS")=X_"^"_$P(^ORD(100.01,X,0),"^"),ORUPCHUK("ORSTRT")=$P(X0,"^",8),X=$P(X0,"^",4),(ORUPCHUK("ORNP"),ORUPCHUK("ORPV"))=X_"^"_$S(X:$S($D(^VA(200,+X,0)):$P(^(0),"^"),1:""),1:"")
"RTN","ORX8",12,0)
 D TEXT^ORQ12(.ORTX,ORIFN,$G(ORLENGTH))
"RTN","ORX8",13,0)
 I $O(ORTX(0)) S %X="ORTX(",%Y="ORUPCHUK(""ORTX""," D %XY^%RCR
"RTN","ORX8",14,0)
 Q
"RTN","ORX8",15,0)
 ;
"RTN","ORX8",16,0)
VALUE(IFN,ID,INST,FORMAT) ; -- Returns value of prompt by ID
"RTN","ORX8",17,0)
 I '$G(IFN)!('$D(^OR(100,+$G(IFN),0)))!($G(ID)="") Q ""
"RTN","ORX8",18,0)
 N I,Y S I=0,Y="" S:'$G(INST) INST=1
"RTN","ORX8",19,0)
 F  S I=$O(^OR(100,+IFN,4.5,"ID",ID,I)) Q:I'>0  I $P($G(^OR(100,+IFN,4.5,+I,0)),U,3)=INST S PRMT=+$P(^(0),U,2),Y=$G(^(1)) Q
"RTN","ORX8",20,0)
 I $L(Y),$G(PRMT),$G(FORMAT)="E" D  ; get external form of Y
"RTN","ORX8",21,0)
 . N ORDIALOG S ORDIALOG(PRMT,0)=$G(^ORD(101.41,PRMT,1))
"RTN","ORX8",22,0)
 . S ORDIALOG(PRMT,1)=Y,Y=$$EXT^ORCD(PRMT,1)
"RTN","ORX8",23,0)
 Q Y
"RTN","ORX8",24,0)
 ;
"RTN","ORX8",25,0)
OI(IFN) ; -- Returns [first] orderable item for order IFN in the format
"RTN","ORX8",26,0)
 ;    ifn ^ name ^ pkg id   [DBIA#2467]
"RTN","ORX8",27,0)
 I '$G(IFN)!('$D(^OR(100,+$G(IFN),0))) Q ""
"RTN","ORX8",28,0)
 N I,X,Y S I=$O(^OR(100,+IFN,.1,0)),X=$G(^(+I,0)),Y=""
"RTN","ORX8",29,0)
 I X,$D(^ORD(101.43,+X,0)) S Y=+X_U_$P(^(0),U,1,2)
"RTN","ORX8",30,0)
 Q Y
"RTN","ORX8",31,0)
 ;
"RTN","ORX8",32,0)
LATEST(ORPAT,ORIT,ORY) ; -- Return most recent orders for ORPAT,ORIT as
"RTN","ORX8",33,0)
 ;        ORY = total number of orders found (or 0 if none found)
"RTN","ORX8",34,0)
 ; ORY(ORSTS) = ORIFN ^ Ord'd By ^ Entered ^ StartDt ^ StopDt ^ Loc ^ Sts
"RTN","ORX8",35,0)
 ; where ORSTS is the ien in the Order Status file #100.01  [DBIA#2842]
"RTN","ORX8",36,0)
 ;
"RTN","ORX8",37,0)
 N ORVP,ORIDT,ORIFN,OR0,OR3,ORSTS,ORSTSNM
"RTN","ORX8",38,0)
 S ORVP=+ORPAT_";DPT(",ORY=0 Q:'$G(ORPAT)  Q:'$G(ORIT)  ;invalid input
"RTN","ORX8",39,0)
 S ORIDT=0 F  S ORIDT=$O(^OR(100,"AOI",+ORIT,ORVP,ORIDT)) Q:ORIDT'>0  D
"RTN","ORX8",40,0)
 . S ORIFN=0 F  S ORIFN=$O(^OR(100,"AOI",+ORIT,ORVP,ORIDT,ORIFN)) Q:ORIFN'>0  D
"RTN","ORX8",41,0)
 .. S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3)),ORSTS=+$P(OR3,U,3)
"RTN","ORX8",42,0)
 .. Q:ORSTS'>0  Q:$G(ORY(ORSTS))  ;return only latest order per status
"RTN","ORX8",43,0)
 .. S ORSTSNM=$$LOW^XLFSTR($P($G(^ORD(100.01,ORSTS,0)),U))
"RTN","ORX8",44,0)
 .. S ORY=ORY+1,ORY(ORSTS)=ORIFN_U_$P(OR0,U,4)_U_$P(OR0,U,7,10)_U_ORSTSNM
"RTN","ORX8",45,0)
 Q
"RTN","ORX8",46,0)
 ;
"RTN","ORX8",47,0)
DELAYED(ORY,ORDER) ; -- Return delayed order(s) with same OrdItem as ORDER
"RTN","ORX8",48,0)
 ;    in ORY(ORIFN) = PatEventPtr ^ EventName
"RTN","ORX8",49,0)
 ;
"RTN","ORX8",50,0)
 N ORI,ORIT,ORIFN S (ORY,ORI)=0
"RTN","ORX8",51,0)
 F  S ORI=$O(^OR(100,+ORDER,.1,ORI)) Q:ORI'>0  S ORIT=+$G(^(ORI,0)) D
"RTN","ORX8",52,0)
 . S EVT=0 F  S EVT=$O(^ORE(100.2,"AE",+ORVP,EVT)) Q:EVT<1  S PTEVT=+$O(^(EVT,0)) D  ;pending events
"RTN","ORX8",53,0)
 .. S ORIFN=0 F  S ORIFN=+$O(^OR(100,"AEVNT",ORVP,PTEVT,ORIFN)) Q:ORIFN<1  D  ;delayed orders
"RTN","ORX8",54,0)
 ... Q:ORIFN=+ORDER  Q:'$D(^OR(100,ORIFN,.1,"B",ORIT))
"RTN","ORX8",55,0)
 ... Q:"^1^2^7^12^13^14^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U)  ;terminated
"RTN","ORX8",56,0)
 ... S ORY=ORY+1,ORY(ORIFN)=PTEVT_U_$P($G(^ORD(100.5,EVT,0)),U)
"RTN","ORX8",57,0)
 Q
"RTN","ORX8",58,0)
 ;
"RTN","ORX8",59,0)
PKGID(ORIFN) ; -- Return package identifier for order ORIFN  [DBIA#3071]
"RTN","ORX8",60,0)
 Q $G(^OR(100,+$G(ORIFN),4))
"RTN","ORX8",61,0)
 ;
"RTN","ORX8",62,0)
ES(ORDER) ; -- Returns the signature status of ORDER
"RTN","ORX8",63,0)
 ;  -1 = invalid order#
"RTN","ORX8",64,0)
 ;  "" = no signature required
"RTN","ORX8",65,0)
 ;   0 = not signed (needs ES)
"RTN","ORX8",66,0)
 ;   1 = electronically or digitally signed
"RTN","ORX8",67,0)
 ;   2 = signed on chart
"RTN","ORX8",68,0)
 ;   3 = corrected or canceled order
"RTN","ORX8",69,0)
 N X,Y,DA I '$G(ORDER)!'$D(^OR(100,+$G(ORDER),0)) Q -1
"RTN","ORX8",70,0)
 S DA=+$P(ORDER,";",2) S:DA<1 DA=+$P($G(^OR(100,+ORDER,3)),U,7)
"RTN","ORX8",71,0)
 S X=$P($G(^OR(100,+ORDER,8,DA,0)),U,4)
"RTN","ORX8",72,0)
 S Y=$S(X=2:0,X=1!(X=7):1,X=0!(X=4):2,X=5!(X=6):3,1:"")
"RTN","ORX8",73,0)
 Q Y
"RTN","ORY141")
0^56^B6122701
"RTN","ORY141",1,0)
ORY141 ;SLC/REV/JLI -- postinit rtn for OR*3*141 ;12/13/01  06:25 [5/21/02 2:02pm]   6/7/02 1:33PM  [11/14/02 2:39pm]
"RTN","ORY141",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORY141",3,0)
 ;
"RTN","ORY141",4,0)
 Q
"RTN","ORY141",5,0)
 ;
"RTN","ORY141",6,0)
PRE ; -- preinit
"RTN","ORY141",7,0)
 D PRE^ORY141ED
"RTN","ORY141",8,0)
 Q
"RTN","ORY141",9,0)
 ;
"RTN","ORY141",10,0)
POST ; -- postinit
"RTN","ORY141",11,0)
 ;
"RTN","ORY141",12,0)
 N VER
"RTN","ORY141",13,0)
 ;
"RTN","ORY141",14,0)
 S VER=$P($T(VERSION^ORY141),";",3)
"RTN","ORY141",15,0)
 I +$$PATCH^XPDUTL("TIU*1.0*112") D SURGREG
"RTN","ORY141",16,0)
 D POST^ORY141ED
"RTN","ORY141",17,0)
 D POST^ORY141EC
"RTN","ORY141",18,0)
 D CLNXPAR
"RTN","ORY141",19,0)
 D CURCLT
"RTN","ORY141",20,0)
 D MAIL
"RTN","ORY141",21,0)
 ;
"RTN","ORY141",22,0)
 Q
"RTN","ORY141",23,0)
 ;
"RTN","ORY141",24,0)
CLNXPAR ;Clear up the value of frmOrders.hdrOrders for 
"RTN","ORY141",25,0)
 ;parameter ORWCH COLUMNS"
"RTN","ORY141",26,0)
 N XPID,UID,COLID,DIK
"RTN","ORY141",27,0)
 S UID=0
"RTN","ORY141",28,0)
 S XPID=$O(^XTV(8989.51,"B","ORWCH COLUMNS",0))
"RTN","ORY141",29,0)
 S DIK="^XTV(8989.5,"
"RTN","ORY141",30,0)
 F  S UID=$O(^XTV(8989.5,"AC",XPID,UID)) Q:'+UID  D
"RTN","ORY141",31,0)
 . I $D(^XTV(8989.5,"AC",XPID,UID,"frmOrders.hdrOrders")) D
"RTN","ORY141",32,0)
 .. S COLID=0
"RTN","ORY141",33,0)
 .. S COLID=$O(^XTV(8989.5,"AC",XPID,UID,"frmOrders.hdrOrders",0))
"RTN","ORY141",34,0)
 .. I COLID S DA=COLID D ^DIK
"RTN","ORY141",35,0)
 Q
"RTN","ORY141",36,0)
 ;
"RTN","ORY141",37,0)
CURCLT ; Only Current Client Allowed
"RTN","ORY141",38,0)
 D EN^XPAR("SYS","ORWOR REQUIRE CURRENT CLIENT",1,1)
"RTN","ORY141",39,0)
 Q
"RTN","ORY141",40,0)
 ;
"RTN","ORY141",41,0)
SURGREG ; Register TIU SURGERY RPCs if TIU*1.0*112 present
"RTN","ORY141",42,0)
 N MENU,RPC
"RTN","ORY141",43,0)
 S MENU="OR CPRS GUI CHART"
"RTN","ORY141",44,0)
 F RPC="TIU IS THIS A SURGERY?","TIU IDENTIFY SURGERY CLASS","TIU LONG LIST SURGERY TITLES" D INSERT(MENU,RPC)
"RTN","ORY141",45,0)
 Q
"RTN","ORY141",46,0)
 ;
"RTN","ORY141",47,0)
INSERT(OPTION,RPC)      ; Call FM Updater with each RPC
"RTN","ORY141",48,0)
 ; Input  -- OPTION   Option file (#19) Name field (#.01)
"RTN","ORY141",49,0)
 ;           RPC      RPC sub-file (#19.05) RPC field (#.01)
"RTN","ORY141",50,0)
 ; Output -- None
"RTN","ORY141",51,0)
 N FDA,FDAIEN,ERR,DIERR
"RTN","ORY141",52,0)
 S FDA(19,"?1,",.01)=OPTION
"RTN","ORY141",53,0)
 S FDA(19.05,"?+2,?1,",.01)=RPC
"RTN","ORY141",54,0)
 D UPDATE^DIE("E","FDA","FDAIEN","ERR")
"RTN","ORY141",55,0)
 Q
"RTN","ORY141",56,0)
 ;
"RTN","ORY141",57,0)
MAIL ; send bulletin of installation time
"RTN","ORY141",58,0)
 N COUNT,DIFROM,I,START,TEXT,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","ORY141",59,0)
 S COUNT=0
"RTN","ORY141",60,0)
 S XMSUB="Version "_$P($T(VERSION),";;",2)_" Installed"
"RTN","ORY141",61,0)
 S XMDUZ="CPRS PACKAGE"
"RTN","ORY141",62,0)
 F I="G.CPRS GUI INSTALL@ISC-SLC.VA.GOV",DUZ S XMY(I)=""
"RTN","ORY141",63,0)
 S XMTEXT="TEXT("
"RTN","ORY141",64,0)
 ;
"RTN","ORY141",65,0)
 S X=$P($T(VERSION),";;",2)
"RTN","ORY141",66,0)
 D LINE("Version "_X_" has been installed.")
"RTN","ORY141",67,0)
 D LINE(" ")
"RTN","ORY141",68,0)
 D LINE("Install complete:  "_$$FMTE^XLFDT($$NOW^XLFDT()))
"RTN","ORY141",69,0)
 ;
"RTN","ORY141",70,0)
 D ^XMD
"RTN","ORY141",71,0)
 Q
"RTN","ORY141",72,0)
 ;
"RTN","ORY141",73,0)
LINE(DATA)      ; set text into array
"RTN","ORY141",74,0)
 S COUNT=COUNT+1
"RTN","ORY141",75,0)
 S TEXT(COUNT)=DATA
"RTN","ORY141",76,0)
 Q
"RTN","ORY141",77,0)
 ;
"RTN","ORY141",78,0)
VERSION ;;20.21
"RTN","ORY141EC")
0^75^B6295445
"RTN","ORY141EC",1,0)
ORY141EC ; SLC/JDL Event Capture Report ;6/14/02  13:06
"RTN","ORY141EC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORY141EC",3,0)
 ;
"RTN","ORY141EC",4,0)
POST ;Add ECS report to 101.24 and parameter ORWRP REPORT LIST
"RTN","ORY141EC",5,0)
 ;
"RTN","ORY141EC",6,0)
 D CHKEC
"RTN","ORY141EC",7,0)
 ;
"RTN","ORY141EC",8,0)
 ;Add ECS report entry to 101.24
"RTN","ORY141EC",9,0)
 ;
"RTN","ORY141EC",10,0)
 N ECPCE0,ECPCE2,ECPT0,ECPT2,ECS0,ECS2,PCEIEN,PTIEN,ECIEN
"RTN","ORY141EC",11,0)
 S ECPCE0="ORRP ECS PCE SUMMARY^OR_ECS1^^2^^^1^R^1^^^R"
"RTN","ORY141EC",12,0)
 S ECPCE2="^^Patient PCE Summary^Report from Event Capture"
"RTN","ORY141EC",13,0)
 S PCEIEN=$$ADDEC(ECPCE0,ECPCE2,"","")
"RTN","ORY141EC",14,0)
 S ECPT0="ORRP ECS PT SUMMARY^OR_ECS2^^2^^^1^R^1^^^R"
"RTN","ORY141EC",15,0)
 S ECPT2="^^Patient Data Summary^Report from Event Capture"
"RTN","ORY141EC",16,0)
 S PTIEN=$$ADDEC(ECPT0,ECPT2,"","")
"RTN","ORY141EC",17,0)
 S ECS0="ORRP ECS^OR_ECS^^^^^^R^1^^^M"
"RTN","ORY141EC",18,0)
 S ECS2="^^Event Capture^Event Capture Report"
"RTN","ORY141EC",19,0)
 S ECIEN=$$ADDEC(ECS0,ECS2,PCEIEN,PTIEN)
"RTN","ORY141EC",20,0)
 ;
"RTN","ORY141EC",21,0)
 ;Add ECS report to Reports tab
"RTN","ORY141EC",22,0)
 ;
"RTN","ORY141EC",23,0)
 N OREC,ORI,ORP,ORT,FOUND,ORLST,ORERR
"RTN","ORY141EC",24,0)
 S ORERR=""
"RTN","ORY141EC",25,0)
 S ORP="ORWRP REPORT LIST",ORT=$O(^ORD(101.24,"B","ORRP ECS",0))
"RTN","ORY141EC",26,0)
 S OREC=$O(^ORD(101.24,"B","ORRP ECS",0)),ORI=0,FOUND=0
"RTN","ORY141EC",27,0)
 D GETLST^XPAR(.ORLST,"PKG",ORP,"Q",.ORERR)
"RTN","ORY141EC",28,0)
 F  S ORI=$O(ORLST(ORI)) Q:+ORI=0!(FOUND)  D
"RTN","ORY141EC",29,0)
 . S:$P(ORLST(ORI),U,2)=OREC FOUND=1
"RTN","ORY141EC",30,0)
 Q:+FOUND
"RTN","ORY141EC",31,0)
 S ORS=+ORLST(ORLST)+5
"RTN","ORY141EC",32,0)
 D PUT^XPAR("PKG",ORP,ORS,ORT)
"RTN","ORY141EC",33,0)
 Q
"RTN","ORY141EC",34,0)
 ;
"RTN","ORY141EC",35,0)
ADDEC(ND0,ND2,PCEID,PTID) ;Add ECS report to 101.24
"RTN","ORY141EC",36,0)
 N Y,I,LAST,TOTAL,HDR
"RTN","ORY141EC",37,0)
 S Y=0
"RTN","ORY141EC",38,0)
 S HDR=$G(^ORD(101.24,0)),TOTAL=$P(HDR,U,4),LAST=$O(^ORD(101.24,"?"),-1)
"RTN","ORY141EC",39,0)
 F I=1:1:10 L +^ORD(101.24,0):1 Q:$T  H 2
"RTN","ORY141EC",40,0)
 S I=LAST F I=(I+1):1 Q:'$D(^ORD(101.24,I,0))
"RTN","ORY141EC",41,0)
 S Y=I,$P(HDR,U,3,4)=Y_U_(TOTAL+1)
"RTN","ORY141EC",42,0)
 S ^ORD(101.24,0)=HDR L -^ORD(101.24,0)
"RTN","ORY141EC",43,0)
 I $P(ND0,U,2)="OR_ECS" D
"RTN","ORY141EC",44,0)
 . S ^ORD(101.24,Y,0)=ND0
"RTN","ORY141EC",45,0)
 . S ^ORD(101.24,Y,2)=ND2
"RTN","ORY141EC",46,0)
 . S ^ORD(101.24,Y,10,0)="^101.241P^2^2"
"RTN","ORY141EC",47,0)
 . S ^ORD(101.24,Y,10,1,0)=PCEID_"^^1"
"RTN","ORY141EC",48,0)
 . S ^ORD(101.24,Y,10,2,0)=PTID_"^^2"
"RTN","ORY141EC",49,0)
 . S ^ORD(101.24,Y,10,"B",PCEID,1)=""
"RTN","ORY141EC",50,0)
 . S ^ORD(101.24,Y,10,"B",PTID,2)=""
"RTN","ORY141EC",51,0)
 . S ^ORD(101.24,"AC",$P(ND0,U,2),Y)=""
"RTN","ORY141EC",52,0)
 . S ^ORD(101.24,"B",$P(ND0,U,1),Y)=""
"RTN","ORY141EC",53,0)
 E  D
"RTN","ORY141EC",54,0)
 . S ^ORD(101.24,Y,0)=ND0
"RTN","ORY141EC",55,0)
 . S ^ORD(101.24,Y,2)=ND2
"RTN","ORY141EC",56,0)
 . S ^ORD(101.24,"AC",$P(ND0,U,2),Y)=""
"RTN","ORY141EC",57,0)
 . S ^ORD(101.24,"B",$P(ND0,U,1),Y)=""
"RTN","ORY141EC",58,0)
 Q Y
"RTN","ORY141EC",59,0)
 ;
"RTN","ORY141EC",60,0)
CHKEC ;Check and Delete ECS entry from 101.24 and ORWRP REPROT LIST
"RTN","ORY141EC",61,0)
 N ORI,DA,DIK,X0
"RTN","ORY141EC",62,0)
 S ORI=0
"RTN","ORY141EC",63,0)
 F  S ORI=$O(^ORD(101.24,ORI)) Q:'ORI  D
"RTN","ORY141EC",64,0)
 . S X0=$P(^ORD(101.24,ORI,0),U,2)
"RTN","ORY141EC",65,0)
 . I (X0="OR_ECS")!(X0="OR_ECS1")!(X0="OR_ECS2") D
"RTN","ORY141EC",66,0)
 . . S DA=ORI,DIK="^ORD(101.24," D ^DIK
"RTN","ORY141EC",67,0)
 Q
"RTN","ORY141ED")
0^48^B73105019
"RTN","ORY141ED",1,0)
ORY141ED ; SLC/MKB - EDO inits for patch OR*3*141 ;8/19/02  10:45
"RTN","ORY141ED",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORY141ED",3,0)
 ;
"RTN","ORY141ED",4,0)
PRE ; -- preinit: remove old DD's
"RTN","ORY141ED",5,0)
 Q:$O(^ORD(101,"B","ORC DELAYED ORDERS",0))  ;not 1st install
"RTN","ORY141ED",6,0)
 N DIU,ORNOW,XMDUZ,XMDUN,XMY,X,XMOUT
"RTN","ORY141ED",7,0)
 S DIU="^OR(100.2,",DIU(0)="DST" D EN^DIU2 ;remove old DD
"RTN","ORY141ED",8,0)
 D DELIX^DDMOD(100,.02,4),DELIX^DDMOD(100,15,1) ;remove old AEVNT xrefs
"RTN","ORY141ED",9,0)
 S ORNOW=$$NOW^XLFDT K ^XTMP("ORYED")
"RTN","ORY141ED",10,0)
 S ^XTMP("ORYED",0)=$$FMADD^XLFDT(ORNOW,90)_U_ORNOW_"^OR*3*141 Delay Event Conversion"
"RTN","ORY141ED",11,0)
 W !!,"A mail message will be generated when the post-init conversion has completed."
"RTN","ORY141ED",12,0)
 S XMDUZ=DUZ,XMDUN=$P($G(^VA(200,DUZ,0)),U) D DEST^XMA21
"RTN","ORY141ED",13,0)
 I $D(XMOUT) W !!,$C(7),"Only the installer of this patch will receive the conversion bulletin!" S XMY(DUZ)=""
"RTN","ORY141ED",14,0)
 M ^XTMP("ORYED","XMY")=XMY
"RTN","ORY141ED",15,0)
 Q
"RTN","ORY141ED",16,0)
 ;
"RTN","ORY141ED",17,0)
DLGSEND(X) ; -- Send order dialog X?
"RTN","ORY141ED",18,0)
 I X="LR OTHER LAB TESTS" Q 1
"RTN","ORY141ED",19,0)
 I X="RA OERR EXAM" Q 1
"RTN","ORY141ED",20,0)
 I X="PS MEDS" Q 1
"RTN","ORY141ED",21,0)
 I X="PSJ OR PAT OE" Q 1
"RTN","ORY141ED",22,0)
 I X="PSO OERR" Q 1
"RTN","ORY141ED",23,0)
 I X="PSO SUPPLY" Q 1
"RTN","ORY141ED",24,0)
 I X="OR GXMOVE ADMIT PATIENT" Q 1
"RTN","ORY141ED",25,0)
 I X="OR GXMOVE DISCHARGE" Q 1
"RTN","ORY141ED",26,0)
 I X="OR GXMOVE TRANSFER" Q 1
"RTN","ORY141ED",27,0)
 I X="OR GXMOVE TREATING SPECIALTY" Q 1
"RTN","ORY141ED",28,0)
 Q 0
"RTN","ORY141ED",29,0)
 ;
"RTN","ORY141ED",30,0)
POST ; -- postinit: convert orders, remove old parameters
"RTN","ORY141ED",31,0)
 S ^ORD(100.01,10,.1)="dly"
"RTN","ORY141ED",32,0)
 S ^ORD(100.01,13,1,1,0)="Orders that have been rejected by the ancillary service without being"
"RTN","ORY141ED",33,0)
 S ^ORD(100.01,13,1,2,0)="acted on, or terminated while still delayed."
"RTN","ORY141ED",34,0)
 K ^DIC(100.5,0,"RD"),^DIC(100.6,0,"RD") ;remove read access
"RTN","ORY141ED",35,0)
 D 101,AEVNT,PARAMS,DLGS,C
"RTN","ORY141ED",36,0)
 Q
"RTN","ORY141ED",37,0)
 ;
"RTN","ORY141ED",38,0)
AEVNT ; -- postinit: convert Event field #15 of Orders file #100
"RTN","ORY141ED",39,0)
 ;    from code (A/D/T) to pointer to #100.2
"RTN","ORY141ED",40,0)
 ;    (incl a report of bad data, lapsed orders)
"RTN","ORY141ED",41,0)
 ;
"RTN","ORY141ED",42,0)
 Q:'$D(^XTMP("ORYED","XMY"))  ;not 1st install
"RTN","ORY141ED",43,0)
 N ORPARAM,ORLAPSE,ORSITE,ORVP,ORDIED,OREVT,ORIFN,OR0,OR3,ORTS,ORL,ORDIV,ORX,ORNOW,ORPTEVT
"RTN","ORY141ED",44,0)
 S ORPARAM=+$$GET^XPAR("ALL","OR DELAYED ORDERS LAPSE DAYS"),ORLAPSE=0
"RTN","ORY141ED",45,0)
 S:ORPARAM ORLAPSE=$$FMADD^XLFDT(DT,(0-ORPARAM)) ;=0 or cutoff date
"RTN","ORY141ED",46,0)
 S ORNOW=$$NOW^XLFDT,ORSITE=+$$SITE^VASITE ;[primary] division
"RTN","ORY141ED",47,0)
 S ORVP="" F  S ORVP=$O(^OR(100,"AEVNT",ORVP)) Q:ORVP=""  D
"RTN","ORY141ED",48,0)
 . S ORL="",ORDIED=+$G(^DPT(+ORVP,.35)) I $L($G(^(.1))) S ORL=+$O(^DIC(42,"B",^(.1),0)),ORL=$G(^DIC(42,ORL,44))
"RTN","ORY141ED",49,0)
 . F OREVT="A","T","D" S ORIFN=0 D
"RTN","ORY141ED",50,0)
 .. F  S ORIFN=+$O(^OR(100,"AEVNT",ORVP,OREVT,ORIFN)) Q:ORIFN<1  D
"RTN","ORY141ED",51,0)
 ... S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)) I '$L($P(OR0,U,17)) D CLEAR Q
"RTN","ORY141ED",52,0)
 ... S ORX=$P(OR0,U,10) S:'ORX ORX=ORL
"RTN","ORY141ED",53,0)
 ... S ORDIV=$$DIV^OREVNTX(ORX) S:ORDIV<1 ORDIV=ORSITE
"RTN","ORY141ED",54,0)
 ... I $P(OR3,U,3)'=10 D CLEAR,ERR(1) Q  ;discharge meds
"RTN","ORY141ED",55,0)
 ... S ORTS=+$P(OR0,U,13) I OREVT'="D",ORTS<1 D STATUS^ORCSAVE2(ORIFN,13),CLEAR,ERR(2) Q  ;error
"RTN","ORY141ED",56,0)
 ... I $P(OR0,U,7)<ORLAPSE D STATUS^ORCSAVE2(ORIFN,14),CLEAR,ERR(3) Q
"RTN","ORY141ED",57,0)
 ... I ORDIED D CANCEL,CLEAR,ERR(4) Q
"RTN","ORY141ED",58,0)
 ... S ORX=OREVT_U_$S(OREVT'="D":ORTS,1:"")_U_ORDIV
"RTN","ORY141ED",59,0)
 ... S ^XTMP("ORYED","EVT",ORX)="",^(ORX,ORVP)="",^(ORVP,ORIFN)=""
"RTN","ORY141ED",60,0)
 Q:'$L($O(^XTMP("ORYED","EVT","")))  ;no delayed orders to convert
"RTN","ORY141ED",61,0)
AE1 S ORX="" F  S ORX=$O(^XTMP("ORYED","EVT",ORX)) Q:ORX=""  D
"RTN","ORY141ED",62,0)
 . S OREVT=$$EVENT(ORX) Q:OREVT<1  S ^XTMP("ORYED","EVT",ORX)=OREVT
"RTN","ORY141ED",63,0)
 . S ORVP="" F  S ORVP=$O(^XTMP("ORYED","EVT",ORX,ORVP)) Q:ORVP=""  D
"RTN","ORY141ED",64,0)
 .. S ORPTEVT=$$NEW^OREVNT(+ORVP,+OREVT) Q:ORPTEVT<1
"RTN","ORY141ED",65,0)
 .. S ^XTMP("ORYED","EVT",ORX,ORVP)=ORPTEVT D SET(ORVP,ORX,OREVT)
"RTN","ORY141ED",66,0)
 .. S ORIFN=0 F  S ORIFN=+$O(^XTMP("ORYED","EVT",ORX,ORVP,ORIFN)) Q:ORIFN<1  D
"RTN","ORY141ED",67,0)
 ... S $P(^OR(100,ORIFN,0),U,17)=ORPTEVT
"RTN","ORY141ED",68,0)
 ... K ^OR(100,"AEVNT",ORVP,$P(ORX,U),ORIFN)
"RTN","ORY141ED",69,0)
 ... S ^OR(100,"AEVNT",ORVP,ORPTEVT,ORIFN)=""
"RTN","ORY141ED",70,0)
 D BULLETIN K ^XTMP("ORYED","XMY")
"RTN","ORY141ED",71,0)
 Q
"RTN","ORY141ED",72,0)
 ;
"RTN","ORY141ED",73,0)
CANCEL ; -- Cancel order for deceased patient
"RTN","ORY141ED",74,0)
 S ^OR(100,ORIFN,6)=$O(^ORD(100.02,"C","A",0))_U_U_ORNOW_U_+$O(^ORD(100.03,"C","ORDEATH",0))
"RTN","ORY141ED",75,0)
 D STATUS^ORCSAVE2(ORIFN,13) S $P(^OR(100,ORIFN,8,1,0),U,15)=13
"RTN","ORY141ED",76,0)
 Q
"RTN","ORY141ED",77,0)
 ;
"RTN","ORY141ED",78,0)
CLEAR ; -- Clear Event code field
"RTN","ORY141ED",79,0)
 S $P(^OR(100,ORIFN,0),U,17)="" S:$P($G(^(8,1,0)),U,15)=10 $P(^(0),U,15)=""
"RTN","ORY141ED",80,0)
 K ^OR(100,"AEVNT",ORVP,OREVT,ORIFN)
"RTN","ORY141ED",81,0)
 Q
"RTN","ORY141ED",82,0)
 ;
"RTN","ORY141ED",83,0)
EVENT(X) ; -- Find (or create) event in #100.5 for
"RTN","ORY141ED",84,0)
 ;    X = A/D/T ^ [TS] ^ DIV ptr
"RTN","ORY141ED",85,0)
 N I,Y,TS,DIV,ORY,X0,MVT,ORGLOB
"RTN","ORY141ED",86,0)
 S TS=+$P(X,U,2),DIV=+$P(X,U,3),X=$P(X,U),Y=0 K ORY
"RTN","ORY141ED",87,0)
 S I=0 F  S I=+$O(^ORD(100.5,"ADT",X,I))  Q:I<1  D  ;find matches
"RTN","ORY141ED",88,0)
 . S X0=$G(^ORD(100.5,I,0)) Q:DIV'=$P(X0,U,3)
"RTN","ORY141ED",89,0)
 . I TS Q:'$O(^ORD(100.5,I,"TS","B",TS,0))
"RTN","ORY141ED",90,0)
 . S MVT=+$P(X0,U,7) I MVT Q:$S(X="A":MVT'=15,X="T":MVT'=4,1:MVT'=16)
"RTN","ORY141ED",91,0)
 . S ORY(+$G(^ORD(100.5,I,1)),MVT,I)="" ;=ORY(InactDt,MvtType,IEN)
"RTN","ORY141ED",92,0)
 S I="ORY",I=$Q(@I),Y=+$P(I,",",3)
"RTN","ORY141ED",93,0)
 I Y<1 D  ;create new inactive event
"RTN","ORY141ED",94,0)
 . N I,HDR,LAST,TOTAL,DA,NAME
"RTN","ORY141ED",95,0)
 . F I=1:1:10 L +^ORD(100.5,0):1 Q:$T  H 2
"RTN","ORY141ED",96,0)
 . I '$T S Y="" Q
"RTN","ORY141ED",97,0)
 . S HDR=$G(^ORD(100.5,0)),TOTAL=$P(HDR,U,4),LAST=$O(^ORD(100.5,"?"),-1)
"RTN","ORY141ED",98,0)
 . S I=LAST F I=(I+1):1 Q:'$D(^ORD(100.5,I,0))
"RTN","ORY141ED",99,0)
 . S Y=I,$P(HDR,U,3,4)=Y_U_(TOTAL+1)
"RTN","ORY141ED",100,0)
 . S ^ORD(100.5,0)=HDR L -^ORD(100.5,0)
"RTN","ORY141ED",101,0)
 . S NAME=$S(X="A":"ADMIT",X="T":"TRANSFER",X="D":"DISCHARGE",1:"")_$S(TS:" TO "_$P($G(^DIC(45.7,+TS,0)),U),1:"")_" ("_DIV_")"
"RTN","ORY141ED",102,0)
 . S ^ORD(100.5,Y,0)=NAME_U_X_U_DIV_"^^^"_ORPARAM_"^^"_NAME,^(1)=ORNOW
"RTN","ORY141ED",103,0)
 . S ^ORD(100.5,"B",$E(NAME,1,30),Y)="",^ORD(100.5,"ADT",X,Y)=""
"RTN","ORY141ED",104,0)
 . I TS S ^ORD(100.5,Y,"TS",0)="^100.51P^1^1",^(1,0)=TS,^ORD(100.5,Y,"TS","B",TS,1)=""
"RTN","ORY141ED",105,0)
 . S ORGLOB="^ORD(100.5," D AUDIT^OREV(Y,"N") ;Set edit history for new rule
"RTN","ORY141ED",106,0)
 Q Y
"RTN","ORY141ED",107,0)
 ;
"RTN","ORY141ED",108,0)
ERR(X) ; -- Track orders unable to convert
"RTN","ORY141ED",109,0)
 N MSG,STS S X=+$G(X),STS=$P(OR3,U,3)
"RTN","ORY141ED",110,0)
 S MSG=$S(X=2:"<Missing or invalid specialty>",X=3!(STS=14):"<Lapsed>",STS=12:"<Changed>",STS=1!(STS=13):"<Cancelled>",1:"<Already released>")
"RTN","ORY141ED",111,0)
 S ^XTMP("ORYED","ERR",ORVP,ORIFN)=OREVT_U_$G(ORTS)_U_MSG
"RTN","ORY141ED",112,0)
 ; Include missing TS, newly lapsed orders in bulletin:
"RTN","ORY141ED",113,0)
 ;D:X>1 SET(ORVP,OREVT_U_$G(ORTS)_U_ORDIV,MSG)
"RTN","ORY141ED",114,0)
 Q
"RTN","ORY141ED",115,0)
 ;
"RTN","ORY141ED",116,0)
SET(PAT,OLD,NEW) ; -- set xref nodes in XTMP for bulletin
"RTN","ORY141ED",117,0)
 N PNM,EVT,DIV,DIVNM,TS,NEWNM
"RTN","ORY141ED",118,0)
 S PNM=$P($G(^DPT(+PAT,0)),U)_" ("_$P($G(^(.36)),U,4)_")"
"RTN","ORY141ED",119,0)
 S EVT=$P(OLD,U) S:EVT="D" TS="none" I "AT"[EVT D
"RTN","ORY141ED",120,0)
 . S TS=$P(OLD,U,2),X0=$S(TS:$G(^DIC(45.7,+TS,0)),1:"unk")
"RTN","ORY141ED",121,0)
 . S TS=$S($L($P(X0,U,5)):$P(X0,U,5),1:$E($P(X0,U),1,5))
"RTN","ORY141ED",122,0)
 S DIV=+$P(OLD,U,3),DIVNM=$S(DIV:$P($G(^DIC(4,DIV,0)),U),1:"UNKNOWN")
"RTN","ORY141ED",123,0)
 S NEWNM=$S(NEW:$P($G(^ORD(100.5,+NEW,0)),U),1:NEW) ;EvtNm or ErrMsg
"RTN","ORY141ED",124,0)
 S ^XTMP("ORYED","B",DIVNM,EVT,TS)=NEWNM,^(TS,PNM)=OLD_"~"_PAT
"RTN","ORY141ED",125,0)
 Q
"RTN","ORY141ED",126,0)
 ;
"RTN","ORY141ED",127,0)
BULLETIN ; -- send bulletin when finished
"RTN","ORY141ED",128,0)
 N DIFROM,XMSUB,XMTEXT,XMDUZ,XMY,XMZ,XMMG,I,J,ORZ,DIV,EVT,TS,NEWEVT,X,PAT,ORX,ORVP,ORIFN,ORDERS,MAX
"RTN","ORY141ED",129,0)
 S XMDUZ="PATCH OR*3*141 CONVERSION",XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","ORY141ED",130,0)
 I $D(^XTMP("ORYED","XMY")) M XMY=^XTMP("ORYED","XMY") ;recipients
"RTN","ORY141ED",131,0)
 S ^TMP("ORTXT",$J,1)="The Delayed Order conversion of patch OR*3*141 has completed."
"RTN","ORY141ED",132,0)
B1 S I=1 I $D(^XTMP("ORYED","B")) D
"RTN","ORY141ED",133,0)
 . S I=I+1,^TMP("ORTXT",$J,I)="   "
"RTN","ORY141ED",134,0)
 . S I=I+1,^TMP("ORTXT",$J,I)="The following patients had delayed orders at the time of installation."
"RTN","ORY141ED",135,0)
 . S I=I+1,^TMP("ORTXT",$J,I)="For each, any event codes and treating specialties formerly in use are"
"RTN","ORY141ED",136,0)
 . S I=I+1,^TMP("ORTXT",$J,I)="listed on the left, with the new entry it was mapped to in the OE/RR"
"RTN","ORY141ED",137,0)
 . S I=I+1,^TMP("ORTXT",$J,I)="RELEASE EVENTS file #100.5, if possible, on the right:"
"RTN","ORY141ED",138,0)
 . S DIV="" F  S DIV=$O(^XTMP("ORYED","B",DIV)) Q:DIV=""  D
"RTN","ORY141ED",139,0)
 .. S I=I+1,^TMP("ORTXT",$J,I)="   "
"RTN","ORY141ED",140,0)
 .. S I=I+1,^TMP("ORTXT",$J,I)=DIV_":",ORZ=$$REPEAT^XLFSTR("-",$L(DIV))
"RTN","ORY141ED",141,0)
 .. F EVT="A","T","D" S TS="" F  S TS=$O(^XTMP("ORYED","B",DIV,EVT,TS)) Q:TS=""  S NEWEVT=$G(^(TS)) D
"RTN","ORY141ED",142,0)
 ... S I=I+1,^TMP("ORTXT",$J,I)=ORZ,ORZ="   "
"RTN","ORY141ED",143,0)
 ... S X=$S(EVT="D":"DISCHARGE",1:EVT_"/"_TS)
"RTN","ORY141ED",144,0)
 ... S I=I+1,^TMP("ORTXT",$J,I)=$$LJ^XLFSTR(X,9)_" => "_NEWEVT
"RTN","ORY141ED",145,0)
 ... S PAT="" F  S PAT=$O(^XTMP("ORYED","B",DIV,EVT,TS,PAT)) Q:PAT=""  S ORX=$G(^(PAT)) D
"RTN","ORY141ED",146,0)
 .... S ORVP=$P(ORX,"~",2),ORX=$P(ORX,"~"),MAX=68-$L(PAT)
"RTN","ORY141ED",147,0)
 .... S (ORIFN,ORDERS)=0,X="#"
"RTN","ORY141ED",148,0)
 .... F  S ORIFN=+$O(^XTMP("ORYED","EVT",ORX,ORVP,ORIFN)) Q:ORIFN<1  D
"RTN","ORY141ED",149,0)
 ..... I $L(X)+$L(ORIFN)+1'>MAX S X=X_$S($L(X)>1:",",1:"")_ORIFN Q
"RTN","ORY141ED",150,0)
 ..... S ORDERS=ORDERS+1,ORDERS(ORDERS)=X_",",X=ORIFN
"RTN","ORY141ED",151,0)
 .... S ORDERS=ORDERS+1,ORDERS(ORDERS)=X,X=" "_PAT_": "
"RTN","ORY141ED",152,0)
 .... F J=1:1:ORDERS S I=I+1,^TMP("ORTXT",$J,I)=X_ORDERS(J),X="   "
"RTN","ORY141ED",153,0)
 S XMSUB="PATCH OR*3*141 CONVERSION COMPLETED"
"RTN","ORY141ED",154,0)
 S XMTEXT="^TMP(""ORTXT"","_$J_"," D ^XMD
"RTN","ORY141ED",155,0)
 K ^TMP("ORTXT",$J)
"RTN","ORY141ED",156,0)
 Q
"RTN","ORY141ED",157,0)
 ;
"RTN","ORY141ED",158,0)
PARAMS ; -- Remove old parameters, template
"RTN","ORY141ED",159,0)
 ;
"RTN","ORY141ED",160,0)
 N DA,DIK,ORI
"RTN","ORY141ED",161,0)
 S DIK="^XTV(8989.52,",DA=+$O(^XTV(8989.52,"B","ORP AUTODC ORDERS",0)) D:DA ^DIK
"RTN","ORY141ED",162,0)
 F ORI="OR DC GEN ORD ON ADMISSION","ORPF DC OF GENERIC ORDERS","OR DC ON SPEC CHANGE","OR DELAYED ORDERS LAPSE DAYS" D
"RTN","ORY141ED",163,0)
 . S DIK="^XTV(8989.51,",DA=+$O(^XTV(8989.51,"B",ORI,0))
"RTN","ORY141ED",164,0)
 . D:DA ^DIK
"RTN","ORY141ED",165,0)
 Q
"RTN","ORY141ED",166,0)
 ;
"RTN","ORY141ED",167,0)
DLGS ; -- Send bulletin re modified dialogs
"RTN","ORY141ED",168,0)
 N I,ORD
"RTN","ORY141ED",169,0)
 F I="LR OTHER LAB TESTS","RA OERR EXAM","PS MEDS","PSJ OR PAT OE","PSO OERR","PSO SUPPLY","OR GXMOVE ADMIT PATIENT","OR GXMOVE DISCHARGE","OR GXMOVE TRANSFER","OR GXMOVE TREATING SPECIALTY" S ORD(I)=""
"RTN","ORY141ED",170,0)
 D EN^ORYDLG(141,.ORD)
"RTN","ORY141ED",171,0)
 Q
"RTN","ORY141ED",172,0)
 ;
"RTN","ORY141ED",173,0)
101 ; -- replace items on protocol menus
"RTN","ORY141ED",174,0)
 N ORI,ORX,ORMENU,OROLD,ORNEW,ORMNEM,DA,DR,DIE,X,Y
"RTN","ORY141ED",175,0)
 F ORI=1:1 S ORX=$T(PRTCLS+ORI) Q:ORX["ZZZZZ"  D
"RTN","ORY141ED",176,0)
 . S ORMENU=+$O(^ORD(101,"B",$P(ORX,";",3),0)) Q:ORMENU<1
"RTN","ORY141ED",177,0)
 . S OROLD=+$O(^ORD(101,"B",$P(ORX,";",4),0)) Q:OROLD<1
"RTN","ORY141ED",178,0)
 . S DA=+$O(^ORD(101,ORMENU,10,"B",OROLD,0)) Q:DA<1  ;already fixed
"RTN","ORY141ED",179,0)
 . S ORNEW=$P(ORX,";",5),ORMNEM=$P(ORX,";",6)
"RTN","ORY141ED",180,0)
 . S DIE="^ORD(101,"_ORMENU_",10,",DA(1)=ORMENU
"RTN","ORY141ED",181,0)
 . S DR=".01///^S X=ORNEW;2///^S X=ORMNEM;5///@;6///@" D ^DIE
"RTN","ORY141ED",182,0)
 Q
"RTN","ORY141ED",183,0)
 ;
"RTN","ORY141ED",184,0)
PRTCLS ;;MENU;REPL;WITH;MNEMONIC
"RTN","ORY141ED",185,0)
 ;;ORCHART ORDERS MENU;ORB BLANK LINE1;ORC DELAYED ORDERS;TD
"RTN","ORY141ED",186,0)
 ;;ORC ADD ORDERS MENU;ORC EVENT MENU;VALM PREVIOUS SCREEN;-
"RTN","ORY141ED",187,0)
 ;;ZZZZZ
"RTN","ORY141ED",188,0)
 ;
"RTN","ORY141ED",189,0)
C ; -- Rebuild C index on #100.5 to uppercase
"RTN","ORY141ED",190,0)
 N X,X1,DA K ^TMP($J,"ORD100.5C")
"RTN","ORY141ED",191,0)
 S X="" F  S X=$O(^ORD(100.5,"C",X)) Q:X=""  D
"RTN","ORY141ED",192,0)
 . S X1=$$UP^XLFSTR(X),DA=0
"RTN","ORY141ED",193,0)
 . F  S DA=$O(^ORD(100.5,"C",X,DA)) Q:DA<1  S ^TMP($J,"ORD100.5C",X1,DA)=""
"RTN","ORY141ED",194,0)
 K ^ORD(100.5,"C") M ^ORD(100.5,"C")=^TMP($J,"ORD100.5C")
"RTN","ORY141ED",195,0)
 K ^TMP($J,"ORD100.5C")
"RTN","ORY141ED",196,0)
 Q
"RTN","ORYDLG")
0^46^B8247584
"RTN","ORYDLG",1,0)
ORYDLG ;SLC/MKB -- Postinit bulletin for order dialogs
"RTN","ORYDLG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141**;Dec 17, 1997
"RTN","ORYDLG",3,0)
 ;
"RTN","ORYDLG",4,0)
EN(PATCH,ORDLG,USERS) ; -- look for local copies of ORDLG(NAME) by package,
"RTN","ORYDLG",5,0)
 ;    send list in bulletin to DUZ, POSTMASTER, USERS(DUZ) when done
"RTN","ORYDLG",6,0)
 ;
"RTN","ORYDLG",7,0)
 Q:$O(ORDLG(""))=""  ;none
"RTN","ORYDLG",8,0)
 N ORZ,ORI,X,NM,I,OR0,PKG,DG,ORPKG,ORNATL,DLG,CNT
"RTN","ORYDLG",9,0)
 S ORZ(1)="The following nationally exported order dialogs have been modified by"
"RTN","ORYDLG",10,0)
 S X="this patch:   ",ORI=1,NM="" F  S NM=$O(ORDLG(NM)) Q:NM=""  D
"RTN","ORYDLG",11,0)
 . S ORI=ORI+1,ORZ(ORI)=X_NM,X="              "
"RTN","ORYDLG",12,0)
 . S I=+$O(^ORD(101.41,"AB",NM,0)),OR0=$G(^ORD(101.41,I,0))
"RTN","ORYDLG",13,0)
 . S PKG=+$P(OR0,U,7),DG=+$P(OR0,U,5) S:PKG ORPKG(PKG,DG)=""
"RTN","ORYDLG",14,0)
 S I=0 F I=1:1 S X=$T(NATL+I) Q:X["ZZZZZ"  S ORNATL($P(X,";",3))=""
"RTN","ORYDLG",15,0)
 S ORI=ORI+1,ORZ(ORI)="Please review and compare the following locally created order dialogs"
"RTN","ORYDLG",16,0)
 S ORI=ORI+1,ORZ(ORI)="that may be copies, for any necessary changes:",CNT=0
"RTN","ORYDLG",17,0)
 S PKG=0 F  S PKG=$O(ORPKG(PKG)) Q:PKG<1  S DLG=0 D
"RTN","ORYDLG",18,0)
 . F  S DLG=+$O(^ORD(101.41,"APKG",PKG,DLG)) Q:DLG<1  D
"RTN","ORYDLG",19,0)
 .. S OR0=$G(^ORD(101.41,DLG,0))  Q:$P(OR0,U,4)'="D"
"RTN","ORYDLG",20,0)
 .. Q:'$D(ORPKG(PKG,+$P(OR0,U,5)))  ;included DispGrp
"RTN","ORYDLG",21,0)
 .. Q:$D(ORNATL($P(OR0,U)))  S CNT=CNT+1
"RTN","ORYDLG",22,0)
 .. S ORI=ORI+1,ORZ(ORI)=$J(DLG,7)_"  "_$P(OR0,U)
"RTN","ORYDLG",23,0)
EN1 I CNT>0 D  ;local copies found -> send bulletin
"RTN","ORYDLG",24,0)
 . N XMDUZ,XMY,I,XMSUB,XMTEXT,DIFROM
"RTN","ORYDLG",25,0)
 . S XMDUZ="PATCH OR*3*"_$G(PATCH)_" POSTINIT",XMY(.5)=""
"RTN","ORYDLG",26,0)
 . S:$G(DUZ) XMY(DUZ)="" S I=0 F  S I=$O(USERS(I)) Q:I<1  S XMY(I)=""
"RTN","ORYDLG",27,0)
 . S XMSUB=XMDUZ_" COMPLETED",XMTEXT="ORZ(" D ^XMD
"RTN","ORYDLG",28,0)
 . D BMES^XPDUTL("Some national order dialogs have been modified in this patch;")
"RTN","ORYDLG",29,0)
 . D MES^XPDUTL("a bulletin has been sent to the installer listing local copies that")
"RTN","ORYDLG",30,0)
 . D MES^XPDUTL("may need to be reviewed and updated.")
"RTN","ORYDLG",31,0)
 Q
"RTN","ORYDLG",32,0)
 ;
"RTN","ORYDLG",33,0)
NATL ;;Nationally exported dialogs
"RTN","ORYDLG",34,0)
 ;;FHW1
"RTN","ORYDLG",35,0)
 ;;FHW2
"RTN","ORYDLG",36,0)
 ;;FHW3
"RTN","ORYDLG",37,0)
 ;;FHW7
"RTN","ORYDLG",38,0)
 ;;FHW8
"RTN","ORYDLG",39,0)
 ;;GMRAOR ALLERGY ENTER/EDIT
"RTN","ORYDLG",40,0)
 ;;GMRCOR CONSULT
"RTN","ORYDLG",41,0)
 ;;GMRCOR REQUEST
"RTN","ORYDLG",42,0)
 ;;GMRVOR
"RTN","ORYDLG",43,0)
 ;;LR OTHER LAB TESTS
"RTN","ORYDLG",44,0)
 ;;OR GWCOND CONDITION
"RTN","ORYDLG",45,0)
 ;;OR GWDIAG DIAGNOSIS
"RTN","ORYDLG",46,0)
 ;;OR GWINST DNR
"RTN","ORYDLG",47,0)
 ;;OR GXACTV OTHER ACTIVITY ORDER
"RTN","ORYDLG",48,0)
 ;;OR GXMISC GENERAL
"RTN","ORYDLG",49,0)
 ;;OR GXMOVE ADMIT PATIENT
"RTN","ORYDLG",50,0)
 ;;OR GXMOVE DISCHARGE
"RTN","ORYDLG",51,0)
 ;;OR GXMOVE EVENT
"RTN","ORYDLG",52,0)
 ;;OR GXMOVE TRANSFER
"RTN","ORYDLG",53,0)
 ;;OR GXMOVE TREATING SPECIALTY
"RTN","ORYDLG",54,0)
 ;;OR GXPARM CALL HO ON
"RTN","ORYDLG",55,0)
 ;;OR GXSKIN DRESSING CHANGE
"RTN","ORYDLG",56,0)
 ;;OR GXTEXT TEXT ONLY ORDER
"RTN","ORYDLG",57,0)
 ;;OR GXTEXT WORD PROCESSING ORDER
"RTN","ORYDLG",58,0)
 ;;ORWD GENERIC ACTIVITY
"RTN","ORYDLG",59,0)
 ;;ORWD GENERIC DIET
"RTN","ORYDLG",60,0)
 ;;ORWD GENERIC NURSING
"RTN","ORYDLG",61,0)
 ;;ORWD GENERIC VITALS
"RTN","ORYDLG",62,0)
 ;;PS MEDS
"RTN","ORYDLG",63,0)
 ;;PSJ OR PAT OE
"RTN","ORYDLG",64,0)
 ;;PSJI OR PAT FLUID OE
"RTN","ORYDLG",65,0)
 ;;PSO OERR
"RTN","ORYDLG",66,0)
 ;;PSO SUPPLY
"RTN","ORYDLG",67,0)
 ;;RA OERR EXAM
"RTN","ORYDLG",68,0)
 ;;ZZZZZ
"SEC","^DIC",8989.51,8989.51,0,"AUDIT")
@
"SEC","^DIC",8989.51,8989.51,0,"DD")
@
"SEC","^DIC",8989.51,8989.51,0,"DEL")
@
"SEC","^DIC",8989.51,8989.51,0,"LAYGO")
@
"SEC","^DIC",8989.51,8989.51,0,"RD")
@
"SEC","^DIC",8989.51,8989.51,0,"WR")
@
"UP",100.5,100.51,-1)
100.5^TS
"UP",100.5,100.51,0)
100.51
"VER")
8.0^22.0
"^DD",100,100,.02,0)
OBJECT OF ORDER^RV^^0;2^Q
"^DD",100,100,.02,1,0)
^.1^^-1
"^DD",100,100,.02,1,2,0)
100^AC^MUMPS
"^DD",100,100,.02,1,2,1)
D SETALL^ORDD100(DA)
"^DD",100,100,.02,1,2,2)
D KILALL^ORDD100(DA)
"^DD",100,100,.02,1,2,"%D",0)
^^4^4^2971028^
"^DD",100,100,.02,1,2,"%D",1,0)
^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,DA)
"^DD",100,100,.02,1,2,"%D",2,0)
Allows retrieval of "active" orders; includes orders with any kind of
"^DD",100,100,.02,1,2,"%D",3,0)
active status, as well as those that have ended w/in the Active Orders
"^DD",100,100,.02,1,2,"%D",4,0)
Context Hours.
"^DD",100,100,.02,1,2,"DT")
2960830
"^DD",100,100,.02,1,5,0)
100^AS^MUMPS
"^DD",100,100,.02,1,5,1)
N ORDA S ORDA=0 F  S ORDA=$O(^OR(100,DA,8,ORDA)) Q:ORDA'>0  D S1^ORDD100(DA,ORDA,X)
"^DD",100,100,.02,1,5,2)
N ORDA S ORDA=0 F  S ORDA=$O(^OR(100,DA,9,ORDA)) Q:ORDA'>0  D S2^ORDD100(DA,ORDA,X)
"^DD",100,100,.02,1,5,"%D",0)
^^2^2^2971028^^^
"^DD",100,100,.02,1,5,"%D",1,0)
^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,DA)
"^DD",100,100,.02,1,5,"%D",2,0)
Allows retrieval of unsigned orders.
"^DD",100,100,.02,1,5,"DT")
2910624
"^DD",100,100,.02,1,7,0)
100^AR^MUMPS
"^DD",100,100,.02,1,7,1)
N ORDA S ORDA=0 F  S ORDA=$O(^OR(100,DA,8,ORDA)) Q:ORDA'>0  D RS^ORDD100(DA,ORDA,X)
"^DD",100,100,.02,1,7,2)
N ORDA S ORDA=0 F  S ORDA=$O(^OR(100,DA,8,ORDA)) Q:ORDA'>0  D RK^ORDD100(DA,ORDA,X)
"^DD",100,100,.02,1,7,"%D",0)
^^2^2^2980602^
"^DD",100,100,.02,1,7,"%D",1,0)
^OR(100,"AR",ORVP,9999999-ORRDT,ORIFN,ORDA)
"^DD",100,100,.02,1,7,"%D",2,0)
Allows retrieval of orders by inverse date released.
"^DD",100,100,.02,1,7,"DT")
2980602
"^DD",100,100,.02,1,9,0)
100^AW^MUMPS
"^DD",100,100,.02,1,9,1)
D WS^ORDD100
"^DD",100,100,.02,1,9,2)
D WK^ORDD100
"^DD",100,100,.02,1,9,"%D",0)
^^2^2^2971028^^^
"^DD",100,100,.02,1,9,"%D",1,0)
^OR(100,"AW",ORVP,ORDG,ORSTRT,ORIFN)
"^DD",100,100,.02,1,9,"%D",2,0)
Allows retrieval of orders by display group.
"^DD",100,100,.02,1,9,"DT")
2920526
"^DD",100,100,.02,1,10,0)
100^AOI1^MUMPS
"^DD",100,100,.02,1,10,1)
D OI1^ORDD100A(DA)
"^DD",100,100,.02,1,10,2)
D OI2^ORDD100A(DA)
"^DD",100,100,.02,1,10,"%D",0)
^^2^2^2971028^^^
"^DD",100,100,.02,1,10,"%D",1,0)
^OR(100,"AOI",ORIT,ORVP,9999999-ORSTRT,ORIFN)
"^DD",100,100,.02,1,10,"%D",2,0)
Allows retrieval of patients for whom an item has been ordered.
"^DD",100,100,.02,1,10,"DT")
2960404
"^DD",100,100,.02,1,11,0)
100^ACT1^MUMPS
"^DD",100,100,.02,1,11,1)
N ORDA S ORDA=0 F  S ORDA=$O(^OR(100,DA,8,ORDA)) Q:ORDA'>0  D ACT1^ORDD100A(DA,ORDA,,X)
"^DD",100,100,.02,1,11,2)
N ORDA S ORDA=0 F  S ORDA=$O(^OR(100,DA,8,ORDA)) Q:ORDA'>0  D ACT2^ORDD100A(DA,ORDA,,X)
"^DD",100,100,.02,1,11,"%D",0)
^^2^2^2971028^^^^
"^DD",100,100,.02,1,11,"%D",1,0)
^OR(100,"ACT",ORVP,9999999-ORLOG,ORDG,ORIFN,DA)
"^DD",100,100,.02,1,11,"%D",2,0)
Allows retrieval of orders in reverse-chronological order.
"^DD",100,100,.02,1,11,"DT")
2960801
"^DD",100,100,.02,3)
Enter the name of a patient.
"^DD",100,100,.02,21,0)
^^2^2^2920224^^^^
"^DD",100,100,.02,21,1,0)
This is the individual object of the order.  Depending on the parent 
"^DD",100,100,.02,21,2,0)
file entry, this would be the Patient, Control Point, etc.
"^DD",100,100,.02,"DT")
3020612
"^DD",100,100,.02,"V",0)
^.12P^3^2
"^DD",100,100,.02,"V",1,0)
2^PATIENT^1^P^n^n
"^DD",100,100,.02,"V",3,0)
67^REFERRAL^6^R^n^n
"^DD",100,100,15,0)
EVENT^P100.2'^ORE(100.2,^0;17^Q
"^DD",100,100,15,1,0)
^.1^^0
"^DD",100,100,15,3)
Enter the event this order should be delayed for.
"^DD",100,100,15,21,0)
^.001^1^1^3020425^^^
"^DD",100,100,15,21,1,0)
This is the event that this order's release is/was delayed till.
"^DD",100,100,15,"DT")
3020425
"^DD",100,100,68,0)
DC EVENT^P100.2'^ORE(100.2,^6;8^Q
"^DD",100,100,68,3)
Enter the event that caused this order to terminate.
"^DD",100,100,68,21,0)
^.001^1^1^3020425^^^
"^DD",100,100,68,21,1,0)
This is the event that automatically discontinued this order.
"^DD",100,100,68,"DT")
3020425
"^DD",100.2,100.2,0)
FIELD^^30^14
"^DD",100.2,100.2,0,"DDA")
N
"^DD",100.2,100.2,0,"DT")
3020923
"^DD",100.2,100.2,0,"ID",2)
S %I=Y,Y=$S('$D(^(0)):"",$D(^ORD(100.5,+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(100.5,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",100.2,100.2,0,"ID",11)
W:$D(^(1)) "   ",$E($P(^(1),U,1),4,5)_"-"_$E($P(^(1),U,1),6,7)_"-"_$E($P(^(1),U,1),2,3)
"^DD",100.2,100.2,0,"IX","AO",100.2,4)

"^DD",100.2,100.2,0,"IX","ASR",100.2,14)

"^DD",100.2,100.2,0,"IX","B",100.2,.01)

"^DD",100.2,100.2,0,"IX","DAD",100.2,15)

"^DD",100.2,100.2,0,"IX","DC",100.2,13)

"^DD",100.2,100.2,0,"IX","E",100.2,2)

"^DD",100.2,100.2,0,"NM","OE/RR PATIENT EVENT")

"^DD",100.2,100.2,0,"PT",100,15)

"^DD",100.2,100.2,0,"PT",100,68)

"^DD",100.2,100.2,0,"PT",100.2,15)

"^DD",100.2,100.2,0,"VRPK")
OR
"^DD",100.2,100.2,.01,0)
PATIENT^RP2'^DPT(^0;1^Q
"^DD",100.2,100.2,.01,1,0)
^.1
"^DD",100.2,100.2,.01,1,1,0)
100.2^B
"^DD",100.2,100.2,.01,1,1,1)
S ^ORE(100.2,"B",$E(X,1,30),DA)=""
"^DD",100.2,100.2,.01,1,1,2)
K ^ORE(100.2,"B",$E(X,1,30),DA)
"^DD",100.2,100.2,.01,3)
Enter the name of the patient.
"^DD",100.2,100.2,.01,21,0)
^^2^2^3020718^
"^DD",100.2,100.2,.01,21,1,0)
This is a pointer to the patient file and is the patient associated with 
"^DD",100.2,100.2,.01,21,2,0)
this event.
"^DD",100.2,100.2,.01,"DT")
3020508
"^DD",100.2,100.2,1,0)
ACTIVITY^100.25DA^^10;0
"^DD",100.2,100.2,1,21,0)
^.001^2^2^3020718^^
"^DD",100.2,100.2,1,21,1,0)
This multiple contains a log of actions taken on this event that are
"^DD",100.2,100.2,1,21,2,0)
relevant to the release or discontinuance of orders.
"^DD",100.2,100.2,2,0)
EVENT^P100.5'^ORD(100.5,^0;2^Q
"^DD",100.2,100.2,2,1,0)
^.1
"^DD",100.2,100.2,2,1,1,0)
100.2^E
"^DD",100.2,100.2,2,1,1,1)
S ^ORE(100.2,"E",$E(X,1,30),DA)=""
"^DD",100.2,100.2,2,1,1,2)
K ^ORE(100.2,"E",$E(X,1,30),DA)
"^DD",100.2,100.2,2,1,1,"DT")
3020425
"^DD",100.2,100.2,2,3)
Enter an event for which delayed orders are to be released for this patient.
"^DD",100.2,100.2,2,21,0)
^^3^3^3020718^
"^DD",100.2,100.2,2,21,1,0)
This field is a pointer to the OE/RR RELEASE EVENTS file, which defines
"^DD",100.2,100.2,2,21,2,0)
the conditions under which delayed orders are to be released for this
"^DD",100.2,100.2,2,21,3,0)
patient event, if delayed orders are related to this event.
"^DD",100.2,100.2,2,"DT")
3020425
"^DD",100.2,100.2,3,0)
ADMISSION^P405'^DGPM(^0;3^Q
"^DD",100.2,100.2,3,3)
Enter the admission during which this event is to occur.
"^DD",100.2,100.2,3,21,0)
^^6^6^3020718^
"^DD",100.2,100.2,3,21,1,0)
This field is a pointer to the Admission movement for which this event
"^DD",100.2,100.2,3,21,2,0)
is valid; this will be the current admission if the patient is an 
"^DD",100.2,100.2,3,21,3,0)
inpatient when delayed orders are written, otherwise the admission 
"^DD",100.2,100.2,3,21,4,0)
movement will be stuffed in when the patient is admitted and the orders 
"^DD",100.2,100.2,3,21,5,0)
released.  If the patient is discharged without this event having been
"^DD",100.2,100.2,3,21,6,0)
processed, it will be retired and any orders still delayed will be lapsed.
"^DD",100.2,100.2,3,"DT")
3020425
"^DD",100.2,100.2,4,0)
ORDER^P100'^OR(100,^0;4^Q
"^DD",100.2,100.2,4,1,0)
^.1
"^DD",100.2,100.2,4,1,1,0)
100.2^AO
"^DD",100.2,100.2,4,1,1,1)
S ^ORE(100.2,"AO",$E(X,1,30),DA)=""
"^DD",100.2,100.2,4,1,1,2)
K ^ORE(100.2,"AO",$E(X,1,30),DA)
"^DD",100.2,100.2,4,1,1,"DT")
3020425
"^DD",100.2,100.2,4,3)
Enter the number of the doctor's order for this event.
"^DD",100.2,100.2,4,21,0)
^^2^2^3020718^
"^DD",100.2,100.2,4,21,1,0)
This field is a pointer to the doctor's order requesting that this event
"^DD",100.2,100.2,4,21,2,0)
occur for this patient when delayed orders are written.
"^DD",100.2,100.2,4,"DT")
3020425
"^DD",100.2,100.2,5,0)
CREATED ON^D^^0;5^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",100.2,100.2,5,3)
Enter the date and time this event was created for this patient.
"^DD",100.2,100.2,5,21,0)
^^2^2^3020425^
"^DD",100.2,100.2,5,21,1,0)
This field is the timestamp of when this event was entered into the file
"^DD",100.2,100.2,5,21,2,0)
for this patient.
"^DD",100.2,100.2,5,"DT")
3020425
"^DD",100.2,100.2,6,0)
CREATED BY^P200'^VA(200,^0;6^Q
"^DD",100.2,100.2,6,3)
Enter the name of the user that created this event for this patient.
"^DD",100.2,100.2,6,21,0)
^^2^2^3020425^
"^DD",100.2,100.2,6,21,1,0)
This field is a pointer to the user who entered this event into the file
"^DD",100.2,100.2,6,21,2,0)
for this patient.
"^DD",100.2,100.2,6,"DT")
3020425
"^DD",100.2,100.2,11,0)
EVENT DATE/TIME^D^^1;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",100.2,100.2,11,3)
Enter the date and time this event occurred.
"^DD",100.2,100.2,11,21,0)
^.001^4^4^3020718^^^
"^DD",100.2,100.2,11,21,1,0)
This field is the date and time that this event occurred for this patient;
"^DD",100.2,100.2,11,21,2,0)
if the event is an MAS movement, this time will be the DATE/TIME from
"^DD",100.2,100.2,11,21,3,0)
the PATIENT MOVEMENT file which may be slightly different than the
"^DD",100.2,100.2,11,21,4,0)
actual time that this event was processed by the event driver.
"^DD",100.2,100.2,11,"DT")
3020425
"^DD",100.2,100.2,12,0)
PATIENT MOVEMENT^P405'^DGPM(^1;2^Q
"^DD",100.2,100.2,12,3)
Enter the MAS Movement that satisfied this event for this patient.
"^DD",100.2,100.2,12,21,0)
^^3^3^3020425^
"^DD",100.2,100.2,12,21,1,0)
This field is a pointer to the MAS Patient Movement that satisfied this
"^DD",100.2,100.2,12,21,2,0)
event for this patient; any changes to this movement that alter the
"^DD",100.2,100.2,12,21,3,0)
conditions of the event will be tracked in the Activity log.
"^DD",100.2,100.2,12,"DT")
3020425
"^DD",100.2,100.2,13,0)
AUTO-DC RULE^P100.6'^ORD(100.6,^1;3^Q
"^DD",100.2,100.2,13,1,0)
^.1
"^DD",100.2,100.2,13,1,1,0)
100.2^DC
"^DD",100.2,100.2,13,1,1,1)
S ^ORE(100.2,"DC",$E(X,1,30),DA)=""
"^DD",100.2,100.2,13,1,1,2)
K ^ORE(100.2,"DC",$E(X,1,30),DA)
"^DD",100.2,100.2,13,1,1,"DT")
3020426
"^DD",100.2,100.2,13,3)
Enter the rule that was used when auto-dc'ing orders for this event.
"^DD",100.2,100.2,13,21,0)
^^4^4^3020425^
"^DD",100.2,100.2,13,21,1,0)
This field is the Auto-DC Rule from file #100.6 that was used to
"^DD",100.2,100.2,13,21,2,0)
automatically discontinue active orders when this event occurred.  Those
"^DD",100.2,100.2,13,21,3,0)
orders that were dc'd are listed in the Discontinued Orders multiple of
"^DD",100.2,100.2,13,21,4,0)
this file.
"^DD",100.2,100.2,13,"DT")
3020426
"^DD",100.2,100.2,14,0)
SURGERY^P130'^SRF(^1;4^Q
"^DD",100.2,100.2,14,1,0)
^.1
"^DD",100.2,100.2,14,1,1,0)
100.2^ASR
"^DD",100.2,100.2,14,1,1,1)
S ^ORE(100.2,"ASR",$E(X,1,30),DA)=""
"^DD",100.2,100.2,14,1,1,2)
K ^ORE(100.2,"ASR",$E(X,1,30),DA)
"^DD",100.2,100.2,14,1,1,"DT")
3020425
"^DD",100.2,100.2,14,3)
Enter the surgery case that satisfied this event for this patient.
"^DD",100.2,100.2,14,21,0)
^^3^3^3020425^
"^DD",100.2,100.2,14,21,1,0)
This field is a pointer to the Surgery case that satisfied this event for
"^DD",100.2,100.2,14,21,2,0)
this patient when the TIME PAT OUT OR field was entered; any changes to
"^DD",100.2,100.2,14,21,3,0)
this field will be tracked in the Activity log.
"^DD",100.2,100.2,14,"DT")
3020425
"^DD",100.2,100.2,15,0)
PARENT^P100.2'^ORE(100.2,^1;5^Q
"^DD",100.2,100.2,15,1,0)
^.1
"^DD",100.2,100.2,15,1,1,0)
100.2^DAD
"^DD",100.2,100.2,15,1,1,1)
S ^ORE(100.2,"DAD",$E(X,1,30),DA)=""
"^DD",100.2,100.2,15,1,1,2)
K ^ORE(100.2,"DAD",$E(X,1,30),DA)
"^DD",100.2,100.2,15,1,1,"DT")
3020823
"^DD",100.2,100.2,15,3)
Enter the Patient Event that will trigger the release of this one.
"^DD",100.2,100.2,15,21,0)
^^4^4^3020823^
"^DD",100.2,100.2,15,21,1,0)
This field is a "parent" event, allowing multiple Patient Events to be
"^DD",100.2,100.2,15,21,2,0)
collected together for release at the same time based on the same criteria;
"^DD",100.2,100.2,15,21,3,0)
the parent event tracks the release criteria, while each "child" event
"^DD",100.2,100.2,15,21,4,0)
defines a particular set of orders to be released on that event.
"^DD",100.2,100.2,15,"DT")
3020823
"^DD",100.2,100.2,20,0)
RELEASED ORDERS^100.26PA^^2;0
"^DD",100.2,100.2,20,21,0)
^.001^3^3^3020923^^
"^DD",100.2,100.2,20,21,1,0)
This multiple field contains the delayed orders that were released based
"^DD",100.2,100.2,20,21,2,0)
on the release event defined in the OE/RR RELEASE EVENTS file #100.5 when
"^DD",100.2,100.2,20,21,3,0)
this event occurred.
"^DD",100.2,100.2,30,0)
DISCONTINUED ORDERS^100.27PA^^3;0
"^DD",100.2,100.2,30,21,0)
^.001^3^3^3020916^^
"^DD",100.2,100.2,30,21,1,0)
This multiple contains the orders that were automatically discontinued
"^DD",100.2,100.2,30,21,2,0)
based on the rules defined in the OE/RR AUTO-DC RULES file #100.6 when
"^DD",100.2,100.2,30,21,3,0)
this event occurred.
"^DD",100.2,100.25,0)
ACTIVITY SUB-FIELD^^7^7
"^DD",100.2,100.25,0,"DT")
3020425
"^DD",100.2,100.25,0,"IX","B",100.25,.01)

"^DD",100.2,100.25,0,"NM","ACTIVITY")

"^DD",100.2,100.25,0,"UP")
100.2
"^DD",100.2,100.25,.01,0)
DATE/TIME OF ACTIVITY^D^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",100.2,100.25,.01,1,0)
^.1
"^DD",100.2,100.25,.01,1,1,0)
100.25^B
"^DD",100.2,100.25,.01,1,1,1)
S ^ORE(100.2,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",100.2,100.25,.01,1,1,2)
K ^ORE(100.2,DA(1),10,"B",$E(X,1,30),DA)
"^DD",100.2,100.25,.01,3)
Enter the date and time that action was taken on this event.
"^DD",100.2,100.25,.01,21,0)
^^1^1^3020718^
"^DD",100.2,100.25,.01,21,1,0)
This is the actual date and time that the activity occurred.
"^DD",100.2,100.25,.01,"DT")
3020425
"^DD",100.2,100.25,2,0)
TYPE OF EVENT ACTIVITY^RS^NW:NEW;ED:EDITED;RE:REENTERED;MN:MANUALLY RELEASED;LP:LAPSED;DL:DELETED;CA:CANCELLED;^0;2^Q
"^DD",100.2,100.25,2,3)
Enter the type of action that was taken on this event.
"^DD",100.2,100.25,2,21,0)
^^6^6^3020718^
"^DD",100.2,100.25,2,21,1,0)
This field is a code indicating the type of activity that occurred.  This 
"^DD",100.2,100.25,2,21,2,0)
may be new, edited, re-entered, manually released, deleted or cancelled.
"^DD",100.2,100.25,2,21,3,0)
 
"^DD",100.2,100.25,2,21,4,0)
An event may also be "lapsed" if it stays unprocessed beyond the time
"^DD",100.2,100.25,2,21,5,0)
frame defined by the "Lapse in #Days" field of the OE/RR RELEASE EVENTS
"^DD",100.2,100.25,2,21,6,0)
file #100.5 for this event.
"^DD",100.2,100.25,2,"DT")
3020425
"^DD",100.2,100.25,3,0)
USER^P200'^VA(200,^0;3^Q
"^DD",100.2,100.25,3,3)
Enter the user taking this action on the event.
"^DD",100.2,100.25,3,21,0)
^^1^1^3020718^
"^DD",100.2,100.25,3,21,1,0)
This field is the user who entered or modified the activity.
"^DD",100.2,100.25,3,"DT")
3020425
"^DD",100.2,100.25,4,0)
EVENT TYPE^S^A:ADMISSION;T:TRANSFER;D:DISCHARGE;O:OUT OF O.R.;S:SPECIALTY CHANGE;^0;4^Q
"^DD",100.2,100.25,4,3)
Enter the type of event that was processed.
"^DD",100.2,100.25,4,21,0)
^^2^2^3020718^
"^DD",100.2,100.25,4,21,1,0)
This field is the type of event that was processed.  This could be 
"^DD",100.2,100.25,4,21,2,0)
admission, discharge, transfer, out of O.R., or specialty change.
"^DD",100.2,100.25,4,"DT")
3020425
"^DD",100.2,100.25,5,0)
MAS MOVEMENT TYPE^P405.2'^DG(405.2,^0;5^Q
"^DD",100.2,100.25,5,3)
If this event is an MAS patient movement, enter the movement type.
"^DD",100.2,100.25,5,21,0)
^^2^2^3020718^
"^DD",100.2,100.25,5,21,1,0)
This field is the MAS Movement Type of the activity that was processed, if
"^DD",100.2,100.25,5,21,2,0)
it was an MAS patient movement.
"^DD",100.2,100.25,5,"DT")
3020425
"^DD",100.2,100.25,6,0)
TREATING SPECIALTY^P45.7'^DIC(45.7,^0;6^Q
"^DD",100.2,100.25,6,3)
Enter the treating specialty associated with this event.
"^DD",100.2,100.25,6,21,0)
^^2^2^3020718^
"^DD",100.2,100.25,6,21,1,0)
This field is the treating specialty associated with this activity, if it
"^DD",100.2,100.25,6,21,2,0)
is an MAS patient movement.
"^DD",100.2,100.25,6,"DT")
3020425
"^DD",100.2,100.25,7,0)
WARD LOCATION^P42'^DIC(42,^0;7^Q
"^DD",100.2,100.25,7,3)
Enter the ward location associated with this event.
"^DD",100.2,100.25,7,21,0)
^^2^2^3020718^
"^DD",100.2,100.25,7,21,1,0)
This field is the ward location associated with this activity, if it is an
"^DD",100.2,100.25,7,21,2,0)
MAS patient movement.
"^DD",100.2,100.25,7,"DT")
3020425
"^DD",100.2,100.26,0)
RELEASED ORDERS SUB-FIELD^^2^2
"^DD",100.2,100.26,0,"DT")
3020923
"^DD",100.2,100.26,0,"NM","RELEASED ORDERS")

"^DD",100.2,100.26,0,"UP")
100.2
"^DD",100.2,100.26,.01,0)
RELEASED ORDER^MP100'X^OR(100,^0;1^S:$D(X) DINUM=X
"^DD",100.2,100.26,.01,1,0)
^.1^^0
"^DD",100.2,100.26,.01,3)
Enter the number of a delayed order that was released by this event.
"^DD",100.2,100.26,.01,21,0)
^^2^2^3020718^
"^DD",100.2,100.26,.01,21,1,0)
This field is a pointer to the Orders file #100 of an order that was 
"^DD",100.2,100.26,.01,21,2,0)
released as a result of the event occurring.
"^DD",100.2,100.26,.01,"DT")
3020425
"^DD",100.2,100.26,2,0)
BY ACTION^S^MN:MANUAL RELEASE;ES:SIGNATURE;^0;2^Q
"^DD",100.2,100.26,2,3)
Enter the action that released this order.
"^DD",100.2,100.26,2,21,0)
^^4^4^3020923^
"^DD",100.2,100.26,2,21,1,0)
This is the CPRS action that released this order to the service, instead
"^DD",100.2,100.26,2,21,2,0)
of the specified OE/RR RELEASE EVENT.  These orders are tracked here so
"^DD",100.2,100.26,2,21,3,0)
that they can all be displayed in the "Auto-DC/Release Events" view,
"^DD",100.2,100.26,2,21,4,0)
including the complete movement data in the Detailed Display.
"^DD",100.2,100.26,2,"DT")
3020923
"^DD",100.2,100.27,0)
DISCONTINUED ORDERS SUB-FIELD^^2^2
"^DD",100.2,100.27,0,"DT")
3020916
"^DD",100.2,100.27,0,"NM","DISCONTINUED ORDERS")

"^DD",100.2,100.27,0,"UP")
100.2
"^DD",100.2,100.27,.01,0)
DISCONTINUED ORDER^MP100'X^OR(100,^0;1^S:$D(X) DINUM=X
"^DD",100.2,100.27,.01,1,0)
^.1^^0
"^DD",100.2,100.27,.01,3)
Enter the number of an order that was automatically discontinued by this event.
"^DD",100.2,100.27,.01,21,0)
^^1^1^3020425^
"^DD",100.2,100.27,.01,21,1,0)
This field is the number of the order in the Orders file #100.
"^DD",100.2,100.27,.01,"DT")
3020425
"^DD",100.2,100.27,2,0)
BY PACKAGE^S^FH:DIETETICS;LR:LABORATORY;PS:PHARMACY;^0;2^Q
"^DD",100.2,100.27,2,3)
Enter the package that auto-dc'd this order.
"^DD",100.2,100.27,2,21,0)
^^5^5^3020916^
"^DD",100.2,100.27,2,21,1,0)
This is the VistA package whose protocol on the DGPM MOVEMENT EVENTS
"^DD",100.2,100.27,2,21,2,0)
driver caused this order to auto-dc, instead of the OE/RR AUTO-DC RULE.
"^DD",100.2,100.27,2,21,3,0)
These orders are tracked here so that they can all be displayed in the
"^DD",100.2,100.27,2,21,4,0)
"Auto-DC/Release Events" view, including the complete movement data in
"^DD",100.2,100.27,2,21,5,0)
the Detailed Display.
"^DD",100.2,100.27,2,"DT")
3020916
"^DD",100.5,100.5,1,0)
INACTIVATED^D^^1;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",100.5,100.5,1,3)
Enter the date and time this event was (or will be) inactivated.
"^DD",100.5,100.5,1,21,0)
^.001^6^6^3020709^^^^
"^DD",100.5,100.5,1,21,1,0)
This field contains the date and time that this event became inactive;
"^DD",100.5,100.5,1,21,2,0)
once this date/time has passed, this event may no longer be selected for
"^DD",100.5,100.5,1,21,3,0)
delaying orders, however any orders already delayed for this event will
"^DD",100.5,100.5,1,21,4,0)
still be released when the event occurs.  If this date/time is in the
"^DD",100.5,100.5,1,21,5,0)
future, this event may continue to be selected for delaying orders until
"^DD",100.5,100.5,1,21,6,0)
this time passes.
"^DD",100.5,100.5,1,"DT")
3020910
"^DD",100.5,100.5,8,0)
DISPLAY TEXT^RF^^0;8^K:$L(X)>60!($L(X)<3) X
"^DD",100.5,100.5,8,3)
Answer must be 3-60 characters in length.
"^DD",100.5,100.5,8,21,0)
^^2^2^3020305^
"^DD",100.5,100.5,8,21,1,0)
This field is the name of the event as it will appear to the user in
"^DD",100.5,100.5,8,21,2,0)
CPRS.
"^DD",100.5,100.5,8,"DT")
3020910
"^DD",100.5,100.5,14,0)
PARENT^P100.5'^ORD(100.5,^0;12^Q
"^DD",100.5,100.5,14,1,0)
^.1
"^DD",100.5,100.5,14,1,1,0)
100.5^DAD
"^DD",100.5,100.5,14,1,1,1)
S ^ORD(100.5,"DAD",$E(X,1,30),DA)=""
"^DD",100.5,100.5,14,1,1,2)
K ^ORD(100.5,"DAD",$E(X,1,30),DA)
"^DD",100.5,100.5,14,1,1,"DT")
3020828
"^DD",100.5,100.5,14,3)
Enter release event that will be the "parent" event for this event
"^DD",100.5,100.5,14,21,0)
^^8^8^3020826^
"^DD",100.5,100.5,14,21,1,0)
For release events that have a common trigger event (e.g. same
"^DD",100.5,100.5,14,21,2,0)
treating specialty or same locations) but require different names
"^DD",100.5,100.5,14,21,3,0)
or display text a parent-child relationship can be set up.  The parent
"^DD",100.5,100.5,14,21,4,0)
contains the base trigger event logic while the child contains the
"^DD",100.5,100.5,14,21,5,0)
information unique to this event.  In a sense, the child events are
"^DD",100.5,100.5,14,21,6,0)
"synonyms" to the parent event as all childen are related to the parent.
"^DD",100.5,100.5,14,21,7,0)
When the trigger event occurs that would release orders for the parent
"^DD",100.5,100.5,14,21,8,0)
all the child orders related to that parent are also released.
"^DD",100.5,100.5,14,"DT")
3020828
"^DD",100.5,100.51,1,0)
DEFAULT^*S^1:YES;^0;2^Q
"^DD",100.5,100.51,1,1,0)
^.1
"^DD",100.5,100.51,1,1,1,0)
100.51^DEF
"^DD",100.5,100.51,1,1,1,1)
S ^ORD(100.5,DA(1),"TS","DEF",$E(X,1,30),DA)=""
"^DD",100.5,100.51,1,1,1,2)
K ^ORD(100.5,DA(1),"TS","DEF",$E(X,1,30),DA)
"^DD",100.5,100.51,1,1,1,"%D",0)
^^1^1^3020911^
"^DD",100.5,100.51,1,1,1,"%D",1,0)
This field identifies which treating specialty should be the "default"
"^DD",100.5,100.51,1,1,1,"DT")
3020911
"^DD",100.5,100.51,1,3)
If you set a default treating specialty then this value will be stuffed in at the treating specialty prompt when using the OR GXMOVE EVENT dialog.
"^DD",100.5,100.51,1,4)
D DEFHELP^OREV3
"^DD",100.5,100.51,1,12)
Only one default treating specialty may be defined for each release event.
"^DD",100.5,100.51,1,12.1)
S DIC("S")="I '$D(^ORD(100.5,DA(1),""TS"",""DEF""))"
"^DD",100.5,100.51,1,"DT")
3020911
"^DD",101.41,101.41,0)
FIELD^^99^31
"^DD",101.41,101.41,0,"DDA")
N
"^DD",101.41,101.41,0,"DT")
2980501
"^DD",101.41,101.41,0,"IX","AB",101.41,.01)

"^DD",101.41,101.41,0,"IX","AD",101.412,2)

"^DD",101.41,101.41,0,"IX","AM",101.41,99)

"^DD",101.41,101.41,0,"IX","AM2",101.41,2)

"^DD",101.41,101.41,0,"IX","AM51",101.41,51)

"^DD",101.41,101.41,0,"IX","AM52",101.41,52)

"^DD",101.41,101.41,0,"IX","AMM",101.412,.01)

"^DD",101.41,101.41,0,"IX","AMM2",101.412,2)

"^DD",101.41,101.41,0,"IX","AMM3",101.412,3)

"^DD",101.41,101.41,0,"IX","AMM4",101.412,4)

"^DD",101.41,101.41,0,"IX","AMM5",101.412,5)

"^DD",101.41,101.41,0,"IX","APKG",101.41,7)

"^DD",101.41,101.41,0,"IX","B",101.41,.01)

"^DD",101.41,101.41,0,"IX","C",101.41,2)

"^DD",101.41,101.41,0,"NM","ORDER DIALOG")

"^DD",101.41,101.41,0,"PT",100,2)

"^DD",101.41,101.41,0,"PT",100,7)

"^DD",101.41,101.41,0,"PT",100.045,.02)

"^DD",101.41,101.41,0,"PT",100.5,4)

"^DD",101.41,101.41,0,"PT",100.5,5)

"^DD",101.41,101.41,0,"PT",100.98,4)

"^DD",101.41,101.41,0,"PT",101.141,.03)

"^DD",101.41,101.41,0,"PT",101.412,1)

"^DD",101.41,101.41,0,"PT",101.412,2)

"^DD",101.41,101.41,0,"PT",101.415,2)

"^DD",101.41,101.41,0,"PT",101.416,.02)

"^DD",101.41,101.41,0,"PT",101.441,.01)

"^DD",101.41,101.41,0,"PT",801.41,15)

"^DD",101.41,101.41,0,"PT",801.4118,.01)

"^DD",101.41,101.41,0,"VRPK")
OR
"^DD",101.41,101.41,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>63!($L(X)<3)!'(X'?1P.E) X
"^DD",101.41,101.41,.01,1,0)
^.1
"^DD",101.41,101.41,.01,1,1,0)
101.41^B
"^DD",101.41,101.41,.01,1,1,1)
S ^ORD(101.41,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.41,.01,1,1,2)
K ^ORD(101.41,"B",$E(X,1,30),DA)
"^DD",101.41,101.41,.01,1,2,0)
101.41^AB
"^DD",101.41,101.41,.01,1,2,1)
S ^ORD(101.41,"AB",$E(X,1,63),DA)=""
"^DD",101.41,101.41,.01,1,2,2)
K ^ORD(101.41,"AB",$E(X,1,63),DA)
"^DD",101.41,101.41,.01,1,2,"%D",0)
^^1^1^2971020^
"^DD",101.41,101.41,.01,1,2,"%D",1,0)
This is a regular index on the full 63 characters of the Name field.
"^DD",101.41,101.41,.01,1,2,"DT")
2971020
"^DD",101.41,101.41,.01,3)
Answer must be 3-63 characters in length.
"^DD",101.41,101.41,.01,21,0)
^^3^3^2971219^
"^DD",101.41,101.41,.01,21,1,0)
This is the name of the dialog; entries that were converted from the
"^DD",101.41,101.41,.01,21,2,0)
Protocol file will retain the same name.  Namespacing is not required,
"^DD",101.41,101.41,.01,21,3,0)
but still encouraged.
"^DD",101.41,101.41,.01,"DT")
2971020
"^DD",101.41,101.41,2,0)
DISPLAY TEXT^FX^^0;2^K:$L(X)>80!($L(X)<3)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.41,2,1,0)
^.1
"^DD",101.41,101.41,2,1,1,0)
101.41^C
"^DD",101.41,101.41,2,1,1,1)
S ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)=""
"^DD",101.41,101.41,2,1,1,2)
K ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)
"^DD",101.41,101.41,2,1,1,"DT")
2950112
"^DD",101.41,101.41,2,1,2,0)
101.41^AM2^MUMPS
"^DD",101.41,101.41,2,1,2,1)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,2)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,2,1,2,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.41,2,1,2,"DT")
2990210
"^DD",101.41,101.41,2,3)
Answer must be 3-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=). 
"^DD",101.41,101.41,2,21,0)
^.001^1^1^3010913^^^^
"^DD",101.41,101.41,2,21,1,0)
The text of this dialog's name as it appears on a menu or subheader.
"^DD",101.41,101.41,2,"DT")
3000823
"^DD",101.41,101.41,3,0)
DISABLE^F^^0;3^K:$L(X)>40!($L(X)<1) X
"^DD",101.41,101.41,3,3)
Enter a message here to disable this dialog, 1-40 characters in length.
"^DD",101.41,101.41,3,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,3,21,1,0)
This field disables use of this dialog when it contains text.  The text
"^DD",101.41,101.41,3,21,2,0)
should be a short message explaining why use of this dialog has been
"^DD",101.41,101.41,3,21,3,0)
disabled, as it will be displayed if this dialog is selected.
"^DD",101.41,101.41,3,"DT")
2950112
"^DD",101.41,101.41,4,0)
TYPE^RS^P:prompt;D:dialog;Q:quick order;O:order set;M:menu;A:action;H:html;^0;4^Q
"^DD",101.41,101.41,4,3)
Specify a type for this dialog.
"^DD",101.41,101.41,4,21,0)
^^5^5^2950716^^^^
"^DD",101.41,101.41,4,21,1,0)
This field defines the type of order dialog to be processed.  Control
"^DD",101.41,101.41,4,21,2,0)
will be passed to the OE/RR Dialog Processor for dialog items; menu types
"^DD",101.41,101.41,4,21,3,0)
are used for displaying and selecting dialog items.  Action types will only
"^DD",101.41,101.41,4,21,4,0)
execute the entry and exit actions, ignoring any items that may exist; these
"^DD",101.41,101.41,4,21,5,0)
dialogs should not create entries in the Orders file.
"^DD",101.41,101.41,4,"DT")
3010430
"^DD",101.41,101.41,5,0)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"^DD",101.41,101.41,5,3)
Enter the display group containing orderable items defined by this dialog.
"^DD",101.41,101.41,5,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,5,21,1,0)
This field determines what display group this dialog has been defined for.
"^DD",101.41,101.41,5,21,2,0)
It will define which orderable items are selectable with this dialog,
"^DD",101.41,101.41,5,21,3,0)
as well as what service to send the order to when it is complete.
"^DD",101.41,101.41,5,"DT")
2950112
"^DD",101.41,101.41,6,0)
SIGNATURE REQUIRED^S^0:NONE;1:ORELSE;2:ORES;^0;6^Q
"^DD",101.41,101.41,6,3)
Enter the OR key required to sign orders created by this dialog
"^DD",101.41,101.41,6,21,0)
^^6^6^2970318^^
"^DD",101.41,101.41,6,21,1,0)
This field indicates what signature will be required for orders created by
"^DD",101.41,101.41,6,21,2,0)
this dialog, to be considered complete and ready to release to the service
"^DD",101.41,101.41,6,21,3,0)
for action.  If this flag is set to NO and the dialog contains a prompt
"^DD",101.41,101.41,6,21,4,0)
for item(s) from the Orderable Item file, the order created may still
"^DD",101.41,101.41,6,21,5,0)
require a signature if any of the items ordered are individually flagged
"^DD",101.41,101.41,6,21,6,0)
as requiring a signature.
"^DD",101.41,101.41,6,"DT")
2970318
"^DD",101.41,101.41,7,0)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"^DD",101.41,101.41,7,1,0)
^.1
"^DD",101.41,101.41,7,1,1,0)
101.41^APKG
"^DD",101.41,101.41,7,1,1,1)
S ^ORD(101.41,"APKG",$E(X,1,30),DA)=""
"^DD",101.41,101.41,7,1,1,2)
K ^ORD(101.41,"APKG",$E(X,1,30),DA)
"^DD",101.41,101.41,7,1,1,"DT")
2970325
"^DD",101.41,101.41,7,3)
Enter the VISTA package that is to receive orders created by this dialog.
"^DD",101.41,101.41,7,21,0)
^^3^3^2950208^
"^DD",101.41,101.41,7,21,1,0)
This is the VISTA package that is intended to receive orders created by
"^DD",101.41,101.41,7,21,2,0)
this dialog; this is required for creating the HL7 messages to pass the
"^DD",101.41,101.41,7,21,3,0)
order.
"^DD",101.41,101.41,7,"DT")
2970325
"^DD",101.41,101.41,8,0)
VERIFY ORDER^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.41,8,3)
Enter YES to have orders created by this dialog presented to the user before saving, with the opportunity to edit.
"^DD",101.41,101.41,8,21,0)
^^3^3^2950623^
"^DD",101.41,101.41,8,21,1,0)
This field is a flag, which determines if the order created by this dialog
"^DD",101.41,101.41,8,21,2,0)
will be presented to the user for verification before saving in the Orders
"^DD",101.41,101.41,8,21,3,0)
file; for most quick orders, this flag should be set to 0 (no).
"^DD",101.41,101.41,8,"DT")
2950623
"^DD",101.41,101.41,9,0)
ASK FOR ANOTHER ORDER^S^0:NO;1:YES;2:YES-DON'T ASK;^0;9^Q
"^DD",101.41,101.41,9,3)
Enter YES to have the user asked to enter another order from this dialog before exiting.
"^DD",101.41,101.41,9,21,0)
^^6^6^2970616^^^
"^DD",101.41,101.41,9,21,1,0)
This field allows the user to add another order from this dialog, when the
"^DD",101.41,101.41,9,21,2,0)
initial order is accepted and placed; if set to YES, the user will be
"^DD",101.41,101.41,9,21,3,0)
asked "Add another <dialog display text> order?" to allow for either
"^DD",101.41,101.41,9,21,4,0)
exiting the processor or adding an additional order of the same type.
"^DD",101.41,101.41,9,21,5,0)
This field can also be set to YES-DON'T ASK to force the processor to
"^DD",101.41,101.41,9,21,6,0)
automatically drop into prompting for another order without asking first.
"^DD",101.41,101.41,9,"DT")
2970616
"^DD",101.41,101.41,10,0)
ITEMS^101.412IA^^10;0
"^DD",101.41,101.41,10,21,0)
^^5^5^2990211^^^^
"^DD",101.41,101.41,10,21,1,0)
This field contains the components for dialogs:
"^DD",101.41,101.41,10,21,2,0)
     Dialogs      -> prompts
"^DD",101.41,101.41,10,21,3,0)
     Quick orders -> prompts (completed)
"^DD",101.41,101.41,10,21,4,0)
     Order sets   -> dialogs or quick orders
"^DD",101.41,101.41,10,21,5,0)
     Menus        -> dialogs, quick orders, or order sets
"^DD",101.41,101.41,11,0)
DATA TYPE^S^D:date/time;R:free text date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;^1;1^Q
"^DD",101.41,101.41,11,3)
Enter the type of data to be collected at this prompt.
"^DD",101.41,101.41,11,21,0)
^^2^2^2950823^^
"^DD",101.41,101.41,11,21,1,0)
This is the type of data being prompted for; this field is used to define
"^DD",101.41,101.41,11,21,2,0)
a call to the reader (^DIR) in most cases.
"^DD",101.41,101.41,11,23,0)
^^1^1^2950823^^
"^DD",101.41,101.41,11,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,11,"DT")
2950407
"^DD",101.41,101.41,12,0)
DOMAIN^F^^1;2^K:$L(X)>235!($L(X)<1) X
"^DD",101.41,101.41,12,3)
Answer must be 1-235 characters in length.
"^DD",101.41,101.41,12,21,0)
^^3^3^2990225^^^^
"^DD",101.41,101.41,12,21,1,0)
This is a parameter that may be used to further specify the data type.
"^DD",101.41,101.41,12,21,2,0)
The string stored here should be appropriate for the second ^-piece of
"^DD",101.41,101.41,12,21,3,0)
DIR(0) when used with the data type field.
"^DD",101.41,101.41,12,23,0)
^^1^1^2990225^^^^
"^DD",101.41,101.41,12,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,12,"DT")
2990225
"^DD",101.41,101.41,13,0)
ID^F^^1;3^K:$L(X)>10!($L(X)<2) X
"^DD",101.41,101.41,13,3)
Answer must be 2-10 characters in length.
"^DD",101.41,101.41,13,21,0)
^.001^20^20^3010727^^
"^DD",101.41,101.41,13,21,1,0)
This field may contain a single word identifier which will be
"^DD",101.41,101.41,13,21,2,0)
stored with the user response in the Orders file #100, where it
"^DD",101.41,101.41,13,21,3,0)
will be indexed for quick reference to certain values in the
"^DD",101.41,101.41,13,21,4,0)
order dialog.  The following are some examples of values
"^DD",101.41,101.41,13,21,5,0)
currently in use:
"^DD",101.41,101.41,13,21,6,0)
 
"^DD",101.41,101.41,13,21,7,0)
   START      -> Start date/time
"^DD",101.41,101.41,13,21,8,0)
   STOP       -> Stop date/time
"^DD",101.41,101.41,13,21,9,0)
   SCHEDULE   -> Administration Schedule
"^DD",101.41,101.41,13,21,10,0)
   ORDERABLE  -> Orderable Item
"^DD",101.41,101.41,13,21,11,0)
   DRUG       -> Dispense Drug
"^DD",101.41,101.41,13,21,12,0)
   CANCEL     -> Cancel Future Orders flag
"^DD",101.41,101.41,13,21,13,0)
   COMMENT    -> Word processing comments
"^DD",101.41,101.41,13,21,14,0)
 
"^DD",101.41,101.41,13,21,15,0)
These values must be unique among entries within an order dialog
"^DD",101.41,101.41,13,21,16,0)
but do not need to be unique across the entire file.  Be sure to
"^DD",101.41,101.41,13,21,17,0)
check the IDs assigned to generic text entries to make sure that
"^DD",101.41,101.41,13,21,18,0)
all IDs are unique.  In order to avoid potential problems it's
"^DD",101.41,101.41,13,21,19,0)
recommended that you use unique IDs for any local entries that you
"^DD",101.41,101.41,13,21,20,0)
create.
"^DD",101.41,101.41,13,"DT")
2960215
"^DD",101.41,101.41,17,0)
VALIDATION^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,17,9)
@
"^DD",101.41,101.41,17,21,0)
^^3^3^2960912^
"^DD",101.41,101.41,17,21,1,0)
This is MUMPS code that will be executed at the time of releasing an
"^DD",101.41,101.41,17,21,2,0)
order created with this dialog; dialog responses may be checked again
"^DD",101.41,101.41,17,21,3,0)
here before releasing the order to the service.
"^DD",101.41,101.41,17,"DT")
2960912
"^DD",101.41,101.41,19,0)
ADDITIONAL TEXT^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,19,9)
@
"^DD",101.41,101.41,19,21,0)
^^3^3^2960405^^
"^DD",101.41,101.41,19,21,1,0)
This is MUMPS code that will be executed when order ORIFN created by this
"^DD",101.41,101.41,19,21,2,0)
dialog is about to be displayed; any string that should be appended to the
"^DD",101.41,101.41,19,21,3,0)
order text should be returned in Y.
"^DD",101.41,101.41,19,"DT")
2960405
"^DD",101.41,101.41,20,0)
DESCRIPTION^101.411^^2;0
"^DD",101.41,101.41,20,21,0)
^^1^1^2971219^
"^DD",101.41,101.41,20,21,1,0)
This is a description of the dialog and its uses.
"^DD",101.41,101.41,21,0)
RESPONSES^101.416^^6;0
"^DD",101.41,101.41,21,21,0)
^^2^2^2971219^
"^DD",101.41,101.41,21,21,1,0)
This multiple contains any responses to prompts that have been pre-answered
"^DD",101.41,101.41,21,21,2,0)
to create a quick order.
"^DD",101.41,101.41,30,0)
ENTRY ACTION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,30,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,30,9)
@
"^DD",101.41,101.41,30,21,0)
^^4^4^2950425^
"^DD",101.41,101.41,30,21,1,0)
This is MUMPS code that will be executed at the top of a dialog, prior to
"^DD",101.41,101.41,30,21,2,0)
the execution of any prompts; it may perform functions such as listing
"^DD",101.41,101.41,30,21,3,0)
the recent Radiology exams before ordering a new one, or alerting the
"^DD",101.41,101.41,30,21,4,0)
user to an existing diet order before making a change.
"^DD",101.41,101.41,30,"DT")
2950425
"^DD",101.41,101.41,31,0)
QUICK SETUP^K^^3.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,31,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,31,9)
@
"^DD",101.41,101.41,31,21,0)
^^3^3^2970113^
"^DD",101.41,101.41,31,21,1,0)
This is MUMPS code that will be executed in the place of the Entry Action
"^DD",101.41,101.41,31,21,2,0)
when creating quick orders for this dialog; variables may be set here
"^DD",101.41,101.41,31,21,3,0)
instead to bypass the usual dependence on specific patient values.
"^DD",101.41,101.41,31,"DT")
2970113
"^DD",101.41,101.41,40,0)
EXIT ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,40,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,40,9)
@
"^DD",101.41,101.41,40,21,0)
^^2^2^2950622^
"^DD",101.41,101.41,40,21,1,0)
This is MUMPS code that will be executed upon completion of processing the
"^DD",101.41,101.41,40,21,2,0)
dialog; it is currently used only with dialog-type entries.
"^DD",101.41,101.41,40,"DT")
2950622
"^DD",101.41,101.41,50,0)
CONTROLS^101.415A^^50;0
"^DD",101.41,101.41,51,0)
COLUMN WIDTH^NJ3,0^^5;1^K:+X'=X!(X>240)!(X<20)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,51,1,0)
^.1
"^DD",101.41,101.41,51,1,1,0)
101.41^AM51^MUMPS
"^DD",101.41,101.41,51,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,51,1,1,"%D",1,0)
Update TIMESTAMP whenever COLUMN WIDTH is changed.
"^DD",101.41,101.41,51,1,1,"DT")
2990210
"^DD",101.41,101.41,51,3)
Type a Number between 20 and 240, 0 Decimal Digits
"^DD",101.41,101.41,51,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,51,21,1,0)
This is the width, in characters, for each column in a menu.  For example,
"^DD",101.41,101.41,51,21,2,0)
to have 3 columns on an 80 character device, enter a width of 26.
"^DD",101.41,101.41,51,"DT")
2990210
"^DD",101.41,101.41,52,0)
MNEMONIC WIDTH^NJ1,0^^5;2^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,52,1,0)
^.1
"^DD",101.41,101.41,52,1,1,0)
101.41^AM52^MUMPS
"^DD",101.41,101.41,52,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,52,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC WIDTH is changed.
"^DD",101.41,101.41,52,1,1,"DT")
2990210
"^DD",101.41,101.41,52,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",101.41,101.41,52,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,52,21,1,0)
This field allows the width of item mnemonics to be varied; the default
"^DD",101.41,101.41,52,21,2,0)
value is 5.
"^DD",101.41,101.41,52,"DT")
2990210
"^DD",101.41,101.41,53,0)
PATH SWITCH^S^1:YES;0:NO;^5;3^Q
"^DD",101.41,101.41,53,3)
Enter YES if this menu should be redisplayed when traversing back up the menu tree.
"^DD",101.41,101.41,53,21,0)
^^5^5^2950623^
"^DD",101.41,101.41,53,21,1,0)
This switch allows the user, when traversing back UP the tree of menus and
"^DD",101.41,101.41,53,21,2,0)
items, to select a new path back down the tree.  In other words, the menu
"^DD",101.41,101.41,53,21,3,0)
is redisplayed when returning to that menu's level in the tree and
"^DD",101.41,101.41,53,21,4,0)
processing back down the tree is possible from that point.  If nothing is
"^DD",101.41,101.41,53,21,5,0)
selected from the menu, the path continues back up the tree.
"^DD",101.41,101.41,53,"DT")
2950623
"^DD",101.41,101.41,54,0)
LISTBOX TEXT^F^^5;4^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.41,54,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.41,54,"DT")
2960524
"^DD",101.41,101.41,55,0)
WINDOW FORM ID^NJ4,0^^5;5^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,55,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",101.41,101.41,55,21,0)
^.001^23^23^3010727^^
"^DD",101.41,101.41,55,21,1,0)
This field tells the GUI DELPHI code which form to use to process the
"^DD",101.41,101.41,55,21,2,0)
order dialog.  Each number represents a unique form.  Following are some
"^DD",101.41,101.41,55,21,3,0)
of the more common codes and their corresponding form in DELPHI.
"^DD",101.41,101.41,55,21,4,0)
 
"^DD",101.41,101.41,55,21,5,0)
    Form Name     Windows Form ID
"^DD",101.41,101.41,55,21,6,0)
    ---------     ---------------
"^DD",101.41,101.41,55,21,7,0)
  OD_ACTIVITY           100
"^DD",101.41,101.41,55,21,8,0)
  OD_ALLERGY            105
"^DD",101.41,101.41,55,21,9,0)
  OD_CONSULT            110
"^DD",101.41,101.41,55,21,10,0)
  OD_PROCEDURE          112
"^DD",101.41,101.41,55,21,11,0)
  OD_DIET_TXT           115
"^DD",101.41,101.41,55,21,12,0)
  OD_DIET               117
"^DD",101.41,101.41,55,21,13,0)
  OD_LAB                120
"^DD",101.41,101.41,55,21,14,0)
  OD_MEDINPT            130
"^DD",101.41,101.41,55,21,15,0)
  OD_MEDS               135
"^DD",101.41,101.41,55,21,16,0)
  OD_MEDOUTPT           140
"^DD",101.41,101.41,55,21,17,0)
  OD_NURSING            150
"^DD",101.41,101.41,55,21,18,0)
  OD_MISC               151
"^DD",101.41,101.41,55,21,19,0)
  OD_GENERIC            152
"^DD",101.41,101.41,55,21,20,0)
  OD_IMAGING            160
"^DD",101.41,101.41,55,21,21,0)
  OD_VITALS             171 
"^DD",101.41,101.41,55,21,22,0)
  OD_MEDIV              180
"^DD",101.41,101.41,55,21,23,0)
  OD_TEXTONLY           999
"^DD",101.41,101.41,55,"DT")
2960804
"^DD",101.41,101.41,56,0)
CREATE PARENT ORDER^S^1:YES;0:NO;^5;6^Q
"^DD",101.41,101.41,56,3)
Enter YES if a parent order should be created for this order set
"^DD",101.41,101.41,56,21,0)
^^6^6^2970227^
"^DD",101.41,101.41,56,21,1,0)
This flag indicates whether a parent order should be created to group
"^DD",101.41,101.41,56,21,2,0)
together all the orders created by this order set; this flag is only
"^DD",101.41,101.41,56,21,3,0)
valid with SET type order dialogs.  If this value is YES, a parent
"^DD",101.41,101.41,56,21,4,0)
order will be created, and only the parent will be presented on the
"^DD",101.41,101.41,56,21,5,0)
orders list for display and action; NO will prevent a parent from being
"^DD",101.41,101.41,56,21,6,0)
created and all orders will be created and displayed independently.
"^DD",101.41,101.41,56,"DT")
2970227
"^DD",101.41,101.41,57,0)
DISPLAY SUBHEADER^S^1:YES;0:NO;^5;7^Q
"^DD",101.41,101.41,57,3)
Enter YES if a subheader should be displayed as each order in this set is processed
"^DD",101.41,101.41,57,21,0)
^^3^3^2970227^
"^DD",101.41,101.41,57,21,1,0)
This flag indicates whether a subheader is to be displayed for each order
"^DD",101.41,101.41,57,21,2,0)
in this set as it is processed and placed; this flag is only valid with
"^DD",101.41,101.41,57,21,3,0)
SET type order dialogs.
"^DD",101.41,101.41,57,"DT")
2970227
"^DD",101.41,101.41,58,0)
AUTO-ACCEPT QUICK ORDER^S^1:YES;^5;8^Q
"^DD",101.41,101.41,58,3)
Enter 'Yes' if the order should be placed without displaying the dialog window.
"^DD",101.41,101.41,58,21,0)
^^2^2^2980902^
"^DD",101.41,101.41,58,21,1,0)
This can be set to yes for a quick order so that it can be placed simply
"^DD",101.41,101.41,58,21,2,0)
by clicking on it in the GUI (no ordering dialog is displayed).
"^DD",101.41,101.41,58,"DT")
2980902
"^DD",101.41,101.41,59,0)
URL^P101.14^ORD(101.14,^5;9^Q
"^DD",101.41,101.41,59,3)
Enter the URL that should be associated with this dialog.
"^DD",101.41,101.41,59,21,0)
^^3^3^3010724^
"^DD",101.41,101.41,59,21,1,0)
This points an entry in the ORDER HTML FORM file.  The URL is used to
"^DD",101.41,101.41,59,21,2,0)
tpresent the user with an HTML form that can be used to select quick
"^DD",101.41,101.41,59,21,3,0)
orders.
"^DD",101.41,101.41,59,"DT")
3010724
"^DD",101.41,101.41,99,0)
TIMESTAMP^F^^99;1^K:$L(X)>15!($L(X)<1) X
"^DD",101.41,101.41,99,1,0)
^.1
"^DD",101.41,101.41,99,1,1,0)
101.41^AM^MUMPS
"^DD",101.41,101.41,99,1,1,1)
D SET^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,2)
D KILL^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,"%D",0)
^^2^2^2990210^
"^DD",101.41,101.41,99,1,1,"%D",1,0)
Recompiles order dialog menus in ^XUTL("XQORM",<dialog#>_";ORD(101.41,")
"^DD",101.41,101.41,99,1,1,"%D",2,0)
whenever fields necessary to displaying the menu are changed.
"^DD",101.41,101.41,99,1,1,"DT")
2990210
"^DD",101.41,101.41,99,3)
Answer must be 1-15 characters in length.
"^DD",101.41,101.41,99,21,0)
^^2^2^2980501^
"^DD",101.41,101.41,99,21,1,0)
For menus, this contains the $H time the menu was last compiled for use
"^DD",101.41,101.41,99,21,2,0)
with the Unwinder utility (^XQOR).
"^DD",101.41,101.41,99,"DT")
2990210
"^DD",101.41,101.411,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",101.41,101.411,0,"DT")
2950407
"^DD",101.41,101.411,0,"NM","DESCRIPTION")

"^DD",101.41,101.411,0,"UP")
101.41
"^DD",101.41,101.411,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",101.41,101.411,.01,3)
Enter a description of this dialog.
"^DD",101.41,101.411,.01,21,0)
^^1^1^2950425^^
"^DD",101.41,101.411,.01,21,1,0)
This field contains a description of the content and use of this dialog.
"^DD",101.41,101.411,.01,"DT")
2950407
"^DD",101.41,101.412,0)
ITEMS SUB-FIELD^^117^37
"^DD",101.41,101.412,0,"DT")
2971117
"^DD",101.41,101.412,0,"ID","WRITE")
N OR0,ORNM S OR0=^(0) I $P(OR0,U,2) S ORNM=$P($G(^ORD(101.41,+$P(OR0,U,2),0)),U) D:$L(ORNM) EN^DDIOL(ORNM,,"?10")
"^DD",101.41,101.412,0,"IX","ATXT",101.412,21)

"^DD",101.41,101.412,0,"IX","B",101.412,.01)

"^DD",101.41,101.412,0,"IX","D",101.412,2)

"^DD",101.41,101.412,0,"IX","DAD",101.412,1)

"^DD",101.41,101.412,0,"IX","DAD1",101.412,.01)

"^DD",101.41,101.412,0,"NM","ITEMS")

"^DD",101.41,101.412,0,"UP")
101.41
"^DD",101.41,101.412,.01,0)
SEQUENCE^MNJ5,1^^0;1^K:+X'=X!(X>999.9)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.41,101.412,.01,1,0)
^.1
"^DD",101.41,101.412,.01,1,1,0)
101.412^B
"^DD",101.41,101.412,.01,1,1,1)
S ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.412,.01,1,1,2)
K ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)
"^DD",101.41,101.412,.01,1,2,0)
101.412^DAD1^MUMPS
"^DD",101.41,101.412,.01,1,2,1)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) S:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)=""
"^DD",101.41,101.412,.01,1,2,2)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) K:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)
"^DD",101.41,101.412,.01,1,2,"%D",0)
^^1^1^2950511^
"^DD",101.41,101.412,.01,1,2,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,.01,1,2,"DT")
2950511
"^DD",101.41,101.412,.01,1,3,0)
101.41^AMM^MUMPS
"^DD",101.41,101.412,.01,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,.01,1,3,"%D",1,0)
Update TIMESTAMP whenever SEQUENCE is changed.
"^DD",101.41,101.412,.01,1,3,"DT")
2990210
"^DD",101.41,101.412,.01,3)
Type a Number between .1 and 999.9, 1 Decimal Digit
"^DD",101.41,101.412,.01,21,0)
^^2^2^2971117^^^^
"^DD",101.41,101.412,.01,21,1,0)
This field specifies the order in which this item will be displayed or
"^DD",101.41,101.412,.01,21,2,0)
processed.
"^DD",101.41,101.412,.01,"DT")
2990210
"^DD",101.41,101.412,.1,0)
INPUT TRANSFORM^K^^.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,.1,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,.1,9)
@
"^DD",101.41,101.412,.1,21,0)
^^2^2^2950816^
"^DD",101.41,101.412,.1,21,1,0)
This is code that will be used as the third piece of DIR(0) when asking
"^DD",101.41,101.412,.1,21,2,0)
this prompt.
"^DD",101.41,101.412,.1,"DT")
2950816
"^DD",101.41,101.412,1,0)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"^DD",101.41,101.412,1,1,0)
^.1
"^DD",101.41,101.412,1,1,1,0)
101.412^DAD^MUMPS
"^DD",101.41,101.412,1,1,1,1)
S ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)=""
"^DD",101.41,101.412,1,1,1,2)
K ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)
"^DD",101.41,101.412,1,1,1,"%D",0)
^^1^1^2950511^^
"^DD",101.41,101.412,1,1,1,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,1,1,1,"DT")
2950511
"^DD",101.41,101.412,1,3)
If this prompt is subordinate to another in this dialog, enter the parent prompt here
"^DD",101.41,101.412,1,21,0)
^^4^4^2950511^
"^DD",101.41,101.412,1,21,1,0)
This field controls the behavior of this prompt.  If a parent is defined
"^DD",101.41,101.412,1,21,2,0)
here, this prompt will be asked from within the parent's dialog; when it
"^DD",101.41,101.412,1,21,3,0)
is invoked independently based on its position sequence number, the child
"^DD",101.41,101.412,1,21,4,0)
prompt will be ignored.
"^DD",101.41,101.412,1,"DT")
2950511
"^DD",101.41,101.412,2,0)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"^DD",101.41,101.412,2,1,0)
^.1
"^DD",101.41,101.412,2,1,1,0)
101.41^AD
"^DD",101.41,101.412,2,1,1,1)
S ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)=""
"^DD",101.41,101.412,2,1,1,2)
K ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)
"^DD",101.41,101.412,2,1,1,"DT")
2950123
"^DD",101.41,101.412,2,1,2,0)
101.412^D
"^DD",101.41,101.412,2,1,2,1)
S ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.412,2,1,2,2)
K ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)
"^DD",101.41,101.412,2,1,2,"DT")
2950411
"^DD",101.41,101.412,2,1,3,0)
101.41^AMM2^MUMPS
"^DD",101.41,101.412,2,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,2,1,3,"%D",1,0)
Update TIMESTAMP whenever ITEM is changed.
"^DD",101.41,101.412,2,1,3,"DT")
2990210
"^DD",101.41,101.412,2,3)
Enter an order dialog; a dialog that is an ancestor may not also be a sub-item.
"^DD",101.41,101.412,2,21,0)
^^3^3^2950123^
"^DD",101.41,101.412,2,21,1,0)
This field points to an order dialog which is subordinate to this dialog.
"^DD",101.41,101.412,2,21,2,0)
NOTE:  The parent dialog menu or one of its ancestors may not be entered
"^DD",101.41,101.412,2,21,3,0)
as an item.
"^DD",101.41,101.412,2,"DT")
2990217
"^DD",101.41,101.412,3,0)
MNEMONIC^FX^^0;3^K:$L(X)>4!($L(X)<1)!(+X=X&($L(X,".")>1))!($$CHKMNE^ORUTL(X)) X
"^DD",101.41,101.412,3,1,0)
^.1
"^DD",101.41,101.412,3,1,1,0)
101.41^AMM3^MUMPS
"^DD",101.41,101.412,3,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,3,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC is changed.
"^DD",101.41,101.412,3,1,1,"DT")
2990210
"^DD",101.41,101.412,3,3)
Enter a mnemonic to be used when this dialog is displayed for selection, 1-4 characters in length with no decimal places if numeric. Standard list manager mnemonics may not be used.
"^DD",101.41,101.412,3,21,0)
^.001^2^2^3010727^^^^
"^DD",101.41,101.412,3,21,1,0)
This is a short abbreviation for this item dialog to be used when this
"^DD",101.41,101.412,3,21,2,0)
dialog is displayed for selection.
"^DD",101.41,101.412,3,"DT")
3000822
"^DD",101.41,101.412,4,0)
DISPLAY TEXT^FX^^0;4^K:$L(X)>80!($L(X)<1)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.412,4,1,0)
^.1
"^DD",101.41,101.412,4,1,1,0)
101.41^AMM4^MUMPS
"^DD",101.41,101.412,4,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,4,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.412,4,1,1,"DT")
2990210
"^DD",101.41,101.412,4,3)
Answer must be 1-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=).
"^DD",101.41,101.412,4,21,0)
^.001^2^2^3010419^^^^
"^DD",101.41,101.412,4,21,1,0)
This field allows the text that normally appears for this item to be
"^DD",101.41,101.412,4,21,2,0)
replaced with alternate text for use in this dialog or menu.
"^DD",101.41,101.412,4,"DT")
3000823
"^DD",101.41,101.412,5,0)
DISPLAY ONLY?^S^0:NO;1:YES;2:YES-HEADER;^0;5^Q
"^DD",101.41,101.412,5,1,0)
^.1
"^DD",101.41,101.412,5,1,1,0)
101.41^AMM5^MUMPS
"^DD",101.41,101.412,5,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,5,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY ONLY? is changed.
"^DD",101.41,101.412,5,1,1,"DT")
2990210
"^DD",101.41,101.412,5,3)
Enter YES if this item is text for display only and not a selectable item.
"^DD",101.41,101.412,5,21,0)
^^3^3^2970409^^^^
"^DD",101.41,101.412,5,21,1,0)
This field identifies an item as being free text for display purposes
"^DD",101.41,101.412,5,21,2,0)
only.  The text in the Display Text field will be displayed, but it
"^DD",101.41,101.412,5,21,3,0)
is not selectable; if designated as a header, the text will be underlined.
"^DD",101.41,101.412,5,"DT")
2990210
"^DD",101.41,101.412,6,0)
REQUIRED^S^1:YES;0:NO;^0;6^Q
"^DD",101.41,101.412,6,3)
Enter YES if a response to this prompt is mandatory.
"^DD",101.41,101.412,6,21,0)
^^1^1^2950407^
"^DD",101.41,101.412,6,21,1,0)
This field indicates that the user must enter a response to this prompt.
"^DD",101.41,101.412,6,"DT")
2950407
"^DD",101.41,101.412,7,0)
MULTIPLE VALUED^S^1:YES;0:NO;^0;7^Q
"^DD",101.41,101.412,7,3)
Enter YES if this prompt is to be asked multiple times.
"^DD",101.41,101.412,7,21,0)
^^3^3^2950407^
"^DD",101.41,101.412,7,21,1,0)
This field determines if this prompt will be allowed to have multiple
"^DD",101.41,101.412,7,21,2,0)
values, or be prompted for only once; if this prompt is a sub-dialog,
"^DD",101.41,101.412,7,21,3,0)
the entire dialog will be asked once or many times, as a group.
"^DD",101.41,101.412,7,"DT")
2950407
"^DD",101.41,101.412,7.1,0)
MAX NUMBER OF MULTIPLES^NJ2,0^^0;12^K:+X'=X!(X>99)!(X<2)!(X?.E1"."1N.N) X
"^DD",101.41,101.412,7.1,3)
Type a Number between 2 and 99, 0 Decimal Digits
"^DD",101.41,101.412,7.1,21,0)
^^4^4^2950815^
"^DD",101.41,101.412,7.1,21,1,0)
This is the maximum number of values that may be entered for this prompt,
"^DD",101.41,101.412,7.1,21,2,0)
if it is flagged as being multiple-valued.  For example, a diet order may
"^DD",101.41,101.412,7.1,21,3,0)
have up to 5 diet modifications entered, where 5 is the maximum allowed
"^DD",101.41,101.412,7.1,21,4,0)
that would be entered here.
"^DD",101.41,101.412,7.1,"DT")
2950815
"^DD",101.41,101.412,7.2,0)
TITLE^F^^0;13^K:$L(X)>30!($L(X)<3) X
"^DD",101.41,101.412,7.2,3)
Answer must be 3-30 characters in length.
"^DD",101.41,101.412,7.2,21,0)
^^8^8^2970430^^
"^DD",101.41,101.412,7.2,21,1,0)
This is text that will be used in place of the prompt when the order is
"^DD",101.41,101.412,7.2,21,2,0)
displayed for place, edit, or cancel, or at the top of a multiple-valued
"^DD",101.41,101.412,7.2,21,3,0)
prompt.  The Display Text for the prompt will be used together with the
"^DD",101.41,101.412,7.2,21,4,0)
instance number to prompt for user input; for example if Title="Lab Tests:"
"^DD",101.41,101.412,7.2,21,5,0)
and Display Text="Test:" the user would see
"^DD",101.41,101.412,7.2,21,6,0)
  Lab Tests:
"^DD",101.41,101.412,7.2,21,7,0)
  1. Test:
"^DD",101.41,101.412,7.2,21,8,0)
  2. Test:
"^DD",101.41,101.412,7.2,"DT")
2950815
"^DD",101.41,101.412,7.3,0)
PROMPT^F^^0;14^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,7.3,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,7.3,21,0)
^^3^3^2970618^
"^DD",101.41,101.412,7.3,21,1,0)
This field contains text that will be appended to the beginning of the
"^DD",101.41,101.412,7.3,21,2,0)
display text when prompting for additional values; if this field is
"^DD",101.41,101.412,7.3,21,3,0)
empty, then "Another " will be used.
"^DD",101.41,101.412,7.3,"DT")
2970618
"^DD",101.41,101.412,8,0)
ASK ON EDIT ONLY^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.412,8,3)
Enter YES if this prompt should not be asked initially when creating this order, only if the user chooses to edit the order.
"^DD",101.41,101.412,8,21,0)
^^4^4^2960112^^^
"^DD",101.41,101.412,8,21,1,0)
This field determines the behaviour of the dialog driver for this prompt;
"^DD",101.41,101.412,8,21,2,0)
if no value or the defined default is usually correct for this prompt,
"^DD",101.41,101.412,8,21,3,0)
enter YES here to have this prompt skipped on the first pass through this
"^DD",101.41,101.412,8,21,4,0)
dialog when creating an order.
"^DD",101.41,101.412,8,"DT")
2950407
"^DD",101.41,101.412,9,0)
ASK ON ACTION^F^^0;9^K:$L(X)>3!($L(X)<1) X
"^DD",101.41,101.412,9,3)
Answer must be 1-3 characters in length.
"^DD",101.41,101.412,9,21,0)
^^6^6^2970708^^^
"^DD",101.41,101.412,9,21,1,0)
This field determines the behaviour of the dialog driver for this prompt
"^DD",101.41,101.412,9,21,2,0)
when taking a particular action on an order created by this dialog.  If
"^DD",101.41,101.412,9,21,3,0)
this string contains "R", this prompt will be asked when renewing an order;
"^DD",101.41,101.412,9,21,4,0)
if this string contains "C", this prompt will be asked when changing an
"^DD",101.41,101.412,9,21,5,0)
order; if this string contains "W", this prompt will be asked when
"^DD",101.41,101.412,9,21,6,0)
rewriting an order.
"^DD",101.41,101.412,9,"DT")
2970708
"^DD",101.41,101.412,10,0)
INDEX^F^^0;10^K:$L(X)>25!($L(X)<1) X
"^DD",101.41,101.412,10,3)
Answer must be 1-25 characters in length.
"^DD",101.41,101.412,10,21,0)
^^3^3^2950713^^^
"^DD",101.41,101.412,10,21,1,0)
For pointer-type prompts, this is the index to use when searching the file;
"^DD",101.41,101.412,10,21,2,0)
it must be in the form of a regular cross-reference.  To search on multiple
"^DD",101.41,101.412,10,21,3,0)
indices, enter a string of index names separated by semi-colons, i.e. "B;C".
"^DD",101.41,101.412,10,"DT")
2950713
"^DD",101.41,101.412,11,0)
HELP MESSAGE^F^^1;1^K:$L(X)>160!($L(X)<1) X
"^DD",101.41,101.412,11,3)
Answer must be 1-160 characters in length.
"^DD",101.41,101.412,11,21,0)
^^2^2^2970609^^
"^DD",101.41,101.412,11,21,1,0)
This field contains the help message to be presented when the user enters
"^DD",101.41,101.412,11,21,2,0)
a question mark at this prompt.
"^DD",101.41,101.412,11,"DT")
2970609
"^DD",101.41,101.412,12,0)
SPECIAL LOOKUP ROUTINE^F^^1;2^K:$L(X)>20!($L(X)<3) X
"^DD",101.41,101.412,12,3)
Enter the routine to use instead of DIC to do this lookup, as [TAG;]ROUTINE
"^DD",101.41,101.412,12,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,12,21,1,0)
This field contains a routine to execute that will replace the standard
"^DD",101.41,101.412,12,21,2,0)
DIC lookup for this prompt; it must be entered here as LINETAG;ROUTINE
"^DD",101.41,101.412,12,21,3,0)
using a ; instead of ^ and where LINETAG is optional.
"^DD",101.41,101.412,12,"DT")
2970609
"^DD",101.41,101.412,13,0)
ASK ON CONDITION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,13,3)
This is MUMPS code that sets $T to determine if this prompt should be asked, or given a default value and bypassed.
"^DD",101.41,101.412,13,9)
@
"^DD",101.41,101.412,13,21,0)
^^5^5^2950407^
"^DD",101.41,101.412,13,21,1,0)
This is MUMPS code that sets $T to determine if this prompt should be asked
"^DD",101.41,101.412,13,21,2,0)
or simply given a default value and presented to the user for acceptance
"^DD",101.41,101.412,13,21,3,0)
or editing.  For example, the prompt "Pregnant: " may have code here to
"^DD",101.41,101.412,13,21,4,0)
check the sex of the current patient, i.e. I ORSEX="F" will allow it to be
"^DD",101.41,101.412,13,21,5,0)
asked only for female patients.
"^DD",101.41,101.412,13,"DT")
2950407
"^DD",101.41,101.412,14,0)
SCREEN^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,14,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,14,9)
@
"^DD",101.41,101.412,14,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,14,21,1,0)
For pointer-type prompts, this field may contain MUMPS code that will be
"^DD",101.41,101.412,14,21,2,0)
set into DIC("S") to screen the possible choices in the pointed-to file.
"^DD",101.41,101.412,14,"DT")
2950407
"^DD",101.41,101.412,15,0)
POST-SELECTION ACTION^K^^5;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,15,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,15,9)
@
"^DD",101.41,101.412,15,21,0)
^^3^3^2970923^^^^
"^DD",101.41,101.412,15,21,1,0)
This is code that will be executed after a response is entered to this
"^DD",101.41,101.412,15,21,2,0)
prompt; if this prompt should be re-asked, kill the variable DONE.
"^DD",101.41,101.412,15,21,3,0)
If execution of the ordering dialog should be stopped, set ORQUIT=1.
"^DD",101.41,101.412,15,"DT")
2970923
"^DD",101.41,101.412,16,0)
XECUTABLE HELP^K^^6;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,16,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,16,9)
@
"^DD",101.41,101.412,16,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,16,21,1,0)
This is code that is to be executed when the user enters two or more
"^DD",101.41,101.412,16,21,2,0)
question marks at this prompt.
"^DD",101.41,101.412,16,"DT")
2950407
"^DD",101.41,101.412,17,0)
DEFAULT^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,17,9)
@
"^DD",101.41,101.412,17,21,0)
^^2^2^2971219^^^^
"^DD",101.41,101.412,17,21,1,0)
This is code that is to be executed to determine the appropriate default
"^DD",101.41,101.412,17,21,2,0)
value for this prompt, setting Y=internal form of this value.
"^DD",101.41,101.412,17,"DT")
2950519
"^DD",101.41,101.412,18,0)
DEFAULT WORD-PROCESSING TEXT^101.41218^^8;0
"^DD",101.41,101.412,18,21,0)
^^1^1^2971219^
"^DD",101.41,101.412,18,21,1,0)
This is default text to be stuffed into this word-processing prompt.
"^DD",101.41,101.412,19,0)
ENTRY ACTION^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,19,9)
@
"^DD",101.41,101.412,19,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,19,21,1,0)
This is code that will be executed at the beginning of the processing of
"^DD",101.41,101.412,19,21,2,0)
this prompt, before the Default and Ask on Condition fields are executed;
"^DD",101.41,101.412,19,21,3,0)
any special setup required for this field should be done here.
"^DD",101.41,101.412,19,"DT")
2970609
"^DD",101.41,101.412,20,0)
EXIT ACTION^K^^10;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,20,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,20,9)
@
"^DD",101.41,101.412,20,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,20,21,1,0)
This is code that will be executed at the very end of the processing of
"^DD",101.41,101.412,20,21,2,0)
this prompt, after prompting and the Validation field is executed;
"^DD",101.41,101.412,20,21,3,0)
any special cleanup should be done here.
"^DD",101.41,101.412,20,"DT")
2970609
"^DD",101.41,101.412,21,0)
ORDER TEXT SEQUENCE^NJ5,2^^2;1^K:+X'=X!(X>99.99)!(X<1)!(X?.E1"."3N.N) X
"^DD",101.41,101.412,21,1,0)
^.1
"^DD",101.41,101.412,21,1,1,0)
101.412^ATXT
"^DD",101.41,101.412,21,1,1,1)
S ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)=""
"^DD",101.41,101.412,21,1,1,2)
K ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)
"^DD",101.41,101.412,21,1,1,"%D",0)
^^1^1^2960226^
"^DD",101.41,101.412,21,1,1,"%D",1,0)
Used to build order text.
"^DD",101.41,101.412,21,1,1,"DT")
2960226
"^DD",101.41,101.412,21,3)
Enter the order in which this value should be added to the order text, as a number between 1 and 99.99; leave this field blank to prevent this value from being included
"^DD",101.41,101.412,21,21,0)
^^3^3^2970607^^^
"^DD",101.41,101.412,21,21,1,0)
This field indicates the order in which values will be concatenated
"^DD",101.41,101.412,21,21,2,0)
together to build the order text; this may differ from the prompting
"^DD",101.41,101.412,21,21,3,0)
order defined in the .01 Sequence field.
"^DD",101.41,101.412,21,"DT")
2960226
"^DD",101.41,101.412,22,0)
FORMAT^F^^2;2^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,22,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,22,21,0)
^^15^15^2971207^^^^
"^DD",101.41,101.412,22,21,1,0)
This is a string of characters that will define any exceptions to how
"^DD",101.41,101.412,22,21,2,0)
the external form of this value is generated.  Possible values include:
"^DD",101.41,101.412,22,21,3,0)
  Pointer         -> <field #>~<piece in RPC list of field #>, default =.01
"^DD",101.41,101.412,22,21,4,0)
  Set of Codes    -> 1~<piece in RPC list of code> to use code for name
"^DD",101.41,101.412,22,21,5,0)
  Date/Time       -> Format string to pass $$FMTE^XLFDT (default = 2)
"^DD",101.41,101.412,22,21,6,0)
  
"^DD",101.41,101.412,22,21,7,0)
  Suppress value  -> @
"^DD",101.41,101.412,22,21,8,0)
  Replace value   -> @<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,9,0)
                      whose value, when present, supersedes this value
"^DD",101.41,101.412,22,21,10,0)
  Required value  -> *<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,11,0)
                      whose value is required to be present to include
"^DD",101.41,101.412,22,21,12,0)
                      this value
"^DD",101.41,101.412,22,21,13,0)
  Ignore if same  -> =<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,14,0)
                      whose value, if the external form is the same,
"^DD",101.41,101.412,22,21,15,0)
                      supersedes this value
"^DD",101.41,101.412,22,"DT")
2960226
"^DD",101.41,101.412,23,0)
OMIT TEXT^F^^2;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,23,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,23,21,0)
^^3^3^2970829^^^^
"^DD",101.41,101.412,23,21,1,0)
This is the external form of a value that is not to be included when building
"^DD",101.41,101.412,23,21,2,0)
the order text.  E.g. to include the urgency in the order text unless it
"^DD",101.41,101.412,23,21,3,0)
is routine, enter "ROUTINE" here.
"^DD",101.41,101.412,23,"DT")
2970829
"^DD",101.41,101.412,24,0)
LEADING TEXT^F^^2;4^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,24,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,24,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,24,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,24,21,2,0)
immediately in front of this value, e.g. "Instructions:".  If this text
"^DD",101.41,101.412,24,21,3,0)
is contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,24,"DT")
2970724
"^DD",101.41,101.412,25,0)
TRAILING TEXT^F^^2;5^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,25,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,25,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,25,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,25,21,2,0)
immediately following this value, e.g. "refills".  If this text is
"^DD",101.41,101.412,25,21,3,0)
contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,25,"DT")
2970724
"^DD",101.41,101.412,26,0)
START NEW LINE^S^1:YES;0:NO;^2;6^Q
"^DD",101.41,101.412,26,3)
Enter YES if this value should begin on a new line in the order text.
"^DD",101.41,101.412,26,21,0)
0^^2^2^2970911^
"^DD",101.41,101.412,26,21,1,0)
This field determines if this value is concatenated onto the current line
"^DD",101.41,101.412,26,21,2,0)
when building the order text, or if a new line is started with this value.
"^DD",101.41,101.412,26,"DT")
2970911
"^DD",101.41,101.412,27,0)
WORD-WRAP^S^1:DON'T WRAP;0:WRAP;^2;7^Q
"^DD",101.41,101.412,27,3)
Enter 'Don't Wrap' to have the text be added line-by-line as it is stored; the default formatting is 'Wrap'.
"^DD",101.41,101.412,27,21,0)
^^3^3^2970926^^^
"^DD",101.41,101.412,27,21,1,0)
This field determines if this text should be wrapped when added to the
"^DD",101.41,101.412,27,21,2,0)
order text, or appended line by line as stored in the file; this is only
"^DD",101.41,101.412,27,21,3,0)
used for word-processing type prompts.
"^DD",101.41,101.412,27,"DT")
2970926
"^DD",101.41,101.412,101,0)
WINDOWS CONTROL^F^^W;1^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,101,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,101,21,0)
^^2^2^2950715^
"^DD",101.41,101.412,101,21,1,0)
Stores the type of Windows control necessary to get the data for this
"^DD",101.41,101.412,101,21,2,0)
prompt.
"^DD",101.41,101.412,101,"DT")
2960517
"^DD",101.41,101.412,102,0)
API NAME^F^^W;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,102,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,102,21,0)
^^3^3^2950715^
"^DD",101.41,101.412,102,21,1,0)
This is the API that should be called when the control is used.  How the API
"^DD",101.41,101.412,102,21,2,0)
is used varys with the control.  Examples are: filling list boxes, getting
"^DD",101.41,101.412,102,21,3,0)
boilerplate text, etc.
"^DD",101.41,101.412,102,"DT")
2951002
"^DD",101.41,101.412,103,0)
API PARAMETER #1^F^^W;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,103,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,103,21,0)
^^1^1^2950715^
"^DD",101.41,101.412,103,21,1,0)
A parameter that is used by the API call may be stored here.
"^DD",101.41,101.412,103,"DT")
2950715
"^DD",101.41,101.412,113,0)
WINDOWS CONDITION^K^^W3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,113,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,113,9)
@
"^DD",101.41,101.412,113,21,0)
^^3^3^2950715^
"^DD",101.41,101.412,113,21,1,0)
This is silent code that is executed when building the dialog for windows.
"^DD",101.41,101.412,113,21,2,0)
It identifies which prompts should be included in the dialog.  The condition
"^DD",101.41,101.412,113,21,3,0)
should leave $T false if the prompt should not be asked.
"^DD",101.41,101.412,113,"DT")
2950715
"^DD",101.41,101.412,117,0)
WINDOWS DEFAULT^K^^W7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,117,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,117,9)
@
"^DD",101.41,101.412,117,21,0)
^^2^2^2950715^
"^DD",101.41,101.412,117,21,1,0)
This code should silently set the default value of a prompt when it is 
"^DD",101.41,101.412,117,21,2,0)
selected.
"^DD",101.41,101.412,117,"DT")
2950715
"^DD",101.41,101.41218,0)
DEFAULT WORD-PROCESSING TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.41218,0,"DT")
2950407
"^DD",101.41,101.41218,0,"NM","DEFAULT WORD-PROCESSING TEXT")

"^DD",101.41,101.41218,0,"UP")
101.412
"^DD",101.41,101.41218,.01,0)
DEFAULT WORD-PROCESSING TEXT^W^^0;1^Q
"^DD",101.41,101.41218,.01,3)
Enter the default response for a word-processing type prompt.
"^DD",101.41,101.41218,.01,21,0)
^^2^2^2950407^
"^DD",101.41,101.41218,.01,21,1,0)
This field contains the text to be presented as the default for this prompt,
"^DD",101.41,101.41218,.01,21,2,0)
for word-processing type prompts.
"^DD",101.41,101.41218,.01,"DT")
2950407
"^DD",101.41,101.415,0)
CONTROLS SUB-FIELD^^14^14
"^DD",101.41,101.415,0,"DT")
2960202
"^DD",101.41,101.415,0,"IX","AC",101.415,3)

"^DD",101.41,101.415,0,"IX","B",101.415,.01)

"^DD",101.41,101.415,0,"NM","CONTROLS")

"^DD",101.41,101.415,0,"UP")
101.41
"^DD",101.41,101.415,.01,0)
LOGICAL NAME^MF^^0;1^K:$L(X)>8!($L(X)<1)!'(X?1.8U) X
"^DD",101.41,101.415,.01,1,0)
^.1
"^DD",101.41,101.415,.01,1,1,0)
101.415^B
"^DD",101.41,101.415,.01,1,1,1)
S ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.415,.01,1,1,2)
K ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)
"^DD",101.41,101.415,.01,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,.01,21,0)
^^1^1^2960202^
"^DD",101.41,101.415,.01,21,1,0)
This is the name by which controls can refer to each other.
"^DD",101.41,101.415,.01,"DT")
2960202
"^DD",101.41,101.415,2,0)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.415,2,"DT")
2960202
"^DD",101.41,101.415,3,0)
CREATE SEQUENCE^NJ2,0^^0;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,3,1,0)
^.1
"^DD",101.41,101.415,3,1,1,0)
101.415^AC
"^DD",101.41,101.415,3,1,1,1)
S ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)=""
"^DD",101.41,101.415,3,1,1,2)
K ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)
"^DD",101.41,101.415,3,1,1,"%D",0)
^^2^2^2960202^
"^DD",101.41,101.415,3,1,1,"%D",1,0)
The 'AC' cross-reference puts in window controls in order by creation 
"^DD",101.41,101.415,3,1,1,"%D",2,0)
sequence.
"^DD",101.41,101.415,3,1,1,"DT")
2960202
"^DD",101.41,101.415,3,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",101.41,101.415,3,"DT")
2960202
"^DD",101.41,101.415,4,0)
CONTROL TYPE^S^0:Label;1:Button;2:Edit;3:Memo;4:ListBox;5:SimpleCombo;6:DropDownList;7:LongCombo;^0;4^Q
"^DD",101.41,101.415,4,"DT")
2960202
"^DD",101.41,101.415,5,0)
LABEL^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.415,5,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.415,5,"DT")
2960202
"^DD",101.41,101.415,6,0)
BESIDE^F^^0;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,6,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,6,"DT")
2960202
"^DD",101.41,101.415,7,0)
BELOW^F^^0;7^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,7,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,7,"DT")
2960202
"^DD",101.41,101.415,8,0)
WIDTH^NJ6,4^^0;8^K:+X'=X!(X>1)!(X<0)!(X?.E1"."5N.N) X
"^DD",101.41,101.415,8,3)
Type a Number between 0 and 1, 4 Decimal Digits
"^DD",101.41,101.415,8,"DT")
2960202
"^DD",101.41,101.415,9,0)
LEFT CONTROL^F^^0;9^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,9,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,9,"DT")
2960202
"^DD",101.41,101.415,10,0)
RIGHT CONTROL^F^^0;10^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,10,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,10,"DT")
2960202
"^DD",101.41,101.415,11,0)
HEIGHT^NJ2,0^^0;11^K:+X'=X!(X>15)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,11,3)
Type a Number between 1 and 15, 0 Decimal Digits
"^DD",101.41,101.415,11,"DT")
2960202
"^DD",101.41,101.415,12,0)
UPPER CONTROL^F^^0;12^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,12,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,12,"DT")
2960202
"^DD",101.41,101.415,13,0)
LOWER CONTROL^F^^0;13^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,13,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,13,"DT")
2960202
"^DD",101.41,101.415,14,0)
TAB SEQUENCE^NJ2,0^^0;14^K:+X'=X!(X>89)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,14,3)
Type a Number between 0 and 89, 0 Decimal Digits
"^DD",101.41,101.415,14,"DT")
2960202
"^DD",101.41,101.416,0)
RESPONSES SUB-FIELD^^2^5
"^DD",101.41,101.416,0,"DT")
2960717
"^DD",101.41,101.416,0,"IX","D",101.416,.02)

"^DD",101.41,101.416,0,"NM","RESPONSES")

"^DD",101.41,101.416,0,"UP")
101.41
"^DD",101.41,101.416,.01,0)
ITEM ENTRY^MNJ7,0^^0;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.01,1,0)
^.1^^0
"^DD",101.41,101.416,.01,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.01,21,0)
^^2^2^2971219^^^
"^DD",101.41,101.416,.01,21,1,0)
This is the internal entry number of the prompt in the Item multiple
"^DD",101.41,101.416,.01,21,2,0)
by which this response was obtained.
"^DD",101.41,101.416,.01,"DT")
2961118
"^DD",101.41,101.416,.02,0)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.416,.02,1,0)
^.1
"^DD",101.41,101.416,.02,1,1,0)
101.416^D
"^DD",101.41,101.416,.02,1,1,1)
S ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.416,.02,1,1,2)
K ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)
"^DD",101.41,101.416,.02,1,1,"DT")
2961118
"^DD",101.41,101.416,.02,3)
Select the dialog prompt from which this response was generated.
"^DD",101.41,101.416,.02,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.02,21,1,0)
This is a pointer to the dialog prompt, which is in the Order Dialog file
"^DD",101.41,101.416,.02,21,2,0)
as type prompt.
"^DD",101.41,101.416,.02,"DT")
2961118
"^DD",101.41,101.416,.03,0)
INSTANCE^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.03,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.03,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.03,21,1,0)
In the case of multiple answers for the same item, this identifies the
"^DD",101.41,101.416,.03,21,2,0)
individual instance.
"^DD",101.41,101.416,.03,"DT")
2960717
"^DD",101.41,101.416,1,0)
VALUE^FO^^1;1^K:$L(X)>245!($L(X)<1) X
"^DD",101.41,101.416,1,2)
S Y(0)=Y S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,2.1)
S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,3)
Answer must be 1-245 characters in length.
"^DD",101.41,101.416,1,21,0)
^^2^2^2971219^^
"^DD",101.41,101.416,1,21,1,0)
This contains the actual response, unless the value is a word processing
"^DD",101.41,101.416,1,21,2,0)
type.
"^DD",101.41,101.416,1,"DT")
2980717
"^DD",101.41,101.416,2,0)
TEXT^101.4162^^2;0
"^DD",101.41,101.416,2,21,0)
^^1^1^2971219^
"^DD",101.41,101.416,2,21,1,0)
This contains the actual response, for word-processing type prompts.
"^DD",101.41,101.416,2,"DT")
2960717
"^DD",101.41,101.4162,0)
TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.4162,0,"DT")
2960717
"^DD",101.41,101.4162,0,"NM","TEXT")

"^DD",101.41,101.4162,0,"UP")
101.416
"^DD",101.41,101.4162,.01,0)
TEXT^WL^^0;1^Q
"^DD",101.41,101.4162,.01,21,0)
^^1^1^2960717^^
"^DD",101.41,101.4162,.01,21,1,0)
This contains responses to items that are a word processing type.
"^DD",101.41,101.4162,.01,"DT")
2960717
"^DD",8989.51,8989.51,0)
FIELD^^30^19
"^DD",8989.51,8989.51,0,"DDA")
N
"^DD",8989.51,8989.51,0,"DT")
2970621
"^DD",8989.51,8989.51,0,"ID","WRITE")
N X S X=^(0) D EN^DDIOL($P(X,U,2),"","?36")
"^DD",8989.51,8989.51,0,"IX","AG",8989.513,.02)

"^DD",8989.51,8989.51,0,"IX","B",8989.51,.01)

"^DD",8989.51,8989.51,0,"IX","C",8989.51,.02)

"^DD",8989.51,8989.51,0,"IX","D",8989.51,.01)

"^DD",8989.51,8989.51,0,"IX","D",8989.514,.01)

"^DD",8989.51,8989.51,0,"NM","PARAMETER DEFINITION")

"^DD",8989.51,8989.51,0,"PT",8989.5,.02)

"^DD",8989.51,8989.51,0,"PT",8989.52,.04)

"^DD",8989.51,8989.51,0,"PT",8989.521,.02)

"^DD",8989.51,8989.51,0,"VRPK")
OR
"^DD",8989.51,8989.51,.01,0)
NAME^RFX^^0;1^D VALID01^XPARDD1
"^DD",8989.51,8989.51,.01,1,0)
^.1
"^DD",8989.51,8989.51,.01,1,1,0)
8989.51^B
"^DD",8989.51,8989.51,.01,1,1,1)
S ^XTV(8989.51,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.51,.01,1,1,2)
K ^XTV(8989.51,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.51,.01,1,2,0)
8989.51^D^KWIC
"^DD",8989.51,8989.51,.01,1,2,1)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2,^DD("KWIC")'[I S ^XTV(8989.51,"D",I,DA)=""
"^DD",8989.51,8989.51,.01,1,2,2)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2 K ^XTV(8989.51,"D",I,DA)
"^DD",8989.51,8989.51,.01,1,2,"DT")
3000225
"^DD",8989.51,8989.51,.01,3)
Answer must be 3-30 characters in length.  Name must be unique.
"^DD",8989.51,8989.51,.01,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,.01,21,1,0)
This is the name of the parameter.  It should be namespaced according to the 
"^DD",8989.51,8989.51,.01,21,2,0)
package from which the parameter originated.
"^DD",8989.51,8989.51,.01,"DT")
2960207
"^DD",8989.51,8989.51,.02,0)
DISPLAY TEXT^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.02,1,0)
^.1
"^DD",8989.51,8989.51,.02,1,1,0)
8989.51^C^MUMPS
"^DD",8989.51,8989.51,.02,1,1,1)
S ^XTV(8989.51,"C",$$UPPER^XPARDD1(X),DA)=""
"^DD",8989.51,8989.51,.02,1,1,2)
K ^XTV(8989.51,"C",$$UPPER^XPARDD1(X),DA)
"^DD",8989.51,8989.51,.02,1,1,"%D",0)
^^2^2^2970606^
"^DD",8989.51,8989.51,.02,1,1,"%D",1,0)
Cross references display text for lookup.  Display text is put in upper
"^DD",8989.51,8989.51,.02,1,1,"%D",2,0)
case so lookup will be case insensitive.
"^DD",8989.51,8989.51,.02,1,1,"DT")
2960409
"^DD",8989.51,8989.51,.02,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.02,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,.02,21,1,0)
This is the displayable name for the parameter (allows mixed case, 
"^DD",8989.51,8989.51,.02,21,2,0)
non-namespaced names).
"^DD",8989.51,8989.51,.02,"DT")
2960409
"^DD",8989.51,8989.51,.03,0)
MULTIPLE VALUED^S^1:Yes;0:No;^0;3^Q
"^DD",8989.51,8989.51,.03,3)
Enter 'Yes' if multiple instances of the parameter are allowed for any single entity.
"^DD",8989.51,8989.51,.03,21,0)
^^3^3^2980705^
"^DD",8989.51,8989.51,.03,21,1,0)
If this field is set to 'Yes', multiple instances of the parameter will be 
"^DD",8989.51,8989.51,.03,21,2,0)
allowed for a single entity.  Otherwise, the value of the instance field
"^DD",8989.51,8989.51,.03,21,3,0)
for a given Entity-Parameter combination will always be '1'.
"^DD",8989.51,8989.51,.03,"DT")
2960207
"^DD",8989.51,8989.51,.04,0)
INSTANCE TERM^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.04,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.04,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,.04,21,1,0)
This is a free text term that can be used when prompting for a new instance of 
"^DD",8989.51,8989.51,.04,21,2,0)
the parameter (in the case where the parameter in multiple valued).  If not 
"^DD",8989.51,8989.51,.04,21,3,0)
entered, the word "Instance" will be used.
"^DD",8989.51,8989.51,.04,"DT")
2960207
"^DD",8989.51,8989.51,.05,0)
VALUE TERM^F^^0;5^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.05,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.05,21,0)
^^2^2^2970626^
"^DD",8989.51,8989.51,.05,21,1,0)
This contains text that is issued as a prompt for the value.  If nothing
"^DD",8989.51,8989.51,.05,21,2,0)
is here, the prompt will be the word 'Value:'.
"^DD",8989.51,8989.51,.05,"DT")
2960612
"^DD",8989.51,8989.51,.06,0)
PROHIBIT EDITING^S^1:Yes;0:No;^0;6^Q
"^DD",8989.51,8989.51,.06,3)
Choose 'Disallow Editing' if editing of this field should not be allowed.
"^DD",8989.51,8989.51,.06,21,0)
^^2^2^2970306^
"^DD",8989.51,8989.51,.06,21,1,0)
This field prevents the parameter value from being edited with Fileman or
"^DD",8989.51,8989.51,.06,21,2,0)
any Parameters tools.
"^DD",8989.51,8989.51,.06,"DT")
2970317
"^DD",8989.51,8989.51,1.1,0)
VALUE DATA TYPE^S^D:date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;M:M code;C:constant;^1;1^Q
"^DD",8989.51,8989.51,1.1,3)
Enter the type of data this parameter will contain.
"^DD",8989.51,8989.51,1.1,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,1.1,21,1,0)
This is the type of data this parameter will contain.  This field is used to 
"^DD",8989.51,8989.51,1.1,21,2,0)
define a call to the reader (^DIR) in most cases.
"^DD",8989.51,8989.51,1.1,"DT")
2960528
"^DD",8989.51,8989.51,1.2,0)
VALUE DOMAIN^F^^1;2^K:$L(X)>100!($L(X)<1) X
"^DD",8989.51,8989.51,1.2,3)
Enter up to 100 characters to further define the data type (used by ^DIR).
"^DD",8989.51,8989.51,1.2,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,1.2,21,1,0)
This is a string that may be used to further specify the data type.  The 
"^DD",8989.51,8989.51,1.2,21,2,0)
string stored here should be appropriate for the second ^-piece of DIR(0) 
"^DD",8989.51,8989.51,1.2,21,3,0)
when used with the data type field.
"^DD",8989.51,8989.51,1.2,"DT")
2960207
"^DD",8989.51,8989.51,1.3,0)
VALUE HELP^F^^1;3^K:$L(X)>80!($L(X)<1) X
"^DD",8989.51,8989.51,1.3,3)
Enter a line of help text to be displayed when entering a parameter value.
"^DD",8989.51,8989.51,1.3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,1.3,21,1,0)
This field contains a line of help text that is displayed when the user 
"^DD",8989.51,8989.51,1.3,21,2,0)
requests help or encounters an error while entering the VALUE field in the 
"^DD",8989.51,8989.51,1.3,21,3,0)
PARAMETERS file.
"^DD",8989.51,8989.51,1.3,"DT")
2960207
"^DD",8989.51,8989.51,2,0)
VALUE VALIDATION CODE^K^^2;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,2,3)
This is M code used by DIR (3rd piece of DIR(0)).
"^DD",8989.51,8989.51,2,9)
@
"^DD",8989.51,8989.51,2,21,0)
^^2^2^2980705^
"^DD",8989.51,8989.51,2,21,1,0)
This field contains the M code that is placed in the third piece of DIR(0)
"^DD",8989.51,8989.51,2,21,2,0)
when validating a value in the PARAMETERS file.
"^DD",8989.51,8989.51,2,"DT")
2960207
"^DD",8989.51,8989.51,3,0)
VALUE SCREEN CODE^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,3,3)
This is M code placed in DIR("S").
"^DD",8989.51,8989.51,3,9)
@
"^DD",8989.51,8989.51,3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,3,21,1,0)
This field contains M code that is used to screen allowable entries for the 
"^DD",8989.51,8989.51,3,21,2,0)
VALUE field in the PARAMETERS file.  The code is placed in DIR("S") when 
"^DD",8989.51,8989.51,3,21,3,0)
validating the entry.
"^DD",8989.51,8989.51,3,"DT")
2960207
"^DD",8989.51,8989.51,4,0)
KEYWORD^8989.514^^4;0
"^DD",8989.51,8989.51,6.1,0)
INSTANCE DATA TYPE^S^D:date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;^6;1^Q
"^DD",8989.51,8989.51,6.1,3)
Enter the type of data allowed for the INSTANCE field of the parameter.
"^DD",8989.51,8989.51,6.1,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.1,21,1,0)
This is the type of data that is contained in the INSTANCE field of the 
"^DD",8989.51,8989.51,6.1,21,2,0)
PARAMETERS file, if multiple parameter instances per entity are allowed.  
"^DD",8989.51,8989.51,6.1,21,3,0)
This field is used to define a call to the reader.
"^DD",8989.51,8989.51,6.1,"DT")
2960207
"^DD",8989.51,8989.51,6.2,0)
INSTANCE DOMAIN^F^^6;2^K:$L(X)>100!($L(X)<1) X
"^DD",8989.51,8989.51,6.2,3)
Enter up to 100 characters to further define the data type (used by ^DIR).
"^DD",8989.51,8989.51,6.2,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.2,21,1,0)
This may be used to further define the data type for the INSTANCE field of 
"^DD",8989.51,8989.51,6.2,21,2,0)
the parameter.  The string stored here should be appropriate for the second 
"^DD",8989.51,8989.51,6.2,21,3,0)
^-piece of DIR(0) when used with the data type field.
"^DD",8989.51,8989.51,6.2,"DT")
2960207
"^DD",8989.51,8989.51,6.3,0)
INSTANCE HELP^F^^6;3^K:$L(X)>80!($L(X)<1) X
"^DD",8989.51,8989.51,6.3,3)
Enter a line of help text to be displayed when entering the parameter instance.
"^DD",8989.51,8989.51,6.3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.3,21,1,0)
This field contains a line of help text that is displayed when the user 
"^DD",8989.51,8989.51,6.3,21,2,0)
requests help or encounters an error while entering the INSTANCE field of 
"^DD",8989.51,8989.51,6.3,21,3,0)
the PARAMETERS file.
"^DD",8989.51,8989.51,6.3,"DT")
2960207
"^DD",8989.51,8989.51,7,0)
INSTANCE VALIDATION CODE^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,7,3)
This is M code used by DIR (3rd piece of DIR(0)).
"^DD",8989.51,8989.51,7,9)
@
"^DD",8989.51,8989.51,7,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,7,21,1,0)
This field contains M code that is placed in the third piece of DIR(0) when 
"^DD",8989.51,8989.51,7,21,2,0)
validating the INSTANCE field in the PARAMETERS file.
"^DD",8989.51,8989.51,7,"DT")
2960207
"^DD",8989.51,8989.51,8,0)
INSTANCE SCREEN CODE^K^^8;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,8,3)
This is M code placed in DIR("S").
"^DD",8989.51,8989.51,8,9)
@
"^DD",8989.51,8989.51,8,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,8,21,1,0)
This field contains M code that is used to screen allowable entries for the 
"^DD",8989.51,8989.51,8,21,2,0)
INSTANCE field in the PARAMETERS file.  The code is placed in DIR("S") when 
"^DD",8989.51,8989.51,8,21,3,0)
validating the entry.
"^DD",8989.51,8989.51,8,"DT")
2960207
"^DD",8989.51,8989.51,20,0)
DESCRIPTION^8989.512^^20;0
"^DD",8989.51,8989.51,20,21,0)
^^1^1^2970626^
"^DD",8989.51,8989.51,20,21,1,0)
A description of the parameter may be entered here.
"^DD",8989.51,8989.51,30,0)
ALLOWABLE ENTITIES^8989.513I^^30;0
"^DD",8989.51,8989.51,30,21,0)
^^2^2^2960213^^
"^DD",8989.51,8989.51,30,21,1,0)
This multiple contains a list of entities (pointers to files) for which the 
"^DD",8989.51,8989.51,30,21,2,0)
parameter may be validly set.
"^DD",8989.51,8989.512,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",8989.51,8989.512,0,"DT")
2960207
"^DD",8989.51,8989.512,0,"NM","DESCRIPTION")

"^DD",8989.51,8989.512,0,"UP")
8989.51
"^DD",8989.51,8989.512,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",8989.51,8989.512,.01,3)
Enter a description of the parameter and how it is used.
"^DD",8989.51,8989.512,.01,21,0)
^^1^1^2960207^
"^DD",8989.51,8989.512,.01,21,1,0)
This is text that describes the purpose and use of the parameter.
"^DD",8989.51,8989.512,.01,"DT")
2960207
"^DD",8989.51,8989.513,0)
ALLOWABLE ENTITIES SUB-FIELD^^.02^2
"^DD",8989.51,8989.513,0,"DT")
2970621
"^DD",8989.51,8989.513,0,"ID",.02)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DIC(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8989.51,8989.513,0,"IX","B",8989.513,.01)

"^DD",8989.51,8989.513,0,"NM","ALLOWABLE ENTITIES")

"^DD",8989.51,8989.513,0,"UP")
8989.51
"^DD",8989.51,8989.513,.01,0)
PRECEDENCE^MRNJ6,2^^0;1^K:+X'=X!(X>999.99)!(X<0)!(X?.E1"."3N.N) X
"^DD",8989.51,8989.513,.01,1,0)
^.1
"^DD",8989.51,8989.513,.01,1,1,0)
8989.513^B
"^DD",8989.51,8989.513,.01,1,1,1)
S ^XTV(8989.51,DA(1),30,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.513,.01,1,1,2)
K ^XTV(8989.51,DA(1),30,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.513,.01,3)
Type a Number between 0 and 999.99, 2 Decimal Digits
"^DD",8989.51,8989.513,.01,21,0)
^^6^6^2960213^^^
"^DD",8989.51,8989.513,.01,21,1,0)
A single parameter may be set for several different types of entities.  This 
"^DD",8989.51,8989.513,.01,21,2,0)
lists the order in which entities are searched for a defined value.  For 
"^DD",8989.51,8989.513,.01,21,3,0)
example, if a parameter may be set for a package, a location, and a user, 
"^DD",8989.51,8989.513,.01,21,4,0)
and the respective precedents are 3, 2, 1, the value of the user parameter 
"^DD",8989.51,8989.513,.01,21,5,0)
would be returned.  If it did not exist, the value of the location 
"^DD",8989.51,8989.513,.01,21,6,0)
parameter.  If that did not exist, then the value of the package parameter.
"^DD",8989.51,8989.513,.01,"DT")
2960213
"^DD",8989.51,8989.513,.02,0)
ENTITY FILE^RP8989.518'^XTV(8989.518,^0;2^Q
"^DD",8989.51,8989.513,.02,1,0)
^.1
"^DD",8989.51,8989.513,.02,1,1,0)
8989.51^AG^MUMPS
"^DD",8989.51,8989.513,.02,1,1,1)
D AGS^XPARDD1
"^DD",8989.51,8989.513,.02,1,1,2)
D AGK^XPARDD1
"^DD",8989.51,8989.513,.02,1,1,"%D",0)
^^5^5^2980422^
"^DD",8989.51,8989.513,.02,1,1,"%D",1,0)
The AG x-ref has the format ^XTV(8989.51,PARAM,30,"AG",GLOBAL REF,DA)="".
"^DD",8989.51,8989.513,.02,1,1,"%D",2,0)
 
"^DD",8989.51,8989.513,.02,1,1,"%D",3,0)
It is used to screen the parameters that may be selected for a given entity 
"^DD",8989.51,8989.513,.02,1,1,"%D",4,0)
in the PARAMETERS file.  The global root is used because the entity is a 
"^DD",8989.51,8989.513,.02,1,1,"%D",5,0)
variable pointer.
"^DD",8989.51,8989.513,.02,1,1,"DT")
2960207
"^DD",8989.51,8989.513,.02,3)
Choose a file from which entities for this parameter are identified.
"^DD",8989.51,8989.513,.02,21,0)
^^3^3^2980422^
"^DD",8989.51,8989.513,.02,21,1,0)
This identifies an entity for which the parameter can be legally entered.  
"^DD",8989.51,8989.513,.02,21,2,0)
Entities are simply variable pointers.  The files which are eligible to be
"^DD",8989.51,8989.513,.02,21,3,0)
entities are listed in the PARAMETER ENTITY file.
"^DD",8989.51,8989.513,.02,"DT")
2970621
"^DD",8989.51,8989.514,0)
KEYWORD SUB-FIELD^^.01^1
"^DD",8989.51,8989.514,0,"DT")
3020819
"^DD",8989.51,8989.514,0,"IX","B",8989.514,.01)

"^DD",8989.51,8989.514,0,"NM","KEYWORD")

"^DD",8989.51,8989.514,0,"UP")
8989.51
"^DD",8989.51,8989.514,.01,0)
KEYWORD^MFX^^0;1^K:$L(X)>30!($L(X)<3) X I $D(^XTV(8989.51,"D",X)) D EN^DDIOL($C(7)_"  "_$$EZBLD^DIALOG(89895140),"","?0")
"^DD",8989.51,8989.514,.01,1,0)
^.1
"^DD",8989.51,8989.514,.01,1,1,0)
8989.514^B
"^DD",8989.51,8989.514,.01,1,1,1)
S ^XTV(8989.51,DA(1),4,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.514,.01,1,1,2)
K ^XTV(8989.51,DA(1),4,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.514,.01,1,2,0)
8989.51^D
"^DD",8989.51,8989.514,.01,1,2,1)
S ^XTV(8989.51,"D",$E(X,1,30),DA(1),DA)=""
"^DD",8989.51,8989.514,.01,1,2,2)
K ^XTV(8989.51,"D",$E(X,1,30),DA(1),DA)
"^DD",8989.51,8989.514,.01,1,2,3)
KeyWord Lookup
"^DD",8989.51,8989.514,.01,1,2,"%D",0)
^^2^2^3020819^
"^DD",8989.51,8989.514,.01,1,2,"%D",1,0)
This cross reference allows the use of the keyword for look up of 
"^DD",8989.51,8989.514,.01,1,2,"%D",2,0)
parameters.
"^DD",8989.51,8989.514,.01,1,2,"DT")
3020819
"^DD",8989.51,8989.514,.01,3)
Answer must be 3-30 characters in length
"^DD",8989.51,8989.514,.01,21,0)
^^3^3^3021010^
"^DD",8989.51,8989.514,.01,21,1,0)
This field provides a list of KEYWORDS that can be used for lookup of 
"^DD",8989.51,8989.514,.01,21,2,0)
Parameter definitions.  It is suggested that each entry only have
"^DD",8989.51,8989.514,.01,21,3,0)
one word.
"^DD",8989.51,8989.514,.01,"DT")
3021010
"^DD",8989.52,8989.52,0)
FIELD^^10^5
"^DD",8989.52,8989.52,0,"DDA")
N
"^DD",8989.52,8989.52,0,"DT")
2970619
"^DD",8989.52,8989.52,0,"ID","WRITE")
N X S X=^(0) D EN^DDIOL($P(X,U,2),"","?36")
"^DD",8989.52,8989.52,0,"IX","B",8989.52,.01)

"^DD",8989.52,8989.52,0,"NM","PARAMETER TEMPLATE")

"^DD",8989.52,8989.52,0,"VRPK")
XT
"^DD",8989.52,8989.52,.01,0)
NAME^RFX^^0;1^D VALID01^XPARDD2
"^DD",8989.52,8989.52,.01,1,0)
^.1
"^DD",8989.52,8989.52,.01,1,1,0)
8989.52^B
"^DD",8989.52,8989.52,.01,1,1,1)
S ^XTV(8989.52,"B",$E(X,1,30),DA)=""
"^DD",8989.52,8989.52,.01,1,1,2)
K ^XTV(8989.52,"B",$E(X,1,30),DA)
"^DD",8989.52,8989.52,.01,3)
Name must be 3-30 characters, unique, and namespaced.
"^DD",8989.52,8989.52,.01,21,0)
^^2^2^2980705^
"^DD",8989.52,8989.52,.01,21,1,0)
This field contains the name of the parameter template.  The template
"^DD",8989.52,8989.52,.01,21,2,0)
names must be namespaced.
"^DD",8989.52,8989.52,.01,"DT")
2970318
"^DD",8989.52,8989.52,.02,0)
DISPLAY TEXT^F^^0;2^K:$L(X)>30!($L(X)<3) X
"^DD",8989.52,8989.52,.02,3)
Answer must be 3-30 characters in length.
"^DD",8989.52,8989.52,.02,12)
Only files defined as variable pointers in PARAMETERS (8989.5) are allowed.
"^DD",8989.52,8989.52,.02,12.1)
S DIC("S")="I $$ALLOW^XPARDD1(Y)"
"^DD",8989.52,8989.52,.02,21,0)
^^1^1^2970606^^^
"^DD",8989.52,8989.52,.02,21,1,0)
This is the display name (non-namespaced) for the template.
"^DD",8989.52,8989.52,.02,"DT")
2970318
"^DD",8989.52,8989.52,.03,0)
USE ENTITY FROM^*P1'^DIC(^0;3^S DIC("S")="I $$ALLOW^XPARDD1(Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",8989.52,8989.52,.03,3)
Choose the file which identifies the entity for which parameters will be entered.
"^DD",8989.52,8989.52,.03,12)
Only files defined as variable pointer in PARAMETERS (8989.5) are allowed.
"^DD",8989.52,8989.52,.03,12.1)
S DIC("S")="I $$ALLOW^XPARDD1(Y)"
"^DD",8989.52,8989.52,.03,21,0)
^^2^2^2970318^
"^DD",8989.52,8989.52,.03,21,1,0)
This identifies the file from which an entity will be selected. The
"^DD",8989.52,8989.52,.03,21,2,0)
parameters in this template will apply to that entity.
"^DD",8989.52,8989.52,.03,"DT")
2970318
"^DD",8989.52,8989.52,.04,0)
USE INSTANCE FROM^P8989.51'^XTV(8989.51,^0;4^Q
"^DD",8989.52,8989.52,.04,3)
The parameter identified here will be used to prompt for an instance which will be used for the multiple parameters in the template.
"^DD",8989.52,8989.52,.04,21,0)
^^3^3^2970619^
"^DD",8989.52,8989.52,.04,21,1,0)
This allows a parameter to be chosen which will be used to prompt for an
"^DD",8989.52,8989.52,.04,21,2,0)
instance value.  This instance value will be used for all other parameters
"^DD",8989.52,8989.52,.04,21,3,0)
in the template that are a multiple type.
"^DD",8989.52,8989.52,.04,"DT")
2970619
"^DD",8989.52,8989.52,10,0)
PARAMETERS^8989.521IA^^10;0
"^DD",8989.52,8989.52,10,21,0)
^^1^1^2970317^
"^DD",8989.52,8989.52,10,21,1,0)
This lists the parameters that make up the template.
"^DD",8989.52,8989.521,0)
PARAMETERS SUB-FIELD^^.02^2
"^DD",8989.52,8989.521,0,"DT")
2970317
"^DD",8989.52,8989.521,0,"ID","WRITE")
N X S X=^(0) I $P(X,U,2) D EN^DDIOL($P(^XTV(8989.51,+$P(X,U,2),0),U),"","?10")
"^DD",8989.52,8989.521,0,"IX","B",8989.521,.01)

"^DD",8989.52,8989.521,0,"NM","PARAMETERS")

"^DD",8989.52,8989.521,0,"UP")
8989.52
"^DD",8989.52,8989.521,.01,0)
SEQUENCE^MNJ7,3^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."4N.N) X
"^DD",8989.52,8989.521,.01,1,0)
^.1
"^DD",8989.52,8989.521,.01,1,1,0)
8989.521^B
"^DD",8989.52,8989.521,.01,1,1,1)
S ^XTV(8989.52,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",8989.52,8989.521,.01,1,1,2)
K ^XTV(8989.52,DA(1),10,"B",$E(X,1,30),DA)
"^DD",8989.52,8989.521,.01,3)
Type a Number between 1 and 999, 3 Decimal Digits
"^DD",8989.52,8989.521,.01,21,0)
^^2^2^2970317^
"^DD",8989.52,8989.521,.01,21,1,0)
This is the sequence in which the value(s) for this parameter should be
"^DD",8989.52,8989.521,.01,21,2,0)
prompted.
"^DD",8989.52,8989.521,.01,"DT")
2970317
"^DD",8989.52,8989.521,.02,0)
PARAMETER^P8989.51'^XTV(8989.51,^0;2^Q
"^DD",8989.52,8989.521,.02,3)
Enter the parameter that should be prompted at this sequence number.
"^DD",8989.52,8989.521,.02,21,0)
^^2^2^2970317^
"^DD",8989.52,8989.521,.02,21,1,0)
This points to the parameter that should be prompted for at this sequence
"^DD",8989.52,8989.521,.02,21,2,0)
in the template.
"^DD",8989.52,8989.521,.02,"DT")
2970317
"^DIC",100.2,100.2,0)
OE/RR PATIENT EVENT^100.2
"^DIC",100.2,100.2,0,"GL")
^ORE(100.2,
"^DIC",100.2,100.2,"%",0)
^1.005^^0
"^DIC",100.2,100.2,"%D",0)
^^2^2^3020425^
"^DIC",100.2,100.2,"%D",1,0)
This file is used by CPRS to track what happened to a patient's orders as
"^DIC",100.2,100.2,"%D",2,0)
a result of an event, such as an MAS movement or returning from the OR.
"^DIC",100.2,"B","OE/RR PATIENT EVENT",100.2)

"^DIC",101.41,101.41,0)
ORDER DIALOG^101.41
"^DIC",101.41,101.41,0,"GL")
^ORD(101.41,
"^DIC",101.41,101.41,"%D",0)
^^2^2^2960819^^
"^DIC",101.41,101.41,"%D",1,0)
This file contains the information needed to define how to prompt for each
"^DIC",101.41,101.41,"%D",2,0)
order, what values are acceptable, etc.
"^DIC",101.41,"B","ORDER DIALOG",101.41)

"^DIC",8989.51,8989.51,0)
PARAMETER DEFINITION^8989.51
"^DIC",8989.51,8989.51,0,"GL")
^XTV(8989.51,
"^DIC",8989.51,8989.51,"%D",0)
^^3^3^2980920^
"^DIC",8989.51,8989.51,"%D",1,0)
This file contains the characteristics of parameters.  Entries in this
"^DIC",8989.51,8989.51,"%D",2,0)
file must be namespaced and they are exported by the package which owns
"^DIC",8989.51,8989.51,"%D",3,0)
them.
"^DIC",8989.51,"B","PARAMETER DEFINITION",8989.51)

"^DIC",8989.52,8989.52,0)
PARAMETER TEMPLATE^8989.52
"^DIC",8989.52,8989.52,0,"GL")
^XTV(8989.52,
"^DIC",8989.52,8989.52,"%",0)
^1.005^^0
"^DIC",8989.52,8989.52,"%D",0)
^^4^4^2980920^
"^DIC",8989.52,8989.52,"%D",1,0)
This file contains templates which allow developers to group entries in
"^DIC",8989.52,8989.52,"%D",2,0)
the PARAMETER DEFINITION file (#8989.51) together for editing.  Entries in
"^DIC",8989.52,8989.52,"%D",3,0)
this file must be namespaced and they are exported by the package which
"^DIC",8989.52,8989.52,"%D",4,0)
owns them.
"^DIC",8989.52,"B","PARAMETER TEMPLATE",8989.52)

**END**
**END**
