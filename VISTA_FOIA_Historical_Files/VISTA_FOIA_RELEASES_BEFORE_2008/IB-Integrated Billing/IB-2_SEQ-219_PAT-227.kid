Released IB*2*227 SEQ #219
Extracted from mail message
**KIDS**:IB*2.0*227^

**INSTALL NAME**
IB*2.0*227
"BLD",4914,0)
IB*2.0*227^INTEGRATED BILLING^0^3030721^y
"BLD",4914,1,0)
^^3^3^3030721^
"BLD",4914,1,1,0)
This patch corrects the problem of bills reflecting that they are 
"BLD",4914,1,2,0)
referred to Regional Counsel, when they are no longer referred, on the 
"BLD",4914,1,3,0)
Third Party Follow-up Report.
"BLD",4914,4,0)
^9.64PA^^
"BLD",4914,"ABPKG")
n
"BLD",4914,"KRN",0)
^9.67PA^8989.52^19
"BLD",4914,"KRN",.4,0)
.4
"BLD",4914,"KRN",.401,0)
.401
"BLD",4914,"KRN",.402,0)
.402
"BLD",4914,"KRN",.403,0)
.403
"BLD",4914,"KRN",.5,0)
.5
"BLD",4914,"KRN",.84,0)
.84
"BLD",4914,"KRN",3.6,0)
3.6
"BLD",4914,"KRN",3.8,0)
3.8
"BLD",4914,"KRN",9.2,0)
9.2
"BLD",4914,"KRN",9.8,0)
9.8
"BLD",4914,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4914,"KRN",9.8,"NM",1,0)
IBJDF11^^0^B25856262
"BLD",4914,"KRN",9.8,"NM","B","IBJDF11",1)

"BLD",4914,"KRN",19,0)
19
"BLD",4914,"KRN",19.1,0)
19.1
"BLD",4914,"KRN",101,0)
101
"BLD",4914,"KRN",409.61,0)
409.61
"BLD",4914,"KRN",771,0)
771
"BLD",4914,"KRN",870,0)
870
"BLD",4914,"KRN",8989.51,0)
8989.51
"BLD",4914,"KRN",8989.52,0)
8989.52
"BLD",4914,"KRN",8994,0)
8994
"BLD",4914,"KRN","B",.4,.4)

"BLD",4914,"KRN","B",.401,.401)

"BLD",4914,"KRN","B",.402,.402)

"BLD",4914,"KRN","B",.403,.403)

"BLD",4914,"KRN","B",.5,.5)

"BLD",4914,"KRN","B",.84,.84)

"BLD",4914,"KRN","B",3.6,3.6)

"BLD",4914,"KRN","B",3.8,3.8)

"BLD",4914,"KRN","B",9.2,9.2)

"BLD",4914,"KRN","B",9.8,9.8)

"BLD",4914,"KRN","B",19,19)

"BLD",4914,"KRN","B",19.1,19.1)

"BLD",4914,"KRN","B",101,101)

"BLD",4914,"KRN","B",409.61,409.61)

"BLD",4914,"KRN","B",771,771)

"BLD",4914,"KRN","B",870,870)

"BLD",4914,"KRN","B",8989.51,8989.51)

"BLD",4914,"KRN","B",8989.52,8989.52)

"BLD",4914,"KRN","B",8994,8994)

"BLD",4914,"QUES",0)
^9.62^^
"BLD",4914,"REQB",0)
^9.611^1^1
"BLD",4914,"REQB",1,0)
IB*2.0*205^1
"BLD",4914,"REQB","B","IB*2.0*205",1)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
227^3030721
"PKG",200,22,1,"PAH",1,1,0)
^^3^3^3030721
"PKG",200,22,1,"PAH",1,1,1,0)
This patch corrects the problem of bills reflecting that they are 
"PKG",200,22,1,"PAH",1,1,2,0)
referred to Regional Counsel, when they are no longer referred, on the 
"PKG",200,22,1,"PAH",1,1,3,0)
Third Party Follow-up Report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBJDF11")
0^1^B25856262
"RTN","IBJDF11",1,0)
IBJDF11 ;ALB/CPM - THIRD PARTY FOLLOW-UP REPORT (COMPILE) ; 09-JAN-97
"RTN","IBJDF11",2,0)
 ;;2.0;INTEGRATED BILLING;**69,80,118,128,204,205,227**;21-MAR-94
"RTN","IBJDF11",3,0)
 ;
"RTN","IBJDF11",4,0)
DQ ; - Tasked entry point.
"RTN","IBJDF11",5,0)
 K ^TMP("IBJDF1",$J) S IBQ=0
"RTN","IBJDF11",6,0)
 ;
"RTN","IBJDF11",7,0)
 ; - Collect divisions when running the job for all divisions.
"RTN","IBJDF11",8,0)
 I IBSD,VAUTD S J=0 F  S J=$O(^DG(40.8,J)) Q:'J  S VAUTD(J)=""
"RTN","IBJDF11",9,0)
 ;
"RTN","IBJDF11",10,0)
 ; - Find data required for the report.
"RTN","IBJDF11",11,0)
 S IBA=0 F  S IBA=$O(^PRCA(430,"AC",16,IBA)) Q:'IBA  D  Q:IBQ
"RTN","IBJDF11",12,0)
 .;
"RTN","IBJDF11",13,0)
 .I IBA#100=0 S IBQ=$$STOP^IBOUTL("Third Party Follow-Up Report") Q:IBQ
"RTN","IBJDF11",14,0)
 .;
"RTN","IBJDF11",15,0)
 .S IBAR=$G(^PRCA(430,IBA,0))
"RTN","IBJDF11",16,0)
 .I $P(IBAR,U,2)'=9 Q  ;       Not an RI bill.
"RTN","IBJDF11",17,0)
 .I '$D(^DGCR(399,IBA,0)) Q  ; No corresponding claim to this AR.
"RTN","IBJDF11",18,0)
 .;
"RTN","IBJDF11",19,0)
 .; - Determine whether bill is inpatient, outpatient, or RX refill.
"RTN","IBJDF11",20,0)
 .S IBTYP=$P($G(^DGCR(399,IBA,0)),U,5),IBTYP=$S(IBTYP>2:2,1:1)
"RTN","IBJDF11",21,0)
 .S:$D(^IBA(362.4,"C",IBA)) IBTYP=3 I IBSEL'[IBTYP,IBSEL'[4 Q
"RTN","IBJDF11",22,0)
 .;
"RTN","IBJDF11",23,0)
 .; - Check the receivable age, if necessary.
"RTN","IBJDF11",24,0)
 .I IBSMN S:"Aa"[IBSDATE IBARD=$$ACT^IBJDF2(IBA) S:"Dd"[IBSDATE IBARD=$$DATE1^IBJDF2(IBA) Q:'IBARD  S:IBARD IBARD=$$FMDIFF^XLFDT(DT,IBARD) I IBARD<IBSMN!(IBARD>IBSMX) Q
"RTN","IBJDF11",25,0)
 .;
"RTN","IBJDF11",26,0)
 .; - Check the minimum dollar amount, if necessary.
"RTN","IBJDF11",27,0)
 .S IBWBA=+$G(^PRCA(430,IBA,7)) I IBSAM,IBWBA<IBSAM Q
"RTN","IBJDF11",28,0)
 .;
"RTN","IBJDF11",29,0)
 .; - Get division, if necessary.
"RTN","IBJDF11",30,0)
 .I 'IBSD S IBDIV=0
"RTN","IBJDF11",31,0)
 .E  S IBDIV=$$DIV^IBJDF2(IBA) I 'IBDIV S IBDIV=+$$PRIM^VASITE()
"RTN","IBJDF11",32,0)
 .I IBSD,'VAUTD Q:'$D(VAUTD(IBDIV))  ;  Not a selected division.
"RTN","IBJDF11",33,0)
 .;
"RTN","IBJDF11",34,0)
 .; - Exclude receivables referred to Regional Counsel, if necessary.
"RTN","IBJDF11",35,0)
 .S IBWRC=$G(^PRCA(430,IBA,6)) I 'IBSRC,$P(IBWRC,U,4) Q
"RTN","IBJDF11",36,0)
 .S IBWRC=$S('$P(IBWRC,U,4):"",$P(IBWRC,U,22):$P(IBWRC,U,22),1:$P(IBWRC,U,4))
"RTN","IBJDF11",37,0)
 .;
"RTN","IBJDF11",38,0)
 .; - Get the insurance carrier and exclude claim, if necessary.
"RTN","IBJDF11",39,0)
 .S IBWIN=$$INS(IBA) I IBWIN="" Q
"RTN","IBJDF11",40,0)
 .;
"RTN","IBJDF11",41,0)
 .; - Get the claim patient and exclude claim, if necessary.
"RTN","IBJDF11",42,0)
 .S IBWPT=$$PAT(IBA) I IBWPT="" Q
"RTN","IBJDF11",43,0)
 .;
"RTN","IBJDF11",44,0)
 .; - Get remaining claim information.
"RTN","IBJDF11",45,0)
 .S IBWDP=$P(IBAR,U,10),IBWBN=$P(IBAR,U)
"RTN","IBJDF11",46,0)
 .S IBBU=$G(^DGCR(399,IBA,"U")),IBWFR=+IBBU,IBWTO=$P(IBBU,U,2)
"RTN","IBJDF11",47,0)
 .S IBWSC=$$OTH($P(IBWPT,U,5),$P(IBWIN,"@@",2),IBWFR),IBWOR=$P(IBAR,U,3)
"RTN","IBJDF11",48,0)
 .S IBWSI=$P($G(^DPT(+$P(IBWPT,U,5),.312,+$P($G(^DGCR(399,IBA,"MP")),U,2),0)),U,2)
"RTN","IBJDF11",49,0)
 .;
"RTN","IBJDF11",50,0)
 .; - Set up main report index.
"RTN","IBJDF11",51,0)
 .F X=IBTYP,4 I IBSEL[X D
"RTN","IBJDF11",52,0)
 ..S ^TMP("IBJDF1",$J,IBDIV,X,IBWIN,$P(IBWPT,U)_"@@"_$P(IBWPT,U,5),IBWDP_"@@"_IBWBN)=$P(IBWPT,U,2)_" ("_$P(IBWPT,U,4)_")"_U_$P(IBWPT,U,3)_U_IBWSC_U_IBWFR_U_IBWTO_U_IBWOR_U_IBWBA_"~"_IBWRC_U_IBWSI
"RTN","IBJDF11",53,0)
 .;
"RTN","IBJDF11",54,0)
 .; - Add bill comment history, if necessary.
"RTN","IBJDF11",55,0)
 .I IBSH D
"RTN","IBJDF11",56,0)
 ..S X=0 F  S X=$O(^PRCA(433,"C",IBA,X)) Q:'X  D
"RTN","IBJDF11",57,0)
 ...S Y=$G(^PRCA(433,X,1))
"RTN","IBJDF11",58,0)
 ...I $P(Y,U,2)'=35,$P(Y,U,2)'=45 Q  ; Not a decrease/comment transact.
"RTN","IBJDF11",59,0)
 ...S DAT=$S(Y:+Y\1,1:+$P(Y,U,9)\1)
"RTN","IBJDF11",60,0)
 ...;
"RTN","IBJDF11",61,0)
 ...; - Append brief and transaction comments.
"RTN","IBJDF11",62,0)
 ...K COM,COM1 S COM(0)=DAT,X1=0
"RTN","IBJDF11",63,0)
 ...S COM1(1)=$P($G(^PRCA(433,X,5)),U,2),COM1(2)=$E($P($G(^(8)),U,6),1,70)
"RTN","IBJDF11",64,0)
 ...S COM(1)=COM1(1)_$S(COM1(1)]""&(COM1(2)]""):"|",1:"")_COM1(2)
"RTN","IBJDF11",65,0)
 ...I COM(1)]"" S COM(1)="**"_COM(1)_"**",X1=1
"RTN","IBJDF11",66,0)
 ...;
"RTN","IBJDF11",67,0)
 ...; - Get main comments.
"RTN","IBJDF11",68,0)
 ...S X2=0 F  S X2=$O(^PRCA(433,X,7,X2)) Q:'X2  S COM($S(X1:X2+1,1:X2))=^(X2,0)
"RTN","IBJDF11",69,0)
 ...;
"RTN","IBJDF11",70,0)
 ...S X1="" F  S X1=$O(COM(X1)) Q:X1=""  F X2=IBTYP,4 I IBSEL[X2 D
"RTN","IBJDF11",71,0)
 ....S ^TMP("IBJDF1",$J,IBDIV,X2,IBWIN,$P(IBWPT,U)_"@@"_$P(IBWPT,U,5),IBWDP_"@@"_IBWBN,X,X1)=COM(X1)
"RTN","IBJDF11",72,0)
 ;
"RTN","IBJDF11",73,0)
 I 'IBQ D EN^IBJDF12 ; Print the report.
"RTN","IBJDF11",74,0)
 ;
"RTN","IBJDF11",75,0)
ENQ K ^TMP("IBJDF1",$J)
"RTN","IBJDF11",76,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDF11",77,0)
 ;
"RTN","IBJDF11",78,0)
 D ^%ZISC
"RTN","IBJDF11",79,0)
ENQ1 K IBA,IBAR,IBARD,IBBU,IBDIV,IBQ,IBIO,IBWRC,IBWPT,IBWDP,IBWIN,IBWBN
"RTN","IBJDF11",80,0)
 K IBTYP,IBWSC,IBWSI,IBWFR,IBWTO,IBWOR,IBWBA,COM,COM1,DAT,VAUTD
"RTN","IBJDF11",81,0)
 K X,X1,X2,Y,Z
"RTN","IBJDF11",82,0)
 Q
"RTN","IBJDF11",83,0)
 ;
"RTN","IBJDF11",84,0)
INS(X) ; - Find the Insurance company and decide to include the claim.
"RTN","IBJDF11",85,0)
 ;  Input: X=Pointer to the claim/AR in file #399/#430
"RTN","IBJDF11",86,0)
 ;           plus all variable input in IBS*
"RTN","IBJDF11",87,0)
 ; Output: Y=Insurance Company name and pointer to file #36
"RTN","IBJDF11",88,0)
 ;
"RTN","IBJDF11",89,0)
 N Y,Z,Z1 S Y=""
"RTN","IBJDF11",90,0)
 I '$G(X) G INSQ
"RTN","IBJDF11",91,0)
 S Z=+$G(^DGCR(399,X,"MP")),Z1=$P($G(^DIC(36,Z,0)),U)
"RTN","IBJDF11",92,0)
 I $G(IBSI) G INSQ:'$D(IBSI(Z)),INSC
"RTN","IBJDF11",93,0)
 I IBSIF'="@",'Z G INSQ
"RTN","IBJDF11",94,0)
 I $D(IBSIA) G:IBSIA="ALL"&('Z) INSQ G:IBSIA="NULL"&(Z) INSQ
"RTN","IBJDF11",95,0)
 I Z1="" S Z1="UNKNOWN" G INSC
"RTN","IBJDF11",96,0)
 I $G(IBSIA)="ALL" G INSC
"RTN","IBJDF11",97,0)
 I IBSIF="@",IBSIL="zzzzz" G INSC
"RTN","IBJDF11",98,0)
 I IBSIF]Z1!(Z1]IBSIL) G INSQ
"RTN","IBJDF11",99,0)
 ;
"RTN","IBJDF11",100,0)
INSC S Y=Z1_"@@"_Z
"RTN","IBJDF11",101,0)
INSQ Q Y
"RTN","IBJDF11",102,0)
 ;
"RTN","IBJDF11",103,0)
PAT(X) ; - Find the claim patient and decide to include the claim.
"RTN","IBJDF11",104,0)
 ;  Input: X=Pointer to the claim/AR in file #399/#430
"RTN","IBJDF11",105,0)
 ;           plus all variable input in IBS*
"RTN","IBJDF11",106,0)
 ; Output: Y=1^2^3^4^5, where
"RTN","IBJDF11",107,0)
 ;           1 => sort key (name or last four)
"RTN","IBJDF11",108,0)
 ;           2 => patient name
"RTN","IBJDF11",109,0)
 ;           3 => patient ssn
"RTN","IBJDF11",110,0)
 ;           4 => patient age
"RTN","IBJDF11",111,0)
 ;           5 => patient pointer to file #2
"RTN","IBJDF11",112,0)
 ;
"RTN","IBJDF11",113,0)
 N AGE,DFN,DOB,KEY,Y,Z S Y=""
"RTN","IBJDF11",114,0)
 I '$G(X) G PATQ
"RTN","IBJDF11",115,0)
 S DFN=+$P($G(^DGCR(399,X,0)),U,2),Z=$G(^DPT(DFN,0))
"RTN","IBJDF11",116,0)
 S KEY=$S(IBSN="N":$P(Z,U),1:$E($P(Z,U,9),6,9))
"RTN","IBJDF11",117,0)
 ;
"RTN","IBJDF11",118,0)
 I IBSNF'="@",'DFN G PATQ
"RTN","IBJDF11",119,0)
 I $D(IBSNA) G:IBSNA="ALL"&('DFN) PATQ G:IBSNA="NULL"&(DFN) PATQ
"RTN","IBJDF11",120,0)
 I KEY="" S Y="UNK^UNK^UNK^UNK^UNK" G PATQ
"RTN","IBJDF11",121,0)
 I $G(IBSNA)="ALL" G PATC
"RTN","IBJDF11",122,0)
 I IBSNF="@",IBSNL="zzzzz" G PATC
"RTN","IBJDF11",123,0)
 I IBSNF]KEY!(KEY]IBSNL) G PATQ
"RTN","IBJDF11",124,0)
 ;
"RTN","IBJDF11",125,0)
PATC ; - Find all patient data.
"RTN","IBJDF11",126,0)
 S DOB=$P(Z,U,3)
"RTN","IBJDF11",127,0)
 S AGE=$S('DOB:"UNK",1:$E(DT,1,3)-$E(DOB,1,3)-($E(DT,4,7)<$E(DOB,4,7)))
"RTN","IBJDF11",128,0)
 S Y=KEY_U_$E($P(Z,U),1,17)_U_$P(Z,U,9)_U_AGE_U_DFN
"RTN","IBJDF11",129,0)
PATQ Q Y
"RTN","IBJDF11",130,0)
 ;
"RTN","IBJDF11",131,0)
OTH(DFN,INS,DS) ; - Find a patient's other valid insurance carrier (if any).
"RTN","IBJDF11",132,0)
 ;  Input: DFN=Pointer to the patient in file #2
"RTN","IBJDF11",133,0)
 ;         INS=Pointer to the patient's primary carrier in file #36
"RTN","IBJDF11",134,0)
 ;          DS=Date of service for validity check
"RTN","IBJDF11",135,0)
 ; Output: Valid insurance carrier (1st 13 chars.) or null
"RTN","IBJDF11",136,0)
 ;
"RTN","IBJDF11",137,0)
 N Y S Y="" I '$G(DFN)!('$G(DS)) G OTHQ
"RTN","IBJDF11",138,0)
 S Z=0 F  S Z=$O(^DPT(DFN,.312,Z)) Q:'Z  S X=$G(^(Z,0)) D:X  Q:Y]""
"RTN","IBJDF11",139,0)
 .I $G(INS),+X=INS Q
"RTN","IBJDF11",140,0)
 .S X1=$G(^DIC(36,+X,0)) I X1="" Q
"RTN","IBJDF11",141,0)
 .I $P(X1,U,2)'="N",$$CHK^IBCNS1(X,DS) S Y=$E($P(X1,U),1,13)
"RTN","IBJDF11",142,0)
 ;
"RTN","IBJDF11",143,0)
OTHQ Q Y
"VER")
8.0^22
**END**
**END**
