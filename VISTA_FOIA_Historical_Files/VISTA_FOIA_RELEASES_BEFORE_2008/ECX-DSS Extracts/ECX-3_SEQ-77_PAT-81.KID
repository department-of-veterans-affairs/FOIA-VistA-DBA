Released ECX*3*81 SEQ #77
Extracted from mail message
**KIDS**:ECX*3.0*81^

**INSTALL NAME**
ECX*3.0*81
"BLD",6004,0)
ECX*3.0*81^DSS EXTRACTS^0^3050210^y
"BLD",6004,1,0)
^^2^2^3050210^
"BLD",6004,1,1,0)
This patch provides the fix to the encounter number for the
"BLD",6004,1,2,0)
Prescription Extract.
"BLD",6004,4,0)
^9.64PA^^
"BLD",6004,"KRN",0)
^9.67PA^8989.52^19
"BLD",6004,"KRN",.4,0)
.4
"BLD",6004,"KRN",.401,0)
.401
"BLD",6004,"KRN",.402,0)
.402
"BLD",6004,"KRN",.403,0)
.403
"BLD",6004,"KRN",.5,0)
.5
"BLD",6004,"KRN",.84,0)
.84
"BLD",6004,"KRN",3.6,0)
3.6
"BLD",6004,"KRN",3.8,0)
3.8
"BLD",6004,"KRN",9.2,0)
9.2
"BLD",6004,"KRN",9.8,0)
9.8
"BLD",6004,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6004,"KRN",9.8,"NM",1,0)
ECXOPRX^^0^B68880592
"BLD",6004,"KRN",9.8,"NM","B","ECXOPRX",1)

"BLD",6004,"KRN",19,0)
19
"BLD",6004,"KRN",19.1,0)
19.1
"BLD",6004,"KRN",101,0)
101
"BLD",6004,"KRN",409.61,0)
409.61
"BLD",6004,"KRN",771,0)
771
"BLD",6004,"KRN",870,0)
870
"BLD",6004,"KRN",8989.51,0)
8989.51
"BLD",6004,"KRN",8989.52,0)
8989.52
"BLD",6004,"KRN",8994,0)
8994
"BLD",6004,"KRN","B",.4,.4)

"BLD",6004,"KRN","B",.401,.401)

"BLD",6004,"KRN","B",.402,.402)

"BLD",6004,"KRN","B",.403,.403)

"BLD",6004,"KRN","B",.5,.5)

"BLD",6004,"KRN","B",.84,.84)

"BLD",6004,"KRN","B",3.6,3.6)

"BLD",6004,"KRN","B",3.8,3.8)

"BLD",6004,"KRN","B",9.2,9.2)

"BLD",6004,"KRN","B",9.8,9.8)

"BLD",6004,"KRN","B",19,19)

"BLD",6004,"KRN","B",19.1,19.1)

"BLD",6004,"KRN","B",101,101)

"BLD",6004,"KRN","B",409.61,409.61)

"BLD",6004,"KRN","B",771,771)

"BLD",6004,"KRN","B",870,870)

"BLD",6004,"KRN","B",8989.51,8989.51)

"BLD",6004,"KRN","B",8989.52,8989.52)

"BLD",6004,"KRN","B",8994,8994)

"BLD",6004,"QUES",0)
^9.62^^
"BLD",6004,"REQB",0)
^9.611^1^1
"BLD",6004,"REQB",1,0)
ECX*3.0*71^2
"BLD",6004,"REQB","B","ECX*3.0*71",1)

"MBREQ")
0
"PKG",535,-1)
1^1
"PKG",535,0)
DSS EXTRACTS^ECX
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^2971222^3000224^66481
"PKG",535,22,1,"PAH",1,0)
81^3050210
"PKG",535,22,1,"PAH",1,1,0)
^^2^2^3050210
"PKG",535,22,1,"PAH",1,1,1,0)
This patch provides the fix to the encounter number for the
"PKG",535,22,1,"PAH",1,1,2,0)
Prescription Extract.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECXOPRX")
0^1^B68880592
"RTN","ECXOPRX",1,0)
ECXOPRX ;ALB/JAP,BIR/DMA,CML,PTD-Prescription Extract for DSS ; 12/2/04 9:03am
"RTN","ECXOPRX",2,0)
 ;;3.0;DSS EXTRACTS;**10,11,8,13,24,30,33,38,39,46,49,71,81**;Dec 22, 1997
"RTN","ECXOPRX",3,0)
 ;
"RTN","ECXOPRX",4,0)
BEG ;entry point from option
"RTN","ECXOPRX",5,0)
 D SETUP I ECFILE="" Q
"RTN","ECXOPRX",6,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXOPRX",7,0)
 Q
"RTN","ECXOPRX",8,0)
START ;entry when queued
"RTN","ECXOPRX",9,0)
 N X,DA,DIC,DIQ,DR,ECXNPRFI,ECRXPTST,ECNONVAP
"RTN","ECXOPRX",10,0)
 S QFLG=0
"RTN","ECXOPRX",11,0)
 I '$D(ECINST) D
"RTN","ECXOPRX",12,0)
 .S ECINST=+$P(^ECX(728,1,0),U) K ECXDIC S DA=ECINST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXOPRX",13,0)
 .D EN^DIQ1 S ECINST=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXOPRX",14,0)
 ;before V6
"RTN","ECXOPRX",15,0)
 S ECPROF=6
"RTN","ECXOPRX",16,0)
 S ECD=$O(^PSRX("AL",0)) I ECD,ECD<ECSD1 G V6
"RTN","ECXOPRX",17,0)
 S ECED=ECED+.3,ECREF=1,ECD=ECSD1
"RTN","ECXOPRX",18,0)
 F  S ECD=$O(^PSRX("AD",ECD)),ECRX=0 Q:'ECD  Q:ECD>ECED  Q:QFLG  F  S ECRX=$O(^PSRX("AD",ECD,ECRX)),ECRFL="" Q:'ECRX  F  S ECRFL=$O(^PSRX("AD",ECD,ECRX,ECRFL)) Q:ECRFL=""  D STUFF Q:QFLG
"RTN","ECXOPRX",19,0)
 Q
"RTN","ECXOPRX",20,0)
 ;
"RTN","ECXOPRX",21,0)
V6 ;version 6 or better
"RTN","ECXOPRX",22,0)
 K ^TMP($J,"ECXP")
"RTN","ECXOPRX",23,0)
 S ECPROF=2
"RTN","ECXOPRX",24,0)
 S ECED=ECED+.3,ECREF=1,ECD=ECSD1
"RTN","ECXOPRX",25,0)
 F  S ECD=$O(^PSRX("AL",ECD)),ECRX=0 Q:'ECD  Q:ECD>ECED  Q:QFLG  F  S ECRX=$O(^PSRX("AL",ECD,ECRX)),ECRFL="" Q:'ECRX  F  S ECRFL=$O(^PSRX("AL",ECD,ECRX,ECRFL)) Q:ECRFL=""  D STUFF Q:QFLG
"RTN","ECXOPRX",26,0)
 Q:QFLG
"RTN","ECXOPRX",27,0)
 S ECREF="P",ECD=ECSD1
"RTN","ECXOPRX",28,0)
 F  S ECD=$O(^PSRX("AM",ECD)),ECRX=0 Q:'ECD  Q:ECD>ECED  Q:QFLG  F  S ECRX=$O(^PSRX("AM",ECD,ECRX)),ECRFL="" Q:'ECRX  F  S ECRFL=$O(^PSRX("AM",ECD,ECRX,ECRFL)) Q:ECRFL=""  D STUFF Q:QFLG
"RTN","ECXOPRX",29,0)
 K ^TMP($J,"ECXP")
"RTN","ECXOPRX",30,0)
 Q
"RTN","ECXOPRX",31,0)
 ;
"RTN","ECXOPRX",32,0)
STUFF ;get data
"RTN","ECXOPRX",33,0)
 S ECDATA=$G(^PSRX(ECRX,0))
"RTN","ECXOPRX",34,0)
 I ECRFL S ECDATA1=$G(^PSRX(ECRX,ECREF,ECRFL,0)) I ECDATA1="" Q
"RTN","ECXOPRX",35,0)
 ;ecref set to 1 in extract+5 and v6+1 and to "P" in v6+2
"RTN","ECXOPRX",36,0)
 ;refill nodes and partial nodes are identical in layout.  Fills
"RTN","ECXOPRX",37,0)
 ;(ie ecrfl=0)& refills (ie ecrfl>0) from "AL" xref, partials from "AM"
"RTN","ECXOPRX",38,0)
 ;
"RTN","ECXOPRX",39,0)
 S (ECXDSSD,ECXPROVN)="",ECXERR=0
"RTN","ECXOPRX",40,0)
 S (ECXCVE,ECXCVEDT,ECXCVENC)=""
"RTN","ECXOPRX",41,0)
 S ECXDATE=ECD
"RTN","ECXOPRX",42,0)
 S ECXDFN=$P(ECDATA,U,2)
"RTN","ECXOPRX",43,0)
 S ECDRG=+$P(ECDATA,U,6)
"RTN","ECXOPRX",44,0)
 ;
"RTN","ECXOPRX",45,0)
 ;- Get rx patient status
"RTN","ECXOPRX",46,0)
 S ECRXPTST=$$RXPTST^ECXUTL5($P(ECDATA,U,3))
"RTN","ECXOPRX",47,0)
 ;
"RTN","ECXOPRX",48,0)
 ;- Get provider (either 2_provider or 6_provider depending on version)
"RTN","ECXOPRX",49,0)
 S ECXPROV=$S($P(ECDATA,U,4)'="":ECPROF_$P(ECDATA,U,4),1:"")
"RTN","ECXOPRX",50,0)
 S ECXPROVP=$$PRVCLASS^ECXUTL($P(ECDATA,U,4),ECXDATE)
"RTN","ECXOPRX",51,0)
 ;
"RTN","ECXOPRX",52,0)
 ;- Check non-va provider flag and set to'Y' if exist
"RTN","ECXOPRX",53,0)
 S ECNONVAP=$$NONVAP^ECXUTL5($E(ECXPROV,2,99))
"RTN","ECXOPRX",54,0)
 ;
"RTN","ECXOPRX",55,0)
 ;get patient specific data
"RTN","ECXOPRX",56,0)
 D PAT(ECXDFN,ECXDATE,.ECXERR)
"RTN","ECXOPRX",57,0)
 Q:ECXERR
"RTN","ECXOPRX",58,0)
 I 'ECRFL D
"RTN","ECXOPRX",59,0)
 .S ECMW=$P(ECDATA,U,11),ECQTY=+$P(ECDATA,U,7),ECXDIV=$S($D(^PSRX(ECRX,2)):$P(^(2),U,9),1:1)
"RTN","ECXOPRX",60,0)
 .S ECPRC=+$P(ECDATA,U,17),ECOPAY=$P($G(^PSRX(ECRX,"IB")),U,2)]""
"RTN","ECXOPRX",61,0)
 I ECRFL D
"RTN","ECXOPRX",62,0)
 .S ECMW=$P(ECDATA1,U,2),ECQTY=+$P(ECDATA1,U,4),ECXDIV=$S(+$P(ECDATA1,U,9):$P(ECDATA1,U,9),1:1)
"RTN","ECXOPRX",63,0)
 .S ECPRC=+$P(ECDATA1,U,11),ECOPAY=$P($G(^PSRX(ECRX,1,ECRFL,"IB")),U)]""
"RTN","ECXOPRX",64,0)
 ;
"RTN","ECXOPRX",65,0)
 S ECXCOST=$J((ECQTY*ECPRC),1,2)
"RTN","ECXOPRX",66,0)
 S ECDS=$S(ECRFL:$P(ECDATA1,U,10),1:$P(ECDATA,U,8))
"RTN","ECXOPRX",67,0)
 S ECCAT=$P(^PSDRUG(ECDRG,0),U,2),ECINV=$P(^(0),U,3)["I",ECINV=$S(ECINV:"I",1:"")
"RTN","ECXOPRX",68,0)
 S ECUI=$P($G(^PSDRUG(ECDRG,660)),U,8)
"RTN","ECXOPRX",69,0)
 S ECNDC=$P($G(^PSDRUG(ECDRG,2)),U,4),ECNFC=$$RJ^XLFSTR($P(ECNDC,"-"),6,0)_$$RJ^XLFSTR($P(ECNDC,"-",2),4,0)_$$RJ^XLFSTR($P(ECNDC,"-",3),2,0),ECNFC=$TR(ECNFC,"*",0)
"RTN","ECXOPRX",70,0)
 S ECNDF=$G(^PSDRUG(ECDRG,"ND")),P1=$P(ECNDF,U),P3=$P(ECNDF,U,3)
"RTN","ECXOPRX",71,0)
 S X="PSNAPIS" X ^%ZOSF("TEST") I $T S ECNFC=$$DSS^PSNAPIS(P1,P3,ECXYM)_ECNFC
"RTN","ECXOPRX",72,0)
 I $L(ECNFC)=12 S ECNFC=$$RJ^XLFSTR(P1,4,0)_$$RJ^XLFSTR(P3,3,0)_ECNFC
"RTN","ECXOPRX",73,0)
 I ECMW="M" S ECMW=1 I $D(^PSRX("AR",ECD,ECRX)) S ECMW=2
"RTN","ECXOPRX",74,0)
 I ECMW="W" S ECMW=""
"RTN","ECXOPRX",75,0)
 S ECXNEW="" I ECRFL=0 S ECXNEW=1
"RTN","ECXOPRX",76,0)
 ;
"RTN","ECXOPRX",77,0)
 ;- Observation patient indicator (YES/NO)
"RTN","ECXOPRX",78,0)
 S ECXOBS=$$OBSPAT^ECXUTL4(ECXA,ECXTS)
"RTN","ECXOPRX",79,0)
 ;
"RTN","ECXOPRX",80,0)
 ;- Ordering physician (null for FY2002)
"RTN","ECXOPRX",81,0)
 S ECXORDPH=""
"RTN","ECXOPRX",82,0)
 ;
"RTN","ECXOPRX",83,0)
 ;- Ordering stop code
"RTN","ECXOPRX",84,0)
 S ECXORDST=$P($G(^ECX(728.44,+$P(ECDATA,U,5),0)),U,2)
"RTN","ECXOPRX",85,0)
 ;
"RTN","ECXOPRX",86,0)
 ;- Ordering date
"RTN","ECXOPRX",87,0)
 S ECXORDDT=$$ECXDATE^ECXUTL(+$P(ECDATA,U,13),ECXYM)
"RTN","ECXOPRX",88,0)
 ;
"RTN","ECXOPRX",89,0)
 ;- CNH status (YES/NO)
"RTN","ECXOPRX",90,0)
 S ECXCNH=$$CNHSTAT^ECXUTL4(ECXDFN)
"RTN","ECXOPRX",91,0)
 ;
"RTN","ECXOPRX",92,0)
 ;- DSS Dept and National Prod Division
"RTN","ECXOPRX",93,0)
 ;S ECXDSSD=$$PRE^ECXDEPT(ECXDIV,ECMW,ECINST) dss department postponed
"RTN","ECXOPRX",94,0)
 N ECXPDIV S ECXPDIV=$$PREDIV^ECXDEPT(ECXDIV)
"RTN","ECXOPRX",95,0)
 ;
"RTN","ECXOPRX",96,0)
 ;- Set national patient record flag if exist
"RTN","ECXOPRX",97,0)
 D NPRF^ECXUTL5
"RTN","ECXOPRX",98,0)
 ;
"RTN","ECXOPRX",99,0)
 ;- If no encounter number don't file record
"RTN","ECXOPRX",100,0)
 S ECXENC=$$ENCNUM^ECXUTL4(ECXA,ECXSSN,ECXADMDT,ECXDATE,ECXTS,ECXOBS,ECHEAD,,)
"RTN","ECXOPRX",101,0)
 I ECXLOGIC>2003 D
"RTN","ECXOPRX",102,0)
 .I ECMW=2,ECXSSN'="" D
"RTN","ECXOPRX",103,0)
 ..N TMP
"RTN","ECXOPRX",104,0)
 ..S TMP=$$JULDT^ECXUTL4(ECD)
"RTN","ECXOPRX",105,0)
 ..S ECXENC=$E(ECXSSN,1,9)_TMP_"160"
"RTN","ECXOPRX",106,0)
 ..S ECXA="O"
"RTN","ECXOPRX",107,0)
 I ECXENC'="" D FILE
"RTN","ECXOPRX",108,0)
 Q
"RTN","ECXOPRX",109,0)
 ;
"RTN","ECXOPRX",110,0)
PAT(ECXDFN,ECXDATE,ECXERR) ;Determine in/outpatient status, movement number, primary care team and provider
"RTN","ECXOPRX",111,0)
 N OK,X,PT
"RTN","ECXOPRX",112,0)
 ;init variables
"RTN","ECXOPRX",113,0)
 S (ECXCAT,ECXSTAT,ECXPRIOR,ECXSBGRP)=""
"RTN","ECXOPRX",114,0)
 ;get patient data if saved
"RTN","ECXOPRX",115,0)
 I $D(^TMP($J,"ECXP",ECXDFN)) D
"RTN","ECXOPRX",116,0)
 .S PT=^TMP($J,"ECXP",ECXDFN),ECXSSN=$P(PT,U),ECXPNM=$P(PT,U,2)
"RTN","ECXOPRX",117,0)
 .S ECXMPI=$P(PT,U,3),ECXSEX=$P(PT,U,4),ECXDOB=$P(PT,U,5)
"RTN","ECXOPRX",118,0)
 .S ECXELIG=$P(PT,U,6),ECXVET=$P(PT,U,7),ECXRACE=$P(PT,U,8)
"RTN","ECXOPRX",119,0)
 .S ECXPST=$P(PT,U,9),ECXPLOC=$P(PT,U,10),ECXRST=$P(PT,U,11)
"RTN","ECXOPRX",120,0)
 .S ECXAST=$P(PT,U,12),ECXMST=$P(PT,U,13),ECXSTATE=$P(PT,U,14)
"RTN","ECXOPRX",121,0)
 .S ECXCNTY=$P(PT,U,15),ECXZIP=$P(PT,U,16),ECXENRL=$P(PT,U,17)
"RTN","ECXOPRX",122,0)
 .S ECXPHI=$P(PT,U,20)
"RTN","ECXOPRX",123,0)
 .S ECXCAT=$P(PT,U,21),ECXSTAT=$P(PT,U,22),ECXPRIOR=$P(PT,U,23)
"RTN","ECXOPRX",124,0)
 .S ECXCNHU=$P(PT,U,24),ECXPOS=$P(PT,U,25),ECXAOL=$P(PT,U,26)
"RTN","ECXOPRX",125,0)
 .S ECXHNCI=$P(PT,U,27),ECXETH=$P(PT,U,28),ECXRC1=$P(PT,U,29),ECXMTST=$P(PT,U,30)
"RTN","ECXOPRX",126,0)
 .I $$ENROLLM^ECXUTL2(ECXDFN)
"RTN","ECXOPRX",127,0)
 ;set patient data
"RTN","ECXOPRX",128,0)
 I '$D(^TMP($J,"ECXP",ECXDFN)) D  Q:'OK
"RTN","ECXOPRX",129,0)
 .K ECXPAT
"RTN","ECXOPRX",130,0)
 .S OK=$$PAT^ECXUTL3(ECXDFN,$P(ECSD1,"."),"1;2;3;5",.ECXPAT)
"RTN","ECXOPRX",131,0)
 .I 'OK S ECXERR=1 Q
"RTN","ECXOPRX",132,0)
 .S ECXSSN=ECXPAT("SSN"),ECXPNM=ECXPAT("NAME"),ECXMPI=ECXPAT("MPI")
"RTN","ECXOPRX",133,0)
 .S ECXSEX=ECXPAT("SEX"),ECXDOB=ECXPAT("DOB"),ECXELIG=ECXPAT("ELIG")
"RTN","ECXOPRX",134,0)
 .S ECXVET=ECXPAT("VET"),ECXRACE=ECXPAT("RACE"),ECXPST=ECXPAT("POW STAT")
"RTN","ECXOPRX",135,0)
 .S ECXPLOC=ECXPAT("POW LOC"),ECXRST=ECXPAT("IR STAT")
"RTN","ECXOPRX",136,0)
 .S ECXAST=ECXPAT("AO STAT"),ECXMST=ECXPAT("MST STAT")
"RTN","ECXOPRX",137,0)
 .S ECXSTATE=ECXPAT("STATE"),ECXCNTY=ECXPAT("COUNTY")
"RTN","ECXOPRX",138,0)
 .S ECXZIP=ECXPAT("ZIP"),ECXENRL=ECXPAT("ENROLL LOC")
"RTN","ECXOPRX",139,0)
 .;
"RTN","ECXOPRX",140,0)
 .;- CNH Stat (placeholder),Purp Heart Ind,Per of Svce,AO Loc,MT Stat
"RTN","ECXOPRX",141,0)
 .S ECXCNHU="",ECXPHI=ECXPAT("PHI"),ECXPOS=ECXPAT("POS"),ECXAOL=ECXPAT("AOL"),ECXMTST=ECXPAT("MEANS")
"RTN","ECXOPRX",142,0)
 .I $$ENROLLM^ECXUTL2(ECXDFN)
"RTN","ECXOPRX",143,0)
 .; - Head and Neck Cancer Indicator
"RTN","ECXOPRX",144,0)
 .S ECXHNCI=$$HNCI^ECXUTL4(ECXDFN)
"RTN","ECXOPRX",145,0)
 .; - Race and Ethnicity
"RTN","ECXOPRX",146,0)
 .S ECXETH=ECXPAT("ETHNIC")
"RTN","ECXOPRX",147,0)
 .S ECXRC1=ECXPAT("RACE1")
"RTN","ECXOPRX",148,0)
 .;save for later
"RTN","ECXOPRX",149,0)
 .S ^TMP($J,"ECXP",ECXDFN)=ECXSSN_U_ECXPNM_U_ECXMPI_U_ECXSEX_U_ECXDOB_U_ECXELIG_U_ECXVET_U_ECXRACE_U_ECXPST_U_ECXPLOC_U_ECXRST_U_ECXAST_U_ECXMST_U_ECXSTATE_U_ECXCNTY_U_ECXZIP_U_ECXENRL_U_U
"RTN","ECXOPRX",150,0)
 .S ^TMP($J,"ECXP",ECXDFN)=^TMP($J,"ECXP",ECXDFN)_U_ECXPHI_U_ECXCAT_U_ECXSTAT_U_ECXPRIOR_U_ECXCNHU_U_ECXPOS_U_ECXAOL_U_ECXHNCI_U_ECXETH_U_ECXRC1_U_ECXMTST
"RTN","ECXOPRX",151,0)
 ;get inpatient data
"RTN","ECXOPRX",152,0)
 S (ECXA,ECXADMDT,ECXDOM,ECXMN,ECXTS)=""
"RTN","ECXOPRX",153,0)
 S X=$$INP^ECXUTL2(ECXDFN,ECXDATE) D
"RTN","ECXOPRX",154,0)
 .S ECXA=$P(X,U),ECXMN=$P(X,U,2),ECXTS=$P(X,U,3),ECXDOM=$P(X,U,10)
"RTN","ECXOPRX",155,0)
 .S ECXADMDT=$P(X,U,4)
"RTN","ECXOPRX",156,0)
 ;get primary care data
"RTN","ECXOPRX",157,0)
 S X=$$PRIMARY^ECXUTL2(ECXDFN,$P(ECXDATE,"."))
"RTN","ECXOPRX",158,0)
 S ECPTTM=$P(X,U),ECPTPR=$P(X,U,2),ECCLAS=$P(X,U,3),ECPTNPI=$P(X,U,4)
"RTN","ECXOPRX",159,0)
 S ECASPR=$P(X,U,5),ECCLAS2=$P(X,U,6),ECASNPI=$P(X,U,7)
"RTN","ECXOPRX",160,0)
 Q
"RTN","ECXOPRX",161,0)
 ;
"RTN","ECXOPRX",162,0)
FILE ;file record
"RTN","ECXOPRX",163,0)
 ;node0
"RTN","ECXOPRX",164,0)
 ;inst^dfn^ssn^name^in/out ECXA^day^division^provider^drug category^mail^
"RTN","ECXOPRX",165,0)
 ;placeholder1^new^placeholder2^qty^cost^placeholder3^
"RTN","ECXOPRX",166,0)
 ;mov #^treat spec^placeholder4^unit of issue^dob^elig^vet^copay^
"RTN","ECXOPRX",167,0)
 ;feeder key^investigational^days supply^primary care team^
"RTN","ECXOPRX",168,0)
 ;primary care provider^time^race
"RTN","ECXOPRX",169,0)
 ;node1
"RTN","ECXOPRX",170,0)
 ;mpi^dss dept ECXDSSD^sex^zip+4^provider npi^pc provider npi^state^
"RTN","ECXOPRX",171,0)
 ;county^pc prov person class^pow status^pow location^
"RTN","ECXOPRX",172,0)
 ;ir status^ao status^sharing agree. payor^sharing agree. ins.^
"RTN","ECXOPRX",173,0)
 ;mst status^enroll loc^assoc pc provider^assoc pc prov person class^
"RTN","ECXOPRX",174,0)
 ;assoc pc prov npi^dom ECXDOM^purple heart ECXPHI^
"RTN","ECXOPRX",175,0)
 ;enrollment category ECXCAT^enrollment status ECXSTST^
"RTN","ECXOPRX",176,0)
 ;enrollment priority ECXPRIOR^cnhu status ECXCNHU^
"RTN","ECXOPRX",177,0)
 ;period of service ECXPOS^observ pat ind ECXOBS^encounter num ECXENC^
"RTN","ECXOPRX",178,0)
 ;ao loc ECXAOL^ord physician ECXORDPH^ord stop code ECXORDST^
"RTN","ECXOPRX",179,0)
 ;ord date ECXORDDT^CNH status ECXCNH^national division ECXPDIV^
"RTN","ECXOPRX",180,0)
 ;MT Stat ECXMTST^head & neck cancer ind. ECXHNCI^ethnicity ECXETH^
"RTN","ECXOPRX",181,0)
 ;race ECXRC1^^enrollment priority ECXPRIOR_
"RTN","ECXOPRX",182,0)
 ;enrollment subgroup ECXSBGRP^user enrollee ECXUESTA^patient type
"RTN","ECXOPRX",183,0)
 ;ECXPTYPE^combat vet elig ECXCVE^combat vet elig end date ECXCVEDT^
"RTN","ECXOPRX",184,0)
 ;enc cv eligible ECXCVENC^national patient record flag ECXNPRFI^
"RTN","ECXOPRX",185,0)
 ;rx patient status ECRXPTST^non-va prescriber ECNONVAP
"RTN","ECXOPRX",186,0)
 N DA,DIK
"RTN","ECXOPRX",187,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXOPRX",188,0)
 S ECODE=EC7_U_EC23_U_ECINST_U_ECXDFN_U_ECXSSN_U_ECXPNM_U_ECXA_U
"RTN","ECXOPRX",189,0)
 S ECODE=ECODE_$$ECXDATE^ECXUTL(ECXDATE,ECXYM)_U_ECXDIV_U
"RTN","ECXOPRX",190,0)
 S ECODE=ECODE_ECXPROV_U_ECCAT_U_ECMW_U_ECXPROVP_U_ECXNEW_U_U_ECQTY_U
"RTN","ECXOPRX",191,0)
 S ECODE=ECODE_ECXCOST_U_U_ECXMN_U_ECXTS_U_U_ECUI_U_ECXDOB_U
"RTN","ECXOPRX",192,0)
 S ECODE=ECODE_ECXELIG_U_ECXVET_U_ECOPAY_U_ECNFC_U_ECINV_U_ECDS_U
"RTN","ECXOPRX",193,0)
 S ECODE=ECODE_ECPTTM_U_ECPTPR_U_$$ECXTIME^ECXUTL(ECXDATE)_U_ECXRACE_U
"RTN","ECXOPRX",194,0)
 S ECODE1=ECXMPI_U_ECXDSSD_U_ECXSEX_U_ECXZIP_U_ECXPROVN_U_ECPTNPI_U
"RTN","ECXOPRX",195,0)
 S ECODE1=ECODE1_ECXSTATE_U_ECXCNTY_U_ECCLAS_U_ECXPST_U_ECXPLOC_U
"RTN","ECXOPRX",196,0)
 S ECODE1=ECODE1_ECXRST_U_ECXAST_U_U_U_ECXMST_U_ECXENRL_U
"RTN","ECXOPRX",197,0)
 S ECODE1=ECODE1_ECASPR_U_ECCLAS2_U_ECASNPI_U_ECXDOM_U_ECXPHI_U_ECXCAT_U
"RTN","ECXOPRX",198,0)
 S ECODE1=ECODE1_ECXSTAT_U_$S(ECXLOGIC<2005:ECXPRIOR,1:"")_U_ECXCNHU_U_ECXPOS_U_ECXOBS_U
"RTN","ECXOPRX",199,0)
 S ECODE1=ECODE1_ECXENC_U_ECXAOL_U_ECXORDPH_U_ECXORDST_U_ECXORDDT_U
"RTN","ECXOPRX",200,0)
 S ECODE1=ECODE1_ECXCNH_U_ECXPDIV_U_ECXMTST_U_ECXHNCI_U_ECXETH_U
"RTN","ECXOPRX",201,0)
 S ECODE1=ECODE1_ECXRC1_U
"RTN","ECXOPRX",202,0)
 I ECXLOGIC>2004 S ECODE1=ECODE1_U_ECXPRIOR_ECXSBGRP_U_ECXUESTA_U
"RTN","ECXOPRX",203,0)
 I ECXLOGIC>2004 S ECODE2=ECXPTYPE_U_ECXCVE_U_ECXCVEDT_U_ECXCVENC_U_ECXNPRFI_U_ECRXPTST_U_ECNONVAP
"RTN","ECXOPRX",204,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,^ECX(ECFILE,EC7,2)=$G(ECODE2),ECRN=ECRN+1
"RTN","ECXOPRX",205,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX1^DIK K DIK,DA
"RTN","ECXOPRX",206,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S QFLG=1
"RTN","ECXOPRX",207,0)
 Q
"RTN","ECXOPRX",208,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXOPRX",209,0)
 S ECHEAD="PRE"
"RTN","ECXOPRX",210,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXOPRX",211,0)
 Q
"RTN","ECXOPRX",212,0)
 ;
"RTN","ECXOPRX",213,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXOPRX",214,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"VER")
8.0^22.0
**END**
**END**
