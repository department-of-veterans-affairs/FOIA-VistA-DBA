Released RG*1*13 SEQ #16
Extracted from mail message
**KIDS**:RG*1.0*13^

**INSTALL NAME**
RG*1.0*13
"BLD",1177,0)
RG*1.0*13^CLINICAL INFO RESOURCE NETWORK^0^3010511^y
"BLD",1177,1,0)
^^3^3^3010323^
"BLD",1177,1,1,0)
MPI EXCEPTION HANDLER
"BLD",1177,1,2,0)
Refer to patch RG*1*13 in the FORUM Patch Module for a complete
"BLD",1177,1,3,0)
description.
"BLD",1177,4,0)
^9.64PA^991.11^1
"BLD",1177,4,991.11,0)
991.11
"BLD",1177,4,991.11,2,0)
^9.641^991.11^1
"BLD",1177,4,991.11,2,991.11,0)
CIRN HL7 EXCEPTION TYPE  (File-top level)
"BLD",1177,4,991.11,2,991.11,1,0)
^9.6411^^
"BLD",1177,4,991.11,222)
y^n^p^^^^n
"BLD",1177,4,"APDD",991.11,991.11)

"BLD",1177,4,"B",991.11,991.11)

"BLD",1177,"ABNS",0)
^9.66A^^
"BLD",1177,"ABPKG")
^^
"BLD",1177,"INID")
y^y
"BLD",1177,"INIT")
RGP13PST
"BLD",1177,"KRN",0)
^9.67PA^19^17
"BLD",1177,"KRN",.4,0)
.4
"BLD",1177,"KRN",.401,0)
.401
"BLD",1177,"KRN",.402,0)
.402
"BLD",1177,"KRN",.403,0)
.403
"BLD",1177,"KRN",.5,0)
.5
"BLD",1177,"KRN",.84,0)
.84
"BLD",1177,"KRN",3.6,0)
3.6
"BLD",1177,"KRN",3.8,0)
3.8
"BLD",1177,"KRN",9.2,0)
9.2
"BLD",1177,"KRN",9.8,0)
9.8
"BLD",1177,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",1177,"KRN",9.8,"NM",1,0)
RGFIACK^^0^B2971301
"BLD",1177,"KRN",9.8,"NM",2,0)
RGHLLOG^^0^B21275912
"BLD",1177,"KRN",9.8,"NM",3,0)
RGHLLOG1^^0^B18066287
"BLD",1177,"KRN",9.8,"NM",4,0)
RGFIU^^0^B35208417
"BLD",1177,"KRN",9.8,"NM",5,0)
RGP13PST^^0^B492074
"BLD",1177,"KRN",9.8,"NM",6,0)
RGP13ENV^^0^B8890414
"BLD",1177,"KRN",9.8,"NM","B","RGFIACK",1)

"BLD",1177,"KRN",9.8,"NM","B","RGFIU",4)

"BLD",1177,"KRN",9.8,"NM","B","RGHLLOG",2)

"BLD",1177,"KRN",9.8,"NM","B","RGHLLOG1",3)

"BLD",1177,"KRN",9.8,"NM","B","RGP13ENV",6)

"BLD",1177,"KRN",9.8,"NM","B","RGP13PST",5)

"BLD",1177,"KRN",19,0)
19
"BLD",1177,"KRN",19.1,0)
19.1
"BLD",1177,"KRN",101,0)
101
"BLD",1177,"KRN",409.61,0)
409.61
"BLD",1177,"KRN",771,0)
771
"BLD",1177,"KRN",870,0)
870
"BLD",1177,"KRN",8994,0)
8994
"BLD",1177,"KRN","B",.4,.4)

"BLD",1177,"KRN","B",.401,.401)

"BLD",1177,"KRN","B",.402,.402)

"BLD",1177,"KRN","B",.403,.403)

"BLD",1177,"KRN","B",.5,.5)

"BLD",1177,"KRN","B",.84,.84)

"BLD",1177,"KRN","B",3.6,3.6)

"BLD",1177,"KRN","B",3.8,3.8)

"BLD",1177,"KRN","B",9.2,9.2)

"BLD",1177,"KRN","B",9.8,9.8)

"BLD",1177,"KRN","B",19,19)

"BLD",1177,"KRN","B",19.1,19.1)

"BLD",1177,"KRN","B",101,101)

"BLD",1177,"KRN","B",409.61,409.61)

"BLD",1177,"KRN","B",771,771)

"BLD",1177,"KRN","B",870,870)

"BLD",1177,"KRN","B",8994,8994)

"BLD",1177,"PRE")
RGP13ENV
"BLD",1177,"QUES",0)
^9.62^^
"BLD",1177,"REQB",0)
^9.611^3^2
"BLD",1177,"REQB",2,0)
RG*1.0*11^2
"BLD",1177,"REQB",3,0)
RG*1.0*9^2
"BLD",1177,"REQB","B","RG*1.0*11",2)

"BLD",1177,"REQB","B","RG*1.0*9",3)

"FIA",991.11)
CIRN HL7 EXCEPTION TYPE
"FIA",991.11,0)
^RGHL7(991.11,
"FIA",991.11,0,0)
991.11I
"FIA",991.11,0,1)
y^n^f^^^^n
"FIA",991.11,0,10)

"FIA",991.11,0,11)

"FIA",991.11,0,"RLRO")

"FIA",991.11,0,"VR")
1.0^RG
"FIA",991.11,991.11)
0
"FIA",991.11,991.112)
0
"FIA",991.11,991.1199)
0
"INIT")
RGP13PST
"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
13^3010511
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3010511
"PKG",272,22,1,"PAH",1,1,1,0)
MPI EXCEPTION HANDLER
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*13 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"PRE")
RGP13ENV
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","RGFIACK")
0^1^B2971301
"RTN","RGFIACK",1,0)
RGFIACK ;ALB/CJM-PROCESS APPLICATION ACKNOWLEDGMENT ;08/27/99
"RTN","RGFIACK",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5,13**;30 Apr 99
"RTN","RGFIACK",3,0)
 ;
"RTN","RGFIACK",4,0)
ACK ;
"RTN","RGFIACK",5,0)
 ;Description: Process the application ack to the Facility Integration
"RTN","RGFIACK",6,0)
 ;Message
"RTN","RGFIACK",7,0)
 ;
"RTN","RGFIACK",8,0)
 ;Input:
"RTN","RGFIACK",9,0)
 ;  HL7 variables must be defined
"RTN","RGFIACK",10,0)
 ;Output: none
"RTN","RGFIACK",11,0)
 ;Variables:
"RTN","RGFIACK",12,0)
 ;  FS - field seperator
"RTN","RGFIACK",13,0)
 ;  CS - component seperator
"RTN","RGFIACK",14,0)
 ;  CODE - returned error code
"RTN","RGFIACK",15,0)
 ;  MSG - error text returned
"RTN","RGFIACK",16,0)
 ;  TYPE - ack type (AA,ER)
"RTN","RGFIACK",17,0)
 ;  MSGID - HL7 msg id
"RTN","RGFIACK",18,0)
 ;  RGLOG - ien of entry in the CIRN HL7 Exception file
"RTN","RGFIACK",19,0)
 ;  ICN - Integrated Control Number
"RTN","RGFIACK",20,0)
 ;  DFN - patient DFN
"RTN","RGFIACK",21,0)
 ;  SITE - station # of site that sent the app ack
"RTN","RGFIACK",22,0)
 ;
"RTN","RGFIACK",23,0)
 N FS,CS,QUIT,CODE,MSG,TYPE,MSGID,RGLOG,ICN,DFN,SITE
"RTN","RGFIACK",24,0)
 S FS=HL("FS")
"RTN","RGFIACK",25,0)
 S CS=$E(HL("ECH"),1)
"RTN","RGFIACK",26,0)
 S QUIT=0
"RTN","RGFIACK",27,0)
 K HLERR
"RTN","RGFIACK",28,0)
 ;
"RTN","RGFIACK",29,0)
 X HLNEXT D  Q:QUIT
"RTN","RGFIACK",30,0)
 .I (HLQUIT'>0) S HLERR="MISSING MSH SEGMENT",QUIT=1 Q
"RTN","RGFIACK",31,0)
 .I $P(HLNODE,FS)'["MSH" S HLERR="MISSING MSH SEGMENT",QUIT=1 Q
"RTN","RGFIACK",32,0)
 X HLNEXT D  Q:QUIT
"RTN","RGFIACK",33,0)
 .I (HLQUIT'>0) S HLERR="MISSING MSA SEGMENT",QUIT=1 Q
"RTN","RGFIACK",34,0)
 .I $P(HLNODE,FS)'["MSA" S HLERR="MISSING MSA SEGMENT",QUIT=1 Q
"RTN","RGFIACK",35,0)
 .S TYPE=$P(HLNODE,FS,2)
"RTN","RGFIACK",36,0)
 .S MSGID=$P(HLNODE,FS,3)
"RTN","RGFIACK",37,0)
 .S MSG=$P(HLNODE,FS,4)
"RTN","RGFIACK",38,0)
 .S ICN=+$P(MSG,"ICN:",2)
"RTN","RGFIACK",39,0)
 .S DFN=$S(ICN:$$DFN^RGFIU(ICN),1:"")
"RTN","RGFIACK",40,0)
 .S SITE=$P(MSG,"From Station:",2),SITE=$P(SITE," ICN:")
"RTN","RGFIACK",41,0)
 .S CODE=$P($P(HLNODE,FS,7),CS,4)
"RTN","RGFIACK",42,0)
 I ($G(TYPE)["R"),$G(MSGID),$G(CODE) D
"RTN","RGFIACK",43,0)
 .N HLMTIEN
"RTN","RGFIACK",44,0)
 .S HLMTIEN=MSGID
"RTN","RGFIACK",45,0)
 .D EXC^RGFIU(CODE,"APPLICATION ACKNOWLEDGMENT TO MSGID: "_MSGID_" - "_MSG,DFN,MSGID,SITE)
"RTN","RGFIACK",46,0)
 .D STOP^RGHLLOG(1)
"RTN","RGFIACK",47,0)
 Q
"RTN","RGFIU")
0^4^B35208417
"RTN","RGFIU",1,0)
RGFIU ;ALB/CJM-MPI/PD NDBI MERGE UTILITY (CONTINUED) ;08/27/99
"RTN","RGFIU",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**5,13**;30 Apr 99
"RTN","RGFIU",3,0)
 ;
"RTN","RGFIU",4,0)
STATNUM(IEN) ;
"RTN","RGFIU",5,0)
 ;Description:  Given an ien to the Institution file, returns as the function value the station number.  Returns "" on failure.
"RTN","RGFIU",6,0)
 ;
"RTN","RGFIU",7,0)
 N STATION
"RTN","RGFIU",8,0)
 Q:'$G(IEN) ""
"RTN","RGFIU",9,0)
 Q:'$D(^DIC(4,IEN,0)) ""
"RTN","RGFIU",10,0)
 S STATION=$P($$NNT^XUAF4(IEN),"^",2)
"RTN","RGFIU",11,0)
 Q $S(+STATION:STATION,1:"")
"RTN","RGFIU",12,0)
 ;
"RTN","RGFIU",13,0)
UPD(FILE,RGDA,DATA,ERROR) ;File data into an existing record.
"RTN","RGFIU",14,0)
 ; Input:
"RTN","RGFIU",15,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",16,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",17,0)
 ;            Pass by reference.
"RTN","RGFIU",18,0)
 ;   DATA - Data array to file (pass by reference)
"RTN","RGFIU",19,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","RGFIU",20,0)
 ;
"RTN","RGFIU",21,0)
 ; Output:
"RTN","RGFIU",22,0)
 ;  Function Value -     0=error and 1=no error
"RTN","RGFIU",23,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",24,0)
 ;
"RTN","RGFIU",25,0)
 ; Example: To update a record in subfile 2.0361 in record with ien=353,
"RTN","RGFIU",26,0)
 ;          subrecord ien=68, with the field .01 value = 21:
"RTN","RGFIU",27,0)
 ;    S DATA(.01)=21,RGDA=68,RGDA(1)=353 I $$UPD^RGFIU(2.0361,.RGDA,.DATA,.ERROR) W !,"DONE"
"RTN","RGFIU",28,0)
 ;
"RTN","RGFIU",29,0)
 N FDA,FIELD,IENS,ERRORS
"RTN","RGFIU",30,0)
 ;
"RTN","RGFIU",31,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",32,0)
 ;FDA - the FDA array as defined by FM
"RTN","RGFIU",33,0)
 ;
"RTN","RGFIU",34,0)
 I '$G(RGDA) S ERROR="IEN OF RECORD TO BE UPDATED NOT SPECIFIED" Q 0
"RTN","RGFIU",35,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",36,0)
 S FIELD=0
"RTN","RGFIU",37,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  D
"RTN","RGFIU",38,0)
 .S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","RGFIU",39,0)
 D FILE^DIE("K","FDA","ERRORS(1)")
"RTN","RGFIU",40,0)
 I +$G(DIERR) D
"RTN","RGFIU",41,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",42,0)
 E  D
"RTN","RGFIU",43,0)
 .S ERROR=""
"RTN","RGFIU",44,0)
 ;
"RTN","RGFIU",45,0)
 I $S(+$G(DIERR):0,1:1) D CLEAN^DILF Q 1
"RTN","RGFIU",46,0)
 E  D CLEAN^DILF Q 0
"RTN","RGFIU",47,0)
 ;
"RTN","RGFIU",48,0)
GETFIELD(FILE,FIELD,RGDA,ERROR,EXT) ;Get field value from an existing record.
"RTN","RGFIU",49,0)
 ; Input:
"RTN","RGFIU",50,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",51,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",52,0)
 ;            Pass by reference.
"RTN","RGFIU",53,0)
 ;   FIELD - Field for which value is needed
"RTN","RGFIU",54,0)
 ;   EXT - (optional) If $G(EXT) then returns the external display form of the value
"RTN","RGFIU",55,0)
 ; Output:
"RTN","RGFIU",56,0)
 ;  Function Value -  field value in internal format,"" if an error was encountered
"RTN","RGFIU",57,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",58,0)
 ;
"RTN","RGFIU",59,0)
 N FDA,IENS,ERRORS,VALUE
"RTN","RGFIU",60,0)
 ;
"RTN","RGFIU",61,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",62,0)
 ;FDA - the FDA array as defined by FM
"RTN","RGFIU",63,0)
 ;
"RTN","RGFIU",64,0)
 I '$G(RGDA) S ERROR="IEN OF RECORD TO BE UPDATED NOT SPECIFIED" Q ""
"RTN","RGFIU",65,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",66,0)
 S VALUE=$$GET1^DIQ(FILE,IENS,FIELD,$S($G(EXT):"",1:"I"),,"ERRORS(1)")
"RTN","RGFIU",67,0)
 I +$G(DIERR) D
"RTN","RGFIU",68,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",69,0)
 E  D
"RTN","RGFIU",70,0)
 .S ERROR=""
"RTN","RGFIU",71,0)
 ;
"RTN","RGFIU",72,0)
 I $S(+$G(DIERR):0,1:1) D CLEAN^DILF Q VALUE
"RTN","RGFIU",73,0)
 E  D CLEAN^DILF Q ""
"RTN","RGFIU",74,0)
 ;
"RTN","RGFIU",75,0)
DELETE(FILE,RGDA,ERROR) ;Delete an existing record.
"RTN","RGFIU",76,0)
 ; Input:
"RTN","RGFIU",77,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",78,0)
 ;   RGDA - New name for traditional DA array, with same meaning.
"RTN","RGFIU",79,0)
 ;            Pass by reference.
"RTN","RGFIU",80,0)
 ;
"RTN","RGFIU",81,0)
 ; Output:
"RTN","RGFIU",82,0)
 ;  Function Value -     0=error and 1=no error
"RTN","RGFIU",83,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",84,0)
 ;
"RTN","RGFIU",85,0)
 ; Example: To delete a record in subfile 2.0361 in record with ien=353,
"RTN","RGFIU",86,0)
 ;          subrecord ien=68:
"RTN","RGFIU",87,0)
 ;    S RGDA=68,RGDA(1)=353 I $$DELETE^RGFIU(2.0361,.RGDA,.DATA,.ERROR) W !,"DONE"
"RTN","RGFIU",88,0)
 ;
"RTN","RGFIU",89,0)
 N DATA
"RTN","RGFIU",90,0)
 S DATA(.01)="@"
"RTN","RGFIU",91,0)
 Q $$UPD^RGFIU(FILE,.RGDA,.DATA,.ERROR)
"RTN","RGFIU",92,0)
 Q
"RTN","RGFIU",93,0)
 ;
"RTN","RGFIU",94,0)
ADD(FILE,RGDA,DATA,ERROR,IEN) ;
"RTN","RGFIU",95,0)
 ;Description: Creates a new record and files the data.
"RTN","RGFIU",96,0)
 ; Input:
"RTN","RGFIU",97,0)
 ;   FILE - File or sub-file number
"RTN","RGFIU",98,0)
 ;   RGDA - New name for traditional FileMan DA array with same
"RTN","RGFIU",99,0)
 ;            meaning. Pass by reference.  Only needed if adding to a
"RTN","RGFIU",100,0)
 ;            subfile.
"RTN","RGFIU",101,0)
 ;   DATA - Data array to file, pass by reference
"RTN","RGFIU",102,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","RGFIU",103,0)
 ;   IEN - internal entry number to use (optional)
"RTN","RGFIU",104,0)
 ;
"RTN","RGFIU",105,0)
 ; Output:
"RTN","RGFIU",106,0)
 ;   Function Value - If no error then it returns the ien of the created record, else returns NULL.
"RTN","RGFIU",107,0)
 ;  RGDA - returns the ien of the new record, NULL if none created.  If needed, pass by reference.
"RTN","RGFIU",108,0)
 ;  ERROR - optional error message - if needed, pass by reference
"RTN","RGFIU",109,0)
 ;
"RTN","RGFIU",110,0)
 ; Example: To add a record in subfile 2.0361 in the record with ien=353
"RTN","RGFIU",111,0)
 ;          with the field .01 value = 21:
"RTN","RGFIU",112,0)
 ;  S DATA(.01)=21,RGDA(1)=353 I $$ADD^RGFIU(2.0361,.RGDA,.DATA) W !,"DONE"
"RTN","RGFIU",113,0)
 ;
"RTN","RGFIU",114,0)
 ; Example: If creating a record not in a subfile, would look like this:
"RTN","RGFIU",115,0)
 ;          S DATA(.01)=21 I $$ADD^RGFIU(867,,.DATA) W !,"DONE"
"RTN","RGFIU",116,0)
 ;
"RTN","RGFIU",117,0)
 N FDA,FIELD,IENA,IENS,ERRORS
"RTN","RGFIU",118,0)
 ;
"RTN","RGFIU",119,0)
 ;IENS - Internal Entry Number String defined by FM
"RTN","RGFIU",120,0)
 ;IENA - the Internal Entry Numebr Array defined by FM
"RTN","RGFIU",121,0)
 ;FDA - the FDA array defined by FM
"RTN","RGFIU",122,0)
 ;IEN - the ien of the new record
"RTN","RGFIU",123,0)
 ;
"RTN","RGFIU",124,0)
 S RGDA="+1"
"RTN","RGFIU",125,0)
 S IENS=$$IENS^DILF(.RGDA)
"RTN","RGFIU",126,0)
 S FIELD=0
"RTN","RGFIU",127,0)
 F  S FIELD=$O(DATA(FIELD)) Q:'FIELD  D
"RTN","RGFIU",128,0)
 .S FDA(FILE,IENS,FIELD)=$G(DATA(FIELD))
"RTN","RGFIU",129,0)
 I $G(IEN) S IENA(1)=IEN
"RTN","RGFIU",130,0)
 D UPDATE^DIE("","FDA","IENA","ERRORS(1)")
"RTN","RGFIU",131,0)
 I +$G(DIERR) D
"RTN","RGFIU",132,0)
 .S ERROR=$G(ERRORS(1,"DIERR",1,"TEXT",1))
"RTN","RGFIU",133,0)
 .S IEN=""
"RTN","RGFIU",134,0)
 E  D
"RTN","RGFIU",135,0)
 .S IEN=IENA(1)
"RTN","RGFIU",136,0)
 .S ERROR=""
"RTN","RGFIU",137,0)
 D CLEAN^DILF
"RTN","RGFIU",138,0)
 S RGDA=IEN
"RTN","RGFIU",139,0)
 Q IEN
"RTN","RGFIU",140,0)
 ;
"RTN","RGFIU",141,0)
TESTVAL(FILE,FIELD,VALUE) ;
"RTN","RGFIU",142,0)
 ;Description: returns 1 if VALUE is a valid value for FIELD in FILE
"RTN","RGFIU",143,0)
 ;
"RTN","RGFIU",144,0)
 Q:(('$G(FILE))!('$G(FIELD))) 0
"RTN","RGFIU",145,0)
 ;
"RTN","RGFIU",146,0)
 N DISPLAY,VALID,RESULT
"RTN","RGFIU",147,0)
 S VALID=1
"RTN","RGFIU",148,0)
 ;
"RTN","RGFIU",149,0)
 ;if there is no external value then it is not valid
"RTN","RGFIU",150,0)
 S DISPLAY=$$EXTERNAL^DILFD(FILE,FIELD,"F",VALUE)
"RTN","RGFIU",151,0)
 I (DISPLAY="") S VALID=0
"RTN","RGFIU",152,0)
 ; 
"RTN","RGFIU",153,0)
 I VALID,$$GET1^DID(FILE,FIELD,"","TYPE")'["POINTER" D
"RTN","RGFIU",154,0)
 .D CHK^DIE(FILE,FIELD,,VALUE,.RESULT) I RESULT="^" S VALID=0 Q
"RTN","RGFIU",155,0)
 Q VALID
"RTN","RGFIU",156,0)
 ;
"RTN","RGFIU",157,0)
GETLINK(INSTIEN) ;
"RTN","RGFIU",158,0)
 ;Description:  Returns name of logical link for institition, given the institution ien.  Returns "" if a logical link name not found.
"RTN","RGFIU",159,0)
 ;
"RTN","RGFIU",160,0)
 Q:'$G(INSTIEN) ""
"RTN","RGFIU",161,0)
 ;
"RTN","RGFIU",162,0)
 N LINK,I,LINKNAME
"RTN","RGFIU",163,0)
 S LINKNAME=""
"RTN","RGFIU",164,0)
 D
"RTN","RGFIU",165,0)
 .;don't check if enabled - if shut down, message will be queued
"RTN","RGFIU",166,0)
 .;Q:'$$CHKLL^HLUTIL(INSTIEN)
"RTN","RGFIU",167,0)
 .;
"RTN","RGFIU",168,0)
 .D LINK^HLUTIL3(INSTIEN,.LINK)
"RTN","RGFIU",169,0)
 .S I=$O(LINK(0))
"RTN","RGFIU",170,0)
 .I I,$L(LINK(I)) S LINKNAME=LINK(I)
"RTN","RGFIU",171,0)
 Q LINKNAME
"RTN","RGFIU",172,0)
 ;
"RTN","RGFIU",173,0)
ASKYESNO(PROMPT,DEFAULT) ;
"RTN","RGFIU",174,0)
 ;Description: Displays PROMPT, appending '?'.  Expects a YES NO response.
"RTN","RGFIU",175,0)
 ;Input:
"RTN","RGFIU",176,0)
 ;   PROMPT - text to display as prompt.  Appends '?'
"RTN","RGFIU",177,0)
 ;   DEFAULT - (optional) YES or NO.  If not passed, defaults to YES
"RTN","RGFIU",178,0)
 ;Output:
"RTN","RGFIU",179,0)
 ;  Function value: 1 if yes, 0 if no, "" if '^' entered or timeout
"RTN","RGFIU",180,0)
 ;
"RTN","RGFIU",181,0)
 N DIR,Y
"RTN","RGFIU",182,0)
 S DIR(0)="Y"
"RTN","RGFIU",183,0)
 S DIR("A")=PROMPT
"RTN","RGFIU",184,0)
 S DIR("B")=$S($G(DEFAULT)="NO":"NO",1:"YES")
"RTN","RGFIU",185,0)
 D ^DIR
"RTN","RGFIU",186,0)
 Q:$D(DIRUT) ""
"RTN","RGFIU",187,0)
 Q Y
"RTN","RGFIU",188,0)
 ;
"RTN","RGFIU",189,0)
EXC(RGEXC,RGERR,RGDFN,RGMSGID,RGSITE) ;
"RTN","RGFIU",190,0)
 ;Description: Calls the MPI/PD Exception Handler
"RTN","RGFIU",191,0)
 ;Inputs:
"RTN","RGFIU",192,0)
 ;  RGEXC - the exception type
"RTN","RGFIU",193,0)
 ;  RGERR - (optional) text
"RTN","RGFIU",194,0)
 ;  RGDFN - (optional) patient DFN
"RTN","RGFIU",195,0)
 ;  RGMSGID - (optional) HL7 message id
"RTN","RGFIU",196,0)
 ;  RGSITE - (optional) station # of site where the exception occurred
"RTN","RGFIU",197,0)
 N ICN
"RTN","RGFIU",198,0)
 I +$G(RGDFN) D
"RTN","RGFIU",199,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGFIU",200,0)
 .I ICN'>0 S ICN=""
"RTN","RGFIU",201,0)
 .S RGERR=$G(RGERR)_"  Patient Name: "_$E($$NAME(RGDFN),1,25)_" SSN: "_$$SSN(RGDFN)_"  ICN: "_ICN
"RTN","RGFIU",202,0)
 D EXC^RGHLLOG($G(RGEXC),$E($G(RGERR),1,235),$G(RGDFN),$G(RGMSGID),$G(RGSITE))
"RTN","RGFIU",203,0)
 Q
"RTN","RGFIU",204,0)
 ;
"RTN","RGFIU",205,0)
SSN(DFN) ;
"RTN","RGFIU",206,0)
 ;Description: Function returns the patient's SSN, or "" on failure.
"RTN","RGFIU",207,0)
 Q $$GETFIELD(2,.09,.DFN)
"RTN","RGFIU",208,0)
 ;
"RTN","RGFIU",209,0)
NAME(DFN) ;
"RTN","RGFIU",210,0)
 ;Description: Function returns the patient's NAME, or "" on failure.
"RTN","RGFIU",211,0)
 Q $$GETFIELD(2,.01,.DFN)
"RTN","RGFIU",212,0)
 ;
"RTN","RGFIU",213,0)
ICN(DFN) ;Return patient ICN
"RTN","RGFIU",214,0)
 NEW RESULT
"RTN","RGFIU",215,0)
 S RESULT=$$GETICN^MPIF001($G(DFN))
"RTN","RGFIU",216,0)
 I RESULT<0 Q ""
"RTN","RGFIU",217,0)
 Q +RESULT
"RTN","RGFIU",218,0)
 ;
"RTN","RGFIU",219,0)
DFN(ICN) ;Return patient IEN
"RTN","RGFIU",220,0)
 NEW RESULT
"RTN","RGFIU",221,0)
 S RESULT=$$GETDFN^MPIF001($G(ICN))
"RTN","RGFIU",222,0)
 I RESULT<0 Q ""
"RTN","RGFIU",223,0)
 Q RESULT
"RTN","RGFIU",224,0)
 ;
"RTN","RGFIU",225,0)
MPINODE(DFN) ;
"RTN","RGFIU",226,0)
 N NODE
"RTN","RGFIU",227,0)
 S NODE=$$MPINODE^MPIFAPI($G(DFN))
"RTN","RGFIU",228,0)
 I +NODE=-1 S NODE=""
"RTN","RGFIU",229,0)
 Q NODE
"RTN","RGFIU",230,0)
 ;
"RTN","RGFIU",231,0)
GETALL(DFN,MPIDATA) ;
"RTN","RGFIU",232,0)
 ;Descripition: Gets the MPI data and treating facility list
"RTN","RGFIU",233,0)
 ;
"RTN","RGFIU",234,0)
 ;Input:
"RTN","RGFIU",235,0)
 ;   DFN - patient ien
"RTN","RGFIU",236,0)
 ;Output:
"RTN","RGFIU",237,0)
 ;   MPIDATA       - output array (pass by reference)
"RTN","RGFIU",238,0)
 ;       "ICN") = <ICN>
"RTN","RGFIU",239,0)
 ;       "CHKSUM") = <ICN checksum>
"RTN","RGFIU",240,0)
 ;       "LOC") = <1 if ICN is local, 0 if national>
"RTN","RGFIU",241,0)
 ;       "CMOR") = <station number of CMOR>
"RTN","RGFIU",242,0)
 ;       "TF",<station number of TF>,"INSTIEN")=<ien of treating facility in Institution file>
"RTN","RGFIU",243,0)
 ;       "TF",<station number of TF>,"LASTDATE")=<date last treated>
"RTN","RGFIU",244,0)
 ;       "TF",<station number of TF>,"EVENT")=<ADT event reason (a pointer)>
"RTN","RGFIU",245,0)
 ;       "SUB") = <ien of subscriber list>
"RTN","RGFIU",246,0)
 ;
"RTN","RGFIU",247,0)
 N NODE,IEN,STAT,INST,LINK,I,HLL
"RTN","RGFIU",248,0)
 ;
"RTN","RGFIU",249,0)
 K MPIDATA
"RTN","RGFIU",250,0)
 ;
"RTN","RGFIU",251,0)
 ;get MPI data
"RTN","RGFIU",252,0)
 S NODE=$$MPINODE^RGFIU(DFN)
"RTN","RGFIU",253,0)
 S MPIDATA("ICN")=$P(NODE,"^"),MPIDATA("CHKSUM")=$P(NODE,"^",2),MPIDATA("LOC")=$P(NODE,"^",4),MPIDATA("CMOR")=$$STATNUM^RGFIU($P(NODE,"^",3)),MPIDATA("SUB")=$P(NODE,"^",5)
"RTN","RGFIU",254,0)
 ;
"RTN","RGFIU",255,0)
 ;get TF list
"RTN","RGFIU",256,0)
 I MPIDATA("ICN") D
"RTN","RGFIU",257,0)
 .N ARRAY,ITEM,NODE,STAT
"RTN","RGFIU",258,0)
 .Q:$$QUERYTF^VAFCTFU1(MPIDATA("ICN"),"ARRAY")
"RTN","RGFIU",259,0)
 .S ITEM=0
"RTN","RGFIU",260,0)
 .F  S ITEM=$O(ARRAY(ITEM)) Q:'ITEM  D
"RTN","RGFIU",261,0)
 ..S NODE=ARRAY(ITEM)
"RTN","RGFIU",262,0)
 ..S STAT=$$STATNUM^RGFIU($P(NODE,"^"))
"RTN","RGFIU",263,0)
 ..Q:'STAT
"RTN","RGFIU",264,0)
 ..S MPIDATA("TF",STAT,"INSTIEN")=$P(NODE,"^",1)
"RTN","RGFIU",265,0)
 ..S MPIDATA("TF",STAT,"LASTDATE")=$P(NODE,"^",2)
"RTN","RGFIU",266,0)
 ..S MPIDATA("TF",STAT,"EVENT")=$P(NODE,"^",3)
"RTN","RGFIU",267,0)
 Q
"RTN","RGHLLOG")
0^2^B21275912
"RTN","RGHLLOG",1,0)
RGHLLOG ;CAIRO/DKM-LOG MESSAGE PROCESSING INFO ;09/04/98
"RTN","RGHLLOG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,11,13**;30 Apr 99
"RTN","RGHLLOG",3,0)
 ;=================================================================
"RTN","RGHLLOG",4,0)
 ; Log information about message processing and exceptions
"RTN","RGHLLOG",5,0)
 ; in CIRN HL7 Exception Log file.
"RTN","RGHLLOG",6,0)
 ;=================================================================
"RTN","RGHLLOG",7,0)
 ; Start time for run log
"RTN","RGHLLOG",8,0)
START(RGMSG,RGDC,RGPARAM) ;
"RTN","RGHLLOG",9,0)
 ;This entry point starts the log process in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",10,0)
 ;file (#991.1), if the (#6) MINIMAL EXCEPTION LOGGING? field in
"RTN","RGHLLOG",11,0)
 ;File #990.8 is set to 0.
"RTN","RGHLLOG",12,0)
 ; Input: Required
"RTN","RGHLLOG",13,0)
 ;   RGMSG - IEN of message entry in File #773, usually HLMTIEN
"RTN","RGHLLOG",14,0)
 ;        Optional
"RTN","RGHLLOG",15,0)
 ;   RGDC - Event Class, associated with an entry in File #
"RTN","RGHLLOG",16,0)
 ;   RGPARAM - reprocessing routine
"RTN","RGHLLOG",17,0)
 S U="^"
"RTN","RGHLLOG",18,0)
 K RGLOG
"RTN","RGHLLOG",19,0)
 S RGLOG(3)=$G(RGMSG),RGLOG(5)=$G(RGDC),RGLOG(4)=$G(RGPARAM),RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",20,0)
 I '$P(^RGSITE("COR",1,0),U,8) S RGLOG=$$CREATE
"RTN","RGHLLOG",21,0)
 Q
"RTN","RGHLLOG",22,0)
 ; Create a log entry
"RTN","RGHLLOG",23,0)
CREATE() Q:$G(RGLOG) RGLOG
"RTN","RGHLLOG",24,0)
 L +^RGHL7(991.1,0):10
"RTN","RGHLLOG",25,0)
 S RGLOG=$O(^RGHL7(991.1,$C(32)),-1)+1
"RTN","RGHLLOG",26,0)
 S:$G(RGLOG(1))="" RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",27,0)
 S RGLOG(3)=$S($G(RGLOG(3))=0:0,$G(HL("MID"))="":"",1:$$IEN773($G(HL("MID"))))
"RTN","RGHLLOG",28,0)
 S (DA,X)=RGLOG,DIC="^RGHL7(991.1,",DIC(0)="L",DLAYGO=991.1,DIC("DR")="1///"_$G(RGLOG(1))_";3////"_$G(RGLOG(3))_";5///"_$G(RGLOG(5))_";4////"_$G(RGLOG(4)) K DD,DO D FILE^DICN K DIC,DA,X,DLAYGO
"RTN","RGHLLOG",29,0)
 L -^RGHL7(991.1,0)
"RTN","RGHLLOG",30,0)
 Q RGLOG
"RTN","RGHLLOG",31,0)
 ; Log time run completed
"RTN","RGHLLOG",32,0)
STOP(RGQUIT) ;
"RTN","RGHLLOG",33,0)
 ;This entry point completes the logging process
"RTN","RGHLLOG",34,0)
 ; Input: required
"RTN","RGHLLOG",35,0)
 ;    RGQUIT - 0 for success and 1 for failure
"RTN","RGHLLOG",36,0)
 ;
"RTN","RGHLLOG",37,0)
 Q:'$G(RGLOG)
"RTN","RGHLLOG",38,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",39,0)
 S DIE="^RGHL7(991.1,",DR="1.5///NOW;1.6///^S X=$G(RGQUIT)",DA=RGLOG D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",40,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",41,0)
 K RGLOG,RGQUIT,X,Y,DIC,DIE
"RTN","RGHLLOG",42,0)
 Q
"RTN","RGHLLOG",43,0)
 ; Log unclassified exception (old entry point)
"RTN","RGHLLOG",44,0)
ERR(RGERR,RGSEV) ;
"RTN","RGHLLOG",45,0)
 D EXC(18,RGERR)
"RTN","RGHLLOG",46,0)
 S RGQUIT=$G(RGQUIT)!$G(RGSEV)
"RTN","RGHLLOG",47,0)
 Q
"RTN","RGHLLOG",48,0)
 ; Log an exception
"RTN","RGHLLOG",49,0)
EXC(RGEXC,RGERR,RGDFN,MSGID,STATNUM) ;
"RTN","RGHLLOG",50,0)
 ;This entry point logs exceptions in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",51,0)
 ;file (#991.1)
"RTN","RGHLLOG",52,0)
 ; Input: Required
"RTN","RGHLLOG",53,0)
 ;   RGEXC - Exception type in File #991.11
"RTN","RGHLLOG",54,0)
 ;   RGERR - Supplemental text
"RTN","RGHLLOG",55,0)
 ;        Optional
"RTN","RGHLLOG",56,0)
 ;   RGDFN - IEN in the PATIENT file (#2)
"RTN","RGHLLOG",57,0)
 ;   MSGID - message id of the HL7 message where the exception was encountered (optional)
"RTN","RGHLLOG",58,0)
 ;   STATNUM - station # of site that encountered the error (optional) - if not defined then the local site is assumed, using $$SITE^VASITE
"RTN","RGHLLOG",59,0)
 ;
"RTN","RGHLLOG",60,0)
 I $L($G(HL("MID"))) Q:$$INVEXC(HL("MID"))  ; is the exception valid?
"RTN","RGHLLOG",61,0)
 N RGI,RGZ
"RTN","RGHLLOG",62,0)
 S U="^"
"RTN","RGHLLOG",63,0)
 S:RGEXC[U RGERR=$P(RGEXC,U,2,999),RGEXC=+RGEXC
"RTN","RGHLLOG",64,0)
 S:RGEXC'=+RGEXC RGERR=RGEXC,RGEXC=18
"RTN","RGHLLOG",65,0)
 S:'$D(^RGHL7(991.11,RGEXC)) RGEXC=18
"RTN","RGHLLOG",66,0)
 L +^RGHL7(991.11,RGEXC):10
"RTN","RGHLLOG",67,0)
 S RGZ=$G(^RGHL7(991.11,RGEXC,0))
"RTN","RGHLLOG",68,0)
 S:$L(RGZ) $P(^RGHL7(991.11,RGEXC,0),U,5)=$P(RGZ,U,5)+1
"RTN","RGHLLOG",69,0)
 S:$P(RGZ,U,2)>1 RGQUIT=1
"RTN","RGHLLOG",70,0)
 L -^RGHL7(991.11,RGEXC)
"RTN","RGHLLOG",71,0)
 S RGLOG=$$CREATE
"RTN","RGHLLOG",72,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",73,0)
 S RGI=$O(^RGHL7(991.1,RGLOG,1,$C(32)),-1)+1
"RTN","RGHLLOG",74,0)
 S RGERR=$E($G(RGERR),1,250)
"RTN","RGHLLOG",75,0)
 S DIC="^RGHL7(991.1,"_RGLOG_",1,"
"RTN","RGHLLOG",76,0)
 S X=RGI,DA(1)=RGLOG,DIC(0)="FL",DLAYGO=991.12,DIC("P")=$P(^DD(991.1,2,0),"^",2)
"RTN","RGHLLOG",77,0)
 D ^DIC
"RTN","RGHLLOG",78,0)
 S DIE=DIC
"RTN","RGHLLOG",79,0)
 K DIC,DA,DR,DLAYGO
"RTN","RGHLLOG",80,0)
 S STAT=0
"RTN","RGHLLOG",81,0)
 S DIC="3.8",DIC(0)="Z",X="MPIF EXCEPTIONS" D ^DIC K DIC
"RTN","RGHLLOG",82,0)
 S RGMG=$P($G(Y),"^",1)
"RTN","RGHLLOG",83,0)
 I $P(^RGHL7(991.11,RGEXC,0),U,4)=RGMG S STAT=1
"RTN","RGHLLOG",84,0)
 S DA(1)=RGLOG,DA=RGI,DR="2///"_$G(RGEXC)_";3///"_$G(RGDFN)_";6///"_$G(STAT)_";10///"_$G(RGERR)
"RTN","RGHLLOG",85,0)
 D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",86,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",87,0)
 S RGI=$P(RGZ,U,3),RGZ=$P(RGZ,U,4)
"RTN","RGHLLOG",88,0)
 ;
"RTN","RGHLLOG",89,0)
 ;If the action type is for the MPI Exception Handler, send exception to the handler and quit
"RTN","RGHLLOG",90,0)
 I (RGI=3) D SENDMPI^RGHLLOG1($G(RGEXC),$G(RGERR),$G(RGDFN),$G(MSGID),$G(STATNUM)) Q
"RTN","RGHLLOG",91,0)
 ;
"RTN","RGHLLOG",92,0)
 Q:'RGI!'RGZ
"RTN","RGHLLOG",93,0)
 ;quit and don't send messages for exception types that are now being
"RTN","RGHLLOG",94,0)
 ;handled through the CIRN Exception Handling option.
"RTN","RGHLLOG",95,0)
 Q:RGEXC=209!((RGEXC>212)&(RGEXC<219))
"RTN","RGHLLOG",96,0)
 S DIC="^XMB(3.8,",DIC(0)="NZ",X="`"_RGZ D ^DIC K DIC Q:+Y<1  S RGZ=$P(Y,U,2) K Y
"RTN","RGHLLOG",97,0)
 Q:RGZ=""!$P($G(^RGSITE("COR",1,0)),U,7)
"RTN","RGHLLOG",98,0)
 S RGERR=$$EXC^RGHLEXC(RGEXC,RGERR),RGZ="G."_RGZ
"RTN","RGHLLOG",99,0)
 I RGI=2 D ALERT^RGRSUTL2(RGERR,RGZ) Q
"RTN","RGHLLOG",100,0)
 D MAIL^RGRSUTL2(RGERR,RGZ,"CIRN Exception: "_$$EXC^RGHLEXC(RGEXC),"MPI/PD exception notification")
"RTN","RGHLLOG",101,0)
 Q
"RTN","RGHLLOG",102,0)
 ;
"RTN","RGHLLOG",103,0)
INVEXC(RGMID) ; determine if this exception needs to be sent to MPI/PD
"RTN","RGHLLOG",104,0)
 ; personnel via FORUM. Return 1 to avoid messaging to FORUM, else 0.
"RTN","RGHLLOG",105,0)
 ; IA#:3244 is applied in this functionality
"RTN","RGHLLOG",106,0)
 N RGFLG,RGIEN S RGFLG=1
"RTN","RGHLLOG",107,0)
 S RGIEN=$$IEN773(RGMID) Q:'RGIEN RGFLG
"RTN","RGHLLOG",108,0)
 S RGIEN("SND")=$$GET1^DIQ(773,RGIEN_",",13)
"RTN","RGHLLOG",109,0)
 S RGIEN("REC")=$$GET1^DIQ(773,RGIEN_",",14)
"RTN","RGHLLOG",110,0)
 ; check the sending application (fld:13, 0;11) & the receiving
"RTN","RGHLLOG",111,0)
 ; application (fld:14, 0;12) to see if they are related to the MPI/PD
"RTN","RGHLLOG",112,0)
 ; project.
"RTN","RGHLLOG",113,0)
 I RGIEN("SND")]""!(RGIEN("REC")]"") D  Q RGFLG
"RTN","RGHLLOG",114,0)
 .S RGFLG=$$APP(RGIEN("SND")) Q:'RGFLG
"RTN","RGHLLOG",115,0)
 .S RGFLG=$$APP(RGIEN("REC"))
"RTN","RGHLLOG",116,0)
 .Q
"RTN","RGHLLOG",117,0)
 ; Only if the sending/receiving applications cannot be determined from
"RTN","RGHLLOG",118,0)
 ; the data in their respective fields, do I check the MSH multiple for
"RTN","RGHLLOG",119,0)
 ; the MSH segment. I identify the sending/receiving application from
"RTN","RGHLLOG",120,0)
 ; this segment. 
"RTN","RGHLLOG",121,0)
 E  D
"RTN","RGHLLOG",122,0)
 .N RG,RG1,RGMSH
"RTN","RGHLLOG",123,0)
 .D GETS^DIQ(773,RGIEN_",",200,,"RGMSH") ;check MSH mult for snd/rec app
"RTN","RGHLLOG",124,0)
 .Q:'($D(RGMSH)\10)  ; no data in "MSH" multiple for file 773
"RTN","RGHLLOG",125,0)
 .S RGIEN=RGIEN_",",RG="RGMSH(773,"""_RGIEN_""","_200_")"
"RTN","RGHLLOG",126,0)
 .S RG1=0 F  S RG1=$O(@RG@(RG1)) Q:RG1'>0  D  Q:$E($G(@RG@(RG1)),1,3)="MSH"
"RTN","RGHLLOG",127,0)
 ..I $E($G(@RG@(RG1)),1,3)="MSH" D
"RTN","RGHLLOG",128,0)
 ...S RG(0)=$G(@RG@(RG1)),RGFS=$E(RG(0),4)
"RTN","RGHLLOG",129,0)
 ...S:$P(RG(0),RGFS,3)]"" RGFLG=$$APP($P(RG(0),RGFS,3)) Q:'RGFLG
"RTN","RGHLLOG",130,0)
 ...S:$P(RG(0),RGFS,5)]"" RGFLG=$$APP($P(RG(0),RGFS,5))
"RTN","RGHLLOG",131,0)
 ...Q
"RTN","RGHLLOG",132,0)
 ..Q
"RTN","RGHLLOG",133,0)
 .Q
"RTN","RGHLLOG",134,0)
 Q RGFLG
"RTN","RGHLLOG",135,0)
APP(X) ; check if the sending/receiving application is relevant to the
"RTN","RGHLLOG",136,0)
 ; MPI/PD team.  Returns 1 if a non-relevant namespace, else 0
"RTN","RGHLLOG",137,0)
 I $E(X,1,2)="RG"!($E(X,1,2)="VA")!($E(X,1,3)="MPI") Q 0
"RTN","RGHLLOG",138,0)
 Q 1
"RTN","RGHLLOG",139,0)
 ;
"RTN","RGHLLOG",140,0)
IEN773(RGMID) ; find the ien of the record in the HL7 MESSAGE ADMINISTRATION
"RTN","RGHLLOG",141,0)
 ; (#773) file based on the Message ID.  Input: Message ID
"RTN","RGHLLOG",142,0)
 ; Output: null, no record in 773, else 773 record ien.  IA#: 3244
"RTN","RGHLLOG",143,0)
 Q:$G(RGMID)="" ""
"RTN","RGHLLOG",144,0)
 Q $O(^HLMA("C",RGMID,0))
"RTN","RGHLLOG1")
0^3^B18066287
"RTN","RGHLLOG1",1,0)
RGHLLOG1 ;ALB/CJM-SEND EXCEPTION TO MPI EXCEPTION HANDLER ;11/25/2000
"RTN","RGHLLOG1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**13**;30 Apr 99
"RTN","RGHLLOG1",3,0)
 ;
"RTN","RGHLLOG1",4,0)
 ;Reference to file 870 supported by IA #3335
"RTN","RGHLLOG1",5,0)
 ;Reference to file 391.72 supported by IA #3037
"RTN","RGHLLOG1",6,0)
 ;References to file 773 supported by IA #3244 and 3273
"RTN","RGHLLOG1",7,0)
 ;
"RTN","RGHLLOG1",8,0)
SENDMPI(RGEXC,RGERR,RGDFN,MSGID,STATNUM) ;
"RTN","RGHLLOG1",9,0)
 ;Description: Sends the exception to the MPI Exception Handler.
"RTN","RGHLLOG1",10,0)
 ;Input: Required
"RTN","RGHLLOG1",11,0)
 ;  RGEXC - Exception type in File #991.11
"RTN","RGHLLOG1",12,0)
 ;  RGERR - Supplemental text
"RTN","RGHLLOG1",13,0)
 ;       Optional
"RTN","RGHLLOG1",14,0)
 ;  RGDFN - IEN in the PATIENT file (#2)
"RTN","RGHLLOG1",15,0)
 ;  MSGID - message id of message being processed when the exception occurred (optional), uses RGLOG(3) or HL("MID") if not defined
"RTN","RGHLLOG1",16,0)
 ;  STATNUM - station # of site that encountered the error (optional)
"RTN","RGHLLOG1",17,0)
 ;         If not defined then local site is assumed, using $$SITE^VASITE
"RTN","RGHLLOG1",18,0)
 ;Output: none
"RTN","RGHLLOG1",19,0)
 ;
"RTN","RGHLLOG1",20,0)
 ;Variables:
"RTN","RGHLLOG1",21,0)
 ;  @RGMSG is the location for the message text
"RTN","RGHLLOG1",22,0)
 ;
"RTN","RGHLLOG1",23,0)
 N RGMSG
"RTN","RGHLLOG1",24,0)
 S RGMSG="^TMP($J,""RG MPI SERVER EXCEPTION"")"
"RTN","RGHLLOG1",25,0)
 K @RGMSG
"RTN","RGHLLOG1",26,0)
 ;
"RTN","RGHLLOG1",27,0)
 D ADDLINE("**MPI/PD EXCEPTION**")
"RTN","RGHLLOG1",28,0)
 D ADDDATA("EXCEPTION TYPE",$G(RGEXC))
"RTN","RGHLLOG1",29,0)
 D ADDDATA("OPTIONAL TEXT",$G(RGERR))
"RTN","RGHLLOG1",30,0)
 D ADDDATA("SITE OF OCCURRENCE",$S($D(STATNUM):STATNUM,1:$P($$SITE^VASITE(),"^",3)))
"RTN","RGHLLOG1",31,0)
 D ADDDATA("SITE REPORTING",$P($$SITE^VASITE(),"^",3))
"RTN","RGHLLOG1",32,0)
 D ADDDATA("DATE/TIME REPORTED",$$NOW^XLFDT)
"RTN","RGHLLOG1",33,0)
 I $G(RGDFN) D
"RTN","RGHLLOG1",34,0)
 .N OUT,SITE
"RTN","RGHLLOG1",35,0)
 .D GETALL^RGFIU(RGDFN,.OUT)
"RTN","RGHLLOG1",36,0)
 .D ADDLINE("**PATIENT DATA**")
"RTN","RGHLLOG1",37,0)
 .D ADDDATA("ICN",OUT("ICN"))
"RTN","RGHLLOG1",38,0)
 .D ADDDATA("NAME",$$NAME^RGFIU(RGDFN))
"RTN","RGHLLOG1",39,0)
 .D ADDDATA("SSN",$$SSN^RGFIU(RGDFN))
"RTN","RGHLLOG1",40,0)
 .D ADDDATA("CMOR",OUT("CMOR"))
"RTN","RGHLLOG1",41,0)
 .S SITE=""
"RTN","RGHLLOG1",42,0)
 .F  S SITE=$O(OUT("TF",SITE)) Q:(SITE="")  D ADDLINE("**"),ADDDATA("TREATING FACILITY",SITE),ADDDATA("DATE LAST TREATED",OUT("TF",SITE,"LASTDATE")),ADDDATA("EVENT REASON",$$GETFIELD^RGFIU(391.72,.01,OUT("TF",SITE,"EVENT")))
"RTN","RGHLLOG1",43,0)
 K OUT
"RTN","RGHLLOG1",44,0)
 I $$GETMSG($G(MSGID),.OUT) D
"RTN","RGHLLOG1",45,0)
 .N SUB
"RTN","RGHLLOG1",46,0)
 .D ADDLINE("**HL7 MESSAGE**")
"RTN","RGHLLOG1",47,0)
 .S SUB=""
"RTN","RGHLLOG1",48,0)
 .F  S SUB=$O(OUT(SUB)) Q:(SUB="")  D ADDDATA(SUB,OUT(SUB))
"RTN","RGHLLOG1",49,0)
 D ADDLINE("**END**")
"RTN","RGHLLOG1",50,0)
 I $$MAIL
"RTN","RGHLLOG1",51,0)
 K @RGMSG
"RTN","RGHLLOG1",52,0)
 ;
"RTN","RGHLLOG1",53,0)
 Q
"RTN","RGHLLOG1",54,0)
 ;
"RTN","RGHLLOG1",55,0)
SERVER() ;
"RTN","RGHLLOG1",56,0)
 ;Description: Returns the <server name>@<server domain>. This entry
"RTN","RGHLLOG1",57,0)
 ;returns the Servers location either at the test MPI or Production MPI.
"RTN","RGHLLOG1",58,0)
 ;If a null is returned the MAIL subroutine will default to the MPIF
"RTN","RGHLLOG1",59,0)
 ;EXCEPTIONS mail group
"RTN","RGHLLOG1",60,0)
 ;
"RTN","RGHLLOG1",61,0)
 ;Input: none
"RTN","RGHLLOG1",62,0)
 ;Output: Where to send the exception.Returns the <server name>@<server domain> or Null
"RTN","RGHLLOG1",63,0)
 ;
"RTN","RGHLLOG1",64,0)
 N TO,IEN
"RTN","RGHLLOG1",65,0)
 S TO=""
"RTN","RGHLLOG1",66,0)
 ; get MPI logical link
"RTN","RGHLLOG1",67,0)
 D LINK^HLUTIL3("200M",.HLL,"I")
"RTN","RGHLLOG1",68,0)
 ; get MPI domain DBIA 3335
"RTN","RGHLLOG1",69,0)
 S IEN=$O(HLL(0)) I +IEN>0 S TO=$$GET1^DIQ(870,+IEN_",",.03) I TO'="" S TO="S.MPI EXCEPTION SERVER@"_TO
"RTN","RGHLLOG1",70,0)
 I TO="" D
"RTN","RGHLLOG1",71,0)
 . D EXC^RGHLLOG(224,"No MPI link identified in the HL LOGICAL LINK (#870) file.  Please check the MPI entry in the INSTITUTION (#2) file for a station # of 200M") D STOP^RGHLLOG(0)
"RTN","RGHLLOG1",72,0)
 Q TO
"RTN","RGHLLOG1",73,0)
 ;
"RTN","RGHLLOG1",74,0)
ADDDATA(LABEL,DATA) ;
"RTN","RGHLLOG1",75,0)
 ;Description: Adds one formated line to the message text containing the label and data value
"RTN","RGHLLOG1",76,0)
 ;Input:
"RTN","RGHLLOG1",77,0)
 ;  LABEL - text label that identifies the type of data
"RTN","RGHLLOG1",78,0)
 ;  DATA - data value
"RTN","RGHLLOG1",79,0)
 ;Output:none
"RTN","RGHLLOG1",80,0)
 ; 
"RTN","RGHLLOG1",81,0)
 D ADDLINE(LABEL_":"_DATA)
"RTN","RGHLLOG1",82,0)
 Q
"RTN","RGHLLOG1",83,0)
ADDLINE(LINE) ;
"RTN","RGHLLOG1",84,0)
 ;Description: adds one one to the message text
"RTN","RGHLLOG1",85,0)
 ;Inputs:
"RTN","RGHLLOG1",86,0)
 ;  LINE - the line of text to be added
"RTN","RGHLLOG1",87,0)
 ;  RGMSG - @RGMSG is the location for the message text
"RTN","RGHLLOG1",88,0)
 ;Output: none
"RTN","RGHLLOG1",89,0)
 S @RGMSG@(($O(@RGMSG@(9999),-1)+1))=LINE
"RTN","RGHLLOG1",90,0)
 Q
"RTN","RGHLLOG1",91,0)
MAIL() ;
"RTN","RGHLLOG1",92,0)
 ;Description: Sends the message located at @RGMSG to the MPI Exception Handler
"RTN","RGHLLOG1",93,0)
 ;Input: message at @RGMSG
"RTN","RGHLLOG1",94,0)
 ;Output: If succssful, the function returns the mailman message number, otherwise, "" is returned
"RTN","RGHLLOG1",95,0)
 ;
"RTN","RGHLLOG1",96,0)
 N XMY,XMSUB,XMDUZ,XMTEXT,XMZ,XMDUN,DIFROM,SERVER
"RTN","RGHLLOG1",97,0)
 Q:'$D(@RGMSG) ""
"RTN","RGHLLOG1",98,0)
 S SERVER=$$SERVER
"RTN","RGHLLOG1",99,0)
 ;if the MPI server isn't returned default to the old MPIF EXCEPTIONS mail group
"RTN","RGHLLOG1",100,0)
 I SERVER="" S SERVER="MPIF EXCEPTIONS"
"RTN","RGHLLOG1",101,0)
 S XMDUZ="MPI/PD at "_$P($$SITE^VASITE(),"^",2)
"RTN","RGHLLOG1",102,0)
 S XMY(.5)=""
"RTN","RGHLLOG1",103,0)
 S XMY(SERVER)=""
"RTN","RGHLLOG1",104,0)
 S XMTEXT=$P(RGMSG,")")_","
"RTN","RGHLLOG1",105,0)
 S XMSUB="MPI/PD EXCEPTION"
"RTN","RGHLLOG1",106,0)
 D ^XMD
"RTN","RGHLLOG1",107,0)
 Q $G(XMZ)
"RTN","RGHLLOG1",108,0)
 ;
"RTN","RGHLLOG1",109,0)
GETMSG(MSGID,MSGARRAY) ;
"RTN","RGHLLOG1",110,0)
 ;Description: Retrieves data from the HL7 Message Administration file (#773) related to the message
"RTN","RGHLLOG1",111,0)
 ;Input:
"RTN","RGHLLOG1",112,0)
 ;  MSGID - the message id (optional)
"RTN","RGHLLOG1",113,0)
 ;  RGLOG(3) - if MSGID is not passed then RGLOG(3) is used to determine the message
"RTN","RGHLLOG1",114,0)
 ;  HL("MID") - if MSGID and RGLOG(3) are not defined then HL("MID") is used to determine the message
"RTN","RGHLLOG1",115,0)
 ;
"RTN","RGHLLOG1",116,0)
 ;Output:
"RTN","RGHLLOG1",117,0)
 ;  Function Value - 1 on success, 0 on failure
"RTN","RGHLLOG1",118,0)
 ;  MSGARRAY() - (pass by reference) - returns the data
"RTN","RGHLLOG1",119,0)
 ;          ("MESSAGE ID") - the HL7 message id
"RTN","RGHLLOG1",120,0)
 ;          ("MESSAGE TYPE") - the HL7 message type
"RTN","RGHLLOG1",121,0)
 ;          ("EVENT TYPE") - the HL7 event type
"RTN","RGHLLOG1",122,0)
 ;          ("SENDING APPLICATION") - the name of the sending application
"RTN","RGHLLOG1",123,0)
 ;          ("LOGICAL LINK") - the name of the HL Logical Link overwhich the message was received
"RTN","RGHLLOG1",124,0)
 ;
"RTN","RGHLLOG1",125,0)
 N MSGIEN
"RTN","RGHLLOG1",126,0)
 K MSGARRAY
"RTN","RGHLLOG1",127,0)
 I '$G(MSGID) D
"RTN","RGHLLOG1",128,0)
 .I $G(RGLOG(3)) S MSGID=$$GETFIELD^RGFIU(773,2,RGLOG(3)) Q:MSGID
"RTN","RGHLLOG1",129,0)
 .S MSGID=$G(HL("MID"))
"RTN","RGHLLOG1",130,0)
 Q:'MSGID 0
"RTN","RGHLLOG1",131,0)
 ;
"RTN","RGHLLOG1",132,0)
 S MSGIEN=$$IEN773^RGHLLOG(MSGID)
"RTN","RGHLLOG1",133,0)
 ;
"RTN","RGHLLOG1",134,0)
 S MSGARRAY("MESSAGE ID")=MSGID
"RTN","RGHLLOG1",135,0)
 S MSGARRAY("LOGICAL LINK")=$$GETFIELD^RGFIU(773,7,MSGIEN,,1)
"RTN","RGHLLOG1",136,0)
 S MSGARRAY("SENDING APPLICATION")=$$GETFIELD^RGFIU(773,13,MSGIEN,,1)
"RTN","RGHLLOG1",137,0)
 S MSGARRAY("MESSAGE TYPE")=$$GETFIELD^RGFIU(773,15,MSGIEN,,1)
"RTN","RGHLLOG1",138,0)
 S MSGARRAY("EVENT TYPE")=$$GETFIELD^RGFIU(773,16,MSGIEN,,1)
"RTN","RGHLLOG1",139,0)
 ;
"RTN","RGHLLOG1",140,0)
 ;this compensates for a bug in the HL7 package - the external form rather than the pointer values are being stored in file 773
"RTN","RGHLLOG1",141,0)
 I MSGID,'$L(MSGARRAY("MESSAGE TYPE")) S MSGARRAY("MESSAGE TYPE")=$$GETFIELD^RGFIU(773,15,MSGIEN)
"RTN","RGHLLOG1",142,0)
 I MSGID,'$L(MSGARRAY("EVENT TYPE")) S MSGARRAY("EVENT TYPE")=$$GETFIELD^RGFIU(773,16,MSGIEN)
"RTN","RGHLLOG1",143,0)
 ;
"RTN","RGHLLOG1",144,0)
 Q 1
"RTN","RGP13ENV")
0^6^B8890414
"RTN","RGP13ENV",1,0)
RGP13ENV ;B'HAM/PTD-PATCH RG*1*13 ENVIRONMENT CHECK ROUTINE ;03/21/01
"RTN","RGP13ENV",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**13**;30 Apr 99
"RTN","RGP13ENV",3,0)
 ;Reference to LINK^HLUTIL3 and $$GET1^DIQ(870 supported by IA #3335
"RTN","RGP13ENV",4,0)
 ;Reference to $$FIND1^DIC(4.2, $$FIND1^DIC(4.21, $$GET1^DIQ(4.2 and
"RTN","RGP13ENV",5,0)
 ;$$GET1^DIQ(4.21 supported by IA #3100
"RTN","RGP13ENV",6,0)
 ;
"RTN","RGP13ENV",7,0)
 ;Ensure that patch XM*DBA*144 is in place for production account.
"RTN","RGP13ENV",8,0)
 ;
"RTN","RGP13ENV",9,0)
 N RGDOMAIN
"RTN","RGP13ENV",10,0)
 S RGDOMAIN=""
"RTN","RGP13ENV",11,0)
 ;Determine test or production account (production must have
"RTN","RGP13ENV",12,0)
 ;"MPI-AUSTIN.VA.GOV" domain for logical link "MPIVA").
"RTN","RGP13ENV",13,0)
 ;For production, check value of flags (#1) field in DOMAIN (#4.2) file.
"RTN","RGP13ENV",14,0)
 ;Also check for 'TCP/IP' transmission script (#4) and for that entry,
"RTN","RGP13ENV",15,0)
 ;check for the correct address (#1.4) and that there is no value in
"RTN","RGP13ENV",16,0)
 ;the out of service (#1.5) field.
"RTN","RGP13ENV",17,0)
 ;
"RTN","RGP13ENV",18,0)
 ;Get logical link IEN for "MPIVA".
"RTN","RGP13ENV",19,0)
DOMAIN ;Get domain for "MPIVA" logical link in HL LOGICAL LINK (#870) file.
"RTN","RGP13ENV",20,0)
 D LINK^HLUTIL3("200M",.HLL,"I")
"RTN","RGP13ENV",21,0)
 S IEN=$O(HLL(0)) I +IEN>0 S RGDOMAIN=$$GET1^DIQ(870,+IEN_",",.03)
"RTN","RGP13ENV",22,0)
 I RGDOMAIN'="" D
"RTN","RGP13ENV",23,0)
 .Q:RGDOMAIN'="MPI-AUSTIN.VA.GOV"  ;No check necessary - not production; quit.
"RTN","RGP13ENV",24,0)
 .I RGDOMAIN="MPI-AUSTIN.VA.GOV" D  ;Production account - confirm setup.
"RTN","RGP13ENV",25,0)
 ..S RGDIEN=$$FIND1^DIC(4.2,"","MX",RGDOMAIN) ;IEN in DOMAIN (#4.2) file.
"RTN","RGP13ENV",26,0)
 ..I RGDIEN'>0 S RGMSG(1)="",XPDQUIT=2 Q  ;DOMAIN not there; quit.
"RTN","RGP13ENV",27,0)
 ..;Else we have and IEN for MPI-AUSTIN.VA.GOV in the DOMAIN (#4.2) file.
"RTN","RGP13ENV",28,0)
 ..S RGFLAG=$$GET1^DIQ(4.2,RGDIEN,1) ;get value of FLAGS (#1) field.
"RTN","RGP13ENV",29,0)
 ..I RGFLAG'["S" S RGMSG(2)="",XPDQUIT=2 ;FLAGS (#1) field not correct.
"RTN","RGP13ENV",30,0)
 ..S RGTCPIP=$$FIND1^DIC(4.21,","_RGDIEN_",","BX","TCP/IP") ;IEN for TCP/IP.
"RTN","RGP13ENV",31,0)
 ..I RGTCPIP'>0 S RGMSG(3)="",XPDQUIT=2 Q  ;No 'TCP/IP' transmission script.
"RTN","RGP13ENV",32,0)
 ..;Else we have a 'TCP/IP' transmission script.
"RTN","RGP13ENV",33,0)
 ..S RGADDR=$$GET1^DIQ(4.21,RGTCPIP_","_RGDIEN,1.4) ;get value of NETWORK ADDRESS (MAILMAN HOST) (#1.4) field.
"RTN","RGP13ENV",34,0)
 ..I RGADDR'="152.125.191.142" S RGMSG(4)="",XPDQUIT=2 ;address not correct.
"RTN","RGP13ENV",35,0)
 ..;Else the address is correct.
"RTN","RGP13ENV",36,0)
 ..S RGOOS=$$GET1^DIQ(4.21,RGTCPIP_","_RGDIEN,1.5,"I") ;get value of OUT OF SERVICE (#1.5) field.
"RTN","RGP13ENV",37,0)
 ..I RGOOS=1 S RGMSG(5)="",XPDQUIT=2 ;transmission script out of service.
"RTN","RGP13ENV",38,0)
 ;
"RTN","RGP13ENV",39,0)
ERR ;If XPDQUIT has been set, print error message(s).
"RTN","RGP13ENV",40,0)
 I $D(XPDQUIT) W ! S MSG=0 F  S MSG=$O(RGMSG(MSG)) Q:'MSG  D  W !
"RTN","RGP13ENV",41,0)
 .I MSG=1 W !," No DOMAIN entry found for "_RGDOMAIN_"."
"RTN","RGP13ENV",42,0)
 .I MSG=2 W !," FLAG (#1) field is not set to 'S' for "_RGDOMAIN_"."
"RTN","RGP13ENV",43,0)
 .I MSG=3 W !," No 'TCP/IP' transmission script found for "_RGDOMAIN_"."
"RTN","RGP13ENV",44,0)
 .I MSG=4 W !," The TCP/IP address for "_RGDOMAIN_" should be 152.125.191.142."
"RTN","RGP13ENV",45,0)
 .I MSG=5 W !," The OUT OF SERVICE (#1.5) field should not be set for "_RGDOMAIN_"."
"RTN","RGP13ENV",46,0)
 ;
"RTN","RGP13ENV",47,0)
 I '$D(XPDQUIT) W !!,"Environment check is ok.",!
"RTN","RGP13ENV",48,0)
 K DIC,HLL,IEN,MSG,RGADDR,RGDIEN,RGDOMAIN,RGFLAG,RGMSG,RGOOS,RGTCPIP,X,Y
"RTN","RGP13ENV",49,0)
 Q
"RTN","RGP13ENV",50,0)
 ;
"RTN","RGP13PST")
0^5^B492074
"RTN","RGP13PST",1,0)
RGP13PST ;ALB/CJM-RG*1*13 PATCH POST INSTALL ROUTINE ;12/17/2000
"RTN","RGP13PST",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**13**;30 Apr 99
"RTN","RGP13PST",3,0)
 ;
"RTN","RGP13PST",4,0)
ACTION ;Change action for exceptions 1,6,7
"RTN","RGP13PST",5,0)
 N EXCEPT
"RTN","RGP13PST",6,0)
 F EXCEPT=1,6,7,200:1:208,210,211,212,219:1:224,226,228:1:232 D
"RTN","RGP13PST",7,0)
 .N DIE,DIC,DR,DA,Y,D0
"RTN","RGP13PST",8,0)
 .S DIC="^RGHL7(991.11,",DIC(0)="XQZ",X=EXCEPT
"RTN","RGP13PST",9,0)
 .D ^DIC
"RTN","RGP13PST",10,0)
 .Q:+Y<0
"RTN","RGP13PST",11,0)
 .L +^RGHL7(991.11,EXCEPT):10
"RTN","RGP13PST",12,0)
 .S DA=+Y,DIE="^RGHL7(991.11,",DR="2////3"
"RTN","RGP13PST",13,0)
 .D ^DIE
"RTN","RGP13PST",14,0)
 .L -^RGHL7(991.11,EXCEPT)
"RTN","RGP13PST",15,0)
 K DA,DIC,DIE,DR,EXCEPT,X,Y
"RTN","RGP13PST",16,0)
 Q
"VER")
8.0^22.0
"^DD",991.11,991.11,0)
FIELD^^99^8
"^DD",991.11,991.11,0,"DDA")
N
"^DD",991.11,991.11,0,"DT")
3001127
"^DD",991.11,991.11,0,"ID",10)
W:$D(^(10)) "   ",$E(^(10),1,100)
"^DD",991.11,991.11,0,"IX","B",991.11,.01)

"^DD",991.11,991.11,0,"IX","C",991.11,10)

"^DD",991.11,991.11,0,"NM","CIRN HL7 EXCEPTION TYPE")

"^DD",991.11,991.11,0,"PT",991.12,2)

"^DD",991.11,991.11,0,"VRPK")
RG
"^DD",991.11,991.11,.01,0)
NUMBER^RNJ12,0X^^0;1^K:X'=X\1!(X<1) X S:$D(X) DINUM=X
"^DD",991.11,991.11,.01,1,0)
^.1
"^DD",991.11,991.11,.01,1,1,0)
991.11^B
"^DD",991.11,991.11,.01,1,1,1)
S ^RGHL7(991.11,"B",$E(X,1,30),DA)=""
"^DD",991.11,991.11,.01,1,1,2)
K ^RGHL7(991.11,"B",$E(X,1,30),DA)
"^DD",991.11,991.11,.01,3)
Index of this exception.
"^DD",991.11,991.11,.01,21,0)
^^1^1^2990308^^
"^DD",991.11,991.11,.01,21,1,0)
This is the index number of this exception.
"^DD",991.11,991.11,.01,"DT")
2970201
"^DD",991.11,991.11,1,0)
SEVERITY^S^0:INFORMATIONAL;1:MINOR;2:SEVERE;^0;2^Q
"^DD",991.11,991.11,1,3)
Severity level of this exception.
"^DD",991.11,991.11,1,21,0)
^^2^2^2990308^^
"^DD",991.11,991.11,1,21,1,0)
This is the severity level of this exception, '0' for Informational,
"^DD",991.11,991.11,1,21,2,0)
'1' for Minor or '2' for Severe.
"^DD",991.11,991.11,1,"DT")
2970201
"^DD",991.11,991.11,2,0)
ACTION^S^0:NONE;1:MAIL;2:ALERT;3:MPI EXCEPTION HANDLER;^0;3^Q
"^DD",991.11,991.11,2,3)
Action to be taken upon logging this exception.
"^DD",991.11,991.11,2,21,0)
^^5^5^3001127^^^
"^DD",991.11,991.11,2,21,1,0)
This is the action to be taken upon logging this exception,
"^DD",991.11,991.11,2,21,2,0)
'0' for None, '1' for Mail, '2' for Alert, or '3' for MPI
"^DD",991.11,991.11,2,21,3,0)
Exception Handler. Exceptions whose action is MPI Exception
"^DD",991.11,991.11,2,21,4,0)
Handler go to the exception handler located at the Austin
"^DD",991.11,991.11,2,21,5,0)
MPI.
"^DD",991.11,991.11,2,"DT")
3001127
"^DD",991.11,991.11,3,0)
COUNT^NJ12,0X^^0;5^K:X\1'=X!(X<0) X
"^DD",991.11,991.11,3,3)
Total number of exceptions logged with this type.
"^DD",991.11,991.11,3,21,0)
^^1^1^2990308^^
"^DD",991.11,991.11,3,21,1,0)
This is a count of all exceptions logged of this type.
"^DD",991.11,991.11,3,"DT")
2970317
"^DD",991.11,991.11,6,0)
MAIL GROUP^P3.8'^XMB(3.8,^0;4^Q
"^DD",991.11,991.11,6,3)
Mail group to which notification will be sent for alert and mail action types.
"^DD",991.11,991.11,6,21,0)
^^3^3^2990308^^
"^DD",991.11,991.11,6,21,1,0)
This is a pointer to the MAIL GROUP file (#3.8), indicating
"^DD",991.11,991.11,6,21,2,0)
which mail group a notification will be sent to for alert
"^DD",991.11,991.11,6,21,3,0)
and mail action types.
"^DD",991.11,991.11,6,"DT")
2970201
"^DD",991.11,991.11,10,0)
TEXT^F^^10;E1,100^K:$L(X)>100!($L(X)<1) X
"^DD",991.11,991.11,10,1,0)
^.1
"^DD",991.11,991.11,10,1,1,0)
991.11^C
"^DD",991.11,991.11,10,1,1,1)
S ^RGHL7(991.11,"C",$E(X,1,30),DA)=""
"^DD",991.11,991.11,10,1,1,2)
K ^RGHL7(991.11,"C",$E(X,1,30),DA)
"^DD",991.11,991.11,10,1,1,"DT")
2970201
"^DD",991.11,991.11,10,3)
Text message for this exception.
"^DD",991.11,991.11,10,21,0)
^^2^2^2990308^^
"^DD",991.11,991.11,10,21,1,0)
This is a free text field (up to 100 characters) which holds the
"^DD",991.11,991.11,10,21,2,0)
message for this exception.
"^DD",991.11,991.11,10,"DT")
2970201
"^DD",991.11,991.11,20,0)
SECURITY KEY^991.112P^^20;0
"^DD",991.11,991.11,20,21,0)
^^4^4^2990308^^^
"^DD",991.11,991.11,20,21,1,0)
This is used to control access to a particular exception type. 
"^DD",991.11,991.11,20,21,2,0)
A user must possess at least one of the listed security keys to 
"^DD",991.11,991.11,20,21,3,0)
access the associated exception.  If no security keys are listed, 
"^DD",991.11,991.11,20,21,4,0)
access is unrestricted.
"^DD",991.11,991.11,99,0)
DESCRIPTION^991.1199^^99;0
"^DD",991.11,991.11,99,21,0)
^^2^2^2990308^^^
"^DD",991.11,991.11,99,21,1,0)
This is a word-processing field used for storing
"^DD",991.11,991.11,99,21,2,0)
the detailed explanation of this exception type.
"^DD",991.11,991.112,0)
SECURITY KEY SUB-FIELD^^.01^1
"^DD",991.11,991.112,0,"DT")
2980721
"^DD",991.11,991.112,0,"IX","B",991.112,.01)

"^DD",991.11,991.112,0,"NM","SECURITY KEY")

"^DD",991.11,991.112,0,"UP")
991.11
"^DD",991.11,991.112,.01,0)
SECURITY KEY^MP19.1'X^DIC(19.1,^0;1^S DINUM=X
"^DD",991.11,991.112,.01,1,0)
^.1
"^DD",991.11,991.112,.01,1,1,0)
991.112^B
"^DD",991.11,991.112,.01,1,1,1)
S ^RGHL7(991.11,DA(1),20,"B",$E(X,1,30),DA)=""
"^DD",991.11,991.112,.01,1,1,2)
K ^RGHL7(991.11,DA(1),20,"B",$E(X,1,30),DA)
"^DD",991.11,991.112,.01,3)
Enter a security key to control access to this exception.
"^DD",991.11,991.112,.01,21,0)
^^4^4^2990308^^
"^DD",991.11,991.112,.01,21,1,0)
This is used to control access to a particular exception type. 
"^DD",991.11,991.112,.01,21,2,0)
A user must possess at least one of the listed security keys to 
"^DD",991.11,991.112,.01,21,3,0)
access the associated exception.  If no security keys are listed, 
"^DD",991.11,991.112,.01,21,4,0)
access is unrestricted.
"^DD",991.11,991.112,.01,"DT")
2980721
"^DD",991.11,991.1199,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",991.11,991.1199,0,"DT")
2970201
"^DD",991.11,991.1199,0,"NM","DESCRIPTION")

"^DD",991.11,991.1199,0,"UP")
991.11
"^DD",991.11,991.1199,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",991.11,991.1199,.01,3)
Detailed explanation of this exception.
"^DD",991.11,991.1199,.01,21,0)
^^1^1^2990308^^^
"^DD",991.11,991.1199,.01,21,1,0)
This field holds the detailed explanation of this exception.
"^DD",991.11,991.1199,.01,"DT")
2970201
"^DIC",991.11,991.11,0)
CIRN HL7 EXCEPTION TYPE^991.11
"^DIC",991.11,991.11,0,"GL")
^RGHL7(991.11,
"^DIC",991.11,991.11,"%D",0)
^^3^3^2990308^^
"^DIC",991.11,991.11,"%D",1,0)
This file holds the CIRN HL7 exception types.  It is pointed to by
"^DIC",991.11,991.11,"%D",2,0)
the TYPE field (#2) for the EXCEPTION subfield (#991.12) of the CIRN
"^DIC",991.11,991.11,"%D",3,0)
HL7 EXCEPTION LOG file (#991.1).
"^DIC",991.11,"B","CIRN HL7 EXCEPTION TYPE",991.11)

**END**
**END**
