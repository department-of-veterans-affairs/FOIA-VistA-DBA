Released GMRV*5*2 SEQ #3
Extracted from mail message
**KIDS**:GMRV*5.0*2^

**INSTALL NAME**
GMRV*5.0*2
"BLD",4405,0)
GMRV*5.0*2^GEN. MED. REC. - VITALS^0^3041220^y
"BLD",4405,1,0)
^^2^2^3041220^^^
"BLD",4405,1,1,0)
Please read the GMRV*5*2 patch description on FORUM for an explanation of
"BLD",4405,1,2,0)
what this patch does.
"BLD",4405,4,0)
^9.64PA^^0
"BLD",4405,"ABNS",0)
^9.66A^^
"BLD",4405,"ABPKG")
^n
"BLD",4405,"INIT")
GMV2PST
"BLD",4405,"KRN",0)
^9.67PA^8989.52^19
"BLD",4405,"KRN",.4,0)
.4
"BLD",4405,"KRN",.401,0)
.401
"BLD",4405,"KRN",.402,0)
.402
"BLD",4405,"KRN",.403,0)
.403
"BLD",4405,"KRN",.5,0)
.5
"BLD",4405,"KRN",.84,0)
.84
"BLD",4405,"KRN",3.6,0)
3.6
"BLD",4405,"KRN",3.8,0)
3.8
"BLD",4405,"KRN",9.2,0)
9.2
"BLD",4405,"KRN",9.8,0)
9.8
"BLD",4405,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4405,"KRN",9.8,"NM",1,0)
GMV2PST^^0^B11190458
"BLD",4405,"KRN",9.8,"NM",2,0)
GMVHDR^^0^B10470656
"BLD",4405,"KRN",9.8,"NM",3,0)
GMRVED2^^0^B30554834
"BLD",4405,"KRN",9.8,"NM","B","GMRVED2",3)
 
"BLD",4405,"KRN",9.8,"NM","B","GMV2PST",1)
 
"BLD",4405,"KRN",9.8,"NM","B","GMVHDR",2)
 
"BLD",4405,"KRN",19,0)
19
"BLD",4405,"KRN",19.1,0)
19.1
"BLD",4405,"KRN",101,0)
101
"BLD",4405,"KRN",409.61,0)
409.61
"BLD",4405,"KRN",771,0)
771
"BLD",4405,"KRN",870,0)
870
"BLD",4405,"KRN",8989.51,0)
8989.51
"BLD",4405,"KRN",8989.52,0)
8989.52
"BLD",4405,"KRN",8994,0)
8994
"BLD",4405,"KRN","B",.4,.4)
 
"BLD",4405,"KRN","B",.401,.401)
 
"BLD",4405,"KRN","B",.402,.402)
 
"BLD",4405,"KRN","B",.403,.403)
 
"BLD",4405,"KRN","B",.5,.5)
 
"BLD",4405,"KRN","B",.84,.84)
 
"BLD",4405,"KRN","B",3.6,3.6)
 
"BLD",4405,"KRN","B",3.8,3.8)
 
"BLD",4405,"KRN","B",9.2,9.2)
 
"BLD",4405,"KRN","B",9.8,9.8)
 
"BLD",4405,"KRN","B",19,19)
 
"BLD",4405,"KRN","B",19.1,19.1)
 
"BLD",4405,"KRN","B",101,101)
 
"BLD",4405,"KRN","B",409.61,409.61)
 
"BLD",4405,"KRN","B",771,771)
 
"BLD",4405,"KRN","B",870,870)
 
"BLD",4405,"KRN","B",8989.51,8989.51)
 
"BLD",4405,"KRN","B",8989.52,8989.52)
 
"BLD",4405,"KRN","B",8994,8994)
 
"BLD",4405,"QUES",0)
^9.62^^
"BLD",4405,"REQB",0)
^9.611^1^1
"BLD",4405,"REQB",1,0)
GMRV*5.0*1^2
"BLD",4405,"REQB","B","GMRV*5.0*1",1)
 
"INIT")
GMV2PST
"MBREQ")
0
"PKG",44,-1)
1^1
"PKG",44,0)
GEN. MED. REC. - VITALS^GMRV^Vitals/Measurements Module of General Medical Record.
"PKG",44,20,0)
^9.402P^^
"PKG",44,22,0)
^9.49I^1^1
"PKG",44,22,1,0)
5.0^3021029
"PKG",44,22,1,"PAH",1,0)
2^3041220^547
"PKG",44,22,1,"PAH",1,1,0)
^^2^2^3041220
"PKG",44,22,1,"PAH",1,1,1,0)
Please read the GMRV*5*2 patch description on FORUM for an explanation of
"PKG",44,22,1,"PAH",1,1,2,0)
what this patch does.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","GMRVED2")
0^3^B30554834
"RTN","GMRVED2",1,0)
GMRVED2 ;HIOFO/RM,YH,FT-VITAL SIGNS EDIT SHORT FORM ;11/15/04  10:30
"RTN","GMRVED2",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**2**;Oct 31, 2002
"RTN","GMRVED2",3,0)
 ;
"RTN","GMRVED2",4,0)
 ; This routine uses the following IAs:
"RTN","GMRVED2",5,0)
 ; #10035 - ^DPT( references       (supported)
"RTN","GMRVED2",6,0)
 ; #10061 - ^VADPT calls           (supported)
"RTN","GMRVED2",7,0)
 ; #10103 - ^XLFDT calls           (supported)
"RTN","GMRVED2",8,0)
 ; #10104 - ^XLFSTR calls          (supported)
"RTN","GMRVED2",9,0)
 ; 
"RTN","GMRVED2",10,0)
EN1 ; SORT PATIENTS ON WARD
"RTN","GMRVED2",11,0)
 K ^TMP($J)
"RTN","GMRVED2",12,0)
WSA1 ; SET ^TMP($J, FOR SORT
"RTN","GMRVED2",13,0)
 D DEM^VADPT,INP^VADPT S GMRRMBD=$S(VAIN(5)'="":VAIN(5),1:"  BLANK"),GMRNAM=$S(VADM(1)'="":VADM(1),1:"  BLANK") D KVAR^VADPT K VA
"RTN","GMRVED2",14,0)
 S:$S("Aa"[GMREDB:1,$D(GMRROOM($P(GMRRMBD,"-"))):1,1:0) ^TMP($J,GMRRMBD,GMRNAM,DFN)=""
"RTN","GMRVED2",15,0)
 S DFN=$O(^DPT("CN",GMRWARD(1),DFN))
"RTN","GMRVED2",16,0)
 Q:DFN=""  G WSA1
"RTN","GMRVED2",17,0)
EN2 ; BEGIN EDITING WARD VITALS
"RTN","GMRVED2",18,0)
 I $O(^TMP($J,0))="" S GMROUT=1 Q
"RTN","GMRVED2",19,0)
 W !,"Begin entering patient vitals." S GMRDT0=GMRVIDT
"RTN","GMRVED2",20,0)
 S GMRRMBD="" F GMRI=0:0 S GMRRMBD=$O(^TMP($J,GMRRMBD)) Q:GMRRMBD=""!GMROUT  S GMRNAM="" F GMRI=0:0 S GMRNAM=$O(^TMP($J,GMRRMBD,GMRNAM)) Q:GMRNAM=""!GMROUT  F DFN=0:0 S DFN=$O(^TMP($J,GMRRMBD,GMRNAM,DFN)) Q:DFN'>0  D V1 Q:GMROUT
"RTN","GMRVED2",21,0)
 W !,"Enter return to continue" R X:DTIME Q
"RTN","GMRVED2",22,0)
V1 ;
"RTN","GMRVED2",23,0)
 W !!,$S(GMRNAM'="  BLANK":GMRNAM,1:DFN),?$X+10,$S(GMRRMBD'="  BLANK":GMRRMBD,1:""),"  OK? YES// " R GMRX:DTIME
"RTN","GMRVED2",24,0)
 I GMRX="^"!('$T) S GMROUT=1 Q
"RTN","GMRVED2",25,0)
 S GMRX=$$UP^XLFSTR(GMRX) I ((GMRX="")!($E(GMRX)="Y")) K GMRTO S GDT=GMRVIDT D EN1^GMRVADM G:GMROUT&'$D(GMRTO) V2 D EN2^GMRVED3 G:GMROUT&'$D(GMRTO) V2 Q
"RTN","GMRVED2",26,0)
 G:GMRX?1"N".E V2
"RTN","GMRVED2",27,0)
 W !,"ANSWER YES OR NO" G V1
"RTN","GMRVED2",28,0)
V2 ;
"RTN","GMRVED2",29,0)
 W !!,"Do you wish to stop looping through names? YES//" R GMRX:DTIME
"RTN","GMRVED2",30,0)
 S GMRX=$$UP^XLFSTR(GMRX) I (('$T)!(GMRX="")!($E(GMRX)="Y")!(GMRX="^")) S GMROUT=1 Q
"RTN","GMRVED2",31,0)
 I GMRX?1"N".E S GMROUT=0 Q
"RTN","GMRVED2",32,0)
 W !,"ANSWER YES OR NO" G V2
"RTN","GMRVED2",33,0)
EN4 ; ENTRY FROM GMRVED0 TO ADD THE PATIENT DATA TO THE 120.5 FILE
"RTN","GMRVED2",34,0)
 D NOW^%DTC S GMRDATE=%
"RTN","GMRVED2",35,0)
 F GMRX=2:1:$L(GMRSTR(0),";")-1 S GMRVITY=$P(GMRSTR(0),";",GMRX) D
"RTN","GMRVED2",36,0)
 . S GMRVIT=$S(GMRVITY="T":"TEMPERATURE",GMRVITY="P":"PULSE",GMRVITY="R":"RESPIRATION",GMRVITY="BP":"BLOOD PRESSURE",GMRVITY="HT":"HEIGHT",GMRVITY="CG":"CIRCUMFERENCE/GIRTH",1:"")
"RTN","GMRVED2",37,0)
 . S:GMRVIT="" GMRVIT=$S(GMRVITY="WT":"WEIGHT",GMRVITY="CVP":"CENTRAL VENOUS PRESSURE",GMRVITY="PO2":"PULSE OXIMETRY",GMRVITY="PN":"PAIN",1:"")
"RTN","GMRVED2",38,0)
 . D:$G(GMRDAT(GMRVITY))'=""&(GMRVIT'="") ADDNODE
"RTN","GMRVED2",39,0)
 Q
"RTN","GMRVED2",40,0)
ADDNODE ; add data to the 120.5 file
"RTN","GMRVED2",41,0)
 N GMVDTDUN,GMVFDA,GMVIEN
"RTN","GMRVED2",42,0)
 S GMVDTDUN=GMRVIDT
"RTN","GMRVED2",43,0)
 S GMRVIT(1)=$O(^GMRD(120.51,"B",GMRVIT,0))
"RTN","GMRVED2",44,0)
 S GMVDTDUN=$$CHKDT(GMRVIDT,GMRVIT(1))
"RTN","GMRVED2",45,0)
 S GMVFDA(120.5,"+1,",.01)=GMVDTDUN ;Date/Time
"RTN","GMRVED2",46,0)
 S GMVFDA(120.5,"+1,",.02)=DFN ;Patient
"RTN","GMRVED2",47,0)
 S GMVFDA(120.5,"+1,",.03)=GMRVIT(1) ;Vital Type
"RTN","GMRVED2",48,0)
 S GMVFDA(120.5,"+1,",.04)=GMRDATE ;Date Time entered
"RTN","GMRVED2",49,0)
 S GMVFDA(120.5,"+1,",.05)=GMRVHLOC ;Hospital
"RTN","GMRVED2",50,0)
 S GMVFDA(120.5,"+1,",.06)=DUZ ;Entered by (DUZ)
"RTN","GMRVED2",51,0)
 S GMVFDA(120.5,"+1,",1.2)=GMRDAT(GMRVITY) ;Rate
"RTN","GMRVED2",52,0)
 S GMVFDA(120.5,"+1,",1.4)=$G(GMRO2(GMRVITY)) ;Sup 02
"RTN","GMRVED2",53,0)
 S GMVIEN=""
"RTN","GMRVED2",54,0)
 D UPDATE^DIE("","GMVFDA","GMVIEN")
"RTN","GMRVED2",55,0)
 ;file any qualifiers
"RTN","GMRVED2",56,0)
 I $D(GMRSITE(GMRVITY))!$D(GMRINF(GMRVITY)) D
"RTN","GMRVED2",57,0)
 .I $G(GMRSITE(GMRVITY))'="" D
"RTN","GMRVED2",58,0)
 ..S GDATA=+$P(GMRSITE(GMRVITY),U,2)
"RTN","GMRVED2",59,0)
 ..Q:'GDATA
"RTN","GMRVED2",60,0)
 ..D ADDQUAL(GMVIEN(1)_"^"_GDATA)
"RTN","GMRVED2",61,0)
 ..Q
"RTN","GMRVED2",62,0)
 .I $D(GMRINF(GMRVITY)) D
"RTN","GMRVED2",63,0)
 ..S I=0
"RTN","GMRVED2",64,0)
 ..F  S I=$O(GMRINF(GMRVITY,I)) Q:I'>0  D
"RTN","GMRVED2",65,0)
 ...S I(1)=""
"RTN","GMRVED2",66,0)
 ...F  S I(1)=$O(GMRINF(GMRVITY,I,I(1))) Q:I(1)=""  D
"RTN","GMRVED2",67,0)
 ....S GDATA=+$P(GMRINF(GMRVITY,I,I(1)),"^")
"RTN","GMRVED2",68,0)
 ....Q:'GDATA
"RTN","GMRVED2",69,0)
 ....D ADDQUAL(GMVIEN(1)_"^"_GDATA)
"RTN","GMRVED2",70,0)
 ....Q
"RTN","GMRVED2",71,0)
 ...Q
"RTN","GMRVED2",72,0)
 ..Q
"RTN","GMRVED2",73,0)
 .Q
"RTN","GMRVED2",74,0)
 S DA=+GMVIEN(1)
"RTN","GMRVED2",75,0)
 I GMREDB="P1" S GMRVIEN(GMRVITY)=DA_"^"_GMRDAT(GMRVITY)_"^"_$G(GMRSITE(GMRVITY))
"RTN","GMRVED2",76,0)
 S:GMRENTY>4 GLAST=GMRVIDT,GLAST(1)=$G(GLAST(1))+1
"RTN","GMRVED2",77,0)
 Q
"RTN","GMRVED2",78,0)
XREF(DA) ; Set cross-references for FILE 120.5 entry
"RTN","GMRVED2",79,0)
 ; Execute SET logic only.  Set's all cross-references for this entry.
"RTN","GMRVED2",80,0)
 ; DA is the record number
"RTN","GMRVED2",81,0)
 N DIC,DIK,X,Y
"RTN","GMRVED2",82,0)
 Q:'DA
"RTN","GMRVED2",83,0)
 S DIK="^GMR(120.5,"
"RTN","GMRVED2",84,0)
 D IX1^DIK
"RTN","GMRVED2",85,0)
 Q
"RTN","GMRVED2",86,0)
XREF1(DA) ; Set cross-references for FILE 120.5 entry
"RTN","GMRVED2",87,0)
 ; Execute SET logic only.  Set's all cross-references for this entry.
"RTN","GMRVED2",88,0)
 ; DA is the record number
"RTN","GMRVED2",89,0)
 N DIC,DIK,GMRVDA,GMRVIEN,X,Y
"RTN","GMRVED2",90,0)
 Q:'DA
"RTN","GMRVED2",91,0)
 S GMRVIEN=0,GMRVDA=DA
"RTN","GMRVED2",92,0)
 F  S GMRVIEN=$O(^GMR(120.5,GMRVDA,5,GMRVIEN)) Q:'GMRVIEN  D
"RTN","GMRVED2",93,0)
 .S DA(1)=GMRVDA,DA=GMRVIEN
"RTN","GMRVED2",94,0)
 .S DIK="^GMR(120.5,DA(1),5,"
"RTN","GMRVED2",95,0)
 .D IX1^DIK
"RTN","GMRVED2",96,0)
 .Q
"RTN","GMRVED2",97,0)
 Q
"RTN","GMRVED2",98,0)
SETPRMT ; SET VITAL TYPE PATTERN MATCH
"RTN","GMRVED2",99,0)
 S G=$P(GMRSTR(0),";",GMRX)
"RTN","GMRVED2",100,0)
 S GMRHELP=GMRHELP_$S(G="P":"PPP",G="WT":"WWW.WW",G="R":"RR",G="CG":"NNN.NN",G="CVP":"NN",G="PO2":"NNN",G="HT":"HH",G="BP":"BBB/BBB/BBB (or BBB/BBB)",G="T":"TTT.T",G="PN":"NN",1:"")_$S(GMRX'=($L(GMRSTR(0),";")-1):"-",1:"")
"RTN","GMRVED2",101,0)
 S GMRHELP(1)=GMRHELP(1)_$S(GMRHELP(1)'="":",",1:"")_$P(GMRSTR(0),";",GMRX)_"^GMRVUT1"
"RTN","GMRVED2",102,0)
 S GMRPRMT=GMRPRMT_$S(G="T":"Temp",G="P":"Pulse",G="WT":"Wt.",G="R":"Resp",G="HT":"Ht.",G="BP":"BP",G="CG":"Circumference/Girth",G="CVP":"CVP",G="PO2":"PO2",G="PN":"Pain",1:"")_$S(GMRX'=($L(GMRSTR(0),";")-1):"-",1:"")
"RTN","GMRVED2",103,0)
 Q
"RTN","GMRVED2",104,0)
CHKDT(GMVDT,GMVSAV) ;Check if there is an entry for that date & time
"RTN","GMRVED2",105,0)
 N GMVA,GMVTY
"RTN","GMRVED2",106,0)
 S GMVA=0
"RTN","GMRVED2",107,0)
 F  S GMVA=$O(^GMR(120.5,"B",GMVDT,GMVA)) Q:'GMVA  D
"RTN","GMRVED2",108,0)
 .I DFN'=$P($G(^GMR(120.5,GMVA,0)),U,2) Q
"RTN","GMRVED2",109,0)
 .S GMVTY=$P($G(^GMR(120.5,GMVA,0)),"^",3)
"RTN","GMRVED2",110,0)
 .I GMVTY=GMVSAV D
"RTN","GMRVED2",111,0)
 ..S GMVDT=$$FMADD^XLFDT(GMVDT,"","","",1)
"RTN","GMRVED2",112,0)
 ..Q
"RTN","GMRVED2",113,0)
 .Q
"RTN","GMRVED2",114,0)
 Q GMVDT
"RTN","GMRVED2",115,0)
 ;
"RTN","GMRVED2",116,0)
ADDQUAL(GMRVDATA) ; Add qualifiers to FILE 120.5 entry
"RTN","GMRVED2",117,0)
 ; ADD QUALIFIER TO 120.505 SUBFILE
"RTN","GMRVED2",118,0)
 ; Input:
"RTN","GMRVED2",119,0)
 ;    GMRVDATA=120.5 IEN^QUALIFIER (120.52) IEN
"RTN","GMRVED2",120,0)
 ;
"RTN","GMRVED2",121,0)
 N GMVCNT,GMVERR,GMVFDA,GMVOKAY,GMRVIEN,GMRVQUAL
"RTN","GMRVED2",122,0)
 S GMRVIEN=+$P(GMRVDATA,"^",1) ;File 120.5 ien
"RTN","GMRVED2",123,0)
 S GMRVQUAL=+$P(GMRVDATA,"^",2) ;File 120.52 ien
"RTN","GMRVED2",124,0)
 ; Does File 120.5 entry exist?
"RTN","GMRVED2",125,0)
 I '$D(^GMR(120.5,GMRVIEN,0)) Q
"RTN","GMRVED2",126,0)
 ; Is the qualifier already stored?
"RTN","GMRVED2",127,0)
 I $O(^GMR(120.5,GMRVIEN,5,"B",GMRVQUAL,0))>0 Q
"RTN","GMRVED2",128,0)
 ; Legitimate Qualifier?
"RTN","GMRVED2",129,0)
 I '$D(^GMRD(120.52,GMRVQUAL,0)) Q
"RTN","GMRVED2",130,0)
 S GMVCNT=0 ;counter for number of tries to lock an entry
"RTN","GMRVED2",131,0)
B2 ; Lock the entry
"RTN","GMRVED2",132,0)
 I GMVCNT>3 Q  ;4 strikes and you're out
"RTN","GMRVED2",133,0)
 L +^GMR(120.5,GMRVIEN,0):1
"RTN","GMRVED2",134,0)
 S GMVCNT=GMVCNT+1
"RTN","GMRVED2",135,0)
 I '$T L -^GMR(120.5,GMRVIEN,0) G B2
"RTN","GMRVED2",136,0)
 ; Store the  qualifier
"RTN","GMRVED2",137,0)
 S GMVFDA(120.505,"+1,"_GMRVIEN_",",.01)=GMRVQUAL
"RTN","GMRVED2",138,0)
 D UPDATE^DIE("","GMVFDA","GMVOKAY","GMVERR")
"RTN","GMRVED2",139,0)
 L -^GMR(120.5,GMRVIEN,0)
"RTN","GMRVED2",140,0)
 Q
"RTN","GMV2PST")
0^1^B11190458
"RTN","GMV2PST",1,0)
GMV2PST ;HIOFO/FT-Create Indexes for HDR ;10/7/04  17:06
"RTN","GMV2PST",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**2**;Oct 31, 2002
"RTN","GMV2PST",3,0)
 ;
"RTN","GMV2PST",4,0)
 ; This routine uses the following IAs:
"RTN","GMV2PST",5,0)
 ; #10141 - ^XPDUTL calls      (supported)
"RTN","GMV2PST",6,0)
 ;
"RTN","GMV2PST",7,0)
EN ; Driver subroutine
"RTN","GMV2PST",8,0)
 D AHDRN,AHDRE
"RTN","GMV2PST",9,0)
 Q
"RTN","GMV2PST",10,0)
 ;
"RTN","GMV2PST",11,0)
AHDRN ; Create AHDRNEW Index on GMRV Vital Measurement file (#120.5) for use
"RTN","GMV2PST",12,0)
 ; by Health Data Repository (HDR)
"RTN","GMV2PST",13,0)
 ; Calls HDR API whenever a new entry is made in FILE 120.5
"RTN","GMV2PST",14,0)
 N MSG,RESULT,XREF
"RTN","GMV2PST",15,0)
 D BMES^XPDUTL("Creating AHDRNEW Index on GMRV VITAL MEASUREMENT (#120.5) file.")
"RTN","GMV2PST",16,0)
 S XREF("ACTIVITY")=""
"RTN","GMV2PST",17,0)
 S XREF("FILE")=120.5
"RTN","GMV2PST",18,0)
 S XREF("ROOT FILE")=120.5
"RTN","GMV2PST",19,0)
 S XREF("TYPE")="MU"
"RTN","GMV2PST",20,0)
 S XREF("SHORT DESCR")="INDEX for HDR"
"RTN","GMV2PST",21,0)
 S XREF("DESCR",1)="This cross-reference calls a Health Data Repository (HDR) API whenever a"
"RTN","GMV2PST",22,0)
 S XREF("DESCR",2)="new entry is created."
"RTN","GMV2PST",23,0)
 S XREF("DESCR",3)=" "
"RTN","GMV2PST",24,0)
 S XREF("DESCR",4)="No actual cross-reference nodes are set or killed."
"RTN","GMV2PST",25,0)
 S XREF("DESCR",5)=" "
"RTN","GMV2PST",26,0)
 S XREF("DESCR",6)="Calls to the VDEFQM routine are covered by Integration Agreement 4253."
"RTN","GMV2PST",27,0)
 S XREF("USE")="ACTION"
"RTN","GMV2PST",28,0)
 S XREF("EXECUTION")="F"
"RTN","GMV2PST",29,0)
 S XREF("WHOLE KILL")="Q"
"RTN","GMV2PST",30,0)
 S XREF("VAL",1)=.01
"RTN","GMV2PST",31,0)
 S XREF("NAME")="AHDRNEW"
"RTN","GMV2PST",32,0)
 S XREF("SET")="Q:$D(DIU(0))  N ERR,GMVFLAG I $T(QUEUE^VDEFQM)]"""" S GMVFLAG=$$QUEUE^VDEFQM(""ORU^R01"",""SUBTYPE=VTLS^IEN=""_DA,.ERR)"
"RTN","GMV2PST",33,0)
 S XREF("KILL")="Q"
"RTN","GMV2PST",34,0)
 S XREF("SET CONDITION")="S:X1(1)="""" X=1"
"RTN","GMV2PST",35,0)
 D CREIXN^DDMOD(.XREF,"k",.RESULT,"","MSG")
"RTN","GMV2PST",36,0)
 I RESULT="" D
"RTN","GMV2PST",37,0)
 .D BMES^XPDUTL("The AHDRNEW Index was not added to FILE 120.5. Please enter a NOIS.")
"RTN","GMV2PST",38,0)
 .Q 
"RTN","GMV2PST",39,0)
 Q
"RTN","GMV2PST",40,0)
 ;
"RTN","GMV2PST",41,0)
AHDRE ; Create AHDRERR Index on GMRV Vital Measurement file (#120.5) for use
"RTN","GMV2PST",42,0)
 ; by Health Data Repository (HDR)
"RTN","GMV2PST",43,0)
 ; Calls HDR API whenever a FILE 120.5 entry is marked as an error
"RTN","GMV2PST",44,0)
 N MSG,RESULT,XREF
"RTN","GMV2PST",45,0)
 D BMES^XPDUTL("Creating AHDRERR Index on GMRV VITAL MEASUREMENT (#120.5) file.")
"RTN","GMV2PST",46,0)
 S XREF("ACTIVITY")=""
"RTN","GMV2PST",47,0)
 S XREF("FILE")=120.5
"RTN","GMV2PST",48,0)
 S XREF("ROOT FILE")=120.5
"RTN","GMV2PST",49,0)
 S XREF("TYPE")="MU"
"RTN","GMV2PST",50,0)
 S XREF("SHORT DESCR")="INDEX for HDR"
"RTN","GMV2PST",51,0)
 S XREF("DESCR",1)="This cross-reference calls a Health Data Repository (HDR) API whenever a"
"RTN","GMV2PST",52,0)
 S XREF("DESCR",2)="FILE 120.5 entry is marked as entered-in-error."
"RTN","GMV2PST",53,0)
 S XREF("DESCR",3)=" "
"RTN","GMV2PST",54,0)
 S XREF("DESCR",4)="No actual cross-reference nodes are set or killed."
"RTN","GMV2PST",55,0)
 S XREF("DESCR",5)=" "
"RTN","GMV2PST",56,0)
 S XREF("DESCR",6)="Calls to the VDEFQM routine are covered by Integration Agreement 4253."
"RTN","GMV2PST",57,0)
 S XREF("USE")="ACTION"
"RTN","GMV2PST",58,0)
 S XREF("EXECUTION")="F"
"RTN","GMV2PST",59,0)
 S XREF("WHOLE KILL")="Q"
"RTN","GMV2PST",60,0)
 S XREF("VAL",1)=2
"RTN","GMV2PST",61,0)
 S XREF("NAME")="AHDRERR"
"RTN","GMV2PST",62,0)
 S XREF("SET")="Q:$D(DIU(0))  N ERR,GMVFLAG I $T(QUEUE^VDEFQM)]"""" S GMVFLAG=$$QUEUE^VDEFQM(""ORU^R01"",""SUBTYPE=VTLS^IEN=""_DA,.ERR)"
"RTN","GMV2PST",63,0)
 S XREF("KILL")="Q"
"RTN","GMV2PST",64,0)
 S XREF("SET CONDITION")="I X1(1)="""",X2(1)]"""" S X=1"
"RTN","GMV2PST",65,0)
 D CREIXN^DDMOD(.XREF,"k",.RESULT,"","MSG")
"RTN","GMV2PST",66,0)
 I RESULT="" D
"RTN","GMV2PST",67,0)
 .D BMES^XPDUTL("The AHDRERR Index was not added to FILE 120.5. Please enter a NOIS.")
"RTN","GMV2PST",68,0)
 .Q 
"RTN","GMV2PST",69,0)
 Q
"RTN","GMVHDR")
0^2^B10470656
"RTN","GMVHDR",1,0)
GMVHDR ;HIOFO/FT-HEALTH DATA REPOSITORY API ;10/21/04  13:03
"RTN","GMVHDR",2,0)
 ;;5.0;GEN. MED. REC. - VITALS;**2**;Oct 31, 2002
"RTN","GMVHDR",3,0)
 ;
"RTN","GMVHDR",4,0)
 ; This routine uses the following IAs:
"RTN","GMVHDR",5,0)
 ; <None>
"RTN","GMVHDR",6,0)
 ;
"RTN","GMVHDR",7,0)
 ; This routine supports the following IAs:
"RTN","GMVHDR",8,0)
 ; EN - #4583           (Private)
"RTN","GMVHDR",9,0)
 ;
"RTN","GMVHDR",10,0)
EN(GMVIEN) ; This function returns a string containing the values
"RTN","GMVHDR",11,0)
 ; for the record number provided.
"RTN","GMVHDR",12,0)
 ;
"RTN","GMVHDR",13,0)
 ;  Input: GMVIEN - FILE 120.5 Internal Entry Number (IEN)
"RTN","GMVHDR",14,0)
 ; Output: A string of data where:
"RTN","GMVHDR",15,0)
 ;         piece 1 = (#.01) DATE/TIME VITALS TAKEN (internal)
"RTN","GMVHDR",16,0)
 ;         piece 2 = (#.02) PATIENT (internal)
"RTN","GMVHDR",17,0)
 ;         piece 3 = (#.03) VITAL TYPE (external)
"RTN","GMVHDR",18,0)
 ;         piece 4 = (#.04) DATE/TIME VITALS ENTERED (internal)
"RTN","GMVHDR",19,0)
 ;         piece 5 = (#.05) HOSPITAL LOCATION (internal)
"RTN","GMVHDR",20,0)
 ;         piece 6 = (#.06) ENTERED BY (internal)
"RTN","GMVHDR",21,0)
 ;         piece 7 = (#.03) VITAL TYPE (internal)
"RTN","GMVHDR",22,0)
 ;         piece 8 = (#1.2) RATE
"RTN","GMVHDR",23,0)
 ;         piece 9 = UNITS (value is computed by this routine)
"RTN","GMVHDR",24,0)
 ;         piece 10 = (#1.4) SUPPLEMENTAL O2 (internal)
"RTN","GMVHDR",25,0)
 ;         piece 11 = (#2) ENTERED IN ERROR (internal)
"RTN","GMVHDR",26,0)
 ;         piece 12 = (#3) ERROR ENTERED BY (internal)
"RTN","GMVHDR",27,0)
 ;         piece 13 = (#4) REASON ENTERED IN ERROR (multiple) (external)
"RTN","GMVHDR",28,0)
 ;                    Values are separated by a tilde (~).
"RTN","GMVHDR",29,0)
 ;         piece 14 = (#5) QUALIFIER (multiple) (external)
"RTN","GMVHDR",30,0)
 ;                    Values are separated by a tilde (~).
"RTN","GMVHDR",31,0)
 ;
"RTN","GMVHDR",32,0)
 ; Returns a null value if the entry does not exist.
"RTN","GMVHDR",33,0)
 ;
"RTN","GMVHDR",34,0)
 I '$G(GMVIEN) Q ""
"RTN","GMVHDR",35,0)
 N GMVA,GMVLIST,GMVLOOP,GMVNODE,GMVNODE2,GMVQUALE,GMVQUALI,GMVUNIT,GMVVTE,GMVVTI,GMVX
"RTN","GMVHDR",36,0)
 S GMVNODE=$G(^GMR(120.5,+GMVIEN,0)) ; zero node of patient record
"RTN","GMVHDR",37,0)
 I GMVNODE="" Q ""
"RTN","GMVHDR",38,0)
 I $P(GMVNODE,U,1)'>0 Q ""  ;date/time vitals taken
"RTN","GMVHDR",39,0)
 I $P(GMVNODE,U,2)'>0 Q ""  ;dfn
"RTN","GMVHDR",40,0)
 S GMVVTI=+$P(GMVNODE,U,3) ;vital type ien
"RTN","GMVHDR",41,0)
 S GMVVTE=$P($G(^GMRD(120.51,GMVVTI,0)),U,1) ;vital type name
"RTN","GMVHDR",42,0)
 I GMVVTE="" Q ""
"RTN","GMVHDR",43,0)
 S GMVA=$P($G(^GMRD(120.51,GMVVTI,0)),U,2) ;vital abbreviation
"RTN","GMVHDR",44,0)
 S $P(GMVNODE,U,3)=GMVVTE,$P(GMVNODE,U,7)=GMVVTI
"RTN","GMVHDR",45,0)
 S GMVUNIT=$S(GMVA="BP":"mmHg",GMVA="T":"F",GMVA="R":"/min",GMVA="P":"/min",GMVA="HT":"in",GMVA="WT":"lb",GMVA="CVP":"cmH2O",GMVA="CG":"in",GMVA="PO2":"%SpO2",GMVA="PN":"Verbal Numeric Analog Scale",1:"")
"RTN","GMVHDR",46,0)
 S $P(GMVNODE,U,9)=GMVUNIT
"RTN","GMVHDR",47,0)
 S:+$P(GMVNODE,U,5)'>0 $P(GMVNODE,U,5)="" ;hospital location
"RTN","GMVHDR",48,0)
 S:+$P(GMVNODE,U,6)'>0 $P(GMVNODE,U,6)="" ;entered by
"RTN","GMVHDR",49,0)
 S GMVNODE2=$G(^GMR(120.5,GMVIEN,2))
"RTN","GMVHDR",50,0)
 S $P(GMVNODE,U,11)=$S($P(GMVNODE2,U,1)=1:"YES",1:"")
"RTN","GMVHDR",51,0)
 S $P(GMVNODE,U,12)=$S($P(GMVNODE2,U,2)>0:$P(GMVNODE2,U,2),1:"")
"RTN","GMVHDR",52,0)
 ; reason (multiple)
"RTN","GMVHDR",53,0)
 S GMVLOOP=0,GMVLIST=""
"RTN","GMVHDR",54,0)
 F  S GMVLOOP=$O(^GMR(120.5,GMVIEN,2.1,GMVLOOP)) Q:'GMVLOOP  D
"RTN","GMVHDR",55,0)
 .S GMVX=$P($G(^GMR(120.5,GMVIEN,2.1,GMVLOOP,0)),U,1)
"RTN","GMVHDR",56,0)
 .Q:GMVX=""
"RTN","GMVHDR",57,0)
 .S GMVX=GMVX_"-"_$S(GMVX=1:"INCORRECT DATE/TIME",GMVX=2:"INCORRECT READING",GMVX=3:"INCORRECT PATIENT",GMVX=4:"INVALID RECORD",1:"")
"RTN","GMVHDR",58,0)
 .S GMVLIST=GMVLIST_GMVX_"~"
"RTN","GMVHDR",59,0)
 .Q
"RTN","GMVHDR",60,0)
 I $E(GMVLIST,$L(GMVLIST))="~" S GMVLIST=$E(GMVLIST,1,($L(GMVLIST)-1))
"RTN","GMVHDR",61,0)
 S $P(GMVNODE,U,13)=GMVLIST
"RTN","GMVHDR",62,0)
 ;qualifiers (multiple)
"RTN","GMVHDR",63,0)
 S GMVLOOP=0,GMVLIST=""
"RTN","GMVHDR",64,0)
 F  S GMVLOOP=$O(^GMR(120.5,GMVIEN,5,GMVLOOP)) Q:'GMVLOOP  D
"RTN","GMVHDR",65,0)
 .S GMVQUALI=$P($G(^GMR(120.5,GMVIEN,5,GMVLOOP,0)),U,1)
"RTN","GMVHDR",66,0)
 .S GMVQUALE=$P($G(^GMRD(120.52,+GMVQUALI,0)),U,1)
"RTN","GMVHDR",67,0)
 .Q:GMVQUALE=""
"RTN","GMVHDR",68,0)
 .S GMVLIST=GMVLIST_GMVQUALE_"~"
"RTN","GMVHDR",69,0)
 .Q
"RTN","GMVHDR",70,0)
 I $E(GMVLIST,$L(GMVLIST))="~" S GMVLIST=$E(GMVLIST,1,($L(GMVLIST)-1))
"RTN","GMVHDR",71,0)
 S $P(GMVNODE,U,14)=GMVLIST
"RTN","GMVHDR",72,0)
 Q GMVNODE
"RTN","GMVHDR",73,0)
 ;
"VER")
8.0^22
**END**
**END**
