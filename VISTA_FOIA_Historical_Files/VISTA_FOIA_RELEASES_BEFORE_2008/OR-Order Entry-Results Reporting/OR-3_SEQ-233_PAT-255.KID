Released OR*3*255 SEQ #233
Extracted from mail message
**KIDS**:OR*3.0*255^

**INSTALL NAME**
OR*3.0*255
"BLD",6838,0)
OR*3.0*255^ORDER ENTRY/RESULTS REPORTING^0^3060626^y
"BLD",6838,1,0)
^^3^3^3060626^
"BLD",6838,1,1,0)
This patch addresses two issues, First orderable items not turning off
"BLD",6838,1,2,0)
Reminders. Second the DEA# and VA# fields are not being check, when
"BLD",6838,1,3,0)
narcotics are ordered with the outpatient IV dialog in CPRS.
"BLD",6838,4,0)
^9.64PA^^
"BLD",6838,"KRN",0)
^9.67PA^8989.52^19
"BLD",6838,"KRN",.4,0)
.4
"BLD",6838,"KRN",.401,0)
.401
"BLD",6838,"KRN",.402,0)
.402
"BLD",6838,"KRN",.403,0)
.403
"BLD",6838,"KRN",.5,0)
.5
"BLD",6838,"KRN",.84,0)
.84
"BLD",6838,"KRN",3.6,0)
3.6
"BLD",6838,"KRN",3.8,0)
3.8
"BLD",6838,"KRN",9.2,0)
9.2
"BLD",6838,"KRN",9.8,0)
9.8
"BLD",6838,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6838,"KRN",9.8,"NM",1,0)
ORDD100^^0^24896200
"BLD",6838,"KRN",9.8,"NM",2,0)
ORMGMRC^^0^44071350
"BLD",6838,"KRN",9.8,"NM",3,0)
ORWDPS1^^0^31251858
"BLD",6838,"KRN",9.8,"NM","B","ORDD100",1)

"BLD",6838,"KRN",9.8,"NM","B","ORMGMRC",2)

"BLD",6838,"KRN",9.8,"NM","B","ORWDPS1",3)

"BLD",6838,"KRN",19,0)
19
"BLD",6838,"KRN",19.1,0)
19.1
"BLD",6838,"KRN",101,0)
101
"BLD",6838,"KRN",409.61,0)
409.61
"BLD",6838,"KRN",771,0)
771
"BLD",6838,"KRN",870,0)
870
"BLD",6838,"KRN",8989.51,0)
8989.51
"BLD",6838,"KRN",8989.52,0)
8989.52
"BLD",6838,"KRN",8994,0)
8994
"BLD",6838,"KRN","B",.4,.4)

"BLD",6838,"KRN","B",.401,.401)

"BLD",6838,"KRN","B",.402,.402)

"BLD",6838,"KRN","B",.403,.403)

"BLD",6838,"KRN","B",.5,.5)

"BLD",6838,"KRN","B",.84,.84)

"BLD",6838,"KRN","B",3.6,3.6)

"BLD",6838,"KRN","B",3.8,3.8)

"BLD",6838,"KRN","B",9.2,9.2)

"BLD",6838,"KRN","B",9.8,9.8)

"BLD",6838,"KRN","B",19,19)

"BLD",6838,"KRN","B",19.1,19.1)

"BLD",6838,"KRN","B",101,101)

"BLD",6838,"KRN","B",409.61,409.61)

"BLD",6838,"KRN","B",771,771)

"BLD",6838,"KRN","B",870,870)

"BLD",6838,"KRN","B",8989.51,8989.51)

"BLD",6838,"KRN","B",8989.52,8989.52)

"BLD",6838,"KRN","B",8994,8994)

"BLD",6838,"QUES",0)
^9.62^^
"BLD",6838,"REQB",0)
^9.611^3^3
"BLD",6838,"REQB",1,0)
OR*3.0*157^2
"BLD",6838,"REQB",2,0)
OR*3.0*195^2
"BLD",6838,"REQB",3,0)
OR*3.0*215^2
"BLD",6838,"REQB","B","OR*3.0*157",1)

"BLD",6838,"REQB","B","OR*3.0*195",2)

"BLD",6838,"REQB","B","OR*3.0*215",3)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2971217^2980417^1271
"PKG",167,22,1,"PAH",1,0)
255^3060626
"PKG",167,22,1,"PAH",1,1,0)
^^3^3^3060626
"PKG",167,22,1,"PAH",1,1,1,0)
This patch addresses two issues, First orderable items not turning off
"PKG",167,22,1,"PAH",1,1,2,0)
Reminders. Second the DEA# and VA# fields are not being check, when
"PKG",167,22,1,"PAH",1,1,3,0)
narcotics are ordered with the outpatient IV dialog in CPRS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORDD100")
0^1^B24896200^B23257554
"RTN","ORDD100",1,0)
ORDD100 ; slc/dcm - DD entries for file 100 ;06/18/2004  10:00
"RTN","ORDD100",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,157,255**;Dec 17, 1997
"RTN","ORDD100",3,0)
SETALL(ORIFN) ; -- set "AC" xref for all actions
"RTN","ORDD100",4,0)
 N ORYD,ORVP,ORSTOP,OR3,ORSTS,ORLOG,ORACT,ORACT0,ORCACT D ORYD
"RTN","ORDD100",5,0)
 S ORVP=$P($G(^OR(100,ORIFN,0)),U,2),ORSTOP=$P($G(^(0)),U,9) Q:'ORVP
"RTN","ORDD100",6,0)
 S OR3=$G(^OR(100,ORIFN,3)),ORSTS=$P(OR3,U,3),ORCACT=$P(OR3,U,7)
"RTN","ORDD100",7,0)
 S ORACT=0 F  S ORACT=$O(^OR(100,ORIFN,8,ORACT)) Q:ORACT'>0  D SET1
"RTN","ORDD100",8,0)
 Q
"RTN","ORDD100",9,0)
SET(ORIFN,ORACT) ; -- set "AC" xref by action
"RTN","ORDD100",10,0)
 N ORYD,ORVP,ORSTOP,OR3,ORSTS,ORLOG,ORACT0,ORCACT D ORYD
"RTN","ORDD100",11,0)
 S ORVP=$P($G(^OR(100,ORIFN,0)),U,2),ORSTOP=$P($G(^(0)),U,9) Q:'ORVP
"RTN","ORDD100",12,0)
 S OR3=$G(^OR(100,ORIFN,3)),ORSTS=$P(OR3,U,3),ORCACT=$P(OR3,U,7)
"RTN","ORDD100",13,0)
SET1 S ORACT0=$G(^OR(100,ORIFN,8,ORACT,0)),ORLOG=$P(ORACT0,U)
"RTN","ORDD100",14,0)
 K ^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,ORACT) ; reset
"RTN","ORDD100",15,0)
 I ORACT'=ORCACT D  Q  ; not Current action
"RTN","ORDD100",16,0)
 . I $P(ORACT0,U,15)=11 S ^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,ORACT)="" Q
"RTN","ORDD100",17,0)
 . I ORYD,$P(ORACT0,U,15)=13,ORLOG'<ORYD S ^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,ORACT)=""
"RTN","ORDD100",18,0)
 . I $P(ORACT0,U,15)="",ORACT=1,$P($G(^OR(100,ORIFN,8,ORCACT,0)),U,2)="RL",$S('ORYD:1,$P($G(^(0)),U,16)<ORYD:1,1:0) S $P(^OR(100,ORIFN,3),U,7)=1,^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,1)="" ;Replace RL w/NW
"RTN","ORDD100",19,0)
 I ORSTS,ORSTS'=1,ORSTS'=2,ORSTS'=7,ORSTS'=10,ORSTS'=12,ORSTS'=13,ORSTS'=14,ORSTS'=99 S ^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,ORACT)=""
"RTN","ORDD100",20,0)
 I ORYD,(ORSTS=1!(ORSTS=2)!(ORSTS=7)!(ORSTS=13)),ORSTOP'<ORYD S ^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,ORACT)=""
"RTN","ORDD100",21,0)
 Q
"RTN","ORDD100",22,0)
KILALL(ORIFN) ; -- kill "AC" xref for all actions
"RTN","ORDD100",23,0)
 N ORVP,ORACT,ORLOG
"RTN","ORDD100",24,0)
 S ORVP=$P($G(^OR(100,ORIFN,0)),U,2),ORACT=0 Q:'ORVP
"RTN","ORDD100",25,0)
 F  S ORACT=$O(^OR(100,ORIFN,8,ORACT)) Q:ORACT'>0  S ORLOG=$P(^(ORACT,0),U) K:ORLOG ^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,ORACT)
"RTN","ORDD100",26,0)
 Q
"RTN","ORDD100",27,0)
KIL(ORIFN,ORACT) ; -- kill "AC" xref
"RTN","ORDD100",28,0)
 N ORVP,ORLOG
"RTN","ORDD100",29,0)
 S ORVP=$P($G(^OR(100,ORIFN,0)),U,2),ORLOG=$P($G(^(8,ORACT,0)),U) Q:'ORVP
"RTN","ORDD100",30,0)
 K:ORLOG ^OR(100,"AC",ORVP,9999999-ORLOG,ORIFN,ORACT)
"RTN","ORDD100",31,0)
 Q
"RTN","ORDD100",32,0)
 ;
"RTN","ORDD100",33,0)
ORYD ; -- Return Current Orders context hours in ORYD
"RTN","ORDD100",34,0)
 N X,X1,X2,X3,%,%H
"RTN","ORDD100",35,0)
 S ORYD=$$GET^XPAR("SYS","ORPF ACTIVE ORDERS CONTEXT HRS",1,"I")
"RTN","ORDD100",36,0)
YD1 I ORYD S X=$H,X=+X*24+($P(X,",",2)/3600),X2=ORYD,X1=X-X2,X3=X1#24,X1=X1\24,X2=$J(X3*3600,0,0),%H=X1_","_X2 D YMD^%DTC S ORYD=+(X_%)
"RTN","ORDD100",37,0)
 Q
"RTN","ORDD100",38,0)
 ;
"RTN","ORDD100",39,0)
SS ; -- set "AD" xref
"RTN","ORDD100",40,0)
 N ORSTRT S ORSTRT=$P($G(^OR(100,DA,0)),U,8)
"RTN","ORDD100",41,0)
 I ORSTRT,ORSTRT>$$NOW^XLFDT S ^OR(100,"AD",ORSTRT,DA)=""
"RTN","ORDD100",42,0)
 Q
"RTN","ORDD100",43,0)
SK ; -- kill "AD" xref
"RTN","ORDD100",44,0)
 N ORSTRT S ORSTRT=$P($G(^OR(100,DA,0)),U,8)
"RTN","ORDD100",45,0)
 I ORSTRT K ^OR(100,"AD",ORSTRT,DA)
"RTN","ORDD100",46,0)
 Q
"RTN","ORDD100",47,0)
 ;
"RTN","ORDD100",48,0)
WS ; -- set "AW" xref
"RTN","ORDD100",49,0)
 N ORVP,ORDG,ORSTRT,X,X0
"RTN","ORDD100",50,0)
 S X0=$G(^OR(100,DA,0)),ORVP=$P(X0,U,2),ORDG=$P(X0,U,11)
"RTN","ORDD100",51,0)
 S ORSTRT=$P(X0,U,8),X=$S(ORSTRT:ORSTRT,1:9999999)
"RTN","ORDD100",52,0)
 I ORVP,ORDG S ^OR(100,"AW",ORVP,ORDG,X,DA)=""
"RTN","ORDD100",53,0)
 Q
"RTN","ORDD100",54,0)
WK ; -- kill "AW" xref
"RTN","ORDD100",55,0)
 N ORVP,ORDG,ORSTRT,X,X0
"RTN","ORDD100",56,0)
 S X0=$G(^OR(100,DA,0)),ORVP=$P(X0,U,2),ORDG=$P(X0,U,11)
"RTN","ORDD100",57,0)
 S ORSTRT=$P(X0,U,8),X=$S(ORSTRT:ORSTRT,1:9999999)
"RTN","ORDD100",58,0)
 I ORVP,ORDG K ^OR(100,"AW",ORVP,ORDG,X,DA)
"RTN","ORDD100",59,0)
 Q
"RTN","ORDD100",60,0)
 ;
"RTN","ORDD100",61,0)
S1(ORIFN,ORACT,ORVP,ORLOG) ; -- set "AS" xref
"RTN","ORDD100",62,0)
 N OR0 S OR0=$G(^OR(100,ORIFN,8,ORACT,0)) Q:$P(OR0,U,4)'=2  ;unsigned
"RTN","ORDD100",63,0)
 S:'$G(ORLOG) ORLOG=$P(OR0,U) S:'$G(ORVP) ORVP=$P(^OR(100,ORIFN,0),U,2)
"RTN","ORDD100",64,0)
 I ORVP,ORLOG S ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,ORACT)=""
"RTN","ORDD100",65,0)
 Q
"RTN","ORDD100",66,0)
S2(ORIFN,ORACT,ORVP,ORLOG) ; -- kill "AS" xref
"RTN","ORDD100",67,0)
 N OR0 S:'$G(ORVP) ORVP=$P(^OR(100,ORIFN,0),U,2)
"RTN","ORDD100",68,0)
 S:'$G(ORLOG) ORLOG=$P($G(^OR(100,ORIFN,8,ORACT,0)),U)
"RTN","ORDD100",69,0)
 I ORLOG,ORVP K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,ORACT)
"RTN","ORDD100",70,0)
 Q
"RTN","ORDD100",71,0)
 ;
"RTN","ORDD100",72,0)
RS(ORIFN,ORACT,ORVP,ORRDT) ; -- set "AR" xref
"RTN","ORDD100",73,0)
 N OR80
"RTN","ORDD100",74,0)
 Q:'$G(ORIFN)  Q:'$G(ORACT)
"RTN","ORDD100",75,0)
 S:'$G(ORVP) ORVP=$P($G(^OR(100,ORIFN,0)),U,2)
"RTN","ORDD100",76,0)
 S OR80=$G(^OR(100,ORIFN,8,ORACT,0))
"RTN","ORDD100",77,0)
 S:'$G(ORRDT) ORRDT=$P(OR80,U,16)
"RTN","ORDD100",78,0)
 I ORVP,ORRDT S ^OR(100,"AR",ORVP,(9999999-ORRDT),ORIFN,ORACT)=""
"RTN","ORDD100",79,0)
 I ORVP'["DPT"!ORRDT="" Q
"RTN","ORDD100",80,0)
 I $P(OR80,U,2)="NW" D PXRMADD(ORIFN,ORVP,ORRDT)
"RTN","ORDD100",81,0)
 Q
"RTN","ORDD100",82,0)
 ;
"RTN","ORDD100",83,0)
PXRMADD(ORIFN,ORVP,ORRDT)   ; -- set "PXRM" xref
"RTN","ORDD100",84,0)
 N DAES,OI,OR0,START,X
"RTN","ORDD100",85,0)
 S DAES(1)=ORIFN
"RTN","ORDD100",86,0)
 S X(1)=ORVP
"RTN","ORDD100",87,0)
 S OR0=^OR(100,ORIFN,0)
"RTN","ORDD100",88,0)
 S START=$P(OR0,U,8)
"RTN","ORDD100",89,0)
 S X(3)=$S(START="":ORRDT,1:START)
"RTN","ORDD100",90,0)
 S X(4)=$P(OR0,U,9)
"RTN","ORDD100",91,0)
 S OI=0 F  S OI=$O(^OR(100,ORIFN,.1,OI)) Q:OI'>0  D
"RTN","ORDD100",92,0)
 . S X(2)=+$G(^(OI,0)),DAES=OI
"RTN","ORDD100",93,0)
 . D SOR^ORPXRM(.X,.DAES)
"RTN","ORDD100",94,0)
 Q
"RTN","ORDD100",95,0)
 ;
"RTN","ORDD100",96,0)
RK(ORIFN,ORACT,ORVP,ORRDT) ; -- kill "AR" xref
"RTN","ORDD100",97,0)
 N OR80
"RTN","ORDD100",98,0)
 Q:'$G(ORIFN)  Q:'$G(ORACT)
"RTN","ORDD100",99,0)
 S:'$G(ORVP) ORVP=$P($G(^OR(100,ORIFN,0)),U,2)
"RTN","ORDD100",100,0)
 S OR80=$G(^OR(100,ORIFN,8,ORACT,0))
"RTN","ORDD100",101,0)
 S:'$G(ORRDT) ORRDT=$P(OR80,U,16)
"RTN","ORDD100",102,0)
 I ORVP,ORRDT K ^OR(100,"AR",ORVP,(9999999-ORRDT),ORIFN,ORACT)
"RTN","ORDD100",103,0)
 I ORVP'["DPT"!ORRDT="" Q
"RTN","ORDD100",104,0)
 I $P(OR80,U,2)="NW" D PXRMKILL(ORIFN,ORVP,ORRDT)
"RTN","ORDD100",105,0)
 Q
"RTN","ORDD100",106,0)
 ;
"RTN","ORDD100",107,0)
PXRMKILL(ORIFN,ORVP,ORRDT)  ; -- kill "PXRM" xref
"RTN","ORDD100",108,0)
 N DAES,OI,OR0,START,X
"RTN","ORDD100",109,0)
 S DAES(1)=ORIFN
"RTN","ORDD100",110,0)
 S X(1)=ORVP
"RTN","ORDD100",111,0)
 S OR0=^OR(100,ORIFN,0)
"RTN","ORDD100",112,0)
 S START=$P(OR0,U,8)
"RTN","ORDD100",113,0)
 S X(3)=$S(START="":ORRDT,1:START)
"RTN","ORDD100",114,0)
 S X(4)=$P(OR0,U,9)
"RTN","ORDD100",115,0)
 S OI=0 F  S OI=$O(^OR(100,ORIFN,.1,OI)) Q:OI'>0  D
"RTN","ORDD100",116,0)
 . S X(2)=+$G(^(OI,0)),DAES=OI
"RTN","ORDD100",117,0)
 . D KOR^ORPXRM(.X,.DAES)
"RTN","ORDD100",118,0)
 Q
"RTN","ORDD100",119,0)
 ;
"RTN","ORDD100",120,0)
VS ; -- set "AEVNT" xref
"RTN","ORDD100",121,0)
 N ORVP,OREVNT
"RTN","ORDD100",122,0)
 S ORVP=$P($G(^OR(100,DA,0)),U,2),OREVNT=$P($G(^(0)),U,17)
"RTN","ORDD100",123,0)
 I ORVP,$L(OREVNT) S ^OR(100,"AEVNT",ORVP,OREVNT,DA)=""
"RTN","ORDD100",124,0)
 Q
"RTN","ORDD100",125,0)
 ;
"RTN","ORDD100",126,0)
VK ; -- kill "AEVNT" xref
"RTN","ORDD100",127,0)
 N ORVP,OREVNT
"RTN","ORDD100",128,0)
 S ORVP=$P($G(^OR(100,DA,0)),U,2),OREVNT=$P($G(^(0)),U,17)
"RTN","ORDD100",129,0)
 I ORVP,$L(OREVNT) K ^OR(100,"AEVNT",ORVP,OREVNT,DA)
"RTN","ORDD100",130,0)
 Q
"RTN","ORDD100",131,0)
 ;
"RTN","ORDD100",132,0)
UP(X) ; -- Convert X to upper case
"RTN","ORDD100",133,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ORMGMRC")
0^2^B44071350^B43068026
"RTN","ORMGMRC",1,0)
ORMGMRC ; SLC/MKB - Process Consult ORM msgs ;7/14/04 13:29
"RTN","ORMGMRC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,26,68,92,153,174,195,255**;Dec 17, 1997
"RTN","ORMGMRC",3,0)
EN ; -- entry point for GMRC messges
"RTN","ORMGMRC",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMGMRC",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMGMRC",6,0)
 S:ORDCNTRL="OC"&(ORTYPE="ORR") ORDCNTRL="UA" ;new code
"RTN","ORMGMRC",7,0)
 N ORSTS,OREASON1,NTE S ORSTS=$$STATUS(ORDSTS)
"RTN","ORMGMRC",8,0)
 S:'ORLOG ORLOG=$$NOW^XLFDT S:'ORDUZ ORDUZ=DUZ S:$G(DGPMT) ORDUZ=""
"RTN","ORMGMRC",9,0)
 S OREASON=$P(OREASON,U,5),NTE=$O(@ORMSG@(+ORC)),OREASON1=""
"RTN","ORMGMRC",10,0)
 I NTE,$E(@ORMSG@(NTE),1,3)="NTE" S OREASON1=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMGMRC",11,0)
 D @ORDCNTRL
"RTN","ORMGMRC",12,0)
 Q
"RTN","ORMGMRC",13,0)
 ;
"RTN","ORMGMRC",14,0)
ZP ; -- Purged
"RTN","ORMGMRC",15,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMGMRC",16,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^8^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ; Remove pkg reference, sts=lapsed if still active
"RTN","ORMGMRC",17,0)
 Q
"RTN","ORMGMRC",18,0)
 ;
"RTN","ORMGMRC",19,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMGMRC",20,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMGMRC",21,0)
 Q
"RTN","ORMGMRC",22,0)
 ;
"RTN","ORMGMRC",23,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMGMRC",24,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; update Last Activity
"RTN","ORMGMRC",25,0)
 Q
"RTN","ORMGMRC",26,0)
 ;
"RTN","ORMGMRC",27,0)
OK ; -- Order accepted, GMRC order # assigned [ack]
"RTN","ORMGMRC",28,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:'$G(ORSTS) ORSTS=5
"RTN","ORMGMRC",29,0)
 D STATUS^ORCSAVE2(+ORIFN,ORSTS) ; 5=pending
"RTN","ORMGMRC",30,0)
 D DATES^ORCSAVE2(+ORIFN,+$E($$NOW^XLFDT,1,12))
"RTN","ORMGMRC",31,0)
 Q
"RTN","ORMGMRC",32,0)
 ;
"RTN","ORMGMRC",33,0)
XX ; -- Change order
"RTN","ORMGMRC",34,0)
 N ORDIALOG,ORDG,ORDA,ORX,ORP,ORSIG S:'$L(ORNATR) ORNATR="S"
"RTN","ORMGMRC",35,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)  S ORIFN=+ORIFN
"RTN","ORMGMRC",36,0)
 S ORDA=$$ACTION^ORCSAVE("XX",ORIFN,ORNP,OREASON1,ORLOG,ORDUZ)
"RTN","ORMGMRC",37,0)
 I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMGMRC",38,0)
 ; -Update sts of order to active, last action to dc/edit:
"RTN","ORMGMRC",39,0)
 S ORX=+$P($G(^OR(100,ORIFN,3)),U,7) S:ORX'>0 ORX=+$O(^(8,ORDA),-1)
"RTN","ORMGMRC",40,0)
 I $D(^OR(100,ORIFN,8,ORX,0)),$P(^(0),U,15)="" S $P(^(0),U,15)=12
"RTN","ORMGMRC",41,0)
 S $P(^OR(100,ORIFN,3),U,7)=ORDA D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMGMRC",42,0)
 D PXRMKILL^ORDD100(ORIFN,ORVP,ORLOG)   ; JEH 255
"RTN","ORMGMRC",43,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMGMRC",44,0)
 ; -If unsigned edit, leave XX unsigned & mark ORX as Sig Not Req'd
"RTN","ORMGMRC",45,0)
 S ORSIG=$S($P($G(^OR(100,ORIFN,8,ORX,0)),U,4)'=2:1,1:0)
"RTN","ORMGMRC",46,0)
 D SIGSTS^ORCSAVE2(ORIFN,ORDA):ORSIG,SIGN^ORCSAVE2(ORIFN,,,5,ORX):'ORSIG
"RTN","ORMGMRC",47,0)
 ; -Update responses, get/save new order text:
"RTN","ORMGMRC",48,0)
 K ^OR(100,ORIFN,4.5) D RESPONSE^ORCSAVE,ORDTEXT^ORCSAVE1(ORIFN_";"_ORDA)
"RTN","ORMGMRC",49,0)
 S $P(^OR(100,ORIFN,8,ORDA,0),U,14)=ORDA
"RTN","ORMGMRC",50,0)
 K:OREASON="RESUBMIT" ^OR(100,ORIFN,6) ;clear previous DC data
"RTN","ORMGMRC",51,0)
 D PXRMADD^ORDD100(ORIFN,ORVP,ORLOG)   ; JEH 255
"RTN","ORMGMRC",52,0)
 I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMGMRC",53,0)
 Q
"RTN","ORMGMRC",54,0)
 ;
"RTN","ORMGMRC",55,0)
SN ; -- New backdoor order: return NA msg w/ORIFN, or DE msg
"RTN","ORMGMRC",56,0)
 N ORDIALOG,ORDG,ORP K ^TMP("ORWORD",$J) S:'$L(ORNATR) ORNATR="W"
"RTN","ORMGMRC",57,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMGMRC",58,0)
 I ORDUZ,'$D(^VA(200,ORDUZ,0)) S ORERR="Invalid entering person" Q
"RTN","ORMGMRC",59,0)
 I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMGMRC",60,0)
 D DLG Q:$D(ORERR)  Q:'$D(ORDIALOG)
"RTN","ORMGMRC",61,0)
SN1 D EN^ORCSAVE K ^TMP("ORWORD",$J) ; setting status, xrefs
"RTN","ORMGMRC",62,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMGMRC",63,0)
 ;Save DG1 and ZCL segments of HL7 message from backdoor orders
"RTN","ORMGMRC",64,0)
 D BDOSTR^ORWDBA3
"RTN","ORMGMRC",65,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR),SIGSTS^ORCSAVE2(ORIFN,1)
"RTN","ORMGMRC",66,0)
 S:'ORSTRT ORSTRT=$$NOW^XLFDT D DATES^ORCSAVE2(+ORIFN,ORSTRT)
"RTN","ORMGMRC",67,0)
 D:$G(ORSTS) STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMGMRC",68,0)
 I $G(ORL) S ORP(1)=ORIFN_";1^1" D PRINTS^ORWD1(.ORP,+ORL) ; chart copy
"RTN","ORMGMRC",69,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMGMRC",70,0)
 Q
"RTN","ORMGMRC",71,0)
 ;
"RTN","ORMGMRC",72,0)
DLG ; -- Build ORDIALOG(),ORDG from msg
"RTN","ORMGMRC",73,0)
 N OBR,USID,TYPE,OI,ZSV,J,OBX,WP,I
"RTN","ORMGMRC",74,0)
 S OBR=$$OBR I 'OBR!($E($G(@ORMSG@(OBR)),1,3)'="OBR") S ORERR="Missing OBR segment" Q
"RTN","ORMGMRC",75,0)
 S USID=$P(@ORMSG@(OBR),"|",5),TYPE=$S(USID["99CON":"CONSULT",1:"REQUEST")
"RTN","ORMGMRC",76,0)
 S ORDIALOG=$O(^ORD(101.41,"AB","GMRCOR "_TYPE,0))
"RTN","ORMGMRC",77,0)
 D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMGMRC",78,0)
 S ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMGMRC",79,0)
 S OI=$$ORDITEM^ORM(USID) I 'OI S ORERR="Invalid consult or procedure" Q
"RTN","ORMGMRC",80,0)
 S ORDIALOG($$PTR("ORDERABLE ITEM"),1)=OI
"RTN","ORMGMRC",81,0)
 S ZSV=$O(@ORMSG@(OBR)) I ZSV,$E(@ORMSG@(ZSV),1,3)="ZSV" D
"RTN","ORMGMRC",82,0)
 . N X1,X2 S X1=$P(@ORMSG@(ZSV),"|",2),X2=$P(@ORMSG@(ZSV),"|",3)
"RTN","ORMGMRC",83,0)
 . I TYPE="REQUEST" S ORDIALOG($$PTR("REQUEST SERVICE"),1)=+$P(X1,U,4)
"RTN","ORMGMRC",84,0)
 . I TYPE="CONSULT",$L(X2) S ORDIALOG($$PTR("FREE TEXT OI"),1)=X2
"RTN","ORMGMRC",85,0)
D1 S ORDIALOG($$PTR("CATEGORY"),1)=$G(ORCAT)
"RTN","ORMGMRC",86,0)
 S J=$P(@ORMSG@(OBR),"|",19),ORDIALOG($$PTR("PLACE OF CONSULTATION"),1)=$S(J="OC":"C",1:J)
"RTN","ORMGMRC",87,0)
 S ORDIALOG($$PTR("PROVIDER"),1)=$P(@ORMSG@(OBR),"|",20)
"RTN","ORMGMRC",88,0)
 S OBX=OBR F  S OBX=$O(@ORMSG@(OBX)) Q:OBX'>0  S J=$E(@ORMSG@(OBX),1,3) Q:J="ORC"  Q:J="MSH"  I J="OBX" D
"RTN","ORMGMRC",89,0)
 . N SEG,NAME,VALUE S SEG=@ORMSG@(OBX)
"RTN","ORMGMRC",90,0)
 . S NAME=$$UP^XLFSTR($P($P(SEG,"|",4),U,2)),VALUE=$P(SEG,"|",6)
"RTN","ORMGMRC",91,0)
 . I NAME="PROVISIONAL DIAGNOSIS" D  Q
"RTN","ORMGMRC",92,0)
 .. S:$P(SEG,"|",3)="CE" ORDIALOG($$PTR("CODE"),1)=$P(VALUE,U),VALUE=$P(VALUE,U,2)
"RTN","ORMGMRC",93,0)
 .. S ORDIALOG($$PTR("FREE TEXT"),1)=VALUE
"RTN","ORMGMRC",94,0)
 . S WP=$$PTR("WORD PROCESSING 1"),I=1,^TMP("ORWORD",$J,WP,1,I,0)=VALUE
"RTN","ORMGMRC",95,0)
 . S J=0 F  S J=$O(@ORMSG@(OBX,J)) Q:J'>0  S I=I+1,^TMP("ORWORD",$J,WP,1,I,0)=@ORMSG@(OBX,J)
"RTN","ORMGMRC",96,0)
 S:$G(I) ^TMP("ORWORD",$J,WP,1,0)="^^"_I_U_I_U_DT_U,ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMGMRC",97,0)
 Q
"RTN","ORMGMRC",98,0)
 ;
"RTN","ORMGMRC",99,0)
OBR() ; -- Return subscript of RXE segment
"RTN","ORMGMRC",100,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMGMRC",101,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="OBR" S X=I Q
"RTN","ORMGMRC",102,0)
 Q X
"RTN","ORMGMRC",103,0)
 ;
"RTN","ORMGMRC",104,0)
SC ; -- Status changed (i.e. scheduled)
"RTN","ORMGMRC",105,0)
 S:'$G(ORSTS) ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS) ; 6=active
"RTN","ORMGMRC",106,0)
 Q
"RTN","ORMGMRC",107,0)
 ;
"RTN","ORMGMRC",108,0)
STATUS(X) ; -- Returns ptr to Order Status file #100.01
"RTN","ORMGMRC",109,0)
 Q $S(X="DC":1,X="CM":2,X="HD":3,X="IP":5,X="SC":6,X="A":9,X="RP":12,X="CA":13,X="ZC":8,1:5)
"RTN","ORMGMRC",110,0)
 ;
"RTN","ORMGMRC",111,0)
RE ; -- Completed, w/results
"RTN","ORMGMRC",112,0)
 N I,SEG,DA,DR,DIE,X,Y
"RTN","ORMGMRC",113,0)
 S:'$G(ORSTS) ORSTS=2 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMGMRC",114,0)
 S X="",DA=+ORIFN,DIE="^OR(100,"
"RTN","ORMGMRC",115,0)
 S DR="71////"_+$E($$NOW^XLFDT,1,12) D ^DIE
"RTN","ORMGMRC",116,0)
 S I=+ORC,X="" F  S I=$O(@ORMSG@(I)) Q:I<1  S SEG=$G(@ORMSG@(I)) Q:$E(SEG,1,3)="ORC"  I $E(SEG,1,3)="OBX",$P(SEG,"|",4)["SIG FINDINGS" S X=$P(SEG,"|",6) Q
"RTN","ORMGMRC",117,0)
 S $P(^OR(100,DA,7),U,2)=$S(X="Y":1,1:"")
"RTN","ORMGMRC",118,0)
 S:'$G(ORNP) ORNP=+$P($G(^OR(100,+ORIFN,0)),U,4)
"RTN","ORMGMRC",119,0)
 I $P(ORC,"|",17)["MAINTENANCE" Q  ;group update - no CM ack needed
"RTN","ORMGMRC",120,0)
 I $L($T(ADD^ORRCACK)) D ADD^ORRCACK(+ORIFN,ORNP) ;Ack stub for prov
"RTN","ORMGMRC",121,0)
 Q
"RTN","ORMGMRC",122,0)
 ;
"RTN","ORMGMRC",123,0)
UA ; -- Unable to Accept [ack]
"RTN","ORMGMRC",124,0)
 S ORDUZ="" I '$L(OREASON1),$L(OREASON) S OREASON1=OREASON
"RTN","ORMGMRC",125,0)
OC ; -- Cancelled/Denied
"RTN","ORMGMRC",126,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMGMRC",127,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_ORDUZ_U_ORLOG_U_U_OREASON1
"RTN","ORMGMRC",128,0)
 D STATUS^ORCSAVE2(+ORIFN,13) I ORDCNTRL="OC" D UPDATE("DC") Q
"RTN","ORMGMRC",129,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMGMRC",130,0)
 N DA S DA=$P(ORIFN,";",2) I DA D
"RTN","ORMGMRC",131,0)
 . S $P(^OR(100,+ORIFN,8,DA,0),U,15)=13 ;request rejected
"RTN","ORMGMRC",132,0)
 . S:$L(OREASON1) ^OR(100,+ORIFN,8,DA,1)=OREASON1
"RTN","ORMGMRC",133,0)
 Q
"RTN","ORMGMRC",134,0)
 ;
"RTN","ORMGMRC",135,0)
OD ; -- Discontinued
"RTN","ORMGMRC",136,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORDUZ_U_ORLOG_U_U_OREASON1
"RTN","ORMGMRC",137,0)
 D STATUS^ORCSAVE2(+ORIFN,1),UPDATE("DC"):$L(ORNATR)
"RTN","ORMGMRC",138,0)
 Q
"RTN","ORMGMRC",139,0)
 ;
"RTN","ORMGMRC",140,0)
DR ; -- Discontinued [ack]
"RTN","ORMGMRC",141,0)
 D STATUS^ORCSAVE2(+ORIFN,1)
"RTN","ORMGMRC",142,0)
 Q
"RTN","ORMGMRC",143,0)
 ;
"RTN","ORMGMRC",144,0)
UPDATE(ORACT) ; -- continue processing
"RTN","ORMGMRC",145,0)
 N ORX,ORDA,ORP
"RTN","ORMGMRC",146,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMGMRC",147,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON1,ORLOG,ORDUZ)
"RTN","ORMGMRC",148,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMGMRC",149,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORLOG,ORDUZ,ORNATR)
"RTN","ORMGMRC",150,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMGMRC",151,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMGMRC",152,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMGMRC",153,0)
 I 'ORX,ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMGMRC",154,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMGMRC",155,0)
 Q
"RTN","ORMGMRC",156,0)
 ;
"RTN","ORMGMRC",157,0)
PTR(X) ; -- Returns ptr to prompt in Order Dialog file #101.41
"RTN","ORMGMRC",158,0)
 Q $O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORWDPS1")
0^3^B31251858^B30373070
"RTN","ORWDPS1",1,0)
ORWDPS1 ; SLC/KCM/JLI - Pharmacy Calls for Windows Dialog ; 10/04/2005
"RTN","ORWDPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**85,132,141,163,215,255**;Dec 17, 1997
"RTN","ORWDPS1",3,0)
 ;
"RTN","ORWDPS1",4,0)
ODSLCT(LST,PSTYPE,DFN,LOC) ; return default lists for dialog
"RTN","ORWDPS1",5,0)
 ; PSTYPE: pharmacy type (U=unit dose, F=IV fluids, O=outpatient)
"RTN","ORWDPS1",6,0)
 N ILST S ILST=0
"RTN","ORWDPS1",7,0)
 S ILST=ILST+1,LST(ILST)="~Priority" D PRIOR
"RTN","ORWDPS1",8,0)
 S ILST=ILST+1,LST(ILST)="~DispMsg"
"RTN","ORWDPS1",9,0)
 S ILST=ILST+1,LST(ILST)="d"_$$DISPMSG
"RTN","ORWDPS1",10,0)
 ;
"RTN","ORWDPS1",11,0)
 ; I PSTYPE="F" D  Q                           ; IV Fluids
"RTN","ORWDPS1",12,0)
 ; . S ILST=ILST+1,LST(ILST)="~ShortList" D SHORT
"RTN","ORWDPS1",13,0)
 ;
"RTN","ORWDPS1",14,0)
 I PSTYPE="O" D                                ; Outpatient
"RTN","ORWDPS1",15,0)
 . S ILST=ILST+1,LST(ILST)="~Refills"
"RTN","ORWDPS1",16,0)
 . S ILST=ILST+1,LST(ILST)="d0^0"
"RTN","ORWDPS1",17,0)
 . S ILST=ILST+1,LST(ILST)="~Pickup"
"RTN","ORWDPS1",18,0)
 . S ILST=ILST+1,LST(ILST)="d"_$$DEFPICK($G(LOC))
"RTN","ORWDPS1",19,0)
 . ; S ILST=ILST+1,LST(ILST)="~Supply"
"RTN","ORWDPS1",20,0)
 . ; S ILST=ILST+1,LST(ILST)="d^"_$$DEFSPLY(DFN)
"RTN","ORWDPS1",21,0)
 Q
"RTN","ORWDPS1",22,0)
PKI(ORY,OI,PSTYPE,ORVP,PKIACTIV) ; return DEA Schedule for drug
"RTN","ORWDPS1",23,0)
 N ILST,ORDOSE,ORWPSOI,ORWDOSES,X1,X2,X
"RTN","ORWDPS1",24,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS1",25,0)
 S ILST=0
"RTN","ORWDPS1",26,0)
 S ORWPSOI=0
"RTN","ORWDPS1",27,0)
 S:+OI ORWPSOI=+$P($G(^ORD(101.43,+OI,0)),U,2)
"RTN","ORWDPS1",28,0)
 D START^PSSJORDF(ORWPSOI,$S(PSTYPE="U":"I",1:"O")) ; dflt route, schedule, etc.
"RTN","ORWDPS1",29,0)
 I '$L($T(DOSE^PSSOPKI1)) D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses
"RTN","ORWDPS1",30,0)
 I $L($T(DOSE^PSSOPKI1)) D DOSE^PSSOPKI1(.ORDOSE,ORWPSOI,PSTYPE,ORVP)       ; dflt doses NEW PKI CODE from pharmacy
"RTN","ORWDPS1",31,0)
 D EN^PSSDIN(ORWPSOI)                               ; nfi text
"RTN","ORWDPS1",32,0)
 S ORY="" ;PKI
"RTN","ORWDPS1",33,0)
 I $D(ORDOSE("DEA")) S X="",X1=$P(ORDOSE("DEA"),";"),X2=$P(ORDOSE("DEA"),";",2) D
"RTN","ORWDPS1",34,0)
 . I '$L(X2) Q
"RTN","ORWDPS1",35,0)
 . I $G(PKIACTIV) S X=X2
"RTN","ORWDPS1",36,0)
 S ORY=X
"RTN","ORWDPS1",37,0)
 K ^TMP("PSJINS",$J),^TMP("PSJMR",$J),^TMP("PSJNOUN",$J),^TMP("PSJSCH",$J),^TMP("PSSDIN",$J)
"RTN","ORWDPS1",38,0)
 Q
"RTN","ORWDPS1",39,0)
PRIOR ; from DLGSLCT, get list of allowed priorities
"RTN","ORWDPS1",40,0)
 N X,XREF
"RTN","ORWDPS1",41,0)
 S XREF=$S(PSTYPE="O":"S.PSO",1:"S.PSJ")
"RTN","ORWDPS1",42,0)
 S X="" F  S X=$O(^ORD(101.42,XREF,X)) Q:'$L(X)  D
"RTN","ORWDPS1",43,0)
 . I XREF["PSJ",X'="ASAP",X'="ROUTINE",X'="STAT" Q
"RTN","ORWDPS1",44,0)
 . S ILST=ILST+1,LST(ILST)="i"_$O(^ORD(101.42,XREF,X,0))_U_X
"RTN","ORWDPS1",45,0)
 S ILST=ILST+1,LST(ILST)="d"_$O(^ORD(101.42,"B","ROUTINE",0))_U_"ROUTINE"
"RTN","ORWDPS1",46,0)
 Q
"RTN","ORWDPS1",47,0)
DEFPICK(LOC)       ; return default routing
"RTN","ORWDPS1",48,0)
 N X,DLG,PRMT
"RTN","ORWDPS1",49,0)
 S DLG=$O(^ORD(101.41,"AB","PSO OERR",0)),X=""
"RTN","ORWDPS1",50,0)
 S PRMT=$O(^ORD(101.41,"AB","OR GTX ROUTING",0))
"RTN","ORWDPS1",51,0)
 I $D(^TMP("ORECALL",$J,+DLG,+PRMT,1)) S X=^(1)
"RTN","ORWDPS1",52,0)
 I X'="" S EDITONLY=1 Q X  ; EDITONLY used by default action
"RTN","ORWDPS1",53,0)
 ;
"RTN","ORWDPS1",54,0)
 ;S X=$$GET^XPAR("ALL^"_"LOC.`"_LOC,"ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",55,0)
 S X=$$GET^XPAR("LOC.`"_LOC_"^SYS","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",56,0)
 I X="C" S X="C^in Clinic" G XPICK
"RTN","ORWDPS1",57,0)
 I X="M" S X="M^by Mail"   G XPICK
"RTN","ORWDPS1",58,0)
 I X="W" S X="W^at Window" G XPICK
"RTN","ORWDPS1",59,0)
 I X="N" S X=""            G XPICK
"RTN","ORWDPS1",60,0)
 I X=""  S X=$S($D(^PSX(550,"C")):"M^by Mail",1:"W^at Window")
"RTN","ORWDPS1",61,0)
XPICK Q X
"RTN","ORWDPS1",62,0)
 ;
"RTN","ORWDPS1",63,0)
DEFSPLY(DFN)    ; return default days supply for this patient
"RTN","ORWDPS1",64,0)
 N ORWX
"RTN","ORWDPS1",65,0)
 S ORWX("PATIENT")=DFN
"RTN","ORWDPS1",66,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORWDPS1",67,0)
 Q $G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS1",68,0)
 ;
"RTN","ORWDPS1",69,0)
DFLTSPLY(VAL,UPD,SCH,PAT,DRG)        ; return days supply given quantity
"RTN","ORWDPS1",70,0)
 ; VAL: default days supply
"RTN","ORWDPS1",71,0)
 N ORWX,I
"RTN","ORWDPS1",72,0)
 S ORWX("PATIENT")=PAT
"RTN","ORWDPS1",73,0)
 I DRG S ORWX("DRUG")=DRG
"RTN","ORWDPS1",74,0)
 F I=1:1:$L(UPD,U)-1 D
"RTN","ORWDPS1",75,0)
 . S ORWX("DOSE ORDERED",I)=$P(UPD,U,I)
"RTN","ORWDPS1",76,0)
 . S ORWX("SCHEDULE",I)=$P(SCH,U,I)
"RTN","ORWDPS1",77,0)
 D DSUP^PSOSIGDS(.ORWX)
"RTN","ORWDPS1",78,0)
 S VAL=$G(ORWX("DAYS SUPPLY"))
"RTN","ORWDPS1",79,0)
 Q
"RTN","ORWDPS1",80,0)
DISPMSG()       ; return 1 to suppress dispense message
"RTN","ORWDPS1",81,0)
 Q +$$GET^XPAR("ALL","ORWDPS SUPPRESS DISPENSE MSG",1,"I")
"RTN","ORWDPS1",82,0)
 ;
"RTN","ORWDPS1",83,0)
SCHALL(LST)     ; return all schedules
"RTN","ORWDPS1",84,0)
 N ILST,SCH,IEN,EXP,TYP,X0
"RTN","ORWDPS1",85,0)
 S ILST=0,SCH=""
"RTN","ORWDPS1",86,0)
 F  S SCH=$O(^PS(51.1,"APPSJ",SCH)) Q:SCH=""  D
"RTN","ORWDPS1",87,0)
 . S IEN=0,EXP=""
"RTN","ORWDPS1",88,0)
 . F  S IEN=$O(^PS(51.1,"APPSJ",SCH,IEN)) Q:'IEN  D  Q:$L(EXP)
"RTN","ORWDPS1",89,0)
 . . S X0=$G(^PS(51.1,IEN,0)),EXP=$P(X0,U,8),TYP=$P(X0,U,5)
"RTN","ORWDPS1",90,0)
 . S ILST=ILST+1,LST(ILST)=SCH_U_EXP_U_TYP
"RTN","ORWDPS1",91,0)
 Q
"RTN","ORWDPS1",92,0)
FORMALT(ORLST,ORIEN,PSTYPE) ; return a list of formulary alternatives
"RTN","ORWDPS1",93,0)
 N PSID,I
"RTN","ORWDPS1",94,0)
 S ORIEN=+$P(^ORD(101.43,ORIEN,0),U,2)
"RTN","ORWDPS1",95,0)
 D EN1^PSSUTIL1(.ORIEN,PSTYPE)
"RTN","ORWDPS1",96,0)
 S PSID=0,I=0
"RTN","ORWDPS1",97,0)
 F  S PSID=$O(ORIEN(PSID)) Q:'PSID  D
"RTN","ORWDPS1",98,0)
 . S OI=+$O(^ORD(101.43,"ID",PSID_";99PSP",0))
"RTN","ORWDPS1",99,0)
 . I OI S I=I+1,ORLST(I)=OI,$P(ORLST(I),U,2)=$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS1",100,0)
 Q
"RTN","ORWDPS1",101,0)
DOSEALT(LST,DDRUG,CUROI,PSTYPE) ; return a list of formulary alternatives for dose
"RTN","ORWDPS1",102,0)
 N I,OI,ORWLST,ILST S ILST=0
"RTN","ORWDPS1",103,0)
 D ENRFA^PSJORUTL(DDRUG,PSTYPE,.ORWLST)
"RTN","ORWDPS1",104,0)
 S I=0 F  S I=$O(ORWLST(I)) Q:'I  D
"RTN","ORWDPS1",105,0)
 . S OI=+$O(^ORD(101.43,"ID",+$P(ORWLST(I),U,4)_";99PSP",0))
"RTN","ORWDPS1",106,0)
 . I OI,OI'=CUROI S ILST=ILST+1,LST(ILST)=OI_U_$P(^ORD(101.43,OI,0),U)
"RTN","ORWDPS1",107,0)
 Q
"RTN","ORWDPS1",108,0)
FAILDEA(FAIL,OI,ORNP,PSTYPE)    ; return 1 if DEA check fails for this provider
"RTN","ORWDPS1",109,0)
 N DEAFLG,PSOI,TPKG
"RTN","ORWDPS1",110,0)
 S FAIL=0,TPKG=$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORWDPS1",111,0)
 Q:TPKG'["PS"
"RTN","ORWDPS1",112,0)
 S PSOI=+TPKG Q:PSOI'>0
"RTN","ORWDPS1",113,0)
 I '$L($T(OIDEA^PSSUTLA1)) Q
"RTN","ORWDPS1",114,0)
 S DEAFLG=$$OIDEA^PSSUTLA1(PSOI,PSTYPE) Q:DEAFLG'>0
"RTN","ORWDPS1",115,0)
 I '$L($$DEA^XUSER(,+$G(ORNP))) S FAIL=1
"RTN","ORWDPS1",116,0)
 Q
"RTN","ORWDPS1",117,0)
FDEA1(FAIL,OI,OITYPE,ORNP) ; only be called for an outpaitent and IV dialog
"RTN","ORWDPS1",118,0)
 ;OI: IV Orderable Item
"RTN","ORWDPS1",119,0)
 ;OITYPE: A:ADDITIVE  S:SOLUTION
"RTN","ORWDPS1",120,0)
 N DEAFLG,PSOI,TKPG
"RTN","ORWDPS1",121,0)
 S FAIL=0,TPKG=$P($G(^ORD(101.43,+$G(OI),0)),U,2)
"RTN","ORWDPS1",122,0)
 Q:TPKG'["PS"
"RTN","ORWDPS1",123,0)
 S PSOI=+TPKG Q:PSOI'>0
"RTN","ORWDPS1",124,0)
 I '$L($T(IVDEA^PSSUTIL1)) Q
"RTN","ORWDPS1",125,0)
 S DEAFLG=$$IVDEA^PSSUTIL1(PSOI,OITYPE) Q:DEAFLG'>0
"RTN","ORWDPS1",126,0)
 I '$L($P($G(^VA(200,+$G(ORNP),"PS")),U,2)),'$L($P($G(^("PS")),U,3)) S FAIL=1
"RTN","ORWDPS1",127,0)
 Q
"RTN","ORWDPS1",128,0)
 ;
"RTN","ORWDPS1",129,0)
CHK94(VAL)      ; return 1 if patch 94 has been installed
"RTN","ORWDPS1",130,0)
 S VAL=0
"RTN","ORWDPS1",131,0)
 I $O(^ORD(101.41,"B","PS MEDS",0)) S VAL=1
"RTN","ORWDPS1",132,0)
 Q
"RTN","ORWDPS1",133,0)
LOCPICK(Y,LOC) ; return default Location level routing
"RTN","ORWDPS1",134,0)
 S Y=""
"RTN","ORWDPS1",135,0)
 S Y=$$GET^XPAR("LOC.`"_LOC_"^SYS","ORWDPS ROUTING DEFAULT",1,"I")
"RTN","ORWDPS1",136,0)
 I Y="C" S Y="C^in Clinic"
"RTN","ORWDPS1",137,0)
 I Y="M" S Y="M^by Mail"
"RTN","ORWDPS1",138,0)
 I Y="W" S Y="W^at Window"
"RTN","ORWDPS1",139,0)
 I Y="N" S Y=""
"RTN","ORWDPS1",140,0)
 Q
"RTN","ORWDPS1",141,0)
HASOIPI(Y,QOID) ; Check if QO put orderable item's PI into Sig
"RTN","ORWDPS1",142,0)
 N PIIEN,OIX
"RTN","ORWDPS1",143,0)
 S Y=0
"RTN","ORWDPS1",144,0)
 Q:'$D(^ORD(101.41,QOID,0))
"RTN","ORWDPS1",145,0)
 S PIIEN=$O(^ORD(101.41,"B","OR GTX PATIENT INSTRUCTIONS",0))
"RTN","ORWDPS1",146,0)
 Q:'PIIEN
"RTN","ORWDPS1",147,0)
 S OIX=0
"RTN","ORWDPS1",148,0)
 Q:'$D(^ORD(101.41,QOID,6,"D"))
"RTN","ORWDPS1",149,0)
 F  S OIX=$O(^ORD(101.41,+QOID,6,"D",OIX)) Q:'OIX  D
"RTN","ORWDPS1",150,0)
 . I OIX=PIIEN S Y=1 Q
"RTN","ORWDPS1",151,0)
 Q
"RTN","ORWDPS1",152,0)
HASROUTE(Y,QOID) ;Check if QO has a ROUTE defined
"RTN","ORWDPS1",153,0)
 N ROUTID
"RTN","ORWDPS1",154,0)
 S Y=0,ROUTID=0
"RTN","ORWDPS1",155,0)
 S ROUTID=$O(^ORD(101.41,"B","OR GTX ROUTING",0))
"RTN","ORWDPS1",156,0)
 Q:'ROUTID
"RTN","ORWDPS1",157,0)
 Q:'$D(^ORD(101.41,+QOID))
"RTN","ORWDPS1",158,0)
 I $D(^ORD(101.41,+QOID,6,"D",ROUTID)) S Y=1
"RTN","ORWDPS1",159,0)
 Q
"VER")
8.0^22.0
"BLD",6838,6)
^233
**END**
**END**
