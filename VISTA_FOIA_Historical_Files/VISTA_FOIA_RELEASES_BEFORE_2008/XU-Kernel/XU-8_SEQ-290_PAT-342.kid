Released XU*8*342 SEQ #290
Extracted from mail message
**KIDS**:XU*8.0*342^

**INSTALL NAME**
XU*8.0*342
"BLD",812,0)
XU*8.0*342^KERNEL^0^3040412^y
"BLD",812,1,0)
^^2^2^3040405^
"BLD",812,1,1,0)
Kernel Patch XU*8.0*342 'Option Access by User Fix'.
"BLD",812,1,2,0)
Please refer to the Description in Forum Patch Module for details.
"BLD",812,4,0)
^9.64PA^^
"BLD",812,"ABPKG")
n
"BLD",812,"KRN",0)
^9.67PA^8989.52^19
"BLD",812,"KRN",.4,0)
.4
"BLD",812,"KRN",.401,0)
.401
"BLD",812,"KRN",.402,0)
.402
"BLD",812,"KRN",.403,0)
.403
"BLD",812,"KRN",.5,0)
.5
"BLD",812,"KRN",.84,0)
.84
"BLD",812,"KRN",3.6,0)
3.6
"BLD",812,"KRN",3.8,0)
3.8
"BLD",812,"KRN",9.2,0)
9.2
"BLD",812,"KRN",9.8,0)
9.8
"BLD",812,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",812,"KRN",9.8,"NM",1,0)
XQ55^^0^B21861426
"BLD",812,"KRN",9.8,"NM",2,0)
XUFILE0^^0^B6195918
"BLD",812,"KRN",9.8,"NM","B","XQ55",1)

"BLD",812,"KRN",9.8,"NM","B","XUFILE0",2)

"BLD",812,"KRN",19,0)
19
"BLD",812,"KRN",19.1,0)
19.1
"BLD",812,"KRN",101,0)
101
"BLD",812,"KRN",409.61,0)
409.61
"BLD",812,"KRN",771,0)
771
"BLD",812,"KRN",870,0)
870
"BLD",812,"KRN",8989.51,0)
8989.51
"BLD",812,"KRN",8989.52,0)
8989.52
"BLD",812,"KRN",8994,0)
8994
"BLD",812,"KRN","B",.4,.4)

"BLD",812,"KRN","B",.401,.401)

"BLD",812,"KRN","B",.402,.402)

"BLD",812,"KRN","B",.403,.403)

"BLD",812,"KRN","B",.5,.5)

"BLD",812,"KRN","B",.84,.84)

"BLD",812,"KRN","B",3.6,3.6)

"BLD",812,"KRN","B",3.8,3.8)

"BLD",812,"KRN","B",9.2,9.2)

"BLD",812,"KRN","B",9.8,9.8)

"BLD",812,"KRN","B",19,19)

"BLD",812,"KRN","B",19.1,19.1)

"BLD",812,"KRN","B",101,101)

"BLD",812,"KRN","B",409.61,409.61)

"BLD",812,"KRN","B",771,771)

"BLD",812,"KRN","B",870,870)

"BLD",812,"KRN","B",8989.51,8989.51)

"BLD",812,"KRN","B",8989.52,8989.52)

"BLD",812,"KRN","B",8994,8994)

"BLD",812,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
342^3040412
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3040412
"PKG",3,22,1,"PAH",1,1,1,0)
Kernel Patch XU*8.0*342 'Option Access by User Fix'.
"PKG",3,22,1,"PAH",1,1,2,0)
Please refer to the Description in Forum Patch Module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XQ55")
0^1^B21861426
"RTN","XQ55",1,0)
XQ55 ; SEA/AMF,MJM,JLI - SEARCH FOR USERS ACCESS TO AN OPTION [4/12/04 4:36am]
"RTN","XQ55",2,0)
 ;;8.0;KERNEL;**140,342**;Jul 10, 1995
"RTN","XQ55",3,0)
INIT ;
"RTN","XQ55",4,0)
 S XQDSH="-------------------------------------------------------------------------------"
"RTN","XQ55",5,0)
 D ^XQDATE S XQDT=%Y
"RTN","XQ55",6,0)
OPT W ! S DIC=19,DIC(0)="AEQM" D ^DIC G:Y=-1 OUT S XQOPT=+Y
"RTN","XQ55",7,0)
MPAT W !!,"Show menu paths" S %=2 D YN^DICN G:%<0 OUT S XQMP=2-% I '% W !!,"If you answer 'YES', the listing will include the menu path(s) each user has",!,"to access the specified option." G MPAT
"RTN","XQ55",8,0)
 K ^TMP($J),XQR,XQP
"RTN","XQ55",9,0)
 S K=^DIC(19,XQOPT,0),XQHDR="Access to '"_$P(K,U,2)_"'  ["_$P(K,U,1)_"]",XQSCD=0
"RTN","XQ55",10,0)
LOOP1 S K=XQOPT,(L,X(0))=0,XQD=K K XQR,XQA,XQK,XQRV S XQR(K)="" I '$L($P(^DIC(19,K,0),U,3)) D TREE1
"RTN","XQ55",11,0)
 G LOOP2
"RTN","XQ55",12,0)
 Q
"RTN","XQ55",13,0)
TREE S X(L)=$O(^DIC(19,"AD",XQD,X(L))) Q:X(L)'>0  S K=X(L) G:$D(XQR(K)) TREE S XQR(K)=""
"RTN","XQ55",14,0)
TREE1 ;
"RTN","XQ55",15,0)
 S Y(0)=^DIC(19,K,0) G:$L($P(Y(0),U,3)) TREE S:$L($P(Y(0),U,6)) XQK(L)=$P(Y(0),U,6) S XQA(L)=K I $P(Y(0),U,16) S XQRV(L)=^DIC(19,K,3)
"RTN","XQ55",16,0)
 D SETGLO S L=L+1,X(L)=0,(XQD,XQD(L))=K D TREE
"RTN","XQ55",17,0)
 Q:L=1  K XQR(XQD(L)) S L=L-1 K XQA(L),XQK(L),XQRV(L) S XQD=XQD(L) G TREE
"RTN","XQ55",18,0)
 Q
"RTN","XQ55",19,0)
SETGLO ;
"RTN","XQ55",20,0)
 S XQK="" F I=L:-1:0 I $D(XQK(I)),$L(XQK(I)) S XQK=XQK_XQK(I)_","
"RTN","XQ55",21,0)
 S XQRV="" F I=L:-1:0 I $D(XQRV(I)),$L(XQRV(I)) S XQRV=XQRV_XQRV(I)_","
"RTN","XQ55",22,0)
 S XQA="" F I=L:-1:1 I $D(XQA(I)) S XQA=XQA_XQA(I)_","
"RTN","XQ55",23,0)
 S XQA=XQA_XQOPT,J=0 S:$D(^TMP($J,K,0)) J=^(0) S J=J+1,^(0)=J,^TMP($J,K,J)=XQK_U_XQA_U_XQRV
"RTN","XQ55",24,0)
 Q
"RTN","XQ55",25,0)
LOOP2 ;
"RTN","XQ55",26,0)
 S XQPA(0)=0,XQP=0 F  S XQP=$O(^TMP($J,XQP)) Q:XQP=""  S XQN=^TMP($J,XQP,0) S XQPS="AP" D USERS S XQPS="AD" D USERS
"RTN","XQ55",27,0)
 G LOOP3
"RTN","XQ55",28,0)
USERS ;
"RTN","XQ55",29,0)
 S XQU=0 F  S XQU=$O(^VA(200,XQPS,XQP,XQU)) Q:XQU'>0  I $D(^VA(200,XQU,.1)),+$$ACTIVE^XUSER(XQU) D EACHU
"RTN","XQ55",30,0)
 Q
"RTN","XQ55",31,0)
EACHU ;
"RTN","XQ55",32,0)
 S II=1
"RTN","XQ55",33,0)
 F J=1:1:XQN Q:'$D(^TMP($J,XQP,J))  D
"RTN","XQ55",34,0)
 .S XQK=$P(^TMP($J,XQP,J),U,1),XX=$L(XQK,",")-1,XQGO=1
"RTN","XQ55",35,0)
 .I XX F X=1:1:XX S Y=$P(XQK,",",X) I Y'="",('$D(^XUSEC(Y,XQU))) S XQGO=0
"RTN","XQ55",36,0)
 .S XQK=$P(^TMP($J,XQP,J),U,3),XX=$L(XQK,",")-1
"RTN","XQ55",37,0)
 .I XX F X=1:1:XX S Y=$P(XQK,",",X) I Y'="",($D(^XUSEC(Y,XQU))) S XQGO=0
"RTN","XQ55",38,0)
 .D:XQGO SETU
"RTN","XQ55",39,0)
 Q
"RTN","XQ55",40,0)
SETU ;
"RTN","XQ55",41,0)
 S XQPA=$P(^TMP($J,XQP,J),U,2)
"RTN","XQ55",42,0)
 I '$D(XQPA(XQPA)) S I=XQPA(0)+1,XQPA(0)=I,XQPA(0,I)=XQPA,XQPA(XQPA)=I
"RTN","XQ55",43,0)
 S XQPA=XQPA(XQPA) S:XQPS="AD" XQPA=XQPA_"(S)",XQSCD=1
"RTN","XQ55",44,0)
 S I=$P(^VA(200,XQU,0),U,1)_U_XQU S:$D(^TMP($J,0,I)) II=$O(^TMP($J,0,I,"A"),-1)+1 S ^TMP($J,0,I,II)=XQPA
"RTN","XQ55",45,0)
 Q
"RTN","XQ55",46,0)
LOOP3 ;
"RTN","XQ55",47,0)
 I $O(^TMP($J,0,0))="" W !!,"** NO USERS CAN ACCESS THIS OPTION **" G OUT
"RTN","XQ55",48,0)
 S %ZIS="MFQ" D ^%ZIS G OUT:POP I $D(IO("Q")) K IO("Q") S ZTRTN="DQ^XQ55",ZTDESC="OPTION ACCESS BY USER",ZTSAVE("XQ*")="",ZTSAVE("^TMP($J,")="" D ^%ZTLOAD K ZTSK,ZTRTN,ZTSAVE,ZTDESC G OUT
"RTN","XQ55",49,0)
 ;
"RTN","XQ55",50,0)
DQ ;Entry point for queued job
"RTN","XQ55",51,0)
 U IO
"RTN","XQ55",52,0)
 S:'XQMP XQPA(0)=-4 S XQPG=0,XQUI=0 D NEWPG G:XQUI MUS
"RTN","XQ55",53,0)
 S XQU=0 F  S XQU=$O(^TMP($J,0,XQU)) Q:XQU=""  D PRTU G:XQUI MUS
"RTN","XQ55",54,0)
 D:XQMP MENUPAT G MUS
"RTN","XQ55",55,0)
NEWPG ;
"RTN","XQ55",56,0)
 S X="" I XQPG,$E(IOST,1)="C" D CON S XQUI=(X="^") Q:XQUI
"RTN","XQ55",57,0)
 D HDR Q
"RTN","XQ55",58,0)
CON ;
"RTN","XQ55",59,0)
 W !!,"Press return to continue or '^' to escape " R X:DTIME S:'$T X=U
"RTN","XQ55",60,0)
 Q
"RTN","XQ55",61,0)
HDR ;
"RTN","XQ55",62,0)
 W @IOF S XQPG=XQPG+1
"RTN","XQ55",63,0)
 W "Page ",XQPG,?62,XQDT,!! S XQTAB=(76-$L(XQHDR))/2 W ?XQTAB,XQHDR
"RTN","XQ55",64,0)
 W !!,"USER NAME",?27,"LAST ON",?37,"PRIMARY MENU" W:XQMP ?63,"PATH(S)"
"RTN","XQ55",65,0)
 W !,$E(XQDSH,1,25),?27,$E(XQDSH,1,8),?37,$E(XQDSH,1,$S(XQMP:24,1:40)) W:XQMP ?63,$E(XQDSH,1,14)
"RTN","XQ55",66,0)
 Q
"RTN","XQ55",67,0)
PRTU ;
"RTN","XQ55",68,0)
 I $Y>(IOSL-XQPA(0)-8) D:XQMP MENUPAT D NEWPG Q:XQUI
"RTN","XQ55",69,0)
 S J=$P(XQU,U,2),K="" S:$D(^VA(200,J,1.1)) K=$P(^(1.1),"^") S:$L(K) K=$E(K,4,5)_"/"_$E(K,6,7)_"/"_$E(K,2,3) W !,$E($P(XQU,U,1),1,27),?27,K
"RTN","XQ55",70,0)
 I $D(^VA(200,J,201)) S K=+^(201) I K>0,$D(^DIC(19,K,0)) W ?37,$E($P(^(0),U,1),1,24)
"RTN","XQ55",71,0)
 I XQMP D
"RTN","XQ55",72,0)
 .W ?63,""
"RTN","XQ55",73,0)
 .S JJ=$O(^TMP($J,0,XQU,"A"),-1)
"RTN","XQ55",74,0)
 .F II=1:1:JJ W $G(^TMP($J,0,XQU,II)) I II'=JJ W ","
"RTN","XQ55",75,0)
 I 'XQMP D
"RTN","XQ55",76,0)
 .S II=0 F  S II=$O(^TMP($J,0,XQU,II)) Q:II'>0  D
"RTN","XQ55",77,0)
 ..I ^TMP($J,0,XQU,II)["(S)" W "  (Secondary menu)" S II="A"
"RTN","XQ55",78,0)
 Q
"RTN","XQ55",79,0)
MENUPAT ;
"RTN","XQ55",80,0)
 W !!,$E(XQDSH,1,27),"     MENU PATH(S)     ",$E(XQDSH,1,29),!
"RTN","XQ55",81,0)
 F I=1:1:XQPA(0) S K=XQPA(0,I) W !,I,".",?4 F N=1:1 Q:'$L($P(K,",",N))  W:N>1 " ... " W $P(^DIC(19,$P(K,",",N),0),U,1)
"RTN","XQ55",82,0)
 I XQSCD W !,"(S) - secondary menu pathway"
"RTN","XQ55",83,0)
 Q
"RTN","XQ55",84,0)
MUS G:X="^" OUT I XQPG,$E(IOST,1)="C" W !!,"Press return when finished viewing " R X:DTIME W @IOF G OUT
"RTN","XQ55",85,0)
 I $D(ZTSK) K ^%ZTSK(ZTSK)
"RTN","XQ55",86,0)
OUT ;
"RTN","XQ55",87,0)
 D ^%ZISC
"RTN","XQ55",88,0)
KILL K XQDT,XQGO,XQN,XQP,XQR,XQRV,XQOPT,XQPA,XQUI,XQSCD,XQDSH,XQU,N,K,J,X,XQA,XQD,XQHDR,XQK,XQP,XQPS,XQMP,XQPG,XX
"RTN","XQ55",89,0)
 K DIC,I,II,JJ,L,POP,Y I $D(ZTQUEUED),$D(ZTSK),ZTSK>0 K ^%ZTSK(ZTSK)
"RTN","XQ55",90,0)
 Q
"RTN","XUFILE0")
0^2^B6195918
"RTN","XUFILE0",1,0)
XUFILE0 ;OAK-BP/ - GENERATED FROM 'XUFILEINQ' PRINT TEMPLATE (#30) ; [4/6/04 7:42am]
"RTN","XUFILE0",2,0)
 ;;8.0;KERNEL;**342**;Jul 10, 1995
"RTN","XUFILE0",3,0)
 ;;(FILE 200, MARGIN=80)
"RTN","XUFILE0",4,0)
 G BEGIN
"RTN","XUFILE0",5,0)
N W !
"RTN","XUFILE0",6,0)
T W:$X ! I '$D(DIOT(2)),DN,$D(IOSL),$S('$D(DIWF):1,$P(DIWF,"B",2):$P(DIWF,"B",2),1:1)+$Y'<IOSL,$D(^UTILITY($J,1))#2,^(1)?1U1P1E.E X ^(1)
"RTN","XUFILE0",7,0)
 S DISTP=DISTP+1,DILCT=DILCT+1 D:'(DISTP#100) CSTP^DIO2
"RTN","XUFILE0",8,0)
 Q
"RTN","XUFILE0",9,0)
DT I $G(DUZ("LANG"))>1,Y W $$OUT^DIALOGU(Y,"DD") Q
"RTN","XUFILE0",10,0)
 I Y W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",U,$E(Y,4,5))_" " W:Y#100 $J(Y#100\1,2)_"," W Y\10000+1700 W:Y#1 "  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12) Q
"RTN","XUFILE0",11,0)
 W Y Q
"RTN","XUFILE0",12,0)
M D @DIXX
"RTN","XUFILE0",13,0)
 Q
"RTN","XUFILE0",14,0)
BEGIN ;
"RTN","XUFILE0",15,0)
 S:'$D(DN) DN=1 S DISTP=$G(DISTP),DILCT=$G(DILCT)
"RTN","XUFILE0",16,0)
 I $D(DXS)<9 F X=0:0 S X=$O(^DIPT(30,"DXS",X)) Q:'X  S Y=$O(^(X,"")) F X=X:0 Q:Y=""  S DXS(X,Y)=^(Y),Y=$O(^(Y))
"RTN","XUFILE0",17,0)
 D N:$X>37 Q:'DN  W ?37 X DXS(1,9.2) S X=$S(DIP(2):DIP(3),DIP(4):X) K DIP K:DN Y W $E(X,1,35)
"RTN","XUFILE0",18,0)
 S I(1)="""FOF""",J(1)=200.032 F D1=0:0 Q:$O(^VA(200,D0,"FOF",D1))'>0  X:$D(DSC(200.032)) DSC(200.032) S D1=$O(^(D1)) Q:D1'>0  D:$X>74 T Q:'DN  D A1
"RTN","XUFILE0",19,0)
 G A1R
"RTN","XUFILE0",20,0)
A1 ;
"RTN","XUFILE0",21,0)
 D N:$X>0 Q:'DN  W ?0,$E(D1,1,10)
"RTN","XUFILE0",22,0)
 S X=$G(^VA(200,D0,"FOF",D1,0)) D N:$X>10 Q:'DN  W ?11 S Y=$P(X,U,1) S Y=$S(Y="":Y,$D(^DIC(Y,0))#2:$P(^(0),U,1),1:Y) W $E(Y,1,25)
"RTN","XUFILE0",23,0)
 W ?38 S Y=$P(X,U,2) W:Y]"" $J($S($D(DXS(2,Y)):DXS(2,Y),1:Y),3)
"RTN","XUFILE0",24,0)
 W ?43 S Y=$P(X,U,3) W:Y]"" $J($S($D(DXS(3,Y)):DXS(3,Y),1:Y),5)
"RTN","XUFILE0",25,0)
 W ?51 S Y=$P(X,U,4) W:Y]"" $J($S($D(DXS(4,Y)):DXS(4,Y),1:Y),5)
"RTN","XUFILE0",26,0)
 W ?58 S Y=$P(X,U,5) W:Y]"" $J($S($D(DXS(5,Y)):DXS(5,Y),1:Y),4)
"RTN","XUFILE0",27,0)
 W ?64 S Y=$P(X,U,6) W:Y]"" $J($S($D(DXS(6,Y)):DXS(6,Y),1:Y),5)
"RTN","XUFILE0",28,0)
 W ?71 S Y=$P(X,U,7) W:Y]"" $J($S($D(DXS(7,Y)):DXS(7,Y),1:Y),5)
"RTN","XUFILE0",29,0)
 Q
"RTN","XUFILE0",30,0)
A1R ;
"RTN","XUFILE0",31,0)
 K Y
"RTN","XUFILE0",32,0)
 Q
"RTN","XUFILE0",33,0)
HEAD ;
"RTN","XUFILE0",34,0)
 W !,?0,"FILE#",?11,"ACCESSIBLE FILE",?39,"DD",?43,"DELETE",?51,"LAYGO",?58,"READ",?64,"WRITE",?71,"AUDIT"
"RTN","XUFILE0",35,0)
 W !,"--------------------------------------------------------------------------------",!!
"VER")
8.0^22.0
**END**
**END**
