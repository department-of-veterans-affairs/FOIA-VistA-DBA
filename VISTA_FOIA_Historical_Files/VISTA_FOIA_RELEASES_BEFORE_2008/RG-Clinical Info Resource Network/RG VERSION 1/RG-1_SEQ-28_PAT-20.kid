Released RG*1*20 SEQ #28
Extracted from mail message
**KIDS**:RG*1.0*20^

**INSTALL NAME**
RG*1.0*20
"BLD",1303,0)
RG*1.0*20^CLINICAL INFO RESOURCE NETWORK^0^3030304^y
"BLD",1303,1,0)
^^3^3^3030203^
"BLD",1303,1,1,0)
CLASS III UTILITIES CHANGED TO CLASS I
"BLD",1303,1,2,0)
Refer to patch RG*1*20 in the FORUM Patch Module for a complete
"BLD",1303,1,3,0)
description.
"BLD",1303,4,0)
^9.64PA^^
"BLD",1303,"ABNS",0)
^9.66A^^
"BLD",1303,"ABPKG")
^n^
"BLD",1303,"INI")
RGP20PRE
"BLD",1303,"INID")
^^y
"BLD",1303,"INIT")

"BLD",1303,"KRN",0)
^9.67PA^19^17
"BLD",1303,"KRN",.4,0)
.4
"BLD",1303,"KRN",.401,0)
.401
"BLD",1303,"KRN",.402,0)
.402
"BLD",1303,"KRN",.403,0)
.403
"BLD",1303,"KRN",.5,0)
.5
"BLD",1303,"KRN",.84,0)
.84
"BLD",1303,"KRN",3.6,0)
3.6
"BLD",1303,"KRN",3.8,0)
3.8
"BLD",1303,"KRN",9.2,0)
9.2
"BLD",1303,"KRN",9.8,0)
9.8
"BLD",1303,"KRN",9.8,"NM",0)
^9.68A^21^18
"BLD",1303,"KRN",9.8,"NM",1,0)
RGEX05^^0^B6529118
"BLD",1303,"KRN",9.8,"NM",2,0)
RGMTMONT^^0^B30275961
"BLD",1303,"KRN",9.8,"NM",3,0)
RGMTMONX^^0^B57629977
"BLD",1303,"KRN",9.8,"NM",4,0)
RGMTRUN^^0^B3780451
"BLD",1303,"KRN",9.8,"NM",5,0)
RGMTSTAT^^0^B39108053
"BLD",1303,"KRN",9.8,"NM",6,0)
RGMTUT01^^0^B72834119
"BLD",1303,"KRN",9.8,"NM",7,0)
RGMTUT02^^0^B15382663
"BLD",1303,"KRN",9.8,"NM",8,0)
RGMTUT03^^0^B51236296
"BLD",1303,"KRN",9.8,"NM",9,0)
RGMTUT98^^0^B19764107
"BLD",1303,"KRN",9.8,"NM",11,0)
RGSYSTAT^^0^B16713302
"BLD",1303,"KRN",9.8,"NM",12,0)
RGMTTFL^^1^
"BLD",1303,"KRN",9.8,"NM",13,0)
RGP20PRE^^0^B2238126
"BLD",1303,"KRN",9.8,"NM",15,0)
RGMTAUD^^0^B23041015
"BLD",1303,"KRN",9.8,"NM",17,0)
RGADTP^^0^B42731175
"BLD",1303,"KRN",9.8,"NM",18,0)
RGADT2^^0^B25074926
"BLD",1303,"KRN",9.8,"NM",19,0)
RGMTETOT^^0^B36529619
"BLD",1303,"KRN",9.8,"NM",20,0)
RGMTHL2^^0^B46816698
"BLD",1303,"KRN",9.8,"NM",21,0)
RGADTP2^^0^B21277415
"BLD",1303,"KRN",9.8,"NM","B","RGADT2",18)

"BLD",1303,"KRN",9.8,"NM","B","RGADTP",17)

"BLD",1303,"KRN",9.8,"NM","B","RGADTP2",21)

"BLD",1303,"KRN",9.8,"NM","B","RGEX05",1)

"BLD",1303,"KRN",9.8,"NM","B","RGMTAUD",15)

"BLD",1303,"KRN",9.8,"NM","B","RGMTETOT",19)

"BLD",1303,"KRN",9.8,"NM","B","RGMTHL2",20)

"BLD",1303,"KRN",9.8,"NM","B","RGMTMONT",2)

"BLD",1303,"KRN",9.8,"NM","B","RGMTMONX",3)

"BLD",1303,"KRN",9.8,"NM","B","RGMTRUN",4)

"BLD",1303,"KRN",9.8,"NM","B","RGMTSTAT",5)

"BLD",1303,"KRN",9.8,"NM","B","RGMTTFL",12)

"BLD",1303,"KRN",9.8,"NM","B","RGMTUT01",6)

"BLD",1303,"KRN",9.8,"NM","B","RGMTUT02",7)

"BLD",1303,"KRN",9.8,"NM","B","RGMTUT03",8)

"BLD",1303,"KRN",9.8,"NM","B","RGMTUT98",9)

"BLD",1303,"KRN",9.8,"NM","B","RGP20PRE",13)

"BLD",1303,"KRN",9.8,"NM","B","RGSYSTAT",11)

"BLD",1303,"KRN",19,0)
19
"BLD",1303,"KRN",19,"NM",0)
^9.68A^38^38
"BLD",1303,"KRN",19,"NM",1,0)
RGEQ MGR^^1^
"BLD",1303,"KRN",19,"NM",2,0)
RGEQ START^^1^
"BLD",1303,"KRN",19,"NM",3,0)
RGEQ STOP^^1^
"BLD",1303,"KRN",19,"NM",4,0)
RGEQ AUTOSTART^^1^
"BLD",1303,"KRN",19,"NM",5,0)
RG CMOR MAIN^^1^
"BLD",1303,"KRN",19,"NM",6,0)
RG CMOR START^^1^
"BLD",1303,"KRN",19,"NM",7,0)
RG CMOR STOP^^1^
"BLD",1303,"KRN",19,"NM",8,0)
RG CMOR INDIV^^1^
"BLD",1303,"KRN",19,"NM",9,0)
RG CMOR STATUS^^1^
"BLD",1303,"KRN",19,"NM",10,0)
RG CMOR DUP SCORES^^1^
"BLD",1303,"KRN",19,"NM",11,0)
RG CMOR DUP STATS^^1^
"BLD",1303,"KRN",19,"NM",12,0)
RG CMOR USER MENU^^1^
"BLD",1303,"KRN",19,"NM",13,0)
RGMT AUDIT TF STATISTICS^^1^
"BLD",1303,"KRN",19,"NM",14,0)
RGMGR^^0
"BLD",1303,"KRN",19,"NM",15,0)
RG ADMIN COORD MENU^^0
"BLD",1303,"KRN",19,"NM",16,0)
RG ADMIN USER MENU^^0
"BLD",1303,"KRN",19,"NM",17,0)
RG IRM MENU^^0
"BLD",1303,"KRN",19,"NM",18,0)
RG TRAN/AUD AUD REP^^0
"BLD",1303,"KRN",19,"NM",19,0)
RGMT AUDIT PRINT^^0
"BLD",1303,"KRN",19,"NM",20,0)
RGMT AUDIT SINGLE^^0
"BLD",1303,"KRN",19,"NM",21,0)
RG EXCEPTION MENU^^0
"BLD",1303,"KRN",19,"NM",22,0)
RG EXCEPTION POTENTIAL MATCH^^0
"BLD",1303,"KRN",19,"NM",23,0)
RG EXCEPTION HANDLING^^0
"BLD",1303,"KRN",19,"NM",24,0)
RG EXCEPTION TF INQUIRY^^0
"BLD",1303,"KRN",19,"NM",25,0)
RG REMOTE PDAT MENU^^0
"BLD",1303,"KRN",19,"NM",26,0)
RG REMOTE PDAT SEND^^0
"BLD",1303,"KRN",19,"NM",27,0)
RG REMOTE PDAT CHECK^^0
"BLD",1303,"KRN",19,"NM",28,0)
RG REMOTE PDAT DISPLAY^^0
"BLD",1303,"KRN",19,"NM",29,0)
RG MGT REPORTS^^0
"BLD",1303,"KRN",19,"NM",30,0)
RGPR PRE-IMP SSN REPORT^^0
"BLD",1303,"KRN",19,"NM",31,0)
RG LINKS & PROCESS DISPLAY^^0
"BLD",1303,"KRN",19,"NM",32,0)
RG STATUS DISPLAY^^0
"BLD",1303,"KRN",19,"NM",33,0)
RG NATIONAL ICN STATISTICS^^0
"BLD",1303,"KRN",19,"NM",34,0)
RG UPDATE POINT OF CONTACT^^0
"BLD",1303,"KRN",19,"NM",35,0)
VAFC EXCEPTION HANDLER^^0
"BLD",1303,"KRN",19,"NM",36,0)
MPIF CMOR MGR^^4^
"BLD",1303,"KRN",19,"NM",37,0)
MPIF SITE PARAMETER^^4^
"BLD",1303,"KRN",19,"NM",38,0)
MPIF VISTA MENU^^4^
"BLD",1303,"KRN",19,"NM","B","MPIF CMOR MGR",36)

"BLD",1303,"KRN",19,"NM","B","MPIF SITE PARAMETER",37)

"BLD",1303,"KRN",19,"NM","B","MPIF VISTA MENU",38)

"BLD",1303,"KRN",19,"NM","B","RG ADMIN COORD MENU",15)

"BLD",1303,"KRN",19,"NM","B","RG ADMIN USER MENU",16)

"BLD",1303,"KRN",19,"NM","B","RG CMOR DUP SCORES",10)

"BLD",1303,"KRN",19,"NM","B","RG CMOR DUP STATS",11)

"BLD",1303,"KRN",19,"NM","B","RG CMOR INDIV",8)

"BLD",1303,"KRN",19,"NM","B","RG CMOR MAIN",5)

"BLD",1303,"KRN",19,"NM","B","RG CMOR START",6)

"BLD",1303,"KRN",19,"NM","B","RG CMOR STATUS",9)

"BLD",1303,"KRN",19,"NM","B","RG CMOR STOP",7)

"BLD",1303,"KRN",19,"NM","B","RG CMOR USER MENU",12)

"BLD",1303,"KRN",19,"NM","B","RG EXCEPTION HANDLING",23)

"BLD",1303,"KRN",19,"NM","B","RG EXCEPTION MENU",21)

"BLD",1303,"KRN",19,"NM","B","RG EXCEPTION POTENTIAL MATCH",22)

"BLD",1303,"KRN",19,"NM","B","RG EXCEPTION TF INQUIRY",24)

"BLD",1303,"KRN",19,"NM","B","RG IRM MENU",17)

"BLD",1303,"KRN",19,"NM","B","RG LINKS & PROCESS DISPLAY",31)

"BLD",1303,"KRN",19,"NM","B","RG MGT REPORTS",29)

"BLD",1303,"KRN",19,"NM","B","RG NATIONAL ICN STATISTICS",33)

"BLD",1303,"KRN",19,"NM","B","RG REMOTE PDAT CHECK",27)

"BLD",1303,"KRN",19,"NM","B","RG REMOTE PDAT DISPLAY",28)

"BLD",1303,"KRN",19,"NM","B","RG REMOTE PDAT MENU",25)

"BLD",1303,"KRN",19,"NM","B","RG REMOTE PDAT SEND",26)

"BLD",1303,"KRN",19,"NM","B","RG STATUS DISPLAY",32)

"BLD",1303,"KRN",19,"NM","B","RG TRAN/AUD AUD REP",18)

"BLD",1303,"KRN",19,"NM","B","RG UPDATE POINT OF CONTACT",34)

"BLD",1303,"KRN",19,"NM","B","RGEQ AUTOSTART",4)

"BLD",1303,"KRN",19,"NM","B","RGEQ MGR",1)

"BLD",1303,"KRN",19,"NM","B","RGEQ START",2)

"BLD",1303,"KRN",19,"NM","B","RGEQ STOP",3)

"BLD",1303,"KRN",19,"NM","B","RGMGR",14)

"BLD",1303,"KRN",19,"NM","B","RGMT AUDIT PRINT",19)

"BLD",1303,"KRN",19,"NM","B","RGMT AUDIT SINGLE",20)

"BLD",1303,"KRN",19,"NM","B","RGMT AUDIT TF STATISTICS",13)

"BLD",1303,"KRN",19,"NM","B","RGPR PRE-IMP SSN REPORT",30)

"BLD",1303,"KRN",19,"NM","B","VAFC EXCEPTION HANDLER",35)

"BLD",1303,"KRN",19.1,0)
19.1
"BLD",1303,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",1303,"KRN",101,0)
101
"BLD",1303,"KRN",409.61,0)
409.61
"BLD",1303,"KRN",771,0)
771
"BLD",1303,"KRN",870,0)
870
"BLD",1303,"KRN",8994,0)
8994
"BLD",1303,"KRN","B",.4,.4)

"BLD",1303,"KRN","B",.401,.401)

"BLD",1303,"KRN","B",.402,.402)

"BLD",1303,"KRN","B",.403,.403)

"BLD",1303,"KRN","B",.5,.5)

"BLD",1303,"KRN","B",.84,.84)

"BLD",1303,"KRN","B",3.6,3.6)

"BLD",1303,"KRN","B",3.8,3.8)

"BLD",1303,"KRN","B",9.2,9.2)

"BLD",1303,"KRN","B",9.8,9.8)

"BLD",1303,"KRN","B",19,19)

"BLD",1303,"KRN","B",19.1,19.1)

"BLD",1303,"KRN","B",101,101)

"BLD",1303,"KRN","B",409.61,409.61)

"BLD",1303,"KRN","B",771,771)

"BLD",1303,"KRN","B",870,870)

"BLD",1303,"KRN","B",8994,8994)

"BLD",1303,"QUES",0)
^9.62^^
"BLD",1303,"REQB",0)
^9.611^8^4
"BLD",1303,"REQB",2,0)
RG*1.0*25^2
"BLD",1303,"REQB",4,0)
RG*1.0*19^2
"BLD",1303,"REQB",7,0)
RG*1.0*28^2
"BLD",1303,"REQB",8,0)
RG*1.0*17^2
"BLD",1303,"REQB","B","RG*1.0*17",8)

"BLD",1303,"REQB","B","RG*1.0*19",4)

"BLD",1303,"REQB","B","RG*1.0*25",2)

"BLD",1303,"REQB","B","RG*1.0*28",7)

"INI")
RGP20PRE
"KRN",19,5469,-1)
4^36
"KRN",19,5469,0)
MPIF CMOR MGR
"KRN",19,5474,-1)
4^37
"KRN",19,5474,0)
MPIF SITE PARAMETER
"KRN",19,5488,-1)
0^35
"KRN",19,5488,0)
VAFC EXCEPTION HANDLER^Patient Data Review^^R^^^^^^^^REGISTRATION
"KRN",19,5488,1,0)
^19.06^5^5^3010706^^^^
"KRN",19,5488,1,1,0)
This option is used to review demographic data that is logged into
"KRN",19,5488,1,2,0)
the PATIENT DATA EXCEPTION (#391.98) file from other sites.  It
"KRN",19,5488,1,3,0)
allows a user to upload or merge the data into the receiving site's
"KRN",19,5488,1,4,0)
database.  Reviewing and resolving these cases is an important step
"KRN",19,5488,1,5,0)
in maintaining the accuracy and integrity of the patient's data.
"KRN",19,5488,25)
EN^VAFCEHLM
"KRN",19,5488,"U")
PATIENT DATA REVIEW
"KRN",19,5660,-1)
0^14
"KRN",19,5660,0)
RGMGR^MPI/PD Master Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK^^
"KRN",19,5660,1,0)
^19.06^4^4^3020813^^^^
"KRN",19,5660,1,1,0)
This is the primary menu that contains all Master Patient Index/
"KRN",19,5660,1,2,0)
Patient Demographics (MPI/PD) menus. The sub-menus will be 
"KRN",19,5660,1,3,0)
assigned to other users as appropriate and are described in the 
"KRN",19,5660,1,4,0)
Implementation Guide.
"KRN",19,5660,10,0)
^19.01IP^5^3
"KRN",19,5660,10,3,0)
5662^IRM^30
"KRN",19,5660,10,3,"^")
RG IRM MENU
"KRN",19,5660,10,4,0)
5663^CORD^10
"KRN",19,5660,10,4,"^")
RG ADMIN COORD MENU
"KRN",19,5660,10,5,0)
5664^ADU^20
"KRN",19,5660,10,5,"^")
RG ADMIN USER MENU
"KRN",19,5660,20)

"KRN",19,5660,99)
58603,55757
"KRN",19,5660,99.1)
59016,39149
"KRN",19,5660,"U")
MPI/PD MASTER MENU
"KRN",19,5662,-1)
0^17
"KRN",19,5662,0)
RG IRM MENU^MPI/PD IRM Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5662,1,0)
^19.06^3^3^3020813^^^^
"KRN",19,5662,1,1,0)
This option provides the Information Resource Management (IRM) 
"KRN",19,5662,1,2,0)
personnel with the options needed to maintain Master Patient 
"KRN",19,5662,1,3,0)
Index/Patient Demographics (MPI/PD).
"KRN",19,5662,10,0)
^19.01IP^6^2
"KRN",19,5662,10,3,0)
6720^^20
"KRN",19,5662,10,3,"^")
RG STATUS DISPLAY
"KRN",19,5662,10,6,0)
6826^^10
"KRN",19,5662,10,6,"^")
RG LINKS & PROCESS DISPLAY
"KRN",19,5662,99)
59029,33208
"KRN",19,5662,"U")
MPI/PD IRM MENU
"KRN",19,5663,-1)
0^15
"KRN",19,5663,0)
RG ADMIN COORD MENU^MPI/PD Patient Admin Coordinator Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK^^^
"KRN",19,5663,1,0)
^19.06^3^3^3020813^^^^
"KRN",19,5663,1,1,0)
The MPI/PD Patient Admin Coordinator Menu [RG ADMIN COORD 
"KRN",19,5663,1,2,0)
MENU] options allow control and monitoring of CMOR and 
"KRN",19,5663,1,3,0)
patient data activities.
"KRN",19,5663,10,0)
^19.01IP^41^7
"KRN",19,5663,10,6,0)
5664^ADU^30
"KRN",19,5663,10,6,"^")
RG ADMIN USER MENU
"KRN",19,5663,10,23,0)
5474^SP^10
"KRN",19,5663,10,23,"^")
MPIF SITE PARAMETER
"KRN",19,5663,10,30,0)
5685^LOG^40
"KRN",19,5663,10,30,"^")
RG TRAN/AUD AUD REP
"KRN",19,5663,10,36,0)
5774^MPI^50
"KRN",19,5663,10,36,"^")
MPIF VISTA MENU
"KRN",19,5663,10,38,0)
6403^MSG^60
"KRN",19,5663,10,38,"^")
RG EXCEPTION MENU
"KRN",19,5663,10,39,0)
6732^RPT^70
"KRN",19,5663,10,39,"^")
RG MGT REPORTS
"KRN",19,5663,10,41,0)
6747^POC^80
"KRN",19,5663,10,41,"^")
RG UPDATE POINT OF CONTACT
"KRN",19,5663,10.1)

"KRN",19,5663,15)

"KRN",19,5663,20)

"KRN",19,5663,99)
59029,33592
"KRN",19,5663,"U")
MPI/PD PATIENT ADMIN COORDINAT
"KRN",19,5664,-1)
0^16
"KRN",19,5664,0)
RG ADMIN USER MENU^MPI/PD Patient Admin User Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5664,1,0)
^19.06^3^3^3010706^^^^
"KRN",19,5664,1,1,0)
This option provides the user with the MPI/PD Patient Admin User
"KRN",19,5664,1,2,0)
Menu [RG ADMIN USER MENU].  This menu includes the Patient Data
"KRN",19,5664,1,3,0)
Review option and the menu for changing and managing CMORs.
"KRN",19,5664,10,0)
^19.01IP^2^2
"KRN",19,5664,10,1,0)
5488^^5
"KRN",19,5664,10,1,"^")
VAFC EXCEPTION HANDLER
"KRN",19,5664,10,2,0)
5469^^10
"KRN",19,5664,10,2,"^")
MPIF CMOR MGR
"KRN",19,5664,99)
58771,41942
"KRN",19,5664,"U")
MPI/PD PATIENT ADMIN USER MENU
"KRN",19,5685,-1)
0^18
"KRN",19,5685,0)
RG TRAN/AUD AUD REP^Patient Audit Log Reports^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5685,1,0)
^19.06^4^4^3010706^^^^
"KRN",19,5685,1,1,0)
This menu contains two options for reviewing information stored in
"KRN",19,5685,1,2,0)
the AUDIT (#1.1) file for fields being audited in the PATIENT (#2) file.
"KRN",19,5685,1,3,0)
Options allow the user to (1) view all audited fields or selected fields
"KRN",19,5685,1,4,0)
for a date range or (2) all audited data on a single patient.
"KRN",19,5685,10,0)
^19.01IP^3^2
"KRN",19,5685,10,2,0)
5767^^10
"KRN",19,5685,10,2,"^")
RGMT AUDIT PRINT
"KRN",19,5685,10,3,0)
6733^^20
"KRN",19,5685,10,3,"^")
RGMT AUDIT SINGLE
"KRN",19,5685,99)
58945,39533
"KRN",19,5685,"U")
PATIENT AUDIT LOG REPORTS
"KRN",19,5767,-1)
0^19
"KRN",19,5767,0)
RGMT AUDIT PRINT^Patient Audit File Print^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5767,1,0)
^^11^11^2971118^^^^
"KRN",19,5767,1,1,0)
This option prints information stored in the AUDIT file (#1.1) for 
"KRN",19,5767,1,2,0)
fields being audited in the PATIENT file (#2).  For a specified date 
"KRN",19,5767,1,3,0)
range, you can view all audited fields or selected fields.
"KRN",19,5767,1,4,0)
  
"KRN",19,5767,1,5,0)
If selected fields are viewed, you can choose to see data for all or 
"KRN",19,5767,1,6,0)
selected patients.  If all audited fields are viewed, you must 
"KRN",19,5767,1,7,0)
choose the patients to examine.
"KRN",19,5767,1,8,0)
  
"KRN",19,5767,1,9,0)
The report prints the patient name and DFN, date/time the field was 
"KRN",19,5767,1,10,0)
edited, the user who made the change, the field edited, the old 
"KRN",19,5767,1,11,0)
value, and the new value.  The right margin for this report is 80.
"KRN",19,5767,25)
RGMTAUDP
"KRN",19,5767,"U")
PATIENT AUDIT FILE PRINT
"KRN",19,5774,-1)
4^38
"KRN",19,5774,0)
MPIF VISTA MENU
"KRN",19,5864,-1)
0^30
"KRN",19,5864,0)
RGPR PRE-IMP SSN REPORT^Pseudo-SSN Report^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,5864,1,0)
^19.06^6^6^3010613^^^
"KRN",19,5864,1,1,0)
This is the standard Pseudo-SSN (Social Security Number) report.
"KRN",19,5864,1,2,0)
Users should run this report to a 132-column printer, call the 
"KRN",19,5864,1,3,0)
patients and get the correct SSN, and then update via use of 
"KRN",19,5864,1,4,0)
the Load/Edit Patient Data option [DG LOAD PATIENT DATA] in 
"KRN",19,5864,1,5,0)
the Patient Information Management System (PIMS) software 
"KRN",19,5864,1,6,0)
Registration Menu option [DG REGISTRATION MENU].
"KRN",19,5864,25)
RGPRSSN
"KRN",19,5864,"U")
PSEUDO-SSN REPORT
"KRN",19,6403,-1)
0^21
"KRN",19,6403,0)
RG EXCEPTION MENU^Message Exception Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6403,1,0)
^19.06^2^2^3010706^^^^
"KRN",19,6403,1,1,0)
This menu is used to process MPI/PD Health Level Seven (HL7) message
"KRN",19,6403,1,2,0)
exceptions logged in the CIRN HL7 EXCEPTION LOG (#991.1) file.
"KRN",19,6403,10,0)
^19.01IP^5^4
"KRN",19,6403,10,1,0)
6404^^1
"KRN",19,6403,10,1,"^")
RG EXCEPTION POTENTIAL MATCH
"KRN",19,6403,10,3,0)
6712^^10
"KRN",19,6403,10,3,"^")
RG EXCEPTION TF INQUIRY
"KRN",19,6403,10,4,0)
6738^^5
"KRN",19,6403,10,4,"^")
RG EXCEPTION HANDLING
"KRN",19,6403,10,5,0)
6754^^15
"KRN",19,6403,10,5,"^")
RG REMOTE PDAT MENU
"KRN",19,6403,99)
58994,47074
"KRN",19,6403,"U")
MESSAGE EXCEPTION MENU
"KRN",19,6404,-1)
0^22
"KRN",19,6404,0)
RG EXCEPTION POTENTIAL MATCH^View Potential Match Patient^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6404,1,0)
^19.06^8^8^3010706^^^^
"KRN",19,6404,1,1,0)
This option produces a list of patients from the CIRN HL7 EXCEPTION 
"KRN",19,6404,1,2,0)
LOG (#991.1) file who have been identified as having more than one 
"KRN",19,6404,1,3,0)
potential match on the Master Patient Index (MPI).  These patients 
"KRN",19,6404,1,4,0)
have not been resolved using the Single Patient Initialization to 
"KRN",19,6404,1,5,0)
MPI option [MPIF IND MPI LOAD].
"KRN",19,6404,1,6,0)
  
"KRN",19,6404,1,7,0)
Before producing the report, this option purges DUPLICATE potential 
"KRN",19,6404,1,8,0)
match entries from the CIRN HL7 EXCEPTION LOG (#991.1) file.
"KRN",19,6404,25)
RGEVPM
"KRN",19,6404,"U")
VIEW POTENTIAL MATCH PATIENT
"KRN",19,6712,-1)
0^24
"KRN",19,6712,0)
RG EXCEPTION TF INQUIRY^Patient MPI/PD Data Inquiry^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6712,1,0)
^19.06^5^5^3011220^^
"KRN",19,6712,1,1,0)
This report provides MPI/PD Data for a selected patient.  
"KRN",19,6712,1,2,0)
Information displayed includes the Integration Control Number (ICN),
"KRN",19,6712,1,3,0)
the Coordinating Master of Record (CMOR) site, MPI/PD Activity Score,
"KRN",19,6712,1,4,0)
Subscription Control Number, Treating Facility list, CMOR History 
"KRN",19,6712,1,5,0)
and CMOR Change Request History.
"KRN",19,6712,25)
PDAT^RGEX01
"KRN",19,6712,"U")
PATIENT MPI/PD DATA INQUIRY
"KRN",19,6720,-1)
0^32
"KRN",19,6720,0)
RG STATUS DISPLAY^Unresolved Exception Summary^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6720,1,0)
^19.06^19^19^3020813^^^
"KRN",19,6720,1,1,0)
 The Unresolved Exception Summary calculates and presents the
"KRN",19,6720,1,2,0)
 following data.
"KRN",19,6720,1,3,0)
 - the number of unresolved exceptions in the CIRN HL7 EXCEPTION LOG 
"KRN",19,6720,1,4,0)
   (#991.1) file for the MPI/PD related entries (e.g., internal 
"KRN",19,6720,1,5,0)
   entry numbers 209, 213-218, 227) in the CIRN HL7 EXCEPTION TYPE
"KRN",19,6720,1,6,0)
   (#991.11) file,
"KRN",19,6720,1,7,0)
 - the number of unique patients with exceptions,
"KRN",19,6720,1,8,0)
 - the number of unresolved exceptions in the PATIENT DATA EXCEPTION
"KRN",19,6720,1,9,0)
   (#391.98) file with an EXCEPTION STATUS (#391.984) file value of
"KRN",19,6720,1,10,0)
   ACTION REQUIRED, DATA EXAMINED or BEING REVIEWED,
"KRN",19,6720,1,11,0)
 - the number of entries in the MPIF CMOR REQUEST (#984.9) file with
"KRN",19,6720,1,12,0)
   a STATUS (#.06) field value of OPEN, REQUESTED, PENDING APPROVAL,
"KRN",19,6720,1,13,0)
   APPROVED or DISAPPROVED,
"KRN",19,6720,1,14,0)
 
"KRN",19,6720,1,15,0)
 The Exception Handler and Patient Data Review numbers indicate how
"KRN",19,6720,1,16,0)
 up-to-date a site is in exception resolution.  The CMOR request
"KRN",19,6720,1,17,0)
 numbers specify how many requests for change of CMOR have been sent
"KRN",19,6720,1,18,0)
 and their resulting status.  This data can be useful in reducing the
"KRN",19,6720,1,19,0)
 number of exceptions.
"KRN",19,6720,25)
RGSYSTAT
"KRN",19,6720,"U")
UNRESOLVED EXCEPTION SUMMARY
"KRN",19,6732,-1)
0^29
"KRN",19,6732,0)
RG MGT REPORTS^Management Reports^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6732,1,0)
^19.06^2^2^3020813^^^
"KRN",19,6732,1,1,0)
This menu contains management reports for the MPI/PD Patient
"KRN",19,6732,1,2,0)
Administration Coordinator.
"KRN",19,6732,10,0)
^19.01IP^5^4
"KRN",19,6732,10,1,0)
5864^^10
"KRN",19,6732,10,1,"^")
RGPR PRE-IMP SSN REPORT
"KRN",19,6732,10,3,0)
6720^^30
"KRN",19,6732,10,3,"^")
RG STATUS DISPLAY
"KRN",19,6732,10,4,0)
6826^^20
"KRN",19,6732,10,4,"^")
RG LINKS & PROCESS DISPLAY
"KRN",19,6732,10,5,0)
6827^^40
"KRN",19,6732,10,5,"^")
RG NATIONAL ICN STATISTICS
"KRN",19,6732,99)
59029,34098
"KRN",19,6732,"U")
MANAGEMENT REPORTS
"KRN",19,6733,-1)
0^20
"KRN",19,6733,0)
RGMT AUDIT SINGLE^Single Patient Audit File Print^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6733,1,0)
^19.06^7^7^3010706^^
"KRN",19,6733,1,1,0)
This option prints information from the AUDIT (#1.1) file for a 
"KRN",19,6733,1,2,0)
selected patient and date range.
"KRN",19,6733,1,3,0)
   
"KRN",19,6733,1,4,0)
The report prints the patient name and DFN, date/time the field was
"KRN",19,6733,1,5,0)
edited, the user who made the change, the field edited, the old value,
"KRN",19,6733,1,6,0)
the new value and the option or protocol used to do the edit.  The 
"KRN",19,6733,1,7,0)
right margin for this report is 80.
"KRN",19,6733,25)
RGMTAUD
"KRN",19,6733,"U")
SINGLE PATIENT AUDIT FILE PRIN
"KRN",19,6738,-1)
0^23
"KRN",19,6738,0)
RG EXCEPTION HANDLING^MPI/PD Exception Handling^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6738,1,0)
^19.06^4^4^3010706^^
"KRN",19,6738,1,1,0)
This option provides utilities for processing MPI/PD Exceptions
"KRN",19,6738,1,2,0)
in the CIRN HL7 EXCEPTION LOG (#991.1) file.  This list manager
"KRN",19,6738,1,3,0)
based option displays exceptions and allows the user to choose an
"KRN",19,6738,1,4,0)
exception case for review and resolution.
"KRN",19,6738,25)
EN^RGEX01
"KRN",19,6738,"U")
MPI/PD EXCEPTION HANDLING
"KRN",19,6747,-1)
0^34
"KRN",19,6747,0)
RG UPDATE POINT OF CONTACT^Add/Edit Point of Contact^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6747,1,0)
^19.06^7^7^3011106^^^^
"KRN",19,6747,1,1,0)
This option allows a facility to update their point of contact
"KRN",19,6747,1,2,0)
information for Master Patient Index/Patient Demographics (MPI/PD).
"KRN",19,6747,1,3,0)
Names and phone numbers can be edited for the administrative, IRM,
"KRN",19,6747,1,4,0)
HL7, and alternate contacts.  At the conclusion of the edit process,
"KRN",19,6747,1,5,0)
the information is transmitted to a remote mail group on the Austin
"KRN",19,6747,1,6,0)
MPI system.  The Data Management staff will use this information to
"KRN",19,6747,1,7,0)
update the website.
"KRN",19,6747,25)
RGPOC
"KRN",19,6747,"U")
ADD/EDIT POINT OF CONTACT
"KRN",19,6751,-1)
0^26
"KRN",19,6751,0)
RG REMOTE PDAT SEND^Send Remote Patient Data Query^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6751,1,0)
^19.06^5^5^3011115^^
"KRN",19,6751,1,1,0)
This option allows you to send remote patient data queries from 
"KRN",19,6751,1,2,0)
your facility to any facility at which a selected patient has 
"KRN",19,6751,1,3,0)
been seen.  The remote data fields retrieved are the same as 
"KRN",19,6751,1,4,0)
those that are available for local data using the Patient MPI/PD 
"KRN",19,6751,1,5,0)
Data Inquiry [RG EXCEPTION TF INQUIRY] option.
"KRN",19,6751,25)
SEND2^RGRPDAT
"KRN",19,6751,"U")
SEND REMOTE PATIENT DATA QUERY
"KRN",19,6752,-1)
0^27
"KRN",19,6752,0)
RG REMOTE PDAT CHECK^Check Remote Patient Data Query^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6752,1,0)
^19.06^3^3^3011115^^^
"KRN",19,6752,1,1,0)
This option allows you to check the status of a remote patient 
"KRN",19,6752,1,2,0)
data query previously sent using the Send Remote Patient 
"KRN",19,6752,1,3,0)
Data Query [RG REMOTE PDAT SEND] option.
"KRN",19,6752,25)
CHKSTAT2^RGRPDAT
"KRN",19,6752,"U")
CHECK REMOTE PATIENT DATA QUER
"KRN",19,6753,-1)
0^28
"KRN",19,6753,0)
RG REMOTE PDAT DISPLAY^Display Remote Patient Data Query^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6753,1,0)
^19.06^3^3^3011115^^
"KRN",19,6753,1,1,0)
This option allows you to display a patient data query previously
"KRN",19,6753,1,2,0)
sent using the Send Remote Patient Data Query [RG REMOTE PDAT SEND]
"KRN",19,6753,1,3,0)
option.
"KRN",19,6753,25)
DISP2^RGRPDAT
"KRN",19,6753,"U")
DISPLAY REMOTE PATIENT DATA QU
"KRN",19,6754,-1)
0^25
"KRN",19,6754,0)
RG REMOTE PDAT MENU^Remote Patient Data Query Menu^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6754,1,0)
^19.06^7^7^3011220^^^^
"KRN",19,6754,1,1,0)
This menu provides options to query any facility at which a selected
"KRN",19,6754,1,2,0)
patient has been seen, check the query, and display the remote patient
"KRN",19,6754,1,3,0)
data that is returned from that site.  The remote data fields retrieved
"KRN",19,6754,1,4,0)
include the Integration Control Number (ICN), the Coordinating Master
"KRN",19,6754,1,5,0)
of Record (CMOR) site, MPI/PD Activity Score, Subscription Control
"KRN",19,6754,1,6,0)
Number, Treating Facility list, CMOR History and CMOR Change Request 
"KRN",19,6754,1,7,0)
History.
"KRN",19,6754,10,0)
^19.01IP^3^3
"KRN",19,6754,10,1,0)
6751^^10
"KRN",19,6754,10,1,"^")
RG REMOTE PDAT SEND
"KRN",19,6754,10,2,0)
6752^^20
"KRN",19,6754,10,2,"^")
RG REMOTE PDAT CHECK
"KRN",19,6754,10,3,0)
6753^^30
"KRN",19,6754,10,3,"^")
RG REMOTE PDAT DISPLAY
"KRN",19,6754,99)
58750,57087
"KRN",19,6754,"U")
REMOTE PATIENT DATA QUERY MENU
"KRN",19,6826,-1)
0^31
"KRN",19,6826,0)
RG LINKS & PROCESS DISPLAY^Link and Process Status Display ^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6826,1,0)
^19.06^9^9^3020813^^^^
"KRN",19,6826,1,1,0)
This option is used to monitor the status of MPI/PD related functions 
"KRN",19,6826,1,2,0)
and messaging.  The monitor displays the following information.  
"KRN",19,6826,1,3,0)
 - HL links that currently have messages to be processed on either 
"KRN",19,6826,1,4,0)
   the inbound or outbound queues and the current STATE of the link.  
"KRN",19,6826,1,5,0)
 - Status of MPI/PD background jobs.  
"KRN",19,6826,1,6,0)
 - Current audit status on the NAME (#.01) field in the PATIENT
"KRN",19,6826,1,7,0)
   (#2) file.  
"KRN",19,6826,1,8,0)
 - Current status of the SEND parameters for HL7 messaging.  
"KRN",19,6826,1,9,0)
 - Local link management information.  
"KRN",19,6826,25)
RGMTMONT
"KRN",19,6826,"U")
LINK AND PROCESS STATUS DISPLA
"KRN",19,6827,-1)
0^33
"KRN",19,6827,0)
RG NATIONAL ICN STATISTICS^National ICN Statistics^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6827,1,0)
^19.06^6^6^3020812^^
"KRN",19,6827,1,1,0)
This option provides the following statistics:
"KRN",19,6827,1,2,0)
 - Total number of patients assigned to each unique COORDINATING 
"KRN",19,6827,1,3,0)
   MASTER OF RECORD (CMOR).
"KRN",19,6827,1,4,0)
 - Total number of patients shared with each unique entry in the
"KRN",19,6827,1,5,0)
   TREATING FACILITY LIST (#391.91) file.
"KRN",19,6827,1,6,0)
 - Totals for national ICNs, local ICNs, and patients with no ICN.
"KRN",19,6827,25)
EN3^RGMTUT01
"KRN",19,6827,"U")
NATIONAL ICN STATISTICS
"KRN",19,6866,-1)
1^1
"KRN",19,6866,0)
RGEQ MGR
"KRN",19,6867,-1)
1^2
"KRN",19,6867,0)
RGEQ START
"KRN",19,6868,-1)
1^3
"KRN",19,6868,0)
RGEQ STOP
"KRN",19,6869,-1)
1^4
"KRN",19,6869,0)
RGEQ AUTOSTART
"KRN",19,6870,-1)
1^5
"KRN",19,6870,0)
RG CMOR MAIN
"KRN",19,6871,-1)
1^6
"KRN",19,6871,0)
RG CMOR START
"KRN",19,6872,-1)
1^7
"KRN",19,6872,0)
RG CMOR STOP
"KRN",19,6873,-1)
1^8
"KRN",19,6873,0)
RG CMOR INDIV
"KRN",19,6874,-1)
1^9
"KRN",19,6874,0)
RG CMOR STATUS
"KRN",19,6875,-1)
1^10
"KRN",19,6875,0)
RG CMOR DUP SCORES
"KRN",19,6876,-1)
1^11
"KRN",19,6876,0)
RG CMOR DUP STATS
"KRN",19,6877,-1)
1^12
"KRN",19,6877,0)
RG CMOR USER MENU
"KRN",19,6878,-1)
1^13
"KRN",19,6878,0)
RGMT AUDIT TF STATISTICS
"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
20^3030304
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3030304
"PKG",272,22,1,"PAH",1,1,1,0)
CLASS III UTILITIES CHANGED TO CLASS I
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*20 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
18
"RTN","RGADT2")
0^18^B25074926
"RTN","RGADT2",1,0)
RGADT2 ;HIRMFO/GJC-TFL FILE SEEDING ROUTINE (PD-MPI LOAD) ;09/21/99
"RTN","RGADT2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**4,17,20**;30 Apr 99
"RTN","RGADT2",3,0)
 Q  ; quit if called from the top
"RTN","RGADT2",4,0)
 ;
"RTN","RGADT2",5,0)
EN ; entry point to check the TREATING FACILITY LIST (TFL-391.91) file
"RTN","RGADT2",6,0)
 ; for the proper LAST TREATMENT DATE.  This code is part of the post
"RTN","RGADT2",7,0)
 ; init for RG*1*4.  This can also be called from the EN1 entry point
"RTN","RGADT2",8,0)
 ; to determine the LAST TREATMENT DATE for a specific patient.
"RTN","RGADT2",9,0)
 ; Closely linked to the MFU event message broadcasts used to update
"RTN","RGADT2",10,0)
 ; the TFL (#391.91) file.
"RTN","RGADT2",11,0)
 ;
"RTN","RGADT2",12,0)
 ;IA: 2053 - FILE^DIE
"RTN","RGADT2",13,0)
 ;IA: 2070 - check for national ICN, 1st piece "MPI" node (global read)
"RTN","RGADT2",14,0)
 ;IA: 2701 - $$IFLOCAL^MPIF001
"RTN","RGADT2",15,0)
 ;IA: 2546 - GETGEN/PARSE^SDOE
"RTN","RGADT2",16,0)
 ;IA: 2988 - FILE^VAFCTFU
"RTN","RGADT2",17,0)
 ;IA: 2541 - $$KSP^XUPARAM
"RTN","RGADT2",18,0)
 ;IA: 2953 - ^SCE("ADFN"
"RTN","RGADT2",19,0)
 ;IA: 10061 - IN5^VADPT
"RTN","RGADT2",20,0)
 ;IA: 10103 - $$FMDIFF/$$NOW^XLFDT
"RTN","RGADT2",21,0)
 ;IA: 10104 - $$STRIP^XLFSTR
"RTN","RGADT2",22,0)
 ;IA: 10070 - ^XMD
"RTN","RGADT2",23,0)
 ;IA: 10141 - $$PARCP/$$UPCP^XPDUTL
"RTN","RGADT2",24,0)
 ;
"RTN","RGADT2",25,0)
 Q:$P($G(^RGSITE(991.8,1,1)),"^",2)  ; seeding process ran in the past
"RTN","RGADT2",26,0)
 ;
"RTN","RGADT2",27,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGADT2",28,0)
 S U="^",RGSITE=$$KSP^XUPARAM("INST") ;defines the local facility
"RTN","RGADT2",29,0)
 S RGSTRT=$$NOW^XLFDT(),RGCNT=0
"RTN","RGADT2",30,0)
 ; check to see if software is part of an KIDS install.  If not, no
"RTN","RGADT2",31,0)
 ; checkpoints needed.
"RTN","RGADT2",32,0)
 S RGICN=$S($D(XPDNM):+$$PARCP^XPDUTL("POST2"),1:0)
"RTN","RGADT2",33,0)
 ; check ALL patients with an Integration Control Number (ICN) for a
"RTN","RGADT2",34,0)
 ; given facility, make sure the DATE LAST TREATED field in the TFL
"RTN","RGADT2",35,0)
 ; file is correct.
"RTN","RGADT2",36,0)
 F  S RGICN=$O(^DPT("AICN",RGICN)) Q:RGICN'>0  D
"RTN","RGADT2",37,0)
 . S RGDFN=0
"RTN","RGADT2",38,0)
 . F  S RGDFN=$O(^DPT("AICN",RGICN,RGDFN)) Q:RGDFN'>0  D EN1(RGDFN)
"RTN","RGADT2",39,0)
 . S RGCNT=RGCNT+1 ; increment record counter
"RTN","RGADT2",40,0)
 . S:$D(XPDNM) RGSAVE=$$UPCP^XPDUTL("POST2",RGICN)
"RTN","RGADT2",41,0)
 . Q
"RTN","RGADT2",42,0)
 S RGFIN=$$NOW^XLFDT() D EMAIL^RGADT2 ; send completion message to user
"RTN","RGADT2",43,0)
 ; populate the 'MPI/PD SEEDING COMP DATE/TIME' (#12) field in the CIRN
"RTN","RGADT2",44,0)
 ; SITE PARAMETER FILE (#991.8)  (do not re-seed a facility)
"RTN","RGADT2",45,0)
 K RGFDA S RGFDA(991.8,"1,",12)=$$NOW^XLFDT()
"RTN","RGADT2",46,0)
 D FILE^DIE("K","RGFDA"),KILL
"RTN","RGADT2",47,0)
 QUIT
"RTN","RGADT2",48,0)
 ;
"RTN","RGADT2",49,0)
EN1(RGDFN,RGSUP) ; determine the LAST TREATMENT DATE for a single
"RTN","RGADT2",50,0)
 ; patient called from our seeding process above.
"RTN","RGADT2",51,0)
 ; input: RGDFN - the dfn of the patient
"RTN","RGADT2",52,0)
 ;        RGSUP - if 1, suppress add entries to the ADT HL7 PIVOT
"RTN","RGADT2",53,0)
 ;                (#391.71) file for TF messaging - VAFCTFMF (optional)
"RTN","RGADT2",54,0)
 ; output: RGDATE - patient's DATE LAST TREATED
"RTN","RGADT2",55,0)
 ;         RGENVR - event reason
"RTN","RGADT2",56,0)
 ;
"RTN","RGADT2",57,0)
 Q:$$LOCICN(RGDFN,$G(RGICN))  ; local ICN
"RTN","RGADT2",58,0)
 S U="^"
"RTN","RGADT2",59,0)
 S RGSITE=$$KSP^XUPARAM("INST") ;defines the local facility
"RTN","RGADT2",60,0)
 S (RGLAST,RGADMDIS)=$$ADMDIS(RGDFN) ; dt_"^"_event type or ""
"RTN","RGADT2",61,0)
 S RGADMDIS=$S(RGADMDIS]"":$P(RGADMDIS,"^"),1:"") ; event dt or null
"RTN","RGADT2",62,0)
 S:$P(RGLAST,"^",2)=3!(RGLAST="") RGENCDT=$$ENCDT(RGDFN,RGADMDIS)
"RTN","RGADT2",63,0)
 ; patient has been discharged or has never been admitted.  Has this
"RTN","RGADT2",64,0)
 ; individual been checked out of a clinic? 
"RTN","RGADT2",65,0)
 I $D(RGENCDT)#2,($P(RGLAST,U)) S RGLAST=$S(+RGENCDT>+RGLAST:RGENCDT,1:RGLAST)
"RTN","RGADT2",66,0)
 I $D(RGENCDT)#2,('$P(RGLAST,U)) S RGLAST=RGENCDT
"RTN","RGADT2",67,0)
 S RGTYPE=$P(RGLAST,"^",2),RGDATE=+RGLAST
"RTN","RGADT2",68,0)
 ; input variables to FILE^VAFCTFU
"RTN","RGADT2",69,0)
 ; RGDFN - patient ien ; RGSITE - treating facility
"RTN","RGADT2",70,0)
 ; RGDATE - date last treated ; RGENVR - event reason
"RTN","RGADT2",71,0)
 ;
"RTN","RGADT2",72,0)
 I RGDATE D SETMSG,FILE^VAFCTFU(RGDFN,RGSITE_U_RGDATE_U_RGENVR,$G(RGSUP))
"RTN","RGADT2",73,0)
 ; update the TFL file for the site running the seeding process,
"RTN","RGADT2",74,0)
 ; then build the HL7 message with the new DATE LAST TREATED &
"RTN","RGADT2",75,0)
 ; ADT/HL7 EVENT REASON values & send them to our CMOR/subscribers.
"RTN","RGADT2",76,0)
 ;
"RTN","RGADT2",77,0)
 D:$G(XPDNM)'="RG*1.0*4" KILL ; single patient operation, kill all
"RTN","RGADT2",78,0)
 ; variables (EN1 re-entrant when running post-install for RG*1.0*4)
"RTN","RGADT2",79,0)
 Q
"RTN","RGADT2",80,0)
 ;
"RTN","RGADT2",81,0)
KILL ; kill and quit
"RTN","RGADT2",82,0)
 K DFN,RGADMDIS,RGCNT,RGDATE,RGDFN,RGENCDT,RGENVR,RGFDA,RGFIN,RGICN
"RTN","RGADT2",83,0)
 K RGLAST,RGSAVE,RGSITE,RGSTRT,RGTYPE
"RTN","RGADT2",84,0)
 Q
"RTN","RGADT2",85,0)
 ;
"RTN","RGADT2",86,0)
ADMDIS(DFN) ; find the patient's last admission and discharge dates if
"RTN","RGADT2",87,0)
 ; they exist.
"RTN","RGADT2",88,0)
 ; Input: DFN - ien of the patient (file 2)
"RTN","RGADT2",89,0)
 ;Output: a valid discharge/admission date/time concatenated with
"RTN","RGADT2",90,0)
 ;        the event type (1=admission, 3=discharge) -or- null
"RTN","RGADT2",91,0)
 N %,VAERR,VAIP S VAIP("D")="LAST" D IN5^VADPT
"RTN","RGADT2",92,0)
 I '+$G(VAIP(17,1)),('+$G(VAIP(13,1))) Q ""
"RTN","RGADT2",93,0)
 ; no discharge date, no admission date, return null
"RTN","RGADT2",94,0)
 I '+$G(VAIP(17,1)) Q $P($G(VAIP(13,1)),U)_"^1"
"RTN","RGADT2",95,0)
 ; no discharge date, return admission date
"RTN","RGADT2",96,0)
 I '+$G(VAIP(13,1)) Q $P($G(VAIP(17,1)),U)_"^3"
"RTN","RGADT2",97,0)
 ; no admission date, return discharge date
"RTN","RGADT2",98,0)
 I +$G(VAIP(17,1))>(+$G(VAIP(13,1))) Q +$G(VAIP(17,1))_"^3"
"RTN","RGADT2",99,0)
 ; return discharge date
"RTN","RGADT2",100,0)
 Q +$G(VAIP(13,1))_"^1" ; return admission date
"RTN","RGADT2",101,0)
 ;
"RTN","RGADT2",102,0)
ENCDT(DFN,INPDT) ; find the last patient check out date/time.  'ADFN'
"RTN","RGADT2",103,0)
 ; cross-reference accessed through DBIA: 2953
"RTN","RGADT2",104,0)
 ; Input: DFN  - ien of the patient (file 2)
"RTN","RGADT2",105,0)
 ;        INPDT - date (if any) returned from the inpatient admission/
"RTN","RGADT2",106,0)
 ;               discharge subroutine     
"RTN","RGADT2",107,0)
 ;Output: a valid discharge/admission date/time concatenated with
"RTN","RGADT2",108,0)
 ;        the event type (5=check out) -or- null
"RTN","RGADT2",109,0)
 Q:'DFN "" ; we need dfn defined
"RTN","RGADT2",110,0)
 K RGDATA,RGPURGE,RGX,RGX1,RGX2 N RGX3
"RTN","RGADT2",111,0)
 S RGX=9999999.9999999,RGX2=0,RGX3=""
"RTN","RGADT2",112,0)
 F  S RGX=$O(^SCE("ADFN",DFN,RGX),-1) Q:'RGX!(INPDT>RGX)  D  Q:RGX2
"RTN","RGADT2",113,0)
 . S RGX1=0 F  S RGX1=$O(^SCE("ADFN",DFN,RGX,RGX1)) Q:'RGX1  D  Q:RGX2
"RTN","RGADT2",114,0)
 .. D GETGEN^SDOE(RGX1,"RGDATA")
"RTN","RGADT2",115,0)
 .. D PARSE^SDOE(.RGDATA,"EXTERNAL","RGPARSE")
"RTN","RGADT2",116,0)
 .. I $G(RGPARSE(.12))="CHECKED OUT" S RGX2=1,RGX3=RGX
"RTN","RGADT2",117,0)
 .. K RGDATA,RGPARSE
"RTN","RGADT2",118,0)
 .. Q
"RTN","RGADT2",119,0)
 . Q
"RTN","RGADT2",120,0)
 K RGDATA,RGPURGE,RGX,RGX1,RGX2
"RTN","RGADT2",121,0)
 Q RGX3_"^5" ; X is either null or the date/time of the check out
"RTN","RGADT2",122,0)
 ;
"RTN","RGADT2",123,0)
SETMSG ; define the variables used to build a HL7 message (RGADT1)
"RTN","RGADT2",124,0)
 S DFN=RGDFN
"RTN","RGADT2",125,0)
 S RGENVR=$S(RGTYPE=1:"A1",RGTYPE=3:"A2",1:"A3") ;A1=adm;A2=dis;A3=CO 
"RTN","RGADT2",126,0)
 Q
"RTN","RGADT2",127,0)
 ;
"RTN","RGADT2",128,0)
EMAIL ; Send a completion email message to the user who installed this patch,
"RTN","RGADT2",129,0)
 ; RG*1*4.  Show the number of records processed, elapsed time and the
"RTN","RGADT2",130,0)
 ; number of records processed per minute.
"RTN","RGADT2",131,0)
 N RGELAPS,RGARY,RGMIN
"RTN","RGADT2",132,0)
 S XMDUZ=.5,XMY(DUZ)="",XMTEXT="RGARY(1,"
"RTN","RGADT2",133,0)
 S XMSUB="CIRN-CPRS DATE LAST TREATED seeding (#391.91 ; .03) results"
"RTN","RGADT2",134,0)
 S RGMIN=$$FMDIFF^XLFDT(RGFIN,RGSTRT,2)/60 ; # of sec x (1 min/60 sec)
"RTN","RGADT2",135,0)
 S:RGMIN=0 RGMIN=1 ; avoid a possible divide by zero
"RTN","RGADT2",136,0)
 S RGELAPS=$$FMDIFF^XLFDT(RGFIN,RGSTRT,3)
"RTN","RGADT2",137,0)
 S RGARY(1,1)="# of processed patients, in the PATIENT (#2) file"
"RTN","RGADT2",138,0)
 S RGARY(1,2)="with an ICN: "_RGCNT
"RTN","RGADT2",139,0)
 S RGARY(1,3)="TFL seeding process run time: "_RGELAPS_" (DD HH:MM:SS format)"
"RTN","RGADT2",140,0)
 S RGARY(1,4)="# of records processed per minute: "_$$STRIP^XLFSTR($J((RGCNT/RGMIN),8,2)," ")
"RTN","RGADT2",141,0)
 D ^XMD K XMDUZ,XMSUB,XMTEXT,XMY
"RTN","RGADT2",142,0)
 Q
"RTN","RGADT2",143,0)
 ;
"RTN","RGADT2",144,0)
LOCICN(DFN,ICN) ; check if this patient has a national ICN without having a
"RTN","RGADT2",145,0)
 ; local ICN.  This function is used when an entire site (all patients)
"RTN","RGADT2",146,0)
 ; is seeding, or for individual patient seeding.
"RTN","RGADT2",147,0)
 ; note: IA 2070 covers the hit on the 'MPI' node
"RTN","RGADT2",148,0)
 ;       IA 2701 covers the call to $$IFLOCAL^MPIF001
"RTN","RGADT2",149,0)
 ;input variables:
"RTN","RGADT2",150,0)
 ; DFN(required)-Patient ien (PATIENT file #2)
"RTN","RGADT2",151,0)
 ; ICN(optional)-Integration Control Number(fld: 991.01, file 2)
"RTN","RGADT2",152,0)
 ;output variable:
"RTN","RGADT2",153,0)
 ; FLAG-0 if the patient has a national ICN and not a local ICN, else 1
"RTN","RGADT2",154,0)
 N FLAG S FLAG=1
"RTN","RGADT2",155,0)
 I +$G(ICN) D
"RTN","RGADT2",156,0)
 . I $P($G(^DPT(DFN,"MPI")),"^")=ICN,('$$IFLOCAL^MPIF001(DFN)) S FLAG=0
"RTN","RGADT2",157,0)
 . Q
"RTN","RGADT2",158,0)
 E  D
"RTN","RGADT2",159,0)
 . I $P($G(^DPT(DFN,"MPI")),"^"),('$$IFLOCAL^MPIF001(DFN)) S FLAG=0
"RTN","RGADT2",160,0)
 . Q
"RTN","RGADT2",161,0)
 Q FLAG
"RTN","RGADTP")
0^17^B42731175
"RTN","RGADTP",1,0)
RGADTP ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS ;5/28/02
"RTN","RGADTP",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**26,27,20**;30 Apr 99
"RTN","RGADTP",3,0)
 ;
"RTN","RGADTP",4,0)
 ;Reference to BLDEVN^VAFCQRY and BLDPID^VAFCQRY supported by IA #3630
"RTN","RGADTP",5,0)
 ;Reference to $$SEND2^VAFCUTL1 supported by IA #2779
"RTN","RGADTP",6,0)
 ;
"RTN","RGADTP",7,0)
INIT ;
"RTN","RGADTP",8,0)
 N RGER,RGSITE,ARRAY,MSH,RGLOCAL,RGEVNT,REP,DIC,DR,DIE,DA,DLAYGO
"RTN","RGADTP",9,0)
 S RGER=""
"RTN","RGADTP",10,0)
 D IN
"RTN","RGADTP",11,0)
 D PROCIN
"RTN","RGADTP",12,0)
 D GENACK
"RTN","RGADTP",13,0)
 Q
"RTN","RGADTP",14,0)
PROC ;processing entry point
"RTN","RGADTP",15,0)
 N HLA,RGADT,PV1,DIC,ARRAY,RGEVNT,RGLOCAL,REP,ICN,RGSITE
"RTN","RGADTP",16,0)
 S RGEVNT=HL("ETN")
"RTN","RGADTP",17,0)
 I $G(HL("MID"))'="" S RGADT=HL("MID")
"RTN","RGADTP",18,0)
 I $G(HL("MID"))="" S RGADT=999
"RTN","RGADTP",19,0)
 Q:+$$SEND2^VAFCUTL1(DFN,"T")
"RTN","RGADTP",20,0)
 D IN
"RTN","RGADTP",21,0)
 S ICN=$G(ARRAY("ICN"))
"RTN","RGADTP",22,0)
 ;S ICN=$$GETICN^MPIF001(DFN)
"RTN","RGADTP",23,0)
 I +$G(ICN)<1 Q  ;quit if no ICN
"RTN","RGADTP",24,0)
 I $E($G(ICN),1,3)=$P($$SITE^VASITE,"^",3) Q  ;quit if ICN is a local
"RTN","RGADTP",25,0)
 S ZTSAVE("DFN")="",ZTSAVE("RGEVNT")="",ZTSAVE("HLA(""HLS"",")="",ZTRTN="SEND^RGADTPC",ZTDESC="Sending HL7 Patient Update...",ZTIO="RG QUEUE",ZTDTH=$H D ^%ZTLOAD
"RTN","RGADTP",26,0)
 K ZTSAVE,ZTRTN,ZTDESC,ZTIO,ZTDTH
"RTN","RGADTP",27,0)
 Q
"RTN","RGADTP",28,0)
IN ;Process in the ADT A04/A08 (routing logic)
"RTN","RGADTP",29,0)
 N RGI,MSG,RG,SG,DFN,EVN,SITE,RGC,RGJ,DIC,PV1,PID,COMP
"RTN","RGADTP",30,0)
 ;set local flag to indicate the processing of an outbound for reformating
"RTN","RGADTP",31,0)
 S REP=$E(HL("ECH"),2)
"RTN","RGADTP",32,0)
 S COMP=$E(HL("ECH"),1)
"RTN","RGADTP",33,0)
 I $P($G(HL("SAF")),COMP)=$P($$SITE^VASITE,"^",3) S RGLOCAL=1
"RTN","RGADTP",34,0)
 I $P($G(HL("SAF")),COMP)'=$P($$SITE^VASITE,"^",3) S RGLOCAL=0
"RTN","RGADTP",35,0)
 S RGC=$E($G(HL("ECH")),1)
"RTN","RGADTP",36,0)
 F RGI=1:1 X HLNEXT Q:HLQUIT'>0  S MSG=HLNODE,SG=$E(HLNODE,1,3) D
"RTN","RGADTP",37,0)
 . S RGJ=0 F  S RGJ=$O(HLNODE(RGJ)) Q:'RGJ  S MSG(RGJ)=HLNODE(RGJ)
"RTN","RGADTP",38,0)
 . D:SG?2A1(1A,1N) PICK
"RTN","RGADTP",39,0)
 ;if message MSH sending facility matches the PID assigning authority update
"RTN","RGADTP",40,0)
QUIT Q
"RTN","RGADTP",41,0)
ROUTE ;
"RTN","RGADTP",42,0)
 N RGERR
"RTN","RGADTP",43,0)
 I $G(RGEVNT)="" S RGEVNT=$G(HL("ETN"))
"RTN","RGADTP",44,0)
 N MPI S MPI=$$MPILINK^MPIFAPI() D
"RTN","RGADTP",45,0)
 . I $P($G(MPI),U)'=-1 S HLL("LINKS",1)="RG ADT-"_HL("ETN")_" 2.4 CLIENT^"_MPI
"RTN","RGADTP",46,0)
 . I $P($G(MPI),U)=-1 D
"RTN","RGADTP",47,0)
 .. N RGLOG,RGMTXT
"RTN","RGADTP",48,0)
 .. D START^RGHLLOG(HLMTIEN,"","")
"RTN","RGADTP",49,0)
 .. S RGMTXT="for DFN#"_$G(DFN)
"RTN","RGADTP",50,0)
 .. D EXC^RGHLLOG(224,"No MPI link identified"_RGMTXT,$G(DFN)) S RGERR=1
"RTN","RGADTP",51,0)
 I $G(RGERR)'=1 S ^XTMP("RG"_HL("ETN")_"%"_DFN,0)=$$FMADD^XLFDT(DT,5)_"^"_DT_"^"_"RG"_HL("ETN")_" msg to MPI for DFN "_DFN S ^XTMP("RG"_HL("ETN")_"%"_DFN,"MPI",0)="A"
"RTN","RGADTP",52,0)
 Q
"RTN","RGADTP",53,0)
RESP ;
"RTN","RGADTP",54,0)
 N RGER,RGSITE,ARRAY,MSH,RGLOCAL,RGEVNT
"RTN","RGADTP",55,0)
 N RGI,MSG,RG,SG,DFN,EVN,SITE,RGC,RGJ,DIC,PV1,PID
"RTN","RGADTP",56,0)
 D IN
"RTN","RGADTP",57,0)
 Q
"RTN","RGADTP",58,0)
PICK ;check routine for segment entry point
"RTN","RGADTP",59,0)
 I $T(@SG)]"" D @SG
"RTN","RGADTP",60,0)
 I $T(@SG)="" Q
"RTN","RGADTP",61,0)
 Q
"RTN","RGADTP",62,0)
MSA ;;
"RTN","RGADTP",63,0)
 ;process the MSA segment
"RTN","RGADTP",64,0)
 N ARRAY,CNT,DFN,EXIT,HLCOMP,RGAA,RGERR,RGEVNT,RGMSG,RETURN,RGX,RGY
"RTN","RGADTP",65,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",66,0)
 S RGAA=MSG
"RTN","RGADTP",67,0)
 S EXIT=0
"RTN","RGADTP",68,0)
 S RGMSG=$P(RGAA,HL("FS"),3)
"RTN","RGADTP",69,0)
 S RGERR=$P(RGAA,HL("FS"),4)
"RTN","RGADTP",70,0)
 S RGMSG=$$MSG^HLCSUTL(RGMSG,"RETURN(1)")
"RTN","RGADTP",71,0)
 K RGMSG
"RTN","RGADTP",72,0)
 S CNT=1,RGX=0 F  S RGX=$O(RETURN(1,RGX)) Q:'RGX!(EXIT=1)  D
"RTN","RGADTP",73,0)
 . I RETURN(1,RGX)'="" D
"RTN","RGADTP",74,0)
 .. I $D(RGMSG) S RGMSG(CNT)=RETURN(1,RGX),CNT=CNT+1
"RTN","RGADTP",75,0)
 .. I '$D(RGMSG) S RGMSG=RETURN(1,RGX),RGY=RGX
"RTN","RGADTP",76,0)
 . I RETURN(1,RGX)="" D  S CNT=1 K RGMSG
"RTN","RGADTP",77,0)
 .. I $E(RETURN(1,RGY),1,3)="MSH" D MSH
"RTN","RGADTP",78,0)
 .. I $E(RETURN(1,RGY),1,3)="PID" D PIDP^RGADTP1(.RGMSG,.ARRAY,.HL) S EXIT=1
"RTN","RGADTP",79,0)
 S DFN=$G(ARRAY("DFN"))
"RTN","RGADTP",80,0)
 I $D(^XTMP("RG"_HL("ETN")_"%"_DFN,0)) K ^XTMP("RG"_HL("ETN")_"%"_DFN)
"RTN","RGADTP",81,0)
 Q
"RTN","RGADTP",82,0)
MSH ;;
"RTN","RGADTP",83,0)
 S MSH=1
"RTN","RGADTP",84,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",85,0)
 I 'RGLOCAL S RGC=$E(HL("ECH"),1)
"RTN","RGADTP",86,0)
 S RGSITE=$P($P(MSG,HL("FS"),4),RGC)
"RTN","RGADTP",87,0)
 S RGEVNT=$P($P(MSG,HL("FS"),9),RGC,2)
"RTN","RGADTP",88,0)
 Q
"RTN","RGADTP",89,0)
EVN ;;
"RTN","RGADTP",90,0)
 N CNT,ERR
"RTN","RGADTP",91,0)
 S EVN=RGI
"RTN","RGADTP",92,0)
 I RGLOCAL S (EVN(1),HLA("HLS",RGI))=MSG
"RTN","RGADTP",93,0)
 I 'RGLOCAL D
"RTN","RGADTP",94,0)
 .S ARRAY("EVR")=$P(MSG,HL("FS"),2)
"RTN","RGADTP",95,0)
 .S ARRAY("DLT")=$$FMDATE^HLFNC($P(MSG,HL("FS"),3))
"RTN","RGADTP",96,0)
 .S ARRAY("EVNAME")=$$FMNAME^XLFNAME($P(MSG,HL("FS"),2),"",$E(HL("ECH"),1))
"RTN","RGADTP",97,0)
 .S ARRAY("SENDING SITE")=$P(MSG,HL("FS"),8)
"RTN","RGADTP",98,0)
 Q
"RTN","RGADTP",99,0)
EVNP ;
"RTN","RGADTP",100,0)
 N EVNX
"RTN","RGADTP",101,0)
 I $G(DFN)'="" D BLDEVN^VAFCQRY(DFN,"1,2,4,5,6,7",.EVN,.HL,$G(HL("ETN")),.ERR) S CNT=0,EVNX=0 F  S EVNX=$O(EVN(EVNX)) Q:'EVNX  D
"RTN","RGADTP",102,0)
 . I CNT>0 S HLA("HLS",EVN,CNT)=EVN(EVNX),CNT=CNT+1
"RTN","RGADTP",103,0)
 . I CNT'>0 S HLA("HLS",EVN)=EVN(EVNX),CNT=CNT+1
"RTN","RGADTP",104,0)
 Q
"RTN","RGADTP",105,0)
PID ;;
"RTN","RGADTP",106,0)
 N CNT,PIDX
"RTN","RGADTP",107,0)
 I RGLOCAL D
"RTN","RGADTP",108,0)
 .N HLCOMP S HLCOMP=$E(HL("ECH"),1)
"RTN","RGADTP",109,0)
 .S HLA("HLS",RGI)=MSG
"RTN","RGADTP",110,0)
 .S DFN=+$P(MSG,HL("FS"),4)
"RTN","RGADTP",111,0)
 .D EVNP
"RTN","RGADTP",112,0)
 .D BLDPID^VAFCQRY(DFN,1,"1,3,5,6,7,8,11,29",.PID,.HL)
"RTN","RGADTP",113,0)
 .;get Primary ICN value in the PID segment
"RTN","RGADTP",114,0)
 .S ARRAY("ICN")=+$P($P(PID(1),HL("FS"),4),HLCOMP)
"RTN","RGADTP",115,0)
 .S CNT=0,PIDX=0 F  S PIDX=$O(PID(PIDX)) Q:'PIDX  D
"RTN","RGADTP",116,0)
 .. I CNT>0 S HLA("HLS",RGI,CNT)=PID(PIDX),CNT=CNT+1
"RTN","RGADTP",117,0)
 .. I CNT'>0 S HLA("HLS",RGI)=PID(PIDX),CNT=CNT+1
"RTN","RGADTP",118,0)
 I 'RGLOCAL D PIDP^RGADTP1(.MSG,.ARRAY,.HL)
"RTN","RGADTP",119,0)
 Q
"RTN","RGADTP",120,0)
PD1 ;;
"RTN","RGADTP",121,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",122,0)
 I 'RGLOCAL S (ARRAY(991.03),ARRAY("CMOR"))=$P($P(MSG,HL("FS"),4),RGC)
"RTN","RGADTP",123,0)
 Q
"RTN","RGADTP",124,0)
PV1 ;;
"RTN","RGADTP",125,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",126,0)
 Q
"RTN","RGADTP",127,0)
OBX ;;
"RTN","RGADTP",128,0)
 N COMP S COMP=$E(HL("ECH"),1)
"RTN","RGADTP",129,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",130,0)
 I 'RGLOCAL D:$$FREE^RGRSPARS($P($P(MSG,HL("FS"),4),RGC,2))="SECURITY LEVEL"
"RTN","RGADTP",131,0)
 . S ARRAY("SENSITIVITY")=$$SENSTIVE^RGRSPARS($P(MSG,HL("FS"),6),COMP)
"RTN","RGADTP",132,0)
 . S ARRAY("SENSITIVITY USER")=$$FREE^RGRSPARS($P($P(MSG,HL("FS"),17),RGC,3))_","_$$FREE^RGRSPARS($P($P(MSG,HL("FS"),17),RGC,2))
"RTN","RGADTP",133,0)
 . S ARRAY("SENSITIVITY DATE")=$$FREE^RGRSPARS($$FMDATE^HLFNC($P(MSG,HL("FS"),15)))
"RTN","RGADTP",134,0)
 Q
"RTN","RGADTP",135,0)
ZPD ;;
"RTN","RGADTP",136,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",137,0)
 ;I 'RGLOCAL S ARRAY(.351)=$$FREE^RGRSPARS($P(MSG,HL("FS"),5))
"RTN","RGADTP",138,0)
 Q
"RTN","RGADTP",139,0)
ZSP ;;
"RTN","RGADTP",140,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",141,0)
 I 'RGLOCAL D
"RTN","RGADTP",142,0)
 . S ARRAY(.301)=$$YESNO^RGRSPARS($P(MSG,HL("FS"),3))
"RTN","RGADTP",143,0)
 . S ARRAY(.302)=$$FREE^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",144,0)
 . S ARRAY(.323)=$$POS^RGRSPARS($P(MSG,HL("FS"),5))
"RTN","RGADTP",145,0)
 Q
"RTN","RGADTP",146,0)
ZEL ;;
"RTN","RGADTP",147,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",148,0)
 I 'RGLOCAL D
"RTN","RGADTP",149,0)
 . S ARRAY(.361)=$$ELIG^RGRSPARS($P(MSG,HL("FS"),3))
"RTN","RGADTP",150,0)
 . S ARRAY(.3612)=$$FREE^RGRSPARS($P(MSG,HL("FS"),12))
"RTN","RGADTP",151,0)
 . S ARRAY(.3615)=$$FREE^RGRSPARS($P(MSG,HL("FS"),14))
"RTN","RGADTP",152,0)
 . S ARRAY(391)=$$TYPE^RGRSPARS($P(MSG,HL("FS"),10))
"RTN","RGADTP",153,0)
 . S ARRAY(1901)=$$VETERAN^RGRSPARS($P(MSG,HL("FS"),9))
"RTN","RGADTP",154,0)
 Q
"RTN","RGADTP",155,0)
ZCT ;;
"RTN","RGADTP",156,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",157,0)
 I 'RGLOCAL D
"RTN","RGADTP",158,0)
 . S ARRAY(.211)=$$FREE^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",159,0)
 . S ARRAY(.219)=$$FREE^RGRSPARS($P(MSG,HL("FS"),7))
"RTN","RGADTP",160,0)
 Q
"RTN","RGADTP",161,0)
ZEM ;;
"RTN","RGADTP",162,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",163,0)
 I 'RGLOCAL D
"RTN","RGADTP",164,0)
 . S ARRAY(.31115)=$$EMP^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",165,0)
 Q
"RTN","RGADTP",166,0)
ZFF ;;
"RTN","RGADTP",167,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",168,0)
 I 'RGLOCAL S ARRAY("FLD")=$P(MSG,HL("FS"),3)
"RTN","RGADTP",169,0)
 Q
"RTN","RGADTP",170,0)
PROCIN ;
"RTN","RGADTP",171,0)
 D PROCIN^RGADTP2(.ARRAY,.RGLOCAL,.RGER,.DFN,.HL)
"RTN","RGADTP",172,0)
 Q
"RTN","RGADTP",173,0)
GENACK ;
"RTN","RGADTP",174,0)
 N RGCNT,IEN,RG
"RTN","RGADTP",175,0)
 I $G(ARRAY("DFN"))'>0 S RGER="-1^Unknown ICN#"_$G(ARRAY("ICN"))_" and SSN#"_$G(ARRAY(.09))
"RTN","RGADTP",176,0)
 S RGCNT=1
"RTN","RGADTP",177,0)
 S HLA("HLA",RGCNT)="MSA"_HL("FS")_"AA"_HL("FS")_HL("MID")_HL("FS")_$S(+$G(RGER)<0:$P(RGER,"^",2,3),1:""),RGCNT=RGCNT+1
"RTN","RGADTP",178,0)
 S RGSITE=$$LKUP^XUAF4(RGSITE)
"RTN","RGADTP",179,0)
 D LINK^HLUTIL3(RGSITE,.RG) S IEN=$O(RG(0)) S HLL("LINKS",1)="^"_RG(IEN)
"RTN","RGADTP",180,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.HLRESLTA,"",.HL)
"RTN","RGADTP",181,0)
 K HLA
"RTN","RGADTP",182,0)
 Q
"RTN","RGADTP",183,0)
RSP ;
"RTN","RGADTP",184,0)
 Q
"RTN","RGADTP2")
0^21^B21277415
"RTN","RGADTP2",1,0)
RGADTP2 ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS - CONTINUED ;10/30/02  10:04
"RTN","RGADTP2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**27,20**;30 Apr 99
"RTN","RGADTP2",3,0)
DBIA ;
"RTN","RGADTP2",4,0)
 ;Reference to $$ADD^VAFCEHU1 supported by IA #2753
"RTN","RGADTP2",5,0)
 ;Reference to $$SEND2^VAFCUTL1 supported by IA #2779
"RTN","RGADTP2",6,0)
 ;Reference to EDIT^VAFCPTED supported by IA #2784
"RTN","RGADTP2",7,0)
 Q
"RTN","RGADTP2",8,0)
PROCIN(ARRAY,RGLOCAL,RGER,DFN,HL) ;
"RTN","RGADTP2",9,0)
 N RGRSDFN,OTHSITE,NODE,ICN,CMORIEN,CMOR,CMORDISP,SENSTVTY,RMTDOD,LOCDOD,VAFCA,VAFCA08,HERE,BOGUS,ARAY,REP
"RTN","RGADTP2",10,0)
 S REP=$E(HL("ECH"),2)
"RTN","RGADTP2",11,0)
 S HERE=$P($$SITE^VASITE,"^",3)
"RTN","RGADTP2",12,0)
 ;if sending site is your site quit
"RTN","RGADTP2",13,0)
 Q:$G(ARRAY("MPISSITE"))=$G(HERE)
"RTN","RGADTP2",14,0)
 S ARRAY(.097)=$P($$NOW^XLFDT,".")
"RTN","RGADTP2",15,0)
 I $G(ARRAY("ICN"))'="" D
"RTN","RGADTP2",16,0)
 . S RGRSDFN=$$GETDFN^MPIF001(+ARRAY("ICN")) I +RGRSDFN<1 S RGER=RGRSDFN_" ICN#"_$G(ARRAY("ICN")) Q  ;quit and return error msg
"RTN","RGADTP2",17,0)
 . S OTHSITE=+ARRAY("MPISSITE")
"RTN","RGADTP2",18,0)
 I $G(RGRSDFN)="" S RGRSDFN=$G(DFN)
"RTN","RGADTP2",19,0)
 I $G(RGRSDFN)="" S RGER="-1^DFN not defined"
"RTN","RGADTP2",20,0)
 Q:$G(RGER)
"RTN","RGADTP2",21,0)
 I $G(OTHSITE)="" S OTHSITE=""
"RTN","RGADTP2",22,0)
 I +$$SEND2^VAFCUTL1(RGRSDFN,"T")  ;quit and return error msg
"RTN","RGADTP2",23,0)
 S NODE=$$MPINODE^MPIFAPI(RGRSDFN)
"RTN","RGADTP2",24,0)
 S ICN=$P(NODE,"^")
"RTN","RGADTP2",25,0)
 S CMORIEN=$P(NODE,"^",3)
"RTN","RGADTP2",26,0)
 S CMOR=$$NS^XUAF4(CMORIEN)
"RTN","RGADTP2",27,0)
 S CMORDISP=$P(CMOR,"^",1)
"RTN","RGADTP2",28,0)
 S CMOR=$P(CMOR,"^",2)
"RTN","RGADTP2",29,0)
 ;
"RTN","RGADTP2",30,0)
 ;If patient is Sensitive at other site but not here send bulletin
"RTN","RGADTP2",31,0)
 I $G(ARRAY("SENSITIVITY"))'="" S SENSTVTY=$G(ARRAY("SENSITIVITY")) D
"RTN","RGADTP2",32,0)
 . N NAME S NAME=ARRAY("NAME")
"RTN","RGADTP2",33,0)
 . I '$$SENSTIVE^RGRSENS(RGRSDFN),SENSTVTY D
"RTN","RGADTP2",34,0)
 .. S ARAY("SSN")=ARRAY("SSN")
"RTN","RGADTP2",35,0)
 .. S ARAY("SENDING SITE")=ARRAY("SENDING SITE")
"RTN","RGADTP2",36,0)
 .. S ARAY("SENSITIVITY USER")=ARRAY("SENSITIVITY USER")
"RTN","RGADTP2",37,0)
 .. S ARAY("SENSITIVITY DATE")=ARRAY("SENSITIVITY DATE")
"RTN","RGADTP2",38,0)
 .. D SENSTIVE^RGRSBUL1(RGRSDFN,"ARAY",NAME)
"RTN","RGADTP2",39,0)
 ;
"RTN","RGADTP2",40,0)
 ;If patient has DATE OF DEATH (DOD) at remote site send bulletin
"RTN","RGADTP2",41,0)
 ;Ignore time if present with date.
"RTN","RGADTP2",42,0)
 S RMTDOD=$G(ARRAY("MPIDOD")),RMTDOD=$P(RMTDOD,".")
"RTN","RGADTP2",43,0)
 S DFN=RGRSDFN D DEM^VADPT
"RTN","RGADTP2",44,0)
 S LOCDOD=$P($P(VADM(6),"^"),".")
"RTN","RGADTP2",45,0)
 ;If there is a remote DOD but no local DOD  OR
"RTN","RGADTP2",46,0)
 ;if remote DOD is different from local DOD, send bulletin
"RTN","RGADTP2",47,0)
 I RMTDOD D
"RTN","RGADTP2",48,0)
 . N NAME S NAME=ARRAY("NAME")
"RTN","RGADTP2",49,0)
 . S ARAY("SSN")=ARRAY("SSN")
"RTN","RGADTP2",50,0)
 . S ARAY("SENDING SITE")=ARRAY("SENDING SITE")
"RTN","RGADTP2",51,0)
 . D RMTDOD^RGRSBUL1(RGRSDFN,"ARAY",NAME,RMTDOD,LOCDOD)
"RTN","RGADTP2",52,0)
 K VADM
"RTN","RGADTP2",53,0)
 ;
"RTN","RGADTP2",54,0)
NOTLOC I 'RGLOCAL D
"RTN","RGADTP2",55,0)
 . ;if sending site is not the CMOR - log update into PDR if differences exist
"RTN","RGADTP2",56,0)
 . I (OTHSITE)'=(CMOR) D  Q
"RTN","RGADTP2",57,0)
 .. S VAFCA=$P($$NOW^XLFDT,".")_"^"_$$NOW^XLFDT_"^"_$G(ARRAY("SENDING SITE"))_"^"_RGRSDFN
"RTN","RGADTP2",58,0)
 .. S ARRAY(.01)=$$FREE^RGRSPARS(ARRAY("NAME"))
"RTN","RGADTP2",59,0)
 .. S ARRAY(.03)=$$FREE^RGRSPARS($G(ARRAY("MPIDOB")))
"RTN","RGADTP2",60,0)
 .. S ARRAY(.09)=$$FREE^RGRSPARS($G(ARRAY("SSN")))
"RTN","RGADTP2",61,0)
 .. S ARRAY(.02)=$$SEX^RGRSPARS($G(ARRAY("SEX")))
"RTN","RGADTP2",62,0)
 .. S ARRAY(.2403)=$$FREE^RGRSPARS($G(ARRAY("MMN")))
"RTN","RGADTP2",63,0)
 .. S ARRAY(991.01)=$P($G(ARRAY("ICN")),"V")
"RTN","RGADTP2",64,0)
 .. N ARAY M ARAY(2)=ARRAY
"RTN","RGADTP2",65,0)
 .. S VAFCA08=1 S BOGUS=$$ADD^VAFCEHU1(VAFCA,"ARAY")
"RTN","RGADTP2",66,0)
 . ;if sending site is the CMOR - synchronize data
"RTN","RGADTP2",67,0)
 . I (OTHSITE)=(CMOR) D
"RTN","RGADTP2",68,0)
 .. S VAFCA08=1
"RTN","RGADTP2",69,0)
 .. S ARAY(2,.01)=ARRAY("NAME")
"RTN","RGADTP2",70,0)
 .. S ARAY(2,.03)=$G(ARRAY("MPIDOB"))
"RTN","RGADTP2",71,0)
 .. S ARAY(2,.09)=$G(ARRAY("SSN"))
"RTN","RGADTP2",72,0)
 .. S ARAY(2,.02)=$G(ARRAY("SEX"))
"RTN","RGADTP2",73,0)
 .. S ARAY(2,.2403)=$G(ARRAY("MMN"))
"RTN","RGADTP2",74,0)
 .. D EDIT^VAFCPTED(RGRSDFN,"ARAY(2)",".01;.03;.09;.02;.2403")
"RTN","RGADTP2",75,0)
 .. ;check to see if edits were successful, if not set RGER="why it failed"
"RTN","RGADTP2",76,0)
 .. N NAME,SSN,PDOB,SEX,MMN,OLDNAME,OLDHLNAM,OLDMMN,OLDHLMMN,HLNAME,HLMMN
"RTN","RGADTP2",77,0)
 .. S NAME=$$GET1^DIQ(2,+RGRSDFN_",",.01,"I")
"RTN","RGADTP2",78,0)
 .. S PDOB=$$GET1^DIQ(2,+RGRSDFN_",",.03,"I")
"RTN","RGADTP2",79,0)
 .. S SSN=$$GET1^DIQ(2,+RGRSDFN_",",.09,"I")
"RTN","RGADTP2",80,0)
 .. S SEX=$$GET1^DIQ(2,+RGRSDFN_",",.02,"I")
"RTN","RGADTP2",81,0)
 .. S MMN=$$GET1^DIQ(2,+RGRSDFN_",",.2403,"I")
"RTN","RGADTP2",82,0)
 .. D STDNAME^XLFNAME(.NAME,"F",.OLDNAME) S HLNAME=ARRAY("NAME") D STDNAME^XLFNAME(.HLNAME,"F",.OLDHLNAM)
"RTN","RGADTP2",83,0)
 .. I NAME'=$G(HLNAME) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Name field failure"
"RTN","RGADTP2",84,0)
 .. I PDOB'=$G(ARRAY("MPIDOB")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"DOB field failure"
"RTN","RGADTP2",85,0)
 .. I SSN'=$G(ARRAY("SSN")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN field failure"
"RTN","RGADTP2",86,0)
 .. I SEX'=$G(ARRAY("SEX")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SEX field failure"
"RTN","RGADTP2",87,0)
 .. D STDNAME^XLFNAME(.MMN,"F",.OLDMMN) S HLMMN=ARRAY("MMN") D STDNAME^XLFNAME(.HLMMN,"F",.OLDHLMMN)
"RTN","RGADTP2",88,0)
 .. I MMN'=$G(HLMMN) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"MOTHER'S MAIDEN NAME field failure"
"RTN","RGADTP2",89,0)
 .. ;send the updated fields to the MPI to synch site with MPI
"RTN","RGADTP2",90,0)
 .. S ZTSAVE("DFN")="",ZTRTN="MPISYN^RGADTPC",ZTDESC="Sending Synchronized Patient Data to MPI...",ZTIO="RG QUEUE",ZTDTH=$H D ^%ZTLOAD
"RTN","RGADTP2",91,0)
 Q
"RTN","RGEX05")
0^1^B6529118
"RTN","RGEX05",1,0)
RGEX05 ;BAY/ALS-LISTMANAGER ROUTINE FOR REMOTE PDAT IN EXCEPTION HANDLER ;10/04/01
"RTN","RGEX05",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**23,20**;30 Apr 99
"RTN","RGEX05",3,0)
 ;Reference to RPCCHK^XWB2HL7 supported by IA #3144
"RTN","RGEX05",4,0)
 ;Reference to RTNDATA^XWBDRPC supported by IA #3149
"RTN","RGEX05",5,0)
EN(ICN) ;main entry point for RG EXCPT REMOTE PDAT
"RTN","RGEX05",6,0)
 D EN^VALM("RG EXCPT RPDAT")
"RTN","RGEX05",7,0)
 Q
"RTN","RGEX05",8,0)
HDR ;header code
"RTN","RGEX05",9,0)
 S VALMHDR(1)="MPI/PD REMOTE PATIENT DATA"
"RTN","RGEX05",10,0)
 S VALMHDR(2)=""
"RTN","RGEX05",11,0)
 Q
"RTN","RGEX05",12,0)
INIT ;
"RTN","RGEX05",13,0)
 K ^TMP("RGEXC5",$J)
"RTN","RGEX05",14,0)
 K @VALMAR
"RTN","RGEX05",15,0)
 I '$D(ICN) G EXIT
"RTN","RGEX05",16,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","RGEX05",17,0)
 S TXT="-> For ICN "_$P(ICN,"V",1) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX05",18,0)
 S L=0 F  S L=$O(TFARR(L)) Q:'L  D
"RTN","RGEX05",19,0)
 . S SL=$P(TFARR(L),"^",1)
"RTN","RGEX05",20,0)
 . S STATUS=$P(TFL(SL),"^",3)
"RTN","RGEX05",21,0)
 . I STATUS["Handle" S STATUS="Error in Process"
"RTN","RGEX05",22,0)
 . E  I STATUS["New" S STATUS="Request Sent"
"RTN","RGEX05",23,0)
 . E  I STATUS["Running" S STATUS="Awaiting Response"
"RTN","RGEX05",24,0)
 . E  I STATUS["Done" S STATUS="Response Received"
"RTN","RGEX05",25,0)
 . S TXT="  "_$P(TFL(SL),"^")_"  status: ("_STATUS_")"
"RTN","RGEX05",26,0)
 . D ADDTMP
"RTN","RGEX05",27,0)
 . S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP D
"RTN","RGEX05",28,0)
 . S LOC=$P(TFL(SL),"^",2)
"RTN","RGEX05",29,0)
 . N STATUS,RETURN,RESULT,RET,RESULT
"RTN","RGEX05",30,0)
 . I '$D(^XTMP("RGPDAT"_ICN,0)) S TXT=" - No patient data query exists for this patient." S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX05",31,0)
 . I $D(^XTMP("RGPDAT"_ICN,LOC,0)) D
"RTN","RGEX05",32,0)
 .. S RETURN(0)=$P(^XTMP("RGPDAT"_ICN,LOC,0),"^")
"RTN","RGEX05",33,0)
 .. D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","RGEX05",34,0)
 ... D RTNDATA^XWBDRPC(.RET,RETURN(0)) D
"RTN","RGEX05",35,0)
 ... I $G(RET(0))<0 S TXT="No Data Returned Due To: "_$P(RET(0),"^",2,99) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP Q
"RTN","RGEX05",36,0)
 ... I $G(RET)'="",$D(@RET) S GLO=RET F  S GLO=$Q(@GLO) Q:$QS(GLO,1)'=$J  S TXT=@GLO S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX05",37,0)
 ... S R=0 F  S R=$O(RET(R)) Q:'R  S TXT=RET(R) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX05",38,0)
 K ICNARR,R,L,SL,LOC,TFL,GLO
"RTN","RGEX05",39,0)
 S VALMCNT=LIN-1
"RTN","RGEX05",40,0)
 Q
"RTN","RGEX05",41,0)
ADDTMP ;
"RTN","RGEX05",42,0)
 S ^TMP("RGEXC5",$J,LIN,0)=STR
"RTN","RGEX05",43,0)
 S ^TMP("RGEXC5",$J,"IDX",LIN,LIN)=""
"RTN","RGEX05",44,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX05",45,0)
 Q
"RTN","RGEX05",46,0)
HELP ;
"RTN","RGEX05",47,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX05",48,0)
 Q
"RTN","RGEX05",49,0)
EXIT ;
"RTN","RGEX05",50,0)
 S VALMBCK=""
"RTN","RGEX05",51,0)
 K ^TMP("RGEXC5",$J),LIN,X,STR,TXT
"RTN","RGEX05",52,0)
 S VALMBCK="R"
"RTN","RGEX05",53,0)
 Q
"RTN","RGMTAUD")
0^15^B23041015
"RTN","RGMTAUD",1,0)
RGMTAUD ;BIR/CML-MPI/PD AUDIT FILE PRINT FOR A SPECIFIED PATIENT ;01/06/99
"RTN","RGMTAUD",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,19,20**;30 Apr 99
"RTN","RGMTAUD",3,0)
 ;Reference to ^DIA(2 and data derived from the AUDIT file (#1.1)
"RTN","RGMTAUD",4,0)
 ;is supported by IA #2097 and #2602.
"RTN","RGMTAUD",5,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTAUD",6,0)
 S QFLG=1
"RTN","RGMTAUD",7,0)
 S RPCFLG=0 ;is this from an rpc call
"RTN","RGMTAUD",8,0)
BEGIN ;
"RTN","RGMTAUD",9,0)
 W !!,"This option prints information from the AUDIT file (#1.1) for a"
"RTN","RGMTAUD",10,0)
 W !,"selected patient and date range."
"RTN","RGMTAUD",11,0)
 W !!,"For the PATIENT file (#2) entry selected, the report prints the"
"RTN","RGMTAUD",12,0)
 W !,"patient name and DFN, date/time the field was edited, the user who"
"RTN","RGMTAUD",13,0)
 W !,"made the change, the field edited, the old value, and the new value."
"RTN","RGMTAUD",14,0)
 W !,"The option or protocol (if available) will also be displayed."
"RTN","RGMTAUD",15,0)
 D ASK1
"RTN","RGMTAUD",16,0)
 I $G(RGDFN) D ASK2
"RTN","RGMTAUD",17,0)
 I $G(RGBDT),$G(RGEDT) D DEV
"RTN","RGMTAUD",18,0)
 G QUIT
"RTN","RGMTAUD",19,0)
 ;
"RTN","RGMTAUD",20,0)
ASK1 ;Ask for PATIENT
"RTN","RGMTAUD",21,0)
 W !
"RTN","RGMTAUD",22,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC Q:Y<0  S RGDFN=+Y
"RTN","RGMTAUD",23,0)
 I '$O(^DIA(2,"B",RGDFN,0)) W !!,"This patient has no audit data available for any date." G ASK1
"RTN","RGMTAUD",24,0)
 Q
"RTN","RGMTAUD",25,0)
 ;
"RTN","RGMTAUD",26,0)
ASK2 ;Ask for Date Range
"RTN","RGMTAUD",27,0)
 ;I '$D(RGDFN)&($D(DFN)) S RGDFN=DFN
"RTN","RGMTAUD",28,0)
 W !!,"Enter date range for data to be included in report."
"RTN","RGMTAUD",29,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","RGMTAUD",30,0)
 S DIR(0)="DAO^:DT:EPX",DIR("A")="Beginning Date:  " D ^DIR K DIR Q:$D(DIRUT)  S RGBDT=Y
"RTN","RGMTAUD",31,0)
 S DIR(0)="DAO^"_RGBDT_":DT:EPX",DIR("A")="Ending Date:  " D ^DIR K DIR Q:$D(DIRUT)  S RGEDT=Y
"RTN","RGMTAUD",32,0)
 Q
"RTN","RGMTAUD",33,0)
 ;
"RTN","RGMTAUD",34,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","RGMTAUD",35,0)
 S ZTSAVE("RGBDT")="",ZTSAVE("RGEDT")="",ZTSAVE("RGDFN")=""
"RTN","RGMTAUD",36,0)
 D EN^XUTMDEVQ("START^RGMTAUD(RGDFN,RGBDT,RGEDT,RPCFLG)","MPI/PD - Print AUDIT File Data for a Specific Patient",.ZTSAVE) I 'POP Q
"RTN","RGMTAUD",37,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTAUD",38,0)
 G QUIT
"RTN","RGMTAUD",39,0)
 ;
"RTN","RGMTAUD",40,0)
START(RGDFN,RGBDT,RGEDT,RPCFLG) ;
"RTN","RGMTAUD",41,0)
 N IEN
"RTN","RGMTAUD",42,0)
 K ^TMP("RGMTAUD",$J)
"RTN","RGMTAUD",43,0)
 ;
"RTN","RGMTAUD",44,0)
LOOP ;Loop on "B" xref of the AUDIT file
"RTN","RGMTAUD",45,0)
 S STOP=RGEDT+1
"RTN","RGMTAUD",46,0)
 S IEN=0 F  S IEN=$O(^DIA(2,"B",RGDFN,IEN)) Q:'IEN  D
"RTN","RGMTAUD",47,0)
 .I $D(^DIA(2,IEN,0)) S EDITDT=$P(^(0),U,2) I EDITDT>RGBDT,EDITDT<STOP D
"RTN","RGMTAUD",48,0)
 ..S ^TMP("RGMTAUD",$J,EDITDT,IEN)=""
"RTN","RGMTAUD",49,0)
 ;
"RTN","RGMTAUD",50,0)
PRT ;Print report
"RTN","RGMTAUD",51,0)
 S (PG,QFLG)=0,U="^",$P(LN,"-",81)="",SITE=$P($$SITE^VASITE(),U,2)
"RTN","RGMTAUD",52,0)
 S PRGBDT=$$FMTE^XLFDT(RGBDT),PRGEDT=$$FMTE^XLFDT(RGEDT)
"RTN","RGMTAUD",53,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTAUD",54,0)
 D HDR
"RTN","RGMTAUD",55,0)
 I '$O(^TMP("RGMTAUD",$J,0)) W !!,"No audit data found in this date range for this patient." Q
"RTN","RGMTAUD",56,0)
 S EDITDT=0 F  S EDITDT=$O(^TMP("RGMTAUD",$J,EDITDT)) Q:QFLG  Q:'EDITDT  D
"RTN","RGMTAUD",57,0)
 .S IEN=0 F  S IEN=$O(^TMP("RGMTAUD",$J,EDITDT,IEN)) Q:QFLG  Q:'IEN  D
"RTN","RGMTAUD",58,0)
 ..S PRTDT=$$FMTE^XLFDT($E(EDITDT,1,12))
"RTN","RGMTAUD",59,0)
 ..S IEN0=^DIA(2,IEN,0)
"RTN","RGMTAUD",60,0)
 ..K RGARR D FIELD^DID(2,$P(IEN0,U,3),"","LABEL","RGARR")
"RTN","RGMTAUD",61,0)
 ..S FLD=$G(RGARR("LABEL")) Q:FLD=""
"RTN","RGMTAUD",62,0)
 ..S USER=$P(IEN0,U,4)
"RTN","RGMTAUD",63,0)
 ..I 'USER S USER="UNKNOWN"
"RTN","RGMTAUD",64,0)
 ..I USER'="UNKNOWN" S DIC="^VA(200,",DIC(0)="MZO",X="`"_USER D ^DIC S USER=$P(Y,"^",2)
"RTN","RGMTAUD",65,0)
 ..S OLD=$G(^DIA(2,IEN,2)) I OLD']"" S OLD="<no previous value>"
"RTN","RGMTAUD",66,0)
 ..S NEW=$G(^DIA(2,IEN,3)) I NEW']"" S NEW="<no current value>"
"RTN","RGMTAUD",67,0)
 ..K OPTDA1,OPTDA2,RGOPTN,OPTNM I $G(^DIA(2,IEN,4.1)) D
"RTN","RGMTAUD",68,0)
 ...S OPTDA1=+$P(^DIA(2,IEN,4.1),"^")
"RTN","RGMTAUD",69,0)
 ...I OPTDA1 S DIC=19,DR=".01",DA=OPTDA1,DIQ(0)="EI",DIQ="RGOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S RGOPTN=$G(RGOPTN(19,OPTDA1,.01,"E"))
"RTN","RGMTAUD",70,0)
 ...S OPTDA2=$P(^DIA(2,IEN,4.1),"^",2)
"RTN","RGMTAUD",71,0)
 ...I $P(OPTDA2,";",2)="ORD(101," S DIC=101,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="RGOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(RGOPTN(101,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUD",72,0)
 ...I +OPTDA2 S DIC=19,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="RGOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(RGOPTN(19,+OPTDA2,.01,"E")) Q
"RTN","RGMTAUD",73,0)
 ..I 'RPCFLG D:$Y+4>IOSL HDR Q:QFLG
"RTN","RGMTAUD",74,0)
 ..W !,PRTDT,?20,FLD,?51,USER,!?20,OLD," / ",NEW
"RTN","RGMTAUD",75,0)
 ..I $G(RGOPTN)'="" W !?3,RGOPTN ;**20
"RTN","RGMTAUD",76,0)
 ..I $G(OPTNM)'="" W:$G(RGOPTN)="" !?3 W "/",$G(OPTNM) ;**20
"RTN","RGMTAUD",77,0)
 ..W !
"RTN","RGMTAUD",78,0)
 Q
"RTN","RGMTAUD",79,0)
 ;
"RTN","RGMTAUD",80,0)
QUIT ;
"RTN","RGMTAUD",81,0)
 I 'RPCFLG,$E(IOST,1,2)="C-"&('QFLG) S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTAUD",82,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUD",83,0)
 I 'RPCFLG D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGMTAUD",84,0)
 K ^TMP("RGMTAUD",$J)
"RTN","RGMTAUD",85,0)
 K %,%I,C,RGDFN,EDITDT,FLD,HDT,IEN,IEN0,JJ,LN,NEW,OLD,OPTDA1,OPTDA2,RGOPTN,OPTNM,PG,PRGBDT,PRGEDT,PRTDT
"RTN","RGMTAUD",86,0)
 K QFLG,RGARR,RGBDT,RGEDT,RPCFLG,SITE,SS,STOP,USER,X,Y,ZTSK
"RTN","RGMTAUD",87,0)
 Q
"RTN","RGMTAUD",88,0)
 ;
"RTN","RGMTAUD",89,0)
HDR ;HEADER
"RTN","RGMTAUD",90,0)
 I 'RPCFLG I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTAUD",91,0)
 I 'RPCFLG I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGMTAUD",92,0)
 S PG=PG+1
"RTN","RGMTAUD",93,0)
 I 'RPCFLG W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","RGMTAUD",94,0)
 W !,"PATIENT AUDIT LIST at ",SITE," on ",HDT,?70,"Page: ",PG
"RTN","RGMTAUD",95,0)
 W !,"Patient: ",$P(^DPT(RGDFN,0),U)," (DFN #",RGDFN,")"
"RTN","RGMTAUD",96,0)
 W !,"Date Range: ",PRGBDT," to ",PRGEDT
"RTN","RGMTAUD",97,0)
 W !!,"Date/Time Edited",?20,"Field Edited",?51,"Edited By"
"RTN","RGMTAUD",98,0)
 W !?20,"Old Value / New Value",!?3,"Option/Protocol",!,LN
"RTN","RGMTAUD",99,0)
 Q
"RTN","RGMTETOT")
0^19^B36529619
"RTN","RGMTETOT",1,0)
RGMTETOT ;BIR/CML-Compile Totals for Site Exceptions ;11/15/01
"RTN","RGMTETOT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGMTETOT",3,0)
 ;
"RTN","RGMTETOT",4,0)
 ;Reference to ^DPT("AICNL" supported by IA #2070
"RTN","RGMTETOT",5,0)
 ;
"RTN","RGMTETOT",6,0)
 ;Variable RGHLMQ cannot be killed in this routine, it is needed for the remote query
"RTN","RGMTETOT",7,0)
 ;
"RTN","RGMTETOT",8,0)
 ;Use this routine to compile totals of a site's exceptions in file #991.1
"RTN","RGMTETOT",9,0)
 S DUMP=0 G START
"RTN","RGMTETOT",10,0)
 ;
"RTN","RGMTETOT",11,0)
DUMP1 ;Use this call to dump all data in ascii format for table
"RTN","RGMTETOT",12,0)
 S DUMP=1 G START
"RTN","RGMTETOT",13,0)
 ;
"RTN","RGMTETOT",14,0)
DUMP2 ;Use this call to dump data in ascii format for table - just for exceptions sites have to deal with
"RTN","RGMTETOT",15,0)
 S DUMP=2
"RTN","RGMTETOT",16,0)
 ;
"RTN","RGMTETOT",17,0)
START ;
"RTN","RGMTETOT",18,0)
 ;do purge of any dups for POTENTIAL MATCH Exceptions
"RTN","RGMTETOT",19,0)
 K TYPEARR,^XTMP("RGMT","HLMQETOT")
"RTN","RGMTETOT",20,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_$$NOW^XLFDT_"^MPI/PD Maintenance Data"
"RTN","RGMTETOT",21,0)
 D PURGE
"RTN","RGMTETOT",22,0)
 ;create type array from file 991.11
"RTN","RGMTETOT",23,0)
 S TYPE=199 F  S TYPE=$O(^RGHL7(991.11,TYPE)) Q:'TYPE  I TYPE'=218 S TYPEARR(TYPE)=0
"RTN","RGMTETOT",24,0)
 ;
"RTN","RGMTETOT",25,0)
 ;start loop
"RTN","RGMTETOT",26,0)
 S TYPE=199 F  S TYPE=$O(^RGHL7(991.1,"AC",TYPE)) Q:'TYPE  D
"RTN","RGMTETOT",27,0)
 .Q:TYPE=218
"RTN","RGMTETOT",28,0)
 .S IEN1=0 F  S IEN1=$O(^RGHL7(991.1,"AC",TYPE,IEN1)) Q:'IEN1  D
"RTN","RGMTETOT",29,0)
 ..S IEN2=0 F  S IEN2=$O(^RGHL7(991.1,"AC",TYPE,IEN1,IEN2)) Q:'IEN2  D
"RTN","RGMTETOT",30,0)
 ...S STAT=$P(^RGHL7(991.1,IEN1,1,IEN2,0),"^",5) I STAT<1 S TYPEARR(TYPE)=TYPEARR(TYPE)+1
"RTN","RGMTETOT",31,0)
 ;
"RTN","RGMTETOT",32,0)
PRT ;
"RTN","RGMTETOT",33,0)
 S GRAND=0
"RTN","RGMTETOT",34,0)
 S SITENM=$P($$SITE^VASITE(),"^",2),$P(LN,"-",81)=""
"RTN","RGMTETOT",35,0)
 D NOW^%DTC S RUNDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTETOT",36,0)
 ;
"RTN","RGMTETOT",37,0)
PRT0 I 'DUMP D
"RTN","RGMTETOT",38,0)
 .W !!,"Exception Totals for ",SITENM
"RTN","RGMTETOT",39,0)
 .W !,"Printed ",RUNDT,!,LN
"RTN","RGMTETOT",40,0)
 .S TYPE=0 F  S TYPE=$O(TYPEARR(TYPE)) Q:'TYPE  I +TYPEARR(TYPE) D
"RTN","RGMTETOT",41,0)
 ..S GRAND=GRAND+TYPEARR(TYPE)
"RTN","RGMTETOT",42,0)
 ..W !!,"TYPE: ",TYPE,?12,$P($T(@TYPE),";;",2),?67,"TOTAL = ",$J(TYPEARR(TYPE),4)
"RTN","RGMTETOT",43,0)
 ..W !,"DESCRIPTION:"
"RTN","RGMTETOT",44,0)
 ..S TXT=0 F  S TXT=$O(^RGHL7(991.11,TYPE,99,TXT)) Q:'TXT  W !,^RGHL7(991.11,TYPE,99,TXT,0)
"RTN","RGMTETOT",45,0)
 .W !!?56,"TOTAL EXCEPTIONS: ",$J(GRAND,5)
"RTN","RGMTETOT",46,0)
 ;
"RTN","RGMTETOT",47,0)
PRT1 I DUMP=1 D
"RTN","RGMTETOT",48,0)
 .W !!,"At this point it is necessary for you to increase the right margin."
"RTN","RGMTETOT",49,0)
 .W !,"At the DEVICE prompt enter=> ;255"
"RTN","RGMTETOT",50,0)
 .W ! D ^%ZIS I POP W !,"DOWNLOAD ABORTED!" Q
"RTN","RGMTETOT",51,0)
 .W !!,"Data string=Site;Run Date;Date CIRN Installed;Exceptions 200-229"
"RTN","RGMTETOT",52,0)
 .S STR=SITENM_";"_RUNDT_";"
"RTN","RGMTETOT",53,0)
 .S TYPE=0 F  S TYPE=$O(TYPEARR(TYPE)) Q:'TYPE  D
"RTN","RGMTETOT",54,0)
 ..S STR=STR_";"_TYPEARR(TYPE)
"RTN","RGMTETOT",55,0)
 .W !!,STR
"RTN","RGMTETOT",56,0)
 ;
"RTN","RGMTETOT",57,0)
PRT2 I DUMP=2 D
"RTN","RGMTETOT",58,0)
 .S ICN=0,LOCCNT=0 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S LOCCNT=LOCCNT+1
"RTN","RGMTETOT",59,0)
 .S SITEIEN=+$$SITE^VASITE(),STANUM=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTETOT",60,0)
 .I '$D(RGHLMQ) W !!,"Data string:"
"RTN","RGMTETOT",61,0)
 .I '$D(RGHLMQ) W !,"Site;Sta#;;;LocICNs,209,213,214,215,216,217,218,219,223,225,226,227,229"
"RTN","RGMTETOT",62,0)
 .S STR=SITENM_";"_STANUM_";;;"_LOCCNT
"RTN","RGMTETOT",63,0)
 .F TYPE=209,213,214,215,216,217,218,219,226,227,229,233 S STR=STR_";"_TYPEARR(TYPE)
"RTN","RGMTETOT",64,0)
 .I '$D(RGHLMQ) W !!,STR
"RTN","RGMTETOT",65,0)
 .I $D(RGHLMQ) S ^XTMP("RGMT","HLMQETOT",STANUM,1)=STR
"RTN","RGMTETOT",66,0)
 ;
"RTN","RGMTETOT",67,0)
QUIT ;
"RTN","RGMTETOT",68,0)
 K %,CIRNIEN,CNT,DA,DIK,DUMP,DUPCNT,EXCDT,GRAND,ICN,IEN,IEN1,IEN2,LN,LOCCNT,OLDDT,OLDNODE,PTNM
"RTN","RGMTETOT",69,0)
 K RGDFN,RUNDT,SITEIEN,SITENM,STANUM,STAT,STR,TXT,TYPE,XCNT,HOME,DFN,RCNT,VADM
"RTN","RGMTETOT",70,0)
 K ^XTMP("RGMT","ETOT")
"RTN","RGMTETOT",71,0)
 Q
"RTN","RGMTETOT",72,0)
 ;
"RTN","RGMTETOT",73,0)
PURGE ;
"RTN","RGMTETOT",74,0)
 I '$D(RGHLMQ) W !!,"...purging duplicate Potential Match Exceptions",!
"RTN","RGMTETOT",75,0)
 K ^XTMP("RGMT","ETOT")
"RTN","RGMTETOT",76,0)
 S (RGDFN,CNT,XCNT,DUPCNT)=0,HOME=$$SITE^VASITE()
"RTN","RGMTETOT",77,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D
"RTN","RGMTETOT",78,0)
 .S IEN=0
"RTN","RGMTETOT",79,0)
 .F  S IEN=$O(^RGHL7(991.1,"ADFN",218,RGDFN,IEN)) Q:'IEN  D
"RTN","RGMTETOT",80,0)
 ..S IEN2=0
"RTN","RGMTETOT",81,0)
 ..F  S IEN2=$O(^RGHL7(991.1,"ADFN",218,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGMTETOT",82,0)
 ...I '$D(^RGHL7(991.1,IEN,0)) Q
"RTN","RGMTETOT",83,0)
 ...S CNT=CNT+1
"RTN","RGMTETOT",84,0)
 ...S EXCDT=$P(^RGHL7(991.1,IEN,0),"^",3)
"RTN","RGMTETOT",85,0)
 ...I '$D(^XTMP("RGMT","ETOT",RGDFN)) D  Q
"RTN","RGMTETOT",86,0)
 ....S XCNT=XCNT+1
"RTN","RGMTETOT",87,0)
 ....D SETTMP
"RTN","RGMTETOT",88,0)
 ...I $D(^XTMP("RGMT","ETOT",RGDFN))  D
"RTN","RGMTETOT",89,0)
 ....S OLDNODE=^XTMP("RGMT","ETOT",RGDFN)
"RTN","RGMTETOT",90,0)
 ....S OLDDT=$P(OLDNODE,"^")
"RTN","RGMTETOT",91,0)
 ....I EXCDT>OLDDT D  Q
"RTN","RGMTETOT",92,0)
 .....S DA(1)=$P(OLDNODE,"^",2),DA=$P(OLDNODE,"^",3)
"RTN","RGMTETOT",93,0)
 .....D DELDUP
"RTN","RGMTETOT",94,0)
 .....D SETTMP
"RTN","RGMTETOT",95,0)
 ....I OLDDT>EXCDT!(OLDDT=EXCDT) D
"RTN","RGMTETOT",96,0)
 .....S DA(1)=IEN,DA=IEN2
"RTN","RGMTETOT",97,0)
 .....D DELDUP
"RTN","RGMTETOT",98,0)
 I '$D(RGHLMQ) W !,DUPCNT," duplicate patient entries for POTENTIAL MATCH exceptions were identified"
"RTN","RGMTETOT",99,0)
 I '$D(RGHLMQ) W !,"and deleted from the CIRN HL7 EXCEPTION LOG file (#991.1)."
"RTN","RGMTETOT",100,0)
 ;
"RTN","RGMTETOT",101,0)
 K ^XTMP("RGMT","ETOT")
"RTN","RGMTETOT",102,0)
 S (RCNT,RGDFN)=0
"RTN","RGMTETOT",103,0)
 F  S RGDFN=$O(^RGHL7(991.1,"ADFN",218,RGDFN)) Q:'RGDFN  D
"RTN","RGMTETOT",104,0)
 .S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGMTETOT",105,0)
 .I $E(ICN,1,3)=$P(HOME,"^",3)!(ICN<0) D
"RTN","RGMTETOT",106,0)
 ..S DFN=RGDFN D DEM^VADPT
"RTN","RGMTETOT",107,0)
 ..I VADM(1)=""!(VADM(2)="") Q
"RTN","RGMTETOT",108,0)
 ..S RCNT=RCNT+1
"RTN","RGMTETOT",109,0)
 ..S ^XTMP("RGMT","ETOT",VADM(1),RGDFN)=$P(VADM(2),"^")_"^"_$P(VADM(3),"^",2)
"RTN","RGMTETOT",110,0)
 ;
"RTN","RGMTETOT",111,0)
 ;count the number of patients who need to be resolved
"RTN","RGMTETOT",112,0)
 S PTNM="",CNT=0
"RTN","RGMTETOT",113,0)
 F  S PTNM=$O(^XTMP("RGMT","ETOT",PTNM)) Q:PTNM=""  D
"RTN","RGMTETOT",114,0)
 .S RGDFN=0
"RTN","RGMTETOT",115,0)
 .F  S RGDFN=$O(^XTMP("RGMT","ETOT",PTNM,RGDFN)) Q:'RGDFN  S CNT=CNT+1
"RTN","RGMTETOT",116,0)
 S TYPEARR(218)=CNT
"RTN","RGMTETOT",117,0)
 Q
"RTN","RGMTETOT",118,0)
 ;
"RTN","RGMTETOT",119,0)
SETTMP ;set TMP global for patient check
"RTN","RGMTETOT",120,0)
 S ^XTMP("RGMT","ETOT",RGDFN)=EXCDT_"^"_IEN_"^"_IEN2
"RTN","RGMTETOT",121,0)
 Q
"RTN","RGMTETOT",122,0)
 ;
"RTN","RGMTETOT",123,0)
DELDUP ;delete patient dups from file
"RTN","RGMTETOT",124,0)
 S DUPCNT=DUPCNT+1
"RTN","RGMTETOT",125,0)
 S DIK="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGMTETOT",126,0)
 D ^DIK K DIK,DA
"RTN","RGMTETOT",127,0)
 Q
"RTN","RGMTETOT",128,0)
 ;
"RTN","RGMTETOT",129,0)
200 ;;(Missing BHS Segment)
"RTN","RGMTETOT",130,0)
201 ;;(Missing MSH Segment
"RTN","RGMTETOT",131,0)
202 ;;(Missing QAK Segment)
"RTN","RGMTETOT",132,0)
203 ;;(Missing MSA Segment)
"RTN","RGMTETOT",133,0)
204 ;;(Missing RDF Segment)
"RTN","RGMTETOT",134,0)
205 ;;(Missing RDT Segment)
"RTN","RGMTETOT",135,0)
206 ;;(Could Not Create VTQ)
"RTN","RGMTETOT",136,0)
207 ;;(Application Reject Error)
"RTN","RGMTETOT",137,0)
208 ;;(Application Error)
"RTN","RGMTETOT",138,0)
209 ;;(Required field(s) Missing)
"RTN","RGMTETOT",139,0)
210 ;;(Patient DFN Failed)
"RTN","RGMTETOT",140,0)
211 ;;(CMOR Lookup Failed)
"RTN","RGMTETOT",141,0)
212 ;;(TF Update Failed in Pivot file)
"RTN","RGMTETOT",142,0)
213 ;;(SSN Match Failed)
"RTN","RGMTETOT",143,0)
214 ;;(Name Doesn't Match)
"RTN","RGMTETOT",144,0)
215 ;;(Death Entry on MPI not in VISTA)
"RTN","RGMTETOT",145,0)
216 ;;(Death Entry on Vista not in MPI)
"RTN","RGMTETOT",146,0)
217 ;;(Death Entries Mismatch)
"RTN","RGMTETOT",147,0)
218 ;;(Potential Matches Returned)
"RTN","RGMTETOT",148,0)
219 ;;(Missing ICN)
"RTN","RGMTETOT",149,0)
220 ;;(Error Setting Up HL7)
"RTN","RGMTETOT",150,0)
221 ;;(Missing Site/CMOR)
"RTN","RGMTETOT",151,0)
222 ;;(Invalid Event Type)
"RTN","RGMTETOT",152,0)
223 ;;(Missing Excepted Field)
"RTN","RGMTETOT",153,0)
224 ;;(Missing/Unable to get Logical Link)
"RTN","RGMTETOT",154,0)
225 ;;(Have Subscribers)
"RTN","RGMTETOT",155,0)
226 ;;(Not CMOR)
"RTN","RGMTETOT",156,0)
227 ;;(Multiple ICNs)
"RTN","RGMTETOT",157,0)
228 ;;(Patient Does Not Exist)
"RTN","RGMTETOT",158,0)
229 ;;(Duplicate Station Number)
"RTN","RGMTETOT",159,0)
230 ;;(Invalid Sender Of Facility Integration Message)
"RTN","RGMTETOT",160,0)
231 ;;(Treating Facility Not Known To CMOR)
"RTN","RGMTETOT",161,0)
232 ;;(Subscriber Not Known To CMOR)
"RTN","RGMTETOT",162,0)
233 ;;(Cannot Merge Duplicate Pair)
"RTN","RGMTHL2")
0^20^B46816698
"RTN","RGMTHL2",1,0)
RGMTHL2 ;BIR/CML-COMPILE MPI/PD HL7 DATA FOR BI-DIRECTIONAL TCP ;11/15/01
"RTN","RGMTHL2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**21,23,28,20**;30 Apr 99
"RTN","RGMTHL2",3,0)
 ;
"RTN","RGMTHL2",4,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTHL2",5,0)
 ;Reference to ^HL(772 supported by IA #3464
"RTN","RGMTHL2",6,0)
 ;Reference to ^HL(771.6 supported by IA #2507
"RTN","RGMTHL2",7,0)
 ;Reference to ^HLMA( supported by IA #3273
"RTN","RGMTHL2",8,0)
 ;Reference to ^DPT("AICN" supported by IA #2070
"RTN","RGMTHL2",9,0)
 ;
"RTN","RGMTHL2",10,0)
 ;Check to see if the ^XTMP global is present and/or complete
"RTN","RGMTHL2",11,0)
 W @IOF
"RTN","RGMTHL2",12,0)
 W !,"This utility searches the HL7 MESSAGE TEXT (#772) file for a selected"
"RTN","RGMTHL2",13,0)
 W !,"date range.  Each HL7 message in the date range is examined.  If the"
"RTN","RGMTHL2",14,0)
 W !,"RELATED EVENT PROTOCOL field contains the MPI/PD protocols (e.g., ""VAF"","
"RTN","RGMTHL2",15,0)
 W !,"""RG"", or ""MPI"") data is compiled into the ^XTMP(""RGMT"",""HL"" array."
"RTN","RGMTHL2",16,0)
 W !!,"A cross-reference is built on patient ICN and DFN for faster data retrieval"
"RTN","RGMTHL2",17,0)
 W !,"for the associated reports."
"RTN","RGMTHL2",18,0)
 ;
"RTN","RGMTHL2",19,0)
 G:'$D(^XTMP("RGMT","HL")) BEGIN
"RTN","RGMTHL2",20,0)
 I '$D(^XTMP("RGMT","HL","@@@@","STOPPED")) D
"RTN","RGMTHL2",21,0)
 .W !!,$C(7),"The Compile MPI/PD HL7 Data compilation is already running!" G QUIT
"RTN","RGMTHL2",22,0)
 S CDT=$$FMTE^XLFDT($E(+^XTMP("RGMT","HL","@@@@","STOPPED"),1,12))
"RTN","RGMTHL2",23,0)
 W !!,"=> ""Compile MPI/PD HL7 Data"" last ran to completion on "_CDT_".",!
"RTN","RGMTHL2",24,0)
 I $D(^XTMP("RGMT","HL","@@@@","RANGE")) D
"RTN","RGMTHL2",25,0)
 .W !,"=> Data has been compiled for ",^XTMP("RGMT","HL","@@@@","RANGE"),"."
"RTN","RGMTHL2",26,0)
 W ! K DIR S DIR(0)="SMB^D:DELETE;A:APPEND"
"RTN","RGMTHL2",27,0)
 S DIR("A",1)="Do you want to:"
"RTN","RGMTHL2",28,0)
 S DIR("A",2)="(D)elete existing data and recompile."
"RTN","RGMTHL2",29,0)
 S DIR("A")="(A)ppend new data after last date of existing data"
"RTN","RGMTHL2",30,0)
 S DIR("B")="A"
"RTN","RGMTHL2",31,0)
 S DIR("?",1)="Enter:",DIR("?",2)="D if you want to delete exiting data and recompile."
"RTN","RGMTHL2",32,0)
 S DIR("?",3)="A or <RET> to append new data after last date of existing data."
"RTN","RGMTHL2",33,0)
 S DIR("?")="""^"" to HALT."
"RTN","RGMTHL2",34,0)
 D ^DIR K DIR G:$D(DIRUT) QUIT S ACT=Y
"RTN","RGMTHL2",35,0)
 ;
"RTN","RGMTHL2",36,0)
BEGIN ;
"RTN","RGMTHL2",37,0)
 S RGNOW=$$NOW^XLFDT()
"RTN","RGMTHL2",38,0)
 S:'$D(ACT) ACT="D"
"RTN","RGMTHL2",39,0)
 W !!,"Enter date range for data to be compiled."
"RTN","RGMTHL2",40,0)
 I ACT="A" D
"RTN","RGMTHL2",41,0)
 .S X1=^XTMP("RGMT","HL","@@@@","COMPENDDATE"),X2=1 D C^%DTC
"RTN","RGMTHL2",42,0)
 .S RGBDT=X W !,"Beginning Date for Report: ",$$FMTE^XLFDT(X)
"RTN","RGMTHL2",43,0)
 I ACT="D" D  G:$D(DIRUT) QUIT
"RTN","RGMTHL2",44,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","RGMTHL2",45,0)
 .S DIR(0)="DAO^:"_$$NOW^XLFDT()_":EPXT",DIR("A")="Beginning Date for Report:  "
"RTN","RGMTHL2",46,0)
 .D ^DIR K DIR Q:$D(DIRUT)  S RGBDT=Y
"RTN","RGMTHL2",47,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","RGMTHL2",48,0)
 S DIR(0)="DAO^"_RGBDT_":"_$$NOW^XLFDT()_":EPXT",DIR("A")="Ending Date for Report:  "
"RTN","RGMTHL2",49,0)
 D ^DIR K DIR G:$D(DIRUT) QUIT S RGEDT=Y
"RTN","RGMTHL2",50,0)
 ;
"RTN","RGMTHL2",51,0)
QUE ;Queue the task.
"RTN","RGMTHL2",52,0)
 S ZTSAVE("RGBDT")="",ZTSAVE("RGEDT")="",ZTSAVE("ACT")=""
"RTN","RGMTHL2",53,0)
 S ZTIO="",ZTRTN="START^RGMTHL2",ZTDESC="Compile MPI/PD HL7 Data (bi-directional)" D ^%ZTLOAD
"RTN","RGMTHL2",54,0)
 G QUIT
"RTN","RGMTHL2",55,0)
 ;
"RTN","RGMTHL2",56,0)
START ;
"RTN","RGMTHL2",57,0)
 S QFLG=0
"RTN","RGMTHL2",58,0)
 K ^XTMP("RGMT","HL","@@@@","STOPPED")
"RTN","RGMTHL2",59,0)
 I ACT="D" K ^XTMP("RGMT","HL"),^XTMP("RGMT","HLICN"),^XTMP("RGMT","HLDFN")
"RTN","RGMTHL2",60,0)
 S U="^" D NOW^%DTC
"RTN","RGMTHL2",61,0)
 S ^XTMP("RGMT","HL","@@@@","STARTED")=%
"RTN","RGMTHL2",62,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_%_"^MPI/PD Maintenance Data"
"RTN","RGMTHL2",63,0)
 S STOPDT=$S($L(RGEDT)=7:RGEDT_.24,1:RGEDT)
"RTN","RGMTHL2",64,0)
 S RGDT=$S($L(RGBDT)=7:$$FMADD^XLFDT(RGBDT,-1)_.24,1:RGBDT-.0001)
"RTN","RGMTHL2",65,0)
 I ACT="D" S ^XTMP("RGMT","HL","@@@@","COMPBEGINDATE")=RGDT
"RTN","RGMTHL2",66,0)
 S ^XTMP("RGMT","HL","@@@@","COMPENDDATE")=STOPDT
"RTN","RGMTHL2",67,0)
 S PRGBDT=$$FMTE^XLFDT(RGDT)
"RTN","RGMTHL2",68,0)
 S PRGEDT=$$FMTE^XLFDT(STOPDT)
"RTN","RGMTHL2",69,0)
 S ^XTMP("RGMT","HL","@@@@","RANGE")=PRGBDT_" to "_PRGEDT
"RTN","RGMTHL2",70,0)
 ;
"RTN","RGMTHL2",71,0)
LOOP ;Loop on ^HL(772 date xref
"RTN","RGMTHL2",72,0)
 F  S RGDT=$O(^HL(772,"B",RGDT)) Q:'RGDT  Q:RGDT>STOPDT  Q:QFLG  D
"RTN","RGMTHL2",73,0)
 .I $D(^XTMP("RGMT","HL","@@@@","FORCE STOP")) S QFLG=1 Q
"RTN","RGMTHL2",74,0)
 .S ^XTMP("RGMT","HL","@@@@","NOW PROCESSING DATE")=RGDT
"RTN","RGMTHL2",75,0)
 .S IEN=0
"RTN","RGMTHL2",76,0)
 .F  S IEN=$O(^HL(772,"B",RGDT,IEN)) Q:'IEN  S IEN0=$G(^HL(772,IEN,0)) Q:'IEN0  D
"RTN","RGMTHL2",77,0)
 ..S REP=$P(IEN0,U,10)
"RTN","RGMTHL2",78,0)
 ..I REP D
"RTN","RGMTHL2",79,0)
 ...I '$D(^ORD(101,REP,0)) Q
"RTN","RGMTHL2",80,0)
 ...S REPNM=$P(^ORD(101,REP,0),U),RPNM=$E(REPNM,1,4)
"RTN","RGMTHL2",81,0)
 ...I RPNM["VAF"!(RPNM["RG")!(RPNM["MPI") D
"RTN","RGMTHL2",82,0)
 ....S TYPE=$P(IEN0,U,4),STAT=$P($G(^HL(772,IEN,"P")),U)
"RTN","RGMTHL2",83,0)
 ....I STAT="" D
"RTN","RGMTHL2",84,0)
 .....S HL773=$O(^HLMA("B",IEN,0))
"RTN","RGMTHL2",85,0)
 .....S STAT=$P($G(^HLMA(HL773,"P")),"^")
"RTN","RGMTHL2",86,0)
 ....I STAT S STATNM=$P(^HL(771.6,STAT,0),U)
"RTN","RGMTHL2",87,0)
 ....I STAT="" S STATNM="NO STATUS"
"RTN","RGMTHL2",88,0)
 ....S ^XTMP("RGMT","HL",REPNM,$P(RGDT,"."),TYPE,STATNM,IEN)=""
"RTN","RGMTHL2",89,0)
PAT ....S TXT=0 F  S TXT=$O(^HL(772,IEN,"IN",TXT)) Q:'TXT  D
"RTN","RGMTHL2",90,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="PID" S GOT=0 D  Q:GOT
"RTN","RGMTHL2",91,0)
 ......I $P(^HL(772,IEN,"IN",TXT,0),"^",4)["V" S ICN=+$P(^(0),"^",4) D SET
"RTN","RGMTHL2",92,0)
 ......I $P(^HL(772,IEN,"IN",TXT,0),"^",3)["V" S ICN=+$P(^(0),"^",3) D SET
"RTN","RGMTHL2",93,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="QAK" S GOT=0 D  Q:GOT
"RTN","RGMTHL2",94,0)
 ......I +$P(^(0),U,2) S DFN=+$P(^(0),U,2) S ^XTMP("RGMT","HLDFN",DFN,RGDT,REPNM,TYPE,STATNM,IEN)="",GOT=1
"RTN","RGMTHL2",95,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="RDT" S ICN=+$P($P(^(0),U,6),"V") I ICN D  Q
"RTN","RGMTHL2",96,0)
 ......S ^XTMP("RGMT","HLICN",ICN,RGDT,REPNM,TYPE,STATNM,IEN)="(Look at ^HL(772,"_IEN_",""IN"","_TXT_",0)",GOT=1
"RTN","RGMTHL2",97,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="VTQ" S GOT=0 D  Q:GOT
"RTN","RGMTHL2",98,0)
 ......S SSN=$P($P(^HL(772,IEN,"IN",TXT,0),"@00122",2),"~",3) I SSN D
"RTN","RGMTHL2",99,0)
 .......S DFN=$O(^DPT("SSN",SSN,0)) I DFN D
"RTN","RGMTHL2",100,0)
 ........S ^XTMP("RGMT","HLDFN",DFN,RGDT,REPNM,TYPE,STATNM,IEN)="(Look at ^HL(772,"_IEN_",""IN"","_TXT_",0)",GOT=1
"RTN","RGMTHL2",101,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="MFE",$P(^(0),U,2)="MAD" S ICN=+$P($P(^(0),U,5),"~",4) D SET Q
"RTN","RGMTHL2",102,0)
 .....I $P(^HL(772,IEN,"IN",TXT,0),U)="MFE",$P(^(0),U,2)="MUP" D  Q
"RTN","RGMTHL2",103,0)
 ......S ICN=+$P(^HL(772,IEN,"IN",TXT,0),U,5) I $L(ICN)=3 S ICN=+$P($P(^HL(772,IEN,"IN",TXT,0),U,5),"~",4)
"RTN","RGMTHL2",104,0)
 ......D SET
"RTN","RGMTHL2",105,0)
 ;
"RTN","RGMTHL2",106,0)
 D NOW^%DTC S ^XTMP("RGMT","HL","@@@@","STOPPED")=%
"RTN","RGMTHL2",107,0)
 K ^XTMP("RGMT","HL","@@@@","NOW PROCESSING DATE"),^XTMP("RGMT","HL","@@@@","FORCE STOP")
"RTN","RGMTHL2",108,0)
 ;
"RTN","RGMTHL2",109,0)
QUIT ;
"RTN","RGMTHL2",110,0)
 K %,ACT,CDT,DFN,GOT,HL773,ICN,IEN,IEN0,PRGBDT,PRGEDT,REP,REPNM,RGBDT,RGDT
"RTN","RGMTHL2",111,0)
 K RGEDT,RGNOW,RPNM,SSN,STAT,STATNM,STOPDT,TYPE,TXT,X,X1,X2,Y,ZTSK,STOP,FROM,QFLG,RANGE
"RTN","RGMTHL2",112,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGMTHL2",113,0)
 Q
"RTN","RGMTHL2",114,0)
 ;
"RTN","RGMTHL2",115,0)
SET ;
"RTN","RGMTHL2",116,0)
 S GOT=1
"RTN","RGMTHL2",117,0)
 S ^XTMP("RGMT","HLICN",ICN,RGDT,REPNM,TYPE,STATNM,IEN)=""
"RTN","RGMTHL2",118,0)
 S DFN=$O(^DPT("AICN",ICN,0)) I +DFN S ^XTMP("RGMT","HLDFN",DFN,RGDT,REPNM,TYPE,STATNM,IEN)=""
"RTN","RGMTHL2",119,0)
 Q
"RTN","RGMTHL2",120,0)
 ;
"RTN","RGMTHL2",121,0)
STOP ;stop the compile
"RTN","RGMTHL2",122,0)
 W !!,"Stop HL7 Message Compile."
"RTN","RGMTHL2",123,0)
 I '$D(^XTMP("RGMT","HL","@@@@","STARTED")) W !?3,"<< No compile is currently running >>" G QUIT
"RTN","RGMTHL2",124,0)
 I $D(^XTMP("RGMT","HL","@@@@","STARTED"))&($D(^XTMP("RGMT","HL","@@@@","STOPPED"))) W !?3,"<< No compile is currently running >>" G QUIT
"RTN","RGMTHL2",125,0)
 ;
"RTN","RGMTHL2",126,0)
 W !!,"A compile is currently running for ",?35,": ",^XTMP("RGMT","HL","@@@@","RANGE"),"."
"RTN","RGMTHL2",127,0)
 W ! S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Do you want to stop this compile" D ^DIR K DIR
"RTN","RGMTHL2",128,0)
 I +Y D
"RTN","RGMTHL2",129,0)
 .S ^XTMP("RGMT","HL","@@@@","FORCE STOP")=""
"RTN","RGMTHL2",130,0)
 .S STOP=$$NOW^XLFDT
"RTN","RGMTHL2",131,0)
 .S RANGE=^XTMP("RGMT","HL","@@@@","RANGE"),FROM=$P(RANGE," to ",1)
"RTN","RGMTHL2",132,0)
 .S ^XTMP("RGMT","HL","@@@@","RANGE")=FROM_" to "_$$FMTE^XLFDT(STOP)
"RTN","RGMTHL2",133,0)
 G QUIT
"RTN","RGMTHL2",134,0)
 ;
"RTN","RGMTHL2",135,0)
SHOW ;show status of compile
"RTN","RGMTHL2",136,0)
 W !!,"Show status of HL7 Message Compile."
"RTN","RGMTHL2",137,0)
 I '$D(^XTMP("RGMT","HL","@@@@","STARTED")) W !?3,"<< No compile is currently running >>" G QUIT
"RTN","RGMTHL2",138,0)
 W !!,"Compile range ",?31,": ",^XTMP("RGMT","HL","@@@@","RANGE")
"RTN","RGMTHL2",139,0)
 W !,"The compile was started ",?31,": ",$$FMTE^XLFDT(^XTMP("RGMT","HL","@@@@","STARTED"))
"RTN","RGMTHL2",140,0)
 I $D(^XTMP("RGMT","HL","@@@@","NOW PROCESSING DATE")) D
"RTN","RGMTHL2",141,0)
 .W !,"The compile is now processing ",?31,": ",$$FMTE^XLFDT(^XTMP("RGMT","HL","@@@@","NOW PROCESSING DATE"))
"RTN","RGMTHL2",142,0)
 I $D(^XTMP("RGMT","HL","@@@@","STOPPED")) D
"RTN","RGMTHL2",143,0)
 .W !,"The compile was stopped ",?31,": ",$$FMTE^XLFDT(^XTMP("RGMT","HL","@@@@","STOPPED"))
"RTN","RGMTHL2",144,0)
 G QUIT
"RTN","RGMTMONT")
0^2^B30275961
"RTN","RGMTMONT",1,0)
RGMTMONT ;BIR/CML,PTD-MPI/PD Monitor HL7 Messaging/Filers and Setups ;07/30/02
"RTN","RGMTMONT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGMTMONT",3,0)
 ;
"RTN","RGMTMONT",4,0)
 ;Reference to OPTION SCHEDULING (#19.2) file supported by IA #3599
"RTN","RGMTMONT",5,0)
 ;Reference to ^DPT("AICNL" supported by IA #2070
"RTN","RGMTMONT",6,0)
 ;Reference to $$SEND^VAFHUTL for file DG(43 supported by IA #2624
"RTN","RGMTMONT",7,0)
 ;Reference to ^HLCS(870 supported by IA #3335
"RTN","RGMTMONT",8,0)
 ;Reference to $$STAT^HLCSLM supported by IA #3574
"RTN","RGMTMONT",9,0)
 ;
"RTN","RGMTMONT",10,0)
EN ;Call this routine from the top to do extended checks that include:
"RTN","RGMTMONT",11,0)
 ;- D HLMA1^RGMTUT98
"RTN","RGMTMONT",12,0)
 ;- D EN2^RGMTMONT
"RTN","RGMTMONT",13,0)
 ;- D ^RGMTMONX
"RTN","RGMTMONT",14,0)
 ;
"RTN","RGMTMONT",15,0)
 I $D(RGHLMQ) Q
"RTN","RGMTMONT",16,0)
 ;
"RTN","RGMTMONT",17,0)
 S CLUP=1
"RTN","RGMTMONT",18,0)
 W @IOF,"Logical Link Monitor:",!,"=====================",!
"RTN","RGMTMONT",19,0)
 D HLMA1^RGMTUT98
"RTN","RGMTMONT",20,0)
 S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTMONT",21,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTMONT",22,0)
 I $D(DIRUT) G QUIT
"RTN","RGMTMONT",23,0)
 ;
"RTN","RGMTMONT",24,0)
 D EN2
"RTN","RGMTMONT",25,0)
 S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTMONT",26,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTMONT",27,0)
 I $D(DIRUT) G QUIT
"RTN","RGMTMONT",28,0)
 ;
"RTN","RGMTMONT",29,0)
 D ^RGMTMONX
"RTN","RGMTMONT",30,0)
 ;
"RTN","RGMTMONT",31,0)
 G QUIT
"RTN","RGMTMONT",32,0)
 ;
"RTN","RGMTMONT",33,0)
EN2 ;Monitor Background Job - VAFC BATCH UPDATE
"RTN","RGMTMONT",34,0)
 ;Monitor Background Job - MPIF LOC/MIS ICN RES
"RTN","RGMTMONT",35,0)
 ;Check MAS PARAMETER file, field SEND PIMS HL7 V2.3 MESSAGES
"RTN","RGMTMONT",36,0)
 ;if call is being made from HL7 query, variable RGHLMQ will be defined
"RTN","RGMTMONT",37,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_$$NOW^XLFDT_"^MPI/PD Maintenance Data"
"RTN","RGMTMONT",38,0)
 K ^XTMP("RGMT","HLMQMONT")
"RTN","RGMTMONT",39,0)
 S LOCSITE=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTMONT",40,0)
 I $D(RGHLMQ) D
"RTN","RGMTMONT",41,0)
 .D NOW^%DTC
"RTN","RGMTMONT",42,0)
 .S ^XTMP("RGMT","HLMQMONT",LOCSITE,"@@ RUNDATE")=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTMONT",43,0)
 I '$D(RGHLMQ) W @IOF,"MPI/PD Process Monitor:",!,"======================="
"RTN","RGMTMONT",44,0)
 S TXTCNT=0
"RTN","RGMTMONT",45,0)
 N BKDA,CUR,MSG,SCHDA,SEND,TIME
"RTN","RGMTMONT",46,0)
CHK1 ;
"RTN","RGMTMONT",47,0)
 S TXT="Checking VAFC BATCH UPDATE background job..." D TXT
"RTN","RGMTMONT",48,0)
 D PIV^RGMTUT98
"RTN","RGMTMONT",49,0)
 S TXTCNT=3
"RTN","RGMTMONT",50,0)
 ;
"RTN","RGMTMONT",51,0)
 S DIC="^DIC(19,",X="VAFC BATCH UPDATE" D ^DIC K DIC S BKDA=+Y
"RTN","RGMTMONT",52,0)
 I BKDA<0 S TXT="=> VAFC BATCH UPDATE does not exist in OPTION file." D TXT K BKDA G CHK2
"RTN","RGMTMONT",53,0)
 S TXT="=> VAFC BATCH UPDATE is not currently scheduled to run."
"RTN","RGMTMONT",54,0)
 S DIC="^DIC(19.2,",X="VAFC BATCH UPDATE" D ^DIC K DIC S SCHDA=+Y
"RTN","RGMTMONT",55,0)
 I SCHDA<0 D TXT K BKDA,TXT,SCHDA G CHK2
"RTN","RGMTMONT",56,0)
 S TIME=$$GET1^DIQ(19.2,SCHDA_",",2)
"RTN","RGMTMONT",57,0)
 I TIME="" D TXT K BKDA,TXT,SCHDA,TIME G CHK2
"RTN","RGMTMONT",58,0)
 S TXT="=> VAFC BATCH UPDATE scheduled to run "_$$FMTE^XLFDT(TIME)_"."
"RTN","RGMTMONT",59,0)
 D TXT
"RTN","RGMTMONT",60,0)
 D NOW^%DTC
"RTN","RGMTMONT",61,0)
 S DAY=$E(%,1,7)
"RTN","RGMTMONT",62,0)
 ;
"RTN","RGMTMONT",63,0)
CHK2 ;
"RTN","RGMTMONT",64,0)
 S TXT="" D TXT
"RTN","RGMTMONT",65,0)
 ;
"RTN","RGMTMONT",66,0)
 S ICN=0,CNT=0
"RTN","RGMTMONT",67,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGMTMONT",68,0)
 S TXT="Checking MPIF LOC/MIS ICN RES background job...  (Total Local ICNs = "_CNT_")"
"RTN","RGMTMONT",69,0)
 D TXT
"RTN","RGMTMONT",70,0)
 ;
"RTN","RGMTMONT",71,0)
 S DIC="^DIC(19,",X="MPIF LOC/MIS ICN RES" D ^DIC K DIC S BKDA=+Y
"RTN","RGMTMONT",72,0)
 I BKDA<0 S TXT="=> MPIF LOC/MIS ICN RES does not exist in OPTION file." D TXT K BKDA G CHK2A
"RTN","RGMTMONT",73,0)
 S TXT="=> MPIF LOC/MIS ICN RES is not currently scheduled to run."
"RTN","RGMTMONT",74,0)
 S DIC="^DIC(19.2,",X="MPIF LOC/MIS ICN RES" D ^DIC K DIC S SCHDA=+Y
"RTN","RGMTMONT",75,0)
 I SCHDA<0 D TXT K BKDA,SCHDA G CHK2A
"RTN","RGMTMONT",76,0)
 S TIME=$$GET1^DIQ(19.2,SCHDA_",",2)
"RTN","RGMTMONT",77,0)
 I TIME="" D TXT K BKDA,SCHDA,TIME G CHK2A
"RTN","RGMTMONT",78,0)
 S TXT="=> MPIF LOC/MIS ICN RES is scheduled to run "_$$FMTE^XLFDT(TIME)_"."
"RTN","RGMTMONT",79,0)
 D TXT
"RTN","RGMTMONT",80,0)
 ;
"RTN","RGMTMONT",81,0)
CHK2A ;check for time local/missing job was last run
"RTN","RGMTMONT",82,0)
 S TIME=$P($G(^RGSITE(991.8,1,0)),"^",4) I TIME'="" D
"RTN","RGMTMONT",83,0)
 .S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGMTMONT",84,0)
 .S TXT="=> MPIF LOC/MIS ICN RES was last run "_TIME_"."
"RTN","RGMTMONT",85,0)
 .D TXT
"RTN","RGMTMONT",86,0)
 ;
"RTN","RGMTMONT",87,0)
CHK3 ;Check to see if .01 field in patient file has auditing turned on
"RTN","RGMTMONT",88,0)
 S TXT="" D TXT
"RTN","RGMTMONT",89,0)
 D FIELD^DID(2,.01,"","AUDIT","PATAUD")
"RTN","RGMTMONT",90,0)
 S PATAUD=$G(PATAUD("AUDIT")) I PATAUD="" S PATAUD="NOT SET"
"RTN","RGMTMONT",91,0)
 S PATAUD="<<"_PATAUD_">>"
"RTN","RGMTMONT",92,0)
 S TXT="=> Audit on NAME (#.01) field of PATIENT (#2) file set to "_PATAUD
"RTN","RGMTMONT",93,0)
 D TXT
"RTN","RGMTMONT",94,0)
 K PATAUD
"RTN","RGMTMONT",95,0)
 ;
"RTN","RGMTMONT",96,0)
CHK5 ;
"RTN","RGMTMONT",97,0)
 S TXT="" D TXT
"RTN","RGMTMONT",98,0)
 ;
"RTN","RGMTMONT",99,0)
 S TXT="Checking SEND Parameters for HL7 messaging..."
"RTN","RGMTMONT",100,0)
 D TXT
"RTN","RGMTMONT",101,0)
 ;
"RTN","RGMTMONT",102,0)
 S SEND=$P($$SEND^VAFHUTL,"^",2)
"RTN","RGMTMONT",103,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGMTMONT",104,0)
 S TXT="=> SEND PIMS HL7 V2.3 MESSAGES currently set to << "_CUR_" >>."
"RTN","RGMTMONT",105,0)
 D TXT
"RTN","RGMTMONT",106,0)
 ;
"RTN","RGMTMONT",107,0)
 S TXT="=> STOP MPI/PD MESSAGING currently set to "
"RTN","RGMTMONT",108,0)
 S SEND=$P($G(^RGSITE(991.8,1,1)),"^",6)
"RTN","RGMTMONT",109,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGMTMONT",110,0)
 S TXT="=> STOP MPI/PD MESSAGING currently set to << "_CUR_" >>."
"RTN","RGMTMONT",111,0)
 D TXT
"RTN","RGMTMONT",112,0)
 ;
"RTN","RGMTMONT",113,0)
CHK6 ;
"RTN","RGMTMONT",114,0)
 K RGMT
"RTN","RGMTMONT",115,0)
 S LOC=$P($$SITE^VASITE(),"^")
"RTN","RGMTMONT",116,0)
 D LINK^HLUTIL3(LOC,.RGMT)
"RTN","RGMTMONT",117,0)
 S LOCIEN=$O(RGMT(0))
"RTN","RGMTMONT",118,0)
 I 'LOCIEN D  G QUIT
"RTN","RGMTMONT",119,0)
 .S TXT="^DIC(4,""AC"" xref problem.  Check ^DIC(4,""AC"",,"_LOC
"RTN","RGMTMONT",120,0)
 .D TXT
"RTN","RGMTMONT",121,0)
 S LOCLINK=RGMT(LOCIEN)
"RTN","RGMTMONT",122,0)
 ;
"RTN","RGMTMONT",123,0)
 S TXT="" D TXT
"RTN","RGMTMONT",124,0)
 ;
"RTN","RGMTMONT",125,0)
 S TXT="Checking SHUTDOWN LLP? field and TCP/IP SERVICE TYPE for "_LOCLINK_"..."
"RTN","RGMTMONT",126,0)
 D TXT
"RTN","RGMTMONT",127,0)
 ;
"RTN","RGMTMONT",128,0)
 S CUR=$$GET1^DIQ(870,LOCIEN_",",14)
"RTN","RGMTMONT",129,0)
 S TXT="=> SHUTDOWN LLP? currently set to << "_CUR_" >>."
"RTN","RGMTMONT",130,0)
 D TXT
"RTN","RGMTMONT",131,0)
 ;
"RTN","RGMTMONT",132,0)
 S CUR=$$GET1^DIQ(870,LOCIEN_",",400.03)
"RTN","RGMTMONT",133,0)
 S TXT="=> TCP/IP SERVICE TYPE currently set to << "_CUR_" >>."
"RTN","RGMTMONT",134,0)
 D TXT
"RTN","RGMTMONT",135,0)
 ;
"RTN","RGMTMONT",136,0)
 ;check MPIVA for LLP TYPE
"RTN","RGMTMONT",137,0)
 S DIC="^HLCS(870,",X="MPIVA" D ^DIC K DIC S MPILL=+Y
"RTN","RGMTMONT",138,0)
 S CUR=$$GET1^DIQ(870,MPILL_",",2)
"RTN","RGMTMONT",139,0)
 S TXT="=> Logical Link MPIVA currently set to << "_CUR_" >>."
"RTN","RGMTMONT",140,0)
 D TXT
"RTN","RGMTMONT",141,0)
 ;
"RTN","RGMTMONT",142,0)
 ;check to see if Link Manager is running
"RTN","RGMTMONT",143,0)
 S LMSTAT=$$STAT^HLCSLM
"RTN","RGMTMONT",144,0)
 S CUR=$S('LMSTAT:"NOT RUNNING",1:"RUNNING")
"RTN","RGMTMONT",145,0)
 S TXT="=> HL LINK MANAGER is currently << "_CUR_" >>."
"RTN","RGMTMONT",146,0)
 D TXT
"RTN","RGMTMONT",147,0)
 ;
"RTN","RGMTMONT",148,0)
 I $D(RGHLMQ) D ^RGMTMONX
"RTN","RGMTMONT",149,0)
 ;
"RTN","RGMTMONT",150,0)
 I $D(CLUP),$D(DIRUT) Q
"RTN","RGMTMONT",151,0)
 ;
"RTN","RGMTMONT",152,0)
QUIT ;
"RTN","RGMTMONT",153,0)
 K %,BKDA,CLUP,CNT,CUR,DAY,DIR,DIRUT,ICN,JJ,LMSTAT,LOC,LOCIEN,LOCLINK
"RTN","RGMTMONT",154,0)
 K LOCSITE,MPILL,MSG,PATAUD,RGHLMQ,RGMT,SCHDA,SEND,SS,TIME,TXT,TXTCNT,X,Y
"RTN","RGMTMONT",155,0)
 Q
"RTN","RGMTMONT",156,0)
 ;
"RTN","RGMTMONT",157,0)
TXT ;
"RTN","RGMTMONT",158,0)
 S TXTCNT=TXTCNT+1
"RTN","RGMTMONT",159,0)
 I '$D(RGHLMQ) W !,TXT
"RTN","RGMTMONT",160,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQMONT",LOCSITE,TXTCNT)=TXT
"RTN","RGMTMONT",161,0)
 Q
"RTN","RGMTMONX")
0^3^B57629977
"RTN","RGMTMONX",1,0)
RGMTMONX ;BIR/CML,PTD-MPI/PD Monitor HL7 Messaging/Filers and Setups (CONT) ;07/30/02
"RTN","RGMTMONX",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGMTMONX",3,0)
 ;
"RTN","RGMTMONX",4,0)
 ;Reference to ^DIC(4,"D", supported by IA #3627
"RTN","RGMTMONX",5,0)
 ;Reference to ^HLCS(870 supported by IA #3335
"RTN","RGMTMONX",6,0)
 ;Reference to ^DGCN(391.91, supported by IA #2911
"RTN","RGMTMONX",7,0)
 ;
"RTN","RGMTMONX",8,0)
START ;
"RTN","RGMTMONX",9,0)
 K ^XTMP("RGMT","MONT")
"RTN","RGMTMONX",10,0)
 I '$D(TXTCNT) S TXTCNT=0
"RTN","RGMTMONX",11,0)
 I '$D(LOCSITE) S LOCSITE=$P($$SITE^VASITE(),"^")
"RTN","RGMTMONX",12,0)
 ;
"RTN","RGMTMONX",13,0)
 ;MULTID=# of multiple "D" xrefs in ^DIC(4 for Station #
"RTN","RGMTMONX",14,0)
 ;NOINST=# of VAxxx Links with no INSTITUTION defined
"RTN","RGMTMONX",15,0)
 ;BADINST=# of VAxxx Links that have an incorrect INSTITUTION defined
"RTN","RGMTMONX",16,0)
 ;BADTF=# of patients with invalid Treating Facilities
"RTN","RGMTMONX",17,0)
 ;NONVA=# of non-VAxxx Logical Links with INSTITUTION defined
"RTN","RGMTMONX",18,0)
 ;CNT=# of VAxxx Logical Links processed
"RTN","RGMTMONX",19,0)
 ;
"RTN","RGMTMONX",20,0)
 S (NOINST,BADINST,BADTF,MULTID,NONVA,CNT,DODHOST)=0
"RTN","RGMTMONX",21,0)
 ;
"RTN","RGMTMONX",22,0)
1 ;
"RTN","RGMTMONX",23,0)
 K LINKARR
"RTN","RGMTMONX",24,0)
 S LINK=""
"RTN","RGMTMONX",25,0)
 F  S LINK=$O(^HLCS(870,"B",LINK)) Q:LINK=""  D
"RTN","RGMTMONX",26,0)
 .I LINK'="MPIVA"&($E(LINK,1,2)'="VA") Q
"RTN","RGMTMONX",27,0)
 .I $E(LINK,1,2)="VA"&($L(LINK," ")>1) Q
"RTN","RGMTMONX",28,0)
 .Q:LINK["-"
"RTN","RGMTMONX",29,0)
 .I $T(@LINK)']"" Q
"RTN","RGMTMONX",30,0)
 .S CNT=CNT+1
"RTN","RGMTMONX",31,0)
 .S VALSTA=$P($P($T(@LINK),";;",2),"^",2)
"RTN","RGMTMONX",32,0)
 .;build array of links with valid station numbers to do check 5
"RTN","RGMTMONX",33,0)
 .S LINKARR(VALSTA)=LINK
"RTN","RGMTMONX",34,0)
2 .;check for multiple "D" xrefs in ^DIC(4 for this station #)
"RTN","RGMTMONX",35,0)
 .S (XCNT,QQ)=0
"RTN","RGMTMONX",36,0)
 .F  S QQ=$O(^DIC(4,"D",VALSTA,QQ)) Q:'QQ  D
"RTN","RGMTMONX",37,0)
 ..S XCNT=XCNT+1
"RTN","RGMTMONX",38,0)
 ..I QQ["." D
"RTN","RGMTMONX",39,0)
 ...S ^XTMP("RGMT","MONT","DECIMEL INST IEN",VALSTA,QQ)=""
"RTN","RGMTMONX",40,0)
 .I XCNT>1 D
"RTN","RGMTMONX",41,0)
 ..S LINKIEN=$O(^HLCS(870,"B",LINK,0))
"RTN","RGMTMONX",42,0)
 ..S MULTID=MULTID+1
"RTN","RGMTMONX",43,0)
 ..S (XCNT,QQ)=0
"RTN","RGMTMONX",44,0)
 ..F  S QQ=$O(^DIC(4,"D",VALSTA,QQ)) Q:'QQ  D
"RTN","RGMTMONX",45,0)
 ...S ^XTMP("RGMT","MONT","MULTI DXREF",VALSTA,QQ)=$$GET1^DIQ(4,QQ_",",.01)_"^"_$$GET1^DIQ(870,LINKIEN_",",.01)_"^"_$$GET1^DIQ(870,LINKIEN_",",.02,"I")
"RTN","RGMTMONX",46,0)
3 .;check for defined INSTITUTION and set (if necessary) AUTOSTART and RESTART for links in file 870
"RTN","RGMTMONX",47,0)
 .S LINKIEN=$O(^HLCS(870,"B",LINK,0))
"RTN","RGMTMONX",48,0)
 .S LINKINST=$$GET1^DIQ(870,LINKIEN_",",.02,"I")
"RTN","RGMTMONX",49,0)
 .I 'LINKINST D  Q
"RTN","RGMTMONX",50,0)
 ..S NOINST=NOINST+1
"RTN","RGMTMONX",51,0)
 ..S ^XTMP("RGMT","MONT","NO INST",LINK)=LINKIEN_"^"_$P($P($T(@LINK),";;",2),"^",1,2)
"RTN","RGMTMONX",52,0)
4 .;check for incorrect INSTITUTION
"RTN","RGMTMONX",53,0)
 .S LOCSTA=$P($$NS^XUAF4(LINKINST),"^",2)
"RTN","RGMTMONX",54,0)
 .I LOCSTA'=VALSTA D
"RTN","RGMTMONX",55,0)
 ..S BADINST=BADINST+1
"RTN","RGMTMONX",56,0)
 ..S ^XTMP("RGMT","MONT","BAD INST",LINK)=LOCSTA
"RTN","RGMTMONX",57,0)
 ;
"RTN","RGMTMONX",58,0)
5 ;
"RTN","RGMTMONX",59,0)
 S TFIEN=0
"RTN","RGMTMONX",60,0)
 F  S TFIEN=$O(^DGCN(391.91,"C",TFIEN)) Q:'TFIEN  D
"RTN","RGMTMONX",61,0)
 .S TF=$P($$NS^XUAF4(TFIEN),"^",2)
"RTN","RGMTMONX",62,0)
 .I TF="" D  Q
"RTN","RGMTMONX",63,0)
 ..S TFIFN=0 F  S TFIFN=$O(^DGCN(391.91,"C",TFIEN,TFIFN)) Q:'TFIFN  D
"RTN","RGMTMONX",64,0)
 ...S BADTF=BADTF+1
"RTN","RGMTMONX",65,0)
 ...S DFN=$$GET1^DIQ(391.91,TFIFN_",",.01,"I")
"RTN","RGMTMONX",66,0)
 .I '$D(LINKARR(TF)) D
"RTN","RGMTMONX",67,0)
 ..S IEN=0 F  S IEN=$O(^DGCN(391.91,"C",TFIEN,IEN)) Q:'IEN  D
"RTN","RGMTMONX",68,0)
 ...I TF=200 S DODHOST=DODHOST+1 Q
"RTN","RGMTMONX",69,0)
 ...S DFN=$$GET1^DIQ(391.91,IEN_",",.01,"I")
"RTN","RGMTMONX",70,0)
 ...S BADTF=BADTF+1
"RTN","RGMTMONX",71,0)
 ...S ^XTMP("RGMT","MONT","BAD TF",DFN)=$$GET1^DIQ(4,TFIEN_",",.01)_"^"_IEN
"RTN","RGMTMONX",72,0)
 ;
"RTN","RGMTMONX",73,0)
6 ;
"RTN","RGMTMONX",74,0)
 S LINK=""
"RTN","RGMTMONX",75,0)
 F  S LINK=$O(^HLCS(870,"B",LINK)) Q:LINK=""  I $E(LINK,1,2)'="VA"!($E(LINK,1,4)="VAFC") D
"RTN","RGMTMONX",76,0)
 .Q:LINK="MPIVA"
"RTN","RGMTMONX",77,0)
 .S LINKIEN=$O(^HLCS(870,"B",LINK,0))
"RTN","RGMTMONX",78,0)
 .S LINKINST=$$GET1^DIQ(870,LINKIEN_",",.02,"I")
"RTN","RGMTMONX",79,0)
 .Q:'LINKINST
"RTN","RGMTMONX",80,0)
 .Q:LINKINST'=+$$SITE^VASITE()
"RTN","RGMTMONX",81,0)
 .S NONVA=NONVA+1
"RTN","RGMTMONX",82,0)
 .S ^XTMP("RGMT","MONT","NONVA LINK WITH INSTITUTION",LINK)=""
"RTN","RGMTMONX",83,0)
 ;
"RTN","RGMTMONX",84,0)
DONE ;
"RTN","RGMTMONX",85,0)
 S TXT="" D TXT
"RTN","RGMTMONX",86,0)
 ;
"RTN","RGMTMONX",87,0)
 S TXT="==============================" D TXT
"RTN","RGMTMONX",88,0)
 S TXT="Check 1: "_MULTID_" VA MPI/PD Links with multiple ""D"" xref in ^DIC(4 for Station #." D TXT
"RTN","RGMTMONX",89,0)
 S TXT="Check 2: "_NOINST_" VA MPI/PD Links without an INSTITUTION defined." D TXT
"RTN","RGMTMONX",90,0)
 S TXT="Check 3: "_BADINST_" VA MPI/PD Links with incorrect INSTITUTION defined."  D TXT
"RTN","RGMTMONX",91,0)
 S TXT="Check 4: "_BADTF_" patients with invalid Treating Facilities. => FHIE Pts: "_DODHOST D TXT
"RTN","RGMTMONX",92,0)
 S TXT="Check 5: "_NONVA_" non-VA MPI/PD Links with an INSTITUTION of local site defined." D TXT
"RTN","RGMTMONX",93,0)
 ;
"RTN","RGMTMONX",94,0)
 K BADINST,BADTF,CNT,DFN,IEN,LINK,LINKARR,LINKIEN,LINKINST,LOCSITE,LOCSTA,MULTID,NOINST,NONVA,QQ,TF,TFIEN,TFIFN,TXT,TXTCNT,VALSTA,XCNT,DODHOST
"RTN","RGMTMONX",95,0)
 Q
"RTN","RGMTMONX",96,0)
 ;
"RTN","RGMTMONX",97,0)
TXT ;
"RTN","RGMTMONX",98,0)
 S TXTCNT=TXTCNT+1
"RTN","RGMTMONX",99,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQMONT",LOCSITE,TXTCNT)=TXT
"RTN","RGMTMONX",100,0)
 Q
"RTN","RGMTMONX",101,0)
 ;
"RTN","RGMTMONX",102,0)
LINKS ;
"RTN","RGMTMONX",103,0)
MPIVA ;;MPI^200M
"RTN","RGMTMONX",104,0)
VAALX ;;ALEXANDRIA^502
"RTN","RGMTMONX",105,0)
VAALT ;;ALTOONA^503
"RTN","RGMTMONX",106,0)
VAAMA ;;AMARILLO HCS^504
"RTN","RGMTMONX",107,0)
VAANC ;;ANCHORAGE^463
"RTN","RGMTMONX",108,0)
VAANN ;;ANN ARBOR^506
"RTN","RGMTMONX",109,0)
VAASH ;;ASHEVILLE^637
"RTN","RGMTMONX",110,0)
VAATG ;;ATLANTA^508
"RTN","RGMTMONX",111,0)
VAAUG ;;AUGUSTA^509
"RTN","RGMTMONX",112,0)
VABAC ;;BATTLE CREEK^515
"RTN","RGMTMONX",113,0)
VABAY ;;BAY PINES^516
"RTN","RGMTMONX",114,0)
VABEC ;;BECKLEY^517
"RTN","RGMTMONX",115,0)
VABED ;;BEDFORD^518
"RTN","RGMTMONX",116,0)
VABIL ;;BILOXI^520
"RTN","RGMTMONX",117,0)
VABIR ;;BIRMINGHAM^521
"RTN","RGMTMONX",118,0)
VABHH ;;BLACK HILLS HCS^568
"RTN","RGMTMONX",119,0)
VABOI ;;BOISE^531
"RTN","RGMTMONX",120,0)
VABOS ;;BOSTON HCS^523
"RTN","RGMTMONX",121,0)
VABRX ;;BRONX^526
"RTN","RGMTMONX",122,0)
VABUT ;;BUTLER^529
"RTN","RGMTMONX",123,0)
VACAH ;;CENTRAL ALABAMA HCS^619
"RTN","RGMTMONX",124,0)
VALIT ;;CENTRAL ARKANSAS HCS^598
"RTN","RGMTMONX",125,0)
VAFRE ;;CENTRAL CALIFORNIA HCS^570
"RTN","RGMTMONX",126,0)
VAOMA ;;CENTRAL PLAINS HCS^636
"RTN","RGMTMONX",127,0)
VACTX ;;CENTRAL TEXAS HCS^674
"RTN","RGMTMONX",128,0)
VACHA ;;CHARLESTON^534
"RTN","RGMTMONX",129,0)
VACHY ;;CHEYENNE^442
"RTN","RGMTMONX",130,0)
VACHS ;;CHICAGO HCS^537
"RTN","RGMTMONX",131,0)
VACLL ;;CHILLICOTHE^538
"RTN","RGMTMONX",132,0)
VACIN ;;CINCINNATI^539
"RTN","RGMTMONX",133,0)
VACLA ;;CLARKSBURG^540
"RTN","RGMTMONX",134,0)
VACLE ;;CLEVELAND^541
"RTN","RGMTMONX",135,0)
VACOA ;;COATESVILLE^542
"RTN","RGMTMONX",136,0)
VACMS ;;COLUMBIA^544
"RTN","RGMTMONX",137,0)
VACOS ;;COLUMBUS^757
"RTN","RGMTMONX",138,0)
VACON ;;CONNECTICUT HCS^689
"RTN","RGMTMONX",139,0)
VADAY ;;DAYTON^552
"RTN","RGMTMONX",140,0)
VADEN ;;DENVER^554
"RTN","RGMTMONX",141,0)
VADET ;;DETROIT^553
"RTN","RGMTMONX",142,0)
VADUB ;;DUBLIN^557
"RTN","RGMTMONX",143,0)
VADUR ;;DURHAM^558
"RTN","RGMTMONX",144,0)
VAELP ;;EL PASO^756
"RTN","RGMTMONX",145,0)
VAERI ;;ERIE^562
"RTN","RGMTMONX",146,0)
VAFAR ;;FARGO^437
"RTN","RGMTMONX",147,0)
VAFNC ;;FAYETTEVILLE^565
"RTN","RGMTMONX",148,0)
VAFAV ;;FAYETTEVILLE^564
"RTN","RGMTMONX",149,0)
VAJAC ;;G. V. (SONNY) MONTGOMERY^586
"RTN","RGMTMONX",150,0)
VAGRJ ;;GRAND JUNCTION^575
"RTN","RGMTMONX",151,0)
VAHAM ;;HAMPTON^590
"RTN","RGMTMONX",152,0)
VAHIN ;;HINES^578
"RTN","RGMTMONX",153,0)
VAHON ;;HONOLULU VAMROC^459
"RTN","RGMTMONX",154,0)
VAHOU ;;HOUSTON^580
"RTN","RGMTMONX",155,0)
VAHVH ;;HUDSON VALLEY HCS^620
"RTN","RGMTMONX",156,0)
VAHUN ;;HUNTINGTON^581
"RTN","RGMTMONX",157,0)
VADAN ;;ILLIANA HEALTH CARE SYSTEM^550
"RTN","RGMTMONX",158,0)
VAIND ;;INDIANAPOLIS^583
"RTN","RGMTMONX",159,0)
VAIRO ;;IRON MOUNTAIN^585
"RTN","RGMTMONX",160,0)
VALAS ;;LAS VEGAS^593
"RTN","RGMTMONX",161,0)
VALEB ;;LEBANON^595
"RTN","RGMTMONX",162,0)
VALEX ;;LEXINGTON^596
"RTN","RGMTMONX",163,0)
VALOM ;;LOMA LINDA^605
"RTN","RGMTMONX",164,0)
VALON ;;LONG BEACH HCS^600
"RTN","RGMTMONX",165,0)
VALOU ;;LOUISVILLE^603
"RTN","RGMTMONX",166,0)
VAMAD ;;MADISON^607
"RTN","RGMTMONX",167,0)
VAMAN ;;MANCHESTER^608
"RTN","RGMTMONX",168,0)
VAMPI ;;MANILA^358
"RTN","RGMTMONX",169,0)
VAMWV ;;MARTINSBURG^613
"RTN","RGMTMONX",170,0)
VAMAR ;;MARYLAND HCS^512
"RTN","RGMTMONX",171,0)
VAMEM ;;MEMPHIS^614
"RTN","RGMTMONX",172,0)
VAMIA ;;MIAMI^546
"RTN","RGMTMONX",173,0)
VAMIW ;;MILWAUKEE^695
"RTN","RGMTMONX",174,0)
VAMIN ;;MINNEAPOLIS^618
"RTN","RGMTMONX",175,0)
VAFHM ;;MONTANA HCS^436
"RTN","RGMTMONX",176,0)
VAMOU ;;MOUNTAIN HOME^621
"RTN","RGMTMONX",177,0)
VAMUS ;;MUSKOGEE^623
"RTN","RGMTMONX",178,0)
VAGAI ;;N. FLORIDA/S. GEORGIA HCS^573
"RTN","RGMTMONX",179,0)
VANJH ;;NEW JERSEY HCS^561
"RTN","RGMTMONX",180,0)
VAALB ;;NEW MEXICO HCS^501
"RTN","RGMTMONX",181,0)
VANOL ;;NEW ORLEANS^629
"RTN","RGMTMONX",182,0)
VANYN ;;NEW YORK HARBOR HCS^630
"RTN","RGMTMONX",183,0)
VANCH ;;NORTH CHICAGO^556
"RTN","RGMTMONX",184,0)
VANTH ;;NORTH TEXAS HCS^549
"RTN","RGMTMONX",185,0)
VANHM ;;NORTHAMPTON^631
"RTN","RGMTMONX",186,0)
VAPRE ;;NORTHERN ARIZONA HCS^649
"RTN","RGMTMONX",187,0)
VAMAC ;;NORTHERN CALIFORNIA HCS^612
"RTN","RGMTMONX",188,0)
VANIN ;;NORTHERN INDIANA HCS^610
"RTN","RGMTMONX",189,0)
VANOP ;;NORTHPORT^632
"RTN","RGMTMONX",190,0)
VAOKL ;;OKLAHOMA CITY^635
"RTN","RGMTMONX",191,0)
VAPAL ;;PALO ALTO HCS^640
"RTN","RGMTMONX",192,0)
VAPHI ;;PHILADELPHIA^642
"RTN","RGMTMONX",193,0)
VAPHO ;;PHOENIX^644
"RTN","RGMTMONX",194,0)
VAPTH ;;PITTSBURGH HCS^646
"RTN","RGMTMONX",195,0)
VAPOR ;;PORTLAND^648
"RTN","RGMTMONX",196,0)
VAPRO ;;PROVIDENCE^650
"RTN","RGMTMONX",197,0)
VAPUG ;;PUGET SOUND HCS^663
"RTN","RGMTMONX",198,0)
VARIC ;;RICHMOND^652
"RTN","RGMTMONX",199,0)
VAROS ;;ROSEBURG^653
"RTN","RGMTMONX",200,0)
VASAG ;;SAGINAW^655
"RTN","RGMTMONX",201,0)
VASAM ;;SALEM^658
"RTN","RGMTMONX",202,0)
VASBY ;;SALISBURY^659
"RTN","RGMTMONX",203,0)
VASLC ;;SALT LAKE CITY HCS^660
"RTN","RGMTMONX",204,0)
VASDC ;;SAN DIEGO HCS^664
"RTN","RGMTMONX",205,0)
VASFC ;;SAN FRANCISCO^662
"RTN","RGMTMONX",206,0)
VASAJ ;;SAN JUAN^672
"RTN","RGMTMONX",207,0)
VASHE ;;SHERIDAN^666
"RTN","RGMTMONX",208,0)
VASHR ;;SHREVEPORT^667
"RTN","RGMTMONX",209,0)
VAREN ;;SIERRA NEVADA HCS^654
"RTN","RGMTMONX",210,0)
VASUX ;;SIOUX FALLS^438
"RTN","RGMTMONX",211,0)
VASTX ;;SOUTH TEXAS HCS^671
"RTN","RGMTMONX",212,0)
VATUC ;;SOUTHERN ARIZONA HCS^678
"RTN","RGMTMONX",213,0)
VAFTL ;;SOUTHERN COLORADO HCS^567
"RTN","RGMTMONX",214,0)
VASPO ;;SPOKANE^668
"RTN","RGMTMONX",215,0)
VASTC ;;ST. CLOUD^656
"RTN","RGMTMONX",216,0)
VATAM ;;TAMPA^673
"RTN","RGMTMONX",217,0)
VANAS ;;TENNESSEE VALLEY HCS^626
"RTN","RGMTMONX",218,0)
VATOG ;;TOGUS^402
"RTN","RGMTMONX",219,0)
VATOM ;;TOMAH^676
"RTN","RGMTMONX",220,0)
VATUA ;;TUSCALOOSA^679
"RTN","RGMTMONX",221,0)
VAWNY ;;UPSTATE NEW YORK HCS^528
"RTN","RGMTMONX",222,0)
VASTL ;;VA HEARTLAND - EAST, VISN 15^657
"RTN","RGMTMONX",223,0)
VAKAN ;;VA HEARTLAND - WEST, VISN 15^589
"RTN","RGMTMONX",224,0)
VAWWW ;;WALLA WALLA^687
"RTN","RGMTMONX",225,0)
VAWAS ;;WASHINGTON^688
"RTN","RGMTMONX",226,0)
VAWLA ;;WEST LA VAMC^691
"RTN","RGMTMONX",227,0)
VAWPB ;;WEST PALM BEACH^548
"RTN","RGMTMONX",228,0)
VABIG ;;WEST TEXAS HCS^519
"RTN","RGMTMONX",229,0)
VAWCO ;;WHITE CITY^692
"RTN","RGMTMONX",230,0)
VAWRJ ;;WHITE RIVER JCT^405
"RTN","RGMTMONX",231,0)
VAWIC ;;WICHITA^452
"RTN","RGMTMONX",232,0)
VAWBP ;;WILKES BARRE^693
"RTN","RGMTMONX",233,0)
VAWIM ;;WILMINGTON^460
"RTN","RGMTMONX",234,0)
VAFHIE ;;AUSTIN^200
"RTN","RGMTMONX",235,0)
 ;;***
"RTN","RGMTRUN")
0^4^B3780451
"RTN","RGMTRUN",1,0)
RGMTRUN ;BIR/CML,PTD-SCAN TASKMAN RUNNING HL7 TASKS ;07/12/00
"RTN","RGMTRUN",2,0)
 ;;1.0;CLINCAL INFO RESOURCE NETWORK;**25,20**;30 Apr 99
"RTN","RGMTRUN",3,0)
 ;
"RTN","RGMTRUN",4,0)
 ;Reference to ^%ZTSCH("TASK" supported by IA #3520
"RTN","RGMTRUN",5,0)
 ;Reference to EN^XUTMTP supported by IA #3521
"RTN","RGMTRUN",6,0)
 ;Setting ZT* and XU* variables supported by IA #3521
"RTN","RGMTRUN",7,0)
 ;
"RTN","RGMTRUN",8,0)
MAIN ;Entry point for device call
"RTN","RGMTRUN",9,0)
 W !!,"This option prints the currently running HL7 tasks."
"RTN","RGMTRUN",10,0)
 W !,"The right margin for this report is 80.",!
"RTN","RGMTRUN",11,0)
 S NOTRPC=1
"RTN","RGMTRUN",12,0)
 K ZTSAVE S ZTSAVE("NOTRPC")=""
"RTN","RGMTRUN",13,0)
 D EN^XUTMDEVQ("START^RGMTRUN","Print Running HL7 Task Data") I 'POP K NOTRPC Q
"RTN","RGMTRUN",14,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTRUN",15,0)
 K NOTRPC
"RTN","RGMTRUN",16,0)
 Q
"RTN","RGMTRUN",17,0)
 ;
"RTN","RGMTRUN",18,0)
START ;Entry point for RPC call
"RTN","RGMTRUN",19,0)
 S $P(LN,"-",80)="",CNT=0,QFLG=0
"RTN","RGMTRUN",20,0)
 I $D(NOTRPC) W @IOF,!
"RTN","RGMTRUN",21,0)
 I '$D(NOTRPC) W "Running HL7 Tasks at "_$P($$SITE^VASITE(),"^",2)_":"
"RTN","RGMTRUN",22,0)
 I '$D(NOTRPC) D NOW^%DTC W !,"Date compiled: ",$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTRUN",23,0)
 ;
"RTN","RGMTRUN",24,0)
 S TASK=0 F  S TASK=$O(^%ZTSCH("TASK",TASK)) Q:'TASK  Q:QFLG  D
"RTN","RGMTRUN",25,0)
 .S ROU=$P(^%ZTSCH("TASK",TASK),"^",2)
"RTN","RGMTRUN",26,0)
 .I (ROU["HL")!(ROU["RG") D
"RTN","RGMTRUN",27,0)
 ..S CNT=CNT+1
"RTN","RGMTRUN",28,0)
 ..N ZTENV,ZTKEY,ZTFLAG,ZTNAME,XUTMUCI
"RTN","RGMTRUN",29,0)
 ..S ZTENV=1,ZTKEY=0,ZTFLAG=1,ZTNAME=$$GET1^DIQ(200,+DUZ_",",.01)
"RTN","RGMTRUN",30,0)
 ..X ^%ZOSF("UCI") S XUTMUCI=Y
"RTN","RGMTRUN",31,0)
 ..D EN^XUTMTP(TASK) W !,LN
"RTN","RGMTRUN",32,0)
 ..I $D(NOTRPC),CNT=5 W ! S DIR(0)="E" D ^DIR K DIR S CNT=0 S:'Y QFLG=1 I Y W @IOF
"RTN","RGMTRUN",33,0)
 ;
"RTN","RGMTRUN",34,0)
QUIT ;Kill variables and quit.
"RTN","RGMTRUN",35,0)
 I $D(NOTRPC) W:$E(IOST)'="C" @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGMTRUN",36,0)
 K %,CNT,LN,NOTRPC,QFLG,ROU,TASK,Y,ZTSK
"RTN","RGMTRUN",37,0)
 Q
"RTN","RGMTRUN",38,0)
 ;
"RTN","RGMTRUN",39,0)
 ;
"RTN","RGMTRUN",40,0)
TASK(RETURN) ;Remote HL7 task display
"RTN","RGMTRUN",41,0)
 N ARRAY
"RTN","RGMTRUN",42,0)
 S ARRAY="^TMP(""RGMTHFS"","_$J_")"
"RTN","RGMTRUN",43,0)
 D HFS^RGMTHFS("START^RGMTRUN")
"RTN","RGMTRUN",44,0)
 M RETURN=^TMP("RGMTHFS",$J)
"RTN","RGMTRUN",45,0)
 K ^TMP("RGMTHFS",$J)
"RTN","RGMTRUN",46,0)
 Q
"RTN","RGMTRUN",47,0)
 ;
"RTN","RGMTSTAT")
0^5^B39108053
"RTN","RGMTSTAT",1,0)
RGMTSTAT ;BIR/DLR,CML,PTD-MPI/PD Maintenance Query ;07/30/02
"RTN","RGMTSTAT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGMTSTAT",3,0)
 ;
"RTN","RGMTSTAT",4,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTSTAT",5,0)
 ;
"RTN","RGMTSTAT",6,0)
 Q
"RTN","RGMTSTAT",7,0)
PROCESS ;Processor of QRY msg from protocol, RGMT DEFERRED QRY CLIENT.
"RTN","RGMTSTAT",8,0)
 S RGMT=0 N REP,SG,HLP,HLRESLTA K ^TMP("HLA",$J)
"RTN","RGMTSTAT",9,0)
 F RGMT=1:1 X HLNEXT Q:HLQUIT'>0  S SG=$E(HLNODE,1,3) D:$T(@SG)]"" @SG
"RTN","RGMTSTAT",10,0)
 ;;Queue the deferred status acknowledgment off
"RTN","RGMTSTAT",11,0)
 S RGMTER=$$RESP() I RGMTER'>0 S HLP("ERRTEXT")="Unable to queue query"
"RTN","RGMTSTAT",12,0)
 S ^TMP("HLA",$J,1)="MSA"_HL("FS")_$S(RGMTER>0:"AA",1:"AE")_HL("FS")_HL("MID")
"RTN","RGMTSTAT",13,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.HLRESLTA,"",.HLP)
"RTN","RGMTSTAT",14,0)
 K RGMTER,RGMTID,RGCOMP,SITE,RGMTFS,RGMTRCV,RGMTQRD,^TMP("HLA",$J)
"RTN","RGMTSTAT",15,0)
 Q
"RTN","RGMTSTAT",16,0)
MSH ;process MSH segment
"RTN","RGMTSTAT",17,0)
 S RGMTFS=HL("FS")
"RTN","RGMTSTAT",18,0)
 S RGMTID=HL("MID")
"RTN","RGMTSTAT",19,0)
 S RGCOMP=$E(HL("ECH"),1)
"RTN","RGMTSTAT",20,0)
 S REP=$E(HL("ECH"),2)
"RTN","RGMTSTAT",21,0)
 S SITE=$$LKUP^XUAF4($P($P(HLNODE,HL("FS"),4),RGCOMP))
"RTN","RGMTSTAT",22,0)
 S ZTSAVE("RGMTID")=""
"RTN","RGMTSTAT",23,0)
 S ZTSAVE("RGCOMP")=""
"RTN","RGMTSTAT",24,0)
 S ZTSAVE("SITE")=""
"RTN","RGMTSTAT",25,0)
 S ZTSAVE("RGMTFS")=""
"RTN","RGMTSTAT",26,0)
 S ZTSAVE("REP")=""
"RTN","RGMTSTAT",27,0)
 Q
"RTN","RGMTSTAT",28,0)
QRD ;process QRD segment
"RTN","RGMTSTAT",29,0)
 S RGMTQRD=HLNODE
"RTN","RGMTSTAT",30,0)
 S RGMTRCV=$P(RGMTQRD,HL("FS"),5)
"RTN","RGMTSTAT",31,0)
 S ZTSAVE("RGMTRCV")=""
"RTN","RGMTSTAT",32,0)
 S ZTSAVE("RGMTQRD")=""
"RTN","RGMTSTAT",33,0)
 Q
"RTN","RGMTSTAT",34,0)
STATUS ;processor of QRY acknowledgments, QCK and DSR, from protocol, RGMT DEFERRED QRY SERVER.
"RTN","RGMTSTAT",35,0)
 ;if ack msg type is returned the protocols are not installed
"RTN","RGMTSTAT",36,0)
 I HL("MTN")="QCK" D
"RTN","RGMTSTAT",37,0)
 .S RGMT=0
"RTN","RGMTSTAT",38,0)
 .F RGMT=1:1 X HLNEXT Q:HLQUIT'>0  S SG=$E(HLNODE,1,3) D:$T(@SG)]"" @SG
"RTN","RGMTSTAT",39,0)
 .S $P(^XTMP("RGMT","RGHLMQ",SITE,0),"^",2)="AA"
"RTN","RGMTSTAT",40,0)
 ;the "DSR" ack type should use protocol, RGMT DEFERRED QRY RESPONSE SERVER, if not call its entry point ACK
"RTN","RGMTSTAT",41,0)
 I HL("MTN")="DSR" D ACK
"RTN","RGMTSTAT",42,0)
 Q
"RTN","RGMTSTAT",43,0)
BLD(RGMT) ;Build Query message
"RTN","RGMTSTAT",44,0)
 S DIC="^ORD(101,",X=RGMT D ^DIC K DIC S EID=+Y I EID<0 S EID=""
"RTN","RGMTSTAT",45,0)
 S HL="HL",INT=0
"RTN","RGMTSTAT",46,0)
 W !,EID Q:EID="" -1
"RTN","RGMTSTAT",47,0)
 D INIT^HLFNC2(EID,.HL,INT)
"RTN","RGMTSTAT",48,0)
 S COMP=$E(HL("ECH"),1),SUBCOMP=$E(HL("ECH"),4),REP=$E(HL("ECH"),2)
"RTN","RGMTSTAT",49,0)
 Q +$G(EID)
"RTN","RGMTSTAT",50,0)
ROUTE ;Generate recipient list/route QRY msg using protocol, RGMT DEFERRED QRY CLIENT.
"RTN","RGMTSTAT",51,0)
 N CLIENT
"RTN","RGMTSTAT",52,0)
 K RGMT
"RTN","RGMTSTAT",53,0)
 S CLIENT="RGMT DEFERRED QRY CLIENT"
"RTN","RGMTSTAT",54,0)
 D LINK^HLUTIL3(SITE,.RGMT)
"RTN","RGMTSTAT",55,0)
 I $O(RGMT(0)) S HLL("LINKS",1)=CLIENT_"^"_$P(RGMT($O(RGMT(0))),U)
"RTN","RGMTSTAT",56,0)
 K RGMT
"RTN","RGMTSTAT",57,0)
 Q
"RTN","RGMTSTAT",58,0)
GEN ;generate hl7 message
"RTN","RGMTSTAT",59,0)
 N HLRESLT,HLP
"RTN","RGMTSTAT",60,0)
 D GENERATE^HLMA(EID,"GM",1,.HLRESLT,"",.HLP)
"RTN","RGMTSTAT",61,0)
 Q
"RTN","RGMTSTAT",62,0)
RESP() ;response to remote query
"RTN","RGMTSTAT",63,0)
 N ZTSK,ZTRTN,ZTDESC,ZTREQ,ZTIO,ZTDTH
"RTN","RGMTSTAT",64,0)
 S ZTREQ="@",ZTDTH=$$NOW^XLFDT,ZTIO="",ZTRTN="DSR^RGMTSTAT",ZTDESC="RGMT QUERY RESP" D ^%ZTLOAD D ^%ZISC
"RTN","RGMTSTAT",65,0)
 Q $G(ZTSK)
"RTN","RGMTSTAT",66,0)
DSRTYPE S RGMTCNT=3
"RTN","RGMTSTAT",67,0)
 F RGMTPC=1:1:$L(RGMTQRD,REP) S RGMTTYP=$P($P(RGMTQRD,RGMTFS,10),REP,RGMTPC) D
"RTN","RGMTSTAT",68,0)
 .S RGDSPCNT=1,RGMT1=0
"RTN","RGMTSTAT",69,0)
 .S RGMT1="" F  S RGMT1=$O(^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1)) Q:RGMT1=""  D
"RTN","RGMTSTAT",70,0)
 ..I $G(^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1))'="" S ^TMP("HLS",$J,RGMTCNT)="DSP"_RGMTFS_RGDSPCNT_RGMTFS_RGMTPC_HL("FS")_^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1)_COMP_RGMT1 D
"RTN","RGMTSTAT",71,0)
 ...S RGMTCNT=$G(RGMTCNT)+1,RGDSPCNT=RGDSPCNT+1 Q
"RTN","RGMTSTAT",72,0)
 ..S RGMT2="" F  S RGMT2=$O(^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2)) Q:RGMT2=""  D
"RTN","RGMTSTAT",73,0)
 ...I $G(^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2))'="" S ^TMP("HLS",$J,RGMTCNT)="DSP"_HL("FS")_RGDSPCNT_HL("FS")_RGMTPC_HL("FS")_^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2)_COMP_RGMT1_COMP_RGMT2 D
"RTN","RGMTSTAT",74,0)
 ....S RGMTCNT=$G(RGMTCNT)+1,RGDSPCNT=RGDSPCNT+1 Q
"RTN","RGMTSTAT",75,0)
 ...S RGMT3="" F  S RGMT3=$O(^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2,RGMT3)) Q:RGMT3=""  D
"RTN","RGMTSTAT",76,0)
 ....I $G(^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2,RGMT3))'="" D
"RTN","RGMTSTAT",77,0)
 .....S ^TMP("HLS",$J,RGMTCNT)="DSP"_HL("FS")_RGDSPCNT_HL("FS")_RGMTPC_HL("FS")_^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2,RGMT3)_COMP_RGMT1_COMP_RGMT2_COMP_RGMT3
"RTN","RGMTSTAT",78,0)
 .....S RGMTCNT=$G(RGMTCNT)+1,RGDSPCNT=RGDSPCNT+1
"RTN","RGMTSTAT",79,0)
 ....S RGMT4="" F  S RGMT4=$O(^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2,RGMT3,RGMT4)) Q:RGMT4=""  D
"RTN","RGMTSTAT",80,0)
 .....I $G(^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2,RGMT3,RGMT4))'="" D
"RTN","RGMTSTAT",81,0)
 ......S ^TMP("HLS",$J,RGMTCNT)="DSP"_HL("FS")_RGDSPCNT_HL("FS")_RGMTPC_HL("FS")_^XTMP("RGMT","HLMQ"_RGMTTYP,RGMTFAC,RGMT1,RGMT2,RGMT3,RGMT4)_COMP_RGMT1_COMP_RGMT2_COMP_RGMT3_COMP_RGMT4
"RTN","RGMTSTAT",82,0)
 ......S RGMTCNT=$G(RGMTCNT)+1,RGDSPCNT=RGDSPCNT+1
"RTN","RGMTSTAT",83,0)
 K ^XTMP("RGMT","HLMQMONT"),^XTMP("RGMT","HLMQHLMA"),^XTMP("RGMT","HLMQETOT")
"RTN","RGMTSTAT",84,0)
 Q
"RTN","RGMTSTAT",85,0)
DSR ;response to remote query
"RTN","RGMTSTAT",86,0)
 N EID,INT,COMP,RGMT,RGMT1,RGMT2,RGMT3,RGMT4,RGMTPC,RGMTTYP,RGMTFAC,RGMTCNT,RGDSPCNT,RGHLMQ
"RTN","RGMTSTAT",87,0)
 K ^TMP("HLS",$J),^XTMP("RGMT","HLMQMONT"),^XTMP("RGMT","HLMQHLMA"),^XTMP("RGMT","HLMQETOT")
"RTN","RGMTSTAT",88,0)
 S COMP=RGCOMP
"RTN","RGMTSTAT",89,0)
 S RGMTFAC=$P($$SITE^VASITE,"^",3)
"RTN","RGMTSTAT",90,0)
 F RGMTPC=1:1:$L($P(RGMTQRD,RGMTFS,10),REP) S RGMTTYP=$P($P(RGMTQRD,RGMTFS,10),REP,RGMTPC) D
"RTN","RGMTSTAT",91,0)
 .S RGHLMQ=1 I RGMTTYP="MONT" D EN2^RGMTMONT
"RTN","RGMTSTAT",92,0)
 .S RGHLMQ=1 I RGMTTYP="HLMA" D HLMA2^RGMTUT98
"RTN","RGMTSTAT",93,0)
 .S RGHLMQ=1 I RGMTTYP="UT01" D EN2^RGMTUT01
"RTN","RGMTSTAT",94,0)
 .S RGMTHQ=1 I RGMTTYP="ETOT" D DUMP2^RGMTETOT D
"RTN","RGMTSTAT",95,0)
 ..S ^XTMP("RGMT","HLMQETOT",RGMTFAC,"@@RUNDATE")=$P($$SITE^VASITE,"^",2)_"^"_$$HTE^XLFDT($H)
"RTN","RGMTSTAT",96,0)
 S RGMT="RGMT DEFERRED QRY RESP SERVER"
"RTN","RGMTSTAT",97,0)
 I $$BLD(RGMT)'>0 S HLP("ERRTEXT")="Could not find protocol" Q
"RTN","RGMTSTAT",98,0)
 S ^TMP("HLS",$J,1)="MSA"_HL("FS")_"AA"_HL("FS")_RGMTID
"RTN","RGMTSTAT",99,0)
 S ^TMP("HLS",$J,2)=RGMTQRD
"RTN","RGMTSTAT",100,0)
 D DSRTYPE
"RTN","RGMTSTAT",101,0)
 D GEN
"RTN","RGMTSTAT",102,0)
 K RGMTQRD,REP,ZTSAVE,RGMTRCV,RGMTMID,SITE,RGMTFS,RGCOMP,SUBCOMP,X,Y
"RTN","RGMTSTAT",103,0)
 Q
"RTN","RGMTSTAT",104,0)
RTERSP ;router for DSR msg from protocol, RGMT DEFERRED QRY RESP SERVER.
"RTN","RGMTSTAT",105,0)
 N CLIENT,SITE
"RTN","RGMTSTAT",106,0)
 S CLIENT="RGMT DEFERRED QRY RESP CLIENT"
"RTN","RGMTSTAT",107,0)
 S SITE=$$LKUP^XUAF4("200M")
"RTN","RGMTSTAT",108,0)
 D LINK^HLUTIL3(SITE,.RGMT)
"RTN","RGMTSTAT",109,0)
 I $O(RGMT(0)) S HLL("LINKS",1)=CLIENT_"^"_$P(RGMT($O(RGMT(0))),U)
"RTN","RGMTSTAT",110,0)
 Q
"RTN","RGMTSTAT",111,0)
ACK ;processor of DSR msg should be using protocol, RGMT DEFERRED QRY RESP CLIENT, 
"RTN","RGMTSTAT",112,0)
 ;but is using the originating QRY protocol, RGMT DEFERRED QRY CLIENT.
"RTN","RGMTSTAT",113,0)
 S RGMT=0 K ^TMP("HLA",$J)
"RTN","RGMTSTAT",114,0)
 F RGMT=1:1 X HLNEXT Q:HLQUIT'>0  S SG=$E(HLNODE,1,3) D:$T(@SG)]"" @SG
"RTN","RGMTSTAT",115,0)
 S ^TMP("HLA",$J,1)="MSA"_HL("FS")_"AA"_HL("FS")_HL("MID")
"RTN","RGMTSTAT",116,0)
 N HLRESLTA,HLP D GENACK^HLMA1(HL("EID"),HL("EIDS"),"GM",1,.HLRESLTA,"",.HLP)
"RTN","RGMTSTAT",117,0)
 S $P(^XTMP("RGMT","RGHLMQ",SITE,0),"^",2)="F"
"RTN","RGMTSTAT",118,0)
 K RGMT,RGMTAA
"RTN","RGMTSTAT",119,0)
 Q
"RTN","RGMTSTAT",120,0)
DSP ;display segment
"RTN","RGMTSTAT",121,0)
 N RGMTDSP,RGMTRPT,RGCS,RGDATA,RGNODE
"RTN","RGMTSTAT",122,0)
 S RGDATA=$P(HLNODE,HL("FS"),4,99)
"RTN","RGMTSTAT",123,0)
 S RGMTDSP=$P(HLNODE,HL("FS"),2)
"RTN","RGMTSTAT",124,0)
 S RGMTRPT=$P(HLNODE,HL("FS"),3)
"RTN","RGMTSTAT",125,0)
 I '$D(^XTMP("RGMT","RGHLMQ",SITE,0)) S ^XTMP("RGMT","RGHLMQ",SITE,0)=$$FMADD^XLFDT(DT,7)_"^"_"F"
"RTN","RGMTSTAT",126,0)
 S RGNODE="^XTMP(""RGMT"",""HLMQ"_$S(RGMTRPT=1:"MONT""",RGMTRPT=2:"HLMA""",RGMTRPT=3:"ETOT""",1:"UT01""")_","_SITE
"RTN","RGMTSTAT",127,0)
 F RGCS=2:1:$L(RGDATA,RGCOMP) S RGNODE=RGNODE_","""_$P(RGDATA,RGCOMP,RGCS)_""""
"RTN","RGMTSTAT",128,0)
 S RGNODE=RGNODE_")"
"RTN","RGMTSTAT",129,0)
 I RGNODE["@@ RUNDATE" S @RGNODE=$$GET1^DIQ(4,+SITE_",",.01)_"^"_$P(RGDATA,RGCOMP) Q
"RTN","RGMTSTAT",130,0)
 S @RGNODE=$P(RGDATA,RGCOMP)
"RTN","RGMTSTAT",131,0)
 Q
"RTN","RGMTSTAT",132,0)
MSA ;Message ack segment
"RTN","RGMTSTAT",133,0)
 S RGMTAA=$P(HLNODE,HL("FS"),3)
"RTN","RGMTSTAT",134,0)
 Q
"RTN","RGMTTFL")
1^12
"RTN","RGMTUT01")
0^6^B72834119
"RTN","RGMTUT01",1,0)
RGMTUT01 ;BIR/CML-MPI/PD Compile and Correct Data Validation Data for Local Sites ;08/12/02
"RTN","RGMTUT01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGMTUT01",3,0)
 ;
"RTN","RGMTUT01",4,0)
 ;Reference to $$UPDATE^MPIFAPI supported by IA #2706
"RTN","RGMTUT01",5,0)
 ;Reference to VAFCTFU supported by IA #2988
"RTN","RGMTUT01",6,0)
 ;Reference to ^DPT( supported by IA #2070
"RTN","RGMTUT01",7,0)
 ;Reference to ^DGCN(391.91,"APAT" supported by IA #2911
"RTN","RGMTUT01",8,0)
 ;
"RTN","RGMTUT01",9,0)
EN1 ;Use this entry point to get only display diagnostics for development team
"RTN","RGMTUT01",10,0)
 ;BYPASS=0 means prohibit times are enforced
"RTN","RGMTUT01",11,0)
 ;SITEOPT=0 means CMOR, TF, and diagnostics are included in report
"RTN","RGMTUT01",12,0)
 ;SITEOPT=1 means diagnostics are omitted from report (this is the report for the site)
"RTN","RGMTUT01",13,0)
 ;SITEOPT=2 means only diagnostics are in report
"RTN","RGMTUT01",14,0)
 ;
"RTN","RGMTUT01",15,0)
 S BYPASS=0,SITEOPT=2 G BEGIN
"RTN","RGMTUT01",16,0)
 ;
"RTN","RGMTUT01",17,0)
EN2 ;Use this entry point from remote query
"RTN","RGMTUT01",18,0)
 S BYPASS=0,SITEOPT=0 G BEGIN
"RTN","RGMTUT01",19,0)
 ;
"RTN","RGMTUT01",20,0)
EN3 ;Use this entry point for site menu option [RG NATIONAL ICN STATISTICS] to omit
"RTN","RGMTUT01",21,0)
 ;diagnostic section from report
"RTN","RGMTUT01",22,0)
 S BYPASS=0,SITEOPT=1 G BEGIN
"RTN","RGMTUT01",23,0)
 ;
"RTN","RGMTUT01",24,0)
BY ;use this call to bypass check to prohibit primetime run
"RTN","RGMTUT01",25,0)
 S BYPASS=1,SITEOPT=2
"RTN","RGMTUT01",26,0)
 ;
"RTN","RGMTUT01",27,0)
BEGIN ;
"RTN","RGMTUT01",28,0)
 S PRT=0
"RTN","RGMTUT01",29,0)
 I $D(^XTMP("RGMT","UT01","@@","COMPILE STARTED"))&('$D(^XTMP("RGMT","UT01","@@","COMPILE STOPPED"))) D  G QUIT
"RTN","RGMTUT01",30,0)
 .I '$D(RGHLMQ) W !!,"The Stat Report is currently being compiled."
"RTN","RGMTUT01",31,0)
 I $D(RGHLMQ) G STARTQ
"RTN","RGMTUT01",32,0)
 W !!,"This option provides the following statistics:"
"RTN","RGMTUT01",33,0)
 W !?3,"1.  Total patients assigned to each unique COORDINATING MASTER OF"
"RTN","RGMTUT01",34,0)
 W !?3,"    RECORD (CMOR)."
"RTN","RGMTUT01",35,0)
 W !?3,"2.  Total patients shared with each unique entry in the TREATING"
"RTN","RGMTUT01",36,0)
 W !?3,"    FACILITY LIST (#391.91) file."
"RTN","RGMTUT01",37,0)
 W !?3,"3.  Totals for national ICNs, local ICNs, and patients with no ICN."
"RTN","RGMTUT01",38,0)
 I SITEOPT=1 G START
"RTN","RGMTUT01",39,0)
 W !?3,"4.  Total CMOR assignments missing a matching Treating Facility."
"RTN","RGMTUT01",40,0)
 W !?3,"5.  Total patients with NATIONAL ICN and missing local Treating Facility."
"RTN","RGMTUT01",41,0)
 W !?3,"6.  Total number of patients with duplicate entries in the TREATING"
"RTN","RGMTUT01",42,0)
 W !?3,"    FACILITY LIST file (#391.91)."
"RTN","RGMTUT01",43,0)
 W !?3,"7.  Patient File xref problems for ""AICN"", ""AICNL"", and ""SSN""."
"RTN","RGMTUT01",44,0)
 W !?3,"8.  Total number of patients with a no ICN but have a CMOR assignment."
"RTN","RGMTUT01",45,0)
 W !?3,"9.  Total number of patients with a no ICN but have TF assignments."
"RTN","RGMTUT01",46,0)
 W !?3,"10. Total number of patients with a local ICN but have remote TFs."
"RTN","RGMTUT01",47,0)
 ;
"RTN","RGMTUT01",48,0)
START ;
"RTN","RGMTUT01",49,0)
 S QFLG=0
"RTN","RGMTUT01",50,0)
 I '$D(^XTMP("RGMT","UT01","@@","COMPILE STARTED")) W !!,"No data is currently available." I SITEOPT=1 G QUIT
"RTN","RGMTUT01",51,0)
 ;
"RTN","RGMTUT01",52,0)
 W !!,"===> NOTE <==="
"RTN","RGMTUT01",53,0)
 I SITEOPT=1 D
"RTN","RGMTUT01",54,0)
 .W !,"This data is compiled by a remote process initiated from the MPI in Austin"
"RTN","RGMTUT01",55,0)
 .W !,"on a regular basis for reporting purposes.  It is not compiled by the local"
"RTN","RGMTUT01",56,0)
 .W !,"site, however, the local site can view the last report that was compiled.",!
"RTN","RGMTUT01",57,0)
 ;
"RTN","RGMTUT01",58,0)
 I $D(^XTMP("RGMT","UT01","@@","COMPILE STOPPED")) D  G:QFLG QUIT I PRT D ^RGMTUT03 G QUIT
"RTN","RGMTUT01",59,0)
 .S PRT=0
"RTN","RGMTUT01",60,0)
 .S LAST=^XTMP("RGMT","UT01","@@","COMPILE STOPPED")
"RTN","RGMTUT01",61,0)
 .S LAST=$$FMTE^XLFDT(LAST)
"RTN","RGMTUT01",62,0)
 .W !,"This data was last compiled on ",LAST,"."
"RTN","RGMTUT01",63,0)
 .I SITEOPT=1 S PRT=1 Q
"RTN","RGMTUT01",64,0)
 .S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you just want a reprint of that data"
"RTN","RGMTUT01",65,0)
 .S DIR("?",1)="Enter:"
"RTN","RGMTUT01",66,0)
 .S DIR("?",2)=" ""YES"" or <RET> to reprint current data and NOT recompile."
"RTN","RGMTUT01",67,0)
 .S DIR("?",3)=" ""NO"" to recompile new data (this may take several hours)."
"RTN","RGMTUT01",68,0)
 .S DIR("?")=" ""^"" to HALT."
"RTN","RGMTUT01",69,0)
 .D ^DIR K DIR
"RTN","RGMTUT01",70,0)
 .I Y="^" S QFLG=1 Q
"RTN","RGMTUT01",71,0)
 .I +Y=1 S PRT=1 Q
"RTN","RGMTUT01",72,0)
 ;
"RTN","RGMTUT01",73,0)
STARTQ ;pick up here for queued job
"RTN","RGMTUT01",74,0)
 D NOW^%DTC
"RTN","RGMTUT01",75,0)
 ;
"RTN","RGMTUT01",76,0)
 ;check to be sure stat report not being run during prime time
"RTN","RGMTUT01",77,0)
 S TODAY=$$DOW^XLFDT($$NOW^XLFDT()) I TODAY="Saturday"!(TODAY="Sunday") S BYPASS=1
"RTN","RGMTUT01",78,0)
 S QUIT=0
"RTN","RGMTUT01",79,0)
 I 'BYPASS D  I QUIT G QUIT
"RTN","RGMTUT01",80,0)
 .S CHKTIME=$E($P(%,".",2),1,4)
"RTN","RGMTUT01",81,0)
 .I CHKTIME>"0700"&(CHKTIME<"1700") S QUIT=1 I '$D(RGHLMQ) D
"RTN","RGMTUT01",82,0)
 ..W !!,"<< STAT report cannot be compiled between 7:00am and 5:00pm! >>"
"RTN","RGMTUT01",83,0)
 ;
"RTN","RGMTUT01",84,0)
 I '$D(RGHLMQ) W !!,"Recompiling data..."
"RTN","RGMTUT01",85,0)
 ;
"RTN","RGMTUT01",86,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_$$NOW^XLFDT_"^MPI/PD Maintenance Data"
"RTN","RGMTUT01",87,0)
 K ^XTMP("RGMT","UT01")
"RTN","RGMTUT01",88,0)
 S ^XTMP("RGMT","UT01","@@","COMPILE STARTED")=%
"RTN","RGMTUT01",89,0)
 ;
"RTN","RGMTUT01",90,0)
 D REIND^RGMTUT02
"RTN","RGMTUT01",91,0)
 D CMOR,TF,TFCHK
"RTN","RGMTUT01",92,0)
 ;
"RTN","RGMTUT01",93,0)
 I 'PRT D
"RTN","RGMTUT01",94,0)
 .D NOW^%DTC
"RTN","RGMTUT01",95,0)
 .S ^XTMP("RGMT","UT01","@@","COMPILE STOPPED")=%
"RTN","RGMTUT01",96,0)
 D ^RGMTUT03
"RTN","RGMTUT01",97,0)
 ;
"RTN","RGMTUT01",98,0)
QUIT ;
"RTN","RGMTUT01",99,0)
 K %,BYPASS,CHKTIME,LAST,LOC,PRT,QFLG,QUIT,SITEOPT,TODAY,Y
"RTN","RGMTUT01",100,0)
 Q
"RTN","RGMTUT01",101,0)
 ;
"RTN","RGMTUT01",102,0)
CMOR ; Check "ACMOR" xref for:
"RTN","RGMTUT01",103,0)
 ; - existence of a TF entry for the CMOR in the TF file #391.91
"RTN","RGMTUT01",104,0)
 ; - existence of a TF for the local site (if not the CMOR)
"RTN","RGMTUT01",105,0)
 ; - CMOR totals by site
"RTN","RGMTUT01",106,0)
 ;
"RTN","RGMTUT01",107,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT01",108,0)
 .W !!,"Check #1 for:"
"RTN","RGMTUT01",109,0)
 .W !,"- Patients missing Treating Facility entries for their CMOR."
"RTN","RGMTUT01",110,0)
 .W !,"- Patients missing Treating Facility entries for their local site."
"RTN","RGMTUT01",111,0)
 .W !,"- Unique CMOR totals."
"RTN","RGMTUT01",112,0)
 ;
"RTN","RGMTUT01",113,0)
 K ^XTMP("RGMT","UT01","CMOR")
"RTN","RGMTUT01",114,0)
 K ^XTMP("RGMT","UT01","TOT CMOR MISS TF")
"RTN","RGMTUT01",115,0)
 K ^XTMP("RGMT","UT01","TOT LOC SITE MISS TF")
"RTN","RGMTUT01",116,0)
 K ^XTMP("RGMT","UT01","CMOR WITH NO ICN")
"RTN","RGMTUT01",117,0)
 S (CNT,NOICN,TOTMISSC,TOTMISSL)=0
"RTN","RGMTUT01",118,0)
 S SITESTA=$P($$SITE^VASITE(),"^",3),SITEDA=$P($$SITE^VASITE(),"^")
"RTN","RGMTUT01",119,0)
 ;
"RTN","RGMTUT01",120,0)
 S CMOR=0 F  S CMOR=$O(^DPT("ACMOR",CMOR)) Q:'CMOR  D
"RTN","RGMTUT01",121,0)
 .I '$D(CMOR(CMOR)) S CMOR(CMOR)=0
"RTN","RGMTUT01",122,0)
 .S DFN=0 F  S DFN=$O(^DPT("ACMOR",CMOR,DFN)) Q:'DFN  D
"RTN","RGMTUT01",123,0)
 ..S CNT=CNT+1 I '$D(RGHLMQ) W:'(CNT#10000) "."
"RTN","RGMTUT01",124,0)
 ..S ICN=$P($G(^DPT(DFN,"MPI")),"^")
"RTN","RGMTUT01",125,0)
 ..I $E(ICN,1,3)=SITESTA Q
"RTN","RGMTUT01",126,0)
 ..I ICN="" D  Q
"RTN","RGMTUT01",127,0)
 ...S NOICN=NOICN+1
"RTN","RGMTUT01",128,0)
 ...I '$D(RGHLMQ) W !?3,"DFN #",DFN," has no ICN and a CMOR of ",$P($$NS^XUAF4(CMOR),"^")
"RTN","RGMTUT01",129,0)
 ...S ^XTMP("RGMT","UT01","CMOR WITH NO ICN",DFN)=""
"RTN","RGMTUT01",130,0)
 ...S LOC(991.03)="@" W $$UPDATE^MPIFAPI(DFN,"LOC")
"RTN","RGMTUT01",131,0)
 ..S CMOR(CMOR)=CMOR(CMOR)+1
"RTN","RGMTUT01",132,0)
 ..I '$D(^DGCN(391.91,"APAT",DFN,CMOR)) D
"RTN","RGMTUT01",133,0)
 ...S TOTMISSC=TOTMISSC+1
"RTN","RGMTUT01",134,0)
 ...S SSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","RGMTUT01",135,0)
 ...S NAME=$P($G(^DPT(DFN,0)),"^")
"RTN","RGMTUT01",136,0)
 ...S ^XTMP("RGMT","UT01","CMOR","ZZMISSC",CMOR,DFN)="DFN/"_DFN_"^NAME/"_NAME_"^SSN/"_SSN_"^ICN/"_ICN
"RTN","RGMTUT01",137,0)
 ...D FILE^VAFCTFU(DFN,CMOR,1)
"RTN","RGMTUT01",138,0)
 ..I SITEDA'=CMOR,'$D(^DGCN(391.91,"APAT",DFN,SITEDA)) D
"RTN","RGMTUT01",139,0)
 ...S TOTMISSL=TOTMISSL+1
"RTN","RGMTUT01",140,0)
 ...S SSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","RGMTUT01",141,0)
 ...S NAME=$P($G(^DPT(DFN,0)),"^")
"RTN","RGMTUT01",142,0)
 ...S ^XTMP("RGMT","UT01","CMOR","ZZMISSL",CMOR,DFN)="DFN/"_DFN_"^NAME/"_NAME_"^SSN/"_SSN_"^ICN/"_ICN
"RTN","RGMTUT01",143,0)
 ...D FILE^VAFCTFU(DFN,SITEDA,1)
"RTN","RGMTUT01",144,0)
 ;
"RTN","RGMTUT01",145,0)
 S CMOR=0 F  S CMOR=$O(CMOR(CMOR)) Q:'CMOR  D
"RTN","RGMTUT01",146,0)
 .S CMORNM=$P($$NS^XUAF4(CMOR),"^"),CMORSTA=$P($$NS^XUAF4(CMOR),"^",2) Q:CMORSTA=""
"RTN","RGMTUT01",147,0)
 .S ^XTMP("RGMT","UT01","CMOR",CMORNM,CMORSTA)=CMOR(CMOR)
"RTN","RGMTUT01",148,0)
 S ^XTMP("RGMT","UT01","TOT CMOR MISS TF")=TOTMISSC
"RTN","RGMTUT01",149,0)
 S ^XTMP("RGMT","UT01","TOT LOC SITE MISS TF")=TOTMISSL
"RTN","RGMTUT01",150,0)
 S ^XTMP("RGMT","UT01","CMOR WITH NO ICN")=NOICN
"RTN","RGMTUT01",151,0)
 I '$D(RGHLMQ) W !,"Check #1 - Complete"
"RTN","RGMTUT01",152,0)
 K CMOR,CMORNM,CMORSTA,CNT,DFN,ICN,NAME,NOICN,SITEDA,SITESTA,SSN,TOTMISSC,TOTMISSL
"RTN","RGMTUT01",153,0)
 Q
"RTN","RGMTUT01",154,0)
 ;
"RTN","RGMTUT01",155,0)
TF ; Get totals for unique sites in the TF file (#391.91)
"RTN","RGMTUT01",156,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT01",157,0)
 .W !!,"Check #2 for:"
"RTN","RGMTUT01",158,0)
 .W !,"- Unique Treating Facility totals."
"RTN","RGMTUT01",159,0)
 K ^XTMP("RGMT","UT01","TF"),TFCNT S CNT=0
"RTN","RGMTUT01",160,0)
 S SITE=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTUT01",161,0)
 S TF=0 F  S TF=$O(^DGCN(391.91,"AINST",TF)) Q:'TF  D
"RTN","RGMTUT01",162,0)
 .S CNT=CNT+1 I '$D(RGHLMQ) W:'(CNT#10000) "."
"RTN","RGMTUT01",163,0)
 .I '$D(TFCNT(TF)) S TFCNT(TF)=0
"RTN","RGMTUT01",164,0)
 .S TFIEN=0 F  S TFIEN=$O(^DGCN(391.91,"AINST",TF,TFIEN)) Q:'TFIEN  S TFCNT(TF)=TFCNT(TF)+1
"RTN","RGMTUT01",165,0)
 S TF=0 F  S TF=$O(TFCNT(TF)) Q:'TF  D
"RTN","RGMTUT01",166,0)
 .S TFNM=$P($$NS^XUAF4(TF),"^"),TFSTA=$P($$NS^XUAF4(TF),"^",2) Q:TFSTA=""
"RTN","RGMTUT01",167,0)
 .S ^XTMP("RGMT","UT01","TF",TFNM,TFSTA)=TFCNT(TF)
"RTN","RGMTUT01",168,0)
 I '$D(RGHLMQ) W !,"Check #2 - Complete"
"RTN","RGMTUT01",169,0)
 K CNT,SITE,TF,TFCNT,TFIEN,TFNM,TFSTA
"RTN","RGMTUT01",170,0)
 Q
"RTN","RGMTUT01",171,0)
 ;
"RTN","RGMTUT01",172,0)
TFCHK ; Get totals for duplicates in TF file (#391.91)
"RTN","RGMTUT01",173,0)
 ;NOICN=# of patients found with remote TFs and no ICN
"RTN","RGMTUT01",174,0)
 ;LOCICN=# of patients found with remote TFs and a local ICN
"RTN","RGMTUT01",175,0)
 ;
"RTN","RGMTUT01",176,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT01",177,0)
 .W !!,"Check #3 for:"
"RTN","RGMTUT01",178,0)
 .W !,"- Duplicate Treating Facility assignments."
"RTN","RGMTUT01",179,0)
 .W !,"- Patients with Treating Facilities and no ICN."
"RTN","RGMTUT01",180,0)
 .W !,"- Patients remote treating Facilities and Local ICN."
"RTN","RGMTUT01",181,0)
 ;
"RTN","RGMTUT01",182,0)
 K ^XTMP("RGMT","UT01","TOT TFDUP"),^XTMP("RGMT","UT01","TOT NO ICN W/TF"),^XTMP("RGMT","UT01","TOT LOC ICN W/REMOTE TF")
"RTN","RGMTUT01",183,0)
 S (PTCNT,DUPCNT,NOICN,LOCICN)=0
"RTN","RGMTUT01",184,0)
 S SITESTA=$P($$SITE^VASITE(),"^",3),SITEDA=$P($$SITE^VASITE(),"^")
"RTN","RGMTUT01",185,0)
 S DFN=0 F  S DFN=$O(^DGCN(391.91,"APAT",DFN)) Q:'DFN  D
"RTN","RGMTUT01",186,0)
 .S PTCNT=PTCNT+1 I '$D(RGHLMQ) W:'(PTCNT#10000) "."
"RTN","RGMTUT01",187,0)
 .S TF=0 F  S TF=$O(^DGCN(391.91,"APAT",DFN,TF)) Q:'TF  D
"RTN","RGMTUT01",188,0)
 ..S MPI0=$G(^DPT(DFN,"MPI")),ICN=$P(MPI0,"^")
"RTN","RGMTUT01",189,0)
 ..;delete all TFs for patients with no ICN
"RTN","RGMTUT01",190,0)
 ..I ICN="" D  Q
"RTN","RGMTUT01",191,0)
 ...S NOICN=NOICN+1
"RTN","RGMTUT01",192,0)
 ...S TFIEN=0 F  S TFIEN=$O(^DGCN(391.91,"APAT",DFN,TF,TFIEN)) Q:'TFIEN  D
"RTN","RGMTUT01",193,0)
 ....S ^XTMP("RGMT","UT01","NO ICN WITH REMOTE OR LOCAL TF",DFN,TFIEN)=""
"RTN","RGMTUT01",194,0)
 ....D DELETE^VAFCTFU(TFIEN)
"RTN","RGMTUT01",195,0)
 ..;delete all remote TFs for patients with local ICNs
"RTN","RGMTUT01",196,0)
 ..I $E(ICN,1,3)=SITESTA,TF'=SITEDA D  Q
"RTN","RGMTUT01",197,0)
 ...S TFIEN=0 F  S TFIEN=$O(^DGCN(391.91,"APAT",DFN,TF,TFIEN)) Q:'TFIEN  D
"RTN","RGMTUT01",198,0)
 ....S LOCICN=LOCICN+1
"RTN","RGMTUT01",199,0)
 ....S ^XTMP("RGMT","UT01","LOCAL ICN WITH REMOTE TF",DFN,TFIEN)=""
"RTN","RGMTUT01",200,0)
 ....D DELETE^VAFCTFU(TFIEN)
"RTN","RGMTUT01",201,0)
 ..;look for TF dups
"RTN","RGMTUT01",202,0)
 ..S (TFCNT,TFIEN)=0 F  S TFIEN=$O(^DGCN(391.91,"APAT",DFN,TF,TFIEN)) Q:'TFIEN  D
"RTN","RGMTUT01",203,0)
 ...S TFCNT=TFCNT+1 I TFCNT>1 D
"RTN","RGMTUT01",204,0)
 ....S DUPCNT=DUPCNT+1
"RTN","RGMTUT01",205,0)
 ....S SSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","RGMTUT01",206,0)
 ....S NM=$P($G(^(0)),"^")
"RTN","RGMTUT01",207,0)
 ....S ^XTMP("RGMT","UT01","TFDUP",DFN,TFIEN)=TF_"^"_NM_"^"_SSN
"RTN","RGMTUT01",208,0)
 ....D DELETE^VAFCTFU(TFIEN)
"RTN","RGMTUT01",209,0)
 ;
"RTN","RGMTUT01",210,0)
 S ^XTMP("RGMT","UT01","TOT TFDUP")=DUPCNT
"RTN","RGMTUT01",211,0)
 S ^XTMP("RGMT","UT01","TOT NO ICN W/TF")=NOICN
"RTN","RGMTUT01",212,0)
 S ^XTMP("RGMT","UT01","TOT LOC ICN W/REMOTE TF")=LOCICN
"RTN","RGMTUT01",213,0)
 I '$D(RGHLMQ) W !,"Check #3 - Complete"
"RTN","RGMTUT01",214,0)
 K DFN,DUPCNT,ICN,LOCICN,MPI0,NM,NOICN,PTCNT,SITEDA,SITESTA,SSN,TF,TFCNT,TFIEN
"RTN","RGMTUT01",215,0)
 Q
"RTN","RGMTUT02")
0^7^B15382663
"RTN","RGMTUT02",1,0)
RGMTUT02 ;BIR/CML-MPI/PD Compile and Correct Data Validation Data for Local Sites (CON'T) ;07/30/02
"RTN","RGMTUT02",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGMTUT02",3,0)
 ;
"RTN","RGMTUT02",4,0)
 ;Reference to ^DPT("AICN" & ^DPT("AICNL" supported by IA #2070
"RTN","RGMTUT02",5,0)
 ;Reference to $$SETLOC MPIF001 supported by IA #2705
"RTN","RGMTUT02",6,0)
 ;Reference to EDIT^VAFCPTED supported by IA #2784
"RTN","RGMTUT02",7,0)
 ;
"RTN","RGMTUT02",8,0)
 Q
"RTN","RGMTUT02",9,0)
 ;
"RTN","RGMTUT02",10,0)
REIND ;Correct any existing xref problems:
"RTN","RGMTUT02",11,0)
 ; - missing SSN xref (only if they have a local or national ICN)
"RTN","RGMTUT02",12,0)
 ; - missing AICN xref
"RTN","RGMTUT02",13,0)
 ; - missing AICNL xref and field Locally assigned ICN
"RTN","RGMTUT02",14,0)
 ;Also get counts of national ICNs, Local ICNs and NO ICNs
"RTN","RGMTUT02",15,0)
 ;
"RTN","RGMTUT02",16,0)
 ;NOSSN = number of patients missing an SSN xref (only if they have a local or national ICN)
"RTN","RGMTUT02",17,0)
 ;NOAICN = number of patients missing an AICN xref
"RTN","RGMTUT02",18,0)
 ;NOAICNL = number of patients missing an AICNL xref
"RTN","RGMTUT02",19,0)
 ;NICNCNT = number of patients with a national ICN
"RTN","RGMTUT02",20,0)
 ;LICNCNT = number of patients with a local ICN
"RTN","RGMTUT02",21,0)
 ;NOICNCNT = number of patients no ICN
"RTN","RGMTUT02",22,0)
 ;
"RTN","RGMTUT02",23,0)
 S CURDT=$P($$NOW^XLFDT,".")
"RTN","RGMTUT02",24,0)
 I $G(^XTMP("RGMT","REINDDT"))=CURDT D  Q
"RTN","RGMTUT02",25,0)
 .I '$D(RGHLMQ) W !!,"Check for missing xrefs and counts already run today."
"RTN","RGMTUT02",26,0)
 I $G(^XTMP("RGMT","REINDDT"))'=CURDT K ^XTMP("RGMT","REINDDT")
"RTN","RGMTUT02",27,0)
 I '$D(^XTMP("RGMT","REINDDT")) S ^XTMP("RGMT","REINDDT")=CURDT
"RTN","RGMTUT02",28,0)
 ;
"RTN","RGMTUT02",29,0)
 K ^XTMP("RGMT","UT01","REIND")
"RTN","RGMTUT02",30,0)
 S (NOSSN,NOAICN,NOAICNL,NICNCNT,LICNCNT,NOICNCNT,DFNCNT)=0
"RTN","RGMTUT02",31,0)
 F TYPE="MISSING SSN XREF","MISSING AICN XREF","MISSING AICNL XREF","NATIONAL ICN COUNT","LOCAL ICN COUNT","NO ICN COUNT" D
"RTN","RGMTUT02",32,0)
 .S ^XTMP("RGMT","UT01","REIND",TYPE)=0
"RTN","RGMTUT02",33,0)
 ;
"RTN","RGMTUT02",34,0)
 S SITE=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTUT02",35,0)
 ;
"RTN","RGMTUT02",36,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT02",37,0)
 .W !!,"Checking for:"
"RTN","RGMTUT02",38,0)
 .W !,"Missing ""SSN"" xrefs in ^DPT"
"RTN","RGMTUT02",39,0)
 .W !,"Missing ""AICN"" xrefs in ^DPT"
"RTN","RGMTUT02",40,0)
 .W !,"Missing ""AICNL"" xrefs in ^DPT"
"RTN","RGMTUT02",41,0)
 .W !,"Counts on total National ICNs"
"RTN","RGMTUT02",42,0)
 .W !,"Counts on total Local ICNs"
"RTN","RGMTUT02",43,0)
 .W !,"Counts on total patients without ICNs"
"RTN","RGMTUT02",44,0)
 ;
"RTN","RGMTUT02",45,0)
 S DFN=0 F  S DFN=$O(^DPT(DFN)) Q:'DFN  S DFNCNT=DFNCNT+1 S MNODE=$G(^DPT(DFN,"MPI")) D
"RTN","RGMTUT02",46,0)
 .I '$D(RGHLMQ),'(DFNCNT#10000) W !,DFN
"RTN","RGMTUT02",47,0)
 .I MNODE="" S NOICNCNT=NOICNCNT+1 Q
"RTN","RGMTUT02",48,0)
 .S ICN=$P(MNODE,"^") I ICN="" S NOICNCNT=NOICNCNT+1 Q
"RTN","RGMTUT02",49,0)
 .S SSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","RGMTUT02",50,0)
 .I $G(SSN),'$D(^DPT("SSN",SSN,DFN)) S NOSSN=NOSSN+1 D
"RTN","RGMTUT02",51,0)
 ..; if SSN xref exists for a different patient, send exception and quit
"RTN","RGMTUT02",52,0)
 ..; otherwise, edit the field to set the xref
"RTN","RGMTUT02",53,0)
 ..I $D(^DPT("SSN",SSN)) D  Q
"RTN","RGMTUT02",54,0)
 ...D EXC^RGHLLOG(210,"SSN xref does not exist for patient DFN #"_DFN_" for SSN "_SSN_". This SSN appears to exist for a different patient.",DFN)
"RTN","RGMTUT02",55,0)
 ..K ARR S ARR(2,.09)=SSN D EDIT^VAFCPTED(DFN,"ARR(2)",".09")
"RTN","RGMTUT02",56,0)
 .I '$D(^DPT("AICN",ICN,DFN)) S NOAICN=NOAICN+1,^DPT("AICN",ICN,DFN)=""
"RTN","RGMTUT02",57,0)
 .I $E(ICN,1,3)'=SITE S NICNCNT=NICNCNT+1 Q
"RTN","RGMTUT02",58,0)
 .I $E(ICN,1,3)=SITE D
"RTN","RGMTUT02",59,0)
 ..S LICNCNT=LICNCNT+1
"RTN","RGMTUT02",60,0)
 ..I '$D(^DPT("AICNL",1,DFN)) S LOCAL=$$SETLOC^MPIF001(DFN,1),^DPT("AICNL",1,DFN)="",NOAICNL=NOAICNL+1
"RTN","RGMTUT02",61,0)
 ;
"RTN","RGMTUT02",62,0)
 S ^XTMP("RGMT","UT01","REIND","MISSING SSN XREF")=NOSSN
"RTN","RGMTUT02",63,0)
 S ^XTMP("RGMT","UT01","REIND","MISSING AICN XREF")=NOAICN
"RTN","RGMTUT02",64,0)
 S ^XTMP("RGMT","UT01","REIND","MISSING AICNL XREF")=NOAICNL
"RTN","RGMTUT02",65,0)
 S ^XTMP("RGMT","UT01","REIND","NATIONAL ICN COUNT")=NICNCNT
"RTN","RGMTUT02",66,0)
 S ^XTMP("RGMT","UT01","REIND","LOCAL ICN COUNT")=LICNCNT
"RTN","RGMTUT02",67,0)
 S ^XTMP("RGMT","UT01","REIND","NO ICN COUNT")=NOICNCNT
"RTN","RGMTUT02",68,0)
 ;
"RTN","RGMTUT02",69,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT02",70,0)
 .W !!,"Results:"
"RTN","RGMTUT02",71,0)
 .W !?3,"Missing SSN xrefs created",?41,$J(NOSSN,7)
"RTN","RGMTUT02",72,0)
 .W !?3,"Missing AICN xrefs created",?41,$J(NOAICN,7)
"RTN","RGMTUT02",73,0)
 .W !?3,"Missing AICNL xrefs created",?41,$J(NOAICNL,7)
"RTN","RGMTUT02",74,0)
 .W !?3,"Total DFNs processed   : ",$J(DFNCNT,8)
"RTN","RGMTUT02",75,0)
 .W !?6,"Total National ICNs : ",$J(NICNCNT,8)
"RTN","RGMTUT02",76,0)
 .W !?6,"Total Local ICNs    : ",$J(LICNCNT,8)
"RTN","RGMTUT02",77,0)
 .W !?6,"Total without ICNs  : ",$J(NOICNCNT,8)
"RTN","RGMTUT02",78,0)
 .W !!,"(List global ^XTMP(""RGMT"",""UT01"",""REIND"" for data.)"
"RTN","RGMTUT02",79,0)
 ;
"RTN","RGMTUT02",80,0)
 K ARR,CURDT,DFN,DFNCNT,ICN,LICNCNT,LOCAL,MNODE,NICNCNT,NOAICN,NOAICNL,NOICNCNT,NOSSN,SITE,SSN,TYPE
"RTN","RGMTUT02",81,0)
 Q
"RTN","RGMTUT03")
0^8^B51236296
"RTN","RGMTUT03",1,0)
RGMTUT03 ;BIR/CML-MPI/PD Compile and Correct Data Validation Data for Local Sites (CON'T) ;08/12/02
"RTN","RGMTUT03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGMTUT03",3,0)
 ;
"RTN","RGMTUT03",4,0)
 I '$D(^XTMP("RGMT","UT01")) D  G QUIT
"RTN","RGMTUT03",5,0)
 .I '$D(RGHLMQ) W !!,"^RGMTUT01 must be run before this report can be printed!"
"RTN","RGMTUT03",6,0)
 K ^XTMP("RGMT","HLMQUT01")
"RTN","RGMTUT03",7,0)
 I '$D(SITEOPT) S SITEOPT=0
"RTN","RGMTUT03",8,0)
 ;
"RTN","RGMTUT03",9,0)
DEV ;
"RTN","RGMTUT03",10,0)
 I $D(RGHLMQ) G START
"RTN","RGMTUT03",11,0)
 W !!,"Right Margin for this report is 80."
"RTN","RGMTUT03",12,0)
 K ZTSAVE S ZTSAVE("SITEOPT")=""
"RTN","RGMTUT03",13,0)
 D EN^XUTMDEVQ("START^RGMTUT03","MPI/PD - Print Local Site Statistic Report",.ZTSAVE) I 'POP Q
"RTN","RGMTUT03",14,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","RGMTUT03",15,0)
 G QUIT
"RTN","RGMTUT03",16,0)
 ;
"RTN","RGMTUT03",17,0)
START ;
"RTN","RGMTUT03",18,0)
 K LN
"RTN","RGMTUT03",19,0)
 S SITE=$P($$SITE^VASITE(),"^",2),LOCSTA=$P($$SITE^VASITE(),"^",3),$P(LN,"-",81)=""
"RTN","RGMTUT03",20,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTUT03",21,0)
 S COMPDT=$$FMTE^XLFDT($E(^XTMP("RGMT","UT01","@@","COMPILE STOPPED"),1,12))
"RTN","RGMTUT03",22,0)
 ;calculate compile time
"RTN","RGMTUT03",23,0)
 S COMPB=^XTMP("RGMT","UT01","@@","COMPILE STARTED")
"RTN","RGMTUT03",24,0)
 S COMPS=^XTMP("RGMT","UT01","@@","COMPILE STOPPED")
"RTN","RGMTUT03",25,0)
 S DIFF=($$FMDIFF^XLFDT(COMPS,COMPB,2))/3600
"RTN","RGMTUT03",26,0)
 ;
"RTN","RGMTUT03",27,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",28,0)
 .W @IOF,"MPI/PD Statistics - ",SITE,?53,"Printed ",HDT
"RTN","RGMTUT03",29,0)
 .W !,"Compiled ",COMPDT," (Compile Time: ",$J(DIFF,5,2)," hrs)",!,LN
"RTN","RGMTUT03",30,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"@@ RUNDATE")=HDT_"^(Compile Time: "_$J(DIFF,5,2)_" hrs)"
"RTN","RGMTUT03",31,0)
 ;
"RTN","RGMTUT03",32,0)
 I '$D(RGHLMQ)&(SITEOPT=2) G DIAG1
"RTN","RGMTUT03",33,0)
 ;
"RTN","RGMTUT03",34,0)
CMOR ;Loop on CMOR totals in ^XTMP("RGMT","UT01","CMOR")
"RTN","RGMTUT03",35,0)
 S GRAND=0
"RTN","RGMTUT03",36,0)
 I '$D(RGHLMQ) W !,"=>CMOR TOTALS:"
"RTN","RGMTUT03",37,0)
 S CMOR="" F  S CMOR=$O(^XTMP("RGMT","UT01","CMOR",CMOR)) Q:$E(CMOR)="Z"  Q:CMOR=""  D
"RTN","RGMTUT03",38,0)
 .S CMORSTA=0 F  S CMORSTA=$O(^XTMP("RGMT","UT01","CMOR",CMOR,CMORSTA)) Q:'CMORSTA  D
"RTN","RGMTUT03",39,0)
 ..S SKIP=0
"RTN","RGMTUT03",40,0)
 ..I CMORSTA=564 S SKIP=1,CMORNM="FAYETTEVILLE, AR"
"RTN","RGMTUT03",41,0)
 ..I CMORSTA=565 S SKIP=1,CMORNM="FAYETTEVILLE, NC"
"RTN","RGMTUT03",42,0)
 ..I 'SKIP D 
"RTN","RGMTUT03",43,0)
 ...S FRSTNM=$P(CMOR,",")
"RTN","RGMTUT03",44,0)
 ...S CMORNM=$S(FRSTNM="VAMC":$P(CMOR,",",2),1:FRSTNM)
"RTN","RGMTUT03",45,0)
 ..S TOT=$G(^XTMP("RGMT","UT01","CMOR",CMOR,CMORSTA,"1TOT"))
"RTN","RGMTUT03",46,0)
 ..I TOT="" S TOT=$G(^XTMP("RGMT","UT01","CMOR",CMOR,CMORSTA))
"RTN","RGMTUT03",47,0)
 ..S GRAND=GRAND+TOT
"RTN","RGMTUT03",48,0)
 ..I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"CMOR",CMOR,CMORSTA)=TOT
"RTN","RGMTUT03",49,0)
 ..I '$D(RGHLMQ) W !,CMORNM,?30," = ",?33,$J(TOT,7)
"RTN","RGMTUT03",50,0)
 I '$D(RGHLMQ) W !?59,"TOTAL: ",?66,$J(GRAND,7)
"RTN","RGMTUT03",51,0)
 ;
"RTN","RGMTUT03",52,0)
TF ;Loop on Treating Facility totals   
"RTN","RGMTUT03",53,0)
 I '$D(RGHLMQ) W !!,"=>TREATING FACILITY TOTALS:"
"RTN","RGMTUT03",54,0)
 S TF=""
"RTN","RGMTUT03",55,0)
 F  S TF=$O(^XTMP("RGMT","UT01","TF",TF)) Q:$E(TF)="Z"  Q:TF=""  D
"RTN","RGMTUT03",56,0)
 .S TFSTA=0 F  S TFSTA=$O(^XTMP("RGMT","UT01","TF",TF,TFSTA)) Q:'TFSTA  D
"RTN","RGMTUT03",57,0)
 ..S SKIP=0
"RTN","RGMTUT03",58,0)
 ..I TFSTA=564 S SKIP=1,TFNM="FAYETTEVILLE, AR"
"RTN","RGMTUT03",59,0)
 ..I TFSTA=565 S SKIP=1,TFNM="FAYETTEVILLE, NC"
"RTN","RGMTUT03",60,0)
 ..I 'SKIP D 
"RTN","RGMTUT03",61,0)
 ...S FRSTNM=$P(TF,",")
"RTN","RGMTUT03",62,0)
 ...S TFNM=$S(FRSTNM="VAMC":$P(TF,",",2),1:FRSTNM)
"RTN","RGMTUT03",63,0)
 ..S TOT=^XTMP("RGMT","UT01","TF",TF,TFSTA)
"RTN","RGMTUT03",64,0)
 ..I '$D(RGHLMQ) W !,TFNM,?30," = ",?33,$J(TOT,7)
"RTN","RGMTUT03",65,0)
 ..I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"TF",TF,TFSTA)=TOT
"RTN","RGMTUT03",66,0)
 ;
"RTN","RGMTUT03",67,0)
 I SITEOPT=1,'$D(RGHLMQ) W !! G DIAG2
"RTN","RGMTUT03",68,0)
 ;
"RTN","RGMTUT03",69,0)
DIAG1 ;print diagnostic data
"RTN","RGMTUT03",70,0)
 I '$D(^XTMP("RGMT","UT01","TOT CMOR MISS TF")) S ^XTMP("RGMT","UT01","TOT CMOR MISS TF")=0
"RTN","RGMTUT03",71,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",72,0)
 .W !,"Total CMORs missing a Treating Facility",?66,"="
"RTN","RGMTUT03",73,0)
 .W $J(^XTMP("RGMT","UT01","TOT CMOR MISS TF"),6)
"RTN","RGMTUT03",74,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"TOT CMOR MISS TF")=^XTMP("RGMT","UT01","TOT CMOR MISS TF")
"RTN","RGMTUT03",75,0)
 ;
"RTN","RGMTUT03",76,0)
 I '$D(^XTMP("RGMT","UT01","TOT LOC SITE MISS TF")) S ^XTMP("RGMT","UT01","TOT LOC SITE MISS TF")=0
"RTN","RGMTUT03",77,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",78,0)
 .W !,"Total patients with NATIONAL ICN and missing local TF",?66,"="
"RTN","RGMTUT03",79,0)
 .W $J(^XTMP("RGMT","UT01","TOT LOC SITE MISS TF"),6)
"RTN","RGMTUT03",80,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"TOT LOC SITE MISS TF")=^XTMP("RGMT","UT01","TOT LOC SITE MISS TF")
"RTN","RGMTUT03",81,0)
 ;
"RTN","RGMTUT03",82,0)
 I '$D(^XTMP("RGMT","UT01","TOT TFDUP")) S ^XTMP("RGMT","UT01","TOT TFDUP")=0
"RTN","RGMTUT03",83,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",84,0)
 .W !,"Total patients with Treating Facility dups",?66,"="
"RTN","RGMTUT03",85,0)
 .W $J(^XTMP("RGMT","UT01","TOT TFDUP"),6)
"RTN","RGMTUT03",86,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"TOT TFDUP")=^XTMP("RGMT","UT01","TOT TFDUP")
"RTN","RGMTUT03",87,0)
 ;
"RTN","RGMTUT03",88,0)
 I '$D(^XTMP("RGMT","UT01","REIND","MISSING AICN XREF")) S ^XTMP("RGMT","UT01","REIND","MISSING AICN XREF")=0
"RTN","RGMTUT03",89,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",90,0)
 .W !,"Total patients with any type ICN and no ""AICN"" xref",?66,"="
"RTN","RGMTUT03",91,0)
 .W $J(^XTMP("RGMT","UT01","REIND","MISSING AICN XREF"),6)
"RTN","RGMTUT03",92,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"MISSING AICN XREF")=^XTMP("RGMT","UT01","REIND","MISSING AICN XREF")
"RTN","RGMTUT03",93,0)
 ;
"RTN","RGMTUT03",94,0)
 I '$D(^XTMP("RGMT","UT01","REIND","MISSING AICNL XREF")) S ^XTMP("RGMT","UT01","REIND","MISSING AICNL XREF")=0
"RTN","RGMTUT03",95,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",96,0)
 .W !,"Total patients with LOCAL ICN and no ""AICNL"" xref",?66,"="
"RTN","RGMTUT03",97,0)
 .W $J(^XTMP("RGMT","UT01","REIND","MISSING AICNL XREF"),6)
"RTN","RGMTUT03",98,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"MISSING AICNL XREF")=^XTMP("RGMT","UT01","REIND","MISSING AICNL XREF")
"RTN","RGMTUT03",99,0)
 ;
"RTN","RGMTUT03",100,0)
 I '$D(^XTMP("RGMT","UT01","REIND","MISSING SSN XREF")) S ^XTMP("RGMT","UT01","REIND","MISSING SSN XREF")=0
"RTN","RGMTUT03",101,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",102,0)
 .W !,"Total patients with any type ICN and missing ""SSN"" xref",?66,"="
"RTN","RGMTUT03",103,0)
 .W $J(^XTMP("RGMT","UT01","REIND","MISSING SSN XREF"),6)
"RTN","RGMTUT03",104,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"MISSING SSN XREF")=^XTMP("RGMT","UT01","REIND","MISSING SSN XREF")
"RTN","RGMTUT03",105,0)
 ;
"RTN","RGMTUT03",106,0)
 I '$D(^XTMP("RGMT","UT01","CMOR WITH NO ICN")) S ^XTMP("RGMT","UT01","CMOR WITH NO ICN")=0
"RTN","RGMTUT03",107,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",108,0)
 .W !,"Total patients with NO ICN but have a CMOR assigned",?66,"="
"RTN","RGMTUT03",109,0)
 .W $J(^XTMP("RGMT","UT01","CMOR WITH NO ICN"),6)
"RTN","RGMTUT03",110,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"CMOR WITH NO ICN")=^XTMP("RGMT","UT01","CMOR WITH NO ICN")
"RTN","RGMTUT03",111,0)
 ;
"RTN","RGMTUT03",112,0)
 I '$D(^XTMP("RGMT","UT01","TOT NO ICN W/TF")) S ^XTMP("RGMT","UT01","TOT NO ICN W/TF")=0
"RTN","RGMTUT03",113,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",114,0)
 .W !,"Total patients with NO ICN but have TFs assigned",?66,"="
"RTN","RGMTUT03",115,0)
 .W $J(^XTMP("RGMT","UT01","TOT NO ICN W/TF"),6)
"RTN","RGMTUT03",116,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"TOT NO ICN W/TF")=^XTMP("RGMT","UT01","TOT NO ICN W/TF")
"RTN","RGMTUT03",117,0)
 ;
"RTN","RGMTUT03",118,0)
 I '$D(^XTMP("RGMT","UT01","TOT LOC ICN W/REMOTE TF")) S ^XTMP("RGMT","UT01","TOT LOC ICN W/REMOTE TF")=0
"RTN","RGMTUT03",119,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",120,0)
 .W !,"Total patients with LOCAL ICN but have remote TFs assigned",?66,"="
"RTN","RGMTUT03",121,0)
 .W $J(^XTMP("RGMT","UT01","TOT LOC ICN W/REMOTE TF"),6)
"RTN","RGMTUT03",122,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"TOT LOC ICN W/REMOTE TF")=^XTMP("RGMT","UT01","TOT LOC ICN W/REMOTE TF")
"RTN","RGMTUT03",123,0)
 ;
"RTN","RGMTUT03",124,0)
DIAG2 ;display counts for total patients with local/nat'l/no ICN
"RTN","RGMTUT03",125,0)
 ;
"RTN","RGMTUT03",126,0)
 I '$D(^XTMP("RGMT","UT01","REIND","NATIONAL ICN COUNT")) S ^XTMP("RGMT","UT01","REIND","NATIONAL ICN COUNT")=0
"RTN","RGMTUT03",127,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",128,0)
 .W !?3,"Total patients with a national ICN",?42,"= "
"RTN","RGMTUT03",129,0)
 .W $J(^XTMP("RGMT","UT01","REIND","NATIONAL ICN COUNT"),8)
"RTN","RGMTUT03",130,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"NATIONAL ICN COUNT")=^XTMP("RGMT","UT01","REIND","NATIONAL ICN COUNT")
"RTN","RGMTUT03",131,0)
 ;
"RTN","RGMTUT03",132,0)
 I '$D(^XTMP("RGMT","UT01","REIND","LOCAL ICN COUNT")) S ^XTMP("RGMT","UT01","REIND","LOCAL ICN COUNT")=0
"RTN","RGMTUT03",133,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",134,0)
 .W !?3,"Total patients with a local ICN",?42,"= "
"RTN","RGMTUT03",135,0)
 .W $J(^XTMP("RGMT","UT01","REIND","LOCAL ICN COUNT"),8)
"RTN","RGMTUT03",136,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"LOCAL ICN COUNT")=^XTMP("RGMT","UT01","REIND","LOCAL ICN COUNT")
"RTN","RGMTUT03",137,0)
 ;
"RTN","RGMTUT03",138,0)
 I '$D(^XTMP("RGMT","UT01","REIND","NO ICN COUNT")) S ^XTMP("RGMT","UT01","REIND","NO ICN COUNT")=0
"RTN","RGMTUT03",139,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT03",140,0)
 .W !?3,"Total patients with no ICN",?42,"= "
"RTN","RGMTUT03",141,0)
 .W $J(^XTMP("RGMT","UT01","REIND","NO ICN COUNT"),8)
"RTN","RGMTUT03",142,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQUT01",LOCSTA,"NO ICN COUNT")=^XTMP("RGMT","UT01","REIND","NO ICN COUNT")
"RTN","RGMTUT03",143,0)
 ;
"RTN","RGMTUT03",144,0)
QUIT ;
"RTN","RGMTUT03",145,0)
 K %,CMOR,CMORNM,CMORSTA,COMDT,COMPB,COMPDT,COMPS,DIFF,FRSTNM,GRAND,HDT,LN,LOCSTA,SITE,SITEOPT,SKIP,TF,TFNM,TFSTA,TOT
"RTN","RGMTUT03",146,0)
 Q
"RTN","RGMTUT98")
0^9^B19764107
"RTN","RGMTUT98",1,0)
RGMTUT98 ;BIR/CML,PTD-Misc. MPI Load COUNTER Utilities ;07/30/02
"RTN","RGMTUT98",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGMTUT98",3,0)
 ;
"RTN","RGMTUT98",4,0)
 ;Reference to ^HLMA("AC" and other fields supported by IA #3273
"RTN","RGMTUT98",5,0)
 ;Reference to ^HLCS(870 supported by IA #3335
"RTN","RGMTUT98",6,0)
 ;Reference to ^VAT(391.71,"AXMIT" supported by IA #3422
"RTN","RGMTUT98",7,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","RGMTUT98",8,0)
 ;Reference to ^DPT("AICN", "AICNL", and "ACMORS" supported by IA #2070
"RTN","RGMTUT98",9,0)
 ;
"RTN","RGMTUT98",10,0)
HLMA1 ;check the contents of the ^HLMA("AC" xref - brief data
"RTN","RGMTUT98",11,0)
 S FLG=0 G HLMA
"RTN","RGMTUT98",12,0)
HLMA2 ;check the contents of the ^HLMA("AC" xref - detailed data
"RTN","RGMTUT98",13,0)
 S FLG=1
"RTN","RGMTUT98",14,0)
HLMA ;
"RTN","RGMTUT98",15,0)
 K ^XTMP("RGMT","HLMQHLMA"),MISSP
"RTN","RGMTUT98",16,0)
 S LOCSITE=$P($$SITE^VASITE(),"^",3),TXTCNT=0
"RTN","RGMTUT98",17,0)
 D NOW^%DTC
"RTN","RGMTUT98",18,0)
 S TXT="<<Run - "_$$FMTE^XLFDT(%)_">>"
"RTN","RGMTUT98",19,0)
 I $D(RGHLMQ) D
"RTN","RGMTUT98",20,0)
 .S TXTCNT=TXTCNT+1
"RTN","RGMTUT98",21,0)
 .S ^XTMP("RGMT","HLMQHLMA",LOCSITE,"@@ RUNDATE")=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTUT98",22,0)
 .S ^XTMP("RGMT","HLMQHLMA",LOCSITE,TXTCNT)=TXT
"RTN","RGMTUT98",23,0)
 I '$D(RGHLMQ) W !,TXT
"RTN","RGMTUT98",24,0)
 ;
"RTN","RGMTUT98",25,0)
 S TXT="Outgoing messages:"
"RTN","RGMTUT98",26,0)
 I $D(RGHLMQ) S TXTCNT=TXTCNT+1,^XTMP("RGMT","HLMQHLMA",LOCSITE,TXTCNT)=TXT
"RTN","RGMTUT98",27,0)
 I '$D(RGHLMQ) W !,TXT
"RTN","RGMTUT98",28,0)
 ;
"RTN","RGMTUT98",29,0)
 S SITE=0
"RTN","RGMTUT98",30,0)
 F  S SITE=$O(^HLMA("AC","O",SITE)) Q:'SITE  D  I $D(CNT) D WRT
"RTN","RGMTUT98",31,0)
 .K CNT
"RTN","RGMTUT98",32,0)
 .S LINK=$$GET1^DIQ(870,SITE_",",.01) I $E(LINK,1,2)'="VA"&($E(LINK,1,2)'="MP") S QFLG=1 Q
"RTN","RGMTUT98",33,0)
 .K ARR
"RTN","RGMTUT98",34,0)
 .S MSG=0,CNT=0
"RTN","RGMTUT98",35,0)
 .F  S MSG=$O(^HLMA("AC","O",SITE,MSG)) Q:'MSG  D
"RTN","RGMTUT98",36,0)
 ..S CNT=CNT+1
"RTN","RGMTUT98",37,0)
 ..Q:'FLG
"RTN","RGMTUT98",38,0)
 ..S PROT=$$GET1^DIQ(773,MSG_",",8,"I")
"RTN","RGMTUT98",39,0)
 ..Q:'PROT
"RTN","RGMTUT98",40,0)
 ..I '$D(ARR(PROT)) S ARR(PROT)=0
"RTN","RGMTUT98",41,0)
 ..S ARR(PROT)=ARR(PROT)+1
"RTN","RGMTUT98",42,0)
 ;
"RTN","RGMTUT98",43,0)
 S TXT=""
"RTN","RGMTUT98",44,0)
 I $D(RGHLMQ) S TXTCNT=TXTCNT+1,^XTMP("RGMT","HLMQHLMA",LOCSITE,TXTCNT)=TXT
"RTN","RGMTUT98",45,0)
 I '$D(RGHLMQ) W !,TXT
"RTN","RGMTUT98",46,0)
 ;
"RTN","RGMTUT98",47,0)
 S TXT="Incoming messages:"
"RTN","RGMTUT98",48,0)
 I $D(RGHLMQ) S TXTCNT=TXTCNT+1,^XTMP("RGMT","HLMQHLMA",LOCSITE,TXTCNT)=TXT
"RTN","RGMTUT98",49,0)
 I '$D(RGHLMQ) W !,TXT
"RTN","RGMTUT98",50,0)
 S SITE=0
"RTN","RGMTUT98",51,0)
 F  S SITE=$O(^HLMA("AC","I",SITE)) Q:'SITE  D  D WRT
"RTN","RGMTUT98",52,0)
 .K ARR
"RTN","RGMTUT98",53,0)
 .S MSG=0,CNT=0
"RTN","RGMTUT98",54,0)
 .F  S MSG=$O(^HLMA("AC","I",SITE,MSG)) Q:'MSG  D
"RTN","RGMTUT98",55,0)
 ..S CNT=CNT+1
"RTN","RGMTUT98",56,0)
 ..Q:'FLG
"RTN","RGMTUT98",57,0)
 ..S PROT=$$GET1^DIQ(773,MSG_",",8,"I")
"RTN","RGMTUT98",58,0)
 ..Q:'PROT
"RTN","RGMTUT98",59,0)
 ..I '$D(ARR(PROT)) S ARR(PROT)=0
"RTN","RGMTUT98",60,0)
 ..S ARR(PROT)=ARR(PROT)+1
"RTN","RGMTUT98",61,0)
 ;
"RTN","RGMTUT98",62,0)
QUIT K SITE,CNT,MSG,PROT,PROTNM,ARR,LINKNM,MISSP,MSG,GOT,INFLR
"RTN","RGMTUT98",63,0)
 K FLG,LINK,LOCSITE,QFLG,STATE,TXT1,TXT2,TXTCNT
"RTN","RGMTUT98",64,0)
 Q
"RTN","RGMTUT98",65,0)
 ;
"RTN","RGMTUT98",66,0)
PIV ;Count # of entries in pivot file xref
"RTN","RGMTUT98",67,0)
 S CNT=0,IEN=0 F  S IEN=$O(^VAT(391.71,"AXMIT",4,IEN)) Q:'IEN  S CNT=CNT+1
"RTN","RGMTUT98",68,0)
 S TXT="(Total DATA UPDATES waiting to be processed = "_CNT_")"
"RTN","RGMTUT98",69,0)
 I $D(RGHLMQ) S TXTCNT=TXTCNT+1,^XTMP("RGMT","HLMQMONT",LOCSITE,TXTCNT)=TXT
"RTN","RGMTUT98",70,0)
 I '$D(RGHLMQ) W !?3,TXT
"RTN","RGMTUT98",71,0)
 S CNT=0,IEN=0 F  S IEN=$O(^VAT(391.71,"AXMIT",5,IEN)) Q:'IEN  S CNT=CNT+1
"RTN","RGMTUT98",72,0)
 S TXT="(Total TREATING FACILITY UPDATES waiting to be processed = "_CNT_")"
"RTN","RGMTUT98",73,0)
 I $D(RGHLMQ) S TXTCNT=TXTCNT+1,^XTMP("RGMT","HLMQMONT",LOCSITE,TXTCNT)=TXT
"RTN","RGMTUT98",74,0)
 I '$D(RGHLMQ) W !?3,TXT
"RTN","RGMTUT98",75,0)
 K CNT,IEN,TXT
"RTN","RGMTUT98",76,0)
 Q
"RTN","RGMTUT98",77,0)
 ;
"RTN","RGMTUT98",78,0)
WRT ;write type and total for messages
"RTN","RGMTUT98",79,0)
 ;find current STATE of Link
"RTN","RGMTUT98",80,0)
 S STATE=$$GET1^DIQ(870,SITE_",",4)
"RTN","RGMTUT98",81,0)
 S TXT1=$$GET1^DIQ(870,SITE_",",.01)_" - "_CNT_" messages"_$S(FLG:":",1:".")
"RTN","RGMTUT98",82,0)
 S TXT2="STATE: "_STATE
"RTN","RGMTUT98",83,0)
 I $D(RGHLMQ) S TXTCNT=TXTCNT+1,^XTMP("RGMT","HLMQHLMA",LOCSITE,TXTCNT)=TXT1_"    "_TXT2
"RTN","RGMTUT98",84,0)
 I '$D(RGHLMQ) W !,TXT1,?30,TXT2
"RTN","RGMTUT98",85,0)
 Q:'FLG
"RTN","RGMTUT98",86,0)
 S PROT=0
"RTN","RGMTUT98",87,0)
 F  S PROT=$O(ARR(PROT)) Q:'PROT  D
"RTN","RGMTUT98",88,0)
 .S PROTNM=$P($G(^ORD(101,PROT,0)),"^") I PROTNM="" S PROTNM="PROTOCOL NOT FOUND"
"RTN","RGMTUT98",89,0)
 .I $D(RGHLMQ) S TXTCNT=TXTCNT+1,TXT=PROTNM_"  -  "_ARR(PROT),^XTMP("RGMT","HLMQHLMA",LOCSITE,TXTCNT)=TXT
"RTN","RGMTUT98",90,0)
 .I '$D(RGHLMQ) W !?3,PROTNM,?32," - ",$J(ARR(PROT),8)
"RTN","RGMTUT98",91,0)
 Q
"RTN","RGMTUT98",92,0)
 ;
"RTN","RGMTUT98",93,0)
CNT ;do counts
"RTN","RGMTUT98",94,0)
 D SCORE,ICN,LICN
"RTN","RGMTUT98",95,0)
 Q
"RTN","RGMTUT98",96,0)
SCORE ;count number of CMOR scores
"RTN","RGMTUT98",97,0)
 D NOW^%DTC
"RTN","RGMTUT98",98,0)
 W !,"<<Run - ",$$FMTE^XLFDT(%),">>"
"RTN","RGMTUT98",99,0)
 W !,"...counting number of CMOR scores"
"RTN","RGMTUT98",100,0)
 S SC=0,CNT=0
"RTN","RGMTUT98",101,0)
 F  S SC=$O(^DPT("ACMORS",SC)) Q:'SC  D
"RTN","RGMTUT98",102,0)
 .S DFN=0
"RTN","RGMTUT98",103,0)
 .F  S DFN=$O(^DPT("ACMORS",SC,DFN)) Q:'DFN  D
"RTN","RGMTUT98",104,0)
 ..S CNT=CNT+1
"RTN","RGMTUT98",105,0)
 W !?3,"(Current total # of Patients with CMOR Scores = ",CNT,")"
"RTN","RGMTUT98",106,0)
 K %,SC,CNT,DFN
"RTN","RGMTUT98",107,0)
 Q
"RTN","RGMTUT98",108,0)
 ;
"RTN","RGMTUT98",109,0)
ICN ;count number of ICNs
"RTN","RGMTUT98",110,0)
 S HOME=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTUT98",111,0)
 W !!,"...counting number of ICNs"
"RTN","RGMTUT98",112,0)
 S ICN=0,CNT=0
"RTN","RGMTUT98",113,0)
 F  S ICN=$O(^DPT("AICN",ICN)) Q:'ICN  D
"RTN","RGMTUT98",114,0)
 .Q:$E(ICN,1,3)=HOME
"RTN","RGMTUT98",115,0)
 .S CNT=CNT+1
"RTN","RGMTUT98",116,0)
 W !?3,"(Current total # of National ICNs = ",CNT,")"
"RTN","RGMTUT98",117,0)
 K HOME,ICN,CNT
"RTN","RGMTUT98",118,0)
 Q
"RTN","RGMTUT98",119,0)
 ;
"RTN","RGMTUT98",120,0)
LICN ;count number of local ICNs
"RTN","RGMTUT98",121,0)
 W !!,"...counting number of local ICNs"
"RTN","RGMTUT98",122,0)
 S ICN=0,CNT=0
"RTN","RGMTUT98",123,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGMTUT98",124,0)
 W !?3,"(Current total # of Local ICNs = ",CNT,")"
"RTN","RGMTUT98",125,0)
 K CNT,DFN,ICN
"RTN","RGMTUT98",126,0)
 Q
"RTN","RGP20PRE")
0^13^B2238126
"RTN","RGP20PRE",1,0)
RGP20PRE ;BIR/PTD-PATCH RG*1*20 PRE-INSTALL ROUTINE ;08/14/02
"RTN","RGP20PRE",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20**;30 Apr 99
"RTN","RGP20PRE",3,0)
 ;
"RTN","RGP20PRE",4,0)
 ;Reference to OPTION SCHEDULING (#19.2) file supported by IA #3599 and #3732
"RTN","RGP20PRE",5,0)
 ;
"RTN","RGP20PRE",6,0)
 ;Remove RGEQ AUTOSTART from OPTION SCHEDULING (#19.2) file.
"RTN","RGP20PRE",7,0)
 ;Is RGEQ AUTOSTART in the OPTION SCHEDULING (#19.2) file?
"RTN","RGP20PRE",8,0)
 N RGDA
"RTN","RGP20PRE",9,0)
 S DIC="^DIC(19.2,",X="RGEQ AUTOSTART" D ^DIC K DIC S (RGDA,DA)=+Y
"RTN","RGP20PRE",10,0)
 ;If RGEQ AUTOSTART not in OPTION SCHEDULING (#19.2) file.
"RTN","RGP20PRE",11,0)
 I RGDA'>0 D BMES^XPDUTL(" The RGEQ AUTOSTART task is not in the OPTION SCHEDULING (#19.2) file.") D MES^XPDUTL(" Pre-install routine completed successfully.") G QUIT
"RTN","RGP20PRE",12,0)
 ;Else task is in OPTION SCHEDULING (#19.2) file, so delete it.
"RTN","RGP20PRE",13,0)
 S DIK="^DIC(19.2," D ^DIK
"RTN","RGP20PRE",14,0)
 D BMES^XPDUTL(" RGEQ AUTOSTART has been deleted from the OPTION SCHEDULING (#19.2) file.")
"RTN","RGP20PRE",15,0)
 D MES^XPDUTL(" Pre-install routine completed successfully.")
"RTN","RGP20PRE",16,0)
QUIT ;Turn off event queue, kill variables and quit
"RTN","RGP20PRE",17,0)
 S ^RGEQ("ASTOP")="YES"
"RTN","RGP20PRE",18,0)
 K DA,DIC,DIK,RGDA,X,Y
"RTN","RGP20PRE",19,0)
 Q
"RTN","RGP20PRE",20,0)
 ;
"RTN","RGSYSTAT")
0^11^B16713302
"RTN","RGSYSTAT",1,0)
RGSYSTAT ;BAY/ALS-MPI/PD STATUS DISPLAY ;01/05/01
"RTN","RGSYSTAT",2,0)
 ;;1.0;CLINCAL INFO RESOURCE NETWORK;**16,19,23,25,20**;30 Apr 99
"RTN","RGSYSTAT",3,0)
 ;Reference to ^DGCN(391.98,"AST" supported by IA #3303
"RTN","RGSYSTAT",4,0)
 ;Reference to ^DGCN(391.984 supported by IA #3304
"RTN","RGSYSTAT",5,0)
 ;Reference to ^MPIF(984.9 supported by IA #3298
"RTN","RGSYSTAT",6,0)
 ;Reference to OPTSTAT^XUTMOPT supported by IA #1472
"RTN","RGSYSTAT",7,0)
 ;Reference to ^DPT("ACMORS", ^DPT("AICN", and ^DPT("AICNL" supported by IA #2070
"RTN","RGSYSTAT",8,0)
 ;Reference to ^VAT(391.71 supported by IA #3422
"RTN","RGSYSTAT",9,0)
EN ;
"RTN","RGSYSTAT",10,0)
 ; Count exceptions on hand
"RTN","RGSYSTAT",11,0)
EXC ;
"RTN","RGSYSTAT",12,0)
 W @IOF,"Exception Handler Entries:",!,"--------------------------"
"RTN","RGSYSTAT",13,0)
 S CNT=0,EXCTYP="",NTYP="",TOTL=0,PCNT=0
"RTN","RGSYSTAT",14,0)
 N STAT,DFN,ICN
"RTN","RGSYSTAT",15,0)
 S HOME=$$SITE^VASITE()
"RTN","RGSYSTAT",16,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGSYSTAT",17,0)
 . I (EXCTYP=209)!(EXCTYP=227)!((EXCTYP>212)&(EXCTYP<219)) D
"RTN","RGSYSTAT",18,0)
 .. I (EXCTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",19,0)
 ... S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",20,0)
 ... W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",21,0)
 .. S IEN=0,NTYP=EXCTYP
"RTN","RGSYSTAT",22,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",23,0)
 ... S IEN2=0
"RTN","RGSYSTAT",24,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGSYSTAT",25,0)
 .... S STAT=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5) I STAT<1 D
"RTN","RGSYSTAT",26,0)
 ..... S DFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'DFN
"RTN","RGSYSTAT",27,0)
 ..... S ^XTMP("RGEXC",0)=$$FMADD^XLFDT(DT,2)_"^"_DT_"^"_"MPI/PD Status Display"
"RTN","RGSYSTAT",28,0)
 ..... S ^XTMP("RGEXC",DFN)=DFN
"RTN","RGSYSTAT",29,0)
 ..... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGSYSTAT",30,0)
 ..... I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!((EXCTYP<218)&(EXCTYP>214)) D
"RTN","RGSYSTAT",31,0)
 ...... S CNT=CNT+1
"RTN","RGSYSTAT",32,0)
 I CNT>0 D
"RTN","RGSYSTAT",33,0)
 .S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",34,0)
 .W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",35,0)
 I TOTL=0 W !,"There are no entries in the Exception Handler."
"RTN","RGSYSTAT",36,0)
 I TOTL>0 D
"RTN","RGSYSTAT",37,0)
 . W !!,"Total number of exceptions: ",?55,$J(TOTL,6)
"RTN","RGSYSTAT",38,0)
 . S PDFN=""
"RTN","RGSYSTAT",39,0)
 . F  S PDFN=$O(^XTMP("RGEXC",PDFN)) Q:'PDFN  D
"RTN","RGSYSTAT",40,0)
 .. S PCNT=PCNT+1
"RTN","RGSYSTAT",41,0)
 . W !,"Total unique patient exceptions: ",?55,$J(PCNT,6)
"RTN","RGSYSTAT",42,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGSYSTAT",43,0)
 I $D(^RGSITE(991.8,1,"EXCPRG")) D
"RTN","RGSYSTAT",44,0)
 . S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGSYSTAT",45,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGSYSTAT",46,0)
 K CNT,EXCTYP,NTYP,ETEXT,TOTL,IEN,IEN2,HOME,PCNT,^XTMP("RGEXC"),PDFN,STDT
"RTN","RGSYSTAT",47,0)
 I $Y>21 D QUIT Q:X="^"
"RTN","RGSYSTAT",48,0)
PDR ;Count entries in Patient Data Review
"RTN","RGSYSTAT",49,0)
 W !!,"Patient Data Review Entries:",!,"----------------------------"
"RTN","RGSYSTAT",50,0)
 S CNT=0,PDRTYP="",NTYP="",TOTL=0
"RTN","RGSYSTAT",51,0)
 F  S PDRTYP=$O(^DGCN(391.98,"AST",PDRTYP)) Q:'PDRTYP  D
"RTN","RGSYSTAT",52,0)
 . I (PDRTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",53,0)
 .. S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="RGPDR"
"RTN","RGSYSTAT",54,0)
 .. D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",55,0)
 .. S PTEXT=$G(RGPDR(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",56,0)
 .. W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",57,0)
 . I (PDRTYP=1)!(PDRTYP=2)!(PDRTYP=5) D
"RTN","RGSYSTAT",58,0)
 .. S IEN=0,NTYP=PDRTYP
"RTN","RGSYSTAT",59,0)
 .. F  S IEN=$O(^DGCN(391.98,"AST",PDRTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",60,0)
 ... S CNT=CNT+1
"RTN","RGSYSTAT",61,0)
 I CNT>0 D
"RTN","RGSYSTAT",62,0)
 . S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="RGPDR"
"RTN","RGSYSTAT",63,0)
 . D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",64,0)
 . S PTEXT=$G(RGPDR(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",65,0)
 .W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",66,0)
 I TOTL=0 W !,"There are no entries in Patient Data Review."
"RTN","RGSYSTAT",67,0)
 K CNT,PDRTYP,NTYP,TOTL,IEN,PTEXT,RGPDR
"RTN","RGSYSTAT",68,0)
 ;Q
"RTN","RGSYSTAT",69,0)
 I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",70,0)
 ;
"RTN","RGSYSTAT",71,0)
CMOR ;CMOR Requests Status
"RTN","RGSYSTAT",72,0)
 W !!,"CMOR Requests Status:",!,"---------------------"
"RTN","RGSYSTAT",73,0)
 S CNT=0,STAT="",NSTAT="",TOTL=0
"RTN","RGSYSTAT",74,0)
 F  S STAT=$O(^MPIF(984.9,"AC",STAT)) Q:'STAT  D
"RTN","RGSYSTAT",75,0)
 . I (STAT'=NSTAT)&(CNT>0) D
"RTN","RGSYSTAT",76,0)
 .. S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT)
"RTN","RGSYSTAT",77,0)
 .. W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",78,0)
 . S IEN=0,NSTAT=STAT
"RTN","RGSYSTAT",79,0)
 . F  S IEN=$O(^MPIF(984.9,"AC",STAT,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",80,0)
 .. S CNT=CNT+1 S TOTL=TOTL+CNT
"RTN","RGSYSTAT",81,0)
 I CNT>0 S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT) W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",82,0)
 I TOTL=0 W !,"There are no outstanding CMOR Requests."
"RTN","RGSYSTAT",83,0)
 K CNT,STAT,NSTAT,TEXT,TOTL,IEN
"RTN","RGSYSTAT",84,0)
 I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",85,0)
 ;
"RTN","RGSYSTAT",86,0)
 S HOME=$P($$SITE^VASITE(),"^",3)
"RTN","RGSYSTAT",87,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",88,0)
 F  S ICN=$O(^DPT("AICN",ICN)) Q:'ICN  D
"RTN","RGSYSTAT",89,0)
 .Q:$E(ICN,1,3)=HOME
"RTN","RGSYSTAT",90,0)
 .S CNT=CNT+1
"RTN","RGSYSTAT",91,0)
 W !,"Current total number of National ICNs = ",CNT
"RTN","RGSYSTAT",92,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",93,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGSYSTAT",94,0)
 W !,"Current total number of Local ICNs = ",CNT
"RTN","RGSYSTAT",95,0)
 K CNT,DFN,ICN
"RTN","RGSYSTAT",96,0)
 Q
"RTN","RGSYSTAT",97,0)
QUIT S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGSYSTAT",98,0)
 .S SS=21-$Y F JJ=1:1:SS W !
"RTN","RGSYSTAT",99,0)
 S $Y=0
"RTN","RGSYSTAT",100,0)
 K JJ,SS
"RTN","RGSYSTAT",101,0)
 Q
"VER")
8.0^22.0
**END**
**END**
