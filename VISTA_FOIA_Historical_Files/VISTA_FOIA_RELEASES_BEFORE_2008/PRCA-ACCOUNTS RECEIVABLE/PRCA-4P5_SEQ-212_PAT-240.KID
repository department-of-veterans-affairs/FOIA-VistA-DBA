EMERGENCY Released PRCA*4.5*240 SEQ #212
Extracted from mail message
**KIDS**:PRCA*4.5*240^

**INSTALL NAME**
PRCA*4.5*240
"BLD",6463,0)
PRCA*4.5*240^ACCOUNTS RECEIVABLE^0^3060201^y
"BLD",6463,1,0)
^^9^9^3060201^
"BLD",6463,1,1,0)
This patch fixes 2 errors:
"BLD",6463,1,2,0)
 
"BLD",6463,1,3,0)
     1.An error in routine RCXVDC5 that caused the refill date of
"BLD",6463,1,4,0)
       prescriptions to not transmit.
"BLD",6463,1,5,0)
     2.An error in routine RCXVDEQ that prevented some transactions and
"BLD",6463,1,6,0)
       bills from transmitting to the ARC.
"BLD",6463,1,7,0)
 
"BLD",6463,1,8,0)
It also queues the Active Bill transmission to the ARC at 8pm on the 
"BLD",6463,1,9,0)
date of the installation.
"BLD",6463,4,0)
^9.64PA^^
"BLD",6463,"ABPKG")
n
"BLD",6463,"INIT")
EN^RCXVP240
"BLD",6463,"KRN",0)
^9.67PA^8989.52^19
"BLD",6463,"KRN",.4,0)
.4
"BLD",6463,"KRN",.401,0)
.401
"BLD",6463,"KRN",.402,0)
.402
"BLD",6463,"KRN",.403,0)
.403
"BLD",6463,"KRN",.5,0)
.5
"BLD",6463,"KRN",.84,0)
.84
"BLD",6463,"KRN",3.6,0)
3.6
"BLD",6463,"KRN",3.8,0)
3.8
"BLD",6463,"KRN",9.2,0)
9.2
"BLD",6463,"KRN",9.8,0)
9.8
"BLD",6463,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6463,"KRN",9.8,"NM",1,0)
RCXVDC5^^0^B11213461
"BLD",6463,"KRN",9.8,"NM",2,0)
RCXVDEQ^^0^B14830955
"BLD",6463,"KRN",9.8,"NM",3,0)
RCXVP240^^0^B433207
"BLD",6463,"KRN",9.8,"NM","B","RCXVDC5",1)

"BLD",6463,"KRN",9.8,"NM","B","RCXVDEQ",2)

"BLD",6463,"KRN",9.8,"NM","B","RCXVP240",3)

"BLD",6463,"KRN",19,0)
19
"BLD",6463,"KRN",19.1,0)
19.1
"BLD",6463,"KRN",101,0)
101
"BLD",6463,"KRN",409.61,0)
409.61
"BLD",6463,"KRN",771,0)
771
"BLD",6463,"KRN",870,0)
870
"BLD",6463,"KRN",8989.51,0)
8989.51
"BLD",6463,"KRN",8989.52,0)
8989.52
"BLD",6463,"KRN",8994,0)
8994
"BLD",6463,"KRN","B",.4,.4)

"BLD",6463,"KRN","B",.401,.401)

"BLD",6463,"KRN","B",.402,.402)

"BLD",6463,"KRN","B",.403,.403)

"BLD",6463,"KRN","B",.5,.5)

"BLD",6463,"KRN","B",.84,.84)

"BLD",6463,"KRN","B",3.6,3.6)

"BLD",6463,"KRN","B",3.8,3.8)

"BLD",6463,"KRN","B",9.2,9.2)

"BLD",6463,"KRN","B",9.8,9.8)

"BLD",6463,"KRN","B",19,19)

"BLD",6463,"KRN","B",19.1,19.1)

"BLD",6463,"KRN","B",101,101)

"BLD",6463,"KRN","B",409.61,409.61)

"BLD",6463,"KRN","B",771,771)

"BLD",6463,"KRN","B",870,870)

"BLD",6463,"KRN","B",8989.51,8989.51)

"BLD",6463,"KRN","B",8989.52,8989.52)

"BLD",6463,"KRN","B",8994,8994)

"BLD",6463,"QUES",0)
^9.62^^
"BLD",6463,"REQB",0)
^9.611^3^3
"BLD",6463,"REQB",1,0)
PRCA*4.5*201^2
"BLD",6463,"REQB",2,0)
PRCA*4.5*227^2
"BLD",6463,"REQB",3,0)
PRCA*4.5*228^2
"BLD",6463,"REQB","B","PRCA*4.5*201",1)

"BLD",6463,"REQB","B","PRCA*4.5*227",2)

"BLD",6463,"REQB","B","PRCA*4.5*228",3)

"INIT")
EN^RCXVP240
"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
240^3060201
"PKG",142,22,1,"PAH",1,1,0)
^^9^9^3060201
"PKG",142,22,1,"PAH",1,1,1,0)
This patch fixes 2 errors:
"PKG",142,22,1,"PAH",1,1,2,0)
 
"PKG",142,22,1,"PAH",1,1,3,0)
     1.An error in routine RCXVDC5 that caused the refill date of
"PKG",142,22,1,"PAH",1,1,4,0)
       prescriptions to not transmit.
"PKG",142,22,1,"PAH",1,1,5,0)
     2.An error in routine RCXVDEQ that prevented some transactions and
"PKG",142,22,1,"PAH",1,1,6,0)
       bills from transmitting to the ARC.
"PKG",142,22,1,"PAH",1,1,7,0)
 
"PKG",142,22,1,"PAH",1,1,8,0)
It also queues the Active Bill transmission to the ARC at 8pm on the 
"PKG",142,22,1,"PAH",1,1,9,0)
date of the installation.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RCXVDC5")
0^1^B11213461
"RTN","RCXVDC5",1,0)
RCXVDC5 ;DAOU/ALA-AR Data Extraction Data Creation ;02-JUL-03
"RTN","RCXVDC5",2,0)
 ;;4.5;Accounts Receivable;**201,227,228,240**;Mar 20, 1995
"RTN","RCXVDC5",3,0)
 ;
"RTN","RCXVDC5",4,0)
 ; Integrated Billing Action File (# 350) 
"RTN","RCXVDC5",5,0)
 Q
"RTN","RCXVDC5",6,0)
D350 ; 
"RTN","RCXVDC5",7,0)
 NEW RCXVD,RCXVDA,RCXVDB,RCXVD0A,RCXVDT,RCXVP1,RCXVP2,RCXVPC,RCT
"RTN","RCXVDC5",8,0)
 S RCXVD0A="",RCT=0
"RTN","RCXVDC5",9,0)
 F  S RCXVD0A=$O(^IB("ABIL",RCXVBLNA,RCXVD0A)) Q:RCXVD0A=""  D
"RTN","RCXVDC5",10,0)
 . S RCXVD=$G(^IB(RCXVD0A,0))
"RTN","RCXVDC5",11,0)
 . I $G(DFN)="" S DFN=$P(RCXVD,U,2)
"RTN","RCXVDC5",12,0)
 . ;
"RTN","RCXVDC5",13,0)
 . S RCXVDA=RCXVBLNA_RCXVU_$P(RCXVD,U,1)
"RTN","RCXVDC5",14,0)
 . S RCXVDA=RCXVDA_RCXVU_$$GET1^DIQ(350,RCXVD0A_",",.05,"E")
"RTN","RCXVDC5",15,0)
 . S RCXVP1=$P(RCXVD,U,3),RCXVP2=""
"RTN","RCXVDC5",16,0)
 . I RCXVP1'="" S RCXVP2=$P($G(^IBE(350.1,RCXVP1,0)),U,1)
"RTN","RCXVDC5",17,0)
 . S RCXVDA=RCXVDA_RCXVU_RCXVP2 ; ACTION TYPE (P)
"RTN","RCXVDC5",18,0)
 . S RCXVDA=RCXVDA_RCXVU_$P(RCXVD,U,6) ; UNITS
"RTN","RCXVDC5",19,0)
 . S RCXVDA=RCXVDA_RCXVU_$P(RCXVD,U,7) ; TOTAL CHARGE
"RTN","RCXVDC5",20,0)
 . S RCXVDT=$P(RCXVD,U,14)
"RTN","RCXVDC5",21,0)
 . S RCXVDA=RCXVDA_RCXVU_$E($$HLDATE^HLFNC(RCXVDT),1,8) ; DT BILLD FROM
"RTN","RCXVDC5",22,0)
 . S RCXVDT=$P(RCXVD,U,15)
"RTN","RCXVDC5",23,0)
 . S RCXVDA=RCXVDA_RCXVU_$E($$HLDATE^HLFNC(RCXVDT),1,8) ; DT BILLD TO
"RTN","RCXVDC5",24,0)
 . S RCXVDA=RCXVDA_RCXVU_$P(RCXVD,U,11) ; AR BILL #
"RTN","RCXVDC5",25,0)
 . S RCXVDT=$P($P($G(^IB(RCXVD0A,1)),U,2),".",1)
"RTN","RCXVDC5",26,0)
 . S RCXVDA=RCXVDA_RCXVU_$E($$HLDATE^HLFNC(RCXVDT),1,8) ; DT ENTRY ADDED
"RTN","RCXVDC5",27,0)
 . S RCXVDA=RCXVDA_RCXVU_$P($G(^DPT(DFN,0)),U,9) ; SSN
"RTN","RCXVDC5",28,0)
 . S RCXVDT=$P(RCXVD,U,17)
"RTN","RCXVDC5",29,0)
 . S RCXVDA=RCXVDA_RCXVU_$E($$HLDATE^HLFNC(RCXVDT),1,8) ; EVENT DT
"RTN","RCXVDC5",30,0)
 . S RCXVDT=$$PRESC($P(RCXVD,U,4))
"RTN","RCXVDC5",31,0)
 . S RCXVDA=RCXVDA_RCXVU_$E($$HLDATE^HLFNC(RCXVDT),1,8) ;FILL/REFILL DATE
"RTN","RCXVDC5",32,0)
 . S RCXVDA=RCXVDA_RCXVU_$$SITE(RCXVD0A,1) ;DIVISION WHERE CARE RENDERED
"RTN","RCXVDC5",33,0)
 . S RCT=RCT+1
"RTN","RCXVDC5",34,0)
 . S ^TMP($J,RCXVBLN,"5-350A",RCT)=RCXVDA
"RTN","RCXVDC5",35,0)
 Q
"RTN","RCXVDC5",36,0)
 ;
"RTN","RCXVDC5",37,0)
PRESC(RCPC4) ;Calculates prescription fill/refill date
"RTN","RCXVDC5",38,0)
 ; Input is resulting from field (4th piece of 0 node) in 350
"RTN","RCXVDC5",39,0)
 ; Output is fill/refill date in fileman format
"RTN","RCXVDC5",40,0)
 N RCRXN,RCRF,RCENS,RCPRDT
"RTN","RCXVDC5",41,0)
 S RCPRDT=""
"RTN","RCXVDC5",42,0)
 I $P(RCPC4,":")'=52 Q RCPRDT
"RTN","RCXVDC5",43,0)
 S RCRXN=+$P(RCPC4,":",2),RCRF=$P(RCPC4,":",3)
"RTN","RCXVDC5",44,0)
 I RCRF>0 S RCENS=+RCRF_","_+RCRXN_",",RCPRDT=$$GET1^DIQ(52.1,RCENS,17,"I"),RCPRDT=$P(RCPRDT,".")
"RTN","RCXVDC5",45,0)
 E  S RCENS=+RCRXN_",",RCPRDT=$$GET1^DIQ(52,RCENS,31,"I"),RCPRDT=$P(RCPRDT,".")
"RTN","RCXVDC5",46,0)
 Q RCPRDT
"RTN","RCXVDC5",47,0)
SITE(IIEN,FLG) ;  Find the Care Site for Co-Pays
"RTN","RCXVDC5",48,0)
 ;  Input Parameters
"RTN","RCXVDC5",49,0)
 ;    IIEN = Internal Entry Number for IB ACTION #350
"RTN","RCXVDC5",50,0)
 ;    FLG = 1=Division Name,2=Facility Number
"RTN","RCXVDC5",51,0)
 ;
"RTN","RCXVDC5",52,0)
 NEW VDIV,VFAC,VWIEN,VWFIL,VVIS,VLOC,VWARD,VLVAL,VWHER
"RTN","RCXVDC5",53,0)
 S VWHER=$P(^IB(IIEN,0),U,4)
"RTN","RCXVDC5",54,0)
 ;
"RTN","RCXVDC5",55,0)
 I VWHER="" Q ""
"RTN","RCXVDC5",56,0)
 ;
"RTN","RCXVDC5",57,0)
 S VWFIL=$P(VWHER,":",1),VWIEN=$P(VWHER,":",2)
"RTN","RCXVDC5",58,0)
 I VWIEN[";" S VWIEN=$P(VWIEN,";",1)
"RTN","RCXVDC5",59,0)
 ;
"RTN","RCXVDC5",60,0)
 S VLVAL=""
"RTN","RCXVDC5",61,0)
MV I VWFIL=405 D
"RTN","RCXVDC5",62,0)
 . I VWIEN="" Q
"RTN","RCXVDC5",63,0)
 . S VWARD=$P($G(^DGPM(VWIEN,0)),U,6)
"RTN","RCXVDC5",64,0)
 . I VWARD="" Q
"RTN","RCXVDC5",65,0)
 . S VLOC=$P($G(^DIC(42,VWARD,44)),U,1)
"RTN","RCXVDC5",66,0)
 . I VLOC="" Q
"RTN","RCXVDC5",67,0)
 . S VDIV=$P($G(^SC(VLOC,0)),U,15)
"RTN","RCXVDC5",68,0)
 . I VDIV="" Q
"RTN","RCXVDC5",69,0)
 . D VLU
"RTN","RCXVDC5",70,0)
 ;
"RTN","RCXVDC5",71,0)
OP I VWFIL=409.68 D
"RTN","RCXVDC5",72,0)
 . S VLOC=$P($G(^SCE(VWIEN,0)),U,4)
"RTN","RCXVDC5",73,0)
 . I VLOC="" D
"RTN","RCXVDC5",74,0)
 .. S VVIS=$P($G(^SCE(VWIEN,0)),U,5)
"RTN","RCXVDC5",75,0)
 .. I VVIS="" Q
"RTN","RCXVDC5",76,0)
 .. S VLOC=$P($G(^AUPNVSIT(VVIS,0)),U,22)
"RTN","RCXVDC5",77,0)
 . I VLOC="" Q
"RTN","RCXVDC5",78,0)
 . S VDIV=$P($G(^SC(VLOC,0)),U,15)
"RTN","RCXVDC5",79,0)
 . I VDIV="" Q
"RTN","RCXVDC5",80,0)
 . D VLU
"RTN","RCXVDC5",81,0)
 ;
"RTN","RCXVDC5",82,0)
RX I VWFIL=52 D
"RTN","RCXVDC5",83,0)
 . S VLOC=$$GET1^DIQ(52,VWIEN_",",5,"I")
"RTN","RCXVDC5",84,0)
 . I VLOC="" Q
"RTN","RCXVDC5",85,0)
 . S VDIV=$P($G(^SC(VLOC,0)),U,15)
"RTN","RCXVDC5",86,0)
 . I VDIV="" Q
"RTN","RCXVDC5",87,0)
 . D VLU
"RTN","RCXVDC5",88,0)
 ;
"RTN","RCXVDC5",89,0)
LC I VWFIL=44 D
"RTN","RCXVDC5",90,0)
 . S VDIV=$P($G(^SC(VWIEN,0)),U,15)
"RTN","RCXVDC5",91,0)
 . I VDIV="" Q
"RTN","RCXVDC5",92,0)
 . D VLU
"RTN","RCXVDC5",93,0)
 ;
"RTN","RCXVDC5",94,0)
IB I VWFIL=350 D
"RTN","RCXVDC5",95,0)
 . S VFAC=$P($G(^IB(VWIEN,0)),U,13)
"RTN","RCXVDC5",96,0)
 . I VFAC="" Q
"RTN","RCXVDC5",97,0)
 . S VDIV=$O(^DG(40.8,"C",VFAC,""))
"RTN","RCXVDC5",98,0)
 . I VDIV="" Q
"RTN","RCXVDC5",99,0)
 . D VLU
"RTN","RCXVDC5",100,0)
 ;
"RTN","RCXVDC5",101,0)
 Q VLVAL
"RTN","RCXVDC5",102,0)
 ;
"RTN","RCXVDC5",103,0)
VLU I FLG=1 S VLVAL=$P(^DG(40.8,VDIV,0),U,1)
"RTN","RCXVDC5",104,0)
 I FLG=2 S VLVAL=$P(^DG(40.8,VDIV,0),U,2)
"RTN","RCXVDC5",105,0)
 Q
"RTN","RCXVDEQ")
0^2^B14830955
"RTN","RCXVDEQ",1,0)
RCXVDEQ ;DAOU/ALA-AR Data Extract Queue Trigger ;02-JUL-03
"RTN","RCXVDEQ",2,0)
 ;;4.5;Accounts Receivable;**201,228,240**;Mar 20, 1995
"RTN","RCXVDEQ",3,0)
 ;
"RTN","RCXVDEQ",4,0)
 ;**Program Description**
"RTN","RCXVDEQ",5,0)
 ;  This program will log a record who meets the
"RTN","RCXVDEQ",6,0)
 ;  selection criteria for the VISTA Data Extract
"RTN","RCXVDEQ",7,0)
 ;
"RTN","RCXVDEQ",8,0)
AR ;  Triggers from the Accounts Receivable File (#430)
"RTN","RCXVDEQ",9,0)
 NEW DFN
"RTN","RCXVDEQ",10,0)
 ;
"RTN","RCXVDEQ",11,0)
 S RCXVBLN=D0,RCXVSTAT=$P(^PRCA(430,D0,0),U,8)
"RTN","RCXVDEQ",12,0)
 I '+$P(^PRCA(430.3,RCXVSTAT,0),U,6) Q
"RTN","RCXVDEQ",13,0)
 ;
"RTN","RCXVDEQ",14,0)
 S DFN=$P(^PRCA(430,D0,0),U,7)
"RTN","RCXVDEQ",15,0)
 D FIL("D")
"RTN","RCXVDEQ",16,0)
 ;
"RTN","RCXVDEQ",17,0)
 K RCXVBLN,RCXVSTAT
"RTN","RCXVDEQ",18,0)
 Q
"RTN","RCXVDEQ",19,0)
 ;
"RTN","RCXVDEQ",20,0)
AT ;  Triggers from the Accounts Receivable Transactions (#433)
"RTN","RCXVDEQ",21,0)
 NEW DFN
"RTN","RCXVDEQ",22,0)
 ;
"RTN","RCXVDEQ",23,0)
 S RCXVBLN=$P($G(^PRCA(433,D0,0)),U,2)
"RTN","RCXVDEQ",24,0)
 S RCXVTYP=$P($G(^PRCA(433,D0,1)),U,2)
"RTN","RCXVDEQ",25,0)
 I RCXVTYP="" Q
"RTN","RCXVDEQ",26,0)
 ;
"RTN","RCXVDEQ",27,0)
 I '+$P(^PRCA(430.3,RCXVTYP,0),U,6) Q
"RTN","RCXVDEQ",28,0)
 ;
"RTN","RCXVDEQ",29,0)
 S DFN=$P(^PRCA(430,RCXVBLN,0),U,7)
"RTN","RCXVDEQ",30,0)
 D FIL("D")
"RTN","RCXVDEQ",31,0)
 ;
"RTN","RCXVDEQ",32,0)
 K RCXVBLN,RCXVTYP
"RTN","RCXVDEQ",33,0)
 Q
"RTN","RCXVDEQ",34,0)
 ;
"RTN","RCXVDEQ",35,0)
FIL(RCXVBTY) ;  File the record into the AR Data Queue File (#348.4)
"RTN","RCXVDEQ",36,0)
 ;
"RTN","RCXVDEQ",37,0)
 ;  If a test system has 'turned off' extract, quit
"RTN","RCXVDEQ",38,0)
 I '$$GET1^DIQ(342,"1,",20.04,"I") Q
"RTN","RCXVDEQ",39,0)
 ;
"RTN","RCXVDEQ",40,0)
 ;  Input Parameter
"RTN","RCXVDEQ",41,0)
 ;    RCXVBTY = Batch Type (H=Historical, D=Daily, C=Current Fiscal Year, A=Active,E=FY05 DATA)
"RTN","RCXVDEQ",42,0)
 ;    RCXVBLN = Bill IEN
"RTN","RCXVDEQ",43,0)
 ;
"RTN","RCXVDEQ",44,0)
 N FDA,RCXVCURB,RCVXBNM,RCVXBMX
"RTN","RCXVDEQ",45,0)
 ; 
"RTN","RCXVDEQ",46,0)
 ; Where there has been any update/change to the system 
"RTN","RCXVDEQ",47,0)
 ; for a particular bill for the previous days business business (T-1). 
"RTN","RCXVDEQ",48,0)
 ;
"RTN","RCXVDEQ",49,0)
 ; Get current batch
"RTN","RCXVDEQ",50,0)
BTC K ^TMP("RCXVA",$J)
"RTN","RCXVDEQ",51,0)
 D FIND^DIC(348.4,"","","P",DT,"","C","I $P(^(0),U,4)=RCXVBTY","","^TMP(""RCXVA"",$J)")
"RTN","RCXVDEQ",52,0)
 S RCXVCURB=+$P($G(^TMP("RCXVA",$J,"DILIST",0)),U,1)
"RTN","RCXVDEQ",53,0)
 S RCVXCTY="",RCXVBDT="",RCXQFL=0
"RTN","RCXVDEQ",54,0)
 ;
"RTN","RCXVDEQ",55,0)
 ;  If there is no batch for today, create a new batch
"RTN","RCXVDEQ",56,0)
 I RCXVCURB=0 D NBT G CON:'RCXQFL,BTC
"RTN","RCXVDEQ",57,0)
 ;
"RTN","RCXVDEQ",58,0)
 ; Check to see if batch is full.
"RTN","RCXVDEQ",59,0)
 S RCXVCURB=$P(^TMP("RCXVA",$J,"DILIST",RCXVCURB,0),U,1)
"RTN","RCXVDEQ",60,0)
 I RCXVCURB'=0 D
"RTN","RCXVDEQ",61,0)
 . S RCVXBNM=$P($G(^RCXV(RCXVCURB,0)),U,7) ; Number of record in batch
"RTN","RCXVDEQ",62,0)
 . S RCVXCTY=$P($G(^RCXV(RCXVCURB,0)),U,4) ; Current batch type
"RTN","RCXVDEQ",63,0)
 . S RCXVBDT=$P($G(^RCXV(RCXVCURB,0)),U,2) ; Batch Date
"RTN","RCXVDEQ",64,0)
 . S RCXVBST=$P($G(^RCXV(RCXVCURB,0)),U,3) ; Batch Status
"RTN","RCXVDEQ",65,0)
 S RCVXBMX=$P($G(^RC(342,1,20)),U,5) ; Max. # of record per batch
"RTN","RCXVDEQ",66,0)
 ;  OR if the number of records in batch exceeds the
"RTN","RCXVDEQ",67,0)
 ;  maximum number of records per batch --> create new batch
"RTN","RCXVDEQ",68,0)
 I (RCVXBNM>RCVXBMX)!(RCVXBNM=RCVXBMX)!(RCXVBST="T")!(RCXVBST="C") D NBT G BTC:RCXQFL=1
"RTN","RCXVDEQ",69,0)
 ;
"RTN","RCXVDEQ",70,0)
CON ;  Continue with updating the AR Data Queue file
"RTN","RCXVDEQ",71,0)
 S RCXVDA=$S($G(RCXVCURB)'=0:RCXVCURB,1:RCXVDA)
"RTN","RCXVDEQ",72,0)
 ;
"RTN","RCXVDEQ",73,0)
 ;  If the Batch Type is 'R', quit
"RTN","RCXVDEQ",74,0)
 I RCXVBTY="R" Q
"RTN","RCXVDEQ",75,0)
 ;
"RTN","RCXVDEQ",76,0)
 ;  If this bill number already exists in this batch, quit
"RTN","RCXVDEQ",77,0)
 I $D(^RCXV(RCXVDA,1,RCXVBLN)) Q
"RTN","RCXVDEQ",78,0)
 ;
"RTN","RCXVDEQ",79,0)
 ; File record
"RTN","RCXVDEQ",80,0)
 NEW DIC,DIE,X,DA,DLAYGO,Y,DINUM
"RTN","RCXVDEQ",81,0)
 S DA(1)=RCXVDA,DIC="^RCXV("_DA(1)_",1,",DIE=DIC,(X,DINUM)=RCXVBLN
"RTN","RCXVDEQ",82,0)
 S DLAYGO=348.41,DIC(0)="L",DIC("P")=DLAYGO
"RTN","RCXVDEQ",83,0)
 I '$D(^RCXV(DA(1),1,0)) S ^RCXV(DA(1),1,0)="^348.41^^"
"RTN","RCXVDEQ",84,0)
 D FILE^DICN
"RTN","RCXVDEQ",85,0)
 ;
"RTN","RCXVDEQ",86,0)
 S RCUPD(348.4,RCXVDA_",",.07)=(RCVXBNM+1)
"RTN","RCXVDEQ",87,0)
 S RCUPD(348.41,RCXVBLN_","_RCXVDA_",",.02)=$G(DFN)
"RTN","RCXVDEQ",88,0)
 D FILE^DIE("","RCUPD","RCXVERR")
"RTN","RCXVDEQ",89,0)
 ;
"RTN","RCXVDEQ",90,0)
 K RCXVDA,RCVXBNM,RCXVBLN,RCXVCURB,RCXVBTY,RCVXBMX,RCVXCTY,RCXVBDT
"RTN","RCXVDEQ",91,0)
 K ^TMP("RCXVA",$J),IENARRAY,RCXVBST,RCUPD,RCXVERR,RCXQFL
"RTN","RCXVDEQ",92,0)
 Q
"RTN","RCXVDEQ",93,0)
 ;
"RTN","RCXVDEQ",94,0)
NBT ;  Create a new batch
"RTN","RCXVDEQ",95,0)
 N $ES,$ET
"RTN","RCXVDEQ",96,0)
 S $ET="D ER^RCXVDEQ"
"RTN","RCXVDEQ",97,0)
 L +^RCXVLK:1 E  S RCXQFL=1 Q
"RTN","RCXVDEQ",98,0)
 S RCXVCURB=$P(^RCXV(0),U,3)+1
"RTN","RCXVDEQ",99,0)
 S RCVXBNM=0
"RTN","RCXVDEQ",100,0)
 S FDA(348.4,"+1,",.01)=RCXVCURB
"RTN","RCXVDEQ",101,0)
 S FDA(348.4,"+1,",.02)=DT
"RTN","RCXVDEQ",102,0)
 S FDA(348.4,"+1,",.03)="P"
"RTN","RCXVDEQ",103,0)
 S FDA(348.4,"+1,",.04)=RCXVBTY
"RTN","RCXVDEQ",104,0)
 S FDA(348.4,"+1,",.07)=RCVXBNM
"RTN","RCXVDEQ",105,0)
 D UPDATE^DIE("","FDA","IENARRAY","ERROR")
"RTN","RCXVDEQ",106,0)
 I '$D(ERROR) S RCXVDA=$G(IENARRAY(1))
"RTN","RCXVDEQ",107,0)
 L -^RCXVLK
"RTN","RCXVDEQ",108,0)
 Q
"RTN","RCXVDEQ",109,0)
 ;
"RTN","RCXVDEQ",110,0)
UDR ;  Update Deposits/Receipts subfile
"RTN","RCXVDEQ",111,0)
 ; If this batch payment number already exists in this batch, quit
"RTN","RCXVDEQ",112,0)
 I $D(^RCXV(RCXVDA,2,RCXVD0)) Q
"RTN","RCXVDEQ",113,0)
 ;
"RTN","RCXVDEQ",114,0)
 ; File record
"RTN","RCXVDEQ",115,0)
 NEW DIC,DIE,X,DA,DLAYGO,Y,DINUM
"RTN","RCXVDEQ",116,0)
 S DA(1)=RCXVDA,DIC="^RCXV("_DA(1)_",2,",DIE=DIC,(X,DINUM)=RCXVD0
"RTN","RCXVDEQ",117,0)
 S DLAYGO=348.42,DIC(0)="L",DIC("P")=DLAYGO
"RTN","RCXVDEQ",118,0)
 I '$D(^RCXV(DA(1),2,0)) S ^RCXV(DA(1),2,0)="^348.42^^"
"RTN","RCXVDEQ",119,0)
 D FILE^DICN
"RTN","RCXVDEQ",120,0)
 ;
"RTN","RCXVDEQ",121,0)
 S RCUPD(348.4,RCXVDA_",",.07)=RCXVRNUM
"RTN","RCXVDEQ",122,0)
 D FILE^DIE("","RCUPD","RCXVERR")
"RTN","RCXVDEQ",123,0)
 K RCXVERR,RCUPD
"RTN","RCXVDEQ",124,0)
 Q
"RTN","RCXVDEQ",125,0)
 ;
"RTN","RCXVDEQ",126,0)
ER ; Unlock and log error
"RTN","RCXVDEQ",127,0)
 L -^RCXVLK
"RTN","RCXVDEQ",128,0)
 D ^%ZTER
"RTN","RCXVDEQ",129,0)
 D UNWIND^%ZTER
"RTN","RCXVDEQ",130,0)
 Q
"RTN","RCXVP240")
0^3^B433207
"RTN","RCXVP240",1,0)
RCXVP240 ;TJK/Albany OI@Altoona,Pa.-AR Data Extraction Post-Install Program ;23-JUL-03
"RTN","RCXVP240",2,0)
 ;;4.5;Accounts Receivable;**240**;Mar 20, 1995
"RTN","RCXVP240",3,0)
 ;
"RTN","RCXVP240",4,0)
 ;** Program Description **
"RTN","RCXVP240",5,0)
 ;  This program will be run on installation of patch
"RTN","RCXVP240",6,0)
 ;  PRCA*4.5*240 for CBO Active Bills to ARC Data Extractions
"RTN","RCXVP240",7,0)
 ;
"RTN","RCXVP240",8,0)
EN ; Entry Point
"RTN","RCXVP240",9,0)
 ;  Set up the active records into the AR Queue File (#348.4)
"RTN","RCXVP240",10,0)
 N RCXVDSC,RCXVFL,ZTDESC,ZTRTN,ZTIO,ZTDTH
"RTN","RCXVP240",11,0)
 S RCXVDSC="CBO ACTIVE BILLS"
"RTN","RCXVP240",12,0)
 S RCXVFL=$$TASK^RCXVUTIL(RCXVDSC)
"RTN","RCXVP240",13,0)
 I 'RCXVFL D
"RTN","RCXVP240",14,0)
 . S ZTDESC=RCXVDSC,ZTRTN="ACT^RCXVTSK",ZTIO=""
"RTN","RCXVP240",15,0)
 . S ZTDTH=$$DT^XLFDT()_".20"
"RTN","RCXVP240",16,0)
 . D ^%ZTLOAD
"RTN","RCXVP240",17,0)
 Q
"VER")
8.0^22.0
"BLD",6463,6)
^212
**END**
**END**
