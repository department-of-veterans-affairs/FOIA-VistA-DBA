Released XU*8*390 SEQ #342
Extracted from mail message
**KIDS**:XU*8.0*390^

**INSTALL NAME**
XU*8.0*390
"BLD",6409,0)
XU*8.0*390^KERNEL^0^3060609^y
"BLD",6409,4,0)
^9.64PA^^
"BLD",6409,"ABPKG")
n
"BLD",6409,"INID")
^n
"BLD",6409,"INIT")
MAIN^XUMF390
"BLD",6409,"KRN",0)
^9.67PA^8989.52^19
"BLD",6409,"KRN",.4,0)
.4
"BLD",6409,"KRN",.401,0)
.401
"BLD",6409,"KRN",.402,0)
.402
"BLD",6409,"KRN",.403,0)
.403
"BLD",6409,"KRN",.5,0)
.5
"BLD",6409,"KRN",.84,0)
.84
"BLD",6409,"KRN",3.6,0)
3.6
"BLD",6409,"KRN",3.8,0)
3.8
"BLD",6409,"KRN",9.2,0)
9.2
"BLD",6409,"KRN",9.8,0)
9.8
"BLD",6409,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6409,"KRN",9.8,"NM",1,0)
XUMFH^^0^B77218033
"BLD",6409,"KRN",9.8,"NM",2,0)
XUMF390^^0^B16595153
"BLD",6409,"KRN",9.8,"NM",3,0)
XUMFP4C^^0^B15661298
"BLD",6409,"KRN",9.8,"NM","B","XUMF390",2)

"BLD",6409,"KRN",9.8,"NM","B","XUMFH",1)

"BLD",6409,"KRN",9.8,"NM","B","XUMFP4C",3)

"BLD",6409,"KRN",19,0)
19
"BLD",6409,"KRN",19.1,0)
19.1
"BLD",6409,"KRN",101,0)
101
"BLD",6409,"KRN",409.61,0)
409.61
"BLD",6409,"KRN",771,0)
771
"BLD",6409,"KRN",870,0)
870
"BLD",6409,"KRN",870,"NM",0)
^9.68A^^0
"BLD",6409,"KRN",8989.51,0)
8989.51
"BLD",6409,"KRN",8989.52,0)
8989.52
"BLD",6409,"KRN",8994,0)
8994
"BLD",6409,"KRN","B",.4,.4)

"BLD",6409,"KRN","B",.401,.401)

"BLD",6409,"KRN","B",.402,.402)

"BLD",6409,"KRN","B",.403,.403)

"BLD",6409,"KRN","B",.5,.5)

"BLD",6409,"KRN","B",.84,.84)

"BLD",6409,"KRN","B",3.6,3.6)

"BLD",6409,"KRN","B",3.8,3.8)

"BLD",6409,"KRN","B",9.2,9.2)

"BLD",6409,"KRN","B",9.8,9.8)

"BLD",6409,"KRN","B",19,19)

"BLD",6409,"KRN","B",19.1,19.1)

"BLD",6409,"KRN","B",101,101)

"BLD",6409,"KRN","B",409.61,409.61)

"BLD",6409,"KRN","B",771,771)

"BLD",6409,"KRN","B",870,870)

"BLD",6409,"KRN","B",8989.51,8989.51)

"BLD",6409,"KRN","B",8989.52,8989.52)

"BLD",6409,"KRN","B",8994,8994)

"BLD",6409,"QUES",0)
^9.62^^
"BLD",6409,"REQB",0)
^9.611^^
"INIT")
MAIN^XUMF390
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3040115^2960606^1
"PKG",3,22,1,"PAH",1,0)
390^3060609^11
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","XUMF390")
0^2^B16595153
"RTN","XUMF390",1,0)
XUMF390 ;ISS/RAM - Load CLIA & MAMMO ID's;12/15/05
"RTN","XUMF390",2,0)
 ;;8.0;KERNEL;**390**;Jul 10, 1995
"RTN","XUMF390",3,0)
 ;
"RTN","XUMF390",4,0)
 ; $$PARAM^HLCS2 call supported by IA #3552
"RTN","XUMF390",5,0)
 ;
"RTN","XUMF390",6,0)
 Q
"RTN","XUMF390",7,0)
 ;
"RTN","XUMF390",8,0)
MAIN ; -- main
"RTN","XUMF390",9,0)
 ;
"RTN","XUMF390",10,0)
 D LINK,BG
"RTN","XUMF390",11,0)
 ;
"RTN","XUMF390",12,0)
 Q
"RTN","XUMF390",13,0)
 ;
"RTN","XUMF390",14,0)
BG ; -- background job
"RTN","XUMF390",15,0)
 ;
"RTN","XUMF390",16,0)
 N ZTRTN,ZTDESC,ZTDTH
"RTN","XUMF390",17,0)
 ;
"RTN","XUMF390",18,0)
 S ZTRTN="EN^XUMF390"
"RTN","XUMF390",19,0)
 S ZTDESC="XUMF Load CLIA ID's"
"RTN","XUMF390",20,0)
 S ZTDTH=$$NOW^XLFDT
"RTN","XUMF390",21,0)
 S ZTIO=""
"RTN","XUMF390",22,0)
 ;
"RTN","XUMF390",23,0)
 D ^%ZTLOAD
"RTN","XUMF390",24,0)
 ;
"RTN","XUMF390",25,0)
 Q
"RTN","XUMF390",26,0)
 ;
"RTN","XUMF390",27,0)
EN ; -- entry point
"RTN","XUMF390",28,0)
 ;
"RTN","XUMF390",29,0)
 D LOAD^XUMF(4)
"RTN","XUMF390",30,0)
 ;
"RTN","XUMF390",31,0)
 K ^TMP("XUMF ARRAY",$J)
"RTN","XUMF390",32,0)
 ;
"RTN","XUMF390",33,0)
 N PARAM,XUMFLAG,ERROR,TEST
"RTN","XUMF390",34,0)
 ;
"RTN","XUMF390",35,0)
 S (ERROR,XUMFLAG,TEST)=0
"RTN","XUMF390",36,0)
 ;
"RTN","XUMF390",37,0)
 I $P($$PARAM^HLCS2,U,3)="T" S TEST=1
"RTN","XUMF390",38,0)
 ;
"RTN","XUMF390",39,0)
 L +^TMP("XUMF ARRAY",$J):0 D:'$T
"RTN","XUMF390",40,0)
 .S ERROR="1^another process is using the Master File Server"
"RTN","XUMF390",41,0)
 ;
"RTN","XUMF390",42,0)
 I ERROR D EXIT Q
"RTN","XUMF390",43,0)
 ;
"RTN","XUMF390",44,0)
 D MFS0
"RTN","XUMF390",45,0)
 ;
"RTN","XUMF390",46,0)
 I ERROR D EXIT Q
"RTN","XUMF390",47,0)
 ;
"RTN","XUMF390",48,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D
"RTN","XUMF390",49,0)
 .S ERROR="1^Connection to master file server failed!"
"RTN","XUMF390",50,0)
 ;
"RTN","XUMF390",51,0)
 I ERROR D EXIT Q
"RTN","XUMF390",52,0)
 ;
"RTN","XUMF390",53,0)
 D CLIA
"RTN","XUMF390",54,0)
 ;
"RTN","XUMF390",55,0)
 I ERROR D EXIT Q
"RTN","XUMF390",56,0)
 ;
"RTN","XUMF390",57,0)
 ; -- get MAMMO
"RTN","XUMF390",58,0)
 ; 
"RTN","XUMF390",59,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J)
"RTN","XUMF390",60,0)
 ;
"RTN","XUMF390",61,0)
 D MFS1
"RTN","XUMF390",62,0)
 ;
"RTN","XUMF390",63,0)
 I ERROR D EXIT Q
"RTN","XUMF390",64,0)
 ;
"RTN","XUMF390",65,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D
"RTN","XUMF390",66,0)
 .S ERROR="1^Connection to master file server failed!"
"RTN","XUMF390",67,0)
 ;
"RTN","XUMF390",68,0)
 I ERROR D EXIT Q
"RTN","XUMF390",69,0)
 ;
"RTN","XUMF390",70,0)
 D MAMMO
"RTN","XUMF390",71,0)
 ;
"RTN","XUMF390",72,0)
 D EXIT
"RTN","XUMF390",73,0)
 ;
"RTN","XUMF390",74,0)
 Q
"RTN","XUMF390",75,0)
 ;
"RTN","XUMF390",76,0)
MFS0 ; -- get CLIA from Institution Master File
"RTN","XUMF390",77,0)
 ;
"RTN","XUMF390",78,0)
 S PARAM("CDSYS")="CLIA"
"RTN","XUMF390",79,0)
 S PARAM("LLNK")="XUMF MFR^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMF390",80,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF390",81,0)
 ;
"RTN","XUMF390",82,0)
 D MAIN^XUMFP(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF390",83,0)
 D MAIN^XUMFI(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF390",84,0)
 D MAIN^XUMFH
"RTN","XUMF390",85,0)
 ;
"RTN","XUMF390",86,0)
 Q
"RTN","XUMF390",87,0)
 ;
"RTN","XUMF390",88,0)
MFS1 ; -- get ACR# from Institution Master File
"RTN","XUMF390",89,0)
 ;
"RTN","XUMF390",90,0)
 S PARAM("CDSYS")="MAMMO-ACR"
"RTN","XUMF390",91,0)
 S PARAM("LLNK")="XUMF MFR^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMF390",92,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF390",93,0)
 ;
"RTN","XUMF390",94,0)
 D MAIN^XUMFP(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF390",95,0)
 D MAIN^XUMFI(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF390",96,0)
 D MAIN^XUMFH
"RTN","XUMF390",97,0)
 ;
"RTN","XUMF390",98,0)
 Q
"RTN","XUMF390",99,0)
 ;
"RTN","XUMF390",100,0)
EXIT ; -- cleanup and quit
"RTN","XUMF390",101,0)
 ;
"RTN","XUMF390",102,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J),^TMP("DIERR",$J)
"RTN","XUMF390",103,0)
 ;
"RTN","XUMF390",104,0)
 L -^TMP("XUMF ARRAY",$J)
"RTN","XUMF390",105,0)
 ;
"RTN","XUMF390",106,0)
 S ZTREQ="@"
"RTN","XUMF390",107,0)
 ;
"RTN","XUMF390",108,0)
 Q
"RTN","XUMF390",109,0)
 ;
"RTN","XUMF390",110,0)
CLIA ; -- add CLIA ID to Institution file
"RTN","XUMF390",111,0)
 ;
"RTN","XUMF390",112,0)
 N ID,NAME,FDA,ERROR,IEN,IENS,X,XUMF,STANUM,OFNME,AGENCY
"RTN","XUMF390",113,0)
 ;
"RTN","XUMF390",114,0)
 S XUMF=1
"RTN","XUMF390",115,0)
 ;
"RTN","XUMF390",116,0)
 S ID=""
"RTN","XUMF390",117,0)
 F  S ID=$O(^TMP("XUMF ARRAY",$J,ID)) Q:ID=""  D
"RTN","XUMF390",118,0)
 .S X=^TMP("XUMF ARRAY",$J,ID)
"RTN","XUMF390",119,0)
 .S STANUM=$P(X,U,3)
"RTN","XUMF390",120,0)
 .S IEN=$$IEN^XUMF(4,"CLIA",ID)
"RTN","XUMF390",121,0)
 .I 'IEN,$G(STANUM)'="" S IEN=$O(^DIC(4,"D",STANUM,0))
"RTN","XUMF390",122,0)
 .Q:'IEN
"RTN","XUMF390",123,0)
 .S IENS="?+1,"_IEN_","
"RTN","XUMF390",124,0)
 .K FDA
"RTN","XUMF390",125,0)
 .S FDA(4.9999,IENS,.01)="CLIA"
"RTN","XUMF390",126,0)
 .S FDA(4.9999,IENS,.02)=ID
"RTN","XUMF390",127,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMF390",128,0)
 ;
"RTN","XUMF390",129,0)
 Q
"RTN","XUMF390",130,0)
 ;
"RTN","XUMF390",131,0)
MAMMO ; -- add MAMMO ID to Institution file
"RTN","XUMF390",132,0)
 ;
"RTN","XUMF390",133,0)
 N ID,NAME,FDA,ERROR,IEN,IENS,X,XUMF,STANUM
"RTN","XUMF390",134,0)
 ;
"RTN","XUMF390",135,0)
 S XUMF=1
"RTN","XUMF390",136,0)
 ;
"RTN","XUMF390",137,0)
 S ID=""
"RTN","XUMF390",138,0)
 F  S ID=$O(^TMP("XUMF ARRAY",$J,ID)) Q:ID=""  D
"RTN","XUMF390",139,0)
 .S X=^TMP("XUMF ARRAY",$J,ID)
"RTN","XUMF390",140,0)
 .S STANUM=$P(X,U,3)
"RTN","XUMF390",141,0)
 .S IEN=$$IEN^XUMF(4,"MAMMO-ACR",ID)
"RTN","XUMF390",142,0)
 .I 'IEN,$G(STANUM)'="" S IEN=$O(^DIC(4,"D",STANUM,0))
"RTN","XUMF390",143,0)
 .Q:'IEN
"RTN","XUMF390",144,0)
 .S IENS="?+1,"_IEN_","
"RTN","XUMF390",145,0)
 .K FDA
"RTN","XUMF390",146,0)
 .S FDA(4.9999,IENS,.01)="MAMMO-ACR"
"RTN","XUMF390",147,0)
 .S FDA(4.9999,IENS,.02)=ID
"RTN","XUMF390",148,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMF390",149,0)
 ;
"RTN","XUMF390",150,0)
 Q
"RTN","XUMF390",151,0)
 ;
"RTN","XUMF390",152,0)
LINK ;
"RTN","XUMF390",153,0)
 ;
"RTN","XUMF390",154,0)
 N IEN,FDA,IENS
"RTN","XUMF390",155,0)
 ;
"RTN","XUMF390",156,0)
 S IEN=$$FIND1^DIC(870,,"BX","XUMF ACK")
"RTN","XUMF390",157,0)
 S IENS=IEN_","
"RTN","XUMF390",158,0)
 ;
"RTN","XUMF390",159,0)
 K FDA
"RTN","XUMF390",160,0)
 S FDA(870,IENS,4.5)=1
"RTN","XUMF390",161,0)
 D UPDATE^DIE(,"FDA")
"RTN","XUMF390",162,0)
 ;
"RTN","XUMF390",163,0)
 S IEN=$$FIND1^DIC(870,,"BX","XUMF FORUM")
"RTN","XUMF390",164,0)
 S IENS=IEN_","
"RTN","XUMF390",165,0)
 ;
"RTN","XUMF390",166,0)
 K FDA
"RTN","XUMF390",167,0)
 S FDA(870,IENS,4.5)=1
"RTN","XUMF390",168,0)
 D UPDATE^DIE(,"FDA")
"RTN","XUMF390",169,0)
 ;
"RTN","XUMF390",170,0)
 Q
"RTN","XUMF390",171,0)
 ;
"RTN","XUMFH")
0^1^B77218033^B76492031
"RTN","XUMFH",1,0)
XUMFH ;CIOFO-SF/RAM - Master File HL7 Msg Handler ;11/16/05
"RTN","XUMFH",2,0)
 ;;8.0;KERNEL;**206,209,217,218,262,335,261,390**;Jul 10, 1995
"RTN","XUMFH",3,0)
 ;
"RTN","XUMFH",4,0)
 ; This routine handles Master File HL7 messages.
"RTN","XUMFH",5,0)
 ;
"RTN","XUMFH",6,0)
MAIN ; -- entry point
"RTN","XUMFH",7,0)
 ;
"RTN","XUMFH",8,0)
 N CNT,ERR,I,X,HLFS,HLCS,ERROR,HLRESLTA,IFN,IEN,MTPE,TYPE,ARRAY
"RTN","XUMFH",9,0)
 N HDT,KEY,MID,REASON,VALUE,XREF,ALL,GROUP,PARAM,ROOT,SEG,QRD
"RTN","XUMFH",10,0)
 N QID,WHAT,WHO,HLSCS,CDSYS,ERRCNT
"RTN","XUMFH",11,0)
 ;
"RTN","XUMFH",12,0)
 D INIT,PROCESS,REPLY,EXIT
"RTN","XUMFH",13,0)
 ;
"RTN","XUMFH",14,0)
 Q
"RTN","XUMFH",15,0)
 ;
"RTN","XUMFH",16,0)
INIT ; -- initialize
"RTN","XUMFH",17,0)
 ;
"RTN","XUMFH",18,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFH",19,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J),^TMP("XUMF ERROR",$J)
"RTN","XUMFH",20,0)
 ;
"RTN","XUMFH",21,0)
 S (ERROR,CNT,TYPE,ARRAY,ERRCNT)=0
"RTN","XUMFH",22,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH")),HLSCS=$E(HL("ECH"),4)
"RTN","XUMFH",23,0)
 ;
"RTN","XUMFH",24,0)
 Q
"RTN","XUMFH",25,0)
 ;
"RTN","XUMFH",26,0)
PROCESS ; -- pull message text
"RTN","XUMFH",27,0)
 ;
"RTN","XUMFH",28,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMFH",29,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMFH",30,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMFH",31,0)
 ;
"RTN","XUMFH",32,0)
 Q
"RTN","XUMFH",33,0)
 ;
"RTN","XUMFH",34,0)
MSH ; -- MSH segment
"RTN","XUMFH",35,0)
 ;
"RTN","XUMFH",36,0)
 Q
"RTN","XUMFH",37,0)
 ;
"RTN","XUMFH",38,0)
MSA ; -- MSA segment
"RTN","XUMFH",39,0)
 ;
"RTN","XUMFH",40,0)
 N CODE
"RTN","XUMFH",41,0)
 ;
"RTN","XUMFH",42,0)
 S CODE=$P(HLNODE,HLFS,2)
"RTN","XUMFH",43,0)
 ;
"RTN","XUMFH",44,0)
 I CODE="AE"!(CODE="AR") D
"RTN","XUMFH",45,0)
 .S ERROR=ERROR_U_$P(HLNODE,HLFS,4)_U_$G(ERR)
"RTN","XUMFH",46,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",47,0)
 ;
"RTN","XUMFH",48,0)
 Q
"RTN","XUMFH",49,0)
 ;
"RTN","XUMFH",50,0)
QRD ; -- QRD segment
"RTN","XUMFH",51,0)
 ;
"RTN","XUMFH",52,0)
 Q:ERROR
"RTN","XUMFH",53,0)
 ;
"RTN","XUMFH",54,0)
 S QRD="QRD,QDT,QFC,QP,QID,DRT,DRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL"
"RTN","XUMFH",55,0)
 ;
"RTN","XUMFH",56,0)
 F I=2:1:13 S PARAM($P(QRD,",",I))=$P(HLNODE,HLFS,I)
"RTN","XUMFH",57,0)
 S QID=$P(HLNODE,HLFS,5)
"RTN","XUMFH",58,0)
 S WHO=$P(HLNODE,HLFS,9)
"RTN","XUMFH",59,0)
 I WHO="" D  Q
"RTN","XUMFH",60,0)
 .S ERROR="1^QRD segment has null missing WHO parameter"
"RTN","XUMFH",61,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",62,0)
 S WHAT=$P(HLNODE,HLFS,10)
"RTN","XUMFH",63,0)
 I WHAT="" D  Q
"RTN","XUMFH",64,0)
 .S ERROR="1^QRD segment has null missing WHAT parameter"
"RTN","XUMFH",65,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",66,0)
 ;
"RTN","XUMFH",67,0)
 S ARRAY=$S(QID["ARRAY":1,1:0)
"RTN","XUMFH",68,0)
 S ALL=$S(WHO["ALL":1,1:0)
"RTN","XUMFH",69,0)
 S GROUP=$S(ALL:1,(WHO["IEN"):1,1:0)
"RTN","XUMFH",70,0)
 ;
"RTN","XUMFH",71,0)
 S:ARRAY TYPE=$S(GROUP:7,1:3)
"RTN","XUMFH",72,0)
 S:'ARRAY TYPE=$S(GROUP:5,1:1)
"RTN","XUMFH",73,0)
 S:HL("MTN")="MFR" TYPE=TYPE+10
"RTN","XUMFH",74,0)
 ;
"RTN","XUMFH",75,0)
 S IFN=+WHAT
"RTN","XUMFH",76,0)
 S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",77,0)
 S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",78,0)
 S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",79,0)
 S:$L(XREF)>1 PARAM("CDSYS")=XREF
"RTN","XUMFH",80,0)
 ;
"RTN","XUMFH",81,0)
 K:ARRAY ^TMP("XUMF ARRAY",$J)
"RTN","XUMFH",82,0)
 ;
"RTN","XUMFH",83,0)
 Q
"RTN","XUMFH",84,0)
 ;
"RTN","XUMFH",85,0)
MFI ; -- MFI segment
"RTN","XUMFH",86,0)
 ;
"RTN","XUMFH",87,0)
 Q:ERROR
"RTN","XUMFH",88,0)
 Q:$G(IFN)
"RTN","XUMFH",89,0)
 ;
"RTN","XUMFH",90,0)
 I $P(HLNODE,HLFS,2)="" D  Q
"RTN","XUMFH",91,0)
 .S ERROR="1^MFI segment missing Master File Identifier"
"RTN","XUMFH",92,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",93,0)
 S IFN=$$MFI^XUMFP($P(HLNODE,HLFS,2))
"RTN","XUMFH",94,0)
 I 'IFN D  Q
"RTN","XUMFH",95,0)
 .S ERROR="1^IFN in MFI could not be resolved"
"RTN","XUMFH",96,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",97,0)
 ;
"RTN","XUMFH",98,0)
 Q
"RTN","XUMFH",99,0)
 ;
"RTN","XUMFH",100,0)
MFE ; -- MFE segment
"RTN","XUMFH",101,0)
 ;
"RTN","XUMFH",102,0)
 Q:ERROR
"RTN","XUMFH",103,0)
 ;Q:$G(IEN)
"RTN","XUMFH",104,0)
 ;
"RTN","XUMFH",105,0)
 S KEY=$P(HLNODE,HLFS,5) Q:ARRAY
"RTN","XUMFH",106,0)
 ;
"RTN","XUMFH",107,0)
 I $P(KEY,HLCS)="" D  Q
"RTN","XUMFH",108,0)
 .D EM("MFE segment NULL key "_$E(HLNODE,1,80),.ERR)
"RTN","XUMFH",109,0)
 .
"RTN","XUMFH",110,0)
 S XREF=$P(KEY,HLCS,3)
"RTN","XUMFH",111,0)
 S IEN=$$FIND1^DIC(IFN,,"BX",$P(KEY,HLCS),XREF,,"ERR")
"RTN","XUMFH",112,0)
 S IEN=$S(IEN:IEN,KEY["ALL":"ALL",$G(ERR)'="":"ERROR",1:"NEW")
"RTN","XUMFH",113,0)
 I IEN="ERROR" D  Q
"RTN","XUMFH",114,0)
 .D EM("MFE segment couldn't resolve IEN",.ERR)
"RTN","XUMFH",115,0)
 .K ERR
"RTN","XUMFH",116,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",117,0)
 ;
"RTN","XUMFH",118,0)
 Q
"RTN","XUMFH",119,0)
 ;
"RTN","XUMFH",120,0)
ZL7 ; -- Generic Master File
"RTN","XUMFH",121,0)
ZIN ; -- VHA Institution segment
"RTN","XUMFH",122,0)
ZFT ; -- VHA Facility Type segment
"RTN","XUMFH",123,0)
LOC ; -- Location Identification segment
"RTN","XUMFH",124,0)
ZZZ ; -- get [Z...] segment(s)
"RTN","XUMFH",125,0)
 ;
"RTN","XUMFH",126,0)
 Q:ERROR
"RTN","XUMFH",127,0)
 Q:IEN="ERROR"
"RTN","XUMFH",128,0)
 ;
"RTN","XUMFH",129,0)
 I $G(ARRAY) D ARRAY Q
"RTN","XUMFH",130,0)
 ;
"RTN","XUMFH",131,0)
 N FDA,IENS,FIELD,ERR,PRE,POST,XUMF,MULT,FDA1,SEQ,SEQ1,SEQ2,SEQ3
"RTN","XUMFH",132,0)
 ;
"RTN","XUMFH",133,0)
 S PRE=$G(^TMP("XUMF MFS",$J,"PARAM","PRE"))
"RTN","XUMFH",134,0)
 D:PRE'="" @(PRE)
"RTN","XUMFH",135,0)
 ;
"RTN","XUMFH",136,0)
 S XUMF=7
"RTN","XUMFH",137,0)
 ;
"RTN","XUMFH",138,0)
 S SEG=$P(HLNODE,HLFS)
"RTN","XUMFH",139,0)
 S IENS=$S(IEN:IEN,1:"+1")_","
"RTN","XUMFH",140,0)
 S SEQ=0
"RTN","XUMFH",141,0)
 F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFH",142,0)
 .S SEQ1=$P(SEQ,"."),SEQ2=$P(SEQ,".",2)
"RTN","XUMFH",143,0)
 .S SEQ3=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",0))
"RTN","XUMFH",144,0)
 .I SEQ3 D SUBCOMP Q
"RTN","XUMFH",145,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFH",146,0)
 .I FIELD=".01" D
"RTN","XUMFH",147,0)
 ..N FDA,IEN1
"RTN","XUMFH",148,0)
 ..S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",149,0)
 ..S VALUE=$$VALUE()
"RTN","XUMFH",150,0)
 ..S:SEQ2 VALUE=$$VAL2()
"RTN","XUMFH",151,0)
 ..S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",152,0)
 ..S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",153,0)
 ..D UPDATE^DIE("E","FDA","IEN1","ERR")
"RTN","XUMFH",154,0)
 ..I $D(ERR) D
"RTN","XUMFH",155,0)
 ...D EM("Update DIE - error message",.ERR)
"RTN","XUMFH",156,0)
 ...K ERR
"RTN","XUMFH",157,0)
 ..I $D(IEN1) S IENS=IEN1(1)_","
"RTN","XUMFH",158,0)
 .I 'FIELD D SUBFILE Q
"RTN","XUMFH",159,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",160,0)
 .S VALUE=$$VALUE()
"RTN","XUMFH",161,0)
 .S:SEQ2 VALUE=$$VAL2()
"RTN","XUMFH",162,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",163,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",164,0)
 ;
"RTN","XUMFH",165,0)
 M FDA=FDA1
"RTN","XUMFH",166,0)
 ;
"RTN","XUMFH",167,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMFH",168,0)
 I $D(ERR) D
"RTN","XUMFH",169,0)
 .D EM("File DIE -- error message",.ERR)
"RTN","XUMFH",170,0)
 .K ERR
"RTN","XUMFH",171,0)
 ;
"RTN","XUMFH",172,0)
 S POST=$G(^TMP("XUMF MFS",$J,"PARAM","POST"))
"RTN","XUMFH",173,0)
 D:POST'="" @(POST)
"RTN","XUMFH",174,0)
 ;
"RTN","XUMFH",175,0)
 K IEN
"RTN","XUMFH",176,0)
 ;
"RTN","XUMFH",177,0)
 Q
"RTN","XUMFH",178,0)
 ;
"RTN","XUMFH",179,0)
SUBFILE ; -- process subfile record
"RTN","XUMFH",180,0)
 ;
"RTN","XUMFH",181,0)
 N IFN,IENS1,KEY1,FIELD,TYP,MKEY,ERR
"RTN","XUMFH",182,0)
 ;
"RTN","XUMFH",183,0)
 S IFN=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFH",184,0)
 S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFH",185,0)
 S TYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFH",186,0)
 S VALUE=$$VALUE()
"RTN","XUMFH",187,0)
 S:SEQ2 VALUE=$$VAL2()
"RTN","XUMFH",188,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",189,0)
 ;
"RTN","XUMFH",190,0)
 S MULT=$G(^TMP("XUMF MFS",$J,"PARAM","MULT",SEG,SEQ))
"RTN","XUMFH",191,0)
 S MKEY=$G(^TMP("XUMF MFS",$J,"PARAM","MKEY",SEG,SEQ))
"RTN","XUMFH",192,0)
 I MULT=SEQ Q:VALUE=""  D
"RTN","XUMFH",193,0)
 .N FDA,IEN
"RTN","XUMFH",194,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=VALUE
"RTN","XUMFH",195,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",196,0)
 .I $D(ERR) D
"RTN","XUMFH",197,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH",198,0)
 ..K ERR
"RTN","XUMFH",199,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",200,0)
 I 'MULT D
"RTN","XUMFH",201,0)
 .N FDA,IEN
"RTN","XUMFH",202,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=MKEY
"RTN","XUMFH",203,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",204,0)
 .I $D(ERR) D
"RTN","XUMFH",205,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH",206,0)
 ..K ERR
"RTN","XUMFH",207,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",208,0)
 .S FDA1(IFN,IENS1,.01)=MKEY
"RTN","XUMFH",209,0)
 I MULT,MULT'=SEQ S IENS1=$G(MULT(+MULT)) Q:IENS1=""
"RTN","XUMFH",210,0)
 S FDA1(IFN,IENS1,FIELD)=VALUE
"RTN","XUMFH",211,0)
 ;
"RTN","XUMFH",212,0)
 Q
"RTN","XUMFH",213,0)
 ;
"RTN","XUMFH",214,0)
VALUE() ; -- parse segment
"RTN","XUMFH",215,0)
 ;
"RTN","XUMFH",216,0)
 N COL
"RTN","XUMFH",217,0)
 ;
"RTN","XUMFH",218,0)
 D SEGPRSE^XUMFXHL7("HLNODE","COL")
"RTN","XUMFH",219,0)
 ;
"RTN","XUMFH",220,0)
 Q:SEQ2 COL($P(SEQ,"."))
"RTN","XUMFH",221,0)
 ;
"RTN","XUMFH",222,0)
 Q COL(SEQ)
"RTN","XUMFH",223,0)
 ;
"RTN","XUMFH",224,0)
 ;
"RTN","XUMFH",225,0)
VAL2() ; -- parse component
"RTN","XUMFH",226,0)
 ;
"RTN","XUMFH",227,0)
 N XXX
"RTN","XUMFH",228,0)
 ;
"RTN","XUMFH",229,0)
 D SEQPRSE^XUMFXHL7("VALUE","XXX")
"RTN","XUMFH",230,0)
 ;
"RTN","XUMFH",231,0)
 Q XXX(1,SEQ2)
"RTN","XUMFH",232,0)
 ;
"RTN","XUMFH",233,0)
 ;
"RTN","XUMFH",234,0)
SUBCOMP ; -- subcomponents
"RTN","XUMFH",235,0)
 ;
"RTN","XUMFH",236,0)
 S SEQ3=0
"RTN","XUMFH",237,0)
 F  S SEQ3=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3)) Q:'SEQ3  D
"RTN","XUMFH",238,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3,0))
"RTN","XUMFH",239,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3,FIELD))
"RTN","XUMFH",240,0)
 .S VALUE=$$VALUE()
"RTN","XUMFH",241,0)
 .S VALUE=$$VAL2()
"RTN","XUMFH",242,0)
 .S VALUE=$P(VALUE,HLSCS,SEQ3)
"RTN","XUMFH",243,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLSCS,0)
"RTN","XUMFH",244,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",245,0)
 ;
"RTN","XUMFH",246,0)
 Q
"RTN","XUMFH",247,0)
 ;
"RTN","XUMFH",248,0)
ARRAY ; -- query data stored in array (not filed)
"RTN","XUMFH",249,0)
 ;
"RTN","XUMFH",250,0)
 I $P($G(KEY),HLCS)="" D  Q
"RTN","XUMFH",251,0)
 .D EM("Null KEY found in the following segment: "_$E(HLNODE,1,80),.ERR)
"RTN","XUMFH",252,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",253,0)
 ;
"RTN","XUMFH",254,0)
 M ^TMP("XUMF ARRAY",$J,$P(KEY,HLCS))=HLNODE
"RTN","XUMFH",255,0)
 ;
"RTN","XUMFH",256,0)
 Q
"RTN","XUMFH",257,0)
 ;
"RTN","XUMFH",258,0)
REPLY ; -- master file response
"RTN","XUMFH",259,0)
 ;
"RTN","XUMFH",260,0)
 Q:HL("MTN")="MFR"
"RTN","XUMFH",261,0)
 Q:HL("MTN")="MFK"
"RTN","XUMFH",262,0)
 Q:HL("MTN")="ACK"
"RTN","XUMFH",263,0)
 ;
"RTN","XUMFH",264,0)
 S:(TYPE<10) TYPE=(TYPE+10)
"RTN","XUMFH",265,0)
 ;
"RTN","XUMFH",266,0)
 I HL("MTN")="MFQ" D
"RTN","XUMFH",267,0)
 .S IFN=+$G(WHAT) I 'IFN D  Q
"RTN","XUMFH",268,0)
 ..S ERROR="1^REPLY MFQ couldn't resolve IFN"
"RTN","XUMFH",269,0)
 ..D EM(ERROR,.ERR)
"RTN","XUMFH",270,0)
 .S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",271,0)
 .S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",272,0)
 .S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",273,0)
 ;
"RTN","XUMFH",274,0)
 S IFN=$G(IFN),IEN=$G(IEN)
"RTN","XUMFH",275,0)
 ;
"RTN","XUMFH",276,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",277,0)
 D MAIN^XUMFI(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",278,0)
 ;
"RTN","XUMFH",279,0)
 Q
"RTN","XUMFH",280,0)
 ;
"RTN","XUMFH",281,0)
EXIT ; -- cleanup, and quit
"RTN","XUMFH",282,0)
 ;
"RTN","XUMFH",283,0)
 I $D(^TMP("XUMF ERROR",$J)) D EM1 K ^TMP("XUMF ERROR",$J)
"RTN","XUMFH",284,0)
 ;
"RTN","XUMFH",285,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J),^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",286,0)
 ;
"RTN","XUMFH",287,0)
 Q
"RTN","XUMFH",288,0)
 ;
"RTN","XUMFH",289,0)
EM(ERROR,ERR) ; -- error message
"RTN","XUMFH",290,0)
 ;
"RTN","XUMFH",291,0)
 N X,I,Y,XMTEXT,FLG
"RTN","XUMFH",292,0)
 ;
"RTN","XUMFH",293,0)
 S FLG=0
"RTN","XUMFH",294,0)
 ;
"RTN","XUMFH",295,0)
 D MSG^DIALOG("AM",.X,80,,"ERR")
"RTN","XUMFH",296,0)
 ;
"RTN","XUMFH",297,0)
 ;S X(.02)="",X(.03)=$G(ERROR),X(.04)=""
"RTN","XUMFH",298,0)
 ;
"RTN","XUMFH",299,0)
 S X=.9 F  S X=$O(X(X)) Q:'X  D
"RTN","XUMFH",300,0)
 .I X(X)="" K X(X) Q
"RTN","XUMFH",301,0)
 .I X(X)["DINUMed field cannot" S FLG=1 K X(X) Q
"RTN","XUMFH",302,0)
 .I X(X)["ASSOCIATION" S FLG=1 K X(X) Q
"RTN","XUMFH",303,0)
 .I X(X)["INSTITUTION" S FLG=1 K X(X) Q
"RTN","XUMFH",304,0)
 ;
"RTN","XUMFH",305,0)
 I FLG Q:'$O(X(.9))
"RTN","XUMFH",306,0)
 ;
"RTN","XUMFH",307,0)
 S ERRCNT=ERRCNT+1
"RTN","XUMFH",308,0)
 ;
"RTN","XUMFH",309,0)
 S ^TMP("XUMF ERROR",$J,ERRCNT_".01")=""
"RTN","XUMFH",310,0)
 S ^TMP("XUMF ERROR",$J,ERRCNT_".02")=""
"RTN","XUMFH",311,0)
 S ^TMP("XUMF ERROR",$J,ERRCNT_".03")=$G(ERROR)
"RTN","XUMFH",312,0)
 S ^TMP("XUMF ERROR",$J,ERRCNT_".04")=""
"RTN","XUMFH",313,0)
 S ^TMP("XUMF ERROR",$J,ERRCNT_".05")="KEY: "_$G(KEY)_"   IFN: "_$G(IFN)_"   IEN: "_$G(IEN)
"RTN","XUMFH",314,0)
 S ^TMP("XUMF ERROR",$J,ERRCNT_".06")=""
"RTN","XUMFH",315,0)
 S X=.9 F  S X=$O(X(X)) Q:'X  D
"RTN","XUMFH",316,0)
 .S ^TMP("XUMF ERROR",$J,ERRCNT_"."_X)=X(X)
"RTN","XUMFH",317,0)
 ;
"RTN","XUMFH",318,0)
 Q
"RTN","XUMFH",319,0)
 ;
"RTN","XUMFH",320,0)
EM1 ;
"RTN","XUMFH",321,0)
 ;
"RTN","XUMFH",322,0)
 N XMY,XMSUB
"RTN","XUMFH",323,0)
 ;
"RTN","XUMFH",324,0)
 S ^TMP("XUMF ERROR",$J,.1)="HL7 message ID: "_$G(HL("MID"))
"RTN","XUMFH",325,0)
 S XMY("G.XUMF ERROR")="",XMSUB="MFS ERROR"
"RTN","XUMFH",326,0)
 S XMTEXT="^TMP(""XUMF ERROR"",$J,"
"RTN","XUMFH",327,0)
 ;
"RTN","XUMFH",328,0)
 D ^XMD
"RTN","XUMFH",329,0)
 ;
"RTN","XUMFH",330,0)
 Q
"RTN","XUMFH",331,0)
 ;
"RTN","XUMFP4C")
0^3^B15661298^B15679820
"RTN","XUMFP4C",1,0)
XUMFP4C ;CIOFO-SF/RAM - Master File C/S Params INSTITUTION ;06/28/00
"RTN","XUMFP4C",2,0)
 ;;8.0;KERNEL;**206,209,217,270,294,335,390**;Jul 10, 1995
"RTN","XUMFP4C",3,0)
 ;
"RTN","XUMFP4C",4,0)
 ; this routine is a called by XUMFP4 and is a continuation of that
"RTN","XUMFP4C",5,0)
 ; routine
"RTN","XUMFP4C",6,0)
 ;
"RTN","XUMFP4C",7,0)
QRD ; -- query definition segment
"RTN","XUMFP4C",8,0)
 ;
"RTN","XUMFP4C",9,0)
 ;Query Date/Time
"RTN","XUMFP4C",10,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QDT")) D
"RTN","XUMFP4C",11,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFP4C",12,0)
 ;
"RTN","XUMFP4C",13,0)
 ;Query Format Code
"RTN","XUMFP4C",14,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QFC")) D
"RTN","XUMFP4C",15,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QFC")="R"
"RTN","XUMFP4C",16,0)
 ;
"RTN","XUMFP4C",17,0)
 ;Query Priority
"RTN","XUMFP4C",18,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QP")) D
"RTN","XUMFP4C",19,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QP")="I"
"RTN","XUMFP4C",20,0)
 ;
"RTN","XUMFP4C",21,0)
 ;Query ID
"RTN","XUMFP4C",22,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QID")) D
"RTN","XUMFP4C",23,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QID")="Z04 "_$S(ARRAY:"ARRAY",1:"FILE")
"RTN","XUMFP4C",24,0)
 ;
"RTN","XUMFP4C",25,0)
 ;Deferred Response Type (optional)
"RTN","XUMFP4C",26,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRT")) D
"RTN","XUMFP4C",27,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRT")=""
"RTN","XUMFP4C",28,0)
 ;
"RTN","XUMFP4C",29,0)
 ;Deferred Response Date/Time (optional)
"RTN","XUMFP4C",30,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRDT")) D
"RTN","XUMFP4C",31,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRDT")=""
"RTN","XUMFP4C",32,0)
 ;
"RTN","XUMFP4C",33,0)
 ;Quantity Limited Request
"RTN","XUMFP4C",34,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QLR")) D
"RTN","XUMFP4C",35,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QLR")="RD"_HLCS_999
"RTN","XUMFP4C",36,0)
 ;
"RTN","XUMFP4C",37,0)
 ;Who Subject Filter - sta#, D x-ref, assigning facility
"RTN","XUMFP4C",38,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHO")) D
"RTN","XUMFP4C",39,0)
 .N X S X=$S(ALL:"ALL",IEN:$P($G(^DIC(4,+IEN,99)),U),1:"IEN ARRAY")
"RTN","XUMFP4C",40,0)
 .S $P(X,HLCS,9,10)="D"_HLCS_"045A4"
"RTN","XUMFP4C",41,0)
 .S:$G(CDSYS)'="" $P(X,HLCS,9,10)=CDSYS_HLCS_""
"RTN","XUMFP4C",42,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHO")=X
"RTN","XUMFP4C",43,0)
 ;
"RTN","XUMFP4C",44,0)
 ;What Subject Filter
"RTN","XUMFP4C",45,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHAT")) D
"RTN","XUMFP4C",46,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHAT")="4"_HLCS_"IFN"_HLCS_"VA FM"
"RTN","XUMFP4C",47,0)
 ;
"RTN","XUMFP4C",48,0)
 ;What Department Data Code
"RTN","XUMFP4C",49,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDDC")) D
"RTN","XUMFP4C",50,0)
 .N X S X="INFRASTRUCTURE"_HLCS_"INFORMATION INFRASTRUCTURE"
"RTN","XUMFP4C",51,0)
 .S X=X_HLCS_"VA TS"
"RTN","XUMFP4C",52,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDDC")=X
"RTN","XUMFP4C",53,0)
 ;
"RTN","XUMFP4C",54,0)
 ;What Data Code Value Qual (optional)
"RTN","XUMFP4C",55,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDCVQ")) D
"RTN","XUMFP4C",56,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDCVQ")=""
"RTN","XUMFP4C",57,0)
 ;
"RTN","XUMFP4C",58,0)
 ;Query Results Level (optional)
"RTN","XUMFP4C",59,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QRL")) D
"RTN","XUMFP4C",60,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QRL")=""
"RTN","XUMFP4C",61,0)
 ;
"RTN","XUMFP4C",62,0)
 Q
"RTN","XUMFP4C",63,0)
 ;
"RTN","XUMFP4C",64,0)
PRE ; -- pre-update record
"RTN","XUMFP4C",65,0)
 ;
"RTN","XUMFP4C",66,0)
 D PRE^XUMFR
"RTN","XUMFP4C",67,0)
 ;
"RTN","XUMFP4C",68,0)
 D IFF(IEN)
"RTN","XUMFP4C",69,0)
 ;
"RTN","XUMFP4C",70,0)
 Q
"RTN","XUMFP4C",71,0)
 ;
"RTN","XUMFP4C",72,0)
POST ; -- post-update record
"RTN","XUMFP4C",73,0)
 ;
"RTN","XUMFP4C",74,0)
 D POST^XUMFR
"RTN","XUMFP4C",75,0)
 ;
"RTN","XUMFP4C",76,0)
 Q
"RTN","XUMFP4C",77,0)
 ;
"RTN","XUMFP4C",78,0)
GROUP ; -- query group
"RTN","XUMFP4C",79,0)
 ;
"RTN","XUMFP4C",80,0)
 S IEN=0
"RTN","XUMFP4C",81,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)) Q:'IEN  D
"RTN","XUMFP4C",82,0)
 .I '$G(^DIC(4,IEN,99)) D
"RTN","XUMFP4C",83,0)
 ..S PKV="NEW"_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4C",84,0)
 .I $G(^DIC(4,IEN,99)) D
"RTN","XUMFP4C",85,0)
 ..S PKV=$P(^DIC(4,IEN,99),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4C",86,0)
 .I CDSYS'="" D
"RTN","XUMFP4C",87,0)
 ..S $P(PKV,HLCS,1)=^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)
"RTN","XUMFP4C",88,0)
 ..S $P(PKV,HLCS,2)=$P($G(^DIC(4,+IEN,0)),U),$P(PKV,HLCS,3)=CDSYS
"RTN","XUMFP4C",89,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")=PKV
"RTN","XUMFP4C",90,0)
 .I '$P($G(^DIC(4,+IEN,99)),U,4) D
"RTN","XUMFP4C",91,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",8)="1,"_IEN_","
"RTN","XUMFP4C",92,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"1,"_IEN_",")="VISN"
"RTN","XUMFP4C",93,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",9)="2,"_IEN_","
"RTN","XUMFP4C",94,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"2,"_IEN_",")="PARENT FACILITY"
"RTN","XUMFP4C",95,0)
 .S RF=$$RF^XUAF4(IEN) D:RF
"RTN","XUMFP4C",96,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",10)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",97,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",11)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",98,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RF,U,3)_","_IEN_",")=$P(RF,U,3)
"RTN","XUMFP4C",99,0)
 .S RT=$$RT^XUAF4(IEN) D:RT
"RTN","XUMFP4C",100,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",12)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",101,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",13)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",102,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RT,U,3)_","_IEN_",")=$P(RT,U,3)
"RTN","XUMFP4C",103,0)
 ;
"RTN","XUMFP4C",104,0)
 Q
"RTN","XUMFP4C",105,0)
 ;
"RTN","XUMFP4C",106,0)
IFF(IEN) ; -- inactive facility remove VISN and parent association
"RTN","XUMFP4C",107,0)
 ;
"RTN","XUMFP4C",108,0)
 N FDA,IENS,XUMF
"RTN","XUMFP4C",109,0)
 ;
"RTN","XUMFP4C",110,0)
 S XUMF=1
"RTN","XUMFP4C",111,0)
 ;
"RTN","XUMFP4C",112,0)
 S IENS="1,"_IEN_","
"RTN","XUMFP4C",113,0)
 S FDA(4.014,IENS,.01)="@"
"RTN","XUMFP4C",114,0)
 S IENS="2,"_IEN_","
"RTN","XUMFP4C",115,0)
 S FDA(4.014,IENS,.01)="@"
"RTN","XUMFP4C",116,0)
 D FILE^DIE("E","FDA")
"RTN","XUMFP4C",117,0)
 ;
"RTN","XUMFP4C",118,0)
 Q
"RTN","XUMFP4C",119,0)
 ;
"VER")
8.0^22.0
"BLD",6409,6)
^342
**END**
**END**
