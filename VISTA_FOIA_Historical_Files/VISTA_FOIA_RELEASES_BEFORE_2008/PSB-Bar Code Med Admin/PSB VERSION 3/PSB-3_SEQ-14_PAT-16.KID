Released PSB*3*16 SEQ #14
Extracted from mail message
**KIDS**:PSB*3.0*16^

**INSTALL NAME**
PSB*3.0*16
"BLD",5193,0)
PSB*3.0*16^BAR CODE MED ADMIN^0^3051114^y
"BLD",5193,1,0)
^^14^14^3051107^^^^
"BLD",5193,1,1,0)
***
"BLD",5193,1,2,0)
 
"BLD",5193,1,3,0)
 
"BLD",5193,1,4,0)
 
"BLD",5193,1,5,0)
This patch is a component of the Bar Code Medication Administration 
"BLD",5193,1,6,0)
(BCMA) - Health Services Commitee (HSC) project and is the development of 
"BLD",5193,1,7,0)
phase one of the  BCMA-HSC Coversheet. PSB*3.0*16 will interface between 
"BLD",5193,1,8,0)
BCMA databases and the new BCMA Coversheet and its Graphical User 
"BLD",5193,1,9,0)
Interface (GUI).
"BLD",5193,1,10,0)
 
"BLD",5193,1,11,0)
 
"BLD",5193,1,12,0)
 
"BLD",5193,1,13,0)
 
"BLD",5193,1,14,0)
***
"BLD",5193,4,0)
^9.64PA^^
"BLD",5193,6)
13^
"BLD",5193,"ABPKG")
n
"BLD",5193,"KRN",0)
^9.67PA^8989.52^19
"BLD",5193,"KRN",.4,0)
.4
"BLD",5193,"KRN",.401,0)
.401
"BLD",5193,"KRN",.402,0)
.402
"BLD",5193,"KRN",.403,0)
.403
"BLD",5193,"KRN",.5,0)
.5
"BLD",5193,"KRN",.84,0)
.84
"BLD",5193,"KRN",3.6,0)
3.6
"BLD",5193,"KRN",3.8,0)
3.8
"BLD",5193,"KRN",9.2,0)
9.2
"BLD",5193,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",5193,"KRN",9.8,0)
9.8
"BLD",5193,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",5193,"KRN",9.8,"NM",1,0)
PSBCSUTL^^0^B74276312
"BLD",5193,"KRN",9.8,"NM",2,0)
PSBCSUTX^^0^B78601969
"BLD",5193,"KRN",9.8,"NM",3,0)
PSBCSUTY^^0^B23020024
"BLD",5193,"KRN",9.8,"NM",4,0)
PSBCHKIV^^0^B78251279
"BLD",5193,"KRN",9.8,"NM",5,0)
PSBRPC2^^0^B45008949
"BLD",5193,"KRN",9.8,"NM",6,0)
PSBRPC3^^0^B297083
"BLD",5193,"KRN",9.8,"NM",7,0)
PSBVDLTB^^0^B12630766
"BLD",5193,"KRN",9.8,"NM",8,0)
PSBVDLPA^^0^B11710856
"BLD",5193,"KRN",9.8,"NM","B","PSBCHKIV",4)
 
"BLD",5193,"KRN",9.8,"NM","B","PSBCSUTL",1)
 
"BLD",5193,"KRN",9.8,"NM","B","PSBCSUTX",2)
 
"BLD",5193,"KRN",9.8,"NM","B","PSBCSUTY",3)
 
"BLD",5193,"KRN",9.8,"NM","B","PSBRPC2",5)
 
"BLD",5193,"KRN",9.8,"NM","B","PSBRPC3",6)
 
"BLD",5193,"KRN",9.8,"NM","B","PSBVDLPA",8)
 
"BLD",5193,"KRN",9.8,"NM","B","PSBVDLTB",7)
 
"BLD",5193,"KRN",19,0)
19
"BLD",5193,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",5193,"KRN",19,"NM",1,0)
PSB GUI CONTEXT - USER^^0
"BLD",5193,"KRN",19,"NM","B","PSB GUI CONTEXT - USER",1)
 
"BLD",5193,"KRN",19.1,0)
19.1
"BLD",5193,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5193,"KRN",101,0)
101
"BLD",5193,"KRN",409.61,0)
409.61
"BLD",5193,"KRN",771,0)
771
"BLD",5193,"KRN",870,0)
870
"BLD",5193,"KRN",8989.51,0)
8989.51
"BLD",5193,"KRN",8989.52,0)
8989.52
"BLD",5193,"KRN",8994,0)
8994
"BLD",5193,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",5193,"KRN",8994,"NM",1,0)
PSB COVERSHEET1^^0
"BLD",5193,"KRN",8994,"NM","B","PSB COVERSHEET1",1)
 
"BLD",5193,"KRN","B",.4,.4)
 
"BLD",5193,"KRN","B",.401,.401)
 
"BLD",5193,"KRN","B",.402,.402)
 
"BLD",5193,"KRN","B",.403,.403)
 
"BLD",5193,"KRN","B",.5,.5)
 
"BLD",5193,"KRN","B",.84,.84)
 
"BLD",5193,"KRN","B",3.6,3.6)
 
"BLD",5193,"KRN","B",3.8,3.8)
 
"BLD",5193,"KRN","B",9.2,9.2)
 
"BLD",5193,"KRN","B",9.8,9.8)
 
"BLD",5193,"KRN","B",19,19)
 
"BLD",5193,"KRN","B",19.1,19.1)
 
"BLD",5193,"KRN","B",101,101)
 
"BLD",5193,"KRN","B",409.61,409.61)
 
"BLD",5193,"KRN","B",771,771)
 
"BLD",5193,"KRN","B",870,870)
 
"BLD",5193,"KRN","B",8989.51,8989.51)
 
"BLD",5193,"KRN","B",8989.52,8989.52)
 
"BLD",5193,"KRN","B",8994,8994)
 
"BLD",5193,"QUES",0)
^9.62^^
"BLD",5193,"REQB",0)
^9.611^3^3
"BLD",5193,"REQB",1,0)
PSB*3.0*3^2
"BLD",5193,"REQB",2,0)
PSB*3.0*4^2
"BLD",5193,"REQB",3,0)
PSB*3.0*5^2
"BLD",5193,"REQB","B","PSB*3.0*3",1)
 
"BLD",5193,"REQB","B","PSB*3.0*4",2)
 
"BLD",5193,"REQB","B","PSB*3.0*5",3)
 
"KRN",19,11585,-1)
0^1
"KRN",19,11585,0)
PSB GUI CONTEXT - USER^BCMA Client Context^^B^^^^^^^^
"KRN",19,11585,99)
59973,28281
"KRN",19,11585,99.1)
59676,26361
"KRN",19,11585,"RPC",0)
^19.05P^50^50
"KRN",19,11585,"RPC",2,0)
PSB FMDATE
"KRN",19,11585,"RPC",4,0)
PSB GETPRNS
"KRN",19,11585,"RPC",5,0)
PSB INSTRUCTOR
"KRN",19,11585,"RPC",7,0)
PSB MEDICATION HISTORY
"KRN",19,11585,"RPC",8,0)
PSB PARAMETER
"KRN",19,11585,"RPC",12,0)
PSB SCANMED
"KRN",19,11585,"RPC",13,0)
PSB SCANPT
"KRN",19,11585,"RPC",14,0)
PSB SERVER CLOCK VARIANCE
"KRN",19,11585,"RPC",15,0)
PSB SUBMIT MISSING DOSE
"KRN",19,11585,"RPC",16,0)
PSB TRANSACTION
"KRN",19,11585,"RPC",17,0)
PSB USERLOAD
"KRN",19,11585,"RPC",18,0)
PSB USERSAVE
"KRN",19,11585,"RPC",19,0)
PSB VALIDATE ESIG
"KRN",19,11585,"RPC",20,0)
PSB VALIDATE ORDER
"KRN",19,11585,"RPC",21,0)
PSB CHECK SERVER
"KRN",19,11585,"RPC",23,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,11585,"RPC",24,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,11585,"RPC",26,0)
PSB GETORDERTAB
"KRN",19,11585,"RPC",27,0)
PSB GETIVPAR
"KRN",19,11585,"RPC",28,0)
PSB PUTIVPAR
"KRN",19,11585,"RPC",29,0)
PSB DEVICE
"KRN",19,11585,"RPC",30,0)
PSB IV ORDER HISTORY
"KRN",19,11585,"RPC",31,0)
PSB BAG DETAIL
"KRN",19,11585,"RPC",32,0)
PSB WARDLIST
"KRN",19,11585,"RPC",33,0)
PSB MAIL
"KRN",19,11585,"RPC",34,0)
PSB ALLERGY
"KRN",19,11585,"RPC",35,0)
PSB GETPROVIDER
"KRN",19,11585,"RPC",36,0)
PSB REPORT
"KRN",19,11585,"RPC",37,0)
PSB MOB DRUG LIST
"KRN",19,11585,"RPC",38,0)
PSB MAXDAYS
"KRN",19,11585,"RPC",39,0)
PSB NURS WARDLIST
"KRN",19,11585,"RPC",40,0)
PSB CPRS ORDER
"KRN",19,11585,"RPC",41,0)
ORWUBCMA USERINFO
"KRN",19,11585,"RPC",43,0)
ORBCMA5 GETUDID
"KRN",19,11585,"RPC",44,0)
ORBCMA5 GETIVID
"KRN",19,11585,"RPC",45,0)
PSB VERSION CHECK
"KRN",19,11585,"RPC",46,0)
PSB CHECK IV
"KRN",19,11585,"RPC",47,0)
PSB VITALS
"KRN",19,11585,"RPC",48,0)
PSB VITAL MEAS FILE
"KRN",19,11585,"RPC",49,0)
PSB MED LOG LOOKUP
"KRN",19,11585,"RPC",50,0)
PSB COVERSHEET1
"KRN",19,11585,"U")
BCMA CLIENT CONTEXT
"KRN",8994,1897,-1)
0^1
"KRN",8994,1897,0)
PSB COVERSHEET1^RPC^PSBCSUTL^4^A^0^^1^3
"KRN",8994,1897,1,0)
^8994.01^83^83^3051114^^^^
"KRN",8994,1897,1,1,0)
PSB COVERSHEET1 is to return order data per patient and construction of 
"KRN",8994,1897,1,2,0)
BCMA Coversheet view as presented by the BCMA-HSC Coversheet Phase 1 SRS 
"KRN",8994,1897,1,3,0)
and SDD documentation.
"KRN",8994,1897,1,4,0)
 
"KRN",8994,1897,1,5,0)
INPUT:  communications area -  "" 
"KRN",8994,1897,1,6,0)
        patient's DFN       -  DFN     (patient ptr.)
"KRN",8994,1897,1,7,0)
 
"KRN",8994,1897,1,8,0)
OUTPUT: results data        -  RESULTS array containing order data +/-24 hours.
"KRN",8994,1897,1,9,0)
 
"KRN",8994,1897,1,10,0)
 
"KRN",8994,1897,1,11,0)
 
"KRN",8994,1897,1,12,0)
 
"KRN",8994,1897,1,13,0)
Example "M" call and results:
"KRN",8994,1897,1,14,0)
 
"KRN",8994,1897,1,15,0)
 
"KRN",8994,1897,1,16,0)
 
"KRN",8994,1897,1,17,0)
D RPC^PSBCSUTL("",783)
"KRN",8994,1897,1,18,0)
 
"KRN",8994,1897,1,19,0)
RESULTS[0] =64
"KRN",8994,1897,1,20,0)
RESULTS[1] ="1^Cover Sheet Data Follows"
"KRN",8994,1897,1,21,0)
RESULTS[2] ="ORD^783^9U^9^U^O^ONCE^^EPINEPHRINE/LIDOCAINE INJ,SOLN^2 mg ^^^^^^240^0^0^^***^^3050311.08^A^^^0^3050323.23"
"KRN",8994,1897,1,22,0)
RESULTS[3] ="ORC^!test test and more tests!!"
"KRN",8994,1897,1,23,0)
RESULTS[4] ="DD^1018^LIDOCAINE 0.5% W/EPI INJ MDV^2^"
"KRN",8994,1897,1,24,0)
RESULTS[5] ="END"
"KRN",8994,1897,1,25,0)
RESULTS[6] ="ORD^783^11U^11^U^OC^ON CALL^^PAPAVERINE ^150MG ^PO^3050302.130009^^^^472^0^0^^***^G^3050311.14^A^^^0^3050323.23"
"KRN",8994,1897,1,26,0)
RESULTS[7] ="ORC^!test oncall orders"
"KRN",8994,1897,1,27,0)
RESULTS[8] ="DD^1330^PAPAVERINE 150MG CAP ^1^"
"KRN",8994,1897,1,28,0)
RESULTS[9] ="END"
"KRN",8994,1897,1,29,0)
RESULTS[10]="ORD^783^8U^8^U^C^ONCE^^HEPATITIS B IMMUNE GLOBULIN INJ^500ML ^PO^^^^^308^0^0^^***^^3050308.12^A^^^0^3050419.2305"
"KRN",8994,1897,1,30,0)
RESULTS[11]="ORC^!test 68003/min-0504-40581"
"KRN",8994,1897,1,31,0)
RESULTS[12]="DD^1708^HEPATITIS-B IMMUNE GLOBULIN^1^"
"KRN",8994,1897,1,32,0)
RESULTS[13]="ADM^3050315.12^^^^^^^"
"KRN",8994,1897,1,33,0)
RESULTS[14]="ADM^3050316.12^^^^^^^"
"KRN",8994,1897,1,34,0)
RESULTS[15]="ADM^3050317.12^^^^^^^"
"KRN",8994,1897,1,35,0)
RESULTS[16]="END"
"KRN",8994,1897,1,36,0)
RESULTS[17]="ORD^783^1U^1^U^C^Q3H^^BETHANECHOL TAB^50MG ^PO^3050311.072427^^^^80^0^0^TAB^***^G^3050216.1^A^^^0^3050815.233"
"KRN",8994,1897,1,37,0)
RESULTS[18]="ORC^!Free text SPECIAL INSTRUCTIONs..."
"KRN",8994,1897,1,38,0)
RESULTS[19]="DD^37^BETHANECHOL 25MG TAB^2^"
"KRN",8994,1897,1,39,0)
RESULTS[20]="ADM^3050315.13^^^^^^^"
"KRN",8994,1897,1,40,0)
RESULTS[21]="ADM^3050315.16^^^^^^^"
"KRN",8994,1897,1,41,0)
RESULTS[22]="ADM^3050315.19^^^^^^^"
"KRN",8994,1897,1,42,0)
RESULTS[23]="ADM^3050315.22^^^^^^^"
"KRN",8994,1897,1,43,0)
RESULTS[24]="ADM^3050316.01^^^^^^^"
"KRN",8994,1897,1,44,0)
RESULTS[25]="ADM^3050316.04^^^^^^^"
"KRN",8994,1897,1,45,0)
RESULTS[26]="ADM^3050316.07^^^^^^^"
"KRN",8994,1897,1,46,0)
RESULTS[27]="ADM^3050316.1^^^^^^^"
"KRN",8994,1897,1,47,0)
RESULTS[28]="ADM^3050316.13^^^^^^^"
"KRN",8994,1897,1,48,0)
RESULTS[29]="ADM^3050316.16^^^^^^^"
"KRN",8994,1897,1,49,0)
RESULTS[30]="ADM^3050316.19^^^^^^^"
"KRN",8994,1897,1,50,0)
RESULTS[31]="ADM^3050316.22^^^^^^^"
"KRN",8994,1897,1,51,0)
RESULTS[32]="ADM^3050317.01^^^^^^^"
"KRN",8994,1897,1,52,0)
RESULTS[33]="ADM^3050317.04^^^^^^^"
"KRN",8994,1897,1,53,0)
RESULTS[34]="ADM^3050317.07^^^^^^^"
"KRN",8994,1897,1,54,0)
RESULTS[35]="ADM^3050317.1^^^^^^^"
"KRN",8994,1897,1,55,0)
RESULTS[36]="END"
"KRN",8994,1897,1,56,0)
RESULTS[37]="ORD^783^5V^5^V^C^^^OXACILLIN INJ^ 2 ml/hr^IV^3050310.130032^^^^466^1^0^^***^G^3050224.14^A^^^0^3050525.001"
"KRN",8994,1897,1,57,0)
RESULTS[38]="ORC^!test again.."
"KRN",8994,1897,1,58,0)
RESULTS[39]="ADD^2^OXACILLIN^0.3 GM^"
"KRN",8994,1897,1,59,0)
RESULTS[40]="SOL^17^KCL 20MEQ/D5/NACL 0.9%^1000 ML^"
"KRN",8994,1897,1,60,0)
RESULTS[41]="ADM^3050316.^^^^^^^"
"KRN",8994,1897,1,61,0)
RESULTS[42]="END"
"KRN",8994,1897,1,62,0)
RESULTS[43]="ORD^783^1V^1^V^C^Q6H^^OXACILLIN INJ^ INFUSE OVER 2 MIN.^IV^3050310.130032^^^^466^1^0^^***^G^3050216.15^A^^^0^3050815.2"
"KRN",8994,1897,1,63,0)
RESULTS[44]="ORC^!free text OTHER PRINT INFO."
"KRN",8994,1897,1,64,0)
RESULTS[45]="ADD^2^OXACILLIN^14 GM^"
"KRN",8994,1897,1,65,0)
RESULTS[46]="SOL^14^DEXTROSE 5% IN N. SALINE^1000 ML^"
"KRN",8994,1897,1,66,0)
RESULTS[47]="ID^783V8^ADD;2^SOL;14"
"KRN",8994,1897,1,67,0)
RESULTS[48]="ID^783V7^ADD;2^SOL;14"
"KRN",8994,1897,1,68,0)
RESULTS[49]="ID^783V6^ADD;2^SOL;14"
"KRN",8994,1897,1,69,0)
RESULTS[50]="ID^783V3^ADD;2^SOL;14"
"KRN",8994,1897,1,70,0)
RESULTS[51]="ID^783V10^ADD;2^SOL;14"
"KRN",8994,1897,1,71,0)
RESULTS[52]="ADM^3050315.15^^^^^^^"
"KRN",8994,1897,1,72,0)
RESULTS[53]="ADM^3050315.21^^^^^^^"
"KRN",8994,1897,1,73,0)
RESULTS[54]="ADM^3050316.03^^^^^^^"
"KRN",8994,1897,1,74,0)
RESULTS[55]="ADM^3050316.09^^^^^^^"
"KRN",8994,1897,1,75,0)
RESULTS[56]="ADM^3050316.15^^^^^^^"
"KRN",8994,1897,1,76,0)
RESULTS[57]="ADM^3050316.21^^^^^^^"
"KRN",8994,1897,1,77,0)
RESULTS[58]="ADM^3050317.03^^^^^^^"
"KRN",8994,1897,1,78,0)
RESULTS[59]="ADM^3050317.09^^^^^^^"
"KRN",8994,1897,1,79,0)
RESULTS[60]="END"
"KRN",8994,1897,1,80,0)
RESULTS[61]="ORD^783^7U^7^U^O^STAT^^TETANUS IMMUNE GLOBULIN INJ^500UNT/2ML ^PO^^^^^607^0^0^^***^^3050224.09^A^^^0^3050316.12"
"KRN",8994,1897,1,81,0)
RESULTS[62]="ORC^!this is a tes of the STAT order..."
"KRN",8994,1897,1,82,0)
RESULTS[63]="DD^1036^TETANUS IMMUNE GLOB 250 UNITS^2^"
"KRN",8994,1897,1,83,0)
RESULTS[64]="END"
"KRN",8994,1897,2,0)
^8994.02A^2^1
"KRN",8994,1897,2,2,0)
DFN^1^^1^1
"KRN",8994,1897,2,2,1,0)
^8994.021^1^1^3051114^^^^
"KRN",8994,1897,2,2,1,1,0)
DFN is the internal entity number per the patient file (file #2).
"KRN",8994,1897,2,"B","DFN",2)
 
"KRN",8994,1897,2,"PARAMSEQ",1,2)
 
"KRN",8994,1897,3,0)
^^85^85^3051114^
"KRN",8994,1897,3,1,0)
The return data will be listed in the RESULTS "global".
"KRN",8994,1897,3,2,0)
 
"KRN",8994,1897,3,3,0)
RESULTS data will presented with "headers":
"KRN",8994,1897,3,4,0)
 
"KRN",8994,1897,3,5,0)
 
"KRN",8994,1897,3,6,0)
 
"KRN",8994,1897,3,7,0)
ORD - Order data
"KRN",8994,1897,3,8,0)
 Order specific data
"KRN",8994,1897,3,9,0)
^1  "ORD"-header
"KRN",8994,1897,3,10,0)
^2  Patient's IEN
"KRN",8994,1897,3,11,0)
^3  Order #_Order type
"KRN",8994,1897,3,12,0)
^4  Order #
"KRN",8994,1897,3,13,0)
^5  Order type
"KRN",8994,1897,3,14,0)
^6  Schedule type
"KRN",8994,1897,3,15,0)
^7  Schedule
"KRN",8994,1897,3,16,0)
^8  Self med
"KRN",8994,1897,3,17,0)
^9  Drug name
"KRN",8994,1897,3,18,0)
^10 Dosage/Flow rate
"KRN",8994,1897,3,19,0)
^11 Med route
"KRN",8994,1897,3,20,0)
^12 Last Action Date/Time
"KRN",8994,1897,3,21,0)
^13 ""
"KRN",8994,1897,3,22,0)
^14 ""
"KRN",8994,1897,3,23,0)
^15 ""
"KRN",8994,1897,3,24,0)
^16 Orderable item (IEN)
"KRN",8994,1897,3,25,0)
^17 Injectable?
"KRN",8994,1897,3,26,0)
^18 Variable dose?
"KRN",8994,1897,3,27,0)
^19 Dosage form
"KRN",8994,1897,3,28,0)
^20 Verifying nurse initials (*** if none)
"KRN",8994,1897,3,29,0)
^21 Last action status (whole order)
"KRN",8994,1897,3,30,0)
^22 Order start date/time (FM)
"KRN",8994,1897,3,31,0)
^23 Order status
"KRN",8994,1897,3,32,0)
^24 ""
"KRN",8994,1897,3,33,0)
^25 ""
"KRN",8994,1897,3,34,0)
^26 Transaction type
"KRN",8994,1897,3,35,0)
^27 Order stop date/time (FM)
"KRN",8994,1897,3,36,0)
^28 Last Given Date/Time
"KRN",8994,1897,3,37,0)
^29 Tab ID = 1:"UD" 2:"IVPB" 3:"IV"
"KRN",8994,1897,3,38,0)
 
"KRN",8994,1897,3,39,0)
ORC - Order Comment/Special instruction
"KRN",8994,1897,3,40,0)
^1  "ORC"- header
"KRN",8994,1897,3,41,0)
^2  Special instruction
"KRN",8994,1897,3,42,0)
 
"KRN",8994,1897,3,43,0)
DD  - Dispense Drug
"KRN",8994,1897,3,44,0)
^1  "DD" - header
"KRN",8994,1897,3,45,0)
^2  Dispense drug IEN
"KRN",8994,1897,3,46,0)
^3  Dispense drug name
"KRN",8994,1897,3,47,0)
^4  Units per dose
"KRN",8994,1897,3,48,0)
^5  Inactive date
"KRN",8994,1897,3,49,0)
 
"KRN",8994,1897,3,50,0)
ADD - Additive
"KRN",8994,1897,3,51,0)
^1  "ADD" - header
"KRN",8994,1897,3,52,0)
^2  Additive IEN
"KRN",8994,1897,3,53,0)
^3  Additive name
"KRN",8994,1897,3,54,0)
^4  Strength
"KRN",8994,1897,3,55,0)
^5  Bottle
"KRN",8994,1897,3,56,0)
 
"KRN",8994,1897,3,57,0)
SOL - Solution
"KRN",8994,1897,3,58,0)
^1  "SOL" - header
"KRN",8994,1897,3,59,0)
^2  Solution IEN
"KRN",8994,1897,3,60,0)
^3  Solution name
"KRN",8994,1897,3,61,0)
^4  Volume
"KRN",8994,1897,3,62,0)
 
"KRN",8994,1897,3,63,0)
ID  - Identification
"KRN",8994,1897,3,64,0)
^1  "ID" - header
"KRN",8994,1897,3,65,0)
^2  ID number
"KRN",8994,1897,3,66,0)
^3  Additive IEN
"KRN",8994,1897,3,67,0)
 
"KRN",8994,1897,3,68,0)
ADM - Administration
"KRN",8994,1897,3,69,0)
^1  "ADM" - header
"KRN",8994,1897,3,70,0)
^2  Scheduled admin date/time
"KRN",8994,1897,3,71,0)
^3  Bag id
"KRN",8994,1897,3,72,0)
^4  Med log ien
"KRN",8994,1897,3,73,0)
^5  Action
"KRN",8994,1897,3,74,0)
^6  Date/time
"KRN",8994,1897,3,75,0)
^7  Action by initials                                                                                                              
"KRN",8994,1897,3,76,0)
^8  Action by ien
"KRN",8994,1897,3,77,0)
^9  Prn reason
"KRN",8994,1897,3,78,0)
 
"KRN",8994,1897,3,79,0)
CMT - Comment per administration
"KRN",8994,1897,3,80,0)
^1  "CMT" - header
"KRN",8994,1897,3,81,0)
^2  Comment
"KRN",8994,1897,3,82,0)
^3  Prn effectiveness 
"KRN",8994,1897,3,83,0)
 
"KRN",8994,1897,3,84,0)
END - End
"KRN",8994,1897,3,85,0)
^1  "END" - header
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
3.0^3040224^3040318^11874
"PKG",536,22,1,"PAH",1,0)
16^3051114^10000000039
"PKG",536,22,1,"PAH",1,1,0)
^^14^14^3051114
"PKG",536,22,1,"PAH",1,1,1,0)
***
"PKG",536,22,1,"PAH",1,1,2,0)
 
"PKG",536,22,1,"PAH",1,1,3,0)
 
"PKG",536,22,1,"PAH",1,1,4,0)
 
"PKG",536,22,1,"PAH",1,1,5,0)
This patch is a component of the Bar Code Medication Administration 
"PKG",536,22,1,"PAH",1,1,6,0)
(BCMA) - Health Services Commitee (HSC) project and is the development of 
"PKG",536,22,1,"PAH",1,1,7,0)
phase one of the  BCMA-HSC Coversheet. PSB*3.0*16 will interface between 
"PKG",536,22,1,"PAH",1,1,8,0)
BCMA databases and the new BCMA Coversheet and its Graphical User 
"PKG",536,22,1,"PAH",1,1,9,0)
Interface (GUI).
"PKG",536,22,1,"PAH",1,1,10,0)
 
"PKG",536,22,1,"PAH",1,1,11,0)
 
"PKG",536,22,1,"PAH",1,1,12,0)
 
"PKG",536,22,1,"PAH",1,1,13,0)
 
"PKG",536,22,1,"PAH",1,1,14,0)
***
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","PSBCHKIV")
0^4^B78251279
"RTN","PSBCHKIV",1,0)
PSBCHKIV ;BIRMINGHAM/TEJ-BCMA CHECK IV ROUTINE ;Mar 2004
"RTN","PSBCHKIV",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16**;Mar 2004
"RTN","PSBCHKIV",3,0)
 ;
"RTN","PSBCHKIV",4,0)
 ;This routine will provide "change" details for infus or stopped IV bags. 
"RTN","PSBCHKIV",5,0)
 ;
"RTN","PSBCHKIV",6,0)
 ; Reference/IA
"RTN","PSBCHKIV",7,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBCHKIV",8,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBCHKIV",9,0)
 ;
"RTN","PSBCHKIV",10,0)
RPC(RESULTS,DFN,ORDIV)  ;
"RTN","PSBCHKIV",11,0)
 I '$D(ORDIV) S RESULTS(0)=0 Q
"RTN","PSBCHKIV",12,0)
 N PSBGNODE,PSBPIN,PSBXX,PSBX,PSBBUIDS,PSBBUID K PSBBAGD,PSBADDS,PSBSOLS,RESULTS
"RTN","PSBCHKIV",13,0)
 D NOW^%DTC S X1=X,X2=-3 D C^%DTC S PSBDT=X
"RTN","PSBCHKIV",14,0)
 S PSBPIN=DFN
"RTN","PSBCHKIV",15,0)
 S Z="" F  S Z=$O(ORDIV(Z)) Q:Z=""  D
"RTN","PSBCHKIV",16,0)
 .D GETORD^PSBCHIVH(ORDIV(Z))
"RTN","PSBCHKIV",17,0)
 .F S=1:1 Q:$P(PSBONXSB,"^",S)=""  D
"RTN","PSBCHKIV",18,0)
 ..S PSBORD=$P(PSBONXSB,"^",S)
"RTN","PSBCHKIV",19,0)
 ..S PSBGNODE="^PSB(53.79,"_"""AUID"""_","_DFN_")"
"RTN","PSBCHKIV",20,0)
 ..F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE=""  Q:$QS(PSBGNODE,3)'=DFN  D
"RTN","PSBCHKIV",21,0)
 ...I $QS(PSBGNODE,4)=PSBORD  D
"RTN","PSBCHKIV",22,0)
 ....S PSBBIEN=$QS(PSBGNODE,6)
"RTN","PSBCHKIV",23,0)
 ....S PSBSTATS=$P(^PSB(53.79,PSBBIEN,0),U,9) D:(PSBSTATS="I")!(PSBSTATS="S")  Q
"RTN","PSBCHKIV",24,0)
 .....S PSBBUID=$QS(PSBGNODE,5),PSBOR=$$FNDLBLO^PSBVDLU2(PSBPIN,$QS(PSBGNODE,4),PSBBUID),(PSBXOR,PSBLOR)=PSBOR
"RTN","PSBCHKIV",25,0)
 .....; G IV bag
"RTN","PSBCHKIV",26,0)
 .....; IS ORD is "live"
"RTN","PSBCHKIV",27,0)
 .....S PSBNXOR=PSBOR
"RTN","PSBCHKIV",28,0)
 .....S PSBSTOP=0 F  K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBNXOR,1) S:($P(^TMP("PSJ1",$J,0),U,5)']"")&($P($G(^TMP("PSJ1",$J,4)),U,7)<PSBDT) PSBSTOP=1 Q:PSBNXOR=$P(^TMP("PSJ1",$J,0),U,5)  S PSBNXOR=$P(^TMP("PSJ1",$J,0),U,5) Q:PSBNXOR']""
"RTN","PSBCHKIV",29,0)
 .....I 'PSBSTOP F PSBXX=1:1 D  K ^TMP("PSJ1",$J) S:PSBOR="" PSBCO(PSBXOR)=PSBLOR Q:PSBOR=""  ;
"RTN","PSBCHKIV",30,0)
 ......K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBOR,1)
"RTN","PSBCHKIV",31,0)
 ......S PSBDX="" F  S PSBDX=$O(^TMP("PSJ1",$J,PSBDX)) Q:PSBDX=""  I $D(^TMP("PSJ1",$J,PSBDX,1000,PSBBUID)) S PSBLABDT=$P(^TMP("PSJ1",$J,PSBDX,1000,PSBBUID,0),U) Q
"RTN","PSBCHKIV",32,0)
 ......K ^TMP("PSJ2",$J) D EN^PSJBCMA2(DFN,PSBOR,1) D:$D(^TMP("PSJ2",$J))
"RTN","PSBCHKIV",33,0)
 .......S PSBX=0 F  S PSBX=$O(^TMP("PSJ2",$J,PSBX)) Q:PSBX=""  D:$P(^TMP("PSJ2",$J,PSBX,1),U,3)]""
"RTN","PSBCHKIV",34,0)
 ........S PSBCHGDT=$P(^TMP("PSJ2",$J,PSBX,1),U),PSBPARAM=$P(^TMP("PSJ2",$J,PSBX,1),U,3)
"RTN","PSBCHKIV",35,0)
 ........I ($P(^TMP("PSJ2",$J,PSBX,1),U)'<$G(PSBLABDT)) S PSBIVCHG(PSBXOR,PSBCHGDT,PSBPARAM)=" changed to ",PSBIVCHG(PSBXOR,PSBCHGDT,PSBPARAM)=PSBIVCHG(PSBXOR,PSBCHGDT,PSBPARAM)_$$NEWDATA(PSBPARAM)
"RTN","PSBCHKIV",36,0)
 ......M PSBBAGD(PSBXOR,PSBXX,0)=^TMP("PSJ1",$J,0),PSBBAGD(PSBXOR,PSBXX,4)=^TMP("PSJ1",$J,4),PSBBAGD(PSBXOR,PSBXX,2)=^TMP("PSJ1",$J,2)
"RTN","PSBCHKIV",37,0)
 ......F PSBX=800,850,900,950,1000 D
"RTN","PSBCHKIV",38,0)
 .......I "800900"[PSBX M PSBBAGD(PSBXOR,PSBXX,PSBX,PSBBUID)=^TMP("PSJ1",$J,PSBX,PSBBUID)
"RTN","PSBCHKIV",39,0)
 .......I ("850950"[PSBX),'$D(PSBBAGD(PSBXOR,PSBXX,(PSBX-50),PSBBUID)) M PSBBAGD(PSBXOR,PSBXX,PSBX,PSBBUID)=^TMP("PSJ1",$J,PSBX)
"RTN","PSBCHKIV",40,0)
 .......S:PSBXX=1 PSBBUIDS(PSBXOR,PSBBUID)=PSBXOR_U_PSBBUID_U_($P(PSBBAGD(PSBXOR,PSBXX,2),U,2))_U_PSBSTATS
"RTN","PSBCHKIV",41,0)
 .......D:(PSBXX=1)
"RTN","PSBCHKIV",42,0)
 ........I (PSBX=800) F PSBXY=0 S PSBXY=$O(PSBBAGD(PSBXOR,1,800,PSBBUID,PSBXY)) Q:PSBXY=""  S PSBBUIDS(PSBXOR,PSBBUID,"ADD",PSBXY)="ADD"_U_PSBBAGD(PSBXOR,1,800,PSBBUID,PSBXY)
"RTN","PSBCHKIV",43,0)
 ........I (PSBX=900) F PSBXY=0 S PSBXY=$O(PSBBAGD(PSBXOR,1,900,PSBBUID,PSBXY)) Q:PSBXY=""  S PSBBUIDS(PSBXOR,PSBBUID,"SOL",PSBXY)="SOL"_U_PSBBAGD(PSBXOR,1,900,PSBBUID,PSBXY)
"RTN","PSBCHKIV",44,0)
 ........I (PSBX=850) F PSBXY=0 S PSBXY=$O(PSBBAGD(PSBXOR,1,850,PSBBUID,PSBXY)) Q:PSBXY=""  S PSBBUIDS(PSBXOR,PSBBUID,"ADD",PSBXY)="ADD"_U_PSBBAGD(PSBXOR,1,850,PSBBUID,PSBXY,0)
"RTN","PSBCHKIV",45,0)
 ........I (PSBX=950) F PSBXY=0 S PSBXY=$O(PSBBAGD(PSBXOR,1,950,PSBBUID,PSBXY)) Q:PSBXY=""  S PSBBUIDS(PSBXOR,PSBBUID,"SOL",PSBXY)="SOL"_U_PSBBAGD(PSBXOR,1,950,PSBBUID,PSBXY,0)
"RTN","PSBCHKIV",46,0)
 ......S PSBLOR=$P(^TMP("PSJ1",$J,0),U,3),PSBOR=$P(^TMP("PSJ1",$J,0),U,5) K ^TMP("PSJ1",$J)
"RTN","PSBCHKIV",47,0)
 ......I PSBOR["P" S PSBOR=$$PSBNXACT(PSBPIN,PSBOR)
"RTN","PSBCHKIV",48,0)
 S (PSBLINES,RESULTS(0))=0
"RTN","PSBCHKIV",49,0)
 Q:$G(PSBGNODE)=""
"RTN","PSBCHKIV",50,0)
 I $D(PSBBAGD) S PSBXOR="" F  S PSBXOR=$O(PSBBAGD(PSBXOR)) Q:PSBXOR=""  D
"RTN","PSBCHKIV",51,0)
 .S PSBXX=$O(PSBBAGD(PSBXOR,""),-1)
"RTN","PSBCHKIV",52,0)
 .I $P(PSBBAGD(PSBXOR,PSBXX,4),U,7)<PSBDT S PSBLINES=0 Q  ; "Whole of" order exp 3 dAYS ago proc nxt
"RTN","PSBCHKIV",53,0)
 .F PSBXX=1:1:($O(PSBBAGD(PSBXOR,""),-1)-1) S PSBXY=PSBXX+1 D:$D(PSBBAGD(PSBXOR,PSBXY))
"RTN","PSBCHKIV",54,0)
 ..D CLEAN^PSBVT,PSJ1^PSBVT(PSBPIN,$P(PSBBAGD(PSBXOR,PSBXX,0),U,3))
"RTN","PSBCHKIV",55,0)
 ..K PSBOTMP
"RTN","PSBCHKIV",56,0)
 ..I $D(PSBADA) M PSBOTMP("ADD")=PSBADA E  S PSBOTMP("ADD")=""
"RTN","PSBCHKIV",57,0)
 ..I $D(PSBSOLA) M PSBOTMP("SOL")=PSBSOLA E  S PSBOTMP("SOL")=""  ;solut,vol
"RTN","PSBCHKIV",58,0)
 ..K PSBADA,PSBSOLA
"RTN","PSBCHKIV",59,0)
 ..S PSBOTMP("INFUSION RATE")=$G(PSBIFR)
"RTN","PSBCHKIV",60,0)
 ..S PSBOTMP("MED ROUTE")=$G(PSBMR)
"RTN","PSBCHKIV",61,0)
 ..S PSBOTMP("REMARKS")=$G(PSBRMRK)
"RTN","PSBCHKIV",62,0)
 ..S PSBOTMP("OTHER PRINT INFO")=$G(PSBOTXT)
"RTN","PSBCHKIV",63,0)
 ..S PSBOTMP("PROVIDER")=PSBMD
"RTN","PSBCHKIV",64,0)
 ..S PSBOTMP("START DATE/TIME")=PSBOST
"RTN","PSBCHKIV",65,0)
 ..S PSBOTMP("STOP DATE/TIME")=PSBOSP
"RTN","PSBCHKIV",66,0)
 ..D CLEAN^PSBVT,PSJ1^PSBVT(PSBPIN,$P(PSBBAGD(PSBXOR,PSBXY,0),U,3))
"RTN","PSBCHKIV",67,0)
 ..D EN^PSJBCMA2(PSBPIN,$P(PSBBAGD(PSBXOR,PSBXY,0),U,3),1) S:$P(^TMP("PSJ2",$J,1,1),U)]"" PSBCHGDT=$P(^TMP("PSJ2",$J,1,1),U)
"RTN","PSBCHKIV",68,0)
 ..I $D(PSBADA)!($D(PSBOTMP("ADD"))) D CHKADD
"RTN","PSBCHKIV",69,0)
 ..I $D(PSBSOLA)!($D(PSBOTMP("SOL"))) D CHKSOL
"RTN","PSBCHKIV",70,0)
 ..I PSBIFR'=PSBOTMP("INFUSION RATE") S:PSBOTMP("INFUSION RATE")]"" PSBIVCHG(PSBXOR,PSBCHGDT,"INFUSION RATE")=" changed to "_PSBIFR
"RTN","PSBCHKIV",71,0)
 ..I PSBMR'=PSBOTMP("MED ROUTE") S:PSBMR'=PSBOTMP("MED ROUTE")]"" PSBIVCHG(PSBXOR,PSBCHGDT,"MED ROUTE")=" changed to "_PSBMR
"RTN","PSBCHKIV",72,0)
 ..I PSBRMRK'=PSBOTMP("REMARKS") S:PSBOTMP("REMARKS")]"" PSBIVCHG(PSBXOR,PSBCHGDT,"REMARKS")=" changed to "_PSBRMRK
"RTN","PSBCHKIV",73,0)
 ..I PSBOTXT'=PSBOTMP("OTHER PRINT INFO") S:PSBOTMP("OTHER PRINT INFO")]"" PSBIVCHG(PSBXOR,PSBCHGDT,"OTHER PRINT INFO")=" changed to "_PSBOTXT
"RTN","PSBCHKIV",74,0)
 ..I PSBMD'=PSBOTMP("PROVIDER") S:PSBOTMP("PROVIDER")]"" PSBIVCHG(PSBXOR,PSBCHGDT,"PROVIDER")=" changed to "_PSBMDX
"RTN","PSBCHKIV",75,0)
 ..I $E(PSBOST,1,12)'=$E(PSBOTMP("START DATE/TIME"),1,12) S PSBIVCHG(PSBXOR,PSBCHGDT,"START DATE/TIME")=" changed to "_PSBOSTX
"RTN","PSBCHKIV",76,0)
 ..I $E(PSBOSP,1,12)'=$E(PSBOTMP("STOP DATE/TIME"),1,12) S PSBIVCHG(PSBXOR,PSBCHGDT,"STOP DATE/TIME")=" changed to "_PSBOSPX
"RTN","PSBCHKIV",77,0)
 ..D CLEAN^PSBVT
"RTN","PSBCHKIV",78,0)
 ; Get RESULTS
"RTN","PSBCHKIV",79,0)
 D:$D(PSBIVCHG)
"RTN","PSBCHKIV",80,0)
 .S PSBXX="" F  S PSBXX=$O(PSBIVCHG(PSBXX)) S:PSBLINES>0 PSBLINES=PSBLINES+1,RESULTS(PSBLINES)="END",RESULTS(0)=PSBLINES Q:PSBXX=""  D
"RTN","PSBCHKIV",81,0)
 ..S PSBXY="" F  S PSBXY=$O(PSBBUIDS(PSBXX,PSBXY)) Q:PSBXY=""  D
"RTN","PSBCHKIV",82,0)
 ...S PSBLINES=PSBLINES+1,RESULTS(PSBLINES)=PSBBUIDS(PSBXX,PSBXY)_U_PSBCO(PSBXX)
"RTN","PSBCHKIV",83,0)
 ...S PSBXZ=0 F  S PSBXZ=$O(PSBBUIDS(PSBXX,PSBXY,"ADD",PSBXZ)) Q:PSBXZ=""  S PSBLINES=PSBLINES+1,RESULTS(PSBLINES)=PSBBUIDS(PSBXX,PSBXY,"ADD",PSBXZ)
"RTN","PSBCHKIV",84,0)
 ...S PSBXZ=0 F  S PSBXZ=$O(PSBBUIDS(PSBXX,PSBXY,"SOL",PSBXZ)) Q:PSBXZ=""  S PSBLINES=PSBLINES+1,RESULTS(PSBLINES)=PSBBUIDS(PSBXX,PSBXY,"SOL",PSBXZ)
"RTN","PSBCHKIV",85,0)
 ..S PSBXY="" F  S PSBXY=$O(PSBIVCHG(PSBXX,PSBXY),-1) Q:PSBXY=""  D
"RTN","PSBCHKIV",86,0)
 ...S PSBXZ="" F  S PSBXZ=$O(PSBIVCHG(PSBXX,PSBXY,PSBXZ)) Q:PSBXZ=""  D
"RTN","PSBCHKIV",87,0)
 ....I '("ADDITIVE STRENGTH SOLUTION VOLUME "[PSBXZ) S PSBLINES=PSBLINES+1,RESULTS(PSBLINES)="CD"_U_PSBXY_U_PSBXZ_PSBIVCHG(PSBXX,PSBXY,PSBXZ)
"RTN","PSBCHKIV",88,0)
 ....I "ADDITIVE STRENGTH SOLUTION VOLUME "[PSBXZ S PSBZX="" F  S PSBZX=$O(PSBIVCHG(PSBXX,PSBXY,PSBXZ,PSBZX)) Q:PSBZX=""  S PSBLINES=PSBLINES+1,RESULTS(PSBLINES)="CD"_U_PSBXY_U_PSBXZ_PSBIVCHG(PSBXX,PSBXY,PSBXZ,PSBZX)
"RTN","PSBCHKIV",89,0)
 K PSBIVCHG,PSBLINES,PSBBAGD,PSBAD,PSBSOL
"RTN","PSBCHKIV",90,0)
 Q
"RTN","PSBCHKIV",91,0)
CHKADD N X,PSBADDS ; Check addit(s)
"RTN","PSBCHKIV",92,0)
 I '$D(PSBADA),'$D(PSBOTMP("ADD")) Q  ; no adds
"RTN","PSBCHKIV",93,0)
 S X="" F  S X=$O(PSBOTMP("ADD",X)) Q:X=""  K PSBAD,PSBSTR S PSBAD=$P(PSBOTMP("ADD",X),U,2),PSBSTR=$P(PSBOTMP("ADD",X),U,4),PSBADDS(PSBAD,PSBSTR)=PSBOTMP("ADD",X)
"RTN","PSBCHKIV",94,0)
 S X="" F  S X=$O(PSBADA(X)) Q:X=""  D
"RTN","PSBCHKIV",95,0)
 .K PSBAD,PSBSTR S PSBAD=$P(PSBADA(X),U,2),PSBSTR=$P(PSBADA(X),U,4)
"RTN","PSBCHKIV",96,0)
 .I $D(PSBADDS(PSBAD,PSBSTR)) K PSBADDS(PSBAD,PSBSTR) Q
"RTN","PSBCHKIV",97,0)
 .I '$D(PSBADDS(PSBAD)) S PSBTXT=PSBADA(X),$P(PSBTXT,U,1)="",$P(PSBTXT,U,2)="",PSBIVCHG(PSBXOR,PSBCHGDT,"ADDITIVE",PSBAD)=" added"_$TR(PSBTXT,U," ")
"RTN","PSBCHKIV",98,0)
 .E  K PSBADDS(PSBAD) S PSBIVCHG(PSBXOR,PSBCHGDT,"STRENGTH ",PSBAD)=$P(PSBADA(X),U,3)_" changed to "_$P(PSBADA(X),U,4)
"RTN","PSBCHKIV",99,0)
 S X="" F  S X=$O(PSBADDS(X)) Q:X=""  I '$D(PSBIVCHG(PSBXOR,PSBCHGDT,"ADDITIVE",X)) S PSBTXT=PSBADDS(X,($O(PSBADDS(X,"")))),$P(PSBTXT,U,1)="",$P(PSBTXT,U,2)="",PSBIVCHG(PSBXOR,PSBOST,"ADDITIVE",X)=" deleted"_$TR(PSBTXT,U," ")
"RTN","PSBCHKIV",100,0)
 Q
"RTN","PSBCHKIV",101,0)
CHKSOL N Y,PSBSOLS ; Check solut(s)
"RTN","PSBCHKIV",102,0)
 I '$D(PSBSOLA),'$D(PSBOTMP("SOL")) Q  ; no sols
"RTN","PSBCHKIV",103,0)
 S Y="" F  S Y=$O(PSBOTMP("SOL",Y)) Q:Y=""  K PSBSOL,PSBVOL S PSBSOL=$P(PSBOTMP("SOL",Y),U,2),PSBVOL=$P(PSBOTMP("SOL",Y),U,4),PSBSOLS(PSBSOL,PSBVOL)=PSBOTMP("SOL",Y)
"RTN","PSBCHKIV",104,0)
 S Y="" F  S Y=$O(PSBSOLA(Y)) Q:Y=""  D
"RTN","PSBCHKIV",105,0)
 .K PSBSOL,PSBVOL S PSBSOL=$P(PSBSOLA(Y),U,2),PSBVOL=$P(PSBSOLA(Y),U,4)
"RTN","PSBCHKIV",106,0)
 .I $D(PSBSOLS(PSBSOL,PSBVOL)) K PSBSOLS(PSBSOL,PSBVOL) Q
"RTN","PSBCHKIV",107,0)
 .I '$D(PSBSOLS(PSBSOL)) S PSBTXT=PSBSOLA(Y),$P(PSBTXT,U,1)="",$P(PSBTXT,U,2)="",PSBIVCHG(PSBXOR,PSBCHGDT,"SOLUTION",PSBSOL)=" added"_$TR(PSBTXT,U," ")
"RTN","PSBCHKIV",108,0)
 .E  K PSBSOLS(PSBSOL) S PSBIVCHG(PSBXOR,PSBCHGDT,"VOLUME ",PSBSOL)=$P(PSBSOLA(Y),U,3)_" changed to "_$P(PSBSOLA(Y),U,4)
"RTN","PSBCHKIV",109,0)
 S Y="" F  S Y=$O(PSBSOLS(Y)) Q:Y=""  S:'$D(PSBIVCHG(PSBXOR,PSBCHGDT,"SOLUTION",Y)) PSBTXT=PSBSOLS(Y,($O(PSBSOLS(Y,"")))),$P(PSBTXT,U,1)="",$P(PSBTXT,U,2)="",PSBIVCHG(PSBXOR,PSBCHGDT,"SOLUTION",Y)=" deleted"_$TR(PSBTXT,U," ")
"RTN","PSBCHKIV",110,0)
 Q
"RTN","PSBCHKIV",111,0)
PSBNXACT(DFN,PORDN) ;
"RTN","PSBCHKIV",112,0)
 N PSBDFN,PSBOR S PSBDFN=DFN,PSBOR=PORDN K PSBDID
"RTN","PSBCHKIV",113,0)
 S PSBNXACT="" I (PSBDFN="")!(PSBOR="")!(PSBOR'["P") Q PSBNXACT
"RTN","PSBCHKIV",114,0)
 F  Q:PSBOR=""  Q:$D(PSBDID(PSBOR))  D
"RTN","PSBCHKIV",115,0)
 .K ^TMP("PSJ1",$J) D EN^PSJBCMA1(PSBDFN,PSBOR,1) S PSBOR=$P(^TMP("PSJ1",$J,0),U,5) K ^TMP("PSJ1",$J)
"RTN","PSBCHKIV",116,0)
 .I $G(PSBOR)]"",$G(PSBOR)'["P" S PSBNXACT=PSBOR S PSBOR=""
"RTN","PSBCHKIV",117,0)
 .E  S:$G(PSBOR)]"" (PSBNXACT,PSBDID($G(PSBOR)))=""
"RTN","PSBCHKIV",118,0)
 .K ^TMP("PSJ1",$J)
"RTN","PSBCHKIV",119,0)
 I PSBNXACT="" D EN^PSJBCMA1(PSBDFN,PSBLOR,1) I $P(^TMP("PSJ1",$J,4),U,7)<PSBDT K PSBBAGD(PSBXOR),PSBBUIDS(PSBXOR),PSBIVCHG(PSBXOR)
"RTN","PSBCHKIV",120,0)
 Q PSBNXACT
"RTN","PSBCHKIV",121,0)
NEWDATA(PSBPARM) ;
"RTN","PSBCHKIV",122,0)
 S NEWDATA="" N PSBDX S PSBDX="",PSBDX=$O(PSBIVCHG(PSBXOR,PSBDX),-1)
"RTN","PSBCHKIV",123,0)
 F  S PSBDX=$O(PSBIVCHG(PSBXOR,PSBDX),-1) Q:PSBDX=""  D:$D(PSBIVCHG(PSBXOR,PSBDX,PSBPARM))  Q:PSBDX=""
"RTN","PSBCHKIV",124,0)
 .S PSBIVCHG(PSBXOR,PSBDX,PSBPARM)=" changed to "_$G(^TMP("PSJ2",$J,PSBX,2)),PSBDX=""
"RTN","PSBCHKIV",125,0)
 I $G(PSBPARM)="INFUSION RATE" Q $P(^TMP("PSJ1",$J,2),U,4)
"RTN","PSBCHKIV",126,0)
 I $G(PSBPARM)="MED ROUTE" Q $P(^TMP("PSJ1",$J,1),U,13)
"RTN","PSBCHKIV",127,0)
 I $G(PSBPARM)="PROVIDER" Q $P(^TMP("PSJ1",$J,1),U,2)
"RTN","PSBCHKIV",128,0)
 I $G(PSBPARM)="REMARKS" Q $G(^TMP("PSJ1",$J,6))
"RTN","PSBCHKIV",129,0)
 I $G(PSBPARM)="OTHER PRINT INFO" Q $G(^TMP("PSJ1",$J,3))
"RTN","PSBCHKIV",130,0)
 I $G(PSBPARM)="STOP DATE/TIME" Q $P(^TMP("PSJ1",$J,4),U,8)
"RTN","PSBCHKIV",131,0)
 I $G(PSBPARM)="START DATE/TIME" Q $P(^TMP("PSJ1",$J,4),U,6)
"RTN","PSBCHKIV",132,0)
 Q NEWDATA
"RTN","PSBCSUTL")
0^1^B74276312
"RTN","PSBCSUTL",1,0)
PSBCSUTL ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES ;Mar 2004
"RTN","PSBCSUTL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16**;Mar 2004
"RTN","PSBCSUTL",3,0)
 ;
"RTN","PSBCSUTL",4,0)
 ; Reference/IA
"RTN","PSBCSUTL",5,0)
 ;
"RTN","PSBCSUTL",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBCSUTL",7,0)
 ; IN5^VADPT/10061
"RTN","PSBCSUTL",8,0)
 ; $$GET^XPAR/2263
"RTN","PSBCSUTL",9,0)
 ; ^%DTC/10000
"RTN","PSBCSUTL",10,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBCSUTL",11,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTL",12,0)
 ;
"RTN","PSBCSUTL",13,0)
RPC(RESULTS,DFN) ;
"RTN","PSBCSUTL",14,0)
 K RESULTS,^TMP("PSB",$J),^TMP("PSJ",$J)
"RTN","PSBCSUTL",15,0)
 S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",16,0)
 N PSBCNT S PSBTRFL=0,PSBDFNX=DFN
"RTN","PSBCSUTL",17,0)
 S RESULTS=$NAME(^TMP("PSB",$J,PSBTAB))
"RTN","PSBCSUTL",18,0)
 K ^TMP("PSB",$J,PSBTAB) S ^TMP("PSB",$J,PSBTAB,0)=1 D LIGHTS(PSBDFNX)
"RTN","PSBCSUTL",19,0)
 S ^TMP("PSB",$J,PSBTAB,0)=1,^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,PSBTAB,1)
"RTN","PSBCSUTL",20,0)
 Q:$P(^TMP("PSB",$J,PSBTAB,1),U,4)=-1
"RTN","PSBCSUTL",21,0)
 D NOW^%DTC S PSBNOW=+$E(%,1,10),PSBDT=$P(%,".",1)
"RTN","PSBCSUTL",22,0)
 ;set range
"RTN","PSBCSUTL",23,0)
 S PSBWBEG=$$FMADD^XLFDT(PSBNOW,"",-24),PSBWEND=$$FMADD^XLFDT(PSBNOW,"",24)
"RTN","PSBCSUTL",24,0)
 S PSBTBEG=$$FMADD^XLFDT(PSBNOW,"",-12),PSBTEND=$$FMADD^XLFDT(PSBNOW,"",12)
"RTN","PSBCSUTL",25,0)
 S PSBWADM=$$GET^XPAR("DIV","PSB ADMIN BEFORE"),PSBMHBCK=$$GET^XPAR("ALL","PSB MED HIST DAYS BACK",,"B") I +PSBMHBCK=0 S PSBMHBCK=30
"RTN","PSBCSUTL",26,0)
 D NOW^%DTC S PSBWADM=$$FMADD^XLFDT(%,"","",+PSBWADM),PSBMHBCK=$$FMADD^XLFDT(%,-1*(PSBMHBCK))
"RTN","PSBCSUTL",27,0)
 ;use lst movemnt for API
"RTN","PSBCSUTL",28,0)
 S VAIP("D")="LAST" D IN5^VADPT S PSBTRDT=+VAIP(3),PSBTRTYP=$P(VAIP(2),U,2),PSBMVTYP=$P(VAIP(4),U,2) K VAIP
"RTN","PSBCSUTL",29,0)
 S PSBPTTR=$$GET^XPAR("DIV","PSB PATIENT TRANSFER") I PSBPTTR="" S PSBPTTR=72
"RTN","PSBCSUTL",30,0)
 D NOW^%DTC S PSBNTDT=$$FMADD^XLFDT(%,"",-PSBPTTR) I PSBNTDT'>PSBTRDT S PSBTRFL=1
"RTN","PSBCSUTL",31,0)
 S X1=$P(PSBNOW,"."),X2=-3 D C^%DTC
"RTN","PSBCSUTL",32,0)
 D EN^PSJBCMA(PSBDFNX,X,PSBMHBCK)
"RTN","PSBCSUTL",33,0)
 ;Devlop Outp
"RTN","PSBCSUTL",34,0)
 S PSBTBOUT=0
"RTN","PSBCSUTL",35,0)
 I ^TMP("PSJ",$J,1,0)>0 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBCSUTL",36,0)
 .S:(PSBTAB'="CVRSHT")&($G(^TMP("PSB",$J,"CVRSHT",2))>0) PSBTBOUT=1
"RTN","PSBCSUTL",37,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX),NOW^%DTC
"RTN","PSBCSUTL",38,0)
 .Q:PSBONX["P"  Q:(PSBOSP<PSBWBEG)&'(PSBONX["V")  ;in rnge?
"RTN","PSBCSUTL",39,0)
 .S (PSBREC,PSBONTAB)=""
"RTN","PSBCSUTL",40,0)
 .S $P(PSBREC,U,1)=PSBDFN ;Dfn
"RTN","PSBCSUTL",41,0)
 .S $P(PSBREC,U,2)=PSBONX ;Ordr 
"RTN","PSBCSUTL",42,0)
 .S $P(PSBREC,U,3)=PSBON ;OrdrIen
"RTN","PSBCSUTL",43,0)
 .S $P(PSBREC,U,4)=PSBOTYP ;iv/ud/pend
"RTN","PSBCSUTL",44,0)
 .S $P(PSBREC,U,5)=PSBSCHT ;Schdtype
"RTN","PSBCSUTL",45,0)
 .S $P(PSBREC,U,6)=PSBSCH ;Schd
"RTN","PSBCSUTL",46,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; selfmed
"RTN","PSBCSUTL",47,0)
 .S $P(PSBREC,U,8)=PSBOITX ;Drgname
"RTN","PSBCSUTL",48,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ;Dose
"RTN","PSBCSUTL",49,0)
 .S $P(PSBREC,U,10)=PSBMR ;Rout
"RTN","PSBCSUTL",50,0)
 .;Lst Gvn - AOIP xRef
"RTN","PSBCSUTL",51,0)
 .S (PSBCNT,PSBFLAG)=0,(Y,PSBSTUS)="" K PSBHSTA,PSBHSTAX
"RTN","PSBCSUTL",52,0)
 .F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",53,0)
 ..S:Y>0 $P(PSBREC,U,11)=Y
"RTN","PSBCSUTL",54,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",55,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9) S:$G(PSBSTUS)="" PSBSTUS="X" I (PSBSTUS'="N") S PSBFLAG=1,PSBHSTA(Y,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBCSUTL",56,0)
 ...D:PSBSTUS="N"
"RTN","PSBCSUTL",57,0)
 ....S ($P(PSBREC,U,11),Z)=""
"RTN","PSBCSUTL",58,0)
 ....F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",59,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",60,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",61,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBCSUTL",62,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBCSUTL",63,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBCSUTL",64,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBCSUTL",65,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBCSUTL",66,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBCSUTL",67,0)
 .S $P(PSBREC,U,12)="" ;ien - below
"RTN","PSBCSUTL",68,0)
 .S $P(PSBREC,U,13)="" ;sttus - below
"RTN","PSBCSUTL",69,0)
 .S $P(PSBREC,U,14)="" ;admn dte - below
"RTN","PSBCSUTL",70,0)
 .S $P(PSBREC,U,15)=PSBOIT ;OI Pointer
"RTN","PSBCSUTL",71,0)
 .S $P(PSBREC,U,16)=0  ;Deflt no-inject
"RTN","PSBCSUTL",72,0)
 .F X="ID","IV","IM","SC","SQ" D  Q:$P(PSBREC,U,16)
"RTN","PSBCSUTL",73,0)
 ..I PSBMR?@(".E1"""_X_""".E"),PSBMR'["MISC" S $P(PSBREC,U,16)=1
"RTN","PSBCSUTL",74,0)
 .;Vari dosg
"RTN","PSBCSUTL",75,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBCSUTL",76,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBCSUTL",77,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH") $P(PSBREC,U,18)=PSBDOSEF ;DosgFrm
"RTN","PSBCSUTL",78,0)
 .D PSJ1^PSBVT(PSBDFN,PSBONX)
"RTN","PSBCSUTL",79,0)
 .S PSBPB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBMR)),PSBLVIV=0
"RTN","PSBCSUTL",80,0)
 .Q:PSBPB&(PSBOSP<PSBWBEG)
"RTN","PSBCSUTL",81,0)
 .S:(PSBONX["V"&'PSBPB) PSBLVIV=1
"RTN","PSBCSUTL",82,0)
 .S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***") ;VerfNrsIntls
"RTN","PSBCSUTL",83,0)
 .S $P(PSBREC,U,20)=PSBSTUS S:$P(PSBREC,U,11)="" $P(PSBREC,U,20)=""  ;LstActnSts
"RTN","PSBCSUTL",84,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBCSUTL",85,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBCSUTL",86,0)
 .S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBCSUTL",87,0)
 .S $P(PSBREC,U,26)=PSBOSP  ;OrdrStpDt/Tm
"RTN","PSBCSUTL",88,0)
 .S $P(PSBREC,U,27)=$$LASTG($P(PSBREC,U,1),$P(PSBREC,U,15))
"RTN","PSBCSUTL",89,0)
 .S $P(PSBREC,U,28)=$S((PSBONX["U")&('PSBPB):1,PSBPB:2,(PSBONX["V")&'PSBPB:3,1:"")
"RTN","PSBCSUTL",90,0)
 .;get all Admn(s) pr ordr
"RTN","PSBCSUTL",91,0)
 .I PSBLVIV D XFERBAGS^PSBCSUTY,LVIV^PSBCSUTY Q:$G(PSBEXPRD)
"RTN","PSBCSUTL",92,0)
 .D GETADMX^PSBCSUTY
"RTN","PSBCSUTL",93,0)
 .;DD info.
"RTN","PSBCSUTL",94,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBCSUTL",95,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBCSUTL",96,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1  ;drug nactvted
"RTN","PSBCSUTL",97,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ;nactv
"RTN","PSBCSUTL",98,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBCSUTL",99,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBCSUTL",100,0)
 .;OnCallOneTmPRN
"RTN","PSBCSUTL",101,0)
 .I ("^O^OC^P^"[(U_PSBSCHT_U))!(PSBLVIV) D  S ($P(PSBREC,U,12),$P(PSBREC,U,14))=""  Q
"RTN","PSBCSUTL",102,0)
 ..S (PSBIENX,PSBGOT1)="",PSBADMTM="" F  S PSBADMTM=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM)) Q:(PSBADMTM="")  D
"RTN","PSBCSUTL",103,0)
 ...Q:(PSBADMTM<PSBMHBCK)&'PSBLVIV
"RTN","PSBCSUTL",104,0)
 ...F  S PSBIENX=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM,PSBIENX)) Q:PSBIENX=""  D
"RTN","PSBCSUTL",105,0)
 ....S $P(PSBREC,U,12)=PSBIENX,$P(PSBREC,U,14)=PSBADMTM,$P(PSBREC,U,23)=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTL",106,0)
 ....S PSBQRR=1 D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBADMTM,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",107,0)
 ..I ('+PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",108,0)
 ..I ('+PSBGOT1)&($D(PSBADMX(PSBONX))) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTL",109,0)
 ..S PSBGLBX=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,PSBGLBX)'="END" ^TMP("PSB",$J,PSBTAB,PSBGLBX+1)="END"
"RTN","PSBCSUTL",110,0)
 .;continu - proces AdmnTm
"RTN","PSBCSUTL",111,0)
 .S (PSBYES,PSBODD,PSBYTF)=0 S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBCSUTL",112,0)
 .I PSBYES,PSBADST="" Q
"RTN","PSBCSUTL",113,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBCSUTL",114,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" Q
"RTN","PSBCSUTL",115,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBCSUTL",116,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBCSUTL",117,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBCSUTL",118,0)
 .S:PSBLVIV PSBYES=1
"RTN","PSBCSUTL",119,0)
 .I 'PSBYES,PSBFREQ<1 Q
"RTN","PSBCSUTL",120,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1(PSBTAB) Q
"RTN","PSBCSUTL",121,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBCSUTL",122,0)
 .I PSBODD,PSBADST'="" Q
"RTN","PSBCSUTL",123,0)
 .S PSBDTX=PSBWBEG\1,PSBGOT1=0
"RTN","PSBCSUTL",124,0)
 .F PSBXX=1:1:2 D  S PSBDTX=$$FMADD^XLFDT(PSBDTX,"",24)  ;incrmnt 1 day!
"RTN","PSBCSUTL",125,0)
 ..F PSBY=1:1:$L(PSBADST,"-") Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBCSUTL",126,0)
 ...S PSB=+(PSBDTX_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",127,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",128,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)      ;actv?
"RTN","PSBCSUTL",129,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",130,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",131,0)
 ...S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",132,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",133,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)      ;actv?
"RTN","PSBCSUTL",134,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",135,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",136,0)
 .I ('PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,+(PSBWEND\1_"."_$P(PSBADST,"-")),PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTL",137,0)
 .K PSBSTUS
"RTN","PSBCSUTL",138,0)
 D EN^PSBVDLPA
"RTN","PSBCSUTL",139,0)
 S ^TMP("PSB",$J,PSBTAB,0)=$O(^TMP("PSB",$J,PSBTAB,""),-1)
"RTN","PSBCSUTL",140,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))']"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="-1^No orders To display on Coversheet"
"RTN","PSBCSUTL",141,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="1^COVERSHEET DATA FOLLOWS" D ADD^PSBCSUTX
"RTN","PSBCSUTL",142,0)
 D CLEAN
"RTN","PSBCSUTL",143,0)
 Q
"RTN","PSBCSUTL",144,0)
LASTG(PSBPATPT,PSBOIPT) ;LstGvn-(inpt: DFN,OrdrblItm IEN)
"RTN","PSBCSUTL",145,0)
 K PSBHSTG S (Y)="",LASTG="" F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",146,0)
 .S:Y>0 LASTG=Y,X="" F  S X=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",147,0)
 ..S PSBSTX=$P(^PSB(53.79,X,0),U,9) I PSBSTX="G"  S PSBHSTG(Y)=""
"RTN","PSBCSUTL",148,0)
 ..Q
"RTN","PSBCSUTL",149,0)
 I $D(PSBHSTG) S LASTG="",LASTG=$O(PSBHSTG(LASTG),-1)
"RTN","PSBCSUTL",150,0)
 I '$D(PSBHSTG) S LASTG=""
"RTN","PSBCSUTL",151,0)
 Q LASTG
"RTN","PSBCSUTL",152,0)
LIGHTS(PSBDFN) ;
"RTN","PSBCSUTL",153,0)
 D RPC^PSBVDLTB(,PSBDFN,"NO TAB",) S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",154,0)
 M ^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,"NO TAB",1) K ^TMP("PSB",$J,"NO TAB")
"RTN","PSBCSUTL",155,0)
 Q
"RTN","PSBCSUTL",156,0)
CLEAN ;
"RTN","PSBCSUTL",157,0)
 D CLEAN^PSBVT
"RTN","PSBCSUTL",158,0)
 K PSBACT,PSBACTBY,PSBACTDT,PSBACTPT,PSBADDS,PSBBAGID,PSBCHDT,PSBCHKV,PSBCNT1,PSBCNT2,PSBDDS,PSBDFNX,PSBWEND
"RTN","PSBCSUTL",159,0)
 K PSBDT,PSBFLAG,PSBHSTAX,PSBI1,PSBIEN,PSBIENX,PSBLSTS,PSBMAUD,PSBMVTYP,PSBMWC,PSBNOW,PSBNTDT,PSBONMBR,PSBY,PSBXX
"RTN","PSBCSUTL",160,0)
 K PSBONXS,PSBORREC,PSBPDT,PSBPRNRE,PSBPTTR,PSBQR,PSBRDOW,PSBREC,PSBRECHD,PSBSCHBR,PSBSCHTM,PSBSOLS,PSBTAB,PSBADMTM,PSBDTX
"RTN","PSBCSUTL",161,0)
 K PSBTBOUT,PSBTRDT,PSBTRFL,PSBTRTYP,PSBUID,PSBUIDS,PSBX,PSBXIEN,PSBX2,PSBYEA,PSBYEA1,PSBYTF,PSBYES,VAIP,PSBWADM,PSBWBEG
"RTN","PSBCSUTL",162,0)
 K PSBXREC,PSBGOT1,PSBCDT,PSBQUIT,PSBUSED,PSBLST4X,PSBADMX,PSBI2,PSBXXX,PSBI,PSBPB,PSBSHWTB,PSBONTAB,PSBDONE,^TMP("PSJ",$J)
"RTN","PSBCSUTL",163,0)
 K PSBNXTDU,LASTG,LSTTIME,PSBMHBCK,PSBHSTG,PSBNXTDT,NEXTADM,PSBLVIV
"RTN","PSBCSUTL",164,0)
 Q
"RTN","PSBCSUTX")
0^2^B78601969
"RTN","PSBCSUTX",1,0)
PSBCSUTX ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES 2 ;Mar 2004
"RTN","PSBCSUTX",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16**;Mar 2004
"RTN","PSBCSUTX",3,0)
 ;
"RTN","PSBCSUTX",4,0)
 ; Reference/IA
"RTN","PSBCSUTX",5,0)
 ; File 200/10060
"RTN","PSBCSUTX",6,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTX",7,0)
 ; $$SCH^XLFDT/10103
"RTN","PSBCSUTX",8,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBCSUTX",9,0)
 ;
"RTN","PSBCSUTX",10,0)
ADD ; output:  ORD-ORC-DD-ADD-SOL-ID-ADM-CMT-END segmnts
"RTN","PSBCSUTX",11,0)
 K PSBDONE S PSBRECHD="ORD",PSBDONE=0,PSBCNT1=^TMP("PSB",$J,PSBTAB,0),PSBCNT2=1,$P(^TMP("PSB",$J,"CVRSHT2",0),U)=0
"RTN","PSBCSUTX",12,0)
 F PSBI1=1:1:PSBCNT1 D  Q:PSBDONE
"RTN","PSBCSUTX",13,0)
 .I PSBCNT1'>1 S PSBDONE=1 Q
"RTN","PSBCSUTX",14,0)
 .I PSBI1=1 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT2)=^TMP("PSB",$J,"CVRSHT",1) Q
"RTN","PSBCSUTX",15,0)
 .I ^TMP("PSB",$J,PSBTAB,PSBI1)="END" S PSBRECHD="ORD",PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="END"  Q
"RTN","PSBCSUTX",16,0)
 .I PSBRECHD="ORD" D ORD Q
"RTN","PSBCSUTX",17,0)
 .I PSBRECHD="ORC" D ORC Q
"RTN","PSBCSUTX",18,0)
 .I PSBRECHD="MED" D MED Q
"RTN","PSBCSUTX",19,0)
 S $P(^TMP("PSB",$J,"CVRSHT2",0),U)=PSBCNT2
"RTN","PSBCSUTX",20,0)
 M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K PSBNXTDU D ADM
"RTN","PSBCSUTX",21,0)
 K ^TMP("PSB",$J,PSBTAB) M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K ^TMP("PSB",$J,"CVRSHT2") D FINALPAS
"RTN","PSBCSUTX",22,0)
 K ^TMP("PSB",$J,PSBTAB) M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K ^TMP("PSB",$J,"CVRSHT2")
"RTN","PSBCSUTX",23,0)
 Q
"RTN","PSBCSUTX",24,0)
ORD ; Ordr
"RTN","PSBCSUTX",25,0)
 S PSBCNT2=PSBCNT2+1,(PSBORREC,PSBXREC)=^TMP("PSB",$J,PSBTAB,PSBI1)
"RTN","PSBCSUTX",26,0)
 S ($P(PSBXREC,U,12),$P(PSBXREC,U,23),$P(PSBXREC,U,24),PSBSCHTM,PSBONMBR,PSBIENX,PSBBAGID,PSBACT,PSBACTBY,PSBACTDT,PSBACTPT,PSBPRNRE,PSBXX,PSBXXX)=""
"RTN","PSBCSUTX",27,0)
 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORD",$P(^TMP("PSB",$J,"CVRSHT2",PSBCNT2),U,2)=PSBXREC
"RTN","PSBCSUTX",28,0)
 S PSBSCHTM=$P(PSBORREC,U,14),PSBONMBR=$P(PSBORREC,U,2),PSBIENX=$P(PSBORREC,U,12),PSBLRGIV=0
"RTN","PSBCSUTX",29,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBONMBR) S:(PSBONMBR["V")&'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBMR)) PSBLRGIV=1
"RTN","PSBCSUTX",30,0)
 I '$D(PSBLST4X(PSBONMBR)) S PSBXX="" F PSBI=1:1 S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX),-1) Q:PSBXX=""  S PSBXXX="" D  Q:$G(PSBLST4X(PSBONMBR))=4
"RTN","PSBCSUTX",31,0)
 .F  S PSBXXX=$O(PSBADMX(PSBONMBR,PSBXX,PSBXXX)) Q:PSBXXX=""  D  Q:$G(PSBLST4X(PSBONMBR))=4
"RTN","PSBCSUTX",32,0)
 ..I $$GET1^DIQ(53.79,PSBXXX_",","ACTION STATUS","I")'="N"  S PSBLST4X(PSBONMBR,PSBXXX)="",PSBLST4X(PSBONMBR)=$G(PSBLST4X(PSBONMBR))+1
"RTN","PSBCSUTX",33,0)
 I PSBIENX]"",$D(PSBLST4X(PSBONMBR,PSBIENX)) D
"RTN","PSBCSUTX",34,0)
 .S PSBBAGID=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTX",35,0)
 .S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",36,0)
 .S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",37,0)
 .S PSBPRNRE=$$GET1^DIQ(53.79,PSBIENX_",","PRN REASON")
"RTN","PSBCSUTX",38,0)
 .S PSBACTBY=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY:INITIAL") S:PSBACTBY']"" PSBACTBY="***"
"RTN","PSBCSUTX",39,0)
 .S PSBACTPT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY","I")
"RTN","PSBCSUTX",40,0)
 .I '$D(PSBDONE(PSBIENX)) D
"RTN","PSBCSUTX",41,0)
 ..I PSBLRGIV,(PSBFON]"") Q
"RTN","PSBCSUTX",42,0)
 ..S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^"_PSBBAGID_"^"_PSBIENX_"^"_PSBACT_"^"_PSBACTDT_"^"_PSBACTBY_"^"_PSBACTPT_"^"_PSBPRNRE
"RTN","PSBCSUTX",43,0)
 ..I PSBLRGIV D
"RTN","PSBCSUTX",44,0)
 ...I PSBOSP<PSBNOW S PSBADMS(PSBONMBR,"EXP")=""
"RTN","PSBCSUTX",45,0)
 ...S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX,1)=1
"RTN","PSBCSUTX",46,0)
 ..S PSBDONE(PSBIENX)="" K PSBADMX(PSBONMBR,PSBSCHTM,PSBIENX) D
"RTN","PSBCSUTX",47,0)
 ...S PSBXX="" F  S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX)) Q:PSBXX=""  I $D(PSBADMX(PSBONMBR,PSBXX,PSBIENX)) K PSBADMX(PSBONMBR,PSBXX,PSBIENX)
"RTN","PSBCSUTX",48,0)
 I PSBIENX']"" D
"RTN","PSBCSUTX",49,0)
 .S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^^^^^^^"
"RTN","PSBCSUTX",50,0)
 .I PSBLRGIV S PSBADMS(PSBONMBR,PSBSCHTM,1)=1
"RTN","PSBCSUTX",51,0)
 I '$D(PSBADMS(PSBONMBR)) S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^^^^^^^"
"RTN","PSBCSUTX",52,0)
 S PSBRECHD="ORC" K PSBSCHTM S PSBXREC=""
"RTN","PSBCSUTX",53,0)
 Q
"RTN","PSBCSUTX",54,0)
ORC ; Ordr commnts
"RTN","PSBCSUTX",55,0)
 S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORC",$P(^TMP("PSB",$J,"CVRSHT2",PSBCNT2),U,2)=^TMP("PSB",$J,PSBTAB,PSBI1),PSBRECHD="MED"
"RTN","PSBCSUTX",56,0)
 Q
"RTN","PSBCSUTX",57,0)
MED ; Cnstr DD,ADD,SOL,ID segms
"RTN","PSBCSUTX",58,0)
 S PSBXREC=^TMP("PSB",$J,PSBTAB,PSBI1)
"RTN","PSBCSUTX",59,0)
 Q:$$QUT^PSBCSUTY()
"RTN","PSBCSUTX",60,0)
 I $P(PSBXREC,U)="ID" S PSBUSED=$$USED^PSBCSUTY()  Q:PSBUSED
"RTN","PSBCSUTX",61,0)
 S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)=^TMP("PSB",$J,PSBTAB,PSBI1)
"RTN","PSBCSUTX",62,0)
 Q
"RTN","PSBCSUTX",63,0)
ADM ; AdmnInfo
"RTN","PSBCSUTX",64,0)
 K PSBDONE S (PSBONMBR,PSBSCHTM)="" F PSBI1=2:1:$P(^TMP("PSB",$J,PSBTAB,0),U) D
"RTN","PSBCSUTX",65,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1),U)="ORD" S PSBONMBR=$P(^TMP("PSB",$J,PSBTAB,PSBI1),U,3),$P(^TMP("PSB",$J,"CVRSHT2",PSBI1),U,15)=""
"RTN","PSBCSUTX",66,0)
 .S (PSBXX,PSBXXX)="" F  S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX)) Q:PSBXX=""  F  S PSBXXX=$O(PSBADMX(PSBONMBR,PSBXX,PSBXXX)) Q:PSBXXX=""  D
"RTN","PSBCSUTX",67,0)
 ..S PSBSCHTM=PSBXX,PSBIENX=PSBXXX
"RTN","PSBCSUTX",68,0)
 ..Q:'$D(PSBLST4X(PSBONMBR,PSBIENX))
"RTN","PSBCSUTX",69,0)
 ..S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",70,0)
 ..I PSBACT']"" S PSBACT="* UNKNOWN *"
"RTN","PSBCSUTX",71,0)
 ..S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",72,0)
 ..S PSBBAGID=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTX",73,0)
 ..S PSBPRNRE=$$GET1^DIQ(53.79,PSBIENX_",","PRN REASON")
"RTN","PSBCSUTX",74,0)
 ..S PSBACTBY=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY:INITIAL") S:PSBACTBY']"" PSBACTBY="***"
"RTN","PSBCSUTX",75,0)
 ..S PSBACTPT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY","I")
"RTN","PSBCSUTX",76,0)
 ..S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^"_PSBBAGID_"^"_PSBIENX_"^"_PSBACT_"^"_PSBACTDT_"^"_PSBACTBY_"^"_PSBACTPT_"^"_PSBPRNRE
"RTN","PSBCSUTX",77,0)
 ..I PSBIENX]"" K PSBADMX(PSBONMBR,PSBSCHTM,PSBIENX)
"RTN","PSBCSUTX",78,0)
 .I '$D(PSBADMS(PSBONMBR)) K ^TMP("PSB",$J,"CVRSHT2",PSBI1) Q
"RTN","PSBCSUTX",79,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1),U)="END" K PSBADMS(PSBONMBR) Q
"RTN","PSBCSUTX",80,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1+1),U)="END" D  Q
"RTN","PSBCSUTX",81,0)
 ..S PSBCNT2=1,PSBSCHTM=""
"RTN","PSBCSUTX",82,0)
 ..F  S PSBSCHTM=$O(PSBADMS(PSBONMBR,PSBSCHTM)) Q:+$G(PSBSCHTM)=0  D
"RTN","PSBCSUTX",83,0)
 ...S PSBIENX=$P(PSBADMS(PSBONMBR,PSBSCHTM),U,3)
"RTN","PSBCSUTX",84,0)
 ...I PSBIENX]"",'$D(PSBDONE(PSBIENX))  D
"RTN","PSBCSUTX",85,0)
 ....S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",86,0)
 ....I PSBACT']"" S PSBACT="* UNKNOWN *"
"RTN","PSBCSUTX",87,0)
 ....S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",88,0)
 ....Q:PSBACT="N"
"RTN","PSBCSUTX",89,0)
 ....Q:$D(PSBADMS(PSBONMBR,"EXP"))&("SI"'[PSBACT)
"RTN","PSBCSUTX",90,0)
 ....S $P(PSBADMS(PSBONMBR,PSBSCHTM),U,4)=PSBACT
"RTN","PSBCSUTX",91,0)
 ....S ^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2)="ADM^"_PSBADMS(PSBONMBR,PSBSCHTM)_"^"_$$NEXTADM(PSBDFNX,PSBONMBR),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTX",92,0)
 ....S PSBDONE(PSBIENX)=""
"RTN","PSBCSUTX",93,0)
 ....D CMT^PSBCSUTY
"RTN","PSBCSUTX",94,0)
 ...I (PSBIENX']"")&($G(PSBADMS(PSBONMBR,PSBSCHTM,1))'=1) S ^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2)="ADM^"_PSBADMS(PSBONMBR,PSBSCHTM)_"^"_$$NEXTADM(PSBDFNX,PSBONMBR),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTX",95,0)
 K PSBSCHTM
"RTN","PSBCSUTX",96,0)
 Q
"RTN","PSBCSUTX",97,0)
FINALPAS ;
"RTN","PSBCSUTX",98,0)
 S PSBI1="^TMP(""PSB"",$J,""CVRSHT"")",PSBCNT1=0
"RTN","PSBCSUTX",99,0)
 F  S PSBI1=$Q(@PSBI1) Q:PSBI1["CVRSHT2"  D
"RTN","PSBCSUTX",100,0)
 .I $QS(PSBI1,4)'>1 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTX",101,0)
 .K PSBX2 M PSBX2=^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4))
"RTN","PSBCSUTX",102,0)
 .I $QS(PSBI1,5)="" S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTX",103,0)
 .K PSBDONE
"RTN","PSBCSUTX",104,0)
 .I '$D(PSBX2(1)) S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTX",105,0)
 .F PSBI2=1:1 Q:'$D(PSBX2(PSBI2))  D  ; Sort actn/commnt revrs chrono
"RTN","PSBCSUTX",106,0)
 ..Q:$D(PSBDONE(PSBI2))
"RTN","PSBCSUTX",107,0)
 ..S PSBXDTTM=(-1*($P(PSBX2(PSBI2),U,6)))_+($E($P(PSBX2(PSBI2),U,4),$L($P(PSBX2(PSBI2),U,4))-6,999)),PSBMCODE=$P(PSBX2(PSBI2),U)
"RTN","PSBCSUTX",108,0)
 ..D:(+PSBXDTTM<0)&(PSBMCODE["ADM")
"RTN","PSBCSUTX",109,0)
 ...S PSBX3(+PSBXDTTM,-999)=PSBX2(PSBI2),PSBDONE(PSBI2)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2)
"RTN","PSBCSUTX",110,0)
 ...F PSBI3=1:1 Q:'$D(PSBX2(PSBI2+PSBI3))  Q:$P(PSBX2(PSBI2+PSBI3),U)'["CMT"  D
"RTN","PSBCSUTX",111,0)
 ....S PSBX3(+PSBXDTTM,-1*PSBI3)=PSBX2(PSBI2+PSBI3),PSBDONE(PSBI2+PSBI3)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2+PSBI3)
"RTN","PSBCSUTX",112,0)
 ..D:(+PSBXDTTM=0)&(PSBMCODE["ADM")
"RTN","PSBCSUTX",113,0)
 ...S PSBX3(PSBI2,0)=PSBX2(PSBI2),PSBDONE(PSBI2)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2)
"RTN","PSBCSUTX",114,0)
 .I $D(PSBX3) D  K PSBX3
"RTN","PSBCSUTX",115,0)
 ..S PSBI2="" F  S PSBI2=$O(PSBX3(PSBI2)) Q:PSBI2=""  S PSBI3="" F  S PSBI3=$O(PSBX3(PSBI2,PSBI3)) Q:PSBI3=""  D
"RTN","PSBCSUTX",116,0)
 ...S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=PSBX3(PSBI2,PSBI3),PSBCNT1=PSBCNT1+1
"RTN","PSBCSUTX",117,0)
 S $P(^TMP("PSB",$J,"CVRSHT2",0),U)=PSBCNT1-1
"RTN","PSBCSUTX",118,0)
 Q
"RTN","PSBCSUTX",119,0)
NEXTADM(XX,YY) ;
"RTN","PSBCSUTX",120,0)
 S NEXTADM=""
"RTN","PSBCSUTX",121,0)
 I $D(PSBNXTDU(YY)) S NEXTADM=PSBNXTDU(YY) Q NEXTADM
"RTN","PSBCSUTX",122,0)
 D:YY'["P"
"RTN","PSBCSUTX",123,0)
 .S PSBPATX=XX,PSBORXX=YY D CLEAN^PSBVT,PSJ1^PSBVT(XX,YY)
"RTN","PSBCSUTX",124,0)
 .Q:(PSBORXX["V")&'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBMR))
"RTN","PSBCSUTX",125,0)
 .S PSBGSCH=PSBADST,XX=PSBPATX,YY=PSBORXX,(NEXTADM,X,Y)="",X=$O(^PSB(53.79,"AORD",XX,YY,X),-1)
"RTN","PSBCSUTX",126,0)
 .I X]"" S Y=$O(^PSB(53.79,"AORD",XX,YY,X,Y),-1) I ($F("NM",$P(^PSB(53.79,Y,0),U,9))>1)!($P(^PSB(53.79,Y,0),U,9)="") S NEXTADM=X
"RTN","PSBCSUTX",127,0)
 .D:X']""
"RTN","PSBCSUTX",128,0)
 ..S Y="",X=$O(^PSB(53.79,"AORDX",XX,YY,X),-1)
"RTN","PSBCSUTX",129,0)
 ..I X]"" S Y=$O(^PSB(53.79,"AORDX",XX,YY,X,Y),-1) I $F("NM",$P(^PSB(53.79,Y,0),U,9))>1!($P(^PSB(53.79,Y,0),U,9)="") S NEXTADM=$P(^PSB(53.79,Y,0),U,6)
"RTN","PSBCSUTX",130,0)
 .D:NEXTADM=""
"RTN","PSBCSUTX",131,0)
 ..S PSBGOTY=Y,PSBFREQ=$$GETFREQ^PSBVDLU1(XX,YY)
"RTN","PSBCSUTX",132,0)
 ..S PSBFREQ=$S(PSBFREQ="O":1440,PSBFREQ="D":"",1:PSBFREQ)
"RTN","PSBCSUTX",133,0)
 ..S (PSBXSCH,LSTTIME,LSTIEN)=""
"RTN","PSBCSUTX",134,0)
 ..S:PSBGOTY]"" LSTTIME=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,LSTTIME),-1) I LSTTIME]"" S LSTIEN=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,LSTTIME,""),-1)
"RTN","PSBCSUTX",135,0)
 ..I LSTIEN]"" S:$P(^PSB(53.79,LSTIEN,0),U,9)']"" LSTTIME=""
"RTN","PSBCSUTX",136,0)
 ..S:LSTTIME="" LSTTIME=$$FMADD^XLFDT(PSBOST,,,,-0.1)
"RTN","PSBCSUTX",137,0)
 ..I +PSBFREQ>0 S PSBXSCH=(+PSBFREQ/60)_"H"
"RTN","PSBCSUTX",138,0)
 ..S X=LSTTIME
"RTN","PSBCSUTX",139,0)
 ..F PSBIX1=1:1:($L(PSBGSCH,"-")+1) D  Q:NEXTADM>LSTTIME
"RTN","PSBCSUTX",140,0)
 ...I ($P(PSBGSCH,"-",PSBIX1))']"" D  Q
"RTN","PSBCSUTX",141,0)
 ....I PSBIX1=1 D  Q
"RTN","PSBCSUTX",142,0)
 .....I X<PSBOST S NEXTADM=PSBOST Q
"RTN","PSBCSUTX",143,0)
 .....S X=PSBOST F  S X=$$SCH^XLFDT(PSBXSCH,X) S Y="" S Y=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,Y),-1)  I X>Y S NEXTADM=X Q
"RTN","PSBCSUTX",144,0)
 ....I PSBGSCH]"" D  Q
"RTN","PSBCSUTX",145,0)
 .....I (+PSBFREQ'>1440) F I=0:1 S PSBDTXX=$$FMADD^XLFDT(PSBOST,I) S $P(PSBDTXX,".",2)=($P(PSBGSCH,"-")) I PSBDTXX>LSTTIME S NEXTADM=PSBDTXX Q
"RTN","PSBCSUTX",146,0)
 .....I (+PSBFREQ'<1440),(1440#PSBFREQ=1440) F I=0:1 S PSBDTXX=$$FMADD^XLFDT(PSBOST,(I*(PSBFREQ\1440))) S $P(PSBDTXX,".",2)=($P(PSBGSCH,"-")) I PSBDTXX>LSTTIME S NEXTADM=PSBDTXX Q
"RTN","PSBCSUTX",147,0)
 ....S $P(X,".",2)=$P(PSBGSCH,"-"),NEXTADM=$$SCH^XLFDT(PSBXSCH,X) Q
"RTN","PSBCSUTX",148,0)
 ...S $P(X,".",2)=$P(PSBGSCH,"-",PSBIX1),NEXTADM=X
"RTN","PSBCSUTX",149,0)
 .I $$PSBDCHK1^PSBVT1(PSBSCH) D
"RTN","PSBCSUTX",150,0)
 ..S YY=PSBORXX,XX=PSBPATX
"RTN","PSBCSUTX",151,0)
 ..I $G(LSTTIME)]"" S NEXTADM=$S(LSTTIME'<PSBOST:LSTTIME,NEXTADM>LSTTIME:NEXTADM,1:PSBOST)
"RTN","PSBCSUTX",152,0)
 ..I PSBFREQ="" S PSBDTX=$P(NEXTADM,".") F PSBIX3=0:1 S X=$$FMADD^XLFDT(PSBDTX,PSBIX3) Q:X>PSBOSP  D  Q:$G(PSBYS)
"RTN","PSBCSUTX",153,0)
 ...S PSBNXTDT=X,PSBDY="" D DW^%DTC F PSBIX2=1:1 S PSBDY=$P($P(PSBSCH,"@"),"-",PSBIX2) Q:PSBDY=""  S PSBYS=0 I $F($E(X_"S",1,$L(PSBDY)),PSBDY)>1 S PSBYS=1 Q
"RTN","PSBCSUTX",154,0)
 ...I PSBYS S PSBSCTM=$$GETADMIN^PSBVDLU1(XX,YY,PSBNXTDT,"","") K ^TMP("PSB",$J,"GETADMIN") D
"RTN","PSBCSUTX",155,0)
 ....F PSBIX4=1:1 S PSBTX=$P(PSBSCTM,"-",PSBIX4) Q:PSBTX=""  D  Q:PSBYS
"RTN","PSBCSUTX",156,0)
 .....I NEXTADM>(PSBNXTDT_"."_PSBTX) S PSBYS=0 Q
"RTN","PSBCSUTX",157,0)
 .....S NEXTADM=PSBNXTDT,$P(NEXTADM,".",2)=PSBTX
"RTN","PSBCSUTX",158,0)
 .....I NEXTADM]"" I (NEXTADM<PSBOST)!$D(^PSB(53.79,"AORD",PSBPATX,PSBORXX,+NEXTADM))!(NEXTADM>PSBOSP) S PSBYS=0,NEXTADM="" Q
"RTN","PSBCSUTX",159,0)
 .....S PSBYS=1
"RTN","PSBCSUTX",160,0)
 .S PSBNXTDU(PSBORXX)=NEXTADM
"RTN","PSBCSUTX",161,0)
 .D CLEAN^PSBVT
"RTN","PSBCSUTX",162,0)
 Q NEXTADM
"RTN","PSBCSUTY")
0^3^B23020024
"RTN","PSBCSUTY",1,0)
PSBCSUTY ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES 3 ;Mar 2004
"RTN","PSBCSUTY",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16**;Mar 2004
"RTN","PSBCSUTY",3,0)
 ;
"RTN","PSBCSUTY",4,0)
 ;  Reference/IA
"RTN","PSBCSUTY",5,0)
 ;
"RTN","PSBCSUTY",6,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTY",7,0)
 ; File 200/10060
"RTN","PSBCSUTY",8,0)
 ;
"RTN","PSBCSUTY",9,0)
 ;
"RTN","PSBCSUTY",10,0)
CMT ; Comment per admin.
"RTN","PSBCSUTY",11,0)
 S (PSBIENX,PSBPRNRE)="",PSBIENX=+$P(PSBADMS(PSBONMBR,PSBSCHTM),U,3),PSBPRNRE=$P(PSBADMS(PSBONMBR,PSBSCHTM),U,8)
"RTN","PSBCSUTY",12,0)
 D:+$O(^PSB(53.79,PSBIENX,.3,""),-1)>0
"RTN","PSBCSUTY",13,0)
 .S PSBI2=0 F  S PSBI2=$O(^PSB(53.79,PSBIENX,.3,PSBI2)) Q:PSBI2=""  D
"RTN","PSBCSUTY",14,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U)="CMT",$P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,2)=$P(^PSB(53.79,PSBIENX,.3,PSBI2,0),U)
"RTN","PSBCSUTY",15,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,4)=$P(^PSB(53.79,PSBIENX,.3,PSBI2,0),U,2)
"RTN","PSBCSUTY",16,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,5)=$$GET1^DIQ(200,$P(^PSB(53.79,PSBIENX,.3,PSBI2,0),U,2)_",","INITIAL")
"RTN","PSBCSUTY",17,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,6)=$P(^PSB(53.79,PSBIENX,.3,PSBI2,0),U,3),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTY",18,0)
 D:($G(PSBPRNRE)]"")&($$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS")]"")
"RTN","PSBCSUTY",19,0)
 .S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U)="CMT",$P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,3)=$$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS")
"RTN","PSBCSUTY",20,0)
 .S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,4)=$$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS ENTERED BY","I")
"RTN","PSBCSUTY",21,0)
 .S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,5)=$$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS ENTERED BY:INITIAL")
"RTN","PSBCSUTY",22,0)
 .S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,6)=$$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS ENTERED AT","I"),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTY",23,0)
 Q
"RTN","PSBCSUTY",24,0)
 ;
"RTN","PSBCSUTY",25,0)
XFERBAGS ;
"RTN","PSBCSUTY",26,0)
 ;  Logic to "move IV bags"
"RTN","PSBCSUTY",27,0)
 ;  Construct Temp arrays PSBADMX,PSBDONE
"RTN","PSBCSUTY",28,0)
 ;
"RTN","PSBCSUTY",29,0)
 Q:PSBPONX']""
"RTN","PSBCSUTY",30,0)
 K PSBCHKED
"RTN","PSBCSUTY",31,0)
 S PSBNX2=PSBONX,PSBDFN2=PSBDFN,PSBPNX2=PSBPONX,PSBFN2=PSBFON F  Q:PSBFN2]""  D  Q:PSBPONX']""  S PSBPNX2=PSBPONX I $G(PSBCHKED(PSBPONX))=1 K PSBCHKED Q
"RTN","PSBCSUTY",32,0)
 .D CLEAN^PSBVT S PSBPONX=PSBPNX2,PSBCHKED(PSBPONX)=1 D PSJ1^PSBVT(PSBDFN2,PSBPONX)
"RTN","PSBCSUTY",33,0)
 .S (PSBXX,PSBXXX)="" F  S PSBXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",34,0)
 ..S PSBXXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""  Q:$P(^PSB(53.79,PSBXXX,0),U,9)="C"  S:'$D(PSBDONE(PSBXXX)) (PSBADMX(PSBNX2,PSBXX,PSBXXX),PSBDONE(PSBXXX))=""
"RTN","PSBCSUTY",35,0)
 ; Refresh data
"RTN","PSBCSUTY",36,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(PSBDFN2,PSBNX2)
"RTN","PSBCSUTY",37,0)
 K PSBNX2,PSBDFN2,PSBPNX2,PSBFN2
"RTN","PSBCSUTY",38,0)
 Q
"RTN","PSBCSUTY",39,0)
 ;
"RTN","PSBCSUTY",40,0)
GETADMX ;
"RTN","PSBCSUTY",41,0)
 ;
"RTN","PSBCSUTY",42,0)
 S (PSBXX,PSBXXX)="" F  S PSBXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",43,0)
 .Q:(PSBXX<PSBMHBCK)&'PSBLVIV
"RTN","PSBCSUTY",44,0)
 .F  S PSBXXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""  Q:(PSBFON]"")&($P(^PSB(53.79,PSBXXX,0),U,9)'="C")&(PSBLVIV)  D
"RTN","PSBCSUTY",45,0)
 ..S (PSBADMX(PSBONX,PSBXX,PSBXXX),PSBDONE(PSBXXX))=""
"RTN","PSBCSUTY",46,0)
 ; Check "actions" that DO NOT get filed into AORDX !!
"RTN","PSBCSUTY",47,0)
 S (PSBXX,PSBXXX)="" F  S PSBXX=$O(^PSB(53.79,"AORD",PSBDFN,PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",48,0)
 .F  S PSBXXX=$O(^PSB(53.79,"AORD",PSBDFN,PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""  D
"RTN","PSBCSUTY",49,0)
 ..S:('$D(PSBDONE(PSBXXX)))&($P(^PSB(53.79,PSBXXX,0),U,6)'<PSBMHBCK) PSBADMX(PSBONX,PSBXX,PSBXXX)=""
"RTN","PSBCSUTY",50,0)
 K PSBXX,PSBXXX,PSBDONE
"RTN","PSBCSUTY",51,0)
 Q
"RTN","PSBCSUTY",52,0)
 ;
"RTN","PSBCSUTY",53,0)
LVIV ;
"RTN","PSBCSUTY",54,0)
 ; Set up variables to later extract LVIV data
"RTN","PSBCSUTY",55,0)
 ;
"RTN","PSBCSUTY",56,0)
 ; Add all LVIVs that have been active with in the window!!
"RTN","PSBCSUTY",57,0)
 ; 
"RTN","PSBCSUTY",58,0)
 I (PSBOSP'<PSBWBEG)&(PSBOSP'>PSBWEND) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTY",59,0)
 S PSBEXPRD=0 I (PSBFON']"")&(PSBOSP<PSBNOW) S PSBEXPRD=1
"RTN","PSBCSUTY",60,0)
 ;  
"RTN","PSBCSUTY",61,0)
 S (PSBXX,PSBXXX)="" F  S PSBXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",62,0)
 .S PSBXXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""
"RTN","PSBCSUTY",63,0)
 .I "IS"[$P(^PSB(53.79,PSBXXX,0),U,9)&(PSBFON']"") S PSBEXPRD=0
"RTN","PSBCSUTY",64,0)
 .S:'$D(PSBDONE(PSBXXX))&(PSBFON="") (PSBADMX(PSBONX,PSBXX,PSBXXX),PSBDONE(PSBXXX))=""
"RTN","PSBCSUTY",65,0)
 S (PSBXX,PSBXXX)="" F  S PSBXX=$O(PSBADMX(PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",66,0)
 .S PSBXXX=$O(PSBADMX(PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""
"RTN","PSBCSUTY",67,0)
 .I "IS"[$P(^PSB(53.79,PSBXXX,0),U,9)&(PSBFON']"") S PSBEXPRD=0
"RTN","PSBCSUTY",68,0)
 .S:'$D(PSBDONE(PSBXXX))&(PSBFON="") (PSBADMX(PSBONX,PSBXX,PSBXXX),PSBDONE(PSBXXX))=""
"RTN","PSBCSUTY",69,0)
 Q
"RTN","PSBCSUTY",70,0)
 ;
"RTN","PSBCSUTY",71,0)
QUT() ;
"RTN","PSBCSUTY",72,0)
 S QUT=0
"RTN","PSBCSUTY",73,0)
 I PSBOST>($$FMADD^XLFDT($$NOW^XLFDT,,,$$GET^XPAR("DIV","PSB ADMIN BEFORE"))) S QUT=1 Q QUT
"RTN","PSBCSUTY",74,0)
 I '(($F("ED",PSBOSTS)'>1)&(PSBOSP'<PSBNOW)) S QUT=1 Q QUT
"RTN","PSBCSUTY",75,0)
 Q QUT
"RTN","PSBCSUTY",76,0)
 ;
"RTN","PSBCSUTY",77,0)
USED() ;
"RTN","PSBCSUTY",78,0)
 S (PSBXIEN,PSBUSD,USED)=0,PSBBAGX=$P(PSBXREC,U,2)
"RTN","PSBCSUTY",79,0)
 S PSBXXX="" F  S PSBXXX=$O(^PSB(53.79,"AUID",PSBDFNX,PSBXXX)) Q:PSBXXX=""  D  Q:PSBUSD
"RTN","PSBCSUTY",80,0)
 .I $D(^PSB(53.79,"AUID",PSBDFNX,PSBXXX,PSBBAGX)) S PSBXIEN=$O(^PSB(53.79,"AUID",PSBDFNX,PSBXXX,PSBBAGX,"")) S:$F("GICSHR",$P(^PSB(53.79,PSBXIEN,0),U,9))>1 (PSBUSD,USED)=1,PSBOBAG(PSBONMBR)=""
"RTN","PSBCSUTY",81,0)
 Q USED
"RTN","PSBRPC2")
0^5^B45008949
"RTN","PSBRPC2",1,0)
PSBRPC2 ;BIRMINGHAM/EFC-BCMA RPC BROKER CALLS ;Mar 2004
"RTN","PSBRPC2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,16**;Mar 2004
"RTN","PSBRPC2",3,0)
 ;
"RTN","PSBRPC2",4,0)
 ; Reference/IA
"RTN","PSBRPC2",5,0)
 ; File 50/221
"RTN","PSBRPC2",6,0)
 ; File 52.6/436
"RTN","PSBRPC2",7,0)
 ; File 52.7/437
"RTN","PSBRPC2",8,0)
 ; File 200/10060
"RTN","PSBRPC2",9,0)
 ;
"RTN","PSBRPC2",10,0)
GETOHIST(RESULTS,DFN,PSBORD) ;
"RTN","PSBRPC2",11,0)
 S RESULTS=$NAME(^TMP("PSB",$J)),PSB=0
"RTN","PSBRPC2",12,0)
 S ^TMP("PSB",$J,0)=1,^TMP("PSB",$J,1)="-1^No History On File"
"RTN","PSBRPC2",13,0)
 D NOW^%DTC S PSBNOW=$P(%,".",1),PSBNOWZ=%
"RTN","PSBRPC2",14,0)
 D EN^PSBPOIV(DFN,PSBORD)
"RTN","PSBRPC2",15,0)
 S PSBUID=DFN_"V"_99999 F  S PSBUID=$O(^TMP("PSBAR",$J,PSBUID),-1) Q:PSBUID=""  D
"RTN","PSBRPC2",16,0)
 .S PSBUIDS=^TMP("PSBAR",$J,PSBUID)
"RTN","PSBRPC2",17,0)
 .I ((PSBOSTS="D")!(PSBOSTS="E")),$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" Q   ; only want the infusing bag on a dc'ed order
"RTN","PSBRPC2",18,0)
 .I (PSBOSTS="A"),(PSBOSP<PSBNOWZ),$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" S PSBOSTS="E" Q  ; only want the infusing bag on an expired order
"RTN","PSBRPC2",19,0)
 .I $P(PSBUIDS,U,2)'="" D  Q  ; get orders from med log (53.79)
"RTN","PSBRPC2",20,0)
 ..S PSBMLOR=$P(PSBUIDS,U,4),PSBIEN=$O(^PSB(53.79,"AUID",DFN,PSBMLOR,PSBUID,""))
"RTN","PSBRPC2",21,0)
 ..S PSBLADT=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBRPC2",22,0)
 ..S PSBLASTS=$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBRPC2",23,0)
 ..I PSBLASTS="M",$P(PSBUIDS,U,8)'="" Q
"RTN","PSBRPC2",24,0)
 ..S PSBINJS=$P(^PSB(53.79,PSBIEN,.1),U,6)
"RTN","PSBRPC2",25,0)
 ..S PSB=PSB+1,^TMP("PSB",$J,PSB)=PSBORD_U_PSBUID_U_PSBIEN_U_PSBLADT_U_PSBLASTS_U_PSBINJS
"RTN","PSBRPC2",26,0)
 ..F PSBL=1:1 Q:'$D(^PSB(53.79,PSBIEN,.6,PSBL,0))  S PSB=PSB+1,^TMP("PSB",$J,PSB)="ADD^"_^PSB(53.79,PSBIEN,.6,PSBL,0)
"RTN","PSBRPC2",27,0)
 ..F PSBL=1:1 Q:'$D(^PSB(53.79,PSBIEN,.7,PSBL,0))  S PSB=PSB+1,^TMP("PSB",$J,PSB)="SOL^"_^PSB(53.79,PSBIEN,.7,PSBL,0)
"RTN","PSBRPC2",28,0)
 ..S PSB=PSB+1,^TMP("PSB",$J,PSB)="END"
"RTN","PSBRPC2",29,0)
 .I $P(PSBUIDS,U,1)="I" Q  ; IV parameters say bag is invalid
"RTN","PSBRPC2",30,0)
 .I $P(PSBUIDS,U,8)'="",$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" Q  ; label has been reprinted/distroyed etc. - bag is not infusing or stopped
"RTN","PSBRPC2",31,0)
 .S PSB=PSB+1,^TMP("PSB",$J,PSB)=$P(PSBUIDS,U,5)_U_PSBUID_U_U_PSBNOW_U_"A"
"RTN","PSBRPC2",32,0)
 .S PSBUIDP=$P(PSBUIDS,U,10,999)
"RTN","PSBRPC2",33,0)
 .F Y=3:1 S PSBMEDTY=$P(PSBUIDP,U,Y) Q:PSBMEDTY=""  D
"RTN","PSBRPC2",34,0)
 ..D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBUIDS,U,5))
"RTN","PSBRPC2",35,0)
 ..I $P(PSBMEDTY,";",1)="ADD" F Z=1:1 S PSBAD=$G(PSBADA(Z)) Q:PSBAD=""  I $P(PSBADA(Z),U,2)=$P(PSBMEDTY,";",2) S PSB=PSB+1,^TMP("PSB",$J,PSB)=PSBADA(Z) Q
"RTN","PSBRPC2",36,0)
 ..I $P(PSBMEDTY,";",1)="SOL" F Z=1:1 S PSBSOL=$G(PSBSOLA(Z)) Q:PSBSOL=""  I $P(PSBSOLA(Z),U,2)=$P(PSBMEDTY,";",2) S PSB=PSB+1,^TMP("PSB",$J,PSB)=PSBSOLA(Z) Q
"RTN","PSBRPC2",37,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBRPC2",38,0)
 .S PSB=PSB+1,^TMP("PSB",$J,PSB)="END"
"RTN","PSBRPC2",39,0)
 F II=1:1 S I=$P(PSBONXS,U,II) Q:I=""  D  ; get ward stocks
"RTN","PSBRPC2",40,0)
 .S PSBUID="" F  S PSBUID=$O(^PSB(53.79,"AUID",DFN,I,PSBUID)) Q:PSBUID=""  D
"RTN","PSBRPC2",41,0)
 ..I PSBUID'["WS" Q  ; not a ward stock
"RTN","PSBRPC2",42,0)
 ..S PSBIEN=$O(^PSB(53.79,"AUID",DFN,I,PSBUID,""))
"RTN","PSBRPC2",43,0)
 ..S PSBLADT=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBRPC2",44,0)
 ..S PSBLASTS=$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBRPC2",45,0)
 ..I PSBOSTS="D",PSBLASTS'="I",PSBLASTS'="S" Q  ; want "not completed" on DC'ed orders
"RTN","PSBRPC2",46,0)
 ..I (PSBOSTS="A"),(PSBOSP<PSBNOWZ),PSBLASTS'="I",PSBLASTS'="S" Q
"RTN","PSBRPC2",47,0)
 ..S PSBINJS=$P(^PSB(53.79,PSBIEN,.1),U,6)
"RTN","PSBRPC2",48,0)
 ..S PSB=PSB+1,^TMP("PSB",$J,PSB)=PSBORD_U_PSBUID_U_PSBIEN_U_PSBLADT_U_PSBLASTS_U_PSBINJS
"RTN","PSBRPC2",49,0)
 ..F PSBL=1:1 Q:'$D(^PSB(53.79,PSBIEN,.6,PSBL,0))  S PSB=PSB+1,^TMP("PSB",$J,PSB)="ADD^"_^PSB(53.79,PSBIEN,.6,PSBL,0)
"RTN","PSBRPC2",50,0)
 ..F PSBL=1:1 Q:'$D(^PSB(53.79,PSBIEN,.7,PSBL,0))  S PSB=PSB+1,^TMP("PSB",$J,PSB)="SOL^"_^PSB(53.79,PSBIEN,.7,PSBL,0)
"RTN","PSBRPC2",51,0)
 ..S PSB=PSB+1,^TMP("PSB",$J,PSB)="END"
"RTN","PSBRPC2",52,0)
 S ^TMP("PSB",$J,0)=PSB
"RTN","PSBRPC2",53,0)
 K ^TMP("PSBAR",$J)
"RTN","PSBRPC2",54,0)
 Q
"RTN","PSBRPC2",55,0)
 ;
"RTN","PSBRPC2",56,0)
BAGDTL(RESULTS,PSBUID,PSBORD)  ; bag detail
"RTN","PSBRPC2",57,0)
 I $G(DFN)="" S DFN=+PSBUID
"RTN","PSBRPC2",58,0)
 S (PSBIEN,X)="" F  S X=$O(^PSB(53.79,"AUID",DFN,X)) Q:X=""  S:$D(^PSB(53.79,"AUID",DFN,X,PSBUID)) PSBIEN=$O(^PSB(53.79,"AUID",DFN,X,PSBUID,"")) Q:PSBIEN]""
"RTN","PSBRPC2",59,0)
 I PSBIEN'>0 S RESULTS(0)=1,RESULTS(1)="-1^No History On File" Q
"RTN","PSBRPC2",60,0)
 M PSBMLA=^PSB(53.79,PSBIEN)
"RTN","PSBRPC2",61,0)
 S X=$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBRPC2",62,0)
 S PSBLAC=$S(X="I":"INFUSING",X="G":"GIVEN",X="C":"COMPLETE",X="H":"HELD",X="R":"REFUSED",X="RM":"REMOVED",X="S":"STOPPED",X="M":"MISSING",1:"NO ACTION")
"RTN","PSBRPC2",63,0)
 ; comments
"RTN","PSBRPC2",64,0)
 S PSBX="0" F  S PSBX=$O(PSBMLA(.3,PSBX)) Q:PSBX=""  S PSBTMP(10000000-$P(PSBMLA(.3,PSBX,0),U,3),"C")=$P(PSBMLA(.3,PSBX,0),U,3)_U_$$INITIAL($P(PSBMLA(.3,PSBX,0),U,2))_U_U_$P(PSBMLA(.3,PSBX,0),U,1)
"RTN","PSBRPC2",65,0)
 ; audit
"RTN","PSBRPC2",66,0)
 S PSBGA="" I $D(PSBMLA(.9,0)) D
"RTN","PSBRPC2",67,0)
 .S PSBX="0" F  S PSBX=$O(PSBMLA(.9,PSBX)) Q:PSBX=""  I ((PSBMLA(.9,PSBX,0)["ACTION STATUS")!(PSBMLA(.9,PSBX,0)["ADMINISTRATION STATUS")) D  Q
"RTN","PSBRPC2",68,0)
 ..S PSBDATE=$P(PSBMLA(0),U,4) I (PSBX-2)>0 D DT^DILF("ENPST",$P(PSBMLA(.9,PSBX-2,0),"'",2),.PSBDATE)
"RTN","PSBRPC2",69,0)
 ..S PSBTMP(10000000-PSBDATE,"B")=PSBDATE_U_$$INITIAL($P(PSBMLA(0),U,5))_U_$P(PSBMLA(.9,PSBX,0),"'",2)
"RTN","PSBRPC2",70,0)
 ..S PSBGA=1
"RTN","PSBRPC2",71,0)
 .S PSBX="0" F  S PSBX=$O(PSBMLA(.9,PSBX)) Q:PSBX=""  I ((PSBMLA(.9,PSBX,0)["ACTION STATUS")!(PSBMLA(.9,PSBX,0)["ADMINISTRATION STATUS"))  D
"RTN","PSBRPC2",72,0)
 ..S PSBTMP(10000000-$P(PSBMLA(.9,PSBX,0),U,1),"B")=$P(PSBMLA(.9,PSBX,0),U,1)_U_$$INITIAL($P(PSBMLA(.9,PSBX,0),U,2))_U_$P($P(PSBMLA(.9,PSBX,0),U,3),"'",2)
"RTN","PSBRPC2",73,0)
 ..S PSBGA=1
"RTN","PSBRPC2",74,0)
 I PSBGA'=1 S PSBTMP(10000000-$P(PSBMLA(0),U,6),"A")=$P(PSBMLA(0),U,6)_U_$$INITIAL($P(PSBMLA(0),U,7))_U_PSBLAC
"RTN","PSBRPC2",75,0)
 S PSBQRY="PSBTMP",PSBCNT=1 F  S PSBQRY=$Q(@PSBQRY) Q:PSBQRY=""  D  ; does comment go with action
"RTN","PSBRPC2",76,0)
 .S PSBPQRY=$Q(@PSBQRY,-1)
"RTN","PSBRPC2",77,0)
 .I PSBPQRY="" S RESULTS(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1 Q  ; no previous action
"RTN","PSBRPC2",78,0)
 .I $QS(PSBPQRY,2)="C"  S RESULTS(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1 Q  ; previous line is a comment
"RTN","PSBRPC2",79,0)
 .I $QS(PSBQRY,2)="C",$E($P(@$Q(@PSBQRY,-1),U,1),1,12)=$E($P(@PSBQRY,U,1),1,12),$P(@$Q(@PSBQRY,-1),U,2)=$P(@PSBQRY,U,2) S X=$P(@PSBQRY,U,4),$P(RESULTS(PSBCNT-1),U,4)=X Q
"RTN","PSBRPC2",80,0)
 .S RESULTS(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1
"RTN","PSBRPC2",81,0)
 S RESULTS(0)=PSBCNT-1
"RTN","PSBRPC2",82,0)
 K PSBMLA,PSBIEN,PSBTMP,PSBQRY
"RTN","PSBRPC2",83,0)
 Q
"RTN","PSBRPC2",84,0)
 ;
"RTN","PSBRPC2",85,0)
INITIAL(PSBDUZ) ;
"RTN","PSBRPC2",86,0)
 Q $$GET1^DIQ(200,PSBDUZ,"INITIAL")
"RTN","PSBRPC2",87,0)
SCANMED(RESULTS,PSBDIEN,PSBTAB)  ; Lookup Medication
"RTN","PSBRPC2",88,0)
 ;
"RTN","PSBRPC2",89,0)
 ; RPC: PSB SCANMED
"RTN","PSBRPC2",90,0)
 ;
"RTN","PSBRPC2",91,0)
 ; Description:
"RTN","PSBRPC2",92,0)
 ; Does a lookup on file 50 returns -1 on invalid lookup or
"RTN","PSBRPC2",93,0)
 ; IEN^DrugName on success
"RTN","PSBRPC2",94,0)
 ;
"RTN","PSBRPC2",95,0)
 D NOW^%DTC S PSBDT=%
"RTN","PSBRPC2",96,0)
 S PSBCNT=0
"RTN","PSBRPC2",97,0)
 I $L(PSBDIEN)>40 S PSBDIEN=$E(PSBDIEN,1,40)
"RTN","PSBRPC2",98,0)
 S RESULTS(PSBCNT)=1
"RTN","PSBRPC2",99,0)
 S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)="-1^Invalid Medication Lookup"
"RTN","PSBRPC2",100,0)
 I $$GET^XPAR("DIV","PSB ROBOT RX"),PSBDIEN?1"3"15N!(PSBDIEN?1"3"17N),123[$E(PSBDIEN,12) S PSBDIEN=$E(PSBDIEN,2,11)
"RTN","PSBRPC2",101,0)
 I PSBTAB="UDTAB" D  Q
"RTN","PSBRPC2",102,0)
 .S X=$$FIND1^DIC(50,"","AX",PSBDIEN,"B^C")
"RTN","PSBRPC2",103,0)
 .I X<1 Q
"RTN","PSBRPC2",104,0)
 .E  S RESULTS(PSBCNT)="DD"_U_X_U_$$GET1^DIQ(50,X_",",.01)
"RTN","PSBRPC2",105,0)
 ;
"RTN","PSBRPC2",106,0)
 ; IV/IVPB ward stock scan
"RTN","PSBRPC2",107,0)
 ;
"RTN","PSBRPC2",108,0)
 S PSBDIEN=$$FIND1^DIC(50,"","AX",PSBDIEN,"B^C") I PSBDIEN<1 Q
"RTN","PSBRPC2",109,0)
 S PSBOIT=$$GET1^DIQ(50,PSBDIEN,"PHARMACY ORDERABLE ITEM","I")
"RTN","PSBRPC2",110,0)
 I $D(^PSDRUG("A527",PSBDIEN)) S X="" F  S X=$O(^PSDRUG("A527",PSBDIEN,X)) Q:X=""  D
"RTN","PSBRPC2",111,0)
 .S PSBINACT=$$GET1^DIQ(52.7,X,8,"I") I PSBINACT]"",PSBINACT'>PSBDT Q
"RTN","PSBRPC2",112,0)
 .S RESULTS(PSBCNT)="SOL"_U_X_U_$$GET1^DIQ(50,PSBDIEN_",",.01),PSBCNT=PSBCNT+1,RESULTS(0)=PSBCNT-1
"RTN","PSBRPC2",113,0)
 I $D(^PSDRUG("A526",PSBDIEN)) S X="" F  S X=$O(^PSDRUG("A526",PSBDIEN,X)) Q:X=""  D
"RTN","PSBRPC2",114,0)
 .S PSBINACT=$$GET1^DIQ(52.6,X,12,"I") I PSBINACT]"",PSBINACT'>PSBDT Q
"RTN","PSBRPC2",115,0)
 .S RESULTS(PSBCNT)="ADD"_U_X_U_$$GET1^DIQ(50,PSBDIEN_",",.01),PSBCNT=PSBCNT+1,RESULTS(0)=PSBCNT-1
"RTN","PSBRPC2",116,0)
 ;
"RTN","PSBRPC2",117,0)
 I PSBTAB="PBTAB",$$FIND1^DIC(50,"","AX",PSBDIEN,"B^C")'<1 S X=$$FIND1^DIC(50,"","AX",PSBDIEN,"B^C"),RESULTS(PSBCNT)="DD"_U_X_U_$$GET1^DIQ(50,X_",",.01),PSBCNT=PSBCNT+1,RESULTS(0)=PSBCNT-1
"RTN","PSBRPC2",118,0)
 Q
"RTN","PSBRPC2",119,0)
 ;
"RTN","PSBRPC3")
0^6^B297083
"RTN","PSBRPC3",1,0)
PSBRPC3 ;BIRMINGHAM/VRN-BCMA RPC BROKER CALLS ;Mar 2004
"RTN","PSBRPC3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,16**;Mar 2004
"RTN","PSBRPC3",3,0)
 ;
"RTN","PSBRPC3",4,0)
GUICHK(RESULTS,DUMMY) ;
"RTN","PSBRPC3",5,0)
 ;
"RTN","PSBRPC3",6,0)
 ; RPC : PSB VERSION CHECK
"RTN","PSBRPC3",7,0)
 ;
"RTN","PSBRPC3",8,0)
 K RESULTS
"RTN","PSBRPC3",9,0)
 N PSBCURR,PSBPREV,PSBCNT
"RTN","PSBRPC3",10,0)
 S PSBCURR="3.0.16.*",PSBPREV="",PSBCNT=0
"RTN","PSBRPC3",11,0)
 S PSBCNT=PSBCNT+1
"RTN","PSBRPC3",12,0)
 S RESULTS(PSBCNT)=PSBCURR_U_PSBPREV
"RTN","PSBRPC3",13,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBRPC3",14,0)
 Q
"RTN","PSBRPC3",15,0)
 ;
"RTN","PSBVDLPA")
0^8^B11710856
"RTN","PSBVDLPA",1,0)
PSBVDLPA ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;Mar 2004
"RTN","PSBVDLPA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,16**;Mar 2004
"RTN","PSBVDLPA",3,0)
 ;
"RTN","PSBVDLPA",4,0)
 ; called by PSBVDLUD to find patches not removed
"RTN","PSBVDLPA",5,0)
 ;
"RTN","PSBVDLPA",6,0)
EN ;
"RTN","PSBVDLPA",7,0)
 S PSBGNODE="^PSB(53.79,"_"""APATCH"""_","_DFN_")"
"RTN","PSBVDLPA",8,0)
 F  S PSBGNODE=$Q(@PSBGNODE) Q:($QS(PSBGNODE,2)'="APATCH")!($QS(PSBGNODE,3)'=DFN)  D
"RTN","PSBVDLPA",9,0)
 .S PSBIEN=$QS(PSBGNODE,5)
"RTN","PSBVDLPA",10,0)
 .I '$D(^PSB(53.79,PSBIEN,.5,1)) Q
"RTN","PSBVDLPA",11,0)
 .I $P(^PSB(53.79,PSBIEN,.5,1,0),U,4)'="PATCH" Q
"RTN","PSBVDLPA",12,0)
 .I $P(^PSB(53.79,PSBIEN,0),U,9)'="G" Q
"RTN","PSBVDLPA",13,0)
 .S PSBZON=$P(^PSB(53.79,PSBIEN,.1),"^")
"RTN","PSBVDLPA",14,0)
 .D CLEAN^PSBVT
"RTN","PSBVDLPA",15,0)
 .D PSJ1^PSBVT(DFN,PSBZON)
"RTN","PSBVDLPA",16,0)
 .S $P(PSBREC,U,1)=DFN  ; dfn
"RTN","PSBVDLPA",17,0)
 .S $P(PSBREC,U,2)=PSBONX  ; order numer
"RTN","PSBVDLPA",18,0)
 .S $P(PSBREC,U,3)=PSBON  ; order ien
"RTN","PSBVDLPA",19,0)
 .S $P(PSBREC,U,4)="U"  ; order type U unit dose
"RTN","PSBVDLPA",20,0)
 .S $P(PSBREC,U,5)=PSBSCHT
"RTN","PSBVDLPA",21,0)
 .S $P(PSBREC,U,6)=PSBSCH
"RTN","PSBVDLPA",22,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"")
"RTN","PSBVDLPA",23,0)
 .S $P(PSBREC,U,8)=PSBOITX
"RTN","PSBVDLPA",24,0)
 .S $P(PSBREC,U,9)=PSBDOSE
"RTN","PSBVDLPA",25,0)
 .S $P(PSBREC,U,10)=PSBMR
"RTN","PSBVDLPA",26,0)
 .S:$D(PSBHSTAX(PSBOIT)) $P(PSBREC,U,11)=$O(PSBHSTAX(PSBOIT,""),-1),$P(PSBREC,U,20)=$O(PSBHSTAX(PSBOIT,$P(PSBREC,U,11),""),-1)
"RTN","PSBVDLPA",27,0)
 .D:'$D(PSBHSTAX(PSBOIT))
"RTN","PSBVDLPA",28,0)
 ..N PSBX,PSBY,PSBDONE S PSBDONE=0,PSBX="" F  S PSBX=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,PSBX),-1) Q:PSBX=""  D:'PSBDONE
"RTN","PSBVDLPA",29,0)
 ...S PSBY="" F  S PSBY=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,PSBX,PSBY),-1) Q:PSBY=""  D:'PSBDONE
"RTN","PSBVDLPA",30,0)
 ....S:$P(^PSB(53.79,PSBY,0),U,9)'="N" $P(PSBREC,U,20)=$P(^PSB(53.79,PSBY,0),U,9) S:($P(PSBREC,U,20)'="N")&($P(PSBREC,U,20)]"") $P(PSBREC,U,11)=PSBX,PSBDONE=1
"RTN","PSBVDLPA",31,0)
 .S $P(PSBREC,U,12)=PSBIEN
"RTN","PSBVDLPA",32,0)
 .S $P(PSBREC,U,13)="G"
"RTN","PSBVDLPA",33,0)
 .S $P(PSBREC,U,14)=$P(^PSB(53.79,PSBIEN,.1),U,3)
"RTN","PSBVDLPA",34,0)
 .I $P(PSBREC,U,14)="" S $P(PSBREC,U,14)=PSBNOW\1
"RTN","PSBVDLPA",35,0)
 .S $P(PSBREC,U,15)=PSBOIT
"RTN","PSBVDLPA",36,0)
 .D:$G(PSBTAB)="CVRSHT"
"RTN","PSBVDLPA",37,0)
 ..S $P(PSBREC,U,16)=0
"RTN","PSBVDLPA",38,0)
 ..F X="ID","IV","IM","SC","SQ" D  Q:$P(PSBREC,U,16)
"RTN","PSBVDLPA",39,0)
 ...I PSBMR?@(".E1"""_X_""".E"),PSBMR'["MISC" S $P(PSBREC,U,16)=1
"RTN","PSBVDLPA",40,0)
 ..I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPA",41,0)
 ..E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPA",42,0)
 ..S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***")
"RTN","PSBVDLPA",43,0)
 ..S $P(PSBREC,U,23)=""
"RTN","PSBVDLPA",44,0)
 ..S $P(PSBREC,U,26)=PSBOSP
"RTN","PSBVDLPA",45,0)
 ..S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL($P(PSBREC,U),$P(PSBREC,U,15))
"RTN","PSBVDLPA",46,0)
 ..S $P(PSBREC,U,28)=1
"RTN","PSBVDLPA",47,0)
 ..; Place into Coversheet activity ARRAY
"RTN","PSBVDLPA",48,0)
 ..S PSBDIDX="" I $D(^PSB(53.79,"AORD",DFN,PSBONX)) D
"RTN","PSBVDLPA",49,0)
 ...S PSBXDTI="",PSBXDTI=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBXDTI),-1)
"RTN","PSBVDLPA",50,0)
 ...Q:'$D(^PSB(53.79,"AORD",DFN,PSBONX,PSBXDTI,PSBIEN))
"RTN","PSBVDLPA",51,0)
 ...S PSBADMX(PSBONX,PSBXDTI,PSBIEN)="",PSBDIDX=1
"RTN","PSBVDLPA",52,0)
 ..I ('PSBDIDX)&$D(^PSB(53.79,"AORDX",DFN,PSBONX)) D
"RTN","PSBVDLPA",53,0)
 ...S PSBXXDTI="",PSBXXDTI=$O(^PSB(53.79,"AORDX",DFN,PSBONX,PSBXXDTI),-1)
"RTN","PSBVDLPA",54,0)
 ...Q:'$D(^PSB(53.79,"AORDX",DFN,PSBONX,PSBXXDTI,PSBIEN))
"RTN","PSBVDLPA",55,0)
 ...S PSBADMX(PSBONX,PSBXXDTI,PSBIEN)=""
"RTN","PSBVDLPA",56,0)
 .S $P(PSBREC,U,18)="PATCH"
"RTN","PSBVDLPA",57,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPA",58,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPA",59,0)
 .S PSBDDS="" F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1 S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPA",60,0)
 .S PSBQRR=1
"RTN","PSBVDLPA",61,0)
 .D ADD^PSBVDLU1(PSBREC,PSBOTXT,$P(PSBREC,U,14),PSBDDS,"","",$S($G(PSBTAB)="CVRSHT":"CVRSHT",1:"UDTAB"))
"RTN","PSBVDLPA",62,0)
 Q
"RTN","PSBVDLTB")
0^7^B12630766
"RTN","PSBVDLTB",1,0)
PSBVDLTB ;BIRMINGHAM/EFC-BCMA VIRTUAL DUE LIST FUNCTIONS (CONT) ;Mar 2004
"RTN","PSBVDLTB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,4,16**;Mar 2004
"RTN","PSBVDLTB",3,0)
 ;
"RTN","PSBVDLTB",4,0)
 ; Reference/IA
"RTN","PSBVDLTB",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLTB",6,0)
 ; IN5^VADPT/10061
"RTN","PSBVDLTB",7,0)
 ; DEM^VADPT/10061
"RTN","PSBVDLTB",8,0)
 ; INP^VADPT/10061
"RTN","PSBVDLTB",9,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBVDLTB",10,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLTB",11,0)
 ; 
"RTN","PSBVDLTB",12,0)
 ;
"RTN","PSBVDLTB",13,0)
RPC(RESULTS,DFN,PSBTAB,PSBDT) ;
"RTN","PSBVDLTB",14,0)
 K RESULTS,^TMP("PSB",$J),^TMP("PSJ",$J)
"RTN","PSBVDLTB",15,0)
 N PSBCNT
"RTN","PSBVDLTB",16,0)
 S PSBTRFL=0
"RTN","PSBVDLTB",17,0)
 S RESULTS=$NAME(^TMP("PSB",$J,PSBTAB))
"RTN","PSBVDLTB",18,0)
 ;
"RTN","PSBVDLTB",19,0)
 Q:$$DISCHRGD(DFN)
"RTN","PSBVDLTB",20,0)
 ;
"RTN","PSBVDLTB",21,0)
 S PSBNOW=+$G(PSBDT)
"RTN","PSBVDLTB",22,0)
 I 'PSBNOW D NOW^%DTC S PSBNOW=+$E(%,1,10),PSBDT=$P(%,".",1)
"RTN","PSBVDLTB",23,0)
 ; use fileman function to determine window
"RTN","PSBVDLTB",24,0)
 S PSBWBEG=$$FMADD^XLFDT(PSBNOW,"",-12)
"RTN","PSBVDLTB",25,0)
 S PSBWEND=$$FMADD^XLFDT(PSBNOW,"",12)
"RTN","PSBVDLTB",26,0)
 ;
"RTN","PSBVDLTB",27,0)
 ; Create variable for valid order start date/time against admin window
"RTN","PSBVDLTB",28,0)
 S PSBWADM=$$GET^XPAR("DIV","PSB ADMIN BEFORE")
"RTN","PSBVDLTB",29,0)
 D NOW^%DTC S PSBWADM=$$FMADD^XLFDT(%,"","",+PSBWADM)
"RTN","PSBVDLTB",30,0)
 ;
"RTN","PSBVDLTB",31,0)
 ; use last movement for API
"RTN","PSBVDLTB",32,0)
 S VAIP("D")="LAST" D IN5^VADPT S PSBTRDT=+VAIP(3),PSBTRTYP=$P(VAIP(2),U,2),PSBMVTYP=$P(VAIP(4),U,2) K VAIP
"RTN","PSBVDLTB",33,0)
 ;
"RTN","PSBVDLTB",34,0)
 ;Get patient transfer notification timeframe to determine pop-up box
"RTN","PSBVDLTB",35,0)
 S PSBPTTR=$$GET^XPAR("DIV","PSB PATIENT TRANSFER") I PSBPTTR="" S PSBPTTR=72
"RTN","PSBVDLTB",36,0)
 D NOW^%DTC S PSBNTDT=$$FMADD^XLFDT(%,"",-PSBPTTR) I PSBNTDT'>PSBTRDT S PSBTRFL=1
"RTN","PSBVDLTB",37,0)
 ;determine order type and load to table
"RTN","PSBVDLTB",38,0)
 ;
"RTN","PSBVDLTB",39,0)
 ; Setup the ^TMP("PSJ",$J global for use below 
"RTN","PSBVDLTB",40,0)
 ; Passing PSBDT as 3rd parameter turns off the V.1.0 One-Time lookback
"RTN","PSBVDLTB",41,0)
 D EN^PSJBCMA(DFN,PSBNOW,PSBDT)
"RTN","PSBVDLTB",42,0)
 ;initialize tabs
"RTN","PSBVDLTB",43,0)
 D TABINIT
"RTN","PSBVDLTB",44,0)
 ;
"RTN","PSBVDLTB",45,0)
 ;The following calls must be made in the order below since the ^TMP global is reused
"RTN","PSBVDLTB",46,0)
 D EN^PSBVDLUD(DFN,PSBDT),EN^PSBVDLPB(DFN,PSBDT),EN^PSBVDLIV(DFN,PSBDT)
"RTN","PSBVDLTB",47,0)
 S $P(PSBATAB,U,1)=$S($D(^TMP("PSB",$J,"UDTAB",2))>0:1,1:0)
"RTN","PSBVDLTB",48,0)
 S $P(PSBATAB,U,2)=$S($D(^TMP("PSB",$J,"PBTAB",2))>0:1,1:0)
"RTN","PSBVDLTB",49,0)
 S $P(PSBATAB,U,3)=$S($D(^TMP("PSB",$J,"IVTAB",2))>0:1,1:0)
"RTN","PSBVDLTB",50,0)
 S:PSBTAB="UDTAB" PSBCNT=$O(^TMP("PSB",$J,"UDTAB",""),-1)
"RTN","PSBVDLTB",51,0)
 S:PSBTAB="IVTAB" PSBCNT=$O(^TMP("PSB",$J,"IVTAB",""),-1)
"RTN","PSBVDLTB",52,0)
 S:PSBTAB="PBTAB" PSBCNT=$O(^TMP("PSB",$J,"PBTAB",""),-1)
"RTN","PSBVDLTB",53,0)
 I PSBTAB="NO TAB" D
"RTN","PSBVDLTB",54,0)
 .S ^TMP("PSB",$J,PSBTAB,0)=1
"RTN","PSBVDLTB",55,0)
 .S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB
"RTN","PSBVDLTB",56,0)
 E  D
"RTN","PSBVDLTB",57,0)
 .I $G(PSBCNT)>0 S ^TMP("PSB",$J,PSBTAB,0)=PSBCNT
"RTN","PSBVDLTB",58,0)
 .I $G(PSBCNT)>1 S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB_U_$S(PSBTRFL:PSBTRTYP_U_PSBMVTYP,1:"")
"RTN","PSBVDLTB",59,0)
 .I $G(PSBCNT)'>1 S ^TMP("PSB",$J,PSBTAB,1)=PSBATAB_U_^TMP("PSB",$J,PSBTAB,1)
"RTN","PSBVDLTB",60,0)
 F X="UDTAB","PBTAB","IVTAB" I X'=PSBTAB K ^TMP("PSB",$J,X)
"RTN","PSBVDLTB",61,0)
 D CLEAN^PSBVT K ^TMP("PSJ",$J),PSBATAB,PSBWADM,PSBWBEG,PSBWEND,PSBNOW,PSBTRDT,PSBPTTR,PSBTRFL,PSBNTDT,PSBTRTYP,PSBMVTYP
"RTN","PSBVDLTB",62,0)
 Q
"RTN","PSBVDLTB",63,0)
 ;
"RTN","PSBVDLTB",64,0)
TABINIT ;
"RTN","PSBVDLTB",65,0)
 F PSBX="UDTAB","PBTAB","IVTAB" D
"RTN","PSBVDLTB",66,0)
 .K ^TMP("PSB",$J,PSBX)
"RTN","PSBVDLTB",67,0)
 .S ^TMP("PSB",$J,PSBX,0)=1
"RTN","PSBVDLTB",68,0)
 .S ^TMP("PSB",$J,PSBX,1)="-1^No Administration(s) due at this time." Q
"RTN","PSBVDLTB",69,0)
 Q
"RTN","PSBVDLTB",70,0)
 ;
"RTN","PSBVDLTB",71,0)
DISCHRGD(DFN) ; Patient Discharged OR Deceased?
"RTN","PSBVDLTB",72,0)
 ;
"RTN","PSBVDLTB",73,0)
 S DISCHRGD=0
"RTN","PSBVDLTB",74,0)
 D DEM^VADPT I VADM(6)]"" S DISCHRGD=1 K VADM D  Q DISCHRGD
"RTN","PSBVDLTB",75,0)
 .F PSBX="UDTAB","PBTAB","IVTAB","NO TAB" D
"RTN","PSBVDLTB",76,0)
 ..K ^TMP("PSB",$J,PSBX)
"RTN","PSBVDLTB",77,0)
 ..S ^TMP("PSB",$J,PSBX,0)=1,^TMP("PSB",$J,PSBX,1)="0^0^0^-1^A ""DATE OF DEATH"" has been logged for this patient."
"RTN","PSBVDLTB",78,0)
 D INP^VADPT I VAIN(1)']"" S DISCHRGD=1 K VAIN D  Q DISCHRGD
"RTN","PSBVDLTB",79,0)
 .F PSBX="UDTAB","PBTAB","IVTAB","NO TAB" D
"RTN","PSBVDLTB",80,0)
 ..K ^TMP("PSB",$J,PSBX)
"RTN","PSBVDLTB",81,0)
 ..S ^TMP("PSB",$J,PSBX,0)=1,^TMP("PSB",$J,PSBX,1)="0^0^0^-1^The selected patient has been DISCHARGED."
"RTN","PSBVDLTB",82,0)
 Q DISCHRGD
"RTN","PSBVDLTB",83,0)
 ;
"VER")
8.0^22.0
"BLD",5193,6)
^14
**END**
**END**
