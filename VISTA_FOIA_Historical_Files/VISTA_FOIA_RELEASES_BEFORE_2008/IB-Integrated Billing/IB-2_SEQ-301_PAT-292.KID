Released IB*2*292 SEQ #301
Extracted from mail message
**KIDS**:IB*2.0*292^

**INSTALL NAME**
IB*2.0*292
"BLD",6034,0)
IB*2.0*292^INTEGRATED BILLING^0^3060126^y
"BLD",6034,1,0)
^^2^2^3050217^
"BLD",6034,1,1,0)
This patch modifies the Claims Tracking software to accept same date/time 
"BLD",6034,1,2,0)
entries.
"BLD",6034,4,0)
^9.64PA^^
"BLD",6034,"KRN",0)
^9.67PA^8989.52^19
"BLD",6034,"KRN",.4,0)
.4
"BLD",6034,"KRN",.401,0)
.401
"BLD",6034,"KRN",.402,0)
.402
"BLD",6034,"KRN",.403,0)
.403
"BLD",6034,"KRN",.5,0)
.5
"BLD",6034,"KRN",.84,0)
.84
"BLD",6034,"KRN",3.6,0)
3.6
"BLD",6034,"KRN",3.8,0)
3.8
"BLD",6034,"KRN",9.2,0)
9.2
"BLD",6034,"KRN",9.8,0)
9.8
"BLD",6034,"KRN",9.8,"NM",0)
^9.68A^5^3
"BLD",6034,"KRN",9.8,"NM",1,0)
IBTRKR4^^0^B12239188
"BLD",6034,"KRN",9.8,"NM",4,0)
IBTUTL1^^0^B59418416
"BLD",6034,"KRN",9.8,"NM",5,0)
IBTRKR41^^0^B29987868
"BLD",6034,"KRN",9.8,"NM","B","IBTRKR4",1)

"BLD",6034,"KRN",9.8,"NM","B","IBTRKR41",5)

"BLD",6034,"KRN",9.8,"NM","B","IBTUTL1",4)

"BLD",6034,"KRN",19,0)
19
"BLD",6034,"KRN",19.1,0)
19.1
"BLD",6034,"KRN",101,0)
101
"BLD",6034,"KRN",409.61,0)
409.61
"BLD",6034,"KRN",771,0)
771
"BLD",6034,"KRN",870,0)
870
"BLD",6034,"KRN",8989.51,0)
8989.51
"BLD",6034,"KRN",8989.52,0)
8989.52
"BLD",6034,"KRN",8994,0)
8994
"BLD",6034,"KRN","B",.4,.4)

"BLD",6034,"KRN","B",.401,.401)

"BLD",6034,"KRN","B",.402,.402)

"BLD",6034,"KRN","B",.403,.403)

"BLD",6034,"KRN","B",.5,.5)

"BLD",6034,"KRN","B",.84,.84)

"BLD",6034,"KRN","B",3.6,3.6)

"BLD",6034,"KRN","B",3.8,3.8)

"BLD",6034,"KRN","B",9.2,9.2)

"BLD",6034,"KRN","B",9.8,9.8)

"BLD",6034,"KRN","B",19,19)

"BLD",6034,"KRN","B",19.1,19.1)

"BLD",6034,"KRN","B",101,101)

"BLD",6034,"KRN","B",409.61,409.61)

"BLD",6034,"KRN","B",771,771)

"BLD",6034,"KRN","B",870,870)

"BLD",6034,"KRN","B",8989.51,8989.51)

"BLD",6034,"KRN","B",8989.52,8989.52)

"BLD",6034,"KRN","B",8994,8994)

"BLD",6034,"QUES",0)
^9.62^^
"BLD",6034,"REQB",0)
^9.611^3^3
"BLD",6034,"REQB",1,0)
IB*2.0*249^1
"BLD",6034,"REQB",2,0)
IB*2.0*142^1
"BLD",6034,"REQB",3,0)
IB*2.0*315^1
"BLD",6034,"REQB","B","IB*2.0*142",2)

"BLD",6034,"REQB","B","IB*2.0*249",1)

"BLD",6034,"REQB","B","IB*2.0*315",3)

"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
292^3060126
"PKG",200,22,1,"PAH",1,1,0)
^^2^2^3060126
"PKG",200,22,1,"PAH",1,1,1,0)
This patch modifies the Claims Tracking software to accept same date/time 
"PKG",200,22,1,"PAH",1,1,2,0)
entries.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","IBTRKR4")
0^1^B12239188^B11531662
"RTN","IBTRKR4",1,0)
IBTRKR4 ;ALB/AAS - CLAIMS TRACKING - ADD/TRACK OUTPATIENT ENCOUNTERS ; 13-AUG-93
"RTN","IBTRKR4",2,0)
 ;;2.0;INTEGRATED BILLING;**91,142,292**;21-MAR-94
"RTN","IBTRKR4",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRKR4",4,0)
 ;
"RTN","IBTRKR4",5,0)
% ; -- entry point for nightly background job
"RTN","IBTRKR4",6,0)
 N IBTSBDT,IBTSEDT
"RTN","IBTRKR4",7,0)
 S IBTSBDT=$$FMADD^XLFDT(DT,$S($E(DT,6,7)=10:-730,1:-20))-.1
"RTN","IBTRKR4",8,0)
 S IBTSEDT=$$FMADD^XLFDT(DT,-2)-.9
"RTN","IBTRKR4",9,0)
 D EN1
"RTN","IBTRKR4",10,0)
 Q
"RTN","IBTRKR4",11,0)
 ;
"RTN","IBTRKR4",12,0)
EN ; -- entry point to ask date range
"RTN","IBTRKR4",13,0)
 N IBBDT,IBEDT,IBTSBDT,IBTSEDT,IBTALK
"RTN","IBTRKR4",14,0)
 S IBTALK=1
"RTN","IBTRKR4",15,0)
 I '$P($G(^IBE(350.9,1,6)),"^",3) W !!,"I'm sorry, Tracking of Outpatient Encounters is currrently turned off." G ENQ
"RTN","IBTRKR4",16,0)
 W !!!,"Select the Date Range of Opt. Encounters to Add to Claims Tracking.",!
"RTN","IBTRKR4",17,0)
 D DATE^IBOUTL
"RTN","IBTRKR4",18,0)
 I IBBDT<1!(IBEDT<1) G ENQ
"RTN","IBTRKR4",19,0)
 S IBTSBDT=IBBDT,IBTSEDT=IBEDT
"RTN","IBTRKR4",20,0)
 ; -- check selected dates
"RTN","IBTRKR4",21,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR4",22,0)
 ; start date can't be before parameters
"RTN","IBTRKR4",23,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR W !!,"Begin date is before Claims Tracking Start Date, changed to ",$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR4",24,0)
 ; -- end date into future
"RTN","IBTRKR4",25,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-1) W !!,"I'll automatically change the end date to 1 day prior to the date queued to run."
"RTN","IBTRKR4",26,0)
 W !!!,"I'm going to automatically queue this off and send you a"
"RTN","IBTRKR4",27,0)
 W !,"mail message when complete.",!
"RTN","IBTRKR4",28,0)
 S ZTIO="",ZTRTN="EN1^IBTRKR4",ZTSAVE("IB*")="",ZTDESC="IB - Add Opt Encounters to Claims Tracking"
"RTN","IBTRKR4",29,0)
 D ^%ZTLOAD I $G(ZTSK) K ZTSK W !,"Request Queued"
"RTN","IBTRKR4",30,0)
ENQ K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBTRKR4",31,0)
 D HOME^%ZIS
"RTN","IBTRKR4",32,0)
 Q
"RTN","IBTRKR4",33,0)
 ;
"RTN","IBTRKR4",34,0)
EN1 ; -- add outpatient encounters to claims tracking file
"RTN","IBTRKR4",35,0)
 N I,J,X,Y,IBTRKR,IBDT,DFN,IBOETA,IBCNT,IBCNT1,IBCNT2
"RTN","IBTRKR4",36,0)
 ;
"RTN","IBTRKR4",37,0)
 ; -- check parameters
"RTN","IBTRKR4",38,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR4",39,0)
 G:'$P(IBTRKR,"^",3) EN1Q ; quit if opt tracking off
"RTN","IBTRKR4",40,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR ; start date can't be before parameters
"RTN","IBTRKR4",41,0)
 ;
"RTN","IBTRKR4",42,0)
 ; -- users can queue into future, make sure dates not after date run
"RTN","IBTRKR4",43,0)
 ;I IBTSEDT>DT S IBTSEDT=DT
"RTN","IBTRKR4",44,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-1) S IBMESS="(Selected end date of "_$$DAT1^IBOUTL(IBTSEDT)_" automatically changed to "_$$DAT1^IBOUTL($$FMADD^XLFDT(DT,-1))_".)",IBTSEDT=$$FMADD^XLFDT(DT,-1)
"RTN","IBTRKR4",45,0)
 ;
"RTN","IBTRKR4",46,0)
 S IBOETYP=$O(^IBE(356.6,"AC",2,0)) ;event type pointer for opt encounters
"RTN","IBTRKR4",47,0)
 ;
"RTN","IBTRKR4",48,0)
 ; -- cnt= total count, cnt1=count added nsc, cnt2=count of pending
"RTN","IBTRKR4",49,0)
 S (IBCNT,IBCNT1,IBCNT2)=0
"RTN","IBTRKR4",50,0)
 ;
"RTN","IBTRKR4",51,0)
 N IBVAL,IBCBK,IBFILTER
"RTN","IBTRKR4",52,0)
 S IBVAL("BDT")=IBTSBDT,IBVAL("EDT")=IBTSEDT+.9
"RTN","IBTRKR4",53,0)
 ; Only parent encounters, status is checked out, check out date exists,
"RTN","IBTRKR4",54,0)
 ;   not already in CT, not already an entry for the same encounter
"RTN","IBTRKR4",55,0)
 S IBFILTER=""
"RTN","IBTRKR4",56,0)
 ;S IBCBK="S IBCNT=IBCNT+1 I '$P(Y0,U,6),$P(Y0,U,12)=2,$P(Y0,U,7),'$O(^IBT(356,""AENC"",+$P(Y0,U,2),Y,0)),'$O(^IBT(356,""APTY"",+$P(Y0,U,2),IBOETYP,+Y0,0)) S IBDT=+Y0,IBOE=Y D OPCHK^IBTRKR41"
"RTN","IBTRKR4",57,0)
 S IBCBK="S IBCNT=IBCNT+1 I '$P(Y0,U,6),$P(Y0,U,12)=2,$P(Y0,U,7),'$O(^IBT(356,""AENC"",+$P(Y0,U,2),Y,0)),$S($D(^IBE(356.6,""ACODE"",2,IBOETYP)):1,1:'$O(^IBT(356,""APTY"",+$P(Y0,U,2),IBOETYP,+Y0,0))) S IBDT=+Y0,IBOE=Y D OPCHK^IBTRKR41"
"RTN","IBTRKR4",58,0)
 D SCAN^IBSDU("DATE/TIME",.IBVAL,IBFILTER,IBCBK,1) ;Scan,then close query
"RTN","IBTRKR4",59,0)
 ;
"RTN","IBTRKR4",60,0)
 I $G(IBTALK) D BULL^IBTRKR41
"RTN","IBTRKR4",61,0)
EN1Q I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBTRKR4",62,0)
 Q
"RTN","IBTRKR41")
0^5^B29987868^B29297297
"RTN","IBTRKR41",1,0)
IBTRKR41 ;ALB/AAS - CLAIMS TRACKING - ADD/TRACK OUTPATIENT ENCOUNTERS ;13-AUG-93
"RTN","IBTRKR41",2,0)
 ;;2.0;INTEGRATED BILLING;**43,55,91,132,174,247,260,315,292**;21-MAR-94
"RTN","IBTRKR41",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRKR41",4,0)
 ;
"RTN","IBTRKR41",5,0)
OPCHK ; -- check and add rx
"RTN","IBTRKR41",6,0)
 N Y,Y0
"RTN","IBTRKR41",7,0)
 K IBRMARK
"RTN","IBTRKR41",8,0)
 I '$D(ZTQUEUED),($G(IBTALK)) W "."
"RTN","IBTRKR41",9,0)
 ;
"RTN","IBTRKR41",10,0)
 S IBOEDATA=$$SCE^IBSDU(IBOE),IBOESTAT=$P(IBOEDATA,"^",15)
"RTN","IBTRKR41",11,0)
 S DFN=$P(IBOEDATA,"^",2)
"RTN","IBTRKR41",12,0)
 I 'DFN G OPCHKQ
"RTN","IBTRKR41",13,0)
 I $P(IBOEDATA,"^",5) S IBVSIT=$P(IBOEDATA,"^",5) I '$$BDSRC^IBEFUNC3(IBVSIT) G OPCHKQ ;non-billable data sources
"RTN","IBTRKR41",14,0)
 ; -- do not allow date/time duplicate claims before Jan. 1, 2006
"RTN","IBTRKR41",15,0)
 I $O(^IBT(356,"APTY",DFN,IBOETYP,IBDT,0)),IBDT<3060101 G OPCHKQ
"RTN","IBTRKR41",16,0)
 ;
"RTN","IBTRKR41",17,0)
 ; -- see if tracking only insured and pt is insured/insured for outpt visits
"RTN","IBTRKR41",18,0)
 I $P(IBTRKR,"^",3)=1,'$$INSURED^IBCNS1(DFN,IBDT) G OPCHKQ ; patient not insured
"RTN","IBTRKR41",19,0)
 ;
"RTN","IBTRKR41",20,0)
 ; -- see if outpatient services are covered
"RTN","IBTRKR41",21,0)
 I '$$PTCOV^IBCNSU3(DFN,IBDT,"OUTPATIENT",.IBANY) S IBRMARK=$S($G(IBANY):"SERVICE NOT COVERED",1:"NOT INSURED")
"RTN","IBTRKR41",22,0)
 ;
"RTN","IBTRKR41",23,0)
 ; -- see if appointment type is billable
"RTN","IBTRKR41",24,0)
 I '$$RPT^IBEFUNC($P(IBOEDATA,"^",10),+IBOEDATA) S IBRMARK="NON-BILLABLE APPOINTMENT TYPE"
"RTN","IBTRKR41",25,0)
 ;
"RTN","IBTRKR41",26,0)
 ; -- check sc status, special conditions etc.
"RTN","IBTRKR41",27,0)
 I $G(IBRMARK)="" S IBRMARK=$$CL(IBOEDATA)
"RTN","IBTRKR41",28,0)
 ;
"RTN","IBTRKR41",29,0)
 ; -- check for non-billable stops or clinic
"RTN","IBTRKR41",30,0)
 S X=$P(IBOEDATA,"^",4) I X,$$NBCT^IBEFUNC(X,+IBOEDATA) S IBRMARK="NON-BILLABLE CLINIC"
"RTN","IBTRKR41",31,0)
 S X=$P(IBOEDATA,"^",3) I X,$$NBST^IBEFUNC(X,+IBOEDATA) S IBRMARK="NON-BILLABLE STOP CODE"
"RTN","IBTRKR41",32,0)
 ;
"RTN","IBTRKR41",33,0)
 ; -- ok to add to tracking module
"RTN","IBTRKR41",34,0)
 D OPT^IBTUTL1(DFN,IBOETYP,IBDT,IBOE,IBRMARK,$G(IBVSIT)) I '$D(ZTQUEUED),$G(IBTALK) W "+"
"RTN","IBTRKR41",35,0)
 I IBRMARK'="" S IBCNT2=IBCNT2+1
"RTN","IBTRKR41",36,0)
 I IBRMARK="" S IBCNT1=IBCNT1+1
"RTN","IBTRKR41",37,0)
OPCHKQ K IBANY,IBRMARK,VAEL,VA,IBOEDATA,IBVSIT,DFN,X,Y
"RTN","IBTRKR41",38,0)
 Q
"RTN","IBTRKR41",39,0)
 ;
"RTN","IBTRKR41",40,0)
BULL ; -- send bulletin
"RTN","IBTRKR41",41,0)
 ;
"RTN","IBTRKR41",42,0)
 S XMSUB="Outpatient Encounters added to Claims Tracking Complete"
"RTN","IBTRKR41",43,0)
 S IBT(1)="The process to automatically add Opt Encounters has successfully completed."
"RTN","IBTRKR41",44,0)
 S IBT(1.1)=""
"RTN","IBTRKR41",45,0)
 S IBT(2)="              Start Date: "_$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR41",46,0)
 S IBT(3)="                End Date: "_$$DAT1^IBOUTL(IBTSEDT)
"RTN","IBTRKR41",47,0)
 I $D(IBMESS) S IBT(3.1)=IBMESS
"RTN","IBTRKR41",48,0)
 S IBT(4)=""
"RTN","IBTRKR41",49,0)
 S IBT(5)="            Total Encounters Checked: "_$G(IBCNT)
"RTN","IBTRKR41",50,0)
 S IBT(6)="              Total Encounters Added: "_$G(IBCNT1)
"RTN","IBTRKR41",51,0)
 S IBT(7)=" Total Non-billable Encounters Added: "_$G(IBCNT2)
"RTN","IBTRKR41",52,0)
 S IBT(8)=""
"RTN","IBTRKR41",53,0)
 S IBT(9)="*The SC, Agent Orange, Environmental Contaminate, Ionizing Radiation,"
"RTN","IBTRKR41",54,0)
 S IBT(10)="Military Sexual Trauma,Head Neck Cancer and Combat Veteran status"
"RTN","IBTRKR41",55,0)
 S IBT(11)="visits have been added for insured patients but automatically"
"RTN","IBTRKR41",56,0)
 S IBT(12)="indicated as not billable."
"RTN","IBTRKR41",57,0)
 D SEND^IBTRKR31
"RTN","IBTRKR41",58,0)
BULLQ Q
"RTN","IBTRKR41",59,0)
 ;
"RTN","IBTRKR41",60,0)
CL(IBOEDATA,IBR) ; check out classification questions for encounter
"RTN","IBTRKR41",61,0)
 ; this new check will look at the V POV level then to the Visit level
"RTN","IBTRKR41",62,0)
 ; as necessary to determine if it relates or not.  This will indicate
"RTN","IBTRKR41",63,0)
 ; if the WHOLE visit is not billable, otherwise it will say it is
"RTN","IBTRKR41",64,0)
 ; (even if just part is billable).
"RTN","IBTRKR41",65,0)
 ; call with the zero node of 409.68 in IBOEDATA
"RTN","IBTRKR41",66,0)
 ; assumes DFN and IBDT defined
"RTN","IBTRKR41",67,0)
 ; pass in IBR by ref to get values back
"RTN","IBTRKR41",68,0)
 ;
"RTN","IBTRKR41",69,0)
 N IBRMARK,IBPCEX,IBCPT,IBARR,IBP,IBDX,IBVRNB,IBENCL
"RTN","IBTRKR41",70,0)
 S IBRMARK="",IBPCEX=$P(IBOEDATA,"^",5)
"RTN","IBTRKR41",71,0)
 ;
"RTN","IBTRKR41",72,0)
 ; look up classification info needed (if any)
"RTN","IBTRKR41",73,0)
 D CL^SDCO21(DFN,IBDT,"",.IBARR) I '$D(IBARR) G CLQ
"RTN","IBTRKR41",74,0)
 ;
"RTN","IBTRKR41",75,0)
 ; if no PCE event use old approach
"RTN","IBTRKR41",76,0)
 I 'IBPCEX D:$G(IBOE)  G CLQ
"RTN","IBTRKR41",77,0)
 . S IBENCL=$$ENCL^IBAMTS2(IBOE) I IBENCL["1" D  ; return 1 in string if true "ao^ir^sc^ec^mst^hnc^cv"
"RTN","IBTRKR41",78,0)
 . I $P(IBENCL,"^",3) S IBRMARK="SC TREATMENT" Q
"RTN","IBTRKR41",79,0)
 . I $P(IBENCL,"^",1) S IBRMARK="AGENT ORANGE" Q
"RTN","IBTRKR41",80,0)
 . I $P(IBENCL,"^",2) S IBRMARK="IONIZING RADIATION" Q
"RTN","IBTRKR41",81,0)
 . I $P(IBENCL,"^",4) S IBRMARK="ENV. CONTAM." Q
"RTN","IBTRKR41",82,0)
 . I $P(IBENCL,"^",5) S IBRMARK="MILITARY SEXUAL TRAUMA" Q
"RTN","IBTRKR41",83,0)
 . I $P(IBENCL,"^",6) S IBRMARK="HEAD/NECK CANCER" Q
"RTN","IBTRKR41",84,0)
 . I $P(IBENCL,"^",7) S IBRMARK="COMBAT VETERAN" Q
"RTN","IBTRKR41",85,0)
 ;
"RTN","IBTRKR41",86,0)
 ; look up PCE info
"RTN","IBTRKR41",87,0)
 D ENCEVENT^PXKENC(IBPCEX)
"RTN","IBTRKR41",88,0)
 ;
"RTN","IBTRKR41",89,0)
 S IBVRNB=$$RNB($G(^TMP("PXKENC",$J,IBPCEX,"VST",IBPCEX,800)),.IBARR)
"RTN","IBTRKR41",90,0)
 ;
"RTN","IBTRKR41",91,0)
 ; find dx rnb's
"RTN","IBTRKR41",92,0)
 S IBDX=0 F  S IBDX=$O(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX)) Q:'IBDX  S IBDX(+$G(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX,0)))=$$RNB($G(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX,800)),.IBARR)
"RTN","IBTRKR41",93,0)
 ;
"RTN","IBTRKR41",94,0)
 ; look for v cpt's with IBDX
"RTN","IBTRKR41",95,0)
 S IBCPT=0 F  S IBCPT=$O(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT)) Q:'IBCPT  F IBP=5,9,10,11 Q:'$D(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0))  D
"RTN","IBTRKR41",96,0)
 . ;
"RTN","IBTRKR41",97,0)
 . ; dx exists in v cpt but not v pov use visit level determination
"RTN","IBTRKR41",98,0)
 . I $P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP),'$D(IBDX($P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP))) D:IBVRNB REL(IBVRNB) Q
"RTN","IBTRKR41",99,0)
 . ;
"RTN","IBTRKR41",100,0)
 . ; use dx determination (where dx exists on v cpt)
"RTN","IBTRKR41",101,0)
 . I $P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP) D:$G(IBDX($P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP))) REL($G(IBDX($P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP)))) Q
"RTN","IBTRKR41",102,0)
 ;
"RTN","IBTRKR41",103,0)
 ; check for no assoc dx and apply visit level determination
"RTN","IBTRKR41",104,0)
 S IBCPT=0 F  S IBCPT=$O(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT)) Q:'IBCPT  D
"RTN","IBTRKR41",105,0)
 . S IBDX=0 F IBP=5,9,10,11 Q:IBDX  I +$P($G(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0)),"^",IBP) S IBDX=1
"RTN","IBTRKR41",106,0)
 . I 'IBDX,IBVRNB D REL(IBVRNB)
"RTN","IBTRKR41",107,0)
 ;
"RTN","IBTRKR41",108,0)
 ; if some procedures left, then we need to bill, set return array
"RTN","IBTRKR41",109,0)
 I $D(^TMP("PXKENC",$J,IBPCEX,"CPT")) S IBRMARK="" M IBR=^TMP("PXKENC",$J,IBPCEX)
"RTN","IBTRKR41",110,0)
 ;
"RTN","IBTRKR41",111,0)
CLQ K ^TMP("PXKENC",$J)
"RTN","IBTRKR41",112,0)
 Q IBRMARK
"RTN","IBTRKR41",113,0)
 ;
"RTN","IBTRKR41",114,0)
RNB(IBDATA,IBARR) ; find rnb's
"RTN","IBTRKR41",115,0)
 ; pass in PCE 800 data (visit or v pov) to find any reasons not billalbe
"RTN","IBTRKR41",116,0)
 ; IBARR = classifications that could apply to patient
"RTN","IBTRKR41",117,0)
 ; the RNB number returned is from the IBARR number (SDCO21 array)
"RTN","IBTRKR41",118,0)
 N IBX,IBR S IBR=""
"RTN","IBTRKR41",119,0)
 S IBX=0 F  S IBX=$O(IBARR(IBX)) Q:'IBX!(IBR)  I $P(IBDATA,"^",$P($T(CLDATA+(IBX+1)),"^",2)) S IBR=IBX
"RTN","IBTRKR41",120,0)
 Q IBR
"RTN","IBTRKR41",121,0)
 ;
"RTN","IBTRKR41",122,0)
REL(IBRNB) ; kills of tmp if related and set IBRMARK
"RTN","IBTRKR41",123,0)
 K ^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT)
"RTN","IBTRKR41",124,0)
 S IBRMARK=$P($T(CLDATA+(IBRNB+1)),"^",3)
"RTN","IBTRKR41",125,0)
 Q
"RTN","IBTRKR41",126,0)
 ;
"RTN","IBTRKR41",127,0)
CLDATA ; classification data
"RTN","IBTRKR41",128,0)
 ; format is:  SCDO21 array^vpov/vcpt/visit 800 piece^reason not billable
"RTN","IBTRKR41",129,0)
 ;;1^2^AGENT ORANGE
"RTN","IBTRKR41",130,0)
 ;;2^3^IONIZING RADIATION
"RTN","IBTRKR41",131,0)
 ;;3^1^SC TREATMENT
"RTN","IBTRKR41",132,0)
 ;;4^4^ENV. CONTAM.
"RTN","IBTRKR41",133,0)
 ;;5^5^MILITARY SEXUAL TRAUMA
"RTN","IBTRKR41",134,0)
 ;;6^6^HEAD/NECK CANCER
"RTN","IBTRKR41",135,0)
 ;;7^7^COMBAT VETERAN
"RTN","IBTRKR41",136,0)
 ;
"RTN","IBTUTL1")
0^4^B59418416^B11559784
"RTN","IBTUTL1",1,0)
IBTUTL1 ;ALB/AAS - CLAIMS TRACKING UTILITY ROUTINE ;21-JUN-93
"RTN","IBTUTL1",2,0)
 ;;2.0;INTEGRATED BILLING;**13,223,249,292**;21-MAR-94
"RTN","IBTUTL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTUTL1",4,0)
 ;
"RTN","IBTUTL1",5,0)
OPT(DFN,IBETYP,IBTDT,ENCTR,IBRMARK,IBVSIT) ; -- add outpatient care entries
"RTN","IBTUTL1",6,0)
 ; -- input   dfn  := patient pointer to 2
"RTN","IBTUTL1",7,0)
 ;          ibetyp := pointer to type entry in 356.6
"RTN","IBTUTL1",8,0)
 ;          ibtdt  := episode date
"RTN","IBTUTL1",9,0)
 ;          enctr  := pointer to opt. encounter file (optional)
"RTN","IBTUTL1",10,0)
 ;        ibrmark  := text of reason not billable (optional)
"RTN","IBTUTL1",11,0)
 ;         ibvsit  := pointer to visit file (optional)
"RTN","IBTUTL1",12,0)
 ;
"RTN","IBTUTL1",13,0)
 N X,Y,DA,DR,DIE,DIC,IBSCRN
"RTN","IBTUTL1",14,0)
 S IBSCRN=0
"RTN","IBTUTL1",15,0)
 ;Allow user inter-actions if not queued and IBTALK=1 or not exist. 
"RTN","IBTUTL1",16,0)
 I '$D(ZTQUEUED) D  I IBSCRN G OPTSCRN
"RTN","IBTUTL1",17,0)
 . I $D(IBTALK),'$G(IBTALK) Q
"RTN","IBTUTL1",18,0)
 . I IBTDT<3060101 Q  ;Don't use new code for claims prior to 1/1/2006
"RTN","IBTUTL1",19,0)
 . S IBSCRN=1
"RTN","IBTUTL1",20,0)
 I $G(IBETYP) S IBETYP=$O(^IBE(356.6,"AC",2,0))
"RTN","IBTUTL1",21,0)
 I IBTDT<3060101 S X=$O(^IBT(356,"APTY",DFN,IBETYP,IBTDT,0)) I X S IBTRN=X G OPTQ ;Prevent duplicate date/time claims prior to 1/1/2006
"RTN","IBTUTL1",22,0)
 ;Check for encounter already in claims tracking.
"RTN","IBTUTL1",23,0)
 I $D(ENCTR),$D(^IBT(356,"AENC",+DFN,+ENCTR)) S IBTRN=$O(^IBT(356,"AENC",+DFN,+ENCTR,0)) G OPTQ
"RTN","IBTUTL1",24,0)
 D ADDT^IBTUTL
"RTN","IBTUTL1",25,0)
 S DA=IBTRN,DIE="^IBT(356,"
"RTN","IBTUTL1",26,0)
 I IBTRN<1 G OPTQ
"RTN","IBTUTL1",27,0)
 L +^IBT(356,+IBTRN):10 I '$T G OPTQ
"RTN","IBTUTL1",28,0)
 S DR=".02////"_$G(DFN)_";.03////"_$G(IBVSIT)_";.04////"_$G(ENCTR)_";.06////"_+IBTDT_";.18////"_IBETYP_";.2////1;.24////"_$$INSURED^IBCNS1(DFN)_";1.01///NOW;1.02////"_DUZ_";.17////"_$$EABD^IBTUTL(IBETYP)
"RTN","IBTUTL1",29,0)
 I $G(IBRMARK)'="" S DR=DR_";.19///"_IBRMARK
"RTN","IBTUTL1",30,0)
 D ^DIE K DA,DR,DIE
"RTN","IBTUTL1",31,0)
 L -^IBT(356,+IBTRN)
"RTN","IBTUTL1",32,0)
OPTQ Q
"RTN","IBTUTL1",33,0)
 ;
"RTN","IBTUTL1",34,0)
REFILL(DFN,IBETYP,IBTDT,IBRXN,IBRXN1,IBRMARK,IBEABD) ; -- add refill
"RTN","IBTUTL1",35,0)
 ; -- input   dfn   := patient pointer to 2
"RTN","IBTUTL1",36,0)
 ;          ibetyp  := pointer to type entry in 356.6
"RTN","IBTUTL1",37,0)
 ;          ibtdt   := episode date (refill date)
"RTN","IBTUTL1",38,0)
 ;          ibrxn   := pointer to 52
"RTN","IBTUTL1",39,0)
 ;          ibrxn1  := refill multiple entry
"RTN","IBTUTL1",40,0)
 ;          ibrmark := non billable reason if unsure
"RTN","IBTUTL1",41,0)
 ;          ibeabd  := optional, can specify an earliest auto bill date
"RTN","IBTUTL1",42,0)
 ;
"RTN","IBTUTL1",43,0)
 N X,Y,DA,DR,DIE,DIC
"RTN","IBTUTL1",44,0)
 ;S X=$O(^IBT(356,"APTY",DFN,IBETYP,IBTDT,0)) I X S IBTRN=X G REFILLQ
"RTN","IBTUTL1",45,0)
 S X=$O(^IBT(356,"ARXFL",IBRXN,IBRXN1,0)) I X S IBTRN=X G REFILLQ
"RTN","IBTUTL1",46,0)
 D ADDT^IBTUTL
"RTN","IBTUTL1",47,0)
 I IBTRN<1 G REFILLQ
"RTN","IBTUTL1",48,0)
 S DA=IBTRN,DIE="^IBT(356,"
"RTN","IBTUTL1",49,0)
 L +^IBT(356,+IBTRN):10 I '$T G REFILLQ
"RTN","IBTUTL1",50,0)
 S DR=".02////"_$G(DFN)_";.06////"_+IBTDT_";.08////"_IBRXN_";.1////"_IBRXN1_";.18////"_IBETYP_";.2////1;.24////"_$$INSURED^IBCNS1(DFN)_";1.01///NOW;1.02////"_$S($G(IBDUZ):IBDUZ,1:DUZ)_";.17////"_$S($G(IBEABD):IBEABD,1:$$EABD^IBTUTL(IBETYP))
"RTN","IBTUTL1",51,0)
 I $G(IBRMARK)'="" S DR=DR_";.19///"_IBRMARK
"RTN","IBTUTL1",52,0)
 D ^DIE K DA,DR,DIE
"RTN","IBTUTL1",53,0)
 L -^IBT(356,+IBTRN)
"RTN","IBTUTL1",54,0)
REFILLQ Q
"RTN","IBTUTL1",55,0)
 ;
"RTN","IBTUTL1",56,0)
PRO(DFN,IBTDT,IBPRO,IBRMARK) ; -- add prosthetic entries
"RTN","IBTUTL1",57,0)
 ; -- input   dfn  := patient pointer to 2
"RTN","IBTUTL1",58,0)
 ;          ibetyp := pointer to type entry in 356.6
"RTN","IBTUTL1",59,0)
 ;          ibtdt  := episode date
"RTN","IBTUTL1",60,0)
 ;
"RTN","IBTUTL1",61,0)
 N X,Y,DA,DR,DIE,DIC,IBETYP
"RTN","IBTUTL1",62,0)
 ;S IBETYP=$O(^IBE(356.6,"ACODE",4,0))
"RTN","IBTUTL1",63,0)
 S IBETYP=$O(^IBE(356.6,"AC",3,0)) ;prosthetics type
"RTN","IBTUTL1",64,0)
 S X=$O(^IBT(356,"APRO",IBPRO,0)) I X S IBTRN=X G PROQ
"RTN","IBTUTL1",65,0)
 D ADDT^IBTUTL
"RTN","IBTUTL1",66,0)
 I IBTRN<1 G PROQ
"RTN","IBTUTL1",67,0)
 S DA=IBTRN,DIE="^IBT(356,"
"RTN","IBTUTL1",68,0)
 L +^IBT(356,+IBTRN):10 I '$T G PROQ
"RTN","IBTUTL1",69,0)
 S DR=".02////"_$G(DFN)_";.06////"_+IBTDT_";.09////"_IBPRO_";.18////"_IBETYP_";.2////1;.24////"_$$INSURED^IBCNS1(DFN)_";1.01///NOW;1.02////"_DUZ_";.17////"_$$EABD^IBTUTL(IBETYP)
"RTN","IBTUTL1",70,0)
 I $G(IBRMARK)'="" S DR=DR_";.19///"_IBRMARK
"RTN","IBTUTL1",71,0)
 D ^DIE K DA,DR,DIE
"RTN","IBTUTL1",72,0)
 L -^IBT(356,+IBTRN)
"RTN","IBTUTL1",73,0)
PROQ Q
"RTN","IBTUTL1",74,0)
 ;
"RTN","IBTUTL1",75,0)
PT(DFN) ; -- format patient name - last 4 for output
"RTN","IBTUTL1",76,0)
 S Y="" I '$G(DFN) G PTQ
"RTN","IBTUTL1",77,0)
 I '$D(VA("PID")) D PID^VADPT
"RTN","IBTUTL1",78,0)
 S Y=$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBTUTL1",79,0)
PTQ Q Y
"RTN","IBTUTL1",80,0)
 ;
"RTN","IBTUTL1",81,0)
PRODATA(IBDA) ; -- return data from prosthetics file
"RTN","IBTUTL1",82,0)
 N IBDA0,DA,DIC,DIE,DR
"RTN","IBTUTL1",83,0)
 K IBRMPR ; only one array at a time
"RTN","IBTUTL1",84,0)
 I '$G(IBDA) G PRODAQ
"RTN","IBTUTL1",85,0)
 S IBDA0=$G(^RMPR(660,+IBDA,0))
"RTN","IBTUTL1",86,0)
 G:IBDA0="" PRODAQ
"RTN","IBTUTL1",87,0)
DIQ S DIC="^RMPR(660,",DR=".01;1:5;7;10;12:17;24"
"RTN","IBTUTL1",88,0)
 S DIQ="IBRMPR",DIQ(0)="E",DA=IBDA
"RTN","IBTUTL1",89,0)
 D EN^DIQ1
"RTN","IBTUTL1",90,0)
PRODAQ Q
"RTN","IBTUTL1",91,0)
 ;
"RTN","IBTUTL1",92,0)
OPTSCRN ; -- add outpatient care entries with user feedback
"RTN","IBTUTL1",93,0)
 ; called from OPT^IBTUTL1 which has following inputs
"RTN","IBTUTL1",94,0)
 ; -- input   dfn  := patient pointer to 2
"RTN","IBTUTL1",95,0)
 ;          ibetyp := pointer to type entry in 356.6
"RTN","IBTUTL1",96,0)
 ;          ibtdt  := episode date
"RTN","IBTUTL1",97,0)
 ;          enctr  := pointer to opt. encounter file (optional)
"RTN","IBTUTL1",98,0)
 ;        ibrmark  := text of reason not billable (optional)
"RTN","IBTUTL1",99,0)
 ;         ibvsit  := pointer to visit file (optional)
"RTN","IBTUTL1",100,0)
 ;
"RTN","IBTUTL1",101,0)
 N CNT,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IB3560,IBACT,IBDATE,IBENC,IBETYPNM
"RTN","IBTUTL1",102,0)
 N IBID,IBPATNM,IBQUIT,LINE,TEMP,TMP
"RTN","IBTUTL1",103,0)
 ;If encounter passed in already exists in claims Tracking, remove it.
"RTN","IBTUTL1",104,0)
 I $D(ENCTR),$D(^IBT(356,"AENC",+DFN,+ENCTR)) S ENCTR=""
"RTN","IBTUTL1",105,0)
 I $G(IBETYP) S IBETYP=$O(^IBE(356.6,"AC",2,0))
"RTN","IBTUTL1",106,0)
 S IBQUIT=0
"RTN","IBTUTL1",107,0)
 I $O(^IBT(356,"APTY",DFN,IBETYP,IBTDT,0)) D  I X S IBTRN=X G OPTSCRNQ
"RTN","IBTUTL1",108,0)
 . S (CNT,LINE)=1,(TEMP,TMP,X)=""
"RTN","IBTUTL1",109,0)
 . S Y=IBTDT D DD^%DT S IBDATE=$E(Y_"                  ",1,18) S Y=""
"RTN","IBTUTL1",110,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",111,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",112,0)
 . S TMP("DIMSG",LINE)="There are match(es) for the episode date you have entered:",LINE=LINE+1
"RTN","IBTUTL1",113,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",114,0)
 . S TMP("DIMSG",LINE)="   EPISODE DATE       PATIENT NAME    CT ID      TYPE     ENCOUNTER  ACTIVE",LINE=LINE+1
"RTN","IBTUTL1",115,0)
 . S TMP("DIMSG",LINE)="   ------------       ------------    -----      ----     ---------  ------",LINE=LINE+1
"RTN","IBTUTL1",116,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",117,0)
 . F  S X=$O(^IBT(356,"APTY",DFN,IBETYP,IBTDT,X)) Q:X=""  D
"RTN","IBTUTL1",118,0)
 .. S IB3560=$G(^IBT(356,X,0)) I IB3560="" Q
"RTN","IBTUTL1",119,0)
 .. S IBID=$P($G(IB3560),U,1) S IBID=$S(IBID="":"ID_UNKNOWN",1:$E(IBID_"          ",1,10))
"RTN","IBTUTL1",120,0)
 .. S IBPATNM=$P($G(^DPT(DFN,0)),U,1) S IBPATNM=$S(IBPATNM="":"PATIENT_UNKNOWN",1:$E(IBPATNM_"               ",1,15))
"RTN","IBTUTL1",121,0)
 .. S IBENC=$P($G(IB3560),U,4) S IBENC=$S(IBENC="":"NONE      ",1:$E(IBENC_"          ",1,10))
"RTN","IBTUTL1",122,0)
 .. S IBACT=$S($P($G(IB3560),U,20)=1:"YES",1:"NO ")
"RTN","IBTUTL1",123,0)
 .. S IBETYPNM=$P($G(^IBE(356.6,IBETYP,0)),U,2) S IBETYPNM=$S(IBETYPNM="":"NONE    ",1:$E(IBETYPNM_"        ",1,8))
"RTN","IBTUTL1",124,0)
 .. S TMP("DIMSG",LINE)=$E(CNT_"  ",1,3)_IBDATE_" "_IBPATNM_" "_IBID_" "_IBETYPNM_" "_IBENC_" "_IBACT
"RTN","IBTUTL1",125,0)
 .. S TEMP(CNT)=X_"^"_$TR(IBENC," ",""),CNT=CNT+1
"RTN","IBTUTL1",126,0)
 .. S LINE=LINE+1
"RTN","IBTUTL1",127,0)
 . I CNT>0 D
"RTN","IBTUTL1",128,0)
 .. S TMP("DIMSG",LINE+1)=$E(CNT_"  ",1,3)_"*** CREATE A NEW CLAIMS TRACKING ENTRY ***"
"RTN","IBTUTL1",129,0)
 .. D MSG^DIALOG("WM",,,,"TMP")
"RTN","IBTUTL1",130,0)
 .. S DIR(0)="NA^1:"_CNT_":0"
"RTN","IBTUTL1",131,0)
 .. S DIR("A")="Select a Claims Tracking entry: "
"RTN","IBTUTL1",132,0)
 .. S DIR("?",1)="Choose a Claims Tracking entry from the previous list to continue processing."
"RTN","IBTUTL1",133,0)
 .. S DIR("?")="Valid responses are 1 thru "_CNT_" or ^ to exit."
"RTN","IBTUTL1",134,0)
 .. D ^DIR
"RTN","IBTUTL1",135,0)
 .. I ($G(DTOUT))!($G(DUOUT))!($G(DIRUT))!($G(DIROUT)) S IBQUIT=1
"RTN","IBTUTL1",136,0)
 .. I Y>0 S X=+$G(TEMP(Y)) I +$P($G(TEMP(Y)),U,2)>0 S ENCTR=$P($G(TEMP(Y)),U,2)
"RTN","IBTUTL1",137,0)
 I IBQUIT Q
"RTN","IBTUTL1",138,0)
 I '$G(ENCTR) D
"RTN","IBTUTL1",139,0)
 . N CNT,DIR,IBDATA,IBDATA1,IBDATA2,IBERR,IBMSG,IBSCRN,IBTMP,LINE,TMP,X
"RTN","IBTUTL1",140,0)
 . N DIOUT,DIROUT,DTOUT,DUOUT
"RTN","IBTUTL1",141,0)
 . S X(1)=IBTDT
"RTN","IBTUTL1",142,0)
 . S IBSCRN="I $P($G(^(0)),U,2)="_DFN
"RTN","IBTUTL1",143,0)
 . S IBMSG="IBTMP(""ENC"")"
"RTN","IBTUTL1",144,0)
 . S IBERR="IBTMP(""ERR"")"
"RTN","IBTUTL1",145,0)
 . D FIND^DIC(409.68,,,"PQX",.X,,"B",IBSCRN,,IBMSG,IBERR)
"RTN","IBTUTL1",146,0)
 . I +IBTMP("ENC","DILIST",0)=0 S ENCTR="" Q
"RTN","IBTUTL1",147,0)
 . S CNT=+IBTMP("ENC","DILIST",0)+1
"RTN","IBTUTL1",148,0)
 . S (LINE,X)=0
"RTN","IBTUTL1",149,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",150,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",151,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",152,0)
 . S TMP("DIMSG",LINE)="There are encounters for the episode date you have selected:",LINE=LINE+1
"RTN","IBTUTL1",153,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",154,0)
 . F  S X=$O(IBTMP("ENC","DILIST",X)) Q:X=""  D
"RTN","IBTUTL1",155,0)
 .. S LINE=LINE+1
"RTN","IBTUTL1",156,0)
 .. S IBDATA1=$P($G(IBTMP("ENC","DILIST",X,0)),"^"_IBTDT,1)
"RTN","IBTUTL1",157,0)
 .. S IBDATA2=$P($G(IBTMP("ENC","DILIST",X,0)),"^"_IBTDT,2)
"RTN","IBTUTL1",158,0)
 .. S IBDATA=$TR(IBDATA1_IBDATA2,"^"," ")
"RTN","IBTUTL1",159,0)
 .. S TMP("DIMSG",LINE)=$E(X_"    ",1,4)_IBDATA
"RTN","IBTUTL1",160,0)
 . S TMP("DIMSG",LINE+1)=$E(+IBTMP("ENC","DILIST",0)+1_"    ",1,4)_"*** CREATE A NEW CLAIMS TRACKING ENTRY WITHOUT AN ENCOUNTER ***"
"RTN","IBTUTL1",161,0)
 . D MSG^DIALOG("WM",,,,"TMP")
"RTN","IBTUTL1",162,0)
 . S DIR(0)="NA^1:"_CNT_":0"
"RTN","IBTUTL1",163,0)
 . S DIR("A")="Select an Encounter for the Claims Tracking entry: "
"RTN","IBTUTL1",164,0)
 . S DIR("?",1)="Choose an Encounter from the previous list to continue processing."
"RTN","IBTUTL1",165,0)
 . S DIR("?")="Valid responses are 1 thru "_CNT_" or ^ to exit."
"RTN","IBTUTL1",166,0)
 . D ^DIR
"RTN","IBTUTL1",167,0)
 . I ($G(DTOUT))!($G(DUOUT))!($G(DIRUT))!($G(DIROUT)) S IBQUIT=1
"RTN","IBTUTL1",168,0)
 . I +$G(Y)<1 Q
"RTN","IBTUTL1",169,0)
 . S ENCTR=+$G(IBTMP("ENC","DILIST",+Y,0)) I 'ENCTR Q
"RTN","IBTUTL1",170,0)
 . I $D(^IBT(356,"AENC",+DFN,ENCTR)) S IBTRN=$O(^IBT(356,"AENC",+DFN,ENCTR,0)) Q
"RTN","IBTUTL1",171,0)
 I IBQUIT Q
"RTN","IBTUTL1",172,0)
 G:$G(IBTRN)'="" OPTSCRNQ
"RTN","IBTUTL1",173,0)
 D ADDT^IBTUTL
"RTN","IBTUTL1",174,0)
 S DA=IBTRN,DIE="^IBT(356,"
"RTN","IBTUTL1",175,0)
 I IBTRN<1 G OPTSCRNQ
"RTN","IBTUTL1",176,0)
 L +^IBT(356,+IBTRN):10 I '$T G OPTSCRNQ
"RTN","IBTUTL1",177,0)
 S DR=".02////"_$G(DFN)_";.03////"_$G(IBVSIT)_";.04////"_$G(ENCTR)_";.06////"_+IBTDT_";.18////"_IBETYP_";.2////1;.24////"_$$INSURED^IBCNS1(DFN)_";1.01///NOW;1.02////"_DUZ_";.17////"_$$EABD^IBTUTL(IBETYP)
"RTN","IBTUTL1",178,0)
 I $G(IBRMARK)'="" S DR=DR_";.19///"_IBRMARK
"RTN","IBTUTL1",179,0)
 D ^DIE K DA,DR,DIE
"RTN","IBTUTL1",180,0)
 L -^IBT(356,+IBTRN)
"RTN","IBTUTL1",181,0)
OPTSCRNQ Q
"VER")
8.0^22.0
"BLD",6034,6)
^301
**END**
**END**
