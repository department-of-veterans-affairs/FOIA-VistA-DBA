Released GMRC*3*53 SEQ #47
Extracted from mail message
**KIDS**:GMRC*3.0*53^

**INSTALL NAME**
GMRC*3.0*53
"BLD",6829,0)
GMRC*3.0*53^CONSULT/REQUEST TRACKING^0^3070111^y
"BLD",6829,1,0)
^^4^4^3060720^
"BLD",6829,1,1,0)
This patch corrects a couple of printing issues, a consult forwarding
"BLD",6829,1,2,0)
issue, an administrative completion issue, and duplicate service names.
"BLD",6829,1,3,0)
It also adds an additional warning when creating Consult Services and
"BLD",6829,1,4,0)
additional information in the Consult documentation.
"BLD",6829,4,0)
^9.64PA^123.5^2
"BLD",6829,4,123.3,0)
123.3
"BLD",6829,4,123.3,2,0)
^9.641^123.3^1
"BLD",6829,4,123.3,2,123.3,0)
GMRC PROCEDURE  (File-top level)
"BLD",6829,4,123.3,2,123.3,1,0)
^9.6411^.01^1
"BLD",6829,4,123.3,2,123.3,1,.01,0)
NAME
"BLD",6829,4,123.3,222)
y^n^p^^^^n^^n
"BLD",6829,4,123.3,224)

"BLD",6829,4,123.5,0)
123.5
"BLD",6829,4,123.5,2,0)
^9.641^123.5^1
"BLD",6829,4,123.5,2,123.5,0)
REQUEST SERVICES  (File-top level)
"BLD",6829,4,123.5,2,123.5,1,0)
^9.6411^.01^1
"BLD",6829,4,123.5,2,123.5,1,.01,0)
SERVICE NAME
"BLD",6829,4,123.5,222)
y^n^p^^^^n^^n
"BLD",6829,4,123.5,224)

"BLD",6829,4,"APDD",123.3,123.3)

"BLD",6829,4,"APDD",123.3,123.3,.01)

"BLD",6829,4,"APDD",123.5,123.5)

"BLD",6829,4,"APDD",123.5,123.5,.01)

"BLD",6829,4,"B",123.3,123.3)

"BLD",6829,4,"B",123.5,123.5)

"BLD",6829,6)
2^
"BLD",6829,6.3)
3
"BLD",6829,"KRN",0)
^9.67PA^8989.52^19
"BLD",6829,"KRN",.4,0)
.4
"BLD",6829,"KRN",.401,0)
.401
"BLD",6829,"KRN",.402,0)
.402
"BLD",6829,"KRN",.403,0)
.403
"BLD",6829,"KRN",.5,0)
.5
"BLD",6829,"KRN",.84,0)
.84
"BLD",6829,"KRN",3.6,0)
3.6
"BLD",6829,"KRN",3.8,0)
3.8
"BLD",6829,"KRN",9.2,0)
9.2
"BLD",6829,"KRN",9.8,0)
9.8
"BLD",6829,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",6829,"KRN",9.8,"NM",1,0)
GMRCAAC^^0^B7900333
"BLD",6829,"KRN",9.8,"NM",2,0)
GMRCASV^^0^B66332685
"BLD",6829,"KRN",9.8,"NM",3,0)
GMRCGUIB^^0^B43541445
"BLD",6829,"KRN",9.8,"NM",4,0)
GMRCP^^0^B19313009
"BLD",6829,"KRN",9.8,"NM",5,0)
GMRCP5A^^0^B75809712
"BLD",6829,"KRN",9.8,"NM",6,0)
GMRCSRVS^^0^B67385586
"BLD",6829,"KRN",9.8,"NM","B","GMRCAAC",1)

"BLD",6829,"KRN",9.8,"NM","B","GMRCASV",2)

"BLD",6829,"KRN",9.8,"NM","B","GMRCGUIB",3)

"BLD",6829,"KRN",9.8,"NM","B","GMRCP",4)

"BLD",6829,"KRN",9.8,"NM","B","GMRCP5A",5)

"BLD",6829,"KRN",9.8,"NM","B","GMRCSRVS",6)

"BLD",6829,"KRN",19,0)
19
"BLD",6829,"KRN",19.1,0)
19.1
"BLD",6829,"KRN",101,0)
101
"BLD",6829,"KRN",409.61,0)
409.61
"BLD",6829,"KRN",771,0)
771
"BLD",6829,"KRN",870,0)
870
"BLD",6829,"KRN",8989.51,0)
8989.51
"BLD",6829,"KRN",8989.52,0)
8989.52
"BLD",6829,"KRN",8994,0)
8994
"BLD",6829,"KRN","B",.4,.4)

"BLD",6829,"KRN","B",.401,.401)

"BLD",6829,"KRN","B",.402,.402)

"BLD",6829,"KRN","B",.403,.403)

"BLD",6829,"KRN","B",.5,.5)

"BLD",6829,"KRN","B",.84,.84)

"BLD",6829,"KRN","B",3.6,3.6)

"BLD",6829,"KRN","B",3.8,3.8)

"BLD",6829,"KRN","B",9.2,9.2)

"BLD",6829,"KRN","B",9.8,9.8)

"BLD",6829,"KRN","B",19,19)

"BLD",6829,"KRN","B",19.1,19.1)

"BLD",6829,"KRN","B",101,101)

"BLD",6829,"KRN","B",409.61,409.61)

"BLD",6829,"KRN","B",771,771)

"BLD",6829,"KRN","B",870,870)

"BLD",6829,"KRN","B",8989.51,8989.51)

"BLD",6829,"KRN","B",8989.52,8989.52)

"BLD",6829,"KRN","B",8994,8994)

"BLD",6829,"QUES",0)
^9.62^^
"BLD",6829,"REQB",0)
^9.611^3^3
"BLD",6829,"REQB",1,0)
GMRC*3.0*27^1
"BLD",6829,"REQB",2,0)
GMRC*3.0*40^1
"BLD",6829,"REQB",3,0)
GMRC*3.0*45^1
"BLD",6829,"REQB","B","GMRC*3.0*27",1)

"BLD",6829,"REQB","B","GMRC*3.0*40",2)

"BLD",6829,"REQB","B","GMRC*3.0*45",3)

"FIA",123.3)
GMRC PROCEDURE
"FIA",123.3,0)
^GMR(123.3,
"FIA",123.3,0,0)
123.3O
"FIA",123.3,0,1)
y^n^p^^^^n^^n
"FIA",123.3,0,10)

"FIA",123.3,0,11)

"FIA",123.3,0,"RLRO")

"FIA",123.3,0,"VR")
3.0^GMRC
"FIA",123.3,123.3)
1
"FIA",123.3,123.3,.01)

"FIA",123.5)
REQUEST SERVICES
"FIA",123.5,0)
^GMR(123.5,
"FIA",123.5,0,0)
123.5I
"FIA",123.5,0,1)
y^n^p^^^^n^^n
"FIA",123.5,0,10)

"FIA",123.5,0,11)

"FIA",123.5,0,"RLRO")

"FIA",123.5,0,"VR")
3.0^GMRC
"FIA",123.5,123.5)
1
"FIA",123.5,123.5,.01)

"MBREQ")
0
"PKG",222,-1)
1^1
"PKG",222,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",222,22,0)
^9.49I^1^1
"PKG",222,22,1,0)
3.0^2980101^2990325^66481
"PKG",222,22,1,"PAH",1,0)
53^3070111^12463
"PKG",222,22,1,"PAH",1,1,0)
^^4^4^3070111
"PKG",222,22,1,"PAH",1,1,1,0)
This patch corrects a couple of printing issues, a consult forwarding
"PKG",222,22,1,"PAH",1,1,2,0)
issue, an administrative completion issue, and duplicate service names.
"PKG",222,22,1,"PAH",1,1,3,0)
It also adds an additional warning when creating Consult Services and
"PKG",222,22,1,"PAH",1,1,4,0)
additional information in the Consult documentation.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","GMRCAAC")
0^1^B7900333^B7153655
"RTN","GMRCAAC",1,0)
GMRCAAC ;SLC/DLT - Administrative Complete action consult logic ;7/16/98  01:47
"RTN","GMRCAAC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,53**;DEC 27, 1997;Build 3
"RTN","GMRCAAC",3,0)
COMP(GMRCO) ;Clerk action to Complete an order
"RTN","GMRCAAC",4,0)
 ;GMRCO is the selected consult
"RTN","GMRCAAC",5,0)
 K GMRCQUT,GMRCQIT
"RTN","GMRCAAC",6,0)
 I '+$G(GMRCO) D SELECT^GMRCA2(.GMRCO) I $D(GMRCQUT) D END Q
"RTN","GMRCAAC",7,0)
 I '+$G(GMRCO) D END S GMRCQUT=1 Q
"RTN","GMRCAAC",8,0)
 ;
"RTN","GMRCAAC",9,0)
 N GMRC,GMRCSTS,GMRCQUT
"RTN","GMRCAAC",10,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:GMRC(0)=""
"RTN","GMRCAAC",11,0)
 ;
"RTN","GMRCAAC",12,0)
 ;Completion action restricted if status is 1,2,or 13
"RTN","GMRCAAC",13,0)
 S GMRCSTS=$P(GMRC(0),"^",12)
"RTN","GMRCAAC",14,0)
 I $S(GMRCSTS<3:1,GMRCSTS=13:1,1:0) D  Q
"RTN","GMRCAAC",15,0)
 . N GMRCMSG
"RTN","GMRCAAC",16,0)
 . S GMRCMSG="This order has already been "_$S(GMRCSTS=1:"discontinued",GMRCSTS=2:"completed",1:"cancelled")_"!"
"RTN","GMRCAAC",17,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",18,0)
 . S GMRCQUT=1
"RTN","GMRCAAC",19,0)
 . D END
"RTN","GMRCAAC",20,0)
 ;
"RTN","GMRCAAC",21,0)
 ;Get the provider, activity date, and significant findings
"RTN","GMRCAAC",22,0)
 N DFN,ORIFN,ORGY,GMRCSF,GMRCSTS,GMRCA,GMRCDR,GMRCORNP,GMRCAD,GMRCADUZ
"RTN","GMRCAAC",23,0)
 S ORGY="",(GMRCIFN,ORIFN)=$P(GMRC(0),"^",3),GMRCORVP=$P(GMRC(0),"^",2)_";DPT("
"RTN","GMRCAAC",24,0)
 S DFN=+GMRCORVP
"RTN","GMRCAAC",25,0)
 N GETPROV D GETPROV^GMRCAU I $G(GMRCQIT)="Q" D END Q
"RTN","GMRCAAC",26,0)
 S GMRCAD=$$GETDT^GMRCUTL1 I GMRCAD="^" S GMRCQIT="Q" D END Q
"RTN","GMRCAAC",27,0)
 S GMRCSFO=$P(GMRC(0),"^",19)
"RTN","GMRCAAC",28,0)
 S GMRCSF=$$GETSIGF^GMRCASF(GMRCSFO) I GMRCSF=0 D END Q
"RTN","GMRCAAC",29,0)
 ;
"RTN","GMRCAAC",30,0)
 ;Update the Activity Log for an audit trail
"RTN","GMRCAAC",31,0)
 S GMRCSTS=2,GMRCA=10
"RTN","GMRCAAC",32,0)
 N GMRCQUIT S GMRCOM=1 D AUDIT^GMRCP I +$G(GMRCQUIT)=1 Q
"RTN","GMRCAAC",33,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG) Q
"RTN","GMRCAAC",34,0)
 ;Update status, last action and significant findings
"RTN","GMRCAAC",35,0)
 S GMRCDR="8////^S X=GMRCSTS;9////^S X=GMRCA;15////^S X=GMRCSF"
"RTN","GMRCAAC",36,0)
 D STATUS^GMRCP
"RTN","GMRCAAC",37,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D  Q
"RTN","GMRCAAC",38,0)
 . N DA,DIK
"RTN","GMRCAAC",39,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",40,0)
 . S DA=$O(^GMR(123,+GMRCO,40,"A"),-1),DA(1)=+GMRCO,DIK="^GMR(123,"_DA(1)_",40," D ^DIK K DIK
"RTN","GMRCAAC",41,0)
 ;
"RTN","GMRCAAC",42,0)
 D EN^GMRCHL7(DFN,GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,$G(GMRCAD))
"RTN","GMRCAAC",43,0)
 S GMRCADUZ=""
"RTN","GMRCAAC",44,0)
 I $P(^GMR(123,GMRCO,0),"^",14) S GMRCADUZ($P(^(0),"^",14))=""
"RTN","GMRCAAC",45,0)
 S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCAAC",46,0)
 D MSG^GMRCP($P(^GMR(123,GMRCO,0),"^",2),GMRCORTX,+GMRCO,23,.GMRCADUZ,0)
"RTN","GMRCAAC",47,0)
 Q
"RTN","GMRCAAC",48,0)
 ;
"RTN","GMRCAAC",49,0)
NOUPD ;Exit without making an update
"RTN","GMRCAAC",50,0)
 S GMRCMSG="Completion activity ignored."
"RTN","GMRCAAC",51,0)
 D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCAAC",52,0)
 Q
"RTN","GMRCAAC",53,0)
END K DUOUT,X,Y,GMRCPL,GMRCPLI,GMRCURG,GMRCURGI,GMRCPRI,XQORM
"RTN","GMRCAAC",54,0)
 I '$D(GMRCNM) K GMRCVP
"RTN","GMRCAAC",55,0)
 K GMRCDT,GMRCAD,GMRCL,GMRCTYPE
"RTN","GMRCAAC",56,0)
 I '$D(GMRCO) S (GMRCO,ORIFN)=""
"RTN","GMRCAAC",57,0)
 K GMRCIFN,GMRCMSG,GMRCORTX,GMRCSA,GMRCSTS,GMRCADUZ,STS
"RTN","GMRCAAC",58,0)
 Q
"RTN","GMRCASV")
0^2^B66332685^B64890269
"RTN","GMRCASV",1,0)
GMRCASV ;SLC/KCM,DLT - Build ^TMP("GMRCS" of Svc(s)/Specialties ; 11/25/2000
"RTN","GMRCASV",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,12,18,22,53**;DEC 27, 1997;Build 3
"RTN","GMRCASV",3,0)
 ; This routine invokes IA #2426
"RTN","GMRCASV",4,0)
 ;
"RTN","GMRCASV",5,0)
ASRV ;Ask for service/specialty group {output} GMRCDG,GMRCBUF,GMRCACT,^TMP("GMRCS",$J,^TMP("GMRCSLIST",$J
"RTN","GMRCASV",6,0)
 K GMRCQUT
"RTN","GMRCASV",7,0)
 N GMRCSEL
"RTN","GMRCASV",8,0)
 D SERV0 D:GMRCDG SERV1
"RTN","GMRCASV",9,0)
 K W,X,Y Q
"RTN","GMRCASV",10,0)
SERV0 ;Assume that the lookup must begin with ALL SERVICES, or value of GMRCSVNM
"RTN","GMRCASV",11,0)
 ;GMRCASV=the ask prompt text
"RTN","GMRCASV",12,0)
 ;GMRCSVNM=text to use for default name
"RTN","GMRCASV",13,0)
 S GMRCDG=0
"RTN","GMRCASV",14,0)
 S:$G(GMRCASV)["Forward" GMRCTO=1
"RTN","GMRCASV",15,0)
 F  D ASKPRMPT S:X["^^" DIROUT=1 S:X["^" GMRCQUT=1 Q:X["^"  D @$S(X["?":"LISTALL",1:"LKUP") D:($L($G(GMRCSVNM))&GMRCDG) LISTSRV Q:GMRCDG
"RTN","GMRCASV",16,0)
 Q
"RTN","GMRCASV",17,0)
ASKPRMPT ;Write the prompt and do the Read to get the user text entered in X
"RTN","GMRCASV",18,0)
 W !!,$S($D(GMRCASV):GMRCASV,1:"Select Service/Specialty: ")_$S($L($G(GMRCSVNM)):GMRCSVNM,1:"ALL SERVICES")_"// "
"RTN","GMRCASV",19,0)
 R X:DTIME
"RTN","GMRCASV",20,0)
 I '$T S X="^"
"RTN","GMRCASV",21,0)
 I X'["^" S X=$S($G(GMRCASV)["Forward"&('$L(X)):"^",'$L(X):"ALL SERVICES",1:X) Q
"RTN","GMRCASV",22,0)
 Q
"RTN","GMRCASV",23,0)
SERV1 ;Create selected SERVICE ^TMP array of service information
"RTN","GMRCASV",24,0)
 ;If GMRCTO=1 then the BILD section will not include disabled or tracking services which the user cannot send to.
"RTN","GMRCASV",25,0)
 N GMRCDGT
"RTN","GMRCASV",26,0)
 S GMRCBUF=GMRCDG
"RTN","GMRCASV",27,0)
 I GMRCBUF>0 D
"RTN","GMRCASV",28,0)
 . K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCASV",29,0)
 . S GMRCDGT=0,GMRCSEL="BILD" D EN
"RTN","GMRCASV",30,0)
 . S GMRCGRP("NAM")=^GMR(123.5,GMRCBUF,0)
"RTN","GMRCASV",31,0)
 . S (GMRCDG,GMRCGRP("ROOT"))=GMRCBUF
"RTN","GMRCASV",32,0)
 . S GMRCGRP("NAM")=$S($L($P(GMRCGRP("NAM"),"^",3)):$P(GMRCGRP("NAM"),"^",3),1:$E($P(GMRCGRP("NAM"),"^"),1,5))
"RTN","GMRCASV",33,0)
 K GMRCSEQ,GMRCBUF
"RTN","GMRCASV",34,0)
 Q
"RTN","GMRCASV",35,0)
LKUP ;Ask the user for the service; use the value of x for lookup; branch to list on ??
"RTN","GMRCASV",36,0)
 ; Patch 18 added Identifier to 123.5 in place of DIC("W")
"RTN","GMRCASV",37,0)
 ; Remove commented line in next patch.
"RTN","GMRCASV",38,0)
 ;S DIC="^GMR(123.5,",DIC(0)="MNEQZ"
"RTN","GMRCASV",39,0)
 ;D ^DIC K DIC
"RTN","GMRCASV",40,0)
 ; Patch 53 added screen to prevent Forwarding to a Tracking Service
"RTN","GMRCASV",41,0)
 I $G(GMRCTO)=1 S DIC("S")="I ($$VALIDU^GMRCAU(Y,DUZ)&($P($G(^(0)),U,2)=2))!($P($G(^(0)),U,2)="""")!($P($G(^(0)),U,2)=1)"
"RTN","GMRCASV",42,0)
 S DIC="^GMR(123.5,",DIC(0)="MNEQZ",D="B^D"
"RTN","GMRCASV",43,0)
 D MIX^DIC1 K DIC
"RTN","GMRCASV",44,0)
 I '$D(Y(0)) D LISTALL Q
"RTN","GMRCASV",45,0)
 N W,GMRCEXCL I +$G(GMRCTO) D
"RTN","GMRCASV",46,0)
 . S W=Y(0),GMRCDG=+Y
"RTN","GMRCASV",47,0)
 . S GMRCEXCL=0 D EXCLUDE
"RTN","GMRCASV",48,0)
 . I GMRCEXCL=1 S GMRCSVNM=Y(0,0),GMRCEXCL=0 Q
"RTN","GMRCASV",49,0)
 . K GMRCSVNM ;Service selected is not a grouper for lookup
"RTN","GMRCASV",50,0)
 . I GMRCEXCL=9 S GMRCMSG="You have selected a disabled service!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",51,0)
 . I GMRCEXCL=3 S GMRCMSG="You may not forward this Inter-facility Consult to another inter-facility consult service." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",52,0)
 . N GMRCDAD D CHECKDAD
"RTN","GMRCASV",53,0)
 . I GMRCEXCL=90 S GMRCMSG="You have selected a service that is not part of the ALL SERVICES hierarchy!",GMRCMSG(1)="Contact Consult ADPAC" D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",54,0)
 . ;I GMRCEXCL=9 S GMRCMSG="You have selected a service whose parent is disabled!" D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",55,0)
 . I GMRCEXCL=2 S GMRCMSG="You have selected a service whose parent is a tracking service!",GMRCMSG(1)="You do not have authorization to send consults to this service." D EXAC^GMRCADC(.GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",56,0)
 . I GMRCEXCL=3 S GMRCMSG="You may not forward this Inter-facility Consult to another inter-facility consult service." D EXAC^GMRCADC(GMRCMSG) K GMRCMSG Q
"RTN","GMRCASV",57,0)
 I +$G(GMRCEXCL) S Y=0,GMRCDG=0
"RTN","GMRCASV",58,0)
 S:Y>0 GMRCDG=+Y ;falls to here when service is a grouper or not excluded
"RTN","GMRCASV",59,0)
 Q
"RTN","GMRCASV",60,0)
 ;
"RTN","GMRCASV",61,0)
LISTOPT ;called from option to list hierarchy
"RTN","GMRCASV",62,0)
 S %ZIS="Q"
"RTN","GMRCASV",63,0)
 D ^%ZIS I POP Q
"RTN","GMRCASV",64,0)
 I $D(IO("Q")) D QUEUE^GMRCASV1 D ^%ZISC,HOME^%ZIS Q
"RTN","GMRCASV",65,0)
 D PRTLST
"RTN","GMRCASV",66,0)
 D ^%ZISC,HOME^%ZIS
"RTN","GMRCASV",67,0)
 Q
"RTN","GMRCASV",68,0)
 ;
"RTN","GMRCASV",69,0)
PRTLST ;queued entry point or just print it
"RTN","GMRCASV",70,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMRCASV",71,0)
 U IO
"RTN","GMRCASV",72,0)
 N GMRCPRT,GMRCPG,GMRCTO,GMRCDG,GMRCOUT
"RTN","GMRCASV",73,0)
 N DUOUT,DTOUT,DIROUT
"RTN","GMRCASV",74,0)
 S GMRCPG=0,GMRCPRT=1
"RTN","GMRCASV",75,0)
 D PAGE^GMRCASV1(.GMRCPG)
"RTN","GMRCASV",76,0)
 D LISTALL I $D(GMRCOUT) Q
"RTN","GMRCASV",77,0)
 I $Y>(IOSL-4) D READ I $D(GMRCOUT) Q
"RTN","GMRCASV",78,0)
 W !!,"Services not currently part of the Consults Hierarchy:"
"RTN","GMRCASV",79,0)
 N SERV S SERV=1
"RTN","GMRCASV",80,0)
 F  S SERV=$O(^GMR(123.5,SERV)) Q:'SERV  Q:$D(GMRCOUT)  D
"RTN","GMRCASV",81,0)
 . I '$D(^GMR(123.5,"APC",SERV)) D
"RTN","GMRCASV",82,0)
 .. I $Y>(IOSL-4) D READ I $D(GMRCOUT) Q
"RTN","GMRCASV",83,0)
 .. W !,?3,$P(^GMR(123.5,SERV,0),U) I '$P(^(0),U,2) Q
"RTN","GMRCASV",84,0)
 .. N USE S USE=$P(^GMR(123.5,SERV,0),U,2)
"RTN","GMRCASV",85,0)
 .. W "  ("
"RTN","GMRCASV",86,0)
 .. W $S(USE=1:"Grouper Only",USE=9:"Disabled",1:"Tracking Only")_")"
"RTN","GMRCASV",87,0)
 K GMRCDG D EXIT
"RTN","GMRCASV",88,0)
 Q
"RTN","GMRCASV",89,0)
LISTALL ;display LIST of Services in their hierarchy beginning with ALL SERVICES
"RTN","GMRCASV",90,0)
 S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0)) Q:'GMRCDG
"RTN","GMRCASV",91,0)
 S GMRCSEL="DISP" W:'$D(GMRCPRT) @IOF D EN
"RTN","GMRCASV",92,0)
 S GMRCDG=0 W !
"RTN","GMRCASV",93,0)
 Q
"RTN","GMRCASV",94,0)
LISTSRV ;display LIST of sub-services beginning with a selected service
"RTN","GMRCASV",95,0)
 S GMRC1=0,GMRCDG=$O(^GMR(123.5,"B",GMRCSVNM,0)) Q:'GMRCDG
"RTN","GMRCASV",96,0)
 S GMRCSEL="DISP" W @IOF D EN
"RTN","GMRCASV",97,0)
 S GMRCDG=0 W !
"RTN","GMRCASV",98,0)
 Q
"RTN","GMRCASV",99,0)
EN ;Setup Specialty groups   entry: GMRCDG,GMRCSEL   exit: GMRCGRP if GMRCSEL="BILD"
"RTN","GMRCASV",100,0)
 N GMRCSTK,PARENT,GMRCUSG,GMRCEXCL
"RTN","GMRCASV",101,0)
 S GMRCSTK=0,PARENT=0 ;beginning service logic
"RTN","GMRCASV",102,0)
 D @GMRCSEL Q:$D(DUOUT)!($D(DIROUT))!($D(GMRCOUT))
"RTN","GMRCASV",103,0)
EN1 ;GMRCSTK is used to manage the level of stacks under beginning service
"RTN","GMRCASV",104,0)
 S GMRCSTK=1,GMRCSTK(GMRCSTK)=GMRCDG_"^0",GMRCSTK(0)=0,GMRCMEM=0,GMRCNAM=""
"RTN","GMRCASV",105,0)
 F  S GMRCNAM=$O(^GMR(123.5,+GMRCSTK(GMRCSTK),10,"AC",GMRCNAM)) D  D @$S(+GMRCMEM'>0:"POP",1:"PROC") Q:GMRCSTK<1
"RTN","GMRCASV",106,0)
 . I $G(GMRCEXCL) S GMRCMEM=0 Q  ;Exclude children of excluded parent
"RTN","GMRCASV",107,0)
 . I '$L(GMRCNAM) S GMRCMEM=0 ;No more 10th node children
"RTN","GMRCASV",108,0)
 . E  S GMRCMEM=$O(^GMR(123.5,+GMRCSTK(GMRCSTK),10,"AC",GMRCNAM,""))
"RTN","GMRCASV",109,0)
 K DUOUT,GMRCMEM,GMRCNAM,GMRCSTK,GMRCSEL
"RTN","GMRCASV",110,0)
 Q
"RTN","GMRCASV",111,0)
POP ;Go back one level in service stack hierarchy and initialize exclude
"RTN","GMRCASV",112,0)
 S GMRCSTK=GMRCSTK-1,GMRCMEM=$P(GMRCSTK(GMRCSTK),"^",2),GMRCNAM=$P(GMRCSTK(GMRCSTK),"^",3),GMRCEXCL=0
"RTN","GMRCASV",113,0)
 Q
"RTN","GMRCASV",114,0)
PROC ;GMRCMEM is the member ien in the 10th node being processed
"RTN","GMRCASV",115,0)
 ;GMRCDG is the ien of file 123.5 being processed
"RTN","GMRCASV",116,0)
 ;GMRCNAM is the services name
"RTN","GMRCASV",117,0)
 S $P(GMRCSTK(GMRCSTK),"^",2)=GMRCMEM
"RTN","GMRCASV",118,0)
 S $P(GMRCSTK(GMRCSTK),"^",3)=GMRCNAM
"RTN","GMRCASV",119,0)
 Q:'$D(^GMR(123.5,+GMRCSTK(GMRCSTK),10,GMRCMEM,0))  ;ghost "AC" x-ref 
"RTN","GMRCASV",120,0)
 S GMRCDG=$P(^GMR(123.5,+GMRCSTK(GMRCSTK),10,GMRCMEM,0),"^",1)
"RTN","GMRCASV",121,0)
 S PARENT=+GMRCSTK(GMRCSTK)
"RTN","GMRCASV",122,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",123,0)
 I $G(GMRCTO)=1 S GMRCEXCL=0 D EXCLUDE S:GMRCEXCL=1 GMRCEXCL=0 ;Includes grouper only
"RTN","GMRCASV",124,0)
 D:'+$G(GMRCEXCL) @GMRCSEL G:($D(DUOUT)!$D(DIROUT)) EXIT
"RTN","GMRCASV",125,0)
 ;Initialize a stack level entry to process children of the multiple
"RTN","GMRCASV",126,0)
 S GMRCSTK=GMRCSTK+1,GMRCSTK(GMRCSTK)=GMRCDG_"^0",GMRCMEM=0,GMRCNAM=""
"RTN","GMRCASV",127,0)
 Q
"RTN","GMRCASV",128,0)
DISP ;Display individual entries alphabetically for each service as processed
"RTN","GMRCASV",129,0)
 Q:$D(GMRCOUT)
"RTN","GMRCASV",130,0)
 I $Y>(IOSL-4) D READ S:$D(DUOUT)!($D(DIROUT)) GMRCSTK=0 G:GMRCSTK=0 EXIT
"RTN","GMRCASV",131,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",132,0)
 S GMRCUSG=$P(W,"^",2)
"RTN","GMRCASV",133,0)
 W !,?((GMRCSTK*2)),$S(GMRCUSG=9:"<",1:"")_$P(W,"^")_$S(GMRCUSG=9:">",1:"")_"  "_$S(GMRCUSG=1:"(Grouper Only)",GMRCUSG=2:"(Tracking Only)",GMRCUSG=9:"<Disabled>",1:"")_"  "_$S($G(^GMR(123.5,GMRCDG,"IFC")):"(Inter-facility)",1:"")
"RTN","GMRCASV",134,0)
 Q
"RTN","GMRCASV",135,0)
BILD ;The following logic will build an array for review for GUI
"RTN","GMRCASV",136,0)
 ;GMRCDGT=sequential number,GMRCDG=service pointer,
"RTN","GMRCASV",137,0)
 ;W=^GMR(123.5,GMRCDG,0),1st piece is name, 2nd piece usage
"RTN","GMRCASV",138,0)
 ;If GMRCTO=1 then services that only consults can be sent to will be
"RTN","GMRCASV",139,0)
 ;included with the exception of "grouper only" which keeps the
"RTN","GMRCASV",140,0)
 ;hierarchy in order.
"RTN","GMRCASV",141,0)
 N CHILD
"RTN","GMRCASV",142,0)
 S W=$G(^GMR(123.5,GMRCDG,0))
"RTN","GMRCASV",143,0)
 S ^TMP("GMRCS",$J,GMRCDG)=$P(W,"^")
"RTN","GMRCASV",144,0)
 S GMRCDGT=GMRCDGT+1
"RTN","GMRCASV",145,0)
 S CHILD=$O(^GMR(123.5,GMRCDG,10,0)) S CHILD=$S(+CHILD:"+",1:"")
"RTN","GMRCASV",146,0)
 S ^TMP("GMRCSLIST",$J,GMRCDGT)=GMRCDG_U_$P(W,"^")_U_PARENT_U_CHILD_U_$P(W,"^",2)
"RTN","GMRCASV",147,0)
 Q
"RTN","GMRCASV",148,0)
EXCLUDE ;This logic excludes services the user cannot send a consult to.
"RTN","GMRCASV",149,0)
 ;If GMRCTO=1 the user is forwarding or sending a consult
"RTN","GMRCASV",150,0)
 ;W=zeroth node of service,GMRCDG=ien of service,GMRCO=ien of consult (optional)
"RTN","GMRCASV",151,0)
 Q:'$L($G(W))
"RTN","GMRCASV",152,0)
 S GMRCEXCL=+$P(W,"^",2) ;Include grouper for hierarchy building only
"RTN","GMRCASV",153,0)
 I $G(GMRCTO),$G(GMRCO) D  ;exclude fwd'ing into IFC svc
"RTN","GMRCASV",154,0)
 . I $P($G(^GMR(123,+GMRCO,12)),U,5)'="F" Q
"RTN","GMRCASV",155,0)
 . I +$G(^GMR(123.5,+GMRCDG,"IFC")) S GMRCEXCL=3 Q
"RTN","GMRCASV",156,0)
 . I $L($P($G(^GMR(123.5,+GMRCDG,"IFC")),U,2)) S GMRCEXCL=3 Q
"RTN","GMRCASV",157,0)
 I GMRCEXCL=2 D  ;tracking service exclusion check
"RTN","GMRCASV",158,0)
 . N GMRCSRV I +$G(GMRCO) S GMRCSRV=$P($G(^GMR(123,+GMRCO,0)),"^",5) I $D(^GMR(123.5,"APC",+GMRCDG,+GMRCSRV)) S GMRCEXCL=0 Q  ;Checks if parent is the consults current service
"RTN","GMRCASV",159,0)
 . I $$VALID^GMRCAU(+GMRCDG,,DUZ) S GMRCEXCL=0 ;update user?
"RTN","GMRCASV",160,0)
 . Q
"RTN","GMRCASV",161,0)
 Q
"RTN","GMRCASV",162,0)
CHECKDAD ;Check the service usage statuses for a selected services parents
"RTN","GMRCASV",163,0)
 ;There are two passes, one to get any user accessible parent
"RTN","GMRCASV",164,0)
 ;and the second pass is through the GMRCDAD array to check the parents usage
"RTN","GMRCASV",165,0)
 ;The GMRCEXCL value is returned for exclusion due to parent
"RTN","GMRCASV",166,0)
 S GMRCDAD=""
"RTN","GMRCASV",167,0)
 ;FIRST PASS
"RTN","GMRCASV",168,0)
 F  S GMRCDAD=$O(^GMR(123.5,"APC",+GMRCDG,GMRCDAD)) Q:GMRCDAD=""  D  I $P($G(GMRCDAD(+GMRCDAD)),U,2)="OK" S GMRCEXCL="OK"
"RTN","GMRCASV",169,0)
 . S GMRCDAD(+GMRCDAD)=$P(^GMR(123.5,+GMRCDAD,0),U,2) ;dads service usage
"RTN","GMRCASV",170,0)
 . ;I $P($G(^GMR(123.5,+GMRCDAD,0)),U,1)="ALL SERVICES" S $P(GMRCDAD(GMRCDAD),U,2,3)="OK^ALL" Q  ;If one of the dad's is all services, than OK to send to if not previously excluded.
"RTN","GMRCASV",171,0)
 . I GMRCDAD(+GMRCDAD)=1 S $P(GMRCDAD(+GMRCDAD),"^",2)="OK" Q  ;Groupers Only are OK!
"RTN","GMRCASV",172,0)
 . I $$VALID^GMRCAU(+GMRCDAD,,DUZ) S $P(GMRCDAD(GMRCDAD),U,2,3)="OK^Update access" ;update user?
"RTN","GMRCASV",173,0)
 . Q
"RTN","GMRCASV",174,0)
 I GMRCEXCL="OK" S GMRCEXCL=0 Q  ;There is a parent which user has access to.
"RTN","GMRCASV",175,0)
 ;Second Pass of the GMRCDAD array (multiple parents)
"RTN","GMRCASV",176,0)
 S GMRCDAD=$O(GMRCDAD("")) I 'GMRCDAD S GMRCEXCL=90 Q  ;Not part of hierarchy; missing dad
"RTN","GMRCASV",177,0)
 ;Use first parent found in hierarchy.
"RTN","GMRCASV",178,0)
 S GMRCEXCL=+GMRCDAD(GMRCDAD)
"RTN","GMRCASV",179,0)
 Q
"RTN","GMRCASV",180,0)
READ ;;Hold screen
"RTN","GMRCASV",181,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","GMRCASV",182,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","GMRCASV",183,0)
 N X W !?5,"Press RETURN to continue, ^ to exit: " R X:DTIME
"RTN","GMRCASV",184,0)
 S:X="^" DUOUT=1 S:'$T!(X="^^") DIROUT=1
"RTN","GMRCASV",185,0)
 I $D(DUOUT)!$D(DIROUT) S:$D(GMRCPRT) GMRCOUT=1
"RTN","GMRCASV",186,0)
 W @IOF
"RTN","GMRCASV",187,0)
 I '$D(DTOUT),('$D(DUOUT))&($D(GMRCPRT)) D PAGE^GMRCASV1(.GMRCPG)
"RTN","GMRCASV",188,0)
 Q
"RTN","GMRCASV",189,0)
 ;
"RTN","GMRCASV",190,0)
EXIT ;Kill off variables and quit
"RTN","GMRCASV",191,0)
 K DIROUT,DUOUT,DTOUT,DIRUT
"RTN","GMRCASV",192,0)
 Q
"RTN","GMRCGUIB")
0^3^B43541445^B40017497
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM,JFR,MA - GUI actions for consults ;8/19/03 07:31
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,18,20,17,22,29,30,35,45,53**;DEC 27, 1997;Build 3
"RTN","GMRCGUIB",3,0)
 ; This routine invokes IA #2980
"RTN","GMRCGUIB",4,0)
 ;
"RTN","GMRCGUIB",5,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",6,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",7,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",8,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",9,0)
 Q DA
"RTN","GMRCGUIB",10,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",11,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",12,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",13,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",14,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",15,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",16,0)
 K LN,L
"RTN","GMRCGUIB",17,0)
 Q
"RTN","GMRCGUIB",18,0)
SETCOM(COMMENT,WHO) ;Set comment array into tracking actions
"RTN","GMRCGUIB",19,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",20,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",21,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=$S($G(WHO):WHO,1:DUZ);6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF)"
"RTN","GMRCGUIB",22,0)
 D ^DIE
"RTN","GMRCGUIB",23,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",24,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",25,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",26,0)
 ;
"RTN","GMRCGUIB",27,0)
 ; if an IFC, call event handler to generate a msg to remote site
"RTN","GMRCGUIB",28,0)
 I $D(^GMR(123,+GMRCO,12)),$D(^(40,DA)) D TRIGR^GMRCIEVT(GMRCO,DA)
"RTN","GMRCGUIB",29,0)
 ;
"RTN","GMRCGUIB",30,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",31,0)
 Q
"RTN","GMRCGUIB",32,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult 
"RTN","GMRCGUIB",33,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",34,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",35,0)
 ; GMRCADUZ = array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",36,0)
 ; GMRCWHO = IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",37,0)
 ; GMRCWHN = date time of activity in FM format
"RTN","GMRCGUIB",38,0)
 ;
"RTN","GMRCGUIB",39,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN,GMRCTM,GMRCRP,GMRCUPD
"RTN","GMRCGUIB",40,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",41,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",42,0)
 D SETCOM(.GMRCOM,$G(GMRCWHO))
"RTN","GMRCGUIB",43,0)
 D  ;update LAST ACTION field even though no status change
"RTN","GMRCGUIB",44,0)
 . N GMRCDR,GMRCSTS
"RTN","GMRCGUIB",45,0)
 . S GMRCSTS="",GMRCDR="9////20"
"RTN","GMRCGUIB",46,0)
 . D STATUS^GMRCP
"RTN","GMRCGUIB",47,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",48,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",49,0)
 I $P($G(^GMR(123,GMRCO,12)),U,5)="P" D
"RTN","GMRCGUIB",50,0)
 . S GMRCORTX="Comment Added to remote consult "
"RTN","GMRCGUIB",51,0)
 S GMRCORTX=GMRCORTX_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIB",52,0)
 S GMRCRP=+$P(^GMR(123,GMRCO,0),U,14)
"RTN","GMRCGUIB",53,0)
 S GMRCUPD=$$VALID^GMRCAU($P(^GMR(123,+GMRCO,0),U,5),GMRCO,DUZ)
"RTN","GMRCGUIB",54,0)
 I GMRCRP=DUZ D  ;alert team if ord. prov. takes the action
"RTN","GMRCGUIB",55,0)
 . S GMRCTM=1
"RTN","GMRCGUIB",56,0)
 I GMRCUPD D  ; alert ord. prov if update users takes action
"RTN","GMRCGUIB",57,0)
 . S GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",58,0)
 I '$G(GMRCTM),'GMRCUPD D  ;alert both if not ord. prov or update user
"RTN","GMRCGUIB",59,0)
 . S GMRCTM=1,GMRCADUZ(GMRCRP)=""
"RTN","GMRCGUIB",60,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,63,.GMRCADUZ,$G(GMRCTM))
"RTN","GMRCGUIB",61,0)
 Q
"RTN","GMRCGUIB",62,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",63,0)
 ; ADMIN COMPLETE or SIGNIFICANT FINDINGS
"RTN","GMRCGUIB",64,0)
 ;Input variables:
"RTN","GMRCGUIB",65,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",66,0)
 ;GMRCA=pointer to REQUEST ACTION TYPES (#123.1) 10=complete, 4=Sig find.
"RTN","GMRCGUIB",67,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",68,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",69,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",70,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",71,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",72,0)
 ;GMRCOM=An array of comments by reference ARRAY(1)="xxx",ARRAY(2)="xxx"
"RTN","GMRCGUIB",73,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",74,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",75,0)
 ;GMRCAD =FM date/time of activity
"RTN","GMRCGUIB",76,0)
 ;
"RTN","GMRCGUIB",77,0)
 ;Output:
"RTN","GMRCGUIB",78,0)
 ; GMRCERR=Error Flag: 0 if no error, 1 if error occurred
"RTN","GMRCGUIB",79,0)
 ; GMRCERMS - Error message or null
"RTN","GMRCGUIB",80,0)
 ;    returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",81,0)
 ;
"RTN","GMRCGUIB",82,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIB",83,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",84,0)
 S GMRCERR=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",85,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",86,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2)
"RTN","GMRCGUIB",87,0)
 I '$G(GMRCDUZ) S GMRCDUZ=DUZ
"RTN","GMRCGUIB",88,0)
 I '$G(GMRCAD) S GMRCAD=GMRCNOW
"RTN","GMRCGUIB",89,0)
 ;Insure comment array contains text for Complete action.
"RTN","GMRCGUIB",90,0)
 I GMRCA=10 D  I GMRCERR=1 S GMRCERMS="Comment field must contain a text value!" Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",91,0)
 . S GMRCERR=1
"RTN","GMRCGUIB",92,0)
 . I '$D(GMRCOM) Q
"RTN","GMRCGUIB",93,0)
 . N GMRCOM1 S GMRCOM1=""
"RTN","GMRCGUIB",94,0)
 . F  S GMRCOM1=$O(GMRCOM(GMRCOM1)) Q:(GMRCOM1=""!(GMRCERR=0))  D
"RTN","GMRCGUIB",95,0)
 .. I $TR($G(GMRCOM(GMRCOM1))," ","")'="" S GMRCERR=0 Q
"RTN","GMRCGUIB",96,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",97,0)
 .S GMRCSF=$G(GMRCSF,"")
"RTN","GMRCGUIB",98,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",99,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA;15////^S X=GMRCSF"
"RTN","GMRCGUIB",100,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",101,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",102,0)
 .Q
"RTN","GMRCGUIB",103,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",104,0)
 .N I
"RTN","GMRCGUIB",105,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",106,0)
 .Q
"RTN","GMRCGUIB",107,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",108,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",109,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",110,0)
 .Q
"RTN","GMRCGUIB",111,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",112,0)
 I '$O(GMRCOM(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",113,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",114,0)
 .N DA
"RTN","GMRCGUIB",115,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",116,0)
 .D SETCOM(.GMRCOM,GMRCDUZ)
"RTN","GMRCGUIB",117,0)
 .Q
"RTN","GMRCGUIB",118,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",119,0)
 ;
"RTN","GMRCGUIB",120,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:63,1:23),.GMRCADUZ,0)
"RTN","GMRCGUIB",121,0)
 ;
"RTN","GMRCGUIB",122,0)
 I $S(GMRCA=10:1,(GMRCA=4&($P(^GMR(123,GMRCO,0),U,12)=2)):1,1:0) D
"RTN","GMRCGUIB",123,0)
 . D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIB",124,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",125,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",126,0)
 ;
"RTN","GMRCGUIB",127,0)
SCH(GMRCO,GMRCORNP,GMRCAD,GMRCADUZ,GMRCMT) ;schedule a consult API
"RTN","GMRCGUIB",128,0)
 ; Input variables:
"RTN","GMRCGUIB",129,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIB",130,0)
 ;GMRCORNP - Name of the person who actually 'Received' the consult 
"RTN","GMRCGUIB",131,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIB",132,0)
 ;GMRCADUZ - array of alert recipients as chosen by user (by reference)
"RTN","GMRCGUIB",133,0)
 ;   ARRAY(DUZ)="" 
"RTN","GMRCGUIB",134,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIB",135,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIB",136,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIB",137,0)
 ;
"RTN","GMRCGUIB",138,0)
 ;Output:
"RTN","GMRCGUIB",139,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIB",140,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIB",141,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",142,0)
        ;
"RTN","GMRCGUIB",143,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIB",144,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",145,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIB",146,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIB",147,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" D  Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",148,0)
 . S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found."
"RTN","GMRCGUIB",149,0)
 . D EXIT^GMRCGUIA
"RTN","GMRCGUIB",150,0)
 S GMRCSTS=8,GMRCA=8
"RTN","GMRCGUIB",151,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT^GMRCGUIA Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",152,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",153,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIB",154,0)
 . S DA=$$SETDA
"RTN","GMRCGUIB",155,0)
 . D SETCOM(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIB",156,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","","",GMRCAD)
"RTN","GMRCGUIB",157,0)
 D  ;send alerts
"RTN","GMRCGUIB",158,0)
 . N TXT
"RTN","GMRCGUIB",159,0)
 . S TXT="Scheduled Consult: "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",160,0)
 . I $P(^GMR(123,+GMRCO,0),U,14) S GMRCADUZ($P(^(0),U,14))=""
"RTN","GMRCGUIB",161,0)
 . D MSG^GMRCP(DFN,TXT,GMRCO,63,.GMRCADUZ,0)
"RTN","GMRCGUIB",162,0)
 D EXIT^GMRCGUIA
"RTN","GMRCGUIB",163,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",164,0)
DOCLIST(GMRCAR,GMRCDA,GMRCMED)  ;return list of linked results
"RTN","GMRCGUIB",165,0)
 ; Input:
"RTN","GMRCGUIB",166,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCGUIB",167,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCGUIB",168,0)
 ;  GMRCMED- 1 = include med results; 0 = only TIU docs
"RTN","GMRCGUIB",169,0)
 ;
"RTN","GMRCGUIB",170,0)
 ; Output:
"RTN","GMRCGUIB",171,0)
 ;  GMRCAR - array in format
"RTN","GMRCGUIB",172,0)
 ;       GMRCAR(0)=zero node of record
"RTN","GMRCGUIB",173,0)
 ;       GMRCAR(50,1)="ien;global ref," e.g. 5;TIU(8925, or 3;MCAR(691,
"RTN","GMRCGUIB",174,0)
 ;       GMRCAR(50,2)="ien;global ref,"
"RTN","GMRCGUIB",175,0)
 ;
"RTN","GMRCGUIB",176,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCGUIB",177,0)
 S GMRCAR(0)=^GMR(123,GMRCDA,0),$P(GMRCAR(0),U,20)=""
"RTN","GMRCGUIB",178,0)
 N RES,CNT S RES="",CNT=1
"RTN","GMRCGUIB",179,0)
 F  S RES=$O(^GMR(123,GMRCDA,50,"B",RES)) Q:RES=""  D
"RTN","GMRCGUIB",180,0)
 . I '$G(GMRCMED) Q:RES'["TIU(8925"
"RTN","GMRCGUIB",181,0)
 . S GMRCAR(50,CNT)=RES
"RTN","GMRCGUIB",182,0)
 . I RES["MCAR" D
"RTN","GMRCGUIB",183,0)
 .. N ARR,STR
"RTN","GMRCGUIB",184,0)
 .. D MEDLKUP^MCARUTL3(.ARR,+$P(RES,"MCAR(",2),+RES)
"RTN","GMRCGUIB",185,0)
 .. I '+ARR K GMRCAR(50,CNT) Q
"RTN","GMRCGUIB",186,0)
 .. S STR=$P(ARR,U,9)_U_$P(ARR,U,6)_$S($P(ARR,U,10):"^^^^^^^^1",1:"")
"RTN","GMRCGUIB",187,0)
 .. S GMRCAR(50,CNT)=GMRCAR(50,CNT)_U_STR
"RTN","GMRCGUIB",188,0)
 . S CNT=CNT+1
"RTN","GMRCGUIB",189,0)
 Q
"RTN","GMRCP")
0^4^B19313009^B12723526
"RTN","GMRCP",1,0)
GMRCP ;SLC/DLT,DCM - Message audit and status process ;4/19/01  11:52
"RTN","GMRCP",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,17,22,27,53**;DEC 27, 1997;Build 3
"RTN","GMRCP",3,0)
 ;Processing action on Generic Requests/Consults from OE/RR
"RTN","GMRCP",4,0)
MSG(GMRCDFN,GMRCALRM,GMRCIFN,ORN,GMRCADUZ,FLG) ;send alert notification information to OERR for notification or update
"RTN","GMRCP",5,0)
 ;GMRCDFN=patient's DFN           GMRCORFN=OR file # ^OR(100,GMRCORFN
"RTN","GMRCP",6,0)
 ;GMRCALRM=alert message to be displayed with alert
"RTN","GMRCP",7,0)
 ;GMRCIFN=internal file number of consult in file 123
"RTN","GMRCP",8,0)
 ;GMRCADUZ=set in call to EN^GMRCT=array of providers who will be alerted
"RTN","GMRCP",9,0)
 ;FLG=1 if need to get list of service's providers, 0 if service dc'd.
"RTN","GMRCP",10,0)
 ;ORN=IFN from file ^ORD(100.9, for consult notification action
"RTN","GMRCP",11,0)
 N GMRCSS,GMRCORFN
"RTN","GMRCP",12,0)
 S GMRCORFN=$P(^GMR(123,+GMRCIFN,0),"^",3)
"RTN","GMRCP",13,0)
 S GMRCSS=$P($G(^GMR(123,+GMRCIFN,0)),"^",5)
"RTN","GMRCP",14,0)
 I FLG,GMRCSS D EN^GMRCT(GMRCSS)
"RTN","GMRCP",15,0)
 I $P($G(^GMR(123,+GMRCIFN,12)),U,5)="P" D
"RTN","GMRCP",16,0)
 . Q:ORN=27  ; don't notify requestor if a new order they placed, duh...
"RTN","GMRCP",17,0)
 . I DUZ=+$P(^GMR(123,+GMRCIFN,0),U,14) Q  ; don;t alert on own actions
"RTN","GMRCP",18,0)
 . S GMRCADUZ(+$P(^GMR(123,+GMRCIFN,0),U,14))=""
"RTN","GMRCP",19,0)
 I FLG,$P(^GMR(123,+GMRCIFN,0),"^",11) S GMRCADUZ($P(^(0),"^",11))=""
"RTN","GMRCP",20,0)
 S:'$D(GMRCADUZ) GMRCADUZ=""
"RTN","GMRCP",21,0)
 D EN^ORB3(ORN,GMRCDFN,GMRCORFN,.GMRCADUZ,GMRCALRM,GMRCIFN)
"RTN","GMRCP",22,0)
 Q
"RTN","GMRCP",23,0)
AUDIT ;Build processing activity audit trail multiple.
"RTN","GMRCP",24,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCP",25,0)
AUDIT0 ;alternate entry with date already defined
"RTN","GMRCP",26,0)
 L +^GMR(123,+GMRCO,40):5 I '$T S GMRCUT=1,GMRCERR=1,GMRCERMS="Activity Trail Not filed - Consult In Use By Another User." L -^GMR(123,+GMRCO,40)  Q
"RTN","GMRCP",27,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCP",28,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCP",29,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCP",30,0)
AUDIT1 ;entry when the DA is not incremented (INCOMPLETE RPT writeovers)
"RTN","GMRCP",31,0)
 S GMRCORNP=$G(GMRCORNP) S:'$D(GMRCOM) GMRCOM=0
"RTN","GMRCP",32,0)
 S GMRCDEV=$G(GMRCDEV),GMRCFF=$G(GMRCFF),GMRCPA=$G(GMRCPA)
"RTN","GMRCP",33,0)
 S GMRCAD=$S('$D(GMRCAD):GMRCDT,1:GMRCAD)
"RTN","GMRCP",34,0)
 S GMRCRSLT=$G(GMRCRSLT) ;Added result with GMRC*3.0*4
"RTN","GMRCP",35,0)
 S DIE="^GMR(123,"_+GMRCO_",40,",DA(1)=+GMRCO
"RTN","GMRCP",36,0)
 I '$D(^GMR(123,DA(1),40,DA,0)) D
"RTN","GMRCP",37,0)
 . S DR=".01////^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=GMRCORNP"
"RTN","GMRCP",38,0)
 . I GMRCA'=22 S DR=DR_";4////^S X=DUZ" ;if it's a print, pkg did it
"RTN","GMRCP",39,0)
 . S DR=DR_";6////^S X=GMRCFF;7////^S X=GMRCPA;9////^S X=GMRCRSLT;8///^S X=GMRCDEV"
"RTN","GMRCP",40,0)
 E  D
"RTN","GMRCP",41,0)
 . ;DR string on .01 allows write over, rather than forced new entry
"RTN","GMRCP",42,0)
 . S DR=".01///^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=GMRCORNP;4////^S X=DUZ;6////^S X=GMRCFF;7////^S X=GMRCPA;9////^S X=GMRCRSLT;8///^S X=GMRCDEV"
"RTN","GMRCP",43,0)
 ;Added result to the DR string
"RTN","GMRCP",44,0)
 D ^DIE
"RTN","GMRCP",45,0)
COMMENT ;Enter comment
"RTN","GMRCP",46,0)
 I +$G(GMRCOM) S GMRCOM(0)=DA D
"RTN","GMRCP",47,0)
 . W !,"Enter COMMENT..."
"RTN","GMRCP",48,0)
 . N DIC,DWPK,DWLW,DIWESUB
"RTN","GMRCP",49,0)
 . S DIC=DIE_DA_",1,",DWPK=1,DWLW=74
"RTN","GMRCP",50,0)
 . S DIWESUB="COMMENTS" D EN^DIWE
"RTN","GMRCP",51,0)
 . I $P($G(^GMR(123.1,+$P(^GMR(123,+GMRCO,40,DA,0),U,2),0)),U)="ADDED COMMENT",'$O(^GMR(123,+GMRCO,40,DA,0)) D  Q
"RTN","GMRCP",52,0)
 .. S DA(1)=+GMRCO,DIK="^GMR(123,"_DA(1)_",40," D ^DIK K DIK
"RTN","GMRCP",53,0)
 .. Q
"RTN","GMRCP",54,0)
 . I $P($G(^GMR(123.1,+$P(^GMR(123,+GMRCO,40,DA,0),U,2),0)),U)="COMPLETE/UPDATE",$P($G(^GMR(123,+GMRCO,40,DA,0)),U,9)="" D
"RTN","GMRCP",55,0)
 .. N GMRCMT,GMRCMT1
"RTN","GMRCP",56,0)
 .. S (GMRCMT,GMRCMT1)=0
"RTN","GMRCP",57,0)
 .. F  S GMRCMT=$O(^GMR(123,+GMRCO,40,DA,1,GMRCMT)) Q:GMRCMT=""  D  Q:GMRCMT1=1
"RTN","GMRCP",58,0)
 ... I $TR($G(^GMR(123,+GMRCO,40,DA,1,GMRCMT,0))," ","")'="" S GMRCMT1=1
"RTN","GMRCP",59,0)
 .. I 'GMRCMT1 D  G:'GMRCQUIT COMMENT Q
"RTN","GMRCP",60,0)
 ... S GMRCQUIT=0
"RTN","GMRCP",61,0)
 ... W !!,"A comment is required to complete this request!",!
"RTN","GMRCP",62,0)
 ... D WP^DIE(123.02,DA_","_+GMRCO_",",5,,"@")
"RTN","GMRCP",63,0)
 ... K DIR
"RTN","GMRCP",64,0)
 ... S DIR("A")="Type 'Q' to quit or 'C' to continue entering a comment:"
"RTN","GMRCP",65,0)
 ... S DIR("B")="C"
"RTN","GMRCP",66,0)
 ... S DIR(0)="S^C:CONTINUE;Q:QUIT"
"RTN","GMRCP",67,0)
 ... S DIR("?")="Type 'Q' if you would like to abort completion of this Consult/Procedure."
"RTN","GMRCP",68,0)
 ... S DIR("?",1)="Type 'C' or press <RETURN> to re-enter your comments."
"RTN","GMRCP",69,0)
 ... D ^DIR K DIR I Y'="C" S GMRCQUIT=1,DA(1)=+GMRCO,DIK="^GMR(123,"_DA(1)_",40," D ^DIK K DIK
"RTN","GMRCP",70,0)
 . I '$G(DA) S DA=D0
"RTN","GMRCP",71,0)
 . I $D(^GMR(123,+GMRCO,40,DA,0)),$O(^GMR(123,+GMRCO,40,DA,0)) S $P(GMRCOM,"^",2)=1
"RTN","GMRCP",72,0)
 . Q
"RTN","GMRCP",73,0)
 L -^GMR(123,+GMRCO,40)
"RTN","GMRCP",74,0)
 ; if an IFC, call event handler to generate a msg to remote site
"RTN","GMRCP",75,0)
 I $D(^GMR(123,GMRCO,12)),$L($P(^(12),U,5)) D
"RTN","GMRCP",76,0)
 . Q:'$D(^GMR(123,GMRCO,40,DA)) 
"RTN","GMRCP",77,0)
 . D TRIGR^GMRCIEVT(GMRCO,DA)
"RTN","GMRCP",78,0)
 ;
"RTN","GMRCP",79,0)
 K DIE,DA,DR,GMRCDEV,GMRCFF,GMRCPA,X,% Q
"RTN","GMRCP",80,0)
 ;
"RTN","GMRCP",81,0)
STATUS ;Update the status for the Request/Consultation File
"RTN","GMRCP",82,0)
 K GMRCQUT
"RTN","GMRCP",83,0)
 Q:'$D(GMRCSTS)!('$D(GMRCA))
"RTN","GMRCP",84,0)
 S DIE=123,DA=+GMRCO
"RTN","GMRCP",85,0)
 I $D(GMRCDR),$L(GMRCDR) S DR=GMRCDR
"RTN","GMRCP",86,0)
 E  S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCP",87,0)
 L +^GMR(123,GMRCO):2 I '$T S GMRCQUT=1,GMRCERR=1,GMRCERMS="Unable to update status and last action - Consult In Use By Another User." Q
"RTN","GMRCP",88,0)
 D ^DIE
"RTN","GMRCP",89,0)
 L -^GMR(123,+GMRCO)
"RTN","GMRCP",90,0)
 K DIE,DA,DR,GMRCDR
"RTN","GMRCP",91,0)
 Q
"RTN","GMRCP5A")
0^5^B75809712^B74868100
"RTN","GMRCP5A",1,0)
GMRCP5A ;SLC/DCM,RJS,MA - Print Consult form 513 (Gather Data - TIU Results) ;4/18/01  10:29
"RTN","GMRCP5A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,13,12,15,21,22,53**;Dec 27, 1997;Build 3
"RTN","GMRCP5A",3,0)
 ; Patch #21 added PRNTAUDT to this routine.
"RTN","GMRCP5A",4,0)
 ;
"RTN","GMRCP5A",5,0)
PRNT(GMRCIFN,TIUFLG,GMRCQUED,GMRCCPY,GMRCGUI,GMRCAUDT) ;
"RTN","GMRCP5A",6,0)
 ;
"RTN","GMRCP5A",7,0)
 ; Input Arguments:
"RTN","GMRCP5A",8,0)
 ;
"RTN","GMRCP5A",9,0)
 ;  GMRCIFN: IEN of the Consult/Request in file 123
"RTN","GMRCP5A",10,0)
 ;   TIUFLG: Called from TIU ?  1=yes 0=no
"RTN","GMRCP5A",11,0)
 ; GMRCQUED: Queued job ?  1=yes 0=no
"RTN","GMRCP5A",12,0)
 ;  GMRCCPY: Chart Copy ? C=Chart Copy  W=Working Copy  null=Not Applicable
"RTN","GMRCP5A",13,0)
 ;  GMRCGUI: Called from the GUI. (Only produce output in a formatted global.)
"RTN","GMRCP5A",14,0)
 ; GMRCAUDT:  Set to 1 in GMRCUTL1 if NW or DC consult.
"RTN","GMRCP5A",15,0)
 ; ZTIO:      Output device when job is tasked
"RTN","GMRCP5A",16,0)
 ;
"RTN","GMRCP5A",17,0)
 N GMRCSIG,GMRCSDT,GMRCCSIG,GMRCSIGT,GMRCADDS
"RTN","GMRCP5A",18,0)
 I '+$G(IOM) S IOM=80
"RTN","GMRCP5A",19,0)
 ;
"RTN","GMRCP5A",20,0)
 I GMRCGUI D  Q
"RTN","GMRCP5A",21,0)
 . D FORMAT(80)
"RTN","GMRCP5A",22,0)
 . D ASSMBL^GMRCP5C(GMRCGUI,80)
"RTN","GMRCP5A",23,0)
 . F GMRCX="GMRCTIU","RES","MCAR" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5A",24,0)
 . K ^TMP("GMRC",$J,"OUTPUT")
"RTN","GMRCP5A",25,0)
 . Q
"RTN","GMRCP5A",26,0)
 ;
"RTN","GMRCP5A",27,0)
 I 'TIUFLG,'GMRCQUED W @IOF I '$$CRT^GMRCP5C,$L($G(IO(0))),'(IO=IO(0)) U IO(0) W !,"PRINTING... "
"RTN","GMRCP5A",28,0)
 ;
"RTN","GMRCP5A",29,0)
 D FORMAT(IOM),ASSMBL^GMRCP5C(IOSL,IOM)
"RTN","GMRCP5A",30,0)
 U IO
"RTN","GMRCP5A",31,0)
 D PRINT^GMRCP5C(IOSL,IOM)
"RTN","GMRCP5A",32,0)
 ;
"RTN","GMRCP5A",33,0)
 I 'TIUFLG,'$$CRT^GMRCP5C U IO(0) D ^%ZISC
"RTN","GMRCP5A",34,0)
 ;
"RTN","GMRCP5A",35,0)
 I $G(GMRCQUED),$G(ZTSK) D KILL^%ZTLOAD
"RTN","GMRCP5A",36,0)
 ;
"RTN","GMRCP5A",37,0)
 F GMRCX="OUTPUT","SF513" K ^TMP("GMRC",$J,GMRCX)
"RTN","GMRCP5A",38,0)
 F GMRCX="GMRCTIU","RES","MCAR" K ^TMP("GMRCR",$J,GMRCX)
"RTN","GMRCP5A",39,0)
 ; If print device (ZTIO) do PRNTAUDT unless there is no GMRCAUDT
"RTN","GMRCP5A",40,0)
 ; GMRCAUDT=1 means print for NW or DC consult
"RTN","GMRCP5A",41,0)
 I $D(ZTIO),$D(GMRCAUDT) D PRNTAUDT(GMRCIFN,ZTIO,GMRCAUDT)
"RTN","GMRCP5A",42,0)
 Q
"RTN","GMRCP5A",43,0)
 ;
"RTN","GMRCP5A",44,0)
PRNTAUDT(GMRCIFN,ZTIO,GMRCAUDT) ; Update the last activity field in 123 and
"RTN","GMRCP5A",45,0)
 ; Processing Activity multiple
"RTN","GMRCP5A",46,0)
 ; Update the activity log to reflect "Printed To:" and the printer
"RTN","GMRCP5A",47,0)
 ; GMRCAUDT=1 indicates the consult is NW or Discontinued
"RTN","GMRCP5A",48,0)
 ; and it should update the audit trail.
"RTN","GMRCP5A",49,0)
 I $G(GMRCAUDT)'=1 K GMRCAUDT  Q
"RTN","GMRCP5A",50,0)
 N GMRCOM,GMRCORNP,GMRCFF,GMRCPA,GMRCAD,GMRCA,DA,DIE
"RTN","GMRCP5A",51,0)
 S GMRCA=22
"RTN","GMRCP5A",52,0)
 S GMRCO=GMRCIFN,GMRCDEV=ZTIO
"RTN","GMRCP5A",53,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="9////^S X=GMRCA"
"RTN","GMRCP5A",54,0)
 L +^GMR(123,GMRCO):5
"RTN","GMRCP5A",55,0)
 D ^DIE
"RTN","GMRCP5A",56,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCP5A",57,0)
 ;Update activity other than HL7 original msg received
"RTN","GMRCP5A",58,0)
 D AUDIT^GMRCP
"RTN","GMRCP5A",59,0)
 KILL GMRCO,GMRCA,GMRCDEV
"RTN","GMRCP5A",60,0)
 Q
"RTN","GMRCP5A",61,0)
 ;
"RTN","GMRCP5A",62,0)
FORMAT(PAGEWID) ;
"RTN","GMRCP5A",63,0)
 ;
"RTN","GMRCP5A",64,0)
 N %I,CMT,COUNT,D0,DFN,DIC,DIQ2,DR,GLOBAL,GMRC400,GMRCADD,GMRCADDT,GMRCAGE,GMRCCSDT
"RTN","GMRCP5A",65,0)
 N GMRCCTIT,GMRCDFN,GMRCDOB,GMRCDVL,GMRCELIG,GMRCEQL,GMRCERR,GMRCFAC,GMRCFP
"RTN","GMRCP5A",66,0)
 N GMRCFTR,GMRCIPH,GMRCINO,GMRCIRL,GMRCLAST,GMRCMODE,GMRCND,GMRCNDX,GMRCNT,GMRCPG,GMRCPGR,GMRCPNM,GMRCPRNM
"RTN","GMRCP5A",67,0)
 N GMRCPTR,GMRCQSTR,GMRCQSTT,GMRCR0,GMRCR1,GMRCR2,GMRCRB,GMRCRD,GMRCRPT,GMRCSG,GMRCSGAD,GMRCSIGM
"RTN","GMRCP5A",68,0)
 N GMRCSN,GMRCSR,GMRCSVC,GMRCTO,GMRCUL,GMRCWARD,GMRCWLI,GMRCX,LN,MCFILE,MCPROC
"RTN","GMRCP5A",69,0)
 N ND,ND1,ND2,NDS,ORACTION,SEX,TAB,X,Y
"RTN","GMRCP5A",70,0)
 ;
"RTN","GMRCP5A",71,0)
 S GMRCFTR=13,GMRCFP=0,GMRCPG=0
"RTN","GMRCP5A",72,0)
 S GMRCRD=$G(^GMR(123,GMRCIFN,0)),(DFN,GMRCDFN)=$P(GMRCRD,U,2)
"RTN","GMRCP5A",73,0)
 Q:'(DFN)
"RTN","GMRCP5A",74,0)
 D ELIG^VADPT S GMRCELIG=$P(VAEL(6),U,2) K VAEL
"RTN","GMRCP5A",75,0)
 S GMRCDVL="",$P(GMRCDVL,"-",PAGEWID+1)=""
"RTN","GMRCP5A",76,0)
 S GMRCEQL="",$P(GMRCEQL,"=",PAGEWID+1)=""
"RTN","GMRCP5A",77,0)
 S GMRCUL="",$P(GMRCUL,"_",40)=""
"RTN","GMRCP5A",78,0)
 S DFN=GMRCDFN D DEM^GMRCU
"RTN","GMRCP5A",79,0)
 ;
"RTN","GMRCP5A",80,0)
 S GMRCFAC=+$P(GMRCRD,U,21)
"RTN","GMRCP5A",81,0)
 I 'GMRCFAC S GMRCFAC=+$G(DUZ(2))
"RTN","GMRCP5A",82,0)
 I 'GMRCFAC S GMRCFAC=+$$SITE^VASITE()
"RTN","GMRCP5A",83,0)
 I +GMRCFAC S GMRCFAC=$$GET1^DIQ(4,+GMRCFAC,.01)
"RTN","GMRCP5A",84,0)
 E  S GMRCFAC="" Q
"RTN","GMRCP5A",85,0)
 ;
"RTN","GMRCP5A",86,0)
 ; get inter-facility consult info
"RTN","GMRCP5A",87,0)
 I $P(GMRCRD,U,23) D
"RTN","GMRCP5A",88,0)
 .S GMRCINO=$P(GMRCRD,U,22)
"RTN","GMRCP5A",89,0)
 .S GMRCRD(12)=$G(^GMR(123,GMRCIFN,12))
"RTN","GMRCP5A",90,0)
 .S GMRCRD(13)=$G(^GMR(123,GMRCIFN,13))
"RTN","GMRCP5A",91,0)
 .S GMRCIRL=$S($P(GMRCRD(12),U,5)="P":"Requesting facility",$P(GMRCRD(12),U,5)="F":"Consulting facility",1:"")
"RTN","GMRCP5A",92,0)
 ;Commented out following line to allow TIU doc to print based on ASU
"RTN","GMRCP5A",93,0)
 ;rules.
"RTN","GMRCP5A",94,0)
 ;I $P(GMRCRD,U,12)=2!(TIUFLG) D
"RTN","GMRCP5A",95,0)
 D PRINT^GMRCTIUP(GMRCIFN,0,0) ;Removed dot structure
"RTN","GMRCP5A",96,0)
 ;
"RTN","GMRCP5A",97,0)
 K GMRCSG I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",98,0)
 .;
"RTN","GMRCP5A",99,0)
 .S GMRCR0=0 F  Q:$D(GMRCSG)  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",100,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",101,0)
 ..Q:'$L($G(GMRCSIG))
"RTN","GMRCP5A",102,0)
 ..F GMRCV="GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT" S GMRCSG(GMRCV)=@GMRCV
"RTN","GMRCP5A",103,0)
 ;
"RTN","GMRCP5A",104,0)
 D INIT^GMRCP5B(.GMRCSG) ; Build Header, Footer, Request, and Primary Diagnosis Segments
"RTN","GMRCP5A",105,0)
 ;
"RTN","GMRCP5A",106,0)
 I $L($G(GMRCCPY)) D
"RTN","GMRCP5A",107,0)
 .D BLD("RES",1,1,0,$$CENTER($S(GMRCCPY="C":"C H A R T   C O P Y",1:"W O R K I N G   C O P Y")))
"RTN","GMRCP5A",108,0)
 I ($P(GMRCRD,U,19)="Y") D
"RTN","GMRCP5A",109,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Significant Findings *******"))
"RTN","GMRCP5A",110,0)
 I ($P(GMRCRD,U,19)="N") D
"RTN","GMRCP5A",111,0)
 .D BLD("RES",1,1,0,$$CENTER("******* No Significant Findings *******"))
"RTN","GMRCP5A",112,0)
 I ($P(GMRCRD,U,19)="U") D
"RTN","GMRCP5A",113,0)
 .D BLD("RES",1,1,0,$$CENTER("******* Unknown Significant Findings *******"))
"RTN","GMRCP5A",114,0)
 ;
"RTN","GMRCP5A",115,0)
 I $P(GMRCRD,U,12)=1  D 
"RTN","GMRCP5A",116,0)
 . D BLD("RES",1,2,0,$$CENTER("**** REQUEST CANCELLED    REQUEST CANCELLED ****"))
"RTN","GMRCP5A",117,0)
 I '$D(^TMP("GMRCR",$J,"RES")),'$D(^("MCAR")) D
"RTN","GMRCP5A",118,0)
 .I $L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results for "_GMRCRPT_" available."))
"RTN","GMRCP5A",119,0)
 .I '$L($G(GMRCRPT)) D BLD("RES",1,2,0,$$CENTER(" No Consultation Results available."))
"RTN","GMRCP5A",120,0)
 ;
"RTN","GMRCP5A",121,0)
 I $D(^TMP("GMRCR",$J,"RES")) D
"RTN","GMRCP5A",122,0)
 .;
"RTN","GMRCP5A",123,0)
 .S (GMRCNT,GMRCR0)=0 F  S GMRCR0=$O(^TMP("GMRCR",$J,"RES",GMRCR0)) Q:'GMRCR0  D
"RTN","GMRCP5A",124,0)
 ..N GMRCCSDT,GMRCCSGM,GMRCCSIG,GMRCCTIT,GMRCRPT,GMRCSDT
"RTN","GMRCP5A",125,0)
 ..N GMRCSIG,GMRCSIGM,GMRCSIGT,GMRCV,GMRCENT,GMRCVIS,GMRCVLOC,GMRCNODT
"RTN","GMRCP5A",126,0)
 ..;
"RTN","GMRCP5A",127,0)
 ..F GMRCV="GMRCCSDT","GMRCCSGM","GMRCCSIG","GMRCCTIT","GMRCRPT","GMRCSDT","GMRCSIG","GMRCSIGM","GMRCSIGT","GMRCVIS","GMRCENT","GMRCVLOC","GMRCNODT" D
"RTN","GMRCP5A",128,0)
 ...S @GMRCV=$G(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCV))
"RTN","GMRCP5A",129,0)
 ..;
"RTN","GMRCP5A",130,0)
 ..S GMRCNDX=$O(^TMP("GMRC",$J,"OUTPUT","RES"," "),-1)+1
"RTN","GMRCP5A",131,0)
 ..I $L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results "_$S(GMRCR0=.5:"",1:"#"_GMRCR0_" ")_"for "_GMRCRPT_" continued.")
"RTN","GMRCP5A",132,0)
 ..I '$L($G(GMRCRPT)) D SUB("H","RES",GMRCNDX,"Consultation Results "_$S(GMRCR0=.5:"",1:"#"_GMRCR0_" ")_"continued.")
"RTN","GMRCP5A",133,0)
 ..D SUB("H","RES",GMRCNDX," ")
"RTN","GMRCP5A",134,0)
 ..I $L($G(GMRCSIG)) D
"RTN","GMRCP5A",135,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",136,0)
 ...I (GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /es/ "_$$EXDT($G(GMRCSDT))
"RTN","GMRCP5A",137,0)
 ...I '(GMRCSIGM="electronic") S GMRCX=" Results Signature: "_GMRCSIG_" /chart/ " S:$L($G(GMRCSDT)) GMRCX=GMRCX_$$EXDT(GMRCSDT)
"RTN","GMRCP5A",138,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",139,0)
 ...D:$L($G(GMRCSIGT)) SUB("F","RES",GMRCNDX,"                    "_GMRCSIGT)
"RTN","GMRCP5A",140,0)
 ..I $L($G(GMRCCSIG)) D
"RTN","GMRCP5A",141,0)
 ...D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",142,0)
 ...I (GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /es/ "_$$EXDT($G(GMRCCSDT))
"RTN","GMRCP5A",143,0)
 ...I '(GMRCCSGM="electronic") S GMRCX=" Results CoSignature: "_GMRCCSIG_" /chart/ " S:$L($G(GMRCCSDT)) GMRCX=GMRCX_$$EXDT(GMRCCSDT)
"RTN","GMRCP5A",144,0)
 ...D SUB("F","RES",GMRCNDX,GMRCX)
"RTN","GMRCP5A",145,0)
 ...D:$L($G(GMRCCTIT)) SUB("F","RES",GMRCNDX,"                      "_GMRCCTIT)
"RTN","GMRCP5A",146,0)
 ..;extra signers
"RTN","GMRCP5A",147,0)
 .. I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA")) D
"RTN","GMRCP5A",148,0)
 ... D SUB("F","RES",GMRCNDX," ")
"RTN","GMRCP5A",149,0)
 ... D SUB("F","RES",GMRCNDX," Receipt acknowledged by: ")
"RTN","GMRCP5A",150,0)
 ... N XTRA S XTRA=0 F  S XTRA=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA)) Q:'XTRA  D
"RTN","GMRCP5A",151,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,0))
"RTN","GMRCP5A",152,0)
 .... D SUB("F","RES",GMRCNDX,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","GMRCXTRA",XTRA,1))
"RTN","GMRCP5A",153,0)
 ..;
"RTN","GMRCP5A",154,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",155,0)
 ..I $L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE "_$S(GMRCR0=.5:"",1:"#"_GMRCR0_" ")_"FOR "_GMRCRPT))
"RTN","GMRCP5A",156,0)
 ..I '$L($G(GMRCRPT)) D BLD("RES",GMRCNDX,1,0,$$CENTER("CONSULTATION NOTE "_$S(GMRCR0=.5:"",1:"#"_GMRCR0)))
"RTN","GMRCP5A",157,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",158,0)
 ..I $L($G(GMRCENT)) D
"RTN","GMRCP5A",159,0)
 ...S GMRCX="         Entry Date: "_$$EXDT($G(GMRCENT))
"RTN","GMRCP5A",160,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",161,0)
 ..I $L($G(GMRCNODT)) D
"RTN","GMRCP5A",162,0)
 ...Q:$$EXDT($G(GMRCNODT))=$$EXDT($G(GMRCENT)) 
"RTN","GMRCP5A",163,0)
 ...S GMRCX="Date/Time of result: "_$$EXDT($G(GMRCNODT))
"RTN","GMRCP5A",164,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",165,0)
 ..I $L($G(GMRCVIS)) D
"RTN","GMRCP5A",166,0)
 ...S GMRCX="              Visit: "_$$EXDT($G(GMRCVIS))
"RTN","GMRCP5A",167,0)
 ...I $L($G(GMRCVLOC)) S GMRCX=GMRCX_"   "_GMRCVLOC
"RTN","GMRCP5A",168,0)
 ...D BLD("RES",GMRCNDX,1,0,GMRCX)
"RTN","GMRCP5A",169,0)
 ..I $L($G(GMRCVLOC)) S GMRCX=GMRCVLOC
"RTN","GMRCP5A",170,0)
 ..D BLD("RES",GMRCNDX,1,0," ")
"RTN","GMRCP5A",171,0)
 ..I $D(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0)) D  I 1
"RTN","GMRCP5A",172,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",0,0))
"RTN","GMRCP5A",173,0)
 ..E  I '$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT","")) D
"RTN","GMRCP5A",174,0)
 ...D BLD("RES",1,1,0,$$CENTER("CONSULTATION NOTE TEXT NOT AVAILABLE"))
"RTN","GMRCP5A",175,0)
 ..S GMRCR1=0 F  S GMRCR1=$O(^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1)) Q:'GMRCR1  D
"RTN","GMRCP5A",176,0)
 ...D BLD("RES",GMRCNDX,1,0,^TMP("GMRCR",$J,"RES",GMRCR0,"TEXT",GMRCR1,0))
"RTN","GMRCP5A",177,0)
 ..;
"RTN","GMRCP5A",178,0)
 ..;  GET ADDENDUMS TO THIS NOTE
"RTN","GMRCP5A",179,0)
 ..;
"RTN","GMRCP5A",180,0)
 ..I +$O(^TMP("GMRCR",$J,"RES",GMRCR0,"ADD",0)) D ADDEND^GMRCP5D(GMRCIFN,GMRCR0,GMRCNDX,GMRCRD,PAGEWID)
"RTN","GMRCP5A",181,0)
 ;
"RTN","GMRCP5A",182,0)
 D FORMAT^GMRCP5D(GMRCIFN,GMRCRD,PAGEWID) ;  GET SERVICE REPORTS AND COMMENTS
"RTN","GMRCP5A",183,0)
 ;
"RTN","GMRCP5A",184,0)
 Q
"RTN","GMRCP5A",185,0)
 ;
"RTN","GMRCP5A",186,0)
EXDT(X) ;EXTERNAL DATE FORMAT
"RTN","GMRCP5A",187,0)
 ;
"RTN","GMRCP5A",188,0)
 N DATE,TIME,HR,MN,PD,Y,%DT
"RTN","GMRCP5A",189,0)
 Q:'$L(X) ""
"RTN","GMRCP5A",190,0)
 I '(X?7N.1".".6N) S %DT="PTS" D ^%DT S X=Y
"RTN","GMRCP5A",191,0)
 Q $$FMTE^XLFDT(X,"5PMZ")
"RTN","GMRCP5A",192,0)
 ;
"RTN","GMRCP5A",193,0)
CENTER(X) ;
"RTN","GMRCP5A",194,0)
 ;
"RTN","GMRCP5A",195,0)
 N TEXT,COL
"RTN","GMRCP5A",196,0)
 S COL=35-($L(X)\2) Q:(COL<1) X
"RTN","GMRCP5A",197,0)
 S $E(TEXT,COL)=X
"RTN","GMRCP5A",198,0)
 Q TEXT
"RTN","GMRCP5A",199,0)
 ;
"RTN","GMRCP5A",200,0)
BLD(SUB,NDX,LINE,TAB,TEXT,RUNTIME) ;
"RTN","GMRCP5A",201,0)
 ;
"RTN","GMRCP5A",202,0)
 Q:'$L($G(SUB))
"RTN","GMRCP5A",203,0)
 N LINECNT
"RTN","GMRCP5A",204,0)
 ;
"RTN","GMRCP5A",205,0)
 F LINECNT=1:1:+LINE S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX)+1,0)=""
"RTN","GMRCP5A",206,0)
 ;
"RTN","GMRCP5A",207,0)
 S $E(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),0),TAB+1)=TEXT
"RTN","GMRCP5A",208,0)
 I $L($G(RUNTIME)) S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,$$LASTLN(SUB,NDX),1)=RUNTIME
"RTN","GMRCP5A",209,0)
 ;
"RTN","GMRCP5A",210,0)
 S GMRCLAST=SUB
"RTN","GMRCP5A",211,0)
 Q
"RTN","GMRCP5A",212,0)
 ;
"RTN","GMRCP5A",213,0)
SUB(ZONE,SUB,NDX,TEXT) ;
"RTN","GMRCP5A",214,0)
 ;
"RTN","GMRCP5A",215,0)
 N NEXT
"RTN","GMRCP5A",216,0)
 S NEXT=$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE," "),-1)+1
"RTN","GMRCP5A",217,0)
 S ^TMP("GMRC",$J,"OUTPUT",SUB,NDX,ZONE,NEXT,0)=TEXT
"RTN","GMRCP5A",218,0)
 Q
"RTN","GMRCP5A",219,0)
 ;
"RTN","GMRCP5A",220,0)
LASTLN(SUB,NDX) ;
"RTN","GMRCP5A",221,0)
 Q +$O(^TMP("GMRC",$J,"OUTPUT",SUB,NDX," "),-1)
"RTN","GMRCP5A",222,0)
 ;
"RTN","GMRCSRVS")
0^6^B67385586^B43864564
"RTN","GMRCSRVS",1,0)
GMRCSRVS ;SLC/DCM,JFR - Add/Edit services in File 123.5. ;6/14/00 12:00
"RTN","GMRCSRVS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,16,40,53**;DEC 27, 1997;Build 3
"RTN","GMRCSRVS",3,0)
 ;
"RTN","GMRCSRVS",4,0)
EN ;set up services entry point
"RTN","GMRCSRVS",5,0)
 ;GMRCOLDU=Service Usage field. If changed, GMRCOLDU shows the change (See ^DD(123.5,2,0) for field description).
"RTN","GMRCSRVS",6,0)
 N GMRCSAFE,GMRCOLDU,GMRCOLDS,GMRCOSNM,GMRCSRVC,GMRCACT,GMRCSSNM
"RTN","GMRCSRVS",7,0)
 N DIC,DLAYGO,DUOUT,DTOUT
"RTN","GMRCSRVS",8,0)
 S DIC="^GMR(123.5,",DLAYGO=123.5,DIC(0)="AELMQZ",DIC("A")="Select Service/Specialty:"
"RTN","GMRCSRVS",9,0)
 D ^DIC I $S(Y<0:1,$D(DTOUT):1,$D(DUOUT):1,1:0) D END K GMRCMSG,DTOUT,DUOUT Q
"RTN","GMRCSRVS",10,0)
 D
"RTN","GMRCSRVS",11,0)
 .S GMRCSAFE=+$G(^GMR(123.5,+Y,"INT"))
"RTN","GMRCSRVS",12,0)
 .S (DA,GMRCSRVC)=+Y,GMRCOSNM=$P(Y,"^",2),(GMRCOLDU,GMRCOLDS)=""
"RTN","GMRCSRVS",13,0)
 .S GMRCACT=$S('$O(^GMR(123.5,+Y,0)):"MAD",1:"MUP"),GMRCOLDU=$P(^(0),"^",2),GMRCOLDN=$P(^(0),"^",1) S ND=0,GMRCOLDS="" F  S ND=$O(^GMR(123.5,+Y,2,ND)) Q:ND?1A.E!(ND="")  S GMRCOLDS=GMRCOLDS_^GMR(123.5,+Y,2,ND,0)_"^"
"RTN","GMRCSRVS",14,0)
 .S DIE=DIC,DR="[GMRC SETUP REQUEST SERVICE]",DIE("NO^")="OUTOK"
"RTN","GMRCSRVS",15,0)
 .D ^DIE
"RTN","GMRCSRVS",16,0)
 .Q
"RTN","GMRCSRVS",17,0)
 S GMRCACT=$S($P(^GMR(123.5,GMRCSRVC,0),"^",2)=9:"MDC",$P(^(0),"^",2)=1:"MDC",1:GMRCACT) D
"RTN","GMRCSRVS",18,0)
 .S GMRCSSNM=$P(^GMR(123.5,GMRCSRVC,0),"^",1)
"RTN","GMRCSRVS",19,0)
 .I GMRCACT'="MAD",GMRCSSNM'=GMRCOSNM S GMRCACT="MUP"
"RTN","GMRCSRVS",20,0)
 .I $S(GMRCACT'="MAD":1,GMRCACT'="MUP":1,1:0),$L(GMRCOLDU),GMRCOLDU=$P(^GMR(123.5,GMRCSRVC,0),"^",2) S GMRCACT="NOACT"
"RTN","GMRCSRVS",21,0)
 .I $S(GMRCACT="MUP":1,GMRCACT="NOACT":1,1:0),GMRCOLDN'=$P(^GMR(123.5,GMRCSRVC,0),"^",1) S GMRCACT="MUP"
"RTN","GMRCSRVS",22,0)
 .S ND=0 F  S ND=$O(^GMR(123.5,GMRCSRVC,2,ND)) Q:ND?1A.E!(ND="")  I GMRCOLDS'=""&(^GMR(123.5,GMRCSRVC,2,ND,0)'=""),GMRCOLDS'[^GMR(123.5,GMRCSRVC,2,ND,0) S GMRCACT="MUP" Q
"RTN","GMRCSRVS",23,0)
 .I $S(GMRCACT="MAD":1,GMRCACT="MUP":1,GMRCACT="MDC":1,1:0) D SVC^GMRC101H(GMRCSRVC,GMRCSSNM,GMRCACT),MSG^XQOR("GMRC ORDERABLE ITEM UPDATE",.GMRCMSG)
"RTN","GMRCSRVS",24,0)
 .D PTRCLN^GMRCU
"RTN","GMRCSRVS",25,0)
 .Q
"RTN","GMRCSRVS",26,0)
 K GMRCMSG,GMRCSSNM,GMRCSRVS,GMRCOLDN,GMRCOLDS,GMRCOLDU,ND
"RTN","GMRCSRVS",27,0)
 ;Ask to continue...
"RTN","GMRCSRVS",28,0)
 ;
"RTN","GMRCSRVS",29,0)
 N GMRC0,GMRCA,GMRCB,GMRCH,GMRCL
"RTN","GMRCSRVS",30,0)
 S GMRC0="YA",GMRCA="Add/Edit Another Service? ",GMRCB="NO"
"RTN","GMRCSRVS",31,0)
 S GMRCH="Enter 'YES' to add/edit another service, or 'NO' to exit."
"RTN","GMRCSRVS",32,0)
 S GMRCL=2
"RTN","GMRCSRVS",33,0)
 I '+$$READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) D END Q
"RTN","GMRCSRVS",34,0)
 G EN
"RTN","GMRCSRVS",35,0)
 ;
"RTN","GMRCSRVS",36,0)
END K DIC,DIE,DTOUT,DUOUT,DA,DR,FL,GMRCACT,GMRCANS,GMRCMSG,GMRCREA,GMRCSRVC,GMRCSSNM,REVCODE,RLEVCODE,Y
"RTN","GMRCSRVS",37,0)
 Q
"RTN","GMRCSRVS",38,0)
 ;
"RTN","GMRCSRVS",39,0)
READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL,GMRCS) ;
"RTN","GMRCSRVS",40,0)
 ;
"RTN","GMRCSRVS",41,0)
 ;  GMRC0 -> DIR(0) --- Type of read
"RTN","GMRCSRVS",42,0)
 ;  GMRCA -> DIR("A") - Prompt
"RTN","GMRCSRVS",43,0)
 ;  GMRCB -> DIR("B") - Default Answer
"RTN","GMRCSRVS",44,0)
 ;  GMRCH -> DIR("?") - Help text or ^Execute code
"RTN","GMRCSRVS",45,0)
 ;  GMRCS -> DIR("S") - Screen
"RTN","GMRCSRVS",46,0)
 ;  GMRCL -> Number of blank lines to put before Prompt
"RTN","GMRCSRVS",47,0)
 ;
"RTN","GMRCSRVS",48,0)
 ;  Returns "^" or answer
"RTN","GMRCSRVS",49,0)
 ;
"RTN","GMRCSRVS",50,0)
 N GMRCLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","GMRCSRVS",51,0)
 Q:'$L($G(GMRC0)) U
"RTN","GMRCSRVS",52,0)
 S DIR(0)=GMRC0
"RTN","GMRCSRVS",53,0)
 S:$L($G(GMRCA)) DIR("A")=GMRCA
"RTN","GMRCSRVS",54,0)
 I $D(GMRCA("A")) M DIR("A")=GMRCA("A")
"RTN","GMRCSRVS",55,0)
 S:$L($G(GMRCB)) DIR("B")=GMRCB
"RTN","GMRCSRVS",56,0)
 I $D(GMRCH("?")) M DIR("?")=GMRCH("?")
"RTN","GMRCSRVS",57,0)
 S:$L($G(GMRCH)) DIR("?")=GMRCH
"RTN","GMRCSRVS",58,0)
 S:$L($G(GMRCS)) DIR("S")=GMRCS
"RTN","GMRCSRVS",59,0)
 F GMRCLINE=1:1:($G(GMRCL)-1) W !
"RTN","GMRCSRVS",60,0)
 D ^DIR
"RTN","GMRCSRVS",61,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","GMRCSRVS",62,0)
 Q Y
"RTN","GMRCSRVS",63,0)
 ;
"RTN","GMRCSRVS",64,0)
NOED(SERV) ;
"RTN","GMRCSRVS",65,0)
 I '$D(^GMR(123.5,+SERV,0)) Q 0
"RTN","GMRCSRVS",66,0)
 N NAME
"RTN","GMRCSRVS",67,0)
 S NAME=$P(^GMR(123.5,+SERV,0),U)
"RTN","GMRCSRVS",68,0)
 I NAME="PROSTHETICS REQUEST" Q 1
"RTN","GMRCSRVS",69,0)
 I NAME="EYEGLASS REQUEST" Q 1
"RTN","GMRCSRVS",70,0)
 I NAME="CONTACT LENS REQUEST" Q 1
"RTN","GMRCSRVS",71,0)
 I NAME="HOME OXYGEN REQUEST" Q 1
"RTN","GMRCSRVS",72,0)
 Q 0
"RTN","GMRCSRVS",73,0)
 ;
"RTN","GMRCSRVS",74,0)
CLONPSAS ; clone a PROSTHETICS service
"RTN","GMRCSRVS",75,0)
 ; choose service and text to append
"RTN","GMRCSRVS",76,0)
 N GMRCSIEN,GMRCROOT,GMRCNWNM
"RTN","GMRCSRVS",77,0)
 N GMRCCPY,GMRCNEW,FDA,GMRCERR,GMRC
"RTN","GMRCSRVS",78,0)
 S GMRC(0)="PAO^GMR(123.5,:AEMQ"
"RTN","GMRCSRVS",79,0)
 S GMRC("A")="Select the Prosthetics Service to clone: "
"RTN","GMRCSRVS",80,0)
 S GMRC("S")="I $$NOED^GMRCSRVS(+Y)"
"RTN","GMRCSRVS",81,0)
 S GMRCCPY=+$$READ(GMRC(0),GMRC("A"),,,2,GMRC("S"))
"RTN","GMRCSRVS",82,0)
 I 'GMRCCPY Q
"RTN","GMRCSRVS",83,0)
 K GMRC
"RTN","GMRCSRVS",84,0)
 S GMRCNWNM=$$GETAPP(GMRCCPY)
"RTN","GMRCSRVS",85,0)
 I '$L(GMRCNWNM) Q
"RTN","GMRCSRVS",86,0)
 S FDA(1,123.5,"+1,",.01)=GMRCNWNM
"RTN","GMRCSRVS",87,0)
 S FDA(1,123.5,"+1,",2)="DISABLED"
"RTN","GMRCSRVS",88,0)
 S FDA(1,123.5,"+1,",1.01)="REQUIRE"
"RTN","GMRCSRVS",89,0)
 S FDA(1,123.5,"+1,",1.02)="LEXICON"
"RTN","GMRCSRVS",90,0)
 S FDA(1,123.5,"+1,",123.01)="CONSULTS"
"RTN","GMRCSRVS",91,0)
 S FDA(1,123.5,"+1,",123.03)="GMRCACTM SERVICE ACTION MENU"
"RTN","GMRCSRVS",92,0)
 S FDA(1,123.5,"+1,",131)="YES"
"RTN","GMRCSRVS",93,0)
 D UPDATE^DIE("E","FDA(1)","GMRCNEW","GMRCERR")
"RTN","GMRCSRVS",94,0)
 I '$D(GMRCNEW) W !,"Failed to create new entry. Please try again" Q
"RTN","GMRCSRVS",95,0)
 W !!,GMRCNWNM," created",!
"RTN","GMRCSRVS",96,0)
 S GMRCSIEN=GMRCNEW(1)_","
"RTN","GMRCSRVS",97,0)
 S GMRCROOT="^GMR(123.5,"_GMRCCPY_",124)"
"RTN","GMRCSRVS",98,0)
 D WP^DIE(123.5,GMRCSIEN,124,,GMRCROOT,"GMRCERR")
"RTN","GMRCSRVS",99,0)
 W !!,"The new Service is currently DISABLED. To activate this service for use in"
"RTN","GMRCSRVS",100,0)
 W !,"the Prosthetics interface, you MUST use the Setup Consult Services option"
"RTN","GMRCSRVS",101,0)
 W !,"and delete the DISABLED flag from the SERVICE USAGE field.",!
"RTN","GMRCSRVS",102,0)
 Q
"RTN","GMRCSRVS",103,0)
GETAPP(GMRIEN) ;get text to append
"RTN","GMRCSRVS",104,0)
 N GMRCNWNM,QTFLG,I,GMRC,GMRCHL,OK
"RTN","GMRCSRVS",105,0)
 S GMRCNWNM=""
"RTN","GMRCSRVS",106,0)
 F I=0:0 D  Q:$G(QTFLG)
"RTN","GMRCSRVS",107,0)
 . W !!
"RTN","GMRCSRVS",108,0)
 . S GMRC(0)="FA^3:40"
"RTN","GMRCSRVS",109,0)
 . S GMRC("A")="Enter text to append to national service name: "
"RTN","GMRCSRVS",110,0)
 . S GMRCHL("?",1)="The text entered will be appended to the name of the exported service"
"RTN","GMRCSRVS",111,0)
 . S GMRCHL("?")="(e.g. If HINES was entered it may appear as PROSTHETICS REQUEST - HINES"
"RTN","GMRCSRVS",112,0)
 . S GMRCNWNM=$$READ(GMRC(0),GMRC("A"),,.GMRCHL,2)
"RTN","GMRCSRVS",113,0)
 . I '$L(GMRCNWNM)!(GMRCNWNM["^") S GMRCNWNM="",QTFLG=1 Q
"RTN","GMRCSRVS",114,0)
 . K GMRC,GMRCHL
"RTN","GMRCSRVS",115,0)
 . S GMRCNWNM=$P(^GMR(123.5,GMRIEN,0),U)_" - "_GMRCNWNM
"RTN","GMRCSRVS",116,0)
 . I $$FIND1^DIC(123.5,,"X",GMRCNWNM) D  Q
"RTN","GMRCSRVS",117,0)
 .. W !!,$C(7),"This service already exists, you'll have to try again!",!
"RTN","GMRCSRVS",118,0)
 .. S GMRCNWNM=""
"RTN","GMRCSRVS",119,0)
 . W !,"The new service name will be:"
"RTN","GMRCSRVS",120,0)
 . W !,?5,GMRCNWNM,!
"RTN","GMRCSRVS",121,0)
 . S OK=+$$READ("Y","Is this OK",,,1)
"RTN","GMRCSRVS",122,0)
 . I OK=U S QTFLG=1 Q
"RTN","GMRCSRVS",123,0)
 . I 'OK S GMRCNWNM="" Q
"RTN","GMRCSRVS",124,0)
 . S QTFLG=1
"RTN","GMRCSRVS",125,0)
 Q GMRCNWNM
"RTN","GMRCSRVS",126,0)
INPUT(X,GMRCDA) ; INPUT TRANSFORM FOR THE SUB-SERVICE/SPECIALTY (#.01) FIELD
"RTN","GMRCSRVS",127,0)
 ; OF THE SUB-SERVICE (#123.51) FILE WHICH IS A SUB-FILE OF THE
"RTN","GMRCSRVS",128,0)
 ; SUB-SERVICE (#10) FIELD OF THE REQUEST SERVICES (#123.5) FILE.
"RTN","GMRCSRVS",129,0)
 ;
"RTN","GMRCSRVS",130,0)
 ; X = INTERNAL VALUE OF USER SELECTED SUB-SERVICE (IEN OF SERVICE
"RTN","GMRCSRVS",131,0)
 ;     IN FILE 123.5)
"RTN","GMRCSRVS",132,0)
 ; GMRCDA = IEN OF INITIAL PARENT SERVICE IN FILE 123.5
"RTN","GMRCSRVS",133,0)
 ;
"RTN","GMRCSRVS",134,0)
 I +$G(X)=0 K X Q
"RTN","GMRCSRVS",135,0)
 I GMRCDA<1 D  Q:'$D(X)
"RTN","GMRCSRVS",136,0)
 . S GMRCDA=+$G(D0)
"RTN","GMRCSRVS",137,0)
 . I GMRCDA<1 K X
"RTN","GMRCSRVS",138,0)
 N GMRPARNT,GMRCHILD,GMRQ,GMRCNT
"RTN","GMRCSRVS",139,0)
 K ^TMP("GMRC INPUT",$J) ;MAKE SURE INPUT PARENT LOG GLOBAL IS BLANK
"RTN","GMRCSRVS",140,0)
 I X=GMRCDA S GMRQ=1 G INPUTQ ;NOT ALLOW SERVICE AS A SUB-SERVICE TO ITSELF
"RTN","GMRCSRVS",141,0)
 S ^TMP("GMRC INPUT",$J,"B",GMRCDA)="" ;USED TO PREVENT DUPLICATE CHECKING OF PARENTS
"RTN","GMRCSRVS",142,0)
 S ^TMP("GMRC INPUT",$J,0)=1 ;USED TO FIND NEXT NUMBER FOR TMP GLOBAL ENTRY
"RTN","GMRCSRVS",143,0)
 S ^TMP("GMRC INPUT",$J,1)=GMRCDA ;PARENT IEN STORED TO BE USED AS CHILD
"RTN","GMRCSRVS",144,0)
 S (GMRCNT,GMRQ)=0
"RTN","GMRCSRVS",145,0)
 F  S GMRCNT=$O(^TMP("GMRC INPUT",$J,GMRCNT)) Q:'GMRCNT  D  Q:GMRQ=1
"RTN","GMRCSRVS",146,0)
 . S GMRCHILD=$G(^TMP("GMRC INPUT",$J,GMRCNT))
"RTN","GMRCSRVS",147,0)
 . S GMRPARNT=0
"RTN","GMRCSRVS",148,0)
 . F  S GMRPARNT=$O(^GMR(123.5,"APC",GMRCHILD,GMRPARNT)) Q:GMRPARNT=""  D  Q:GMRQ=1
"RTN","GMRCSRVS",149,0)
 .. I GMRPARNT=X S GMRQ=1 Q  ;NOT ALLOW SERVICE AS A SUB-SERVICE WITHIN IT'S SUB-SERVICE HIERARCHY
"RTN","GMRCSRVS",150,0)
 .. I '$D(^TMP("GMRC INPUT",$J,"B",GMRPARNT)) D  ;IF NOT IN LIST ADD
"RTN","GMRCSRVS",151,0)
 ... S ^TMP("GMRC INPUT",$J,"B",GMRPARNT)="" ;ADD TO "B" CROSS-REFERENCE
"RTN","GMRCSRVS",152,0)
 ... S ^TMP("GMRC INPUT",$J,0)=$G(^TMP("GMRC INPUT",$J,0))+1 ;INCREASE LAST NUMBER BY 1
"RTN","GMRCSRVS",153,0)
 ... S ^TMP("GMRC INPUT",$J,$G(^TMP("GMRC INPUT",$J,0)))=GMRPARNT ;ADD NEW PARENT SERVICE TO GLOBAL SO IT CAN BE CHECKED AS A CHILD ENTRY TO FIND IT'S PARENTS
"RTN","GMRCSRVS",154,0)
 K ^TMP("GMRC INPUT",$J)
"RTN","GMRCSRVS",155,0)
INPUTQ I GMRQ=1 D EN^DDIOL("A SERVICE CAN NOT BE A SUB-SERVICE OF ITSELF","","!!?12") K X Q
"RTN","GMRCSRVS",156,0)
 ;
"RTN","GMRCSRVS",157,0)
DUPCHK ;CHECK FOR CONSULT SERVICES APPEARING AS PART OF THE CONSULT SERVICE
"RTN","GMRCSRVS",158,0)
 ;HIERARCHY IN MORE THAN ONE PLACE
"RTN","GMRCSRVS",159,0)
 N ARRAY,COUNT,GMRCON,PARENT
"RTN","GMRCSRVS",160,0)
 S PARENT=0
"RTN","GMRCSRVS",161,0)
 ;Check if they are a sub-service to more than one service.
"RTN","GMRCSRVS",162,0)
 F COUNT=0:1 S PARENT=$O(^GMR(123.5,"APC",X,PARENT)) Q:'+PARENT
"RTN","GMRCSRVS",163,0)
 ;Print message about which services this service is a sub-service of.
"RTN","GMRCSRVS",164,0)
 I COUNT'>0 Q
"RTN","GMRCSRVS",165,0)
 S COUNT=1
"RTN","GMRCSRVS",166,0)
 S ARRAY(COUNT)=" ",COUNT=COUNT+1
"RTN","GMRCSRVS",167,0)
 S ARRAY(COUNT)=" ",COUNT=COUNT+1
"RTN","GMRCSRVS",168,0)
 S ARRAY="Service "_$P(^GMR(123.5,X,0),"^",1)_" is already a sub-service of:"
"RTN","GMRCSRVS",169,0)
 D PARSE(.ARRAY)
"RTN","GMRCSRVS",170,0)
 S PARENT=0
"RTN","GMRCSRVS",171,0)
 F  S PARENT=$O(^GMR(123.5,"APC",X,PARENT)) Q:'+PARENT  S ARRAY="   "_$P(^GMR(123.5,PARENT,0),"^",1) D PARSE(.ARRAY)
"RTN","GMRCSRVS",172,0)
 S ARRAY(COUNT)=" ",COUNT=COUNT+1
"RTN","GMRCSRVS",173,0)
 S ARRAY(COUNT)="A consult service appearing as part of the Consult service",COUNT=COUNT+1
"RTN","GMRCSRVS",174,0)
 S ARRAY(COUNT)="hierarchy in more than one place (i.e. a sub-service of more",COUNT=COUNT+1
"RTN","GMRCSRVS",175,0)
 S ARRAY(COUNT)="than one parent) has the potential to skew the results of the",COUNT=COUNT+1
"RTN","GMRCSRVS",176,0)
 S ARRAY(COUNT)="Consult Performance Monitor Report [GMRC RPT PERF MONITOR].",COUNT=COUNT+1
"RTN","GMRCSRVS",177,0)
 S ARRAY(COUNT)=" ",COUNT=COUNT+1
"RTN","GMRCSRVS",178,0)
 D EN^DDIOL(.ARRAY)
"RTN","GMRCSRVS",179,0)
 I '$G(DIQUIET) D
"RTN","GMRCSRVS",180,0)
 . S GMRCON=0
"RTN","GMRCSRVS",181,0)
 . D YESNO(X,Y)
"RTN","GMRCSRVS",182,0)
 . I 'GMRCON K X
"RTN","GMRCSRVS",183,0)
 . D EN^DDIOL(" ")
"RTN","GMRCSRVS",184,0)
 Q
"RTN","GMRCSRVS",185,0)
PARSE(ARRAY) ;TAKE ARRAY VALUE AND PARSE INTO PIECES SHORTER THAN 70 CHARACTERS
"RTN","GMRCSRVS",186,0)
 N ARRAYSP,GMRCNT
"RTN","GMRCSRVS",187,0)
PARSE1 I $L(ARRAY)'>70 S ARRAY(COUNT)=ARRAY,COUNT=COUNT+1 Q
"RTN","GMRCSRVS",188,0)
 F GMRCNT=70:-1 S ARRAYSP=$E(ARRAY,GMRCNT) I ARRAYSP=" " Q
"RTN","GMRCSRVS",189,0)
 S ARRAY(COUNT)=$E(ARRAY,1,GMRCNT-1),COUNT=COUNT+1
"RTN","GMRCSRVS",190,0)
 S ARRAY=$E(ARRAY,GMRCNT+1,9999)
"RTN","GMRCSRVS",191,0)
 G:ARRAY'="" PARSE1
"RTN","GMRCSRVS",192,0)
 Q
"RTN","GMRCSRVS",193,0)
YESNO(X,Y) ;YES/NO QUESTION/RESPONSE
"RTN","GMRCSRVS",194,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSRVS",195,0)
 S DIR(0)="YA"
"RTN","GMRCSRVS",196,0)
 S DIR("A")="Do you wish to continue adding "_$P(^GMR(123.5,X,0),"^",1)_" as a new sub-service? "
"RTN","GMRCSRVS",197,0)
 S DIR("B")="NO"
"RTN","GMRCSRVS",198,0)
 S DIR("T")=300
"RTN","GMRCSRVS",199,0)
 S DIR("?",1)="Enter ""YES"" to add service as a sub-service."
"RTN","GMRCSRVS",200,0)
 S DIR("?")="Enter ""NO"" to NOT add the service as a sub-service."
"RTN","GMRCSRVS",201,0)
 D ^DIR Q:($G(DTOUT))!($G(DUOUT))!($G(DIROUT))
"RTN","GMRCSRVS",202,0)
 I Y=1 S GMRCON=1
"RTN","GMRCSRVS",203,0)
 Q
"VER")
8.0^22.0
"^DD",123.3,123.3,.01,0)
NAME^RFX^^0;1^K:$L(X)>63!($L(X)<3)!'(X'?1P.E)!($O(^GMR(123.3,"B",X,0))'="") X
"^DD",123.3,123.3,.01,1,0)
^.1^^-1
"^DD",123.3,123.3,.01,1,1,0)
123.3^B
"^DD",123.3,123.3,.01,1,1,1)
S ^GMR(123.3,"B",$E(X,1,30),DA)=""
"^DD",123.3,123.3,.01,1,1,2)
K ^GMR(123.3,"B",$E(X,1,30),DA)
"^DD",123.3,123.3,.01,3)
Answer must be a unique name between 3-63 characters in length.
"^DD",123.3,123.3,.01,21,0)
^.001^1^1^3000621^^
"^DD",123.3,123.3,.01,21,1,0)
This is the name of the procedure that will be requested within CPRS.
"^DD",123.3,123.3,.01,"DT")
3060720
"^DD",123.5,123.5,.01,0)
SERVICE NAME^RFX^^0;1^K:$L(X)>63!($L(X)<2)!'(X'?1P.E)!($O(^GMR(123.5,"B",X,0))'="") X
"^DD",123.5,123.5,.01,1,0)
^.1
"^DD",123.5,123.5,.01,1,1,0)
123.5^B
"^DD",123.5,123.5,.01,1,1,1)
S ^GMR(123.5,"B",$E(X,1,63),DA)=""
"^DD",123.5,123.5,.01,1,1,2)
K ^GMR(123.5,"B",$E(X,1,63),DA)
"^DD",123.5,123.5,.01,1,1,"%D",0)
^^2^2^2990903^^^^
"^DD",123.5,123.5,.01,1,1,"%D",1,0)
This is the regular cross-reference for this file allowing look-up by
"^DD",123.5,123.5,.01,1,1,"%D",2,0)
Service Name.
"^DD",123.5,123.5,.01,1,2,0)
123.5^AC1^MUMPS
"^DD",123.5,123.5,.01,1,2,1)
D SETAC^GMRCDDX
"^DD",123.5,123.5,.01,1,2,2)
D KILLAC^GMRCDDX
"^DD",123.5,123.5,.01,1,2,3)
This cross-reference is what helps maintain the alphabetical look-up of services.
"^DD",123.5,123.5,.01,1,2,"%D",0)
^^5^5^2971103^
"^DD",123.5,123.5,.01,1,2,"%D",1,0)
This cross-reference calls the GMRCDDX routine to set and kill "AC"
"^DD",123.5,123.5,.01,1,2,"%D",2,0)
cross-references that are defined for DD 123.51 (Sub-Service/Specialty
"^DD",123.5,123.5,.01,1,2,"%D",3,0)
multiple),.01 field.  The ACP cross reference helps identify all entries
"^DD",123.5,123.5,.01,1,2,"%D",4,0)
in file 123.5 which have the service being edited as a child.  For each
"^DD",123.5,123.5,.01,1,2,"%D",5,0)
occurrence as a child, the "AC" cross-reference is updated.
"^DD",123.5,123.5,.01,1,2,"DT")
2971103
"^DD",123.5,123.5,.01,3)
Type a unique name of a service or specialty that can receive consults.
"^DD",123.5,123.5,.01,21,0)
^.001^3^3^3000217^^^^
"^DD",123.5,123.5,.01,21,1,0)
This is the Name of a service or specialty which may receive consult/
"^DD",123.5,123.5,.01,21,2,0)
requests.  This may also be a name which represents a group of services
"^DD",123.5,123.5,.01,21,3,0)
or specialties.
"^DD",123.5,123.5,.01,"DT")
3060720
"BLD",6829,6)
^47
**END**
**END**
