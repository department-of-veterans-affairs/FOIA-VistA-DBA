Released EAS*1*50 SEQ #41
Extracted from mail message
**KIDS**:EAS*1.0*50^

**INSTALL NAME**
EAS*1.0*50
"BLD",5433,0)
EAS*1.0*50^ENROLLMENT APPLICATION SYSTEM^0^3040604^y
"BLD",5433,4,0)
^9.64PA^^
"BLD",5433,"INID")
^
"BLD",5433,"INIT")

"BLD",5433,"KRN",0)
^9.67PA^8989.52^19
"BLD",5433,"KRN",.4,0)
.4
"BLD",5433,"KRN",.401,0)
.401
"BLD",5433,"KRN",.402,0)
.402
"BLD",5433,"KRN",.403,0)
.403
"BLD",5433,"KRN",.5,0)
.5
"BLD",5433,"KRN",.84,0)
.84
"BLD",5433,"KRN",3.6,0)
3.6
"BLD",5433,"KRN",3.8,0)
3.8
"BLD",5433,"KRN",9.2,0)
9.2
"BLD",5433,"KRN",9.8,0)
9.8
"BLD",5433,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5433,"KRN",9.8,"NM",1,0)
EAS150PT^^0^B17733272
"BLD",5433,"KRN",9.8,"NM",2,0)
EAS150P1^^0^B22158116
"BLD",5433,"KRN",9.8,"NM",3,0)
EASUER^^0^B17576711
"BLD",5433,"KRN",9.8,"NM","B","EAS150P1",2)

"BLD",5433,"KRN",9.8,"NM","B","EAS150PT",1)

"BLD",5433,"KRN",9.8,"NM","B","EASUER",3)

"BLD",5433,"KRN",19,0)
19
"BLD",5433,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",5433,"KRN",19,"NM",1,0)
EAS MT UE STATUS^^0
"BLD",5433,"KRN",19,"NM",2,0)
EAS MT REPORT MENU^^2
"BLD",5433,"KRN",19,"NM","B","EAS MT REPORT MENU",2)

"BLD",5433,"KRN",19,"NM","B","EAS MT UE STATUS",1)

"BLD",5433,"KRN",19.1,0)
19.1
"BLD",5433,"KRN",101,0)
101
"BLD",5433,"KRN",409.61,0)
409.61
"BLD",5433,"KRN",771,0)
771
"BLD",5433,"KRN",870,0)
870
"BLD",5433,"KRN",8989.51,0)
8989.51
"BLD",5433,"KRN",8989.52,0)
8989.52
"BLD",5433,"KRN",8994,0)
8994
"BLD",5433,"KRN","B",.4,.4)

"BLD",5433,"KRN","B",.401,.401)

"BLD",5433,"KRN","B",.402,.402)

"BLD",5433,"KRN","B",.403,.403)

"BLD",5433,"KRN","B",.5,.5)

"BLD",5433,"KRN","B",.84,.84)

"BLD",5433,"KRN","B",3.6,3.6)

"BLD",5433,"KRN","B",3.8,3.8)

"BLD",5433,"KRN","B",9.2,9.2)

"BLD",5433,"KRN","B",9.8,9.8)

"BLD",5433,"KRN","B",19,19)

"BLD",5433,"KRN","B",19.1,19.1)

"BLD",5433,"KRN","B",101,101)

"BLD",5433,"KRN","B",409.61,409.61)

"BLD",5433,"KRN","B",771,771)

"BLD",5433,"KRN","B",870,870)

"BLD",5433,"KRN","B",8989.51,8989.51)

"BLD",5433,"KRN","B",8989.52,8989.52)

"BLD",5433,"KRN","B",8994,8994)

"BLD",5433,"QUES",0)
^9.62^^
"BLD",5433,"REQB",0)
^9.611^1^1
"BLD",5433,"REQB",1,0)
EAS*1.0*37^2
"BLD",5433,"REQB","B","EAS*1.0*37",1)

"KRN",19,11370,-1)
2^2
"KRN",19,11370,0)
EAS MT REPORT MENU^Report Menu^^M^66481^^^^^^^552
"KRN",19,11370,10,0)
^19.01IP^7^7
"KRN",19,11370,10,7,0)
12097
"KRN",19,11370,10,7,"^")
EAS MT UE STATUS
"KRN",19,11370,"U")
REPORT MENU
"KRN",19,12097,-1)
0^1
"KRN",19,12097,0)
EAS MT UE STATUS^User Enrollee Status for MT Letters^^A^^^^^^^^ENROLLMENT APPLICATION SYSTEM^^1
"KRN",19,12097,1,0)
^^2^2^3040524^
"KRN",19,12097,1,1,0)
This report will provide a listing of User Enrollee status for all veterans
"KRN",19,12097,1,2,0)
with a pending Means Test Letter in the EAS MT LETTERS STATUS File (#713.2)
"KRN",19,12097,20)
D QUE^EAS150P1
"KRN",19,12097,25)
EAS150P1
"KRN",19,12097,"U")
USER ENROLLEE STATUS FOR MT LE
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",552,-1)
1^1
"PKG",552,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",552,20,0)
^9.402P^2^1
"PKG",552,20,2,0)
2^^EASXDR
"PKG",552,20,2,1)
 
"PKG",552,20,"B",2,2)

"PKG",552,22,0)
^9.49I^1^1
"PKG",552,22,1,0)
1.0^3010315^3010419^66481
"PKG",552,22,1,"PAH",1,0)
50^3040604
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","EAS150P1")
0^2^B22158116
"RTN","EAS150P1",1,0)
EAS150P1 ;ALB/SCK - PATCH EAS-50 POST UTILITIES ; 28-APR-2004
"RTN","EAS150P1",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**50**;Mar 15, 2004
"RTN","EAS150P1",3,0)
 ;
"RTN","EAS150P1",4,0)
 Q
"RTN","EAS150P1",5,0)
QUE ;
"RTN","EAS150P1",6,0)
 N EACY,%I,Y,DIR,DIRUT
"RTN","EAS150P1",7,0)
 ;
"RTN","EAS150P1",8,0)
 D NOW^%DTC S Y=%I(3) D DD^%DT S EACY=Y
"RTN","EAS150P1",9,0)
 W !!
"RTN","EAS150P1",10,0)
 S DIR(0)="F",DIR("B")=EACY,DIR("A")="Print UE Status Report for Calendar Year"
"RTN","EAS150P1",11,0)
 S DIR("?",1)=""
"RTN","EAS150P1",12,0)
 S DIR("?",2)="This report will display the User Enrollee Status information for all"
"RTN","EAS150P1",13,0)
 S DIR("?",3)="patients with a Means Test Letter pending in the selected Calendar Year."
"RTN","EAS150P1",14,0)
 S DIR("?")="Enter ""ALL"" for all entries."
"RTN","EAS150P1",15,0)
 D ^DIR K DIR
"RTN","EAS150P1",16,0)
 Q:$D(DIRUT)
"RTN","EAS150P1",17,0)
 I +Y>0!(Y="ALL") S EACY=Y
"RTN","EAS150P1",18,0)
 E  Q
"RTN","EAS150P1",19,0)
 ;
"RTN","EAS150P1",20,0)
 S ZTSAVE("DUZ")="",ZTSAVE("EACY")=""
"RTN","EAS150P1",21,0)
 D EN^XUTMDEVQ("EN^EAS150P1","EAS UE STATUS REPORT",.ZTSAVE)
"RTN","EAS150P1",22,0)
 ;
"RTN","EAS150P1",23,0)
 Q
"RTN","EAS150P1",24,0)
 ;
"RTN","EAS150P1",25,0)
EN ; Entry point for UE Status report
"RTN","EAS150P1",26,0)
 N EALIEN,EACNT,EAX,EADFN,EADFN1,EANAME,EAPTR,EAS60
"RTN","EAS150P1",27,0)
 ;
"RTN","EAS150P1",28,0)
 K ^TMP("EASUES",$J)
"RTN","EAS150P1",29,0)
 K ^TMP("SCK",$J)
"RTN","EAS150P1",30,0)
 F EAX=0,1,2 S EACNT(EAX)=0
"RTN","EAS150P1",31,0)
 S EALIEN=0
"RTN","EAS150P1",32,0)
 F  S EALIEN=$O(^EAS(713.2,EALIEN)) Q:'EALIEN  D
"RTN","EAS150P1",33,0)
 . Q:$D(^EAS(713.2,"AC",1,EALIEN))  ; Quit if MT has been returned
"RTN","EAS150P1",34,0)
 . S EAPTR=$$GET1^DIQ(713.2,EALIEN,2,"I") ; Get pointer to file #713.1
"RTN","EAS150P1",35,0)
 . Q:$D(^EAS(713.1,"AP",1,EAPTR))  ; Quit if Prohibit Flag is set for patch
"RTN","EAS150P1",36,0)
 . ; If EACY is not "ALL" then check Calendar year for 60 day letter.  
"RTN","EAS150P1",37,0)
 . ; Quit if letter date is not in the selected CY
"RTN","EAS150P1",38,0)
 . S EAS60=$$GET1^DIQ(713.2,EALIEN,8,"I")
"RTN","EAS150P1",39,0)
 . S Y=$E(EAS60,1,3) D DD^%DT S EAS60=Y
"RTN","EAS150P1",40,0)
 . I +EACY>0 Q:EAS60'=EACY 
"RTN","EAS150P1",41,0)
 . Q:$$DECEASED^EASMTUTL(EALIEN)  ; Quit if patient is deceased
"RTN","EAS150P1",42,0)
 . S EADFN1=$$GET1^DIQ(713.2,EALIEN,2,"I")
"RTN","EAS150P1",43,0)
 . S EADFN=$$GET1^DIQ(713.1,EADFN1,.01,"I")
"RTN","EAS150P1",44,0)
 . S EANAME=$$GET1^DIQ(2,EADFN,.01)
"RTN","EAS150P1",45,0)
 . S ^TMP("EASUES",$J,EANAME,EADFN)=EALIEN_U_EAS60
"RTN","EAS150P1",46,0)
 D REPORT
"RTN","EAS150P1",47,0)
 Q
"RTN","EAS150P1",48,0)
 ;
"RTN","EAS150P1",49,0)
REPORT ;
"RTN","EAS150P1",50,0)
 N EANAME,EADFN,PAGE,EASABRT
"RTN","EAS150P1",51,0)
 ;
"RTN","EAS150P1",52,0)
 S (EASABRT,PAGE)=0
"RTN","EAS150P1",53,0)
 D HDR
"RTN","EAS150P1",54,0)
 ;
"RTN","EAS150P1",55,0)
 S EANAME=""
"RTN","EAS150P1",56,0)
 F  S EANAME=$O(^TMP("EASUES",$J,EANAME)) Q:EANAME']""  D  Q:$G(EASABRT)
"RTN","EAS150P1",57,0)
 . S EADFN=0
"RTN","EAS150P1",58,0)
 . F  S EADFN=$O(^TMP("EASUES",$J,EANAME,EADFN)) Q:'EADFN  D
"RTN","EAS150P1",59,0)
 . . D LINE(EANAME,EADFN,$P($G(^TMP("EASUES",$J,EANAME,EADFN)),U,2))
"RTN","EAS150P1",60,0)
 . . I ($Y+6)>IOSL D HDR  Q:$G(EASABRT)
"RTN","EAS150P1",61,0)
 ;
"RTN","EAS150P1",62,0)
 I '$G(EASABRT) D
"RTN","EAS150P1",63,0)
 . N XX F XX=$Y:1:IOSL-6 W !
"RTN","EAS150P1",64,0)
 . D FTR
"RTN","EAS150P1",65,0)
 Q:$G(EASABRT)
"RTN","EAS150P1",66,0)
 I $E(IOST,1,2)="C-" D  Q:$D(DIRUT)!('Y)
"RTN","EAS150P1",67,0)
 . S DIR(0)="E" D ^DIR K DIR
"RTN","EAS150P1",68,0)
 D SUMMARY
"RTN","EAS150P1",69,0)
 ;
"RTN","EAS150P1",70,0)
 Q
"RTN","EAS150P1",71,0)
 ;
"RTN","EAS150P1",72,0)
LINE(EANAME,DFN,EAS60) ;
"RTN","EAS150P1",73,0)
 N EAUES,VA
"RTN","EAS150P1",74,0)
 ;
"RTN","EAS150P1",75,0)
 S EAUES=$$UESTAT^EASUER(DFN)
"RTN","EAS150P1",76,0)
 S EACNT(EAUES)=EACNT(EAUES)+1
"RTN","EAS150P1",77,0)
 D PID^VADPT6
"RTN","EAS150P1",78,0)
 W !,$E(EANAME,1,25),?28,VA("BID")
"RTN","EAS150P1",79,0)
 W ?35,$$GET1^DIQ(2,EADFN,.3617)
"RTN","EAS150P1",80,0)
 W ?42,$S(EAUES=1:"UE",EAUES=0:"Not UE",EAUES=2:"Diff. Site",1:"")
"RTN","EAS150P1",81,0)
 W ?54,$E($$GET1^DIQ(2,EADFN,.3618),1,18),?74,EAS60
"RTN","EAS150P1",82,0)
 Q
"RTN","EAS150P1",83,0)
 ;
"RTN","EAS150P1",84,0)
SUMMARY ;
"RTN","EAS150P1",85,0)
 N DDASH
"RTN","EAS150P1",86,0)
 ;
"RTN","EAS150P1",87,0)
 W @IOF
"RTN","EAS150P1",88,0)
 W !,"User Enrollee Status Summary for Pending Means Test Letters"
"RTN","EAS150P1",89,0)
 W !,"Print Date: ",$$FMTE^XLFDT(DT)
"RTN","EAS150P1",90,0)
 S $P(DDASH,"=",IOM)="" W !,DDASH,!
"RTN","EAS150P1",91,0)
 W !?4,"Patients with User Enrollee Status at this site:              ",$FN(EACNT(1),",")
"RTN","EAS150P1",92,0)
 W !!?4,"Patients which DO NOT have User Enrollee Status at this site: ",$FN(EACNT(2),",")
"RTN","EAS150P1",93,0)
 W !!?4,"Patients which do not have User Enrollee Status:              ",$FN(EACNT(0),",")
"RTN","EAS150P1",94,0)
 W !!?4,"Total Patients Reviewed:                                      ",$FN(EACNT(0)+EACNT(1)+EACNT(2),",")
"RTN","EAS150P1",95,0)
 Q
"RTN","EAS150P1",96,0)
 ;
"RTN","EAS150P1",97,0)
HDR ;
"RTN","EAS150P1",98,0)
 N DDASH,EASITE,EAPRNT
"RTN","EAS150P1",99,0)
 ;
"RTN","EAS150P1",100,0)
 I PAGE>0,$E(IOST,1,2)="C-" D  Q:$G(EASABRT)
"RTN","EAS150P1",101,0)
 . S DIR(0)="E"
"RTN","EAS150P1",102,0)
 . D ^DIR K DIR
"RTN","EAS150P1",103,0)
 . I 'Y S EASABRT=1
"RTN","EAS150P1",104,0)
 ;
"RTN","EAS150P1",105,0)
 S EASITE=$$SITE^VASITE,EAPRNT=$$PSITE^EASUER($P(EASITE,U,3))
"RTN","EAS150P1",106,0)
 W @IOF
"RTN","EAS150P1",107,0)
 S PAGE=PAGE+1
"RTN","EAS150P1",108,0)
 W !,"User Enrollee Status for Pending Means Test Letters"
"RTN","EAS150P1",109,0)
 W !,"Calendar Year for MT Letters to Print: ",EACY
"RTN","EAS150P1",110,0)
 W !,"Print Date: ",$$FMTE^XLFDT(DT)
"RTN","EAS150P1",111,0)
 W !,"Page: ",PAGE
"RTN","EAS150P1",112,0)
 W !!,"Current Station: ",$P(EASITE,U,3),":",$P(EASITE,U,2)
"RTN","EAS150P1",113,0)
 W !,"Current Administrative Parent: ",EASITE,":",$$GET1^DIQ(4,EAPRNT,.01)
"RTN","EAS150P1",114,0)
 W !!,"Name",?28,"LAST4",?35,"UE-FY",?42,"UE Status",?54,"UE Site",?74,"LT-CY"
"RTN","EAS150P1",115,0)
 ;
"RTN","EAS150P1",116,0)
 S $P(DDASH,"=",IOM)="" W !,DDASH
"RTN","EAS150P1",117,0)
 W !
"RTN","EAS150P1",118,0)
 Q
"RTN","EAS150P1",119,0)
 ;
"RTN","EAS150P1",120,0)
FTR ;
"RTN","EAS150P1",121,0)
 I $E(IOST,1,2)'="C-" D
"RTN","EAS150P1",122,0)
 . W !?5,"UE         -User Enrollee Status at Site "
"RTN","EAS150P1",123,0)
 . W !?5,"Not UE     -User is not a User Enrollee"
"RTN","EAS150P1",124,0)
 . W !?5,"Diff. Site -User Enrollee Status, but at Another Site."
"RTN","EAS150P1",125,0)
 Q
"RTN","EAS150PT")
0^1^B17733272
"RTN","EAS150PT",1,0)
EAS150PT ;ALB/SCK - USER ENROLLEE MT LETTER CLEANUP ; 02-MAR-04
"RTN","EAS150PT",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**50**;Mar 15, 2004
"RTN","EAS150PT",3,0)
 ;
"RTN","EAS150PT",4,0)
 Q
"RTN","EAS150PT",5,0)
 ;
"RTN","EAS150PT",6,0)
EN ; Que off the background task
"RTN","EAS150PT",7,0)
 N ZTRTN,ZTDESC,ZTSK,ZTIO,ZTDH,MSG,ZTSAVE
"RTN","EAS150PT",8,0)
 ;
"RTN","EAS150PT",9,0)
 W !,"Preparing to run the EAS*1*50 Post Install MT Letters Cleanup"
"RTN","EAS150PT",10,0)
 W !,"After the cleanup, you will be sent a MailMan summary of the cleanup"
"RTN","EAS150PT",11,0)
 W !,"statistics.  You will also be asked to select a printer to send the"
"RTN","EAS150PT",12,0)
 W !,"detailed results to.  This report could be quite lengthy.  Please "
"RTN","EAS150PT",13,0)
 W !,"DO NOT run the report to your screen!",!
"RTN","EAS150PT",14,0)
 D ^%ZIS
"RTN","EAS150PT",15,0)
 S ZTRTN="LETTERS^EAS150PT"
"RTN","EAS150PT",16,0)
 S ZTDH=$$NOW^XLFDT
"RTN","EAS150PT",17,0)
 S ZTSAVE("DUZ")=""
"RTN","EAS150PT",18,0)
 S ZTDESC="EAS150 MT LETTER CLEANUP FOR UE STATUS"
"RTN","EAS150PT",19,0)
 D ^%ZTLOAD
"RTN","EAS150PT",20,0)
 I $D(ZTSK) W !!?5,"Task: "_ZTSK_" Queued."
"RTN","EAS150PT",21,0)
 D HOME^%ZIS
"RTN","EAS150PT",22,0)
 Q
"RTN","EAS150PT",23,0)
 ;
"RTN","EAS150PT",24,0)
LETTERS ; Reflag those MT letters which need to be updated for UE Status update
"RTN","EAS150PT",25,0)
 N EASIEN,EASPTR,EASDFN,EASLTR,EASCNT,XX
"RTN","EAS150PT",26,0)
 ;
"RTN","EAS150PT",27,0)
 K ^TMP("EAS150P",$J)
"RTN","EAS150PT",28,0)
 S ^TMP("EAS150P",$J,"START")=$H
"RTN","EAS150PT",29,0)
 ;
"RTN","EAS150PT",30,0)
 F XX="60D","30D","0D" S EASCNT(XX)=0
"RTN","EAS150PT",31,0)
 S EASIEN=0
"RTN","EAS150PT",32,0)
 F  S EASIEN=$O(^EAS(713.2,"AC",0,EASIEN)) Q:'EASIEN  D
"RTN","EAS150PT",33,0)
 . S EASPTR=$$GET1^DIQ(713.2,EASIEN,2,"I")
"RTN","EAS150PT",34,0)
 . Q:$D(^EAS(713.1,"AP",1,EASPTR))  ; Quit if Letter Prohibit Flag set
"RTN","EAS150PT",35,0)
 . Q:$$DECEASED^EASMTUTL(EASIEN)  ; Quit if patient deceased
"RTN","EAS150PT",36,0)
 . D PROCLTR(EASIEN)
"RTN","EAS150PT",37,0)
 ;
"RTN","EAS150PT",38,0)
 S ^TMP("EAS150P",$J,"END")=$H
"RTN","EAS150PT",39,0)
 D MAIL
"RTN","EAS150PT",40,0)
 D REPORT
"RTN","EAS150PT",41,0)
 Q
"RTN","EAS150PT",42,0)
 ;
"RTN","EAS150PT",43,0)
PROCLTR(EASIEN) ;  Process letter
"RTN","EAS150PT",44,0)
 N NODE6,NODE4,NODEZ,IENS,FDA,ERR
"RTN","EAS150PT",45,0)
 ;
"RTN","EAS150PT",46,0)
 S NODE6=$G(^EAS(713.2,EASIEN,6))
"RTN","EAS150PT",47,0)
 S NODE4=$G(^EAS(713.2,EASIEN,4))
"RTN","EAS150PT",48,0)
 S NODEZ=$G(^EAS(713.2,EASIEN,"Z"))
"RTN","EAS150PT",49,0)
 ;
"RTN","EAS150PT",50,0)
 ; If any of the letters have been printed to date, then quit.
"RTN","EAS150PT",51,0)
 I $P(NODE6,U,3)!($P(NODE4,U,3))!($P(NODEZ,U,3)) Q
"RTN","EAS150PT",52,0)
 ;
"RTN","EAS150PT",53,0)
 ; If 60d Printed = No and and 60d Flag = NO and 30d Flag = YES
"RTN","EAS150PT",54,0)
 ; then reset 60d Flag to YES 
"RTN","EAS150PT",55,0)
 I '$P(NODE6,U,3)&('$P(NODE6,U,3))&($P(NODE4,U,2)) D  Q
"RTN","EAS150PT",56,0)
 . S EASCNT("60D")=EASCNT("60D")+1
"RTN","EAS150PT",57,0)
 . S ^TMP("EAS150P",$J,$$GET1^DIQ(713.2,EASIEN,2),EASIEN)="60D"
"RTN","EAS150PT",58,0)
 . S IENS=EASIEN_","
"RTN","EAS150PT",59,0)
 . S FDA(1,713.2,IENS,9)="YES"
"RTN","EAS150PT",60,0)
 . S FDA(1,713.2,IENS,12)="NO"
"RTN","EAS150PT",61,0)
 . D UPD(.FDA)
"RTN","EAS150PT",62,0)
 ;
"RTN","EAS150PT",63,0)
 ; If 30d Printed = No and and 30d Flag = NO and 0d Flag = YES
"RTN","EAS150PT",64,0)
 ; then reset 30d Flag to YES 
"RTN","EAS150PT",65,0)
 I '$P(NODE4,U,3)&('$P(NODE4,U,2))&($P(NODEZ,U,2)) D  Q
"RTN","EAS150PT",66,0)
 . S EASCNT("30D")=EASCNT("30D")+1
"RTN","EAS150PT",67,0)
 . S ^TMP("EAS150P",$J,$$GET1^DIQ(713.2,EASIEN,2),EASIEN)="30D"
"RTN","EAS150PT",68,0)
 . S IENS=EASIEN_","
"RTN","EAS150PT",69,0)
 . S FDA(1,713.2,IENS,12)="YES"
"RTN","EAS150PT",70,0)
 . S FDA(1,713.2,IENS,18)="NO"
"RTN","EAS150PT",71,0)
 . D UPD(.FDA)
"RTN","EAS150PT",72,0)
 ;
"RTN","EAS150PT",73,0)
 ; If 0d Printed = No and 0d Flag = NO, then reset 0d Flag to YES
"RTN","EAS150PT",74,0)
 I '$P(NODEZ,U,2)&('$P(NODEZ,U,3))&($P(NODEZ,U,1)<DT) D  Q
"RTN","EAS150PT",75,0)
 . S EASCNT("0D")=EASCNT("0D")+1
"RTN","EAS150PT",76,0)
 . S ^TMP("EAS150P",$J,$$GET1^DIQ(713.2,EASIEN,2),EASIEN)="0D"
"RTN","EAS150PT",77,0)
 . S IENS=EASIEN_","
"RTN","EAS150PT",78,0)
 . S FDA(1,713.2,IENS,18)="YES"
"RTN","EAS150PT",79,0)
 . D UPD(.FDA)
"RTN","EAS150PT",80,0)
 Q
"RTN","EAS150PT",81,0)
 ;
"RTN","EAS150PT",82,0)
UPD(FDA) ;  Update file entry
"RTN","EAS150PT",83,0)
 N ERR
"RTN","EAS150PT",84,0)
 ;
"RTN","EAS150PT",85,0)
 D FILE^DIE("E","FDA(1)","ERR")
"RTN","EAS150PT",86,0)
 Q
"RTN","EAS150PT",87,0)
 ;
"RTN","EAS150PT",88,0)
MAIL ;
"RTN","EAS150PT",89,0)
 N MSG,XMDUZ,XMSUB,XMTEXT,XMY,XX
"RTN","EAS150PT",90,0)
 ;
"RTN","EAS150PT",91,0)
 S (XMDUZ,XMSUB)="EAS*1*50 POST INSTALL SUMMARY"
"RTN","EAS150PT",92,0)
 S XMY(.5)="",XMY(DUZ)=""
"RTN","EAS150PT",93,0)
 S XMTEXT="MSG("
"RTN","EAS150PT",94,0)
 S MSG(10)="Begin: "_$$HTE^XLFDT(^TMP("EAS150P",$J,"START"))
"RTN","EAS150PT",95,0)
 S MSG(20)="End:   "_$$HTE^XLFDT(^TMP("EAS150P",$J,"END"))
"RTN","EAS150PT",96,0)
 S MSG(30)="Processing Time: "_$$HDIFF^XLFDT(^TMP("EAS150P",$J,"END"),^TMP("EAS150P",$J,"START"),3)
"RTN","EAS150PT",97,0)
 S MSG(31)=""
"RTN","EAS150PT",98,0)
 S MSG(40)="60-Day Letters:   "_EASCNT("60D")
"RTN","EAS150PT",99,0)
 S MSG(50)="30-Day Letters:   "_EASCNT("30D")
"RTN","EAS150PT",100,0)
 S MSG(60)=" 0-Day Letters:   "_EASCNT("0D")
"RTN","EAS150PT",101,0)
 D ^XMD
"RTN","EAS150PT",102,0)
 Q
"RTN","EAS150PT",103,0)
 ;
"RTN","EAS150PT",104,0)
REPORT ;
"RTN","EAS150PT",105,0)
 N EAX,PAGE,EANAME
"RTN","EAS150PT",106,0)
 ;
"RTN","EAS150PT",107,0)
 U IO
"RTN","EAS150PT",108,0)
 S (PAGE,EAX)=0
"RTN","EAS150PT",109,0)
 D HDR
"RTN","EAS150PT",110,0)
 S EANAME=""
"RTN","EAS150PT",111,0)
 F  S EANAME=$O(^TMP("EAS150P",$J,EANAME)) Q:EANAME']""  D
"RTN","EAS150PT",112,0)
 . S EAX=0
"RTN","EAS150PT",113,0)
 . F  S EAX=$O(^TMP("EAS150P",$J,EANAME,EAX)) Q:'EAX  D
"RTN","EAS150PT",114,0)
 . . W !,$$GET1^DIQ(713.2,EAX,2)
"RTN","EAS150PT",115,0)
 . . W ?31,^TMP("EAS150P",$J,EANAME,EAX)
"RTN","EAS150PT",116,0)
 . . I ($Y+6)>IOSL D HDR
"RTN","EAS150PT",117,0)
 ;
"RTN","EAS150PT",118,0)
 D FTR
"RTN","EAS150PT",119,0)
 Q
"RTN","EAS150PT",120,0)
 ;
"RTN","EAS150PT",121,0)
HDR ;
"RTN","EAS150PT",122,0)
 N DDASH
"RTN","EAS150PT",123,0)
 ;
"RTN","EAS150PT",124,0)
 W @IOF
"RTN","EAS150PT",125,0)
 S PAGE=PAGE+1
"RTN","EAS150PT",126,0)
 W !,"Patch EAS*1*50 MT Letter Cleanup Results"
"RTN","EAS150PT",127,0)
 W !,"Patch Install Date: ",$$FMTE^XLFDT(DT)
"RTN","EAS150PT",128,0)
 W !,"Page: ",PAGE
"RTN","EAS150PT",129,0)
 W !!?31,"Letter"
"RTN","EAS150PT",130,0)
 W !,"Name",?31,"Reset"
"RTN","EAS150PT",131,0)
 S $P(DDASH,"=",IOM)="" W !,DDASH
"RTN","EAS150PT",132,0)
 W !
"RTN","EAS150PT",133,0)
 Q
"RTN","EAS150PT",134,0)
 ;
"RTN","EAS150PT",135,0)
FTR ;
"RTN","EAS150PT",136,0)
 W !!!!?5,"60-Day Letters:   "_EASCNT("60D")
"RTN","EAS150PT",137,0)
 W !?5,"30-Day Letters:   "_EASCNT("30D")
"RTN","EAS150PT",138,0)
 W !?5," 0-Day Letters:   "_EASCNT("0D")
"RTN","EAS150PT",139,0)
 Q
"RTN","EASUER")
0^3^B17576711
"RTN","EASUER",1,0)
EASUER ;ALB/CKN - GEOGRAPHIC MEANS TEST PHASE II ; 03-MAR-2003
"RTN","EASUER",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**25,37,50**;Mar 15, 2001
"RTN","EASUER",3,0)
 ;This routine contains several APIs that will be called from
"RTN","EASUER",4,0)
 ;different packages like Scheduling, PCE and Fee basis to notify
"RTN","EASUER",5,0)
 ;Enrollment package whenever any inpatient/outpatient encounter occurs,
"RTN","EASUER",6,0)
 ;or any appointment made or any changes made to fee basis authorization.
"RTN","EASUER",7,0)
 Q
"RTN","EASUER",8,0)
SCHED ;This API will be called from SDAM APPOINTMENT EVENTS via EAS UE SCHED 
"RTN","EASUER",9,0)
 ;EVENT protocol whenever any changes made to veteran's appointment.
"RTN","EASUER",10,0)
 ;Input variables used in this api:
"RTN","EASUER",11,0)
 ;             SDATA     -  piece 1 - ien of multiple entry of the 
"RTN","EASUER",12,0)
 ;                                    APPOINTMENTS multiple of the
"RTN","EASUER",13,0)
 ;                                    HOSPITAL LOCATION file.
"RTN","EASUER",14,0)
 ;                          piece 2 - ien of PATIENT file (DFN)
"RTN","EASUER",15,0)
 ;                          piece 3 - internal Date/time of appt.
"RTN","EASUER",16,0)
 ;                          piece 4 - ien of clinic in the HOSPITAL
"RTN","EASUER",17,0)
 ;                                    LOCATION file.
"RTN","EASUER",18,0)
 ;             SDAMEVT   -  ien pointing to an entry in the APPOINTMENT
"RTN","EASUER",19,0)
 ;                          TRANSACTION file (#409.66).
"RTN","EASUER",20,0)
 ;
"RTN","EASUER",21,0)
 N DFN,APT,APTDT
"RTN","EASUER",22,0)
 S DFN=$P($G(SDATA),"^",2) Q:DFN=""  ;Veteran's IEN
"RTN","EASUER",23,0)
 I $G(SDAMEVT)=1 D  ;if new appointment is made
"RTN","EASUER",24,0)
 . S APTDT=$P($G(SDATA),"^",3),APTDT=$$FY(APTDT)
"RTN","EASUER",25,0)
 . ;check current User Enrollee data and update it if necessary.
"RTN","EASUER",26,0)
 . I $$UPDCHK(DFN,APTDT) D FILE(DFN,APTDT)
"RTN","EASUER",27,0)
 Q
"RTN","EASUER",28,0)
ENC ;This API will be called from PXK VISIT DATA EVENT via EAS UE PCE EVENT
"RTN","EASUER",29,0)
 ;whenever any inpatient/outpatient encounter occurs.
"RTN","EASUER",30,0)
 ;Input:
"RTN","EASUER",31,0)
 ;^TMP("PXKCO",$J,VISIT,"V FILE STRING",V FILE RECORD,DDSUBSCRIPT,"AFTER/BEFORE")=DATA
"RTN","EASUER",32,0)
 ;where: subscript piece 1 - string notation representing package "PXKCO"
"RTN","EASUER",33,0)
 ;       subscript piece 2 - Job number ($J)
"RTN","EASUER",34,0)
 ;       subscript piece 3 - ien of VISIT file
"RTN","EASUER",35,0)
 ;       subscript piece 4 - string representing the VISIT or V file
"RTN","EASUER",36,0)
 ;                           data category
"RTN","EASUER",37,0)
 ;       subscript piece 5 - ien of the entry in the file represented in
"RTN","EASUER",38,0)
 ;                           subscript #4
"RTN","EASUER",39,0)
 ;       subscript piece 6 - subscript or DD node on which the data is stored.
"RTN","EASUER",40,0)
 ;       subscript piece 7 - string designating whether or not the data
"RTN","EASUER",41,0)
 ;                           is an "after" or "before" reflection of data.
"RTN","EASUER",42,0)
 ;
"RTN","EASUER",43,0)
 N VSIT,NODE,DFN,VDT
"RTN","EASUER",44,0)
 I '$D(^TMP("PXKCO",$J)) Q
"RTN","EASUER",45,0)
 S VSIT=$O(^TMP("PXKCO",$J,"")) Q:VSIT=""  ;ien of VISIT file
"RTN","EASUER",46,0)
 S NODE=$G(^AUPNVSIT(VSIT,0))
"RTN","EASUER",47,0)
 ;get Veteran's IEN and encounter date
"RTN","EASUER",48,0)
 S DFN=$P($G(NODE),"^",5),VDT=$P($G(NODE),"^",1)
"RTN","EASUER",49,0)
 S VDT=$$FY(VDT)
"RTN","EASUER",50,0)
 ;check current User Enrollee data and update if necessary
"RTN","EASUER",51,0)
 I $$UPDCHK(DFN,VDT) D FILE(DFN,VDT)
"RTN","EASUER",52,0)
 Q
"RTN","EASUER",53,0)
FBAUTH(FBDFN,FBTODT) ;This Enrollment api will be called from Fee basis
"RTN","EASUER",54,0)
 ;applications at the time of any fee basis authorization changes.
"RTN","EASUER",55,0)
 ;Input:         FBDFN  -  Veteran's ien
"RTN","EASUER",56,0)
 ;              FBTODT  -  Latest date of authorization.
"RTN","EASUER",57,0)
 ;
"RTN","EASUER",58,0)
 N XDT
"RTN","EASUER",59,0)
 S XDT=$$FY(FBTODT)
"RTN","EASUER",60,0)
 I $$UPDCHK(FBDFN,XDT) D FILE(FBDFN,XDT)
"RTN","EASUER",61,0)
 Q
"RTN","EASUER",62,0)
INP ;This Enrollment api will be called from DGPM MOVEMENT EVENT via 
"RTN","EASUER",63,0)
 ;EAS UE INP EVENT protocol whenever inpatient veteran is admitted,
"RTN","EASUER",64,0)
 ;transfered,discharged or any movement.
"RTN","EASUER",65,0)
 ;supported variables of this event:
"RTN","EASUER",66,0)
 ;       DFN  - Pointer to patient in PATIENT file (#2)
"RTN","EASUER",67,0)
 ;    DGPMDA  - Pointer to primary movement in PATIENT MOVEMENT file.
"RTN","EASUER",68,0)
 ;     DGPMP  - Zero node of primary movement prior to add/edit/del
"RTN","EASUER",69,0)
 ;     DGPMA  - Zero node of primary movement after add/edit/delete
"RTN","EASUER",70,0)
 ;
"RTN","EASUER",71,0)
 N XDT
"RTN","EASUER",72,0)
 I '$G(DFN)!'$G(DGPMDA) Q
"RTN","EASUER",73,0)
 S XDT=$P($G(^DGPM(DGPMDA,0)),"^")  ;Date of movement
"RTN","EASUER",74,0)
 S XDT=$$FY(XDT) I $$UPDCHK(DFN,XDT) D FILE(DFN,XDT)
"RTN","EASUER",75,0)
 Q
"RTN","EASUER",76,0)
UESTAT(DFN) ;This api will be called at the time of Annual MT renewal
"RTN","EASUER",77,0)
 ;process to check if veteran has UE status for current FY.
"RTN","EASUER",78,0)
 N UESTAT,UESITE,UESTN,CURSTN,PRNT
"RTN","EASUER",79,0)
 I '$G(DFN) Q 0  ;No DFN
"RTN","EASUER",80,0)
 S UESTAT=$P($G(^DPT(DFN,.361)),"^",7)
"RTN","EASUER",81,0)
 I UESTAT="" Q 0  ;Not User Enrollee
"RTN","EASUER",82,0)
 I UESTAT<$$FY(DT) Q 0  ;Not User Enrollee for current FY
"RTN","EASUER",83,0)
 S UESITE=$P($G(^DPT(DFN,.361)),"^",8) Q:+UESITE=0 0
"RTN","EASUER",84,0)
 S UESTN=$P($G(^DIC(4,UESITE,99)),"^")
"RTN","EASUER",85,0)
 S CURSTN=$P($$SITE^VASITE,"^",3)
"RTN","EASUER",86,0)
 S PRNT=$$PSITE(CURSTN),CURSTN=$P($G(^DIC(4,PRNT,99)),"^")
"RTN","EASUER",87,0)
 I UESTN'=CURSTN Q 2  ;Not same site
"RTN","EASUER",88,0)
 Q 1
"RTN","EASUER",89,0)
UPDCHK(DFN,APTDT) ;This api will determine whether to update User Enrollee data.
"RTN","EASUER",90,0)
 I '$G(DFN) Q 0  ;No DFN
"RTN","EASUER",91,0)
 I $P($G(^DPT(DFN,"VET")),"^")="N" Q 0  ;Quit if Non veteran
"RTN","EASUER",92,0)
 I APTDT<3030000 Q 0  ;Quit if APTDT is less than FY 2003
"RTN","EASUER",93,0)
 N CURSTAT
"RTN","EASUER",94,0)
 S CURSTAT=$P($G(^DPT(DFN,.361)),"^",7)
"RTN","EASUER",95,0)
 I APTDT>CURSTAT Q 1
"RTN","EASUER",96,0)
 Q 0
"RTN","EASUER",97,0)
FY(XDATE) ;Returns a fiscal year for the date
"RTN","EASUER",98,0)
 N ENFY S ENFY=""
"RTN","EASUER",99,0)
 I $G(XDATE)?7N.E S ENFY=$S($E(XDATE,4,5)<10:$E(XDATE,1,3),1:$E(XDATE,1,3)+1)
"RTN","EASUER",100,0)
 Q ENFY_"0000"
"RTN","EASUER",101,0)
 ;
"RTN","EASUER",102,0)
PSITE(STA) ;Get parent site IEN
"RTN","EASUER",103,0)
 N PRNT,STNTYP,VISNTYP,ATPRNT
"RTN","EASUER",104,0)
 ;
"RTN","EASUER",105,0)
 S ATPRNT=0
"RTN","EASUER",106,0)
 S PRNT=+$$PRNT^XUAF4(STA)
"RTN","EASUER",107,0)
 ;
"RTN","EASUER",108,0)
 I PRNT>0,$$CHKPRNT(PRNT) S PRNT=STA Q PRNT
"RTN","EASUER",109,0)
 I 'PRNT S PRNT=+$$PRNT^XUAF4($E($G(STA),1,3))
"RTN","EASUER",110,0)
 I $$CHKPRNT(PRNT) S PRNT=$E($G(STA),1,3) Q PRNT
"RTN","EASUER",111,0)
 I 'PRNT S PRNT=$O(^DIC(4,"D",$E($G(STA),1,3),""))
"RTN","EASUER",112,0)
 Q PRNT
"RTN","EASUER",113,0)
 ;
"RTN","EASUER",114,0)
CHKPRNT(PRNT) ; Check if parent is a VISN entity
"RTN","EASUER",115,0)
 N RSLT,STNTYP,VISNTYP
"RTN","EASUER",116,0)
 ;
"RTN","EASUER",117,0)
 ; Get the IEN for the facility type of "VISN" and then get the Facility type
"RTN","EASUER",118,0)
 ; for the station passed in.  If the station is a "VISN", return 1 else  return
"RTN","EASUER",119,0)
 ; a 0
"RTN","EASUER",120,0)
 ;
"RTN","EASUER",121,0)
 S VISNTYP=$O(^DIC(4.1,"B","VISN",0))
"RTN","EASUER",122,0)
 S STNTYP=$$GET1^DIQ(4,PRNT,13,"I")
"RTN","EASUER",123,0)
 I $G(VISNTYP)=$G(STNTYP) S RSLT=1
"RTN","EASUER",124,0)
 Q $G(RSLT)
"RTN","EASUER",125,0)
 ;
"RTN","EASUER",126,0)
FILE(XIEN,XDT) ;Update User Enrollee fields and queue Z07
"RTN","EASUER",127,0)
 N DATA,FILEUPD,SITE,PRNT,EVENT,IYR
"RTN","EASUER",128,0)
 S SITE=$$SITE^VASITE,SITE=$P($G(SITE),"^",3)
"RTN","EASUER",129,0)
 S PRNT=$$PSITE(SITE) Q:'+$G(PRNT)
"RTN","EASUER",130,0)
 S DATA(.3617)=XDT,DATA(.3618)=PRNT
"RTN","EASUER",131,0)
 I '$$UPD^DGENDBS(2,.XIEN,.DATA) Q
"RTN","EASUER",132,0)
 S IYR=$$INCYR(XIEN)
"RTN","EASUER",133,0)
 S EVENT("ENROLL")=1 I $$LOG^IVMPLOG(XIEN,IYR,.EVENT)
"RTN","EASUER",134,0)
 Q
"RTN","EASUER",135,0)
INCYR(XIEN) ;Get valid income year
"RTN","EASUER",136,0)
 ;N INCYR,LMT,R3015,I,TEMP
"RTN","EASUER",137,0)
 I $D(^IVM(301.5,"APT",XIEN)) D  Q INCYR
"RTN","EASUER",138,0)
 . S INCYR=$O(^IVM(301.5,"APT",XIEN,""),-1)
"RTN","EASUER",139,0)
 F I=1,2,4 D
"RTN","EASUER",140,0)
 . S LMT=$$LST^DGMTU(XIEN,,I)
"RTN","EASUER",141,0)
 . I +$G(LMT) S TEMP($P(LMT,"^",2))=""
"RTN","EASUER",142,0)
 I $D(TEMP) S LMT=$O(TEMP(""),-1),INCYR=($E(LMT,1,3)-1)_"0000" Q INCYR
"RTN","EASUER",143,0)
 S INCYR=($E(DT,1,3)-1)_"0000"
"RTN","EASUER",144,0)
 Q INCYR
"VER")
8.0^22
**END**
**END**
