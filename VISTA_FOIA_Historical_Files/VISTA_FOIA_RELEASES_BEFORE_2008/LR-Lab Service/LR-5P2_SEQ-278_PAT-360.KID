Released LR*5.2*360 SEQ #278
Extracted from mail message
**KIDS**:LR*5.2*360^

**INSTALL NAME**
LR*5.2*360
"BLD",6824,0)
LR*5.2*360^LAB SERVICE^0^3061005^y
"BLD",6824,1,0)
^^6^6^3060712^
"BLD",6824,1,1,0)
This patch addresses several issues with accessioning. This patch will
"BLD",6824,1,2,0)
prevent the re-accessioning of accessioned and the accessioned part of 
"BLD",6824,1,3,0)
partly accessioned lab orders. It will not allow the input of order
"BLD",6824,1,4,0)
numbers exceeding eight characters in length. It adds to chemistry and 
"BLD",6824,1,5,0)
microbiology accessioning (both standard and batch) a warning message the 
"BLD",6824,1,6,0)
patient the test is for has died and the patient's date of death.
"BLD",6824,4,0)
^9.64PA^^
"BLD",6824,6)
8^
"BLD",6824,6.3)
1
"BLD",6824,"ABPKG")
n
"BLD",6824,"KRN",0)
^9.67PA^8989.52^19
"BLD",6824,"KRN",.4,0)
.4
"BLD",6824,"KRN",.401,0)
.401
"BLD",6824,"KRN",.402,0)
.402
"BLD",6824,"KRN",.403,0)
.403
"BLD",6824,"KRN",.5,0)
.5
"BLD",6824,"KRN",.84,0)
.84
"BLD",6824,"KRN",3.6,0)
3.6
"BLD",6824,"KRN",3.8,0)
3.8
"BLD",6824,"KRN",9.2,0)
9.2
"BLD",6824,"KRN",9.8,0)
9.8
"BLD",6824,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6824,"KRN",9.8,"NM",1,0)
LROE^^0^B34568741
"BLD",6824,"KRN",9.8,"NM",2,0)
LRX^^0^B57348907
"BLD",6824,"KRN",9.8,"NM",3,0)
LRDPA^^0^B27232185
"BLD",6824,"KRN",9.8,"NM","B","LRDPA",3)

"BLD",6824,"KRN",9.8,"NM","B","LROE",1)

"BLD",6824,"KRN",9.8,"NM","B","LRX",2)

"BLD",6824,"KRN",19,0)
19
"BLD",6824,"KRN",19,"NM",0)
^9.68A^^
"BLD",6824,"KRN",19.1,0)
19.1
"BLD",6824,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6824,"KRN",101,0)
101
"BLD",6824,"KRN",409.61,0)
409.61
"BLD",6824,"KRN",771,0)
771
"BLD",6824,"KRN",870,0)
870
"BLD",6824,"KRN",870,"NM",0)
^9.68A^^
"BLD",6824,"KRN",8989.51,0)
8989.51
"BLD",6824,"KRN",8989.52,0)
8989.52
"BLD",6824,"KRN",8994,0)
8994
"BLD",6824,"KRN","B",.4,.4)

"BLD",6824,"KRN","B",.401,.401)

"BLD",6824,"KRN","B",.402,.402)

"BLD",6824,"KRN","B",.403,.403)

"BLD",6824,"KRN","B",.5,.5)

"BLD",6824,"KRN","B",.84,.84)

"BLD",6824,"KRN","B",3.6,3.6)

"BLD",6824,"KRN","B",3.8,3.8)

"BLD",6824,"KRN","B",9.2,9.2)

"BLD",6824,"KRN","B",9.8,9.8)

"BLD",6824,"KRN","B",19,19)

"BLD",6824,"KRN","B",19.1,19.1)

"BLD",6824,"KRN","B",101,101)

"BLD",6824,"KRN","B",409.61,409.61)

"BLD",6824,"KRN","B",771,771)

"BLD",6824,"KRN","B",870,870)

"BLD",6824,"KRN","B",8989.51,8989.51)

"BLD",6824,"KRN","B",8989.52,8989.52)

"BLD",6824,"KRN","B",8994,8994)

"BLD",6824,"QUES",0)
^9.62^^
"BLD",6824,"REQB",0)
^9.611^3^3
"BLD",6824,"REQB",1,0)
LR*5.2*286^2
"BLD",6824,"REQB",2,0)
LR*5.2*290^2
"BLD",6824,"REQB",3,0)
LR*5.2*305^2
"BLD",6824,"REQB","B","LR*5.2*286",1)

"BLD",6824,"REQB","B","LR*5.2*290",2)

"BLD",6824,"REQB","B","LR*5.2*305",3)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
360^3061005^33274
"PKG",26,22,1,"PAH",1,1,0)
^^6^6^3061005
"PKG",26,22,1,"PAH",1,1,1,0)
This patch addresses several issues with accessioning. This patch will
"PKG",26,22,1,"PAH",1,1,2,0)
prevent the re-accessioning of accessioned and the accessioned part of 
"PKG",26,22,1,"PAH",1,1,3,0)
partly accessioned lab orders. It will not allow the input of order
"PKG",26,22,1,"PAH",1,1,4,0)
numbers exceeding eight characters in length. It adds to chemistry and 
"PKG",26,22,1,"PAH",1,1,5,0)
microbiology accessioning (both standard and batch) a warning message the 
"PKG",26,22,1,"PAH",1,1,6,0)
patient the test is for has died and the patient's date of death.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","LRDPA")
0^3^B27232185^B24730842
"RTN","LRDPA",1,0)
LRDPA ;SLC/RWF/WTY/KLL - FILE OF FILES LOOKUP ON ENTITIES ; 2/28/03 4:10pm
"RTN","LRDPA",2,0)
 ;;5.2;LAB SERVICE;**137,121,153,202,211,248,305,360**;Sep 27, 1994;Build 1
"RTN","LRDPA",3,0)
 ;
"RTN","LRDPA",4,0)
 ;Reference to ^DIC( supported by IA #916
"RTN","LRDPA",5,0)
 ;Reference to ^DIC("AC" supported by IA #511
"RTN","LRDPA",6,0)
 ;Reference to ^ORD(100.99 supported by IA #2414
"RTN","LRDPA",7,0)
 ;Reference to ^DIC supported by IA #10006
"RTN","LRDPA",8,0)
 ;Reference to LK^ORX2 supported by IA #867
"RTN","LRDPA",9,0)
 ;Reference to ULK^ORX2 supported by IA #867
"RTN","LRDPA",10,0)
 ;Reference to $$DTIME^XUP supported by IA # -none available-
"RTN","LRDPA",11,0)
 ;Reference to EN^DDIOL supported by IA #10142
"RTN","LRDPA",12,0)
 ;
"RTN","LRDPA",13,0)
 ;IF '$D(DIC) USE PATIENT FILE, ALLOW "FILE:NAME" EXTENDED SYNTAX
"RTN","LRDPA",14,0)
 ;IF DIC=0 ASK FILE NAME, IF PATIENT FILE, USE DPA, 
"RTN","LRDPA",15,0)
 ;  OTHERWISE ^DIC LOOK-UP
"RTN","LRDPA",16,0)
 ;IF DIC=N^GLOBAL, LOOK-UP ON FILE N
"RTN","LRDPA",17,0)
 ;RETURN (DFN,Y)=IFN, LRDPF=N^GLOBAL, '$D(DIC), LRDFN=IFN OF ^LR 
"RTN","LRDPA",18,0)
 ; GLOBAL  PNM=NAME,SSN=SSN,SSN(1)=LAST4,SSN(2)=SSN WITHOUT '-'
"RTN","LRDPA",19,0)
 ;ROUTINE SSN^LRU CONTROLS SSN FORMAT
"RTN","LRDPA",20,0)
 ;ALSO WILL RETURN LRLABKY variable if not defined.
"RTN","LRDPA",21,0)
 ;LRLOOKUP=1 blocks ability to add new entries (lookup only)
"RTN","LRDPA",22,0)
 S:$G(LRREFFL) DIC="67^LRT(67"
"RTN","LRDPA",23,0)
 G:$G(LRORDRR)="R" ^LRDPAREF
"RTN","LRDPA",24,0)
 S X="",U="^",DTIME=$$DTIME^XUP(DUZ)
"RTN","LRDPA",25,0)
 S DIC(0)=$S('$D(DIC(0)):"EMQZ",DIC(0)["A":"EMQZ",1:DIC(0))
"RTN","LRDPA",26,0)
 S:DIC(0)'["Z" DIC(0)=DIC(0)_"Z"
"RTN","LRDPA",27,0)
 K DLAYGO I '($D(DIC)[0),DIC'=0,'$P(DIC,"^") S DIC=0
"RTN","LRDPA",28,0)
DPA ;from LRUPS
"RTN","LRDPA",29,0)
 D:'$D(LRLABKY) LABKEY^LRPARAM
"RTN","LRDPA",30,0)
 K VADM,VAIN,VA
"RTN","LRDPA",31,0)
 S LRDPF="" G ANY:'($D(DIC)[0)
"RTN","LRDPA",32,0)
 R !,"Select Patient Name: ",X:DTIME
"RTN","LRDPA",33,0)
DPA1 ;Entry point from PNAME^LRAPDA
"RTN","LRDPA",34,0)
 I X'?1"%"9N.E,X=""!(X["^") S DFN=-1 K DLAYGO G END
"RTN","LRDPA",35,0)
 ;The X'?1"%"9N.E was added since the VIC data stream contains a carat.
"RTN","LRDPA",36,0)
 I X="??" W !,"You may enter patient identification or enter a file name followed by "":"".",!,"You may enter ""?:?"" for more extended help." G DPA
"RTN","LRDPA",37,0)
EN1 ;from LRUG, LRUPS
"RTN","LRDPA",38,0)
 I X[":" S LRX=$P(X,":",2),X=$P(X,":",1),DIC=0 K:LRX="" LRX G ANY:X=""!(X["?") W !," File: ",X G FL
"RTN","LRDPA",39,0)
EN ;
"RTN","LRDPA",40,0)
 S:DIC(0)'["Z" DIC(0)=DIC(0)_"Z"
"RTN","LRDPA",41,0)
 S DIC="^DPT(",LRDPF="2^DPT(",VA200=""
"RTN","LRDPA",42,0)
 ; DLAYGO not allowed for DPT( on first pass
"RTN","LRDPA",43,0)
 S DIC("S")="S:X?1""%""9N.E1""?"" X=$E(X,2,10) I 1"
"RTN","LRDPA",44,0)
 ;The DIC("S") was added to preprocess any data from a VIC card. The VIC
"RTN","LRDPA",45,0)
 ;card data has guard codes before and after the patient data. The SSN
"RTN","LRDPA",46,0)
 ;is extracted if these guard codes exist. DIC("S") was added in several
"RTN","LRDPA",47,0)
 ;places and in all instances it is being killed immediately after use.
"RTN","LRDPA",48,0)
 D ^DIC K DIC("S"),DLAYGO K:Y>0 DUOUT
"RTN","LRDPA",49,0)
 ;Since VIC card data contains carats, DUOUT will be returned whenever
"RTN","LRDPA",50,0)
 ;the VIC card is used.  If the user ^'s out, Y will be equal to -1.
"RTN","LRDPA",51,0)
 ;If Y is greater than 0 the data is valid and DUOUT should be ignored.
"RTN","LRDPA",52,0)
 I Y<1 K DIC D LAYG G DPA
"RTN","LRDPA",53,0)
 S DFN=+Y,PNM=$P(Y(0),"^") D PT^LRX D:DOD'="" WARN G END
"RTN","LRDPA",54,0)
 ;
"RTN","LRDPA",55,0)
LAYG ;Don't allow DLAYGO on second pass.
"RTN","LRDPA",56,0)
 K DLAYGO S DIC(0)="EQMZ" Q
"RTN","LRDPA",57,0)
 Q:'$P($G(LRPARAM),"^",6)
"RTN","LRDPA",58,0)
 Q:'$D(LRLABKY)
"RTN","LRDPA",59,0)
 S DLAYGO=2 S DIC(0)="EQMZL"
"RTN","LRDPA",60,0)
 Q
"RTN","LRDPA",61,0)
ANY S:DIC'=0 LRDPF=+DIC_^DIC(+DIC,0,"GL") G FL1:DIC'=0 D FILE
"RTN","LRDPA",62,0)
 G NONE:Y=-1,FL0
"RTN","LRDPA",63,0)
 ;
"RTN","LRDPA",64,0)
FL S DIC="^DIC(",DIC(0)=$S(X]"":"EMQZ",1:"AEMQZ"),DIC("S")="I $D(^DIC(""AC"",""LR"",+Y))" D ^DIC G NONE:Y=-1
"RTN","LRDPA",65,0)
FL0 S LRDPF=+Y_^DIC(+Y,0,"GL"),DIC=LRDPF I +$G(LRDPF)=2 K DIC G LRDPA
"RTN","LRDPA",66,0)
FL1 ;
"RTN","LRDPA",67,0)
 D:'$D(LRLABKY) LABKEY^LRPARAM
"RTN","LRDPA",68,0)
 ;DLAYGO not allowed for DPT(
"RTN","LRDPA",69,0)
 I +LRDPF'=2,'$G(LRLOOKUP) S DLAYGO=+LRDPF
"RTN","LRDPA",70,0)
 S DIC="^"_$P(LRDPF,"^",2),DIC(0)=$S($D(LRX):"EMQZ",1:"AEMQZ")
"RTN","LRDPA",71,0)
 I '$G(LRLOOKUP) D
"RTN","LRDPA",72,0)
 .S DIC(0)=DIC(0)_$S(+LRDPF>60&(+LRDPF<70)&$D(LRLABKY):"L",+LRDPF>1000:"L",1:"")
"RTN","LRDPA",73,0)
 .S:DIC(0)["L" DLAYGO=+LRDPF
"RTN","LRDPA",74,0)
 S:$D(LRX) X=LRX K LRX,DIC("S")
"RTN","LRDPA",75,0)
 I X["?" S DIC("S")="S:X?1""%""9N.E1""?"" X=$E(X,2,10) I 1" D ^DIC K DIC("S") K:Y>0 DUOUT S:DIC(0)'["A" DIC(0)=DIC(0)_"A"
"RTN","LRDPA",76,0)
 W:DIC(0)'["A" "   Entry: ",X
"RTN","LRDPA",77,0)
 S DIC("S")="S:X?1""%""9N.E1""?"" X=$E(X,2,10) I 1"
"RTN","LRDPA",78,0)
 S:DIC="^LAB(62.3," DIC("S")=DIC("S")_" "_"I '$P(^LAB(62.3,Y,0),U,4)"
"RTN","LRDPA",79,0)
 D ^DIC K DIC("S") G NONE:Y=-1 S DFN=+Y,PNM=$P(Y(0),"^") D PT^LRX
"RTN","LRDPA",80,0)
 G END
"RTN","LRDPA",81,0)
NONE S Y=-1,DFN=-1,LRDFN=-1,LRDPF="0^NULL("
"RTN","LRDPA",82,0)
 K DIC,VAIN,VADM,VA S VA200="" Q
"RTN","LRDPA",83,0)
 Q
"RTN","LRDPA",84,0)
REASK S DFN=-1,DIC("S")="S:X?1""%""9N.E1""?"" X=$E(X,2,10) I 1",DIC(0)=DIC(0)_"A"
"RTN","LRDPA",85,0)
 D ^DIC K:Y>0 DUOUT K DIC("S") G:Y<1 END S DFN=+Y,PNM=$P(Y(0),"^") D PT^LRX
"RTN","LRDPA",86,0)
END ;from LROR, LRSETUP
"RTN","LRDPA",87,0)
 S:'$D(DFN) DFN=-1 S Y=DFN
"RTN","LRDPA",88,0)
 I DFN=-1 D  Q
"RTN","LRDPA",89,0)
 .S LRDFN=-1 K DIC,DLAYGO S VA200=""
"RTN","LRDPA",90,0)
 S X="^"_$P(LRDPF,"^",2)_Y_",""LR"")",LRDFN=+$S($D(@X):@X,1:-1)
"RTN","LRDPA",91,0)
 G E3:LRDFN>0
"RTN","LRDPA",92,0)
 L +^LR(0):5 I '$T D  Q
"RTN","LRDPA",93,0)
 .S MSG="The LAB DATA file is locked.  Please try again later."
"RTN","LRDPA",94,0)
 .D EN^DDIOL(MSG,"","!!") K MSG
"RTN","LRDPA",95,0)
 .S (DFN,LRDFN)=-1,VA200=""
"RTN","LRDPA",96,0)
 .K DIC,DLAYGO
"RTN","LRDPA",97,0)
 S LRDFN=$P(^LR(0),"^",3)+1
"RTN","LRDPA",98,0)
 I $D(@X) L -^LR(0) K DIC,DLAYGO G LRDPA
"RTN","LRDPA",99,0)
E2 I $D(^LR(LRDFN)) S LRDFN=LRDFN+1 G E2
"RTN","LRDPA",100,0)
 S ^LR(LRDFN,0)=LRDFN_"^"_+LRDPF_"^"_DFN,@X=LRDFN,^(0)=$P(^LR(0),"^",1,2)_"^"_LRDFN_"^"_(1+$P(^(0),"^",4)),^LR("B",LRDFN,LRDFN)="" L -^LR(0)
"RTN","LRDPA",101,0)
E3 I '$D(^LR(LRDFN,0))#2 W !!,"Internal patient ID incorrect in ^LR( for ",PNM,".  Contact Lab Coordinator.",$C(7) S LRDFN=-1 Q
"RTN","LRDPA",102,0)
 I LRDFN>0,$P(^LR(LRDFN,0),"^",2)'=+LRDPF!($P(^(0),"^",3)'=DFN) W !,$C(7),"Internal patient ID incorrect for ",PNM,".  Contact Lab Coordinator." S LRDFN=-1 Q
"RTN","LRDPA",103,0)
 D INF^LRX
"RTN","LRDPA",104,0)
 D ^LRDPA1:($D(LRDPAF)&(LRDFN>0)) K DIC,DLAYGO S VA200=""
"RTN","LRDPA",105,0)
 I DFN,$P($G(^ORD(100.99,1,"CONV")),"^")=0 D EN^LR7OV2(DFN_";"_$P(LRDPF,"^",2),1)
"RTN","LRDPA",106,0)
 Q
"RTN","LRDPA",107,0)
 ;
"RTN","LRDPA",108,0)
FILE I X'["?" W !,"Select FILE: " R X:DTIME I X["^"!(X="") S X="",Y=-1 Q
"RTN","LRDPA",109,0)
 D DICQ:X["?" G FILE:X=""
"RTN","LRDPA",110,0)
 S DIC="^DIC(",DIC(0)="EMQZ"
"RTN","LRDPA",111,0)
 S DIC("S")="I $D(^DIC(""AC"",""LR"",+Y)),+Y'=44"
"RTN","LRDPA",112,0)
 D ^DIC K DIC("S") I Y=-1 G FILE
"RTN","LRDPA",113,0)
 Q
"RTN","LRDPA",114,0)
DICQ ;
"RTN","LRDPA",115,0)
 S DIC="^DIC(",DIC(0)="EQZ",D="AC",X="LR"
"RTN","LRDPA",116,0)
 S DIC("S")="I +Y'=44"  D IX^DIC
"RTN","LRDPA",117,0)
 I Y=-1 S X="" Q
"RTN","LRDPA",118,0)
 S X=Y(0,0)
"RTN","LRDPA",119,0)
 K D,DIC S Y=1
"RTN","LRDPA",120,0)
 Q
"RTN","LRDPA",121,0)
% R %:DTIME Q:%=""!(%["N")!(%["Y")  W !,"Answer 'Y' or 'N': " G %
"RTN","LRDPA",122,0)
 ;
"RTN","LRDPA",123,0)
EN2(DFN,LOCK,TALK) ;Patient Lock
"RTN","LRDPA",124,0)
 ;TALK 1:write, 0:silent
"RTN","LRDPA",125,0)
 ;LOCK 1:lock, 0:unlock
"RTN","LRDPA",126,0)
 Q:'$G(DFN)
"RTN","LRDPA",127,0)
 S:'$D(LOCK) LOCK=0 S:'$D(TALK) TALK=0
"RTN","LRDPA",128,0)
 S X=DFN_";DPT("
"RTN","LRDPA",129,0)
 I LOCK D LK^ORX2
"RTN","LRDPA",130,0)
 I 'LOCK D ULK^ORX2
"RTN","LRDPA",131,0)
 Q
"RTN","LRDPA",132,0)
WARN ;Warn the user the patient has died and display date of death (LR*5.2*360)
"RTN","LRDPA",133,0)
 S Y=DOD D DD^LRX
"RTN","LRDPA",134,0)
 W !?10,@LRVIDO,"Patient ",PNM," died on: ",Y,@LRVIDOF,!
"RTN","LRDPA",135,0)
 S DIR(0)="Y"
"RTN","LRDPA",136,0)
 S DIR("A")="Do you wish to continue with this patient [Yes/No]"
"RTN","LRDPA",137,0)
 S DIR("T")=120
"RTN","LRDPA",138,0)
 D ^DIR K DIR
"RTN","LRDPA",139,0)
 I Y=0!($D(DIRUT)) S DFN=-1
"RTN","LRDPA",140,0)
 K DIRUT
"RTN","LRDPA",141,0)
 Q
"RTN","LROE")
0^1^B34568741^B30204534
"RTN","LROE",1,0)
LROE ;DALOI/CJS/FHS-LAB ORDER ENTRY AND ACCESSION ;8/11/97
"RTN","LROE",2,0)
 ;;5.2;LAB SERVICE;**100,121,201,221,263,286,360**;Sep 27, 1994;Build 1
"RTN","LROE",3,0)
 K LRORIFN,LRNATURE,LREND,LRORDRR
"RTN","LROE",4,0)
 S LRLWC="WC"
"RTN","LROE",5,0)
 D ^LRPARAM
"RTN","LROE",6,0)
 I $G(LREND) S LREND=0 Q
"RTN","LROE",7,0)
L5 ;
"RTN","LROE",8,0)
NEXT ;from LROE1
"RTN","LROE",9,0)
 K DIR
"RTN","LROE",10,0)
 I $D(LROESTAT) D:$P(LRPARAM,U,14) ^LRCAPV I $G(LREND) K LRLONG,LRPANEL Q
"RTN","LROE",11,0)
 S (LRODT,X,DT)=$$DT^XLFDT(),LRODT0=$$FMTE^XLFDT(DT,5)
"RTN","LROE",12,0)
 I '$D(^LRO(69,DT,1,0)) S ^LRO(69,DT,0)=DT,^LRO(69,DT,1,0)="^69.01PA^^",^LRO(69,"B",DT,DT)=""
"RTN","LROE",13,0)
 I $D(^LAB(69.9,1,"RO")),+$H'=+$P(^("RO"),U) D
"RTN","LROE",14,0)
 . W $C(7),!,"ROLLOVER ",$S($P(^("RO"),U,2):"IS RUNNING.",1:"HAS NOT RUN.")," ACCESSIONING SHOULDN'T BE DONE NOW.",$C(7),!
"RTN","LROE",15,0)
 . S DIR("A")="  Are you sure you want to continue",DIR(0)="Y",DIR("B")="No"
"RTN","LROE",16,0)
 I $T D ^DIR G END:$D(DIRUT) I Y'=1 W !,"OK, try later." Q
"RTN","LROE",17,0)
 S X="T-7",%DT="" D ^%DT S LRTM7=+Y
"RTN","LROE",18,0)
 ;W @IOF
"RTN","LROE",19,0)
 K DIC,LRSND,LRSN
"RTN","LROE",20,0)
 W !!,"Select Order number: " R LRORD:DTIME Q:LRORD["^"!(LRORD[".")!($D(LRLONG)&(LRORD=""))
"RTN","LROE",21,0)
 W @IOF S M9=0 G QUICK^LROE1:LRORD=""
"RTN","LROE",22,0)
 I $L(LRORD)>8 W !,"The order number entered is too long." H 1 G NEXT
"RTN","LROE",23,0)
 S:LRORD?.N LRORD=+LRORD IF LRORD'?.N D QMSG G NEXT
"RTN","LROE",24,0)
 I '$D(^LRO(69,"C",LRORD)) W !!?10,"No order exist with that number ",$C(7),! G NEXT
"RTN","LROE",25,0)
 S (LRCHK,LRNONE)=1,(M9,LRODT)=0
"RTN","LROE",26,0)
 F  S LRODT=+$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1  D
"RTN","LROE",27,0)
 . S DA=0 F  S DA=$O(^LRO(69,"C",LRORD,LRODT,DA)) Q:DA<1  S LRCHK=LRCHK-1 S:LRNONE'=2 LRNONE=0 D LROE2
"RTN","LROE",28,0)
 I DOD'="" S Y=DOD D DD^LRX W !,!,?5,@LRVIDO,"Patient ",PNM," died on: ",Y,@LRVIDOF W !
"RTN","LROE",29,0)
 I DOD'="" D  I Y=0!($D(DIRUT)) K DIRUT,DTOUT,DUOUT,Y D KVAR^LRX G NEXT
"RTN","LROE",30,0)
 . K Y
"RTN","LROE",31,0)
 . S DIR(0)="Y"
"RTN","LROE",32,0)
 . S DIR("A")="Do you wish to continue with this accession [Yes/No]"
"RTN","LROE",33,0)
 . S DIR("T")=120
"RTN","LROE",34,0)
 . D ^DIR K DIR
"RTN","LROE",35,0)
 I LRNONE=2,LRCHK<1 W !,"The order has already been partially accessioned." H 1
"RTN","LROE",36,0)
 I LRNONE=2,LRCHK>0 W !,"The order has already been accessioned." H 1 G NEXT
"RTN","LROE",37,0)
 I LRNONE=1 W !,"No order exists with that number." H 1 G NEXT
"RTN","LROE",38,0)
 I '$$GOT(LRORD,LRODT) G NEXT ;W !!,"All tests for this order have been canceled.",!,"Are you sure you want to accession it" S %=1 D YN^DICN I %'=1 G NEXT
"RTN","LROE",39,0)
 K DIR S DIR("A")="Is this the correct order",DIR(0)="Y"
"RTN","LROE",40,0)
 S DIR("B")="Yes"
"RTN","LROE",41,0)
 D ^DIR K DIR
"RTN","LROE",42,0)
 I $D(DIRUT)!(Y'=1) K LRSN G NEXT
"RTN","LROE",43,0)
 L +^LRO(69,"C",LRORD):1
"RTN","LROE",44,0)
 I '$T W !?5,"Someone else is editing this Order",!!,$C(7) G NEXT
"RTN","LROE",45,0)
 K %DT
"RTN","LROE",46,0)
 S LRSTATUS="C",%DT("B")=""
"RTN","LROE",47,0)
 D TIME K %DT
"RTN","LROE",48,0)
 D:$G(LRCDT)<1 UNL69 G NEXT:LRCDT<1
"RTN","LROE",49,0)
 S LRTIM=+LRCDT
"RTN","LROE",50,0)
 ;S:'$P(^LRO(69,LRODT,1,LRSN,0),U,8) $P(^(0),U,8)=LRTIM
"RTN","LROE",51,0)
 S LRUN=$P(LRCDT,U,2) K LRCDT,LRSN
"RTN","LROE",52,0)
MORE I M9>1 K DIR S DIR("A")="Do you have the entire order",DIR(0)="Y" D ^DIR K DIR S:Y=1 M9=0
"RTN","LROE",53,0)
 I $D(DIRUT) D UNL69 G NEXT
"RTN","LROE",54,0)
 S (LRODT,LRSND)=0
"RTN","LROE",55,0)
 F  S LRODT=$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1  D
"RTN","LROE",56,0)
 . S LRSND=0
"RTN","LROE",57,0)
 . F  S LRSND=$O(^LRO(69,"C",LRORD,LRODT,LRSND)) Q:LRSND<1  D
"RTN","LROE",58,0)
 . . I $D(^LRO(69,LRODT,1,LRSND,1)),$P(^(1),U,4)="C" Q
"RTN","LROE",59,0)
 . . S LRSN(LRSND)=LRSND,LRSN=LRSND
"RTN","LROE",60,0)
 . . K LRAA D Q15^LROE2 K LRSN
"RTN","LROE",61,0)
 D TASK,UNL69
"RTN","LROE",62,0)
 G NEXT
"RTN","LROE",63,0)
 ;
"RTN","LROE",64,0)
 ;
"RTN","LROE",65,0)
LROE2 ;
"RTN","LROE",66,0)
 I $D(^LRO(69,LRODT,1,DA,1)),$P(^(1),U,4)="C" S LRNONE=2,LRCHK=LRCHK+1
"RTN","LROE",67,0)
 K LRSN
"RTN","LROE",68,0)
 S (LRSN,LRSN(DA))=+DA
"RTN","LROE",69,0)
 I '$D(^LRO(69,LRODT,1,LRSN,0)) Q
"RTN","LROE",70,0)
 S M9=$G(M9)+1,LRZX=^LRO(69,LRODT,1,LRSN,0),LRDFN=+LRZX,LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3) D PT^LRX W !,PNM,?30,SSN S LRWRDS=LRWRD
"RTN","LROE",71,0)
 W ?45,"Requesting location: ",$P(LRZX,U,7) S Y=$P(LRZX,U,5) D DD^LRX W !,"Date/Time Ordered: ",Y,?45,"By: ",$S($D(^VA(200,+$P(LRZX,U,2),0)):$P(^(0),U),1:"")
"RTN","LROE",72,0)
 S LRSVSN=LRSN D ORDER^LROS S LRSN=LRSVSN
"RTN","LROE",73,0)
 Q
"RTN","LROE",74,0)
 ;
"RTN","LROE",75,0)
 ;
"RTN","LROE",76,0)
QMSG W !,"Enter the order entry number assigned when the test was ordered."
"RTN","LROE",77,0)
 W:'$D(LRLONG) !,"If the test has not been ordered, type the RETURN key to order the test."
"RTN","LROE",78,0)
 W !,"To exit, type the ""^"" key and RETURN key."
"RTN","LROE",79,0)
 Q
"RTN","LROE",80,0)
 ;
"RTN","LROE",81,0)
 ;
"RTN","LROE",82,0)
YN R X:DTIME S:'$T DTOUT=1 Q:X=""!(X["N")!(X["Y")
"RTN","LROE",83,0)
 W !,"Answer 'Y' or 'N': " G YN
"RTN","LROE",84,0)
 ;
"RTN","LROE",85,0)
 ;
"RTN","LROE",86,0)
EN ;
"RTN","LROE",87,0)
LROEN S LRNCWL=1
"RTN","LROE",88,0)
 D LROE,END K LRNCWL
"RTN","LROE",89,0)
 Q
"RTN","LROE",90,0)
 ;
"RTN","LROE",91,0)
 ;
"RTN","LROE",92,0)
EN01 ; ENTER ORDER # THEN ENTER DATA
"RTN","LROE",93,0)
STAT ;
"RTN","LROE",94,0)
 D ^LRPARAM
"RTN","LROE",95,0)
 I '$D(LRLABKY) W !!?10,"You do not have the proper security Keys",! Q
"RTN","LROE",96,0)
 ;
"RTN","LROE",97,0)
 ; Select peforming laboratory
"RTN","LROE",98,0)
 S X=$$SELPL^LRVERA(DUZ(2))
"RTN","LROE",99,0)
 I X<1 D END Q
"RTN","LROE",100,0)
 I X'=DUZ(2) N LRPL S LRPL=X
"RTN","LROE",101,0)
 ;
"RTN","LROE",102,0)
 S LRLONG="",LRPANEL=0,LROESTAT=""
"RTN","LROE",103,0)
 S %H=$H-60 D YMD^LRX S LRTM60=9999999-X
"RTN","LROE",104,0)
 D LROE K LRTM60,LRLONG,LREND,LROESTAT
"RTN","LROE",105,0)
 D END
"RTN","LROE",106,0)
 Q
"RTN","LROE",107,0)
 ;
"RTN","LROE",108,0)
 ;
"RTN","LROE",109,0)
TIME ;from LROE1, LRORD1
"RTN","LROE",110,0)
 S %DT="SET" W !,"Collection Date@Time: ",$S($D(%DT("B")):%DT("B"),1:"NOW"),"//" R X:DTIME I '$T!(X="^") S LRCDT=-1 Q
"RTN","LROE",111,0)
 S:X="" X=$S($D(%DT("B")):%DT("B"),1:"N")
"RTN","LROE",112,0)
 W:X["?" !!,"You may enter ""T@U"" or just ""U"", for Today at Unknown time",!!
"RTN","LROE",113,0)
 I X["@U",$P(X,"@U",2)="" S X=$P(X,"@U",1) D ^%DT G TIME:Y<1 S LRCDT=+Y_"^1" Q
"RTN","LROE",114,0)
 S:X="U" LRCDT=DT_"^1"
"RTN","LROE",115,0)
 I X'="U" D ^%DT D:X'["?" TIME1 G TIME:X["?" S LRCDT=+Y_"^" G TIME:Y'["."
"RTN","LROE",116,0)
 Q
"RTN","LROE",117,0)
 ;
"RTN","LROE",118,0)
TIME1 S X1=X,Y1=Y D TIME2 S X=X1,Y=Y1 K X1,Y1
"RTN","LROE",119,0)
 Q
"RTN","LROE",120,0)
 ;
"RTN","LROE",121,0)
TIME2 S X="N",%DT="ST" D ^%DT Q:Y1'>Y  F  W !,"You have specified a collection time in the future.  Are you sure" S %=2 D YN^DICN Q:%  W !,"Answer 'Y'es or 'N'o."
"RTN","LROE",122,0)
 S:%'=1 X="?" S X1=X
"RTN","LROE",123,0)
 Q
"RTN","LROE",124,0)
 ;
"RTN","LROE",125,0)
 ;
"RTN","LROE",126,0)
TASK ;
"RTN","LROE",127,0)
 I $D(LRLABLIO),$D(LRLBL) S ZTRTN="ENT^LRLABLD",ZTDTH=$H,ZTDESC="LAB LABELS",ZTIO=LRLABLIO,ZTSAVE("LRLBL(")="" D ^%ZTLOAD
"RTN","LROE",128,0)
 K LRLBL
"RTN","LROE",129,0)
 I $D(LRCSQ),'$O(^XTMP("LRCAP",LRCSQ,DUZ,0)) K ^XTMP("LRCAP",LRCSQ,DUZ),LRCSQ
"RTN","LROE",130,0)
 I $D(LRCSQ),$P($G(^LRO(68,+LRAA,0)),U,16) D STD^LRCAPV
"RTN","LROE",131,0)
 D STOP^LRCAPV K LRCOM,LRSPCDSC,LRCCOM,LRTCOM
"RTN","LROE",132,0)
 Q
"RTN","LROE",133,0)
 ;
"RTN","LROE",134,0)
 ;
"RTN","LROE",135,0)
END K DIR,DIRUT,GOT
"RTN","LROE",136,0)
 D ^LRORDK,LROEND^LRORDK,STOP^LRCAPV
"RTN","LROE",137,0)
 Q
"RTN","LROE",138,0)
 ;
"RTN","LROE",139,0)
 ;
"RTN","LROE",140,0)
GOT(ORD,ODT) ;See if all tests have been canceled
"RTN","LROE",141,0)
 N I,SN,ODT
"RTN","LROE",142,0)
 S (GOT,ODT,SN)=0
"RTN","LROE",143,0)
 F  S ODT=$O(^LRO(69,"C",ORD,ODT)) Q:ODT<1  D
"RTN","LROE",144,0)
 . S SN=0 F  S SN=$O(^LRO(69,"C",ORD,ODT,SN)) Q:SN<1!(GOT)  D
"RTN","LROE",145,0)
 . . Q:'$D(^LRO(69,ODT,1,SN,0))
"RTN","LROE",146,0)
 . . S I=0 F  S I=$O(^LRO(69,ODT,1,SN,2,I)) Q:I<1  I $D(^(I,0)),'$P(^(0),"^",11) S GOT=1 Q
"RTN","LROE",147,0)
 Q GOT
"RTN","LROE",148,0)
 ;
"RTN","LROE",149,0)
 ;
"RTN","LROE",150,0)
UNL69 ;
"RTN","LROE",151,0)
 L -^LRO(69,"C",+$G(LRORD))
"RTN","LROE",152,0)
 Q
"RTN","LRX")
0^2^B57348907^B56896675
"RTN","LRX",1,0)
LRX ;SLC/BA/DALISC/FHS - UTILITY ROUTINES -- PREVIOUSLY ^LAB("X","...") ;2/8/91  07:30
"RTN","LRX",2,0)
 ;;5.2;LAB SERVICE;**65,153,201,217,290,360**;Sep 27, 1994;Build 1
"RTN","LRX",3,0)
PT ;patient info
"RTN","LRX",4,0)
 ;
"RTN","LRX",5,0)
 N X,I,N,Y
"RTN","LRX",6,0)
 D KVAR^VADPT
"RTN","LRX",7,0)
 K LRTREA,LRWRD,AGE S (AGE,PNM,SEX,DOB,DOD,SSN,VA200,LRWRD,LRRB,LRTREA,VA("PID"),VA("BID"))=""
"RTN","LRX",8,0)
 I $G(LRDFN),'$G(LRDPF),$G(^LR(LRDFN,0)) S LRDPF=$P(^(0),U,2),DFN=$P(^(0),U,3)
"RTN","LRX",9,0)
 S LREND=0 S:$G(DFN)<1!('$G(LRDPF)) LREND=1 Q:$G(LREND)
"RTN","LRX",10,0)
 I +$G(LRDPF)'=2 D
"RTN","LRX",11,0)
 . S X=$$GET1^DID(1,+LRDPF,"","GLOBAL NAME","ANS","ANS1")
"RTN","LRX",12,0)
 . S X=X_DFN_",0)",X=$S($D(@X):@X,1:""),LRWRD=$S($D(^(.1)):$P(^(.1),U),1:0),LRRB=$S($D(^(.101)):$P(^(.101),U),1:""),DOD=$S($D(^(.35)):$P(^(.35),U),1:"")
"RTN","LRX",13,0)
 . S PNM=$P(X,U),SSN=$P(X,U,9) Q:+$G(LRDPF)=62.3
"RTN","LRX",14,0)
 . S SEX=$P(X,U,2),SEX=$S(SEX="":"M",1:SEX)
"RTN","LRX",15,0)
 . S DOB=$P(X,U,3)
"RTN","LRX",16,0)
 . S AGE=$S($D(DT)&(DOB?1(7N,7N1".".6N)):DT-DOB\10000,1:"??")
"RTN","LRX",17,0)
 . S AGE(2)=$$AGE2(DOB,$G(LRCDT)) ;Age of the patient when the specimen was collected (default =99Yr if no valid DOB present)
"RTN","LRX",18,0)
 . ;Default for LRCDT (collection date) is DT
"RTN","LRX",19,0)
 I +$G(LRDPF)=2 D
"RTN","LRX",20,0)
 . N I,X,N,Y
"RTN","LRX",21,0)
 . D OERR^VADPT D:'VAERR
"RTN","LRX",22,0)
 . . S PNM=VADM(1)
"RTN","LRX",23,0)
 . . S SEX=$P(VADM(5),U),DOB=$P(VADM(3),U),DOD=$P(VADM(6),U)
"RTN","LRX",24,0)
 . . S AGE=VADM(4),AGE(2)=$$AGE2(DOB,$G(LRCDT))
"RTN","LRX",25,0)
 . . S SSN=$P(VADM(2),U),LRWRD=$P(VAIN(4),U,2)
"RTN","LRX",26,0)
 . . S LRWRD(1)=+VAIN(4),LRRB=VAIN(5),LRPRAC=+VAIN(2)
"RTN","LRX",27,0)
 . . S:VAIN(3) LRTREA=+VAIN(3)
"RTN","LRX",28,0)
 D SSNFM^LRU
"RTN","LRX",29,0)
 Q
"RTN","LRX",30,0)
DEM ;Call DEM^VADPT instead of OERR used above
"RTN","LRX",31,0)
 N X,I,N,Y
"RTN","LRX",32,0)
 D KVAR^VADPT
"RTN","LRX",33,0)
 K LRTREA,LRWRD,AGE S (AGE,PNM,SEX,DOB,SSN,VA200,LRWRD,LRRB,LRTREA,VA("PID"),VA("BID"))=""
"RTN","LRX",34,0)
 I $G(LRDFN),'$G(LRDPF),$G(^LR(LRDFN,0)) S LRDPF=$P(^(0),U,2),DFN=$P(^(0),U,3)
"RTN","LRX",35,0)
 S LREND=0 S:$G(DFN)<1!('$G(LRDPF)) LREND=1 Q:$G(LREND)
"RTN","LRX",36,0)
 I +$G(LRDPF)'=2 D
"RTN","LRX",37,0)
 . S X=^DIC(+LRDPF,0,"GL")_DFN_",0)",X=$S($D(@X):@X,1:""),LRWRD=$S($D(^(.1)):$P(^(.1),U),1:0),LRRB=$S($D(^(.101)):$P(^(.101),U),1:"")
"RTN","LRX",38,0)
 . S PNM=$P(X,U),SEX=$P(X,U,2),SEX=$S(SEX="":"M",1:SEX),DOB=$P(X,U,3)
"RTN","LRX",39,0)
 . S AGE=$S($D(DT)&(DOB?1(7N,7N1".".6N)):DT-DOB\10000,1:"??")
"RTN","LRX",40,0)
 . S AGE(2)=$$AGE2(DOB,$G(LRCDT))
"RTN","LRX",41,0)
 . S SSN=$P(X,U,9)
"RTN","LRX",42,0)
 I +$G(LRDPF)=2 N I,X,N,Y D
"RTN","LRX",43,0)
 . D DEM^VADPT D:'VAERR
"RTN","LRX",44,0)
 . . S PNM=VADM(1),SEX=$P(VADM(5),U)
"RTN","LRX",45,0)
 . . S DOB=$P(VADM(3),U),SSN=$P(VADM(2),U)
"RTN","LRX",46,0)
 . . S AGE=VADM(4),AGE(2)=$$AGE2(DOB,$G(LRCDT))
"RTN","LRX",47,0)
 D SSNFM^LRU
"RTN","LRX",48,0)
 Q
"RTN","LRX",49,0)
DD ;date/time format
"RTN","LRX",50,0)
 S Y=$$FMTE^XLFDT(Y,"5Z")
"RTN","LRX",51,0)
 S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","LRX",52,0)
 Q
"RTN","LRX",53,0)
DDOLD ;OLD
"RTN","LRX",54,0)
 I $E(Y,4,7)="0000" S Y=$S($E(Y)=2:"19"_$E(Y,2,3),1:"20"_$E(Y,2,3)) Q
"RTN","LRX",55,0)
 S Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)_$S(Y#1:" "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"")
"RTN","LRX",56,0)
 Q
"RTN","LRX",57,0)
DT ;current date format is LRDT0
"RTN","LRX",58,0)
 N X,DIK,DIC,%I,DICS,%DT
"RTN","LRX",59,0)
 D DT^DICRW
"RTN","LRX",60,0)
 S Y=$$FMTE^XLFDT(DT,"5D")
"RTN","LRX",61,0)
 S LRDT0=Y
"RTN","LRX",62,0)
 Q
"RTN","LRX",63,0)
DTOLD ;2-DIGIT
"RTN","LRX",64,0)
 ;current date format is LRDT0
"RTN","LRX",65,0)
 N X,DIK,DIC,%I,DICS,%DT
"RTN","LRX",66,0)
 D DT^DICRW
"RTN","LRX",67,0)
 S Y=$P(DT,".") D DDOLD S LRDTO=Y
"RTN","LRX",68,0)
 Q
"RTN","LRX",69,0)
DASH ;line of dashes
"RTN","LRX",70,0)
 W !,$E("--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",1,IOM-1)
"RTN","LRX",71,0)
 Q
"RTN","LRX",72,0)
EQUALS ;line of equals
"RTN","LRX",73,0)
 W !,$E("====================================================================================================================================================================================================================",1,IOM-1)
"RTN","LRX",74,0)
 Q
"RTN","LRX",75,0)
DUZ ;user info
"RTN","LRX",76,0)
 S (LRUSNM,LRUSI)="" Q:'$D(X)  Q:'$D(^VA(200,+X,0))  S LRUSNM=$P(^(0),"^"),LRUSI=$P(^(0),"^",2)
"RTN","LRX",77,0)
 Q
"RTN","LRX",78,0)
DOC ;provider info
"RTN","LRX",79,0)
 I $L(X),'X S LRDOC=X Q
"RTN","LRX",80,0)
 S LRDOC=$P($G(^VA(200,+X,0)),U)
"RTN","LRX",81,0)
 S:LRDOC="" LRDOC="Unknown"
"RTN","LRX",82,0)
 Q
"RTN","LRX",83,0)
PRAC(X) ;prac info
"RTN","LRX",84,0)
 N Y
"RTN","LRX",85,0)
 I $L(X),'X Q X
"RTN","LRX",86,0)
 S Y=$P($G(^VA(200,+X,0)),U)
"RTN","LRX",87,0)
 S:Y="" Y="Unknown"
"RTN","LRX",88,0)
 Q Y
"RTN","LRX",89,0)
YMD ;year/month/date
"RTN","LRX",90,0)
 S %=%H>21549+%H-.1,%Y=%\365.25+141,%=%#365.25\1,%D=%+306#(%Y#4=0+365)#153#61#31+1,%M=%-%D\29+1,X=%Y_"00"+%M_"00"+%D K %Y,%D,%M,%
"RTN","LRX",91,0)
 Q
"RTN","LRX",92,0)
STAMP ;time stamp
"RTN","LRX",93,0)
 S X="N",%DT="ET" D ^%DT
"RTN","LRX",94,0)
 Q
"RTN","LRX",95,0)
KEYCOM ;key to result flags
"RTN","LRX",96,0)
 D EQUALS W !!,"  ------------------------------  COMMENTS  ------------------------------",!,"  Key:  'L' = reference Low,  'H' = reference Hi, '*' = critical range"
"RTN","LRX",97,0)
 Q
"RTN","LRX",98,0)
URG ;urgencys
"RTN","LRX",99,0)
 K LRURG S LRURG(0)="ROUTINE" S I=0 F  S I=$O(^LAB(62.05,I)) Q:I<1  I $D(^(I,0)) S:'$P(^(0),U,3) LRURG(I)=$P(^(0),U)
"RTN","LRX",100,0)
 Q
"RTN","LRX",101,0)
ADD ;date format
"RTN","LRX",102,0)
 S Y=$E("JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC",$E(Y,4,5)*3-2,$E(Y,4,5)*3)_" "_$S(Y#100:$J(Y#100\1,2)_", ",1:"")_(Y\10000+1700)_$S(Y#1:"  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"")
"RTN","LRX",103,0)
 Q
"RTN","LRX",104,0)
INF ;Display Infectious Warning
"RTN","LRX",105,0)
 I $L($G(IO)),$D(^LR(LRDFN,.091)),$L(^(.091)),'$G(LRQUIET) W !,$C(7)," Pat Info: ",^(.091) Q
"RTN","LRX",106,0)
 Q
"RTN","LRX",107,0)
LRGLIN ;
"RTN","LRX",108,0)
 N HZ
"RTN","LRX",109,0)
 D GSET^%ZISS W IOG1
"RTN","LRX",110,0)
 F HZ=1:1:79 W IOHL
"RTN","LRX",111,0)
 W IOG0 D GKILL^%ZISS
"RTN","LRX",112,0)
 W !
"RTN","LRX",113,0)
 Q
"RTN","LRX",114,0)
LRUID(LRAA,LRAD,LRAN) ;Extrinsic function call to create a unique 
"RTN","LRX",115,0)
 ;accession identifier for an accession number.  See description
"RTN","LRX",116,0)
 ;of field .092 in file 68 for a full explanation of this number.   
"RTN","LRX",117,0)
 ;This function returns a value equal to the unique ID generated.
"RTN","LRX",118,0)
 ;LRAA=ien in file 68, accession area
"RTN","LRX",119,0)
 ;LRAD=ien for accession date in field 68.01
"RTN","LRX",120,0)
 ;LRAN=ien for accession number in field 68.02
"RTN","LRX",121,0)
 Q:$S('$G(LRAA):1,'$D(^LRO(68,LRAA,.4)):1,1:0) 0
"RTN","LRX",122,0)
 N DA,DIE,DLAYGO,DR,LRMNTH,LRUID,LRQTR,LRTYPE,LRYR1,LRYR2,LRJUL
"RTN","LRX",123,0)
 S LRUID=$P($G(^LRO(68,LRAA,.4)),"^") ;start building LRUID
"RTN","LRX",124,0)
 S:$L(LRUID)'=2 LRUID="0"_LRUID
"RTN","LRX",125,0)
 S LRTYPE=$P($G(^LRO(68,LRAA,0)),"^",3)
"RTN","LRX",126,0)
 S LRYR1=$E(LRAD,3)
"RTN","LRX",127,0)
 S LRYR2=$E(LRAD,2,3)
"RTN","LRX",128,0)
 S LRMNTH=$E(LRAD,4,5)
"RTN","LRX",129,0)
 S LRQTR=0_(LRMNTH\3.1+1)
"RTN","LRX",130,0)
 I "DW"[LRTYPE D
"RTN","LRX",131,0)
 . S X1=LRAD,X2=$E(LRAD,1,3)_"0101" D ^%DTC
"RTN","LRX",132,0)
 . S X=X+1,LRJUL=$E("000",1,3-$L(X))_X
"RTN","LRX",133,0)
 . S LRUID=LRUID_LRYR1_LRJUL
"RTN","LRX",134,0)
 . S LRUID=LRUID_$E("0000",1,4-$L(LRAN))_LRAN
"RTN","LRX",135,0)
 I LRTYPE="Y" D
"RTN","LRX",136,0)
 . S LRUID=LRUID_LRYR2_$E("000000",1,6-$L(LRAN))_LRAN
"RTN","LRX",137,0)
 I LRTYPE="Q" D
"RTN","LRX",138,0)
 . S LRUID=LRUID_LRYR1_LRQTR
"RTN","LRX",139,0)
 . S LRUID=LRUID_$E("00000",1,5-$L(LRAN))_LRAN
"RTN","LRX",140,0)
 I LRTYPE="M" D
"RTN","LRX",141,0)
 . S LRUID=LRUID_LRYR1_LRMNTH_$E("00000",1,5-$L(LRAN))_LRAN
"RTN","LRX",142,0)
 L +^LRO(68,"C"):99999
"RTN","LRX",143,0)
 I $D(^LRO(68,"C",LRUID)),'$D(^LRO(68,"C",LRUID,LRAA,LRAD,LRAN)) D
"RTN","LRX",144,0)
 . N X
"RTN","LRX",145,0)
 . S X=$E(LRUID,3,10)
"RTN","LRX",146,0)
 . F  S LRUID="00"_X Q:'$D(^LRO(68,"C",LRUID))  S X=X+1 S:X>99999999 X=11111111
"RTN","LRX",147,0)
 ;The following fields are also set in rtn LROLOVER
"RTN","LRX",148,0)
SET3 I $G(LRORDRR)'="R" S DR="16////"_LRUID
"RTN","LRX",149,0)
 I $G(LRORDRR)="R" D
"RTN","LRX",150,0)
 . S DR=";16.1////"_+$G(LRRSITE("RSITE"))_";16.2////"_+$G(LRRSITE("RPSITE"))_";16.3////"_LRUID_";16.4////"_LRSD("RUID")
"RTN","LRX",151,0)
 . I '$G(LRRSITE("IDTYPE")),'$D(^LRO(68,"C",LRSD("RUID"))) S LRUID=LRSD("RUID") ; Use sender's UID, unless previously used.
"RTN","LRX",152,0)
 . S DR="16////"_LRUID_DR
"RTN","LRX",153,0)
 S DA=LRAN,DA(1)=LRAD,DA(2)=LRAA,DIE="^LRO(68,"_DA(2)_",1,"_DA(1)_",1,",DLAYGO=68
"RTN","LRX",154,0)
 D ^DIE
"RTN","LRX",155,0)
 L -^LRO(68,"C")
"RTN","LRX",156,0)
 S LRORU3=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,.3))
"RTN","LRX",157,0)
 Q LRUID
"RTN","LRX",158,0)
 ;
"RTN","LRX",159,0)
KVAR ;Kill laboratory/VADPT patient demographics
"RTN","LRX",160,0)
 K LRTREA,LRWRD,PNM,SEX,DOB,DOD,SSN,LRWRD,LRRB,LRTREA,VA,LRDFN,LRDPF,LREND,VAERR
"RTN","LRX",161,0)
 D KVA^VADPT
"RTN","LRX",162,0)
 Q
"RTN","LRX",163,0)
ADDPT ;Returns VAPA( Patient data
"RTN","LRX",164,0)
 N X,I,N,Y D ADD^VADPT Q
"RTN","LRX",165,0)
OPDPT ;Returns VAPD( Patient data
"RTN","LRX",166,0)
 N X,I,N,Y D OPD^VADPT Q
"RTN","LRX",167,0)
SVCPT ;Returns VASV( Patient data
"RTN","LRX",168,0)
 N X,I,N,Y D SVC^VADPT Q
"RTN","LRX",169,0)
OADPT ;Returns VAOA( Patient data
"RTN","LRX",170,0)
 N X,I,N,Y D OAD^VADPT Q
"RTN","LRX",171,0)
INPPT ;Returns VAIN( Patient data
"RTN","LRX",172,0)
 N X,I,N,Y D INP^VADPT Q
"RTN","LRX",173,0)
IN5PT ;Returns VAIP( Patient data
"RTN","LRX",174,0)
 N X,I,N,Y D IN5^VADPT Q
"RTN","LRX",175,0)
PIDPT ;Returns VA("PID") and VA("BID") Patient Identifier
"RTN","LRX",176,0)
 N X,I,N,Y D PID^VADPT Q
"RTN","LRX",177,0)
 ;
"RTN","LRX",178,0)
 ;
"RTN","LRX",179,0)
 QUIT
"RTN","LRX",180,0)
Y2K(X,LRYR) ;   --> used to convert 2digit year to 4digit century and year
"RTN","LRX",181,0)
 ; 1/1/91 TO 1/1/1991
"RTN","LRX",182,0)
 ;
"RTN","LRX",183,0)
 ;S X=$P(X,".") ;--> Date only. Not time
"RTN","LRX",184,0)
 S LRYR=$G(LRYR,"5S")
"RTN","LRX",185,0)
 N YR
"RTN","LRX",186,0)
 S Y=$$FMTE^XLFDT(X,LRYR)
"RTN","LRX",187,0)
 I $L($P(Y,"/"))=1 S $P(Y,"/")="0"_$P(Y,"/") ;--> pad for 2digit day
"RTN","LRX",188,0)
 I $L($P(Y,"/",2))=1 S $P(Y,"/",2)="0"_$P(Y,"/",2) ;--> for 2digit month
"RTN","LRX",189,0)
 Q Y
"RTN","LRX",190,0)
 ;
"RTN","LRX",191,0)
 QUIT
"RTN","LRX",192,0)
RD ;DIR read
"RTN","LRX",193,0)
 N Y,X
"RTN","LRX",194,0)
 K LRANSY,LRANSX
"RTN","LRX",195,0)
 S LREND=0 W !
"RTN","LRX",196,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) S LREND=1
"RTN","LRX",197,0)
 S LRANSY=$G(Y),LRANSX=$G(X)
"RTN","LRX",198,0)
 Q
"RTN","LRX",199,0)
AGE2(DOB,LRCDT) ;Entry point if passing only a valid Date without patient
"RTN","LRX",200,0)
 ;   DOB, LRCDT must be defined in VA FileManager internal format
"RTN","LRX",201,0)
 ; Date error will return 99yr
"RTN","LRX",202,0)
 N X,Y,%DT
"RTN","LRX",203,0)
 I '$G(LRCDT) S LRCDT=$$DT^XLFDT
"RTN","LRX",204,0)
 I '$G(DOB) Q "99yr"  ;no DOB passed
"RTN","LRX",205,0)
 S DOB=$P(DOB,".")
"RTN","LRX",206,0)
 S X=DOB,LRCDT=$P(LRCDT,".")
"RTN","LRX",207,0)
 I $S(DOB'=+DOB:1,LRCDT'=+LRCDT:1,1:0) Q "99yr"
"RTN","LRX",208,0)
 I $S(DOB'?7N.NE:1,LRCDT'?7N.NE:1,1:0) Q "99yr"
"RTN","LRX",209,0)
 D ^%DT I Y'>0 Q "99yr"  ;invalid date
"RTN","LRX",210,0)
 S X=LRCDT
"RTN","LRX",211,0)
 K %DT D ^%DT I Y'>0 Q "99yr"  ;invalid date
"RTN","LRX",212,0)
 ;
"RTN","LRX",213,0)
CALC ;Calculate timeframe based on difference between DOB and collection
"RTN","LRX",214,0)
 ; date. Time is stripped off.
"RTN","LRX",215,0)
 ; .0001-24 hour = dy
"RTN","LRX",216,0)
 ; 0-29 days = dy
"RTN","LRX",217,0)
 ; 30-730 dy = mo
"RTN","LRX",218,0)
 ; >24 mo = yr
"RTN","LRX",219,0)
 ;
"RTN","LRX",220,0)
 I DOB>LRCDT Q "99yr"  ;DOB in future
"RTN","LRX",221,0)
 I DOB=LRCDT Q "1dy"  ;same dates---pass 1 day old
"RTN","LRX",222,0)
 S X=$E(LRCDT,1,3)-$E(DOB,1,3)-($E(LRCDT,4,7)<$E(DOB,4,7))
"RTN","LRX",223,0)
 I X>1 S X=+X_"yr" Q X   ;age 2 years or more---pass in years
"RTN","LRX",224,0)
 S X=$$FMDIFF^XLFDT(LRCDT,DOB,1)
"RTN","LRX",225,0)
 I X>30 S X=X\30_"mo" Q X  ;over 30 days---pass in months
"RTN","LRX",226,0)
 E  S X=X_"dy" Q X  ;under 31 days---pass in days
"RTN","LRX",227,0)
 Q "99yr"
"VER")
8.0^22.0
"BLD",6824,6)
^278
**END**
**END**
