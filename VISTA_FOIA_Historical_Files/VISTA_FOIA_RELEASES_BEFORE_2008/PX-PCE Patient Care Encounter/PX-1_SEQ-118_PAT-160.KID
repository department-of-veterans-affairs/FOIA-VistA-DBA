Released PX*1*160 SEQ #118
Extracted from mail message
**KIDS**:PX*1.0*160^

**INSTALL NAME**
PX*1.0*160
"BLD",5887,0)
PX*1.0*160^PCE PATIENT CARE ENCOUNTER^0^3041203^y
"BLD",5887,1,0)
^^1^1^3041201^
"BLD",5887,1,1,0)
Scrolling past enrollment information in PCE.
"BLD",5887,4,0)
^9.64PA^^
"BLD",5887,"KRN",0)
^9.67PA^8989.52^19
"BLD",5887,"KRN",.4,0)
.4
"BLD",5887,"KRN",.401,0)
.401
"BLD",5887,"KRN",.402,0)
.402
"BLD",5887,"KRN",.403,0)
.403
"BLD",5887,"KRN",.5,0)
.5
"BLD",5887,"KRN",.84,0)
.84
"BLD",5887,"KRN",3.6,0)
3.6
"BLD",5887,"KRN",3.8,0)
3.8
"BLD",5887,"KRN",9.2,0)
9.2
"BLD",5887,"KRN",9.8,0)
9.8
"BLD",5887,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5887,"KRN",9.8,"NM",1,0)
PXCEPAT^^0^B27620875
"BLD",5887,"KRN",9.8,"NM","B","PXCEPAT",1)

"BLD",5887,"KRN",19,0)
19
"BLD",5887,"KRN",19,"NM",0)
^9.68A^^
"BLD",5887,"KRN",19.1,0)
19.1
"BLD",5887,"KRN",101,0)
101
"BLD",5887,"KRN",409.61,0)
409.61
"BLD",5887,"KRN",771,0)
771
"BLD",5887,"KRN",870,0)
870
"BLD",5887,"KRN",8989.51,0)
8989.51
"BLD",5887,"KRN",8989.52,0)
8989.52
"BLD",5887,"KRN",8994,0)
8994
"BLD",5887,"KRN","B",.4,.4)

"BLD",5887,"KRN","B",.401,.401)

"BLD",5887,"KRN","B",.402,.402)

"BLD",5887,"KRN","B",.403,.403)

"BLD",5887,"KRN","B",.5,.5)

"BLD",5887,"KRN","B",.84,.84)

"BLD",5887,"KRN","B",3.6,3.6)

"BLD",5887,"KRN","B",3.8,3.8)

"BLD",5887,"KRN","B",9.2,9.2)

"BLD",5887,"KRN","B",9.8,9.8)

"BLD",5887,"KRN","B",19,19)

"BLD",5887,"KRN","B",19.1,19.1)

"BLD",5887,"KRN","B",101,101)

"BLD",5887,"KRN","B",409.61,409.61)

"BLD",5887,"KRN","B",771,771)

"BLD",5887,"KRN","B",870,870)

"BLD",5887,"KRN","B",8989.51,8989.51)

"BLD",5887,"KRN","B",8989.52,8989.52)

"BLD",5887,"KRN","B",8994,8994)

"BLD",5887,"QUES",0)
^9.62^^
"BLD",5887,"REQB",0)
^9.611^1^1
"BLD",5887,"REQB",1,0)
PX*1.0*147^2
"BLD",5887,"REQB","B","PX*1.0*147",1)

"MBREQ")
0
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
160^3041203
"PKG",413,22,1,"PAH",1,1,0)
^^1^1^3041203
"PKG",413,22,1,"PAH",1,1,1,0)
Scrolling past enrollment information in PCE.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PXCEPAT")
0^1^B27620875
"RTN","PXCEPAT",1,0)
PXCEPAT ;ISL/dee,ISA/KWP - Creates the List Manager display of visit for a patient ; 6/3/03 10:47am
"RTN","PXCEPAT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,5,14,30,70,147,160**;Aug 12, 1996
"RTN","PXCEPAT",3,0)
 Q
"RTN","PXCEPAT",4,0)
 ;
"RTN","PXCEPAT",5,0)
NEWPAT2 ;Entry point of changing patient from Update Encounter
"RTN","PXCEPAT",6,0)
 N PXCENEWP
"RTN","PXCEPAT",7,0)
 D PATIENT(.PXCENEWP)
"RTN","PXCEPAT",8,0)
 Q:PXCENEWP'>0
"RTN","PXCEPAT",9,0)
 D PATKILL
"RTN","PXCEPAT",10,0)
 S PXCEPAT=+PXCENEWP
"RTN","PXCEPAT",11,0)
NEWPAT1 ;Entry point for initial selection of patient
"RTN","PXCEPAT",12,0)
 D PATINFO(.PXCEPAT) Q:$D(DIRUT)
"RTN","PXCEPAT",13,0)
 I $P(PXCEVIEW,"^",1)'="P" D
"RTN","PXCEPAT",14,0)
 . S $P(PXCEVIEW,"^",1)="P"
"RTN","PXCEPAT",15,0)
 . D SETDATES^PXCE
"RTN","PXCEPAT",16,0)
 S SDAMTYP="P"
"RTN","PXCEPAT",17,0)
 I PXCEVIEW["A" K PXCEHLOC
"RTN","PXCEPAT",18,0)
 Q
"RTN","PXCEPAT",19,0)
 ;
"RTN","PXCEPAT",20,0)
NEWPAT ; -- init variables and list array
"RTN","PXCEPAT",21,0)
 N PXCENEWP
"RTN","PXCEPAT",22,0)
 D PATIENT(.PXCENEWP)
"RTN","PXCEPAT",23,0)
 I PXCENEWP'>0,("~H~P~"'[("~"_$P(PXCEVIEW,"^")_"~")) S VALMQUIT=1 Q
"RTN","PXCEPAT",24,0)
 I PXCENEWP'>0 Q
"RTN","PXCEPAT",25,0)
 D PATKILL
"RTN","PXCEPAT",26,0)
 S PXCEPAT=+PXCENEWP
"RTN","PXCEPAT",27,0)
 D NEWPAT1 Q:$D(DIRUT)
"RTN","PXCEPAT",28,0)
 D MAKELIST^PXCENEW
"RTN","PXCEPAT",29,0)
 Q
"RTN","PXCEPAT",30,0)
 ;
"RTN","PXCEPAT",31,0)
MAKELIST ;
"RTN","PXCEPAT",32,0)
 N PXCEDATE,PXCELOC,PXCESTAT,PXCEDT,PXCEIEN,PXCEVSIT,PXCEPRIM
"RTN","PXCEPAT",33,0)
 D CHGCAP^VALM("LOCATION","Clinic")
"RTN","PXCEPAT",34,0)
 K VALMHDR S VALMBCK="R"
"RTN","PXCEPAT",35,0)
 S PXCEDT=PXCE9END
"RTN","PXCEPAT",36,0)
 D CLEAN^VALM10
"RTN","PXCEPAT",37,0)
 K ^TMP("PXCEIDX",$J)
"RTN","PXCEPAT",38,0)
 S VALMBG=1
"RTN","PXCEPAT",39,0)
 S VALMCNT=0
"RTN","PXCEPAT",40,0)
 F  S PXCEDT=$O(^AUPNVSIT("AA",PXCEPAT,PXCEDT)) Q:PXCEDT'>0!(PXCEDT>PXCE9BEG)  D
"RTN","PXCEPAT",41,0)
 . S PXCEIEN=""
"RTN","PXCEPAT",42,0)
 . F  S PXCEIEN=$O(^AUPNVSIT("AA",PXCEPAT,PXCEDT,PXCEIEN)) Q:PXCEIEN'>0  D
"RTN","PXCEPAT",43,0)
 .. S PXCEVSIT=^AUPNVSIT(PXCEIEN,0)
"RTN","PXCEPAT",44,0)
 .. I $D(PXCEHLOC),$P(PXCEVSIT,"^",22)'=PXCEHLOC Q
"RTN","PXCEPAT",45,0)
 .. S PXCEPRIM=$P($G(^AUPNVSIT(PXCEIEN,150)),"^",3)
"RTN","PXCEPAT",46,0)
 .. ;+do not show encounter if the encounter type is S,C or null
"RTN","PXCEPAT",47,0)
 .. Q:"SC"[PXCEPRIM
"RTN","PXCEPAT",48,0)
 .. I PXCEKEYS'["S",PXCEKEYS'["V","A"=PXCEPRIM Q  ;+let supervisor and viewer see ancillary encounters
"RTN","PXCEPAT",49,0)
 .. I PXCEKEYS'["V",$$DISPOSIT^PXUTL1(PXCEPAT,+PXCEVSIT,PXCEIEN) Q  ;+let viewer see disposition
"RTN","PXCEPAT",50,0)
 .. S VALMCNT=VALMCNT+1
"RTN","PXCEPAT",51,0)
 .. S Y=$P(PXCEVSIT,"^",1)
"RTN","PXCEPAT",52,0)
 .. S PXCEDATE=$$DATE^PXCEDATE($P(PXCEVSIT,"^",1))
"RTN","PXCEPAT",53,0)
 .. S PXCEDATE=$E(PXCEDATE,1,18)_$J("",(19-$L(PXCEDATE)))
"RTN","PXCEPAT",54,0)
 .. I $P(PXCEVSIT,"^",7)="E" D
"RTN","PXCEPAT",55,0)
 ... S PXCELOC="  Historical Encounter at "
"RTN","PXCEPAT",56,0)
 ... I $P(PXCEVSIT,"^",6)]"" D
"RTN","PXCEPAT",57,0)
 .... N PXCEDELF
"RTN","PXCEPAT",58,0)
 .... S PXCESTAT=$E($$EXTERNAL^DILFD(9000010,.06,"",$P(PXCEVSIT,"^",6),"PXCEDILF"),1,30)
"RTN","PXCEPAT",59,0)
 ... E  S PXCESTAT=$E($P($G(^AUPNVSIT(PXCEIEN,21)),"^"),1,30)
"RTN","PXCEPAT",60,0)
 .. E  D
"RTN","PXCEPAT",61,0)
 ... S PXCELOC=$S($P(PXCEVSIT,"^",22)>0:$P(^SC($P(PXCEVSIT,"^",22),0),"^"),$P(PXCEVSIT,"^",7)="E":"   Historical",1:"")
"RTN","PXCEPAT",62,0)
 ... S PXCELOC=$E(PXCELOC,1,26)_$J("",(28-$L(PXCELOC)))
"RTN","PXCEPAT",63,0)
 ... S PXCESTAT=$P($$STATUS^SDPCE(PXCEIEN),"^",2)
"RTN","PXCEPAT",64,0)
 .. S ^TMP("PXCE",$J,VALMCNT,0)=$J(VALMCNT,4)_" "_PXCEDATE_PXCELOC_PXCESTAT
"RTN","PXCEPAT",65,0)
 .. S ^TMP("PXCEIDX",$J,VALMCNT)=PXCEIEN
"RTN","PXCEPAT",66,0)
 S ^TMP("PXCEIDX",$J,0)=VALMCNT
"RTN","PXCEPAT",67,0)
 I VALMCNT'>0 D
"RTN","PXCEPAT",68,0)
 . S ^TMP("PXCE",$J,1,0)=" "
"RTN","PXCEPAT",69,0)
 . S ^TMP("PXCE",$J,2,0)="    No encounter found that satisfy the above criteria."
"RTN","PXCEPAT",70,0)
 . S VALMCNT=2
"RTN","PXCEPAT",71,0)
 Q
"RTN","PXCEPAT",72,0)
 ;
"RTN","PXCEPAT",73,0)
SDSALONE ;Get the patient for standalone from the appointment/hospital
"RTN","PXCEPAT",74,0)
 ;location screen
"RTN","PXCEPAT",75,0)
 Q:$G(PXCEPAT)>0
"RTN","PXCEPAT",76,0)
 D PATIENT(.PXCEPAT)
"RTN","PXCEPAT",77,0)
 I PXCEPAT>0 D PATINFO(.PXCEPAT) S PXCEJPAT=1
"RTN","PXCEPAT",78,0)
 Q
"RTN","PXCEPAT",79,0)
 ;
"RTN","PXCEPAT",80,0)
SDKALONE ;Kill the patient info if it was created above
"RTN","PXCEPAT",81,0)
 Q:'$D(PXCEJPAT)
"RTN","PXCEPAT",82,0)
 D PATKILL
"RTN","PXCEPAT",83,0)
 K PXCEJPAT
"RTN","PXCEPAT",84,0)
 Q
"RTN","PXCEPAT",85,0)
 ;
"RTN","PXCEPAT",86,0)
JUSTDFN ;Just set DFN for other packages.
"RTN","PXCEPAT",87,0)
 Q
"RTN","PXCEPAT",88,0)
 Q:$G(DFN)>0
"RTN","PXCEPAT",89,0)
 N X,Y,DIC,DA
"RTN","PXCEPAT",90,0)
 S DIC=2,DIC(0)="AEMQ"
"RTN","PXCEPAT",91,0)
 D ^DIC
"RTN","PXCEPAT",92,0)
 I +Y>0 S DFN=+Y,PXCEJDFN=1
"RTN","PXCEPAT",93,0)
 Q
"RTN","PXCEPAT",94,0)
 ;
"RTN","PXCEPAT",95,0)
JUSTDFNK ;Kill DFN if it was set above
"RTN","PXCEPAT",96,0)
 I $G(PXCEJDFN) K DFN,PXCEJDFN
"RTN","PXCEPAT",97,0)
 I $G(PXCEPAT)>0 S DFN=PXCEPAT
"RTN","PXCEPAT",98,0)
 Q
"RTN","PXCEPAT",99,0)
 ;
"RTN","PXCEPAT",100,0)
PATIENT(PXCEDATA) ; Select a patient
"RTN","PXCEPAT",101,0)
 N X,Y,DIC,DA
"RTN","PXCEPAT",102,0)
 D FULL^VALM1
"RTN","PXCEPAT",103,0)
 S DIC=2,DIC(0)="AEMQ" D ^DIC
"RTN","PXCEPAT",104,0)
PAT1 S %=1 W !,"   ...OK" D YN^DICN I %=0 W "   Answer With 'Yes' or 'No'" G PAT1
"RTN","PXCEPAT",105,0)
 I %'=1 S Y=-1
"RTN","PXCEPAT",106,0)
 S PXCEDATA=+Y
"RTN","PXCEPAT",107,0)
 ;S DFN=PXCEDATA D 2^VADPT I +VADM(6) D
"RTN","PXCEPAT",108,0)
 ;. S DIR(0)="E",DIR("A")="Enter RETURN to continue or '^' to exit"
"RTN","PXCEPAT",109,0)
 ;. S DIR("A",1)="WARNING "_VADM(7) D ^DIR
"RTN","PXCEPAT",110,0)
 Q
"RTN","PXCEPAT",111,0)
 ;
"RTN","PXCEPAT",112,0)
PATINFO(PXCEDATA) ;
"RTN","PXCEPAT",113,0)
 Q:$G(PXCEDATA)'>0
"RTN","PXCEPAT",114,0)
 S (DFN,SDFN,ORVP)=PXCEDATA
"RTN","PXCEPAT",115,0)
 D 2^VADPT I +VADM(6) D  K DIR I $D(DIRUT) D:$G(PXCECAT)'="SIT"&($G(PXCECAT)'="HIST")&($G(PXCECAT)'="AEP") PATKILL Q
"RTN","PXCEPAT",116,0)
 . S DIR(0)="E",DIR("A")="Enter RETURN to continue or '^' to Quit"
"RTN","PXCEPAT",117,0)
 . S DIR("A",2)="WARNING "_VADM(7),DIR("A",1)=" ",DIR("A",3)=" " D ^DIR
"RTN","PXCEPAT",118,0)
 N Y
"RTN","PXCEPAT",119,0)
 S Y=PXCEDATA
"RTN","PXCEPAT",120,0)
 ;Set IHS patient variables
"RTN","PXCEPAT",121,0)
 D START^AUPNPAT
"RTN","PXCEPAT",122,0)
 D PATNAME(.PXCEDATA)
"RTN","PXCEPAT",123,0)
 N VAERR,VAROOT,PXCEVA,PXCEINDX
"RTN","PXCEPAT",124,0)
 S VAROOT="PXCEVA"
"RTN","PXCEPAT",125,0)
 D ELIG^VADPT
"RTN","PXCEPAT",126,0)
 S PXCEDATA("ELIG")=$P($G(PXCEVA(1)),"^",1,99)
"RTN","PXCEPAT",127,0)
 S PXCEINDX=""
"RTN","PXCEPAT",128,0)
 F  S PXCEINDX=$O(PXCEVA(1,PXCEINDX)) Q:'PXCEINDX  S PXCEDATA("ELIG",PXCEINDX)=$P(PXCEVA(1,PXCEINDX),"^",1,99)
"RTN","PXCEPAT",129,0)
 Q
"RTN","PXCEPAT",130,0)
 ;
"RTN","PXCEPAT",131,0)
PATNAME(PXCEDATA) ;
"RTN","PXCEPAT",132,0)
 S PXCEDATA("NAME")=$P($G(^DPT(+PXCEDATA,0)),"^",1)
"RTN","PXCEPAT",133,0)
 N VAPTYP,VA,VAERR,DFN
"RTN","PXCEPAT",134,0)
 S DFN=+PXCEDATA
"RTN","PXCEPAT",135,0)
 D PID^VADPT6
"RTN","PXCEPAT",136,0)
 I 'VAERR S PXCEDATA("SSN")=VA("PID"),PXCEDATA("SSN_BRIEF")=VA("BID")
"RTN","PXCEPAT",137,0)
 E  S (PXCEDATA("SSN"),PXCEDATA("SSN_BRIEF"))=""
"RTN","PXCEPAT",138,0)
 Q
"RTN","PXCEPAT",139,0)
 ;
"RTN","PXCEPAT",140,0)
PATKILL ;
"RTN","PXCEPAT",141,0)
 K PXCEPAT,DFN,SDFN,ORVP
"RTN","PXCEPAT",142,0)
 ; Kill IHS patient variables
"RTN","PXCEPAT",143,0)
 D KILL^AUPNPAT
"RTN","PXCEPAT",144,0)
 Q
"RTN","PXCEPAT",145,0)
 ;
"RTN","PXCEPAT",146,0)
APPOINT(DFN,DATETIME,HOSLOC) ;See if there is an appointment.
"RTN","PXCEPAT",147,0)
 ;Input:
"RTN","PXCEPAT",148,0)
 ;  DFN       ien of the patient
"RTN","PXCEPAT",149,0)
 ;  DATETIME  the date and time of the appointment
"RTN","PXCEPAT",150,0)
 ;  HOSLOC    optional, is the Hospital Location (#44)
"RTN","PXCEPAT",151,0)
 ;Returns the clinic ien or -1 if no appointement.
"RTN","PXCEPAT",152,0)
 ;
"RTN","PXCEPAT",153,0)
 N VASD,HL,INDEX,VAERR
"RTN","PXCEPAT",154,0)
 K ^UTILITY("VASD",$J)
"RTN","PXCEPAT",155,0)
 S VASD("T")=DATETIME
"RTN","PXCEPAT",156,0)
 S VASD("F")=DATETIME-.00000001
"RTN","PXCEPAT",157,0)
 S VASD("W")=129 ;1)Active/Kept 2)Inpatient appts. only 9)No action taken
"RTN","PXCEPAT",158,0)
 S:$G(HOSLOC) VASD("C",HOSLOC)=""
"RTN","PXCEPAT",159,0)
 D SDA^VADPT
"RTN","PXCEPAT",160,0)
 I VAERR S HL=-1 G QAPPOINT
"RTN","PXCEPAT",161,0)
 S INDEX=$O(^UTILITY("VASD",$J,0))
"RTN","PXCEPAT",162,0)
 I INDEX>0 S HL=$P(^UTILITY("VASD",$J,INDEX,"I"),"^",2)
"RTN","PXCEPAT",163,0)
 E  S HL=-1
"RTN","PXCEPAT",164,0)
QAPPOINT K ^UTILITY("VASD",$J)
"RTN","PXCEPAT",165,0)
 Q HL
"RTN","PXCEPAT",166,0)
 ;
"VER")
8.0^22
**END**
**END**
