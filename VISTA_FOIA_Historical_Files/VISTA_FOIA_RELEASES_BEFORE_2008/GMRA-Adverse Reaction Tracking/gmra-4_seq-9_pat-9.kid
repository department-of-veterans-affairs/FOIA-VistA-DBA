Released GMRA*4*9 SEQ #9
Extracted from mail message
**KIDS**:GMRA*4.0*9^

**INSTALL NAME**
GMRA*4.0*9
"BLD",677,0)
GMRA*4.0*9^ADVERSE REACTION TRACKING^0^^y
"BLD",677,1,0)
^^4^4^2971216^
"BLD",677,1,1,0)
This patch will update the mark chart/id band option to use
"BLD",677,1,2,0)
the new ACRP APIs that become available with patch SD*5.3*131.
"BLD",677,1,3,0)
Please see the national patch module for a full description of
"BLD",677,1,4,0)
this patch as well as patch 131.
"BLD",677,4,0)
^9.64PA^^
"BLD",677,"ABPKG")
n
"BLD",677,"KRN",0)
^9.67PA^19^18
"BLD",677,"KRN",.4,0)
.4
"BLD",677,"KRN",.401,0)
.401
"BLD",677,"KRN",.402,0)
.402
"BLD",677,"KRN",.403,0)
.403
"BLD",677,"KRN",.5,0)
.5
"BLD",677,"KRN",.84,0)
.84
"BLD",677,"KRN",3.6,0)
3.6
"BLD",677,"KRN",3.8,0)
3.8
"BLD",677,"KRN",9.2,0)
9.2
"BLD",677,"KRN",9.8,0)
9.8
"BLD",677,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",677,"KRN",9.8,"NM",1,0)
GMRACMR1^^0^B10390530
"BLD",677,"KRN",9.8,"NM",2,0)
GMRACMR2^^0^B1288585
"BLD",677,"KRN",9.8,"NM","B","GMRACMR1",1)

"BLD",677,"KRN",9.8,"NM","B","GMRACMR2",2)

"BLD",677,"KRN",19,0)
19
"BLD",677,"KRN",19.1,0)
19.1
"BLD",677,"KRN",101,0)
101
"BLD",677,"KRN",409.61,0)
409.61
"BLD",677,"KRN",771,0)
771
"BLD",677,"KRN",869.2,0)
869.2
"BLD",677,"KRN",870,0)
870
"BLD",677,"KRN",8994,0)
8994
"BLD",677,"KRN","B",.4,.4)

"BLD",677,"KRN","B",.401,.401)

"BLD",677,"KRN","B",.402,.402)

"BLD",677,"KRN","B",.403,.403)

"BLD",677,"KRN","B",.5,.5)

"BLD",677,"KRN","B",.84,.84)

"BLD",677,"KRN","B",3.6,3.6)

"BLD",677,"KRN","B",3.8,3.8)

"BLD",677,"KRN","B",9.2,9.2)

"BLD",677,"KRN","B",9.8,9.8)

"BLD",677,"KRN","B",19,19)

"BLD",677,"KRN","B",19.1,19.1)

"BLD",677,"KRN","B",101,101)

"BLD",677,"KRN","B",409.61,409.61)

"BLD",677,"KRN","B",771,771)

"BLD",677,"KRN","B",869.2,869.2)

"BLD",677,"KRN","B",870,870)

"BLD",677,"KRN","B",8994,8994)

"BLD",677,"QUES",0)
^9.62^^
"BLD",677,"REQB",0)
^9.611^1^1
"BLD",677,"REQB",1,0)
SD*5.3*131^1
"BLD",677,"REQB","B","SD*5.3*131",1)

"OER",262,0)
262^GMRA^1^^
"OER",262,1,0)
^100.9951PA^1^1
"OER",262,1,1,0)
45
"OER",262,1,1,1,0)
^100.99511PA^1^1
"OER",262,1,1,1,1,0)
40
"PKG",262,-1)
1^1
"PKG",262,0)
ADVERSE REACTION TRACKING^GMRA^Adverse Reaction Tracking package
"PKG",262,22,0)
^9.49I^1^1
"PKG",262,22,1,0)
4.0^2960328^2960603^112
"PKG",262,22,1,"PAH",1,0)
9
"PKG",262,22,1,"PAH",1,1,0)
^^4^4^2971216
"PKG",262,22,1,"PAH",1,1,1,0)
This patch will update the mark chart/id band option to use
"PKG",262,22,1,"PAH",1,1,2,0)
the new ACRP APIs that become available with patch SD*5.3*131.
"PKG",262,22,1,"PAH",1,1,3,0)
Please see the national patch module for a full description of
"PKG",262,22,1,"PAH",1,1,4,0)
this patch as well as patch 131.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRACMR1")
0^1^B10390530
"RTN","GMRACMR1",1,0)
GMRACMR1 ;HIRMFO/WAA-Find clinics and wards ;12/16/97  10:35
"RTN","GMRACMR1",2,0)
 ;;4.0;Adverse Reaction Tracking;**9**;Mar 29, 1996
"RTN","GMRACMR1",3,0)
MDIC() ; FUNTION RETURNS S ^TMP($J,"GMRAWC",GMRANUM,GMRAX)=""
"RTN","GMRACMR1",4,0)
 ; FUNCTION VALUE IS -1 IF USER ABORTS, 0 IF NO LOCS PICKED, ELSE 1
"RTN","GMRACMR1",5,0)
 N DIC,MDIC,NEG,X,Y K GMRANLOC,^TMP($J,"GMRAWC") S GMRANUM=0
"RTN","GMRACMR1",6,0)
DIC W !,$S('$D(^TMP($J,"GMRAWC")):"Select",1:"Another")_" Location: " R X:DTIME E  S X="^^"
"RTN","GMRACMR1",7,0)
 I $$UP^XLFSTR(X)="ALL" D  G:X="" DIC
"RTN","GMRACMR1",8,0)
 .F  S %=1 W !,"Do you mean ALL Locations" D YN^DICN S:%=-1 X="^",%=2 Q:%  W !,"Enter Y for yes you mean ALL or N for no.",$C(7)
"RTN","GMRACMR1",9,0)
 .I %=2 K % Q
"RTN","GMRACMR1",10,0)
 .I %=1 K % S X=0  F  S X=$O(^SC(X)) Q:X<1  D
"RTN","GMRACMR1",11,0)
 ..I $$SCRIACT^GMRACMR1(X) S ^TMP($J,"GMRAWC",X)=$P($G(^SC(X,0)),U,3)
"RTN","GMRACMR1",12,0)
 ..Q
"RTN","GMRACMR1",13,0)
 .K % S X=""
"RTN","GMRACMR1",14,0)
 .Q
"RTN","GMRACMR1",15,0)
RETURN I "^^"[X S MDIC=$S(X["^":-1,1:$D(^TMP($J,"GMRAWC"))) Q MDIC
"RTN","GMRACMR1",16,0)
 I X?1"?".E D HLP S:Y<0 X="^^" G:Y<0 RETURN S X="?"
"RTN","GMRACMR1",17,0)
 S NEG=X?1"-".E,X=$E(X,NEG+1,$L(X)),DIC="^SC(",DIC(0)="EQMZ",DIC("S")="I $$SCRIACT^GMRACMR1(+Y)" D ^DIC K DIC,DLAYGO I +Y'>0 G DIC
"RTN","GMRACMR1",18,0)
 I 'NEG S GMRANUM=GMRANUM+1,^TMP($J,"GMRAWC",+Y)=$P(^SC(+Y,0),U,3)
"RTN","GMRACMR1",19,0)
 E  K ^TMP($J,"GMRAWC",+Y)
"RTN","GMRACMR1",20,0)
 G DIC
"RTN","GMRACMR1",21,0)
HLP ; PRINT LOCATIONS SELECTED ALREADY
"RTN","GMRACMR1",22,0)
 W $C(7) I $D(^TMP($J,"GMRAWC")) W !?3,"YOU HAVE ALREADY SELECTED: "
"RTN","GMRACMR1",23,0)
 S Y="",X=0 F  S Y=$O(^TMP($J,"GMRAWC",+Y)) Q:Y=""  W !?5,$P(^SC(+Y,0),U) S X=X+1 I X>5 W !,"""^"" TO STOP: " R X:DTIME S:'$T X="^^" S:X="^^" Y=-1 Q:X="^"!(Y<0)  S X=0
"RTN","GMRACMR1",24,0)
 Q:Y<0
"RTN","GMRACMR1",25,0)
 W !!?3,"You may deselect from the list by typing a '-' followed by location name.",!?4,"E.g.  -3E would delete 3E from the list of locations already selected."
"RTN","GMRACMR1",26,0)
 W !?4,"You may enter the word ALL to select all appropriate locations."
"RTN","GMRACMR1",27,0)
 Q
"RTN","GMRACMR1",28,0)
SCRIACT(X) ; GIVEN X AS 44 ENTRY, THIS SCREEN WILL DETERMINE IF IT IS
"RTN","GMRACMR1",29,0)
 ; ACTIVE OR NOT FOR THIS REPORT.  RETURNS 0 IF IT IS NOT, ELSE 1
"RTN","GMRACMR1",30,0)
 S X("ANS")=0,X(0)=$G(^SC(X,0))
"RTN","GMRACMR1",31,0)
 I X(0)'="" D
"RTN","GMRACMR1",32,0)
 .I GMRAQST'[$P(X(0),U,3) Q
"RTN","GMRACMR1",33,0)
 .I $P(X(0),U,3)="W" D
"RTN","GMRACMR1",34,0)
 ..S GMRA42=+$G(^SC(X,42)) Q:GMRA42=""!($G(^DIC(42,GMRA42,0))="")
"RTN","GMRACMR1",35,0)
 ..I '$O(^DIC(42,GMRA42,"OOS",0)) S X("ANS")=1 Q
"RTN","GMRACMR1",36,0)
 ..I GMRASEL["1" S X("ANS")=$$ACT42(DT,DT)
"RTN","GMRACMR1",37,0)
 ..I 'X("ANS"),GMRASEL["3" S X("ANS")=$$ACT42(GMRAST,GMRAED)
"RTN","GMRACMR1",38,0)
 ..Q
"RTN","GMRACMR1",39,0)
 .I GMRASEL["2","^C^M^"[(U_$P(X(0),U,3)_U) D
"RTN","GMRACMR1",40,0)
 ..S X("I")=$G(^SC(X,"I"))
"RTN","GMRACMR1",41,0)
 ..I $P(X("I"),U)]"",$P(X("I"),U)<$S(GMRASEL["2"!(GMRASEL["3"):GMRAST,1:DT) D  Q
"RTN","GMRACMR1",42,0)
 ...Q:$P(X("I"),U,2)=""!(GMRASEL'["2"&(GMRASEL'["3"))
"RTN","GMRACMR1",43,0)
 ...Q:$P(X("I"),U,2)'=""&($P(X("I"),U,2)'<GMRAED)
"RTN","GMRACMR1",44,0)
 ...S X("ANS")=1
"RTN","GMRACMR1",45,0)
 ...Q
"RTN","GMRACMR1",46,0)
 ..S X("ANS")=1
"RTN","GMRACMR1",47,0)
 ..Q
"RTN","GMRACMR1",48,0)
 .Q
"RTN","GMRACMR1",49,0)
 Q X("ANS")
"RTN","GMRACMR1",50,0)
ACT42(START,END) ; DETERMINES IF A WARD IS ACTIVE DURING A D/T RANGE
"RTN","GMRACMR1",51,0)
 ; WARD IS IN GMRA42, AND PASS IN START AND END AS D/T RANGE
"RTN","GMRACMR1",52,0)
 N ANS,OOS
"RTN","GMRACMR1",53,0)
 S ANS(0)=0,ANS=1,OOS(1)=9999999-(START+.000001) ;**NEW CODE RM-5/24/93
"RTN","GMRACMR1",54,0)
 F  S OOS(1)=$O(^DIC(42,GMRA42,"OOS","AINV",OOS(1))) Q:OOS(1)<1  D  Q:ANS(0)
"RTN","GMRACMR1",55,0)
 .S OOS(2)=0 F  S OOS(2)=$O(^DIC(42,GMRA42,"OOS","AINV",OOS(1),OOS(2))) Q:OOS(2)<1  D  Q:ANS(0)
"RTN","GMRACMR1",56,0)
 ..S OOS=$G(^DIC(42,GMRA42,"OOS",OOS(2),0)) Q:OOS=""
"RTN","GMRACMR1",57,0)
 ..I '$P(OOS,U,6) Q
"RTN","GMRACMR1",58,0)
 ..S ANS(0)=1,ANS=0 I $S($P(OOS,U,4)="":0,1:$P(OOS,U,4)<END) S ANS=1 ;**NEW CODE RM-5/24/93
"RTN","GMRACMR1",59,0)
 ..Q
"RTN","GMRACMR1",60,0)
 .Q
"RTN","GMRACMR1",61,0)
 Q ANS
"RTN","GMRACMR2")
0^2^B1288585
"RTN","GMRACMR2",1,0)
GMRACMR2 ;HIRMFO/WAA-This routine will find all valid patient ;12/16/97  10:34
"RTN","GMRACMR2",2,0)
 ;;4.0;Adverse Reaction Tracking;**9**;Mar 29, 1996
"RTN","GMRACMR2",3,0)
EN1 ;Use ACRP APIs to gather appointment data
"RTN","GMRACMR2",4,0)
 Q:GMRASEL'["2"
"RTN","GMRACMR2",5,0)
 N GMTSQRY
"RTN","GMRACMR2",6,0)
 D OPEN^SDQ(.GMTSQRY)
"RTN","GMRACMR2",7,0)
 D INDEX^SDQ(.GMTSQRY,"DATE/TIME","SET")
"RTN","GMRACMR2",8,0)
 D DATE^SDQ(.GMTSQRY,GMRAST,GMRAED,"SET")
"RTN","GMRACMR2",9,0)
 D SCANCB^SDQ(.GMTSQRY,"D CB^GMRACMR2(Y,Y0)","SET")
"RTN","GMRACMR2",10,0)
 D ACTIVE^SDQ(.GMTSQRY,"TRUE","SET")
"RTN","GMRACMR2",11,0)
 D SCAN^SDQ(.GMTSQRY,"FORWARD")
"RTN","GMRACMR2",12,0)
 D CLOSE^SDQ(.GMTSQRY)
"RTN","GMRACMR2",13,0)
 K GMRAX,GMRADFN,GMRADATE
"RTN","GMRACMR2",14,0)
 Q
"RTN","GMRACMR2",15,0)
CB(GMTS,GMTS0) ;Callback execution, handles each entry from data set
"RTN","GMRACMR2",16,0)
 I $P(GMTS0,U,12)'=2&($P(GMTS0,U,12)'=8) Q  ;Only count inpatient and checked-out appts
"RTN","GMRACMR2",17,0)
 S GMRAX=$P(GMTS0,U,4),GMRADFN=$P(GMTS0,U,2),GMRADATE=$P(GMTS0,U) D SETPT^GMRACMR3
"RTN","GMRACMR2",18,0)
 Q
"VER")
8.0^21.0
**END**
**END**
