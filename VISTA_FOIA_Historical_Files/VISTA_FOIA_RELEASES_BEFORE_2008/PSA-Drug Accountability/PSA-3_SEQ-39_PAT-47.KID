Released PSA*3*47 SEQ #39
Extracted from mail message
**KIDS**:PSA*3.0*47^

**INSTALL NAME**
PSA*3.0*47
"BLD",6504,0)
PSA*3.0*47^DRUG ACCOUNTABILITY^0^3060109^y
"BLD",6504,1,0)
^^9^9^3051219^
"BLD",6504,1,1,0)
HD68504 Invoices not being able to be up loaded. This patch corrects 
"BLD",6504,1,2,0)
problems with the algorithm used to convert invoice files received from 
"BLD",6504,1,3,0)
McKesson. The process incorrectly inserts zeros to the transaction set 
"BLD",6504,1,4,0)
control number, which caused the length of the number to exceed the 
"BLD",6504,1,5,0)
required specification length. An example of the error message is shown 
"BLD",6504,1,6,0)
below:
"BLD",6504,1,7,0)
 
"BLD",6504,1,8,0)
Control# 0000000000000000000000000033
"BLD",6504,1,9,0)
The ST control# (piece 3) should be 4 to 9 characters in length.
"BLD",6504,"ABPKG")
^
"BLD",6504,"INI")
PSAP47
"BLD",6504,"INID")
^^n
"BLD",6504,"KRN",0)
^9.67PA^^
"BLD",6504,"KRN",.4,0)
.4
"BLD",6504,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",6504,"KRN",.401,0)
.401
"BLD",6504,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",6504,"KRN",.402,0)
.402
"BLD",6504,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",6504,"KRN",.403,0)
.403
"BLD",6504,"KRN",.5,0)
.5
"BLD",6504,"KRN",.84,0)
.84
"BLD",6504,"KRN",3.6,0)
3.6
"BLD",6504,"KRN",3.8,0)
3.8
"BLD",6504,"KRN",9.2,0)
9.2
"BLD",6504,"KRN",9.8,0)
9.8
"BLD",6504,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6504,"KRN",9.8,"NM",1,0)
PSABRKU3^^0^B20933321
"BLD",6504,"KRN",9.8,"NM",2,0)
PSAP47^^0^B484753
"BLD",6504,"KRN",9.8,"NM","B","PSABRKU3",1)

"BLD",6504,"KRN",9.8,"NM","B","PSAP47",2)

"BLD",6504,"KRN",19,0)
19
"BLD",6504,"KRN",19.1,0)
19.1
"BLD",6504,"KRN",101,0)
101
"BLD",6504,"KRN",409.61,0)
409.61
"BLD",6504,"KRN",771,0)
771
"BLD",6504,"KRN",869.2,0)
869.2
"BLD",6504,"KRN",870,0)
870
"BLD",6504,"KRN",8994,0)
8994
"BLD",6504,"KRN","B",.4,.4)

"BLD",6504,"KRN","B",.401,.401)

"BLD",6504,"KRN","B",.402,.402)

"BLD",6504,"KRN","B",.403,.403)

"BLD",6504,"KRN","B",.5,.5)

"BLD",6504,"KRN","B",.84,.84)

"BLD",6504,"KRN","B",3.6,3.6)

"BLD",6504,"KRN","B",3.8,3.8)

"BLD",6504,"KRN","B",9.2,9.2)

"BLD",6504,"KRN","B",9.8,9.8)

"BLD",6504,"KRN","B",19,19)

"BLD",6504,"KRN","B",19.1,19.1)

"BLD",6504,"KRN","B",101,101)

"BLD",6504,"KRN","B",409.61,409.61)

"BLD",6504,"KRN","B",771,771)

"BLD",6504,"KRN","B",869.2,869.2)

"BLD",6504,"KRN","B",870,870)

"BLD",6504,"KRN","B",8994,8994)

"BLD",6504,"QUES",0)
^9.62^^
"BLD",6504,"REQB",0)
^9.611^1^1
"BLD",6504,"REQB",1,0)
PSA*3.0*41^1
"BLD",6504,"REQB","B","PSA*3.0*41",1)

"BLD",6504,"REQG",0)
^9.611^^
"INI")
PSAP47
"MBREQ")
0
"PKG",487,-1)
1^1
"PKG",487,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability Inventory and Tracking module.
"PKG",487,20,0)
^9.402P^^
"PKG",487,22,0)
^9.49I^1^1
"PKG",487,22,1,0)
3.0^2971024^2981028^66481
"PKG",487,22,1,"PAH",1,0)
47^3060109^123456966
"PKG",487,22,1,"PAH",1,1,0)
^^9^9^3060109
"PKG",487,22,1,"PAH",1,1,1,0)
HD68504 Invoices not being able to be up loaded. This patch corrects 
"PKG",487,22,1,"PAH",1,1,2,0)
problems with the algorithm used to convert invoice files received from 
"PKG",487,22,1,"PAH",1,1,3,0)
McKesson. The process incorrectly inserts zeros to the transaction set 
"PKG",487,22,1,"PAH",1,1,4,0)
control number, which caused the length of the number to exceed the 
"PKG",487,22,1,"PAH",1,1,5,0)
required specification length. An example of the error message is shown 
"PKG",487,22,1,"PAH",1,1,6,0)
below:
"PKG",487,22,1,"PAH",1,1,7,0)
 
"PKG",487,22,1,"PAH",1,1,8,0)
Control# 0000000000000000000000000033
"PKG",487,22,1,"PAH",1,1,9,0)
The ST control# (piece 3) should be 4 to 9 characters in length.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSABRKU3")
0^1^B20933321
"RTN","PSABRKU3",1,0)
PSABRKU3 ;BIR/JMB/PDW-Upload and Process Prime Vendor Invoice Data - CONT'D ;8/13/97
"RTN","PSABRKU3",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**26,41,47**; 10/24/97
"RTN","PSABRKU3",3,0)
 ;Checking the X12 invoice data.
"RTN","PSABRKU3",4,0)
 S (PSASTCNT,PSAITCNT,PSACTRL(1))=0
"RTN","PSABRKU3",5,0)
 K ^TMP($J,"PSAPV SET"),PSAERR
"RTN","PSABRKU3",6,0)
 S PSALAST=""
"RTN","PSABRKU3",7,0)
 S PSALINE=0 F  S PSALINE=$O(^TMP($J,"PSAPVS",PSALINE)) Q:PSALINE=""  S PSADATA=^(PSALINE) D
"RTN","PSABRKU3",8,0)
 .;check segment order
"RTN","PSABRKU3",9,0)
 .D ^PSABRKU5 S PSALAST=$P(PSADATA,"^")
"RTN","PSABRKU3",10,0)
ISA .;control header
"RTN","PSABRKU3",11,0)
 .I PSALAST="ISA" D  Q
"RTN","PSABRKU3",12,0)
 ..S PSASTCNT=0
"RTN","PSABRKU3",13,0)
 ..S PSAISA=PSADATA,PSACTRL="" I $L($P(PSADATA,"^",14))'=9 S PSASEG="ISA" D MSG^PSABRKU8
"RTN","PSABRKU3",14,0)
 .;
"RTN","PSABRKU3",15,0)
IEA .;control trailer
"RTN","PSABRKU3",16,0)
 .I PSALAST="IEA" D  Q
"RTN","PSABRKU3",17,0)
 ..I $P(PSADATA,"^",3)'=$P(PSAISA,"^",14) S PSASEG="IEA" D MSG^PSABRKU8
"RTN","PSABRKU3",18,0)
 .;
"RTN","PSABRKU3",19,0)
GS .;group header
"RTN","PSABRKU3",20,0)
 .I PSALAST="GS" S PSAGS=PSADATA D  Q
"RTN","PSABRKU3",21,0)
 ..F %=3,4 S PSAPC=$S(%=3:7,1:9) I $P(PSADATA,"^",%)'=$TR($P(PSAISA,"^",PSAPC)," ") S PSASEG="GS" D MSG^PSABRKU8
"RTN","PSABRKU3",22,0)
 .;
"RTN","PSABRKU3",23,0)
GE .;group trailer
"RTN","PSABRKU3",24,0)
 .I PSALAST="GE" D  Q
"RTN","PSABRKU3",25,0)
 ..I $P(PSADATA,"^",3)'=$P($G(PSAGS),"^",7) S PSASEG="GE" D MSG^PSABRKU8
"RTN","PSABRKU3",26,0)
 .;
"RTN","PSABRKU3",27,0)
ST .;set header
"RTN","PSABRKU3",28,0)
 .I PSALAST="ST" D  Q
"RTN","PSABRKU3",29,0)
 ..S PSAST=PSADATA,PSACTRL=$P(PSADATA,"^",3),PSASTCNT=1,PSAITCNT=0,PSANTYPE=""
"RTN","PSABRKU3",30,0)
 ..I $L(PSACTRL)<4!($L(PSACTRL)>10) S PSASEG="ST" D MSG^PSABRKU8 Q
"RTN","PSABRKU3",31,0)
 .. I PSACTRL="0001" S PSACTRL=0 D RESETST
"RTN","PSABRKU3",32,0)
 ..;PSA*3*41 - McKesson probability of multiple files, may have to
"RTN","PSABRKU3",33,0)
 ..;increment transaction set control numbers in 'ST' & 'SE'
"RTN","PSABRKU3",34,0)
 ..I $D(^TMP($J,"PSAPV SET",PSACTRL,"IN")) D RESETST
"RTN","PSABRKU3",35,0)
 ..I $D(^XTMP("PSAPV",PSACTRL)) D RESETST ;may already be on file
"RTN","PSABRKU3",36,0)
 .;
"RTN","PSABRKU3",37,0)
SE .;set trailer
"RTN","PSABRKU3",38,0)
 .I PSALAST="SE" S PSASTCNT=PSASTCNT+1 D  Q
"RTN","PSABRKU3",39,0)
 ..I $G(PSACTRL(1))'>0,$P(PSADATA,"^",3)'=PSACTRL S PSASEG="SE1" D MSG^PSABRKU8 Q
"RTN","PSABRKU3",40,0)
 ..I PSASTCNT'=$P(PSADATA,"^",2) S PSASEG="SE2" D MSG^PSABRKU8
"RTN","PSABRKU3",41,0)
 .;
"RTN","PSABRKU3",42,0)
BIG .;beginning segment for invoice
"RTN","PSABRKU3",43,0)
 .I PSALAST="BIG" S PSASTCNT=PSASTCNT+1 D  Q
"RTN","PSABRKU3",44,0)
 ..I $P(PSADATA,"^",4)="" S $P(PSADATA,"^",4)=$P(PSADATA,"^",2)
"RTN","PSABRKU3",45,0)
 ..S $P(PSADATA,"^",5)=$TR($P(PSADATA,"^",5)," ")
"RTN","PSABRKU3",46,0)
 ..S ^TMP($J,"PSAPV SET",PSACTRL,"IN")=$P(PSADATA,"^",2,5)
"RTN","PSABRKU3",47,0)
 .;
"RTN","PSABRKU3",48,0)
REF .;(not used)
"RTN","PSABRKU3",49,0)
 .I PSALAST="REF" S PSASTCNT=PSASTCNT+1 Q
"RTN","PSABRKU3",50,0)
 .;
"RTN","PSABRKU3",51,0)
 .;buyer, seller, shipping addresses
"RTN","PSABRKU3",52,0)
N1 .I PSALAST="N1" S PSASTCNT=PSASTCNT+1,PSANTYPE=$P(PSADATA,"^",2) D  Q
"RTN","PSABRKU3",53,0)
 ..I PSANTYPE'="BY",PSANTYPE'="DS",PSANTYPE'="ST" S PSASEG="N1" D MSG^PSABRKU8 Q
"RTN","PSABRKU3",54,0)
 ..S ^TMP($J,"PSAPV SET",PSACTRL,PSANTYPE)=$P(PSADATA,"^",3)
"RTN","PSABRKU3",55,0)
 .;
"RTN","PSABRKU3",56,0)
N2 .I PSALAST="N2" D  Q
"RTN","PSABRKU3",57,0)
 ..D:PSANTYPE="" NTYPE
"RTN","PSABRKU3",58,0)
 ..S $P(^TMP($J,"PSAPV SET",PSACTRL,PSANTYPE),"^",2)=$P(PSADATA,"^",2) S PSASTCNT=PSASTCNT+1
"RTN","PSABRKU3",59,0)
 .;
"RTN","PSABRKU3",60,0)
N3 .I PSALAST="N3" D  Q
"RTN","PSABRKU3",61,0)
 ..D:PSANTYPE="" NTYPE
"RTN","PSABRKU3",62,0)
 ..S $P(^TMP($J,"PSAPV SET",PSACTRL,PSANTYPE),"^",3)=$P(PSADATA,"^",2) S PSASTCNT=PSASTCNT+1
"RTN","PSABRKU3",63,0)
 .;
"RTN","PSABRKU3",64,0)
N4 .I PSALAST="N4" D  Q
"RTN","PSABRKU3",65,0)
 ..D:PSANTYPE="" NTYPE
"RTN","PSABRKU3",66,0)
 ..S $P(^TMP($J,"PSAPV SET",PSACTRL,PSANTYPE),"^",4,6)=$P(PSADATA,"^",2,4) S PSASTCNT=PSASTCNT+1,PSANTYPE=""
"RTN","PSABRKU3",67,0)
 .;
"RTN","PSABRKU3",68,0)
DTM .;date time reference
"RTN","PSABRKU3",69,0)
 .I PSALAST="DTM" S PSASTCNT=PSASTCNT+1 D  Q
"RTN","PSABRKU3",70,0)
 ..S %=$S($P(PSADATA,"^",2)="002":5,$P(PSADATA,"^",2)="035":6,1:0) I '% Q
"RTN","PSABRKU3",71,0)
 ..S $P(^TMP($J,"PSAPV SET",PSACTRL,"IN"),"^",%)=$P(PSADATA,"^",3)
"RTN","PSABRKU3",72,0)
 .;
"RTN","PSABRKU3",73,0)
IT1 .;invoice line item
"RTN","PSABRKU3",74,0)
 .I PSALAST="IT1" S PSASTCNT=PSASTCNT+1,PSAITCNT=PSAITCNT+1 D ITEM Q
"RTN","PSABRKU3",75,0)
CTT .;item count
"RTN","PSABRKU3",76,0)
 .I PSALAST="CTT" S PSASTCNT=PSASTCNT+1 D  Q
"RTN","PSABRKU3",77,0)
 ..I PSAITCNT'=$P(PSADATA,"^",2) S PSASEG="CTT" D MSG^PSABRKU8
"RTN","PSABRKU3",78,0)
 .;
"RTN","PSABRKU3",79,0)
UNKNOWN .;Segment we don't use
"RTN","PSABRKU3",80,0)
 .S PSASTCNT=PSASTCNT+1
"RTN","PSABRKU3",81,0)
 ;
"RTN","PSABRKU3",82,0)
ERROR S PSASEG=$O(PSAERR("")) D:PSASEG'="" ERROR^PSABRKU8
"RTN","PSABRKU3",83,0)
 Q
"RTN","PSABRKU3",84,0)
 ;
"RTN","PSABRKU3",85,0)
NTYPE S PSASEG="NONTYPE" D NONTYPE^PSABRKU8
"RTN","PSABRKU3",86,0)
 Q
"RTN","PSABRKU3",87,0)
 ;
"RTN","PSABRKU3",88,0)
ITEM ;check line item
"RTN","PSABRKU3",89,0)
 I '$P(PSADATA,"^",2) S PSASEG="IT1-1" D MSG^PSABRKU8 Q
"RTN","PSABRKU3",90,0)
 I $P(PSADATA,"^",6)'="DS" S PSASEG="IT1-2" D MSG^PSABRKU8 Q
"RTN","PSABRKU3",91,0)
 I $P(PSADATA,"^",8)="",$P(PSADATA,"^",10)="",$P(PSADATA,"^",12)="" S PSASEG="IT1-3" D MSG^PSABRKU8 Q
"RTN","PSABRKU3",92,0)
 ;"IT1" Seg=Qty Invoiced ^ Unit of Measure ^ Unit Price ^ Basic Unit Code "DS" ^ NDC ^ VSN
"RTN","PSABRKU3",93,0)
 S PSAITEM=+$P(PSADATA,"^",2),^TMP($J,"PSAPV SET",PSACTRL,"IT",PSAITEM)=+$P(PSADATA,"^",3)_"^"_$P(PSADATA,"^",4)_"^"_$P(PSADATA,"^",5)_"^"_$P(PSADATA,"^",8)_"^"_$P(PSADATA,"^",10)
"RTN","PSABRKU3",94,0)
 I $P(PSADATA,"^",12)'="",$P(PSADATA,"^",11)="UP" S $P(^TMP($J,"PSAPV SET",PSACTRL,"IT",PSAITEM),"^",26)=$P(PSADATA,"^",12)
"RTN","PSABRKU3",95,0)
 Q
"RTN","PSABRKU3",96,0)
RESETST ;Reset PSACTRL
"RTN","PSABRKU3",97,0)
 S PSACTRL(1)=+PSACTRL+1,X1=PSACTRL(1)
"RTN","PSABRKU3",98,0)
 S PSACTRL=X1 I $D(^TMP($J,"PSAPV SET",PSACTRL)) G RESETST
"RTN","PSABRKU3",99,0)
 I $D(^XTMP("PSAPV",PSACTRL)) G RESETST
"RTN","PSABRKU3",100,0)
 Q
"RTN","PSAP47")
0^2^B484753
"RTN","PSAP47",1,0)
PSAP47 ;BHM/DB/PDW - CORRECT DATA IN XTMP("PSAPV" ;9/30/04
"RTN","PSAP47",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**47**; 10/24/97
"RTN","PSAP47",3,0)
 Q:'$D(^XTMP("PSAPV"))
"RTN","PSAP47",4,0)
 S X=0 F  S X=$O(^XTMP("PSAPV",X)) Q:+X'>0  S Y=+X D
"RTN","PSAP47",5,0)
 . F  Q:'$D(^XTMP("PSAPNEW",Y))  S Y=Y+1
"RTN","PSAP47",6,0)
 . M ^XTMP("PSAPNEW",Y)=^XTMP("PSAPV",X) ;W !,X,?30," =>  ",Y
"RTN","PSAP47",7,0)
 S ^XTMP("PSAPNEW",0)=^XTMP("PSAPV",0)
"RTN","PSAP47",8,0)
 K ^XTMP("PSAPV")
"RTN","PSAP47",9,0)
 M ^XTMP("PSAPV")=^XTMP("PSAPNEW")
"RTN","PSAP47",10,0)
 K ^XTMP("PSAPNEW"),X,Y
"RTN","PSAP47",11,0)
 Q
"VER")
8.0^22.0
"BLD",6504,6)
^39
**END**
**END**
