Released XU*8*240 SEQ #237
Extracted from mail message
**KIDS**:XU*8.0*240^

**INSTALL NAME**
XU*8.0*240
"BLD",416,0)
XU*8.0*240^KERNEL^0^3030129^y
"BLD",416,1,0)
^^2^2^3020802^^
"BLD",416,1,1,0)
See patch XU*8*240 in the National Patch Module on FORUM for complete
"BLD",416,1,2,0)
information on this patch.
"BLD",416,4,0)
^9.64PA^^
"BLD",416,"KRN",0)
^9.67PA^8989.52^17
"BLD",416,"KRN",.4,0)
.4
"BLD",416,"KRN",.401,0)
.401
"BLD",416,"KRN",.402,0)
.402
"BLD",416,"KRN",.403,0)
.403
"BLD",416,"KRN",.5,0)
.5
"BLD",416,"KRN",.84,0)
.84
"BLD",416,"KRN",3.6,0)
3.6
"BLD",416,"KRN",3.8,0)
3.8
"BLD",416,"KRN",9.2,0)
9.2
"BLD",416,"KRN",9.8,0)
9.8
"BLD",416,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",416,"KRN",9.8,"NM",1,0)
XLFNAME^^0^B54765617
"BLD",416,"KRN",9.8,"NM",2,0)
XLFNAME1^^0^B51926851
"BLD",416,"KRN",9.8,"NM","B","XLFNAME",1)

"BLD",416,"KRN",9.8,"NM","B","XLFNAME1",2)

"BLD",416,"KRN",19,0)
19
"BLD",416,"KRN",19.1,0)
19.1
"BLD",416,"KRN",101,0)
101
"BLD",416,"KRN",409.61,0)
409.61
"BLD",416,"KRN",8989.51,0)
8989.51
"BLD",416,"KRN",8989.52,0)
8989.52
"BLD",416,"KRN",8994,0)
8994
"BLD",416,"KRN","B",.4,.4)

"BLD",416,"KRN","B",.401,.401)

"BLD",416,"KRN","B",.402,.402)

"BLD",416,"KRN","B",.403,.403)

"BLD",416,"KRN","B",.5,.5)

"BLD",416,"KRN","B",.84,.84)

"BLD",416,"KRN","B",3.6,3.6)

"BLD",416,"KRN","B",3.8,3.8)

"BLD",416,"KRN","B",9.2,9.2)

"BLD",416,"KRN","B",9.8,9.8)

"BLD",416,"KRN","B",19,19)

"BLD",416,"KRN","B",19.1,19.1)

"BLD",416,"KRN","B",101,101)

"BLD",416,"KRN","B",409.61,409.61)

"BLD",416,"KRN","B",8989.51,8989.51)

"BLD",416,"KRN","B",8989.52,8989.52)

"BLD",416,"KRN","B",8994,8994)

"BLD",416,"QUES",0)
^9.62^^
"BLD",416,"REQB",0)
^9.611^2^2
"BLD",416,"REQB",1,0)
XU*8.0*134^2
"BLD",416,"REQB",2,0)
XU*8.0*211^2
"BLD",416,"REQB","B","XU*8.0*134",1)

"BLD",416,"REQB","B","XU*8.0*211",2)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^3000208^4
"PKG",3,22,1,"PAH",1,0)
240^3030129
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3030129
"PKG",3,22,1,"PAH",1,1,1,0)
See patch XU*8*240 in the National Patch Module on FORUM for complete
"PKG",3,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XLFNAME")
0^1^B54765617
"RTN","XLFNAME",1,0)
XLFNAME ;CIOFO-SF/TKW,MKO-Utilities for person name fields ;10:12 AM  29 Jan 2003
"RTN","XLFNAME",2,0)
 ;;8.0;KERNEL;**134,211,240**;Jul 10, 1995
"RTN","XLFNAME",3,0)
 ;
"RTN","XLFNAME",4,0)
STDNAME(XUNAME,XUFLAG,XUAUD) ;Standardize name XUNAME
"RTN","XLFNAME",5,0)
 ; XUNAME - In, name to be standardized. Out, standardized name
"RTN","XLFNAME",6,0)
 ; XUFLAG - In, "C" : return components in XUNAME array
"RTN","XLFNAME",7,0)
 ;              "F" : Assume input is in general form
"RTN","XLFNAME",8,0)
 ;                     Family,Given Middle Suffix
"RTN","XLFNAME",9,0)
 ;              "G" : Don't return XUAUD("GIVEN")
"RTN","XLFNAME",10,0)
 ;              "P" : Remove parenthetical text
"RTN","XLFNAME",11,0)
 ;.XUAUD  - Out:
"RTN","XLFNAME",12,0)
 ;           XUAUD = original name passed in
"RTN","XLFNAME",13,0)
 ;           XUAUD(subsc)="" if problems
"RTN","XLFNAME",14,0)
 ;
"RTN","XLFNAME",15,0)
 N I,XUFAM,XUNM,XUOUT,XUMOV,XUREST,XUSP
"RTN","XLFNAME",16,0)
 S XUOUT=$G(XUFLAG)["C"
"RTN","XLFNAME",17,0)
 N:XUOUT XUFAMO,XURESTO
"RTN","XLFNAME",18,0)
 K XUAUD S XUAUD=XUNAME
"RTN","XLFNAME",19,0)
 ;
"RTN","XLFNAME",20,0)
 F I="FAMILY","GIVEN","MIDDLE","SUFFIX" S XUNM(I)="" S:XUOUT XUOUT(I)=""
"RTN","XLFNAME",21,0)
 S:XUNAME?.E1" TEST" XUNAME=$E(XUNAME,1,$L(XUNAME)-5)
"RTN","XLFNAME",22,0)
 ;
"RTN","XLFNAME",23,0)
 I $G(XUFLAG)["P",XUNAME?.E1(1"(",1"[",1"{").E D
"RTN","XLFNAME",24,0)
 . S XUNAME=$$PARENS^XLFNAME1(XUNAME)
"RTN","XLFNAME",25,0)
 . S:XUAUD'=XUNAME XUAUD("STRIP")=""
"RTN","XLFNAME",26,0)
 ;
"RTN","XLFNAME",27,0)
 S:XUNAME?1"EEE".E!(XUNAME?.E1" FEE")!(XUNAME?1A1"-".E) XUAUD("NOTE")=""
"RTN","XLFNAME",28,0)
 ;
"RTN","XLFNAME",29,0)
 ;If no comma, assume given name first
"RTN","XLFNAME",30,0)
 I XUNAME'[",",$G(XUFLAG)'["F" G GIVFRST
"RTN","XLFNAME",31,0)
 ;
"RTN","XLFNAME",32,0)
 ;Standardize Family
"RTN","XLFNAME",33,0)
 ;(don't remove internal spaces or convert suffixes yet)
"RTN","XLFNAME",34,0)
 I $E(XUNAME,1,3)="ST." S XUAUD("FAMILY")=""
"RTN","XLFNAME",35,0)
 S XUFAM=$$CLEANC^XLFNAME1($P(XUNAME,","),"FI",.XUAUD)
"RTN","XLFNAME",36,0)
 S XUFAM=$$PUNC(XUFAM,.XUAUD)
"RTN","XLFNAME",37,0)
 D:XUOUT
"RTN","XLFNAME",38,0)
 . S XUFAMO=$$CLEANC^XLFNAME1($P(XUNAME,","),"FO",.XUAUD)
"RTN","XLFNAME",39,0)
 . S XUFAMO=$$PUNC(XUFAMO,.XUAUD)
"RTN","XLFNAME",40,0)
 ;
"RTN","XLFNAME",41,0)
 ;Look for suffixes at end of Family
"RTN","XLFNAME",42,0)
 D SUFEND^XLFNAME1(.XUFAM,.XUFAMO,.XUNM,.XUOUT,.XUAUD)
"RTN","XLFNAME",43,0)
 S:XUNM("SUFFIX")]"" XUAUD("SUFFIX")=""
"RTN","XLFNAME",44,0)
 S XUNM("FAMILY")=XUFAM S:XUOUT XUOUT("FAMILY")=XUFAMO
"RTN","XLFNAME",45,0)
 ;
"RTN","XLFNAME",46,0)
 ;Parse rest of name
"RTN","XLFNAME",47,0)
 S XUREST=$P(XUNAME,",",2,999)
"RTN","XLFNAME",48,0)
 S XUSP=XUREST?1" "1.E
"RTN","XLFNAME",49,0)
 D:XUOUT
"RTN","XLFNAME",50,0)
 . S XURESTO=$$CLEANC^XLFNAME1(XUREST,"O",.XUAUD)
"RTN","XLFNAME",51,0)
 . S XURESTO=$$PUNC(XUREST,.XUAUD)
"RTN","XLFNAME",52,0)
 S XUREST=$$CLEANC^XLFNAME1(XUREST,"I",.XUAUD)
"RTN","XLFNAME",53,0)
 S XUREST=$$PUNC(XUREST,.XUAUD)
"RTN","XLFNAME",54,0)
 D MOVSUF(.XUREST,.XUOUT,.XURESTO,.XUAUD,.XUMOV)
"RTN","XLFNAME",55,0)
 D N2(XUREST,.XUNM,.XUOUT,$G(XURESTO),.XUAUD)
"RTN","XLFNAME",56,0)
 ;
"RTN","XLFNAME",57,0)
 ;Account for names that look like only Family and Suffix(es)
"RTN","XLFNAME",58,0)
 I XUNM("MIDDLE")="",$$CHKSUF^XLFNAME1(XUNM("GIVEN"))]"" D
"RTN","XLFNAME",59,0)
 . N XUCNT,XUSUF1,XUSUF2
"RTN","XLFNAME",60,0)
 . I 'XUSP Q:$E(XUNM("GIVEN"))'?1N
"RTN","XLFNAME",61,0)
 . S XUCNT=$L(XUNM("SUFFIX")," ")
"RTN","XLFNAME",62,0)
 . S XUSUF1=$P(XUNM("SUFFIX")," ",XUCNT-XUMOV+1,XUCNT)
"RTN","XLFNAME",63,0)
 . S XUSUF2=$P(XUNM("SUFFIX")," ",1,XUCNT-XUMOV)
"RTN","XLFNAME",64,0)
 . S XUNM("SUFFIX")=$$JOIN($$JOIN(XUSUF1,$$ROMAN^XLFNAME1(XUNM("GIVEN"))),XUSUF2)
"RTN","XLFNAME",65,0)
 . S XUNM("GIVEN")=""
"RTN","XLFNAME",66,0)
 . D:XUOUT
"RTN","XLFNAME",67,0)
 .. S XUSUF1=$P(XUOUT("SUFFIX")," ",XUCNT-XUMOV+1,XUCNT)
"RTN","XLFNAME",68,0)
 .. S XUSUF2=$P(XUOUT("SUFFIX")," ",1,XUCNT-XUMOV)
"RTN","XLFNAME",69,0)
 .. S XUOUT("SUFFIX")=$$JOIN($$JOIN(XUSUF1,XUOUT("GIVEN")),XUSUF2)
"RTN","XLFNAME",70,0)
 .. S XUOUT("GIVEN")=""
"RTN","XLFNAME",71,0)
 ;
"RTN","XLFNAME",72,0)
 D BLDSTD(.XUNAME,.XUNM,.XUOUT,.XUAUD)
"RTN","XLFNAME",73,0)
 K:$G(XUFLAG)["G" XUAUD("GIVEN")
"RTN","XLFNAME",74,0)
 Q
"RTN","XLFNAME",75,0)
 ;
"RTN","XLFNAME",76,0)
BLDSTD(XUNAME,XUNM,XUOUT,XUAUD) ;Build standard name in XUNAME
"RTN","XLFNAME",77,0)
 ;Put components in XUNAME array
"RTN","XLFNAME",78,0)
 N I,J
"RTN","XLFNAME",79,0)
 K XUNAME M:XUOUT XUNAME=XUOUT
"RTN","XLFNAME",80,0)
 ;
"RTN","XLFNAME",81,0)
 S XUNAME=XUNM("FAMILY")_","
"RTN","XLFNAME",82,0)
 S:XUNAME[" " XUNAME=$TR(XUNAME," "),XUAUD("SPACE")=""
"RTN","XLFNAME",83,0)
 ;
"RTN","XLFNAME",84,0)
 I XUNM("GIVEN")]"" S XUNAME=XUNAME_XUNM("GIVEN")
"RTN","XLFNAME",85,0)
 E  S XUAUD("GIVEN")=""
"RTN","XLFNAME",86,0)
 S:XUNM("MIDDLE")]"" XUNAME=XUNAME_" "_XUNM("MIDDLE")
"RTN","XLFNAME",87,0)
 S:XUNM("SUFFIX")]"" XUNAME=XUNAME_" "_XUNM("SUFFIX")
"RTN","XLFNAME",88,0)
 S:XUNAME?.E1"," XUNAME=$E(XUNAME,1,$L(XUNAME)-1)
"RTN","XLFNAME",89,0)
 S:XUNAME?.E1N.E XUAUD("NUMBER")=""
"RTN","XLFNAME",90,0)
 ;
"RTN","XLFNAME",91,0)
 ;Remove spaces after periods, and ~ and ^, in name components
"RTN","XLFNAME",92,0)
 I XUOUT S I="" F  S I=$O(XUNAME(I)) Q:I=""  D
"RTN","XLFNAME",93,0)
 . S XUNAME(I)=$TR(XUNAME(I),"`^") Q:XUNAME(I)'[". "
"RTN","XLFNAME",94,0)
 . N J S J=0 F  S J=$F(XUNAME(I),". ",J) Q:'J  S $E(XUNAME(I),J-1)=""
"RTN","XLFNAME",95,0)
 Q
"RTN","XLFNAME",96,0)
 ;
"RTN","XLFNAME",97,0)
GIVFRST ;Come here if name has no comma.
"RTN","XLFNAME",98,0)
 N XUCNT,XUNAM,XUNAMO
"RTN","XLFNAME",99,0)
 ;
"RTN","XLFNAME",100,0)
 ;Do initial standardizing
"RTN","XLFNAME",101,0)
 S XUNAM=$$CLEANC^XLFNAME1(XUNAME,"I",.XUAUD)
"RTN","XLFNAME",102,0)
 S XUNAM=$$PUNC(XUNAME,.XUAUD)
"RTN","XLFNAME",103,0)
 D:XUOUT
"RTN","XLFNAME",104,0)
 . S XUNAMO=$$CLEANC^XLFNAME1(XUNAME,"O",.XUAUD)
"RTN","XLFNAME",105,0)
 . S XUNAMO=$$PUNC(XUNAMO,.XUAUD)
"RTN","XLFNAME",106,0)
 ;
"RTN","XLFNAME",107,0)
 ;Look for suffixes at end
"RTN","XLFNAME",108,0)
 D SUFEND^XLFNAME1(.XUNAM,.XUNAMO,.XUNM,.XUOUT,.XUAUD)
"RTN","XLFNAME",109,0)
 S XUCNT=$L(XUNAM," ")
"RTN","XLFNAME",110,0)
 ;
"RTN","XLFNAME",111,0)
 ;If name contains only suffixes, make first suffix the Family Name
"RTN","XLFNAME",112,0)
 I XUCNT=0 D  Q
"RTN","XLFNAME",113,0)
 . S XUNM("FAMILY")=$P(XUNM("SUFFIX")," ")
"RTN","XLFNAME",114,0)
 . S XUNM("SUFFIX")=$P(XUNM("SUFFIX")," ",2,999)
"RTN","XLFNAME",115,0)
 . S:$G(XUFLAG)'["G" XUAUD("GIVEN")=""
"RTN","XLFNAME",116,0)
 . D:XUOUT
"RTN","XLFNAME",117,0)
 .. S XUOUT("FAMILY")=$P(XUOUT("SUFFIX")," ")
"RTN","XLFNAME",118,0)
 .. S XUOUT("SUFFIX")=$P(XUOUT("SUFFIX")," ",2,999)
"RTN","XLFNAME",119,0)
 . D BLDSTD(.XUNAME,.XUNM,.XUOUT,.XUAUD)
"RTN","XLFNAME",120,0)
 ;
"RTN","XLFNAME",121,0)
 ;Set Family and rest of name
"RTN","XLFNAME",122,0)
 S XUNM("FAMILY")=$P(XUNAM," ",XUCNT),XUREST=$P(XUNAM," ",1,XUCNT-1)
"RTN","XLFNAME",123,0)
 S:XUOUT XUOUT("FAMILY")=$P(XUNAMO," ",XUCNT),XURESTO=$P(XUNAMO," ",1,XUCNT-1)
"RTN","XLFNAME",124,0)
 ;
"RTN","XLFNAME",125,0)
 ;Process rest of name (don't look for suffixes)
"RTN","XLFNAME",126,0)
 D N2(XUREST,.XUNM,.XUOUT,$G(XURESTO),.XUAUD,"s")
"RTN","XLFNAME",127,0)
 D BLDSTD(.XUNAME,.XUNM,.XUOUT,.XUAUD)
"RTN","XLFNAME",128,0)
 K:$G(XUFLAG)["G" XUAUD("GIVEN")
"RTN","XLFNAME",129,0)
 Q
"RTN","XLFNAME",130,0)
 ;
"RTN","XLFNAME",131,0)
NAMECOMP(XUNM) ;Build components from standard name
"RTN","XLFNAME",132,0)
 S XUNM("FAMILY")=$P(XUNM,",")
"RTN","XLFNAME",133,0)
 D N2($P(XUNM,",",2,999),.XUNM)
"RTN","XLFNAME",134,0)
 S XUNM("MIDDLE")=$G(XUNM("MIDDLE"))
"RTN","XLFNAME",135,0)
 S XUNM("SUFFIX")=$G(XUNM("SUFFIX"))
"RTN","XLFNAME",136,0)
 Q
"RTN","XLFNAME",137,0)
 ;
"RTN","XLFNAME",138,0)
MOVSUF(XUREST,XUOUT,XURESTO,XUAUD,XUMOV) ;Move suffixes immediately in front to the end
"RTN","XLFNAME",139,0)
 N XUI,XUCNT
"RTN","XLFNAME",140,0)
 S XUCNT=$L(XUREST," "),XUMOV=0
"RTN","XLFNAME",141,0)
 F XUI=1:1:XUCNT I $$CHKSUF1^XLFNAME1($P(XUREST," ",XUI))="" S XUI=XUI-1 Q
"RTN","XLFNAME",142,0)
 I XUI,XUI<XUCNT D
"RTN","XLFNAME",143,0)
 . S XUMOV=XUI
"RTN","XLFNAME",144,0)
 . S XUREST=$P(XUREST," ",XUI+1,999)_" "_$P(XUREST," ",1,XUI)
"RTN","XLFNAME",145,0)
 . S:XUOUT XURESTO=$P(XURESTO," ",XUI+1,999)_" "_$P(XURESTO," ",1,XUI)
"RTN","XLFNAME",146,0)
 . S XUAUD("SUFFIX")=""
"RTN","XLFNAME",147,0)
 Q
"RTN","XLFNAME",148,0)
 ;
"RTN","XLFNAME",149,0)
PUNC(XUNAME,XUAUD) ;Remove name pieces that are purely punctuation
"RTN","XLFNAME",150,0)
 N XUC,XUI,XUNEW
"RTN","XLFNAME",151,0)
 S XUNEW=""
"RTN","XLFNAME",152,0)
 F XUI=1:1:$L(XUNAME," ") D
"RTN","XLFNAME",153,0)
 . S XUC=$P(XUNAME," ",XUI)
"RTN","XLFNAME",154,0)
 . I XUC?1.P S:XUC'?1."." XUAUD("PUNC")="" Q
"RTN","XLFNAME",155,0)
 . S XUNEW=$$JOIN(XUNEW,XUC)
"RTN","XLFNAME",156,0)
 Q XUNEW
"RTN","XLFNAME",157,0)
 ;
"RTN","XLFNAME",158,0)
N2(XUREST,XUNM,XUOUT,XURESTO,XUAUD,XUFLAG) ;Build components from non-family name
"RTN","XLFNAME",159,0)
 N XUCNT,XUGIVEN,XUI,XUMIDDLE,XUSUF,XUSUFFIX,XUX,X
"RTN","XLFNAME",160,0)
 S XUOUT=$G(XUOUT) N:XUOUT XUGIVENO,XUMIDO,XUSUFO,XUXO
"RTN","XLFNAME",161,0)
 S XUCNT=$L(XUREST," ")
"RTN","XLFNAME",162,0)
 ;
"RTN","XLFNAME",163,0)
 ;Get Given from 1st space-piece, quit if only name
"RTN","XLFNAME",164,0)
 S XUNM("GIVEN")=$P(XUREST," ") S:XUOUT XUOUT("GIVEN")=$P(XURESTO," ")
"RTN","XLFNAME",165,0)
 Q:XUCNT<2
"RTN","XLFNAME",166,0)
 ;
"RTN","XLFNAME",167,0)
 S (XUSUF,XUMIDDLE,XUGIVEN)="" S:XUOUT (XUSUFO,XUMIDO,XUGIVENO)=""
"RTN","XLFNAME",168,0)
 ;
"RTN","XLFNAME",169,0)
 F XUI=XUCNT:-1:2 D
"RTN","XLFNAME",170,0)
 . S XUX=$P(XUREST," ",XUI)
"RTN","XLFNAME",171,0)
 . S:XUOUT XUXO=$P(XURESTO," ",XUI)
"RTN","XLFNAME",172,0)
 . ;
"RTN","XLFNAME",173,0)
 . ;If no middle yet, check for suffix
"RTN","XLFNAME",174,0)
 . I XUMIDDLE="",$G(XUFLAG)'["s" D  Q:XUSUFFIX]""
"RTN","XLFNAME",175,0)
 .. S XUSUFFIX=""
"RTN","XLFNAME",176,0)
 .. I XUI=2,"I^V^X"[XUX S XUAUD("SUFFIX")="" Q
"RTN","XLFNAME",177,0)
 .. I XUI>2,XUX="D",$P(XUREST," ",XUI-1)="M" S XUAUD("SUFFIX")="" Q
"RTN","XLFNAME",178,0)
 .. S XUSUFFIX=$$CHKSUF^XLFNAME1(XUX) Q:XUSUFFIX=""
"RTN","XLFNAME",179,0)
 .. S X=XUSUFFIX,XUSUFFIX=$$ROMAN^XLFNAME1(XUSUFFIX)
"RTN","XLFNAME",180,0)
 .. I XUI=2,X=XUSUFFIX S XUAUD("SUFFIX")=""
"RTN","XLFNAME",181,0)
 .. S XUSUF=$$JOIN(XUSUFFIX,XUSUF)
"RTN","XLFNAME",182,0)
 .. S:XUOUT XUSUFO=$$JOIN(XUXO,XUSUFO)
"RTN","XLFNAME",183,0)
 . ;
"RTN","XLFNAME",184,0)
 . ;If not suffix, and no middle, set middle
"RTN","XLFNAME",185,0)
 . I XUMIDDLE="" S XUMIDDLE=XUX S:XUOUT XUMIDO=XUXO Q
"RTN","XLFNAME",186,0)
 . ;
"RTN","XLFNAME",187,0)
 . ;Otherwise, put in Given
"RTN","XLFNAME",188,0)
 . S:XUI=2 XUAUD("MIDDLE")=""
"RTN","XLFNAME",189,0)
 . S XUGIVEN=$$JOIN(XUX,XUGIVEN)
"RTN","XLFNAME",190,0)
 . S:XUOUT XUGIVENO=$$JOIN(XUXO,XUGIVENO)
"RTN","XLFNAME",191,0)
 ;
"RTN","XLFNAME",192,0)
 D:XUSUF]""
"RTN","XLFNAME",193,0)
 . S XUNM("SUFFIX")=$$JOIN($G(XUNM("SUFFIX")),XUSUF)
"RTN","XLFNAME",194,0)
 . S:XUOUT XUOUT("SUFFIX")=$$JOIN($G(XUOUT("SUFFIX")),XUSUFO)
"RTN","XLFNAME",195,0)
 ;
"RTN","XLFNAME",196,0)
 S XUNM("MIDDLE")=XUMIDDLE
"RTN","XLFNAME",197,0)
 S:XUOUT XUOUT("MIDDLE")=XUMIDO
"RTN","XLFNAME",198,0)
 D:"^NMI^NMN^"[(U_XUNM("MIDDLE")_U)
"RTN","XLFNAME",199,0)
 . S XUNM("MIDDLE")="" S:XUOUT XUOUT("MIDDLE")=""
"RTN","XLFNAME",200,0)
 . S XUAUD("NM")=""
"RTN","XLFNAME",201,0)
 ;
"RTN","XLFNAME",202,0)
 D:XUGIVEN]""
"RTN","XLFNAME",203,0)
 . S XUNM("GIVEN")=XUNM("GIVEN")_" "_XUGIVEN
"RTN","XLFNAME",204,0)
 . S:XUOUT XUOUT("GIVEN")=XUOUT("GIVEN")_" "_XUGIVENO
"RTN","XLFNAME",205,0)
 Q
"RTN","XLFNAME",206,0)
 ;
"RTN","XLFNAME",207,0)
JOIN(S1,S2) ;Return S1 joined with S2 (separate by a space)
"RTN","XLFNAME",208,0)
 Q $G(S1)_$E(" ",$G(S1)]""&($G(S2)]""))_$G(S2)
"RTN","XLFNAME",209,0)
 ;
"RTN","XLFNAME",210,0)
NAMEFMT(XUNAME,XUFMT,XUFLAG,XUDLM) ;Name formatting routine
"RTN","XLFNAME",211,0)
 G NAMEFMTX^XLFNAME1
"RTN","XLFNAME",212,0)
 ;
"RTN","XLFNAME",213,0)
CLEANC(XUPART,XUFLAG,XUAUD) ;Component standardization
"RTN","XLFNAME",214,0)
 G CLEANCX^XLFNAME1
"RTN","XLFNAME",215,0)
 ;
"RTN","XLFNAME",216,0)
BLDNAME(XUNC,XUMAX) ;Build standard name from components
"RTN","XLFNAME",217,0)
 Q $$NAMEFMT(.XUNC,"F","CSL"_+$G(XUMAX))
"RTN","XLFNAME",218,0)
 ;
"RTN","XLFNAME",219,0)
HLNAME(XUNAME,XUFLAG,XUDLM) ;Convert name to HL7 format
"RTN","XLFNAME",220,0)
 N XUF
"RTN","XLFNAME",221,0)
 S XUF=$E("S",$G(XUFLAG)["S")
"RTN","XLFNAME",222,0)
 S:$G(XUFLAG)["L" XUF=XUF_"L"_+$P(XUFLAG,"L",2)
"RTN","XLFNAME",223,0)
 Q $$NAMEFMT^XLFNAME(.XUNAME,"H",XUF,$G(XUDLM))
"RTN","XLFNAME",224,0)
 ;
"RTN","XLFNAME",225,0)
FMNAME(XUNAME,XUFLAG,XUDLM) ;Convert HL7 name string to standard name or name components
"RTN","XLFNAME",226,0)
 G F^XLFNAME6
"RTN","XLFNAME",227,0)
 ;
"RTN","XLFNAME",228,0)
PRE ;Pre-install for patch XU*8.0*134
"RTN","XLFNAME",229,0)
 G PRE^XLFNAME3
"RTN","XLFNAME",230,0)
 ;
"RTN","XLFNAME",231,0)
POST ;Post-install for XU*8.0*134 (conversion)
"RTN","XLFNAME",232,0)
 G POST^XLFNAME3
"RTN","XLFNAME",233,0)
 ;
"RTN","XLFNAME",234,0)
GENERATE ;Generate information in ^XTMP about changes that will take
"RTN","XLFNAME",235,0)
 ;place when CONVERT^XLFNAME is run
"RTN","XLFNAME",236,0)
 G GENERATE^XLFNAME5
"RTN","XLFNAME",237,0)
 ;
"RTN","XLFNAME",238,0)
PRINT ;Print the information in ^XTMP
"RTN","XLFNAME",239,0)
 G PRINT^XLFNAME4
"RTN","XLFNAME",240,0)
 ;
"RTN","XLFNAME",241,0)
CONVERT ;Convert the Names in the New Person file
"RTN","XLFNAME",242,0)
 G CONVERT^XLFNAME5
"RTN","XLFNAME1")
0^2^B51926851
"RTN","XLFNAME1",1,0)
XLFNAME1 ;CIOFO-SF/TKW,MKO-Utilities for person name fields ;9:25 AM  29 Jan 2003
"RTN","XLFNAME1",2,0)
 ;;8.0;KERNEL;**134,240**;Jul 10, 1995
"RTN","XLFNAME1",3,0)
 ;
"RTN","XLFNAME1",4,0)
REMDBL(X,S) ;For each char in S, remove double chars
"RTN","XLFNAME1",5,0)
 N I,J
"RTN","XLFNAME1",6,0)
 F I=1:1:$L(S) S C=$E(S,I) D
"RTN","XLFNAME1",7,0)
 . F  S J=$F(X,C_C) Q:'J  S $E(X,J-1)=""
"RTN","XLFNAME1",8,0)
 Q X
"RTN","XLFNAME1",9,0)
 ;
"RTN","XLFNAME1",10,0)
REMBE(X,S) ;Remove each char in S from the beg and end of X
"RTN","XLFNAME1",11,0)
 N I
"RTN","XLFNAME1",12,0)
 F I=1:1:$L(X) Q:S'[$E(X,I)
"RTN","XLFNAME1",13,0)
 S X=$E(X,I,999)
"RTN","XLFNAME1",14,0)
 F I=$L(X):-1:1 Q:S'[$E(X,I)
"RTN","XLFNAME1",15,0)
 S X=$E(X,1,I)
"RTN","XLFNAME1",16,0)
 Q X
"RTN","XLFNAME1",17,0)
 ;
"RTN","XLFNAME1",18,0)
ROMAN(X) ; Replace numeric suffixes to Roman Numeral equivalents
"RTN","XLFNAME1",19,0)
 Q:X'?.E1.N.E X
"RTN","XLFNAME1",20,0)
 N IN,OUT
"RTN","XLFNAME1",21,0)
 ;
"RTN","XLFNAME1",22,0)
 S IN="^1ST^2ND^3RD^4TH^5TH^6TH^7TH^8TH^9TH^10TH^"
"RTN","XLFNAME1",23,0)
 S OUT="I^II^III^IV^V^VI^VII^VIII^IX^X"
"RTN","XLFNAME1",24,0)
 S:IN[(U_X_U) X=$P(OUT,U,$L($P(IN,U_X_U),U))
"RTN","XLFNAME1",25,0)
 Q X
"RTN","XLFNAME1",26,0)
 ;
"RTN","XLFNAME1",27,0)
CHKSUF(X) ;Return X if it looks like a suffix; otherwise, return null
"RTN","XLFNAME1",28,0)
 N V
"RTN","XLFNAME1",29,0)
 Q:"^I^II^III^IV^V^VI^VII^VIII^IX^X^JR^SR^DR^MD^ESQ^DDS^RN^"[(U_X_U) X
"RTN","XLFNAME1",30,0)
 Q:"^1ST^2ND^3RD^4TH^5TH^6TH^7TH^8TH^9TH^10TH^"[(U_X_U) X
"RTN","XLFNAME1",31,0)
 I $L(X)>1,X'[" ",X'="NMN" D  I V="" S XUAUD("SUFFIX")="" Q X
"RTN","XLFNAME1",32,0)
 . F V="A","E","I","O","U","Y","" Q:X[V
"RTN","XLFNAME1",33,0)
 Q ""
"RTN","XLFNAME1",34,0)
 ;
"RTN","XLFNAME1",35,0)
CHKSUF1(X) ; Return X if it looks like a suffix, but not I, V, X
"RTN","XLFNAME1",36,0)
 N V
"RTN","XLFNAME1",37,0)
 Q:"^II^III^IV^VI^VII^VIII^IX^JR^SR^DR^MD^ESQ^DDS^RN^"[(U_X_U) X
"RTN","XLFNAME1",38,0)
 Q:"^1ST^2ND^3RD^4TH^5TH^6TH^7TH^8TH^9TH^10TH^"[(U_X_U) X
"RTN","XLFNAME1",39,0)
 Q ""
"RTN","XLFNAME1",40,0)
 ;
"RTN","XLFNAME1",41,0)
PERIOD(X) ; Change X so that there is a space after every period
"RTN","XLFNAME1",42,0)
 Q:X'["." X
"RTN","XLFNAME1",43,0)
 N I
"RTN","XLFNAME1",44,0)
 S I=0 F  S I=$F(X,".",I) Q:'I!(I'<$L(X))  D
"RTN","XLFNAME1",45,0)
 . S:$E(X,I)'=" " X=$E(X,1,I-1)_" "_$E(X,I,999)
"RTN","XLFNAME1",46,0)
 Q X
"RTN","XLFNAME1",47,0)
 ;
"RTN","XLFNAME1",48,0)
PARENS(X) ;Strip parenthetical part(s) from X
"RTN","XLFNAME1",49,0)
 N C,DONE,LEV,P,P1,P2
"RTN","XLFNAME1",50,0)
 F  Q:X'?.E1(1"(",1"[",1"{").E  D  Q:'P2
"RTN","XLFNAME1",51,0)
 . S (DONE,LEV,P1,P2)=0
"RTN","XLFNAME1",52,0)
 . F P=1:1:$L(X) D  Q:DONE
"RTN","XLFNAME1",53,0)
 .. S C=$E(X,P)
"RTN","XLFNAME1",54,0)
 .. I C?1(1"(",1"[",1"{") S:'LEV P1=P S LEV=LEV+1
"RTN","XLFNAME1",55,0)
 .. E  I P1,C?1(1")",1"]",1"}") S P2=P,LEV=LEV-1 S:'LEV DONE=1
"RTN","XLFNAME1",56,0)
 . S:P2 X=$E(X,1,P1-1)_$E(X,P2+1,999)
"RTN","XLFNAME1",57,0)
 Q X
"RTN","XLFNAME1",58,0)
 ;
"RTN","XLFNAME1",59,0)
SUFEND(XUN,XUNO,XUNM,XUOUT,XUAUD) ;Look for suffixes at end of XUN
"RTN","XLFNAME1",60,0)
 ;Put in XUNM("SUFFIX")
"RTN","XLFNAME1",61,0)
 ;Remove those suffixes from XUN and XUNO
"RTN","XLFNAME1",62,0)
 N XUI,XUSUF,XUSUFO,XUSUFFIX,XUX
"RTN","XLFNAME1",63,0)
 S XUSUF="" S:XUOUT XUSUFO=""
"RTN","XLFNAME1",64,0)
 ;
"RTN","XLFNAME1",65,0)
 F XUI=$L(XUN," "):-1:2 D  Q:XUSUFFIX=""
"RTN","XLFNAME1",66,0)
 . S XUX=$P(XUN," ",XUI)
"RTN","XLFNAME1",67,0)
 . S XUSUFFIX=$$CHKSUF(XUX) Q:XUSUFFIX=""
"RTN","XLFNAME1",68,0)
 . S XUSUF=$$JOIN($$ROMAN(XUSUFFIX),XUSUF)
"RTN","XLFNAME1",69,0)
 . S XUN=$P(XUN," ",1,XUI-1)
"RTN","XLFNAME1",70,0)
 . D:XUOUT
"RTN","XLFNAME1",71,0)
 .. S XUSUFO=$P(XUNO," ",XUI)_$E(" ",XUSUFO]"")_XUSUFO
"RTN","XLFNAME1",72,0)
 .. S XUNO=$P(XUNO," ",1,XUI-1)
"RTN","XLFNAME1",73,0)
 ;
"RTN","XLFNAME1",74,0)
 I XUSUF]"" S XUNM("SUFFIX")=XUSUF S:XUOUT XUOUT("SUFFIX")=XUSUFO
"RTN","XLFNAME1",75,0)
 Q
"RTN","XLFNAME1",76,0)
 ;
"RTN","XLFNAME1",77,0)
CLEANC(XUPART,XUFLAG,XUAUD) ; Component standardization
"RTN","XLFNAME1",78,0)
CLEANCX ; Entry point from CLEANC^XLFNAME
"RTN","XLFNAME1",79,0)
 Q:$G(XUPART)="" ""
"RTN","XLFNAME1",80,0)
 N XUX,I
"RTN","XLFNAME1",81,0)
 S XUFLAG=$G(XUFLAG)
"RTN","XLFNAME1",82,0)
 ;
"RTN","XLFNAME1",83,0)
 S:XUPART?.E1.L.E XUPART=$$UP^XLFSTR(XUPART)
"RTN","XLFNAME1",84,0)
 ;
"RTN","XLFNAME1",85,0)
 S XUX=$S(XUFLAG["F":"-",1:" ")
"RTN","XLFNAME1",86,0)
 S I=XUPART,XUPART=$TR(XUPART,",:;",XUX_XUX_XUX)
"RTN","XLFNAME1",87,0)
 S:XUPART'=I XUAUD("PUNC")=""
"RTN","XLFNAME1",88,0)
 ;
"RTN","XLFNAME1",89,0)
 Q:XUFLAG["O" $$REMBE($$REMDBL($$PERIOD(XUPART),"- "),"- ")
"RTN","XLFNAME1",90,0)
 ;
"RTN","XLFNAME1",91,0)
 I XUPART["." S XUPART=$TR(XUPART,"."," "),XUAUD("PERIOD")=""
"RTN","XLFNAME1",92,0)
 ;
"RTN","XLFNAME1",93,0)
 I XUFLAG'["I" D
"RTN","XLFNAME1",94,0)
 . F I=1:1:$L(XUPART," ") S $P(XUPART," ",I)=$$ROMAN($P(XUPART," ",I))
"RTN","XLFNAME1",95,0)
 . S:XUPART?.E1N.E XUAUD("NUMBER")=""
"RTN","XLFNAME1",96,0)
 ;
"RTN","XLFNAME1",97,0)
 S I=XUPART,XUPART=$TR(XUPART,"!""#$%&'()*+,./:;<=>?@[\]^_`{|}~")
"RTN","XLFNAME1",98,0)
 S:XUPART'=I XUAUD("PUNC")=""
"RTN","XLFNAME1",99,0)
 ;
"RTN","XLFNAME1",100,0)
 ;Remove all spaces and double hyphens from Family Name
"RTN","XLFNAME1",101,0)
 I XUFLAG["F",XUFLAG'["I" D  Q $$REMBE($$REMDBL(XUPART,"-"),"-")
"RTN","XLFNAME1",102,0)
 . S:XUPART?." "1.ANP1." "1.ANP." " XUAUD("SPACE")=""
"RTN","XLFNAME1",103,0)
 . S XUPART=$TR(XUPART," ")
"RTN","XLFNAME1",104,0)
 ;
"RTN","XLFNAME1",105,0)
 Q $$REMBE($$REMDBL(XUPART,"- "),"- ")
"RTN","XLFNAME1",106,0)
 ;
"RTN","XLFNAME1",107,0)
NAMEFMT(XUNAME,XUFMT,XUFLAG,XUDLM) ; Name formatting routine (extrinsic)
"RTN","XLFNAME1",108,0)
NAMEFMTX ;
"RTN","XLFNAME1",109,0)
 ; XUNAME: Input name components array or Name Components Key fields
"RTN","XLFNAME1",110,0)
 ; XUFMT:  F=Family name first,G=Given name first,H=HL7 (default G)
"RTN","XLFNAME1",111,0)
 ; XUFLAG: P=Include prefix,D=Include degree,S=Standardize components,M=Mixed case
"RTN","XLFNAME1",112,0)
 ; XUDLM:  Delimiter if HL7 message (def = ^)
"RTN","XLFNAME1",113,0)
 N XUBLD,XUI,XULEN,XUN,XUSTEP
"RTN","XLFNAME1",114,0)
 ;
"RTN","XLFNAME1",115,0)
 ;Set defaults
"RTN","XLFNAME1",116,0)
 S XUFMT=$G(XUFMT) S:XUFMT="" XUFMT="G"
"RTN","XLFNAME1",117,0)
 S XUFLAG=$G(XUFLAG)
"RTN","XLFNAME1",118,0)
 S:$G(XUDLM)="" XUDLM=U
"RTN","XLFNAME1",119,0)
 S:XUFLAG["L" XULEN=+$P(XUFLAG,"L",2) S:$G(XULEN)<1 XULEN=256
"RTN","XLFNAME1",120,0)
 ;
"RTN","XLFNAME1",121,0)
 ;Get XUN (name array)
"RTN","XLFNAME1",122,0)
 ;If a name (no array) is passed in
"RTN","XLFNAME1",123,0)
 I $D(XUNAME)<10 D
"RTN","XLFNAME1",124,0)
 . S XUN=$G(XUNAME) Q:XUN=""
"RTN","XLFNAME1",125,0)
 . D STDNAME^XLFNAME(.XUN,"CP")
"RTN","XLFNAME1",126,0)
 ;
"RTN","XLFNAME1",127,0)
 ;Else, if a file, field, iens passed in
"RTN","XLFNAME1",128,0)
 E  I $G(XUNAME("FILE")),$G(XUNAME("FIELD")),$G(XUNAME("IENS"))]"" D
"RTN","XLFNAME1",129,0)
 . N IEN,IENS
"RTN","XLFNAME1",130,0)
 . S IENS=$G(XUNAME("IENS")) S:IENS'?.E1"," IENS=IENS_","
"RTN","XLFNAME1",131,0)
 . S IEN=$O(^VA(20,"BB",+XUNAME("FILE"),+$G(XUNAME("FIELD")),IENS,0))
"RTN","XLFNAME1",132,0)
 . I IEN D
"RTN","XLFNAME1",133,0)
 .. N I
"RTN","XLFNAME1",134,0)
 .. S I=0 F XUI="FAMILY","GIVEN","MIDDLE","PREFIX","SUFFIX","DEGREE" D
"RTN","XLFNAME1",135,0)
 ... S I=I+1,XUN(XUI)=$P($G(^VA(20,IEN,1)),U,I)
"RTN","XLFNAME1",136,0)
 . E  D
"RTN","XLFNAME1",137,0)
 .. N MSG,NAM,DIERR
"RTN","XLFNAME1",138,0)
 .. S NAM=$$GET1^DIQ(+XUNAME("FILE"),IENS,+$G(XUNAME("FIELD")),"I","MSG")
"RTN","XLFNAME1",139,0)
 .. I NAM]"" S XUN=NAM D STDNAME^XLFNAME(.XUN,"CP")
"RTN","XLFNAME1",140,0)
 ;
"RTN","XLFNAME1",141,0)
 ;Else, components passed in
"RTN","XLFNAME1",142,0)
 E  M XUN=XUNAME
"RTN","XLFNAME1",143,0)
 ;
"RTN","XLFNAME1",144,0)
 ;Standardize
"RTN","XLFNAME1",145,0)
 F XUI="FAMILY","GIVEN","MIDDLE","SUFFIX","PREFIX","DEGREE" D
"RTN","XLFNAME1",146,0)
 . S XUN(XUI)=$G(XUN(XUI))
"RTN","XLFNAME1",147,0)
 . I XUFLAG["S",XUN(XUI)]"" S XUN(XUI)=$$CLEANC(XUN(XUI),$E("F",XUI="FAMILY"))
"RTN","XLFNAME1",148,0)
 Q:$G(XUN("FAMILY"))="" ""
"RTN","XLFNAME1",149,0)
 ;
"RTN","XLFNAME1",150,0)
 ; Return in mixed case
"RTN","XLFNAME1",151,0)
 I XUFLAG["M" D
"RTN","XLFNAME1",152,0)
 . N XUCMP,X
"RTN","XLFNAME1",153,0)
 . F XUCMP="FAMILY","GIVEN","MIDDLE","PREFIX" I XUN(XUCMP)]"" S XUN(XUCMP)=$$MIX(XUN(XUCMP))
"RTN","XLFNAME1",154,0)
 . I XUN("DEGREE")]"" S XUN("DEGREE")=$$MIX2(XUN("DEGREE"))
"RTN","XLFNAME1",155,0)
 . I XUN("SUFFIX")]"" S XUN("SUFFIX")=$$MIX2(XUN("SUFFIX"))
"RTN","XLFNAME1",156,0)
 . Q
"RTN","XLFNAME1",157,0)
 ;
"RTN","XLFNAME1",158,0)
 ;Build formatted name, truncate if necessary
"RTN","XLFNAME1",159,0)
 S XUBLD=1 F XUSTEP=0:1 D  Q:$L(XUN)'>XULEN
"RTN","XLFNAME1",160,0)
 . ;Build formatted name
"RTN","XLFNAME1",161,0)
 . I XUBLD S XUBLD=0 D  Q:$L(XUN)'>XULEN
"RTN","XLFNAME1",162,0)
 .. I XUFMT["H" S XUN=$$H(.XUN,XUDLM) Q
"RTN","XLFNAME1",163,0)
 .. I XUFMT["O" S XUN=$$O(.XUN) Q
"RTN","XLFNAME1",164,0)
 .. I XUFMT["G" S XUN=$$G(.XUN,XUFLAG) Q
"RTN","XLFNAME1",165,0)
 .. S XUN=$$F(.XUN,XUFLAG) Q
"RTN","XLFNAME1",166,0)
 . ;
"RTN","XLFNAME1",167,0)
 . ;Truncation steps
"RTN","XLFNAME1",168,0)
 . Q:'XUSTEP
"RTN","XLFNAME1",169,0)
 . I XUSTEP=1 S:XUN("DEGREE")]"" XUN("DEGREE")="",XUBLD=1 Q
"RTN","XLFNAME1",170,0)
 . I XUSTEP=2 S:XUN("PREFIX")]"" XUN("PREFIX")="",XUBLD=1 Q
"RTN","XLFNAME1",171,0)
 . I XUSTEP=3 S:XUN("MIDDLE")]"" XUN("MIDDLE")=$$TRUNC(XUN("MIDDLE"),$L(XUN)-XULEN),XUBLD=1 Q
"RTN","XLFNAME1",172,0)
 . I XUSTEP=4 S:XUN("SUFFIX")]"" XUN("SUFFIX")="",XUBLD=1 Q
"RTN","XLFNAME1",173,0)
 . I XUSTEP=5 S:XUN("GIVEN")]"" XUN("GIVEN")=$$TRUNC(XUN("GIVEN"),$L(XUN)-XULEN),XUBLD=1 Q
"RTN","XLFNAME1",174,0)
 . I XUSTEP=6 S:XUN("FAMILY")]"" XUN("FAMILY")=$$TRUNC(XUN("FAMILY"),$L(XUN)-XULEN),XUBLD=1 Q
"RTN","XLFNAME1",175,0)
 . I XUSTEP=7 S XUN=$E(XUN,1,XULEN) F  Q:XUN'?.E1" "  S XUN=$E(XUN,1,$L(XUN)-1)
"RTN","XLFNAME1",176,0)
 Q XUN
"RTN","XLFNAME1",177,0)
 ;
"RTN","XLFNAME1",178,0)
MIX(X) ; Return name part with only first letter upper-case
"RTN","XLFNAME1",179,0)
 N %,L
"RTN","XLFNAME1",180,0)
 F %=2:1:$L(X) I $E(X,%)?1U,$E(X,%-1)?1A S L=$E(X,%),L=$C($A(L)+32),$E(X,%)=L
"RTN","XLFNAME1",181,0)
 Q X
"RTN","XLFNAME1",182,0)
 ;
"RTN","XLFNAME1",183,0)
MIX2(XUN) ; Properly capitalize suffixes, degrees
"RTN","XLFNAME1",184,0)
 N P,I,L,DIOUT
"RTN","XLFNAME1",185,0)
 F P="DR","PHD","JR","SR","ESQ" S I=$F(XUN,P) I I D
"RTN","XLFNAME1",186,0)
 . Q:$E(XUN,I)?1A
"RTN","XLFNAME1",187,0)
 . I P="PHD" Q:$E(XUN,I-4)?1A  S $E(XUN,I-3,I-1)="PhD" Q
"RTN","XLFNAME1",188,0)
 . S L=$L(P) Q:$E(XUN,I-(L+1))?1A
"RTN","XLFNAME1",189,0)
 . S X=$$MIX($E(XUN,I-L,I-1)),$E(XUN,I-L,I-1)=X
"RTN","XLFNAME1",190,0)
 . Q
"RTN","XLFNAME1",191,0)
 I XUN?.E1.N1.U.E S DIOUT=0 F P=1:1:10 S I=$F(XUN,P) I I D  Q:DIOUT
"RTN","XLFNAME1",192,0)
 . S L=$S(P=1:"ST",P=2:"ND",P=3:"RD",1:"TH")
"RTN","XLFNAME1",193,0)
 . I $E(XUN,I,I+1)'=L Q
"RTN","XLFNAME1",194,0)
 . S $E(XUN,I,I+1)=$S(P=1:"st",P=2:"nd",P=3:"rd",1:"th")
"RTN","XLFNAME1",195,0)
 . S DIOUT=1 Q
"RTN","XLFNAME1",196,0)
 Q XUN
"RTN","XLFNAME1",197,0)
 ;
"RTN","XLFNAME1",198,0)
O(N) ;O format
"RTN","XLFNAME1",199,0)
 Q N("FAMILY")
"RTN","XLFNAME1",200,0)
 ;
"RTN","XLFNAME1",201,0)
F(N,F) ;F format
"RTN","XLFNAME1",202,0)
 N NAM
"RTN","XLFNAME1",203,0)
 S NAM=N("FAMILY")_$S(F["C":",",1:" ")_N("GIVEN")_$E(" ",N("MIDDLE")]"")_N("MIDDLE")
"RTN","XLFNAME1",204,0)
 S NAM=$$SPD(NAM,.N,F)
"RTN","XLFNAME1",205,0)
 S:NAM?.E1(1",",1" ") NAM=$E(NAM,1,$L(NAM)-1)
"RTN","XLFNAME1",206,0)
 Q NAM
"RTN","XLFNAME1",207,0)
 ;
"RTN","XLFNAME1",208,0)
G(N,F) ;G format
"RTN","XLFNAME1",209,0)
 N NAM,I
"RTN","XLFNAME1",210,0)
 S NAM="" F I="GIVEN","MIDDLE","FAMILY" S NAM=$$JOIN(NAM,N(I))
"RTN","XLFNAME1",211,0)
 Q $$SPD(NAM,.N,F)
"RTN","XLFNAME1",212,0)
 ;
"RTN","XLFNAME1",213,0)
H(N,D) ;H format
"RTN","XLFNAME1",214,0)
 N NAM
"RTN","XLFNAME1",215,0)
 S NAM=N("FAMILY")_D_N("GIVEN")_D_N("MIDDLE")_D_N("SUFFIX")_D_N("PREFIX")_D_N("DEGREE")
"RTN","XLFNAME1",216,0)
 F  Q:$E(NAM,$L(NAM))'=D  S NAM=$E(NAM,1,$L(NAM)-1)
"RTN","XLFNAME1",217,0)
 Q NAM
"RTN","XLFNAME1",218,0)
 ;
"RTN","XLFNAME1",219,0)
SPD(NAM,N,F) ;Add Suffix, Prefix, and Degree
"RTN","XLFNAME1",220,0)
 S NAM=$$JOIN(NAM,N("SUFFIX"),$E(",",F["Xc")_" ")
"RTN","XLFNAME1",221,0)
 S:F["P" NAM=$$JOIN(N("PREFIX"),NAM)
"RTN","XLFNAME1",222,0)
 S:F["D" NAM=$$JOIN(NAM,N("DEGREE"),$E(",",F["Dc")_" ")
"RTN","XLFNAME1",223,0)
 Q NAM
"RTN","XLFNAME1",224,0)
 ;
"RTN","XLFNAME1",225,0)
JOIN(S1,S2,D) ;Return S1 joined with S2 (separate by D)
"RTN","XLFNAME1",226,0)
 S:$G(D)="" D=" "
"RTN","XLFNAME1",227,0)
 Q S1_$S($L(S1)&$L(S2):D,1:"")_S2
"RTN","XLFNAME1",228,0)
 ;
"RTN","XLFNAME1",229,0)
TRUNC(NC,OVR) ;Truncate component
"RTN","XLFNAME1",230,0)
 S NC=$E(NC,1,$S($L(NC)>OVR:$L(NC)-OVR,1:1))
"RTN","XLFNAME1",231,0)
 F  Q:NC'?.E1" "  S NC=$E(NC,1,$L(NC)-1)
"RTN","XLFNAME1",232,0)
 Q NC
"VER")
8.0^22.0
**END**
**END**
