Released FB*3.5*101 SEQ #92
Extracted from mail message
**KIDS**:FB*3.5*101^

**INSTALL NAME**
FB*3.5*101
"BLD",7029,0)
FB*3.5*101^FEE BASIS^0^3061205^y
"BLD",7029,1,0)
^^9^9^3061205^
"BLD",7029,1,1,0)
The VistA Fee Basis application provides forms, letters and reports that 
"BLD",7029,1,2,0)
are sent between VHA, vendors and veterans.  This patch modifies VistA 
"BLD",7029,1,3,0)
Fee Basis by replacing the full SSN on those forms, letters and reports 
"BLD",7029,1,4,0)
with X's for the first 5 digits and only printing the last 4 digits in 
"BLD",7029,1,5,0)
the following format: 
"BLD",7029,1,6,0)
          XXX-XX-#### or XXXXX####
"BLD",7029,1,7,0)
 
"BLD",7029,1,8,0)
   **Note that X represents an actual X and # represents the actual SSN
"BLD",7029,1,9,0)
   digit. Pseudo SSN will be changed as above with passed "P" at end.
"BLD",7029,4,0)
^9.64PA^^
"BLD",7029,6.3)
2
"BLD",7029,"KRN",0)
^9.67PA^8989.52^19
"BLD",7029,"KRN",.4,0)
.4
"BLD",7029,"KRN",.401,0)
.401
"BLD",7029,"KRN",.402,0)
.402
"BLD",7029,"KRN",.403,0)
.403
"BLD",7029,"KRN",.5,0)
.5
"BLD",7029,"KRN",.84,0)
.84
"BLD",7029,"KRN",3.6,0)
3.6
"BLD",7029,"KRN",3.8,0)
3.8
"BLD",7029,"KRN",9.2,0)
9.2
"BLD",7029,"KRN",9.8,0)
9.8
"BLD",7029,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",7029,"KRN",9.8,"NM",1,0)
FBAA79^^0^B21933465
"BLD",7029,"KRN",9.8,"NM",2,0)
FBAASL1^^0^B16241469
"BLD",7029,"KRN",9.8,"NM",3,0)
FBAASLP^^0^B46931154
"BLD",7029,"KRN",9.8,"NM",4,0)
FBAAUTL^^0^B22355196
"BLD",7029,"KRN",9.8,"NM",5,0)
FBCHP78^^0^B33168184
"BLD",7029,"KRN",9.8,"NM",6,0)
FBCHSL1^^0^B17943719
"BLD",7029,"KRN",9.8,"NM",7,0)
FBCHSLP^^0^B12851688
"BLD",7029,"KRN",9.8,"NM",8,0)
FBCKDIS^^0^B45741466
"BLD",7029,"KRN",9.8,"NM",9,0)
FBPAY^^0^B23215148
"BLD",7029,"KRN",9.8,"NM",10,0)
FBPAY21^^0^B16167791
"BLD",7029,"KRN",9.8,"NM",11,0)
FBPAY3^^0^B36415963
"BLD",7029,"KRN",9.8,"NM",12,0)
FBPAY671^^0^B36548177
"BLD",7029,"KRN",9.8,"NM",13,0)
FBUCLET1^^0^B48699559
"BLD",7029,"KRN",9.8,"NM","B","FBAA79",1)

"BLD",7029,"KRN",9.8,"NM","B","FBAASL1",2)

"BLD",7029,"KRN",9.8,"NM","B","FBAASLP",3)

"BLD",7029,"KRN",9.8,"NM","B","FBAAUTL",4)

"BLD",7029,"KRN",9.8,"NM","B","FBCHP78",5)

"BLD",7029,"KRN",9.8,"NM","B","FBCHSL1",6)

"BLD",7029,"KRN",9.8,"NM","B","FBCHSLP",7)

"BLD",7029,"KRN",9.8,"NM","B","FBCKDIS",8)

"BLD",7029,"KRN",9.8,"NM","B","FBPAY",9)

"BLD",7029,"KRN",9.8,"NM","B","FBPAY21",10)

"BLD",7029,"KRN",9.8,"NM","B","FBPAY3",11)

"BLD",7029,"KRN",9.8,"NM","B","FBPAY671",12)

"BLD",7029,"KRN",9.8,"NM","B","FBUCLET1",13)

"BLD",7029,"KRN",19,0)
19
"BLD",7029,"KRN",19.1,0)
19.1
"BLD",7029,"KRN",101,0)
101
"BLD",7029,"KRN",409.61,0)
409.61
"BLD",7029,"KRN",771,0)
771
"BLD",7029,"KRN",870,0)
870
"BLD",7029,"KRN",8989.51,0)
8989.51
"BLD",7029,"KRN",8989.52,0)
8989.52
"BLD",7029,"KRN",8994,0)
8994
"BLD",7029,"KRN","B",.4,.4)

"BLD",7029,"KRN","B",.401,.401)

"BLD",7029,"KRN","B",.402,.402)

"BLD",7029,"KRN","B",.403,.403)

"BLD",7029,"KRN","B",.5,.5)

"BLD",7029,"KRN","B",.84,.84)

"BLD",7029,"KRN","B",3.6,3.6)

"BLD",7029,"KRN","B",3.8,3.8)

"BLD",7029,"KRN","B",9.2,9.2)

"BLD",7029,"KRN","B",9.8,9.8)

"BLD",7029,"KRN","B",19,19)

"BLD",7029,"KRN","B",19.1,19.1)

"BLD",7029,"KRN","B",101,101)

"BLD",7029,"KRN","B",409.61,409.61)

"BLD",7029,"KRN","B",771,771)

"BLD",7029,"KRN","B",870,870)

"BLD",7029,"KRN","B",8989.51,8989.51)

"BLD",7029,"KRN","B",8989.52,8989.52)

"BLD",7029,"KRN","B",8994,8994)

"BLD",7029,"QUES",0)
^9.62^^
"BLD",7029,"REQB",0)
^9.611^2^2
"BLD",7029,"REQB",1,0)
FB*3.5*52^2
"BLD",7029,"REQB",2,0)
FB*3.5*69^2
"BLD",7029,"REQB","B","FB*3.5*52",1)

"BLD",7029,"REQB","B","FB*3.5*69",2)

"MBREQ")
0
"PKG",60,-1)
1^1
"PKG",60,0)
FEE BASIS^FB^Used to pay private vendors
"PKG",60,20,0)
^9.402P^1^1
"PKG",60,20,1,0)
2^^FBPMRG
"PKG",60,20,1,1)

"PKG",60,20,"B",2,1)

"PKG",60,22,0)
^9.49I^1^1
"PKG",60,22,1,0)
3.5^2950130^2950313
"PKG",60,22,1,"PAH",1,0)
101^3061205
"PKG",60,22,1,"PAH",1,1,0)
^^9^9^3061205
"PKG",60,22,1,"PAH",1,1,1,0)
The VistA Fee Basis application provides forms, letters and reports that 
"PKG",60,22,1,"PAH",1,1,2,0)
are sent between VHA, vendors and veterans.  This patch modifies VistA 
"PKG",60,22,1,"PAH",1,1,3,0)
Fee Basis by replacing the full SSN on those forms, letters and reports 
"PKG",60,22,1,"PAH",1,1,4,0)
with X's for the first 5 digits and only printing the last 4 digits in 
"PKG",60,22,1,"PAH",1,1,5,0)
the following format: 
"PKG",60,22,1,"PAH",1,1,6,0)
          XXX-XX-#### or XXXXX####
"PKG",60,22,1,"PAH",1,1,7,0)
 
"PKG",60,22,1,"PAH",1,1,8,0)
   **Note that X represents an actual X and # represents the actual SSN
"PKG",60,22,1,"PAH",1,1,9,0)
   digit. Pseudo SSN will be changed as above with passed "P" at end.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","FBAA79")
0^1^B21933465^B21721103
"RTN","FBAA79",1,0)
FBAA79 ;AISC/GRR-PRINT FORM 7079 REQUEST FOR OUTPATIENT MEDICAL SERVICES ;7/NOV/2006
"RTN","FBAA79",2,0)
 ;;3.5;FEE BASIS;**12,23,101**;JAN 30, 1995;Build 2
"RTN","FBAA79",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAA79",4,0)
 W !,"Print 7079's for: " D DT^DICRW,DATE^FBAAUTL G:FBPOP END D SITEP^FBAAUTL G:FBPOP END
"RTN","FBAA79",5,0)
 I '$D(^FBAAA("AF",2)) W !!,*7,"There are no 7079's to be printed!",! G END
"RTN","FBAA79",6,0)
 S FBAASCR=""
"RTN","FBAA79",7,0)
RDHOW W ! S DIR("A")="Want only those that have not yet been printed",DIR("B")="Yes",DIR(0)="Y" D ^DIR K DIR G END:$D(DIRUT) S:Y FBAASCR="Y"
"RTN","FBAA79",8,0)
 D OUTPUT^FBAAS79
"RTN","FBAA79",9,0)
 S VAR="BEGDATE^ENDDATE^FBAASCR",VAL=BEGDATE_"^"_ENDDATE_"^"_FBAASCR,PGM="START^FBAA79",IOP="Q" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBAA79",10,0)
START D SITEP^FBAAUTL G END:FBPOP
"RTN","FBAA79",11,0)
 S UL="",ULL="----------",FBPG=0 F Z=1:1:12 S UL=UL_ULL
"RTN","FBAA79",12,0)
 U IO S FBAASCR=$S(FBAASCR="":"I 1",FBAASCR="Y":"I $S('$D(^FBAAA(DFN,1,FBK,1)):1,$P(^FBAAA(DFN,1,FBK,1),""^"",2)']"""":1,1:0)",1:"I 1")
"RTN","FBAA79",13,0)
 S FBJ=BEGDATE-.001,(DFN,FBK)=0 F ZZ=0:0 S FBJ=$O(^FBAAA("AF",2,FBJ)) Q:FBJ'>0!(FBJ>ENDDATE)  F  S DFN=$O(^FBAAA("AF",2,FBJ,DFN)) Q:DFN'>0  F  S FBK=$O(^FBAAA("AF",2,FBJ,DFN,FBK)) Q:FBK'>0  X FBAASCR I  D GOT
"RTN","FBAA79",14,0)
END K FBJ,FBK,DFN,Z,FBS,V,FBI,FBPATT,FBPG,FBSITE,UL,ULL,POV,NOV,POS,CC,PSTCD,SSTCD,VSTCD,BEGDATE,ENDDATE,PIDC,VDX,CODE,STATCD,D,FBAASCR,FBDX,FBIDC,FBOUT,FBPDX,FBREM,FBRR,NAME,PGM,POW,VAL,VAR,VFN,VFROM,VTO,YOB,ZZ
"RTN","FBAA79",15,0)
 K FB7078,FBAABDT,FBAAEDT,FBASSOC,FBLOC,FBPOV,FBPSA,FBPT,FBTT,FBTYPE,FBVEN,FTP,CNT,FBAAOUT,FBAUT,FBPROG,I,J,M,PI,Q,SEX,SSN,TA,DATE,S,Y,DA,DIC
"RTN","FBAA79",16,0)
 D CLOSE^FBAAUTL Q
"RTN","FBAA79",17,0)
 Q
"RTN","FBAA79",18,0)
 ;
"RTN","FBAA79",19,0)
 ; Utilize new API for Name Standardization
"RTN","FBAA79",20,0)
 ;
"RTN","FBAA79",21,0)
GOT Q:'$D(^DPT(DFN,0))
"RTN","FBAA79",22,0)
 S Y(0)=^DPT(DFN,0)
"RTN","FBAA79",23,0)
 D
"RTN","FBAA79",24,0)
 .N FBNAMES
"RTN","FBAA79",25,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=DFN_",",FBNAMES("FIELD")=.01
"RTN","FBAA79",26,0)
 .S NAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBAA79",27,0)
 S SEX=$P(Y(0),U,2)
"RTN","FBAA79",28,0)
 S SSN=$TR($$SSNL4^FBAAUTL($$SSN^FBAAUTL(DFN)),"-",""),YOB=$S($P(Y(0),U,3)]"":$E($P(Y(0),U,3),1,3)+1700,1:""),POS=$S($D(^DPT(DFN,.32)):$P(^(.32),"^",3),1:""),POS=$S(POS]"":$P(^DIC(21,POS,0),"^",3),1:"")
"RTN","FBAA79",29,0)
 F I=1:1:7 S FBI(I)=""
"RTN","FBAA79",30,0)
 I $D(^DPT(DFN,.11)) F I=1:1:7 S FBI(I)=$P(^(.11),"^",I)
"RTN","FBAA79",31,0)
 S POW=$P($G(^DPT(DFN,.52)),"^",5)
"RTN","FBAA79",32,0)
 Q:'$D(^FBAAA(DFN,1,FBK))  S Y(0)=^(FBK,0),VFROM=$P(Y(0),"^",1),VTO=$P(Y(0),"^",2),VFN=$P(Y(0),"^",4) I $S($P(Y(0),"^",3)=6:1,$P(Y(0),"^",3)=7:1,1:"") Q
"RTN","FBAA79",33,0)
 S VDX=$P(Y(0),"^",8),FBPATT=$P(Y(0),"^",18),POV=$$EXTPV^FBAAUTL5($P(Y(0),"^",7)),CODE=$P(Y(0),"^",13),PIDC=$P(Y(0),"^",12),NOV=$P($G(^FBAAA(DFN,1,FBK,1)),"^")
"RTN","FBAA79",34,0)
 S FBDX=$G(^FBAAA(DFN,1,FBK,3))
"RTN","FBAA79",35,0)
 S FBIDC=$P($G(^FBAAA(DFN,4)),"^")
"RTN","FBAA79",36,0)
 S STATCD=FBI(5),CC=FBI(7) F V=1:1:14 S V(V)=""
"RTN","FBAA79",37,0)
 S CC=$S(CC']"":"",$D(^DIC(5,+STATCD,1,CC,0)):$P(^(0),"^",3),1:"")
"RTN","FBAA79",38,0)
 S Y(0)=$S(VFN']"":"",'$D(^FBAAV(VFN,0)):"",$D(^FBAAV(VFN,0)):^(0),1:"") G:$S(VFN']"":1,'$D(^FBAAV(VFN,0)):1,1:0) OVR
"RTN","FBAA79",39,0)
 F V=2,1,3,14,4,5,6,10 S V(V)=$P(Y(0),"^",V)
"RTN","FBAA79",40,0)
OVR F S=1:1:9 S FBS(S)=$P(FBSITE(0),"^",S)
"RTN","FBAA79",41,0)
 S VSTCD=$S(V(5)']"":"  ",$D(^DIC(5,V(5),0)):$P(^(0),"^",2),1:"  "),SSTCD=$S(FBS(5)']"":"  ",$D(^DIC(5,+FBS(5),0)):$P(^(0),"^",2),1:"  "),PSTCD=$S(FBI(5)']"":"  ",$D(^DIC(5,+FBI(5),0)):$P(^(0),"^",2),1:"  ")
"RTN","FBAA79",42,0)
 W:FBPG @IOF W UL,!,?46,"Department of Veterans Affairs",?100,"ID Card Number: ",FBIDC,!,?35,"R E Q U E S T   F O R   O U T P A T I E N T   S E R V I C E S",!,UL S FBREM=0,FBOUT=0
"RTN","FBAA79",43,0)
 ;
"RTN","FBAA79",44,0)
 W !,"(1) Veterans Name",?31,"|(2) ID Number | Period of Validity",!,?31,"|",?46,"|"
"RTN","FBAA79",45,0)
 W !,NAME,?31,"|",?32,SSN,?46,"|"," FROM: ",$$FMTE^XLFDT(VFROM),"   TO: ",$$FMTE^XLFDT(VTO),!,UL
"RTN","FBAA79",46,0)
 W !,"(3) ADDRESS",?31,"|DATE OF ISSUE",?46,"| CONDITIONS FOR WHICH SERVICES ARE REQUESTED (DESCRIPTION OF DISABILITY)",!,?31,"|",?46,"|"
"RTN","FBAA79",47,0)
 W !,FBI(1),?31,"|",?33,$$FMTE^XLFDT(FBJ),?46,"|","  ",VDX S FBPDX=0
"RTN","FBAA79",48,0)
 I FBI(2)]"" W !,FBI(2),?31,"|",?46,"|","  " S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",49,0)
 I FBI(3)]"" W !,FBI(3),?31,"|",?46,"|","  " S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",50,0)
 W !,FBI(4)," ",PSTCD," ",FBI(6),?31,"|",?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX),!,$E(UL,1,45),?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",51,0)
 W !,"Name and Address of Fee Participant",?46,"|" S FBPDX=FBPDX+1 W ?48,$P(FBDX,"^",FBPDX)
"RTN","FBAA79",52,0)
 W !,?46,"|",!,V(1),?46,"|",!,V(3),?46,"|" W:V(14)]"" !,V(14),?46,"|"
"RTN","FBAA79",53,0)
 W !,V(4)," ",VSTCD," ",V(6),?46,"|",!,V(2),?46,"|","AUTHORIZATION #: ",DFN,"-",FBK,!,UL,!
"RTN","FBAA79",54,0)
 W ?49,"AUTHORIZATION REMARKS",!,?49,$E(UL,1,21)
"RTN","FBAA79",55,0)
 D ^FBAA79A S $P(^FBAAA(DFN,1,FBK,1),"^",2)=DT,FBPG=1 Q
"RTN","FBAASL1")
0^2^B16241469^B16087801
"RTN","FBAASL1",1,0)
FBAASL1 ;AISC/GRR-PRINT SUSPENSION LETTERS CONTINUED ;7/NOV/2006
"RTN","FBAASL1",2,0)
 ;;3.5;FEE BASIS;**12,23,69,101**;JAN 30, 1995;Build 2
"RTN","FBAASL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAASL1",4,0)
 N FBACRR,FBSCDT
"RTN","FBAASL1",5,0)
 F K=0:0 S K=$O(^FBAA(162.1,"AG",K)) Q:K'>0  I $S($G(IFN):IFN=K,1:1) S FBSW=1,FBDT=BEGDATE-.001 F ZZ=0:0 S FBDT=$O(^FBAA(162.1,"AG",K,FBDT)) D WPBOT:FBDT'>0&(FBSW=0)!(FBDT>ENDDATE)&(FBSW=0) Q:FBDT'>0!(FBDT>ENDDATE)  S FBSCDT=FBDT D MORE
"RTN","FBAASL1",6,0)
 Q
"RTN","FBAASL1",7,0)
MORE F J=0:0 S J=$O(^FBAA(162.1,"AG",K,FBDT,J)) Q:J'>0  I $S($G(DFN):DFN=J,1:1) D:$D(^DPT(J,0)) GOTP^FBAASLP I $D(^FBAAV(K,0)) D MID
"RTN","FBAASL1",8,0)
 Q
"RTN","FBAASL1",9,0)
GOTV S Y(0)=^FBAAV(K,0),VNAM=$P(Y(0),"^",1),FBSW=0
"RTN","FBAASL1",10,0)
 I VNAM["," S VNAM=$P(VNAM,",",2)_" "_$P(VNAM,",",1)
"RTN","FBAASL1",11,0)
 S VST1=$P(Y(0),"^",3),VST2=$P(Y(0),"^",14),VCITY=$P(Y(0),"^",4),VSTATE=$S($D(^DIC(5,+$P(Y(0),"^",5),0)):$P(^(0),"^",2),1:"  "),VZIP=$P(Y(0),"^",6)
"RTN","FBAASL1",12,0)
 W @IOF,!!!!!!!,?5,VNAM,!,?5,VST1,! I VST2]"" W ?5,VST2,!
"RTN","FBAASL1",13,0)
 W ?5,VCITY,"  ",VSTATE,"  ",VZIP,!!!!
"RTN","FBAASL1",14,0)
WPBEG S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBAASL1",15,0)
 I $D(^FBAA(161.3,FBLET,1,1)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASL1",16,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASL1",17,0)
 D HED
"RTN","FBAASL1",18,0)
 Q
"RTN","FBAASL1",19,0)
MID S FBA=0 F FBAA=0:0 S FBA=$O(^FBAA(162.1,"AG",K,FBDT,J,FBA)) Q:FBA=""  I $S(FBSLW=0:1,FBSLW=1&($D(FBAAS(FBA))):1,1:0) D MORE2
"RTN","FBAASL1",20,0)
 Q
"RTN","FBAASL1",21,0)
MORE2 F L=0:0 S L=$O(^FBAA(162.1,"AG",K,FBDT,J,FBA,L)) Q:L'>0  F M=0:0 S M=$O(^FBAA(162.1,"AG",K,FBDT,J,FBA,L,M)) Q:M'>0  I $D(^FBAA(162.1,L,"RX",M,0)) S Z(0)=^(0) D:$P(Z(0),"^",20)'="R" BOT
"RTN","FBAASL1",22,0)
 Q
"RTN","FBAASL1",23,0)
WPBOT D:$D(FBACRR) ACT^FBAASLP K FBACRR
"RTN","FBAASL1",24,0)
 S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W") W !!
"RTN","FBAASL1",25,0)
 I $D(^FBAA(161.3,FBLET,2)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,2,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASL1",26,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASL1",27,0)
 Q
"RTN","FBAASL1",28,0)
BOT Q:$S($G(FBDEN):$P(Z(0),U,16)>0,1:0)
"RTN","FBAASL1",29,0)
 N FBFPPSC S FBFPPSC=$P($G(^FBAA(162.1,L,0)),U,13)
"RTN","FBAASL1",30,0)
 Q:$S(FBENA=2&(FBFPPSC]""):1,FBENA=1&(FBFPPSC=""):1,1:0)
"RTN","FBAASL1",31,0)
 N FBFPPSL,FBX,FBADJLR,FBADJLA,FBRRMKL,T,TAMT,FBJ,FBAC
"RTN","FBAASL1",32,0)
 S FBFPPSL=$P($G(^FBAA(162.1,L,"RX",M,3)),U)
"RTN","FBAASL1",33,0)
 S FBX=$$ADJLRA^FBRXFA(M_","_L_",")
"RTN","FBAASL1",34,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAASL1",35,0)
 F FBJ=1:1 S FBAC=$P(FBADJLR,",",FBJ) Q:FBAC=""  S FBACRR(FBAC)=""
"RTN","FBAASL1",36,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAASL1",37,0)
 S T=$P(Z(0),U,8)
"RTN","FBAASL1",38,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBAASL1",39,0)
 S TAMT=$FN($P(Z(0),U,7),"",2)
"RTN","FBAASL1",40,0)
 S FBRRMKL=$$RRL^FBRXFR(M_","_L_",")
"RTN","FBAASL1",41,0)
 I FBSW=1 D GOTV^FBAASLP,HED S FBSW=0,FBGOT=1
"RTN","FBAASL1",42,0)
 S FBDOS=$P(Z(0),"^",3),FBDRUG=$P(Z(0),"^",2)
"RTN","FBAASL1",43,0)
 S FBRX=$P(Z(0),"^",1),A1=$P(Z(0),"^",4)+.0001,A2=$P(Z(0),"^",16)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2)
"RTN","FBAASL1",44,0)
 I $Y+4>IOSL W @IOF D HED
"RTN","FBAASL1",45,0)
 W !!,PNAME,?32,PSSN,?47,$$FMTE^XLFDT(FBDOS),?61,FBRX,!,?15,$J(A1,6),?30,$J(A2,6),?50,FBDRUG,!
"RTN","FBAASL1",46,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAASL1",47,0)
 W ?15,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAASL1",48,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAASL1",49,0)
 W ?31,$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAASL1",50,0)
 W ?49,FBRRMKL
"RTN","FBAASL1",51,0)
 I FBFPPSC]"" W !,?15,"FPPS Claim ID: ",FBFPPSC,?43,"FPPS Line Item: ",FBFPPSL,!
"RTN","FBAASL1",52,0)
 I FBADJLR="" G:FBA=4&($D(^FBAA(162.1,L,"RX",M,1))) WPFT D
"RTN","FBAASL1",53,0)
 . S DIWL=1,DIWF="WC79",FBI=FBA K ^UTILITY($J,"W")
"RTN","FBAASL1",54,0)
 . F FBRR=0:0 S FBRR=$O(^FBAA(161.27,FBI,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASL1",55,0)
 . D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASL1",56,0)
 Q
"RTN","FBAASL1",57,0)
HED W !,"PATIENT NAME",?36,"SSN",?47,"RX DATE",?61,"RX #",!,?15,"AMT CLAIMED",?30,"AMT PAID",?50,"DRUG NAME"
"RTN","FBAASL1",58,0)
 W !,?15,"ADJ CODE",?30,"ADJ AMOUNT",?49,"MEDICARE REMITTANCE REMARK"
"RTN","FBAASL1",59,0)
 W !,UL,! Q
"RTN","FBAASL1",60,0)
 ;
"RTN","FBAASL1",61,0)
GOTP ; Utilize new API for Name Standardization
"RTN","FBAASL1",62,0)
 ;
"RTN","FBAASL1",63,0)
 S Y(0)=^DPT(J,0),PNAME=$P(Y(0),"^",1),PSSN=$TR($$SSNL4^FBAAUTL($$SSN^FBAAUTL(J)),"-","")
"RTN","FBAASL1",64,0)
 I PNAME["," D
"RTN","FBAASL1",65,0)
 .N FBNAMES
"RTN","FBAASL1",66,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=J_",",FBNAMES("FIELD")=.01
"RTN","FBAASL1",67,0)
 .S PNAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBAASL1",68,0)
 Q
"RTN","FBAASL1",69,0)
WPFT S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBAASL1",70,0)
 F FBRR=0:0 S FBRR=$O(^FBAA(162.1,L,"RX",M,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASL1",71,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASL1",72,0)
 Q
"RTN","FBAASLP")
0^3^B46931154^B46707426
"RTN","FBAASLP",1,0)
FBAASLP ;AISC/GRR-PRINT SUSPENSION LETTERS ;7/NOV/2006
"RTN","FBAASLP",2,0)
 ;;3.5;FEE BASIS;**12,4,23,69,101**;JAN 30, 1995;Build 2
"RTN","FBAASLP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAASLP",4,0)
 D DATE^FBAAUTL G END:FBPOP  K FBAAS S (FBAAOUT,FBSLW,FBPRG,FBCTR,FBY)=0,UL="",$P(UL,"=",80)="="
"RTN","FBAASLP",5,0)
 D ^FBAASL G END:FBAAOUT
"RTN","FBAASLP",6,0)
RDCODE S DIR(0)="Y",DIR("A")="For All Suspension codes",DIR("B")="YES",DIR("?")="'Yes' to print suspension letters for all suspension codes, 'No' to select specific codes." D ^DIR K DIR W ! G END:$D(DUOUT),END:$D(DTOUT),SEL:'Y
"RTN","FBAASLP",7,0)
 ;ask edi/non-edi/all claims
"RTN","FBAASLP",8,0)
AHEAD S DIR(0)="SA^1:EDI;2:NON-EDI;3:ALL",DIR("A")="Only print letters for claims that were submitted via (EDI/NON-EDI/ALL):",DIR("B")="ALL"
"RTN","FBAASLP",9,0)
 S DIR("?",1)=" Enter EDI to just print suspension letters for EDI claims from the FPPS system."
"RTN","FBAASLP",10,0)
 S DIR("?",2)=" Enter NON-EDI to just print suspension letters for claims that are not EDI."
"RTN","FBAASLP",11,0)
 S DIR("?",3)=" Enter ALL to print suspension letters for both EDI and NON-EDI claims."
"RTN","FBAASLP",12,0)
 S DIR("?")=" "
"RTN","FBAASLP",13,0)
 D ^DIR K DIR G END:$D(DIRUT)
"RTN","FBAASLP",14,0)
 S FBENA=Y
"RTN","FBAASLP",15,0)
 S VAR="BEGDATE^ENDDATE^FBSLW",VAL=BEGDATE_"^"_ENDDATE_"^"_FBSLW
"RTN","FBAASLP",16,0)
 I $G(DFN) S VAR="DFN^"_VAR,VAL=DFN_"^"_VAL
"RTN","FBAASLP",17,0)
 I $G(IFN) S VAR="IFN^"_VAR,VAL=IFN_"^"_VAL
"RTN","FBAASLP",18,0)
 I $G(FBDEN) S VAR="FBDEN^"_VAR,VAL=FBDEN_"^"_VAL
"RTN","FBAASLP",19,0)
 I $G(FBENA) S VAR="FBENA^"_VAR,VAL=FBENA_"^"_VAL
"RTN","FBAASLP",20,0)
 S K=0 F J=1:1:FBCTR S K=$O(FBPRG(K)) S VAR=VAR_"^FBPRG("""_K_""")",VAL=VAL_"^"_+FBPRG(K)
"RTN","FBAASLP",21,0)
 I $D(FBAAS) F J=0:0 S J=$O(FBAAS(J)) Q:J'>0  S VAR=VAR_"^FBAAS("_J_")",VAL=VAL_"^"
"RTN","FBAASLP",22,0)
 S PGM="START^FBAASLP",IOP="Q" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBAASLP",23,0)
START K ^UTILITY($J),^TMP($J) U IO S UL="",$P(UL,"=",80)="=",FBPG=1
"RTN","FBAASLP",24,0)
 I $G(FBPRG("O")) S FBLET=+FBPRG("O") F K=0:0 S K=$O(^FBAAC("AI",K)) Q:K'>0  I $S($G(IFN):IFN=K,1:1) D STRT
"RTN","FBAASLP",25,0)
 I $G(FBPRG("P")),$D(^FBAA(162.1,"AG")) S FBLET=+FBPRG("P") D ^FBAASL1 K ^TMP($J)
"RTN","FBAASLP",26,0)
 I $G(FBPRG("C")),$D(^FBAA(162.2,"AI")) S FBLET=+FBPRG("C") D ^FBCHSLP
"RTN","FBAASLP",27,0)
 I $G(FBPRG("I")),$D(^FBAAI("AI")) S FBLET=+FBPRG("I") D ^FBCHSL1
"RTN","FBAASLP",28,0)
 I '$G(FBGOT) W !,"There are no suspension letters found that meet the criteria you have",!,"specified."
"RTN","FBAASLP",29,0)
END K FBAAS,UL,X,J,K,L,M,VNAM,VST1,VST2,VCITY,VSTATE,FBDT,FBA,VZIP,PNAME,A1,A2,CPT,FBDOS,FBRR,FBXX,DIC,DIWL,DIWF,BEGDATE,ENDDATE,FBAA,FBDRUG,FBFORM,FBI,FBLET,FBPDT,FBRX,FBSLW,FBSW,I,PGM,VAL,VAR,Z,ZZ,FBAAPGM,Y,PSSN,DIRUT
"RTN","FBAASLP",30,0)
 K FBAAOUT,FBCTR,FBPRG,FBY,FBMOD,FBMODLE,DFN,IFN,FBDEN,FBGOT,FBENA
"RTN","FBAASLP",31,0)
 K ^UTILITY($J),^TMP($J)
"RTN","FBAASLP",32,0)
 D CLOSE^FBAAUTL Q
"RTN","FBAASLP",33,0)
MORE F J=0:0 S J=$O(^FBAAC("AI",K,FBDT,J)) Q:J'>0  I $S($G(DFN):DFN=J,1:1) D:$D(^DPT(J,0)) GOTP I $D(^FBAAV(K,0)) D MID
"RTN","FBAASLP",34,0)
 Q
"RTN","FBAASLP",35,0)
GOTV S Y(0)=^FBAAV(K,0),VNAM=$P(Y(0),"^",1),FBSW=0
"RTN","FBAASLP",36,0)
 I VNAM["," S VNAM=$P(VNAM,",",2)_" "_$P(VNAM,",",1)
"RTN","FBAASLP",37,0)
 S VST1=$P(Y(0),"^",3),VST2=$P(Y(0),"^",14),VCITY=$P(Y(0),"^",4),VSTATE=$S($D(^DIC(5,+$P(Y(0),"^",5),0)):$P(^(0),"^",2),1:"  "),VZIP=$P(Y(0),"^",6) S Y=DT D PDATE^FBAAUTL
"RTN","FBAASLP",38,0)
 W:'$G(FBPG) @IOF K:$G(FBPG) FBPG W:(IOSL)>70 !!!! W !!!!!!!!!!!,?5,VNAM,?60,FBPDT,!,?5,VST1,! I VST2]"" W ?5,VST2,!
"RTN","FBAASLP",39,0)
 W ?5,VCITY,"  ",VSTATE,"  ",VZIP,!!!!
"RTN","FBAASLP",40,0)
WPBEG S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBAASLP",41,0)
 I $D(^FBAA(161.3,FBLET,1,1)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASLP",42,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASLP",43,0)
 Q
"RTN","FBAASLP",44,0)
MID S FBA=0 F FBAA=0:0 S FBA=$O(^FBAAC("AI",K,FBDT,J,FBA)) Q:FBA=""  I $S(FBSLW=0:1,FBSLW=1&($D(FBAAS(FBA))):1,1:0) D MORE2
"RTN","FBAASLP",45,0)
 Q
"RTN","FBAASLP",46,0)
MORE2 F L=0:0 S L=$O(^FBAAC("AI",K,FBDT,J,FBA,L)) Q:L'>0  F M=0:0 S M=$O(^FBAAC("AI",K,FBDT,J,FBA,L,M)) Q:M'>0  I $D(^FBAAC(J,1,K,1,L,1,M,0)) S Z(0)=^(0) D:$P(Z(0),"^",20)'="R" BOT
"RTN","FBAASLP",47,0)
 Q
"RTN","FBAASLP",48,0)
WPBOT D ACT:$D(FBACRR) K FBACRR
"RTN","FBAASLP",49,0)
 S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W") W !!
"RTN","FBAASLP",50,0)
 I $D(^FBAA(161.3,FBLET,2)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,2,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASLP",51,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASLP",52,0)
 Q
"RTN","FBAASLP",53,0)
BOT Q:$S($G(FBDEN):$P(Z(0),U,3)>0,1:0)
"RTN","FBAASLP",54,0)
 N FBY3,FBFPPSC
"RTN","FBAASLP",55,0)
 S FBY3=$G(^FBAAC(J,1,K,1,L,1,M,3))
"RTN","FBAASLP",56,0)
 S FBFPPSC=$P(FBY3,U)
"RTN","FBAASLP",57,0)
 Q:$S(FBENA=2&(FBFPPSC]""):1,FBENA=1&(FBFPPSC=""):1,1:0)
"RTN","FBAASLP",58,0)
 N FBY,FBX,T,TAMT,FBAC,FBJ,FBCSID,FBUNITS,FBADJLR,FBADJLA,FBRRMKL,FBFPPSL
"RTN","FBAASLP",59,0)
 I FBSW=1 D GOTV,HED S FBSW=0,FBGOT=1
"RTN","FBAASLP",60,0)
 S FBDOS=$S($D(^FBAAC(J,1,K,1,L,0)):$P(^(0),"^",1),1:"")
"RTN","FBAASLP",61,0)
 S CPT=$P(Z(0),"^",1),A1=$P(Z(0),"^",2)+.0001,A2=$P(Z(0),"^",3)+.0001,A1=$P(A1,".",1)_"."_$E($P(A1,".",2),1,2),A2=$P(A2,".",1)_"."_$E($P(A2,".",2),1,2)
"RTN","FBAASLP",62,0)
 I CPT]"" S CPT=$$CPT^FBAAUTL4(CPT)
"RTN","FBAASLP",63,0)
 S T=$P(Z(0),U,5)
"RTN","FBAASLP",64,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBAASLP",65,0)
 S TAMT=$FN($P(Z(0),U,4),"",2)
"RTN","FBAASLP",66,0)
 S FBX=$$ADJLRA^FBAAFA(M_","_L_","_K_","_J_",")
"RTN","FBAASLP",67,0)
 S FBY=$G(^FBAAC(J,1,K,1,L,1,M,2))
"RTN","FBAASLP",68,0)
 S FBFPPSL=$P(FBY3,U,2)
"RTN","FBAASLP",69,0)
 S FBCSID=$P(FBY,U,16)
"RTN","FBAASLP",70,0)
 S FBUNITS=$P(FBY,U,14)
"RTN","FBAASLP",71,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBAASLP",72,0)
 F FBJ=1:1 S FBAC=$P(FBADJLR,",",FBJ) Q:FBAC=""  S FBACRR(FBAC)=""
"RTN","FBAASLP",73,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBAASLP",74,0)
 S FBRRMKL=$$RRL^FBAAFR(M_","_L_","_K_","_J_",")
"RTN","FBAASLP",75,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_J_",1,"_K_",1,"_L_",1,"_M_",""M"")","E")
"RTN","FBAASLP",76,0)
 I $Y+4>IOSL W @IOF D HED
"RTN","FBAASLP",77,0)
 W !!,$E(PNAME,1,26),?33,PSSN,?49,FBCSID
"RTN","FBAASLP",78,0)
 W !,$$DATX^FBAAUTL(FBDOS),?10,CPT_$S($G(FBMODLE)]"":"-"_$P(FBMODLE,","),1:""),?33,FBUNITS
"RTN","FBAASLP",79,0)
 I $P($G(FBMODLE),",",2)]"" D
"RTN","FBAASLP",80,0)
 . N FBI
"RTN","FBAASLP",81,0)
 . F FBI=2:1 S FBMOD=$P(FBMODLE,",",FBI) Q:FBMOD=""  D
"RTN","FBAASLP",82,0)
 . . I $Y+4>IOSL W @IOF D HED W !,"  (continued)"
"RTN","FBAASLP",83,0)
 . . W !,?15,"-",FBMOD
"RTN","FBAASLP",84,0)
 W !,?10,$J(A1,6),?24,$J(A2,6)
"RTN","FBAASLP",85,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBAASLP",86,0)
 W ?35,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBAASLP",87,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBAASLP",88,0)
 W ?49,$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBAASLP",89,0)
 W ?66,FBRRMKL
"RTN","FBAASLP",90,0)
 I FBFPPSC]"" W !,?10,"FPPS Claim ID: ",FBFPPSC,?38,"FPPS Line Item: ",FBFPPSL
"RTN","FBAASLP",91,0)
 W !
"RTN","FBAASLP",92,0)
 I FBADJLR="" G:FBA=4&($D(^FBAAC(J,1,K,1,L,1,M,1))) WPFT D
"RTN","FBAASLP",93,0)
 . S DIWL=1,DIWF="WC79",FBI=FBA K ^UTILITY($J,"W")
"RTN","FBAASLP",94,0)
 . F FBRR=0:0 S FBRR=$O(^FBAA(161.27,FBI,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASLP",95,0)
 . D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASLP",96,0)
 Q
"RTN","FBAASLP",97,0)
ACT ; print table of adjustment reason descriptions
"RTN","FBAASLP",98,0)
 ; Input 
"RTN","FBAASLP",99,0)
 ;    FBACRR( - required, array
"RTN","FBAASLP",100,0)
 ;    FBACRR(FBADJRE)=""
"RTN","FBAASLP",101,0)
 ;    where FBADJRE = adjustment reason code, external value
"RTN","FBAASLP",102,0)
 N FBADJRE,FBI,FBACT
"RTN","FBAASLP",103,0)
 W !,"*Adjustment Code Text:"
"RTN","FBAASLP",104,0)
 S FBADJRE="" F  S FBADJRE=$O(FBACRR(FBADJRE)) Q:FBADJRE=""  D
"RTN","FBAASLP",105,0)
 . ; get description of code in FBACT
"RTN","FBAASLP",106,0)
 . I $$AR^FBUTL1(,FBADJRE,FBSCDT,"FBACT")<0 Q  ; quit if error
"RTN","FBAASLP",107,0)
 . ; print code and description
"RTN","FBAASLP",108,0)
 . K ^UTILITY($J,"W")
"RTN","FBAASLP",109,0)
 . S DIWL=1,DIWF="WC79"
"RTN","FBAASLP",110,0)
 . ; include code in output
"RTN","FBAASLP",111,0)
 . S X=$$LJ^XLFSTR("("_FBADJRE_")",7," ") D ^DIWP
"RTN","FBAASLP",112,0)
 . S DIWF="WC79I7"
"RTN","FBAASLP",113,0)
 . ; include description in output
"RTN","FBAASLP",114,0)
 . S FBI=0 F  S FBI=$O(FBACT(FBI)) Q:FBI=""  S X=FBACT(FBI) I X]"" D ^DIWP
"RTN","FBAASLP",115,0)
 . D ^DIWW
"RTN","FBAASLP",116,0)
 Q
"RTN","FBAASLP",117,0)
 ;
"RTN","FBAASLP",118,0)
HED W !,"PATIENT NAME",?33,"SSN",?49,"PATIENT ACCOUNT NUMBER"
"RTN","FBAASLP",119,0)
 W !,"SVC DATE",?10,"CPT-MOD",?33,"UNITS"
"RTN","FBAASLP",120,0)
 W !,?10,"AMT CLAIMED",?24,"AMT PAID",?35,"ADJ CODE",?49,"ADJ AMT",?66,"REMIT REMARKS"
"RTN","FBAASLP",121,0)
 W !,UL Q
"RTN","FBAASLP",122,0)
 ;
"RTN","FBAASLP",123,0)
GOTP ; Utilize new API for Name Standardization
"RTN","FBAASLP",124,0)
 ;
"RTN","FBAASLP",125,0)
 S Y(0)=^DPT(J,0),PNAME=$P(Y(0),"^",1),PSSN=$TR($$SSNL4^FBAAUTL($$SSN^FBAAUTL(J)),"-","")
"RTN","FBAASLP",126,0)
 I PNAME["," D
"RTN","FBAASLP",127,0)
 .N FBNAMES
"RTN","FBAASLP",128,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=J_",",FBNAMES("FIELD")=.01
"RTN","FBAASLP",129,0)
 .S PNAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBAASLP",130,0)
 Q
"RTN","FBAASLP",131,0)
SEL W !! S DIC="^FBAA(161.27,",DIC(0)="AEQM" D ^DIC G ENDSL:X=""!(X="^"),SEL:Y<0 S DA=+Y,FBAAS(DA)="",FBSLW=1 G SEL
"RTN","FBAASLP",132,0)
ENDSL I '$D(FBAAS) W !!,*7,"No suspension codes selected!" G END
"RTN","FBAASLP",133,0)
 G AHEAD
"RTN","FBAASLP",134,0)
PSEL F FBA=0:0 S FBA=$O(FBAAS(FBA)) Q:FBA'>0  I $D(^FBAAC("AI",FBA)) F FBDT=BEGDATE-.001:0 S FBDT=$O(^FBAAC("AI",FBA,FBDT)) Q:FBDT'>0!(FBDT>ENDDATE)  D MORE
"RTN","FBAASLP",135,0)
 G END
"RTN","FBAASLP",136,0)
WPFT S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBAASLP",137,0)
 F FBRR=0:0 S FBRR=$O(^FBAAC(J,1,K,1,L,1,M,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBAASLP",138,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBAASLP",139,0)
 Q
"RTN","FBAASLP",140,0)
STRT N FBACRR,FBSCDT S FBSW=1 S Z=$O(^FBAAC("AI",K,BEGDATE-.001)) S FBDT=BEGDATE-.001 F ZZ=0:0 S FBDT=$O(^FBAAC("AI",K,FBDT)) D WPBOT:FBDT'>0&(FBSW=0)!(FBDT>ENDDATE)&(FBSW=0) Q:FBDT'>0!(FBDT>ENDDATE)  S FBSCDT=FBDT D MORE
"RTN","FBAASLP",141,0)
 Q
"RTN","FBAAUTL")
0^4^B22355196^B21628234
"RTN","FBAAUTL",1,0)
FBAAUTL ;AISC/GRR,SBW-Fee Basis Utility Routine ;7/NOV/2006
"RTN","FBAAUTL",2,0)
 ;;3.5;FEE BASIS;**101**;JAN 30, 1995;Build 2
"RTN","FBAAUTL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBAAUTL",4,0)
DATE N FBDT S FBPOP=0 K BEGDATE,ENDDATE K:$G(%DT)'["A" %DT W !!,"**** Date Range Selection ****"
"RTN","FBAAUTL",5,0)
 S FBDT=$S($D(%DT):1,1:0) W ! S %DT=$S(FBDT:%DT,1:"APEX"),%DT("A")="   Beginning DATE : " D ^%DT S:Y<0 FBPOP=1 Q:Y<0  S (%DT(0),BEGDATE)=Y
"RTN","FBAAUTL",6,0)
 W ! S %DT=$S(FBDT:%DT,1:"AEX"),%DT("A")="   Ending    DATE : " D ^%DT K %DT S:Y<0 FBPOP=1 Q:Y<0  W ! S ENDDATE=Y
"RTN","FBAAUTL",7,0)
 Q
"RTN","FBAAUTL",8,0)
 ;
"RTN","FBAAUTL",9,0)
ZIS S ZTRTN=PGM,ZTSAVE="",FBPOP=0 F I=1:1 Q:$P(VAR,"^",I)']""  S ZTSAVE($P(VAR,"^",I))=""
"RTN","FBAAUTL",10,0)
 I '$D(ZTDESC) S ZTDESC=$S($D(PGM):PGM,1:"UNKNOWN OPTION")
"RTN","FBAAUTL",11,0)
 W ! S %ZIS="QMP" D ^%ZIS S:POP FBPOP=1 Q:POP  I $D(IO("Q")) K IO("Q"),ZTIO D ^%ZTLOAD W:$D(ZTSK) !,*7,"REQUEST QUEUED",!,"Task #: ",$G(ZTSK) K I,ZTSK,ZTIO,ZTSAVE,ZTRTN D HOME^%ZIS S FBPOP=1 Q
"RTN","FBAAUTL",12,0)
 Q
"RTN","FBAAUTL",13,0)
 ;
"RTN","FBAAUTL",14,0)
CLOSE I '$D(ZTQUEUED) D ^%ZISC
"RTN","FBAAUTL",15,0)
 K IOP,ZTDESC,ZTRTN,ZTSAVE,ZTDTH,VAR,VAL,PGM,FBPOP,POP Q
"RTN","FBAAUTL",16,0)
 ;
"RTN","FBAAUTL",17,0)
D S Y=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(Y,4,5))_" "_$S(Y#100:$J(Y#100\1,2)_",",1:"")_(Y\10000+1700)_$S(Y#1:"  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"") Q
"RTN","FBAAUTL",18,0)
SITEP ;SET FBSITE(0),FBSITE(1) VARIABLE TO FEE SITE PARAMETERS
"RTN","FBAAUTL",19,0)
 S FBPOP=0,FBSITE(0)=$G(^FBAA(161.4,1,0)) S:FBSITE(0)']"" FBPOP=1
"RTN","FBAAUTL",20,0)
 S FBSITE(1)=$G(^FBAA(161.4,1,1)) S:FBSITE(1)']"" FBPOP=1
"RTN","FBAAUTL",21,0)
 W:FBPOP !,*7,"Fee Basis Site Parameters must be entered to proceed",!
"RTN","FBAAUTL",22,0)
 Q
"RTN","FBAAUTL",23,0)
TM S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"RTN","FBAAUTL",24,0)
PDF S:Y Y=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3) Q
"RTN","FBAAUTL",25,0)
GETNXB ;GET NEXT AVAILABLE BATCH NUMBER
"RTN","FBAAUTL",26,0)
 L +^FBAA(161.4) I '$D(^FBAA(161.4,1,"FBNUM")) S ^FBAA(161.4,1,"FBNUM")="1^1"
"RTN","FBAAUTL",27,0)
 I '$P($G(^FBAA(161.4,1,"FBNUM")),"^") S $P(^("FBNUM"),"^")=1
"RTN","FBAAUTL",28,0)
 S FBBN=$P(^FBAA(161.4,1,"FBNUM"),"^")
"RTN","FBAAUTL",29,0)
 I FBBN>99899,$S('$D(^FBAA(161.4,1,"PURGE")):1,$P(^FBAA(161.4,1,"PURGE"),"^",1)'>0:1,1:"") D WARNBT
"RTN","FBAAUTL",30,0)
 S $P(^FBAA(161.4,1,"FBNUM"),"^",1)=$S(FBBN+1>99999:1,1:FBBN+1) I '$$CHKBI^FBAAUTL4(FBBN,1) L -^FBAA(161.4) G GETNXB
"RTN","FBAAUTL",31,0)
 L -^FBAA(161.4) Q
"RTN","FBAAUTL",32,0)
WARNBT W !,*7,"There are ",99999-FBBN," batches left before the BATCH PURGE routine",!,"needs to be run. Contact your IRM Service!",!!
"RTN","FBAAUTL",33,0)
 Q
"RTN","FBAAUTL",34,0)
GETNXI ;GET NEXT AVAILABLE INVOICE NUMBER 
"RTN","FBAAUTL",35,0)
 L +^FBAA(161.4) I '$D(^FBAA(161.4,1,"FBNUM")) S ^FBAA(161.4,1,"FBNUM")="1^1"
"RTN","FBAAUTL",36,0)
 I '$P($G(^FBAA(161.4,1,"FBNUM")),U,2) S $P(^("FBNUM"),U,2)=1
"RTN","FBAAUTL",37,0)
 S FBAAIN=$P(^FBAA(161.4,1,"FBNUM"),"^",2),$P(^("FBNUM"),"^",2)=$S(FBAAIN+1>9999999:1,1:FBAAIN+1) I '$$CHKBI^FBAAUTL4(FBAAIN) L -^FBAA(161.4) G GETNXI
"RTN","FBAAUTL",38,0)
 L -^FBAA(161.4) Q
"RTN","FBAAUTL",39,0)
PDATE S FBPDT=$P("January^February^March^April^May^June^July^August^September^October^November^December","^",$E(Y,4,5))_" "_$S(Y#100:$J(Y#100\1,2)_", ",1:"")_(Y\10000+1700)_$S(Y#1:"  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12),1:"") Q
"RTN","FBAAUTL",40,0)
DATCK S HOLDY=Y,HOLDY=$S($P(HOLDY,"^",2):$P(HOLDY,"^",2),1:HOLDY)
"RTN","FBAAUTL",41,0)
 I $D(FBAAID),Y>FBAAID W !!,*7,"Date of Service cannot be later than Invoice Date!" K X Q
"RTN","FBAAUTL",42,0)
 I $D(FBAABDT),$D(FBAAEDT),(Y<FBAABDT!(Y>FBAAEDT)) W !!,*7,"Date of Service ",$S(Y<FBAABDT:"prior to ",1:"later than "),"Authorization period.",! K X
"RTN","FBAAUTL",43,0)
 S Y=HOLDY Q
"RTN","FBAAUTL",44,0)
 ;
"RTN","FBAAUTL",45,0)
DATX(X) ;external output function for date format
"RTN","FBAAUTL",46,0)
 ;INPUT = FM internal date format (time optional)
"RTN","FBAAUTL",47,0)
 ;OUTPUT = date/time with slashes
"RTN","FBAAUTL",48,0)
 Q $$FMTE^XLFDT(X,2)
"RTN","FBAAUTL",49,0)
 ;
"RTN","FBAAUTL",50,0)
STATION ;GET STATION NUMBER FROM INSTITUTION FILE
"RTN","FBAAUTL",51,0)
 I '$D(FBSITE(1)) D SITEP
"RTN","FBAAUTL",52,0)
 I $S('$D(FBSITE(1)):1,$P(FBSITE(1),"^",3)="":1,'$D(^DIC(4,$P(FBSITE(1),"^",3),0)):1,'$D(^DIC(4,$P(FBSITE(1),"^",3),99)):1,'+$P(^DIC(4,$P(FBSITE(1),"^",3),99),"^"):1,1:0) G NOSTA
"RTN","FBAAUTL",53,0)
 S (FBSN,FBAASN)=$S($D(^DIC(4,$P(FBSITE(1),"^",3),99)):$E(^(99),1,3),1:999)
"RTN","FBAAUTL",54,0)
 Q
"RTN","FBAAUTL",55,0)
NOSTA S FB("ERROR")=1 I '$D(ZTQUEUED) W !!,*7,"Unable to determine Station Number. Check Fee Site Parameters or Station Number in the Institution File.",!!
"RTN","FBAAUTL",56,0)
 Q
"RTN","FBAAUTL",57,0)
 ;
"RTN","FBAAUTL",58,0)
HD ;set transmission header
"RTN","FBAAUTL",59,0)
 I '$D(FBSITE(1)) S FBSITE(1)=$G(^FBAA(161.4,1,1))
"RTN","FBAAUTL",60,0)
 S FBHD=$$HDR^FBAAUTL3() I FBHD']"" S FB("ERROR")=1 W !,"Transmission header must exist in FEE BASIS SITE PARAMETER file",!,"before you can proceed.",*7,!
"RTN","FBAAUTL",61,0)
 Q
"RTN","FBAAUTL",62,0)
 ;
"RTN","FBAAUTL",63,0)
SSN(PID,BID,DOD) ;
"RTN","FBAAUTL",64,0)
 ;PID = DFN of Patient. If this is all that is past,
"RTN","FBAAUTL",65,0)
 ;full Pt.ID (000-00-0000) will be returned.
"RTN","FBAAUTL",66,0)
 ;If BID = 1 the call will return last 4 of Pt.ID only.
"RTN","FBAAUTL",67,0)
 ;If DOD is defined to internal entry # of eligibility the appropriate
"RTN","FBAAUTL",68,0)
 ;Pt.ID will be returned.
"RTN","FBAAUTL",69,0)
 N DFN,FBSSN
"RTN","FBAAUTL",70,0)
 S DFN=PID
"RTN","FBAAUTL",71,0)
 I 'DFN Q "Unknown"
"RTN","FBAAUTL",72,0)
 S:'$D(BID) BID="" S:$D(DOD) VAPTYP=DOD
"RTN","FBAAUTL",73,0)
 D PID^VADPT6 I VAERR K VAERR Q "Unknown"
"RTN","FBAAUTL",74,0)
 S FBSSN=$S(BID:VA("BID"),1:VA("PID"))
"RTN","FBAAUTL",75,0)
 K VA("BID"),VA("PID"),VAERR,VAPTYP
"RTN","FBAAUTL",76,0)
 Q FBSSN
"RTN","FBAAUTL",77,0)
 ;
"RTN","FBAAUTL",78,0)
SSNL4(SSN) ;Convert 1st 5 digits of SSN to X (Only print last 4 digits of SSN)
"RTN","FBAAUTL",79,0)
 ;Input:
"RTN","FBAAUTL",80,0)
 ;   SSN - SSN in 9 digit or ###-##-#### format
"RTN","FBAAUTL",81,0)
 ;     Pseudo SSN is also allowed as input
"RTN","FBAAUTL",82,0)
 ;Output
"RTN","FBAAUTL",83,0)
 ;   SSN - SSN in XXXXX#### or XXX-XX-#### format
"RTN","FBAAUTL",84,0)
 ;     Pseudo SSN will be changed as above with passed "P" at end
"RTN","FBAAUTL",85,0)
 ; X represent actual X and # represent digit
"RTN","FBAAUTL",86,0)
 ;
"RTN","FBAAUTL",87,0)
 S SSN=$G(SSN)
"RTN","FBAAUTL",88,0)
 ;Change SSN ######### to XXXXX####
"RTN","FBAAUTL",89,0)
 S:SSN?9N0.1"P" $E(SSN,1,5)="XXXXX"
"RTN","FBAAUTL",90,0)
 ;Change SSN ###-##-#### to XXX-XX-####
"RTN","FBAAUTL",91,0)
 S:SSN?3N1"-"2N1"-"4N0.1"P" $E(SSN,1,7)="XXX-XX-"
"RTN","FBAAUTL",92,0)
 Q SSN
"RTN","FBCHP78")
0^5^B33168184^B32897245
"RTN","FBCHP78",1,0)
FBCHP78 ;AISC/DMK-GENERATE 7078 ;7/NOV/2006
"RTN","FBCHP78",2,0)
 ;;3.5;FEE BASIS;**12,23,52,101**;JAN 30, 1995;Build 2
"RTN","FBCHP78",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCHP78",4,0)
 I '$D(^FBAA(161.4,1,0)) W !,"Site Parameters must be entered prior",!," to using this option." Q
"RTN","FBCHP78",5,0)
GET78 S DIC="^FB7078(",DIC(0)="AEQMZ",DIC("A")="Select Veteran: ",D="D",DIC("S")="I $P(^(0),U,9)'=""DC""" D IX^DIC G END:X="^"!(X=""),GET78:Y<0 S FB7078=+Y,FB(0)=Y(0) K DIC,D
"RTN","FBCHP78",6,0)
 S DA=FB7078,DIC="^FB7078(",DR=0 D EN^DIQ
"RTN","FBCHP78",7,0)
ASK S DIR(0)="Y",DIR("A")="Is this the correct 7078",DIR("B")="YES" D ^DIR K DIR G END:$D(DIRUT),GET78:'Y
"RTN","FBCHP78",8,0)
 D SITEP^FBAAUTL S FBO=$S($D(FBSITE(1)):$P(FBSITE(1),"^",7),1:""),FBNUM=$S($D(FBSITE(1)):$P(FBSITE(1),"^",5),1:"")
"RTN","FBCHP78",9,0)
 S FBT=$S($D(FBSITE(1)):$P(FBSITE(1),"^",8),1:"")
"RTN","FBCHP78",10,0)
 D FBO G END:$D(DIRUT)
"RTN","FBCHP78",11,0)
 S PRCF("X")="S" D ^PRCFSITE S PRC("SITE")=$S($D(PRC("SITE")):PRC("SITE"),1:"") I PRC("SITE")="" W ! G GET78
"RTN","FBCHP78",12,0)
 S FB("SITE")=PRC("SITE")
"RTN","FBCHP78",13,0)
QUE S VAR="FB7078^FBNUM^FBO^FBT^FB(""SITE"")",VAL=FB7078_"^"_FBNUM_"^"_FBO_"^"_FBT_"^"_FB("SITE"),PGM="START^FBCHP78" D ZIS^FBAAUTL G:FBPOP END
"RTN","FBCHP78",14,0)
 ;
"RTN","FBCHP78",15,0)
START S FB(0)=^FB7078(FB7078,0) S:$E(IOST,1,2)'["C-" FBPG=1 F FBM=1:1:FBNUM D 7078
"RTN","FBCHP78",16,0)
END K DA,DFN,DIC,DINAME,DIRUT,DIWF,DIWL,DR,FB,FB7078,FBFD,FBID,FBNM,FBNUM,FBO,FBRR,FBSITE,FBTD,FBV,FBVEN,FBT,I,L,FBM,PGM,S,UL,VA,VADM,VAEL,VAERR,VAL,VAPA,VAR,X,Y,Z,PRC,PRCS,^UTILITY($J),PRCSCPAN
"RTN","FBCHP78",17,0)
 D CLOSE^FBAAUTL Q
"RTN","FBCHP78",18,0)
 ;
"RTN","FBCHP78",19,0)
7078 U IO S UL="",$P(UL,"-",120)="-",L="|" D HED^FBCH78A
"RTN","FBCHP78",20,0)
 S DFN=$P(^FB7078(FB7078,0),"^",3) G END:'$D(DFN)#2!('$D(^DPT(+DFN,0)))
"RTN","FBCHP78",21,0)
 N FBNAME
"RTN","FBCHP78",22,0)
 S FBNAME("FILE")=2,FBNAME("IENS")=DFN_",",FBNAME("FIELD")=.01
"RTN","FBCHP78",23,0)
 S FBNAME=$$NAMEFMT^XLFNAME(.FBNAME,"F","C")
"RTN","FBCHP78",24,0)
 S VAPA("P")="" D SITEP^FBAAUTL,6^VADPT
"RTN","FBCHP78",25,0)
 N FBCONFAD S FBCONFAD=$$ACTIVECC^FBAACO0() I FBCONFAD,$L($G(VAPA(16))) D
"RTN","FBCHP78",26,0)
 . N FBLEN S FBLEN=$L(VAPA(16))+$L($P($G(VAPA(17)),U,2))+$L($P($G(VAPA(18)),U,2))+3 S:FBLEN>52 FBLEN=$L(VAPA(16))-(FBLEN-52),VAPA(16)=$E(VAPA(16),1,FBLEN)
"RTN","FBCHP78",27,0)
 F FBNM=1:1:7 S FBNM(FBNM)=$P(FBSITE(0),"^",FBNM)
"RTN","FBCHP78",28,0)
 S FBNM(5)=$S($D(^DIC(5,FBNM(5))):$P(^(FBNM(5),0),"^",2),1:"")
"RTN","FBCHP78",29,0)
 S Y=$P(FB(0),"^",10) D DATE S FBID=Y,FBVEN=$P(FB(0),"^",2),(FBVEN,FBV(0))=$P(FBVEN,";",1),FBVEN=$S($D(^FBAAV(FBVEN,0)):$P(^(0),"^",1),1:"Unknown"),FBVEN(1)=$S($D(^FBAAV(FBV(0),0)):$P(^(0),"^",2),1:"")
"RTN","FBCHP78",30,0)
 F I=3:1:6,14 S FBV(I)=$S($D(^FBAAV(FBV(0),0)):$P(^(0),"^",I),1:"")
"RTN","FBCHP78",31,0)
 I FBV(5)]"" S FBV(5)=$S($D(^DIC(5,FBV(5),0)):$P(^(0),"^",2),1:"")
"RTN","FBCHP78",32,0)
 S Y=$P(FB(0),"^",4) D DATE S FBFD=Y,Y=$S($P(FB(0),"^",5)]"":$P(FB(0),"^",5),1:"Disposition") D DATE:Y>0 S FBTD=Y
"RTN","FBCHP78",33,0)
 S FB(6)=$P(FB(0),"^",6) I FB(6)]"" S FB(6)=$S($D(^DIC(43.4,FB(6),0)):$P(^(0),"^",3),1:"")
"RTN","FBCHP78",34,0)
 W "Issuing Office",?66,L,"1. Date of Issue",!,?5,FBNM(1),?66,L,?70,FBID,!,?5,FBNM(2),?66,L,$E(UL,1,52),!,?5,$S(FBNM(3)]"":FBNM(3),1:FBNM(4)_", "_FBNM(5)_" "_FBNM(6)),?66,L,"2. Veteran's Name",!
"RTN","FBCHP78",35,0)
 I FBNM(3)]"" W ?5,FBNM(4)_", "_FBNM(5)_" "_FBNM(6)
"RTN","FBCHP78",36,0)
 W ?66,L,?70,FBNAME,!,UL,!,"Name of Physician or Station",?66,L,"3. Address",!,?5,FBVEN,?66,L,?68,$S(FBCONFAD:VAPA(13),1:VAPA(1)),!,?5,FBV(3),?66,L,?68,$S(FBCONFAD:VAPA(14),1:VAPA(2)),!,?5,FBV(14)
"RTN","FBCHP78",37,0)
 W ?66,L,?68,$S(FBCONFAD:VAPA(15),1:VAPA(3)),!?5,FBV(4)_", "_FBV(5)_" "_FBV(6)
"RTN","FBCHP78",38,0)
 W ?66,L,?68,$S(FBCONFAD:$G(VAPA(16)),1:VAPA(4))_", "_$S(FBCONFAD:$P($G(VAPA(17)),U,2),1:$P(VAPA(5),"^",2))_" "_$S(FBCONFAD:$P($G(VAPA(18)),U,2),'+$G(VAPA(11)):VAPA(6),$P(VAPA(11),U,2)]"":$P(VAPA(11),U,2),1:VAPA(6)),!?5,"ID#: ",FBVEN(1)
"RTN","FBCHP78",39,0)
 W ?66,L,$E(UL,1,53),!,?66,L,?68,"4. Veteran's Claim No.",?93,L,?95,"4A. SSN",!,?66,L,?68,VAEL(7),?93,L,?95,$$SSNL4^FBAAUTL($P(VADM(2),"^",2)),!,?66,L,$E(UL,1,53),!,?66,L,?75,"5. Authorization Valid",!,?66,L,$E(UL,1,53),!
"RTN","FBCHP78",40,0)
 W ?66,L,"From",?93,L,"To",!,?66,L,?68,FBFD,?93,L,?95,FBTD,!,UL,!,?45,"PART 1. - SERVICES AUTHORIZED",!,UL,!,"6. Services shown below are authorized for the period indicated in Item 5 above.",?104,L,?107,"7. Fee",!
"RTN","FBCHP78",41,0)
 W ?12,"(See Special Provisions below.)",?104,L,"$",!
"RTN","FBCHP78",42,0)
 S DIWL=1,DIWF="WC103" K ^UTILITY($J,"W")
"RTN","FBCHP78",43,0)
 I $D(^FB7078(FB7078,1,0)) F FBRR=0:0 S FBRR=$O(^FB7078(FB7078,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHP78",44,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHP78",45,0)
 D FISCAL^FBCH78A
"RTN","FBCHP78",46,0)
 W UL,!,"8. Fee Schedule or Contract",?33,L,"9. Authority",?66,L,"9A.",?93,L,"10. Estimated Amount",!?5,$$CONT^FBCH78A(+$P(FB(0),U,2),$P(FB(0),U,4)),?33,L,?35,FB(6),?66,L,?93,L,?95,"$"
"RTN","FBCHP78",47,0)
 K X2 S X=$P(FB(0),"^",7),X3=$L(+X)+2 D COMMA^%DTC K X3 W X,!,UL,!
"RTN","FBCHP78",48,0)
 W "11. Fiscal Symbols",?66,L,"12. Authorized by (Name and Title)",!,?5,FB("SYM"),?66,L,?68,FBO,"  ",FBT,!,UL
"RTN","FBCHP78",49,0)
 D BOT^FBCH78A
"RTN","FBCHP78",50,0)
 Q
"RTN","FBCHP78",51,0)
DATE S Y=$$FMTE^XLFDT(Y) Q
"RTN","FBCHP78",52,0)
 ;
"RTN","FBCHP78",53,0)
FBO S DIR(0)="F^3:45",DIR("A")="Approving Official for 7078",DIR("B")=FBO,DIR("?")="Enter <return> to accept the default or enter a name from 3 to 45 characters in length" D ^DIR K DIR Q:$D(DIRUT)  S FBO=X
"RTN","FBCHP78",54,0)
FBT S DIR(0)="F^3:45",DIR("A")="Title of Approving Official",DIR("B")=FBT,DIR("?")="Enter <return> to accept the default title or enter a title from 3 to 45 characters in length" D ^DIR K DIR Q:$D(DIRUT)  S FBT=X
"RTN","FBCHP78",55,0)
ASKN S DIR(0)="N^1:5",DIR("A")="# of copies of 7078",DIR("B")=FBNUM,DIR("?")="Select a number between 1 and 5.  This number represents the number of copies of the 7078 you would like printed" D ^DIR K DIR Q:$D(DIRUT)  S FBNUM=X
"RTN","FBCHSL1")
0^6^B17943719^B17825081
"RTN","FBCHSL1",1,0)
FBCHSL1 ;AISC/DMK-PRINT SUSPENSION LETTERS CONTINUED ;7/NOV/2006
"RTN","FBCHSL1",2,0)
 ;;3.5;FEE BASIS;**23,69,101**;JAN 30, 1995;Build 2
"RTN","FBCHSL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCHSL1",4,0)
 N FBACRR,FBSCDT
"RTN","FBCHSL1",5,0)
 F K=0:0 S K=$O(^FBAAI("AI",K)) Q:K'>0  I $S($G(IFN):IFN=K,1:1) S FBSW=1,FBDT=BEGDATE-.001 F ZZ=0:0 S FBDT=$O(^FBAAI("AI",K,FBDT)) D WPBOT:FBDT'>0&(FBSW=0)!(FBDT>ENDDATE)&(FBSW=0) Q:FBDT'>0!(FBDT>ENDDATE)  S FBSCDT=FBDT D MORE
"RTN","FBCHSL1",6,0)
 K FBCHAD,FBCHDT,FBAMTC,FBAMTP,FBAMTS Q
"RTN","FBCHSL1",7,0)
MORE F J=0:0 S J=$O(^FBAAI("AI",K,FBDT,J)) Q:J'>0  I $S($G(DFN):DFN=J,1:1) D:$D(^DPT(J,0)) GOTP^FBAASLP I $D(^FBAAV(K,0)) D MID
"RTN","FBCHSL1",8,0)
 Q
"RTN","FBCHSL1",9,0)
GOTV S Y(0)=^FBAAV(K,0),VNAM=$P(Y(0),"^",1),FBSW=0
"RTN","FBCHSL1",10,0)
 I VNAM["," S VNAM=$P(VNAM,",",2)_" "_$P(VNAM,",",1)
"RTN","FBCHSL1",11,0)
 S VST1=$P(Y(0),"^",3),VST2=$P(Y(0),"^",14),VCITY=$P(Y(0),"^",4),VSTATE=$S($D(^DIC(5,+$P(Y(0),"^",5),0)):$P(^(0),"^",2),1:"  "),VZIP=$P(Y(0),"^",6)
"RTN","FBCHSL1",12,0)
 W @IOF,!!!!!!!,?5,VNAM,!,?5,VST1,! I VST2]"" W ?5,VST2,!
"RTN","FBCHSL1",13,0)
 W ?5,VCITY,"  ",VSTATE,"  ",VZIP,!!!!
"RTN","FBCHSL1",14,0)
WPBEG S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBCHSL1",15,0)
 I $D(^FBAA(161.3,FBLET,1,1)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSL1",16,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSL1",17,0)
 D HED
"RTN","FBCHSL1",18,0)
 Q
"RTN","FBCHSL1",19,0)
MID S FBA=0 F FBAA=0:0 S FBA=$O(^FBAAI("AI",K,FBDT,J,FBA)) Q:FBA=""  I $S(FBSLW=0:1,FBSLW=1&($D(FBAAS(FBA))):1,1:0) D MORE2
"RTN","FBCHSL1",20,0)
 Q
"RTN","FBCHSL1",21,0)
MORE2 F L=0:0 S L=$O(^FBAAI("AI",K,FBDT,J,FBA,L)) Q:L'>0  I $D(^FBAAI(L,0)) S Z(0)=^(0) D BOT
"RTN","FBCHSL1",22,0)
 Q
"RTN","FBCHSL1",23,0)
WPBOT D:$D(FBACRR) ACT^FBAASLP K FBACRR
"RTN","FBCHSL1",24,0)
 S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W") W !!
"RTN","FBCHSL1",25,0)
 I $D(^FBAA(161.3,FBLET,2)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,2,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSL1",26,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSL1",27,0)
 Q
"RTN","FBCHSL1",28,0)
BOT Q:$S($G(FBDEN):$P(Z(0),U,9)>0,1:0)  ;quit if not den (if prn den's only)
"RTN","FBCHSL1",29,0)
 N FBY3,FBFPPSC
"RTN","FBCHSL1",30,0)
 S FBY3=$G(^FBAAI(L,3))
"RTN","FBCHSL1",31,0)
 S FBFPPSC=$P(FBY3,U,1) ; fpps claim id
"RTN","FBCHSL1",32,0)
 Q:$S(FBENA=2&(FBFPPSC]""):1,FBENA=1&(FBFPPSC=""):1,1:0)
"RTN","FBCHSL1",33,0)
 N FBCSID,FBFPPSL,FBX,FBADJLR,FBADJLA,FBRRMKL,T,TAMT
"RTN","FBCHSL1",34,0)
 S FBCSID=$P($G(^FBAAI(L,2)),U,11) ; patient control number
"RTN","FBCHSL1",35,0)
 S FBFPPSL=$P(FBY3,U,2) ; fpps line item
"RTN","FBCHSL1",36,0)
 S FBX=$$ADJLRA^FBCHFA(L_",")
"RTN","FBCHSL1",37,0)
 S T=$P(Z(0),U,11)
"RTN","FBCHSL1",38,0)
 I T]"" S T=$P($G(^FBAA(161.27,+T,0)),U)
"RTN","FBCHSL1",39,0)
 S TAMT=$FN($P(Z(0),U,10),"",2)
"RTN","FBCHSL1",40,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBCHSL1",41,0)
 S:FBADJLR]"" FBACRR(FBADJLR)=""
"RTN","FBCHSL1",42,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBCHSL1",43,0)
 S FBRRMKL=$$RRL^FBCHFR(L_",")
"RTN","FBCHSL1",44,0)
 I FBSW=1 D GOTV^FBAASLP,HED S FBSW=0,FBGOT=1
"RTN","FBCHSL1",45,0)
 S Y=$P(Z(0),"^",7) D PDATE^FBAAUTL S FBCHDT=FBPDT,Y=$P(Z(0),"^",6) D PDATE^FBAAUTL S FBCHAD=FBPDT,FBAMTC=$P(Z(0),"^",8),FBAMTP=$P(Z(0),"^",9),FBAMTS=$P(Z(0),"^",10)
"RTN","FBCHSL1",46,0)
 I $Y+4>IOSL W @IOF D HED
"RTN","FBCHSL1",47,0)
 W !!,PNAME,?32,PSSN,?56,FBCHAD
"RTN","FBCHSL1",48,0)
 W !,FBCSID,?24,FBCHDT,?44,"$ ",FBAMTC,?61,"$ ",FBAMTP,!
"RTN","FBCHSL1",49,0)
 ; write adjustment reasons, if null then write suspend code
"RTN","FBCHSL1",50,0)
 W ?4,$S(FBADJLR]"":FBADJLR,1:T)
"RTN","FBCHSL1",51,0)
 ; write adjustment amounts, if null then write amount suspended
"RTN","FBCHSL1",52,0)
 W ?32,"$ ",$S(FBADJLA]"":FBADJLA,1:TAMT)
"RTN","FBCHSL1",53,0)
 W ?59,FBRRMKL
"RTN","FBCHSL1",54,0)
 I FBFPPSC]"" W !,?4,"FPPS Claim ID: ",FBFPPSC,?32,"FPPS Line Item: ",FBFPPSL,!
"RTN","FBCHSL1",55,0)
 I FBADJLR="" G:FBA=4&($D(^FBAAI(L,1,0))) WPFT D
"RTN","FBCHSL1",56,0)
 . S DIWL=1,DIWF="WC79",FBI=FBA K ^UTILITY($J,"W")
"RTN","FBCHSL1",57,0)
 . F FBRR=0:0 S FBRR=$O(^FBAA(161.27,FBI,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSL1",58,0)
 . D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSL1",59,0)
 Q
"RTN","FBCHSL1",60,0)
HED W !,"PATIENT NAME",?36,"SSN",?53,"ADMISSION DATE"
"RTN","FBCHSL1",61,0)
 W !,"PATIENT CONTROL #",?22,"DISCHARGE DATE",?42,"AMOUNT CLAIMED",?59,"AMOUNT PAID"
"RTN","FBCHSL1",62,0)
 W !,"ADJUSTMENT CODE",?29,"ADJUSTMENT AMOUNT",?54,"MEDICARE REMITTANCE REMARK"
"RTN","FBCHSL1",63,0)
 W !,UL,! Q
"RTN","FBCHSL1",64,0)
 ;
"RTN","FBCHSL1",65,0)
GOTP ; Utilize new API for Name Standardization
"RTN","FBCHSL1",66,0)
 ;
"RTN","FBCHSL1",67,0)
 S Y(0)=^DPT(J,0),PNAME=$$NAME^FBCHREQ2(J)
"RTN","FBCHSL1",68,0)
 S PSSN=$TR($$SSNL4^FBAAUTL($$SSN^FBAAUTL(J)),"-","")
"RTN","FBCHSL1",69,0)
 I PNAME["," D
"RTN","FBCHSL1",70,0)
 .N FBNAMES
"RTN","FBCHSL1",71,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=J_",",FBNAMES("FIELD")=.01
"RTN","FBCHSL1",72,0)
 .S PNAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBCHSL1",73,0)
 Q
"RTN","FBCHSL1",74,0)
WPFT S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBCHSL1",75,0)
 F FBRR=0:0 S FBRR=$O(^FBAAI(L,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSL1",76,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSL1",77,0)
 Q
"RTN","FBCHSL1",78,0)
HELP W !,"Answer 'Yes' to print suspension letters for all suspension",!,"codes, otherwise answer 'No' to select specific codes." G RDCODE^FBAASLP
"RTN","FBCHSLP")
0^7^B12851688^B12763560
"RTN","FBCHSLP",1,0)
FBCHSLP ;AISC/DMK-PRINT SUSPENSION LETTERS CONTINUED ;7/NOV/2006
"RTN","FBCHSLP",2,0)
 ;;3.5;FEE BASIS;**23,101**;JAN 30, 1995;Build 2
"RTN","FBCHSLP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCHSLP",4,0)
 F K=0:0 S K=$O(^FBAA(162.2,"AI",K)) Q:K'>0  I $S($G(IFN):IFN=K,1:1) S FBSW=1,FBDT=BEGDATE-.001 F ZZ=0:0 S FBDT=$O(^FBAA(162.2,"AI",K,FBDT)) D WPBOT:FBDT'>0&(FBSW=0)!(FBDT>ENDDATE)&(FBSW=0) Q:FBDT'>0!(FBDT>ENDDATE)  D MORE
"RTN","FBCHSLP",5,0)
 K FBCHAD,FBCHDT,FBCHPHY Q
"RTN","FBCHSLP",6,0)
MORE F J=0:0 S J=$O(^FBAA(162.2,"AI",K,FBDT,J)) Q:J'>0  I $S($G(DFN):DFN=J,1:1) D:$D(^DPT(J,0)) GOTP^FBAASLP I $D(^FBAAV(K,0)) D MID
"RTN","FBCHSLP",7,0)
 Q
"RTN","FBCHSLP",8,0)
GOTV S Y(0)=^FBAAV(K,0),VNAM=$P(Y(0),"^",1),FBSW=0
"RTN","FBCHSLP",9,0)
 I VNAM["," S VNAM=$P(VNAM,",",2)_" "_$P(VNAM,",",1)
"RTN","FBCHSLP",10,0)
 S VST1=$P(Y(0),"^",3),VST2=$P(Y(0),"^",14),VCITY=$P(Y(0),"^",4),VSTATE=$S($D(^DIC(5,+$P(Y(0),"^",5),0)):$P(^(0),"^",2),1:"  "),VZIP=$P(Y(0),"^",6)
"RTN","FBCHSLP",11,0)
 W @IOF,!!!!!!!,?5,VNAM,!,?5,VST1,! I VST2]"" W ?5,VST2,!
"RTN","FBCHSLP",12,0)
 W ?5,VCITY,"  ",VSTATE,"  ",VZIP,!!!!
"RTN","FBCHSLP",13,0)
WPBEG S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBCHSLP",14,0)
 I $D(^FBAA(161.3,FBLET,1,1)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSLP",15,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSLP",16,0)
 D HED
"RTN","FBCHSLP",17,0)
 Q
"RTN","FBCHSLP",18,0)
MID S FBA=0 F FBAA=0:0 S FBA=$O(^FBAA(162.2,"AI",K,FBDT,J,FBA)) Q:FBA=""  I $S(FBSLW=0:1,FBSLW=1&($D(FBAAS(FBA))):1,1:0) D MORE2
"RTN","FBCHSLP",19,0)
 Q
"RTN","FBCHSLP",20,0)
MORE2 F L=0:0 S L=$O(^FBAA(162.2,"AI",K,FBDT,J,FBA,L)) Q:L'>0  I $D(^FBAA(162.2,L,0)) S Z(0)=^(0) D BOT
"RTN","FBCHSLP",21,0)
 Q
"RTN","FBCHSLP",22,0)
WPBOT S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W") W !!
"RTN","FBCHSLP",23,0)
 I $D(^FBAA(161.3,FBLET,2)) F FBRR=0:0 S FBRR=$O(^FBAA(161.3,FBLET,2,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSLP",24,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSLP",25,0)
 Q
"RTN","FBCHSLP",26,0)
BOT I FBSW=1 D GOTV^FBAASLP,HED S FBSW=0,FBGOT=1
"RTN","FBCHSLP",27,0)
 S Y=$P($P(Z(0),"^"),".") D PDATE^FBAAUTL S FBCHDT=FBPDT,Y=$P($P(Z(0),"^",5),".") D PDATE^FBAAUTL S FBCHAD=FBPDT,FBCHPHY=$P(Z(0),"^",7)
"RTN","FBCHSLP",28,0)
 D GOTPHY
"RTN","FBCHSLP",29,0)
 I $Y+4>IOSL W @IOF D HED
"RTN","FBCHSLP",30,0)
 W !!,PNAME,?32,PSSN,?56,FBCHDT,!,?18,FBCHAD,?46,FBCHPHY,!
"RTN","FBCHSLP",31,0)
 G:FBA=4&($D(^FBAA(162.2,L,1,0))) WPFT
"RTN","FBCHSLP",32,0)
 S DIWL=1,DIWF="WC79",FBI=FBA K ^UTILITY($J,"W")
"RTN","FBCHSLP",33,0)
 F FBRR=0:0 S FBRR=$O(^FBAA(161.27,FBI,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSLP",34,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSLP",35,0)
 Q
"RTN","FBCHSLP",36,0)
HED W !,"PATIENT NAME",?36,"SSN",?53,"NOTIFICATION DATE",!,?15,"ADMISSION DATE",?43,"ATTENDING PHYSICIAN",!,"   REASON FOR SUSPENSION",!,UL,! Q
"RTN","FBCHSLP",37,0)
 ;
"RTN","FBCHSLP",38,0)
GOTP ; Utilize new API for Name Standardization
"RTN","FBCHSLP",39,0)
 ;
"RTN","FBCHSLP",40,0)
 S Y(0)=^DPT(J,0),PNAME=$$NAME^FBCHREQ2(J)
"RTN","FBCHSLP",41,0)
 S PSSN=$TR($$SSNL4^FBAAUTL($$SSN^FBAAUTL(J)),"-","")
"RTN","FBCHSLP",42,0)
 I PNAME["," D
"RTN","FBCHSLP",43,0)
 .N FBNAMES
"RTN","FBCHSLP",44,0)
 .S FBNAMES("FILE")=2,FBNAMES("IENS")=J_",",FBNAMES("FIELD")=.01
"RTN","FBCHSLP",45,0)
 .S PNAME=$$NAMEFMT^XLFNAME(.FBNAMES)
"RTN","FBCHSLP",46,0)
 Q
"RTN","FBCHSLP",47,0)
WPFT S DIWL=1,DIWF="WC79" K ^UTILITY($J,"W")
"RTN","FBCHSLP",48,0)
 F FBRR=0:0 S FBRR=$O(^FBAA(162.2,L,1,FBRR)) Q:FBRR'>0  S FBXX=^(FBRR,0),X=FBXX D ^DIWP
"RTN","FBCHSLP",49,0)
 D ^DIWW:$D(FBXX) K FBXX
"RTN","FBCHSLP",50,0)
 Q
"RTN","FBCHSLP",51,0)
HELP W !,"Answer 'Yes' to print suspension letters for all suspension",!,"codes, otherwise answer 'No' to select specific codes." G RDCODE^FBAASLP
"RTN","FBCHSLP",52,0)
GOTPHY S FBCHPHY=$S(FBCHPHY="":"Unknown",1:FBCHPHY)
"RTN","FBCHSLP",53,0)
 I FBCHPHY["," S FBCHPHY=$P(FBCHPHY,",",2)_" "_$P(FBCHPHY,",")
"RTN","FBCHSLP",54,0)
 Q
"RTN","FBCKDIS")
0^8^B45741466^B45506524
"RTN","FBCKDIS",1,0)
FBCKDIS ;AISC/CMR-OUTPUT BY CHECK # ;7/NOV/2006
"RTN","FBCKDIS",2,0)
 ;;3.5;FEE BASIS;**4,61,101**;JAN 30, 1995;Build 2
"RTN","FBCKDIS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBCKDIS",4,0)
 ;FBCN=Check Number               FBPROG=Fee payment type
"RTN","FBCKDIS",5,0)
 ;FBPR is set if called from the phone menu.  If this variable exists,
"RTN","FBCKDIS",6,0)
 ;     the user will not be returned to the TOP to select another ck #.
"RTN","FBCKDIS",7,0)
TOP W ! S DIR(0)="FO^1:8",DIR("A")="Select Check Number" D ^DIR K DIR Q:Y=""!(Y="^")  S FBCN=Y
"RTN","FBCKDIS",8,0)
 I '$D(^FBAAC("ACK",FBCN)),('$D(^FBAAC("ACKT",FBCN))),('$D(^FBAAI("ACK",FBCN))),('$D(^FBAA(162.1,"ACK",FBCN))) W !!,*7,"There is no record of that check number." G TOP
"RTN","FBCKDIS",9,0)
 S VAR="FBCN",VAL=FBCN,PGM="START^FBCKDIS" D ZIS^FBAAUTL G END:FBPOP
"RTN","FBCKDIS",10,0)
START S Q="-",$P(Q,"-",80)="-",QQ="=",$P(QQ,"=",80)="=",FBPG=1 K ^TMP($J,"FBCK")
"RTN","FBCKDIS",11,0)
 N FBV,DFN D ^FBCKDIS1
"RTN","FBCKDIS",12,0)
 U IO W:$E(IOST,1,2)["C-" @IOF
"RTN","FBCKDIS",13,0)
 F FBPROG="OPT","CH","CNH","PHAR","TRAV" I $D(^TMP($J,"FBCK",FBPROG)) D PGCHK D  Q:$G(FBAAOUT)
"RTN","FBCKDIS",14,0)
 .S FBV=0 F  S FBV=$O(^TMP($J,"FBCK",FBPROG,FBV)) Q:FBV']""!($G(FBAAOUT))  W:FBPROG'="TRAV" !!,"VENDOR:  ",$$VNAME^FBNHEXP(FBV),?40,"  VENDOR ID:  ",$$VID^FBNHEXP(FBV) D
"RTN","FBCKDIS",15,0)
 ..S DFN=0 F  S DFN=$O(^TMP($J,"FBCK",FBPROG,FBV,DFN)) Q:'DFN!($G(FBAAOUT))  D:$Y+8>IOSL PGCHK Q:$G(FBAAOUT)  W !!,"Patient:  ",$$NAME^FBCHREQ2(DFN),?40,"Patient ID:  ",$$SSNL4^FBAAUTL($$SSN^FBAAUTL(DFN)) D
"RTN","FBCKDIS",16,0)
 ...N FBAARC,FBADJLA,FBADJLR,FBC,FBFPPSC,FBFPPSL,FBSUSPA,FBX
"RTN","FBCKDIS",17,0)
 ...S FBCNT=0 F  S FBCNT=$O(^TMP($J,"FBCK",FBPROG,FBV,DFN,FBCNT)) Q:'FBCNT!($G(FBAAOUT))  S FBDA=^(FBCNT) D @FBPROG,OUTPUT,CLEAN
"RTN","FBCKDIS",18,0)
END K FBCN,FBCNT,DFN,FBV,FBPROG,FBPG,DIRUT,DTOUT,DUOUT,Q,QQ,^TMP($J,"FBCK")
"RTN","FBCKDIS",19,0)
 D CLOSE^FBAAUTL
"RTN","FBCKDIS",20,0)
 I $G(FBAAOUT) K FBAAOUT Q
"RTN","FBCKDIS",21,0)
 Q:$G(FBPR)]""!($G(ZTQUEUED))
"RTN","FBCKDIS",22,0)
 W !! S DIR(0)="E" D ^DIR K DIR Q:'Y  G TOP
"RTN","FBCKDIS",23,0)
OPT ;gather payment line item for outpatient
"RTN","FBCKDIS",24,0)
 F I=1:1:4 S FB(I)=+$P(FBDA,U,I)
"RTN","FBCKDIS",25,0)
 S FBA=^FBAAC(FB(1),1,FB(2),1,FB(3),1,FB(4),0),FBB=^(2),FBC=$G(^(3))
"RTN","FBCKDIS",26,0)
 S FBDOS=+^FBAAC(FB(1),1,FB(2),1,FB(3),0)
"RTN","FBCKDIS",27,0)
 S FBSRV=$$CPT^FBAAUTL4($P(FBA,U))
"RTN","FBCKDIS",28,0)
 S FBMODLE=$$MODL^FBAAUTL4("^FBAAC("_FB(1)_",1,"_FB(2)_",1,"_FB(3)_",1,"_FB(4)_",""M"")","E")
"RTN","FBCKDIS",29,0)
 S FBSRV=FBSRV_$S($G(FBMODLE)]"":"-"_FBMODLE,1:"")
"RTN","FBCKDIS",30,0)
 S FBAMCL=$P(FBA,U,2),FBAMPD=$P(FBA,U,3)
"RTN","FBCKDIS",31,0)
 S FBSUSP=$P(FBA,U,5) D SUSP^FBCKDIS1
"RTN","FBCKDIS",32,0)
 S FBSUSPA=$FN($P(FBA,U,4),"",2)
"RTN","FBCKDIS",33,0)
 S FBFPPSC=$P(FBC,U)
"RTN","FBCKDIS",34,0)
 S FBFPPSL=$P(FBC,U,2)
"RTN","FBCKDIS",35,0)
 S FBAARCE=$$GET1^DIQ(162.03,FB(4)_","_FB(3)_","_FB(2)_","_FB(1)_",",48)
"RTN","FBCKDIS",36,0)
 S FBX=$$ADJLRA^FBAAFA(FB(4)_","_FB(3)_","_FB(2)_","_FB(1)_",")
"RTN","FBCKDIS",37,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBCKDIS",38,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBCKDIS",39,0)
 S FBVP=$P(FBA,U,21),FBREIM=$P(FBA,U,20),FBBAT=$P(FBA,U,8),FBINV=$P(FBA,U,16)
"RTN","FBCKDIS",40,0)
 D FBCKO^FBAACCB2(FB(1),FB(2),FB(3),FB(4))
"RTN","FBCKDIS",41,0)
 Q
"RTN","FBCKDIS",42,0)
CH ;gather payment line item for ch
"RTN","FBCKDIS",43,0)
CNH ;gather payment line item for cnh
"RTN","FBCKDIS",44,0)
 S FBA=^FBAAI(FBDA,0),FBB=^(2),FBC=$G(^(3)),FBDOS=$P(FBA,U,6)_"-"_$P(FBA,U,7),FBAMCL=$P(FBA,U,8),FBAMPD=$P(FBA,U,9),FBSUSP=$P(FBA,U,11) D SUSP^FBCKDIS1
"RTN","FBCKDIS",45,0)
 S FBVP=$P(FBA,U,14),FBREIM=$P(FBA,U,13),FBBAT=$P(FBA,U,17),FBINV=+FBA
"RTN","FBCKDIS",46,0)
 S FBSUSPA=$FN($P(FBA,U,10),"",2)
"RTN","FBCKDIS",47,0)
 S FBFPPSC=$P(FBC,U)
"RTN","FBCKDIS",48,0)
 S FBFPPSL=$P(FBC,U,2)
"RTN","FBCKDIS",49,0)
 S FBX=$$ADJLRA^FBCHFA(FBDA_",")
"RTN","FBCKDIS",50,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBCKDIS",51,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBCKDIS",52,0)
 D FBCKI^FBAACCB1(FBDA)
"RTN","FBCKDIS",53,0)
 Q
"RTN","FBCKDIS",54,0)
PHAR ;gather payment line item for pharmacy
"RTN","FBCKDIS",55,0)
 F I=1,2 S FB(I)=$P(FBDA,U,I)
"RTN","FBCKDIS",56,0)
 S FBA=^FBAA(162.1,FB(1),"RX",FB(2),0),FBB=^(2),FBC=$G(^(3)),FBDOS=$P(FBA,U,3),FBSRV=$P(FBA,"^"),FBAMCL=$P(FBA,U,4),FBAMPD=$P(FBA,U,16),FBSUSP=$P(FBA,U,8) D SUSP^FBCKDIS1
"RTN","FBCKDIS",57,0)
 S FBVP=$P(FBB,U,3),FBREIM=$P(FBA,U,20),FBBAT=$P($G(FBA),U,17),FBINV=+$G(^FBAA(162.1,FB(1),0))
"RTN","FBCKDIS",58,0)
 S FBSUSPA=$FN($P(FBA,U,7),"",2)
"RTN","FBCKDIS",59,0)
 S FBFPPSC=$P($G(^FBAA(162.1,FB(1),0)),U,13)
"RTN","FBCKDIS",60,0)
 S FBFPPSL=$P(FBC,U)
"RTN","FBCKDIS",61,0)
 S FBX=$$ADJLRA^FBRXFA(FB(2)_","_FB(1)_",")
"RTN","FBCKDIS",62,0)
 S FBADJLR=$P(FBX,U)
"RTN","FBCKDIS",63,0)
 S FBADJLA=$P(FBX,U,2)
"RTN","FBCKDIS",64,0)
 D FBCKP^FBAACCB1(FB(1),FB(2))
"RTN","FBCKDIS",65,0)
 Q
"RTN","FBCKDIS",66,0)
TRAV ;gather payment line item for travel
"RTN","FBCKDIS",67,0)
 F I=1,2 S FB(I)=$P(FBDA,U,I)
"RTN","FBCKDIS",68,0)
 S FBA=^FBAAC(FB(1),3,FB(2),0),FBDOS=+FBA,FBAMCL=$P(FBA,U,3),FBAMPD=FBAMCL,FBVP="",FBREIM="R",FBBAT=$P(FBA,U,2),FBINV=""
"RTN","FBCKDIS",69,0)
 D FBCKT^FBAACCB0(FB(1),FB(2))
"RTN","FBCKDIS",70,0)
 Q
"RTN","FBCKDIS",71,0)
CLEAN ;clean up variables
"RTN","FBCKDIS",72,0)
 K I,FB,FBA,FBB,FBDOS,FBSRV,FBMOD,FBAMCL,FBAMPD,FBSUSP,FBVP,FBREIM,FBBAT,FBINV,FBDA,FBMODLE
"RTN","FBCKDIS",73,0)
 Q
"RTN","FBCKDIS",74,0)
OUTPUT ;display line items for check number
"RTN","FBCKDIS",75,0)
 I $Y+5>IOSL D PGCHK Q:$G(FBAAOUT)
"RTN","FBCKDIS",76,0)
 W ! W:FBVP="VP" "#" W:FBREIM="R" "*" W:FBCAN]"" "+" D  Q:$G(FBAAOUT)
"RTN","FBCKDIS",77,0)
 . I FBPROG["C" D  Q
"RTN","FBCKDIS",78,0)
 . . W ?3,$$DATX^FBAAUTL($P(FBDOS,"-")),?15,$$DATX^FBAAUTL($P(FBDOS,"-",2)),?59,+$G(^FBAA(161.7,+FBBAT,0)),?68,FBINV
"RTN","FBCKDIS",79,0)
 . . W !?3,$J($FN(FBAMCL,",",2),10),?15,$J($FN(FBAMPD,",",2),10)
"RTN","FBCKDIS",80,0)
 . . ; write adjustment reasons, if null then write suspend code
"RTN","FBCKDIS",81,0)
 . . W ?28,$S(FBADJLR]"":FBADJLR,1:FBSUSP)
"RTN","FBCKDIS",82,0)
 . . ; write adjustment amounts, if null then write amount suspended
"RTN","FBCKDIS",83,0)
 . . W ?38,$S(FBADJLA]"":FBADJLA,1:FBSUSPA)
"RTN","FBCKDIS",84,0)
 . . I FBFPPSC]"" W !,?12,"FPPS Claim ID: ",FBFPPSC,?40,"FPPS Line Item: ",FBFPPSL
"RTN","FBCKDIS",85,0)
 . I FBPROG="OPT" D  Q
"RTN","FBCKDIS",86,0)
 . . W ?3,$$DATX^FBAAUTL(FBDOS),?13,$P(FBSRV,","),?23,FBAARCE
"RTN","FBCKDIS",87,0)
 . . W ?59,+$G(^FBAA(161.7,+FBBAT,0)),?68,FBINV
"RTN","FBCKDIS",88,0)
 . . I $P(FBSRV,",",2)]"" D  Q:$G(FBAAOUT)
"RTN","FBCKDIS",89,0)
 . . . N FBI,FBMOD
"RTN","FBCKDIS",90,0)
 . . . F FBI=2:1 S FBMOD=$P(FBSRV,",",FBI) Q:FBMOD=""  D  Q:$G(FBAAOUT)
"RTN","FBCKDIS",91,0)
 . . . . I $Y+5>IOSL D PGCHK Q:$G(FBAAOUT)  W !,"  (continued)"
"RTN","FBCKDIS",92,0)
 . . . . W !,?18,"-",FBMOD
"RTN","FBCKDIS",93,0)
 . . W !?3,$J($FN(FBAMCL,",",2),10),?15,$J($FN(FBAMPD,",",2),10)
"RTN","FBCKDIS",94,0)
 . . ; write adjustment reasons, if null then write suspend code
"RTN","FBCKDIS",95,0)
 . . W ?28,$S(FBADJLR]"":FBADJLR,1:FBSUSP)
"RTN","FBCKDIS",96,0)
 . . ; write adjustment amounts, if null then write amount suspended
"RTN","FBCKDIS",97,0)
 . . W ?38,$S(FBADJLA]"":FBADJLA,1:FBSUSPA)
"RTN","FBCKDIS",98,0)
 . . I FBFPPSC]"" W !,?12,"FPPS Claim ID: ",FBFPPSC,?40,"FPPS Line Item: ",FBFPPSL
"RTN","FBCKDIS",99,0)
 . I FBPROG="PHAR" D  Q
"RTN","FBCKDIS",100,0)
 . . W ?3,$$DATX^FBAAUTL(FBDOS),?13,FBSRV,?59,+$G(^FBAA(161.7,+FBBAT,0)),?68,FBINV
"RTN","FBCKDIS",101,0)
 . . W !?3,$J($FN(FBAMCL,",",2),10),?15,$J($FN(FBAMPD,",",2),10)
"RTN","FBCKDIS",102,0)
 . . ; write adjustment reasons, if null then write suspend code
"RTN","FBCKDIS",103,0)
 . . W ?28,$S(FBADJLR]"":FBADJLR,1:FBSUSP)
"RTN","FBCKDIS",104,0)
 . . ; write adjustment amounts, if null then write amount suspended
"RTN","FBCKDIS",105,0)
 . . W ?38,$S(FBADJLA]"":FBADJLA,1:FBSUSPA)
"RTN","FBCKDIS",106,0)
 . . I FBFPPSC]"" W !,?12,"FPPS Claim ID: ",FBFPPSC,?40,"FPPS Line Item: ",FBFPPSL
"RTN","FBCKDIS",107,0)
 . W ?3,$$DATX^FBAAUTL(FBDOS) W:FBPROG'="TRAV" ?13,FBSRV W ?20,$J($FN(FBAMCL,",",2),10),?32,$J($FN(FBAMPD,",",2),10) W:FBPROG'="TRAV" ?47,FBSUSP W ?53,+$G(^FBAA(161.7,+FBBAT,0)),?65,FBINV
"RTN","FBCKDIS",108,0)
 S A2=FBAMPD D PMNT^FBAACCB2 K A2
"RTN","FBCKDIS",109,0)
 Q
"RTN","FBCKDIS",110,0)
HED W !?20,"PAYMENT HISTORY FOR CHECK # ",FBCN,!,?20,$E(Q,1,(28+$L(FBCN))),?70,"Page: ",FBPG
"RTN","FBCKDIS",111,0)
 W !!,?22,"FEE PROGRAM:  ",$S(FBPROG="OPT":"OUTPATIENT",FBPROG="CH":"CIVIL HOSPITAL",FBPROG="CNH":"COMMUNITY NURSING HOME",FBPROG="PHAR":"PHARMACY",FBPROG="TRAV":"TRAVEL",1:"")
"RTN","FBCKDIS",112,0)
 W !?1,"('*' Reimbursement to Patient  '#' Voided Payment  '+' Cancellation Activity)"
"RTN","FBCKDIS",113,0)
 I FBPROG["C" D  Q
"RTN","FBCKDIS",114,0)
 . W !?3,"From Date",?15,"To Date",?59,"Batch #",?68,"Invoice #"
"RTN","FBCKDIS",115,0)
 . W !?3,"Amt Claimed",?17,"Amt Paid",?28,"Adj Code",?38,"Adj Amount"
"RTN","FBCKDIS",116,0)
 . W !,QQ
"RTN","FBCKDIS",117,0)
 I FBPROG="TRAV" W !?3,"Travel Dt",?21,"Amount",?33,"Amount",?50,"Batch",?62,"Invoice",!,?21,"Claimed",?34,"Paid",?50,"Number",?62,"Number",!,QQ Q
"RTN","FBCKDIS",118,0)
 I FBPROG="OPT" D  Q
"RTN","FBCKDIS",119,0)
 . W !?3,"Svc Date",?13,"CPT-MOD",?23,"Rev.Code",?59,"Batch #",?68,"Invoice #"
"RTN","FBCKDIS",120,0)
 . W !?3,"Amt Claimed",?17,"Amt Paid",?28,"Adj Code",?38,"Adj Amount"
"RTN","FBCKDIS",121,0)
 . W !,QQ
"RTN","FBCKDIS",122,0)
 I FBPROG="PHAR" D  Q
"RTN","FBCKDIS",123,0)
 . W !?3,"Fill Dt",?13,"RX #",?56,"Batch #",?68,"Invoice #"
"RTN","FBCKDIS",124,0)
 . W !?3,"Amt Claimed",?17,"Amt Paid",?28,"Adj Code",?38,"Adj Amount"
"RTN","FBCKDIS",125,0)
 . W !,QQ
"RTN","FBCKDIS",126,0)
 Q
"RTN","FBCKDIS",127,0)
PGCHK I FBPG>1,($E(IOST,1,2)["C-") W !! S DIR(0)="E" D ^DIR K DIR I 'Y S FBAAOUT=1 Q
"RTN","FBCKDIS",128,0)
 W:FBPG>1 @IOF D HED
"RTN","FBCKDIS",129,0)
 S FBPG=FBPG+1 Q
"RTN","FBPAY")
0^9^B23215148^B23138914
"RTN","FBPAY",1,0)
FBPAY ;AISC/DMK,GRR,TET-PATIENT/VENDOR PAYMENT OUTPUT DRIVER ;20/NOV/2006
"RTN","FBPAY",2,0)
 ;;3.5;FEE BASIS;**32,69,101**;JAN 30, 1995;Build 2
"RTN","FBPAY",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPAY",4,0)
GETVEN ;select vendor
"RTN","FBPAY",5,0)
 K FBX S FBSORT=0 ;FBSORT=1 for patient, = 0 for vendor
"RTN","FBPAY",6,0)
 S DIC="^FBAAV(",DIC(0)="AEQMZ",DIC("A")="Select Fee Vendor: " W !! D ^DIC K DIC("A") G EXIT:$D(DTOUT)!($D(DUOUT))!(X=""),GETVEN:Y<0
"RTN","FBPAY",7,0)
 S FBIEN=+Y,FBNAME=$S(Y(0,0)]"":Y(0,0),1:"UNKNOWN"),FBID=$S($P(Y(0),U,2)]"":$P(Y(0),U,2),1:"UNKNOWN") G DATE
"RTN","FBPAY",8,0)
GETVET ;select patient
"RTN","FBPAY",9,0)
 K FBX S FBSORT=1 ;FBSORT=1 for patient, =0 for vendor
"RTN","FBPAY",10,0)
 S DIC="^FBAAA("
"RTN","FBPAY",11,0)
 S DIC(0)="AEQMNZ",DIC("A")="Select Fee Patient: " W !! D ^DIC K DIC("A") G EXIT:$D(DTOUT)!($D(DUOUT))!(X=""),GETVET:Y<0
"RTN","FBPAY",12,0)
 S FBIEN=+Y,FBNAME=Y(0,0),FBID=$$SSNL4^FBAAUTL($$SSN^FBAAUTL(FBIEN))
"RTN","FBPAY",13,0)
DATE ;select date range
"RTN","FBPAY",14,0)
 D DATE^FBAAUTL I FBPOP G GETVET:FBSORT,GETVEN
"RTN","FBPAY",15,0)
 S FBBDATE=BEGDATE,FBEDATE=ENDDATE
"RTN","FBPAY",16,0)
 S Z=9999999.9999,FBBEG=Z-FBEDATE,FBEND=Z-FBBDATE
"RTN","FBPAY",17,0)
PROG ;select one/many/all fee programs
"RTN","FBPAY",18,0)
 I '$G(FBCHK) S DIC="^FBAA(161.8,",DIC("S")="I $P(^(0),U,3)",VAUTSTR="FEE Program",VAUTNI=2,VAUTVB="FBPROG" D FIRST^VAUTOMA I 'FBPROG&('$O(FBPROG(0))) G GETVET:FBSORT,GETVEN
"RTN","FBPAY",19,0)
 I FBPROG S FBERR=0 D ARRAY G EXIT:FBERR
"RTN","FBPAY",20,0)
ASKMB ; if outpatient or civil hospital or pharmacy selected then ask if
"RTN","FBPAY",21,0)
 ;   report for just mill-bill (1725) or just non-mill bill claims
"RTN","FBPAY",22,0)
 I $D(FBPROG(2))!$D(FBPROG(3))!$D(FBPROG(6)) S FB1725R=$$ASKMB^FBUCUTL9 I FB1725R="" G EXIT
"RTN","FBPAY",23,0)
Q K ^TMP($J,"FB"),^TMP($J,"FBTR"),DIC S FBX=FBSORT
"RTN","FBPAY",24,0)
 S VAR="FBNAME^FBIEN^FBID^FBBEG^FBEND^FBBDATE^FBEDATE^FBPROG^FBPROG(^FBSORT^FB1725R",VAL=VAR,PGM="DQ^FBPAY" D ZIS^FBAAUTL G:FBPOP EXIT
"RTN","FBPAY",25,0)
DQ S $P(FBDASH,"=",80)="",$P(FBDASH1,"-",80)="",FBPG=0,FBCRT=$S($E(IOST,1,2)="C-":1,1:0),FBOUT=0,FBBEG=FBBEG-.9 U IO
"RTN","FBPAY",26,0)
SORT ;sort driver for payment output(s)
"RTN","FBPAY",27,0)
 S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D
"RTN","FBPAY",28,0)
 .I FBPI=2 D EN^FBPAY2 ;outpatient payments
"RTN","FBPAY",29,0)
 .I FBPI=3 D EN^FBPAY3 ;pharmacy payments
"RTN","FBPAY",30,0)
 .I FBPI=6!(FBPI=7) S:FBPI=6&$D(FBPROG(7)) FBPIFLG=67 D EN^FBPAY67 S:$D(FBPIFLG) FBPI=7 K FBPIFLG ;civil hospital/cnh payments
"RTN","FBPAY",31,0)
PRINT ;print driver for payment output(s)
"RTN","FBPAY",32,0)
 S FBPI=$O(^TMP($J,"FB",0)) I FBPI']"" D WMSG G OUT
"RTN","FBPAY",33,0)
 S (FBOUT,FBPI)=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  S FBXPROG=FBPROG(FBPI) D  Q:FBOUT
"RTN","FBPAY",34,0)
 .I FBPI=2,$D(^TMP($J,"FB",FBPI)) D PRINT^FBPAY21 Q:$G(FBOUT)  D:$D(^TMP($J,"FB",FBPI_"O")) OTH Q
"RTN","FBPAY",35,0)
 .I FBPI=3 D:$D(^TMP($J,"FB",FBPI)) PRINT^FBPAY3 Q:$G(FBOUT)  D:$D(^TMP($J,"FB",FBPI_"O")) OTH Q
"RTN","FBPAY",36,0)
 .I FBPI=6!(FBPI=7) D:$D(^TMP($J,"FB",FBPI)) PRINT^FBPAY671 Q:$G(FBOUT)  D:$D(^TMP($J,"FB",FBPI_"O")) OTH Q
"RTN","FBPAY",37,0)
OUT I FBOUT!$D(ZTQUEUED) G EXIT
"RTN","FBPAY",38,0)
 D KILL G GETVET:FBX,GETVEN
"RTN","FBPAY",39,0)
 Q
"RTN","FBPAY",40,0)
EXIT ;kill and quit
"RTN","FBPAY",41,0)
 K FBX
"RTN","FBPAY",42,0)
KILL ;kill all variables set in the FBPAY* routines, other than fbx
"RTN","FBPAY",43,0)
 D CLOSE^FBAAUTL K ^TMP($J,"FB"),^TMP($J,"FBTR")
"RTN","FBPAY",44,0)
 K A1,A2,A3,BEGDATE,B3,C,C3,D,D2,DFN,DIC,DIR,DTOUT,DUOUT,ENDDATE
"RTN","FBPAY",45,0)
 K FBAACPTC,FBAC,FBAP,FBBATCH,FBBDATE,FBBEG,FBBN,FBCNT,FBCP,FBCRT,FBDA1,FBDASH,FBDASH1,FBDATA,FBDOB,FBDRUG,FBDT,FBDT1,FBDOS,FBEDATE,FBEND,FBERR,FBFD,FBFD1,FBHEAD,FBMOD
"RTN","FBPAY",46,0)
 K FBI,FBID,FBIEN,FBIN,FBINVN,FBIX,FBLOC,FBM,FBNAME,FBOB,FBOPI,FBOUT,FBOV,FBP,FBPAT,FBPD,FBPDX,FBPG,FBPI,FBPID,FBPIFLG,FBPIN,FBPISV,FBPNAME,FBPROG,FBPT,FBPV,FBQTY,FBREIM,FBR,FBRX,FBTRCK
"RTN","FBPAY",47,0)
 K FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,TAMT,FBRRMKL,FBADJ,FBINV
"RTN","FBPAY",48,0)
 K FBSC,FBSL,FBSORT,FBSTR,FBSUSP,FBTA,FBTRDT,FBTRX,FBTYPE,FBV,FBVCHAIN,FBVNAME,FBVI,FBVID,FBVP,FBXPROG,FBY,FBZ,I,J,K,L,M,PGM,T,V,VA,VAERR,VAL,VAR,VAUTNI,VAUTSTR,VAUTVB,X,Y,Z
"RTN","FBPAY",49,0)
 K FB1725R
"RTN","FBPAY",50,0)
 Q
"RTN","FBPAY",51,0)
ARRAY ;set array if all programs are selected
"RTN","FBPAY",52,0)
 S FBPI=0 F  S FBPI=$O(^FBAA(161.8,FBPI)) Q:'FBPI  S FBPIN=$G(^(FBPI,0)) I $P(FBPIN,U,3) S FBPROG(FBPI)=$P(FBPIN,U)
"RTN","FBPAY",53,0)
 I '$D(FBPROG) S FBERR=1
"RTN","FBPAY",54,0)
 Q
"RTN","FBPAY",55,0)
WMSG ;write message if no matches found
"RTN","FBPAY",56,0)
 S FBPG=FBPG+1 W:$G(FBCRT) @IOF W !
"RTN","FBPAY",57,0)
 W !?25,$S($G(FBSORT):"VETERAN",1:"VENDOR")," PAYMENT HISTORY"
"RTN","FBPAY",58,0)
 I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY",59,0)
 W !?24,$E(FBDASH,1,24),?71,"Page: ",FBPG
"RTN","FBPAY",60,0)
 I FBSORT W !,"Patient: ",FBNAME,?41,"Patient ID:",FBID
"RTN","FBPAY",61,0)
 I 'FBSORT W !,"Vendor: ",FBNAME,?41,"Vendor ID:",FBID
"RTN","FBPAY",62,0)
 ;W !?(IOM-12/2),"FEE PROGRAM:"
"RTN","FBPAY",63,0)
 W !?3,"('*' Reimb. to Patient   '+' Cancel. Activity   '#' Voided Payment)"
"RTN","FBPAY",64,0)
 W !!!,FBDASH
"RTN","FBPAY",65,0)
 W !!,"There are no payments on file for "_$S(FBSORT:"Veteran",1:"Vendor")_" ",FBNAME,!?3,"for specified date range: ",$$DATX^FBAAUTL(FBBDATE)," through ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPAY",66,0)
 I 'FBPROG D
"RTN","FBPAY",67,0)
 .W !?3,"and selected Fee Program(s):"
"RTN","FBPAY",68,0)
 .S FBPI=0 F  S FBPI=$O(FBPROG(FBPI)) Q:'FBPI  W !?30,FBPROG(FBPI)
"RTN","FBPAY",69,0)
 I FBPROG W !?3,"and ALL Fee programs"
"RTN","FBPAY",70,0)
 W ".",*7,!!
"RTN","FBPAY",71,0)
 Q
"RTN","FBPAY",72,0)
OTH ;other fee basis programs
"RTN","FBPAY",73,0)
 I '$D(^TMP($J,"FB",FBPI_"O")) Q
"RTN","FBPAY",74,0)
 S FBZ=FBPI,FBPI=FBPI_"O",FBPROG(FBPI)="**OUTPATIENT** "_FBXPROG
"RTN","FBPAY",75,0)
 D PRINT^FBPAY21
"RTN","FBPAY",76,0)
 K FBPROG(FBPI) S FBPI=FBZ K FBZ
"RTN","FBPAY",77,0)
 Q
"RTN","FBPAY21")
0^10^B16167791^B16002202
"RTN","FBPAY21",1,0)
FBPAY21 ;AISC/CMR-OUTPATIENT PAYMENT HISTORY SORT/PRINT ;21/NOV/2006
"RTN","FBPAY21",2,0)
 ;;3.5;FEE BASIS;**4,32,69,101**;JAN 30, 1995;Build 2
"RTN","FBPAY21",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPAY21",4,0)
PRINT ;write output
"RTN","FBPAY21",5,0)
 S FBOUT=0 D:FBCRT&(FBPG) CR Q:FBOUT
"RTN","FBPAY21",6,0)
 D HDR I FBSORT S FBPAT=FBPNAME I $D(^TMP($J,"FBTR")) S FBTRCK=1 D TRAV^FBPAY671
"RTN","FBPAY21",7,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FBSORT SH Q:FBOUT  S FBPT="" D  Q:FBOUT
"RTN","FBPAY21",8,0)
 .F  S FBPT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT)) Q:FBPT']""!(FBOUT)  D:'FBSORT SH,SH1 Q:FBOUT  S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT)) Q:'FBDT!(FBOUT)  D
"RTN","FBPAY21",9,0)
 ..S L=0 F  S L=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L)) Q:'L!(FBOUT)  S M=0 F  S M=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,M)) Q:'M!(FBOUT)  D
"RTN","FBPAY21",10,0)
 ...I ($Y+6)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY21",11,0)
 ...S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,M)
"RTN","FBPAY21",12,0)
 ...S FBCKIN=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,M,"FBCK")) D EFBCK(FBCKIN)
"RTN","FBPAY21",13,0)
 ...S FBADJ=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,M,"FBADJ"))
"RTN","FBPAY21",14,0)
 ...W !,$S($G(FBCAN)]"":"+",1:"")
"RTN","FBPAY21",15,0)
 ...W ?1,$P(FBDATA,U,1)
"RTN","FBPAY21",16,0)
 ...W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPAY21",17,0)
 ...W ?22,$P(FBADJ,U,9)
"RTN","FBPAY21",18,0)
 ...W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPAY21",19,0)
 ...W ?43,$P(FBDATA,U,6)
"RTN","FBPAY21",20,0)
 ...W ?54,$P(FBDATA,U,7)
"RTN","FBPAY21",21,0)
 ...W ?64,$P(FBDATA,U,8)
"RTN","FBPAY21",22,0)
 ...I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPAY21",23,0)
 ....N FBI,FBMOD
"RTN","FBPAY21",24,0)
 ....F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPAY21",25,0)
 .....I $Y+7>IOSL D PAGE Q:FBOUT  W !,"  (continued)"
"RTN","FBPAY21",26,0)
 .....W !?16,"-",FBMOD
"RTN","FBPAY21",27,0)
 ...W !,$P(FBDATA,U,3)
"RTN","FBPAY21",28,0)
 ...W ?13,$P(FBDATA,U,4)
"RTN","FBPAY21",29,0)
 ...W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPAY21",30,0)
 ...W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPAY21",31,0)
 ...W ?48,$P(FBADJ,U,5)
"RTN","FBPAY21",32,0)
 ...W ?60,$P(FBADJ,U,6)
"RTN","FBPAY21",33,0)
 ...I $P(FBADJ,U,7)]"" W !?5,"FPPS Claim ID: ",$P(FBADJ,U,7),"     FPPS Line Item: ",$P(FBADJ,U,8)
"RTN","FBPAY21",34,0)
 ...S A2=$$EXTRL^FBMRASVR($P(FBDATA,U,4))
"RTN","FBPAY21",35,0)
 ...W !?4,"Primary Dx: ",$P(FBDATA,U,10),?40,"S/C Condition? ",$P(FBDATA,U,9) W ?63,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPAY21",36,0)
 ...D PMNT^FBAACCB2 K A2
"RTN","FBPAY21",37,0)
 Q
"RTN","FBPAY21",38,0)
HDR ;main header
"RTN","FBPAY21",39,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPAY21",40,0)
 S FBPG=FBPG+1
"RTN","FBPAY21",41,0)
 W !?25,$S($G(FBSORT):"VETERAN",1:"VENDOR")," PAYMENT HISTORY"
"RTN","FBPAY21",42,0)
 I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY21",43,0)
 W !?24,$E(FBDASH,1,24),?71,"Page: ",FBPG,!
"RTN","FBPAY21",44,0)
 W:FBSORT "Patient: ",FBPNAME,?41,"Patient ID: ",FBPID W:'FBSORT "Vendor: ",FBVNAME,?41,"Vendor ID: ",FBVID
"RTN","FBPAY21",45,0)
 ;W ?71,"Page: ",FBPG
"RTN","FBPAY21",46,0)
 W !?(IOM-(13+$L(FBPROG(+FBPI)))/2),"FEE PROGRAM: ",FBPROG(+FBPI)
"RTN","FBPAY21",47,0)
 W !,?3,"('*' Reimb. to Patient   '+' Cancel. Activity   '#' Voided Payment)"
"RTN","FBPAY21",48,0)
 W !,?3,"(paid symbol: 'R' RBRVS  'F' 75th percentile  'C' contract  'M' Mill Bill"
"RTN","FBPAY21",49,0)
 W !,?3,"              'U' U&C)"
"RTN","FBPAY21",50,0)
 W !,?1,"Svc Date",?11,"CPT-MOD ",?21,"Rev Code",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPAY21",51,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPAY21",52,0)
 Q
"RTN","FBPAY21",53,0)
SH ;subheader - vendor if fbsort; patient if 'fbsort, prints when name changed
"RTN","FBPAY21",54,0)
 I ($Y+8)>IOSL D:FBCRT CR Q:FBOUT  D HDR
"RTN","FBPAY21",55,0)
 I FBSORT W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPAY21",56,0)
 I 'FBSORT W !!,"Patient: ",$P(FBPT,";"),?41,"Patient ID: ",$$SSNL4^FBAAUTL($$SSN^FBAAUTL($P(FBPT,";",2)))
"RTN","FBPAY21",57,0)
 Q
"RTN","FBPAY21",58,0)
SH1 S FBPAT=$P(FBPT,";") I $D(^TMP($J,"FBTR",FBPAT)) S FBTRCK=1 D TRAV^FBPAY671
"RTN","FBPAY21",59,0)
 Q
"RTN","FBPAY21",60,0)
CR ;read for display
"RTN","FBPAY21",61,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPAY21",62,0)
 Q
"RTN","FBPAY21",63,0)
PAGE ;new page
"RTN","FBPAY21",64,0)
 I FBCRT D CR Q:FBOUT
"RTN","FBPAY21",65,0)
 D HDR,SH
"RTN","FBPAY21",66,0)
 Q
"RTN","FBPAY21",67,0)
EFBCK(FBCKIN) ;extract check information from ^TMP
"RTN","FBPAY21",68,0)
 I $G(FBCKIN)']"" S (FBCK,FBCKDT,FBCANDT,FBCANR,FBCAN,FBDIS,FBCKINT)="" Q
"RTN","FBPAY21",69,0)
 S U="^",FBCK=$P(FBCKIN,U,2),FBCKDT=$P(FBCKIN,U,3),FBCANDT=$P(FBCKIN,U,4),FBCANR=$P(FBCKIN,U,5),FBCAN=$P(FBCKIN,U,6),FBDIS=$P(FBCKIN,U,7),FBCKINT=$P(FBCKIN,U,8)
"RTN","FBPAY21",70,0)
 K FBCKIN
"RTN","FBPAY21",71,0)
 Q
"RTN","FBPAY21",72,0)
 ;
"RTN","FBPAY21",73,0)
EN ;entry from fbpay67 to set '*' if ancillary payment is
"RTN","FBPAY21",74,0)
 ;a reimbursement.  returns FBRP=to '*' or " "
"RTN","FBPAY21",75,0)
 ;'Y' passed in equal to zero node of 162.03 look at $P(Y,U,20)
"RTN","FBPAY21",76,0)
 ;
"RTN","FBPAY21",77,0)
 S FBR=$P($G(Y),U,20),FBR=$S(FBR="R":"*",1:" ")
"RTN","FBPAY21",78,0)
 Q
"RTN","FBPAY3")
0^11^B36415963^B36156876
"RTN","FBPAY3",1,0)
FBPAY3 ;AISC/GRR,TET-PHARMACY PAYMENT HISTORY, SORT/PRINT ;21/NOV/2006
"RTN","FBPAY3",2,0)
 ;;3.5;FEE BASIS;**12,32,69,101**;JAN 30, 1995;Build 2
"RTN","FBPAY3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPAY3",4,0)
EN ;entry point
"RTN","FBPAY3",5,0)
 I FBSORT S FBPNAME=FBNAME,FBPID=FBID,(DFN,J)=FBIEN,FBDOB=$$FMTE^XLFDT($P($G(^DPT(DFN,0)),U,3)) D SORT
"RTN","FBPAY3",6,0)
 I 'FBSORT S FBVNAME=$E(FBNAME,1,23),FBVID=FBID,FBVI=FBIEN,FBVCHAIN=$P($G(^FBAAV(FBVI,0)),U,10),FBDA1=0 D
"RTN","FBPAY3",7,0)
 .F  S FBDA1=$O(^FBAA(162.1,"AN",FBVI,FBDA1)) Q:'FBDA1  S J=0 F  S J=$O(^FBAA(162.1,FBDA1,"RX","C",J)) Q:'J  S DFN=J D VET,SORT
"RTN","FBPAY3",8,0)
FBAAC ;check if anything in an xref, fbaac global (file 162)
"RTN","FBPAY3",9,0)
 I '$D(^TMP($J,"FB",FBPI)),$D(^FBAAC("AN",FBPI)) D:'FBSORT AN^FBPAY67
"RTN","FBPAY3",10,0)
KILL ;kill variables set in sort
"RTN","FBPAY3",11,0)
 K A1,A2,FBAC,FBAP,FBBATCH,FBDA1,FBDRUG,FBFD,FBFD1,FBINVN,FBLOC,FBPAT,FBPD,FBPV,FBQTY,FBREIM,FBRX,FBSTR,FBSUSP,FBVEN,FBVI,I,J,K,L,N,V,Y
"RTN","FBPAY3",12,0)
 K FBADJLA,FBADJLR,FBFPPSC,FBFPPSL,TAMT,FBRRMKL
"RTN","FBPAY3",13,0)
 K:FBSORT FBVNAME,FBVID,FBVCHAIN K:'FBSORT FBPNAME,FBPID,FBDOB
"RTN","FBPAY3",14,0)
 D KILL^FBPAY2
"RTN","FBPAY3",15,0)
 Q
"RTN","FBPAY3",16,0)
SORT ;
"RTN","FBPAY3",17,0)
 S I=FBBEG F  S I=$O(^FBAA(162.1,"AD",J,I)) Q:I'>0!(I>FBEND)  S K=0 F  S K=$O(^FBAA(162.1,"AD",J,I,K)) Q:K'>0  S L=0 F  S L=$O(^FBAA(162.1,"AD",J,I,K,L)) Q:L'>0  D SET
"RTN","FBPAY3",18,0)
 Q
"RTN","FBPAY3",19,0)
 ;
"RTN","FBPAY3",20,0)
SET ;
"RTN","FBPAY3",21,0)
 N FBX
"RTN","FBPAY3",22,0)
 S Y(0)=$G(^FBAA(162.1,+K,"RX",+L,0)) I Y(0)']""!($P(Y(0),U,9)=1) Q
"RTN","FBPAY3",23,0)
 I $G(^FBAA(162.1,+K,"RX",+L,"FBREJ"))]"" Q  ;Eliminates Rejected Payments
"RTN","FBPAY3",24,0)
 I 'FBSORT Q:FBVI'=$P($G(^FBAA(162.1,+K,0)),"^",4)
"RTN","FBPAY3",25,0)
 S Y(2)=$G(^FBAA(162.1,+K,0))
"RTN","FBPAY3",26,0)
 S Y(1)=$G(^FBAA(162.1,+K,"RX",+L,2))
"RTN","FBPAY3",27,0)
 S FBFPPSC=$P($G(^FBAA(162.1,+K,0)),U,13) ;FPPS claim ID
"RTN","FBPAY3",28,0)
 S FBFPPSL=$P($G(^FBAA(162.1,+K,"RX",+L,3)),U) ;FPPS line item
"RTN","FBPAY3",29,0)
 S FBX=$$ADJLRA^FBRXFA(+L_","_+K_",")
"RTN","FBPAY3",30,0)
 S FBADJLR=$P(FBX,U) ;adjustment code
"RTN","FBPAY3",31,0)
 S FBADJLA=$P(FBX,U,2) ;adjustment amount
"RTN","FBPAY3",32,0)
 S TAMT=$FN($P(Y(0),"^",7),"",2) ;suspend amount
"RTN","FBPAY3",33,0)
 S FBRRMKL=$$RRL^FBRXFR(+L_","_+K_",") ;remitt remarks
"RTN","FBPAY3",34,0)
 ; if user wants just mill bill or just non-mill bill then check payment
"RTN","FBPAY3",35,0)
 ;   and skip if associated with an mill bill claim
"RTN","FBPAY3",36,0)
 I "^M^N^"[(U_$G(FB1725R)_U) S FB1725=$S($P(Y(1),U,6)["FB583":+$P($G(^FB583(+$P(Y(1),U,6),0)),U,28),1:0) I $S(FB1725R="M"&'FB1725:1,FB1725R="N"&FB1725:1,1:0) Q
"RTN","FBPAY3",37,0)
 S FBINVN=$P(Y(2),U) D VEN:FBSORT,VET:'FBSORT
"RTN","FBPAY3",38,0)
 S FBRX=$P(Y(0),U,1),FBDRUG=$P(Y(0),U,2),FBFD=$P(Y(0),U,3),FBAC=$P(Y(0),U,4),FBAP=$P(Y(0),U,16),FBSUSP=$P(Y(0),U,8),FBPD=$P(Y(0),U,19),FBBATCH=$P(Y(0),U,17),FBBATCH=$P($G(^FBAA(161.7,+FBBATCH,0)),U)
"RTN","FBPAY3",39,0)
 I FBSUSP]"" S FBSUSP=$P($G(^FBAA(161.27,+FBSUSP,0)),U)
"RTN","FBPAY3",40,0)
 S FBREIM=$S($P(Y(0),U,20)="R":"*",1:""),FBSTR=$P(Y(0),U,12),FBQTY=$P(Y(0),U,13),A1=$J(FBAC,6,2),A2=$J(FBAP,6,2),FBPV=""
"RTN","FBPAY3",41,0)
 S FBPD=$$DATX^FBAAUTL(FBPD),FBFD=$$DATX^FBAAUTL(FBFD)
"RTN","FBPAY3",42,0)
 S FBPV=$S($P(Y(1),U,3)="V":"#",1:""),FBFD1=$S(FBPV="":" ",1:FBPV)_$S(FBREIM="":" ",1:FBREIM)_FBFD,FBRX="Rx: "_FBRX
"RTN","FBPAY3",43,0)
 S FBVEN=FBVNAME_";"_FBVID,FBPAT=FBPNAME_";"_DFN
"RTN","FBPAY3",44,0)
 D FBCKP^FBAACCB1(K,L)
"RTN","FBPAY3",45,0)
 S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,I,L)=FBFD1_U_FBRX_U_FBDRUG_U_FBSTR_U_FBQTY_U_A1_U_A2_U_FBSUSP_U_FBINVN_U_FBBATCH_U_FBPD_U_FBDOB_U_FBVCHAIN_U_TAMT
"RTN","FBPAY3",46,0)
 S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,I,L,"FBADJ")=FBADJLR_U_FBADJLA_U_FBRRMKL_U_FBFPPSC_U_FBFPPSL
"RTN","FBPAY3",47,0)
 S ^TMP($J,"FB",FBPI,FBVEN,FBPAT,I,L,"FBCK")="^"_FBCK_"^"_FBCKDT_"^"_FBCANDT_"^"_FBCANR_"^"_FBCAN_"^"_FBDIS_"^"_FBCKINT D PMTCLN^FBAACCB2
"RTN","FBPAY3",48,0)
 S ^TMP($J,"FB",FBPI,FBVEN)=FBVCHAIN,^TMP($J,"FB",FBPI,FBVEN,FBPAT)=FBDOB
"RTN","FBPAY3",49,0)
 I FBSORT S FBIN(5)=$P(Y(1),U,6) I FBIN(5)]"",$D(^TMP($J,"FB",FBPI,FBVEN,FBPAT,I,L)) D ANC^FBPAY67(I,L)
"RTN","FBPAY3",50,0)
 I 'FBSORT D OTH^FBPAY67
"RTN","FBPAY3",51,0)
 Q
"RTN","FBPAY3",52,0)
VET ;set variables for veteran - 'FBSORT
"RTN","FBPAY3",53,0)
 S FBPID=$$SSN^FBAAUTL(DFN),N=$G(^DPT(+DFN,0)),FBPNAME=$P(N,U),FBDOB=$$FMTE^XLFDT($P(N,U,3))
"RTN","FBPAY3",54,0)
 Q
"RTN","FBPAY3",55,0)
VEN ;set variables for vendor - FBSORT
"RTN","FBPAY3",56,0)
 S V=$G(^FBAAV(+$P(Y(2),U,4),0)),FBVNAME=$E($P(V,U),1,23),FBVID=$P(V,U,2),FBVCHAIN=$P(V,U,10)
"RTN","FBPAY3",57,0)
 Q
"RTN","FBPAY3",58,0)
PRINT ;write output
"RTN","FBPAY3",59,0)
 S FBOUT=0 D:FBCRT&(FBPG) CR Q:FBOUT
"RTN","FBPAY3",60,0)
 D HDR
"RTN","FBPAY3",61,0)
 S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FBSORT SH Q:FBOUT  S FBPT="" D  Q:FBOUT
"RTN","FBPAY3",62,0)
 .F  S FBPT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT)) Q:FBPT']""!(FBOUT)  D:'FBSORT SH Q:FBOUT  S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT)) Q:'FBDT!(FBOUT)  S L=0 F  S L=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L)) Q:'L!(FBOUT)  D  Q:FBOUT
"RTN","FBPAY3",63,0)
 ..I ($Y+8)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY3",64,0)
 ..S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L),FBCKIN=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,"FBCK")) D EFBCK^FBPAY21(FBCKIN)
"RTN","FBPAY3",65,0)
 ..S FBADJ=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,"FBADJ")
"RTN","FBPAY3",66,0)
 ..; S FBLOC="0^2^15^45^63^4^12^20^24^35^53"
"RTN","FBPAY3",67,0)
 ..W !,$P(FBDATA,U),?64,$P(FBDATA,U,11),!
"RTN","FBPAY3",68,0)
 ..W ?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?45,$P(FBDATA,U,4),?63,$P(FBDATA,U,5)
"RTN","FBPAY3",69,0)
 ..;F I=2:1:$L(FBLOC,"^") W ?$P(FBLOC,U,I),$P(FBDATA,U,I) W:$P(FBLOC,U,I)=63 !
"RTN","FBPAY3",70,0)
 ..W !?4,$P(FBDATA,U,6),?12,$P(FBDATA,U,7)
"RTN","FBPAY3",71,0)
 ..W ?20 I $P(FBADJ,U,1)]"" W $P(FBADJ,U,1),?30,$J($P(FBADJ,U,2),14)
"RTN","FBPAY3",72,0)
 ..I $P(FBADJ,U,1)="" W $P(FBDATA,U,8),?30,$J($P(FBDATA,U,14),14)
"RTN","FBPAY3",73,0)
 ..W ?47,$P(FBDATA,U,9),?58,$P(FBDATA,U,10),?66,$P(FBADJ,U,3)
"RTN","FBPAY3",74,0)
 ..I $P(FBADJ,U,4)]"" W !?5,"FPPS Claim ID: ",$P(FBADJ,U,4),"     FPPS Line Item: ",$P(FBADJ,U,5)
"RTN","FBPAY3",75,0)
 ..S A2=$$EXTRL^FBMRASVR($P(FBDATA,"^",7)) D PMNT^FBAACCB2 K A2
"RTN","FBPAY3",76,0)
 ..I +$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,L,"A",0)) D PANC^FBPAY671(L) Q:FBOUT  W !,FBDASH1
"RTN","FBPAY3",77,0)
 ..W !
"RTN","FBPAY3",78,0)
EXIT ;kill and quit
"RTN","FBPAY3",79,0)
 Q
"RTN","FBPAY3",80,0)
HDR ;main header
"RTN","FBPAY3",81,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPAY3",82,0)
 S FBPG=FBPG+1
"RTN","FBPAY3",83,0)
 W !?25,$S($G(FBSORT):"VETERAN",1:"VENDOR")," PAYMENT HISTORY"
"RTN","FBPAY3",84,0)
 I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY3",85,0)
 W !?24,$E(FBDASH,1,24),?71,"Page: ",FBPG,!
"RTN","FBPAY3",86,0)
 W:FBSORT "Patient: ",FBPNAME,?41,"Pat. ID: ",FBPID,?62,"DOB: ",FBDOB W:'FBSORT "Vendor: ",FBVNAME,?41,"Vendor ID: ",FBVID,?65,"Chain #: ",FBVCHAIN
"RTN","FBPAY3",87,0)
 W !?(IOM-(13+$L(FBPROG(+FBPI)))/2),"FEE PROGRAM: ",FBPROG(+FBPI)
"RTN","FBPAY3",88,0)
 ;W ?71,"Page: ",FBPG
"RTN","FBPAY3",89,0)
 W !?3,"('*' Reimb. to Patient  '+' Cancel. Activity  '#' Voided Payment)"
"RTN","FBPAY3",90,0)
 W !?4,"Fill Date",?64,"Date Certified"
"RTN","FBPAY3",91,0)
 W !,?15,"Drug Name",?44,"Strength",?60,"Quantity"
"RTN","FBPAY3",92,0)
 W !?2,"Claimed",?12,"Paid",?20,"Adj Code",?33,"Adj Amounts",?47,"Invoice #",?58,"Batch #",?66,"Remit Remarks",!,FBDASH
"RTN","FBPAY3",93,0)
 Q
"RTN","FBPAY3",94,0)
SH ;subheader - vendor if fbsort; patient if  'fbsort, prints when name changes
"RTN","FBPAY3",95,0)
 I ($Y+10)>IOSL D:FBCRT CR Q:FBOUT  D HDR
"RTN","FBPAY3",96,0)
 I FBSORT W !!,"Vendor:",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2),?65,"Chain #: ",$P($G(^TMP($J,"FB",FBPI,FBVI)),U)
"RTN","FBPAY3",97,0)
 I 'FBSORT W !!,"Patient: ",$P(FBPT,";"),?41,"Pat. ID: ",$$SSNL4^FBAAUTL($$SSN^FBAAUTL($P(FBPT,";",2))),?62,"DOB: ",$P($G(^TMP($J,"FB",FBPI,FBVI,FBPT)),U)
"RTN","FBPAY3",98,0)
 Q
"RTN","FBPAY3",99,0)
CR ;read for display
"RTN","FBPAY3",100,0)
 S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPAY3",101,0)
 Q
"RTN","FBPAY3",102,0)
PAGE ;new page
"RTN","FBPAY3",103,0)
 I FBCRT D CR Q:FBOUT
"RTN","FBPAY3",104,0)
 D HDR,SH
"RTN","FBPAY3",105,0)
 Q
"RTN","FBPAY671")
0^12^B36548177^B36348688
"RTN","FBPAY671",1,0)
FBPAY671 ;AISC/DMK,TET-CH/CNH PAYMENT HISTORY PRINT ;21/NOV/2006
"RTN","FBPAY671",2,0)
 ;;3.5;FEE BASIS;**4,32,55,69,101**;JAN 30, 1995;Build 2
"RTN","FBPAY671",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBPAY671",4,0)
PRINT ;print data from tmp global
"RTN","FBPAY671",5,0)
 S FBOUT=0 D:FBCRT&(FBPG) CR Q:FBOUT
"RTN","FBPAY671",6,0)
 S FBHEAD=$S(FBSORT:"VETERAN",1:"VENDOR")
"RTN","FBPAY671",7,0)
EN1 N FBI,FBINV ;entry point from fbchdi
"RTN","FBPAY671",8,0)
 D HDR S FBVI="" F  S FBVI=$O(^TMP($J,"FB",FBPI,FBVI)) Q:FBVI']""!(FBOUT)  D:FBSORT SH Q:FBOUT  S FBPT="" F  S FBPT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT)) Q:FBPT']""!(FBOUT)  D  Q:FBOUT  D CKANC Q:FBOUT
"RTN","FBPAY671",9,0)
 .D:'FBSORT SH Q:FBOUT  S FBDT=0 F  S FBDT=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT)) Q:'FBDT!(FBOUT)  S FBI=0 F  S FBI=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI)) Q:'FBI!(FBOUT)  D  Q:FBOUT
"RTN","FBPAY671",10,0)
 ..I ($Y+5)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY671",11,0)
 ..S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI),A2=$$EXTRL^FBMRASVR($P(FBDATA,U,3))
"RTN","FBPAY671",12,0)
 ..S FBINV=^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBINV")
"RTN","FBPAY671",13,0)
 ..W ! W:$P(FBDATA,U,8)["R" "*" W:$P(FBDATA,U,9)]"" "#"
"RTN","FBPAY671",14,0)
 ..W ?2,$P(FBDATA,U,1),?15,$P(FBDATA,U,5),?31,$P(FBDATA,U,6)
"RTN","FBPAY671",15,0)
 ..W ?47,$P(FBDATA,U,7),?57,$P(FBINV,U,2)
"RTN","FBPAY671",16,0)
 ..W !?2,$P(FBDATA,U,2),?15,$P(FBDATA,U,3),?25,$P(FBINV,U,1)
"RTN","FBPAY671",17,0)
 .. ;Print adj reasons, if null then print suspend code
"RTN","FBPAY671",18,0)
 ..W ?36,$S($P(FBINV,U,5)]"":$P(FBINV,U,5),1:$P(FBDATA,U,4))
"RTN","FBPAY671",19,0)
 ..W ?46,$S($P(FBINV,U,5)]"":$J($P(FBINV,U,6),14),1:$J($P(FBDATA,U,10),14))
"RTN","FBPAY671",20,0)
 ..W ?63,$P(FBINV,U,7)
"RTN","FBPAY671",21,0)
 .. ;If FPPS Claim ID exists then print it.
"RTN","FBPAY671",22,0)
 ..I $P(FBINV,U,3)]"" D
"RTN","FBPAY671",23,0)
 ...W !?5,"FPPS Claim ID: ",$P(FBINV,U,3),"    FPPS Line Item: ",$P(FBINV,U,4)
"RTN","FBPAY671",24,0)
 ..F FBY="DX","PROC" I $D(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,FBY)) S FBDATA=^(FBY),FBSL=$L(FBDATA,"^") W !?2,FBY,": " F I=1:1:FBSL W $P(FBDATA,U,I),"    "
"RTN","FBPAY671",25,0)
 ..I $D(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBCK")) D EFBCK^FBPAY21(^TMP($J,"FB",FBPI,FBVI,FBPT,FBDT,FBI,"FBCK")) D PMNT^FBAACCB2 K A2
"RTN","FBPAY671",26,0)
 Q
"RTN","FBPAY671",27,0)
CKANC I +$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",0)) D PANC(FBI) Q:FBOUT  W !,FBDASH1
"RTN","FBPAY671",28,0)
 Q
"RTN","FBPAY671",29,0)
PANC(FBI) ;print anc data - FBI = unique number; called by fbpay3
"RTN","FBPAY671",30,0)
 S (FBOV,FBK)=0,FBSL=8,FBLOC=1_U_12_U_23_U_33_U_43_U_56_U_62_U_71 D SHA Q:FBOUT
"RTN","FBPAY671",31,0)
 F  S FBK=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK)) Q:'FBK!(FBOUT)  S FBL=0 F  S FBL=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL)) Q:'FBL!(FBOUT)  S FBM=0 F  S FBM=$O(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM)) Q:'FBM!(FBOUT)  D
"RTN","FBPAY671",32,0)
 .S FBDATA=^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM)
"RTN","FBPAY671",33,0)
 .S FBV=$P(FBDATA,U,12)_";"_$P(FBDATA,U,13)
"RTN","FBPAY671",34,0)
 .D WRT
"RTN","FBPAY671",35,0)
 K FBK,FBL,FBM Q
"RTN","FBPAY671",36,0)
WRT ;write ancillary info
"RTN","FBPAY671",37,0)
 I ($Y+6)>IOSL D PAGE Q:FBOUT  D SHA Q:FBOUT  D SHA2 Q:FBOUT
"RTN","FBPAY671",38,0)
 D:FBOV'=FBV SHA2
"RTN","FBPAY671",39,0)
 S FBCKIN=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM,"FBCK")) D EFBCK^FBPAY21(FBCKIN)
"RTN","FBPAY671",40,0)
 S FBADJ=$G(^TMP($J,"FB",FBPI,FBVI,FBPT,"A",FBK,FBL,FBM,"FBADJ"))
"RTN","FBPAY671",41,0)
 W ! W:$G(FBCAN)]"" "+"
"RTN","FBPAY671",42,0)
 W ?1,$P(FBDATA,U,1)
"RTN","FBPAY671",43,0)
 W ?11,$P($P(FBDATA,U,2),",")
"RTN","FBPAY671",44,0)
 W ?22,$P(FBADJ,U,9)
"RTN","FBPAY671",45,0)
 W ?31,$J($P(FBADJ,U,2),10)
"RTN","FBPAY671",46,0)
 W ?43,$P(FBDATA,U,6)
"RTN","FBPAY671",47,0)
 W ?54,$P(FBDATA,U,7)
"RTN","FBPAY671",48,0)
 W ?64,$P(FBDATA,U,8)
"RTN","FBPAY671",49,0)
 I $P($P(FBDATA,U,2),",",2)]"" D  Q:FBOUT
"RTN","FBPAY671",50,0)
 . N FBI,FBMOD
"RTN","FBPAY671",51,0)
 . F FBI=2:1 S FBMOD=$P($P(FBDATA,U,2),",",FBI) Q:FBMOD=""  D  Q:FBOUT
"RTN","FBPAY671",52,0)
 . . I $Y+7>IOSL D PAGE Q:FBOUT  D SHA Q:FBOUT  D SHA2 Q:FBOUT  W !,"  (continued)"
"RTN","FBPAY671",53,0)
 . . W !?16,"-",FBMOD
"RTN","FBPAY671",54,0)
 W !,$P(FBDATA,U,3)
"RTN","FBPAY671",55,0)
 W ?13,$P(FBDATA,U,4)
"RTN","FBPAY671",56,0)
 W ?23,$S($P(FBADJ,U,3)]"":$P(FBADJ,U,3),1:$P(FBDATA,U,5))
"RTN","FBPAY671",57,0)
 W ?33,$J($S($P(FBADJ,U,4)]"":$J($P(FBADJ,U,4),14),1:$P(FBADJ,U,1)),14)
"RTN","FBPAY671",58,0)
 W ?48,$P(FBADJ,U,5)
"RTN","FBPAY671",59,0)
 W ?60,$P(FBADJ,U,6)
"RTN","FBPAY671",60,0)
 ;If FPPS Claim ID exists then print it.
"RTN","FBPAY671",61,0)
 I $P(FBADJ,U,7)]"" D
"RTN","FBPAY671",62,0)
 .W !?5,"FPPS Claim ID: ",$P(FBADJ,U,7),"    FPPS Line Item: ",$P(FBADJ,U,8)
"RTN","FBPAY671",63,0)
 W !?4,"Primary Dx: ",$P(FBDATA,U,10),?40,"S/C Condition? ",$P(FBDATA,U,9),?66,"Obl.#: ",$P(FBDATA,U,11)
"RTN","FBPAY671",64,0)
 N A2 S A2=$$EXTRL^FBMRASVR($P(FBDATA,U,4))
"RTN","FBPAY671",65,0)
 D PMNT^FBAACCB2
"RTN","FBPAY671",66,0)
 Q
"RTN","FBPAY671",67,0)
HDR ;main header
"RTN","FBPAY671",68,0)
 I FBPG>0!FBCRT W @IOF
"RTN","FBPAY671",69,0)
 S FBPG=FBPG+1
"RTN","FBPAY671",70,0)
 I $D(FBHEAD) D
"RTN","FBPAY671",71,0)
 .W !?25,FBHEAD_" PAYMENT HISTORY"
"RTN","FBPAY671",72,0)
 .I $G(FB1725R)]"",FB1725R'="A" W " ",$S(FB1725R="M":"for 38 U.S.C. 1725 Claims",1:"excluding 38 U.S.C. 1725 Claims")
"RTN","FBPAY671",73,0)
 .W !,?24,$E(FBDASH,1,24),?71,"Page: ",FBPG,!?48,"Date Range: ",$$DATX^FBAAUTL(FBBDATE)," to ",$$DATX^FBAAUTL(FBEDATE)
"RTN","FBPAY671",74,0)
 I '$D(FBHEAD) W !?30,"INVOICE DISPLAY",!?29,$E(FBDASH,1,17),!
"RTN","FBPAY671",75,0)
 W ! W:FBSORT "Patient: ",FBPNAME,?41,"Patient ID: ",FBPID W:'FBSORT "Vendor: ",FBVNAME,?41,"Vendor ID: ",FBVID
"RTN","FBPAY671",76,0)
 W !?(IOM-(13+$L(FBPROG(+FBPI)))/2),"FEE PROGRAM: ",FBPROG(+FBPI)
"RTN","FBPAY671",77,0)
 W !?3,"('*' Reimb. to Patient  '+' Cancel. Activity  '#' Voided Payment)"
"RTN","FBPAY671",78,0)
 W !,?3,"(paid symbol: 'R' RBRVS  'F' 75th percentile  'C' contract  'M' Mill Bill"
"RTN","FBPAY671",79,0)
 W !,?3,"              'U' U&C)"
"RTN","FBPAY671",80,0)
 W !?1,"Invoice Date",?15,"Invoice No.",?31,"From Date",?48,"To Date",?57,"Patient Control #"
"RTN","FBPAY671",81,0)
 W !?1,"Amt Claimed",?15,"Amt Paid",?25,"Cov Days",?36,"Adj Codes",?49,"Adj Amounts",?63,"Remit Remarks",!,FBDASH
"RTN","FBPAY671",82,0)
 Q
"RTN","FBPAY671",83,0)
SH ;subheader - vendor if fbsort; patient if 'fbsort, prints when name changed
"RTN","FBPAY671",84,0)
 I ($Y+7)>IOSL D:FBCRT CR Q:FBOUT  D HDR
"RTN","FBPAY671",85,0)
 I FBSORT W !!,"Vendor: ",$P(FBVI,";"),?41,"Vendor ID: ",$P(FBVI,";",2)
"RTN","FBPAY671",86,0)
 I 'FBSORT W !!,"Patient: ",$P(FBPT,";"),?41,"Patient ID: ",$$SSNL4^FBAAUTL($$SSN^FBAAUTL($P(FBPT,";",2)))
"RTN","FBPAY671",87,0)
 Q
"RTN","FBPAY671",88,0)
SHA ;ancillary subheader
"RTN","FBPAY671",89,0)
 I ($Y+14)>IOSL D PAGE Q:FBOUT
"RTN","FBPAY671",90,0)
 W !?20,">>> ANCILLARY SERVICE PAYMENTS <<<",!
"RTN","FBPAY671",91,0)
SHA1 ;subheader for ancillary data
"RTN","FBPAY671",92,0)
 W !,?1,"Svc Date",?11,"CPT-MOD ",?21,"Rev Code",?31,"Units Paid",?43,"Batch No.",?54,"Inv No.",?64,"Voucher Date"
"RTN","FBPAY671",93,0)
 W !,"Amt Claimed",?13,"Amt Paid",?23,"Adj Code",?36,"Adj Amounts",?48,"Remit Remark",?61,"Patient Account No",!,FBDASH
"RTN","FBPAY671",94,0)
 Q
"RTN","FBPAY671",95,0)
SHA2 ;subheader for vendor name
"RTN","FBPAY671",96,0)
 I ($Y+5)>IOSL D:FBCRT CR Q:FBOUT  D HDR,SH,SHA
"RTN","FBPAY671",97,0)
 I FBOV'=FBV S FBOV=FBV
"RTN","FBPAY671",98,0)
 W !!,"Vendor: ",$P(FBV,";"),?41,"Vendor ID: ",$P(FBV,";",2)
"RTN","FBPAY671",99,0)
 Q
"RTN","FBPAY671",100,0)
CR ;read for display
"RTN","FBPAY671",101,0)
 Q:'FBPG  S DIR(0)="E" W ! D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) FBOUT=1
"RTN","FBPAY671",102,0)
 Q
"RTN","FBPAY671",103,0)
PAGE ;new page
"RTN","FBPAY671",104,0)
 I FBCRT D CR Q:FBOUT
"RTN","FBPAY671",105,0)
 D HDR,SH
"RTN","FBPAY671",106,0)
 Q
"RTN","FBPAY671",107,0)
WRTDX I $P(FBDX,"^",K)]"" W ?4,"Dx: ",$$ICD9^FBCSV1($P(FBDX,"^",K)),"  " Q
"RTN","FBPAY671",108,0)
 Q
"RTN","FBPAY671",109,0)
WRTPC I $P(FBPROC,"^",L)]"" W ?4,"Proc: ",$$ICD0^FBCSV1($P(FBPROC,"^",L)),"   " Q
"RTN","FBPAY671",110,0)
 Q
"RTN","FBPAY671",111,0)
WRTSC ;write service connected
"RTN","FBPAY671",112,0)
 W !,"SERVICE CONNECTED? ",$S(+VAEL(3):"YES",1:"NO"),!
"RTN","FBPAY671",113,0)
 Q
"RTN","FBPAY671",114,0)
TRAV ;write out travel payments, (FBPAT,FBSORT) must be defined
"RTN","FBPAY671",115,0)
 S FBTRDT=0
"RTN","FBPAY671",116,0)
 F  S FBTRDT=$O(^TMP($J,"FBTR",FBPAT,FBTRDT)) Q:'FBTRDT  S FBTRX=0 F  S FBTRX=$O(^TMP($J,"FBTR",FBPAT,FBTRDT,FBTRX)) Q:'FBTRX  S FBCKIN=^(FBTRX),A2=$P(FBCKIN,"^") D TRCK Q:FBOUT  W:$G(FBTRCK) !,?5,"TRAVEL PAYMENTS: " D  K FBTRCK
"RTN","FBPAY671",117,0)
 .W ?22,$$DATX^FBAAUTL(FBTRDT),?35,A2
"RTN","FBPAY671",118,0)
 .S A2=$$EXTRL^FBMRASVR(A2) D EFBCK^FBPAY21(FBCKIN),PMNT^FBAACCB2
"RTN","FBPAY671",119,0)
 .K A2 W ! Q
"RTN","FBPAY671",120,0)
 Q
"RTN","FBPAY671",121,0)
TRCK I ($Y+5)>IOSL D:FBCRT CR Q:FBOUT  D HDR^FBPAY21
"RTN","FBPAY671",122,0)
 Q
"RTN","FBUCLET1")
0^13^B48699559^B48288041
"RTN","FBUCLET1",1,0)
FBUCLET1 ;ALBISC/TET - UNAUTHORIZED CLAIM LETTER (continued) ;29/NOV/2006
"RTN","FBUCLET1",2,0)
 ;;3.5;FEE BASIS;**12,23,32,38,101**;JAN 30, 1995;Build 2
"RTN","FBUCLET1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","FBUCLET1",4,0)
PRINT ;print letter, don't update if variable fbnoup exists
"RTN","FBUCLET1",5,0)
 ;INPUT:  FBDA = ien of unauthorized claim, file 162.7
"RTN","FBUCLET1",6,0)
 ;        FBORDER = (optional) order number of status
"RTN","FBUCLET1",7,0)
 ;        FBUCA = current (after) zero node of unauthorized claim (162.7)
"RTN","FBUCLET1",8,0)
 ;        FBUC = unauthorized claim node in parameter file
"RTN","FBUCLET1",9,0)
 ;        FBNOUP = 1 if no update is to occur, optional, set in reprint
"RTN","FBUCLET1",10,0)
 ;        FBFF = counter flag, suppresses formfeed if = 0
"RTN","FBUCLET1",11,0)
 ;        FBCOPIES = # of copies to print, optional, not set from auto
"RTN","FBUCLET1",12,0)
 ;        FBSTANUM = station number
"RTN","FBUCLET1",13,0)
 ;        FBSADD( array = station address, if site parameter designates letterhead not used
"RTN","FBUCLET1",14,0)
 ;VAR     FBADD( = address array to where letter is mailed
"RTN","FBUCLET1",15,0)
 ;        FBADDCC( = address array for carbon copy
"RTN","FBUCLET1",16,0)
 ;        FBCC = flag, true if CC address should print at bottom of page
"RTN","FBUCLET1",17,0)
 ;        FBCCI = # used to determine where CC address prints
"RTN","FBUCLET1",18,0)
 ;        FBTAMT = $ amount calculated in routine FBUCLET2 for an
"RTN","FBUCLET1",19,0)
 ;                 approved or approved to stabilization disposition
"RTN","FBUCLET1",20,0)
 ;                 letter. Used to populate field #14 in file #162.7.
"RTN","FBUCLET1",21,0)
 ;OUTPUT: none - print letter and update fields, if '$d(fbnoup), upon completion
"RTN","FBUCLET1",22,0)
 N FBADD,FBADDCC,FBAUTH,FBC,FBEP,FBLETDT,FBLIEN,FBMCODE,FBNAM,FBNAM1
"RTN","FBUCLET1",23,0)
 N FBPROG,FBRE,FBSUBMIT,FBTAMT,FBCC,FBCCI
"RTN","FBUCLET1",24,0)
 S FBLETDT=0 S:FBORDER']"" FBORDER=$$ORDER^FBUCUTL(FBDA) S ZTSTOP=$$S^%ZTLOAD
"RTN","FBUCLET1",25,0)
 D ADDRESS^FBUCUTL2(FBUCA)
"RTN","FBUCLET1",26,0)
 S FBSUBMIT=$P(FBUCA,U,23),FBPROG=$$PROG^FBUCUTL(+$P(FBUCA,U,2))
"RTN","FBUCLET1",27,0)
 S FBNAM=$S(FBSUBMIT["FBAAV("!(FBSUBMIT["VA(200,"):$$VET^FBUCUTL(+$P(FBUCA,U,4)),1:$$VEN^FBUCUTL(+$P(FBUCA,U,3))) I FBNAM["," S FBNAM=$P(FBNAM,",",2)_" "_$P(FBNAM,",")
"RTN","FBUCLET1",28,0)
 I FBSUBMIT'["DPT(" S FBNAM1=$$VEN^FBUCUTL(+$P(FBUCA,U,3)) I FBNAM1["," S FBNAM1=$P(FBNAM1,",",2)_" "_$P(FBNAM1,",")
"RTN","FBUCLET1",29,0)
 ;
"RTN","FBUCLET1",30,0)
 ; Utilize new API for Name Standardization
"RTN","FBUCLET1",31,0)
 ;
"RTN","FBUCLET1",32,0)
 I FBNAM'="UNKNOWN",FBSUBMIT["FBAAV("!(FBSUBMIT["VA(200,") D
"RTN","FBUCLET1",33,0)
 .S FBNAM=$$GETNAME(+$P(FBUCA,U,4),2,"G","")
"RTN","FBUCLET1",34,0)
 .Q
"RTN","FBUCLET1",35,0)
 ;
"RTN","FBUCLET1",36,0)
 S FBRE=$S(FBSUBMIT']""!(FBSUBMIT["DPT("):"VENDOR:",1:"VETERAN:")
"RTN","FBUCLET1",37,0)
 S FBEP=$$FMTE^XLFDT(+$P(FBUCA,U,5)) S:$P(FBUCA,U,6)'=$P(FBUCA,U,5) FBEP=FBEP_"^"_$$FMTE^XLFDT(+$P(FBUCA,U,6))
"RTN","FBUCLET1",38,0)
 S FBAUTH=$$FMTE^XLFDT(+$P(FBUCA,U,13)) S:$P(FBUCA,U,14)'=$P(FBUCA,U,13) FBAUTH=FBAUTH_"^"_$$FMTE^XLFDT(+$P(FBUCA,U,14))
"RTN","FBUCLET1",39,0)
 S FBLIEN=$$LETTER^FBUCUTL2(FBORDER,+$P(FBUCA,U,28))
"RTN","FBUCLET1",40,0)
 S FBMCODE=$$GET1^DIQ(161.4,1,5.5) ; Load Mail Code
"RTN","FBUCLET1",41,0)
 I '$D(FBCOPIES) S FBCOPIES=$S($P(FBUC,U,4):$P(FBUC,U,4),1:1)
"RTN","FBUCLET1",42,0)
 I FBLIEN F FBC=1:1:FBCOPIES D
"RTN","FBUCLET1",43,0)
 .N DIWF,DIWL,FBEXP,FBI,FBDL1
"RTN","FBUCLET1",44,0)
 .;set flag true when disposition letter to indicate that a CC address
"RTN","FBUCLET1",45,0)
 .;needs to be printed at the bottom of the first page
"RTN","FBUCLET1",46,0)
 .S FBCC=$S(FBORDER>20:1,1:0)
"RTN","FBUCLET1",47,0)
 .;set FBCCI = blank lines before address (2) + max address lines (5) +
"RTN","FBUCLET1",48,0)
 .; # of lines after address from site parameters + a constant (2)
"RTN","FBUCLET1",49,0)
 .;S FBCCI=2+5+$S($P(FBUC,U,10)]"":$P(FBUC,U,10),1:9)+2 ; default param
"RTN","FBUCLET1",50,0)
 .S FBCCI=2+5+$P(FBUC,U,10)+2
"RTN","FBUCLET1",51,0)
 .S FBFF=FBFF+1 W:FBFF&(FBFF>1) @IOF W !
"RTN","FBUCLET1",52,0)
 .W:$P(FBUC,U,8) !!!!! D:'$P(FBUC,U,8)
"RTN","FBUCLET1",53,0)
 ..N FBI,FBX,FBCT S (FBCT,FBI)=0 F  S FBI=$O(FBSADD(FBI)) Q:'FBI  S FBX=FBSADD(FBI) W !?(IOM-$L(FBX)/2),FBX S FBCT=FBCT+1
"RTN","FBUCLET1",54,0)
 ..S FBCT=5-FBCT I FBCT>0 F FBI=1:1:FBCT W ! ;ensure length of header is consistant
"RTN","FBUCLET1",55,0)
 .W !?4,$$PDATE^FBUCUTL2(DT),!
"RTN","FBUCLET1",56,0)
 .W:'$P(FBUC,U,8) ?47,"In Reply Refer To: " W ?66,FBSTANUM,"/",FBMCODE
"RTN","FBUCLET1",57,0)
 .W !?50,$$GETNAME(+$P(FBUCA,U,4),2,"F","C")
"RTN","FBUCLET1",58,0)
 .S (FBCT,FBI)=0 F  S FBI=$O(FBADD(FBI)) Q:'FBI  W !?4,FBADD(FBI) S FBCT=FBCT+1 I FBI=1 W ?50,$$SSNL4^FBAAUTL($$SSN^FBAAUTL(+$P(FBUCA,U,4)))
"RTN","FBUCLET1",59,0)
 .D HED
"RTN","FBUCLET1",60,0)
 .S DIWF="WC79I4",DIWL=1 D:$Y+$S(FBCCI>10&FBCC:FBCCI,1:10)>IOSL PAGE D TXT^FBUCUTL2("^FBAA(161.3,",FBLIEN,1,DIWF,DIWL,1,.FBCC,FBCCI) W !
"RTN","FBUCLET1",61,0)
 .S DIWF="WC72I8",DIWL=1
"RTN","FBUCLET1",62,0)
 .I FBORDER>20 D:$Y+$S(FBCCI>10&FBCC:FBCCI,1:10)>IOSL PAGE D TXT^FBUCUTL2("^FB(162.91,",+$P(FBUCA,U,11),$S(+$P(FBUCA,U,28):2,1:1),DIWF,DIWL,1,.FBCC,FBCCI) D
"RTN","FBUCLET1",63,0)
 ..; if approved (or approved to stabilization) then include details
"RTN","FBUCLET1",64,0)
 ..I $P(FBUCA,U,11)=1!($P(FBUCA,U,11)=4) D AUTHPR^FBUCLET2
"RTN","FBUCLET1",65,0)
 ..I +$P(FBUCA,U,11)'=1,+$O(^FB583(FBDA,"D",0)) D:$Y+$S(FBCCI>10&FBCC:FBCCI,1:10)>IOSL PAGE W !?8,"Reason(s) for not approving "_$S($P(FBUCA,U,11)=4:"entire ",1:"")_"claim:" D
"RTN","FBUCLET1",66,0)
 ...N DIWF,FBI,FBZ S DIWF="WC69I8",FBI=0 F  S FBI=$O(^FB583(FBDA,"D",FBI)) Q:'FBI  S FBZ=^(FBI,0) D:$Y+$S(FBCCI>8&FBCC:FBCCI,1:8)>IOSL PAGE W ! D TXT^FBUCUTL2("^FB(162.94,",+FBZ,1,DIWF,DIWL,1,.FBCC,FBCCI)
"RTN","FBUCLET1",67,0)
 ..;
"RTN","FBUCLET1",68,0)
 ..;print optional disposition remarks for the claim
"RTN","FBUCLET1",69,0)
 ..I FBORDER>20 D
"RTN","FBUCLET1",70,0)
 ...N DIWF,DIWL,FBN
"RTN","FBUCLET1",71,0)
 ...; select appropriate wp field based on status (appeal, cova, initial)
"RTN","FBUCLET1",72,0)
 ...S FBN=$S(FBORDER=70:"""A1""",FBORDER=90:"""A2""",1:4)
"RTN","FBUCLET1",73,0)
 ...Q:'$O(^FB583(FBDA,FBN,0))  ; no remarks on file
"RTN","FBUCLET1",74,0)
 ...D:$Y+$S(FBCCI>7&FBCC:FBCCI,1:7)>IOSL PAGE
"RTN","FBUCLET1",75,0)
 ...W !
"RTN","FBUCLET1",76,0)
 ...S DIWF="WC72I8",DIWL=1
"RTN","FBUCLET1",77,0)
 ...D TXT^FBUCUTL2("^FB583(",FBDA,FBN,DIWF,DIWL,1,.FBCC,FBCCI)
"RTN","FBUCLET1",78,0)
 ..;
"RTN","FBUCLET1",79,0)
 ..;print additional description text (if any) for disposition
"RTN","FBUCLET1",80,0)
 ..I $O(^FB(162.91,+$P(FBUCA,U,11),3,0)) D
"RTN","FBUCLET1",81,0)
 ...N DIWF,DIWL
"RTN","FBUCLET1",82,0)
 ...D:$Y+$S(FBCCI>10&FBCC:FBCCI,1:10)>IOSL PAGE
"RTN","FBUCLET1",83,0)
 ...W !
"RTN","FBUCLET1",84,0)
 ...S DIWF="WC72I8",DIWL=1
"RTN","FBUCLET1",85,0)
 ...D TXT^FBUCUTL2("^FB(162.91,",+$P(FBUCA,U,11),3,DIWF,DIWL,1,.FBCC,FBCCI)
"RTN","FBUCLET1",86,0)
 .I FBORDER'>20 S FBI=0 F  S FBI=$O(^FBAA(162.8,"AC",FBDA,FBI)) Q:'FBI  S FBZ=$G(^FBAA(162.8,FBI,0)) I '$P(FBZ,U,5) D:$Y+$S(FBCCI>12&FBCC:FBCCI,1:12)>IOSL PAGE D
"RTN","FBUCLET1",87,0)
 ..N FBX W ! S FBX=$P($G(^FB(162.93,+$P(FBZ,U,3),0)),U) I FBX="OTHER" S:$P(FBZ,U,4)]"" FBX=$P(FBZ,U,4) W ?8,FBX,! Q
"RTN","FBUCLET1",88,0)
 ..D TXT^FBUCUTL2("^FB(162.93,",+$P(FBZ,U,3),1,DIWF,DIWL,1,.FBCC,FBCCI)
"RTN","FBUCLET1",89,0)
 .S DIWF="WC79I4",DIWL=1 D:($Y+4+$S(FBCCI>$S(FBORDER>20:15,1:22)&FBCC:FBCCI,FBORDER>20:15,1:22))>IOSL PAGE W ! D TXT^FBUCUTL2("^FBAA(161.3,",FBLIEN,2,DIWF,DIWL,1,.FBCC,FBCCI)
"RTN","FBUCLET1",90,0)
 .;print postscript (if any) on request info. letter
"RTN","FBUCLET1",91,0)
 .I FBORDER'>20 S FBI=0 F  S FBI=$O(^FBAA(162.8,"AC",FBDA,FBI)) Q:'FBI  S FBZ=$G(^FBAA(162.8,FBI,0)) I '$P(FBZ,U,5) D
"RTN","FBUCLET1",92,0)
 ..N FBX,FBPS
"RTN","FBUCLET1",93,0)
 ..Q:'$O(^FB(162.93,+$P(FBZ,U,3),2,0))  ; no postscript to print
"RTN","FBUCLET1",94,0)
 ..;start new page
"RTN","FBUCLET1",95,0)
 ..S FBPS=1 D PAGE S FBPS=0
"RTN","FBUCLET1",96,0)
 ..W !!
"RTN","FBUCLET1",97,0)
 ..;print text
"RTN","FBUCLET1",98,0)
 ..S FBX=$P($G(^FB(162.93,+$P(FBZ,U,3),0)),U)
"RTN","FBUCLET1",99,0)
 ..I FBX="SIGNED STATEMENT FROM CLAIMANT",$P(FBZ,U,4)]"",$E($P(FBZ,U,4),1)=0 D
"RTN","FBUCLET1",100,0)
 ...; just print statement since user specified that regulations should
"RTN","FBUCLET1",101,0)
 ...; not be printed (stop after line 11 of postscript)
"RTN","FBUCLET1",102,0)
 ...N FBI,FBTXT
"RTN","FBUCLET1",103,0)
 ...S FBI=0 F  S FBI=$O(^FB(162.93,+$P(FBZ,U,3),2,FBI)) Q:FBI>11!'FBI  D
"RTN","FBUCLET1",104,0)
 ....S FBTXT=^FB(162.93,+$P(FBZ,U,3),2,FBI,0),X=FBTXT
"RTN","FBUCLET1",105,0)
 ....I $Y+$S(FBCCI>7&FBCC:FBCCI,1:7)>IOSL D PAGE
"RTN","FBUCLET1",106,0)
 ....D ^DIWP
"RTN","FBUCLET1",107,0)
 ...I $Y+$S(FBCCI>7&FBCC:FBCCI,1:7)>IOSL D PAGE
"RTN","FBUCLET1",108,0)
 ...D:$D(FBTXT) ^DIWW
"RTN","FBUCLET1",109,0)
 ..E  D TXT^FBUCUTL2("^FB(162.93,",+$P(FBZ,U,3),2,DIWF,DIWL,1,.FBCC,FBCCI) ;entire ps
"RTN","FBUCLET1",110,0)
 .;if still on 1st page of disposition letter then print the CC address
"RTN","FBUCLET1",111,0)
 .I FBCC D CCADDR
"RTN","FBUCLET1",112,0)
 ;
"RTN","FBUCLET1",113,0)
 I '$D(FBNOUP) D
"RTN","FBUCLET1",114,0)
 .D:$D(XRTL) T0^%ZOSV ;start monitor
"RTN","FBUCLET1",115,0)
 .S FBEXP=$$EXPIRE^FBUCUTL8(FBDA,DT,FBUCA,FBORDER)
"RTN","FBUCLET1",116,0)
 .D EDITL^FBUCED(FBDA,FBEXP,"@",DT,$G(FBTAMT))
"RTN","FBUCLET1",117,0)
 .S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ;stop monitor
"RTN","FBUCLET1",118,0)
 Q
"RTN","FBUCLET1",119,0)
 ;
"RTN","FBUCLET1",120,0)
GETNAME(FBIEN,FBFILE,FBFMT,FBFLAG) ;
"RTN","FBUCLET1",121,0)
 N FBNAMES
"RTN","FBUCLET1",122,0)
 I FBIEN=""!(FBFILE)="" Q ""  ; Quit if there is no IEN or File number
"RTN","FBUCLET1",123,0)
 S FBFMT=$G(FBFMT),FBFLAG=$G(FBFLAG)
"RTN","FBUCLET1",124,0)
 S FBNAMES("FILE")=FBFILE,FBNAMES("IENS")=FBIEN,FBNAMES("FIELD")=.01
"RTN","FBUCLET1",125,0)
 S FBNAMES=$$NAMEFMT^XLFNAME(.FBNAMES,FBFMT,FBFLAG)
"RTN","FBUCLET1",126,0)
 Q FBNAMES
"RTN","FBUCLET1",127,0)
 ;
"RTN","FBUCLET1",128,0)
PAGE ;new page
"RTN","FBUCLET1",129,0)
 ;print CC address at bottom of 1st page on disposition letters
"RTN","FBUCLET1",130,0)
 I FBCC D CCADDR
"RTN","FBUCLET1",131,0)
 W @IOF,!!!!!!!
"RTN","FBUCLET1",132,0)
 ; if called from 1st page of postscript print then include more info
"RTN","FBUCLET1",133,0)
 I $G(FBPS)=1 D
"RTN","FBUCLET1",134,0)
 .W:'$P(FBUC,U,8) ?47,"In Reply Refer To: " W ?66,FBSTANUM,"/",FBMCODE
"RTN","FBUCLET1",135,0)
 .W !?50,$$GETNAME(+$P(FBUCA,U,4),2,"F","C")
"RTN","FBUCLET1",136,0)
 .W !?50,$$SSNL4^FBAAUTL($$SSN^FBAAUTL(+$P(FBUCA,U,4)))
"RTN","FBUCLET1",137,0)
HED ;header to print after address and on each new page
"RTN","FBUCLET1",138,0)
 W !!!!?8,"REGARDING:",?20,FBRE,?38,FBNAM I $D(FBNAM1) W !?20,"VENDOR:",?38,FBNAM1
"RTN","FBUCLET1",139,0)
 W !?20,"FEE PROGRAM:",?38,FBPROG
"RTN","FBUCLET1",140,0)
 W !?20,"EPISODE OF CARE:",?38,$P(FBEP,U) W:$P(FBEP,U,2)]"" " to ",$P(FBEP,U,2)
"RTN","FBUCLET1",141,0)
 W !!
"RTN","FBUCLET1",142,0)
 Q
"RTN","FBUCLET1",143,0)
CCADDR ; print CC address at bottom of page
"RTN","FBUCLET1",144,0)
 ; advance to bottom of page
"RTN","FBUCLET1",145,0)
 N FBI
"RTN","FBUCLET1",146,0)
 F FBI=$Y+FBCCI-1:1:$S(IOSL>120:$Y+FBCCI,1:IOSL) W !
"RTN","FBUCLET1",147,0)
 ; print CC address lines
"RTN","FBUCLET1",148,0)
 S FBI=0
"RTN","FBUCLET1",149,0)
 F  S FBI=$O(FBADDCC(FBI)) Q:'FBI  W ! W:FBI=1 " CC:" W ?4,FBADDCC(FBI)
"RTN","FBUCLET1",150,0)
 ;set flag to false since CC address has been printed
"RTN","FBUCLET1",151,0)
 S FBCC=0
"RTN","FBUCLET1",152,0)
 Q
"VER")
8.0^22.0
"BLD",7029,6)
^92
**END**
**END**
