Released IB*2*272 SEQ #247
Extracted from mail message
**KIDS**:IB*2.0*272^

**INSTALL NAME**
IB*2.0*272
"BLD",5565,0)
IB*2.0*272^INTEGRATED BILLING^0^3040608^y
"BLD",5565,4,0)
^9.64PA^^
"BLD",5565,"ABPKG")
n
"BLD",5565,"KRN",0)
^9.67PA^8989.52^19
"BLD",5565,"KRN",.4,0)
.4
"BLD",5565,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5565,"KRN",.401,0)
.401
"BLD",5565,"KRN",.402,0)
.402
"BLD",5565,"KRN",.403,0)
.403
"BLD",5565,"KRN",.5,0)
.5
"BLD",5565,"KRN",.84,0)
.84
"BLD",5565,"KRN",3.6,0)
3.6
"BLD",5565,"KRN",3.8,0)
3.8
"BLD",5565,"KRN",9.2,0)
9.2
"BLD",5565,"KRN",9.8,0)
9.8
"BLD",5565,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5565,"KRN",9.8,"NM",1,0)
IBJDIPR^^0^B63713595
"BLD",5565,"KRN",9.8,"NM","B","IBJDIPR",1)

"BLD",5565,"KRN",19,0)
19
"BLD",5565,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",5565,"KRN",19,"NM",1,0)
IBJD PERCENT PREREGISTERED^^0
"BLD",5565,"KRN",19,"NM",2,0)
DGPRE PRE-REGISTER OUTPUTS^^2
"BLD",5565,"KRN",19,"NM",3,0)
IBJD INTAKE REPORTS^^2
"BLD",5565,"KRN",19,"NM","B","DGPRE PRE-REGISTER OUTPUTS",2)

"BLD",5565,"KRN",19,"NM","B","IBJD INTAKE REPORTS",3)

"BLD",5565,"KRN",19,"NM","B","IBJD PERCENT PREREGISTERED",1)

"BLD",5565,"KRN",19.1,0)
19.1
"BLD",5565,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5565,"KRN",101,0)
101
"BLD",5565,"KRN",101,"NM",0)
^9.68A^^
"BLD",5565,"KRN",409.61,0)
409.61
"BLD",5565,"KRN",771,0)
771
"BLD",5565,"KRN",870,0)
870
"BLD",5565,"KRN",8989.51,0)
8989.51
"BLD",5565,"KRN",8989.52,0)
8989.52
"BLD",5565,"KRN",8994,0)
8994
"BLD",5565,"KRN",8994,"NM",0)
^9.68A^^
"BLD",5565,"KRN","B",.4,.4)

"BLD",5565,"KRN","B",.401,.401)

"BLD",5565,"KRN","B",.402,.402)

"BLD",5565,"KRN","B",.403,.403)

"BLD",5565,"KRN","B",.5,.5)

"BLD",5565,"KRN","B",.84,.84)

"BLD",5565,"KRN","B",3.6,3.6)

"BLD",5565,"KRN","B",3.8,3.8)

"BLD",5565,"KRN","B",9.2,9.2)

"BLD",5565,"KRN","B",9.8,9.8)

"BLD",5565,"KRN","B",19,19)

"BLD",5565,"KRN","B",19.1,19.1)

"BLD",5565,"KRN","B",101,101)

"BLD",5565,"KRN","B",409.61,409.61)

"BLD",5565,"KRN","B",771,771)

"BLD",5565,"KRN","B",870,870)

"BLD",5565,"KRN","B",8989.51,8989.51)

"BLD",5565,"KRN","B",8989.52,8989.52)

"BLD",5565,"KRN","B",8994,8994)

"BLD",5565,"QUES",0)
^9.62^^
"BLD",5565,"REQB",0)
^9.611^^
"KRN",19,6450,-1)
2^2
"KRN",19,6450,0)
DGPRE PRE-REGISTER OUTPUTS^Outputs for Preregistration^^M^12537^^^^^^^
"KRN",19,6450,10,0)
^19.01IP^4^3
"KRN",19,6450,10,4,0)
12096
"KRN",19,6450,10,4,"^")
IBJD PERCENT PREREGISTERED
"KRN",19,6450,"U")
OUTPUTS FOR PREREGISTRATION
"KRN",19,6788,-1)
2^3
"KRN",19,6788,0)
IBJD INTAKE REPORTS^Intake Reports^^M^10865^^^^^^y^200
"KRN",19,6788,10,0)
^19.01IP^8^8
"KRN",19,6788,10,8,0)
12096^PR
"KRN",19,6788,10,8,"^")
IBJD PERCENT PREREGISTERED
"KRN",19,6788,"U")
INTAKE REPORTS
"KRN",19,12096,-1)
0^1
"KRN",19,12096,0)
IBJD PERCENT PREREGISTERED^Percentage of Patients Pre-Registered Report^^R^^^^^^^^INTEGRATED BILLING
"KRN",19,12096,1,0)
^19.06^5^5^3040521^^^
"KRN",19,12096,1,1,0)
This report provides number of patients treated, the number of
"KRN",19,12096,1,2,0)
patients pre-registered, % of patients pre-registered, number of
"KRN",19,12096,1,3,0)
patients pre-registered past the pre-registration time frame,
"KRN",19,12096,1,4,0)
number of patients never pre-registered, the clinic exclusions,
"KRN",19,12096,1,5,0)
and the eligibility exclusions.
"KRN",19,12096,25)
EN^IBJDIPR
"KRN",19,12096,"U")
PERCENTAGE OF PATIENTS PRE-REG
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^1^1
"PKG",200,20,1,0)
2^^IBAXDR
"PKG",200,20,1,1)

"PKG",200,20,"B",2,1)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
272^3040608
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBJDIPR")
0^1^B63713595
"RTN","IBJDIPR",1,0)
IBJDIPR ;ALB/HMC - PERCENTAGE OF PATIENTS PREREGISTERED REPORT ;10-MAY-2004
"RTN","IBJDIPR",2,0)
 ;;2.0;INTEGRATED BILLING;**272**;21-MAR-1994
"RTN","IBJDIPR",3,0)
 ;
"RTN","IBJDIPR",4,0)
EN ; - Option entry point.
"RTN","IBJDIPR",5,0)
 ;
"RTN","IBJDIPR",6,0)
 D ENQ1
"RTN","IBJDIPR",7,0)
 W !!,"This report provides number of patients treated, the number of"
"RTN","IBJDIPR",8,0)
 W !,"patients pre-registered, % of patients pre-registered, number of"
"RTN","IBJDIPR",9,0)
 W !,"patients pre-registered past the pre-registration time frame,"
"RTN","IBJDIPR",10,0)
 W !,"number of patients never pre-registered, the clinic exclusions,"
"RTN","IBJDIPR",11,0)
 W !,"and the eligibility exclusions.",!!
"RTN","IBJDIPR",12,0)
 ;
"RTN","IBJDIPR",13,0)
DATE D DATE^IBOUTL I IBBDT=""!(IBEDT="") G ENQ
"RTN","IBJDIPR",14,0)
 ;
"RTN","IBJDIPR",15,0)
 ;
"RTN","IBJDIPR",16,0)
TIME ;Pre-Registration time frame, default is 180 days
"RTN","IBJDIPR",17,0)
 ;
"RTN","IBJDIPR",18,0)
 S DIR(0)="N^^I X'>0 K X"
"RTN","IBJDIPR",19,0)
 S DIR("A")="Pre-Registration time frame (days)" W !
"RTN","IBJDIPR",20,0)
 S DIR("B")=180
"RTN","IBJDIPR",21,0)
 S DIR("?")="^D THLP^IBJDIPR"
"RTN","IBJDIPR",22,0)
 D ^DIR
"RTN","IBJDIPR",23,0)
 S IBPRF=Y
"RTN","IBJDIPR",24,0)
 I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) G ENQ
"RTN","IBJDIPR",25,0)
 ;
"RTN","IBJDIPR",26,0)
 K DIR,DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDIPR",27,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("?")="^D EHLP^IBJDIPR"
"RTN","IBJDIPR",28,0)
 S DIR("A")="Detailed list of Exclusions (Y/N)"
"RTN","IBJDIPR",29,0)
 D ^DIR
"RTN","IBJDIPR",30,0)
 S IBEXC=+Y
"RTN","IBJDIPR",31,0)
 I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) G ENQ
"RTN","IBJDIPR",32,0)
 K DIR,DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDIPR",33,0)
 ;
"RTN","IBJDIPR",34,0)
 W !!,"This report only requires an 80 column printer."
"RTN","IBJDIPR",35,0)
 W !!,"Note: This report may take a while to run."
"RTN","IBJDIPR",36,0)
 W !!,"You should queue this report to run after normal business hours.",!
"RTN","IBJDIPR",37,0)
 ;
"RTN","IBJDIPR",38,0)
 ; - Select a device.
"RTN","IBJDIPR",39,0)
 S %ZIS="QM" D ^%ZIS G:POP ENQ
"RTN","IBJDIPR",40,0)
 I $D(IO("Q")) D  G ENQ
"RTN","IBJDIPR",41,0)
 .S ZTRTN="DQ^IBJDIPR",ZTDESC="IB - PERCENTAGE OF PATIENTS PREREGISTERED"
"RTN","IBJDIPR",42,0)
 .S ZTSAVE("IB*")=""
"RTN","IBJDIPR",43,0)
 .D ^%ZTLOAD
"RTN","IBJDIPR",44,0)
 .W !!,$S($D(ZTSK):"This job has been queued. The task number is "_ZTSK_".",1:"Unable to queue this job.")
"RTN","IBJDIPR",45,0)
 .K ZTSK,IO("Q") D HOME^%ZIS
"RTN","IBJDIPR",46,0)
 ;
"RTN","IBJDIPR",47,0)
 U IO
"RTN","IBJDIPR",48,0)
 ;
"RTN","IBJDIPR",49,0)
DQ ; - Tasked entry point.
"RTN","IBJDIPR",50,0)
 ;
"RTN","IBJDIPR",51,0)
 N IBQUERY,IBQUERY1,DGNAM
"RTN","IBJDIPR",52,0)
 K IB,^TMP("IBJDIPR",$J),^TMP("IBJDIPR1",$J)
"RTN","IBJDIPR",53,0)
 ;
"RTN","IBJDIPR",54,0)
 ;Temporary global IBJDIPR contains outpatients found for date range in the outpatient encounter file"
"RTN","IBJDIPR",55,0)
 ;Temporary global IBJDIPR1 contains the clinic exclusions found in the MAS parameter file"
"RTN","IBJDIPR",56,0)
 ;
"RTN","IBJDIPR",57,0)
 S (IBQ,DGPREC,DGPREE)=0
"RTN","IBJDIPR",58,0)
 F I="TOT","PRE","PAST","NEVR" S IB(I)=0
"RTN","IBJDIPR",59,0)
 ;
"RTN","IBJDIPR",60,0)
 ;Build exclusion temporary file from MAS parameter file,
"RTN","IBJDIPR",61,0)
 ; ^DG(43 - dbia 4242
"RTN","IBJDIPR",62,0)
 ;
"RTN","IBJDIPR",63,0)
 ;Get clinic exclusions and clinic name from ^SC (Hospital location file)
"RTN","IBJDIPR",64,0)
 ;dbia 401
"RTN","IBJDIPR",65,0)
 S X="" F  S X=$O(^DG(43,1,"DGPREC","B",X)) Q:X=""  D
"RTN","IBJDIPR",66,0)
 . S DGNAM=$P($G(^SC(X,0)),U,1) I DGNAM="" Q
"RTN","IBJDIPR",67,0)
 . S ^TMP("IBJDIPR1",$J,"DGPREC",X)=""
"RTN","IBJDIPR",68,0)
 . S ^TMP("IBJDIPR1",$J,"DGPRECA",DGNAM_U_X)=X ;index sorted by name
"RTN","IBJDIPR",69,0)
 . S DGPREC=DGPREC+1
"RTN","IBJDIPR",70,0)
 ;
"RTN","IBJDIPR",71,0)
 ;Get eligibility exclusions and eligiblity name from ^DIC(8 dbia 427
"RTN","IBJDIPR",72,0)
 ;
"RTN","IBJDIPR",73,0)
 S X="" F  S X=$O(^DG(43,1,"DGPREE","B",X)) Q:X=""  D
"RTN","IBJDIPR",74,0)
 . S DGNAM=$P($G(^DIC(8,X,0)),U,1) I DGNAM="" Q
"RTN","IBJDIPR",75,0)
 . S ^TMP("IBJDIPR1",$J,"DGPREE",X)=""
"RTN","IBJDIPR",76,0)
 . S ^TMP("IBJDIPR1",$J,"DGPREEA",DGNAM_U_X)=X ;index sorted by name
"RTN","IBJDIPR",77,0)
 . S DGPREE=DGPREE+1
"RTN","IBJDIPR",78,0)
 ;
"RTN","IBJDIPR",79,0)
 ; - Find outpatients treated within the user-specified date range.
"RTN","IBJDIPR",80,0)
 D OUTPT("",IBBDT,IBEDT,"S:IBQ SDSTOP=1 I 'IBQ,$$ENCHK^IBJDI5(Y0) D ENC^IBJDIPR(Y0)","Percentage of Patients Preregistered",.IBQ,"IBJDIPR",.IBQUERY)
"RTN","IBJDIPR",81,0)
 D CLOSE^IBSDU(.IBQUERY),CLOSE^IBSDU(.IBQUERY1) I IBQ G ENQ
"RTN","IBJDIPR",82,0)
 ;
"RTN","IBJDIPR",83,0)
 ;Find pre-registrationed patients
"RTN","IBJDIPR",84,0)
 ;Use file 41.41 (^DGS), Pre-registration audit file
"RTN","IBJDIPR",85,0)
 ;dbia 4425
"RTN","IBJDIPR",86,0)
 ;
"RTN","IBJDIPR",87,0)
 S DFN=""
"RTN","IBJDIPR",88,0)
 F  S DFN=$O(^TMP("IBJDIPR",$J,DFN)) Q:DFN=""  D
"RTN","IBJDIPR",89,0)
 . S TRDAT=^TMP("IBJDIPR",$J,DFN) ;Get treatment date
"RTN","IBJDIPR",90,0)
 . S IB("TOT")=IB("TOT")+1 ;Total unique patients treated
"RTN","IBJDIPR",91,0)
 . S PRDAT=TRDAT+.0000001
"RTN","IBJDIPR",92,0)
 . S PRDAT=$O(^DGS(41.41,"ADC",DFN,PRDAT),-1) ;Most recent pre-reg date
"RTN","IBJDIPR",93,0)
 . I PRDAT="" S IB("NEVR")=IB("NEVR")+1 Q  ;never pre-registered
"RTN","IBJDIPR",94,0)
 . I PRDAT<$$FMADD^XLFDT(TRDAT,-IBPRF) S IB("PAST")=IB("PAST")+1 Q  ;past time frame
"RTN","IBJDIPR",95,0)
 . S IB("PRE")=IB("PRE")+1 ;pre-registered
"RTN","IBJDIPR",96,0)
 ;
"RTN","IBJDIPR",97,0)
 ; - Print the reports.
"RTN","IBJDIPR",98,0)
 S (IBQ,IBPAG)=0 D NOW^%DTC S IBRUN=$$DAT2^IBOUTL(%)
"RTN","IBJDIPR",99,0)
 I 'IBQ D SUM,PAUSE
"RTN","IBJDIPR",100,0)
ENQ K ^TMP("IBJDIPR",$J),^TMP("IBJDIPR1",$J)
"RTN","IBJDIPR",101,0)
 I $D(ZTQUEUED) S ZTREQ="@" G ENQ1
"RTN","IBJDIPR",102,0)
 ;
"RTN","IBJDIPR",103,0)
 D ^%ZISC
"RTN","IBJDIPR",104,0)
ENQ1 K IB,IBQ,IBBDT,IBEDT,IBD,IBPAG,IBRUN,IBOED,IBPRF
"RTN","IBJDIPR",105,0)
 K DFN,POP,I,X,X1,X2,Y,%,%ZIS,ZTDESC,ZTRTN,ZTSAVE,ZTREQ,ZTQUEUED
"RTN","IBJDIPR",106,0)
 K DIR,DIROUT,DTOUT,DUOUT,DIRUT
"RTN","IBJDIPR",107,0)
 K DGPREC,DGPREE,PRDAT,TRDAT,IBEXC,DGEE,DGEC,PCENT,TAB,DGNAM
"RTN","IBJDIPR",108,0)
 Q
"RTN","IBJDIPR",109,0)
 ;
"RTN","IBJDIPR",110,0)
OUTPT(DFN,IBBDT,IBEDT,IBCBK,IBMSG,IBQ,IBSUBSCR,IBQUERY,IBDIR) ;
"RTN","IBJDIPR",111,0)
 ; Input:   DFN = IEN of patient if using PATIENT/DATE index, otherwise,
"RTN","IBJDIPR",112,0)
 ;                if null or 0, DATE/TIME index will be used
"RTN","IBJDIPR",113,0)
 ;        IBCBK = The MUMPS code to execute when valid enctr found
"RTN","IBJDIPR",114,0)
 ;        IBBDT/IBEDT = The start/end dates
"RTN","IBJDIPR",115,0)
 ;        IBMSG = The text to send to STOP PROCESSING CALL (if null, no
"RTN","IBJDIPR",116,0)
 ;                call made)
"RTN","IBJDIPR",117,0)
 ;          IBQ = Flag that says whether or not the process was stopped
"RTN","IBJDIPR",118,0)
 ;                by user
"RTN","IBJDIPR",119,0)
 ;      IBQUERY = The # of the QUERY OBJECT to be used to extract outpt
"RTN","IBJDIPR",120,0)
 ;                visits
"RTN","IBJDIPR",121,0)
 ;        IBDIR = Null to look forward, 'B' to look backward thru file
"RTN","IBJDIPR",122,0)
 ;
"RTN","IBJDIPR",123,0)
 N IBVAL,IBFILTER
"RTN","IBJDIPR",124,0)
 S IBVAL("BDT")=IBBDT,IBVAL("EDT")=IBEDT_".99" S:$G(DFN) IBVAL("DFN")=DFN
"RTN","IBJDIPR",125,0)
 ;
"RTN","IBJDIPR",126,0)
 ; - Look at parent encounters, completely checked out, check user
"RTN","IBJDIPR",127,0)
 ;   requested to quit, process each pt only once if IBSUBSCR'=null
"RTN","IBJDIPR",128,0)
 S IBFILTER=""
"RTN","IBJDIPR",129,0)
 S IBCBK="I '$P(Y0,U,6),$P(Y0,U,7),$S((Y#100)'=0:1,$G(IBMSG)="""":1,1:'$$STOP^IBJDI21(.IBQ,IBMSG))"_" "_IBCBK
"RTN","IBJDIPR",130,0)
 S IBDIR=$S($G(IBDIR)="":"",1:"BACKWARD")
"RTN","IBJDIPR",131,0)
 ;
"RTN","IBJDIPR",132,0)
 ;ibsdu will use ^SD(409.1), Standard encounter query, to process
"RTN","IBJDIPR",133,0)
 ;file 409.68 (^SCE) - dbia402 for oupatient encounter data.
"RTN","IBJDIPR",134,0)
 ;
"RTN","IBJDIPR",135,0)
 D SCAN^IBSDU($S($G(DFN):"PATIENT/DATE",1:"DATE/TIME"),.IBVAL,IBFILTER,IBCBK,0,.IBQUERY,IBDIR) K ^TMP("DIERR",$J)
"RTN","IBJDIPR",136,0)
 Q
"RTN","IBJDIPR",137,0)
 ;
"RTN","IBJDIPR",138,0)
ENC(IBOED) ; - Encounter extract.
"RTN","IBJDIPR",139,0)
 ; Input:    IBOED = Data from outpatient encounter file, ^SCE.
"RTN","IBJDIPR",140,0)
 ;
"RTN","IBJDIPR",141,0)
 S DFN=+$P(IBOED,U,2) I 'DFN Q
"RTN","IBJDIPR",142,0)
 ;Check exclusions
"RTN","IBJDIPR",143,0)
 I $P(IBOED,U,4)]"",$D(^TMP("IBJDIPR1",$J,"DGPREC",$P(IBOED,U,4))) Q  ;Clinic exclusion
"RTN","IBJDIPR",144,0)
 I $P(IBOED,U,13)]"",$D(^TMP("IBJDIPR1",$J,"DGPREE",$P(IBOED,U,13))) Q  ;Eligibility exculsion
"RTN","IBJDIPR",145,0)
 D PROC(DFN,IBOED) ; Process patient.
"RTN","IBJDIPR",146,0)
 Q
"RTN","IBJDIPR",147,0)
 ;
"RTN","IBJDIPR",148,0)
PROC(DFN,IBOED) ; - Process each specific patient.
"RTN","IBJDIPR",149,0)
 ; Input:     DFN = Pointer to the patient in file #2
"RTN","IBJDIPR",150,0)
 ;          IBOED = Data from outpatient encounter file, ^SCE.
"RTN","IBJDIPR",151,0)
 ;
"RTN","IBJDIPR",152,0)
 ; Pre-set variables IB array, IBBDT, IBEDT are required.
"RTN","IBJDIPR",153,0)
 ;
"RTN","IBJDIPR",154,0)
 I $$TESTP^IBJDI1(DFN) Q  ;     Test patient.
"RTN","IBJDIPR",155,0)
 D ELIG^VADPT G:'VAEL(4) PRCQ ; Patient is not a vet.
"RTN","IBJDIPR",156,0)
 ;
"RTN","IBJDIPR",157,0)
 ; - Set patient index
"RTN","IBJDIPR",158,0)
 S ^TMP("IBJDIPR",$J,DFN)=$P(IBOED,U,1)
"RTN","IBJDIPR",159,0)
 ;
"RTN","IBJDIPR",160,0)
PRCQ K VA,VAERR,VAEL
"RTN","IBJDIPR",161,0)
 Q
"RTN","IBJDIPR",162,0)
 ;
"RTN","IBJDIPR",163,0)
SUM ; - Print the summary report.
"RTN","IBJDIPR",164,0)
 D HEAD Q:IBQ
"RTN","IBJDIPR",165,0)
 W !!?15,"Patients pre-registered from ",$$DAT1^IBOUTL(IBBDT)," - ",$$DAT1^IBOUTL(IBEDT)
"RTN","IBJDIPR",166,0)
 W !!?17,"Pre-registration time frame: ",$J(IBPRF,5)," days"
"RTN","IBJDIPR",167,0)
 W !!?24,"Run Date: ",IBRUN,!?10,$$DASH(55),!!
"RTN","IBJDIPR",168,0)
 ;
"RTN","IBJDIPR",169,0)
 W ?35,"*Number of Unique Patients Treated: ",$J(IB("TOT"),5)
"RTN","IBJDIPR",170,0)
 W !?1,"Unique Outpatients Pre-registered within pre-registration time frame: ",$J(IB("PRE"),5)
"RTN","IBJDIPR",171,0)
 S PCENT=0 I IB("TOT") S PCENT=(IB("PRE")/IB("TOT"))*100
"RTN","IBJDIPR",172,0)
 W !?47,"Percent Pre-registered: ",$J(PCENT,5,2),"%"
"RTN","IBJDIPR",173,0)
 W !!?3,"Unique Outpatients Pre-registered past pre-registration time frame: ",$J(IB("PAST"),5)
"RTN","IBJDIPR",174,0)
 W !?30,"Unique Outpatients never Pre-registered: ",$J(IB("NEVR"),5)
"RTN","IBJDIPR",175,0)
 W !!?8,"*Counts may not include all patients because of exclusions."
"RTN","IBJDIPR",176,0)
 W !!?37,"Number of Eligibility Exclusions: ",$J(DGPREE,5)
"RTN","IBJDIPR",177,0)
 W !!?42,"Number of Clinic Exclusions: ",$J(DGPREC,5)
"RTN","IBJDIPR",178,0)
 I 'IBEXC Q
"RTN","IBJDIPR",179,0)
 I DGPREE D
"RTN","IBJDIPR",180,0)
 .S DGEE=1
"RTN","IBJDIPR",181,0)
 .D PAUSE Q:IBQ  D HEAD Q:IBQ
"RTN","IBJDIPR",182,0)
 .S X="" F I=1:1 S X=$O(^TMP("IBJDIPR1",$J,"DGPREEA",X)) Q:X=""  D  Q:IBQ
"RTN","IBJDIPR",183,0)
 ..I $Y>(IOSL-4) D PAUSE Q:IBQ  D HEAD Q:IBQ
"RTN","IBJDIPR",184,0)
 ..S TAB=$S((I#2):10,1:45)
"RTN","IBJDIPR",185,0)
 ..W ?TAB,$E($P(X,U,1),1,30) W:'(I#2) !
"RTN","IBJDIPR",186,0)
 I DGPREC D
"RTN","IBJDIPR",187,0)
 .S DGEC=1,DGEE=0
"RTN","IBJDIPR",188,0)
 .S X="" F I=1:1 S X=$O(^TMP("IBJDIPR1",$J,"DGPRECA",X)) Q:X=""  D  Q:IBQ
"RTN","IBJDIPR",189,0)
 ..I I=1 D  Q:IBQ
"RTN","IBJDIPR",190,0)
 ...I ($Y+4)>(IOSL-4) D PAUSE Q:IBQ  D HEAD Q
"RTN","IBJDIPR",191,0)
 ...W !!?10,"Clinic Exclusions",!?9,$$DASH(19),!
"RTN","IBJDIPR",192,0)
 ..I $Y>(IOSL-4) D PAUSE Q:IBQ  D HEAD Q:IBQ
"RTN","IBJDIPR",193,0)
 ..S TAB=$S((I#2):10,1:45)
"RTN","IBJDIPR",194,0)
 ..W ?TAB,$E($P(X,U,1),1,30) W:'(I#2) !
"RTN","IBJDIPR",195,0)
 Q
"RTN","IBJDIPR",196,0)
 ;
"RTN","IBJDIPR",197,0)
HEAD ; - Report Header
"RTN","IBJDIPR",198,0)
 ;
"RTN","IBJDIPR",199,0)
 I $E(IOST,1,2)="C-"!(IBPAG) W @IOF,*13
"RTN","IBJDIPR",200,0)
 S IBPAG=IBPAG+1
"RTN","IBJDIPR",201,0)
 W !?21,"PERCENTAGE OF PATIENTS PRE-REGISTERED",?71,"Page: ",IBPAG
"RTN","IBJDIPR",202,0)
 I IBPAG=1 W !!?33,"SUMMARY REPORT" Q
"RTN","IBJDIPR",203,0)
 W !!?24,"Run Date: ",IBRUN,!?10,$$DASH(55),!!
"RTN","IBJDIPR",204,0)
 W !?10,"Listing of all Exclusions: ",!
"RTN","IBJDIPR",205,0)
 I $G(DGEE) W !!?10,"Eligibility Exclusions",!?9,$$DASH(24),!
"RTN","IBJDIPR",206,0)
 I $G(DGEC) W !!?10,"Clinic Exclusions",!?9,$$DASH(19),!
"RTN","IBJDIPR",207,0)
 S IBQ=$$STOP^IBOUTL("Percentage of Patients Preregistered")
"RTN","IBJDIPR",208,0)
 Q
"RTN","IBJDIPR",209,0)
 ;
"RTN","IBJDIPR",210,0)
DASH(X) ; - Return a dashed line.
"RTN","IBJDIPR",211,0)
 Q $TR($J("",X)," ","=")
"RTN","IBJDIPR",212,0)
 ;
"RTN","IBJDIPR",213,0)
PAUSE ; - Page break.
"RTN","IBJDIPR",214,0)
 I $E(IOST,1,2)'="C-" Q
"RTN","IBJDIPR",215,0)
 N DIR,DIRUT,DUOUT,DTOUT,DIROUT,X,Y
"RTN","IBJDIPR",216,0)
 S DIR(0)="E" D ^DIR I $D(DIRUT)!($D(DUOUT)) S IBQ=1
"RTN","IBJDIPR",217,0)
 Q
"RTN","IBJDIPR",218,0)
 ;
"RTN","IBJDIPR",219,0)
THLP ; - 'Pre-Registration time frame (days)' prompt
"RTN","IBJDIPR",220,0)
 ;
"RTN","IBJDIPR",221,0)
 W !!,"Number of days to search for pre-registered patients."
"RTN","IBJDIPR",222,0)
 W !,"Number of days must be greater that zero."
"RTN","IBJDIPR",223,0)
 W !,"Select '<CR>' to accept the default 180 days."
"RTN","IBJDIPR",224,0)
 W !?11,"'^' to quit."
"RTN","IBJDIPR",225,0)
 Q
"RTN","IBJDIPR",226,0)
 ;
"RTN","IBJDIPR",227,0)
EHLP ; - 'Detailed list of Exclusions' prompt
"RTN","IBJDIPR",228,0)
 ;
"RTN","IBJDIPR",229,0)
 W !!,"Select '<CR>' to print only the number of eligibility and clinic exclusions."
"RTN","IBJDIPR",230,0)
 W !!?11,"'Y' to print list of all elibibility and clinic exclusions."
"RTN","IBJDIPR",231,0)
 W !?11,"'^' to quit."
"RTN","IBJDIPR",232,0)
 Q
"VER")
8.0^22
**END**
**END**
