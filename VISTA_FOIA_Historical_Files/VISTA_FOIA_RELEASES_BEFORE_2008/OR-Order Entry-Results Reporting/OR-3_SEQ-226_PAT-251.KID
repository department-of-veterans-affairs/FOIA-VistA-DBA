Released OR*3*251 SEQ #226
Extracted from mail message
**KIDS**:OR*3.0*251^

**INSTALL NAME**
OR*3.0*251
"BLD",17653,0)
OR*3.0*251^ORDER ENTRY/RESULTS REPORTING^0^3060414^y
"BLD",17653,4,0)
^9.64PA^^
"BLD",17653,"KRN",0)
^9.67PA^8989.52^19
"BLD",17653,"KRN",.4,0)
.4
"BLD",17653,"KRN",.401,0)
.401
"BLD",17653,"KRN",.402,0)
.402
"BLD",17653,"KRN",.403,0)
.403
"BLD",17653,"KRN",.5,0)
.5
"BLD",17653,"KRN",.84,0)
.84
"BLD",17653,"KRN",3.6,0)
3.6
"BLD",17653,"KRN",3.8,0)
3.8
"BLD",17653,"KRN",9.2,0)
9.2
"BLD",17653,"KRN",9.8,0)
9.8
"BLD",17653,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",17653,"KRN",9.8,"NM",1,0)
ORWGAPIA^^0^B82316738
"BLD",17653,"KRN",9.8,"NM",2,0)
ORB3TIM2^^0^B38807562
"BLD",17653,"KRN",9.8,"NM",3,0)
ORQOR2^^0^B13837546
"BLD",17653,"KRN",9.8,"NM","B","ORB3TIM2",2)

"BLD",17653,"KRN",9.8,"NM","B","ORQOR2",3)

"BLD",17653,"KRN",9.8,"NM","B","ORWGAPIA",1)

"BLD",17653,"KRN",19,0)
19
"BLD",17653,"KRN",19.1,0)
19.1
"BLD",17653,"KRN",101,0)
101
"BLD",17653,"KRN",409.61,0)
409.61
"BLD",17653,"KRN",771,0)
771
"BLD",17653,"KRN",870,0)
870
"BLD",17653,"KRN",8989.51,0)
8989.51
"BLD",17653,"KRN",8989.52,0)
8989.52
"BLD",17653,"KRN",8994,0)
8994
"BLD",17653,"KRN","B",.4,.4)

"BLD",17653,"KRN","B",.401,.401)

"BLD",17653,"KRN","B",.402,.402)

"BLD",17653,"KRN","B",.403,.403)

"BLD",17653,"KRN","B",.5,.5)

"BLD",17653,"KRN","B",.84,.84)

"BLD",17653,"KRN","B",3.6,3.6)

"BLD",17653,"KRN","B",3.8,3.8)

"BLD",17653,"KRN","B",9.2,9.2)

"BLD",17653,"KRN","B",9.8,9.8)

"BLD",17653,"KRN","B",19,19)

"BLD",17653,"KRN","B",19.1,19.1)

"BLD",17653,"KRN","B",101,101)

"BLD",17653,"KRN","B",409.61,409.61)

"BLD",17653,"KRN","B",771,771)

"BLD",17653,"KRN","B",870,870)

"BLD",17653,"KRN","B",8989.51,8989.51)

"BLD",17653,"KRN","B",8989.52,8989.52)

"BLD",17653,"KRN","B",8994,8994)

"BLD",17653,"QUES",0)
^9.62^^
"BLD",17653,"REQB",0)
^9.611^1^1
"BLD",17653,"REQB",1,0)
OR*3.0*215^2
"BLD",17653,"REQB","B","OR*3.0*215",1)

"MBREQ")
0
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
251^3060414
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORB3TIM2")
0^2^B38807562^B30471606
"RTN","ORB3TIM2",1,0)
ORB3TIM2 ; slc/CLA - Routine to trigger time-related notifications ;3/30/01  07:41 [1/3/05 8:21am]
"RTN","ORB3TIM2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**102,215,251**;Dec 17, 1997
"RTN","ORB3TIM2",3,0)
 ;
"RTN","ORB3TIM2",4,0)
EXPIR ;trigger expiring order notifs
"RTN","ORB3TIM2",5,0)
 N EDT,EXDT,EXORN,ORBDNR,ORPT,ORBRSLT,RXORD,ORLASTDT,X,Y,%DT
"RTN","ORB3TIM2",6,0)
 N OIFILE,ORBY,ORBZ,ORBI,ORSCH,ORSCHFIL,ONETIME,ORST,ORNG,ORDT,ORDW,ORHOL
"RTN","ORB3TIM2",7,0)
 N EXOI,ORBLST,ORBERR,OITXT,PTLOC,ORSDT,ORNOW,ORLDT
"RTN","ORB3TIM2",8,0)
 ;
"RTN","ORB3TIM2",9,0)
 S ORNOW=$$NOW^XLFDT
"RTN","ORB3TIM2",10,0)
 ;
"RTN","ORB3TIM2",11,0)
 I '$D(^XTMP("ORB LAST EXPIRE")) D  ;holds last dt EXPIR processed
"RTN","ORB3TIM2",12,0)
 .S ^XTMP("ORB LAST EXPIRE",0)=$$FMADD^XLFDT(ORNOW,7,"","","")_U
"RTN","ORB3TIM2",13,0)
 ;
"RTN","ORB3TIM2",14,0)
 ;determine number of days to return orders using day of week & holidays
"RTN","ORB3TIM2",15,0)
 F ORNG=1:1 D  I ORHOL=0,ORDW=0 Q
"RTN","ORB3TIM2",16,0)
 .S ORDW=$S($H-4+ORNG#7>4:1,1:0)          ;if Sat or Sun, ORDW=0
"RTN","ORB3TIM2",17,0)
 .S ORDT=$$FMADD^XLFDT(DT,ORNG)
"RTN","ORB3TIM2",18,0)
 .K DIC S DIC="^HOLIDAY(",X=ORDT D ^DIC
"RTN","ORB3TIM2",19,0)
 .S ORHOL=$S(+$G(Y)>0:1,1:0)              ;if ORDT is a holiday, ORHOL=0
"RTN","ORB3TIM2",20,0)
 S %DT="",X="T+"_ORNG D ^%DT
"RTN","ORB3TIM2",21,0)
 S EDT=Y_".2400"
"RTN","ORB3TIM2",22,0)
 K DIC
"RTN","ORB3TIM2",23,0)
 ;
"RTN","ORB3TIM2",24,0)
 ;get DNR OIs:
"RTN","ORB3TIM2",25,0)
 S OIFILE=$$TERMLKUP^ORB31(.ORBY,"DNR")
"RTN","ORB3TIM2",26,0)
 ;
"RTN","ORB3TIM2",27,0)
 ;get local admin schedules for ONE TIME MED:
"RTN","ORB3TIM2",28,0)
 S ORSCHFIL=$$TERMLKUP^ORB31(.ORBZ,"ONE TIME MED")
"RTN","ORB3TIM2",29,0)
 ;
"RTN","ORB3TIM2",30,0)
 ;examine expiring orders:
"RTN","ORB3TIM2",31,0)
 S ORLASTDT=$P(^XTMP("ORB LAST EXPIRE",0),U,2)
"RTN","ORB3TIM2",32,0)
 S EXDT=$S($L(ORLASTDT):ORLASTDT,1:ORNOW)
"RTN","ORB3TIM2",33,0)
 F  S EXDT=$O(^OR(100,"AE",EXDT)) Q:(EXDT="")  D  Q:ORBRSLT<0
"RTN","ORB3TIM2",34,0)
 .S ORBRSLT=$$FMDIFF^XLFDT(EDT,$P(EXDT,".")_".2400",2)  ;diff in seconds
"RTN","ORB3TIM2",35,0)
 .Q:ORBRSLT<0
"RTN","ORB3TIM2",36,0)
 .S EXORN="" F  S EXORN=$O(^OR(100,"AE",EXDT,EXORN)) Q:EXORN=""  D
"RTN","ORB3TIM2",37,0)
 ..;
"RTN","ORB3TIM2",38,0)
 ..;Quit if isn't at least next day after order's Date of Last Activity:
"RTN","ORB3TIM2",39,0)
 ..S ORLDT=$P(^OR(100,EXORN,3),U)
"RTN","ORB3TIM2",40,0)
 ..Q:$$FMDIFF^XLFDT(ORNOW,ORLDT)<1
"RTN","ORB3TIM2",41,0)
 ..;
"RTN","ORB3TIM2",42,0)
 ..Q:$D(^XTMP("ORB LAST EXPIRE",EXORN))  ;quit if order already processed
"RTN","ORB3TIM2",43,0)
 ..S ^XTMP("ORB LAST EXPIRE",EXORN)=EXDT
"RTN","ORB3TIM2",44,0)
 ..;
"RTN","ORB3TIM2",45,0)
 ..S ORPT=$$PT^ORQOR2(EXORN)   ; get pt assoc w/order
"RTN","ORB3TIM2",46,0)
 ..Q:+$G(ORPT)<1
"RTN","ORB3TIM2",47,0)
 ..;
"RTN","ORB3TIM2",48,0)
 ..Q:+$G(^DPT(ORPT,.35))>0  ; quit if pt deceased - DBIA #10035
"RTN","ORB3TIM2",49,0)
 ..;
"RTN","ORB3TIM2",50,0)
 ..S PTLOC=$G(^DPT(+$G(ORPT),.1)),PTLOC=$S($L(PTLOC):PTLOC,1:"OUTPT")
"RTN","ORB3TIM2",51,0)
 ..;
"RTN","ORB3TIM2",52,0)
 ..; is expiring order a DNR order:
"RTN","ORB3TIM2",53,0)
 ..I $D(ORBY),(+$G(OIFILE)=101.43) D
"RTN","ORB3TIM2",54,0)
 ...F ORBI=1:1:ORBY D
"RTN","ORB3TIM2",55,0)
 ....S ORBDNR=$P(ORBY(ORBI),U) I ORBDNR=$$OI^ORQOR2(EXORN) D
"RTN","ORB3TIM2",56,0)
 .....S ORST=$P($$STATUS^ORQOR2(EXORN),U,2)
"RTN","ORB3TIM2",57,0)
 .....I ORST'="DISCONTINUED",ORST'="COMPLETE",ORST'="EXPIRED",ORST'="CANCELLED",ORST'="DISCONTINUED/EDIT" D
"RTN","ORB3TIM2",58,0)
 ......D EN^ORB3(45,ORPT,EXORN,"","",EXORN_"@") ;trigger DNR notif
"RTN","ORB3TIM2",59,0)
 ..;
"RTN","ORB3TIM2",60,0)
 ..; is expiring order a flagged oi:
"RTN","ORB3TIM2",61,0)
 ..S EXOI=$$OI^ORQOR2(EXORN) I +$G(EXOI)>0 D
"RTN","ORB3TIM2",62,0)
 ...I $L(PTLOC),PTLOC'="OUTPT" D
"RTN","ORB3TIM2",63,0)
 ....D ENVAL^XPAR(.ORBLST,"ORB OI EXPIRING - INPT","`"_EXOI,.ORBERR)
"RTN","ORB3TIM2",64,0)
 ....I 'ORBERR,$G(ORBLST)>0 D
"RTN","ORB3TIM2",65,0)
 .....S OITXT=$P(^ORD(101.43,EXOI,0),U)
"RTN","ORB3TIM2",66,0)
 .....S ORSDT=$P(^OR(100,EXORN,0),U,8),ORSDT=$$FMTE^XLFDT(ORSDT,"2P")
"RTN","ORB3TIM2",67,0)
 .....D EN^ORB3(64,ORPT,EXORN,"","["_PTLOC_"] Order expiring: "_OITXT_" "_ORSDT,EXORN_"@") ;trigger Expiring Flagged OI - INPT notification
"RTN","ORB3TIM2",68,0)
 ...;
"RTN","ORB3TIM2",69,0)
 ...I $L(PTLOC),PTLOC="OUTPT" D
"RTN","ORB3TIM2",70,0)
 ....D ENVAL^XPAR(.ORBLST,"ORB OI EXPIRING - OUTPT","`"_EXOI,.ORBERR)
"RTN","ORB3TIM2",71,0)
 ....I 'ORBERR,$G(ORBLST)>0 D
"RTN","ORB3TIM2",72,0)
 .....S OITXT=$P(^ORD(101.43,EXOI,0),U)
"RTN","ORB3TIM2",73,0)
 .....S ORSDT=$P(^OR(100,EXORN,0),U,8),ORSDT=$$FMTE^XLFDT(ORSDT,"2P")
"RTN","ORB3TIM2",74,0)
 .....D EN^ORB3(65,ORPT,EXORN,"","["_PTLOC_"] Order expiring: "_OITXT_" "_ORSDT,EXORN_"@") ;trigger Expiring Flagged OI - OUTPT notification
"RTN","ORB3TIM2",75,0)
 ..;
"RTN","ORB3TIM2",76,0)
 ..;is expiring order a med order:
"RTN","ORB3TIM2",77,0)
 ..S RXORD=$$DGRX^ORQOR2(EXORN)
"RTN","ORB3TIM2",78,0)
 ..I $L(RXORD) D  ;if expiring order is a med order
"RTN","ORB3TIM2",79,0)
 ...;
"RTN","ORB3TIM2",80,0)
 ...N DFN S DFN=ORPT
"RTN","ORB3TIM2",81,0)
 ...D ADM^VADPT2
"RTN","ORB3TIM2",82,0)
 ...;
"RTN","ORB3TIM2",83,0)
 ...I (RXORD="OUTPATIENT MEDICATIONS")!(+$G(VADMVT)<1&(RXORD'="CLINIC ORDERS")) D
"RTN","ORB3TIM2",84,0)
 ....D EN^ORB3(72,ORPT,EXORN,"","",EXORN_"@")  ;trigger outpt notif
"RTN","ORB3TIM2",85,0)
 ...;
"RTN","ORB3TIM2",86,0)
 ...Q:RXORD="OUTPATIENT MEDICATIONS"  ;quit if an outpt med
"RTN","ORB3TIM2",87,0)
 ...Q:+$G(VADMVT)<1&(RXORD'="CLINIC ORDERS")  ;quit if an outpt
"RTN","ORB3TIM2",88,0)
 ...;
"RTN","ORB3TIM2",89,0)
 ...K VADMVT
"RTN","ORB3TIM2",90,0)
 ...;
"RTN","ORB3TIM2",91,0)
 ...;is schedule for the order a ONE TIME MED:
"RTN","ORB3TIM2",92,0)
 ...S ONETIME=0
"RTN","ORB3TIM2",93,0)
 ...I $D(ORBZ),(+$G(ORSCHFIL)=51.1) F ORBI=1:1:ORBZ D
"RTN","ORB3TIM2",94,0)
 ....S ORSCH=$P(ORBZ(ORBI),U,2)
"RTN","ORB3TIM2",95,0)
 ....I ORSCH=$$VALUE^ORCSAVE2(EXORN,"SCHEDULE") S ONETIME=1 Q
"RTN","ORB3TIM2",96,0)
 ...Q:+$G(ONETIME)=1  ;quit if one time med
"RTN","ORB3TIM2",97,0)
 ...;
"RTN","ORB3TIM2",98,0)
 ...;check if this is an IMO order and what it is,send an M.E.-OUTPT alert
"RTN","ORB3TIM2",99,0)
 ...I RXORD="CLINIC ORDERS" D  Q
"RTN","ORB3TIM2",100,0)
 ....N ORDLG,ORDG,ORDLGNM,FLAG,ORX
"RTN","ORB3TIM2",101,0)
 ....S FLAG=0
"RTN","ORB3TIM2",102,0)
 ....S ORDLG=$P($G(^OR(100,EXORN,0)),U,5) Q:$P(ORDLG,";",2)'="ORD(101.41,"
"RTN","ORB3TIM2",103,0)
 ....S ORDLGNM=$P($G(^ORD(101.41,+ORDLG,0)),U)
"RTN","ORB3TIM2",104,0)
 ....S ORDG=$P($G(^ORD(101.41,+ORDLG,0)),U,2)
"RTN","ORB3TIM2",105,0)
 ....I ORDLGNM="PSJ OR PAT OE"!(ORDLGNM="PSJI OR PAT FLUID OE") S FLAG=1
"RTN","ORB3TIM2",106,0)
 ....I 'FLAG F ORX="INPATIENT MEDICATIONS","IV MEDICATIONS","UNIT DOSE MEDICATIONS","CLINIC ORDERS" I $$UPPER^ORU(ORDG)=ORX D
"RTN","ORB3TIM2",107,0)
 .....S FLAG=1
"RTN","ORB3TIM2",108,0)
 .....I ORX="IV MEDICATIONS",(+$$IVRENEW(EXORN)=0) S FLAG=0
"RTN","ORB3TIM2",109,0)
 .....I ORX="UNIT DOSE MEDICATIONS",(+$$UDRENEW(EXORN,EXDT)=0) S FLAG=0
"RTN","ORB3TIM2",110,0)
 ....I FLAG D EN^ORB3(72,ORPT,EXORN,"","",EXORN_"@")  ;trigger outpt notif
"RTN","ORB3TIM2",111,0)
 ...;
"RTN","ORB3TIM2",112,0)
 ...;quit if inpt/unit dose med and med is not renewable:
"RTN","ORB3TIM2",113,0)
 ...I RXORD="UNIT DOSE MEDICATIONS",(+$$UDRENEW(EXORN,EXDT)=0) Q
"RTN","ORB3TIM2",114,0)
 ...;
"RTN","ORB3TIM2",115,0)
 ...;quit if IV med and med is not renewable:
"RTN","ORB3TIM2",116,0)
 ...I RXORD="IV MEDICATIONS",(+$$IVRENEW(EXORN)=0) Q
"RTN","ORB3TIM2",117,0)
 ...;
"RTN","ORB3TIM2",118,0)
 ...D EN^ORB3(47,ORPT,EXORN,"","",EXORN_"@")  ;trigger notif
"RTN","ORB3TIM2",119,0)
 S ^XTMP("ORB LAST EXPIRE",0)=$$FMADD^XLFDT(ORNOW,7,"","","")_U_$$NOW^XLFDT
"RTN","ORB3TIM2",120,0)
 D EXCLN(ORNOW)
"RTN","ORB3TIM2",121,0)
 Q
"RTN","ORB3TIM2",122,0)
UDRENEW(EXORN,EXDT) ;extr function returns 1 if med is renewable, 0 if not
"RTN","ORB3TIM2",123,0)
 N ORNOW,ORSLT,ORSTATUS
"RTN","ORB3TIM2",124,0)
 S ORSLT=0
"RTN","ORB3TIM2",125,0)
 S ORSTATUS=$P($$STATUS^ORQOR2(EXORN),U,2)
"RTN","ORB3TIM2",126,0)
 I ORSTATUS="ACTIVE" Q 1  ;renewable if "active"
"RTN","ORB3TIM2",127,0)
 I ORSTATUS="HOLD" Q 1   ;renewable if "on hold"
"RTN","ORB3TIM2",128,0)
 I ORSTATUS="EXPIRED" D
"RTN","ORB3TIM2",129,0)
 .S ORNOW=$$NOW^XLFDT
"RTN","ORB3TIM2",130,0)
 .;renewable if expired w/in past 4 days:
"RTN","ORB3TIM2",131,0)
 .I $$FMDIFF^XLFDT(ORNOW,EXDT,1)<4 S ORSLT=1
"RTN","ORB3TIM2",132,0)
 Q ORSLT
"RTN","ORB3TIM2",133,0)
 ;
"RTN","ORB3TIM2",134,0)
IVRENEW(EXORN) ;extr function returns 1 if med is renewable, 0 if not
"RTN","ORB3TIM2",135,0)
 N ORSLT,ORSTATUS
"RTN","ORB3TIM2",136,0)
 S ORSLT=0
"RTN","ORB3TIM2",137,0)
 S ORSTATUS=$P($$STATUS^ORQOR2(EXORN),U,2)
"RTN","ORB3TIM2",138,0)
 I ORSTATUS="ACTIVE" Q 1   ;renewable if "active"
"RTN","ORB3TIM2",139,0)
 I ORSTATUS="HOLD" Q 1   ;renewable if "on hold"
"RTN","ORB3TIM2",140,0)
 I ORSTATUS="EXPIRED" Q 1  ;renewable if "expired"
"RTN","ORB3TIM2",141,0)
 Q ORSLT
"RTN","ORB3TIM2",142,0)
 ;
"RTN","ORB3TIM2",143,0)
EXCLN(ORNOW) ;clean up old entires in ^XTMP("ORB LAST EXPIRE")
"RTN","ORB3TIM2",144,0)
 N ORN,ORDT
"RTN","ORB3TIM2",145,0)
 S ORN=1
"RTN","ORB3TIM2",146,0)
 F  S ORN=$O(^XTMP("ORB LAST EXPIRE",ORN)) Q:ORN=""  D
"RTN","ORB3TIM2",147,0)
 .S ORDT=$G(^XTMP("ORB LAST EXPIRE",ORN))
"RTN","ORB3TIM2",148,0)
 .I $L(ORDT),(ORDT<ORNOW) D
"RTN","ORB3TIM2",149,0)
 ..K ^XTMP("ORB LAST EXPIRE",ORN)
"RTN","ORB3TIM2",150,0)
 Q
"RTN","ORQOR2")
0^3^B13837546^B13586012
"RTN","ORQOR2",1,0)
ORQOR2 ; slc/CLA - Extrinsic functions which return order information ;6/14/96  10:15 [ 04/02/97  1:35 PM ]
"RTN","ORQOR2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,92,122,144,190,251**;Dec 17, 1997
"RTN","ORQOR2",3,0)
STATUS(ORN) ;extrinsic function returns the current status of an order in
"RTN","ORQOR2",4,0)
 ;the format: status ien^external text 
"RTN","ORQOR2",5,0)
 ;DBIA #3458 supported api for outpt pharmacy
"RTN","ORQOR2",6,0)
 Q:'$L($G(ORN)) ""
"RTN","ORQOR2",7,0)
 Q:'$L($G(^OR(100,ORN,3))) ""
"RTN","ORQOR2",8,0)
 N ORSTATUS
"RTN","ORQOR2",9,0)
 S ORSTATUS=$P(^OR(100,ORN,3),U,3)
"RTN","ORQOR2",10,0)
 S ORSTATUS=ORSTATUS_U_$G(^ORD(100.01,+ORSTATUS,0))
"RTN","ORQOR2",11,0)
 Q ORSTATUS
"RTN","ORQOR2",12,0)
RECENT(PT,OI,ST) ;extrinsic funct returns pt's most recent order for an orderable item and status in format:
"RTN","ORQOR2",13,0)
 ; order number^order text (truncated to 60 chars)^start d/t^status
"RTN","ORQOR2",14,0)
 N INDT,ORN,CDT,ORSTATUS,ORTEXT,RESULT S RESULT="",ORN="",INDT=""
"RTN","ORQOR2",15,0)
 F  S INDT=$O(^OR(100,"AOI",OI,PT_";DPT(",INDT)) Q:INDT=""!(RESULT'="")  D
"RTN","ORQOR2",16,0)
 .F  S ORN=$O(^OR(100,"AOI",OI,PT_";DPT(",INDT,ORN)) Q:ORN=""  D
"RTN","ORQOR2",17,0)
 ..S ORSTATUS=$P(^OR(100,ORN,3),U,3)
"RTN","ORQOR2",18,0)
 ..I '$L($G(ST))!($G(ORSTATUS)=ST) D
"RTN","ORQOR2",19,0)
 ...S ORSTATUS=$G(^ORD(100.01,ORSTATUS,0)),CDT=9999999-INDT
"RTN","ORQOR2",20,0)
 ...S ORTEXT=$P($$TEXT^ORKOR(ORN,60),U,2)
"RTN","ORQOR2",21,0)
 ...S RESULT=ORN_U_ORTEXT_U_CDT_U_ORSTATUS
"RTN","ORQOR2",22,0)
 Q RESULT
"RTN","ORQOR2",23,0)
DUPRANGE(OI,DG,ODT,ORPT) ;extrinsic funct returns duplicate order range beginning date in the format:
"RTN","ORQOR2",24,0)
 ;fileman d/t^inverse fileman d/t
"RTN","ORQOR2",25,0)
 ;OI   = orderable item ien
"RTN","ORQOR2",26,0)
 ;DG   = display group abbrev. (e.g. 'LR')
"RTN","ORQOR2",27,0)
 ;ODT  = order effective/start date/time in FM format
"RTN","ORQOR2",28,0)
 ;ORPT = patient dfn
"RTN","ORQOR2",29,0)
 N DHRS,BDT,INBDT,ORSRV,ORLOC
"RTN","ORQOR2",30,0)
 S BDT="",INBDT=""
"RTN","ORQOR2",31,0)
 ;
"RTN","ORQOR2",32,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","ORQOR2",33,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","ORQOR2",34,0)
 I +$G(ORPT)>0 D
"RTN","ORQOR2",35,0)
 .N DFN S DFN=ORPT,VA200="" D OERR^VADPT
"RTN","ORQOR2",36,0)
 .I +$G(VAIN(4))>0 S ORLOC=+$G(^DIC(42,+$G(VAIN(4)),44))
"RTN","ORQOR2",37,0)
 .K VA200,VAIN
"RTN","ORQOR2",38,0)
 ;
"RTN","ORQOR2",39,0)
 S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQOR2",40,0)
 S DHRS=$$GET^XPAR("LOC.`"_$G(ORLOC)_"^SRV.`"_$G(ORSRV)_"^DIV^SYS","ORK DUP ORDER RANGE OI",OI,"I")
"RTN","ORQOR2",41,0)
 Q:$G(DHRS)=0 "0^0" ;quit if number of hours for this OI is zero
"RTN","ORQOR2",42,0)
 I +$G(DHRS)<1 D
"RTN","ORQOR2",43,0)
 .I DG="LR" S DHRS=$$GET^XPAR("LOC.`"_$G(ORLOC)_"^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG","ORK DUP ORDER RANGE LAB",1,"I")
"RTN","ORQOR2",44,0)
 .I DG="RA" S DHRS=$$GET^XPAR("LOC.`"_$G(ORLOC)_"^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG","ORK DUP ORDER RANGE RADIOLOGY",1,"I")
"RTN","ORQOR2",45,0)
 I +$G(DHRS)<1 S DHRS=48  ;non-lab and non-radiology default is 48 hrs
"RTN","ORQOR2",46,0)
 S BDT=$$FMADD^XLFDT(ODT,"","-"_DHRS,"",""),INBDT=9999999-BDT
"RTN","ORQOR2",47,0)
 Q BDT_U_INBDT
"RTN","ORQOR2",48,0)
ORDERER(ORNUM) ;ext. funct. gets ordering provider DUZ from ORDER File (#100)
"RTN","ORQOR2",49,0)
 Q:'$L($G(ORNUM)) ""
"RTN","ORQOR2",50,0)
 S ORNUM=+$G(ORNUM)
"RTN","ORQOR2",51,0)
 N ORQDUZ,ORQI S ORQDUZ=""
"RTN","ORQOR2",52,0)
 I $L($G(^OR(100,ORNUM,8,0))) D
"RTN","ORQOR2",53,0)
 .S ORQI=0,ORQI=$O(^OR(100,ORNUM,8,"C","NW",ORQI))  ;8 node for New order
"RTN","ORQOR2",54,0)
 Q:+$G(ORQI)<1 ""
"RTN","ORQOR2",55,0)
 S ORQDUZ=$P(^OR(100,ORNUM,8,ORQI,0),U,3)
"RTN","ORQOR2",56,0)
 Q ORQDUZ
"RTN","ORQOR2",57,0)
UNSIGNOR(ORNUM) ;ext. funct. gets ordering provider DUZ from ORDER File (#100)
"RTN","ORQOR2",58,0)
 ; based on order action number (8 node)
"RTN","ORQOR2",59,0)
 ; if no action number return orderer for New order
"RTN","ORQOR2",60,0)
 ;ORNUM in format: <order ien>;<action number>
"RTN","ORQOR2",61,0)
 Q:'$L(+$G(ORNUM)) ""
"RTN","ORQOR2",62,0)
 N ORQDUZ,ORQI S ORQDUZ=""
"RTN","ORQOR2",63,0)
 S ORQI=$P(ORNUM,";",2)
"RTN","ORQOR2",64,0)
 S ORNUM=$P(ORNUM,";")
"RTN","ORQOR2",65,0)
 Q:+$G(ORNUM)<1 ""
"RTN","ORQOR2",66,0)
 I +$G(ORQI)<1 S ORQI=$P($G(^OR(100,ORNUM,8,0)),U,3)
"RTN","ORQOR2",67,0)
 I $L(ORQI),$L($G(^OR(100,ORNUM,8,ORQI,0))) D
"RTN","ORQOR2",68,0)
 .S ORQDUZ=$P(^OR(100,ORNUM,8,ORQI,0),U,3)
"RTN","ORQOR2",69,0)
 Q ORQDUZ
"RTN","ORQOR2",70,0)
OI(ORNUM) ;ext. funct. gets Orderable Item ien from ORDER File (#100)
"RTN","ORQOR2",71,0)
 Q:+$G(ORNUM)<1 ""
"RTN","ORQOR2",72,0)
 N OI S OI=""
"RTN","ORQOR2",73,0)
 S OI=+$G(^OR(100,+$G(ORNUM),.1,1,0))
"RTN","ORQOR2",74,0)
 Q OI
"RTN","ORQOR2",75,0)
DG(ORNUM) ;ext. funct. gets Display Group ien from ORDER File (#100)
"RTN","ORQOR2",76,0)
 Q:'$L($G(ORNUM)) ""
"RTN","ORQOR2",77,0)
 N DG S DG=""
"RTN","ORQOR2",78,0)
 S DG=$G(^OR(100,ORNUM,0))
"RTN","ORQOR2",79,0)
 I $L(DG) S DG=$P(DG,U,11)
"RTN","ORQOR2",80,0)
 Q DG
"RTN","ORQOR2",81,0)
DGRX(ORNUM)        ;ext. funct. determines if order is pharmacy order
"RTN","ORQOR2",82,0)
 Q:+$G(ORNUM)<1 ""
"RTN","ORQOR2",83,0)
 N DG,DGNAME,RXDG
"RTN","ORQOR2",84,0)
 S DG=$$DG(ORNUM)
"RTN","ORQOR2",85,0)
 S DGNAME=$P($G(^ORD(100.98,+DG,0)),U) Q:'$L(DGNAME) ""
"RTN","ORQOR2",86,0)
 F RXDG="PHARMACY","INPATIENT MEDICATIONS","OUTPATIENT MEDICATIONS","UNIT DOSE MEDICATIONS","IV MEDICATIONS","NON-VA MEDICATIONS","CLINIC ORDERS","" Q:(DGNAME=RXDG)
"RTN","ORQOR2",87,0)
 Q RXDG
"RTN","ORQOR2",88,0)
PT(ORNUM) ;ext. funct. gets Patient dfn from ORDER File (#100)
"RTN","ORQOR2",89,0)
 Q:'$L($G(ORNUM)) ""
"RTN","ORQOR2",90,0)
 N PT S PT=""
"RTN","ORQOR2",91,0)
 S PT=$G(^OR(100,ORNUM,0))
"RTN","ORQOR2",92,0)
 I $L(PT) S PT=$P(PT,U,2),PT=$P(PT,";DPT")
"RTN","ORQOR2",93,0)
 Q PT
"RTN","ORQOR2",94,0)
RSLTFLG(ORNUM) ;ext. funct. returns duz of user to receive alert if order was
"RTN","ORQOR2",95,0)
 ; flagged to alert when resulted
"RTN","ORQOR2",96,0)
 Q:'$L($G(ORNUM)) ""
"RTN","ORQOR2",97,0)
 N FLG S FLG=""
"RTN","ORQOR2",98,0)
 S FLG=$G(^OR(100,+ORNUM,3))
"RTN","ORQOR2",99,0)
 I $L(FLG) S FLG=$P(FLG,U,10)
"RTN","ORQOR2",100,0)
 Q FLG
"RTN","ORWGAPIA")
0^1^B82316738^B81629503
"RTN","ORWGAPIA",1,0)
ORWGAPIA ; SLC/STAFF - Graph Application Calls ;4/13/06  10:34
"RTN","ORWGAPIA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,251**;Dec 17, 1997
"RTN","ORWGAPIA",3,0)
 ;
"RTN","ORWGAPIA",4,0)
AA(IEN) ; $$(ien) -> external display of accession area
"RTN","ORWGAPIA",5,0)
 Q $P($G(^LRO(68,IEN,0)),U)
"RTN","ORWGAPIA",6,0)
AALAB(TEST) ; $$(lab test) -> accession ien^acc name^acc abbrev
"RTN","ORWGAPIA",7,0)
 N AA,DIV
"RTN","ORWGAPIA",8,0)
 S TEST=+$G(TEST)
"RTN","ORWGAPIA",9,0)
 S DIV=+$G(DUZ(2))
"RTN","ORWGAPIA",10,0)
 S AA=+$P($G(^LAB(60,+TEST,8,DIV,0)),U,2)
"RTN","ORWGAPIA",11,0)
 I AA Q AA_U_$$ACCLAB(AA)
"RTN","ORWGAPIA",12,0)
 S AA=+$P($G(^LAB(60,+TEST,8,+$O(^LAB(60,+TEST,8,0)),0)),U,2)
"RTN","ORWGAPIA",13,0)
 I AA Q AA_U_$$ACCLAB(AA)
"RTN","ORWGAPIA",14,0)
 Q ""
"RTN","ORWGAPIA",15,0)
ACC(DATA) ; API - get accession areas   - from ORWGAPI
"RTN","ORWGAPIA",16,0)
 N CNT,IEN,TMP,RESULT,ZERO
"RTN","ORWGAPIA",17,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIA",18,0)
 S CNT=0
"RTN","ORWGAPIA",19,0)
 S IEN=0
"RTN","ORWGAPIA",20,0)
 F  S IEN=$O(^LRO(68,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",21,0)
 . S ZERO=$G(^LRO(68,IEN,0)) I '$L(ZERO) Q
"RTN","ORWGAPIA",22,0)
 . S RESULT="68^"_IEN_U_$P(ZERO,U)_U_$P(ZERO,U,11)
"RTN","ORWGAPIA",23,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIA",24,0)
 Q
"RTN","ORWGAPIA",25,0)
ACCLAB(AA) ; $$(accession ien) -> acc name^acc abbrev
"RTN","ORWGAPIA",26,0)
 N ZERO
"RTN","ORWGAPIA",27,0)
 S ZERO=$G(^LRO(68,AA,0)) I '$L(ZERO) Q ""
"RTN","ORWGAPIA",28,0)
 Q "lab - "_$P(ZERO,U)_U_$P(ZERO,U,11)
"RTN","ORWGAPIA",29,0)
ADDDRUG(NUM1) ; $$(additive) -> drug in 50 else ""
"RTN","ORWGAPIA",30,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",31,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIA",32,0)
 D ZERO^PSS52P6(IEN,,,"RX")
"RTN","ORWGAPIA",33,0)
 S RESULT=$P($G(^TMP($J,"RX",IEN,1)),U)
"RTN","ORWGAPIA",34,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",35,0)
 Q RESULT
"RTN","ORWGAPIA",36,0)
ALLG(IEN) ; $$(ien) -> external display of allergies
"RTN","ORWGAPIA",37,0)
 I IEN Q $P($G(^GMRD(120.83,IEN,0)),U) ; this is for rxn, allergy is free text
"RTN","ORWGAPIA",38,0)
 Q IEN
"RTN","ORWGAPIA",39,0)
CPT(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",40,0)
 D VCPT^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",41,0)
 Q
"RTN","ORWGAPIA",42,0)
DC(IEN) ; $$(ien) -> external display of drug class
"RTN","ORWGAPIA",43,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",44,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIA",45,0)
 D IEN^PSN50P65(IEN,,"RX")
"RTN","ORWGAPIA",46,0)
 S RESULT=$G(^TMP($J,"RX",IEN,1))
"RTN","ORWGAPIA",47,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",48,0)
 Q RESULT
"RTN","ORWGAPIA",49,0)
DISCH(IEN) ; $$(pt movement ien) -> discharge date
"RTN","ORWGAPIA",50,0)
 Q $P($G(^DGPM(+$P($G(^DGPM(+$G(IEN),0)),U,17),0)),U)
"RTN","ORWGAPIA",51,0)
DOCCLASS(DOCTYPE) ; $$(doc type) -> ien of tiu doc class
"RTN","ORWGAPIA",52,0)
 N CONSULTS
"RTN","ORWGAPIA",53,0)
 S DOCTYPE=$E(DOCTYPE,1)
"RTN","ORWGAPIA",54,0)
 I DOCTYPE="P" Q 3
"RTN","ORWGAPIA",55,0)
 I DOCTYPE="D" Q 244
"RTN","ORWGAPIA",56,0)
 I DOCTYPE="C" D CNSLCLAS^TIUSRVD(.CONSULTS) Q CONSULTS
"RTN","ORWGAPIA",57,0)
 Q 0
"RTN","ORWGAPIA",58,0)
DRGCLASS(DRUG) ; $$(drug) -> drug class^classification
"RTN","ORWGAPIA",59,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",60,0)
 I '$G(DRUG) Q ""
"RTN","ORWGAPIA",61,0)
 D DATA^PSS50(DRUG,,,,,"RX")
"RTN","ORWGAPIA",62,0)
 S RESULT=+$G(^TMP($J,"RX",DRUG,25))
"RTN","ORWGAPIA",63,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",64,0)
 Q RESULT_U_"drug - "_$$DC(RESULT)
"RTN","ORWGAPIA",65,0)
DRUG(NUM) ; $$(bcma entry) -> drug in 50 else ""
"RTN","ORWGAPIA",66,0)
 N DONE,DRUG,NUM1
"RTN","ORWGAPIA",67,0)
 S DONE=0,NUM=+$G(NUM)
"RTN","ORWGAPIA",68,0)
 S NUM1=0
"RTN","ORWGAPIA",69,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.5,"B",NUM1)) Q:NUM1<1  S DONE=1 Q
"RTN","ORWGAPIA",70,0)
 I DONE Q NUM1
"RTN","ORWGAPIA",71,0)
 S DRUG=0
"RTN","ORWGAPIA",72,0)
 S NUM1=0
"RTN","ORWGAPIA",73,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.6,"B",NUM1)) Q:NUM1<1  D  I DONE Q
"RTN","ORWGAPIA",74,0)
 . S DRUG=$$ADDDRUG(NUM1)
"RTN","ORWGAPIA",75,0)
 . I DRUG S DONE=1
"RTN","ORWGAPIA",76,0)
 I DONE Q DRUG
"RTN","ORWGAPIA",77,0)
 S DRUG=0
"RTN","ORWGAPIA",78,0)
 S NUM1=0
"RTN","ORWGAPIA",79,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.7,"B",NUM1)) Q:NUM1<1  D  I DONE Q
"RTN","ORWGAPIA",80,0)
 . S DRUG=$$SOLDRUG(NUM1)
"RTN","ORWGAPIA",81,0)
 . I DRUG S DONE=1
"RTN","ORWGAPIA",82,0)
 I DONE Q DRUG
"RTN","ORWGAPIA",83,0)
 Q ""
"RTN","ORWGAPIA",84,0)
DRUGC(VALUES) ; API - get drug classes   - from ORWGAPI
"RTN","ORWGAPIA",85,0)
 N CLASS,IEN,NUM,ROOT K VALUES
"RTN","ORWGAPIA",86,0)
 S NUM=0
"RTN","ORWGAPIA",87,0)
 S ROOT=$$ROOT^PSN50P65(1)
"RTN","ORWGAPIA",88,0)
 S CLASS=""
"RTN","ORWGAPIA",89,0)
 F  S CLASS=$O(@ROOT@(CLASS)) Q:CLASS=""  D
"RTN","ORWGAPIA",90,0)
 . S IEN=0
"RTN","ORWGAPIA",91,0)
 . F  S IEN=$O(@ROOT@(CLASS,IEN)) Q:IEN=""  D
"RTN","ORWGAPIA",92,0)
 .. S NUM=NUM+1
"RTN","ORWGAPIA",93,0)
 .. S VALUES(NUM)="50.605^"_IEN_U_CLASS
"RTN","ORWGAPIA",94,0)
 M ^TMP("ORWGRPC",$J)=VALUES K VALUES
"RTN","ORWGAPIA",95,0)
 Q
"RTN","ORWGAPIA",96,0)
EDU(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",97,0)
 D VPEDU^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",98,0)
 Q
"RTN","ORWGAPIA",99,0)
EXAM(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",100,0)
 D VXAM^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",101,0)
 Q
"RTN","ORWGAPIA",102,0)
GETTIU(ORDATA,IEN) ; from ORWGAPID
"RTN","ORWGAPIA",103,0)
 D TGET^TIUSRVR1(.ORDATA,IEN)
"RTN","ORWGAPIA",104,0)
 Q
"RTN","ORWGAPIA",105,0)
HF(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",106,0)
 D VHF^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",107,0)
 Q
"RTN","ORWGAPIA",108,0)
ICD0(IEN) ; $$(ien) -> external display of IDC0
"RTN","ORWGAPIA",109,0)
 Q $P($G(^ICD0(IEN,0)),U)_" "_$P($G(^ICD0(IEN,0)),U,4)
"RTN","ORWGAPIA",110,0)
ICD9(IEN) ; $$(ien) -> external display of IDC9
"RTN","ORWGAPIA",111,0)
 Q $P($G(^ICD9(IEN,0)),U)_" "_$P($G(^ICD9(IEN,0)),U,3)
"RTN","ORWGAPIA",112,0)
ICPT(IEN,CSD) ; $$(ien) -> external display of CPT
"RTN","ORWGAPIA",113,0)
 N X S X=$$CPT^ICPTCOD($G(IEN),$G(CSD))
"RTN","ORWGAPIA",114,0)
 Q $P(X,U,2)_" "_$E($P(X,U,3),1,30)
"RTN","ORWGAPIA",115,0)
IMM(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",116,0)
 D VIMM^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",117,0)
 Q
"RTN","ORWGAPIA",118,0)
INSIG(NODE) ; $$(node) -> sig
"RTN","ORWGAPIA",119,0)
 N DFN,DNUM,IEN,LNUM,SIG,SUB ; replace this code in v27 with INSIG^ORWGAPIX
"RTN","ORWGAPIA",120,0)
 S DFN=+$G(NODE)
"RTN","ORWGAPIA",121,0)
 S SUB=$P($G(NODE),";",2)
"RTN","ORWGAPIA",122,0)
 S IEN=+$P($G(NODE),";",3)
"RTN","ORWGAPIA",123,0)
 S SIG=""
"RTN","ORWGAPIA",124,0)
 I SUB=5 D
"RTN","ORWGAPIA",125,0)
 . S LNUM=$G(^PS(55,DFN,5,IEN,0))
"RTN","ORWGAPIA",126,0)
 . S DNUM=$G(^PS(55,DFN,5,IEN,.2))
"RTN","ORWGAPIA",127,0)
 . I $L(DNUM),$L(LNUM) D
"RTN","ORWGAPIA",128,0)
 .. S SIG="  Give: "_$$EXT^ORWGAPIX($P(LNUM,U,3),55.06,3)
"RTN","ORWGAPIA",129,0)
 .. S SIG=SIG_" "_$$EXT^ORWGAPIX($P(LNUM,U,7),55.06,7)
"RTN","ORWGAPIA",130,0)
 I SUB="IV" D
"RTN","ORWGAPIA",131,0)
 . S LNUM=$G(^PS(55,DFN,"IV",IEN,0))
"RTN","ORWGAPIA",132,0)
 . S DNUM=$G(^PS(55,DFN,"IV",IEN,.2))
"RTN","ORWGAPIA",133,0)
 . I $L(DNUM),$L(LNUM) D
"RTN","ORWGAPIA",134,0)
 .. S SIG="  Give: "_$P(DNUM,U,2)
"RTN","ORWGAPIA",135,0)
 .. S SIG=SIG_" "_$$EXT^ORWGAPIX($P(LNUM,U,2),55.01,.02)_" "_$P(LNUM,U,9)
"RTN","ORWGAPIA",136,0)
 Q SIG
"RTN","ORWGAPIA",137,0)
ISA(USER,CLASS,ORERR) ; $$(user,user class,err) -> 1 if user in class, else 0
"RTN","ORWGAPIA",138,0)
 Q $$ISA^USRLM(USER,CLASS,.ORERR)
"RTN","ORWGAPIA",139,0)
LAB(ORVALUE,NODE,ITEM) ; from ORWGAPI3
"RTN","ORWGAPIA",140,0)
 D LRPXRM^LRPXAPI(.ORVALUE,NODE,ITEM,"VSC")
"RTN","ORWGAPIA",141,0)
 Q
"RTN","ORWGAPIA",142,0)
LABNAME(Y) ; $$(item ien) -> item name
"RTN","ORWGAPIA",143,0)
 I $P(Y,";")="A",$P(Y,";",2)="S" Q $P(Y,".",2,99)
"RTN","ORWGAPIA",144,0)
 Q $$ITEMNM^LRPXAPIU(Y)
"RTN","ORWGAPIA",145,0)
LABSUM(ORDATA,DFN,DATE1,DATE2,ORSUB) ; from ORWGAPID
"RTN","ORWGAPIA",146,0)
 D EN^LR7OSUM(.ORDATA,DFN,DATE1,DATE2,,80,.ORSUB)
"RTN","ORWGAPIA",147,0)
 Q
"RTN","ORWGAPIA",148,0)
LOS(DGPMIFN) ; $$(pt movement ien) -> length of stay
"RTN","ORWGAPIA",149,0)
 N X D ^DGPMLOS
"RTN","ORWGAPIA",150,0)
 Q +$P($G(X),U,5)
"RTN","ORWGAPIA",151,0)
LRDFN(DFN) ; $$(dfn) -> lrdfn
"RTN","ORWGAPIA",152,0)
 Q $$LRDFN^LRPXAPIU(DFN)
"RTN","ORWGAPIA",153,0)
LRIDT(LRDT) ;  $$(date) -> inverse date
"RTN","ORWGAPIA",154,0)
 Q $$LRIDT^LRPXAPIU(LRDT)
"RTN","ORWGAPIA",155,0)
MEDICINE(ARRAY,DFN) ;
"RTN","ORWGAPIA",156,0)
 N DATE,FILE,IEN,NAME,NUM,REF,VALUES,XREF
"RTN","ORWGAPIA",157,0)
 K ARRAY,^TMP("MCAR",$J),^TMP("OR",$J,"MCAR")
"RTN","ORWGAPIA",158,0)
 D FILE^ORWGAPIU(690,.REF,.XREF)
"RTN","ORWGAPIA",159,0)
 I '$L(REF) Q
"RTN","ORWGAPIA",160,0)
 I $E(REF,$L(REF))="," S REF=$E(REF,1,$L(REF)-1)_")"
"RTN","ORWGAPIA",161,0)
 I $E(REF,$L(REF))="(" S REF=$P(REF,"(")
"RTN","ORWGAPIA",162,0)
 D EN^MCARPS2(DFN)
"RTN","ORWGAPIA",163,0)
 S NUM=0
"RTN","ORWGAPIA",164,0)
 F  S NUM=$O(^TMP("OR",$J,"MCAR","OT",NUM)) Q:NUM<1  D
"RTN","ORWGAPIA",165,0)
 . S VALUES=^TMP("OR",$J,"MCAR","OT",NUM)
"RTN","ORWGAPIA",166,0)
 . S DATE=$$DATETFM^ORWGAPIU($P(VALUES,U,6))
"RTN","ORWGAPIA",167,0)
 . S NAME=$P(VALUES,U) I '$L(NAME) Q
"RTN","ORWGAPIA",168,0)
 . S IEN=+$O(@REF@(XREF,NAME,""))
"RTN","ORWGAPIA",169,0)
 . I DATE,IEN S ARRAY(IEN,DATE)=NAME
"RTN","ORWGAPIA",170,0)
 K ^TMP("MCAR",$J),^TMP("OR",$J,"MCAR")
"RTN","ORWGAPIA",171,0)
 Q
"RTN","ORWGAPIA",172,0)
MEDVAL(VAL) ;
"RTN","ORWGAPIA",173,0)
 N IEN,NAME,NAMES,REF,SEQ,XREF K NAMES,VAL
"RTN","ORWGAPIA",174,0)
 D FILE^ORWGAPIU(690,.REF,.XREF)
"RTN","ORWGAPIA",175,0)
 I '$L(REF) Q
"RTN","ORWGAPIA",176,0)
 I $E(REF,$L(REF))="," S REF=$E(REF,1,$L(REF)-1)_")"
"RTN","ORWGAPIA",177,0)
 I $E(REF,$L(REF))="(" S REF=$P(REF,"(")
"RTN","ORWGAPIA",178,0)
 S NAME=""
"RTN","ORWGAPIA",179,0)
 F  S NAME=$O(@REF@(XREF,NAME)) Q:NAME=""  D
"RTN","ORWGAPIA",180,0)
 . S IEN=0
"RTN","ORWGAPIA",181,0)
 . F  S IEN=$O(@REF@(XREF,NAME,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",182,0)
 .. S NAMES(IEN)=NAME
"RTN","ORWGAPIA",183,0)
 S SEQ=0
"RTN","ORWGAPIA",184,0)
 S IEN=0
"RTN","ORWGAPIA",185,0)
 F  S IEN=$O(NAMES(IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",186,0)
 . S SEQ=SEQ+1
"RTN","ORWGAPIA",187,0)
 . S VAL(SEQ)=690_U_IEN_U_NAMES(IEN)
"RTN","ORWGAPIA",188,0)
 Q
"RTN","ORWGAPIA",189,0)
MH(ORVALUE,NODE) ; from ORWGAPI4
"RTN","ORWGAPIA",190,0)
 D ENDAS^YTAPI10(.ORVALUE,NODE)
"RTN","ORWGAPIA",191,0)
 Q
"RTN","ORWGAPIA",192,0)
NVASIG(NODE) ;  $$(node) -> sig on non-va drug
"RTN","ORWGAPIA",193,0)
 N RESULTS,SIG K RESULTS
"RTN","ORWGAPIA",194,0)
 I '$L(NODE) Q ""
"RTN","ORWGAPIA",195,0)
 D RXNVA(NODE,.RESULTS)
"RTN","ORWGAPIA",196,0)
 S SIG=RESULTS("DOSAGE")
"RTN","ORWGAPIA",197,0)
 S SIG=SIG_" "_RESULTS("MEDICATION ROUTE")
"RTN","ORWGAPIA",198,0)
 S SIG=SIG_" "_RESULTS("SCHEDULE")
"RTN","ORWGAPIA",199,0)
 Q SIG
"RTN","ORWGAPIA",200,0)
OITEM(DATA) ; API - get order display groups   -  from ORWGAPI
"RTN","ORWGAPIA",201,0)
 N CNT,IEN,RESULT,TMP,ZERO
"RTN","ORWGAPIA",202,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIA",203,0)
 S CNT=0
"RTN","ORWGAPIA",204,0)
 S IEN=0
"RTN","ORWGAPIA",205,0)
 F  S IEN=$O(^ORD(100.98,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",206,0)
 . S ZERO=$G(^ORD(100.98,IEN,0)) I '$L(ZERO) Q
"RTN","ORWGAPIA",207,0)
 . S RESULT="100.98^"_IEN_U_$P(ZERO,U)_U_$P(ZERO,U,3)
"RTN","ORWGAPIA",208,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIA",209,0)
 Q
"RTN","ORWGAPIA",210,0)
POINAME(IEN) ; $$(poi entry) - > name and dosage form else ""
"RTN","ORWGAPIA",211,0)
 N NAME,RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",212,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIA",213,0)
 D ZERO^PSS50P7(IEN,,,"RX")
"RTN","ORWGAPIA",214,0)
 S NAME=$P($G(^TMP($J,"RX",IEN,.01)),U)
"RTN","ORWGAPIA",215,0)
 S NAME=NAME_" "_$P($G(^TMP($J,"BOB",IEN,.02)),U,2)
"RTN","ORWGAPIA",216,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",217,0)
 I NAME'=" " Q NAME
"RTN","ORWGAPIA",218,0)
 Q ""
"RTN","ORWGAPIA",219,0)
POV(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",220,0)
 D VPOV^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",221,0)
 Q
"RTN","ORWGAPIA",222,0)
PROB(GMPLLEX,GMPLSTAT,GMPLICD,GMPLODAT,GMPLXDAT,NODE) ; from ORWGAPI4
"RTN","ORWGAPIA",223,0)
 N GMPLPNAM,GMPLDLM,GMPLTXT,GMPLCOND,GMPLPRV,GMPLPRIO
"RTN","ORWGAPIA",224,0)
 D CALL2^GMPLUTL3(NODE)
"RTN","ORWGAPIA",225,0)
 Q
"RTN","ORWGAPIA",226,0)
PTF(NODE,ORVALUE) ; from ORWGAPI3, ORWGAPI4
"RTN","ORWGAPIA",227,0)
 D PTF^DGPTPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",228,0)
 Q
"RTN","ORWGAPIA",229,0)
RAD(NODE,ORVALUE) ; from ORWGAPI3
"RTN","ORWGAPIA",230,0)
 D EN1^RAPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",231,0)
 Q
"RTN","ORWGAPIA",232,0)
RXIN(NODE,ORVALUE) ; from ORWGAPI3
"RTN","ORWGAPIA",233,0)
 D OEL^PSJPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIA",234,0)
 Q
"RTN","ORWGAPIA",235,0)
RXNVA(NODE,ORVALUE) ; from ORWGAPI1, ORWGAPI3
"RTN","ORWGAPIA",236,0)
 D NVA^PSOPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIA",237,0)
 Q
"RTN","ORWGAPIA",238,0)
RXOUT(NODE,ORVALUE) ; from ORWGAPI3
"RTN","ORWGAPIA",239,0)
 D PSRX^PSOPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIA",240,0)
 Q
"RTN","ORWGAPIA",241,0)
SIG(DFN,RXIEN) ; $$(dfn,prescription ien) -> sig
"RTN","ORWGAPIA",242,0)
 N LNUM,SIG K ^TMP($J,"RX")
"RTN","ORWGAPIA",243,0)
 S RXIEN=+$G(RXIEN)
"RTN","ORWGAPIA",244,0)
 D RX^PSO52API(DFN,"RX",RXIEN,,"M",,)
"RTN","ORWGAPIA",245,0)
 S SIG=""
"RTN","ORWGAPIA",246,0)
 S LNUM=0
"RTN","ORWGAPIA",247,0)
 F  S LNUM=$O(^TMP($J,"RX",DFN,RXIEN,"M",LNUM)) Q:LNUM<1  D
"RTN","ORWGAPIA",248,0)
 . S SIG=SIG_$G(^TMP($J,"RX",DFN,RXIEN,"M",LNUM,0))_" "
"RTN","ORWGAPIA",249,0)
 I $L(SIG) S SIG="  Sig: "_$$LOW^ORWGAPIX(SIG)
"RTN","ORWGAPIA",250,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",251,0)
 Q SIG
"RTN","ORWGAPIA",252,0)
SKIN(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",253,0)
 D VSKIN^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",254,0)
 Q
"RTN","ORWGAPIA",255,0)
SOLDRUG(NUM1) ; $$(iv solution) -> drug in 50 else ""
"RTN","ORWGAPIA",256,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",257,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIA",258,0)
 D ZERO^PSS52P7(IEN,,,"RX")
"RTN","ORWGAPIA",259,0)
 S RESULT=$P($G(^TMP($J,"RX",IEN,1)),U)
"RTN","ORWGAPIA",260,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",261,0)
 Q RESULT
"RTN","ORWGAPIA",262,0)
SURG(ORSURG,DFN) ; from ORWGAPI2, ORWGAPI4
"RTN","ORWGAPIA",263,0)
 D GET^SROGTSR(.ORSURG,DFN)
"RTN","ORWGAPIA",264,0)
 Q
"RTN","ORWGAPIA",265,0)
TAX(IEN) ; $$(ien) -> external display of reminder taxonomy
"RTN","ORWGAPIA",266,0)
 Q $P($G(^PXD(811.2,+$G(IEN),0)),U)
"RTN","ORWGAPIA",267,0)
TITLE(DOCTYPE) ; $$(document type) -> parent ien^parent^parent abbrev
"RTN","ORWGAPIA",268,0)
 N IEN,RESULTS K RESULTS
"RTN","ORWGAPIA",269,0)
 S DOCTYPE=+$G(^TIU(8925,+$G(DOCTYPE),0))
"RTN","ORWGAPIA",270,0)
 S IEN=+$$DOCCLASS^TIULC1(DOCTYPE) I 'IEN Q ""
"RTN","ORWGAPIA",271,0)
 D GETDATA^ORWGAPIX(.RESULTS,8925.1,".01;.02",IEN)
"RTN","ORWGAPIA",272,0)
 I '$L($G(RESULTS(.01))) Q ""
"RTN","ORWGAPIA",273,0)
 Q IEN_U_"note - "_RESULTS(.01)_U_$G(RESULTS(.02))
"RTN","ORWGAPIA",274,0)
TIU(ORVALUE,DOCIEN,ONE,DFN,OLDEST,NEWEST) ; from ORWGAPI1, ORWGAPI3
"RTN","ORWGAPIA",275,0)
 D CONTEXT^TIUSRVLO(.ORVALUE,DOCIEN,ONE,DFN,$G(OLDEST),$G(NEWEST))
"RTN","ORWGAPIA",276,0)
 Q
"RTN","ORWGAPIA",277,0)
TIUTITLE(DATA) ; API - get tiu document titles   - from ORWGAPI
"RTN","ORWGAPIA",278,0)
 N CNT,IEN,RESULT,RESULTS,TMP
"RTN","ORWGAPIA",279,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIA",280,0)
 S CNT=0
"RTN","ORWGAPIA",281,0)
 S IEN=0
"RTN","ORWGAPIA",282,0)
 F  S IEN=$O(^TIU(8925.1,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",283,0)
 . I $P($G(^TIU(8925.1,IEN,0)),U,4)'="DOC" Q
"RTN","ORWGAPIA",284,0)
 . K RESULTS
"RTN","ORWGAPIA",285,0)
 . D GETDATA^ORWGAPIX(.RESULTS,8925.1,".01;.02",IEN)
"RTN","ORWGAPIA",286,0)
 . I '$L($G(RESULTS(.01))) Q
"RTN","ORWGAPIA",287,0)
 . S RESULT="8925.1^"_IEN_U_RESULTS(.01)_U_$G(RESULTS(.02))
"RTN","ORWGAPIA",288,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIA",289,0)
 Q
"RTN","ORWGAPIA",290,0)
VITAL(ORVALUE,NODE) ; from ORWGAPI4
"RTN","ORWGAPIA",291,0)
 D EN^GMVPXRM(.ORVALUE,NODE)
"RTN","ORWGAPIA",292,0)
 Q
"RTN","ORWGAPIA",293,0)
 ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIA",294,0)
ADMITX(DFN) ;
"RTN","ORWGAPIA",295,0)
 Q $O(^DGPM("C",+$G(DFN),0))>0
"RTN","ORWGAPIA",296,0)
ALLERGYX(DFN) ;
"RTN","ORWGAPIA",297,0)
 Q $O(^GMR(120.8,"B",+$G(DFN),0))>0
"RTN","ORWGAPIA",298,0)
BCMAX(DFN) ;
"RTN","ORWGAPIA",299,0)
 Q $O(^PSB(53.79,"B",+$G(DFN),0))>0
"RTN","ORWGAPIA",300,0)
NOTEX(DFN) ;
"RTN","ORWGAPIA",301,0)
 Q $O(^TIU(8925,"C",+$G(DFN),0))>0
"RTN","ORWGAPIA",302,0)
NVAX(DFN) ;
"RTN","ORWGAPIA",303,0)
 Q $L($O(^PXRMINDX("55NVA","PI",+$G(DFN),"")))>0
"RTN","ORWGAPIA",304,0)
SURGX(DFN) ;
"RTN","ORWGAPIA",305,0)
 Q $O(^SRF("B",+$G(DFN),0))>0
"RTN","ORWGAPIA",306,0)
TREATX(DFN) ;
"RTN","ORWGAPIA",307,0)
 Q $L($O(^AUPNVTRT("AA",+$G(DFN),"")))>0
"RTN","ORWGAPIA",308,0)
VISITX(DFN) ;
"RTN","ORWGAPIA",309,0)
 Q $O(^AUPNVSIT("AET",+$G(DFN),0))>0
"VER")
8.0^22.0
"BLD",17653,6)
^226
**END**
**END**
