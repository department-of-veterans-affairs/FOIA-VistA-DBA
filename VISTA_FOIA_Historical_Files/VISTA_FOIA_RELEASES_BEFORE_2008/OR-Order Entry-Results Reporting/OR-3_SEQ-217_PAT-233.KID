Released OR*3*233 SEQ #217
Extracted from mail message
**KIDS**:OR*3.0*233^

**INSTALL NAME**
OR*3.0*233
"BLD",5632,0)
OR*3.0*233^ORDER ENTRY/RESULTS REPORTING^0^3050610^y
"BLD",5632,1,0)
^^2^2^3050510^^
"BLD",5632,1,1,0)
Support for allergy data standardization updates that are needed
"BLD",5632,1,2,0)
in the CPRS package.  Please see FORUM for a complete description.
"BLD",5632,4,0)
^9.64PA^^
"BLD",5632,"ABPKG")
n
"BLD",5632,"KRN",0)
^9.67PA^8989.52^19
"BLD",5632,"KRN",.4,0)
.4
"BLD",5632,"KRN",.401,0)
.401
"BLD",5632,"KRN",.402,0)
.402
"BLD",5632,"KRN",.403,0)
.403
"BLD",5632,"KRN",.5,0)
.5
"BLD",5632,"KRN",.84,0)
.84
"BLD",5632,"KRN",3.6,0)
3.6
"BLD",5632,"KRN",3.8,0)
3.8
"BLD",5632,"KRN",9.2,0)
9.2
"BLD",5632,"KRN",9.8,0)
9.8
"BLD",5632,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5632,"KRN",9.8,"NM",1,0)
ORWDAL32^^0^B33049484
"BLD",5632,"KRN",9.8,"NM","B","ORWDAL32",1)

"BLD",5632,"KRN",19,0)
19
"BLD",5632,"KRN",19.1,0)
19.1
"BLD",5632,"KRN",101,0)
101
"BLD",5632,"KRN",409.61,0)
409.61
"BLD",5632,"KRN",771,0)
771
"BLD",5632,"KRN",870,0)
870
"BLD",5632,"KRN",8989.51,0)
8989.51
"BLD",5632,"KRN",8989.52,0)
8989.52
"BLD",5632,"KRN",8994,0)
8994
"BLD",5632,"KRN","B",.4,.4)

"BLD",5632,"KRN","B",.401,.401)

"BLD",5632,"KRN","B",.402,.402)

"BLD",5632,"KRN","B",.403,.403)

"BLD",5632,"KRN","B",.5,.5)

"BLD",5632,"KRN","B",.84,.84)

"BLD",5632,"KRN","B",3.6,3.6)

"BLD",5632,"KRN","B",3.8,3.8)

"BLD",5632,"KRN","B",9.2,9.2)

"BLD",5632,"KRN","B",9.8,9.8)

"BLD",5632,"KRN","B",19,19)

"BLD",5632,"KRN","B",19.1,19.1)

"BLD",5632,"KRN","B",101,101)

"BLD",5632,"KRN","B",409.61,409.61)

"BLD",5632,"KRN","B",771,771)

"BLD",5632,"KRN","B",870,870)

"BLD",5632,"KRN","B",8989.51,8989.51)

"BLD",5632,"KRN","B",8989.52,8989.52)

"BLD",5632,"KRN","B",8994,8994)

"BLD",5632,"QUES",0)
^9.62^^
"BLD",5632,"REQB",0)
^9.611^4^4
"BLD",5632,"REQB",1,0)
OR*3.0*195^1
"BLD",5632,"REQB",2,0)
HDI*1.0*1^1
"BLD",5632,"REQB",3,0)
XU*8.0*382^1
"BLD",5632,"REQB",4,0)
PSO*7.0*205^1
"BLD",5632,"REQB","B","HDI*1.0*1",2)

"BLD",5632,"REQB","B","OR*3.0*195",1)

"BLD",5632,"REQB","B","PSO*7.0*205",4)

"BLD",5632,"REQB","B","XU*8.0*382",3)

"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
233^3050610^1326
"PKG",110,22,1,"PAH",1,1,0)
^^2^2^3050610
"PKG",110,22,1,"PAH",1,1,1,0)
Support for allergy data standardization updates that are needed
"PKG",110,22,1,"PAH",1,1,2,0)
in the CPRS package.  Please see FORUM for a complete description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORWDAL32")
0^1^B33049484
"RTN","ORWDAL32",1,0)
ORWDAL32 ; SLC/REV - Allergy calls to support windows ;5/31/05  14:14
"RTN","ORWDAL32",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,190,195,233**;Dec 17, 1997
"RTN","ORWDAL32",3,0)
 ;
"RTN","ORWDAL32",4,0)
DEF(LST) ; Get dialog data for allergies
"RTN","ORWDAL32",5,0)
 N ILST,I,X S ILST=0
"RTN","ORWDAL32",6,0)
 S LST($$NXT)="~Allergy Types" D ALLGYTYP
"RTN","ORWDAL32",7,0)
 S LST($$NXT)="~Reactions" D ALLGYTYP
"RTN","ORWDAL32",8,0)
 S LST($$NXT)="~Nature of Reaction" D NATREACT
"RTN","ORWDAL32",9,0)
 S LST($$NXT)="~Top Ten" D TOPTEN
"RTN","ORWDAL32",10,0)
 S LST($$NXT)="~Observ/Hist" D OBSHIST
"RTN","ORWDAL32",11,0)
 S LST($$NXT)="~Severity" D SEVERITY
"RTN","ORWDAL32",12,0)
 Q
"RTN","ORWDAL32",13,0)
GMRASITE(ORY)   ;Return GMRA Site Params
"RTN","ORWDAL32",14,0)
 N GMRASITE
"RTN","ORWDAL32",15,0)
 D SITE^GMRAUTL
"RTN","ORWDAL32",16,0)
 S ORY=$G(^GMRD(120.84,GMRASITE,0))
"RTN","ORWDAL32",17,0)
 Q
"RTN","ORWDAL32",18,0)
TOPTEN ;  Get top ten symptoms from Allergy Site Parameters file
"RTN","ORWDAL32",19,0)
 N X0,I,CNT,GMRASITE S I=0,X0="",CNT=0 ;233
"RTN","ORWDAL32",20,0)
 D SITE^GMRAUTL ;233
"RTN","ORWDAL32",21,0)
 F  S I=$O(^GMRD(120.84,GMRASITE,1,I)),CNT=CNT+1 Q:+I=0!(CNT>10)  D  ;233
"RTN","ORWDAL32",22,0)
 . S X0=^GMRD(120.84,GMRASITE,1,I,0) Q:'$D(^GMRD(120.83,X0))  Q:$P(^GMRD(120.83,X0,0),"^")="OTHER REACTION"  ;233 Don't send this entry
"RTN","ORWDAL32",23,0)
 . I $L($T(SCREEN^XTID)) Q:$$SCREEN^XTID(120.83,.01,X0_",")  ;233 Don't send if inactive term
"RTN","ORWDAL32",24,0)
 . S LST($$NXT)="i"_X0_U_$P($G(^GMRD(120.83,X0,0)),U,1)
"RTN","ORWDAL32",25,0)
 Q
"RTN","ORWDAL32",26,0)
ALLSRCH(Y,X) ; Return list of partial matches  ; CHANGED TO PRODUCE TREEVIEW IN GUI
"RTN","ORWDAL32",27,0)
 N ORX,ROOT,XP,CNT,ORFILE,ORSRC,ORIEN,ORREAX S ORIEN=0,CNT=0,ORSRC=0,ORFILE="",ORREAX=""
"RTN","ORWDAL32",28,0)
 S ORX=X,X=$$UP^XLFSTR(X)
"RTN","ORWDAL32",29,0)
 F ROOT="^GMRD(120.82,""B"")","^GMRD(120.82,""D"")",$$B^PSNAPIS,$$T^PSNAPIS,"^PSDRUG(""B"")","^PSDRUG(""C"")","^PS(50.416,""P"")","^PS(50.605,""C"")" D
"RTN","ORWDAL32",30,0)
 . S ORSRC=ORSRC+1,ORFILE=$P(ROOT,",",1)_")",ORSRC(ORSRC)=$P($T(FILENAME+ORSRC),";;",2)
"RTN","ORWDAL32",31,0)
 . I (ORSRC'=2),(ORSRC'=6) S CNT=CNT+1,Y(CNT)=ORSRC_U_ORSRC(ORSRC)_U_U_U_"TOP"_U_"+"
"RTN","ORWDAL32",32,0)
 . I $D(@ROOT@(X)) D
"RTN","ORWDAL32",33,0)
 . . I ORSRC=1,X="OTHER ALLERGY/ADVERSE REACTION" Q  ;don't send this entry
"RTN","ORWDAL32",34,0)
 . . I ORSRC=5!(ORSRC=6) Q  ;233 don't send file 50 entries
"RTN","ORWDAL32",35,0)
 . . S ORIEN=$O(@ROOT@(X,0))
"RTN","ORWDAL32",36,0)
 . . I $L($T(SCREEN^XTID)) I $$SCREEN^XTID($S(ORSRC=1!(ORSRC=2):120.82,ORSRC=3!(ORSRC=4):50.6,ORSRC=7:50.416,ORSRC=8:50.605,1:0),.01,$S(ORSRC=4:$$TGTOG^PSNAPIS(X)_",",1:ORIEN_",")) Q  ;233 Is term active?
"RTN","ORWDAL32",37,0)
 . . I ORSRC=2 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^GMRD(120.82,+ORIEN,0)),U,1)_" <"_X_">"_ROOT
"RTN","ORWDAL32",38,0)
 . . E  I ORSRC=6 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^PSDRUG(+ORIEN,0)),U,1)_" <"_X_">"_ROOT
"RTN","ORWDAL32",39,0)
 . . E  S CNT=CNT+1,Y(CNT)=ORIEN_U_X_ROOT
"RTN","ORWDAL32",40,0)
 . . S ORREAX=$S($P(Y(CNT),U,3)?1"GMR".E:$P($G(^GMRD(120.82,+Y(CNT),0)),U,2),1:"D")
"RTN","ORWDAL32",41,0)
 . . S Y(CNT)=Y(CNT)_U_ORREAX_U_$S(ORSRC=2:1,ORSRC=6:5,1:ORSRC)
"RTN","ORWDAL32",42,0)
 . S XP=X F  S XP=$O(@ROOT@(XP)) Q:XP=""  Q:$E(XP,1,$L(X))'=X  D
"RTN","ORWDAL32",43,0)
 . . I ORSRC=1,XP="OTHER ALLERGY/ADVERSE REACTION" Q  ;don't send this entry
"RTN","ORWDAL32",44,0)
 . . I ORSRC=5!(ORSRC=6) Q  ;233 Don't send file 50 entries
"RTN","ORWDAL32",45,0)
 . . S ORIEN=$O(@ROOT@(XP,0))
"RTN","ORWDAL32",46,0)
 . . I $L($T(SCREEN^XTID)) I $$SCREEN^XTID($S(ORSRC=1!(ORSRC=2):120.82,ORSRC=3!(ORSRC=4):50.6,ORSRC=7:50.416,ORSRC=8:50.605,1:0),.01,$S(ORSRC=4:$$TGTOG^PSNAPIS(XP)_",",1:ORIEN_",")) Q  ;233 Is term active?
"RTN","ORWDAL32",47,0)
 . . I ORSRC=2 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^GMRD(120.82,+ORIEN,0)),U,1)_" <"_XP_">"_ROOT ; partial matches
"RTN","ORWDAL32",48,0)
 . . E  I ORSRC=6 S CNT=CNT+1,Y(CNT)=ORIEN_U_$P($G(^PSDRUG(+ORIEN,0)),U,1)_" <"_XP_">"_ROOT ; partial matches
"RTN","ORWDAL32",49,0)
 . . E  S CNT=CNT+1,Y(CNT)=ORIEN_U_XP_ROOT
"RTN","ORWDAL32",50,0)
 . . S ORREAX=$S($P(Y(CNT),U,3)?1"GMR".E:$P($G(^GMRD(120.82,+Y(CNT),0)),U,2),1:"D")
"RTN","ORWDAL32",51,0)
 . . S Y(CNT)=Y(CNT)_U_ORREAX_U_$S(ORSRC=2:1,ORSRC=6:5,1:ORSRC)
"RTN","ORWDAL32",52,0)
 Q
"RTN","ORWDAL32",53,0)
FILENAME        ; Display text of filenames for search treeview
"RTN","ORWDAL32",54,0)
 ;;VA Allergies File
"RTN","ORWDAL32",55,0)
 ;;VA Allergies File (Synonyms)  SPACER ONLY - NOT DISPLAYED
"RTN","ORWDAL32",56,0)
 ;;National Drug File - Generic Drug Name
"RTN","ORWDAL32",57,0)
 ;;National Drug file - Trade Name
"RTN","ORWDAL32",58,0)
 ;;Local Drug File
"RTN","ORWDAL32",59,0)
 ;;Local Drug File (Synonyms)  SPACER ONLY - NOT DISPLAYED
"RTN","ORWDAL32",60,0)
 ;;Drug Ingredients File
"RTN","ORWDAL32",61,0)
 ;;VA Drug Class File
"RTN","ORWDAL32",62,0)
 ;;
"RTN","ORWDAL32",63,0)
NATREACT ; Get the NATURE OF REACTION types
"RTN","ORWDAL32",64,0)
 ;Removing "R^Adverse Reaction" from choices below until we can add it as a choice in the nature of reaction/mechanism file
"RTN","ORWDAL32",65,0)
 F X="A^Allergy","P^Pharmacological","U^Unknown" D
"RTN","ORWDAL32",66,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",67,0)
 Q
"RTN","ORWDAL32",68,0)
ALLGYTYP ; Get the allergy types
"RTN","ORWDAL32",69,0)
 F X="D^Drug","F^Food","O^Other","DF^Drug,Food","DO^Drug,Other","FO^Food,Other","DFO^Drug,Food,Other" D
"RTN","ORWDAL32",70,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",71,0)
 Q
"RTN","ORWDAL32",72,0)
OBSHIST ; Observed or historical
"RTN","ORWDAL32",73,0)
 F X="o^Observed","h^Historical" D
"RTN","ORWDAL32",74,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",75,0)
 Q
"RTN","ORWDAL32",76,0)
SEVERITY ; Severity
"RTN","ORWDAL32",77,0)
 F X="3^Severe","2^Moderate","1^Mild" D
"RTN","ORWDAL32",78,0)
 . S LST($$NXT)="i"_X
"RTN","ORWDAL32",79,0)
 Q
"RTN","ORWDAL32",80,0)
SYMPTOMS(Y,FROM,DIR) ; Return a subset of symptoms
"RTN","ORWDAL32",81,0)
 ; .Return Array, Starting Text, Direction
"RTN","ORWDAL32",82,0)
 N I,IEN,CNT,X,NAME,SUB S I=0,CNT=44 ;233
"RTN","ORWDAL32",83,0)
 K ^TMP($J,"SIGNS") ;233
"RTN","ORWDAL32",84,0)
 ;The following lines were added in 233.  Now accounts for synonyms
"RTN","ORWDAL32",85,0)
 M ^TMP($J,"SIGNS","B")=^GMRD(120.83,"B") ;233
"RTN","ORWDAL32",86,0)
 S SYN="" F  S SYN=$O(^GMRD(120.83,"D",SYN)) Q:SYN=""  S SUB=0 F  S SUB=$O(^GMRD(120.83,"D",SYN,SUB)) Q:'+SUB  D  ;233
"RTN","ORWDAL32",87,0)
 .S NAME=$P(^GMRD(120.83,SUB,0),U) S ^TMP($J,"SIGNS","B",(SYN_$C(9)_"<"_NAME_">"_U_NAME),SUB)="" ;233
"RTN","ORWDAL32",88,0)
 F  Q:I'<CNT  S FROM=$O(^TMP($J,"SIGNS","B",FROM),DIR) Q:FROM=""  D  ;233
"RTN","ORWDAL32",89,0)
 . I FROM="OTHER REACTION" Q  ;Don't send this entry
"RTN","ORWDAL32",90,0)
 . S IEN=0 F  S IEN=$O(^TMP($J,"SIGNS","B",FROM,IEN)) Q:'IEN  D  ;233
"RTN","ORWDAL32",91,0)
 . . I $L($T(SCREEN^XTID)) I $$SCREEN^XTID(120.83,.01,IEN_",") Q  ;233 Is term active
"RTN","ORWDAL32",92,0)
 . . S I=I+1
"RTN","ORWDAL32",93,0)
 . . S Y(I)=IEN_U_FROM
"RTN","ORWDAL32",94,0)
 Q
"RTN","ORWDAL32",95,0)
NXT() ; Increment index of LST
"RTN","ORWDAL32",96,0)
 S ILST=ILST+1
"RTN","ORWDAL32",97,0)
 Q ILST
"RTN","ORWDAL32",98,0)
EDITLOAD(Y,ORALIEN)     ; Load an allergy/adverse reaction for editing
"RTN","ORWDAL32",99,0)
 Q:+$G(ORALIEN)=0
"RTN","ORWDAL32",100,0)
 N ORNODE,I
"RTN","ORWDAL32",101,0)
 S ORNODE=$NAME(^TMP("GMRA",$J)),I=0
"RTN","ORWDAL32",102,0)
 ;following patch check is made via GUI RPC call to ORWU PATCH instead
"RTN","ORWDAL32",103,0)
 ;I '$$PATCH^XPDUTL("GMRA*4.0*21") S @ORNODE@(0)="-1^Not yet implemented",Y=ORNODE Q
"RTN","ORWDAL32",104,0)
 D GETREC^GMRAGUI(ORALIEN,ORNODE)
"RTN","ORWDAL32",105,0)
 S Y=ORNODE
"RTN","ORWDAL32",106,0)
 Q
"RTN","ORWDAL32",107,0)
EDITSAVE(ORY,ORALIEN,ORDFN,OREDITED)      ; Save Edit/Add of an allergy/adverse reaction
"RTN","ORWDAL32",108,0)
 ;following patch check is made via GUI RPC call to ORWU PATCH instead
"RTN","ORWDAL32",109,0)
 ;I '$$PATCH^XPDUTL("GMRA*4.0*21") S Y="-1^Not yet implemented" Q
"RTN","ORWDAL32",110,0)
 N ORNODE
"RTN","ORWDAL32",111,0)
 S ORNODE=$NAME(^TMP("GMRA",$J))
"RTN","ORWDAL32",112,0)
 K @ORNODE M @ORNODE=OREDITED
"RTN","ORWDAL32",113,0)
 S ORY=0
"RTN","ORWDAL32",114,0)
 I $G(@ORNODE@("GMRAERR"))="YES" D EIE^GMRAGUI1(ORALIEN,ORDFN,ORNODE) Q  ;Handle entered in error
"RTN","ORWDAL32",115,0)
 I $G(@ORNODE@("GMRANKA"))="YES" D NKA^GMRAGUI1 Q
"RTN","ORWDAL32",116,0)
 D UPDATE^GMRAGUI1(ORALIEN,ORDFN,ORNODE) Q  ;Add/edit reactions
"RTN","ORWDAL32",117,0)
 Q
"RTN","ORWDAL32",118,0)
SENDBULL(Y,ORDUZ,ORDFN,ORTEXT,ORCMTS)      ; Send bulletin if user attempts free-text entry
"RTN","ORWDAL32",119,0)
 I '$D(ORCMTS) D
"RTN","ORWDAL32",120,0)
 . S Y=$$SENDREQ^GMRAPES0(ORDUZ,ORDFN,ORTEXT)
"RTN","ORWDAL32",121,0)
 E  D
"RTN","ORWDAL32",122,0)
 . S Y=$$SENDREQ^GMRAPES0(ORDUZ,ORDFN,ORTEXT,.ORCMTS)
"RTN","ORWDAL32",123,0)
 Q
"VER")
8.0^22.0
"BLD",5632,6)
^SEQ #217
**END**
**END**
