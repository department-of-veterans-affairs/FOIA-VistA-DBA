
=============================================================================
Run Date: JUL 30, 2004                     Designation: EAS*1*42
Package : EAS - ENROLLMENT APPLICATION SYSTEM Priority: Mandatory
Version : 1        SEQ #43                      Status: Released
                  Compliance Date: AUG 11, 2004
=============================================================================

Associated patches: (v)EAS*1*35    <<= must be installed BEFORE `EAS*1*42'
                    (v)EAS*1*47    <<= must be installed BEFORE `EAS*1*42'
                    (v)EAS*1*52    <<= must be installed BEFORE `EAS*1*42'

Subject: RX Copay Upload Enhancement for IVM

Category: 
  - Routine
  - Enhancement (Mandatory)

Description:
============

 ******************************* N O T E *********************************
 There is no conflict between this patch and the {package}-CoreFLS 
 software. Installation of this patch by the CoreFLS sites will not cause 
 any problems.
  
 This patch is being released with a shortened compliance date of 
 August 11, 2004 due to potential incorrect exemptions.  If necessary, 
 this patch may be installed out of patch sequence order.
 *************************************************************************
  
 This patch (IVM*2.0*99) is an enhancement to the Income Verification 
 process of evaluating and converting veterans Income Tests. It will 
 allow IVM to correctly set the medication copay required status.
  
 Existing functionality allows the Income Verification staff to convert a 
 veteran's means test to either a MT or GMT copay required status. This can
 potentially result in an incorrect Medication Copay Exemption status.  The
 enhancement will also allow Income Verification to convert a RX copay test
 to a status of non-exempt.  Unlike Income Verification means test
 conversions that allow back-billing to occur, conversion of a RX copay 
 test to a non-exempt status will not trigger any back-billing of 
 prescriptions.  Rather, any prescriptions entered on or after the date the
 RX Copay Income Verification Converted test is received will be liable
 for copayments.
  
  
 IVM Case is closed/converted RX Copay Required and received on VistA:
  
 VistA will try to match the incoming IVM RX Copay test to an existing 
 test.  If a match is NOT found, then this test will be added to the 
 ANNUAL MEANS TEST file (#408.31) with a status of non-exempt and will 
 become primary for the income year.  If a match is found, this test 
 will be added to the ANNUAL MEANS TEST file (#408.31) with a status of 
 non-exempt and become primary for the income year.  The existing RX 
 Copay test will become non-primary.  Integrated Billing will be 
 updated with the new RX Copay test status.   Existing bulletins will 
 be triggered to note that a new RX Copay test has been uploaded.
  
 Previous IVM Converted RX Copay Test is deleted:
  
 When the Income Verification staff reopen an IVM case that was converted
 to RX Copay Required and then subsequently converted to a status such 
 that the veteran is exempt from medication copayments, a Z06 will be 
 sent.  VistA will try to match the "Delete Z06" to an existing IVM 
 RX Copay test.   If a match is NOT found, an Application Error (AE)
 will be returned to the EDB stating test not found.  If a match is found,
 the existing IVM converted RX test will be deleted and the previous RX 
 copay test for the income year will become primary.  Integrated Billing
 will be notified that the veteran's RX copay status has changed to exempt.
 Existing bulletins will be triggered to note that the RX Copay Test has 
 been deleted.
  
 Bulletins will be sent to the "Means Test Billing Mail Group (#.11) as
 specified in the IB SITE PARAMTERS File (#350.9)" and to the "IVM
 Messages Mail Group (#.02) in the IVM SITE PARAMETER File (#301.9)".
  
  
 SOFTWARE AND DOCUMENTATION RETRIEVAL
 ====================================
 The software for this patch is being distributed in a host file.  The host
 file will contain four KIDS builds.
  
   Host file name:  EAS_1_42.KID
           Builds:  EAS*1.0*42
                    IB*2.0*269
                    IVM*2.0*99
                    DG*5.3*612
  
 Sites may retrieve the software directly using FTP from the
 ANONYMOUS.SOFTWARE directory at the following OI Field Offices:
  
           Albany:  ftp.fo-albany.med.va.gov
            Hines:  ftp.fo-hines.med.va.gov
   Salt Lake City:  ftp.fo-slc.med.va.gov
  
  
 The following documentation will be available:
    
      File Name                 Description
      ---------                 -----------
      IVM_2_P42_TM.PDF          Revised IVM V. 2.0 Technical Manual
       
  
     * Note: Use ASCII mode when transferring the .KID file.
             Use Binary mode when transferring the .PDF file.  The .PDF 
             files can be read on a PC using the Adobe Acrobat Reader 
             program.
             The VistA Documentation Library [VDL] contains all end-user 
             manuals..
  
  
 This patch addresses the following E3R(s):
 ------------------------------------------
 There are no E3Rs associated with this patch
  
  
 This patch addresses the following NOIS message(s):
 ---------------------------------------------------
 MAD-0503-40314 - Update from EDB not updating RX Copay
 HUN-0703-20670 - EDB (IVM) Upload not Updating RX Copay
 MAD-0903-40014 -  Change from Exempt to Required
  
  
 Test sites:
 -----------
 Columbus OPC
 Battle Creek
 Madison
 Chillicothe
 Dublin
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 This patch can be installed with users on the system. Installation will 
 take less than 15 minutes.  To avoid conflicts the following menu options 
 should be disabled prior to installing this patch:
  
  [IVM BACKGROUND JOB]            IVM BACKGROUND JOB
  
 1.  DOWNLOAD HOST KIDS FILE
     -----------------------
     Download the KIDS file EAS_1_42.KID from the ANONYMOUS.SOFTWARE
     directory of either Albany, Hines, or the Salt Lake CIOFO to the
     appropriate directory on your system.
  
 2.  LOAD DISTRIBUTION
     -----------------
     Use the 'LOAD A DISTRIBUTION' option on the KIDS INSTALLATION
     menu, and enter:  EAS_1_42.KID
  
 3.  DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only)
     -----------------------
     Disable routine mapping on all systems for the routines listed in    
     the step below.
  
        NOTE:  If the routines included in this patch are not currently in
               your mapped routine set, please skip this step.
  
 4.  COMPONENTS SENT WITH PATCH
     --------------------------
  
 ROUTINE SUMMARY:
 ================
  The following is a list of the routine(s) included in this patch.  The
  second line of each of these routine(s) will look like:
  
      <tab>;;1.0;ENROLLMENT APPLICATION SYSTEM;**[patch list]**;21-OCT-94
  
                             CHECK^XTSUMBLD results
  Routine name      Before Patch          After Patch         Patch List
  ============      ============          ===========         ==========
  EASPREC7              15075877             12846502       23,30,35,52,42
  EASPTRN1               5007778              5585873         30,33,47,42
  EASUM1                 6486353              7635930         23,30,35,42
  EASUM7                     N/A              7591830             42
  EASUM8                     N/A              3588009             42
  
       Total number of routines:  5
                   New routines:  2
              Modified routines:  3
  
 5.  START UP KIDS
     -------------
     Start up the Kernel Installation and Distribution System Menu
     [XPD MAIN]:
  
           Edits and Distribution ...
           Utilities ...
           Installation ...
     
     Select Kernel Installation & Distribution System Option: INStallation
                                                              ---
           Load a Distribution
           Print Transport Global
           Compare Transport Global to Current System
           Verify Checksums in Transport Global
           Install Package(s)
           Restart Install of Package(s)
           Unload a Distribution
           Backup a Transport Global
  
     Select Installation Option:
  
 6.  Select Installation Option:
     --------------------------
     NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
            NAME, enter EAS*1.0*42):
  
     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with this patch and the
         associated patch of IB*2.0*269, IVM*2.0*99, and DG*5.3*612.
         It will not backup any other changes such as DD's or templates.
     b.  Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when this patch
         is installed.  It compares all components of this patch
         (routines, DD's, templates, etc.).
     c.  Verify Checksums in Transport Global - This option will allow
         you to ensure the integrity of the routines that are in the
         transport global.
  
 7.  Select Installation Option: Install Package(s)
                                 ----------------
      **This is the step to start the installation of this KIDS patch:
  
      NOTE:  If the required patches are not installed, the transport 
      Global will be removed, and step #2 LOAD DISTRIBUTION  will need 
      to be repeated.
  
      a. Choose the Install Package(s) option to start the patch install.
      b. When prompted 'Want KIDS to INHIBIT LOGONs during the install?
         YES//' answer NO (unless otherwise indicated)
      c. When prompted 'Want to DISABLE Scheduled Options, Menu Options,
         and Protocols? YES//' answer YES  (unless otherwise indicated)
      d. When prompted 'Enter options you wish to mark as 'Out Of
          Order':'  Enter the following options:
  
  [IVM BACKGROUND JOB]            IVM BACKGROUND JOB
  
      e.  When prompted 'Enter protocols you wish to mark as 'Out Of
          Order':' press <return>.
  
   8.  REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
       -------------------------
       Optional - Include the routines distributed with this patch
       in the mapped routine set.
  
       NOTE: This step is only necessary if you performed step 3 or
             if you wish to include the routines in your mapped set.

Routine Information:
====================

Routine Name:
  - EASPREC7

 This routine is the Z06 Receiver and was modified to be able to handle a
 Pharmacy Copay (type 2) converted income test from the EDB.
  
 Code changes consist of removing the hard coding to type of test = 1 and
 passing type of test via a variable (DGMTYPT) which can contain either a 1
 or 2 for MT or RXCT.  The tag MTBULL for processing bulletins was moved
 out of this routine and relocated in a new routine of EASUM8. Many
 comments were changed to reflect both MT & RXCT.
  
 The tag PARSEZMT was modified to define its variables from the passed in
 value rather than use a reference to another variable that may contain an
 old value for the ZMT segment data.  Also tag ZMT now calls PARSEZMT
 immediately and uses the values defined by PARSEZMT.  This prevents an
 undefined that would occasionally happen.

Routine Checksum:

Routine Name:
  - EASPTRN1

 This routine was modified in tag EXPIRED to also check Pharmacy Copay 
 tests for a previous test to be expired.
  
 *** Before ***
  94    ;Check for expired MT
  95    ;
  96 EXPIRED(DFN,DGMTDT)     N CMT,PMT
  97    S PMT=$$LST^DGMTU(DFN,DGMTDT)       ;Retrieve MT associated w/MT
  98    I PMT="" Q 0
  99    S CMT=$$LST^DGMTU(DFN)              ;Retrieve Current MT
 100    I $P(PMT,"^",2)<$P(CMT,"^",2) Q 1   ;Previous Year - Expired MT
 101    Q 0
  
 *** After ***
  95    ;Check for expired MT or CT                    ;EAS*1*42
  96    ;
  97  EXPIRED(DFN,DGMTDT)     N CMT,PMT,CCT,PCT
  98    S (CMT,PMT,CCT,PCT)=""
  99    S:DGMTYPT=2 PCT=$$LST^DGMTU(DFN,DGMTDT,2)     ;Retrieve previous CT
 100    S PMT=$$LST^DGMTU(DFN,DGMTDT,1)               ;Retrieve previous MT
 101    I PCT="",PMT="" Q 0
 102    S:DGMTYPT=2 CCT=$$LST^DGMTU(DFN,DT,2)         ;Retrieve current CT
 103    S CMT=$$LST^DGMTU(DFN,DT,1)                   ;Retrieve current MT
 104    ;check for any expired test
 105    I DGMTYPT=2,$P(PCT,"^",2)<$P(CCT,"^",2) Q 1   ;Prev Yr CT is Expire
 106    I $P(PMT,"^",2)<$P(CMT,"^",2) Q 1             ;Prev Yr MT is Expire
 107    Q 0

Routine Checksum:

Routine Name:
  - EASUM1

 This routine was modified to use the variable DGMTYPT instead of the hard
 coded value of 1.  Also added this variable to the cleanup list.
  
 *** Before ***
  47   ;         DGMTYPT (.19) type of test (1-means test)
  48   ; output  DGMTI annual means test IEN
  49   S DGMTDT=IVMMTDT,DGMTYPT=1
  50   D ADD^DGMTA
  
 *** After ***
  49   ;         DGMTYPT (.19) type of test (1-means test, 2-Rx Copay test)
  50   ; output  DGMTI annual means test IEN
  51   S DGMTDT=IVMMTDT                 ;stop setting DGMTYPT here
  52   D ADD^DGMTA
  
  
 *** Before ***
  60   D ^DIE K DA,DIE,DR
  61   ;
  
 *** After ***
  62   ;
  63   ; Linking logic for MT & CT, conditionally set link field 2.06
  64   ;   Link the CT to MT (if MT found), or MT to CT (if CT found)
  65   ;   don't link tests older than Oct. 1999 or not same Year & NOT
  66   ;    Cat "C" (i.e. Cat "C" & > Oct. 1999 is ok to link)
  67   N LNKDAT,LNKMT,LNKDTE,LNKCAT,CURIEN
  68   S CURIEN=DGMTI,LNKMT=""
  69   S LNKDAT=$$LST^DGMTU(DFN,DGMTDT,$S(DGMTYPT=1:2,1:1)),DGMTI=CURIEN
  70   S:LNKDAT LNKMT=+LNKDAT,LNKDTE=$P(LNKDAT,"^",2),LNKCAT=$P(LNKDAT,
 "^",4)
  7    ; set LNKMT off if either of two scenarios below
  72   I LNKMT D                                 ;check for < Oct. 1999 1st
  73   . I DGMTDT<2991001 S LNKMT="" Q
  74   . I $E(LNKDTE,1,3)'=$E(DGMTDT,1,3),LNKCAT'="C" S LNKMT="" Q
  75   S:LNKMT DR=DR_";2.06////^S X=LNKMT"
  76   ;
  77   D ^DIE K DA,DIE,DR                        ;update new 408.31 test
  78   ;
  79   ; Update other 408.31 related Test, Link field, if link scenario
 true
  80   I LNKMT S DA=LNKMT,DIE="^DGMT(408.31,",DR="2.06////^S X=CURIEN" D
 ^DIE
  81   ;                                          
  
  
  
 *** Before ***
 148   D MTBULL^EASPREC7,MAIL^IVMUFNC()               ;Build Mail Message
 149   ;
 150   ; cleanup
 151   K DGINI,DGIRI,DGLY,DGMTDT,DGMTYPT,DGPRI,DGREL,DGVINI,DGVIRI,DGENUPLD
 152   K DGCAT,IVMAR,IVMCEB,IVMCTR2,IVMCTR3,IVMDA1,IVMDAP,IVMFERR
  
 *** After ***
 164   D MTBULL^EASUM7,MAIL^IVMUFNC()               ;Build Mail Message
 165   ;
 166   ; cleanup                                  ;EAS*1*42 remove Dgmtypt
 167   K DGINI,DGIRI,DGLY,DGMTDT,DGPRI,DGREL,DGVINI,DGVIRI,DGENUPLD
 168   K DGCAT,IVMAR,IVMCEB,IVMCTR2,IVMCTR3,IVMDA1,IVMDAP,IVMFERR

Routine Checksum:

Routine Name:
  - EASUM7

 This routine was added and patterned after IVMUM7.  It handles the Delete 
 of an IVM MT or RXCT and also calls a new routine EASUM8 to continue the 
 delete process.  It also, sends the proper text in the bulletin.

Routine Checksum:

Routine Name:
  - EASUM8

 This routine was added to complete the call from the new routine EASUM7 
 and now contains the MTBULL tag from EASPREC7.  The tag was changed to
 create the proper text based on whether it was deleting a MT or RXCT test.

Routine Checksum:

=============================================================================
User Information:
Entered By  : HUA,PATRICK                   Date Entered  : NOV 04, 2003
Completed By: MULLER,RICHARD                Date Completed: JUL 30, 2004
Released By : GROOMS,ANTHONY E              Date Released : JUL 30, 2004
=============================================================================


Packman Mail Message:
=====================

No routines included
