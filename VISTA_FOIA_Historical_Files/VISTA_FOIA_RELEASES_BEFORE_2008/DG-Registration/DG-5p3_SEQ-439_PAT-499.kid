Released DG*5.3*499 SEQ #439
Extracted from mail message
**KIDS**:DG*5.3*499^

**INSTALL NAME**
DG*5.3*499
"BLD",4471,0)
DG*5.3*499^REGISTRATION^0^3030305^y
"BLD",4471,1,0)
^^1^1^3030220^
"BLD",4471,1,1,0)
Fix undefined error from DGBT BENE TRAVEL SCREEN (Claim Enter/Edit).
"BLD",4471,4,0)
^9.64PA^^
"BLD",4471,"KRN",0)
^9.67PA^8989.52^19
"BLD",4471,"KRN",.4,0)
.4
"BLD",4471,"KRN",.401,0)
.401
"BLD",4471,"KRN",.402,0)
.402
"BLD",4471,"KRN",.403,0)
.403
"BLD",4471,"KRN",.5,0)
.5
"BLD",4471,"KRN",.84,0)
.84
"BLD",4471,"KRN",3.6,0)
3.6
"BLD",4471,"KRN",3.8,0)
3.8
"BLD",4471,"KRN",9.2,0)
9.2
"BLD",4471,"KRN",9.8,0)
9.8
"BLD",4471,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4471,"KRN",9.8,"NM",1,0)
VAFMON^^0^B12936460
"BLD",4471,"KRN",9.8,"NM",2,0)
DGMTU3^^0^B7022690
"BLD",4471,"KRN",9.8,"NM","B","DGMTU3",2)

"BLD",4471,"KRN",9.8,"NM","B","VAFMON",1)

"BLD",4471,"KRN",19,0)
19
"BLD",4471,"KRN",19,"NM",0)
^9.68A^^
"BLD",4471,"KRN",19.1,0)
19.1
"BLD",4471,"KRN",101,0)
101
"BLD",4471,"KRN",409.61,0)
409.61
"BLD",4471,"KRN",771,0)
771
"BLD",4471,"KRN",870,0)
870
"BLD",4471,"KRN",8989.51,0)
8989.51
"BLD",4471,"KRN",8989.52,0)
8989.52
"BLD",4471,"KRN",8994,0)
8994
"BLD",4471,"KRN","B",.4,.4)

"BLD",4471,"KRN","B",.401,.401)

"BLD",4471,"KRN","B",.402,.402)

"BLD",4471,"KRN","B",.403,.403)

"BLD",4471,"KRN","B",.5,.5)

"BLD",4471,"KRN","B",.84,.84)

"BLD",4471,"KRN","B",3.6,3.6)

"BLD",4471,"KRN","B",3.8,3.8)

"BLD",4471,"KRN","B",9.2,9.2)

"BLD",4471,"KRN","B",9.8,9.8)

"BLD",4471,"KRN","B",19,19)

"BLD",4471,"KRN","B",19.1,19.1)

"BLD",4471,"KRN","B",101,101)

"BLD",4471,"KRN","B",409.61,409.61)

"BLD",4471,"KRN","B",771,771)

"BLD",4471,"KRN","B",870,870)

"BLD",4471,"KRN","B",8989.51,8989.51)

"BLD",4471,"KRN","B",8989.52,8989.52)

"BLD",4471,"KRN","B",8994,8994)

"BLD",4471,"QUES",0)
^9.62^^
"BLD",4471,"REQB",0)
^9.611^1^1
"BLD",4471,"REQB",1,0)
DG*5.3*433^1
"BLD",4471,"REQB","B","DG*5.3*433",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
499^3030305
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3030305
"PKG",5,22,1,"PAH",1,1,1,0)
Fix undefined error from DGBT BENE TRAVEL SCREEN (Claim Enter/Edit).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DGMTU3")
0^2^B7022690
"RTN","DGMTU3",1,0)
DGMTU3 ;ALB/MLI/GN - Internal Entry Number Utility Calls ; 2/20/03 8:45am
"RTN","DGMTU3",2,0)
 ;;5.3;Registration;**33,45,137,182,300,433,499**;Aug 13, 1993
"RTN","DGMTU3",3,0)
 ;
"RTN","DGMTU3",4,0)
 ; This routine will return the IENs for the primary income
"RTN","DGMTU3",5,0)
 ; test from various files.
"RTN","DGMTU3",6,0)
 ;
"RTN","DGMTU3",7,0)
MTIEN(TYPE,DFN,INVDT) ; get last primary income test for date
"RTN","DGMTU3",8,0)
 ;
"RTN","DGMTU3",9,0)
 ; Input  -- TYPE as 1 for means test, 2 for copay test
"RTN","DGMTU3",10,0)
 ;           DFN as Patient IEN
"RTN","DGMTU3",11,0)
 ;           INVDT as inverse date for search
"RTN","DGMTU3",12,0)
 ; Output -- Record IEN
"RTN","DGMTU3",13,0)
 ;
"RTN","DGMTU3",14,0)
 N I
"RTN","DGMTU3",15,0)
 F I=0:0 S I=$O(^DGMT(408.31,"AID",TYPE,DFN,INVDT,I)) Q:'I  I +$G(^DGMT(408.31,I,"PRIM")) Q
"RTN","DGMTU3",16,0)
 Q I
"RTN","DGMTU3",17,0)
 ;
"RTN","DGMTU3",18,0)
 ;
"RTN","DGMTU3",19,0)
IAI(REL,YEAR,DGMTYPT) ; get individual annual income IEN for primary income test/pt relation
"RTN","DGMTU3",20,0)
 ;
"RTN","DGMTU3",21,0)
 ; Input  -- REL as IEN of PATIENT RELATION file
"RTN","DGMTU3",22,0)
 ;           YEAR as income year in question
"RTN","DGMTU3",23,0)
 ;           DGMTYPT as type of test (optional if not defined means test
"RTN","DGMTU3",24,0)
 ;                   will be assumed)
"RTN","DGMTU3",25,0)
 ; Output -- Record IEN
"RTN","DGMTU3",26,0)
 ;
"RTN","DGMTU3",27,0)
 N DFN,I,IEN,INR,MTIEN,LAST,DGDT
"RTN","DGMTU3",28,0)
 S DFN=+$G(^DGPR(408.12,+REL,0)) I 'DFN G IAIQ
"RTN","DGMTU3",29,0)
 ;
"RTN","DGMTU3",30,0)
 ;DG*5.3*499, change to if structure and check for presence of DGMTI
"RTN","DGMTU3",31,0)
 ; it is not defined when coming from Bene travel menus
"RTN","DGMTU3",32,0)
 ;
"RTN","DGMTU3",33,0)
 ; if user selects view option & DGMTI exists, set IEN=DGMTI
"RTN","DGMTU3",34,0)
 I $G(DGMTACT)="VEW",$G(DGMTI) D
"RTN","DGMTU3",35,0)
 . S MTIEN=DGMTI
"RTN","DGMTU3",36,0)
 E  D
"RTN","DGMTU3",37,0)
 . S DGDT=$E(YEAR,1,3)+1_"1231.99"
"RTN","DGMTU3",38,0)
 . S MTIEN=$$LST^DGMTU(DFN,DGDT,$S($G(DGMTYPT):DGMTYPT,1:1))
"RTN","DGMTU3",39,0)
 ;
"RTN","DGMTU3",40,0)
 I MTIEN S LAST=0 D
"RTN","DGMTU3",41,0)
 . F I=0:0 S I=$O(^DGMT(408.21,"AI",+REL,-YEAR,I)) Q:'I  S LAST=I,INR=$O(^DGMT(408.22,"AIND",I,"")) I +$G(^DGMT(408.22,+INR,"MT"))=+MTIEN Q
"RTN","DGMTU3",42,0)
 . S IEN=LAST
"RTN","DGMTU3",43,0)
 . ; The following was added for LTC Copay Phase II (DG*5.3*433)
"RTN","DGMTU3",44,0)
 . ; If the IAI record is associated with a LTC Copay Test (type 3),
"RTN","DGMTU3",45,0)
 . ; don't return it if DGMTYPT is not type 3.
"RTN","DGMTU3",46,0)
 . Q:'$G(^DGMT(408.21,IEN,"MT"))
"RTN","DGMTU3",47,0)
 . I $P($G(^DGMT(408.31,+^DGMT(408.21,IEN,"MT"),0)),U,19)=3,$G(DGMTYPT)'=3 S IEN=""
"RTN","DGMTU3",48,0)
 ; if veteran doesn't have a mt
"RTN","DGMTU3",49,0)
 I 'MTIEN D
"RTN","DGMTU3",50,0)
 . ; The following was added for LTC Copay Phase II (DG*5.3*433)
"RTN","DGMTU3",51,0)
 . ; If the IAI record is associated with a LTC Copay Test (type 3),
"RTN","DGMTU3",52,0)
 . ; don't return it if DGMTYPT is not type 3.
"RTN","DGMTU3",53,0)
 . S IEN="" F I=0:0 S I=$O(^DGMT(408.21,"AI",+REL,-YEAR,I)) Q:'I  S IEN=I Q:'$G(^DGMT(408.21,IEN,"MT"))  D  Q:IEN
"RTN","DGMTU3",54,0)
 .. I $P($G(^DGMT(408.31,+^DGMT(408.21,IEN,"MT"),0)),U,19)=3,$G(DGMTYPT)'=3 S IEN=""
"RTN","DGMTU3",55,0)
IAIQ Q $G(IEN)
"RTN","DGMTU3",56,0)
 ;
"RTN","DGMTU3",57,0)
 ;
"RTN","DGMTU3",58,0)
MTIENLT(TYPE,DFN,INVDTL) ; get last primary income test on or before date
"RTN","DGMTU3",59,0)
 ;
"RTN","DGMTU3",60,0)
 ; Input  -- TYPE as 1 for means test, 2 for copay test
"RTN","DGMTU3",61,0)
 ;           DFN as Patient IEN
"RTN","DGMTU3",62,0)
 ;           INVDTL as inverse date for search
"RTN","DGMTU3",63,0)
 ; Output -- Record IEN
"RTN","DGMTU3",64,0)
 ;
"RTN","DGMTU3",65,0)
 N K
"RTN","DGMTU3",66,0)
 S K=""
"RTN","DGMTU3",67,0)
 F  S INVDTL=$O(^DGMT(408.31,"AID",TYPE,DFN,INVDTL)) Q:'INVDTL  S K=$$MTIEN(TYPE,DFN,INVDTL) Q:K
"RTN","DGMTU3",68,0)
 Q K
"RTN","VAFMON")
0^1^B12936460
"RTN","VAFMON",1,0)
VAFMON ;ALB/CAW/GN - Returns income/dependents ; 2/19/03 3:35pm
"RTN","VAFMON",2,0)
 ;;5.3;Registration;**45,67,499**;Aug 13, 1993
"RTN","VAFMON",3,0)
 ;
"RTN","VAFMON",4,0)
INCOME(DFN,VADT,VASOURCE) ; 
"RTN","VAFMON",5,0)
 ;  Returns Income (veterans+spouse+dependents)
"RTN","VAFMON",6,0)
 ;      First from the means test
"RTN","VAFMON",7,0)
 ;        (Income+Net Worth-Deductible Expenses)
"RTN","VAFMON",8,0)
 ;      If no means test then co-pay test
"RTN","VAFMON",9,0)
 ;        (Income-Deductible Expenses)
"RTN","VAFMON",10,0)
 ;      If no co-pay test then income screening
"RTN","VAFMON",11,0)
 ;        (Income)
"RTN","VAFMON",12,0)
 ;      If none of the above then total VA check amount
"RTN","VAFMON",13,0)
 ;
"RTN","VAFMON",14,0)
 ;      INPUT:  DFN = Patient IEN
"RTN","VAFMON",15,0)
 ;             VADT = Date income calculated for
"RTN","VAFMON",16,0)
 ;         VASOURCE = [optional] income type requested
"RTN","VAFMON",17,0)
 ;                    1 = returns income (veteran,spouse,children)
"RTN","VAFMON",18,0)
 ;                        minus deductibe expenses - this excludes net worth 
"RTN","VAFMON",19,0)
 ;     OUTPUT: VAINCM = Income^source flag 
"RTN","VAFMON",20,0)
 ;                        (2nd piece is only used when VASOURCE is used and is equal to 1)
"RTN","VAFMON",21,0)
 ;
"RTN","VAFMON",22,0)
 N I,VAINCM,VAMT,DGREL,DGINR,DGINC,DGDEP,VAX,X
"RTN","VAFMON",23,0)
 I '$D(VADT) S VAINCM="" G INCQ
"RTN","VAFMON",24,0)
 S VAINCM="",VADT=$P(VADT,".")
"RTN","VAFMON",25,0)
 S VAMT=$$LST^DGMTCOU1(DFN,VADT,3)
"RTN","VAFMON",26,0)
 I VAMT,$P(VAMT,U,4)'="N",$P(VAMT,U,4)'="L" S X=$G(^DGMT(408.31,+VAMT,0)) S:$L($P(X,U,4))!$L($P(X,U,15)) VAINCM=$P(X,U,4)-$P(X,U,15) D
"RTN","VAFMON",27,0)
 .I $G(VASOURCE)'=1,$L($P(X,U,5)) S VAINCM=VAINCM+$P(X,U,5) Q  ; includes net worth
"RTN","VAFMON",28,0)
 .I VAINCM]"" S VAINCM=VAINCM_$S($P(VAMT,U,5)=1:"^M",1:"^C") ;bt source flag
"RTN","VAFMON",29,0)
 I VAINCM']"" D
"RTN","VAFMON",30,0)
 .N VADX S VADX=$S($G(VASOURCE)=1:"C",1:"D")
"RTN","VAFMON",31,0)
 .;    DG*5.3*499 pass ien of Means/Co-pay test via 5th parameter
"RTN","VAFMON",32,0)
 .D ALL^DGMTU21(DFN,"VS"_VADX,VADT,"I",+VAMT)
"RTN","VAFMON",33,0)
 .S VAX=$G(^DGMT(408.21,+$G(DGINC("V")),0)) I VAX]"" F I=8:1:17 S:$L($P(VAX,"^",I)) VAINCM=VAINCM+$P(VAX,"^",I)
"RTN","VAFMON",34,0)
 .S VAX=$G(^DGMT(408.21,+$G(DGINC("S")),0)) I VAX]"" F I=8:1:17 S:$L($P(VAX,"^",I)) VAINCM=VAINCM+$P(VAX,"^",I)
"RTN","VAFMON",35,0)
 .S VACNT=0 F  S VACNT=$O(DGINC(VADX,VACNT)) Q:'VACNT  S VAX=$G(^DGMT(408.21,+$G(DGINC(VADX,VACNT)),0)) I VAX]"" F I=8:1:17 S:$L($P(VAX,"^",I)) VAINCM=VAINCM+$P(VAX,"^",I)
"RTN","VAFMON",36,0)
 .I $G(VASOURCE)=1,VAINCM]"" S VAINCM=VAINCM_"^I"
"RTN","VAFMON",37,0)
 I VAINCM']"" S VAINCM=$P($G(^DPT(DFN,.362)),U,20) I $G(VASOURCE)=1,VAINCM]"" S VAINCM=VAINCM_"^V"
"RTN","VAFMON",38,0)
 ;
"RTN","VAFMON",39,0)
INCQ Q VAINCM
"RTN","VAFMON",40,0)
 ;
"RTN","VAFMON",41,0)
DEP(DFN,VADT) ;Total dependents for a patient
"RTN","VAFMON",42,0)
 ;Input:      DFN  = Internal Entry Number of Patient file
"RTN","VAFMON",43,0)
 ;            VADT = Date (Optional - default today)
"RTN","VAFMON",44,0)
 ;Output      Number of dependents
"RTN","VAFMON",45,0)
 N VAMT,VAMTDEP,VAVIR0,VAVIRI,DGDEP,DGINR,DGREL,VADEP
"RTN","VAFMON",46,0)
 I 'VADT S VADT=DT
"RTN","VAFMON",47,0)
 S VADEP=""
"RTN","VAFMON",48,0)
 S VAMT=$$LST^DGMTCOU1(DFN,VADT,3)
"RTN","VAFMON",49,0)
 I VAMT,$P(VAMT,U,4)'="N",$P(VAMT,U,4)'="L",$D(^DGMT(408.31,+VAMT,0)) S VADEP=$P(^(0),U,18)
"RTN","VAFMON",50,0)
 I VADEP']"" D  I VADEP]"" G DEPQ
"RTN","VAFMON",51,0)
 .D ALL^DGMTU21(DFN,"DSV",VADT) I '$D(DGREL) Q
"RTN","VAFMON",52,0)
 .S VAVIRI=+$G(DGINR("V")),VAVIR0=$G(^DGMT(408.22,VAVIRI,0)),VADEP=$P(VAVIR0,U,13)
"RTN","VAFMON",53,0)
 .I 'VADEP&($P(VAVIR0,U,8)) S:VADEP=0 VAMTDEP="" Q
"RTN","VAFMON",54,0)
 .; Questions: piece 5=married last calender year
"RTN","VAFMON",55,0)
 .;            piece 6=lived with patient
"RTN","VAFMON",56,0)
 .;            piece 7=amount contributed to spouse
"RTN","VAFMON",57,0)
 .;
"RTN","VAFMON",58,0)
 .; If no spouse, and questions not answered, set dep=null
"RTN","VAFMON",59,0)
 .;
"RTN","VAFMON",60,0)
 .I '$D(DGREL("S"))&($P(VAVIR0,U,5,7)']"") S VADEP="" Q
"RTN","VAFMON",61,0)
 .;
"RTN","VAFMON",62,0)
 .; If no spouse, but questions answered, set dep=$S
"RTN","VAFMON",63,0)
 .;
"RTN","VAFMON",64,0)
 .I '$D(DGREL("S")),$P(VAVIR0,U,5,7)]"" S VADEP=VADEP+$S('$P(VAVIR0,U,5):0,$P(VAVIR0,U,6)'=0:1,$P(VAVIR0,U,7)>49:1,1:0) Q
"RTN","VAFMON",65,0)
 .;
"RTN","VAFMON",66,0)
 .; If spouse and no questions answered, set dep+1
"RTN","VAFMON",67,0)
 .;
"RTN","VAFMON",68,0)
 .I $D(DGREL("S")),$P(VAVIR0,U,5,7)']"" S VADEP=VADEP+1 Q
"RTN","VAFMON",69,0)
 .;
"RTN","VAFMON",70,0)
 .; If spouse and questions answered, set dep=$S
"RTN","VAFMON",71,0)
 .;
"RTN","VAFMON",72,0)
 .I $D(DGREL("S")) S VADEP=VADEP+$S($P(VAVIR0,U,6):1,$P(VAVIR0,U,7)>49:1,$P(VAVIR0,U,5)&($P(VAVIR0,U,6)=""):1,1:0)
"RTN","VAFMON",73,0)
 ;
"RTN","VAFMON",74,0)
DEPQ Q VADEP
"VER")
8.0^22
**END**
**END**
