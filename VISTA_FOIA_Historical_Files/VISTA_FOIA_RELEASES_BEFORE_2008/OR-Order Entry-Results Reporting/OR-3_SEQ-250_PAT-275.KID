Released OR*3*275 SEQ #250
Extracted from mail message
**KIDS**:OR*3.0*275^

**INSTALL NAME**
OR*3.0*275
"BLD",7361,0)
OR*3.0*275^ORDER ENTRY/RESULTS REPORTING^0^3070713^y
"BLD",7361,1,0)
^^3^3^3070607^
"BLD",7361,1,1,0)
This patch corrects the issue introduced in OR*3.0*265 where pending 
"BLD",7361,1,2,0)
orders no longer display the Medication Administration History.It also 
"BLD",7361,1,3,0)
addresses a subscript error and a disk full error from ORWPS1
"BLD",7361,4,0)
^9.64PA^^
"BLD",7361,6.3)
7
"BLD",7361,"KRN",0)
^9.67PA^8989.52^19
"BLD",7361,"KRN",.4,0)
.4
"BLD",7361,"KRN",.401,0)
.401
"BLD",7361,"KRN",.402,0)
.402
"BLD",7361,"KRN",.403,0)
.403
"BLD",7361,"KRN",.5,0)
.5
"BLD",7361,"KRN",.84,0)
.84
"BLD",7361,"KRN",3.6,0)
3.6
"BLD",7361,"KRN",3.8,0)
3.8
"BLD",7361,"KRN",9.2,0)
9.2
"BLD",7361,"KRN",9.8,0)
9.8
"BLD",7361,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7361,"KRN",9.8,"NM",1,0)
ORWPS^^0^B51113307
"BLD",7361,"KRN",9.8,"NM",2,0)
ORMPS1^^0^B68253979
"BLD",7361,"KRN",9.8,"NM","B","ORMPS1",2)

"BLD",7361,"KRN",9.8,"NM","B","ORWPS",1)

"BLD",7361,"KRN",19,0)
19
"BLD",7361,"KRN",19,"NM",0)
^9.68A^^
"BLD",7361,"KRN",19.1,0)
19.1
"BLD",7361,"KRN",101,0)
101
"BLD",7361,"KRN",409.61,0)
409.61
"BLD",7361,"KRN",771,0)
771
"BLD",7361,"KRN",870,0)
870
"BLD",7361,"KRN",8989.51,0)
8989.51
"BLD",7361,"KRN",8989.52,0)
8989.52
"BLD",7361,"KRN",8994,0)
8994
"BLD",7361,"KRN","B",.4,.4)

"BLD",7361,"KRN","B",.401,.401)

"BLD",7361,"KRN","B",.402,.402)

"BLD",7361,"KRN","B",.403,.403)

"BLD",7361,"KRN","B",.5,.5)

"BLD",7361,"KRN","B",.84,.84)

"BLD",7361,"KRN","B",3.6,3.6)

"BLD",7361,"KRN","B",3.8,3.8)

"BLD",7361,"KRN","B",9.2,9.2)

"BLD",7361,"KRN","B",9.8,9.8)

"BLD",7361,"KRN","B",19,19)

"BLD",7361,"KRN","B",19.1,19.1)

"BLD",7361,"KRN","B",101,101)

"BLD",7361,"KRN","B",409.61,409.61)

"BLD",7361,"KRN","B",771,771)

"BLD",7361,"KRN","B",870,870)

"BLD",7361,"KRN","B",8989.51,8989.51)

"BLD",7361,"KRN","B",8989.52,8989.52)

"BLD",7361,"KRN","B",8994,8994)

"BLD",7361,"QUES",0)
^9.62^^
"BLD",7361,"REQB",0)
^9.611^1^1
"BLD",7361,"REQB",1,0)
OR*3.0*265^1
"BLD",7361,"REQB","B","OR*3.0*265",1)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2971217^2980417^1271
"PKG",167,22,1,"PAH",1,0)
275^3070713
"PKG",167,22,1,"PAH",1,1,0)
^^3^3^3070713
"PKG",167,22,1,"PAH",1,1,1,0)
This patch corrects the issue introduced in OR*3.0*265 where pending 
"PKG",167,22,1,"PAH",1,1,2,0)
orders no longer display the Medication Administration History.It also 
"PKG",167,22,1,"PAH",1,1,3,0)
addresses a subscript error and a disk full error from ORWPS1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORMPS1")
0^2^B68253979^B67707538
"RTN","ORMPS1",1,0)
ORMPS1 ;SLC/MKB - Process Pharmacy ORM msgs cont ;12/9/04  12:01
"RTN","ORMPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**86,92,94,116,134,152,158,149,190,195,215,265,275**;Dec 17, 1997;Build 7
"RTN","ORMPS1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORMPS1",4,0)
UDOSE ; -- new Unit Dose order
"RTN","ORMPS1",5,0)
 N QT,DRUG,INSTR,DOSE,RTE,SCH,OI,URG,WP,DUR,STR,DRGNM,X,PSOI,PSDD,S0,ID,LDOSE,XC,NTE,S0,RXR
"RTN","ORMPS1",6,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORMPS1",7,0)
 I $G(ORAPPT)>0 S ORDG=+$O(^ORD(100.98,"B","CLINIC ORDERS",0))
"RTN","ORMPS1",8,0)
 E  S ORDG=+$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS",0))
"RTN","ORMPS1",9,0)
 S ORPKG=+$$PKG("PSJ")
"RTN","ORMPS1",10,0)
 D GETDLG1^ORCD(ORDIALOG) S QT=$G(ORQT(1))
"RTN","ORMPS1",11,0)
 S DRUG=$$PTR("DISPENSE DRUG"),INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORMPS1",12,0)
 S DOSE=$$PTR("DOSE"),RTE=$$PTR("ROUTE"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",13,0)
 S OI=$$PTR("ORDERABLE ITEM"),URG=$$PTR("URGENCY")
"RTN","ORMPS1",14,0)
 S WP=$$PTR("WORD PROCESSING 1"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",15,0)
 S STR=$$PTR("STRENGTH"),DRGNM=$$PTR("DRUG NAME")
"RTN","ORMPS1",16,0)
UD1 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",17,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",18,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",19,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",20,0)
 S ID=$P(QT,U),LDOSE=$P(QT,U,8) I 'ID,S0 D
"RTN","ORMPS1",21,0)
 . N UNT,PTRN S UNT=$P(S0,"&",2),PTRN="1.N1"""_UNT_""""
"RTN","ORMPS1",22,0)
 . I LDOSE?@PTRN S $P(ID,"&",1,2)=+LDOSE_"&"_UNT Q  ;pre-POE orders
"RTN","ORMPS1",23,0)
 . S:$P(PSOI,U,2)'[S0 ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",24,0)
 I 'ID,'S0 S ORDIALOG(DRGNM,1)=$P(PSDD,U,2)
"RTN","ORMPS1",25,0)
 S:$L(ID) ORDIALOG(DOSE,1)=$P(ID,"&",1,4)_"&"_LDOSE_"&"_+PSDD_"&"_S0
"RTN","ORMPS1",26,0)
 I LDOSE="" D  I LDOSE="" S ORERR="Unable to determine instructions" Q
"RTN","ORMPS1",27,0)
 . I $G(RXC)'>0 D  Q  ;look for units/dose
"RTN","ORMPS1",28,0)
 .. S LDOSE=$P(ID,"&",3),X=$P(ID,"&",4) I 'LDOSE S LDOSE="" Q
"RTN","ORMPS1",29,0)
 .. S:'$L(X) X=$P($$FIND^ORM(+RXE,7),U,5) S:$L(X) LDOSE=LDOSE_" "_X
"RTN","ORMPS1",30,0)
 .. S ORDIALOG(DRGNM,1)=$P(PSDD,U,2) ;force use of DD
"RTN","ORMPS1",31,0)
 . F  D  Q:LDOSE'=""  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",32,0)
 .. S XC=@ORMSG@(RXC) Q:+$P($P(XC,"|",3),U,4)'=+PSOI
"RTN","ORMPS1",33,0)
 .. S LDOSE=$P(XC,"|",4)_$P($P(XC,"|",5),U,5) ;strength_units
"RTN","ORMPS1",34,0)
 S ORDIALOG(INSTR,1)=LDOSE
"RTN","ORMPS1",35,0)
UD2 S NTE=$$NTE(21) I NTE D
"RTN","ORMPS1",36,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",37,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",38,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",39,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",40,0)
 S RXR=$$RXR^ORMPS I 'RXR S ORERR="Missing or invalid RXR segment" Q
"RTN","ORMPS1",41,0)
 S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4),ORDIALOG(URG,1)=ORURG
"RTN","ORMPS1",42,0)
 S ORDIALOG(SCH,1)=$P(QT,U,2),X=$P(QT,U,3)
"RTN","ORMPS1",43,0)
 I $L(X) D  ;set only if previous order had duration
"RTN","ORMPS1",44,0)
 . N IFN S IFN=$S($G(ORIFN):+ORIFN,$P(ZRX,"|",2):+$P(ZRX,"|",2),1:0)
"RTN","ORMPS1",45,0)
 . S:$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) ORDIALOG(DUR,1)=$$DURATION(X)
"RTN","ORMPS1",46,0)
 D DOSETEXT^ORCDPS2 ;reset Instructions text, SIG
"RTN","ORMPS1",47,0)
 Q
"RTN","ORMPS1",48,0)
OUT ; -- new Outpt order
"RTN","ORMPS1",49,0)
 N OI,SIG,INSTR,DOSE,RTE,SCH,DUR,SC,STR,DRUG,PI,CONJ,PSOI,PSDD,S0,X,I,RXR,J,NTE,ZSC,CNT,PC
"RTN","ORMPS1",50,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORMPS1",51,0)
 S ORDG=+$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0))
"RTN","ORMPS1",52,0)
 S ORPKG=+$$PKG("PSO") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",53,0)
 S OI=$$PTR("ORDERABLE ITEM"),SIG=$$PTR("SIG")
"RTN","ORMPS1",54,0)
 S INSTR=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE")
"RTN","ORMPS1",55,0)
 S SCH=$$PTR("SCHEDULE"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",56,0)
 S RTE=$$PTR("ROUTE"),SC=$$PTR("SERVICE CONNECTED")
"RTN","ORMPS1",57,0)
 S STR=$$PTR("STRENGTH"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMPS1",58,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMPS1",59,0)
 S PC=$$PTR("WORD PROCESSING 1")
"RTN","ORMPS1",60,0)
 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",61,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",62,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",63,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",64,0)
 I S0,$P(PSOI,U,2)'[S0 S ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",65,0)
 I 'S0,'$G(ORQT(1)) S ORDIALOG($$PTR("DRUG NAME"),1)=$P(PSDD,U,2)
"RTN","ORMPS1",66,0)
OUT1 S ORDIALOG($$PTR("QUANTITY"),1)=$$FIND^ORM(+RXE,11)
"RTN","ORMPS1",67,0)
 S ORDIALOG($$PTR("REFILLS"),1)=$$FIND^ORM(+RXE,13)
"RTN","ORMPS1",68,0)
 S X=$$FIND^ORM(+RXE,23) S:$E(X)="D" X=+$E(X,2,99)
"RTN","ORMPS1",69,0)
 S:X ORDIALOG($$PTR("DAYS SUPPLY"),1)=X
"RTN","ORMPS1",70,0)
 I ZRX S X=$P(ZRX,"|",5) S:$L(X) ORDIALOG($$PTR("ROUTING"),1)=X
"RTN","ORMPS1",71,0)
 S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG F I=1:1:ORQT D
"RTN","ORMPS1",72,0)
 . S ORDIALOG(INSTR,I)=$P(ORQT(I),U,8),X=$P(ORQT(I),U)
"RTN","ORMPS1",73,0)
 . S:$L(X) ORDIALOG(DOSE,I)=$P(X,"&",1,4)_"&"_$P(ORQT(I),U,8)_"&"_+PSDD_"&"_S0
"RTN","ORMPS1",74,0)
 . S X=$P(ORQT(I),U,2) S:$L(X) ORDIALOG(SCH,I)=X
"RTN","ORMPS1",75,0)
 . S X=$P(ORQT(I),U,3) S:$L(X) ORDIALOG(DUR,I)=$$DURATION(X)
"RTN","ORMPS1",76,0)
 . S X=$P(ORQT(I),U,9) S:$L(X) ORDIALOG(CONJ,I)=$S(X="S":"T",1:X)
"RTN","ORMPS1",77,0)
 S RXR=$$RXR^ORMPS I RXR S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4) D
"RTN","ORMPS1",78,0)
 . S I=1,J=+RXR ;look for multiple RXR's
"RTN","ORMPS1",79,0)
 . F  S J=$O(@ORMSG@(J)) Q:J'>0  S RXR=@ORMSG@(J) Q:$E(RXR,1,3)'="RXR"  S I=I+1,ORDIALOG(RTE,I)=$P($P(RXR,"|",2),U,4)
"RTN","ORMPS1",80,0)
OUT2 S NTE=$$NTE(6) D:'NTE PCOMM^ORMPS2 I NTE D  ;Prov Comm
"RTN","ORMPS1",81,0)
 . S CNT=1,^TMP("ORWORD",$J,PC,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",82,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PC,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",83,0)
 . S ^TMP("ORWORD",$J,PC,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",84,0)
 . S ORDIALOG(PC,1)="^TMP(""ORWORD"",$J,"_PC_",1)"
"RTN","ORMPS1",85,0)
 . N XCNT,XCOMM,XCOMMENT,XORCOMM,XXCNT,XORIFN
"RTN","ORMPS1",86,0)
 . S (XCOMM,XORCOMM)=""
"RTN","ORMPS1",87,0)
 . S XORIFN=$G(ORIFN) I XORIFN="" S XORIFN=$P(RXR,"|",2)
"RTN","ORMPS1",88,0)
 . Q:XORIFN=""
"RTN","ORMPS1",89,0)
 . S XCOMM=$O(^OR(100,+XORIFN,4.5,"ID","COMMENT",XCOMM)) Q:XCOMM=""
"RTN","ORMPS1",90,0)
 . S XCNT=0 F  S XCNT=$O(^TMP("ORWORD",$J,PC,1,XCNT)) Q:XCNT=""  S XCOMMENT=$G(^TMP("ORWORD",$J,PC,1,XCNT,0)) D
"RTN","ORMPS1",91,0)
 . . S XORCOMM=$G(^OR(100,+XORIFN,4.5,XCOMM,2,XCNT,0))
"RTN","ORMPS1",92,0)
 . . S XXCNT=0
"RTN","ORMPS1",93,0)
 . . I XORCOMM="" F  S XXCNT=$O(^OR(100,+XORIFN,4.5,XCOMM,2,XXCNT)) Q:XXCNT=""  S XORCOMM=$G(^OR(100,+XORIFN,4.5,XCOMM,2,XXCNT,0)) Q:XORCOMM'=""
"RTN","ORMPS1",94,0)
 . . I $G(XCOMMENT)=$G(XORCOMM) S ORDIALOG(PC,"FORMAT")="@"
"RTN","ORMPS1",95,0)
 S NTE=$$NTE(7) I NTE D  ;Pat Instr
"RTN","ORMPS1",96,0)
 . S CNT=1,^TMP("ORWORD",$J,PI,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",97,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PI,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",98,0)
 . S ^TMP("ORWORD",$J,PI,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",99,0)
 . S ORDIALOG(PI,1)="^TMP(""ORWORD"",$J,"_PI_",1)"
"RTN","ORMPS1",100,0)
 S NTE=$$NTE(21) I NTE D  ;Sig
"RTN","ORMPS1",101,0)
 . S CNT=1,^TMP("ORWORD",$J,SIG,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",102,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,SIG,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",103,0)
 . S ^TMP("ORWORD",$J,SIG,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",104,0)
 . S ORDIALOG(SIG,1)="^TMP(""ORWORD"",$J,"_SIG_",1)"
"RTN","ORMPS1",105,0)
 . S ORDIALOG(PI,"FORMAT")="@" ;PI already included in Sig
"RTN","ORMPS1",106,0)
OUT3 I '$G(ORQT(1))!('NTE) D DOSETEXT^ORCDPS2 ;reset Instructions text, Sig
"RTN","ORMPS1",107,0)
 S ZSC=$$ZSC,X=$P(ZSC,"|",2) I X?2.3U S ORDIALOG(SC,1)=$S(X="SC":1,1:0)
"RTN","ORMPS1",108,0)
 Q
"RTN","ORMPS1",109,0)
IV ; -- new IV order
"RTN","ORMPS1",110,0)
 N IVTYP S IVTYP=$P(ZRX,"|",7) I IVTYP="",$$NUMADDS'>1 G UDOSE
"RTN","ORMPS1",111,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,X,X1,X2,I,J,TYPE,OI,WP,NTE,SCH,DAYS
"RTN","ORMPS1",112,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORMPS1",113,0)
 I +$G(ORAPPT)>0 S ORDG=+$O(^ORD(100.98,"B","CLINIC ORDERS",0))
"RTN","ORMPS1",114,0)
 E  S ORDG=+$O(^ORD(100.98,"B",$S($P(ZRX,"|",7)="TPN":"TPN",1:"IV RX"),0))
"RTN","ORMPS1",115,0)
 S ORPKG=+$$PKG("PSJ") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",116,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),VOL=$$PTR("VOLUME"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",117,0)
 S RATE=$$PTR("INFUSION RATE") S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMPS1",118,0)
 S WP=$$PTR("WORD PROCESSING 1"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMPS1",119,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMPS1",120,0)
 S DAYS=$$PTR("DURATION")
"RTN","ORMPS1",121,0)
IV1 S NTE=$$NTE(21) I NTE D
"RTN","ORMPS1",122,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",123,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",124,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",125,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",126,0)
 N ORDAYS S ORDAYS=""
"RTN","ORMPS1",127,0)
 S:$D(RXO) ORDAYS=$P($P(RXO,"|",2),"^",3)
"RTN","ORMPS1",128,0)
 S:$L(ORDAYS) ORDAYS=$$IVLIM^ORMPS2(ORDAYS)
"RTN","ORMPS1",129,0)
 S:$L(ORDAYS) ORDIALOG(DAYS,1)=ORDAYS
"RTN","ORMPS1",130,0)
 S X=$P($$FIND^ORM(+RXE,25),U,5)
"RTN","ORMPS1",131,0)
 S ORDIALOG(RATE,1)=$$FIND^ORM(+RXE,24)_$S($L(X):" "_X,1:""),(I,J)=0
"RTN","ORMPS1",132,0)
 F  D  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",133,0)
 . S X=@ORMSG@(RXC),TYPE=$P(X,"|",2),OI=$$ORDITEM^ORM($P(X,"|",3)) Q:'OI
"RTN","ORMPS1",134,0)
 . S X1=$P(X,"|",4),X2=$P($P(X,"|",5),U,5)
"RTN","ORMPS1",135,0)
 . I $E(TYPE)="B" S J=J+1,ORDIALOG(SOLN,J)=OI,ORDIALOG(VOL,J)=X1 Q
"RTN","ORMPS1",136,0)
 . S I=I+1,ORDIALOG(ADDS,I)=OI,ORDIALOG(STR,I)=X1,ORDIALOG(UNITS,I)=X2
"RTN","ORMPS1",137,0)
 I IVTYP="" S X=$P($G(ORQT(1)),U,2) S:$L(X) ORDIALOG(SCH,1)=X
"RTN","ORMPS1",138,0)
 Q
"RTN","ORMPS1",139,0)
NTE(ID) ; -- Return subscript of NTE segment for RXE-<ID>
"RTN","ORMPS1",140,0)
 N I,SEG,Y S Y="",I=+RXE S:'$G(ID) ID=21
"RTN","ORMPS1",141,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=@ORMSG@(I) Q:$E(SEG,1,3)="ORC"  I $P(SEG,"|",1,2)=("NTE|"_ID) S Y=I Q
"RTN","ORMPS1",142,0)
 Q Y
"RTN","ORMPS1",143,0)
ZSC() ; -- Return subscript of ZSC segment
"RTN","ORMPS1",144,0)
 N I,SEG,Y S Y="",I=+RXE
"RTN","ORMPS1",145,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZSC" S Y=I_U_@ORMSG@(I) Q
"RTN","ORMPS1",146,0)
 Q Y
"RTN","ORMPS1",147,0)
NUMADDS() ; -- count number of additives to determine type
"RTN","ORMPS1",148,0)
 N CNT,I,X S CNT=0,I=+RXE
"RTN","ORMPS1",149,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S X=@ORMSG@(I) Q:$P(X,"|")="ORC"  I $E(X,1,6)="RXC|A|" S CNT=CNT+1
"RTN","ORMPS1",150,0)
 Q CNT
"RTN","ORMPS1",151,0)
PKG(NMSP) ; -- Return Package file ptr for NMSP
"RTN","ORMPS1",152,0)
 N I S I=0
"RTN","ORMPS1",153,0)
 F  S I=+$O(^DIC(9.4,"C",NMSP,I)) Q:I<1  Q:'$O(^(I,0))  ;no Addl Prefs  DBIA #2058
"RTN","ORMPS1",154,0)
 Q I
"RTN","ORMPS1",155,0)
PTR(NAME) ; -- Returns ien of prompt NAME in Order Dialog file #101.41
"RTN","ORMPS1",156,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMPS1",157,0)
DURATION(X) ; -- Returns "# units" from U# format
"RTN","ORMPS1",158,0)
 N Y,Y1,Y2 I X'?.1U1.N Q ""
"RTN","ORMPS1",159,0)
 S Y1=$E(X),Y2=+$E(X,2,$L(X)) I X=+X S Y1="D",Y2=+X
"RTN","ORMPS1",160,0)
 S Y=Y2_" "_$S(Y1="L":"MONTH",Y1="W":"WEEK",Y1="H":"HOUR",Y1="M":"MINUTE",Y1="S":"SECOND",1:"DAY")_$S(Y2>1:"S",1:"")
"RTN","ORMPS1",161,0)
 Q Y
"RTN","ORMPS1",162,0)
QT ; -- Unpiece the Q/T field from RXE
"RTN","ORMPS1",163,0)
 I 'RXE S ORQT(1)=ORQT,ORQT=1 Q  ; nothing to reset
"RTN","ORMPS1",164,0)
 N X,Y,I,J,P,SEG,DONE K ORQT
"RTN","ORMPS1",165,0)
 S SEG=$G(@ORMSG@(+RXE)),X=$P(SEG,"|",2),(I,J,P,DONE)=0
"RTN","ORMPS1",166,0)
 F  D  Q:DONE
"RTN","ORMPS1",167,0)
 . S P=P+1,Y=$P(X,"~",P) I Y="" S DONE=1 Q
"RTN","ORMPS1",168,0)
 . I P<$L(X,"~") S I=I+1,ORQT(I)=Y Q
"RTN","ORMPS1",169,0)
 . I $L(SEG,"|")>2 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",170,0)
 . S J=+$O(@ORMSG@(+RXE,J)) I J'>0 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",171,0)
 . S SEG=$G(@ORMSG@(+RXE,J)),X=$P(SEG,"|"),P=1,I=I+1,ORQT(I)=Y_$P(X,"~")
"RTN","ORMPS1",172,0)
 S ORQT=I Q:'ORQT  ; else reset ORSTRT, ORSTOP, ORURG
"RTN","ORMPS1",173,0)
 S ORSTRT=$P(ORQT(1),U,4),ORSTOP=$P(ORQT(ORQT),U,5),ORURG=$P(ORQT(1),U,6)
"RTN","ORMPS1",174,0)
 S:ORSTRT ORSTRT=$$FMDATE^ORM(ORSTRT) S:ORSTOP ORSTOP=$$FMDATE^ORM(ORSTOP) S:$L(ORURG) ORURG=$$URGENCY^ORM(ORURG)
"RTN","ORMPS1",175,0)
 Q
"RTN","ORWPS")
0^1^B51113307^B46786086
"RTN","ORWPS",1,0)
ORWPS ; SLC/KCM/JLI/REV/CLA - Meds Tab; 05/22/03 ; 5/18/07 10:18am
"RTN","ORWPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,141,173,203,190,195,265,275**;Dec 17, 1997;Build 7
"RTN","ORWPS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ORWPS",4,0)
COVER(LST,DFN)  ; retrieve meds for cover sheet
"RTN","ORWPS",5,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",6,0)
 D OCL^PSOORRL(DFN,"","")  ;DBIA #2400
"RTN","ORWPS",7,0)
 N ILST,ITMP,X S ILST=0
"RTN","ORWPS",8,0)
 S ITMP="" F  S ITMP=$O(^TMP("PS",$J,ITMP)) Q:'ITMP  D
"RTN","ORWPS",9,0)
 . S X=^TMP("PS",$J,ITMP,0)
"RTN","ORWPS",10,0)
 . I '$L($P(X,U,2)) S X="??"  ; show something if drug empty
"RTN","ORWPS",11,0)
 . I $D(^TMP("PS",$J,ITMP,"CLINIC",0)) S LST($$NXT)=$P(X,U,1,2)_U_$P(X,U,8,9)_U_"C"
"RTN","ORWPS",12,0)
 . E  S LST($$NXT)=$P(X,U,1,2)_U_$P(X,U,8,9)
"RTN","ORWPS",13,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",14,0)
 Q
"RTN","ORWPS",15,0)
DT(X) ; -- Returns FM date for X
"RTN","ORWPS",16,0)
 N Y,%DT S %DT="T",Y="" D:X'="" ^%DT
"RTN","ORWPS",17,0)
 Q Y
"RTN","ORWPS",18,0)
 ;
"RTN","ORWPS",19,0)
ACTIVE(LST,DFN) ; retrieve active inpatient & outpatient meds
"RTN","ORWPS",20,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",21,0)
 K ^TMP("ORACT",$J)
"RTN","ORWPS",22,0)
 N BEG,END,CTX
"RTN","ORWPS",23,0)
 S (BEG,END,CTX)=""
"RTN","ORWPS",24,0)
 S CTX=$$GET^XPAR("ALL","ORCH CONTEXT MEDS")
"RTN","ORWPS",25,0)
 I CTX=";" D DEL^XPAR("USR.`"_DUZ,"ORCH CONTEXT MEDS")
"RTN","ORWPS",26,0)
 S CTX=$$GET^XPAR("ALL","ORCH CONTEXT MEDS")
"RTN","ORWPS",27,0)
 S BEG=$$DT($P(CTX,";")),END=$$DT($P(CTX,";",2))
"RTN","ORWPS",28,0)
 D OCL^PSOORRL(DFN,BEG,END)  ;DBIA #2400
"RTN","ORWPS",29,0)
 N ITMP,FIELDS,INSTRUCT,COMMENTS,REASON,NVSDT,TYPE,ILST,J S ILST=0
"RTN","ORWPS",30,0)
 S ITMP="" F  S ITMP=$O(^TMP("PS",$J,ITMP),-1) Q:'ITMP  D
"RTN","ORWPS",31,0)
 . K INSTRUCT,COMMENTS,REASON
"RTN","ORWPS",32,0)
 . K ^TMP("ORACT",$J,"COMMENTS")
"RTN","ORWPS",33,0)
 . S COMMENTS="^TMP(""ORACT"",$J,""COMMENTS"")"
"RTN","ORWPS",34,0)
 . S (INSTRUCT,@COMMENTS)="",FIELDS=^TMP("PS",$J,ITMP,0)
"RTN","ORWPS",35,0)
 . I +$P(FIELDS,"^",8),$D(^OR(100,+$P(FIELDS,"^",8),8,"C","XX")) D
"RTN","ORWPS",36,0)
 . . S $P(^TMP("PS",$J,ITMP,0),"^",2)="*"_$P(^TMP("PS",$J,ITMP,0),"^",2) ;dan testing
"RTN","ORWPS",37,0)
 . S TYPE=$S($P($P(FIELDS,U),";",2)="O":"OP",1:"UD")
"RTN","ORWPS",38,0)
 . I $D(^TMP("PS",$J,ITMP,"CLINIC",0)) S TYPE="CP"
"RTN","ORWPS",39,0)
 . N LOC,LOCEX S (LOC,LOCEX)=""
"RTN","ORWPS",40,0)
 . I TYPE="CP" S LOC=$G(^TMP("PS",$J,ITMP,"CLINIC",0))
"RTN","ORWPS",41,0)
 . S:LOC LOCEX=$P($G(^SC(+LOC,0)),U)_":"_+LOC ;IMO NEW  DBIA #964
"RTN","ORWPS",42,0)
 . I TYPE="OP",$P(FIELDS,";")["N" S TYPE="NV"          ;non-VA med
"RTN","ORWPS",43,0)
 . I $O(^TMP("PS",$J,ITMP,"A",0))>0 S TYPE="IV"
"RTN","ORWPS",44,0)
 . I $O(^TMP("PS",$J,ITMP,"B",0))>0 S TYPE="IV"
"RTN","ORWPS",45,0)
 . I (TYPE="UD")!(TYPE="CP") D UDINST(.INSTRUCT,ITMP)
"RTN","ORWPS",46,0)
 . I TYPE="OP" D OPINST(.INSTRUCT,ITMP)
"RTN","ORWPS",47,0)
 . I TYPE="IV" D IVINST(.INSTRUCT,ITMP)
"RTN","ORWPS",48,0)
 . I TYPE="NV" D NVINST(.INSTRUCT,ITMP),NVREASON(.REASON,.NVSDT,ITMP)
"RTN","ORWPS",49,0)
 . I (TYPE="UD")!(TYPE="IV")!(TYPE="NV")!(TYPE="CP") D SETMULT(COMMENTS,ITMP,"SIO")
"RTN","ORWPS",50,0)
 . M COMMENTS=@COMMENTS
"RTN","ORWPS",51,0)
 . I $D(COMMENTS(1)) S COMMENTS(1)="\"_COMMENTS(1)
"RTN","ORWPS",52,0)
 . S:TYPE="NV" $P(FIELDS,U,4)=$G(NVSDT)
"RTN","ORWPS",53,0)
 . I LOC S LST($$NXT)="~CP:"_LOCEX_U_FIELDS
"RTN","ORWPS",54,0)
 . E  S LST($$NXT)="~"_TYPE_U_FIELDS
"RTN","ORWPS",55,0)
 . S J=0 F  S J=$O(INSTRUCT(J)) Q:'J  S LST($$NXT)=INSTRUCT(J)
"RTN","ORWPS",56,0)
 . S J=0 F  S J=$O(COMMENTS(J)) Q:'J  S LST($$NXT)="t"_COMMENTS(J)
"RTN","ORWPS",57,0)
 . S J=0 F  S J=$O(REASON(J)) Q:'J  S LST($$NXT)="t"_REASON(J)
"RTN","ORWPS",58,0)
 K ^TMP("PS",$J)
"RTN","ORWPS",59,0)
 K ^TMP("ORACT",$J)
"RTN","ORWPS",60,0)
 Q
"RTN","ORWPS",61,0)
NXT() ; increment ILST
"RTN","ORWPS",62,0)
 S ILST=ILST+1
"RTN","ORWPS",63,0)
 Q ILST
"RTN","ORWPS",64,0)
 ;
"RTN","ORWPS",65,0)
UDINST(Y,INDEX) ; assembles instructions for a unit dose order
"RTN","ORWPS",66,0)
 N I,X,RST
"RTN","ORWPS",67,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",68,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",69,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",70,0)
 S X=$S($L($P(X,U,6)):$P(X,U,6),1:$P(X,U,7))
"RTN","ORWPS",71,0)
 I $L(X) S @RST=2,@RST@(2)=X
"RTN","ORWPS",72,0)
 E  S @RST=1 D SETMULT(.RST,INDEX,"SIG")
"RTN","ORWPS",73,0)
 S @RST@(2)="\Give: "_$G(@RST@(2)),@RST=$G(@RST,2)
"RTN","ORWPS",74,0)
 D SETMULT(RST,INDEX,"MDR"),SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",75,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",76,0)
 M Y=@RST K @RST
"RTN","ORWPS",77,0)
 Q
"RTN","ORWPS",78,0)
OPINST(Y,INDEX) ; assembles instructions for an outpatient prescription
"RTN","ORWPS",79,0)
 N I,X,RST
"RTN","ORWPS",80,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",81,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",82,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",83,0)
 I $L($P(X,U,12)) S @RST@(1)=@RST@(1)_"  Qty: "_$P(X,U,12)
"RTN","ORWPS",84,0)
 I $L($P(X,U,11)) S @RST@(1)=@RST@(1)_" for "_$P(X,U,11)_" days"
"RTN","ORWPS",85,0)
 D SETMULT(RST,INDEX,"SIG")
"RTN","ORWPS",86,0)
 I @RST=1 D
"RTN","ORWPS",87,0)
 . D SETMULT(RST,INDEX,"SIO")
"RTN","ORWPS",88,0)
 . D SETMULT(RST,INDEX,"MDR")
"RTN","ORWPS",89,0)
 . D SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",90,0)
 S @RST@(2)="\ Sig: "_$G(@RST@(2))
"RTN","ORWPS",91,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",92,0)
 M Y=@RST K @RST
"RTN","ORWPS",93,0)
 Q
"RTN","ORWPS",94,0)
IVINST(Y,INDEX) ; assembles instructions for an IV order
"RTN","ORWPS",95,0)
 N SOLN1,I,RST,IVDUR
"RTN","ORWPS",96,0)
 S IVDUR=""
"RTN","ORWPS",97,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",98,0)
 S @RST=0 D SETMULT(RST,INDEX,"A") S SOLN1=@RST+1
"RTN","ORWPS",99,0)
 D SETMULT(RST,INDEX,"B")
"RTN","ORWPS",100,0)
 I $D(@RST@(SOLN1)),$L($P(FIELDS,U,2)) S @RST@(SOLN1)="in "_@RST@(SOLN1)
"RTN","ORWPS",101,0)
 S SOLN1=@RST+1
"RTN","ORWPS",102,0)
 D SETMULT(RST,INDEX,"SCH") S:$D(@RST@(SOLN1)) @RST@(SOLN1)=" "_@RST@(SOLN1)
"RTN","ORWPS",103,0)
 F I=1:1:@RST S @RST@(I)="\"_$TR(@RST@(I),U," ")
"RTN","ORWPS",104,0)
 I $D(@RST@(1)) S @RST@(1)=" "_$E(@RST@(1),2,999)
"RTN","ORWPS",105,0)
 S @RST@(@RST)=@RST@(@RST)_" "_$P(^TMP("PS",$J,INDEX,0),U,3)
"RTN","ORWPS",106,0)
 S:$D(^TMP("PS",$J,INDEX,"IVLIM",0)) IVDUR=$G(^TMP("PS",$J,INDEX,"IVLIM",0))
"RTN","ORWPS",107,0)
 I $L(IVDUR) D
"RTN","ORWPS",108,0)
 . N DURU,DURV S DURU="",DURV=0
"RTN","ORWPS",109,0)
 . S DURU=$E(IVDUR,1),DURV=$E(IVDUR,2,$L(IVDUR))
"RTN","ORWPS",110,0)
 . I (DURU="D")!(DURU="d") S IVDUR="for "_+DURV_$S(+DURV=1:" day",+DURV>1:" days",1:" day")
"RTN","ORWPS",111,0)
 . I (DURU="H")!(DURU="h") S IVDUR="for "_+DURV_$S(+DURV=1:" hours",+DURV>1:" hours",1:" hour")
"RTN","ORWPS",112,0)
 . I (DURU="M")!(DURU="m") S IVDUR="with total volume "_+DURV_" ml"
"RTN","ORWPS",113,0)
 . I (DURU="L")!(DURU="l") S IVDUR="with total volume "_+DURV_" L"
"RTN","ORWPS",114,0)
 . S @RST@(@RST)=@RST@(@RST)_" "_IVDUR
"RTN","ORWPS",115,0)
 M Y=@RST K @RST
"RTN","ORWPS",116,0)
 Q
"RTN","ORWPS",117,0)
NVINST(Y,INDEX) ; assembles instructions for a non-VA med
"RTN","ORWPS",118,0)
 N I,X,RST
"RTN","ORWPS",119,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",120,0)
 S RST="^TMP(""ORACT"",$J,""INSTRUCT"")"
"RTN","ORWPS",121,0)
 S @RST@(1)=" "_$P(X,U,2),@RST=1
"RTN","ORWPS",122,0)
 D SETMULT(RST,INDEX,"SIG")
"RTN","ORWPS",123,0)
 I @RST=1 D
"RTN","ORWPS",124,0)
 . D SETMULT(RST,INDEX,"SIO")
"RTN","ORWPS",125,0)
 . D SETMULT(RST,INDEX,"MDR")
"RTN","ORWPS",126,0)
 . D SETMULT(RST,INDEX,"SCH")
"RTN","ORWPS",127,0)
 S @RST@(2)="\ "_$G(@RST@(2))
"RTN","ORWPS",128,0)
 F I=3:1:@RST S @RST@(I)=" "_@RST@(I)
"RTN","ORWPS",129,0)
 M Y=@RST K @RST
"RTN","ORWPS",130,0)
 Q
"RTN","ORWPS",131,0)
NVREASON(ORR,NVSDT,INDEX) ; assembles start date and reasons for a non-VA med
"RTN","ORWPS",132,0)
 N ORI,J,X,ORN,ORA
"RTN","ORWPS",133,0)
 S ORI=0 K ORR
"RTN","ORWPS",134,0)
 S X=^TMP("PS",$J,INDEX,0)
"RTN","ORWPS",135,0)
 S ORN=+$P(X,U,8)
"RTN","ORWPS",136,0)
 I $D(^OR(100,ORN,0)) D
"RTN","ORWPS",137,0)
 .S NVSDT=$P(^OR(100,ORN,0),U,8)
"RTN","ORWPS",138,0)
 .D WPVAL^ORWDXR(.ORA,ORN,"STATEMENTS") I $D(ORA) D
"RTN","ORWPS",139,0)
 ..S J=0 F  S J=$O(ORA(J)) Q:J<1  S ORI=ORI+1,ORR(ORI)=ORA(J)
"RTN","ORWPS",140,0)
 Q
"RTN","ORWPS",141,0)
SETMULT(Y,INDEX,SUB) ; appends the multiple at the subscript to Y
"RTN","ORWPS",142,0)
 N I,X,J
"RTN","ORWPS",143,0)
 S J=$G(@Y)
"RTN","ORWPS",144,0)
 S I=0 F  S I=$O(^TMP("PS",$J,INDEX,SUB,I)) Q:'I  S X=$G(^(I,0)) D
"RTN","ORWPS",145,0)
 . I SUB="B",$L($P(X,U,3)) S X=$P(X,U)_" "_$P(X,U,3)_"^"_$P(X,U,2)
"RTN","ORWPS",146,0)
 . S J=J+1,@Y@(J)=X
"RTN","ORWPS",147,0)
 S @Y=J
"RTN","ORWPS",148,0)
 Q
"RTN","ORWPS",149,0)
COMPRESS(Y) ; concatenate Y subscripts into smallest possible number
"RTN","ORWPS",150,0)
 N I,J,X S J=1,X(J)=""
"RTN","ORWPS",151,0)
 S I=0 F  S I=$O(Y(I)) Q:'I  D
"RTN","ORWPS",152,0)
 . I ($L(Y(I))+$L(X(J)))>245 S J=J+1,X(J)=""
"RTN","ORWPS",153,0)
 . S X(J)=X(J)_$S($L(X(J)):" ",1:"")_Y(I)
"RTN","ORWPS",154,0)
 K Y M Y=X
"RTN","ORWPS",155,0)
 Q
"RTN","ORWPS",156,0)
DETAIL(ROOT,DFN,ID) ; -- show details for a med order
"RTN","ORWPS",157,0)
 K ^TMP("ORXPND",$J)
"RTN","ORWPS",158,0)
 N LCNT,ORVP
"RTN","ORWPS",159,0)
 S LCNT=0,ORVP=DFN_";DPT("
"RTN","ORWPS",160,0)
 D MEDS^ORCXPND1
"RTN","ORWPS",161,0)
 S ROOT=$NA(^TMP("ORXPND",$J))
"RTN","ORWPS",162,0)
 Q
"RTN","ORWPS",163,0)
MEDHIST(ORROOT,DFN,ORIFN)       ; -- show admin history for a med  (RV)
"RTN","ORWPS",164,0)
 N ORPSID,HPIV,ISIV,CKPKG,ORPHMID
"RTN","ORWPS",165,0)
 S ORPSID=+$P($$OI^ORX8(ORIFN),U,3),(HPIV,ISIV)=0
"RTN","ORWPS",166,0)
 S ORROOT=$NA(^TMP("ORHIST",$J)) K @ORROOT
"RTN","ORWPS",167,0)
 S ORPHMID=$G(^OR(100,+ORIFN,4))  ;Pharmacy order number
"RTN","ORWPS",168,0)
 S ISIV=$O(^ORD(100.98,"B","IV RX",ISIV))
"RTN","ORWPS",169,0)
 S HPIV=$O(^ORD(100.98,"B","TPN",HPIV))
"RTN","ORWPS",170,0)
 S CKPKG=$$PATCH^XPDUTL("PSB*2.0*19")
"RTN","ORWPS",171,0)
 ;if the order is pending or the order has no pharmacy # 
"RTN","ORWPS",172,0)
 ;or the order is not in the Display Group IV MEDICATION
"RTN","ORWPS",173,0)
 ; then use the Orderable item number to get the MAH.
"RTN","ORWPS",174,0)
 I (ORPHMID["P")!(ORPHMID="") D  Q
"RTN","ORWPS",175,0)
 . I '$L($T(HISTORY^PSBMLHS)) D  Q
"RTN","ORWPS",176,0)
 . . S @ORROOT@(0)="This report is only available using BCMA version 2.0."
"RTN","ORWPS",177,0)
 . D HISTORY^PSBMLHS(.ORROOT,DFN,ORPSID)  ; DBIA #3459 for BCMA v2.0
"RTN","ORWPS",178,0)
 ; If the order has a Display Group of IV MEDICATION the use the Pharmacy order number to get the MAH
"RTN","ORWPS",179,0)
 I $P($G(^OR(100,+ORIFN,0)),U,11)=ISIV!($P($G(^OR(100,+ORIFN,0)),U,11)=HPIV) D  Q
"RTN","ORWPS",180,0)
 . I 'CKPKG S @ORROOT@(0)="Medication Administration History is not available at this time for IV fluids."
"RTN","ORWPS",181,0)
 . I CKPKG D
"RTN","ORWPS",182,0)
 . . D RPC^PSBO(.ORROOT,"PM",DFN,"","","","","","","","","",ORPHMID)  ;DBIA #3955
"RTN","ORWPS",183,0)
 . . I '$D(@ORROOT) S @ORROOT@(0)="No Medication Administration History found for the IV order."
"RTN","ORWPS",184,0)
 I '$L($T(HISTORY^PSBMLHS)) D  Q
"RTN","ORWPS",185,0)
 . S @ORROOT@(0)="This report is only available using BCMA version 2.0."
"RTN","ORWPS",186,0)
 D HISTORY^PSBMLHS(.ORROOT,DFN,ORPSID)  ; DBIA #3459 for BCMA v2.0
"RTN","ORWPS",187,0)
 Q
"RTN","ORWPS",188,0)
 ;
"RTN","ORWPS",189,0)
REASON(ORY) ; -- Return Non-VA Med Statement/Reasons
"RTN","ORWPS",190,0)
 N ORE
"RTN","ORWPS",191,0)
 D GETLST^XPAR(.ORY,"ALL","ORWD NONVA REASON","E")
"RTN","ORWPS",192,0)
 Q
"VER")
8.0^22.0
"BLD",7361,6)
^250
**END**
**END**
