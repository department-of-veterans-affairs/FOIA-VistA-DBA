Released MC*2.3*25 SEQ #23
Extracted from mail message
**KIDS**:MC*2.3*25^

**INSTALL NAME**
MC*2.3*25
"BLD",1886,0)
MC*2.3*25^MEDICINE^0^2990830^y
"BLD",1886,1,0)
^^1^1^2990702^
"BLD",1886,1,1,0)
See patch MC*2.3*25 patch description.
"BLD",1886,4,0)
^9.64PA^700.2^3
"BLD",1886,4,700,0)
700
"BLD",1886,4,700,2,0)
^9.641^700^1
"BLD",1886,4,700,2,700,0)
PULMONARY FUNCTION TESTS  (File-top level)
"BLD",1886,4,700,2,700,1,0)
^9.6411^3^2
"BLD",1886,4,700,2,700,1,3,0)
HEIGHT (INCHES.TENTHS)
"BLD",1886,4,700,2,700,1,19,0)
DLCO-SB
"BLD",1886,4,700,222)
y^y^p^^^^n
"BLD",1886,4,700.1,0)
700.1
"BLD",1886,4,700.1,2,0)
^9.641^700.1^1
"BLD",1886,4,700.1,2,700.1,0)
PFT PREDICTED VALUES  (File-top level)
"BLD",1886,4,700.1,2,700.1,1,0)
^9.6411^13.02^2
"BLD",1886,4,700.1,2,700.1,1,13.01,0)
MVV CORR.-BLACK
"BLD",1886,4,700.1,2,700.1,1,13.02,0)
MVV CORR.-ORIENTAL
"BLD",1886,4,700.1,222)
y^y^p^^^^n
"BLD",1886,4,700.2,0)
700.2
"BLD",1886,4,700.2,2,0)
^9.641^700.2^1
"BLD",1886,4,700.2,2,700.2,0)
PFT FORMULA  (File-top level)
"BLD",1886,4,700.2,2,700.2,1,0)
^9.6411^1^1
"BLD",1886,4,700.2,2,700.2,1,1,0)
TYPE
"BLD",1886,4,700.2,222)
y^y^p^^^^n
"BLD",1886,4,"APDD",700,700)

"BLD",1886,4,"APDD",700,700,3)

"BLD",1886,4,"APDD",700,700,19)

"BLD",1886,4,"APDD",700.1,700.1)

"BLD",1886,4,"APDD",700.1,700.1,13.01)

"BLD",1886,4,"APDD",700.1,700.1,13.02)

"BLD",1886,4,"APDD",700.2,700.2)

"BLD",1886,4,"APDD",700.2,700.2,1)

"BLD",1886,4,"B",700,700)

"BLD",1886,4,"B",700.1,700.1)

"BLD",1886,4,"B",700.2,700.2)

"BLD",1886,"ABPKG")
n
"BLD",1886,"KRN",0)
^9.67PA^19^18
"BLD",1886,"KRN",.4,0)
.4
"BLD",1886,"KRN",.401,0)
.401
"BLD",1886,"KRN",.402,0)
.402
"BLD",1886,"KRN",.403,0)
.403
"BLD",1886,"KRN",.5,0)
.5
"BLD",1886,"KRN",.84,0)
.84
"BLD",1886,"KRN",3.6,0)
3.6
"BLD",1886,"KRN",3.8,0)
3.8
"BLD",1886,"KRN",9.2,0)
9.2
"BLD",1886,"KRN",9.8,0)
9.8
"BLD",1886,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",1886,"KRN",9.8,"NM",1,0)
MCPFTP1^^0^B25636040
"BLD",1886,"KRN",9.8,"NM",2,0)
MCBPFTP1^^0^B25461040
"BLD",1886,"KRN",9.8,"NM",3,0)
MCPFTP2A^^0^B17926565
"BLD",1886,"KRN",9.8,"NM",4,0)
MCBPFTP3^^0^B9492116
"BLD",1886,"KRN",9.8,"NM",5,0)
MCPFTP5^^0^B22932646
"BLD",1886,"KRN",9.8,"NM",6,0)
MCBPFTP7^^0^B5052876
"BLD",1886,"KRN",9.8,"NM",7,0)
MCPFTSS^^0^B1179765
"BLD",1886,"KRN",9.8,"NM",8,0)
MCPFTE^^0^B9808321
"BLD",1886,"KRN",9.8,"NM",9,0)
MCPFTI^^0^B11633759
"BLD",1886,"KRN",9.8,"NM","B","MCBPFTP1",2)

"BLD",1886,"KRN",9.8,"NM","B","MCBPFTP3",4)

"BLD",1886,"KRN",9.8,"NM","B","MCBPFTP7",6)

"BLD",1886,"KRN",9.8,"NM","B","MCPFTE",8)

"BLD",1886,"KRN",9.8,"NM","B","MCPFTI",9)

"BLD",1886,"KRN",9.8,"NM","B","MCPFTP1",1)

"BLD",1886,"KRN",9.8,"NM","B","MCPFTP2A",3)

"BLD",1886,"KRN",9.8,"NM","B","MCPFTP5",5)

"BLD",1886,"KRN",9.8,"NM","B","MCPFTSS",7)

"BLD",1886,"KRN",19,0)
19
"BLD",1886,"KRN",19.1,0)
19.1
"BLD",1886,"KRN",101,0)
101
"BLD",1886,"KRN",409.61,0)
409.61
"BLD",1886,"KRN",771,0)
771
"BLD",1886,"KRN",869.2,0)
869.2
"BLD",1886,"KRN",870,0)
870
"BLD",1886,"KRN",8994,0)
8994
"BLD",1886,"KRN","B",.4,.4)

"BLD",1886,"KRN","B",.401,.401)

"BLD",1886,"KRN","B",.402,.402)

"BLD",1886,"KRN","B",.403,.403)

"BLD",1886,"KRN","B",.5,.5)

"BLD",1886,"KRN","B",.84,.84)

"BLD",1886,"KRN","B",3.6,3.6)

"BLD",1886,"KRN","B",3.8,3.8)

"BLD",1886,"KRN","B",9.2,9.2)

"BLD",1886,"KRN","B",9.8,9.8)

"BLD",1886,"KRN","B",19,19)

"BLD",1886,"KRN","B",19.1,19.1)

"BLD",1886,"KRN","B",101,101)

"BLD",1886,"KRN","B",409.61,409.61)

"BLD",1886,"KRN","B",771,771)

"BLD",1886,"KRN","B",869.2,869.2)

"BLD",1886,"KRN","B",870,870)

"BLD",1886,"KRN","B",8994,8994)

"BLD",1886,"QUES",0)
^9.62^^
"BLD",1886,"REQB",0)
^9.611^1^1
"BLD",1886,"REQB",1,0)
MC*2.3*23^2
"BLD",1886,"REQB","B","MC*2.3*23",1)

"FIA",700)
PULMONARY FUNCTION TESTS
"FIA",700,0)
^MCAR(700,
"FIA",700,0,0)
700
"FIA",700,0,1)
y^y^p^^^^n
"FIA",700,0,10)

"FIA",700,0,11)

"FIA",700,0,"RLRO")

"FIA",700,0,"VR")
2.3^MC
"FIA",700,700)
1
"FIA",700,700,3)

"FIA",700,700,19)

"FIA",700.1)
PFT PREDICTED VALUES
"FIA",700.1,0)
^MCAR(700.1,
"FIA",700.1,0,0)
700.1
"FIA",700.1,0,1)
y^y^p^^^^n
"FIA",700.1,0,10)

"FIA",700.1,0,11)

"FIA",700.1,0,"RLRO")

"FIA",700.1,0,"VR")
2.3^MC
"FIA",700.1,700.1)
1
"FIA",700.1,700.1,13.01)

"FIA",700.1,700.1,13.02)

"FIA",700.2)
PFT FORMULA
"FIA",700.2,0)
^MCAR(700.2,
"FIA",700.2,0,0)
700.2I
"FIA",700.2,0,1)
y^y^p^^^^n
"FIA",700.2,0,10)

"FIA",700.2,0,11)

"FIA",700.2,0,"RLRO")

"FIA",700.2,0,"VR")
2.3^MC
"FIA",700.2,700.2)
1
"FIA",700.2,700.2,1)

"MBREQ")
0
"PKG",31,-1)
1^1
"PKG",31,0)
MEDICINE^MC^MEDICINE PACKAGE INCLUDES ALL AREAS OF MEDICINE
"PKG",31,20,0)
^9.402P^^
"PKG",31,22,0)
^9.49I^1^1
"PKG",31,22,1,0)
2.3^2960913^2980615^4558
"PKG",31,22,1,"PAH",1,0)
25^2990830^363
"PKG",31,22,1,"PAH",1,1,0)
^^1^1^2990830
"PKG",31,22,1,"PAH",1,1,1,0)
See patch MC*2.3*25 patch description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","MCBPFTP1")
0^2^B25461040
"RTN","MCBPFTP1",1,0)
MCBPFTP1 ;WISC/TJK,ALG-PFT BRIEF REPORT-DEMO INFO ;7/28/99  13:27
"RTN","MCBPFTP1",2,0)
 ;;2.3;Medicine;**5,14,16,17,22,25**;09/13/1996
"RTN","MCBPFTP1",3,0)
 ; ------------------------
"RTN","MCBPFTP1",4,0)
 ; SSN = Enternal Format of the patients SSN with the first letter
"RTN","MCBPFTP1",5,0)
 ; of the last name tacked on the end
"RTN","MCBPFTP1",6,0)
 ; ------------------------
"RTN","MCBPFTP1",7,0)
 D DEM^VADPT S MCARGNM=VADM(1),SSN=VA("PID")
"RTN","MCBPFTP1",8,0)
 S X1=$E($P(MCPFT0,U),1,7),X2=$P(VADM(3),U)
"RTN","MCBPFTP1",9,0)
 ; ---------------------
"RTN","MCBPFTP1",10,0)
 ; AGE = the patients age at the date of the procedure
"RTN","MCBPFTP1",11,0)
 ; ---------------------
"RTN","MCBPFTP1",12,0)
 S AGE=$E(X1,1,3)-$E(X2,1,3)-($E(X1,4,7)<$E(X2,4,7))
"RTN","MCBPFTP1",13,0)
 S RACE=$P(VADM(8),U,2),CLIN="" S:$P(MCPFT0,U,10) CLIN=$P(MCPFT0,U,10) I CLIN,$D(^SC(CLIN,0)) S CLIN=$P(^(0),U)
"RTN","MCBPFTP1",14,0)
 S DATE=$P(MCPFT0,U),DATE=+$E(DATE,4,5)_"/"_+$E(DATE,6,7)_"/"_$E(DATE,2,3)_$S($P(DATE,".",2):"@"_+$E(DATE,9,10)_":"_$S($L($E(DATE,11,12))=2:$E(DATE,11,12),$L($E(DATE,11,12))=1:$E(DATE,11)_"0",1:"00"),1:"")
"RTN","MCBPFTP1",15,0)
 N HTCM,HTIN,WTKG,WTLB
"RTN","MCBPFTP1",16,0)
 S (HTIN,HT1)=$P(MCPFT0,U,4),(HTCM,HT)=$P($$LENGTH^XLFMSMT(HTIN,"IN","CM")," ")
"RTN","MCBPFTP1",17,0)
 S (WTLB,WT1)=$P(MCPFT0,U,5),(WTKG,WT)=$P($$WEIGHT^XLFMSMT(WTLB,"LB","KG")," ")
"RTN","MCBPFTP1",18,0)
 I HT'>0 S (HTCM,HT)=$P(MCPFT0,U,3),(HTIN,HT1)=$P($$LENGTH^XLFMSMT(HTCM,"CM","IN")," ")
"RTN","MCBPFTP1",19,0)
 I WT'>0 S (WTKG,WT)=$P(MCPFT0,U,6),(WTLB,WT1)=$P($$WEIGHT^XLFMSMT(WTKG,"KG","LB")," ")
"RTN","MCBPFTP1",20,0)
 S $P(MCDOT,".",81)=""
"RTN","MCBPFTP1",21,0)
 ;S HT1=$P(MCPFT0,U,4),WT1=$P(MCPFT0,U,5) S $P(MCDOT,".",81)=""
"RTN","MCBPFTP1",22,0)
 ;S HT=HT1*2.54,WT=WT1/2.2
"RTN","MCBPFTP1",23,0)
 ;S:'HT HT=$P(MCPFT0,U,3),HT1=HT/2.54 S:'WT WT=$P(MCPFT0,U,6),WT1=WT*2.2
"RTN","MCBPFTP1",24,0)
 S (MC17,MCEFF,MCSEX)="" S:$D(^MCAR(700,MCARGDA,17)) MC17=^(17),MCEFF=$P(MC17,U,6),MCEFF=$S(MCEFF="G":"GOOD",MCEFF="E":"EXCELLENT",MCEFF="P":"POOR",1:"")
"RTN","MCBPFTP1",25,0)
 ;S MCSEX=$P(VADM(5),U),X=$P(VADM(3),"^",2) S MCARDOB=$S(X'="":X,1:""),X=$P(MCPFT0,U) D DTIME^MCARP S MCARGDT=X,MCARZ="PULMONARY FUNCTION TEST"
"RTN","MCBPFTP1",26,0)
 S MCSEX=$P(VADM(5),U),X=$P(VADM(3),"^",2) S MCARDOB=$S(X'="":X,1:""),X=$P(MCPFT0,U),MCARGDT=X,MCARZ="PULMONARY FUNCTION TEST"
"RTN","MCBPFTP1",27,0)
 D INP^VADPT S MCARWARD=$S(VAIN(4)'="":$P(VAIN(4),U,2),1:"NOT INPATIENT"),MCARRB=VAIN(5) D NOW^%DTC S X=% D DTIME^MCARP S MCARDTM=X
"RTN","MCBPFTP1",28,0)
 S MCARZ="PULMONARY FUNCTION TEST"
"RTN","MCBPFTP1",29,0)
 D INIT^MCARP1(MCARZ,MCARGDT,MCFILE),HEAD^MCARP
"RTN","MCBPFTP1",30,0)
 W !,"SEX: ",MCSEX,"  AGE:",AGE,?30,HT1," in/",WT1," lb",?60,"AMBIENT: ",$P(MCPFT0,U,12),"C/",$P(MCPFT0,U,7),"T" K HT1,WT1
"RTN","MCBPFTP1",31,0)
 W !,RACE S TECH=$$GETVALUE^MCU(700,MCARGDA,34)
"RTN","MCBPFTP1",32,0)
 W ?60,"TECH: ",$E(TECH,1,14)
"RTN","MCBPFTP1",33,0)
 W !,$S($P(MCPFT0,U,8)="Y":"SMOKER",$P(MCPFT0,U,8)="N":"NON-SMOKER",1:"")
"RTN","MCBPFTP1",34,0)
 W ?30 W:$P(MCPFT0,U,9)="Y" "CURRENT BRONCHODILATOR USE"
"RTN","MCBPFTP1",35,0)
 W ?60,"EFFORT: ",MCEFF
"RTN","MCBPFTP1",36,0)
 S MCFF="S DN=1,MCY="""" I $Y>(IOSL-3) R:$E(IOST,1,2)=""C-"" !!,""Press Return to Continue, '^' to escape: "",MCY:DTIME S:'$T MCY=U S:MCY=U MCOUT=1,DN=0 Q:$D(MCOUT)  D:DN HEAD^MCARP D:$D(HEAD1) HEAD1^MCBPFTP2,HEAD2^MCBPFTP2 K MCY"
"RTN","MCBPFTP1",37,0)
 K ^UTILITY("DIQ1",$J) W !!,"CONSULT DX: " S DR(700.01)=.01,DIQ(0)="E",DIC="^MCAR(700,"
"RTN","MCBPFTP1",38,0)
 F K=0:0 S K=$O(^MCAR(700,MCARGDA,1,K)) Q:K'?1N.N  S DA=MCARGDA,DA(700.01)=K,DR=11,DIQ(0)="E" D EN^DIQ1 I $D(^UTILITY("DIQ1",$J,700.01,K,.01,"E"))#2 W ?15,^("E"),! X MCFF Q:$D(MCOUT)
"RTN","MCBPFTP1",39,0)
 K ^UTILITY("DIQ1",$J),DIQ Q:$D(MCOUT)  W !,MCDOT X MCFF Q:$D(MCOUT)  D PRED
"RTN","MCBPFTP1",40,0)
 S RDATE=9999999.9999-$P(MCPFT0,U)
"RTN","MCBPFTP1",41,0)
 W:$D(MCRCN) !,MCRCN D ^MCBPFTP2
"RTN","MCBPFTP1",42,0)
 I '$D(MCOUT),$G(MCESON) D FOOTER^MCESPRT(MCFILE,MCARGDA)  ;PATCH 28
"RTN","MCBPFTP1",43,0)
EXIT D:$D(ZTSK) KILL^%ZTLOAD K ZTSK
"RTN","MCBPFTP1",44,0)
EXIT1 D KVAR^VADPT K MCOUT,ACT,AGE,CK,CLIN,D0,D1,DA,DATE,CI95
"RTN","MCBPFTP1",45,0)
 K MCARGDT2,^UTILITY($J)
"RTN","MCBPFTP1",46,0)
 K BSA,HB,PH,PACO2,PAO2,O2HB,COHB,FIO2,MHB,PAAO2,QSQT,CAO2,CVO2
"RTN","MCBPFTP1",47,0)
 K DFN,DIC,DIW,DIWL,DIWR,DIWT,DLCOSB,DN,MCDOT,DR,FEV1,FRC,FVC,MC17
"RTN","MCBPFTP1",48,0)
 K HT,I,J,K,MCARGDA,MCARGNM,MCFF,MCK,MCN,MCPI,MCREC,MCREC1,MCVCN
"RTN","MCBPFTP1",49,0)
 K MCREC2,MCTLCN,MCVN,MCX,MEAS,FEF2575,ND,ND1,P1,P2,PC,PD1,PD11,MCEFF
"RTN","MCBPFTP1",50,0)
 K PD2,PD21,PF,MCPFT0,PG,PRED,MCPV,RACE,RDATE,RDATE1,RDATE2,RV,MCSEX
"RTN","MCBPFTP1",51,0)
 K SSN,TAB,TECH,TLC,TYPE,UNIT,UNITS,VC,WT,X,Z,VA,MCRCN
"RTN","MCBPFTP1",52,0)
 K MCMVVN,MVV,PMVV,MCSP,MCP1S0,MCP1S1,MCP1S2,MCP2S0,MCP2S1,MCP2S2
"RTN","MCBPFTP1",53,0)
 K CDLCOSB,MCIAO1,MCIAO2,MCIDA,MCIDL,MCIDP,MCIFA,MCIFE
"RTN","MCBPFTP1",54,0)
 K MCIFL,MCIFV,MCIPTL,MCIRV,MCITL,MCMAIN,MCP1,MCP2,MCRC,MCRCR,MCTYPEP,MCY,MCRC1,MCRC2,MCRC3,MCRC4   ;,MCARGDA
"RTN","MCBPFTP1",55,0)
 K MCARRB,MCARDOB,MCARWARD,MCARDTM,MCARHDR,MCARZ,MCARGDT,MCDL,MCLNG D KVAR^VADPT D ^%ZISC Q
"RTN","MCBPFTP1",56,0)
PRED S (FVC,CFVC,FEV1,F,TLC,MVV)=""
"RTN","MCBPFTP1",57,0)
 Q:'HT!'WT!'AGE!'$D(^MCAR(700,MCARGDA,"PV"))  Q:'(^("PV"))
"RTN","MCBPFTP1",58,0)
 S MCPV=^MCAR(700,MCARGDA,"PV") Q:'$D(^MCAR(700.1,MCPV))
"RTN","MCBPFTP1",59,0)
 S BSA=$$BSA^MCPFTP1(HT,WT)
"RTN","MCBPFTP1",60,0)
 F I="FEV1","FVC","TLC","MVV" D
"RTN","MCBPFTP1",61,0)
    .S:$D(^MCAR(700.1,MCPV,I)) @("P"_I)="S "_I_"="_$P(^MCAR(700.2,^MCAR(700.1,MCPV,I),0),U),@("C"_I)=$P(^MCAR(700.2,^MCAR(700.1,MCPV,I),0),U,5) X:$D(^MCAR(700.1,MCPV,I)) @("P"_I)
"RTN","MCBPFTP1",62,0)
 K PDLCOSB,PFEV1,PFRC,PFVC,PFEF2575,PPF,PRV,PTLC,PVC
"RTN","MCBPFTP1",63,0)
 S MCRCR="",MCRC=$G(^MCAR(700.1,MCPV,"RC")) Q:MCRC=""
"RTN","MCBPFTP1",64,0)
 S MCRCR=$G(^MCAR(700,MCARGDA,17)) Q:MCRCR=""  Q:$P(MCRCR,U,5)'="Y"
"RTN","MCBPFTP1",65,0)
 S MCRCR=$S(RACE["BLACK":"B",RACE["ASIAN":"O",1:"") Q:MCRCR=""
"RTN","MCBPFTP1",66,0)
 F I=1:1:6 I $P(MCRC,U,I) S J=$P(MCRC,U,I) D:J
"RTN","MCBPFTP1",67,0)
    .Q:'$D(^MCAR(700.2,J,0))  S J=$P(^(0),U,1)
"RTN","MCBPFTP1",68,0)
    .S @("MCRC"_I)="S PRED="_J
"RTN","MCBPFTP1",69,0)
 K J G ORIENTAL:MCRCR="O" K MCRC2,MCRC6
"RTN","MCBPFTP1",70,0)
 I '$D(MCRC1),'$D(MCRC3),'$D(MCRC4),'$D(MCRC5) Q
"RTN","MCBPFTP1",71,0)
 S:$D(MCRC1) MCRCN="TLC,FVC,FEV1" S:$D(MCRC3) MCRCN=MCRCN_",FRC,RV" S:$D(MCRC4) MCRCN=MCRCN_",FEF25-75" S:$D(MCRC5) MCRCN=MCRCN_",MVV" S:$E(MCRCN,1)="," MCRCN=$E(MCRCN,2,35)
"RTN","MCBPFTP1",72,0)
 G NOTE
"RTN","MCBPFTP1",73,0)
ORIENTAL I '$D(MCRC2),'$D(MCRC6) K MCRC1,MCRC3,MCRC4,MCRC5 Q
"RTN","MCBPFTP1",74,0)
 S:$D(MCRC2) MCRC1=MCRC2 S:$D(MCRC6) MCRC5=MCRC6 K MCRC3,MCRC4,MCRC6 S MCRCN="TLC,FVC,FEV1,MVV"
"RTN","MCBPFTP1",75,0)
NOTE S MCRCN="NOTE: Race Correction on predicted values: "_MCRCN
"RTN","MCBPFTP1",76,0)
 Q
"RTN","MCBPFTP3")
0^4^B9492116
"RTN","MCBPFTP3",1,0)
MCBPFTP3 ;WISC/TJK,ALG-PFT BRIEF REPORT-FLOWS ;6/24/99  08:58
"RTN","MCBPFTP3",2,0)
 ;;2.3;Medicine;**17,25**;09/13/1996
"RTN","MCBPFTP3",3,0)
FLOW G ABG:'$D(^MCAR(700,MCARGDA,4)),ABG:'$O(^(4,0)) S MCX=0
"RTN","MCBPFTP3",4,0)
 I '$D(HEAD1) S HEAD1="FLOWS" D HEAD1^MCBPFTP2,HEAD2^MCBPFTP2
"RTN","MCBPFTP3",5,0)
 E  S HEAD1="FLOWS" D HEAD2^MCBPFTP2
"RTN","MCBPFTP3",6,0)
 Q:$D(MCOUT)
"RTN","MCBPFTP3",7,0)
 I MC17'="" S MC17A=$P(MC17,U,2) W ?3,"MACHINE: ",$S(MC17A="F":"FLOW TURBINE",MC17A="P":"PNEUMOTACH",MC17A="A":"ANEMOMETER",MC17A="DS":"DRY WATER SEAL",MC17A="WS":"WATER SEAL",MC17A="W":"WEDGE",1:"") X MCFF K MC17A Q:$D(MCOUT)
"RTN","MCBPFTP3",8,0)
FLOW1 S MCX=$O(^MCAR(700,MCARGDA,4,MCX)) G ABG:MCX'?1N.N S MCREC=^(MCX,0),TYPE=$P(MCREC,U)
"RTN","MCBPFTP3",9,0)
 W !! X MCFF Q:$D(MCOUT)
"RTN","MCBPFTP3",10,0)
 S ND="AF",ND1=4 D PRETEST^MCBPFTP2
"RTN","MCBPFTP3",11,0)
 W ?5,$S(TYPE="S":"STANDARD STUDY",TYPE="B":"AFTER BRONCHODILATOR",TYPE="I":"AFTER INHALATION CHALLENGE",1:"AFTER EXERCISE") X MCFF Q:$D(MCOUT)  D PREVDATE^MCBPFTP2
"RTN","MCBPFTP3",12,0)
 I $P(MCREC,U,6)'="" W !,?5,"(NOTES): ",$P(MCREC,U,6) X MCFF Q:$D(MCOUT)
"RTN","MCBPFTP3",13,0)
 S ACT=$P(MCREC,U,2) I ACT S MEAS="FVC",UNITS="L",PRED=FVC X:$D(MCRC1) MCRC1 S PC=2,CI95=$S(PRED:PRED-CFVC,1:"") D PRTLINE S:TYPE="S" MCIFA=ACT,MCIFL=CI95 Q:$D(MCOUT)
"RTN","MCBPFTP3",14,0)
 S ACT=$P(MCREC,U,3) I ACT S MEAS="FEV1",UNITS="L",PRED=FEV1 X:$D(MCRC1) MCRC1 S PC=3,CI95=$S(PRED:PRED-CFEV1,1:"") D PRTLINE S:TYPE="S" MCIFE=ACT Q:$D(MCOUT)
"RTN","MCBPFTP3",15,0)
 S MCDL=2,MCLNG=5,ACT=$P(MCREC,U,7) I ACT S MEAS="MVV",UNITS="L/MIN",PRED=MVV X:$D(MCRC5) MCRC5 S PC=7,CI95=$S(PRED:PRED-CMVV,1:"") S:TYPE="S" MCMVVN=ACT D PRTLINE Q:$D(MCOUT)
"RTN","MCBPFTP3",16,0)
 ;write out actual FEV1/FVC*100 from elements in MCREC 
"RTN","MCBPFTP3",17,0)
 I $P(MCREC,U,2),$P(MCREC,U,3) W !,?5,"FEV1/FVC",?17,"%" S ACT=$P(MCREC,U,3)/$P(MCREC,U,2) W ?35,$J(ACT*100,5,0) S:TYPE="S" MCIFV=ACT X MCFF Q:$D(MCOUT)
"RTN","MCBPFTP3",18,0)
 G FLOW1
"RTN","MCBPFTP3",19,0)
ABG G ^MCBPFTP4
"RTN","MCBPFTP3",20,0)
PRTLINE S MCP1=$G(MCP1),MCP2=$G(MCP2)
"RTN","MCBPFTP3",21,0)
 W !,?5,MEAS,?15,UNITS,?25,$S(PRED:$J(PRED,MCLNG,MCDL),1:""),?35,$J(ACT,MCLNG,MCDL),?45,$S(PRED:$J(ACT/PRED*100,5,1),1:"") W:$P(MCP1,U,PC) ?55,$J($P(MCP1,U,PC),MCLNG,MCDL) W:$P(MCP2,U,PC) ?65,$J($P(MCP2,U,PC),MCLNG,MCDL)
"RTN","MCBPFTP3",22,0)
 W:(CI95)&(CI95'=PRED) ?72,$J(CI95,6,2) X MCFF Q
"RTN","MCBPFTP7")
0^6^B5052876
"RTN","MCBPFTP7",1,0)
MCBPFTP7 ;WISC/TJK,ALG-PFT BRIEF REPORT-SPECIAL STUDIES (PT 2) ;6/29/99  12:48
"RTN","MCBPFTP7",2,0)
 ;;2.3;Medicine;**25**;09/13/1996
"RTN","MCBPFTP7",3,0)
INT ;
"RTN","MCBPFTP7",4,0)
 K DXS,DIOT(2),^UTILITY($J) S ^UTILITY($J,1)=MCFF,D0=MCARGDA ;I $G(MCBP)=1 D ^MCOBPF
"RTN","MCBPFTP7",5,0)
 ;E  D ^MCAROPF
"RTN","MCBPFTP7",6,0)
 I $G(MCBP)=1 D
"RTN","MCBPFTP7",7,0)
 . D ^MCOBPF
"RTN","MCBPFTP7",8,0)
 . Q
"RTN","MCBPFTP7",9,0)
 E  D
"RTN","MCBPFTP7",10,0)
 . D ^MCAROPF
"RTN","MCBPFTP7",11,0)
 . Q
"RTN","MCBPFTP7",12,0)
EXIT Q:$E(MCDOT)=" "  D CONT Q:$D(MCOUT)  D PV Q
"RTN","MCBPFTP7",13,0)
PV Q:'$D(MCPV)  Q:'$D(^MCAR(700.1,MCPV))
"RTN","MCBPFTP7",14,0)
 D HEAD^MCARP W !!?25,"PREDICTED VALUE FORMULAS USED",!
"RTN","MCBPFTP7",15,0)
 F J="TLC","FVC","FEV1","MVV" D
"RTN","MCBPFTP7",16,0)
   .S I=$G(^MCAR(700.1,MCPV,J)) Q:'I
"RTN","MCBPFTP7",17,0)
   .Q:'$D(^MCAR(700.2,I,0))  S I=$G(^(0))
"RTN","MCBPFTP7",18,0)
   .W !,?5,$S(J="DLCOSB":"DLCO-SB",J="FEF2575":"FEF25-75",J="COHB":"COHB CORR.",J="HB":"HB CORR.",1:J)
"RTN","MCBPFTP7",19,0)
   .D PVW
"RTN","MCBPFTP7",20,0)
   .K J Q
"RTN","MCBPFTP7",21,0)
 G PVEXIT:'$D(MCRC1)
"RTN","MCBPFTP7",22,0)
 W !!?25,"RACE CORRECTION FORMULAS USED",!
"RTN","MCBPFTP7",23,0)
 ;I $D(MCRC2) S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,2) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,"TLC,FVC,FEV1" D PVW G PVEXIT
"RTN","MCBPFTP7",24,0)
 I $D(MCRC2) D  G PVEXIT
"RTN","MCBPFTP7",25,0)
 . F J=2,6 S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,J) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,$S(J=2:"TLC,FVC,FEV1",J=6:"MVV",1:"") D PVW
"RTN","MCBPFTP7",26,0)
 . Q
"RTN","MCBPFTP7",27,0)
 ;F J=1 S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,J) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,$S(J=1:"TLC,FVC,FEV1") D PVW
"RTN","MCBPFTP7",28,0)
 F J=1,5 S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,J) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,$S(J=1:"TLC,VC,FVC,FEV1",J=5:"MVV",1:"") D PVW
"RTN","MCBPFTP7",29,0)
PVEXIT W !,"NOTE:  HT=height,WT=weight,ACT=actual measurement value" D CONT Q
"RTN","MCBPFTP7",30,0)
PVW W ?21,$P(I,U),?50,$P(I,U,3) Q
"RTN","MCBPFTP7",31,0)
CONT Q:$E(IOST,1,2)'="C-"  R !,"Press Return to Continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:MCY=U MCOUT=1 Q
"RTN","MCBPFTP7",32,0)
COMP S I=0 F  S I=$O(^MCAR(700,MCARGDA,24,I)) Q:I'?1N.N  I $D(^(I,0)),$P(^(0),U,2)="Y" S J=$P(^(0),U,1) W:$D(^MCAR(693.2,J,0)) ?17,$P(^(0),U,1),!
"RTN","MCBPFTP7",33,0)
 Q
"RTN","MCPFTE")
0^8^B9808321
"RTN","MCPFTE",1,0)
MCPFTE ;WISC/TJK-PULMONARY FUNCTION TEST ENTER/EDIT ;7/9/99  10:08
"RTN","MCPFTE",2,0)
 ;;2.3;Medicine;**25**;09/13/1996
"RTN","MCPFTE",3,0)
DIC ;
"RTN","MCPFTE",4,0)
 D MCEPROC^MCARE,DATE^MCAREH
"RTN","MCPFTE",5,0)
 S DIC="^MCAR(700,",DIC(0)="AEQLMZ",(DLAYGO,DIDEL,MCFILE)=700
"RTN","MCPFTE",6,0)
 I MCESON S DIC("S")=$$PREEDIT^MCESSCR(MCFILE)
"RTN","MCPFTE",7,0)
 D ^DIC K DIC,DLAYGO G EXIT:Y<0
"RTN","MCPFTE",8,0)
 I $D(DTOUT),'$P(Y(0),U,2) S DIK="^MCAR(700,",DA=+Y D ^DIK G EXIT
"RTN","MCPFTE",9,0)
 S DFN=$P(Y(0),U,2),MCARGDA=+Y
"RTN","MCPFTE",10,0)
 I MCESON,$$ESTONUM^MCESSCR(MCFILE,MCARGDA)>2 D ESRC^MCESSCR(MCFILE,MCARGDA) I '$D(MCBACK) G EXIT
"RTN","MCPFTE",11,0)
 D:$D(MCBACK) BACK
"RTN","MCPFTE",12,0)
 D DEM^VADPT S MCSEX=$P(VADM(5),U),MCRACE=$P(VADM(8),U,2) D KVAR^VADPT
"RTN","MCPFTE",13,0)
 I MCRACE="" D RACEMSG^MCPFTSS
"RTN","MCPFTE",14,0)
 S MCRACE=$S(MCRACE["ASIAN":"",MCRACE["BLACK":"B",1:"") K:MCRACE="" MCRACE
"RTN","MCPFTE",15,0)
 S DIE="^MCAR(700,",DA=MCARGDA
"RTN","MCPFTE",16,0)
 ; MFD 2-23-93 S DR=$S($G(MCBL)=1:"[MCPFTBRIEF]",1:"[MCPFTEDIT]")
"RTN","MCPFTE",17,0)
 S DR="["_MCEPROC_"]"
"RTN","MCPFTE",18,0)
 D ORDERA G EXIT:$D(DUOUT)!$D(DTOUT)
"RTN","MCPFTE",19,0)
 S DIE="^MCAR(700,",DA=MCARGDA
"RTN","MCPFTE",20,0)
 S DR="["_MCEPROC_"]"
"RTN","MCPFTE",21,0)
 D ^DIE,ORDER1,QTASK^MCPARAM
"RTN","MCPFTE",22,0)
 D ESRC^MCESSCR(MCFILE,MCARGDA)
"RTN","MCPFTE",23,0)
EXIT ; Leave gracefully
"RTN","MCPFTE",24,0)
 K DIC,DIK,DA,DIE,DR,DFN,MCRACE,DIWF,MCSEX,MCARGDA,DIR,DIDEL
"RTN","MCPFTE",25,0)
 K MCESON,MCESKEY,MCROUT,MCARCODE,MCEBRIEF,MCEFULL,MCPBRIEF,MCPFULL,MCPRTRTN,MCBS,MCPATFLD,MCSFULL,MCSBRIEF,MCBACK
"RTN","MCPFTE",26,0)
 Q
"RTN","MCPFTE",27,0)
ORDERA S MCARGNUM=$O(^MCAR(697.2,"C","MCAR(700",0)),MCFILE=700
"RTN","MCPFTE",28,0)
ORDER D:'$D(MCOEON) ORDER^MCPARAM Q:'$D(MCOEON)
"RTN","MCPFTE",29,0)
 S GMRCPRNM=$P(^MCAR(697.2,MCARGNUM,0),U,8)
"RTN","MCPFTE",30,0)
 S GMRCSR=MCARGDA_";"_"MCAR("_MCFILE_","
"RTN","MCPFTE",31,0)
 I $D(^MCAR(MCFILE,MCARGDA,"OR")),$P(^("OR"),U,2) S GMRCO=$P(^("OR"),U,2),ORIFN=$P(^("OR"),U) Q
"RTN","MCPFTE",32,0)
 S GMRCSS=$G(GMRCSS) ; WAA
"RTN","MCPFTE",33,0)
 K GMRCPNM D EN^GMRCR Q:$D(DTOUT)!$D(DUOUT)  S ^MCAR(MCFILE,MCARGDA,"OR")=$G(ORIFN)_U_$G(GMRCO) Q
"RTN","MCPFTE",34,0)
ORDER1 G IM:'$D(MCOEON) Q:'$D(^MCAR(MCFILE,MCARGDA))  I $D(DTOUT) S ORSTS=9 D RESULT^GMRCR Q
"RTN","MCPFTE",35,0)
 S DIR(0)="Y",DIR("A")="ORDER COMPLETE",DIR("B")="YES" D ^DIR
"RTN","MCPFTE",36,0)
 S ORSTS=$S(Y:2,1:9) D RESULT^GMRCR
"RTN","MCPFTE",37,0)
IM Q:$D(DTOUT)!$D(DUOUT)
"RTN","MCPFTE",38,0)
 D EN1^MCMAG
"RTN","MCPFTE",39,0)
 Q
"RTN","MCPFTE",40,0)
PVFASS ;Entry point to  Associate Predicted Value Formulas
"RTN","MCPFTE",41,0)
 S DIC("A")="Select the SEX for which the Predicted Value will be applied: "
"RTN","MCPFTE",42,0)
 S DIC="^MCAR(700.1,",DIC(0)="AEQM" D ^DIC I Y<0 D EXIT Q
"RTN","MCPFTE",43,0)
 S DIC(0)="AELQM"
"RTN","MCPFTE",44,0)
 S DIE=DIC,DA=+Y,DR=".01;1:10;12:15"
"RTN","MCPFTE",45,0)
 D ^DIE K DIC,DIE,DLAYGO,DA,DR G PVFASS
"RTN","MCPFTE",46,0)
PVFEDT ;Entry point to Enter/Edit Predicited Value Formulas
"RTN","MCPFTE",47,0)
 S DIC("A")="Select the Predicted Value Formula: "
"RTN","MCPFTE",48,0)
 S DIC(0)="AELQ",DLAYGO=700.2
"RTN","MCPFTE",49,0)
 S DIC=700.2,D="D" D IX^DIC I Y<0 D EXIT Q
"RTN","MCPFTE",50,0)
 S DIE=DIC,DA=+Y,DR=".01:9"
"RTN","MCPFTE",51,0)
 D ^DIE K DIC,DIE,DLAYGO,DA,DR G PVFEDT
"RTN","MCPFTE",52,0)
DISP N MCX S MCX=^MCAR(700.2,+Y,0)
"RTN","MCPFTE",53,0)
 W ?35,"REFERENCE: ",$P(MCX,U,3)
"RTN","MCPFTE",54,0)
 W !,?5,"SEX: ",$S($P(MCX,U,4)="F":"Female",$P(MCX,U,4)="M":"Male",1:"")
"RTN","MCPFTE",55,0)
 W !,?5,"CI: ",$P(MCX,U,5),?18,"SEE: ",$P(MCX,U,6)
"RTN","MCPFTE",56,0)
 W !,?5,"METHOD: ",$P(MCX,U,7)
"RTN","MCPFTE",57,0)
 W !,?5,"DEMOGRAPHICS: ",$P(MCX,U,8)
"RTN","MCPFTE",58,0)
 W !,?5,"SMOKERS INCLUDED: ",$S($P(MCX,U,9)="N":"NO",$P(MCX,U,9)="Y":"YES",1:""),?30,"ALTITUDE: ",$P(MCX,U,10),! Q
"RTN","MCPFTE",59,0)
BACK ;Set Y to the new record and allow the user to edit the new record
"RTN","MCPFTE",60,0)
 S Y=MCY,Y(0)=MCY(0),Y(0,0)=MCY(0,0),MCARGDA=+Y K MCY,DIROUT,DUOUT,DTOUT,EXIT
"RTN","MCPFTE",61,0)
 Q
"RTN","MCPFTI")
0^9^B11633759
"RTN","MCPFTI",1,0)
MCPFTI ;WISC/TJK-PFT INTERPRETATION ENTRY ;7/9/99  10:11
"RTN","MCPFTI",2,0)
 ;;2.3;Medicine;**25**;09/13/1996
"RTN","MCPFTI",3,0)
DIC ;
"RTN","MCPFTI",4,0)
 D MCEPROC^MCARE
"RTN","MCPFTI",5,0)
 S DIC="^MCAR(700,",DIC(0)="AEQMZ"
"RTN","MCPFTI",6,0)
 I MCESON S DIC("S")=$$PREEDIT^MCESSCR(MCFILE)
"RTN","MCPFTI",7,0)
 D ^DIC K DIC G EXIT:Y<0
"RTN","MCPFTI",8,0)
 S DFN=$P(Y(0),U,2),MCARGDA=+Y,MCARGDT=$P(Y,U,2)
"RTN","MCPFTI",9,0)
 I MCESON,$$ESTONUM^MCESSCR(MCFILE,MCARGDA)>2 D ESRC^MCESSCR(MCFILE,MCARGDA) G EXIT Q
"RTN","MCPFTI",10,0)
GETORDER D ORDERA G EXIT:$D(DUOUT)!$D(DTOUT)
"RTN","MCPFTI",11,0)
 D SETVAR^MCPFTP2
"RTN","MCPFTI",12,0)
 S RDATE=9999999.9999-$P(^MCAR(700,MCARGDA,0),U),MCPFT0=^(0),HT=$P(MCPFT0,U,4),WT=$P(MCPFT0,U,5),X1=$E($P(MCPFT0,U,1),1,7)
"RTN","MCPFTI",13,0)
 S HT=HT*2.54,WT=WT/2.2
"RTN","MCPFTI",14,0)
 S:'HT HT=$P(MCPFT0,U,3) S:'WT WT=$P(MCPFT0,U,6)
"RTN","MCPFTI",15,0)
 S MC17="" D DEM^VADPT S RACE=$P(VADM(8),U,2),MCSEX=$P(VADM(5),U),X2=$P(VADM(3),U) D ^%DTC
"RTN","MCPFTI",16,0)
 I RACE="" D RACEMSG^MCPFTSS
"RTN","MCPFTI",17,0)
 ; ---------------------
"RTN","MCPFTI",18,0)
 ; AGE = the patients age at the date of the procedure
"RTN","MCPFTI",19,0)
 ; ---------------------
"RTN","MCPFTI",20,0)
 S AGE=X\365.25 D PRED^MCPFTP1 W:$D(MCRCN) !,MCRCN
"RTN","MCPFTI",21,0)
 ;D INP^VADPT S MCARWARD=$S(VAIN(4)'="":$P(VAIN(4),U,2),1:"NOT INPATIENT"),MCARRB=VAIN(5) 
"RTN","MCPFTI",22,0)
 S MCARZ="PULMONARY FUNCTION TEST" D INIT^MCARP1(MCARZ,MCARGDT,MCFILE)
"RTN","MCPFTI",23,0)
 S DIR(0)="E"
"RTN","MCPFTI",24,0)
 D ^DIR
"RTN","MCPFTI",25,0)
 I 'Y G EXIT
"RTN","MCPFTI",26,0)
I W @IOF,"***INTERPRETATION ENTRY***"
"RTN","MCPFTI",27,0)
 S HEAD1="VOLUMES",MCX=0,$P(MCDOT," ",81)=""
"RTN","MCPFTI",28,0)
 S MCFF="S DN=1,MCY="""" I $Y>(IOSL-3) R:$E(IOST,1,2)=""C-"" !!,""Press Return to Continue, '^' to escape: "",MCY:DTIME S:'$T MCY=U S:MCY=U MCOUT=1,DN=0 Q:$D(MCOUT)  W:DN @IOF D HEAD^MCARP D:$D(HEAD1) HEAD1^MCPFTP2,HEAD2^MCPFTP2 K MCY"
"RTN","MCPFTI",29,0)
 D HEAD^MCARP,HEAD1^MCPFTP2,HEAD2^MCPFTP2 G EXIT:$D(MCOUT) D VOL^MCPFTP2 G EXIT:$D(MCOUT)
"RTN","MCPFTI",30,0)
PVPRT ;
"RTN","MCPFTI",31,0)
 S DIR(0)="E" D ^DIR G EXIT:'Y
"RTN","MCPFTI",32,0)
 W @IOF
"RTN","MCPFTI",33,0)
 D PV1^MCPFTP5 G EXIT:$D(MCOUT)
"RTN","MCPFTI",34,0)
ED D ^MCPFTIC G EXIT:$D(DUOUT)!$D(DTOUT)
"RTN","MCPFTI",35,0)
 S DIE="^MCAR(700,",DA=MCARGDA,DR="33.5;30;21;31;600"
"RTN","MCPFTI",36,0)
 ;MFD 2/10/93 DR(2,700.05)=.01
"RTN","MCPFTI",37,0)
 D ^DIE,ORDER1,QTASK^MCPARAM
"RTN","MCPFTI",38,0)
 D ESRC^MCESSCR(MCFILE,MCARGDA)
"RTN","MCPFTI",39,0)
 ;
"RTN","MCPFTI",40,0)
 ;    Allow the user to print a PFT report now
"RTN","MCPFTI",41,0)
 S DIR(0)="Y",DIR("A")="Print report now",DIR("B")="YES" ;    setup
"RTN","MCPFTI",42,0)
 D ^DIR ;    ask
"RTN","MCPFTI",43,0)
 I Y S TEMP=MCARGDA D ^MCPFTP1A S MCARGDA=TEMP D SUM^MCPFTP ;    yes, they want the report
"RTN","MCPFTI",44,0)
 ;
"RTN","MCPFTI",45,0)
EXIT D EXIT1^MCPFTP1 K A,J,F,SUB,FLD,NM,K,I,DIR,LN,DIRUT
"RTN","MCPFTI",46,0)
 K DIE,MCND,DA,DR,DBZZ
"RTN","MCPFTI",47,0)
 K MCAR,MCARDOB,MCARDTM,MCARHDR,MCARRB,MCARWARD,MCRHR,VADM,VAIN
"RTN","MCPFTI",48,0)
 K MCARP,MCFILE,MCESON,MCESKEY,MCROUT,MCTYPE
"RTN","MCPFTI",49,0)
 K MCPBRIEF,MCPFULL,MCPRTRTN,TEMP
"RTN","MCPFTI",50,0)
 Q
"RTN","MCPFTI",51,0)
ORDERA S MCARGNUM=$O(^MCAR(697.2,"C","MCAR(700",0)),MCFILE=700
"RTN","MCPFTI",52,0)
ORDER D:'$D(MCOEON) ORDER^MCPARAM Q:'$D(MCOEON)
"RTN","MCPFTI",53,0)
 S GMRCPRNM=$P(^MCAR(697.2,MCARGNUM,0),U,8)
"RTN","MCPFTI",54,0)
 S GMRCSR=MCARGDA_";"_"MCAR("_MCFILE_","
"RTN","MCPFTI",55,0)
 I $D(^MCAR(MCFILE,MCARGDA,"OR")),$P(^("OR"),U,2) S GMRCO=$P(^("OR"),U,2),ORIFN=$P(^("OR"),U) Q
"RTN","MCPFTI",56,0)
 S GMRCSS=$G(GMRCSS) ; WAA
"RTN","MCPFTI",57,0)
 K GMRCPNM D EN^GMRCR Q:$D(DTOUT)!$D(DUOUT)  S ^MCAR(MCFILE,MCARGDA,"OR")=$G(ORIFN)_U_$G(GMRCO) Q
"RTN","MCPFTI",58,0)
ORDER1 G IM:'$D(MCOEON) Q:'$D(^MCAR(MCFILE,MCARGDA))  I $D(DTOUT) S ORSTS=9 D RESULT^GMRCR Q
"RTN","MCPFTI",59,0)
 S DIR(0)="Y",DIR("A")="ORDER COMPLETE",DIR("B")="YES" D ^DIR
"RTN","MCPFTI",60,0)
 S ORSTS=$S(Y:2,1:9) D RESULT^GMRCR
"RTN","MCPFTI",61,0)
IM Q:$D(DTOUT)!$D(DUOUT)  D EN1^MCMAG Q
"RTN","MCPFTP1")
0^1^B25636040
"RTN","MCPFTP1",1,0)
MCPFTP1 ;WISC/TJK-PFT REPORT-DEMO INFO ;7/28/99  13:27
"RTN","MCPFTP1",2,0)
 ;;2.3;Medicine;**14,16,22,25**;09/13/1996
"RTN","MCPFTP1",3,0)
 ; ------------------------
"RTN","MCPFTP1",4,0)
 ; SSN = Enternal Format of the patients SSN with the first letter
"RTN","MCPFTP1",5,0)
 ; of the last name tacked on the end
"RTN","MCPFTP1",6,0)
 ; ------------------------
"RTN","MCPFTP1",7,0)
 D DEM^VADPT S MCARGNM=VADM(1),SSN=VA("PID")
"RTN","MCPFTP1",8,0)
 S X1=$E($P(MCPFT0,U),1,7),X2=$P(VADM(3),U)
"RTN","MCPFTP1",9,0)
 ; ---------------------
"RTN","MCPFTP1",10,0)
 ; AGE = the patients age at the date of the procedure
"RTN","MCPFTP1",11,0)
 ; ---------------------
"RTN","MCPFTP1",12,0)
 S AGE=$E(X1,1,3)-$E(X2,1,3)-($E(X1,4,7)<$E(X2,4,7))
"RTN","MCPFTP1",13,0)
 S RACE=$P(VADM(8),U,2),CLIN="" S:$P(MCPFT0,U,10) CLIN=$P(MCPFT0,U,10) I CLIN,$D(^SC(CLIN,0)) S CLIN=$P(^(0),U)
"RTN","MCPFTP1",14,0)
 S DATE=$P(MCPFT0,U),DATE=+$E(DATE,4,5)_"/"_+$E(DATE,6,7)_"/"_$E(DATE,2,3)_$S($P(DATE,".",2):"@"_+$E(DATE,9,10)_":"_$S($L($E(DATE,11,12))=2:$E(DATE,11,12),$L($E(DATE,11,12))=1:$E(DATE,11)_"0",1:"00"),1:"")
"RTN","MCPFTP1",15,0)
 N HTCM,HTIN,WTKG,WTLB
"RTN","MCPFTP1",16,0)
 S (HTIN,HT1)=$P(MCPFT0,U,4),(HTCM,HT)=$P($$LENGTH^XLFMSMT(HTIN,"IN","CM")," ")
"RTN","MCPFTP1",17,0)
 S (WTLB,WT1)=$P(MCPFT0,U,5),(WTKG,WT)=$P($$WEIGHT^XLFMSMT(WTLB,"LB","KG")," ")
"RTN","MCPFTP1",18,0)
 I HT'>0 S (HTCM,HT)=$P(MCPFT0,U,3),(HTIN,HT1)=$P($$LENGTH^XLFMSMT(HTCM,"CM","IN")," ")
"RTN","MCPFTP1",19,0)
 I WT'>0 S (WTKG,WT)=$P(MCPFT0,U,6),(WTLB,WT1)=$P($$WEIGHT^XLFMSMT(WTKG,"KG","LB")," ")
"RTN","MCPFTP1",20,0)
 S $P(MCDOT,".",81)=""
"RTN","MCPFTP1",21,0)
 ;S HT1=$P(MCPFT0,U,4),WT1=$P(MCPFT0,U,5) S $P(MCDOT,".",81)=""
"RTN","MCPFTP1",22,0)
 ;S HT=HT1*2.54,WT=WT1/2.2
"RTN","MCPFTP1",23,0)
 ;S:'HT HT=$P(MCPFT0,U,3),HT1=HT/2.54 S:'WT WT=$P(MCPFT0,U,6),WT1=WT*2.2
"RTN","MCPFTP1",24,0)
 S (MC17,MCEFF,MCSEX)="" S:$D(^MCAR(700,MCARGDA,17)) MC17=^(17),MCEFF=$P(MC17,U,6),MCEFF=$S(MCEFF="G":"GOOD",MCEFF="E":"EXCELLENT",MCEFF="P":"POOR",1:"")
"RTN","MCPFTP1",25,0)
 S MCSEX=$P(VADM(5),U),X=$P(VADM(3),"^",2) S MCARDOB=$S(X'="":X,1:""),X=$P(MCPFT0,U) D DTIME^MCARP S (MCARGDT,MCARGDT2)=X,MCARZ="PULMONARY FUNCTION TEST " S:MCESON MCARZ=MCARZ_" - "_MCSTAT
"RTN","MCPFTP1",26,0)
 D INP^VADPT S MCARWARD=$S(VAIN(4)'="":$P(VAIN(4),U,2),1:"NOT INPATIENT"),MCARRB=VAIN(5) D NOW^%DTC S X=% D DTIME^MCARP S MCARDTM=X
"RTN","MCPFTP1",27,0)
 D INIT^MCARP1(MCARZ,MCARGDT,MCFILE)
"RTN","MCPFTP1",28,0)
 D HEAD^MCARP
"RTN","MCPFTP1",29,0)
 W !,"SEX: ",MCSEX,"  AGE:",AGE,?30,+$J(HT1,0,2)," in/",+$J(WT1,0,1)," lb",?60,"AMBIENT: ",$P(MCPFT0,U,12),"C/",$P(MCPFT0,U,7),"T" K HT1,WT1
"RTN","MCPFTP1",30,0)
 W !,RACE S TECH=$P(MCPFT0,U,13) I TECH,$D(^VA(200,TECH,0)) S TECH=$P(^(0),U)
"RTN","MCPFTP1",31,0)
 W ?60,"TECH: ",$E(TECH,1,14)
"RTN","MCPFTP1",32,0)
 W !,$S($P(MCPFT0,U,8)="Y":"SMOKER",$P(MCPFT0,U,8)="N":"NON-SMOKER",1:"")
"RTN","MCPFTP1",33,0)
 W ?30 W:$P(MCPFT0,U,9)="Y" "CURRENT BRONCHODILATOR USE"
"RTN","MCPFTP1",34,0)
 W ?60,"EFFORT: ",MCEFF
"RTN","MCPFTP1",35,0)
 S MCFF="S DN=1,MCY="""" I $Y>(IOSL-3) R:$E(IOST,1,2)=""C-"" !!,""Press Return to Continue, '^' to escape: "",MCY:DTIME S:'$T MCY=U S:MCY=U MCOUT=1,DN=0 Q:$D(MCOUT)  D:DN HEAD^MCARP D:$D(HEAD1) HEAD1^MCPFTP2,HEAD2^MCPFTP2 K MCY"
"RTN","MCPFTP1",36,0)
 K ^UTILITY("DIQ1",$J) W !!,"CONSULT DX: " S DR(700.01)=.01,DIQ(0)="E",DIC="^MCAR(700,"
"RTN","MCPFTP1",37,0)
 F K=0:0 S K=$O(^MCAR(700,MCARGDA,1,K)) Q:K'?1N.N  S DA=MCARGDA,DA(700.01)=K,DR=11,DIQ(0)="E" D EN^DIQ1 I $D(^UTILITY("DIQ1",$J,700.01,K,.01,"E"))#2 W ?15,^("E"),! X MCFF Q:$D(MCOUT)
"RTN","MCPFTP1",38,0)
 K ^UTILITY("DIQ1",$J),DIQ Q:$D(MCOUT)  W !,MCDOT X MCFF Q:$D(MCOUT)  D PRED
"RTN","MCPFTP1",39,0)
 S RDATE=9999999.9999-$P(MCPFT0,U)
"RTN","MCPFTP1",40,0)
 W:$D(MCRCN) !,MCRCN
"RTN","MCPFTP1",41,0)
 D ^MCPFTP2
"RTN","MCPFTP1",42,0)
 I '$D(MCOUT) D:$G(MCESON) FOOTER^MCESPRT(MCFILE,MCARGDA)
"RTN","MCPFTP1",43,0)
EXIT S:$D(ZTQUEUED) ZTREQ="@" K ZTSK
"RTN","MCPFTP1",44,0)
EXIT1 ;
"RTN","MCPFTP1",45,0)
 D EXIT^MCPFTP1A
"RTN","MCPFTP1",46,0)
 Q 
"RTN","MCPFTP1",47,0)
PRED S (DLCOSB,FEV1,FRC,FVC,FEF2575,PF,RV,TLC,VC,MVV,CTLC,CVC,CFRC,CRV,CFVC,CFEV1,CPF,CFEF2575,CMVV,CDLCOSB,ACT,COHB)=""
"RTN","MCPFTP1",48,0)
 S MCPV=$$MCPV(MCARGDA)
"RTN","MCPFTP1",49,0)
 I ('HT)!('WT)!('AGE)!(MCPV=0) Q
"RTN","MCPFTP1",50,0)
 D PREDS,MCRACE Q
"RTN","MCPFTP1",51,0)
MCRACE S MCRCR="",MCRC=$G(^MCAR(700.1,MCPV,"RC")) Q:MCRC=""
"RTN","MCPFTP1",52,0)
 S MCRCR=$G(^MCAR(700,MCARGDA,17)) Q:MCRCR=""  Q:$P(MCRCR,U,5)'="Y"
"RTN","MCPFTP1",53,0)
 S MCRCR=$S(RACE["BLACK":"B",RACE["ASIAN":"O",1:"") Q:MCRCR=""
"RTN","MCPFTP1",54,0)
 F I=1:1:6 I $P(MCRC,U,I) S J=$P(MCRC,U,I) D:J
"RTN","MCPFTP1",55,0)
 .Q:'$D(^MCAR(700.2,J,0))  S J=$P(^(0),U,1)
"RTN","MCPFTP1",56,0)
 .S @("MCRC"_I)="S PRED="_J
"RTN","MCPFTP1",57,0)
 K J G ORIENTAL:MCRCR="O" K MCRC2,MCRC6
"RTN","MCPFTP1",58,0)
 I '$D(MCRC1),'$D(MCRC3),'$D(MCRC4),'$D(MCRC5) Q
"RTN","MCPFTP1",59,0)
 S:$D(MCRC1) MCRCN="TLC,VC,FVC,FEV1" S:$D(MCRC3) MCRCN=MCRCN_",FRC,RV" S:$D(MCRC4) MCRCN=MCRCN_",FEF25-75" S:$D(MCRC5) MCRCN=MCRCN_",MVV" S:$E(MCRCN,1)="," MCRCN=$E(MCRCN,2,35)
"RTN","MCPFTP1",60,0)
 G NOTE
"RTN","MCPFTP1",61,0)
ORIENTAL I '$D(MCRC2),'$D(MCRC6) K MCRC1,MCRC3,MCRC4,MCRC5 Q
"RTN","MCPFTP1",62,0)
 S:$D(MCRC2) MCRC1=MCRC2 S:$D(MCRC6) MCRC5=MCRC6 K MCRC3,MCRC4,MCRC6 S MCRCN="TLC,VC,FVC,FEV1,MVV"
"RTN","MCPFTP1",63,0)
NOTE S MCRCN="NOTE: Race Correction on predicted values: "_MCRCN
"RTN","MCPFTP1",64,0)
 Q
"RTN","MCPFTP1",65,0)
CONFID(MCPV,VALUE) ;
"RTN","MCPFTP1",66,0)
 Q $P(^MCAR(700.2,^MCAR(700.1,MCPV,VALUE),0),U,5)
"RTN","MCPFTP1",67,0)
PREDV(MCPV,VALUE)       ;
"RTN","MCPFTP1",68,0)
 N EXPRESS,FORMULA,IEN,RESULT
"RTN","MCPFTP1",69,0)
 S IEN=+$P($G(^MCAR(700.1,MCPV,VALUE)),U)
"RTN","MCPFTP1",70,0)
 S FORMULA=$P($G(^MCAR(700.2,IEN,0)),U)
"RTN","MCPFTP1",71,0)
 S RESULT=""
"RTN","MCPFTP1",72,0)
 I FORMULA]"" S EXPRESS="S RESULT="_FORMULA X EXPRESS
"RTN","MCPFTP1",73,0)
 Q $S(RESULT]"":RESULT,1:"")
"RTN","MCPFTP1",74,0)
MCPV(MCDA) ; Get the Predicted Value entry
"RTN","MCPFTP1",75,0)
 Q $S($D(^MCAR(700,MCDA,"PV")):^("PV"),1:0)
"RTN","MCPFTP1",76,0)
PREDS S BSA=+$$BSA(HT,WT),I="DLCOSB",DLCOSB=$$PREDV(MCPV,"DLCOSB"),CDLCOSB=$$CONFID(MCPV,"DLCOSB")
"RTN","MCPFTP1",77,0)
 S FEV1=$$PREDV(MCPV,"FEV1"),CFEV1=$$CONFID(MCPV,"FEV1")
"RTN","MCPFTP1",78,0)
 S FRC=$$PREDV(MCPV,"FRC"),CFRC=$$CONFID(MCPV,"FRC")
"RTN","MCPFTP1",79,0)
 S FVC=$$PREDV(MCPV,"FVC"),CFVC=$$CONFID(MCPV,"FVC")
"RTN","MCPFTP1",80,0)
 S FEF2575=$$PREDV(MCPV,"FEF2575"),CFEF2575=$$CONFID(MCPV,"FEF2575")
"RTN","MCPFTP1",81,0)
 S PF=$$PREDV(MCPV,"PF"),CPF=$$CONFID(MCPV,"PF")
"RTN","MCPFTP1",82,0)
 S RV=$$PREDV(MCPV,"RV"),CRV=$$CONFID(MCPV,"RV")
"RTN","MCPFTP1",83,0)
 S TLC=$$PREDV(MCPV,"TLC"),CTLC=$$CONFID(MCPV,"TLC")
"RTN","MCPFTP1",84,0)
 S VC=$$PREDV(MCPV,"VC"),CVC=$$CONFID(MCPV,"VC")
"RTN","MCPFTP1",85,0)
 S MVV=$$PREDV(MCPV,"MVV"),CMVV=$$CONFID(MCPV,"MVV")
"RTN","MCPFTP1",86,0)
 Q
"RTN","MCPFTP1",87,0)
BSA(HT,WT) ; Compute BSA
"RTN","MCPFTP1",88,0)
 D COMPUTE^MCARBSA
"RTN","MCPFTP1",89,0)
 Q X
"RTN","MCPFTP2A")
0^3^B17926565
"RTN","MCPFTP2A",1,0)
MCPFTP2A ;WISC/TJK-PFT REPORT-FLOWS ;6/29/99  11:06
"RTN","MCPFTP2A",2,0)
 ;;2.3;Medicine;**25**;09/13/1996
"RTN","MCPFTP2A",3,0)
FLOW G DIF:'$D(^MCAR(700,MCARGDA,4)),DIF:'$O(^(4,0)) S MCX=0
"RTN","MCPFTP2A",4,0)
 ;I '$D(HEAD1) S HEAD1="FLOWS" D HEAD1^MCPFTP2,HEAD2^MCPFTP2
"RTN","MCPFTP2A",5,0)
 ;E  S HEAD1="FLOWS" D @$S(($Y>(IOSL-5)):"MCFF1",1:"HEAD2^MCPFTP2") Q:$D(MCOUT)
"RTN","MCPFTP2A",6,0)
 X:$Y>(IOSL-5) MCFF
"RTN","MCPFTP2A",7,0)
 S HEAD1="FLOWS" D HEAD1^MCPFTP2,HEAD2^MCPFTP2
"RTN","MCPFTP2A",8,0)
 Q:$D(MCOUT)
"RTN","MCPFTP2A",9,0)
 I MC17'="" S MC17A=$P(MC17,U,2) W ?3,"MACHINE: ",$S(MC17A="F":"FLOW TURBINE",MC17A="P":"PNEUMOTACH",MC17A="A":"ANEMOMETER",MC17A="DS":"DRY WATER SEAL",MC17A="WS":"WATER SEAL",MC17A="W":"WEDGE",1:"") X MCFF K MC17A Q:$D(MCOUT)
"RTN","MCPFTP2A",10,0)
FLOW1 S MCX=$O(^MCAR(700,MCARGDA,4,MCX)) G DIF:MCX'?1N.N S MCREC=^(MCX,0),TYPE=$P(MCREC,U)
"RTN","MCPFTP2A",11,0)
 W !! X MCFF Q:$D(MCOUT)
"RTN","MCPFTP2A",12,0)
 S ND="AF",ND1=4 D PRETEST^MCPFTP2
"RTN","MCPFTP2A",13,0)
 W ?5,$S(TYPE="S":"STANDARD STUDY",TYPE="B":"AFTER BRONCHODILATOR",TYPE="I":"AFTER INHALATION CHALLENGE",1:"AFTER EXERCISE") X MCFF Q:$D(MCOUT)  D PREVDATE^MCPFTP2
"RTN","MCPFTP2A",14,0)
 I $P(MCREC,U,6)'="" W !,?5,"(NOTES): ",$P(MCREC,U,6) X MCFF Q:$D(MCOUT)
"RTN","MCPFTP2A",15,0)
 S ACT=$P(MCREC,U,2) I ACT S MEAS="FVC",UNITS="L",PRED=FVC X:$D(MCRC1) MCRC1 S PC=2,CI95=$S(PRED:PRED-CFVC,1:"") D PRTLINE S:TYPE="S" MCIFA=ACT,MCIFL=CI95 Q:$D(MCOUT)
"RTN","MCPFTP2A",16,0)
 S ACT=$P(MCREC,U,3) I ACT S MEAS="FEV1",UNITS="L",PRED=FEV1 X:$D(MCRC1) MCRC1 S PC=3,CI95=$S(PRED:PRED-CFEV1,1:"") D PRTLINE S:TYPE="S" MCIFE=ACT Q:$D(MCOUT)
"RTN","MCPFTP2A",17,0)
 S MCDL=3,MCLNG=6,ACT=$P(MCREC,U,4) I ACT S MEAS="PF",UNITS="L/SEC",PRED=PF,PC=4,CI95=$S(PRED:PRED-CPF,1:"") D PRTLINE Q:$D(MCOUT)
"RTN","MCPFTP2A",18,0)
 S ACT=$P(MCREC,U,5) I ACT S MEAS="FEF25-75",UNITS="L/SEC",PRED=FEF2575 X:$D(MCRC4) MCRC4 S PC=5,CI95=$S(PRED:PRED-CFEF2575,1:"") D PRTLINE Q:$D(MCOUT)
"RTN","MCPFTP2A",19,0)
 S MCDL=2,MCLNG=5,ACT=$P(MCREC,U,7) I ACT S MEAS="MVV",UNITS="L/MIN",PRED=MVV X:$D(MCRC5) MCRC5 S PC=7,CI95=$S(PRED:PRED-CMVV,1:"") S:TYPE="S" MCMVVN=ACT D PRTLINE Q:$D(MCOUT)
"RTN","MCPFTP2A",20,0)
 I $P(MCREC,U,2),$P(MCREC,U,3) W !,?5,"FEV1/FVC",?17,"%" S ACT=$P(MCREC,U,3)/$P(MCREC,U,2) W ?35,$J(ACT*100,5,0) S:TYPE="S" MCIFV=ACT X MCFF Q:$D(MCOUT)
"RTN","MCPFTP2A",21,0)
 G FLOW1
"RTN","MCPFTP2A",22,0)
DIF K CFVC,CFEV1,CPF,CFEF2575,CMVV G ABG:'$D(^MCAR(700,MCARGDA,5)) S (ACT,MCIDA)=^(5) G ABG:'ACT
"RTN","MCPFTP2A",23,0)
 I '$D(HEAD1) S HEAD1="DIFFUSION" D HEAD1^MCPFTP2,HEAD2^MCPFTP2
"RTN","MCPFTP2A",24,0)
 E  S HEAD1="DIFFUSION" W ! D HEAD2^MCPFTP2
"RTN","MCPFTP2A",25,0)
 Q:$D(MCOUT)  I MC17'="" S MC17A=$P(MC17,U,4) W ?3,"METHOD: ",$S(MC17A=1:"SINGLE BREATH",MC17A=2:"STEADY STATE",1:"") X MCFF K MC17A Q:$D(MCOUT)
"RTN","MCPFTP2A",26,0)
DIF0 S (MCIDP,PRED)=DLCOSB,UNITS="L",MEAS="DLCO-SB",PC=1
"RTN","MCPFTP2A",27,0)
 S (P1,P2)="" S RDATE1=$O(^MCAR(700,"ADI",DFN,RDATE)) I RDATE1 S P1=$O(^(RDATE1,0))
"RTN","MCPFTP2A",28,0)
 G DIF1:'P1 S MCP1=$G(^MCAR(700,P1,5))
"RTN","MCPFTP2A",29,0)
 S RDATE2=$O(^MCAR(700,"ADI",DFN,RDATE1)) I RDATE2 S P2=$O(^(RDATE2,0)) I P2 S MCP2=$G(^MCAR(700,P2,5))
"RTN","MCPFTP2A",30,0)
DIF1 D:P1 PREVDATE^MCPFTP2 S (MCIDL,CI95)=$S(PRED:PRED-CDLCOSB,1:"") D PRTLINE Q:$D(MCOUT)
"RTN","MCPFTP2A",31,0)
 G ABG:'$D(^MCAR(700,MCARGDA,6))
"RTN","MCPFTP2A",32,0)
 I $G(MCPV)<1 S MCPV=$$MCPV^MCPFTP1(MCARGDA)
"RTN","MCPFTP2A",33,0)
 S MCHB=$G(^MCAR(700.1,MCPV,"HB")),MCCOHB=$G(^("COHB"))
"RTN","MCPFTP2A",34,0)
 I MCHB="",MCCOHB="" G ABG
"RTN","MCPFTP2A",35,0)
 G HB:$P(MCCOHB,U)="" S MCCOHB=$G(^MCAR(700.2,MCCOHB,0)) G HB:MCCOHB="" S COHB=""
"RTN","MCPFTP2A",36,0)
 S I=0 F  S I=$O(^MCAR(700,MCARGDA,6,I)) Q:I'?1N.N  I $D(^(I,0)),$P(^(0),U,7) S COHB=$P(^(0),U,7)
"RTN","MCPFTP2A",37,0)
 G HB:COHB="" X "S MCCOHB="_$P(MCCOHB,U)
"RTN","MCPFTP2A",38,0)
 ;W !,"Corrected DLCO for COHB: ",$J(MCCOHB,6,2)
"RTN","MCPFTP2A",39,0)
HB G ABG:$P(MCHB,U)="" S MCHB=$G(^MCAR(700.2,MCHB,0)) G ABG:MCHB=""
"RTN","MCPFTP2A",40,0)
 S HB="",I=0 F  S I=$O(^MCAR(700,MCARGDA,6,I)) Q:I'?1N.N  I $D(^(I,0)),$P(^(0),U,2) S HB=$P(^(0),U,2)
"RTN","MCPFTP2A",41,0)
 ;G ABG:HB'<11,ABG:'HB X "S MCHB="_$P(MCHB,U)
"RTN","MCPFTP2A",42,0)
 G ABG:'HB X "S MCHB="_$P(MCHB,U)
"RTN","MCPFTP2A",43,0)
 ;W !,"Corrected DLCO for HB: ",$J(MCHB,8,2)
"RTN","MCPFTP2A",44,0)
 W !,"Corr DLCO for HB & COHB:",?19,$J(MCIDL,6,2),?32,$J(MCHB,8,2),?42,$S(MCIDL'=0:$J(MCHB/MCIDL*100,8,1),1:"")
"RTN","MCPFTP2A",45,0)
ABG K HB,COHB,MCHB,MCCOHB G ^MCPFTP3
"RTN","MCPFTP2A",46,0)
PRTLINE S MCP1=$G(MCP1),MCP2=$G(MCP2)
"RTN","MCPFTP2A",47,0)
 W !,?5,MEAS,?15,UNITS,?25,$S(PRED:$J(PRED,MCLNG,MCDL),1:""),?35,$J(ACT,MCLNG,MCDL),?45,$S(PRED:$J(ACT/PRED*100,5,1),1:"") W:$P(MCP1,U,PC) ?55,$J($P(MCP1,U,PC),MCLNG,MCDL) W:$P(MCP2,U,PC) ?65,$J($P(MCP2,U,PC),MCLNG,MCDL)
"RTN","MCPFTP2A",48,0)
 W:(CI95)&(CI95'=PRED) ?72,$J(CI95,6,2) X MCFF Q
"RTN","MCPFTP2A",49,0)
MCFF1 X MCFF Q
"RTN","MCPFTP5")
0^5^B22932646
"RTN","MCPFTP5",1,0)
MCPFTP5 ;WISC/TJK-PFT REPORT-SPECIAL STUDIES (PT 2) ;8/30/99  10:15
"RTN","MCPFTP5",2,0)
 ;;2.3;Medicine;**18,25**;09/13/1996
"RTN","MCPFTP5",3,0)
EX S ND=MCREC1,MCP1=MCP1S1,MCP2=MCP2S1,VE=$P(MCREC1,U,1),MCEX=$P(MCREC2,U,9)
"RTN","MCPFTP5",4,0)
 S MEAS="VEmax(BTPS)",UNITS="L",PC=1 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",5,0)
 S MEAS="BR",PC=2 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",6,0)
 S MEAS="VD/VT REST",PC=14 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",7,0)
 S MEAS="VD/VT MAX",PC=15 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",8,0)
 S MEAS="VE/VCO2, AT",PC=16 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",9,0)
 S MEAS="VErest(BTPS)",UNITS="ml/beat",PC=5 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",10,0)
 K VE S MEAS="VO2rest",UNITS="L/min",PC=6 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",11,0)
 S MEAS="VO2max",UNITS="L/min",PC=7 I MCEX=1 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2
"RTN","MCPFTP5",12,0)
 D:(MCEX=3)!(MCEX=2) VO2MAX Q:$D(MCOUT)
"RTN","MCPFTP5",13,0)
 S MEAS="AT",UNITS="L",PC=3 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",14,0)
 S MEAS="HRrest",UNITS="BPM",PC=8 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",15,0)
 S MEAS="HRmax",PC=9 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",16,0)
 S MEAS="VO2/HR",PC=11,UNITS="ML" S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",17,0)
 S MEAS="BP MAX",PC=12,UNITS="" S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",18,0)
 S MEAS="EKG",PC=13 S ACT=$P(ND,U,PC) W !,?5,MEAS,?35,$S(ACT="N":"NORMAL",ACT="A":"ABNORMAL",1:"") X MCFF Q:$D(MCOUT)
"RTN","MCPFTP5",19,0)
 S MEAS="RRrest",UNITS="brths/m",PC=10 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",20,0)
 S ND=MCREC2,MCP1=MCP1S2,MCP2=MCP2S2,MEAS="RRmax",PC=1 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",21,0)
 S MEAS="Wmax",UNITS="wrpm/min",PC=2 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",22,0)
 S MEAS="WRI/WRT",UNITS="watts/min",PC=6 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",23,0)
 S MEAS="Max Speed",UNITS="mph",PC=4 S ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",24,0)
 S MEAS="Max Grade",UNITS="%",PC=5 S ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",25,0)
 S PRED="",MEAS="TOTAL TIME",UNITS="min",PC=3 S ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",26,0)
 S MEAS="HCO3 Change",UNITS="mg/dl",PC=10 S PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q:$D(MCOUT)
"RTN","MCPFTP5",27,0)
 W !,?5,"Exercise Testing Mode: ",$S(MCEX=1:"TREADMILL",MCEX=2:"BIKE ERGOMETER",MCEX=3:"HAND ERGOMETER",1:"") X MCFF Q:$D(MCOUT)  K MCEX
"RTN","MCPFTP5",28,0)
 W !,?5,"REASON(S) FOR STOPPING:"
"RTN","MCPFTP5",29,0)
 S MCX(1)=0 F  S MCX(1)=$O(^MCAR(700,MCARGDA,"S",MCX,3,MCX(1))) Q:MCX(1)'?1N.N  S MCX(2)=$G(^(MCX(1),0)) I MCX(2) W ?32,$P($G(^MCAR(695.8,MCX(2),0)),U),! K MCX(2) X MCFF Q:$D(MCOUT)
"RTN","MCPFTP5",30,0)
 Q:$D(MCOUT)  K ^UTILITY($J,"W") S MCX(1)=0 F  S MCX(1)=$O(^MCAR(700,MCARGDA,"S",MCX,4,MCX(1))) Q:MCX(1)'?1N.N  S X=$G(^(MCX(1),0)),DIWL=33,DIWR=75,DIWF="W" D ^DIWP
"RTN","MCPFTP5",31,0)
 D ^DIWW
"RTN","MCPFTP5",32,0)
EXEND G SPEC1^MCPFTP4
"RTN","MCPFTP5",33,0)
INT K HEAD1 Q:$E(MCDOT,1)=" "
"RTN","MCPFTP5",34,0)
 W !! X MCFF Q:$D(MCOUT)  W "INTERPRETATION",$E(MCDOT,1,66) X MCFF Q:$D(MCOUT)
"RTN","MCPFTP5",35,0)
 K DXS,DIOT(2),^UTILITY($J) S ^UTILITY($J,1)=MCFF,D0=MCARGDA D ^MCAROPF K ^UTILITY($J,1)
"RTN","MCPFTP5",36,0)
EXIT Q:$E(MCDOT)=" "  D CONT Q:$D(MCOUT)  D PV Q
"RTN","MCPFTP5",37,0)
PV ;
"RTN","MCPFTP5",38,0)
 I $G(MCPV)<1 S MCPV=$$MCPV^MCPFTP1(MCARGDA)
"RTN","MCPFTP5",39,0)
 Q:'$D(MCPV)  Q:'$D(^MCAR(700.1,MCPV))
"RTN","MCPFTP5",40,0)
 D HEAD^MCARP
"RTN","MCPFTP5",41,0)
PV1 ;
"RTN","MCPFTP5",42,0)
 I $G(MCPV)<1 S MCPV=$$MCPV^MCPFTP1(MCARGDA)
"RTN","MCPFTP5",43,0)
 Q:'$D(MCPV)
"RTN","MCPFTP5",44,0)
 W !!?25,"PREDICTED VALUE FORMULAS USED",!
"RTN","MCPFTP5",45,0)
 F J="TLC","VC","FRC","RV","FVC","FEV1","PF","FEF2575","MVV","DLCOSB","COHB","HB" D
"RTN","MCPFTP5",46,0)
   .S I=$G(^MCAR(700.1,MCPV,J)) Q:'I
"RTN","MCPFTP5",47,0)
   .Q:'$D(^MCAR(700.2,I,0))  S I=$G(^(0))
"RTN","MCPFTP5",48,0)
   .W !,?5,$S(J="DLCOSB":"DLCO-SB",J="FEF2575":"FEF25-75",J="COHB":"COHB CORR.",J="HB":"HB CORR.",1:J)
"RTN","MCPFTP5",49,0)
   .D PVW
"RTN","MCPFTP5",50,0)
   .K J Q
"RTN","MCPFTP5",51,0)
 G PVEXIT:'$D(MCRC1)
"RTN","MCPFTP5",52,0)
 W !!?25,"RACE CORRECTION FORMULAS USED",!
"RTN","MCPFTP5",53,0)
 ;I $D(MCRC2) S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,2) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,"TLC,VC,FVC,FEV1" D PVW G PVEXIT
"RTN","MCPFTP5",54,0)
 I $D(MCRC2) D  G PVEXIT
"RTN","MCPFTP5",55,0)
 . F J=2,6 S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,J) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,$S(J=2:"TLC,VC,FVC,FEV1",J=6:"MVV",1:"") D PVW
"RTN","MCPFTP5",56,0)
 . Q
"RTN","MCPFTP5",57,0)
 F J=1,3,4,5 S I=$P($G(^MCAR(700.1,MCPV,"RC")),U,J) I I,$D(^MCAR(700.2,I,0)) S I=$G(^(0)) W !,?5,$S(J=1:"TLC,VC,FVC,FEV1",J=3:"FRC,RV",J=4:"FEF25-75",J=5:"MVV",1:"") D PVW
"RTN","MCPFTP5",58,0)
PVEXIT W !,"NOTE:  HT=height,WT=weight,ACT=actual measurement value" D CONT Q
"RTN","MCPFTP5",59,0)
PVW W ?21,$P(I,U),?50,$P(I,U,3) Q
"RTN","MCPFTP5",60,0)
CONT Q:($E(IOST,1,2)'="C-")!($D(MCOUT))  R !!,"Press Return to Continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:MCY=U MCOUT=1 Q
"RTN","MCPFTP5",61,0)
COMP S I=0 F  S I=$O(^MCAR(700,MCARGDA,24,I)) Q:I'?1N.N  I $D(^(I,0)),$P(^(0),U,2)="Y" S J=$P(^(0),U,1) W:$D(^MCAR(693.2,J,0)) ?17,$P(^(0),U,1),!
"RTN","MCPFTP5",62,0)
 Q
"RTN","MCPFTP5",63,0)
VO2ER1(MCSEX) ;
"RTN","MCPFTP5",64,0)
 Q $S(MCSEX="F":(42.8+WT)*(22.78-(.17*AGE)),1:(.79*HT-60.7))
"RTN","MCPFTP5",65,0)
VO2ER2(MCSEX) ;
"RTN","MCPFTP5",66,0)
 Q $S(MCSEX="F":HT*(14.81-(.11*AGE)),1:50.72-(0.372*AGE))
"RTN","MCPFTP5",67,0)
VO2MAX ;
"RTN","MCPFTP5",68,0)
 S ER1=$$VO2ER1(MCSEX),ER2=$$VO2ER2(MCSEX),PRED="",ACT=$P(ND,U,PC) D:ACT'="" PRTLINE^MCPFTP2 Q
"RTN","MCPFTSS")
0^7^B1179765
"RTN","MCPFTSS",1,0)
MCPFTSS ;WISC/MLH-PFT SPECIAL STUDIES ANCILLARY ;7/9/99  10:13
"RTN","MCPFTSS",2,0)
 ;;2.3;Medicine;**25**;09/13/1996
"RTN","MCPFTSS",3,0)
 ;
"RTN","MCPFTSS",4,0)
 IF $G(DJR)=2452 D
"RTN","MCPFTSS",5,0)
 .  I V(23)="MECHANICS" S $P(DJJ(23),U,6)="MCPFT061"
"RTN","MCPFTSS",6,0)
 .  I V(23)="SMALL AIRWAY" S $P(DJJ(23),U,6)="MCPFT062"
"RTN","MCPFTSS",7,0)
 .  I V(23)="EXERCISE" S $P(DJJ(23),U,6)="MCPFT063"
"RTN","MCPFTSS",8,0)
 .  I V(23)="MAXIMUM PRESSURES" S $P(DJJ(23),U,6)="MCPFT064"
"RTN","MCPFTSS",9,0)
 .  Q
"RTN","MCPFTSS",10,0)
 ;END IF
"RTN","MCPFTSS",11,0)
 ;
"RTN","MCPFTSS",12,0)
 Q
"RTN","MCPFTSS",13,0)
RACECDE(DFN) ;Returns a value of RACE B = BLACK and null for anything else
"RTN","MCPFTSS",14,0)
 D DEM^VADPT S MCRACE=$P(VADM(8),U,2) D KVAR^VADPT
"RTN","MCPFTSS",15,0)
 I MCRACE="" D RACEMSG
"RTN","MCPFTSS",16,0)
 S MCRACE=$S(MCRACE["ASIAN":"",MCRACE["BLACK":"B",1:"")
"RTN","MCPFTSS",17,0)
 Q MCRACE
"RTN","MCPFTSS",18,0)
 ;
"RTN","MCPFTSS",19,0)
RACEMSG ; If patient race field is empty, notify user
"RTN","MCPFTSS",20,0)
 W $C(7),!!?5,"*** Patient's race not specified in the patient file ***"
"RTN","MCPFTSS",21,0)
 H 1 W $C(7) N X R X:3 W !
"RTN","MCPFTSS",22,0)
 Q
"VER")
8.0^21.0
"^DD",700,700,3,0)
HEIGHT (INCHES.TENTHS)^NJ6,2^^0;4^K:+X'=X!(X>100)!(X<40)!(X?.E1"."3N.N) X
"^DD",700,700,3,1,0)
^.1^^0
"^DD",700,700,3,3)
Type a Number between 40 and 100, 2 Decimal Digits
"^DD",700,700,3,21,0)
^^2^2^2990628^^
"^DD",700,700,3,21,1,0)
This field identifies the height of the patient in inches and tenths of
"^DD",700,700,3,21,2,0)
inches.  This value will be converted to Centimeters for the report.
"^DD",700,700,3,"DT")
2990628
"^DD",700,700,19,0)
DLCO-SB^NJ5,2^^5;1^K:+X'=X!(X>99.99)!(X<1)!(X?.E1"."3N.N) X
"^DD",700,700,19,1,0)
^.1
"^DD",700,700,19,1,1,0)
700^ADI^MUMPS
"^DD",700,700,19,1,1,1)
S ^MCAR(700,"ADI",$P(^MCAR(700,DA,0),U,2),9999999.9999-$P(^MCAR(700,DA,0),U),DA)=""
"^DD",700,700,19,1,1,2)
K ^MCAR(700,"ADI",$P(^MCAR(700,DA,0),U,2),9999999.9999-$P(^MCAR(700,DA,0),U),DA)
"^DD",700,700,19,1,1,"%D",0)
^^2^2^2920422^
"^DD",700,700,19,1,1,"%D",1,0)
This cross-reference indexes the date and time of the most recent diffusing
"^DD",700,700,19,1,1,"%D",2,0)
capacity measurement for this pulmonary function test.
"^DD",700,700,19,1,1,"DT")
2900420
"^DD",700,700,19,3)
Type a Number between 1 and 99.99, 2 Decimal Digits
"^DD",700,700,19,21,0)
^^1^1^2990623^^
"^DD",700,700,19,21,1,0)
This field identifies the measured Diffusing Capacity.
"^DD",700,700,19,"DT")
2990623
"^DD",700.1,700.1,13.01,0)
MVV CORR.-BLACK^*P700.2'^MCAR(700.2,^RC;5^S DIC("S")="I $P(^(0),U,11)=""B"",$P(^(0),U,2)[""MVV""",DIC("W")="D DISP^MCPFTE" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",700.1,700.1,13.01,3)
Enter the formula for computing the race corrected values for Black patients for MVV:  ACT refers to the actual measured value
"^DD",700.1,700.1,13.01,12)
Enter formula for race correction for Blacks for MVV
"^DD",700.1,700.1,13.01,12.1)
S DIC("S")="I $P(^(0),U,11)=""B"",$P(^(0),U,2)[""MVV""",DIC("W")="D DISP^MCPFTE"
"^DD",700.1,700.1,13.01,21,0)
^^2^2^2990623^^
"^DD",700.1,700.1,13.01,21,1,0)
This contains the formula for a race correction for Black patients for
"^DD",700.1,700.1,13.01,21,2,0)
Maximum Voluntary Ventilation.
"^DD",700.1,700.1,13.01,"DT")
2990623
"^DD",700.1,700.1,13.02,0)
MVV CORR.-ORIENTAL^*P700.2'^MCAR(700.2,^RC;6^S DIC("S")="I $P(^(0),U,11)=""O"",$P(^(0),U,2)[""MVV""",DIC("W")="D DISP^MCPFTE" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",700.1,700.1,13.02,3)
Enter the formula for computing the race corrected values for Oriental patients for MVV:  ACT refers to the actual measured value
"^DD",700.1,700.1,13.02,12)
Enter the formula for computing the race corrected values for Oriental patients for MVV:  ACT refers to the actual measured value
"^DD",700.1,700.1,13.02,12.1)
S DIC("S")="I $P(^(0),U,11)=""O"",$P(^(0),U,2)[""MVV""",DIC("W")="D DISP^MCPFTE"
"^DD",700.1,700.1,13.02,21,0)
^^2^2^2990623^
"^DD",700.1,700.1,13.02,21,1,0)
This contains the formula for a race correction for Oriental patients for
"^DD",700.1,700.1,13.02,21,2,0)
Maximum Voluntary Ventilation.
"^DD",700.1,700.1,13.02,"DT")
2990623
"^DD",700.2,700.2,1,0)
TYPE^RF^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>35!($L(X)<2) X
"^DD",700.2,700.2,1,1,0)
^.1
"^DD",700.2,700.2,1,1,1,0)
700.2^D
"^DD",700.2,700.2,1,1,1,1)
S ^MCAR(700.2,"D",$E(X,1,30),DA)=""
"^DD",700.2,700.2,1,1,1,2)
K ^MCAR(700.2,"D",$E(X,1,30),DA)
"^DD",700.2,700.2,1,1,1,"%D",0)
^^1^1^2920722^
"^DD",700.2,700.2,1,1,1,"%D",1,0)
This cross-reference indexes the file by formula type.
"^DD",700.2,700.2,1,1,1,"DT")
2920722
"^DD",700.2,700.2,1,3)
Answer must be 2-35 characters in length.
"^DD",700.2,700.2,1,21,0)
^^4^4^2990623^^
"^DD",700.2,700.2,1,21,1,0)
This field is used to indicate which elements of the PFT the formula
"^DD",700.2,700.2,1,21,2,0)
applies to.  For example, a TLC in this field would indicate that this
"^DD",700.2,700.2,1,21,3,0)
formula is used for Total Lung Capacity predicted values.  This field
"^DD",700.2,700.2,1,21,4,0)
is used as a screen when the formula set is edited.
"^DD",700.2,700.2,1,"DT")
2920722
**END**
**END**
