Released PSJ*5*150 SEQ #141
Extracted from mail message
**KIDS**:PSJ*5.0*150^

**INSTALL NAME**
PSJ*5.0*150
"BLD",5313,0)
PSJ*5.0*150^INPATIENT MEDICATIONS^0^3050609^y
"BLD",5313,1,0)
^^4^4^3050608^
"BLD",5313,1,1,0)
It has been discovered that the Extra Units Dispensed [PSJU EUD] option
"BLD",5313,1,2,0)
was not communicating properly with the ATC machine after the 
"BLD",5313,1,3,0)
installation of CPRS version 25.  This patch will resolve this 
"BLD",5313,1,4,0)
communication issue.
"BLD",5313,4,0)
^9.64PA^^
"BLD",5313,"ABPKG")
n
"BLD",5313,"KRN",0)
^9.67PA^8989.52^19
"BLD",5313,"KRN",.4,0)
.4
"BLD",5313,"KRN",.401,0)
.401
"BLD",5313,"KRN",.402,0)
.402
"BLD",5313,"KRN",.403,0)
.403
"BLD",5313,"KRN",.5,0)
.5
"BLD",5313,"KRN",.84,0)
.84
"BLD",5313,"KRN",3.6,0)
3.6
"BLD",5313,"KRN",3.8,0)
3.8
"BLD",5313,"KRN",9.2,0)
9.2
"BLD",5313,"KRN",9.8,0)
9.8
"BLD",5313,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5313,"KRN",9.8,"NM",1,0)
PSGEUD^^0^B27607319
"BLD",5313,"KRN",9.8,"NM","B","PSGEUD",1)

"BLD",5313,"KRN",19,0)
19
"BLD",5313,"KRN",19.1,0)
19.1
"BLD",5313,"KRN",101,0)
101
"BLD",5313,"KRN",409.61,0)
409.61
"BLD",5313,"KRN",771,0)
771
"BLD",5313,"KRN",870,0)
870
"BLD",5313,"KRN",8989.51,0)
8989.51
"BLD",5313,"KRN",8989.52,0)
8989.52
"BLD",5313,"KRN",8994,0)
8994
"BLD",5313,"KRN","B",.4,.4)

"BLD",5313,"KRN","B",.401,.401)

"BLD",5313,"KRN","B",.402,.402)

"BLD",5313,"KRN","B",.403,.403)

"BLD",5313,"KRN","B",.5,.5)

"BLD",5313,"KRN","B",.84,.84)

"BLD",5313,"KRN","B",3.6,3.6)

"BLD",5313,"KRN","B",3.8,3.8)

"BLD",5313,"KRN","B",9.2,9.2)

"BLD",5313,"KRN","B",9.8,9.8)

"BLD",5313,"KRN","B",19,19)

"BLD",5313,"KRN","B",19.1,19.1)

"BLD",5313,"KRN","B",101,101)

"BLD",5313,"KRN","B",409.61,409.61)

"BLD",5313,"KRN","B",771,771)

"BLD",5313,"KRN","B",870,870)

"BLD",5313,"KRN","B",8989.51,8989.51)

"BLD",5313,"KRN","B",8989.52,8989.52)

"BLD",5313,"KRN","B",8994,8994)

"BLD",5313,"QUES",0)
^9.62^^
"BLD",5313,"REQB",0)
^9.611^1^1
"BLD",5313,"REQB",1,0)
PSJ*5.0*111^2
"BLD",5313,"REQB","B","PSJ*5.0*111",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
150^3050609
"PKG",197,22,1,"PAH",1,1,0)
^^4^4^3050609
"PKG",197,22,1,"PAH",1,1,1,0)
It has been discovered that the Extra Units Dispensed [PSJU EUD] option
"PKG",197,22,1,"PAH",1,1,2,0)
was not communicating properly with the ATC machine after the 
"PKG",197,22,1,"PAH",1,1,3,0)
installation of CPRS version 25.  This patch will resolve this 
"PKG",197,22,1,"PAH",1,1,4,0)
communication issue.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSGEUD")
0^1^B27607319
"RTN","PSGEUD",1,0)
PSGEUD ;BIR/CML3-EXTRA UNITS DISPENSED ;17 SEP 97 /  1:41 PM
"RTN","PSGEUD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,41,50,111,150**;16 DEC 97
"RTN","PSGEUD",3,0)
 ;
"RTN","PSGEUD",4,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGEUD",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSGEUD",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGEUD",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGEUD",8,0)
 ;
"RTN","PSGEUD",9,0)
 N PSJNEW,PSGPTMP,PPAGE,PSGEFN S PSJNEW=1
"RTN","PSGEUD",10,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S (PSGONNV,PSGRETF)=1 K PSGPRP
"RTN","PSGEUD",11,0)
 ;
"RTN","PSGEUD",12,0)
GP ;
"RTN","PSGEUD",13,0)
 S PSGP="",DFN=""
"RTN","PSGEUD",14,0)
 D ENDPT^PSGP G:(PSGP'>0)&(DFN'>0) DONE S:PSGP<1 PSGP=DFN I '$O(^PS(55,PSGP,5,"AUS",+PSJPAD)) W $C(7),!,"(Patient has NO active or old orders.)" G GP
"RTN","PSGEUD",15,0)
 D ENL^PSGOU G:"^N"[PSGOL GP S PSGPTMP=0,PPAGE=1 D ^PSGO G:'PSGON GP S PSGLMT=PSGON,(PSGONC,PSGONR)=0
"RTN","PSGEUD",16,0)
 F  W !!,"Select ORDER",$E("S",PSGON>1)," 1-",PSGON,": " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" H I X'?1."?" D ENCHK^PSGON W:'$D(X) $C(7),"  ??" Q:$D(X)
"RTN","PSGEUD",17,0)
 G:"^"[X GP F PSGRET=1:1:PSGODDD F PSGRET1=1:1 S PSGRET2=$P(PSGODDD(PSGRET),",",PSGRET1) Q:'PSGRET2  S PSGORD=^TMP("PSJON",$J,PSGRET2) D R G:$D(DTOUT) GP
"RTN","PSGEUD",18,0)
 G GP
"RTN","PSGEUD",19,0)
 ;
"RTN","PSGEUD",20,0)
DONE ;
"RTN","PSGEUD",21,0)
 D ENKV^PSGSETU K ^TMP("PSJON",$J),DO,DRGN,MR,OD,PSGLMT,PSGODDD,PSGEUD,PSGEUDA,PSGOL,PSGON,PSGONC,PSGONR,PSGONV,PSGONNV,PSGORD,PSGQ,PSGRET,PSGRET1,PSGRET2,PSGRETF,PSGSPD,SCH,WG,Z,CST Q
"RTN","PSGEUD",22,0)
 ;
"RTN","PSGEUD",23,0)
R ;
"RTN","PSGEUD",24,0)
 S MR=$P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",3),Y=$G(^(.2)),SCH=$P($G(^(2)),"^"),DO=$P(Y,"^",2),DRG=$P(Y,"^"),DRG=$S(DRG'=+DRG:"NOT FOUND",'$D(^PS(50.7,DRG,0)):DRG,$P(^(0),"^")]"":$P(^(0),"^"),1:DRG_";PS(50.7,")
"RTN","PSGEUD",25,0)
 S:MR]"" MR=$S(MR'=MR:MR,'$D(^PS(51.2,MR,0)):MR,$P(^(0),"^",3)]"":$P(^(0),"^",3),$P(^(0),"^")]"":$P(^(0),"^"),1:MR_";PS(51.2,") W !!,"----------------------------------------",!,DRG,!,"Give: " D
"RTN","PSGEUD",26,0)
 .N LN,MARX D TXT^PSGMUTL(DO_" "_MR_" "_SCH,65)
"RTN","PSGEUD",27,0)
 .S LN="" F  S LN=$O(MARX(LN)) Q:LN=""  W:LN>1 ! W ?6,MARX(LN)
"RTN","PSGEUD",28,0)
 I '$O(^PS(55,PSGP,5,+PSGORD,1,0)) D  Q
"RTN","PSGEUD",29,0)
 .W !!,"No Dispense drugs have been entered for this order. At least one Dispense drugs",!,"must be associated with an order before dispensing information may be entered.",!!
"RTN","PSGEUD",30,0)
 .N DIR S DIR(0)="E" D ^DIR S Y=$S(Y:0,1:1)
"RTN","PSGEUD",31,0)
 S PSGEUD=0,WG=$O(^PS(57.5,"AB",+PSJPWD,0)) F DRG=0:0 S DRG=$O(^PS(55,PSGP,5,+PSGORD,1,DRG)) Q:'DRG  S X=$G(^(DRG,0)) I X D  Q:$D(DTOUT)
"RTN","PSGEUD",32,0)
 .S UD=$P(X,"^",2),DRGN=$$ENDDN^PSGMI(+X) Q:DRGN=""  S:'$D(^PSDRUG(+X,212,"AC",+WG)) WG=""
"RTN","PSGEUD",33,0)
 .I ($P(X,"^",3)?7N)&($P(PSGDT,".")'<$P(X,"^",3)) W !!,"Dispense drug: ",DRGN," **ORDER INACTIVE**" Q
"RTN","PSGEUD",34,0)
 .I ($G(^PSDRUG(+X,"I"))?7N)&($P(PSGDT,".")'<$G(^PSDRUG(+X,"I"))) W !!,"Dispense drug: ",DRGN," **DRUG INACTIVE**" Q
"RTN","PSGEUD",35,0)
 .W !!,"Dispense drug: ",DRGN,"  (U/D: ",$S('UD:1,1:UD),")"
"RTN","PSGEUD",36,0)
 .K DA,DR S DA=+DRG,DA(2)=PSGP,DA(1)=+PSGORD,DIE="^PS(55,"_PSGP_",5,"_+PSGORD_",1,",DR=.11 S:$P($G(^PS(55,PSGP,5,+PSGORD,1,DA,0)),"^",11) $P(^(0),"^",11)=""
"RTN","PSGEUD",37,0)
 .D ^DIE S PSGEUD=PSGEUD+$P($G(^PS(55,PSGP,5,+PSGORD,1,DA,0)),U,11)
"RTN","PSGEUD",38,0)
 I PSGEUD,WG D QS
"RTN","PSGEUD",39,0)
 Q
"RTN","PSGEUD",40,0)
 ;
"RTN","PSGEUD",41,0)
QS ;
"RTN","PSGEUD",42,0)
 W !!,"THIS DRUG IS AN ATC ITEM." S Y=$G(^PS(57.5,WG,3)) I $P(Y,"^",3)="" W $C(7),"  BUT THE ATC DEVICE CANNOT BE FOUND!" S Y=0 Q
"RTN","PSGEUD",43,0)
 S IOP="`"_$P(Y,"^",3),PSGSPD=$P(Y,"^",2) F  W !,"Do you want to dispense ",$S(PSGEUD>1:"these",1:"this")," extra unit",$E("s",PSGEUD>1)," through the ATC" S %=2 D YN^DICN Q:%  D QSH
"RTN","PSGEUD",44,0)
 S Y=0 Q:%'=1  K %ZIS,IO("Q") S %ZIS="NQ",PSGION=ION,IOP=IOP_";255" D ^%ZIS I POP S IOP=PSGION D ^%ZIS W $C(7),!!?10,"** THE ATC MACHINE CANNOT BE FOUND! **" S Y=0 Q
"RTN","PSGEUD",45,0)
 K ZTSAVE S PSGTIR="ENQ^PSGEUD",PSGTID=$H,ZTDESC="EXTRA UNITS TO ATC" F X="PSGP","PSGORD","PSGP(0)","PSGSPD" S ZTSAVE(X)=""
"RTN","PSGEUD",46,0)
 D ENTSK^PSGTI W "...DONE" S Y=0 Q
"RTN","PSGEUD",47,0)
 ;
"RTN","PSGEUD",48,0)
ENQ ;
"RTN","PSGEUD",49,0)
 D NOW^%DTC S DFN=PSGP D PID^VADPT
"RTN","PSGEUD",50,0)
 S %=%_"0000000000000",BLKS="                    ",PN=$E($P(PSGP(0),"^")_BLKS,1,20),PID=$E(VA("PID")_BLKS,1,12),PL=$E($S($D(^DPT(PSGP,.1)):^(.1),1:"*N/F*")_BLKS,1,12)
"RTN","PSGEUD",51,0)
 X ^%ZOSF("LABOFF") F PSGDRG=0:0 S PSGDRG=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDRG)) Q:'PSGDRG  S X=$G(^(PSGDRG,0)) I X D
"RTN","PSGEUD",52,0)
 .S C=$P(X,U,11),PSGEUDA=$P($G(^PSDRUG(+X,8.5)),U,2) Q:(PSGEUDA="")!('C)
"RTN","PSGEUD",53,0)
 .S PSGEUDA=$E(PSGEUDA_BLKS,1,15) S:$L(C)<3 C=$E("000",1,3-$L(C))_C S C=C_$E(%,4,5)_$E(%,6,7)_$E(%,2,3)_$E(%,9,10)_$E(%,11,12) D @$S(PSGSPD:"S2",1:"S1")
"RTN","PSGEUD",54,0)
 Q
"RTN","PSGEUD",55,0)
 ;
"RTN","PSGEUD",56,0)
S1 ;
"RTN","PSGEUD",57,0)
 W $C(48) F Q=1:1:75 R *X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",58,0)
 E  Q
"RTN","PSGEUD",59,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13) F Q=1:1:75 R *X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",60,0)
 Q
"RTN","PSGEUD",61,0)
 ;
"RTN","PSGEUD",62,0)
S2 ;
"RTN","PSGEUD",63,0)
 W $C(48) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:$A(X)=49 S2 I $A(X)=48 Q
"RTN","PSGEUD",64,0)
 E  Q
"RTN","PSGEUD",65,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:$A(X)=49 S2 I $A(X)=48 Q
"RTN","PSGEUD",66,0)
 Q
"RTN","PSGEUD",67,0)
 ;
"RTN","PSGEUD",68,0)
QSH ;
"RTN","PSGEUD",69,0)
 W !!?2,"This drug can be dispensed through the ATC machine.  Enter 'Y' to do so now.  Enter 'N' if you do not want to do so.",! Q
"RTN","PSGEUD",70,0)
 ;
"RTN","PSGEUD",71,0)
H ;
"RTN","PSGEUD",72,0)
 W !!?2,"Select the orders (by number) for which you want to enter extra units",!,"dispensed." D:X'="?" H2^PSGON
"RTN","PSGEUD",73,0)
 Q
"VER")
8.0^22.0
"BLD",5313,6)
^141
**END**
**END**
