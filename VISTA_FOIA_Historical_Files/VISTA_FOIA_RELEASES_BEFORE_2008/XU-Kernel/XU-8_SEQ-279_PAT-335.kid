EMERGENCY Released XU*8*335 SEQ #279
Extracted from mail message
**KIDS**:XU*8.0*335^

**INSTALL NAME**
XU*8.0*335
"BLD",1539,0)
XU*8.0*335^KERNEL^0^3040129^y
"BLD",1539,4,0)
^9.64PA^4.1^2
"BLD",1539,4,4,0)
4
"BLD",1539,4,4,222)
y^n^f^^^^n
"BLD",1539,4,4.1,0)
4.1
"BLD",1539,4,4.1,222)
y^n^f^^^^n
"BLD",1539,4,"B",4,4)

"BLD",1539,4,"B",4.1,4.1)

"BLD",1539,"ABNS",0)
^9.66A^^
"BLD",1539,"ABPKG")
n^n
"BLD",1539,"INIT")
POST^XUMF333
"BLD",1539,"KRN",0)
^9.67PA^19^17
"BLD",1539,"KRN",.4,0)
.4
"BLD",1539,"KRN",.401,0)
.401
"BLD",1539,"KRN",.402,0)
.402
"BLD",1539,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",1539,"KRN",.402,"NM",1,0)
XUMF IMF EDIT    FILE #4^4^0
"BLD",1539,"KRN",.402,"NM","B","XUMF IMF EDIT    FILE #4",1)

"BLD",1539,"KRN",.403,0)
.403
"BLD",1539,"KRN",.5,0)
.5
"BLD",1539,"KRN",.84,0)
.84
"BLD",1539,"KRN",3.6,0)
3.6
"BLD",1539,"KRN",3.8,0)
3.8
"BLD",1539,"KRN",9.2,0)
9.2
"BLD",1539,"KRN",9.8,0)
9.8
"BLD",1539,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",1539,"KRN",9.8,"NM",1,0)
XUMF^^0^B79908671
"BLD",1539,"KRN",9.8,"NM",2,0)
XUMF333^^0^B70114792
"BLD",1539,"KRN",9.8,"NM",3,0)
XUMFEIMF^^0^B19994292
"BLD",1539,"KRN",9.8,"NM",4,0)
XUMFH^^0^B76137050
"BLD",1539,"KRN",9.8,"NM",5,0)
XUMFP4^^0^B33777925
"BLD",1539,"KRN",9.8,"NM",6,0)
XUMFP4C^^0^B15679820
"BLD",1539,"KRN",9.8,"NM",7,0)
XUMFR^^0^B8248716
"BLD",1539,"KRN",9.8,"NM",8,0)
XUMFI^^0^B79802513
"BLD",1539,"KRN",9.8,"NM","B","XUMF",1)

"BLD",1539,"KRN",9.8,"NM","B","XUMF333",2)

"BLD",1539,"KRN",9.8,"NM","B","XUMFEIMF",3)

"BLD",1539,"KRN",9.8,"NM","B","XUMFH",4)

"BLD",1539,"KRN",9.8,"NM","B","XUMFI",8)

"BLD",1539,"KRN",9.8,"NM","B","XUMFP4",5)

"BLD",1539,"KRN",9.8,"NM","B","XUMFP4C",6)

"BLD",1539,"KRN",9.8,"NM","B","XUMFR",7)

"BLD",1539,"KRN",19,0)
19
"BLD",1539,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",1539,"KRN",19,"NM",1,0)
XUMF IMF EDIT STATUS^^0
"BLD",1539,"KRN",19,"NM",2,0)
XUMF IMF ADD EDIT^^0
"BLD",1539,"KRN",19,"NM",3,0)
XUMF INSTITUTION^^0
"BLD",1539,"KRN",19,"NM",4,0)
XUMF LOAD INSTITUTION^^0
"BLD",1539,"KRN",19,"NM",5,0)
XUMF335 clean 4.1 and 4^^0
"BLD",1539,"KRN",19,"NM","B","XUMF IMF ADD EDIT",2)

"BLD",1539,"KRN",19,"NM","B","XUMF IMF EDIT STATUS",1)

"BLD",1539,"KRN",19,"NM","B","XUMF INSTITUTION",3)

"BLD",1539,"KRN",19,"NM","B","XUMF LOAD INSTITUTION",4)

"BLD",1539,"KRN",19,"NM","B","XUMF335 clean 4.1 and 4",5)

"BLD",1539,"KRN",19.1,0)
19.1
"BLD",1539,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",1539,"KRN",19.1,"NM",1,0)
XUMF INSTITUTION^^0
"BLD",1539,"KRN",19.1,"NM","B","XUMF INSTITUTION",1)

"BLD",1539,"KRN",101,0)
101
"BLD",1539,"KRN",409.61,0)
409.61
"BLD",1539,"KRN",771,0)
771
"BLD",1539,"KRN",870,0)
870
"BLD",1539,"KRN",870,"NM",0)
^9.68A^2^2
"BLD",1539,"KRN",870,"NM",1,0)
XUMF TEST^^0
"BLD",1539,"KRN",870,"NM",2,0)
XUMF FORUM^^0
"BLD",1539,"KRN",870,"NM","B","XUMF FORUM",2)

"BLD",1539,"KRN",870,"NM","B","XUMF TEST",1)

"BLD",1539,"KRN",8994,0)
8994
"BLD",1539,"KRN","B",.4,.4)

"BLD",1539,"KRN","B",.401,.401)

"BLD",1539,"KRN","B",.402,.402)

"BLD",1539,"KRN","B",.403,.403)

"BLD",1539,"KRN","B",.5,.5)

"BLD",1539,"KRN","B",.84,.84)

"BLD",1539,"KRN","B",3.6,3.6)

"BLD",1539,"KRN","B",3.8,3.8)

"BLD",1539,"KRN","B",9.2,9.2)

"BLD",1539,"KRN","B",9.8,9.8)

"BLD",1539,"KRN","B",19,19)

"BLD",1539,"KRN","B",19.1,19.1)

"BLD",1539,"KRN","B",101,101)

"BLD",1539,"KRN","B",409.61,409.61)

"BLD",1539,"KRN","B",771,771)

"BLD",1539,"KRN","B",870,870)

"BLD",1539,"KRN","B",8994,8994)

"BLD",1539,"QUES",0)
^9.62^^
"BLD",1539,"REQB",0)
^9.611^7^7
"BLD",1539,"REQB",1,0)
XU*8.0*217^0
"BLD",1539,"REQB",2,0)
XU*8.0*218^0
"BLD",1539,"REQB",3,0)
XU*8.0*206^0
"BLD",1539,"REQB",4,0)
XU*8.0*209^0
"BLD",1539,"REQB",5,0)
XU*8.0*212^0
"BLD",1539,"REQB",6,0)
XU*8.0*270^0
"BLD",1539,"REQB",7,0)
XU*8.0*294^0
"BLD",1539,"REQB","B","XU*8.0*206",3)

"BLD",1539,"REQB","B","XU*8.0*209",4)

"BLD",1539,"REQB","B","XU*8.0*212",5)

"BLD",1539,"REQB","B","XU*8.0*217",1)

"BLD",1539,"REQB","B","XU*8.0*218",2)

"BLD",1539,"REQB","B","XU*8.0*270",6)

"BLD",1539,"REQB","B","XU*8.0*294",7)

"FIA",4)
INSTITUTION
"FIA",4,0)
^DIC(4,
"FIA",4,0,0)
4Is
"FIA",4,0,1)
y^n^f^^^^n
"FIA",4,0,10)

"FIA",4,0,11)

"FIA",4,0,"RLRO")

"FIA",4,0,"VR")
8.0^XU
"FIA",4,4)
0
"FIA",4,4.014)
0
"FIA",4,4.03)
0
"FIA",4,4.999)
0
"FIA",4,4.9999)
0
"FIA",4.1)
FACILITY TYPE
"FIA",4.1,0)
^DIC(4.1,
"FIA",4.1,0,0)
4.1IA
"FIA",4.1,0,1)
y^n^f^^^^n
"FIA",4.1,0,10)

"FIA",4.1,0,11)

"FIA",4.1,0,"RLRO")

"FIA",4.1,0,"VR")
8.0^XU
"FIA",4.1,4.1)
0
"INIT")
POST^XUMF333
"IX",4,4,"XUMFID",0)
4^XUMFID^Enables lookup by coding system concatenated with ID.^R^^R^IR^W^4.9999^^^^^LS
"IX",4,4,"XUMFID",1)
S ^DIC(4,"XUMFID",X(3),DA(1),DA)=""
"IX",4,4,"XUMFID",2)
K ^DIC(4,"XUMFID",X(3),DA(1),DA)
"IX",4,4,"XUMFID",2.5)
K ^DIC(4,"XUMFID")
"IX",4,4,"XUMFID",11.1,0)
^.114IA^3^3
"IX",4,4,"XUMFID",11.1,1,0)
1^F^4.9999^.01^30^^F
"IX",4,4,"XUMFID",11.1,2,0)
2^F^4.9999^.02^30^^F
"IX",4,4,"XUMFID",11.1,3,0)
3^C^^^^1^^CODING SYSTEM/ID PAIR
"IX",4,4,"XUMFID",11.1,3,1.5)
S X=X(1)_X(2)
"IX",4,4,"XUMFIDX",0)
4^XUMFIDX^Regular index coding system / ID.^R^^R^IR^W^4.9999^^^^^LS
"IX",4,4,"XUMFIDX",1)
S ^DIC(4,"XUMFIDX",$E(X(1),1,30),$E(X(2),1,30),DA(1),DA)=""
"IX",4,4,"XUMFIDX",2)
K ^DIC(4,"XUMFIDX",$E(X(1),1,30),$E(X(2),1,30),DA(1),DA)
"IX",4,4,"XUMFIDX",2.5)
K ^DIC(4,"XUMFIDX")
"IX",4,4,"XUMFIDX",11.1,0)
^.114IA^2^2
"IX",4,4,"XUMFIDX",11.1,1,0)
1^F^4.9999^.01^30^1^F
"IX",4,4,"XUMFIDX",11.1,1,3)

"IX",4,4,"XUMFIDX",11.1,2,0)
2^F^4.9999^.02^30^2^F
"IX",4,4,"XUMFIDX",11.1,2,3)

"IX",4,4,"XUMFKEY",0)
4^XUMFKEY^SALDFJASLDFJ^R^^R^IR^W^4.9999^^^^^LS
"IX",4,4,"XUMFKEY",1)
S ^DIC(4,"XUMFKEY",$E(X(1),1,30),$E(X(2),1,30),DA(1),DA)=""
"IX",4,4,"XUMFKEY",2)
K ^DIC(4,"XUMFKEY",$E(X(1),1,30),$E(X(2),1,30),DA(1),DA)
"IX",4,4,"XUMFKEY",2.5)
K ^DIC(4,"XUMFKEY")
"IX",4,4,"XUMFKEY",11.1,0)
^.114IA^2^2
"IX",4,4,"XUMFKEY",11.1,1,0)
1^F^4.9999^.01^30^1^F^
"IX",4,4,"XUMFKEY",11.1,2,0)
2^F^4.9999^.02^30^2^F
"KEY",4,4.9999,"A",0)
4.9999^A^P^20
"KEY",4,4.9999,"A",2,0)
^.312IA^2^2
"KEY",4,4.9999,"A",2,1,0)
.01^4.9999^1
"KEY",4,4.9999,"A",2,2,0)
.02^4.9999^2
"KEYPTR",4,4.9999,"A")
4^XUMFKEY
"KRN",.402,1899,-1)
0^1
"KRN",.402,1899,0)
XUMF IMF EDIT^3031210.1344^@^4^^@^3040116
"KRN",.402,1899,"DIAB",2,0,4,0)
.01;REQ
"KRN",.402,1899,"DIAB",3,0,4,0)
13;REQ
"KRN",.402,1899,"DIAB",4,0,4,0)
100;REQ
"KRN",.402,1899,"DIAB",6,0,4,0)
1.01;REQ
"KRN",.402,1899,"DIAB",8,0,4,0)
1.03;REQ
"KRN",.402,1899,"DIAB",9,0,4,0)
.02;REQ
"KRN",.402,1899,"DIAB",10,0,4,0)
1.04;REQ
"KRN",.402,1899,"DIAB",11,0,4,0)
4.01;REQ
"KRN",.402,1899,"DIAB",13,0,4,0)
4.03;REQ
"KRN",.402,1899,"DIAB",14,0,4,0)
4.04;REQ
"KRN",.402,1899,"DIAB",15,0,4,0)
4.05;REQ
"KRN",.402,1899,"DIAB",16,0,4,0)
95;REQ
"KRN",.402,1899,"DR",1,4)
S XUMF=1;.01R~;13R~;100R~;101;1.01R~;1.02;1.03R~;.02R~;1.04R~;4.01R~;4.02;4.03R~;4.04R~;4.05R~;95R~;
"KRN",19,10212,-1)
0^3
"KRN",19,10212,0)
XUMF INSTITUTION^Institution File Query / Update^Use XUMF LOAD INSTITUTION^R^^XUMF INSTITUTION^^^^^^KERNEL
"KRN",19,10212,1,0)
^^20^20^3000705^
"KRN",19,10212,1,1,0)
This option provides clean up utilities to check for duplicate station
"KRN",19,10212,1,2,0)
numbers and to get a copy of Institution Master File from FORUM for comparison
"KRN",19,10212,1,3,0)
and update purposes.
"KRN",19,10212,1,4,0)

"KRN",19,10212,1,5,0)
The clean up utilities will provide several lists to compare the local
"KRN",19,10212,1,6,0)
INSTITUTION (#4) file with the Institution Master File (IMF) -- the "gold"
"KRN",19,10212,1,7,0)
file of Institutions complete with all approved station numbers including
"KRN",19,10212,1,8,0)
inactive as well as active station numbers.  Utilities will be included to
"KRN",19,10212,1,9,0)
resolve duplicate station numbers and to automatically populate the local
"KRN",19,10212,1,10,0)
INSTITUTION (#4) file with national IMF data.
"KRN",19,10212,1,11,0)

"KRN",19,10212,1,12,0)
The INSTITUTION (#4) file clean up utilities utilize the query functionality
"KRN",19,10212,1,13,0)
provided by the Master File Server mechanism.  An HL7 Master File Query (MFQ)
"KRN",19,10212,1,14,0)
message is sent to FORUM to get the IFM.  The MFQ message is handled by the
"KRN",19,10212,1,15,0)
VistA HL7 package which invokes the Master File Sever (MFS) message handler.
"KRN",19,10212,1,16,0)
The MFS handler interprets the query and builds/sends the appropriate response
"KRN",19,10212,1,17,0)
to the local site in an HL7 Master File Response (MFR) message.  The VistA HL7
"KRN",19,10212,1,18,0)
package invokes the MFS handler on the local site which stores the IMF data
"KRN",19,10212,1,19,0)
in a temporary global.  The clean up utilities use this information for the
"KRN",19,10212,1,20,0)
displays and to automatically update the local INSTITUTION (#4) file.
"KRN",19,10212,25)
EN^XUMF4
"KRN",19,10212,"U")
INSTITUTION FILE QUERY / UPDAT
"KRN",19,10259,-1)
0^2
"KRN",19,10259,0)
XUMF IMF ADD EDIT^IMF edit^^R^^XUMF INSTITUTION^^^^^^KERNEL
"KRN",19,10259,1,0)
^19.06^6^6^3031214^^
"KRN",19,10259,1,1,0)
This option is used to edit this facility's (or associated facility's) 
"KRN",19,10259,1,2,0)
address information.  The edits will update your local INSTITUTION (#4) 
"KRN",19,10259,1,3,0)
file AND the Institution Master File (IMF) on FORUM.
"KRN",19,10259,1,4,0)
 
"KRN",19,10259,1,5,0)
WARNING:  Use extreme care updating this information, because you will be 
"KRN",19,10259,1,6,0)
updating not just your own database but the national database as well.
"KRN",19,10259,25)
MAIN^XUMFEIMF
"KRN",19,10259,"U")
IMF EDIT
"KRN",19,10262,-1)
0^1
"KRN",19,10262,0)
XUMF IMF EDIT STATUS^IMF Display Cleanup Status^^R^^^^^^^^KERNEL
"KRN",19,10262,1,0)
^^2^2^3031214^
"KRN",19,10262,1,1,0)
This option displays the facilities associated the user and the status
"KRN",19,10262,1,2,0)
of the IMF data cleanup for each facility.
"KRN",19,10262,25)
CHK^XUMF333
"KRN",19,10262,"U")
IMF DISPLAY CLEANUP STATUS
"KRN",19,10263,-1)
0^4
"KRN",19,10263,0)
XUMF LOAD INSTITUTION^Update/refresh Institution file with IMF data^^R^^XUMF INSTITUTION^^^^^^KERNEL
"KRN",19,10263,1,0)
^19.06^3^3^3031229^^
"KRN",19,10263,1,1,0)
This option queries the Institution Master File (IMF) to get the
"KRN",19,10263,1,2,0)
gold file of Institutions and automatically updates the local
"KRN",19,10263,1,3,0)
INSTITUTION (#4) file.
"KRN",19,10263,25)
BG^XUMF(4,"ALL",5)
"KRN",19,10263,"U")
UPDATE/REFRESH INSTITUTION FIL
"KRN",19,10265,-1)
0^5
"KRN",19,10265,0)
XUMF335 clean 4.1 and 4^Patch XU*8*335 clean 4.1 and 4^^R^^XUMF INSTITUTION^^^^^^KERNEL
"KRN",19,10265,1,0)
^19.06^3^3^3040115^^
"KRN",19,10265,1,1,0)
This option will remove existing entries from the Facility Type (#4.1)
"KRN",19,10265,1,2,0)
file and get the gold standard from FORUM.  It will then update the
"KRN",19,10265,1,3,0)
Institution (#4) file with IMF data.
"KRN",19,10265,25)
C4^XUMF333
"KRN",19,10265,"U")
PATCH XU*8*335 CLEAN 4.1 AND 4
"KRN",19.1,359,-1)
0^1
"KRN",19.1,359,0)
XUMF INSTITUTION^Institution Master File Key
"KRN",19.1,359,1,0)
^19.11^1^1^3040123^^^^
"KRN",19.1,359,1,1,0)
This key locks the XUMF INSTITUTION option.
"KRN",870,165,-1)
0^2
"KRN",870,165,0)
XUMF FORUM^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,165,200)
^5^^^600^^^^^S
"KRN",870,165,400)
10.2.29.130^5000^C^^^
"KRN",870,166,-1)
0^1
"KRN",870,166,0)
XUMF TEST^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,166,200)
^5^^^600^^^^^S
"KRN",870,166,400)
10.4.229.76^5000^C^^^
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",113,-1)
1^1
"PKG",113,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^XUDOCV7 NEW FEATURES
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
8.0^2950703^2960322^648
"PKG",113,22,1,"PAH",1,0)
335^3040129
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","XUMF")
0^1^B79908671
"RTN","XUMF",1,0)
XUMF ;OIFO-OAK/RAM - XUMF API's;04/15/02
"RTN","XUMF",2,0)
 ;;8.0;KERNEL;**218,335**;Jul 10, 1995
"RTN","XUMF",3,0)
 ;
"RTN","XUMF",4,0)
 Q
"RTN","XUMF",5,0)
 ;
"RTN","XUMF",6,0)
IEN(IFN,CDSYS,ID) ; -- Internal Entry Number
"RTN","XUMF",7,0)
 ;
"RTN","XUMF",8,0)
 N IEN,ROOT
"RTN","XUMF",9,0)
 ;
"RTN","XUMF",10,0)
 S IFN=$G(IFN),CDSYS=$G(CDSYS),ID=$G(ID)
"RTN","XUMF",11,0)
 ;
"RTN","XUMF",12,0)
 Q:'IFN "0^IFN required"
"RTN","XUMF",13,0)
 Q:CDSYS="" "0^CDSYS required"
"RTN","XUMF",14,0)
 Q:ID="" "0^ID required"
"RTN","XUMF",15,0)
 ;
"RTN","XUMF",16,0)
 S ROOT=$$ROOT^DILFD(IFN,,1) Q:ROOT="" "0^invalid IFN"
"RTN","XUMF",17,0)
 S IEN=$O(@ROOT@("XUMFIDX",CDSYS,ID,0))
"RTN","XUMF",18,0)
 ;
"RTN","XUMF",19,0)
 Q $S(IEN:IEN,1:"0^not found")
"RTN","XUMF",20,0)
 ;
"RTN","XUMF",21,0)
FLD(FILE,FIELD) ; field
"RTN","XUMF",22,0)
 ;
"RTN","XUMF",23,0)
 N Y,DA,X
"RTN","XUMF",24,0)
 ;
"RTN","XUMF",25,0)
 S Y=$$FIELD(FILE,FIELD,"LABEL")
"RTN","XUMF",26,0)
 ;
"RTN","XUMF",27,0)
 Q $S(Y'="":1,1:0)
"RTN","XUMF",28,0)
 ;
"RTN","XUMF",29,0)
LBL(FILE,FIELD) ; field label
"RTN","XUMF",30,0)
 ;
"RTN","XUMF",31,0)
 Q $$FIELD(FILE,FIELD,"LABEL")
"RTN","XUMF",32,0)
 ;
"RTN","XUMF",33,0)
TYP(FILE,FIELD) ; field type
"RTN","XUMF",34,0)
 ;
"RTN","XUMF",35,0)
 Q $$FIELD(FILE,FIELD,"TYPE")
"RTN","XUMF",36,0)
 ;
"RTN","XUMF",37,0)
PTR(FILE,FIELD) ; pointer field?
"RTN","XUMF",38,0)
 ;
"RTN","XUMF",39,0)
 Q $S($$TYP(FILE,FIELD)="POINTER":1,1:0)
"RTN","XUMF",40,0)
 ;
"RTN","XUMF",41,0)
FIELD(FILE,FIELD,ATT) ; field attributes
"RTN","XUMF",42,0)
 ;
"RTN","XUMF",43,0)
 N Y,DA,X
"RTN","XUMF",44,0)
 ;
"RTN","XUMF",45,0)
 Q:'$G(FILE) ""
"RTN","XUMF",46,0)
 Q:'$G(FIELD) ""
"RTN","XUMF",47,0)
 Q:$G(ATT)="" ""
"RTN","XUMF",48,0)
 ;
"RTN","XUMF",49,0)
 D FIELD^DID(FILE,FIELD,"N",ATT,"Y")
"RTN","XUMF",50,0)
 ;
"RTN","XUMF",51,0)
 Q $G(Y(ATT))
"RTN","XUMF",52,0)
 ;
"RTN","XUMF",53,0)
FILE(FILE,ATT) ; file attributes
"RTN","XUMF",54,0)
 ;
"RTN","XUMF",55,0)
 N Y,DA,X
"RTN","XUMF",56,0)
 ;
"RTN","XUMF",57,0)
 Q:'$G(FILE) ""
"RTN","XUMF",58,0)
 Q:$G(ATT)="" ""
"RTN","XUMF",59,0)
 ;
"RTN","XUMF",60,0)
 D FILE^DID(FILE,,ATT,"Y")
"RTN","XUMF",61,0)
 ;
"RTN","XUMF",62,0)
 Q $G(Y(ATT))
"RTN","XUMF",63,0)
 ;
"RTN","XUMF",64,0)
ECHO(FILE,IDX,X,XUMF) ; validate field exists and echo name
"RTN","XUMF",65,0)
 ;
"RTN","XUMF",66,0)
 Q:'$$F(+$G(XUMF)) 0
"RTN","XUMF",67,0)
 ;
"RTN","XUMF",68,0)
 N SUBFILE,NAME
"RTN","XUMF",69,0)
 ;
"RTN","XUMF",70,0)
 S SUBFILE=$P($G(^DIC(4.001,+$G(FILE),1,+$G(IDX),0)),U,4)
"RTN","XUMF",71,0)
 ;
"RTN","XUMF",72,0)
 S NAME=$$LBL($S(SUBFILE:SUBFILE,1:+$G(FILE)),X)
"RTN","XUMF",73,0)
 ;
"RTN","XUMF",74,0)
 Q:NAME="" 0
"RTN","XUMF",75,0)
 ;
"RTN","XUMF",76,0)
 ;W " "_NAME
"RTN","XUMF",77,0)
 ;
"RTN","XUMF",78,0)
 Q 1
"RTN","XUMF",79,0)
 ;
"RTN","XUMF",80,0)
F(XUMF) ; constrain edits to standard values
"RTN","XUMF",81,0)
 ;
"RTN","XUMF",82,0)
 Q $S($G(XUMF):1,1:0)
"RTN","XUMF",83,0)
 ;
"RTN","XUMF",84,0)
PKV(IFN,IEN,HLCS) ; Primary Key Value - MFE.4
"RTN","XUMF",85,0)
 ;
"RTN","XUMF",86,0)
 S IFN=$G(IFN),IEN=$G(IEN),HLCS=$G(HLCS)
"RTN","XUMF",87,0)
 ;
"RTN","XUMF",88,0)
 N MFE,NODE,ID,TEXT,CDSYS,IENS
"RTN","XUMF",89,0)
 ;
"RTN","XUMF",90,0)
 S NODE=$G(^DIC(4.001,IFN,"MFE"))
"RTN","XUMF",91,0)
 Q:NODE="" "1Error - MFS parameter not defined for IFN "_IFN
"RTN","XUMF",92,0)
 ;
"RTN","XUMF",93,0)
 S:HLCS="" HLCS="~"
"RTN","XUMF",94,0)
 S CDSYS=$P(NODE,U,3)
"RTN","XUMF",95,0)
 ;
"RTN","XUMF",96,0)
 Q:IEN="NEW" IEN_HLCS_"NEW ENTRY"_HLCS_CDSYS
"RTN","XUMF",97,0)
 ;
"RTN","XUMF",98,0)
 Q:'IFN "1Error - IFN required"
"RTN","XUMF",99,0)
 Q:'IEN "1Error - IEN required"
"RTN","XUMF",100,0)
 ;
"RTN","XUMF",101,0)
 S IENS=IEN_","
"RTN","XUMF",102,0)
 ;
"RTN","XUMF",103,0)
 S FIELD=$P(NODE,U,1),ID=$$GET1^DIQ(IFN,IENS,FIELD)
"RTN","XUMF",104,0)
 S FIELD=$P(NODE,U,2),TEXT=$$GET1^DIQ(IFN,IENS,FIELD)
"RTN","XUMF",105,0)
 ;
"RTN","XUMF",106,0)
 S MFE=ID_HLCS_TEXT_HLCS_CDSYS
"RTN","XUMF",107,0)
 ;
"RTN","XUMF",108,0)
 Q:'$P(NODE,U,4) MFE
"RTN","XUMF",109,0)
 ;
"RTN","XUMF",110,0)
 S FIELD=$P(NODE,U,4),ID=$$GET1^DIQ(IFN,IENS,FIELD)
"RTN","XUMF",111,0)
 S FIELD=$P(NODE,U,5),TEXT=$$GET1^DIQ(IFN,IENS,FIELD)
"RTN","XUMF",112,0)
 S CDSYS=$P(NODE,U,6)
"RTN","XUMF",113,0)
 ;
"RTN","XUMF",114,0)
 Q MFE_HLCS_ID_HLCS_TEXT_HLCS_CDSYS
"RTN","XUMF",115,0)
 ;
"RTN","XUMF",116,0)
MFE(IFN,PKV,HLCS,IEN,ERROR) ; -- update
"RTN","XUMF",117,0)
 ;
"RTN","XUMF",118,0)
 N IENS,MFE,I,X,ID,XREF,NAME,FLD,FDA,DIC
"RTN","XUMF",119,0)
 ;
"RTN","XUMF",120,0)
 S IFN=$G(IFN),IEN=$G(IEN),HLCS=$G(HLCS),ERROR=$G(ERROR)
"RTN","XUMF",121,0)
 S:HLCS="" HLCS="~"
"RTN","XUMF",122,0)
 ;
"RTN","XUMF",123,0)
 Q:ERROR
"RTN","XUMF",124,0)
 ;
"RTN","XUMF",125,0)
 I 'IFN S ERROR="1Error - IFN required" Q
"RTN","XUMF",126,0)
 ;
"RTN","XUMF",127,0)
 I IFN'=4.001 D  Q:ERROR
"RTN","XUMF",128,0)
 .S MFE=$G(^DIC(4.001,IFN,"MFE")),XREF=$P(MFE,U,8)
"RTN","XUMF",129,0)
 .I '$P(MFE,U,1) D  Q
"RTN","XUMF",130,0)
 ..S ERROR="1MFS PARAM MFE.4.1 null"
"RTN","XUMF",131,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",132,0)
 .I '$P(MFE,U,2) D  Q
"RTN","XUMF",133,0)
 ..S ERROR="1MFS PARAM MFE.4.2 null"
"RTN","XUMF",134,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",135,0)
 .I XREF="" D  Q
"RTN","XUMF",136,0)
 ..S ERROR="1MFS PARAM MFE XREF not defined"
"RTN","XUMF",137,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",138,0)
 ;
"RTN","XUMF",139,0)
 I IFN=4.001 D  Q
"RTN","XUMF",140,0)
 .S IEN=$$FIND1^DIC(1,,"BX",$P(PKV,HLCS))
"RTN","XUMF",141,0)
 .I 'IEN D  Q
"RTN","XUMF",142,0)
 ..S ERROR="1not a valid IEN in MFE XUMF"
"RTN","XUMF",143,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",144,0)
 .Q:$D(^DIC(4.001,IEN))
"RTN","XUMF",145,0)
 .X HLNEXT
"RTN","XUMF",146,0)
 .I $P(HLNODE,HLFS)'="ZZZ" D  Q
"RTN","XUMF",147,0)
 ..S ERROR="1MFP error in MFE XUMF"
"RTN","XUMF",148,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",149,0)
 .S MFE=$P(HLNODE,HLFS,7,12),MFE=$TR(MFE,HLFS,U)
"RTN","XUMF",150,0)
 .S X="" F I=5,4,2,1 S:$P(MFE,U,I)=.01 X=I
"RTN","XUMF",151,0)
 .I 'X D  Q
"RTN","XUMF",152,0)
 ..S ERROR="1MFS PARAM no .01 in MFE"
"RTN","XUMF",153,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",154,0)
 .S NAME=$P(PKV,HLCS,X) K X
"RTN","XUMF",155,0)
 .K FDA
"RTN","XUMF",156,0)
 .S FDA(IFN,"?+1,",.01)=NAME
"RTN","XUMF",157,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMF",158,0)
 ;
"RTN","XUMF",159,0)
 S ID=$P(PKV,HLCS)
"RTN","XUMF",160,0)
 I ID="" D  Q
"RTN","XUMF",161,0)
 .S ERROR="1MFS PARAM MFE PKV ID null"
"RTN","XUMF",162,0)
 .D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",163,0)
 S ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMF",164,0)
 I $D(@ROOT@(XREF)),'$G(IEN) S IEN=$O(@ROOT@(XREF,ID,0))
"RTN","XUMF",165,0)
 S:'IEN IEN=$$FIND1^DIC(IFN,,"B",ID)
"RTN","XUMF",166,0)
 ;
"RTN","XUMF",167,0)
 I 'IEN D  Q:ERROR
"RTN","XUMF",168,0)
 .S X="" F I=5,4,2,1 S:$P(MFE,U,I)=.01 X=I
"RTN","XUMF",169,0)
 .I 'X D  Q
"RTN","XUMF",170,0)
 ..S ERROR="1MFS PARAM no .01 in MFE"
"RTN","XUMF",171,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",172,0)
 .S NAME=$P(PKV,HLCS,X) K X
"RTN","XUMF",173,0)
 .I NAME="" S ERROR="1MFS PARAM MFE PKV .01 is null" Q
"RTN","XUMF",174,0)
 .D CHK^DIE(IFN,.01,,NAME,.X)
"RTN","XUMF",175,0)
 .I X="^" D  Q
"RTN","XUMF",176,0)
 ..S ERROR="1MFS PARAM MFE PKV .01 is invalid"
"RTN","XUMF",177,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",178,0)
 .K DIC S DIC=IFN,DIC(0)="F" D FILE^DICN K DIC
"RTN","XUMF",179,0)
 .I Y="-1" D  Q
"RTN","XUMF",180,0)
 ..S ERROR="1MFS PARAM MFE FileDICN unsuccessful"
"RTN","XUMF",181,0)
 ..D EM^XUMFH(ERROR,.ERR)
"RTN","XUMF",182,0)
 .S IEN=+Y
"RTN","XUMF",183,0)
 ;
"RTN","XUMF",184,0)
 S IENS=IEN_","
"RTN","XUMF",185,0)
 ;
"RTN","XUMF",186,0)
 F I=1,2,4,5 D
"RTN","XUMF",187,0)
 .S FLD=$P(MFE,U,I) Q:'FLD
"RTN","XUMF",188,0)
 .S FDA(IFN,IENS,FLD)=$P(PKV,HLCS,I)
"RTN","XUMF",189,0)
 ;
"RTN","XUMF",190,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMF",191,0)
 I $D(ERR) D
"RTN","XUMF",192,0)
 .D EM^XUMFH("1FILE DIE error msg in MFE of XUMF",.ERR)
"RTN","XUMF",193,0)
 .K ERR
"RTN","XUMF",194,0)
 ;
"RTN","XUMF",195,0)
 Q
"RTN","XUMF",196,0)
 ;
"RTN","XUMF",197,0)
MFP(IFN,ERR) ; -- validate Master File Parameters entry FALSE=valid
"RTN","XUMF",198,0)
 ;
"RTN","XUMF",199,0)
 Q:'$G(IFN) "IFN null"
"RTN","XUMF",200,0)
 ;
"RTN","XUMF",201,0)
 D ZERO(IFN,.ERR)
"RTN","XUMF",202,0)
 D MFE1(IFN,.ERR)
"RTN","XUMF",203,0)
 D SEQ(IFN,.ERR)
"RTN","XUMF",204,0)
 ;
"RTN","XUMF",205,0)
 Q $S($D(ERR("FATAL")):1,$D(ERR("WARNING")):2,1:0)
"RTN","XUMF",206,0)
 ;
"RTN","XUMF",207,0)
ZERO(IFN,ERR) ; -- zero node
"RTN","XUMF",208,0)
 ;
"RTN","XUMF",209,0)
 N X,CNT
"RTN","XUMF",210,0)
 ;
"RTN","XUMF",211,0)
 S X=$G(^DIC(4.001,+IFN,0)),CNT=1
"RTN","XUMF",212,0)
 I $P(X,U,2)="" D
"RTN","XUMF",213,0)
 .S ERR("FATAL","ZERO",CNT)="Z SEGMENT is null",CNT=CNT+1
"RTN","XUMF",214,0)
 I $P(X,U,3)="" D
"RTN","XUMF",215,0)
 .S ERR("FATAL","ZERO",CNT)="MFI CODE is null",CNT=CNT+1
"RTN","XUMF",216,0)
 I $P(X,U,4)="" D
"RTN","XUMF",217,0)
 .S ERR("WARNING","ZERO",CNT)="PRE-UPDATE ROUTINE is null",CNT=CNT+1
"RTN","XUMF",218,0)
 I $P(X,U,5)="" D
"RTN","XUMF",219,0)
 .S ERR("WARNING","ZERO",CNT)="POST-UPDATE ROUTINE is null",CNT=CNT+1
"RTN","XUMF",220,0)
 I $P(X,U,6)="" D
"RTN","XUMF",221,0)
 .S ERR("WARNING","ZERO",CNT)="MAIL GROUP is null",CNT=CNT+1
"RTN","XUMF",222,0)
 ;
"RTN","XUMF",223,0)
 Q
"RTN","XUMF",224,0)
 ;
"RTN","XUMF",225,0)
MFE1(IFN,ERR) ; -- MFE node
"RTN","XUMF",226,0)
 ;
"RTN","XUMF",227,0)
 N X,I,CNT
"RTN","XUMF",228,0)
 ;
"RTN","XUMF",229,0)
 S X=$G(^DIC(4.001,+IFN,"MFE")),CNT=1
"RTN","XUMF",230,0)
 F I=1:1:6 I $P(X,U,I)="" D
"RTN","XUMF",231,0)
 .S ERR("FATAL","MFE",CNT)="MFE ID & ALT ID field and codsys required"
"RTN","XUMF",232,0)
 .S CNT=CNT+1
"RTN","XUMF",233,0)
 I $P(X,U,8)="" D
"RTN","XUMF",234,0)
 .S ERR("FATAL","MFE",CNT)="MFE PKV X-REF required",CNT=CNT+1
"RTN","XUMF",235,0)
 F I=11,12,14,15 I $P(X,U,I)="" D
"RTN","XUMF",236,0)
 .S ERR("WARNING","MFE",CNT)="MFE PKV types are null",CNT=CNT+1
"RTN","XUMF",237,0)
 I $P(X,U,9)="" D
"RTN","XUMF",238,0)
 .S ERR("WARNING","MFE",CNT)="ASSIGNING AUTHORITY is null",CNT=CNT+1
"RTN","XUMF",239,0)
 ;
"RTN","XUMF",240,0)
 Q
"RTN","XUMF",241,0)
 ;
"RTN","XUMF",242,0)
SEQ(IFN,ERR) ; -- sequence nodes
"RTN","XUMF",243,0)
 ;
"RTN","XUMF",244,0)
 N SEQ,MULT,X,I,Y
"RTN","XUMF",245,0)
 ;
"RTN","XUMF",246,0)
 S SEQ=0
"RTN","XUMF",247,0)
 F  S SEQ=$O(^DIC(4.001,IFN,1,SEQ)) Q:'SEQ  D
"RTN","XUMF",248,0)
 .S X=$G(^DIC(4.001,IFN,1,SEQ,0))
"RTN","XUMF",249,0)
 .I $$TYP($S($P(X,U,4):$P(X,U,4),1:IFN),$P(X,U,2))="POINTER" D
"RTN","XUMF",250,0)
 ..Q:$P(X,U,7)'=""
"RTN","XUMF",251,0)
 ..S Y=$S($P(X,U,4):$P(X,U,4),1:IFN),Y=$$LBL(Y,$P(X,U,2))
"RTN","XUMF",252,0)
 ..S Y="field "_Y_" is pointer EXTENDED POINTER LKUP is NULL"
"RTN","XUMF",253,0)
 ..S ERR("WARNING",SEQ)=Y
"RTN","XUMF",254,0)
 .S MULT=$S($P(X,U,4):1,1:0)
"RTN","XUMF",255,0)
 .I '$P(X,U,2) S ERR("FATAL",SEQ)=" missing FIELD NUMBER"
"RTN","XUMF",256,0)
 .I MULT,$P(X,U,8)="" D
"RTN","XUMF",257,0)
 ..S ERR("FATAL",SEQ)=" MULT IEN FUNCTION is null"
"RTN","XUMF",258,0)
 .I MULT,$P(X,U,6),$P(X,U,5)'="" D
"RTN","XUMF",259,0)
 ..S ERR("FATAL",SEQ)=" SUBFILE KEY LKUP/KEY SEQ mismatch"
"RTN","XUMF",260,0)
 .I MULT,'$P(X,U,6),$P(X,U,5)="" D
"RTN","XUMF",261,0)
 ..S ERR("FATAL",SEQ)=" SUBFILE KEY LKUP/KEY SEQ mismatch"
"RTN","XUMF",262,0)
 .I 'MULT F I=5,6,8 D
"RTN","XUMF",263,0)
 ..Q:$P(X,U,I)=""
"RTN","XUMF",264,0)
 ..S ERR("FATAL",SEQ)=" SUBFILE null with subfile parameters"
"RTN","XUMF",265,0)
 ;
"RTN","XUMF",266,0)
 Q
"RTN","XUMF",267,0)
 ;
"RTN","XUMF",268,0)
BG(IFN,IEN,TYP) ; -- background job
"RTN","XUMF",269,0)
 ;
"RTN","XUMF",270,0)
 ; type (5=file, 7=array)
"RTN","XUMF",271,0)
 ;
"RTN","XUMF",272,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSAVE
"RTN","XUMF",273,0)
 ;
"RTN","XUMF",274,0)
 S TYP=$G(TYP) S:'TYP TYP=5
"RTN","XUMF",275,0)
 S IEN=$G(IEN) S:IEN="" IEN="ALL"
"RTN","XUMF",276,0)
 ;
"RTN","XUMF",277,0)
 S ZTDTH=$$NOW^XLFDT,ZTRTN="BG1^XUMF",ZTIO=""
"RTN","XUMF",278,0)
 S ZTSAVE("IFN")="",ZTSAVE("TYP")="",ZTSAVE("IEN")=""
"RTN","XUMF",279,0)
 S ZTDESC="XUMF get "_$$FILE^XUMF(IFN,"NAME")_" using MFS"
"RTN","XUMF",280,0)
 ;
"RTN","XUMF",281,0)
 D ^%ZTLOAD
"RTN","XUMF",282,0)
 ;
"RTN","XUMF",283,0)
 Q
"RTN","XUMF",284,0)
 ;
"RTN","XUMF",285,0)
BG1 ; -- get file
"RTN","XUMF",286,0)
 ;
"RTN","XUMF",287,0)
 D MFS(IFN,IEN,TYP,.ERROR),EXIT
"RTN","XUMF",288,0)
 ;
"RTN","XUMF",289,0)
 Q
"RTN","XUMF",290,0)
 ;
"RTN","XUMF",291,0)
LOAD(IFN) ; -- query and file
"RTN","XUMF",292,0)
 ;
"RTN","XUMF",293,0)
 D MFS(IFN,"ALL",5,.ERROR)
"RTN","XUMF",294,0)
 ;
"RTN","XUMF",295,0)
 Q
"RTN","XUMF",296,0)
 ;
"RTN","XUMF",297,0)
ARRAY(IFN) ; -- query and put in array
"RTN","XUMF",298,0)
 ;
"RTN","XUMF",299,0)
 D MFS(IFN,"ALL",7,.ERROR)
"RTN","XUMF",300,0)
 ;
"RTN","XUMF",301,0)
 Q
"RTN","XUMF",302,0)
 ;
"RTN","XUMF",303,0)
GETCE(IFN,IEN,TYP,ERROR) ; -- get master file provide coded element
"RTN","XUMF",304,0)
 ;
"RTN","XUMF",305,0)
 Q
"RTN","XUMF",306,0)
 ;
"RTN","XUMF",307,0)
MFS(IFN,IEN,TYP,ERROR) ; -- get file from Master File Server
"RTN","XUMF",308,0)
 ;
"RTN","XUMF",309,0)
 ; TYP (5=query/file, 7=query/tmp_array)
"RTN","XUMF",310,0)
 ;
"RTN","XUMF",311,0)
 N TEST
"RTN","XUMF",312,0)
 ;
"RTN","XUMF",313,0)
 S (ERROR,TEST)=0
"RTN","XUMF",314,0)
 ;
"RTN","XUMF",315,0)
 S IFN=$G(IFN),IEN=$G(IEN),TYP=$G(TYP)
"RTN","XUMF",316,0)
 ;
"RTN","XUMF",317,0)
 I 'IFN S ERROR="1IFN not valid MFS in XUMF" Q
"RTN","XUMF",318,0)
 I IEN="" S ERROR="1IEN not valid MFS in XUMF" Q
"RTN","XUMF",319,0)
 I TYP'=5,TYP'=7 S ERROR="1type not support by MFS in XUMF" Q
"RTN","XUMF",320,0)
 ;
"RTN","XUMF",321,0)
 I $P($$PARAM^HLCS2,U,3)="T" S TEST=1
"RTN","XUMF",322,0)
 ;
"RTN","XUMF",323,0)
 S PARAM("LLNK")="XUMF MFR^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMF",324,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF",325,0)
 ;
"RTN","XUMF",326,0)
 D MAIN^XUMFP(IFN,"ALL",TYP,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF",327,0)
 D MAIN^XUMFI(IFN,"ALL",TYP,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF",328,0)
 D MAIN^XUMFH
"RTN","XUMF",329,0)
 ;
"RTN","XUMF",330,0)
 Q
"RTN","XUMF",331,0)
 ;
"RTN","XUMF",332,0)
 ;
"RTN","XUMF",333,0)
EXIT ; -- cleanup and quit
"RTN","XUMF",334,0)
 ;
"RTN","XUMF",335,0)
 K ^TMP("XUMF MFS",$J),^TMP("DIERR",$J)
"RTN","XUMF",336,0)
 ;
"RTN","XUMF",337,0)
 S ZTREQ="@"
"RTN","XUMF",338,0)
 ;
"RTN","XUMF",339,0)
 Q
"RTN","XUMF",340,0)
 ;
"RTN","XUMF333")
0^2^B70114792
"RTN","XUMF333",1,0)
XUMF333 ;OIFO-OAK/RAM - Add HCS data types ;02/21/02
"RTN","XUMF333",2,0)
 ;;8.0;KERNEL;**335**;Jul 10, 1995
"RTN","XUMF333",3,0)
 ;
"RTN","XUMF333",4,0)
 Q
"RTN","XUMF333",5,0)
 ;
"RTN","XUMF333",6,0)
 ;
"RTN","XUMF333",7,0)
POST ; -- post installation XU*8*333
"RTN","XUMF333",8,0)
 ;
"RTN","XUMF333",9,0)
 N XUMF,IENS,IEN,FDA,I,HCS,XXX
"RTN","XUMF333",10,0)
 ;
"RTN","XUMF333",11,0)
 S XUMF=1
"RTN","XUMF333",12,0)
 ;
"RTN","XUMF333",13,0)
 D KM,KM1,KM2,KM3,STUFF
"RTN","XUMF333",14,0)
 ;
"RTN","XUMF333",15,0)
 Q
"RTN","XUMF333",16,0)
 ;
"RTN","XUMF333",17,0)
KM ; -- add XUMF IMF EDIT STATUS to XUKERNEL
"RTN","XUMF333",18,0)
 ;
"RTN","XUMF333",19,0)
 N X,Y
"RTN","XUMF333",20,0)
 ;
"RTN","XUMF333",21,0)
 S X=$$FIND1^DIC(19,,"B","XUKERNEL")
"RTN","XUMF333",22,0)
 S Y="?+1,"
"RTN","XUMF333",23,0)
 ;
"RTN","XUMF333",24,0)
 S IENS=Y_X_","
"RTN","XUMF333",25,0)
 S FDA(19,"?1,",.01)="XUKERNEL"
"RTN","XUMF333",26,0)
 S FDA(19.01,"?+2,?1,",.01)="XUMF IMF EDIT STATUS"
"RTN","XUMF333",27,0)
 D UPDATE^DIE("","FDA")
"RTN","XUMF333",28,0)
 ;
"RTN","XUMF333",29,0)
 Q
"RTN","XUMF333",30,0)
 ;
"RTN","XUMF333",31,0)
KM1 ; -- add XUMF IMF EDIT STATUS to XUKERNEL
"RTN","XUMF333",32,0)
 ;
"RTN","XUMF333",33,0)
 N X,Y
"RTN","XUMF333",34,0)
 ;
"RTN","XUMF333",35,0)
 S X=$$FIND1^DIC(19,,"B","XUKERNEL")
"RTN","XUMF333",36,0)
 S Y="?+1,"
"RTN","XUMF333",37,0)
 ;
"RTN","XUMF333",38,0)
 S IENS=Y_X_","
"RTN","XUMF333",39,0)
 S FDA(19,"?1,",.01)="XUKERNEL"
"RTN","XUMF333",40,0)
 S FDA(19.01,"?+3,?1,",.01)="XUMF LOAD INSTITUTION"
"RTN","XUMF333",41,0)
 D UPDATE^DIE("","FDA")
"RTN","XUMF333",42,0)
 ;
"RTN","XUMF333",43,0)
 Q
"RTN","XUMF333",44,0)
 ;
"RTN","XUMF333",45,0)
KM2 ; -- add XUMF IMF EDIT STATUS to XUKERNEL
"RTN","XUMF333",46,0)
 ;
"RTN","XUMF333",47,0)
 N X,Y
"RTN","XUMF333",48,0)
 ;
"RTN","XUMF333",49,0)
 S X=$$FIND1^DIC(19,,"B","XUKERNEL")
"RTN","XUMF333",50,0)
 S Y="?+1,"
"RTN","XUMF333",51,0)
 ;
"RTN","XUMF333",52,0)
 S IENS=Y_X_","
"RTN","XUMF333",53,0)
 S FDA(19,"?1,",.01)="XUKERNEL"
"RTN","XUMF333",54,0)
 S FDA(19.01,"?+3,?1,",.01)="Patch XU*8*335 clean 4.1 and 4"
"RTN","XUMF333",55,0)
 D UPDATE^DIE("","FDA")
"RTN","XUMF333",56,0)
 ;
"RTN","XUMF333",57,0)
 Q
"RTN","XUMF333",58,0)
 ;
"RTN","XUMF333",59,0)
KM3 ; -- remove XUMF333 clean 4.1 and 4 if present
"RTN","XUMF333",60,0)
 ;
"RTN","XUMF333",61,0)
 N X,IENS,FDA
"RTN","XUMF333",62,0)
 ;
"RTN","XUMF333",63,0)
 S X=$$FIND1^DIC(19,,"B","XUMF333 clean 4.1 and 4")
"RTN","XUMF333",64,0)
 ;
"RTN","XUMF333",65,0)
 Q:'X
"RTN","XUMF333",66,0)
 ;
"RTN","XUMF333",67,0)
 S IENS=X_","
"RTN","XUMF333",68,0)
 S FDA(19,IENS,.01)="@"
"RTN","XUMF333",69,0)
 D UPDATE^DIE("","FDA")
"RTN","XUMF333",70,0)
 ;
"RTN","XUMF333",71,0)
 Q
"RTN","XUMF333",72,0)
 ;
"RTN","XUMF333",73,0)
STUFF ;
"RTN","XUMF333",74,0)
 ;
"RTN","XUMF333",75,0)
 S IEN=$O(^DIC(4.1,"B","HCS",0))
"RTN","XUMF333",76,0)
 S IENS=$S(IEN:IEN_",",1:"+1,")
"RTN","XUMF333",77,0)
 K FDA
"RTN","XUMF333",78,0)
 S FDA(4.1,IENS,.01)="HCS"
"RTN","XUMF333",79,0)
 S FDA(4.1,IENS,1)="HEALTH CARE SYSTEM"
"RTN","XUMF333",80,0)
 S FDA(4.1,IENS,3)="LOCAL"
"RTN","XUMF333",81,0)
 D UPDATE^DIE("E","FDA")
"RTN","XUMF333",82,0)
 ;
"RTN","XUMF333",83,0)
 S HCS=""
"RTN","XUMF333",84,0)
 F XXX=1:1 D  Q:HCS=""
"RTN","XUMF333",85,0)
 .S HCS=$P($T(HCS+XXX),";;",2)
"RTN","XUMF333",86,0)
 .S IEN=$S(HCS="":0,1:$O(^DIC(4,"B",HCS,0)))
"RTN","XUMF333",87,0)
 .S IENS=$S(IEN:IEN_",",1:"+1,")
"RTN","XUMF333",88,0)
 .;
"RTN","XUMF333",89,0)
 .K FDA
"RTN","XUMF333",90,0)
 .S FDA(4,IENS,.01)=HCS
"RTN","XUMF333",91,0)
 .S FDA(4,IENS,11)="LOCAL"
"RTN","XUMF333",92,0)
 .S FDA(4,IENS,13)="HCS"
"RTN","XUMF333",93,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMF333",94,0)
 ;
"RTN","XUMF333",95,0)
 Q
"RTN","XUMF333",96,0)
 ;
"RTN","XUMF333",97,0)
HCS ;
"RTN","XUMF333",98,0)
 ;;VA GREATER LOS ANGELES (691)
"RTN","XUMF333",99,0)
 ;;VA HEARTLAND-EAST VISN15 (657)
"RTN","XUMF333",100,0)
 ;;VA HEARTLAND-WEST VISN15 (589)
"RTN","XUMF333",101,0)
 ;;VA CHICAGO HSC (537)
"RTN","XUMF333",102,0)
 ;;CENTRAL PLAINS NETWORK (636)
"RTN","XUMF333",103,0)
 ;;MONTANA HCS (436)
"RTN","XUMF333",104,0)
 ;;VA PACIFIC ISLANDS HCS (459)
"RTN","XUMF333",105,0)
 ;;NEW MEXICO HCS (501)
"RTN","XUMF333",106,0)
 ;;AMARILLO HCS (504)
"RTN","XUMF333",107,0)
 ;;MARYLAND HCS (512)
"RTN","XUMF333",108,0)
 ;;WEST TEXAS HCS (519)
"RTN","XUMF333",109,0)
 ;;BOSTON HCS (523)
"RTN","XUMF333",110,0)
 ;;UPSTATE NEW YORK HCS (528)
"RTN","XUMF333",111,0)
 ;;NORTH TEXAS HCS (549)
"RTN","XUMF333",112,0)
 ;;EASTERN COLORADO HCS (554)
"RTN","XUMF333",113,0)
 ;;NEW JERSEY HCS (561)
"RTN","XUMF333",114,0)
 ;;BLACK HILLS HCS (568)
"RTN","XUMF333",115,0)
 ;;CENTRAL CALIFORNIA HCS (570)
"RTN","XUMF333",116,0)
 ;;N FLORIDA/S GEORGIA HCS (573)
"RTN","XUMF333",117,0)
 ;;GREATER NEBRASKA HCS (597)
"RTN","XUMF333",118,0)
 ;;CENTRAL ARKANSAS HCS (598)
"RTN","XUMF333",119,0)
 ;;LONG BEACH HCS (600)
"RTN","XUMF333",120,0)
 ;;CENTRAL ALABAMA HCS (619)
"RTN","XUMF333",121,0)
 ;;HUDSON VALLEY HCS VAMC (620)
"RTN","XUMF333",122,0)
 ;;TENNESSEE VALLEY HCS (626)
"RTN","XUMF333",123,0)
 ;;PALO ALTO HCS (640)
"RTN","XUMF333",124,0)
 ;;PITTSBURGH HCS (646)
"RTN","XUMF333",125,0)
 ;;ROSEBURG HCS (653)
"RTN","XUMF333",126,0)
 ;;SIERRA NEVADA HCS (654)
"RTN","XUMF333",127,0)
 ;;SALT LAKE CITY HCS (660)
"RTN","XUMF333",128,0)
 ;;PUGET SOUND HCS (663)
"RTN","XUMF333",129,0)
 ;;SAN DIEGO HCS (664)
"RTN","XUMF333",130,0)
 ;;SOUTH TEXAS HCS (671)
"RTN","XUMF333",131,0)
 ;;CENTRAL TEXAS HCS (674)
"RTN","XUMF333",132,0)
 ;;EASTERN KANSAS HCS (677)
"RTN","XUMF333",133,0)
 ;;SOUTHERN ARIZONA VA HCS (678)
"RTN","XUMF333",134,0)
 ;;CONNECTICUT HCS (689)
"RTN","XUMF333",135,0)
 ;;EL PASO VA HCS (756)
"RTN","XUMF333",136,0)
 ;;NEW YORK HHS (630)
"RTN","XUMF333",137,0)
 ;
"RTN","XUMF333",138,0)
 ; do not include
"RTN","XUMF333",139,0)
 ;;EASTERN COLORADO HCS (554A4)
"RTN","XUMF333",140,0)
 ;;SOUTHERN COLORADO HCS
"RTN","XUMF333",141,0)
 ;;CENTRAL IOWA HCS (555)
"RTN","XUMF333",142,0)
 ;;ILLIANA HCS (550)
"RTN","XUMF333",143,0)
 ;;NORTHERN CALIFORNIA HCS (612)
"RTN","XUMF333",144,0)
 ;;SOUTHERN NEVADA HCS (593)
"RTN","XUMF333",145,0)
 ;;NORTHERN ARIZONA HCS (649)
"RTN","XUMF333",146,0)
 ;
"RTN","XUMF333",147,0)
 Q
"RTN","XUMF333",148,0)
 ;
"RTN","XUMF333",149,0)
CHK ; -- check site updating required
"RTN","XUMF333",150,0)
 ;
"RTN","XUMF333",151,0)
 N STA,IEN,FLAG,CHK
"RTN","XUMF333",152,0)
 ;
"RTN","XUMF333",153,0)
 S STA=$$STA^XUAF4(+$G(DUZ(2)))
"RTN","XUMF333",154,0)
 ;
"RTN","XUMF333",155,0)
 I STA="" W !!,"DUZ not defined.  Please log on." Q
"RTN","XUMF333",156,0)
 ;
"RTN","XUMF333",157,0)
 W @IOF,!,STA," ",$P($$NS^XUAF4(+DUZ(2)),U)
"RTN","XUMF333",158,0)
 ;
"RTN","XUMF333",159,0)
 S CHK=$$INST^XUMF333(+DUZ(2),.ERR)
"RTN","XUMF333",160,0)
 I CHK=1 D
"RTN","XUMF333",161,0)
 .W !!?5,"MISSING DATA - please fix",!
"RTN","XUMF333",162,0)
 .S I=0 F  S I=$O(ERR("FATAL",I)) Q:'I  D
"RTN","XUMF333",163,0)
 ..W !?5,ERR("FATAL",I)
"RTN","XUMF333",164,0)
 I CHK'=1 W " is okay"
"RTN","XUMF333",165,0)
 ;
"RTN","XUMF333",166,0)
 S STA=STA_"A"
"RTN","XUMF333",167,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D  Q:$G(FLAG)
"RTN","XUMF333",168,0)
 .I $E($$STA^XUAF4(DUZ(2)),1,3)'=$E(STA,1,3) S FLAG=1 Q
"RTN","XUMF333",169,0)
 .S IEN=$$IEN^XUAF4(STA)
"RTN","XUMF333",170,0)
 .S CHK=$$INST^XUMF333(+IEN,.ERR)
"RTN","XUMF333",171,0)
 .W !!,STA," ",$P($$NS^XUAF4(+IEN),U)
"RTN","XUMF333",172,0)
 .I CHK'=1 W " is okay" Q
"RTN","XUMF333",173,0)
 .I CHK=1 D
"RTN","XUMF333",174,0)
 ..W " is MISSING DATA - please fix",!
"RTN","XUMF333",175,0)
 ..S I=0 F  S I=$O(ERR("FATAL",I)) Q:'I  D
"RTN","XUMF333",176,0)
 ...W !?5,ERR("FATAL",I)
"RTN","XUMF333",177,0)
 .K ERR
"RTN","XUMF333",178,0)
 ;
"RTN","XUMF333",179,0)
 ;
"RTN","XUMF333",180,0)
 Q
"RTN","XUMF333",181,0)
 ;
"RTN","XUMF333",182,0)
INST(IEN,ERR) ; -- validate Institution entry FALSE=valid
"RTN","XUMF333",183,0)
 ;
"RTN","XUMF333",184,0)
 Q:'$G(IEN) "IEN null"
"RTN","XUMF333",185,0)
 ;
"RTN","XUMF333",186,0)
 S CNT=1
"RTN","XUMF333",187,0)
 ;
"RTN","XUMF333",188,0)
 D ZERO(IEN,.ERR,.CNT)
"RTN","XUMF333",189,0)
 D ADD1(IEN,.ERR,.CNT)
"RTN","XUMF333",190,0)
 D ADD2(IEN,.ERR,.CNT)
"RTN","XUMF333",191,0)
 D FTYP(IEN,.ERR,.CNT)
"RTN","XUMF333",192,0)
 D ND99(IEN,.ERR,.CNT)
"RTN","XUMF333",193,0)
 ;
"RTN","XUMF333",194,0)
 Q $S($D(ERR("FATAL")):1,$D(ERR("WARNING")):2,1:0)
"RTN","XUMF333",195,0)
 ;
"RTN","XUMF333",196,0)
ZERO(IEN,ERR,CNT) ; -- zero node
"RTN","XUMF333",197,0)
 ;
"RTN","XUMF333",198,0)
 N X
"RTN","XUMF333",199,0)
 ;
"RTN","XUMF333",200,0)
 S CNT=$G(CNT) S:'CNT CNT=1
"RTN","XUMF333",201,0)
 ;
"RTN","XUMF333",202,0)
 S X=$G(^DIC(4,+IEN,0))
"RTN","XUMF333",203,0)
 I $P(X,U,2)="" D
"RTN","XUMF333",204,0)
 .S ERR("FATAL",CNT)="STATE is missing",CNT=CNT+1
"RTN","XUMF333",205,0)
 ;
"RTN","XUMF333",206,0)
 Q
"RTN","XUMF333",207,0)
 ;
"RTN","XUMF333",208,0)
ADD1(IEN,ERR,CNT) ; -- address node
"RTN","XUMF333",209,0)
 ;
"RTN","XUMF333",210,0)
 N X,I
"RTN","XUMF333",211,0)
 ;
"RTN","XUMF333",212,0)
 S CNT=$G(CNT) S:'CNT CNT=1
"RTN","XUMF333",213,0)
 ;
"RTN","XUMF333",214,0)
 S X=$G(^DIC(4,+IEN,1))
"RTN","XUMF333",215,0)
 I $P(X,U,1)="" D
"RTN","XUMF333",216,0)
 .S ERR("FATAL",CNT)="Physical address St. line 1 missing"
"RTN","XUMF333",217,0)
 .S CNT=CNT+1
"RTN","XUMF333",218,0)
 I $P(X,U,3)="" D
"RTN","XUMF333",219,0)
 .S ERR("FATAL",CNT)="Physical address City missing"
"RTN","XUMF333",220,0)
 .S CNT=CNT+1
"RTN","XUMF333",221,0)
 I $P(X,U,4)="" D
"RTN","XUMF333",222,0)
 .S ERR("FATAL",CNT)="Physical address ZIP missing"
"RTN","XUMF333",223,0)
 .S CNT=CNT+1
"RTN","XUMF333",224,0)
 I $P(X,U,2)="" D
"RTN","XUMF333",225,0)
 .S ERR("WARNING",CNT)="Physical address St. line 2 missing"
"RTN","XUMF333",226,0)
 .S CNT=CNT+1
"RTN","XUMF333",227,0)
 ;
"RTN","XUMF333",228,0)
 Q
"RTN","XUMF333",229,0)
 ;
"RTN","XUMF333",230,0)
ADD2(IEN,ERR,CNT) ; -- mailing address node
"RTN","XUMF333",231,0)
 ;
"RTN","XUMF333",232,0)
 N X,I
"RTN","XUMF333",233,0)
 ;
"RTN","XUMF333",234,0)
 S CNT=$G(CNT) S:'CNT CNT=1
"RTN","XUMF333",235,0)
 ;
"RTN","XUMF333",236,0)
 S X=$G(^DIC(4,+IEN,4))
"RTN","XUMF333",237,0)
 I $P(X,U,1)="" D
"RTN","XUMF333",238,0)
 .S ERR("FATAL",CNT)="Mailing address St. line 1 missing"
"RTN","XUMF333",239,0)
 .S CNT=CNT+1
"RTN","XUMF333",240,0)
 I $P(X,U,3)="" D
"RTN","XUMF333",241,0)
 .S ERR("FATAL",CNT)="Mailing address City missing"
"RTN","XUMF333",242,0)
 .S CNT=CNT+1
"RTN","XUMF333",243,0)
 I $P(X,U,4)="" D
"RTN","XUMF333",244,0)
 .S ERR("FATAL",CNT)="Mailing address State missing"
"RTN","XUMF333",245,0)
 .S CNT=CNT+1
"RTN","XUMF333",246,0)
 I $P(X,U,5)="" D
"RTN","XUMF333",247,0)
 .S ERR("FATAL",CNT)="Mailing address ZIP missing"
"RTN","XUMF333",248,0)
 .S CNT=CNT+1
"RTN","XUMF333",249,0)
 I $P(X,U,2)="" D
"RTN","XUMF333",250,0)
 .S ERR("WARNING",CNT)="Mailing address St. line 2 missing"
"RTN","XUMF333",251,0)
 .S CNT=CNT+1
"RTN","XUMF333",252,0)
 ;
"RTN","XUMF333",253,0)
 Q
"RTN","XUMF333",254,0)
 ;
"RTN","XUMF333",255,0)
FTYP(IEN,ERR,CNT) ; -- facility type node
"RTN","XUMF333",256,0)
 ;
"RTN","XUMF333",257,0)
 N X
"RTN","XUMF333",258,0)
 ;
"RTN","XUMF333",259,0)
 S CNT=$G(CNT) S:'CNT CNT=1
"RTN","XUMF333",260,0)
 ;
"RTN","XUMF333",261,0)
 S X=$G(^DIC(4,+IEN,3))
"RTN","XUMF333",262,0)
 I 'X D
"RTN","XUMF333",263,0)
 .S ERR("FATAL",CNT)="FACILITY TYPE is missing",CNT=CNT+1
"RTN","XUMF333",264,0)
 I $P($G(^DIC(4.1,+X,0)),U,4)'="N" D
"RTN","XUMF333",265,0)
 .S ERR("FATAL",CNT)="FACILITY TYPE is not NATIONAL",CNT=CNT+1
"RTN","XUMF333",266,0)
 ;
"RTN","XUMF333",267,0)
 Q
"RTN","XUMF333",268,0)
 ;
"RTN","XUMF333",269,0)
ND99(IEN,ERR,CNT) ; -- 99 node
"RTN","XUMF333",270,0)
 ;
"RTN","XUMF333",271,0)
 N X
"RTN","XUMF333",272,0)
 ;
"RTN","XUMF333",273,0)
 S CNT=$G(CNT) S:'CNT CNT=1
"RTN","XUMF333",274,0)
 ;
"RTN","XUMF333",275,0)
 S X=$G(^DIC(4,+IEN,99))
"RTN","XUMF333",276,0)
 I $P(X,U,3)="" D
"RTN","XUMF333",277,0)
 .S ERR("FATAL",CNT)="OFFICIAL VA NAME is missing",CNT=CNT+1
"RTN","XUMF333",278,0)
 I ($P(X,U,4))&($E($$NS^XUAF4(+IEN),1,2)'="ZZ") D
"RTN","XUMF333",279,0)
 .S ERR("FATAL",CNT)="Inactive facility NAME not ZZ'd",CNT=CNT+1
"RTN","XUMF333",280,0)
 ;
"RTN","XUMF333",281,0)
 Q
"RTN","XUMF333",282,0)
 ;
"RTN","XUMF333",283,0)
C4 ; -- clean up Institution file
"RTN","XUMF333",284,0)
 ;
"RTN","XUMF333",285,0)
 D RIP,CFTYP,GET
"RTN","XUMF333",286,0)
 ;
"RTN","XUMF333",287,0)
 Q
"RTN","XUMF333",288,0)
 ;
"RTN","XUMF333",289,0)
RIP ; -- remove from all inactive and local the associations visn & parent
"RTN","XUMF333",290,0)
 ;
"RTN","XUMF333",291,0)
 N IEN
"RTN","XUMF333",292,0)
 ;
"RTN","XUMF333",293,0)
 S IEN=0
"RTN","XUMF333",294,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF333",295,0)
 .I $P($G(^DIC(4,+IEN,0)),U,11)="N",'$P($G(^DIC(4,+IEN,99)),U,4) Q
"RTN","XUMF333",296,0)
 .D IFF^XUMF333(IEN)
"RTN","XUMF333",297,0)
 ;
"RTN","XUMF333",298,0)
 Q
"RTN","XUMF333",299,0)
 ;
"RTN","XUMF333",300,0)
IFF(IEN) ; -- inactive facility remove VISN and parent association
"RTN","XUMF333",301,0)
 ;
"RTN","XUMF333",302,0)
 N FDA,IENS,XUMF
"RTN","XUMF333",303,0)
 ;
"RTN","XUMF333",304,0)
 S XUMF=1
"RTN","XUMF333",305,0)
 ;
"RTN","XUMF333",306,0)
 S IENS="1,"_IEN_","
"RTN","XUMF333",307,0)
 S FDA(4.014,IENS,.01)="@"
"RTN","XUMF333",308,0)
 S IENS="2,"_IEN_","
"RTN","XUMF333",309,0)
 S FDA(4.014,IENS,.01)="@"
"RTN","XUMF333",310,0)
 D FILE^DIE("E","FDA")
"RTN","XUMF333",311,0)
 ;
"RTN","XUMF333",312,0)
 Q
"RTN","XUMF333",313,0)
 ;
"RTN","XUMF333",314,0)
CFTYP ; - clean 4.1
"RTN","XUMF333",315,0)
 ;
"RTN","XUMF333",316,0)
 N FDA,IENS,XUMF,IEN
"RTN","XUMF333",317,0)
 ;
"RTN","XUMF333",318,0)
 M ^TMP("XUMF 4.1",$J)=^DIC(4.1)
"RTN","XUMF333",319,0)
 ;
"RTN","XUMF333",320,0)
 S XUMF=1
"RTN","XUMF333",321,0)
 ;
"RTN","XUMF333",322,0)
 S IEN=0
"RTN","XUMF333",323,0)
 F  S IEN=$O(^DIC(4.1,IEN)) Q:'IEN  D
"RTN","XUMF333",324,0)
 .S IENS=IEN_","
"RTN","XUMF333",325,0)
 .K FDA
"RTN","XUMF333",326,0)
 .S FDA(4.1,IENS,.01)="@"
"RTN","XUMF333",327,0)
 .D FILE^DIE("E","FDA")
"RTN","XUMF333",328,0)
 ;
"RTN","XUMF333",329,0)
 S IEN=0
"RTN","XUMF333",330,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF333",331,0)
 .S IENS=IEN_","
"RTN","XUMF333",332,0)
 .K FDA
"RTN","XUMF333",333,0)
 .S FDA(4,IENS,13)="@"
"RTN","XUMF333",334,0)
 .D FILE^DIE("E","FDA")
"RTN","XUMF333",335,0)
 ;
"RTN","XUMF333",336,0)
 Q
"RTN","XUMF333",337,0)
 ;
"RTN","XUMF333",338,0)
GET ; -- get Institution Master File (IMF) and Facility Types
"RTN","XUMF333",339,0)
 ;
"RTN","XUMF333",340,0)
 W !!,"...getting Facility Types - wait please 5 min..."
"RTN","XUMF333",341,0)
 D LOAD^XUMF(4.1)
"RTN","XUMF333",342,0)
 W !!,"...getting Institutions - wait please 10 min..."
"RTN","XUMF333",343,0)
 D LOAD^XUMF(4)
"RTN","XUMF333",344,0)
 ;
"RTN","XUMF333",345,0)
 Q
"RTN","XUMF333",346,0)
 ;
"RTN","XUMF333",347,0)
SCN(IEN,XUMF) ; screen out HCS entries
"RTN","XUMF333",348,0)
 ;
"RTN","XUMF333",349,0)
 ; IEN = Institution Internal Entry Number to check
"RTN","XUMF333",350,0)
 ;
"RTN","XUMF333",351,0)
 S XUMF=$G(XUMF) Q:XUMF 1
"RTN","XUMF333",352,0)
 ;
"RTN","XUMF333",353,0)
 I $O(^DIC(4.1,"B","HCS",0))=+$G(^DIC(4,+IEN,3)) Q 0
"RTN","XUMF333",354,0)
 ;
"RTN","XUMF333",355,0)
 Q 1
"RTN","XUMF333",356,0)
 ;
"RTN","XUMFEIMF")
0^3^B19994292
"RTN","XUMFEIMF",1,0)
XUMFEIMF ;OIFO-OAK/RAM - Edit IMF ;06/28/00
"RTN","XUMFEIMF",2,0)
 ;;8.0;KERNEL;**217,335**;Jul 10, 1995
"RTN","XUMFEIMF",3,0)
 ;
"RTN","XUMFEIMF",4,0)
 ; $$PARAM^HLCS2 call supported by IA #3552
"RTN","XUMFEIMF",5,0)
 ;
"RTN","XUMFEIMF",6,0)
 Q
"RTN","XUMFEIMF",7,0)
 ;
"RTN","XUMFEIMF",8,0)
MAIN ; -- main
"RTN","XUMFEIMF",9,0)
 ;
"RTN","XUMFEIMF",10,0)
 D INIT,SEL1
"RTN","XUMFEIMF",11,0)
 ;
"RTN","XUMFEIMF",12,0)
 I $G(DIRUT) G EXIT
"RTN","XUMFEIMF",13,0)
 I ERROR H 5 D EXIT G MAIN
"RTN","XUMFEIMF",14,0)
 ;
"RTN","XUMFEIMF",15,0)
EDT ;
"RTN","XUMFEIMF",16,0)
 D PRE,EDIT,POST
"RTN","XUMFEIMF",17,0)
 ;
"RTN","XUMFEIMF",18,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","XUMFEIMF",19,0)
 S DIR("A")="Are you ready to update the Institution Master File"
"RTN","XUMFEIMF",20,0)
 D ^DIR K DIR
"RTN","XUMFEIMF",21,0)
 I $G(DIRUT) D  G EDT
"RTN","XUMFEIMF",22,0)
 .W !!,"WARNING: You modified your entry without updating the IMF!"
"RTN","XUMFEIMF",23,0)
 G:'Y EDT
"RTN","XUMFEIMF",24,0)
 ;
"RTN","XUMFEIMF",25,0)
SEND ;
"RTN","XUMFEIMF",26,0)
 W !,"...send HL7 message to Master File Server..."
"RTN","XUMFEIMF",27,0)
 S PARAM("LLNK")="XUMF IMF MFK^XUMF "_$S('TEST:"FORUM",1:"TEST")
"RTN","XUMFEIMF",28,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF IMF MFN",0))
"RTN","XUMFEIMF",29,0)
 D MAIN^XUMFP(4,IEN,0,.PARAM,.ERROR) Q:ERROR
"RTN","XUMFEIMF",30,0)
 D MAIN^XUMFI(4,IEN,0,.PARAM,.ERROR)
"RTN","XUMFEIMF",31,0)
 ;
"RTN","XUMFEIMF",32,0)
 I $G(ERROR) W !,$G(ERROR),!
"RTN","XUMFEIMF",33,0)
 I '$G(ERROR) W !,"Sent."
"RTN","XUMFEIMF",34,0)
 ;
"RTN","XUMFEIMF",35,0)
 H 1
"RTN","XUMFEIMF",36,0)
 ;
"RTN","XUMFEIMF",37,0)
 L -^DIC(4,IEN)
"RTN","XUMFEIMF",38,0)
 ;
"RTN","XUMFEIMF",39,0)
 D EXIT G MAIN
"RTN","XUMFEIMF",40,0)
 ;
"RTN","XUMFEIMF",41,0)
 Q
"RTN","XUMFEIMF",42,0)
 ;
"RTN","XUMFEIMF",43,0)
INIT ; -- initialize
"RTN","XUMFEIMF",44,0)
 ;
"RTN","XUMFEIMF",45,0)
 K ^TMP("XUMF MFS",$J),^TMP("HLS",$J),^TMP("HLA",$J),PARAM
"RTN","XUMFEIMF",46,0)
 D CLEAN^DILF
"RTN","XUMFEIMF",47,0)
 ;
"RTN","XUMFEIMF",48,0)
 ;
"RTN","XUMFEIMF",49,0)
 S (ERROR,TEST,FLAG)=0
"RTN","XUMFEIMF",50,0)
 ;
"RTN","XUMFEIMF",51,0)
 I $P($$PARAM^HLCS2,U,3)="T" S TEST=1
"RTN","XUMFEIMF",52,0)
 ;
"RTN","XUMFEIMF",53,0)
 ;
"RTN","XUMFEIMF",54,0)
 S XUMF=1
"RTN","XUMFEIMF",55,0)
 ;
"RTN","XUMFEIMF",56,0)
 D LOAD^XUMF(4.1)
"RTN","XUMFEIMF",57,0)
 ;
"RTN","XUMFEIMF",58,0)
 Q
"RTN","XUMFEIMF",59,0)
 ;
"RTN","XUMFEIMF",60,0)
SEL1 ; -- select one institution
"RTN","XUMFEIMF",61,0)
 ;
"RTN","XUMFEIMF",62,0)
 D CHK^XUMF333
"RTN","XUMFEIMF",63,0)
 ;
"RTN","XUMFEIMF",64,0)
 W !
"RTN","XUMFEIMF",65,0)
 ;
"RTN","XUMFEIMF",66,0)
 K DIR
"RTN","XUMFEIMF",67,0)
 S DIR(0)="F^3:7^K:'(X?3N.AN) X"
"RTN","XUMFEIMF",68,0)
 S DIR("A")="Enter Station Number"
"RTN","XUMFEIMF",69,0)
 D ^DIR Q:$G(DIRUT)
"RTN","XUMFEIMF",70,0)
 ;
"RTN","XUMFEIMF",71,0)
 S STA=Y
"RTN","XUMFEIMF",72,0)
 ;
"RTN","XUMFEIMF",73,0)
 S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMFEIMF",74,0)
 ;
"RTN","XUMFEIMF",75,0)
 I 'IEN W "   Invalid selection!" H 2 G SEL1
"RTN","XUMFEIMF",76,0)
 ;
"RTN","XUMFEIMF",77,0)
 L +^DIC(4,IEN):0 I '$T D  Q
"RTN","XUMFEIMF",78,0)
 .S ERROR="1^Another user is editing this entry."
"RTN","XUMFEIMF",79,0)
 .W !,ERROR,!
"RTN","XUMFEIMF",80,0)
 ;
"RTN","XUMFEIMF",81,0)
 I 'IEN D  Q
"RTN","XUMFEIMF",82,0)
 .S ERROR="1^Not an existing Station Number,"
"RTN","XUMFEIMF",83,0)
 .W !,ERROR,!
"RTN","XUMFEIMF",84,0)
 ;
"RTN","XUMFEIMF",85,0)
 I $E($$STA^XUAF4(+$G(DUZ(2))),1,3)'=$E(STA,1,3) D  Q
"RTN","XUMFEIMF",86,0)
 .S ERROR="1^Option may only be used to edit your facility!"
"RTN","XUMFEIMF",87,0)
 .W !,ERROR
"RTN","XUMFEIMF",88,0)
 .W !," to edit an inactive faciliy log on to that division"
"RTN","XUMFEIMF",89,0)
 .W !," you must have DIVISION in your NEW PERSON multiple."
"RTN","XUMFEIMF",90,0)
 .W !!," If Inactive facility not selectable - assign with"
"RTN","XUMFEIMF",91,0)
 .W !," XUMGR security key."
"RTN","XUMFEIMF",92,0)
 ;
"RTN","XUMFEIMF",93,0)
 Q
"RTN","XUMFEIMF",94,0)
 ;
"RTN","XUMFEIMF",95,0)
PRE ; -- pre-udpate
"RTN","XUMFEIMF",96,0)
 ;
"RTN","XUMFEIMF",97,0)
 S N0=$G(^DIC(4,+IEN,0))
"RTN","XUMFEIMF",98,0)
 S N1=$G(^DIC(4,+IEN,1))
"RTN","XUMFEIMF",99,0)
 S N3=$G(^DIC(4,+IEN,3))
"RTN","XUMFEIMF",100,0)
 S N4=$G(^DIC(4,+IEN,4))
"RTN","XUMFEIMF",101,0)
 S NV=$G(^DIC(4,+IEN,7,1))
"RTN","XUMFEIMF",102,0)
 S NP=$G(^DIC(4,+IEN,7,2))
"RTN","XUMFEIMF",103,0)
 S N99=$G(^DIC(4,+IEN,99))
"RTN","XUMFEIMF",104,0)
 ;
"RTN","XUMFEIMF",105,0)
 Q
"RTN","XUMFEIMF",106,0)
 ;
"RTN","XUMFEIMF",107,0)
EDIT ; -- address edit
"RTN","XUMFEIMF",108,0)
 ;
"RTN","XUMFEIMF",109,0)
 S DIE("NO^")="BACK"
"RTN","XUMFEIMF",110,0)
 ;
"RTN","XUMFEIMF",111,0)
 ; edit template
"RTN","XUMFEIMF",112,0)
 S DIE=4,DA=IEN
"RTN","XUMFEIMF",113,0)
 S DR="[XUMF IMF EDIT]"
"RTN","XUMFEIMF",114,0)
 D ^DIE
"RTN","XUMFEIMF",115,0)
 ;
"RTN","XUMFEIMF",116,0)
 ; if inactive remove parent and visn then quit
"RTN","XUMFEIMF",117,0)
 I $P($G(^DIC(4,+IEN,99)),U,4) D  Q
"RTN","XUMFEIMF",118,0)
 .K IENS,FDA
"RTN","XUMFEIMF",119,0)
 .S IENS="1,"_IEN_","
"RTN","XUMFEIMF",120,0)
 .S FDA(4.014,IENS,.01)="@"
"RTN","XUMFEIMF",121,0)
 .D FILE^DIE("E","FDA")
"RTN","XUMFEIMF",122,0)
 .K IENS,FDA
"RTN","XUMFEIMF",123,0)
 .S IENS="2,"_IEN_","
"RTN","XUMFEIMF",124,0)
 .S FDA(4.014,IENS,.01)="@"
"RTN","XUMFEIMF",125,0)
 .D FILE^DIE("E","FDA")
"RTN","XUMFEIMF",126,0)
 .W !
"RTN","XUMFEIMF",127,0)
 ;
"RTN","XUMFEIMF",128,0)
VN K DIR
"RTN","XUMFEIMF",129,0)
 S DIR(0)="N^1:23^"
"RTN","XUMFEIMF",130,0)
 S DIR("A")="Enter VISN Number"
"RTN","XUMFEIMF",131,0)
 D ^DIR
"RTN","XUMFEIMF",132,0)
 ;
"RTN","XUMFEIMF",133,0)
 G:'Y VN
"RTN","XUMFEIMF",134,0)
 ;
"RTN","XUMFEIMF",135,0)
 K IENS,FDA
"RTN","XUMFEIMF",136,0)
 S IENS="?+1,"_IEN_","
"RTN","XUMFEIMF",137,0)
 S FDA(4.014,IENS,.01)="VISN"
"RTN","XUMFEIMF",138,0)
 S FDA(4.014,IENS,1)="VISN "_Y
"RTN","XUMFEIMF",139,0)
 D UPDATE^DIE("E","FDA")
"RTN","XUMFEIMF",140,0)
 ;
"RTN","XUMFEIMF",141,0)
PF ;
"RTN","XUMFEIMF",142,0)
 ; parent facility
"RTN","XUMFEIMF",143,0)
 W !,"Parent ASSOCIATION - Enter the admin PARENT for this facility"
"RTN","XUMFEIMF",144,0)
 S DIE="^DIC(4,"_IEN_",7,"
"RTN","XUMFEIMF",145,0)
 S DA(1)=IEN,DA=2
"RTN","XUMFEIMF",146,0)
 S DR="1~PARENT"
"RTN","XUMFEIMF",147,0)
 D ^DIE
"RTN","XUMFEIMF",148,0)
 W !
"RTN","XUMFEIMF",149,0)
 ;
"RTN","XUMFEIMF",150,0)
 Q
"RTN","XUMFEIMF",151,0)
 ;
"RTN","XUMFEIMF",152,0)
POST ; -- post update
"RTN","XUMFEIMF",153,0)
 ;
"RTN","XUMFEIMF",154,0)
 I $P($G(^DIC(4,+IEN,0)),U,2)'=$P($G(N0),U,2) S FLAG=1 Q
"RTN","XUMFEIMF",155,0)
 I $G(^DIC(4,+IEN,1))'=$G(N1) S FLAG=1 Q
"RTN","XUMFEIMF",156,0)
 I $G(^DIC(4,+IEN,4))'=$G(N4) S FLAG=1 Q
"RTN","XUMFEIMF",157,0)
 I $G(^DIC(4,+IEN,3))'=$G(N3) S FLAG=1 Q
"RTN","XUMFEIMF",158,0)
 I $G(^DIC(4,+IEN,7,1))'=$G(NV) S FLAG=1 Q
"RTN","XUMFEIMF",159,0)
 I $G(^DIC(4,+IEN,7,2))'=$G(NP) S FLAG=1 Q
"RTN","XUMFEIMF",160,0)
 I $G(^DIC(4,+IEN,99))'=$G(N99) S FLAG=1 Q
"RTN","XUMFEIMF",161,0)
 ;
"RTN","XUMFEIMF",162,0)
 Q
"RTN","XUMFEIMF",163,0)
 ;
"RTN","XUMFEIMF",164,0)
EXIT ; -- clean up
"RTN","XUMFEIMF",165,0)
 ;
"RTN","XUMFEIMF",166,0)
 D CLEAN^DILF,KILL^XUSCLEAN
"RTN","XUMFEIMF",167,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J),^TMP("XUMF MFS",$J)
"RTN","XUMFEIMF",168,0)
 ;
"RTN","XUMFEIMF",169,0)
 K N0,N1,N3,N4,NV,NP,N99,XUMF,DIRUT,PARAM,DA,DR,DIE
"RTN","XUMFEIMF",170,0)
 K DIC,DIR,X,Y,NAME,STA,FLAG,IEN,TEST,ERROR,IENS
"RTN","XUMFEIMF",171,0)
 ;
"RTN","XUMFEIMF",172,0)
 Q
"RTN","XUMFEIMF",173,0)
 ;
"RTN","XUMFH")
0^4^B76137050
"RTN","XUMFH",1,0)
XUMFH ;CIOFO-SF/RAM - Master File HL7 Msg Handler ;06/28/00
"RTN","XUMFH",2,0)
 ;;8.0;KERNEL;**206,209,217,218,262,335**;Jul 10, 1995
"RTN","XUMFH",3,0)
 ;
"RTN","XUMFH",4,0)
 ; This routine handles Master File HL7 messages.
"RTN","XUMFH",5,0)
 ;
"RTN","XUMFH",6,0)
MAIN ; -- entry point
"RTN","XUMFH",7,0)
 ;
"RTN","XUMFH",8,0)
 N CNT,ERR,I,X,HLFS,HLCS,ERROR,HLRESLTA,IFN,IEN,MTPE,TYPE,ARRAY
"RTN","XUMFH",9,0)
 N HDT,KEY,MID,REASON,VALUE,XREF,ALL,GROUP,PARAM,ROOT,SEG,QRD
"RTN","XUMFH",10,0)
 N QID,WHAT,WHO,HLSCS,CDSYS
"RTN","XUMFH",11,0)
 ;
"RTN","XUMFH",12,0)
 D INIT,PROCESS,REPLY,EXIT
"RTN","XUMFH",13,0)
 ;
"RTN","XUMFH",14,0)
 Q
"RTN","XUMFH",15,0)
 ;
"RTN","XUMFH",16,0)
INIT ; -- initialize
"RTN","XUMFH",17,0)
 ;
"RTN","XUMFH",18,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFH",19,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",20,0)
 ;
"RTN","XUMFH",21,0)
 S (ERROR,CNT,TYPE,ARRAY)=0
"RTN","XUMFH",22,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH")),HLSCS=$E(HL("ECH"),4)
"RTN","XUMFH",23,0)
 ;
"RTN","XUMFH",24,0)
 Q
"RTN","XUMFH",25,0)
 ;
"RTN","XUMFH",26,0)
PROCESS ; -- pull message text
"RTN","XUMFH",27,0)
 ;
"RTN","XUMFH",28,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMFH",29,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMFH",30,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMFH",31,0)
 ;
"RTN","XUMFH",32,0)
 Q
"RTN","XUMFH",33,0)
 ;
"RTN","XUMFH",34,0)
MSH ; -- MSH segment
"RTN","XUMFH",35,0)
 ;
"RTN","XUMFH",36,0)
 Q
"RTN","XUMFH",37,0)
 ;
"RTN","XUMFH",38,0)
MSA ; -- MSA segment
"RTN","XUMFH",39,0)
 ;
"RTN","XUMFH",40,0)
 N CODE
"RTN","XUMFH",41,0)
 ;
"RTN","XUMFH",42,0)
 S CODE=$P(HLNODE,HLFS,2)
"RTN","XUMFH",43,0)
 ;
"RTN","XUMFH",44,0)
 I CODE="AE"!(CODE="AR") D
"RTN","XUMFH",45,0)
 .S ERROR=ERROR_U_$P(HLNODE,HLFS,4)_U_$G(ERR)
"RTN","XUMFH",46,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",47,0)
 ;
"RTN","XUMFH",48,0)
 Q
"RTN","XUMFH",49,0)
 ;
"RTN","XUMFH",50,0)
QRD ; -- QRD segment
"RTN","XUMFH",51,0)
 ;
"RTN","XUMFH",52,0)
 Q:ERROR
"RTN","XUMFH",53,0)
 ;
"RTN","XUMFH",54,0)
 S QRD="QRD,QDT,QFC,QP,QID,DRT,DRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL"
"RTN","XUMFH",55,0)
 ;
"RTN","XUMFH",56,0)
 F I=2:1:13 S PARAM($P(QRD,",",I))=$P(HLNODE,HLFS,I)
"RTN","XUMFH",57,0)
 S QID=$P(HLNODE,HLFS,5)
"RTN","XUMFH",58,0)
 S WHO=$P(HLNODE,HLFS,9)
"RTN","XUMFH",59,0)
 I WHO="" D  Q
"RTN","XUMFH",60,0)
 .S ERROR="1^QRD segment has null missing WHO parameter"
"RTN","XUMFH",61,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",62,0)
 S WHAT=$P(HLNODE,HLFS,10)
"RTN","XUMFH",63,0)
 I WHAT="" D  Q
"RTN","XUMFH",64,0)
 .S ERROR="1^QRD segment has null missing WHAT parameter"
"RTN","XUMFH",65,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",66,0)
 ;
"RTN","XUMFH",67,0)
 S ARRAY=$S(QID["ARRAY":1,1:0)
"RTN","XUMFH",68,0)
 S ALL=$S(WHO["ALL":1,1:0)
"RTN","XUMFH",69,0)
 S GROUP=$S(ALL:1,(WHO["IEN"):1,1:0)
"RTN","XUMFH",70,0)
 ;
"RTN","XUMFH",71,0)
 S:ARRAY TYPE=$S(GROUP:7,1:3)
"RTN","XUMFH",72,0)
 S:'ARRAY TYPE=$S(GROUP:5,1:1)
"RTN","XUMFH",73,0)
 S:HL("MTN")="MFR" TYPE=TYPE+10
"RTN","XUMFH",74,0)
 ;
"RTN","XUMFH",75,0)
 S IFN=+WHAT
"RTN","XUMFH",76,0)
 S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",77,0)
 S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",78,0)
 S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",79,0)
 S:$L(XREF)>1 PARAM("CDSYS")=XREF
"RTN","XUMFH",80,0)
 ;
"RTN","XUMFH",81,0)
 K:ARRAY ^TMP("XUMF ARRAY",$J)
"RTN","XUMFH",82,0)
 ;
"RTN","XUMFH",83,0)
 Q
"RTN","XUMFH",84,0)
 ;
"RTN","XUMFH",85,0)
MFI ; -- MFI segment
"RTN","XUMFH",86,0)
 ;
"RTN","XUMFH",87,0)
 Q:ERROR
"RTN","XUMFH",88,0)
 Q:$G(IFN)
"RTN","XUMFH",89,0)
 ;
"RTN","XUMFH",90,0)
 I $P(HLNODE,HLFS,2)="" D  Q
"RTN","XUMFH",91,0)
 .S ERROR="1^MFI segment missing Master File Identifier"
"RTN","XUMFH",92,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",93,0)
 S IFN=$$MFI^XUMFP($P(HLNODE,HLFS,2))
"RTN","XUMFH",94,0)
 I 'IFN D  Q
"RTN","XUMFH",95,0)
 .S ERROR="1^IFN in MFI could not be resolved"
"RTN","XUMFH",96,0)
 .D EM(ERROR,.ERR)
"RTN","XUMFH",97,0)
 ;
"RTN","XUMFH",98,0)
 Q
"RTN","XUMFH",99,0)
 ;
"RTN","XUMFH",100,0)
MFE ; -- MFE segment
"RTN","XUMFH",101,0)
 ;
"RTN","XUMFH",102,0)
 Q:ERROR
"RTN","XUMFH",103,0)
 ;Q:$G(IEN)
"RTN","XUMFH",104,0)
 ;
"RTN","XUMFH",105,0)
 S KEY=$P(HLNODE,HLFS,5) Q:ARRAY
"RTN","XUMFH",106,0)
 ;
"RTN","XUMFH",107,0)
 I $P(KEY,HLCS)="" D  Q
"RTN","XUMFH",108,0)
 .D EM("MFE segment NULL key "_$E(HLNODE,1,80),.ERR)
"RTN","XUMFH",109,0)
 .
"RTN","XUMFH",110,0)
 S XREF=$P(KEY,HLCS,3)
"RTN","XUMFH",111,0)
 S IEN=$$FIND1^DIC(IFN,,"BX",$P(KEY,HLCS),XREF,,"ERR")
"RTN","XUMFH",112,0)
 S IEN=$S(IEN:IEN,KEY["ALL":"ALL",$G(ERR)'="":"ERROR",1:"NEW")
"RTN","XUMFH",113,0)
 I IEN="ERROR" D  Q
"RTN","XUMFH",114,0)
 .D EM("MFE segment couldn't resolve IEN",.ERR)
"RTN","XUMFH",115,0)
 .K ERR
"RTN","XUMFH",116,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",117,0)
 ;
"RTN","XUMFH",118,0)
 Q
"RTN","XUMFH",119,0)
 ;
"RTN","XUMFH",120,0)
ZL7 ; -- Generic Master File
"RTN","XUMFH",121,0)
ZIN ; -- VHA Institution segment
"RTN","XUMFH",122,0)
ZFT ; -- VHA Facility Type segment
"RTN","XUMFH",123,0)
LOC ; -- Location Identification segment
"RTN","XUMFH",124,0)
ZZZ ; -- get [Z...] segment(s)
"RTN","XUMFH",125,0)
 ;
"RTN","XUMFH",126,0)
 Q:ERROR
"RTN","XUMFH",127,0)
 Q:IEN="ERROR"
"RTN","XUMFH",128,0)
 ;
"RTN","XUMFH",129,0)
 I $G(ARRAY) D ARRAY Q
"RTN","XUMFH",130,0)
 ;
"RTN","XUMFH",131,0)
 N FDA,IENS,FIELD,ERR,PRE,POST,XUMF,MULT,FDA1,SEQ,SEQ1,SEQ2,SEQ3
"RTN","XUMFH",132,0)
 ;
"RTN","XUMFH",133,0)
 S PRE=$G(^TMP("XUMF MFS",$J,"PARAM","PRE"))
"RTN","XUMFH",134,0)
 D:PRE'="" @(PRE)
"RTN","XUMFH",135,0)
 ;
"RTN","XUMFH",136,0)
 S XUMF=7
"RTN","XUMFH",137,0)
 ;
"RTN","XUMFH",138,0)
 S SEG=$P(HLNODE,HLFS)
"RTN","XUMFH",139,0)
 S IENS=$S(IEN:IEN,1:"+1")_","
"RTN","XUMFH",140,0)
 S SEQ=0
"RTN","XUMFH",141,0)
 F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFH",142,0)
 .S SEQ1=$P(SEQ,"."),SEQ2=$P(SEQ,".",2)
"RTN","XUMFH",143,0)
 .S SEQ3=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",0))
"RTN","XUMFH",144,0)
 .I SEQ3 D SUBCOMP Q
"RTN","XUMFH",145,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFH",146,0)
 .I FIELD=".01" D
"RTN","XUMFH",147,0)
 ..N FDA,IEN1
"RTN","XUMFH",148,0)
 ..S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",149,0)
 ..S VALUE=$$VALUE(.HLNODE,SEQ1)
"RTN","XUMFH",150,0)
 ..S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",151,0)
 ..S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",152,0)
 ..S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",153,0)
 ..D UPDATE^DIE("E","FDA","IEN1","ERR")
"RTN","XUMFH",154,0)
 ..I $D(ERR) D
"RTN","XUMFH",155,0)
 ...D EM("update DIE call error message in ZZZ",.ERR)
"RTN","XUMFH",156,0)
 ...K ERR
"RTN","XUMFH",157,0)
 ..I $D(IEN1) S IENS=IEN1(1)_","
"RTN","XUMFH",158,0)
 .I 'FIELD D SUBFILE Q
"RTN","XUMFH",159,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",160,0)
 .S VALUE=$$VALUE(.HLNODE,SEQ)
"RTN","XUMFH",161,0)
 .S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",162,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",163,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",164,0)
 ;
"RTN","XUMFH",165,0)
 M FDA=FDA1
"RTN","XUMFH",166,0)
 ;
"RTN","XUMFH",167,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMFH",168,0)
 I $D(ERR) D
"RTN","XUMFH",169,0)
 .D EM("file DIE call error message in ZZZ",.ERR)
"RTN","XUMFH",170,0)
 .K ERR
"RTN","XUMFH",171,0)
 ;
"RTN","XUMFH",172,0)
 S POST=$G(^TMP("XUMF MFS",$J,"PARAM","POST"))
"RTN","XUMFH",173,0)
 D:POST'="" @(POST)
"RTN","XUMFH",174,0)
 ;
"RTN","XUMFH",175,0)
 K IEN
"RTN","XUMFH",176,0)
 ;
"RTN","XUMFH",177,0)
 Q
"RTN","XUMFH",178,0)
 ;
"RTN","XUMFH",179,0)
SUBFILE ; -- process subfile record
"RTN","XUMFH",180,0)
 ;
"RTN","XUMFH",181,0)
 N IFN,IENS1,KEY1,FIELD,TYP,MKEY,ERR
"RTN","XUMFH",182,0)
 ;
"RTN","XUMFH",183,0)
 S IFN=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFH",184,0)
 S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFH",185,0)
 S TYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFH",186,0)
 S VALUE=$$VALUE(.HLNODE,SEQ)
"RTN","XUMFH",187,0)
 S:SEQ2 VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",188,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",189,0)
 ;
"RTN","XUMFH",190,0)
 S MULT=$G(^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",SEQ))
"RTN","XUMFH",191,0)
 S MKEY=$G(^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",SEQ))
"RTN","XUMFH",192,0)
 I MULT=SEQ Q:VALUE=""  D
"RTN","XUMFH",193,0)
 .N FDA,IEN
"RTN","XUMFH",194,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=VALUE
"RTN","XUMFH",195,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",196,0)
 .I $D(ERR) D
"RTN","XUMFH",197,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH",198,0)
 ..K ERR
"RTN","XUMFH",199,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",200,0)
 I 'MULT D
"RTN","XUMFH",201,0)
 .N FDA,IEN
"RTN","XUMFH",202,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=MKEY
"RTN","XUMFH",203,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",204,0)
 .I $D(ERR) D
"RTN","XUMFH",205,0)
 ..D EM("update DIE call error message in SUBFILE",.ERR)
"RTN","XUMFH",206,0)
 ..K ERR
"RTN","XUMFH",207,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",208,0)
 .S FDA1(IFN,IENS1,.01)=MKEY
"RTN","XUMFH",209,0)
 I MULT,MULT'=SEQ S IENS1=$G(MULT(+MULT)) Q:IENS1=""
"RTN","XUMFH",210,0)
 S FDA1(IFN,IENS1,FIELD)=VALUE
"RTN","XUMFH",211,0)
 ;
"RTN","XUMFH",212,0)
 Q
"RTN","XUMFH",213,0)
 ;
"RTN","XUMFH",214,0)
VALUE(HLNODE,SEQ) ; -- handle HL7 continuation nodes
"RTN","XUMFH",215,0)
 ;
"RTN","XUMFH",216,0)
 N I,X,Y,N,T,Z,NODE
"RTN","XUMFH",217,0)
 ;
"RTN","XUMFH",218,0)
 S SEQ=$P($G(SEQ),".") Q:'SEQ ""
"RTN","XUMFH",219,0)
 ;
"RTN","XUMFH",220,0)
 M Z=HLNODE
"RTN","XUMFH",221,0)
 S Z(0)=HLNODE
"RTN","XUMFH",222,0)
 ;
"RTN","XUMFH",223,0)
 S I=0
"RTN","XUMFH",224,0)
 F  S I=$O(Z(I)) Q:'I  D
"RTN","XUMFH",225,0)
 .Q:$E(Z(I),1)=HLFS
"RTN","XUMFH",226,0)
 .S X=$P(Z(I),HLFS)
"RTN","XUMFH",227,0)
 .S Y=$O(Z(I),-1)
"RTN","XUMFH",228,0)
 .S Z(Y)=Z(Y)_X
"RTN","XUMFH",229,0)
 .S:$L(Z(I),HLFS)'="" Z(I)=HLFS_$P(Z(I),HLFS,2,999)
"RTN","XUMFH",230,0)
 .K:$L(Z(I),HLFS)="" Z(I)
"RTN","XUMFH",231,0)
 ;
"RTN","XUMFH",232,0)
 S X=0
"RTN","XUMFH",233,0)
 F  S X=$O(Z(X)) Q:'X  D
"RTN","XUMFH",234,0)
 .S X(X)=$L(Z(X),HLFS)-1
"RTN","XUMFH",235,0)
 S X(0)=$L(Z,HLFS)-1
"RTN","XUMFH",236,0)
 ;
"RTN","XUMFH",237,0)
 S (X,N,T)=""
"RTN","XUMFH",238,0)
 F  S X=$O(X(X)) Q:X=""  D
"RTN","XUMFH",239,0)
 .S T=T+$P(X(X),U),N(T+1)=X
"RTN","XUMFH",240,0)
 ;
"RTN","XUMFH",241,0)
 S (X,Y)=""
"RTN","XUMFH",242,0)
 F  S X=$O(X(X)) Q:X=""  D
"RTN","XUMFH",243,0)
 .S $P(X(X),U,2)=Y
"RTN","XUMFH",244,0)
 .S Y=+X(X)+Y
"RTN","XUMFH",245,0)
 ;
"RTN","XUMFH",246,0)
 S NODE=$G(N(+$O(N(SEQ)))) Q:NODE="" ""
"RTN","XUMFH",247,0)
 ;
"RTN","XUMFH",248,0)
 Q $P(Z(NODE),HLFS,(SEQ-($P(X(NODE),U,2))+1))
"RTN","XUMFH",249,0)
 ;
"RTN","XUMFH",250,0)
SUBCOMP ; -- subcomponents
"RTN","XUMFH",251,0)
 ;
"RTN","XUMFH",252,0)
 S SEQ3=0
"RTN","XUMFH",253,0)
 F  S SEQ3=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3)) Q:'SEQ3  D
"RTN","XUMFH",254,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3,0))
"RTN","XUMFH",255,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",SEQ3,FIELD))
"RTN","XUMFH",256,0)
 .S VALUE=$$VALUE(.HLNODE,SEQ)
"RTN","XUMFH",257,0)
 .S VALUE=$P(VALUE,HLCS,SEQ2)
"RTN","XUMFH",258,0)
 .S VALUE=$P(VALUE,HLSCS,SEQ3)
"RTN","XUMFH",259,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLSCS,0)
"RTN","XUMFH",260,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",261,0)
 ;
"RTN","XUMFH",262,0)
 Q
"RTN","XUMFH",263,0)
 ;
"RTN","XUMFH",264,0)
ARRAY ; -- query data stored in array (not filed)
"RTN","XUMFH",265,0)
 ;
"RTN","XUMFH",266,0)
 I $P($G(KEY),HLCS)="" D  Q
"RTN","XUMFH",267,0)
 .D EM("Null KEY found in the following segment: "_$E(HLNODE,1,80),.ERR)
"RTN","XUMFH",268,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",269,0)
 ;
"RTN","XUMFH",270,0)
 M ^TMP("XUMF ARRAY",$J,$P(KEY,HLCS))=HLNODE
"RTN","XUMFH",271,0)
 ;
"RTN","XUMFH",272,0)
 Q
"RTN","XUMFH",273,0)
 ;
"RTN","XUMFH",274,0)
REPLY ; -- master file response
"RTN","XUMFH",275,0)
 ;
"RTN","XUMFH",276,0)
 Q:HL("MTN")="MFR"
"RTN","XUMFH",277,0)
 Q:HL("MTN")="MFK"
"RTN","XUMFH",278,0)
 ;
"RTN","XUMFH",279,0)
 S:(TYPE<10) TYPE=(TYPE+10)
"RTN","XUMFH",280,0)
 ;
"RTN","XUMFH",281,0)
 I HL("MTN")="MFQ" D
"RTN","XUMFH",282,0)
 .S IFN=+$G(WHAT) I 'IFN D  Q
"RTN","XUMFH",283,0)
 ..S ERROR="1^REPLY MFQ couldn't resolve IFN"
"RTN","XUMFH",284,0)
 ..D EM(ERROR,.ERR)
"RTN","XUMFH",285,0)
 .S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",286,0)
 .S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",287,0)
 .S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",288,0)
 ;
"RTN","XUMFH",289,0)
 S IFN=$G(IFN),IEN=$G(IEN)
"RTN","XUMFH",290,0)
 ;
"RTN","XUMFH",291,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",292,0)
 D MAIN^XUMFI(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",293,0)
 ;
"RTN","XUMFH",294,0)
 Q
"RTN","XUMFH",295,0)
 ;
"RTN","XUMFH",296,0)
EXIT ; -- cleanup, and quit
"RTN","XUMFH",297,0)
 ;
"RTN","XUMFH",298,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J),^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",299,0)
 ;
"RTN","XUMFH",300,0)
 Q
"RTN","XUMFH",301,0)
 ;
"RTN","XUMFH",302,0)
EM(ERROR,ERR,XMSUB,XMY) ; -- error message
"RTN","XUMFH",303,0)
 ;
"RTN","XUMFH",304,0)
 N X,XMTEXT,FLG
"RTN","XUMFH",305,0)
 ;
"RTN","XUMFH",306,0)
 S FLG=0
"RTN","XUMFH",307,0)
 ;
"RTN","XUMFH",308,0)
 D MSG^DIALOG("AM",.X,80,,"ERR")
"RTN","XUMFH",309,0)
 ;
"RTN","XUMFH",310,0)
 S X(.1)="HL7 message ID: "_$G(HL("MID"))
"RTN","XUMFH",311,0)
 S X(.2)="",X(.3)=$G(ERROR),X(.4)=""
"RTN","XUMFH",312,0)
 S:$G(XMSUB)="" XMSUB="MFS ERROR"
"RTN","XUMFH",313,0)
 S XMY("G.XUMF ERROR")=""
"RTN","XUMFH",314,0)
 S XMTEXT="X("
"RTN","XUMFH",315,0)
 ;
"RTN","XUMFH",316,0)
 S X=.9 F  S X=$O(X(X)) Q:'X  D
"RTN","XUMFH",317,0)
 .I X(X)="" K X(X) Q
"RTN","XUMFH",318,0)
 .I X(X)["DINUMed field cannot" S FLG=1 K X(X) Q
"RTN","XUMFH",319,0)
 .I X(X)["ASSOCIATION" S FLG=1 K X(X) Q
"RTN","XUMFH",320,0)
 .I X(X)["INSTITUTION" S FLG=1 K X(X) Q
"RTN","XUMFH",321,0)
 ;
"RTN","XUMFH",322,0)
 I FLG Q:'$O(X(.9))
"RTN","XUMFH",323,0)
 ;
"RTN","XUMFH",324,0)
 D ^XMD
"RTN","XUMFH",325,0)
 ;
"RTN","XUMFH",326,0)
 Q
"RTN","XUMFH",327,0)
 ;
"RTN","XUMFI")
0^8^B79802513
"RTN","XUMFI",1,0)
XUMFI ;CIOFO-SF/RAM - Master File Interface ;06/28/00
"RTN","XUMFI",2,0)
 ;;8.0;KERNEL;**206,217,218,335**;Jul 10, 1995
"RTN","XUMFI",3,0)
 ;
"RTN","XUMFI",4,0)
 ; This routine is the Master File Server HL7 message builder API.
"RTN","XUMFI",5,0)
 ; The routine will generate messages for both trigger events and
"RTN","XUMFI",6,0)
 ; queries.
"RTN","XUMFI",7,0)
 ;
"RTN","XUMFI",8,0)
 ; Use the routine XUMFP to initialize the PARAM array.
"RTN","XUMFI",9,0)
 ; See XUMFP for a full description of the parameters.
"RTN","XUMFI",10,0)
 ;
"RTN","XUMFI",11,0)
 ; use of $O(^HLCS(870,"C",institution_ptr)) supported by IA# 3550
"RTN","XUMFI",12,0)
 ;
"RTN","XUMFI",13,0)
MAIN(IFN,IEN,TYPE,PARAM,ERROR) ;  -- entry point
"RTN","XUMFI",14,0)
 ;
"RTN","XUMFI",15,0)
 ;
"RTN","XUMFI",16,0)
 N HLFS,HLCS,HLRESLT,QUERY,UPDATE,ALL,CNT,ROOT,PROTOCOL,MFR,MFQ,MTYP,I
"RTN","XUMFI",17,0)
 N ARRAY,GROUP,MFK,CDSYS,J,HLSCS
"RTN","XUMFI",18,0)
 ;
"RTN","XUMFI",19,0)
 M ^TMP("XUMF MFS",$J,"PARAM")=PARAM K PARAM
"RTN","XUMFI",20,0)
 ;
"RTN","XUMFI",21,0)
 D INIT,BUILD,LLNK,SEND,EXIT
"RTN","XUMFI",22,0)
 ;
"RTN","XUMFI",23,0)
 ;
"RTN","XUMFI",24,0)
 Q
"RTN","XUMFI",25,0)
 ;
"RTN","XUMFI",26,0)
INIT ; -- initialize
"RTN","XUMFI",27,0)
 ;
"RTN","XUMFI",28,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFI",29,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFI",30,0)
 ;
"RTN","XUMFI",31,0)
 S IEN=$G(IEN),IFN=$G(IFN)
"RTN","XUMFI",32,0)
 S TYPE=$G(TYPE),ERROR=$G(ERROR),CNT=1
"RTN","XUMFI",33,0)
 S UPDATE=$S(TYPE#2:0,1:1)
"RTN","XUMFI",34,0)
 S QUERY='UPDATE
"RTN","XUMFI",35,0)
 S GROUP=$S(UPDATE:0,TYPE[5:1,TYPE[7:1,1:0)
"RTN","XUMFI",36,0)
 S ARRAY=$S(UPDATE:0,TYPE[3:1,TYPE[7:1,1:0)
"RTN","XUMFI",37,0)
 S ALL=$S(IEN["ALL":1,1:0)
"RTN","XUMFI",38,0)
 S PROTOCOL=$G(^TMP("XUMF MFS",$J,"PARAM","PROTOCOL"))
"RTN","XUMFI",39,0)
 S MFR=$S(UPDATE:0,TYPE>10:1,1:0)
"RTN","XUMFI",40,0)
 S MFQ=$S(UPDATE:0,'MFR:1,1:0)
"RTN","XUMFI",41,0)
 S MFK=$S(TYPE=10:1,1:0)
"RTN","XUMFI",42,0)
 S MTYP=$S(MFR:"HLA",MFK:"HLA",1:"HLS")
"RTN","XUMFI",43,0)
 ;
"RTN","XUMFI",44,0)
 ; -- get variables from HL7 package
"RTN","XUMFI",45,0)
 I $O(HL(""))="" D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFI",46,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,"^",2) Q
"RTN","XUMFI",47,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH")),HLSCS=$E(HL("ECH"),4)
"RTN","XUMFI",48,0)
 ;
"RTN","XUMFI",49,0)
 Q:ERROR
"RTN","XUMFI",50,0)
 ;
"RTN","XUMFI",51,0)
 ; -- check parameters
"RTN","XUMFI",52,0)
 I 'QUERY,'UPDATE S ERROR="1^invalid message type" Q
"RTN","XUMFI",53,0)
 I 'IFN S ERROR="1^invalid file number" Q
"RTN","XUMFI",54,0)
 I 'IEN,'ALL,'MFK S ERROR="1^invalid IEN" Q
"RTN","XUMFI",55,0)
 I '$$VFILE^DILFD(IFN) S ERROR="1^invalid file number" Q
"RTN","XUMFI",56,0)
 I UPDATE,'IEN S ERROR="1^update message requires an IEN" Q
"RTN","XUMFI",57,0)
 ;
"RTN","XUMFI",58,0)
 ; -- get root of file
"RTN","XUMFI",59,0)
 S ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFI",60,0)
 ;
"RTN","XUMFI",61,0)
 ; -- if IEN array input, merge with param
"RTN","XUMFI",62,0)
 I 'ALL,'IEN,$O(IEN(0)) M ^TMP("XUMF MFS",$J,"PARAM","IEN")=IEN
"RTN","XUMFI",63,0)
 ;
"RTN","XUMFI",64,0)
 ; -- if CDSYS and ALL get entries
"RTN","XUMFI",65,0)
 S CDSYS=$G(^TMP("XUMF MFS",$J,"PARAM","CDSYS"))
"RTN","XUMFI",66,0)
 I ALL,CDSYS'="" D
"RTN","XUMFI",67,0)
 .S I=0 F  S I=$O(@ROOT@("A XUMF ID",CDSYS,I)) Q:'I  D
"RTN","XUMFI",68,0)
 ..S J=$O(@ROOT@("A XUMF ID",CDSYS,I,0))
"RTN","XUMFI",69,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",J)=""
"RTN","XUMFI",70,0)
 ;
"RTN","XUMFI",71,0)
 ; -- get ALL file 'national' entries
"RTN","XUMFI",72,0)
 I ALL,'$D(^TMP("XUMF MFS",$J,"PARAM","IEN")) D
"RTN","XUMFI",73,0)
 .S I=0 F  S I=$O(@ROOT@("XUMF","N",I)) Q:'I  D
"RTN","XUMFI",74,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IEN",I)=""
"RTN","XUMFI",75,0)
 ;
"RTN","XUMFI",76,0)
 Q
"RTN","XUMFI",77,0)
 ;
"RTN","XUMFI",78,0)
BUILD ; -- build message
"RTN","XUMFI",79,0)
 ;
"RTN","XUMFI",80,0)
 I MFK D MFK Q
"RTN","XUMFI",81,0)
 ;
"RTN","XUMFI",82,0)
 Q:ERROR
"RTN","XUMFI",83,0)
 ;
"RTN","XUMFI",84,0)
 N ID,APP,EVENT,ENDT,EFFDT,RESP,MFI,MFN,EDT,CODE,MFE
"RTN","XUMFI",85,0)
 ;
"RTN","XUMFI",86,0)
 I QUERY D QRD Q:MFQ
"RTN","XUMFI",87,0)
 ;
"RTN","XUMFI",88,0)
 D MFI
"RTN","XUMFI",89,0)
 ;
"RTN","XUMFI",90,0)
 I GROUP D GROUP Q
"RTN","XUMFI",91,0)
 ;
"RTN","XUMFI",92,0)
 D MFE,ZZZ
"RTN","XUMFI",93,0)
 ;
"RTN","XUMFI",94,0)
 Q
"RTN","XUMFI",95,0)
 ;
"RTN","XUMFI",96,0)
MFK ; -- master file acknowledgement
"RTN","XUMFI",97,0)
 ;
"RTN","XUMFI",98,0)
 N X
"RTN","XUMFI",99,0)
 S X="MSA"_HLFS_$S(ERROR:"AE",1:"AA")_HLFS_HL("MID")_HLFS_$P(ERROR,U,2)
"RTN","XUMFI",100,0)
 S ^TMP(MTYP,$J,CNT)=X
"RTN","XUMFI",101,0)
 S CNT=CNT+1
"RTN","XUMFI",102,0)
 ;
"RTN","XUMFI",103,0)
 Q
"RTN","XUMFI",104,0)
 ;
"RTN","XUMFI",105,0)
QRD ; -- query definition segment
"RTN","XUMFI",106,0)
 ;
"RTN","XUMFI",107,0)
 I TYPE>10 D
"RTN","XUMFI",108,0)
 .S ^TMP(MTYP,$J,CNT)="MSA"_HLFS_$S(ERROR:"AE",1:"AA")_HLFS_HL("MID")
"RTN","XUMFI",109,0)
 .S CNT=CNT+1
"RTN","XUMFI",110,0)
 ;
"RTN","XUMFI",111,0)
 Q:ERROR
"RTN","XUMFI",112,0)
 ;
"RTN","XUMFI",113,0)
 N QDT,QFC,QP,QID,ZDRT,ZDRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL,QRD
"RTN","XUMFI",114,0)
 ;
"RTN","XUMFI",115,0)
 S QDT=$G(^TMP("XUMF MFS",$J,"PARAM","QDT"))
"RTN","XUMFI",116,0)
 S QFC=$G(^TMP("XUMF MFS",$J,"PARAM","QFC"))
"RTN","XUMFI",117,0)
 S QP=$G(^TMP("XUMF MFS",$J,"PARAM","QP"))
"RTN","XUMFI",118,0)
 S QID=$G(^TMP("XUMF MFS",$J,"PARAM","QID"))
"RTN","XUMFI",119,0)
 S ZDRT=$G(^TMP("XUMF MFS",$J,"PARAM","DRT"))
"RTN","XUMFI",120,0)
 S ZDRDT=$G(^TMP("XUMF MFS",$J,"PARAM","DRDT"))
"RTN","XUMFI",121,0)
 S QLR=$G(^TMP("XUMF MFS",$J,"PARAM","QLR"))
"RTN","XUMFI",122,0)
 S WHO=$G(^TMP("XUMF MFS",$J,"PARAM","WHO"))
"RTN","XUMFI",123,0)
 S WHAT=$G(^TMP("XUMF MFS",$J,"PARAM","WHAT"))
"RTN","XUMFI",124,0)
 S WDDC=$G(^TMP("XUMF MFS",$J,"PARAM","WDDC"))
"RTN","XUMFI",125,0)
 S WDCVQ=$G(^TMP("XUMF MFS",$J,"PARAM","WDCVQ"))
"RTN","XUMFI",126,0)
 S QRL=$G(^TMP("XUMF MFS",$J,"PARAM","QRL"))
"RTN","XUMFI",127,0)
 S QRD="QRD"_HLFS_QDT_HLFS_QFC_HLFS_QP_HLFS_QID_HLFS_ZDRT_HLFS_ZDRDT
"RTN","XUMFI",128,0)
 S QRD=QRD_HLFS_QLR_HLFS_WHO_HLFS_WHAT_HLFS_WDDC_HLFS_WDCVQ_HLFS_QRL
"RTN","XUMFI",129,0)
 S ^TMP(MTYP,$J,CNT)=QRD
"RTN","XUMFI",130,0)
 S CNT=CNT+1
"RTN","XUMFI",131,0)
 ;
"RTN","XUMFI",132,0)
 Q
"RTN","XUMFI",133,0)
 ;
"RTN","XUMFI",134,0)
MFI ; master file identifier segment
"RTN","XUMFI",135,0)
 ;
"RTN","XUMFI",136,0)
 Q:ERROR
"RTN","XUMFI",137,0)
 ;
"RTN","XUMFI",138,0)
 N ID,APP,EVENT,ENDT,EFFDT,RESP,MFI
"RTN","XUMFI",139,0)
 ;
"RTN","XUMFI",140,0)
 S ID=$G(^TMP("XUMF MFS",$J,"PARAM","MFI"))
"RTN","XUMFI",141,0)
 S APP=$G(^TMP("XUMF MFS",$J,"PARAM","MFAI"))
"RTN","XUMFI",142,0)
 S EVENT=$G(^TMP("XUMF MFS",$J,"PARAM","FLEV"))
"RTN","XUMFI",143,0)
 S ENDT=$G(^TMP("XUMF MFS",$J,"PARAM","ENDT"))
"RTN","XUMFI",144,0)
 S EFFDT=$G(^TMP("XUMF MFS",$J,"PARAM","MFIEDT"))
"RTN","XUMFI",145,0)
 S RESP=$G(^TMP("XUMF MFS",$J,"PARAM","RLC"))
"RTN","XUMFI",146,0)
 S:APP="" APP="MFS" S:EVENT="" EVENT="REP" S:RESP="" RESP="NE"
"RTN","XUMFI",147,0)
 S:ENDT="" ENDT=$$NOW^XLFDT S:EFFDT="" EFFDT=$$NOW^XLFDT
"RTN","XUMFI",148,0)
 S MFI=$$MFI^XUMFMFI(ID,APP,EVENT,ENDT,EFFDT,RESP)
"RTN","XUMFI",149,0)
 I $E(MFI)="-" S ERROR=MFI Q
"RTN","XUMFI",150,0)
 S ^TMP(MTYP,$J,CNT)=MFI
"RTN","XUMFI",151,0)
 S CNT=CNT+1
"RTN","XUMFI",152,0)
 ;
"RTN","XUMFI",153,0)
 Q
"RTN","XUMFI",154,0)
 ;
"RTN","XUMFI",155,0)
MFE ; master file entry segment
"RTN","XUMFI",156,0)
 ;
"RTN","XUMFI",157,0)
 Q:ERROR
"RTN","XUMFI",158,0)
 ;
"RTN","XUMFI",159,0)
 N EVENT,MFN,EDT,CODE,MFE
"RTN","XUMFI",160,0)
 ;
"RTN","XUMFI",161,0)
 S EVENT=$G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))
"RTN","XUMFI",162,0)
 S MFN=$G(^TMP("XUMF MFS",$J,"PARAM","MFNCID"))
"RTN","XUMFI",163,0)
 S EDT=$G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))
"RTN","XUMFI",164,0)
 S CODE=$G(^TMP("XUMF MFS",$J,"PARAM","PKV"))
"RTN","XUMFI",165,0)
 S:EDT="" EDT=$$NOW^XLFDT S:EVENT="" EVENT="MAD"
"RTN","XUMFI",166,0)
 S MFE=$$MFE^XUMFMFE(EVENT,MFN,EDT,CODE)
"RTN","XUMFI",167,0)
 I $E(MFE)="-" S ERROR=MFE Q
"RTN","XUMFI",168,0)
 S ^TMP(MTYP,$J,CNT)=MFE
"RTN","XUMFI",169,0)
 S CNT=CNT+1
"RTN","XUMFI",170,0)
 ;
"RTN","XUMFI",171,0)
 Q
"RTN","XUMFI",172,0)
 ;
"RTN","XUMFI",173,0)
ZZZ ; [Z...] segment
"RTN","XUMFI",174,0)
 ;
"RTN","XUMFI",175,0)
 Q:ERROR
"RTN","XUMFI",176,0)
 ;
"RTN","XUMFI",177,0)
 N SEG,SEQ,ZZZ,FLD,FILE,IENS,VALUE,ERR,ZDTYP,FIELD,SEQ1,SEQ2,SEQ3
"RTN","XUMFI",178,0)
 N SEQ0,SEQ9,CNT1,CNT2,NODE,XXX
"RTN","XUMFI",179,0)
 ;
"RTN","XUMFI",180,0)
 S SEG="",SEQ=0
"RTN","XUMFI",181,0)
 F  S SEG=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG)) Q:SEG=""  D
"RTN","XUMFI",182,0)
 .S ZZZ=SEG
"RTN","XUMFI",183,0)
 .F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFI",184,0)
 ..;
"RTN","XUMFI",185,0)
 ..S SEQ1=$P(SEQ,"."),SEQ2=$P(SEQ,".",2)
"RTN","XUMFI",186,0)
 ..S SEQ3=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS",0))
"RTN","XUMFI",187,0)
 ..;
"RTN","XUMFI",188,0)
 ..I SEQ3 D SUBCOMP Q
"RTN","XUMFI",189,0)
 ..;
"RTN","XUMFI",190,0)
 ..S FLD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFI",191,0)
 ..;
"RTN","XUMFI",192,0)
 ..I 'FLD D
"RTN","XUMFI",193,0)
 ...S FILE=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFI",194,0)
 ...S IENS=$G(^TMP("XUMF MFS",$J,"PARAM","IENS",SEG,SEQ))
"RTN","XUMFI",195,0)
 ...S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFI",196,0)
 ...S ZDTYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFI",197,0)
 ...I $P(ZDTYP,U,3)[":" S FIELD=FIELD_$P(ZDTYP,U,3)
"RTN","XUMFI",198,0)
 ...S VALUE=$$GET1^DIQ(FILE,IENS,FIELD)
"RTN","XUMFI",199,0)
 ...S VALUE=$$DTYP^XUMFP(VALUE,ZDTYP,HLCS,1)
"RTN","XUMFI",200,0)
 ..I FLD D
"RTN","XUMFI",201,0)
 ...S ZDTYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FLD))
"RTN","XUMFI",202,0)
 ...I $P(ZDTYP,U,3)[":" S FLD=FLD_$P(ZDTYP,U,3)
"RTN","XUMFI",203,0)
 ...S VALUE=$$GET1^DIQ(IFN,IEN_",",FLD)
"RTN","XUMFI",204,0)
 ...S VALUE=$$DTYP^XUMFP(VALUE,ZDTYP,HLCS,1)
"RTN","XUMFI",205,0)
 ..;
"RTN","XUMFI",206,0)
 ..S ZZZ(SEQ)=VALUE
"RTN","XUMFI",207,0)
 .;
"RTN","XUMFI",208,0)
 .S X=0
"RTN","XUMFI",209,0)
 .F  S X=$O(ZZZ(X)) Q:'X  D
"RTN","XUMFI",210,0)
 ..S SEQ1=$P(X,"."),SEQ2=+$P(X,".",2)
"RTN","XUMFI",211,0)
 ..S XXX(SEQ1,SEQ2)=ZZZ(X)
"RTN","XUMFI",212,0)
 .K ZZZ
"RTN","XUMFI",213,0)
 .M ZZZ=XXX
"RTN","XUMFI",214,0)
 .;
"RTN","XUMFI",215,0)
 .K NODE
"RTN","XUMFI",216,0)
 .S (SEQ,SEQ0,SEQ9,SEQ1,CNT1,CNT2)=0,NODE=""
"RTN","XUMFI",217,0)
 .F  S SEQ1=$O(ZZZ(SEQ1)) Q:'SEQ1  D
"RTN","XUMFI",218,0)
 ..S SEQ2=0,VALUE=$G(ZZZ(SEQ1,SEQ2))
"RTN","XUMFI",219,0)
 ..F  S SEQ2=$O(ZZZ(SEQ1,SEQ2)) Q:'SEQ2  D
"RTN","XUMFI",220,0)
 ...S $P(VALUE,HLCS,SEQ2)=ZZZ(SEQ1,SEQ2)
"RTN","XUMFI",221,0)
 ..S NODE(CNT1)=$G(NODE(CNT1))
"RTN","XUMFI",222,0)
 ..I NODE(CNT1)'="",$L(NODE(CNT1)_VALUE)>200 D
"RTN","XUMFI",223,0)
 ...S CNT1=CNT1+1,SEQ9=SEQ0+SEQ9
"RTN","XUMFI",224,0)
 ..S SEQ=$S('CNT1:SEQ1,1:SEQ1-SEQ9)
"RTN","XUMFI",225,0)
 ..S $P(NODE(CNT1),HLFS,SEQ)=VALUE
"RTN","XUMFI",226,0)
 ..S SEQ0=SEQ-1
"RTN","XUMFI",227,0)
 .;
"RTN","XUMFI",228,0)
 .S NODE=SEG_HLFS_$G(NODE(0)) K NODE(0)
"RTN","XUMFI",229,0)
 .;
"RTN","XUMFI",230,0)
 .M ^TMP(MTYP,$J,CNT)=NODE
"RTN","XUMFI",231,0)
 .S CNT=CNT+1
"RTN","XUMFI",232,0)
 ;
"RTN","XUMFI",233,0)
 Q
"RTN","XUMFI",234,0)
 ;
"RTN","XUMFI",235,0)
SUBCOMP ; -- subcomponents
"RTN","XUMFI",236,0)
 ;
"RTN","XUMFI",237,0)
 N A,YYY
"RTN","XUMFI",238,0)
 ;
"RTN","XUMFI",239,0)
 M A=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"HLSCS")
"RTN","XUMFI",240,0)
 S YYY=""
"RTN","XUMFI",241,0)
 ;
"RTN","XUMFI",242,0)
 S SEQ3=0
"RTN","XUMFI",243,0)
 F  S SEQ3=$O(A(SEQ3)) Q:'SEQ3  D
"RTN","XUMFI",244,0)
 .S FLD=$O(A(SEQ3,0))
"RTN","XUMFI",245,0)
 .S ZDTYP=$G(A(SEQ3,FLD))
"RTN","XUMFI",246,0)
 .I $P(ZDTYP,U,3)[":" S FLD=FLD_$P(ZDTYP,U,3)
"RTN","XUMFI",247,0)
 .S VALUE=$$GET1^DIQ(IFN,IEN_",",FLD)
"RTN","XUMFI",248,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,ZDTYP,HLSCS,1)
"RTN","XUMFI",249,0)
 .S $P(YYY,HLSCS,SEQ3)=VALUE
"RTN","XUMFI",250,0)
 ;
"RTN","XUMFI",251,0)
 S ZZZ(SEQ)=YYY
"RTN","XUMFI",252,0)
 ;
"RTN","XUMFI",253,0)
 Q
"RTN","XUMFI",254,0)
 ;
"RTN","XUMFI",255,0)
GROUP ; -- query group records
"RTN","XUMFI",256,0)
 ;
"RTN","XUMFI",257,0)
 Q:ERROR
"RTN","XUMFI",258,0)
 ;
"RTN","XUMFI",259,0)
 S IEN=0
"RTN","XUMFI",260,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)) Q:'IEN  D
"RTN","XUMFI",261,0)
 .K ^TMP("XUMF MFS",$J,"PARAM","PKV")
"RTN","XUMFI",262,0)
 .K ^TMP("XUMF MFS",$J,"PARAM","IENS")
"RTN","XUMFI",263,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")
"RTN","XUMFI",264,0)
 .M ^TMP("XUMF MFS",$J,"PARAM","IENS")=^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS")
"RTN","XUMFI",265,0)
 .D MFE,ZZZ
"RTN","XUMFI",266,0)
 ;
"RTN","XUMFI",267,0)
 Q
"RTN","XUMFI",268,0)
 ;
"RTN","XUMFI",269,0)
SEND ; -- send HL7 message
"RTN","XUMFI",270,0)
 ;
"RTN","XUMFI",271,0)
 I 'MFK,ERROR Q
"RTN","XUMFI",272,0)
 ;
"RTN","XUMFI",273,0)
 S HLP("PRIORITY")="I"
"RTN","XUMFI",274,0)
 ;
"RTN","XUMFI",275,0)
 I 'TYPE D GENERATE^HLMA(PROTOCOL,"GM",1,.HLRESLT,"",.HLP)
"RTN","XUMFI",276,0)
 I TYPE,(TYPE<10) D DIRECT^HLMA(PROTOCOL,"GM",1,.HLRESLT,"",.HLP)
"RTN","XUMFI",277,0)
 I (TYPE>9),$G(HLMTIENS) D
"RTN","XUMFI",278,0)
 .D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"GM",1,.HLRESLT)
"RTN","XUMFI",279,0)
 ;
"RTN","XUMFI",280,0)
 ; check for error
"RTN","XUMFI",281,0)
 I ($P($G(HLRESLT),U,3)'="") D  Q
"RTN","XUMFI",282,0)
 .S ERROR=1_U_$P(HLRESLT,HLFS,3)_U_$P(HLRESLT,HLFS,2)_U_$P(HLRESLT,U)
"RTN","XUMFI",283,0)
 ;
"RTN","XUMFI",284,0)
 ; successful call, message ID returned
"RTN","XUMFI",285,0)
 S ERROR="0^"_$P($G(HLRESLT),U,1)
"RTN","XUMFI",286,0)
 ;
"RTN","XUMFI",287,0)
 Q
"RTN","XUMFI",288,0)
 ;
"RTN","XUMFI",289,0)
EXIT ; -- exit
"RTN","XUMFI",290,0)
 ;
"RTN","XUMFI",291,0)
 D CLEAN^DILF
"RTN","XUMFI",292,0)
 ;
"RTN","XUMFI",293,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFI",294,0)
 K ^TMP("XUMF MFS",$J)
"RTN","XUMFI",295,0)
 ;
"RTN","XUMFI",296,0)
 Q
"RTN","XUMFI",297,0)
 ;
"RTN","XUMFI",298,0)
LLNK ; -- dynamic addressing BROADCAST
"RTN","XUMFI",299,0)
 ;
"RTN","XUMFI",300,0)
 Q:TYPE>9
"RTN","XUMFI",301,0)
 ;
"RTN","XUMFI",302,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","LLNK"))'="" D  Q
"RTN","XUMFI",303,0)
 .S HLL("LINKS",1)=^TMP("XUMF MFS",$J,"PARAM","LLNK")
"RTN","XUMFI",304,0)
 ;
"RTN","XUMFI",305,0)
 Q:'$$SERVER()
"RTN","XUMFI",306,0)
 ;
"RTN","XUMFI",307,0)
 Q:TYPE
"RTN","XUMFI",308,0)
 Q:'$G(^TMP("XUMF MFS",$J,"PARAM","BROADCAST"))
"RTN","XUMFI",309,0)
 ;
"RTN","XUMFI",310,0)
 N I,J,LLNK
"RTN","XUMFI",311,0)
 ;
"RTN","XUMFI",312,0)
 S (I,J)=0
"RTN","XUMFI",313,0)
 F  S I=$O(^HLCS(870,"C",I)) Q:'I  D
"RTN","XUMFI",314,0)
 .S J=$O(^HLCS(870,"C",I,0)) Q:'J
"RTN","XUMFI",315,0)
 .S LLNK=$P($G(^HLCS(870,J,0)),U)
"RTN","XUMFI",316,0)
 .S HLL("LINKS",I)="XUMF MFK^"_LLNK
"RTN","XUMFI",317,0)
 ;
"RTN","XUMFI",318,0)
 Q
"RTN","XUMFI",319,0)
 ;
"RTN","XUMFI",320,0)
SERVER() ; -- servers
"RTN","XUMFI",321,0)
 ;
"RTN","XUMFI",322,0)
 N I
"RTN","XUMFI",323,0)
 ;
"RTN","XUMFI",324,0)
 S I=$$KSP^XUPARAM("INST") Q:'I 0
"RTN","XUMFI",325,0)
 ;
"RTN","XUMFI",326,0)
 Q:I=442 1  ;BP TEST
"RTN","XUMFI",327,0)
 Q:I=12000 1  ;FORUM
"RTN","XUMFI",328,0)
 Q:I=100002 1  ;HEC
"RTN","XUMFI",329,0)
 ;
"RTN","XUMFI",330,0)
 Q 0
"RTN","XUMFI",331,0)
 ;
"RTN","XUMFP4")
0^5^B33777925
"RTN","XUMFP4",1,0)
XUMFP4 ;CIOFO-SF/RAM - Master File C/S Params INSTITUTION ;06/28/00
"RTN","XUMFP4",2,0)
 ;;8.0;KERNEL;**206,217,294,335**;Jul 10, 1995
"RTN","XUMFP4",3,0)
 ;
"RTN","XUMFP4",4,0)
 ;
"RTN","XUMFP4",5,0)
 ; This routine sets up the parameters required by the INSTITUTION (#4)
"RTN","XUMFP4",6,0)
 ; file for the Master File server mechanism.
"RTN","XUMFP4",7,0)
 ;
"RTN","XUMFP4",8,0)
 ;  ** This routine is not a supported interface -- use XUMFP **
"RTN","XUMFP4",9,0)
 ;
"RTN","XUMFP4",10,0)
 ;  See XUMFP for parameter list documentation
"RTN","XUMFP4",11,0)
 ;
"RTN","XUMFP4",12,0)
 N PKV,HLFS,HLCS,RT,RF
"RTN","XUMFP4",13,0)
 ;
"RTN","XUMFP4",14,0)
 S ^TMP("XUMF MFS",$J,"PARAM","PRE")="PRE^XUMFP4C"
"RTN","XUMFP4",15,0)
 S ^TMP("XUMF MFS",$J,"PARAM","POST")="POST^XUMFP4C"
"RTN","XUMFP4",16,0)
 ;S ^TMP("XUMF MFS",$J,"PARAM","PRE")="PRE^XUMFR"
"RTN","XUMFP4",17,0)
 ;S ^TMP("XUMF MFS",$J,"PARAM","POST")="POST^XUMFR"
"RTN","XUMFP4",18,0)
 ;
"RTN","XUMFP4",19,0)
 I $O(HL(""))="" D
"RTN","XUMFP4",20,0)
 .I 'PROTOCOL D
"RTN","XUMFP4",21,0)
 ..S:UPDATE PROTOCOL=$O(^ORD(101,"B","XUMF MFN",0))
"RTN","XUMFP4",22,0)
 ..S:QUERY PROTOCOL=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMFP4",23,0)
 .S:'PROTOCOL ERROR="1^invalid protocol" Q:ERROR
"RTN","XUMFP4",24,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PROTOCOL")=PROTOCOL
"RTN","XUMFP4",25,0)
 .D INIT^HLFNC2(PROTOCOL,.HL)
"RTN","XUMFP4",26,0)
 ;
"RTN","XUMFP4",27,0)
 I $O(HL(""))="" S ERROR="1^"_$P(HL,U,2) Q
"RTN","XUMFP4",28,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFP4",29,0)
 ;
"RTN","XUMFP4",30,0)
 I QUERY D QRD^XUMFP4C
"RTN","XUMFP4",31,0)
 ;
"RTN","XUMFP4",32,0)
 ; MFI -- Master File Identification Segment
"RTN","XUMFP4",33,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFI")="Z04"  ;Master File Identifier
"RTN","XUMFP4",34,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFAI")=""  ;Application Identifier
"RTN","XUMFP4",35,0)
 S ^TMP("XUMF MFS",$J,"PARAM","FLEC")="UPD"  ;File-Level Event Code
"RTN","XUMFP4",36,0)
 S ^TMP("XUMF MFS",$J,"PARAM","ENDT")=""  ;Entered Data/Time
"RTN","XUMFP4",37,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFIEDT")=""  ;Effective Date/Time
"RTN","XUMFP4",38,0)
 S ^TMP("XUMF MFS",$J,"PARAM","RLC")="NE"  ;Response Level Code
"RTN","XUMFP4",39,0)
 ;
"RTN","XUMFP4",40,0)
 ; MFE -- Master File Entry
"RTN","XUMFP4",41,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","RLEC"))="" D  ;Record-Level Event Code
"RTN","XUMFP4",42,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","RLEC")="MUP"
"RTN","XUMFP4",43,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MFNCID")=""  ;MFN Control ID
"RTN","XUMFP4",44,0)
 I $G(^TMP("XUMF MFS",$J,"PARAM","MFEEDT"))="" D  ;Effective Date/Time
"RTN","XUMFP4",45,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","MFEEDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFP4",46,0)
 ;
"RTN","XUMFP4",47,0)
SEG ; -- ZIN segment
"RTN","XUMFP4",48,0)
 ;
"RTN","XUMFP4",49,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",8)=""
"RTN","XUMFP4",50,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",8)="VISN"
"RTN","XUMFP4",51,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",9)=""
"RTN","XUMFP4",52,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",9)="PARENT FACILITY"
"RTN","XUMFP4",53,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",10)=10
"RTN","XUMFP4",54,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",11)=10
"RTN","XUMFP4",55,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",12)=12
"RTN","XUMFP4",56,0)
 S ^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",13)=12
"RTN","XUMFP4",57,0)
 ;
"RTN","XUMFP4",58,0)
 I IEN D
"RTN","XUMFP4",59,0)
 .I $G(^DIC(4,IEN,99)) D
"RTN","XUMFP4",60,0)
 ..S PKV=$P(^DIC(4,IEN,99),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4",61,0)
 .;S PKV=$P($G(^DIC(4,+IEN,99)),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4",62,0)
 .I CDSYS'="" D
"RTN","XUMFP4",63,0)
 ..S $P(PKV,HLCS,2)=$P($G(^DIC(4,+IEN,0)),U),$P(PKV,HLCS,3)=CDSYS
"RTN","XUMFP4",64,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFP4",65,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",8)="1,"_IEN_","
"RTN","XUMFP4",66,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.014,"1,"_IEN_",")="VISN"
"RTN","XUMFP4",67,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",9)="2,"_IEN_","
"RTN","XUMFP4",68,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.014,"2,"_IEN_",")="PARENT FACILITY"
"RTN","XUMFP4",69,0)
 .S RF=$$RF^XUAF4(IEN) D:RF
"RTN","XUMFP4",70,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",10)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4",71,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",11)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4",72,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.999,$P(RF,U,3)_","_IEN_",")=$P(RF,U,3)
"RTN","XUMFP4",73,0)
 .S RT=$$RT^XUAF4(IEN) D:RT
"RTN","XUMFP4",74,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",12)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4",75,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","IENS","ZIN",13)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4",76,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM","KEY","ZIN",4.999,$P(RT,U,3)_","_IEN_",")=$P(RT,U,3)
"RTN","XUMFP4",77,0)
 ;
"RTN","XUMFP4",78,0)
 I NEW D
"RTN","XUMFP4",79,0)
 .S PKV="NEW"_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4",80,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","PKV")=PKV  ; Primary Key Value
"RTN","XUMFP4",81,0)
 ;
"RTN","XUMFP4",82,0)
 ; ZIN -- VA Specific VHA Institution Segment sequence
"RTN","XUMFP4",83,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEGMENT")="ZIN"
"RTN","XUMFP4",84,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",1,.01)="ST"
"RTN","XUMFP4",85,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",2,99)="ST"
"RTN","XUMFP4",86,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",3,11)="ID"
"RTN","XUMFP4",87,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",4,13)="CE^~FACILITY TYPE~VA"
"RTN","XUMFP4",88,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",5,100)="ST"
"RTN","XUMFP4",89,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",6,101)="ST"
"RTN","XUMFP4",90,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",7,.02)="ST"
"RTN","XUMFP4",91,0)
 ; associations -- VISN
"RTN","XUMFP4",92,0)
 I '$P($G(^DIC(4,+IEN,99)),U,4) D
"RTN","XUMFP4",93,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"FILE")=4.014
"RTN","XUMFP4",94,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"FIELD")=1
"RTN","XUMFP4",95,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",8,"DTYP")="CE^~VISN~VA"
"RTN","XUMFP4",96,0)
 .; associations -- parent
"RTN","XUMFP4",97,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"FILE")=4.014
"RTN","XUMFP4",98,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"FIELD")="1"
"RTN","XUMFP4",99,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",9,"DTYP")="ST"
"RTN","XUMFP4",100,0)
 ; history -- old station number
"RTN","XUMFP4",101,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"FILE")=4.999
"RTN","XUMFP4",102,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"FIELD")=.01
"RTN","XUMFP4",103,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",10,"DTYP")="DT"
"RTN","XUMFP4",104,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"FILE")=4.999
"RTN","XUMFP4",105,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"FIELD")=".06"
"RTN","XUMFP4",106,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",11,"DTYP")="ST^^:99"
"RTN","XUMFP4",107,0)
 ; history -- new station number
"RTN","XUMFP4",108,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"FILE")=4.999
"RTN","XUMFP4",109,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"FIELD")=.01
"RTN","XUMFP4",110,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",12,"DTYP")="DT"
"RTN","XUMFP4",111,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"FILE")=4.999
"RTN","XUMFP4",112,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"FIELD")=".05"
"RTN","XUMFP4",113,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",13,"DTYP")="ST^^:99"
"RTN","XUMFP4",114,0)
 ; physical address
"RTN","XUMFP4",115,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.1,.01)="SAD"
"RTN","XUMFP4",116,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.2,1.01)="ST"
"RTN","XUMFP4",117,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.3,1.03)="ST"
"RTN","XUMFP4",118,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.4,.02)="ST"
"RTN","XUMFP4",119,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",14.5,1.04)="ST"
"RTN","XUMFP4",120,0)
 ; mailing address
"RTN","XUMFP4",121,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.1,.01)="SAD"
"RTN","XUMFP4",122,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.2,4.01)="ST"
"RTN","XUMFP4",123,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.3,4.03)="ST"
"RTN","XUMFP4",124,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.4,4.04)="ST"
"RTN","XUMFP4",125,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",15.5,4.05)="ST"
"RTN","XUMFP4",126,0)
 ; agency code
"RTN","XUMFP4",127,0)
 S ^TMP("XUMF MFS",$J,"PARAM","SEG","ZIN","SEQ",16,95)="CE^~AGENCY CODE~VA"
"RTN","XUMFP4",128,0)
 ;
"RTN","XUMFP4",129,0)
GROUP ; -- query group
"RTN","XUMFP4",130,0)
 ;
"RTN","XUMFP4",131,0)
 D GROUP^XUMFP4C
"RTN","XUMFP4",132,0)
 ;
"RTN","XUMFP4",133,0)
 Q
"RTN","XUMFP4",134,0)
 ;
"RTN","XUMFP4C")
0^6^B15679820
"RTN","XUMFP4C",1,0)
XUMFP4C ;CIOFO-SF/RAM - Master File C/S Params INSTITUTION ;06/28/00
"RTN","XUMFP4C",2,0)
 ;;8.0;KERNEL;**206,209,217,270,294,335**;Jul 10, 1995
"RTN","XUMFP4C",3,0)
 ;
"RTN","XUMFP4C",4,0)
 ; this routine is a called by XUMFP4 and is a continuation of that
"RTN","XUMFP4C",5,0)
 ; routine
"RTN","XUMFP4C",6,0)
 ;
"RTN","XUMFP4C",7,0)
QRD ; -- query definition segment
"RTN","XUMFP4C",8,0)
 ;
"RTN","XUMFP4C",9,0)
 ;Query Date/Time
"RTN","XUMFP4C",10,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QDT")) D
"RTN","XUMFP4C",11,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFP4C",12,0)
 ;
"RTN","XUMFP4C",13,0)
 ;Query Format Code
"RTN","XUMFP4C",14,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QFC")) D
"RTN","XUMFP4C",15,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QFC")="R"
"RTN","XUMFP4C",16,0)
 ;
"RTN","XUMFP4C",17,0)
 ;Query Priority
"RTN","XUMFP4C",18,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QP")) D
"RTN","XUMFP4C",19,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QP")="I"
"RTN","XUMFP4C",20,0)
 ;
"RTN","XUMFP4C",21,0)
 ;Query ID
"RTN","XUMFP4C",22,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QID")) D
"RTN","XUMFP4C",23,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QID")="Z04 "_$S(ARRAY:"ARRAY",1:"FILE")
"RTN","XUMFP4C",24,0)
 ;
"RTN","XUMFP4C",25,0)
 ;Deferred Response Type (optional)
"RTN","XUMFP4C",26,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRT")) D
"RTN","XUMFP4C",27,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRT")=""
"RTN","XUMFP4C",28,0)
 ;
"RTN","XUMFP4C",29,0)
 ;Deferred Response Date/Time (optional)
"RTN","XUMFP4C",30,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRDT")) D
"RTN","XUMFP4C",31,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRDT")=""
"RTN","XUMFP4C",32,0)
 ;
"RTN","XUMFP4C",33,0)
 ;Quantity Limited Request
"RTN","XUMFP4C",34,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QLR")) D
"RTN","XUMFP4C",35,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QLR")="RD"_HLCS_999
"RTN","XUMFP4C",36,0)
 ;
"RTN","XUMFP4C",37,0)
 ;Who Subject Filter - sta#, D x-ref, assigning facility
"RTN","XUMFP4C",38,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHO")) D
"RTN","XUMFP4C",39,0)
 .N X S X=$S(ALL:"ALL",IEN:$P($G(^DIC(4,+IEN,99)),U),1:"IEN ARRAY")
"RTN","XUMFP4C",40,0)
 .S $P(X,HLCS,9,10)="D"_HLCS_"045A4"
"RTN","XUMFP4C",41,0)
 .S:$G(CDSYS)'="" $P(X,HLCS,9,10)="DMIS"_HLCS_"DOD"
"RTN","XUMFP4C",42,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHO")=X
"RTN","XUMFP4C",43,0)
 ;
"RTN","XUMFP4C",44,0)
 ;What Subject Filter
"RTN","XUMFP4C",45,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHAT")) D
"RTN","XUMFP4C",46,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHAT")="4"_HLCS_"IFN"_HLCS_"VA FM"
"RTN","XUMFP4C",47,0)
 ;
"RTN","XUMFP4C",48,0)
 ;What Department Data Code
"RTN","XUMFP4C",49,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDDC")) D
"RTN","XUMFP4C",50,0)
 .N X S X="INFRASTRUCTURE"_HLCS_"INFORMATION INFRASTRUCTURE"
"RTN","XUMFP4C",51,0)
 .S X=X_HLCS_"VA TS"
"RTN","XUMFP4C",52,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDDC")=X
"RTN","XUMFP4C",53,0)
 ;
"RTN","XUMFP4C",54,0)
 ;What Data Code Value Qual (optional)
"RTN","XUMFP4C",55,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDCVQ")) D
"RTN","XUMFP4C",56,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDCVQ")=""
"RTN","XUMFP4C",57,0)
 ;
"RTN","XUMFP4C",58,0)
 ;Query Results Level (optional)
"RTN","XUMFP4C",59,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QRL")) D
"RTN","XUMFP4C",60,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QRL")=""
"RTN","XUMFP4C",61,0)
 ;
"RTN","XUMFP4C",62,0)
 Q
"RTN","XUMFP4C",63,0)
 ;
"RTN","XUMFP4C",64,0)
PRE ; -- pre-update record
"RTN","XUMFP4C",65,0)
 ;
"RTN","XUMFP4C",66,0)
 D PRE^XUMFR
"RTN","XUMFP4C",67,0)
 ;
"RTN","XUMFP4C",68,0)
 D IFF(IEN)
"RTN","XUMFP4C",69,0)
 ;
"RTN","XUMFP4C",70,0)
 Q
"RTN","XUMFP4C",71,0)
 ;
"RTN","XUMFP4C",72,0)
POST ; -- post-update record
"RTN","XUMFP4C",73,0)
 ;
"RTN","XUMFP4C",74,0)
 D POST^XUMFR
"RTN","XUMFP4C",75,0)
 ;
"RTN","XUMFP4C",76,0)
 Q
"RTN","XUMFP4C",77,0)
 ;
"RTN","XUMFP4C",78,0)
GROUP ; -- query group
"RTN","XUMFP4C",79,0)
 ;
"RTN","XUMFP4C",80,0)
 S IEN=0
"RTN","XUMFP4C",81,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)) Q:'IEN  D
"RTN","XUMFP4C",82,0)
 .I '$G(^DIC(4,IEN,99)) D
"RTN","XUMFP4C",83,0)
 ..S PKV="NEW"_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4C",84,0)
 .I $G(^DIC(4,IEN,99)) D
"RTN","XUMFP4C",85,0)
 ..S PKV=$P(^DIC(4,IEN,99),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4C",86,0)
 .I CDSYS'="" D
"RTN","XUMFP4C",87,0)
 ..S $P(PKV,HLCS,1)=^TMP("XUMF MFS",$J,"PARAM","IEN",IEN)
"RTN","XUMFP4C",88,0)
 ..S $P(PKV,HLCS,2)=$P($G(^DIC(4,+IEN,0)),U),$P(PKV,HLCS,3)=CDSYS
"RTN","XUMFP4C",89,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")=PKV
"RTN","XUMFP4C",90,0)
 .I '$P($G(^DIC(4,+IEN,99)),U,4) D
"RTN","XUMFP4C",91,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",8)="1,"_IEN_","
"RTN","XUMFP4C",92,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"1,"_IEN_",")="VISN"
"RTN","XUMFP4C",93,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",9)="2,"_IEN_","
"RTN","XUMFP4C",94,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"2,"_IEN_",")="PARENT FACILITY"
"RTN","XUMFP4C",95,0)
 .S RF=$$RF^XUAF4(IEN) D:RF
"RTN","XUMFP4C",96,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",10)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",97,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",11)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",98,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RF,U,3)_","_IEN_",")=$P(RF,U,3)
"RTN","XUMFP4C",99,0)
 .S RT=$$RT^XUAF4(IEN) D:RT
"RTN","XUMFP4C",100,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",12)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",101,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",13)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",102,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RT,U,3)_","_IEN_",")=$P(RT,U,3)
"RTN","XUMFP4C",103,0)
 ;
"RTN","XUMFP4C",104,0)
 Q
"RTN","XUMFP4C",105,0)
 ;
"RTN","XUMFP4C",106,0)
IFF(IEN) ; -- inactive facility remove VISN and parent association
"RTN","XUMFP4C",107,0)
 ;
"RTN","XUMFP4C",108,0)
 N FDA,IENS,XUMF
"RTN","XUMFP4C",109,0)
 ;
"RTN","XUMFP4C",110,0)
 S XUMF=1
"RTN","XUMFP4C",111,0)
 ;
"RTN","XUMFP4C",112,0)
 S IENS="1,"_IEN_","
"RTN","XUMFP4C",113,0)
 S FDA(4.014,IENS,.01)="@"
"RTN","XUMFP4C",114,0)
 S IENS="2,"_IEN_","
"RTN","XUMFP4C",115,0)
 S FDA(4.014,IENS,.01)="@"
"RTN","XUMFP4C",116,0)
 D FILE^DIE("E","FDA")
"RTN","XUMFP4C",117,0)
 ;
"RTN","XUMFP4C",118,0)
 Q
"RTN","XUMFP4C",119,0)
 ;
"RTN","XUMFR")
0^7^B8248716
"RTN","XUMFR",1,0)
XUMFR ;OIFO-OAK/RAM - pre/post update subroutines;04/15/02
"RTN","XUMFR",2,0)
 ;;8.0;KERNEL;**335**;Jul 10, 1995
"RTN","XUMFR",3,0)
 ;
"RTN","XUMFR",4,0)
 Q
"RTN","XUMFR",5,0)
 ;
"RTN","XUMFR",6,0)
NULL ; -- do nothing
"RTN","XUMFR",7,0)
 ;
"RTN","XUMFR",8,0)
 Q
"RTN","XUMFR",9,0)
 ;
"RTN","XUMFR",10,0)
PRE ; -- pre update
"RTN","XUMFR",11,0)
 ;
"RTN","XUMFR",12,0)
 N ARRAY
"RTN","XUMFR",13,0)
 ;
"RTN","XUMFR",14,0)
 K ^TMP("XUMF PRE",$J)
"RTN","XUMFR",15,0)
 ;
"RTN","XUMFR",16,0)
 D DATA(.ARRAY)
"RTN","XUMFR",17,0)
 ;
"RTN","XUMFR",18,0)
 M ^TMP("XUMF PRE",$J)=ARRAY
"RTN","XUMFR",19,0)
 ;
"RTN","XUMFR",20,0)
 Q
"RTN","XUMFR",21,0)
 ;
"RTN","XUMFR",22,0)
POST ; -- post update
"RTN","XUMFR",23,0)
 ;
"RTN","XUMFR",24,0)
 N ARRAY,I,X,FLAG
"RTN","XUMFR",25,0)
 ;
"RTN","XUMFR",26,0)
 D DATA(.ARRAY)
"RTN","XUMFR",27,0)
 ;
"RTN","XUMFR",28,0)
 S (FLAG,I)=0
"RTN","XUMFR",29,0)
 F  S I=$O(ARRAY(I)) Q:'I  D  Q:FLAG
"RTN","XUMFR",30,0)
 .I ARRAY(I)'=^TMP("XUMF PRE",$J,I) S FLAG=1 Q
"RTN","XUMFR",31,0)
 ;
"RTN","XUMFR",32,0)
 I FLAG D
"RTN","XUMFR",33,0)
 .S I=0
"RTN","XUMFR",34,0)
 .F  S I=$O(ARRAY(I)) Q:'I  D
"RTN","XUMFR",35,0)
 ..S X(I+100)=ARRAY(I) K ARRAY(I)
"RTN","XUMFR",36,0)
 .M X=^TMP("XUMF PRE",$J)
"RTN","XUMFR",37,0)
 .D XM(.X,$G(KEY))
"RTN","XUMFR",38,0)
 ;
"RTN","XUMFR",39,0)
 K ^TMP("XUMF PRE",$J)
"RTN","XUMFR",40,0)
 ;
"RTN","XUMFR",41,0)
 Q
"RTN","XUMFR",42,0)
 ;
"RTN","XUMFR",43,0)
DATA(ARRAY) ; -- array(sequence)=fieldLabel_": "_value
"RTN","XUMFR",44,0)
 ;
"RTN","XUMFR",45,0)
 N SEG,SEQ,FLD,FILE,IENS,FIELD,VALUE,LKUP,IDX,ZDTYP
"RTN","XUMFR",46,0)
 ;
"RTN","XUMFR",47,0)
 S SEG="",SEQ=0
"RTN","XUMFR",48,0)
 F  S SEG=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG)) Q:SEG=""  D
"RTN","XUMFR",49,0)
 .F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFR",50,0)
 ..;
"RTN","XUMFR",51,0)
 ..S FLD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFR",52,0)
 ..;
"RTN","XUMFR",53,0)
 ..I 'FLD D
"RTN","XUMFR",54,0)
 ...S FILE=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFR",55,0)
 ...S IENS=$G(^TMP("XUMF MFS",$J,"PARAM","IENS",SEG,SEQ))
"RTN","XUMFR",56,0)
 ...S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFR",57,0)
 ...S LKUP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"LKUP"))
"RTN","XUMFR",58,0)
 ...I LKUP S FIELD=FIELD_":"_LKUP
"RTN","XUMFR",59,0)
 ...S VALUE=$$GET1^DIQ(FILE,IENS,FIELD)
"RTN","XUMFR",60,0)
 ...S ARRAY(SEQ)=$$FIELD^XUMF(FILE,$P(FIELD,":"),"LABEL")_": "_VALUE
"RTN","XUMFR",61,0)
 ..I FLD D
"RTN","XUMFR",62,0)
 ...S ZDTYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FLD))
"RTN","XUMFR",63,0)
 ...S LKUP=$P(ZDTYP,U,2)
"RTN","XUMFR",64,0)
 ...I LKUP S FLD=FLD_":"_LKUP
"RTN","XUMFR",65,0)
 ...S VALUE=$$GET1^DIQ(IFN,IEN_",",FLD)
"RTN","XUMFR",66,0)
 ...S ARRAY(SEQ)=$$FIELD^XUMF(IFN,$P(FLD,":"),"LABEL")_": "_VALUE
"RTN","XUMFR",67,0)
 ;
"RTN","XUMFR",68,0)
 Q
"RTN","XUMFR",69,0)
 ;
"RTN","XUMFR",70,0)
XM(X,XUMFKEY) ; -- MailMan notification
"RTN","XUMFR",71,0)
 ;
"RTN","XUMFR",72,0)
 N GROUP,XMDUZ
"RTN","XUMFR",73,0)
 ;
"RTN","XUMFR",74,0)
 S HLCS=$G(HLCS) S:HLCS="" HLCS="~"
"RTN","XUMFR",75,0)
 S XUMFKEY=" "_$P($G(XUMFKEY),HLCS)
"RTN","XUMFR",76,0)
 ;
"RTN","XUMFR",77,0)
 S GROUP=$$GET1^DIQ(4.001,IEN_",",.06)
"RTN","XUMFR",78,0)
 S:GROUP'="" GROUP="G."_GROUP
"RTN","XUMFR",79,0)
 S X(.1)="HL7 message ID: "_$G(HL("MID")),X(.2)=""
"RTN","XUMFR",80,0)
 ;S X(.3)="PRE UPDATE VALUES:",X(.4)=""
"RTN","XUMFR",81,0)
 S X(99.1)="",X(99.2)="POST UPDATE VALUES:",X(99.3)=""
"RTN","XUMFR",82,0)
 S XMSUB="MFS UPDATE - "_$$FILE^XUMF(IFN,"NAME")_XUMFKEY
"RTN","XUMFR",83,0)
 S XMY("G.XUMF SERVER")="",XMDUZ=.5
"RTN","XUMFR",84,0)
 S:GROUP'="" XMY(GROUP)=""
"RTN","XUMFR",85,0)
 S XMTEXT="X("
"RTN","XUMFR",86,0)
 ;
"RTN","XUMFR",87,0)
 D ^XMD
"RTN","XUMFR",88,0)
 ;
"RTN","XUMFR",89,0)
 Q
"RTN","XUMFR",90,0)
 ;
"VER")
8.0^22.0
"^DD",4,4,0)
FIELD^NL^9999^31
"^DD",4,4,0,0)
^4I
"^DD",4,4,0,"DDA")
N
"^DD",4,4,0,"DT")
3040112
"^DD",4,4,0,"ID","W1")
D EN^DDIOL($P($G(^DIC(5,+$P($G(^(0)),U,2),0)),U,2),,"?31")
"^DD",4,4,0,"ID","W2")
D EN^DDIOL($P($G(^DIC(4.1,+$G(^DIC(4,+Y,3)),0)),U),,"?35")
"^DD",4,4,0,"ID","W3")
D EN^DDIOL($P($G(^DIC(4,+Y,99)),U),,"?45")
"^DD",4,4,0,"ID","W4")
D:$P($G(^DIC(4,+Y,99)),U,4) EN^DDIOL("INACTIVE "_$$FMTE^XLFDT($$IDT^XUAF4(+Y),"D"),,"?54")
"^DD",4,4,0,"IX","AC",4.014,.01)

"^DD",4,4,0,"IX","AC",4.014,1)

"^DD",4,4,0,"IX","AD",4,.01)

"^DD",4,4,0,"IX","AI",4.999,.07)

"^DD",4,4,0,"IX","AP1",4,.01)

"^DD",4,4,0,"IX","ARF",4.999,.06)

"^DD",4,4,0,"IX","ARFM",4.999,.06)

"^DD",4,4,0,"IX","ART",4.999,.05)

"^DD",4,4,0,"IX","ARTO",4.999,.05)

"^DD",4,4,0,"IX","AXUMFID",4.9999,.02)

"^DD",4,4,0,"IX","AXUMFIEN",4.9999,.02)

"^DD",4,4,0,"IX","B",4,.01)

"^DD",4,4,0,"IX","C",4,100)

"^DD",4,4,0,"IX","D",4,99)

"^DD",4,4,0,"IX","LOC1",4,720)

"^DD",4,4,0,"IX","OLDNAM",4.999,.02)

"^DD",4,4,0,"IX","XUMF",4,11)

"^DD",4,4,0,"NM","INSTITUTION")

"^DD",4,4,0,"PT",2,.2911)

"^DD",4,4,0,"PT",2,.314)

"^DD",4,4,0,"PT",2,.393)

"^DD",4,4,0,"PT",2,.535)

"^DD",4,4,0,"PT",2,21)

"^DD",4,4,0,"PT",2,27.02)

"^DD",4,4,0,"PT",2,33)

"^DD",4,4,0,"PT",2,991.03)

"^DD",4,4,0,"PT",2,1010.152)

"^DD",4,4,0,"PT",2,1010.154)

"^DD",4,4,0,"PT",2.07,9)

"^DD",4,4,0,"PT",2.0992,2)

"^DD",4,4,0,"PT",2.399,.393)

"^DD",4,4,0,"PT",3.02,.01)

"^DD",4,4,0,"PT",4,96)

"^DD",4,4,0,"PT",4.014,1)

"^DD",4,4,0,"PT",4.02,.03)

"^DD",4,4,0,"PT",4.3,217)

"^DD",4,4,0,"PT",4.999,.05)

"^DD",4,4,0,"PT",4.999,.06)

"^DD",4,4,0,"PT",9,1)

"^DD",4,4,0,"PT",9.4,11.5)

"^DD",4,4,0,"PT",9.4,11.6)

"^DD",4,4,0,"PT",9.409,.01)

"^DD",4,4,0,"PT",27.11,.06)

"^DD",4,4,0,"PT",28.11,1.04)

"^DD",4,4,0,"PT",28.11,2.04)

"^DD",4,4,0,"PT",40.8,.07)

"^DD",4,4,0,"PT",44,3)

"^DD",4,4,0,"PT",45.87,.1)

"^DD",4,4,0,"PT",59,100)

"^DD",4,4,0,"PT",59.4,1)

"^DD",4,4,0,"PT",60.11,.01)

"^DD",4,4,0,"PT",62.9,.02)

"^DD",4,4,0,"PT",62.9,.03)

"^DD",4,4,0,"PT",62.9,.031)

"^DD",4,4,0,"PT",62.9,.06)

"^DD",4,4,0,"PT",63.04,.111)

"^DD",4,4,0,"PT",63.04,.32)

"^DD",4,4,0,"PT",63.04,.33)

"^DD",4,4,0,"PT",64.03,4)

"^DD",4,4,0,"PT",64.06,.01)

"^DD",4,4,0,"PT",64.1,.01)

"^DD",4,4,0,"PT",65,.16)

"^DD",4,4,0,"PT",65.31,.03)

"^DD",4,4,0,"PT",66.1,.01)

"^DD",4,4,0,"PT",67.9,.01)

"^DD",4,4,0,"PT",67.901,.01)

"^DD",4,4,0,"PT",68.02,16.1)

"^DD",4,4,0,"PT",68.02,16.2)

"^DD",4,4,0,"PT",68.02,26)

"^DD",4,4,0,"PT",68.03,.01)

"^DD",4,4,0,"PT",68.14,3)

"^DD",4,4,0,"PT",69.01,25)

"^DD",4,4,0,"PT",69.03,14)

"^DD",4,4,0,"PT",69.03,15)

"^DD",4,4,0,"PT",69.6,1)

"^DD",4,4,0,"PT",69.6,2)

"^DD",4,4,0,"PT",69.9,3)

"^DD",4,4,0,"PT",69.9001,3)

"^DD",4,4,0,"PT",69.9006,.01)

"^DD",4,4,0,"PT",69.9007,.01)

"^DD",4,4,0,"PT",69.981,.01)

"^DD",4,4,0,"PT",79,.01)

"^DD",4,4,0,"PT",120.846,.01)

"^DD",4,4,0,"PT",123.9,.01)

"^DD",4,4,0,"PT",130,50)

"^DD",4,4,0,"PT",133,.01)

"^DD",4,4,0,"PT",154,3.2)

"^DD",4,4,0,"PT",154,3.3)

"^DD",4,4,0,"PT",154,3.4)

"^DD",4,4,0,"PT",154,8.4)

"^DD",4,4,0,"PT",154.1,2.11)

"^DD",4,4,0,"PT",154.1,2.12)

"^DD",4,4,0,"PT",158,15.6)

"^DD",4,4,0,"PT",158.9,.01)

"^DD",4,4,0,"PT",160.05,1)

"^DD",4,4,0,"PT",161.01,101)

"^DD",4,4,0,"PT",161.4,27)

"^DD",4,4,0,"PT",162.03,26)

"^DD",4,4,0,"PT",162.11,25)

"^DD",4,4,0,"PT",162.5,23)

"^DD",4,4,0,"PT",162.7,6)

"^DD",4,4,0,"PT",165,99)

"^DD",4,4,0,"PT",190.1,12)

"^DD",4,4,0,"PT",194.2,12)

"^DD",4,4,0,"PT",195.12,.01)

"^DD",4,4,0,"PT",195.9,.01)

"^DD",4,4,0,"PT",200.02,.01)

"^DD",4,4,0,"PT",213.2,.01)

"^DD",4,4,0,"PT",340,.01)

"^DD",4,4,0,"PT",341,.09)

"^DD",4,4,0,"PT",342,.01)

"^DD",4,4,0,"PT",350,.13)

"^DD",4,4,0,"PT",350.9,.02)

"^DD",4,4,0,"PT",389.9,.07)

"^DD",4,4,0,"PT",391.91,.02)

"^DD",4,4,0,"PT",394.2,4)

"^DD",4,4,0,"PT",394.26,.01)

"^DD",4,4,0,"PT",394.81,.01)

"^DD",4,4,0,"PT",394.82,.01)

"^DD",4,4,0,"PT",394.831,.01)

"^DD",4,4,0,"PT",396.12,.01)

"^DD",4,4,0,"PT",396.3,2)

"^DD",4,4,0,"PT",399,111)

"^DD",4,4,0,"PT",404.51,.07)

"^DD",4,4,0,"PT",404.9503,.01)

"^DD",4,4,0,"PT",405,.05)

"^DD",4,4,0,"PT",408,3)

"^DD",4,4,0,"PT",411,.1)

"^DD",4,4,0,"PT",412,.01)

"^DD",4,4,0,"PT",430,12)

"^DD",4,4,0,"PT",604.8,.01)

"^DD",4,4,0,"PT",631.9,4)

"^DD",4,4,0,"PT",660,8)

"^DD",4,4,0,"PT",660,40)

"^DD",4,4,0,"PT",660,70)

"^DD",4,4,0,"PT",660.1,14)

"^DD",4,4,0,"PT",663.4,4)

"^DD",4,4,0,"PT",664,18)

"^DD",4,4,0,"PT",664.1,.03)

"^DD",4,4,0,"PT",664.1,.04)

"^DD",4,4,0,"PT",664.1,.11)

"^DD",4,4,0,"PT",664.2,1.5)

"^DD",4,4,0,"PT",664.2,6)

"^DD",4,4,0,"PT",664.3,2)

"^DD",4,4,0,"PT",664.4,2)

"^DD",4,4,0,"PT",664.4,14)

"^DD",4,4,0,"PT",665,2)

"^DD",4,4,0,"PT",665.1,1)

"^DD",4,4,0,"PT",665.1,6)

"^DD",4,4,0,"PT",665.4,6)

"^DD",4,4,0,"PT",667,11)

"^DD",4,4,0,"PT",667.3,12)

"^DD",4,4,0,"PT",668,2)

"^DD",4,4,0,"PT",669.9,1)

"^DD",4,4,0,"PT",680.6,.04)

"^DD",4,4,0,"PT",688,1)

"^DD",4,4,0,"PT",694.5,2)

"^DD",4,4,0,"PT",698,7)

"^DD",4,4,0,"PT",721,3)

"^DD",4,4,0,"PT",740,.01)

"^DD",4,4,0,"PT",742.6,.01)

"^DD",4,4,0,"PT",747.13,.01)

"^DD",4,4,0,"PT",748.09,.01)

"^DD",4,4,0,"PT",748.3,.02)

"^DD",4,4,0,"PT",785,2)

"^DD",4,4,0,"PT",785.5,2)

"^DD",4,4,0,"PT",810.13,.01)

"^DD",4,4,0,"PT",839.7,.04)

"^DD",4,4,0,"PT",850,3)

"^DD",4,4,0,"PT",850,16)

"^DD",4,4,0,"PT",869.3,.04)

"^DD",4,4,0,"PT",870,.02)

"^DD",4,4,0,"PT",912,5.01)

"^DD",4,4,0,"PT",914,5.01)

"^DD",4,4,0,"PT",984.9,.07)

"^DD",4,4,0,"PT",984.9,.09)

"^DD",4,4,0,"PT",1020.1,8)

"^DD",4,4,0,"PT",1020.2,1)

"^DD",4,4,0,"PT",1020.5,.01)

"^DD",4,4,0,"PT",1020.8,.01)

"^DD",4,4,0,"PT",2101.7,.01)

"^DD",4,4,0,"PT",6925,3)

"^DD",4,4,0,"PT",6925,15.3)

"^DD",4,4,0,"PT",7105.07,1)

"^DD",4,4,0,"PT",8925.99,.01)

"^DD",4,4,0,"PT",8986.095,.01)

"^DD",4,4,0,"PT",8989.3,217)

"^DD",4,4,0,"PT",8989.5,.01)

"^DD",4,4,0,"PT",503338,.01)

"^DD",4,4,0,"PT",509850.8,.01)

"^DD",4,4,0,"PT",662002.01,1)

"^DD",4,4,0,"PT",662003,3)

"^DD",4,4,0,"PT",662003.04,2)

"^DD",4,4,0,"PT",791813,.01)

"^DD",4,4,0,"PT",791813,2.01)

"^DD",4,4,0,"PT",9999999.06,.01)

"^DD",4,4,0,"SCR")
I $$SCN^XUMF333(+Y,$G(XUMF))
"^DD",4,4,0,"VRPK")
XU
"^DD",4,4,.01,0)
NAME^RFX^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X K:($P($G(^DIC(4,+$G(DA),0)),U,11)="N")&'$G(XUMF) X
"^DD",4,4,.01,.1)
INSTITUTION NAME
"^DD",4,4,.01,1,0)
^.1
"^DD",4,4,.01,1,1,0)
4^B
"^DD",4,4,.01,1,1,1)
S ^DIC(4,"B",$E(X,1,30),DA)=""
"^DD",4,4,.01,1,1,2)
K ^DIC(4,"B",$E(X,1,30),DA)
"^DD",4,4,.01,1,2,0)
4^AP1^MUMPS
"^DD",4,4,.01,1,2,1)
F I=0:0 S I=$O(^DIC(4,DA,4,I)) Q:I'>0  S Y(1)=+^(I,0),Y(2)=$S($D(^DIC(9.4,Y(1),0)):^(0),1:"") S:Y(2)]"" ^DIC(4,"AP"_$P(Y(2),U,2),$E(X,1,30),DA)=""
"^DD",4,4,.01,1,2,2)
S Y="AP" F I=0:0 S Y=$O(^DIC(4,Y)) Q:$E(Y,1,2)'="AP"  K ^DIC(4,Y,$E(X,1,30),DA)
"^DD",4,4,.01,1,2,3)
Special Package X-ref
"^DD",4,4,.01,1,2,"DT")
2900103
"^DD",4,4,.01,1,3,0)
4^AD^MUMPS
"^DD",4,4,.01,1,3,1)
I $D(^AUTTLOC(0))#2 N DIC,DD,DO,DINUM,DS S DIC="^AUTTLOC(",DIC(0)="",(X,DINUM)=DA D FILE^DICN
"^DD",4,4,.01,1,3,2)
I $D(^AUTTLOC(0))#2 N DIK S DIK="^AUTTLOC(" D ^DIK
"^DD",4,4,.01,1,3,3)
Needed to keep PCE location file in sync.
"^DD",4,4,.01,1,3,"%D",0)
^^2^2^2980827^
"^DD",4,4,.01,1,3,"%D",1,0)
This MUMPS cross reference is used to keep the PCE location file
"^DD",4,4,.01,1,3,"%D",2,0)
(#9999999.06) synchronized with the Institution file.
"^DD",4,4,.01,1,3,"DT")
2980827
"^DD",4,4,.01,3)
Answer must be 3-30 characters in length.
"^DD",4,4,.01,21,0)
^.001^2^2^3031215^^^^
"^DD",4,4,.01,21,1,0)
This is the name of the institution with out modifiers like state
"^DD",4,4,.01,21,2,0)
or type.
"^DD",4,4,.01,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,.01,"DT")
3031215
"^DD",4,4,.02,0)
STATE^P5'X^DIC(5,^0;2^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,.02,3)
Enter the state.
"^DD",4,4,.02,21,0)
^^1^1^3011218^
"^DD",4,4,.02,21,1,0)
State that the institution is physically located.
"^DD",4,4,.02,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,.02,"DT")
3040112
"^DD",4,4,.03,0)
DISTRICT^NJ2,0X^^0;3^K:+X'=X!(X>27)!(X<1)!(X?.E1"."1N.N) X
"^DD",4,4,.03,1,0)
^.1^^0
"^DD",4,4,.03,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 27
"^DD",4,4,.03,21,0)
^^2^2^2920702^
"^DD",4,4,.03,21,1,0)
This is the Medical District of the Institution file.  Therefore it is not
"^DD",4,4,.03,21,2,0)
to be changed except by appropriately knowledgeable individuals.
"^DD",4,4,.03,"DT")
2900409
"^DD",4,4,.05,0)
SHORT NAME^F^^0;5^K:$L(X)>80!($L(X)<4) X
"^DD",4,4,.05,1,0)
^.1^^0
"^DD",4,4,.05,3)
ANSWER MUST BE 4-80 CHARACTERS IN LENGTH
"^DD",4,4,.05,21,0)
^^1^1^2930330^
"^DD",4,4,.05,21,1,0)
Short version of name.
"^DD",4,4,.05,"DT")
2840410
"^DD",4,4,.06,0)
VA TYPE CODE^S^MC:HOSP;DM:DOM;NH:NH;RO:RO;DP:DPC;OI:OC-IND;OM:OC-UNDER MMT;OS:OC-SUB;PC:PROTH;PD:PDC;RP:RPC;CO:VACO;CR:VACO-RO;MCDM:MC&DOM;MCDMNH:MC,DOM,NH;MCNH:MC&NH;MCRO:MC&RO;RODP:RO&DPC;^0;6^Q
"^DD",4,4,.06,21,0)
^^1^1^2920528^^^
"^DD",4,4,.06,21,1,0)
This field is being replaced by the Facitily type field.
"^DD",4,4,.07,0)
REGION^NJ1,0^^0;7^K:+X'=X!(X>7)!(X<1)!(X?.E1"."1N.N) X
"^DD",4,4,.07,1,0)
^.1^^0
"^DD",4,4,.07,3)
TYPE A WHOLE NUMBER BETWEEN 1 AND 7
"^DD",4,4,.07,21,0)
^^1^1^2920528^^^^
"^DD",4,4,.07,21,1,0)
VA region number.
"^DD",4,4,.07,"DT")
2900409
"^DD",4,4,1.01,0)
STREET ADDR. 1^F^^1;1^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.01,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.01,21,0)
^^1^1^3011218^
"^DD",4,4,1.01,21,1,0)
First line of the street address (physical) of the facility.
"^DD",4,4,1.01,"DT")
3011218
"^DD",4,4,1.02,0)
STREET ADDR. 2^F^^1;2^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.02,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.02,21,0)
^^1^1^3020805^^
"^DD",4,4,1.02,21,1,0)
Second line of street address (physical) of the facility.
"^DD",4,4,1.02,"DT")
3020805
"^DD",4,4,1.03,0)
CITY^F^^1;3^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,1.03,3)
ANSWER MUST BE 2-40 CHARACTERS IN LENGTH
"^DD",4,4,1.03,21,0)
^.001^1^1^3011231^^
"^DD",4,4,1.03,21,1,0)
The city the facility is physically located.
"^DD",4,4,1.03,"DT")
3011218
"^DD",4,4,1.04,0)
ZIP^FX^^1;4^K:$L(X)>10!($L(X)<5)!'((X?5N)!(X?5N1"-"4N)) X
"^DD",4,4,1.04,3)
Enter ZIP code or ZIP + 4
"^DD",4,4,1.04,21,0)
^.001^1^1^3011231^^^
"^DD",4,4,1.04,21,1,0)
Postal ZIP code for the physical address of the facility.
"^DD",4,4,1.04,"DT")
3011218
"^DD",4,4,4,0)
CONTACT^4.03^^2;0
"^DD",4,4,4,21,0)
^^1^1^2920528^^^^
"^DD",4,4,4,21,1,0)
List of contacts.
"^DD",4,4,4.01,0)
ST. ADDR. 1 (MAILING)^F^^4;1^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,4.01,3)
Answer must be 2-40 characters in length.
"^DD",4,4,4.01,21,0)
^^1^1^3011231^
"^DD",4,4,4.01,21,1,0)
First line of the street address (mailing) of the facility.
"^DD",4,4,4.01,"DT")
3011231
"^DD",4,4,4.02,0)
ST. ADDR. 2 (MAILING)^F^^4;2^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,4.02,3)
Answer must be 2-40 characters in length.
"^DD",4,4,4.02,21,0)
^^1^1^3011231^
"^DD",4,4,4.02,21,1,0)
Second line of the street address (mailing) of the facility.
"^DD",4,4,4.02,"DT")
3011231
"^DD",4,4,4.03,0)
CITY (MAILING)^F^^4;3^K:$L(X)>40!($L(X)<2) X
"^DD",4,4,4.03,3)
Answer must be 2-40 characters in length.
"^DD",4,4,4.03,21,0)
^^1^1^3011231^
"^DD",4,4,4.03,21,1,0)
The City of the facility's mailing address.
"^DD",4,4,4.03,"DT")
3011231
"^DD",4,4,4.04,0)
STATE (MAILING)^P5'^DIC(5,^4;4^Q
"^DD",4,4,4.04,21,0)
^^1^1^3011231^
"^DD",4,4,4.04,21,1,0)
The State of the facility's mailing address.
"^DD",4,4,4.04,"DT")
3011231
"^DD",4,4,4.05,0)
ZIP (MAILING)^FX^^4;5^K:$L(X)>10!($L(X)<5)!'((X?5N)!(X?5N1"-"4N)) X
"^DD",4,4,4.05,3)
Enter ZIP code or ZIP + 4
"^DD",4,4,4.05,21,0)
^^1^1^3011231^
"^DD",4,4,4.05,21,1,0)
Postal ZIP code for the mailing address of the facility.
"^DD",4,4,4.05,"DT")
3020122
"^DD",4,4,5,0)
MULTI-DIVISION FACILITY^S^Y:YES;N:NO;^DIV;1^Q
"^DD",4,4,5,21,0)
^^1^1^2930330^
"^DD",4,4,5,21,1,0)
Flag to indicate this is a multi-division facility.
"^DD",4,4,5,"DT")
3010104
"^DD",4,4,11,0)
STATUS^RSX^N:National;L:Local;^0;11^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N"!(X["N") X
"^DD",4,4,11,1,0)
^.1
"^DD",4,4,11,1,1,0)
4^XUMF
"^DD",4,4,11,1,1,1)
S ^DIC(4,"XUMF",$E(X,1,30),DA)=""
"^DD",4,4,11,1,1,2)
K ^DIC(4,"XUMF",$E(X,1,30),DA)
"^DD",4,4,11,1,1,"%D",0)
^^2^2^3010524^
"^DD",4,4,11,1,1,"%D",1,0)
This x-ref. is used by the master file server query.  It loops this x-ref to
"^DD",4,4,11,1,1,"%D",2,0)
find all national entries.
"^DD",4,4,11,1,1,"DT")
3000302
"^DD",4,4,11,3)
Local or National -- if national, do not edit!
"^DD",4,4,11,21,0)
^^17^17^3010104^^
"^DD",4,4,11,21,1,0)
An Institution has a STATUS (#11) of either LOCAL or NATIONAL.
"^DD",4,4,11,21,2,0)

"^DD",4,4,11,21,3,0)
Inactive facilities are flagged as such by the field INACTIVE
"^DD",4,4,11,21,4,0)
FACILITY FLAG (#101).
"^DD",4,4,11,21,5,0)

"^DD",4,4,11,21,6,0)
National entries are facilities that have a STATION NUMBER (#99)
"^DD",4,4,11,21,7,0)
approved by Information Management Service (045A4).  National
"^DD",4,4,11,21,8,0)
entries are maintained by the Master File Server located on FORUM.
"^DD",4,4,11,21,9,0)

"^DD",4,4,11,21,10,0)
Local entries are facilities that are entered locally.  Local
"^DD",4,4,11,21,11,0)
entries no not have a STATION NUMBER (#99).  (Only offically
"^DD",4,4,11,21,12,0)
approved station numbers are allowed in the STATION NUMBER (#99)
"^DD",4,4,11,21,13,0)
field.)
"^DD",4,4,11,21,14,0)

"^DD",4,4,11,21,15,0)
All national entries will have a STATUS (#11) of NATIONAL.  Do
"^DD",4,4,11,21,16,0)
not edit the STATUS (#11) of a national entry.  Do not set a LOCAL
"^DD",4,4,11,21,17,0)
entry to a STATUS (#11) of NATIONAL.
"^DD",4,4,11,23,0)
^^17^17^3010104^
"^DD",4,4,11,23,1,0)
An Institution has a STATUS (#11) of either LOCAL or NATIONAL.
"^DD",4,4,11,23,2,0)

"^DD",4,4,11,23,3,0)
Inactive facilities are flagged as such by the field INACTIVE
"^DD",4,4,11,23,4,0)
FACILITY FLAG (#101).
"^DD",4,4,11,23,5,0)

"^DD",4,4,11,23,6,0)
National entries are facilities that have a STATION NUMBER (#99)
"^DD",4,4,11,23,7,0)
approved by Information Management Service (045A4).  National
"^DD",4,4,11,23,8,0)
entries are maintained by the Master File Server located on FORUM.
"^DD",4,4,11,23,9,0)

"^DD",4,4,11,23,10,0)
Local entries are facilities that are entered locally.  Local
"^DD",4,4,11,23,11,0)
entries no not have a STATION NUMBER (#99).  (Only offically
"^DD",4,4,11,23,12,0)
approved station numbers are allowed in the STATION NUMBER (#99)
"^DD",4,4,11,23,13,0)
field.)
"^DD",4,4,11,23,14,0)

"^DD",4,4,11,23,15,0)
All national entries will have a STATUS (#11) of NATIONAL.  Do
"^DD",4,4,11,23,16,0)
not edit the STATUS (#11) of a national entry.  Do not set a LOCAL
"^DD",4,4,11,23,17,0)
entry to a STATUS (#11) of NATIONAL.
"^DD",4,4,11,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,11,"DT")
3010108
"^DD",4,4,13,0)
FACILITY TYPE^P4.1X^DIC(4.1,^3;1^Q:($G(XUMF)&($P($G(^DIC(4.1,+X,0)),U,4)="N"))  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,13,3)
Enter the facility type.
"^DD",4,4,13,21,0)
^^1^1^2920706^^
"^DD",4,4,13,21,1,0)
The type of facility. A replacement for the type field.
"^DD",4,4,13,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,13,"DT")
3040112
"^DD",4,4,14,0)
ASSOCIATIONS^4.014P^^7;0
"^DD",4,4,51,0)
ACOS HOSPITAL ID^F^^5;1^K:$L(X)>6!($L(X)<6)!'(X?6N) X
"^DD",4,4,51,.1)
American College of Surgeons Hospital ID
"^DD",4,4,51,3)
Please enter American College of Surgeons 6 digit ID number.
"^DD",4,4,51,21,0)
^^6^6^2920513^^
"^DD",4,4,51,21,1,0)
This field holds the six-digit code assigned to this facility by
"^DD",4,4,51,21,2,0)
the American College of Surgeons (ACOS) Commission on Cancer, the
"^DD",4,4,51,21,3,0)
organization that accredits a hospital's Cancer Program and Tumor
"^DD",4,4,51,21,4,0)
Registry.  A facility will only have an ACOS number if they have
"^DD",4,4,51,21,5,0)
requested a Cancer Program survey from the ACOS (not all facilities
"^DD",4,4,51,21,6,0)
will have a number).
"^DD",4,4,51,"DT")
2900306
"^DD",4,4,60,0)
DOMAIN^P4.2'^DIC(4.2,^6;1^Q
"^DD",4,4,60,3)
This allows a link from the institution file to the domain file.
"^DD",4,4,60,21,0)
^^1^1^2920513^^^
"^DD",4,4,60,21,1,0)
A pointer to the domain so the institution can be linked to a E-mail domain.
"^DD",4,4,60,"DT")
2900516
"^DD",4,4,95,0)
AGENCY CODE^S^V:VA;AF:AIR FORCE;I:IHS;ARMY:ARMY;N:NAVY;O:OTHER;^99;5^Q
"^DD",4,4,95,1,0)
^.1
"^DD",4,4,95,1,1,0)
^^TRIGGER^4^97
"^DD",4,4,95,1,1,1)
K DIV,Y S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:""),Y(2)=$P(Y(1),U,5),Y(3)=$P(Y(1),U,7) X ^DD(4,95,1,1,1.1) I X]"" S X=$O(^DIC(4.11,"B",X,0)) X ^DD(4,95,1,1,1.4)
"^DD",4,4,95,1,1,1.1)
S X=DIV S Y(5)=$C(59)_$S($D(^DD(4,95,0)):$P(^(0),U,3),1:""),X=$P($P(Y(5),$C(59)_DIV_":",2),$C(59),1),Y(4)=$S($D(^DIC(4.11,+Y(3),0)):^(0),1:"")
"^DD",4,4,95,1,1,1.4)
I Y(2)'=$P(Y(4),U,2) S DIU=Y(3),DIV=X,$P(^DIC(4,D0,99),U,7)=DIV,DIH=4,DIG=97 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,95,1,1,2)
Q  K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X="" S DIH=$S($D(^DIC(4,DIV(0),99)):^(99),1:""),DIV=X S $P(^(99),U,7)=DIV,DIH=4,DIG=97 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,95,1,1,3)
Link to keep fields 95 and 97 in sync. (Edited)
"^DD",4,4,95,1,1,"CREATE VALUE")
AGENCY CODE
"^DD",4,4,95,1,1,"DELETE VALUE")
NO EFFECT
"^DD",4,4,95,1,1,"FIELD")
POINTER TO AGENCY
"^DD",4,4,95,3)
What type of instution is this. Other for non-goverment.
"^DD",4,4,95,5,1,0)
4^97^1
"^DD",4,4,95,21,0)
^^2^2^2920513^^^
"^DD",4,4,95,21,1,0)
A code to identify the Government agency that this site belongs to.
"^DD",4,4,95,21,2,0)
This is a duplicate of the POINTER TO AGENCY field.
"^DD",4,4,95,"DT")
2900103
"^DD",4,4,96,0)
REPORTING STATION^*P4'^DIC(4,^99;6^S DIC("S")="I $S($D(^(99)):$P(^(99),U,1)?3N,1:0)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",4,4,96,3)
Enter the consolidating reporting station.  (must have a 3 digit station number)
"^DD",4,4,96,12)
Can only select instutions with a 3 numeric station number.
"^DD",4,4,96,12.1)
S DIC("S")="I $S($D(^(99)):$P(^(99),U,1)?3N,1:0)"
"^DD",4,4,96,21,0)
^^2^2^2920513^^^
"^DD",4,4,96,21,1,0)
This is a pointer back to the Institution file that indicates the
"^DD",4,4,96,21,2,0)
site that does the reporting to VACO.
"^DD",4,4,96,"DT")
2890726
"^DD",4,4,97,0)
POINTER TO AGENCY^RP4.11'^DIC(4.11,^99;7^Q
"^DD",4,4,97,1,0)
^.1
"^DD",4,4,97,1,1,0)
^^TRIGGER^4^95
"^DD",4,4,97,1,1,1)
X ^DD(4,97,1,1,1.3) I X,Y(3)]"" S X=Y(3) X ^DD(4,97,1,1,1.4)
"^DD",4,4,97,1,1,1.3)
K DIV,Y S DIV=X,D0=DA,DIV(0)=D0 S Y(0)=X X ^DD(4,97,1,1,69.2) S Y(3)=$P(Y(101),U,2),X=(Y(2)'=Y(3)) S D0=I(0,0)
"^DD",4,4,97,1,1,1.4)
S DIH=$S($D(^DIC(4,DIV(0),99)):^(99),1:""),DIV=X,DIU=$P(DIH,U,5) S $P(^(99),U,5)=DIV,DIH=4,DIG=95 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",4,4,97,1,1,2)
Q
"^DD",4,4,97,1,1,3)
Link to keep fields 95 and 97 in sync. (Edited)
"^DD",4,4,97,1,1,69.2)
S I(0,0)=$S($D(D0):D0,1:""),Y(1)=$S($D(^DIC(4,D0,99)):^(99),1:"") S X=$P(Y(1),U,5),X=X S X=X,Y(2)=X,D0=Y(0) S:'$D(^DIC(4.11,+D0,0)) D0=-1 S Y(101)=$S($D(^DIC(4.11,D0,0)):^(0),1:"")
"^DD",4,4,97,1,1,"CREATE CONDITION")
INTERNAL(AGENCY CODE)'=INTERNAL(POINTER TO AGENCY:AGENCY CODE)
"^DD",4,4,97,1,1,"CREATE VALUE")
INTERNAL(POINTER TO AGENCY:AGENCY CODE)
"^DD",4,4,97,1,1,"DELETE VALUE")
NO EFFECT
"^DD",4,4,97,1,1,"DT")
2900103
"^DD",4,4,97,1,1,"FIELD")
AGENCY CODE
"^DD",4,4,97,5,1,0)
4^95^1
"^DD",4,4,97,21,0)
^^2^2^2920513^^^
"^DD",4,4,97,21,1,0)
A pointer to a file that identifies the government agency that
"^DD",4,4,97,21,2,0)
this site belongs to.  Keep in sync with the Agency code field.
"^DD",4,4,97,"DT")
2900103
"^DD",4,4,99,0)
STATION NUMBER^FX^^99;1^K:$L(X)>7!($L(X)<3)!'(X?3N.AN) X Q:$G(XUMF)  K X
"^DD",4,4,99,1,0)
^.1
"^DD",4,4,99,1,1,0)
4^D^MUMPS
"^DD",4,4,99,1,1,1)
S ^DIC(4,"D",$E(X,1,30),DA)=""
"^DD",4,4,99,1,1,2)
K ^DIC(4,"D",$E(X,1,30),DA) S ^DIC(4,"AOLD99",DA,$E(X,1,30))=""
"^DD",4,4,99,1,1,"%D",0)
^^3^3^3010524^
"^DD",4,4,99,1,1,"%D",1,0)
The "AOLD99" x-ref (kill statement 0f "D" x-ref) is used by $$O99^XUAF4 to get
"^DD",4,4,99,1,1,"%D",2,0)
the pointer to the valid entry with station number for duplicate station
"^DD",4,4,99,1,1,"%D",3,0)
numbers resolved by the clean up (patch xu*8.0*126).
"^DD",4,4,99,1,1,"DT")
3000703
"^DD",4,4,99,3)
No local station numbers allowed!
"^DD",4,4,99,20,0)
^.3LA^1^1
"^DD",4,4,99,20,1,0)
RUPP
"^DD",4,4,99,21,0)
^^1^1^2920513^^
"^DD",4,4,99,21,1,0)
This is the 3 digit station number plus any modifiers.
"^DD",4,4,99,"DT")
3010518
"^DD",4,4,100,0)
OFFICIAL VA NAME^FX^^99;3^K:$L(X)>80!($L(X)<2) X K:($P($G(^DIC(4,+$G(DA),0)),U,11)="N")&'$G(XUMF) X
"^DD",4,4,100,1,0)
^.1
"^DD",4,4,100,1,1,0)
4^C
"^DD",4,4,100,1,1,1)
S ^DIC(4,"C",$E(X,1,30),DA)=""
"^DD",4,4,100,1,1,2)
K ^DIC(4,"C",$E(X,1,30),DA)
"^DD",4,4,100,1,1,"DT")
2960828
"^DD",4,4,100,3)
Enter the official VA name or name of the facility.
"^DD",4,4,100,21,0)
^^2^2^2960816^
"^DD",4,4,100,21,1,0)
This field holds the Offical VA name for this VA facility.
"^DD",4,4,100,21,2,0)
The value in this field should not be changed by the site.
"^DD",4,4,100,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,100,"DT")
3040112
"^DD",4,4,101,0)
INACTIVE FACILITY FLAG^SX^1:INACTIVE;^99;4^Q:$G(XUMF)  K:$P($G(^DIC(4,+DA,0)),U,11)="N" X
"^DD",4,4,101,3)
1 flags inactive entry.
"^DD",4,4,101,"DEL",11,0)
I ($P($G(^DIC(4,+$G(DA),0)),U,11)="N"&('$G(XUMF)))
"^DD",4,4,101,"DT")
3040112
"^DD",4,4,720,0)
CURRENT LOCATION^S^1:YES;0:NO;^EC;1^Q
"^DD",4,4,720,1,0)
^.1
"^DD",4,4,720,1,1,0)
4^LOC1^MUMPS
"^DD",4,4,720,1,1,1)
I X S ^DIC(4,"LOC",$P(^DIC(4,DA,0),"^"),DA)=""
"^DD",4,4,720,1,1,2)
K ^DIC(4,"LOC",$P(^DIC(4,DA,0),"^"),DA)
"^DD",4,4,720,1,1,"%D",0)
^^1^1^2960507^
"^DD",4,4,720,1,1,"%D",1,0)
Sets and kills the "LOC" nodes.
"^DD",4,4,720,1,1,"DT")
2960507
"^DD",4,4,720,3)
Entering a 1 for YES means ACTIVE, a 0 for NO means INACTIVE.
"^DD",4,4,720,21,0)
^^5^5^2960507^^^
"^DD",4,4,720,21,1,0)
This field flags entries for use in the Event Capture software.
"^DD",4,4,720,21,2,0)
  
"^DD",4,4,720,21,3,0)
       '1'  for   'YES'   (ACTIVE)
"^DD",4,4,720,21,4,0)
  
"^DD",4,4,720,21,5,0)
       '0'  for   'NO'    (INACTIVE)
"^DD",4,4,720,"DT")
2960507
"^DD",4,4,999.1,0)
HISTORY^4.999DA^^999;0
"^DD",4,4,9999,0)
IDENTIFIER^4.9999A^^9999;0
"^DD",4,4.014,0)
ASSOCIATIONS SUB-FIELD^^1^2
"^DD",4,4.014,0,"DT")
3040112
"^DD",4,4.014,0,"IX","B",4.014,.01)

"^DD",4,4.014,0,"NM","ASSOCIATIONS")

"^DD",4,4.014,0,"UP")
4
"^DD",4,4.014,.01,0)
ASSOCIATIONS^P4.05'X^DIC(4.05,^0;1^S DINUM=X
"^DD",4,4.014,.01,1,0)
^.1^^-1
"^DD",4,4.014,.01,1,1,0)
4.014^B
"^DD",4,4.014,.01,1,1,1)
S ^DIC(4,DA(1),7,"B",$E(X,1,30),DA)=""
"^DD",4,4.014,.01,1,1,2)
K ^DIC(4,DA(1),7,"B",$E(X,1,30),DA)
"^DD",4,4.014,.01,21,0)
^^2^2^2971021^
"^DD",4,4.014,.01,21,1,0)
This multiple field is used to link groups if Institutions into
"^DD",4,4.014,.01,21,2,0)
associations.
"^DD",4,4.014,.01,"DT")
2971203
"^DD",4,4.014,1,0)
PARENT OF ASSOCIATION^P4'^DIC(4,^0;2^Q
"^DD",4,4.014,1,1,0)
^.1
"^DD",4,4.014,1,1,1,0)
4^AC^MUMPS
"^DD",4,4.014,1,1,1,1)
S ^DIC(4,"AC",DA,X,DA(1))=""
"^DD",4,4.014,1,1,1,2)
K ^DIC(4,"AC",DA,X,DA(1))
"^DD",4,4.014,1,1,1,3)
This is needed by CIRN
"^DD",4,4.014,1,1,1,"%D",0)
^^2^2^2971021^
"^DD",4,4.014,1,1,1,"%D",1,0)
This X-ref is used to find the children of a patent for an Association
"^DD",4,4.014,1,1,1,"%D",2,0)
type.
"^DD",4,4.014,1,1,1,"DT")
2971021
"^DD",4,4.014,1,21,0)
^^2^2^2971021^^
"^DD",4,4.014,1,21,1,0)
This field points back to the Institution file to indicate the
"^DD",4,4.014,1,21,2,0)
parent of the association.
"^DD",4,4.014,1,"DT")
3040112
"^DD",4,4.03,0)
CONTACT SUB-FIELD^NL^.03^3
"^DD",4,4.03,0,"NM","CONTACT")

"^DD",4,4.03,0,"UP")
4
"^DD",4,4.03,.01,0)
CONTACT^MF^^0;1^K:$L(X)>30!($L(X)<2) X
"^DD",4,4.03,.01,3)
ANSWER MUST BE 2-30 CHARACTERS IN LENGTH
"^DD",4,4.03,.01,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.01,21,1,0)
The name of a contact at the site.
"^DD",4,4.03,.02,0)
AREA^P44'^SC(^0;2^Q
"^DD",4,4.03,.02,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.02,21,1,0)
Pointer to the part of the site the contact works in.
"^DD",4,4.03,.03,0)
PHONE #^F^^0;3^K:$L(X)>30!($L(X)<2) X
"^DD",4,4.03,.03,3)
ANSWER MUST BE 2-30 CHARACTERS IN LENGTH
"^DD",4,4.03,.03,21,0)
^^1^1^2920528^^^^
"^DD",4,4.03,.03,21,1,0)
Telephone number.
"^DD",4,4.999,0)
HISTORY SUB-FIELD^^.08^7
"^DD",4,4.999,0,"DT")
3000606
"^DD",4,4.999,0,"IX","B",4.999,.01)

"^DD",4,4.999,0,"NM","HISTORY")

"^DD",4,4.999,0,"UP")
4
"^DD",4,4.999,.01,0)
EFFECTIVE DATE^DX^^0;1^S %DT="EX" D ^%DT S X=Y K:X<1 X S DINUM=X
"^DD",4,4.999,.01,1,0)
^.1
"^DD",4,4.999,.01,1,1,0)
4.999^B
"^DD",4,4.999,.01,1,1,1)
S ^DIC(4,DA(1),999,"B",$E(X,1,30),DA)=""
"^DD",4,4.999,.01,1,1,2)
K ^DIC(4,DA(1),999,"B",$E(X,1,30),DA)
"^DD",4,4.999,.01,3)
The effective date of the change.
"^DD",4,4.999,.01,"DT")
3000605
"^DD",4,4.999,.02,0)
NAME (CHANGED FROM)^F^^0;2^K:$L(X)>30!($L(X)<3) X
"^DD",4,4.999,.02,1,0)
^.1
"^DD",4,4.999,.02,1,1,0)
4^OLDNAM
"^DD",4,4.999,.02,1,1,1)
S ^DIC(4,"OLDNAM",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.02,1,1,2)
K ^DIC(4,"OLDNAM",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.02,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.02,1,1,"%D",1,0)
This x-ref stores the old name.
"^DD",4,4.999,.02,1,1,"DT")
3000721
"^DD",4,4.999,.02,3)
If NAME changed, this field holds old value.
"^DD",4,4.999,.02,"DT")
3000721
"^DD",4,4.999,.03,0)
OFFICAL VA NAME (CHANGED FROM)^F^^0;3^K:$L(X)>80!($L(X)<3) X
"^DD",4,4.999,.03,3)
If OFFICAL VA NAME changed, this field holds old value.
"^DD",4,4.999,.03,"DT")
3000606
"^DD",4,4.999,.05,0)
REALIGNED TO^P4'^DIC(4,^0;5^Q
"^DD",4,4.999,.05,1,0)
^.1
"^DD",4,4.999,.05,1,1,0)
4^ART
"^DD",4,4.999,.05,1,1,1)
S ^DIC(4,"ART",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.05,1,1,2)
K ^DIC(4,"ART",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.05,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.05,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.05,1,1,"DT")
3000612
"^DD",4,4.999,.05,1,2,0)
4^ARTO^MUMPS
"^DD",4,4.999,.05,1,2,1)
S ^DIC(4,"ARTO",DA(1),X)=""
"^DD",4,4.999,.05,1,2,2)
K ^DIC(4,"ARTO",DA(1),X)
"^DD",4,4.999,.05,1,2,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.05,1,2,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.05,1,2,"DT")
3000612
"^DD",4,4.999,.05,3)
This field points to the new entry with valid station number.\]
"^DD",4,4.999,.05,"DT")
3000612
"^DD",4,4.999,.06,0)
REALIGNED FROM^P4'^DIC(4,^0;6^Q
"^DD",4,4.999,.06,1,0)
^.1
"^DD",4,4.999,.06,1,1,0)
4^ARF
"^DD",4,4.999,.06,1,1,1)
S ^DIC(4,"ARF",$E(X,1,30),DA(1),DA)=""
"^DD",4,4.999,.06,1,1,2)
K ^DIC(4,"ARF",$E(X,1,30),DA(1),DA)
"^DD",4,4.999,.06,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.06,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.06,1,1,"DT")
3000612
"^DD",4,4.999,.06,1,2,0)
4^ARFM^MUMPS
"^DD",4,4.999,.06,1,2,1)
S ^DIC(4,"ARFM",DA(1),X)=""
"^DD",4,4.999,.06,1,2,2)
K ^DIC(4,"ARFM",DA(1),X)
"^DD",4,4.999,.06,1,2,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.06,1,2,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.06,1,2,"DT")
3000612
"^DD",4,4.999,.06,3)
This field points to the old entry/sta# for this facility.
"^DD",4,4.999,.06,"DT")
3000612
"^DD",4,4.999,.07,0)
DEACTIVATED FACILITY / STA #^S^1:DEACTIVATED;^0;7^Q
"^DD",4,4.999,.07,1,0)
^.1
"^DD",4,4.999,.07,1,1,0)
4^AI^MUMPS
"^DD",4,4.999,.07,1,1,1)
S ^DIC(4,"AI",DA(1),DA)=""
"^DD",4,4.999,.07,1,1,2)
K ^DIC(4,"AI",DA(1),DA)
"^DD",4,4.999,.07,1,1,"%D",0)
^^1^1^3010524^
"^DD",4,4.999,.07,1,1,"%D",1,0)
This x-ref used by F4^XUAF4 API.
"^DD",4,4.999,.07,1,1,"DT")
3000613
"^DD",4,4.999,.07,3)
Flags deactivated facilities and/or station numbers.
"^DD",4,4.999,.07,"DT")
3000613
"^DD",4,4.999,.08,0)
ACTIVATED FACILITY^S^1:ACTIVATED;^0;8^Q
"^DD",4,4.999,.08,3)
Flags activated facilities for EFFECTIVE DATE.
"^DD",4,4.999,.08,"DT")
3000606
"^DD",4,4.9999,0)
IDENTIFIER SUB-FIELD^^.02^2
"^DD",4,4.9999,0,"DT")
3020212
"^DD",4,4.9999,0,"IX","B",4.9999,.01)

"^DD",4,4.9999,0,"NM","IDENTIFIER")

"^DD",4,4.9999,0,"UP")
4
"^DD",4,4.9999,.01,0)
CODING SYSTEM^FX^^0;1^K:$L(X)>20!($L(X)<2) X K:($P($G(^DIC(4,+$G(DA(1)),0)),U,11)="N")&'$G(XUMF) X
"^DD",4,4.9999,.01,1,0)
^.1
"^DD",4,4.9999,.01,1,1,0)
4.9999^B
"^DD",4,4.9999,.01,1,1,1)
S ^DIC(4,DA(1),9999,"B",$E(X,1,30),DA)=""
"^DD",4,4.9999,.01,1,1,2)
K ^DIC(4,DA(1),9999,"B",$E(X,1,30),DA)
"^DD",4,4.9999,.01,3)
Answer must be 2-20 characters in length
"^DD",4,4.9999,.01,"DT")
3030203
"^DD",4,4.9999,.02,0)
ID^FX^^0;2^K:$L(X)>20!($L(X)<2) X K:($P($G(^DIC(4,+$G(DA(1)),0)),U,11)="N")&'$G(XUMF) X
"^DD",4,4.9999,.02,1,0)
^.1^^0
"^DD",4,4.9999,.02,1,1,0)
4^AXUMFID^MUMPS
"^DD",4,4.9999,.02,1,1,1)
S ^DIC(4,"A XUMF ID",$P(^DIC(4,DA(1),9999,DA,0),U),X,DA(1))=""
"^DD",4,4.9999,.02,1,1,2)
K ^DIC(4,"A XUMF ID",$P(^DIC(4,DA(1),9999,DA,0),U),X,DA(1))
"^DD",4,4.9999,.02,1,1,"DT")
3020212
"^DD",4,4.9999,.02,1,2,0)
4^AXUMFIEN^MUMPS
"^DD",4,4.9999,.02,1,2,1)
S ^DIC(4,"A XUMF IEN",$P(^DIC(4,DA(1),9999,DA,0),U),DA(1),X)=""
"^DD",4,4.9999,.02,1,2,2)
K ^DIC(4,"A XUMF IEN",$P(^DIC(4,DA(1),9999,DA,0),U),DA(1),X)
"^DD",4,4.9999,.02,1,2,"DT")
3020213
"^DD",4,4.9999,.02,3)
Answer must be 2-20 characters in length
"^DD",4,4.9999,.02,"DT")
3030203
"^DD",4.1,4.1,0)
FIELD^^3^4
"^DD",4.1,4.1,0,"DDA")
N
"^DD",4.1,4.1,0,"DT")
3000626
"^DD",4.1,4.1,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",4.1,4.1,0,"IX","B",4.1,.01)

"^DD",4.1,4.1,0,"IX","C",4.1,1)

"^DD",4.1,4.1,0,"IX","XUMF",4.1,3)

"^DD",4.1,4.1,0,"NM","FACILITY TYPE")

"^DD",4.1,4.1,0,"PT",4,13)

"^DD",4.1,4.1,0,"VRPK")
XU
"^DD",4.1,4.1,.01,0)
NAME^RF^^0;1^K:$L(X)>11!($L(X)<1)!'(X'?1P.E) X
"^DD",4.1,4.1,.01,.1)
Type Code
"^DD",4.1,4.1,.01,1,0)
^.1
"^DD",4.1,4.1,.01,1,1,0)
4.1^B
"^DD",4.1,4.1,.01,1,1,1)
S ^DIC(4.1,"B",$E(X,1,30),DA)=""
"^DD",4.1,4.1,.01,1,1,2)
K ^DIC(4.1,"B",$E(X,1,30),DA)
"^DD",4.1,4.1,.01,3)
Answer must be 1-11 characters in length.
"^DD",4.1,4.1,.01,21,0)
^^1^1^2980723^^^
"^DD",4.1,4.1,.01,21,1,0)
This is the Facility type code.
"^DD",4.1,4.1,.01,"DT")
2890502
"^DD",4.1,4.1,1,0)
FULL NAME^F^^0;2^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>45!($L(X)<3) X
"^DD",4.1,4.1,1,1,0)
^.1
"^DD",4.1,4.1,1,1,1,0)
4.1^C
"^DD",4.1,4.1,1,1,1,1)
S ^DIC(4.1,"C",$E(X,1,30),DA)=""
"^DD",4.1,4.1,1,1,1,2)
K ^DIC(4.1,"C",$E(X,1,30),DA)
"^DD",4.1,4.1,1,3)
Answer must be 3-45 characters in length.
"^DD",4.1,4.1,1,21,0)
^^1^1^2920518^^
"^DD",4.1,4.1,1,21,1,0)
This is the full name of the facility type code.
"^DD",4.1,4.1,2,0)
TITLE^F^^0;3^K:$L(X)>45!($L(X)<3) X
"^DD",4.1,4.1,2,3)
Answer must be 3-45 characters in length.
"^DD",4.1,4.1,2,21,0)
^^1^1^2920518^^^
"^DD",4.1,4.1,2,21,1,0)
Reserved
"^DD",4.1,4.1,2,"DT")
2890502
"^DD",4.1,4.1,3,0)
STATUS^S^N:NATIONAL;L:LOCAL;^0;4^Q
"^DD",4.1,4.1,3,1,0)
^.1
"^DD",4.1,4.1,3,1,1,0)
4.1^XUMF
"^DD",4.1,4.1,3,1,1,1)
S ^DIC(4.1,"XUMF",$E(X,1,30),DA)=""
"^DD",4.1,4.1,3,1,1,2)
K ^DIC(4.1,"XUMF",$E(X,1,30),DA)
"^DD",4.1,4.1,3,1,1,"DT")
3000626
"^DD",4.1,4.1,3,3)
Local or National -- if national, do not edit!
"^DD",4.1,4.1,3,21,0)
^^3^3^3031223^
"^DD",4.1,4.1,3,21,1,0)
This field flags an entry as national.  National entries can not
"^DD",4.1,4.1,3,21,2,0)
be modified locally.  National Institutions will only point to
"^DD",4.1,4.1,3,21,3,0)
National facility types.
"^DD",4.1,4.1,3,"DT")
3010104
"^DIC",4,4,0)
INSTITUTION^4Is
"^DIC",4,4,0,"GL")
^DIC(4,
"^DIC",4,4,"%",0)
^1.005^2^2
"^DIC",4,4,"%",1,0)
XU
"^DIC",4,4,"%",2,0)
QAP
"^DIC",4,4,"%","B","QAP",2)

"^DIC",4,4,"%","B","XU",1)

"^DIC",4,4,"%D",0)
^^3^3^2950306^^^^
"^DIC",4,4,"%D",1,0)
This file contains a listing of VA institutions.  It is cross-referenced
"^DIC",4,4,"%D",2,0)
by name and station number.  The Number field is no longer meaningful (it
"^DIC",4,4,"%D",3,0)
had previously referenced the station number).
"^DIC",4,"B","INSTITUTION",4)

"^DIC",4.1,4.1,0)
FACILITY TYPE^4.1IA
"^DIC",4.1,4.1,0,"GL")
^DIC(4.1,
"^DIC",4.1,4.1,"%",0)
^1.005^1^1
"^DIC",4.1,4.1,"%",1,0)
XU
"^DIC",4.1,4.1,"%","B","XU",1)

"^DIC",4.1,4.1,"%D",0)
^^5^5^2950306^^^
"^DIC",4.1,4.1,"%D",1,0)
This file is pointed to by the Institution File.  It containes a list
"^DIC",4.1,4.1,"%D",2,0)
of facility codes that had previously been stored in the VA Type Code
"^DIC",4.1,4.1,"%D",3,0)
field of the Institution File.  This file is distributed with data,
"^DIC",4.1,4.1,"%D",4,0)
and the new data should overwrite the old. It is cross-referenced by name
"^DIC",4.1,4.1,"%D",5,0)
and full name.
"^DIC",4.1,"B","FACILITY TYPE",4.1)

**END**
**END**
