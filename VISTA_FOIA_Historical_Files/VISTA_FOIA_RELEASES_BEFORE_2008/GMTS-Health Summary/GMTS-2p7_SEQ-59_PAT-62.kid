Released GMTS*2.7*62 SEQ #59
Extracted from mail message
**KIDS**:GMTS*2.7*62^

**INSTALL NAME**
GMTS*2.7*62
"BLD",4162,0)
GMTS*2.7*62^HEALTH SUMMARY^0^3030917^y
"BLD",4162,1,0)
^^2^2^3030321^^
"BLD",4162,1,1,0)
The description of this build is found in the National Patch Module under 
"BLD",4162,1,2,0)
patch GMTS*2.7*62.
"BLD",4162,4,0)
^9.64PA^^
"BLD",4162,"KRN",0)
^9.67PA^8989.52^19
"BLD",4162,"KRN",.4,0)
.4
"BLD",4162,"KRN",.401,0)
.401
"BLD",4162,"KRN",.402,0)
.402
"BLD",4162,"KRN",.403,0)
.403
"BLD",4162,"KRN",.5,0)
.5
"BLD",4162,"KRN",.84,0)
.84
"BLD",4162,"KRN",3.6,0)
3.6
"BLD",4162,"KRN",3.8,0)
3.8
"BLD",4162,"KRN",9.2,0)
9.2
"BLD",4162,"KRN",9.8,0)
9.8
"BLD",4162,"KRN",9.8,"NM",0)
^9.68A^15^15
"BLD",4162,"KRN",9.8,"NM",1,0)
GMTSPSI5^^0^B6364954
"BLD",4162,"KRN",9.8,"NM",2,0)
GMTSMCMA^^0^B28652800
"BLD",4162,"KRN",9.8,"NM",3,0)
GMTS2^^0^B4297521
"BLD",4162,"KRN",9.8,"NM",4,0)
GMTSPXFP^^0^B7572115
"BLD",4162,"KRN",9.8,"NM",5,0)
GMTSRS^^0^B45492007
"BLD",4162,"KRN",9.8,"NM",6,0)
GMTSRS1^^0^B36733601
"BLD",4162,"KRN",9.8,"NM",7,0)
GMTSRS1B^^0^B8179439
"BLD",4162,"KRN",9.8,"NM",8,0)
GMTSRS2^^0^B77552907
"BLD",4162,"KRN",9.8,"NM",9,0)
GMTSRS2B^^0^B4943402
"BLD",4162,"KRN",9.8,"NM",10,0)
GMTSRS3^^0^B6644294
"BLD",4162,"KRN",9.8,"NM",11,0)
GMTSRM1^^0^B22624208
"BLD",4162,"KRN",9.8,"NM",12,0)
GMTSRM3^^0^B23535059
"BLD",4162,"KRN",9.8,"NM",13,0)
GMTSRS4^^0^B7862389
"BLD",4162,"KRN",9.8,"NM",14,0)
GMTSXAR^^0^B77484842
"BLD",4162,"KRN",9.8,"NM",15,0)
GMTSDEM2^^0^B45958396
"BLD",4162,"KRN",9.8,"NM","B","GMTS2",3)

"BLD",4162,"KRN",9.8,"NM","B","GMTSDEM2",15)

"BLD",4162,"KRN",9.8,"NM","B","GMTSMCMA",2)

"BLD",4162,"KRN",9.8,"NM","B","GMTSPSI5",1)

"BLD",4162,"KRN",9.8,"NM","B","GMTSPXFP",4)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRM1",11)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRM3",12)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRS",5)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRS1",6)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRS1B",7)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRS2",8)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRS2B",9)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRS3",10)

"BLD",4162,"KRN",9.8,"NM","B","GMTSRS4",13)

"BLD",4162,"KRN",9.8,"NM","B","GMTSXAR",14)

"BLD",4162,"KRN",19,0)
19
"BLD",4162,"KRN",19.1,0)
19.1
"BLD",4162,"KRN",101,0)
101
"BLD",4162,"KRN",409.61,0)
409.61
"BLD",4162,"KRN",771,0)
771
"BLD",4162,"KRN",870,0)
870
"BLD",4162,"KRN",8989.51,0)
8989.51
"BLD",4162,"KRN",8989.52,0)
8989.52
"BLD",4162,"KRN",8994,0)
8994
"BLD",4162,"KRN","B",.4,.4)

"BLD",4162,"KRN","B",.401,.401)

"BLD",4162,"KRN","B",.402,.402)

"BLD",4162,"KRN","B",.403,.403)

"BLD",4162,"KRN","B",.5,.5)

"BLD",4162,"KRN","B",.84,.84)

"BLD",4162,"KRN","B",3.6,3.6)

"BLD",4162,"KRN","B",3.8,3.8)

"BLD",4162,"KRN","B",9.2,9.2)

"BLD",4162,"KRN","B",9.8,9.8)

"BLD",4162,"KRN","B",19,19)

"BLD",4162,"KRN","B",19.1,19.1)

"BLD",4162,"KRN","B",101,101)

"BLD",4162,"KRN","B",409.61,409.61)

"BLD",4162,"KRN","B",771,771)

"BLD",4162,"KRN","B",870,870)

"BLD",4162,"KRN","B",8989.51,8989.51)

"BLD",4162,"KRN","B",8989.52,8989.52)

"BLD",4162,"KRN","B",8994,8994)

"BLD",4162,"QUES",0)
^9.62^^
"BLD",4162,"REQB",0)
^9.611^3^3
"BLD",4162,"REQB",1,0)
GMTS*2.7*37^2
"BLD",4162,"REQB",2,0)
GMTS*2.7*60^2
"BLD",4162,"REQB",3,0)
GMTS*2.7*61^2
"BLD",4162,"REQB","B","GMTS*2.7*37",1)

"BLD",4162,"REQB","B","GMTS*2.7*60",2)

"BLD",4162,"REQB","B","GMTS*2.7*61",3)

"MBREQ")
0
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools^^^3010208
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2951020^11
"PKG",126,22,1,"PAH",1,0)
62^3030917
"PKG",126,22,1,"PAH",1,1,0)
^^2^2^3030917
"PKG",126,22,1,"PAH",1,1,1,0)
The description of this build is found in the National Patch Module under 
"PKG",126,22,1,"PAH",1,1,2,0)
patch GMTS*2.7*62.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","GMTS2")
0^3^B4297521
"RTN","GMTS2",1,0)
GMTS2 ;SLC/SBW - Health Summary Driver Cont. ; 02/11/2003
"RTN","GMTS2",2,0)
 ;;2.7;Health Summary;**2,58,62**;Oct 20, 1995
"RTN","GMTS2",3,0)
 ;
"RTN","GMTS2",4,0)
TDISBLD ; Temporarily Disabled Components
"RTN","GMTS2",5,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Temporarily disabled",!
"RTN","GMTS2",6,0)
 I GMOOTXT]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W GMOOTXT,!
"RTN","GMTS2",7,0)
 Q
"RTN","GMTS2",8,0)
PDISBLD ; Permanently Disabled Components
"RTN","GMTS2",9,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Permanently disabled",!
"RTN","GMTS2",10,0)
 I GMOOTXT]"" D CKP^GMTSUP Q:$D(GMTSQIT)  W GMOOTXT,!
"RTN","GMTS2",11,0)
 Q
"RTN","GMTS2",12,0)
NOMATCH ; User doesn't hold Security Key
"RTN","GMTS2",13,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTS2",14,0)
 W "This component is locked with security key "_GMTSLOCK_".",!
"RTN","GMTS2",15,0)
 Q
"RTN","GMTS2",16,0)
NOSELECT ; No Selection Items
"RTN","GMTS2",17,0)
 ;   Handles cases where components that require
"RTN","GMTS2",18,0)
 ;   selection items have no selection items defined.
"RTN","GMTS2",19,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTS2",20,0)
 W "No selection items chosen for this component.",!
"RTN","GMTS2",21,0)
 Q
"RTN","GMTS2",22,0)
NODATA ; No Data
"RTN","GMTS2",23,0)
 ;  This will display "No Data Available" for commponents
"RTN","GMTS2",24,0)
 ;  components that retrieve no data.
"RTN","GMTS2",25,0)
 N SELNAME I $D(GMTSQIT),(GMTSQIT="") Q
"RTN","GMTS2",26,0)
 Q:GMTSWRIT=0  I $G(GMSUPRES)="Y" K:$D(GMTSOBJ) GMTSEG(+($G(GMTSEGN)))
"RTN","GMTS2",27,0)
 I $E(IOST,1)'="C" Q:$G(GMSUPRES)="Y"
"RTN","GMTS2",28,0)
 I GMSEL]"" D GETSEL,DISPSEL Q
"RTN","GMTS2",29,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:'$D(GMTSOBJ) !
"RTN","GMTS2",30,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "  No data available",!
"RTN","GMTS2",31,0)
 Q
"RTN","GMTS2",32,0)
GETSEL ; Get Selection Items
"RTN","GMTS2",33,0)
 N GMX,GMI,GMDA,GMFROOT,GMROOT,GMNODE
"RTN","GMTS2",34,0)
 S GMFROOT=$G(GMTSEG(GMTSEGN,GMSEL,0))
"RTN","GMTS2",35,0)
 Q:GMFROOT=""
"RTN","GMTS2",36,0)
 S (GMX,GMI)=0
"RTN","GMTS2",37,0)
 F  S GMI=$O(GMTSEG(GMTSEGN,GMSEL,GMI)) Q:GMI'>0  D
"RTN","GMTS2",38,0)
 . S GMDA=$G(GMTSEG(GMTSEGN,GMSEL,GMI))
"RTN","GMTS2",39,0)
 . S GMROOT=GMFROOT_GMDA_",0)"
"RTN","GMTS2",40,0)
 . S GMNODE=$G(@GMROOT)
"RTN","GMTS2",41,0)
 . I GMDA]"",GMROOT]"" S GMX=GMX+1,SELNAME(GMX)=$P(GMNODE,U)
"RTN","GMTS2",42,0)
 Q
"RTN","GMTS2",43,0)
DISPSEL ; Display selection items
"RTN","GMTS2",44,0)
 N GMI,GMX
"RTN","GMTS2",45,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "  No data available for "
"RTN","GMTS2",46,0)
 S (GMI,GMX)=0
"RTN","GMTS2",47,0)
 F  S GMI=$O(SELNAME(GMI)) Q:GMI'>0  D
"RTN","GMTS2",48,0)
 . S GMX=GMX+1
"RTN","GMTS2",49,0)
 . W:GMX>1 "; "
"RTN","GMTS2",50,0)
 . W:(77)'>($X+$L(SELNAME(GMI))) !
"RTN","GMTS2",51,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W SELNAME(GMI)
"RTN","GMTS2",52,0)
 W !
"RTN","GMTS2",53,0)
 Q
"RTN","GMTSDEM2")
0^15^B45958396
"RTN","GMTSDEM2",1,0)
GMTSDEM2 ; SLC/DLT,KER - Demographics (cont) ; 12/11/2002 [9/16/03 7:29am]
"RTN","GMTSDEM2",2,0)
 ;;2.7;Health Summary;**56,58,60,62**;Oct 20, 1995
"RTN","GMTSDEM2",3,0)
 ;                 
"RTN","GMTSDEM2",4,0)
 ; External References
"RTN","GMTSDEM2",5,0)
 ;   DBIA 10061  OAD^VADPT
"RTN","GMTSDEM2",6,0)
 ;   DBIA 10061  DEM^VADPT
"RTN","GMTSDEM2",7,0)
 ;   DBIA   951  ^IBE(355.1
"RTN","GMTSDEM2",8,0)
 ;   DBIA   794  ^DIC(36
"RTN","GMTSDEM2",9,0)
 ;   DBIA  2056  $$GET1^DIQ (file #36, and #355.1)
"RTN","GMTSDEM2",10,0)
 ;   DBIA 10145  ALL^IBCNS1  
"RTN","GMTSDEM2",11,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSDEM2",12,0)
 ;                     
"RTN","GMTSDEM2",13,0)
NOKC ; Next of Kin Component
"RTN","GMTSDEM2",14,0)
 N GMTSNOK S GMTSNOK="" D NOK Q
"RTN","GMTSDEM2",15,0)
NOK ; Next of Kin
"RTN","GMTSDEM2",16,0)
 Q:$D(GMTSQIT)  N %,%H,STR,STR1,STR2,NOKTYPE,ADR,VAERR,VAOA K VAOA("A") D OAD^VADPT
"RTN","GMTSDEM2",17,0)
 I $L($G(VAOA(9))) D
"RTN","GMTSDEM2",18,0)
 . ;   Primary Next of Kin
"RTN","GMTSDEM2",19,0)
 . S NOKTYPE="Primary" D DNOK
"RTN","GMTSDEM2",20,0)
 . S VAOA("A")=3 D OAD^VADPT
"RTN","GMTSDEM2",21,0)
 . I $L($G(VAOA(9))) D
"RTN","GMTSDEM2",22,0)
 . . ;   Secondary Next of Kin
"RTN","GMTSDEM2",23,0)
 . . K GMTSNOK S NOKTYPE="Secondary" D DNOK
"RTN","GMTSDEM2",24,0)
 Q
"RTN","GMTSDEM2",25,0)
DNOK ;   Display Next of Kin
"RTN","GMTSDEM2",26,0)
 D:'$D(GMTSNOK) WRT^GMTSDEM("",,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",27,0)
 S STR1=$$UP^XLFSTR(VAOA(9)),STR2=$S('$L(VAOA(10)):"<not given>",1:$$UP^XLFSTR(VAOA(10)))
"RTN","GMTSDEM2",28,0)
 D WRT^GMTSDEM(($G(NOKTYPE)_" NOK"),STR1,"Relation",STR2,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",29,0)
 S ADR=$G(VAOA(1)) K VAOA(1) I '$L(ADR) S ADR=$G(VAOA(2)) K VAOA(2) I '$L(ADR) S ADR=$G(VAOA(3)) K VAOA(3)
"RTN","GMTSDEM2",30,0)
 S STR=$S('$L(ADR):"<street address not available>",1:$$UP^XLFSTR(ADR))
"RTN","GMTSDEM2",31,0)
 K:STR="<street address not available>" VAOA(1),VAOA(2),VAOA(3)
"RTN","GMTSDEM2",32,0)
 D WRT^GMTSDEM("",STR,"Phone",VAOA(8),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",33,0)
 S ADR=$G(VAOA(2)) K VAOA(2) I '$L(ADR) S ADR=$G(VAOA(3)) K VAOA(3)
"RTN","GMTSDEM2",34,0)
 S STR=$$UP^XLFSTR(ADR) D:$L(STR) WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",35,0)
 S ADR=$G(VAOA(3))
"RTN","GMTSDEM2",36,0)
 S STR=$$UP^XLFSTR(ADR) D:$L(STR) WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",37,0)
 I VAOA(4)'="" D
"RTN","GMTSDEM2",38,0)
 . S STR=$$UP^XLFSTR(VAOA(4)) S:VAOA(5) STR=STR_", "_$$UP^XLFSTR($P(VAOA(5),U,2)) S:VAOA(6) STR=STR_"  "_$$UP^XLFSTR(VAOA(6))
"RTN","GMTSDEM2",39,0)
 . D WRT^GMTSDEM("",STR,,,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",40,0)
 Q
"RTN","GMTSDEM2",41,0)
 ;                
"RTN","GMTSDEM2",42,0)
INS ; Insurance Info
"RTN","GMTSDEM2",43,0)
 N I,INSURE,GMTSX,IEN,VAL,CLAIM,COMPANY,TYPE,COB,SUBSCRIB,GROUP,HOLDER,EFFECT,EXPIRE
"RTN","GMTSDEM2",44,0)
 D ALL^IBCNS1(DFN,"INSURE") Q:$O(INSURE(0))=""
"RTN","GMTSDEM2",45,0)
 S I=0 F  S I=$O(INSURE(I)) Q:'I  D   Q:$D(GMTSQIT)
"RTN","GMTSDEM2",46,0)
 . S (COMPANY,TYPE,GROUP,HOLDER,EFFECT,EXPIRE)=""
"RTN","GMTSDEM2",47,0)
 . S GMTSX=INSURE(I,0),IEN=+GMTSX
"RTN","GMTSDEM2",48,0)
 . ;   Insurance Company
"RTN","GMTSDEM2",49,0)
 . S COMPANY=$$GET1^DIQ(36,(+IEN_","),.01) Q:'$L(COMPANY)
"RTN","GMTSDEM2",50,0)
 . S CLAIM=INSURE(I,355.3)
"RTN","GMTSDEM2",51,0)
 . ;   Policy Type
"RTN","GMTSDEM2",52,0)
 . S IEN=$P(CLAIM,"^",9)
"RTN","GMTSDEM2",53,0)
 . S TYPE="" I IEN]"" D
"RTN","GMTSDEM2",54,0)
 . . S TYPE=$$GET1^DIQ(355.1,(+IEN_","),.01) S TYPE=$$ABR(TYPE)
"RTN","GMTSDEM2",55,0)
 . ;   Group Number
"RTN","GMTSDEM2",56,0)
 . S GROUP=$P(CLAIM,"^",4)
"RTN","GMTSDEM2",57,0)
 . S GMTSX=INSURE(I,0),VAL=$P(GMTSX,"^",6)
"RTN","GMTSDEM2",58,0)
 . ;   Insurance Policy Holder
"RTN","GMTSDEM2",59,0)
 . S HOLDER=$S(VAL="v":"SELF",VAL="s":"SPOUSE",1:"OTHER")
"RTN","GMTSDEM2",60,0)
 . ;   Insurance Effect Date
"RTN","GMTSDEM2",61,0)
 . S EFFECT=$P(GMTSX,"^",8)
"RTN","GMTSDEM2",62,0)
 . ;   Insurance Expiration Date
"RTN","GMTSDEM2",63,0)
 . S EXPIRE=$P(GMTSX,"^",4)
"RTN","GMTSDEM2",64,0)
 . ;   Subscriber ID
"RTN","GMTSDEM2",65,0)
 . S SUBSCRIB=$P($G(INSURE(I,0)),"^",2)
"RTN","GMTSDEM2",66,0)
 . ;   Coordination of Benefits
"RTN","GMTSDEM2",67,0)
 . S COB=+($P($G(INSURE(I,0)),"^",20))
"RTN","GMTSDEM2",68,0)
 . S COB=$S(COB=1:"PRIMARY",COB=2:"SECONDARY",COB=3:"TERTIARY",1:"UNKNOWN")
"RTN","GMTSDEM2",69,0)
 . Q:$D(GMTSQIT)  D WRT^GMTSDEM("",,,,0) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",70,0)
 . D WRT^GMTSDEM("Insurance Company",$E(COMPANY,1,27),"Holder",HOLDER,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",71,0)
 . I $L(TYPE)!($L(EFFECT)) D WRT^GMTSDEM("Policy Type",$E(TYPE,1,28),"Effective",$$EDT^GMTSU(EFFECT),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",72,0)
 . I $L(GROUP)!($L(EXPIRE)) D WRT^GMTSDEM("Group #",$E(GROUP,1,28),"Expires",$$EDT^GMTSU(EXPIRE),1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",73,0)
 . I $L(SUBSCRIB)!($L(COB)) D WRT^GMTSDEM("Subscriber ID",$E(SUBSCRIB,1,28),"Coord. of Benefits",COB,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",74,0)
 Q
"RTN","GMTSDEM2",75,0)
 ;          
"RTN","GMTSDEM2",76,0)
RACE ; Race and Ethnicity
"RTN","GMTSDEM2",77,0)
 N GMTS D ER(+($G(DFN)),.GMTS) I $L($G(GMTS(2)))!($L($G(GMTS(6)))) D  Q
"RTN","GMTSDEM2",78,0)
 . N GMTSD,GMTSI,GMTSC
"RTN","GMTSDEM2",79,0)
 . S (GMTSI,GMTSC)=0 F GMTSI=1:1 Q:'$L($P($G(GMTS(6)),"^",GMTSI))  D  Q:$D(GMTSQIT)
"RTN","GMTSDEM2",80,0)
 . . S GMTSD=$P($G(GMTS(6)),"^",GMTSI),GMTSC=GMTSC+1
"RTN","GMTSDEM2",81,0)
 . . D:+GMTSC=1 WRT^GMTSDEM("Ethnicity",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",82,0)
 . . D:+GMTSC>1 WRT^GMTSDEM("",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",83,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSDEM2",84,0)
 . S (GMTSI,GMTSC)=0 F GMTSI=1:1 Q:'$L($P($G(GMTS(2)),"^",GMTSI))  D  Q:$D(GMTSQIT)
"RTN","GMTSDEM2",85,0)
 . . S GMTSD=$P($G(GMTS(2)),"^",GMTSI),GMTSC=GMTSC+1
"RTN","GMTSDEM2",86,0)
 . . D:+GMTSC=1 WRT^GMTSDEM("Race",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",87,0)
 . . D:+GMTSC>1 WRT^GMTSDEM("",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",88,0)
 I '$L($G(GMTS(2)))&('$L($G(GMTS(6)))) D  Q
"RTN","GMTSDEM2",89,0)
 . N GMTSD,GMTSI,GMTSC S GMTSD=$G(GMTS(.06)) D WRT^GMTSDEM("Race",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",90,0)
 Q
"RTN","GMTSDEM2",91,0)
RE ; Race and Ethnicity Component
"RTN","GMTSDEM2",92,0)
 N GMTS D ER(+($G(DFN)),.GMTS) I $L($G(GMTS(2)))!($L($G(GMTS(6)))) D  Q
"RTN","GMTSDEM2",93,0)
 . N GMTSD,GMTSI,GMTSC
"RTN","GMTSDEM2",94,0)
 . S (GMTSI,GMTSC)=0 F GMTSI=1:1 Q:'$L($P($G(GMTS(6)),"^",GMTSI))  D  Q:$D(GMTSQIT)
"RTN","GMTSDEM2",95,0)
 . . S GMTSD=$P($G(GMTS(6)),"^",GMTSI),GMTSC=GMTSC+1
"RTN","GMTSDEM2",96,0)
 . . D:+GMTSC=1 WRT^GMTSDEM("Ethnicity",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",97,0)
 . . D:+GMTSC>1 WRT^GMTSDEM("",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",98,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSDEM2",99,0)
 . S (GMTSI,GMTSC)=0 F GMTSI=1:1 Q:'$L($P($G(GMTS(2)),"^",GMTSI))  D  Q:$D(GMTSQIT)
"RTN","GMTSDEM2",100,0)
 . . S GMTSD=$P($G(GMTS(2)),"^",GMTSI),GMTSC=GMTSC+1
"RTN","GMTSDEM2",101,0)
 . . D:+GMTSC=1 WRT^GMTSDEM("Race",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",102,0)
 . . D:+GMTSC>1 WRT^GMTSDEM("",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",103,0)
 I '$L($G(GMTS(2)))&('$L($G(GMTS(6)))) D  Q
"RTN","GMTSDEM2",104,0)
 . N GMTSD,GMTSI,GMTSC S GMTSD=$G(GMTS(.06)) D WRT^GMTSDEM("Race",GMTSD,"",,1) Q:$D(GMTSQIT)
"RTN","GMTSDEM2",105,0)
 Q
"RTN","GMTSDEM2",106,0)
ER(DFN,GMTS) ;   Get Ethnicity and Race
"RTN","GMTSDEM2",107,0)
 N VADM,VA,VAERR,GMTSD,GMTSI,GMTSC,X,Y S DFN=+($G(DFN)) Q:+DFN=0
"RTN","GMTSDEM2",108,0)
 D DEM^VADPT S GMTSD=$P($G(VADM(8)),"^",2),GMTS(.06)=GMTSD,GMTS("OLD")=GMTSD
"RTN","GMTSDEM2",109,0)
 S GMTSI=0 F  S GMTSI=$O(VADM(11,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSDEM2",110,0)
 . S GMTSD=$P($G(VADM(11,GMTSI)),"^",2) S:$L(GMTSD) GMTS(6)=$G(GMTS(6))_"^"_GMTSD
"RTN","GMTSDEM2",111,0)
 S GMTSD=$G(GMTS(6)) F  Q:$E(GMTSD,1)'="^"  S GMTSD=$E(GMTSD,2,$L(GMTSD))
"RTN","GMTSDEM2",112,0)
 S GMTS(6)=GMTSD S GMTSI=0 F  S GMTSI=$O(VADM(12,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSDEM2",113,0)
 . S GMTSD=$P($G(VADM(12,GMTSI)),"^",2) S:$L(GMTSD) GMTS(2)=$G(GMTS(2))_"^"_GMTSD
"RTN","GMTSDEM2",114,0)
 S GMTSD=$G(GMTS(2)) F  Q:$E(GMTSD,1)'="^"  S GMTSD=$E(GMTSD,2,$L(GMTSD))
"RTN","GMTSDEM2",115,0)
 S GMTS(2)=GMTSD,GMTSD=$G(GMTS(6))_"^^"_$G(GMTS(2)) F  Q:$E(GMTSD,1)'="^"  S GMTSD=$E(GMTSD,2,$L(GMTSD))
"RTN","GMTSDEM2",116,0)
 S GMTS("NEW")=GMTSD,GMTS(.06)=$G(GMTS(.06)),GMTS(2)=$G(GMTS(2)),GMTS(6)=$G(GMTS(6))
"RTN","GMTSDEM2",117,0)
 Q
"RTN","GMTSDEM2",118,0)
 ;              
"RTN","GMTSDEM2",119,0)
ABR(X) ; Abbreviations
"RTN","GMTSDEM2",120,0)
 S X=$$UP^XLFSTR($G(X)) N TM,AB,SID S TM="PROCEDURES",AB="PROC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",121,0)
 S TM="SUPPLEMENTAL",AB="SUP" S:X[TM X=$$SW(X,TM,AB) S TM="ORGANIZATION",AB="ORG" S:X[TM X=$$SW(X,TM,AB) S TM="ORIGIZ",AB="ORG" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",122,0)
 S TM="ORGANIZ",AB="ORG" S:X[TM X=$$SW(X,TM,AB) S TM="MAINTENANCE",AB="MAINT" S:X[TM X=$$SW(X,TM,AB) S TM="PROVIDER",AB="PROV" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",123,0)
 S TM="INDIVIDUAL",AB="INDIVID" S:X[TM X=$$SW(X,TM,AB) S TM="ASSOCATION",AB="ASSOC" S:X[TM X=$$SW(X,TM,AB) S TM="ASSOCIATION",AB="ASSOC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",124,0)
 S TM="PRACT",AB="PRACT" S:X[TM X=$$SW(X,TM,AB) S TM="INSURANCE",AB="INS" S:X[TM X=$$SW(X,TM,AB) S TM="ETC.",AB="ETC" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",125,0)
 S TM="(ONLY)",AB="" S:X[TM X=$$SW(X,TM,AB) S TM="PROTECTION",AB="PROT" S:X[TM X=$$SW(X,TM,AB) S TM="PRACTICE",AB="PRACT" S:X[TM X=$$SW(X,TM,AB)
"RTN","GMTSDEM2",126,0)
 Q X
"RTN","GMTSDEM2",127,0)
SW(X,Y,Z) ; Swap Abbreviation with Term
"RTN","GMTSDEM2",128,0)
 N TM,AB
"RTN","GMTSDEM2",129,0)
 S X=$G(X),TM=$$TRIM($G(Y)),AB=$$TRIM($G(Z)) Q:X="" ""  Q:TM="" X  Q:TM=AB X
"RTN","GMTSDEM2",130,0)
 F  Q:X'[TM  S X=$P(X,TM,1)_AB_$P(X,TM,2)
"RTN","GMTSDEM2",131,0)
 Q X
"RTN","GMTSDEM2",132,0)
TRIM(X) ; Trim Spaces
"RTN","GMTSDEM2",133,0)
 S X=$G(X) Q:X="" X F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSDEM2",134,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSDEM2",135,0)
 F  Q:X'["  "  S X=$P(X,"  ",1)_" "_$P(X,"  ",2,229)
"RTN","GMTSDEM2",136,0)
 Q X
"RTN","GMTSMCMA")
0^2^B28652800
"RTN","GMTSMCMA",1,0)
GMTSMCMA ; WAS/DCB\KER - Medicine 2.2 interface routine      ; 02/11/2003
"RTN","GMTSMCMA",2,0)
 ;;2.7;Health Summary;**4,47,49,61,62**;Oct 20, 1995
"RTN","GMTSMCMA",3,0)
 ;                   
"RTN","GMTSMCMA",4,0)
 ; External Refernces
"RTN","GMTSMCMA",5,0)
 ;    DBIA 10064  KILL^XM
"RTN","GMTSMCMA",6,0)
 ;    DBIA 10070  ^XMD
"RTN","GMTSMCMA",7,0)
 ;    DBIA  1236  $$HL7^MCORMN
"RTN","GMTSMCMA",8,0)
 ;    DBIA  3778  HL1^MCORMN
"RTN","GMTSMCMA",9,0)
 ;    DBIA 10090  ^DIC(4,
"RTN","GMTSMCMA",10,0)
 ;    DBIA 10000  NOW^%DTC
"RTN","GMTSMCMA",11,0)
 ;    DBIA 10106  $$HLDATE^HLFNC
"RTN","GMTSMCMA",12,0)
 ;    DBIA 10106  $$HLNAME^HLFNC
"RTN","GMTSMCMA",13,0)
 ;    DBIA 10017  ^DD("DD")
"RTN","GMTSMCMA",14,0)
 ;    DBIA 10106  $$FMDATE^HLFNC
"RTN","GMTSMCMA",15,0)
 ;    DBIA 10106  $$FMNAME^HLFNC
"RTN","GMTSMCMA",16,0)
 ;    DBIA 10072  REMSBMSG^XMA1C
"RTN","GMTSMCMA",17,0)
 ;                  
"RTN","GMTSMCMA",18,0)
HSUM(PATID,BDATE,EDATE,OCC,WH,ATYPE) ; Health Summary API
"RTN","GMTSMCMA",19,0)
 N ARRAY,MESSAGE,MSH,HLECH,ST,ORD,MSTR,LOOP,MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID
"RTN","GMTSMCMA",20,0)
 N REC,LOC,QID,XDEST,WSF,MWDDC,WDC,QRL,BUILDER,LOOP,MESS1,MESS2,TMP,SUB
"RTN","GMTSMCMA",21,0)
 N XMDUZ,XMTEXT,XMSUB,XMY,XMZ,XMDUN,GMTSG
"RTN","GMTSMCMA",22,0)
 S GMTSG=0 S:$L($T(HL1^MCORMN))>1 GMTSG=1
"RTN","GMTSMCMA",23,0)
 S ARRAY="TMP(""HS"",$J)"
"RTN","GMTSMCMA",24,0)
 S XMTEXT="TMP(""HS"",$J,"
"RTN","GMTSMCMA",25,0)
 S MSTR="|^~\&",HLECH=$E(MSTR,2,4)
"RTN","GMTSMCMA",26,0)
 F LOOP=1:1:5 S ST(LOOP)=$E(MSTR,LOOP,LOOP)
"RTN","GMTSMCMA",27,0)
 S MESSAGE="TMP",SAP="HEALTH SUMMARY",RAP="MEDICINE",VID=2.1
"RTN","GMTSMCMA",28,0)
 S REC=+$O(^DIC(4,"D",DUZ(2),"")),LOC=$P($G(^DIC(4,REC,0)),U,1)
"RTN","GMTSMCMA",29,0)
 S (RNF,SNF)=LOC,RAP="Medicine",SAP="Health Summary",MST="HS",PCI="P"
"RTN","GMTSMCMA",30,0)
 S @ARRAY@(1,0)=$$MSH(MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID)
"RTN","GMTSMCMA",31,0)
 S ATYPE=$S(ATYPE="F":"RD",ATYPE="C":"RD",1:"PG")
"RTN","GMTSMCMA",32,0)
 S QRL=$$CONVERT("D",BDATE)_ST(2)_$$CONVERT("D",EDATE)
"RTN","GMTSMCMA",33,0)
 S QFC="R",QLR=ATYPE_ST(2)_OCC,WSF=PATID,WDDC=WH
"RTN","GMTSMCMA",34,0)
 S @ARRAY@(2,0)=$$QRD(WSF,WDDC,QFC,QLR,QRL)
"RTN","GMTSMCMA",35,0)
 I +($G(GMTSG))'>0 D  Q:+ARRY=0
"RTN","GMTSMCMA",36,0)
 . S XMSUB="Health Summary Request",XMDUN="HEALTH SUMMARY"
"RTN","GMTSMCMA",37,0)
 . S XMY("G.MC MESSAGING SERVER")=""
"RTN","GMTSMCMA",38,0)
 . S XMDUZ=".5"
"RTN","GMTSMCMA",39,0)
 . D ^XMD I +($G(XMZ))=0 D KILL^XM S ARRY=0 Q
"RTN","GMTSMCMA",40,0)
 . S MESS1=XMZ
"RTN","GMTSMCMA",41,0)
 . D KILL^XM
"RTN","GMTSMCMA",42,0)
 . S ARRY=$$HL7^MCORMN(MESS1) D:+ARRY=0 REMOVE(MESS1,+ARRY)
"RTN","GMTSMCMA",43,0)
 I +($G(GMTSG))>0 D  Q:$G(^TMP("MCAR1",$J,1,0))=""
"RTN","GMTSMCMA",44,0)
 . D HL1^MCORMN(SAP,PATID,BDATE,EDATE,OCC,ATYPE)
"RTN","GMTSMCMA",45,0)
 K ^TMP("MCAR",$J) D:+($G(GMTSG))'>0 SLIT(ARRY)
"RTN","GMTSMCMA",46,0)
 K ^TMP("MCAR1",$J) D:+($G(GMTSG))'>0 REMOVE(MESS1,ARRY)
"RTN","GMTSMCMA",47,0)
 Q
"RTN","GMTSMCMA",48,0)
SLIT(ARRY) ; Reformat Array
"RTN","GMTSMCMA",49,0)
 N LOOP,COUNT,BASE,MCOUNT,BUILDER
"RTN","GMTSMCMA",50,0)
 S BUILDER=$S(+($G(GMTSG))'>0:("^XMB(3.9,"_ARRY_",2)"),1:"^TMP(""MCAR1"",$J)")
"RTN","GMTSMCMA",51,0)
 S LOOP=0,(MCOUNT,COUNT)=0,SUB=1,BASE="^TMP(""MCAR"",$J)"
"RTN","GMTSMCMA",52,0)
 F  S LOOP=$O(@BUILDER@(LOOP)) Q:LOOP=""  D SLITTER
"RTN","GMTSMCMA",53,0)
 Q
"RTN","GMTSMCMA",54,0)
SLITTER ; This will slit the message in a usable form
"RTN","GMTSMCMA",55,0)
 N VALUE,ROY,ROUT,LINE
"RTN","GMTSMCMA",56,0)
 S VALUE=@BUILDER@(LOOP,0),ROY=$E(VALUE,1,3)
"RTN","GMTSMCMA",57,0)
 S ROUT=$S(ROY="MSH":"SMSH",ROY="PID":"SPID",ROY="OBR":"SOBR",ROY="OBX":"SOBX",ROY="MSH":"SMSH",1:"OTHER")
"RTN","GMTSMCMA",58,0)
 S LINE="D "_ROUT_"(VALUE)"
"RTN","GMTSMCMA",59,0)
 X LINE
"RTN","GMTSMCMA",60,0)
 Q
"RTN","GMTSMCMA",61,0)
SMSH(VALUE) ; Slit the message header
"RTN","GMTSMCMA",62,0)
 N PROC,LOOP
"RTN","GMTSMCMA",63,0)
 S MSTR=$E(VALUE,4,8),SUB=1
"RTN","GMTSMCMA",64,0)
 F LOOP=1:1:5 S ST(LOOP)=$E(MSTR,LOOP,LOOP)
"RTN","GMTSMCMA",65,0)
 S MCOUNT=MCOUNT+1,COUNT=1
"RTN","GMTSMCMA",66,0)
 S PROC=$P($P(VALUE,ST(1),3),U,1)
"RTN","GMTSMCMA",67,0)
 S @BASE@(MCOUNT,COUNT,1)="PROCEDURE"_U_U_PROC
"RTN","GMTSMCMA",68,0)
 D SETREF(MCOUNT,COUNT,"PROCEDURE")
"RTN","GMTSMCMA",69,0)
 Q
"RTN","GMTSMCMA",70,0)
SPID(VALUE) ; Slit the PID
"RTN","GMTSMCMA",71,0)
 S SUB=1
"RTN","GMTSMCMA",72,0)
 Q
"RTN","GMTSMCMA",73,0)
SOBR(VALUE) ; Slit the OBR
"RTN","GMTSMCMA",74,0)
 N TEMP,XDATE
"RTN","GMTSMCMA",75,0)
 S TEMP=$$CONVERTA("D",$P(VALUE,ST(1),8))
"RTN","GMTSMCMA",76,0)
 S XDATE=TEMP,COUNT=COUNT+1,SUB=1
"RTN","GMTSMCMA",77,0)
 S @BASE@(MCOUNT,COUNT,1)="DATE/TIME"_U_U_TEMP
"RTN","GMTSMCMA",78,0)
 D SETREF(MCOUNT,COUNT,"DATE/TIME")
"RTN","GMTSMCMA",79,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),33))
"RTN","GMTSMCMA",80,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="PRINCIPAL RESUILT INTERPRETER"_U_U_TEMP D SETREF(MCOUNT,COUNT,"PRINCIPAL RESULT INTERPRETER") S COUNT=COUNT+1
"RTN","GMTSMCMA",81,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),34))
"RTN","GMTSMCMA",82,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="ASSISTANT RESUILT INTERPRETER"_U_U_TEMP  D SETREF(MCOUNT,COUNT,"ASSISTANT RESULT") S COUNT=COUNT+1
"RTN","GMTSMCMA",83,0)
 S TEMP=$$CONVERTA("P200",$P(VALUE,ST(1),35))
"RTN","GMTSMCMA",84,0)
 I TEMP'="" S COUNT=COUNT+1,@BASE@(MCOUNT,COUNT,1)="TECHNICIAN"_U_U_TEMP  D SETREF(MCOUNT,COUNT,"TECHNICIAN") S COUNT=COUNT+1
"RTN","GMTSMCMA",85,0)
 Q
"RTN","GMTSMCMA",86,0)
SOBX(VALUE) ; Slit the OBX
"RTN","GMTSMCMA",87,0)
 N XDES,TEMP,FLDTYPE,UNITS,VAL
"RTN","GMTSMCMA",88,0)
 S COUNT=COUNT+1
"RTN","GMTSMCMA",89,0)
 S SUB=1,TEMP=$P(VALUE,ST(1),4),XDES=$P(TEMP,ST(2),2)
"RTN","GMTSMCMA",90,0)
 S TEMP=$P(TEMP,ST(2),1),FLDTYPE=$P(TEMP,ST(3),3)
"RTN","GMTSMCMA",91,0)
 S:FLDTYPE=+FLDTYPE XDES=XDES_";W"
"RTN","GMTSMCMA",92,0)
 S VAL=$$CONVERTA(FLDTYPE,$P(VALUE,ST(1),6))
"RTN","GMTSMCMA",93,0)
 S UNITS=$P(TEMP,ST(1),7)
"RTN","GMTSMCMA",94,0)
 S @BASE@(MCOUNT,COUNT,1)=XDES_U_UNITS_U_VAL
"RTN","GMTSMCMA",95,0)
 D SETREF(MCOUNT,COUNT,XDES)
"RTN","GMTSMCMA",96,0)
 Q
"RTN","GMTSMCMA",97,0)
OTHER(VALUE) ; Set the next sub node if the lines continue
"RTN","GMTSMCMA",98,0)
 N TEMP,UNITS
"RTN","GMTSMCMA",99,0)
 S TEMP=$P(VALUE,ST(1),1),UNITS=$P(VALUE,ST(1),2),SUB=SUB+1
"RTN","GMTSMCMA",100,0)
 S @BASE@(MCOUNT,COUNT,SUB)=U_U_TEMP
"RTN","GMTSMCMA",101,0)
 S:UNITS'="" $P(@BASE@(MCOUNT,COUNT,1),U,2)=UNITS
"RTN","GMTSMCMA",102,0)
 Q
"RTN","GMTSMCMA",103,0)
MSH(MSTR,SAP,SNF,RAP,RNF,MST,PCI,VID) ; MSH Messaging Line
"RTN","GMTSMCMA",104,0)
 N MSH,Y,%,%I
"RTN","GMTSMCMA",105,0)
 S MSH="MSH"_MSTR,$P(MSH,ST(1),3)=SAP,$P(MSH,ST(1),4)=SNF
"RTN","GMTSMCMA",106,0)
 D NOW^%DTC S $P(MSH,ST(1),8)=$$CONVERT("D",%)
"RTN","GMTSMCMA",107,0)
 S $P(MSH,ST(1),5)=RAP,$P(MSH,ST(1),6)=RNF,$P(MSH,ST(1),9)=MST
"RTN","GMTSMCMA",108,0)
 S $P(MSH,ST(1),10)=PCI,$P(MSH,ST(1),11)=VID
"RTN","GMTSMCMA",109,0)
 Q MSH
"RTN","GMTSMCMA",110,0)
QRD(WSF,WDDC,QFC,QLR,QRL) ; QRD Messaging Line
"RTN","GMTSMCMA",111,0)
 N QRD,Y,%,%I
"RTN","GMTSMCMA",112,0)
 S QRD="QRD"
"RTN","GMTSMCMA",113,0)
 D NOW^%DTC S $P(ORD,ST(1),2)=$$CONVERT("D",%)
"RTN","GMTSMCMA",114,0)
 S $P(QRD,ST(1),3)=QFC,$P(QRD,ST(1),4)="I"
"RTN","GMTSMCMA",115,0)
 S $P(QRD,ST(1),6)=$J,$P(QRD,ST(1),8)=QLR
"RTN","GMTSMCMA",116,0)
 S $P(QRD,ST(1),9)=WSF,$P(QRD,ST(1),11)=WDDC,$P(QRD,ST(1),12)=QRL
"RTN","GMTSMCMA",117,0)
 Q QRD
"RTN","GMTSMCMA",118,0)
CONVERT(FILETYPE,RST) ; Convert FileMan to HL7
"RTN","GMTSMCMA",119,0)
 N TEMP
"RTN","GMTSMCMA",120,0)
 S TEMP=RST
"RTN","GMTSMCMA",121,0)
 S:FILETYPE="D" TEMP=$$HLDATE^HLFNC(RST,"TS")
"RTN","GMTSMCMA",122,0)
 S:FILETYPE="P" TEMP=$$HLNAME^HLFNC(RST)
"RTN","GMTSMCMA",123,0)
 Q TEMP
"RTN","GMTSMCMA",124,0)
CONVERTA(FILETYPE,RST) ; Convert HL7 to FileMan
"RTN","GMTSMCMA",125,0)
 N TEMP,Y
"RTN","GMTSMCMA",126,0)
 S TEMP=RST
"RTN","GMTSMCMA",127,0)
 I FILETYPE["D" S Y=$$FMDATE^HLFNC(RST) X ^DD("DD") S TEMP=Y
"RTN","GMTSMCMA",128,0)
 S:(FILETYPE["P200")!(FILETYPE["P690") TEMP=$$FMNAME^HLFNC(RST)
"RTN","GMTSMCMA",129,0)
 Q TEMP
"RTN","GMTSMCMA",130,0)
REMOVE(MESS1,MESS2) ; Remove messages from the server basket
"RTN","GMTSMCMA",131,0)
 N LOOP,XMSER S MESS1=+($G(MESS1)),MESS2=+($G(MESS2))
"RTN","GMTSMCMA",132,0)
 F LOOP=MESS1,MESS2 S XMSER="S.MCHL7SERVER" S XMZ=LOOP D:LOOP'=0 REMSBMSG^XMA1C
"RTN","GMTSMCMA",133,0)
 D KILL^XM
"RTN","GMTSMCMA",134,0)
 Q
"RTN","GMTSMCMA",135,0)
SETREF(MCOUNT,COUNT,XDES) ; Set Count
"RTN","GMTSMCMA",136,0)
 S:XDES'="" @BASE@(MCOUNT,"B",XDES,COUNT)=""
"RTN","GMTSMCMA",137,0)
 Q
"RTN","GMTSPSI5")
0^1^B6364954
"RTN","GMTSPSI5",1,0)
GMTSPSI5 ; SLC/JER,KER - IV Rx Summary Component (V5) ; 02/11/2003
"RTN","GMTSPSI5",2,0)
 ;;2.7;Health Summary;**15,28,56,62**;Oct 20, 1995
"RTN","GMTSPSI5",3,0)
 ;
"RTN","GMTSPSI5",4,0)
 ; External References
"RTN","GMTSPSI5",5,0)
 ;   DBIA    68  ENHS^PSJEEU0
"RTN","GMTSPSI5",6,0)
 ;                      
"RTN","GMTSPSI5",7,0)
MAIN ; Controls Branching
"RTN","GMTSPSI5",8,0)
 N GMI,GMTSIDT,MAX,ON,PS,PSIVREA,PSJEDT,PSJNKF,PSJPFWD,TN
"RTN","GMTSPSI5",9,0)
 S PSJEDT=$S(GMTS2'=9999999:(9999999-GMTS2),1:""),PSJNKF=1
"RTN","GMTSPSI5",10,0)
 K ^UTILITY("PSIV",$J) I '$L($T(ENHS^PSJEEU0)) D NOPSJ Q
"RTN","GMTSPSI5",11,0)
 D ENHS^PSJEEU0 I '$D(^UTILITY("PSIV",$J)) Q
"RTN","GMTSPSI5",12,0)
 S GMI=0
"RTN","GMTSPSI5",13,0)
 S GMTSIDT=-9999999 F  S GMTSIDT=$O(^UTILITY("PSIV",$J,GMTSIDT)) Q:'GMTSIDT  D WRT  Q:$D(GMTSQIT)
"RTN","GMTSPSI5",14,0)
 K ^UTILITY("PSIV",$J),^UTILITY("PSG",$J)
"RTN","GMTSPSI5",15,0)
 Q
"RTN","GMTSPSI5",16,0)
NOPSJ ; Handles case where ^PSJEEU0 not present
"RTN","GMTSPSI5",17,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Inpatient Pharmacy version 3.2 or greater is required.",!
"RTN","GMTSPSI5",18,0)
 Q
"RTN","GMTSPSI5",19,0)
WRT ; Prints IV Pharmacy order
"RTN","GMTSPSI5",20,0)
 N GMV,GMW,GMTSAD,GMTSDRUG,SOL,SD,SLN,FD,STAT,IR,SCH
"RTN","GMTSPSI5",21,0)
 S SD=$P(^UTILITY("PSIV",$J,GMTSIDT,0),U),FD=$P(^(0),U,2),STAT=$P($P(^(0),U,4),";"),IR=$P(^(0),U,5),SCH=$P(^(0),U,6)
"RTN","GMTSPSI5",22,0)
 ;   Don't display data when start date is after To Date
"RTN","GMTSPSI5",23,0)
 Q:+$G(GMRANGE)&(SD>(9999999-GMTS1))
"RTN","GMTSPSI5",24,0)
 F GMV="SD","FD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSI5",25,0)
 I GMI'>0 D HEAD
"RTN","GMTSPSI5",26,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W:GMI>0&('GMTSNPG) !
"RTN","GMTSPSI5",27,0)
 S GMI=1
"RTN","GMTSPSI5",28,0)
 I $D(^UTILITY("PSIV",$J,GMTSIDT,"A",1)) D  Q:$D(GMTSQIT)
"RTN","GMTSPSI5",29,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD
"RTN","GMTSPSI5",30,0)
 . W $E($P($P(^UTILITY("PSIV",$J,GMTSIDT,"A",1),";",2),U),1,36),?38,$P(^(1),U,2)
"RTN","GMTSPSI5",31,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?50,STAT,?57,SD,?69,FD,!
"RTN","GMTSPSI5",32,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPSI5",33,0)
 S GMTSAD=1
"RTN","GMTSPSI5",34,0)
 F  S GMTSAD=$O(^UTILITY("PSIV",$J,GMTSIDT,"A",GMTSAD)) Q:GMTSAD'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPSI5",35,0)
 . S GMTSDRUG=^(GMTSAD) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD
"RTN","GMTSPSI5",36,0)
 . W $E($P($P(GMTSDRUG,";",2),U),1,36),?38,$P(GMTSDRUG,U,2),!
"RTN","GMTSPSI5",37,0)
 Q:$D(GMTSQIT)
"RTN","GMTSPSI5",38,0)
LSTSOL ; Write Solutions
"RTN","GMTSPSI5",39,0)
 S SOL=0 F  S SOL=$O(^UTILITY("PSIV",$J,GMTSIDT,"S",SOL)) Q:SOL'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPSI5",40,0)
 . S SLN=^(SOL) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD
"RTN","GMTSPSI5",41,0)
 . W ?3,$S(SOL=1!GMTSNPG:"In: ",1:"    ")
"RTN","GMTSPSI5",42,0)
 . W $P($P(SLN,";",2),U)," ",$P(SLN,U,2)," ",IR," ",SCH,!
"RTN","GMTSPSI5",43,0)
 Q
"RTN","GMTSPSI5",44,0)
HEAD ; Prints Header
"RTN","GMTSPSI5",45,0)
 I 'GMTSNPG D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSI5",46,0)
 W "Drug",?38,"Dose",?50,"Status",?58,"Start",?68,"Stop",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSI5",47,0)
 Q
"RTN","GMTSPXFP")
0^4^B7572115
"RTN","GMTSPXFP",1,0)
GMTSPXFP ; SLC/SBW,KER - PCE Health Factors Component ; 02/11/2003
"RTN","GMTSPXFP",2,0)
 ;;2.7;Health Summary;**8,10,28,56,58,62**;Oct 20, 1995
"RTN","GMTSPXFP",3,0)
 ;
"RTN","GMTSPXFP",4,0)
 ; External References
"RTN","GMTSPXFP",5,0)
 ;   DBIA  1243  HF^PXRHS07
"RTN","GMTSPXFP",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPXFP",7,0)
 ;                    
"RTN","GMTSPXFP",8,0)
HFSEL ; Health Factors Selected
"RTN","GMTSPXFP",9,0)
 N HFSEG,GMTSFC,GMW
"RTN","GMTSPXFP",10,0)
 Q:$O(GMTSEG(GMTSEGN,9999999.64,0))'>0
"RTN","GMTSPXFP",11,0)
 S GMTSFC=0,GMW=0
"RTN","GMTSPXFP",12,0)
 F  S GMTSFC=$O(GMTSEG(GMTSEGN,9999999.64,GMTSFC)) Q:'GMTSFC  D
"RTN","GMTSPXFP",13,0)
 . S HFSEG(GMTSEG(GMTSEGN,9999999.64,GMTSFC))=""
"RTN","GMTSPXFP",14,0)
 K ^TMP("PXF",$J) D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM,.HFSEG)
"RTN","GMTSPXFP",15,0)
 Q:'$D(^TMP("PXF",$J))  D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR,HFMAIN
"RTN","GMTSPXFP",16,0)
 Q
"RTN","GMTSPXFP",17,0)
HFACT ; Control Health Factor retrieval and display
"RTN","GMTSPXFP",18,0)
 K ^TMP("PXF",$J)
"RTN","GMTSPXFP",19,0)
 D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM)
"RTN","GMTSPXFP",20,0)
 Q:'$D(^TMP("PXF",$J))
"RTN","GMTSPXFP",21,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HDR
"RTN","GMTSPXFP",22,0)
 D HFMAIN
"RTN","GMTSPXFP",23,0)
 Q
"RTN","GMTSPXFP",24,0)
HFMAIN ; Main Health Factor Display
"RTN","GMTSPXFP",25,0)
 N GMHFC,GMHF,GMDT,GMIFN,GMN0,GMW,X,GMTSDAT,HF,LEVEL,PHFC,COMMENT
"RTN","GMTSPXFP",26,0)
 N GMICL,GMTAB,GMTSLN
"RTN","GMTSPXFP",27,0)
 S GMHFC="",GMW=0
"RTN","GMTSPXFP",28,0)
 F  S GMHFC=$O(^TMP("PXF",$J,GMHFC)) Q:GMHFC=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",29,0)
 . S GMHF=""
"RTN","GMTSPXFP",30,0)
 . F  S GMHF=$O(^TMP("PXF",$J,GMHFC,GMHF)) Q:GMHF=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",31,0)
 . . S GMDT=0
"RTN","GMTSPXFP",32,0)
 . . F  S GMDT=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",33,0)
 . . . S GMIFN=0
"RTN","GMTSPXFP",34,0)
 . . . F  S GMIFN=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN)) Q:GMIFN'>0  D HFDSP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",35,0)
 K ^TMP("PXF",$J)
"RTN","GMTSPXFP",36,0)
 Q
"RTN","GMTSPXFP",37,0)
HDR ; Display Header
"RTN","GMTSPXFP",38,0)
 Q:$D(GMTSOBJ)  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Category",!
"RTN","GMTSPXFP",40,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "  Health Factor ",?50,"Visit Date",!
"RTN","GMTSPXFP",41,0)
 Q
"RTN","GMTSPXFP",42,0)
HFDSP ; Display Data
"RTN","GMTSPXFP",43,0)
 S GMN0=$G(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,0))
"RTN","GMTSPXFP",44,0)
 Q:GMN0']""
"RTN","GMTSPXFP",45,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXFP",46,0)
 S HF=$P(GMN0,U),LEVEL=$P(GMN0,U,4)
"RTN","GMTSPXFP",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR D
"RTN","GMTSPXFP",48,0)
 . I GMHFC'=$G(PHFC)!GMTSNPG D
"RTN","GMTSPXFP",49,0)
 . . I '$D(GMTSOBJ),$G(PHFC)="",'GMTSNPG W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",50,0)
 . . W GMHFC,! S PHFC=GMHFC
"RTN","GMTSPXFP",51,0)
 . S GMW=1
"RTN","GMTSPXFP",52,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",53,0)
 W ?2,HF
"RTN","GMTSPXFP",54,0)
 W:LEVEL]"" " (",LEVEL,")"
"RTN","GMTSPXFP",55,0)
 W ?50,GMTSDAT,!
"RTN","GMTSPXFP",56,0)
 S COMMENT="",COMMENT=$P(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,"COM"),U)
"RTN","GMTSPXFP",57,0)
 I COMMENT]"" S GMICL=13,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPXFP",58,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXFP",59,0)
 Q
"RTN","GMTSPXFP",60,0)
FORMAT ; Format Line
"RTN","GMTSPXFP",61,0)
 N DIWR,DIWF,X
"RTN","GMTSPXFP",62,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXFP",63,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXFP",64,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXFP",65,0)
 Q
"RTN","GMTSPXFP",66,0)
LINE ; Write Line
"RTN","GMTSPXFP",67,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXFP",68,0)
 Q
"RTN","GMTSRM1")
0^11^B22624208
"RTN","GMTSRM1",1,0)
GMTSRM1 ;SLC/JER,DLT - Create/Modify Health Summary (cont'd) ; 07/18/2000
"RTN","GMTSRM1",2,0)
 ;;2.7;Health Summary;**7,36,37,62**;Oct 20, 1995
"RTN","GMTSRM1",3,0)
 ;
"RTN","GMTSRM1",4,0)
 ; External References
"RTN","GMTSRM1",5,0)
 ;   DBIA 10006  ^DIC
"RTN","GMTSRM1",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSRM1",7,0)
 ;   DBIA 10018  ^DIE
"RTN","GMTSRM1",8,0)
 ;                     
"RTN","GMTSRM1",9,0)
NXTCMP ; Edit, add, or delete components from existing structure
"RTN","GMTSRM1",10,0)
 N CMP,D,D0,DI,DIC,DIR,OLDSO,SEL,X,Y K DIRUT
"RTN","GMTSRM1",11,0)
 K DUOUT S GMTSQIT=0,GMTSNEW=0
"RTN","GMTSRM1",12,0)
 S DIC="^GMT(142.1,",DIC(0)="AEMQ",D="B",DIC("W")="W ?40,"" "",$P(^(0),U,4)",DIC("A")="Select COMPONENT: ",DIC("S")="I $P(^(0),U,6)'=""P""" S:$D(GMCMP) DIC("B")=$P(^GMT(142.1,+GMCMP,0),U)
"RTN","GMTSRM1",13,0)
 D ^DIC K DIC S:('$D(DTOUT)&('$D(DUOUT))&(Y=-1)) GMTSQIT=2 S:(Y=-1&(X'="^LOOP")) DUOUT=1
"RTN","GMTSRM1",14,0)
 I $D(DUOUT),(X="^LOOP") K DUOUT D LOOP K DUOUT Q
"RTN","GMTSRM1",15,0)
 I $D(DUOUT) Q
"RTN","GMTSRM1",16,0)
 D CHKCMP Q:$D(DUOUT)!(GMTSQIT)!(GMTSQIT="D")
"RTN","GMTSRM1",17,0)
 S DIR(0)="142.01,.01",DIR("B")=+$G(CNT)
"RTN","GMTSRM1",18,0)
 D ^DIR K DIR K:$D(DUOUT) DUOUT D:'$D(DIRUT) CHKSO^GMTSRM1A Q:$D(DIRUT)!(GMTSQIT)
"RTN","GMTSRM1",19,0)
 D ASKCMP I $D(GMCMP) S DUOUT=""
"RTN","GMTSRM1",20,0)
 Q
"RTN","GMTSRM1",21,0)
LOOP ; Loop through STRUCTURE multiple and call ASKCMP for each
"RTN","GMTSRM1",22,0)
 N GMI,GMJ
"RTN","GMTSRM1",23,0)
 S GMI=0 F  S GMI=$O(^GMT(142,GMTSIFN,1,GMI))  Q:GMI'>0!$D(DUOUT)!+GMTSQIT!(GMTSQIT="D")  D
"RTN","GMTSRM1",24,0)
 . N CMP,DIR,X,Y
"RTN","GMTSRM1",25,0)
 . S CMP=$P(^GMT(142,GMTSIFN,1,GMI,0),U,2),CMP("NM")=$P($G(^GMT(142.1,+CMP,0)),U),CMP(1)=+CMP
"RTN","GMTSRM1",26,0)
 . S CMP(0)=$G(^GMT(142,+GMTSIFN,1,+GMI,0))
"RTN","GMTSRM1",27,0)
 . S CMP(.01)=GMI
"RTN","GMTSRM1",28,0)
 . S GMJ=0 F  S GMJ=$O(^GMT(142,+GMTSIFN,1,+GMI,1,GMJ)) Q:+GMJ'>0  D
"RTN","GMTSRM1",29,0)
 . . S CMP(142.14,GMJ)=$G(^GMT(142,GMTSIFN,1,GMI,1,GMJ,0))
"RTN","GMTSRM1",30,0)
 . W !!?3,CMP("NM")
"RTN","GMTSRM1",31,0)
 . S (NXTCMP,NXTCMP(0))=NXTCMP+1 D ASKCMP I $D(Y),'$D(DTOUT) D
"RTN","GMTSRM1",32,0)
 . . S DIR(0)="Y",DIR("A")="WANT TO STOP LOOPING",DIR("B")="YES"
"RTN","GMTSRM1",33,0)
 . . D ^DIR K DIR W ! I +Y S GMTSQIT="D" W !!?4,"LOOP ENDED!",!!
"RTN","GMTSRM1",34,0)
 Q
"RTN","GMTSRM1",35,0)
ASKCMP ; Ask parameters for each component
"RTN","GMTSRM1",36,0)
 N IEN,MAXOCC,TIME,OCC,HOSP,ICD,PROV,CPT,SELCNT,GMTSNCNT,GMTSN
"RTN","GMTSRM1",37,0)
 N OLDLIM,OLDOCC,OLDHEAD,OLDSO,OLDHOSP,OLDICD,OLDPROV,OLDCPT,SUMORD,CMPNAM
"RTN","GMTSRM1",38,0)
 S MAXOCC=$S($P($G(^GMT(142.1,CMP(1),0)),U,5)="Y":1,1:0)
"RTN","GMTSRM1",39,0)
 S TIME=$S($P($G(^GMT(142.1,CMP(1),0)),U,3)="Y":1,1:0)
"RTN","GMTSRM1",40,0)
 S HOSP=$S($P($G(^GMT(142.1,CMP(1),0)),U,10)="Y":1,1:0)
"RTN","GMTSRM1",41,0)
 S ICD=$S($P($G(^GMT(142.1,CMP(1),0)),U,11)="Y":1,1:0)
"RTN","GMTSRM1",42,0)
 S PROV=$S($P($G(^GMT(142.1,CMP(1),0)),U,12)="Y":1,1:0)
"RTN","GMTSRM1",43,0)
 S CPT=$S($P($G(^GMT(142.1,CMP(1),0)),U,14)="Y":1,1:0)
"RTN","GMTSRM1",44,0)
 S OLDOCC=$P($G(CMP(0)),U,3),OLDLIM=$P($G(CMP(0)),U,4)
"RTN","GMTSRM1",45,0)
 S OLDHOSP=$P($G(CMP(0)),U,6),OLDICD=$P($G(CMP(0)),U,7)
"RTN","GMTSRM1",46,0)
 S OLDPROV=$P($G(CMP(0)),U,8),OLDCPT=$P($G(CMP(0)),U,9)
"RTN","GMTSRM1",47,0)
 S OLDHEAD=$S($L($P($G(CMP(0)),U,5)):$P($G(CMP(0)),U,5),$L($P(^GMT(142.1,+CMP(1),0),U,9)):$P(^(0),U,9),1:"")
"RTN","GMTSRM1",48,0)
 S SEL=$O(^GMT(142.1,CMP(1),1,0))
"RTN","GMTSRM1",49,0)
 I SEL D
"RTN","GMTSRM1",50,0)
 . S SEL(0)=^GMT(142.1,CMP(1),1,SEL,0),SEL=$P(SEL(0),U),SELCNT=$P(SEL(0),U,2)
"RTN","GMTSRM1",51,0)
 . I SEL S DIC("V")="I +Y(0)=SEL",IEN=0,DIC(0)="AEMQ" F  S IEN=$O(CMP(142.14,IEN)) Q:'IEN  D LOADSEL^GMTSRM1A
"RTN","GMTSRM1",52,0)
 I EXISTS=0 S EXISTS=1
"RTN","GMTSRM1",53,0)
 I '$D(^GMT(142,GMTSIFN,1,0)) S ^(0)="^142.01IA^0^0",GMTSNEW=1
"RTN","GMTSRM1",54,0)
 S SUMORD=$G(CMP(.01)),CMPNAM=$G(CMP(1))
"RTN","GMTSRM1",55,0)
 ;
"RTN","GMTSRM1",56,0)
 ; New           .01  Summary Order        N .001-9999.999
"RTN","GMTSRM1",57,0)
 ; New/Existing    1  Component Name       P 142.1
"RTN","GMTSRM1",58,0)
 ;
"RTN","GMTSRM1",59,0)
 I +($G(GMTSNEW)) D
"RTN","GMTSRM1",60,0)
 . S DR=".01///^S X=SUMORD;1///^S X=CMPNAM;2///^S X=OLDOCC;3///^S X=OLDLIM;6///^S X=OLDHOSP;7///^S X=OLDICD;8///^S X=OLDPROV;9///^S X=OLDCPT;"
"RTN","GMTSRM1",61,0)
 E  S DR="1///^S X=CMPNAM;"
"RTN","GMTSRM1",62,0)
 ;
"RTN","GMTSRM1",63,0)
 ; First Edit      2  Occurrence Limit     N 1-99999
"RTN","GMTSRM1",64,0)
 ;                 3  Time Limit           F 1-5
"RTN","GMTSRM1",65,0)
 ;                 6  Hospital Loc Disp    Y/N/""
"RTN","GMTSRM1",66,0)
 ;                 7  ICD Text Displayed   L/S/C/T/N
"RTN","GMTSRM1",67,0)
 ;                 8  Provider Narr Disp   Y/N/""
"RTN","GMTSRM1",68,0)
 ;                 9  CPT Mod Displayed    Y/N/""
"RTN","GMTSRM1",69,0)
 ;
"RTN","GMTSRM1",70,0)
 S:+($G(MAXOCC))>0 DR=DR_"2//"_OLDOCC_";" S:+($G(TIME))>0 DR=DR_"3//"_OLDLIM_";"
"RTN","GMTSRM1",71,0)
 S:+($G(HOSP))>0 DR=DR_"6//"_OLDHOSP_";" S:+($G(ICD))>0 DR=DR_"7//"_OLDICD_";"
"RTN","GMTSRM1",72,0)
 S:+($G(PROV))>0 DR=DR_"8//"_OLDPROV_";" S:+($G(CPT))>0 DR=DR_"9//"_OLDCPT_";"
"RTN","GMTSRM1",73,0)
 S DIE="^GMT(142,"_GMTSIFN_",1,",DA(1)=GMTSIFN,DA=CMP(.01)
"RTN","GMTSRM1",74,0)
 D ^DIE Q:$D(Y)
"RTN","GMTSRM1",75,0)
 ;
"RTN","GMTSRM1",76,0)
 ; Second Edit     4  Selection Item       142.14 Items
"RTN","GMTSRM1",77,0)
 ;                 5  Header Name          F 2-20
"RTN","GMTSRM1",78,0)
 ;
"RTN","GMTSRM1",79,0)
 S DR(2,142.14)=".01;D EXIT^GMTSRM3 I +SELCNT,(GMTSNCNT'<SELCNT) S DTOUT="""""
"RTN","GMTSRM1",80,0)
 S DR="5//^S X=$G(OLDHEAD);I 'SEL S Y=0;D EN^GMTSRM3;4"
"RTN","GMTSRM1",81,0)
 D ^DIE K DIC("V")
"RTN","GMTSRM1",82,0)
 S (GMTSNCNT,GMTSN)=0 F  S GMTSN=$O(^GMT(142,DA(1),1,DA,1,GMTSN)) Q:'GMTSN  S GMTSNCNT=GMTSNCNT+1
"RTN","GMTSRM1",83,0)
 I +GMTSNCNT>1 D REITEM^GMTSRM3(DA(1),DA)
"RTN","GMTSRM1",84,0)
 Q
"RTN","GMTSRM1",85,0)
CHKCMP ; Checks selected component for duplication
"RTN","GMTSRM1",86,0)
 N DIR,SEL,SO,SOACTION
"RTN","GMTSRM1",87,0)
 K OLDSO
"RTN","GMTSRM1",88,0)
 S SOACTION="",CMP=+Y,CMP("NM")=$P(Y,U,2),(NXTCMP(0),NXTCMP)=NXTCMP+1
"RTN","GMTSRM1",89,0)
 I '$D(^GMT(142,GMTSIFN,1,"C",+CMP)) D  Q
"RTN","GMTSRM1",90,0)
 . S CMP(1)=+CMP,CNT=$$GETCNT^GMTSRM(GMTSIFN)
"RTN","GMTSRM1",91,0)
 . I +CMP>300,$O(^GMT(142.1,+CMP(1),1,0)),'$D(CMP(142.14)) D GETSEL^GMTSRM1A(.CMP)
"RTN","GMTSRM1",92,0)
 S SO=$O(^GMT(142,GMTSIFN,1,"C",+CMP,0))
"RTN","GMTSRM1",93,0)
 W !,$P(Y,U,2)," is already a component of this summary."
"RTN","GMTSRM1",94,0)
 S DIR(0)="SO^E:Edit component parameters;D:Delete component from summary;"
"RTN","GMTSRM1",95,0)
 S DIR("A")="Select Action"
"RTN","GMTSRM1",96,0)
 D ^DIR K DIR
"RTN","GMTSRM1",97,0)
 I $D(DUOUT) S NXTCMP=NXTCMP-1 Q
"RTN","GMTSRM1",98,0)
 I $D(DIRUT)&('$D(DTOUT)) S GMTSQIT=$S('$D(GMCMP):"D",1:1) W ! Q
"RTN","GMTSRM1",99,0)
 I $D(DIRUT) S GMTSQIT=1 Q
"RTN","GMTSRM1",100,0)
 S OLDSO=SO I Y="D" S SOACTION="D" D DELCMP^GMTSRM4 W ! S GMTSQIT="D" Q
"RTN","GMTSRM1",101,0)
 S SOACTION="E",CMP(1)=+CMP,CNT=SO K Y
"RTN","GMTSRM1",102,0)
 S CMP(0)=^GMT(142,GMTSIFN,1,SO,0)
"RTN","GMTSRM1",103,0)
 S SEL=0 F  S SEL=$O(^GMT(142,GMTSIFN,1,SO,1,SEL)) Q:+SEL'>0  S CMP(142.14,SEL)=^(SEL,0)
"RTN","GMTSRM1",104,0)
 I +CMP>100,$O(^GMT(142.1,+CMP(1),1,0)),'$D(CMP(142.14)) D
"RTN","GMTSRM1",105,0)
 . D GETSEL^GMTSRM1A(.CMP)
"RTN","GMTSRM1",106,0)
 Q
"RTN","GMTSRM3")
0^12^B23535059
"RTN","GMTSRM3",1,0)
GMTSRM3 ; SLC/DLT - Create/Modify - Selection Items ; 08/27/2002
"RTN","GMTSRM3",2,0)
 ;;2.7;Health Summary;**56,62**;Oct 20, 1995
"RTN","GMTSRM3",3,0)
 ;
"RTN","GMTSRM3",4,0)
 ; External References
"RTN","GMTSRM3",5,0)
 ;   DBIA  2160  ^XUTL("OR")
"RTN","GMTSRM3",6,0)
 ;   DBIA    67  ^LAB(60,
"RTN","GMTSRM3",7,0)
 ;   DBIA  3137  EN^ORUS
"RTN","GMTSRM3",8,0)
 ;                    
"RTN","GMTSRM3",9,0)
EN ; Entry Logic for Selection Items
"RTN","GMTSRM3",10,0)
 N GMTSN W !!,$S($O(^GMT(142,DA(1),1,DA,1,0)):"Current selection items are:  ",1:"No selection items chosen.")
"RTN","GMTSRM3",11,0)
 S GMTSN=0 F  S GMTSN=$O(^GMT(142,DA(1),1,DA,1,GMTSN)) Q:+GMTSN'>0  S GMTSN(0)=^(GMTSN,0) D SHOWSEL
"RTN","GMTSRM3",12,0)
 W !!,"Select new items one at a time in the sequence you want them displayed."
"RTN","GMTSRM3",13,0)
 W !,"You may select " I SELCNT="" W "any number of items.",!
"RTN","GMTSRM3",14,0)
 E  W "up to ",SELCNT," items.",!
"RTN","GMTSRM3",15,0)
 Q
"RTN","GMTSRM3",16,0)
SHOWSEL ; Writes Current Selection Items
"RTN","GMTSRM3",17,0)
 W ?30,$P(@("^"_$P(GMTSN(0),";",2)_+GMTSN(0)_",0)"),U),!
"RTN","GMTSRM3",18,0)
 Q
"RTN","GMTSRM3",19,0)
EXIT ; Exit Logic for Selection Items
"RTN","GMTSRM3",20,0)
 N GMTSN,SELREF,GMREF I +X,(X["LAB(60,") D
"RTN","GMTSRM3",21,0)
 . S SELREF=U_$P(X,";",2)_+X_",",GMREF=X
"RTN","GMTSRM3",22,0)
 . I '$L($P($G(@(SELREF_"0)")),U,5)) D RESOLVE(GMREF)
"RTN","GMTSRM3",23,0)
 I $S('$D(DA(1)):1,'$D(DA(2)):1,1:0) Q
"RTN","GMTSRM3",24,0)
 S (GMTSNCNT,GMTSN)=0 F  S GMTSN=$O(^GMT(142,DA(2),1,DA(1),1,GMTSN)) Q:'GMTSN  S GMTSNCNT=GMTSNCNT+1
"RTN","GMTSRM3",25,0)
 S $P(^GMT(142,DA(2),1,DA(1),1,0),U,4)=GMTSNCNT
"RTN","GMTSRM3",26,0)
 I SELCNT,(GMTSNCNT'<SELCNT) W !?2,$C(7),"MAXIMUM # OF ITEMS SELECTED.",!
"RTN","GMTSRM3",27,0)
 Q
"RTN","GMTSRM3",28,0)
RESOLVE(GMREF) ; Resolve Compound Items
"RTN","GMTSRM3",29,0)
 N C,IEN,GMI,GMHEAD,P,X,Y K ^XUTL("OR",$J,"ORU"),^("ORV"),^("ORW")
"RTN","GMTSRM3",30,0)
 S GMHEAD="-- "_$P($G(^LAB(60,+GMREF,.1)),U)_" --"
"RTN","GMTSRM3",31,0)
 S ^XUTL("OR",$J,"GMTS",0)="LAB TEST^1^^0" D COMPILE(+GMREF)
"RTN","GMTSRM3",32,0)
 S ORUS="^XUTL(""OR"","_$J_",""GMTS"",",ORUS("T")="D HEADER^GMTSRM3"
"RTN","GMTSRM3",33,0)
 I +$G(SELCNT) D
"RTN","GMTSRM3",34,0)
 . S ORUS(0)="40MN^"_SELCNT
"RTN","GMTSRM3",35,0)
 . S ORUS("A")="Select 1 - "_SELCNT_" LAB TEST(s): ",ORUS("B")="1-"_SELCNT
"RTN","GMTSRM3",36,0)
 E  S ORUS(0)="40MN",ORUS("A")="Select LAB TEST(s): ",ORUS("B")="ALL"
"RTN","GMTSRM3",37,0)
 D EN^ORUS K ^XUTL("OR",$J,"GMTS"),^("ORU"),^("ORV"),^("ORW")
"RTN","GMTSRM3",38,0)
 I $S('$D(CMP(142.14,DA)):1,$G(CMP(142.14,DA))=GMREF:1,1:0) D
"RTN","GMTSRM3",39,0)
 . I $D(CMP(142.14,+$O(CMP(142.14,DA)))) D
"RTN","GMTSRM3",40,0)
 . . S GMI=DA F  S GMI=$O(CMP(142.14,GMI)) Q:+GMI'>0!(GMI'<(DA+Y))  S CMP(142.14,GMI+Y)=CMP(142.14,GMI)
"RTN","GMTSRM3",41,0)
 . S GMI=0 F  S GMI=$O(Y(GMI)) Q:GMI'>0  D
"RTN","GMTSRM3",42,0)
 . . I '$D(^GMT(142,+$G(DA(2)),1,+$G(DA(1)),1,"B",+$G(Y(GMI))_";LAB(60,")) D
"RTN","GMTSRM3",43,0)
 . . . S CMP(142.14,((GMI-1)+DA))=+$G(Y(GMI))_";LAB(60,"
"RTN","GMTSRM3",44,0)
 S IEN=0 F  S IEN=$O(CMP(142.14,IEN)) Q:IEN'>0  D
"RTN","GMTSRM3",45,0)
 . I $D(^GMT(142,+$G(DA(2)),1,+$G(DA(1)),1,"B",CMP(142.14,IEN))) W $C(7),!,"  Duplicate test omitted." K CMP(142.14,IEN) Q
"RTN","GMTSRM3",46,0)
 . D LOADSEL^GMTSRM1A
"RTN","GMTSRM3",47,0)
 I $P($G(^LAB(60,+$G(^GMT(142,+DA(2),1,+DA(1),1,+DA,0)),0)),U,5)']"" D
"RTN","GMTSRM3",48,0)
 . N REC,SUBREC,SUBSUB S REC=DA(2),SUBREC=DA(1),SUBSUB=DA
"RTN","GMTSRM3",49,0)
 . D DELCOSMO(REC,SUBREC,SUBSUB)
"RTN","GMTSRM3",50,0)
 Q
"RTN","GMTSRM3",51,0)
REITEM(GMTST,GMTSS) ; Resequence Items
"RTN","GMTSRM3",52,0)
 Q:+($G(GMTST))'>0  Q:'$D(^GMT(142,+($G(GMTST))))
"RTN","GMTSRM3",53,0)
 Q:+($G(GMTSS))'>0  Q:'$D(^GMT(142,+GMTST,1,+($G(GMTSS))))
"RTN","GMTSRM3",54,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,GMTSA,GMTSCN,GMTSCA,GMTSMAX,GMTSN,GMTSI,Y,X
"RTN","GMTSRM3",55,0)
 D ARY(GMTST,GMTSS,.GMTSA) Q:+($G(GMTSA(0)))'>1
"RTN","GMTSRM3",56,0)
 S GMTSCN=$P($G(^GMT(142,GMTST,1,GMTSS,0)),"^",2),GMTSCA=$P($G(^GMT(142.1,+GMTSCN,0)),"^",4),GMTSCN=$P($G(^GMT(142.1,+GMTSCN,0)),"^",1)
"RTN","GMTSRM3",57,0)
 W !,?1,GMTSCN,"    ",$S($L(GMTSCA):"(",1:""),GMTSCA,$S($L(GMTSCA):")",1:"")
"RTN","GMTSRM3",58,0)
 S GMTSN=0 F  S GMTSN=$O(GMTSA(GMTSN)) Q:+GMTSN=0  W !,$J(GMTSN,6),"  ",GMTSA(GMTSN)
"RTN","GMTSRM3",59,0)
 S DIR(0)="YAO",DIR("?")="^D RIH^GMTSRM3",DIR("A")=" Do you want to resequence the selection items?  "
"RTN","GMTSRM3",60,0)
 W ! D ^DIR I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) Q
"RTN","GMTSRM3",61,0)
 Q:+Y'>0
"RTN","GMTSRM3",62,0)
 N DA S DA(2)=+($G(GMTST)),DA(1)=+($G(GMTSS)) D RSI^GMTSRS2
"RTN","GMTSRM3",63,0)
 Q
"RTN","GMTSRM3",64,0)
RIH ; Resequence Items Help
"RTN","GMTSRM3",65,0)
 W !,?4,"Enter either 'Y' or 'N'." Q
"RTN","GMTSRM3",66,0)
ARY(GMTST,GMTSS,ARY) ; Array of Items
"RTN","GMTSRM3",67,0)
 N GMTSC,GMTSI,GMTSVAL,GMTSPTR,GMTSFRT,GMTSCRT,GMTSFFRT,GMTSFCRT
"RTN","GMTSRM3",68,0)
 N GMTSRT,GMTSUB S ARY(0)=0 Q:+($G(GMTST))'>0  Q:'$D(^GMT(142,+($G(GMTST))))  Q:+($G(GMTSS))'>0  Q:'$D(^GMT(142,+GMTST,1,+($G(GMTSS))))
"RTN","GMTSRM3",69,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,GMTST,1,GMTSS,1,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRM3",70,0)
 . S GMTSVAL=$G(^GMT(142,GMTST,1,GMTSS,1,GMTSI,0)),GMTSPTR=+GMTSVAL,GMTSFRT=$P(GMTSVAL,";",2) Q:GMTSFRT'["("  S:GMTSFRT'["^" GMTSFRT="^"_GMTSFRT
"RTN","GMTSRM3",71,0)
 . S GMTSCRT=$$CREF^DILF(GMTSFRT),GMTSFFRT=GMTSFRT_GMTSPTR_","
"RTN","GMTSRM3",72,0)
 . S GMTSFCRT=$$CREF^DILF(GMTSFFRT) Q:'$D(@GMTSFCRT)  Q:'$L($G(@($P(GMTSFCRT,")",1)_",0)")))
"RTN","GMTSRM3",73,0)
 . S GMTSUB=$P($G(@($P(GMTSFCRT,")",1)_",0)")),"^",1),GMTSC=GMTSC+1,ARY(GMTSC)=GMTSUB,ARY(0)=+GMTSC
"RTN","GMTSRM3",74,0)
 Q
"RTN","GMTSRM3",75,0)
COMPILE(GMTEST) ; Compile Menu
"RTN","GMTSRM3",76,0)
 N GMC,GMI,GMJ,GMROOT
"RTN","GMTSRM3",77,0)
 S GMI=0 F  S GMI=$O(^LAB(60,GMTEST,2,GMI)) Q:GMI'>0  D
"RTN","GMTSRM3",78,0)
 . S GMJ=+$G(^LAB(60,GMTEST,2,+GMI,0))
"RTN","GMTSRM3",79,0)
 . S GMROOT=$G(^LAB(60,+GMJ,0))
"RTN","GMTSRM3",80,0)
 . I $L($P(GMROOT,U,5)) D
"RTN","GMTSRM3",81,0)
 . . S GMC=+$P($G(^XUTL("OR",$J,"GMTS",0)),U,4)+1
"RTN","GMTSRM3",82,0)
 . . S ^XUTL("OR",$J,"GMTS",GMJ,0)=$P(GMROOT,U),$P(^XUTL("OR",$J,"GMTS",0),U,4)=GMC
"RTN","GMTSRM3",83,0)
 . E  D COMPILE(+$G(^LAB(60,GMTEST,2,GMI,0)))
"RTN","GMTSRM3",84,0)
 Q
"RTN","GMTSRM3",85,0)
HEADER ; Write Header
"RTN","GMTSRM3",86,0)
 W !!?15,"Select the tests which you wish to include, in the",!?19,"sequence in which you wish them to appear."
"RTN","GMTSRM3",87,0)
 W !!?((80-$L(GMHEAD))\2),GMHEAD,!
"RTN","GMTSRM3",88,0)
 Q
"RTN","GMTSRM3",89,0)
DELCOSMO(X1,X2,X3) ; Delete Cosmic Lab Tests from Selection Items
"RTN","GMTSRM3",90,0)
 N TEST S TEST=$G(^GMT(142,X1,1,X2,1,X3,0))
"RTN","GMTSRM3",91,0)
 K ^GMT(142,X1,1,X2,1,"B",TEST),^GMT(142,X1,1,X2,1,X3,0)
"RTN","GMTSRM3",92,0)
 Q
"RTN","GMTSRS")
0^5^B45492007
"RTN","GMTSRS",1,0)
GMTSRS ; SLC/KER - Health Summary Type Resequence      ; 02/11/2003
"RTN","GMTSRS",2,0)
 ;;2.7;Health Summary;**62**;Oct 20, 1995
"RTN","GMTSRS",3,0)
 ;
"RTN","GMTSRS",4,0)
 ; External References
"RTN","GMTSRS",5,0)
 ;   DBIA 10011  ^UTILITY($J
"RTN","GMTSRS",6,0)
 ;   DBIA 10013  IX1^DIK 
"RTN","GMTSRS",7,0)
 ;   DBIA 10026  ^DIR    
"RTN","GMTSRS",8,0)
 ;   DBIA 10011  ^DIWP   
"RTN","GMTSRS",9,0)
 ;                                            
"RTN","GMTSRS",10,0)
 ; This routine will resequence the Health Summary Components
"RTN","GMTSRS",11,0)
 ; in the structure (sub-file 142.01) of a Health Summary 
"RTN","GMTSRS",12,0)
 ; Type (file 142)
"RTN","GMTSRS",13,0)
 ;                 
"RTN","GMTSRS",14,0)
EN ; Main Entry Point
"RTN","GMTSRS",15,0)
 N DA,DIK,GMTST,GMTSS,GMTSERR,GMTSCC,X,Y
"RTN","GMTSRS",16,0)
 W !,"Resequence the Components and/or Selection Items of a Health Summary Type.",!
"RTN","GMTSRS",17,0)
 D LKT^GMTSRS1 I +Y'>0 W !,"Health Summary Type not selected ",! Q
"RTN","GMTSRS",18,0)
 S GMTST=+Y,DA(1)=GMTST D RC(GMTST),RSI(GMTST)
"RTN","GMTSRS",19,0)
 K DA S DA=GMTST,DIK="^GMT(142," D IX1^DIK
"RTN","GMTSRS",20,0)
 Q
"RTN","GMTSRS",21,0)
RC(TYPE) ; Resequence Components
"RTN","GMTSRS",22,0)
 N DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,GMTSNN,GMTSNC,GMTSTX,GMTSC,GMTSCI,GMTSCP,GMTSCN,GMTSI,GMTS,GMTSRO,GMTST,GMTSTR,GMTSCC
"RTN","GMTSRS",23,0)
 N %,I,X,Y,Z,DIWL,DIWR,DIWF,DIW,DIWI,DIWT,DIWTC,DIWX,DN,DA
"RTN","GMTSRS",24,0)
 S GMTST=+($G(TYPE)) Q:+GMTST=0  Q:'$D(^GMT(142,+GMTST,0))  Q:'$L($P($G(^GMT(142,+GMTST,0)),"^",1))  S U="^",GMTSCC=$$CS(GMTST) Q:+GMTSCC'>1
"RTN","GMTSRS",25,0)
 S (GMTSTX,X)="Health Summary Type '"_$P($G(^GMT(142,+GMTST,0)),"^",1)_"' has "_GMTSCC_" Health Summary Components, do you want to resequence them now?"
"RTN","GMTSRS",26,0)
 K ^UTILITY($J,"W") S DIWL=0,DIWF="C60" D ^DIWP S GMTSNN="^UTILITY("_$J_",""W"")",GMTSNC="^UTILITY("_$J_",""W"","
"RTN","GMTSRS",27,0)
 S GMTSC=0 F  S GMTSNN=$Q(@GMTSNN) Q:GMTSNN=""!(GMTSNN'[GMTSNC)  I GMTSNN'["""W"",0)" S GMTSC=GMTSC+1,DIR("A",GMTSC)=@GMTSNN
"RTN","GMTSRS",28,0)
 Q:+GMTSC'>0  K ^UTILITY($J,"W") S DIR("A")=$G(DIR("A",GMTSC))_" (Y/N)  " K DIR("A",GMTSC)
"RTN","GMTSRS",29,0)
 W ! S (GMTSCN,GMTSCI)=0,GMTSCP="" F  S GMTSCI=$O(^GMT(142,+GMTST,1,GMTSCI)) Q:+GMTSCI=0  D
"RTN","GMTSRS",30,0)
 . S GMTSCP=+($P($G(^GMT(142,+GMTST,1,GMTSCI,0)),"^",2)) Q:+GMTSCP'>0
"RTN","GMTSRS",31,0)
 . S GMTSCP=$P($G(^GMT(142.1,+GMTSCP,0)),"^",1) Q:'$L(GMTSCP)
"RTN","GMTSRS",32,0)
 . S GMTSCN=+($G(GMTSCN))+1 W !,?1,$J(GMTSCN,3),"  ",GMTSCP
"RTN","GMTSRS",33,0)
 S DIR(0)="YAO",DIR("?")="^D YN^GMTSRS3",DIR("??")="^D SC^GMTSRS3",DIR("B")="N"
"RTN","GMTSRS",34,0)
 W ! D ^DIR S GMTSRO=0 S:+($G(Y))>0 GMTSRO=1 W ! S DA(1)=+($G(GMTST)) D RCS^GMTSRS1
"RTN","GMTSRS",35,0)
 Q
"RTN","GMTSRS",36,0)
RSI(TYPE) ; Resequence Selection Items
"RTN","GMTSRS",37,0)
 N DIC,DIR,DIROUT,DIRUT,DTOUT,DUOUT,GMTSNN,GMTSNC,GMTSS,GMTSSI,GMTSTX
"RTN","GMTSRS",38,0)
 N GMTSC,GMTSCI,GMTSCP,GMTSCN,GMTSI,GMTS,GMTSRO,GMTST,GMTSTR,GMTSCC,%,I,X,Y,Z
"RTN","GMTSRS",39,0)
 N DIWL,DIWR,DIWF,DIW,DIWI,DIWT,DIWTC,DIWX,DN,DA
"RTN","GMTSRS",40,0)
 S GMTST=+($G(TYPE)) Q:+GMTST=0  Q:'$D(^GMT(142,+GMTST,0))
"RTN","GMTSRS",41,0)
 Q:'$L($P($G(^GMT(142,+GMTST,0)),"^",1))
"RTN","GMTSRS",42,0)
 S U="^",GMTSCC=$$CSI(GMTST) Q:+GMTSCC'>0
"RTN","GMTSRS",43,0)
 S X="Health Summary Type '"_$P($G(^GMT(142,+GMTST,0)),"^",1)
"RTN","GMTSRS",44,0)
 S X=X_"' has "_$S(+GMTSCC>1:GMTSCC,1:"one")_" Health Summary Component"_$S(+GMTSCC>1:"s",1:"")
"RTN","GMTSRS",45,0)
 S X=X_" with multiple selection items."
"RTN","GMTSRS",46,0)
 S:GMTSCC=1 X=X_"  Do you want to resequence those selection items now?"
"RTN","GMTSRS",47,0)
 S:GMTSCC>1 X=X_"  Do you want to resequence any of those selection items now?"
"RTN","GMTSRS",48,0)
 K ^UTILITY($J,"W") S DIWL=0,DIWF="C60" D ^DIWP S GMTSNN="^UTILITY("_$J_",""W"")",GMTSNC="^UTILITY("_$J_",""W"","
"RTN","GMTSRS",49,0)
 S GMTSC=0 F  S GMTSNN=$Q(@GMTSNN) Q:GMTSNN=""!(GMTSNN'[GMTSNC)  I GMTSNN'["""W"",0)" S GMTSC=GMTSC+1,DIR("A",GMTSC)=@GMTSNN
"RTN","GMTSRS",50,0)
 Q:+GMTSC'>0  K ^UTILITY($J,"W") S DIR("A")=$G(DIR("A",GMTSC))_" (Y/N)  " K DIR("A",GMTSC)
"RTN","GMTSRS",51,0)
 S (GMTSCN,GMTSCI)=0,GMTSCP="" F  S GMTSCI=$O(^GMT(142,+GMTST,1,GMTSCI)) Q:+GMTSCI=0  D
"RTN","GMTSRS",52,0)
 . S GMTSCP=+($P($G(^GMT(142,+GMTST,1,GMTSCI,0)),"^",2)) Q:+GMTSCP'>0
"RTN","GMTSRS",53,0)
 . S GMTSCP=$P($G(^GMT(142.1,+GMTSCP,0)),"^",1) Q:'$L(GMTSCP)
"RTN","GMTSRS",54,0)
 . S (GMTSS,GMTSSI)=0 F  S GMTSSI=$O(^GMT(142,+GMTST,1,+GMTSCI,1,GMTSSI)) Q:+GMTSSI=0  S GMTSS=+GMTSS+1
"RTN","GMTSRS",55,0)
 . Q:+GMTSS'>1  S GMTSCN=+($G(GMTSCN))+1
"RTN","GMTSRS",56,0)
 . W:GMTSCC=1 !,?4,"  ",GMTSCP
"RTN","GMTSRS",57,0)
 S DIR(0)="YAO",DIR("B")="N" W ! D ^DIR S GMTSRO=0 S:+($G(Y))>0 GMTSRO=1
"RTN","GMTSRS",58,0)
 I +($G(Y))>0 D
"RTN","GMTSRS",59,0)
 . S DA(1)=+($G(GMTST)) D:+GMTSCC=1 ONE(GMTST) D:+GMTSCC>1 MUL(GMTST)
"RTN","GMTSRS",60,0)
 I $D(GMTSRO),+($G(GMTSRO))=0 D ALL(GMTST)
"RTN","GMTSRS",61,0)
 Q
"RTN","GMTSRS",62,0)
ALL(TYPE) ; Resequence (only) All Components Selection Items
"RTN","GMTSRS",63,0)
 N DA,GMTST,GMTSCN,GMTSCI,GMTSCN,GMTSCI
"RTN","GMTSRS",64,0)
 S GMTST=+($G(TYPE)) Q:+GMTST=0  Q:'$D(^GMT(142,+GMTST,0))  S DA(2)=+GMTST
"RTN","GMTSRS",65,0)
 S (DA,GMTSCN,GMTSCI)=0 F  S GMTSCI=$O(^GMT(142,+GMTST,1,GMTSCI)) Q:+GMTSCI=0  D
"RTN","GMTSRS",66,0)
 . S DA(1)=GMTSCI Q:'$D(^GMT(142,+DA(2),1,+DA(1),1,"B"))  S GMTSRO=0
"RTN","GMTSRS",67,0)
 . I +($G(DA(2)))>0,+($G(DA(1)))>0,$D(^GMT(142,+($G(DA(2))),1,+($G(DA(1))))) D RSI^GMTSRS2
"RTN","GMTSRS",68,0)
 Q
"RTN","GMTSRS",69,0)
ONE(TYPE) ; Reorder/Resequence One Component Selection Items
"RTN","GMTSRS",70,0)
 N DA,GMTST,GMTSCN,GMTSCI,GMTSCN,GMTSCI
"RTN","GMTSRS",71,0)
 S GMTST=+($G(TYPE)) Q:+GMTST=0  Q:'$D(^GMT(142,+GMTST,0))  S DA(2)=+GMTST
"RTN","GMTSRS",72,0)
 S (DA,GMTSCN,GMTSCI)=0 F  S GMTSCI=$O(^GMT(142,+GMTST,1,GMTSCI)) Q:+GMTSCI=0  D  Q:+($G(DA(1)))>0
"RTN","GMTSRS",73,0)
 . S (GMTSS,GMTSSI)=0 F  S GMTSSI=$O(^GMT(142,+GMTST,1,+GMTSCI,1,GMTSSI)) Q:+($G(DA(1)))>0  Q:+GMTSSI=0  S GMTSS=+GMTSS+1
"RTN","GMTSRS",74,0)
 . Q:+GMTSS'>1  S DA(1)=GMTSCI
"RTN","GMTSRS",75,0)
 I +($G(DA(2)))>0,+($G(DA(1)))>0,$D(^GMT(142,+($G(DA(2))),1,+($G(DA(1))))) D RSI^GMTSRS2
"RTN","GMTSRS",76,0)
 I +($G(DA(2)))'>0!(+($G(DA(1)))'>0)!('$D(^GMT(142,+($G(DA(2))),1,+($G(DA(1)))))) Q
"RTN","GMTSRS",77,0)
 Q
"RTN","GMTSRS",78,0)
MUL(TYPE) ; Reorder/Resequence Multiple Components
"RTN","GMTSRS",79,0)
 N GMTST,GMTSCW,GMTSMAX
"RTN","GMTSRS",80,0)
 S GMTST=+($G(TYPE)) Q:+GMTST=0  Q:'$D(^GMT(142,+GMTST,0))
"RTN","GMTSRS",81,0)
 D ARY(+($G(GMTST)),.GMTSCW) S GMTSMAX=+($G(GMTSCW(0))) Q:+GMTSMAX'>1
"RTN","GMTSRS",82,0)
 F  S X=$$MUL2(GMTST,GMTSMAX,.GMTSCW) Q:+($G(X))'>0
"RTN","GMTSRS",83,0)
 Q
"RTN","GMTSRS",84,0)
MUL2(GMTST,GMTSMAX,GMTSCW) ; Multiple Component Selection
"RTN","GMTSRS",85,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,GMTS,GMTSA,GMTSC,GMTSI,GMTSN,GMTSTR
"RTN","GMTSRS",86,0)
 N GMTSTX,X,Y
"RTN","GMTSRS",87,0)
 S DIR(0)="NAO^1:"_GMTSMAX_":0"
"RTN","GMTSRS",88,0)
 S (DIR("?"),DIR("??"))="^D MULH^GMTSRS"
"RTN","GMTSRS",89,0)
 S DIR("A",1)="The following Components have multiple Selection Items:"
"RTN","GMTSRS",90,0)
 S DIR("A",2)=" "
"RTN","GMTSRS",91,0)
 S (GMTSI,GMTSC)=0 F  S GMTSI=$O(GMTSCW(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS",92,0)
 . S GMTSN=$P($G(GMTSCW(GMTSI)),"^",2) Q:'$L(GMTSN)
"RTN","GMTSRS",93,0)
 . S GMTSC=GMTSC+1,GMTSA=GMTSC+2,DIR("A",GMTSA)="    "_$J(GMTSC,2)_"  "_GMTSN
"RTN","GMTSRS",94,0)
 S GMTSA=+($O(DIR("A"," "),-1))+1,DIR("A",GMTSA)=" "
"RTN","GMTSRS",95,0)
 S DIR("A")="To resequence Selection Items, select 1-"_GMTSMAX_":  "
"RTN","GMTSRS",96,0)
 W ! D ^DIR
"RTN","GMTSRS",97,0)
 Q:+Y'>0 -1
"RTN","GMTSRS",98,0)
 S:X="" (X,Y)=-1 S X=-1 S:+Y>0 X=+($G(GMTSCW(+Y)))
"RTN","GMTSRS",99,0)
 S:$D(DIROUT)!($D(DIRUT))!($D(DTOUT))!($D(DUOUT)) X=-1
"RTN","GMTSRS",100,0)
 S Y=X D:+Y>0 Y(+($G(GMTST)),+Y) S DA(2)=+($G(GMTST)) S:+Y>0 DA(1)=+Y
"RTN","GMTSRS",101,0)
 I +($G(DA(2)))>0,+($G(DA(1)))>0,$D(^GMT(142,+($G(DA(2))),1,+($G(DA(1))))) D RSI^GMTSRS2
"RTN","GMTSRS",102,0)
 S GMTST=+Y
"RTN","GMTSRS",103,0)
 Q GMTST
"RTN","GMTSRS",104,0)
MULH ; Multiple Structure Selection Help
"RTN","GMTSRS",105,0)
 W !!,"Select 1-"_GMTSMAX_" to resequence, or return or '^' to exit.",!
"RTN","GMTSRS",106,0)
 Q
"RTN","GMTSRS",107,0)
Y(TYPE,COMP) ; Results for Y
"RTN","GMTSRS",108,0)
 N GMTSS,GMTST S GMTST=+($G(TYPE)),GMTSS=+($G(COMP)) Q:'$D(^GMT(142,+GMTST))
"RTN","GMTSRS",109,0)
 I +GMTSS>0,($D(^GMT(142,+($G(GMTST)),1,+GMTSS,0))) D
"RTN","GMTSRS",110,0)
 . S Y=+GMTSS,Y(0)=$G(^GMT(142,+($G(GMTST)),1,+GMTSS,0)),Y(142.1)=+($P($G(^GMT(142,+($G(GMTST)),1,+GMTSS,0)),"^",2))
"RTN","GMTSRS",111,0)
 . S Y(142.1,0)=$G(^GMT(142.1,+($P($G(^GMT(142,+($G(GMTST)),1,+GMTSS,0)),"^",2)),0))
"RTN","GMTSRS",112,0)
 Q
"RTN","GMTSRS",113,0)
CS(X) ; Components
"RTN","GMTSRS",114,0)
 N GMTSI,GMTSC,GMTSCI S (GMTSC,GMTSCI)=0,GMTSI=+($G(X)) Q:+GMTSI'>0 0
"RTN","GMTSRS",115,0)
 F  S GMTSCI=$O(^GMT(142,+GMTSI,1,GMTSCI)) Q:+GMTSCI=0  S GMTSC=GMTSC+1
"RTN","GMTSRS",116,0)
 S X=GMTSC Q X
"RTN","GMTSRS",117,0)
 ;
"RTN","GMTSRS",118,0)
CSI(X) ; Components with Multiple Selection Types
"RTN","GMTSRS",119,0)
 N GMTSI,GMTSS,GMTSSI,GMTSC,GMTSCI,GMTSEL S (GMTSEL,GMTSC,GMTSCI)=0,GMTSI=+($G(X)) Q:+GMTSI'>0 0
"RTN","GMTSRS",120,0)
 F  S GMTSCI=$O(^GMT(142,+GMTSI,1,GMTSCI)) Q:+GMTSCI=0  D
"RTN","GMTSRS",121,0)
 . S (GMTSS,GMTSSI)=0
"RTN","GMTSRS",122,0)
 . F  S GMTSSI=$O(^GMT(142,GMTSI,1,GMTSCI,1,GMTSSI)) Q:+GMTSSI=0  D
"RTN","GMTSRS",123,0)
 . . S GMTSS=+($G(GMTSS))+1
"RTN","GMTSRS",124,0)
 . S:+($G(GMTSS))>1 GMTSEL=+($G(GMTSEL))+1
"RTN","GMTSRS",125,0)
 S X=GMTSEL Q X
"RTN","GMTSRS",126,0)
 ;
"RTN","GMTSRS",127,0)
ARY(X,ARY) ; Array of Components with Multiple Selection Types
"RTN","GMTSRS",128,0)
 N GMTSI,GMTSS,GMTSSI,GMTSC,GMTSCI,GMTSEL,GMTSSN S (GMTSC,GMTSCI,GMTSSN,GMTSEL)=0,GMTSI=+($G(X)) Q:+GMTSI'>0
"RTN","GMTSRS",129,0)
 F  S GMTSCI=$O(^GMT(142,+GMTSI,1,GMTSCI)) Q:+GMTSCI=0  D
"RTN","GMTSRS",130,0)
 . S (GMTSS,GMTSSI)=0 F  S GMTSSI=$O(^GMT(142,GMTSI,1,GMTSCI,1,GMTSSI)) Q:+GMTSSI=0  S GMTSS=+($G(GMTSS))+1
"RTN","GMTSRS",131,0)
 . I +($G(GMTSS))>1 S GMTSEL=+($G(GMTSEL))+1,ARY(GMTSEL)=+GMTSCI_"^"_$P(^GMT(142.1,+($P($G(^GMT(142,+GMTSI,1,GMTSCI,0)),"^",2)),0),"^",1),ARY(0)=GMTSEL
"RTN","GMTSRS",132,0)
 Q
"RTN","GMTSRS",133,0)
TRIM(X) ; Remove Spaces
"RTN","GMTSRS",134,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSRS",135,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSRS",136,0)
 Q X
"RTN","GMTSRS1")
0^6^B36733601
"RTN","GMTSRS1",1,0)
GMTSRS1 ; SLC/KER - Component Structure Resequence      ; 02/11/2003
"RTN","GMTSRS1",2,0)
 ;;2.7;Health Summary;**62**;Oct 20, 1995
"RTN","GMTSRS1",3,0)
 ;
"RTN","GMTSRS1",4,0)
 ; External References
"RTN","GMTSRS1",5,0)
 ;   DBIA 10076  ^XUSEC(
"RTN","GMTSRS1",6,0)
 ;   DBIA 10076  ^XUSEC("GMTSMGR"
"RTN","GMTSRS1",7,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSRS1",8,0)
 ;   DBIA 10006  ^DIC  (file #142)
"RTN","GMTSRS1",9,0)
 ;   DBIA  2054  $$CREF^DILF
"RTN","GMTSRS1",10,0)
 ;   DBIA 10013  IX1^DIK
"RTN","GMTSRS1",11,0)
 ;                                            
"RTN","GMTSRS1",12,0)
 ; This routine will resequence the Health Summary Components
"RTN","GMTSRS1",13,0)
 ; in the structure (sub-file 142.01) of a Health Summary 
"RTN","GMTSRS1",14,0)
 ; Type (file 142)
"RTN","GMTSRS1",15,0)
 ;                 
"RTN","GMTSRS1",16,0)
EN ; Main Entry Point
"RTN","GMTSRS1",17,0)
 N DA,DIK,GMTST,GMTSS,GMTSERR,X,Y
"RTN","GMTSRS1",18,0)
 W !,"Resequence the Components of a Health Summary Type.",!
"RTN","GMTSRS1",19,0)
 D LKT I +Y'>0 W !,"Health Summary Type not selected ",! Q
"RTN","GMTSRS1",20,0)
 S GMTST=+Y,DA(1)=GMTST D RCS K DA S DA=GMTST,DIK="^GMT(142," D IX1^DIK
"RTN","GMTSRS1",21,0)
 Q
"RTN","GMTSRS1",22,0)
 ;
"RTN","GMTSRS1",23,0)
RCS ; Resequence Component Structure - Needs DA array 
"RTN","GMTSRS1",24,0)
 N ARY,INA,OPA,GMTST,GMTSINM,GMTSMAX K ARY,INA,OPA D INA^GMTSRS1B(DA(1),.ARY)
"RTN","GMTSRS1",25,0)
 S GMTSINM=$$MAX(.ARY) I +GMTSINM'>0 W !,"Can not resequence, no components found." Q
"RTN","GMTSRS1",26,0)
 I +GMTSINM'>1 W !,"Resequencing not required (1 component)" Q
"RTN","GMTSRS1",27,0)
 F  D RESEQ(.ARY)  Q:'$D(ARY)
"RTN","GMTSRS1",28,0)
 S GMTSMAX=$$MAX(.OPA) I +GMTSINM'=+GMTSMAX W !,"Component structure not resequenced (sequence not fully specified)" Q
"RTN","GMTSRS1",29,0)
 D:+GMTSMAX>0 VER(.INA,.OPA,DA(1))
"RTN","GMTSRS1",30,0)
 Q
"RTN","GMTSRS1",31,0)
 ;
"RTN","GMTSRS1",32,0)
RESEQ(ARY) ; Resequence - .ARY
"RTN","GMTSRS1",33,0)
 N GMTSNXT,GMTSI,GMTSIN,GMTSOP,GMTS,GMTS0,GMTS1,GMTSS,GMTSC,GMTSMAX
"RTN","GMTSRS1",34,0)
 D RES^GMTSRS1B(.ARY) S GMTSMAX=$$MAX(.ARY)
"RTN","GMTSRS1",35,0)
 I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0)) W:+GMTSMAX>1 !,"Resequence Components:",!
"RTN","GMTSRS1",36,0)
 I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0)) D:+GMTSMAX>1 DIS^GMTSRS1B(.ARY)
"RTN","GMTSRS1",37,0)
 S GMTSNXT=$$ASK(.ARY)
"RTN","GMTSRS1",38,0)
 F  Q:$E(GMTSNXT,$L(GMTSNXT))'=","  S GMTSNXT=$E(GMTSNXT,1,($L(GMTSNXT)-1))
"RTN","GMTSRS1",39,0)
 K:+GMTSNXT'>0 ARY Q:+GMTSNXT'>0  S GMTSI=0 F GMTSI=1:1 Q:+($P(GMTSNXT,",",GMTSI))'>0  D
"RTN","GMTSRS1",40,0)
 . N GMTSIN,GMTSOP,GMTS0,GMTS1 S GMTSIN=+($P(GMTSNXT,",",GMTSI))
"RTN","GMTSRS1",41,0)
 . S GMTS=$G(ARY(GMTSIN)) Q:'$L(GMTS)  S GMTS0=$G(ARY(GMTSIN,0)) Q:'$L(GMTS0)
"RTN","GMTSRS1",42,0)
 . S GMTSOP=+($O(OPA(" "),-1))+1,OPA(GMTSOP)=GMTS,OPA(GMTSOP,0)=GMTS0
"RTN","GMTSRS1",43,0)
 . S (GMTSC,GMTSS)=0 F  S GMTSS=$O(ARY(GMTSIN,GMTSS)) Q:+GMTSS=0  D
"RTN","GMTSRS1",44,0)
 . . I $L($G(ARY(GMTSIN,GMTSS))) D
"RTN","GMTSRS1",45,0)
 . . . S GMTSC=+GMTSC+1,OPA(GMTSOP,GMTSC)=ARY(GMTSIN,GMTSS)
"RTN","GMTSRS1",46,0)
 . K ARY(GMTSIN)
"RTN","GMTSRS1",47,0)
 Q
"RTN","GMTSRS1",48,0)
 ;
"RTN","GMTSRS1",49,0)
ASK(ARY,X) ; Ask for order of Components
"RTN","GMTSRS1",50,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,GMTSMAX,Y,GMTSF,GMTSI
"RTN","GMTSRS1",51,0)
 S GMTSMAX=$$MAX(.ARY) Q:+GMTSMAX=1 1  Q:+GMTSMAX'>0 ""
"RTN","GMTSRS1",52,0)
 F GMTSI=1:1:GMTSMAX S GMTSF=$G(GMTSF)_GMTSI_","
"RTN","GMTSRS1",53,0)
 I $D(GMTSRO),+GMTSRO=0 S X=GMTSF Q X
"RTN","GMTSRS1",54,0)
 S DIR(0)="LAO^1:"_GMTSMAX_":0"
"RTN","GMTSRS1",55,0)
 S DIR("A")="Select next component(s)" S:GMTSMAX>1 DIR("A")=DIR("A")_" 1-"_GMTSMAX
"RTN","GMTSRS1",56,0)
 S DIR("A")=DIR("A")_":  ",DIR("B")=1 W ! D ^DIR
"RTN","GMTSRS1",57,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) K ARY S X=-1 Q X
"RTN","GMTSRS1",58,0)
 S X=Y Q X
"RTN","GMTSRS1",59,0)
 ;
"RTN","GMTSRS1",60,0)
MAX(ARY,X) ; Maximum # Components
"RTN","GMTSRS1",61,0)
 N GMTSI S (GMTSI,X)=0 F  S GMTSI=$O(ARY(GMTSI)) Q:+GMTSI=0  S X=X+1
"RTN","GMTSRS1",62,0)
 Q X
"RTN","GMTSRS1",63,0)
 ;
"RTN","GMTSRS1",64,0)
VER(INA,OPA,GMTST) ; Verify Resequence
"RTN","GMTSRS1",65,0)
 I $D(GMTSRO),+GMTSRO=0 G VER2
"RTN","GMTSRS1",66,0)
 N GMTSI1,GMTSI2,GMTSI,GMTSC,GMTSON,GMTSNN,GMTSCHG,GMTSVAL,GMTSEX
"RTN","GMTSRS1",67,0)
 N GMTS3,GMTS4,X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,DA,DIK
"RTN","GMTSRS1",68,0)
 S GMTSI1=+($G(GMTST)) Q:+GMTSI1=0  S (GMTSI,GMTSC,GMTSCHG)=0,(GMTSI,GMTSC)=0
"RTN","GMTSRS1",69,0)
 F  S GMTSI=$O(INA(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS1",70,0)
 . S GMTSON=$P($G(INA(GMTSI,0)),"^",3),GMTSNN=$P($G(OPA(GMTSI,0)),"^",3) S:GMTSON'=GMTSNN GMTSCHG=1
"RTN","GMTSRS1",71,0)
 I 'GMTSCHG,'$D(GMTSRO) W !,"No changes in the Health Summary Component sequence." G VER2
"RTN","GMTSRS1",72,0)
 S GMTSI=0 F  S GMTSI=$O(INA(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS1",73,0)
 . S GMTSON=$G(INA(GMTSI)),GMTSNN=$G(OPA(GMTSI)) Q:'$L(GMTSON)  Q:'$L(GMTSNN)
"RTN","GMTSRS1",74,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 !!,?8,"Old Sequence",?40,"New Sequence",!,?8,"------------------------",?40,"------------------------"
"RTN","GMTSRS1",75,0)
 . W !,$J(GMTSC,5),?8,GMTSON,?40,GMTSNN
"RTN","GMTSRS1",76,0)
 S DIR(0)="YAO",DIR("A")="Is this Correct:  (Y/N)  ",DIR("B")="Y" W ! D ^DIR
"RTN","GMTSRS1",77,0)
 I +($G(Y))'>0 W !,"Components not resequenced" Q
"RTN","GMTSRS1",78,0)
VER2 S DA(2)=+($G(GMTST)) K ^GMT(142,DA(2),1)
"RTN","GMTSRS1",79,0)
 S GMTSI1=0 F  S GMTSI1=$O(OPA(GMTSI1)) Q:+GMTSI1=0  D
"RTN","GMTSRS1",80,0)
 . S DA(1)=(+($G(GMTSI1)))*5,DA=0 S GMTSEX="S "_$G(OPA(GMTSI1,0)) X GMTSEX
"RTN","GMTSRS1",81,0)
 . K ^GMT(142,"AE",+($P($G(OPA(GMTSI1,0)),"^",3)),GMTST)
"RTN","GMTSRS1",82,0)
 . S GMTSI2=0 F  S GMTSI2=$O(OPA(GMTSI1,GMTSI2)) Q:+GMTSI2=0  D
"RTN","GMTSRS1",83,0)
 . . S DA=GMTSI2-1 S GMTSEX="S "_$G(OPA(GMTSI1,GMTSI2)) X GMTSEX
"RTN","GMTSRS1",84,0)
 S (DA,GMTS3,GMTS4)=0 F  S DA=$O(^GMT(142,DA(2),1,DA)) Q:+DA=0  S GMTS4=+($G(GMTS4))+1,GMTS3=DA
"RTN","GMTSRS1",85,0)
 S ^GMT(142,DA(2),1,0)="^142.01IA^"_GMTS3_"^"_GMTS4
"RTN","GMTSRS1",86,0)
 K DA S DA=+($G(GMTST)),DIK="^GMT(142," D IX1^DIK
"RTN","GMTSRS1",87,0)
 Q
"RTN","GMTSRS1",88,0)
 ; K ^GMT(142,"AE",GMTSCMP,GMTST)
"RTN","GMTSRS1",89,0)
 ;
"RTN","GMTSRS1",90,0)
LKT ; Lookup HS Type
"RTN","GMTSRS1",91,0)
 N DIC,DIR,DTOUT,DUOUT,DIRUT,DIROUT,GMTSERR
"RTN","GMTSRS1",92,0)
 ;
"RTN","GMTSRS1",93,0)
LKT2 ;   Re-prompt for Type
"RTN","GMTSRS1",94,0)
 S GMTSERR=0,DIC="^GMT(142,",DIC("S")="I +($$ST^GMTSRS1)>0",DIC(0)="AEMQZF"
"RTN","GMTSRS1",95,0)
 S DIC("A")="Select a Health Summary Type:  "
"RTN","GMTSRS1",96,0)
 D ^DIC I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) S Y=-1 Q
"RTN","GMTSRS1",97,0)
 I +($G(GMTSERR))>0 D DTE(+($G(GMTSERR))) G LKT2
"RTN","GMTSRS1",98,0)
 I +Y>0 D
"RTN","GMTSRS1",99,0)
 . N X,DIC S X=$P(Y,"^",2),DIC="^GMT(142,",DIC(0)="M" D ^DIC
"RTN","GMTSRS1",100,0)
 Q
"RTN","GMTSRS1",101,0)
 ;
"RTN","GMTSRS1",102,0)
ST(X) ;   Screen for Type - Assumes Y
"RTN","GMTSRS1",103,0)
 N GMTSY,GMTSO,GMTSS,GMTSU,GMTSKEY,GMTSLOCK,GMTSN0,GMTSMGR
"RTN","GMTSRS1",104,0)
 S GMTSO=0,GMTSY=+($G(Y)) S:+GMTSY'>0 GMTSERR=1 Q:+GMTSY'>0 1
"RTN","GMTSRS1",105,0)
 S GMTSN0=$G(^GMT(142,+GMTSY,0)) S:'$L(GMTSN0) GMTSERR=2 Q:'$L(GMTSN0) 1
"RTN","GMTSRS1",106,0)
 S GMTSKEY=$P(GMTSN0,"^",2),GMTSU=$P(GMTSN0,"^",3)
"RTN","GMTSRS1",107,0)
 S GMTSMGR=$S($D(^XUSEC("GMTSMGR",+($G(DUZ)))):1,1:0) S GMTSLOCK=0
"RTN","GMTSRS1",108,0)
 S:$L(GMTSKEY) GMTSLOCK=$S($D(^XUSEC(GMTSKEY,+($G(DUZ)))):0,1:1)
"RTN","GMTSRS1",109,0)
 S:$P(GMTSN0,"^",1)="GMTS HS ADHOC OPTION" GMTSERR=3 Q:$P(GMTSN0,"^",1)="GMTS HS ADHOC OPTION" 1
"RTN","GMTSRS1",110,0)
 S:+($G(^GMT(142,+GMTSY,"VA")))>0 GMTSERR=6 Q:+($G(^GMT(142,+GMTSY,"VA")))>0 1
"RTN","GMTSRS1",111,0)
 S (GMTSO,GMTSS)=0 F  S GMTSS=$O(^GMT(142,+GMTSY,1,GMTSS)) Q:+GMTSS=0  D  Q:GMTSO>1
"RTN","GMTSRS1",112,0)
 . S GMTSO=+($G(GMTSO))+1
"RTN","GMTSRS1",113,0)
 S X=GMTSO S:+X'>0 GMTSERR=7 S:+X=1 GMTSERR=8
"RTN","GMTSRS1",114,0)
 Q 1
"RTN","GMTSRS1",115,0)
 ;
"RTN","GMTSRS1",116,0)
DTE(X) ;   Display Type Error
"RTN","GMTSRS1",117,0)
 I +($G(X))=1 W !!,"     No Health Summary Type selected.",! Q
"RTN","GMTSRS1",118,0)
 I +($G(X))=2 W !!,"     Health Summary Type not found.",! Q
"RTN","GMTSRS1",119,0)
 I +($G(X))=3 W !!,"     Can not resequence AD HOC Health Summary Type.",! Q
"RTN","GMTSRS1",120,0)
 I +($G(X))=4 W !!,"     Health Summary Type LOCKED",! Q
"RTN","GMTSRS1",121,0)
 I +($G(X))=5 W !!,"     Can not resequence a Health Summary Type you do not own.",! Q
"RTN","GMTSRS1",122,0)
 I +($G(X))=6 W !!,"     Can not resequence a Nationally exported Health Summary Type.",! Q
"RTN","GMTSRS1",123,0)
 I +($G(X))=7 W !!,"     Health Summary Type does not have any components." Q
"RTN","GMTSRS1",124,0)
 I +($G(X))=8 W !!,"     Can not resequence, selected Health Summary Type only has",!,"     one (1) component.",! Q
"RTN","GMTSRS1",125,0)
 Q
"RTN","GMTSRS1B")
0^7^B8179439
"RTN","GMTSRS1B",1,0)
GMTSRS1B ; SLC/KER - Component Structure Resequence 2     ; 02/11/2003
"RTN","GMTSRS1B",2,0)
 ;;2.7;Health Summary;**62**;Oct 20, 1995
"RTN","GMTSRS1B",3,0)
 ;
"RTN","GMTSRS1B",4,0)
 Q
"RTN","GMTSRS1B",5,0)
RES(ARY) ; Reset Input Array - .ARY
"RTN","GMTSRS1B",6,0)
 N GMTSI,GMTSC,GMTSI2,GMTSC2,GMTS S (GMTSI,GMTSC)=0
"RTN","GMTSRS1B",7,0)
 F  S GMTSI=$O(ARY(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS1B",8,0)
 . S:$L($G(ARY(GMTSI))) GMTS(GMTSI)=$G(ARY(GMTSI))
"RTN","GMTSRS1B",9,0)
 . S:$L($G(ARY(GMTSI,0))) GMTS(GMTSI,0)=$G(ARY(GMTSI,0))
"RTN","GMTSRS1B",10,0)
 . S GMTSC=0 F  S GMTSC=$O(ARY(GMTSI,GMTSC)) Q:+GMTSC=0  D
"RTN","GMTSRS1B",11,0)
 . . I +GMTSC=0 S GMTS(GMTSI,0)=$G(ARY(GMTSI,+GMTSC)) Q
"RTN","GMTSRS1B",12,0)
 . . S GMTS(GMTSI,GMTSC)=$G(ARY(GMTSI,GMTSC))
"RTN","GMTSRS1B",13,0)
 S (GMTSI,GMTSC,GMTSI2,GMTSC2)=0 K ARY
"RTN","GMTSRS1B",14,0)
 F  S GMTSI=$O(GMTS(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS1B",15,0)
 . S GMTSI2=+($G(GMTSI2))+1 S:$L($G(GMTS(GMTSI))) ARY(GMTSI2)=$G(GMTS(GMTSI))
"RTN","GMTSRS1B",16,0)
 . S:$L($G(GMTS(GMTSI,0))) ARY(GMTSI2,0)=$G(GMTS(GMTSI,0))
"RTN","GMTSRS1B",17,0)
 . S (GMTSC,GMTSC2)=0 F  S GMTSC=$O(GMTS(GMTSI,GMTSC)) Q:+GMTSC=0  D
"RTN","GMTSRS1B",18,0)
 . . S GMTSC2=+($G(GMTSC2))+1,ARY(GMTSI2,GMTSC2)=$G(GMTS(GMTSI,GMTSC))
"RTN","GMTSRS1B",19,0)
 Q
"RTN","GMTSRS1B",20,0)
 ;
"RTN","GMTSRS1B",21,0)
DIS(ARY) ; Display Array - .ARY
"RTN","GMTSRS1B",22,0)
 N GMTSI,GMTSCMP S GMTSI=0
"RTN","GMTSRS1B",23,0)
 F  S GMTSI=$O(ARY(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS1B",24,0)
 . S GMTSCMP=$G(ARY(GMTSI)) W !,$J(GMTSI,4),"  ",GMTSCMP
"RTN","GMTSRS1B",25,0)
 Q
"RTN","GMTSRS1B",26,0)
 ;
"RTN","GMTSRS1B",27,0)
INA(GMTST,ARY) ; Creates Input Array
"RTN","GMTSRS1B",28,0)
 N DA,GMTSS,GMTSC,GMTSI,GMTSVAL,GMTSPTR,GMTSFRT,GMTSCRT,GMTSFFRT
"RTN","GMTSRS1B",29,0)
 N GMTSFCRT,GMTSRT,GMTSUB,GMTSTYP,GMTSNN,GMTSNC,GMTSNR,GMTSCMP
"RTN","GMTSRS1B",30,0)
 N GMTSCMPI,GMTSND,GMTSNE
"RTN","GMTSRS1B",31,0)
 S DA(1)=+($G(GMTST)) Q:+DA(1)'>0  Q:'$D(^GMT(142,+DA(1)))
"RTN","GMTSRS1B",32,0)
 S (GMTSS,GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,DA(1),1,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS1B",33,0)
 . S GMTSVAL=$G(^GMT(142,DA(1),1,GMTSI,0)),GMTSCMPI=+($P(GMTSVAL,"^",2))
"RTN","GMTSRS1B",34,0)
 . K ^GMT(142,"AE",+GMTSCMPI,DA(1),GMTSI) S GMTSCMP=$P($G(^GMT(142.1,+GMTSCMPI,0)),"^",9)
"RTN","GMTSRS1B",35,0)
 . S:'$L(GMTSCMP) GMTSCMP=$E($P($G(^GMT(142.1,+($P(GMTSVAL,"^",2)),0)),"^",1),1,20)
"RTN","GMTSRS1B",36,0)
 . Q:'$L(GMTSCMP)  S GMTSS=+($G(GMTSS))+1,ARY(GMTSS)=GMTSCMP,INA(GMTSS)=GMTSCMP
"RTN","GMTSRS1B",37,0)
 . S ARY(GMTSS,0)="^GMT(142,DA(2),1,DA(1),0)=(DA(1)_""^"_$P(GMTSVAL,"^",2,299)_""")"
"RTN","GMTSRS1B",38,0)
 . S INA(GMTSS,0)="^GMT(142,DA(2),1,DA(1),0)=(DA(1)_""^"_$P(GMTSVAL,"^",2,299)_""")"
"RTN","GMTSRS1B",39,0)
 . S DA=GMTSI,GMTSNN="^GMT(142,"_DA(1)_",1,"_DA_",1)",GMTSNC="^GMT(142,"_DA(1)_",1,"_DA_",1,"
"RTN","GMTSRS1B",40,0)
 . S GMTSC=0 F  S GMTSNN=$Q(@GMTSNN) Q:'$L(GMTSNN)!(GMTSNN'[GMTSNC)  D
"RTN","GMTSRS1B",41,0)
 . . S GMTSNR="^GMT(142,DA(2),1,DA(1),1,",GMTSNE=$P(GMTSNN,",",6,299)
"RTN","GMTSRS1B",42,0)
 . . S:$E(GMTSNE,1)="0" GMTSNR=GMTSNR_"0)" S:+GMTSNE>0 GMTSNR=GMTSNR_"DA,"_$P(GMTSNE,",",2,299)
"RTN","GMTSRS1B",43,0)
 . . Q:+GMTSNE'>0&($E(GMTSNE,1)'="0")  S GMTSND=""""_@GMTSNN_"""",GMTSC=+($G(GMTSC))+1
"RTN","GMTSRS1B",44,0)
 . . S ARY(GMTSS,GMTSC)=GMTSNR_"="_GMTSND,INA(GMTSS,GMTSC)=GMTSNR_"="_GMTSND
"RTN","GMTSRS1B",45,0)
 Q
"RTN","GMTSRS2")
0^8^B77552907
"RTN","GMTSRS2",1,0)
GMTSRS2 ; SLC/KER - Selection Items Resequence      ; 02/11/2003 [6/13/03 10:30am]
"RTN","GMTSRS2",2,0)
 ;;2.7;Health Summary;**62**;Oct 20, 1995
"RTN","GMTSRS2",3,0)
 ;
"RTN","GMTSRS2",4,0)
 ; External References
"RTN","GMTSRS2",5,0)
 ;   DBIA 10076  ^XUSEC(
"RTN","GMTSRS2",6,0)
 ;   DBIA 10076  ^XUSEC("GMTSMGR"
"RTN","GMTSRS2",7,0)
 ;   DBIA 10026  ^DIR
"RTN","GMTSRS2",8,0)
 ;   DBIA 10006  ^DIC  (file #142)
"RTN","GMTSRS2",9,0)
 ;   DBIA  2054  $$CREF^DILF
"RTN","GMTSRS2",10,0)
 ;   DBIA 10013  IX1^DIK
"RTN","GMTSRS2",11,0)
 ;          
"RTN","GMTSRS2",12,0)
 ; This routine will resequence the selection items (sub-file 
"RTN","GMTSRS2",13,0)
 ; 142.14) of a Health Component in the structure (sub-file 
"RTN","GMTSRS2",14,0)
 ; 142.01) of a Health Summary Type (file 142)
"RTN","GMTSRS2",15,0)
 ;          
"RTN","GMTSRS2",16,0)
EN ; Main Entry Point
"RTN","GMTSRS2",17,0)
 N DA,GMTST,GMTSS,GMTSERR,X,Y D LKT Q:+Y'>0  S GMTST=+Y D LKS Q:+Y'>0  S GMTSS=+Y
"RTN","GMTSRS2",18,0)
 S DA(2)=GMTST,DA(1)=GMTSS D RSI
"RTN","GMTSRS2",19,0)
 Q
"RTN","GMTSRS2",20,0)
RSI ; Resequence Selection Items
"RTN","GMTSRS2",21,0)
 N ARY,INA,OPA,X,Y,DIC,DIK,DIR,DIROUT,DIRUT,DTOUT,DUOUT,GMTSO,GMTS1
"RTN","GMTSRS2",22,0)
 N GMTSAC,GMTSAI,GMTSC,GMTSCHG,GMTSCOL,GMTSERR,GMTSF,GMTSHDR,GMTSI
"RTN","GMTSRS2",23,0)
 N GMTSI1,GMTSI2,GMTSIN,GMTSINM,GMTSKEY,GMTSLOCK,GMTSMAX
"RTN","GMTSRS2",24,0)
 N GMTSMGR,GMTSO,GMTSON,GMTSOP,GMTSPIE,GMTSRO,GMTSROOT,GMTSS
"RTN","GMTSRS2",25,0)
 N GMTST,GMTSU,GMTSVAL,GMTSY W ! K ARY,INA,OPA
"RTN","GMTSRS2",26,0)
 D INA^GMTSRS2B(DA(2),DA(1),.ARY)
"RTN","GMTSRS2",27,0)
 S GMTSINM=$$MAX(.ARY)
"RTN","GMTSRS2",28,0)
 I +GMTSINM'>0 D  Q
"RTN","GMTSRS2",29,0)
 . I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0)) W !,"Can not resequence, no selection items found."
"RTN","GMTSRS2",30,0)
 I +GMTSINM'>1 I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0)) W !,"Resequencing not required (1 item)"
"RTN","GMTSRS2",31,0)
 F  D RESEQ(.ARY)  Q:'$D(ARY)
"RTN","GMTSRS2",32,0)
 S GMTSMAX=$$MAX(.OPA)
"RTN","GMTSRS2",33,0)
 I +GMTSINM'=+GMTSMAX I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0)) W !,"Selection items not resequenced (sequence not fully specified)" Q
"RTN","GMTSRS2",34,0)
 D:+GMTSMAX>0 VER(.INA,.OPA,DA(2),DA(1))
"RTN","GMTSRS2",35,0)
 Q
"RTN","GMTSRS2",36,0)
 ;          
"RTN","GMTSRS2",37,0)
RESEQ(ARY) ; Resequence - .ARY
"RTN","GMTSRS2",38,0)
 N GMTSNXT,GMTSI,GMTSIN,GMTSOP,GMTS0,GMTS1,GMTSAC,GMTSAI,GMTSMAX S GMTSMAX=$$MAX(.ARY)
"RTN","GMTSRS2",39,0)
 S (GMTSAI,GMTSAC)=0 F  S GMTSAI=$O(ARY(GMTSAI)) Q:+GMTSAI=0  S GMTSAC=+($G(GMTSAC))+1
"RTN","GMTSRS2",40,0)
 D RES^GMTSRS2B(.ARY) S (GMTSAI,GMTSAC)=0 F  S GMTSAI=$O(ARY(GMTSAI)) Q:+GMTSAI=0  S GMTSAC=+($G(GMTSAC))+1
"RTN","GMTSRS2",41,0)
 I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0))&(GMTSMAX>72) W !,"Resequence selection items:",!
"RTN","GMTSRS2",42,0)
 I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0))&(GMTSMAX>72) D DIS^GMTSRS2B(.ARY)
"RTN","GMTSRS2",43,0)
 I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0))&(GMTSMAX'>72) D
"RTN","GMTSRS2",44,0)
 . N GMTSROOT,GMTSNODE,GMTSPIE,GMTSHDR,GMTSCOL S ARY(0)=$G(GMTSMAX)
"RTN","GMTSRS2",45,0)
 . S GMTSROOT="ARY",GMTSHDR="Resequence selection items:",GMTSNODE=1,GMTSPIE=2
"RTN","GMTSRS2",46,0)
 . S GMTSCOL=1 S:+GMTSMAX>18 GMTSCOL=2 S:+GMTSMAX>36 GMTSCOL=3 S:+GMTSMAX>54 GMTSCOL=4 S:+GMTSMAX>72 GMTSCOL=5 S:+GMTSMAX>90 GMTSCOL=6
"RTN","GMTSRS2",47,0)
 . D EN^GMTSRS4(GMTSROOT,GMTSNODE,GMTSPIE,GMTSHDR,GMTSCOL)
"RTN","GMTSRS2",48,0)
 S GMTSNXT=$$ASK(.ARY,.GMTSNXT) F  Q:$E(GMTSNXT,$L(GMTSNXT))'=","  S GMTSNXT=$E(GMTSNXT,1,($L(GMTSNXT)-1))
"RTN","GMTSRS2",49,0)
 K:+GMTSNXT'>0 ARY Q:+GMTSNXT'>0
"RTN","GMTSRS2",50,0)
 S GMTSI=0 F GMTSI=1:1 Q:+($P(GMTSNXT,",",GMTSI))'>0  D
"RTN","GMTSRS2",51,0)
 . N GMTSIN,GMTSOP,GMTS0,GMTS1 S GMTSIN=+($P(GMTSNXT,",",GMTSI))
"RTN","GMTSRS2",52,0)
 . S GMTS0=$G(ARY(GMTSIN)) S GMTS1=$G(ARY(GMTSIN,1))
"RTN","GMTSRS2",53,0)
 . K ARY(GMTSIN) Q:'$L(GMTS0)  Q:'$L(GMTS1)
"RTN","GMTSRS2",54,0)
 . S GMTSOP=+($O(OPA(" "),-1))+1,OPA(GMTSOP)=GMTS0
"RTN","GMTSRS2",55,0)
 . S OPA(GMTSOP,1)=GMTS1 K ARY(GMTSIN)
"RTN","GMTSRS2",56,0)
 S GMTSA1=1
"RTN","GMTSRS2",57,0)
 F  S GMTSNXT=$G(GMTSNXT(GMTSA1)) Q:+$G(GMTSNXT)=0  D
"RTN","GMTSRS2",58,0)
 .S GMTSI=0 F GMTSI=1:1 Q:+($P(GMTSNXT,",",GMTSI))'>0  D
"RTN","GMTSRS2",59,0)
 .. N GMTSIN,GMTSOP,GMTS0,GMTS1 S GMTSIN=+($P(GMTSNXT,",",GMTSI))
"RTN","GMTSRS2",60,0)
 .. S GMTS0=$G(ARY(GMTSIN)) S GMTS1=$G(ARY(GMTSIN,1))
"RTN","GMTSRS2",61,0)
 .. K ARY(GMTSIN) Q:'$L(GMTS0)  Q:'$L(GMTS1)
"RTN","GMTSRS2",62,0)
 .. S GMTSOP=+($O(OPA(" "),-1))+1,OPA(GMTSOP)=GMTS0
"RTN","GMTSRS2",63,0)
 .. S OPA(GMTSOP,1)=GMTS1 K ARY(GMTSIN)
"RTN","GMTSRS2",64,0)
 .S GMTSA1=GMTSA1+1
"RTN","GMTSRS2",65,0)
 Q
"RTN","GMTSRS2",66,0)
 ;          
"RTN","GMTSRS2",67,0)
ASK(ARY,NEXT,X) ; Ask for order of Selection Items
"RTN","GMTSRS2",68,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,GMTSMAX,Y,GMTSF,GMTSI S GMTSMAX=$$MAX(.ARY) Q:+GMTSMAX=1 1  Q:+GMTSMAX'>0 ""
"RTN","GMTSRS2",69,0)
 F GMTSI=1:1:GMTSMAX S GMTSF=$G(GMTSF)_GMTSI_","
"RTN","GMTSRS2",70,0)
 I $D(GMTSRO),+GMTSRO=0 S X=GMTSF Q X
"RTN","GMTSRS2",71,0)
 S DIR(0)="LAO^1:"_GMTSMAX_":0",DIR("A")="Select next item(s)" S:GMTSMAX>1 DIR("A")=DIR("A")_" 1-"_GMTSMAX
"RTN","GMTSRS2",72,0)
 S DIR("?",1)="Specify a set of Selection Items: eg 2-9,1,10-15"
"RTN","GMTSRS2",73,0)
 S DIR("?",2)="          You must use every Selection Item in the set"
"RTN","GMTSRS2",74,0)
 S DIR("?",3)="          For example, if there are 20 Selection Items"
"RTN","GMTSRS2",75,0)
 S DIR("?",4)="            every number from 1 to 20 must be included"
"RTN","GMTSRS2",76,0)
 S DIR("?")="            in the resulting set. eg 10-20,5-9,1-4"
"RTN","GMTSRS2",77,0)
 S DIR("A")=DIR("A")_":  ",DIR("B")=1 W ! D ^DIR
"RTN","GMTSRS2",78,0)
 I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) K ARY S X=-1 Q X
"RTN","GMTSRS2",79,0)
 M NEXT=Y
"RTN","GMTSRS2",80,0)
 S X=Y Q X
"RTN","GMTSRS2",81,0)
 ;
"RTN","GMTSRS2",82,0)
MAX(ARY,X) ; Maximum # Items
"RTN","GMTSRS2",83,0)
 N GMTSI S (GMTSI,X)=0 F  S GMTSI=$O(ARY(GMTSI)) Q:+GMTSI=0  S X=X+1
"RTN","GMTSRS2",84,0)
 S ARY(0)=X Q X
"RTN","GMTSRS2",85,0)
 ;          
"RTN","GMTSRS2",86,0)
VER(INA,OPA,GMTST,GMTSS) ; Verify Resequence
"RTN","GMTSRS2",87,0)
 N GMTSI2,GMTSI1,GMTSI,GMTSC,GMTSON,GMTSNN,GMTSCHG,GMTSVAL,GMTSTR,GMTSCT,X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMTSRS2",88,0)
 S GMTSI2=+($G(GMTST)) Q:+GMTSI2=0  S GMTSI1=+($G(GMTSS)) Q:+GMTSI1=0
"RTN","GMTSRS2",89,0)
 I $D(GMTSRO),+GMTSRO=0 G VER2
"RTN","GMTSRS2",90,0)
 S (GMTSI,GMTSC,GMTSCHG)=0 F  S GMTSI=$O(INA(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS2",91,0)
 . S GMTSON=$P($G(INA(GMTSI,1)),"^",2)
"RTN","GMTSRS2",92,0)
 . S GMTSNN=$P($G(OPA(GMTSI,1)),"^",2) S:GMTSON'=GMTSNN GMTSCHG=1
"RTN","GMTSRS2",93,0)
 I 'GMTSCHG I '$D(GMTSRO)!($D(GMTSRO)&(+($G(GMTSRO))>0)) W !,"No changes in the Selection Item sequence." S GMTSRO=0 G VER2
"RTN","GMTSRS2",94,0)
 S GMTSCT=0 F  S GMTSI=$O(INA(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS2",95,0)
 . S GMTSON=$P($G(INA(GMTSI,1)),"^",2),GMTSNN=$P($G(OPA(GMTSI,1)),"^",2) Q:'$L(GMTSON)  Q:'$L(GMTSNN)
"RTN","GMTSRS2",96,0)
 . S GMTSC=GMTSC+1 D:GMTSC=1 HDR
"RTN","GMTSRS2",97,0)
 . S GMTSCT=GMTSCT+1 D:GMTSCT>22 CONT S:GMTSCT>22 GMTSCT=0
"RTN","GMTSRS2",98,0)
 . S GMTSON=$E(GMTSON,1,31)_"   " F  Q:$L(GMTSON)>30  S GMTSON=GMTSON_"."
"RTN","GMTSRS2",99,0)
 . S GMTSTR=$J(GMTSC,5)_"   "_GMTSON W !,GMTSTR W ?42,$E(GMTSNN,1,36)
"RTN","GMTSRS2",100,0)
 S DIR(0)="YAO",DIR("A")="Is this Correct:  (Y/N)  ",DIR("B")="Y" W ! D ^DIR I +($G(Y))'>0 W !,"Selection items not resequenced" Q
"RTN","GMTSRS2",101,0)
VER2 ; Verified
"RTN","GMTSRS2",102,0)
 K ^GMT(142,GMTSI2,1,GMTSI1,1)
"RTN","GMTSRS2",103,0)
 S (GMTSI,GMTSC)=0 F  S GMTSI=$O(OPA(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS2",104,0)
 . S GMTSVAL=$G(OPA(GMTSI)) Q:'$L(GMTSVAL)  S GMTSC=GMTSC+1
"RTN","GMTSRS2",105,0)
 . S ^GMT(142,GMTSI2,1,GMTSI1,1,GMTSC,0)=GMTSVAL
"RTN","GMTSRS2",106,0)
 N DIK,DA S DA=GMTSI2,DIK="^GMT(142," D IX1^DIK
"RTN","GMTSRS2",107,0)
 S ^GMT(142,GMTSI2,1,GMTSI1,1,0)="^142.14VA^"_GMTSC_"^"_GMTSC
"RTN","GMTSRS2",108,0)
 Q
"RTN","GMTSRS2",109,0)
 ;          
"RTN","GMTSRS2",110,0)
CONT ; Continue
"RTN","GMTSRS2",111,0)
 N DIC,DIK,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMTSRS2",112,0)
 S DIR(0)="EA",DIR("A")=" Press <return> to continue.  " W ! D ^DIR
"RTN","GMTSRS2",113,0)
 S GMTSI=+($G(GMTSI)) D:+($O(INA(GMTSI)))>0 HDR
"RTN","GMTSRS2",114,0)
 Q
"RTN","GMTSRS2",115,0)
HDR ; Header
"RTN","GMTSRS2",116,0)
 W !!,?8,"Old Sequence",?42,"New Sequence",!,?8,"------------------------",?42,"------------------------" S GMTSCT=3
"RTN","GMTSRS2",117,0)
 Q
"RTN","GMTSRS2",118,0)
LKT ; Lookup HS Type
"RTN","GMTSRS2",119,0)
 N DIC,DIR,DTOUT,DUOUT,DIRUT,DIROUT,GMTSERR
"RTN","GMTSRS2",120,0)
 W !,"Resequence the Selection Items of a Health Summary Type.",!
"RTN","GMTSRS2",121,0)
 ;
"RTN","GMTSRS2",122,0)
LKT2 ;   Re-prompt
"RTN","GMTSRS2",123,0)
 S GMTSERR=0,DIC="^GMT(142,",DIC("S")="I +($$ST^GMTSRS2)>0",DIC(0)="AEMQZF"
"RTN","GMTSRS2",124,0)
 S DIC("A")="Select a Health Summary Type:  "
"RTN","GMTSRS2",125,0)
 D ^DIC I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) S Y=-1 Q
"RTN","GMTSRS2",126,0)
 I +($G(GMTSERR))>0 D DTE(+($G(GMTSERR))) G LKT2
"RTN","GMTSRS2",127,0)
 I +Y>0 D
"RTN","GMTSRS2",128,0)
 . N X,DIC S X=$P(Y,"^",2),DIC="^GMT(142,",DIC(0)="M" D ^DIC
"RTN","GMTSRS2",129,0)
 Q
"RTN","GMTSRS2",130,0)
 ;          
"RTN","GMTSRS2",131,0)
ST(X) ;   Screen for Type
"RTN","GMTSRS2",132,0)
 N GMTSY,GMTSO,GMTSS,GMTSU,GMTSKEY,GMTSLOCK,GMTSN0,GMTSMGR
"RTN","GMTSRS2",133,0)
 S GMTSO=0,GMTSY=+($G(Y)) S:+GMTSY'>0 GMTSERR=1 Q:+GMTSY'>0 1
"RTN","GMTSRS2",134,0)
 S GMTSN0=$G(^GMT(142,+GMTSY,0)) S:'$L(GMTSN0) GMTSERR=2 Q:'$L(GMTSN0) 1
"RTN","GMTSRS2",135,0)
 S GMTSKEY=$P(GMTSN0,"^",2),GMTSU=$P(GMTSN0,"^",3)
"RTN","GMTSRS2",136,0)
 S GMTSMGR=$S($D(^XUSEC("GMTSMGR",+($G(DUZ)))):1,1:0) S GMTSLOCK=0
"RTN","GMTSRS2",137,0)
 S:$L(GMTSKEY) GMTSLOCK=$S($D(^XUSEC(GMTSKEY,+($G(DUZ)))):0,1:1)
"RTN","GMTSRS2",138,0)
 S:$P(GMTSN0,"^",1)="GMTS HS ADHOC OPTION" GMTSERR=3 Q:$P(GMTSN0,"^",1)="GMTS HS ADHOC OPTION" 1
"RTN","GMTSRS2",139,0)
 S:+($G(^GMT(142,+GMTSY,"VA")))>0 GMTSERR=6 Q:+($G(^GMT(142,+GMTSY,"VA")))>0 1
"RTN","GMTSRS2",140,0)
 S (GMTSO,GMTSS)=0 F  S GMTSS=$O(^GMT(142,+GMTSY,1,GMTSS)) Q:+GMTSS=0  D  Q:GMTSO>1
"RTN","GMTSRS2",141,0)
 . Q:'$D(^GMT(142,+GMTSY,1,GMTSS,1,"B"))  N GMTSI S GMTSI=0
"RTN","GMTSRS2",142,0)
 . F  S GMTSI=$O(^GMT(142,+GMTSY,1,GMTSS,1,GMTSI)) Q:+GMTSI=0  D  Q:+GMTSO>1
"RTN","GMTSRS2",143,0)
 . . S GMTSO=+($G(GMTSO))+1
"RTN","GMTSRS2",144,0)
 S X=GMTSO S:+X'>0 GMTSERR=7 S:+X=1 GMTSERR=8
"RTN","GMTSRS2",145,0)
 Q 1
"RTN","GMTSRS2",146,0)
DTE(X) ;   Display Type Error
"RTN","GMTSRS2",147,0)
 I +($G(X))=1 W !!,"     No Health Summary Type selected.",! Q
"RTN","GMTSRS2",148,0)
 I +($G(X))=2 W !!,"     Health Summary Type not found.",! Q
"RTN","GMTSRS2",149,0)
 I +($G(X))=3 W !!,"     Can not resequence AD HOC Health Summary Type.",! Q
"RTN","GMTSRS2",150,0)
 I +($G(X))=4 W !!,"     Health Summary Type LOCKED",! Q
"RTN","GMTSRS2",151,0)
 I +($G(X))=5 W !!,"     Can not resequence a Health Summary Type you do not own.",! Q
"RTN","GMTSRS2",152,0)
 I +($G(X))=6 W !!,"     Can not resequence a Nationally exported Health Summary Type.",! Q
"RTN","GMTSRS2",153,0)
 I +($G(X))=7 W !!,"     Health Summary Type does not have selection items." D FMT Q
"RTN","GMTSRS2",154,0)
 I +($G(X))=8 W !!,"     Can not resequence, selected Health Summary Type only has",!,"     one (1) selection item.",! Q
"RTN","GMTSRS2",155,0)
 Q
"RTN","GMTSRS2",156,0)
FMT ;   Format of Type
"RTN","GMTSRS2",157,0)
 W !!,"       <Health Summary Type>"
"RTN","GMTSRS2",158,0)
 W !,"         <Health Summary Commponent>  i.e., 'PCE HEALTH FACTORS SELECTED'"
"RTN","GMTSRS2",159,0)
 W !,"           <Selection Items> i.e., TOBACCO USE",!
"RTN","GMTSRS2",160,0)
 Q
"RTN","GMTSRS2",161,0)
LKS ; Lookup HS Component Structure
"RTN","GMTSRS2",162,0)
 Q:+($G(GMTST))'>0
"RTN","GMTSRS2",163,0)
 N DIC,DIR,DTOUT,DUOUT,DIRUT,DIROUT,GMTSERR,DA
"RTN","GMTSRS2",164,0)
LKS2 ;   Re-prompt for Component
"RTN","GMTSRS2",165,0)
 S GMTSERR=0,DA(1)=+($G(GMTST)),DIC="^GMT(142,"_DA(1)_",1,"
"RTN","GMTSRS2",166,0)
 S DIC("S")="I +($$SS^GMTSRS2)>0",DIC(0)="AEMQZF"
"RTN","GMTSRS2",167,0)
 S DIC("A")="Select a Health Summary Component:  "
"RTN","GMTSRS2",168,0)
 D ^DIC I $D(DTOUT)!($D(DUOUT))!($D(DIRUT))!($D(DIROUT)) S Y=-1 Q
"RTN","GMTSRS2",169,0)
 I +($G(GMTSERR))>0 D DCE(+($G(GMTSERR))) G LKS2
"RTN","GMTSRS2",170,0)
 I +Y>0 D
"RTN","GMTSRS2",171,0)
 . N X,DIC S X=$P(Y,"^",2),DIC="^GMT(142,"_DA(1)_",1,",DIC(0)="M" D ^DIC
"RTN","GMTSRS2",172,0)
 Q
"RTN","GMTSRS2",173,0)
SS(X) ;   Screen for Structure
"RTN","GMTSRS2",174,0)
 S GMTST=+($G(GMTST)) Q:+GMTST'>0 0
"RTN","GMTSRS2",175,0)
 N GMTSY,GMTSI,GMTSO,GMTSS,GMTSU,GMTSKEY,GMTSLOCK,GMTSN0,GMTSMGR
"RTN","GMTSRS2",176,0)
 S GMTSO=0,GMTSY=+($G(Y)) S:+GMTSY'>0 GMTSERR=1 Q:+GMTSY'>0 1
"RTN","GMTSRS2",177,0)
 S GMTSN0=$G(^GMT(142,+GMTST,1,+GMTSY,0)) S:'$L(GMTSN0) GMTSERR=2 Q:'$L(GMTSN0) 1
"RTN","GMTSRS2",178,0)
 S:'$D(^GMT(142,GMTST,1,+GMTSY,1,"B")) GMTSERR=3 Q:'$D(^GMT(142,GMTST,1,+GMTSY,1,"B"))
"RTN","GMTSRS2",179,0)
 S (GMTSO,GMTSI)=0
"RTN","GMTSRS2",180,0)
 F  S GMTSI=$O(^GMT(142,GMTST,1,+GMTSY,1,GMTSI)) Q:+GMTSI=0  D  Q:+GMTSO>1
"RTN","GMTSRS2",181,0)
 . S GMTSO=+($G(GMTSO))+1
"RTN","GMTSRS2",182,0)
 S X=GMTSO S:+X'>0 GMTSERR=3 S:+X=1 GMTSERR=4
"RTN","GMTSRS2",183,0)
 Q 1
"RTN","GMTSRS2",184,0)
DCE(X) ;   Display Component Error
"RTN","GMTSRS2",185,0)
 I +($G(X))=1 W !!,"     No Health Summary Component selected.",! Q
"RTN","GMTSRS2",186,0)
 I +($G(X))=2 W !!,"     Health Summary Component not found.",! Q
"RTN","GMTSRS2",187,0)
 I +($G(X))=3 W !!,"     Health Summary Component does not have selection items." D FMT Q
"RTN","GMTSRS2",188,0)
 I +($G(X))=4 W !!,"     Can not resequence, selected Health Summary Component ",!,"     only has one (1) selection item.",! Q
"RTN","GMTSRS2",189,0)
 Q 1
"RTN","GMTSRS2B")
0^9^B4943402
"RTN","GMTSRS2B",1,0)
GMTSRS2B ; SLC/KER - Selection Items Resequence 2     ; 02/11/2003
"RTN","GMTSRS2B",2,0)
 ;;2.7;Health Summary;**62**;Oct 20, 1995
"RTN","GMTSRS2B",3,0)
 ;
"RTN","GMTSRS2B",4,0)
 Q
"RTN","GMTSRS2B",5,0)
RES(ARY) ; Reset Input Array - .ARY
"RTN","GMTSRS2B",6,0)
 N GMTSI,GMTSC,GMTS S (GMTSI,GMTSC)=0 F  S GMTSI=$O(ARY(GMTSI)) Q:+GMTSI=0  S GMTS(GMTSI)=$G(ARY(GMTSI)),GMTS(GMTSI,1)=$G(ARY(GMTSI,1))
"RTN","GMTSRS2B",7,0)
 K ARY F  S GMTSI=$O(GMTS(GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1,ARY(GMTSC)=$G(GMTS(GMTSI)),ARY(GMTSC,1)=$G(GMTS(GMTSI,1))
"RTN","GMTSRS2B",8,0)
 Q
"RTN","GMTSRS2B",9,0)
 ;
"RTN","GMTSRS2B",10,0)
DIS(ARY) ; Display Array - .ARY
"RTN","GMTSRS2B",11,0)
 N GMTSI,GMTSTY,GMTSSM S GMTSI=0 F  S GMTSI=$O(ARY(GMTSI)) Q:+GMTSI=0  S GMTSTY=$P($G(ARY(GMTSI,1)),"^",1),GMTSSM=$P($G(ARY(GMTSI,1)),"^",2) D
"RTN","GMTSRS2B",12,0)
 . W !,$J(GMTSI,4),"  ",GMTSTY,", ",GMTSSM
"RTN","GMTSRS2B",13,0)
 Q
"RTN","GMTSRS2B",14,0)
 ;
"RTN","GMTSRS2B",15,0)
INA(GMTST,GMTSS,ARY) ; Creates Input Array
"RTN","GMTSRS2B",16,0)
 N DA,GMTSC,GMTSI,GMTSVAL,GMTSPTR,GMTSFRT,GMTSCRT,GMTSFFRT,GMTSFCRT
"RTN","GMTSRS2B",17,0)
 N GMTSRT,GMTSUB,GMTSTYP
"RTN","GMTSRS2B",18,0)
 S DA(2)=+($G(GMTST)) Q:+DA(2)'>0  Q:'$D(^GMT(142,+DA(2)))
"RTN","GMTSRS2B",19,0)
 S DA(1)=+($G(GMTSS)) Q:+DA(1)'>0  Q:'$D(^GMT(142,+DA(2),1,+DA(1)))
"RTN","GMTSRS2B",20,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,DA(2),1,DA(1),1,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS2B",21,0)
 . S GMTSVAL=$G(^GMT(142,DA(2),1,DA(1),1,GMTSI,0))
"RTN","GMTSRS2B",22,0)
 . S GMTSPTR=+GMTSVAL,GMTSFRT=$P(GMTSVAL,";",2)
"RTN","GMTSRS2B",23,0)
 . Q:GMTSFRT'["("  S:GMTSFRT'["^" GMTSFRT="^"_GMTSFRT
"RTN","GMTSRS2B",24,0)
 . S GMTSCRT=$$CREF^DILF(GMTSFRT)
"RTN","GMTSRS2B",25,0)
 . S GMTSFFRT=GMTSFRT_GMTSPTR_","
"RTN","GMTSRS2B",26,0)
 . S GMTSFCRT=$$CREF^DILF(GMTSFFRT)
"RTN","GMTSRS2B",27,0)
 . Q:'$D(@GMTSFCRT)  Q:'$L($G(@($P(GMTSFCRT,")",1)_",0)")))
"RTN","GMTSRS2B",28,0)
 . S GMTSUB=$P($G(@($P(GMTSFCRT,")",1)_",0)")),"^",1)
"RTN","GMTSRS2B",29,0)
 . S GMTSTYP=$P(@($P(GMTSCRT,")",1)_",0)"),"^",1),GMTSC=GMTSC+1
"RTN","GMTSRS2B",30,0)
 . S GMTSRT=$TR(GMTSFRT,"^","")
"RTN","GMTSRS2B",31,0)
 . S ARY(GMTSC)=GMTSPTR_";"_GMTSRT,ARY(GMTSC,1)=GMTSTYP_"^"_GMTSUB
"RTN","GMTSRS2B",32,0)
 . S INA(GMTSC)=GMTSPTR_";"_GMTSRT,INA(GMTSC,1)=GMTSTYP_"^"_GMTSUB
"RTN","GMTSRS2B",33,0)
 Q
"RTN","GMTSRS3")
0^10^B6644294
"RTN","GMTSRS3",1,0)
GMTSRS3 ; SLC/KER - Health Summary Resequence - Misc     ; 02/11/2003
"RTN","GMTSRS3",2,0)
 ;;2.7;Health Summary;**62**;Oct 20, 1995
"RTN","GMTSRS3",3,0)
 ;
"RTN","GMTSRS3",4,0)
 Q
"RTN","GMTSRS3",5,0)
SI ; Structure for Items
"RTN","GMTSRS3",6,0)
 W !!,"    Example Health Summary Type with Components containing Selection"
"RTN","GMTSRS3",7,0)
 W !,"    Items which may be resequenced",!
"RTN","GMTSRS3",8,0)
 W !,"        Health Summary Type                  Rehab Summary"
"RTN","GMTSRS3",9,0)
 W !,"            Health Summary Component           Brief Demographics"
"RTN","GMTSRS3",10,0)
 W !,"            Health Summary Component           Lab Cum Selected"
"RTN","GMTSRS3",11,0)
 W !,"               1  Selection Item                   Glucose"
"RTN","GMTSRS3",12,0)
 W !,"               2  Selection Item                   B 12"
"RTN","GMTSRS3",13,0)
 W !,"               3  Selection Item                   Liver Function"
"RTN","GMTSRS3",14,0)
 W !,"            Health Summary Component           Health Factor Select"
"RTN","GMTSRS3",15,0)
 W !,"               1  Selection Item                   Alcohol Screen"
"RTN","GMTSRS3",16,0)
 W !,"               2  Selection Item                   Depression Screening"
"RTN","GMTSRS3",17,0)
 W !,"            Health Summary Component           Progress Notes"
"RTN","GMTSRS3",18,0)
 Q
"RTN","GMTSRS3",19,0)
SC ; Structure for Components
"RTN","GMTSRS3",20,0)
 I '$D(GMTST) D  Q
"RTN","GMTSRS3",21,0)
 . W !,?3,"Example of a Health Summary Type with multiple components which ",!,?3,"may be resequenced.",!
"RTN","GMTSRS3",22,0)
 . W !,?5,"Health Summary Type",?32,"REHAB SUMMARY"
"RTN","GMTSRS3",23,0)
 . W !,?7,"Component #1",?34,"BRIEF DEMOGRAPHICS"
"RTN","GMTSRS3",24,0)
 . W !,?7,"Component #2",?34,"LAB CUM SELECTED"
"RTN","GMTSRS3",25,0)
 . W !,?7,"Component #3",?34,"HEALTH FACTOR SELECT"
"RTN","GMTSRS3",26,0)
 . W !,?7,"Component #4",?34,"PROGRESS NOTES"
"RTN","GMTSRS3",27,0)
 N GMTSI,GMTSC,GMTSN
"RTN","GMTSRS3",28,0)
 W !,?3,"This Health Summary Type has multiple Components which may be resequenced.",!
"RTN","GMTSRS3",29,0)
 W !,?5,"Health Summary Type",?32,$$UP^XLFSTR($P($G(^GMT(142,+GMTST,0)),"^",1))
"RTN","GMTSRS3",30,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(^GMT(142,+($G(GMTST)),1,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSRS3",31,0)
 . S GMTSN=$P($G(^GMT(142,+($G(GMTST)),1,+GMTSI,0)),"^",2)
"RTN","GMTSRS3",32,0)
 . S GMTSN=$P($G(^GMT(142.1,+GMTSN,0)),"^",1) Q:'$L(GMTSN)
"RTN","GMTSRS3",33,0)
 . S GMTSC=GMTSC+1
"RTN","GMTSRS3",34,0)
 . W !,?7,"Component #",GMTSC,?34,$$UP^XLFSTR(GMTSN)
"RTN","GMTSRS3",35,0)
 Q
"RTN","GMTSRS3",36,0)
YN ; Yes/No
"RTN","GMTSRS3",37,0)
 W !,?3,"Enter either 'Y' or 'N'."
"RTN","GMTSRS3",38,0)
 Q
"RTN","GMTSRS3",39,0)
TRIM(X) ; Remove Spaces
"RTN","GMTSRS3",40,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSRS3",41,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSRS3",42,0)
 Q X
"RTN","GMTSRS4")
0^13^B7862389
"RTN","GMTSRS4",1,0)
GMTSRS4 ; SLC/KER - Health Summary Resequence - Misc     ; 02/11/2003
"RTN","GMTSRS4",2,0)
 ;;2.7;Health Summary;**62**;Oct 20, 1995
"RTN","GMTSRS4",3,0)
 ;
"RTN","GMTSRS4",4,0)
 ; External References
"RTN","GMTSRS4",5,0)
 ;   None
"RTN","GMTSRS4",6,0)
 ;                              
"RTN","GMTSRS4",7,0)
 ; Variables passed
"RTN","GMTSRS4",8,0)
 ;   ROOT  Global file root, i.e., "^XXX(SUB1,SUB2,SUBX,"
"RTN","GMTSRS4",9,0)
 ;   PIE   Pieces to display, i.e, "1" or "1^2^4" (Default 1)
"RTN","GMTSRS4",10,0)
 ;   HDR   Display title (Default first piece of 0 node)
"RTN","GMTSRS4",11,0)
 ;   COL   Number of columns to display (Default 1)
"RTN","GMTSRS4",12,0)
 ;                              
"RTN","GMTSRS4",13,0)
 ; Output
"RTN","GMTSRS4",14,0)
 ;   Takes the data stored in array ROOT at node NODE and 
"RTN","GMTSRS4",15,0)
 ;   piece PIE and prints in columns (number of columns
"RTN","GMTSRS4",16,0)
 ;   specified by COL).
"RTN","GMTSRS4",17,0)
 ;                         
"RTN","GMTSRS4",18,0)
EN(ROOT,NODE,PIE,HDR,COL) ; Main Entry Point
"RTN","GMTSRS4",19,0)
 D HOME^%ZIS N GMTS2,GMTS3,GMTS4,GMTSCC,GMTSCCT,GMTSCLL,GMTSCLS
"RTN","GMTSRS4",20,0)
 N GMTSCOL,GMTSCTR,GMTSELE,GMTSFL,GMTSHDR,GMTSLNS,GMTSMAX,GMTSND
"RTN","GMTSRS4",21,0)
 N GMTSNR,GMTSNT,GMTSON,GMTSPI,GMTSR0,GMTSRM,GMTSRT,GMTSTX,GMTSUW
"RTN","GMTSRS4",22,0)
 N GMTSWTH S GMTSRT=$G(ROOT),GMTSND=$G(NODE),GMTSPI=$G(PIE),GMTSHDR=$G(HDR),GMTSCOL=$G(COL) S:+GMTSPI=1 GMTSPI=1
"RTN","GMTSRS4",23,0)
 Q:'$L($G(GMTSRT))  S GMTSRT=$G(GMTSRT)  S:GMTSRT'["(" GMTSRT=GMTSRT_"("
"RTN","GMTSRS4",24,0)
 S:GMTSRT[")" GMTSRT=$E(GMTSRT,$L(GMTSRT)-1) S GMTSR0=GMTSRT_"0)" Q:'$D(@GMTSR0)
"RTN","GMTSRS4",25,0)
 S GMTSON=GMTSRT,GMTSMAX=$G(@GMTSR0) Q:+GMTSMAX=0  S GMTSCOL=$G(GMTSCOL) Q:+GMTSCOL=0
"RTN","GMTSRS4",26,0)
 S GMTSLNS=$S(+GMTSCOL>0&(+GMTSMAX>0):(GMTSMAX/GMTSCOL),1:18)
"RTN","GMTSRS4",27,0)
 S GMTSRM=$P(GMTSLNS,".",2) S GMTSLNS=$P(GMTSLNS,".",1) S:+GMTSRM>0 GMTSLNS=GMTSLNS+1
"RTN","GMTSRS4",28,0)
 S GMTSCCT=1,(GMTSNR,GMTSFL,GMTSCTR)=0
"RTN","GMTSRS4",29,0)
 F  S GMTSNR=$O(@(GMTSON_GMTSNR_")")) Q:+GMTSNR=0  D
"RTN","GMTSRS4",30,0)
 . S GMTSCTR=GMTSCTR+1 S:GMTSCTR>GMTSLNS GMTSCTR=1,GMTSCCT=GMTSCCT+1
"RTN","GMTSRS4",31,0)
 . S GMTSCLL=GMTSCCT,GMTSCLS(GMTSCCT,GMTSCTR)=GMTSNR
"RTN","GMTSRS4",32,0)
 S GMTSNT=((GMTSCLL*6)+(4*(GMTSCLL-1))),GMTSUW=IOM-GMTSNT
"RTN","GMTSRS4",33,0)
 F GMTSCC=GMTSUW:-1 Q:((GMTSCC#4=0)&(GMTSCC#3=0))
"RTN","GMTSRS4",34,0)
 S GMTSWTH=(GMTSCC/GMTSCLL)+1,GMTS2=GMTSWTH+5,GMTS3=GMTS2+9+GMTSWTH,GMTS4=GMTS3+9+GMTSWTH
"RTN","GMTSRS4",35,0)
 F GMTSCTR=1:1:GMTSLNS D
"RTN","GMTSRS4",36,0)
 . F GMTSCCT=1:1:GMTSCLL D
"RTN","GMTSRS4",37,0)
 . . S GMTSNR=+($G(GMTSCLS(GMTSCCT,GMTSCTR))) Q:+GMTSNR=0
"RTN","GMTSRS4",38,0)
 . . S GMTSTX=$G(@(GMTSON_GMTSNR_")"))
"RTN","GMTSRS4",39,0)
 . . S:$L($G(GMTSND)) GMTSTX=$G(@(GMTSON_GMTSNR_","_GMTSND_")"))
"RTN","GMTSRS4",40,0)
 . . S:+($G(GMTSPI))>0 GMTSTX=$P(GMTSTX,"^",+GMTSPI)
"RTN","GMTSRS4",41,0)
 . . S GMTSELE=$E(GMTSTX,1,GMTSWTH)
"RTN","GMTSRS4",42,0)
 . . F  Q:$E(GMTSELE,1)'=" "  S GMTSELE=$E(GMTSELE,2,$L(GMTSELE))
"RTN","GMTSRS4",43,0)
 . . S:+GMTSNR=0 GMTSNR=""  S:'$L(GMTSELE) GMTSNR=""
"RTN","GMTSRS4",44,0)
 . . S GMTSELE=$S(GMTSCCT=1:$J(GMTSNR,4)_" "_GMTSELE,1:"    "_$J(GMTSNR,4)_" "_GMTSELE)
"RTN","GMTSRS4",45,0)
 . . W:$L($G(GMTSHDR))&(GMTSCTR=1)&(GMTSCCT=1)&(+($G(GMTSFL))=0) !,$G(GMTSHDR),! S GMTSFL=1
"RTN","GMTSRS4",46,0)
 . . W:GMTSCCT=1 !
"RTN","GMTSRS4",47,0)
 . . W:GMTSCCT=2 ?GMTS2 W:GMTSCCT=3 ?GMTS3 W:GMTSCCT=4 ?GMTS4 W GMTSELE
"RTN","GMTSRS4",48,0)
 Q
"RTN","GMTSXAR")
0^14^B77484842
"RTN","GMTSXAR",1,0)
GMTSXAR ; SLC/KER - List Parameters/Resequence            ; 02/27/2002
"RTN","GMTSXAR",2,0)
 ;;2.7;Health Summary;**49,62**;Oct 20, 1995
"RTN","GMTSXAR",3,0)
 ;                    
"RTN","GMTSXAR",4,0)
 ; External References
"RTN","GMTSXAR",5,0)
 ;  DBIA 10022  %XY^%RCR
"RTN","GMTSXAR",6,0)
 ;  DBIA 10018  ^DIE (file #8989.51)
"RTN","GMTSXAR",7,0)
 ;  DBIA 10006  ^DIC (file #8989.51, 8989.518)
"RTN","GMTSXAR",8,0)
 ;  DBIA 10026  ^DIR
"RTN","GMTSXAR",9,0)
 ;  DBIA  2056  $$GET1^DIQ (file #8989.513)
"RTN","GMTSXAR",10,0)
 ;  DBIA  2052  FIELD^DID (file #8989.51)
"RTN","GMTSXAR",11,0)
 ;  DBIA  2992  ^XTV(8989.51,
"RTN","GMTSXAR",12,0)
 ;           
"RTN","GMTSXAR",13,0)
 Q
"RTN","GMTSXAR",14,0)
EN ; Main Entry
"RTN","GMTSXAR",15,0)
 N X,%X,Y,%Y,DA,DIC,DIDEL,DIE,DIR,DIROUT,DIRUT,DR,DTOUT,DUOUT,GMTSA,GMTSC,GMTSCHG,GMTSCNT,GMTSCONT,GMTSCT,GMTSCUR,GMTSD,GMTSEQ,GMTSEXIT
"RTN","GMTSXAR",16,0)
 N GMTSF,GMTSFI,GMTSI,GMTSIE,GMTSM,GMTSMAX,GMTSN,GMTSNEW,GMTSNXC,GMTSNXT,GMTSO,GMTSOK,GMTSOLD,GMTSON,GMTSORD,GMTSPARM,GMTSPI,GMTSREM
"RTN","GMTSXAR",17,0)
 N GMTSREO,GMTSSSO,GMTST,GMTSTOT,GMTSUSR,GMTSMGR
"RTN","GMTSXAR",18,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXAR",19,0)
 S GMTSCHG=0,GMTSPARM="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAR",20,0)
 S GMTSPI=$$PDI^GMTSXAW3(GMTSPARM) Q:+GMTSPI=0
"RTN","GMTSXAR",21,0)
 S %X="^XTV(8989.51,"_GMTSPI_",30,",%Y="GMTSO(""AL""," D %XY^%RCR S %X="^XTV(8989.518,",%Y="GMTSO(""ET""," D %XY^%RCR K GMTSO("ET","B"),GMTSO("ET","C")
"RTN","GMTSXAR",22,0)
 S (GMTSI,GMTSC)=0 F  S GMTSI=$O(GMTSO("AL","B",GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",23,0)
 . N GMTSIE S GMTSEQ(GMTSI)="",GMTSIE=0
"RTN","GMTSXAR",24,0)
 . F  S GMTSIE=$O(GMTSO("AL","B",GMTSI,GMTSIE)) Q:+GMTSIE=0  D
"RTN","GMTSXAR",25,0)
 . . N GMTSF S GMTSF=$P($G(GMTSO("AL",GMTSIE,0)),"^",2) Q:+GMTSF=0  Q:'$D(GMTSO("ET",GMTSF,0))
"RTN","GMTSXAR",26,0)
 . . S GMTSC=GMTSC+1
"RTN","GMTSXAR",27,0)
 . . S (GMTSCUR(GMTSC),GMTSOLD(GMTSC))=GMTSI_"^"_GMTSF_"^"_$G(GMTSO("ET",GMTSF,0))
"RTN","GMTSXAR",28,0)
 . . S GMTSOLD("B",GMTSI,GMTSC)=""
"RTN","GMTSXAR",29,0)
 D ORD D:+($G(GMTSEXIT))=0 CHK
"RTN","GMTSXAR",30,0)
 W:+($G(GMTSCHG))'>0 !!,?2,"No Changes Made"
"RTN","GMTSXAR",31,0)
 Q
"RTN","GMTSXAR",32,0)
ORD ; Order of Entities
"RTN","GMTSXAR",33,0)
 N GMTSI,GMTST,GMTSC,GMTSCNT,GMTSTOT,GMTSREM,GMTSSO,GMTSNXT,GMTSNXC,GMTSON
"RTN","GMTSXAR",34,0)
 S (GMTSSO,GMTSCNT,GMTSI,GMTSON)=0,(GMTSTOT,GMTST)=$$TOT Q:+GMTSTOT'>1
"RTN","GMTSXAR",35,0)
 S GMTSEXIT=0,GMTSCONT=$$CONT I +GMTSCONT>0 S GMTSEXIT=1 Q
"RTN","GMTSXAR",36,0)
 W !!,"     Please select the order in which you want these to be entities"
"RTN","GMTSXAR",37,0)
 W !,"     to be used." F  Q:+($G(GMTSEXIT))>0  D SO Q:+($G(GMTSEXIT))>0  Q:'$D(GMTSOLD)
"RTN","GMTSXAR",38,0)
 S GMTSEXIT=0
"RTN","GMTSXAR",39,0)
 Q
"RTN","GMTSXAR",40,0)
 ;           
"RTN","GMTSXAR",41,0)
SO ; Select Order
"RTN","GMTSXAR",42,0)
 K GMTSOLD("B") N GMTSI,GMTSC,GMTSMAX,GMTSREO S GMTSI=0,GMTSREM=$$TOT
"RTN","GMTSXAR",43,0)
 S GMTSCNT=GMTSTOT-GMTSREM,GMTSNXT=GMTSCNT+1,GMTSSO=+($G(GMTSSO))+1
"RTN","GMTSXAR",44,0)
 S GMTSNXC=$S(GMTSNXT=1:(GMTSNXT_"st"),GMTSNXT=2:(GMTSNXT_"nd"),GMTSNXT=3:(GMTSNXT_"rd"),1:(GMTSNXT_"th"))
"RTN","GMTSXAR",45,0)
 I +GMTSREM=1 S Y=+GMTSREM D SET Q
"RTN","GMTSXAR",46,0)
 W ! D SOL,REO S (GMTSC,GMTSI)=0
"RTN","GMTSXAR",47,0)
 S GMTSMAX=GMTSREM W ! N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","GMTSXAR",48,0)
 S DIR(0)="NAO^1:"_GMTSMAX_":0",DIR("?")="^D SOH1^GMTSXAR",DIR("??")="^D SOH2^GMTSXAR"
"RTN","GMTSXAR",49,0)
 S DIR("A")="        Select the "_GMTSNXC_" entity to be used:  "
"RTN","GMTSXAR",50,0)
 K DIR("B") S:+($O(GMTSREO(0)))>0 DIR("B")=+($O(GMTSREO(0)))
"RTN","GMTSXAR",51,0)
 D ^DIR I Y="",X="@" D
"RTN","GMTSXAR",52,0)
 . N GMTSD S GMTSD=$P($G(^GMT(142.98,+($G(GMTSUSR)),1)),"^",2)
"RTN","GMTSXAR",53,0)
 . S GMTSEXIT="1^"_$S($L(GMTSD):"",1:"exiting")
"RTN","GMTSXAR",54,0)
 . S Y="@" K GMTSORD S GMTSORD("@")=""
"RTN","GMTSXAR",55,0)
 S:Y["^"!($D(DUOUT))!($D(DIROUT)) GMTSEXIT="1^exiting" S:$D(DTOUT) GMTSEXIT="1^try later"
"RTN","GMTSXAR",56,0)
 I +($G(GMTSEXIT))>0 W $S($L($P(GMTSEXIT,"^",2)):"...",1:""),$P(GMTSEXIT,"^",2) Q
"RTN","GMTSXAR",57,0)
 I +Y>0,+Y'>GMTSREM D SET
"RTN","GMTSXAR",58,0)
 Q
"RTN","GMTSXAR",59,0)
SOL ;   List 
"RTN","GMTSXAR",60,0)
 N GMTSN,GMTSA,GMTST,GMTSC,GMTSI S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",61,0)
 . S GMTSC=GMTSC+1,GMTSA=$P(GMTSOLD(GMTSI),"^",4),GMTSN=$P(GMTSOLD(GMTSI),"^",5)
"RTN","GMTSXAR",62,0)
 . S GMTST=GMTSN_$S(GMTSA="DEV"!(GMTSA="DIV")!(GMTSA="SYS")!(GMTSA="PKG")!(GMTSA="LOC")!(GMTSA="BED"):" level ",1:" ")_"defined Health Summary Types"
"RTN","GMTSXAR",63,0)
 . W !,?5,$J(GMTSC,4),"  ",GMTST
"RTN","GMTSXAR",64,0)
 Q
"RTN","GMTSXAR",65,0)
SOH1 ;   Help - Single ?
"RTN","GMTSXAR",66,0)
 N GMTSC,GMTSI,GMTSN,GMTSCT S (GMTSC,GMTSI)=0,GMTSCT=+($G(GMTSNXT)) F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  S GMTSC=GMTSC+1
"RTN","GMTSXAR",67,0)
 S GMTSN=$S(GMTSCT=1:"first",GMTSCT=2:"second",GMTSCT=3:"third",GMTSCT=4:"fourth",GMTSCT=5:"fifty",GMTSCT=6:"sixth",GMTSCT=7:"seventh",GMTSCT=8:"eighth",GMTSCT=9:"nineth",GMTSCT=10:"tenth",GMTSCT=11:"eleventh",1:"")
"RTN","GMTSXAR",68,0)
 I '$L(GMTSN),+GMTSC>1 W !,?11,"Select a Health Summary Type entity to list" W:$L($G(GMTSNXC)) " ",GMTSNXC W " (1-",GMTSC,")",!
"RTN","GMTSXAR",69,0)
 I $L(GMTSN),+GMTSC>1 W !,?11,"Select a Health Summary Type entity to list ",GMTSN," (1-",GMTSC,")",!
"RTN","GMTSXAR",70,0)
 D SOL
"RTN","GMTSXAR",71,0)
 Q
"RTN","GMTSXAR",72,0)
SOH2 ;   Help - Double ??
"RTN","GMTSXAR",73,0)
 I '$L($G(GMTSPARM)) D SOH1 Q
"RTN","GMTSXAR",74,0)
 W !,?11,"Parameter """,GMTSPARM,""" has multiple "
"RTN","GMTSXAR",75,0)
 W !,?11,"allowable entities for which Health Summary Types may"
"RTN","GMTSXAR",76,0)
 W !,?11,"be assigned and displayed on the CPRS reports tab.  Now"
"RTN","GMTSXAR",77,0)
 W !,?11,"you must select the order in which you want these entites"
"RTN","GMTSXAR",78,0)
 W !,?11,"to be used by the site.",!
"RTN","GMTSXAR",79,0)
 D SOL
"RTN","GMTSXAR",80,0)
 Q
"RTN","GMTSXAR",81,0)
 ;          
"RTN","GMTSXAR",82,0)
 ; Arrange
"RTN","GMTSXAR",83,0)
SET ;   Set Order
"RTN","GMTSXAR",84,0)
 D REO N GMTSO S GMTSO=+($O(GMTSORD(" "),-1))+1
"RTN","GMTSXAR",85,0)
 I $L($P($G(GMTSREO(+($G(Y)))),"^",2,299)) D
"RTN","GMTSXAR",86,0)
 . S GMTSON=$O(GMTSEQ(GMTSON))
"RTN","GMTSXAR",87,0)
 . S GMTSORD(GMTSO)=GMTSON_"^"_$P($G(GMTSREO(+Y)),"^",2,299)
"RTN","GMTSXAR",88,0)
 S (GMTSC,GMTSI)=0
"RTN","GMTSXAR",89,0)
 F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",90,0)
 . S GMTSC=GMTSC+1 I GMTSC=+Y K GMTSOLD(GMTSI),GMTSREO(GMTSC)
"RTN","GMTSXAR",91,0)
 Q
"RTN","GMTSXAR",92,0)
REO ;   Re-order
"RTN","GMTSXAR",93,0)
 K GMTSREO N GMTSC,GMTSI S (GMTSC,GMTSI)=0
"RTN","GMTSXAR",94,0)
 F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",95,0)
 . S GMTSC=GMTSC+1 S GMTSREO(GMTSC)=$G(GMTSOLD(GMTSI))
"RTN","GMTSXAR",96,0)
 Q
"RTN","GMTSXAR",97,0)
TOT(X) ;   Total Allowable Entities
"RTN","GMTSXAR",98,0)
 N GMTSI S (X,GMTSI)=0 F  S GMTSI=$O(GMTSOLD(GMTSI)) Q:+GMTSI=0  S X=X+1
"RTN","GMTSXAR",99,0)
 Q X
"RTN","GMTSXAR",100,0)
CONT(X) ; Ask to Continue
"RTN","GMTSXAR",101,0)
 S:$O(GMTSCUR(0))=0!('$L($G(GMTSPARM)))!(+($G(GMTSTOT))'>1) GMTSEXIT=1
"RTN","GMTSXAR",102,0)
 Q:$O(GMTSCUR(0))=0!('$L($G(GMTSPARM)))!(+($G(GMTSTOT))'>1) 0
"RTN","GMTSXAR",103,0)
 W !!!," Parameter """,GMTSPARM,""" has ",GMTSTOT," allowable entities"
"RTN","GMTSXAR",104,0)
 W !," which may have the Health Summary Types on the CPRS reports tab "
"RTN","GMTSXAR",105,0)
 W !," and are used in the following order:"
"RTN","GMTSXAR",106,0)
 N DIR,DIROUT,DUOUT,DTOUT,GMTSA,GMTSN,GMTST,GMTSC,GMTSI D CONTM
"RTN","GMTSXAR",107,0)
 S DIR("A")=" Are these in the correct order for your site?  "
"RTN","GMTSXAR",108,0)
 S (DIR("?"),DIR("??"))="^D CONTH^GMTSXAR",DIR("B")="Y",DIR(0)="YAO" W ! D ^DIR
"RTN","GMTSXAR",109,0)
 S X=+($G(Y)) Q X
"RTN","GMTSXAR",110,0)
 Q 1
"RTN","GMTSXAR",111,0)
CONTH ;   Continue Help
"RTN","GMTSXAR",112,0)
 W !,"   Enter either 'Y' or 'N'"
"RTN","GMTSXAR",113,0)
 D CONTM Q
"RTN","GMTSXAR",114,0)
CONTM ;   Continue Menu
"RTN","GMTSXAR",115,0)
 S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSCUR(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",116,0)
 . S GMTSA=$P(GMTSCUR(GMTSI),"^",4),GMTSN=$P(GMTSCUR(GMTSI),"^",5)
"RTN","GMTSXAR",117,0)
 . S GMTST=GMTSN_$S(GMTSA="DEV"!(GMTSA="DIV")!(GMTSA="SYS")!(GMTSA="PKG")!(GMTSA="LOC")!(GMTSA="BED"):" level ",1:" ")_"defined Health Summary Types"
"RTN","GMTSXAR",118,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 ! W !,$J(GMTSC,6),"  ",GMTST
"RTN","GMTSXAR",119,0)
 Q
"RTN","GMTSXAR",120,0)
CHK ; Check if OK
"RTN","GMTSXAR",121,0)
 N GMTSC,GMTSI,GMTSA S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSCUR(GMTSI)) Q:+GMTSI=0  S:GMTSCUR(GMTSI)'[$G(GMTSORD(GMTSI)) GMTSC=1
"RTN","GMTSXAR",122,0)
 I 'GMTSC S GMTSCHG=0 Q
"RTN","GMTSXAR",123,0)
 W !!,?8,"You have selected to resequenced the Health Summary Type"
"RTN","GMTSXAR",124,0)
 W !,?8,"entities in the following order:",!
"RTN","GMTSXAR",125,0)
 D CHKM S GMTSA=$$OK D:+($G(GMTSA))>0 ED
"RTN","GMTSXAR",126,0)
 Q
"RTN","GMTSXAR",127,0)
CHKM ;   Check (Menu)
"RTN","GMTSXAR",128,0)
 N GMTSC,GMTSI S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSCUR(GMTSI)) Q:+GMTSI=0  S:GMTSCUR(GMTSI)'[$G(GMTSORD(GMTSI)) GMTSC=1
"RTN","GMTSXAR",129,0)
 Q:'GMTSC  S (GMTSC,GMTSI)=0 F  S GMTSI=$O(GMTSCUR(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",130,0)
 . S GMTSC=GMTSC+1 W:GMTSC=1 !,?13,"FROM (Current)",?33,"TO (Resequenced)",!,?13,"----------------",?33,"----------------"
"RTN","GMTSXAR",131,0)
 . W !,?7,$J(GMTSC,4),?13,$P($G(GMTSCUR(GMTSI)),"^",5),?33,$P($G(GMTSORD(GMTSI)),"^",5)
"RTN","GMTSXAR",132,0)
 Q
"RTN","GMTSXAR",133,0)
OK(X) ; Ask if OK
"RTN","GMTSXAR",134,0)
 W ! N DIR,DIROUT,DUOUT,DTOUT S (DIR("?"),DIR("??"))="^D OKH^GMTSXAR"
"RTN","GMTSXAR",135,0)
 S DIR("A")="         Is this OK?  ",DIR("B")="Y",DIR(0)="YAO" D ^DIR S X=+($G(Y)) Q X
"RTN","GMTSXAR",136,0)
OKH ;   OK Help
"RTN","GMTSXAR",137,0)
 W !,"           Enter either 'Y' or 'N'",!,!,"         Resequence entities:",! D CHKM Q
"RTN","GMTSXAR",138,0)
 ;           
"RTN","GMTSXAR",139,0)
ED ; Edit Record
"RTN","GMTSXAR",140,0)
 N DIC,DA,DIE,DR,DIDEL,DTOUT,GMTSFI,GMTSI,GMTSEQ,GMTSCNT,GMTST
"RTN","GMTSXAR",141,0)
 S GMTSPI=+($G(GMTSPI)),GMTSCNT=0
"RTN","GMTSXAR",142,0)
 I GMTSPI'>0!(+($O(GMTSORD(0)))'>0)!('$L($G(GMTSPARM)))!($$PDN^GMTSXAW3(+GMTSPI)'=$G(GMTSPARM)) D  Q
"RTN","GMTSXAR",143,0)
 . W !,?5," Unable to resequence at this time."
"RTN","GMTSXAR",144,0)
 S DA(1)=+($G(GMTSPI)) Q:DA(1)'>0  S (DIC,DIE)="^XTV(8989.51,"_DA(1)_",30,",DR=".02///^S X=$G(GMTSFI)"
"RTN","GMTSXAR",145,0)
L ;   Lock Record
"RTN","GMTSXAR",146,0)
 L +^XTV(8989.51,+($G(GMTSPI))) S GMTSCNT=GMTSCNT+1,GMTST=$T
"RTN","GMTSXAR",147,0)
 I 'GMTST,GMTSCNT'>3 H 2 G L
"RTN","GMTSXAR",148,0)
 I 'GMTST,GMTSCNT>3 W !," Another user is editing this entry.",!," Unable to resequence at this time." Q
"RTN","GMTSXAR",149,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSORD(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAR",150,0)
 . S GMTSFI=$P(GMTSORD(GMTSI),"^",2),GMTSEQ=$P(GMTSORD(GMTSI),"^",1)
"RTN","GMTSXAR",151,0)
 . S DA=$$DA(DA(1),GMTSEQ),X=GMTSEQ D ^DIE S GMTSCHG=1
"RTN","GMTSXAR",152,0)
 L -^XTV(8989.51,+($G(GMTSPI)))
"RTN","GMTSXAR",153,0)
 Q
"RTN","GMTSXAR",154,0)
DA(GMTSI,X) ;   Get DA
"RTN","GMTSXAR",155,0)
 N DA,DIC,DTOUT,DUOUT,Y,GMTSM S DA(1)=+($G(GMTSI)),X=+($G(X))
"RTN","GMTSXAR",156,0)
 S DIC="^XTV(8989.51,"_DA(1)_",30,",DIC(0)="M" D ^DIC S X=+($G(Y)) Q X
"RTN","GMTSXAR",157,0)
 Q
"RTN","GMTSXAR",158,0)
 ;                
"RTN","GMTSXAR",159,0)
ADED ; Add/Edit
"RTN","GMTSXAR",160,0)
 N X,Y,DA,DIC,DIE,DLAYGO,DR,DTOUT,DUOUT,GMTSCNT,GMTSDEF,GMTSENT
"RTN","GMTSXAR",161,0)
 N GMTSM,GMTSMGR,GMTSNEW,GMTSPARM,GMTSPI,GMTST
"RTN","GMTSXAR",162,0)
 S GMTSMGR=$$MGR^GMTSXAW3 Q:GMTSMGR'>0
"RTN","GMTSXAR",163,0)
 S GMTSPARM="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAR",164,0)
 S GMTSPI=$$PDI^GMTSXAW3(GMTSPARM) Q:+GMTSPI=0
"RTN","GMTSXAR",165,0)
 W !! W:$L(GMTSPARM) "'" W GMTSPARM W:$L(GMTSPARM) "' " W "ALLOWABLE ENTITIES",!
"RTN","GMTSXAR",166,0)
 S DA(1)=+($G(GMTSPI)),GMTSCNT=0
"RTN","GMTSXAR",167,0)
 S (DIC,DIE)="^XTV(8989.51,"_DA(1)_",30,",DIC(0)="AEQMLZ"
"RTN","GMTSXAR",168,0)
 S DIC("DR")=".02///^S X=$$AE^GMTSXAR(+($G(Y)))"
"RTN","GMTSXAR",169,0)
 S DLAYGO="" D FIELD^DID(8989.51,30,"","SPECIFIER","GMTST(""DID"")","GMTSM(""ERR"")")
"RTN","GMTSXAR",170,0)
 S:$L($G(GMTST("DID","SPECIFIER"))) DIC("P")=$G(GMTST("DID","SPECIFIER"))
"RTN","GMTSXAR",171,0)
L2 ;   Lock Record
"RTN","GMTSXAR",172,0)
 L +^XTV(8989.51,+($G(GMTSPI))) S GMTSCNT=GMTSCNT+1,GMTST=$T
"RTN","GMTSXAR",173,0)
 I 'GMTST,GMTSCNT'>3 H 2 G L2
"RTN","GMTSXAR",174,0)
 I 'GMTST,GMTSCNT>3 W !," Another user is editing this entry.",!," Unable to resequence at this time." Q
"RTN","GMTSXAR",175,0)
 D ^DIC S GMTSNEW=+($P($G(Y),"^",3)) Q:GMTSNEW>0  Q:+Y'>0
"RTN","GMTSXAR",176,0)
 N DIC,DIE S DA(1)=GMTSPI,DA=+($G(Y)),(DIC,DIE)="^XTV(8989.51,"_DA(1)_",30,"
"RTN","GMTSXAR",177,0)
 S DA=+($G(Y)),DR=".01;.02///^S X=$$AE^GMTSXAR("_DA_")"
"RTN","GMTSXAR",178,0)
 D ^DIE L -^XTV(8989.51,+($G(GMTSPI)))
"RTN","GMTSXAR",179,0)
 Q
"RTN","GMTSXAR",180,0)
AE(X) ;   Allowable Entity
"RTN","GMTSXAR",181,0)
 N DA,DIC,DTOUT,DUOUT,Y,GMTSPARM,GMTSPI,GMTSENT,GMTSDEF
"RTN","GMTSXAR",182,0)
 S GMTSDEF="",GMTSENT=+($G(X)),GMTSPARM="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAR",183,0)
 S GMTSPI=$$PDI^GMTSXAW3(GMTSPARM) Q:+GMTSPI=0 ""
"RTN","GMTSXAR",184,0)
 S:+GMTSENT>0 GMTSDEF=$$GET1^DIQ(8989.513,(GMTSENT_","_GMTSPI_","),.02)
"RTN","GMTSXAR",185,0)
 N DA,DIC,DTOUT,DUOUT,Y S DIC="^XTV(8989.518,",DIC(0)="AEMQ"
"RTN","GMTSXAR",186,0)
 S DIC("S")="I Y'=3.5&(Y'=9.4)&(Y'=44)&(Y'=404.51)&(Y'=405.4)"
"RTN","GMTSXAR",187,0)
 S:$L($G(GMTSDEF)) DIC("B")=GMTSDEF D ^DIC S X=+($G(Y))
"RTN","GMTSXAR",188,0)
 Q X
"VER")
8.0^22.0
**END**
**END**
