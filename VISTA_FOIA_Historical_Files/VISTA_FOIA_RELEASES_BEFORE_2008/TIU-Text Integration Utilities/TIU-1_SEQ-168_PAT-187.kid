Released TIU*1*187 SEQ #168
Extracted from mail message
**KIDS**:TIU*1.0*187^

**INSTALL NAME**
TIU*1.0*187
"BLD",4834,0)
TIU*1.0*187^TEXT INTEGRATION UTILITIES^0^3040420^y
"BLD",4834,1,0)
^^2^2^3040419^
"BLD",4834,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",4834,1,2,0)
under TIU*1*187.
"BLD",4834,4,0)
^9.64PA^^
"BLD",4834,"ABPKG")
n
"BLD",4834,"KRN",0)
^9.67PA^8989.52^19
"BLD",4834,"KRN",.4,0)
.4
"BLD",4834,"KRN",.401,0)
.401
"BLD",4834,"KRN",.402,0)
.402
"BLD",4834,"KRN",.403,0)
.403
"BLD",4834,"KRN",.5,0)
.5
"BLD",4834,"KRN",.84,0)
.84
"BLD",4834,"KRN",3.6,0)
3.6
"BLD",4834,"KRN",3.8,0)
3.8
"BLD",4834,"KRN",9.2,0)
9.2
"BLD",4834,"KRN",9.8,0)
9.8
"BLD",4834,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4834,"KRN",9.8,"NM",1,0)
TIUSROI^^0^B74469870
"BLD",4834,"KRN",9.8,"NM",2,0)
TIUSROI1^^0^B43729748
"BLD",4834,"KRN",9.8,"NM",3,0)
TIUPUTS^^0^B32847266
"BLD",4834,"KRN",9.8,"NM","B","TIUPUTS",3)

"BLD",4834,"KRN",9.8,"NM","B","TIUSROI",1)

"BLD",4834,"KRN",9.8,"NM","B","TIUSROI1",2)

"BLD",4834,"KRN",19,0)
19
"BLD",4834,"KRN",19.1,0)
19.1
"BLD",4834,"KRN",101,0)
101
"BLD",4834,"KRN",409.61,0)
409.61
"BLD",4834,"KRN",771,0)
771
"BLD",4834,"KRN",870,0)
870
"BLD",4834,"KRN",8989.51,0)
8989.51
"BLD",4834,"KRN",8989.52,0)
8989.52
"BLD",4834,"KRN",8994,0)
8994
"BLD",4834,"KRN","B",.4,.4)

"BLD",4834,"KRN","B",.401,.401)

"BLD",4834,"KRN","B",.402,.402)

"BLD",4834,"KRN","B",.403,.403)

"BLD",4834,"KRN","B",.5,.5)

"BLD",4834,"KRN","B",.84,.84)

"BLD",4834,"KRN","B",3.6,3.6)

"BLD",4834,"KRN","B",3.8,3.8)

"BLD",4834,"KRN","B",9.2,9.2)

"BLD",4834,"KRN","B",9.8,9.8)

"BLD",4834,"KRN","B",19,19)

"BLD",4834,"KRN","B",19.1,19.1)

"BLD",4834,"KRN","B",101,101)

"BLD",4834,"KRN","B",409.61,409.61)

"BLD",4834,"KRN","B",771,771)

"BLD",4834,"KRN","B",870,870)

"BLD",4834,"KRN","B",8989.51,8989.51)

"BLD",4834,"KRN","B",8989.52,8989.52)

"BLD",4834,"KRN","B",8994,8994)

"BLD",4834,"QUES",0)
^9.62^^
"BLD",4834,"REQB",0)
^9.611^5^2
"BLD",4834,"REQB",4,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",4834,"REQB",5,0)
TIU*1.0*112^2
"BLD",4834,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",4)

"BLD",4834,"REQB","B","TIU*1.0*112",5)

"MBREQ")
0
"PKG",516,-1)
1^1
"PKG",516,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",516,20,0)
^9.402P^^
"PKG",516,22,0)
^9.49I^1^1
"PKG",516,22,1,0)
1.0^3000126^2970815^11712
"PKG",516,22,1,"PAH",1,0)
187^3040420
"PKG",516,22,1,"PAH",1,1,0)
^^2^2^3040420
"PKG",516,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",516,22,1,"PAH",1,1,2,0)
under TIU*1*187.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIUPUTS")
0^3^B32847266
"RTN","TIUPUTS",1,0)
TIUPUTS ; SLC/JER - Surgery Look-up, etc. ; 04/19/2004
"RTN","TIUPUTS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112,187**;Jun 20, 1997
"RTN","TIUPUTS",3,0)
LOOKUP ; Look-up code used by router/filer
"RTN","TIUPUTS",4,0)
 ; Required: TIUSRCN, TIUSDA, TIUSSN, TIUODT
"RTN","TIUPUTS",5,0)
 N SRODT,DFN,TIUSR0,TIUD0,TIUDAD
"RTN","TIUPUTS",6,0)
 I $S('$D(TIUSSN):1,$G(TIUSSN)?4N:1,$G(TIUSSN)']"":1,+$G(TIUODT)'>0:1,1:0) S Y=-1 G LOOKUPX
"RTN","TIUPUTS",7,0)
 I TIUSSN?3N1P2N1P4N.E S TIUSSN=$TR(TIUSSN,"-/","")
"RTN","TIUPUTS",8,0)
 I TIUSSN["?" S Y=-1 G LOOKUPX
"RTN","TIUPUTS",9,0)
 S DFN=+$$PATIENT^TIULA(TIUSSN)
"RTN","TIUPUTS",10,0)
 I DFN'>0 S Y=-1 G LOOKUPX
"RTN","TIUPUTS",11,0)
 I +$G(TIUSRCN)=0 S TIUSRCN=$$FINDCASE(DFN,+$$IDATE^TIULC(TIUODT))
"RTN","TIUPUTS",12,0)
 I +$G(TIUSRCN)'>0 S Y=-1 G LOOKUPX
"RTN","TIUPUTS",13,0)
 I +$G(TIUSDA)'>0,$D(^SRF(TIUSRCN,"TIU")) S TIUSDA=$$GETSDA(TIUSRCN)
"RTN","TIUPUTS",14,0)
 I +$G(TIUSDA)'>0 D  G LOOKUPX
"RTN","TIUPUTS",15,0)
 . S Y=-1
"RTN","TIUPUTS",16,0)
 . I '$D(^SRF(TIUSRCN,"TIU")),'$D(ZTQUEUED) D
"RTN","TIUPUTS",17,0)
 . . W !!,"Time Out of O.R. has not yet been entered for Surgical Case #",TIUSRCN
"RTN","TIUPUTS",18,0)
 . . W !,"the Surgical Service must complete this step before the Operation"
"RTN","TIUPUTS",19,0)
 . . W !,"Report can be uploaded..."
"RTN","TIUPUTS",20,0)
 K TIUHDR(.001),TIUHDR(.02),TIUHDR(.07),TIUHDR(1405)
"RTN","TIUPUTS",21,0)
 S TIUD0=$G(^TIU(8925,TIUSDA,0)),TIUSR0=$G(^SRF(TIUSRCN,0))
"RTN","TIUPUTS",22,0)
 ;Confirm that SURGICAL CASE is for correct patient
"RTN","TIUPUTS",23,0)
 I +TIUSR0'=DFN S Y=-1 G LOOKUPX
"RTN","TIUPUTS",24,0)
 ;Confirm that TIU DOCUMENT is for correct patient
"RTN","TIUPUTS",25,0)
 I +$P(TIUD0,U,2)'=DFN S Y=-1 G LOOKUPX
"RTN","TIUPUTS",26,0)
 ;Confirm that OPERATION DATE is correct
"RTN","TIUPUTS",27,0)
 I +$$IDATE^TIULC(TIUODT)'=$P($P(TIUSR0,U,9),".") S Y=-1 G LOOKUPX
"RTN","TIUPUTS",28,0)
 S Y=$$CALLDIC(TIUSDA)
"RTN","TIUPUTS",29,0)
 I '+$$CANEDIT(+Y) D
"RTN","TIUPUTS",30,0)
 . W !,"Existing document may not be edited...Creating Addendum."
"RTN","TIUPUTS",31,0)
 . S TIUDAD=+Y,Y=$$MAKEADD^TIUPUTU()
"RTN","TIUPUTS",32,0)
 . D COPYDAD(Y,TIUDAD)
"RTN","TIUPUTS",33,0)
LOOKUPX K TIUSRCN,TIUSDA
"RTN","TIUPUTS",34,0)
 Q
"RTN","TIUPUTS",35,0)
CANEDIT(DA) ; Check whether or not document is released
"RTN","TIUPUTS",36,0)
 Q $S(+$P($G(^TIU(8925,+DA,0)),U,5)<4:1,1:0)
"RTN","TIUPUTS",37,0)
COPYDAD(DA,PARENT) ; copy fixed field data for addenda
"RTN","TIUPUTS",38,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIUOPDT,TIUD0,TIUD12,TIUD14
"RTN","TIUPUTS",39,0)
 S TIUD0=$G(^TIU(8925,+PARENT,0)),TIUD12=$G(^(12)),TIUD14=$G(^(14))
"RTN","TIUPUTS",40,0)
 S IENS=""""_DA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTS",41,0)
 S @FDARR@(.02)=$P(TIUD0,U,2)
"RTN","TIUPUTS",42,0)
 S @FDARR@(.03)=$P(TIUD0,U,3),@FDARR@(.05)=3
"RTN","TIUPUTS",43,0)
 S @FDARR@(.06)=PARENT,@FDARR@(.08)=$P(TIUD0,U,8)
"RTN","TIUPUTS",44,0)
 S @FDARR@(1401)=$P(TIUD14,U)
"RTN","TIUPUTS",45,0)
 S @FDARR@(1402)=$P(TIUD14,U,2)
"RTN","TIUPUTS",46,0)
 S @FDARR@(1405)=TIUSRCN_";SRF("
"RTN","TIUPUTS",47,0)
 S @FDARR@(1201)=$$NOW^TIULC
"RTN","TIUPUTS",48,0)
 S @FDARR@(1205)=$P(TIUD12,U,5)
"RTN","TIUPUTS",49,0)
 S TIUOPDT=+$$IDATE^TIULC($G(TIUODT))
"RTN","TIUPUTS",50,0)
 S TIURDT=$S(+$G(TIUOPDT)>0:+$G(TIUOPDT),1:+$$NOW^XLFDT)
"RTN","TIUPUTS",51,0)
 S @FDARR@(1301)=TIURDT,@FDARR@(1303)="U"
"RTN","TIUPUTS",52,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG") ; File record
"RTN","TIUPUTS",53,0)
 Q
"RTN","TIUPUTS",54,0)
FINDCASE(DFN,TIUODT) ; Find Surgical Case for Pt & Dt, if unique
"RTN","TIUPUTS",55,0)
 N TIUY,TIUCN,TIUHIT,TIUPOP S TIUCN="",(TIUY,TIUHIT,TIUPOP)=0
"RTN","TIUPUTS",56,0)
 F  S TIUCN=$O(^SRF("B",DFN,TIUCN),-1) Q:TIUCN'>0!+TIUPOP  D
"RTN","TIUPUTS",57,0)
 . N TIUSR0 S TIUSR0=$G(^SRF(TIUCN,0))
"RTN","TIUPUTS",58,0)
 . I +$G(TIUODT)=$P($P(TIUSR0,U,9),".") D
"RTN","TIUPUTS",59,0)
 . . I +TIUHIT S TIUPOP=1 Q
"RTN","TIUPUTS",60,0)
 . . S TIUHIT=TIUCN
"RTN","TIUPUTS",61,0)
 I 'TIUPOP,TIUHIT S TIUY=TIUHIT
"RTN","TIUPUTS",62,0)
 Q TIUY
"RTN","TIUPUTS",63,0)
GETSDA(TIUSRCN) ; Get Op Report for Case
"RTN","TIUPUTS",64,0)
 N TIUY S TIUY=+$P(^SRF(TIUSRCN,"TIU"),U)
"RTN","TIUPUTS",65,0)
 I 'TIUY S TIUY=+$P(^SRF(TIUSRCN,"TIU"),U,3)
"RTN","TIUPUTS",66,0)
 Q TIUY
"RTN","TIUPUTS",67,0)
CALLDIC(TIUX) ; Call ^DIC to get the IEN for the TIU DOCUMENT
"RTN","TIUPUTS",68,0)
 N DA,DIC,X,Y
"RTN","TIUPUTS",69,0)
 S DIC=8925,DIC(0)="NX",X="`"_TIUX D ^DIC
"RTN","TIUPUTS",70,0)
 Q Y
"RTN","TIUPUTS",71,0)
FOLLOWUP(TIUDA) ; Post-filing code for Operation Reports
"RTN","TIUPUTS",72,0)
 N FDA,FDARR,IENS,FLAGS,TIUMSG,TIU
"RTN","TIUPUTS",73,0)
 S IENS=""""_TIUDA_",""",FDARR="FDA(8925,"_IENS_")",FLAGS="K"
"RTN","TIUPUTS",74,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTS",75,0)
 I $L($G(TIU("EDT"))) S @FDARR@(.07)=$P($G(TIU("EDT")),U)
"RTN","TIUPUTS",76,0)
 S @FDARR@(1204)=$$WHOSIGNS^TIULC1(TIUDA)
"RTN","TIUPUTS",77,0)
 S @FDARR@(1208)=$$WHOCOSIG^TIULC1(TIUDA)
"RTN","TIUPUTS",78,0)
 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTS",79,0)
 I +$P($G(^TIU(8925,+TIUDA,12)),U,4)'=+$P($G(^(12)),U,9) D
"RTN","TIUPUTS",80,0)
 . S @FDARR@(1506)=1 D FILE^DIE(FLAGS,"FDA","TIUMSG")
"RTN","TIUPUTS",81,0)
 D RELEASE^TIUT(TIUDA,1)
"RTN","TIUPUTS",82,0)
 D AUDIT^TIUEDI1(TIUDA,0,$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")"))
"RTN","TIUPUTS",83,0)
 Q
"RTN","TIUPUTS",84,0)
FIX ; Filing error resolution code for Operation Reports
"RTN","TIUPUTS",85,0)
 N TIUOUT,TIUDA,TIUD0,TIUX,TIUPRM0,TIUPRM1,SUCCESS,TIUBUF,TIUHIT
"RTN","TIUPUTS",86,0)
 N TIUADD,TIUTYP,TIU,DUOUT,DTOUT
"RTN","TIUPUTS",87,0)
 S TIUHIT=0
"RTN","TIUPUTS",88,0)
 ; -- first, determine the correct TIU DOCUMENT record --
"RTN","TIUPUTS",89,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUPUTS",90,0)
 . N D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV
"RTN","TIUPUTS",91,0)
 . S X=+$$PATIENT^TIULA
"RTN","TIUPUTS",92,0)
 . I X'>0 D  Q
"RTN","TIUPUTS",93,0)
 . . W !!,"Okay, no harm done...",!
"RTN","TIUPUTS",94,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPUTS",95,0)
 . . S TIUOUT=1
"RTN","TIUPUTS",96,0)
 . S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUPUTS",97,0)
 . W !
"RTN","TIUPUTS",98,0)
 . S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUPUTS",99,0)
 . S DIC("S")="I +$$DICS^TIUPUTS(+Y)"
"RTN","TIUPUTS",100,0)
 . D IX^DIC
"RTN","TIUPUTS",101,0)
 . I +Y'>0 D  Q
"RTN","TIUPUTS",102,0)
 . . W !!,$S(+$O(^TIU(8925,"C",+X,0))'>0:"No OPERATION REPORTS Available to Update.",1:"No OPERATION REPORT Selected..."),!
"RTN","TIUPUTS",103,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPUTS",104,0)
 . . S TIUOUT=1
"RTN","TIUPUTS",105,0)
 . W ! S (DA,TIUHIT)=+Y D EN^DIQ
"RTN","TIUPUTS",106,0)
 . S TIUOUT=$$READ^TIUU("Y","... OK","YES") W !
"RTN","TIUPUTS",107,0)
 . I +TIUOUT S TIUDA=DA
"RTN","TIUPUTS",108,0)
 Q:$D(DUOUT)!$D(DIROUT)!+$G(DTOUT)!'+$G(TIUDA)
"RTN","TIUPUTS",109,0)
 ; -- next, load fields from upload buffer entry --
"RTN","TIUPUTS",110,0)
 S TIUBUF=$S(+$G(XQADATA):+$G(XQADATA),+$G(BUFDA):+$G(BUFDA),1:"")
"RTN","TIUPUTS",111,0)
 ; -- if TIUDA may be edited, file data, else make addendum --
"RTN","TIUPUTS",112,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUTYP=+TIUD0
"RTN","TIUPUTS",113,0)
 I +$$CANEDIT(TIUDA)'>0 D  G FIXX
"RTN","TIUPUTS",114,0)
 . W !!,"Existing document may not be edited...Creating Addendum.",!
"RTN","TIUPUTS",115,0)
 . D MAKEADD^TIUPEFIX(.TIUADD,TIUDA,TIUBUF)
"RTN","TIUPUTS",116,0)
 . S SUCCESS=TIUADD
"RTN","TIUPUTS",117,0)
 ; -- Load the array TIUX from the buffer
"RTN","TIUPUTS",118,0)
 D LOADTIUX^TIUPEFIX(.TIUX,TIUBUF)
"RTN","TIUPUTS",119,0)
 ; -- finally, file data in TIU DOCUMENT file --
"RTN","TIUPUTS",120,0)
 K ^TIU(8925,+TIUDA,"TEMP"),TIUX(.001),TIUX(.01),TIUX(.02),TIUX(.03),TIUX(.05)
"RTN","TIUPUTS",121,0)
 K TIUX(.13),TIUX(1205),TIUX(1211),TIUX(1405)
"RTN","TIUPUTS",122,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT") K TIUX("TEXT")
"RTN","TIUPUTS",123,0)
 D FILE^TIUPEFIX(.SUCCESS,+TIUDA,.TIUX,TIUTYP)
"RTN","TIUPUTS",124,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPUTS",125,0)
 D MERGTEXT^TIUEDI1(+TIUDA,.TIU) K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUPUTS",126,0)
 S TIUPOST=$$POSTFILE^TIULC1(TIUTYP)
"RTN","TIUPUTS",127,0)
 S TIUREC("#")=TIUDA
"RTN","TIUPUTS",128,0)
 I TIUPOST]"" X TIUPOST
"RTN","TIUPUTS",129,0)
FIXX D ALERTDEL^TIUPEVNT(+TIUBUF)
"RTN","TIUPUTS",130,0)
 D RESOLVE^TIUPEVNT($S($D(XQADATA):+$P(XQADATA,";",3),1:$G(ERRDA)),1)
"RTN","TIUPUTS",131,0)
 D BUFPURGE^TIUPUTC(+TIUBUF)
"RTN","TIUPUTS",132,0)
 W "Done."
"RTN","TIUPUTS",133,0)
 S TIUDONE=1
"RTN","TIUPUTS",134,0)
 Q
"RTN","TIUPUTS",135,0)
DICW(TIUDA) ; Write identifiers
"RTN","TIUPUTS",136,0)
 N X,Y,VADM,VA,VAERR,TIUD0,TIUD12,TIUD13
"RTN","TIUPUTS",137,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13))
"RTN","TIUPUTS",138,0)
 W ?35,"Dated: ",$$DATE^TIULS(+TIUD13,"MM/DD/CCYY@HR:MIN"),?62,"By: ",$E($$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI MI"),1,13)
"RTN","TIUPUTS",139,0)
 Q
"RTN","TIUPUTS",140,0)
DICS(TIUDA) ; Filter IX^DIC list
"RTN","TIUPUTS",141,0)
 N TIUD0,TIUY S TIUY=0
"RTN","TIUPUTS",142,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUPUTS",143,0)
 I +$$ISA^TIULX(+TIUD0,+$$CLASS^TIUSROI("OPERATION REPORTS")) S TIUY=1 I 1
"RTN","TIUPUTS",144,0)
 E  I +$$ISA^TIULX(+TIUD0,+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")) S TIUY=1
"RTN","TIUPUTS",145,0)
 Q TIUY
"RTN","TIUSROI")
0^1^B74469870
"RTN","TIUSROI",1,0)
TIUSROI ; SLC/JER - TIU/Surgery Interface Routine ; 04/19/2004
"RTN","TIUSROI",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112,187**;Jun 20, 1997
"RTN","TIUSROI",3,0)
 Q
"RTN","TIUSROI",4,0)
GETOP(TIUY,TIUDA,SROTYP) ; Get Op-Top
"RTN","TIUSROI",5,0)
 N SROVP
"RTN","TIUSROI",6,0)
 S SROVP=$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI",7,0)
 S SROTYP=$G(SROTYP,"OP")
"RTN","TIUSROI",8,0)
 S TIUY=$S(SROTYP="OP":$NA(^TMP("SROP",$J,+SROVP)),1:$NA(^TMP("SRNOR",$J,+SROVP)))
"RTN","TIUSROI",9,0)
 I $P(SROVP,";",2)'="SRF(" Q
"RTN","TIUSROI",10,0)
 ; Call Surgery API
"RTN","TIUSROI",11,0)
 D @$S(SROTYP="OP":"OPTOP^SROSRPT(+SROVP)",1:"OPTOP^SRONP(+SROVP)")
"RTN","TIUSROI",12,0)
 I +$G(@TIUY@(0))=0 K @TIUY Q
"RTN","TIUSROI",13,0)
 I '$D(XWBOS),'$D(ZTQUEUED),($E($G(IOST))="C"),(@TIUY@(0)=2) D
"RTN","TIUSROI",14,0)
 . N SEEOP S SEEOP=0
"RTN","TIUSROI",15,0)
 . I $S(+$D(XQADATA):1,$G(TIUEVNT)["SIGN":1,1:0) D  Q:+SEEOP
"RTN","TIUSROI",16,0)
 . . W !
"RTN","TIUSROI",17,0)
 . . S SEEOP=+$$READ^TIUU("YA","Do you want to see the Op Top? ","YES")
"RTN","TIUSROI",18,0)
 . K @TIUY
"RTN","TIUSROI",19,0)
 I $D(XWBOS),($G(@TIUY@(0))'=1) K @TIUY
"RTN","TIUSROI",20,0)
 Q
"RTN","TIUSROI",21,0)
GETCASE(DFN,DA) ; Match Operation Report to an open Surgical Case
"RTN","TIUSROI",22,0)
 ; Call with:     [DFN] - patient file entry number
"RTN","TIUSROI",23,0)
 ;   Returns:     TIUY  - Variable pointer to Surgical Case
"RTN","TIUSROI",24,0)
AGN ; Loop for handling repeated attempts
"RTN","TIUSROI",25,0)
 N TIUI,TIUII,TIUER,TIUOK,TIUOUT,TIUX,TIUY,TIUMTSTR,TIUMLST,TIUCNT,X
"RTN","TIUSROI",26,0)
 N TIULIST
"RTN","TIUSROI",27,0)
 I +DFN'>0 S TIUOUT=1 Q 0
"RTN","TIUSROI",28,0)
 I +$G(DA) D  G:+TIUX>0 GETX
"RTN","TIUSROI",29,0)
 . I +$P($G(^TIU(8925,+DA,14)),U,5) S TIUX=+$P($G(^(14)),U,5) Q
"RTN","TIUSROI",30,0)
 . I +$$ISADDNDM^TIULC1(+DA) S TIUX=+$$DADSC(DA)
"RTN","TIUSROI",31,0)
 ; Call Surgery to get list of cases
"RTN","TIUSROI",32,0)
 D LIST^SROESTV(.TIULIST,DFN,"","","",0)
"RTN","TIUSROI",33,0)
 ; If no Surgeries for patient, then quit
"RTN","TIUSROI",34,0)
 I '$D(@TIULIST) D  Q -1
"RTN","TIUSROI",35,0)
 . W !!,$C(7),"No SURGICAL CASES to Result for ",$$PTNAME^TIULC1(DFN),".",!
"RTN","TIUSROI",36,0)
 S (TIUCNT,TIUI)=0 F  S TIUI=+$O(@TIULIST@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSROI",37,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSROI",38,0)
 W !,"You must link your Result to a SURGICAL CASE...",!
"RTN","TIUSROI",39,0)
 D INDEX(TIULIST)
"RTN","TIUSROI",40,0)
 D  I +TIUER Q:+$G(TIUOUT) 0  G AGN
"RTN","TIUSROI",41,0)
 . W !,"The following SURGICAL CASE"
"RTN","TIUSROI",42,0)
 . W $S(+TIUCNT>1:"(S) are",1:" is")," available:"
"RTN","TIUSROI",43,0)
 . S (TIUER,TIUOK,TIUI)=0
"RTN","TIUSROI",44,0)
 . F  S TIUI=$O(@TIULIST@(TIUI)) Q:+TIUI'>0!+TIUER!+TIUOK  D
"RTN","TIUSROI",45,0)
 . . S TIUII=TIUI,TIUX=$G(@TIULIST@(TIUI))
"RTN","TIUSROI",46,0)
 . . D WRITE I '(TIUI#5) D BREAK
"RTN","TIUSROI",47,0)
 . Q:$D(TIUOUT)
"RTN","TIUSROI",48,0)
 . I +TIUER S TIUOUT=1 Q
"RTN","TIUSROI",49,0)
 . I TIUII#5 D BREAK Q:$D(TIUOUT)
"RTN","TIUSROI",50,0)
 . I +TIUER S TIUOUT=1 Q
"RTN","TIUSROI",51,0)
 . S TIUX=+@TIULIST@(TIUOK),^DISV(DUZ,"^SRF(",DFN)=+TIUX
"RTN","TIUSROI",52,0)
 . W "  ",+TIUX
"RTN","TIUSROI",53,0)
GETX S TIUY=+TIUX_";SRF(" K @TIULIST
"RTN","TIUSROI",54,0)
 Q $G(TIUY)
"RTN","TIUSROI",55,0)
BREAK ; Handle prompting
"RTN","TIUSROI",56,0)
 W !,"CHOOSE 1-",TIUII W:$D(@TIULIST@(TIUII+1)) !,"<RETURN> TO CONTINUE",!,"OR '^' TO QUIT" W ": " R X:DTIME
"RTN","TIUSROI",57,0)
 I $S('$T!(X["^"):1,X=""&'$D(@TIULIST@(TIUII+1)):1,1:0) S TIUER=1 Q
"RTN","TIUSROI",58,0)
 I X="" Q
"RTN","TIUSROI",59,0)
 I X=" ",$D(^DISV(DUZ,"^SRF(",DFN)) S TIUX=^(DFN) S TIUOK=+$O(@TIULIST@("C",+TIUX,0)) Q
"RTN","TIUSROI",60,0)
 I X'=+X!'$D(@TIULIST@(+X)) W !!,$C(7),"INVALID RESPONSE",! G BREAK
"RTN","TIUSROI",61,0)
 S TIUOK=X
"RTN","TIUSROI",62,0)
 Q
"RTN","TIUSROI",63,0)
DADSC(DA) ; Get the Surgical Case associated with the parent record
"RTN","TIUSROI",64,0)
 N TIUDADA,TIUY S TIUDADA=$P($G(^TIU(8925,+DA,0)),U,6)
"RTN","TIUSROI",65,0)
 S TIUY=$P($G(^TIU(8925,TIUDADA,14)),U,5)
"RTN","TIUSROI",66,0)
 Q TIUY
"RTN","TIUSROI",67,0)
WRITE ; Writes each case
"RTN","TIUSROI",68,0)
 W !,$J(TIUI,4),">  ",$$DATE^TIULS($P(TIUX,U,3),"AMTH DD, CCYY")
"RTN","TIUSROI",69,0)
 W " Case #",$P(TIUX,U),?34,$E($P(TIUX,U,2),1,25)
"RTN","TIUSROI",70,0)
 W ?60,$E($P($P(TIUX,U,4),";",2),1,20)
"RTN","TIUSROI",71,0)
 Q
"RTN","TIUSROI",72,0)
INDEX(TIULIST) ; Build index of list
"RTN","TIUSROI",73,0)
 N TIUI S TIUI=0
"RTN","TIUSROI",74,0)
 F  S TIUI=$O(@TIULIST@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSROI",75,0)
 . S @TIULIST@("C",+@TIULIST@(TIUI),TIUI)=""
"RTN","TIUSROI",76,0)
 Q
"RTN","TIUSROI",77,0)
ISSURG(TIUY,TITLE) ; Boolean RPC to evaluate whether TITLE is a SURGERY REPORT
"RTN","TIUSROI",78,0)
 N TIUCLASS,TIUI S TIUY=0
"RTN","TIUSROI",79,0)
 F TIUI="SURGICAL REPORTS","PROCEDURE REPORTS (NON-O.R.)" D  Q:TIUY>0
"RTN","TIUSROI",80,0)
 . S TIUCLASS=+$$CLASS(TIUI)
"RTN","TIUSROI",81,0)
 . I +TIUCLASS'>0 Q
"RTN","TIUSROI",82,0)
 . S TIUY=+$$ISA^TIULX(TITLE,TIUCLASS)
"RTN","TIUSROI",83,0)
 Q
"RTN","TIUSROI",84,0)
RBOR(TIUDA) ; Roll back OPERATION REPORT when TIU changes require it
"RTN","TIUSROI",85,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5) Q:+SRODA'>0
"RTN","TIUSROI",86,0)
 D OS^SROTIUD(SRODA)
"RTN","TIUSROI",87,0)
 Q
"RTN","TIUSROI",88,0)
RBPR(TIUDA) ; Roll back NON-O.R. PROC REPORT when TIU changes require it
"RTN","TIUSROI",89,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI",90,0)
 Q:+SRODA'>0
"RTN","TIUSROI",91,0)
 D NON^SROTIUD(SRODA)
"RTN","TIUSROI",92,0)
 Q
"RTN","TIUSROI",93,0)
CLASS(CLNAME) ; What is the TIU Class (or Document Class) for SURGERY REPORTS
"RTN","TIUSROI",94,0)
 N TIUY
"RTN","TIUSROI",95,0)
 S TIUY=+$O(^TIU(8925.1,"B",CLNAME,0))
"RTN","TIUSROI",96,0)
 I +TIUY>0,$S($P($G(^TIU(8925.1,+TIUY,0)),U,4)="CL":0,$P($G(^(0)),U,4)="DC":0,1:1) S TIUY=0
"RTN","TIUSROI",97,0)
 Q TIUY
"RTN","TIUSROI",98,0)
ES(TIUDA,TIUDUZ) ; Apply user's e-Sig to Document
"RTN","TIUSROI",99,0)
 N TIUES
"RTN","TIUSROI",100,0)
 S TIUDUZ=$G(TIUDUZ,DUZ)
"RTN","TIUSROI",101,0)
 I '+$G(^TIU(8925,TIUDA,0)) Q
"RTN","TIUSROI",102,0)
 S TIUES="1^"_$$SIGNAME^TIULS(TIUDUZ)_U_$$SIGTITL^TIULS(TIUDUZ)
"RTN","TIUSROI",103,0)
 D ES^TIURS(TIUDA,TIUES)
"RTN","TIUSROI",104,0)
 Q
"RTN","TIUSROI",105,0)
ENTEROP(DFN,TIUTYP) ; Re-direct entry of Op and Proc Reports
"RTN","TIUSROI",106,0)
 N TIUDA,TIUD0,TIUX,TIUPRM0,TIUPRM1,SUCCESS,TIUBUF,TIUTNM
"RTN","TIUSROI",107,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",108,0)
 ; -- Exclude NIR and AR from Entry
"RTN","TIUSROI",109,0)
 I $S(TIUTNM["ANESTH":1,TIUTNM["NURS":1,1:0) D  Q
"RTN","TIUSROI",110,0)
 . W !!,TIUTNM,"s may only be entered through the Surgery Options.",!
"RTN","TIUSROI",111,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",112,0)
 . W !
"RTN","TIUSROI",113,0)
 ; -- first, determine the correct TIU DOCUMENT record --
"RTN","TIUSROI",114,0)
 F  D  Q:$D(DUOUT)!$D(DIROUT)!+$G(TIUOUT)
"RTN","TIUSROI",115,0)
 . N D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV
"RTN","TIUSROI",116,0)
 . S X=+$G(DFN)
"RTN","TIUSROI",117,0)
 . I X'>0 D  Q
"RTN","TIUSROI",118,0)
 . . W !!,"No Patient Specified...",!
"RTN","TIUSROI",119,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",120,0)
 . . S TIUOUT=1 W !
"RTN","TIUSROI",121,0)
 . S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUSROI",122,0)
 . W !
"RTN","TIUSROI",123,0)
 . S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUSROI",124,0)
 . S DIC("S")="I +$G(^TIU(8925,+Y,0))=TIUTYP"
"RTN","TIUSROI",125,0)
 . D IX^DIC
"RTN","TIUSROI",126,0)
 . I +Y'>0 D  Q
"RTN","TIUSROI",127,0)
 . . W !!,$S(+$O(^TIU(8925,"C",+X,0))'>0:"No "_TIUTNM_"s Available.",1:"No "_TIUTNM_" Selected..."),!
"RTN","TIUSROI",128,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",129,0)
 . . S TIUOUT=1 W !
"RTN","TIUSROI",130,0)
 . D BROWS1^TIURA2("TIU BROWSE FOR TRANSCRIPTION",+Y)
"RTN","TIUSROI",131,0)
 . S TIUOUT=1 W !
"RTN","TIUSROI",132,0)
 Q
"RTN","TIUSROI",133,0)
REASSOP(DFN,TIUODA) ; Re-direct REASSIGNMENT of Op and Proc Reports
"RTN","TIUSROI",134,0)
 N TIUDA,TIUD0,TIUD12,TIUTYP,TIUTNM,TIUSCRN
"RTN","TIUSROI",135,0)
 S TIUD0(0)=$G(^TIU(8925,+TIUODA,0)),TIUD12(0)=$G(^(12))
"RTN","TIUSROI",136,0)
 I DFN=$P(TIUD0(0),U,2) D CHANGE^TIUSROI1(TIUODA) Q
"RTN","TIUSROI",137,0)
 S TIUTYP=+TIUD0(0)
"RTN","TIUSROI",138,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",139,0)
 ; -- Exclude NIR and AR from Entry
"RTN","TIUSROI",140,0)
 I +$$ISADDNDM^TIULC1(TIUODA),$S($$GET1^DIQ(8925,TIUODA,.06)["ANESTH":1,$$GET1^DIQ(8925,TIUODA,.06)["NURS":1,1:0) D  G REASSOPX
"RTN","TIUSROI",141,0)
 . W !!,"ADDENDUMs to ",$$GET1^DIQ(8925,TIUODA,.06),"s may not be reassigned.",!
"RTN","TIUSROI",142,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUSROI",143,0)
 . S TIUOUT=1 W !
"RTN","TIUSROI",144,0)
 S TIUDA=0
"RTN","TIUSROI",145,0)
 I $S(TIUTNM["ANESTH":1,TIUTNM["NURS":1,1:0) D  G REASSOPX
"RTN","TIUSROI",146,0)
 . W !!,TIUTNM,"s may only be created through the Surgery Options..."
"RTN","TIUSROI",147,0)
 . W !,"Reassignment is not allowed.",!
"RTN","TIUSROI",148,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",149,0)
 . S TIUOUT=1 W !
"RTN","TIUSROI",150,0)
 ; choose destination case
"RTN","TIUSROI",151,0)
 W ! S SROVP=$$GETCASE^TIUSROI(DFN)
"RTN","TIUSROI",152,0)
 ; if no case is selected, quit
"RTN","TIUSROI",153,0)
 I +SROVP'>0 D  Q
"RTN","TIUSROI",154,0)
 . W !!,$C(7),"Okay, no harm done...",!
"RTN","TIUSROI",155,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI",156,0)
 ; if target case is same as current, quit
"RTN","TIUSROI",157,0)
 I +SROVP=+$P(^TIU(8925,TIUODA,14),U,5) D  Q
"RTN","TIUSROI",158,0)
 . W !!,$C(7),"You've selected the original case. No changes made.",!
"RTN","TIUSROI",159,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI",160,0)
 ; Get the document for the target surgical case
"RTN","TIUSROI",161,0)
 S TIUDA=$$TARGET^TIUSROI1(SROVP)
"RTN","TIUSROI",162,0)
 ; if target document is of a different type than source, quit
"RTN","TIUSROI",163,0)
 I $$TYPE^TIUSROI1(TIUDA)'=$$TYPE^TIUSROI1(TIUODA) D  Q
"RTN","TIUSROI",164,0)
 . W !!,$C(7),"Incompatible document type. No changes made.",!
"RTN","TIUSROI",165,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI",166,0)
 I +TIUDA'>0 D  G REASSOPX
"RTN","TIUSROI",167,0)
 . W !!,"No Destination Document Selected: Aborting Transaction,",!,"   No Harm Done...",!
"RTN","TIUSROI",168,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",169,0)
 ; -- If original and target are the same --
"RTN","TIUSROI",170,0)
 I +TIUDA=+TIUODA D  G REASSOPX
"RTN","TIUSROI",171,0)
 . W !!,$C(7),"You've selected the original case. No changes made.",!
"RTN","TIUSROI",172,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI",173,0)
 ; -- Confirm selection --
"RTN","TIUSROI",174,0)
 I '$$FROMTO^TIUSROI1(TIUODA,TIUDA,TIUTNM) D  G REASSOPX
"RTN","TIUSROI",175,0)
 . W !!,"Aborting Transaction, No Harm Done...",!
"RTN","TIUSROI",176,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",177,0)
 ; -- Conditionally Retract Original --
"RTN","TIUSROI",178,0)
 I (+$P(TIUD0(0),U,5)>5) D
"RTN","TIUSROI",179,0)
 . N TIUMSG,TIURTCT S TIUMSG=$S(DFN=+$P(TIUD0(0),U,2):"Reassigning document...",DFN'=+$P(TIUD0(0),U,2):"Moving signed document to another Patient...")
"RTN","TIUSROI",180,0)
 . W !!,TIUMSG,!,"A RETRACTED copy will be retained.",!
"RTN","TIUSROI",181,0)
 . S TIURTCT=$$RETRACT^TIURD2(TIUODA,"",15)
"RTN","TIUSROI",182,0)
 ; -- Copy AUTHOR from original to target/Update target status --
"RTN","TIUSROI",183,0)
 D AUTHSTAT(TIUDA,TIUODA,.TIUD12)
"RTN","TIUSROI",184,0)
 ; -- Copy contents of original into target --
"RTN","TIUSROI",185,0)
 D COPYTEXT^TIURC1(TIUODA,TIUDA) K ^TIU(8925,TIUDA,15)
"RTN","TIUSROI",186,0)
 I $D(^TIU(8925,TIUDA,"TEMP")) D
"RTN","TIUSROI",187,0)
 . N TIU
"RTN","TIUSROI",188,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSROI",189,0)
 . D MERGTEXT^TIUEDI1(TIUDA,.TIU)
"RTN","TIUSROI",190,0)
 . K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUSROI",191,0)
 ; -- Conditionally roll back original --
"RTN","TIUSROI",192,0)
 I +$P(TIUD0(0),U,5)>5 D
"RTN","TIUSROI",193,0)
 . N TIUDA,TIUDELX
"RTN","TIUSROI",194,0)
 . S TIUDA=TIUODA
"RTN","TIUSROI",195,0)
 . S TIUDELX=$$DELETE^TIULC1(+$G(TIUD0(0)))
"RTN","TIUSROI",196,0)
 . I TIUDELX]"" X TIUDELX
"RTN","TIUSROI",197,0)
 I +$P(TIUD0(0),U,5)'>5 D
"RTN","TIUSROI",198,0)
 . N TIUX,SUCCESS
"RTN","TIUSROI",199,0)
 . K ^TIU(8925,TIUODA,"TEXT")
"RTN","TIUSROI",200,0)
 . S TIUX(.05)=1
"RTN","TIUSROI",201,0)
 . D FILE^TIUSRVP(.SUCCESS,TIUODA,.TIUX,1)
"RTN","TIUSROI",202,0)
 ; -- Send Signature Alerts for target --
"RTN","TIUSROI",203,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIUSROI",204,0)
 ; -- Delete Signature Alerts for Original --
"RTN","TIUSROI",205,0)
 D ALERTDEL^TIUALRT(TIUODA)
"RTN","TIUSROI",206,0)
 ; -- Audit Reassignment of target --
"RTN","TIUSROI",207,0)
 S TIUD0(1)=$G(^TIU(8925,+TIUDA,0)),TIUD12(1)=$G(^(12))
"RTN","TIUSROI",208,0)
 D AUDREASS^TIURB1(TIUDA,.TIUD0,.TIUD12)
"RTN","TIUSROI",209,0)
 ; -- Register audit trail for original
"RTN","TIUSROI",210,0)
 I +$G(TIUODA) D AUDREASS^TIURB1(TIUODA,.TIUD0,.TIUD12)
"RTN","TIUSROI",211,0)
 S TIUCHNG=1
"RTN","TIUSROI",212,0)
REASSOPX Q
"RTN","TIUSROI",213,0)
AUTHSTAT(TIUDA,TIUODA,TIUD12) ; Copy Author, update status
"RTN","TIUSROI",214,0)
 N TIUX,SUCCESS
"RTN","TIUSROI",215,0)
 S TIUX(.05)=5
"RTN","TIUSROI",216,0)
 S TIUX(1406)=TIUODA
"RTN","TIUSROI",217,0)
 I +$P(TIUD12(0),U,2) S TIUX(1202)=$P(TIUD12(0),U,2)
"RTN","TIUSROI",218,0)
 D FILE^TIUSRVP(.SUCCESS,TIUDA,.TIUX,1)
"RTN","TIUSROI",219,0)
 Q
"RTN","TIUSROI",220,0)
SELOP(DFN,TIUTYP,TIUSCRN) ; Select an Op or Proc Report
"RTN","TIUSROI",221,0)
 N DUOUT,DTOUT,D,D0,DK,DL,DIC,X,Y,DA,DX,A,S,TIUFPRIV,TIUY,TIUTNM
"RTN","TIUSROI",222,0)
 S TIUY=0
"RTN","TIUSROI",223,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI",224,0)
 S TIUSCRN=$G(TIUSCRN,"I +$G(^TIU(8925,+Y,0))=TIUTYP")
"RTN","TIUSROI",225,0)
 S X=+$G(DFN)
"RTN","TIUSROI",226,0)
 I X'>0 D  G SELOPX
"RTN","TIUSROI",227,0)
 . W !!,"No Patient Specified...",!
"RTN","TIUSROI",228,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",229,0)
 . W !
"RTN","TIUSROI",230,0)
 S DIC=8925,DIC(0)="UXEV",D="C"
"RTN","TIUSROI",231,0)
 W !
"RTN","TIUSROI",232,0)
 S DIC("W")="D DICW^TIUPUTS(+Y)"
"RTN","TIUSROI",233,0)
 S DIC("S")=TIUSCRN
"RTN","TIUSROI",234,0)
 D IX^DIC
"RTN","TIUSROI",235,0)
 I +Y'>0 D
"RTN","TIUSROI",236,0)
 . W !!,"No "_TIUTNM
"RTN","TIUSROI",237,0)
 . W $S(+$O(^TIU(8925,"APT",DFN,TIUTYP,0))'>0:"s On File.",+$O(^(0))>2:"s Available.",1:" Selected..."),!
"RTN","TIUSROI",238,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI",239,0)
 . W !
"RTN","TIUSROI",240,0)
 S TIUY=+Y
"RTN","TIUSROI",241,0)
SELOPX Q TIUY
"RTN","TIUSROI1")
0^2^B43729748
"RTN","TIUSROI1",1,0)
TIUSROI1 ; SLC/JER - Reassign actions ; 04/19/2004
"RTN","TIUSROI1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**112,187**;Jun 20, 1997
"RTN","TIUSROI1",3,0)
 Q
"RTN","TIUSROI1",4,0)
FROMTO(TIUODA,TIUDA,TIUTNM) ; Display the from/to information
"RTN","TIUSROI1",5,0)
 N TIUF,TIUF12,TIUT,TIUT12,TIUFEDT,TIUFLDT,TIUTEDT,TIUTLDT
"RTN","TIUSROI1",6,0)
 D GETTIU^TIULD(.TIUF,+TIUODA)
"RTN","TIUSROI1",7,0)
 D GETTIU^TIULD(.TIUT,+TIUDA)
"RTN","TIUSROI1",8,0)
 S TIUFEDT=$$DATE^TIULS($P(TIUF("EDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",9,0)
 S TIUFLDT=$$DATE^TIULS($P(TIUF("LDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",10,0)
 S TIUTEDT=$$DATE^TIULS($P(TIUT("EDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",11,0)
 S TIUTLDT=$$DATE^TIULS($P(TIUT("LDT"),U),"MM/DD/YY HR:MIN")
"RTN","TIUSROI1",12,0)
 S TIUF12=$G(^TIU(8925,TIUODA,12)),TIUT12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUSROI1",13,0)
 W !!,"You are about to move the ",TIUTNM," as follows:",!
"RTN","TIUSROI1",14,0)
 W !,?5,"From",?45,"To",!
"RTN","TIUSROI1",15,0)
 W !,$P(TIUF("DOCTYP"),U,2),?35," --> ",?40,$P(TIUT("DOCTYP"),U,2)
"RTN","TIUSROI1",16,0)
 W !,TIUF("PNM")," ",TIUF("PID"),?35," --> ",?40,TIUT("PNM")," ",TIUT("PID")
"RTN","TIUSROI1",17,0)
 W !,TIUFEDT,$S(+TIUFLDT:" - "_TIUFLDT,1:""),?35," --> "
"RTN","TIUSROI1",18,0)
 W ?40,TIUTEDT,$S(+TIUTLDT:" - "_TIUTLDT,1:""),!
"RTN","TIUSROI1",19,0)
 W !," Dictated By: ",$$PERSNAME^TIULC1(+$P(TIUF12,U,2)),?35," --> "
"RTN","TIUSROI1",20,0)
 W ?40,$$PERSNAME^TIULC1(+$P(TIUF12,U,2))
"RTN","TIUSROI1",21,0)
 W !,"   Attending: ",$$PERSNAME^TIULC1(+$P(TIUF12,U,9)),?35," --> "
"RTN","TIUSROI1",22,0)
 W ?40,$$PERSNAME^TIULC1(+$P(TIUT12,U,9))
"RTN","TIUSROI1",23,0)
 W !,"Surg. Case #: ",+$P($G(^TIU(8925,TIUODA,14)),U,5),?35," --> "
"RTN","TIUSROI1",24,0)
 W ?40,+$P($G(^TIU(8925,TIUDA,14)),U,5),!
"RTN","TIUSROI1",25,0)
 Q +$$READ^TIUU("YA"," ... Ok? ","NO")
"RTN","TIUSROI1",26,0)
ANES(TIUDA) ; Roll back ANESTHESIA REPORT when TIU changes require it
"RTN","TIUSROI1",27,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI1",28,0)
 Q:+SRODA'>0
"RTN","TIUSROI1",29,0)
 D ANES^SROTIUD(SRODA)
"RTN","TIUSROI1",30,0)
 Q
"RTN","TIUSROI1",31,0)
NURS(TIUDA) ; Roll back NURSE INTRAOPERATIVE REPORT when TIU changes require it
"RTN","TIUSROI1",32,0)
 N SRODA S SRODA=+$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIUSROI1",33,0)
 Q:+SRODA'>0
"RTN","TIUSROI1",34,0)
 D NURS^SROTIUD(SRODA)
"RTN","TIUSROI1",35,0)
 Q
"RTN","TIUSROI1",36,0)
RETRACT(TIUDA) ;
"RTN","TIUSROI1",37,0)
 N CNT,TITLE,TIUACT,TIUDATA
"RTN","TIUSROI1",38,0)
 S TIUDATA="ANESTHESIA REPORTS^NURSE INTRAOPERATIVE REPORTS^OPERATION REPORTS^PROCEDURE REPORT (NON-O.R.)"
"RTN","TIUSROI1",39,0)
 F CNT=1:1:$L(TIUDATA,U) S TITLE=$P(TIUDATA,U,CNT) I $$BELONGS^TIULX(TIUDA,$$FIND1^DIC(8925.1,"","BX",TITLE)) D
"RTN","TIUSROI1",40,0)
 . S TIUACT=$S(CNT=1:"ANES^TIUSROI1(TIUDA)",CNT=2:"NURS^TIUSROI1(TIUDA)",CNT=3:"RBOR^TIUSROI(TIUDA)",CNT=4:"RBPR^TIUSROI(TIUDA)",1:"QUIT")
"RTN","TIUSROI1",41,0)
 . I TIUACT="QUIT" Q
"RTN","TIUSROI1",42,0)
 . D @TIUACT
"RTN","TIUSROI1",43,0)
 Q
"RTN","TIUSROI1",44,0)
CHANGE(TIUDA) ; Redirect the TIU Document to a different Surgical Case
"RTN","TIUSROI1",45,0)
 N DFN,SROVP,TIUD0,TIUD14,TIUNDA,TIUACT
"RTN","TIUSROI1",46,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD14=$G(^(14)),SROVP=$P(TIUD14,U,5)
"RTN","TIUSROI1",47,0)
 S DFN=$P(TIUD0,U,2) Q:+DFN'>0
"RTN","TIUSROI1",48,0)
 ; choose destination case
"RTN","TIUSROI1",49,0)
 W ! S SROVP=$$GETCASE^TIUSROI(DFN)
"RTN","TIUSROI1",50,0)
 ; if no case is selected, quit
"RTN","TIUSROI1",51,0)
 I +SROVP'>0 D  Q
"RTN","TIUSROI1",52,0)
 . W !!,$C(7),"Okay, no harm done...",!
"RTN","TIUSROI1",53,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",54,0)
 ; if target case is same as current, quit
"RTN","TIUSROI1",55,0)
 I +SROVP=+$P(TIUD14,U,5) D  Q
"RTN","TIUSROI1",56,0)
 . W !!,$C(7),"You've selected the original case. No changes made.",!
"RTN","TIUSROI1",57,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",58,0)
 ; Get the document for the target surgical case
"RTN","TIUSROI1",59,0)
 S TIUNDA=$$TARGET(SROVP)
"RTN","TIUSROI1",60,0)
 ; if target document is of a different type than source, quit
"RTN","TIUSROI1",61,0)
 I $$TYPE(TIUNDA)'=$$TYPE(TIUDA) D  Q
"RTN","TIUSROI1",62,0)
 . W !!,$C(7),"Incompatible document type. No changes made.",!
"RTN","TIUSROI1",63,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",64,0)
 ; if target case has empty report, replace
"RTN","TIUSROI1",65,0)
 S TIUTYP=+TIUD0
"RTN","TIUSROI1",66,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUSROI1",67,0)
 I '$$FROMTO^TIUSROI1(TIUDA,TIUNDA,TIUTNM) D  Q
"RTN","TIUSROI1",68,0)
 . W !!,"Aborting Transaction, No Harm Done...",!
"RTN","TIUSROI1",69,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUSROI1",70,0)
 I +$$EMPTYDOC^TIULF(TIUNDA) D  Q
"RTN","TIUSROI1",71,0)
 . W !!,"Moving document ",TIUDA," to Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",72,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",73,0)
 . D REPLACE(TIUDA,TIUNDA)
"RTN","TIUSROI1",74,0)
 ; else, ask whether to swap or replace
"RTN","TIUSROI1",75,0)
 S TIUACT=$$ASKACT($$TITLE(TIUNDA))
"RTN","TIUSROI1",76,0)
 I $P(TIUACT,U)="E"!($P(TIUACT,U)="") D  Q
"RTN","TIUSROI1",77,0)
 . W !!,"Great. No harm done.",!
"RTN","TIUSROI1",78,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",79,0)
 I $P(TIUACT,U)="R" D  Q
"RTN","TIUSROI1",80,0)
 . W !!,"Replacing ",$$TITLE(TIUNDA)," on Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",81,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",82,0)
 . D REPLACE(TIUDA,TIUNDA)
"RTN","TIUSROI1",83,0)
 I $P(TIUACT,U)="S" D
"RTN","TIUSROI1",84,0)
 . W !!,"Swapping with ",$$TITLE(TIUNDA)," on Surgical Case #",+SROVP,"...",!
"RTN","TIUSROI1",85,0)
 . I '+$$READ^TIUU("YA","Are you sure? ","NO") Q
"RTN","TIUSROI1",86,0)
 . D SWAP(TIUDA,TIUNDA)
"RTN","TIUSROI1",87,0)
 Q
"RTN","TIUSROI1",88,0)
ASKACT(TITLE) ; ask user to choose replace or swap
"RTN","TIUSROI1",89,0)
 N TIUY,TIUSET S TIUY=""
"RTN","TIUSROI1",90,0)
 W !!,"Please choose the appropriate action for this "_TITLE_":"
"RTN","TIUSROI1",91,0)
 S TIUSET="R:replace target document with this document"
"RTN","TIUSROI1",92,0)
 S TIUSET=TIUSET_";S:swap target document with this document"
"RTN","TIUSROI1",93,0)
 S TIUSET=TIUSET_";E:exit and do nothing"
"RTN","TIUSROI1",94,0)
 S TIUY=$$READ^TIUU("S^"_TIUSET,"Select Action","exit")
"RTN","TIUSROI1",95,0)
 Q TIUY
"RTN","TIUSROI1",96,0)
TITLE(TIUDA) ; resolve title of document
"RTN","TIUSROI1",97,0)
 Q $P($G(^TIU(8925.1,+$G(^TIU(8925,TIUDA,0)),0)),U)
"RTN","TIUSROI1",98,0)
TYPE(TIUDA) ; identifies type of document (i.e., Op Report or Proc Report)
"RTN","TIUSROI1",99,0)
 N TIUY,TIUCOR,TIUCPR S TIUY=""
"RTN","TIUSROI1",100,0)
 S TIUCOR=+$$CLASS^TIUSROI("OPERATION REPORTS")
"RTN","TIUSROI1",101,0)
 S TIUCPR=+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")
"RTN","TIUSROI1",102,0)
 I +$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),TIUCOR) S TIUY="OS" I 1
"RTN","TIUSROI1",103,0)
 E  I +$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),TIUCPR) S TIUY="PR"
"RTN","TIUSROI1",104,0)
 Q TIUY
"RTN","TIUSROI1",105,0)
TARGET(TIUCASE) ; Get report ien for case
"RTN","TIUSROI1",106,0)
 N TIUI,TIUNDA,TIUCOR,TIUCPR S (TIUI,TIUNDA)=0
"RTN","TIUSROI1",107,0)
 S TIUCOR=+$$CLASS^TIUSROI("OPERATION REPORTS")
"RTN","TIUSROI1",108,0)
 S TIUCPR=+$$CLASS^TIUSROI("PROCEDURE REPORT (NON-O.R.)")
"RTN","TIUSROI1",109,0)
 F  S TIUI=$O(^TIU(8925,"G",TIUCASE,TIUI)) Q:+TIUI'>0  D  Q:+TIUNDA
"RTN","TIUSROI1",110,0)
 . I $P($G(^TIU(8925,TIUI,0)),U,5)=15 Q
"RTN","TIUSROI1",111,0)
 . I +$$ISA^TIULX(+$G(^TIU(8925,TIUI,0)),TIUCOR) S TIUNDA=TIUI Q
"RTN","TIUSROI1",112,0)
 . I +$$ISA^TIULX(+$G(^TIU(8925,TIUI,0)),TIUCPR) S TIUNDA=TIUI
"RTN","TIUSROI1",113,0)
 Q TIUNDA
"RTN","TIUSROI1",114,0)
REPLACE(TIUDA1,TIUDA2) ; Replace TIUDA2 with TIUDA1
"RTN","TIUSROI1",115,0)
 N SRODA1,SRODA2,TIUD01,TIUD02,TIUD141,TIUD142,TIUTYPE,TIUNODEL
"RTN","TIUSROI1",116,0)
 S TIUD01=$G(^TIU(8925,TIUDA1,0)),TIUD02=$G(^TIU(8925,TIUDA2,0))
"RTN","TIUSROI1",117,0)
 I +TIUD01'=+TIUD02 D  Q
"RTN","TIUSROI1",118,0)
 . W !!,$C(7),"The two documents are of different types. No changes made.",!
"RTN","TIUSROI1",119,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",120,0)
 S TIUD141=$G(^TIU(8925,TIUDA1,14)),SRODA1=+$P(TIUD141,U,5)
"RTN","TIUSROI1",121,0)
 S TIUD142=$G(^TIU(8925,TIUDA2,14)),SRODA2=+$P(TIUD142,U,5)
"RTN","TIUSROI1",122,0)
 ; 1. Swap comments for TIUDA1 and TIUDA2
"RTN","TIUSROI1",123,0)
 D SWAPCOMM(TIUDA1,TIUDA2)
"RTN","TIUSROI1",124,0)
 ; 2. Redirect TIUDA1 to TIUDA2's surgical case
"RTN","TIUSROI1",125,0)
 D RDTIU(TIUDA1,SRODA2)
"RTN","TIUSROI1",126,0)
 ; 3. Redirect TIUDA2's surgical case to TIUDA1
"RTN","TIUSROI1",127,0)
 D RDSURG(SRODA2,TIUDA1)
"RTN","TIUSROI1",128,0)
 ; 4. Delete or Retract TIUDA2
"RTN","TIUSROI1",129,0)
 I +$P(TIUD02,U,5)<6 D DIK^TIURB2(TIUDA2,1) I 1
"RTN","TIUSROI1",130,0)
 E  S TIUNODEL=1,TIUDA2=$$RETRACT^TIURD2(TIUDA2,"",14)
"RTN","TIUSROI1",131,0)
 ; 5. Rollback SRODA1 (create new stub)
"RTN","TIUSROI1",132,0)
 S TIUTYPE=$$TYPE(TIUDA1)
"RTN","TIUSROI1",133,0)
 I TIUTYPE="OS" D OS^SROTIUD(SRODA1) I 1
"RTN","TIUSROI1",134,0)
 E  I TIUTYPE="PR" D NON^SROTIUD(SRODA1)
"RTN","TIUSROI1",135,0)
 Q
"RTN","TIUSROI1",136,0)
SWAP(TIUDA1,TIUDA2) ; Swap TIUDA1 with TIUDA2
"RTN","TIUSROI1",137,0)
 N SRODA1,SRODA2,TIUD01,TIUD02,TIUD141,TIUD142
"RTN","TIUSROI1",138,0)
 S TIUD01=$G(^TIU(8925,TIUDA1,0)),TIUD02=$G(^TIU(8925,TIUDA2,0))
"RTN","TIUSROI1",139,0)
 I +TIUD01'=+TIUD02 D  Q
"RTN","TIUSROI1",140,0)
 . W !!,$C(7),"The two documents are of different types. No changes made.",!
"RTN","TIUSROI1",141,0)
 . W:$$READ^TIUU("EA","Press RETURN to continue...") ""
"RTN","TIUSROI1",142,0)
 S TIUD141=$G(^TIU(8925,TIUDA1,14)),SRODA1=+$P(TIUD141,U,5)
"RTN","TIUSROI1",143,0)
 S TIUD142=$G(^TIU(8925,TIUDA2,14)),SRODA2=+$P(TIUD142,U,5)
"RTN","TIUSROI1",144,0)
 ; 1. Redirect TIUDA1 to TIUDA2's surgical case
"RTN","TIUSROI1",145,0)
 D RDTIU(TIUDA1,SRODA2)
"RTN","TIUSROI1",146,0)
 ; 2. Redirect TIUDA2 to TIUDA1's surgical case
"RTN","TIUSROI1",147,0)
 D RDTIU(TIUDA2,SRODA1)
"RTN","TIUSROI1",148,0)
 ; 3. Redirect TIUDA1's surgical case to TIUDA2
"RTN","TIUSROI1",149,0)
 D RDSURG(SRODA1,TIUDA2)
"RTN","TIUSROI1",150,0)
 ; 4. Redirect TIUDA2's surgical case to TIUDA1
"RTN","TIUSROI1",151,0)
 D RDSURG(SRODA2,TIUDA1)
"RTN","TIUSROI1",152,0)
 ; 5. Swap comments for TIUDA1 and TIUDA2
"RTN","TIUSROI1",153,0)
 D SWAPCOMM(TIUDA1,TIUDA2)
"RTN","TIUSROI1",154,0)
 Q
"RTN","TIUSROI1",155,0)
RDSURG(SRODA,TIUDA) ; Redirect surgical case to new document
"RTN","TIUSROI1",156,0)
 N DA,DIE,DR,TIUTYP S TIUTYP=$$TYPE(TIUDA) Q:TIUTYP']""
"RTN","TIUSROI1",157,0)
 S DIE=130,DA=SRODA,DR=$S(TIUTYP="OS":1000,TIUTYP="PR":1002,1:"")
"RTN","TIUSROI1",158,0)
 S DR=DR_"////^S X=TIUDA" D ^DIE
"RTN","TIUSROI1",159,0)
 Q
"RTN","TIUSROI1",160,0)
RDTIU(TIUDA,SRODA) ; Redirect document to new surgical case
"RTN","TIUSROI1",161,0)
 N DA,DIE,DR,SROVP S SROVP=SRODA_";SRF("
"RTN","TIUSROI1",162,0)
 S DIE=8925,DA=TIUDA,DR="1405////^S X=SROVP" D ^DIE
"RTN","TIUSROI1",163,0)
 Q
"RTN","TIUSROI1",164,0)
SWAPCOMM(TIUDA1,TIUDA2) ; Swap the comments field for two TIU Documents
"RTN","TIUSROI1",165,0)
 N DA,DIE,DR,COMM1,COMM2
"RTN","TIUSROI1",166,0)
 S COMM1=$G(^TIU(8925,TIUDA1,17)),COMM2=$G(^TIU(8925,TIUDA2,17))
"RTN","TIUSROI1",167,0)
 S DA=TIUDA1,DIE=8925,DR="1701////^S X=COMM2" D ^DIE
"RTN","TIUSROI1",168,0)
 S DA=TIUDA2,DIE=8925,DR="1701////^S X=COMM1" D ^DIE
"RTN","TIUSROI1",169,0)
 Q
"VER")
8.0^22.0
**END**
**END**
