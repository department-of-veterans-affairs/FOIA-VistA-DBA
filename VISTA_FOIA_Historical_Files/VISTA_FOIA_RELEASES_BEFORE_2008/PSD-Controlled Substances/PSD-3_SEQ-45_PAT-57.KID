Released PSD*3*57 SEQ #45
Extracted from mail message
**KIDS**:PSD*3.0*57^

**INSTALL NAME**
PSD*3.0*57
"BLD",5552,0)
PSD*3.0*57^CONTROLLED SUBSTANCES^0^3050309^y
"BLD",5552,1,0)
^^3^3^3050309^
"BLD",5552,1,1,0)
This patch will correct the problem of the Controlled
"BLD",5552,1,2,0)
Substance Nurse Shift Log not being consistant with 
"BLD",5552,1,3,0)
the Controlled Substance Inspectors Log.
"BLD",5552,4,0)
^9.64PA^^
"BLD",5552,"ABPKG")
n
"BLD",5552,"KRN",0)
^9.67PA^8989.52^19
"BLD",5552,"KRN",.4,0)
.4
"BLD",5552,"KRN",.401,0)
.401
"BLD",5552,"KRN",.402,0)
.402
"BLD",5552,"KRN",.403,0)
.403
"BLD",5552,"KRN",.5,0)
.5
"BLD",5552,"KRN",.84,0)
.84
"BLD",5552,"KRN",3.6,0)
3.6
"BLD",5552,"KRN",3.8,0)
3.8
"BLD",5552,"KRN",9.2,0)
9.2
"BLD",5552,"KRN",9.8,0)
9.8
"BLD",5552,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5552,"KRN",9.8,"NM",1,0)
PSDNSCL^^0^B14531146
"BLD",5552,"KRN",9.8,"NM","B","PSDNSCL",1)

"BLD",5552,"KRN",19,0)
19
"BLD",5552,"KRN",19.1,0)
19.1
"BLD",5552,"KRN",101,0)
101
"BLD",5552,"KRN",409.61,0)
409.61
"BLD",5552,"KRN",771,0)
771
"BLD",5552,"KRN",870,0)
870
"BLD",5552,"KRN",8989.51,0)
8989.51
"BLD",5552,"KRN",8989.52,0)
8989.52
"BLD",5552,"KRN",8994,0)
8994
"BLD",5552,"KRN","B",.4,.4)

"BLD",5552,"KRN","B",.401,.401)

"BLD",5552,"KRN","B",.402,.402)

"BLD",5552,"KRN","B",.403,.403)

"BLD",5552,"KRN","B",.5,.5)

"BLD",5552,"KRN","B",.84,.84)

"BLD",5552,"KRN","B",3.6,3.6)

"BLD",5552,"KRN","B",3.8,3.8)

"BLD",5552,"KRN","B",9.2,9.2)

"BLD",5552,"KRN","B",9.8,9.8)

"BLD",5552,"KRN","B",19,19)

"BLD",5552,"KRN","B",19.1,19.1)

"BLD",5552,"KRN","B",101,101)

"BLD",5552,"KRN","B",409.61,409.61)

"BLD",5552,"KRN","B",771,771)

"BLD",5552,"KRN","B",870,870)

"BLD",5552,"KRN","B",8989.51,8989.51)

"BLD",5552,"KRN","B",8989.52,8989.52)

"BLD",5552,"KRN","B",8994,8994)

"BLD",5552,"QUES",0)
^9.62^^
"BLD",5552,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",113,-1)
1^1
"PKG",113,0)
CONTROLLED SUBSTANCES^PSD^Controlled Substances Inventory and Tracking module.
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
3.0^2970213^2970403^24
"PKG",113,22,1,"PAH",1,0)
57^3050309
"PKG",113,22,1,"PAH",1,1,0)
^^3^3^3050309
"PKG",113,22,1,"PAH",1,1,1,0)
This patch will correct the problem of the Controlled
"PKG",113,22,1,"PAH",1,1,2,0)
Substance Nurse Shift Log not being consistant with 
"PKG",113,22,1,"PAH",1,1,3,0)
the Controlled Substance Inspectors Log.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSDNSCL")
0^1^B14531146
"RTN","PSDNSCL",1,0)
PSDNSCL ;BIR/JPW - Nurse Shift Check Log ; 2 Aug 94
"RTN","PSDNSCL",2,0)
 ;;3.0; CONTROLLED SUBSTANCES ;**57**;13 Feb 97
"RTN","PSDNSCL",3,0)
 I '$D(PSDSITE) D ^PSDSET Q:'$D(PSDSITE)
"RTN","PSDNSCL",4,0)
 S OK=$S($D(^XUSEC("PSJ RNURSE",DUZ)):1,$D(^XUSEC("PSD NURSE",DUZ)):1,1:0)
"RTN","PSDNSCL",5,0)
 ;I 'OK W $C(7),!!,?9,"** Please contact your Pharmacy Coordinator for access to",!,?12,"print this shift check log.",! K OK Q
"RTN","PSDNSCL",6,0)
ASKN ;ask naou
"RTN","PSDNSCL",7,0)
 K DA,DIC S DIC=58.8,DIC(0)="QEA",DIC("A")="Select NAOU: "
"RTN","PSDNSCL",8,0)
 S DIC("S")="I $P(^(0),""^"",3)=+PSDSITE,$S('$D(^(""I"")):1,'^(""I""):1,+^(""I"")>DT:1,1:0),$P(^(0),""^"",2)=""N"",'$P(^(0),""^"",7)"
"RTN","PSDNSCL",9,0)
 D ^DIC K DIC G:Y<0 END S NAOU=+Y,NAOUN=$P(Y,"^",2)
"RTN","PSDNSCL",10,0)
DEV ;ask device and queue info
"RTN","PSDNSCL",11,0)
 W !!,"You may queue this report to print at a later time.",!!
"RTN","PSDNSCL",12,0)
 K %ZIS,IOP,IO("Q"),POP S %ZIS="QM",%ZIS("B")="" D ^%ZIS I POP W !,"NO DEVICE SELECTED OR REPORT PRINTED!" G END
"RTN","PSDNSCL",13,0)
 I $D(IO("Q")) K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK S ZTRTN="START^PSDNSCL",ZTDESC="CS Nursing Shift Check Log",(ZTSAVE("NAOU"),ZTSAVE("NAOUN"))="" D ^%ZTLOAD,HOME^%ZIS K ZTSK G END
"RTN","PSDNSCL",14,0)
 U IO
"RTN","PSDNSCL",15,0)
START ;loops thru active orders 
"RTN","PSDNSCL",16,0)
 K ^TMP("PSDNSCL",$J) D NOW^%DTC S Y=+$E(%,1,12) X ^DD("DD") S RPDT=Y
"RTN","PSDNSCL",17,0)
 F STAT=2.99:0 S STAT=$O(^PSD(58.8,"AC",STAT)) Q:('STAT)!(STAT>5)  D LOOP
"RTN","PSDNSCL",18,0)
 S STAT=10 F PSD=0:0 S PSD=$O(^PSD(58.8,"AC",STAT,PSD)) Q:'PSD  D LOOP
"RTN","PSDNSCL",19,0)
 S STAT=13 F PSD=0:0 S PSD=$O(^PSD(58.8,"AC",STAT,PSD)) Q:'PSD  D LOOP
"RTN","PSDNSCL",20,0)
PRINT ;prints the report
"RTN","PSDNSCL",21,0)
 S (PG,PSDOUT)=0
"RTN","PSDNSCL",22,0)
 K LN S $P(LN,"-",80)="" I '$D(^TMP("PSDNSCL",$J)) D HDR W !!,?10,"****  NO ACTIVE ORDERS TO REPORT  ****",! G DONE
"RTN","PSDNSCL",23,0)
 D HDR
"RTN","PSDNSCL",24,0)
 S DRUG="" F  S DRUG=$O(^TMP("PSDNSCL",$J,DRUG)) Q:DRUG=""!(PSDOUT)  W !!,?2,"=>  ",DRUG,! S NUM="" F  S NUM=$O(^TMP("PSDNSCL",$J,DRUG,NUM)) Q:NUM=""!(PSDOUT)  D
"RTN","PSDNSCL",25,0)
 .I $Y+8>IOSL D HDR Q:PSDOUT  W !!,?2,"=>  ",DRUG,!
"RTN","PSDNSCL",26,0)
 .S NODE=^TMP("PSDNSCL",$J,DRUG,NUM) W !,NUM,?12,$P(NODE,"^",3),?34,$J($P(NODE,"^",2),6),?45,$P(NODE,"^",4),?55,$P($P(NODE,"^")," ")
"RTN","PSDNSCL",27,0)
 .W ! W:$P($G(^DPT(+$P($G(^PSD(58.81,+$O(^PSD(58.81,"D",NUM,0)),9)),U),0)),U)]"" $P($G(^(0)),U)
"RTN","PSDNSCL",28,0)
 .W ?50,$S($P(NODE,"^",5)="*":$P($P(NODE,"^")," ",2,99),1:$P($P(NODE,"^"),"-",2)),!
"RTN","PSDNSCL",29,0)
DONE I $E(IOST)'="C" W @IOF
"RTN","PSDNSCL",30,0)
 I $E(IOST,1,2)="C-",'PSDOUT W ! K DIR,DIRUT S DIR(0)="EA",DIR("A")="END OF REPORT!  Press <RET> to return to the menu" D ^DIR K DIR
"RTN","PSDNSCL",31,0)
END K %,%H,%I,%ZIS,ALL,DA,DIC,DIR,DIROUT,DIRUT,DRUG,DRUGN,DTOUT,DUOUT,LN,NAOU,NAOUN,NODE,NUM,OK,ORD
"RTN","PSDNSCL",32,0)
 K PG,POP,PSD,PSDOUT,PSDPN,PSDST,PSDT,PSDTR,QTY,REC,REQ,RPDT,RQTY,STAT,STATN,X,Y,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","PSDNSCL",33,0)
 K ^TMP("PSDNSCL",$J) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSDNSCL",34,0)
 Q
"RTN","PSDNSCL",35,0)
LOOP ;drug loop
"RTN","PSDNSCL",36,0)
 F DRUG=0:0 S DRUG=$O(^PSD(58.8,"AC",STAT,NAOU,DRUG)) Q:'DRUG  F ORD=0:0 S ORD=$O(^PSD(58.8,"AC",STAT,NAOU,DRUG,ORD)) Q:'ORD  D
"RTN","PSDNSCL",37,0)
 .Q:'$D(^PSD(58.8,NAOU,1,DRUG,3,ORD,0))  S NODE=^(0),DRUGN=$S($P($G(^PSDRUG(DRUG,0)),"^")]"":$P(^(0),"^"),1:"DRUG NAME MISSING")
"RTN","PSDNSCL",38,0)
 .S PSDTR=$P(NODE,"^",17) I STAT=10 Q:$D(^PSD(58.81,"AE",PSDTR))
"RTN","PSDNSCL",39,0)
 .S STATN=$P($G(^PSD(58.82,STAT,0)),"^"),RQTY=$P(NODE,"^",20),PSDPN=$S($P(NODE,"^",16)]"":$P(NODE,"^",16),1:"UNKNOWN")
"RTN","PSDNSCL",40,0)
 .S REQ=$P(NODE,"^",15) I REQ S Y=REQ X ^DD("DD") S REQ=Y
"RTN","PSDNSCL",41,0)
 .S REC=$P(NODE,"^",7),REC=$P($G(^VA(200,+REC,0)),"^"),REC=$E($P(REC,",",2))_$E(REC)
"RTN","PSDNSCL",42,0)
 .S ^TMP("PSDNSCL",$J,DRUGN,PSDPN)=STATN_"^"_RQTY_"^"_REQ_"^"_REC_"^"_$S(STAT=10:"*",1:"")
"RTN","PSDNSCL",43,0)
 Q
"RTN","PSDNSCL",44,0)
HDR ;header for log
"RTN","PSDNSCL",45,0)
 I $E(IOST,1,2)="C-",PG W ! K DA,DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSDOUT=1 Q
"RTN","PSDNSCL",46,0)
 S PG=PG+1 W:$Y @IOF W !,?15,"Nursing Shift Check Log for ",NAOUN,?70,"Page: ",PG,!,?20,RPDT,!
"RTN","PSDNSCL",47,0)
 W !,?2,"=> DRUG",!,?18,"DATE",?44,"RECD"
"RTN","PSDNSCL",48,0)
 W !,"DISP #",?18,"RECD",?37,"QTY",?45,"BY",?54,"ORDER STATUS"
"RTN","PSDNSCL",49,0)
 W !,LN,!
"RTN","PSDNSCL",50,0)
 Q
"VER")
8.0^22
"BLD",5552,6)
^SEQ #45
**END**
**END**
