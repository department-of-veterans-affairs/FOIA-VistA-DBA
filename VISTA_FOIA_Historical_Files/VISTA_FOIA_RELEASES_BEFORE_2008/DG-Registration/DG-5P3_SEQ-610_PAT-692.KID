Released DG*5.3*692 SEQ #610
Extracted from mail message
**KIDS**:DG*5.3*692^

**INSTALL NAME**
DG*5.3*692
"BLD",6541,0)
DG*5.3*692^REGISTRATION^0^3060327^y
"BLD",6541,4,0)
^9.64PA^^
"BLD",6541,"ABPKG")
n
"BLD",6541,"KRN",0)
^9.67PA^8989.52^19
"BLD",6541,"KRN",.4,0)
.4
"BLD",6541,"KRN",.401,0)
.401
"BLD",6541,"KRN",.402,0)
.402
"BLD",6541,"KRN",.403,0)
.403
"BLD",6541,"KRN",.5,0)
.5
"BLD",6541,"KRN",.84,0)
.84
"BLD",6541,"KRN",3.6,0)
3.6
"BLD",6541,"KRN",3.8,0)
3.8
"BLD",6541,"KRN",9.2,0)
9.2
"BLD",6541,"KRN",9.8,0)
9.8
"BLD",6541,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6541,"KRN",9.8,"NM",1,0)
VAFHADT2^^0^B11284459
"BLD",6541,"KRN",9.8,"NM",2,0)
VAFHLPV2^^0^B3525498
"BLD",6541,"KRN",9.8,"NM",3,0)
DGPMV3^^0^B22721413
"BLD",6541,"KRN",9.8,"NM",4,0)
VAFCADT2^^0^B26214011
"BLD",6541,"KRN",9.8,"NM","B","DGPMV3",3)

"BLD",6541,"KRN",9.8,"NM","B","VAFCADT2",4)

"BLD",6541,"KRN",9.8,"NM","B","VAFHADT2",1)

"BLD",6541,"KRN",9.8,"NM","B","VAFHLPV2",2)

"BLD",6541,"KRN",19,0)
19
"BLD",6541,"KRN",19.1,0)
19.1
"BLD",6541,"KRN",101,0)
101
"BLD",6541,"KRN",409.61,0)
409.61
"BLD",6541,"KRN",771,0)
771
"BLD",6541,"KRN",870,0)
870
"BLD",6541,"KRN",8989.51,0)
8989.51
"BLD",6541,"KRN",8989.51,"NM",0)
^9.68A^3^1
"BLD",6541,"KRN",8989.51,"NM",3,0)
DG PT DIRECTORY CALL CENTER^^0
"BLD",6541,"KRN",8989.51,"NM","B","DG PT DIRECTORY CALL CENTER",3)

"BLD",6541,"KRN",8989.52,0)
8989.52
"BLD",6541,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",6541,"KRN",8994,0)
8994
"BLD",6541,"KRN","B",.4,.4)

"BLD",6541,"KRN","B",.401,.401)

"BLD",6541,"KRN","B",.402,.402)

"BLD",6541,"KRN","B",.403,.403)

"BLD",6541,"KRN","B",.5,.5)

"BLD",6541,"KRN","B",.84,.84)

"BLD",6541,"KRN","B",3.6,3.6)

"BLD",6541,"KRN","B",3.8,3.8)

"BLD",6541,"KRN","B",9.2,9.2)

"BLD",6541,"KRN","B",9.8,9.8)

"BLD",6541,"KRN","B",19,19)

"BLD",6541,"KRN","B",19.1,19.1)

"BLD",6541,"KRN","B",101,101)

"BLD",6541,"KRN","B",409.61,409.61)

"BLD",6541,"KRN","B",771,771)

"BLD",6541,"KRN","B",870,870)

"BLD",6541,"KRN","B",8989.51,8989.51)

"BLD",6541,"KRN","B",8989.52,8989.52)

"BLD",6541,"KRN","B",8994,8994)

"BLD",6541,"QUES",0)
^9.62^^
"BLD",6541,"REQB",0)
^9.611^4^4
"BLD",6541,"REQB",1,0)
DG*5.3*91^2
"BLD",6541,"REQB",2,0)
DG*5.3*95^2
"BLD",6541,"REQB",3,0)
DG*5.3*190^2
"BLD",6541,"REQB",4,0)
DG*5.3*508^2
"BLD",6541,"REQB","B","DG*5.3*190",3)

"BLD",6541,"REQB","B","DG*5.3*508",4)

"BLD",6541,"REQB","B","DG*5.3*91",1)

"BLD",6541,"REQB","B","DG*5.3*95",2)

"KRN",8989.51,387,-1)
0^3
"KRN",8989.51,387,0)
DG PT DIRECTORY CALL CENTER^Enable Patient Directory Call Center^0^^ENABLE PATIENT DIRECTORY CALL CENTER
"KRN",8989.51,387,1)
N^0:1^to enable the parameter set it to 1, otherwise set it to 0 or leave it blank.
"KRN",8989.51,387,20,0)
^8989.512^6^6^3060214^^^^
"KRN",8989.51,387,20,1,0)
Enabling this parameter will allow for the transmission of the privacy 
"KRN",8989.51,387,20,2,0)
indicator to be included in HL7 messages generated by the Registration 
"KRN",8989.51,387,20,3,0)
application in the PV2 segment. The privacy indicator allows patient to 
"KRN",8989.51,387,20,4,0)
opt-out form being listed from facility directories. By including this 
"KRN",8989.51,387,20,5,0)
information in the HL7 message the information can be communicated to COTS
"KRN",8989.51,387,20,6,0)
applications doing patient directories.
"KRN",8989.51,387,30,0)
^8989.513I^1^1
"KRN",8989.51,387,30,1,0)
1^4.2
"MBREQ")
0
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
692^3060327
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGPMV3")
0^3^B22721413^B22090490
"RTN","DGPMV3",1,0)
DGPMV3 ;ALB/MIR - ENTER TRANSACTION INFORMATION; 8 MAY 89 ; 2/15/06 7:23am
"RTN","DGPMV3",2,0)
 ;;5.3;Registration;**34,54,62,95,692**;Aug 13, 1993
"RTN","DGPMV3",3,0)
 K ^UTILITY("DGPM",$J)
"RTN","DGPMV3",4,0)
 D NOW^%DTC S DGNOW=%,DGPMHY=DGPMY,DGPMOUT=0 G:'DGPMN DT S X=DGPMY
"RTN","DGPMV3",5,0)
 S DGPM0ND=DGPMY_"^"_DGPMT_"^"_DFN_"^^^^^^^^^^^"_$S("^1^4^"[("^"_DGPMT_"^"):"",1:DGPMCA)
"RTN","DGPMV3",6,0)
 ;
"RTN","DGPMV3",7,0)
 I DGPMT=1 S $P(DGPM0ND,"^",25)=$S(DGPMSA:1,1:0)
"RTN","DGPMV3",8,0)
 ;-- provider change
"RTN","DGPMV3",9,0)
 I DGPMT=6,$D(DGPMPC) S DGPM0ND=$$PRODAT(DGPM0ND)
"RTN","DGPMV3",10,0)
 D NEW G Q:Y'>0 S (DA,DGPMDA)=+Y
"RTN","DGPMV3",11,0)
 S:DGPMT=1!(DGPMT=4) DGPMCA=DA,DGPMAN=^DGPM(DA,0) D VAR G DR
"RTN","DGPMV3",12,0)
DT D VAR G:DGPM1X DR S (DGPMY,Y)=DGPMHY X ^DD("DD") W !,DGPMUC," DATE: ",Y,"// " R X:DTIME G Q:'$T!(X["^") I X="" G DR
"RTN","DGPMV3",13,0)
 S %DT="SRXE",%DT(0)="-NOW" I X["?"!(Y<0) D HELP^%DTC G DT
"RTN","DGPMV3",14,0)
 I X="@" G OKD
"RTN","DGPMV3",15,0)
 D ^%DT I Y<0 D HELP^%DTC G DT
"RTN","DGPMV3",16,0)
 K %DT S DGPMY=Y D CHK^DGPMV30:(X]"")&(DGPMY'=+DGPMP) I $D(DGPME) S DGPMY=DGPMHY W !,DGPME K DGPME G DT
"RTN","DGPMV3",17,0)
DR ;select input template for transaction type
"RTN","DGPMV3",18,0)
 S DIE="^DGPM(" I "^1^4^6^"[("^"_DGPMT_"^"),DGPMN S DIE("NO^")=""
"RTN","DGPMV3",19,0)
 S DGODSPT=$S('$D(^DGPM(DGPMCA,"ODS")):0,^("ODS"):1,1:0)
"RTN","DGPMV3",20,0)
 S DR=$S(DGPMT=1:"[DGPM ADMIT]",DGPMT=2:"[DGPM TRANSFER]",DGPMT=3:"[DGPM DISCHARGE]",DGPMT=4:"[DGPM CHECK-IN LODGER]",DGPMT=5:"[DGPM LODGER CHECK-OUT]",DGPMT=6:"[DGPM SPECIALTY TRANSFER]",1:"") G Q:DR="" K DQ,DG D ^DIE K DIE
"RTN","DGPMV3",21,0)
 I $D(Y)#2 S DGPMOUT=1
"RTN","DGPMV3",22,0)
 ;Modified in patch dg*5.3*692 to include privacy indicator node "DIR"
"RTN","DGPMV3",23,0)
 K DGZ S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$S($D(^DGPM(DGPMDA,0)):^(0)_U_$G(^("DIR")),1:"")
"RTN","DGPMV3",24,0)
 D:DGPMT'=4 @("^DGPMV3"_DGPMT)
"RTN","DGPMV3",25,0)
 I DGPMT=4,$S('$D(^DGPM(DGPMDA,"LD")):1,'$P(^("LD"),"^",1):1,1:0) S DIK="^DGPM(",DA=DGPMDA W !,"Incomplete check-in...deleted" D ^DIK K DIK S DGPMA=""
"RTN","DGPMV3",26,0)
 S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$G(^DGPM(DGPMDA,0))_U_$G(^("DIR")) I DGPMT=6 S Y=DGPMDA D AFTER^DGPMV36
"RTN","DGPMV3",27,0)
EVENTS ;
"RTN","DGPMV3",28,0)
 I DGPMT=4!(DGPMT=5) D RESET^DGPMDDLD
"RTN","DGPMV3",29,0)
 I DGPMT'=4&(DGPMT'=5) D RESET^DGPMDDCN I (DGPMT'=6) D SI^DGPMV33
"RTN","DGPMV3",30,0)
 D:DGPMA]"" START^DGPWB(DFN)
"RTN","DGPMV3",31,0)
 D EN^DGPMVBM ;notify building management if room-bed change
"RTN","DGPMV3",32,0)
 S DGOK=0 F I=0:0 S I=$O(^UTILITY("DGPM",$J,I)) Q:'I  F J=0:0 S J=$O(^UTILITY("DGPM",$J,I,J)) Q:'J  I ^(J,"A")'=^("P") S DGOK=1 Q
"RTN","DGPMV3",33,0)
 I DGOK D ^DGPMEVT ;Invoke Movement Event Driver
"RTN","DGPMV3",34,0)
Q S:$D(DGPMBYP) DGPMBYP=DGPMDA
"RTN","DGPMV3",35,0)
 K DGIDX,DGOWD,DGOTY ;variables set in DGPMGLC - G&L corrections
"RTN","DGPMV3",36,0)
 K DGODS,DGODSPT ;ods variables
"RTN","DGPMV3",37,0)
 K %DT,DA,DGER,DGNOW,DGOK,DGPM0,DGPM0ND,DGPM2,DGPMA,DGPMAB,DGPMABL,DGPMDA,DGPMER,DGPMHY,DGPMNI,DGPMOC,DGPMOS,DGPMOUT,DGPMP,DGPMPHY,DGPMPHY0,DGPMPTF,DGPMSP,DGPMTYP,DGPMTN,DGPMWD,DGT,DGSV,DGX,DGX1
"RTN","DGPMV3",38,0)
 K DIC,DIE,DIK,DR,I,I1,J,K,X,X1,X2,Y,^UTILITY("DGPM",$J) Q
"RTN","DGPMV3",39,0)
 ;
"RTN","DGPMV3",40,0)
OKD K %DT W ! S DGPMER=0,(^UTILITY("DGPM",$J,DGPMT,DGPMDA,"P"),DGPMP)=^DGPM(DGPMDA,0),Y=DGPMDA D:DGPMT=6 PRIOR^DGPMV36 D @("D"_DGPMT_"^DGPMVDL"_$S(DGPMT>2:1,1:"")) G Q:DGPMER
"RTN","DGPMV3",41,0)
 W !,"Are you sure you want to delete this movement" S %=2 D YN^DICN G Q:%<0,DT:%=2 I '% W !?5,"Answer yes to delete this ",DGPMUC," or no to continue" G OKD
"RTN","DGPMV3",42,0)
 D @(DGPMT_"^DGPMVDL"_$S(DGPMT>2:1,1:""))
"RTN","DGPMV3",43,0)
 I DGPMT'=3,(DGPMT'=5) S DIK="^DGPM(",DA=DGPMDA D ^DIK:DGPMDA
"RTN","DGPMV3",44,0)
 S (^UTILITY("DGPM",$J,DGPMT,DGPMDA,"A"),DGPMA)=$S($P(DGPMP,"^",18)'=47:"",1:^DGPM(+DGPMDA,0)) I DGPMT=6 S Y=DGPMDA D AFTER^DGPMV36
"RTN","DGPMV3",45,0)
 I DGPMDA,$O(^DGPM("APHY",DGPMDA,0)) S DIK="^DGPM(",DA=+$O(^(0)) I $D(^DGPM(+DA,0)) S ^UTILITY("DGPM",$J,6,DA,"P")=^(0),^("A")="",Y=DA D PRIOR^DGPMV36,^DIK S Y=DA D AFTER^DGPMV36
"RTN","DGPMV3",46,0)
 G EVENTS
"RTN","DGPMV3",47,0)
VAR ;Set up variables
"RTN","DGPMV3",48,0)
 ;Modified in patch dg*5.3*692 to include privacy indicator node "DIR"
"RTN","DGPMV3",49,0)
 S DA=DGPMDA,(^UTILITY("DGPM",$J,DGPMT,DGPMDA,"P"),DGPMP)=$S(DGPMN=1:"",1:$G(^DGPM(DA,0))_U_$G(^("DIR"))) ;DGPMP=Before edit
"RTN","DGPMV3",50,0)
 I DGPMT=6 S Y=DGPMDA D PRIOR^DGPMV36
"RTN","DGPMV3",51,0)
 S DGX=DGPMY+($P(DGPMP,"^",22)/10000000)
"RTN","DGPMV3",52,0)
 S X=$O(^DGPM("APMV",DFN,DGPMCA,(9999999.9999999-DGX))),X1=$O(^DGPM("APMV",DFN,DGPMCA,+X,0)) S DGPM0=$S($D(^DGPM(+X1,0)):^(0),1:"") ;DGPM0=prior movement
"RTN","DGPMV3",53,0)
 S X=$O(^DGPM("APCA",DFN,DGPMCA,+DGX)),X=$O(^(+X,0)),DGPM2=$S($D(^DGPM(+X,0)):^(0),1:"") ;DGPM2=next movement
"RTN","DGPMV3",54,0)
 S DGPMABL=0 I DGPM2,$D(^DG(405.2,+$P(DGPM2,"^",18),"E")) S DGPMABL=+^("E") ;is the next movement an absence?
"RTN","DGPMV3",55,0)
 I DGPMT=6 S Y=DGPMDA D PRIOR^DGPMV36
"RTN","DGPMV3",56,0)
 Q
"RTN","DGPMV3",57,0)
NEW ;Entry point to add a new entry to ^DGPM
"RTN","DGPMV3",58,0)
 D NEW^DGPMV301 ; continuation of routine DGPMV3 in DGPMV301
"RTN","DGPMV3",59,0)
 Q
"RTN","DGPMV3",60,0)
 ;
"RTN","DGPMV3",61,0)
PRODAT(NODE) ;-- This function will add the ward and other data from the
"RTN","DGPMV3",62,0)
 ; previous TS movement to the provider TS movement.
"RTN","DGPMV3",63,0)
 ;
"RTN","DGPMV3",64,0)
 N X,Y
"RTN","DGPMV3",65,0)
 S Y=NODE,X=$O(^DGPM("ATS",DFN,DGPMCA,9999999.9999999-$P(NODE,U))) I X S X=$O(^(X,0)) I X S X=$O(^(X,0)) I X S X=^DGPM(X,0)
"RTN","DGPMV3",66,0)
 S $P(Y,U,4)=$P(X,U,4),$P(Y,U,9)=$P(X,U,9)
"RTN","DGPMV3",67,0)
 Q Y
"RTN","DGPMV3",68,0)
 ;
"RTN","VAFCADT2")
0^4^B26214011^B24728932
"RTN","VAFCADT2",1,0)
VAFCADT2 ;ALB/RJS - HL7 ADT MESSAGE BUILDING ROUTINE ; 3/6/06 8:24am
"RTN","VAFCADT2",2,0)
 ;;5.3;Registration;**91,179,209,415,494,484,508,692**;Aug 13, 1993
"RTN","VAFCADT2",3,0)
 ;hl7v1.6
"RTN","VAFCADT2",4,0)
 ;
"RTN","VAFCADT2",5,0)
 ;This routine builds ADT HL7 messages: A01 = Admission
"RTN","VAFCADT2",6,0)
 ;                                      A02 = Transfer
"RTN","VAFCADT2",7,0)
 ;                                      A03 = Discharge
"RTN","VAFCADT2",8,0)
 ;                                      A08 = Treating Specialty Update
"RTN","VAFCADT2",9,0)
 ;                                      A11 = Cancel Admission
"RTN","VAFCADT2",10,0)
 ;                                      A12 = Cancel Transfer
"RTN","VAFCADT2",11,0)
 ;                                      A13 = Cancel Discharge
"RTN","VAFCADT2",12,0)
 ;
"RTN","VAFCADT2",13,0)
 ;It is called by VAFCADT1, which is itself is called by the
"RTN","VAFCADT2",14,0)
 ;DGPM patient movement event driver.
"RTN","VAFCADT2",15,0)
 ;
"RTN","VAFCADT2",16,0)
 ;
"RTN","VAFCADT2",17,0)
BLDMSG(DFN,EVENT,VAFHDT,EVCODE,IEN,PIVOT,PV1) ;
"RTN","VAFCADT2",18,0)
 ;Required Variables are:   DFN = IEN of Patient File
"RTN","VAFCADT2",19,0)
 ;                        EVENT = HL7 Event, A01, A02, A03, etc.
"RTN","VAFCADT2",20,0)
 ;                       VAFHDT = Date/Time of Admission, Transfer, etc
"RTN","VAFCADT2",21,0)
 ;
"RTN","VAFCADT2",22,0)
 ;Optional Variables are: Event Code = (EVCODE):A string literal which is
"RTN","VAFCADT2",23,0)
 ;                                     inserted in the Event Reason
"RTN","VAFCADT2",24,0)
 ;                                     Code Field of the EVN segment
"RTN","VAFCADT2",25,0)
 ;                                     of the message. This serves to
"RTN","VAFCADT2",26,0)
 ;                                     indicate that the message might
"RTN","VAFCADT2",27,0)
 ;                                     need to be processed in a special
"RTN","VAFCADT2",28,0)
 ;                                     way. PIMS ADT software uses the
"RTN","VAFCADT2",29,0)
 ;                                     Event Code to indicate whether
"RTN","VAFCADT2",30,0)
 ;                                     the message is the most recent
"RTN","VAFCADT2",31,0)
 ;                                     "Snapshot" of the data "05" or
"RTN","VAFCADT2",32,0)
 ;                                     a "Snapshot" of data that is
"RTN","VAFCADT2",33,0)
 ;                                     followed by more recent data "04"
"RTN","VAFCADT2",34,0)
 ;
"RTN","VAFCADT2",35,0)
 ;                         
"RTN","VAFCADT2",36,0)
 ;                               IEN = The IEN of the Patient Movement
"RTN","VAFCADT2",37,0)
 ;                                     that the HL7 message is being
"RTN","VAFCADT2",38,0)
 ;                                     built from. This is especially
"RTN","VAFCADT2",39,0)
 ;                                     useful for Discharge Movements
"RTN","VAFCADT2",40,0)
 ;                                     where date/time (VAFHDT) is not
"RTN","VAFCADT2",41,0)
 ;                                     enough information to retrieve
"RTN","VAFCADT2",42,0)
 ;                                     the movement
"RTN","VAFCADT2",43,0)
 ;
"RTN","VAFCADT2",44,0)
 ;                             PIVOT = The PIMS Pivot number that
"RTN","VAFCADT2",45,0)
 ;                                     uniquely identifies the ADMISSION
"RTN","VAFCADT2",46,0)
 ;
"RTN","VAFCADT2",47,0)
 ;                               PV1 = In the case of a "Deleted
"RTN","VAFCADT2",48,0)
 ;                                     Admission" the record in the 
"RTN","VAFCADT2",49,0)
 ;                                     Patient Movement File has already
"RTN","VAFCADT2",50,0)
 ;                                     been deleted. But, a PV1 segment
"RTN","VAFCADT2",51,0)
 ;                                     can be built from the DGPMP
"RTN","VAFCADT2",52,0)
 ;                                     variable that has been saved off
"RTN","VAFCADT2",53,0)
 ;                                     by the DGPM Event Driver. This
"RTN","VAFCADT2",54,0)
 ;                                     PV1 segment is passed a string
"RTN","VAFCADT2",55,0)
 ;                                     literal that is built by a call
"RTN","VAFCADT2",56,0)
 ;                                     to DGBUILD^VAFHAPV1 previous to 
"RTN","VAFCADT2",57,0)
 ;                                     calling this software.
"RTN","VAFCADT2",58,0)
 ;
"RTN","VAFCADT2",59,0)
 K HLA N VAFDIAG,LIN,VAFSTR,DGREL,DGINC,DGINR,DGDEP,VAFZEL
"RTN","VAFCADT2",60,0)
 ;Q:($G(EVCODE)'="05")
"RTN","VAFCADT2",61,0)
 ;
"RTN","VAFCADT2",62,0)
 K HL
"RTN","VAFCADT2",63,0)
 I EVENT="A08" D INIT^HLFNC2("VAFC ADT-A08-TSP SERVER",.HL)
"RTN","VAFCADT2",64,0)
 I EVENT'="A08" D INIT^HLFNC2("VAFC ADT-"_EVENT_" SERVER",.HL)
"RTN","VAFCADT2",65,0)
 I $D(HL)#2 G EXIT
"RTN","VAFCADT2",66,0)
 S LIN=1
"RTN","VAFCADT2",67,0)
 S VAFSTR=$$COMMANUM^VAFCADT2(2,9)_",10B,11PC,"_$$COMMANUM^VAFCADT2(13,21)_",22B,"_$$COMMANUM^VAFCADT2(23,30)
"RTN","VAFCADT2",68,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFCPID(DFN,VAFSTR)
"RTN","VAFCADT2",69,0)
 I +HLA("HLS",LIN)=-1 K HLA("HLS",2) G EXIT
"RTN","VAFCADT2",70,0)
 ;I $G(VAFPID(1))]"" S HLA("HLS",LIN,1)=VAFPID(1)
"RTN","VAFCADT2",71,0)
 ;I $G(VAFPID(2))]"" S HLA("HLS",LIN,2)=VAFPID(2)
"RTN","VAFCADT2",72,0)
 MERGE HLA("HLS",LIN)=VAFPID K VAFPID
"RTN","VAFCADT2",73,0)
 S $P(HLA("HLS",LIN),HLFS,2)=1 ;SET ID
"RTN","VAFCADT2",74,0)
 S VAFSTR=$$COMMANUM(1,12)
"RTN","VAFCADT2",75,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLPD1(DFN,VAFSTR)
"RTN","VAFCADT2",76,0)
 S VAFSTR=$$COMMANUM(1,21)
"RTN","VAFCADT2",77,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLZPD(DFN,VAFSTR)
"RTN","VAFCADT2",78,0)
 S $P(HLA("HLS",LIN),HLFS,2)=1 ;SET ID
"RTN","VAFCADT2",79,0)
 I EVENT="A11" D  G NEXT
"RTN","VAFCADT2",80,0)
 . S HLA("HLS",$$ADD(.LIN,1))=PV1
"RTN","VAFCADT2",81,0)
 . S $P(HLA("HLS",LIN),HLFS,51)=$G(PIVOT) ;              VISIT&SET ID'S
"RTN","VAFCADT2",82,0)
 I EVENT="A01"!(EVENT="A03")!(EVENT="A08")!(EVENT="A12")!(EVENT="A13") D  G NEXT
"RTN","VAFCADT2",83,0)
 . S VAFSTR=$$COMMANUM(2,5)_","_$$COMMANUM(7,45)
"RTN","VAFCADT2",84,0)
 . S HLA("HLS",$$ADD(.LIN,1))=$$IN^VAFHLPV1(DFN,VAFHDT,VAFSTR,$G(IEN),PIVOT,"",.VAFDIAG)
"RTN","VAFCADT2",85,0)
 I EVENT="A02" D  G NEXT
"RTN","VAFCADT2",86,0)
 . S VAFSTR=$$COMMANUM(2,45)
"RTN","VAFCADT2",87,0)
 . S HLA("HLS",$$ADD(.LIN,1))=$$IN^VAFHLPV1(DFN,VAFHDT,VAFSTR,$G(IEN),PIVOT,"",.VAFDIAG)
"RTN","VAFCADT2",88,0)
 G EXIT
"RTN","VAFCADT2",89,0)
NEXT ;
"RTN","VAFCADT2",90,0)
 S $P(HLA("HLS",LIN),HLFS,2)=1 ;PV1 SET ID
"RTN","VAFCADT2",91,0)
 S HLA("HLS",1)="EVN"_HLFS_EVENT_HLFS_$$HLDATE^HLFNC(VAFHDT,"TS")_HLFS
"RTN","VAFCADT2",92,0)
 S HLA("HLS",1)=HLA("HLS",1)_HLFS_$G(EVCODE) ;,1
"RTN","VAFCADT2",93,0)
 ;Get patient directory call center parameter
"RTN","VAFCADT2",94,0)
 N VAFCCON
"RTN","VAFCADT2",95,0)
 S VAFCCON=$$GET^XPAR("SYS","DG PT DIRECTORY CALL CENTER")
"RTN","VAFCADT2",96,0)
 I VAFCCON S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLPV2(DFN,IEN,",22,")
"RTN","VAFCADT2",97,0)
 S VAFSTR=$$COMMANUM(1,4)
"RTN","VAFCADT2",98,0)
 N HLAROL
"RTN","VAFCADT2",99,0)
 D BLDROL^VAFCROL("HLAROL",DFN,VAFHDT,VAFSTR,$G(PIVOT),$G(IEN))
"RTN","VAFCADT2",100,0)
 N I,J,K
"RTN","VAFCADT2",101,0)
 S I=""
"RTN","VAFCADT2",102,0)
 F K=1:1 S I=+$O(HLAROL(I)) Q:('I)  D
"RTN","VAFCADT2",103,0)
 . S J=""
"RTN","VAFCADT2",104,0)
 . F  S J=$O(HLAROL(I,J)) Q:(J="")  D
"RTN","VAFCADT2",105,0)
 . . S:('J) HLA("HLS",LIN+K)=HLAROL(I,J)
"RTN","VAFCADT2",106,0)
 . . S:(J) HLA("HLS",LIN+K,J)=HLAROL(I,J)
"RTN","VAFCADT2",107,0)
 S LIN=LIN+K-1
"RTN","VAFCADT2",108,0)
 I (EVENT="A01")!(EVENT="A08")!(EVENT="A11")!(EVENT="A12")!(EVENT="A13") DO
"RTN","VAFCADT2",109,0)
 . S HLA("HLS",$$ADD(.LIN,1))="DG1"_HLFS_1_HLFS_HLFS_HLFS_$$HLQ^VAFHUTL($G(VAFDIAG))
"RTN","VAFCADT2",110,0)
 S VAFSTR=$$COMMANUM(1,5)
"RTN","VAFCADT2",111,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLZSP(DFN,1,1)
"RTN","VAFCADT2",112,0)
 S VAFSTR=$$COMMANUM(1,22)
"RTN","VAFCADT2",113,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLZEL(DFN,VAFSTR,2)
"RTN","VAFCADT2",114,0)
 S VAFSTR=$$COMMANUM(1,9)
"RTN","VAFCADT2",115,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLZCT(DFN,VAFSTR,1)
"RTN","VAFCADT2",116,0)
 S VAFSTR=$$COMMANUM(1,8)
"RTN","VAFCADT2",117,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLZEM(DFN,VAFSTR,1,1)
"RTN","VAFCADT2",118,0)
 D ALL^DGMTU21(DFN,"V",VAFHDT,"R")
"RTN","VAFCADT2",119,0)
 S VAFSTR=$$COMMANUM(1,13)
"RTN","VAFCADT2",120,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLZIR(+$G(DGINR("V")),VAFSTR,1)
"RTN","VAFCADT2",121,0)
 S VAFSTR=$$COMMANUM(1,10)
"RTN","VAFCADT2",122,0)
 S HLA("HLS",$$ADD(.LIN,1))=$$EN^VAFHLZEN(DFN,VAFSTR,1,HL("Q"),HL("FS"))
"RTN","VAFCADT2",123,0)
 D:$D(VATRACE) LOOP
"RTN","VAFCADT2",124,0)
 ;
"RTN","VAFCADT2",125,0)
 S COUNTER=""
"RTN","VAFCADT2",126,0)
 F  S COUNTER=$O(HLA("HLS",COUNTER)) Q:COUNTER'>0  D
"RTN","VAFCADT2",127,0)
 .; I +(HLA("HLS",COUNTER))=-1 S HLERR="Bad "_COUNTER_" Segment"
"RTN","VAFCADT2",128,0)
 .  I +(HLA("HLS",COUNTER))=-1 S HL="Bad "_COUNTER_" Segment"
"RTN","VAFCADT2",129,0)
 .
"RTN","VAFCADT2",130,0)
 ;
"RTN","VAFCADT2",131,0)
EXIT ;
"RTN","VAFCADT2",132,0)
 ;I $D(HL)=1 DO
"RTN","VAFCADT2",133,0)
 ;.  S HLERR(1)=HL
"RTN","VAFCADT2",134,0)
 ;.  D EBULL^VAFHUTL2(DFN,VAFHDT,PIVOT,"HLERR(")
"RTN","VAFCADT2",135,0)
 I $D(HL)>1,$D(HLA("HLS")) DO
"RTN","VAFCADT2",136,0)
 . I EVENT="A08" DO
"RTN","VAFCADT2",137,0)
 .  . D GENERATE^HLMA("VAFC ADT-A08-TSP SERVER","LM",1,.HLRST,"")
"RTN","VAFCADT2",138,0)
 . E  D GENERATE^HLMA("VAFC ADT-"_EVENT_" SERVER","LM",1,.HLRST,"")
"RTN","VAFCADT2",139,0)
 .
"RTN","VAFCADT2",140,0)
 D KVAR^VADPT,KVAR^VAFHLPV1 K HLA,HLERR
"RTN","VAFCADT2",141,0)
 Q
"RTN","VAFCADT2",142,0)
LOOP ;
"RTN","VAFCADT2",143,0)
 ;
"RTN","VAFCADT2",144,0)
 ;
"RTN","VAFCADT2",145,0)
 W !!
"RTN","VAFCADT2",146,0)
 N XX S XX=0
"RTN","VAFCADT2",147,0)
 F  S XX=$O(HLA("HLS",XX)) Q:XX=""  W !,HLA("HLS",XX)
"RTN","VAFCADT2",148,0)
 Q
"RTN","VAFCADT2",149,0)
 ;
"RTN","VAFCADT2",150,0)
COMMANUM(FROM,TO) ;Build comma separated list of numbers
"RTN","VAFCADT2",151,0)
 ;Input  : FROM - Starting number (default = 1)
"RTN","VAFCADT2",152,0)
 ;         TO - Ending number (default = FROM)
"RTN","VAFCADT2",153,0)
 ;Output : Comma separated list of numbers between FROM and TO
"RTN","VAFCADT2",154,0)
 ;         (Ex: 1,2,3)
"RTN","VAFCADT2",155,0)
 ;Notes  : Call assumes FROM <= TO
"RTN","VAFCADT2",156,0)
 ;
"RTN","VAFCADT2",157,0)
 S FROM=$G(FROM) S:(FROM="") FROM=1
"RTN","VAFCADT2",158,0)
 S TO=$G(TO) S:(TO="") TO=FROM
"RTN","VAFCADT2",159,0)
 N OUTPUT,X
"RTN","VAFCADT2",160,0)
 S OUTPUT=FROM
"RTN","VAFCADT2",161,0)
 F X=(FROM+1):1:TO S OUTPUT=(OUTPUT_","_X)
"RTN","VAFCADT2",162,0)
 Q OUTPUT
"RTN","VAFCADT2",163,0)
 ;
"RTN","VAFCADT2",164,0)
ADD(LINE,COUNTER) ;Increments Line = Line + Counter
"RTN","VAFCADT2",165,0)
 ;Input      :  LINE      - Line number
"RTN","VAFCADT2",166,0)
 ;              COUNTER   - Increment number
"RTN","VAFCADT2",167,0)
 ;Output     :  Updated LINE value
"RTN","VAFCADT2",168,0)
 ;
"RTN","VAFCADT2",169,0)
 S LINE=$G(LINE),COUNTER=$G(COUNTER)
"RTN","VAFCADT2",170,0)
 S LINE=LINE+COUNTER
"RTN","VAFCADT2",171,0)
 Q LINE
"RTN","VAFHADT2")
0^1^B11284459^B10292370
"RTN","VAFHADT2",1,0)
VAFHADT2 ;ALB/RJS - HL7 ADT MESSAGE BUILDING ROUTINE - MAY 18,1995 ; 3/6/06 8:08am
"RTN","VAFHADT2",2,0)
 ;;5.3;Registration;**91,692**;Jun 06, 1996
"RTN","VAFHADT2",3,0)
 ;hl7v1.6
"RTN","VAFHADT2",4,0)
 ;
"RTN","VAFHADT2",5,0)
 ;This routine builds ADT HL7 messages: A01 = Admission
"RTN","VAFHADT2",6,0)
 ;                                      A02 = Transfer
"RTN","VAFHADT2",7,0)
 ;                                      A03 = Discharge
"RTN","VAFHADT2",8,0)
 ;                                      A08 = Update
"RTN","VAFHADT2",9,0)
 ;                                      A11 = Cancel Admission
"RTN","VAFHADT2",10,0)
 ;                                      A12 = Cancel Transfer
"RTN","VAFHADT2",11,0)
 ;                                      A13 = Cancel Discharge
"RTN","VAFHADT2",12,0)
 ;
"RTN","VAFHADT2",13,0)
 ;It is called by VAFHADT1, which is itself is called by the
"RTN","VAFHADT2",14,0)
 ;DGPM patient movement event driver.
"RTN","VAFHADT2",15,0)
 ;
"RTN","VAFHADT2",16,0)
 ;
"RTN","VAFHADT2",17,0)
BLDMSG(DFN,EVENT,VAFHDT,EVCODE,IEN,PIVOT,PV1) ;
"RTN","VAFHADT2",18,0)
 ;Required Variables are:   DFN = IEN of Patient File
"RTN","VAFHADT2",19,0)
 ;                        EVENT = HL7 Event, A01, A02, A03, etc.
"RTN","VAFHADT2",20,0)
 ;                       VAFHDT = Date/Time of Admission, Transfer, etc
"RTN","VAFHADT2",21,0)
 ;
"RTN","VAFHADT2",22,0)
 ;Optional Variables are: Event Code = (EVCODE):A string literal which is
"RTN","VAFHADT2",23,0)
 ;                                     inserted in the Event Reason
"RTN","VAFHADT2",24,0)
 ;                                     Code Field of the EVN segment
"RTN","VAFHADT2",25,0)
 ;                                     of the message. This serves to
"RTN","VAFHADT2",26,0)
 ;                                     indicate that the message might
"RTN","VAFHADT2",27,0)
 ;                                     need to be processed in a special
"RTN","VAFHADT2",28,0)
 ;                                     way. PIMS ADT software uses the
"RTN","VAFHADT2",29,0)
 ;                                     Event Code to indicate whether
"RTN","VAFHADT2",30,0)
 ;                                     the message is the most recent
"RTN","VAFHADT2",31,0)
 ;                                     "Snapshot" of the data "05" or
"RTN","VAFHADT2",32,0)
 ;                                     a "Snapshot" of data that is
"RTN","VAFHADT2",33,0)
 ;                                     followed by more recent data "04"
"RTN","VAFHADT2",34,0)
 ;
"RTN","VAFHADT2",35,0)
 ;                         
"RTN","VAFHADT2",36,0)
 ;                               IEN = The IEN of the Patient Movement
"RTN","VAFHADT2",37,0)
 ;                                     that the HL7 message is being
"RTN","VAFHADT2",38,0)
 ;                                     built from. This is especially
"RTN","VAFHADT2",39,0)
 ;                                     useful for Discharge Movements
"RTN","VAFHADT2",40,0)
 ;                                     where date/time (VAFHDT) is not
"RTN","VAFHADT2",41,0)
 ;                                     enough information to retrieve
"RTN","VAFHADT2",42,0)
 ;                                     the movement
"RTN","VAFHADT2",43,0)
 ;
"RTN","VAFHADT2",44,0)
 ;                             PIVOT = The PIMS Pivot number that
"RTN","VAFHADT2",45,0)
 ;                                     uniquely identifies the ADMISSION
"RTN","VAFHADT2",46,0)
 ;
"RTN","VAFHADT2",47,0)
 ;                               PV1 = In the case of a "Deleted
"RTN","VAFHADT2",48,0)
 ;                                     Admission" the record in the 
"RTN","VAFHADT2",49,0)
 ;                                     Patient Movement File has already
"RTN","VAFHADT2",50,0)
 ;                                     been deleted. But, a PV1 segment
"RTN","VAFHADT2",51,0)
 ;                                     can be built from the DGPMP
"RTN","VAFHADT2",52,0)
 ;                                     variable that has been saved off
"RTN","VAFHADT2",53,0)
 ;                                     by the DGPM Event Driver. This
"RTN","VAFHADT2",54,0)
 ;                                     PV1 segment is passed a string
"RTN","VAFHADT2",55,0)
 ;                                     literal that is built by a call
"RTN","VAFHADT2",56,0)
 ;                                     to DGBUILD^VAFHAPV1 previous to 
"RTN","VAFHADT2",57,0)
 ;                                     calling this software.
"RTN","VAFHADT2",58,0)
 ;
"RTN","VAFHADT2",59,0)
 K HLA N VAFDIAG
"RTN","VAFHADT2",60,0)
 ;Q:($G(EVCODE)'="05")
"RTN","VAFHADT2",61,0)
 ;D INIT^HLTRANS
"RTN","VAFHADT2",62,0)
 K HL D INIT^HLFNC2("VAFH "_EVENT,.HL)
"RTN","VAFHADT2",63,0)
 I $D(HL)=1 G EXIT
"RTN","VAFHADT2",64,0)
 S HLA("HLS",2)=$$EN^VAFHLPID(DFN,",2,3,5,7,8,19")
"RTN","VAFHADT2",65,0)
 S $P(HLA("HLS",2),HLFS,2)=1 ;SET ID
"RTN","VAFHADT2",66,0)
 ;MERGE HLA("HLS",2)=VAFPID
"RTN","VAFHADT2",67,0)
 S HLA("HLS",3)=$$EN^VAFHLZPD(DFN,",1,2,3,4,5,6,7,8,9,10,11,12,13,14,15")
"RTN","VAFHADT2",68,0)
 S $P(HLA("HLS",3),HLFS,2)=1 ;SET ID
"RTN","VAFHADT2",69,0)
 I EVENT="A11" D  G NEXT
"RTN","VAFHADT2",70,0)
 . S HLA("HLS",4)=PV1
"RTN","VAFHADT2",71,0)
 . S $P(HLA("HLS",4),HLFS,51)=$G(PIVOT) ;                 VISIT&SET ID'S
"RTN","VAFHADT2",72,0)
 I EVENT="A01"!(EVENT="A03")!(EVENT="A08")!(EVENT="A12")!(EVENT="A13") D  G NEXT
"RTN","VAFHADT2",73,0)
 . S HLA("HLS",4)=$$IN^VAFHLPV1(DFN,VAFHDT,",2,3,7,8,10,19,44,45",$G(IEN),PIVOT,"",.VAFDIAG)
"RTN","VAFHADT2",74,0)
 I EVENT="A02" D  G NEXT
"RTN","VAFHADT2",75,0)
 . S HLA("HLS",4)=$$IN^VAFHLPV1(DFN,VAFHDT,",2,3,6,7,8,10,19,44,45",$G(IEN),PIVOT,"",.VAFDIAG)
"RTN","VAFHADT2",76,0)
 G EXIT
"RTN","VAFHADT2",77,0)
NEXT ;
"RTN","VAFHADT2",78,0)
 S $P(HLA("HLS",4),HLFS,2)=1
"RTN","VAFHADT2",79,0)
 S HLA("HLS",1)="EVN"_HLFS_EVENT_HLFS_$$HLDATE^HLFNC(VAFHDT,"TS")_HLFS
"RTN","VAFHADT2",80,0)
 S HLA("HLS",1)=HLA("HLS",1)_HLFS_$G(EVCODE)
"RTN","VAFHADT2",81,0)
 I (EVENT="A01")!(EVENT="A08")!(EVENT="A11")!(EVENT="A12")!(EVENT="A13") S HLA("HLS",6)="DG1"_HLFS_1_HLFS_HLFS_HLFS_$$HLQ^VAFHUTL($G(VAFDIAG))
"RTN","VAFHADT2",82,0)
 ;Get patient directory call center parameter
"RTN","VAFHADT2",83,0)
 N VAFCCON
"RTN","VAFHADT2",84,0)
 S VAFCCON=$$GET^XPAR("SYS","DG PT DIRECTORY CALL CENTER")
"RTN","VAFHADT2",85,0)
 I VAFCCON S HLA("HLS",5)=$$EN^VAFHLPV2(DFN,IEN,",22,")
"RTN","VAFHADT2",86,0)
 D:$D(VATRACE) LOOP
"RTN","VAFHADT2",87,0)
 ;
"RTN","VAFHADT2",88,0)
 S COUNTER=""
"RTN","VAFHADT2",89,0)
 F  S COUNTER=$O(HLA("HLS",COUNTER)) Q:COUNTER'>0  D
"RTN","VAFHADT2",90,0)
 .; I +(HLA("HLS",COUNTER))=-1 S HLERR="Bad "_COUNTER_" Segment"
"RTN","VAFHADT2",91,0)
 .  I +(HLA("HLS",COUNTER))=-1 S HL="Bad "_COUNTER_" Segment"
"RTN","VAFHADT2",92,0)
 .
"RTN","VAFHADT2",93,0)
 ;
"RTN","VAFHADT2",94,0)
EXIT ;
"RTN","VAFHADT2",95,0)
 ;I $D(HLERR) D
"RTN","VAFHADT2",96,0)
 I $D(HL)=1 DO
"RTN","VAFHADT2",97,0)
 .  S HLERR(1)=HL
"RTN","VAFHADT2",98,0)
 .  D EBULL^VAFHUTL2(DFN,VAFHDT,PIVOT,"HLERR(")
"RTN","VAFHADT2",99,0)
 ;I '$D(HLERR)&($D(HLSDATA)) S HLMTN="ADT"_$E(HLECH)_EVENT D EN^HLTRANS
"RTN","VAFHADT2",100,0)
 I $D(HL)>1,$D(HLA("HLS")) S HLMTN="ADT"_$E(HL("ECH"))_EVENT DO
"RTN","VAFHADT2",101,0)
 .D GENERATE^HLMA("VAFH "_EVENT,"LM",1,.HLRST)
"RTN","VAFHADT2",102,0)
 D KVAR^VADPT,KVAR^VAFHLPV1 K HLA,HLERR
"RTN","VAFHADT2",103,0)
 Q
"RTN","VAFHADT2",104,0)
LOOP ;
"RTN","VAFHADT2",105,0)
 ;
"RTN","VAFHADT2",106,0)
 ;
"RTN","VAFHADT2",107,0)
 W !!
"RTN","VAFHADT2",108,0)
 N XX S XX=0
"RTN","VAFHADT2",109,0)
 F  S XX=$O(HLA("HLS",XX)) Q:XX=""  W !,HLA("HLS",XX)
"RTN","VAFHADT2",110,0)
 Q
"RTN","VAFHLPV2")
0^2^B3525498^B3086412
"RTN","VAFHLPV2",1,0)
VAFHLPV2 ;ALB/GRR - HL7 PV2 SEGMENT BUILDER ; 3/6/06 8:25am
"RTN","VAFHLPV2",2,0)
 ;;5.3;Registration;**190,692**;Aug 13, 1993
"RTN","VAFHLPV2",3,0)
 ;
"RTN","VAFHLPV2",4,0)
 ;This routine will build an HL7 PV2 segment for an inpatient.
"RTN","VAFHLPV2",5,0)
 ;
"RTN","VAFHLPV2",6,0)
EN(DFN,VAFHMIEN,VAFSTR) ;Entry point of routine
"RTN","VAFHLPV2",7,0)
 ;DFN - Patient Internal Entry Number
"RTN","VAFHLPV2",8,0)
 ;VAFHMIEN - Patient Movement Internal Entry Number
"RTN","VAFHLPV2",9,0)
 ;VAFSTR - Sequence numbers to include in message
"RTN","VAFHLPV2",10,0)
 ;
"RTN","VAFHLPV2",11,0)
 N VAFHLREC,VAFHA,VAFHSUB S VAFHSUB="" ;Initialize variables
"RTN","VAFHLPV2",12,0)
 S $P(VAFHLREC,HL("FS"))="PV2" ;Set segment type to PV2
"RTN","VAFHLPV2",13,0)
 S VAFHMIEN=$$GETAMOV^DGRUUTL(DFN) I VAFHMIEN="" G QUITPV2 ;If movement ien not passed, get admission movement and quit if none
"RTN","VAFHLPV2",14,0)
 I VAFSTR[",3," D
"RTN","VAFHLPV2",15,0)
 .S VAFHA=$$GET1^DIQ(405,VAFHMIEN,".11","I") ;retrieve 'Admitted for SC Condition' field
"RTN","VAFHLPV2",16,0)
 .I VAFHA=1 D  ;If admitted for SC condition do following
"RTN","VAFHLPV2",17,0)
 ..S $P(VAFHSUB,$E(HL("ECH")),4)="SC"
"RTN","VAFHLPV2",18,0)
 ..S $P(VAFHSUB,$E(HL("ECH")),5)="ADMITTED FOR SC CONDITION"
"RTN","VAFHLPV2",19,0)
 ..S $P(VAFHSUB,$E(HL("ECH")),6)="VA0039"
"RTN","VAFHLPV2",20,0)
 .I VAFHA'=1 D  ;If not admitted for SC condition do following
"RTN","VAFHLPV2",21,0)
 ..S $P(VAFHSUB,$E(HL("ECH")),4)="NSC"
"RTN","VAFHLPV2",22,0)
 ..S $P(VAFHSUB,$E(HL("ECH")),5)="NOT ADMITTED FOR SC CONDITION"
"RTN","VAFHLPV2",23,0)
 ..S $P(VAFHSUB,$E(HL("ECH")),6)="VA0039"
"RTN","VAFHLPV2",24,0)
 .S $P(VAFHLREC,HL("FS"),4)=VAFHSUB
"RTN","VAFHLPV2",25,0)
 ;If call center param is on add privacy indicator
"RTN","VAFHLPV2",26,0)
 I VAFSTR[",22," D
"RTN","VAFHLPV2",27,0)
 .S VAIP("D")=$G(VAFHDT) D IN5^VADPT
"RTN","VAFHLPV2",28,0)
 .S $P(VAFHLREC,HL("FS"),23)=$S(+VAIP(19,1)=1:"Y",+VAIP(19,1)=0:"N",1:"")
"RTN","VAFHLPV2",29,0)
 .D KVAR^VADPT
"RTN","VAFHLPV2",30,0)
QUITPV2 Q VAFHLREC
"VER")
8.0^22.0
"BLD",6541,6)
^610
**END**
**END**
