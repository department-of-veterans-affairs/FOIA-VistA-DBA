Released ORRC*1*2 SEQ #3
Extracted from mail message
**KIDS**:ORRC*1.0*2^

**INSTALL NAME**
ORRC*1.0*2
"BLD",5401,0)
ORRC*1.0*2^CARE MANAGEMENT^0^3060314^y
"BLD",5401,1,0)
^^2^2^3041208^
"BLD",5401,1,1,0)
Refer to the National Patch Module for complete details of the 
"BLD",5401,1,2,0)
enhancements included in this patch.
"BLD",5401,4,0)
^9.64PA^^
"BLD",5401,6)
5^
"BLD",5401,"ABPKG")
n
"BLD",5401,"KRN",0)
^9.67PA^8989.52^19
"BLD",5401,"KRN",.4,0)
.4
"BLD",5401,"KRN",.401,0)
.401
"BLD",5401,"KRN",.402,0)
.402
"BLD",5401,"KRN",.403,0)
.403
"BLD",5401,"KRN",.5,0)
.5
"BLD",5401,"KRN",.84,0)
.84
"BLD",5401,"KRN",3.6,0)
3.6
"BLD",5401,"KRN",3.8,0)
3.8
"BLD",5401,"KRN",9.2,0)
9.2
"BLD",5401,"KRN",9.8,0)
9.8
"BLD",5401,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5401,"KRN",9.8,"NM",1,0)
ORRCTIU^^0^B31325045
"BLD",5401,"KRN",9.8,"NM",2,0)
ORRCEVT^^0^B52026948
"BLD",5401,"KRN",9.8,"NM","B","ORRCEVT",2)

"BLD",5401,"KRN",9.8,"NM","B","ORRCTIU",1)

"BLD",5401,"KRN",19,0)
19
"BLD",5401,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",5401,"KRN",19,"NM",1,0)
ORRCMC DASHBOARD^^0
"BLD",5401,"KRN",19,"NM",2,0)
ORRCMC QUERY TOOL^^0
"BLD",5401,"KRN",19,"NM","B","ORRCMC DASHBOARD",1)

"BLD",5401,"KRN",19,"NM","B","ORRCMC QUERY TOOL",2)

"BLD",5401,"KRN",19.1,0)
19.1
"BLD",5401,"KRN",101,0)
101
"BLD",5401,"KRN",409.61,0)
409.61
"BLD",5401,"KRN",771,0)
771
"BLD",5401,"KRN",870,0)
870
"BLD",5401,"KRN",8989.51,0)
8989.51
"BLD",5401,"KRN",8989.52,0)
8989.52
"BLD",5401,"KRN",8994,0)
8994
"BLD",5401,"KRN","B",.4,.4)

"BLD",5401,"KRN","B",.401,.401)

"BLD",5401,"KRN","B",.402,.402)

"BLD",5401,"KRN","B",.403,.403)

"BLD",5401,"KRN","B",.5,.5)

"BLD",5401,"KRN","B",.84,.84)

"BLD",5401,"KRN","B",3.6,3.6)

"BLD",5401,"KRN","B",3.8,3.8)

"BLD",5401,"KRN","B",9.2,9.2)

"BLD",5401,"KRN","B",9.8,9.8)

"BLD",5401,"KRN","B",19,19)

"BLD",5401,"KRN","B",19.1,19.1)

"BLD",5401,"KRN","B",101,101)

"BLD",5401,"KRN","B",409.61,409.61)

"BLD",5401,"KRN","B",771,771)

"BLD",5401,"KRN","B",870,870)

"BLD",5401,"KRN","B",8989.51,8989.51)

"BLD",5401,"KRN","B",8989.52,8989.52)

"BLD",5401,"KRN","B",8994,8994)

"BLD",5401,"QUES",0)
^9.62^^
"BLD",5401,"REQB",0)
^9.611^3^3
"BLD",5401,"REQB",1,0)
ORRC*1.0*1^2
"BLD",5401,"REQB",2,0)
XU*8.0*337^2
"BLD",5401,"REQB",3,0)
XOBV*1.0*2^2
"BLD",5401,"REQB","B","ORRC*1.0*1",1)

"BLD",5401,"REQB","B","XOBV*1.0*2",3)

"BLD",5401,"REQB","B","XU*8.0*337",2)

"KRN",19,9189,-1)
0^2
"KRN",19,9189,0)
ORRCMC QUERY TOOL^Query Tool 1.0.1^^B^^^^^^^^CARE MANAGEMENT
"KRN",19,9189,1,0)
^19.06^1^1^3041122^^^
"KRN",19,9189,1,1,0)
This is the option context for RPCs called by the Care Management Query Tool.
"KRN",19,9189,"RPC",0)
^19.05P^44^44
"KRN",19,9189,"RPC",1,0)
ORWU NEWPERS
"KRN",19,9189,"RPC",2,0)
ORRHCQ QRYITR
"KRN",19,9189,"RPC",3,0)
ORRHCU REGLST
"KRN",19,9189,"RPC",4,0)
ORWU HASKEY
"KRN",19,9189,"RPC",5,0)
ORRHCO ORDITM
"KRN",19,9189,"RPC",6,0)
ORRHCR CTPLST
"KRN",19,9189,"RPC",7,0)
ORWORDG ALLTREE
"KRN",19,9189,"RPC",8,0)
ORRHCQ SETUP
"KRN",19,9189,"RPC",9,0)
XHD GET USER DEMOGRAPHICS
"KRN",19,9189,"RPC",10,0)
ORQPT TEAMS
"KRN",19,9189,"RPC",11,0)
ORRHCT DOCCLS
"KRN",19,9189,"RPC",12,0)
ORQPT WARDS
"KRN",19,9189,"RPC",13,0)
ORRHCO OISETS
"KRN",19,9189,"RPC",14,0)
ORQPT SPECIALTIES
"KRN",19,9189,"RPC",15,0)
ORRHCR TAGDEF
"KRN",19,9189,"RPC",16,0)
ORRHCU DFLDS
"KRN",19,9189,"RPC",17,0)
ORRHCO SIGNSTS
"KRN",19,9189,"RPC",18,0)
ORRHCO ORDSTS
"KRN",19,9189,"RPC",19,0)
ORRHCU ID2EXT
"KRN",19,9189,"RPC",20,0)
ORRHCQ SUBDTA
"KRN",19,9189,"RPC",21,0)
TIU GET RECORD TEXT
"KRN",19,9189,"RPC",22,0)
ORRHCQ DETAIL
"KRN",19,9189,"RPC",23,0)
ORRHCQ PTINFO
"KRN",19,9189,"RPC",24,0)
ORRCQLPT PTDFN
"KRN",19,9189,"RPC",25,0)
ORRHCQ SORTBY
"KRN",19,9189,"RPC",26,0)
ORRHCR RPTLST
"KRN",19,9189,"RPC",27,0)
ORRHCR RPTDEF
"KRN",19,9189,"RPC",28,0)
ORWU CLINLOC
"KRN",19,9189,"RPC",29,0)
ORRHCR SAVDEF
"KRN",19,9189,"RPC",30,0)
ORRHCR DELETE
"KRN",19,9189,"RPC",31,0)
ORRHCQ1 GETCNT
"KRN",19,9189,"RPC",32,0)
ORRHCQ1 DELSEN
"KRN",19,9189,"RPC",33,0)
ORRHCQ1 GETSLN
"KRN",19,9189,"RPC",34,0)
ORRHCQ1 GETSPT
"KRN",19,9189,"RPC",35,0)
ORRHCQ1 QRYSITR
"KRN",19,9189,"RPC",36,0)
ORRHCQ1 QSITR
"KRN",19,9189,"RPC",37,0)
TIU LONG LIST OF TITLES
"KRN",19,9189,"RPC",38,0)
ORRHCT DOCSTS
"KRN",19,9189,"RPC",39,0)
ORRHCQ CLEAR
"KRN",19,9189,"RPC",40,0)
ORRHCO CSLTGRP
"KRN",19,9189,"RPC",41,0)
ORWPT PTINQ
"KRN",19,9189,"RPC",42,0)
ORRHCU DFLDMAP
"KRN",19,9189,"RPC",43,0)
ORPRF HASFLG
"KRN",19,9189,"RPC",44,0)
ORPRF GETFLG
"KRN",19,9189,"U")
QUERY TOOL 1.0.1
"KRN",19,9190,-1)
0^1
"KRN",19,9190,0)
ORRCMC DASHBOARD^Care Management Dashboard 1.0^^B^^^^^^^^CARE MANAGEMENT
"KRN",19,9190,1,0)
^19.06^2^2^3041122^^
"KRN",19,9190,1,1,0)
This is the option context for RPCs called by the Care Management Dashboard
"KRN",19,9190,1,2,0)
(both the Nursing and Clinician dashboards).
"KRN",19,9190,99.1)
60303,45429
"KRN",19,9190,"RPC",0)
^19.05P^32^32
"KRN",19,9190,"RPC",1,0)
ORWU HASKEY
"KRN",19,9190,"RPC",2,0)
ORRC DASHBOARD PATIENTS
"KRN",19,9190,"RPC",3,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,9190,"RPC",4,0)
ORWPT PTINQ
"KRN",19,9190,"RPC",5,0)
ORRC RESULTS BY ID
"KRN",19,9190,"RPC",6,0)
ORRC VITALS BY ID
"KRN",19,9190,"RPC",7,0)
ORRC ORDERS BY ID
"KRN",19,9190,"RPC",8,0)
ORRC RESULTS ACKNOWLEDGE
"KRN",19,9190,"RPC",9,0)
ORRC UNSIGNED BY ID
"KRN",19,9190,"RPC",10,0)
ORRC SIGN
"KRN",19,9190,"RPC",11,0)
ORRC ORDERS COMPLETE
"KRN",19,9190,"RPC",12,0)
ORRC ORDERS VERIFY
"KRN",19,9190,"RPC",13,0)
ORRC EVENTS BY ID
"KRN",19,9190,"RPC",14,0)
ORRC EVENTS ACKNOWLEDGE
"KRN",19,9190,"RPC",15,0)
ORWPT DFLTSRC
"KRN",19,9190,"RPC",16,0)
ORRC RESULTS BY PATIENT
"KRN",19,9190,"RPC",17,0)
ORRC VITALS BY PATIENT
"KRN",19,9190,"RPC",18,0)
ORRC ORDERS BY PATIENT
"KRN",19,9190,"RPC",19,0)
ORRC EVENTS BY PATIENT
"KRN",19,9190,"RPC",20,0)
ORRC APPTS BY PATIENT
"KRN",19,9190,"RPC",21,0)
ORQPT DEFAULT PATIENT LIST
"KRN",19,9190,"RPC",22,0)
ORQPT PROVIDER PATIENTS
"KRN",19,9190,"RPC",23,0)
ORQPT TEAM PATIENTS
"KRN",19,9190,"RPC",24,0)
ORQPT SPECIALTY PATIENTS
"KRN",19,9190,"RPC",25,0)
ORQPT CLINIC PATIENTS
"KRN",19,9190,"RPC",26,0)
ORWPT BYWARD
"KRN",19,9190,"RPC",27,0)
ORRC NURS DASHBD PATIENTS
"KRN",19,9190,"RPC",28,0)
ORRC PHY DASHBD PATIENTS
"KRN",19,9190,"RPC",29,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,9190,"RPC",30,0)
ORRC ALERTS BY PATIENT
"KRN",19,9190,"RPC",31,0)
ORPRF HASFLG
"KRN",19,9190,"RPC",32,0)
ORPRF GETFLG
"KRN",19,9190,"U")
CARE MANAGEMENT DASHBOARD 1.0
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",395,-1)
1^1
"PKG",395,0)
CARE MANAGEMENT^ORRC^Care Mgt Modules
"PKG",395,20,0)
^9.402P^^
"PKG",395,22,0)
^9.49I^1^1
"PKG",395,22,1,0)
1.0^3040116^3040426^1119
"PKG",395,22,1,"PAH",1,0)
2^3060314
"PKG",395,22,1,"PAH",1,1,0)
^^2^2^3060314
"PKG",395,22,1,"PAH",1,1,1,0)
Refer to the National Patch Module for complete details of the 
"PKG",395,22,1,"PAH",1,1,2,0)
enhancements included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ORRCEVT")
0^2^B52026948^B45814618
"RTN","ORRCEVT",1,0)
ORRCEVT ; SLC/MKB,JFR - Event utilities ; 7/5/05 11:15
"RTN","ORRCEVT",2,0)
 ;;1.0;CARE MANAGEMENT;**2**;Jul 15, 2003
"RTN","ORRCEVT",3,0)
 ;
"RTN","ORRCEVT",4,0)
 ; ID = "VST:"_alertID (="OR,<dfn>,<nien>;<user>;<date.time>")
"RTN","ORRCEVT",5,0)
 ;         or _apptID  (="A;<date.time>;<hospital location>;<dfn>")
"RTN","ORRCEVT",6,0)
 ;         or _visitID (="V;<date.time>;<hospital location>;<dfn>")
"RTN","ORRCEVT",7,0)
 ;         or _procID  (=order#)
"RTN","ORRCEVT",8,0)
 ;
"RTN","ORRCEVT",9,0)
PATS(ORY,ORUSR) ; -- Return list of patients for whom ORUSR has ADT alerts
"RTN","ORRCEVT",10,0)
 ; in @ORY@(PAT) = #event alerts
"RTN","ORRCEVT",11,0)
 ;    @ORY@(PAT,ID) = "" per alert
"RTN","ORRCEVT",12,0)
 ; [from ORRCDPT]
"RTN","ORRCEVT",13,0)
 N ORXQ,ORI,XQAID,PAT,NOT,X,ACTDT
"RTN","ORRCEVT",14,0)
 S ORY=$NA(^TMP($J,"ORRCEVT")) K @ORY
"RTN","ORRCEVT",15,0)
 S ORXQ=$NA(^TMP($J,"ORXQ")) K @ORXQ
"RTN","ORRCEVT",16,0)
 S ORUSR=+$G(ORUSR),ACTDT=$$PARAM^ORRCACK(ORUSR)
"RTN","ORRCEVT",17,0)
 D USER^XQALERT(ORXQ,ORUSR) Q:+$G(@ORXQ)<1
"RTN","ORRCEVT",18,0)
 S ORI=0 F  S ORI=$O(@ORXQ@(ORI)) Q:ORI<1  S XQAID=$P(@ORXQ@(ORI),U,2) D
"RTN","ORRCEVT",19,0)
 . Q:XQAID'?1"OR,".E  S PAT=+$P(XQAID,",",2),NOT=+$P(XQAID,",",3)
"RTN","ORRCEVT",20,0)
 . I $D(^TMP($J,"ORRCLST")),'$D(^TMP($J,"ORRCY",PAT)) Q
"RTN","ORRCEVT",21,0)
 . I $D(^TMP($J,"ORRCLST")) D
"RTN","ORRCEVT",22,0)
 .. I "^18^19^20^35^36^"'[(U_NOT_U) D:'$$INCLD  Q  ;non-ADT alerts
"RTN","ORRCEVT",23,0)
 ... S ^TMP($J,"ORRCNOTF",PAT)=1
"RTN","ORRCEVT",24,0)
 .. S X=+$G(@ORY@(PAT)),@ORY@(PAT)=X+1,@ORY@(PAT,"VST:"_XQAID)=""
"RTN","ORRCEVT",25,0)
 . I '$D(^TMP($J,"ORRCLST")) D  ; add pts to dynamic if other notifs
"RTN","ORRCEVT",26,0)
 .. I "^18^19^20^35^36^"'[(U_NOT_U) D:'$$INCLD  Q  ;non-ADT alerts
"RTN","ORRCEVT",27,0)
 ... S ^TMP($J,"ORRCNOTF",PAT)=1
"RTN","ORRCEVT",28,0)
 ... I '$D(^TMP($J,"ORRCY",PAT)) S ^TMP($J,"ORRCY",PAT)="" ; add patient
"RTN","ORRCEVT",29,0)
 .. S X=+$G(@ORY@(PAT)),@ORY@(PAT)=X+1,@ORY@(PAT,"VST:"_XQAID)=""
"RTN","ORRCEVT",30,0)
 K @ORXQ,^TMP($J,"ORSLT")
"RTN","ORRCEVT",31,0)
 Q
"RTN","ORRCEVT",32,0)
 ;
"RTN","ORRCEVT",33,0)
INCLD() ; -- Order already in Results column?
"RTN","ORRCEVT",34,0)
 I "^3^14^21^22^23^24^25^53^57^58^"'[(U_NOT_U) Q 0
"RTN","ORRCEVT",35,0)
 I (ACTDT<1)!(ACTDT>DT) Q 0
"RTN","ORRCEVT",36,0)
 N X,DATE,DATA
"RTN","ORRCEVT",37,0)
 S DATE=$P(XQAID,";",3),DATA=$G(^XTV(8992,ORUSR,"XQA",DATE,1))
"RTN","ORRCEVT",38,0)
 S X=$P(DATA,"|") S:$L(X,"~")>2 X=$P(X,"~",2,3) I X="" Q 0
"RTN","ORRCEVT",39,0)
 I '$G(^TMP($J,"ORSLT",PAT,X)) Q 0
"RTN","ORRCEVT",40,0)
 Q 1
"RTN","ORRCEVT",41,0)
 ;
"RTN","ORRCEVT",42,0)
IDS(ORY,ORPAT,ORBEG,OREND) ; -- Return appointments for ORPAT
"RTN","ORRCEVT",43,0)
 ; in @ORY@(ORPAT) = #appts
"RTN","ORRCEVT",44,0)
 ;    @ORY@(ORPAT,ID) = "" per appt
"RTN","ORRCEVT",45,0)
 ; [from ORRCDPT1]
"RTN","ORRCEVT",46,0)
 N ORRCVST,ORVST,ORI,CNT,ID,ORDG,ORLIST,ORIFN,STS,STRT,ORDT
"RTN","ORRCEVT",47,0)
 S ORY=$NA(^TMP($J,"ORRCEVT")) K @ORY
"RTN","ORRCEVT",48,0)
 S ORPAT=+$G(ORPAT),ORBEG=$G(ORBEG),OREND=$G(OREND)
"RTN","ORRCEVT",49,0)
 D VST^ORWCV(.ORRCVST,ORPAT,ORBEG,OREND,1) ;=ID^FMdate^ClinicName^StatusName
"RTN","ORRCEVT",50,0)
 M ORVST=ORRCVST
"RTN","ORRCEVT",51,0)
 S (CNT,ORI)=0 F  S ORI=$O(ORVST(ORI)) Q:ORI<1  D
"RTN","ORRCEVT",52,0)
 . S ID="VST:"_$P(ORVST(ORI),U)_";"_ORPAT
"RTN","ORRCEVT",53,0)
 . S CNT=CNT+1,@ORY@(ORPAT,ID)=""
"RTN","ORRCEVT",54,0)
 ;+scheduled Radiology procedures
"RTN","ORRCEVT",55,0)
 S ORDG=+$O(^ORD(100.98,"B","XRAY",0)),ORPAT=+ORPAT_";DPT("
"RTN","ORRCEVT",56,0)
 D EN^ORQ1(ORPAT,ORDG,2) S ORDT=$S($G(DT):DT,1:$P($$NOW^XLFDT,"."))
"RTN","ORRCEVT",57,0)
 S ORI=0 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI<1  S ORIFN=^(ORI) D
"RTN","ORRCEVT",58,0)
 . S STS=$P($G(^OR(100,+ORIFN,3)),U,3),STRT=$P($G(^(0)),U,8)
"RTN","ORRCEVT",59,0)
 . Q:"^1^2^7^12^13^14^"[(U_STS_U)  I STRT,STRT<ORDT Q  ;done
"RTN","ORRCEVT",60,0)
 . S CNT=CNT+1,@ORY@(ORPAT,"VST:"_+ORIFN)=""
"RTN","ORRCEVT",61,0)
 S:CNT @ORY@(ORPAT)=CNT K ^TMP("ORR",$J,ORLIST)
"RTN","ORRCEVT",62,0)
 Q
"RTN","ORRCEVT",63,0)
 ;
"RTN","ORRCEVT",64,0)
LIST(ORY,ORPAT,ORUSR,ORDET) ; -- Return alerted events to ORUSR for ORPAT
"RTN","ORRCEVT",65,0)
 ; in @ORY@(#) = Item=ID^Text^Date in HL7 format, and also if ORDET
"RTN","ORRCEVT",66,0)
 ;             = Text=line of associated document text
"RTN","ORRCEVT",67,0)
 ; RPC = ORRC EVENTS BY PATIENT
"RTN","ORRCEVT",68,0)
 N ORXQ,ORN,I,XQAID,NOT,TEXT,DATE
"RTN","ORRCEVT",69,0)
 S ORXQ=$NA(^TMP($J,"ORXQ")) K @ORXQ D USER^XQALERT(ORXQ,+$G(ORUSR))
"RTN","ORRCEVT",70,0)
 S ORY=$NA(^TMP($J,"ORRCEVT")),ORN=0 K @ORY
"RTN","ORRCEVT",71,0)
 S I=0 F  S I=$O(@ORXQ@(I)) Q:I<1  D
"RTN","ORRCEVT",72,0)
 . S TEXT=$P(@ORXQ@(I),U),XQAID=$P(@ORXQ@(I),U,2),DATE=$P(XQAID,";",3)
"RTN","ORRCEVT",73,0)
 . Q:XQAID'?1"OR,".E  Q:+$P(XQAID,",",2)'=ORPAT
"RTN","ORRCEVT",74,0)
 . S NOT=+$P(XQAID,",",3) Q:"^18^19^20^35^36^"'[(U_NOT_U)
"RTN","ORRCEVT",75,0)
 . S ORN=ORN+1,@ORY@(ORN)="Item=VST:"_XQAID_U_$E(TEXT,23,99)_U_$$FMTHL7^XLFDT(DATE)
"RTN","ORRCEVT",76,0)
 . I $G(ORDET) D NOTE
"RTN","ORRCEVT",77,0)
 K @ORXQ
"RTN","ORRCEVT",78,0)
 Q
"RTN","ORRCEVT",79,0)
 ;
"RTN","ORRCEVT",80,0)
APPT(ORY,ORPAT,ORBEG,OREND,ORDET) ; -- Return past/future appointments
"RTN","ORRCEVT",81,0)
 ; in @ORY@(#) = Item=ID^Text^Date in HL7 format^Status, and also if ORDET
"RTN","ORRCEVT",82,0)
 ;             = Text=line of associated document text
"RTN","ORRCEVT",83,0)
 ; RPC = ORRC APPTS BY PATIENT
"RTN","ORRCEVT",84,0)
 N ORN,ORVST,ORI,X,ID,LOC,DATE,VISIT,ORNOTE,ORJ,ORDG,ORLIST,ORIFN,ORNOW
"RTN","ORRCEVT",85,0)
 N STS,STRT,NOW,ORRCVST,ORRCNOTE
"RTN","ORRCEVT",86,0)
 S ORPAT=+$G(ORPAT),ORBEG=$$HL7TFM^XLFDT($G(ORBEG)),OREND=$$HL7TFM^XLFDT($G(OREND)),NOW=$$NOW^XLFDT
"RTN","ORRCEVT",87,0)
 D VST^ORWCV(.ORRCVST,ORPAT,ORBEG,OREND,1) ;=ID^FMdate^ClinicName^StatusName
"RTN","ORRCEVT",88,0)
 M ORVST=ORRCVST
"RTN","ORRCEVT",89,0)
 S ORY=$NA(^TMP($J,"ORRCAPPT")),ORN=0 K @ORY
"RTN","ORRCEVT",90,0)
 S ORI=0 F  S ORI=$O(ORVST(ORI)) Q:ORI<1  D
"RTN","ORRCEVT",91,0)
 . S X=ORVST(ORI),DATE=$P(X,U,2)
"RTN","ORRCEVT",92,0)
 . S ID="VST:"_$P(X,U)_";"_ORPAT,LOC=+$P(ID,";",3)
"RTN","ORRCEVT",93,0)
 . S ORN=ORN+1,@ORY@(ORN)="Item="_ID_U_$P(X,U,3)_U_$$FMTHL7^XLFDT(DATE)_U_$P(X,U,4)
"RTN","ORRCEVT",94,0)
 . I $G(ORDET) D
"RTN","ORRCEVT",95,0)
 .. I DATE>NOW S ORN=ORN+1,@ORY@(ORN)="Text=Scheduled Appointment" Q
"RTN","ORRCEVT",96,0)
 .. I $G(^SC(LOC,"OOS")) S ORN=ORN+1,@ORY@(ORN)="Text=No note available" Q
"RTN","ORRCEVT",97,0)
 .. S VISIT=+$$GETENC^PXAPI(ORPAT,DATE,LOC) K ORNOTE
"RTN","ORRCEVT",98,0)
 .. D DETNOTE^ORQQVS(.ORRCNOTE,ORPAT,VISIT)
"RTN","ORRCEVT",99,0)
 .. M ORNOTE=ORRCNOTE
"RTN","ORRCEVT",100,0)
 .. S ORJ=0 F  S ORJ=$O(ORNOTE(ORJ)) Q:ORJ<1  S ORN=ORN+1,@ORY@(ORN)="Text="_ORNOTE(ORJ)
"RTN","ORRCEVT",101,0)
 ;+future Radiology procedures in #100
"RTN","ORRCEVT",102,0)
 S ORDG=+$O(^ORD(100.98,"B","XRAY",0)),ORPAT=+ORPAT_";DPT("
"RTN","ORRCEVT",103,0)
 D EN^ORQ1(ORPAT,ORDG,2) S ORNOW=$$NOW^XLFDT
"RTN","ORRCEVT",104,0)
 S ORI=0 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI<1  S ORIFN=^(ORI) D
"RTN","ORRCEVT",105,0)
 . S STS=$P($G(^OR(100,+ORIFN,3)),U,3),STRT=$P($G(^(0)),U,8)
"RTN","ORRCEVT",106,0)
 . Q:"^1^2^7^12^13^14^"[(U_STS_U)  I STRT,STRT<ORNOW Q  ;done
"RTN","ORRCEVT",107,0)
 . S ORN=ORN+1,@ORY@(ORN)="Item=VST:"_+ORIFN_U_$$TXT^ORRCOR(+ORIFN)_U_$$FMTHL7^XLFDT(STRT)_U_$$STS^ORRCOR(+ORIFN)
"RTN","ORRCEVT",108,0)
 . I $G(ORDET) D ORD^ORRCOR
"RTN","ORRCEVT",109,0)
 K ^TMP("ORR",$J,ORLIST)
"RTN","ORRCEVT",110,0)
 Q
"RTN","ORRCEVT",111,0)
 ;
"RTN","ORRCEVT",112,0)
TEXT(ORY,VISIT) ; -- Return associated document text of VISITs
"RTN","ORRCEVT",113,0)
 ; where VISIT(#) = ID
"RTN","ORRCEVT",114,0)
 ; in @ORY@(#) = Item=ID^Text^Date in HL7 format
"RTN","ORRCEVT",115,0)
 ;             = Text=line of document text
"RTN","ORRCEVT",116,0)
 ; RPC = ORRC EVENTS BY ID
"RTN","ORRCEVT",117,0)
 N ORN,ORI,ID,XQAID,LOC,TEXT,DATE,VST,ORIFN,DFN,ORNOTE,ORRCNOTE,NOW
"RTN","ORRCEVT",118,0)
 S NOW=$$NOW^XLFDT,ORN=0,ORY=$NA(^TMP($J,"ORRCEVT")) K @ORY
"RTN","ORRCEVT",119,0)
 S ORI="" F  S ORI=$O(VISIT(ORI)) Q:ORI=""  S ID=$P(VISIT(ORI),":",2) D
"RTN","ORRCEVT",120,0)
 . I ID D  Q  ;order
"RTN","ORRCEVT",121,0)
 .. S DATE=$P($G(^OR(100,+ID,0)),U,8)
"RTN","ORRCEVT",122,0)
 .. S ORN=ORN+1,@ORY@(ORN)="Item=VST:"_ID_U_$$TXT^ORRCOR(+ID)_U_$$FMTHL7^XLFDT(DATE)
"RTN","ORRCEVT",123,0)
 .. S ORIFN=ID D ORD^ORRCOR
"RTN","ORRCEVT",124,0)
 . I ID?1"OR,".E D  Q  ;alert
"RTN","ORRCEVT",125,0)
 .. S TEXT=$$MSGTXT^ORRCXQ(ID),DATE=+$P(ID,";",3)
"RTN","ORRCEVT",126,0)
 .. S ORN=ORN+1,@ORY@(ORN)="Item=VST:"_ID_U_TEXT_U_$$FMTHL7^XLFDT(DATE)
"RTN","ORRCEVT",127,0)
 .. S XQAID=ID D NOTE
"RTN","ORRCEVT",128,0)
 . S DATE=$P(ID,";",2),LOC=+$P(ID,";",3),DFN=+$P(ID,";",4)
"RTN","ORRCEVT",129,0)
 . S ORN=ORN+1,@ORY@(ORN)="Item=VST:"_ID_U_$P($G(^SC(LOC,0)),U)_U_DATE
"RTN","ORRCEVT",130,0)
 . I DATE>NOW S ORN=ORN+1,@ORY@(ORN)="Text=Scheduled Appointment" Q
"RTN","ORRCEVT",131,0)
 . S VST=+$$GETENC^PXAPI(DFN,DATE,LOC) K ORNOTE,ORRCNOTE
"RTN","ORRCEVT",132,0)
 . D DETNOTE^ORQQVS(.ORRCNOTE,DFN,VST)
"RTN","ORRCEVT",133,0)
 . M ORNOTE=ORRCNOTE
"RTN","ORRCEVT",134,0)
 . S ORJ=0 F  S ORJ=$O(ORNOTE(ORJ)) Q:ORJ<1  S ORN=ORN+1,@ORY@(ORN)="Text="_ORNOTE(ORJ)
"RTN","ORRCEVT",135,0)
 Q
"RTN","ORRCEVT",136,0)
 ;
"RTN","ORRCEVT",137,0)
NOTE ; -- Add note text associated with event in alert XQAID to @ORY@(ORN)
"RTN","ORRCEVT",138,0)
 ;    Expects TEXT,DATE from alert
"RTN","ORRCEVT",139,0)
 N DFN,NOT,VDT,VAIP,VAERR,LOC,VISIT,ORZ,ORI,ENC,X0,ORRCZ
"RTN","ORRCEVT",140,0)
 S DFN=+$P(XQAID,",",2),NOT=+$P(XQAID,",",3),VDT=$$MSGDT^ORRCXQ(DATE,TEXT)
"RTN","ORRCEVT",141,0)
 I NOT=20,TEXT?1"Died on ".E S ORN=ORN+1,@ORY@(ORN)="Text=No details available." Q
"RTN","ORRCEVT",142,0)
 I NOT=19 D  ;Unsched visit
"RTN","ORRCEVT",143,0)
 . S LOC=0,VISIT=0 ;IA #2065
"RTN","ORRCEVT",144,0)
 . S ENC=0 F  S ENC=$O(^SCE("ADFN",DFN,VDT,ENC)) Q:ENC<1  D  Q:LOC
"RTN","ORRCEVT",145,0)
 .. S X0=$G(^SCE(ENC,0)) Q:$P(X0,U,6)  Q:$P(X0,U,8)=1  ;not parent, appt
"RTN","ORRCEVT",146,0)
 .. Q:$G(^SC(+$P(X0,U,4),"OOS"))  ;not OOS loc
"RTN","ORRCEVT",147,0)
 .. S LOC=+$P(X0,U,4),VISIT=+$P(X0,U,5)
"RTN","ORRCEVT",148,0)
 . S:VISIT<1 VISIT=+$$GETENC^PXAPI(DFN,VDT,LOC)
"RTN","ORRCEVT",149,0)
 . K ORZ D DETNOTE^ORQQVS(.ORRCZ,DFN,VISIT)
"RTN","ORRCEVT",150,0)
 . M ORZ=ORRCZ
"RTN","ORRCEVT",151,0)
 I NOT'=19 D  ;inpt mvt
"RTN","ORRCEVT",152,0)
 . S VAIP("D")=$S(NOT=18!(NOT=36):DATE,1:VDT) D IN5^VADPT
"RTN","ORRCEVT",153,0)
 . S VDT=+VAIP(13,1),LOC=+$G(^DIC(42,+VAIP(13,4),44))
"RTN","ORRCEVT",154,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,VDT,LOC)
"RTN","ORRCEVT",155,0)
 . K ORZ D DETSUM^ORQQVS(.ORRCZ,DFN,VISIT)
"RTN","ORRCEVT",156,0)
 . M ORZ=ORRCZ
"RTN","ORRCEVT",157,0)
 . K ^TMP("PXKENC",$J)
"RTN","ORRCEVT",158,0)
 S ORI=0 F  S ORI=$O(ORZ(ORI)) Q:ORI<1  S ORN=ORN+1,@ORY@(ORN)="Text="_ORZ(ORI)
"RTN","ORRCEVT",159,0)
 Q
"RTN","ORRCEVT",160,0)
 ;
"RTN","ORRCEVT",161,0)
CLEAR(ORY,ORUSR,VISIT) ; -- Clear VISIT alerts for ORUSR
"RTN","ORRCEVT",162,0)
 ; where VISIT(#) = ID
"RTN","ORRCEVT",163,0)
 ; returns ORY(#) = ID ^ 1 or 0, if successful
"RTN","ORRCEVT",164,0)
 ; RPC = ORRC EVENTS ACKNOWLEDGE
"RTN","ORRCEVT",165,0)
 Q:'$G(ORUSR)  N ORN,ORI,XQAID S ORN=0 K ORY
"RTN","ORRCEVT",166,0)
 S ORI=""  F  S ORI=$O(VISIT(ORI)) Q:ORI=""  D
"RTN","ORRCEVT",167,0)
 . S XQAID=$P(VISIT(ORI),":",2)
"RTN","ORRCEVT",168,0)
 . D DELETE^ORRCXQ(XQAID)
"RTN","ORRCEVT",169,0)
 . S ORN=ORN+1,ORY(ORN)="VST:"_XQAID_"^1"
"RTN","ORRCEVT",170,0)
 Q
"RTN","ORRCEVT",171,0)
 ;
"RTN","ORRCEVT",172,0)
TEST19(USR) ; -- Trigger Unsched Visit alert to test
"RTN","ORRCEVT",173,0)
 N XQA,XQAID,XQAMSG
"RTN","ORRCEVT",174,0)
 S XQA(USR)="",XQAID="OR,54,19",XQAMSG="CPRS,JOH (C1239): Unscheduled visit on OCT 14,1999@17:16:21"
"RTN","ORRCEVT",175,0)
 D SETUP^XQALERT
"RTN","ORRCEVT",176,0)
 Q
"RTN","ORRCEVT",177,0)
 ;
"RTN","ORRCEVT",178,0)
TEST35(USR) ; -- Trigger Discharge alert to test
"RTN","ORRCEVT",179,0)
 N XQA,XQAID,XQAMSG
"RTN","ORRCEVT",180,0)
 S XQA(USR)="",XQAID="OR,?,35",XQAMSG="Discharged on ?"
"RTN","ORRCEVT",181,0)
 D SETUP^XQALERT
"RTN","ORRCEVT",182,0)
 Q
"RTN","ORRCEVT",183,0)
 ;
"RTN","ORRCEVT",184,0)
TEST20(USR) ; -- Trigger Deceased alert to test
"RTN","ORRCEVT",185,0)
 N XQA,XQAID,XQAMSG
"RTN","ORRCEVT",186,0)
 S XQA(USR)="",XQAID="OR,91265,20",XQAMSG="CPRS,K (C8838): Died on AUG 31,1999"
"RTN","ORRCEVT",187,0)
 D SETUP^XQALERT
"RTN","ORRCEVT",188,0)
 Q
"RTN","ORRCTIU")
0^1^B31325045^B23646519
"RTN","ORRCTIU",1,0)
ORRCTIU ; SLC/JER - TIU data for CM ; 7/18/05 10:38
"RTN","ORRCTIU",2,0)
 ;;1.0;CARE MANAGEMENT;**2**;Jul 15, 2003
"RTN","ORRCTIU",3,0)
 ;
"RTN","ORRCTIU",4,0)
 ; This routine invokes IAs: 2322,2323,2834,2937,2944,2960,4175,4733
"RTN","ORRCTIU",5,0)
 ;
"RTN","ORRCTIU",6,0)
GETPTUNS(ORRCY,AUDUZ) ; Get pts w/documents that need user's signature
"RTN","ORRCTIU",7,0)
 ; Returns @ORRCY@(DFN,"DOC:"_TIUDA)=""
"RTN","ORRCTIU",8,0)
 ; [from ORRCDPT]
"RTN","ORRCTIU",9,0)
 N TITLE,GVN,ORT,TIUDA,ORDFN,ITR,ORRCASIG
"RTN","ORRCTIU",10,0)
 S TITLE=0,GVN=$NA(^TIU(8925,"AAU")),ORRCY=$NA(^TMP($J,"ORRCTIU")) K @ORRCY
"RTN","ORRCTIU",11,0)
 F  S TITLE=$O(@GVN@(AUDUZ,TITLE)) Q:+TITLE'>0  D
"RTN","ORRCTIU",12,0)
 . S ORT=0 F  S ORT=$O(@GVN@(AUDUZ,TITLE,5,ORT)) Q:+ORT'>0  D
"RTN","ORRCTIU",13,0)
 .. S TIUDA=0
"RTN","ORRCTIU",14,0)
 .. F  S TIUDA=$O(@GVN@(AUDUZ,TITLE,5,ORT,TIUDA)) Q:+TIUDA'>0  D
"RTN","ORRCTIU",15,0)
 ... S ORDFN=$P($G(^TIU(8925,TIUDA,0)),U,2) Q:+ORDFN'>0
"RTN","ORRCTIU",16,0)
 ... I $D(^TMP($J,"ORRCLST")),'$D(^TMP($J,"ORRCY",ORDFN)) Q  ;not on list
"RTN","ORRCTIU",17,0)
 ... I '+$$CANDO^TIULP(TIUDA,"SIGNATURE",AUDUZ) Q  ; user may not sign
"RTN","ORRCTIU",18,0)
 ... S @ORRCY@(ORDFN,"DOC:"_TIUDA)=""
"RTN","ORRCTIU",19,0)
 S TITLE=0,GVN=$NA(^TIU(8925,"ASUP"))
"RTN","ORRCTIU",20,0)
 F  S TITLE=$O(@GVN@(AUDUZ,TITLE)) Q:+TITLE'>0  D
"RTN","ORRCTIU",21,0)
 . N STATUS F STATUS=5,6 D
"RTN","ORRCTIU",22,0)
 .. S ORT=0 F  S ORT=$O(@GVN@(AUDUZ,TITLE,STATUS,ORT)) Q:+ORT'>0  D
"RTN","ORRCTIU",23,0)
 ... S TIUDA=0
"RTN","ORRCTIU",24,0)
 ... F  S TIUDA=$O(@GVN@(AUDUZ,TITLE,STATUS,ORT,TIUDA)) Q:+TIUDA'>0  D
"RTN","ORRCTIU",25,0)
 .... S ORDFN=$P($G(^TIU(8925,TIUDA,0)),U,2) Q:+ORDFN'>0
"RTN","ORRCTIU",26,0)
 .... I $D(^TMP($J,"ORRCLST")),'$D(^TMP($J,"ORRCY",ORDFN)) Q  ;not on list
"RTN","ORRCTIU",27,0)
 .... I '+$$CANDO^TIULP(TIUDA,$S(STATUS=5:"SIGNATURE",1:"COSIGNATURE"),AUDUZ) Q  ; user may not Sign/Cosign
"RTN","ORRCTIU",28,0)
 .... S @ORRCY@(ORDFN,"DOC:"_TIUDA)=""
"RTN","ORRCTIU",29,0)
 ; capture addl signer docs 
"RTN","ORRCTIU",30,0)
 K ^TMP("TIUSIGN",$J),^TMP("ORRCASIG",$J)
"RTN","ORRCTIU",31,0)
 S ORRCASIG="",ITR=0
"RTN","ORRCTIU",32,0)
 D NEEDSIG^TIULX(.ORRCASIG,AUDUZ)
"RTN","ORRCTIU",33,0)
 Q:'$D(@ORRCASIG)
"RTN","ORRCTIU",34,0)
 M ^TMP("ORRCASIG",$J)=@ORRCASIG
"RTN","ORRCTIU",35,0)
 F  S ITR=$O(^TMP("ORRCASIG",$J,ITR)) Q:'ITR  D
"RTN","ORRCTIU",36,0)
 . S TIUDA=^TMP("ORRCASIG",$J,ITR)
"RTN","ORRCTIU",37,0)
 . S ORDFN=$P($G(^TIU(8925,TIUDA,0)),U,2) Q:+ORDFN'>0
"RTN","ORRCTIU",38,0)
 . I $D(^TMP($J,"ORRCLST")),'$D(^TMP($J,"ORRCY",ORDFN)) Q  ;not on list?
"RTN","ORRCTIU",39,0)
 . I '+$$CANDO^TIULP(TIUDA,"SIGNATURE",AUDUZ) Q  ; user may not sign
"RTN","ORRCTIU",40,0)
 . S @ORRCY@(ORDFN,"DOC:"_TIUDA)=""
"RTN","ORRCTIU",41,0)
 K ^TMP("TIUSIGN",$J),^TMP("ORRCASIG",$J)
"RTN","ORRCTIU",42,0)
 Q
"RTN","ORRCTIU",43,0)
 ;
"RTN","ORRCTIU",44,0)
LISTUNS(ORY,ORUSR,ORPAT) ; -- Get list of unsigned documents for ORPAT by ORUSR
"RTN","ORRCTIU",45,0)
 ; 
"RTN","ORRCTIU",46,0)
 Q
"RTN","ORRCTIU",47,0)
 ;
"RTN","ORRCTIU",48,0)
TEXT(ORY,DOC) ; -- Return text of DOCs in
"RTN","ORRCTIU",49,0)
 ; @ORY@(#) = Item=ID^Title^Date IN HL7 format
"RTN","ORRCTIU",50,0)
 ;          = Text=line of document text
"RTN","ORRCTIU",51,0)
 N ORN,ORI,ORRCY,TIUDA,TIUY,TIUI,TIUX
"RTN","ORRCTIU",52,0)
 S ORN=0,ORY=$NA(^TMP($J,"ORRCDOC")) K @ORY
"RTN","ORRCTIU",53,0)
 S ORI="" F  S ORI=$O(DOC(ORI)) Q:ORI=""  D
"RTN","ORRCTIU",54,0)
 . S TIUDA=+$P(DOC(ORI),":",2) D TGET^TIUSRVR1(.ORRCY,TIUDA)
"RTN","ORRCTIU",55,0)
 . M TIUY=ORRCY
"RTN","ORRCTIU",56,0)
 . S TIUX=$$RESOLVE^TIUSRVLO(TIUDA)
"RTN","ORRCTIU",57,0)
 . S ORN=ORN+1,@ORY@(ORN)="Item=DOC:"_TIUDA_U_$P(TIUX,U)_U_$P($$FMTHL7^XLFDT($P(TIUX,U,2)),"-")_U_$$REQENC(TIUDA)
"RTN","ORRCTIU",58,0)
 . S TIUI=0 F  S TIUI=$O(@TIUY@(TIUI)) Q:TIUI<1  S ORN=ORN+1,@ORY@(ORN)="Text="_@TIUY@(TIUI)
"RTN","ORRCTIU",59,0)
 Q
"RTN","ORRCTIU",60,0)
 ;
"RTN","ORRCTIU",61,0)
REQENC(TIUDA)   ; -- Determine whether encounter data is needed
"RTN","ORRCTIU",62,0)
 N ORRD0,ORRD12,ORSVC,ORRY,ORRDP,ORRCSA,ORASK,ORRPRIMD,DATANEED,ORROPT,LST,ORRPRIME,ORRCLST,ORRCDP,ORRCASK
"RTN","ORRCTIU",63,0)
 S ORRD0=$G(^TIU(8925,TIUDA,0)),ORRD12=$G(^(12)),ORRY="false"
"RTN","ORRCTIU",64,0)
 S (ORROPT,DATANEED)=0
"RTN","ORRCTIU",65,0)
 ; Load existing encounter info
"RTN","ORRCTIU",66,0)
 D PCE4NOTE^ORWPCE3(.ORRCLST,TIUDA,+$P(ORRD0,U,2))
"RTN","ORRCTIU",67,0)
 ; identify primary provider
"RTN","ORRCTIU",68,0)
 S ORRPRIMD=$$GETPRIMD(TIUDA,ORRD12,.ORRCLST)
"RTN","ORRCTIU",69,0)
 M LST=ORRCLST
"RTN","ORRCTIU",70,0)
 ; determine whether "Data Needed"
"RTN","ORRCTIU",71,0)
 ; 1. if encdt > today quit false
"RTN","ORRCTIU",72,0)
 I +$P(ORRD0,U,7)>(DT_".235959") G CHKASK
"RTN","ORRCTIU",73,0)
 ; 2. if service category '= "A", "I", or "T" quit false
"RTN","ORRCTIU",74,0)
 S ORSVC=$P(ORRD0,U,13)
"RTN","ORRCTIU",75,0)
 I '$S(ORSVC="A":1,ORSVC="I":1,ORSVC="T":1,1:0) G CHKASK
"RTN","ORRCTIU",76,0)
 S ORROPT=1
"RTN","ORRCTIU",77,0)
 ; if TIU doc param SUPPRESS DX/CPT ON ENTRY is true, quit false
"RTN","ORRCTIU",78,0)
 D DOCPRM^TIULC1(+ORRD0,.ORRCDP)
"RTN","ORRCTIU",79,0)
 M ORRDP=ORRCDP
"RTN","ORRCTIU",80,0)
 I +$P(ORRDP(0),U,14) G CHKASK
"RTN","ORRCTIU",81,0)
 ; if stand-alone visit, quit true
"RTN","ORRCTIU",82,0)
 D HASVISIT^ORWPCE(.ORRCSA,TIUDA,+$P(ORRD0,U,2),+$P(ORRD12,U,11),+$P(ORRD0,U,7))
"RTN","ORRCTIU",83,0)
 I ORRCSA<1 S DATANEED=1 G CHKASK
"RTN","ORRCTIU",84,0)
 ; if TIU doc param ASK DX/CPT ON ALL OPT VISITS is true, quit true
"RTN","ORRCTIU",85,0)
 I +$P(ORRDP(0),U,16) S DATANEED=1 G CHKASK
"RTN","ORRCTIU",86,0)
CHKASK I +DATANEED S DATANEED=$$CHKPCE(TIUDA,.ORRCLST,$P(ORRD0,U,2),$P(ORRD12,U,11))
"RTN","ORRCTIU",87,0)
 M LST=ORRCLST
"RTN","ORRCTIU",88,0)
 D ASKPCE^ORWPCE2(.ORRCASK,DUZ,+$P(ORRD12,U,11))
"RTN","ORRCTIU",89,0)
 M ORASK=ORRCASK
"RTN","ORRCTIU",90,0)
 ; if Never or Disable, quit false
"RTN","ORRCTIU",91,0)
 I $S(ORASK=6:1,ORASK=7:1,1:0) S ORRY="false" G REQENCX
"RTN","ORRCTIU",92,0)
 ; if Always, quit true
"RTN","ORRCTIU",93,0)
 I ORASK=5 S ORRY="true" G REQENCX
"RTN","ORRCTIU",94,0)
 ; if Data Needed, quit true
"RTN","ORRCTIU",95,0)
 I ORASK=3,+DATANEED S ORRY="true" G REQENCX
"RTN","ORRCTIU",96,0)
 ; if Outpatient, quit true
"RTN","ORRCTIU",97,0)
 I ORASK=4,+ORROPT S ORRY="true" G REQENCX
"RTN","ORRCTIU",98,0)
 ; If we don't know who the primary encounter provider is, and we need to know, we
"RTN","ORRCTIU",99,0)
 ; must go to the chart to sign the note - so we treat it the same as if they are primary
"RTN","ORRCTIU",100,0)
 I ORRPRIMD=0 S ORRPRIME=1
"RTN","ORRCTIU",101,0)
 E  S ORRPRIME=+(DUZ=ORRPRIMD)
"RTN","ORRCTIU",102,0)
 ; if Primary/Data Needed, quit true
"RTN","ORRCTIU",103,0)
 I ORASK=0,ORRPRIME,+DATANEED S ORRY="true" G REQENCX
"RTN","ORRCTIU",104,0)
 ; if Primary/Outpatient, quit true
"RTN","ORRCTIU",105,0)
 I ORASK=1,ORRPRIME,+ORROPT S ORRY="true" G REQENCX
"RTN","ORRCTIU",106,0)
 ; if Primary Always, quit true
"RTN","ORRCTIU",107,0)
 I ORASK=2,ORRPRIME S ORRY="true" G REQENCX
"RTN","ORRCTIU",108,0)
REQENCX Q ORRY
"RTN","ORRCTIU",109,0)
 ;
"RTN","ORRCTIU",110,0)
CHKPCE(TIUDA,LST,PTNT,LOC)    ; Look for existing PCE data
"RTN","ORRCTIU",111,0)
 N ENCDT,ORI,CPT,COUNT,MAX,ICD,CODE,SUB,EXPNEED,EXP,RESULT,SCREQ,DOCPARM
"RTN","ORRCTIU",112,0)
 N ORRCSREQ,ORRCDOCP
"RTN","ORRCTIU",113,0)
 S (CPT,ICD,ORI,EXPNEED,EXP,RESULT,COUNT)=0
"RTN","ORRCTIU",114,0)
 S MAX=2
"RTN","ORRCTIU",115,0)
 S ENCDT=$P($P(LST(1),U,4),";",2)
"RTN","ORRCTIU",116,0)
 D SCSEL^ORWPCE(.ORRCSREQ,PTNT,ENCDT,LOC,"")
"RTN","ORRCTIU",117,0)
 M SCREQ=ORRCSREQ
"RTN","ORRCTIU",118,0)
 D DOCPARM^TIUSRVP1(.ORRCDOCP,TIUDA,0)
"RTN","ORRCTIU",119,0)
 M DOCPARM=ORRCDOCP
"RTN","ORRCTIU",120,0)
 I +$P(DOCPARM(0),U,15)=1 S EXPNEED=1,MAX=8
"RTN","ORRCTIU",121,0)
 F  S ORI=$O(LST(ORI)) Q:+ORI'>0  D  Q:(COUNT'<MAX)
"RTN","ORRCTIU",122,0)
 . S CODE=$P(LST(ORI),U)
"RTN","ORRCTIU",123,0)
 . I CODE="POV",'ICD S ICD=1,COUNT=COUNT+1
"RTN","ORRCTIU",124,0)
 . I CODE="CPT",'CPT S CPT=1,COUNT=COUNT+1
"RTN","ORRCTIU",125,0)
 . I EXPNEED,CODE="VST" D
"RTN","ORRCTIU",126,0)
 . . N VAL,IDX
"RTN","ORRCTIU",127,0)
 . . S SUB=$P(LST(ORI),U,2),VAL=$P(LST(ORI),U,3)
"RTN","ORRCTIU",128,0)
 . . S IDX=$S(SUB="SC":1,SUB="AO":2,SUB="IR":3,SUB="EC":4,SUB="MST":5,SUB="HNC":6,1:0)
"RTN","ORRCTIU",129,0)
 . . I IDX>0 S COUNT=COUNT+1 I VAL'="" S $P(SCREQ,";",IDX)=0
"RTN","ORRCTIU",130,0)
 I 'ICD Q 1
"RTN","ORRCTIU",131,0)
 I 'CPT Q 1
"RTN","ORRCTIU",132,0)
 F ORI=1:1:6 D  Q:RESULT=1
"RTN","ORRCTIU",133,0)
 . I $P($P(SCREQ,";",ORI),U,1) S RESULT=1
"RTN","ORRCTIU",134,0)
 Q RESULT
"RTN","ORRCTIU",135,0)
GETPRIMD(TIUDA,ORRD12,LST)    ; Get the Primary Provider
"RTN","ORRCTIU",136,0)
 N ORRY,ORI,ORMDEF,TIUSPRM,ORRCSPRM
"RTN","ORRCTIU",137,0)
 S (ORI,ORRY)=0
"RTN","ORRCTIU",138,0)
 D SITEPARM^TIUSRVP1(.ORRCSPRM) M TIUSPRM=ORRCSPRM
"RTN","ORRCTIU",139,0)
 ; 1. Check for the provider in the encounter, if it exists.
"RTN","ORRCTIU",140,0)
 F  S ORI=$O(LST(ORI)) Q:+ORI'>0  D  Q:+ORRY
"RTN","ORRCTIU",141,0)
 . I $P(LST(ORI),U)="PRV",+$P(LST(ORI),U,6) S ORRY=$P(LST(ORI),U,2)
"RTN","ORRCTIU",142,0)
 ; 2. check for the default primary as specified in TIU
"RTN","ORRCTIU",143,0)
 I 'ORRY D  ;DEFDOC^TIUSRVP1(.ORMDEF,$P(ORRD12,U,11),DUZ,$P(ORRD0,U,7),TIUDA) S ORRY=+ORMDEF
"RTN","ORRCTIU",144,0)
 . I +$P(TIUSPRM,U,8)=1 S ORRY=$$DFLTDOC^TIUPXAPI($P(ORRD12,U,11)) I +ORRY'=DUZ S ORRY=0
"RTN","ORRCTIU",145,0)
 Q ORRY
"RTN","ORRCTIU",146,0)
SIGN(ORY,LIST) ; -- Apply signature to documents in LIST(#)=DOC:##
"RTN","ORRCTIU",147,0)
 ; RPC = ORRC UNSIGNED DOCS SIGN
"RTN","ORRCTIU",148,0)
 Q
"VER")
8.0^22.0
"BLD",5401,6)
^3
**END**
**END**
