EMERGENCY Released DG*5.3*742 SEQ #668
Extracted from mail message
**KIDS**:DG*5.3*742^

**INSTALL NAME**
DG*5.3*742
"BLD",7005,0)
DG*5.3*742^REGISTRATION^0^3070713^y
"BLD",7005,1,0)
^^2^2^3070713^^
"BLD",7005,1,1,0)
Please see the national patch module for a description of the changes
"BLD",7005,1,2,0)
included in this patch.
"BLD",7005,4,0)
^9.64PA^^
"BLD",7005,6.3)
7
"BLD",7005,"ABPKG")
n
"BLD",7005,"INIT")

"BLD",7005,"KRN",0)
^9.67PA^8989.52^19
"BLD",7005,"KRN",.4,0)
.4
"BLD",7005,"KRN",.401,0)
.401
"BLD",7005,"KRN",.402,0)
.402
"BLD",7005,"KRN",.403,0)
.403
"BLD",7005,"KRN",.5,0)
.5
"BLD",7005,"KRN",.84,0)
.84
"BLD",7005,"KRN",3.6,0)
3.6
"BLD",7005,"KRN",3.8,0)
3.8
"BLD",7005,"KRN",9.2,0)
9.2
"BLD",7005,"KRN",9.8,0)
9.8
"BLD",7005,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7005,"KRN",9.8,"NM",1,0)
DGENUPL7^^0^B32019142
"BLD",7005,"KRN",9.8,"NM","B","DGENUPL7",1)

"BLD",7005,"KRN",19,0)
19
"BLD",7005,"KRN",19.1,0)
19.1
"BLD",7005,"KRN",101,0)
101
"BLD",7005,"KRN",409.61,0)
409.61
"BLD",7005,"KRN",771,0)
771
"BLD",7005,"KRN",870,0)
870
"BLD",7005,"KRN",8989.51,0)
8989.51
"BLD",7005,"KRN",8989.52,0)
8989.52
"BLD",7005,"KRN",8994,0)
8994
"BLD",7005,"KRN","B",.4,.4)

"BLD",7005,"KRN","B",.401,.401)

"BLD",7005,"KRN","B",.402,.402)

"BLD",7005,"KRN","B",.403,.403)

"BLD",7005,"KRN","B",.5,.5)

"BLD",7005,"KRN","B",.84,.84)

"BLD",7005,"KRN","B",3.6,3.6)

"BLD",7005,"KRN","B",3.8,3.8)

"BLD",7005,"KRN","B",9.2,9.2)

"BLD",7005,"KRN","B",9.8,9.8)

"BLD",7005,"KRN","B",19,19)

"BLD",7005,"KRN","B",19.1,19.1)

"BLD",7005,"KRN","B",101,101)

"BLD",7005,"KRN","B",409.61,409.61)

"BLD",7005,"KRN","B",771,771)

"BLD",7005,"KRN","B",870,870)

"BLD",7005,"KRN","B",8989.51,8989.51)

"BLD",7005,"KRN","B",8989.52,8989.52)

"BLD",7005,"KRN","B",8994,8994)

"BLD",7005,"QUES",0)
^9.62^^
"BLD",7005,"REQB",0)
^9.611^2^1
"BLD",7005,"REQB",2,0)
DG*5.3*653^2
"BLD",7005,"REQB","B","DG*5.3*653",2)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
742^3070713^539
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3070713
"PKG",5,22,1,"PAH",1,1,1,0)
Please see the national patch module for a description of the changes
"PKG",5,22,1,"PAH",1,1,2,0)
included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DGENUPL7")
0^1^B32019142^B29968061
"RTN","DGENUPL7",1,0)
DGENUPL7 ;ISA/KWP/CKN/TMK - PROCESS INCOMING (Z11 EVENT TYPE) HL7 MESSAGES ; 10/19/05
"RTN","DGENUPL7",2,0)
 ;;5.3;REGISTRATION;**232,367,397,417,379,431,513,628,673,653,742**;Aug 13,1993;Build 7
"RTN","DGENUPL7",3,0)
 ;Phase II split from DGENUPL
"RTN","DGENUPL7",4,0)
Z11(MSGIEN,MSGID,CURLINE,DFN,ERRCOUNT) ;
"RTN","DGENUPL7",5,0)
 ;Description:  This is used to process a single ORU~Z11 or ORF~Z11 msg. 
"RTN","DGENUPL7",6,0)
 ;Input:
"RTN","DGENUPL7",7,0)
 ;  MSGIEN - the internal entry number of the HL7 message in the
"RTN","DGENUPL7",8,0)
 ;      HL7 MESSAGE TEXT file (772)
"RTN","DGENUPL7",9,0)
 ;  MSGID -message control id of HL7 msg in the MSH segment
"RTN","DGENUPL7",10,0)
 ;  CURLINE - the subscript of the MSH segment of the current message (pass by reference)
"RTN","DGENUPL7",11,0)
 ;  DFN - identifies the patient, is the ien of a record in the PATIENT file.
"RTN","DGENUPL7",12,0)
 ;  ERRCOUNT - is a count of the number of messages in the batch that can not be processed (pass by reference)
"RTN","DGENUPL7",13,0)
 ;
"RTN","DGENUPL7",14,0)
 ;Output:
"RTN","DGENUPL7",15,0)
 ;  CURLINE - upon leaving the procedure this parameter should be set to the end of the current message. (pass by reference)
"RTN","DGENUPL7",16,0)
 ;  ERRCOUNT - set to count of messages that were not processed due to errors encountered  (pass by reference)
"RTN","DGENUPL7",17,0)
 ;
"RTN","DGENUPL7",18,0)
 N DGELG,DGENR,DGPAT,DGCDIS,DGOEIF,ERROR,ERRMSG,MSGS,DGELGSUB,DGENUPLD,DGCON
"RTN","DGENUPL7",19,0)
 N DGNEWVAL,DIV,SUB,OLDELG,OLDPAT,OLDDCDIS,OLDEIF,DGSEC,OLDSEC,DGNTR,DGMST,DGPHINC
"RTN","DGENUPL7",20,0)
 ;
"RTN","DGENUPL7",21,0)
 ;some process is killing these HL7 variables, so need to protect them
"RTN","DGENUPL7",22,0)
 S SUB=HLFS
"RTN","DGENUPL7",23,0)
 S DIV=HLECH
"RTN","DGENUPL7",24,0)
 N HLDA,HLDAN,HLDAP,HLDT,HLDT1,HLECH,HLFS,HLNDAP,HLNDAP0,HLPID,HLQ,HLVER,HLERR,HLMTN,HLSDT
"RTN","DGENUPL7",25,0)
 S HLFS=SUB
"RTN","DGENUPL7",26,0)
 S HLECH=DIV
"RTN","DGENUPL7",27,0)
 K DIV,SUB
"RTN","DGENUPL7",28,0)
 ;
"RTN","DGENUPL7",29,0)
 ;drops out of block on error
"RTN","DGENUPL7",30,0)
 D
"RTN","DGENUPL7",31,0)
 .Q:'$$PARSE^DGENUPL1(MSGIEN,MSGID,.CURLINE,.ERRCOUNT,.DGPAT,.DGELG,.DGENR,.DGCDIS,.DGOEIF,.DGSEC,.DGNTR,.DGMST)
"RTN","DGENUPL7",32,0)
 .D GETLOCKS^DGENUPL5(DFN)
"RTN","DGENUPL7",33,0)
 .;
"RTN","DGENUPL7",34,0)
 .;Used by cross-references to determine if an upload is in progress.
"RTN","DGENUPL7",35,0)
 .S DGENUPLD="ENROLLMENT/ELIGIBILITY UPLOAD IN PROGRESS"
"RTN","DGENUPL7",36,0)
 .;
"RTN","DGENUPL7",37,0)
 .;Update the PATIENT, ELIGIBILITY, CATASTROPHIC DISABILITY objects in memory
"RTN","DGENUPL7",38,0)
 .Q:'$$UOBJECTS^DGENUPL4(DFN,.DGPAT,.DGELG,.DGCDIS,.DGOEIF,MSGID,.ERRCOUNT,.MSGS,.OLDPAT,.OLDELG,.OLDCDIS,.OLDEIF)
"RTN","DGENUPL7",39,0)
 .S ERROR=0
"RTN","DGENUPL7",40,0)
 .;if the msg contains patient security, process it
"RTN","DGENUPL7",41,0)
 .I $D(DGSEC) D  Q:ERROR
"RTN","DGENUPL7",42,0)
 ..S DGSEC("DFN")=DFN
"RTN","DGENUPL7",43,0)
 ..S DGSEC("USER")=.5
"RTN","DGENUPL7",44,0)
 ..I DGSEC("LEVEL")'="" D
"RTN","DGENUPL7",45,0)
 ...I DGSEC("DATETIME")="" S DGSEC("DATETIME")=$$NOW^XLFDT ;DG*5.3*653 
"RTN","DGENUPL7",46,0)
 ..;
"RTN","DGENUPL7",47,0)
 ..; check consistency of patient security record
"RTN","DGENUPL7",48,0)
 ..I '$$CHECK^DGENSEC(.DGSEC,.ERRMSG) D  Q
"RTN","DGENUPL7",49,0)
 ...S ERROR=1
"RTN","DGENUPL7",50,0)
 ...D ADDERROR^DGENUPL(MSGID,DGPAT("SSN"),ERRMSG,.ERRCOUNT)
"RTN","DGENUPL7",51,0)
 ..;
"RTN","DGENUPL7",52,0)
 ..; upload patient security, consistency checks passed
"RTN","DGENUPL7",53,0)
 ..D SECUPLD^DGENUPL5(DFN,.DGSEC,.OLDSEC)
"RTN","DGENUPL7",54,0)
 .;
"RTN","DGENUPL7",55,0)
 .;if the msg has an enrollment process it
"RTN","DGENUPL7",56,0)
 .I DGENR("STATUS")!DGENR("APP") D  Q:ERROR
"RTN","DGENUPL7",57,0)
 ..;use $$PRIORITY to get the eligibility data used to compute priority
"RTN","DGENUPL7",58,0)
 ..I $$PRIORITY^DGENELA4(DFN,.DGELG,.DGELGSUB,DGENR("DATE"),DGENR("APP"))
"RTN","DGENUPL7",59,0)
 ..;
"RTN","DGENUPL7",60,0)
 ..;store the eligibility data in the enrollment record and other missing fields
"RTN","DGENUPL7",61,0)
 ..M DGENR("ELIG")=DGELGSUB
"RTN","DGENUPL7",62,0)
 ..S DGENR("DFN")=DFN
"RTN","DGENUPL7",63,0)
 ..S DGENR("PRIORREC")=""
"RTN","DGENUPL7",64,0)
 ..S DGENR("USER")=.5
"RTN","DGENUPL7",65,0)
 ..S DGENR("DATETIME")=$$NOW^XLFDT
"RTN","DGENUPL7",66,0)
 ..;
"RTN","DGENUPL7",67,0)
 ..;Allow null overwrites of Ineligible data (Ineligible Project):
"RTN","DGENUPL7",68,0)
 ..I $D(DGENR("DATE")),DGENR("DATE")="" S DGENR("DATE")="@"
"RTN","DGENUPL7",69,0)
 ..I $D(DGENR("FACREC")),DGENR("FACREC")="" S DGENR("FACREC")="@"
"RTN","DGENUPL7",70,0)
 ..;
"RTN","DGENUPL7",71,0)
 ..;check the consistency of the enrollment record
"RTN","DGENUPL7",72,0)
 ..I '$$CHECK^DGENA3(.DGENR,.DGPAT,.ERRMSG) D  Q
"RTN","DGENUPL7",73,0)
 ...S ERROR=1
"RTN","DGENUPL7",74,0)
 ...D ADDERROR^DGENUPL(MSGID,DGPAT("SSN"),ERRMSG,.ERRCOUNT)
"RTN","DGENUPL7",75,0)
 ..;
"RTN","DGENUPL7",76,0)
 ..; removed EGT consistency check with DG*5.3*628
"RTN","DGENUPL7",77,0)
 ..;Phase II EGT consistency checks (SRS 6.5.1.3)
"RTN","DGENUPL7",78,0)
 ..;Only do the EGT consistency checks for Rejected-Fiscal Year (11),Rejected-Mid Cycle (12),Rejected-Stop enrolling new apps (13),Rejected-Initil App by VAMC (14),Rejected below EGT threshold (22)
"RTN","DGENUPL7",79,0)
 ..;I "^11^12^13^14^22^"[("^"_DGENR("STATUS")_"^"),$$ABOVE^DGENEGT1(DGENR("DFN"),DGENR("PRIORITY"),DGENR("SUBGRP"),"","",1) D  Q
"RTN","DGENUPL7",80,0)
 ..;.S ERROR=1
"RTN","DGENUPL7",81,0)
 ..;.S ERRMSG="THE ENROLLMENT RECORD DID NOT PASS THE EGT CONSISTENCY CHECKS."
"RTN","DGENUPL7",82,0)
 ..;.D ADDERROR^DGENUPL(MSGID,DGPAT("SSN"),ERRMSG,.ERRCOUNT)
"RTN","DGENUPL7",83,0)
 ..;
"RTN","DGENUPL7",84,0)
 ..;Allow null overwrites for Ineligible vets (Ineligible Project):
"RTN","DGENUPL7",85,0)
 ..I $G(DGPAT("INELDATE"))'="" S (DGENR("PRIORITY"),DGENR("SUBGRP"))=""
"RTN","DGENUPL7",86,0)
 ..I DGENR("DATE")="@" S DGENR("DATE")=""
"RTN","DGENUPL7",87,0)
 ..I DGENR("FACREC")="@" S DGENR("FACREC")=""
"RTN","DGENUPL7",88,0)
 ..;
"RTN","DGENUPL7",89,0)
 ..D ENRUPLD^DGENUPL8(.DGENR,.DGPAT)
"RTN","DGENUPL7",90,0)
 .;
"RTN","DGENUPL7",91,0)
 .;Store the PATIENT, ELIGIBILITY, & CAT. DISB. objects
"RTN","DGENUPL7",92,0)
 .I $$STORE^DGENPTA1(.DGPAT,,1)
"RTN","DGENUPL7",93,0)
 .I $$STORE^DGENELA1(.DGELG,.DGPAT,.DGCDIS,,1)
"RTN","DGENUPL7",94,0)
 .I $G(DGCDIS("VCD"))'="",$$STORE^DGENCDA2(DFN,.DGCDIS) ;checks first if there is catastrophic disability information
"RTN","DGENUPL7",95,0)
 .;
"RTN","DGENUPL7",96,0)
 .;Call PIMS api to file NTR data.
"RTN","DGENUPL7",97,0)
 .I $D(DGNTR),$$ENRUPD^DGNTAPI1(DFN,.DGNTR)
"RTN","DGENUPL7",98,0)
 .;
"RTN","DGENUPL7",99,0)
 .;Call PIMS api to file MST data.
"RTN","DGENUPL7",100,0)
 .I DGMST("MSTSTAT")'="",DGMST("MSTDT")'="",DGMST("MSTST")'="" D
"RTN","DGENUPL7",101,0)
 ..I $$NEWSTAT^DGMSTAPI(DFN,DGMST("MSTSTAT"),DGMST("MSTDT"),".5",DGMST("MSTST"),0)
"RTN","DGENUPL7",102,0)
 .;
"RTN","DGENUPL7",103,0)
 .;Since HEC is authoritative source, If no OEF/OIF data in Z11, set count to 0 so existing data in VistA will be deleted.
"RTN","DGENUPL7",104,0)
 .I '$D(DGOEIF) S DGOEIF("COUNT")=0
"RTN","DGENUPL7",105,0)
 .;Call PIMS api to file OEF/OIF data.
"RTN","DGENUPL7",106,0)
 .I $D(DGOEIF) D OEIFUPD^DGCLAPI1(DFN,.DGOEIF)
"RTN","DGENUPL7",107,0)
 .;
"RTN","DGENUPL7",108,0)
 .;if the current enrollment is a local then log patient for transmission
"RTN","DGENUPL7",109,0)
 .I $$SOURCE^DGENA(DFN)=1!$G(DGPHINC) K DGENUPLD,DGPHINC D EVENT^IVMPLOG(DFN)
"RTN","DGENUPL7",110,0)
 .;
"RTN","DGENUPL7",111,0)
 .;create the audit trail
"RTN","DGENUPL7",112,0)
 .I $$AUDIT^DGENUPA1(,MSGID,.OLDPAT,.DGPAT,.OLDELG,.DGELG,.OLDCDIS,.DGCDIS,.DGSEC,.OLDSEC)
"RTN","DGENUPL7",113,0)
 .;send notifications
"RTN","DGENUPL7",114,0)
 .D NOTIFY^DGENUPL3(.DGPAT,.MSGS)
"RTN","DGENUPL7",115,0)
 .;
"RTN","DGENUPL7",116,0)
 .;invoke registration consistency checker
"RTN","DGENUPL7",117,0)
 .D REGCHECK^DGENUPL2(DFN)
"RTN","DGENUPL7",118,0)
 ;
"RTN","DGENUPL7",119,0)
 D UNLOCK^DGENUPL5(DFN)
"RTN","DGENUPL7",120,0)
 Q
"VER")
8.0^22.0
"BLD",7005,6)
^668
**END**
**END**
