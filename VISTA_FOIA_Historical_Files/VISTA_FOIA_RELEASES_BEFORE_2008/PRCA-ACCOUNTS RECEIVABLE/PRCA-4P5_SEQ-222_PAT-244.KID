Released PRCA*4.5*244 SEQ #222
Extracted from mail message
**KIDS**:PRCA*4.5*244^

**INSTALL NAME**
PRCA*4.5*244
"BLD",6705,0)
PRCA*4.5*244^ACCOUNTS RECEIVABLE^0^3060418^y
"BLD",6705,1,0)
^^11^11^3060417^
"BLD",6705,1,1,0)
This patch addresses 4 issues. The first issue is that site requested to
"BLD",6705,1,2,0)
limit the credit card number which is printed on the patient's receipt
"BLD",6705,1,3,0)
for security issue. The second issue is about the software that calculates
"BLD",6705,1,4,0)
an estimate for what a patient will be charged for prescriptions that are
"BLD",6705,1,5,0)
awaiting release was not updated to correctly reflect the new $8 copay
"BLD",6705,1,6,0)
amount.
"BLD",6705,1,7,0)
 
"BLD",6705,1,8,0)
The third issue indicates an undefined error that site received when they
"BLD",6705,1,9,0)
queued the report to P-MESSAGE in the EFT Deposit Reconciliation Report.
"BLD",6705,1,10,0)
The fourth issue contains the same error occurring in the same report 
"BLD",6705,1,11,0)
above when site queued the report to a spool.
"BLD",6705,4,0)
^9.64PA^^
"BLD",6705,"KRN",0)
^9.67PA^8989.52^19
"BLD",6705,"KRN",.4,0)
.4
"BLD",6705,"KRN",.401,0)
.401
"BLD",6705,"KRN",.402,0)
.402
"BLD",6705,"KRN",.403,0)
.403
"BLD",6705,"KRN",.5,0)
.5
"BLD",6705,"KRN",.84,0)
.84
"BLD",6705,"KRN",3.6,0)
3.6
"BLD",6705,"KRN",3.8,0)
3.8
"BLD",6705,"KRN",9.2,0)
9.2
"BLD",6705,"KRN",9.8,0)
9.8
"BLD",6705,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6705,"KRN",9.8,"NM",1,0)
RCDPEREC^^0^B37452848
"BLD",6705,"KRN",9.8,"NM",2,0)
RCDPRECT^^0^B18445207
"BLD",6705,"KRN",9.8,"NM",3,0)
RCDPURED^^0^B33715585
"BLD",6705,"KRN",9.8,"NM","B","RCDPEREC",1)

"BLD",6705,"KRN",9.8,"NM","B","RCDPRECT",2)

"BLD",6705,"KRN",9.8,"NM","B","RCDPURED",3)

"BLD",6705,"KRN",19,0)
19
"BLD",6705,"KRN",19.1,0)
19.1
"BLD",6705,"KRN",101,0)
101
"BLD",6705,"KRN",409.61,0)
409.61
"BLD",6705,"KRN",771,0)
771
"BLD",6705,"KRN",870,0)
870
"BLD",6705,"KRN",8989.51,0)
8989.51
"BLD",6705,"KRN",8989.52,0)
8989.52
"BLD",6705,"KRN",8994,0)
8994
"BLD",6705,"KRN","B",.4,.4)

"BLD",6705,"KRN","B",.401,.401)

"BLD",6705,"KRN","B",.402,.402)

"BLD",6705,"KRN","B",.403,.403)

"BLD",6705,"KRN","B",.5,.5)

"BLD",6705,"KRN","B",.84,.84)

"BLD",6705,"KRN","B",3.6,3.6)

"BLD",6705,"KRN","B",3.8,3.8)

"BLD",6705,"KRN","B",9.2,9.2)

"BLD",6705,"KRN","B",9.8,9.8)

"BLD",6705,"KRN","B",19,19)

"BLD",6705,"KRN","B",19.1,19.1)

"BLD",6705,"KRN","B",101,101)

"BLD",6705,"KRN","B",409.61,409.61)

"BLD",6705,"KRN","B",771,771)

"BLD",6705,"KRN","B",870,870)

"BLD",6705,"KRN","B",8989.51,8989.51)

"BLD",6705,"KRN","B",8989.52,8989.52)

"BLD",6705,"KRN","B",8994,8994)

"BLD",6705,"QUES",0)
^9.62^^
"BLD",6705,"REQB",0)
^9.611^3^3
"BLD",6705,"REQB",1,0)
PRCA*4.5*202^2
"BLD",6705,"REQB",2,0)
PRCA*4.5*217^2
"BLD",6705,"REQB",3,0)
PRCA*4.5*208^2
"BLD",6705,"REQB","B","PRCA*4.5*202",1)

"BLD",6705,"REQB","B","PRCA*4.5*208",3)

"BLD",6705,"REQB","B","PRCA*4.5*217",2)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
244^3060418
"PKG",142,22,1,"PAH",1,1,0)
^^11^11^3060418
"PKG",142,22,1,"PAH",1,1,1,0)
This patch addresses 4 issues. The first issue is that site requested to
"PKG",142,22,1,"PAH",1,1,2,0)
limit the credit card number which is printed on the patient's receipt
"PKG",142,22,1,"PAH",1,1,3,0)
for security issue. The second issue is about the software that calculates
"PKG",142,22,1,"PAH",1,1,4,0)
an estimate for what a patient will be charged for prescriptions that are
"PKG",142,22,1,"PAH",1,1,5,0)
awaiting release was not updated to correctly reflect the new $8 copay
"PKG",142,22,1,"PAH",1,1,6,0)
amount.
"PKG",142,22,1,"PAH",1,1,7,0)
 
"PKG",142,22,1,"PAH",1,1,8,0)
The third issue indicates an undefined error that site received when they
"PKG",142,22,1,"PAH",1,1,9,0)
queued the report to P-MESSAGE in the EFT Deposit Reconciliation Report.
"PKG",142,22,1,"PAH",1,1,10,0)
The fourth issue contains the same error occurring in the same report 
"PKG",142,22,1,"PAH",1,1,11,0)
above when site queued the report to a spool.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RCDPEREC")
0^1^B37452848^B37254915
"RTN","RCDPEREC",1,0)
RCDPEREC ;ALB/TMK - RECONCILIATION REPORT FOR EDI LOCKBOX FMS DOCS  ;19-APR-2004
"RTN","RCDPEREC",2,0)
 ;;4.5;Accounts Receivable;**208,244**;Mar 20, 1995
"RTN","RCDPEREC",3,0)
 ;
"RTN","RCDPEREC",4,0)
EN ; Entrypoint for producing the report
"RTN","RCDPEREC",5,0)
 N RCDDT,RCSEL,ZTRTN,ZTDESC,ZTSAVE,ZTSK,%ZIS,POP,DIR,DTOUT,DUOUT
"RTN","RCDPEREC",6,0)
 S DIR(0)="DA^3000101:"_DT_":AEPX",DIR("A")="SELECT THE EFT DEPOSIT DATE TO START WITH: " W ! D ^DIR K DIR
"RTN","RCDPEREC",7,0)
 S RCDDT=$S($D(DTOUT)!$D(DUOUT):"",1:Y)
"RTN","RCDPEREC",8,0)
 Q:'RCDDT
"RTN","RCDPEREC",9,0)
 S DIR("B")="ALL"
"RTN","RCDPEREC",10,0)
 S DIR(0)="SA^A:ALL;N:NOT FULLY TRANSFERRED",DIR("A")="DO YOU WANT (A)LL DEPOSITS OR ONLY THOSE (N)OT FULLY TRANSFERRED?: " W ! D ^DIR K DIR
"RTN","RCDPEREC",11,0)
 S RCSEL=$S($D(DTOUT)!$D(DUOUT):"",1:Y)
"RTN","RCDPEREC",12,0)
 Q:RCSEL=""
"RTN","RCDPEREC",13,0)
 W !
"RTN","RCDPEREC",14,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCDPEREC",15,0)
 I $D(IO("Q")) D  Q
"RTN","RCDPEREC",16,0)
 . S ZTRTN="ENQUE^RCDPEREC",ZTDESC="AR - CR/TR RELATED DOCUMENTS FOR e-PAYMENTS"
"RTN","RCDPEREC",17,0)
 . S ZTSAVE("RCDDT")="",ZTSAVE("RCSEL")=""
"RTN","RCDPEREC",18,0)
 . D ^%ZTLOAD
"RTN","RCDPEREC",19,0)
 . W !!,$S($D(ZTSK):"Your task number"_ZTSK_" has been queued.",1:"Unable to queue this job.")
"RTN","RCDPEREC",20,0)
 . K ZTSK,IO("Q") D HOME^%ZIS
"RTN","RCDPEREC",21,0)
 U IO
"RTN","RCDPEREC",22,0)
 D ENQUE
"RTN","RCDPEREC",23,0)
 Q
"RTN","RCDPEREC",24,0)
 ;
"RTN","RCDPEREC",25,0)
ENQUE ; Queued entrypoint for the report
"RTN","RCDPEREC",26,0)
 ; RCDDT = starting EFT deposit date
"RTN","RCDPEREC",27,0)
 ; RCSEL = 'A' if all deposits included ... 'N' if only those not fully
"RTN","RCDPEREC",28,0)
 ;         transferred out of 8NZZ
"RTN","RCDPEREC",29,0)
 ;
"RTN","RCDPEREC",30,0)
 N Z,Z0,RCSTOP,RCD,RCR,RCSTAT,RCDEP,RCEFT,RCEFT1,RCT,RC0,RC00,RC000,RCTOT,RCTOT1,RCTRANS
"RTN","RCDPEREC",31,0)
 K ^TMP($J,"RCDEP")
"RTN","RCDPEREC",32,0)
 ;
"RTN","RCDPEREC",33,0)
 S (RCSTOP,RCT)=0,RCDDT=RCDDT-.1
"RTN","RCDPEREC",34,0)
 F  S RCDDT=$O(^RCY(344.3,"ADEP",RCDDT)) Q:'RCDDT!RCSTOP  S RCDEP=0 F  S RCDEP=$O(^RCY(344.3,"ADEP",RCDDT,RCDEP)) Q:'RCDEP  S RCEFT=0 F  S RCEFT=$O(^RCY(344.3,"ADEP",RCDDT,RCDEP,RCEFT)) Q:'RCEFT!RCSTOP  D
"RTN","RCDPEREC",35,0)
 . S RCTOT=0,RC0=$G(^RCY(344.3,RCEFT,0))
"RTN","RCDPEREC",36,0)
 . S RCD=$E(RCDDT_$J("",8),1,8)_RCDEP
"RTN","RCDPEREC",37,0)
 . S RCEFT1=0 F  S RCEFT1=$O(^RCY(344.31,"B",RCEFT,RCEFT1)) Q:'RCEFT1!RCSTOP  S RC00=$G(^RCY(344.31,RCEFT1,0)) D
"RTN","RCDPEREC",38,0)
 .. ;
"RTN","RCDPEREC",39,0)
 .. I $D(ZTQUEUED) S RCT=RCT+1 I '(RCT#100),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q
"RTN","RCDPEREC",40,0)
 .. ;
"RTN","RCDPEREC",41,0)
 .. I '$D(^TMP($J,"RCDEP",RCD)) S ^TMP($J,"RCDEP",RCD)=$P(RC0,U,6,11),^TMP($J,"RCDEP",RCD,0)=$S($P(RC00,U,9):$$FMSSTAT^RCDPUREC($P(RC00,U,9)),1:"NO CR DOCUMENT"),^TMP($J,"RCDEP",RCD,"EFT")=RCEFT
"RTN","RCDPEREC",42,0)
 .. S RCTRANS=+$P(RC00,U,14) S:'RCTRANS RCTRANS=1
"RTN","RCDPEREC",43,0)
 .. ;
"RTN","RCDPEREC",44,0)
 .. I '$P(RC00,U,8) S ^TMP($J,"RCDEP",RCD,RCTRANS,"RCUNM")=RCEFT1 Q  ; Not matched
"RTN","RCDPEREC",45,0)
 .. ;
"RTN","RCDPEREC",46,0)
 .. I '$O(^RCY(344,"AEFT",RCEFT1,0)) D  Q  ; No receipt
"RTN","RCDPEREC",47,0)
 ... I $P(RC00,U,16)'="" D  Q  ; EFT detail entered on-line
"RTN","RCDPEREC",48,0)
 .... S ^TMP($J,"RCDEP",RCD,RCTRANS)=RCEFT1_U_"ENTERED ON-LINE"_U_$S($P(RC000,U,18):"ERA #"_$P($G(^RCY(344.4,+$P(RC00,U,10),0)),U),1:"PAPER EOB")_U_$P(RC00,U,16)_U_"NO RECEIPT",RCTOT=RCTOT+$P(RC00,U,7)
"RTN","RCDPEREC",49,0)
 ... S ^TMP($J,"RCDEP",RCD,RCTRANS)=RCEFT1_U_"NO TR DOC"_U_$S($P(RC00,U,10):"ERA #"_$P($G(^RCY(344.4,+$P(RC00,U,10),0)),U),1:"PAPER EOB")_"^^NO RECEIPT"
"RTN","RCDPEREC",50,0)
 .. ;
"RTN","RCDPEREC",51,0)
 .. S RCR=0 F  S RCR=$O(^RCY(344,"AEFT",RCEFT1,RCR)) Q:'RCR  S RC000=$G(^RCY(344,RCR,0)) D
"RTN","RCDPEREC",52,0)
 ... S RCTOT=RCTOT+$$PAYTOTAL^RCDPURED(RCR)
"RTN","RCDPEREC",53,0)
 ... S RCSTAT=$$FMSSTAT^RCDPUREC(RCR) S:$P(RCSTAT,U)="" RCSTAT="NO TR DOC"
"RTN","RCDPEREC",54,0)
 ... S ^TMP($J,"RCDEP",RCD,RCTRANS)=RCEFT1_U_$P(RCSTAT,U)_U_$S($P(RC000,U,18):"ERA #"_$P($G(^RCY(344.4,+$P(RC000,U,18),0)),U),1:"PAPER EOB")_U_$P(RCSTAT,U,2)_U_RCR
"RTN","RCDPEREC",55,0)
 . Q:RCSTOP
"RTN","RCDPEREC",56,0)
 . I RCSEL="N",+RCTOT=+$P(RC0,U,8) K ^TMP($J,"RCDEP",RCD) Q
"RTN","RCDPEREC",57,0)
 . S ^TMP($J,"RCDEP",RCD,"TOT")=RCTOT_U_$P(RC0,U,8)
"RTN","RCDPEREC",58,0)
 ;
"RTN","RCDPEREC",59,0)
 ; Output the report
"RTN","RCDPEREC",60,0)
 S RCD="",RCPG=0
"RTN","RCDPEREC",61,0)
 I RCSTOP K ^TMP($J,"RCDEP")
"RTN","RCDPEREC",62,0)
 F  S RCD=$O(^TMP($J,"RCDEP",RCD)) Q:RCD=""!RCSTOP  D  Q:RCSTOP  D TOT(RCD,.RCSTOP,.RCPG)
"RTN","RCDPEREC",63,0)
 . S RC0=$G(^TMP($J,"RCDEP",RCD)) D EFTDEP(RCD,.RCSTOP,.RCPG) ; EFT dep
"RTN","RCDPEREC",64,0)
 . Q:RCSTOP
"RTN","RCDPEREC",65,0)
 . S RCTRANS=0 F  S RCTRANS=$O(^TMP($J,"RCDEP",RCD,RCTRANS)) Q:'RCTRANS!RCSTOP  S RC00=$G(^(RCTRANS)) D  ; EFT detail deposits
"RTN","RCDPEREC",66,0)
 .. S RCSTOP=$$NEWPG(.RCPG) Q:RCSTOP
"RTN","RCDPEREC",67,0)
 .. I RC00="",$D(^TMP($J,"RCDEP",RCD,RCTRANS,"RCUNM")) S Z=$G(^("RCUNM")) D  Q  ; Unmatched
"RTN","RCDPEREC",68,0)
 ... W !,?3,$J("",6),"  UNMATCHED   ",$E($P(Z,U,2)_$J("",30),1,30)_"  "_$E($P(Z,U,3)_$J("",20),1,20)
"RTN","RCDPEREC",69,0)
 ... W !,?13,$P(Z,U,4)
"RTN","RCDPEREC",70,0)
 .. ;
"RTN","RCDPEREC",71,0)
 .. I RC00="" W !,?3,"ERROR IN EFT DETAIL LINE #: ",RCTRANS Q  ; Error
"RTN","RCDPEREC",72,0)
 .. ;
"RTN","RCDPEREC",73,0)
 .. S Z=$G(^RCY(344.31,+RC00,0))
"RTN","RCDPEREC",74,0)
 .. W !,?3,$E(+RC00_$J("",6),1,6)_"  "_$E($P(RC00,U,3)_$J("",10),1,10)_"  "_$E($P(Z,U,2)_$J("",30),1,30)_"  "_$E($P(Z,U,3)_$J("",20),1,20)
"RTN","RCDPEREC",75,0)
 .. W !,?13,$E($P(Z,U,4)_$J("",30),1,30)_"  "_$E($P(RC00,U,5)_$J("",10),1,10),!,?15,$E($P(RC00,U,2)_$J("",10),1,10)_"  "_$E($P(RC00,U,4)_$J("",15),1,15)
"RTN","RCDPEREC",76,0)
 ;
"RTN","RCDPEREC",77,0)
 I 'RCSTOP,RCPG D ASK(.RCSTOP)
"RTN","RCDPEREC",78,0)
 ;
"RTN","RCDPEREC",79,0)
 I $D(ZTQUEUED) D
"RTN","RCDPEREC",80,0)
 . I $G(RCSTOP) D HDR1(0) W !,"TASK STOPPED BY USER" Q
"RTN","RCDPEREC",81,0)
 . S ZTREQ="@"
"RTN","RCDPEREC",82,0)
 I '$D(ZTQUEUED) D ^%ZISC
"RTN","RCDPEREC",83,0)
 K ^TMP($J,"RCDEP")
"RTN","RCDPEREC",84,0)
 Q
"RTN","RCDPEREC",85,0)
 ;
"RTN","RCDPEREC",86,0)
EFTDEP(RCD,RCSTOP,RCPG) ;
"RTN","RCDPEREC",87,0)
 ; RCD = deposit date (FM) concatenated with the deposit #
"RTN","RCDPEREC",88,0)
 N Z,Z0
"RTN","RCDPEREC",89,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S (RCSTOP,ZTSTOP)=1 K ZTREQ Q
"RTN","RCDPEREC",90,0)
 S Z=$G(^TMP($J,"RCDEP",RCD)),Z0=$G(^(RCD,0))
"RTN","RCDPEREC",91,0)
 S RCSTOP=$$NEWPG(.RCPG) Q:RCSTOP
"RTN","RCDPEREC",92,0)
 I $Y+7>IOSL W !! S RCSTOP=$$NEWPG(.RCPG) Q:RCSTOP
"RTN","RCDPEREC",93,0)
 W:'$P(RCPG,U,2) !!
"RTN","RCDPEREC",94,0)
 W !,$E($$FMTE^XLFDT($P(Z,U,2),"2D")_$J("",8),1,8),"  ",$E(+$G(^TMP($J,"RCDEP",RCD,"EFT"))_$J("",6),1,6),"  ",$E($P(Z,U)_$J("",6),1,6),"  ",$J($P(Z,U,3),13,2),"  ",$E($S($P(Z,U,6):$$FMTE^XLFDT($P(Z,U,6),"2D"),1:"UNPOSTED")_$J("",8),1,8)
"RTN","RCDPEREC",95,0)
 W !,?5,$E($P(Z0,U)_$J("",20),1,20),"  ",$P(Z0,U,2)
"RTN","RCDPEREC",96,0)
 Q
"RTN","RCDPEREC",97,0)
 ;
"RTN","RCDPEREC",98,0)
TOT(RCD,RCSTOP,RCPG) ; Output the total lines for the deposit
"RTN","RCDPEREC",99,0)
 S RCSTOP=$$NEWPG(.RCPG) Q:RCSTOP
"RTN","RCDPEREC",100,0)
 W !,$J("",26),"TOTAL AMOUNT SENT VIA 'TR' DOCUMENTS: ",$J($G(^TMP($J,"RCDEP",RCD,"TOT")),15,2)
"RTN","RCDPEREC",101,0)
 W !,$J("",26),"TOTAL AMOUNT STILL TO BE TRANSFERRED: ",$J($P($G(^TMP($J,"RCDEP",RCD,"TOT")),U,2)-$G(^TMP($J,"RCD",RCD,"TOT")),15,2)
"RTN","RCDPEREC",102,0)
 Q
"RTN","RCDPEREC",103,0)
 ;
"RTN","RCDPEREC",104,0)
NEWPG(RCPG) ; Check for new page needed, output header
"RTN","RCDPEREC",105,0)
 ; Function returns 1 if user chooses to stop output
"RTN","RCDPEREC",106,0)
 N RCX,RCZ
"RTN","RCDPEREC",107,0)
 S RCZ=0,RCX=$P(RCPG,U,2)
"RTN","RCDPEREC",108,0)
 I 'RCPG!(($Y+5)>IOSL) D
"RTN","RCDPEREC",109,0)
 . D:RCPG ASK(.RCZ) I RCZ Q
"RTN","RCDPEREC",110,0)
 . D HDR1(.RCPG)
"RTN","RCDPEREC",111,0)
 I RCX S $P(RCPG,U,2)=0
"RTN","RCDPEREC",112,0)
 Q RCZ
"RTN","RCDPEREC",113,0)
 ;
"RTN","RCDPEREC",114,0)
SELECT() ; Select first deposit #
"RTN","RCDPEREC",115,0)
 ; Function returns values selected for first deposit #
"RTN","RCDPEREC",116,0)
 ;
"RTN","RCDPEREC",117,0)
 N DIR,X,Y,DTOUT,DUOUT
"RTN","RCDPEREC",118,0)
 ;
"RTN","RCDPEREC",119,0)
HDR1(RCPG) ;Print report hdr
"RTN","RCDPEREC",120,0)
 ; RCPG = last page #^0/1 for top of page indicator
"RTN","RCDPEREC",121,0)
 N Z,Z0,X
"RTN","RCDPEREC",122,0)
 I RCPG!($E(IOST,1,2)="C-") W @IOF,*13
"RTN","RCDPEREC",123,0)
 S RCPG=$G(RCPG)+1_U_1
"RTN","RCDPEREC",124,0)
 W !,"EDI LOCKBOX FUND 5287.4/8NZZ RECONCILIATION REPORT",?55,$$FMTE^XLFDT(DT,2),?70,"Page: ",+RCPG
"RTN","RCDPEREC",125,0)
 W !!,"DEP DATE  ENTRY#  DEP #   TOTAL DEP AMT  POST DT   RECEIPT #",!,?5,"CR DOCUMENT           CR DOC STATUS"
"RTN","RCDPEREC",126,0)
 W !,?3,"EFT #   MATCHED TO  PAYER NAME                      PAYER ID            ",!,?13,"TRACE #                         RECEIPT #"
"RTN","RCDPEREC",127,0)
 W !,?15,"TR DOCUMENT           TR DOC STATUS"
"RTN","RCDPEREC",128,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","RCDPEREC",129,0)
 Q
"RTN","RCDPEREC",130,0)
 ;
"RTN","RCDPEREC",131,0)
ASK(RCSTOP) ;
"RTN","RCDPEREC",132,0)
 I $E(IOST,1,2)'["C-" Q
"RTN","RCDPEREC",133,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RCDPEREC",134,0)
 S DIR(0)="E" W ! D ^DIR
"RTN","RCDPEREC",135,0)
 I ($D(DIRUT))!($D(DUOUT)) S RCSTOP=1 Q
"RTN","RCDPEREC",136,0)
 Q
"RTN","RCDPEREC",137,0)
 ;
"RTN","RCDPRECT")
0^2^B18445207^B17904044
"RTN","RCDPRECT",1,0)
RCDPRECT ;WISC/RFJ-print a receipt ;1 Jun 99
"RTN","RCDPRECT",2,0)
 ;;4.5;Accounts Receivable;**114,148,217,244**;Mar 20, 1995
"RTN","RCDPRECT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPRECT",4,0)
 Q
"RTN","RCDPRECT",5,0)
 ;
"RTN","RCDPRECT",6,0)
 ;
"RTN","RCDPRECT",7,0)
RECEIPT(RCRECTDA,RCTRANDA) ;  control printing of receipt for device selection
"RTN","RCDPRECT",8,0)
 N %,IOP,PRINT
"RTN","RCDPRECT",9,0)
 S PRINT=$$OPTCK^RCDPRPL2("RECEIPT",2)_"^"_$$OPTCK^RCDPRPL2("RECEIPT",3)
"RTN","RCDPRECT",10,0)
 ;  if not defined by user, ask for the device
"RTN","RCDPRECT",11,0)
 I PRINT="" S PRINT=2
"RTN","RCDPRECT",12,0)
 ;
"RTN","RCDPRECT",13,0)
 ;  never print receipt
"RTN","RCDPRECT",14,0)
 I $P(PRINT,"^")=0 Q
"RTN","RCDPRECT",15,0)
 ;
"RTN","RCDPRECT",16,0)
 ;  always print receipt to default device
"RTN","RCDPRECT",17,0)
 I $P(PRINT,"^")=1 D
"RTN","RCDPRECT",18,0)
 .   ;  test device without opening it
"RTN","RCDPRECT",19,0)
 .   S IOP=$P(PRINT,"^",2) I IOP="" S PRINT=2 Q
"RTN","RCDPRECT",20,0)
 .   S %ZIS="N"
"RTN","RCDPRECT",21,0)
 .   D ^%ZIS I POP S PRINT=2 Q
"RTN","RCDPRECT",22,0)
 .   D QUEUEIT
"RTN","RCDPRECT",23,0)
 ;
"RTN","RCDPRECT",24,0)
 ;  ask to print receipt
"RTN","RCDPRECT",25,0)
 I $P(PRINT,"^")=2 S %=$$DEVICE
"RTN","RCDPRECT",26,0)
 Q
"RTN","RCDPRECT",27,0)
 ;
"RTN","RCDPRECT",28,0)
 ;
"RTN","RCDPRECT",29,0)
DEVICE() ;  select the device and print receipt
"RTN","RCDPRECT",30,0)
 ;  returns 0 if not successful
"RTN","RCDPRECT",31,0)
 S %ZIS("A")="Print Receipt on DEVICE: "
"RTN","RCDPRECT",32,0)
 S %ZIS("B")=$$OPTCK^RCDPRPL2("RECEIPT",3)
"RTN","RCDPRECT",33,0)
 S %ZIS="Q"
"RTN","RCDPRECT",34,0)
 W ! D ^%ZIS
"RTN","RCDPRECT",35,0)
 I POP D ^%ZISC Q 0
"RTN","RCDPRECT",36,0)
 I $D(IO("Q")) D QUEUEIT Q "Print Receipt Queued"
"RTN","RCDPRECT",37,0)
 D PRINT
"RTN","RCDPRECT",38,0)
 Q "Receipt Printed"
"RTN","RCDPRECT",39,0)
 ;
"RTN","RCDPRECT",40,0)
 ;
"RTN","RCDPRECT",41,0)
QUEUEIT ;  queue printing receipt
"RTN","RCDPRECT",42,0)
 N ZTSK
"RTN","RCDPRECT",43,0)
 S ZTDTH=$H,ZTDESC="Print Payment Receipt",ZTRTN="PRINT^RCDPRECT"
"RTN","RCDPRECT",44,0)
 S ZTSAVE("RCRECTDA")="",ZTSAVE("RCTRANDA")="",ZTSAVE("ZTREQ")="@"
"RTN","RCDPRECT",45,0)
 D ^%ZTLOAD
"RTN","RCDPRECT",46,0)
 D ^%ZISC
"RTN","RCDPRECT",47,0)
 Q
"RTN","RCDPRECT",48,0)
 ;
"RTN","RCDPRECT",49,0)
 ;
"RTN","RCDPRECT",50,0)
PRINT ;  print a receipt
"RTN","RCDPRECT",51,0)
 ;  requires variables rcrectda and rctranda
"RTN","RCDPRECT",52,0)
 N %,%H,%I,ADDRESS,DATA,LINE,RCTYPE,X,Y
"RTN","RCDPRECT",53,0)
 U IO
"RTN","RCDPRECT",54,0)
 ;
"RTN","RCDPRECT",55,0)
 ;  print address for station at top
"RTN","RCDPRECT",56,0)
 S ADDRESS=$$SADD^RCFN01(1)
"RTN","RCDPRECT",57,0)
 W !?25,"Department Of Veterans Affairs"
"RTN","RCDPRECT",58,0)
 F %=1,2,3 I $P(ADDRESS,"^",%)'="" W !?((80-$L($P(ADDRESS,"^",%)))/2),$P(ADDRESS,"^",%)
"RTN","RCDPRECT",59,0)
 S ADDRESS=$P(ADDRESS,"^",4)_", "_$P(ADDRESS,"^",5)_"  "_$P(ADDRESS,"^",6)
"RTN","RCDPRECT",60,0)
 I $TR(ADDRESS,", ")'="" W !?((80-$L(ADDRESS))/2),ADDRESS
"RTN","RCDPRECT",61,0)
 ;
"RTN","RCDPRECT",62,0)
 S LINE="",$P(LINE,"-",80)=""
"RTN","RCDPRECT",63,0)
 W !,LINE
"RTN","RCDPRECT",64,0)
 ;
"RTN","RCDPRECT",65,0)
 S %="*** Payment Receipt ***"
"RTN","RCDPRECT",66,0)
 W !!?((80-$L(%))/2),%
"RTN","RCDPRECT",67,0)
 ;
"RTN","RCDPRECT",68,0)
 ;  account and name
"RTN","RCDPRECT",69,0)
 S DATA=$G(^RCY(344,RCRECTDA,1,RCTRANDA,0))
"RTN","RCDPRECT",70,0)
 I $P(DATA,"^",3)'="" D
"RTN","RCDPRECT",71,0)
 .   W !
"RTN","RCDPRECT",72,0)
 .   ;  account from patient file
"RTN","RCDPRECT",73,0)
 .   I $P(DATA,"^",3)[";DPT(" D  Q
"RTN","RCDPRECT",74,0)
 .   .   W $P($G(^DPT(+$P(DATA,"^",3),0)),"^")
"RTN","RCDPRECT",75,0)
 .   .   S %=$$SSN^RCFN01($P(DATA,"^",3))
"RTN","RCDPRECT",76,0)
 .   .   I $E(%,6,9)'="" W " (",$E(%,6,9),")"
"RTN","RCDPRECT",77,0)
 .   ;
"RTN","RCDPRECT",78,0)
 .   ;  account from bill file
"RTN","RCDPRECT",79,0)
 .   W $P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^")
"RTN","RCDPRECT",80,0)
 .   W "  "
"RTN","RCDPRECT",81,0)
 .   W $$NAM^RCFN01($P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^",9))
"RTN","RCDPRECT",82,0)
 .   S %=$$SSN^RCFN01($P($G(^PRCA(430,+$P(DATA,"^",3),0)),"^",9))
"RTN","RCDPRECT",83,0)
 .   I $E(%,6,9)'="" W " (",$E(%,6,9),")"
"RTN","RCDPRECT",84,0)
 ;
"RTN","RCDPRECT",85,0)
 W !,"     Receipt #: ",$P(^RCY(344,RCRECTDA,0),"^"),"/",$P(DATA,"^")
"RTN","RCDPRECT",86,0)
 D NOW^%DTC S Y=X D DD^%DT
"RTN","RCDPRECT",87,0)
 W ?53,"Date: ",Y
"RTN","RCDPRECT",88,0)
 W !,"  Payment Type: ",$P($G(^RC(341.1,+$P(^RCY(344,RCRECTDA,0),"^",4),0)),"^")
"RTN","RCDPRECT",89,0)
 S Y=$P(DATA,"^",6) I Y D DD^%DT
"RTN","RCDPRECT",90,0)
 W ?45,"Payment Date: ",Y
"RTN","RCDPRECT",91,0)
 ;
"RTN","RCDPRECT",92,0)
 S RCTYPE=$P($G(^RC(341.1,+$P(^RCY(344,RCRECTDA,0),"^",4),0)),"^",2)
"RTN","RCDPRECT",93,0)
 ;  type = 3 (district counsel), 4 (check), 5 (dept of justice)
"RTN","RCDPRECT",94,0)
 I RCTYPE=3!(RCTYPE=4)!(RCTYPE=5) D
"RTN","RCDPRECT",95,0)
 .   W !,"       Check #: ",$P(DATA,"^",7)
"RTN","RCDPRECT",96,0)
 .   S Y=$P(DATA,"^",10) I Y D DD^%DT
"RTN","RCDPRECT",97,0)
 .   W ?47,"Check Date: ",Y
"RTN","RCDPRECT",98,0)
 .   W !,"        Bank #: ",$P(DATA,"^",8)
"RTN","RCDPRECT",99,0)
 ;
"RTN","RCDPRECT",100,0)
 ;  type = 7 (credit card)
"RTN","RCDPRECT",101,0)
 I RCTYPE=7 D
"RTN","RCDPRECT",102,0)
 .   W !," Last 4 of Credit Card #: ",$E($P(DATA,"^",11),$L($P(DATA,"^",11))-3,$L($P(DATA,"^",11)))
"RTN","RCDPRECT",103,0)
 .   W !," Confirmation#: ",$P(DATA,"^",2)
"RTN","RCDPRECT",104,0)
 ;
"RTN","RCDPRECT",105,0)
 W !,"Payment Amount: $ ",$J($P(DATA,"^",4),0,2)
"RTN","RCDPRECT",106,0)
 W ?42,"Account Balance: $ ",$J($$BAL^PRCAFN($S($P(DATA,"^",3)[";PRCA(430":$P(^PRCA(430,+$P(DATA,"^",3),0),"^",9),1:$P(DATA,"^",3))),0,2)
"RTN","RCDPRECT",107,0)
 ;
"RTN","RCDPRECT",108,0)
 W !!,"IMPORTANT"
"RTN","RCDPRECT",109,0)
 W !!,"Note that checks or drafts are not valid until paid by your bank."
"RTN","RCDPRECT",110,0)
 W !!,"This receipt should be retained for your records."
"RTN","RCDPRECT",111,0)
 W !,"A detailed listing of how your payment has been applied to your"
"RTN","RCDPRECT",112,0)
 W !,"account will be provided on your patient statement, which you"
"RTN","RCDPRECT",113,0)
 W !,"will receive in the mail at a later date."
"RTN","RCDPRECT",114,0)
 W !!,LINE
"RTN","RCDPRECT",115,0)
 D ^%ZISC
"RTN","RCDPRECT",116,0)
 Q
"RTN","RCDPURED")
0^3^B33715585^B33715386
"RTN","RCDPURED",1,0)
RCDPURED ;WISC/RFJ-file 344 receipt/payment dd calls ;1 Jun 99
"RTN","RCDPURED",2,0)
 ;;4.5;Accounts Receivable;**114,169,174,196,202,244**;Mar 20, 1995
"RTN","RCDPURED",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPURED",4,0)
 Q
"RTN","RCDPURED",5,0)
 ;
"RTN","RCDPURED",6,0)
 ;
"RTN","RCDPURED",7,0)
 ;  ***** dd references from file 344 (receipts) *****
"RTN","RCDPURED",8,0)
 ;
"RTN","RCDPURED",9,0)
 ;
"RTN","RCDPURED",10,0)
DUPLCATE ;  called by input transform receipt number (.01)
"RTN","RCDPURED",11,0)
 ;  make sure no duplicate receipt numbers
"RTN","RCDPURED",12,0)
 I $O(^RCY(344,"B",X,"")) K X W !,"This is a duplicate receipt number." Q
"RTN","RCDPURED",13,0)
 I $O(^PRCA(433,"AF",X,"")) K X W !,"This receipt number has already been used and has been purged from the system. " K X
"RTN","RCDPURED",14,0)
 Q
"RTN","RCDPURED",15,0)
 ;
"RTN","RCDPURED",16,0)
 ;
"RTN","RCDPURED",17,0)
PAYCOUNT(RCRECTDA) ;  called by computed field number of transactions (101)
"RTN","RCDPURED",18,0)
 ;  return the count of payments for the receipt
"RTN","RCDPURED",19,0)
 N COUNT,X
"RTN","RCDPURED",20,0)
 S COUNT=0
"RTN","RCDPURED",21,0)
 S X=0 F  S X=$O(^RCY(344,+$G(RCRECTDA),1,X)) Q:'X  S COUNT=COUNT+1
"RTN","RCDPURED",22,0)
 Q COUNT
"RTN","RCDPURED",23,0)
 ;
"RTN","RCDPURED",24,0)
 ;
"RTN","RCDPURED",25,0)
PAYTOTAL(RCRECTDA) ;  called by computed field total amount of receipts (.15)
"RTN","RCDPURED",26,0)
 ;  return the total dollars for payments entered for the receipt
"RTN","RCDPURED",27,0)
 N TOTAL,X
"RTN","RCDPURED",28,0)
 S TOTAL=0
"RTN","RCDPURED",29,0)
 S X=0 F  S X=$O(^RCY(344,+$G(RCRECTDA),1,X)) Q:'X  S TOTAL=TOTAL+$P($G(^(X,0)),"^",4)
"RTN","RCDPURED",30,0)
 Q TOTAL
"RTN","RCDPURED",31,0)
 ;
"RTN","RCDPURED",32,0)
 ;
"RTN","RCDPURED",33,0)
 ;  ***** dd references from sub-file 344.01 (transactions) *****
"RTN","RCDPURED",34,0)
 ;
"RTN","RCDPURED",35,0)
 ;
"RTN","RCDPURED",36,0)
CHGAMT ;  called from the input transform on the transaction amount (.04)
"RTN","RCDPURED",37,0)
 ;  field.  if the amount is changed, this will create a new cancelled
"RTN","RCDPURED",38,0)
 ;  transaction showing the original amount before the change.
"RTN","RCDPURED",39,0)
 N ORIGDATA,TRANDA
"RTN","RCDPURED",40,0)
 S ORIGDATA=^RCY(344,DA(1),1,DA,0)
"RTN","RCDPURED",41,0)
 ;  no original payment amount
"RTN","RCDPURED",42,0)
 I '$P(ORIGDATA,"^",4) Q
"RTN","RCDPURED",43,0)
 ;  payment amount did not change
"RTN","RCDPURED",44,0)
 I +$P(ORIGDATA,"^",4)=+X Q
"RTN","RCDPURED",45,0)
 ;  payment amount increased
"RTN","RCDPURED",46,0)
 I $P(ORIGDATA,"^",4)<X Q
"RTN","RCDPURED",47,0)
 ;  amount was changed
"RTN","RCDPURED",48,0)
 ;  enter a new transaction
"RTN","RCDPURED",49,0)
 S TRANDA=$$ADDTRAN^RCDPURET(DA(1))
"RTN","RCDPURED",50,0)
 I 'TRANDA W !,"  Unable to edit amount." K X Q
"RTN","RCDPURED",51,0)
 ;  copy the current data for the transaction
"RTN","RCDPURED",52,0)
 ;  do not use fileman, will overwrite variables
"RTN","RCDPURED",53,0)
 ;  set the cancel comment (field 1.01)
"RTN","RCDPURED",54,0)
 S $P(^RCY(344,DA(1),1,TRANDA,1),"^")="Amount $"_$P(ORIGDATA,"^",4)_" decreased in original trans#"_DA
"RTN","RCDPURED",55,0)
 ;  set the payment amount to zero (for cancelled)
"RTN","RCDPURED",56,0)
 S $P(ORIGDATA,"^",4)=0
"RTN","RCDPURED",57,0)
 S $P(ORIGDATA,"^",14)=DUZ
"RTN","RCDPURED",58,0)
 S $P(^RCY(344,DA(1),1,TRANDA,0),"^",2,99)=$P(ORIGDATA,"^",2,99)
"RTN","RCDPURED",59,0)
 Q
"RTN","RCDPURED",60,0)
 ;
"RTN","RCDPURED",61,0)
 ;
"RTN","RCDPURED",62,0)
PAYCHK ;  called from the input transform on the transaction amount (.04)
"RTN","RCDPURED",63,0)
 ;  field.  This will compare the amount paid with the amount owed
"RTN","RCDPURED",64,0)
 ;  for a bill.
"RTN","RCDPURED",65,0)
 N ACCOUNT,AMOUNT,OWED
"RTN","RCDPURED",66,0)
 S ACCOUNT=$P($G(^RCY(344,DA(1),1,DA,0)),"^",3)
"RTN","RCDPURED",67,0)
 ;  quit, account not a bill
"RTN","RCDPURED",68,0)
 I ACCOUNT'["PRCA(430," Q
"RTN","RCDPURED",69,0)
 ;  quit, account is a patient
"RTN","RCDPURED",70,0)
 I $P($G(^RCD(340,+$P($G(^PRCA(430,+ACCOUNT,0)),"^",9),0)),"^")[";DPT(" Q
"RTN","RCDPURED",71,0)
 ;  calculate amount owed for a bill
"RTN","RCDPURED",72,0)
 S OWED=$G(^PRCA(430,+ACCOUNT,7))
"RTN","RCDPURED",73,0)
 S OWED=$P(OWED,"^")+$P(OWED,"^",2)+$P(OWED,"^",3)+$P(OWED,"^",4)+$P(OWED,"^",5)
"RTN","RCDPURED",74,0)
 ;  compare amount paid (in x) with amount owed (if not processed 0;7)
"RTN","RCDPURED",75,0)
 I X>OWED,'$P($G(^RCY(344,DA(1),0)),"^",7) W "  WARNING: Payment amount greater than amount of bill!"
"RTN","RCDPURED",76,0)
 ;  check for other bills
"RTN","RCDPURED",77,0)
 S AMOUNT=$$EOB^IBCNSBL2(+ACCOUNT,+$P($G(^PRCA(430,+ACCOUNT,0)),"^",3),$$PAID^PRCAFN1(+ACCOUNT))
"RTN","RCDPURED",78,0)
 I AMOUNT W !!,$P(AMOUNT,"^",2)," may also be billable.",!
"RTN","RCDPURED",79,0)
 Q
"RTN","RCDPURED",80,0)
 ;
"RTN","RCDPURED",81,0)
 ;
"RTN","RCDPURED",82,0)
PNORBILL ;  called by the input transform in receipt file 344, transaction
"RTN","RCDPURED",83,0)
 ;  multiple (field 1), patient name or bill number (sub field .09)
"RTN","RCDPURED",84,0)
 I $L(X)>20!($L(X)<1) K X Q
"RTN","RCDPURED",85,0)
 ;
"RTN","RCDPURED",86,0)
 N DFN,RCBILL,RCINPUT,RCOUTPUT,Y,RCTYP,DIC
"RTN","RCDPURED",87,0)
 ;
"RTN","RCDPURED",88,0)
 S RCINPUT=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RCDPURED",89,0)
 ;  try and lookup on bill number
"RTN","RCDPURED",90,0)
 S X=$S($O(^PRCA(430,"B",RCINPUT,0)):$O(^(0))_";PRCA(430,",$O(^PRCA(430,"D",RCINPUT,0)):$O(^(0))_";PRCA(430,",1:RCINPUT)
"RTN","RCDPURED",91,0)
 I X[";PRCA(430," D DISPLAY(X)
"RTN","RCDPURED",92,0)
 ;  bill not found, try and lookup on patient
"RTN","RCDPURED",93,0)
 I X=RCINPUT S DIC="^DPT(",DIC(0)="EM" D ^DIC S X=+Y_";DPT("
"RTN","RCDPURED",94,0)
 ;  new value in variable X (output in X)
"RTN","RCDPURED",95,0)
 ;
"RTN","RCDPURED",96,0)
 ;  patient not found, type of payment = check/mo
"RTN","RCDPURED",97,0)
 I +$G(Y)<0,($P($G(^RCY(344,DA(1),0)),"^",4)=4) D
"RTN","RCDPURED",98,0)
 .   S (X,Y)=$$REC^IBRFN(RCINPUT,.RCTYP),(RCBILL,X)=X_";PRCA(430,"
"RTN","RCDPURED",99,0)
 .   I Y>0 D
"RTN","RCDPURED",100,0)
 .   .   N DIR,DIQ2,DIRUT,DTOUT,DUOUT,RCPRM
"RTN","RCDPURED",101,0)
 .   .   S RCTYP=$G(RCTYP,1)
"RTN","RCDPURED",102,0)
 .   .   S RCPRM=$S(RCTYP=1:"TRICARE reference number",RCTYP=2:"ECME Rx reference number",RCTYP=3:"prescription number",1:"reference number")
"RTN","RCDPURED",103,0)
 .   .   S DIR("A")="Is this "_RCPRM_" - "_RCINPUT
"RTN","RCDPURED",104,0)
 .   .   S DIR("B")="No",DIR("A",1)=" "
"RTN","RCDPURED",105,0)
 .   .   S DIR(0)="Y^O" D ^DIR S:'Y Y=-1
"RTN","RCDPURED",106,0)
 .   .   I Y'>0 Q
"RTN","RCDPURED",107,0)
 .   .   W !!,$P($G(^PRCA(430,+RCBILL,0)),"^")," "
"RTN","RCDPURED",108,0)
 .   .   D DISPLAY(RCBILL)
"RTN","RCDPURED",109,0)
 .   .   S X=RCBILL
"RTN","RCDPURED",110,0)
 ;  output in variable X
"RTN","RCDPURED",111,0)
 ;
"RTN","RCDPURED",112,0)
 I +$G(Y)<0 K X Q
"RTN","RCDPURED",113,0)
 ;
"RTN","RCDPURED",114,0)
 S RCOUTPUT=X
"RTN","RCDPURED",115,0)
 ;
"RTN","RCDPURED",116,0)
 ;  patient account, show messages and quit (output still in variable X)
"RTN","RCDPURED",117,0)
 I RCOUTPUT[";DPT(" D CHECKPAT(+RCOUTPUT) Q
"RTN","RCDPURED",118,0)
 ;
"RTN","RCDPURED",119,0)
 ;  bill account
"RTN","RCDPURED",120,0)
 I $$IB^IBRUTL(+RCOUTPUT) W " ... This bill appears to have other patient bills on 'hold'."
"RTN","RCDPURED",121,0)
 S X=$P($G(^RCD(340,+$P(^PRCA(430,+RCOUTPUT,0),"^",9),0)),"^")
"RTN","RCDPURED",122,0)
 I X[";DPT(" D CHECKPAT(+X)
"RTN","RCDPURED",123,0)
 S X=RCOUTPUT
"RTN","RCDPURED",124,0)
 Q
"RTN","RCDPURED",125,0)
 ;
"RTN","RCDPURED",126,0)
 ;
"RTN","RCDPURED",127,0)
CHECKPAT(DFN) ;  check patient for other charges, etc., show message
"RTN","RCDPURED",128,0)
 N X
"RTN","RCDPURED",129,0)
 S X="IBARXEU" X ^%ZOSF("TEST")
"RTN","RCDPURED",130,0)
 I $T S X=$$RXST^IBARXEU(DFN,DT) I X D
"RTN","RCDPURED",131,0)
 .   W !?2,"* Patient is exempt from RX Copay: ",$P(X,"^",4)," *"
"RTN","RCDPURED",132,0)
 S X="PSOCOPAY" X ^%ZOSF("TEST")
"RTN","RCDPURED",133,0)
 I $T S X=$$POT^PSOCOPAY(DFN) I X D
"RTN","RCDPURED",134,0)
 .   W !?2,"* This patient has ",X,"-30 day RX's totaling $",(X*8),".00 that are potentially *"
"RTN","RCDPURED",135,0)
 .   W !?2,"* billable.  This represents any Window Rx's issued today. *"
"RTN","RCDPURED",136,0)
 Q
"RTN","RCDPURED",137,0)
 ;
"RTN","RCDPURED",138,0)
 ;
"RTN","RCDPURED",139,0)
DISPLAY(RCBILLDA) ;  display bill
"RTN","RCDPURED",140,0)
 N DATA
"RTN","RCDPURED",141,0)
 S DATA=$P(^PRCA(430,+RCBILLDA,0),"^",9) W:DATA "  ",$$NAM^RCFN01(DATA)
"RTN","RCDPURED",142,0)
 S DATA=$P(^PRCA(430,+RCBILLDA,0),"^",8) I DATA D
"RTN","RCDPURED",143,0)
 .   W "   ",$P(^PRCA(430.3,DATA,0),"^")
"RTN","RCDPURED",144,0)
 .   I $P(^PRCA(430.3,DATA,0),"^",3)'=102,$P($G(^RCD(340,+$P(^PRCA(430,+RCBILLDA,0),"^",9),0)),"^")'[";DPT(" W !,"This bill is not in 'active' status."
"RTN","RCDPURED",145,0)
 S DATA=$G(^PRCA(430,+RCBILLDA,7)) W "   $",$J($P(DATA,"^")+$P(DATA,"^",2)+$P(DATA,"^",3)+$P(DATA,"^",4)+$P(DATA,"^",5),1,2)
"RTN","RCDPURED",146,0)
 Q
"RTN","RCDPURED",147,0)
 ;
"RTN","RCDPURED",148,0)
 ;
"RTN","RCDPURED",149,0)
PAYDATE ;  called by the input transform in receipt file 344, transaction
"RTN","RCDPURED",150,0)
 ;  multiple (field 1), date of payment (sub field .06)
"RTN","RCDPURED",151,0)
 ;  date of payment not in future or more than one month ago
"RTN","RCDPURED",152,0)
 N DAYSDIFF
"RTN","RCDPURED",153,0)
 S DAYSDIFF=$$FMDIFF^XLFDT(X,DT)
"RTN","RCDPURED",154,0)
 I DAYSDIFF<-31!(DAYSDIFF>0) K X
"RTN","RCDPURED",155,0)
 Q
"RTN","RCDPURED",156,0)
 ;
"RTN","RCDPURED",157,0)
 ;
"RTN","RCDPURED",158,0)
 ;  ***** dd references from file 344.1 (deposits) *****
"RTN","RCDPURED",159,0)
 ;
"RTN","RCDPURED",160,0)
 ;
"RTN","RCDPURED",161,0)
RECTOTAL(RCDEPTDA) ;  called from computed field TOTAL AMT OF RECEIPTS (.18) in
"RTN","RCDPURED",162,0)
 ;  deposit file (344.1)
"RTN","RCDPURED",163,0)
 ;  this returns the total dollars paid for all receipts on deposit ticket
"RTN","RCDPURED",164,0)
 N RCRECTDA,TOTAL
"RTN","RCDPURED",165,0)
 S TOTAL=0
"RTN","RCDPURED",166,0)
 S RCRECTDA=0 F  S RCRECTDA=$O(^RCY(344,"AD",+RCDEPTDA,RCRECTDA)) Q:'RCRECTDA  D
"RTN","RCDPURED",167,0)
 .   S TOTAL=TOTAL+$$PAYTOTAL(RCRECTDA)
"RTN","RCDPURED",168,0)
 Q TOTAL
"RTN","RCDPURED",169,0)
 ;
"RTN","RCDPURED",170,0)
 ;
"RTN","RCDPURED",171,0)
RECCOUNT(RCDEPTDA) ;  called from computed field TOTAL RECEIPTS (100) in deposit file (344.1)
"RTN","RCDPURED",172,0)
 ;  this returns a count of the number of receipts on a deposit ticket
"RTN","RCDPURED",173,0)
 N RCRECTDA,COUNT
"RTN","RCDPURED",174,0)
 S COUNT=0
"RTN","RCDPURED",175,0)
 S RCRECTDA=0 F  S RCRECTDA=$O(^RCY(344,"AD",+RCDEPTDA,RCRECTDA)) Q:'RCRECTDA  D
"RTN","RCDPURED",176,0)
 .   S COUNT=COUNT+1
"RTN","RCDPURED",177,0)
 Q COUNT
"VER")
8.0^22.0
"BLD",6705,6)
^222
**END**
**END**
