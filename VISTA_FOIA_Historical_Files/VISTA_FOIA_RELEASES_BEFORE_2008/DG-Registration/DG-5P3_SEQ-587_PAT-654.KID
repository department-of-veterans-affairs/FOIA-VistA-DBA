Released DG*5.3*654 SEQ #587
Extracted from mail message
**KIDS**:DG*5.3*654^

**INSTALL NAME**
DG*5.3*654
"BLD",5924,0)
DG*5.3*654^REGISTRATION^0^3051026^y
"BLD",5924,4,0)
^9.64PA^^
"BLD",5924,"INI")
EN^DG53654P
"BLD",5924,"INID")
^^n
"BLD",5924,"KRN",0)
^9.67PA^8989.52^19
"BLD",5924,"KRN",.4,0)
.4
"BLD",5924,"KRN",.401,0)
.401
"BLD",5924,"KRN",.402,0)
.402
"BLD",5924,"KRN",.403,0)
.403
"BLD",5924,"KRN",.5,0)
.5
"BLD",5924,"KRN",.84,0)
.84
"BLD",5924,"KRN",3.6,0)
3.6
"BLD",5924,"KRN",3.8,0)
3.8
"BLD",5924,"KRN",9.2,0)
9.2
"BLD",5924,"KRN",9.8,0)
9.8
"BLD",5924,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5924,"KRN",9.8,"NM",1,0)
DG53654P^^0^B11785858
"BLD",5924,"KRN",9.8,"NM","B","DG53654P",1)

"BLD",5924,"KRN",19,0)
19
"BLD",5924,"KRN",19,"NM",0)
^9.68A^^
"BLD",5924,"KRN",19.1,0)
19.1
"BLD",5924,"KRN",101,0)
101
"BLD",5924,"KRN",409.61,0)
409.61
"BLD",5924,"KRN",771,0)
771
"BLD",5924,"KRN",870,0)
870
"BLD",5924,"KRN",8989.51,0)
8989.51
"BLD",5924,"KRN",8989.52,0)
8989.52
"BLD",5924,"KRN",8994,0)
8994
"BLD",5924,"KRN","B",.4,.4)

"BLD",5924,"KRN","B",.401,.401)

"BLD",5924,"KRN","B",.402,.402)

"BLD",5924,"KRN","B",.403,.403)

"BLD",5924,"KRN","B",.5,.5)

"BLD",5924,"KRN","B",.84,.84)

"BLD",5924,"KRN","B",3.6,3.6)

"BLD",5924,"KRN","B",3.8,3.8)

"BLD",5924,"KRN","B",9.2,9.2)

"BLD",5924,"KRN","B",9.8,9.8)

"BLD",5924,"KRN","B",19,19)

"BLD",5924,"KRN","B",19.1,19.1)

"BLD",5924,"KRN","B",101,101)

"BLD",5924,"KRN","B",409.61,409.61)

"BLD",5924,"KRN","B",771,771)

"BLD",5924,"KRN","B",870,870)

"BLD",5924,"KRN","B",8989.51,8989.51)

"BLD",5924,"KRN","B",8989.52,8989.52)

"BLD",5924,"KRN","B",8994,8994)

"BLD",5924,"QUES",0)
^9.62^^
"BLD",5924,"REQB",0)
^9.611^^
"INI")
EN^DG53654P
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
654^3051026
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DG53654P")
0^1^B11785858
"RTN","DG53654P",1,0)
DG53654P ;ALB/BAJ - Synchronize the PERIOD OF SERVICE file (#21);09/01/2005
"RTN","DG53654P",2,0)
 ;;5.3;Registration;**654**;Aug 13, 1993
"RTN","DG53654P",3,0)
 ;
"RTN","DG53654P",4,0)
 ; This routine will will update the PERIOD OF SERVICE file (#21).  It modifies
"RTN","DG53654P",5,0)
 ; data in specific fields. This routine will neither add nor delete records
"RTN","DG53654P",6,0)
 ; from the file
"RTN","DG53654P",7,0)
 ;
"RTN","DG53654P",8,0)
 ; "B" VALUE         FIELD#      FIELD NAME              FROM                           TO
"RTN","DG53654P",9,0)
 ; ---------------------------------------------------------------------------------------------------------------
"RTN","DG53654P",10,0)
 ; CHAMPUS           .01         NAME                 CHAMPUS                        TRICARE
"RTN","DG53654P",11,0)
 ; CHAMPUS           .02         ABBREVIATION         CHA                            TRI
"RTN","DG53654P",12,0)
 ; CHAMPUS            20         BRIEF DESCRIPTION    CHAMPUS PTS AT VA FACILITY     TRICARE PTS AT VA FACILITY
"RTN","DG53654P",13,0)
 ; PERSIAN GULF WAR   20         BRIEF DESCRIPTION    PERSUAN GULF WAR VETERAN       (On or after 8/2/1990)
"RTN","DG53654P",14,0)
 ; POST-VIETNAM      .05         END DATE             <blank>                        8/1/1990
"RTN","DG53654P",15,0)
 ; POST-VIETNAM       20         BRIEF DESCRIPTION    (On or after 5/8/75)           (5/8/75 - 8/1/1990)
"RTN","DG53654P",16,0)
 ; PRE-KOREAN         20         BRIEF DESCRIPTION    (Peacetime before 6/27/50)     Peacetime before 6/27/1950
"RTN","DG53654P",17,0)
 ; KOREAN             20         BRIEF DESCRIPTION    (6/27/50-1/31/55)              (6/27/1950-1/31/1955)
"RTN","DG53654P",18,0)
 ; MERCHANT MARINE    20         BRIEF DESCRIPTION    (12/41-8/15/45)                (12/1941-8/15/1945)
"RTN","DG53654P",19,0)
 ; POST-KOREAN        20         BRIEF DESCRIPTION    (2/1/55-2/27/61)               (2/1/1955-2/27/1961)
"RTN","DG53654P",20,0)
 ; VIETNAM ERA        20         BRIEF DESCRIPTION    (2/28/61-5/7/75)               (2/28/1961-5/7/1975)
"RTN","DG53654P",21,0)
 ; WORLD WAR I        20         BRIEF DESCRIPTION    (4/6/17-11/11/18)              (4/6/1917-11/11/1918)
"RTN","DG53654P",22,0)
 ; WORLD WAR II       20         BRIEF DESCRIPTION    (12/7/41-12/31/46)             (12/7/1941-12/31/1946)
"RTN","DG53654P",23,0)
 ; 
"RTN","DG53654P",24,0)
 ;
"RTN","DG53654P",25,0)
 Q
"RTN","DG53654P",26,0)
EN ; Driver - Initialize variables and populate file
"RTN","DG53654P",27,0)
 ;
"RTN","DG53654P",28,0)
 ; Populate file using API UPD^DGENDBS
"RTN","DG53654P",29,0)
 ;       UPD^DGENDBS takes the following parameters:
"RTN","DG53654P",30,0)
 ;   FILE - File or sub-file number
"RTN","DG53654P",31,0)
 ;   DGENDA - New name for traditional DA array, with same meaning.
"RTN","DG53654P",32,0)
 ;            Pass by reference.
"RTN","DG53654P",33,0)
 ;   DATA - Data array to file (pass by reference)
"RTN","DG53654P",34,0)
 ;          Format: DATA(<field #>)=<value>
"RTN","DG53654P",35,0)
 ; 
"RTN","DG53654P",36,0)
 ; Additional variables
"RTN","DG53654P",37,0)
 ; MSGARR - array to manage data sent to message APIs
"RTN","DG53654P",38,0)
 ; XDATA  - array to manage data sent to DGENDBS API
"RTN","DG53654P",39,0)
 ;  
"RTN","DG53654P",40,0)
 N MSGARR,XDATA
"RTN","DG53654P",41,0)
 ; log start of install
"RTN","DG53654P",42,0)
 D BMES^XPDUTL(">>>Installing DG*5.3*654...")
"RTN","DG53654P",43,0)
 K ^TMP($J)
"RTN","DG53654P",44,0)
 ; 
"RTN","DG53654P",45,0)
 ; populate work arrays
"RTN","DG53654P",46,0)
 D SETUP
"RTN","DG53654P",47,0)
 ;
"RTN","DG53654P",48,0)
 ; call API to update records
"RTN","DG53654P",49,0)
 D UPDATE
"RTN","DG53654P",50,0)
 ;
"RTN","DG53654P",51,0)
 ; notify user if errors encountered
"RTN","DG53654P",52,0)
 I $D(^TMP($J,"ERRORS")) D
"RTN","DG53654P",53,0)
 . D BMES^XPDUTL("Errors encountered... Job # "_$J)
"RTN","DG53654P",54,0)
 . D MES^XPDUTL(" Please contact the CIO Field Office for assistance")
"RTN","DG53654P",55,0)
 . D MES^XPDUTL(" and record the Job number (above) for reference.")
"RTN","DG53654P",56,0)
 ;
"RTN","DG53654P",57,0)
 D BMES^XPDUTL(">>>Install of DG*5.3*654 complete")
"RTN","DG53654P",58,0)
 Q
"RTN","DG53654P",59,0)
 ;
"RTN","DG53654P",60,0)
UPDATE ; update records
"RTN","DG53654P",61,0)
 N DATA,DGENDA,ERR,FILE,POS
"RTN","DG53654P",62,0)
 ; period of service file is 21
"RTN","DG53654P",63,0)
 S FILE=21,(POS,ERR)=""
"RTN","DG53654P",64,0)
 F  S POS=$O(XDATA(POS)) Q:POS=""  D
"RTN","DG53654P",65,0)
 . D MES^XPDUTL("Updating "_MSGARR(POS))
"RTN","DG53654P",66,0)
 . M DATA=XDATA(POS)
"RTN","DG53654P",67,0)
 . I '$$UPD^DGENDBS(FILE,.POS,.DATA,.ERR) D
"RTN","DG53654P",68,0)
 . . ;S ^TMP($J,"ERRORS",POS)=ERR_"^"_MSGARR(POS)_"^"_$H
"RTN","DG53654P",69,0)
 . . D MES^XPDUTL("Error in filing "_MSGARR(POS)_" values")
"RTN","DG53654P",70,0)
 . . S ERR=""
"RTN","DG53654P",71,0)
 . K DATA
"RTN","DG53654P",72,0)
 Q
"RTN","DG53654P",73,0)
 ;
"RTN","DG53654P",74,0)
SETUP ; setup message and data arrays
"RTN","DG53654P",75,0)
 ; PBNAME        = Data Index pointer in "B" x-ref
"RTN","DG53654P",76,0)
 ; POS           = Data Index (D0 value)
"RTN","DG53654P",77,0)
 ; PFNUM         = Field number
"RTN","DG53654P",78,0)
 ; PBDATA        = New data to change/insert (per table in DATA tag)
"RTN","DG53654P",79,0)
 ; 
"RTN","DG53654P",80,0)
 ; Arrays created
"RTN","DG53654P",81,0)
 ; MSGARR array contains a pointer to the index record
"RTN","DG53654P",82,0)
 ; MSGARR(POS) = PBNAME
"RTN","DG53654P",83,0)
 ;       
"RTN","DG53654P",84,0)
 ; XDATA array contains the items to change
"RTN","DG53654P",85,0)
 ; XDATA(POS,PFNUM) = PDATA
"RTN","DG53654P",86,0)
 ; 
"RTN","DG53654P",87,0)
 ;
"RTN","DG53654P",88,0)
 N POS,PBNAME,PFNUM,PDATA,X,K
"RTN","DG53654P",89,0)
 F K=1:1 S X=$P($T(DATA+K),";;",2) Q:X=""  D             ;assemble pointers and data strings
"RTN","DG53654P",90,0)
 . S PBNAME=$P(X,"^",1)
"RTN","DG53654P",91,0)
 . S POS=$$LOOKUP(PBNAME) I POS="ERROR" D  Q
"RTN","DG53654P",92,0)
 . . ;S ^TMP($J,"ERRORS")="NO SUCH RECORD^"_PBNAME_"^"_$H
"RTN","DG53654P",93,0)
 . . D MES^XPDUTL("Error in filing "_PBNAME_" values")
"RTN","DG53654P",94,0)
 . S PFNUM=$P(X,"^",2)
"RTN","DG53654P",95,0)
 . S PDATA=$P(X,"^",3)
"RTN","DG53654P",96,0)
 . S MSGARR(POS)=PBNAME
"RTN","DG53654P",97,0)
 . S XDATA(POS,PFNUM)=PDATA
"RTN","DG53654P",98,0)
 ;
"RTN","DG53654P",99,0)
 Q
"RTN","DG53654P",100,0)
 ;
"RTN","DG53654P",101,0)
LOOKUP(PBNAME) ; Return IEN for POS File #21, using the "B" x-ref
"RTN","DG53654P",102,0)
 N RETVAL
"RTN","DG53654P",103,0)
 S RETVAL=$O(^DIC(21,"B",PBNAME,""))
"RTN","DG53654P",104,0)
 I 'RETVAL Q "ERROR"
"RTN","DG53654P",105,0)
 Q RETVAL
"RTN","DG53654P",106,0)
 ;
"RTN","DG53654P",107,0)
DATA ; POS values to lookup *** Data table, DO NOT ADJUST ***
"RTN","DG53654P",108,0)
 ;;CHAMPUS^.01^TRICARE
"RTN","DG53654P",109,0)
 ;;CHAMPUS^.02^TRI
"RTN","DG53654P",110,0)
 ;;CHAMPUS^20^TRICARE PTS AT VA FACILITY
"RTN","DG53654P",111,0)
 ;;KOREAN^20^(6/27/1950-1/31/1955)
"RTN","DG53654P",112,0)
 ;;MERCHANT MARINE^20^(12/7/1941-8/15/1945)
"RTN","DG53654P",113,0)
 ;;PERSIAN GULF WAR^20^(On or after 8/2/1990)
"RTN","DG53654P",114,0)
 ;;POST-VIETNAM^.05^2900801
"RTN","DG53654P",115,0)
 ;;POST-VIETNAM^20^(5/8/1975-8/1/1990)
"RTN","DG53654P",116,0)
 ;;POST-KOREAN^20^(2/1/1955-2/27/1961)
"RTN","DG53654P",117,0)
 ;;PRE-KOREAN^20^Peacetime before 6/27/1950
"RTN","DG53654P",118,0)
 ;;VIETNAM ERA^20^(2/28/1961-5/7/1975)
"RTN","DG53654P",119,0)
 ;;WORLD WAR I^20^(4/6/1917-11/11/1918)
"RTN","DG53654P",120,0)
 ;;WORLD WAR II^20^(12/7/1941-12/31/1946)
"RTN","DG53654P",121,0)
 ;;
"RTN","DG53654P",122,0)
 Q
"RTN","DG53654P",123,0)
 ;
"VER")
8.0^22.0
"BLD",5924,6)
^SEQ #587
**END**
**END**
