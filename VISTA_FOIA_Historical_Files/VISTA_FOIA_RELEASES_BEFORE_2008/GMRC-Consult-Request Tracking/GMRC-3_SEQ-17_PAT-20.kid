Released GMRC*3*20 SEQ #17
Extracted from mail message
**KIDS**:GMRC*3.0*20^

**INSTALL NAME**
GMRC*3.0*20
"BLD",2750,0)
GMRC*3.0*20^CONSULT/REQUEST TRACKING^0^3010119^y
"BLD",2750,1,0)
^^1^1^3010111^^
"BLD",2750,1,1,0)
Build can be found on the National Patch Module under Patch GMRC*3.0*20.
"BLD",2750,4,0)
^9.64PA^^
"BLD",2750,"ABPKG")
n
"BLD",2750,"KRN",0)
^9.67PA^19^17
"BLD",2750,"KRN",.4,0)
.4
"BLD",2750,"KRN",.401,0)
.401
"BLD",2750,"KRN",.402,0)
.402
"BLD",2750,"KRN",.403,0)
.403
"BLD",2750,"KRN",.5,0)
.5
"BLD",2750,"KRN",.84,0)
.84
"BLD",2750,"KRN",3.6,0)
3.6
"BLD",2750,"KRN",3.8,0)
3.8
"BLD",2750,"KRN",9.2,0)
9.2
"BLD",2750,"KRN",9.8,0)
9.8
"BLD",2750,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",2750,"KRN",9.8,"NM",1,0)
GMRCACMT^^0^B23353864
"BLD",2750,"KRN",9.8,"NM",2,0)
GMRCGUIB^^0^B34510085
"BLD",2750,"KRN",9.8,"NM",3,0)
GMRCGUIC^^0^B49669344
"BLD",2750,"KRN",9.8,"NM","B","GMRCACMT",1)

"BLD",2750,"KRN",9.8,"NM","B","GMRCGUIB",2)

"BLD",2750,"KRN",9.8,"NM","B","GMRCGUIC",3)

"BLD",2750,"KRN",19,0)
19
"BLD",2750,"KRN",19.1,0)
19.1
"BLD",2750,"KRN",101,0)
101
"BLD",2750,"KRN",409.61,0)
409.61
"BLD",2750,"KRN",771,0)
771
"BLD",2750,"KRN",870,0)
870
"BLD",2750,"KRN",8994,0)
8994
"BLD",2750,"KRN","B",.4,.4)

"BLD",2750,"KRN","B",.401,.401)

"BLD",2750,"KRN","B",.402,.402)

"BLD",2750,"KRN","B",.403,.403)

"BLD",2750,"KRN","B",.5,.5)

"BLD",2750,"KRN","B",.84,.84)

"BLD",2750,"KRN","B",3.6,3.6)

"BLD",2750,"KRN","B",3.8,3.8)

"BLD",2750,"KRN","B",9.2,9.2)

"BLD",2750,"KRN","B",9.8,9.8)

"BLD",2750,"KRN","B",19,19)

"BLD",2750,"KRN","B",19.1,19.1)

"BLD",2750,"KRN","B",101,101)

"BLD",2750,"KRN","B",409.61,409.61)

"BLD",2750,"KRN","B",771,771)

"BLD",2750,"KRN","B",870,870)

"BLD",2750,"KRN","B",8994,8994)

"BLD",2750,"QUES",0)
^9.62^^
"BLD",2750,"REQB",0)
^9.611^2^2
"BLD",2750,"REQB",1,0)
OR*3.0*88^2
"BLD",2750,"REQB",2,0)
GMRC*3.0*18^2
"BLD",2750,"REQB","B","GMRC*3.0*18",2)

"BLD",2750,"REQB","B","OR*3.0*88",1)

"MBREQ")
0
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
20^3010119
"PKG",128,22,1,"PAH",1,1,0)
^^1^1^3010119
"PKG",128,22,1,"PAH",1,1,1,0)
Build can be found on the National Patch Module under Patch GMRC*3.0*20.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","GMRCACMT")
0^1^B23353864
"RTN","GMRCACMT",1,0)
GMRCACMT ;SLC/DLT,DCM,MA - Comment Action and alerting ;1/11/01  12:53
"RTN","GMRCACMT",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,14,18,20**;DEC 27, 1997
"RTN","GMRCACMT",3,0)
 ; This routine invokes IA #10060
"RTN","GMRCACMT",4,0)
COMMENT(GMRCO) ;Add a comment without changing the status
"RTN","GMRCACMT",5,0)
 K GMRCQIT,GMRCQUT N GMRCA
"RTN","GMRCACMT",6,0)
 I $D(IOTM),$D(IOBM),$D(IOSTBM) D FULL^VALM1
"RTN","GMRCACMT",7,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCAD=GMRCNOW
"RTN","GMRCACMT",8,0)
 S GMRCOM=1,GMRCA=20,GMRCPROV=$P(^GMR(123,GMRCO,0),"^",14) D AUDIT^GMRCP
"RTN","GMRCACMT",9,0)
 ;GMRCOM=1 defined the variable and tells AUDIT^GMRCP that the word-processing logic should be executed. If an actual comment is added, $P(GMRCOM,"^",2)=1 (send alert), if not GMRCOM=1 and no '^' exists (do not send alert)
"RTN","GMRCACMT",10,0)
 I $G(GMRCERR)=1 S GMRCMSG=GMRCERMS D EXAC^GMRCADC(GMRCMSG),END Q
"RTN","GMRCACMT",11,0)
 ;continue if no lock problems occurred
"RTN","GMRCACMT",12,0)
 I $P(GMRCOM,"^",2) D PROCALRT("",1,20,GMRCO)
"RTN","GMRCACMT",13,0)
 D END
"RTN","GMRCACMT",14,0)
 Q
"RTN","GMRCACMT",15,0)
 ;
"RTN","GMRCACMT",16,0)
PROCALRT(GMRCORTX,GMRCDELR,ACTION,GMRCO) ;Process alert for comments
"RTN","GMRCACMT",17,0)
 ;If GMRCDELR=1, the ordering provider can be deleted from the list.
"RTN","GMRCACMT",18,0)
 N GMRCADUZ,GMRCANS,NOTIF,GMRCQIT
"RTN","GMRCACMT",19,0)
 S GMRCANS=$$READ("Y","Do You Wish To Send An Alert With This Comment","N","Enter Y to continue with recipient prompts. Otherwise, enter N.",1)
"RTN","GMRCACMT",20,0)
 I (GMRCANS[U)!(GMRCANS=0) D END Q
"RTN","GMRCACMT",21,0)
 ;
"RTN","GMRCACMT",22,0)
 D WHOTO
"RTN","GMRCACMT",23,0)
 I $G(GMRCQIT) D END Q  ;User "^" at requesting provider.
"RTN","GMRCACMT",24,0)
 ;
"RTN","GMRCACMT",25,0)
 ; Patch 18 changes Notification #27 to #63.
"RTN","GMRCACMT",26,0)
 ; Patch 20 checks to see if GUI v15 is installed to use new
"RTN","GMRCACMT",27,0)
 ; alert code #63
"RTN","GMRCACMT",28,0)
 N GMRCALT
"RTN","GMRCACMT",29,0)
 S GMRCALT=$S($$PATCH^XPDUTL("OR*3.0*85"):63,1:27)
"RTN","GMRCACMT",30,0)
 S NOTIF=$S(ACTION=20:GMRCALT,1:23)
"RTN","GMRCACMT",31,0)
 ; Use NEW SERVICE CONSULT/REQUEST (27) for the ADD COMMENT action to
"RTN","GMRCACMT",32,0)
 ;     prevent the forced PAO entries that occur with the
"RTN","GMRCACMT",33,0)
 ;     CONSULT/REQUEST RESOLUTION (23) notification.
"RTN","GMRCACMT",34,0)
 D SENDMSG(NOTIF,+GMRCO)
"RTN","GMRCACMT",35,0)
 Q
"RTN","GMRCACMT",36,0)
 ;
"RTN","GMRCACMT",37,0)
SENDMSG(NOTIF,GMRCO) ;Send the alert
"RTN","GMRCACMT",38,0)
 N GMRCDFN
"RTN","GMRCACMT",39,0)
 I '$D(GMRCADUZ) S GMRCADUZ=""
"RTN","GMRCACMT",40,0)
 W !,"Processing Alerts..."
"RTN","GMRCACMT",41,0)
 S GMRCDFN=$P($G(^GMR(123,+GMRCO,0)),"^",2)
"RTN","GMRCACMT",42,0)
 S GMRCORTX=$S($L(GMRCORTX):GMRCORTX,1:"Comment Added to Consult ")_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCACMT",43,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTIF,.GMRCADUZ,0)
"RTN","GMRCACMT",44,0)
 Q
"RTN","GMRCACMT",45,0)
 ;
"RTN","GMRCACMT",46,0)
END ;kill off variables and exit
"RTN","GMRCACMT",47,0)
 K GMRC,GMRCA,GMRCMSG,GMRCOM,GMRCO,GMRCORTX,GMRCERR,GMRCERMS,GMRCQUT,GMRCUT
"RTN","GMRCACMT",48,0)
 I $D(DTOUT)!$D(DIROUT) S GMRCQIT=""
"RTN","GMRCACMT",49,0)
 K DTOUT,DIROUT,DUOUT,DIRUT
"RTN","GMRCACMT",50,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCACMT",51,0)
 Q
"RTN","GMRCACMT",52,0)
 ;
"RTN","GMRCACMT",53,0)
WHOTO ;Get the users who should receive an alert
"RTN","GMRCACMT",54,0)
 ;Asks about requesting provider first, then prompts for additional users
"RTN","GMRCACMT",55,0)
 ;Returns GMRCADUZ array of users to send an alert to and GMRCQIT if "^"
"RTN","GMRCACMT",56,0)
 N GMRCRP,GMRCANS
"RTN","GMRCACMT",57,0)
 S GMRCRP=$P($G(^GMR(123,+GMRCO,0)),U,14) ;requesting provider entry
"RTN","GMRCACMT",58,0)
 I +GMRCRP S GMRCRP=$P($G(^VA(200,+GMRCRP,0)),U,1) ;provider name
"RTN","GMRCACMT",59,0)
 ;GMRCRP is now the requestor name or null
"RTN","GMRCACMT",60,0)
 I $L(GMRCRP) D  I GMRCANS[U S GMRCQIT=1 Q
"RTN","GMRCACMT",61,0)
 . S GMRCANS=$$READ("Y","Send Alert To Requesting Provider "_GMRCRP,"N","Enter Y to send an alert to the ordering provider, otherwise enter N.",1)
"RTN","GMRCACMT",62,0)
 . S:GMRCANS=1 GMRCADUZ($P(^GMR(123,+GMRCO,0),"^",14))=""
"RTN","GMRCACMT",63,0)
 . Q
"RTN","GMRCACMT",64,0)
 ;
"RTN","GMRCACMT",65,0)
ANDTO ;Ask for additional recipients
"RTN","GMRCACMT",66,0)
 D NAMELIST("Send Alert to: ",.GMRCADUZ,GMRCDELR)
"RTN","GMRCACMT",67,0)
 Q
"RTN","GMRCACMT",68,0)
 ;
"RTN","GMRCACMT",69,0)
NAMELIST(GMRCP,GMRCOLD,GMRCDELR) ;manage the list of recipients
"RTN","GMRCACMT",70,0)
 ;
"RTN","GMRCACMT",71,0)
 ; GMRCP - Prompt
"RTN","GMRCACMT",72,0)
 ; GMRCOLD - Original list with ordering provider.
"RTN","GMRCACMT",73,0)
 ; GMRCDELR - 1 means the original list may have names deleted
"RTN","GMRCACMT",74,0)
 ; Returns final list in GMRCOLD array
"RTN","GMRCACMT",75,0)
 ;
"RTN","GMRCACMT",76,0)
 N GMRCNEW,GMRCNT,GMRCDUZ,GMRCUSER,GMRCQ,GMRCADD,DIC,X,Y
"RTN","GMRCACMT",77,0)
 ;
"RTN","GMRCACMT",78,0)
 M GMRCNEW=GMRCOLD
"RTN","GMRCACMT",79,0)
 I GMRCDELR=1 K GMRCOLD S GMRCOLD="" ;Remove mandatory users from GMRCOLD
"RTN","GMRCACMT",80,0)
 S GMRCNT=0 F  D  Q:(GMRCUSER[U)
"RTN","GMRCACMT",81,0)
 .S GMRCUSER=$$READ("FAO;3;46",$S(GMRCNT:"And ",1:"")_GMRCP,"","^D NAMEHELP^GMRCACMT")
"RTN","GMRCACMT",82,0)
 .S:'$L(GMRCUSER) GMRCUSER=U Q:(GMRCUSER[U)
"RTN","GMRCACMT",83,0)
 .I ($E(GMRCUSER,1)="-") S GMRCADD=0,GMRCUSER=$E(GMRCUSER,2,$L(GMRCUSER))
"RTN","GMRCACMT",84,0)
 .E  S GMRCADD=1
"RTN","GMRCACMT",85,0)
 .;
"RTN","GMRCACMT",86,0)
 .S X=GMRCUSER,DIC=200,DIC(0)="EMQ" D ^DIC
"RTN","GMRCACMT",87,0)
 .;
"RTN","GMRCACMT",88,0)
 .I (Y>0) D  I 1
"RTN","GMRCACMT",89,0)
 ..;W $E($P(Y,U,2),$L(GMRCUSER)+1,$L($P(Y,U,2)))
"RTN","GMRCACMT",90,0)
 ..;
"RTN","GMRCACMT",91,0)
 ..I GMRCADD D
"RTN","GMRCACMT",92,0)
 ...I $D(GMRCNEW(+Y)) W " already in the list." Q
"RTN","GMRCACMT",93,0)
 ...S GMRCNEW(+Y)="" W " added to the list." S GMRCNT=GMRCNT+1
"RTN","GMRCACMT",94,0)
 ..;
"RTN","GMRCACMT",95,0)
 ..I 'GMRCADD D
"RTN","GMRCACMT",96,0)
 ...I $D(GMRCOLD(+Y)) W " can't delete this name from the list." Q
"RTN","GMRCACMT",97,0)
 ...I '$D(GMRCNEW(+Y)) W " not currently in the list." Q
"RTN","GMRCACMT",98,0)
 ...K GMRCNEW(+Y) S GMRCNT=GMRCNT-1 W " deleted from the list."
"RTN","GMRCACMT",99,0)
 .;
"RTN","GMRCACMT",100,0)
 .E  I $L(GMRCUSER) W "  Name not found."
"RTN","GMRCACMT",101,0)
 ;
"RTN","GMRCACMT",102,0)
 M GMRCOLD=GMRCNEW
"RTN","GMRCACMT",103,0)
 Q
"RTN","GMRCACMT",104,0)
 ;
"RTN","GMRCACMT",105,0)
READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) ;read logic
"RTN","GMRCACMT",106,0)
 ;
"RTN","GMRCACMT",107,0)
 ;  GMRC0 -> DIR(0) --- Type of read
"RTN","GMRCACMT",108,0)
 ;  GMRCA -> DIR("A") - Prompt
"RTN","GMRCACMT",109,0)
 ;  GMRCB -> DIR("B") - Default Answer
"RTN","GMRCACMT",110,0)
 ;  GMRCH -> DIR("?") - Help text or ^Execute code
"RTN","GMRCACMT",111,0)
 ;  GMRCL -> Number of blank lines to put before Prompt
"RTN","GMRCACMT",112,0)
 ;
"RTN","GMRCACMT",113,0)
 ;  Returns "^" or answer
"RTN","GMRCACMT",114,0)
 ;
"RTN","GMRCACMT",115,0)
 N GMRCLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","GMRCACMT",116,0)
 Q:'$L($G(GMRC0)) U
"RTN","GMRCACMT",117,0)
 S DIR(0)=GMRC0
"RTN","GMRCACMT",118,0)
 S:$L($G(GMRCA)) DIR("A")=GMRCA
"RTN","GMRCACMT",119,0)
 S:$L($G(GMRCB)) DIR("B")=GMRCB
"RTN","GMRCACMT",120,0)
 S:$L($G(GMRCH)) DIR("?")=GMRCH
"RTN","GMRCACMT",121,0)
 F GMRCLINE=1:1:($G(GMRCL)-1) W !
"RTN","GMRCACMT",122,0)
 D ^DIR
"RTN","GMRCACMT",123,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","GMRCACMT",124,0)
 Q Y
"RTN","GMRCACMT",125,0)
 ;
"RTN","GMRCACMT",126,0)
 ;
"RTN","GMRCACMT",127,0)
NAMEHELP ;Help for the recipient list logic
"RTN","GMRCACMT",128,0)
 N GMRCDUZ
"RTN","GMRCACMT",129,0)
 W !,"Enter the name of the user to send the alert to,"
"RTN","GMRCACMT",130,0)
 W !," or put a '-' in front of a name to delete from the list."
"RTN","GMRCACMT",131,0)
 W !
"RTN","GMRCACMT",132,0)
 W !,"  Example:"
"RTN","GMRCACMT",133,0)
 W !,"     SMITH,FRED  ->  to add Fred to the list."
"RTN","GMRCACMT",134,0)
 W !,"     -SMITH,FRED ->  to delete Fred from the list."
"RTN","GMRCACMT",135,0)
 W !,"Already selected: "
"RTN","GMRCACMT",136,0)
 W !
"RTN","GMRCACMT",137,0)
 S GMRCDUZ=0 F  S GMRCDUZ=$O(GMRCNEW(GMRCDUZ)) Q:'GMRCDUZ  D
"RTN","GMRCACMT",138,0)
 .W !,?5,$P(^VA(200,GMRCDUZ,0),U,1)
"RTN","GMRCACMT",139,0)
 .W:$D(GMRCOLD(GMRCDUZ)) "  <mandatory>"
"RTN","GMRCACMT",140,0)
 W !
"RTN","GMRCACMT",141,0)
 Q
"RTN","GMRCACMT",142,0)
 ;
"RTN","GMRCGUIB")
0^2^B34510085
"RTN","GMRCGUIB",1,0)
GMRCGUIB ;SLC/DCM,JFR,MA - GUI actions for consults ;1/11/01  12:53
"RTN","GMRCGUIB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,18,20**;DEC 27, 1997
"RTN","GMRCGUIB",3,0)
 ; This routine invokes IA #2980
"RTN","GMRCGUIB",4,0)
 ;
"RTN","GMRCGUIB",5,0)
SETDA() ;set DA of where audit actions are to be filed
"RTN","GMRCGUIB",6,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^GMR(123,GMRCO,40,0)="^123.02DA^^"
"RTN","GMRCGUIB",7,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1)
"RTN","GMRCGUIB",8,0)
 S $P(^GMR(123,+GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCGUIB",9,0)
 Q DA
"RTN","GMRCGUIB",10,0)
REASON(GMRCFN,GMRCRQ,GMRCDT) ;Load the reason for the request into ^GMR(123,GMRCO,20
"RTN","GMRCGUIB",11,0)
 ;GMRCFN=File 123 IFN; GMRCRQ=Array containing Reason For Request
"RTN","GMRCGUIB",12,0)
 ;GMRCDT=Date time of entry
"RTN","GMRCGUIB",13,0)
 S ^GMR(123,GMRCFN,20,0)="^^^"_GMRCDT_"^"
"RTN","GMRCGUIB",14,0)
 S L=0,LN=1 F  S L=$O(GMRCRQ(L)) Q:L=""  S ^GMR(123,GMRCFN,20,LN,0)=GMRCRQ(L),LN=LN+1
"RTN","GMRCGUIB",15,0)
 S LN=LN-1,$P(^GMR(123,GMRCFN,20,0),"^",3)=LN
"RTN","GMRCGUIB",16,0)
 K LN,L
"RTN","GMRCGUIB",17,0)
 Q
"RTN","GMRCGUIB",18,0)
SETCOM(COMMENT,WHO) ;Set comment array into tracking actions
"RTN","GMRCGUIB",19,0)
 N GMRCNOW,DR,DIE
"RTN","GMRCGUIB",20,0)
 S GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",21,0)
 S DIE="^GMR(123,GMRCO,40,",DA(1)=GMRCO,DR=".01////^S X=GMRCNOW;1////^S X=GMRCA;2////^S X=GMRCAD;3////^S X=$G(GMRCORNP);4////^S X=$S($G(WHO):WHO,1:DUZ);6////^S X=$G(GMRCFR);8////^S X=$G(GMRCFF)"
"RTN","GMRCGUIB",22,0)
 D ^DIE
"RTN","GMRCGUIB",23,0)
 S ^GMR(123,GMRCO,40,DA,1,0)="^^^^"_GMRCAD_"^"
"RTN","GMRCGUIB",24,0)
 S (GMRCND,GMRCND1)=0 F  S GMRCND1=$O(COMMENT(GMRCND1)) Q:GMRCND1=""  S GMRCND=GMRCND+1,^GMR(123,GMRCO,40,DA,1,GMRCND,0)=COMMENT(GMRCND)
"RTN","GMRCGUIB",25,0)
 S $P(^GMR(123,GMRCO,40,DA,1,0),"^",3)=GMRCND,$P(^(0),"^",4)=GMRCND,^GMR(123,GMRCO,40,"B",GMRCNOW,DA)=""
"RTN","GMRCGUIB",26,0)
 K GMRCND,GMRCND1
"RTN","GMRCGUIB",27,0)
 Q
"RTN","GMRCGUIB",28,0)
CMT(GMRCO,GMRCOM,GMRCADUZ,GMRCWHN,GMRCWHO) ;add comment to consult record
"RTN","GMRCGUIB",29,0)
 ; GMRCO = IEN from file 123
"RTN","GMRCGUIB",30,0)
 ; GMRCOM = array of comments in format GMRCOM(1)="xxxx", GMRCOM(2)="xxx"
"RTN","GMRCGUIB",31,0)
 ; GMRCADUZ= array of alert recipients as GMRCADUZ(DUZ)="" (optional)
"RTN","GMRCGUIB",32,0)
 ; GMRCWHO= IEN from file 200 who's responsible activity (optional)
"RTN","GMRCGUIB",33,0)
 ; GMRCWHN= date time of activity in FM format
"RTN","GMRCGUIB",34,0)
 ;
"RTN","GMRCGUIB",35,0)
 N DA,GMRCA,GMRCAD,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",36,0)
 S DA=$$SETDA ; get next activity tracking entry
"RTN","GMRCGUIB",37,0)
 S GMRCA=20,GMRCAD=GMRCWHN S:$G(GMRCWHO) GMRCORNP=GMRCWHO
"RTN","GMRCGUIB",38,0)
 D SETCOM(.GMRCOM,$G(GMRCWHO))
"RTN","GMRCGUIB",39,0)
 Q:'$D(GMRCADUZ)
"RTN","GMRCGUIB",40,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCGUIB",41,0)
 S GMRCORTX="Comment Added to Consult "
"RTN","GMRCGUIB",42,0)
 S GMRCORTX=GMRCORTX_$$GET1^DIQ(123.5,$P(^GMR(123,+GMRCO,0),U,5),.01)
"RTN","GMRCGUIB",43,0)
 ;
"RTN","GMRCGUIB",44,0)
 ; Patch 18 changed MSG 27 to 63 "Consult/request update"
"RTN","GMRCGUIB",45,0)
 ; Patch 20 checks to see if GUI v15 is installed to use new
"RTN","GMRCGUIB",46,0)
 ; alert code #63
"RTN","GMRCGUIB",47,0)
 N GMRCALT
"RTN","GMRCGUIB",48,0)
 S GMRCALT=$S($$PATCH^XPDUTL("OR*3.0*85"):63,1:27)
"RTN","GMRCGUIB",49,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,GMRCALT,.GMRCADUZ,0)
"RTN","GMRCGUIB",50,0)
 Q
"RTN","GMRCGUIB",51,0)
SFILE(GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD) ;Process various file update functions from the GUI for a consult
"RTN","GMRCGUIB",52,0)
 ; ADMIN COMPLETE or SIGNIFICANT FINDINGS
"RTN","GMRCGUIB",53,0)
 ;Input variables:
"RTN","GMRCGUIB",54,0)
 ;GMRCO=File 123 IEN of the consult record
"RTN","GMRCGUIB",55,0)
 ;GMRCA=pointer to REQUEST ACTION TYPES (#123.1) 10=complete, 4=Sig find.
"RTN","GMRCGUIB",56,0)
 ;GMRCSF=Significant Findings flag: 'Y'= significant finding
"RTN","GMRCGUIB",57,0)
 ;                                : 'N'= no significant finding
"RTN","GMRCGUIB",58,0)
 ;                                : 'U'=unknown significant finding
"RTN","GMRCGUIB",59,0)
 ;GMRCORNP=Provider Responsible for action
"RTN","GMRCGUIB",60,0)
 ;GMRCDUZ=Person actually doing the action
"RTN","GMRCGUIB",61,0)
 ;GMRCOM=An array of comments by reference ARRAY(1)="xxx",ARRAY(2)="xxx"
"RTN","GMRCGUIB",62,0)
 ;GMRCALF=Flag to signal that alerts are to be sent; 'N'=NO, 'Y'=YES
"RTN","GMRCGUIB",63,0)
 ;GMRCATO=Who alerts are to be sent to; a comma delimited string of DUZ's
"RTN","GMRCGUIB",64,0)
 ;GMRCAD =FM date/time of activity
"RTN","GMRCGUIB",65,0)
 ;
"RTN","GMRCGUIB",66,0)
 ;Output:
"RTN","GMRCGUIB",67,0)
 ; GMRCERR=Error Flag: 0 if no error, 1 if error occurred 
"RTN","GMRCGUIB",68,0)
 ; GMRCERMS - Error message or null
"RTN","GMRCGUIB",69,0)
 ;    returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",70,0)
 ;
"RTN","GMRCGUIB",71,0)
 N GMRCERR,GMRCERMS
"RTN","GMRCGUIB",72,0)
 L +^GMR(123,GMRCO):5 I '$T S GMRCERR=1,GMRCERMS="Record Locked. File Update Not Accomplished." Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",73,0)
 S GMRCERR=0,GMRCERMS="",DR="",GMRCORTX=""
"RTN","GMRCGUIB",74,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCGUIB",75,0)
 S GMRCNOW=$$NOW^XLFDT,GMRCSTS=$P(^GMR(123,+GMRCO,0),"^",12),GMRCDFN=$P(^(0),"^",2)
"RTN","GMRCGUIB",76,0)
 I '$G(GMRCDUZ) S GMRCDUZ=DUZ
"RTN","GMRCGUIB",77,0)
 I '$G(GMRCAD) S GMRCAD=GMRCNOW
"RTN","GMRCGUIB",78,0)
 I +$G(GMRCA),GMRCA=10 D
"RTN","GMRCGUIB",79,0)
 .S GMRCSF=$G(GMRCSF,"")
"RTN","GMRCGUIB",80,0)
 .S GMRCSTS=2
"RTN","GMRCGUIB",81,0)
 .S DR="8////^S X=GMRCSTS;9////^S X=GMRCA"
"RTN","GMRCGUIB",82,0)
 .S GMRCORTX="Completed Consult "_$$ORTX^GMRCAU(+GMRCO)_$S(GMRCSF="Y":" with Sig Findings",GMRCSF="N":" with no Sig Findings",1:"")
"RTN","GMRCGUIB",83,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",84,0)
 .Q
"RTN","GMRCGUIB",85,0)
 I $G(GMRCALF)=1 D
"RTN","GMRCGUIB",86,0)
 .N I
"RTN","GMRCGUIB",87,0)
 .F I=1:1  S X=$P(GMRCATO,";",I) Q:X=""  S GMRCADUZ(X)=""
"RTN","GMRCGUIB",88,0)
 .Q
"RTN","GMRCGUIB",89,0)
 I $L(GMRCA),GMRCA=4 S DR=DR_$S($L(DR):";",1:"")_"9////^S X=GMRCA;15////^S X=GMRCSF" D
"RTN","GMRCGUIB",90,0)
 .S GMRCORTX=$S(GMRCSF="Y":"Sig Findings ",GMRCSF="N":"No Sig Findings ",1:"Unknown Sig Findings ")_"for consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",91,0)
 .I $P($G(^GMR(123,+GMRCO,0)),U,14) S GMRCADUZ($P($G(^(0)),U,14))=""
"RTN","GMRCGUIB",92,0)
 .Q
"RTN","GMRCGUIB",93,0)
 I $L(DR) S DIE="^GMR(123,",DA=GMRCO D ^DIE K DIE,DR
"RTN","GMRCGUIB",94,0)
 I '$O(GMRCOM(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",95,0)
 I $D(GMRCOM),$O(GMRCOM(0)) D
"RTN","GMRCGUIB",96,0)
 .N DA
"RTN","GMRCGUIB",97,0)
 .S DA=$$SETDA()
"RTN","GMRCGUIB",98,0)
 .D SETCOM(.GMRCOM,GMRCDUZ)
"RTN","GMRCGUIB",99,0)
 .Q
"RTN","GMRCGUIB",100,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCGUIB",101,0)
 ;
"RTN","GMRCGUIB",102,0)
 ; Patch #18 changed GMRCA=20:27 TO 20:63
"RTN","GMRCGUIB",103,0)
 ; Patch 20 checks to see if GUI v15 is installed to use new
"RTN","GMRCGUIB",104,0)
 ; alert code #63
"RTN","GMRCGUIB",105,0)
 N GMRCALT
"RTN","GMRCGUIB",106,0)
 S GMRCALT=$S($$PATCH^XPDUTL("OR*3.0*85"):63,1:27)
"RTN","GMRCGUIB",107,0)
 I +$G(GMRCALF) D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,$S(GMRCA=20:GMRCALT,1:23),.GMRCADUZ,0)
"RTN","GMRCGUIB",108,0)
 I $S(GMRCA=10:1,1:0) D EN^GMRCHL7($P(^GMR(123,GMRCO,0),"^",2),GMRCO,$G(GMRCTYPE),$G(GMRCRB),"RE",GMRCORNP,$G(GMRCVSIT),.GMRCOM,,GMRCAD)
"RTN","GMRCGUIB",109,0)
 K DIE,DR,DA,GMRCDT,GMRCNOW,GMRCAD,GMRCORNP,GMRCDUZ,GMRCRSLT,GMRCSTS,GMRCADUZ,GMRCORTX,GMRCDFN
"RTN","GMRCGUIB",110,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",111,0)
 ;
"RTN","GMRCGUIB",112,0)
SCH(GMRCO,GMRCORNP,GMRCAD,GMRCADUZ,GMRCMT) ;schedule a consult API
"RTN","GMRCGUIB",113,0)
 ; Input variables:
"RTN","GMRCGUIB",114,0)
 ;GMRCO - The internal file number of the consult from File 123
"RTN","GMRCGUIB",115,0)
 ;GMRCORNP - Name of the person who actually 'Received' the consult 
"RTN","GMRCGUIB",116,0)
 ;GMRCAD - Actual date time that consult was received into the service.
"RTN","GMRCGUIB",117,0)
 ;GMRCADUZ - array of alert recipients as chosen by user (by reference)
"RTN","GMRCGUIB",118,0)
 ;   ARRAY(DUZ)="" 
"RTN","GMRCGUIB",119,0)
 ;GMRCMT - array of comments if entered (by reference)
"RTN","GMRCGUIB",120,0)
 ;   ARRAY(1)="FIRST LINE OF COMMENT"
"RTN","GMRCGUIB",121,0)
 ;   ARRAY(2)="SECOND LINE OF COMMENT"
"RTN","GMRCGUIB",122,0)
 ;
"RTN","GMRCGUIB",123,0)
 ;Output:
"RTN","GMRCGUIB",124,0)
 ;GMRCERR - Error Condition Code: 0 = NO error, 1=error
"RTN","GMRCGUIB",125,0)
 ;GMRCERMS - Error message or null
"RTN","GMRCGUIB",126,0)
 ;  returned as GMRCERR^GMRCERMS
"RTN","GMRCGUIB",127,0)
        ;
"RTN","GMRCGUIB",128,0)
 N DFN,GMRCSTS,GMRCNOW,GMRCERR,GMRCERMS
"RTN","GMRCGUIB",129,0)
 S GMRCERR=0,GMRCERMS="",GMRCNOW=$$NOW^XLFDT
"RTN","GMRCGUIB",130,0)
 S:$G(GMRCAD)="" GMRCAD=GMRCNOW
"RTN","GMRCGUIB",131,0)
 S:'$G(GMRCDUZ) GMRCDUZ=DUZ
"RTN","GMRCGUIB",132,0)
 S DFN=$P($G(^GMR(123,GMRCO,0)),"^",2) I DFN="" D  Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",133,0)
 . S GMRCERR="1",GMRCERMS="Not A Valid Consult - File Not Found."
"RTN","GMRCGUIB",134,0)
 . D EXIT^GMRCGUIA
"RTN","GMRCGUIB",135,0)
 S GMRCSTS=8,GMRCA=8
"RTN","GMRCGUIB",136,0)
 D STATUS^GMRCP I $D(GMRCQUT) D EXIT^GMRCGUIA Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",137,0)
 I '$O(GMRCMT(0)) D AUDIT^GMRCP
"RTN","GMRCGUIB",138,0)
 I $O(GMRCMT(0)) D
"RTN","GMRCGUIB",139,0)
 . S DA=$$SETDA
"RTN","GMRCGUIB",140,0)
 . D SETCOM(.GMRCMT,GMRCDUZ)
"RTN","GMRCGUIB",141,0)
 D EN^GMRCHL7(DFN,GMRCO,"","","SC",GMRCORNP,"","","",GMRCAD)
"RTN","GMRCGUIB",142,0)
 I $D(GMRCADUZ),$O(GMRCMT(0)) D
"RTN","GMRCGUIB",143,0)
 . N TXT S TXT="Scheduled Consult: "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCGUIB",144,0)
 . ; Patch 18 changed alert 27 to 63 "Consult/request update"
"RTN","GMRCGUIB",145,0)
 . ; Patch 20 checks to see if GUI v15 is installed to use new
"RTN","GMRCGUIB",146,0)
 . ; alert code #63
"RTN","GMRCGUIB",147,0)
 . N GMRALERT
"RTN","GMRCGUIB",148,0)
 . S GMRALERT=$S($$PATCH^XPDUTL("OR*3.0*85"):63,1:27)
"RTN","GMRCGUIB",149,0)
 . D MSG^GMRCP(DFN,TXT,GMRCO,GMRALERT,.GMRCADUZ,0)
"RTN","GMRCGUIB",150,0)
 D EXIT^GMRCGUIA
"RTN","GMRCGUIB",151,0)
 Q GMRCERR_"^"_GMRCERMS
"RTN","GMRCGUIB",152,0)
DOCLIST(GMRCAR,GMRCDA)  ;return list of linked TIU documents
"RTN","GMRCGUIB",153,0)
 ; Input:
"RTN","GMRCGUIB",154,0)
 ;  GMRCAR - array to return list, passed by reference
"RTN","GMRCGUIB",155,0)
 ;  GMRCDA - ien from file 123
"RTN","GMRCGUIB",156,0)
 ;
"RTN","GMRCGUIB",157,0)
 ; Output:
"RTN","GMRCGUIB",158,0)
 ;  GMRCAR - array in format
"RTN","GMRCGUIB",159,0)
 ;       GMRCAR(0)=zero node of record
"RTN","GMRCGUIB",160,0)
 ;       GMRCAR(50,1)="ien;TIU(8925,"
"RTN","GMRCGUIB",161,0)
 ;       GMRCAR(50,2)="ien;TIU(8925,"
"RTN","GMRCGUIB",162,0)
 ;
"RTN","GMRCGUIB",163,0)
 I '$D(^GMR(123,GMRCDA,0)) Q
"RTN","GMRCGUIB",164,0)
 S GMRCAR(0)=^GMR(123,GMRCDA,0),$P(GMRCAR(0),U,20)=""
"RTN","GMRCGUIB",165,0)
 N RES,CNT S RES="",CNT=1
"RTN","GMRCGUIB",166,0)
 F  S RES=$O(^GMR(123,GMRCDA,50,"B",RES)) Q:RES=""  D
"RTN","GMRCGUIB",167,0)
 . Q:RES'["TIU(8925"
"RTN","GMRCGUIB",168,0)
 . S GMRCAR(50,CNT)=RES,CNT=CNT+1
"RTN","GMRCGUIB",169,0)
 Q
"RTN","GMRCGUIC")
0^3^B49669344
"RTN","GMRCGUIC",1,0)
GMRCGUIC ;SLC/DCM,JFR,MA - GUI actions for editing consults ;1/18/01  08:59
"RTN","GMRCGUIC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,20**;DEC 27, 1997
"RTN","GMRCGUIC",3,0)
 ;
"RTN","GMRCGUIC",4,0)
 ; This routine invokes IA #2398,#2698,#2713,#2960
"RTN","GMRCGUIC",5,0)
 ;
"RTN","GMRCGUIC",6,0)
RFQ(GMRCO,MSG,ND,NOW) ;File Reason For Request field 20
"RTN","GMRCGUIC",7,0)
 N GMRCND,GMRCNT
"RTN","GMRCGUIC",8,0)
 S GMRCND=$O(^GMR(123,GMRCO,20,0)) I GMRCND="" S GMRCFLD(20)="Reason For Request: No Previous Value^20" Q
"RTN","GMRCGUIC",9,0)
 M ^TMP("GMRCFLD20",$J,20)=^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",10,0)
 S GMRCFLD(20)=$NAME(^TMP("GMRCFLD20",$J,20))
"RTN","GMRCGUIC",11,0)
 K ^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",12,0)
 S ^GMR(123,GMRCO,20,0)="^^^^"_DT_"^"
"RTN","GMRCGUIC",13,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,20,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIC",14,0)
 S $P(^GMR(123,GMRCO,20,0),"^",3)=GMRCNT-1,$P(^(0),"^",4)=GMRCNT-1
"RTN","GMRCGUIC",15,0)
 Q
"RTN","GMRCGUIC",16,0)
FILE(GMRCO,MSG,GMRCLM) ;File Edit changes
"RTN","GMRCGUIC",17,0)
 ;GMRCO=Record IEN,  GMRCCOM=Comment Array
"RTN","GMRCGUIC",18,0)
 ;MSG=^TMP global where the data resides, i.e., MSG="^TMP(""GMRCR"",$J)"
"RTN","GMRCGUIC",19,0)
 ;    Data is stored in subscripted nodes: ^TMP("GMRCR",$J,1)="GMRCSS^2"
"RTN","GMRCGUIC",20,0)
 ;    Word processing data is stored in second subscripted node:
"RTN","GMRCGUIC",21,0)
 ;    ^TMP("GMRCR",$J,9,1)="This is word processing data."
"RTN","GMRCGUIC",22,0)
 ;GMRCSS=To Service     GMRCPROC=procedure/Request Type
"RTN","GMRCGUIC",23,0)
 ;GMRCURG=Urgency       GMRCPL=Place Of Consultation
"RTN","GMRCGUIC",24,0)
 ;GMRCATN=Attention To  GMRCINO=Service is In/Out Patient
"RTN","GMRCGUIC",25,0)
 ;GMRCDIAG=Provisional Diagnosis  .GMRCRFQ=Reason For Request array
"RTN","GMRCGUIC",26,0)
 ;GMRCREQ=Procedure or Request; i.e., GMRCRQT=1727=^ORD(101,1727,0)='Procedure';GMRCRQT=1296=^ORD(101,1296,0)='Consult'
"RTN","GMRCGUIC",27,0)
 ;GMRCITM=Item ordered for field .1 (stored in ^GMR(123,GMRCO,1.11,
"RTN","GMRCGUIC",28,0)
 ;GMRCLM=coming from List Manager instead of the GUI
"RTN","GMRCGUIC",29,0)
 ;
"RTN","GMRCGUIC",30,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",31,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCRQT
"RTN","GMRCGUIC",32,0)
 N GMRCION,GMRCDIAG,GMRCDXCD
"RTN","GMRCGUIC",33,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCGUIC",34,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCGUIC",35,0)
 F  S GMRCNOD=$O(@MSG@(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=@MSG@(GMRCNOD) D
"RTN","GMRCGUIC",36,0)
 .I $P(GMRCMSG,"^",1)="COMMENT" D COMMENT^GMRCGUIU(GMRCO,MSG,GMRCNOD,$P(GMRCMSG,"^",2)) Q
"RTN","GMRCGUIC",37,0)
 .I $P(GMRCMSG,"^",1)="GMRCRFQ" D RFQ(GMRCO,MSG,GMRCNOD,GMRCDT) Q
"RTN","GMRCGUIC",38,0)
 .I $P(GMRCMSG,"^",1)="GMRCSS" S GMRCSS=$P(GMRCMSG,"^",2),GMRCFLD(1)=$P(^GMR(123.5,$P(^GMR(123,GMRCO,0),"^",5),0),"^",1)_"^1" Q
"RTN","GMRCGUIC",39,0)
 .I $P(GMRCMSG,"^",1)="GMRCITM" S GMRCITM=$P(GMRCMSG,"^",2),GMRCFLD(.1)=^GMR(123,GMRCO,1.11)_"^.1" Q
"RTN","GMRCGUIC",40,0)
 .I $P(GMRCMSG,"^",1)="GMRCPROC" Q  ;S GMRCFLD(4)=+$P(^GMR(123,+GMRCO,0),"^",8)_"^4" D  Q ;ignore procedure, can't be changed currently
"RTN","GMRCGUIC",41,0)
 .; ..S GMRCPROC=$P(GMRCMSG,"^",2) I $L($P(^GMR(123,GMRCO,0),"^",8)),$P(GMRCMSG,"^",2)="" S GMRCPROC="DELETE"
"RTN","GMRCGUIC",42,0)
 .I $P(GMRCMSG,"^",1)="GMRCURG" S GMRCURG=$P(GMRCMSG,"^",2),GMRCFLD(5)=$S(+$P(^GMR(123,+GMRCO,0),"^",9):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",9),0),"^",2),1:"")_"^"_$P(^GMR(123,+GMRCO,0),"^",9) Q
"RTN","GMRCGUIC",43,0)
 .I $P(GMRCMSG,"^",1)="GMRCPL" D  Q
"RTN","GMRCGUIC",44,0)
 ..S GMRCPL=$P(GMRCMSG,"^",2) I '+GMRCPL D
"RTN","GMRCGUIC",45,0)
 ...S GMRCPL="GMRCPLACE - "_$S(GMRCPL="C":"ON CALL",GMRCPL="B":"BEDSIDE",GMRCPL="E":"EMERGENCY ROOM",1:GMRCPL),GMRCPL=$O(^ORD(101,"B",GMRCPL,0))
"RTN","GMRCGUIC",46,0)
 ..S GMRCFLD(6)=$S(+$P(^GMR(123,+GMRCO,0),"^",10):$P($P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",10),0),"^",1)," - ",2),1:"")_"^6"
"RTN","GMRCGUIC",47,0)
 ..Q
"RTN","GMRCGUIC",48,0)
 .I $P(GMRCMSG,"^",1)="GMRCATN" S GMRCATN=$P(GMRCMSG,"^",2),GMRCFLD(7)=$S(+$P(^GMR(123,+GMRCO,0),"^",11):$P(^VA(200,+$P(^GMR(123,+GMRCO,0),"^",11),0),"^",1),1:"")_"^7" Q
"RTN","GMRCGUIC",49,0)
 .I $P(GMRCMSG,"^",1)="GMRCREQ" S GMRCREQ=$P(GMRCMSG,"^",2),GMRCFLD(13)=$S(+$P(^GMR(123,+GMRCO,0),"^",17):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",17),0),"^",2),1:"")_"^13" Q
"RTN","GMRCGUIC",50,0)
 .I $P(GMRCMSG,"^",1)="GMRCION" S GMRCION=$P(GMRCMSG,"^",2),GMRCFLD(14)=$S($P(^GMR(123,+GMRCO,0),"^",18)="I":"Inpatient",$P(^(0),"^",18)="O":"Outpatient",1:"")_"^14" Q
"RTN","GMRCGUIC",51,0)
 .I $P(GMRCMSG,"^",1)="GMRCDIAG" D  Q
"RTN","GMRCGUIC",52,0)
 ..S GMRCDIAG=$P(GMRCMSG,"^",2)
"RTN","GMRCGUIC",53,0)
 ..S GMRCFLD(30)=$G(^GMR(123,+GMRCO,30))_"^30"
"RTN","GMRCGUIC",54,0)
 ..I $P(GMRCFLD(30),U)="" S $P(GMRCFLD(30),U)="No Previous Value"
"RTN","GMRCGUIC",55,0)
 ..I $L($P(GMRCMSG,U,3)) D
"RTN","GMRCGUIC",56,0)
 ...S GMRCDXCD=$P(GMRCMSG,"^",3)
"RTN","GMRCGUIC",57,0)
 ...S GMRCFLD(30.1)=$G(^GMR(123,+GMRCO,30.1))
"RTN","GMRCGUIC",58,0)
 .Q
"RTN","GMRCGUIC",59,0)
 S:'$D(GMRCLM) GMRCGUIF=1
"RTN","GMRCGUIC",60,0)
 D EN^GMRCEDT3(GMRCO)
"RTN","GMRCGUIC",61,0)
 S DR=$$SETDA^GMRCGUIU($G(GMRCSS),$G(GMRCPROC),$G(GMRCURG),$G(GMRCPL),$G(GMRCATN),$G(GMRCRQT),$G(GMRCION),$G(GMRCDIAG),$G(GMRCDXCD)) I $L(DR) D
"RTN","GMRCGUIC",62,0)
 .S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIC",63,0)
 .L +^GMR(123,GMRCO)
"RTN","GMRCGUIC",64,0)
 .D ^DIE
"RTN","GMRCGUIC",65,0)
 .S DR="8////^S X=5;9////^S X=11"
"RTN","GMRCGUIC",66,0)
 .D ^DIE
"RTN","GMRCGUIC",67,0)
 .L -^GMR(123,GMRCO)
"RTN","GMRCGUIC",68,0)
 .K DIE,DR,DA
"RTN","GMRCGUIC",69,0)
 .Q
"RTN","GMRCGUIC",70,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14),GMRCTYPE=$P(^(0),"^",17),GMRCTRLC="XX^RESUBMIT",VISIT="",RMBED=""
"RTN","GMRCGUIC",71,0)
 D EN^GMRCHL7(DFN,+GMRCO,GMRCTYPE,RMBED,GMRCTRLC,$G(DUZ),VISIT,.GMRCOM)
"RTN","GMRCGUIC",72,0)
 S GMRCSVC=$S($G(GMRCSS):GMRCSS,1:$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCGUIC",73,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIC",74,0)
 S GMRCORTX=GMRCORTX_$S($G(GMRCURG):" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",+$P(^GMR(123,+GMRCO,0),U,9):"( "_$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),U,9),0),"^",2)_" )",1:"")
"RTN","GMRCGUIC",75,0)
 S GMRCFL=1
"RTN","GMRCGUIC",76,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,GMRCFL) ;Send notification of NEW consult
"RTN","GMRCGUIC",77,0)
 D PRNT^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5),+GMRCO) ;send 513 to service
"RTN","GMRCGUIC",78,0)
 ;Next line gets rid of alert
"RTN","GMRCGUIC",79,0)
 I $D(XQAID),$L(XQAID) D
"RTN","GMRCGUIC",80,0)
 . N GMRCCORY
"RTN","GMRCGUIC",81,0)
 . S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.GMRCCORY,XQAID)
"RTN","GMRCGUIC",82,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",83,0)
 Q
"RTN","GMRCGUIC",84,0)
SEND(GMRCO,GLOBAL) ;Get data fields to send to GUI for editing consult
"RTN","GMRCGUIC",85,0)
 ;GMRCO=record being edited GLOBAL=Global Referece, i.e., "^TMP("GMRCR",$J)"
"RTN","GMRCGUIC",86,0)
 K @GLOBAL
"RTN","GMRCGUIC",87,0)
 N ND,GMRCSX,TYPE,NDX
"RTN","GMRCGUIC",88,0)
 S ND=1,GMRCSX=""
"RTN","GMRCGUIC",89,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",90,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:'$L(GMRC(0))
"RTN","GMRCGUIC",91,0)
 S GMRCSS=$P(GMRC(0),"^",5),GMRCPROC=$P(GMRC(0),"^",8)
"RTN","GMRCGUIC",92,0)
 S GMRCURG=$P(GMRC(0),"^",9),GMRCPL=$P(GMRC(0),"^",10)
"RTN","GMRCGUIC",93,0)
 S GMRCATN=$P(GMRC(0),"^",11),GMRCINO=$P(GMRC(0),"^",18)
"RTN","GMRCGUIC",94,0)
 S GMRCREQ=$P(GMRC(0),"^",17)
"RTN","GMRCGUIC",95,0)
 S GMRCDIAG=$G(^GMR(123,+GMRCO,30)) I $L($G(^(30.1))) D
"RTN","GMRCGUIC",96,0)
 . S GMRCDIAG=GMRCDIAG_U_$G(^GMR(123,+GMRCO,30.1))
"RTN","GMRCGUIC",97,0)
 S GMRCPROV=$S($P(^GMR(123,+GMRCO,0),U,14):$$GET1^DIQ(200,+$P(^(0),U,14),.01),1:"")
"RTN","GMRCGUIC",98,0)
 S @GLOBAL@(ND,0)="~SERVICE",ND=ND+1
"RTN","GMRCGUIC",99,0)
 I +GMRCSS S GMRCSX=$P(^GMR(123.5,GMRCSS,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCSX_"^"_GMRCSS_"^",ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",100,0)
 E  S @GLOBAL@(ND,0)="d"_"^^",ND=ND+1
"RTN","GMRCGUIC",101,0)
 S @GLOBAL@(ND,0)="~PROCEDURE",ND=ND+1
"RTN","GMRCGUIC",102,0)
 I $L(GMRCPROC),+GMRCPROC D
"RTN","GMRCGUIC",103,0)
 .S GMRCSX=$$UP^XLFSTR($$GET1^DIQ(101,+GMRCPROC,1))
"RTN","GMRCGUIC",104,0)
 .S GMRCSY=$S($L(GMRCSX):$$FIND1^DIC(101.43,"","QX",GMRCSX,"S.PROC"),1:"")
"RTN","GMRCGUIC",105,0)
 .I +GMRCSY D
"RTN","GMRCGUIC",106,0)
 ..S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX,ND=ND+1
"RTN","GMRCGUIC",107,0)
 ..Q
"RTN","GMRCGUIC",108,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",109,0)
 S @GLOBAL@(ND,0)="~TYPE",ND=ND+1
"RTN","GMRCGUIC",110,0)
 I +GMRCREQ S GMRCSX=$P($P(^ORD(101,GMRCREQ,0),"^",1),"GMRCOR ",2),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCREQ,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",111,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",112,0)
 S @GLOBAL@(ND,0)="~CATEGORY",ND=ND+1
"RTN","GMRCGUIC",113,0)
 I $L(GMRCINO) D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",114,0)
 .S @GLOBAL@(ND,0)="d"_GMRCINO_"^"_$S(GMRCINO="I":"INPATIENT",1:"OUTPATIENT")_"^"
"RTN","GMRCGUIC",115,0)
 .S @GLOBAL@(ND,0)=@GLOBAL@(ND,0)_$S(GMRCINO="I":$O(^ORD(101,"B","GMRCURGENCYM CSLT - INPATIENT",0)),1:$O(^ORD(101,"B","GMRCURGENCYM - OUTPATIENT",0)))
"RTN","GMRCGUIC",116,0)
 .Q
"RTN","GMRCGUIC",117,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",118,0)
 S @GLOBAL@(ND,0)="~DIAGNOSIS",ND=ND+1
"RTN","GMRCGUIC",119,0)
 I $L(GMRCDIAG) S @GLOBAL@(ND,0)="d"_GMRCDIAG,ND=ND+1
"RTN","GMRCGUIC",120,0)
 E  S @GLOBAL@(ND,0)="d"
"RTN","GMRCGUIC",121,0)
 S @GLOBAL@(ND,0)="~PLACE",ND=ND+1
"RTN","GMRCGUIC",122,0)
 I +GMRCPL D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",123,0)
 .S GMRCSX=$P($P(^ORD(101,GMRCPL,0),"^",1),"GMRCPLACE - ",2),GMRCSX=$S(GMRCSX="ON CALL":"CONSULTANTS CHOICE",1:GMRCSX),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCPL
"RTN","GMRCGUIC",124,0)
 .Q
"RTN","GMRCGUIC",125,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",126,0)
 S @GLOBAL@(ND,0)="~ATTENTION",ND=ND+1
"RTN","GMRCGUIC",127,0)
 I +GMRCATN S GMRCSX=$P(^VA(200,GMRCATN,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCATN_"^"_GMRCSX_"^"_GMRCATN,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",128,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",129,0)
 S @GLOBAL@(ND,0)="~URGENCY",ND=ND+1
"RTN","GMRCGUIC",130,0)
 I +GMRCURG S GMRCSX=$P($P(^ORD(101,GMRCURG,0),"^",1),"GMRCURGENCY - ",2),GMRCURGY=$O(^ORD(101.42,"S.GMRCO",GMRCSX,0)) I $L(GMRCSX) D
"RTN","GMRCGUIC",131,0)
 .S GMRCSY=$O(^ORD(101.42,"B",GMRCSX,0))
"RTN","GMRCGUIC",132,0)
 .S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX_"^"_GMRCURG,ND=ND+1
"RTN","GMRCGUIC",133,0)
 .S GMRCSX="" K GMRCSY
"RTN","GMRCGUIC",134,0)
 .Q
"RTN","GMRCGUIC",135,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",136,0)
 ;Get reason for request
"RTN","GMRCGUIC",137,0)
 S @GLOBAL@(ND,0)="~REASON",ND=ND+1
"RTN","GMRCGUIC",138,0)
 I $O(^GMR(123,+GMRCO,20,0)) S NDX=0 F  S NDX=$O(^GMR(123,+GMRCO,20,NDX)) Q:NDX=""  S @GLOBAL@(ND,0)="t"_^GMR(123,+GMRCO,20,NDX,0),ND=ND+1
"RTN","GMRCGUIC",139,0)
 E  S @GLOBAL@(ND,0)="~REASON",ND=ND+1,@GLOBAL@(ND,0)="tREASON "
"RTN","GMRCGUIC",140,0)
 ;Get Comments, including Deny Comments
"RTN","GMRCGUIC",141,0)
 D SENDCOMT^GMRCGUIU(GMRCO,.ND)
"RTN","GMRCGUIC",142,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",143,0)
 Q
"VER")
8.0^22.0
**END**
**END**
