Released PSO*7*120 SEQ #123
Extracted from mail message
**KIDS**:PSO*7.0*120^

**INSTALL NAME**
PSO*7.0*120
"BLD",3984,0)
PSO*7.0*120^OUTPATIENT PHARMACY^0^3030402^y
"BLD",3984,1,0)
^^6^6^3030228^
"BLD",3984,1,1,0)
The purpose of this patch is to provide the ability to print Outpatient 
"BLD",3984,1,2,0)
Pharmacy V. 7.0 prescription labels on laser printers. The output will 
"BLD",3984,1,3,0)
include the Patient Medication Information sheets.
"BLD",3984,1,4,0)
 
"BLD",3984,1,5,0)
The new functionality will only be available on printers properly defined 
"BLD",3984,1,6,0)
in the TERMINAL TYPE file (#3.2).
"BLD",3984,4,0)
^9.64PA^^0
"BLD",3984,"ABPKG")
n
"BLD",3984,"KRN",0)
^9.67PA^8989.52^19
"BLD",3984,"KRN",.4,0)
.4
"BLD",3984,"KRN",.401,0)
.401
"BLD",3984,"KRN",.402,0)
.402
"BLD",3984,"KRN",.403,0)
.403
"BLD",3984,"KRN",.5,0)
.5
"BLD",3984,"KRN",.84,0)
.84
"BLD",3984,"KRN",3.6,0)
3.6
"BLD",3984,"KRN",3.8,0)
3.8
"BLD",3984,"KRN",9.2,0)
9.2
"BLD",3984,"KRN",9.8,0)
9.8
"BLD",3984,"KRN",9.8,"NM",0)
^9.68A^17^17
"BLD",3984,"KRN",9.8,"NM",1,0)
PSOLSET^^0^B29370322
"BLD",3984,"KRN",9.8,"NM",2,0)
PSOLBL^^0^B68692919
"BLD",3984,"KRN",9.8,"NM",3,0)
PSORXRP2^^0^B29174691
"BLD",3984,"KRN",9.8,"NM",4,0)
PSORXRP1^^0^B21985574
"BLD",3984,"KRN",9.8,"NM",5,0)
PSORXRPT^^0^B34192029
"BLD",3984,"KRN",9.8,"NM",6,0)
PSOLLLI^^0^B59721050
"BLD",3984,"KRN",9.8,"NM",7,0)
PSOLLL1^^0^B41006778
"BLD",3984,"KRN",9.8,"NM",8,0)
PSOLLL2^^0^B11845261
"BLD",3984,"KRN",9.8,"NM",9,0)
PSOLLL3^^0^B6483519
"BLD",3984,"KRN",9.8,"NM",10,0)
PSOLLL4^^0^B6896613
"BLD",3984,"KRN",9.8,"NM",11,0)
PSOLLL5^^0^B31739850
"BLD",3984,"KRN",9.8,"NM",12,0)
PSOLLL6^^0^B6778805
"BLD",3984,"KRN",9.8,"NM",13,0)
PSOLLL7^^0^B17412824
"BLD",3984,"KRN",9.8,"NM",14,0)
PSOLLL8^^0^B24617611
"BLD",3984,"KRN",9.8,"NM",15,0)
PSOLLU1^^0^B21553214
"BLD",3984,"KRN",9.8,"NM",16,0)
PSOLLL9^^0^B7414482
"BLD",3984,"KRN",9.8,"NM",17,0)
PSOLLU2^^0^B32354316
"BLD",3984,"KRN",9.8,"NM","B","PSOLBL",2)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL1",7)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL2",8)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL3",9)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL4",10)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL5",11)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL6",12)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL7",13)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL8",14)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLL9",16)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLLI",6)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLU1",15)

"BLD",3984,"KRN",9.8,"NM","B","PSOLLU2",17)

"BLD",3984,"KRN",9.8,"NM","B","PSOLSET",1)

"BLD",3984,"KRN",9.8,"NM","B","PSORXRP1",4)

"BLD",3984,"KRN",9.8,"NM","B","PSORXRP2",3)

"BLD",3984,"KRN",9.8,"NM","B","PSORXRPT",5)

"BLD",3984,"KRN",19,0)
19
"BLD",3984,"KRN",19,"NM",0)
^9.68A^^
"BLD",3984,"KRN",19.1,0)
19.1
"BLD",3984,"KRN",101,0)
101
"BLD",3984,"KRN",409.61,0)
409.61
"BLD",3984,"KRN",771,0)
771
"BLD",3984,"KRN",870,0)
870
"BLD",3984,"KRN",8989.51,0)
8989.51
"BLD",3984,"KRN",8989.52,0)
8989.52
"BLD",3984,"KRN",8994,0)
8994
"BLD",3984,"KRN","B",.4,.4)

"BLD",3984,"KRN","B",.401,.401)

"BLD",3984,"KRN","B",.402,.402)

"BLD",3984,"KRN","B",.403,.403)

"BLD",3984,"KRN","B",.5,.5)

"BLD",3984,"KRN","B",.84,.84)

"BLD",3984,"KRN","B",3.6,3.6)

"BLD",3984,"KRN","B",3.8,3.8)

"BLD",3984,"KRN","B",9.2,9.2)

"BLD",3984,"KRN","B",9.8,9.8)

"BLD",3984,"KRN","B",19,19)

"BLD",3984,"KRN","B",19.1,19.1)

"BLD",3984,"KRN","B",101,101)

"BLD",3984,"KRN","B",409.61,409.61)

"BLD",3984,"KRN","B",771,771)

"BLD",3984,"KRN","B",870,870)

"BLD",3984,"KRN","B",8989.51,8989.51)

"BLD",3984,"KRN","B",8989.52,8989.52)

"BLD",3984,"KRN","B",8994,8994)

"BLD",3984,"QUES",0)
^9.62^^
"BLD",3984,"REQB",0)
^9.611^4^4
"BLD",3984,"REQB",1,0)
PSN*4.0*68^2
"BLD",3984,"REQB",2,0)
PSO*7.0*92^2
"BLD",3984,"REQB",3,0)
PSO*7.0*34^2
"BLD",3984,"REQB",4,0)
PSO*7.0*40^2
"BLD",3984,"REQB","B","PSN*4.0*68",1)

"BLD",3984,"REQB","B","PSO*7.0*34",3)

"BLD",3984,"REQB","B","PSO*7.0*40",4)

"BLD",3984,"REQB","B","PSO*7.0*92",2)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
120^3030402^11881
"PKG",141,22,1,"PAH",1,1,0)
^^6^6^3030402
"PKG",141,22,1,"PAH",1,1,1,0)
The purpose of this patch is to provide the ability to print Outpatient 
"PKG",141,22,1,"PAH",1,1,2,0)
Pharmacy V. 7.0 prescription labels on laser printers. The output will 
"PKG",141,22,1,"PAH",1,1,3,0)
include the Patient Medication Information sheets.
"PKG",141,22,1,"PAH",1,1,4,0)
 
"PKG",141,22,1,"PAH",1,1,5,0)
The new functionality will only be available on printers properly defined 
"PKG",141,22,1,"PAH",1,1,6,0)
in the TERMINAL TYPE file (#3.2).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
17
"RTN","PSOLBL")
0^2^B68692919
"RTN","PSOLBL",1,0)
PSOLBL ;BIR/SAB/RTR-BOTTLE LABEL ;4/14/93
"RTN","PSOLBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,19,30,36,47,71,92,120**;DEC 1997
"RTN","PSOLBL",3,0)
 ;DBIAs PSDRUG-221, PS(55-2228, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097
"RTN","PSOLBL",4,0)
DQ I $D(PSOIOS),PSOIOS]"" D DEVBAR^PSOBMST
"RTN","PSOLBL",5,0)
 I $G(PSOBAR0)]"",$G(PSOBAR1)]"",$D(^PS(59,PSOSITE,1)) S PSOBARS=1
"RTN","PSOLBL",6,0)
DQ1 D ^PSOLBL4
"RTN","PSOLBL",7,0)
 I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G ^PSOLLLI
"RTN","PSOLBL",8,0)
 G:'$D(PPL) HLEX G:($P($G(PSOPAR),"^",30)=2)&('$G(PSOEXREP)) HLEX K RXFLX S PSOCKHN=","_$G(PPL) S PSRESOLV=+PPL D CHECK F PI=1:1  D  S RX=$P(PPL,",",PI) D C Q:$G(PSOLAPPL)  D:$G(PSDFNFLG) TRAIL^PSOLBL2 K RXP,REPRINT
"RTN","PSOLBL",9,0)
 .S (PSDFNFLG,PSOLAPPL)=0 S NEXTRX=$P(PPL,",",(PI+1)) I NEXTRX=""!(NEXTRX=",") S PSOLAPPL=1 Q
"RTN","PSOLBL",10,0)
 .I PSOPDFN'=$P(^PSRX(NEXTRX,0),"^",2) S PSDFNFLG=1,PSOPDFN=$P(^PSRX(NEXTRX,0),"^",2) Q
"RTN","PSOLBL",11,0)
 I $P(^PS(59,PSOSITE,1),"^",28) D ^PSOLBLN2
"RTN","PSOLBL",12,0)
 D:'$P(^PS(59,PSOSITE,1),"^",28) ^PSOLBLS
"RTN","PSOLBL",13,0)
DQ5 I $D(^TMP($J,"PSOCP",DFN)),'$P(^PS(59,PSOSITE,1),"^",28) D INV^PSOCPE
"RTN","PSOLBL",14,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLBL",15,0)
 K ^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA S:'$G(PSOSUREP)&('$G(PSOSUSPR)) ZTREQ="@" Q
"RTN","PSOLBL",16,0)
C I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G C^PSOLLLI
"RTN","PSOLBL",17,0)
 U IO S X=$S('$P(^PS(59,PSOSITE,1),"^",28):132,1:158) X ^%ZOSF("RM") Q:'$D(^PSRX(RX,0))
"RTN","PSOLBL",18,0)
 S:$G(PSOBLALL) PSOBLRX=RX
"RTN","PSOLBL",19,0)
 S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLBL",20,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 S:'$G(RXRP(RX)) RXRP(RX)=1
"RTN","PSOLBL",21,0)
 S RXY=^PSRX(RX,0),RXSTA=$P(^PSRX(RX,"STA"),"^") I RXSTA>11,'$G(RXP) D AL("QT") K RXY,RXP,REPRINT Q
"RTN","PSOLBL",22,0)
 I RXSTA=3 D AL("QT") K RXY,RXP,REPRINT Q
"RTN","PSOLBL",23,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",24,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",25,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXY,RXP,REPRINT Q
"RTN","PSOLBL",26,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",27,0)
 .S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA  S A=$P($G(^PS(52.5,DA,0)),"^",7) Q:A=""
"RTN","PSOLBL",28,0)
 .I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLBL",29,0)
 .K RXRS(RX) S PSOSXQ=1
"RTN","PSOLBL",30,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLBL",31,0)
 I RXSTA'=4 D:$G(PSOSUSPR) AREC^PSOSUTL D:$G(PSOPULL)!($G(RXRS(RX))) AREC1^PSOSUTL D:$G(PSOSUREP) AREC^PSOSUSRP D:$G(PSXREP) AREC^PSXSRP
"RTN","PSOLBL",32,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^") I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLBL",33,0)
 S RXN=$P(RXY,"^"),ISD=$P(RXY,"^",13),RXF=0,DFN=+$P(RXY,"^",2),SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLBL",34,0)
 S PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLBL",35,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0) S FDT=$P(^PSRX(RX,2),"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLBL",36,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLBL",37,0)
 S (EXPDT,EXDT)=$P(^PSRX(RX,2),"^",6),EXDT=$S('EXDT:"",1:$E(EXDT,4,5)_"/"_$E(EXDT,6,7)_"/"_($E(EXDT,1,3)+1700))
"RTN","PSOLBL",38,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLBL",39,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLBL",40,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLBL",41,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLBL",42,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLBL",43,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLBL",44,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLBL",45,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLBL",46,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLBL",47,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLBL",48,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),'$G(RXFL(RX)) S XTYPE=1 D REF G STA
"RTN","PSOLBL",49,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),$G(RXFL(RX)) G STA
"RTN","PSOLBL",50,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLBL",51,0)
ORIG S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLBL",52,0)
 S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL",53,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLBL",54,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLBL",55,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLBL",56,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLBL",57,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLBL",58,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLBL",59,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLBL",60,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",61,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL",62,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",63,0)
 I MW="W" S PSMP=$G(^PSRX(RX,"MP")) I PSMP]"" D
"RTN","PSOLBL",64,0)
 .S PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLBL",65,0)
 .K PSMP(PSI)
"RTN","PSOLBL",66,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2),PS55=$P($G(X),"^",3),PS55X=$P($G(X),"^",5)
"RTN","PSOLBL",67,0)
 I (($G(PS55X)]"")&(PS55>1)&(PS55X<DT)) S PS55=1
"RTN","PSOLBL",68,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLBL",69,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBL",70,0)
 I ($G(PSMP(1))']""&($G(PS55)=2)) S PSMP(1)=$G(SSNPN)
"RTN","PSOLBL",71,0)
 ;S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2) S:MW="M" MW=$S(+$P(X,"^",3):"R",1:MW) S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBL",72,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLBL",73,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["A"&(DEA'["B"))!(DEA["W") PRTFL=0
"RTN","PSOLBL",74,0)
 S VRPH=$P(^PSRX(RX,2),"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLBL",75,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLBL",76,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLBL",77,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLBL",78,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLBL",79,0)
 I $P($G(^PSDRUG(+$G(PSOLBLDR),0)),"^",3)["I"!($P($G(^(0)),"^",3)["S") D SNO G LBL
"RTN","PSOLBL",80,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLBL",81,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLBL",82,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ")) I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLBL",83,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6)) D SNO G LBL
"RTN","PSOLBL",84,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6)) D SNO G LBL
"RTN","PSOLBL",85,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLBL",86,0)
 S PSOCPN=$P(^PSRX(RX,0),"^",2),INRX=$P(^(0),"^") I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLBL",87,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS) S COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLBL",88,0)
LBL G ^PSOLBLD:$P(^PSRX(RX,"STA"),"^")=4 D ^PSOLBLD:$D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)) D:$P($G(^PSRX(RX,3)),"^",6)&('$G(RXF))&('$G(RXP)) ^PSOLBLD1 G ^PSOLBL1:'$P(^PS(59,PSOSITE,1),"^",28)
"RTN","PSOLBL",89,0)
 G ^PSOLBLN
"RTN","PSOLBL",90,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLBL",91,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL",92,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLBL",93,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL",94,0)
 Q
"RTN","PSOLBL",95,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLBL",96,0)
 Q
"RTN","PSOLBL",97,0)
OSET I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLBL",98,0)
 .S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLBL",99,0)
 .S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL",100,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL",101,0)
 S TECH=$S($D(^VA(200,+$P(^PSRX(RX,1,RXFL(RX),0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL",102,0)
 S QTY=$P(^PSRX(RX,1,RXFL(RX),0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,1,RXFL(RX),0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLBL",103,0)
 S DAYS=$P(^PSRX(RX,1,RXFL(RX),0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL",104,0)
 Q
"RTN","PSOLBL",105,0)
DOUB Q:'$D(RXFL(RX))  I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLBL",106,0)
 S RXFLX(RX)=$G(RXFL(RX)),RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLBL",107,0)
 Q
"RTN","PSOLBL",108,0)
AL(T) N I,IR,RF,USR,TY,DES S USR=""
"RTN","PSOLBL",109,0)
 I T="UT" D
"RTN","PSOLBL",110,0)
 .N J,RX S USR=$G(DUZ),TY="B",DES="Label never queued to print by User"
"RTN","PSOLBL",111,0)
 .F J=1:1  S RX=+$P(PPL,",",J) Q:'RX  D AL1
"RTN","PSOLBL",112,0)
 I T="QT" D
"RTN","PSOLBL",113,0)
 .S I=+$P(^PSRX(RX,"STA"),"^"),TY=$S((I=3)!(I=16):"H",I=13:"D",1:"C")
"RTN","PSOLBL",114,0)
 .S DES=I_" "_$S((I=3)!(I=16):"HOLD"_$S(I=16:"(PROVIDER)",1:""),(I=12)!(I=14)!(I=15):"DISCONTINUED"_$S(I=14:"(PROVIDER)",I=15:"(EDIT)",1:""),I=13:"DELETED",1:"")
"RTN","PSOLBL",115,0)
 .S DES="Queued label terminated - "_DES D AL1
"RTN","PSOLBL",116,0)
 K %,%H,%I Q
"RTN","PSOLBL",117,0)
AL1 S (IR,I,RF)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S RF=I S:I>5 RF=I+1
"RTN","PSOLBL",118,0)
 S I=0 F  S I=$O(^PSRX(RX,"A",I)) Q:'I  S IR=I
"RTN","PSOLBL",119,0)
 S IR=IR+1,^PSRX(RX,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOLBL",120,0)
 D NOW^%DTC S ^PSRX(RX,"A",IR,0)=%_"^"_TY_"^"_USR_"^"_$S($G(RXPR(RX)):6,1:RF)_"^"_DES
"RTN","PSOLBL",121,0)
 Q
"RTN","PSOLBL",122,0)
IBCP N X,Y,PSOJJ,PSOLL
"RTN","PSOLBL",123,0)
 S PSOLBLCP="",X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLBL",124,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLBL",125,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLBL",126,0)
 Q
"RTN","PSOLBL",127,0)
SNO S COPAYVAR="NO COPAY" Q
"RTN","PSOLLL1")
0^7^B41006778
"RTN","PSOLLL1",1,0)
PSOLLL1 ;BIR/JLC - LASER LABELS ;10/24/2002
"RTN","PSOLLL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL1",3,0)
 ;
"RTN","PSOLLL1",4,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLLL1",5,0)
 ;Reference ^VA(200,D0,"PS" supported by DBIA 224
"RTN","PSOLLL1",6,0)
 ;Reference to ^PS(54 supported by DBIA 2227
"RTN","PSOLLL1",7,0)
 ;
"RTN","PSOLLL1",8,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4),PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLLL1",9,0)
 .I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLLL1",10,0)
 S $P(ULN,"_",34)="",PSOTRAIL=1
"RTN","PSOLLL1",11,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLLL1",12,0)
 S Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLL1",13,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLLL1",14,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",15,0)
L1 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLL1",16,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_"  "_$G(PSOHZIP) D PRINT(T)
"RTN","PSOLLL1",17,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) D PRINT(T)
"RTN","PSOLLL1",18,0)
 S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8)
"RTN","PSOLLL1",19,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLL1",20,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",21,0)
 S T="Rx# "_RXN_"  " D PRINT(T,1)
"RTN","PSOLLL1",22,0)
 D STRT^PSOLLU1("RX#",T,.L) S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX
"RTN","PSOLLL1",23,0)
 S T="  "_DATE_"  "_$S('SIGF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(label continued)") D PRINT(T)
"RTN","PSOLLL1",24,0)
 S PSOX=OPSOX,T=PNM D PRINT(T,1) D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",25,0)
 S OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX,PSOY=PSOY-PSOYI,T="  "_$G(SSNPN) D PRINT(T)
"RTN","PSOLLL1",26,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",27,0)
 F DR=SIGF("DR"):1 Q:$G(SGY(DR))=""  S TEXT=SGY(DR) D  Q:SIGF
"RTN","PSOLLL1",28,0)
 . F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLL1",29,0)
 . F I=SIGF("T"):1:$L(TEXT," ") D STRT^PSOLLU1("SIG",$P(TEXT," ",I)_" ",.L) D  Q:SIGF
"RTN","PSOLLL1",30,0)
 .. I LENGTH+L(XFONT)<3.1 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL1",31,0)
 .. S LENGTH=0,I=I-1
"RTN","PSOLLL1",32,0)
 .. D PRINT(PTEXT) S PTEXT=""
"RTN","PSOLLL1",33,0)
 .. I PSOY>PSOYM S SIGF=1,SIGF("DR")=DR,SIGF("T")=I+1,PTEXT="" Q
"RTN","PSOLLL1",34,0)
 . I 'SIGF S SIGF("T")=1
"RTN","PSOLLL1",35,0)
 I PTEXT]"" D PRINT(PTEXT)
"RTN","PSOLLL1",36,0)
 I $G(PSOIO("BLF"))]"" X PSOIO("BLF")
"RTN","PSOLLL1",37,0)
 S PSOY=PSODY-PSOYI,PSOFONT=PSODFONT
"RTN","PSOLLL1",38,0)
 I SIGF S PSOX=PSOCX,T="(continued on next label)" D PRINT(T) G WARN:'SIGM,CONT
"RTN","PSOLLL1",39,0)
 D NOW^%DTC S X1=X,X2=365 D C^%DTC S Y=X X ^DD("DD")
"RTN","PSOLLL1",40,0)
 S DEA=$P($G(^PSDRUG($P(RXY,"^",6),0)),"^",3),T=""
"RTN","PSOLLL1",41,0)
 I DEA'["S",DEA'["I" S T="Discard after "_$S(DEA[0!(DEA["M"):"_________",1:Y)_"__________   "
"RTN","PSOLLL1",42,0)
 S T=T_$S($G(NURSE):"Mfr_________",1:"") D PRINT(T)
"RTN","PSOLLL1",43,0)
 S PPHYS=$G(PHYS)
"RTN","PSOLLL1",44,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL1",45,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL1",46,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL1",47,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL1",48,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL1",49,0)
 I LENGTH>3 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.1 Q 
"RTN","PSOLLL1",50,0)
 S PSOFONT=PSOTFONT,OPSOX=PSOX,PSOX=Q(1)*300,PSOY=PSOQY-PSOYI,T=$G(QTY) D PRINT(T)
"RTN","PSOLLL1",51,0)
 S PSOX=OPSOX,PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL1",52,0)
 S PSOX=Q(1)+Q(4)*300,PSOY=PSOY-PSOYI,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL1",53,0)
 S PSOFONT=PSOTFONT,PSOX=OPSOX,PSOY=PSOTY-PSOYI,T=DRUG D PRINT(T,1)
"RTN","PSOLLL1",54,0)
 I SIGM G CONT
"RTN","PSOLLL1",55,0)
 S ^PSRX(RX,"TYPE")=0
"RTN","PSOLLL1",56,0)
WARN ;PRINT WARNING LABELS
"RTN","PSOLLL1",57,0)
 I $G(PSOIO("WLI"))]"" X PSOIO("WLI")
"RTN","PSOLLL1",58,0)
 F WWW=1:1:5 S PSOWARN=$P(WARN,",",WWW) Q:PSOWARN=""  I $D(^PS(54,PSOWARN,0)) S PTEXT="",(LENGTH,OUT)=0,LINE=1,LCNT=3 D
"RTN","PSOLLL1",59,0)
 . S T="" F JJJ=1:1 Q:'$D(^PS(54,PSOWARN,1,JJJ,0))  S T=T_" "_^(0)
"RTN","PSOLLL1",60,0)
 . D STRT^PSOLLU1("WRN",T,.L,.XFONT)
"RTN","PSOLLL1",61,0)
 . I WWW=1 S XFONT=$S(XFONT="F12":"F10",XFONT="F10":"F9",XFONT="F9":"F8",1:"F6")
"RTN","PSOLLL1",62,0)
 . S PSOY=PSOY+$S(XFONT="F12":10,XFONT="F10":5,1:0),PSOYI=$S(XFONT="F12":40,XFONT="F10":35,XFONT="F9":29,1:29)
"RTN","PSOLLL1",63,0)
 . F JJJ=1:1 Q:'$D(^PS(54,PSOWARN,1,JJJ,0))  S TEXT=^(0) D  Q:OUT
"RTN","PSOLLL1",64,0)
 .. F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLL1",65,0)
 .. F I=1:1:$L(TEXT," ") D STRT^PSOLLU1("SEC2",$P(TEXT," ",I),.L) D  Q:OUT
"RTN","PSOLLL1",66,0)
 ... I LENGTH+L($E(XFONT,2,99))<1.9 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L($E(XFONT,2,99)) Q
"RTN","PSOLLL1",67,0)
 ... S LENGTH=0,I=I-1,PSOFONT=XFONT
"RTN","PSOLLL1",68,0)
 ... D PRINT(PTEXT) S PTEXT="",LINE=LINE+1 I LINE>LCNT S OUT=1 Q
"RTN","PSOLLL1",69,0)
 . I 'OUT S PSOFONT=XFONT D PRINT(PTEXT)
"RTN","PSOLLL1",70,0)
 . S PSOY=WWW*115+29+(WWW-1*2)
"RTN","PSOLLL1",71,0)
 ;RETURN MAIL
"RTN","PSOLLL1",72,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL1",73,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",74,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",75,0)
 I $G(PSOIO("RMI"))]"" X PSOIO("RMI")
"RTN","PSOLLL1",76,0)
 S PSOYI=$G(PSOHYI,40),OFONT=PSOFONT,PSOFONT=$G(PSOHFONT)
"RTN","PSOLLL1",77,0)
 S T="Attn: (119)" D PRINT(T,0)
"RTN","PSOLLL1",78,0)
 S T=$G(VASTREET) D PRINT(T,0)
"RTN","PSOLLL1",79,0)
 S T=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(T,0)
"RTN","PSOLLL1",80,0)
 S PSOY=PSOY+PSOYI,PSOFONT=OFONT,T=$S(PS55=2:"***DO NOT MAIL***",PS55[0!(PS55[3)!(PS55=""):"REGULAR MAIL",1:"CERTIFIED MAIL") D PRINT(T,0)
"RTN","PSOLLL1",81,0)
 S PSOY=PSOY+PSOYI,PSOYI=PSORYI D PRINT(PNM,0)
"RTN","PSOLLL1",82,0)
 I $G(VAPA(1))=""!(PS55=2) G W
"RTN","PSOLLL1",83,0)
 F I=1:1:3 I $G(VAPA(I))]"" S T=$G(VAPA(I)) D PRINT(T,0)
"RTN","PSOLLL1",84,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",85,0)
 S T=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6))) D PRINT(T,0)
"RTN","PSOLLL1",86,0)
W I MW="WINDOW" S OFONT=PSOFONT,PSOYI=$G(PSOTYI,40),PSOFONT=PSOTFONT,PSOY=PSOTY,T="WINDOW - "_$G(^PSRX(RX,"MP")) D PRINT(T,0) S PSOFONT=OFONT
"RTN","PSOLLL1",87,0)
CONT I $G(SIDE) G BARC:'L5,CONT2
"RTN","PSOLLL1",88,0)
 I $G(COPIES)>1 G BARC
"RTN","PSOLLL1",89,0)
 I 'L2!PFM D ^PSOLLL2 S L2=1
"RTN","PSOLLL1",90,0)
 I 'L3 D ^PSOLLL3 S L3=1
"RTN","PSOLLL1",91,0)
 I 'L4!PMIM S PIMI=0 D ^PSOLLL4 S L4=1
"RTN","PSOLLL1",92,0)
 I L5 W @IOF G CONT2
"RTN","PSOLLL1",93,0)
BARC I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLL1",94,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLL1",95,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLL1",96,0)
BARCE W @IOF
"RTN","PSOLLL1",97,0)
COPY I $G(COPIES)>1 S COPIES=COPIES-1 G L1
"RTN","PSOLLL1",98,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL1",99,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",100,0)
 S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLLL1",101,0)
 S L5=1
"RTN","PSOLLL1",102,0)
CONT2 I SIGF S SIGM=1 G L1
"RTN","PSOLLL1",103,0)
 I PMIM G CONT
"RTN","PSOLLL1",104,0)
 I $G(PSOBLALL)=1,$P(PPL,",",PI+1)="" D TRAIL
"RTN","PSOLLL1",105,0)
 Q
"RTN","PSOLLL1",106,0)
PRINT(T,B) ;
"RTN","PSOLLL1",107,0)
 S BOLD=$G(B)
"RTN","PSOLLL1",108,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",109,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL1",110,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",111,0)
 W T,!
"RTN","PSOLLL1",112,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",113,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL1",114,0)
 Q
"RTN","PSOLLL1",115,0)
TRAIL I $G(SIDE) G END
"RTN","PSOLLL1",116,0)
 D ^PSOLLL5
"RTN","PSOLLL1",117,0)
 D ^PSOLLL6
"RTN","PSOLLL1",118,0)
 I '$P($G(^PS(59,PSOSITE,1)),"^",18) Q
"RTN","PSOLLL1",119,0)
 D ^PSOLLL7
"RTN","PSOLLL1",120,0)
END I '$P(PSOPAR,"^",31) Q
"RTN","PSOLLL1",121,0)
 W @IOF
"RTN","PSOLLL1",122,0)
 I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL1",123,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",124,0)
 S T="NEXT PATIENT"
"RTN","PSOLLL1",125,0)
 S PSOX=1100-(L($E(PSOFONT,2,99))*300/2)
"RTN","PSOLLL1",126,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",127,0)
 W T,!
"RTN","PSOLLL1",128,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",129,0)
 Q
"RTN","PSOLLL2")
0^8^B11845261
"RTN","PSOLLL2",1,0)
PSOLLL2 ;BIR/JLC-LASER LABEL ;11/19/02
"RTN","PSOLLL2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL2",3,0)
 ;
"RTN","PSOLLL2",4,0)
L1 I $G(PSOIO("PFDI"))]"" X PSOIO("PFDI")
"RTN","PSOLLL2",5,0)
 S PFM=0,T=$S($D(REPRINT)&($G(PSOBLALL)):"(GROUP REPRINT)",$D(REPRINT):"(REPRINT)",1:"")
"RTN","PSOLLL2",6,0)
 S T=T_$S($G(RXP):"(PARTIAL)",1:"")_$S($D(REPRINT):" ",$G(RXP):" ",1:"")_$P(PS2,"^",2)_"  "_TECH_"  "_PSONOWT D PRINT(T)
"RTN","PSOLLL2",7,0)
 S T="Rx# "_RXN_"  "_DATE_"  "_$S('PFF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(fill document continued)") D PRINT(T)
"RTN","PSOLLL2",8,0)
 S T=PNM_"  "_$G(SSNPN) D PRINT(T)
"RTN","PSOLLL2",9,0)
 S LENGTH=0,PTEXT="",PFF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL2",10,0)
 F DR=PFF("DR"):1 Q:$G(SGY(DR))=""  S TEXT=SGY(DR) D  Q:PFF
"RTN","PSOLLL2",11,0)
 . F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLL2",12,0)
 . F I=PFF("T"):1:$L(TEXT," ") D STRT^PSOLLU1("SIG2",$P(TEXT," ",I)_" ",.L) D  Q:PFF
"RTN","PSOLLL2",13,0)
 .. I LENGTH+L(XFONT)<3.7 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL2",14,0)
 .. S LENGTH=0,I=I-1
"RTN","PSOLLL2",15,0)
 .. D PRINT(PTEXT) S PTEXT=""
"RTN","PSOLLL2",16,0)
 .. I PSOY>PSOYM S PFF=1,PFF("DR")=DR,PFF("T")=I+1,PTEXT="" Q
"RTN","PSOLLL2",17,0)
 . I 'PFF S PFF("T")=1
"RTN","PSOLLL2",18,0)
 I PTEXT]"" D
"RTN","PSOLLL2",19,0)
 . D PRINT(PTEXT)
"RTN","PSOLLL2",20,0)
 I $G(PSOIO("PFDQ"))]"" X PSOIO("PFDQ")
"RTN","PSOLLL2",21,0)
 I PFF S PSOX=PSOCX,T="(continued on next fill document)" S PFM=1 D PRINT(T) Q
"RTN","PSOLLL2",22,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL2",23,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL2",24,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL2",25,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG2",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL2",26,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG2",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL2",27,0)
 I LENGTH>3.7 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG2",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.7 Q
"RTN","PSOLLL2",28,0)
 S OPSOX=PSOX,PSOX=Q(1)*300,T=$G(QTY) D PRINT(T) S PSOX=OPSOX
"RTN","PSOLLL2",29,0)
 S PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL2",30,0)
 S PSOY=PSOY-PSOYI,PSOX=Q(1)+Q(4)*300,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL2",31,0)
 I $G(PSOIO("PFDT"))]"" X PSOIO("PFDT")
"RTN","PSOLLL2",32,0)
 S T=DRUG D PRINT(T)
"RTN","PSOLLL2",33,0)
L11 S T="Mfr ___________________ Lot# _______________________" D PRINT(T)
"RTN","PSOLLL2",34,0)
L12 S T="Tech__________________ RPh _______________________" D PRINT(T)
"RTN","PSOLLL2",35,0)
 S PSOFONT=PSOTFONT
"RTN","PSOLLL2",36,0)
 S T="Routing: "_$S("W"[$E(MW):MW,PS55=2:"DO NOT MAIL",1:MW_" MAIL")_"    Days supply: "_$G(DAYS)_"     Cap: "_$S(PSCAP:"**NON-SFTY**",1:"SAFETY") D PRINT(T)
"RTN","PSOLLL2",37,0)
 S T="Isd: "_ISD_"    Exp: "_EXPDT_"    Last Fill: "_$G(PSOFLAST) D PRINT(T)
"RTN","PSOLLL2",38,0)
 S PSOYI=PSOBYI,PSOY=PSOBY
"RTN","PSOLLL2",39,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSOLLL2",40,0)
 S X2=PSOINST_"-"_RX
"RTN","PSOLLL2",41,0)
 W X2
"RTN","PSOLLL2",42,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSOLLL2",43,0)
 I $G(PSOIO("PFDW"))]"" X PSOIO("PFDW")
"RTN","PSOLLL2",44,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL2",45,0)
 I $G(WARN) S PTEXT="DRUG WARNING " D STRT^PSOLLU1("SIG2",PTEXT,.L) S LENGTH=L(XFONT) D
"RTN","PSOLLL2",46,0)
 . F I=1:1:$L(WARN,",") S TEXT=$P(WARN,",",I)_"," D
"RTN","PSOLLL2",47,0)
 .. D STRT^PSOLLU1("SIG2",TEXT,.L)
"RTN","PSOLLL2",48,0)
 .. I LENGTH+L(XFONT)<1.8 S PTEXT=PTEXT_TEXT,LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL2",49,0)
 .. S LENGTH=0,I=I-1
"RTN","PSOLLL2",50,0)
 .. S T=$P(PTEXT,",",1,$L(PTEXT,",")-1) D PRINT(T) S PTEXT=""
"RTN","PSOLLL2",51,0)
 .. I PSOY>PSOYM W "*"
"RTN","PSOLLL2",52,0)
 . I PTEXT]"" S T=$P(PTEXT,",",1,$L(PTEXT,",")-1) D PRINT(T)
"RTN","PSOLLL2",53,0)
 Q
"RTN","PSOLLL2",54,0)
PRINT(T) ;
"RTN","PSOLLL2",55,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL2",56,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL2",57,0)
 W T,!
"RTN","PSOLLL2",58,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL2",59,0)
 Q
"RTN","PSOLLL3")
0^9^B6483519
"RTN","PSOLLL3",1,0)
PSOLLL3 ;BHAM/JLC - LASER LABELS ;11/20/02
"RTN","PSOLLL3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL3",3,0)
 ;
"RTN","PSOLLL3",4,0)
 S PRCOPAY=$S('$D(PSOCPN):0,1:1)
"RTN","PSOLLL3",5,0)
PF ;PATIENT FILL DOCUMENT
"RTN","PSOLLL3",6,0)
 I $G(PSOIO("PFI"))]"" X PSOIO("PFI")
"RTN","PSOLLL3",7,0)
 D  S PSOFONT=OFONT
"RTN","PSOLLL3",8,0)
 . S OFONT=PSOFONT,PSOFONT=PSOHFONT
"RTN","PSOLLL3",9,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL for this prescription" D PRINT(T,1,1) S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL3",10,0)
 . I RXF+1=(1+$P(RXY,"^",9)) S T="NO REFILLS LEFT for this prescription" D PRINT(T,1,1) S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL3",11,0)
 . S T="PHONE IN OR MAIL YOUR REFILL REQUEST" D PRINT(T,1,1)
"RTN","PSOLLL3",12,0)
 . S PSOFONT=OFONT,T="Follow the refill instructions provided with your prescription." D PRINT(T,0,1) S PSOY=PSOY+PSOYI
"RTN","PSOLLL3",13,0)
 S T=PNM_"  "_$G(SSNPN) D PRINT(T,0)
"RTN","PSOLLL3",14,0)
 S PSOY=PSOY+PSOYI,T="Rx# "_RXN_"   " D PRINT(T,1)
"RTN","PSOLLL3",15,0)
 D STRT^PSOLLU1("SEC2",T,.L) S OPSOX=PSOX,PSOX=L($E(PSOFONT,2,99))*300+PSOX
"RTN","PSOLLL3",16,0)
 S T=DATE_"  Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),PSOY=PSOY-PSOYI D PRINT(T) S PSOX=OPSOX
"RTN","PSOLLL3",17,0)
 S T="Qty: "_$G(QTY)_"  "_$G(PSDU)_"    Days supply: "_$G(DAYS),PSOY=PSOY+PSOYI D PRINT(T,0)
"RTN","PSOLLL3",18,0)
 S T=DRUG D PRINT(T,0)
"RTN","PSOLLL3",19,0)
 D  D PRINT(T,1)
"RTN","PSOLLL3",20,0)
 . S NOR=$P(RXY,"^",9)-RXF
"RTN","PSOLLL3",21,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSOLLL3",22,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSOLLL3",23,0)
 . S T=NOR_" refills left until "_EXPDT
"RTN","PSOLLL3",24,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL3",25,0)
 D PRINT(COPAYVAR)
"RTN","PSOLLL3",26,0)
 S T=$P(PS,"^")_"-"_$P(PS,"^",6) D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSOLLL3",27,0)
 S OPSOX=PSOX,PSOX=2340-(L($E(PSOFONT,2,99))*300),PSOY=PSOY-PSOYI
"RTN","PSOLLL3",28,0)
 D PRINT(T)
"RTN","PSOLLL3",29,0)
 Q:'$P(RXY,"^",9)!'NOR
"RTN","PSOLLL3",30,0)
 S PSOX=OPSOX,PSOYI=PSOBYI
"RTN","PSOLLL3",31,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSOLLL3",32,0)
 S X2=PSOINST_"-"_RX
"RTN","PSOLLL3",33,0)
 W X2
"RTN","PSOLLL3",34,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSOLLL3",35,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL3",36,0)
 Q
"RTN","PSOLLL3",37,0)
PRINT(T,BOLD,HDR) ;
"RTN","PSOLLL3",38,0)
 S BOLD=+$G(BOLD),HDR=+$G(HDR)
"RTN","PSOLLL3",39,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL3",40,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL3",41,0)
 I HDR D
"RTN","PSOLLL3",42,0)
 . S OPSOX=PSOX D STRT^PSOLLU1("SEC2",T,.L)
"RTN","PSOLLL3",43,0)
 . S PSOX=4.2-L($E(PSOFONT,2,99))*300/2+OPSOX
"RTN","PSOLLL3",44,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL3",45,0)
 W T,!
"RTN","PSOLLL3",46,0)
 I HDR S PSOX=OPSOX
"RTN","PSOLLL3",47,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL3",48,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL3",49,0)
 Q
"RTN","PSOLLL4")
0^10^B6896613
"RTN","PSOLLL4",1,0)
PSOLLL4 ;BHAM/JLC - LASER LABELS PRINT PMI ;12/13/02
"RTN","PSOLLL4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL4",3,0)
 ;
"RTN","PSOLLL4",4,0)
 ;Reference to PSNPPIO supported by DBIA 3794
"RTN","PSOLLL4",5,0)
 ;
"RTN","PSOLLL4",6,0)
 S FLAG=$$EN^PSNPPIO(+$P(RXY,"^",6),.MSG)
"RTN","PSOLLL4",7,0)
EN I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL4",8,0)
 S T=PNM_"  Rx#: "_RXN_"   "_DRUG D PRINT(T,0) S PSOY=PSOY+PSOYI
"RTN","PSOLLL4",9,0)
 S CONT=0 I PMIM S CONT=1 D PRINT(PMIF("T"),PMIF("H")) G CONT
"RTN","PSOLLL4",10,0)
 I 'FLAG D PRINT(MSG) Q
"RTN","PSOLLL4",11,0)
 S T=^TMP($J,"PSNPMI",0)_": "_$G(^TMP($J,"PSNPMI","F",1,0)) D PRINT(T,1) S PSOY=PSOY+PSOYI
"RTN","PSOLLL4",12,0)
 S T=$G(^TMP($J,"PSNPMI","C",1,0)) I T]"" D PRINT(T,1) S PSOY=PSOY+PSOYI
"RTN","PSOLLL4",13,0)
CONT S XFONT=$E(PSOFONT,2,99),(CNT,OUT,PMIM)=0
"RTN","PSOLLL4",14,0)
 K A F A="W","U","H","S","M","P","I","O","N","D","R" S CNT=CNT+1,A(CNT)=A
"RTN","PSOLLL4",15,0)
 F J=PMIF("A"):1 Q:$G(A(J))=""  S A=A(J) I $D(^TMP($J,"PSNPMI",A,1,0)) S HDR=$S(PMIF("A")=1:1,PMIF("B")=1:1,J=PMIF("A"):0,1:1),LENGTH=0,PTEXT="" D  Q:OUT  S PSOY=PSOY+PSOYI
"RTN","PSOLLL4",16,0)
 . F B=PMIF("B"):1 Q:'$D(^TMP($J,"PSNPMI",A,B,0))  S TEXT=^(0) D  Q:OUT
"RTN","PSOLLL4",17,0)
 .. F I=1:1 Q:$E(TEXT,I)'=" "  S TEXT=$E(TEXT,2,255)
"RTN","PSOLLL4",18,0)
 .. F I=PMIF("I"):1:$L(TEXT," ") D STRT^PSOLLU1("FULL",$P(TEXT," ",I),.L) D  Q:OUT
"RTN","PSOLLL4",19,0)
 ... I LENGTH+L(XFONT)<7.1 S PTEXT=PTEXT_$P(TEXT," ",I)_" ",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL4",20,0)
 ... S LENGTH=0,I=I-1
"RTN","PSOLLL4",21,0)
 ... I HDR D  Q
"RTN","PSOLLL4",22,0)
 .... I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1
"RTN","PSOLLL4",23,0)
 .... D PRINT(PTEXT,1) S PTEXT="",HDR=0
"RTN","PSOLLL4",24,0)
 ... I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1 Q
"RTN","PSOLLL4",25,0)
 ... D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSOLLL4",26,0)
 .. I 'PMIM F I="I","B" S PMIF(I)=1
"RTN","PSOLLL4",27,0)
 . I 'PMIM S PMIF("B")=1
"RTN","PSOLLL4",28,0)
 . I OUT S PMIF("T")=PTEXT,PMIF("H")=HDR
"RTN","PSOLLL4",29,0)
 . Q:OUT  I HDR,PTEXT[":" D  Q
"RTN","PSOLLL4",30,0)
 .. I PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1,PMIF("T")=PTEXT,PMIF("H")=HDR Q
"RTN","PSOLLL4",31,0)
 .. I PTEXT]"" D PRINT(PTEXT,1)
"RTN","PSOLLL4",32,0)
 . I PTEXT]"",PSOY>PSOYM S PMIF("A")=J,PMIF("I")=I+1,PMIF("B")=B,OUT=1,PMIM=1,PMIF("T")=PTEXT,PMIF("H")=HDR Q
"RTN","PSOLLL4",33,0)
 . I PTEXT]"" D PRINT(PTEXT,0)
"RTN","PSOLLL4",34,0)
 Q
"RTN","PSOLLL4",35,0)
PRINT(T,HDR) ;
"RTN","PSOLLL4",36,0)
 ; Input: T - text to be printed
"RTN","PSOLLL4",37,0)
 ;        HDR - 0-no / 1-yes
"RTN","PSOLLL4",38,0)
 ;
"RTN","PSOLLL4",39,0)
 S HDR=+$G(HDR)
"RTN","PSOLLL4",40,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL4",41,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL4",42,0)
 I HDR,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL4",43,0)
 I HDR D  G PRINT2
"RTN","PSOLLL4",44,0)
 . W $P(T,":"),":"
"RTN","PSOLLL4",45,0)
 . I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL4",46,0)
 . W $P(T,":",2,99)
"RTN","PSOLLL4",47,0)
 W T
"RTN","PSOLLL4",48,0)
PRINT2 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL4",49,0)
 W ! Q
"RTN","PSOLLL5")
0^11^B31739850
"RTN","PSOLLL5",1,0)
PSOLLL5 ;BIR/RJS - LASER LABEL CONTINUED ;11/22/02
"RTN","PSOLLL5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL5",3,0)
 ;
"RTN","PSOLLL5",4,0)
START ;
"RTN","PSOLLL5",5,0)
 N TEXT,BLNKLIN
"RTN","PSOLLL5",6,0)
 S $P(BLNKLIN,"_",90)="_"
"RTN","PSOLLL5",7,0)
 D MAIL^PSOLLL7
"RTN","PSOLLL5",8,0)
 I $G(PSOIO("ACI"))]"" X PSOIO("ACI")
"RTN","PSOLLL5",9,0)
 S TEXT="HAS YOUR ADDRESS CHANGED?" D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL5",10,0)
 S OPSOX=PSOX,PSOX=4.2-L($E(PSOHFONT,2,99))*300/2+OPSOX
"RTN","PSOLLL5",11,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,OFONT) D PRINT(TEXT,1) S PSOX=OPSOX,PSOY=PSOY+10,PSOFONT=OFONT
"RTN","PSOLLL5",12,0)
 S TEXT="Write address changes in the blanks, sign the form, and return to" D PRINT(TEXT,0)
"RTN","PSOLLL5",13,0)
 S TEXT="your pharmacy." D PRINT(TEXT,0)
"RTN","PSOLLL5",14,0)
 S X=$S($D(^DPT(DFN,0))#2:^(0),1:""),PNM=$P(X,"^")
"RTN","PSOLLL5",15,0)
 D PID^VADPT6,ADD^VADPT S SSNP=$E(VA("PID"),5,12)
"RTN","PSOLLL5",16,0)
 S PSOY=PSOY+PSOYI,TEXT=PNM_"  "_SSNP D PRINT(TEXT,0)
"RTN","PSOLLL5",17,0)
 I $G(VAPA(1))="" G ALLERGY
"RTN","PSOLLL5",18,0)
 F I=1:1:3 I $G(VAPA(I))]"" S TEXT=$G(VAPA(I))_$E(BLNKLIN,1,80-$L(VAPA(I))) D PRINT(TEXT,0)
"RTN","PSOLLL5",19,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL5",20,0)
 S B=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL5",21,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSOLLL5",22,0)
 S PSOY=PSOY+PSOYI,TEXT="[   ] Permanent                     [   ] Temporary until ____/____/____" D PRINT(TEXT,0)
"RTN","PSOLLL5",23,0)
 S PSOY=$G(PSOFY),TEXT="Signature "_$E(BLNKLIN,1,45) D PRINT(TEXT,0)
"RTN","PSOLLL5",24,0)
 ;
"RTN","PSOLLL5",25,0)
ALLERGY ;ALLERGIES & REACTIONS
"RTN","PSOLLL5",26,0)
 K ^TMP($J,"PSOALWA")
"RTN","PSOLLL5",27,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSOLLL5",28,0)
 I $G(GMRAL) S PSORY=0 F  S PSORY=$O(GMRAL(PSORY)) Q:'PSORY  S ^TMP($J,"PSOALWA",$S($P(GMRAL(PSORY),"^",4):1,1:2),$S('$P(GMRAL(PSORY),"^",5):1,1:2),$P(GMRAL(PSORY),"^",7),$P(GMRAL(PSORY),"^",2))=""
"RTN","PSOLLL5",29,0)
 S ^TMP($J,"PSOAPT",1)=$G(PNM)_"  "_$G(SSNP),^(2)="Verified Allergies"
"RTN","PSOLLL5",30,0)
 S ALCNT=0,EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)=PSOLGA
"RTN","PSOLLL5",31,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)="NKA"
"RTN","PSOLLL5",32,0)
 S ALCNT=0,^TMP($J,"PSOAPT",3)="Non-Verified Allergies"
"RTN","PSOLLL5",33,0)
 S EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=EEE+1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)=PSOLGA
"RTN","PSOLLL5",34,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)="NKA"
"RTN","PSOLLL5",35,0)
 S ALCNT=0,^TMP($J,"PSOAPT",4)="Verified Adverse Reactions"
"RTN","PSOLLL5",36,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",4,ALCNT)=PSOLGA
"RTN","PSOLLL5",37,0)
 S ALCNT=0,^TMP($J,"PSOAPT",5)="Non-Verified Adverse Reactions"
"RTN","PSOLLL5",38,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",5,ALCNT)=PSOLGA
"RTN","PSOLLL5",39,0)
 I $G(PSOIO("ALI"))]"" X PSOIO("ALI")
"RTN","PSOLLL5",40,0)
 S XFONT=$E($G(PSOFONT),2,99),TEXT=^TMP($J,"PSOAPT",1) D PRINT(TEXT,0)
"RTN","PSOLLL5",41,0)
 S CCC=1,OUT=0
"RTN","PSOLLL5",42,0)
 F  S CCC=$O(^TMP($J,"PSOAPT",CCC)) Q:CCC=""  D  Q:OUT
"RTN","PSOLLL5",43,0)
 .S TEXT=$G(^TMP($J,"PSOAPT",CCC))
"RTN","PSOLLL5",44,0)
 .I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL5",45,0)
 .I $G(PSOIO("FWU"))]"" X PSOIO("FWU")
"RTN","PSOLLL5",46,0)
 .S PSOY=PSOY+PSOYI D PRINT(TEXT,0)
"RTN","PSOLLL5",47,0)
 .I $G(PSOIO("FDU"))]"" X PSOIO("FDU")
"RTN","PSOLLL5",48,0)
 .I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL5",49,0)
 .S (TEXT,PTEXT,CCC2)="",LENGTH=0
"RTN","PSOLLL5",50,0)
 .F  S CCC2=$O(^TMP($J,"PSOAPT",CCC,CCC2)) Q:CCC2=""  S TEXT=^(CCC2) D  Q:OUT
"RTN","PSOLLL5",51,0)
 ..D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL5",52,0)
 ..I LENGTH+L(XFONT)<3.7 S PTEXT=PTEXT_TEXT_",",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL5",53,0)
 ..I PTEXT="" D  Q
"RTN","PSOLLL5",54,0)
 ... F JJ=$L(TEXT):-1 S PTEXT=$E(TEXT,1,JJ) D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<3.7 D PRINT(PTEXT,0) S PTEXT=$E(TEXT,JJ+1,512)_"," Q
"RTN","PSOLLL5",55,0)
 ... D STRT^PSOLLU1("SEC2",PTEXT,.L) S LENGTH=L(XFONT)
"RTN","PSOLLL5",56,0)
 ..S LENGTH=0,CCC2=CCC2-1
"RTN","PSOLLL5",57,0)
 ..I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL5",58,0)
 ..D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSOLLL5",59,0)
 .I 'OUT,PTEXT]"" D PRINT($P(PTEXT,",",1,$L(PTEXT,",")-1),0)
"RTN","PSOLLL5",60,0)
 I OUT S T="Additional Allergies or Adverse Reactions Exist." D PRINT(T,0) S T="Talk to your Physician or Pharmacist." D PRINT(T,0)
"RTN","PSOLLL5",61,0)
 K ^TMP($J,"PSOALWA"),^TMP($J,"PSOAPT"),PSONKA,PSONULL,WWW,GMRA,GMRAL,JJJ,WCNT,RRR,ALG,ALCNT,EEE,FFF,PSOLG,PSOLGA,PSORY,CCC,CCC2,FNTFLG,TEXT,TEXT2
"RTN","PSOLLL5",62,0)
SUSPEN S PSODFN=DFN,(SPPL,RXX,STA)="",XXS=1
"RTN","PSOLLL5",63,0)
 I $G(PSODTCUT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X
"RTN","PSOLLL5",64,0)
 D ^PSOBUILD S (STA,RXX)=""
"RTN","PSOLLL5",65,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S RXX=$O(PSOSD(STA,RXX)) Q:RXX=""  I $P(PSOSD(STA,RXX),"^",2)=5 S SPPL=$P(PSOSD(STA,RXX),"^")_","_SPPL
"RTN","PSOLLL5",66,0)
 I SPPL="" Q
"RTN","PSOLLL5",67,0)
SUSP1 I $G(PSOIO("SPI"))]"" X PSOIO("SPI")
"RTN","PSOLLL5",68,0)
 S TOF=0,TEXT=PNM_" "_SSNP_" "_$G(PSONOW) D PRINT(TEXT,0)
"RTN","PSOLLL5",69,0)
 S TEXT="The following prescriptions will be mailed to you on or after the" D PRINT(TEXT,0)
"RTN","PSOLLL5",70,0)
 S TEXT="date indicated." D PRINT(TEXT,0)
"RTN","PSOLLL5",71,0)
 S PSOY=PSOY+PSOYI,TEXT="Rx#                                          Date                                        "
"RTN","PSOLLL5",72,0)
 D PRINT(TEXT,0,1)
"RTN","PSOLLL5",73,0)
 F XX=XXS:1 Q:$P(SPPL,",",XX)=""  S RX=$P(SPPL,",",XX) D  Q:TOF
"RTN","PSOLLL5",74,0)
 . S SPNUM=$O(^PS(52.5,"B",RX,0)) I SPNUM S SPDATE=$P($G(^PS(52.5,SPNUM,0)),"^",2) S Y=SPDATE X ^DD("DD") S SPDATE=Y
"RTN","PSOLLL5",75,0)
 . S T=$P(^PSRX(RX,0),"^") D PRINT(T,0)
"RTN","PSOLLL5",76,0)
 . S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=PSOCX,T=$G(SPDATE) D PRINT(T,0)
"RTN","PSOLLL5",77,0)
 . S PSOX=OPSOX+20,T=$$ZZ^PSOSUTL(RX) D PRINT(T,0) K SPNUM,SPDATE,Y,ZDRUG
"RTN","PSOLLL5",78,0)
 . S PSOX=OPSOX,PSOY=PSOY+PSOYI
"RTN","PSOLLL5",79,0)
 . I PSOY>PSOYM S XXS=XX+1,TOF=1 W:$P(SPPL,",",XXS)]"" @IOF Q
"RTN","PSOLLL5",80,0)
 I TOF,$P(SPPL,",",XXS)]"" G SUSP1
"RTN","PSOLLL5",81,0)
 Q
"RTN","PSOLLL5",82,0)
PRINT(T,B,UL) ;
"RTN","PSOLLL5",83,0)
 S BOLD=$G(B),UL=$G(UL)
"RTN","PSOLLL5",84,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL5",85,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL5",86,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL5",87,0)
 I UL,$G(PSOIO("FWU"))]"" X PSOIO("FWU")
"RTN","PSOLLL5",88,0)
 W T,!
"RTN","PSOLLL5",89,0)
 I UL,$G(PSOIO("FDU"))]"" X PSOIO("FDU")
"RTN","PSOLLL5",90,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL5",91,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL5",92,0)
 Q
"RTN","PSOLLL6")
0^12^B6778805
"RTN","PSOLLL6",1,0)
PSOLLL6 ;BHAM/JLC - LABEL TRAILER ;12/02/2002
"RTN","PSOLLL6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL6",3,0)
 ;
"RTN","PSOLLL6",4,0)
 I $G(PSOBLALL),$P(PPL,",",PI+1)'="" Q
"RTN","PSOLLL6",5,0)
 S PRCOPAY=$S('$D(PSOCPN):0,1:1)
"RTN","PSOLLL6",6,0)
NARR ;NARRATIVES
"RTN","PSOLLL6",7,0)
 S (PSSIXFL,PSSEVFL,LENGTH,OUT)=0,PTEXT=""
"RTN","PSOLLL6",8,0)
 I $G(PSOIO("RNI"))]"" X PSOIO("RNI")
"RTN","PSOLLL6",9,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL6",10,0)
 I $D(^PS(59,PSOSITE,6))!($D(^PS(59,PSOSITE,7))) S T=PNM_" "_SSNP_"  "_$G(PSONOW) D PRINT(T) S PSOY=PSOY+PSOYI
"RTN","PSOLLL6",11,0)
 F JJ=6,7 S TEXT="" D P(JJ)  S PSOY=PSOY+PSOYI Q:OUT
"RTN","PSOLLL6",12,0)
 I $G(PSOIO("CNI"))]"" X PSOIO("CNI")
"RTN","PSOLLL6",13,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S T="REMIT $"_PSOTRAMT_" TO AGENT CASHIER." D PRINT(T) G END
"RTN","PSOLLL6",14,0)
 I 'PRCOPAY G END
"RTN","PSOLLL6",15,0)
 S OUT=0,TEXT=""
"RTN","PSOLLL6",16,0)
 I $D(^PS(59,PSOSITE,4)) S T=PNM_" "_SSNP_"  "_$G(PSONOW) D PRINT(T) S PSOY=PSOY+PSOYI D P(4)
"RTN","PSOLLL6",17,0)
END K DIWF,DIWL,DIWR,EDT,LLL,PRCOPAY,PS,PSNACNT,PSNOADDR,PSNOBOTH,PSNONARR,PSNOSUSP,PSNTHREE,PSOLGTH,PSOSD,PSOTRAIL,PSOTRDFN,PSSEVFL,PSSIXFL,PSSPCNT,PSSSRX,PSSUFLG,RXX,SPDATE,SPNUM,SPPL,STATE,TTT,VAADDR1,VADM,VAEL,VAPA,VASTREET,ZZ,ZZZ W @IOF
"RTN","PSOLLL6",18,0)
 Q
"RTN","PSOLLL6",19,0)
P(JJ) ;NARRATIVE PRINT CONTROL
"RTN","PSOLLL6",20,0)
 F ZZ=0:0 S ZZ=$O(^PS(59,PSOSITE,JJ,ZZ)) Q:'ZZ  I $D(^(ZZ,0)) S TEXT=^(0) D  Q:OUT
"RTN","PSOLLL6",21,0)
 . D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL6",22,0)
 . I L(XFONT)>3.7 D
"RTN","PSOLLL6",23,0)
 .. I TEXT'[" " F J=$L(TEXT):-1 S PTEXT=$E(TEXT,1,J) D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<3.7 D PRINT(PTEXT) S TEXT=$E(TEXT,J+1,512) Q
"RTN","PSOLLL6",24,0)
 .. Q:TEXT'[" "
"RTN","PSOLLL6",25,0)
 .. F J=$L(TEXT," "):-1 S PTEXT=$P(TEXT," ",1,J) D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<3.7 D PRINT(PTEXT) S TEXT=$P(TEXT," ",J+1,99) Q
"RTN","PSOLLL6",26,0)
 . D PRINT(TEXT) S TEXT=""
"RTN","PSOLLL6",27,0)
 . I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL6",28,0)
 I TEXT]"" D PRINT(TEXT)
"RTN","PSOLLL6",29,0)
 Q
"RTN","PSOLLL6",30,0)
PRINT(T) ;
"RTN","PSOLLL6",31,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL6",32,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL6",33,0)
 W T,!
"RTN","PSOLLL6",34,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL6",35,0)
 Q
"RTN","PSOLLL7")
0^13^B17412824
"RTN","PSOLLL7",1,0)
PSOLLL7 ;BHAM/JLC - LASER LABEL MULTI RX REFILL REQUEST FORM ;12/12/92
"RTN","PSOLLL7",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL7",3,0)
 ;
"RTN","PSOLLL7",4,0)
 ;Reference to ^PS(59.7 supported by DBIA 694
"RTN","PSOLLL7",5,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLLL7",6,0)
 ;
"RTN","PSOLLL7",7,0)
EN D MAIL
"RTN","PSOLLL7",8,0)
 I $G(PSOIO("PII"))]"" X PSOIO("PII")
"RTN","PSOLLL7",9,0)
 S T="Use the adhesive label above to mail prescription" D PRINT(T)
"RTN","PSOLLL7",10,0)
 S T="documents to your pharmacy." D PRINT(T)
"RTN","PSOLLL7",11,0)
REFILL Q:'DFN  S PS1=$G(^PS(59,PSOSITE,1)),PSOSITE7=$G(^("IB")),PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOLLL7",12,0)
 I '$D(PSSPND) F PSRX=0:0 S PSRX=$O(RX(PSRX)) Q:'PSRX  K RX(PSRX)
"RTN","PSOLLL7",13,0)
 S BLNKLIN="",$P(BLNKLIN,"_",45)="_"
"RTN","PSOLLL7",14,0)
 F PSRX=0:0 S PSRX=$O(^PS(55,DFN,"P",PSRX)) Q:'PSRX  D RZX
"RTN","PSOLLL7",15,0)
 ;NEW LABEL
"RTN","PSOLLL7",16,0)
 S PSOX=0
"RTN","PSOLLL7",17,0)
DOCNEW I $G(PSOIO("RPI"))]"" X PSOIO("RPI")
"RTN","PSOLLL7",18,0)
 S PSOYI=PSOTYI,PSOX=PSOLX,ORIGY=PSOY
"RTN","PSOLLL7",19,0)
 D HDR S PSA=0
"RTN","PSOLLL7",20,0)
 F J=1:1 S PSA=$O(RX(PSA)) Q:'PSA  D SCRPTNEW
"RTN","PSOLLL7",21,0)
 I $O(RX(0))="" G EXIT
"RTN","PSOLLL7",22,0)
 I PSOY=ORIGY G EXIT
"RTN","PSOLLL7",23,0)
 S PSOYI=PSOSYI,T=BLNKLIN D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",24,0)
 S T="Patient's Signature & Date        "_$P(PS,"^",6)_"     "_PSONOW D PRINT(T)
"RTN","PSOLLL7",25,0)
EXIT K PSINF,AMC,PSA,PSDFN,PSDO,PSDT2,PSRFL,PSRX,PSLN,PSRXX,PSSS,PSST,PSOCR,DIWL,DIWR,DIWF,PSO9 Q
"RTN","PSOLLL7",26,0)
SCRPTNEW S T="____"_$$ZZ^PSOSUTL(PSA) K ZDRUG D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",27,0)
 D DTCONNW
"RTN","PSOLLL7",28,0)
 S PSOYI=PSOTYI,OPSOX=PSOX,PSOX=PSOX+PSOXI,T="Refills "_$P(RX(PSA),"^",2)_"   Exp "_PSDT2_"    Rx# "_$P(^PSRX(PSA,0),"^") K TN D PRINT(T)
"RTN","PSOLLL7",29,0)
 S PSOYI=PSOBYI
"RTN","PSOLLL7",30,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSOLLL7",31,0)
 S X2=PSOINST_"-"_PSA,PSOX=PSOX+PSOXI
"RTN","PSOLLL7",32,0)
 W X2
"RTN","PSOLLL7",33,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSOLLL7",34,0)
 S PSOX=OPSOX
"RTN","PSOLLL7",35,0)
 I PSOY>PSOYM D  D:$O(RX(PSA)) HDR Q
"RTN","PSOLLL7",36,0)
 . S T=BLNKLIN,PSOYI=PSOSYI D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",37,0)
 . S T="Patient's Signature & Date         "_$P(PS,"^",6)_"     "_PSONOW D PRINT(T)
"RTN","PSOLLL7",38,0)
 . S PSOY=ORIGY,PSOYI=PSOTYI
"RTN","PSOLLL7",39,0)
 . I PSOX=PSORX S PSOX=PSOLX W @IOF Q
"RTN","PSOLLL7",40,0)
 . S PSOX=PSORX
"RTN","PSOLLL7",41,0)
 Q
"RTN","PSOLLL7",42,0)
DTCONNW S PSDT2=$P(RX(PSA),"^"),PSDT2=$E(PSDT2,4,5)_"/"_$E(PSDT2,6,7)_"/"_($E(PSDT2,1,3)+1700) Q
"RTN","PSOLLL7",43,0)
RFILL2 F AMC=0:0 S AMC=$O(^PSRX(PSRXX,1,AMC)) Q:'AMC  S PSRFL=PSRFL-1
"RTN","PSOLLL7",44,0)
 I PSRFL>0 S X1=DT,X2=$P(^PSRX(PSRXX,0),"^",8)-10 D C^%DTC I X'<$P(^(2),"^",6) S PSRFL=0
"RTN","PSOLLL7",45,0)
 Q
"RTN","PSOLLL7",46,0)
RZX S PSRXX=+^PS(55,DFN,"P",PSRX,0)
"RTN","PSOLLL7",47,0)
 I $D(^PSRX(PSRXX,0)) S PSRFL=$P(^(0),"^",9) D:$D(^(1))&PSRFL RFILL2 I PSRFL>0,$P($G(^PSRX(PSRXX,"STA")),"^")<10,134'[$E(+$P($G(^("STA")),"^")),$P(^(2),"^",6)>DT S RX(PSRXX)=$P(^(2),"^",6)_"^"_PSRFL
"RTN","PSOLLL7",48,0)
 Q
"RTN","PSOLLL7",49,0)
HDR S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL7",50,0)
 D ADD^VADPT
"RTN","PSOLLL7",51,0)
 I $G(VAPA(1))="" G HDR5
"RTN","PSOLLL7",52,0)
 F I=1:1:3 I $G(VAPA(I))]"" S T=VAPA(I) D PRINT(T)
"RTN","PSOLLL7",53,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL7",54,0)
 S B=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL7",55,0)
 S T=B D PRINT(T)
"RTN","PSOLLL7",56,0)
HDR5 I $O(RX(0))="" D  S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL7",57,0)
 . S PSOY=PSOY+PSOYI,T="You have no refillable prescriptions as of "_PSONOW_"." D PRINT(T)
"RTN","PSOLLL7",58,0)
 . S T="Please contact your provider if you need new prescriptions." D PRINT(T)
"RTN","PSOLLL7",59,0)
ADD S PSOY=PSOY+PSOYI,T="Please check prescriptions to be refilled, sign the form, then" D PRINT(T)
"RTN","PSOLLL7",60,0)
 S T="mail or return to your pharmacy." D PRINT(T) S PSOY=PSOY+PSOYI
"RTN","PSOLLL7",61,0)
 Q
"RTN","PSOLLL7",62,0)
MAIL ;PRINT MAILING ADHESIVE LABEL
"RTN","PSOLLL7",63,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL7",64,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL7",65,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL7",66,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL7",67,0)
 I $G(PSOIO("MLI"))]"" X PSOIO("MLI")
"RTN","PSOLLL7",68,0)
 I $G(PSOIO("PSOFONT"))]"" X PSOIO("PSOFONT")
"RTN","PSOLLL7",69,0)
 S TEXT="Attn: (119)" D PRINT(TEXT)
"RTN","PSOLLL7",70,0)
 S TEXT=VAADDR1 D PRINT(TEXT)
"RTN","PSOLLL7",71,0)
 S TEXT=$G(VASTREET) D PRINT(TEXT)
"RTN","PSOLLL7",72,0)
 S TEXT=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(TEXT)
"RTN","PSOLLL7",73,0)
 Q
"RTN","PSOLLL7",74,0)
PRINT(T) ;
"RTN","PSOLLL7",75,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL7",76,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL7",77,0)
 W T,!
"RTN","PSOLLL7",78,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL7",79,0)
 Q
"RTN","PSOLLL8")
0^14^B24617611
"RTN","PSOLLL8",1,0)
PSOLLL8 ;BIR/JLC - LASER LABEL - CRITICAL INTERACTION ;12/13/02
"RTN","PSOLLL8",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL8",3,0)
 ;
"RTN","PSOLLL8",4,0)
 ;Reference to PS(56 supported by DBIA 2229
"RTN","PSOLLL8",5,0)
 ;Reference to PSDRUG supported by DBIA 221
"RTN","PSOLLL8",6,0)
 ;
"RTN","PSOLLL8",7,0)
 S HOLDCOPY=COPIES
"RTN","PSOLLL8",8,0)
START ;
"RTN","PSOLLL8",9,0)
 I $G(PSOIO("CDII"))]"" X PSOIO("CDII")
"RTN","PSOLLL8",10,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL8",11,0)
 K PSOSERV
"RTN","PSOLLL8",12,0)
 S COPIES=COPIES-1,Y=$P(^PSRX(RX,2),"^",6) X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y
"RTN","PSOLLL8",13,0)
 S Y=DATE X ^DD("DD") S DATE1=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLLL8",14,0)
 I '$D(^PS(52.4,RX,0)),$P(^PSRX(RX,"STA"),"^")=4 D UNKNOWN Q
"RTN","PSOLLL8",15,0)
 I '$G(RXRP(RX)) S T=$P(PS2,"^",2)_" "_"("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")"_" "_$P(NOW,":",1,2) D PRINT(T)
"RTN","PSOLLL8",16,0)
2 S PSOY=PSOY+PSOYI,T="This prescription has caused a DRUG-DRUG INTERACTION." D PRINT(T)
"RTN","PSOLLL8",17,0)
 S PSOY=PSOY+PSOYI,T="Rx# "_RXN_" has caused a DRUG-DRUG INTERACTION with the following prescription(s):" D PRINT(T) S PSOY=PSOY+PSOYI
"RTN","PSOLLL8",18,0)
 I $D(^PS(52.4,RX,0)) S SCRIPT=$P(^PS(52.4,RX,0),"^",10),SEV=$P(^PS(52.4,RX,0),"^",9) F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOLLL8",19,0)
 .S SER=$P(^PS(56,SEV(X),0),"^",4) S:$G(SER)=1 PSOSERV=1
"RTN","PSOLLL8",20,0)
 .S T=$P($G(^PSRX(RXX(X),0)),"^")_"     "_$S(SER=1:"CRITICAL",SER=2:"SIGNIFICANT",1:"UNKNOWN")_" INTERACTION    "_$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^") D PRINT(T)
"RTN","PSOLLL8",21,0)
 I '$D(^PS(52.4,RX,0)),$D(^PSRX(RX,"DRI")) S SCRIPT=$P(^PSRX(RX,"DRI"),"^",2),SEV=$P(^PSRX(RX,"DRI"),"^") F X=1:1 S RXX(X)=$P(SCRIPT,",",X),SEV(X)=$P(SEV,",",X) Q:RXX(X)=""  D
"RTN","PSOLLL8",22,0)
 .S SER=$P(^PS(56,SEV(X),0),"^",4)
"RTN","PSOLLL8",23,0)
 .S T=$P($G(^PSRX(RXX(X),0)),"^")_"  "_$S(SER=1:"CRITICAL",SER=2:"SIGNIFICANT",1:"UNKNOWN")_" INTERACTION   "_$P(^PSDRUG($P(^PSRX(RXX(X),0),"^",6),0),"^") D PRINT(T)
"RTN","PSOLLL8",24,0)
 S PSOY=PSOY+PSOYI
"RTN","PSOLLL8",25,0)
 S T="This prescription was entered by: "_TECH D PRINT(T)
"RTN","PSOLLL8",26,0)
 S PSOY=PSOY+PSOYI,T="This prescription "_$S('$G(PSOSERV):"may require",1:"requires")_" "_$S('$G(PSOSERV):"reviewing",1:"intervention")_" by a pharmacist" D PRINT(T)
"RTN","PSOLLL8",27,0)
 S PSOY=PSOY+PSOYI
"RTN","PSOLLL8",28,0)
 S T=DATE1_"  Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)) D PRINT(T)
"RTN","PSOLLL8",29,0)
 S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL8",30,0)
 F SSG=1:1 Q:$G(SGY(SSG))=""  S T=SGY(SSG) D PRINT(T)
"RTN","PSOLLL8",31,0)
 S T="Qty: "_$G(QTY)_"   "_$G(PHYS) D PRINT(T)
"RTN","PSOLLL8",32,0)
 S T="Tech__________RPh__________" D PRINT(T)
"RTN","PSOLLL8",33,0)
 S T=DRUG D PRINT(T)
"RTN","PSOLLL8",34,0)
 S T="Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL") D PRINT(T)
"RTN","PSOLLL8",35,0)
 S T="Days supply: "_$G(DAYS)_" Cap: "_$S(PSCAP:"**NON-SFTY**",1:"SAFETY") D PRINT(T)
"RTN","PSOLLL8",36,0)
 S T="Isd: "_ISD_" Exp: "_EXPDT D PRINT(T)
"RTN","PSOLLL8",37,0)
 S T="Last Fill: "_$G(PSOFLAST) D PRINT(T)
"RTN","PSOLLL8",38,0)
 S T="Pat. Stat "_PATST_" Clinic: "_PSCLN D PRINT(T)
"RTN","PSOLLL8",39,0)
 W @IOF
"RTN","PSOLLL8",40,0)
 I COPIES>0 G START
"RTN","PSOLLL8",41,0)
 S COPIES=HOLDCOPY K HOLDCOPY
"RTN","PSOLLL8",42,0)
STORE ;LABEL PRINT NODE
"RTN","PSOLLL8",43,0)
 D NOW^%DTC S NOW=% K %,%H,%I I $G(RXF)="" S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLLL8",44,0)
 F IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL8",45,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR,^PSRX(RX,"L",IR,0)=NOW_"^"_RXF_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_" Drug-Drug interaction"_$S($G(RXRP(RX)):" (Reprint)",1:"")_"^"_PDUZ_"^1"
"RTN","PSOLLL8",46,0)
 K:$D(^PS(52.4,RX,0)) RXF,IR,FDA,NOW,I
"RTN","PSOLLL8",47,0)
END K:$D(^PS(52.4,RX,0)) PSCLN,DATE1,DRUG,RFLMSG,COPIES,DRUG,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,STATE,SIDE,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,X1,X2,X,Y,TECH,EXPDT,NURSE,SEV,SCRIPT,RXX,SGY,SER,SSG,RXY,SIGPH,PS55,PS55X K PSOSERV
"RTN","PSOLLL8",48,0)
 Q
"RTN","PSOLLL8",49,0)
UNKNOWN S PSOY=PSOY+(3*PSOYI),T="",$P(T,"*",100)="" D PRINT(T)
"RTN","PSOLLL8",50,0)
 S T="THIS PRESCRIPTION HAS CAUSED A DRUG-DRUG INTERACTION " D PRINT(T)
"RTN","PSOLLL8",51,0)
 S T="",$P(T,"*",100)="" D PRINT(T)
"RTN","PSOLLL8",52,0)
 S T="PRESCRIPTION # "_$P(^PSRX(RX,0),"^")_"  "_$P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^") D PRINT(T)
"RTN","PSOLLL8",53,0)
 S T="The above prescription has a status of PENDING due to a DRUG-DRUG INTERACTION." D PRINT(T)
"RTN","PSOLLL8",54,0)
 S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL8",55,0)
 S T=$P(PS2,"^",2)_" ("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")"_" "_$P($P(NOW,":",1,2),"@") D PRINT(T)
"RTN","PSOLLL8",56,0)
 S T=RXN_"  "_DATE1_" Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)) D PRINT(T)
"RTN","PSOLLL8",57,0)
 F SSG=1:1 Q:$G(SGY(SSG))=""  S T=SGY(SSG) D PRINT(T)
"RTN","PSOLLL8",58,0)
 S PSOY=PSOY+PSOYI,T="Please review printouts of all labels for this patient that follow." D PRINT(T),STORE
"RTN","PSOLLL8",59,0)
 W @IOF K PSCLN,DATE1,DRUG,RFLMSG,COPIES,DRUG,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,STATE,SIDE,SIGPH,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,X1,X2,X,Y,TECH,EXPDT,NURSE,SEV,SCRIPT,RXX,SGY,SER,SSG,RXY,PSOSERV Q
"RTN","PSOLLL8",60,0)
 ;
"RTN","PSOLLL8",61,0)
PRINT(T) ;
"RTN","PSOLLL8",62,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL8",63,0)
 W T,!
"RTN","PSOLLL8",64,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL8",65,0)
 Q
"RTN","PSOLLL9")
0^16^B7414482
"RTN","PSOLLL9",1,0)
PSOLLL9 ;BIR/JLC -Prints allergy warning label ;01/24/03
"RTN","PSOLLL9",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLL9",3,0)
 ;
"RTN","PSOLLL9",4,0)
 N AAA,DATE1,EXPDT,ISD,HARDCOPY,PSAA,PSAQUIT,PSBQUIT,PSCQUIT,BBBB,ICOUNT,PSOING,NOW,TB1,TB2,TB2,SSG
"RTN","PSOLLL9",5,0)
 S HARDCOPY=COPIES
"RTN","PSOLLL9",6,0)
START ;
"RTN","PSOLLL9",7,0)
 I $G(PSOIO("AWI"))]"" X PSOIO("AWI")
"RTN","PSOLLL9",8,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL9",9,0)
 S COPIES=COPIES-1,Y=$P(^PSRX(RX,2),"^",6) X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y
"RTN","PSOLLL9",10,0)
 S Y=DATE X ^DD("DD") S DATE1=Y D NOW^%DTC S Y=% X ^DD("DD") S NOW=Y
"RTN","PSOLLL9",11,0)
 I '$G(RXRP(RX)) S T=$P(PS2,"^",2)_"  ("_$P(RXY,"^",16)_"/"_$S(+$G(VRPH):VRPH,1:" ")_")  "_$P(NOW,":",1,2) D PRINT(T)
"RTN","PSOLLL9",12,0)
 S T="Rx# "_RXN_" has indicated a DRUG ALLERGY:" D PRINT(T)
"RTN","PSOLLL9",13,0)
 I $O(^PSRX(RX,"DAI",0)) D
"RTN","PSOLLL9",14,0)
 . S PSOY=PSOY+PSOYI,T=" Ingredients:" D PRINT(T)
"RTN","PSOLLL9",15,0)
 . F BBBB=0:0 S BBBB=$O(^PSRX(RX,"DAI",BBBB)) Q:'BBBB  S T="  "_$G(^(BBBB,0)) D PRINT(T)
"RTN","PSOLLL9",16,0)
 S PSOY=PSOY+PSOYI
"RTN","PSOLLL9",17,0)
 S PSOY=PSOY+PSOYI,T="This prescription was entered by "_$G(TECH) D PRINT(T)
"RTN","PSOLLL9",18,0)
 S PSOY=PSOY+PSOYI,T="This prescription may require reviewing by a pharmacist" D PRINT(T)
"RTN","PSOLLL9",19,0)
 S PSOY=PSOY+PSOYI I $G(RXRP(RX)) S T="(REPRINT)" D PRINT(T)
"RTN","PSOLLL9",20,0)
 F ICOUNT=1:1 S T=$G(SGY(ICOUNT)) Q:T=""  D PRINT(T)
"RTN","PSOLLL9",21,0)
 S T=RXN_"  "_DATE1_"  Fill 1 of "_(1+$P(RXY,"^",9)) D PRINT(T)
"RTN","PSOLLL9",22,0)
 S T=PNM_"  "_SSNP D PRINT(T)
"RTN","PSOLLL9",23,0)
 S T="Qty: "_$G(QTY)_"  "_$G(PHYS) D PRINT(T)
"RTN","PSOLLL9",24,0)
 S T=$G(DRUG) D PRINT(T)
"RTN","PSOLLL9",25,0)
 S T="Tech__________RPh__________" D PRINT(T)
"RTN","PSOLLL9",26,0)
 S T="Routing: "_$S("W"[$E(MW):MW,1:MW_" MAIL") D PRINT(T)
"RTN","PSOLLL9",27,0)
 S T="Days Supply: "_$G(DAYS)_" Cap: "_$S(PSCAP:"**NON-SFTY**",1:"SAFETY") D PRINT(T)
"RTN","PSOLLL9",28,0)
 S T="Isd: "_ISD_" Exp: "_EXPDT D PRINT(T)
"RTN","PSOLLL9",29,0)
 S T="Last Fill: "_$G(PSOFLAST) D PRINT(T)
"RTN","PSOLLL9",30,0)
 S T="Pat. Stat "_PATST_" Clinic: "_PSCLN D PRINT(T)
"RTN","PSOLLL9",31,0)
 W @IOF
"RTN","PSOLLL9",32,0)
 I COPIES>0 G START
"RTN","PSOLLL9",33,0)
 S COPIES=HARDCOPY K HARDCOPY
"RTN","PSOLLL9",34,0)
 ;
"RTN","PSOLLL9",35,0)
STORE ;ALLERGY LABEL PRINT NODE - SHOULD ALWAYS BE ON THE ORIGINAL
"RTN","PSOLLL9",36,0)
 D NOW^%DTC S NOW=% S PSAA=0 F AAA=0:0 S AAA=$O(^PSRX(RX,"L",AAA)) Q:'AAA  S PSAA=AAA
"RTN","PSOLLL9",37,0)
 S PSAA=PSAA+1,^PSRX(RX,"L",0)="^52.032DA^"_PSAA_"^"_PSAA,^PSRX(RX,"L",PSAA,0)=NOW_"^"_0_"^Allergy warning label"_$S($G(RXRP(RX)):" (Reprint)",1:"")_"^"_PDUZ_"^2"
"RTN","PSOLLL9",38,0)
END ;
"RTN","PSOLLL9",39,0)
 Q
"RTN","PSOLLL9",40,0)
PRINT(T) ;
"RTN","PSOLLL9",41,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL9",42,0)
 W T,!
"RTN","PSOLLL9",43,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL9",44,0)
 Q
"RTN","PSOLLLI")
0^6^B59721050
"RTN","PSOLLLI",1,0)
PSOLLLI ;BIR/JLC - LASER LABELS INITIALIZATION ;11/12/02
"RTN","PSOLLLI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLLI",3,0)
 ;
"RTN","PSOLLLI",4,0)
 ;DBIAs PSDRUG-221, PS(55-2228, SC-10040, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097
"RTN","PSOLLLI",5,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",6,0)
DQ1 I '$D(PPL) G HLEX
"RTN","PSOLLLI",7,0)
 I $P($G(PSOPAR),"^",30)=2,'$G(PSOEXREP) G HLEX
"RTN","PSOLLLI",8,0)
 K RXFLX S PSOCKHN=","_$G(PPL),PSRESOLV=+PPL D CHECK
"RTN","PSOLLLI",9,0)
 S PSOINT=1 F PI=1:1 S RX=$P(PPL,",",PI) Q:RX=""  D  K RXP,REPRINT
"RTN","PSOLLLI",10,0)
 . S RXY=$G(^PSRX(RX,0)) Q:RXY=""  I PSOPDFN'=$P(RXY,"^",2),'PSOINT D TRAIL^PSOLLL1 S PSOPDFN=$P(RXY,"^",2)
"RTN","PSOLLLI",11,0)
 . D C
"RTN","PSOLLLI",12,0)
 I 'PSOINT D TRAIL^PSOLLL1
"RTN","PSOLLLI",13,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1
"RTN","PSOLLLI",14,0)
 K PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLLLI",15,0)
 K ^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA
"RTN","PSOLLLI",16,0)
 I '$G(PSOSUREP),'$G(PSOSUSPR) S ZTREQ="@"
"RTN","PSOLLLI",17,0)
 Q
"RTN","PSOLLLI",18,0)
C N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",19,0)
 U IO Q:'$D(^PSRX(RX,0))  S RXY=^(0),RX2=^(2),RXSTA=^("STA") K SGY
"RTN","PSOLLLI",20,0)
 S (SIGM,PFM,PMIM,L2,L3,L4,L5)=0
"RTN","PSOLLLI",21,0)
 K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLLI",22,0)
 F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLLI",23,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y,Y=PSOFNOW X ^DD("DD") S PSONOWT=Y
"RTN","PSOLLLI",24,0)
 S:$G(PSOBLALL) PSOBLRX=RX S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLLLI",25,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 I '$G(RXRP(RX)) S RXRP(RX)=1
"RTN","PSOLLLI",26,0)
 S A=$P(RXSTA,"^") I A>11,'$G(RXP) D AL^PSOLBL("QT") K RXP,REPRINT Q
"RTN","PSOLLLI",27,0)
 I A=3 D AL^PSOLBL("QT") K RXP,REPRINT Q
"RTN","PSOLLLI",28,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXP,REPRINT Q
"RTN","PSOLLLI",29,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXP,REPRINT Q
"RTN","PSOLLLI",30,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXP,REPRINT Q
"RTN","PSOLLLI",31,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXP,REPRINT Q
"RTN","PSOLLLI",32,0)
 . S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA
"RTN","PSOLLLI",33,0)
 . S A=$P($G(^PS(52.5,DA,0)),"^",7) I A="" Q
"RTN","PSOLLLI",34,0)
 . I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLLLI",35,0)
 . K RXRS(RX) S PSOSXQ=1
"RTN","PSOLLLI",36,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLLLI",37,0)
 I $P(RXSTA,"^")'=4 D
"RTN","PSOLLLI",38,0)
 . I $G(PSOSUSPR) D AREC^PSOSUTL
"RTN","PSOLLLI",39,0)
 . I $G(PSOPULL)!($G(RXRS(RX))) D AREC1^PSOSUTL
"RTN","PSOLLLI",40,0)
 . I $G(PSOSUREP) D AREC^PSOSUSRP
"RTN","PSOLLLI",41,0)
 . I $G(PSXREP) D AREC^PSXSRP
"RTN","PSOLLLI",42,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLLI",43,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLLI",44,0)
 S RXN=$P(RXY,"^"),DFN=+$P(RXY,"^",2),PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLLLI",45,0)
 S ISD=$P(RXY,"^",13),RXF=0,SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLLLI",46,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSOLLLI",47,0)
 S FDT=$P(RX2,"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLLLI",48,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLI",49,0)
 S EXPDT=$P(RX2,"^",6),EXDT=$S('EXPDT:"",1:$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_($E(EXPDT,1,3)+1700))
"RTN","PSOLLLI",50,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLLLI",51,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLLLI",52,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLLLI",53,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLLLI",54,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLLLI",55,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLLLI",56,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLLLI",57,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLLLI",58,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLLLI",59,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLLLI",60,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP) D  G STA
"RTN","PSOLLLI",61,0)
 . I '$G(RXFL(RX)) S XTYPE=1 D REF
"RTN","PSOLLLI",62,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLLLI",63,0)
ORIG S TECH=$P($G(^VA(200,+$P(RXY,"^",16),0)),"^"),PHYS=$S($D(^VA(200,+$P(RXY,"^",4),0)):$P(^(0),"^"),1:"UKN")
"RTN","PSOLLLI",64,0)
 S DAYS=$P(RXY,"^",8),QTY=$P(RXY,"^",7)
"RTN","PSOLLLI",65,0)
 D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLLI",66,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLLLI",67,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLLLI",68,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLLLI",69,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLLLI",70,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLLLI",71,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLLLI",72,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLLLI",73,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",74,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",75,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",76,0)
 I MW="W",$G(^PSRX(RX,"MP"))]"" D
"RTN","PSOLLLI",77,0)
 .S PSMP=^PSRX(RX,"MP"),PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLLLI",78,0)
 .K PSMP(PSI)
"RTN","PSOLLLI",79,0)
 ;New mail codes for CMOP
"RTN","PSOLLLI",80,0)
 S X=$G(^PS(55,DFN,0)),PSCAP=$P(X,"^",2),PS55=$P(X,"^",3),PS55X=$P(X,"^",5)
"RTN","PSOLLLI",81,0)
 I PS55X]"",PS55>1,PS55X<DT S PS55=1
"RTN","PSOLLLI",82,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLLLI",83,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLLLI",84,0)
 I $G(PSMP(1))="",$G(PS55)=2 S PSMP(1)=$G(SSNPN)
"RTN","PSOLLLI",85,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLLLI",86,0)
 S (X,PSOFLAST)=$G(PSOLASTF) I X?1N.E D ^%DT X ^DD("DD") S PSOFLAST=Y
"RTN","PSOLLLI",87,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["A"&(DEA'["B"))!(DEA["W") PRTFL=0
"RTN","PSOLLLI",88,0)
 S VRPH=$P(RX2,"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLLI",89,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLLLI",90,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLLLI",91,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLLLI",92,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLLLI",93,0)
 I DEA["I"!(DEA["S") D SNO G LBL
"RTN","PSOLLLI",94,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLLLI",95,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLLLI",96,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ"))
"RTN","PSOLLLI",97,0)
 I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLLLI",98,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6)) D SNO G LBL
"RTN","PSOLLLI",99,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6)) D SNO G LBL
"RTN","PSOLLLI",100,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLLLI",101,0)
 S PSOCPN=$P(RXY,"^",2),INRX=$P(RXY,"^")
"RTN","PSOLLLI",102,0)
 I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLLLI",103,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS),COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLLLI",104,0)
LBL I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLI",105,0)
 I $P(RXSTA,"^")=4 D ^PSOLLL8 Q  ;for a critical interaction entered by a tech - don't allow a label to be printed
"RTN","PSOLLLI",106,0)
 I $D(^PSRX(RX,"DRI")),'$G(RXF),'$G(RXP) D ^PSOLLL8
"RTN","PSOLLLI",107,0)
 I $P($G(^PSRX(RX,3)),"^",6),'$G(RXF),'$G(RXP) D ^PSOLLL9
"RTN","PSOLLLI",108,0)
 S PSOINT=0 G ^PSOLLL1
"RTN","PSOLLLI",109,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLLLI",110,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",111,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLLI",112,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10)
"RTN","PSOLLLI",113,0)
 Q
"RTN","PSOLLLI",114,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLLLI",115,0)
 Q
"RTN","PSOLLLI",116,0)
OSET ;
"RTN","PSOLLLI",117,0)
 N A
"RTN","PSOLLLI",118,0)
 I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLLLI",119,0)
 .S A=^PSRX(RX,0)
"RTN","PSOLLLI",120,0)
 .S TECH=$P($G(^VA(200,+$P(A,"^",16),0)),"^"),QTY=$P(A,"^",7),PHYS=$S($D(^VA(200,+$P(A,"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLLI",121,0)
 .S DAYS=$P(A,"^",8)
"RTN","PSOLLLI",122,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",123,0)
 S A=^PSRX(RX,1,RXFL(RX),0)
"RTN","PSOLLLI",124,0)
 S TECH=$S($D(^VA(200,+$P(A,"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",125,0)
 S QTY=$P(A,"^",4),PHYS=$S($D(^VA(200,+$P(A,"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=$E($G(VA("PID")),5,12)
"RTN","PSOLLLI",126,0)
 S DAYS=$P(A,"^",10)
"RTN","PSOLLLI",127,0)
 Q
"RTN","PSOLLLI",128,0)
DOUB ;
"RTN","PSOLLLI",129,0)
 Q:'$D(RXFL(RX))
"RTN","PSOLLLI",130,0)
 I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLLLI",131,0)
 S RXFLX(RX)=$G(RXFL(RX))
"RTN","PSOLLLI",132,0)
 S RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLLLI",133,0)
 Q
"RTN","PSOLLLI",134,0)
IBCP ;
"RTN","PSOLLLI",135,0)
 N X,Y,PSOJJ,PSOLL
"RTN","PSOLLLI",136,0)
 S PSOLBLCP=""
"RTN","PSOLLLI",137,0)
 S X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLLLI",138,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLLLI",139,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLLLI",140,0)
 Q
"RTN","PSOLLLI",141,0)
SNO ;
"RTN","PSOLLLI",142,0)
 S COPAYVAR="NO COPAY"
"RTN","PSOLLLI",143,0)
 Q
"RTN","PSOLLU1")
0^15^B21553214
"RTN","PSOLLU1",1,0)
PSOLLU1 ;BHAM/RJS - LASER LABEL UTILITIES ;11/22/02
"RTN","PSOLLU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLU1",3,0)
 ;
"RTN","PSOLLU1",4,0)
FONT(RLN,TEXT) ;
"RTN","PSOLLU1",5,0)
 ;--------------------------------------------------------------------
"RTN","PSOLLU1",6,0)
 ;VARIABLES:
"RTN","PSOLLU1",7,0)
 ;    INPUT:
"RTN","PSOLLU1",8,0)
 ; REQUIRED: RLN - Relates to a value used to determine the max
"RTN","PSOLLU1",9,0)
 ;                   line length.
"RTN","PSOLLU1",10,0)
 ;            TEXT - Can contain a string and the $L(TEXT) is used
"RTN","PSOLLU1",11,0)
 ;                    to calculate the font size.
"RTN","PSOLLU1",12,0)
 ;   RETURN:
"RTN","PSOLLU1",13,0)
 ;             FONT - This is the calculated optimal font size.
"RTN","PSOLLU1",14,0)
 ;                    F8, F9, F10 or F12 will be returned. 
"RTN","PSOLLU1",15,0)
 ;--------------------------------------------------------------------
"RTN","PSOLLU1",16,0)
 D STRT(RLN,TEXT,"",.FONT) Q FONT
"RTN","PSOLLU1",17,0)
 Q
"RTN","PSOLLU1",18,0)
 ;
"RTN","PSOLLU1",19,0)
STRT(RLN,TEXT,LNTH,FONT) ;
"RTN","PSOLLU1",20,0)
 ;  The LETTER array contains all the number of character per inch
"RTN","PSOLLU1",21,0)
 ;  for the different font sizes that can be used.
"RTN","PSOLLU1",22,0)
 N LN,LETTER,TXTIDX,SIZ,FNTIDX,LTTR,A
"RTN","PSOLLU1",23,0)
 S LETTER(1)="22^16^14^13^10",LETTER("!")="40^32^28^25^21"
"RTN","PSOLLU1",24,0)
 S LETTER(2)="22^16^14^13^10",LETTER("@")="11^8^7^7^5"
"RTN","PSOLLU1",25,0)
 S LETTER(3)="22^16^14^13^10",LETTER("#")="19^16^14^12^10"
"RTN","PSOLLU1",26,0)
 S LETTER(4)="22^16^14^13^10",LETTER("$")="20^18^16^14^12"
"RTN","PSOLLU1",27,0)
 S LETTER(5)="22^16^14^13^10",LETTER("%")="14^13^11^10^8"
"RTN","PSOLLU1",28,0)
 S LETTER(6)="22^16^14^13^10"
"RTN","PSOLLU1",29,0)
 S LETTER(7)="22^16^14^13^10",LETTER("&")="22^16^14^12^10"
"RTN","PSOLLU1",30,0)
 S LETTER(8)="22^16^14^13^10",LETTER("*")="30^23^20^18^15"
"RTN","PSOLLU1",31,0)
 S LETTER(9)="22^16^14^13^10",LETTER("(")="32^27^24^21^18"
"RTN","PSOLLU1",32,0)
 S LETTER(0)="22^16^14^13^10",LETTER(")")="32^27^24^21^18"
"RTN","PSOLLU1",33,0)
 S LETTER($C(34))="30^27^24^21^18",LETTER("'")="45^40^36^32^27"
"RTN","PSOLLU1",34,0)
 S LETTER("`")="30^27^24^21^18",LETTER("~")="18^15^13^12^10"
"RTN","PSOLLU1",35,0)
 S LETTER(",")="40^32^28^25^21",LETTER("<")="18^15^13^12^10"
"RTN","PSOLLU1",36,0)
 S LETTER(".")="35^27^24^21^18",LETTER(">")="18^15^13^12^10"
"RTN","PSOLLU1",37,0)
 S LETTER(";")="40^32^28^25^21",LETTER(":")="40^32^28^25^21"
"RTN","PSOLLU1",38,0)
 S LETTER("?")="22^16^14^12^10",LETTER("/")="40^32^28^25^21"
"RTN","PSOLLU1",39,0)
 S LETTER("[")="40^32^28^25^21",LETTER("{")="35^26^23^21^17"
"RTN","PSOLLU1",40,0)
 S LETTER("\")="40^32^28^25^21",LETTER("|")="42^34^30^27^23"
"RTN","PSOLLU1",41,0)
 S LETTER("]")="40^32^28^25^21",LETTER("}")="35^26^23^21^17"
"RTN","PSOLLU1",42,0)
 S LETTER("_")="20^15^14^12^10",LETTER("-")="30^27^24^21^18"
"RTN","PSOLLU1",43,0)
 S LETTER("=")="20^15^14^12^10",LETTER("+")="22^18^16^14^12"
"RTN","PSOLLU1",44,0)
 S LETTER(" ")="40^32^28^25^21"
"RTN","PSOLLU1",45,0)
 S LETTER("a")="19^16^14^12^10",LETTER("A")="16^13^11^10^8"
"RTN","PSOLLU1",46,0)
 S LETTER("b")="19^16^14^12^10",LETTER("B")="16^13^11^10^8"
"RTN","PSOLLU1",47,0)
 S LETTER("c")="22^18^16^14^12",LETTER("C")="15^13^11^10^8"
"RTN","PSOLLU1",48,0)
 S LETTER("d")="20^16^14^12^10",LETTER("D")="15^13^11^10^8"
"RTN","PSOLLU1",49,0)
 S LETTER("e")="20^16^14^12^10",LETTER("E")="16^13^11^10^8"
"RTN","PSOLLU1",50,0)
 S LETTER("f")="40^32^28^25^21",LETTER("F")="18^14^13^11^9"
"RTN","PSOLLU1",51,0)
 S LETTER("g")="20^16^14^12^10",LETTER("G")="14^11^10^9^7"
"RTN","PSOLLU1",52,0)
 S LETTER("h")="20^16^14^12^10",LETTER("H")="15^13^11^10^8"
"RTN","PSOLLU1",53,0)
 S LETTER("i")="50^40^36^32^27",LETTER("I")="40^32^28^25^21"
"RTN","PSOLLU1",54,0)
 S LETTER("j")="50^40^36^32^27",LETTER("J")="22^18^16^14^12"
"RTN","PSOLLU1",55,0)
 S LETTER("k")="24^18^16^14^12",LETTER("K")="16^13^11^10^8"
"RTN","PSOLLU1",56,0)
 S LETTER("l")="50^40^36^32^27",LETTER("L")="20^16^14^12^10"
"RTN","PSOLLU1",57,0)
 S LETTER("m")="13^10^9^8^7",LETTER("M")="13^11^10^9^7"
"RTN","PSOLLU1",58,0)
 S LETTER("n")="20^16^14^12^10",LETTER("N")="15^13^11^10^8"
"RTN","PSOLLU1",59,0)
 S LETTER("o")="20^16^14^12^10",LETTER("O")="14^11^10^9^7"
"RTN","PSOLLU1",60,0)
 S LETTER("p")="20^16^14^12^10",LETTER("P")="16^13^11^10^8"
"RTN","PSOLLU1",61,0)
 S LETTER("q")="20^16^14^12^10",LETTER("Q")="14^11^10^9^7"
"RTN","PSOLLU1",62,0)
 S LETTER("r")="35^32^28^25^21",LETTER("R")="15^13^11^10^8"
"RTN","PSOLLU1",63,0)
 S LETTER("s")="22^18^16^14^12",LETTER("S")="16^13^11^10^8"
"RTN","PSOLLU1",64,0)
 S LETTER("t")="40^32^28^25^21",LETTER("T")="18^14^13^11^9"
"RTN","PSOLLU1",65,0)
 S LETTER("u")="20^16^14^12^10",LETTER("U")="15^13^11^10^8"
"RTN","PSOLLU1",66,0)
 S LETTER("v")="23^18^16^14^12",LETTER("V")="16^13^11^10^8"
"RTN","PSOLLU1",67,0)
 S LETTER("w")="14^12^11^9^8",LETTER("W")="11^9^8^7^6"
"RTN","PSOLLU1",68,0)
 S LETTER("x")="23^18^16^14^12",LETTER("X")="16^13^11^10^8"
"RTN","PSOLLU1",69,0)
 S LETTER("y")="23^18^16^14^12",LETTER("Y")="16^13^11^10^8"
"RTN","PSOLLU1",70,0)
 S LETTER("z")="23^18^16^14^12",LETTER("Z")="18^14^13^11^9"
"RTN","PSOLLU1",71,0)
 ;
"RTN","PSOLLU1",72,0)
 ;  The LN array contains the length in inches for the different 
"RTN","PSOLLU1",73,0)
 ;  sections of the laser label.
"RTN","PSOLLU1",74,0)
 S LN("RX#")=3.126
"RTN","PSOLLU1",75,0)
 S LN("RXVAMC")=2.626
"RTN","PSOLLU1",76,0)
 S LN("DRG")=3.376
"RTN","PSOLLU1",77,0)
 S LN("SIG")=3.126
"RTN","PSOLLU1",78,0)
 S LN("WRN")=1.9
"RTN","PSOLLU1",79,0)
 S LN("ML")=2.376
"RTN","PSOLLU1",80,0)
 S LN("ML2")=1.76
"RTN","PSOLLU1",81,0)
 S LN("SEC2")=4.1876
"RTN","PSOLLU1",82,0)
 S LN("SEC2X")=LN("SEC2")
"RTN","PSOLLU1",83,0)
 S LN("SIG2")=LN("SEC2")
"RTN","PSOLLU1",84,0)
 S LN("SEC2B")=LN("WRN")
"RTN","PSOLLU1",85,0)
 S LN("FULL")=8.1876
"RTN","PSOLLU1",86,0)
 ;
"RTN","PSOLLU1",87,0)
 ; The LNTH array is used in calculating the length of the text
"RTN","PSOLLU1",88,0)
 ; for each of the different font sizes.
"RTN","PSOLLU1",89,0)
 S (LNTH(6),LNTH(8),LNTH(9),LNTH(10),LNTH(12))=""
"RTN","PSOLLU1",90,0)
 ;
"RTN","PSOLLU1",91,0)
 ; This section walks the TEXT string and extracts the each character
"RTN","PSOLLU1",92,0)
 ; then uses the LETTER array to lookup the number of characters per
"RTN","PSOLLU1",93,0)
 ; inch and calculates the length of the TEXT for each font.
"RTN","PSOLLU1",94,0)
 F TXTIDX=1:1:$L(TEXT) D
"RTN","PSOLLU1",95,0)
 .S LTTR=$E(TEXT,TXTIDX),A=$G(LETTER(LTTR),"18^16^14^12")
"RTN","PSOLLU1",96,0)
 .S LNTH(6)=LNTH(6)+(1/$P(A,U))
"RTN","PSOLLU1",97,0)
 .S LNTH(8)=LNTH(8)+(1/($P(A,U,2)))
"RTN","PSOLLU1",98,0)
 .S LNTH(9)=LNTH(9)+(1/($P(A,U,3)))
"RTN","PSOLLU1",99,0)
 .S LNTH(10)=LNTH(10)+(1/($P(A,U,4)))
"RTN","PSOLLU1",100,0)
 .S LNTH(12)=LNTH(12)+(1/($P(A,U,5)))
"RTN","PSOLLU1",101,0)
 ;
"RTN","PSOLLU1",102,0)
 ; This section determines what would be the optimal font for the TEXT
"RTN","PSOLLU1",103,0)
 I RLN="WRN" D  Q
"RTN","PSOLLU1",104,0)
 . I LNTH(12)<LN(RLN) S FONT="F12" Q
"RTN","PSOLLU1",105,0)
 . I LNTH(10)<(LN(RLN)*2) S FONT="F10" Q
"RTN","PSOLLU1",106,0)
 . I LNTH(9)<(LN(RLN)*3) S FONT="F9" Q
"RTN","PSOLLU1",107,0)
 . I LNTH(8)<(LN(RLN)*3) S FONT="F8" Q
"RTN","PSOLLU1",108,0)
 . S FONT="F6"
"RTN","PSOLLU1",109,0)
 S FONT="F0"
"RTN","PSOLLU1",110,0)
 I LNTH(8)<LN(RLN) S FONT="F8"
"RTN","PSOLLU1",111,0)
 I LNTH(9)<LN(RLN) S FONT="F9"
"RTN","PSOLLU1",112,0)
 I LNTH(10)<LN(RLN) S FONT="F10"
"RTN","PSOLLU1",113,0)
 I LNTH(12)<LN(RLN) S FONT="F12"
"RTN","PSOLLU1",114,0)
 Q
"RTN","PSOLLU1",115,0)
ADD ; Calculate the and pad "_" to the end of TEXT for change of address
"RTN","PSOLLU1",116,0)
 ; then return FONT and TEXT to calling program.
"RTN","PSOLLU1",117,0)
 N NEEDED,CNT,DASH
"RTN","PSOLLU1",118,0)
 S NEEDED=LN("SEC2X")-LNTH(10)
"RTN","PSOLLU1",119,0)
 S CNT=NEEDED*12\1
"RTN","PSOLLU1",120,0)
 S DASH="________________________________________________________________________________________________________________"
"RTN","PSOLLU1",121,0)
 S TEXT2=TEXT_" "_$E(DASH,1,CNT)
"RTN","PSOLLU1",122,0)
 S FONT="F10"
"RTN","PSOLLU1",123,0)
 Q
"RTN","PSOLLU2")
0^17^B32354316
"RTN","PSOLLU2",1,0)
PSOLLU2 ;BIR/JLC - BUILD CONTROL CODES ;01/24/2003
"RTN","PSOLLU2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120**;DEC 1997
"RTN","PSOLLU2",3,0)
 ;
"RTN","PSOLLU2",4,0)
 ;Reference to %ZIS(2 supported by DBIA 3884
"RTN","PSOLLU2",5,0)
 ;
"RTN","PSOLLU2",6,0)
 N IO,IOST
"RTN","PSOLLU2",7,0)
IO D ^%ZIS
"RTN","PSOLLU2",8,0)
 I '$G(IOST(0)) W "No terminal type available." Q
"RTN","PSOLLU2",9,0)
 I $D(^%ZIS(2,IOST(0),55,"B","LL")) W "CONTROL CODES already defined." Q
"RTN","PSOLLU2",10,0)
TYPE W !,"HP or LexMark: " R TYPE:60 W "  " I TYPE="" Q
"RTN","PSOLLU2",11,0)
 I TYPE'="H",TYPE'="L" W "Enter H for HP or L for LexMark" G TYPE
"RTN","PSOLLU2",12,0)
 W !!,"You will be copying the CONTROL CODES to device: ",IO," are you sure? " R ANS:60 W "  " I ANS'="Y" G IO
"RTN","PSOLLU2",13,0)
 W "Copying..."
"RTN","PSOLLU2",14,0)
 S AB="LL",NAME="LASER LABEL",CODE="Q" D FILE
"RTN","PSOLLU2",15,0)
 S AB="LLI",NAME="LASER LABEL INIT",CODE="W *27,""&r1F"",*27,""E"",*27,""&l0O"",*27,""&u300D"",*27,""&l3A"",*27,""&l0E"",!" D FILE
"RTN","PSOLLU2",16,0)
 S AB="F10",NAME="TEN POINT FONT - NO BOLD",CODE="W *27,""(10U"",*27,""(s1p10v0s0b16602T""" D FILE
"RTN","PSOLLU2",17,0)
 S AB="F8",NAME="EIGHT POINT FONT - NO BOLD",CODE="W *27,""(10U"",*27,""(s1p8v0s0b16602T""" D FILE
"RTN","PSOLLU2",18,0)
 S AB="F12",NAME="TWELVE POINT FONT - NO BOLD",CODE="W *27,""(10U"",*27,""(s1p12v0s0b16602T""" D FILE
"RTN","PSOLLU2",19,0)
 S AB="F9",NAME="NINE POINT FONT - NO BOLD",CODE="W *27,""(10U"",*27,""(s1p9v0s0b16602T""" D FILE
"RTN","PSOLLU2",20,0)
 S AB="ST",NAME="START OF TEXT",CODE="S PSOY=PSOY+PSOYI W *27,""*p"",PSOX,""x"",PSOY,""Y""" D FILE
"RTN","PSOLLU2",21,0)
 S AB="CDII",NAME="CRITICAL DRUG INTERACTION INITIALIZATION",CODE="S PSOX=0,PSOY=1400,PSOYI=50,PSOFONT=""F10""" D FILE
"RTN","PSOLLU2",22,0)
 S AB="PMII",NAME="PMI SECTION INITIALIZATION",CODE="S PSOX=0,PSOY=1350,PSOYI=50,PSOFONT=""F10"",PSOYM=3899" D FILE
"RTN","PSOLLU2",23,0)
 S AB="F10B",NAME="TEN POINT FONT, BOLDED",CODE="W *27,""(10U"",*27,""(s1p10v0s3b16602T""" D FILE
"RTN","PSOLLU2",24,0)
 S AB="F12B",NAME="12 POINT FONT BOLDED",CODE="W *27,""(10U"",*27,""(s1p12v0s3b16602T""" D FILE
"RTN","PSOLLU2",25,0)
 S AB="MLI",NAME="MAILING LABEL INITIALIZATION",CODE="S PSOFONT=""F10"",PSOX=1700,PSOY=175,PSOYI=50" D FILE
"RTN","PSOLLU2",26,0)
 S AB="ACI",NAME="ADDRESS CHANGE INITIALIZATION",CODE="S PSOHFONT=""F12"",PSOX=1210,PSOY=700,PSOFY=1270" D FILE
"RTN","PSOLLU2",27,0)
 S AB="ALI",NAME="ALLERGY SECTION INITIALIZATION",CODE="S PSOFONT=""F10"",PSOX=0,PSOY=1350,PSOYI=50,PSOYM=2700" D FILE
"RTN","PSOLLU2",28,0)
 S AB="FWU",NAME="FONT WITH UNDERLINE",CODE="W *27,""&d0D""" D FILE
"RTN","PSOLLU2",29,0)
 S AB="FDU",NAME="FONT DISABLE UNDERLINE",CODE="W *27,""&d@""" D FILE
"RTN","PSOLLU2",30,0)
 S AB="RMI",NAME="RETURN MAIL INITIALIZATION",CODE="S PSOHFONT=""F8"",PSOFONT=""F10"",PSOX=1700,PSOY=35,PSORYI=50,PSOHYI=40,PSOTFONT=""F8"",PSOTY=550" D FILE
"RTN","PSOLLU2",31,0)
 S AB="SPI",NAME="SUSPENSE PRINT INITIALIZATION",CODE="S PSOFONT=""F10"",PSOX=1210,PSOY=1350,PSOYI=50,PSOCX=1775,PSOYM=2700" D FILE
"RTN","PSOLLU2",32,0)
 S AB="WLI",NAME="WARNING LABEL INITIALIZATION",CODE="S PSOX=1050,PSOY=55" D FILE
"RTN","PSOLLU2",33,0)
 S AB="RNI",NAME="REFILL NARRATIVE INITIALIZATION",CODE="S PSOY=2860,PSOFONT=""F10"",PSOX=0,PSOYI=50,PSOYM=3950" D FILE
"RTN","PSOLLU2",34,0)
 S AB="CNI",NAME="COPAY NARRATIVE INITIALIZATION",CODE="S PSOY=2860,PSOX=1210,PSOYM=3950,PSOFONT=""F10"",PSOYI=50" D FILE
"RTN","PSOLLU2",35,0)
 S AB="PII",NAME="PATIENT INSTRUCTION INITIALIZATION",CODE="S PSOX=1210,PSOY=760,PSOFONT=""F12""" D FILE
"RTN","PSOLLU2",36,0)
 S AB="RPI",NAME="REFILL PRINT INITIALIZATION",CODE="S PSOFONT=""F10"",PSOBYI=65,PSOTYI=50,PSOLX=0,PSORX=1210,PSOY=1350,PSOYM=3650,PSOXI=90,PSOSYI=135" D FILE
"RTN","PSOLLU2",37,0)
 S AB="BLH",NAME="BOTTLE LABEL HEADER INITIALIZATION",CODE="S PSOX=100,PSOY=50,PSOYI=30,PSOFONT=""F9""" D FILE
"RTN","PSOLLU2",38,0)
 S AB="BLB",NAME="BOTTLE LABEL BODY INITIALIZATION",CODE="S PSOX=0,PSODX=275,PSOY=140,PSOYI=40,PSOYM=379,PSOFONT=""F10""" D FILE
"RTN","PSOLLU2",39,0)
 S AB="BLF",NAME="BOTTLE LABEL FOOTER INITIALIZATION",CODE="S PSODY=460,PSOX=0,PSOCX=280,PSOQY=550,PSOTY=600,PSOFONT=""F10"",PSOQFONT=""F8"",PSODFONT=""F9"",PSOTFONT=""F10""" D FILE
"RTN","PSOLLU2",40,0)
 S AB="RT",NAME="ROTATE TEXT",CODE="W *27,""&a90P""" D FILE
"RTN","PSOLLU2",41,0)
 S AB="NR",NAME="NORMAL ROTATION",CODE="W *27,""&a0P""" D FILE
"RTN","PSOLLU2",42,0)
 S AB="PFDI",NAME="PHARMACY FILL DOCUMENT INITIALIZATION",CODE="S PSOFONT=""F10"",PSOX=0,PSOY=690,PSOYI=40,PSOYM=969" D FILE
"RTN","PSOLLU2",43,0)
 S AB="PFDQ",NAME="PHARMACY FILL DOCUMENT QUANTITY",CODE="S PSOX=0,PSOCX=200,PSOY=970,PSOYI=50,PSOQFONT=""F8"",PSOFONT=""F10""" D FILE
"RTN","PSOLLU2",44,0)
 S AB="PFDW",NAME="PHARMACY FILL DOCUMENT WARNING",CODE="S PSOY=1270,PSOX=600,PSOYI=30,PSOFONT=""F8"",PSOYM=1329" D FILE
"RTN","PSOLLU2",45,0)
 S AB="AWI",NAME="ALLERGY WARNING INITIALIZATION",CODE="S PSOX=0,PSOY=1400,PSOYI=50,PSOFONT=""F10""" D FILE
"RTN","PSOLLU2",46,0)
 S AB="F6",NAME="SIX POINT FONT - NO BOLD",CODE="W *27,""(10U"",*27,""(s1p6v0s0b16602T""" D FILE
"RTN","PSOLLU2",47,0)
 S AB="EBT",NAME="END OF BARCODE TEXT",CODE="W *27,""(8U"",*27,""(s1p8v0s0b16602T"",!" D FILE
"RTN","PSOLLU2",48,0)
 D @TYPE Q
"RTN","PSOLLU2",49,0)
H S AB="BLBC",NAME="BOTTLE LABEL BARCODE",CODE="W *27,""(9Y"",*27,""(s1p18v0s0b28677T"",*27,""&a90P"",*27,""*p3700x1000Y""" D FILE
"RTN","PSOLLU2",50,0)
 S AB="PFDT",NAME="PHARMACY FILL DOCUMENT TRAILER",CODE="S PSOY=1015,PSOYI=45,PSOX=0,PSOFONT=""F10"",PSOBYI=50,PSOTFONT=""F9"",PSOBY=1260" D FILE
"RTN","PSOLLU2",51,0)
 S AB="EBLBC",NAME="END OF BOTTLE LABEL BARCODE",CODE="W *27,""(10U"",*27,""(s1p10v0s0b16602T"",*27,""&a0P"",!" D FILE
"RTN","PSOLLU2",52,0)
 S AB="SBT",NAME="START OF BARCODE TEXT",CODE="S PSOY=PSOY+PSOYI W *27,""*p"",PSOX,""x"",PSOY,""Y"",*27,""(9Y"",*27,""(s1p18v0s0b28683T""" D FILE
"RTN","PSOLLU2",53,0)
 S AB="PFI",NAME="PATIENT FILL INITIALIZATION",CODE="S PSOFONT=""F10"",PSOX=1230,PSOY=690,PSOYI=50,PSOHFONT=""F12"",PSOBYI=75" D FILE
"RTN","PSOLLU2",54,0)
 Q
"RTN","PSOLLU2",55,0)
L S AB="BLBC",NAME="BOTTLE LABEL BARCODE",CODE="W *27,""(s1p10.4v4,12b4,12s24670T"",*27,""&a90P"",*27,""*p3650x1000Y""" D FILE
"RTN","PSOLLU2",56,0)
 S AB="PFDT",NAME="PHARMACY FILL DOCUMENT TRAILER",CODE="S PSOY=1015,PSOYI=45,PSOX=0,PSOFONT=""F10"",PSOBYI=50,PSOTFONT=""F9"",PSOBY=1280" D FILE
"RTN","PSOLLU2",57,0)
 S AB="EBLBC",NAME="END OF BOTTLE LABEL BARCODE",CODE="W *27,""(10U"",*27,""(s1p10v0s0b16602T"",*27,""&a0P"",!" D FILE
"RTN","PSOLLU2",58,0)
 S AB="SBT",NAME="START OF BARCODE TEXT",CODE="S PSOY=PSOY+PSOYI W *27,""*p"",PSOX,""x"",PSOY,""Y"",*27,""(s1p14.4v6,18b6,18s24670T""" D FILE
"RTN","PSOLLU2",59,0)
 S AB="PFI",NAME="PATIENT FILL INITIALIZATION",CODE="S PSOFONT=""F10"",PSOX=1210,PSOY=690,PSOYI=50,PSOHFONT=""F12"",PSOBYI=100" D FILE
"RTN","PSOLLU2",60,0)
 Q
"RTN","PSOLLU2",61,0)
FILE K DIC,DIE S DIC(0)="L",DA(1)=IOST(0),X=AB,DIC="^%ZIS(2,"_DA(1)_",55," D FILE^DICN
"RTN","PSOLLU2",62,0)
 K DA,DR,DIE S DIE=DIC,DA=+Y,DA(1)=IOST(0)
"RTN","PSOLLU2",63,0)
 S DR=".01////"_AB_";1////"_NAME_";2////"_CODE D ^DIE
"RTN","PSOLLU2",64,0)
 Q
"RTN","PSOLSET")
0^1^B29370322
"RTN","PSOLSET",1,0)
PSOLSET ;BHAM ISC/SAB - site parameter set up ;12/03/92
"RTN","PSOLSET",2,0)
VERS ;;7.0;OUTPATIENT PHARMACY;**10,22,32,40,120**;DEC 1997
"RTN","PSOLSET",3,0)
 ;
"RTN","PSOLSET",4,0)
 ;Reference to ^PS(59.7 supported by DBIA 694
"RTN","PSOLSET",5,0)
 ;Reference to ^PSX(550 supported by DBIA 2230
"RTN","PSOLSET",6,0)
 ;Reference to ^%ZIS supported by DBIA 3435
"RTN","PSOLSET",7,0)
 ;
"RTN","PSOLSET",8,0)
 I '$D(DUZ) W !,$C(7),"DUZ Number must be defined !!",! G LEAVE
"RTN","PSOLSET",9,0)
 W !,"Outpatient Pharmacy software - Version "_$P($T(VERS),";",3)
"RTN","PSOLSET",10,0)
 I $D(^XTMP("PSO_V7 INSTALL",0)) W !!,"Outpatient Pharmacy software is being installed.  PLEASE TRY LATER!",! G LEAVE
"RTN","PSOLSET",11,0)
 S PSOBAR1="",PSOBARS=0 ;make sure we have one
"RTN","PSOLSET",12,0)
 S PSOCNT=0 F I=0:0 S I=$O(^PS(59,I)) Q:'I  S PSOCNT=PSOCNT+1,Y=I
"RTN","PSOLSET",13,0)
 G DIV1:PSOCNT W !,$C(7) S DIR("A",1)="Site parameters must be specified for at least one site."
"RTN","PSOLSET",14,0)
 S DIR("A",2)="This is usually done by the package Co-ordinator.",DIR("A")="Do you want to continue:  ",DIR("B")="YES",DIR(0)="SA^Y:YES;N:NO",DIR("?")="Enter Y to edit site parameters or N to exit." D ^DIR
"RTN","PSOLSET",15,0)
 G LEAVE:"Y"'[$E(X)
"RTN","PSOLSET",16,0)
 W ! D ^PSOSITED G PSOLSET
"RTN","PSOLSET",17,0)
DIV1 G:PSOCNT=1 DIV3 S DIR(0)="Y",DIR("?")="Enter 'Y' to select Division or 'N' to EXIT"
"RTN","PSOLSET",18,0)
DIV2 I PSOCNT>1 W ! S DIC("A")="Division: ",DIC=59,DIC(0)="AEMQ"
"RTN","PSOLSET",19,0)
 S:$G(PSOVEX)'=1 DIC("S")="I $S('$D(^PS(59,+Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0)"
"RTN","PSOLSET",20,0)
 D ^DIC K DIC G:$D(DUOUT)!($D(DTOUT)) LEAVE
"RTN","PSOLSET",21,0)
 I +Y<0 W $C(7),! S DIR("A",1)="A 'DIVISION' must be selected!",DIR("A")="Do you want to try again",DIR("B")="YES" D ^DIR G:'Y LEAVE G DIV2
"RTN","PSOLSET",22,0)
DIV3 K DIR S PSOSITE=+Y W:PSOCNT>1 !!?10,"You are logged on under the ",$P(^PS(59,PSOSITE,0),"^")," division.",! S PSOPAR=$G(^PS(59,PSOSITE,1)),PSOPAR7=$G(^PS(59,PSOSITE,"IB")),PSOSYS=$G(^PS(59.7,1,40.1)) D CUTDATE^PSOFUNC
"RTN","PSOLSET",23,0)
 S PSOPINST=$P($G(^PS(59,PSOSITE,"INI")),"^")
"RTN","PSOLSET",24,0)
 S (SITE,DA)=$P(^XMB(1,1,"XUS"),"^",17),DIC="4",DIQ(0)="IE",DR=".01;99",DIQ="PSXUTIL" D EN^DIQ1 S S3=$G(PSXUTIL(4,SITE,99,"I")),S2=$G(PSXUTIL(4,SITE,.01,"E")) K DA,DIC,DIQ(0),DR
"RTN","PSOLSET",25,0)
 S PSXSYS=+$O(^PSX(550,"C",""))_"^"_$G(S3)_"^"_$G(S2),PSOINST=S3
"RTN","PSOLSET",26,0)
 K S3,S2,S1,PSXUTIL
"RTN","PSOLSET",27,0)
 I $G(PSXSYS) D
"RTN","PSOLSET",28,0)
 .K:($P($G(^PSX(550,+PSXSYS,0)),"^",2)'="A") PSXSYS
"RTN","PSOLSET",29,0)
 .S Y=$$VERSION^XPDUTL("PSO") I Y>6.0 S PSXVER=1
"RTN","PSOLSET",30,0)
 E  K PSXSYS
"RTN","PSOLSET",31,0)
 S PSODIV=$S(($P(PSOSYS,"^",2))&('$P(PSOSYS,"^",3)):0,1:1)
"RTN","PSOLSET",32,0)
 I $D(DUZ),$D(^VA(200,+DUZ,0)) S PSOCLC=DUZ
"RTN","PSOLSET",33,0)
PLBL I $P(PSOPAR,"^",8) D
"RTN","PSOLSET",34,0)
 .S %ZIS="MNQ",%ZIS("A")="Select PROFILE PRINTER: " S:$G(PSOCLBL)&($D(PSOPROP)) %ZIS("B")=PSOPROP
"RTN","PSOLSET",35,0)
 .D ^%ZIS K %ZIS,IO("Q"),IOP Q:POP  S PSOPROP=ION D ^%ZISC
"RTN","PSOLSET",36,0)
LBL S %ZIS="MNQ",%ZIS("A")="Select LABEL PRINTER: " S:$G(PSOCLBL)&($D(PSOLAP))!($G(SUSPT)) %ZIS("B")=$S($G(SUSPT):PSLION,1:PSOLAP)
"RTN","PSOLSET",37,0)
 D ^%ZIS K %ZIS,IO("Q"),IOP G:POP EXIT S @$S($G(SUSPT):"PSLION",1:"PSOLAP")=ION,PSOPIOST=$G(IOST(0))
"RTN","PSOLSET",38,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOLSET",39,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19),PSOIOS=IOS D ^%ZISC
"RTN","PSOLSET",40,0)
LASK I $G(PSOPIOST),$D(^%ZIS(2,PSOPIOST,55,"B","LL")) G EXIT
"RTN","PSOLSET",41,0)
 K DIR S DIR("A")="OK to assume label alignment is correct",DIR("B")="YES",DIR(0)="Y",DIR("?")="Enter Y if labels are aligned, N if they need to be aligned." D ^DIR G:Y!($D(DIRUT)) EXIT
"RTN","PSOLSET",42,0)
P2 S IOP=$G(PSOLAP) D ^%ZIS K IOP I POP W $C(7),!?5,"Printer is busy.",! G LASK
"RTN","PSOLSET",43,0)
 U IO(0) W !,"Align labels so that a perforation is at the top of the",!,"print head and the left side is at column zero."
"RTN","PSOLSET",44,0)
 W ! K DIR,DIRUT,DUOUT,DTOUT S DIR(0)="E" D ^DIR K DIR,DTOUT,DUOUT Q:$D(DIRUT)  D ^PSOLBLT D ^%ZISC
"RTN","PSOLSET",45,0)
 K DIRUT,DIR S DIR("A")="Is this correct",DIR("B")="YES",DIR(0)="Y",DIR("?")="Enter Y if labels are aligned correctly, N if they need to be aligned." D ^DIR G:Y!($D(DIRUT)) EXIT
"RTN","PSOLSET",46,0)
 G P2
"RTN","PSOLSET",47,0)
LEAVE S XQUIT="" G FINAL
"RTN","PSOLSET",48,0)
Q W !?10,$C(7),"Default printer for labels must be entered." G LBL
"RTN","PSOLSET",49,0)
 ;
"RTN","PSOLSET",50,0)
EXIT D ^%ZISC Q:$G(PSOCLBL)
"RTN","PSOLSET",51,0)
 D:'$G(PSOBFLAG) GROUP K I,IOP,X,Y,%ZIS,DIC,J,DIR,X,Y,DTOUT,DIROUT,DIRUT,DUOUT Q
"RTN","PSOLSET",52,0)
 ;
"RTN","PSOLSET",53,0)
FINAL ;exit action from main menu - kill and quit
"RTN","PSOLSET",54,0)
 K SITE,PSOCP,PSNP,PSL,PRCA,PSLION,PSOPINST
"RTN","PSOLSET",55,0)
 K GROUPCNT,DISGROUP,PSOCAP,PSOINST,PSOION,PSONULBL,PSOSITE7,PFIO,PSOIOS,X,Y,PSOSYS,PSODIV,PSOPAR,PSOPAR7,PSOLAP,PSOPROP,PSOCLC,PSOCNT
"RTN","PSOLSET",56,0)
 K PSODTCUT,PSOSITE,PSOPRPAS,PSOBAR1,PSOBAR0,PSOBARS,SIG,DIR,DIRUT,DTOUT,DIROUT,DUOUT,I,%ZIS,DIC,J,PSOREL
"RTN","PSOLSET",57,0)
 Q
"RTN","PSOLSET",58,0)
GROUP ;display group
"RTN","PSOLSET",59,0)
 S GROUPCNT=0,AGROUP="" I $D(^PS(59.3,0)) F  S AGROUP=$O(^PS(59.3,"B",AGROUP)) Q:AGROUP=""  D
"RTN","PSOLSET",60,0)
 .S GROUPCNT=GROUPCNT+1 I GROUPCNT=1 S AGROUP1=AGROUP
"RTN","PSOLSET",61,0)
 S:GROUPCNT=1 GRPNME=AGROUP1,II="" G:GROUPCNT>1 GROUP1
"RTN","PSOLSET",62,0)
 Q:'$D(GRPNME)  F  S II=$O(^PS(59.3,"B",GRPNME,II)) Q:II=""  S DISGROUP=II
"RTN","PSOLSET",63,0)
 K AGROUP,AGROUP1,GRPNME,II
"RTN","PSOLSET",64,0)
 Q
"RTN","PSOLSET",65,0)
GROUP1 W ! S DIC("A")="Bingo Board Display: ",DIC=59.3,DIC(0)="AEMQZ",DIR(0)="Y",DIR("?")="Enter 'Y' to select Bingo Board Display or 'N' to EXIT"
"RTN","PSOLSET",66,0)
 S:$P($G(^PS(59,PSOSITE,1)),"^",20) DIC("B")=$P($G(^PS(59,PSOSITE,1)),"^",20)
"RTN","PSOLSET",67,0)
 D ^DIC K DIC Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOLSET",68,0)
 I +Y<0 W $C(7) S DIR("A",1)="A 'BINGO BOARD DISPLAY' should be selected!",DIR("A")="Do you want to try again",DIR("B")="YES",DIR("?")="A display group must be defined in order to run Bingo Board." D ^DIR Q:"Y"'[$E(X)  G GROUP
"RTN","PSOLSET",69,0)
 S DISGROUP=+Y
"RTN","PSOLSET",70,0)
 K DIR,DIC,AGROUP,AGROUP1,GRPNME,II
"RTN","PSOLSET",71,0)
 Q
"RTN","PSORXRP1")
0^4^B21985574
"RTN","PSORXRP1",1,0)
PSORXRP1 ;BIR/SAB-rx speed reprint listman ;03/06/95
"RTN","PSORXRP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,120**;DEC 1997
"RTN","PSORXRP1",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRP1",4,0)
SEL N VALMCNT I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSORXRP1",5,0)
 S RXCNT=0 K PSOFDR,DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR S LST=Y I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" Q
"RTN","PSORXRP1",6,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,PSOREPX I +LST S PSOOELSE=1 D
"RTN","PSORXRP1",7,0)
 .D FULL^VALM1 K DIR S DIR("A")="Number of Copies? ",DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 TO 99)"
"RTN","PSORXRP1",8,0)
 .D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S COPIES=Y
"RTN","PSORXRP1",9,0)
 .K DIR S DIR("A")="Print adhesive portion of label only? ",DIR(0)="Y",DIR("B")="N",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRP1",10,0)
 .S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S SIDE=Y
"RTN","PSORXRP1",11,0)
 .K DIRUT,DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRP1",12,0)
 .D ^DIR K DIR S:$D(DIRUT) PSOREPX=1 Q:$D(DIRUT)  S (PCOM,PCOMX)=Y
"RTN","PSORXRP1",13,0)
 .S PSOCLC=DUZ
"RTN","PSORXRP1",14,0)
 .F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD),QFLG=0 D:+PSOLST(ORN)=52 RX
"RTN","PSORXRP1",15,0)
 .S VALMBCK="R"
"RTN","PSORXRP1",16,0)
 I $G(PSOREPX) S VALMBCK="R",VALMSG="No Labels Reprinted."
"RTN","PSORXRP1",17,0)
 K PSOREPX
"RTN","PSORXRP1",18,0)
 I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSORXRP1",19,0)
 D ^PSOBUILD
"RTN","PSORXRP1",20,0)
 K PSOMSG,PSORPSRX,QFLG,%,DIR,DUOUT,DTOUT,DIROUT,DIRUT,PCOM,PCOMX,C,I,J,JJJ,K,RX,RXF,X,Y,Z,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSOOELSE,ORD,LST,ORN D KVA^VADPT
"RTN","PSORXRP1",21,0)
 Q
"RTN","PSORXRP1",22,0)
 ;
"RTN","PSORXRP1",23,0)
RX ;process reprint request
"RTN","PSORXRP1",24,0)
 Q:$P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^")>11
"RTN","PSORXRP1",25,0)
 S PSORPSRX=$P(PSOLST(ORN),"^",2) D PSOL^PSSLOCK(PSORPSRX) I '$G(PSOMSG) W $C(7),!!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P($G(^PSRX(PSORPSRX,0)),"^")),! D PAUSE^VALM1 K PSORPSRX,PSOMSG Q
"RTN","PSORXRP1",26,0)
 S RX=$P(PSOLST(ORN),"^",2),STA=$P(^PSRX($P(PSOLST(ORN),"^",2),"STA"),"^") D CHK I $G(QFLG) D ULR Q
"RTN","PSORXRP1",27,0)
 S RXF=0,ZD(RX)=DT,REPRINT=1
"RTN","PSORXRP1",28,0)
 S RXRP($P(PSOLST(ORN),"^",2))=1_"^"_$G(COPIES)_"^"_$S($G(SIDE):1,1:0)
"RTN","PSORXRP1",29,0)
 S RXFL($P(PSOLST(ORN),"^",2))=0 F ZZZ=0:0 S ZZZ=$O(^PSRX($P(PSOLST(ORN),"^",2),1,ZZZ)) Q:'ZZZ  S RXFL($P(PSOLST(ORN),"^",2))=ZZZ
"RTN","PSORXRP1",30,0)
 K ZZZ
"RTN","PSORXRP1",31,0)
 I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=RX_"," S ST="" D ACT1,ULR Q
"RTN","PSORXRP1",32,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXRP1",33,0)
 I $L(PSORX("PSOL",PSOX2))+$L(RX)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_RX_","
"RTN","PSORXRP1",34,0)
 E  S PSORX("PSOL",PSOX2+1)=RX_","
"RTN","PSORXRP1",35,0)
 S ST="" D ACT1
"RTN","PSORXRP1",36,0)
 D ULR
"RTN","PSORXRP1",37,0)
 Q
"RTN","PSORXRP1",38,0)
CHK ;check for valid reprint
"RTN","PSORXRP1",39,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  S QFLG=1 Q
"RTN","PSORXRP1",40,0)
 .I $P(^PSRX(RX,"STA"),"^")<11 S $P(^PSRX(RX,"STA"),"^")=11 D
"RTN","PSORXRP1",41,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(RX,"SC","ZE",COMM) K COMM
"RTN","PSORXRP1",42,0)
 S DFN=PSODFN D DEM^VADPT I $P(VADM(6),"^",2)]"" D  S QFLG=1 Q
"RTN","PSORXRP1",43,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRP1",44,0)
 .D ACT1
"RTN","PSORXRP1",45,0)
 I $D(RXPR($P(PSOLST(ORN),"^",2)))!$D(RXRP($P(PSOLST(ORN),"^",2))) S QFLG=1 Q
"RTN","PSORXRP1",46,0)
 D VALID Q:$G(QFLG)
"RTN","PSORXRP1",47,0)
 S X=$O(^PS(52.5,"B",RX,0)) I X,'$G(^PS(52.5,X,"P")) S QFLG=1 Q
"RTN","PSORXRP1",48,0)
 I $G(X)'>0 G GOOD
"RTN","PSORXRP1",49,0)
 I $P($G(^PS(52.5,X,0)),"^",7)']"" G GOOD
"RTN","PSORXRP1",50,0)
 I $P($G(^PS(52.5,X,0)),"^",7)="Q" K X,XX S QFLG=1 Q
"RTN","PSORXRP1",51,0)
 I $P($G(^PS(52.5,X,0)),"^",7)="L" K X,XX S QFLG=1 Q
"RTN","PSORXRP1",52,0)
GOOD K X
"RTN","PSORXRP1",53,0)
 I $D(^PS(52.4,RX)) S QFLG=1 Q
"RTN","PSORXRP1",54,0)
 I $D(^PS(52.4,"AREF",PSODFN,RX)) S QFLG=1 Q
"RTN","PSORXRP1",55,0)
 I $G(PSODIV),$D(^PSRX(RX,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=RX D CHK1^PSOUTLA I $G(POERR)&(PSPOP) S QFLG=1 Q
"RTN","PSORXRP1",56,0)
 I STA=3!(STA=4)!(STA=12) S QFLG=1 Q
"RTN","PSORXRP1",57,0)
 Q
"RTN","PSORXRP1",58,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(RX,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRP1",59,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(RX,"A",J)) Q:'J  S IR=J
"RTN","PSORXRP1",60,0)
 S IR=IR+1,^PSRX(RX,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRP1",61,0)
 D NOW^%DTC S ^PSRX(RX,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,XX,%,%H,%I,RXF
"RTN","PSORXRP1",62,0)
 S:$P(^PSRX(RX,2),"^",15)&($G(ST)'="C") $P(^PSRX(RX,2),"^",14)=1
"RTN","PSORXRP1",63,0)
 Q
"RTN","PSORXRP1",64,0)
VALID ;check for rx in label array
"RTN","PSORXRP1",65,0)
 I $O(PSORX("PSOL",0)) D
"RTN","PSORXRP1",66,0)
 .F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  I PSORX("PSOL",PSOX1)[RX_"," S QFLG=1 Q
"RTN","PSORXRP1",67,0)
 Q
"RTN","PSORXRP1",68,0)
ULR ;
"RTN","PSORXRP1",69,0)
 I $G(PSORPSRX) D PSOUL^PSSLOCK(PSORPSRX)
"RTN","PSORXRP1",70,0)
 Q
"RTN","PSORXRP2")
0^3^B29174691
"RTN","PSORXRP2",1,0)
PSORXRP2 ;BIR/SAB-main menu entry reprint of a Rx label ;10/18/96
"RTN","PSORXRP2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,27,120**;DEC 1997
"RTN","PSORXRP2",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRP2",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORXRP2",5,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) G KILL
"RTN","PSORXRP2",6,0)
LRP K REPRINT W !! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")<10",DIC="^PSRX(",DIC("A")="Reprint Prescription Label: ",DIC(0)="QEAZ" D ^DIC K P,DIC("A") I Y<0!("^"[X) K PCOM,PCOMX G KILL
"RTN","PSORXRP2",7,0)
 S (PPL,DA,RX,PSORPRX)=+Y,PDA=Y(0),RXF=0,ZD(DA)=DT,REPRINT=1,STA=+$G(^PSRX(+Y,"STA"))
"RTN","PSORXRP2",8,0)
 D PSOL^PSSLOCK(PSORPRX) I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),! K PSOMSG G LRP
"RTN","PSORXRP2",9,0)
 I $P(^PSRX(RX,"STA"),"^")=14 W $C(7),!,"Cannot Reprint! Discontinued by Provider." D ULR,KILL Q
"RTN","PSORXRP2",10,0)
 I $P(^PSRX(RX,"STA"),"^")=15 W $C(7),!,"Cannot Reprint! Discontinued due to editing." D ULR,KILL Q
"RTN","PSORXRP2",11,0)
 I $P(^PSRX(RX,"STA"),"^")=16 W $C(7),!,"Cannot Reprint! Placed on HOLD by Provider." D ULR,KILL Q
"RTN","PSORXRP2",12,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  D ULR,KILL G LRP
"RTN","PSORXRP2",13,0)
 .W !,$C(7),"Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSORXRP2",14,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSORXRP2",15,0)
 S DFN=$P(PDA,"^",2) D DEM^VADPT I $P(VADM(6),"^",2)]"" D  G LRP
"RTN","PSORXRP2",16,0)
 .W $C(7),!!,$P(^DPT($P(PDA,"^",2),0),"^")_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSORXRP2",17,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRP2",18,0)
 .D ACT1,ULR,KILL
"RTN","PSORXRP2",19,0)
 S X=$O(^PS(52.5,"B",DA,0)) I X,'$G(^PS(52.5,X,"P")) W !,$C(7),"Rx may NOT be printed using this option, use SUSPENSE FUNCTIONS Options." K X D ULR,KILL G LRP
"RTN","PSORXRP2",20,0)
 I $G(X)'>0 G GOOD
"RTN","PSORXRP2",21,0)
 S XX=$P($G(^PS(52.5,X,0)),U,7) I $G(XX)']"" G GOOD
"RTN","PSORXRP2",22,0)
 I $G(XX)="Q" W !,"RX CAN NOT BE PRINTED using this option, use SUSPENSE FUNCTIONS Options." K X,XX D ULR,KILL G LRP
"RTN","PSORXRP2",23,0)
 I $G(XX)="L" W !,"RX is being transmitted to the CMOP and can not be reprinted now." K X,XX D ULR,KILL G LRP
"RTN","PSORXRP2",24,0)
GOOD K X
"RTN","PSORXRP2",25,0)
 I $D(^PS(52.4,DA)) W !,"Prescription is Non-Verified",!! D ULR,KILL G LRP
"RTN","PSORXRP2",26,0)
 S DFN=$P(^PSRX(DA,0),"^",2) I $D(^PS(52.4,"AREF",DFN,DA)) W !,"Prescription is waiting for others to be verified",!! D ULR,KILL G LRP
"RTN","PSORXRP2",27,0)
 I $G(PSODIV),$D(^PSRX(DA,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=DA D CHK1^PSOUTLA I PSPOP D ULR,KILL G LRP
"RTN","PSORXRP2",28,0)
 I STA=3 W !?3,"Prescription is on Hold" D ULR,KILL G LRP
"RTN","PSORXRP2",29,0)
 I STA=4 W !?3,"Prescription is Pending Due to Drug Interactions" D ULR,KILL G LRP
"RTN","PSORXRP2",30,0)
 I STA=12 W !?3,"Prescription is Discontinued" D ULR,KILL G LRP
"RTN","PSORXRP2",31,0)
 S COPIES=$S($P(PDA,"^",18)]"":$P(PDA,"^",18),1:1)
"RTN","PSORXRP2",32,0)
 K DIR S DIR("A")="Number of Copies? ",DIR("B")=COPIES,DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 TO 99)"
"RTN","PSORXRP2",33,0)
 D ^DIR K DIR I $D(DIRUT)!($D(DIROUT)) D ULR,KILL G LRP
"RTN","PSORXRP2",34,0)
 S COPIES=X
"RTN","PSORXRP2",35,0)
 K DIR S DIR("A")="Print adhesive portion of label only? ",DIR(0)="SA^Y:YES;N:NO",DIR("B")="N",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRP2",36,0)
 S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR I $D(DUOUT) D ULR,KILL G LRP
"RTN","PSORXRP2",37,0)
 I $D(DTOUT)!($D(DIRUT))!($D(DIROUT)) D ULR G KILL
"RTN","PSORXRP2",38,0)
 S SIDE=$S(X="Y":1,1:0) D ACT I $D(DIRUT) D ULR,KILL G LRP
"RTN","PSORXRP2",39,0)
 I $D(PCOM) D ULR,KILL G LRP
"RTN","PSORXRP2",40,0)
 F I=1,2,4,6,7,9,13,16 S P(I)=$P(PDA,"^",I)
"RTN","PSORXRP2",41,0)
 S P(6)=+P(6) I $D(^PSRX(DA,"TN")),^("TN")]"" S P(6)=^("TN")
"RTN","PSORXRP2",42,0)
 W !!,"Rx # "_P(1),?23,$E(P(13),4,5)_"/"_$E(P(13),6,7)_"/"_$E(P(13),2,3),!,$S($D(^DPT(+P(2),0)):$P(^(0),"^"),1:"Not on File"),?30,"#"_P(7),!
"RTN","PSORXRP2",43,0)
 I $P($G(^PSRX(DA,"SIG")),"^",2) S D=0 D  K D,FSIG
"RTN","PSORXRP2",44,0)
 .D FSIG^PSOUTLA("R",DA,75) F  S D=$O(FSIG(D)) W !,FSIG(D) Q:'$O(FSIG(D))
"RTN","PSORXRP2",45,0)
 E  D EN3^PSOUTLA1(DA,75) S D=0 F  S D=$O(BSIG(D)) W !,BSIG(D) Q:'$O(BSIG(D))
"RTN","PSORXRP2",46,0)
 K D,BSIG
"RTN","PSORXRP2",47,0)
 W !!,$S((P(6)=+P(6))&$D(^PSDRUG(P(6),0)):$P(^(0),"^"),1:P(6)),! S PHYS=$S($D(^VA(200,+P(4),0)):$P(^(0),"^"),1:"Unknown") W PHYS K PHYS
"RTN","PSORXRP2",48,0)
 W ?25,$S($D(^VA(200,+P(16),0)):$P(^(0),"^"),1:"Unknown"),!,"# of Refills: "_$G(P(9))
"RTN","PSORXRP2",49,0)
 I $G(RX) S RXRP(RX)=1_"^"_$G(COPIES)_"^"_$S($G(SIDE):1,1:0)
"RTN","PSORXRP2",50,0)
 I $G(RX) S RXFL(RX)=0 F ZZZ=0:0 S ZZZ=$O(^PSRX(RX,1,ZZZ)) Q:'ZZZ  S RXFL(RX)=ZZZ
"RTN","PSORXRP2",51,0)
 D @$S($P($G(PSOPAR),"^",26):"^PSORXL",1:"Q^PSORXL") K PSPOP,PPL,COPIES,SIDE,REPRINT,PCOM,IOP,PSL,PSNP,ZZZ,RXFL(+$G(RX)) D ULR,KILL G LRP
"RTN","PSORXRP2",52,0)
 ;
"RTN","PSORXRP2",53,0)
ACT K DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRP2",54,0)
 D ^DIR K DIR Q:$D(DIRUT)!($D(DIROUT))  S (PCOM,PCOMX)=X
"RTN","PSORXRP2",55,0)
 I '$D(PSOCLC) S PSOCLC=DUZ
"RTN","PSORXRP2",56,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRP2",57,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(DA,"A",J)) Q:'J  S IR=J
"RTN","PSORXRP2",58,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRP2",59,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,PCOM,XX,%,%H,%I,RXF
"RTN","PSORXRP2",60,0)
 S:$P(^PSRX(DA,2),"^",15)&($G(ST)'="C") $P(^PSRX(DA,2),"^",14)=1
"RTN","PSORXRP2",61,0)
 Q
"RTN","PSORXRP2",62,0)
 ;
"RTN","PSORXRP2",63,0)
KILL K %,DIR,DUOUT,DTOUT,DIROUT,DIRUT,C,DA,DIC,I,J,JJJ,K,RX,RXF,X,Y,Z,ZD,DFN,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSXSTAT,PSORPRX,PSOMSG D KVA^VADPT Q
"RTN","PSORXRP2",64,0)
 ;
"RTN","PSORXRP2",65,0)
ULR ;
"RTN","PSORXRP2",66,0)
 I $G(PSORPRX) D PSOUL^PSSLOCK(PSORPRX)
"RTN","PSORXRP2",67,0)
 Q
"RTN","PSORXRPT")
0^5^B34192029
"RTN","PSORXRPT",1,0)
PSORXRPT ;BIR/SAB-reprint of a prescription label ;11/8/02
"RTN","PSORXRPT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**3,21,27,34,120**;DEC 1997
"RTN","PSORXRPT",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORXRPT",4,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSORXRPT",5,0)
BCK I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSORXRPT",6,0)
 S PSORPLRX=$P(PSOLST(ORN),"^",2)
"RTN","PSORXRPT",7,0)
 D PSOL^PSSLOCK(PSORPLRX) I '$G(PSOMSG) S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order."),VALMBCK="" K PSOMSG Q
"RTN","PSORXRPT",8,0)
 I $G(POERR) K QFLG D  I $G(QFLG) D ULR G KILL
"RTN","PSORXRPT",9,0)
 .D FULL^VALM1 S X=$P(^PSRX($P(PSOLST(ORN),"^",2),0),"^"),Y=$P(PSOLST(ORN),"^",2)_"^"_X,Y(0)=$G(^PSRX($P(PSOLST(ORN),"^",2),0))
"RTN","PSORXRPT",10,0)
 .I $D(RXPR($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Partial Rx has been requested!",QFLG=1 Q
"RTN","PSORXRPT",11,0)
 .I $D(RXRP($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="A Reprint Label has been requested!",QFLG=1 Q
"RTN","PSORXRPT",12,0)
 .I $D(RXRS($P(PSOLST(ORN),"^",2))) S VALMBCK="",VALMSG="Rx is being pulled from suspense!",QFLG=1 Q
"RTN","PSORXRPT",13,0)
 .S RX=$P(PSOLST(ORN),"^",2) D VALID^PSORXRP1 S:$G(QFLG) VALMBCK="",VALMSG="A New Label has been requested already!"
"RTN","PSORXRPT",14,0)
 S (PPL,DA,RX)=+Y,PDA=Y(0),RXF=0,ZD(DA)=DT,REPRINT=1,STA=+$G(^PSRX(+Y,"STA"))
"RTN","PSORXRPT",15,0)
 I $P(^PSRX(RX,"STA"),"^")=14 S VALMBCK="",VALMSG="Cannot Reprint! Discontinued by Provider.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",16,0)
 I $P(^PSRX(RX,"STA"),"^")=15 S VALMBCK="",VALMSG="Cannot Reprint! Discontinued due to editing.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",17,0)
 I $P(^PSRX(RX,"STA"),"^")=16 S VALMBCK="",VALMSG="Cannot Reprint! Placed on HOLD by Provider.",QFLG=1 D ULR,KILL Q
"RTN","PSORXRPT",18,0)
 I DT>$P(^PSRX(RX,2),"^",6) D  G PAUSE
"RTN","PSORXRPT",19,0)
 .W !,$C(7),"Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) I $P(^PSRX(DA,"STA"),"^")<11 S $P(^PSRX(DA,"STA"),"^")=11 D
"RTN","PSORXRPT",20,0)
 ..S COMM="Medication Expired on "_$E($P(^PSRX(RX,2),"^",6),4,5)_"-"_$E($P(^(2),"^",6),6,7)_"-"_$E($P(^(2),"^",6),2,3) D EN^PSOHLSN1(DA,"SC","ZE",COMM) K COMM
"RTN","PSORXRPT",21,0)
 S DFN=$P(PDA,"^",2) D DEM^VADPT I $P(VADM(6),"^",2)]"" D  G PAUSE
"RTN","PSORXRPT",22,0)
 .W $C(7),!!,$P(^DPT($P(PDA,"^",2),0),"^")_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSORXRPT",23,0)
 .S $P(^PSRX(RX,"STA"),"^")=12,PCOM="Patient Expired "_$P(VADM(6),"^",2),ST="C" D EN^PSOHLSN1(RX,"OD","",PCOM,"A")
"RTN","PSORXRPT",24,0)
 .D ACT1,ULR,KILL
"RTN","PSORXRPT",25,0)
 S X=$O(^PS(52.5,"B",DA,0)) I X,'$G(^PS(52.5,X,"P")) W !,$C(7),"RX MAY NOT BE PRINTED using this option, use SUSPENSE FUNCTIONS Options." K X G PAUSE
"RTN","PSORXRPT",26,0)
 S PSX=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S PSX=J
"RTN","PSORXRPT",27,0)
 K X
"RTN","PSORXRPT",28,0)
 I $D(^PS(52.4,DA)) W !,"Prescription is Non-Verified",!! G PAUSE
"RTN","PSORXRPT",29,0)
 S DFN=$P(^PSRX(DA,0),"^",2) I $D(^PS(52.4,"AREF",DFN,DA)) W !,"Prescription is waiting for others to be verified",!! G PAUSE
"RTN","PSORXRPT",30,0)
 I $G(PSODIV),$D(^PSRX(DA,2)),+$P(^(2),"^",9),+$P(^(2),"^",9)'=PSOSITE S PSPOP=0,PSPRXN=DA D CHK1^PSOUTLA G:$G(POERR)&(PSPOP) PAUSE G:PSPOP PAUSE
"RTN","PSORXRPT",31,0)
 I STA=3 W !?3,"Prescription is on Hold" G PAUSE
"RTN","PSORXRPT",32,0)
 I STA=4 W !?3,"Prescription is Pending Due to Drug Interactions" G PAUSE
"RTN","PSORXRPT",33,0)
 I STA=12 W !?3,"Prescription is Discontinued" G PAUSE
"RTN","PSORXRPT",34,0)
 S COPIES=$S($P(PDA,"^",18)]"":$P(PDA,"^",18),1:1)
"RTN","PSORXRPT",35,0)
 K DIR S DIR("A")="Number of Copies? ",DIR("B")=COPIES,DIR(0)="N^1:99:0",DIR("?")="Enter the number of copies you want (1 to 99)"
"RTN","PSORXRPT",36,0)
 D ^DIR K DIR I $D(DIRUT)!($D(DIROUT)) D ULR G KILL
"RTN","PSORXRPT",37,0)
 S COPIES=X
"RTN","PSORXRPT",38,0)
 K DIR S DIR("A")="Print adhesive portion of label only? ",DIR(0)="SA^Y:YES;N:NO",DIR("B")="N",DIR("?",1)="If entire label, including trailers are to print press RETURN for default."
"RTN","PSORXRPT",39,0)
 S DIR("?")="Else if only bottle and mailing labels are to print enter Y or YES." D ^DIR K DIR I $D(DUOUT) D ULR,KILL G PAUSE
"RTN","PSORXRPT",40,0)
 I $D(DIRUT) D ULR G KILL
"RTN","PSORXRPT",41,0)
 S SIDE=$S(X="Y":1,1:0) D ACT I $D(DIRUT) D ULR,KILL G PAUSE
"RTN","PSORXRPT",42,0)
 Q:$G(POERR)&($D(PCOM))  G PAUSE:$D(PCOM)
"RTN","PSORXRPT",43,0)
 F I=1,2,4,6,7,9,13,16 S P(I)=$P(PDA,"^",I)
"RTN","PSORXRPT",44,0)
 S P(6)=+P(6) I $D(^PSRX(DA,"TN")),^("TN")]"" S P(6)=^("TN")
"RTN","PSORXRPT",45,0)
 W !!,"Rx # "_P(1),?23,$E(P(13),4,5)_"/"_$E(P(13),6,7)_"/"_$E(P(13),2,3),!,$S($D(^DPT(+P(2),0)):$P(^(0),"^"),1:"Not on File"),?30,"#"_P(7),!
"RTN","PSORXRPT",46,0)
 I $P($G(^PSRX(DA,"SIG")),"^",2) S D=0 D  K D,FSIG
"RTN","PSORXRPT",47,0)
 .D FSIG^PSOUTLA("R",DA,75) F  S D=$O(FSIG(D)) W !,FSIG(D) Q:'$O(FSIG(D))
"RTN","PSORXRPT",48,0)
 E  D EN3^PSOUTLA1(DA,75) S D=0 F  S D=$O(BSIG(D)) W !,BSIG(D) Q:'$O(BSIG(D))
"RTN","PSORXRPT",49,0)
 K D,BSIG
"RTN","PSORXRPT",50,0)
 W !!,$S((P(6)=+P(6))&$D(^PSDRUG(P(6),0)):$P(^(0),"^"),1:P(6)),! S PHYS=$S($D(^VA(200,+P(4),0)):$P(^(0),"^"),1:"Unknown") W PHYS K PHYS
"RTN","PSORXRPT",51,0)
 W ?25,$S($D(^VA(200,+P(16),0)):$P(^(0),"^"),1:"Unknown"),!,"# of Refills: "_$G(P(9))
"RTN","PSORXRPT",52,0)
 I $G(RX) S RXFL(RX)=0 F ZZZ=0:0 S ZZZ=$O(^PSRX(RX,1,ZZZ)) Q:'ZZZ  S RXFL(RX)=ZZZ
"RTN","PSORXRPT",53,0)
 K PSOELSE I '$G(POERR) S PSOELSE=1 D @$S($P($G(PSOPAR),"^",26):"^PSORXL",1:"Q^PSORXL")
"RTN","PSORXRPT",54,0)
 I '$G(PSOELSE) D  S RXRP($P(PSOLST(ORN),"^",2))=1_"^"_$G(COPIES)_"^"_$S($G(SIDE):1,1:0)
"RTN","PSORXRPT",55,0)
 .I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=DA_"," Q
"RTN","PSORXRPT",56,0)
 .F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXRPT",57,0)
 .I $L(PSORX("PSOL",PSOX2))+$L(DA)<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_DA_","
"RTN","PSORXRPT",58,0)
 .E  S PSORX("PSOL",PSOX2+1)=DA_","
"RTN","PSORXRPT",59,0)
 K PCOMX,PSPOP,PPL,COPIES,SIDE,PCOM,IOP,PSL,PSNP,PSOELSE,ZZZ
"RTN","PSORXRPT",60,0)
PAUSE K RX,PPL,ZD(+$G(DA)),DA I $G(POERR) K DIR,DIRUT,DUOUT,DTOUT S DIR(0)="E",DIR("A",1)=" ",DIR("A")="Press Return to Continue" D ^DIR K DIR,DIRUT,DUOUT,DTOUT S VALMBCK="R"
"RTN","PSORXRPT",61,0)
 D ULR K PSORPLRX
"RTN","PSORXRPT",62,0)
 Q
"RTN","PSORXRPT",63,0)
 ;
"RTN","PSORXRPT",64,0)
ACT K DIR S DIR("A")="Comments: ",DIR(0)="FA^5:60",DIR("?")="5-60 characters input required for activity log." S:$G(PCOMX)]"" DIR("B")=$G(PCOMX)
"RTN","PSORXRPT",65,0)
 D ^DIR K DIR Q:$D(DIRUT)!($D(DIROUT))  S (PCOM,PCOMX)=X
"RTN","PSORXRPT",66,0)
 I '$D(PSOCLC) S PSOCLC=DUZ
"RTN","PSORXRPT",67,0)
ACT1 S RXF=0 F J=0:0 S J=$O(^PSRX(DA,1,J)) Q:'J  S RXF=J S:J>5 RXF=J+1
"RTN","PSORXRPT",68,0)
 S IR=0 F J=0:0 S J=$O(^PSRX(DA,"A",J)) Q:'J  S IR=J
"RTN","PSORXRPT",69,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXRPT",70,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^"_$S($G(ST)'="C":"W",1:"C")_"^"_DUZ_"^"_RXF_"^"_PCOM_$S($G(ST)'="C":" ("_COPIES_" COPIES)",1:""),PCOMX=PCOM K PC,IR,PS,PCOM,XX,%,%H,%I,RXF
"RTN","PSORXRPT",71,0)
 S:$P(^PSRX(DA,2),"^",15)&($G(ST)'="C") $P(^PSRX(DA,2),"^",14)=1
"RTN","PSORXRPT",72,0)
 Q
"RTN","PSORXRPT",73,0)
 ;
"RTN","PSORXRPT",74,0)
KILL K QFLG,%,DIR,DUOUT,DTOUT,DIROUT,DIRUT,PCOM,PCOMX,C,DA,DIC,I,J,JJJ,K,RX,RXF,X,Y,Z,DFN,P,PDA,PSPRXN,COPIES,SIDE,PPL,REPRINT,PSOMSG,PSORPLRX D KVA^VADPT Q
"RTN","PSORXRPT",75,0)
 ;
"RTN","PSORXRPT",76,0)
ULR ;
"RTN","PSORXRPT",77,0)
 I $G(PSORPLRX) D PSOUL^PSSLOCK(PSORPLRX)
"RTN","PSORXRPT",78,0)
 Q
"VER")
8.0^22.0
**END**
**END**
