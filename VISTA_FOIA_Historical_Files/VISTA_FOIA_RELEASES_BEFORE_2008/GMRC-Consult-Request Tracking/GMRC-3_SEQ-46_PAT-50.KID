Released GMRC*3*50 SEQ #46
Extracted from mail message
**KIDS**:GMRC*3.0*50^

**INSTALL NAME**
GMRC*3.0*50
"BLD",6615,0)
GMRC*3.0*50^CONSULT/REQUEST TRACKING^0^3061121^y
"BLD",6615,1,0)
^^7^7^3061016^
"BLD",6615,1,1,0)
This patch corrects group updating to store the appropriate Last Action 
"BLD",6615,1,2,0)
Taken and to update Inter-Facility Consults at the partnering facility.  
"BLD",6615,1,3,0)
It also removes an inappropriate time zone stamp in the display of Consult
"BLD",6615,1,4,0)
activities and prevents Services set-up as Inter-Facility from being 
"BLD",6615,1,5,0)
added as a Related Service to a Consult Procedure.  This patch also 
"BLD",6615,1,6,0)
provides a list of consults which have the Significant Finding stored as 
"BLD",6615,1,7,0)
an ampersand.
"BLD",6615,4,0)
^9.64PA^123.3^1
"BLD",6615,4,123.3,0)
123.3
"BLD",6615,4,123.3,2,0)
^9.641^123.32^1
"BLD",6615,4,123.3,2,123.32,0)
RELATED SERVICES  (sub-file)
"BLD",6615,4,123.3,2,123.32,1,0)
^9.6411^.01^1
"BLD",6615,4,123.3,2,123.32,1,.01,0)
RELATED SERVICES
"BLD",6615,4,123.3,222)
y^n^p^^^^n^^n
"BLD",6615,4,123.3,224)

"BLD",6615,4,"APDD",123.3,123.32)

"BLD",6615,4,"APDD",123.3,123.32,.01)

"BLD",6615,4,"B",123.3,123.3)

"BLD",6615,6.3)
8
"BLD",6615,"INI")
PRE^GMRCP50
"BLD",6615,"INID")
^n^n
"BLD",6615,"INIT")
POST^GMRCYP50
"BLD",6615,"KRN",0)
^9.67PA^8989.52^19
"BLD",6615,"KRN",.4,0)
.4
"BLD",6615,"KRN",.401,0)
.401
"BLD",6615,"KRN",.402,0)
.402
"BLD",6615,"KRN",.403,0)
.403
"BLD",6615,"KRN",.5,0)
.5
"BLD",6615,"KRN",.84,0)
.84
"BLD",6615,"KRN",3.6,0)
3.6
"BLD",6615,"KRN",3.8,0)
3.8
"BLD",6615,"KRN",9.2,0)
9.2
"BLD",6615,"KRN",9.8,0)
9.8
"BLD",6615,"KRN",9.8,"NM",0)
^9.68A^8^5
"BLD",6615,"KRN",9.8,"NM",4,0)
GMRCP50^^0^B19728840
"BLD",6615,"KRN",9.8,"NM",5,0)
GMRCP50A^^0^B63790900
"BLD",6615,"KRN",9.8,"NM",6,0)
GMRCSLM4^^0^B36237040
"BLD",6615,"KRN",9.8,"NM",7,0)
GMRCSTS1^^0^B31373636
"BLD",6615,"KRN",9.8,"NM",8,0)
GMRCYP50^^0^B31546211
"BLD",6615,"KRN",9.8,"NM","B","GMRCP50",4)

"BLD",6615,"KRN",9.8,"NM","B","GMRCP50A",5)

"BLD",6615,"KRN",9.8,"NM","B","GMRCSLM4",6)

"BLD",6615,"KRN",9.8,"NM","B","GMRCSTS1",7)

"BLD",6615,"KRN",9.8,"NM","B","GMRCYP50",8)

"BLD",6615,"KRN",19,0)
19
"BLD",6615,"KRN",19.1,0)
19.1
"BLD",6615,"KRN",101,0)
101
"BLD",6615,"KRN",409.61,0)
409.61
"BLD",6615,"KRN",771,0)
771
"BLD",6615,"KRN",870,0)
870
"BLD",6615,"KRN",8989.51,0)
8989.51
"BLD",6615,"KRN",8989.52,0)
8989.52
"BLD",6615,"KRN",8994,0)
8994
"BLD",6615,"KRN","B",.4,.4)

"BLD",6615,"KRN","B",.401,.401)

"BLD",6615,"KRN","B",.402,.402)

"BLD",6615,"KRN","B",.403,.403)

"BLD",6615,"KRN","B",.5,.5)

"BLD",6615,"KRN","B",.84,.84)

"BLD",6615,"KRN","B",3.6,3.6)

"BLD",6615,"KRN","B",3.8,3.8)

"BLD",6615,"KRN","B",9.2,9.2)

"BLD",6615,"KRN","B",9.8,9.8)

"BLD",6615,"KRN","B",19,19)

"BLD",6615,"KRN","B",19.1,19.1)

"BLD",6615,"KRN","B",101,101)

"BLD",6615,"KRN","B",409.61,409.61)

"BLD",6615,"KRN","B",771,771)

"BLD",6615,"KRN","B",870,870)

"BLD",6615,"KRN","B",8989.51,8989.51)

"BLD",6615,"KRN","B",8989.52,8989.52)

"BLD",6615,"KRN","B",8994,8994)

"BLD",6615,"QUES",0)
^9.62^1^1
"BLD",6615,"QUES",1,0)
PRE1
"BLD",6615,"QUES",1,1)
YO
"BLD",6615,"QUES",1,"A")
Print Full Patient Names on pre-install report
"BLD",6615,"QUES",1,"B")
YES
"BLD",6615,"QUES",1,"Q")
Answer 'NO' to print patients' initials and last 6 of SSN.
"BLD",6615,"QUES",1,"Q1",0)
^^1^1^3061114^
"BLD",6615,"QUES",1,"Q1",1,0)
Answer 'YES' to print patients' full name and last 4 of SSN.
"BLD",6615,"QUES","B","PRE1",1)

"BLD",6615,"REQB",0)
^9.611^3^3
"BLD",6615,"REQB",1,0)
GMRC*3.0*21^1
"BLD",6615,"REQB",2,0)
GMRC*3.0*22^1
"BLD",6615,"REQB",3,0)
OR*3.0*215^1
"BLD",6615,"REQB","B","GMRC*3.0*21",1)

"BLD",6615,"REQB","B","GMRC*3.0*22",2)

"BLD",6615,"REQB","B","OR*3.0*215",3)

"FIA",123.3)
GMRC PROCEDURE
"FIA",123.3,0)
^GMR(123.3,
"FIA",123.3,0,0)
123.3O
"FIA",123.3,0,1)
y^n^p^^^^n^^n
"FIA",123.3,0,10)

"FIA",123.3,0,11)

"FIA",123.3,0,"RLRO")

"FIA",123.3,0,"VR")
3.0^GMRC
"FIA",123.3,123.3)
1
"FIA",123.3,123.3,2)

"FIA",123.3,123.32)
1
"FIA",123.3,123.32,.01)

"INI")
PRE^GMRCP50
"INIT")
POST^GMRCYP50
"MBREQ")
0
"PKG",222,-1)
1^1
"PKG",222,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",222,22,0)
^9.49I^1^1
"PKG",222,22,1,0)
3.0^2980101^2990325^66481
"PKG",222,22,1,"PAH",1,0)
50^3061121^12463
"PKG",222,22,1,"PAH",1,1,0)
^^7^7^3061121
"PKG",222,22,1,"PAH",1,1,1,0)
This patch corrects group updating to store the appropriate Last Action 
"PKG",222,22,1,"PAH",1,1,2,0)
Taken and to update Inter-Facility Consults at the partnering facility.  
"PKG",222,22,1,"PAH",1,1,3,0)
It also removes an inappropriate time zone stamp in the display of Consult
"PKG",222,22,1,"PAH",1,1,4,0)
activities and prevents Services set-up as Inter-Facility from being 
"PKG",222,22,1,"PAH",1,1,5,0)
added as a Related Service to a Consult Procedure.  This patch also 
"PKG",222,22,1,"PAH",1,1,6,0)
provides a list of consults which have the Significant Finding stored as 
"PKG",222,22,1,"PAH",1,1,7,0)
an ampersand.
"QUES","PRE1",0)
YO
"QUES","PRE1","?")
Answer 'NO' to print patients' initials and last 6 of SSN.
"QUES","PRE1","?",1)
Answer 'YES' to print patients' full name and last 4 of SSN.
"QUES","PRE1","A")
Print Full Patient Names on pre-install report
"QUES","PRE1","B")
YES
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","GMRCP50")
0^4^B19728840^n/a
"RTN","GMRCP50",1,0)
GMRCP50 ;ISP/TDP - PRE INSTALL FOR GMRC*3*50 ; 11/29/2005
"RTN","GMRCP50",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**50**;DEC 27, 1997;Build 8
"RTN","GMRCP50",3,0)
 Q
"RTN","GMRCP50",4,0)
EN ;Entry point for manual start from programmer's prompt
"RTN","GMRCP50",5,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,NMFLG,X,Y
"RTN","GMRCP50",6,0)
 S DIR(0)="Y"
"RTN","GMRCP50",7,0)
 S DIR("A")="Print Full Patient Names on pre-install report"
"RTN","GMRCP50",8,0)
 S DIR("B")="YES"
"RTN","GMRCP50",9,0)
 S DIR("?")="Answer 'NO' to print patients' initials and last 6 of SSN."
"RTN","GMRCP50",10,0)
 S DIR("?",1)="Answer 'YES' to print patients' full name and last 4 of SSN."
"RTN","GMRCP50",11,0)
 D ^DIR I (($G(DIROUT))!($G(DIRUT))!($G(DUOUT))!($G(DTOUT))) Q
"RTN","GMRCP50",12,0)
 S NMFLG=Y
"RTN","GMRCP50",13,0)
PRE ;Start of Pre-init of patch GMRC*3*50
"RTN","GMRCP50",14,0)
 N GMRCTTL,GMRCITL
"RTN","GMRCP50",15,0)
 K ^TMP("GMRCP50",$J),^TMP("GMRCP50 IFC",$J)
"RTN","GMRCP50",16,0)
 I '$D(NMFLG) N NMFLG D
"RTN","GMRCP50",17,0)
 . S NMFLG=$O(XPDQUES(""))
"RTN","GMRCP50",18,0)
 . S NMFLG=$G(XPDQUES(NMFLG))
"RTN","GMRCP50",19,0)
 D BMES^XPDUTL("Starting Pre-init...")
"RTN","GMRCP50",20,0)
 D BMES^XPDUTL("   Searching for ampersand (""&"") in the SIGNIFICANT FINDINGS (#15) field")
"RTN","GMRCP50",21,0)
 D MES^XPDUTL("   of the REQUEST/CONSULTATION (#123) file.")
"RTN","GMRCP50",22,0)
 D MES^XPDUTL(" ")
"RTN","GMRCP50",23,0)
 D SEARCH
"RTN","GMRCP50",24,0)
 I GMRCTTL!(GMRCITL) D MSG^GMRCP50A
"RTN","GMRCP50",25,0)
 D BMES^XPDUTL("Pre-init complete.")
"RTN","GMRCP50",26,0)
 Q
"RTN","GMRCP50",27,0)
SEARCH ;Search SIGNIFICANT FINDINGS (#15) field of the REQUEST/CONSULTATION
"RTN","GMRCP50",28,0)
 ;(#123) file for ampersand ("&").
"RTN","GMRCP50",29,0)
 N GMRC0,GMRC40,GMRCACT,GMRCACDT,GMRCADT,GMRCAIEN,GMRCCIEN,GMRCCOM
"RTN","GMRCP50",30,0)
 N GMRCCPRS,GMRCDFN,GMRCDFN1,GMRCDONE,GMRCDT,GMRCIEN,GMRCIFC,GMRCSVC
"RTN","GMRCP50",31,0)
 N GMRCSSN,GMRCSSN1,GMRCWHO
"RTN","GMRCP50",32,0)
 S (GMRCDT,GMRCITL,GMRCTTL)=0
"RTN","GMRCP50",33,0)
 F  S GMRCDT=$O(^GMR(123,"B",GMRCDT)) Q:GMRCDT=""  D
"RTN","GMRCP50",34,0)
 . S GMRCIEN=""
"RTN","GMRCP50",35,0)
 . F  S GMRCIEN=$O(^GMR(123,"B",GMRCDT,GMRCIEN)) Q:GMRCIEN=""  D
"RTN","GMRCP50",36,0)
 .. S GMRCDONE=0
"RTN","GMRCP50",37,0)
 .. S GMRC0=$G(^GMR(123,GMRCIEN,0)) I $P(GMRC0,U,19)'="&" Q
"RTN","GMRCP50",38,0)
 .. S GMRCIFC="GMRCP50"
"RTN","GMRCP50",39,0)
 .. I $P($G(^GMR(123,GMRCIEN,12)),U,5)="P" S GMRCIFC="GMRCP50 IFC"
"RTN","GMRCP50",40,0)
 .. S GMRCDFN=+$P(GMRC0,U,2) S:GMRCDFN GMRCSSN=$P($G(^DPT(GMRCDFN,0)),U,9),GMRCDFN=$P($G(^DPT(GMRCDFN,0)),U,1)
"RTN","GMRCP50",41,0)
 .. S GMRCSSN1="("_$E(GMRCDFN,1)_$E(GMRCSSN,6,9)_")"
"RTN","GMRCP50",42,0)
 .. S GMRCDFN1=GMRCDFN
"RTN","GMRCP50",43,0)
 .. I (GMRCDFN=0)!(GMRCDFN="") S GMRCDFN="PATIENT UNKNOWN"
"RTN","GMRCP50",44,0)
 .. S GMRCDFN=GMRCDFN_" "_GMRCSSN1
"RTN","GMRCP50",45,0)
 .. S GMRCSVC=+$P(GMRC0,U,5) S:GMRCSVC GMRCSVC=$P($G(^GMR(123.5,GMRCSVC,0)),U,1)
"RTN","GMRCP50",46,0)
 .. I (GMRCSVC=0)!(GMRCSVC="") S GMRCSVC="SERVICE UNKNOWN"
"RTN","GMRCP50",47,0)
 .. S GMRCCPRS=+$P(GMRC0,U,12) S:GMRCCPRS GMRCCPRS=$P($G(^ORD(100.01,GMRCCPRS,0)),U,1)
"RTN","GMRCP50",48,0)
 .. I (GMRCCPRS=0)!(GMRCCPRS="") S GMRCCPRS="STATUS UNKNOWN"
"RTN","GMRCP50",49,0)
 .. D ACTIVITY
"RTN","GMRCP50",50,0)
 .. S ^TMP(GMRCIFC,$J,GMRCDFN,GMRCDT,GMRCIEN,0)=GMRCIEN_U_GMRCSVC_U_GMRCCPRS_U_GMRCACT_U_GMRCACDT_U_GMRCWHO
"RTN","GMRCP50",51,0)
 .. I 'NMFLG D
"RTN","GMRCP50",52,0)
 ... S ^TMP(GMRCIFC,$J,GMRCDFN,0)="("_$E($P(GMRCDFN1,",",2),1)_$E($P($P(GMRCDFN1,",",2)," ",2),1)_$E(GMRCDFN1,1)_$E(GMRCSSN,4,9)_")"
"RTN","GMRCP50",53,0)
 .. W !,"   Consult entry "_GMRCIEN_" has an ampersand (""&"") as the Significant Finding."
"RTN","GMRCP50",54,0)
 .. S GMRCTTL=GMRCTTL+1
"RTN","GMRCP50",55,0)
 .. I GMRCIFC="GMRCP50 IFC" S GMRCITL=GMRCITL+1
"RTN","GMRCP50",56,0)
 D MES^XPDUTL(" ")
"RTN","GMRCP50",57,0)
 D BMES^XPDUTL(GMRCTTL_" total consults contain an ampersand as the Significant Finding.")
"RTN","GMRCP50",58,0)
 Q
"RTN","GMRCP50",59,0)
ACTIVITY ;Search thru all Request Processing Activities and return any
"RTN","GMRCP50",60,0)
 ;Significant Findings or Administrative Completions.
"RTN","GMRCP50",61,0)
 N GMRCSIG,GMRCFLG
"RTN","GMRCP50",62,0)
 S GMRCSIG=$O(^GMR(123.1,"B","SIG FINDING UPDATE",""))
"RTN","GMRCP50",63,0)
 S GMRCFLG=0
"RTN","GMRCP50",64,0)
ACT1 S (GMRCACDT,GMRCACT,GMRCADT,GMRCWHO)=""
"RTN","GMRCP50",65,0)
 F  S GMRCADT=$O(^GMR(123,GMRCIEN,40,"B",GMRCADT),-1) Q:GMRCADT=""  D  Q:GMRCDONE
"RTN","GMRCP50",66,0)
 . S GMRCAIEN=""
"RTN","GMRCP50",67,0)
 . F  S GMRCAIEN=$O(^GMR(123,GMRCIEN,40,"B",GMRCADT,GMRCAIEN)) Q:GMRCAIEN=""  D  Q:GMRCDONE
"RTN","GMRCP50",68,0)
 .. S GMRC40=$G(^GMR(123,GMRCIEN,40,GMRCAIEN,0)) I $P(GMRC40,U,2)'=GMRCSIG Q
"RTN","GMRCP50",69,0)
 .. S GMRCACT=+$P(GMRC40,U,2) S:GMRCACT GMRCACT=$P($G(^GMR(123.1,GMRCACT,0)),U,1)
"RTN","GMRCP50",70,0)
 .. I (GMRCACT=0)!(GMRCACT="") S GMRCACT="ACTIVITY UNKNOWN"
"RTN","GMRCP50",71,0)
 .. S GMRCACDT=+$P(GMRC40,U,3)
"RTN","GMRCP50",72,0)
 .. S GMRCWHO=+$P(GMRC40,U,4) S:'GMRCWHO GMRCWHO=+$P(GMRC40,U,5)
"RTN","GMRCP50",73,0)
 .. I 'GMRCWHO S GMRCWHO=$P($G(^GMR(123,GMRCIEN,40,GMRCAIEN,2)),U,2) S:'GMRCWHO GMRCWHO=$P($G(^GMR(123,GMRCIEN,40,GMRCAIEN,2)),U,1)
"RTN","GMRCP50",74,0)
 .. S:+GMRCWHO GMRCWHO=$P($G(^VA(200,GMRCWHO,0)),U,1)
"RTN","GMRCP50",75,0)
 .. I (GMRCWHO=0)!(GMRCWHO="") S GMRCWHO="RESP. PERSON UNKNOWN"
"RTN","GMRCP50",76,0)
 .. D COMMENT
"RTN","GMRCP50",77,0)
 .. S GMRCDONE=1
"RTN","GMRCP50",78,0)
 I 'GMRCDONE,'GMRCFLG S GMRCSIG=$O(^GMR(123.1,"B","COMPLETE/UPDATE","")),GMRCFLG=1 D ACT1
"RTN","GMRCP50",79,0)
 Q
"RTN","GMRCP50",80,0)
COMMENT ;Gather comment for Activity
"RTN","GMRCP50",81,0)
 I '$D(^GMR(123,GMRCIEN,40,GMRCAIEN,1,0)) Q
"RTN","GMRCP50",82,0)
 S GMRCCIEN=0
"RTN","GMRCP50",83,0)
 F  S GMRCCIEN=$O(^GMR(123,GMRCIEN,40,GMRCAIEN,1,GMRCCIEN)) Q:GMRCCIEN=""  D
"RTN","GMRCP50",84,0)
 . S GMRCCOM=$G(^GMR(123,GMRCIEN,40,GMRCAIEN,1,GMRCCIEN,0))
"RTN","GMRCP50",85,0)
 . I GMRCCOM="" S GMRCCOM="NO COMMENT AVAILABLE"
"RTN","GMRCP50",86,0)
 . S ^TMP(GMRCIFC,$J,GMRCDFN,GMRCDT,GMRCIEN,GMRCCIEN)=GMRCCOM
"RTN","GMRCP50",87,0)
 Q
"RTN","GMRCP50A")
0^5^B63790900^n/a
"RTN","GMRCP50A",1,0)
GMRCP50A ;ISP/TDP - PRE INSTALL ROUTINE FOR GMRC*3*50 ; 11/15/2006
"RTN","GMRCP50A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**50**;DEC 27, 1997;Build 8
"RTN","GMRCP50A",3,0)
 Q
"RTN","GMRCP50A",4,0)
MSG ;Send Mailman message to installer
"RTN","GMRCP50A",5,0)
 N GMRC0,GMRCACT,GMRCADT,GMRCC,GMRCCIEN,GMRCCNT,GMRCCPRS,GMRCDFN,GMRCDT
"RTN","GMRCP50A",6,0)
 N GMRCFDT,GMRCID,GMRCIEN,GMRCIFC,GMRCMSG,GMRCPARM,GMRCPG,GMRCPRV,GMRCSPC
"RTN","GMRCP50A",7,0)
 N GMRCSVC,GMRCTPG,GMRCTXT,GMRCWHO,XMDUZ,XMERR,XMSUB,XMTEXT,XMY,Y
"RTN","GMRCP50A",8,0)
 S GMRCTTL=GMRCTTL-GMRCITL
"RTN","GMRCP50A",9,0)
 I DUZ="" N DUZ S DUZ=.5
"RTN","GMRCP50A",10,0)
 S XMDUZ=DUZ,XMTEXT="GMRCTXT"
"RTN","GMRCP50A",11,0)
 S GMRCPARM("FROM")="PATCH GMRC*3.0*50 PRE-INIT"
"RTN","GMRCP50A",12,0)
 S XMY(DUZ)=""
"RTN","GMRCP50A",13,0)
 S GMRCDFN=""
"RTN","GMRCP50A",14,0)
 F GMRCIFC="GMRCP50","GMRCP50 IFC" D
"RTN","GMRCP50A",15,0)
 . S GMRCPG=0
"RTN","GMRCP50A",16,0)
 . I GMRCIFC="GMRCP50" S GMRCTPG=GMRCTTL/500 I GMRCTPG#1 S GMRCTPG=$P(GMRCTPG,".")+1
"RTN","GMRCP50A",17,0)
 . I GMRCIFC="GMRCP50 IFC" S GMRCTPG=GMRCITL/500 I GMRCTPG#1 S GMRCTPG=$P(GMRCTPG,".")+1
"RTN","GMRCP50A",18,0)
 . F GMRCPG=1:1:GMRCTPG D
"RTN","GMRCP50A",19,0)
 .. K GMRCTXT
"RTN","GMRCP50A",20,0)
 .. S GMRCC=0
"RTN","GMRCP50A",21,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="This message ("_GMRCPG_" of "_GMRCTPG_") has been sent by patch GMRC*3.0*50 at the"
"RTN","GMRCP50A",22,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="completion of the pre-init routine."
"RTN","GMRCP50A",23,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCP50A",24,0)
 .. I GMRCIFC="GMRCP50" D
"RTN","GMRCP50A",25,0)
 ... S XMSUB="SIGNIFICANT FINDINGS VALUES ARE INVALID (MSG "_GMRCPG_" of "_GMRCTPG_")"
"RTN","GMRCP50A",26,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="This message was sent because Consult records were found which contained an"
"RTN","GMRCP50A",27,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Ampersand as the Significant Finding.  Since these can not be corrected"
"RTN","GMRCP50A",28,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="automatically, this message was created to assist in a manual correction of"
"RTN","GMRCP50A",29,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="this data.  We are hopeful that the following data will contain enough"
"RTN","GMRCP50A",30,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="information to allow your site to make the corrections, or at least give you"
"RTN","GMRCP50A",31,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="the information needed to research the specific consult and determine what"
"RTN","GMRCP50A",32,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="the Significant Finding should have been.  It is important to understand the"
"RTN","GMRCP50A",33,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="comments from the Significant Finding are fine and the only problem"
"RTN","GMRCP50A",34,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="needing correction is the Significant Finding value itself (Yes/No/Unknown)."
"RTN","GMRCP50A",35,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Per guidance from HIMSS, it is preferable that an audit trail exist for this"
"RTN","GMRCP50A",36,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="fix.  A disclaimer should be added, if possible.  To correct the"
"RTN","GMRCP50A",37,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Significant Finding, you can use the Action, Consult Tracking menu on the"
"RTN","GMRCP50A",38,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Consults tab of CPRS GUI.  The person making this change will need the"
"RTN","GMRCP50A",39,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="appropriate update authority for the Consult Services involved.  It should"
"RTN","GMRCP50A",40,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="also be noted the significant finding will display as ""Unknown"" despite"
"RTN","GMRCP50A",41,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="the ampersand (""&"") stored in the data file."
"RTN","GMRCP50A",42,0)
 .. I GMRCIFC="GMRCP50 IFC" D
"RTN","GMRCP50A",43,0)
 ... S XMSUB="IFC SIGNIFICANT FINDINGS VALUES ARE INVALID (MSG "_GMRCPG_" of "_GMRCTPG_")"
"RTN","GMRCP50A",44,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="This message was sent because Inter-Facility Consult records were found"
"RTN","GMRCP50A",45,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="which contained an Ampersand as the Significant Finding.  Since these can"
"RTN","GMRCP50A",46,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="not be corrected by the requesting (sending) site, this message was created"
"RTN","GMRCP50A",47,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="to alert you of these entries.  The Consulting (receiving) site(s) will need"
"RTN","GMRCP50A",48,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="to correct these entries and should receive a similar message when they"
"RTN","GMRCP50A",49,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="install this patch.  You can use this list as a record of Inter-Facility"
"RTN","GMRCP50A",50,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Consults needing to be corrected by the Consulting (receiving) site(s)."
"RTN","GMRCP50A",51,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCP50A",52,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="PATIENT IDENTIFIER"
"RTN","GMRCP50A",53,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  CONSULT DATE(IEN)"
"RTN","GMRCP50A",54,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  TO SERVICE                                                   STATUS"
"RTN","GMRCP50A",55,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="    ACTIVITY            ACTIVITY DATE          RESPONSIBLE PERSON"
"RTN","GMRCP50A",56,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="    ACTIVITY COMMENTS"
"RTN","GMRCP50A",57,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="==============================================================================="
"RTN","GMRCP50A",58,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCP50A",59,0)
 .. S GMRCSPC="                                                            "
"RTN","GMRCP50A",60,0)
 .. S GMRCCNT=0
"RTN","GMRCP50A",61,0)
 .. F  S GMRCDFN=$O(^TMP(GMRCIFC,$J,GMRCDFN)) Q:GMRCDFN=""  D  Q:GMRCCNT>499
"RTN","GMRCP50A",62,0)
 ... S GMRCID=$S(NMFLG:GMRCDFN,1:$G(^TMP(GMRCIFC,$J,GMRCDFN,0)))
"RTN","GMRCP50A",63,0)
 ... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=GMRCID
"RTN","GMRCP50A",64,0)
 ... S GMRCDT=0
"RTN","GMRCP50A",65,0)
 ... F  S GMRCDT=$O(^TMP(GMRCIFC,$J,GMRCDFN,GMRCDT)) Q:GMRCDT=""  D
"RTN","GMRCP50A",66,0)
 .... S GMRCIEN=0
"RTN","GMRCP50A",67,0)
 .... F  S GMRCIEN=$O(^TMP(GMRCIFC,$J,GMRCDFN,GMRCDT,GMRCIEN)) Q:GMRCIEN=""  D
"RTN","GMRCP50A",68,0)
 ..... S GMRCCIEN=0
"RTN","GMRCP50A",69,0)
 ..... S GMRC0=$G(^TMP(GMRCIFC,$J,GMRCDFN,GMRCDT,GMRCIEN,0))
"RTN","GMRCP50A",70,0)
 ..... ;S GMRCIEN=$P(GMRC0,U,1)
"RTN","GMRCP50A",71,0)
 ..... S Y=GMRCDT
"RTN","GMRCP50A",72,0)
 ..... D DD^%DT
"RTN","GMRCP50A",73,0)
 ..... I Y=-1 S Y="DATE ERROR"
"RTN","GMRCP50A",74,0)
 ..... S GMRCFDT=Y
"RTN","GMRCP50A",75,0)
 ..... S GMRCFDT=$E(GMRCFDT_" ("_GMRCIEN_")"_GMRCSPC,1,33)
"RTN","GMRCP50A",76,0)
 ..... S GMRCSVC=$E($P(GMRC0,U,2)_GMRCSPC,1,60)_" "
"RTN","GMRCP50A",77,0)
 ..... S GMRCCPRS=$E($P(GMRC0,U,3)_GMRCSPC,1,15)
"RTN","GMRCP50A",78,0)
 ..... S GMRCACT=$E($P(GMRC0,U,4)_GMRCSPC,1,20)
"RTN","GMRCP50A",79,0)
 ..... S GMRCADT=$P(GMRC0,U,5)
"RTN","GMRCP50A",80,0)
 ..... S Y=0
"RTN","GMRCP50A",81,0)
 ..... I GMRCADT S Y=GMRCADT D DD^%DT I Y=-1 S Y="DATE ERROR"
"RTN","GMRCP50A",82,0)
 ..... I 'GMRCADT S Y="ACTIVITY DATE UNK"
"RTN","GMRCP50A",83,0)
 ..... S GMRCADT=$E(Y_GMRCSPC,1,23)
"RTN","GMRCP50A",84,0)
 ..... S GMRCWHO=$E($P(GMRC0,U,6)_GMRCSPC,1,32)
"RTN","GMRCP50A",85,0)
 ..... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "_GMRCFDT
"RTN","GMRCP50A",86,0)
 ..... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "_GMRCSVC_GMRCCPRS
"RTN","GMRCP50A",87,0)
 ..... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="    "_GMRCACT_GMRCADT_GMRCWHO
"RTN","GMRCP50A",88,0)
 ..... F  S GMRCCIEN=$O(^TMP(GMRCIFC,$J,GMRCDFN,GMRCDT,GMRCIEN,GMRCCIEN)) Q:GMRCCIEN=""  D
"RTN","GMRCP50A",89,0)
 ...... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="    "_$G(^TMP(GMRCIFC,$J,GMRCDFN,GMRCDT,GMRCIEN,GMRCCIEN))
"RTN","GMRCP50A",90,0)
 ..... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCP50A",91,0)
 ..... S GMRCCNT=GMRCCNT+1
"RTN","GMRCP50A",92,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCP50A",93,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCP50A",94,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Total records in this message: "_GMRCCNT
"RTN","GMRCP50A",95,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Total records containing a Significant Finding of an ampersand: "_$S(GMRCIFC="GMRCP50":GMRCTTL,1:GMRCITL)
"RTN","GMRCP50A",96,0)
 .. D SENDMSG^XMXAPI(XMDUZ,XMSUB,XMTEXT,.XMY,.GMRCPARM,"","")
"RTN","GMRCP50A",97,0)
 .. S GMRCMSG(1)=" "
"RTN","GMRCP50A",98,0)
 .. S GMRCMSG(2)="******************************************************************************"
"RTN","GMRCP50A",99,0)
 .. I GMRCIFC="GMRCP50" D
"RTN","GMRCP50A",100,0)
 ... S GMRCMSG(3)="** Message ("_$S($L(GMRCPG)=1:$J("0"_GMRCPG,2),1:GMRCPG)_" of "_$S($L(GMRCTPG)=1:$J("0"_GMRCTPG,2),1:GMRCTPG)_") containing Consult records which have an ampersand as **"
"RTN","GMRCP50A",101,0)
 ... S GMRCMSG(4)="** the Significant Finding was "_$S($D(XMERR):"not sent due to an error in the message      **",1:"sent to the "_$S(DUZ=.5:"postmaster.  Please forward this **",1:"user.  Please forward this       **"))
"RTN","GMRCP50A",102,0)
 ... I $D(XMERR) S GMRCMSG(5)="** setup.                                                                   **"
"RTN","GMRCP50A",103,0)
 ... I $D(XMERR) S GMRCMSG(6)="** Dumping message to screen.                                               **"
"RTN","GMRCP50A",104,0)
 ... I '$D(XMERR) S GMRCMSG(5)="** message to the appropriate staff, which includes the clinical            **"
"RTN","GMRCP50A",105,0)
 ... I '$D(XMERR) S GMRCMSG(6)="** coordinator, for further action.                                         **"
"RTN","GMRCP50A",106,0)
 .. I GMRCIFC="GMRCP50 IFC" D
"RTN","GMRCP50A",107,0)
 ... S GMRCMSG(3)="** Message ("_$S($L(GMRCPG)=1:$J("0"_GMRCPG,2),1:GMRCPG)_" of "_$S($L(GMRCTPG)=1:$J("0"_GMRCTPG,2),1:GMRCTPG)_") containing Inter-Facility Consult records which have  **"
"RTN","GMRCP50A",108,0)
 ... S GMRCMSG(4)="** an ampersand as the Significant Finding was "_$S($D(XMERR):"not sent due to an error in  **",1:"sent to the "_$S(DUZ=.5:"postmaster.      **",1:"user.            **"))
"RTN","GMRCP50A",109,0)
 ... I $D(XMERR) S GMRCMSG(5)="** the message setup.                                                       **"
"RTN","GMRCP50A",110,0)
 ... I $D(XMERR) S GMRCMSG(6)="** Dumping message to screen.                                               **"
"RTN","GMRCP50A",111,0)
 ... I '$D(XMERR) S GMRCMSG(5)="** Please forward this message to the appropriate staff, which includes the **"
"RTN","GMRCP50A",112,0)
 ... I '$D(XMERR) S GMRCMSG(6)="** clinical coordinator, for further action.                                **"
"RTN","GMRCP50A",113,0)
 .. S GMRCMSG(7)="******************************************************************************"
"RTN","GMRCP50A",114,0)
 .. D BMES^XPDUTL(.GMRCMSG)
"RTN","GMRCP50A",115,0)
 .. I $D(XMERR) D BMES^XPDUTL("  "),BMES^XPDUTL(.GMRCTXT)
"RTN","GMRCP50A",116,0)
 . K ^TMP(GMRCIFC,$J)
"RTN","GMRCP50A",117,0)
 Q
"RTN","GMRCSLM4")
0^6^B36237040^B35674872
"RTN","GMRCSLM4",1,0)
GMRCSLM4 ;SLC/DCM - List Manager routine - Activity Log Detailed Display ;1/28/99 10:30
"RTN","GMRCSLM4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,15,22,50**;DEC 27,1997;Build 8
"RTN","GMRCSLM4",3,0)
 ;
"RTN","GMRCSLM4",4,0)
 ; This routine invokes IA #3138
"RTN","GMRCSLM4",5,0)
 ;
"RTN","GMRCSLM4",6,0)
ACTLOG(GMRCO) ;Print activity log
"RTN","GMRCSLM4",7,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",8,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Facility",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",9,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=" Activity"_$E(TAB,1,16)_"Date/Time/Zone"_$E(TAB,1,6)_"Responsible Person"_$E(TAB,1,2)_"Entered By",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",10,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$$REPEAT^XLFSTR("-",79),GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",11,0)
 N GMRCD,GMRCDA
"RTN","GMRCSLM4",12,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDA="" F  S GMRCDA=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDA)) Q:'GMRCDA  D BLDALN(GMRCO,GMRCDA)
"RTN","GMRCSLM4",13,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",14,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="Note: TIME ZONE is local if not indicated",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",15,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",16,0)
 Q
"RTN","GMRCSLM4",17,0)
 ;
"RTN","GMRCSLM4",18,0)
BLDALN(GMRCO,GMRCDA) ;Build Activity Log Lines for an activity
"RTN","GMRCSLM4",19,0)
 ; GMRCO=  consult internal entry number
"RTN","GMRCSLM4",20,0)
 ; GMRCDA= activity internal entry number
"RTN","GMRCSLM4",21,0)
 N GMRCACT,GMRCSLN,XDT1,XDT2,FLG,LN,LINE,DASH,X,GMRCX,GMRCDEV,GMRCISIT
"RTN","GMRCSLM4",22,0)
 S GMRCDA(0)=^GMR(123,+GMRCO,40,GMRCDA,0)
"RTN","GMRCSLM4",23,0)
 S GMRCACT=$P(GMRCDA(0),"^",2)
"RTN","GMRCSLM4",24,0)
 S GMRCDA(2)=$G(^GMR(123,+GMRCO,40,GMRCDA,2))
"RTN","GMRCSLM4",25,0)
 S GMRCDA(3)=$G(^GMR(123,+GMRCO,40,GMRCDA,3))
"RTN","GMRCSLM4",26,0)
 I $D(^GMR(123,GMRCO,40,GMRCDA,2)) D
"RTN","GMRCSLM4",27,0)
 . S GMRCISIT=$P(^GMR(123,GMRCO,0),U,23) Q:'GMRCISIT
"RTN","GMRCSLM4",28,0)
 . S GMRCISIT=$$GET1^DIQ(4,GMRCISIT,.01)
"RTN","GMRCSLM4",29,0)
 D BLDLN1
"RTN","GMRCSLM4",30,0)
 D BLDLN2
"RTN","GMRCSLM4",31,0)
 D BLDCMTS
"RTN","GMRCSLM4",32,0)
 Q
"RTN","GMRCSLM4",33,0)
 ;
"RTN","GMRCSLM4",34,0)
BLDLN1 ;Build the first line for the activity
"RTN","GMRCSLM4",35,0)
 ;GMRCX is scratch pad variable
"RTN","GMRCSLM4",36,0)
 I $L($G(GMRCISIT)) D
"RTN","GMRCSLM4",37,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCISIT
"RTN","GMRCSLM4",38,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",39,0)
 S GMRCX=$P($G(^GMR(123.1,+GMRCACT,0)),"^",1)
"RTN","GMRCSLM4",40,0)
 S:'$L(GMRCX) GMRCX=GMRCACT_" action?"
"RTN","GMRCSLM4",41,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=" "_GMRCX
"RTN","GMRCSLM4",42,0)
 ;
"RTN","GMRCSLM4",43,0)
 ;Add to line for Printed to (action 22) when device name <13 characters
"RTN","GMRCSLM4",44,0)
 I GMRCACT=22 D
"RTN","GMRCSLM4",45,0)
 . S GMRCDEV=$$GET1^DIQ(3.5,+$P(GMRCDA(0),"^",8),.01)
"RTN","GMRCSLM4",46,0)
 . I '$L(GMRCDEV) S GMRCDEV=$P(GMRCDA(0),"^",8)
"RTN","GMRCSLM4",47,0)
 . I $L(GMRCDEV)<13 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_" "_GMRCDEV K GMRCDEV
"RTN","GMRCSLM4",48,0)
 ;
"RTN","GMRCSLM4",49,0)
 ;Add on generic fields that apply to every activity
"RTN","GMRCSLM4",50,0)
 ;Date/time of Actual Activity, Who's Responsible for Activity,
"RTN","GMRCSLM4",51,0)
 ;and Who entered activity
"RTN","GMRCSLM4",52,0)
 S X=$P(GMRCDA(0),"^",3) D REGDTM^GMRCU S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=$S($D(^TMP("GMRCR",$J,"DT",GMRCCT,0)):^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,25-$L(^(0)))_X,1:X)_$E(TAB)_$S($P(GMRCDA(2),"^",3)]"":$P(GMRCDA(2),"^",3),1:$E(TAB,1,3))
"RTN","GMRCSLM4",53,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,45-$L(^(0)))_$S($P(GMRCDA(2),"^",2)]"":$E($P(GMRCDA(2),"^",2),1,17),$P(GMRCDA(0),"^",4):$E($P($G(^VA(200,$P(GMRCDA(0),"^",4),0)),"^"),1,17),1:$E(TAB,1,18))
"RTN","GMRCSLM4",54,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^TMP("GMRCR",$J,"DT",GMRCCT,0)_$E(TAB,1,65-$L(^(0)))_$S($P(GMRCDA(2),"^")]"":$E($P(GMRCDA(2),"^"),1,17),$P(GMRCDA(0),"^",5):$E($P($G(^VA(200,$P(GMRCDA(0),"^",5),0)),"^"),1,17),1:$E(TAB,1,17))
"RTN","GMRCSLM4",55,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",56,0)
 Q
"RTN","GMRCSLM4",57,0)
 ;
"RTN","GMRCSLM4",58,0)
BLDLN2 ;SECOND line for activity
"RTN","GMRCSLM4",59,0)
 N GMRCSLN S GMRCSLN="" ;saved SECOND line
"RTN","GMRCSLM4",60,0)
 ;
"RTN","GMRCSLM4",61,0)
 ; Check if the entry date and specified actual date are different
"RTN","GMRCSLM4",62,0)
 S XDT1=$P(GMRCDA(0),"^",1),XDT2=$P(GMRCDA(0),"^",3),GMRCX=0
"RTN","GMRCSLM4",63,0)
 S:XDT2>XDT1 X=XDT1,XDT1=XDT2,XDT2=X
"RTN","GMRCSLM4",64,0)
 S GMRCDIF=$$FMDIFF^XLFDT(XDT1,XDT2,3)
"RTN","GMRCSLM4",65,0)
 I $L(GMRCDIF) D
"RTN","GMRCSLM4",66,0)
 . I +$P(GMRCDIF," ",1)>0 S GMRCX=1 Q  ;Check Days
"RTN","GMRCSLM4",67,0)
 . S GMRCDIF=$P(GMRCDIF," ",2)
"RTN","GMRCSLM4",68,0)
 . I +$P(GMRCDIF,":",1)>0 S GMRCX=1 Q  ;Check Hours
"RTN","GMRCSLM4",69,0)
 . I +$P(GMRCDIF,":",2)>1 S GMRCX=1 Q  ;Check Minutes
"RTN","GMRCSLM4",70,0)
 . Q
"RTN","GMRCSLM4",71,0)
 I GMRCX D
"RTN","GMRCSLM4",72,0)
 . S X=$P(GMRCDA(0),"^",1) D REGDTM^GMRCU
"RTN","GMRCSLM4",73,0)
 . ;S GMRCSLN=$E(GMRCSLN_TAB,1,15)_"(entered) "_X_$E(TAB)_$S($P(GMRCDA(2),"^",3)]"":$P(GMRCDA(2),"^",3),1:$E(TAB,1,3))
"RTN","GMRCSLM4",74,0)
 . S GMRCSLN=$E(GMRCSLN_TAB,1,15)_"(entered) "_X_$E(TAB,1,4)
"RTN","GMRCSLM4",75,0)
 . Q
"RTN","GMRCSLM4",76,0)
 ;
"RTN","GMRCSLM4",77,0)
 I $L(GMRCSLN) D  S GMRCSLN=""
"RTN","GMRCSLM4",78,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCSLN
"RTN","GMRCSLM4",79,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",80,0)
 . Q
"RTN","GMRCSLM4",81,0)
 ;
"RTN","GMRCSLM4",82,0)
 ;Get local Incomplete Report and Complete result # for second line of action
"RTN","GMRCSLM4",83,0)
 I +$P(GMRCDA(0),"^",9) D
"RTN","GMRCSLM4",84,0)
 . I $P($P(GMRCDA(0),"^",9),";",2)["TIU" D  Q
"RTN","GMRCSLM4",85,0)
 .. S GMRCSLN=$E(TAB,1,5)_"Note# "_+$P(GMRCDA(0),"^",9)
"RTN","GMRCSLM4",86,0)
 . I $P($P(GMRCDA(0),"^",9),";",2)["MCAR" D  Q
"RTN","GMRCSLM4",87,0)
 .. N MCFILE S MCFILE=+$P($P(GMRCDA(0),"^",9),"MCAR(",2) Q:'MCFILE
"RTN","GMRCSLM4",88,0)
 .. N MCPRDT S MCPRDT=$$GET1^DIQ(MCFILE,+$P(GMRCDA(0),"^",9),.01)
"RTN","GMRCSLM4",89,0)
 .. Q:'$L(MCPRDT)
"RTN","GMRCSLM4",90,0)
 .. S GMRCSLN=$E(TAB,1,5)_"Medicine Procedure performed: "_MCPRDT
"RTN","GMRCSLM4",91,0)
 ;
"RTN","GMRCSLM4",92,0)
 ;Get remote Incomplete Report and Complete result # for second line of action
"RTN","GMRCSLM4",93,0)
 I +$P(GMRCDA(2),"^",4) D
"RTN","GMRCSLM4",94,0)
 . N GMRCRR S GMRCRR=$P(GMRCDA(2),"^",4)
"RTN","GMRCSLM4",95,0)
 . S GMRCSLN=$E(TAB,1,5)_"Remote "_$P(GMRCRR,";",3)_" #"_+$P(GMRCRR,";")_" from "_$P($G(^DIC(4,+$P(GMRCRR,";",4),0)),"^")
"RTN","GMRCSLM4",96,0)
 ;
"RTN","GMRCSLM4",97,0)
 ;If GMRCDEV is defined, then print the device name on the second line
"RTN","GMRCSLM4",98,0)
 I GMRCACT=22,$D(GMRCDEV) D
"RTN","GMRCSLM4",99,0)
 . S GMRCSLN=$E(TAB,1,5)_$E(GMRCDEV,1,17) K GMRCDEV
"RTN","GMRCSLM4",100,0)
 ;
"RTN","GMRCSLM4",101,0)
 ;Build line for forwarded to (action 17)
"RTN","GMRCSLM4",102,0)
 I GMRCACT=17 D
"RTN","GMRCSLM4",103,0)
 . S GMRCX=$S(+$P(GMRCDA(0),"^",6):$P($G(^GMR(123.5,+$P(GMRCDA(0),"^",6),0)),"^"),$P(GMRCDA(3),"^")]"":$P(GMRCDA(3),"^"),1:" ??")
"RTN","GMRCSLM4",104,0)
 . S GMRCSLN=$E(TAB,1,5)_GMRCX
"RTN","GMRCSLM4",105,0)
 I GMRCACT=25 D
"RTN","GMRCSLM4",106,0)
 . S GMRCX=""
"RTN","GMRCSLM4",107,0)
 . I $P(^GMR(123,+GMRCO,12),U,5)="F" D
"RTN","GMRCSLM4",108,0)
 .. S GMRCX="Previous remote service name: "
"RTN","GMRCSLM4",109,0)
 . S GMRCX=GMRCX_$S(+$P(GMRCDA(0),"^",6):$P($G(^GMR(123.5,+$P(GMRCDA(0),"^",6),0)),"^"),$P(GMRCDA(3),"^")]"":$P(GMRCDA(3),"^"),1:" ??")
"RTN","GMRCSLM4",110,0)
 . S GMRCSLN=$E(TAB,1,5)_GMRCX
"RTN","GMRCSLM4",111,0)
 I $L(GMRCSLN) D
"RTN","GMRCSLM4",112,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=GMRCSLN
"RTN","GMRCSLM4",113,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",114,0)
 . Q
"RTN","GMRCSLM4",115,0)
 ;
"RTN","GMRCSLM4",116,0)
 Q
"RTN","GMRCSLM4",117,0)
 ;
"RTN","GMRCSLM4",118,0)
BLDCMTS ;Build lines for Comment activity.
"RTN","GMRCSLM4",119,0)
 I GMRCACT=11 D BLDCMT Q
"RTN","GMRCSLM4",120,0)
 ;
"RTN","GMRCSLM4",121,0)
 ;Build lines for general comments on any activity
"RTN","GMRCSLM4",122,0)
 I $D(^GMR(123,+GMRCO,40,+GMRCDA,1)) D  Q
"RTN","GMRCSLM4",123,0)
 . S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,0)) Q:'+LN
"RTN","GMRCSLM4",124,0)
 . ;Check for edited fields generated text with lines <75 characters
"RTN","GMRCSLM4",125,0)
 . I $G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0))["EDITED FIELDS" D BLDCMT Q
"RTN","GMRCSLM4",126,0)
 . D BLDCMT
"RTN","GMRCSLM4",127,0)
 . Q
"RTN","GMRCSLM4",128,0)
 . I $L($G(^GMR(123,+GMRCO,40,+GMRCDA,1,LN,0)))'>75 D BLDCMT Q
"RTN","GMRCSLM4",129,0)
 . ;Use utilities for long line formating
"RTN","GMRCSLM4",130,0)
 . S FLG=1,LINE="     "
"RTN","GMRCSLM4",131,0)
 . D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDA,1)","^TMP(""GMRCR"",$J,""DT"")",LINE,.GMRCCT,TAB,FLG)
"RTN","GMRCSLM4",132,0)
 . D BLDASH
"RTN","GMRCSLM4",133,0)
 . Q
"RTN","GMRCSLM4",134,0)
 Q
"RTN","GMRCSLM4",135,0)
 ;
"RTN","GMRCSLM4",136,0)
BLDCMT ;Build comment lines
"RTN","GMRCSLM4",137,0)
 ;DASH is 1 or "" for print dash line after comment
"RTN","GMRCSLM4",138,0)
 S LN=0
"RTN","GMRCSLM4",139,0)
 F  S LN=$O(^GMR(123,+GMRCO,40,+GMRCDA,1,LN)) Q:'+LN  D
"RTN","GMRCSLM4",140,0)
 . S ^TMP("GMRCR",$J,"DT",GMRCCT,0)=^GMR(123,+GMRCO,40,GMRCDA,1,LN,0) ;$P(^GMR(123,+GMRCO,40,GMRCDA,1,LN,0),"^",1)
"RTN","GMRCSLM4",141,0)
 . S GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",142,0)
 . Q
"RTN","GMRCSLM4",143,0)
 ;D BLDASH
"RTN","GMRCSLM4",144,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",145,0)
 Q
"RTN","GMRCSLM4",146,0)
 ;
"RTN","GMRCSLM4",147,0)
BLDASH ;Build separater line with dashes
"RTN","GMRCSLM4",148,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",$P(^(0),"-",80)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",149,0)
 S ^TMP("GMRCR",$J,"DT",GMRCCT,0)="",GMRCCT=GMRCCT+1
"RTN","GMRCSLM4",150,0)
 Q
"RTN","GMRCSTS1")
0^7^B31373636^B29194073
"RTN","GMRCSTS1",1,0)
GMRCSTS1 ;SLC/JFR,MA - GROUP UPDATE OF CONSULTS cont'd ;4/18/01  10:31
"RTN","GMRCSTS1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**8,18,21,50**;DEC 27, 1997;Build 8
"RTN","GMRCSTS1",3,0)
 ; Patch 18 modified PRTTSK to stop for acknowledgement between
"RTN","GMRCSTS1",4,0)
 ; printing the report and continuing with the group update.
"RTN","GMRCSTS1",5,0)
 ; Patch 21 moved the ^%ZISC up a few lines to correct a problem
"RTN","GMRCSTS1",6,0)
 ; of menu going to the printer
"RTN","GMRCSTS1",7,0)
 ; This routine invokes IA #2638
"RTN","GMRCSTS1",8,0)
PROCESS(GMRCCVT,GMRCMT) ;Update consult status by service and date range
"RTN","GMRCSTS1",9,0)
 N GMRCO,GMRCSTS,GMRCTRLC,GMRCORNP,GMRCDEV,GMRCFF,GMRCAD,ORIFN
"RTN","GMRCSTS1",10,0)
 N GMRCOM1,ORIFN
"RTN","GMRCSTS1",11,0)
 Q:'GMRCCVT
"RTN","GMRCSTS1",12,0)
 I '$D(^TMP("GMRCLS",$J)) Q  ;no entries to update
"RTN","GMRCSTS1",13,0)
 S GMRCIEN=0 F  S GMRCIEN=$O(^TMP("GMRCLS",$J,GMRCIEN)) Q:'GMRCIEN  D
"RTN","GMRCSTS1",14,0)
 . Q:'$L($G(^GMR(123,GMRCIEN,0)))
"RTN","GMRCSTS1",15,0)
 . D AUDIT(GMRCIEN,+GMRCCVT,.GMRCMT)
"RTN","GMRCSTS1",16,0)
 . D STSUPD(GMRCIEN,+GMRCCVT)
"RTN","GMRCSTS1",17,0)
 . D CPRSUPDT(GMRCIEN,+GMRCCVT)
"RTN","GMRCSTS1",18,0)
 Q
"RTN","GMRCSTS1",19,0)
PRINT(GMRCM,GMRCCVT,GMRCSVC,GMRCMT,GMRCSTRT,GMRCSTOP,GMRCDO) ;untasked print of records to update
"RTN","GMRCSTS1",20,0)
PRTTSK ; print the report then start the processing
"RTN","GMRCSTS1",21,0)
 ; GMRCM= status of records to find A:active, P:pending, B:Both
"RTN","GMRCSTS1",22,0)
 ; GMRCCVT= status to update records with  1:dc,  2:complete
"RTN","GMRCSTS1",23,0)
 ; GMRCSVC= IEN from file 123.5
"RTN","GMRCSTS1",24,0)
 ; GMRCMT= array (passed by reference) of comment to stuff in records
"RTN","GMRCSTS1",25,0)
 ; GMRCSTRT= first entry date to find/update
"RTN","GMRCSTS1",26,0)
 ; GMRCSTOP= last entry date to find/update
"RTN","GMRCSTS1",27,0)
 ; GMRCDO= 1:print only, 2:print and update records
"RTN","GMRCSTS1",28,0)
 ; GMRCSTAT= Status of consult for the report (P,A,S)
"RTN","GMRCSTS1",29,0)
 N GMRCIEN,GMRCDFN,GMRCPG,GMRCEND,GMRCSTAT
"RTN","GMRCSTS1",30,0)
 S GMRCIEN=0
"RTN","GMRCSTS1",31,0)
 U IO
"RTN","GMRCSTS1",32,0)
 D HDR(1) S GMRCPG=2
"RTN","GMRCSTS1",33,0)
 I '$D(^TMP("GMRCLS",$J)) D  D END
"RTN","GMRCSTS1",34,0)
 . W !,"No records found meeting search criteria"
"RTN","GMRCSTS1",35,0)
 F  S GMRCIEN=$O(^TMP("GMRCLS",$J,GMRCIEN)) Q:'GMRCIEN!($G(GMRCEND))  D
"RTN","GMRCSTS1",36,0)
 . I $Y>(IOSL-5) D HDR(GMRCPG) Q:$G(GMRCEND)  S GMRCPG=GMRCPG+1
"RTN","GMRCSTS1",37,0)
 . Q:'$G(^GMR(123,GMRCIEN,0))
"RTN","GMRCSTS1",38,0)
 . I $P(^GMR(123,GMRCIEN,0),U,12)=1!($P(^(0),U,12)=2) Q
"RTN","GMRCSTS1",39,0)
 . W !,GMRCIEN,?8,$$FMTE^XLFDT(+^GMR(123,GMRCIEN,0))
"RTN","GMRCSTS1",40,0)
 . W ?29,$E($$GET1^DIQ(2,$P(^GMR(123,GMRCIEN,0),U,2),.01),1,26)
"RTN","GMRCSTS1",41,0)
 . W ?56,$$GET1^DIQ(2,$P(^GMR(123,GMRCIEN,0),U,2),.09)
"RTN","GMRCSTS1",42,0)
 . S GMRCSTAT=+^TMP("GMRCLS",$J,GMRCIEN)
"RTN","GMRCSTS1",43,0)
 . W ?70,$S(GMRCSTAT=5:"p",GMRCSTAT=6:"a",GMRCSTAT=8:"s",1:"?")
"RTN","GMRCSTS1",44,0)
 . W " to ",$S(+GMRCCVT=1:"dc",1:"c")
"RTN","GMRCSTS1",45,0)
 D ^%ZISC
"RTN","GMRCSTS1",46,0)
 I GMRCDO=2,'$D(ZTQUEUED) D  ; Not task
"RTN","GMRCSTS1",47,0)
 . S DIR(0)="S^Y:To Update;N:To Quit without Updating"
"RTN","GMRCSTS1",48,0)
 . S DIR("A")="Enter update status "
"RTN","GMRCSTS1",49,0)
 . I ($D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)) Q
"RTN","GMRCSTS1",50,0)
 . D ^DIR
"RTN","GMRCSTS1",51,0)
 . I Y="Y" D PROCESS(+GMRCCVT,.GMRCMT)
"RTN","GMRCSTS1",52,0)
 I GMRCDO=2,$D(ZTQUEUED) D PROCESS(+GMRCCVT,.GMRCMT) ; Tasked
"RTN","GMRCSTS1",53,0)
END K ^TMP("GMRCLS",$J)
"RTN","GMRCSTS1",54,0)
 Q
"RTN","GMRCSTS1",55,0)
 ;
"RTN","GMRCSTS1",56,0)
HDR(PAGE) ; print the header for the report
"RTN","GMRCSTS1",57,0)
 I PAGE'=1,$E(IOST,1,2)["C-" N Y D  I '+Y S GMRCEND=1 Q
"RTN","GMRCSTS1",58,0)
 . N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTS1",59,0)
 W @IOF
"RTN","GMRCSTS1",60,0)
 W !,"Group status update of consults in file 123",?70,"Page: ",PAGE W:PAGE'=1 !
"RTN","GMRCSTS1",61,0)
 I PAGE=1 W !,?49,"Printed: ",$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","GMRCSTS1",62,0)
 I PAGE=1 D UPDCRIT(GMRCCVT,GMRCM,GMRCSVC,.GMRCMT,GMRCSTRT,GMRCSTOP)
"RTN","GMRCSTS1",63,0)
 W !,"Consult",?70,"Status"
"RTN","GMRCSTS1",64,0)
 W !,"Number    Requested          Patient                    SSN           Change"
"RTN","GMRCSTS1",65,0)
 W !,$$REPEAT^XLFSTR("-",79)
"RTN","GMRCSTS1",66,0)
 Q
"RTN","GMRCSTS1",67,0)
GETENTS(SERV,STRDT,STPDT,SRCH)  ;loop "AE" x-ref and dump into ^TMP
"RTN","GMRCSTS1",68,0)
 N IDT,IEN,STOPI,STRTI,STS,INDEX
"RTN","GMRCSTS1",69,0)
 W !!,"Searching database for entries matching search criteria",!
"RTN","GMRCSTS1",70,0)
 S STOPI=(9999999-STPDT)-1,STRTI=(9999999-STRDT)
"RTN","GMRCSTS1",71,0)
 F INDEX=1:1  Q:$P(SRCH,",",INDEX)=""  D
"RTN","GMRCSTS1",72,0)
 . I $P(SRCH,",",INDEX)=+4 S SRCH="1,2,3,"
"RTN","GMRCSTS1",73,0)
 ; Convert SRCH from 1,2,3 to 5,6,8 (pending,active,scheduled)
"RTN","GMRCSTS1",74,0)
 F INDEX=1:1  Q:$P(SRCH,",",INDEX)=""  D
"RTN","GMRCSTS1",75,0)
 . I $P(SRCH,",",INDEX)=+1 S STS=+5 D GETDATA
"RTN","GMRCSTS1",76,0)
 . I $P(SRCH,",",INDEX)=+2 S STS=+6 D GETDATA
"RTN","GMRCSTS1",77,0)
 . I $P(SRCH,",",INDEX)=+3 S STS=+8 D GETDATA
"RTN","GMRCSTS1",78,0)
GETDATA ; Write ^GMR(123,IEN,0) to TMP
"RTN","GMRCSTS1",79,0)
 S IDT=STOPI
"RTN","GMRCSTS1",80,0)
 F  S IDT=$O(^GMR(123,"AE",SERV,+STS,IDT)) Q:'IDT!(IDT>STRTI)  D
"RTN","GMRCSTS1",81,0)
 . S IEN=0 F  S IEN=$O(^GMR(123,"AE",SERV,+STS,IDT,IEN)) Q:'IEN  D
"RTN","GMRCSTS1",82,0)
 .. S ^TMP("GMRCLS",$J,IEN)=+STS_U_+^GMR(123,IEN,0)
"RTN","GMRCSTS1",83,0)
 .. W "."
"RTN","GMRCSTS1",84,0)
 Q
"RTN","GMRCSTS1",85,0)
AUDIT(GMRCO,UPDSTS,GMRCOM) ;Update the processing activity of the consult
"RTN","GMRCSTS1",86,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",87,0)
 ;UPDSTS= 1 for DC ;  2 for COMPLETE
"RTN","GMRCSTS1",88,0)
 N DA,DIE,GMRCA,GMRCDT,GMRCSTS
"RTN","GMRCSTS1",89,0)
 S GMRCDT=$$NOW^XLFDT,GMRCA=$S(UPDSTS=1:6,1:10)
"RTN","GMRCSTS1",90,0)
 S GMRCSTS=$P(^GMR(123,GMRCO,0),U,12)
"RTN","GMRCSTS1",91,0)
 S:'$D(^GMR(123,+GMRCO,40,0)) ^(0)="^123.02DA^^"
"RTN","GMRCSTS1",92,0)
 S DA=$S($P(^GMR(123,+GMRCO,40,0),"^",3):$P(^(0),"^",3)+1,1:1),$P(^GMR(123,GMRCO,40,0),"^",3,4)=DA_"^"_DA
"RTN","GMRCSTS1",93,0)
 S DIE="^GMR(123,"_+GMRCO_",40,",DA(1)=+GMRCO
"RTN","GMRCSTS1",94,0)
 S DR=".01////^S X=GMRCDT;1////^S X=GMRCA;2////^S X=GMRCDT;3////^S X=DUZ;4////^S X=DUZ"
"RTN","GMRCSTS1",95,0)
 D ^DIE
"RTN","GMRCSTS1",96,0)
 S ^GMR(123,+GMRCO,40,DA,1,0)="^^1^1^"_GMRCDT_"^"
"RTN","GMRCSTS1",97,0)
 I $D(GMRCOM) D
"RTN","GMRCSTS1",98,0)
 . M ^GMR(123,+GMRCO,40,DA,1)=GMRCOM
"RTN","GMRCSTS1",99,0)
 I '$D(GMRCOM) D
"RTN","GMRCSTS1",100,0)
 . N COMMENT
"RTN","GMRCSTS1",101,0)
 . S COMMENT="Status updated from "
"RTN","GMRCSTS1",102,0)
 . S COMMENT=COMMENT_$P(^ORD(100.01,+GMRCSTS,0),"^",1)
"RTN","GMRCSTS1",103,0)
 . S COMMENT=COMMENT_" to "_$S(+UPDSTS=2:"COMPLETE",1:"DISCONTINUED")
"RTN","GMRCSTS1",104,0)
 . S COMMENT=COMMENT_" during group status update process."
"RTN","GMRCSTS1",105,0)
 . S ^GMR(123,+GMRCO,40,DA,1,1,0)=COMMENT
"RTN","GMRCSTS1",106,0)
 ;Check for IFC and update accordingly
"RTN","GMRCSTS1",107,0)
 I $D(^GMR(123,+GMRCO,12)),$D(^(40,DA)) D TRIGR^GMRCIEVT(GMRCO,DA)
"RTN","GMRCSTS1",108,0)
 K DIE,GMRCA,GMRCDT
"RTN","GMRCSTS1",109,0)
 Q
"RTN","GMRCSTS1",110,0)
STSUPD(GMRCO,UPDSTS) ;change status of consult to COMPLETE or DC
"RTN","GMRCSTS1",111,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",112,0)
 ;UPDSTS= 1 for DC ;  2 for COMPLETE
"RTN","GMRCSTS1",113,0)
 N DIE,DA,DR,GMRCLST,X
"RTN","GMRCSTS1",114,0)
 S GMRCLST=$S(UPDSTS=1:$O(^GMR(123.1,"B","DISCONTINUED",0)),UPDSTS=2:$O(^GMR(123.1,"B","COMPLETE/UPDATE",0)),1:99)
"RTN","GMRCSTS1",115,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCSTS1",116,0)
 S DR="8////^S X=+UPDSTS;9////"_GMRCLST
"RTN","GMRCSTS1",117,0)
 D ^DIE
"RTN","GMRCSTS1",118,0)
 Q
"RTN","GMRCSTS1",119,0)
CPRSUPDT(GMRCO,UPDSTS) ;Update CPRS order with new status
"RTN","GMRCSTS1",120,0)
 ;GMRCO= IEN from file 123
"RTN","GMRCSTS1",121,0)
 ;UPDSTS= status to update CPRS with
"RTN","GMRCSTS1",122,0)
 N GMRCDFN,CTRLCODE
"RTN","GMRCSTS1",123,0)
 S GMRCDFN=$P(^GMR(123,GMRCO,0),"^",2)
"RTN","GMRCSTS1",124,0)
 S CTRLCODE=$S(UPDSTS=1:"OD",1:"RE")
"RTN","GMRCSTS1",125,0)
 ; send HL7 message to CPRS to update order status
"RTN","GMRCSTS1",126,0)
 D EN^GMRCHL7(GMRCDFN,+GMRCO,"","",CTRLCODE,DUZ,"","",1)
"RTN","GMRCSTS1",127,0)
 Q
"RTN","GMRCSTS1",128,0)
UPDCRIT(UPD,STS,SVC,CMT,START,STOP) ;print update criteria on page 1
"RTN","GMRCSTS1",129,0)
 N INDEX,GMRCSTS
"RTN","GMRCSTS1",130,0)
 F INDEX=1:1  Q:$P(STS,",",INDEX)=""  D
"RTN","GMRCSTS1",131,0)
 . I STS[+4 S GMRCSTS="Active, Pending, and Scheduled" Q
"RTN","GMRCSTS1",132,0)
 . I $P(STS,",",INDEX)=+1 S $P(GMRCSTS,",",INDEX)="Pending"
"RTN","GMRCSTS1",133,0)
 . I $P(STS,",",INDEX)=+2 S $P(GMRCSTS,",",INDEX)="Active"
"RTN","GMRCSTS1",134,0)
 . I $P(STS,",",INDEX)=+3 S $P(GMRCSTS,",",INDEX)="Scheduled"
"RTN","GMRCSTS1",135,0)
 W !,"Records will be updated for:"
"RTN","GMRCSTS1",136,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMRCSTS1",137,0)
 W !,"          Service: "_$$GET1^DIQ(123.5,SVC,.01)
"RTN","GMRCSTS1",138,0)
 W !,"        Beginning: "_$$FMTE^XLFDT(START)
"RTN","GMRCSTS1",139,0)
 W !,"           Ending: "_$$FMTE^XLFDT(STOP)
"RTN","GMRCSTS1",140,0)
 W !,"           Update: "_GMRCSTS_" "_" Consults"
"RTN","GMRCSTS1",141,0)
 W !,"               To: "_$S(+UPD=2:"COMPLETE",1:"DISCONTINUED")
"RTN","GMRCSTS1",142,0)
 I $D(CMT) W !,"   Update Comment:" D
"RTN","GMRCSTS1",143,0)
 . N I S I=0 F  S I=$O(CMT(I)) Q:'I  D
"RTN","GMRCSTS1",144,0)
 .. W !,CMT(I,0)
"RTN","GMRCSTS1",145,0)
 W !,$$REPEAT^XLFSTR("-",78),!
"RTN","GMRCSTS1",146,0)
 Q
"RTN","GMRCYP50")
0^8^B31546211^n/a
"RTN","GMRCYP50",1,0)
GMRCYP50 ;ISP/TDP - POST INSTALL FOR GMRC*3*50 ; 5/2/2006
"RTN","GMRCYP50",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**50**;DEC 27, 1997;Build 8
"RTN","GMRCYP50",3,0)
 Q
"RTN","GMRCYP50",4,0)
 ;
"RTN","GMRCYP50",5,0)
POST ; Start of Pre-init for patch GMRC*3*50
"RTN","GMRCYP50",6,0)
 N GMRCTTL
"RTN","GMRCYP50",7,0)
 K ^TMP("GMRCYP50",$J)
"RTN","GMRCYP50",8,0)
 D BMES^XPDUTL("Starting Post-init...")
"RTN","GMRCYP50",9,0)
 D BMES^XPDUTL("   Searching for Procedure Consults which have an Inter-Facility")
"RTN","GMRCYP50",10,0)
 D MES^XPDUTL("   Consult as a Related Service.")
"RTN","GMRCYP50",11,0)
 D MES^XPDUTL(" ")
"RTN","GMRCYP50",12,0)
 D SEARCH
"RTN","GMRCYP50",13,0)
 I GMRCTTL D MSG
"RTN","GMRCYP50",14,0)
 I 'GMRCTTL D BMES^XPDUTL("      No invalid entries found.")
"RTN","GMRCYP50",15,0)
 D BMES^XPDUTL("Post-init complete.")
"RTN","GMRCYP50",16,0)
 Q
"RTN","GMRCYP50",17,0)
 ;
"RTN","GMRCYP50",18,0)
SEARCH ; Search RELATED SERVICES (#2) field of the GMRC PROCEDURE (#123.3) file
"RTN","GMRCYP50",19,0)
 ; for invalid IFC services.
"RTN","GMRCYP50",20,0)
 N GMRCMSG,GMRCMSG1,GMRCPIEN,GMRCPRC,GMRCSIEN,GMRCSVC,X,XX,Y
"RTN","GMRCYP50",21,0)
 S (GMRCPRC,GMRCTTL)=0
"RTN","GMRCYP50",22,0)
 F  S GMRCPRC=$O(^GMR(123.3,"B",GMRCPRC)) Q:GMRCPRC=""  D
"RTN","GMRCYP50",23,0)
 . S GMRCPIEN=""
"RTN","GMRCYP50",24,0)
 . F  S GMRCPIEN=$O(^GMR(123.3,"B",GMRCPRC,GMRCPIEN)) Q:GMRCPIEN=""  D
"RTN","GMRCYP50",25,0)
 .. S GMRCSIEN=0
"RTN","GMRCYP50",26,0)
 .. F  S GMRCSIEN=$O(^GMR(123.3,GMRCPIEN,2,"B",GMRCSIEN)) Q:GMRCSIEN=""  D
"RTN","GMRCYP50",27,0)
 ... I '+$G(^GMR(123.5,+GMRCSIEN,"IFC")),'+$O(^GMR(123.5,+GMRCSIEN,"IFCS",0)) Q
"RTN","GMRCYP50",28,0)
 ... S GMRCSVC=$P($G(^GMR(123.5,GMRCSIEN,0)),U,1)
"RTN","GMRCYP50",29,0)
 ... I GMRCSVC="" S GMRCSVC="SERVICE UNKNOWN"
"RTN","GMRCYP50",30,0)
 ... S ^TMP("GMRCYP50",$J,GMRCPRC_" (#"_GMRCPIEN_")",GMRCSVC_" (#"_GMRCSIEN_")")=""
"RTN","GMRCYP50",31,0)
 ... K GMRCMSG
"RTN","GMRCYP50",32,0)
 ... S GMRCMSG="Related Service, "_GMRCSVC_" (IEN #"_GMRCSIEN_"), associated with Consult Procedure, "_GMRCPRC_" (IEN #"_GMRCPIEN_"), is an Inter-Facility Consult Service and must be removed or replaced with a service which is not an IFC!"
"RTN","GMRCYP50",33,0)
 ... S Y=0
"RTN","GMRCYP50",34,0)
 ... F X=1:1 S GMRCMSG1=$E(GMRCMSG,Y,Y+61) D  Q:Y'<$L(GMRCMSG)
"RTN","GMRCYP50",35,0)
 .... I $L(GMRCMSG1)<61 S Y=Y+61,GMRCMSG(X)=GMRCMSG1 Q
"RTN","GMRCYP50",36,0)
 .... F XX=61:-1:1 D  Q:$D(GMRCMSG(X))
"RTN","GMRCYP50",37,0)
 ..... I $E(GMRCMSG1,XX)'=" " Q
"RTN","GMRCYP50",38,0)
 ..... S Y=Y+1+XX I X>1 S Y=Y-1
"RTN","GMRCYP50",39,0)
 ..... S GMRCMSG(X)=$E(GMRCMSG1,1,XX)
"RTN","GMRCYP50",40,0)
 ... S X=""
"RTN","GMRCYP50",41,0)
 ... F  S X=$O(GMRCMSG(X)) Q:X=""  W !,"      "_$G(GMRCMSG(X))
"RTN","GMRCYP50",42,0)
 ... W !
"RTN","GMRCYP50",43,0)
 ... S GMRCTTL=GMRCTTL+1
"RTN","GMRCYP50",44,0)
 ;D MES^XPDUTL(" ")
"RTN","GMRCYP50",45,0)
 D BMES^XPDUTL("   "_GMRCTTL_" total invalid Related Services.")
"RTN","GMRCYP50",46,0)
 Q
"RTN","GMRCYP50",47,0)
 ;
"RTN","GMRCYP50",48,0)
MSG ; Send Mailman message to installer
"RTN","GMRCYP50",49,0)
 N GMRCC,GMRCCNT,GMRCPARM,GMRCPRC,GMRCSVC,GMRCTXT,GMRCWHO
"RTN","GMRCYP50",50,0)
 N XMDUZ,XMERR,XMSUB,XMTEXT,XMY,Y
"RTN","GMRCYP50",51,0)
 S XMSUB="RELATED SERVICES ARE INVALID"
"RTN","GMRCYP50",52,0)
 I DUZ="" N DUZ S DUZ=.5 ; if user not defined set to postmaster
"RTN","GMRCYP50",53,0)
 S XMDUZ=DUZ,XMTEXT="GMRCTXT"
"RTN","GMRCYP50",54,0)
 S GMRCPARM("FROM")="PATCH GMRC*3.0*50 POST-INIT"
"RTN","GMRCYP50",55,0)
 S XMY(DUZ)="" ; send message to user
"RTN","GMRCYP50",56,0)
 S GMRCC=0
"RTN","GMRCYP50",57,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="This message has been sent by patch GMRC*3.0*50 at the completion of"
"RTN","GMRCYP50",58,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="the post-init routine."
"RTN","GMRCYP50",59,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCYP50",60,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="This message was sent because Consult Procedure records were found which"
"RTN","GMRCYP50",61,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="contained one or more Related Services which are setup as Inter-Facility"
"RTN","GMRCYP50",62,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Consults.  These related services should be removed and replaced with"
"RTN","GMRCYP50",63,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="non-IFC services to prevent possible problems in the Consult/Request"
"RTN","GMRCYP50",64,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Tracking package.  The following information is provided to assist you"
"RTN","GMRCYP50",65,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="in your cleanup efforts."
"RTN","GMRCYP50",66,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCYP50",67,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="PROCEDURE"
"RTN","GMRCYP50",68,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="     RELATED SERVICE"
"RTN","GMRCYP50",69,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="==========================================================================="
"RTN","GMRCYP50",70,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCYP50",71,0)
 S GMRCCNT=0,GMRCPRC=""
"RTN","GMRCYP50",72,0)
 F  S GMRCPRC=$O(^TMP("GMRCYP50",$J,GMRCPRC)) Q:GMRCPRC=""  D
"RTN","GMRCYP50",73,0)
 . S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=GMRCPRC
"RTN","GMRCYP50",74,0)
 . S GMRCSVC=""
"RTN","GMRCYP50",75,0)
 . F  S GMRCSVC=$O(^TMP("GMRCYP50",$J,GMRCPRC,GMRCSVC)) Q:GMRCSVC=""  D
"RTN","GMRCYP50",76,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="    "_GMRCSVC
"RTN","GMRCYP50",77,0)
 .. S GMRCCNT=GMRCCNT+1
"RTN","GMRCYP50",78,0)
 . S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCYP50",79,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCYP50",80,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  "
"RTN","GMRCYP50",81,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Total invalid Related Services: "_GMRCCNT
"RTN","GMRCYP50",82,0)
 D SENDMSG^XMXAPI(XMDUZ,XMSUB,XMTEXT,.XMY,.GMRCPARM,"","")
"RTN","GMRCYP50",83,0)
 S GMRCMSG(1)=" "
"RTN","GMRCYP50",84,0)
 S GMRCMSG(2)="******************************************************************************"
"RTN","GMRCYP50",85,0)
 S GMRCMSG(3)="** Message containing Procedure Consult records which have invalid          **"
"RTN","GMRCYP50",86,0)
 S GMRCMSG(4)="** Related Services was "_$S($D(XMERR):"not sent due to an error in the message set up.       **",1:"sent to the "_$S(DUZ=.5:"postmaster.  Please forward this         **",1:"user.  Please forward this              **"))
"RTN","GMRCYP50",87,0)
 I $D(XMERR) S GMRCMSG(5)="** Dumping message to screen.                                               **"
"RTN","GMRCYP50",88,0)
 I '$D(XMERR) S GMRCMSG(5)="** message to the appropriate staff, which includes the clinical            **"
"RTN","GMRCYP50",89,0)
 I '$D(XMERR) S GMRCMSG(6)="** coordinator, for further action.                                         **"
"RTN","GMRCYP50",90,0)
 S GMRCMSG($S($D(XMERR):6,1:7))="******************************************************************************"
"RTN","GMRCYP50",91,0)
 D BMES^XPDUTL(.GMRCMSG)
"RTN","GMRCYP50",92,0)
 I $D(XMERR) D BMES^XPDUTL("  "),BMES^XPDUTL(.GMRCTXT)
"RTN","GMRCYP50",93,0)
 K ^TMP("GMRCYP50",$J)
"RTN","GMRCYP50",94,0)
 Q
"UP",123.3,123.32,-1)
123.3^2
"UP",123.3,123.32,0)
123.32
"VER")
8.0^22.0
"^DD",123.3,123.3,2,0)
RELATED SERVICES^123.32P^^2;0
"^DD",123.3,123.32,0)
RELATED SERVICES SUB-FIELD^^.01^1
"^DD",123.3,123.32,0,"NM","RELATED SERVICES")

"^DD",123.3,123.32,.01,0)
RELATED SERVICES^MP123.5'X^GMR(123.5,^0;1^I $P($G(^GMR(123.5,+X,0)),"^",2)=9!($P($G(^GMR(123.5,+X,0)),"^",2)=1)!(+$G(^GMR(123.5,+X,"IFC")))!(+$O(^GMR(123.5,+X,"IFCS",0))) D EN^DDIOL("This service is not orderable. Try again.") K X
"^DD",123.3,123.32,.01,1,0)
^.1^^-1
"^DD",123.3,123.32,.01,1,1,0)
123.32^B
"^DD",123.3,123.32,.01,1,1,1)
S ^GMR(123.3,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",123.3,123.32,.01,1,1,2)
K ^GMR(123.3,DA(1),2,"B",$E(X,1,30),DA)
"^DD",123.3,123.32,.01,3)
Enter the service that will perform this procedure
"^DD",123.3,123.32,.01,21,0)
^.001^3^3^3060505^^^^
"^DD",123.3,123.32,.01,21,1,0)
This field will indicate which Consult services from the REQUEST
"^DD",123.3,123.32,.01,21,2,0)
SERVICES (#123.5) file are responsible for the processing of requests for
"^DD",123.3,123.32,.01,21,3,0)
this procedure.
"^DD",123.3,123.32,.01,"DT")
3060502
"BLD",6615,6)
^46
**END**
**END**
