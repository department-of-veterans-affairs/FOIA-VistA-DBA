Released IB*2*259 SEQ #238
Extracted from mail message
**KIDS**:IB*2.0*259^

**INSTALL NAME**
IB*2.0*259
"BLD",5093,0)
IB*2.0*259^INTEGRATED BILLING^0^3040423^y
"BLD",5093,1,0)
^^2^2^3040423^
"BLD",5093,1,1,0)
This KIDS Build will transport patch IB*2.0*259, The Pharmacy Co-pay Cap 
"BLD",5093,1,2,0)
Summary Report, to the field.
"BLD",5093,4,0)
^9.64PA^^
"BLD",5093,"ABPKG")
n
"BLD",5093,"KRN",0)
^9.67PA^8989.52^19
"BLD",5093,"KRN",.4,0)
.4
"BLD",5093,"KRN",.401,0)
.401
"BLD",5093,"KRN",.402,0)
.402
"BLD",5093,"KRN",.403,0)
.403
"BLD",5093,"KRN",.5,0)
.5
"BLD",5093,"KRN",.84,0)
.84
"BLD",5093,"KRN",3.6,0)
3.6
"BLD",5093,"KRN",3.8,0)
3.8
"BLD",5093,"KRN",9.2,0)
9.2
"BLD",5093,"KRN",9.8,0)
9.8
"BLD",5093,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5093,"KRN",9.8,"NM",1,0)
IBARXMO1^^0^B25763968
"BLD",5093,"KRN",9.8,"NM","B","IBARXMO1",1)

"BLD",5093,"KRN",19,0)
19
"BLD",5093,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",5093,"KRN",19,"NM",1,0)
IBARXM FACILITY CAP SUMM RPT^^0^
"BLD",5093,"KRN",19,"NM",2,0)
IB OUTPUT PATIENT REPORT MENU^^2
"BLD",5093,"KRN",19,"NM","B","IB OUTPUT PATIENT REPORT MENU",2)

"BLD",5093,"KRN",19,"NM","B","IBARXM FACILITY CAP SUMM RPT",1)

"BLD",5093,"KRN",19.1,0)
19.1
"BLD",5093,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5093,"KRN",101,0)
101
"BLD",5093,"KRN",409.61,0)
409.61
"BLD",5093,"KRN",771,0)
771
"BLD",5093,"KRN",870,0)
870
"BLD",5093,"KRN",8989.51,0)
8989.51
"BLD",5093,"KRN",8989.52,0)
8989.52
"BLD",5093,"KRN",8994,0)
8994
"BLD",5093,"KRN","B",.4,.4)

"BLD",5093,"KRN","B",.401,.401)

"BLD",5093,"KRN","B",.402,.402)

"BLD",5093,"KRN","B",.403,.403)

"BLD",5093,"KRN","B",.5,.5)

"BLD",5093,"KRN","B",.84,.84)

"BLD",5093,"KRN","B",3.6,3.6)

"BLD",5093,"KRN","B",3.8,3.8)

"BLD",5093,"KRN","B",9.2,9.2)

"BLD",5093,"KRN","B",9.8,9.8)

"BLD",5093,"KRN","B",19,19)

"BLD",5093,"KRN","B",19.1,19.1)

"BLD",5093,"KRN","B",101,101)

"BLD",5093,"KRN","B",409.61,409.61)

"BLD",5093,"KRN","B",771,771)

"BLD",5093,"KRN","B",870,870)

"BLD",5093,"KRN","B",8989.51,8989.51)

"BLD",5093,"KRN","B",8989.52,8989.52)

"BLD",5093,"KRN","B",8994,8994)

"BLD",5093,"QUES",0)
^9.62^^
"BLD",5093,"REQB",0)
^9.611^^
"KRN",19,6793,-1)
2^2
"KRN",19,6793,0)
IB OUTPUT PATIENT REPORT MENU^Patient Billing Reports Menu^^M^434^^^^^^^172
"KRN",19,6793,10,0)
^19.01IP^29^29
"KRN",19,6793,10,29,0)
16286^FCAP
"KRN",19,6793,10,29,"^")
IBARXM FACILITY CAP SUMM RPT
"KRN",19,6793,"U")
PATIENT BILLING REPORTS MENU
"KRN",19,16286,-1)
0^1
"KRN",19,16286,0)
IBARXM FACILITY CAP SUMM RPT^Facility Pharmacy Co-pay Cap Summary Report^^R^^^^^^^^
"KRN",19,16286,1,0)
^19.06^3^3^3031231^^
"KRN",19,16286,1,1,0)
This option will generate the Facility Pharmacy Co-Pay Cap Summary 
"KRN",19,16286,1,2,0)
Report. The purpose of this report is to delineate six data elements 
"KRN",19,16286,1,3,0)
required by the VHA Chief Business Office on a yearly basis.
"KRN",19,16286,25)
IBARXMO1
"KRN",19,16286,99.1)
59555,56375
"KRN",19,16286,"U")
FACILITY PHARMACY CO-PAY CAP S
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",172,-1)
1^1
"PKG",172,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",172,20,0)
^9.402P^1^1
"PKG",172,20,1,0)
2^^IBAXDR
"PKG",172,20,1,1)

"PKG",172,20,"B",2,1)

"PKG",172,22,0)
^9.49I^1^1
"PKG",172,22,1,0)
2.0^2940321^2940528
"PKG",172,22,1,"PAH",1,0)
259^3040423^1399
"PKG",172,22,1,"PAH",1,1,0)
^^2^2^3040423
"PKG",172,22,1,"PAH",1,1,1,0)
This KIDS Build will transport patch IB*2.0*259, The Pharmacy Co-pay Cap 
"PKG",172,22,1,"PAH",1,1,2,0)
Summary Report, to the field.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBARXMO1")
0^1^B25763968
"RTN","IBARXMO1",1,0)
IBARXMO1 ;LEX/WRC - PHARMACY CO-PAY CAP ;10/23/03
"RTN","IBARXMO1",2,0)
 ;;2.0;INTEGRATED BILLING;**259**;21-MAR-94
"RTN","IBARXMO1",3,0)
 ;
"RTN","IBARXMO1",4,0)
CALDT ;
"RTN","IBARXMO1",5,0)
 ;set dates min/max and calendar year
"RTN","IBARXMO1",6,0)
 S IBMIN=3011231
"RTN","IBARXMO1",7,0)
 D NOW^%DTC S IBCENYR=$E(X,1,3),IBCENYR=IBCENYR-1,IBMAX=IBCENYR_1231
"RTN","IBARXMO1",8,0)
 S DIR(0)="DOA^"_IBMIN_":"_IBMAX_":AEP^K:X'?2.4N X",DIR("A")="Enter the Two or Four Digit Calendar Year: "
"RTN","IBARXMO1",9,0)
 D ^DIR K DIR
"RTN","IBARXMO1",10,0)
 I Y<1 D KIL Q
"RTN","IBARXMO1",11,0)
 S IBCENYR=$E(Y,1,3),IBSMYR=IBCENYR_"0100",IBEMYR=IBCENYR_1231
"RTN","IBARXMO1",12,0)
 ;
"RTN","IBARXMO1",13,0)
ZIS S %IS="Q" D ^%ZIS
"RTN","IBARXMO1",14,0)
 K %H,%T I POP=1 D KIL Q
"RTN","IBARXMO1",15,0)
 I '$D(IO("Q")) U IO D STRT Q
"RTN","IBARXMO1",16,0)
 S ZTRTN="STRT^IBARXMO1",ZTIO=ION,ZTSAVE("IBSMYR")="",ZTSAVE("IBEMYR")=""
"RTN","IBARXMO1",17,0)
 D ^%ZTLOAD
"RTN","IBARXMO1",18,0)
 W:$D(ZTSK) !,"Request Queued!",!,"Task Number: "_ZTSK,!
"RTN","IBARXMO1",19,0)
 D KIL Q
"RTN","IBARXMO1",20,0)
 ;
"RTN","IBARXMO1",21,0)
STRT ;
"RTN","IBARXMO1",22,0)
 ;-set the annual billing cap in variable IBY
"RTN","IBARXMO1",23,0)
 S IBD=IBEMYR,IBP=2 D CAP^IBARXMC(IBD,IBP,.IBM,.IBY,.IBF,.IBT)
"RTN","IBARXMO1",24,0)
 S IBSITE=$P($$SITE^VASITE,"^",3) ;get the site's station number
"RTN","IBARXMO1",25,0)
 S (IBTNBOC,IBTV,IBTVC,IBAB,IBANB,IBA5,IBB5,IBA3)=0
"RTN","IBARXMO1",26,0)
 S IBDFN=0
"RTN","IBARXMO1",27,0)
 F  S IBDFN=$O(^IBAM(354.71,"AD",IBDFN)) Q:'IBDFN  D
"RTN","IBARXMO1",28,0)
 . S IBP=$$PRIORITY^IBARXMU(IBDFN)
"RTN","IBARXMO1",29,0)
 . I IBP<2!(IBP>6) Q
"RTN","IBARXMO1",30,0)
 . D IB350R
"RTN","IBARXMO1",31,0)
 . S IBTRDT=IBSMYR-1,IBTIEN=""
"RTN","IBARXMO1",32,0)
 . F  S IBTRDT=$O(^IBAM(354.71,"AD",IBDFN,IBTRDT)) Q:IBTRDT=""!(IBTRDT>IBEMYR)!($D(IBSLESS))  D
"RTN","IBARXMO1",33,0)
 .. F  S IBTIEN=$O(^IBAM(354.71,"AD",IBDFN,IBTRDT,IBTIEN)) Q:IBTIEN=""  D
"RTN","IBARXMO1",34,0)
 ... S IBTREC=$G(^IBAM(354.71,IBTIEN,0))
"RTN","IBARXMO1",35,0)
 ... I $P(IBTREC,"^",4)'="",($D(^TMP("IBARXMO1",$J,$P(IBTREC,"^",4)))) Q  ;ignore charge because "co-pay" cancellation (status=11) not in 354.71
"RTN","IBARXMO1",36,0)
 ... S IBTSTA=$E($P(IBTREC,"^",1),1,3) ;get the orginating station
"RTN","IBARXMO1",37,0)
 ... I IBTSTA<+IBSITE S IBSLESS=1 Q  ;if the vet was billed at a 'lesser site', don't count him here
"RTN","IBARXMO1",38,0)
 ... I IBTSTA=+IBSITE S IBSSITE=1 ;vet was billed at this site, so vet can be counted at this site
"RTN","IBARXMO1",39,0)
 ... S IBAB=IBAB+$P(IBTREC,"^",11) ;increment the total amount billed to the vet
"RTN","IBARXMO1",40,0)
 ... I IBAB=IBY!(IBAB>IBY),('$D(IBMRK)) S IBMRK=$P(IBTREC,"^",3) ;if the vet hit or exceeded the cap for the first time, set the date that occurred
"RTN","IBARXMO1",41,0)
 ... S IBANB=IBANB+$P(IBTREC,"^",12) ;increment the total amount not billed
"RTN","IBARXMO1",42,0)
 . I $D(IBSLESS) D RESET Q  ;vet to be counted at the 'lesser site'
"RTN","IBARXMO1",43,0)
 . I '$D(IBSSITE) D RESET Q  ;vet wasn't billed here at least once in the timeframe
"RTN","IBARXMO1",44,0)
 . I IBAB<.01 D RESET Q  ;vet wasn't billed
"RTN","IBARXMO1",45,0)
 . S IBTNBOC=IBTNBOC+IBANB ;increment 'Amount Above Cap'
"RTN","IBARXMO1",46,0)
 . S IBTV=IBTV+1 ;increment 'Veterans Billed the Co-payment'
"RTN","IBARXMO1",47,0)
 . I IBAB<IBY D  D RESET Q  ;if vet didn't reach the cap
"RTN","IBARXMO1",48,0)
 .. S IBA5=IBA5+IBAB ;increment the amounts billed to vets not reaching cap
"RTN","IBARXMO1",49,0)
 .. S IBB5=IBB5+1 ;increment # vets not reaching cap
"RTN","IBARXMO1",50,0)
 . I $D(IBMRK) S X1=IBMRK,X2=IBSMYR D ^%DTC S IBA3=IBA3+X ;calculate running total of time rquired by vet to reach the cap
"RTN","IBARXMO1",51,0)
 . S IBTVC=IBTVC+1 ;increment 'Veterans Reaching the Cap'
"RTN","IBARXMO1",52,0)
 . D RESET
"RTN","IBARXMO1",53,0)
 S IBAVGD=$S('IBTVC:0,1:IBA3/IBTVC) ;calculate 'Average Days Reaching Cap'
"RTN","IBARXMO1",54,0)
 S IBAVGBUC=$S('IBB5:0,1:IBA5/IBB5) ;calculate 'Average Billed to Those Not Reaching Cap'
"RTN","IBARXMO1",55,0)
 D PRINT
"RTN","IBARXMO1",56,0)
 ;
"RTN","IBARXMO1",57,0)
KIL I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBARXMO1",58,0)
 E  D ^%ZISC
"RTN","IBARXMO1",59,0)
 ;
"RTN","IBARXMO1",60,0)
 K %DT,IBSMYR,Y,IBEMYR,%IS,IBD,IBP,IBM,IBY,IBT,IBSITE,IBTNBOC,IBTV,IBTVC,IBAB,IBANB,IBA5,IBB5,IBA3,IBDFN,IBMRK,IBAVGD,IBAVGBUC,IBTRDT,IBTIEN,IBTREC,IBTSTA,X,IBPSMYR,IBPEMYR
"RTN","IBARXMO1",61,0)
 K DIR,POP,IBF,IBMIN,IBMAX,IBCENYR,IB350STD,IB350IEN,IB350R,X1,X2,X3,ZTIO,ZTQUEUED,ZTRTN,ZTSAVE,ZTSK
"RTN","IBARXMO1",62,0)
 K ^TMP("IBARXMO1",$J)
"RTN","IBARXMO1",63,0)
 Q
"RTN","IBARXMO1",64,0)
 ;
"RTN","IBARXMO1",65,0)
RESET ;
"RTN","IBARXMO1",66,0)
 S (IBAB,IBANB)=0
"RTN","IBARXMO1",67,0)
 K IBMRK,IBSLESS,IBSSITE
"RTN","IBARXMO1",68,0)
 Q
"RTN","IBARXMO1",69,0)
 ;
"RTN","IBARXMO1",70,0)
PRINT ;
"RTN","IBARXMO1",71,0)
 I $E(IOST,1,2)="C-" W @IOF,*13
"RTN","IBARXMO1",72,0)
 S IBSMYR=$E(IBSMYR,1,5)_"01"
"RTN","IBARXMO1",73,0)
 S Y=IBSMYR D DD^%DT S IBPSMYR=Y
"RTN","IBARXMO1",74,0)
 S Y=IBEMYR D DD^%DT S IBPEMYR=Y
"RTN","IBARXMO1",75,0)
 W !,?26,"FACILITY PHARMACY CO-PAY CAP"
"RTN","IBARXMO1",76,0)
 W !,?32,"SUMMARY REPORT"
"RTN","IBARXMO1",77,0)
 W !,?23,IBPSMYR," THROUGH ",IBPEMYR
"RTN","IBARXMO1",78,0)
 D NOW^%DTC S Y=X D DD^%DT W !,?29,"RUN DATE: ",Y,!!
"RTN","IBARXMO1",79,0)
 W !,"Total Vets Billed:" S X=IBTV,X2=0,X3=20 D COMMA^%DTC W ?50,X
"RTN","IBARXMO1",80,0)
 W !,"Total Vets At or Above the Cap:" S X=IBTVC,X2=0,X3=20 D COMMA^%DTC W ?50,X
"RTN","IBARXMO1",81,0)
 W !,"Average Number of Days to Reach Cap:" S X=IBAVGD,X2=0,X3=20 D COMMA^%DTC W ?50,X
"RTN","IBARXMO1",82,0)
 W !,"Average Amount Charged to Those Not Reaching Cap:" S X=IBAVGBUC,X2="2$",X3=20 D COMMA^%DTC W ?50,X
"RTN","IBARXMO1",83,0)
 W !,"Potential Billable Amount:" S X=IBTNBOC,X2="2$",X3=20 D COMMA^%DTC W ?50,X
"RTN","IBARXMO1",84,0)
 I $E(IOST,1,2)="C-" W !! S DIR(0)="E" D ^DIR
"RTN","IBARXMO1",85,0)
 Q
"RTN","IBARXMO1",86,0)
IB350R ;
"RTN","IBARXMO1",87,0)
 ;build array of "co-pay" cancellations (status=11) not in 354.71
"RTN","IBARXMO1",88,0)
 ;
"RTN","IBARXMO1",89,0)
 K ^TMP("IBARXMO1",$J)
"RTN","IBARXMO1",90,0)
 S IB350STD=IBSMYR
"RTN","IBARXMO1",91,0)
 F  S IB350STD=$O(^IB("APTDT",IBDFN,IB350STD)) Q:IB350STD=""!(IB350STD>IBEMYR)  D
"RTN","IBARXMO1",92,0)
 . S IB350IEN=""
"RTN","IBARXMO1",93,0)
 . F  S IB350IEN=$O(^IB("APTDT",IBDFN,IB350STD,IB350IEN)) Q:'IB350IEN  D
"RTN","IBARXMO1",94,0)
 .. S IB350R=$G(^IB(IB350IEN,0))
"RTN","IBARXMO1",95,0)
 .. I $P(IB350R,"^",5)'=11 Q
"RTN","IBARXMO1",96,0)
 .. I $P(IB350R,"^",9)'="" S ^TMP("IBARXMO1",$J,$P(IB350R,"^",9))=""
"RTN","IBARXMO1",97,0)
 Q
"VER")
8.0^22.0
**END**
**END**
