Released RMPR*3*135 SEQ #118
Extracted from mail message
**KIDS**:RMPR*3.0*135^

**INSTALL NAME**
RMPR*3.0*135
"BLD",6510,0)
RMPR*3.0*135^PROSTHETICS^0^3070921^y
"BLD",6510,1,0)
^^7^7^3070509^
"BLD",6510,1,1,0)
1.  Status of original consult changes from closed to active when it is
"BLD",6510,1,2,0)
    cloned and a Post Initial Action action occurs.
"BLD",6510,1,3,0)
 
"BLD",6510,1,4,0)
2.  Prosthetics ordering issue for multiple orders against suspense
"BLD",6510,1,5,0)
    record.
"BLD",6510,1,6,0)
 
"BLD",6510,1,7,0)
3.  Prosthetics GUI Delayed Order Report problem.
"BLD",6510,4,0)
^9.64PA^^
"BLD",6510,6.3)
12
"BLD",6510,"ABPKG")
n
"BLD",6510,"KRN",0)
^9.67PA^8989.52^19
"BLD",6510,"KRN",.4,0)
.4
"BLD",6510,"KRN",.401,0)
.401
"BLD",6510,"KRN",.402,0)
.402
"BLD",6510,"KRN",.403,0)
.403
"BLD",6510,"KRN",.5,0)
.5
"BLD",6510,"KRN",.84,0)
.84
"BLD",6510,"KRN",3.6,0)
3.6
"BLD",6510,"KRN",3.8,0)
3.8
"BLD",6510,"KRN",9.2,0)
9.2
"BLD",6510,"KRN",9.8,0)
9.8
"BLD",6510,"KRN",9.8,"NM",0)
^9.68A^7^5
"BLD",6510,"KRN",9.8,"NM",1,0)
RMPREOS^^0^B77412066
"BLD",6510,"KRN",9.8,"NM",2,0)
RMPR9CA^^0^B59574365
"BLD",6510,"KRN",9.8,"NM",3,0)
RMPR9DO^^0^B90495875
"BLD",6510,"KRN",9.8,"NM",6,0)
RMPRSP7^^0^B22861827
"BLD",6510,"KRN",9.8,"NM",7,0)
RMPREOU^^0^B17695537
"BLD",6510,"KRN",9.8,"NM","B","RMPR9CA",2)

"BLD",6510,"KRN",9.8,"NM","B","RMPR9DO",3)

"BLD",6510,"KRN",9.8,"NM","B","RMPREOS",1)

"BLD",6510,"KRN",9.8,"NM","B","RMPREOU",7)

"BLD",6510,"KRN",9.8,"NM","B","RMPRSP7",6)

"BLD",6510,"KRN",19,0)
19
"BLD",6510,"KRN",19,"NM",0)
^9.68A^^
"BLD",6510,"KRN",19.1,0)
19.1
"BLD",6510,"KRN",101,0)
101
"BLD",6510,"KRN",409.61,0)
409.61
"BLD",6510,"KRN",771,0)
771
"BLD",6510,"KRN",870,0)
870
"BLD",6510,"KRN",8989.51,0)
8989.51
"BLD",6510,"KRN",8989.52,0)
8989.52
"BLD",6510,"KRN",8994,0)
8994
"BLD",6510,"KRN","B",.4,.4)

"BLD",6510,"KRN","B",.401,.401)

"BLD",6510,"KRN","B",.402,.402)

"BLD",6510,"KRN","B",.403,.403)

"BLD",6510,"KRN","B",.5,.5)

"BLD",6510,"KRN","B",.84,.84)

"BLD",6510,"KRN","B",3.6,3.6)

"BLD",6510,"KRN","B",3.8,3.8)

"BLD",6510,"KRN","B",9.2,9.2)

"BLD",6510,"KRN","B",9.8,9.8)

"BLD",6510,"KRN","B",19,19)

"BLD",6510,"KRN","B",19.1,19.1)

"BLD",6510,"KRN","B",101,101)

"BLD",6510,"KRN","B",409.61,409.61)

"BLD",6510,"KRN","B",771,771)

"BLD",6510,"KRN","B",870,870)

"BLD",6510,"KRN","B",8989.51,8989.51)

"BLD",6510,"KRN","B",8989.52,8989.52)

"BLD",6510,"KRN","B",8994,8994)

"BLD",6510,"QUES",0)
^9.62^^
"BLD",6510,"REQB",0)
^9.611^3^3
"BLD",6510,"REQB",1,0)
RMPR*3.0*97^2
"BLD",6510,"REQB",2,0)
RMPR*3.0*60^2
"BLD",6510,"REQB",3,0)
RMPR*3.0*59^2
"BLD",6510,"REQB","B","RMPR*3.0*59",3)

"BLD",6510,"REQB","B","RMPR*3.0*60",2)

"BLD",6510,"REQB","B","RMPR*3.0*97",1)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
135^3070921
"PKG",101,22,1,"PAH",1,1,0)
^^7^7^3070921
"PKG",101,22,1,"PAH",1,1,1,0)
1.  Status of original consult changes from closed to active when it is
"PKG",101,22,1,"PAH",1,1,2,0)
    cloned and a Post Initial Action action occurs.
"PKG",101,22,1,"PAH",1,1,3,0)
 
"PKG",101,22,1,"PAH",1,1,4,0)
2.  Prosthetics ordering issue for multiple orders against suspense
"PKG",101,22,1,"PAH",1,1,5,0)
    record.
"PKG",101,22,1,"PAH",1,1,6,0)
 
"PKG",101,22,1,"PAH",1,1,7,0)
3.  Prosthetics GUI Delayed Order Report problem.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","RMPR9CA")
0^2^B59574365^B59700154
"RTN","RMPR9CA",1,0)
RMPR9CA ;OI-HINES/HNC -SUSPENSE RPC;12/27/2004
"RTN","RMPR9CA",2,0)
 ;;3.0;PROSTHETICS;**90,135**;Feb 09, 1996;Build 12
"RTN","RMPR9CA",3,0)
A1 ;roll and scroll entry point
"RTN","RMPR9CA",4,0)
 G A2
"RTN","RMPR9CA",5,0)
EN(RESULTS,RMIE68,RMPRDUZ,RMSUSTAT,RMPR664,RMPRTXT) ;RPC entry point
"RTN","RMPR9CA",6,0)
A2 ;
"RTN","RMPR9CA",7,0)
 S RESULTS(0)=""
"RTN","RMPR9CA",8,0)
 K ^TMP($J)
"RTN","RMPR9CA",9,0)
 ;
"RTN","RMPR9CA",10,0)
CONT ;RMSUSTAT is status 1=complete or 0=incomplete or 2=pending (incomplete)
"RTN","RMPR9CA",11,0)
 ;
"RTN","RMPR9CA",12,0)
 S RMIE=0
"RTN","RMPR9CA",13,0)
 F  S RMIE=$O(^RMPR(664,RMPR664,1,RMIE)) Q:RMIE'>0  D
"RTN","RMPR9CA",14,0)
 .S RMIE60=$P(^RMPR(664,RMPR664,1,RMIE,0),U,13)
"RTN","RMPR9CA",15,0)
 .S ^TMP($J,RMIE60)=""
"RTN","RMPR9CA",16,0)
 .D FD,UPD
"RTN","RMPR9CA",17,0)
 I RMSUSTAT=1 D CNOTE,FD
"RTN","RMPR9CA",18,0)
 I RMSUSTAT=0 D INOTE,FD
"RTN","RMPR9CA",19,0)
 I RMSUSTAT=2 D ONOTE,FD
"RTN","RMPR9CA",20,0)
 ;set status
"RTN","RMPR9CA",21,0)
 Q
"RTN","RMPR9CA",22,0)
CNOTE ;(#12) COMPLETION NOTE
"RTN","RMPR9CA",23,0)
 ;set file 668
"RTN","RMPR9CA",24,0)
 ;^RMPR(668,D0,4,0)=^668.012^^
"RTN","RMPR9CA",25,0)
 ;if status is close, or 1
"RTN","RMPR9CA",26,0)
 ;RMPRTXT ;load into field #12
"RTN","RMPR9CA",27,0)
 ;^RMPR(668,D0,4,D1,0)
"RTN","RMPR9CA",28,0)
 ;
"RTN","RMPR9CA",29,0)
 I $P(^RMPR(668,RMIE68,0),U,10)="C" S RESULTS(0)="0^This Suspense has already been Closed!"
"RTN","RMPR9CA",30,0)
 S DA=RMIE68
"RTN","RMPR9CA",31,0)
 D NOW^%DTC S RMPREODT=%,GMRCAD=%
"RTN","RMPR9CA",32,0)
 S DIE="^RMPR(668,"
"RTN","RMPR9CA",33,0)
 S DR="5////^S X=RMPREODT;6////^S X=DUZ;14///^S X=""C""" D ^DIE
"RTN","RMPR9CA",34,0)
 N RMPRC
"RTN","RMPR9CA",35,0)
 S L="",LN=0
"RTN","RMPR9CA",36,0)
 F  S L=$O(RMPRTXT(L)) Q:L=""  D
"RTN","RMPR9CA",37,0)
 . I 'LN D  Q:RMPRC=""  ;strip leading space from 1st line, ignore blank line
"RTN","RMPR9CA",38,0)
 .. S RMPRC=$E($TR(RMPRTXT(L)," ","")) ;1st non space char
"RTN","RMPR9CA",39,0)
 .. S:RMPRC'="" RMPRTXT(L)=$E(RMPRTXT(L),$F(RMPRTXT(L),RMPRC)-1,$L(RMPRTXT(L))) ;extract from 1st non space char to end of line
"RTN","RMPR9CA",40,0)
 .. Q
"RTN","RMPR9CA",41,0)
 . S LN=LN+1,^RMPR(668,RMIE68,4,LN,0)=RMPRTXT(L)
"RTN","RMPR9CA",42,0)
 . Q
"RTN","RMPR9CA",43,0)
 S $P(^RMPR(668,RMIE68,4,0),"^",3)=LN
"RTN","RMPR9CA",44,0)
 K L,LN
"RTN","RMPR9CA",45,0)
 ;S DA=RMIE68,DIK="^RMPR(668," D IX1^DIK
"RTN","RMPR9CA",46,0)
 I '$P(^RMPR(668,DA,0),U,9) D
"RTN","RMPR9CA",47,0)
 .S DIE="^RMPR(668,"
"RTN","RMPR9CA",48,0)
 .S DR="7///^S X=""See Completion Note for Initial Action Taken."""
"RTN","RMPR9CA",49,0)
 .D ^DIE
"RTN","RMPR9CA",50,0)
 .S DR="10////^S X=RMPREODT;16////^S X=DUZ" D ^DIE
"RTN","RMPR9CA",51,0)
 K RMPREODT
"RTN","RMPR9CA",52,0)
 S GMRCO=$P(^RMPR(668,RMIE68,0),U,15)
"RTN","RMPR9CA",53,0)
 I GMRCO="" S RESULTS(0)="0^Completed Manual Suspense Action.  Suspense status has been updated to CLOSED." Q
"RTN","RMPR9CA",54,0)
 S RMPRCOM=0
"RTN","RMPR9CA",55,0)
 F  S RMPRCOM=$O(^RMPR(668,RMIE68,4,RMPRCOM)) Q:RMPRCOM=""  D
"RTN","RMPR9CA",56,0)
 .S GMRCOM(RMPRCOM)=^RMPR(668,RMIE68,4,RMPRCOM,0)
"RTN","RMPR9CA",57,0)
 I $G(GMRCOM)="" S GMRCOM="Not Noted"
"RTN","RMPR9CA",58,0)
 S GMRCSF="U"
"RTN","RMPR9CA",59,0)
 S GMRCA=10
"RTN","RMPR9CA",60,0)
 S GMRCALF="N"
"RTN","RMPR9CA",61,0)
 S GMRCATO=""
"RTN","RMPR9CA",62,0)
 S (GMRCORNP,GMRCDUZ)=DUZ
"RTN","RMPR9CA",63,0)
 S BDC=$$SFILE^GMRCGUIB(.GMRCO,.GMRCA,.GMRCSF,.GMRCORNP,.GMRCDUZ,.GMRCOM,.GMRCALF,.GMRCATO,.GMRCAD)
"RTN","RMPR9CA",64,0)
 I +BDC=1 S RESULTS(0)=1_"^"_$P(BDC,U,2)
"RTN","RMPR9CA",65,0)
 K GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD
"RTN","RMPR9CA",66,0)
 I RESULTS(0)="" S RESULTS(0)="0^Completed Suspense Action, and Posted note to CPRS Consult.  Suspense status has been updated to CLOSED."
"RTN","RMPR9CA",67,0)
 Q
"RTN","RMPR9CA",68,0)
ONOTE ;Other note
"RTN","RMPR9CA",69,0)
 ;set file 668
"RTN","RMPR9CA",70,0)
 ;^RMPR(668,D0,4,0)=^668.012^^
"RTN","RMPR9CA",71,0)
 ;if status is pending, and already initial action note or 0
"RTN","RMPR9CA",72,0)
 ;^RMPR(668,D0,1,D1,0)= (#.01) ACTION DATE [1D] 
"RTN","RMPR9CA",73,0)
 ;RMPRTXT ;load into field #11, #1
"RTN","RMPR9CA",74,0)
 ;^RMPR(668,D0,1,D1,1,0)=^668.111^^  
"RTN","RMPR9CA",75,0)
 ;
"RTN","RMPR9CA",76,0)
 S RMPRDA1=RMIE68,DA(1)=RMIE68,DA=RMIE68
"RTN","RMPR9CA",77,0)
 D NOW^%DTC S X=%,GMRCWHN=%
"RTN","RMPR9CA",78,0)
 S DIC="^RMPR(668,"_RMIE68_",1,"
"RTN","RMPR9CA",79,0)
 S DIC(0)="CQL"
"RTN","RMPR9CA",80,0)
 S DIC("P")="668.011DA"
"RTN","RMPR9CA",81,0)
 S DLAYGO=668
"RTN","RMPR9CA",82,0)
 D ^DIC
"RTN","RMPR9CA",83,0)
 I Y=-1 S RESULTS(0)="1^Error Modifying Record!" Q
"RTN","RMPR9CA",84,0)
 ;S DIE=DIC K DIC
"RTN","RMPR9CA",85,0)
 S (DA,RMPRDA2)=+Y
"RTN","RMPR9CA",86,0)
 ;S DR="1" D ^DIE
"RTN","RMPR9CA",87,0)
 K DIE,DR,Y
"RTN","RMPR9CA",88,0)
 ;S ^RMPR(668,RMIE68,1,0)="^668.011DA^1^1"
"RTN","RMPR9CA",89,0)
 N RMPRC
"RTN","RMPR9CA",90,0)
 S L="",LN=0
"RTN","RMPR9CA",91,0)
 F  S L=$O(RMPRTXT(L)) Q:L=""  D
"RTN","RMPR9CA",92,0)
 . I 'LN D  Q:RMPRC=""  ;strip leading space from 1st line, ignore blank  line
"RTN","RMPR9CA",93,0)
 .. S RMPRC=$E($TR(RMPRTXT(L)," ","")) ;1st non space char
"RTN","RMPR9CA",94,0)
 .. S:RMPRC'="" RMPRTXT(L)=$E(RMPRTXT(L),$F(RMPRTXT(L),RMPRC)-1,$L(RMPRTXT(L))) ;extract from 1st non space char to end of line
"RTN","RMPR9CA",95,0)
 .. Q
"RTN","RMPR9CA",96,0)
 . S LN=LN+1,^RMPR(668,RMIE68,1,RMPRDA2,1,LN,0)=RMPRTXT(L)
"RTN","RMPR9CA",97,0)
 . Q
"RTN","RMPR9CA",98,0)
 S $P(^RMPR(668,RMIE68,1,RMPRDA2,1,0),"^",3)=LN
"RTN","RMPR9CA",99,0)
 K L,LN
"RTN","RMPR9CA",100,0)
 S GMRCO=$P(^RMPR(668,RMIE68,0),U,15)
"RTN","RMPR9CA",101,0)
 I GMRCO="" S RESULTS(0)="0^Completed Manual Suspense Action.  Suspense status has not changed." Q
"RTN","RMPR9CA",102,0)
 S RMPRCOM=0
"RTN","RMPR9CA",103,0)
 F  S RMPRCOM=$O(^RMPR(668,RMIE68,1,RMPRDA2,1,RMPRCOM)) Q:RMPRCOM=""  D
"RTN","RMPR9CA",104,0)
 .S GMRCOM(RMPRCOM)=^RMPR(668,RMIE68,1,RMPRDA2,1,RMPRCOM,0)
"RTN","RMPR9CA",105,0)
 D CMT^GMRCGUIB(.GMRCO,.GMRCOM,"",GMRCWHN,DUZ)
"RTN","RMPR9CA",106,0)
 K DA,RMPRDA1,RMPRDA2,RMPRCOM,GMRCOM,GMRCO,GMRCWHN
"RTN","RMPR9CA",107,0)
 S RESULTS(0)="0^Completed Suspense Action, and Posted note to CPRS Consult.  Suspense status has not changed."
"RTN","RMPR9CA",108,0)
 Q
"RTN","RMPR9CA",109,0)
INOTE ;initial action note
"RTN","RMPR9CA",110,0)
 ;set file 668
"RTN","RMPR9CA",111,0)
 ;^RMPR(668,D0,3,0)=^668.07^^
"RTN","RMPR9CA",112,0)
 ;if status is pending, or 0
"RTN","RMPR9CA",113,0)
 ;RMPRTXT ;load into field #7
"RTN","RMPR9CA",114,0)
 ;^RMPR(668,D0,3,0)=^668.07^^
"RTN","RMPR9CA",115,0)
 ;
"RTN","RMPR9CA",116,0)
 I $D(^RMPR(668,RMIE68,3,1,0)) S RESULTS(0)="1^Initial Action Note Already Posted!" Q
"RTN","RMPR9CA",117,0)
 D NOW^%DTC S RMPREODT=%
"RTN","RMPR9CA",118,0)
 N RMPRC
"RTN","RMPR9CA",119,0)
 S ^RMPR(668,RMIE68,3,0)="^^^"_DT_"^"
"RTN","RMPR9CA",120,0)
 S L="",LN=0
"RTN","RMPR9CA",121,0)
 F  S L=$O(RMPRTXT(L)) Q:L=""  D
"RTN","RMPR9CA",122,0)
 . I 'LN D  Q:RMPRC=""  ;strip leading space from 1st line, ignore blank  line
"RTN","RMPR9CA",123,0)
 .. S RMPRC=$E($TR(RMPRTXT(L)," ","")) ;1st non space char
"RTN","RMPR9CA",124,0)
 .. S:RMPRC'="" RMPRTXT(L)=$E(RMPRTXT(L),$F(RMPRTXT(L),RMPRC)-1,$L(RMPRTXT(L))) ;extract from 1st non space char to end of line
"RTN","RMPR9CA",125,0)
 .. Q
"RTN","RMPR9CA",126,0)
 . S LN=LN+1,^RMPR(668,RMIE68,3,LN,0)=RMPRTXT(L)
"RTN","RMPR9CA",127,0)
 . Q
"RTN","RMPR9CA",128,0)
 S $P(^RMPR(668,RMIE68,3,0),"^",3)=LN
"RTN","RMPR9CA",129,0)
 K L,LN
"RTN","RMPR9CA",130,0)
 S DIE="^RMPR(668,"
"RTN","RMPR9CA",131,0)
 S DA=RMIE68
"RTN","RMPR9CA",132,0)
 S DR="10////^S X=RMPREODT;16////^S X=DUZ;14///^S X=""P"""
"RTN","RMPR9CA",133,0)
 D ^DIE
"RTN","RMPR9CA",134,0)
 S GMRCO=$P(^RMPR(668,RMIE68,0),U,15)
"RTN","RMPR9CA",135,0)
 I GMRCO="" S RESULTS(0)="0^Completed Manual Suspense Action.  Suspense status has been updated to PENDING" Q
"RTN","RMPR9CA",136,0)
 S RMPRCMT=0
"RTN","RMPR9CA",137,0)
 F  S RMPRCMT=$O(^RMPR(668,RMIE68,3,RMPRCMT)) Q:RMPRCMT=""  D
"RTN","RMPR9CA",138,0)
 .S GMRCMT(RMPRCMT)=^RMPR(668,RMIE68,3,RMPRCMT,0)
"RTN","RMPR9CA",139,0)
 D CMT^GMRCGUIB(GMRCO,.GMRCMT,DUZ,RMPREODT,DUZ)
"RTN","RMPR9CA",140,0)
 K RMPREODT,GMRCO,RMGMRCO,GMRCMT,RMPRCMT
"RTN","RMPR9CA",141,0)
 S RESULTS(0)="0^Completed Suspense Action, and Posted note to CPRS Consult.  Suspense status has changed to PENDING."
"RTN","RMPR9CA",142,0)
 Q
"RTN","RMPR9CA",143,0)
 ;
"RTN","RMPR9CA",144,0)
FD ;file date
"RTN","RMPR9CA",145,0)
 N DIE,DIC,I,J,Y,RMDFN,RMI,RMDATE,RM680,RM6810,RMERROR,RM60L,RC
"RTN","RMPR9CA",146,0)
 N RMERR,RMCHK,DLAYGO,X,DR,RM668,RM60DAT,RMSTATUS
"RTN","RMPR9CA",147,0)
 N RM68CNT,RM60CNT,RMSI,RMSAMIS,RM68IEN,RM60IEN,RMSUS60,RMSUS68,RMD
"RTN","RMPR9CA",148,0)
 N RM68DATA,RM60TYP,RM68D,RM68TRAN,RMPRPRC,RM60IT,RMENTSUS,RMQUIT
"RTN","RMPR9CA",149,0)
 ;
"RTN","RMPR9CA",150,0)
 S RMERR=0
"RTN","RMPR9CA",151,0)
 S:RMSUSTAT="" RMSUSTAT=0
"RTN","RMPR9CA",152,0)
 L +^RMPR(660,RMIE60):2
"RTN","RMPR9CA",153,0)
 I $T=0 S RESULTS(0)="1^Someone else is Editing this entry!" G EXIT
"RTN","RMPR9CA",154,0)
 S RM680=$G(^RMPR(668,RMIE68,0))
"RTN","RMPR9CA",155,0)
 S RM688=$G(^RMPR(668,RMIE68,8))
"RTN","RMPR9CA",156,0)
 S RM6810=$G(^RMPR(668,RMIE68,10))
"RTN","RMPR9CA",157,0)
 S RMAMIS=$P($G(^RMPR(660,RMIE60,"AMS")),U,1)
"RTN","RMPR9CA",158,0)
 ;code here for 668 fields
"RTN","RMPR9CA",159,0)
 S RMDATE=$P(RM680,U,1)
"RTN","RMPR9CA",160,0)
 S RMCODT=$P(RM680,U,5)
"RTN","RMPR9CA",161,0)
 S RMINDT=$P(RM680,U,9)
"RTN","RMPR9CA",162,0)
 S RMPRCO=$P(RM680,U,15)
"RTN","RMPR9CA",163,0)
 S RMDWRT=$P(RM680,U,16)
"RTN","RMPR9CA",164,0)
 S RMSTAT=$P(RM680,U,7)
"RTN","RMPR9CA",165,0)
 S RMTRES=$P(RM680,U,8)
"RTN","RMPR9CA",166,0)
 S RMTYRE=$S(RMTRES=1:"ROUTINE",RMTRES=2:"EYEGLASS",RMTRES=3:"CONTACT LENS",RMTRES=4:"OXYGEN",RMTRES=5:"MANUAL",1:"")
"RTN","RMPR9CA",167,0)
 S RMREQU=$P(RM680,U,11)
"RTN","RMPR9CA",168,0)
 S RMSERV=""
"RTN","RMPR9CA",169,0)
 I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPR9CA",170,0)
 S RMPRDI=$E($P(RM688,U,2),1,16)
"RTN","RMPR9CA",171,0)
 S RMICD9=$P(RM688,U,3)
"RTN","RMPR9CA",172,0)
 ;
"RTN","RMPR9CA",173,0)
 S RMDAT(660,RMIE60_",",8.1)=RMDATE
"RTN","RMPR9CA",174,0)
 S RMDAT(660,RMIE60_",",8.2)=RMDWRT
"RTN","RMPR9CA",175,0)
 S RMDAT(660,RMIE60_",",8.3)=RMINDT
"RTN","RMPR9CA",176,0)
 S RMDAT(660,RMIE60_",",8.4)=RMCODT
"RTN","RMPR9CA",177,0)
 S RMDAT(660,RMIE60_",",8.5)=RMTYRE
"RTN","RMPR9CA",178,0)
 S RMDAT(660,RMIE60_",",8.6)=RMREQU
"RTN","RMPR9CA",179,0)
 S RMDAT(660,RMIE60_",",8.61)=RMSERV
"RTN","RMPR9CA",180,0)
 S RMDAT(660,RMIE60_",",8.7)=RMPRDI
"RTN","RMPR9CA",181,0)
 S RMDAT(660,RMIE60_",",8.8)=RMICD9
"RTN","RMPR9CA",182,0)
 S RMDAT(660,RMIE60_",",8.9)=RMPRCO
"RTN","RMPR9CA",183,0)
 S RMDAT(660,RMIE60_",",8.11)=RMSTAT
"RTN","RMPR9CA",184,0)
 I RMSUSTAT=2 S RMDAT(660,RMIE60_",",8.14)=0
"RTN","RMPR9CA",185,0)
 I RMSUSTAT'=2 S RMDAT(660,RMIE60_",",8.14)=RMSUSTAT
"RTN","RMPR9CA",186,0)
 D FILE^DIE("","RMDAT","RMERROR")
"RTN","RMPR9CA",187,0)
 I $D(RMERROR) S RMERR=1 D ERR
"RTN","RMPR9CA",188,0)
 ;
"RTN","RMPR9CA",189,0)
 L -^RMPR(660,RMIE60)
"RTN","RMPR9CA",190,0)
 Q
"RTN","RMPR9CA",191,0)
UPD ;update file 668 with 2319 records
"RTN","RMPR9CA",192,0)
 S DA(1)=RMIE68
"RTN","RMPR9CA",193,0)
 S DIC="^RMPR(668,"_DA(1)_","_"10,"
"RTN","RMPR9CA",194,0)
 S DIC(0)="L",DLAYGO=668,X=RMIE60
"RTN","RMPR9CA",195,0)
 D FILE^DICN
"RTN","RMPR9CA",196,0)
 S DA(1)=RMIE68
"RTN","RMPR9CA",197,0)
 S DIC="^RMPR(668,"_DA(1)_","_"11,"
"RTN","RMPR9CA",198,0)
 S X=RMAMIS
"RTN","RMPR9CA",199,0)
 D FILE^DICN
"RTN","RMPR9CA",200,0)
 K DIC,X,DLAYGO
"RTN","RMPR9CA",201,0)
 Q
"RTN","RMPR9CA",202,0)
A3 G A4
"RTN","RMPR9CA",203,0)
EN1(RESULTS,DA) ;Broker entry to kill PO
"RTN","RMPR9CA",204,0)
 ;DA is passed
"RTN","RMPR9CA",205,0)
 S DIK="^RMPR(664," D ^DIK
"RTN","RMPR9CA",206,0)
 K DIK
"RTN","RMPR9CA",207,0)
A4 ;
"RTN","RMPR9CA",208,0)
 Q
"RTN","RMPR9CA",209,0)
ERR ;exit on error
"RTN","RMPR9CA",210,0)
EXIT ;
"RTN","RMPR9CA",211,0)
 K RMTYRE,RMTRES,RMSUSTAT,RMSTAT,RMSERV,RMEQU,RMPRTST,RMPRDUZ,RMPRDI,RMPRCO,RMPR664,RMIE68
"RTN","RMPR9CA",212,0)
 K RMIE60,RMIE,RMICD9,RMDWRT,RMDAT,RMCODT,RMAMIS,RMAA,RM688,RMPRTXT
"RTN","RMPR9CA",213,0)
 K BDC,BAD,%,RMINDT,RMPREQU
"RTN","RMPR9DO")
0^3^B90495875^B88978694
"RTN","RMPR9DO",1,0)
RMPR9DO ;HOIFO/HNC -  ORDER CONROL PROCESSING-REMOTE PROCEDURE ;9/8/03  07:12
"RTN","RMPR9DO",2,0)
 ;;3.0;PROSTHETICS;**59,77,90,60,135**;Feb 09, 1996;Build 12
"RTN","RMPR9DO",3,0)
 ;
"RTN","RMPR9DO",4,0)
 ;8/5/03 Make sure no dups, HNC patch 77
"RTN","RMPR9DO",5,0)
 ;
"RTN","RMPR9DO",6,0)
A1(START,STOP,SITE,SORT,DATE,WHAT) ;entry point for rollup
"RTN","RMPR9DO",7,0)
 ;activated from (option name)
"RTN","RMPR9DO",8,0)
 I WHAT="S" D
"RTN","RMPR9DO",9,0)
 .S STN1=0
"RTN","RMPR9DO",10,0)
 .F  S STN1=$O(^RMPR(669.9,STN1)) Q:STN1'>0  D
"RTN","RMPR9DO",11,0)
 . .S SITE=STN1
"RTN","RMPR9DO",12,0)
 . .D A2
"RTN","RMPR9DO",13,0)
 I WHAT="ALL" G A2
"RTN","RMPR9DO",14,0)
 Q
"RTN","RMPR9DO",15,0)
EN(RESULT,DUZ,START,STOP,SITE,SORT,DATE,RMPRPRSN) ; -- Broker callback to get list to display
"RTN","RMPR9DO",16,0)
 ;entry to send to PCM, WHAT=ALL or S for Summary Only
"RTN","RMPR9DO",17,0)
 ;RMPRPRSN=P for Purchasing D for Delayed Order Report
"RTN","RMPR9DO",18,0)
 S (WHO,RMPRSC)=""
"RTN","RMPR9DO",19,0)
 I RMPRPRSN="P" S RMPRSC=$O(^RMPR(669.9,"PA",DUZ,RMPRSC)) Q:(RMPRSC="")!(WHO'="")  D
"RTN","RMPR9DO",20,0)
 . I '$D(^RMPR(669.9,RMPRSC,0)) Q
"RTN","RMPR9DO",21,0)
 . I '$D(^RMPR(669.9,RMPRSC,5,"B",DUZ)) Q
"RTN","RMPR9DO",22,0)
 . S WHO=$O(^RMPR(669.9,RMPRSC,5,"B",DUZ,""))
"RTN","RMPR9DO",23,0)
 . I START="" S START=$P(^RMPR(669.9,RMPRSC,5,WHO,0),U,2)
"RTN","RMPR9DO",24,0)
 . I STOP="" S STOP=$P(^RMPR(669.9,RMPRSC,5,WHO,0),U,3)
"RTN","RMPR9DO",25,0)
A2 N STRING,CLREND,COLUMN,ON,OFF
"RTN","RMPR9DO",26,0)
 Q:SORT=""
"RTN","RMPR9DO",27,0)
 Q:DATE=""
"RTN","RMPR9DO",28,0)
 Q:START=""
"RTN","RMPR9DO",29,0)
 Q:STOP=""
"RTN","RMPR9DO",30,0)
 Q:SITE=""
"RTN","RMPR9DO",31,0)
 I SITE'="ALL" S SITE=$P(^RMPR(669.9,SITE,0),U,2)
"RTN","RMPR9DO",32,0)
 K ^TMP($J)
"RTN","RMPR9DO",33,0)
 N RMPRA,CDATE,X
"RTN","RMPR9DO",34,0)
 K ADATE,PDAY,RMPRCD
"RTN","RMPR9DO",35,0)
 S VALMCNT=0,RRX=""
"RTN","RMPR9DO",36,0)
 ;if sort for open or pending include all regardless of date
"RTN","RMPR9DO",37,0)
 ;if sort for cancelled or closed include from date passed forward
"RTN","RMPR9DO",38,0)
 ;
"RTN","RMPR9DO",39,0)
 ;PPD# status=pending before date, total days create to 1st action
"RTN","RMPR9DO",40,0)
 ;MHD# manual totals days create to 1st action
"RTN","RMPR9DO",41,0)
 ;CHD# consult totals days create to 1st action
"RTN","RMPR9DO",42,0)
 ;PPDD# status=pending before date, total days in pending state, 1st
"RTN","RMPR9DO",43,0)
 ;      action to current date
"RTN","RMPR9DO",44,0)
 ;
"RTN","RMPR9DO",45,0)
 S (LINE,MHD1,MHD2,MHD3,MHD4,MHD5,CHD1,CHD2,CHD3,CHD4,CHD5,CLNK,MLNK)=0
"RTN","RMPR9DO",46,0)
 S (PPDAY,PPD,PPD1,PPD2,PPD3,PPD4,PPD5)=0
"RTN","RMPR9DO",47,0)
 S (PPDDAY,PPDD1,PPDD2,PPDD3,PPDD4,PPDD5)=0
"RTN","RMPR9DO",48,0)
 I SORT["O"!(SORT["P") D ALL
"RTN","RMPR9DO",49,0)
 I SORT["C"!(SORT["X") D DTFWD
"RTN","RMPR9DO",50,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",51,0)
 S ^TMP($J,"A1")="^^^^^^^^"_MHD1_U_MHD2_U_MHD3_U_MHD4_U_MHD5_"^^^^"_MLNK_U_0
"RTN","RMPR9DO",52,0)
 I $G(WHAT)="S" S RMPRXM(1)=MHD1_U_MHD2_U_MHD3_U_MHD4_U_MHD5_U_MLNK_U_0
"RTN","RMPR9DO",53,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",54,0)
 S ^TMP($J,"A2")="^^^^^^^^"_CHD1_U_CHD2_U_CHD3_U_CHD4_U_CHD5_"^^^^"_CLNK_U_1
"RTN","RMPR9DO",55,0)
 I $G(WHAT)="S" S RMPRXM(2)=CHD1_U_CHD2_U_CHD3_U_CHD4_U_CHD5_U_CLNK_U_1
"RTN","RMPR9DO",56,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",57,0)
 I $G(WHAT)="S" S RMPRXM(3)=PPD1_U_PPD2_U_PPD3_U_PPD4_U_PPD5_U_U_2
"RTN","RMPR9DO",58,0)
 S ^TMP($J,"A3")="^^^^^^^^"_PPDD1_U_PPDD2_U_PPDD3_U_PPDD4_U_PPDD5_"^^^^^"_2
"RTN","RMPR9DO",59,0)
 ;S LINE=LINE+1
"RTN","RMPR9DO",60,0)
 S ^TMP($J,"A4")="^^^^^^^^"_PPD1_U_PPD2_U_PPD3_U_PPD4_U_PPD5_"^^^^^"_3
"RTN","RMPR9DO",61,0)
 ;quarter rollup with full data
"RTN","RMPR9DO",62,0)
 I $G(WHAT)="Q" D MAIL
"RTN","RMPR9DO",63,0)
 ;summary only
"RTN","RMPR9DO",64,0)
 I $G(WHAT)="S" D MAILG
"RTN","RMPR9DO",65,0)
 I $G(WHAT)="ALL" D MAILG,MAIL
"RTN","RMPR9DO",66,0)
 I '$G(WHAT) G EXIT
"RTN","RMPR9DO",67,0)
 Q
"RTN","RMPR9DO",68,0)
ALL ;all open pending records regardless of date passed
"RTN","RMPR9DO",69,0)
 S RMPRI1=0
"RTN","RMPR9DO",70,0)
 F RMPRI1=START:1:STOP D
"RTN","RMPR9DO",71,0)
 .I $L(RMPRI1)=1 S RMPRI=0_RMPRI1
"RTN","RMPR9DO",72,0)
 .E  S RMPRI=RMPRI1
"RTN","RMPR9DO",73,0)
 .S RMPRST=""
"RTN","RMPR9DO",74,0)
 .F  S RMPRST=$O(^RMPR(668,"L1",RMPRI,RMPRST)) Q:RMPRST=""  D
"RTN","RMPR9DO",75,0)
 . .Q:RMPRST="X"
"RTN","RMPR9DO",76,0)
 . .Q:RMPRST="C"
"RTN","RMPR9DO",77,0)
 . .I SORT'["P"&(RMPRST="P") Q
"RTN","RMPR9DO",78,0)
 . .S RMPRA=0
"RTN","RMPR9DO",79,0)
 . .F  S RMPRA=$O(^RMPR(668,"L1",RMPRI,RMPRST,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",80,0)
 . . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",81,0)
 . . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",82,0)
 . . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",83,0)
 . . .I $G(WHAT)="S" S VISNX=$P($G(^RMPR(669.9,STN1,"INV")),U,2)
"RTN","RMPR9DO",84,0)
 . . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",85,0)
 . . .Q:STS["X"
"RTN","RMPR9DO",86,0)
 . . .Q:STS["C"
"RTN","RMPR9DO",87,0)
 . . .I SORT'["O"&(STS="O") Q
"RTN","RMPR9DO",88,0)
 . . .I SORT'["P"&(STS="P") Q
"RTN","RMPR9DO",89,0)
 . . .D REC
"RTN","RMPR9DO",90,0)
 Q
"RTN","RMPR9DO",91,0)
DTFWD ;from date passed forward
"RTN","RMPR9DO",92,0)
 S RMPRI1=0
"RTN","RMPR9DO",93,0)
 F RMPRI1=START:1:STOP D
"RTN","RMPR9DO",94,0)
 .I $L(RMPRI1)=1 S RMPRI=0_RMPRI1
"RTN","RMPR9DO",95,0)
 .E  S RMPRI=RMPRI1
"RTN","RMPR9DO",96,0)
 .S RMPRDTM=""
"RTN","RMPR9DO",97,0)
 .F  S RMPRDTM=$O(^RMPR(668,"L",RMPRI,RMPRDTM)) Q:RMPRDTM=""  D
"RTN","RMPR9DO",98,0)
 ..Q:RMPRDTM=""
"RTN","RMPR9DO",99,0)
 ..Q:RMPRDTM<DATE
"RTN","RMPR9DO",100,0)
 ..S RMPRST=""
"RTN","RMPR9DO",101,0)
 ..F  S RMPRST=$O(^RMPR(668,"L",RMPRI,RMPRDTM,RMPRST)) Q:RMPRST=""  D
"RTN","RMPR9DO",102,0)
 .. .Q:RMPRST="O"
"RTN","RMPR9DO",103,0)
 .. .Q:RMPRST="P"
"RTN","RMPR9DO",104,0)
 .. .I SORT'["X"&(RMPRST="X") Q
"RTN","RMPR9DO",105,0)
 .. .I SORT'["C"&(RMPRST="C") Q
"RTN","RMPR9DO",106,0)
 .. .S RMPRA=0
"RTN","RMPR9DO",107,0)
 .. .F  S RMPRA=$O(^RMPR(668,"L",RMPRI,RMPRDTM,RMPRST,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",108,0)
 .. . .Q:RMPRA=""
"RTN","RMPR9DO",109,0)
 .. . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",110,0)
 .. . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",111,0)
 .. . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",112,0)
 .. . .I $G(WHAT)'="" S VISNX=$P($G(^RMPR(669.9,SITE,"INV")),U,2)
"RTN","RMPR9DO",113,0)
 .. . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",114,0)
 .. . .Q:STS["O"
"RTN","RMPR9DO",115,0)
 .. . .Q:STS["P"
"RTN","RMPR9DO",116,0)
 .. . .I SORT'["C"&(STS="C") Q
"RTN","RMPR9DO",117,0)
 .. . .I SORT'["X"&(STS="X") Q
"RTN","RMPR9DO",118,0)
 .. . .D REC
"RTN","RMPR9DO",119,0)
 S RMPRDTC=$P(DATE,".",1)
"RTN","RMPR9DO",120,0)
 F  S RMPRDTC=$O(^RMPR(668,"CD",RMPRDTC)) Q:RMPRDTC=""  D
"RTN","RMPR9DO",121,0)
 .Q:RMPRDTC<DATE
"RTN","RMPR9DO",122,0)
 .S RMPRDYS=0
"RTN","RMPR9DO",123,0)
 .F  S RMPRDYS=$O(^RMPR(668,"CD",RMPRDTC,RMPRDYS)) Q:RMPRDYS=""  D
"RTN","RMPR9DO",124,0)
 . .Q:RMPRDYS'>5
"RTN","RMPR9DO",125,0)
 . .S RMPRA=0
"RTN","RMPR9DO",126,0)
 . .F  S RMPRA=$O(^RMPR(668,"CD",RMPRDTC,RMPRDYS,RMPRA)) Q:RMPRA'>0  D
"RTN","RMPR9DO",127,0)
 . . .;check site
"RTN","RMPR9DO",128,0)
 . . .S STN=$P(^RMPR(668,RMPRA,0),U,7)
"RTN","RMPR9DO",129,0)
 . . .I SITE'="ALL"&(SITE'=STN) Q
"RTN","RMPR9DO",130,0)
 . . .S STNX=$$STATN^RMPRUTIL(STN)
"RTN","RMPR9DO",131,0)
 . . .;check status
"RTN","RMPR9DO",132,0)
 . . .S STS=$P(^RMPR(668,RMPRA,0),U,10)
"RTN","RMPR9DO",133,0)
 . . .I SORT'["O"&(STS="O") Q
"RTN","RMPR9DO",134,0)
 . . .I SORT'["P"&(STS="P") Q
"RTN","RMPR9DO",135,0)
 . . .I SORT'["C"&(STS="C") Q
"RTN","RMPR9DO",136,0)
 . . .I SORT'["X"&(STS="X") Q
"RTN","RMPR9DO",137,0)
 . . .;ssn range filter
"RTN","RMPR9DO",138,0)
 . . .S DFN=$P(^RMPR(668,RMPRA,0),U,2)
"RTN","RMPR9DO",139,0)
 . . .D DEM^VADPT
"RTN","RMPR9DO",140,0)
 . . .S SSNEN=$E($P(VADM(2),"^",2),10,11)
"RTN","RMPR9DO",141,0)
 . . .I SSNEN>STOP Q
"RTN","RMPR9DO",142,0)
 . . .I SSNEN<START Q
"RTN","RMPR9DO",143,0)
 . . .K SSNEN,VADM
"RTN","RMPR9DO",144,0)
 . . .D REC
"RTN","RMPR9DO",145,0)
 Q
"RTN","RMPR9DO",146,0)
REC ;records to grid
"RTN","RMPR9DO",147,0)
 ;stop date, init action date
"RTN","RMPR9DO",148,0)
 ;check ien, patch 77
"RTN","RMPR9DO",149,0)
 ;
"RTN","RMPR9DO",150,0)
 Q:$D(^TMP($J,RMPRA))
"RTN","RMPR9DO",151,0)
 ;
"RTN","RMPR9DO",152,0)
 N DIC,DIQ,DR,STOPDT
"RTN","RMPR9DO",153,0)
 S DA=RMPRA
"RTN","RMPR9DO",154,0)
 S DIC=668,DIQ="RE",DR=10,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPR9DO",155,0)
 S STOPDT=$P($G(^RMPR(668,RMPRA,0)),U,9),STOPDT=$$DAT2^RMPRUTL1(STOPDT)
"RTN","RMPR9DO",156,0)
 S LINE=LINE+1
"RTN","RMPR9DO",157,0)
 S CDATE=$P(^RMPR(668,RMPRA,0),U,1),CDATE=$$DAT2^RMPRUTL1(CDATE)
"RTN","RMPR9DO",158,0)
 S DFN=$P(^RMPR(668,RMPRA,0),U,2) Q:DFN=""
"RTN","RMPR9DO",159,0)
 N VA,VADM
"RTN","RMPR9DO",160,0)
 D DEM^VADPT
"RTN","RMPR9DO",161,0)
 S WHO=VADM(1)
"RTN","RMPR9DO",162,0)
 S SSN=VADM(2)
"RTN","RMPR9DO",163,0)
 D SVC^VADPT
"RTN","RMPR9DO",164,0)
 S RMPROEOI=$S(VASV(11)>0:"<!>",VASV(12)>0:"<!>",VASV(13)>0:"<!>",1:0)
"RTN","RMPR9DO",165,0)
 D KVAR^VADPT
"RTN","RMPR9DO",166,0)
 ;type
"RTN","RMPR9DO",167,0)
 S TYPE=$$TYPE^RMPREOU(RMPRA,8)
"RTN","RMPR9DO",168,0)
 ;display description if manual
"RTN","RMPR9DO",169,0)
 S DES=$$DES^RMPREOU(RMPRA,22)
"RTN","RMPR9DO",170,0)
 S DES=$TR(DES,"^","*")
"RTN","RMPR9DO",171,0)
 S DES=$TR(DES,"""","'")
"RTN","RMPR9DO",172,0)
 ;init action date
"RTN","RMPR9DO",173,0)
 S ADATE="",PDAY="",WRKDAY=""
"RTN","RMPR9DO",174,0)
 S ADATE=$P(^RMPR(668,RMPRA,0),U,9)
"RTN","RMPR9DO",175,0)
 ;PPD=1 for previous pending
"RTN","RMPR9DO",176,0)
 I ADATE'="" S (PDAY,WRKDAY)=$$WRKDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",177,0)
 I ADATE="" S (PDAY,WRKDAY)=$$CWRKDAY^RMPREOU(RMPRA) I $P(^RMPR(668,RMPRA,0),U,10)="X" S (PDAY,WRKDAY)=$$CANWKDY^RMPREOU(RMPRA)
"RTN","RMPR9DO",178,0)
 I ADATE'="" S CDAY=$$PDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",179,0)
 ;
"RTN","RMPR9DO",180,0)
 S STATUS=$$STATUS^RMPREOU(RMPRA)
"RTN","RMPR9DO",181,0)
 I STATUS["PENDING" D
"RTN","RMPR9DO",182,0)
 .I ADATE'=""&(ADATE<DATE) S PPD=1
"RTN","RMPR9DO",183,0)
 .S PPDAY=$$PWRKDAY^RMPREOU(RMPRA)
"RTN","RMPR9DO",184,0)
 S LINKED=$P($G(^RMPR(668,RMPRA,10,0)),U,4)
"RTN","RMPR9DO",185,0)
 I LINKED="" S LINKED=0
"RTN","RMPR9DO",186,0)
 ;
"RTN","RMPR9DO",187,0)
 I RMPROEOI="<!>" S WHO=RMPROEOI_WHO
"RTN","RMPR9DO",188,0)
 S ^TMP($J,RMPRA)=CDATE_U_WHO_U_SSN_U_TYPE_U_DES_U
"RTN","RMPR9DO",189,0)
 ;look at pday and parse
"RTN","RMPR9DO",190,0)
 S (HD1,HD2,HD3,HD4,HD5,DH6)=""
"RTN","RMPR9DO",191,0)
 ;SD Working Days in Pending Status
"RTN","RMPR9DO",192,0)
 S (SD1,SD2,SD3,SD4,SD5)=0
"RTN","RMPR9DO",193,0)
 I (PDAY>0)&(PDAY<6)!(PDAY=0) S HD1=PDAY,DH6="NO"
"RTN","RMPR9DO",194,0)
 I (PPDAY>0)&(PPDAY<6)!(PPDAY=0) S SD1=PPDAY
"RTN","RMPR9DO",195,0)
 I (PDAY>0)&(PDAY<6)&(TYPE["MANUAL")!(PDAY=0)&(TYPE["MANUAL") S MHD1=MHD1+1
"RTN","RMPR9DO",196,0)
 I (PDAY>0)&(PDAY<6)&(TYPE'["MANUAL")!(PDAY=0)&(TYPE'["MANUAL") S CHD1=CHD1+1
"RTN","RMPR9DO",197,0)
 I (PPDAY>0)&(PPDAY<6)&(STATUS["PENDING") S PPDD1=PPDD1+1
"RTN","RMPR9DO",198,0)
 I (PDAY>0)&(PDAY<6)&(PPD=1) S PPD1=PPD1+1
"RTN","RMPR9DO",199,0)
 I HD1=""  S HD1=0
"RTN","RMPR9DO",200,0)
 I (PDAY>5)&(PDAY<10) S HD2=PDAY,DH6="YES"
"RTN","RMPR9DO",201,0)
 I (PPDAY>5)&(PPDAY<10) S SD2=PPDAY
"RTN","RMPR9DO",202,0)
 I (PDAY>5)&(PDAY<10)&(TYPE["MANUAL") S MHD2=MHD2+1
"RTN","RMPR9DO",203,0)
 I (PDAY>5)&(PDAY<10)&(TYPE'["MANUAL") S CHD2=CHD2+1
"RTN","RMPR9DO",204,0)
 I (PPDAY>5)&(PPDAY<10)&(STATUS["PENDING") S PPDD2=PPDD2+1
"RTN","RMPR9DO",205,0)
 I (PDAY>5)&(PDAY<10)&(PPD=1) S PPD2=PPD2+1
"RTN","RMPR9DO",206,0)
 I HD2="" S HD2=0
"RTN","RMPR9DO",207,0)
 I (PDAY>9)&(PDAY<30) S HD3=PDAY,DH6="YES"
"RTN","RMPR9DO",208,0)
 I (PPDAY>9)&(PPDAY<30) S SD3=PPDAY
"RTN","RMPR9DO",209,0)
 I (PDAY>9)&(PDAY<30)&(TYPE["MANUAL") S MHD3=MHD3+1
"RTN","RMPR9DO",210,0)
 I (PDAY>9)&(PDAY<30)&(TYPE'["MANUAL") S CHD3=CHD3+1
"RTN","RMPR9DO",211,0)
 I (PPDAY>9)&(PPDAY<30)&(STATUS["PENDING") S PPDD3=PPDD3+1
"RTN","RMPR9DO",212,0)
 I (PDAY>9)&(PDAY<30)&(PPD=1) S PPD3=PPD3+1
"RTN","RMPR9DO",213,0)
 I HD3="" S HD3=0
"RTN","RMPR9DO",214,0)
 I (PDAY>29)&(PDAY<90) S HD4=PDAY,DH6="YES"
"RTN","RMPR9DO",215,0)
 I (PPDAY>29)&(PPDAY<90) S SD4=PPDAY
"RTN","RMPR9DO",216,0)
 I (PDAY>29)&(PDAY<90)&(TYPE["MANUAL") S MHD4=MHD4+1
"RTN","RMPR9DO",217,0)
 I (PDAY>29)&(PDAY<90)&(TYPE'["MANUAL") S CHD4=CHD4+1
"RTN","RMPR9DO",218,0)
 I (PPDAY>29)&(PPDAY<90)&(STATUS["PENDING") S PPDD4=PPDD4+1
"RTN","RMPR9DO",219,0)
 I (PDAY>29)&(PDAY<90)&(PPD=1) S PPD4=PPD4+1
"RTN","RMPR9DO",220,0)
 I HD4="" S HD4=0
"RTN","RMPR9DO",221,0)
 I PDAY>89 S HD5=PDAY,DH6="YES"
"RTN","RMPR9DO",222,0)
 I PPDAY>89 S SD5=PPDAY
"RTN","RMPR9DO",223,0)
 I (PDAY>89)&(TYPE["MANUAL") S MHD5=MHD5+1
"RTN","RMPR9DO",224,0)
 I (PDAY>89)&(TYPE'["MANUAL") S CHD5=CHD5+1
"RTN","RMPR9DO",225,0)
 I (PPDAY>89)&(STATUS["PENDING") S PPDD5=PPDD5+1
"RTN","RMPR9DO",226,0)
 I (PDAY>89)&(PPD=1) S PPD5=PPD5+1
"RTN","RMPR9DO",227,0)
 I HD5="" S HD5=0
"RTN","RMPR9DO",228,0)
 S (PPD,PPDAY)=0
"RTN","RMPR9DO",229,0)
 I LINKED'=0&(TYPE["MANUAL") S MLNK=MLNK+1
"RTN","RMPR9DO",230,0)
 I LINKED'=0&(TYPE'["MANUAL") S CLNK=CLNK+1
"RTN","RMPR9DO",231,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_STOPDT_U_DH6_U_HD1_U_HD2_U_HD3_U_HD4_U_HD5
"RTN","RMPR9DO",232,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_U_STATUS_U_RMPRA_U_STNX_U_LINKED
"RTN","RMPR9DO",233,0)
 S ^TMP($J,RMPRA)=^TMP($J,RMPRA)_U_U_SD1_U_SD2_U_SD3_U_SD4_U_SD5
"RTN","RMPR9DO",234,0)
 K CDATE,WHO,SSN,TYPE,DES,PDAY,STATUS,ADATE
"RTN","RMPR9DO",235,0)
 ;PUT RESULTS IN GLOBAL!!
"RTN","RMPR9DO",236,0)
 Q
"RTN","RMPR9DO",237,0)
EXIT ;common exit point
"RTN","RMPR9DO",238,0)
 S RESULT=$NA(^TMP($J))
"RTN","RMPR9DO",239,0)
 Q
"RTN","RMPR9DO",240,0)
MAIL ;send to PCM full dataset
"RTN","RMPR9DO",241,0)
 S XMY("G.RMPR SERVER")=""
"RTN","RMPR9DO",242,0)
 S XMY("G.PROSTHETICS@PSAS.MED.VA.GOV")=""
"RTN","RMPR9DO",243,0)
 S XMDUZ=.5
"RTN","RMPR9DO",244,0)
 S XMSUB="Full DOR From Station: "_STNX
"RTN","RMPR9DO",245,0)
 N LASTIEN
"RTN","RMPR9DO",246,0)
 S LASTIEN="A1",LASTIEN=$O(^TMP($J,LASTIEN),-1)
"RTN","RMPR9DO",247,0)
 S ^TMP($J,LASTIEN+1)=^TMP($J,"A1")
"RTN","RMPR9DO",248,0)
 S ^TMP($J,LASTIEN+2)=^TMP($J,"A2")
"RTN","RMPR9DO",249,0)
 S ^TMP($J,LASTIEN+3)=^TMP($J,"A3")
"RTN","RMPR9DO",250,0)
 S ^TMP($J,LASTIEN+4)=^TMP($J,"A4")
"RTN","RMPR9DO",251,0)
 K ^TMP($J,"A1")
"RTN","RMPR9DO",252,0)
 K ^TMP($J,"A2")
"RTN","RMPR9DO",253,0)
 K ^TMP($J,"A3")
"RTN","RMPR9DO",254,0)
 K ^TMP($J,"A4")
"RTN","RMPR9DO",255,0)
 S XMTEXT="^TMP($J,"
"RTN","RMPR9DO",256,0)
 D ^XMD
"RTN","RMPR9DO",257,0)
 Q
"RTN","RMPR9DO",258,0)
MAILG ;Mail message to local staff
"RTN","RMPR9DO",259,0)
 S XMDUZ=.5
"RTN","RMPR9DO",260,0)
 S XMY("G.RMPR SERVER")=""
"RTN","RMPR9DO",261,0)
 S XMY("VHACOPSASPIPReport@MED.VA.GOV")=""
"RTN","RMPR9DO",262,0)
 S XMSUB="DOR From Station: "_STNX
"RTN","RMPR9DO",263,0)
 S RMPRMSG(1)="The Automated Delayed Order Report has transmitted to Prosthetics HQ."
"RTN","RMPR9DO",264,0)
 S RMPRMSG(2)="This was activated by "_$P(XMFROM,"@",1)
"RTN","RMPR9DO",265,0)
 S RMPRMSG(3)=""
"RTN","RMPR9DO",266,0)
 S RMPRMSG(4)="Summary Data Transmitted, includes the following:"
"RTN","RMPR9DO",267,0)
 S RMPRMSG(5)="Totals for site "_STNX_" listed in the order of 0-5, 6-9, 10-29, 30-89, 90+"
"RTN","RMPR9DO",268,0)
 S RMPRMSG(6)="Seperated by ;"
"RTN","RMPR9DO",269,0)
 S RMPRMSG(7)="***Number of MANUALS      ;;"_STNX_";"_MHD1_";"_MHD2_";"_MHD3_";"_MHD4_";"_MHD5
"RTN","RMPR9DO",270,0)
 S RMPRMSG(8)="***Number of CONSULTS     ;;"_STNX_";"_CHD1_";"_CHD2_";"_CHD3_";"_CHD4_";"_CHD5
"RTN","RMPR9DO",271,0)
 S RMPRMSG(9)="***Minus Previous Pending ;;"_STNX_";"_PPD1_";"_PPD2_";"_PPD3_";"_PPD4_";"_PPD5
"RTN","RMPR9DO",272,0)
 S RMPRMSG(10)=""
"RTN","RMPR9DO",273,0)
 S XMTEXT="RMPRMSG("
"RTN","RMPR9DO",274,0)
 D ^XMD
"RTN","RMPR9DO",275,0)
 Q
"RTN","RMPREOS")
0^1^B77412066^B77406409
"RTN","RMPREOS",1,0)
RMPREOS ;HINES-CIOFO/HNC -Suspense Processing ; 2/25/04 10:26am
"RTN","RMPREOS",2,0)
 ;;3.0;PROSTHETICS;**45,50,52,55,57,62,80,85,97,135**;Feb 09, 1996;Build 12
"RTN","RMPREOS",3,0)
 ;
"RTN","RMPREOS",4,0)
 ;  HNC - patch 52 - 9/22/00 Modify EN2 not to check for RMPRFLAG
"RTN","RMPREOS",5,0)
 ;                           RMPRCLOS, or FLAG.
"RTN","RMPREOS",6,0)
 ;
"RTN","RMPREOS",7,0)
 ;  HNC - patch 55 - 3/12/01 allow other note without initial
"RTN","RMPREOS",8,0)
 ;
"RTN","RMPREOS",9,0)
 ;  HNC - patch 57 - 5/8/01  close out note message
"RTN","RMPREOS",10,0)
 ;
"RTN","RMPREOS",11,0)
 ;  RVD - patch 62 - 8/13/01 link suspense to 2319 records.
"RTN","RMPREOS",12,0)
 ;
"RTN","RMPREOS",13,0)
 ;  HNC - patch 80 - 8/28/03 Type to allow Editing, CLOSE SUSPENSE NOT 
"RTN","RMPREOS",14,0)
 ;                           CLOSED Screen Service for Consult Tracking 
"RTN","RMPREOS",15,0)
 ;                           (per Jerry)
"RTN","RMPREOS",16,0)
 ;
"RTN","RMPREOS",17,0)
 ;  TH  - patch 85 - 2/20/04 Fix bug-overwrite Initial Action Date, 
"RTN","RMPREOS",18,0)
 ;                           Note, and DUZ problem.
"RTN","RMPREOS",19,0)
 ;
"RTN","RMPREOS",20,0)
 ;  KAM - patch 85 - 3/16/04 Allow forwarding of a consult to a "Tracker
"RTN","RMPREOS",21,0)
 ;                           Only" service
"RTN","RMPREOS",22,0)
 ;  KAM - patch 97 - 8/19/04 Stop canceling the original consult when
"RTN","RMPREOS",23,0)
 ;                           canceling the clone (in file 123)
"RTN","RMPREOS",24,0)
 ;  
"RTN","RMPREOS",25,0)
 ;Patch 80 -Read File 123.5 DBIA 3861
"RTN","RMPREOS",26,0)
 ;
"RTN","RMPREOS",27,0)
EN ;Add Manual Suspense
"RTN","RMPREOS",28,0)
 ;
"RTN","RMPREOS",29,0)
 D NOW^%DTC S X=%
"RTN","RMPREOS",30,0)
 S DIC="^RMPR(668,",DIC(0)="AEQLM",DLAYGO=668
"RTN","RMPREOS",31,0)
 S DIC("DR")="1////^S X=RMPRDFN;22R;14////^S X=""O"";8////^S X=DUZ;9////^S X=5;3////^S X=9;2////^S X=RMPR(""STA"")"
"RTN","RMPREOS",32,0)
 K DINUM,D0,DD,DO D FILE^DICN K DLAYGO G:Y'>0 EX S (RDA,DA)=+Y
"RTN","RMPREOS",33,0)
 S DIE="^RMPR(668,",DR="13;4"
"RTN","RMPREOS",34,0)
 L +^RMPR(668,RDA,0):1 I $T=0 W $C(7),?5,!,"Someone else is editing this record" G EX
"RTN","RMPREOS",35,0)
 D ^DIE L -^RMPR(668,RDA,0)
"RTN","RMPREOS",36,0)
 I '$P(^RMPR(668,RDA,0),U,3) S DA=RDA,DIK="^RMPR(668," D ^DIK W !,$C(7),?5,"Deleted..."
"RTN","RMPREOS",37,0)
EX K X,DIC,DIE,DR,Y
"RTN","RMPREOS",38,0)
 Q
"RTN","RMPREOS",39,0)
 ;
"RTN","RMPREOS",40,0)
EN2 ;edit MANUAL suspense record
"RTN","RMPREOS",41,0)
 ;DA must be defined
"RTN","RMPREOS",42,0)
 ;
"RTN","RMPREOS",43,0)
 I $P(^RMPR(668,DA,0),U,8)'>4 W !!!,"Can Not Edit This Suspense Record!",!! H 2 Q
"RTN","RMPREOS",44,0)
PROC L +^RMPR(668,DA):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" Q
"RTN","RMPREOS",45,0)
 S RO=$G(^RMPR(668,DA,0)),Y=$P(^(0),U,1) X ^DD("DD")
"RTN","RMPREOS",46,0)
 W "   ",Y,"  ",$E($P(^DPT($P(RO,U,2),0),U,1),1,20)
"RTN","RMPREOS",47,0)
 ;
"RTN","RMPREOS",48,0)
 S RZ="S RX=$P(RO,U,3),RR=$S(RX=1:""PSC"",RX=2:""2421"",RX=3:""2237"",RX=4:""2529-3"",RX=5:""2529-7"",RX=6:""2474"",RX=7:""2431"",RX=8:""2914"",RX=9:""OTHER"",RX=10:""2520"",RX=11:""STOCK ISSUE"",1:""NONE"")"
"RTN","RMPREOS",49,0)
 X RZ
"RTN","RMPREOS",50,0)
 W "  ",RR,"  ",$S($P(RO,U,5)?7N.N:"CLOSED",1:"OPEN")
"RTN","RMPREOS",51,0)
 S DIE="^RMPR(668,"
"RTN","RMPREOS",52,0)
 ;Q:$D(RMPRFLAG)!$D(RMPRCLOS)!$D(FLAG)
"RTN","RMPREOS",53,0)
 S DR="2R;22R;3;13;4"
"RTN","RMPREOS",54,0)
 D ^DIE
"RTN","RMPREOS",55,0)
 L -^RMPR(668,DA)
"RTN","RMPREOS",56,0)
 Q
"RTN","RMPREOS",57,0)
ENIA ;initial action note
"RTN","RMPREOS",58,0)
 ;
"RTN","RMPREOS",59,0)
 I $D(^RMPR(668,DA,3)) W !!!,"Initial Action Note Already Posted!",!! H 2 Q
"RTN","RMPREOS",60,0)
 L +^RMPR(668,DA):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" Q
"RTN","RMPREOS",61,0)
 D NOW^%DTC S RMPREODT=%
"RTN","RMPREOS",62,0)
 ;link suspense to 2319 record, patch #62
"RTN","RMPREOS",63,0)
 I $D(^TMP($J,"RMPRPCE",660)) S ^TMP($J,"RMPRPCE",668,DA)="" D SEL60^RMPRPCEL
"RTN","RMPREOS",64,0)
 S DIE="^RMPR(668,"
"RTN","RMPREOS",65,0)
 S DR="7"
"RTN","RMPREOS",66,0)
 D ^DIE
"RTN","RMPREOS",67,0)
 I $D(^RMPR(668,DA,3)) S DR="10////^S X=RMPREODT;16////^S X=DUZ;14///^S X=""P""" D ^DIE
"RTN","RMPREOS",68,0)
 L -^RMPR(668,DA)
"RTN","RMPREOS",69,0)
 ;check for a note here
"RTN","RMPREOS",70,0)
 I '$D(^RMPR(668,DA,3)) Q
"RTN","RMPREOS",71,0)
 ;consult ien
"RTN","RMPREOS",72,0)
 S GMRCO=$P(^RMPR(668,DA,0),U,15) Q:GMRCO=""
"RTN","RMPREOS",73,0)
 ;note in array
"RTN","RMPREOS",74,0)
 S RMPRCMT=0,GMRCMT=1
"RTN","RMPREOS",75,0)
 F  S RMPRCMT=$O(^RMPR(668,DA,3,RMPRCMT)) Q:RMPRCMT=""  D
"RTN","RMPREOS",76,0)
 .S GMRCMT(RMPRCMT)=^RMPR(668,DA,3,RMPRCMT,0)
"RTN","RMPREOS",77,0)
 I $G(GMRCMT(1))="" S GMRCMT(1)="nothing noted"
"RTN","RMPREOS",78,0)
 ;call api
"RTN","RMPREOS",79,0)
 D CMT^GMRCGUIB(GMRCO,.GMRCMT,DUZ,RMPREODT,DUZ)
"RTN","RMPREOS",80,0)
 K RMPREODT,GMRCO,RMGMRCO,GMRCMT,RMPRCMT
"RTN","RMPREOS",81,0)
 Q
"RTN","RMPREOS",82,0)
FORW ;forward consult
"RTN","RMPREOS",83,0)
 I $P(^RMPR(668,DA,0),U,8)>4 W !!!,"Can Not Forward.",!! H 2 Q
"RTN","RMPREOS",84,0)
 I $D(^RMPR(668,DA,4,1,0)) W !!!,"Completion Note Already Posted!",!! H 2 Q
"RTN","RMPREOS",85,0)
 D NOW^%DTC S RMPREODT=%,GMRCAD=%
"RTN","RMPREOS",86,0)
 ;lookup service to forward consult
"RTN","RMPREOS",87,0)
 ;S DIC("S")="I '$P(^(0),U,2),'+$G(^GMR(123.5,+Y,""IFC""))" ;*85
"RTN","RMPREOS",88,0)
 S DIC("S")="I $$SCR^RMPREOS(+Y,DUZ)"                       ;*85
"RTN","RMPREOS",89,0)
 S DIC="^GMR(123.5,",DIC(0)="AEQ"
"RTN","RMPREOS",90,0)
 S DIC("A")="Select Service To Forward Consult: "
"RTN","RMPREOS",91,0)
 D ^DIC
"RTN","RMPREOS",92,0)
 I (+Y'>0)!($D(DTOUT))!$D(DUOUT) W !!,"Not Forwarded! No Service Selected ." H 2 K DIC Q
"RTN","RMPREOS",93,0)
 S GMRCSS=+Y
"RTN","RMPREOS",94,0)
 L +^RMPR(668,DA):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!"
"RTN","RMPREOS",95,0)
 S DIE="^RMPR(668,"
"RTN","RMPREOS",96,0)
 ;stuff Consult forward service
"RTN","RMPREOS",97,0)
 S DR="23////^S X=GMRCSS"
"RTN","RMPREOS",98,0)
 D ^DIE
"RTN","RMPREOS",99,0)
 Q:'$P($G(^RMPR(668,DA,8)),U,6)
"RTN","RMPREOS",100,0)
 S DR="12"
"RTN","RMPREOS",101,0)
 D ^DIE
"RTN","RMPREOS",102,0)
 I $D(^RMPR(668,DA,4,1,0)) S DR="5////^S X=RMPREODT;6////^S X=DUZ;14///^S X=""C""" D ^DIE
"RTN","RMPREOS",103,0)
 ;must have a note
"RTN","RMPREOS",104,0)
 I '$D(^RMPR(668,DA,4,1,0)) W !!,"Must Have Note to Forward. Consult Not Forwarded." S $P(^RMPR(668,DA,8),U,6)="" H 2 Q
"RTN","RMPREOS",105,0)
 ;
"RTN","RMPREOS",106,0)
 ; set initial action note if null
"RTN","RMPREOS",107,0)
 ;I '$P(^RMPR(668,DA,0),U,10) D
"RTN","RMPREOS",108,0)
 ;
"RTN","RMPREOS",109,0)
 ; Check if Initial Action Date is null
"RTN","RMPREOS",110,0)
 I $P(^RMPR(668,DA,0),U,9)="" D
"RTN","RMPREOS",111,0)
 .S DIE="^RMPR(668,"
"RTN","RMPREOS",112,0)
 .; Set Initial Action Note
"RTN","RMPREOS",113,0)
 .S DR="7///^S X=""See Completion Note, this was forwarded to another service."""
"RTN","RMPREOS",114,0)
 .D ^DIE
"RTN","RMPREOS",115,0)
 .; Set Initial Action Date and Initial Action By 
"RTN","RMPREOS",116,0)
 .;S DR="10////^S X=RMPREODT;16////^S X=DUZ;24////^S X=DUZ" D ^DIE
"RTN","RMPREOS",117,0)
 .S DR="10////^S X=RMPREODT;16////^S X=DUZ" D ^DIE
"RTN","RMPREOS",118,0)
 ;
"RTN","RMPREOS",119,0)
 ; Set Forwarded By
"RTN","RMPREOS",120,0)
 S DR="24////^S X=DUZ" D ^DIE
"RTN","RMPREOS",121,0)
 ;
"RTN","RMPREOS",122,0)
 L -^RMPR(668,DA)
"RTN","RMPREOS",123,0)
 K RMPREODT
"RTN","RMPREOS",124,0)
 S GMRCO=$P(^RMPR(668,DA,0),U,15)
"RTN","RMPREOS",125,0)
 Q:GMRCO=""
"RTN","RMPREOS",126,0)
 ;note in array
"RTN","RMPREOS",127,0)
 S RMPRCOM=0
"RTN","RMPREOS",128,0)
 F  S RMPRCOM=$O(^RMPR(668,DA,4,RMPRCOM)) Q:RMPRCOM=""  D
"RTN","RMPREOS",129,0)
 .S GMRCOM(RMPRCOM)=^RMPR(668,DA,4,RMPRCOM,0)
"RTN","RMPREOS",130,0)
 I $G(GMRCOM)="" S GMRCOM="not noted"
"RTN","RMPREOS",131,0)
 S GMRCORNP=DUZ
"RTN","RMPREOS",132,0)
 S GMRCURGI=""
"RTN","RMPREOS",133,0)
 S GMRCATTN=""
"RTN","RMPREOS",134,0)
 S BDC=$$FR^GMRCGUIA(.GMRCO,.GMRCSS,.GMRCORNP,.GMRCATTN,.GMRCURGI,.GMRCOM,.GMRCAD)
"RTN","RMPREOS",135,0)
 I +BDC=1 W !!,"ERROR, DID NOT FORWARD!" H 2
"RTN","RMPREOS",136,0)
 W !!,"Consult Forwarded." H 2
"RTN","RMPREOS",137,0)
 K GMRCO,GMRCSS,GMRCORNP,GMRCATTN,GMRCURGI,GMRCOM,GMRCAD
"RTN","RMPREOS",138,0)
 Q
"RTN","RMPREOS",139,0)
CLNT ;post closed note
"RTN","RMPREOS",140,0)
 ;
"RTN","RMPREOS",141,0)
 I $P(^RMPR(668,DA,0),U,10)="C" W !!!,"Completion Note Already Posted!",!! H 2 Q
"RTN","RMPREOS",142,0)
 L +^RMPR(668,DA):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" Q
"RTN","RMPREOS",143,0)
 D NOW^%DTC S RMPREODT=%,GMRCAD=%
"RTN","RMPREOS",144,0)
 ;link suspense to 2319 record, patch #62
"RTN","RMPREOS",145,0)
 I $D(^TMP($J,"RMPRPCE",660)) S ^TMP($J,"RMPRPCE",668,DA)="" D SEL60^RMPRPCEL
"RTN","RMPREOS",146,0)
 S DIE="^RMPR(668,"
"RTN","RMPREOS",147,0)
 S DR="12"
"RTN","RMPREOS",148,0)
 D ^DIE
"RTN","RMPREOS",149,0)
 I '$D(^RMPR(668,DA,4)) Q
"RTN","RMPREOS",150,0)
 I $D(^RMPR(668,DA,4)) S DR="5////^S X=RMPREODT;6////^S X=DUZ;14///^S X=""C""" D ^DIE
"RTN","RMPREOS",151,0)
 ;set initial action note if null
"RTN","RMPREOS",152,0)
 I '$P(^RMPR(668,DA,0),U,9) D
"RTN","RMPREOS",153,0)
 .S DIE="^RMPR(668,"
"RTN","RMPREOS",154,0)
 .S DR="7///^S X=""See Completion Note for Initial Action Taken."""
"RTN","RMPREOS",155,0)
 .D ^DIE
"RTN","RMPREOS",156,0)
 .S DR="10////^S X=RMPREODT;16////^S X=DUZ" D ^DIE
"RTN","RMPREOS",157,0)
 ;added by #62.  Once closed, update all 2319 record for initial and
"RTN","RMPREOS",158,0)
 ;completion date
"RTN","RMPREOS",159,0)
 D ICDT^RMPRPCEL(DA)
"RTN","RMPREOS",160,0)
 ;
"RTN","RMPREOS",161,0)
 L -^RMPR(668,DA)
"RTN","RMPREOS",162,0)
 K RMPREODT
"RTN","RMPREOS",163,0)
 S GMRCO=$P(^RMPR(668,DA,0),U,15)
"RTN","RMPREOS",164,0)
 Q:GMRCO=""
"RTN","RMPREOS",165,0)
 ;note in array
"RTN","RMPREOS",166,0)
 S RMPRCOM=0
"RTN","RMPREOS",167,0)
 F  S RMPRCOM=$O(^RMPR(668,DA,4,RMPRCOM)) Q:RMPRCOM=""  D
"RTN","RMPREOS",168,0)
 .S GMRCOM(RMPRCOM)=^RMPR(668,DA,4,RMPRCOM,0)
"RTN","RMPREOS",169,0)
 I $G(GMRCOM)="" S GMRCOM="not noted"
"RTN","RMPREOS",170,0)
 S GMRCSF="U"
"RTN","RMPREOS",171,0)
 S GMRCA=10
"RTN","RMPREOS",172,0)
 S GMRCALF="N"
"RTN","RMPREOS",173,0)
 S GMRCATO=""
"RTN","RMPREOS",174,0)
 S (GMRCORNP,GMRCDUZ)=DUZ
"RTN","RMPREOS",175,0)
 S BDC=$$SFILE^GMRCGUIB(.GMRCO,.GMRCA,.GMRCSF,.GMRCORNP,.GMRCDUZ,.GMRCOM,.GMRCALF,.GMRCATO,.GMRCAD)
"RTN","RMPREOS",176,0)
 I +BDC=1 W !!,$P(BDC,U,2) H 2
"RTN","RMPREOS",177,0)
 K GMRCO,GMRCA,GMRCSF,GMRCORNP,GMRCDUZ,GMRCOM,GMRCALF,GMRCATO,GMRCAD
"RTN","RMPREOS",178,0)
 Q
"RTN","RMPREOS",179,0)
OACT ;other notes - no initial needed 3/12/01
"RTN","RMPREOS",180,0)
 ;stuff date/time in.01
"RTN","RMPREOS",181,0)
 ;delete if no note
"RTN","RMPREOS",182,0)
 ;I '$D(^RMPR(668,DA,3,1,0)) W !!!,"No Initial Action Taken... ",!! H 2 Q
"RTN","RMPREOS",183,0)
 ;
"RTN","RMPREOS",184,0)
 L +^RMPR(668,DA):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" Q
"RTN","RMPREOS",185,0)
 ;link suspense to 2319 record, patch #62
"RTN","RMPREOS",186,0)
 I $D(^TMP($J,"RMPRPCE",660)) S ^TMP($J,"RMPRPCE",668,DA)="" D SEL60^RMPRPCEL
"RTN","RMPREOS",187,0)
 S DA(1)=DA,RMPRDA1=DA
"RTN","RMPREOS",188,0)
 S DIC="^RMPR(668,"_DA(1)_",1,"
"RTN","RMPREOS",189,0)
 S DIC(0)="CQL"
"RTN","RMPREOS",190,0)
 S DIC("P")=$P(^DD(668,11,0),U,2)
"RTN","RMPREOS",191,0)
 D NOW^%DTC S X=%,GMRCWHN=%
"RTN","RMPREOS",192,0)
 S DLAYGO=688
"RTN","RMPREOS",193,0)
 D ^DIC
"RTN","RMPREOS",194,0)
 I Y=-1 K DIC,DA Q
"RTN","RMPREOS",195,0)
 S DIE=DIC K DIC
"RTN","RMPREOS",196,0)
 S (DA,RMPRDA2)=+Y
"RTN","RMPREOS",197,0)
 S DR="1" D ^DIE
"RTN","RMPREOS",198,0)
 K DIE,DR,Y
"RTN","RMPREOS",199,0)
 I '$D(^RMPR(668,RMPRDA1,1,RMPRDA2,1,0)) D  Q
"RTN","RMPREOS",200,0)
 .;delete the record if no note
"RTN","RMPREOS",201,0)
 .S DIK="^RMPR(668,RMPRDA1,1,"
"RTN","RMPREOS",202,0)
 .S DA=RMPRDA2
"RTN","RMPREOS",203,0)
 .D ^DIK
"RTN","RMPREOS",204,0)
 .K DA,DIA,RMPRDA1,RMPRDA2,GMRCWHN
"RTN","RMPREOS",205,0)
 ;send data to consults if note
"RTN","RMPREOS",206,0)
 S GMRCO=$P(^RMPR(668,RMPRDA1,0),U,15)
"RTN","RMPREOS",207,0)
 I GMRCO="" Q
"RTN","RMPREOS",208,0)
 ;GMRCOM is comment array
"RTN","RMPREOS",209,0)
 S RMPRCOM=0
"RTN","RMPREOS",210,0)
 F  S RMPRCOM=$O(^RMPR(668,RMPRDA1,1,RMPRDA2,1,RMPRCOM)) Q:RMPRCOM=""  D
"RTN","RMPREOS",211,0)
 .S GMRCOM(RMPRCOM)=^RMPR(668,RMPRDA1,1,RMPRDA2,1,RMPRCOM,0)
"RTN","RMPREOS",212,0)
 ;
"RTN","RMPREOS",213,0)
 L -^RMPR(668,RMPRDA1)
"RTN","RMPREOS",214,0)
 ;GMRCWHN was set to date/time
"RTN","RMPREOS",215,0)
 D CMT^GMRCGUIB(.GMRCO,.GMRCOM,"",.GMRCWHN,DUZ)
"RTN","RMPREOS",216,0)
 ;check ok
"RTN","RMPREOS",217,0)
 K DA,DIK,RMPRDA1,RMPRDA2,RMPRCOM,GMRCOM,GMRCO,GMRCWHN
"RTN","RMPREOS",218,0)
 Q
"RTN","RMPREOS",219,0)
CANCEL ;cancel suspense
"RTN","RMPREOS",220,0)
 ;set status to X and cancelled by to duz, date/time.
"RTN","RMPREOS",221,0)
 ;start
"RTN","RMPREOS",222,0)
 ;
"RTN","RMPREOS",223,0)
 I $P(^RMPR(668,DA,0),U,5)'="" W !!!,"This has already been completed, cannot cancel!",!! H 2  Q
"RTN","RMPREOS",224,0)
 L +^RMPR(668,DA):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" Q
"RTN","RMPREOS",225,0)
 K Y
"RTN","RMPREOS",226,0)
 S DIR(0)="Y",DIR("B")="N"
"RTN","RMPREOS",227,0)
 W !!!,"This will CANCEL/DELETE this Suspense Request."
"RTN","RMPREOS",228,0)
 S DIR("A")="Are you sure you want to CANCEL/DELETE this Suspense Request? (Y/N) "
"RTN","RMPREOS",229,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!(Y="^")!(Y=0) W !!,"Suspense Not Cancelled!" H 2  Q
"RTN","RMPREOS",230,0)
 D NOW^%DTC S RMPREODT=%
"RTN","RMPREOS",231,0)
 S DIE="^RMPR(668,"
"RTN","RMPREOS",232,0)
 S DR="14///^S X=""X"";17////^S X=DUZ;18////^S X=RMPREODT;9"
"RTN","RMPREOS",233,0)
 D ^DIE
"RTN","RMPREOS",234,0)
 W !!,?5,"DELETED/CANCELLED!" H 2
"RTN","RMPREOS",235,0)
 L -^RMPR(668,DA)
"RTN","RMPREOS",236,0)
 ;consult ien
"RTN","RMPREOS",237,0)
 S GMRCO=$P(^RMPR(668,DA,0),U,15) Q:GMRCO=""
"RTN","RMPREOS",238,0)
 ;note in array
"RTN","RMPREOS",239,0)
 S RMPRCMT=0
"RTN","RMPREOS",240,0)
 F  S RMPRCMT=$O(^RMPR(668,DA,9,RMPRCMT)) Q:RMPRCMT=""  D
"RTN","RMPREOS",241,0)
 .S GMRCMT(RMPRCMT)=^RMPR(668,DA,9,RMPRCMT,0)
"RTN","RMPREOS",242,0)
 I $G(GMRCMT)="" S GMRCMT="nothing noted"
"RTN","RMPREOS",243,0)
 ;call api
"RTN","RMPREOS",244,0)
 ;DY for cancelled, deny
"RTN","RMPREOS",245,0)
 S GMRCACTM="DY"
"RTN","RMPREOS",246,0)
 ; PATCH RMPR*3*97 if canceling a clone do not update file 123 7=clone
"RTN","RMPREOS",247,0)
 I $P(^RMPR(668,DA,0),U,8)'=7 D
"RTN","RMPREOS",248,0)
 . S RMGMRCO=$$DC^GMRCGUIA(.GMRCO,DUZ,RMPREODT,.GMRCACTM,.GMRCMT)
"RTN","RMPREOS",249,0)
 K RMPREODT,GMRCMT,RMPRCMT,GMRCACTM
"RTN","RMPREOS",250,0)
 Q
"RTN","RMPREOS",251,0)
 ;
"RTN","RMPREOS",252,0)
LINK60 ;link suspense to 2319 records
"RTN","RMPREOS",253,0)
 S RMSERR=0
"RTN","RMPREOS",254,0)
 F RMSI=0:0 S RMSI=$O(^TMP($J,"RMPRPCE",660,RMSI)) Q:RMSI'>0  D
"RTN","RMPREOS",255,0)
 .S RMSAMIS=$G(^TMP($J,"RMPRPCE",660,RMSI))
"RTN","RMPREOS",256,0)
 .;call update 668
"RTN","RMPREOS",257,0)
 .S RMSERR=$$UP68^RMPRPCE1(RMSI,DA,+RMSAMIS)
"RTN","RMPREOS",258,0)
 Q:RMSERR=1
"RTN","RMPREOS",259,0)
 S ^TMP($J,"RMPRPCE",668,DA)=""
"RTN","RMPREOS",260,0)
 Q
"RTN","RMPREOS",261,0)
 ;end
"RTN","RMPREOS",262,0)
SCR(SERV,USR) ; SCREEN SERVICES THAT CAN BE FORWARDED TO ,RMPR*3*85
"RTN","RMPREOS",263,0)
 N USAGE
"RTN","RMPREOS",264,0)
 S USAGE=$P(^GMR(123.5,SERV,0),U,2)
"RTN","RMPREOS",265,0)
 I USAGE=9!(USAGE=1) Q 0  ;disabled or grouper service
"RTN","RMPREOS",266,0)
 I USAGE=2 Q $$VALIDU^GMRCAU(SERV,USR)  ;tracking and check update user
"RTN","RMPREOS",267,0)
 Q 1  ;service usage must be null = O
"RTN","RMPREOU")
0^7^B17695537^B16234543
"RTN","RMPREOU",1,0)
RMPREOU ;HINES/HNC -Suspense Processing Utility  ;2-2-2000
"RTN","RMPREOU",2,0)
 ;;3.0;PROSTHETICS;**45,55,59,135**;Feb 09, 1996;Build 12
"RTN","RMPREOU",3,0)
 ; Add new function for working days M-F.
"RTN","RMPREOU",4,0)
 Q
"RTN","RMPREOU",5,0)
 ;
"RTN","RMPREOU",6,0)
ITEM(DA,RL) ;psas hcpcs space item name
"RTN","RMPREOU",7,0)
 ;parm 1=ien 660
"RTN","RMPREOU",8,0)
 ;parm 2=string length
"RTN","RMPREOU",9,0)
 N DIC,DIQ,DR,ITEM
"RTN","RMPREOU",10,0)
 S DIC=660,DIQ="RE",DR="4:4.5",DIQ(0)="EN" D EN^DIQ1
"RTN","RMPREOU",11,0)
 S ITEM=$G(RE(660,DA,4.5,"E"))_" "_$G(RE(660,DA,4,"E"))
"RTN","RMPREOU",12,0)
 I $G(RL) S ITEM=$E(ITEM,0,RL)
"RTN","RMPREOU",13,0)
 K RE Q ITEM
"RTN","RMPREOU",14,0)
 ;
"RTN","RMPREOU",15,0)
 Q
"RTN","RMPREOU",16,0)
PWRKDAY(DA)     ;working days between init action and current dateM-F.
"RTN","RMPREOU",17,0)
 ;holidays are counted as working days
"RTN","RMPREOU",18,0)
 ;parm 1=ien 668, DA
"RTN","RMPREOU",19,0)
 ;
"RTN","RMPREOU",20,0)
 N RMTO,RB,RE
"RTN","RMPREOU",21,0)
 S RB=$P($G(^RMPR(668,DA,0)),U,9)
"RTN","RMPREOU",22,0)
 Q:RB="" 0
"RTN","RMPREOU",23,0)
 S RE=DT
"RTN","RMPREOU",24,0)
 Q:RE="" 0
"RTN","RMPREOU",25,0)
 D WDAY
"RTN","RMPREOU",26,0)
 Q RMTO
"RTN","RMPREOU",27,0)
 Q
"RTN","RMPREOU",28,0)
 ;
"RTN","RMPREOU",29,0)
TYPE(DA,RL) ;type of consult, suspense
"RTN","RMPREOU",30,0)
 ;parm 1=ien 668
"RTN","RMPREOU",31,0)
 ;parm 2=string length optional
"RTN","RMPREOU",32,0)
 N DIC,DIQ,DR,TYPE
"RTN","RMPREOU",33,0)
 S DIC=668,DIQ="RE",DR=9,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPREOU",34,0)
 S TYPE=$G(RE(668,DA,9,"E"))
"RTN","RMPREOU",35,0)
 I $G(RL) S TYPE=$E(TYPE,0,RL)
"RTN","RMPREOU",36,0)
 K RE Q TYPE
"RTN","RMPREOU",37,0)
 ;
"RTN","RMPREOU",38,0)
 ;
"RTN","RMPREOU",39,0)
 Q
"RTN","RMPREOU",40,0)
PDAY(DA) ;days between create and init action
"RTN","RMPREOU",41,0)
 ;parm 1=ien 668
"RTN","RMPREOU",42,0)
 N PDAY,X1,X2
"RTN","RMPREOU",43,0)
 S PDAY=""
"RTN","RMPREOU",44,0)
 S X2=$P($G(^RMPR(668,DA,0)),U,1)
"RTN","RMPREOU",45,0)
 Q:X2="" PDAY
"RTN","RMPREOU",46,0)
 S X1=$P($G(^RMPR(668,DA,0)),U,9)
"RTN","RMPREOU",47,0)
 I X1="" S:$D(RMPRCD) X1=RMPRCD
"RTN","RMPREOU",48,0)
 ;Q:X1="" PDAY
"RTN","RMPREOU",49,0)
 D ^%DTC
"RTN","RMPREOU",50,0)
 Q X
"RTN","RMPREOU",51,0)
 ;
"RTN","RMPREOU",52,0)
 Q
"RTN","RMPREOU",53,0)
DES(DA,RL) ;description for manual
"RTN","RMPREOU",54,0)
 ;parm 1=ien 668
"RTN","RMPREOU",55,0)
 ;parm 2=string length optional
"RTN","RMPREOU",56,0)
 N DES
"RTN","RMPREOU",57,0)
 S DES=$G(^RMPR(668,DA,2,1,0))
"RTN","RMPREOU",58,0)
 I DES="" Q DES
"RTN","RMPREOU",59,0)
 I $G(RL) S DES=$E(DES,0,RL)
"RTN","RMPREOU",60,0)
 Q DES
"RTN","RMPREOU",61,0)
 ;
"RTN","RMPREOU",62,0)
STATUS(DA,RL) ;status of suspense, open, pending, closed
"RTN","RMPREOU",63,0)
 N DIC,DIQ,DR,STATUS
"RTN","RMPREOU",64,0)
 S DIC=668,DIQ="RE",DR=14,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPREOU",65,0)
 S STATUS=$G(RE(668,DA,14,"E"))
"RTN","RMPREOU",66,0)
 I STATUS="" S STATUS="UNKNOWN"
"RTN","RMPREOU",67,0)
 I $G(RL) S STATUS=$E(STATUS,0,RL)
"RTN","RMPREOU",68,0)
 K RE Q STATUS
"RTN","RMPREOU",69,0)
 ;
"RTN","RMPREOU",70,0)
WHO(DA,RL) ;requestor or provider
"RTN","RMPREOU",71,0)
 N DIC,DIQ,DR,WHO
"RTN","RMPREOU",72,0)
 S DIC=200,DIQ="RE",DR=.01,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPREOU",73,0)
 S WHO=$G(RE(200,DA,.01,"E"))
"RTN","RMPREOU",74,0)
 I $G(RL) S WHO=$E(WHO,0,RL)
"RTN","RMPREOU",75,0)
 K RE Q WHO
"RTN","RMPREOU",76,0)
 ;
"RTN","RMPREOU",77,0)
 Q
"RTN","RMPREOU",78,0)
NUM ;pick number from list
"RTN","RMPREOU",79,0)
 K DIR S DIR(0)="LO^"_VALMBG_":"_VALMLST D ^DIR
"RTN","RMPREOU",80,0)
 Q
"RTN","RMPREOU",81,0)
 ;
"RTN","RMPREOU",82,0)
NUM2 ;pick a single number from a list
"RTN","RMPREOU",83,0)
 K DIR S DIR(0)="N^"_VALMBG_":"_VALMLST D ^DIR
"RTN","RMPREOU",84,0)
 Q
"RTN","RMPREOU",85,0)
 ;
"RTN","RMPREOU",86,0)
WRKDAY(DA)        ;working days between create and init action M-F.
"RTN","RMPREOU",87,0)
 ;holidays are counted as working days
"RTN","RMPREOU",88,0)
 ;parm 1=ien 668, DA
"RTN","RMPREOU",89,0)
 ;
"RTN","RMPREOU",90,0)
 N RMTO,RB,RE
"RTN","RMPREOU",91,0)
 S RB=$P($G(^RMPR(668,DA,0)),U,1)
"RTN","RMPREOU",92,0)
 Q:RB="" 0
"RTN","RMPREOU",93,0)
 S RE=$P($G(^RMPR(668,DA,0)),U,9)
"RTN","RMPREOU",94,0)
 Q:RE="" 0
"RTN","RMPREOU",95,0)
 D WDAY
"RTN","RMPREOU",96,0)
 Q RMTO
"RTN","RMPREOU",97,0)
CWRKDAY(DA) ;working days based on today for open records.
"RTN","RMPREOU",98,0)
 ;holidays are counted as working days
"RTN","RMPREOU",99,0)
 ;parm 1=ien 668, DA
"RTN","RMPREOU",100,0)
 N RMTO,RB,RE
"RTN","RMPREOU",101,0)
 S RB=$P($G(^RMPR(668,DA,0)),U,1)
"RTN","RMPREOU",102,0)
 Q:RB="" 0
"RTN","RMPREOU",103,0)
 S RE=DT
"RTN","RMPREOU",104,0)
 D WDAY
"RTN","RMPREOU",105,0)
 Q RMTO
"RTN","RMPREOU",106,0)
CANWKDY(DA) ;*135 working days between create and cancel date for cancel w/o initial action records.
"RTN","RMPREOU",107,0)
 ;holidays are counted as working days
"RTN","RMPREOU",108,0)
 ;parm 1=ien 668, DA
"RTN","RMPREOU",109,0)
 N RMTO,RB,RE
"RTN","RMPREOU",110,0)
 S RB=$P($G(^RMPR(668,DA,0)),U)
"RTN","RMPREOU",111,0)
 Q:RB="" 0
"RTN","RMPREOU",112,0)
 S RE=$P(^RMPR(668,DA,5),U)
"RTN","RMPREOU",113,0)
 Q:RE="" 0
"RTN","RMPREOU",114,0)
 D WDAY
"RTN","RMPREOU",115,0)
 Q RMTO
"RTN","RMPREOU",116,0)
WDAY ;       RB - begining date
"RTN","RMPREOU",117,0)
 ;       RE - ending date
"RTN","RMPREOU",118,0)
 ;Return variable:
"RTN","RMPREOU",119,0)
 ;       RMTO - working days
"RTN","RMPREOU",120,0)
 ;Changed 03/26/03 to make a call to XUWORKDY to not count Holidays
"RTN","RMPREOU",121,0)
 ;In order to not couont Holidays the site must keep the Holiday file 
"RTN","RMPREOU",122,0)
 ;current.
"RTN","RMPREOU",123,0)
 S RMTO=$$EN^XUWORKDY(RB,RE)
"RTN","RMPREOU",124,0)
 Q
"RTN","RMPREOU",125,0)
 ;Set days as Monday the FIRST day and so on:
"RTN","RMPREOU",126,0)
 ;       Monday    = 1
"RTN","RMPREOU",127,0)
 ;       Sunday    = 7
"RTN","RMPREOU",128,0)
 ;If invalid dates, return ZERO.
"RTN","RMPREOU",129,0)
 N X,Y,RMB,RME,RMTOT,RDSDAY,RDEDAY,RBCA,RNOB,RMNOD,RECA,RNO
"RTN","RMPREOU",130,0)
1 S X1=RE,X2=RB D ^%DTC S RMNOD=X
"RTN","RMPREOU",131,0)
 S (RMTO,RMTOT,RECA)=0
"RTN","RMPREOU",132,0)
 S X=RB D DW^%DTC S RMB=X
"RTN","RMPREOU",133,0)
 S X=RE D DW^%DTC S RME=X
"RTN","RMPREOU",134,0)
 I (RB=RE)!(RB>RE)!(RMNOD'>0) Q
"RTN","RMPREOU",135,0)
 ;Get the FIRST set of Monday to Sunday days.
"RTN","RMPREOU",136,0)
 S RDSDAY=$S(RMB["MON":1,RMB["TUE":2,RMB["WED":3,RMB["THU":4,RMB["FRI":5,RMB["SAT":6,RMB["SUN":7,1:0)
"RTN","RMPREOU",137,0)
 S RNOB=$S(RDSDAY=1:4,RDSDAY=2:3,RDSDAY=3:2,RDSDAY=4:1,1:0)
"RTN","RMPREOU",138,0)
 I RNOB=4,RMNOD<7 S RNOB=$S(RMNOD=1:1,RMNOD=2:2,RMNOD=3:3,1:4)
"RTN","RMPREOU",139,0)
 I RNOB=3,RMNOD<6 S RNOB=$S(RMNOD=1:1,RMNOD=2:2,1:3)
"RTN","RMPREOU",140,0)
 I RNOB=2,RMNOD<5 S RNOB=$S(RMNOD=1:1,1:2)
"RTN","RMPREOU",141,0)
 S RBCA=7-RDSDAY
"RTN","RMPREOU",142,0)
 S RMNOD=RMNOD-RBCA
"RTN","RMPREOU",143,0)
 ;Get the SECOND set of Monday to Sunday days.
"RTN","RMPREOU",144,0)
 S RDEDAY=$S(RME["MON":1,RME["TUE":2,RME["WED":3,RME["THU":4,RME["FRI":5,RME["SAT":6,RME["SUN":7,1:0)
"RTN","RMPREOU",145,0)
 I RMNOD>0 D
"RTN","RMPREOU",146,0)
 .S RECA=$S(RDEDAY=7:5,RDEDAY=6:5,1:RDEDAY)
"RTN","RMPREOU",147,0)
 .S RMNOD=RMNOD-RDEDAY
"RTN","RMPREOU",148,0)
 ;
"RTN","RMPREOU",149,0)
 ;calculate totals
"RTN","RMPREOU",150,0)
 S RMTOT=RMTOT+RNOB+RECA
"RTN","RMPREOU",151,0)
 I RMNOD>0,RMNOD<6 S RMTOT=RMTOT+RMNOD
"RTN","RMPREOU",152,0)
 I RMNOD=6 S RMTOT=RMTOT+RMNOD-1
"RTN","RMPREOU",153,0)
 I RMNOD=7 S RMTOT=RMTOT+RMNOD-2
"RTN","RMPREOU",154,0)
 ;if the FIRST and SECOND set of Monday to Sunday total is
"RTN","RMPREOU",155,0)
 ;still greater than 7 days, exclude Saturday and Sunday - don't count.
"RTN","RMPREOU",156,0)
 I RMNOD>7 S RMTOT=RMTOT+(RMNOD-((RMNOD/7)*2))
"RTN","RMPREOU",157,0)
 S RMTO=$J(RMTOT,0,0)
"RTN","RMPREOU",158,0)
END ;
"RTN","RMPRSP7")
0^6^B22861827^B21324847
"RTN","RMPRSP7",1,0)
RMPRSP7 ;HIN/RVD-PRINT 2319 WITHOUT SUSPENSE LINK ;3/17/03  08:13
"RTN","RMPRSP7",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,135**;Feb 09, 1996;Build 12
"RTN","RMPRSP7",3,0)
 ;RVD 8/27/01 patch #62 - PCE data print
"RTN","RMPRSP7",4,0)
 ;RVD 4/9/02 patch #69 -  Disregard Historical data
"RTN","RMPRSP7",5,0)
 ;RVD 3/17/02 patch #77 - Fixed For Loop to include all PT 2319 records
"RTN","RMPRSP7",6,0)
 ;                        that are not linked
"RTN","RMPRSP7",7,0)
 ;RGB 3/22/07 patch 135 - Modified code to check issues in 660 against file 668 suspense records
"RTN","RMPRSP7",8,0)
 ;                        in addition to current check of complete flag in issue record.
"RTN","RMPRSP7",9,0)
 ;
"RTN","RMPRSP7",10,0)
 D DIV4^RMPRSIT I $D(Y),(Y<0) Q
"RTN","RMPRSP7",11,0)
 ; Prompt for Start Date
"RTN","RMPRSP7",12,0)
STDT ;RMPRSDT is start date in FM internal form.
"RTN","RMPRSP7",13,0)
 K %DT,X,Y
"RTN","RMPRSP7",14,0)
 S %DT("A")="Starting Date: "
"RTN","RMPRSP7",15,0)
 S %DT(0)=-DT
"RTN","RMPRSP7",16,0)
 S %DT="AEP"
"RTN","RMPRSP7",17,0)
 D ^%DT I Y<0 G EXIT1
"RTN","RMPRSP7",18,0)
 S RMPRSDT=$P(Y,".",1)
"RTN","RMPRSP7",19,0)
 S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EXIT1
"RTN","RMPRSP7",20,0)
 S RMPREDT=$P(Y,".",1)
"RTN","RMPRSP7",21,0)
 I RMPRSDT>RMPREDT W !,$C(7),"Invalid Date Range Selection!!" G STDT
"RTN","RMPRSP7",22,0)
 ;
"RTN","RMPRSP7",23,0)
CONT G:'$D(RMPRSDT) EXIT1 S %ZIS="MQ" K IOP D ^%ZIS G:POP EXIT1 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPRSP7",24,0)
 K IO("Q") S ZTDESC="PROSTHETIC PATIENT RECORDS WITHOUT SUSPENSE",ZTRTN="PRINT^RMPRSP7",ZTIO=ION,ZTSAVE("RMPRSDT")=""
"RTN","RMPRSP7",25,0)
 S ZTSAVE("RMPR(""STA"")")="",ZTSAVE("RMPR(")="",ZTSAVE("RMPREDT")=""
"RTN","RMPRSP7",26,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EXIT
"RTN","RMPRSP7",27,0)
 ;
"RTN","RMPRSP7",28,0)
PRINT I $E(IOST)["C" W !!,"Processing report......."
"RTN","RMPRSP7",29,0)
 K ^TMP($J)
"RTN","RMPRSP7",30,0)
 K %DT,X,Y
"RTN","RMPRSP7",31,0)
 S X="NOW" D ^%DT S RMDATE=$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)
"RTN","RMPRSP7",32,0)
 S RMPAGE=1,(RMTOBAL,RMPREND)=0,RS=RMPR("STA")
"RTN","RMPRSP7",33,0)
 S RDT=RMPRSDT-1,RET=RMPREDT+1,RS=RMPR("STA")
"RTN","RMPRSP7",34,0)
 S Y=RMPRSDT D DD^%DT S RMSDAT=Y
"RTN","RMPRSP7",35,0)
 S Y=RMPREDT D DD^%DT S RMEDAT=Y
"RTN","RMPRSP7",36,0)
 D BUILD
"RTN","RMPRSP7",37,0)
 I '$D(^TMP($J)) D HEAD,NONE G EXIT
"RTN","RMPRSP7",38,0)
 D HEAD,HEAD1
"RTN","RMPRSP7",39,0)
 D WRITE
"RTN","RMPRSP7",40,0)
 G EXIT
"RTN","RMPRSP7",41,0)
 ;
"RTN","RMPRSP7",42,0)
BUILD ;build a tmp global.
"RTN","RMPRSP7",43,0)
 F RI=RDT:0:RET S RI=$O(^RMPR(660,"B",RI)) Q:(RI'>0)!(RMPREND)!(RI>RMPREDT)  F RJ=0:0 S RJ=$O(^RMPR(660,"B",RI,RJ)) Q:(RJ'>0)  D
"RTN","RMPRSP7",44,0)
 .;don't include if O2 transactions.
"RTN","RMPRSP7",45,0)
 .Q:$D(^RMPO(665.72,"AC",RJ))
"RTN","RMPRSP7",46,0)
 .S RM0=$G(^RMPR(660,RJ,0))
"RTN","RMPRSP7",47,0)
 .S RM10=$G(^RMPR(660,RJ,10))
"RTN","RMPRSP7",48,0)
 .Q:($P(RM0,U,13)=13)!($P(RM0,U,15)="*")
"RTN","RMPRSP7",49,0)
 .Q:($P(RM10,U,14)>0)!($P(RM0,U,10)'=RMPR("STA"))
"RTN","RMPRSP7",50,0)
 .;FILTER SHIPPING CHARGES AND DDC TRANSACTIONS
"RTN","RMPRSP7",51,0)
 .Q:($P(RM0,U,17)'="")!($P(RM0,U,13)=16)
"RTN","RMPRSP7",52,0)
 .S RMIE68=$O(^RMPR(668,"F",RJ,0))
"RTN","RMPRSP7",53,0)
 .I RMIE68,$D(^RMPR(668,RMIE68,10,"B",RJ)) Q
"RTN","RMPRSP7",54,0)
 .I $P(RM0,U,10)=RS D
"RTN","RMPRSP7",55,0)
 ..S RMDFN=$P(RM0,U,2)
"RTN","RMPRSP7",56,0)
 ..S RMITIEN=$P(RM0,U,6)
"RTN","RMPRSP7",57,0)
 ..S (RMITEM,RMPAT)=""
"RTN","RMPRSP7",58,0)
 ..I RMITIEN,($D(^RMPR(661,RMITIEN,0))),($D(^PRC(441,$P(^RMPR(661,RMITIEN,0),U,1),0))) D
"RTN","RMPRSP7",59,0)
 ...S RMITEM=$P(^PRC(441,$P(^RMPR(661,RMITIEN,0),U,1),0),U,2)
"RTN","RMPRSP7",60,0)
 ..S RMITEM=$E(RMITEM,1,18)
"RTN","RMPRSP7",61,0)
 ..I $D(^DPT(RMDFN,0)) S RMPAT=$E($P(^DPT(RMDFN,0),U,1),U,15)
"RTN","RMPRSP7",62,0)
 ..S RMSUSP=$P(RM10,U,1)
"RTN","RMPRSP7",63,0)
 ..S RMRXDT=$P(RM10,U,2)
"RTN","RMPRSP7",64,0)
 ..S RMIADT=$P(RM10,U,3)
"RTN","RMPRSP7",65,0)
 ..S RCDT=$P(RM10,U,4)
"RTN","RMPRSP7",66,0)
 ..S RMAMT=$P(RM0,U,16)
"RTN","RMPRSP7",67,0)
 ..S RMSRC=RJ
"RTN","RMPRSP7",68,0)
 ..S RMPRDI=$P(RM10,U,7)
"RTN","RMPRSP7",69,0)
 ..S RMINIE=$P(RM0,U,27)
"RTN","RMPRSP7",70,0)
 ..S RMCOSU=$P(RM10,U,9)
"RTN","RMPRSP7",71,0)
 ..S RMSUST=$P(RM10,U,11)
"RTN","RMPRSP7",72,0)
 ..S RMPCEP=$P(RM10,U,12)
"RTN","RMPRSP7",73,0)
 ..S RPDT=$P(RM10,U,13)
"RTN","RMPRSP7",74,0)
 ..I RMINIE,$D(^VA(200,RMINIE,0)) S RMINI=$E($P(^VA(200,RMINIE,0),U,1),1,10)
"RTN","RMPRSP7",75,0)
 ..E  S RMINI=""
"RTN","RMPRSP7",76,0)
 ..S RDDT=$E(RI,4,5)_"/"_$E(RI,6,7)_"/"_$E(RI,2,3)
"RTN","RMPRSP7",77,0)
 ..S:RPDT'="" RPDT=$E(RPDT,4,5)_"/"_$E(RPDT,6,7)_"/"_$E(RPDT,2,3)
"RTN","RMPRSP7",78,0)
 ..S:RCDT'="" RCDT=$E(RCDT,4,5)_"/"_$E(RCDT,6,7)_"/"_$E(RCDT,2,3)
"RTN","RMPRSP7",79,0)
 ..S ^TMP($J,RI,RMPAT,RJ)=RMITEM_"^"_RDDT_"^"_RMAMT_"^"_RMSRC_"^"_RMINI_"^"_RPDT_"^"_$E(RMPRDI,1,10)
"RTN","RMPRSP7",80,0)
 Q
"RTN","RMPRSP7",81,0)
 ;
"RTN","RMPRSP7",82,0)
WRITE ;write report to a selected device
"RTN","RMPRSP7",83,0)
 S (RMPREND,RI,RM)=0
"RTN","RMPRSP7",84,0)
 F  S RI=$O(^TMP($J,RI)) Q:(RI'>0)!(RMPREND)  S RJ="" F  S RJ=$O(^TMP($J,RI,RJ)) Q:(RJ="")!(RMPREND)  F  S RM=$O(^TMP($J,RI,RJ,RM)) Q:(RM'>0)!(RMPREND)  D
"RTN","RMPRSP7",85,0)
 .S RMDAT=$G(^TMP($J,RI,RJ,RM))
"RTN","RMPRSP7",86,0)
 .S RMPAT=RJ
"RTN","RMPRSP7",87,0)
 .S RMITEM=$P(RMDAT,U,1)
"RTN","RMPRSP7",88,0)
 .S RDDT=$P(RMDAT,U,2)
"RTN","RMPRSP7",89,0)
 .S RMAMT=$P(RMDAT,U,3)
"RTN","RMPRSP7",90,0)
 .S RMSRC=$P(RMDAT,U,4)
"RTN","RMPRSP7",91,0)
 .S RMINI=$P(RMDAT,U,5)
"RTN","RMPRSP7",92,0)
 .S RPDT=$P(RMDAT,U,6)
"RTN","RMPRSP7",93,0)
 .S RMPRDI=$E($P(RMDAT,U,7),1,12)
"RTN","RMPRSP7",94,0)
 .W !,RDDT,?10,RMPAT,?26,RMITEM,?45,$J(RMAMT,8,2),?57,RMSRC,?67,RMINI
"RTN","RMPRSP7",95,0)
 .S RMPRFLG=1
"RTN","RMPRSP7",96,0)
 .I $E(IOST)["C"&($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD,HEAD1 Q
"RTN","RMPRSP7",97,0)
 .I $Y>(IOSL-6) W @IOF D HEAD,HEAD1 K RMPRFLG Q
"RTN","RMPRSP7",98,0)
 W !,RMPR("L")
"RTN","RMPRSP7",99,0)
 W !,"<End of Report>"
"RTN","RMPRSP7",100,0)
 Q
"RTN","RMPRSP7",101,0)
 ;
"RTN","RMPRSP7",102,0)
HEAD W !,"PROSTHETICS PATIENT RECORDS NOT LINKED TO SUSPENSE  Run Date:",RMDATE,?70,"PAGE: ",RMPAGE
"RTN","RMPRSP7",103,0)
 W !,"Start Date: ",RMSDAT,?26,"End Date: ",RMEDAT,?51,"station: ",$E($P($G(^DIC(4,RS,0)),U,1),1,19)
"RTN","RMPRSP7",104,0)
 S RMPAGE=RMPAGE+1
"RTN","RMPRSP7",105,0)
 Q
"RTN","RMPRSP7",106,0)
 ;
"RTN","RMPRSP7",107,0)
HEAD1 I $E(IOST)["C"&($Y>(IOSL-7)) S DIR(0)="E" D ^DIR S:$D(DTOUT)!(Y=0) RMPREND=1 Q:RMPREND  W @IOF D HEAD
"RTN","RMPRSP7",108,0)
 I $E(IOST)'["C"&($Y>(IOSL-6)) W @IOF D HEAD
"RTN","RMPRSP7",109,0)
 W !,RMPR("L")
"RTN","RMPRSP7",110,0)
 W !,"DATE",?10,"PATIENT",?26,"ITEM",?49,"COST",?57,"VISTA #",?67,"INITIATOR"
"RTN","RMPRSP7",111,0)
 W !,"----",?10,"-------",?26,"----",?49,"----",?57,"-------",?67,"---------"
"RTN","RMPRSP7",112,0)
 S RMPRFLG=1
"RTN","RMPRSP7",113,0)
 Q
"RTN","RMPRSP7",114,0)
 ;
"RTN","RMPRSP7",115,0)
EXIT I $E(IOST)["C",'RMPREND K DIR S DIR(0)="E" D ^DIR
"RTN","RMPRSP7",116,0)
EXIT1 D ^%ZISC
"RTN","RMPRSP7",117,0)
 K ^TMP($J)
"RTN","RMPRSP7",118,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPRSP7",119,0)
 Q
"RTN","RMPRSP7",120,0)
NONE W !!,"NO DATA TO PRINT !!!!!"
"RTN","RMPRSP7",121,0)
 Q
"VER")
8.0^22.0
"BLD",6510,6)
^118
**END**
**END**
