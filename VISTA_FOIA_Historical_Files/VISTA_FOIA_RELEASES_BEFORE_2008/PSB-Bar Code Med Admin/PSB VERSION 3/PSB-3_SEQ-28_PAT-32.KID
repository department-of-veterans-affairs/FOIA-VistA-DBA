Released PSB*3*32 SEQ #28
Extracted from mail message
**KIDS**:PSB*3.0*32^

**INSTALL NAME**
PSB*3.0*32
"BLD",6328,0)
PSB*3.0*32^BAR CODE MED ADMIN^0^3070912^y
"BLD",6328,1,0)
^^77^77^3070912^
"BLD",6328,1,1,0)
 
"BLD",6328,1,2,0)
 
"BLD",6328,1,3,0)
This patch is a component of the Bar Code Medication Administration 
"BLD",6328,1,4,0)
(BCMA) Health Systems Committee (HSC) Phase III project.  The main
"BLD",6328,1,5,0)
function of PSB*3*32 and the corresponding BCMA Graphical User
"BLD",6328,1,6,0)
Interface (GUI) software (BCMA Version 3 Patch 32 [3.0.32.*]) is to
"BLD",6328,1,7,0)
provide the BCMA user with additional BCMA Coversheet and reporting 
"BLD",6328,1,8,0)
support.
"BLD",6328,1,9,0)
 
"BLD",6328,1,10,0)
 
"BLD",6328,1,11,0)
 
"BLD",6328,1,12,0)
1.  Problem:  PSI-06-029/HD0000000126326
"BLD",6328,1,13,0)
    Processing the BCMA Missed Medications Report causes the client to 
"BLD",6328,1,14,0)
    "time-out" when the report is to display within the BCMA GUI 
"BLD",6328,1,15,0)
    Application and prior to sending the report to a printer.
"BLD",6328,1,16,0)
 
"BLD",6328,1,17,0)
    Corrective Action:
"BLD",6328,1,18,0)
    Make the Missed Medications Report process faster so the client 
"BLD",6328,1,19,0)
    does not "time-out".
"BLD",6328,1,20,0)
 
"BLD",6328,1,21,0)
 
"BLD",6328,1,22,0)
2.  Problem:  PSI-06-019/HD0000000130671
"BLD",6328,1,23,0)
    There is difficulty determining the application of a medical patch 
"BLD",6328,1,24,0)
    that has not been marked as REMOVED when that order has expired or 
"BLD",6328,1,25,0)
    discontinued.
"BLD",6328,1,26,0)
 
"BLD",6328,1,27,0)
    Corrective Action:
"BLD",6328,1,28,0)
    Allow the user to view and act on patches for expired or discontinued 
"BLD",6328,1,29,0)
    orders when the patient's BCMA Virtual Due List (VDL) first opens.
"BLD",6328,1,30,0)
 
"BLD",6328,1,31,0)
 
"BLD",6328,1,32,0)
3.  Problem:  PSI-06-056/HD0000000131075
"BLD",6328,1,33,0)
    Issues related to extra Pro Re Nata (PRN) doses of medication 
"BLD",6328,1,34,0)
    ordered as QDPRN or BIDPRN and reports of nurses missing the last 
"BLD",6328,1,35,0)
    administration time, have cause patient safety concerns. 
"BLD",6328,1,36,0)
 
"BLD",6328,1,37,0)
    Corrective Action:
"BLD",6328,1,38,0)
    The BCMA PRN administration dialog box will be enhanced to provide the
"BLD",6328,1,39,0)
    following features for all PRN administrations:  Icon, Schedule, Last
"BLD",6328,1,40,0)
    Given and Reminder checkbox and statement.
"BLD",6328,1,41,0)
 
"BLD",6328,1,42,0)
 
"BLD",6328,1,43,0)
4.  Problem:  PSI-06-014/HD0000000128909
"BLD",6328,1,44,0)
    Administration problems have been caused when Med Route abbreviations
"BLD",6328,1,45,0)
    on the VDL have been confused.
"BLD",6328,1,46,0)
 
"BLD",6328,1,47,0)
    Corrective Action:
"BLD",6328,1,48,0)
    Display the expanded version of the Med Route.
"BLD",6328,1,49,0)
 
"BLD",6328,1,50,0)
 
"BLD",6328,1,51,0)
5.  Problem:  PSI-06-060/HD0000000143603
"BLD",6328,1,52,0)
    Due to a limitation in the Delphi application, there is a 255-pixel
"BLD",6328,1,53,0)
    limit on the row height in the BCMA GUI VDL that results in truncation
"BLD",6328,1,54,0)
    of an order when there are a large number of additives/solutions on
"BLD",6328,1,55,0)
    the order.
"BLD",6328,1,56,0)
 
"BLD",6328,1,57,0)
    Corrective Action:
"BLD",6328,1,58,0)
    Adjust display area of medications on the VDL to compensate for orders
"BLD",6328,1,59,0)
    with a large number of items to display.
"BLD",6328,1,60,0)
 
"BLD",6328,1,61,0)
 
"BLD",6328,1,62,0)
6.  Enhancement:  New Coversheet Overview Reports.
"BLD",6328,1,63,0)
    As a part of the BCMA HSC Phase III, patch PSB*3.0*32 and 
"BLD",6328,1,64,0)
    PSB.3.0.32 GUI will provide BCMA users with reports that display 
"BLD",6328,1,65,0)
    Coversheet Overview data.  There is a new Coversheet Report for each 
"BLD",6328,1,66,0)
    Coversheet Overview.
"BLD",6328,1,67,0)
 
"BLD",6328,1,68,0)
 
"BLD",6328,1,69,0)
7.  Enhancement:  Global Report Enhancements.
"BLD",6328,1,70,0)
    Various enhancements have been made to BCMA reports in general.  These
"BLD",6328,1,71,0)
    enhancements are presented in BCMA HSC Phase III documentation.
"BLD",6328,1,72,0)
 
"BLD",6328,1,73,0)
 
"BLD",6328,1,74,0)
8.  Enhancement:  Coversheet and Other Miscellaneous Enhancements.
"BLD",6328,1,75,0)
    A variety of new Coversheet and miscellaneous feature will be 
"BLD",6328,1,76,0)
    supported with the installation of this patch.  The BCMA HSC Phase 
"BLD",6328,1,77,0)
    III documentation provides details of these new features.
"BLD",6328,4,0)
^9.64PA^53.69^1
"BLD",6328,4,53.69,0)
53.69
"BLD",6328,4,53.69,2,0)
^9.641^53.692^2
"BLD",6328,4,53.69,2,53.69,0)
BCMA REPORT REQUEST  (File-top level)
"BLD",6328,4,53.69,2,53.69,1,0)
^9.6411^.61^2
"BLD",6328,4,53.69,2,53.69,1,.05,0)
TYPE OF REQUEST
"BLD",6328,4,53.69,2,53.69,1,.61,0)
CRITERIA
"BLD",6328,4,53.69,2,53.692,0)
INPUT LIST  (sub-file)
"BLD",6328,4,53.69,2,53.692,1,0)
^9.6411^^
"BLD",6328,4,53.69,222)
y^y^p^^^^n^^n
"BLD",6328,4,53.69,224)

"BLD",6328,4,"APDD",53.69,53.69)

"BLD",6328,4,"APDD",53.69,53.69,.05)

"BLD",6328,4,"APDD",53.69,53.69,.61)

"BLD",6328,4,"APDD",53.69,53.692)

"BLD",6328,4,"B",53.69,53.69)

"BLD",6328,6.3)
32
"BLD",6328,"ABPKG")
n
"BLD",6328,"KRN",0)
^9.67PA^8989.52^19
"BLD",6328,"KRN",.4,0)
.4
"BLD",6328,"KRN",.401,0)
.401
"BLD",6328,"KRN",.402,0)
.402
"BLD",6328,"KRN",.403,0)
.403
"BLD",6328,"KRN",.5,0)
.5
"BLD",6328,"KRN",.84,0)
.84
"BLD",6328,"KRN",3.6,0)
3.6
"BLD",6328,"KRN",3.8,0)
3.8
"BLD",6328,"KRN",9.2,0)
9.2
"BLD",6328,"KRN",9.8,0)
9.8
"BLD",6328,"KRN",9.8,"NM",0)
^9.68A^35^34
"BLD",6328,"KRN",9.8,"NM",1,0)
PSBO^^0^B64481776
"BLD",6328,"KRN",9.8,"NM",2,0)
PSBO1^^0^B7451298
"BLD",6328,"KRN",9.8,"NM",3,0)
PSBOMM^^0^B85940582
"BLD",6328,"KRN",9.8,"NM",4,0)
PSBVDLIV^^0^B64891232
"BLD",6328,"KRN",9.8,"NM",5,0)
PSBVDLPA^^0^B14269573
"BLD",6328,"KRN",9.8,"NM",6,0)
PSBVDLPB^^0^B84339599
"BLD",6328,"KRN",9.8,"NM",7,0)
PSBVDLUD^^0^B76110020
"BLD",6328,"KRN",9.8,"NM",8,0)
PSBRPC^^0^B83859906
"BLD",6328,"KRN",9.8,"NM",9,0)
PSBRPC3^^0^B308923
"BLD",6328,"KRN",9.8,"NM",10,0)
PSBCSUTX^^0^B62829638
"BLD",6328,"KRN",9.8,"NM",11,0)
PSBOCE^^0^B78251398
"BLD",6328,"KRN",9.8,"NM",12,0)
PSBOCI^^0^B79246118
"BLD",6328,"KRN",9.8,"NM",13,0)
PSBOCM^^0^B76517195
"BLD",6328,"KRN",9.8,"NM",14,0)
PSBOCP^^0^B73770736
"BLD",6328,"KRN",9.8,"NM",15,0)
PSBOIV^^0^B78135572
"BLD",6328,"KRN",9.8,"NM",16,0)
PSBODL^^0^B72460144
"BLD",6328,"KRN",9.8,"NM",17,0)
PSBOPE^^0^B17458484
"BLD",6328,"KRN",9.8,"NM",18,0)
PSBOWA^^0^B50135116
"BLD",6328,"KRN",9.8,"NM",20,0)
PSBRPCMO^^0^B85114141
"BLD",6328,"KRN",9.8,"NM",21,0)
PSBOMT^^0^B79357659
"BLD",6328,"KRN",9.8,"NM",22,0)
PSBVDLVL^^0^B63610275
"BLD",6328,"KRN",9.8,"NM",23,0)
PSBCSUTL^^0^B81338300
"BLD",6328,"KRN",9.8,"NM",24,0)
PSBCSUTY^^0^B43368080
"BLD",6328,"KRN",9.8,"NM",25,0)
PSBOCE1^^0^B12338914
"BLD",6328,"KRN",9.8,"NM",26,0)
PSBODL1^^0^B38589946
"BLD",6328,"KRN",9.8,"NM",27,0)
PSBOCI1^^0^B3777377
"BLD",6328,"KRN",9.8,"NM",28,0)
PSBOCM1^^0^B20780748
"BLD",6328,"KRN",9.8,"NM",29,0)
PSBOCP1^^0^B6438461
"BLD",6328,"KRN",9.8,"NM",30,0)
PSBOMT1^^0^B30505207
"BLD",6328,"KRN",9.8,"NM",31,0)
PSBOMM2^^0^B39563401
"BLD",6328,"KRN",9.8,"NM",32,0)
PSBOIV1^^0^B3877524
"BLD",6328,"KRN",9.8,"NM",33,0)
PSBVDLU1^^0^B56720920
"BLD",6328,"KRN",9.8,"NM",34,0)
PSBRPC2^^0^B45066949
"BLD",6328,"KRN",9.8,"NM",35,0)
PSBMLLKU^^0^B78334871
"BLD",6328,"KRN",9.8,"NM","B","PSBCSUTL",23)

"BLD",6328,"KRN",9.8,"NM","B","PSBCSUTX",10)

"BLD",6328,"KRN",9.8,"NM","B","PSBCSUTY",24)

"BLD",6328,"KRN",9.8,"NM","B","PSBMLLKU",35)

"BLD",6328,"KRN",9.8,"NM","B","PSBO",1)

"BLD",6328,"KRN",9.8,"NM","B","PSBO1",2)

"BLD",6328,"KRN",9.8,"NM","B","PSBOCE",11)

"BLD",6328,"KRN",9.8,"NM","B","PSBOCE1",25)

"BLD",6328,"KRN",9.8,"NM","B","PSBOCI",12)

"BLD",6328,"KRN",9.8,"NM","B","PSBOCI1",27)

"BLD",6328,"KRN",9.8,"NM","B","PSBOCM",13)

"BLD",6328,"KRN",9.8,"NM","B","PSBOCM1",28)

"BLD",6328,"KRN",9.8,"NM","B","PSBOCP",14)

"BLD",6328,"KRN",9.8,"NM","B","PSBOCP1",29)

"BLD",6328,"KRN",9.8,"NM","B","PSBODL",16)

"BLD",6328,"KRN",9.8,"NM","B","PSBODL1",26)

"BLD",6328,"KRN",9.8,"NM","B","PSBOIV",15)

"BLD",6328,"KRN",9.8,"NM","B","PSBOIV1",32)

"BLD",6328,"KRN",9.8,"NM","B","PSBOMM",3)

"BLD",6328,"KRN",9.8,"NM","B","PSBOMM2",31)

"BLD",6328,"KRN",9.8,"NM","B","PSBOMT",21)

"BLD",6328,"KRN",9.8,"NM","B","PSBOMT1",30)

"BLD",6328,"KRN",9.8,"NM","B","PSBOPE",17)

"BLD",6328,"KRN",9.8,"NM","B","PSBOWA",18)

"BLD",6328,"KRN",9.8,"NM","B","PSBRPC",8)

"BLD",6328,"KRN",9.8,"NM","B","PSBRPC2",34)

"BLD",6328,"KRN",9.8,"NM","B","PSBRPC3",9)

"BLD",6328,"KRN",9.8,"NM","B","PSBRPCMO",20)

"BLD",6328,"KRN",9.8,"NM","B","PSBVDLIV",4)

"BLD",6328,"KRN",9.8,"NM","B","PSBVDLPA",5)

"BLD",6328,"KRN",9.8,"NM","B","PSBVDLPB",6)

"BLD",6328,"KRN",9.8,"NM","B","PSBVDLU1",33)

"BLD",6328,"KRN",9.8,"NM","B","PSBVDLUD",7)

"BLD",6328,"KRN",9.8,"NM","B","PSBVDLVL",22)

"BLD",6328,"KRN",19,0)
19
"BLD",6328,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",6328,"KRN",19,"NM",1,0)
PSB GUI CONTEXT - USER^^0
"BLD",6328,"KRN",19,"NM",2,0)
PSB TOOL MENU ITEMS^^0
"BLD",6328,"KRN",19,"NM","B","PSB GUI CONTEXT - USER",1)

"BLD",6328,"KRN",19,"NM","B","PSB TOOL MENU ITEMS",2)

"BLD",6328,"KRN",19.1,0)
19.1
"BLD",6328,"KRN",101,0)
101
"BLD",6328,"KRN",409.61,0)
409.61
"BLD",6328,"KRN",771,0)
771
"BLD",6328,"KRN",870,0)
870
"BLD",6328,"KRN",8989.51,0)
8989.51
"BLD",6328,"KRN",8989.51,"NM",0)
^9.68A^2^2
"BLD",6328,"KRN",8989.51,"NM",1,0)
PSB RPT MAX RANGE^^0
"BLD",6328,"KRN",8989.51,"NM",2,0)
PSB TOOLS MENU^^0
"BLD",6328,"KRN",8989.51,"NM","B","PSB RPT MAX RANGE",1)

"BLD",6328,"KRN",8989.51,"NM","B","PSB TOOLS MENU",2)

"BLD",6328,"KRN",8989.52,0)
8989.52
"BLD",6328,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",6328,"KRN",8994,0)
8994
"BLD",6328,"KRN",8994,"NM",0)
^9.68A^4^4
"BLD",6328,"KRN",8994,"NM",1,0)
PSB REPORT^^0
"BLD",6328,"KRN",8994,"NM",2,0)
PSB COVERSHEET1^^0
"BLD",6328,"KRN",8994,"NM",3,0)
PSB GETORDERTAB^^0
"BLD",6328,"KRN",8994,"NM",4,0)
PSB MOB DRUG LIST^^0
"BLD",6328,"KRN",8994,"NM","B","PSB COVERSHEET1",2)

"BLD",6328,"KRN",8994,"NM","B","PSB GETORDERTAB",3)

"BLD",6328,"KRN",8994,"NM","B","PSB MOB DRUG LIST",4)

"BLD",6328,"KRN",8994,"NM","B","PSB REPORT",1)

"BLD",6328,"KRN","B",.4,.4)

"BLD",6328,"KRN","B",.401,.401)

"BLD",6328,"KRN","B",.402,.402)

"BLD",6328,"KRN","B",.403,.403)

"BLD",6328,"KRN","B",.5,.5)

"BLD",6328,"KRN","B",.84,.84)

"BLD",6328,"KRN","B",3.6,3.6)

"BLD",6328,"KRN","B",3.8,3.8)

"BLD",6328,"KRN","B",9.2,9.2)

"BLD",6328,"KRN","B",9.8,9.8)

"BLD",6328,"KRN","B",19,19)

"BLD",6328,"KRN","B",19.1,19.1)

"BLD",6328,"KRN","B",101,101)

"BLD",6328,"KRN","B",409.61,409.61)

"BLD",6328,"KRN","B",771,771)

"BLD",6328,"KRN","B",870,870)

"BLD",6328,"KRN","B",8989.51,8989.51)

"BLD",6328,"KRN","B",8989.52,8989.52)

"BLD",6328,"KRN","B",8994,8994)

"BLD",6328,"QUES",0)
^9.62^^
"BLD",6328,"REQB",0)
^9.611^9^6
"BLD",6328,"REQB",2,0)
PSB*3.0*26^2
"BLD",6328,"REQB",3,0)
PSB*3.0*23^2
"BLD",6328,"REQB",5,0)
PSB*3.0*10^2
"BLD",6328,"REQB",7,0)
PSJ*5.0*159^2
"BLD",6328,"REQB",8,0)
PSB*3.0*38^2
"BLD",6328,"REQB",9,0)
PSS*1.0*88^2
"BLD",6328,"REQB","B","PSB*3.0*10",5)

"BLD",6328,"REQB","B","PSB*3.0*23",3)

"BLD",6328,"REQB","B","PSB*3.0*26",2)

"BLD",6328,"REQB","B","PSB*3.0*38",8)

"BLD",6328,"REQB","B","PSJ*5.0*159",7)

"BLD",6328,"REQB","B","PSS*1.0*88",9)

"FIA",53.69)
BCMA REPORT REQUEST
"FIA",53.69,0)
^PSB(53.69,
"FIA",53.69,0,0)
53.69
"FIA",53.69,0,1)
y^y^p^^^^n^^n
"FIA",53.69,0,10)

"FIA",53.69,0,11)

"FIA",53.69,0,"RLRO")

"FIA",53.69,0,"VR")
3.0^PSB
"FIA",53.69,53.69)
1
"FIA",53.69,53.69,.05)

"FIA",53.69,53.69,.61)

"FIA",53.69,53.69,1)

"FIA",53.69,53.692)
0
"KRN",19,11585,-1)
0^1
"KRN",19,11585,0)
PSB GUI CONTEXT - USER^BCMA Client Context^^B^^^^^^^^
"KRN",19,11585,99)
59973,28281
"KRN",19,11585,99.1)
60549,30153
"KRN",19,11585,"RPC",0)
^19.05P^51^51
"KRN",19,11585,"RPC",2,0)
PSB FMDATE
"KRN",19,11585,"RPC",4,0)
PSB GETPRNS
"KRN",19,11585,"RPC",5,0)
PSB INSTRUCTOR
"KRN",19,11585,"RPC",7,0)
PSB MEDICATION HISTORY
"KRN",19,11585,"RPC",8,0)
PSB PARAMETER
"KRN",19,11585,"RPC",12,0)
PSB SCANMED
"KRN",19,11585,"RPC",13,0)
PSB SCANPT
"KRN",19,11585,"RPC",14,0)
PSB SERVER CLOCK VARIANCE
"KRN",19,11585,"RPC",15,0)
PSB SUBMIT MISSING DOSE
"KRN",19,11585,"RPC",16,0)
PSB TRANSACTION
"KRN",19,11585,"RPC",17,0)
PSB USERLOAD
"KRN",19,11585,"RPC",18,0)
PSB USERSAVE
"KRN",19,11585,"RPC",19,0)
PSB VALIDATE ESIG
"KRN",19,11585,"RPC",20,0)
PSB VALIDATE ORDER
"KRN",19,11585,"RPC",21,0)
PSB CHECK SERVER
"KRN",19,11585,"RPC",23,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,11585,"RPC",24,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,11585,"RPC",26,0)
PSB GETORDERTAB
"KRN",19,11585,"RPC",27,0)
PSB GETIVPAR
"KRN",19,11585,"RPC",28,0)
PSB PUTIVPAR
"KRN",19,11585,"RPC",29,0)
PSB DEVICE
"KRN",19,11585,"RPC",30,0)
PSB IV ORDER HISTORY
"KRN",19,11585,"RPC",31,0)
PSB BAG DETAIL
"KRN",19,11585,"RPC",32,0)
PSB WARDLIST
"KRN",19,11585,"RPC",33,0)
PSB MAIL
"KRN",19,11585,"RPC",34,0)
PSB ALLERGY
"KRN",19,11585,"RPC",35,0)
PSB GETPROVIDER
"KRN",19,11585,"RPC",36,0)
PSB REPORT
"KRN",19,11585,"RPC",37,0)
PSB MOB DRUG LIST
"KRN",19,11585,"RPC",38,0)
PSB MAXDAYS
"KRN",19,11585,"RPC",39,0)
PSB NURS WARDLIST
"KRN",19,11585,"RPC",40,0)
PSB CPRS ORDER
"KRN",19,11585,"RPC",41,0)
ORWUBCMA USERINFO
"KRN",19,11585,"RPC",43,0)
ORBCMA5 GETUDID
"KRN",19,11585,"RPC",44,0)
ORBCMA5 GETIVID
"KRN",19,11585,"RPC",45,0)
PSB VERSION CHECK
"KRN",19,11585,"RPC",46,0)
PSB CHECK IV
"KRN",19,11585,"RPC",47,0)
PSB VITALS
"KRN",19,11585,"RPC",48,0)
PSB VITAL MEAS FILE
"KRN",19,11585,"RPC",49,0)
PSB MED LOG LOOKUP
"KRN",19,11585,"RPC",50,0)
PSB COVERSHEET1
"KRN",19,11585,"RPC",51,0)
PSB UTL XSTATUS SRCH
"KRN",19,11585,"U")
BCMA CLIENT CONTEXT
"KRN",19,13172,-1)
0^2
"KRN",19,13172,0)
PSB TOOL MENU ITEMS^BCMA GUI Tool Menu Items^^A^^^^^^^^BAR CODE MED ADMIN^^1
"KRN",19,13172,1,0)
^19.06^4^4^3070711^^
"KRN",19,13172,1,1,0)
This option allows you to add items that will appear on the Tools menu in 
"KRN",19,13172,1,2,0)
the BCMA GUI.  Items that appear on the tools menu should be Windows 
"KRN",19,13172,1,3,0)
executable files. Use this format: "Display Text=Executable". For 
"KRN",19,13172,1,4,0)
example, "Vista Terminal Emulator=KEA.EXE VISTA".
"KRN",19,13172,20)
D EDITPAR^XPAREDIT("PSB TOOLS MENU")
"KRN",19,13172,"U")
BCMA GUI TOOL MENU ITEMS
"KRN",8989.5,5850,0)
536;DIC(9.4,^PSB TOOLS MENU^1
"KRN",8989.5,5850,1)
&Notepad=notepad.exe
"KRN",8989.51,435,-1)
0^2
"KRN",8989.51,435,0)
PSB TOOLS MENU^PSB GUI Tools Menu^1^Sequence^Name=Command^0
"KRN",8989.51,435,1)
F^^Example:  Notepad=C:\WINDOWS\NOTEPAD.EXE
"KRN",8989.51,435,2)
I '($L($P(X,"="))&$L($P(X,"=",2))) K X
"KRN",8989.51,435,6)
N^1:99^Enter the sequence in which this menu item should appear.
"KRN",8989.51,435,20,0)
^8989.512^14^14^3070711^^
"KRN",8989.51,435,20,1,0)
This parameter may be used to identify which items should appear on the 
"KRN",8989.51,435,20,2,0)
tools menu which is displayed by the BCMA GUI.  Each item should contain 
"KRN",8989.51,435,20,3,0)
a name that should be displayed on the menu, followed by an equal sign, 
"KRN",8989.51,435,20,4,0)
followed by the command string used to invoke the executable.  This 
"KRN",8989.51,435,20,5,0)
string may also include parameters that are passed to the executable.
"KRN",8989.51,435,20,6,0)
Some example entries are:
"KRN",8989.51,435,20,7,0)
  
"KRN",8989.51,435,20,8,0)
Hospital Policy=C:\WINNT\SYSTEM32\VIEWERS\QUIKVIEW.EXE LOCPLCY.DOC
"KRN",8989.51,435,20,9,0)
VISTA Terminal=C:\PROGRA~1\KEA\KEAVT.EXE VISTA.KTC
"KRN",8989.51,435,20,10,0)
  
"KRN",8989.51,435,20,11,0)
An ampersand may be used in the name portion to identify a letter that
"KRN",8989.51,435,20,12,0)
should be underlined on the menu for quick keyboard access.  For example,
"KRN",8989.51,435,20,13,0)
to underscore the letter H in Hospital Policy, enter &Hospital Policy as
"KRN",8989.51,435,20,14,0)
the name part.
"KRN",8989.51,435,30,0)
^8989.513I^6^6
"KRN",8989.51,435,30,1,0)
1^200
"KRN",8989.51,435,30,2,0)
2^44
"KRN",8989.51,435,30,3,0)
3^4
"KRN",8989.51,435,30,4,0)
4^4.2
"KRN",8989.51,435,30,5,0)
9^9.4
"KRN",8989.51,435,30,6,0)
2.5^49
"KRN",8989.51,436,-1)
0^1
"KRN",8989.51,436,0)
PSB RPT MAX RANGE^BCMA REPORT MAXIMUM DAY RANGE^0^^^0
"KRN",8989.51,436,1)
N^^Enter the maximum range (# of days) for a BCMA report to process
"KRN",8989.51,436,4,0)
^8989.514^3^3
"KRN",8989.51,436,4,1,0)
BCMA Report Range
"KRN",8989.51,436,4,2,0)
Maximum Report Range
"KRN",8989.51,436,4,3,0)
BCMA Report Parameter
"KRN",8989.51,436,4,"B","BCMA Report Parameter",3)

"KRN",8989.51,436,4,"B","BCMA Report Range",1)

"KRN",8989.51,436,4,"B","Maximum Report Range",2)

"KRN",8989.51,436,20,0)
^^5^5^3070711^
"KRN",8989.51,436,20,1,0)
PSB RPT MAX RANGE is to support the sites ability to limit the range of 
"KRN",8989.51,436,20,2,0)
days a BCMA report will be allowed to process.  For example, when this 
"KRN",8989.51,436,20,3,0)
parameter is set to 7 , a BCMA report will be able to process data in a 
"KRN",8989.51,436,20,4,0)
range of 7 days such as Jan 1 - Jan 8, 2007.  This will assist in 
"KRN",8989.51,436,20,5,0)
limiting the allocation of resources when processing a BCMA report.
"KRN",8989.51,436,30,0)
^8989.513I^2^2
"KRN",8989.51,436,30,1,0)
2^4
"KRN",8989.51,436,30,2,0)
1^9.4
"KRN",8994,692,-1)
0^1
"KRN",8994,692,0)
PSB REPORT^RPC^PSBO^4^P^^^1^3
"KRN",8994,692,1,0)
^8994.01^2^2^3070712^^^^
"KRN",8994,692,1,1,0)
Return the text for the specified report and the user has the option to 
"KRN",8994,692,1,2,0)
print the reports.
"KRN",8994,692,2,0)
^8994.02A^15^15
"KRN",8994,692,2,1,0)
PSBTYPE^1^2^1^1
"KRN",8994,692,2,1,1,0)
^8994.021^15^15^3030210^^^^
"KRN",8994,692,2,1,1,1,0)
Contains the character designation for the needed report
"KRN",8994,692,2,1,1,2,0)
DL: Due Lisgt
"KRN",8994,692,2,1,1,3,0)
MH: Medication Administration History
"KRN",8994,692,2,1,1,4,0)
ML: Medication Log
"KRN",8994,692,2,1,1,5,0)
WA: Ward Administration Times
"KRN",8994,692,2,1,1,6,0)
MM: Missed Medication
"KRN",8994,692,2,1,1,7,0)
PE: PRN Effectiveness
"KRN",8994,692,2,1,1,8,0)
PM: Patient Medication History
"KRN",8994,692,2,1,1,9,0)
WA: Ward Administration Times
"KRN",8994,692,2,1,1,10,0)
MV: Medication Variance Log
"KRN",8994,692,2,1,1,11,0)
BL: Bar Code Label
"KRN",8994,692,2,1,1,12,0)
MD: Missing Dose by Ward
"KRN",8994,692,2,1,1,13,0)
AL: Allergy Request
"KRN",8994,692,2,1,1,14,0)
PI: Patient Inquiry
"KRN",8994,692,2,1,1,15,0)
DO: Display Order
"KRN",8994,692,2,2,0)
PSBDFN^1^10^1^2
"KRN",8994,692,2,2,1,0)
^8994.021^1^1^3030317^^
"KRN",8994,692,2,2,1,1,0)
Patient IEN
"KRN",8994,692,2,3,0)
PSBSTRT^1^20^1^3
"KRN",8994,692,2,3,1,0)
^^1^1^3011127^
"KRN",8994,692,2,3,1,1,0)
Internal Fileman Start Date/Time
"KRN",8994,692,2,4,0)
PSBSTOP^1^20^1^4
"KRN",8994,692,2,4,1,0)
^^1^1^3011127^
"KRN",8994,692,2,4,1,1,0)
Fileman Stop Date/Time
"KRN",8994,692,2,5,0)
PSBINCL^1^1^1^5
"KRN",8994,692,2,5,1,0)
^8994.021^8^8^3020904^^^^
"KRN",8994,692,2,5,1,1,0)
Contains the parameters for a Due List in up-arrow pieces.
"KRN",8994,692,2,5,1,2,0)
 
"KRN",8994,692,2,5,1,3,0)
Piece   1: 1/0 Include Continuous Meds
"KRN",8994,692,2,5,1,4,0)
        2: 1/0 Include PRN Meds
"KRN",8994,692,2,5,1,5,0)
        3: 1/0 Include OnCall Meds
"KRN",8994,692,2,5,1,6,0)
        4: 1/0 Include OneTime Meds
"KRN",8994,692,2,5,1,7,0)
        5: 1/0 Include Comments
"KRN",8994,692,2,5,1,8,0)
        6: 1/0 Include Audits
"KRN",8994,692,2,5,1,9,0)
blanks at the end of the report.
"KRN",8994,692,2,6,0)
PSBDEV^1^30^0^6
"KRN",8994,692,2,6,1,0)
^^1^1^3011127^
"KRN",8994,692,2,6,1,1,0)
Contains the name of the device that the report prints to.
"KRN",8994,692,2,7,0)
PSBSORT^1^1^1^7
"KRN",8994,692,2,7,1,0)
^^1^1^3011127^
"KRN",8994,692,2,7,1,1,0)
Sorts the report by patient or by ward
"KRN",8994,692,2,8,0)
PSBOI^1^7^1^8
"KRN",8994,692,2,8,1,0)
^8994.021^1^1^3070604^^^
"KRN",8994,692,2,8,1,1,0)
Order/Orderable Item number. 
"KRN",8994,692,2,9,0)
PSBWLOC^1^30^0^9
"KRN",8994,692,2,9,1,0)
^8994.021^1^1^3040206^^
"KRN",8994,692,2,9,1,1,0)
Ward Location 
"KRN",8994,692,2,10,0)
PSBWSORT^1^1^0^10
"KRN",8994,692,2,10,1,0)
^^2^2^3011127^
"KRN",8994,692,2,10,1,1,0)
Sort By Patient - "P"
"KRN",8994,692,2,10,1,2,0)
  or By Bed     - "B"
"KRN",8994,692,2,11,0)
PSBFUT^1^1^1^11
"KRN",8994,692,2,11,1,0)
^8994.021^6^6^3030326^^^^
"KRN",8994,692,2,11,1,1,0)
Contains the parameters for Due list in up-arrow pieces
"KRN",8994,692,2,11,1,2,0)
 
"KRN",8994,692,2,11,1,3,0)
Piece   1: 1/0 Include Blanks (Changes/Addendums)
"KRN",8994,692,2,11,1,4,0)
        2: 1/0 Include IV Meds
"KRN",8994,692,2,11,1,5,0)
        3: 1/0 Include Unit Dose Meds
"KRN",8994,692,2,11,1,6,0)
        4: 1/0 Include Future Orders
"KRN",8994,692,2,12,0)
PSBORDNUM^1^^^12
"KRN",8994,692,2,12,1,0)
^8994.021^7^7^3031209^^^^
"KRN",8994,692,2,12,1,1,0)
The PSBORDNUM is the pharmacy order number from the Inpatient Medications
"KRN",8994,692,2,12,1,2,0)
package.
"KRN",8994,692,2,12,1,3,0)
 
"KRN",8994,692,2,12,1,4,0)
Example: 10U or 10V
"KRN",8994,692,2,12,1,5,0)
 
"KRN",8994,692,2,12,1,6,0)
This order number is used to do a lookup of medications by orderable item 
"KRN",8994,692,2,12,1,7,0)
for the medication history report.
"KRN",8994,692,2,13,0)
PSBLIST^2^^0^14
"KRN",8994,692,2,13,1,0)
^^19^19^3070619^
"KRN",8994,692,2,13,1,1,0)
This  OPTIONAL  parameter contains list of data to input for the creating 
"KRN",8994,692,2,13,1,2,0)
of a report.  The report's developer/designer should be aware of
"KRN",8994,692,2,13,1,3,0)
the type of information to be input via this parameter.  For example per 
"KRN",8994,692,2,13,1,4,0)
the BCMA Medication Therapy Report , this parameter will contain a list of
"KRN",8994,692,2,13,1,5,0)
Dispensed Drug(s)/VA Drug Classification(s)/Orderable Items to be used 
"KRN",8994,692,2,13,1,6,0)
per a "Medical Therapy Report".
"KRN",8994,692,2,13,1,7,0)
 Each item in the list will be tagged respectively: "DD"/"VAC"/"OIT"  Each
"KRN",8994,692,2,13,1,8,0)
item will have the appropriate file pointer data as "^"piece #3.
"KRN",8994,692,2,13,1,9,0)
 
"KRN",8994,692,2,13,1,10,0)
example:
"KRN",8994,692,2,13,1,11,0)
 
"KRN",8994,692,2,13,1,12,0)
List[0]=        "MT^OIT^1043"
"KRN",8994,692,2,13,1,13,0)
List[1]=        "MT^OIT^475"
"KRN",8994,692,2,13,1,14,0)
List[2]=        "MT^OIT^464"
"KRN",8994,692,2,13,1,15,0)
List[3]=        "MT^OIT^88"
"KRN",8994,692,2,13,1,16,0)
 
"KRN",8994,692,2,13,1,17,0)
 
"KRN",8994,692,2,13,1,18,0)
 
"KRN",8994,692,2,13,1,19,0)
The data in the list will be filed into SUBFILE #53.692  (MULTIPLE).
"KRN",8994,692,2,14,0)
PSBRCRI^1^^0^13
"KRN",8994,692,2,14,1,0)
^^10^10^3070619^
"KRN",8994,692,2,14,1,1,0)
Optional parameter contains "additional" report criteria.  The Idea 
"KRN",8994,692,2,14,1,2,0)
is to make the first part of the data to designate the purpose of the data
"KRN",8994,692,2,14,1,3,0)
being input.  An example is to send an addition "Query Date" the 
"KRN",8994,692,2,14,1,4,0)
literal "QD^3070419.1200"  could be the input data.  
"KRN",8994,692,2,14,1,5,0)
 
"KRN",8994,692,2,14,1,6,0)
 
"KRN",8994,692,2,14,1,7,0)
Current list of tags:
"KRN",8994,692,2,14,1,8,0)
 
"KRN",8994,692,2,14,1,9,0)
 
"KRN",8994,692,2,14,1,10,0)
"QD" - query date
"KRN",8994,692,2,15,0)
PSBORDNM^^^^12
"KRN",8994,692,2,"B","PSBDEV",6)

"KRN",8994,692,2,"B","PSBDFN",2)

"KRN",8994,692,2,"B","PSBDL",5)

"KRN",8994,692,2,"B","PSBFUT",11)

"KRN",8994,692,2,"B","PSBINCL",5)

"KRN",8994,692,2,"B","PSBLIST",13)

"KRN",8994,692,2,"B","PSBOI",8)

"KRN",8994,692,2,"B","PSBORDNM",15)

"KRN",8994,692,2,"B","PSBORDNUM",12)

"KRN",8994,692,2,"B","PSBRCRI",14)

"KRN",8994,692,2,"B","PSBSORT",7)

"KRN",8994,692,2,"B","PSBSTOP",4)

"KRN",8994,692,2,"B","PSBSTRT",3)

"KRN",8994,692,2,"B","PSBTYPE",1)

"KRN",8994,692,2,"B","PSBWLOC",9)

"KRN",8994,692,2,"B","PSBWSORT",10)

"KRN",8994,692,2,"PARAMSEQ",1,1)

"KRN",8994,692,2,"PARAMSEQ",2,2)

"KRN",8994,692,2,"PARAMSEQ",3,3)

"KRN",8994,692,2,"PARAMSEQ",4,4)

"KRN",8994,692,2,"PARAMSEQ",5,5)

"KRN",8994,692,2,"PARAMSEQ",6,6)

"KRN",8994,692,2,"PARAMSEQ",7,7)

"KRN",8994,692,2,"PARAMSEQ",8,8)

"KRN",8994,692,2,"PARAMSEQ",9,9)

"KRN",8994,692,2,"PARAMSEQ",10,10)

"KRN",8994,692,2,"PARAMSEQ",11,11)

"KRN",8994,692,2,"PARAMSEQ",12,12)

"KRN",8994,692,2,"PARAMSEQ",12,15)

"KRN",8994,692,2,"PARAMSEQ",13,14)

"KRN",8994,692,2,"PARAMSEQ",14,13)

"KRN",8994,692,3,0)
^8994.03^1^1^3070712^^^^
"KRN",8994,692,3,1,0)
Text of report.
"KRN",8994,1223,-1)
0^3
"KRN",8994,1223,0)
PSB GETORDERTAB^RPC^PSBVDLTB^4^P^^^1^3
"KRN",8994,1223,1,0)
^^1^1^3070712^
"KRN",8994,1223,1,1,0)
Gives the client VDL information for the specified patient and time frame.
"KRN",8994,1223,2,0)
^8994.02A^3^3
"KRN",8994,1223,2,1,0)
DFN^1^30^1^1
"KRN",8994,1223,2,1,1,0)
^8994.021^1^1^3070712^^^^
"KRN",8994,1223,2,1,1,1,0)
The patient IEN from ^DPT.
"KRN",8994,1223,2,2,0)
VDL TAB^1^30^1^2
"KRN",8994,1223,2,2,1,0)
^8994.021^1^1^3070712^^^
"KRN",8994,1223,2,2,1,1,0)
The tab from the VDL that is being requested.
"KRN",8994,1223,2,3,0)
VDL DATE^1^30^0^3
"KRN",8994,1223,2,3,1,0)
^8994.021^2^2^3070712^^^^
"KRN",8994,1223,2,3,1,1,0)
The date of the requested data.  If not passed then current date/time are
"KRN",8994,1223,2,3,1,2,0)
used.
"KRN",8994,1223,2,"B","DFN",1)

"KRN",8994,1223,2,"B","VDL DATE",3)

"KRN",8994,1223,2,"B","VDL TAB",2)

"KRN",8994,1223,2,"PARAMSEQ",1,1)

"KRN",8994,1223,2,"PARAMSEQ",2,2)

"KRN",8994,1223,2,"PARAMSEQ",3,3)

"KRN",8994,1223,3,0)
^^71^71^3070802^
"KRN",8994,1223,3,1,0)
 
"KRN",8994,1223,3,2,0)
If a valid list of orders are found they are returned in a block format
"KRN",8994,1223,3,3,0)
with the word 'END' delimiting orders/administrations.  Lines for
"KRN",8994,1223,3,4,0)
subsequent block are numbered sequential.  They are not reset to 1 for
"KRN",8994,1223,3,5,0)
each
"KRN",8994,1223,3,6,0)
block.
"KRN",8994,1223,3,7,0)
 
"KRN",8994,1223,3,8,0)
 
"KRN",8994,1223,3,9,0)
 
"KRN",8994,1223,3,10,0)
  Results[0] =  ^1      The number of lines returned(count)
"KRN",8994,1223,3,11,0)
  Results[1] =  ^1      Data for the Unit Dose tab (0=no, 1=yes)
"KRN",8994,1223,3,12,0)
                ^2      Data for the Piggy Back tab (0=no, 1=yes)
"KRN",8994,1223,3,13,0)
                ^3      Data for the IV tab (0=no, 1=yes)
"KRN",8994,1223,3,14,0)
                ^4      Transfer type if there was a patient movement
"KRN",8994,1223,3,15,0)
                ^5      Movement type if there was a patient movement
"KRN",8994,1223,3,16,0)
  Results[2] =  ^1      DFN
"KRN",8994,1223,3,17,0)
                ^2      ORDER NUMBER (20V)
"KRN",8994,1223,3,18,0)
                ^3      NUMERIC PORTION OF ORDER NUMBER (20)
"KRN",8994,1223,3,19,0)
                ^4      ALPHA PORTION OF ORDER NUMBER (V)
"KRN",8994,1223,3,20,0)
                ^5      SCHEDULE TYPE (prn/continuous)
"KRN",8994,1223,3,21,0)
                ^6      SCHEDULE (Q4H)
"KRN",8994,1223,3,22,0)
                ^7      SELF MED (SM or HSM)
"KRN",8994,1223,3,23,0)
                ^8      DRUG NAME
"KRN",8994,1223,3,24,0)
                ^9      DOSAGE/FLOW RATE
"KRN",8994,1223,3,25,0)
                ^10     MED ROUTE
"KRN",8994,1223,3,26,0)
                ^11     LAST ACTION DATE/TIME (FM format)
"KRN",8994,1223,3,27,0)
                ^12     MED LOG IEN (blank if no action)
"KRN",8994,1223,3,28,0)
                ^13     LAST ACTION STATUS (this entry)
"KRN",8994,1223,3,29,0)
                ^14     SCHEDULED ADMIN DATE/TIME
"KRN",8994,1223,3,30,0)
                ^15     ORDERABLE ITEM IEN (^ORD(101.43)
"KRN",8994,1223,3,31,0)
                ^16     INJECTABLE (0=no, 1=yes)
"KRN",8994,1223,3,32,0)
                ^17     VARIABLE DOSE (0=no, 1=yes)
"KRN",8994,1223,3,33,0)
                ^18     DOSEAGE FORM
"KRN",8994,1223,3,34,0)
                ^19     VERIFYING NURSE INITIALS (*** if none)
"KRN",8994,1223,3,35,0)
                ^20     LAST ACTION STATUS (whole order)
"KRN",8994,1223,3,36,0)
                ^21     ORDER START DATE/TIME (FM)
"KRN",8994,1223,3,37,0)
                ^22     ORDER STATUS
"KRN",8994,1223,3,38,0)
                ^23     UNIQUE ID OF BAG
"KRN",8994,1223,3,39,0)
                ^24     NURSES IEN
"KRN",8994,1223,3,40,0)
                ^25     TRANSACTION TYPE
"KRN",8994,1223,3,41,0)
                ^26     ORDER STOP DATE (FM)
"KRN",8994,1223,3,42,0)
                ^27     LAST "GIVEN" DATE (FM)
"KRN",8994,1223,3,43,0)
                ^28     GIVEN PATCH (1=yes)
"KRN",8994,1223,3,44,0)
 
"KRN",8994,1223,3,45,0)
 
"KRN",8994,1223,3,46,0)
 
"KRN",8994,1223,3,47,0)
 
"KRN",8994,1223,3,48,0)
  ^Results[2] = ^1      SPECIAL INSTRUCTIONS
"KRN",8994,1223,3,49,0)
  ^Results[n] =
"KRN",8994,1223,3,50,0)
   Dispense Drug  ^1     LITERAL "DD"
"KRN",8994,1223,3,51,0)
                  ^2     DISPENSE DRUG IEN
"KRN",8994,1223,3,52,0)
                  ^3     DISPENSE DRUG NAME
"KRN",8994,1223,3,53,0)
                  ^4     UNITS PER DOSE
"KRN",8994,1223,3,54,0)
                  ^5     INACTIVE DATE
"KRN",8994,1223,3,55,0)
  ^Results[n]
"KRN",8994,1223,3,56,0)
   Additive       ^1    LITERAL "ADD"
"KRN",8994,1223,3,57,0)
                  ^2    ADDITIVE IEN
"KRN",8994,1223,3,58,0)
                  ^3    ADDITIVE NAME
"KRN",8994,1223,3,59,0)
                  ^4    STRENGTH
"KRN",8994,1223,3,60,0)
                  ^5    BOTTLE
"KRN",8994,1223,3,61,0)
  ^Results[n]
"KRN",8994,1223,3,62,0)
   Solution       ^1    LITERAL "SOL"
"KRN",8994,1223,3,63,0)
                  ^2    SOLUTION IEN
"KRN",8994,1223,3,64,0)
                  ^3    SOLUTION NAME
"KRN",8994,1223,3,65,0)
                  ^4    VOLUME
"KRN",8994,1223,3,66,0)
  ^Results[n]
"KRN",8994,1223,3,67,0)
   ID list        ^1    LITERAL "ID"
"KRN",8994,1223,3,68,0)
                  ^2    ID NUMBER
"KRN",8994,1223,3,69,0)
                  ^3    ADDITIVE IEN
"KRN",8994,1223,3,70,0)
                  ^...  EACH ADDITIONAL ADDITIVE IEN
"KRN",8994,1223,3,71,0)
  ^Results[n]     ^1    LITERAL "END" TO INDICATE END OF BLOCK
"KRN",8994,1232,-1)
0^4
"KRN",8994,1232,0)
PSB MOB DRUG LIST^OILST^PSBRPCMO^2^P^^^1^2
"KRN",8994,1232,1,0)
^8994.01^1^1^3070712^^^^
"KRN",8994,1232,1,1,0)
Used by the BCMA/CPRS Med Order Button to return an array of drug.
"KRN",8994,1232,2,0)
^8994.02A^2^2
"KRN",8994,1232,2,1,0)
PSBSCAN^1^40^1^1
"KRN",8994,1232,2,1,1,0)
^8994.021^1^1^3070712^^^^
"KRN",8994,1232,2,1,1,1,0)
PSBSCAN is the value that has been scanned or entered by the user.
"KRN",8994,1232,2,2,0)
PSBOTYP^1^30^1^2
"KRN",8994,1232,2,2,1,0)
^8994.021^9^9^3070712^^
"KRN",8994,1232,2,2,1,1,0)
Type of list:
"KRN",8994,1232,2,2,1,2,0)
 
"KRN",8994,1232,2,2,1,3,0)
    Dispensed Drugs   = "UD"
"KRN",8994,1232,2,2,1,4,0)
 
"KRN",8994,1232,2,2,1,5,0)
    IV Medications    = "IV"
"KRN",8994,1232,2,2,1,6,0)
 
"KRN",8994,1232,2,2,1,7,0)
    Orderable Item    = "OIT"
"KRN",8994,1232,2,2,1,8,0)
 
"KRN",8994,1232,2,2,1,9,0)
    Drug Class        = "VAC"
"KRN",8994,1232,2,"B","PSBOTYP",2)

"KRN",8994,1232,2,"B","PSBSCAN",1)

"KRN",8994,1232,2,"PARAMSEQ",1,1)

"KRN",8994,1232,2,"PARAMSEQ",2,2)

"KRN",8994,1232,3,0)
^8994.03^13^13^3070712^^^^
"KRN",8994,1232,3,1,0)
Results[0] = 1
"KRN",8994,1232,3,2,0)
Results[1] = -1^Invalid Medication Lookup
"KRN",8994,1232,3,3,0)
 
"KRN",8994,1232,3,4,0)
or
"KRN",8994,1232,3,5,0)
 
"KRN",8994,1232,3,6,0)
Results[0] = the number of items passed in the array
"KRN",8994,1232,3,7,0)
Results[1] = ^1 either DD, SOL, ADD
"KRN",8994,1232,3,8,0)
             ^2 IEN from drug file 50
"KRN",8994,1232,3,9,0)
             ^3 Drug Name
"KRN",8994,1232,3,10,0)
             ^4 Pharmacy Orderable Item IEN 
"KRN",8994,1232,3,11,0)
             ^5 Pharmacy Orderable Item Name
"KRN",8994,1232,3,12,0)
             ^6 CPRS Orderable Item IEN
"KRN",8994,1232,3,13,0)
             ^7 CPRS Orderable Item Name
"KRN",8994,1897,-1)
0^2
"KRN",8994,1897,0)
PSB COVERSHEET1^RPC^PSBCSUTL^4^A^0^^1^3
"KRN",8994,1897,1,0)
^8994.01^128^128^3070712^^
"KRN",8994,1897,1,1,0)
(modified 05/08/2007)
"KRN",8994,1897,1,2,0)
 
"KRN",8994,1897,1,3,0)
PSB COVERSHEET1 is to return order data per patient and construction of 
"KRN",8994,1897,1,4,0)
BCMA Coversheet view as presented by the BCMA-HSC Coversheet Phase II
"KRN",8994,1897,1,5,0)
SRS and SDD documentation.
"KRN",8994,1897,1,6,0)
 
"KRN",8994,1897,1,7,0)
INPUT:  communications area -  "" 
"KRN",8994,1897,1,8,0)
        patient's DFN       -  DFN     (patient ptr.)
"KRN",8994,1897,1,9,0)
                            -  TIME RANGE (24/48/72)
"KRN",8994,1897,1,10,0)
 
"KRN",8994,1897,1,11,0)
OUTPUT: results data        -  RESULTS array containing order data 
"KRN",8994,1897,1,12,0)
                                per +/-TIME RANGE hours.
"KRN",8994,1897,1,13,0)
 
"KRN",8994,1897,1,14,0)
 
"KRN",8994,1897,1,15,0)
 
"KRN",8994,1897,1,16,0)
 
"KRN",8994,1897,1,17,0)
Example "M" call and results:
"KRN",8994,1897,1,18,0)
 
"KRN",8994,1897,1,19,0)
 
"KRN",8994,1897,1,20,0)
 
"KRN",8994,1897,1,21,0)
D RPC^PSBCSUTL("",783,24)
"KRN",8994,1897,1,22,0)
 
"KRN",8994,1897,1,23,0)
RPC Call: PSB COVERSHEET1
"KRN",8994,1897,1,24,0)
Results[0] = 90
"KRN",8994,1897,1,25,0)
Results[1] = 1^0^1^1^COVERSHEET DATA FOLLOWS
"KRN",8994,1897,1,26,0)
Results[2] = ORD^783^85U^85^U^C^Q6H^^NITROGLYCERIN PATCH^200MG 
"KRN",8994,1897,1,27,0)
^EPIDURAL^3070501.115014^^^^455^0^0^PATCH^***^G^3070501.09^A^^^0^3070523.0
"KRN",8994,1897,1,28,0)
718^3070501.115014^1
"KRN",8994,1897,1,29,0)
Results[3] = ORC^!TEST MED THERAPY ANTIANGINALS
"KRN",8994,1897,1,30,0)
Results[4] = DD^2313^NITROGLYCERIN PATCHES 10MG/24HR^1^
"KRN",8994,1897,1,31,0)
Results[5] = 
"KRN",8994,1897,1,32,0)
ADM^3070501.09^^100000746^G^3070501.115014^TEJ^10000000039^^3070501.1500
"KRN",8994,1897,1,33,0)
Results[6] = CMT^THIS SHOULD SHOW ON THE MED THERAPY PER 56   
"KRN",8994,1897,1,34,0)
ANTIANGINALS^^10000000039^TEJ^3070501.115014
"KRN",8994,1897,1,35,0)
Results[7] = ADM^3070506.15^^^^^^^^3070501.1500
"KRN",8994,1897,1,36,0)
Results[8] = ADM^3070506.21^^^^^^^^3070501.1500
"KRN",8994,1897,1,37,0)
Results[9] = ADM^3070507.03^^^^^^^^3070501.1500
"KRN",8994,1897,1,38,0)
Results[10] = ADM^3070507.09^^^^^^^^3070501.1500
"KRN",8994,1897,1,39,0)
Results[11] = ADM^3070507.15^^^^^^^^3070501.1500
"KRN",8994,1897,1,40,0)
Results[12] = ADM^3070507.21^^^^^^^^3070501.1500
"KRN",8994,1897,1,41,0)
Results[13] = ADM^3070508.03^^^^^^^^3070501.1500
"KRN",8994,1897,1,42,0)
Results[14] = ADM^3070508.09^^^^^^^^3070501.1500
"KRN",8994,1897,1,43,0)
Results[15] = END
"KRN",8994,1897,1,44,0)
Results[16] = ORD^783^83U^83^U^C^Q3H^^RANITIDINE TAB^150MG 
"KRN",8994,1897,1,45,0)
^ORAL^3070405.12403^^^^558^0^0^TAB^***^R^3070430.1^A^^^0^3070602.1207^^1
"KRN",8994,1897,1,46,0)
Results[17] = ORC^!TEST THE ADMIN TIMES REPORT W/ DATE RANGE +3DAYS
"KRN",8994,1897,1,47,0)
Results[18] = DD^5094^RANITIDINE 150MG TAB^1^
"KRN",8994,1897,1,48,0)
Results[19] = ADM^3070506.13^^^^^^^^3070430.1000
"KRN",8994,1897,1,49,0)
Results[20] = ADM^3070506.16^^^^^^^^3070430.1000
"KRN",8994,1897,1,50,0)
Results[21] = ADM^3070506.19^^^^^^^^3070430.1000
"KRN",8994,1897,1,51,0)
Results[22] = ADM^3070506.22^^^^^^^^3070430.1000
"KRN",8994,1897,1,52,0)
Results[23] = ADM^3070507.01^^^^^^^^3070430.1000
"KRN",8994,1897,1,53,0)
Results[24] = ADM^3070507.04^^^^^^^^3070430.1000
"KRN",8994,1897,1,54,0)
Results[25] = ADM^3070507.07^^^^^^^^3070430.1000
"KRN",8994,1897,1,55,0)
Results[26] = ADM^3070507.1^^^^^^^^3070430.1000
"KRN",8994,1897,1,56,0)
Results[27] = ADM^3070507.13^^^^^^^^3070430.1000
"KRN",8994,1897,1,57,0)
Results[28] = ADM^3070507.16^^^^^^^^3070430.1000
"KRN",8994,1897,1,58,0)
Results[29] = ADM^3070507.19^^^^^^^^3070430.1000
"KRN",8994,1897,1,59,0)
Results[30] = ADM^3070507.22^^^^^^^^3070430.1000
"KRN",8994,1897,1,60,0)
Results[31] = ADM^3070508.01^^^^^^^^3070430.1000
"KRN",8994,1897,1,61,0)
Results[32] = ADM^3070508.04^^^^^^^^3070430.1000
"KRN",8994,1897,1,62,0)
Results[33] = ADM^3070508.07^^^^^^^^3070430.1000
"KRN",8994,1897,1,63,0)
Results[34] = ADM^3070508.1^^^^^^^^3070430.1000
"KRN",8994,1897,1,64,0)
Results[35] = ADM^3070508.13^^^^^^^^3070430.1000
"KRN",8994,1897,1,65,0)
Results[36] = END
"KRN",8994,1897,1,66,0)
Results[37] = ORD^783^84U^84^U^C^Q3H^^ISOSORBIDE DINITRATE TAB,ORAL^40MG 
"KRN",8994,1897,1,67,0)
^ORAL^^^^^354^0^0^TAB,ORAL^***^^3070501.07^A^^^0^3070603.04^^1
"KRN",8994,1897,1,68,0)
Results[38] = ORC^!TEST MED THERAPY ANTIANGINALS
"KRN",8994,1897,1,69,0)
Results[39] = DD^2191^ISOSORBIDE  20MG TAB ^2^
"KRN",8994,1897,1,70,0)
Results[40] = ADM^3070506.13^^^^^^^^3070501.0700
"KRN",8994,1897,1,71,0)
Results[41] = ADM^3070506.16^^^^^^^^3070501.0700
"KRN",8994,1897,1,72,0)
Results[42] = ADM^3070506.19^^^^^^^^3070501.0700
"KRN",8994,1897,1,73,0)
Results[43] = ADM^3070506.22^^^^^^^^3070501.0700
"KRN",8994,1897,1,74,0)
Results[44] = ADM^3070507.01^^^^^^^^3070501.0700
"KRN",8994,1897,1,75,0)
Results[45] = ADM^3070507.04^^^^^^^^3070501.0700
"KRN",8994,1897,1,76,0)
Results[46] = ADM^3070507.07^^^^^^^^3070501.0700
"KRN",8994,1897,1,77,0)
Results[47] = ADM^3070507.1^^^^^^^^3070501.0700
"KRN",8994,1897,1,78,0)
Results[48] = ADM^3070507.13^^^^^^^^3070501.0700
"KRN",8994,1897,1,79,0)
Results[49] = ADM^3070507.16^^^^^^^^3070501.0700
"KRN",8994,1897,1,80,0)
Results[50] = ADM^3070507.19^^^^^^^^3070501.0700
"KRN",8994,1897,1,81,0)
Results[51] = ADM^3070507.22^^^^^^^^3070501.0700
"KRN",8994,1897,1,82,0)
Results[52] = ADM^3070508.01^^^^^^^^3070501.0700
"KRN",8994,1897,1,83,0)
Results[53] = ADM^3070508.04^^^^^^^^3070501.0700
"KRN",8994,1897,1,84,0)
Results[54] = ADM^3070508.07^^^^^^^^3070501.0700
"KRN",8994,1897,1,85,0)
Results[55] = ADM^3070508.1^^^^^^^^3070501.0700
"KRN",8994,1897,1,86,0)
Results[56] = ADM^3070508.13^^^^^^^^3070501.0700
"KRN",8994,1897,1,87,0)
Results[57] = END
"KRN",8994,1897,1,88,0)
Results[58] = ORD^783^86U^86^U^C^Q3H^^PENTAERYTHRITOL TETRANITRATE 
"KRN",8994,1897,1,89,0)
TAB,ORAL^10MG 
"KRN",8994,1897,1,90,0)
^ORAL^3070501.125733^^^^481^0^0^TAB,ORAL^***^G^3070501.09^A^^^0^3070614.06
"KRN",8994,1897,1,91,0)
11^3070501.125733^1
"KRN",8994,1897,1,92,0)
Results[59] = ORC^!TEST THIS ONE TOO ANTIANGINALS
"KRN",8994,1897,1,93,0)
Results[60] = DD^251^PENTAERYTHRITOL  10MG TAB^1^
"KRN",8994,1897,1,94,0)
Results[61] = 
"KRN",8994,1897,1,95,0)
ADM^3070501.125733^^100000747^G^3070501.125733^TEJ^10000000039^^3070501.15
"KRN",8994,1897,1,96,0)
00
"KRN",8994,1897,1,97,0)
Results[62] = ADM^3070506.15^^^^^^^^3070501.1500
"KRN",8994,1897,1,98,0)
Results[63] = ADM^3070506.18^^^^^^^^3070501.1500
"KRN",8994,1897,1,99,0)
Results[64] = ADM^3070506.21^^^^^^^^3070501.1500
"KRN",8994,1897,1,100,0)
Results[65] = ADM^3070506.24^^^^^^^^3070501.1500
"KRN",8994,1897,1,101,0)
Results[66] = ADM^3070507.03^^^^^^^^3070501.1500
"KRN",8994,1897,1,102,0)
Results[67] = ADM^3070507.06^^^^^^^^3070501.1500
"KRN",8994,1897,1,103,0)
Results[68] = ADM^3070507.09^^^^^^^^3070501.1500
"KRN",8994,1897,1,104,0)
Results[69] = ADM^3070507.12^^^^^^^^3070501.1500
"KRN",8994,1897,1,105,0)
Results[70] = ADM^3070507.15^^^^^^^^3070501.1500
"KRN",8994,1897,1,106,0)
Results[71] = ADM^3070507.18^^^^^^^^3070501.1500
"KRN",8994,1897,1,107,0)
Results[72] = ADM^3070507.21^^^^^^^^3070501.1500
"KRN",8994,1897,1,108,0)
Results[73] = ADM^3070507.24^^^^^^^^3070501.1500
"KRN",8994,1897,1,109,0)
Results[74] = ADM^3070508.03^^^^^^^^3070501.1500
"KRN",8994,1897,1,110,0)
Results[75] = ADM^3070508.06^^^^^^^^3070501.1500
"KRN",8994,1897,1,111,0)
Results[76] = ADM^3070508.09^^^^^^^^3070501.1500
"KRN",8994,1897,1,112,0)
Results[77] = ADM^3070508.12^^^^^^^^3070501.1500
"KRN",8994,1897,1,113,0)
Results[78] = END
"KRN",8994,1897,1,114,0)
Results[79] = ORD^783^56V^56^V^C^^^POTASSIUM (K) LIQUID,ORAL^ 780 
"KRN",8994,1897,1,115,0)
ml/hr^INTRACARDIAC INTRA-ARTICULAR 
"KRN",8994,1897,1,116,0)
INTRAVENOUS^3070125.142403^^^^512^0^0^^***^S^3070423.08^A^^^0^3070525.2204
"KRN",8994,1897,1,117,0)
^^3
"KRN",8994,1897,1,118,0)
Results[80] = ORC^!THERE WILL BE NO ACTION ON THIS ORDER!!  nox)
"KRN",8994,1897,1,119,0)
Results[81] = ORF^CPRS^CPRS^REASON FOR THE CPRS FLAG...
"KRN",8994,1897,1,120,0)
Results[82] = ORF^NOX^No Action Taken On Order
"KRN",8994,1897,1,121,0)
Results[83] = ADD^24^KCL^78 MEQ^
"KRN",8994,1897,1,122,0)
Results[84] = SOL^14^DEXTROSE 5% IN N. SALINE^1000 ML^
"KRN",8994,1897,1,123,0)
Results[85] = ID^783V241^ADD;24^SOL;14
"KRN",8994,1897,1,124,0)
Results[86] = ID^783V240^ADD;24^SOL;14
"KRN",8994,1897,1,125,0)
Results[87] = ID^783V239^ADD;24^SOL;14
"KRN",8994,1897,1,126,0)
Results[88] = ID^783V238^ADD;24^SOL;14
"KRN",8994,1897,1,127,0)
Results[89] = ID^783V237^ADD;24^SOL;14
"KRN",8994,1897,1,128,0)
Results[90] = END
"KRN",8994,1897,2,0)
^8994.02A^3^2
"KRN",8994,1897,2,2,0)
DFN^1^^1^1
"KRN",8994,1897,2,2,1,0)
^8994.021^1^1^3070712^^^^
"KRN",8994,1897,2,2,1,1,0)
DFN is the internal entity number per the patient file (file #2).
"KRN",8994,1897,2,3,0)
HRSBACK^1^^0^2
"KRN",8994,1897,2,3,1,0)
^^2^2^3070712^
"KRN",8994,1897,2,3,1,1,0)
HRSBACK - (optional) The number of hours in the past the coversheet will 
"KRN",8994,1897,2,3,1,2,0)
supply order information for.  [default is 24 hours]
"KRN",8994,1897,2,"B","DFN",2)

"KRN",8994,1897,2,"B","HRSBACK",3)

"KRN",8994,1897,2,"PARAMSEQ",1,2)

"KRN",8994,1897,2,"PARAMSEQ",2,3)

"KRN",8994,1897,3,0)
^^96^96^3070712^
"KRN",8994,1897,3,1,0)
(modified 05/08/2007)
"KRN",8994,1897,3,2,0)
 
"KRN",8994,1897,3,3,0)
Remote Procedure Call - PSB COVERSHEET1
"KRN",8994,1897,3,4,0)
RESULTS():
"KRN",8994,1897,3,5,0)
The return data will be listed in the RESULTS "global".
"KRN",8994,1897,3,6,0)
 
"KRN",8994,1897,3,7,0)
RESULTS data will presented with "headers":
"KRN",8994,1897,3,8,0)
 
"KRN",8994,1897,3,9,0)
ORD - Order data
"KRN",8994,1897,3,10,0)
 Order specific data
"KRN",8994,1897,3,11,0)
^1  "ORD"-header
"KRN",8994,1897,3,12,0)
^2  Patient's IEN
"KRN",8994,1897,3,13,0)
^3  Order #_Order type
"KRN",8994,1897,3,14,0)
^4  Order #
"KRN",8994,1897,3,15,0)
^5  Order type
"KRN",8994,1897,3,16,0)
^6  Schedule type
"KRN",8994,1897,3,17,0)
^7  Schedule
"KRN",8994,1897,3,18,0)
^8  Self med
"KRN",8994,1897,3,19,0)
^9  Drug name
"KRN",8994,1897,3,20,0)
^10 Dosage/Flow rate
"KRN",8994,1897,3,21,0)
^11 Med route
"KRN",8994,1897,3,22,0)
^12 Last Action Date/Time
"KRN",8994,1897,3,23,0)
^13 ""
"KRN",8994,1897,3,24,0)
^14 ""
"KRN",8994,1897,3,25,0)
^15 ""
"KRN",8994,1897,3,26,0)
^16 Orderable item (IEN)
"KRN",8994,1897,3,27,0)
^17 Injectable?
"KRN",8994,1897,3,28,0)
^18 Variable dose?
"KRN",8994,1897,3,29,0)
^19 Dosage form
"KRN",8994,1897,3,30,0)
^20 Verifying nurse initials (*** if none)
"KRN",8994,1897,3,31,0)
^21 Last action status (whole order)
"KRN",8994,1897,3,32,0)
^22 Order start date/time (FM)
"KRN",8994,1897,3,33,0)
^23 Order status
"KRN",8994,1897,3,34,0)
^24 ""
"KRN",8994,1897,3,35,0)
^25 ""
"KRN",8994,1897,3,36,0)
^26 Transaction type
"KRN",8994,1897,3,37,0)
^27 Order stop date/time (FM)
"KRN",8994,1897,3,38,0)
^28 Last Given Date/Time
"KRN",8994,1897,3,39,0)
^29 Virtual Due List (VDL) tab indicator = "UD":1 "IVPB":2 "IV":3
"KRN",8994,1897,3,40,0)
 
"KRN",8994,1897,3,41,0)
ORC - Order Comment/Special instruction
"KRN",8994,1897,3,42,0)
^1  "ORC"- header
"KRN",8994,1897,3,43,0)
^2  Special instruction
"KRN",8994,1897,3,44,0)
 
"KRN",8994,1897,3,45,0)
 
"KRN",8994,1897,3,46,0)
ORF - Order Flag
"KRN",8994,1897,3,47,0)
^1  "ORF"- header
"KRN",8994,1897,3,48,0)
^2  type of flag
"KRN",8994,1897,3,49,0)
^3  flag origin
"KRN",8994,1897,3,50,0)
^4  associated comment
"KRN",8994,1897,3,51,0)
 
"KRN",8994,1897,3,52,0)
 
"KRN",8994,1897,3,53,0)
DD  - Dispense Drug
"KRN",8994,1897,3,54,0)
^1  "DD" - header
"KRN",8994,1897,3,55,0)
^2  Dispense drug IEN
"KRN",8994,1897,3,56,0)
^3  Dispense drug name
"KRN",8994,1897,3,57,0)
^4  Units per dose
"KRN",8994,1897,3,58,0)
^5  Inactive date
"KRN",8994,1897,3,59,0)
 
"KRN",8994,1897,3,60,0)
ADD - Additive
"KRN",8994,1897,3,61,0)
^1  "ADD" - header
"KRN",8994,1897,3,62,0)
^2  Additive IEN
"KRN",8994,1897,3,63,0)
^3  Additive name
"KRN",8994,1897,3,64,0)
^4  Strength
"KRN",8994,1897,3,65,0)
^5  Bottle
"KRN",8994,1897,3,66,0)
 
"KRN",8994,1897,3,67,0)
SOL - Solution
"KRN",8994,1897,3,68,0)
^1  "SOL" - header
"KRN",8994,1897,3,69,0)
^2  Solution IEN
"KRN",8994,1897,3,70,0)
^3  Solution name
"KRN",8994,1897,3,71,0)
^4  Volume
"KRN",8994,1897,3,72,0)
 
"KRN",8994,1897,3,73,0)
ID  - Identification
"KRN",8994,1897,3,74,0)
^1  "ID" - header
"KRN",8994,1897,3,75,0)
^2  ID number
"KRN",8994,1897,3,76,0)
^3  Additive IEN
"KRN",8994,1897,3,77,0)
 
"KRN",8994,1897,3,78,0)
ADM - Administration
"KRN",8994,1897,3,79,0)
^1  "ADM" - header
"KRN",8994,1897,3,80,0)
^2  Scheduled admin date/time
"KRN",8994,1897,3,81,0)
^3  Bag id
"KRN",8994,1897,3,82,0)
^4  Med log ien
"KRN",8994,1897,3,83,0)
^5  Action
"KRN",8994,1897,3,84,0)
^6  Date/time
"KRN",8994,1897,3,85,0)
^7  Action by initials
"KRN",8994,1897,3,86,0)
^8  Action by ien
"KRN",8994,1897,3,87,0)
^9  Prn reason
"KRN",8994,1897,3,88,0)
^10 Next Action Date/Time
"KRN",8994,1897,3,89,0)
 
"KRN",8994,1897,3,90,0)
CMT - Comment per administration
"KRN",8994,1897,3,91,0)
^1  "CMT" - header
"KRN",8994,1897,3,92,0)
^2  Comment
"KRN",8994,1897,3,93,0)
^3  Prn effectiveness 
"KRN",8994,1897,3,94,0)
 
"KRN",8994,1897,3,95,0)
END - End
"KRN",8994,1897,3,96,0)
^1  "END" - header
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",536,-1)
1^1
"PKG",536,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",536,20,0)
^9.402P^^
"PKG",536,22,0)
^9.49I^1^1
"PKG",536,22,1,0)
3.0^3040224^3040318^11874
"PKG",536,22,1,"PAH",1,0)
32^3070912^10000000039
"PKG",536,22,1,"PAH",1,1,0)
^^77^77^3070912
"PKG",536,22,1,"PAH",1,1,1,0)
 
"PKG",536,22,1,"PAH",1,1,2,0)
 
"PKG",536,22,1,"PAH",1,1,3,0)
This patch is a component of the Bar Code Medication Administration 
"PKG",536,22,1,"PAH",1,1,4,0)
(BCMA) Health Systems Committee (HSC) Phase III project.  The main
"PKG",536,22,1,"PAH",1,1,5,0)
function of PSB*3*32 and the corresponding BCMA Graphical User
"PKG",536,22,1,"PAH",1,1,6,0)
Interface (GUI) software (BCMA Version 3 Patch 32 [3.0.32.*]) is to
"PKG",536,22,1,"PAH",1,1,7,0)
provide the BCMA user with additional BCMA Coversheet and reporting 
"PKG",536,22,1,"PAH",1,1,8,0)
support.
"PKG",536,22,1,"PAH",1,1,9,0)
 
"PKG",536,22,1,"PAH",1,1,10,0)
 
"PKG",536,22,1,"PAH",1,1,11,0)
 
"PKG",536,22,1,"PAH",1,1,12,0)
1.  Problem:  PSI-06-029/HD0000000126326
"PKG",536,22,1,"PAH",1,1,13,0)
    Processing the BCMA Missed Medications Report causes the client to 
"PKG",536,22,1,"PAH",1,1,14,0)
    "time-out" when the report is to display within the BCMA GUI 
"PKG",536,22,1,"PAH",1,1,15,0)
    Application and prior to sending the report to a printer.
"PKG",536,22,1,"PAH",1,1,16,0)
 
"PKG",536,22,1,"PAH",1,1,17,0)
    Corrective Action:
"PKG",536,22,1,"PAH",1,1,18,0)
    Make the Missed Medications Report process faster so the client 
"PKG",536,22,1,"PAH",1,1,19,0)
    does not "time-out".
"PKG",536,22,1,"PAH",1,1,20,0)
 
"PKG",536,22,1,"PAH",1,1,21,0)
 
"PKG",536,22,1,"PAH",1,1,22,0)
2.  Problem:  PSI-06-019/HD0000000130671
"PKG",536,22,1,"PAH",1,1,23,0)
    There is difficulty determining the application of a medical patch 
"PKG",536,22,1,"PAH",1,1,24,0)
    that has not been marked as REMOVED when that order has expired or 
"PKG",536,22,1,"PAH",1,1,25,0)
    discontinued.
"PKG",536,22,1,"PAH",1,1,26,0)
 
"PKG",536,22,1,"PAH",1,1,27,0)
    Corrective Action:
"PKG",536,22,1,"PAH",1,1,28,0)
    Allow the user to view and act on patches for expired or discontinued 
"PKG",536,22,1,"PAH",1,1,29,0)
    orders when the patient's BCMA Virtual Due List (VDL) first opens.
"PKG",536,22,1,"PAH",1,1,30,0)
 
"PKG",536,22,1,"PAH",1,1,31,0)
 
"PKG",536,22,1,"PAH",1,1,32,0)
3.  Problem:  PSI-06-056/HD0000000131075
"PKG",536,22,1,"PAH",1,1,33,0)
    Issues related to extra Pro Re Nata (PRN) doses of medication 
"PKG",536,22,1,"PAH",1,1,34,0)
    ordered as QDPRN or BIDPRN and reports of nurses missing the last 
"PKG",536,22,1,"PAH",1,1,35,0)
    administration time, have cause patient safety concerns. 
"PKG",536,22,1,"PAH",1,1,36,0)
 
"PKG",536,22,1,"PAH",1,1,37,0)
    Corrective Action:
"PKG",536,22,1,"PAH",1,1,38,0)
    The BCMA PRN administration dialog box will be enhanced to provide the
"PKG",536,22,1,"PAH",1,1,39,0)
    following features for all PRN administrations:  Icon, Schedule, Last
"PKG",536,22,1,"PAH",1,1,40,0)
    Given and Reminder checkbox and statement.
"PKG",536,22,1,"PAH",1,1,41,0)
 
"PKG",536,22,1,"PAH",1,1,42,0)
 
"PKG",536,22,1,"PAH",1,1,43,0)
4.  Problem:  PSI-06-014/HD0000000128909
"PKG",536,22,1,"PAH",1,1,44,0)
    Administration problems have been caused when Med Route abbreviations
"PKG",536,22,1,"PAH",1,1,45,0)
    on the VDL have been confused.
"PKG",536,22,1,"PAH",1,1,46,0)
 
"PKG",536,22,1,"PAH",1,1,47,0)
    Corrective Action:
"PKG",536,22,1,"PAH",1,1,48,0)
    Display the expanded version of the Med Route.
"PKG",536,22,1,"PAH",1,1,49,0)
 
"PKG",536,22,1,"PAH",1,1,50,0)
 
"PKG",536,22,1,"PAH",1,1,51,0)
5.  Problem:  PSI-06-060/HD0000000143603
"PKG",536,22,1,"PAH",1,1,52,0)
    Due to a limitation in the Delphi application, there is a 255-pixel
"PKG",536,22,1,"PAH",1,1,53,0)
    limit on the row height in the BCMA GUI VDL that results in truncation
"PKG",536,22,1,"PAH",1,1,54,0)
    of an order when there are a large number of additives/solutions on
"PKG",536,22,1,"PAH",1,1,55,0)
    the order.
"PKG",536,22,1,"PAH",1,1,56,0)
 
"PKG",536,22,1,"PAH",1,1,57,0)
    Corrective Action:
"PKG",536,22,1,"PAH",1,1,58,0)
    Adjust display area of medications on the VDL to compensate for orders
"PKG",536,22,1,"PAH",1,1,59,0)
    with a large number of items to display.
"PKG",536,22,1,"PAH",1,1,60,0)
 
"PKG",536,22,1,"PAH",1,1,61,0)
 
"PKG",536,22,1,"PAH",1,1,62,0)
6.  Enhancement:  New Coversheet Overview Reports.
"PKG",536,22,1,"PAH",1,1,63,0)
    As a part of the BCMA HSC Phase III, patch PSB*3.0*32 and 
"PKG",536,22,1,"PAH",1,1,64,0)
    PSB.3.0.32 GUI will provide BCMA users with reports that display 
"PKG",536,22,1,"PAH",1,1,65,0)
    Coversheet Overview data.  There is a new Coversheet Report for each 
"PKG",536,22,1,"PAH",1,1,66,0)
    Coversheet Overview.
"PKG",536,22,1,"PAH",1,1,67,0)
 
"PKG",536,22,1,"PAH",1,1,68,0)
 
"PKG",536,22,1,"PAH",1,1,69,0)
7.  Enhancement:  Global Report Enhancements.
"PKG",536,22,1,"PAH",1,1,70,0)
    Various enhancements have been made to BCMA reports in general.  These
"PKG",536,22,1,"PAH",1,1,71,0)
    enhancements are presented in BCMA HSC Phase III documentation.
"PKG",536,22,1,"PAH",1,1,72,0)
 
"PKG",536,22,1,"PAH",1,1,73,0)
 
"PKG",536,22,1,"PAH",1,1,74,0)
8.  Enhancement:  Coversheet and Other Miscellaneous Enhancements.
"PKG",536,22,1,"PAH",1,1,75,0)
    A variety of new Coversheet and miscellaneous feature will be 
"PKG",536,22,1,"PAH",1,1,76,0)
    supported with the installation of this patch.  The BCMA HSC Phase 
"PKG",536,22,1,"PAH",1,1,77,0)
    III documentation provides details of these new features.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
34
"RTN","PSBCSUTL")
0^23^B81338300^B81733971
"RTN","PSBCSUTL",1,0)
PSBCSUTL ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES ;Mar 2004
"RTN","PSBCSUTL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16,13,38,32**;Mar 2004;Build 32
"RTN","PSBCSUTL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBCSUTL",4,0)
 ;
"RTN","PSBCSUTL",5,0)
 ; Reference/IA
"RTN","PSBCSUTL",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBCSUTL",7,0)
 ; IN5^VADPT/10061
"RTN","PSBCSUTL",8,0)
 ; $$GET^XPAR/2263
"RTN","PSBCSUTL",9,0)
 ; ^%DTC/10000
"RTN","PSBCSUTL",10,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBCSUTL",11,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTL",12,0)
RPC(RESULTS,DFN,EXPWIN) ;
"RTN","PSBCSUTL",13,0)
 K RESULTS,^TMP("PSB",$J),^TMP("PSJ",$J)
"RTN","PSBCSUTL",14,0)
 S PSBXWIN=$G(EXPWIN,24)
"RTN","PSBCSUTL",15,0)
 S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",16,0)
 N PSBCNT S PSBTRFL=0,PSBDFNX=DFN
"RTN","PSBCSUTL",17,0)
 S RESULTS=$NAME(^TMP("PSB",$J,PSBTAB))
"RTN","PSBCSUTL",18,0)
 K ^TMP("PSB",$J,PSBTAB) S ^TMP("PSB",$J,PSBTAB,0)=1 D LIGHTS(PSBDFNX)
"RTN","PSBCSUTL",19,0)
 S ^TMP("PSB",$J,PSBTAB,0)=1,^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,PSBTAB,1)
"RTN","PSBCSUTL",20,0)
 Q:$P(^TMP("PSB",$J,PSBTAB,1),U,4)=-1
"RTN","PSBCSUTL",21,0)
 D NOW^%DTC S PSBNOW=+$E(%,1,10),PSBDT=$P(%,".",1)
"RTN","PSBCSUTL",22,0)
 ;set range
"RTN","PSBCSUTL",23,0)
 S PSBWBEG=$$FMADD^XLFDT(PSBNOW,"",-PSBXWIN),PSBWEND=$$FMADD^XLFDT(PSBNOW,"",PSBXWIN)
"RTN","PSBCSUTL",24,0)
 S PSBTBEG=$$FMADD^XLFDT(PSBNOW,"",-12),PSBTEND=$$FMADD^XLFDT(PSBNOW,"",12)
"RTN","PSBCSUTL",25,0)
 S PSBWADM=$$GET^XPAR("DIV","PSB ADMIN BEFORE"),PSBMHBCK=$$GET^XPAR("ALL","PSB MED HIST DAYS BACK",,"B") I +PSBMHBCK=0 S PSBMHBCK=30
"RTN","PSBCSUTL",26,0)
 D NOW^%DTC S PSBWADM=$$FMADD^XLFDT(%,"","",+PSBWADM),PSBMHBCK=$$FMADD^XLFDT(%,-1*(PSBMHBCK))
"RTN","PSBCSUTL",27,0)
 ;use lst movemnt for API
"RTN","PSBCSUTL",28,0)
 S VAIP("D")="LAST" D IN5^VADPT S PSBTRDT=+VAIP(3),PSBTRTYP=$P(VAIP(2),U,2),PSBMVTYP=$P(VAIP(4),U,2) K VAIP
"RTN","PSBCSUTL",29,0)
 S PSBPTTR=$$GET^XPAR("DIV","PSB PATIENT TRANSFER") I PSBPTTR="" S PSBPTTR=72
"RTN","PSBCSUTL",30,0)
 D NOW^%DTC S PSBNTDT=$$FMADD^XLFDT(%,"",-PSBPTTR) I PSBNTDT'>PSBTRDT S PSBTRFL=1
"RTN","PSBCSUTL",31,0)
 S X1=$P(PSBNOW,"."),X2=-3 D C^%DTC
"RTN","PSBCSUTL",32,0)
 D EN^PSJBCMA(PSBDFNX,X,$S(PSBMHBCK<PSBWBEG:PSBMHBCK,PSBWBEG<PSBMHBCK:PSBWBEG,1:PSBMHBCK))
"RTN","PSBCSUTL",33,0)
 ;Devlop Outp
"RTN","PSBCSUTL",34,0)
 S PSBTBOUT=0
"RTN","PSBCSUTL",35,0)
 I ^TMP("PSJ",$J,1,0)>0 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBCSUTL",36,0)
 .S:(PSBTAB'="CVRSHT")&($G(^TMP("PSB",$J,"CVRSHT",2))>0) PSBTBOUT=1
"RTN","PSBCSUTL",37,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX),NOW^%DTC
"RTN","PSBCSUTL",38,0)
 .Q:PSBONX["P"  Q:(PSBOSP<PSBWBEG)&'(PSBONX["V")  ;in rnge?
"RTN","PSBCSUTL",39,0)
 .S (PSBREC,PSBONTAB)=""
"RTN","PSBCSUTL",40,0)
 .S $P(PSBREC,U,1)=PSBDFN ;Dfn
"RTN","PSBCSUTL",41,0)
 .S $P(PSBREC,U,2)=PSBONX ;OrdX 
"RTN","PSBCSUTL",42,0)
 .S $P(PSBREC,U,3)=PSBON ;Ord#
"RTN","PSBCSUTL",43,0)
 .S $P(PSBREC,U,4)=PSBOTYP ;v/u/p
"RTN","PSBCSUTL",44,0)
 .S $P(PSBREC,U,5)=PSBSCHT ;Schtyp
"RTN","PSBCSUTL",45,0)
 .S $P(PSBREC,U,6)=PSBSCH ;Sch
"RTN","PSBCSUTL",46,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; slfmed
"RTN","PSBCSUTL",47,0)
 .S $P(PSBREC,U,8)=PSBOITX ;Drgnm
"RTN","PSBCSUTL",48,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ;Dose
"RTN","PSBCSUTL",49,0)
 .S $P(PSBREC,U,10)=PSBMR ;med route
"RTN","PSBCSUTL",50,0)
 .;Lst Gvn -AOIP xRef
"RTN","PSBCSUTL",51,0)
 .S (PSBCNT,PSBFLAG)=0,(Y,PSBSTUS)="" K PSBHSTA,PSBHSTAX
"RTN","PSBCSUTL",52,0)
 .F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",53,0)
 ..S:Y>0 $P(PSBREC,U,11)=Y
"RTN","PSBCSUTL",54,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",PSBDFN,PSBOIT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",55,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9) S:$G(PSBSTUS)="" PSBSTUS="X" I (PSBSTUS'="N") S PSBFLAG=1,PSBHSTA(Y,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBCSUTL",56,0)
 ...D:PSBSTUS="N"
"RTN","PSBCSUTL",57,0)
 ....S ($P(PSBREC,U,11),Z)=""
"RTN","PSBCSUTL",58,0)
 ....F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",59,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",60,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",61,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBCSUTL",62,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBCSUTL",63,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBCSUTL",64,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBCSUTL",65,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBCSUTL",66,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBCSUTL",67,0)
 .S $P(PSBREC,U,12)="" ;ien - below
"RTN","PSBCSUTL",68,0)
 .S $P(PSBREC,U,13)="" ;sttus - below
"RTN","PSBCSUTL",69,0)
 .S $P(PSBREC,U,14)="" ;admn dte - below
"RTN","PSBCSUTL",70,0)
 .S $P(PSBREC,U,15)=PSBOIT ;OI Pointer
"RTN","PSBCSUTL",71,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;njctble med route flag
"RTN","PSBCSUTL",72,0)
 .;Var dosg
"RTN","PSBCSUTL",73,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBCSUTL",74,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBCSUTL",75,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH") $P(PSBREC,U,18)=PSBDOSEF ;DosgFrm
"RTN","PSBCSUTL",76,0)
 .D PSJ1^PSBVT(PSBDFN,PSBONX)
"RTN","PSBCSUTL",77,0)
 .S PSBPB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,+$G(PSBIVPSH)),PSBLVIV=0
"RTN","PSBCSUTL",78,0)
 .Q:PSBPB&(PSBOSP<PSBWBEG)
"RTN","PSBCSUTL",79,0)
 .S:(PSBONX["V"&'PSBPB) PSBLVIV=1
"RTN","PSBCSUTL",80,0)
 .S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***") ;VerfNrsInts
"RTN","PSBCSUTL",81,0)
 .S $P(PSBREC,U,20)=PSBSTUS S:$P(PSBREC,U,11)="" $P(PSBREC,U,20)=""  ;LstActn
"RTN","PSBCSUTL",82,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBCSUTL",83,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBCSUTL",84,0)
 .S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBCSUTL",85,0)
 .S $P(PSBREC,U,26)=PSBOSP  ;OrdStpDt/Tm
"RTN","PSBCSUTL",86,0)
 .S $P(PSBREC,U,27)=$$LASTG($P(PSBREC,U,1),$P(PSBREC,U,15))
"RTN","PSBCSUTL",87,0)
 .S $P(PSBREC,U,28)=$S((PSBONX["U")&('PSBPB):1,PSBPB:2,(PSBONX["V")&'PSBPB:3,1:"")
"RTN","PSBCSUTL",88,0)
 .;get all Admn(s) - DD info.
"RTN","PSBCSUTL",89,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBCSUTL",90,0)
 .I PSBLVIV D XFERBAGS^PSBCSUTY,LVIV^PSBCSUTY I $G(PSBEXPRD) S X1=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,X1)'="END" ^TMP("PSB",$J,PSBTAB,X1+1)="END" Q
"RTN","PSBCSUTL",91,0)
 .D GETADMX^PSBCSUTY
"RTN","PSBCSUTL",92,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBCSUTL",93,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1  ;drug nactvt
"RTN","PSBCSUTL",94,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ;nactv
"RTN","PSBCSUTL",95,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBCSUTL",96,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBCSUTL",97,0)
 .;OnCa O PRN
"RTN","PSBCSUTL",98,0)
 .I ("^O^OC^P^"[(U_PSBSCHT_U))!(PSBLVIV) D  S ($P(PSBREC,U,12),$P(PSBREC,U,14))=""  Q
"RTN","PSBCSUTL",99,0)
 ..S (PSBIENX,PSBGOT1)="",PSBADMTM="" F  S PSBADMTM=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM)) Q:(PSBADMTM="")  D
"RTN","PSBCSUTL",100,0)
 ...Q:(PSBADMTM<PSBMHBCK)&'PSBLVIV
"RTN","PSBCSUTL",101,0)
 ...F  S PSBIENX=$O(^PSB(53.79,"AORDX",PSBDFNX,PSBONX,PSBADMTM,PSBIENX)) Q:PSBIENX=""  D
"RTN","PSBCSUTL",102,0)
 ....S $P(PSBREC,U,12)=PSBIENX,$P(PSBREC,U,14)=PSBADMTM,$P(PSBREC,U,23)=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTL",103,0)
 ....S PSBQRR=1 D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBADMTM,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",104,0)
 ..I ('+PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",105,0)
 ..I ('+PSBGOT1)&($D(PSBADMX(PSBONX))) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTL",106,0)
 ..S PSBGLBX=$O(^TMP("PSB",$J,PSBTAB,""),-1) S:^TMP("PSB",$J,PSBTAB,PSBGLBX)'="END" ^TMP("PSB",$J,PSBTAB,PSBGLBX+1)="END"
"RTN","PSBCSUTL",107,0)
 .;cont - proces AdmnTm
"RTN","PSBCSUTL",108,0)
 .S (PSBYES,PSBODD,PSBYTF)=0 S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBCSUTL",109,0)
 .I PSBYES,PSBADST="" Q
"RTN","PSBCSUTL",110,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBCSUTL",111,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" Q
"RTN","PSBCSUTL",112,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBCSUTL",113,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBCSUTL",114,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBCSUTL",115,0)
 .S:PSBLVIV PSBYES=1
"RTN","PSBCSUTL",116,0)
 .I 'PSBYES,PSBFREQ<1 Q
"RTN","PSBCSUTL",117,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1(PSBTAB) Q
"RTN","PSBCSUTL",118,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBCSUTL",119,0)
 .I PSBODD,PSBADST'="" Q
"RTN","PSBCSUTL",120,0)
 .S PSBDTX=PSBWBEG\1,PSBGOT1=0
"RTN","PSBCSUTL",121,0)
 .F PSBXX=1:1:2 D  S PSBDTX=$$FMADD^XLFDT(PSBDTX,"",24)  ;incrmnt 1 day!
"RTN","PSBCSUTL",122,0)
 ..F PSBY=1:1:$L(PSBADST,"-") Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBCSUTL",123,0)
 ...S PSB=+(PSBDTX_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",124,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",125,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)    ;actv?
"RTN","PSBCSUTL",126,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",127,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",128,0)
 ...S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBCSUTL",129,0)
 ...I (PSB'<PSBWBEG)&(PSB'>PSBWEND) D  ;wndow?
"RTN","PSBCSUTL",130,0)
 ....D:(PSB'<PSBOST)&(PSB<PSBOSP)    ;actv?
"RTN","PSBCSUTL",131,0)
 .....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ;dt?
"RTN","PSBCSUTL",132,0)
 ......D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"CVRSHT") S PSBGOT1=1
"RTN","PSBCSUTL",133,0)
 .I ('PSBGOT1)&(PSBOSP'<PSBWBEG) D ADD^PSBVDLU1(PSBREC,PSBOTXT,+(PSBWEND\1_"."_$P(PSBADST,"-")),PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTL",134,0)
 .K PSBSTUS
"RTN","PSBCSUTL",135,0)
 D EN^PSBVDLPA
"RTN","PSBCSUTL",136,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S PSBI1=$O(^TMP("PSB",$J,PSBTAB,""),-1) I ^TMP("PSB",$J,PSBTAB,PSBI1)'="END" S ^TMP("PSB",$J,PSBTAB,PSBI1+1)="END"
"RTN","PSBCSUTL",137,0)
 S ^TMP("PSB",$J,PSBTAB,0)=$O(^TMP("PSB",$J,PSBTAB,""),-1)
"RTN","PSBCSUTL",138,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))']"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="-1^No orders To display on Coversheet"
"RTN","PSBCSUTL",139,0)
 I $G(^TMP("PSB",$J,PSBTAB,2))]"" S $P(^TMP("PSB",$J,PSBTAB,1),U,4)="1^COVERSHEET DATA FOLLOWS" D ADD^PSBCSUTX
"RTN","PSBCSUTL",140,0)
 D CLEAN
"RTN","PSBCSUTL",141,0)
 Q
"RTN","PSBCSUTL",142,0)
LASTG(PSBPATPT,PSBOIPT) ;LstGvn-(inpt: DFN,OrItm IEN)
"RTN","PSBCSUTL",143,0)
 K PSBHSTG S Y="",LASTG="" F XZ=1:1:20 S Y=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y),-1),(PSBCNT,PSBFLAG)=0 Q:Y=""  D
"RTN","PSBCSUTL",144,0)
 .S:Y>0 LASTG="",X="" F  S X=$O(^PSB(53.79,"AOIP",PSBPATPT,PSBOIPT,Y,X),-1) Q:X=""  D
"RTN","PSBCSUTL",145,0)
 ..S PSBSTX=$P(^PSB(53.79,X,0),U,9) S:PSBSTX']"" PSBHSTG(Y)=-1 I PSBSTX="G"  S PSBHSTG(Y)="G"
"RTN","PSBCSUTL",146,0)
 ..Q:PSBSTX="N"
"RTN","PSBCSUTL",147,0)
 ..D:(PSBSTX'="G")
"RTN","PSBCSUTL",148,0)
 ...S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBCSUTL",149,0)
 ....I (PSBDATA["Set to 'GIVEN'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",150,0)
 ....I (PSBDATA["STATUS 'GIVEN'") S PSBCNT=PSBCNT+1
"RTN","PSBCSUTL",151,0)
 ....I PSBCNT#2=0,PSBDATA'["'GIVEN'" Q
"RTN","PSBCSUTL",152,0)
 ....I '$D(PSBHSTG($P(PSBDATA,U))) S PSBFLAG=1,PSBHSTG($P(PSBDATA,U))=""
"RTN","PSBCSUTL",153,0)
 I $D(PSBHSTG) S LASTG="" F  S LASTG=$O(PSBHSTG(LASTG),-1) Q:+LASTG=0  Q:PSBHSTG(LASTG)="G"  I PSBHSTG(LASTG)=-1 S LASTG="" Q
"RTN","PSBCSUTL",154,0)
 Q LASTG
"RTN","PSBCSUTL",155,0)
LIGHTS(PSBDFN) ;
"RTN","PSBCSUTL",156,0)
 D RPC^PSBVDLTB(,PSBDFN,"NO TAB",) S PSBTAB="CVRSHT"
"RTN","PSBCSUTL",157,0)
 M ^TMP("PSB",$J,PSBTAB,1)=^TMP("PSB",$J,"NO TAB",1) K ^TMP("PSB",$J,"NO TAB")
"RTN","PSBCSUTL",158,0)
 Q
"RTN","PSBCSUTL",159,0)
CLEAN ;
"RTN","PSBCSUTL",160,0)
 D CLEAN^PSBVT
"RTN","PSBCSUTL",161,0)
 K PSBACT,PSBACTBY,PSBACTDT,PSBACTPT,PSBADDS,PSBBAGID,PSBCHDT,PSBCHKV,PSBCNT1,PSBCNT2,PSBDDS,PSBDFNX,PSBWEND
"RTN","PSBCSUTL",162,0)
 K PSBDT,PSBFLAG,PSBHSTAX,PSBI1,PSBIEN,PSBIENX,PSBLSTS,PSBMAUD,PSBMVTYP,PSBMWC,PSBNOW,PSBNTDT,PSBONMBR,PSBY,PSBXX
"RTN","PSBCSUTL",163,0)
 K PSBONXS,PSBORREC,PSBPDT,PSBPRNRE,PSBPTTR,PSBQR,PSBRDOW,PSBREC,PSBRECHD,PSBSCHBR,PSBSCHTM,PSBSOLS,PSBTAB,PSBADMTM,PSBDTX
"RTN","PSBCSUTL",164,0)
 K PSBTBOUT,PSBTRDT,PSBTRFL,PSBTRTYP,PSBUID,PSBUIDS,PSBX,PSBXIEN,PSBX2,PSBYEA,PSBYEA1,PSBYTF,PSBYES,VAIP,PSBWADM,PSBWBEG
"RTN","PSBCSUTL",165,0)
 K PSBXREC,PSBGOT1,PSBCDT,PSBQUIT,PSBUSED,PSBLST4X,PSBADMX,PSBI2,PSBXXX,PSBI,PSBPB,PSBSHWTB,PSBONTAB,PSBDONE,^TMP("PSJ",$J)
"RTN","PSBCSUTL",166,0)
 K PSBNXTDU,LASTG,LSTTIME,PSBMHBCK,PSBHSTG,PSBNXTDT,NEXTADM,PSBLVIV
"RTN","PSBCSUTL",167,0)
 Q
"RTN","PSBCSUTX")
0^10^B62829638^B78303576
"RTN","PSBCSUTX",1,0)
PSBCSUTX ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES 2 ;Mar 2004
"RTN","PSBCSUTX",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16,13,38,32**;Mar 2004;Build 32
"RTN","PSBCSUTX",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBCSUTX",4,0)
 ; Reference/IA
"RTN","PSBCSUTX",5,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTX",6,0)
 ; $$SCH^XLFDT/10103
"RTN","PSBCSUTX",7,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBCSUTX",8,0)
ADD ; otput: ORD-ORC-DD-ADD-SOL-ID-ADM-CMT-END segmnts
"RTN","PSBCSUTX",9,0)
 K PSBDONE S PSBRECHD="ORD",PSBDONE=0,PSBCNT1=^TMP("PSB",$J,PSBTAB,0),PSBCNT2=1,$P(^TMP("PSB",$J,"CVRSHT2",0),U)=0
"RTN","PSBCSUTX",10,0)
 F PSBI1=1:1:PSBCNT1 D  Q:PSBDONE
"RTN","PSBCSUTX",11,0)
 .I PSBCNT1'>1 S PSBDONE=1 Q
"RTN","PSBCSUTX",12,0)
 .I PSBI1=1 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT2)=^TMP("PSB",$J,"CVRSHT",1) Q
"RTN","PSBCSUTX",13,0)
 .I ^TMP("PSB",$J,PSBTAB,PSBI1)="END" S PSBRECHD="ORD",PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="END"  Q
"RTN","PSBCSUTX",14,0)
 .I PSBRECHD="ORD" D ORD Q
"RTN","PSBCSUTX",15,0)
 .I PSBRECHD="ORC" D ORC^PSBCSUTY Q
"RTN","PSBCSUTX",16,0)
 .I PSBRECHD="ORF" D ORF^PSBCSUTY
"RTN","PSBCSUTX",17,0)
 .I PSBRECHD="MED" D MED^PSBCSUTY Q
"RTN","PSBCSUTX",18,0)
 S $P(^TMP("PSB",$J,"CVRSHT2",0),U)=PSBCNT2
"RTN","PSBCSUTX",19,0)
 M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K PSBNXTDU D ADM
"RTN","PSBCSUTX",20,0)
 K ^TMP("PSB",$J,PSBTAB) M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K ^TMP("PSB",$J,"CVRSHT2") D FINALPAS^PSBCSUTY
"RTN","PSBCSUTX",21,0)
 K ^TMP("PSB",$J,PSBTAB) M ^TMP("PSB",$J,PSBTAB)=^TMP("PSB",$J,"CVRSHT2") K ^TMP("PSB",$J,"CVRSHT2")
"RTN","PSBCSUTX",22,0)
 Q
"RTN","PSBCSUTX",23,0)
ORD ;
"RTN","PSBCSUTX",24,0)
 S PSBCNT2=PSBCNT2+1,(PSBORREC,PSBXREC)=^TMP("PSB",$J,PSBTAB,PSBI1)
"RTN","PSBCSUTX",25,0)
 S ($P(PSBXREC,U,12),$P(PSBXREC,U,23),$P(PSBXREC,U,24),PSBSCHTM,PSBONMBR,PSBIENX,PSBBAGID,PSBACT,PSBACTBY,PSBACTDT,PSBACTPT,PSBPRNRE,PSBXX,PSBXXX)=""
"RTN","PSBCSUTX",26,0)
 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORD",$P(^TMP("PSB",$J,"CVRSHT2",PSBCNT2),U,2)=PSBXREC
"RTN","PSBCSUTX",27,0)
 S PSBSCHTM=$P(PSBORREC,U,14),PSBONMBR=$P(PSBORREC,U,2),PSBIENX=$P(PSBORREC,U,12),PSBLRGIV=0
"RTN","PSBCSUTX",28,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBONMBR) S:(PSBONMBR["V")&'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,+$G(PSBIVPSH)) PSBLRGIV=1
"RTN","PSBCSUTX",29,0)
 I '$D(PSBLST4X(PSBONMBR)) S PSBXX="" F PSBI=1:1 S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX),-1) Q:PSBXX=""  S PSBXXX="" D  Q:$G(PSBLST4X(PSBONMBR))=4
"RTN","PSBCSUTX",30,0)
 .F  S PSBXXX=$O(PSBADMX(PSBONMBR,PSBXX,PSBXXX)) Q:PSBXXX=""  D  Q:$G(PSBLST4X(PSBONMBR))=4
"RTN","PSBCSUTX",31,0)
 ..I $$GET1^DIQ(53.79,PSBXXX_",","ACTION STATUS","I")'="N" S PSBLST4X(PSBONMBR,PSBXXX)="",PSBLST4X(PSBONMBR)=$G(PSBLST4X(PSBONMBR))+1
"RTN","PSBCSUTX",32,0)
 ..I ($$GET1^DIQ(53.79,PSBXXX_",","ACTION STATUS","I")="N")&($O(PSBADMX(PSBONMBR,PSBXX))="")  S PSBLST4X(PSBONMBR,PSBXXX)="",PSBLST4X(PSBONMBR)=$G(PSBLST4X(PSBONMBR))+1
"RTN","PSBCSUTX",33,0)
 I PSBIENX]"",$D(PSBLST4X(PSBONMBR,PSBIENX)) D
"RTN","PSBCSUTX",34,0)
 .S PSBBAGID=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTX",35,0)
 .S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",36,0)
 .S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",37,0)
 .S PSBPRNRE=$$GET1^DIQ(53.79,PSBIENX_",","PRN REASON")
"RTN","PSBCSUTX",38,0)
 .S PSBACTBY=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY:INITIAL") S:PSBACTBY']"" PSBACTBY="***"
"RTN","PSBCSUTX",39,0)
 .S PSBACTPT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY","I")
"RTN","PSBCSUTX",40,0)
 .I '$D(PSBDONE(PSBIENX)) D
"RTN","PSBCSUTX",41,0)
 ..I PSBLRGIV,(PSBFON]"") Q
"RTN","PSBCSUTX",42,0)
 ..S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^"_PSBBAGID_"^"_PSBIENX_"^"_PSBACT_"^"_PSBACTDT_"^"_PSBACTBY_"^"_PSBACTPT_"^"_PSBPRNRE
"RTN","PSBCSUTX",43,0)
 ..I PSBLRGIV D
"RTN","PSBCSUTX",44,0)
 ...I PSBOSP<PSBNOW S PSBADMS(PSBONMBR,"EXP")=""
"RTN","PSBCSUTX",45,0)
 ...S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX,1)=1
"RTN","PSBCSUTX",46,0)
 ..S PSBDONE(PSBIENX)="" K PSBADMX(PSBONMBR,PSBSCHTM,PSBIENX) D
"RTN","PSBCSUTX",47,0)
 ...S PSBXX="" F  S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX)) Q:PSBXX=""  I $D(PSBADMX(PSBONMBR,PSBXX,PSBIENX)) K PSBADMX(PSBONMBR,PSBXX,PSBIENX)
"RTN","PSBCSUTX",48,0)
 I PSBIENX']"" D
"RTN","PSBCSUTX",49,0)
 .S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^^^^^^^"
"RTN","PSBCSUTX",50,0)
 .I PSBLRGIV S PSBADMS(PSBONMBR,PSBSCHTM,1)=1
"RTN","PSBCSUTX",51,0)
 I "^O^OC^P^"[(U_PSBSCHT_U)&('$D(PSBADMS(PSBONMBR))) S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^^^^^^^"
"RTN","PSBCSUTX",52,0)
 S PSBRECHD="ORC" K PSBSCHTM S PSBXREC=""
"RTN","PSBCSUTX",53,0)
 Q
"RTN","PSBCSUTX",54,0)
ADM ; Admn data
"RTN","PSBCSUTX",55,0)
 K PSBDONE S (PSBONMBR,PSBSCHTM)="" F PSBI1=2:1:$P(^TMP("PSB",$J,PSBTAB,0),U) D
"RTN","PSBCSUTX",56,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1),U)="ORD" S PSBONMBR=$P(^TMP("PSB",$J,PSBTAB,PSBI1),U,3),$P(^TMP("PSB",$J,"CVRSHT2",PSBI1),U,15)=""
"RTN","PSBCSUTX",57,0)
 .S (PSBXX,PSBXXX)="" F  S PSBXX=$O(PSBADMX(PSBONMBR,PSBXX)) Q:PSBXX=""  F  S PSBXXX=$O(PSBADMX(PSBONMBR,PSBXX,PSBXXX)) Q:PSBXXX=""  D
"RTN","PSBCSUTX",58,0)
 ..S PSBSCHTM=PSBXX,PSBIENX=PSBXXX
"RTN","PSBCSUTX",59,0)
 ..I $D(PSBNOX(PSBONMBR)) I $P(^TMP("PSB",$J,"CVRSHT2",$O(PSBNOX(PSBONMBR,""))),U)="NOX" K ^TMP("PSB",$J,"CVRSHT2",$O(PSBNOX(PSBONMBR,"")))
"RTN","PSBCSUTX",60,0)
 ..Q:'$D(PSBLST4X(PSBONMBR,PSBIENX))
"RTN","PSBCSUTX",61,0)
 ..S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",62,0)
 ..I PSBACT']"" S PSBACT="U"
"RTN","PSBCSUTX",63,0)
 ..S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",64,0)
 ..S PSBBAGID=$$GET1^DIQ(53.79,PSBIENX_",","IV UNIQUE ID")
"RTN","PSBCSUTX",65,0)
 ..S PSBPRNRE=$$GET1^DIQ(53.79,PSBIENX_",","PRN REASON")
"RTN","PSBCSUTX",66,0)
 ..S PSBACTBY=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY:INITIAL") S:PSBACTBY']"" PSBACTBY="***"
"RTN","PSBCSUTX",67,0)
 ..S PSBACTPT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION BY","I")
"RTN","PSBCSUTX",68,0)
 ..S PSBADMS(PSBONMBR,PSBSCHTM_PSBIENX)=PSBSCHTM_"^"_PSBBAGID_"^"_PSBIENX_"^"_PSBACT_"^"_PSBACTDT_"^"_PSBACTBY_"^"_PSBACTPT_"^"_PSBPRNRE
"RTN","PSBCSUTX",69,0)
 ..I PSBIENX]"" K PSBADMX(PSBONMBR,PSBSCHTM,PSBIENX)
"RTN","PSBCSUTX",70,0)
 .I '$D(PSBADMS(PSBONMBR)) K ^TMP("PSB",$J,"CVRSHT2",PSBI1) Q
"RTN","PSBCSUTX",71,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1),U)="END" K PSBADMS(PSBONMBR) Q
"RTN","PSBCSUTX",72,0)
 .I $P(^TMP("PSB",$J,PSBTAB,PSBI1+1),U)="END" D  Q
"RTN","PSBCSUTX",73,0)
 ..S PSBCNT2=1,PSBSCHTM=""
"RTN","PSBCSUTX",74,0)
 ..F  S PSBSCHTM=$O(PSBADMS(PSBONMBR,PSBSCHTM)) Q:+$G(PSBSCHTM)=0  D
"RTN","PSBCSUTX",75,0)
 ...S PSBIENX=$P(PSBADMS(PSBONMBR,PSBSCHTM),U,3)
"RTN","PSBCSUTX",76,0)
 ...I PSBIENX]"",'$D(PSBDONE(PSBIENX))  D
"RTN","PSBCSUTX",77,0)
 ....I $D(PSBNOX(PSBONMBR)) I $P(^TMP("PSB",$J,"CVRSHT2",$O(PSBNOX(PSBONMBR,""))),U)="NOX" K ^TMP("PSB",$J,"CVRSHT2",$O(PSBNOX(PSBONMBR,"")))
"RTN","PSBCSUTX",78,0)
 ....S PSBACT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION STATUS","I")
"RTN","PSBCSUTX",79,0)
 ....I PSBACT']"" S PSBACT="U"
"RTN","PSBCSUTX",80,0)
 ....S PSBACTDT=$$GET1^DIQ(53.79,PSBIENX_",","ACTION DATE/TIME","I")
"RTN","PSBCSUTX",81,0)
 ....Q:PSBACT="N"
"RTN","PSBCSUTX",82,0)
 ....Q:$D(PSBADMS(PSBONMBR,"EXP"))&("SI"'[PSBACT)
"RTN","PSBCSUTX",83,0)
 ....S $P(PSBADMS(PSBONMBR,PSBSCHTM),U,4)=PSBACT
"RTN","PSBCSUTX",84,0)
 ....S ^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2)="ADM^"_PSBADMS(PSBONMBR,PSBSCHTM)_"^"_$$NEXTADM(PSBDFNX,PSBONMBR),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTX",85,0)
 ....S PSBDONE(PSBIENX)=""
"RTN","PSBCSUTX",86,0)
 ....D CMT^PSBCSUTY
"RTN","PSBCSUTX",87,0)
 ...I (PSBIENX']"")&($G(PSBADMS(PSBONMBR,PSBSCHTM,1))'=1) D
"RTN","PSBCSUTX",88,0)
 ....S ^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2)="ADM^"_PSBADMS(PSBONMBR,PSBSCHTM)_"^"_$$NEXTADM(PSBDFNX,PSBONMBR),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTX",89,0)
 ....I $D(PSBNOX(PSBONMBR)) I $P(^TMP("PSB",$J,"CVRSHT2",$O(PSBNOX(PSBONMBR,""))),U)="NOX" K ^TMP("PSB",$J,"CVRSHT2",$O(PSBNOX(PSBONMBR,"")))
"RTN","PSBCSUTX",90,0)
 K PSBSCHTM
"RTN","PSBCSUTX",91,0)
 Q
"RTN","PSBCSUTX",92,0)
NEXTADM(XX,YY) ;
"RTN","PSBCSUTX",93,0)
 S NEXTADM=""
"RTN","PSBCSUTX",94,0)
 I $D(PSBNXTDU(YY)) S NEXTADM=PSBNXTDU(YY) Q NEXTADM
"RTN","PSBCSUTX",95,0)
 D:YY'["P"
"RTN","PSBCSUTX",96,0)
 .S PSBPATX=XX,PSBORXX=YY D CLEAN^PSBVT,PSJ1^PSBVT(XX,YY)
"RTN","PSBCSUTX",97,0)
 .Q:(PSBORXX["V")&'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,+$G(PSBIVPSH))
"RTN","PSBCSUTX",98,0)
 .S PSBGSCH=PSBADST,XX=PSBPATX,YY=PSBORXX,(NEXTADM,X,Y)="",X=$O(^PSB(53.79,"AORD",XX,YY,X),-1)
"RTN","PSBCSUTX",99,0)
 .I X]"" S Y=$O(^PSB(53.79,"AORD",XX,YY,X,Y),-1) I ($F("NM",$P(^PSB(53.79,Y,0),U,9))>1)!($P(^PSB(53.79,Y,0),U,9)="") S NEXTADM=X
"RTN","PSBCSUTX",100,0)
 .D:X']""
"RTN","PSBCSUTX",101,0)
 ..S Y="",X=$O(^PSB(53.79,"AORDX",XX,YY,X),-1)
"RTN","PSBCSUTX",102,0)
 ..I X]"" S Y=$O(^PSB(53.79,"AORDX",XX,YY,X,Y),-1) I $F("NM",$P(^PSB(53.79,Y,0),U,9))>1!($P(^PSB(53.79,Y,0),U,9)="") S NEXTADM=$P(^PSB(53.79,Y,0),U,6)
"RTN","PSBCSUTX",103,0)
 .D:NEXTADM=""
"RTN","PSBCSUTX",104,0)
 ..S PSBGOTY=Y,PSBFREQ=$$GETFREQ^PSBVDLU1(XX,YY)
"RTN","PSBCSUTX",105,0)
 ..S PSBFREQ=$S(PSBFREQ="O":1440,PSBFREQ="D":"",1:PSBFREQ)
"RTN","PSBCSUTX",106,0)
 ..S (PSBXSCH,LSTTIME,LSTIEN)=""
"RTN","PSBCSUTX",107,0)
 ..S:PSBGOTY]"" LSTTIME=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,LSTTIME),-1) I LSTTIME]"" S LSTIEN=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,LSTTIME,""),-1)
"RTN","PSBCSUTX",108,0)
 ..I LSTIEN]"" S:$P(^PSB(53.79,LSTIEN,0),U,9)']"" LSTTIME=""
"RTN","PSBCSUTX",109,0)
 ..S:LSTTIME="" LSTTIME=$$FMADD^XLFDT(PSBOST,,,,-0.1)
"RTN","PSBCSUTX",110,0)
 ..I +PSBFREQ>0 S PSBXSCH=(+PSBFREQ/60)_"H"
"RTN","PSBCSUTX",111,0)
 ..S X=LSTTIME
"RTN","PSBCSUTX",112,0)
 ..F PSBIX1=1:1:($L(PSBGSCH,"-")+1) D  Q:NEXTADM>LSTTIME
"RTN","PSBCSUTX",113,0)
 ...I ($P(PSBGSCH,"-",PSBIX1))']"" D  Q
"RTN","PSBCSUTX",114,0)
 ....I PSBIX1=1 D  Q
"RTN","PSBCSUTX",115,0)
 .....I X<PSBOST S NEXTADM=PSBOST Q
"RTN","PSBCSUTX",116,0)
 .....S X=PSBOST F  S X=$$SCH^XLFDT(PSBXSCH,X) S Y="" S Y=$O(^PSB(53.79,"AORD",PSBPATX,PSBORXX,Y),-1)  I X>Y S NEXTADM=X Q
"RTN","PSBCSUTX",117,0)
 ....I PSBGSCH]"" D  Q
"RTN","PSBCSUTX",118,0)
 .....I (+PSBFREQ'>1440) F I=0:1 S PSBDTXX=$$FMADD^XLFDT(PSBOST,I) S $P(PSBDTXX,".",2)=($P(PSBGSCH,"-")) I PSBDTXX>LSTTIME S NEXTADM=PSBDTXX Q
"RTN","PSBCSUTX",119,0)
 .....I (+PSBFREQ'<1440),(1440#PSBFREQ=1440) F I=0:1 S PSBDTXX=$$FMADD^XLFDT(PSBOST,(I*(PSBFREQ\1440))) S $P(PSBDTXX,".",2)=($P(PSBGSCH,"-")) I PSBDTXX>LSTTIME S NEXTADM=PSBDTXX Q
"RTN","PSBCSUTX",120,0)
 ....S $P(X,".",2)=$P(PSBGSCH,"-"),NEXTADM=$$SCH^XLFDT(PSBXSCH,X) Q
"RTN","PSBCSUTX",121,0)
 ...S $P(X,".",2)=$P(PSBGSCH,"-",PSBIX1) S:X<PSBOSP NEXTADM=X
"RTN","PSBCSUTX",122,0)
 .S:NEXTADM'<PSBOSP NEXTADM=""
"RTN","PSBCSUTX",123,0)
 .I $$PSBDCHK1^PSBVT1(PSBSCH) D
"RTN","PSBCSUTX",124,0)
 ..S YY=PSBORXX,XX=PSBPATX
"RTN","PSBCSUTX",125,0)
 ..I $G(LSTTIME)]"" S NEXTADM=$S(LSTTIME'<PSBOST:LSTTIME,NEXTADM>LSTTIME:NEXTADM,1:PSBOST)
"RTN","PSBCSUTX",126,0)
 ..I PSBFREQ="" S PSBDTX=$P(NEXTADM,".") F PSBIX3=0:1 S X=$$FMADD^XLFDT(PSBDTX,PSBIX3) Q:X>PSBOSP  D  Q:$G(PSBYS)
"RTN","PSBCSUTX",127,0)
 ...S PSBNXTDT=X D DW^%DTC S PSBYS=0 F PSBIX2=1:1 S PSBDY=$P($P(PSBSCH,"@"),"-",PSBIX2) Q:PSBDY=""  I $F(X,PSBDY)>1 S PSBYS=1
"RTN","PSBCSUTX",128,0)
 ...I PSBYS S PSBSCTM=$$GETADMIN^PSBVDLU1(XX,YY,PSBNXTDT,"","") K ^TMP("PSB",$J,"GETADMIN") D
"RTN","PSBCSUTX",129,0)
 ....F PSBIX4=1:1 S PSBTX=$P(PSBSCTM,"-",PSBIX4) Q:PSBTX=""  D  Q:PSBYS
"RTN","PSBCSUTX",130,0)
 .....I NEXTADM>(PSBNXTDT_"."_PSBTX) S PSBYS=0 Q
"RTN","PSBCSUTX",131,0)
 .....S NEXTADM=PSBNXTDT,$P(NEXTADM,".",2)=PSBTX
"RTN","PSBCSUTX",132,0)
 .....I NEXTADM]"" I (NEXTADM<PSBOST)!$D(^PSB(53.79,"AORD",PSBPATX,PSBORXX,+NEXTADM))!(NEXTADM>PSBOSP) S PSBYS=0,NEXTADM="" Q
"RTN","PSBCSUTX",133,0)
 .....S PSBYS=1
"RTN","PSBCSUTX",134,0)
 .S PSBNXTDU(PSBORXX)=NEXTADM
"RTN","PSBCSUTX",135,0)
 .D CLEAN^PSBVT
"RTN","PSBCSUTX",136,0)
 Q NEXTADM
"RTN","PSBCSUTY")
0^24^B43368080^B23020024
"RTN","PSBCSUTY",1,0)
PSBCSUTY ;BIRMINGHAM/TEJ- BCMA-HSC COVER SHEET UTILITIES 3 ;Mar 2004
"RTN","PSBCSUTY",2,0)
 ;;3.0;BAR CODE MED ADMIN;**16,32**;Mar 2004;Build 32
"RTN","PSBCSUTY",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBCSUTY",4,0)
 ;
"RTN","PSBCSUTY",5,0)
 ; Reference/IA
"RTN","PSBCSUTY",6,0)
 ; $$GET1^DIQ/2056
"RTN","PSBCSUTY",7,0)
 ; File 200/10060
"RTN","PSBCSUTY",8,0)
CMT ; Comment per admin.
"RTN","PSBCSUTY",9,0)
 S (PSBIENX,PSBPRNRE)="",PSBIENX=+$P(PSBADMS(PSBONMBR,PSBSCHTM),U,3),PSBPRNRE=$P(PSBADMS(PSBONMBR,PSBSCHTM),U,8)
"RTN","PSBCSUTY",10,0)
 D:+$O(^PSB(53.79,PSBIENX,.3,""),-1)>0
"RTN","PSBCSUTY",11,0)
 .S PSBI2=0 F  S PSBI2=$O(^PSB(53.79,PSBIENX,.3,PSBI2)) Q:PSBI2=""  D
"RTN","PSBCSUTY",12,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U)="CMT",$P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,2)=$P(^PSB(53.79,PSBIENX,.3,PSBI2,0),U)
"RTN","PSBCSUTY",13,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,4)=$P(^PSB(53.79,PSBIENX,.3,PSBI2,0),U,2)
"RTN","PSBCSUTY",14,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,5)=$$GET1^DIQ(200,$P(^PSB(53.79,PSBIENX,.3,PSBI2,0),U,2)_",","INITIAL")
"RTN","PSBCSUTY",15,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,6)=$P(^PSB(53.79,PSBIENX,.3,PSBI2,0),U,3),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTY",16,0)
 D:($G(PSBPRNRE)]"")&($$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS")]"")
"RTN","PSBCSUTY",17,0)
 .S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U)="CMT",$P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,3)=$$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS")
"RTN","PSBCSUTY",18,0)
 .S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,4)=$$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS ENTERED BY","I")
"RTN","PSBCSUTY",19,0)
 .S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,5)=$$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS ENTERED BY:INITIAL")
"RTN","PSBCSUTY",20,0)
 .S $P(^TMP("PSB",$J,"CVRSHT2",PSBI1,PSBCNT2),U,6)=$$GET1^DIQ(53.79,PSBIENX_",","PRN EFFECTIVENESS ENTERED AT","I"),PSBCNT2=PSBCNT2+1
"RTN","PSBCSUTY",21,0)
 Q
"RTN","PSBCSUTY",22,0)
XFERBAGS ;
"RTN","PSBCSUTY",23,0)
 ;  Logic to "move IV bags"
"RTN","PSBCSUTY",24,0)
 ;  Construct Temp arrays PSBADMX,PSBDONE
"RTN","PSBCSUTY",25,0)
 Q:PSBPONX']""
"RTN","PSBCSUTY",26,0)
 K PSBCHKED
"RTN","PSBCSUTY",27,0)
 S PSBNX2=PSBONX,PSBDFN2=PSBDFN,PSBPNX2=PSBPONX,PSBFN2=PSBFON F  Q:PSBFN2]""  D  Q:PSBPONX']""  S PSBPNX2=PSBPONX I $G(PSBCHKED(PSBPONX))=1 K PSBCHKED Q
"RTN","PSBCSUTY",28,0)
 .D CLEAN^PSBVT S PSBPONX=PSBPNX2,PSBCHKED(PSBPONX)=1 D PSJ1^PSBVT(PSBDFN2,PSBPONX)
"RTN","PSBCSUTY",29,0)
 .S (PSBXX,PSBXXX)="" F  S PSBXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",30,0)
 ..S PSBXXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""  Q:$P(^PSB(53.79,PSBXXX,0),U,9)="C"  S:'$D(PSBDONE(PSBXXX)) (PSBADMX(PSBNX2,PSBXX,PSBXXX),PSBDONE(PSBXXX))=""
"RTN","PSBCSUTY",31,0)
 ; Refresh data
"RTN","PSBCSUTY",32,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(PSBDFN2,PSBNX2)
"RTN","PSBCSUTY",33,0)
 K PSBNX2,PSBDFN2,PSBPNX2,PSBFN2
"RTN","PSBCSUTY",34,0)
 Q
"RTN","PSBCSUTY",35,0)
GETADMX ;
"RTN","PSBCSUTY",36,0)
 S (PSBXX,PSBXXX)="" F  S PSBXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",37,0)
 .Q:(PSBXX<PSBMHBCK)&'PSBLVIV
"RTN","PSBCSUTY",38,0)
 .F  S PSBXXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""  Q:(PSBFON]"")&($P(^PSB(53.79,PSBXXX,0),U,9)'="C")&(PSBLVIV)  D
"RTN","PSBCSUTY",39,0)
 ..S (PSBADMX(PSBONX,PSBXX,PSBXXX),PSBDONE(PSBXXX))=""
"RTN","PSBCSUTY",40,0)
 ; Check "actions" that DO NOT get filed into AORDX !!
"RTN","PSBCSUTY",41,0)
 S (PSBXX,PSBXXX)="" F  S PSBXX=$O(^PSB(53.79,"AORD",PSBDFN,PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",42,0)
 .F  S PSBXXX=$O(^PSB(53.79,"AORD",PSBDFN,PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""  D
"RTN","PSBCSUTY",43,0)
 ..S:('$D(PSBDONE(PSBXXX)))&($P(^PSB(53.79,PSBXXX,0),U,6)'<PSBMHBCK) PSBADMX(PSBONX,PSBXX,PSBXXX)=""
"RTN","PSBCSUTY",44,0)
 K PSBXX,PSBXXX,PSBDONE
"RTN","PSBCSUTY",45,0)
 Q
"RTN","PSBCSUTY",46,0)
LVIV ;
"RTN","PSBCSUTY",47,0)
 ; Set up variables to later extract LVIV data
"RTN","PSBCSUTY",48,0)
 ; Add all LVIVs that have been active with in the window!!
"RTN","PSBCSUTY",49,0)
 I (PSBOSP'<PSBWBEG)&(PSBOSP'>PSBWEND) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"CVRSHT")
"RTN","PSBCSUTY",50,0)
 S PSBEXPRD=0 I (PSBFON']"")&(PSBOSP<PSBNOW) S PSBEXPRD=1
"RTN","PSBCSUTY",51,0)
 S (PSBXX,PSBXXX)="" F  S PSBXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",52,0)
 .S PSBXXX=$O(^PSB(53.79,"AORDX",PSBDFN,PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""
"RTN","PSBCSUTY",53,0)
 .I "IS"[$P(^PSB(53.79,PSBXXX,0),U,9)&(PSBFON']"") S PSBEXPRD=0
"RTN","PSBCSUTY",54,0)
 .S:'$D(PSBDONE(PSBXXX))&(PSBFON="") (PSBADMX(PSBONX,PSBXX,PSBXXX),PSBDONE(PSBXXX))=""
"RTN","PSBCSUTY",55,0)
 S (PSBXX,PSBXXX)="" F  S PSBXX=$O(PSBADMX(PSBONX,PSBXX)) Q:PSBXX=""  D
"RTN","PSBCSUTY",56,0)
 .S PSBXXX=$O(PSBADMX(PSBONX,PSBXX,PSBXXX)) Q:PSBXXX=""
"RTN","PSBCSUTY",57,0)
 .I "IS"[$P(^PSB(53.79,PSBXXX,0),U,9)&(PSBFON']"") S PSBEXPRD=0
"RTN","PSBCSUTY",58,0)
 .S:'$D(PSBDONE(PSBXXX))&(PSBFON="") (PSBADMX(PSBONX,PSBXX,PSBXXX),PSBDONE(PSBXXX))=""
"RTN","PSBCSUTY",59,0)
 Q
"RTN","PSBCSUTY",60,0)
QUT() ;
"RTN","PSBCSUTY",61,0)
 S QUT=0
"RTN","PSBCSUTY",62,0)
 I PSBOST>($$FMADD^XLFDT($$NOW^XLFDT,,,$$GET^XPAR("DIV","PSB ADMIN BEFORE"))) S QUT=1 Q QUT
"RTN","PSBCSUTY",63,0)
 I '(($F("ED",PSBOSTS)'>1)&(PSBOSP'<%)) S QUT=1 Q QUT
"RTN","PSBCSUTY",64,0)
 Q QUT
"RTN","PSBCSUTY",65,0)
USED() ;
"RTN","PSBCSUTY",66,0)
 S (PSBXIEN,PSBUSD,USED)=0,PSBBAGX=$P(PSBXREC,U,2)
"RTN","PSBCSUTY",67,0)
 I $$QUT() S (PSBUSD,USED)=1 Q PSBUSD
"RTN","PSBCSUTY",68,0)
 S PSBXXX="" F  S PSBXXX=$O(^PSB(53.79,"AUID",PSBDFNX,PSBXXX)) Q:PSBXXX=""  D  Q:PSBUSD
"RTN","PSBCSUTY",69,0)
 .I $D(^PSB(53.79,"AUID",PSBDFNX,PSBXXX,PSBBAGX)) S PSBXIEN=$O(^PSB(53.79,"AUID",PSBDFNX,PSBXXX,PSBBAGX,"")) S:$F("GICSHRM",$P(^PSB(53.79,PSBXIEN,0),U,9))>1 (PSBUSD,USED)=1,PSBOBAG(PSBONMBR)=""
"RTN","PSBCSUTY",70,0)
 Q USED
"RTN","PSBCSUTY",71,0)
ORC ; Ord cmmnts
"RTN","PSBCSUTY",72,0)
 S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORC",$P(^TMP("PSB",$J,"CVRSHT2",PSBCNT2),U,2)=^TMP("PSB",$J,PSBTAB,PSBI1),PSBRECHD="ORF"
"RTN","PSBCSUTY",73,0)
 Q
"RTN","PSBCSUTY",74,0)
ORF ; Ordr flag  "ORF^FLAG^Flg Comment"
"RTN","PSBCSUTY",75,0)
 K ^TMP("PSJ1",$J),PSBNOX
"RTN","PSBCSUTY",76,0)
 D EN^PSJBCMA1(PSBDFN,PSBONMBR,1)
"RTN","PSBCSUTY",77,0)
 ;Set STAT FLAG
"RTN","PSBCSUTY",78,0)
 I $P(^TMP("PSJ1",$J,7),U,1) S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORF^STAT"
"RTN","PSBCSUTY",79,0)
 ;Set IM/CPRS ord flg and cmment
"RTN","PSBCSUTY",80,0)
 I $P(^TMP("PSJ1",$J,7),U,2) D
"RTN","PSBCSUTY",81,0)
 .S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORF^CPRS^"_$P(^TMP("PSJ1",$J,7),U,3)_U_$P(^TMP("PSJ1",$J,7),U,4)
"RTN","PSBCSUTY",82,0)
 .I $P(^TMP("PSJ1",$J,7),U,3)']"" D
"RTN","PSBCSUTY",83,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBCNT2),U,2)="CPRS"
"RTN","PSBCSUTY",84,0)
 ..S $P(^TMP("PSB",$J,"CVRSHT2",PSBCNT2),U,3)="*PSJ DATA ERROR* ^ PSJ Order Flag Error"
"RTN","PSBCSUTY",85,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBCSUTY",86,0)
 ;Set No Act Flag
"RTN","PSBCSUTY",87,0)
 I ('$D(^PSB(53.79,"AORDX",PSBDFN,PSBONMBR))) I (PSBLRGIV) I '$D(PSBADMX(PSBONMBR)) I $P(PSBORREC,U,26)>$G(%,PSBNOW) D
"RTN","PSBCSUTY",88,0)
 .S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)="ORF^NOX^No Action Taken On Order"
"RTN","PSBCSUTY",89,0)
 .S PSBNOX(PSBONMBR,PSBCNT2)=""
"RTN","PSBCSUTY",90,0)
 S PSBRECHD="MED"
"RTN","PSBCSUTY",91,0)
 Q
"RTN","PSBCSUTY",92,0)
MED ; Cnstr DD,ADD,SOL,ID
"RTN","PSBCSUTY",93,0)
 F I=PSBI1:1 S PSBXREC=^TMP("PSB",$J,PSBTAB,I) Q:PSBXREC="END"  D
"RTN","PSBCSUTY",94,0)
 .I $P(PSBXREC,U)="ID" S PSBUSED=$$USED()  Q:PSBUSED
"RTN","PSBCSUTY",95,0)
 .S PSBCNT2=PSBCNT2+1,^TMP("PSB",$J,"CVRSHT2",PSBCNT2)=PSBXREC
"RTN","PSBCSUTY",96,0)
 S PSBI1=I-1
"RTN","PSBCSUTY",97,0)
 Q
"RTN","PSBCSUTY",98,0)
FINALPAS ;
"RTN","PSBCSUTY",99,0)
 S PSBI1="^TMP(""PSB"",$J,""CVRSHT"")",PSBCNT1=0
"RTN","PSBCSUTY",100,0)
 F  S PSBI1=$Q(@PSBI1) Q:PSBI1["CVRSHT2"  D
"RTN","PSBCSUTY",101,0)
 .I $QS(PSBI1,4)'>1 S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTY",102,0)
 .K PSBX2 M PSBX2=^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4))
"RTN","PSBCSUTY",103,0)
 .I $QS(PSBI1,5)="" S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTY",104,0)
 .K PSBDONE
"RTN","PSBCSUTY",105,0)
 .I '$D(PSBX2(1)) S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=@PSBI1,PSBCNT1=PSBCNT1+1 Q
"RTN","PSBCSUTY",106,0)
 .F PSBI2=1:1 Q:'$D(PSBX2(PSBI2))  D  ;sort actn/cmmnt rev. chrono
"RTN","PSBCSUTY",107,0)
 ..Q:$D(PSBDONE(PSBI2))
"RTN","PSBCSUTY",108,0)
 ..S PSBXDTTM=(-1*($P(PSBX2(PSBI2),U,6)))_+($E($P(PSBX2(PSBI2),U,4),$L($P(PSBX2(PSBI2),U,4))-6,999)),PSBMCODE=$P(PSBX2(PSBI2),U)
"RTN","PSBCSUTY",109,0)
 ..D:(+PSBXDTTM<0)&(PSBMCODE["ADM")
"RTN","PSBCSUTY",110,0)
 ...S PSBX3(+PSBXDTTM,-999)=PSBX2(PSBI2),PSBDONE(PSBI2)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2)
"RTN","PSBCSUTY",111,0)
 ...F PSBI3=1:1 Q:'$D(PSBX2(PSBI2+PSBI3))  Q:$P(PSBX2(PSBI2+PSBI3),U)'["CMT"  D
"RTN","PSBCSUTY",112,0)
 ....S PSBX3(+PSBXDTTM,-1*PSBI3)=PSBX2(PSBI2+PSBI3),PSBDONE(PSBI2+PSBI3)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2+PSBI3)
"RTN","PSBCSUTY",113,0)
 ..D:(+PSBXDTTM=0)&(PSBMCODE["ADM")
"RTN","PSBCSUTY",114,0)
 ...S PSBX3(PSBI2,0)=PSBX2(PSBI2),PSBDONE(PSBI2)="" K ^TMP("PSB",$J,"CVRSHT",$QS(PSBI1,4),PSBI2)
"RTN","PSBCSUTY",115,0)
 .I $D(PSBX3) D  K PSBX3
"RTN","PSBCSUTY",116,0)
 ..S PSBI2="" F  S PSBI2=$O(PSBX3(PSBI2)) Q:PSBI2=""  S PSBI3="" F  S PSBI3=$O(PSBX3(PSBI2,PSBI3)) Q:PSBI3=""  D
"RTN","PSBCSUTY",117,0)
 ...S ^TMP("PSB",$J,"CVRSHT2",PSBCNT1)=PSBX3(PSBI2,PSBI3),PSBCNT1=PSBCNT1+1
"RTN","PSBCSUTY",118,0)
 S $P(^TMP("PSB",$J,"CVRSHT2",0),U)=PSBCNT1-1
"RTN","PSBCSUTY",119,0)
 Q
"RTN","PSBMLLKU")
0^35^B78334871^B66069590
"RTN","PSBMLLKU",1,0)
PSBMLLKU ;BIRMINGHAM/TEJ-BCMA RPC LOOKUP UTLILITIES ;Mar 2004
"RTN","PSBMLLKU",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9,11,20,13,38,32**;Mar 2004;Build 32
"RTN","PSBMLLKU",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PSBMLLKU",4,0)
 ;
"RTN","PSBMLLKU",5,0)
 ; Reference/IA
"RTN","PSBMLLKU",6,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBMLLKU",7,0)
 ; $$DOB^DPTLK1/3266
"RTN","PSBMLLKU",8,0)
 ; $$SSN^DPTLK1/3267
"RTN","PSBMLLKU",9,0)
 ; ^DPT/10035
"RTN","PSBMLLKU",10,0)
 ; ^XUSEC/10076
"RTN","PSBMLLKU",11,0)
 ; File 52.6/436
"RTN","PSBMLLKU",12,0)
 ; File 52.7/437
"RTN","PSBMLLKU",13,0)
 ; File 50/221
"RTN","PSBMLLKU",14,0)
 ; File 211.4/1409
"RTN","PSBMLLKU",15,0)
 ;
"RTN","PSBMLLKU",16,0)
RPC(RESULTS,PSBREC) ; Remote Procedure Call Entry Point.
"RTN","PSBMLLKU",17,0)
 ;
"RTN","PSBMLLKU",18,0)
 S RESULTS="" D @(PSBREC(0)_"(.RESULTS,.PSBREC)") Q
"RTN","PSBMLLKU",19,0)
 Q
"RTN","PSBMLLKU",20,0)
 ;
"RTN","PSBMLLKU",21,0)
ADMLKUP(RESULTS,PSBREC) ;
"RTN","PSBMLLKU",22,0)
 ;  Lookup ADMinistrations per DFN and search DATE
"RTN","PSBMLLKU",23,0)
 ;   input - PSBREC(1)  DFN
"RTN","PSBMLLKU",24,0)
 ;           PSBREC(2)  Search DATE
"RTN","PSBMLLKU",25,0)
 ;
"RTN","PSBMLLKU",26,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",27,0)
 ;          (Administrations returned will be dated  = to Search Date
"RTN","PSBMLLKU",28,0)
 ;
"RTN","PSBMLLKU",29,0)
 ;
"RTN","PSBMLLKU",30,0)
 K RESULTS
"RTN","PSBMLLKU",31,0)
 S DFN=PSBREC(1),PSBSRCH=$G(PSBREC(2)) I $G(PSBSRCH)']"" D NOW^%DTC S PSBSRCH=$P(%,".")
"RTN","PSBMLLKU",32,0)
 S PSBDT=PSBSRCH,PSBCNT=0 S:PSBSRCH'["." PSBSRCH=PSBSRCH+.9
"RTN","PSBMLLKU",33,0)
 S RESULTS(0)=1,RESULTS(1)="-1^No Meds Found!"
"RTN","PSBMLLKU",34,0)
 F  S PSBSRCH=$O(^PSB(53.79,"AADT",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBMLLKU",35,0)
 .S PSBIEN=""
"RTN","PSBMLLKU",36,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D:'$D(^PSB(53.79,PSBIEN)) KILLAADT  Q:'$D(^PSB(53.79,PSBIEN))  D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",37,0)
 ..L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",38,0)
 ..I  L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",39,0)
 ..E  Q
"RTN","PSBMLLKU",40,0)
 ..S PSBXORDN=$$GET1^DIQ(53.79,PSBIEN_",",.11) Q:'$D(^PSB(53.79,"AORDX",DFN,PSBXORDN,PSBSRCH))
"RTN","PSBMLLKU",41,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.06,"I")>PSBSRCH)
"RTN","PSBMLLKU",42,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")="N")
"RTN","PSBMLLKU",43,0)
 ..S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBIEN
"RTN","PSBMLLKU",44,0)
 ..S $P(RESULTS(PSBCNT),U,2)=PSBSRCH
"RTN","PSBMLLKU",45,0)
 ..S $P(RESULTS(PSBCNT),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",46,0)
 ..S:$$GET1^DIQ(53.79,PSBIEN_",",.26) $P(RESULTS(PSBCNT),U,4)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",47,0)
 ..S $P(RESULTS(PSBCNT),U,5)=$S($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"":"U",1:$$GET1^DIQ(53.79,PSBIEN_",",.09,"I"))
"RTN","PSBMLLKU",48,0)
 ..D  ; Get order information
"RTN","PSBMLLKU",49,0)
 ...K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBXORDN,1)
"RTN","PSBMLLKU",50,0)
 ...S $P(RESULTS(PSBCNT),U,3)=$P(^TMP("PSJ1",$J,2),U,2)  ;OItem_" "_Dosage Form
"RTN","PSBMLLKU",51,0)
 ...S $P(RESULTS(PSBCNT),U,6)=$P(^TMP("PSJ1",$J,4),U)    ;Sched Type
"RTN","PSBMLLKU",52,0)
 ...K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",53,0)
 ..S $P(RESULTS(PSBCNT),U,7)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",54,0)
 ..S $P(RESULTS(PSBCNT),U,8)=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBMLLKU",55,0)
 ..S:$D(^PSB(53.79,PSBIEN,.2)) $P(RESULTS(PSBCNT),U,9)=$P(^PSB(53.79,PSBIEN,.2),U),$P(RESULTS(PSBCNT),U,10)=$P(^PSB(53.79,PSBIEN,.2),U,2)
"RTN","PSBMLLKU",56,0)
 S:+$G(RESULTS(1))>0 $P(RESULTS(0),U)=PSBCNT
"RTN","PSBMLLKU",57,0)
 Q
"RTN","PSBMLLKU",58,0)
 ;
"RTN","PSBMLLKU",59,0)
CHKKEY(PSBIENX) ;
"RTN","PSBMLLKU",60,0)
 I '(($D(^XUSEC("PSB MANAGER",DUZ)))!($$GET1^DIQ(53.79,+PSBIENX,.07,"I")=DUZ)) Q 0
"RTN","PSBMLLKU",61,0)
 Q 1
"RTN","PSBMLLKU",62,0)
 ;
"RTN","PSBMLLKU",63,0)
PTLKUP(RESULTS,PSBREC) ; Patient lookup handled separately for security
"RTN","PSBMLLKU",64,0)
 ;   input - PSBREC (array)  User entered patient lookup data
"RTN","PSBMLLKU",65,0)
 ;
"RTN","PSBMLLKU",66,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",67,0)
 ;          (Person(s) in PATIENT File (#2) meeting search criteria)
"RTN","PSBMLLKU",68,0)
 ;
"RTN","PSBMLLKU",69,0)
 ;
"RTN","PSBMLLKU",70,0)
 K RESULTS
"RTN","PSBMLLKU",71,0)
 S PSBDATA=$E(PSBREC(1),1,60)
"RTN","PSBMLLKU",72,0)
 S PSBDATA1=PSBDATA
"RTN","PSBMLLKU",73,0)
 N PSBINDX S PSBINDX="" K ^TMP("DILIST",$J)
"RTN","PSBMLLKU",74,0)
 I $E(PSBDATA,$L(PSBDATA)-10,60)=" [MAS WARD]" S PSBINDX="CN" S PSBDATA=$P(PSBDATA," [MAS WARD]")
"RTN","PSBMLLKU",75,0)
 I $E(PSBDATA,$L(PSBDATA)-11,60)=" [NURS UNIT]" S PSBINDX="CN" S PSBDATA=$P(PSBDATA," [NURS UNIT]") D
"RTN","PSBMLLKU",76,0)
 .K PSBPT S PSBPT(0)=0
"RTN","PSBMLLKU",77,0)
 .S PSBZ=0 F  S PSBZ=$O(^NURSF(211.4,PSBZ)) Q:PSBZ'?.N  I $$GET1^DIQ(211.4,PSBZ_",",.01)=PSBDATA S PSBY=PSBZ Q
"RTN","PSBMLLKU",78,0)
 .K PSBDATA S PSBDATA=""
"RTN","PSBMLLKU",79,0)
 .S PSBX=0 F  S PSBX=$O(^NURSF(211.4,PSBY,3,PSBX)) Q:PSBX=""  S PSBDATA(PSBX)=$$GET1^DIQ(42,$P(^NURSF(211.4,PSBY,3,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",80,0)
 I PSBINDX="" S PSBINDX=$S(PSBDATA?9N.1P:"SSN",PSBDATA?4N.1P:"BS5^BS",1:PSBINDX)
"RTN","PSBMLLKU",81,0)
 I ($O(PSBDATA(""))'>0) D FIND^DIC(2,"","@;.01;.02;.03;.09","MP",PSBDATA,200,PSBINDX)
"RTN","PSBMLLKU",82,0)
 I ($O(PSBDATA(""))>0) D
"RTN","PSBMLLKU",83,0)
 .S PSBX="",PSBY=1 F  S PSBX=$O(PSBDATA(PSBX)) Q:PSBX=""  D  K ^TMP("DILIST",$J) Q:$P(PSBPT(0),U,3)=1
"RTN","PSBMLLKU",84,0)
 ..D FIND^DIC(2,"","@;.01;.02;.03;.09","MP",PSBDATA(PSBX),200,PSBINDX)
"RTN","PSBMLLKU",85,0)
 ..S PSBZ=0 F  S PSBZ=$O(^TMP("DILIST",$J,PSBZ)) Q:PSBZ=""  S PSBPT(PSBY,0)=^TMP("DILIST",$J,PSBZ,0),PSBPT(0)=PSBY,PSBY=PSBY+1 I PSBY>200 S $P(PSBPT(0),U,3)=1
"RTN","PSBMLLKU",86,0)
 K:+$G(PSBPT(0))=0 PSBPT
"RTN","PSBMLLKU",87,0)
 I $D(PSBPT) M ^TMP("DILIST",$J)=PSBPT
"RTN","PSBMLLKU",88,0)
 I $P($G(^TMP("DILIST",$J,0)),U,3) D  Q
"RTN","PSBMLLKU",89,0)
 .S RESULTS(0)=1,RESULTS(1)="-1^Too many patients found matching '"_PSBDATA1_"'. Please be more specific."
"RTN","PSBMLLKU",90,0)
 I $D(^TMP("DILIST",$J,0)) D
"RTN","PSBMLLKU",91,0)
 .F PSBXX=0:0 S PSBXX=$O(^TMP("DILIST",$J,PSBXX)) Q:'PSBXX  D
"RTN","PSBMLLKU",92,0)
 ..S RESULTS(PSBXX)=$$PTREC(+^TMP("DILIST",$J,PSBXX,0))
"RTN","PSBMLLKU",93,0)
 I '$D(RESULTS) S RESULTS(0)=1,RESULTS(1)="-1^No patients matching '"_PSBDATA1_"'"
"RTN","PSBMLLKU",94,0)
 E  S RESULTS(0)=+$O(RESULTS(""),-1)
"RTN","PSBMLLKU",95,0)
 Q
"RTN","PSBMLLKU",96,0)
 ;
"RTN","PSBMLLKU",97,0)
PTREC(DFN) ;
"RTN","PSBMLLKU",98,0)
 ; Extrinsic to return a Pt Rec  in standard list format
"RTN","PSBMLLKU",99,0)
 N PSBXX
"RTN","PSBMLLKU",100,0)
 S PSBXX=$G(^DPT(DFN,0))
"RTN","PSBMLLKU",101,0)
 S PSBXX=DFN_U_$P(PSBXX,U,1)_U_$P(PSBXX,U,2)_U_$P(PSBXX,U,3)_U_$P(PSBXX,U,9)
"RTN","PSBMLLKU",102,0)
 S $P(PSBXX,U,6)=$$GET1^DIQ(2,DFN_",",.1)
"RTN","PSBMLLKU",103,0)
 S $P(PSBXX,U,7)=$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBMLLKU",104,0)
 S $P(PSBXX,U,10)=$$DOB^DPTLK1(DFN)
"RTN","PSBMLLKU",105,0)
 S $P(PSBXX,U,11)=$$SSN^DPTLK1(DFN)
"RTN","PSBMLLKU",106,0)
 Q PSBXX
"RTN","PSBMLLKU",107,0)
 ;
"RTN","PSBMLLKU",108,0)
SELECTAD(RESULTS,PSBREC) ; Select Administration
"RTN","PSBMLLKU",109,0)
 ;
"RTN","PSBMLLKU",110,0)
 ;  Process the SELECTed ADministration
"RTN","PSBMLLKU",111,0)
 ;   input - PSBREC(1) = PSB Med Log File (#53.79) IEN
"RTN","PSBMLLKU",112,0)
 ;
"RTN","PSBMLLKU",113,0)
 ;
"RTN","PSBMLLKU",114,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",115,0)
 ;          (Administration data that can be subsequently updated via GUI MED LOG EDIT)
"RTN","PSBMLLKU",116,0)
 ;
"RTN","PSBMLLKU",117,0)
 ;
"RTN","PSBMLLKU",118,0)
 K RESULTS,PSBXIV,PSBPTCHX
"RTN","PSBMLLKU",119,0)
 N PSBIEN,PSBCNT,PSBX S PSBIEN=PSBREC(1),PSBCNT=2
"RTN","PSBMLLKU",120,0)
 ; Construct form data    Patient^SSN^Med^BagID^AdminStat^AdminD/T^InjctSt^PRNReas^PRNEff^DisDrg^UntsGiven^Unt^
"RTN","PSBMLLKU",121,0)
 S RESULTS(0)=0
"RTN","PSBMLLKU",122,0)
 D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",123,0)
 .L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",124,0)
 .E  I $P(^PSB(53.79,PSBIEN,0),U,9)]"" S PSBCNT=1,RESULTS(1)="-1^ This administration is being modified by another process at this moment." L -^PSB(53.79,PSBIEN) Q
"RTN","PSBMLLKU",125,0)
 .S $P(RESULTS(1),U)=PSBIEN
"RTN","PSBMLLKU",126,0)
 .S $P(RESULTS(1),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.01,"I")
"RTN","PSBMLLKU",127,0)
 .S $P(RESULTS(1),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.01)
"RTN","PSBMLLKU",128,0)
 .S $P(RESULTS(1),U,4)=$$GET1^DIQ(2,$P(RESULTS(1),U,2)_",",.09)
"RTN","PSBMLLKU",129,0)
 .S $P(RESULTS(1),U,5)=$$GET1^DIQ(53.79,PSBIEN_",",.08,"I")_"~"_$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",130,0)
 .S $P(RESULTS(1),U,6)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",131,0)
 .S $P(RESULTS(1),U,7)=$S($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"":"U",1:$$GET1^DIQ(53.79,PSBIEN_",",.09,"I"))
"RTN","PSBMLLKU",132,0)
 .;
"RTN","PSBMLLKU",133,0)
 .D:($P(RESULTS(1),U,7)'="N")&($P(RESULTS(1),U,7)]"") SELSTTUS(.RESULTS)  ; Amend RESULTS(1) data...
"RTN","PSBMLLKU",134,0)
 .S Y=$E($$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),1,12) D DD^%DT
"RTN","PSBMLLKU",135,0)
 .S $P(RESULTS(1),U,8)=Y
"RTN","PSBMLLKU",136,0)
 .S $P(RESULTS(1),U,9)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",137,0)
 .S $P(RESULTS(1),U,10)=$$GET1^DIQ(53.79,PSBIEN_",",.16)
"RTN","PSBMLLKU",138,0)
 .S $P(RESULTS(1),U,16)=0
"RTN","PSBMLLKU",139,0)
 .S $P(RESULTS(2),U)=$$GET1^DIQ(53.79,PSBIEN_",",.21),$P(RESULTS(2),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.22)
"RTN","PSBMLLKU",140,0)
 .; Determine if there are any active IVs/Patchs per order
"RTN","PSBMLLKU",141,0)
 .D:$G(PSBPTCHX)
"RTN","PSBMLLKU",142,0)
 ..S PSBX="",PSBX="^PSB(53.79,""APATCH"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",143,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",144,0)
 ...S PSBXX=$QS(PSBX,5),PSBXXX=$S(($P(^PSB(53.79,PSBXX,0),U,9)="G")&(PSBXX'=PSBIEN):1,1:0)
"RTN","PSBMLLKU",145,0)
 ...I PSBXXX&($P(^PSB(53.79,PSBXX,.1),U)=$P(RESULTS(1),U,15)) S $P(RESULTS(1),U,16)=1
"RTN","PSBMLLKU",146,0)
 .D:$G(PSBXIV)
"RTN","PSBMLLKU",147,0)
 ..S PSBX="",PSBX="^PSB(53.79,""AUID"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",148,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  Q:$QS(PSBX,4)>$P(RESULTS(1),U,15)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",149,0)
 ...Q:$QS(PSBX,4)'=$P(RESULTS(1),U,15)
"RTN","PSBMLLKU",150,0)
 ...S PSBXX=$QS(PSBX,6) S:(PSBXX'=PSBIEN) $P(RESULTS(1),U,16)=$S($P(^PSB(53.79,PSBXX,0),U,9)="I":1,$P(^PSB(53.79,PSBXX,0),U,9)="S":1,1:0)
"RTN","PSBMLLKU",151,0)
 .;
"RTN","PSBMLLKU",152,0)
 .; LOOP - Place DD in RESULTS
"RTN","PSBMLLKU",153,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.5,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",154,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",155,0)
 ..S RESULTS(PSBCNT)="DD^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_"^"_$$GET1^DIQ(50,$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",156,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,4)
"RTN","PSBMLLKU",157,0)
 ..S:$P(RESULTS(PSBCNT),U,4)?1"."1.N $P(RESULTS(PSBCNT),U,4)=0_+$P(RESULTS(PSBCNT),U,4)
"RTN","PSBMLLKU",158,0)
 ..S:$P(RESULTS(PSBCNT),U,5)?1"."1.N $P(RESULTS(PSBCNT),U,5)=0_+$P(RESULTS(PSBCNT),U,5)
"RTN","PSBMLLKU",159,0)
 .; LOOP - Place ADD in RESULTS
"RTN","PSBMLLKU",160,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.6,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",161,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",162,0)
 ..S RESULTS(PSBCNT)="ADD^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_"^"_$$GET1^DIQ(52.6,$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",163,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,4)
"RTN","PSBMLLKU",164,0)
 .; LOOP - Place SOL in RESULTS
"RTN","PSBMLLKU",165,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.7,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",166,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",167,0)
 ..S RESULTS(PSBCNT)="SOL^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_"^"_$$GET1^DIQ(52.7,$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",168,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,4)
"RTN","PSBMLLKU",169,0)
 .L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",170,0)
 S:PSBCNT>0 RESULTS(0)=PSBCNT
"RTN","PSBMLLKU",171,0)
 Q
"RTN","PSBMLLKU",172,0)
 ;
"RTN","PSBMLLKU",173,0)
SELSTTUS(RESULTS) ;
"RTN","PSBMLLKU",174,0)
 ; Provide the SELectable STaTUS
"RTN","PSBMLLKU",175,0)
 ;
"RTN","PSBMLLKU",176,0)
 ; Get TAB, ScheduleType, Current Status, provide Selectable Staus(s) in ^8
"RTN","PSBMLLKU",177,0)
 N PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBIVPSH,PSBXTAB
"RTN","PSBMLLKU",178,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1($$GET1^DIQ(53.79,PSBIEN_",",.01,"I"),$$GET1^DIQ(53.79,PSBIEN_",",.11),1)
"RTN","PSBMLLKU",179,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",180,0)
 .S PSBORTYP=$TR($P(^TMP("PSJ1",$J,0),U,3),"1234567890"),PSBIVTYP=$P(^TMP("PSJ1",$J,0),U,6)
"RTN","PSBMLLKU",181,0)
 .S PSBINTSY=$P(^TMP("PSJ1",$J,0),U,7),PSBCHMTY=$P(^TMP("PSJ1",$J,0),U,8),PSBIVPSH=+$P($G(^TMP("PSJ1",$J,1,0)),U,2)
"RTN","PSBMLLKU",182,0)
 .S:$$IVPTAB^PSBVDLU3(PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBIVPSH) PSBXTAB="PB"
"RTN","PSBMLLKU",183,0)
 .D:'$D(PSBXTAB)
"RTN","PSBMLLKU",184,0)
 ..I PSBORTYP="U" S PSBXTAB="UD"
"RTN","PSBMLLKU",185,0)
 ..I PSBORTYP="V" S PSBXTAB="IV"
"RTN","PSBMLLKU",186,0)
 ; Set Results(1) and other flags...
"RTN","PSBMLLKU",187,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",188,0)
 .S $P(RESULTS(1),U,13)=$P(^TMP("PSJ1",$J,4),U)
"RTN","PSBMLLKU",189,0)
 .S $P(RESULTS(1),U,14)=$P(^TMP("PSJ1",$J,1),U,10)
"RTN","PSBMLLKU",190,0)
 .S $P(RESULTS(1),U,15)=$P(^TMP("PSJ1",$J,0),U,3)
"RTN","PSBMLLKU",191,0)
 .I (PSBXTAB="UD"),($P(^TMP("PSJ1",$J,2),U,6)="PATCH") S PSBPTCHX=1
"RTN","PSBMLLKU",192,0)
 .I PSBXTAB="IV" S PSBXIV=1
"RTN","PSBMLLKU",193,0)
 .S:$G(PSBXTAB)]"" $P(RESULTS(1),U,11)=$G(PSBXTAB)
"RTN","PSBMLLKU",194,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",195,0)
 Q
"RTN","PSBMLLKU",196,0)
 ;
"RTN","PSBMLLKU",197,0)
KILLAADT ;
"RTN","PSBMLLKU",198,0)
 ;   Here because there is an errorant index entry via version 1.0/2.0
"RTN","PSBMLLKU",199,0)
 ;   Cleansing!
"RTN","PSBMLLKU",200,0)
 ;
"RTN","PSBMLLKU",201,0)
 K ^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN)
"RTN","PSBMLLKU",202,0)
 Q
"RTN","PSBMLLKU",203,0)
 ;
"RTN","PSBO")
0^1^B64481776^B62943627
"RTN","PSBO",1,0)
PSBO ;BIRMINGHAM/EFC-BCMA OUTPUTS ;Mar 2004
"RTN","PSBO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13,32**;Mar 2004;Build 32
"RTN","PSBO",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBO",4,0)
 ; Reference/IA
"RTN","PSBO",5,0)
 ; ^DPT(/10035
"RTN","PSBO",6,0)
 ; WARD^NURSUT5/3052
"RTN","PSBO",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBO",8,0)
 ; ^ORD(101.24/3429
"RTN","PSBO",9,0)
 ; ^PSDRUG(/221
"RTN","PSBO",10,0)
RPC(RESULTS,PSBTYPE,PSBDFN,PSBSTRT,PSBSTOP,PSBINCL,PSBDEV,PSBSORT,PSBOI,PSBWLOC,PSBWSORT,PSBFUTR,PSBORDNM,PSBRCRI,PSBLIST) ;
"RTN","PSBO",11,0)
 ;
"RTN","PSBO",12,0)
 ; RPC: PSB REPORT
"RTN","PSBO",13,0)
 ;
"RTN","PSBO",14,0)
 ; Description:
"RTN","PSBO",15,0)
 ; Used by the client to create individual patient extracts of
"RTN","PSBO",16,0)
 ; CHUI report options to display on the client.
"RTN","PSBO",17,0)
 ;
"RTN","PSBO",18,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",19,0)
 N PSBIENS,PSBRPT,PSBFDA,DIC,PSBANS
"RTN","PSBO",20,0)
 K ^TMP("PSBO",$J) S ^TMP("PSBO",$J,1)="-1^"
"RTN","PSBO",21,0)
 S DFN=PSBDFN
"RTN","PSBO",22,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",23,0)
 I +PSBRPT(0)<1 S ^TMP("PSBO",$J,1)="-1^Error: "_$P(PSBRPT(0),U,2) Q
"RTN","PSBO",24,0)
 S PSBIENS=+PSBRPT(0)_","
"RTN","PSBO",25,0)
 S PSBSTRT(0)=$E($P(PSBSTRT,".",2)_"0000",1,4),PSBSTRT=PSBSTRT\1
"RTN","PSBO",26,0)
 S PSBSTOP(0)=$E($P(PSBSTOP,".",2)_"0000",1,4),PSBSTOP=PSBSTOP\1
"RTN","PSBO",27,0)
 D:$G(PSBDEV)]""
"RTN","PSBO",28,0)
 .D NOW^%DTC
"RTN","PSBO",29,0)
 .I $P(PSBDEV,U,2)="" D VAL^DIE(53.69,PSBIENS,.06,"F",PSBDEV,"PSBRET","PSBFDA")
"RTN","PSBO",30,0)
 .I $P(PSBDEV,U,2)'="" D VAL^DIE(53.69,PSBIENS,.06,"F","`"_$P(PSBDEV,U,2),"PSBRET","PSBFDA")
"RTN","PSBO",31,0)
 .D VAL^DIE(53.69,PSBIENS,.07,"F",$S($P(PSBRCRI,U)="QD":$P(PSBRCRI,U,2),1:%),"PSBRET","PSBFDA")
"RTN","PSBO",32,0)
 D:$G(PSBOI)]"" VAL^DIE(53.69,PSBIENS,.09,"F",PSBOI,"PSBRET","PSBFDA")
"RTN","PSBO",33,0)
 S:($G(PSBSORT)']"")&(PSBTYPE'="XA") PSBSORT="P" D VAL^DIE(53.69,PSBIENS,.11,"F",PSBSORT,"PSBRET","PSBFDA")
"RTN","PSBO",34,0)
 D VAL^DIE(53.69,PSBIENS,.12,"F","`"_PSBDFN,"PSBRET","PSBFDA")
"RTN","PSBO",35,0)
 I $G(PSBWLOC)]"" S PSBFDA(53.69,PSBIENS,.13)=PSBWLOC
"RTN","PSBO",36,0)
 D:$G(PSBWSORT)]"" VAL^DIE(53.69,PSBIENS,.15,"F",PSBWSORT,"PSBRET","PSBFDA")
"RTN","PSBO",37,0)
 D VAL^DIE(53.69,PSBIENS,.16,"F",PSBSTRT,"PSBRET","PSBFDA")
"RTN","PSBO",38,0)
 D VAL^DIE(53.69,PSBIENS,.17,"F",PSBSTRT(0),"PSBRET","PSBFDA")
"RTN","PSBO",39,0)
 D VAL^DIE(53.69,PSBIENS,.18,"F",PSBSTOP,"PSBRET","PSBFDA")
"RTN","PSBO",40,0)
 D VAL^DIE(53.69,PSBIENS,.19,"F",PSBSTOP(0),"PSBRET","PSBFDA")
"RTN","PSBO",41,0)
 D:$G(PSBINCL)]""
"RTN","PSBO",42,0)
 .D VAL^DIE(53.69,PSBIENS,.21,"F",+$P(PSBINCL,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",43,0)
 .D VAL^DIE(53.69,PSBIENS,.22,"F",+$P(PSBINCL,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",44,0)
 .D VAL^DIE(53.69,PSBIENS,.23,"F",+$P(PSBINCL,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",45,0)
 .D VAL^DIE(53.69,PSBIENS,.24,"F",+$P(PSBINCL,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",46,0)
 .D VAL^DIE(53.69,PSBIENS,.28,"F",+$P(PSBINCL,"^",5),"PSBRET","PSBFDA")
"RTN","PSBO",47,0)
 .D VAL^DIE(53.69,PSBIENS,.29,"F",+$P(PSBINCL,"^",6),"PSBRET","PSBFDA")
"RTN","PSBO",48,0)
 D:$G(PSBFUTR)]""
"RTN","PSBO",49,0)
 .D VAL^DIE(53.69,PSBIENS,.25,"F",+$P(PSBFUTR,"^",1),"PSBRET","PSBFDA")
"RTN","PSBO",50,0)
 .D VAL^DIE(53.69,PSBIENS,.26,"F",+$P(PSBFUTR,"^",2),"PSBRET","PSBFDA")
"RTN","PSBO",51,0)
 .D VAL^DIE(53.69,PSBIENS,.27,"F",+$P(PSBFUTR,"^",3),"PSBRET","PSBFDA")
"RTN","PSBO",52,0)
 .D VAL^DIE(53.69,PSBIENS,.41,"F",+$P(PSBFUTR,"^",4),"PSBRET","PSBFDA")
"RTN","PSBO",53,0)
 .D VAL^DIE(53.69,PSBIENS,.61,"F",$TR(PSBFUTR,"^ ","~"),"PSBRET","PSBFDA")
"RTN","PSBO",54,0)
 D FILE^DIE("","PSBFDA")
"RTN","PSBO",55,0)
 I $G(PSBLIST(0),"")]"" D LIST^PSBO1(.PSBLIST)
"RTN","PSBO",56,0)
 I $G(PSBDEV)]"" D PRINT^PSBO1 S RESULTS=$NAME(^TMP("PSBO",$J)) Q
"RTN","PSBO",57,0)
 D HFSOPEN^PSBUTL("RPC") I POP S ^TMP("PSBO",$J,1)="ERROR: UNABLE TO ACCESS HFS DIRECTORY "_$$GET^XPAR("DIV","PSB HFS SCRATCH"),^TMP("PSBO",$J,2)="PLEASE CHECK DIRECTORY WRITE PRIVILEDGES." Q
"RTN","PSBO",58,0)
 U IO D DQ(+PSBIENS)
"RTN","PSBO",59,0)
 D HFSCLOSE^PSBUTL("RPC")
"RTN","PSBO",60,0)
 S RESULTS=$NAME(^TMP("PSBO",$J))
"RTN","PSBO",61,0)
 D:$G(PSBDEV)]"" PRINT^PSBO1
"RTN","PSBO",62,0)
 Q
"RTN","PSBO",63,0)
 ;
"RTN","PSBO",64,0)
XQ(PSBTYPE) ; Called via Kernel Menus
"RTN","PSBO",65,0)
 N PSBANS,PSBANS1,PSBRPT,PSBSAVE,DA,DIK,DR,DDSFILE
"RTN","PSBO",66,0)
 D NEW^PSBO1(.PSBRPT,PSBTYPE)
"RTN","PSBO",67,0)
 I +PSBRPT(0)<1 W !,"Error: ",$P(PSBRPT(0),U,2) S DIR(0)="E" D ^DIR Q
"RTN","PSBO",68,0)
 S DA=+PSBRPT(0),DR="[PSBO "_PSBTYPE_"]",DDSFILE=53.69 D ^DDS
"RTN","PSBO",69,0)
 W @IOF
"RTN","PSBO",70,0)
 I 'PSBSAVE W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!"
"RTN","PSBO",71,0)
 D:PSBSAVE
"RTN","PSBO",72,0)
 .;Check Drug to Patient Relationship.
"RTN","PSBO",73,0)
 .I PSBTYPE="BL" S PSBANS="" D CHECK  I PSBANS=0!($D(DIRUT)) W !,"Cancelling Request..." S DIK="^PSB(53.69," D ^DIK W "Cancelled!" Q
"RTN","PSBO",74,0)
 .;
"RTN","PSBO",75,0)
 .;Allow "'BROWSER" Device
"RTN","PSBO",76,0)
 .S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO",77,0)
 ..S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO",78,0)
 ..D ^%ZIS
"RTN","PSBO",79,0)
 ..I IO=IO(0) S PSBSIO=1
"RTN","PSBO",80,0)
 ..D HOME^%ZIS K IOP
"RTN","PSBO",81,0)
 .I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ(DA) D ^%ZISC K IOP Q
"RTN","PSBO",82,0)
 .W @IOF,"Submitting Your Report Request to Taskman..."
"RTN","PSBO",83,0)
 .S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)
"RTN","PSBO",84,0)
 .S ZTDTH=$P(^PSB(53.69,DA,0),U,7)
"RTN","PSBO",85,0)
 .S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO",86,0)
 .S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO",87,0)
 .D ^%ZTLOAD
"RTN","PSBO",88,0)
 .W "Submitted!",!,"Your Task Number Is: ",$G(ZTSK),!
"RTN","PSBO",89,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",90,0)
 Q
"RTN","PSBO",91,0)
 ;
"RTN","PSBO",92,0)
DQ(PSBRPT) ; Dequeue report from Taskman
"RTN","PSBO",93,0)
 N PSBWRD,PSBDFN
"RTN","PSBO",94,0)
 Q:'$D(^PSB(53.69,PSBRPT,0))  ; No Such Report
"RTN","PSBO",95,0)
 S $P(^PSB(53.69,PSBRPT,0),U,8)=$G(ZTSK,"RPC")
"RTN","PSBO",96,0)
 D:$$SETUP @("EN^PSBO"_$P(PSBRPT(0),U,5))
"RTN","PSBO",97,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",98,0)
 S ZTREQ="@"
"RTN","PSBO",99,0)
 Q
"RTN","PSBO",100,0)
 ;
"RTN","PSBO",101,0)
IOM() ; Returns good margin or not
"RTN","PSBO",102,0)
 Q:IOM'<132 1
"RTN","PSBO",103,0)
 W !,"**************************************************************"
"RTN","PSBO",104,0)
 W !,"* SORRY, Your selected DEVICE does not print 132 columns.    *"
"RTN","PSBO",105,0)
 W !,"**************************************************************"
"RTN","PSBO",106,0)
 W !
"RTN","PSBO",107,0)
 Q 0
"RTN","PSBO",108,0)
 ;
"RTN","PSBO",109,0)
VAL(PSBFLDS) ; Validate that fields in PSBFLDS are filled in
"RTN","PSBO",110,0)
 N PSB,PSBFLD,PSBMSG,PSBSTOP,PSBST,PSBDAYS S PSBSTRT=""
"RTN","PSBO",111,0)
 F PSB=1:1 Q:$P(PSBFLDS,";",PSB)=""  S PSBFLD=$P(PSBFLDS,";",PSB),PSBFLD(PSBFLD)=$$GET^DDSVAL(53.69,DA,PSBFLD)
"RTN","PSBO",112,0)
 I $D(PSBFLD(.11)) K:$E(PSBFLD(.11))="P" PSBFLD(.13),PSBFLD(.15) K:$E(PSBFLD(.11))="W" PSBFLD(.12)
"RTN","PSBO",113,0)
 S PSB=""  F  S PSB=$O(PSBFLD(PSB)) Q:PSB=""  D:PSBFLD(PSB)=""
"RTN","PSBO",114,0)
 .I '$D(PSBMSG) S PSBMSG(0)="UNABLE TO FILE REQUEST",PSBMSG(1)=" ",PSBMSG(2)="ERROR: MISSING DATA - ALL FIELDS ARE REQUIRED",PSBMSG(3)=" "
"RTN","PSBO",115,0)
 .D FIELD^DID(53.69,PSB,"","TITLE;LABEL","PSB")
"RTN","PSBO",116,0)
 .S Z="  Missing Field: "_$S(PSB("TITLE")]"":PSB("TITLE"),1:PSB("LABEL"))
"RTN","PSBO",117,0)
 .S PSBMSG($O(PSBMSG(""),-1)+1)=Z
"RTN","PSBO",118,0)
 ; Check Times
"RTN","PSBO",119,0)
 D:$G(PSBFLD(.16))
"RTN","PSBO",120,0)
 .S PSBSTRT=PSBFLD(.16)+$G(PSBFLD(.17))
"RTN","PSBO",121,0)
 .D:$P($$GET1^DIQ(53.69,DA_",",.01),U)["MH"
"RTN","PSBO",122,0)
 ..S PSBDAYS=$$GET1^DIQ(101.24,$$FIND1^DIC(101.24,"","X","ORRP BCMA MAH","B")_",",.42)  ;check maxdays
"RTN","PSBO",123,0)
 ..S:PSBDAYS="" PSBDAYS=7
"RTN","PSBO",124,0)
 ..S X=PSBSTRT\1 D H^%DTC S PSBST=%H+PSBDAYS    ;Determine stop date
"RTN","PSBO",125,0)
 .S PSBSTOP=$S($G(PSBFLD(.18)):PSBFLD(.18),1:PSBFLD(.16))+$G(PSBFLD(.19))
"RTN","PSBO",126,0)
 .I PSBSTOP<PSBSTRT S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  Date: Stop Date/Time is before Start Date/Time"
"RTN","PSBO",127,0)
 .I $P($$GET1^DIQ(53.69,DA_",",.01),U)["MH" S X=PSBSTOP\1 D H^%DTC I %H>PSBST S Y=$O(PSBMSG(""),-1)+1,PSBMSG(Y)="  The date range cannot exceed "_PSBDAYS_" day(s) as defined in the CPRS 'MAXIMUM DAYS BACK' parameter"
"RTN","PSBO",128,0)
 Q:'$D(PSBMSG)  ; All is well
"RTN","PSBO",129,0)
 D MSG^DDSUTL(.PSBMSG)
"RTN","PSBO",130,0)
 S DDSERROR=1
"RTN","PSBO",131,0)
 Q
"RTN","PSBO",132,0)
 ;
"RTN","PSBO",133,0)
SETUP() ; Setup parameters for the report in PSBRPT
"RTN","PSBO",134,0)
 N PSBWRDL,PSBINDX,PSBWRDA
"RTN","PSBO",135,0)
 K ^TMP("PSBO",$J)
"RTN","PSBO",136,0)
 F X=0,.1,.2,.3,.4,1 S PSBRPT(X)=$G(^PSB(53.69,PSBRPT,X))
"RTN","PSBO",137,0)
 I $D(^PSB(53.69,PSBRPT,2)) M PSBRPT(2)=^PSB(53.69,PSBRPT,2)
"RTN","PSBO",138,0)
 I $P(PSBRPT(.1),U,1)="P" S PSBDFN=+$P(PSBRPT(.1),U,2) Q:'PSBDFN  S ^TMP("PSBO",$J,PSBDFN,0)=$P(^DPT(PSBDFN,0),U)_U_$P(^DPT(PSBDFN,0),U,9),^TMP("PSBO",$J,"B",$P(^DPT(PSBDFN,0),U),PSBDFN)=""
"RTN","PSBO",139,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBO",140,0)
 .S PSBWRD=$P(PSBRPT(.1),U,3) Q:'PSBWRD  D WARD^NURSUT5("L^"_PSBWRD,.PSBWRDA)
"RTN","PSBO",141,0)
 .S X="" F  S X=$O(PSBWRDA(PSBWRD,2,X)) Q:X=""   S PSBWRDL=$P(PSBWRDA(PSBWRD,2,X,.01),U,2) D
"RTN","PSBO",142,0)
 ..F PSBDFN=0:0 S PSBDFN=$O(^DPT("CN",PSBWRDL,PSBDFN)) Q:'PSBDFN  D
"RTN","PSBO",143,0)
 ...S ^TMP("PSBO",$J,PSBDFN,0)=$P(^DPT(PSBDFN,0),U)_U_$P(^DPT(PSBDFN,0),U,9)
"RTN","PSBO",144,0)
 ...; Determine Sort or default to Pt Name...
"RTN","PSBO",145,0)
 ...S:$P(PSBRPT(.1),U,5)="P" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",146,0)
 ...I $P(PSBRPT(.1),U,5)="B" S PSBINDX=$P($G(^DPT(PSBDFN,.101)),U) S:PSBINDX="" PSBINDX="** NO ROOM BED **"
"RTN","PSBO",147,0)
 ...S:$P(PSBRPT(.1),U,5)="" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",148,0)
 ...S:$G(PSBINDX)="" PSBINDX=$P(^DPT(PSBDFN,0),U)
"RTN","PSBO",149,0)
 ...S ^TMP("PSBO",$J,"B",PSBINDX,PSBDFN)=""
"RTN","PSBO",150,0)
 Q 1
"RTN","PSBO",151,0)
 ;
"RTN","PSBO",152,0)
WRAP(X,Y,Z)    ; Quick text wrap
"RTN","PSBO",153,0)
 ;
"RTN","PSBO",154,0)
 ; Input Parameters Description:
"RTN","PSBO",155,0)
 ;  X: Left Column of display [Optional]
"RTN","PSBO",156,0)
 ;  Y: Cols to wrap in [Optional]
"RTN","PSBO",157,0)
 ;  Z: Text to wrap [Optional]
"RTN","PSBO",158,0)
 ;
"RTN","PSBO",159,0)
 N PSB
"RTN","PSBO",160,0)
 F  Q:'$L(Z)  D
"RTN","PSBO",161,0)
 .W:$X>X !
"RTN","PSBO",162,0)
 .W:$X<X ?X
"RTN","PSBO",163,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBO",164,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBO",165,0)
 .S:PSB<1 PSB=Y
"RTN","PSBO",166,0)
 .W $E(Z,1,PSB)
"RTN","PSBO",167,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBO",168,0)
 Q ""
"RTN","PSBO",169,0)
 ;
"RTN","PSBO",170,0)
CHECK ;Beginning of PSB*1*10
"RTN","PSBO",171,0)
 K ^TMP("PSJ",$J)
"RTN","PSBO",172,0)
 N PSBDFN,PSBBAR,PSBDRUG,PSBFLAG,PSBPNM,PSBNDX,PSBX
"RTN","PSBO",173,0)
 S PSBFLAG="",PSBBAR=$P($P($G(^PSB(53.69,DA,.3)),U,1),"~",2)
"RTN","PSBO",174,0)
 S PSBDRUG=$$GET1^DIQ(53.69,DA_",",.31)
"RTN","PSBO",175,0)
 S PSBDFN=$$GET1^DIQ(53.69,DA_",",.12,"I") S:$G(PSBDFN) PSBFLAG=1
"RTN","PSBO",176,0)
 D EN^PSJBCMA(PSBDFN)
"RTN","PSBO",177,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBO",178,0)
 .K Y,PSBORD,PSBPNM,PSBNDX
"RTN","PSBO",179,0)
 .M PSBORD=^TMP("PSJ",$J,PSBX)
"RTN","PSBO",180,0)
 .F PSBNDX=700,850,950  D
"RTN","PSBO",181,0)
 ..F Y=0:0 S Y=$O(PSBORD(PSBNDX,Y)) Q:'Y  D
"RTN","PSBO",182,0)
 ...I $P($G(PSBORD(1)),U,7)'="A" Q
"RTN","PSBO",183,0)
 ...S PSBPNM=$P(PSBORD(PSBNDX,Y,0),U,1)
"RTN","PSBO",184,0)
 ...I PSBNDX=700,PSBPNM=PSBBAR S PSBFLAG=0 Q
"RTN","PSBO",185,0)
 ...I PSBNDX=850,$D(^PSDRUG("A526",PSBBAR,PSBPNM)) S PSBFLAG=0 Q
"RTN","PSBO",186,0)
 ...I PSBNDX=950,$D(^PSDRUG("A527",PSBBAR,PSBPNM)) S PSBFLAG=0
"RTN","PSBO",187,0)
 I PSBFLAG=1 D
"RTN","PSBO",188,0)
 .W !,"Patient is not currently on medication: ",PSBDRUG
"RTN","PSBO",189,0)
 .K DIRUT,DIR
"RTN","PSBO",190,0)
 .S DIR("A")="Do you want to continue"
"RTN","PSBO",191,0)
 .S DIR(0)="Y"
"RTN","PSBO",192,0)
 .D ^DIR
"RTN","PSBO",193,0)
 .S PSBANS=+Y W !
"RTN","PSBO",194,0)
 ; 
"RTN","PSBO1")
0^2^B7451298^B5347535
"RTN","PSBO1",1,0)
PSBO1 ;BIRMINGHAM/EFC-BCMA OUTPUTS ;Mar 2004
"RTN","PSBO1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**4,13,32**;Mar 2004;Build 32
"RTN","PSBO1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBO1",4,0)
 ; Reference/IA
"RTN","PSBO1",5,0)
 ; FILE^DICN/10009
"RTN","PSBO1",6,0)
 ;
"RTN","PSBO1",7,0)
NEW(RESULTS,PSBRTYP) ; Create a new report request
"RTN","PSBO1",8,0)
 ; Called interactively and via RPCBroker
"RTN","PSBO1",9,0)
 K RESULTS
"RTN","PSBO1",10,0)
 ; Check Type
"RTN","PSBO1",11,0)
 I '$F("DL^MD^MH^ML^MM^MV^MT^PE^PM^WA^BL^PI^AL^DO^VT^PF^XA^IV^CM^CP^CE^CI^",PSBRTYP) S RESULTS(0)="-1^Invalid Report Type" Q
"RTN","PSBO1",12,0)
 I '+$G(DUZ) S RESULTS(0)="-1^Undefined User" Q
"RTN","PSBO1",13,0)
 I '$G(DUZ(2)) S RESULTS(0)="-1^Undefined Division" Q
"RTN","PSBO1",14,0)
 ; Lock Log
"RTN","PSBO1",15,0)
 L +(^PSB(53.69,0)):0
"RTN","PSBO1",16,0)
 E  S RESULTS(0)="-1^Request Log Locked" Q
"RTN","PSBO1",17,0)
 ; Generate Unique Entry and Create
"RTN","PSBO1",18,0)
 F  D NOW^%DTC S X=$E(%_"000000",1,14) S X=(1700+$E(X,1,3))_$E(X,4,14),X=PSBRTYP_"-"_$TR(X,".","-") Q:'$D(^PSB(53.69,"B",X))
"RTN","PSBO1",19,0)
 S DIC="^PSB(53.69,",DIC(0)="L"
"RTN","PSBO1",20,0)
 S DIC("DR")=".02///N;.03////^S X=DUZ;.04////^S X=DUZ(2);.05///^S X=PSBRTYP"
"RTN","PSBO1",21,0)
 K DD,DO D FILE^DICN
"RTN","PSBO1",22,0)
 L -(^PSB(53.69,0))
"RTN","PSBO1",23,0)
 ; Okay, setup return and Boogie
"RTN","PSBO1",24,0)
 I +Y<1 S RESULTS(0)="-1^Error Creating Request"
"RTN","PSBO1",25,0)
 E  S RESULTS(0)=Y
"RTN","PSBO1",26,0)
 Q
"RTN","PSBO1",27,0)
 ;
"RTN","PSBO1",28,0)
PRINT ;
"RTN","PSBO1",29,0)
 N ZTDTH,ZTRTN,ZTSK,ZTDESC,ZTSAVE,DA
"RTN","PSBO1",30,0)
 S DA=+PSBRPT(0)
"RTN","PSBO1",31,0)
 S IOP=$$GET1^DIQ(53.69,DA_",",.06,"I"),PSBSIO=0 I IOP]"" D
"RTN","PSBO1",32,0)
 .S IOP="`"_IOP,%ZIS="N"
"RTN","PSBO1",33,0)
 .D ^%ZIS
"RTN","PSBO1",34,0)
 .I IO=IO(0) S PSBSIO=1
"RTN","PSBO1",35,0)
 .D HOME^%ZIS K IOP
"RTN","PSBO1",36,0)
 I $$GET1^DIQ(53.69,DA_",",.06)["BROWSER"!(PSBSIO=1) S IOP=$$GET1^DIQ(53.69,DA_",",.06)_";132" D ^%ZIS U IO D DQ^PSBO(DA) D ^%ZISC K IOP Q
"RTN","PSBO1",37,0)
 W @IOF,"Submitting Your Report Request to Taskman..."
"RTN","PSBO1",38,0)
 S ZTIO=$$GET1^DIQ(53.69,DA_",",.06)_";132"
"RTN","PSBO1",39,0)
 S ZTDTH=$S($$GET1^DIQ(53.69,DA_",",.07,"I")]"":$$GET1^DIQ(53.69,DA_",",.07,"I"),1:$H)
"RTN","PSBO1",40,0)
 S ZTDESC="BCMA - "_$$GET1^DIQ(53.69,DA_",",.05)
"RTN","PSBO1",41,0)
 S ZTRTN="DQ^PSBO("_DA_")"
"RTN","PSBO1",42,0)
 F I="PSBDFN","PSBTYPE" S ZTSAVE(I)=""
"RTN","PSBO1",43,0)
 I $G(PSBORDNM)]"" S ZTSAVE("PSBORDNM")=""
"RTN","PSBO1",44,0)
 D ^%ZTLOAD
"RTN","PSBO1",45,0)
 I $D(ZTSK) S ^TMP("PSBO",$J,1)="0^Report queued. (Task #"_ZTSK_")"
"RTN","PSBO1",46,0)
 E  S ^TMP("PSBO",$J,1)="-1^Task Rejected."
"RTN","PSBO1",47,0)
 Q
"RTN","PSBO1",48,0)
 ;
"RTN","PSBO1",49,0)
LIST(XLIST) ;  Place List Criteria into subfile #53.692 (multiple)
"RTN","PSBO1",50,0)
 F XL1=$O(XLIST("")):1:$O(XLIST("B"),-1)  Q:+XL1=""  D
"RTN","PSBO1",51,0)
 .I $P(XLIST(XL1),U)=PSBTYPE D
"RTN","PSBO1",52,0)
 ..K PSBFDA,PSBRET,PSBIENX D CLEAN^DILF
"RTN","PSBO1",53,0)
 ..S PSBIENX="+"_(XL1+1)_","_PSBIENS
"RTN","PSBO1",54,0)
 ..D VAL^DIE(53.692,"+"_(XL1+1)_","_PSBIENS,.01,"F",$TR(XLIST(XL1),"^","~"),"PSBRET","PSBFDA")
"RTN","PSBO1",55,0)
 ..D UPDATE^DIE("","PSBFDA","PSBIENX","PSBRET")
"RTN","PSBO1",56,0)
 Q
"RTN","PSBO1",57,0)
 ;
"RTN","PSBOCE")
0^11^B78251398^n/a
"RTN","PSBOCE",1,0)
PSBOCE ;BIRMINGHAM/TEJ-Expired/DC'd/EXPIRING ORDERS REPORT ;Mar 2004
"RTN","PSBOCE",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOCE",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCE",4,0)
 ;
"RTN","PSBOCE",5,0)
EN ;
"RTN","PSBOCE",6,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR
"RTN","PSBOCE",7,0)
 S PSBFUTR=$TR(PSBRPT(1),"~",U)
"RTN","PSBOCE",8,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""   ; Ord Status srch crit - "A"ctve, "D"C ed, "E"xpred"
"RTN","PSBOCE",9,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"Expired/DC'd" S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"Expired/DC'd" S:$P(PSBFUTR,U,9) PSBOCRIT=PSBOCRIT_"Expiring Today"
"RTN","PSBOCE",10,0)
 S:$P(PSBFUTR,U,10) PSBOCRIT=PSBOCRIT_"Expiring Tomorrow"
"RTN","PSBOCE",11,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCE",12,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCE",13,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCE",14,0)
 S PSBSORT=1
"RTN","PSBOCE",15,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCE",16,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCE",17,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCE",18,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCE",19,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCE",20,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCE",21,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCE",22,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCE",23,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCE",24,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCE",25,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCE",26,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCE",27,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X)
"RTN","PSBOCE",28,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCE",29,0)
 .S PSBX2X=1
"RTN","PSBOCE",30,0)
 .S (PSBLIST2("Expiring Tomorrow"),PSBLIST2("Expiring Today"),PSBLIST2("Expired/DC'd"),PSBLIST2(" * NO * "))=0
"RTN","PSBOCE",31,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCE",32,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",33,0)
 ..I $P(PSBDATA,U)="ORD" D  Q
"RTN","PSBOCE",34,0)
 ...K PSBDRUGN
"RTN","PSBOCE",35,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCE",36,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCE",37,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCE",38,0)
 ...S PSBSTS=$P(PSBDATA,U,23) S PSBSTS=$S((PSBSTS="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS="H":"On Hold",PSBSTS="D":"Discontinued",PSBSTS="DE":"Discontinued (Edit)",(PSBSTS="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCE",39,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCE",40,0)
 ...S X2=$P(PSBDATA,U,27),X3=$P(PSBNOWX,".")
"RTN","PSBOCE",41,0)
 ...S PSBSTSX=$S((X2<PSBNOWX):"Expired/DC'd",(X3'>X2)&($$FMADD^XLFDT(X3,1)>X2):"Expiring Today",($$FMADD^XLFDT(X3,1)'>X2)&(X2'>$$FMADD^XLFDT(X3,2)):"Expiring Tomorrow",1:" * NO * ")
"RTN","PSBOCE",42,0)
 ...I PSBSTS["Discontinued" S PSBSTSX="Expired/DC'd"
"RTN","PSBOCE",43,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)="" S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1
"RTN","PSBOCE",44,0)
 ...S:PSBOCRIT[PSBSTSX PSBTOT=PSBTOT+1
"RTN","PSBOCE",45,0)
 ...S PSBSCHTY=$P(PSBDATA,U,6)
"RTN","PSBOCE",46,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCE",47,0)
 ...S PSBSCHD=$P(PSBDATA,U,7) I PSBSCHD="" S PSBSCHD=" "
"RTN","PSBOCE",48,0)
 ...S PSBSCHD(PSBORDN,PSBSCHD)=""
"RTN","PSBOCE",49,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCE",50,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCE",51,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)="" K PSBOMDR(PSBORDN)
"RTN","PSBOCE",52,0)
 ...S PSBNXTX1=$$NEXTADM^PSBCSUTX(PSBX1X,PSBORDN)
"RTN","PSBOCE",53,0)
 ...I PSBSTS["Hold" S PSBNXTX2="Provider Hold"
"RTN","PSBOCE",54,0)
 ...I PSBSTS'["Hold" D 
"RTN","PSBOCE",55,0)
 ....I PSBNOWX>$$FMADD^XLFDT(PSBNXTX1,,,PSBAFT) S PSBNXTX2="MISSED "_PSBNXTX1
"RTN","PSBOCE",56,0)
 ....E  S PSBNXTX2="DUE "_PSBNXTX1
"RTN","PSBOCE",57,0)
 ...S PSBNXTX1=$$FMTDT^PSBOCE1(PSBNXTX1)
"RTN","PSBOCE",58,0)
 ...I ("^P^OC^O"[(U_PSBSCHTY))!(PSBTB="IV")!(PSBSTS["Discontinued")!(PSBSTS["Expired") S:PSBSTS'["Hold" PSBNXTX2=" "
"RTN","PSBOCE",59,0)
 ...S PSBNXTX(PSBORDN,PSBNXTX2)=""
"RTN","PSBOCE",60,0)
 ...; ** SPC INSTR  **
"RTN","PSBOCE",61,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCE",62,0)
 ...S PSBSI=$P(PSBDATA(PSBX2X),U,2)
"RTN","PSBOCE",63,0)
 ...I PSBSI]" " S PSBSI(PSBORDN,PSBSI)=""
"RTN","PSBOCE",64,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCE",65,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCE",66,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCE",67,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCE",68,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA,U)) D  Q
"RTN","PSBOCE",69,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCE",70,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCE",71,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCE",72,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCE",73,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCE",74,0)
 ..I $P(PSBDATA(PSBX2X+1),U)="ORF" D  Q
"RTN","PSBOCE",75,0)
 ...S PSBX2X=PSBX2X+1 S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",76,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCE",77,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D
"RTN","PSBOCE",78,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCE",79,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCE",80,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCE",81,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCE",82,0)
 ...K PSBDATA(PSBX2X)
"RTN","PSBOCE",83,0)
 ...I ($P(PSBDATA(PSBX2X+1),U)="CMT")  F  S PSBDATA=PSBDATA(PSBX2X+1) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCE",84,0)
 ....S PSBX2X=PSBX2X+1
"RTN","PSBOCE",85,0)
 ....S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCE",86,0)
 ....K PSBDATA(PSBX2X)
"RTN","PSBOCE",87,0)
 ....S:$P(PSBDATA,U,3)]"" PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCE",88,0)
 ....I 'PSBCFLG S PSBDATA=PSBDATA(PSBX2X+1) Q
"RTN","PSBOCE",89,0)
 ....I $P(PSBDATA,U,2)'="" D
"RTN","PSBOCE",90,0)
 .....S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))=""
"RTN","PSBOCE",91,0)
 .....S PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)))=PSBDATA
"RTN","PSBOCE",92,0)
 I '$D(PSBLIST2) K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCE",93,0)
 D CREATHDR
"RTN","PSBOCE",94,0)
 D SUBHDR
"RTN","PSBOCE",95,0)
 D BLDRPT
"RTN","PSBOCE",96,0)
 D WRTRPT
"RTN","PSBOCE",97,0)
 Q
"RTN","PSBOCE",98,0)
BLDRPT ; Buld RPT DATA
"RTN","PSBOCE",99,0)
 S X0="" K PSBLIST2(" * NO * "),PSBL2ULN
"RTN","PSBOCE",100,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCE",101,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCE",102,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCE",103,0)
 S PSBMORE=5 F PSBX1X="Expired/DC'd","Expiring Today","Expiring Tomorrow" D
"RTN","PSBOCE",104,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCE",105,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCE",106,0)
 .Q:PSBOCRIT'[PSBX1X
"RTN","PSBOCE",107,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCE",108,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCE",109,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCE",110,0)
 .K PSBDATA
"RTN","PSBOCE",111,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCE",112,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCE",113,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCE",114,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCE",115,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCE",116,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCE",117,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCE",118,0)
 ..S PSBDATA(1,5)=$O(PSBSCHD(PSBX2X,""))
"RTN","PSBOCE",119,0)
 ..S PSBDATA(1,6)=$O(PSBNXTX(PSBX2X,""))
"RTN","PSBOCE",120,0)
 ..S:PSBDATA(1,6)'["Hold" $P(PSBDATA(1,6)," ",2)=$$FMTDT^PSBOCE1($P(PSBDATA(1,6)," ",2))
"RTN","PSBOCE",121,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCE",122,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCE",123,0)
 ..S PSBSIDAT(1)=$O(PSBSI(PSBX2X,""))
"RTN","PSBOCE",124,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCE",125,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCE",126,0)
 ..D BUILDLN^PSBOCE1,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info:",1:""))
"RTN","PSBOCE",127,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCE",128,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCE",129,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCE",130,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCE",131,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCE",132,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCE",133,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCE",134,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCE",135,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCE",136,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCE",137,0)
 D:+PSBTOT>0 LGD^PSBOCM
"RTN","PSBOCE",138,0)
 Q
"RTN","PSBOCE",139,0)
WRTRPT ;  writ
"RTN","PSBOCE",140,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCE",141,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),21)
"RTN","PSBOCE",142,0)
 .D FTR
"RTN","PSBOCE",143,0)
 S PSBPGNUM=1
"RTN","PSBOCE",144,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCE",145,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR
"RTN","PSBOCE",146,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCE",147,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCE",148,0)
 D FTR
"RTN","PSBOCE",149,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCE",150,0)
 Q
"RTN","PSBOCE",151,0)
HDR ;  Hder
"RTN","PSBOCE",152,0)
 W:$Y>1 @IOF
"RTN","PSBOCE",153,0)
 W:$X>1 !
"RTN","PSBOCE",154,0)
 S PSBRPNM="BCMA COVERSHEET EXPIRED/DC'd/EXPIRING ORDERS REPORT"
"RTN","PSBOCE",155,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCE",156,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCE",157,0)
 .S PSBHDR(1)="Order Status(es): --"
"RTN","PSBOCE",158,0)
 .F Y=7,8,9,10 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^^^^Expired^DC'd^Expiring Today^Expiring Tomorrow^^^^^^^^",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCE",159,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCE",160,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCE",161,0)
 Q
"RTN","PSBOCE",162,0)
SUBHDR ;
"RTN","PSBOCE",163,0)
 N PSBAL S PSBAL=$O(PSBHDR("ALERGY",""),-1) S PSBAL=$S((PSBAL/12)>(PSBAL\12):(PSBAL\12)+1,1:(PSBAL\12))
"RTN","PSBOCE",164,0)
 N PSBRE S PSBRE=$O(PSBHDR("REAC",""),-1) S PSBRE=$S((PSBRE/12)>(PSBRE\12):(PSBRE\12)+1,1:(PSBRE\12))
"RTN","PSBOCE",165,0)
 S PSBLNTOT=$O(PSBHDR(""),-1)+9+PSBAL+PSBRE+1
"RTN","PSBOCE",166,0)
 I $G(PSBPGNUM,0)=1 W !,?(PSBTAB8-($L("Total Orders reported: "_+PSBTOT))),"Total Orders reported: "_+PSBTOT,! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",167,0)
 W !,$TR($J("",PSBTAB8)," ","_") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",168,0)
 W !,$G(PSBHD1,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",169,0)
 W !,$G(PSBHD2,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCE",170,0)
 W !,$TR($J("",PSBTAB8)," ","="),! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",171,0)
 I $D(NOTE(PSBPGNUM)) W NOTE(PSBPGNUM),!! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCE",172,0)
 Q
"RTN","PSBOCE",173,0)
FTR ;  Footr
"RTN","PSBOCE",174,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOCE",175,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOCE",176,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOCE",177,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOCE",178,0)
 Q
"RTN","PSBOCE",179,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCE",180,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCE",181,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCE",182,0)
 Q PSBPGNUM
"RTN","PSBOCE",183,0)
CREATHDR ;
"RTN","PSBOCE",184,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCE",185,0)
 I IOM'<132 S PSBMORE=4,PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(H132BLK),";",2)
"RTN","PSBOCE",186,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOCE",187,0)
 ; tabs
"RTN","PSBOCE",188,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCE",189,0)
 S PSBPGNUM=1
"RTN","PSBOCE",190,0)
 D HDR
"RTN","PSBOCE",191,0)
 Q
"RTN","PSBOCE",192,0)
HD132A ;~ VDL |    Status     |Type|       Medication; Dosage, Route      |    Schedule    |     Next      |   Order Start  |   Order Stop  |
"RTN","PSBOCE",193,0)
 Q
"RTN","PSBOCE",194,0)
HD132B ; Tab |               |    |                                      |                |   Action      |     Date       |    Date       |
"RTN","PSBOCE",195,0)
 Q
"RTN","PSBOCE",196,0)
H132BLK ;;     |               |    |                                      |                |                |               |               |
"RTN","PSBOCE",197,0)
 Q
"RTN","PSBOCE1")
0^25^B12338914^n/a
"RTN","PSBOCE1",1,0)
PSBOCE1 ;BIRMINGHAM/TEJ-Expired/DC'd/EXPIRING ORDERS REPORT (1) ;Mar 2004
"RTN","PSBOCE1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOCE1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCE1",4,0)
 ;
"RTN","PSBOCE1",5,0)
FMTDT(Y) ;
"RTN","PSBOCE1",6,0)
 ; Format date/time as displayed by GUI  ie. 02/25/2005@2323
"RTN","PSBOCE1",7,0)
 N X S X=$E(Y,4,5) X ^DD("DD") S Y=$TR(Y," ,:","//") S $P(Y,"/")=X
"RTN","PSBOCE1",8,0)
 Q Y
"RTN","PSBOCE1",9,0)
BUILDLN ; Constr recs
"RTN","PSBOCE1",10,0)
 K J S J(0)="" F PSBFLD=1:1:8 S J=1 D FORMDAT(PSBFLD) S J($O(PSBRPLN(""),-1))=""
"RTN","PSBOCE1",11,0)
 ; Write administration info...
"RTN","PSBOCE1",12,0)
 Q:'PSBXFLG
"RTN","PSBOCE1",13,0)
 S J=($O(J(""),-1)+1),PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCE1",14,0)
 S (N,Y)=""
"RTN","PSBOCE1",15,0)
 M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS")
"RTN","PSBOCE1",16,0)
 F  S Y=$O(PSBADM(PSBX2X,Y)) Q:Y']""  D
"RTN","PSBOCE1",17,0)
 .F  S N=$O(PSBADM(PSBX2X,Y,N)) Q:N']""  D
"RTN","PSBOCE1",18,0)
 ..I $D(PSBBID(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="BAG ID: "_PSBBID(PSBX2X,$P(N,U,2))
"RTN","PSBOCE1",19,0)
 ..S $E(PSBDATA(2,0),25)="ACTION BY: "_$P(PSBADM(PSBX2X,Y,N),U,7)_" "_$$FMTDT^PSBOCE1($E($P(PSBADM(PSBX2X,Y,N),U,6),1,12))
"RTN","PSBOCE1",20,0)
 ..S X=$P(PSBADM(PSBX2X,Y,N),U,5) S $E(PSBDATA(2,0),56)="ACTION: "_$S(X="G":"GIVEN",X="R":"REFUSED",X="RM":"REMOVED",X="H":"HELD",X="S":"STOPPED",X="I":"INFUSING",X="C":"COMPLETED",X="M":"MISSING DOSE",X=" ":"*UNKNOWN*",1:" ")
"RTN","PSBOCE1",21,0)
 ..I $D(PSBPRNR(PSBX2X)) S $E(PSBDATA(2,0),72)="PRN REASON: "_PSBPRNR(PSBX2X,$P(N,U,2))
"RTN","PSBOCE1",22,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(1,132-1,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCE1",23,0)
 ..I $D(PSBPRNEF(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="PRN EFFECTIVENESS: "_PSBPRNEF(PSBX2X,$P(N,U,2))
"RTN","PSBOCE1",24,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCE1",25,0)
 ..I ('PSBCFLG)!('$D(PSBCMT(PSBX2X,$P(N,U,2)))) S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1 Q
"RTN","PSBOCE1",26,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCE1",27,0)
 ..S X="" F   S X=$O(PSBCMT(PSBX2X,$P(N,U,2),X)) Q:X']""  D
"RTN","PSBOCE1",28,0)
 ...S PSBDATA(2,0)="COMMENT BY: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,5)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X),U,5)_" "_$$FMTDT^PSBOCE1($E($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,6),1,12)),1:" n/a ")
"RTN","PSBOCE1",29,0)
 ...S PSBDATA(2,0)=PSBDATA(2,0)_"  COMMENT: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,2)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X),U,2),1:" ")
"RTN","PSBOCE1",30,0)
 ...I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCE1",31,0)
 ..S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCE1",32,0)
 Q
"RTN","PSBOCE1",33,0)
FORMDAT(FLD) ;
"RTN","PSBOCE1",34,0)
 K PSBVAL
"RTN","PSBOCE1",35,0)
 Q:'$D(PSBDATA(1,FLD))
"RTN","PSBOCE1",36,0)
 S PSBVAL=PSBDATA(1,FLD)
"RTN","PSBOCE1",37,0)
 D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCE1",38,0)
 I FLD=4 S J=$O(J(""),-1)+1,PSBVAL=PSBDATA(1,4,0) D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCE1",39,0)
 Q
"RTN","PSBOCE1",40,0)
WRAPPER(X,Y,Z) ;  Text WRAP
"RTN","PSBOCE1",41,0)
 N PSB
"RTN","PSBOCE1",42,0)
 I ($L(Z)>0),$F(Z,"""")>1 F  Q:$F(Z,"""")'>1  S Z=$TR(Z,"""","^")
"RTN","PSBOCE1",43,0)
 F  Q:'$L(Z)  D
"RTN","PSBOCE1",44,0)
 .I $L(Z)<Y S $E(PSBRPLN(J),X)=Z S Z="" Q
"RTN","PSBOCE1",45,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBOCE1",46,0)
 .S:PSB<1 PSB=Y
"RTN","PSBOCE1",47,0)
 .S $E(PSBRPLN(J),X)=$E(Z,1,PSB)
"RTN","PSBOCE1",48,0)
 .I $L(PSBRPLN(J),"^")>1 F X=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",X)=$P(PSBRPLN(J),"^",X)_""""
"RTN","PSBOCE1",49,0)
 .S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOCE1",50,0)
 .S Z=$E(Z,PSB+1,250),J=J+1,J(J)=""
"RTN","PSBOCE1",51,0)
 Q ""
"RTN","PSBOCE1",52,0)
PGC ;
"RTN","PSBOCE1",53,0)
 S PSBPGNUM=PSBPGNUM+1,PSBLNTOT=PSBTOPHD S PSBMORE=$S(PSBMORE>(IOSL-(PSBTOPHD)):(IOSL-(PSBTOPHD)),1:PSBMORE)
"RTN","PSBOCE1",54,0)
 S NOTE(PSBPGNUM)="( "_PSBX1X_" - Continued )"
"RTN","PSBOCE1",55,0)
 Q
"RTN","PSBOCI")
0^12^B79246118^n/a
"RTN","PSBOCI",1,0)
PSBOCI ;BIRMINGHAM/TEJ-COVERSHEET IV OVERVIEW REPORT ;Mar 2004
"RTN","PSBOCI",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOCI",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCI",4,0)
 ;
"RTN","PSBOCI",5,0)
 ; Reference/IA
"RTN","PSBOCI",6,0)
 ; File 4/10090
"RTN","PSBOCI",7,0)
EN ;
"RTN","PSBOCI",8,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR
"RTN","PSBOCI",9,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCI",10,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG,PSBBGX)=""  ; srch crit - "A"ctive,"D"C ed,"E"xpired"
"RTN","PSBOCI",11,0)
 S PSBOCRIT="DEA"
"RTN","PSBOCI",12,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCI",13,0)
 S:$P(PSBFUTR,U,12) PSBBGX=PSBBGX_"I"
"RTN","PSBOCI",14,0)
 S:$P(PSBFUTR,U,13) PSBBGX=PSBBGX_"S"
"RTN","PSBOCI",15,0)
 S:$P(PSBFUTR,U,14) PSBBGX=PSBBGX_"A"
"RTN","PSBOCI",16,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCI",17,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCI",18,0)
 S PSBSORT=1
"RTN","PSBOCI",19,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCI",20,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCI",21,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCI",22,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCI",23,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCI",24,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCI",25,0)
 S (PSBPGNUM,PSBLNTOT)=""
"RTN","PSBOCI",26,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCI",27,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCI",28,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCI",29,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCI",30,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCI",31,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X)
"RTN","PSBOCI",32,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCI",33,0)
 .S PSBX2X=1
"RTN","PSBOCI",34,0)
 .S (PSBLIST2("All Other"),PSBLIST2("Infusing"),PSBLIST2("Stopped"),PSBLIST2(" * NO * "))=0
"RTN","PSBOCI",35,0)
 .K PSBBSO
"RTN","PSBOCI",36,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCI",37,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCI",38,0)
 ..I $P(PSBDATA,U)="ORD" K PSBORDN,PSBDRUGN D  Q
"RTN","PSBOCI",39,0)
 ...S PSBEND=0
"RTN","PSBOCI",40,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCI",41,0)
 ...I (PSBTB'="IV") F PSBX2X=PSBX2X:1 D  Q:PSBEND>0
"RTN","PSBOCI",42,0)
 ....S PSBEND=0 I $P(PSBDATA(PSBX2X),U)="END" S PSBEND=PSBX2X
"RTN","PSBOCI",43,0)
 ...Q:PSBEND>0
"RTN","PSBOCI",44,0)
 ...S PSBSTS1=$P(PSBDATA,U,23)
"RTN","PSBOCI",45,0)
 ...S PSBSTS=$S((PSBSTS1="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS1="H":"On Hold",PSBSTS1="D":"Discontinued",PSBSTS1="DE":"Discontinued (Edit)",(PSBSTS1="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCI",46,0)
 ...S V=$$FMADD^XLFDT(PSBNOWX,,,PSBB4)
"RTN","PSBOCI",47,0)
 ...S PSBSTSX=$S($P(PSBDATA,U,27)'>PSBNOWX:"EXPIRED/DC'd",$P(PSBDATA,U,22)'>V:"ACTIVE",V:"FUTURE",1:" * ERROR * ")
"RTN","PSBOCI",48,0)
 ...I PSBSTSX=" * ERROR * "  F PSBX2X=PSBX2X:1 D  Q:PSBEND>0
"RTN","PSBOCI",49,0)
 ....S PSBEND=0 I $P(PSBDATA(PSBX2X),U)="END" S PSBEND=PSBX2X
"RTN","PSBOCI",50,0)
 ...Q:PSBEND>0
"RTN","PSBOCI",51,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCI",52,0)
 ...S PSBORITX=$P(PSBDATA,U,9)
"RTN","PSBOCI",53,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCI",54,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCI",55,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCI",56,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCI",57,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCI",58,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCI",59,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCI",60,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)=""
"RTN","PSBOCI",61,0)
 ...S X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")=" "
"RTN","PSBOCI",62,0)
 ...S PSBBSO(PSBORDN)="" S:$G(PSBSTSX)="ACTIVE" PSBBSO(PSBORDN)="AVAILABLE"
"RTN","PSBOCI",63,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",64,0)
 ..I $P(PSBDATA,U)="ORC" D  Q
"RTN","PSBOCI",65,0)
 ...S PSBSI=$P(PSBDATA(PSBX2X),U,2)
"RTN","PSBOCI",66,0)
 ...I PSBSI]" " S PSBSI(PSBORDN,PSBSI)=""
"RTN","PSBOCI",67,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",68,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCI",69,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCI",70,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCI",71,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCI",72,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCI",73,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",74,0)
 ..I $P(PSBDATA,U)="ORF" D  Q
"RTN","PSBOCI",75,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCI",76,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",77,0)
 ..I $P(PSBDATA,U)="ID"  D  Q
"RTN","PSBOCI",78,0)
 ...F PSBX3X=PSBX2X:1 S PSBDATA=PSBDATA(PSBX3X) Q:($P(PSBDATA,U)'="ID")  D
"RTN","PSBOCI",79,0)
 ....S PSBX2X=PSBX3X
"RTN","PSBOCI",80,0)
 ....K X2
"RTN","PSBOCI",81,0)
 ....S X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,$P(PSBDATA,U,2))=PSBBSO(PSBORDN) I $D(PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")) K PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")
"RTN","PSBOCI",82,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",83,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D  Q
"RTN","PSBOCI",84,0)
 ...I $P(PSBDATA,U,3)]"" D
"RTN","PSBOCI",85,0)
 ....K X2
"RTN","PSBOCI",86,0)
 ....S PSBBID(PSBORDN,$P(PSBDATA,U,3))=""
"RTN","PSBOCI",87,0)
 ....I $P(^PSB(53.79,$P(PSBDATA,U,4),0),U,9)="I" S X2="I",PSBLIST2("Infusing")=PSBLIST2("Infusing")+1,PSBLIST2("Infusing",PSBORITX,PSBORDN,$P(PSBDATA,U,3))="INFUSING"
"RTN","PSBOCI",88,0)
 ....I $P(^PSB(53.79,$P(PSBDATA,U,4),0),U,9)="S" S X2="S",PSBLIST2("Stopped")=PSBLIST2("Stopped")+1,PSBLIST2("Stopped",PSBORITX,PSBORDN,$P(PSBDATA,U,3))="STOPPED"
"RTN","PSBOCI",89,0)
 ....I PSBBGX[$G(X2,"A") S:PSBXFLG PSBLGD(PSBORDN,"INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCI",90,0)
 ....S:'$D(X2) X2="A",PSBLIST2("All Other",PSBORITX,PSBORDN,$P(PSBDATA,U,3))=$$GET1^DIQ(53.79,$P(PSBDATA,U,4)_",","ACTION STATUS")
"RTN","PSBOCI",91,0)
 ....I $D(PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")) K PSBLIST2("All Other",PSBORITX,PSBORDN,"*NA*")
"RTN","PSBOCI",92,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCI",93,0)
 ..I $P(PSBDATA,U,1)="END" Q
"RTN","PSBOCI",94,0)
 F I="All Other","Infusing","Stopped" S X="",PSBLIST2(I)=0 F  S X=$O(PSBLIST2(I,X)) Q:X=""  S XI="" F  S XI=$O(PSBLIST2(I,X,XI),-1) Q:XI=""  D
"RTN","PSBOCI",95,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(I,X,XI,PSBX2X),-1) Q:PSBX2X=""  S PSBLIST2(I)=PSBLIST2(I)+1  I (PSBBGX[$E(I,1)) S PSBTOT=PSBTOT+1
"RTN","PSBOCI",96,0)
 D CREATHDR
"RTN","PSBOCI",97,0)
 D SUBHDR
"RTN","PSBOCI",98,0)
 D BLDRPT
"RTN","PSBOCI",99,0)
 D WRTRPT
"RTN","PSBOCI",100,0)
 Q
"RTN","PSBOCI",101,0)
BLDRPT ; Bld RPT
"RTN","PSBOCI",102,0)
 K PSBL2ULN
"RTN","PSBOCI",103,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCI",104,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCI",105,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCI",106,0)
 S PSBMORE=5 F PSBX1X="Infusing","Stopped","All Other" D
"RTN","PSBOCI",107,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCI",108,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCI",109,0)
 .Q:PSBBGX'[$E(PSBX1X,1)
"RTN","PSBOCI",110,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCI",111,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCI",112,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCI",113,0)
 .K PSBDATA
"RTN","PSBOCI",114,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCI",115,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  S XI="" F  S XI=$O(PSBLIST2(PSBX1X,X0,PSBX2X,XI)) Q:XI=""  D
"RTN","PSBOCI",116,0)
 ..K PSBDATA(1)
"RTN","PSBOCI",117,0)
 ..S PSBDATA(1,1)=XI
"RTN","PSBOCI",118,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCI",119,0)
 ..S PSBDATA(1,3)=PSBLIST2(PSBX1X,X0,PSBX2X,XI)
"RTN","PSBOCI",120,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCI",121,0)
 ..I "IS"[$E(PSBDATA(1,3),1) S (PSBCHG,PSBDATA(1,5))="",PSBORLST(0)=PSBX2X D RPC^PSBCHKIV(.PSBCHG,PSBXDFN,.PSBORLST)
"RTN","PSBOCI",122,0)
 ..I $D(PSBCHG(0)) I PSBCHG(0)>0 I ($P(PSBCHG(1),U)=PSBX2X)!($P(PSBCHG(1),U,5)=PSBX2X) F X2=0:1 Q:PSBCHG(X2)="END"  I $P(PSBCHG(X2),U)="CD" S PSBDATA(1,5)="Changed Order" Q
"RTN","PSBOCI",123,0)
 ..S PSBDATA(1,6)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCI",124,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCI",125,0)
 ..S PSBSIDAT(1)=$O(PSBSI(PSBX2X,""))
"RTN","PSBOCI",126,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCI",127,0)
 ..K PSBDATA(2),PSBSILN
"RTN","PSBOCI",128,0)
 ..D BUILDLN^PSBOCI1,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB7,"Other Print Info:")
"RTN","PSBOCI",129,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCI",130,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCI",131,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCI",132,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCI",133,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCI",134,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCI",135,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCI",136,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCI",137,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB7),"" "",""-""),!"
"RTN","PSBOCI",138,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCI",139,0)
 K PSBNO S PSBNO=1 D:+PSBTOT>0 LGD^PSBOCM K PSBNO
"RTN","PSBOCI",140,0)
 Q
"RTN","PSBOCI",141,0)
WRTRPT ;  writ
"RTN","PSBOCI",142,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCI",143,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOCI",144,0)
 .D PTFTR^PSBOCI1
"RTN","PSBOCI",145,0)
 S PSBPGNUM=1
"RTN","PSBOCI",146,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCI",147,0)
 .I PSBPGNUM'=PSBZ D PTFTR^PSBOCI1 S PSBPGNUM=PSBZ D HDR,SUBHDR
"RTN","PSBOCI",148,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCI",149,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCI",150,0)
 D PTFTR^PSBOCI1
"RTN","PSBOCI",151,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCI",152,0)
 Q
"RTN","PSBOCI",153,0)
HDR ;  Hder
"RTN","PSBOCI",154,0)
 W:$Y>1 @IOF
"RTN","PSBOCI",155,0)
 W:$X>1 !
"RTN","PSBOCI",156,0)
 S PSBRPNM="BCMA COVERSHEET IV OVERVIEW REPORT"
"RTN","PSBOCI",157,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCI",158,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCI",159,0)
 .S PSBHDR(1)="Order Type(s): --"
"RTN","PSBOCI",160,0)
 .F Y=12,13,18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^^^^^^^^^Infusing Bags^Stopped Bags^^^^^All Others",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCI",161,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCI",162,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCI",163,0)
 Q
"RTN","PSBOCI",164,0)
SUBHDR ;
"RTN","PSBOCI",165,0)
 N PSBAL S PSBAL=$O(PSBHDR("ALERGY",""),-1) S PSBAL=$S((PSBAL/12)>(PSBAL\12):(PSBAL\12)+1,1:(PSBAL\12))
"RTN","PSBOCI",166,0)
 N PSBRE S PSBRE=$O(PSBHDR("REAC",""),-1) S PSBRE=$S((PSBRE/12)>(PSBRE\12):(PSBRE\12)+1,1:(PSBRE\12))
"RTN","PSBOCI",167,0)
 S PSBLNTOT=$O(PSBHDR(""),-1)+9+PSBAL+PSBRE+1
"RTN","PSBOCI",168,0)
 I $G(PSBPGNUM,0)=1 W !,?(PSBTAB7-($L("Total Items reported: "_+PSBTOT))),"Total Items reported: "_+PSBTOT,! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",169,0)
 W !,$TR($J("",PSBTAB7)," ","_") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",170,0)
 W !,$G(PSBHD1,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",171,0)
 W !,$G(PSBHD2,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOCI",172,0)
 W !,$TR($J("",PSBTAB7)," ","="),! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",173,0)
 I $D(NOTE(PSBPGNUM)) W NOTE(PSBPGNUM),!! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOCI",174,0)
 Q
"RTN","PSBOCI",175,0)
PGTOT(X) ;PG Nmbr
"RTN","PSBOCI",176,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCI",177,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCI",178,0)
 Q PSBPGNUM
"RTN","PSBOCI",179,0)
CREATHDR ;
"RTN","PSBOCI",180,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCI",181,0)
 I IOM'<132 S PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(C132BLK),";",2)
"RTN","PSBOCI",182,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOCI",183,0)
 ; tabs
"RTN","PSBOCI",184,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCI",185,0)
 S PSBPGNUM=1
"RTN","PSBOCI",186,0)
 D HDR
"RTN","PSBOCI",187,0)
 Q
"RTN","PSBOCI",188,0)
HD132A ;~    Bag ID     |    Order    |       Bag       |   Medication; Infusion Rate, Route  | Bag Info |    Order Start  |    Order Stop  |
"RTN","PSBOCI",189,0)
 Q
"RTN","PSBOCI",190,0)
HD132B ;               |    Status   |     Status      |                                     |          |     Date        |      Date      |
"RTN","PSBOCI",191,0)
 Q
"RTN","PSBOCI",192,0)
C132BLK ;;                |            |                 |                                     |          |                 |                |
"RTN","PSBOCI",193,0)
 Q
"RTN","PSBOCI1")
0^27^B3777377^n/a
"RTN","PSBOCI1",1,0)
PSBOCI1 ;BIRMINGHAM/TEJ-COVERSHEET IV OVERVIEW REPORT ;Mar 2004
"RTN","PSBOCI1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOCI1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCI1",4,0)
 ;
"RTN","PSBOCI1",5,0)
 ;
"RTN","PSBOCI1",6,0)
BUILDLN ; Constr recs
"RTN","PSBOCI1",7,0)
 K J S J(0)="" F PSBFLD=1:1:7  S J=1 D FORMDAT^PSBOCE1(PSBFLD) S J($O(PSBRPLN(""),-1))=""
"RTN","PSBOCI1",8,0)
 ; Write administration info...
"RTN","PSBOCI1",9,0)
 Q:'PSBXFLG
"RTN","PSBOCI1",10,0)
 ; Get Actions
"RTN","PSBOCI1",11,0)
 K PSBXDTL S (PSBXDTL,N,Y)="",J=($O(J(""),-1)+1)
"RTN","PSBOCI1",12,0)
 D BAGDTL^PSBRPC2(.PSBXDTL,XI,PSBX2X)
"RTN","PSBOCI1",13,0)
 I $D(PSBXDTL(1)) I +$P(PSBXDTL(1),U)=-1 S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1 Q
"RTN","PSBOCI1",14,0)
 S J=($O(J(""),-1)+1),PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCI1",15,0)
 F Y=1:1:PSBXDTL(0)  S N=PSBXDTL(Y) D
"RTN","PSBOCI1",16,0)
 .Q:('PSBCFLG)&($P(N,U,3)']"")
"RTN","PSBOCI1",17,0)
 .S $E(PSBDATA(2,0),25)="BY: "_$P(N,U,2)_" "_$$FMTDT^PSBOCE1($E($P(N,U),1,12))
"RTN","PSBOCI1",18,0)
 .S $E(PSBDATA(2,0),49)="ACTION: "_$P(N,U,3)
"RTN","PSBOCI1",19,0)
 .I $G(PSBDATA(2,0))]" " D WRAPPER^PSBOCE1(1,132-1,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCI1",20,0)
 .M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"INITIALS")
"RTN","PSBOCI1",21,0)
 .Q:('PSBCFLG)!($P(N,U,4)']"")
"RTN","PSBOCI1",22,0)
 .S PSBDATA(2,0)=$G(PSBDATA(2,0),"")_"  COMMENT: "_$P(N,U,4)
"RTN","PSBOCI1",23,0)
 .I $G(PSBDATA(2,0))]" " D WRAPPER^PSBOCE1(49,132-49,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCI1",24,0)
 S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCI1",25,0)
 Q
"RTN","PSBOCI1",26,0)
PTFTR ;Patient Page footer
"RTN","PSBOCI1",27,0)
 I (IOSL<100) F  Q:$Y>(IOSL-7)  W !
"RTN","PSBOCI1",28,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOCI1",29,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBOCI1",30,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBOCI1",31,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOCI1",32,0)
 S PSBPGRM=PSBTAB7-($L(PSBPG))
"RTN","PSBOCI1",33,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOCI1",34,0)
 Q
"RTN","PSBOCM")
0^13^B76517195^n/a
"RTN","PSBOCM",1,0)
PSBOCM ;BIRMINGHAM/TEJ-COVERSHEET MEDICATION OVERVIEW REPORT ;Mar 2004
"RTN","PSBOCM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOCM",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCM",4,0)
 ;
"RTN","PSBOCM",5,0)
 ; Reference/IA
"RTN","PSBOCM",6,0)
 ; File 4/10090
"RTN","PSBOCM",7,0)
 ; File 200/10060
"RTN","PSBOCM",8,0)
EN ;
"RTN","PSBOCM",9,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR
"RTN","PSBOCM",10,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCM",11,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""        ;  Order Status search criteria - "A"ctive, "D"C ed, "E"xpired"
"RTN","PSBOCM",12,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D" S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E" S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOCM",13,0)
 S:$P(PSBFUTR,U,4) PSBOCRIT=PSBOCRIT_"F"
"RTN","PSBOCM",14,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCM",15,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCM",16,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD,PSBHDR,PSBSTS
"RTN","PSBOCM",17,0)
 S PSBSORT=1
"RTN","PSBOCM",18,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=$E(Y,1,18)
"RTN","PSBOCM",19,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCM",20,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCM",21,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCM",22,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCM",23,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCM",24,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCM",25,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCM",26,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCM",27,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCM",28,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCM",29,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCM",30,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X)
"RTN","PSBOCM",31,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCM",32,0)
 .S PSBX2X=1
"RTN","PSBOCM",33,0)
 .S PSBLIST2("ACTIVE")=0,PSBLIST2("FUTURE")=0,PSBLIST2("EXPIRED/DC'd")=0,PSBLIST2(" * ERROR * ")=0
"RTN","PSBOCM",34,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCM",35,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",36,0)
 ..I $P(PSBDATA,U)="ORD" D  Q
"RTN","PSBOCM",37,0)
 ...K PSBDRUGN
"RTN","PSBOCM",38,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCM",39,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCM",40,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCM",41,0)
 ...S PSBSTS=$P(PSBDATA,U,23) S PSBSTS=$S((PSBSTS="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS="H":"On Hold",PSBSTS="D":"Discontinued",PSBSTS="DE":"Discontinued (Edit)",(PSBSTS="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCM",42,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCM",43,0)
 ...S PSBSTSX=$S($P(PSBDATA,U,27)'>PSBNOWX:"EXPIRED/DC'd",$$FMADD^XLFDT($P(PSBDATA,U,22),,,-PSBB4)'>PSBNOWX:"ACTIVE",$P(PSBDATA,U,22)>$$FMADD^XLFDT(PSBNOWX,,,PSBB4):"FUTURE",1:" * ERROR * ")
"RTN","PSBOCM",44,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)="" S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1
"RTN","PSBOCM",45,0)
 ...S:PSBOCRIT[$E(PSBSTSX,1) PSBTOT=PSBTOT+1
"RTN","PSBOCM",46,0)
 ...S PSBSCHTY=$P(PSBDATA,U,6)
"RTN","PSBOCM",47,0)
 ...I PSBTB="IV" S PSBSCHTY=" "
"RTN","PSBOCM",48,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCM",49,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCM",50,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCM",51,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)="" K PSBOMDR(PSBORDN)
"RTN","PSBOCM",52,0)
 ...S PSBSCHD=$P(PSBDATA,U,7) I PSBSCHD="" S PSBSCHD=" "
"RTN","PSBOCM",53,0)
 ...S PSBSCHD(PSBORDN,PSBSCHD)=""
"RTN","PSBOCM",54,0)
 ...S PSBNXTX1=$$NEXTADM^PSBCSUTX(PSBX1X,PSBORDN)
"RTN","PSBOCM",55,0)
 ...I PSBSTS["Hold" S PSBNXTX2="Provider Hold"
"RTN","PSBOCM",56,0)
 ...I PSBSTS'["Hold",(PSBNXTX1]"") D
"RTN","PSBOCM",57,0)
 ....I PSBNOWX>$$FMADD^XLFDT(PSBNXTX1,,,PSBAFT) S PSBNXTX2="MISSED "_PSBNXTX1
"RTN","PSBOCM",58,0)
 ....E  S:+PSBNXTX1>0 PSBNXTX2="DUE "_PSBNXTX1
"RTN","PSBOCM",59,0)
 ...S PSBNXTX1=$$FMTDT^PSBOCE1(PSBNXTX1)
"RTN","PSBOCM",60,0)
 ...I ("^P^OC^O"[("^"_PSBSCHTY))!(PSBTB="IV")!(PSBSTS["Discontinued")!(PSBSTS["Expired") S:PSBSTS'["Hold" PSBNXTX2=" "
"RTN","PSBOCM",61,0)
 ...S PSBNXTX(PSBORDN,$G(PSBNXTX2," "))=""
"RTN","PSBOCM",62,0)
 ...; ** SPECIAL INSTRUCTIONS  **
"RTN","PSBOCM",63,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCM",64,0)
 ...S PSBSI=$P(PSBDATA(PSBX2X),U,2)
"RTN","PSBOCM",65,0)
 ...I PSBSI]" " S PSBSI(PSBORDN,PSBSI)=""
"RTN","PSBOCM",66,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCM",67,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCM",68,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCM",69,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCM",70,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCM",71,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCM",72,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCM",73,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCM",74,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCM",75,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCM",76,0)
 ..I $P(PSBDATA(PSBX2X),U)="ORF" D  Q
"RTN","PSBOCM",77,0)
 ...S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",78,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCM",79,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D
"RTN","PSBOCM",80,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCM",81,0)
 ...S PSBTEST="" F  S PSBTEST=$O(PSBFLGD(PSBORDN,PSBTEST)) Q:PSBTEST=""  I $P(PSBTEST,":")="NOX" K PSBFLGD(PSBORDN,PSBTEST) Q
"RTN","PSBOCM",82,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCM",83,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCM",84,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCM",85,0)
 ...K PSBDATA(PSBX2X)
"RTN","PSBOCM",86,0)
 ...I ($P(PSBDATA(PSBX2X+1),U)="CMT")  F  S PSBDATA=PSBDATA(PSBX2X+1) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCM",87,0)
 ....S PSBX2X=PSBX2X+1
"RTN","PSBOCM",88,0)
 ....S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCM",89,0)
 ....K PSBDATA(PSBX2X)
"RTN","PSBOCM",90,0)
 ....S:$P(PSBDATA,U,3)]"" PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCM",91,0)
 ....I 'PSBCFLG S PSBDATA=PSBDATA(PSBX2X+1) Q
"RTN","PSBOCM",92,0)
 ....I $P(PSBDATA,U,2)'="" D
"RTN","PSBOCM",93,0)
 .....S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))=""
"RTN","PSBOCM",94,0)
 .....S PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)))=PSBDATA
"RTN","PSBOCM",95,0)
 I +PSBTOT=0 K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCM",96,0)
 D CREATHDR^PSBOCM1
"RTN","PSBOCM",97,0)
 D SUBHDR^PSBOCE
"RTN","PSBOCM",98,0)
 D BLDRPT
"RTN","PSBOCM",99,0)
 D WRTRPT^PSBOCM1
"RTN","PSBOCM",100,0)
 Q
"RTN","PSBOCM",101,0)
BLDRPT ; Buld REPORT DATA
"RTN","PSBOCM",102,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCM",103,0)
 K PSBL2ULN
"RTN","PSBOCM",104,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCM",105,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCM",106,0)
 S PSBMORE=5 F PSBX1X="ACTIVE","FUTURE","EXPIRED/DC'd"," * ERROR * " D
"RTN","PSBOCM",107,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCM",108,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCM",109,0)
 .Q:PSBOCRIT'[$E(PSBX1X,1)
"RTN","PSBOCM",110,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCM",111,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCM",112,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCM",113,0)
 .K PSBDATA
"RTN","PSBOCM",114,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCM",115,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCM",116,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCM",117,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCM",118,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCM",119,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCM",120,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCM",121,0)
 ..S PSBDATA(1,5)=$O(PSBSCHD(PSBX2X,""))
"RTN","PSBOCM",122,0)
 ..S PSBDATA(1,6)=$O(PSBNXTX(PSBX2X,""))
"RTN","PSBOCM",123,0)
 ..S:PSBDATA(1,6)'["Hold" $P(PSBDATA(1,6)," ",2)=$$FMTDT^PSBOCE1($P(PSBDATA(1,6)," ",2))
"RTN","PSBOCM",124,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCM",125,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCM",126,0)
 ..S PSBSIDAT(1)=$O(PSBSI(PSBX2X,""))
"RTN","PSBOCM",127,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCM",128,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCM",129,0)
 ..D BUILDLN^PSBOCM1,SIOPI(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info:",1:""))
"RTN","PSBOCM",130,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCM",131,0)
 ..K PSB1,X I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCM",132,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCM",133,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCM",134,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCM",135,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCM",136,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCM",137,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCM",138,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCM",139,0)
 ..K PSBRPLN,PSBDATA,PSBSILN
"RTN","PSBOCM",140,0)
 D:+PSBTOT>0 LGD
"RTN","PSBOCM",141,0)
 Q
"RTN","PSBOCM",142,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCM",143,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCM",144,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCM",145,0)
 Q PSBPGNUM
"RTN","PSBOCM",146,0)
SIOPI(PSBXSI,TAB,Y) ;
"RTN","PSBOCM",147,0)
 Q:$G(PSBXSI(1))']""
"RTN","PSBOCM",148,0)
 I $G(Y,"")']"" S Y="Special Instructions: "
"RTN","PSBOCM",149,0)
 S PSBXSI(1)="  "_Y_PSBXSI(1)
"RTN","PSBOCM",150,0)
 N X
"RTN","PSBOCM",151,0)
 K J,TXT1,TXT2 S J(0)=""
"RTN","PSBOCM",152,0)
 S J=($O(J(""),-1)+1) S PSBSILN(J)="",J(J)="" S J=($O(J(""),-1)+1)
"RTN","PSBOCM",153,0)
 F X=1:1 Q:'$D(PSBXSI(X))  D
"RTN","PSBOCM",154,0)
 .S TXT1=PSBXSI(X)
"RTN","PSBOCM",155,0)
 .I ($L(TXT1)>0),$F(TXT1,"""")>1 D
"RTN","PSBOCM",156,0)
 ..S TXT1=$TR(TXT1,"""","^")
"RTN","PSBOCM",157,0)
 ..I $L(TXT1)+5'<TAB S TXT2=$E(TXT1,TAB-9,999),TXT1=$E(TXT1,1,TAB-10)
"RTN","PSBOCM",158,0)
 ..I $L(TXT1,"^")>1 F Y=1:1:$L(TXT1,"^")-1 S $P(TXT1,"^",Y)=$P(TXT1,"^",Y)_""""
"RTN","PSBOCM",159,0)
 ..I $D(TXT2) I $L(TXT2,"^")>1 F X=1:1:$L(TXT2,"^")-1 S $P(TXT2,"^",X)=$P(TXT2,"^",X)_""""
"RTN","PSBOCM",160,0)
 ..S TXT1=$TR(TXT1,"^","""") I $D(TXT2) S TXT2=$TR(TXT2,"^","""")
"RTN","PSBOCM",161,0)
 .S $E(PSBSILN(J),5,999)=TXT1,J(J)="",J=J+1
"RTN","PSBOCM",162,0)
 .I $D(TXT2) S $E(PSBSILN(J),5,999)=TXT2,J(J)="",J=J+1
"RTN","PSBOCM",163,0)
 S $E(PSBSILN(J),3,999)=" ",J(J)="",J=J+1
"RTN","PSBOCM",164,0)
 Q
"RTN","PSBOCM",165,0)
LGD ; Create Report's Legend
"RTN","PSBOCM",166,0)
 K PSBLGDO
"RTN","PSBOCM",167,0)
 S PSBLGD("ORDER TYPES","C")="Continuous"
"RTN","PSBOCM",168,0)
 S PSBLGD("ORDER TYPES","O")="One Time"
"RTN","PSBOCM",169,0)
 S PSBLGD("ORDER TYPES","OC")="On Call"
"RTN","PSBOCM",170,0)
 S PSBLGD("ORDER TYPES","P")="PRN"
"RTN","PSBOCM",171,0)
 S PSB=0 F  S PSB=$O(PSBLGD("INITIALS",PSB)) Q:+PSB=0  D
"RTN","PSBOCM",172,0)
 .S PSBINIT=$$GET1^DIQ(200,PSB_",","INITIAL"),PSBLGD("INITIALS",$S(PSBINIT']" ":"*n/a*",1:PSBINIT))=$$GET1^DIQ(200,PSB_",","NAME")
"RTN","PSBOCM",173,0)
 .K PSBLGD("INITIALS",PSB)
"RTN","PSBOCM",174,0)
 S PSBPGNUM=$O(PSBOUTP(""),-1),PSBLGDO(0)="REPORT LEGEND"
"RTN","PSBOCM",175,0)
 S PSBLGDO(1)=""
"RTN","PSBOCM",176,0)
 S PSBLGDO(2)=$S($G(PSBNO,0):"",1:"SCHEDULE TYPES")
"RTN","PSBOCM",177,0)
 S PSBLGDO(3)=""
"RTN","PSBOCM",178,0)
 I '$G(PSBNO,0) S X1="",X2=3 F  S X1=$O(PSBLGD("ORDER TYPES",X1)) Q:X1=""  S X2=X2+1,PSBLGDO(X2)=X1,$E(PSBLGDO(X2),5)="- "_PSBLGD("ORDER TYPES",X1)
"RTN","PSBOCM",179,0)
 I $D(PSBLGD("INITIALS")) S $E(PSBLGDO(2),35)="INITIALS" S X1="",X2=3 F  S X1=$O(PSBLGD("INITIALS",X1)) Q:X1=""  S X2=X2+1,$E(PSBLGDO(X2),35)=X1,$E(PSBLGDO(X2),40)="- "_PSBLGD("INITIALS",X1)
"RTN","PSBOCM",180,0)
 S (PSBMORE,X0)=10+($O(PSBLGDO(""),-1))
"RTN","PSBOCM",181,0)
 I (PSBLNTOT+PSBMORE)'<IOSL S PSBLNTOT=PSBTOPHD-2,PSBPGNUM=PSBPGNUM+1
"RTN","PSBOCM",182,0)
 I IOSL<1000 S X2=PSBLNTOT F  Q:X2'<(IOSL-(X0+3))  S PSBOUTP($$PGTOT,PSBLNTOT)="W !",X2=X2+1
"RTN","PSBOCM",183,0)
 S PSBMORE=X0
"RTN","PSBOCM",184,0)
 S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,"""_$TR($J("",IOM)," ","=")_""",!"
"RTN","PSBOCM",185,0)
 F X1=0:1 Q:'$D(PSBLGDO(X1))  S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_$G(PSBLGDO(X1)," ")_""""
"RTN","PSBOCM",186,0)
 S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,"""_$TR($J("",IOM)," ","=")_""",!"
"RTN","PSBOCM",187,0)
 Q
"RTN","PSBOCM1")
0^28^B20780748^n/a
"RTN","PSBOCM1",1,0)
PSBOCM1 ;BIRMINGHAM/TEJ-COVERSHEET MEDICATION OVERVIEW REPORT ;Mar 2004
"RTN","PSBOCM1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOCM1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCM1",4,0)
 ;
"RTN","PSBOCM1",5,0)
BUILDLN ; Constr recs
"RTN","PSBOCM1",6,0)
 K J S J(0)="" F PSBFLD=1:1:8 S J=1 D FORMDAT(PSBFLD) S J($O(PSBRPLN(""),-1))=""
"RTN","PSBOCM1",7,0)
 ; Write administration info...
"RTN","PSBOCM1",8,0)
 Q:'PSBXFLG
"RTN","PSBOCM1",9,0)
 S J=($O(J(""),-1)+1),PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCM1",10,0)
 S (N,Y)="",J=($O(J(""),-1)+1)
"RTN","PSBOCM1",11,0)
 F  S Y=$O(PSBADM(PSBX2X,Y)) Q:Y']""  D
"RTN","PSBOCM1",12,0)
 .F  S N=$O(PSBADM(PSBX2X,Y,N)) Q:N']""  D
"RTN","PSBOCM1",13,0)
 ..I $D(PSBBID(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="BAG ID: "_PSBBID(PSBX2X,$P(N,U,2))
"RTN","PSBOCM1",14,0)
 ..S $E(PSBDATA(2,0),25)="ACTION BY: "_$P(PSBADM(PSBX2X,Y,N),U,7)_" "_$$FMTDT^PSBOCE1($E($P(PSBADM(PSBX2X,Y,N),U,6),1,12))
"RTN","PSBOCM1",15,0)
 ..S X=$P(PSBADM(PSBX2X,Y,N),U,5) S $E(PSBDATA(2,0),56)="ACTION: "_$S(X="G":"GIVEN",X="R":"REFUSED",X="RM":"REMOVED",X="H":"HELD",X="S":"STOPPED",X="I":"INFUSING",X="C":"COMPLETED",X="M":"MISSING DOSE",X=" ":"*UNKNOWN*",1:" ")
"RTN","PSBOCM1",16,0)
 ..I $D(PSBPRNR(PSBX2X)) S $E(PSBDATA(2,0),72)="PRN REASON: "_PSBPRNR(PSBX2X,$P(N,U,2))
"RTN","PSBOCM1",17,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(1,132-1,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCM1",18,0)
 ..I $D(PSBPRNEF(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="PRN EFFECTIVENESS: "_PSBPRNEF(PSBX2X,$P(N,U,2))
"RTN","PSBOCM1",19,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCM1",20,0)
 ..I ('PSBCFLG)!('$D(PSBCMT(PSBX2X,$P(N,U,2)))) S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1 Q
"RTN","PSBOCM1",21,0)
 ..S X="" F   S X=$O(PSBCMT(PSBX2X,$P(N,U,2),X)) Q:X']""  D
"RTN","PSBOCM1",22,0)
 ...S PSBDATA(2,0)="COMMENT BY: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,5)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X),U,5)_" "_$$FMTDT^PSBOCE1($E($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,6),1,12)),1:" n/a ")
"RTN","PSBOCM1",23,0)
 ...S PSBDATA(2,0)=PSBDATA(2,0)_"  COMMENT: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,2)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X),U,2),1:" ")
"RTN","PSBOCM1",24,0)
 ...I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCM1",25,0)
 ..S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCM1",26,0)
 Q
"RTN","PSBOCM1",27,0)
FORMDAT(FLD) ;
"RTN","PSBOCM1",28,0)
 K PSBVAL
"RTN","PSBOCM1",29,0)
 Q:'$D(PSBDATA(1,FLD))
"RTN","PSBOCM1",30,0)
 S PSBVAL=PSBDATA(1,FLD)
"RTN","PSBOCM1",31,0)
 D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCM1",32,0)
 I FLD=4 S J=$O(J(""),-1)+1,PSBVAL=PSBDATA(1,4,0) D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCM1",33,0)
 Q
"RTN","PSBOCM1",34,0)
WRAPPER(X,Y,Z) ;  Text WRAP
"RTN","PSBOCM1",35,0)
 N PSB
"RTN","PSBOCM1",36,0)
 I ($L(Z)>0),$F(Z,"""")>1 F  Q:$F(Z,"""")'>1  S Z=$TR(Z,"""","^")
"RTN","PSBOCM1",37,0)
 F  Q:'$L(Z)  D
"RTN","PSBOCM1",38,0)
 .I $L(Z)<Y S $E(PSBRPLN(J),X)=Z S Z="" D  Q
"RTN","PSBOCM1",39,0)
 ..I $L(PSBRPLN(J),"^")>1 F X=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",X)=$P(PSBRPLN(J),"^",X)_""""
"RTN","PSBOCM1",40,0)
 ..S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOCM1",41,0)
 .F PSB=Y:-1:0 Q:($E(Z,PSB)=" ")  Q:($E(Z,PSB)="-")
"RTN","PSBOCM1",42,0)
 .S:PSB<1 PSB=Y
"RTN","PSBOCM1",43,0)
 .S $E(PSBRPLN(J),X)=$E(Z,1,PSB)
"RTN","PSBOCM1",44,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBOCM1",45,0)
 .I $L(PSBRPLN(J),"^")>1 F X=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",X)=$P(PSBRPLN(J),"^",X)_""""
"RTN","PSBOCM1",46,0)
 .S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOCM1",47,0)
 .S J=J+1,J(J)=""
"RTN","PSBOCM1",48,0)
 Q ""
"RTN","PSBOCM1",49,0)
CREATHDR ;
"RTN","PSBOCM1",50,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCM1",51,0)
 I IOM'<132 S PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(C132BLK),";",2)
"RTN","PSBOCM1",52,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" Q
"RTN","PSBOCM1",53,0)
 ; reset tabs
"RTN","PSBOCM1",54,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCM1",55,0)
 S PSBPGNUM=1
"RTN","PSBOCM1",56,0)
 D HDR
"RTN","PSBOCM1",57,0)
 Q
"RTN","PSBOCM1",58,0)
HD132A ;~VDL  |   Order    |Type|       Medication; Dosage, Route      |  Schedule   |      Next Action      |  Order Start  |   Order Stop  |
"RTN","PSBOCM1",59,0)
 Q
"RTN","PSBOCM1",60,0)
HD132B ;Tab  |   Status   |    |                                      |             |                       |   Date        |    Date       |
"RTN","PSBOCM1",61,0)
 Q
"RTN","PSBOCM1",62,0)
C132BLK ;;
"RTN","PSBOCM1",63,0)
 Q
"RTN","PSBOCM1",64,0)
WRTRPT ;  writ
"RTN","PSBOCM1",65,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCM1",66,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOCM1",67,0)
 .D FTR
"RTN","PSBOCM1",68,0)
 S PSBPGNUM=1
"RTN","PSBOCM1",69,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCM1",70,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR^PSBOCE
"RTN","PSBOCM1",71,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCM1",72,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCM1",73,0)
 D FTR
"RTN","PSBOCM1",74,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCM1",75,0)
 Q
"RTN","PSBOCM1",76,0)
HDR ;  Header
"RTN","PSBOCM1",77,0)
 W:$Y>1 @IOF
"RTN","PSBOCM1",78,0)
 W:$X>1 !
"RTN","PSBOCM1",79,0)
 S PSBRPNM="BCMA COVERSHEET MEDICATION OVERVIEW REPORT"
"RTN","PSBOCM1",80,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCM1",81,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCM1",82,0)
 .S PSBHDR(1)="Order Status(es): --"
"RTN","PSBOCM1",83,0)
 .F Y=4,5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^Future^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCM1",84,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCM1",85,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCM1",86,0)
 Q
"RTN","PSBOCM1",87,0)
FTR ;  Fter
"RTN","PSBOCM1",88,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOCM1",89,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOCM1",90,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOCM1",91,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOCM1",92,0)
 Q
"RTN","PSBOCP")
0^14^B73770736^n/a
"RTN","PSBOCP",1,0)
PSBOCP ;BIRMINGHAM/TEJ-COVERSHEET PRN OVERVIEW REPORT ;Mar 2004
"RTN","PSBOCP",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOCP",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCP",4,0)
 ;
"RTN","PSBOCP",5,0)
 ; Reference/IA
"RTN","PSBOCP",6,0)
 ; File 4/10090
"RTN","PSBOCP",7,0)
EN ; Entry Point
"RTN","PSBOCP",8,0)
 N PSBX1X,RESULTS,RESULT,PSBFUTR
"RTN","PSBOCP",9,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOCP",10,0)
 S (PSBOCRIT,PSBXFLG,PSBCFLG)=""        ;  Order Status search criteria - "A"ctive, "D"C ed, "E"xpired"
"RTN","PSBOCP",11,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D" S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E" S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOCP",12,0)
 S:$P(PSBFUTR,U,4) PSBOCRIT=PSBOCRIT_"F"
"RTN","PSBOCP",13,0)
 S:$P(PSBFUTR,U,11) PSBXFLG=1
"RTN","PSBOCP",14,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOCP",15,0)
 K PSBSRTBY,PSBCMT,PSBADM,PSBDATA,PSBOUTP,PSBLGD
"RTN","PSBOCP",16,0)
 S PSBSORT=1
"RTN","PSBOCP",17,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=Y
"RTN","PSBOCP",18,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN BEFORE")
"RTN","PSBOCP",19,0)
 S PSBB4=0 S:RESULTS(0)>0 PSBB4=+RESULTS(0)
"RTN","PSBOCP",20,0)
 D GETPAR^PSBPAR("ALL","PSB ADMIN AFTER")
"RTN","PSBOCP",21,0)
 S PSBAFT=0 S:RESULTS(0)>0 PSBAFT=+RESULTS(0)
"RTN","PSBOCP",22,0)
 K ^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCP",23,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSBX1X)=""
"RTN","PSBOCP",24,0)
 K PSBLIST,PSBLIST2
"RTN","PSBOCP",25,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOCP",26,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOCP",27,0)
 S (PSBX1X,PSBTOT)=0
"RTN","PSBOCP",28,0)
 F  S PSBX1X=$O(PSBLIST(PSBX1X)) Q:+PSBX1X=0  D
"RTN","PSBOCP",29,0)
 .D RPC^PSBCSUTL(.PSBAREA,PSBX1X)
"RTN","PSBOCP",30,0)
 .M PSBDATA=@PSBAREA
"RTN","PSBOCP",31,0)
 .S PSBX2X=1
"RTN","PSBOCP",32,0)
 .S (PSBLIST2("ACTIVE"),PSBLIST2("FUTURE"),PSBLIST2("EXPIRED/DC'd"),PSBLIST2(" * ERROR * "))=0
"RTN","PSBOCP",33,0)
 .F  S PSBX2X=$O(PSBDATA(PSBX2X)) Q:+PSBX2X=0  D
"RTN","PSBOCP",34,0)
 ..S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCP",35,0)
 ..I ($P(PSBDATA,U)="ORD") I $P(PSBDATA,U,6)'="P" F  S PSBX2X=$O(PSBDATA(PSBX2X)) S PSBDATA=PSBDATA(PSBX2X) Q:$P(PSBDATA,U)="END"
"RTN","PSBOCP",36,0)
 ..I ($P(PSBDATA,U)="ORD") K PSBORDN  D  Q
"RTN","PSBOCP",37,0)
 ...K PSBDRUGN
"RTN","PSBOCP",38,0)
 ...S PSBSCHTY="P"
"RTN","PSBOCP",39,0)
 ...S PSBORDN=$P(PSBDATA,U,3)
"RTN","PSBOCP",40,0)
 ...S PSBTB=$P(PSBDATA,U,29) S PSBTB=$S(PSBTB=1:"UD",PSBTB=2:"IVPB",PSBTB=3:"IV",1:" * ERROR * ")
"RTN","PSBOCP",41,0)
 ...S PSBTB(PSBORDN,PSBTB)=""
"RTN","PSBOCP",42,0)
 ...S PSBSTS1=$P(PSBDATA,U,23)
"RTN","PSBOCP",43,0)
 ...S PSBSTS=$S((PSBSTS1="A")&(($P(PSBDATA,U,27)>PSBNOWX)):"Active",PSBSTS1="H":"Hold",PSBSTS1="D":"Discontinued",PSBSTS1="DE":"Discontinued (Edit)",(PSBSTS1="E")!($P(PSBDATA,U,27)'>PSBNOWX):"Expired",1:" * ERROR * ")
"RTN","PSBOCP",44,0)
 ...S PSBSTS(PSBORDN,PSBSTS)=""
"RTN","PSBOCP",45,0)
 ...S V=$$FMADD^XLFDT(PSBNOWX,,,PSBB4)
"RTN","PSBOCP",46,0)
 ...S PSBSTSX=$S($P(PSBDATA,U,27)'>PSBNOWX:"EXPIRED/DC'd",$P(PSBDATA,U,22)'>V:"ACTIVE",V:"FUTURE",1:" * ERROR * ")
"RTN","PSBOCP",47,0)
 ...S PSBLIST2(PSBSTSX,$P(PSBDATA,U,9),PSBORDN)="" S PSBLIST2(PSBSTSX)=PSBLIST2(PSBSTSX)+1
"RTN","PSBOCP",48,0)
 ...S:PSBOCRIT[$E(PSBSTSX,1) PSBTOT=PSBTOT+1
"RTN","PSBOCP",49,0)
 ...S PSBSCHTY(PSBORDN,PSBSCHTY)=""
"RTN","PSBOCP",50,0)
 ...S PSBDOSR=$P(PSBDATA,U,10)_", "_$P(PSBDATA,U,11)
"RTN","PSBOCP",51,0)
 ...S PSBDOSR=$TR($E(PSBDOSR,1)," ")_$E(PSBDOSR,2,999)
"RTN","PSBOCP",52,0)
 ...S PSBDOSR(PSBORDN,PSBDOSR)=""
"RTN","PSBOCP",53,0)
 ...S PSBLSTG=$P(PSBDATA,U,28)
"RTN","PSBOCP",54,0)
 ...I PSBLSTG]"" S PSBLSTG(PSBORDN,$$FMTDT^PSBOCE1($E(PSBLSTG,1,12)))=""
"RTN","PSBOCP",55,0)
 ...S PSBLSTX=$S(PSBLSTG]"":$$LSTX(PSBLSTG,PSBNOWX),1:" ")
"RTN","PSBOCP",56,0)
 ...S PSBLSTX(PSBORDN,PSBLSTX)=""
"RTN","PSBOCP",57,0)
 ...; ** SPECIAL INSTRUCTIONS  **
"RTN","PSBOCP",58,0)
 ...S PSBX2X=PSBX2X+1
"RTN","PSBOCP",59,0)
 ...S PSBSI=$P(PSBDATA(PSBX2X),U,2)
"RTN","PSBOCP",60,0)
 ...I PSBSI]" " S PSBSI(PSBORDN,PSBSI)=""
"RTN","PSBOCP",61,0)
 ...S PSBOSTDT=$P(PSBDATA,U,22)
"RTN","PSBOCP",62,0)
 ...S PSBOSTDT(PSBORDN,PSBOSTDT)=""
"RTN","PSBOCP",63,0)
 ...S PSBOSPDT=$P(PSBDATA,U,27)
"RTN","PSBOCP",64,0)
 ...S PSBOSPDT(PSBORDN,PSBOSPDT)=""
"RTN","PSBOCP",65,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",66,0)
 ..I "^DD^ADD^SOL"[(U_$P(PSBDATA(PSBX2X),U)) D  Q
"RTN","PSBOCP",67,0)
 ...F I=PSBX2X:1 S PSBDATA1=PSBDATA(I) D  Q:$D(PSBOMDR(PSBORDN))
"RTN","PSBOCP",68,0)
 ....I "^DD^ADD^SOL"[(U_$P(PSBDATA1,U)) S PSBX2X=I S PSBDRUGN=$G(PSBDRUGN,"")_$P(PSBDATA1,U,3)_", " Q
"RTN","PSBOCP",69,0)
 ....S $E(PSBDRUGN,$L(PSBDRUGN)-1)="" S PSBDRUGN(PSBORDN,$E(PSBDRUGN,1,250))=PSBDRUGN
"RTN","PSBOCP",70,0)
 ....S PSBOMDR(PSBORDN,$E((PSBDRUGN_"; "_PSBDOSR),1,250))=PSBDRUGN_"; "_PSBDOSR
"RTN","PSBOCP",71,0)
 ..I $P(PSBDATA,U)="END" Q
"RTN","PSBOCP",72,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",73,0)
 ..I $P(PSBDATA(PSBX2X),U)="ORF" D  Q
"RTN","PSBOCP",74,0)
 ...S PSBDATA=PSBDATA(PSBX2X)
"RTN","PSBOCP",75,0)
 ...S:$P(PSBDATA,U,2)]"" PSBFLGD(PSBORDN,$P(PSBDATA,U,3)_" - "_$P(PSBDATA,U,4))=""
"RTN","PSBOCP",76,0)
 ..Q:'$D(PSBORDN)
"RTN","PSBOCP",77,0)
 ..I ($P(PSBDATA,U)="ADM")&($P(PSBDATA,U,4)]"") D  Q
"RTN","PSBOCP",78,0)
 ...S PSBXID=$P(PSBDATA,U,6)_U_$P(PSBDATA,U,4),PSBADM(PSBORDN,(-1*($P(PSBDATA,U,6))),PSBXID)=PSBDATA
"RTN","PSBOCP",79,0)
 ...I $O(PSBSCHTY(PSBORDN,""))="P" S PSBPRNR(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,9)
"RTN","PSBOCP",80,0)
 ...I $P(PSBDATA,U,3)]"" S PSBBID(PSBORDN,$P(PSBDATA,U,4))=$P(PSBDATA,U,3)
"RTN","PSBOCP",81,0)
 ...S:PSBXFLG PSBLGD(PSBORDN,"X","INITIALS",$P(PSBDATA,U,8))=""
"RTN","PSBOCP",82,0)
 ...I $P(PSBDATA(PSBX2X+1),U)="CMT"  S PSBX2X=PSBX2X+1 F PSBX3X=PSBX2X:1 S PSBDATA=PSBDATA(PSBX3X) Q:($P(PSBDATA,U)'="CMT")  D
"RTN","PSBOCP",83,0)
 ....S PSBX2X=PSBX3X
"RTN","PSBOCP",84,0)
 ....I $P(PSBDATA,U,3)]"" S PSBPRNEF(PSBORDN,$P(PSBXID,U,2))=$P(PSBDATA,U,3)
"RTN","PSBOCP",85,0)
 ....I PSBCFLG I $P(PSBDATA,U,2)'="" S PSBLGD(PSBORDN,"C","INITIALS",$P(PSBDATA,U,4))="",PSBCMT(PSBORDN,$P(PSBXID,U,2),(-1*$P(PSBDATA,U,6)))=PSBDATA
"RTN","PSBOCP",86,0)
 I +PSBTOT=0 K PSBLIST,^XTMP("PSBO",$J,"PSBLIST")
"RTN","PSBOCP",87,0)
 D CREATHDR^PSBOCP1
"RTN","PSBOCP",88,0)
 D SUBHDR^PSBOCE
"RTN","PSBOCP",89,0)
 D BLDRPT
"RTN","PSBOCP",90,0)
 D WRTRPT^PSBOCP1
"RTN","PSBOCP",91,0)
 Q
"RTN","PSBOCP",92,0)
BLDRPT ; Buld REPORT DATA
"RTN","PSBOCP",93,0)
 K PSBL2ULN
"RTN","PSBOCP",94,0)
 S PSBTOPHD=PSBLNTOT-2
"RTN","PSBOCP",95,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOCP",96,0)
 .S PSBOUTP(0,PSBLNTOT)="W !!,""<<<< NO ORDERS TO DISPLAY >>>>"",!!"
"RTN","PSBOCP",97,0)
 S PSBMORE=5 F PSBX1X="ACTIVE","FUTURE","EXPIRED/DC'd"," * ERROR * " D
"RTN","PSBOCP",98,0)
 .I PSBX1X'=" * ERROR * " S PSBSUM=PSBX1X_" ["_PSBLIST2(PSBX1X)_$S(PSBLIST2(PSBX1X)=1:" Order",1:" Orders")_"]" S PSBOUTP($$PGTOT,PSBLNTOT)="W !!,"""_PSBSUM_""""
"RTN","PSBOCP",99,0)
 .Q:PSBLIST2(PSBX1X)=0
"RTN","PSBOCP",100,0)
 .Q:PSBOCRIT'[$E(PSBX1X,1)
"RTN","PSBOCP",101,0)
 .S:$L(PSBSUM)>$G(PSBL2ULN,0) PSBL2ULN=$L(PSBSUM)
"RTN","PSBOCP",102,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBL2ULN),"" "",""=""),!"
"RTN","PSBOCP",103,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !"
"RTN","PSBOCP",104,0)
 .K PSBDATA
"RTN","PSBOCP",105,0)
 .S X0="",PSBTOT1=0
"RTN","PSBOCP",106,0)
 .F  S X0=$O(PSBLIST2(PSBX1X,X0))  Q:X0=""  S PSBX2X="" F  S PSBX2X=$O(PSBLIST2(PSBX1X,X0,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCP",107,0)
 ..M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"X","INITIALS") M PSBLGD("INITIALS")=PSBLGD(PSBX2X,"C","INITIALS")
"RTN","PSBOCP",108,0)
 ..S PSBDATA(1,1)=$O(PSBTB(PSBX2X,""))
"RTN","PSBOCP",109,0)
 ..S PSBDATA(1,2)=$O(PSBSTS(PSBX2X,""))
"RTN","PSBOCP",110,0)
 ..S PSBDATA(1,3)=$O(PSBSCHTY(PSBX2X,""))
"RTN","PSBOCP",111,0)
 ..S Y0=$O(PSBOMDR(PSBX2X,"")) I Y0]"" S PSBDATA(1,4)="("_X0_")",PSBDATA(1,4,0)=PSBOMDR(PSBX2X,Y0)
"RTN","PSBOCP",112,0)
 ..S PSBDATA(1,5)=$O(PSBLSTG(PSBX2X,""))
"RTN","PSBOCP",113,0)
 ..S PSBDATA(1,6)=$O(PSBLSTX(PSBX2X,""))
"RTN","PSBOCP",114,0)
 ..S PSBDATA(1,7)=$$FMTDT^PSBOCE1($O(PSBOSTDT(PSBX2X,"")))
"RTN","PSBOCP",115,0)
 ..S PSBDATA(1,8)=$$FMTDT^PSBOCE1($E($O(PSBOSPDT(PSBX2X,"")),1,12))
"RTN","PSBOCP",116,0)
 ..S PSBSIDAT(1)=$O(PSBSI(PSBX2X,""))
"RTN","PSBOCP",117,0)
 ..S PSBTOT1=PSBTOT1+1
"RTN","PSBOCP",118,0)
 ..K PSBDATA(2),PSBDATA(3),PSBSILN
"RTN","PSBOCP",119,0)
 ..D BUILDLN,SIOPI^PSBOCM(.PSBSIDAT,PSBTAB8,$S(PSBX2X["V":"Other Print Info:",1:""))
"RTN","PSBOCP",120,0)
 ..I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+6 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOCP",121,0)
 ..K PSB1 I $D(PSBFLGD(PSBX2X)) S PSB="" F  S PSB=$O(PSBFLGD(PSBX2X,PSB)) Q:PSB=""  I ($P(PSB,":")'="NOX")&($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOCP",122,0)
 ..S PSBCNT=PSBTOT1_"   "_$G(PSB1,"")
"RTN","PSBOCP",123,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W """_PSBCNT_""""
"RTN","PSBOCP",124,0)
 ..S I="" F  S I=$O(PSBRPLN(I)) Q:+I=0  D
"RTN","PSBOCP",125,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(I)_""""
"RTN","PSBOCP",126,0)
 ..S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOCP",127,0)
 ...S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOCP",128,0)
 ..S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOCP",129,0)
 ..K PSBRPLN,PSBDATA
"RTN","PSBOCP",130,0)
 D:+PSBTOT>0 LGD^PSBOCM
"RTN","PSBOCP",131,0)
 Q
"RTN","PSBOCP",132,0)
BUILDLN ; Constr recs
"RTN","PSBOCP",133,0)
 K J S J(0)="" F PSBFLD=1:1:8 S J=1 D FORMDAT(PSBFLD) S J($O(PSBRPLN(""),-1))=""
"RTN","PSBOCP",134,0)
 ; Write administration info...
"RTN","PSBOCP",135,0)
 Q:'PSBXFLG
"RTN","PSBOCP",136,0)
 S J=($O(J(""),-1)+1),PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCP",137,0)
 S (N,Y)=""
"RTN","PSBOCP",138,0)
 F  S Y=$O(PSBADM(PSBX2X,Y)) Q:Y']""  D
"RTN","PSBOCP",139,0)
 .F  S N=$O(PSBADM(PSBX2X,Y,N)) Q:N']""  D
"RTN","PSBOCP",140,0)
 ..I $D(PSBBID(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="BAG ID: "_PSBBID(PSBX2X,$P(N,U,2))
"RTN","PSBOCP",141,0)
 ..S $E(PSBDATA(2,0),25)="ACTION BY: "_$P(PSBADM(PSBX2X,Y,N),U,7)_" "_$$FMTDT^PSBOCE1($E($P(PSBADM(PSBX2X,Y,N),U,6),1,12))
"RTN","PSBOCP",142,0)
 ..S X=$P(PSBADM(PSBX2X,Y,N),U,5) S $E(PSBDATA(2,0),56)="ACTION: "_$S(X="G":"GIVEN",X="R":"REFUSED",X="RM":"REMOVED",X="H":"HELD",X="S":"STOPPED",X="I":"INFUSING",X="C":"COMPLETED",X="M":"MISSING DOSE",X=" ":"*UNKNOWN*",1:" ")
"RTN","PSBOCP",143,0)
 ..I $D(PSBPRNR(PSBX2X)) S $E(PSBDATA(2,0),72)="PRN REASON: "_PSBPRNR(PSBX2X,$P(N,U,2))
"RTN","PSBOCP",144,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(1,132-1,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",145,0)
 ..I $D(PSBPRNEF(PSBX2X,$P(N,U,2))) S PSBDATA(2,0)="PRN EFFECTIVENESS: "_PSBPRNEF(PSBX2X,$P(N,U,2))
"RTN","PSBOCP",146,0)
 ..I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",147,0)
 ..I ('PSBCFLG)!('$D(PSBCMT(PSBX2X,$P(N,U,2)))) S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1 Q
"RTN","PSBOCP",148,0)
 ..S X="" F   S X=$O(PSBCMT(PSBX2X,$P(N,U,2),X)) Q:X']""  D
"RTN","PSBOCP",149,0)
 ...S PSBDATA(2,0)="COMMENT BY: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,5)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X),U,5)_" "_$$FMTDT^PSBOCE1($E($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,6),1,12)),1:" n/a ")
"RTN","PSBOCP",150,0)
 ...S PSBDATA(2,0)=PSBDATA(2,0)_"  COMMENT: "_$S($P(PSBCMT(PSBX2X,$P(N,U,2),X),U,2)]"":$P(PSBCMT(PSBX2X,$P(N,U,2),X),U,2),1:" ")
"RTN","PSBOCP",151,0)
 ...I $G(PSBDATA(2,0))]" " D WRAPPER(30,132-30,PSBDATA(2,0)) K PSBDATA(2) S J=J+1
"RTN","PSBOCP",152,0)
 ..S PSBRPLN(J)=PSBBLANK,J(J)="",J=J+1
"RTN","PSBOCP",153,0)
 Q
"RTN","PSBOCP",154,0)
FORMDAT(FLD) ;
"RTN","PSBOCP",155,0)
 K PSBVAL
"RTN","PSBOCP",156,0)
 Q:'$D(PSBDATA(1,FLD))
"RTN","PSBOCP",157,0)
 S PSBVAL=PSBDATA(1,FLD)
"RTN","PSBOCP",158,0)
 D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCP",159,0)
 I FLD=4 S J=$O(J(""),-1)+1,PSBVAL=PSBDATA(1,4,0) D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOCP",160,0)
 Q
"RTN","PSBOCP",161,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOCP",162,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) D PGC^PSBOCE1
"RTN","PSBOCP",163,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOCP",164,0)
 Q PSBPGNUM
"RTN","PSBOCP",165,0)
WRAPPER(X,Y,Z) ;  Text WRAP
"RTN","PSBOCP",166,0)
 N PSB
"RTN","PSBOCP",167,0)
 I ($L(Z)>0),$F(Z,"""")>1 F  Q:$F(Z,"""")'>1  S Z=$TR(Z,"""","^")
"RTN","PSBOCP",168,0)
 F  Q:'$L(Z)  D
"RTN","PSBOCP",169,0)
 .I $L(Z)<Y S $E(PSBRPLN(J),X)=Z S Z="" Q
"RTN","PSBOCP",170,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBOCP",171,0)
 .S:PSB<1 PSB=Y
"RTN","PSBOCP",172,0)
 .S $E(PSBRPLN(J),X)=$E(Z,1,PSB)
"RTN","PSBOCP",173,0)
 .I $L(PSBRPLN(J),"^")>1 F X=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",X)=$P(PSBRPLN(J),"^",X)_""""
"RTN","PSBOCP",174,0)
 .S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOCP",175,0)
 .S Z=$E(Z,PSB+1,250),J=J+1,J(J)=""
"RTN","PSBOCP",176,0)
 Q ""
"RTN","PSBOCP",177,0)
LSTX(P,O) ;
"RTN","PSBOCP",178,0)
 S DT=$$FMDIFF^XLFDT(O,P,2)
"RTN","PSBOCP",179,0)
 I ((DT\60)<1) Q "0d 0h 1m"
"RTN","PSBOCP",180,0)
 S D=(DT\(60*60*24)) S DT=DT-(D*(60*60*24))
"RTN","PSBOCP",181,0)
 S H=(DT\(60*60)) S DT=DT-(H*(60*60))
"RTN","PSBOCP",182,0)
 S M=((DT+30)\(60)) S DT=DT-(M*(60))
"RTN","PSBOCP",183,0)
 Q D_"d "_H_"h "_M_"m"
"RTN","PSBOCP1")
0^29^B6438461^n/a
"RTN","PSBOCP1",1,0)
PSBOCP1 ;BIRMINGHAM/TEJ-COVERSHEET PRN OVERVIEW REPORT ;Mar 2004
"RTN","PSBOCP1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOCP1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOCP1",4,0)
 ;
"RTN","PSBOCP1",5,0)
WRTRPT ;  writ
"RTN","PSBOCP1",6,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOCP1",7,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOCP1",8,0)
 .D FTR
"RTN","PSBOCP1",9,0)
 S PSBPGNUM=1
"RTN","PSBOCP1",10,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOCP1",11,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR^PSBOCE
"RTN","PSBOCP1",12,0)
 .S PSBX2X="" F  S PSBX2X=$O(PSBOUTP(PSBZ,PSBX2X)) Q:PSBX2X=""  D
"RTN","PSBOCP1",13,0)
 ..X PSBOUTP(PSBZ,PSBX2X)
"RTN","PSBOCP1",14,0)
 D FTR
"RTN","PSBOCP1",15,0)
 K ^XTMP("PSBO",$J,"PSBLIST"),PSBOUTP
"RTN","PSBOCP1",16,0)
 Q
"RTN","PSBOCP1",17,0)
CREATHDR ;
"RTN","PSBOCP1",18,0)
 K PSBHD1,PSBHD2
"RTN","PSBOCP1",19,0)
 I IOM'<132 S PSBHD1=$P($T(HD132A),"~",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(C132BLK),";",2)
"RTN","PSBOCP1",20,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" Q
"RTN","PSBOCP1",21,0)
 ; reset tabs
"RTN","PSBOCP1",22,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOCP1",23,0)
 S PSBPGNUM=1
"RTN","PSBOCP1",24,0)
 D HDR
"RTN","PSBOCP1",25,0)
 Q
"RTN","PSBOCP1",26,0)
HD132A ;~ VDL |    Status   |Type|      Medication; Dosage, Route      |   Last Given  |      Since    |    Order Start   |    Order Stop   |
"RTN","PSBOCP1",27,0)
 Q
"RTN","PSBOCP1",28,0)
HD132B ; Tab |             |    |                                     |               |   Last Given  |    Date          |    Date         |
"RTN","PSBOCP1",29,0)
 Q
"RTN","PSBOCP1",30,0)
C132BLK ;;     |             |    |                                     |               |               |                  |                 |
"RTN","PSBOCP1",31,0)
 Q
"RTN","PSBOCP1",32,0)
HDR ;  Header
"RTN","PSBOCP1",33,0)
 W:$Y>1 @IOF
"RTN","PSBOCP1",34,0)
 W:$X>1 !
"RTN","PSBOCP1",35,0)
 S PSBRPNM="BCMA COVERSHEET PRN OVERVIEW REPORT"
"RTN","PSBOCP1",36,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOCP1",37,0)
 .S PSBHDR(0)=PSBRPNM
"RTN","PSBOCP1",38,0)
 .S PSBHDR(1)="Order Status(es): --"
"RTN","PSBOCP1",39,0)
 .F Y=4,5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(1),": ",2)=$P(PSBHDR(1),": ",2)_$S(PSBHDR(1)["--":"",1:"/ ")_$P("^^^Future^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(1)=$TR(PSBHDR(1),"-","")
"RTN","PSBOCP1",40,0)
 .I $P(PSBFUTR,U,11) S PSBHDR(2)="Include Action(s)"_$S(PSBCFLG:" & Comments/Reasons",1:"")
"RTN","PSBOCP1",41,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOCP1",42,0)
 Q
"RTN","PSBOCP1",43,0)
FTR ;  Fter
"RTN","PSBOCP1",44,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOCP1",45,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOCP1",46,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOCP1",47,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOCP1",48,0)
 Q
"RTN","PSBODL")
0^16^B72460144^B83477494
"RTN","PSBODL",1,0)
PSBODL ;BIRMINGHAM/EFC-DUE LIST ;Mar 2004
"RTN","PSBODL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9,38,32**;Mar 2004;Build 32
"RTN","PSBODL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified. 
"RTN","PSBODL",4,0)
 ;
"RTN","PSBODL",5,0)
 ; Reference/IA
"RTN","PSBODL",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBODL",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBODL",8,0)
 ; ^XLFDT/10103
"RTN","PSBODL",9,0)
 ;
"RTN","PSBODL",10,0)
EN ; Prt DL
"RTN","PSBODL",11,0)
 N PSBGBL,PSBHDR,IOINHI,IOINORM,PSBGIVEN,PSBIEN,PSBLGDT,PSBEVDT,DFN,PSBFLAG
"RTN","PSBODL",12,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS S X=""
"RTN","PSBODL",13,0)
 I '$D(^TMP("PSBO",$J,"B")) S ^TMP("PSBO",$J,"B","EMPTY")=""
"RTN","PSBODL",14,0)
 S PSBGBL="^TMP(""PSBO"",$J,""B"")"
"RTN","PSBODL",15,0)
 I $G(PSBRPT(.4)) S $P(PSBRPT(.2),U,8)=1
"RTN","PSBODL",16,0)
 F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:$QS(PSBGBL,1)'="PSBO"!($QS(PSBGBL,2)'=$J)  D
"RTN","PSBODL",17,0)
 .S DFN=$QS(PSBGBL,5)
"RTN","PSBODL",18,0)
 .K PSBHDR
"RTN","PSBODL",19,0)
 .S PSBHDR(1)="MEDICATION DUE LIST for "
"RTN","PSBODL",20,0)
 .S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ S Z=Y,PSBHDR(1)=PSBHDR(1)_Y_"@" S Y=$P(PSBRPT(.1),U,7) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)
"RTN","PSBODL",21,0)
 .S PSBEVDT2=$P(PSBRPT(.1),U,6) S Y=$P(PSBRPT(.1),U,9) S:Y]"" PSBHDR(1)=PSBHDR(1)_" to "_Z_"@"_$E(Y_"0000",2,5)
"RTN","PSBODL",22,0)
 .S PSBHDR(2)="Schedule Type(s): --"
"RTN","PSBODL",23,0)
 .F Y=1:1:4 I $P(PSBRPT(.2),U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("Continuous^PRN^On-Call^One-Time",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBODL",24,0)
 .S PSBHDR(3)="Order Type(s): --"
"RTN","PSBODL",25,0)
 .F Y=6,7,8 I $P(PSBRPT(.2),U,Y) S $P(PSBHDR(3),": ",2)=$P(PSBHDR(3),": ",2)_$S(PSBHDR(3)["--":"",1:"/ ")_$P("^^^^^IV^Unit Dose^Future Orders",U,Y)_" " S PSBHDR(3)=$TR(PSBHDR(3),"-","")
"RTN","PSBODL",26,0)
 .I $QS(PSBGBL,4)="EMPTY" D  Q
"RTN","PSBODL",27,0)
 ..S X="" F  S X=$O(PSBHDR(X)) Q:X=""  D  W !!?10,"** NO DATA FOR ENTIRE NURSE/WARD LOCATION **",! Q
"RTN","PSBODL",28,0)
 ...W !,PSBHDR(X)
"RTN","PSBODL",29,0)
 .D PRINT(DFN)
"RTN","PSBODL",30,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J)
"RTN","PSBODL",31,0)
 Q
"RTN","PSBODL",32,0)
PRINT(DFN) ;^TMP($J.
"RTN","PSBODL",33,0)
 N PSBGBL,PSBOSTRT,PSBOSTOP,PSBINDX,PSBTYPE,PSBSCH,PSBSCHT
"RTN","PSBODL",34,0)
 N PSBMED,PSBORD,PSB,PSBX,PSBY,PSBZ,PSBSTOP,PSBSTRT,PSBSM,PSBNUM,PSBAT
"RTN","PSBODL",35,0)
 N PSBADMIN,PSBADM,PSBSTAT,PSBWFLAG
"RTN","PSBODL",36,0)
 W $$HDR()
"RTN","PSBODL",37,0)
 S PSBOSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBODL",38,0)
 S PSBOSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBODL",39,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBODL",40,0)
 D EN^PSJBCMA(DFN,PSBOSTRT,"")
"RTN","PSBODL",41,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",!,$$BLANKS(),$$FTR^PSBODL1() Q
"RTN","PSBODL",42,0)
 S PSBI1=0 F  S PSBODATE=$$FMADD^XLFDT(PSBEVDT,PSBI1) Q:PSBODATE>PSBEVDT2  D
"RTN","PSBODL",43,0)
 .S PSBI1=1
"RTN","PSBODL",44,0)
 .S Y=PSBODATE D D^DIQ
"RTN","PSBODL",45,0)
 .W !!,"Administration Date: "_Y,!
"RTN","PSBODL",46,0)
 .S PSBINDX=0
"RTN","PSBODL",47,0)
 .F  S PSBINDX=$O(^TMP("PSJ",$J,PSBINDX)) Q:'PSBINDX  D
"RTN","PSBODL",48,0)
 ..S PSBTYPE=$P(^TMP("PSJ",$J,PSBINDX,0),U,3),PSBTYPE=$E(PSBTYPE,$L(PSBTYPE))
"RTN","PSBODL",49,0)
 ..Q:PSBTYPE=""!(PSBTYPE="P")  ; No Pend this ver
"RTN","PSBODL",50,0)
 ..S PSBSTAT=^TMP("PSJ",$J,PSBINDX,1)
"RTN","PSBODL",51,0)
 ..I $P(PSBSTAT,U,7)["D"!($P(PSBSTAT,U,8)) Q
"RTN","PSBODL",52,0)
 ..Q:PSBTYPE="U"&('$P(PSBRPT(.2),U,7))
"RTN","PSBODL",53,0)
 ..Q:PSBTYPE="V"&('$P(PSBRPT(.2),U,6))
"RTN","PSBODL",54,0)
 ..S PSBTYPE=$S(PSBTYPE="U":"UD-",PSBTYPE="V":"IV-",1:"**")
"RTN","PSBODL",55,0)
 ..S Y=$P(PSBSTAT,U,2)
"RTN","PSBODL",56,0)
 ..Q:Y="C"&('$P(PSBRPT(.2),U,1))
"RTN","PSBODL",57,0)
 ..Q:Y="P"&('$P(PSBRPT(.2),U,2))
"RTN","PSBODL",58,0)
 ..Q:Y="OC"&('$P(PSBRPT(.2),U,3))
"RTN","PSBODL",59,0)
 ..Q:Y="O"&('$P(PSBRPT(.2),U,4))
"RTN","PSBODL",60,0)
 ..S PSBSCHT=Y
"RTN","PSBODL",61,0)
 ..S:PSBSCHT="" PSBSCHT="*"
"RTN","PSBODL",62,0)
 ..S PSBMED=$P(^TMP("PSJ",$J,PSBINDX,3),U,2)
"RTN","PSBODL",63,0)
 ..S PSBORD=$P(^TMP("PSJ",$J,PSBINDX,0),U,3)
"RTN","PSBODL",64,0)
 ..S ^TMP("PSB",$J,"B",PSBTYPE,PSBSCHT,PSBMED,PSBORD)=""
"RTN","PSBODL",65,0)
 .I '$D(^TMP("PSB",$J,"B")) W !!?10,"** NO SPECIFIED MEDICATIONS TO PRINT **",!,$$BLANKS(),$$FTR^PSBODL1() Q
"RTN","PSBODL",66,0)
 .S PSBGBL=$NAME(^TMP("PSB",$J,"B")),PSBWFLAG=0
"RTN","PSBODL",67,0)
 .F  S PSBGBL=$Q(@PSBGBL) Q:PSBGBL=""  Q:($QS(PSBGBL,1)'="PSB")!($QS(PSBGBL,2)'=$J)!($QS(PSBGBL,3)'="B")  D
"RTN","PSBODL",68,0)
 ..K PSBORD,PSBFUTRO
"RTN","PSBODL",69,0)
 ..S PSBTYPE=$QS(PSBGBL,4)
"RTN","PSBODL",70,0)
 ..S PSBSCHT=$QS(PSBGBL,5)
"RTN","PSBODL",71,0)
 ..S PSBMED=$QS(PSBGBL,6)
"RTN","PSBODL",72,0)
 ..S PSBORD=$QS(PSBGBL,7)
"RTN","PSBODL",73,0)
 ..D CLEAN^PSBVT
"RTN","PSBODL",74,0)
 ..D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL",75,0)
 ..D NOW^%DTC S PSBNOW=%
"RTN","PSBODL",76,0)
 ..Q:PSBOSP<PSBOSTRT
"RTN","PSBODL",77,0)
 ..Q:(PSBOSP<PSBOSTRT)&(PSBSCHT'="O")
"RTN","PSBODL",78,0)
 ..S (PSBYES,PSBODD,PSBDAYB,PSBSCBR)=0
"RTN","PSBODL",79,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1,PSBDAYB=1
"RTN","PSBODL",80,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBSCBR=1
"RTN","PSBODL",81,0)
 ..I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBODL",82,0)
 ...D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBODL",83,0)
 ..I PSBSCHT="OC" S PSBYES=1
"RTN","PSBODL",84,0)
 ..I PSBSCHT="P" S PSBYES=1
"RTN","PSBODL",85,0)
 ..I "PCS"'[PSBIVT S PSBYES=1
"RTN","PSBODL",86,0)
 ..I PSBIVT["S",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",87,0)
 ..I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 S PSBYES=1
"RTN","PSBODL",88,0)
 ..I PSBIVT["C",PSBCHEMT="A" S PSBYES=1
"RTN","PSBODL",89,0)
 ..I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL",90,0)
 ..I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBODL",91,0)
 ..I PSBSCHT="P" S PSBFREQ=1440
"RTN","PSBODL",92,0)
 ..I PSBSCHT="O" S PSBFREQ=1440
"RTN","PSBODL",93,0)
 ..I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBODL",94,0)
 ..S PSBVALB=$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBODL",95,0)
 ..I 'PSBDAYB,'PSBSCBR,PSBSCHT="C",PSBVALB="1",PSBADST'="",PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBODL",96,0)
 ..I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL",97,0)
 ..I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBODL",98,0)
 ..I PSBADST'="" D
"RTN","PSBODL",99,0)
 ...F PSBY=1:1:$L(PSBADST,"-")  D
"RTN","PSBODL",100,0)
 ....D:($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N)
"RTN","PSBODL",101,0)
 .....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBODL",102,0)
 ..I PSBSCHT="C",PSBOTYP="U" Q:'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ,)
"RTN","PSBODL",103,0)
 ..I PSBSCHT="C",$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH),'$$OKAY^PSBVDLU1(PSBOST,PSBODATE,PSBSCH,PSBONX,PSBOITX,PSBFREQ) Q
"RTN","PSBODL",104,0)
 ..I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBODL",105,0)
 ...S (PSBGVN,X,Y)=""
"RTN","PSBODL",106,0)
 ...F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",107,0)
 ....F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",108,0)
 .....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",109,0)
 ..S PSBRMN=1
"RTN","PSBODL",110,0)
 ..I PSBSCHT="O",PSBOST'=PSBOSP,PSBOSP<PSBOSTRT S PSBRMN=0
"RTN","PSBODL",111,0)
 ..Q:'PSBRMN
"RTN","PSBODL",112,0)
 ..I PSBOST>$$FMADD^XLFDT(PSBNOW,"","",+($$GET^XPAR("DIV","PSB ADMIN BEFORE"))) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE)="" Q
"RTN","PSBODL",113,0)
 ..I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBODL",114,0)
 ...S (PSBGVN,X,Y)=""
"RTN","PSBODL",115,0)
 ...F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBODL",116,0)
 ....F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBODL",117,0)
 .....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBODL",118,0)
 ..S PSBLGDT="",X=""
"RTN","PSBODL",119,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL",120,0)
 ...S PSBIEN=""
"RTN","PSBODL",121,0)
 ...F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL",122,0)
 ....S:$P($G(^PSB(53.79,PSBIEN,0)),U,9)="G" PSBLGDT=X
"RTN","PSBODL",123,0)
 ..S PSBADMIN="" K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBODL",124,0)
 ..I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL",125,0)
 ...S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL",126,0)
 ...D:PSBX=""
"RTN","PSBODL",127,0)
 ....I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",128,0)
 ....I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",129,0)
 ....I PSBIVT="S",PSBISYR'=1 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL",130,0)
 ....I "HA"[PSBIVT S:PSBIVT]"" PSBX="0000",PSBFLAG=0
"RTN","PSBODL",131,0)
 ...I ((PSBIVT="S")!(PSBIVT="C")),(PSBISYR=1) S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",132,0)
 ...I (PSBIVT="C"),(PSBCHEMT="P") S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",133,0)
 ...I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL",134,0)
 ...I PSBIVT="P" S:+($G(PSBX))=0 PSBX=""
"RTN","PSBODL",135,0)
 ...I PSBX="" S:($G(PSBFREQ)>29)!(PSBFREQ="D") PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBODATE)
"RTN","PSBODL",136,0)
 ...E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL",137,0)
 ...D:PSBX'=""
"RTN","PSBODL",138,0)
 ....F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL",139,0)
 .....F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL",140,0)
 ......S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL",141,0)
 ......I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)
"RTN","PSBODL",142,0)
 ......D VAL^PSBMLVAL(.PSBZ,DFN,PSBON,PSBOTYP,PSBAT)
"RTN","PSBODL",143,0)
 ......I (PSBZ(0)<0)&(PSBCNT=1) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="" Q
"RTN","PSBODL",144,0)
 ......I (PSBAT'["."),($G(PSBORD)["V") I (PSBOST<PSBOSTOP),(PSBOST'<PSBOSTRT) S ^TMP("PSBO",$J,DFN,PSBORD,PSBTYPE,PSBAT)="" Q
"RTN","PSBODL",145,0)
 ......Q:+PSBZ(0)<0
"RTN","PSBODL",146,0)
 ......I $G(PSBOST)'>$G(PSBAT) S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",147,0)
 ......E  I ($P($G(PSBOST),".")'>$P($G(PSBAT),"."))&($P($G(PSBAT),".",2)="") S PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL",148,0)
 ...I +$G(PSBFREQ)>0,$G(PSBFREQ)<30,PSBADMIN'="0000" S PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL",149,0)
 ..I $Y>(IOSL-(12+($L(PSBADMIN)/27))) W !?(IOM-36\2),"(Medications Continued on Next Page)",$$FTR^PSBODL1(),$$HDR()
"RTN","PSBODL",150,0)
 ..I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL",151,0)
 ..E  S PSBSM=""
"RTN","PSBODL",152,0)
 ..W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL",153,0)
 ..S X="",Y=0
"RTN","PSBODL",154,0)
 ..D WRAPPUP^PSBODL1
"RTN","PSBODL",155,0)
 .I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL",156,0)
 .W $$BLANKS(),$$FTR^PSBODL1()
"RTN","PSBODL",157,0)
 .S PSBORD=$O(^TMP("PSBO",$J,DFN,""),-1)
"RTN","PSBODL",158,0)
 .I +$G(PSBORD)>0,$P(PSBRPT(.4),U,1),$D(^TMP("PSBO",$J,DFN,PSBORD)) D EN^PSBODL1
"RTN","PSBODL",159,0)
 Q
"RTN","PSBODL",160,0)
HDR() ;
"RTN","PSBODL",161,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBODL",162,0)
 W !,"Self",?85,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBODL",163,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBODL",164,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBODL",165,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",166,0)
 Q ""
"RTN","PSBODL",167,0)
BLANKS() ;
"RTN","PSBODL",168,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL",169,0)
 W !
"RTN","PSBODL",170,0)
 D:$Y>(IOSL-26)
"RTN","PSBODL",171,0)
 .W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)"
"RTN","PSBODL",172,0)
 .W $$FTR^PSBODL1(),$$HDR() ; New page - no room for blanks
"RTN","PSBODL",173,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL",174,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL",175,0)
 F X=1:1:4 D
"RTN","PSBODL",176,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",177,0)
 .W !!?3,"CON ___ PRN ___"
"RTN","PSBODL",178,0)
 .W ?20,"Drug: ",$TR($J("",22)," ","_")
"RTN","PSBODL",179,0)
 .W ?50,"Give: ",$TR($J("",42)," ","_")
"RTN","PSBODL",180,0)
 .W ?100,"Start: _________ Stop: _________"
"RTN","PSBODL",181,0)
 .W !?20,"Spec"
"RTN","PSBODL",182,0)
 .W !?3,"OT  ___ OC  ___"
"RTN","PSBODL",183,0)
 .W ?20,"Inst: ",$TR($J("",72)," ","_")
"RTN","PSBODL",184,0)
 .W ?100,"Initials: ______ Date: _________"
"RTN","PSBODL",185,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL",186,0)
 Q ""
"RTN","PSBODL1")
0^26^B38589946^B27682091
"RTN","PSBODL1",1,0)
PSBODL1 ;BIRMINGHAM/VRN-DUE LIST ;Mar 2004
"RTN","PSBODL1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,9,32**;Mar 2004;Build 32
"RTN","PSBODL1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified. 
"RTN","PSBODL1",4,0)
 ;
"RTN","PSBODL1",5,0)
 ; Reference/IA
"RTN","PSBODL1",6,0)
 ; ^XLFDT/10103
"RTN","PSBODL1",7,0)
EN ;
"RTN","PSBODL1",8,0)
 S PSBFOHDR=0
"RTN","PSBODL1",9,0)
 S PSBORD=0 F  S PSBORD=$O(^TMP("PSBO",$J,DFN,PSBORD)) Q:PSBORD=""  S PSBTYPE=$O(^TMP("PSBO",$J,DFN,PSBORD,"")) D
"RTN","PSBODL1",10,0)
 .D CLEAN^PSBVT
"RTN","PSBODL1",11,0)
 .D PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBODL1",12,0)
 .I PSBSCHT="C" D  Q:PSBADMIN=""
"RTN","PSBODL1",13,0)
 ..S PSBX=PSBADST,PSBFLAG=1
"RTN","PSBODL1",14,0)
 ..I PSBX="",PSBONX["V",PSBIVT'="P" S PSBFLAG=0
"RTN","PSBODL1",15,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBODL1",16,0)
 ..S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBODL1",17,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBODL1",18,0)
 ..I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P"  Q
"RTN","PSBODL1",19,0)
 ..I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBODL1",20,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBODL1",21,0)
 ..I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBODL1",22,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBODL1",23,0)
 ..D:PSBX=""
"RTN","PSBODL1",24,0)
 ...I PSBIVT="C",PSBCHEMT="A" S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",25,0)
 ...I PSBIVT="C",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",26,0)
 ...I PSBIVT="S",PSBISYR=0 S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",27,0)
 ...I "HA"[PSBIVT S PSBX="0000",PSBFLAG=0
"RTN","PSBODL1",28,0)
 ..I ("SC"[PSBIVT),(PSBISYR=1) S PSBX=""
"RTN","PSBODL1",29,0)
 ..I (PSBIVT="C"),(PSBCHEMT="P") S PSBX=""
"RTN","PSBODL1",30,0)
 ..I PSBOTYP="U",PSBX="0000" S PSBX=""
"RTN","PSBODL1",31,0)
 ..I PSBIVT="P",$G(PSBX)=0 S PSBX=""
"RTN","PSBODL1",32,0)
 ..I PSBX="" S PSBX=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBEVDT)
"RTN","PSBODL1",33,0)
 ..E  K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=PSBX
"RTN","PSBODL1",34,0)
 ..S PSBADMIN=""
"RTN","PSBODL1",35,0)
 ..F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBX=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBODL1",36,0)
 ...F PSBY=1:1:$L(PSBX,"-")  D
"RTN","PSBODL1",37,0)
 ....Q:($P(PSBX,"-",PSBY)'?2N)&($P(PSBX,"-",PSBY)'?4N)
"RTN","PSBODL1",38,0)
 ....S PSBAT=+(PSBODATE_"."_$P(PSBX,"-",PSBY))
"RTN","PSBODL1",39,0)
 ....I PSBFLAG Q:PSBAT<PSBOSTRT!(PSBAT>PSBOSTOP)  ; Report Window
"RTN","PSBODL1",40,0)
 ....D VAL^PSBMLVAL(.PSBZ,DFN,PSBONX,PSBTYPE,PSBAT)
"RTN","PSBODL1",41,0)
 ....S:$G(PSBFREQ)>29 PSBADMIN=PSBADMIN_$S(PSBADMIN]"":"-",1:"")_$P(PSBX,"-",PSBY)
"RTN","PSBODL1",42,0)
 ....S:$G(PSBFREQ)<30 PSBADMIN="Due every "_$G(PSBFREQ)_" minutes."
"RTN","PSBODL1",43,0)
 .I PSBSCHT'="C" S PSBADMIN=PSBADST
"RTN","PSBODL1",44,0)
 .; Get LAST GIVEN date/time
"RTN","PSBODL1",45,0)
 .S PSBLGDT="",X=""
"RTN","PSBODL1",46,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X),-1) Q:'X  D  Q:PSBLGDT
"RTN","PSBODL1",47,0)
 ..S PSBIEN=""
"RTN","PSBODL1",48,0)
 ..F  S PSBIEN=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,X,PSBIEN),-1) Q:PSBIEN=""  D  Q:PSBLGDT
"RTN","PSBODL1",49,0)
 ...S:"MHNR"'[$P($G(^PSB(53.79,PSBIEN,0)),U,9) PSBLGDT=X
"RTN","PSBODL1",50,0)
 .I $Y>(IOSL-12) I $Y<(IOSL-4) W !?(IOM-36\2),"(Medications Continued on Next Page)",$$FTR(),$$HDR()
"RTN","PSBODL1",51,0)
 .I PSBSM S PSBSM=$S(PSBSMX:"H",1:"")_"SM"
"RTN","PSBODL1",52,0)
 .E  S PSBSM=""
"RTN","PSBODL1",53,0)
 .I 'PSBFOHDR S PSBFOHDR=1 W $$HDR()
"RTN","PSBODL1",54,0)
 .W !,$J(PSBSM,3),?6,PSBTYPE,$E(PSBSCHT,1,4),?12 S PSBWFLAG=1
"RTN","PSBODL1",55,0)
 .S X="",Y=0
"RTN","PSBODL1",56,0)
 .W $$WRAP(14,34,PSBOITX)
"RTN","PSBODL1",57,0)
 .S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL1",58,0)
 .W $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",59,0)
 .W $$WRAP(78,6,PSBMR)
"RTN","PSBODL1",60,0)
 .W ?85 I PSBLGDT W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3) W "@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL1",61,0)
 .W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," ")
"RTN","PSBODL1",62,0)
 .W ?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," ")
"RTN","PSBODL1",63,0)
 .W ?120,$S(PSBVPHI]"":PSBVPHI,1:"***"),"/",$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBODL1",64,0)
 .W !,?100,"@"_$P(PSBOSTX,"  ",2),?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL1",65,0)
 .W IOINHI  ; To Highlight the Dispense Drugs...
"RTN","PSBODL1",66,0)
 .I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL1",67,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL1",68,0)
 ..W !?14,"*",$$WRAP(15,33,$P(PSBDDA(Y),U,3)_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL1",69,0)
 .I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBADA(Y),U,3)_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL1",70,0)
 .I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBSOLA(Y),U,3)_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL1",71,0)
 .W IOINORM ; Highlight Off
"RTN","PSBODL1",72,0)
 .S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL1",73,0)
 .W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",74,0)
 .S X=$S(PSBOTXT]"":PSBOTXT,1:"<None Entered>")
"RTN","PSBODL1",75,0)
 .I $E(X,1)="!"  S $E(X,1)=""
"RTN","PSBODL1",76,0)
 .W $$WRAP(14,34,"Spec Inst: "_X),!,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",77,0)
 I '$G(PSBWFLAG) W !!,?10,"** NO SPECIFIED MEDICATIONS TO PRINT **"
"RTN","PSBODL1",78,0)
 W:PSBFOHDR $$BLANKS(),$$FTR()
"RTN","PSBODL1",79,0)
 Q
"RTN","PSBODL1",80,0)
 ;
"RTN","PSBODL1",81,0)
WRAPPUP ;Do wrapping per PSBODL (Due List Report)
"RTN","PSBODL1",82,0)
 ;
"RTN","PSBODL1",83,0)
 W $$WRAP(14,34,PSBMED)
"RTN","PSBODL1",84,0)
 S PSBADM="Give: "_PSBDOSE_"  "_PSBSCH
"RTN","PSBODL1",85,0)
 W $$WRAP(50,27,PSBADM),?78,$$WRAP(78,6,PSBMR)
"RTN","PSBODL1",86,0)
 W ?85 D:PSBLGDT
"RTN","PSBODL1",87,0)
 .W $E(PSBLGDT,4,5),"/",$E(PSBLGDT,6,7),"/",$E(PSBLGDT,2,3),"@",$E($P(PSBLGDT,".",2)_"0000",1,4)
"RTN","PSBODL1",88,0)
 W ?100,$P($TR($$FMTE^XLFDT(PSBOST,2),"@"," ")," "),?110,$P($TR($$FMTE^XLFDT(PSBOSP,2),"@"," ")," "),?120,$S(PSBVPHI]"":PSBVPHI,1:"***"),"/"
"RTN","PSBODL1",89,0)
 W $S(PSBVNI]"":PSBVNI,1:"***"),!,?100,"@"_$P(PSBOSTX,"  ",2),?110,"@"_$P(PSBOSPX,"  ",2)
"RTN","PSBODL1",90,0)
 W IOINHI
"RTN","PSBODL1",91,0)
 I $D(PSBDDA) S Y=0 F  S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBODL1",92,0)
 .Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<PSBNOW)
"RTN","PSBODL1",93,0)
 .W !?14,"*",$$WRAP(15,33,$P(PSBDDA(Y),U,3)_" ("_+$P(PSBDDA(Y),U,2)_")")
"RTN","PSBODL1",94,0)
 I $D(PSBADA) S Y=0 F  S Y=$O(PSBADA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBADA(Y),U,3)_" ("_$P(PSBADA(Y),U,4)_")")
"RTN","PSBODL1",95,0)
 I $D(PSBSOLA) S Y=0 F  S Y=$O(PSBSOLA(Y)) Q:'Y  W !?14,"*",$$WRAP(15,33,$P(PSBSOLA(Y),U,3)_" ("_$P(PSBSOLA(Y),U,4)_")")
"RTN","PSBODL1",96,0)
 W IOINORM ; Hlight Off
"RTN","PSBODL1",97,0)
 S PSBADM=$S(PSBADMIN]"":"Admin Times: "_PSBADMIN,1:"")
"RTN","PSBODL1",98,0)
 W:PSBADM]"" $$WRAP(50,27,PSBADM)
"RTN","PSBODL1",99,0)
 S X=$S(PSBOTXT]"":PSBOTXT,1:"<None Entered>")
"RTN","PSBODL1",100,0)
 I $E(X,1)="!"  S $E(X,1)=""
"RTN","PSBODL1",101,0)
 W $$WRAP(14,34,"Spec Inst: "_X),!,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",102,0)
 Q
"RTN","PSBODL1",103,0)
 ;
"RTN","PSBODL1",104,0)
WRAP(X,Y,Z) ; Quick text wrap
"RTN","PSBODL1",105,0)
 F  Q:'$L(Z)  D
"RTN","PSBODL1",106,0)
 .W:$X>X !
"RTN","PSBODL1",107,0)
 .W:$X<X ?X
"RTN","PSBODL1",108,0)
 .I $L(Z)<Y W Z S Z="" Q
"RTN","PSBODL1",109,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBODL1",110,0)
 .S:PSB<1 PSB=Y
"RTN","PSBODL1",111,0)
 .W $E(Z,1,PSB)
"RTN","PSBODL1",112,0)
 .S Z=$E(Z,PSB+1,255)
"RTN","PSBODL1",113,0)
 Q ""
"RTN","PSBODL1",114,0)
 ;
"RTN","PSBODL1",115,0)
FTR() ; [Extrinsic] Page footer
"RTN","PSBODL1",116,0)
 ;
"RTN","PSBODL1",117,0)
 ; Sub Module Description:
"RTN","PSBODL1",118,0)
 ; (No Description Available)
"RTN","PSBODL1",119,0)
 ;
"RTN","PSBODL1",120,0)
 I (IOSL<100) F  Q:$Y>(IOSL-10)  W !
"RTN","PSBODL1",121,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBODL1",122,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBODL1",123,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBODL1",124,0)
 Q ""
"RTN","PSBODL1",125,0)
 ;
"RTN","PSBODL1",126,0)
HDR() ; Page Header
"RTN","PSBODL1",127,0)
 Q:'PSBFOHDR ""
"RTN","PSBODL1",128,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBODL1",129,0)
 W !
"RTN","PSBODL1",130,0)
 W !
"RTN","PSBODL1",131,0)
 W !,?(IOM-28\2),"*****   FUTURE ORDERS   *****"
"RTN","PSBODL1",132,0)
 W !
"RTN","PSBODL1",133,0)
 W !,"Self",?85,"Last",?100,"Start",?110,"Stop",?120,"Verifying"
"RTN","PSBODL1",134,0)
 W !,"Med",?6,"Sched",?14,"Medication",?50,"Dose",?78,"Route",?85,"Given",?100,"Date",?110,"Date",?120,"Rph/Rn"
"RTN","PSBODL1",135,0)
 W !,?100,"@Time",?110,"@Time"
"RTN","PSBODL1",136,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",137,0)
 Q ""
"RTN","PSBODL1",138,0)
 ;
"RTN","PSBODL1",139,0)
BLANKS() ; [Extrinsic] Print blanks at end of printout for changes
"RTN","PSBODL1",140,0)
 Q:'$P(PSBRPT(.2),U,5) ""
"RTN","PSBODL1",141,0)
 W !
"RTN","PSBODL1",142,0)
 I $Y>(IOSL-26) W ?(IOM-42\2),"(Changes/Addendums to Orders on Next Page)" W $$FTR(),$$HDR() ; Not enough space - new page
"RTN","PSBODL1",143,0)
 I IOSL<100 F  Q:$Y>(IOSL-26)  W !
"RTN","PSBODL1",144,0)
 W ?(IOM-28\2),"Changes/Addendums to orders"
"RTN","PSBODL1",145,0)
 F X=1:1:4 D
"RTN","PSBODL1",146,0)
 .W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",147,0)
 .W !!?3,"CON ___ PRN ___",?20,"Drug: ",$TR($J("",22)," ","_"),?50,"Give: ",$TR($J("",42)," ","_"),?100,"Start: _________ Stop: _________"
"RTN","PSBODL1",148,0)
 .W !?20,"Spec"
"RTN","PSBODL1",149,0)
 .W !?3,"OT  ___ OC  ___",?20,"Inst: ",$TR($J("",72)," ","_"),?100,"Initials: ______ Date: _________"
"RTN","PSBODL1",150,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBODL1",151,0)
 Q ""
"RTN","PSBODL1",152,0)
 ;
"RTN","PSBOIV")
0^15^B78135572^n/a
"RTN","PSBOIV",1,0)
PSBOIV ;BIRMINGHAM/TEJ-IV BAG STATUS REPORT ;Mar 2004
"RTN","PSBOIV",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOIV",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOIV",4,0)
 ;
"RTN","PSBOIV",5,0)
 ; Reference/IA
"RTN","PSBOIV",6,0)
 ; File 52.6/436
"RTN","PSBOIV",7,0)
 ; File 52.7/437
"RTN","PSBOIV",8,0)
 ; File 4/10090
"RTN","PSBOIV",9,0)
 ; File 2/10035 
"RTN","PSBOIV",10,0)
EN ; Entry
"RTN","PSBOIV",11,0)
 N PSB1,PSBFUTR
"RTN","PSBOIV",12,0)
 K PSBSRTBY,PSBOCRIT,PSBACRIT,NO S PSBCFLG=0
"RTN","PSBOIV",13,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOIV",14,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOIV",15,0)
 S PSBDTST=+$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOIV",16,0)
 S PSBDTSP=+$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOIV",17,0)
 S PSBOCRIT=""        ;  Ord Sttus "A"ctive, "D"C ed, "E"xprd"
"RTN","PSBOIV",18,0)
 S:$P(PSBFUTR,U,5) PSBOCRIT=PSBOCRIT_"A"
"RTN","PSBOIV",19,0)
 S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"D"
"RTN","PSBOIV",20,0)
 S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"E"
"RTN","PSBOIV",21,0)
 S PSBACRIT=""        ;  Actn Sttus "C"ompl, "I"nfusi, "M"issng, "S"tpped, "H"ld, "R"efsd", "N"o Actn
"RTN","PSBOIV",22,0)
 S:$P(PSBFUTR,U,12) PSBACRIT=PSBACRIT_"I"
"RTN","PSBOIV",23,0)
 S:$P(PSBFUTR,U,13) PSBACRIT=PSBACRIT_"S"
"RTN","PSBOIV",24,0)
 S:$P(PSBFUTR,U,14) PSBACRIT=PSBACRIT_"C"
"RTN","PSBOIV",25,0)
 S:$P(PSBFUTR,U,15) PSBACRIT=PSBACRIT_"N"
"RTN","PSBOIV",26,0)
 S:$P(PSBFUTR,U,16) PSBACRIT=PSBACRIT_"M"
"RTN","PSBOIV",27,0)
 S:$P(PSBFUTR,U,17) PSBACRIT=PSBACRIT_"H"
"RTN","PSBOIV",28,0)
 S:$P(PSBFUTR,U,18) PSBACRIT=PSBACRIT_"R"
"RTN","PSBOIV",29,0)
 D NOW^%DTC S (Y,PSBXNOW)=% D DD^%DT S:PSBDTSP=0 PSBDTSP=Y S PSBDTTM=Y
"RTN","PSBOIV",30,0)
 I +PSBDTST=0 S PSBDTST=X S PSBDTST=$$FMADD^XLFDT(PSBDTST,-3)_".0000"
"RTN","PSBOIV",31,0)
 S (PSBPGNUM,PSBLNTOT,PSBTOT,PSB1)=""
"RTN","PSBOIV",32,0)
 K PSBLIST,PSBLIST2,PSBBGS,PSBNOX
"RTN","PSBOIV",33,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOIV",34,0)
 S PSBLIST(PSBXDFN)=""
"RTN","PSBOIV",35,0)
 S PSB1=$O(PSBLIST("")) I +PSB1'=0  K ^TMP("PSJ",$J) D EN^PSJBCMA(PSB1,PSBDTST,PSBDTST)
"RTN","PSBOIV",36,0)
 I ^TMP("PSJ",$J,1,0)'=-1 D
"RTN","PSBOIV",37,0)
 .S PINX=0 F  S PINX=$O(^TMP("PSJ",$J,PINX)) Q:+PINX'>0  D
"RTN","PSBOIV",38,0)
 ..S PSB2=$P(^TMP("PSJ",$J,PINX,0),U,3)
"RTN","PSBOIV",39,0)
 ..I PSB2["V" D  Q
"RTN","PSBOIV",40,0)
 ...; flter critri
"RTN","PSBOIV",41,0)
 ...D CLEAN^PSBVT,PSJ1^PSBVT(PSB1,PSB2)
"RTN","PSBOIV",42,0)
 ...Q:$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,$G(PSBIVPSH,0))
"RTN","PSBOIV",43,0)
 ...Q:PSBOST>PSBDTSP
"RTN","PSBOIV",44,0)
 ...I "DE"'[PSBOSTS I PSBOSP'>PSBXNOW S PSBOSTS="E"
"RTN","PSBOIV",45,0)
 ...Q:PSBOCRIT'[PSBOSTS  ;incl ord stat crit
"RTN","PSBOIV",46,0)
 ...Q:(PSBOSP<PSBXNOW)&(PSBOCRIT'["E")&(PSBOSTS'="D")
"RTN","PSBOIV",47,0)
 ...S PSBLIST2(PSB2,"OStart")=PSBOST
"RTN","PSBOIV",48,0)
 ...S PSBLIST2(PSB2,"OStop")=PSBOSP
"RTN","PSBOIV",49,0)
 ...S PSBLIST2(PSB2,"OStatus")=$S((PSBOSTS="D"):"Discontinued",(PSBOSTS="DE"):"Discontinued (Edit)",PSBXNOW>PSBOSP:"Expired",PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",1:PSBOSTS)
"RTN","PSBOIV",50,0)
 ...S PSBLIST2(PSB2,"OPI")=PSBOTXT
"RTN","PSBOIV",51,0)
 ...M PSBLIST2(PSB2,"ADD")=PSBADA
"RTN","PSBOIV",52,0)
 ...M PSBLIST2(PSB2,"SOL")=PSBSOLA
"RTN","PSBOIV",53,0)
 ...D EN^PSBPOIV(PSB1,PSB2)
"RTN","PSBOIV",54,0)
 ...I +$O(^TMP("PSBAR",$J,""))>0 S X="" F  S X=$O(^TMP("PSBAR",$J,X)) Q:+X=0  S PSBBGS(PSB2,X)=$P(^TMP("PSBAR",$J,X),U,2)
"RTN","PSBOIV",55,0)
 ...D:PSBACRIT["N"
"RTN","PSBOIV",56,0)
 ....S NO=1
"RTN","PSBOIV",57,0)
 ....I $D(PSBBGS(PSB2))  S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I PSBBGS(PSB2,X)'="" S NO=0 Q
"RTN","PSBOIV",58,0)
 ....I $D(^PSB(53.79,"AORDX",PSB1,PSB2)) S NO=0 Q
"RTN","PSBOIV",59,0)
 ...I $G(NO,0) I PSBOSTS="A" S PSBNOX(PSB2)="",PSBTOT=PSBTOT+1 Q
"RTN","PSBOIV",60,0)
 ...I $D(^PSB(53.79,"AUID",PSB1,PSB2)) M PSBBGS(PSB2)=^PSB(53.79,"AUID",PSB1,PSB2)
"RTN","PSBOIV",61,0)
 ...; Get X - "ASSOC BAGS"
"RTN","PSBOIV",62,0)
 ...S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I $G(PSBBGS(PSB2,X),"")'=""  D
"RTN","PSBOIV",63,0)
 ....S Y="" F  S Y=$O(^PSB(53.79,"AUID",PSB1,Y)) Q:Y=""  D  Q:Y="DONE"
"RTN","PSBOIV",64,0)
 .....I $D(^PSB(53.79,"AUID",PSB1,Y,X)) S PSBBGS(PSB2,X,$O(^PSB(53.79,"AUID",PSB1,Y,X,"")))="" S Y="DONE"
"RTN","PSBOIV",65,0)
 ...S X="" F  S X=$O(PSBBGS(PSB2,X)) Q:+X=0  I $O(PSBBGS(PSB2,X,""))="" K PSBBGS(PSB2,X)
"RTN","PSBOIV",66,0)
 ...S PSB3="" F  S PSB3=$O(PSBBGS(PSB2,PSB3)) Q:PSB3=""  D
"RTN","PSBOIV",67,0)
 ....S PSB4="" F  S PSB4=$O(PSBBGS(PSB2,PSB3,PSB4)) Q:+PSB4=0  D
"RTN","PSBOIV",68,0)
 .....I ($$GET1^DIQ(53.79,PSB4_",",.06,"I")'>PSBDTST)!($$GET1^DIQ(53.79,PSB4_",",.06,"I")'<PSBDTSP) K PSBBGS(PSB2,PSB3) Q
"RTN","PSBOIV",69,0)
 .....I PSBACRIT'[$$GET1^DIQ(53.79,PSB4_",",.09,"I") K PSBBGS(PSB2,PSB3) Q
"RTN","PSBOIV",70,0)
 .....S PSBBSTS(PSB2,PSB3,$$GET1^DIQ(53.79,PSB4_",",.09))=$$GET1^DIQ(53.79,PSB4_",",.06,"I"),PSBTOT=PSBTOT+1
"RTN","PSBOIV",71,0)
 .....I "SI"[$$GET1^DIQ(53.79,PSB4_",",.09,"I") I PSBXNOW>$$FMADD^XLFDT($$GET1^DIQ(53.79,PSB4_",",.06,"I"),,24) S PSB24HR(PSB2,PSB3)=""
"RTN","PSBOIV",72,0)
 .....I PSBCFLG S PSB5=0 F  S PSB5=$O(^PSB(53.79,PSB4,.3,PSB5)) Q:+PSB5=0  D
"RTN","PSBOIV",73,0)
 ......I $P(^PSB(53.79,PSB4,.3,PSB5,0),U,3)=$$GET1^DIQ(53.79,PSB4_",",.06,"I") S PSBCMNT(PSB2,PSB3)="Comment: "_$P(^PSB(53.79,PSB4,.3,PSB5,0),U)
"RTN","PSBOIV",74,0)
 S INX="" F  S INX=$O(PSBLIST2(INX)) Q:INX=""  I '$D(PSBBGS(INX))&'$D(PSBNOX(INX)) K PSBLIST2(INX)
"RTN","PSBOIV",75,0)
 I +PSBTOT=0 K PSBLIST
"RTN","PSBOIV",76,0)
 S Y=PSBDTST D DD^%DT S Y1=Y S Y=PSBDTSP D DD^%DT S Y2=Y
"RTN","PSBOIV",77,0)
 D CREATHDR
"RTN","PSBOIV",78,0)
 D SUBHDR^PSBOIV1
"RTN","PSBOIV",79,0)
 D BLDRPT
"RTN","PSBOIV",80,0)
 D WRTRPT
"RTN","PSBOIV",81,0)
 K PSBSILN,PSBOUTP,PSBLIST2,PSBCMNT,PSBNOX
"RTN","PSBOIV",82,0)
 Q
"RTN","PSBOIV",83,0)
BLDRPT ; Buld Reprt
"RTN","PSBOIV",84,0)
 S (PSB2,PSB3,PSB4)=""
"RTN","PSBOIV",85,0)
 S PSBTOPHD=PSBLNTOT
"RTN","PSBOIV",86,0)
 I '$D(PSBLIST2) D  Q
"RTN","PSBOIV",87,0)
 .S PSBOUTP(0,14)="W !!,""<<<< NO DATA TO DISPLAY >>>>"",!!"
"RTN","PSBOIV",88,0)
 S PSBTOT1=0
"RTN","PSBOIV",89,0)
 K PSBDATA
"RTN","PSBOIV",90,0)
 K J S J=1
"RTN","PSBOIV",91,0)
 F  S PSB2=$O(PSBLIST2(PSB2)) Q:+PSB2=0  D
"RTN","PSBOIV",92,0)
 .S PSBORDX="" S PSBORDX=PSB2
"RTN","PSBOIV",93,0)
 .S PSBDATA(1)=$$FMTDT^PSBOIV1($E(PSBLIST2(PSB2,"OStart"),1,12))
"RTN","PSBOIV",94,0)
 .S PSBDATA(2)=$$FMTDT^PSBOIV1($E(PSBLIST2(PSB2,"OStop"),1,12))
"RTN","PSBOIV",95,0)
 .S PSBDATA(3)=PSBLIST2(PSB2,"OStatus")
"RTN","PSBOIV",96,0)
 .M PSBDATA(4,"ADD")=PSBLIST2(PSB2,"ADD") I $D(PSBDATA(4,"ADD",1)) S PSBDATA(4)="MED"
"RTN","PSBOIV",97,0)
 .M PSBDATA(4,"SOL")=PSBLIST2(PSB2,"SOL") I $D(PSBDATA(4,"SOL",1)) S PSBDATA(4)="MED"
"RTN","PSBOIV",98,0)
 .; Bag(s)
"RTN","PSBOIV",99,0)
 .I $D(PSBNOX(PSB2)) S PSBFLGD(PSB2," * No Action Taken On Order * ")=""
"RTN","PSBOIV",100,0)
 .I '$D(PSBNOX(PSB2))!(PSBACRIT["N")  F  S PSB3=$O(PSBBGS(PSB2,PSB3)) Q:+PSB3=0  D
"RTN","PSBOIV",101,0)
 ..S PSBDATA(5,PSB3)=PSB3
"RTN","PSBOIV",102,0)
 ..S PSBDATA(6,PSB3)=$O(PSBBSTS(PSB2,PSB3,""))
"RTN","PSBOIV",103,0)
 ..I $D(PSB24HR(PSB2,PSB3)) S PSBDATA(7,PSB3)=">24h"
"RTN","PSBOIV",104,0)
 ..I '$D(PSBNOX(PSB2)) S PSBDATA(8,PSB3)=$$FMTDT^PSBOIV1($E(PSBBSTS(PSB2,PSB3,PSBDATA(6,PSB3)),1,12))
"RTN","PSBOIV",105,0)
 ..E  S PSBDATA(8,PSB3)="No Action On Order"
"RTN","PSBOIV",106,0)
 .K PSBOPDAT S PSBOPDAT(1)=$G(PSBLIST2(PSB2,"OPI"),"")
"RTN","PSBOIV",107,0)
 .S PSBTOT1=PSBTOT1+1
"RTN","PSBOIV",108,0)
 .K PSBRPLN,PSBSILN
"RTN","PSBOIV",109,0)
 .D BUILDLN,SIOPI^PSBOCM(.PSBOPDAT,PSBTAB8,"Other Print Info:")
"RTN","PSBOIV",110,0)
 .I $D(PSBRPLN) S PSBMORE=$O(PSBRPLN(""),-1)+4 I $D(PSBSILN) S PSBMORE=PSBMORE+$O(PSBSILN(""),-1)
"RTN","PSBOIV",111,0)
 .S (PSB1,PSB)="" I $D(PSBFLGD(PSB2)) F  S PSB=$O(PSBFLGD(PSB2,PSB)) Q:PSB=""  I ($P(PSB,":")'="STAT") S PSB1=$G(PSB1,"")_PSB
"RTN","PSBOIV",112,0)
 .S PSBCNT=PSBTOT1_"  ("_PSB2_") "_PSB1,$E(PSBCNT,IOM)="|"
"RTN","PSBOIV",113,0)
 .S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBCNT_""""
"RTN","PSBOIV",114,0)
 .F N=$O(PSBRPLN("")):1:$O(PSBRPLN(""),-1)  D
"RTN","PSBOIV",115,0)
 ..S PSB1X=0 S PSB1X=(($L(PSBRPLN(N),"""")-1)\2) I ($E(PSBRPLN(N),(PSBTAB8)+PSB1X)']" ") S $E(PSBRPLN(N),(PSBTAB8)+PSB1X)="|"
"RTN","PSBOIV",116,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBRPLN(N)_""""
"RTN","PSBOIV",117,0)
 .K PSBRPLN,PSBDATA
"RTN","PSBOIV",118,0)
 .S I="" F  S I=$O(PSBSILN(I)) Q:+I=0  D
"RTN","PSBOIV",119,0)
 ..S PSB1X=0 S PSB1X=(($L(PSBSILN(I),"""")-1)\2)
"RTN","PSBOIV",120,0)
 ..I ($E(PSBSILN(I),(PSBTAB8)+PSB1X)']" ") S $E(PSBSILN(I),(PSBTAB8)+PSB1X)="|"
"RTN","PSBOIV",121,0)
 ..S PSBOUTP($$PGTOT,PSBLNTOT)="W !,"""_PSBSILN(I)_""""
"RTN","PSBOIV",122,0)
 .S PSBOUTP($$PGTOT(2),PSBLNTOT)="W !,$TR($J("""",PSBTAB8),"" "",""-""),!"
"RTN","PSBOIV",123,0)
 Q
"RTN","PSBOIV",124,0)
BUILDLN ; Constr recs
"RTN","PSBOIV",125,0)
 K J,LN S J(0)="" F PSBFLD=1:1:3 I $G(PSBDATA(PSBFLD))]"" S J=1 D FORMDAT^PSBOIV1(PSBFLD) S J=1
"RTN","PSBOIV",126,0)
 F X=1:1 Q:'$D(PSBDATA(4,"ADD",X))  D
"RTN","PSBOIV",127,0)
 .S PSBDATA(4)=$P(PSBDATA(4,"ADD",X),U,3)
"RTN","PSBOIV",128,0)
 .D FORMDAT^PSBOIV1(4)
"RTN","PSBOIV",129,0)
 .S J=$O(J(""),-1)+1
"RTN","PSBOIV",130,0)
 F X=1:1 Q:'$D(PSBDATA(4,"SOL",X))  D
"RTN","PSBOIV",131,0)
 .S PSBDATA(4)=$P(PSBDATA(4,"SOL",X),U,3)
"RTN","PSBOIV",132,0)
 .D FORMDAT^PSBOIV1(4)
"RTN","PSBOIV",133,0)
 .S J=$O(J(""),-1)+1
"RTN","PSBOIV",134,0)
 F PSBFLD=5:1:8 I $D(PSBDATA(PSBFLD)) K J S J=1 D
"RTN","PSBOIV",135,0)
 .S X="" F  S X=$O(PSBDATA(PSBFLD,X)) Q:+X=0  D
"RTN","PSBOIV",136,0)
 ..S PSBDATA(PSBFLD)=PSBDATA(PSBFLD,X)
"RTN","PSBOIV",137,0)
 ..I PSBFLD=5 S LN(X,J)=""
"RTN","PSBOIV",138,0)
 ..D:PSBFLD'=8 FORMDAT^PSBOIV1(PSBFLD)
"RTN","PSBOIV",139,0)
 ..S J=$O(J(""),-1)+1
"RTN","PSBOIV",140,0)
 ..I (PSBCFLG&(PSBFLD=5)),($D(PSBCMNT(PSB2,X))) D WRAPPER^PSBOIV1(PSBTAB4+1,(PSBTAB8-PSBTAB4)-1,PSBCMNT(PSB2,X)),WRAPPER^PSBOIV1(PSBTAB4+1,PSBTAB8-PSBTAB4," ")
"RTN","PSBOIV",141,0)
 .I PSBFLD=5 F J=1:1:$O(J(""),-1) S PREVLN(J)=$G(PSBRPLN(J),"")
"RTN","PSBOIV",142,0)
 .I PSBFLD'=5 I $D(PREVLN) S X="" F  S X=$O(LN(X)) Q:X=""  S J=$O(LN(X,"")) D:$D(PSBDATA(PSBFLD,X))
"RTN","PSBOIV",143,0)
 ..S $E(PREVLN(J),@("PSBTAB"_(PSBFLD-1))+1,@("PSBTAB"_(PSBFLD)))=PSBDATA(PSBFLD,X)
"RTN","PSBOIV",144,0)
 I $D(PREVLN) F J=1:1:$O(PREVLN(""),-1) S PSBRPLN(J)=PREVLN(J)
"RTN","PSBOIV",145,0)
 K PREVLN,LN
"RTN","PSBOIV",146,0)
 Q
"RTN","PSBOIV",147,0)
WRTRPT ;
"RTN","PSBOIV",148,0)
 I $O(PSBOUTP(""),-1)<1 D  Q
"RTN","PSBOIV",149,0)
 .X PSBOUTP($O(PSBOUTP(""),-1),14)
"RTN","PSBOIV",150,0)
 .D FTR
"RTN","PSBOIV",151,0)
 S PSBPGNUM=1
"RTN","PSBOIV",152,0)
 S PSBZ="" F  S PSBZ=$O(PSBOUTP(PSBZ)) Q:PSBZ=""  D
"RTN","PSBOIV",153,0)
 .I PSBPGNUM'=PSBZ D FTR S PSBPGNUM=PSBZ D HDR,SUBHDR^PSBOIV1
"RTN","PSBOIV",154,0)
 .S PSB2="" F  S PSB2=$O(PSBOUTP(PSBZ,PSB2)) Q:PSB2=""  D
"RTN","PSBOIV",155,0)
 ..X PSBOUTP(PSBZ,PSB2)
"RTN","PSBOIV",156,0)
 D FTR
"RTN","PSBOIV",157,0)
 Q
"RTN","PSBOIV",158,0)
HDR ;
"RTN","PSBOIV",159,0)
 W:$Y>1 @IOF
"RTN","PSBOIV",160,0)
 W:$X>1 !
"RTN","PSBOIV",161,0)
 S PSBRPNM="BCMA IV BAG STATUS REPORT"
"RTN","PSBOIV",162,0)
 S LN=0
"RTN","PSBOIV",163,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOIV",164,0)
 .S LN=LN+1,PSBHDR(LN)=PSBRPNM_" for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT($P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9))
"RTN","PSBOIV",165,0)
 .S LN=LN+1,PSBHDR(LN)="Order Status(es): --"
"RTN","PSBOIV",166,0)
 .F Y=5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(LN),": ",2)=$P(PSBHDR(LN),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("^^^^Active^^DC'd^Expired^^^^^^^^^^",U,Y)_" " S PSBHDR(LN)=$TR(PSBHDR(LN),"-","")
"RTN","PSBOIV",167,0)
 .S LN=LN+1,PSBHDR(LN)="Bag Status(es): --"
"RTN","PSBOIV",168,0)
 .F Y=12:1:18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(LN),": ",2)=$P(PSBHDR(LN),": ",2)_$S(PSBHDR(LN)["--":"",1:"/ ")_$P("^^^^^^^^^^^Infusing^Stopped^Completed^No Action Taken^Missing Dose^Held^Refused",U,Y)_" " S PSBHDR(LN)=$TR(PSBHDR(LN),"-","")
"RTN","PSBOIV",169,0)
 .I PSBCFLG S LN=LN+1,PSBHDR(LN)="Include Comments/Reasons"
"RTN","PSBOIV",170,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR) W !
"RTN","PSBOIV",171,0)
 Q
"RTN","PSBOIV",172,0)
FTR ;
"RTN","PSBOIV",173,0)
 I (IOSL<100) F  Q:$Y>(IOSL-5)  W !,?(IOM-1),"|"
"RTN","PSBOIV",174,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOIV",175,0)
 S PSBPGRM=PSBTAB8-($L(PSBPG))
"RTN","PSBOIV",176,0)
 D PTFTR^PSBOHDR()
"RTN","PSBOIV",177,0)
 W !,PSBRPNM,"     ",?(PSBPGRM-($L(PSBDTTM)+3)),PSBDTTM_"  "_PSBPG
"RTN","PSBOIV",178,0)
 Q
"RTN","PSBOIV",179,0)
PGTOT(X) ;mnt PAGE Number
"RTN","PSBOIV",180,0)
 I (PSBLNTOT+PSBMORE)>(IOSL) S PSBPGNUM=PSBPGNUM+1,PSBLNTOT=PSBTOPHD S PSBMORE=$S(PSBMORE>(IOSL-(PSBTOPHD)):(IOSL-(PSBTOPHD)),1:PSBMORE)
"RTN","PSBOIV",181,0)
 I $G(X,1) S PSBLNTOT=PSBLNTOT+$G(X,1),PSBMORE=PSBMORE-$G(X,1)
"RTN","PSBOIV",182,0)
 Q PSBPGNUM
"RTN","PSBOIV",183,0)
CREATHDR ;
"RTN","PSBOIV",184,0)
 K PSBHD1,PSBHD2
"RTN","PSBOIV",185,0)
 I IOM'<132 S PSBMORE=4,PSBHD1=$P($T(HD132A),";",2),PSBHD2=$P($T(HD132B),";",2),PSBBLANK=$P($T(H132BLK),";",2)
"RTN","PSBOIV",186,0)
 E  S PSBHD1="THIS REPORT SUPPORTS >131 CHAR./LINE PRINT FORMATS ONLY" K PSBLIST2 Q
"RTN","PSBOIV",187,0)
 ; reset tabs
"RTN","PSBOIV",188,0)
 S PSBTAB0=1 F PSBI=0:1:($L(PSBHD1,"|")-1) S:PSBI>0 @("PSBTAB"_PSBI)=($F(PSBHD1,"|",@("PSBTAB"_(PSBI-1))+1))-1
"RTN","PSBOIV",189,0)
 S PSBPGNUM=1
"RTN","PSBOIV",190,0)
 D HDR
"RTN","PSBOIV",191,0)
 Q
"RTN","PSBOIV",192,0)
HD132A ;     Order       |       Order       |    Order     |     Medication      |      Bag UID      |    Bag    |     | Action Date/Time |
"RTN","PSBOIV",193,0)
 Q
"RTN","PSBOIV",194,0)
HD132B ;   Start Date    |      Stop Date    |    Status    |                     |                   |   Status  |     |                  |
"RTN","PSBOIV",195,0)
 Q
"RTN","PSBOIV",196,0)
H132BLK ;;
"RTN","PSBOIV",197,0)
 Q
"RTN","PSBOIV1")
0^32^B3877524^n/a
"RTN","PSBOIV1",1,0)
PSBOIV1 ;BIRMINGHAM/TEJ-IV BAG STATUS REPORT ;Mar 2004
"RTN","PSBOIV1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOIV1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOIV1",4,0)
 ;
"RTN","PSBOIV1",5,0)
FORMDAT(FLD) ;
"RTN","PSBOIV1",6,0)
 K PSBVAL
"RTN","PSBOIV1",7,0)
 S PSBVAL=PSBDATA(FLD)
"RTN","PSBOIV1",8,0)
 D WRAPPER(@("PSBTAB"_(FLD-1))+1,((@("PSBTAB"_(FLD))-(@("PSBTAB"_(FLD-1))+1))),PSBVAL)
"RTN","PSBOIV1",9,0)
 Q
"RTN","PSBOIV1",10,0)
WRAPPER(X,Y,Z) ;  Text WRAP
"RTN","PSBOIV1",11,0)
 N PSB
"RTN","PSBOIV1",12,0)
 I ($L(Z)>0),$F(Z,"""")>1 F  Q:$F(Z,"""")'>1  S Z=$TR(Z,"""","^")
"RTN","PSBOIV1",13,0)
 F  Q:'$L(Z)  D
"RTN","PSBOIV1",14,0)
 .I $L(Z)<Y S $E(PSBRPLN(J),X)=Z S Z="" D  Q
"RTN","PSBOIV1",15,0)
 ..I $L(PSBRPLN(J),"^")>1 F INX=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",INX)=$P(PSBRPLN(J),"^",INX)_""""
"RTN","PSBOIV1",16,0)
 ..S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOIV1",17,0)
 ..S J(J)="",J=J+1
"RTN","PSBOIV1",18,0)
 .F PSB=Y:-1:0 Q:$E(Z,PSB)=" "
"RTN","PSBOIV1",19,0)
 .S:PSB<1 PSB=Y
"RTN","PSBOIV1",20,0)
 .S $E(PSBRPLN(J),X)=$E(Z,1,PSB)
"RTN","PSBOIV1",21,0)
 .S Z=$E(Z,PSB+1,250)
"RTN","PSBOIV1",22,0)
 .I $L(PSBRPLN(J),"^")>1 F INX=1:1:$L(PSBRPLN(J),"^")-1 S $P(PSBRPLN(J),"^",INX)=$P(PSBRPLN(J),"^",INX)_""""
"RTN","PSBOIV1",23,0)
 .S PSBRPLN(J)=$TR(PSBRPLN(J),"^","""")
"RTN","PSBOIV1",24,0)
 .S J(J)="",J=J+1
"RTN","PSBOIV1",25,0)
 Q 0
"RTN","PSBOIV1",26,0)
FMTDT(Y) ;
"RTN","PSBOIV1",27,0)
 N X S X=$E(Y,4,5) X ^DD("DD") S Y=$TR(Y," ,:","//") S $P(Y,"/")=X
"RTN","PSBOIV1",28,0)
 Q Y
"RTN","PSBOIV1",29,0)
SUBHDR ;
"RTN","PSBOIV1",30,0)
 N PSBAL S PSBAL=$O(PSBHDR("ALERGY",""),-1) S PSBAL=$S((PSBAL/12)>(PSBAL\12):(PSBAL\12)+1,1:(PSBAL\12))
"RTN","PSBOIV1",31,0)
 N PSBRE S PSBRE=$O(PSBHDR("REAC",""),-1) S PSBRE=$S((PSBRE/12)>(PSBRE\12):(PSBRE\12)+1,1:(PSBRE\12))
"RTN","PSBOIV1",32,0)
 S PSBLNTOT=$O(PSBHDR(""),-1)+9+PSBAL+PSBRE+1
"RTN","PSBOIV1",33,0)
 W !,$G(PSBHD1,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOIV1",34,0)
 W !,$G(PSBHD2,"") S PSBLNTOT=PSBLNTOT+1
"RTN","PSBOIV1",35,0)
 W !,$TR($J("",PSBTAB8)," ","="),! S PSBLNTOT=PSBLNTOT+2
"RTN","PSBOIV1",36,0)
 Q 
"RTN","PSBOMM")
0^3^B85940582^B50839011
"RTN","PSBOMM",1,0)
PSBOMM ;BIRMINGHAM/EFC-MISSED MEDS ;Mar 2004
"RTN","PSBOMM",2,0)
 ;;3.0;BAR CODE MED ADMIN;**26,32**;Mar 2004;Build 32
"RTN","PSBOMM",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOMM",4,0)
 ;
"RTN","PSBOMM",5,0)
 ; Reference/IA
"RTN","PSBOMM",6,0)
 ; ^DPT/10035
"RTN","PSBOMM",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMM",8,0)
 ; EN^PSJBCMA2/2830
"RTN","PSBOMM",9,0)
EN ;
"RTN","PSBOMM",10,0)
 N PSBSTRT,PSBSTOP,DFN,PSBODATE,PSBFLAG,PSBCNT,PSBEDIT,PSBFUTR
"RTN","PSBOMM",11,0)
 S PSBSTART=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7),PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMM",12,0)
 D DEFLT^PSBOMM2
"RTN","PSBOMM",13,0)
 K PSBOCRIT,PSBACRIT,PSBS
"RTN","PSBOMM",14,0)
 S PSBOCRIT="^A^H"
"RTN","PSBOMM",15,0)
 S:$P(PSBFUTR,U,8) PSBOCRIT=PSBOCRIT_"^D^DE" S:$P(PSBFUTR,U,7) PSBOCRIT=PSBOCRIT_"^E"
"RTN","PSBOMM",16,0)
 S PSBACRIT="MG"
"RTN","PSBOMM",17,0)
 S:$P(PSBFUTR,U,17) PSBACRIT=PSBACRIT_"H" S:$P(PSBFUTR,U,18) PSBACRIT=PSBACRIT_"R"
"RTN","PSBOMM",18,0)
 S PSBINCC=0 S:$P(PSBRPT(.2),U,8) PSBINCC=1
"RTN","PSBOMM",19,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSB1",$J)
"RTN","PSBOMM",20,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)-.0000001
"RTN","PSBOMM",21,0)
 F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,DFN)) Q:'DFN  D EN1
"RTN","PSBOMM",22,0)
 D PRINT
"RTN","PSBOMM",23,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J),^TMP("PSBO",$J),PSBS
"RTN","PSBOMM",24,0)
 Q
"RTN","PSBOMM",25,0)
EN1 ;
"RTN","PSBOMM",26,0)
 N PSBGBL,PSBHDR,PSBX,PSBDFN,PSBDT,PSBEVDT,PSBH
"RTN","PSBOMM",27,0)
 K ^TMP("PSJ",$J) S PSBEVDT=PSBSTRT
"RTN","PSBOMM",28,0)
 D EN^PSJBCMA(DFN,PSBSTRT)
"RTN","PSBOMM",29,0)
 Q:^TMP("PSJ",$J,1,0)=-1
"RTN","PSBOMM",30,0)
 S PSBX=""
"RTN","PSBOMM",31,0)
 F  S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:PSBX=""  D
"RTN","PSBOMM",32,0)
 .Q:^TMP("PSJ",$J,PSBX,0)=-1
"RTN","PSBOMM",33,0)
 .D NOW^%DTC
"RTN","PSBOMM",34,0)
 .D CLEAN^PSBVT
"RTN","PSBOMM",35,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBOMM",36,0)
 .Q:PSBIVT="A"
"RTN","PSBOMM",37,0)
 .Q:PSBIVT="H"
"RTN","PSBOMM",38,0)
 .I PSBIVT["S",PSBISYR'=1 Q
"RTN","PSBOMM",39,0)
 .I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOMM",40,0)
 .I PSBIVT["C",PSBCHEMT="A" Q
"RTN","PSBOMM",41,0)
 .Q:PSBONX["P"
"RTN","PSBOMM",42,0)
 .Q:PSBOSP<PSBSTART
"RTN","PSBOMM",43,0)
 .I %>PSBOSP,PSBOSTS'="D",PSBOSTS'="DE",PSBOSTS'="H" S PSBOSTS="E"
"RTN","PSBOMM",44,0)
 .I PSBSCHT="C" D  Q
"RTN","PSBOMM",45,0)
 ..S (PSBYES,PSBODD)=0
"RTN","PSBOMM",46,0)
 ..S PSBDOW="SU^MO^TU^WE^TH^FR^SA" F I=1:1:7 I $P(PSBDOW,"^",I)=$E(PSBSCH,1,2) S PSBYES=1
"RTN","PSBOMM",47,0)
 ..I PSBYES,PSBADST="" Q
"RTN","PSBOMM",48,0)
 ..F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOMM",49,0)
 ..S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOMM",50,0)
 ..I PSBFREQ="O" S PSBYES=1,PSBFREQ=1440
"RTN","PSBOMM",51,0)
 ..I 'PSBYES,PSBADST="",PSBFREQ<1 Q
"RTN","PSBOMM",52,0)
 ..I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOMM",53,0)
 ..I PSBODD,PSBADST'="" Q
"RTN","PSBOMM",54,0)
 ..Q:PSBOCRIT'[PSBOSTS
"RTN","PSBOMM",55,0)
 ..Q:PSBNGF
"RTN","PSBOMM",56,0)
 ..Q:PSBOSTS="N"
"RTN","PSBOMM",57,0)
 ..Q:PSBSM
"RTN","PSBOMM",58,0)
 ..S PSBS(DFN,PSBONX,$S(PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",PSBOSTS="D":"DC'd",PSBOSTS="DE":"DC'd (Edit)",PSBOSTS="E":"Expired",1:" *Unknown* "))=""
"RTN","PSBOMM",59,0)
 ..S PSBSTXP(PSBONX,$$DTFMT^PSBOMM2(PSBOSP))=""
"RTN","PSBOMM",60,0)
 ..S PSBCADM=0
"RTN","PSBOMM",61,0)
 ..I PSBADST="" D  Q:$G(PSBADST)=""  S PSBCADM=1
"RTN","PSBOMM",62,0)
 ...S X=PSBOST D H^%DTC S X1=((%H*24)*60)+(%T/60)
"RTN","PSBOMM",63,0)
 ...S X=PSBSTRT,X3=0 D H^%DTC S X2=((%H*24)*60)+(%T/60)
"RTN","PSBOMM",64,0)
 ...I X2'<X1 S X3=X2-X1 S PSBOST=$$FMADD^XLFDT(PSBSTRT,,,(-1*(X3#PSBFREQ)))
"RTN","PSBOMM",65,0)
 ...K PSBADST S PSBOST2=PSBOST,PSBDT2=PSBSTRT
"RTN","PSBOMM",66,0)
 ...F XZ=0:1 S PSBADST(XZ,PSBDT2)=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST2,PSBFREQ,PSBDT2) D  Q:PSBDT2>PSBSTOP
"RTN","PSBOMM",67,0)
 ....I ($L(PSBADST(XZ,PSBDT2),"-")>$L($G(PSBADST),"-"))!($G(PSBADST)="") S PSBADST=PSBADST(XZ,PSBDT2)
"RTN","PSBOMM",68,0)
 ....S Z=PSBDT2\1,J=$P(PSBADST(XZ,PSBDT2),"-",($L(PSBADST(XZ,PSBDT2),"-"))) S:J]"" PSBOST2=Z_"."_J
"RTN","PSBOMM",69,0)
 ....S PSBDT2=($$FMADD^XLFDT(Z,1))+.2400
"RTN","PSBOMM",70,0)
 ....S PSBDT2=$S($G(FLG):(PSBSTOP\1)+.2401,PSBDT2>PSBOSP:PSBOSP,1:PSBDT2) K FLG I PSBDT2=PSBOSP S FLG=1
"RTN","PSBOMM",71,0)
 ..S Z=PSBADST I Z]"" K ^TMP("PSB",$J,"GETADMIN") S ^TMP("PSB",$J,"GETADMIN",0)=Z
"RTN","PSBOMM",72,0)
 ..F Y=1:1:$L(Z,"-") D
"RTN","PSBOMM",73,0)
 ...Q:($P(Z,"-",Y)'?2N)&($P(Z,"-",Y)'?4N)
"RTN","PSBOMM",74,0)
 ..K PSBOACTL,^TMP("PSB1",$J) D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 M PSBOACTL=^TMP("PSJ2",$J) K ^TMP("PSJ2",$J)
"RTN","PSBOMM",75,0)
 ..I 'PSBODD F XX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",XX))  S (PSBADST,Z)=$G(^TMP("PSB",$J,"GETADMIN",XX)) D
"RTN","PSBOMM",76,0)
 ...D MISSED^PSBOMM2(Z,.PSBEDIT,PSBSTRT)
"RTN","PSBOMM",77,0)
 ..I PSBODD F XX=0:1 Q:'$D(PSBADST(XX))  S XXX=$O(PSBADST(XX,"")) S (PSBADST,Z)=PSBADST(XX,XXX) D
"RTN","PSBOMM",78,0)
 ...I Z]"" D MISSED^PSBOMM2(Z,.PSBEDIT,XXX)
"RTN","PSBOMM",79,0)
 .K PSBHDDT,PSBUNHD,^TMP("PSB1",$J)
"RTN","PSBOMM",80,0)
 .I PSBSCHT="O" D  Q
"RTN","PSBOMM",81,0)
 ..Q:PSBOSTS="N"
"RTN","PSBOMM",82,0)
 ..Q:PSBNGF
"RTN","PSBOMM",83,0)
 ..Q:PSBSM
"RTN","PSBOMM",84,0)
 ..Q:(PSBOSP=PSBOST)&(PSBOCRIT'["E")
"RTN","PSBOMM",85,0)
 ..Q:PSBOST'<PSBSTOP
"RTN","PSBOMM",86,0)
 ..S PSBDT="*** ONE-TIME ***"
"RTN","PSBOMM",87,0)
 ..S (PSBSTXP(PSBONX,$$DTFMT^PSBOMM2(PSBOSP)),PSBSTXT(PSBONX,$$DTFMT^PSBOMM2(PSBOST)))=""
"RTN","PSBOMM",88,0)
 ..S (PSBG,X,Y,PSBXSTS)="" K PSBEXST
"RTN","PSBOMM",89,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBOMM",90,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBOMM",91,0)
 ....S PSBXSTS=$P(^PSB(53.79,Y,0),U,9)
"RTN","PSBOMM",92,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,PSBXSTS'="N",PSBXSTS'="M" S PSBG=1,PSBG(PSBONX,Y)="",(X,Y)=0
"RTN","PSBOMM",93,0)
 ..I PSBG D PARTG1^PSBOMM2($O(PSBG(PSBONX,"")))
"RTN","PSBOMM",94,0)
 ..D NOW^%DTC
"RTN","PSBOMM",95,0)
 ..Q:(PSBOCRIT'[PSBOSTS)
"RTN","PSBOMM",96,0)
 ..S PSBS(DFN,PSBONX,$S(PSBOSTS="A":"Active",PSBOSTS="H":"On Hold",PSBOSTS="D":"DC'd",PSBOSTS="DE":"DC'd (Edit)",PSBOSTS="E":"Expired",1:" * ERROR * "))=""
"RTN","PSBOMM",97,0)
 ..D:'PSBG!(PSBACRIT[$G(PSBXSTS,1))
"RTN","PSBOMM",98,0)
 ...S VAR=""
"RTN","PSBOMM",99,0)
 ...K ^TMP("PSJ2",$J),^TMP("PSB1",$J),PSBOACTL D EN^PSJBCMA2(DFN,PSBONX,1) I ^TMP("PSJ2",$J,0)'=1 D
"RTN","PSBOMM",100,0)
 ....M PSBOACTL=^TMP("PSJ2",$J)
"RTN","PSBOMM",101,0)
 ....D UDONE^PSBOMM2
"RTN","PSBOMM",102,0)
 ....I PSBFLAG=1 S VAR="(On Hold) "_$$DTFMT^PSBOMM2(PSBHDDT)
"RTN","PSBOMM",103,0)
 ....I PSBFLAG=2 S VAR="(On Hold) "_$$DTFMT^PSBOMM2(PSBHDDT)_"  (Off Hold) "_$$DTFMT^PSBOMM2(PSBUNHD)
"RTN","PSBOMM",104,0)
 ...I '$G(PSBEXST,0)!(PSBXSTS="M") S $P(^TMP("PSB",$J,DFN,"*** ONE-TIME ***",PSBOITX,PSBONX),U,1,4)=VAR
"RTN","PSBOMM",105,0)
 ...I $G(PSBEXST,0) D
"RTN","PSBOMM",106,0)
 ....S VAR1=$G(^TMP("PSB",$J,DFN,"*** ONE-TIME ***","* "_PSBOITX,PSBONX)) I VAR1]"" S $P(VAR1,U,1,4)=VAR_VAR1
"RTN","PSBOMM",107,0)
 ...K PSBHDDT,PSBUNHD,^TMP("PSB1",$J),PSBCNT
"RTN","PSBOMM",108,0)
 K PSBOACTL
"RTN","PSBOMM",109,0)
 Q
"RTN","PSBOMM",110,0)
PRINT ;
"RTN","PSBOMM",111,0)
 N PSBHDR,PSBDT,PSBOITX,PSBONX,DFN
"RTN","PSBOMM",112,0)
 K PSBNPG
"RTN","PSBOMM",113,0)
 S Y=$S($P(PSBRPT(.1),U,8)]"":$P(PSBRPT(.1),U,8),1:$P(PSBRPT(.1),U,6))
"RTN","PSBOMM",114,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOMM",115,0)
 .S PSBHDR(1)="MISSED MEDICATIONS REPORT for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT(Y+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",116,0)
 .S PSBHDR(2)="Order Status(es): --"
"RTN","PSBOMM",117,0)
 .F Y=5,8,7 I $P(PSBFUTR,U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("^^^^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBOMM",118,0)
 .S PSBHDR(3)="Admin Status(es): --"
"RTN","PSBOMM",119,0)
 .F Y=16,17,18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(3),": ",2)=$P(PSBHDR(3),": ",2)_$S(PSBHDR(3)["--":"",1:"/ ")_$P("^^^^^^^^^^^^^^^Missing Dose^Held^Refused",U,Y)_" " S PSBHDR(3)=$TR(PSBHDR(3),"-","")
"RTN","PSBOMM",120,0)
 .I PSBINCC S PSBHDR(4)="Include Comments/Reasons"
"RTN","PSBOMM",121,0)
 .S DFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOMM",122,0)
 .W $$PTHDR()
"RTN","PSBOMM",123,0)
 .I $G(PSBEDIT) W !?7,"*Administration Times have been edited*"
"RTN","PSBOMM",124,0)
 .I $O(^TMP("PSB",$J,DFN,""))="" W !,"No Missed Medications Found",$$PTFTR^PSBOHDR() Q
"RTN","PSBOMM",125,0)
 .S PSBDT=""
"RTN","PSBOMM",126,0)
 .F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",127,0)
 ..W !
"RTN","PSBOMM",128,0)
 ..S PSBOITX=""
"RTN","PSBOMM",129,0)
 ..F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",130,0)
 ...S PSBONX=""
"RTN","PSBOMM",131,0)
 ...F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",132,0)
 ....K VAR1,VAR2,VAR3,SP I $Y>(IOSL-9) W $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOMM",133,0)
 ....S VAR1=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX))
"RTN","PSBOMM",134,0)
 ....S VAR2=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X"))
"RTN","PSBOMM",135,0)
 ....S VAR3=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3))
"RTN","PSBOMM",136,0)
 ....I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",137,0)
 .....W !
"RTN","PSBOMM",138,0)
 .....W !,$O(PSBS(DFN,PSBONX,"")),?15,PSBDT,?43,PSBOITX,!
"RTN","PSBOMM",139,0)
 .....I VAR1]"" W ?43,VAR1 S SP=1
"RTN","PSBOMM",140,0)
 .....I VAR2]"" W:$G(SP) ! W ?43,VAR2
"RTN","PSBOMM",141,0)
 .....I VAR3]"" W !,$$WRAP^PSBO(43,80,VAR3)
"RTN","PSBOMM",142,0)
 .....W !,"Start Date/Time:  ",?18,$O(PSBSTXT(PSBONX,""))
"RTN","PSBOMM",143,0)
 .....W !,"Stop Date/Time:  ",?18,$O(PSBSTXP(PSBONX,""))
"RTN","PSBOMM",144,0)
 ....W !,$O(PSBS(DFN,PSBONX,"")),?15,$S(+PSBDT>0:$$DTFMT^PSBOMM2(PSBDT),1:PSBDT),?43,PSBOITX,?95,$O(PSBSTXP(PSBONX,"")),!
"RTN","PSBOMM",145,0)
 ....I VAR1]"" W ?43,VAR1 S SP=1
"RTN","PSBOMM",146,0)
 ....I VAR2]"" W:$G(SP) ! W ?43,VAR2
"RTN","PSBOMM",147,0)
 ....I VAR3]"" W !,$$WRAP^PSBO(43,80,VAR3)
"RTN","PSBOMM",148,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOMM",149,0)
 .Q
"RTN","PSBOMM",150,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBOMM",151,0)
 .S PSBHDR(1)="MISSED MEDICATIONS REPORT for "_$$FMTE^XLFDT($P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7))_" to "_$$FMTE^XLFDT(Y+$P(PSBRPT(.1),U,9))
"RTN","PSBOMM",152,0)
 .S PSBHDR(2)="Order Status(es): --"
"RTN","PSBOMM",153,0)
 .F Y=5,7,8 I $P(PSBFUTR,U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("^^^^Active^^Expired^DC'd^^^^^^^^^^",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBOMM",154,0)
 .S PSBHDR(3)="Admin Status(es): --"
"RTN","PSBOMM",155,0)
 .F Y=16,17,18 I $P(PSBFUTR,U,Y) S $P(PSBHDR(3),": ",2)=$P(PSBHDR(3),": ",2)_$S(PSBHDR(3)["--":"",1:"/ ")_$P("^^^^^^^^^^^^^^^Missing Dose^Held^Refused",U,Y)_" " S PSBHDR(3)=$TR(PSBHDR(3),"-","")
"RTN","PSBOMM",156,0)
 .I PSBINCC S PSBHDR(4)="Include Comments/Reasons"
"RTN","PSBOMM",157,0)
 .S PSBWARD=$P(PSBRPT(.1),U,3)
"RTN","PSBOMM",158,0)
 .W $$WRDHDR()
"RTN","PSBOMM",159,0)
 .I '$O(^TMP("PSB",$J,0)) W !,"No Missed Medications Found" Q
"RTN","PSBOMM",160,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBOMM",161,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBOMM",162,0)
 ..S PSBDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^(.101)))
"RTN","PSBOMM",163,0)
 ..S:PSBDX="" PSBDX=$P(^DPT(DFN,0),U)
"RTN","PSBOMM",164,0)
 ..S ^TMP("PSB",$J,"B",PSBDX,DFN)=""
"RTN","PSBOMM",165,0)
 .S PSBDX=""
"RTN","PSBOMM",166,0)
 .F  S PSBDX=$O(^TMP("PSB",$J,"B",PSBDX)) Q:PSBDX=""  D
"RTN","PSBOMM",167,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBDX,DFN)) Q:'DFN  D
"RTN","PSBOMM",168,0)
 ...W !
"RTN","PSBOMM",169,0)
 ...S PSBDT=""
"RTN","PSBOMM",170,0)
 ...F  S PSBDT=$O(^TMP("PSB",$J,DFN,PSBDT)) Q:PSBDT=""  D
"RTN","PSBOMM",171,0)
 ....W !
"RTN","PSBOMM",172,0)
 ....W:PSBDT["ONE-TIME" !
"RTN","PSBOMM",173,0)
 ....S PSBOITX=""
"RTN","PSBOMM",174,0)
 ....F  S PSBOITX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX)) Q:PSBOITX=""  D
"RTN","PSBOMM",175,0)
 .....S PSBONX=""
"RTN","PSBOMM",176,0)
 .....F  S PSBONX=$O(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)) Q:PSBONX=""  D
"RTN","PSBOMM",177,0)
 ......K VAR1,VAR2,VAR3,SP I $Y>(IOSL-9) W $$WRDHDR()
"RTN","PSBOMM",178,0)
 ......W !,$O(PSBS(DFN,PSBONX,"")),?15,$G(^DPT(DFN,.101),"**"),?35,$P(^DPT(DFN,0),U)," (",$E($P(^(0),U,9),6,9),")"
"RTN","PSBOMM",179,0)
 ......S VAR1=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX))
"RTN","PSBOMM",180,0)
 ......S VAR2=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X"))
"RTN","PSBOMM",181,0)
 ......S VAR3=$G(^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3))
"RTN","PSBOMM",182,0)
 ......I PSBDT["ONE-TIME" D  Q
"RTN","PSBOMM",183,0)
 .......W !,PSBDT,?30,PSBOITX S SP=1
"RTN","PSBOMM",184,0)
 .......I VAR1]"" W !,?30,$P(VAR1,U,1) S SP=1
"RTN","PSBOMM",185,0)
 .......I VAR2]"" W:$G(SP) ! W ?30,VAR2
"RTN","PSBOMM",186,0)
 .......I VAR3]"" W !,$$WRAP^PSBO(30,95,VAR3)
"RTN","PSBOMM",187,0)
 .......W !,"Start Date/Time:  ",?18,$O(PSBSTXT(PSBONX,""))
"RTN","PSBOMM",188,0)
 .......W !,"Stop Date/Time:  ",?18,$O(PSBSTXP(PSBONX,""))
"RTN","PSBOMM",189,0)
 .......W !
"RTN","PSBOMM",190,0)
 ......W ?67,$S(+PSBDT>0:$$DTFMT^PSBOMM2(PSBDT),1:PSBDT),?85,PSBOITX S SP=1
"RTN","PSBOMM",191,0)
 ......I VAR1]"" W !,?50,VAR1 S SP=1
"RTN","PSBOMM",192,0)
 ......I VAR2]"" W:$G(SP) ! W ?50,VAR2
"RTN","PSBOMM",193,0)
 ......I VAR3]"" W !,$$WRAP^PSBO(50,75,VAR3)
"RTN","PSBOMM",194,0)
 Q
"RTN","PSBOMM",195,0)
WRDHDR() ;
"RTN","PSBOMM",196,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOMM",197,0)
 W !,"Order Status",?15,"Room-Bed",?35,"Patient",?67,"Admin Date/Time",?85,"Medication"
"RTN","PSBOMM",198,0)
 D LN1^PSBOMM2
"RTN","PSBOMM",199,0)
 Q ""
"RTN","PSBOMM",200,0)
PTHDR() ;
"RTN","PSBOMM",201,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOMM",202,0)
 W !,"Order Status",?15,"Administration Date/Time",?43,"Medication",?95,"Order Stop Date"
"RTN","PSBOMM",203,0)
 D LN1^PSBOMM2
"RTN","PSBOMM",204,0)
 Q ""
"RTN","PSBOMM2")
0^31^B39563401^B14344461
"RTN","PSBOMM2",1,0)
PSBOMM2 ;BIRMINGHAM/EFC-MISSED MEDS ;Mar 2004
"RTN","PSBOMM2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**26,32**;Mar 2004;Build 32
"RTN","PSBOMM2",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOMM2",4,0)
 ;
"RTN","PSBOMM2",5,0)
MISSED(PSBADMN,PSBEDIT,PSBXDT) ;
"RTN","PSBOMM2",6,0)
 N PSBMISD,PSBAUDT,PSBSTRT2
"RTN","PSBOMM2",7,0)
 S PSBSTRT2=(PSBXDT\1) F  D  Q:PSBODD  S PSBSTRT2=$$FMADD^XLFDT(PSBSTRT2,1) Q:PSBSTRT2>PSBSTOP
"RTN","PSBOMM2",8,0)
 .F Y=1:1:$L(PSBADMN,"-") S PSBDT=+("."_$P(PSBADMN,"-",Y))+(PSBSTRT2) D
"RTN","PSBOMM2",9,0)
 ..S PSBMISD=$$CHECK(PSBDT)
"RTN","PSBOMM2",10,0)
 ..;CHECK AUDITED ADMIN TIMES FOR MISSED MED
"RTN","PSBOMM2",11,0)
 ..I PSBMISD F I=1:1:$P(PSBOACTL(0),U,4) I $P($G(PSBOACTL(I,1)),U,3)["ADMIN TIMES" D  Q:'PSBMISD
"RTN","PSBOMM2",12,0)
 ...Q:$P(PSBOACTL(I,1),U)<PSBSTRT2
"RTN","PSBOMM2",13,0)
 ...Q:$P(PSBOACTL(I,1),U)>PSBSTOP
"RTN","PSBOMM2",14,0)
 ...S PSBAUDT=+("."_$P(PSBOACTL(I,2),"-",Y))+(PSBSTRT2\1)
"RTN","PSBOMM2",15,0)
 ...S PSBMISD=$$CHECK(PSBAUDT),PSBEDIT=1
"RTN","PSBOMM2",16,0)
 ..I PSBMISD D
"RTN","PSBOMM2",17,0)
 ...Q:'$$OKAY^PSBVDLU1(PSBOST,PSBSTRT2,PSBSCH,PSBONX,$P(^TMP("PSJ",$J,PSBX,3),U,2),PSBFREQ,PSBOSTS)
"RTN","PSBOMM2",18,0)
 ...S:'$D(^TMP("PSB",$J,DFN,PSBDT,"* "_PSBOITX,PSBONX)) ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)=""
"RTN","PSBOMM2",19,0)
 ...D UDCONT
"RTN","PSBOMM2",20,0)
 Q
"RTN","PSBOMM2",21,0)
CHECK(PSBDT) ;
"RTN","PSBOMM2",22,0)
 I PSBDT<PSBOST Q 0 ; Order Start Date
"RTN","PSBOMM2",23,0)
 I PSBDT'<PSBOSP Q 0 ; Order Stop Date
"RTN","PSBOMM2",24,0)
 I PSBDT<PSBSTRT Q 0 ; Report Window
"RTN","PSBOMM2",25,0)
 I PSBDT>PSBSTOP Q 0 ; Report Window
"RTN","PSBOMM2",26,0)
 I $D(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT)) D  Q:PSBSTUS'="N" $G(PART,0)
"RTN","PSBOMM2",27,0)
 .K PART S PSBIX=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,"")),PSBSTUS=$P(^PSB(53.79,PSBIX,0),U,9)
"RTN","PSBOMM2",28,0)
 .I PSBOCRIT[PSBOSTS D:(PSBACRIT[PSBSTUS)  Q
"RTN","PSBOMM2",29,0)
 ..I (PSBSTUS="G")&$D(^PSB(53.79,PSBIX,.5)) D
"RTN","PSBOMM2",30,0)
 ...S X=0 F  S X=$O(^PSB(53.79,PSBIX,.5,X)) Q:+X=0  D
"RTN","PSBOMM2",31,0)
 ....I $P(^PSB(53.79,PSBIX,.5,X,0),U,2)>$P(^PSB(53.79,PSBIX,.5,X,0),U,3) D  S PSBOITX=$E(PSBOITX,3,999)
"RTN","PSBOMM2",32,0)
 .....S PSBOITX="* "_PSBOITX S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X")="Units Ordered: "_$P(^PSB(53.79,PSBIX,.5,X,0),U,2)_"   Units Given: "_$P(^PSB(53.79,PSBIX,.5,X,0),U,3)_"    Admin. Status: * Partial (Given)"
"RTN","PSBOMM2",33,0)
 .....S PART=1
"RTN","PSBOMM2",34,0)
 .....D:PSBINCC GCMNTS(PSBIX)
"RTN","PSBOMM2",35,0)
 ..I PSBSTUS'="G"  I PSBACRIT[PSBSTUS S PART=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X")="Admin. Status: ("_$S(PSBSTUS="":" *UNKNOWN* ",PSBSTUS="M":"Missing Dose",PSBSTUS="H":"Held",PSBSTUS="R":"Refused")_")" D:PSBINCC GCMNTS(PSBIX)
"RTN","PSBOMM2",36,0)
 Q 1
"RTN","PSBOMM2",37,0)
UDCONT ;
"RTN","PSBOMM2",38,0)
 S PSBFLAG=0,J=1
"RTN","PSBOMM2",39,0)
 K ^TMP("PSB1",$J)
"RTN","PSBOMM2",40,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBOMM2",41,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBOMM2",42,0)
 . I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBOMM2",43,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBOMM2",44,0)
 .S J=0 F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBOMM2",45,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBOMM2",46,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBOMM2",47,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBOMM2",48,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBOMM2",49,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST'="" I PSBDT<PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBOMM2",50,0)
 ..I PSBDT>PSBHDDT,PSBHDST="HOLD",PSBOFST="" S PSBFLAG=1
"RTN","PSBOMM2",51,0)
 K PSBCNT,TMP("PSB1",$J)
"RTN","PSBOMM2",52,0)
 S PSBOITX2=PSBOITX
"RTN","PSBOMM2",53,0)
 I $D(^TMP("PSB",$J,DFN,PSBDT,"* "_PSBOITX,PSBONX)) S PSBOITX="* "_PSBOITX
"RTN","PSBOMM2",54,0)
 I PSBFLAG=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$DTFMT(PSBHDDT)
"RTN","PSBOMM2",55,0)
 I PSBFLAG=2 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$DTFMT(PSBHDDT)_"  "_"(Off Hold) "_$$DTFMT(PSBUNHD)
"RTN","PSBOMM2",56,0)
 S PSBOITX=PSBOITX2
"RTN","PSBOMM2",57,0)
 Q
"RTN","PSBOMM2",58,0)
 ;
"RTN","PSBOMM2",59,0)
UDONE ;
"RTN","PSBOMM2",60,0)
 S PSBFLAG=0,J=1
"RTN","PSBOMM2",61,0)
 F I=1:1:$P(PSBOACTL(0),U,4) D
"RTN","PSBOMM2",62,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["ON HOLD"!($P($G(PSBOACTL(I,1)),U,4)="HOLD") S ^TMP("PSB1",$J,DFN,J)="HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12)
"RTN","PSBOMM2",63,0)
 .I $P($G(PSBOACTL(I,1)),U,4)["TAKEN OFF HOLD"!($P($G(PSBOACTL(I,1)),U,4)["UNHOLD") S $P(^TMP("PSB1",$J,DFN,J),U,3)="OFF HOLD"_U_$E($P($G(PSBOACTL(I,1)),U,1),1,12),J=J+1
"RTN","PSBOMM2",64,0)
 D:$D(^TMP("PSB1",$J,DFN))&($P(PSBOACTL(0),U,4)'=1)
"RTN","PSBOMM2",65,0)
 .S J="" F  S J=$O(^TMP("PSB1",$J,DFN,J)) Q:'J  Q:PSBFLAG  D
"RTN","PSBOMM2",66,0)
 ..S PSBHDDT=$P(^TMP("PSB1",$J,DFN,J),U,2)
"RTN","PSBOMM2",67,0)
 ..S PSBHDST=$P(^TMP("PSB1",$J,DFN,J),U)
"RTN","PSBOMM2",68,0)
 ..S PSBOFDT=$P(^TMP("PSB1",$J,DFN,J),U,4)
"RTN","PSBOMM2",69,0)
 ..S PSBOFST=$P(^TMP("PSB1",$J,DFN,J),U,3)
"RTN","PSBOMM2",70,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",'$D(^TMP("PSB1",$J,DFN,J+1)) I PSBSTOP>PSBOFDT,PSBOFST="OFF HOLD" S PSBFLAG=2,PSBUNHD=PSBOFDT
"RTN","PSBOMM2",71,0)
 ..I PSBOSTS="A",PSBHDST="HOLD",PSBOFST'="",PSBOFDT'<PSBSTOP S PSBFLAG=1
"RTN","PSBOMM2",72,0)
 ..I PSBOSTS="H",PSBHDST="HOLD",'$D(^TMP("PSB1",$J,DFN,J+1)) S PSBFLAG=1
"RTN","PSBOMM2",73,0)
 K PSBCNT,^TMP("PSB1",$J)
"RTN","PSBOMM2",74,0)
 S PSBOITX2=PSBOITX
"RTN","PSBOMM2",75,0)
 I $D(^TMP("PSB",$J,DFN,PSBDT,"* "_PSBOITX,PSBONX)) S PSBOITX="* "_PSBOITX
"RTN","PSBOMM2",76,0)
 I PSBFLAG=1 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$DTFMT(PSBHDDT)
"RTN","PSBOMM2",77,0)
 I PSBFLAG=2 S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX)="(On Hold) "_$$DTFMT(PSBHDDT)_"  "_"(Off Hold) "_$$DTFMT(PSBUNHD)
"RTN","PSBOMM2",78,0)
 S PSBOITX=PSBOITX2
"RTN","PSBOMM2",79,0)
 Q
"RTN","PSBOMM2",80,0)
GCMNTS(XIEN) ;
"RTN","PSBOMM2",81,0)
 Q:'$D(^PSB(53.79,XIEN,.3,1))
"RTN","PSBOMM2",82,0)
 N X
"RTN","PSBOMM2",83,0)
 S X=$O(^PSB(53.79,XIEN,.3,""),-1) Q:+X=0  S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,.3)="Comment: "_$P(^PSB(53.79,XIEN,.3,X,0),U)
"RTN","PSBOMM2",84,0)
 Q
"RTN","PSBOMM2",85,0)
PARTG1(XIEN) ;
"RTN","PSBOMM2",86,0)
 I $D(^PSB(53.79,XIEN)) D
"RTN","PSBOMM2",87,0)
 .S PSBSTUS=$P(^PSB(53.79,XIEN,0),U,9)
"RTN","PSBOMM2",88,0)
 .I PSBOCRIT[PSBOSTS I PSBACRIT[PSBSTUS D  S PSBEXST=1 Q
"RTN","PSBOMM2",89,0)
 ..I (PSBSTUS="G")&$D(^PSB(53.79,XIEN,.5)) D
"RTN","PSBOMM2",90,0)
 ...S X=0 F  S X=$O(^PSB(53.79,XIEN,.5,X)) Q:+X=0  D
"RTN","PSBOMM2",91,0)
 ....I $P(^PSB(53.79,XIEN,.5,X,0),U,2)>$P(^PSB(53.79,XIEN,.5,X,0),U,3) D  S PSBOITX=$E(PSBOITX,3,999),PSBGVN=0
"RTN","PSBOMM2",92,0)
 .....S PSBOITX="* "_PSBOITX S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X")="Units Ordered: "_$P(^PSB(53.79,XIEN,.5,X,0),U,2)_"   Units Given: "_$P(^PSB(53.79,XIEN,.5,X,0),U,3)_"    Admin. Status: * Partial (Given)"
"RTN","PSBOMM2",93,0)
 .....I PSBINCC D GCMNTS(XIEN)
"RTN","PSBOMM2",94,0)
 ..I PSBSTUS'="G" D  S PSBGVN=0
"RTN","PSBOMM2",95,0)
 ...I PSBACRIT[PSBSTUS S ^TMP("PSB",$J,DFN,PSBDT,PSBOITX,PSBONX,"X")="Admin. Status: ("_$S(PSBSTUS="":" *UNKNOWN* ",PSBSTUS="M":"Missing Dose",PSBSTUS="H":"Held",PSBSTUS="R":"Refused")_")"
"RTN","PSBOMM2",96,0)
 ...I PSBINCC D GCMNTS(XIEN)
"RTN","PSBOMM2",97,0)
 Q
"RTN","PSBOMM2",98,0)
LN1 ;
"RTN","PSBOMM2",99,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMM2",100,0)
 Q
"RTN","PSBOMM2",101,0)
DEFLT ;
"RTN","PSBOMM2",102,0)
 S PSBFUTR=$TR(PSBRPT(1),"~","^")
"RTN","PSBOMM2",103,0)
 Q:PSBRPT(1)]""
"RTN","PSBOMM2",104,0)
 S PSBFUTR="^^^^1^^1^1^^^^^^^^1"  ;default MM Report settings Per GUI MM report...
"RTN","PSBOMM2",105,0)
 S X01=""
"RTN","PSBOMM2",106,0)
 D RPC^PSBPAR(.X01,"GETPAR","ALL","PSB RPT INCL COMMENTS")
"RTN","PSBOMM2",107,0)
 S $P(PSBRPT(.2),U,8)=+X01(0)
"RTN","PSBOMM2",108,0)
 K PSBSTOP S PSBSTOP=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMM2",109,0)
 Q
"RTN","PSBOMM2",110,0)
DTFMT(DT) ;
"RTN","PSBOMM2",111,0)
 N Y,X
"RTN","PSBOMM2",112,0)
 I +DT'>0 S DTFMT=DT Q DTFMT
"RTN","PSBOMM2",113,0)
 S Y=DT,X=$E($P(Y,".",2)_"0000",1,4)
"RTN","PSBOMM2",114,0)
 S DTFMT=$TR($J(+$E(Y,4,5),2)_"/"_$J(+$E(Y,6,7),2)_"/"_($E(Y,1,3)+1700)," ","0")_"@"_X
"RTN","PSBOMM2",115,0)
 Q DTFMT
"RTN","PSBOMT")
0^21^B79357659^n/a
"RTN","PSBOMT",1,0)
PSBOMT ;BIRMINGHAM/TEJ-BCMA MEDICATION THERAPY REPORT ;Mar 2004
"RTN","PSBOMT",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOMT",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOMT",4,0)
 ;
"RTN","PSBOMT",5,0)
 ; Reference/IA
"RTN","PSBOMT",6,0)
 ; File 50.7/2880
"RTN","PSBOMT",7,0)
 ; File 52.6/436
"RTN","PSBOMT",8,0)
 ; File 52.7/437
"RTN","PSBOMT",9,0)
 ; File 200/10060
"RTN","PSBOMT",10,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBOMT",11,0)
 ; IEN^PSN50P65/4543
"RTN","PSBOMT",12,0)
 ; DRGIEN^PSS50P7/4662
"RTN","PSBOMT",13,0)
 ; VAC^PSS50/4533
"RTN","PSBOMT",14,0)
 ; ^PSDRUG(/221 
"RTN","PSBOMT",15,0)
EN ;
"RTN","PSBOMT",16,0)
 N PSBHDR,PSBORDS,PSBORD,PSBOIP
"RTN","PSBOMT",17,0)
 N TMP
"RTN","PSBOMT",18,0)
 K TMP("PSBOIS",$J),TMP("VA CLASS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J),PSBLGD,PSBOIL,PSBDDL,PSBSOLL,PSBADDL
"RTN","PSBOMT",19,0)
 S PSBCLSS=0,PSBCFLG=0
"RTN","PSBOMT",20,0)
 S PSBXDFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOMT",21,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7),PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOMT",22,0)
 K PSBOCRIT F Y=1:1:4 I $P(PSBRPT(.2),U,Y) S PSBOCRIT=$G(PSBOCRIT,"")_$P("C^P^OC^O",U,Y)_"^"
"RTN","PSBOMT",23,0)
 D NOW^%DTC S (Y,PSBNOWX)=% D DD^%DT S PSBDTTM=$E(Y,1,18)
"RTN","PSBOMT",24,0)
 S:+PSBSTRT'>0 PSBSTRT=$$FMADD^XLFDT(X,-1)
"RTN","PSBOMT",25,0)
 S:+PSBSTOP'>0 PSBSTOP=$P(%,".")
"RTN","PSBOMT",26,0)
 I $D(PSBRPT(.2)) I $P(PSBRPT(.2),U,8) S PSBCFLG=1
"RTN","PSBOMT",27,0)
 I $D(PSBRPT(2)) F XD=$O(PSBRPT(2,0)):1:$O(PSBRPT(2,"B"),-1) S PSBRPT(2,XD,0)=$TR(PSBRPT(2,XD,0),"~",U) D:$P(PSBRPT(2,XD,0),U)="MT"
"RTN","PSBOMT",28,0)
 .I $P(PSBRPT(2,XD,0),U,2)="OIT" D  Q
"RTN","PSBOMT",29,0)
 ..S PSBSRCHL="ORDERABLE ITEM SEARCH LIST:",PSBOIL(+$P(PSBRPT(2,XD,0),U,3))=""
"RTN","PSBOMT",30,0)
 ..S PSB=$P(PSBRPT(2,XD,0),U,3) F X=1:1:$L(PSB,",") Q:$P(PSB,",",X)=""  S (TMP("PSBOIS",$J,$P(PSB,",",X)),PSBOIP("OIP",$P(PSB,",",X)))=""
"RTN","PSBOMT",31,0)
 .I $P(PSBRPT(2,XD,0),U,2)="ADD" D  Q
"RTN","PSBOMT",32,0)
 ..S PSBSRCHL="IV MEDICATION SEARCH LIST:"
"RTN","PSBOMT",33,0)
 ..I $D(^PSDRUG("A526",$P(PSBRPT(2,XD,0),U,3))) S X2=$O(^PSDRUG("A526",$P(PSBRPT(2,XD,0),U,3),"")) S PSBADDL(X2)="",TMP("PSBOIS",$J,$$OFROMA(X2))=""
"RTN","PSBOMT",34,0)
 .I $P(PSBRPT(2,XD,0),U,2)="SOL" D  Q
"RTN","PSBOMT",35,0)
 ..S PSBSRCHL="IV MEDICATION SEARCH LIST:"
"RTN","PSBOMT",36,0)
 ..I $D(^PSDRUG("A527",$P(PSBRPT(2,XD,0),U,3))) S X2=$O(^PSDRUG("A527",$P(PSBRPT(2,XD,0),U,3),"")) S PSBSOLL(X2)="",TMP("PSBOIS",$J,$$OFROMS(X2))=""
"RTN","PSBOMT",37,0)
 .I $P(PSBRPT(2,XD,0),U,2)="DD" D  K PSBDRGS Q
"RTN","PSBOMT",38,0)
 ..S PSBSRCHL="DISPENSED DRUG SEARCH LIST:",PSBDDL($P(PSBRPT(2,XD,0),U,3))=""
"RTN","PSBOMT",39,0)
 ..K PSBDRGS S PSBDRGS="" D OILST^PSBRPCMO(.PSBDRGS,$P(PSBRPT(2,XD,0),U,3),"UD")
"RTN","PSBOMT",40,0)
 ..F X2=PSBDRGS(0):1:$O(PSBDRGS(""),-1) I +PSBDRGS(1)'<0 S TMP("PSBOIS",$J,$P(PSBDRGS(X2),U,4))=""
"RTN","PSBOMT",41,0)
 .I $P(PSBRPT(2,XD,0),U,2)="VAC" D
"RTN","PSBOMT",42,0)
 ..S PSBSRCHL="VA DRUG CLASS SEARCH LIST:"
"RTN","PSBOMT",43,0)
 ..S PSBCLS=$P(PSBRPT(2,XD,0),U,3) D GETCLSS(PSBCLS) K PSBDDRG("VAC") M TMP("VA CLASS",$J,PSBCLS,"DDRG")=PSBDDRG K PSBDDRG
"RTN","PSBOMT",44,0)
 ..S PSBCLSS=1
"RTN","PSBOMT",45,0)
 M PSBOIP("OIP")=TMP("PSBOIS",$J)
"RTN","PSBOMT",46,0)
 D OUT(PSBXDFN,PSBSTRT,PSBSTOP)
"RTN","PSBOMT",47,0)
 Q
"RTN","PSBOMT",48,0)
OUT(PSBXDFN,PSBSTRT,PSBSTOP) ;
"RTN","PSBOMT",49,0)
 D:PSBCLSS GETOIS  ; POSSBLE CLASS ITEMS VIA AVAIL ORDERS
"RTN","PSBOMT",50,0)
 D GETADSO^PSBOMT1 ; ALL ADDS AND SOLS
"RTN","PSBOMT",51,0)
 D FINDIENS^PSBOMT1 ; FIND ALL MED LOG ENTRS
"RTN","PSBOMT",52,0)
 D PREOUT ;   WRIT TO GLOBL
"RTN","PSBOMT",53,0)
 D WRITEOT
"RTN","PSBOMT",54,0)
 D CLEANSUM^PSBOMT1
"RTN","PSBOMT",55,0)
 D CLEANALL^PSBOMT1
"RTN","PSBOMT",56,0)
 Q
"RTN","PSBOMT",57,0)
GETOIS ;
"RTN","PSBOMT",58,0)
 K ^TMP("PSJ",$J),PSBTMP
"RTN","PSBOMT",59,0)
 D EN^PSJBCMA(PSBXDFN,PSBSTRT)
"RTN","PSBOMT",60,0)
 Q:^TMP("PSJ",$J,1,0)<0
"RTN","PSBOMT",61,0)
 M PSBTMP=^TMP("PSJ",$J) K ^TMP("PSJ",$J)
"RTN","PSBOMT",62,0)
 S X=0 F  S X=$O(PSBTMP(X)) Q:+X=0  D
"RTN","PSBOMT",63,0)
 .Q:$G(PSBOCRIT,"")'[$P(PSBTMP(X,1),U,2)_"^"
"RTN","PSBOMT",64,0)
 .S PSBORDN=$P(PSBTMP(X,0),U,3) S PSBORDS(PSBORDN)=""
"RTN","PSBOMT",65,0)
 .I $D(PSBTMP(X,700)) D  Q
"RTN","PSBOMT",66,0)
 ..F XX=1:1:PSBTMP(X,700,0) D
"RTN","PSBOMT",67,0)
 ...S PSBCLS="" F  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",68,0)
 ....I '$D(TMP("VA CLASS",$J,PSBCLS,"DDRG",$P(PSBTMP(X,700,XX,0),U))) Q
"RTN","PSBOMT",69,0)
 ....S PSBORDS(PSBORDN,"DD",$P(PSBTMP(X,700,XX,0),U))=""
"RTN","PSBOMT",70,0)
 ....S PSBORDS(PSBORDN,"OIP",$P(PSBTMP(X,3),U))=""
"RTN","PSBOMT",71,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",72,0)
 .I $D(PSBTMP(X,850)) M PSBORDS(PSBORDN,"ADD")=PSBTMP(X,850) D
"RTN","PSBOMT",73,0)
 ..F XX=1:1:PSBORDS(PSBORDN,"ADD",0) S PSBORDS(PSBORDN,"OIP",$$OFROMA($P(PSBORDS(PSBORDN,"ADD",XX,0),U)))=""
"RTN","PSBOMT",74,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",75,0)
 .I $D(PSBTMP(X,950)) M PSBORDS(PSBORDN,"SOL")=PSBTMP(X,950) D
"RTN","PSBOMT",76,0)
 ..F XX=1:1:PSBORDS(PSBORDN,"SOL",0) S PSBORDS(PSBORDN,"OIP",$$OFROMS($P(PSBORDS(PSBORDN,"SOL",XX,0),U)))=""
"RTN","PSBOMT",77,0)
 ..M PSBOIP("OIP")=PSBORDS(PSBORDN,"OIP")
"RTN","PSBOMT",78,0)
 K PSBTMP
"RTN","PSBOMT",79,0)
 M TMP("PSBOIS",$J)=PSBOIP("OIP")
"RTN","PSBOMT",80,0)
 Q
"RTN","PSBOMT",81,0)
OFROMA(PSBADD) ;OITEM FROM AN ADDITIVE
"RTN","PSBOMT",82,0)
 S X1=$$GET1^DIQ(52.6,PSBADD_",",15,"I")
"RTN","PSBOMT",83,0)
 I PSBCLSS D
"RTN","PSBOMT",84,0)
 .S X2=$$GETDRN(X1)
"RTN","PSBOMT",85,0)
 .S PSBCLS="" K X3 F  Q:$D(X3)  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",86,0)
 ..I $D(TMP("VA CLASS",$J,PSBCLS,"DDRG",X2)) S X3=X1
"RTN","PSBOMT",87,0)
 .I '$D(X3) S X3=0
"RTN","PSBOMT",88,0)
 Q $G(X3,X1)
"RTN","PSBOMT",89,0)
OFROMS(PSBSOL) ;OITEM FROM A SOLUTION
"RTN","PSBOMT",90,0)
 S X1=$$GET1^DIQ(52.7,PSBSOL_",",9,"I")
"RTN","PSBOMT",91,0)
 I PSBCLSS D
"RTN","PSBOMT",92,0)
 .S X2=$$GETDRN(X1)
"RTN","PSBOMT",93,0)
 .S PSBCLS="" K X3 F  Q:$D(X3)  S PSBCLS=$O(TMP("VA CLASS",$J,PSBCLS)) Q:+PSBCLS=0  D
"RTN","PSBOMT",94,0)
 ..I $D(TMP("VA CLASS",$J,PSBCLS,"DDRG",X2)) S X3=X1
"RTN","PSBOMT",95,0)
 .I '$D(X3) S X3=0
"RTN","PSBOMT",96,0)
 Q $G(X3,X1)
"RTN","PSBOMT",97,0)
PREOUT ;
"RTN","PSBOMT",98,0)
 K PSBUNK S XDT="" F  S XDT=$O(TMP("PSBIENS",$J,XDT),-1) Q:XDT=""  S XIEN="",XIEN=$O(TMP("PSBIENS",$J,XDT,XIEN)) D
"RTN","PSBOMT",99,0)
 .Q:$$NONSTS(PSBXDFN,XIEN)
"RTN","PSBOMT",100,0)
 .S PSBIEN=XIEN
"RTN","PSBOMT",101,0)
 .S PSBIENS=PSBIEN_","
"RTN","PSBOMT",102,0)
 .D OUTPUT
"RTN","PSBOMT",103,0)
 Q
"RTN","PSBOMT",104,0)
OUTPUT ;
"RTN","PSBOMT",105,0)
 S PSBSPC=$J("",80)
"RTN","PSBOMT",106,0)
 S W=$E($$GET1^DIQ(53.79,PSBIENS,.02)_PSBSPC,1,20)_" "
"RTN","PSBOMT",107,0)
 S W=W_$S($P(^PSB(53.79,PSBIEN,0),U,9)="":"?? ",1:$E($P(^PSB(53.79,PSBIEN,0),U,9)_"  ",1,2)_" ")
"RTN","PSBOMT",108,0)
 S:$P(^PSB(53.79,PSBIEN,0),U,9)="" PSBUNK=1
"RTN","PSBOMT",109,0)
 S W=W_$E($P($G(^PSB(53.79,PSBIEN,.1)),U,2)_PSBSPC,1,2)_"  "
"RTN","PSBOMT",110,0)
 S W=W_$E($E($$GET1^DIQ(53.79,PSBIENS,.06),1,18)_PSBSPC,1,21)_" "
"RTN","PSBOMT",111,0)
 S W=W_$E($$GET1^DIQ(53.79,PSBIENS,"ACTION BY:INITIAL")_PSBSPC,1,10)_" ",PSBLGD("INITIALS",$$GET1^DIQ(53.79,PSBIENS,"ACTION BY","I"))=""
"RTN","PSBOMT",112,0)
 S W=W_$$GET1^DIQ(53.79,PSBIENS,.16)
"RTN","PSBOMT",113,0)
 D ADD(W)
"RTN","PSBOMT",114,0)
 K PSBV
"RTN","PSBOMT",115,0)
 F PSBNODE=.5,.6,.7 D
"RTN","PSBOMT",116,0)
 .S PSBDD=$S(PSBNODE=.5:53.795,PSBNODE=.6:53.796,1:53.797)
"RTN","PSBOMT",117,0)
 .F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBIEN,PSBNODE,PSBY)) Q:'PSBY  D
"RTN","PSBOMT",118,0)
 ..I $$GET1^DIQ(53.79,PSBIENS,.11)["V" S PSBV=1
"RTN","PSBOMT",119,0)
 ..D WRAPMEDS($$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.01),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.03),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.02),$$GET1^DIQ(PSBDD,PSBY_","_PSBIENS,.04))
"RTN","PSBOMT",120,0)
 I PSBCFLG=1 D COMNTS
"RTN","PSBOMT",121,0)
 D ADD("")
"RTN","PSBOMT",122,0)
 Q
"RTN","PSBOMT",123,0)
COMNTS ;
"RTN","PSBOMT",124,0)
 N Z,CNT
"RTN","PSBOMT",125,0)
 S Z="",CNT=0
"RTN","PSBOMT",126,0)
 I $D(^PSB(53.79,PSBIEN,.3,0)) D
"RTN","PSBOMT",127,0)
 .D ADD("")
"RTN","PSBOMT",128,0)
 .D ADD($J("",44)_"Comments: "_$$MAKELINE^PSBOMT1("-",78))
"RTN","PSBOMT",129,0)
 .S XT="" F  S XT=$O(^PSB(53.79,PSBIEN,.3,XT)) Q:XT=""  I XT'=0  D
"RTN","PSBOMT",130,0)
 ..D:CNT=1 ADD("")
"RTN","PSBOMT",131,0)
 ..S Y=$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",3) D DD^%DT S XBR=Y
"RTN","PSBOMT",132,0)
 ..S Z=XBR_"   "_$P(^VA(200,$P(^PSB(53.79,PSBIEN,.3,XT,0),"^",2),0),"^",2)
"RTN","PSBOMT",133,0)
 ..D WRAP($P(^PSB(53.79,PSBIEN,.3,XT,0),"^",1),Z,PSBIEN)
"RTN","PSBOMT",134,0)
 ..S CNT=1
"RTN","PSBOMT",135,0)
 .D ADD($J("",54)_$$MAKELINE^PSBOMT1("-",78))
"RTN","PSBOMT",136,0)
 Q
"RTN","PSBOMT",137,0)
WRAPMEDS(MED,UG,UO,UOA) ;
"RTN","PSBOMT",138,0)
 ;THIS WILL CREATE UPTO 3 LINES
"RTN","PSBOMT",139,0)
 S MED=$E(MED_$J("",40),1,40)
"RTN","PSBOMT",140,0)
 N UGWRAP,ORWRAP
"RTN","PSBOMT",141,0)
 S (CNTX,UOA1,UOA16,UOA31)=""
"RTN","PSBOMT",142,0)
 I +$G(UG)?1"."1.N S UG=0_+UG
"RTN","PSBOMT",143,0)
 I +$G(UO)?1"."1.N S UO=0_+UO
"RTN","PSBOMT",144,0)
 I $G(PSBV,0) S UO="NA"
"RTN","PSBOMT",145,0)
 F CNT=1:15:45  D
"RTN","PSBOMT",146,0)
 .D PARSE^PSBOMT1(UOA,CNT)
"RTN","PSBOMT",147,0)
 .S UGWRAP=$E(UG,CNT,(CNT+7)),UOWRAP=$E(UO,CNT,(CNT+7))
"RTN","PSBOMT",148,0)
 .I CNT=1 D ADD($J("",55)_MED_" "_$$PAD^PSBOMT1(UOWRAP,8)_" "_$$PAD^PSBOMT1(UGWRAP,8)_"  "_$$PAD^PSBOMT1(UOA1,15))
"RTN","PSBOMT",149,0)
 .I (CNT>1),($L(UGWRAP)>0!$L(@("UOA"_CNT))>0) D ADD($J("",94)_$$PAD^PSBOMT1(UOWRAP,8)_" "_$$PAD^PSBOMT1(UGWRAP,8)_"  "_$$PAD^PSBOMT1(@("UOA"_CNT),15))
"RTN","PSBOMT",150,0)
 Q
"RTN","PSBOMT",151,0)
HEADA ;
"RTN","PSBOMT",152,0)
 W !
"RTN","PSBOMT",153,0)
 W "Location",?21,"St Sch Administration Date",?50,"By",?61,"Injection Site",?96,"Units",?104,"Units",?113,"Units of"
"RTN","PSBOMT",154,0)
 W !,?55,"Medication & Dosage",?96,"Ordered",?104,"Given",?113,"Administration"
"RTN","PSBOMT",155,0)
 W !
"RTN","PSBOMT",156,0)
 W $$MAKELINE^PSBOMT1("-",132)
"RTN","PSBOMT",157,0)
 Q
"RTN","PSBOMT",158,0)
NONSTS(PSBX,PSBY) ;
"RTN","PSBOMT",159,0)
 D CLEAN^PSBVT,PSJ1^PSBVT(PSBX,$$GET1^DIQ(53.79,PSBY_",","ORDER REFERENCE NUMBER","I"))
"RTN","PSBOMT",160,0)
 Q PSBOCRIT'[PSBSCHT_"^"
"RTN","PSBOMT",161,0)
WRITEOT ;
"RTN","PSBOMT",162,0)
 D HDR^PSBOMT1
"RTN","PSBOMT",163,0)
 D MEDS
"RTN","PSBOMT",164,0)
 D PT^PSBOHDR(PSBXDFN,.PSBHDR),HEADA
"RTN","PSBOMT",165,0)
 I '$D(TMP("PSBIENS",$J)) D ADD("<<<< NO HISTORY FOUND FOR THIS TIME FRAME >>>>")
"RTN","PSBOMT",166,0)
 S EX="" F  S EX=$O(^TMP("PSB",$J,EX)) Q:EX=""  D
"RTN","PSBOMT",167,0)
 .I $Y>(IOSL-5) D
"RTN","PSBOMT",168,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOMT",169,0)
 ..D PT^PSBOHDR(PSBXDFN,.PSBHDR),HEADA
"RTN","PSBOMT",170,0)
 .W !,$G(^TMP("PSB",$J,EX))
"RTN","PSBOMT",171,0)
 D:$D(TMP("PSBIENS",$J)) LEGEND^PSBOMT1
"RTN","PSBOMT",172,0)
 D FTR^PSBOMT1
"RTN","PSBOMT",173,0)
 Q
"RTN","PSBOMT",174,0)
MEDS ;
"RTN","PSBOMT",175,0)
 N MED,XA,XB
"RTN","PSBOMT",176,0)
 S MED="",XB=$O(PSBHDR(""),-1)+1
"RTN","PSBOMT",177,0)
 S PSBHDR(XB)=PSBSRCHL
"RTN","PSBOMT",178,0)
 I PSBCLSS S XA=0 K PSBGOT F  S XA=$O(TMP("VA CLASS",$J,XA)) Q:+XA=0  D
"RTN","PSBOMT",179,0)
 .K ^TMP($J,"PSBLIST") D IEN^PSN50P65(XA,"??","PSBLIST")
"RTN","PSBOMT",180,0)
 .I ^TMP($J,"PSBLIST",0)>0 S MED=^TMP($J,"PSBLIST",XA,1) Q:$D(PSBGOT(MED))  K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",181,0)
 .I $L(PSBHDR(XB)_" "_$G(MED," * NO DATA FOUND * "))+3>IOM D  Q
"RTN","PSBOMT",182,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED S PSBGOT(MED)=""
"RTN","PSBOMT",183,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED,PSBGOT(MED)=""
"RTN","PSBOMT",184,0)
 I $D(PSBOIL) S XA="" K PSBGOT F  S XA=$O(PSBOIL(XA)) Q:XA=""  D
"RTN","PSBOMT",185,0)
 .S MED=$$GET1^DIQ(50.7,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",186,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",187,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",188,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",189,0)
 I $D(PSBADDL) S XA="" K PSBGOT F  S XA=$O(PSBADDL(XA)) Q:XA=""  D
"RTN","PSBOMT",190,0)
 .S MED=$$GET1^DIQ(52.6,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",191,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",192,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",193,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",194,0)
 I $D(PSBSOLL) S XA="" K PSBGOT F  S XA=$O(PSBSOLL(XA)) Q:XA=""  D
"RTN","PSBOMT",195,0)
 .S MED=$$GET1^DIQ(52.7,XA,.01) Q:$D(PSBGOT(MED))  S PSBGOT(MED)=""
"RTN","PSBOMT",196,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",197,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",198,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",199,0)
 I $D(PSBDDL) S XA="" F  S XA=$O(PSBDDL(XA)) Q:XA=""  D
"RTN","PSBOMT",200,0)
 .S MED=$$GET1^DIQ(50,XA,.01)
"RTN","PSBOMT",201,0)
 .I $L(PSBHDR(XB)_" / "_MED)+3>IOM D  Q
"RTN","PSBOMT",202,0)
 ..S XB=XB+1,PSBHDR(XB)="                         / "_MED
"RTN","PSBOMT",203,0)
 .S PSBHDR(XB)=PSBHDR(XB)_$S(($L(PSBHDR(XB),":")=2)&($P(PSBHDR(XB),":",2)=""):" ",1:" / ")_MED
"RTN","PSBOMT",204,0)
 Q
"RTN","PSBOMT",205,0)
WRAP(SIZE,ZP,BRIEN) ;
"RTN","PSBOMT",206,0)
 D ADD($J("",55)_ZP)
"RTN","PSBOMT",207,0)
 D ADD($J("",55)_$E(SIZE,1,75))
"RTN","PSBOMT",208,0)
 I $L(SIZE)>75 D ADD($J("",55)_$E(SIZE,76,150))
"RTN","PSBOMT",209,0)
 Q
"RTN","PSBOMT",210,0)
ADD(XE) ;
"RTN","PSBOMT",211,0)
 S ^TMP("PSB",$J,$O(^TMP("PSB",$J,""),-1)+1)=XE
"RTN","PSBOMT",212,0)
 Q
"RTN","PSBOMT",213,0)
GETDRN(IEN1) ;
"RTN","PSBOMT",214,0)
 ; Get the Drug IEN (p50) via OI IEN (p50.7)
"RTN","PSBOMT",215,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",216,0)
 D DRGIEN^PSS50P7(IEN1,,"PSBLIST")
"RTN","PSBOMT",217,0)
 S DN=$O(^TMP($J,"PSBLIST",0))
"RTN","PSBOMT",218,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",219,0)
 Q DN
"RTN","PSBOMT",220,0)
GETCLSS(IEN1) ;
"RTN","PSBOMT",221,0)
 ; Get the Items w/i VA Class
"RTN","PSBOMT",222,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",223,0)
 D VAC^PSS50(IEN1,,,"PSBLIST")
"RTN","PSBOMT",224,0)
 M PSBDDRG=^TMP($J,"PSBLIST")
"RTN","PSBOMT",225,0)
 K ^TMP($J,"PSBLIST")
"RTN","PSBOMT",226,0)
 Q
"RTN","PSBOMT1")
0^30^B30505207^n/a
"RTN","PSBOMT1",1,0)
PSBOMT1 ;BIRMINGHAM/TEJ-BCMA MEDICATION THERAPY REPORT ;Mar 2004
"RTN","PSBOMT1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**32**;Mar 2004;Build 32
"RTN","PSBOMT1",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOMT1",4,0)
 ;
"RTN","PSBOMT1",5,0)
 ; Reference/IA
"RTN","PSBOMT1",6,0)
 ; File 50.7/2880
"RTN","PSBOMT1",7,0)
 ; File 52.6/436
"RTN","PSBOMT1",8,0)
 ; File 52.7/437
"RTN","PSBOMT1",9,0)
 ; File 200/10060
"RTN","PSBOMT1",10,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBOMT1",11,0)
 ; IEN^PSN50P65/4543
"RTN","PSBOMT1",12,0)
 ; DRGIEN^PSS50P7/4662
"RTN","PSBOMT1",13,0)
 ; VAC^PSS50/4533
"RTN","PSBOMT1",14,0)
GETADSO ; GET ALL ADDITIVES FOR ALL ORDERABLE ITEMS
"RTN","PSBOMT1",15,0)
 K PSBAOUT,PSBSOUT
"RTN","PSBOMT1",16,0)
 S XA="" F  S XA=$O(PSBOIP("OIP",XA)) Q:XA=""  D
"RTN","PSBOMT1",17,0)
 .D LIST^DIC(52.6,"","@;15I","QPI","","","","AOI","","","PSBAOUT")
"RTN","PSBOMT1",18,0)
 .S XB=0 F  S XB=$O(PSBAOUT("DILIST",XB)) Q:XB=""  D
"RTN","PSBOMT1",19,0)
 ..I $P(PSBAOUT("DILIST",XB,0),"^",2)=XA D
"RTN","PSBOMT1",20,0)
 ...S TMP("PSBADDS",$J,$P(PSBAOUT("DILIST",XB,0),"^",1))=""
"RTN","PSBOMT1",21,0)
 K PSBAOUT
"RTN","PSBOMT1",22,0)
 ; GET ALL SOLUTIONS FOR ALL ORDERABLE ITEMS
"RTN","PSBOMT1",23,0)
 S XA="" F  S XA=$O(PSBOIP("OIP",XA)) Q:XA=""  D
"RTN","PSBOMT1",24,0)
 .D LIST^DIC(52.7,"","@;9I","QPI","","","","AOI","","","PSBSOUT")
"RTN","PSBOMT1",25,0)
 .S XB=0 F  S XB=$O(PSBSOUT("DILIST",XB)) Q:XB=""  D
"RTN","PSBOMT1",26,0)
 ..I $P(PSBSOUT("DILIST",XB,0),"^",2)=XA D
"RTN","PSBOMT1",27,0)
 ...S TMP("PSBSOLS",$J,$P(PSBSOUT("DILIST",XB,0),"^",1))=""
"RTN","PSBOMT1",28,0)
 K PSBSOUT
"RTN","PSBOMT1",29,0)
 Q
"RTN","PSBOMT1",30,0)
FINDIENS ; USE PSBOIS,PSBADDS AND PSBSOLS TO FIND ALL IENS FOR THE RPT
"RTN","PSBOMT1",31,0)
 ;SEARCH FOR UNIT DOSE IENS
"RTN","PSBOMT1",32,0)
 I $D(TMP("PSBOIS",$J)) S XA="" F  S XA=$O(TMP("PSBOIS",$J,XA)) Q:XA=""  D
"RTN","PSBOMT1",33,0)
 .S PSBDT=PSBSTRT F  S PSBDT=$O(^PSB(53.79,"AOIP",PSBXDFN,XA,PSBDT)) Q:PSBDT=""!(PSBDT>PSBSTOP)  D
"RTN","PSBOMT1",34,0)
 ..S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP",PSBXDFN,XA,PSBDT,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOMT1",35,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOMT1",36,0)
 ...S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOMT1",37,0)
 ;SEARCH FOR ADDITIVES
"RTN","PSBOMT1",38,0)
 I $D(TMP("PSBADDS",$J)) S XA="" F  S XA=$O(TMP("PSBADDS",$J,XA)) Q:XA=""  D
"RTN","PSBOMT1",39,0)
 .S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP3",PSBXDFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOMT1",40,0)
 ..S XB="" F  S XB=$O(^PSB(53.79,"AOIP3",PSBXDFN,PSBIEN,XB)) Q:XB=""  D
"RTN","PSBOMT1",41,0)
 ...Q:XB'=XA
"RTN","PSBOMT1",42,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOMT1",43,0)
 ...I $P(^PSB(53.79,PSBIEN,0),"^",6)>PSBSTRT,($P(^PSB(53.79,PSBIEN,0),"^",6)<PSBSTOP)  D
"RTN","PSBOMT1",44,0)
 ....S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOMT1",45,0)
 ;SEARCH FOR SOLUTIONS
"RTN","PSBOMT1",46,0)
 I $D(TMP("PSBSOLS",$J)) S XA="" F  S XA=$O(TMP("PSBSOLS",$J,XA)) Q:XA=""  D
"RTN","PSBOMT1",47,0)
 .S PSBIEN="" F  S PSBIEN=$O(^PSB(53.79,"AOIP4",PSBXDFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOMT1",48,0)
 ..S XB="" F  S XB=$O(^PSB(53.79,"AOIP4",PSBXDFN,PSBIEN,XB)) Q:XB=""  D
"RTN","PSBOMT1",49,0)
 ...Q:XB'=XA
"RTN","PSBOMT1",50,0)
 ...Q:$P(^PSB(53.79,PSBIEN,0),U,9)="N"
"RTN","PSBOMT1",51,0)
 ...I $P(^PSB(53.79,PSBIEN,0),"^",6)>PSBSTRT,($P(^PSB(53.79,PSBIEN,0),"^",6)<PSBSTOP)  D
"RTN","PSBOMT1",52,0)
 ....S TMP("PSBIENS",$J,$$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),PSBIEN)=""
"RTN","PSBOMT1",53,0)
 Q
"RTN","PSBOMT1",54,0)
HDR ;  Header
"RTN","PSBOMT1",55,0)
 W:$Y>1 @IOF
"RTN","PSBOMT1",56,0)
 W:$X>1 !
"RTN","PSBOMT1",57,0)
 S PSBRPNM="BCMA MEDICATION THERAPY REPORT"
"RTN","PSBOMT1",58,0)
 S PSBPGNUM=1,PSBOUTP(0)="",PSBRPT(0)=""
"RTN","PSBOMT1",59,0)
 S PSBPG="Page: "_PSBPGNUM_" of "_$S($O(PSBOUTP(""),-1)=0:1,1:$O(PSBOUTP(""),-1))
"RTN","PSBOMT1",60,0)
 I $P(PSBRPT(0),U,4)="" S $P(PSBRPT(0),U,4)=DUZ(2)
"RTN","PSBOMT1",61,0)
 S PSBPGRM=IOM-($L(PSBPG))
"RTN","PSBOMT1",62,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOMT1",63,0)
 .K PSBHDR
"RTN","PSBOMT1",64,0)
 .S PSBHDR(1)="BCMA MEDICATION THERAPY REPORT for "
"RTN","PSBOMT1",65,0)
 .S Y=$P(PSBRPT(.1),U,6) D D^DIQ S PSBHDR(1)=PSBHDR(1)_Y_"@" S Y=$P(PSBRPT(.1),U,7) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)_" to "
"RTN","PSBOMT1",66,0)
 .S Y=$P(PSBRPT(.1),U,8) D D^DIQ S PSBHDR(1)=PSBHDR(1)_Y_"@" S Y=$P(PSBRPT(.1),U,9) S PSBHDR(1)=PSBHDR(1)_$E(Y_"0000",2,5)
"RTN","PSBOMT1",67,0)
 .S PSBHDR(2)="Schedule Type(s): --"
"RTN","PSBOMT1",68,0)
 .F Y=1:1:4 I $P(PSBRPT(.2),U,Y) S $P(PSBHDR(2),": ",2)=$P(PSBHDR(2),": ",2)_$S(PSBHDR(2)["--":"",1:"/ ")_$P("Continuous^PRN^On-Call^One-Time",U,Y)_" " S PSBHDR(2)=$TR(PSBHDR(2),"-","")
"RTN","PSBOMT1",69,0)
 .I PSBCFLG S PSBHDR(3)="Include Comments" S PSBHDR(4)=" "
"RTN","PSBOMT1",70,0)
 .E  S PSBHDR(3)=" "
"RTN","PSBOMT1",71,0)
 Q
"RTN","PSBOMT1",72,0)
LEGEND ; Report Legend
"RTN","PSBOMT1",73,0)
 K PSBLGDO
"RTN","PSBOMT1",74,0)
 S PSBLGD("ORDER TYPES","C")="Continuous"
"RTN","PSBOMT1",75,0)
 S PSBLGD("ORDER TYPES","O")="One Time"
"RTN","PSBOMT1",76,0)
 S PSBLGD("ORDER TYPES","OC")="On Call"
"RTN","PSBOMT1",77,0)
 S PSBLGD("ORDER TYPES","P")="PRN (As Needed)"
"RTN","PSBOMT1",78,0)
 S PSB=0 F  S PSB=$O(PSBLGD("INITIALS",PSB)) Q:+PSB=0  D
"RTN","PSBOMT1",79,0)
 .S PSBINIT=$$GET1^DIQ(200,PSB_",","INITIAL"),PSBLGD("INITIALS",$S(PSBINIT']" ":"*n/a*",1:PSBINIT))=$$GET1^DIQ(200,PSB_",","NAME")
"RTN","PSBOMT1",80,0)
 .K PSBLGD("INITIALS",PSB)
"RTN","PSBOMT1",81,0)
 S PSBLGDO(0)="REPORT LEGEND"
"RTN","PSBOMT1",82,0)
 S PSBLGDO(1)=""
"RTN","PSBOMT1",83,0)
 S PSBLGDO(2)=$S($G(PSBNO,0):"",1:"SCHEDULE TYPES")
"RTN","PSBOMT1",84,0)
 S PSBLGDO(3)=""
"RTN","PSBOMT1",85,0)
 I '$G(PSBNO,0) S X1="",X2=3 F  S X1=$O(PSBLGD("ORDER TYPES",X1)) Q:X1=""  S X2=X2+1,PSBLGDO(X2)=X1,$E(PSBLGDO(X2),5)="- "_PSBLGD("ORDER TYPES",X1)
"RTN","PSBOMT1",86,0)
 I $D(PSBLGD("INITIALS")) S $E(PSBLGDO(2),35)="INITIALS" S X1="",X2=3 F  S X1=$O(PSBLGD("INITIALS",X1)) Q:X1=""  S X2=X2+1,$E(PSBLGDO(X2),35)=X1,$E(PSBLGDO(X2),40)="- "_PSBLGD("INITIALS",X1)
"RTN","PSBOMT1",87,0)
 I ($Y+$O(PSBLGDO(""),-1))>(IOSL-12) D
"RTN","PSBOMT1",88,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOMT1",89,0)
 .D PT^PSBOHDR(PSBXDFN,.PSBHDR)
"RTN","PSBOMT1",90,0)
 I IOSL<1000 F  Q:($Y+$O(PSBLGDO(""),-1)+12)>IOSL  W !
"RTN","PSBOMT1",91,0)
 W !,$TR($J("",IOM)," ","="),!
"RTN","PSBOMT1",92,0)
 F X1=$O(PSBLGDO("")):1:$O(PSBLGDO(""),-1) W !,PSBLGDO(X1)
"RTN","PSBOMT1",93,0)
 W !!,$TR($J("",IOM)," ","="),!
"RTN","PSBOMT1",94,0)
 Q
"RTN","PSBOMT1",95,0)
FTR ;
"RTN","PSBOMT1",96,0)
 I (IOSL<100) F  Q:$Y>(IOSL-6)  W !
"RTN","PSBOMT1",97,0)
 W !,$TR($J("",IOM)," ","=")
"RTN","PSBOMT1",98,0)
 S X="Ward: "_PSBHDR("WARD")_"  Room-Bed: "_PSBHDR("ROOM")
"RTN","PSBOMT1",99,0)
 W !,PSBHDR("NAME"),?(IOM-11\2),PSBHDR("SSN"),?(IOM-$L(X)),X
"RTN","PSBOMT1",100,0)
 W !,"BCMA MEDICATION THERAPY REPORT",?(IOM-$L(PSBDTTM)),PSBDTTM
"RTN","PSBOMT1",101,0)
 Q
"RTN","PSBOMT1",102,0)
MAKELINE(X,CNT) ;LINE OF WHAT'S PASSED IN CNT TIMES
"RTN","PSBOMT1",103,0)
 N Y,Z
"RTN","PSBOMT1",104,0)
 S Y=""
"RTN","PSBOMT1",105,0)
 F Z=1:1:CNT S Y=Y_X
"RTN","PSBOMT1",106,0)
 Q Y
"RTN","PSBOMT1",107,0)
 ;
"RTN","PSBOMT1",108,0)
PARSE(X,CNT) ;Split text for wrapping.
"RTN","PSBOMT1",109,0)
 S CNTX="UOA"_CNT,@CNTX=@CNTX_$E(X,CNT,(CNT+14)),UOAX=""
"RTN","PSBOMT1",110,0)
 F  S:$F(@CNTX,", ",+UOAX)>0 UOAX=$F(@CNTX,", ",+UOAX)  Q:'$F(@CNTX,", ",+UOAX)
"RTN","PSBOMT1",111,0)
 I UOAX<1 F  S:$F(@CNTX," ",+UOAX)>0 UOAX=$F(@CNTX," ",+UOAX)  Q:'$F(@CNTX," ",+UOAX)
"RTN","PSBOMT1",112,0)
 I UOAX>1,(($L(UOA)-(CNT+14))>0) S CNTXX=$E(@CNTX,1,UOAX-1),@("UOA"_(CNT+15))=$E(@CNTX,UOAX,UOAX+14),@CNTX=CNTXX
"RTN","PSBOMT1",113,0)
 Q
"RTN","PSBOMT1",114,0)
 ;
"RTN","PSBOMT1",115,0)
PAD(X,CNT) ;
"RTN","PSBOMT1",116,0)
 Q $E(X_$J("",CNT),1,CNT)
"RTN","PSBOMT1",117,0)
 ;
"RTN","PSBOMT1",118,0)
CLEANALL ; KILL ALL TMP LEVELS USED VARIABLES
"RTN","PSBOMT1",119,0)
 K ^TMP("PSB",$J),^TMP("PSJ1",$J),PSBOIP,TMP("PSBADDS",$J),TMP("PSBSOLS",$J)
"RTN","PSBOMT1",120,0)
 K TMP("PSBIENS",$J)
"RTN","PSBOMT1",121,0)
 Q
"RTN","PSBOMT1",122,0)
 ;
"RTN","PSBOMT1",123,0)
CLEANSUM ; KILL ALL BUN THE "PSBIENS" LEVEL
"RTN","PSBOMT1",124,0)
 K ^TMP("PSB",$J),^TMP("PSJ1",$J),TMP("PSBIENS",$J),TMP("PSBOIS",$J),TMP("PSBADDS",$J),TMP("PSBSOLS",$J)
"RTN","PSBOMT1",125,0)
 Q
"RTN","PSBOPE")
0^17^B17458484^B17297866
"RTN","PSBOPE",1,0)
PSBOPE ;BIRMINGHAM/EFC-PRN EFFECTIVENESS WORKSHEET ;Mar 2004
"RTN","PSBOPE",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,23,32**;Mar 2004;Build 32
"RTN","PSBOPE",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOPE",4,0)
 ;
"RTN","PSBOPE",5,0)
 ; Reference/IA
"RTN","PSBOPE",6,0)
 ; ^DPT/10035
"RTN","PSBOPE",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOPE",8,0)
 ;
"RTN","PSBOPE",9,0)
EN ; Called from DQ^PSBO
"RTN","PSBOPE",10,0)
 N PSBSTRT,PSBSTOP,DFN
"RTN","PSBOPE",11,0)
 K ^TMP("PSB",$J)
"RTN","PSBOPE",12,0)
 S PSBSTRT=$P(PSBRPT(.1),U,6)+$P(PSBRPT(.1),U,7)
"RTN","PSBOPE",13,0)
 S PSBSTOP=$P(PSBRPT(.1),U,8)+$P(PSBRPT(.1),U,9)
"RTN","PSBOPE",14,0)
 F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,DFN)) Q:'DFN  D EN1
"RTN","PSBOPE",15,0)
 D PRINT
"RTN","PSBOPE",16,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOPE",17,0)
 Q
"RTN","PSBOPE",18,0)
 ;
"RTN","PSBOPE",19,0)
EN1 ; Expects DFN,PSBSTRT,PSBSTOP from EN
"RTN","PSBOPE",20,0)
 N PSBGBL,PSBHDR,PSBX,PSBADMIN,PSBDFN,PSBDT,PSBMED,PSBORD,PSBOSTRT,PSBSCHED
"RTN","PSBOPE",21,0)
 K ^TMP("PSJ",$J)
"RTN","PSBOPE",22,0)
 S PSBDT=PSBSTRT-.0000001
"RTN","PSBOPE",23,0)
 F  S PSBDT=$O(^PSB(53.79,"AADT",DFN,PSBDT)) Q:'PSBDT!(PSBDT>PSBSTOP)  D
"RTN","PSBOPE",24,0)
 .S PSBIEN=0
"RTN","PSBOPE",25,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBDT,PSBIEN)) Q:'PSBIEN  D
"RTN","PSBOPE",26,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,.1)),U,2)'="P"  ; Not a PRN Administration
"RTN","PSBOPE",27,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,.2)),U,2)]""  ; Effectiveness entered
"RTN","PSBOPE",28,0)
 ..Q:($P($G(^PSB(53.79,PSBIEN,0)),U,9)'="G")&($P($G(^PSB(53.79,PSBIEN,0)),U,9)'="RM")  ;Allow only entries with at status of "GIVEN" and "REMOVED"
"RTN","PSBOPE",29,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,0)),U,6)<PSBDT
"RTN","PSBOPE",30,0)
 ..Q:$P($G(^PSB(53.79,PSBIEN,0)),U,6)>PSBSTOP
"RTN","PSBOPE",31,0)
 ..S ^TMP("PSB",$J,DFN,PSBIEN)=""
"RTN","PSBOPE",32,0)
 Q
"RTN","PSBOPE",33,0)
PRINT ; Print meds stored in ^TMP("PSB",$J,DFN,....
"RTN","PSBOPE",34,0)
 N PSBHDR,PSBDT,PSBMED,DFN
"RTN","PSBOPE",35,0)
 ;
"RTN","PSBOPE",36,0)
 ; Print by Patient
"RTN","PSBOPE",37,0)
 ;
"RTN","PSBOPE",38,0)
 D:$P(PSBRPT(.1),U,1)="P"
"RTN","PSBOPE",39,0)
 .S PSBHDR(1)="PRN EFFECTIVENESS LIST for "_$$FMTE^XLFDT(PSBSTRT)_" to "_$$FMTE^XLFDT(PSBSTOP)
"RTN","PSBOPE",40,0)
 .S DFN=$P(PSBRPT(.1),U,2)
"RTN","PSBOPE",41,0)
 .W $$PTHDR()
"RTN","PSBOPE",42,0)
 .I '$O(^TMP("PSB",$J,DFN,0)) W !,"No PRN Medications Found",$$PTFTR^PSBOHDR() Q
"RTN","PSBOPE",43,0)
 .W !  ; Line Break Between Admin Times
"RTN","PSBOPE",44,0)
 .S PSBIEN=""
"RTN","PSBOPE",45,0)
 .F  S PSBIEN=$O(^TMP("PSB",$J,DFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPE",46,0)
 ..S PSBIENS=PSBIEN_","
"RTN","PSBOPE",47,0)
 ..I $Y>(IOSL-5) W $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOPE",48,0)
 ..W !,$$GET1^DIQ(53.79,PSBIENS,.06),?30,$$GET1^DIQ(53.79,PSBIENS,.08),?72,$$GET1^DIQ(53.79,PSBIENS,"ACTION BY")
"RTN","PSBOPE",49,0)
 ..W !,?5,"PRN Reason: ",$$GET1^DIQ(53.79,PSBIENS,.21)
"RTN","PSBOPE",50,0)
 .W $$PTFTR^PSBOHDR()
"RTN","PSBOPE",51,0)
 .Q
"RTN","PSBOPE",52,0)
 ;
"RTN","PSBOPE",53,0)
 ; Print by Ward
"RTN","PSBOPE",54,0)
 ;
"RTN","PSBOPE",55,0)
 D:$P(PSBRPT(.1),U,1)="W"
"RTN","PSBOPE",56,0)
 .S PSBHDR(1)="PRN EFFECTIVENESS LIST  from "_$$FMTE^XLFDT(PSBSTRT)_" thru "_$$FMTE^XLFDT(PSBSTOP)
"RTN","PSBOPE",57,0)
 .S PSBWARD=$P(PSBRPT(.1),U,3)
"RTN","PSBOPE",58,0)
 .W $$WRDHDR()
"RTN","PSBOPE",59,0)
 .I '$O(^TMP("PSB",$J,0)) W !,"No PRN Medications Found" Q
"RTN","PSBOPE",60,0)
 .S PSBSORT=$P(PSBRPT(.1),U,5)
"RTN","PSBOPE",61,0)
 .F DFN=0:0 S DFN=$O(^TMP("PSB",$J,DFN)) Q:'DFN  D
"RTN","PSBOPE",62,0)
 ..S PSBINDX=$S(PSBSORT="P":$P(^DPT(DFN,0),U),1:$G(^DPT(DFN,.1))_" "_$G(^DPT(DFN,.101)))  ;PSB*3*23
"RTN","PSBOPE",63,0)
 ..S:PSBINDX="" PSBINDX=$P(^DPT(DFN,0),U)
"RTN","PSBOPE",64,0)
 ..S ^TMP("PSB",$J,"B",PSBINDX,DFN)=""
"RTN","PSBOPE",65,0)
 .S PSBINDX=""
"RTN","PSBOPE",66,0)
 .F  S PSBINDX=$O(^TMP("PSB",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOPE",67,0)
 ..F DFN=0:0 S DFN=$O(^TMP("PSB",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOPE",68,0)
 ...W ! ; Line Break Between Pt's
"RTN","PSBOPE",69,0)
 ...W:$P(PSBRPT(.1),U,5)="P" !,$$GET1^DIQ(2,DFN_",",.01),?32,$$GET1^DIQ(2,DFN_",",.1),"  ",$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBOPE",70,0)
 ...W:$P(PSBRPT(.1),U,5)="B" !,$$GET1^DIQ(2,DFN_",",.1),"  ",$$GET1^DIQ(2,DFN_",",.101),?20,$$GET1^DIQ(2,DFN_",",.01)
"RTN","PSBOPE",71,0)
 ...W !  ; Line Break Between Admin Times
"RTN","PSBOPE",72,0)
 ...S PSBIEN=""
"RTN","PSBOPE",73,0)
 ...F  S PSBIEN=$O(^TMP("PSB",$J,DFN,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBOPE",74,0)
 ....I $Y>(IOSL-5) W $$WRDHDR()
"RTN","PSBOPE",75,0)
 ....W !?5,$$GET1^DIQ(53.79,PSBIEN_",",.06),?35,$$GET1^DIQ(53.79,PSBIEN_",",.08),?77,$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY")
"RTN","PSBOPE",76,0)
 ....W !?10,"PRN Reason: ",$$GET1^DIQ(53.79,PSBIEN_",",.21)
"RTN","PSBOPE",77,0)
 Q
"RTN","PSBOPE",78,0)
 ;
"RTN","PSBOPE",79,0)
WRDHDR() ; Ward Header
"RTN","PSBOPE",80,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOPE",81,0)
 W:$P(PSBRPT(.1),U,5)="B" !,"Ward Rm-Bed",?20,"Patient"
"RTN","PSBOPE",82,0)
 W:$P(PSBRPT(.1),U,5)="P" !,"Patient",?32,"Ward Rm-Bed"
"RTN","PSBOPE",83,0)
 W !?5,"Administration Date/Time",?35,"Medication",?77,"Administered By"
"RTN","PSBOPE",84,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOPE",85,0)
 Q ""
"RTN","PSBOPE",86,0)
 ;
"RTN","PSBOPE",87,0)
PTHDR() ; Patient Header
"RTN","PSBOPE",88,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOPE",89,0)
 W !,"Administration Date/Time",?30,"Medication",?72,"Administered By"
"RTN","PSBOPE",90,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOPE",91,0)
 Q ""
"RTN","PSBOPE",92,0)
 ;
"RTN","PSBOWA")
0^18^B50135116^B46771592
"RTN","PSBOWA",1,0)
PSBOWA ;BIRMINGHAM/EFC-WARD ADMINISTRATION TIMES ;Mar 2004
"RTN","PSBOWA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**9,32**;Mar 2004;Build 32
"RTN","PSBOWA",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBOWA",4,0)
 ;
"RTN","PSBOWA",5,0)
 ; Reference/IA
"RTN","PSBOWA",6,0)
 ; ^DPT/10035
"RTN","PSBOWA",7,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOWA",8,0)
EN ;
"RTN","PSBOWA",9,0)
 N PSBHDR,PSBGTOT,PSBTOT,PSBINDX,DFN,PSBX,PSBY,PSBSM,PSBADST,PSBZ
"RTN","PSBOWA",10,0)
 S (Y,PSBEVDT)=$P(PSBRPT(.1),U,6) D D^DIQ
"RTN","PSBOWA",11,0)
 S PSBHDR(2)="ADMINISTRATION DATE: "_Y
"RTN","PSBOWA",12,0)
 S (Y,PSBEVDT2)=$S($P(PSBRPT(.1),U,8)']"":PSBEVDT,1:$P(PSBRPT(.1),U,8)) D D^DIQ
"RTN","PSBOWA",13,0)
 S PSBHDR(2)=PSBHDR(2)_" to "_Y
"RTN","PSBOWA",14,0)
 F PSBIX=0:1 S PSBRPDT=$$FMADD^XLFDT(PSBEVDT,PSBIX) Q:PSBRPDT>PSBEVDT2  D
"RTN","PSBOWA",15,0)
 .D:$P(PSBRPT(.1),U)="W"
"RTN","PSBOWA",16,0)
 ..F X=0,.01:.01:.24 S PSBGTOT(X)=""
"RTN","PSBOWA",17,0)
 ..W $$WRDHDR()
"RTN","PSBOWA",18,0)
 ..S PSBINDX=""
"RTN","PSBOWA",19,0)
 ..F  S PSBINDX=$O(^TMP("PSBO",$J,"B",PSBINDX)) Q:PSBINDX=""  D
"RTN","PSBOWA",20,0)
 ...F DFN=0:0 S DFN=$O(^TMP("PSBO",$J,"B",PSBINDX,DFN)) Q:'DFN  D
"RTN","PSBOWA",21,0)
 ....W:$Y>(IOSL-10) $$WRDHDR()
"RTN","PSBOWA",22,0)
 ....W !,$P(^DPT(DFN,0),U,1),!,"SSN: ",$P(^(0),U,9)
"RTN","PSBOWA",23,0)
 ....W !,"Ward: ",$E($G(^DPT(DFN,.1)),1,25),!,"Room-Bed:  ",$E($G(^(.101)),1,21)
"RTN","PSBOWA",24,0)
 ....W ?32
"RTN","PSBOWA",25,0)
 ....F X=0,.01:.01:.24 S PSBTOT(X)=""
"RTN","PSBOWA",26,0)
 ....K ^TMP("PSJ",$J)
"RTN","PSBOWA",27,0)
 ....D EN^PSJBCMA(DFN,$P(PSBRPT(.1),U,6))
"RTN","PSBOWA",28,0)
 ....F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",29,0)
 .....Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",30,0)
 .....D CLEAN^PSBVT
"RTN","PSBOWA",31,0)
 .....D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",32,0)
 .....Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",33,0)
 .....Q:PSBOSTS'="A"&(PSBOSTS'="R")  ; Active?
"RTN","PSBOWA",34,0)
 .....Q:PSBSM=1  ;Self med?
"RTN","PSBOWA",35,0)
 .....S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",36,0)
 .....S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",37,0)
 .....S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",38,0)
 .....F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",39,0)
 .....I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",40,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",41,0)
 .....I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",42,0)
 .....I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",43,0)
 .....I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",44,0)
 .....I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",45,0)
 .....I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",46,0)
 .....I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",47,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",48,0)
 .....I +PSBFREQ>0 D
"RTN","PSBOWA",49,0)
 ......I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",50,0)
 .....I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",51,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",52,0)
 .....K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",53,0)
 .....I PSBADST="" S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBRPDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",54,0)
 .....E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",55,0)
 .....Q:PSBADST=""
"RTN","PSBOWA",56,0)
 .....I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,$P(PSBRPT(.1),U,6),PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",57,0)
 .....I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,$P(PSBRPT(.1),U,6),PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",58,0)
 .....F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",59,0)
 ......F Y=1:1:$L(PSBADST,"-") S Z=+("."_$E($P(PSBADST,"-",Y),1,2)) D
"RTN","PSBOWA",60,0)
 .......Q:(($P(PSBRPT(.1),U,6)+Z)<$E(PSBOST,1,12))&($G(Z)'=0)  ;Start Date
"RTN","PSBOWA",61,0)
 .......Q:($P(PSBRPT(.1),U,6)+Z)'<$E(PSBOSP,1,12)  ;Stop Date
"RTN","PSBOWA",62,0)
 .......;For invalid admin times
"RTN","PSBOWA",63,0)
 .......D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",64,0)
 ........D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",65,0)
 .......S PSBTOT(Z)=PSBTOT(Z)+1
"RTN","PSBOWA",66,0)
 .......S PSBGTOT(Z)=PSBGTOT(Z)+1
"RTN","PSBOWA",67,0)
 ....S PSBX="" F  S PSBX=$O(PSBTOT(PSBX)) Q:$G(PSBX)=""  W $J(PSBTOT(PSBX),4)
"RTN","PSBOWA",68,0)
 ....W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",69,0)
 ..W !!,$TR($J("",IOM)," ","=")
"RTN","PSBOWA",70,0)
 ..W !?32 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",71,0)
 ..W !,"Hourly Totals:",?32
"RTN","PSBOWA",72,0)
 ..S PSBGTOT=0
"RTN","PSBOWA",73,0)
 ..S PSBX="" F  S PSBX=$O(PSBGTOT(PSBX)) Q:$G(PSBX)=""  D
"RTN","PSBOWA",74,0)
 ...W $J(PSBGTOT(PSBX),4)
"RTN","PSBOWA",75,0)
 ...S PSBGTOT=PSBGTOT+PSBGTOT(PSBX)
"RTN","PSBOWA",76,0)
 ..W !!,"Ward Total:",?32,$J(PSBGTOT,4)
"RTN","PSBOWA",77,0)
 ..W !!,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",78,0)
 ..K ^TMP("PSJ",$J)
"RTN","PSBOWA",79,0)
 .D:$P(PSBRPT(.1),U)="P"
"RTN","PSBOWA",80,0)
 ..S DFN=PSBDFN
"RTN","PSBOWA",81,0)
 ..S PSBHDR(1)="WARD ADMINISTRATION TIMES"
"RTN","PSBOWA",82,0)
 ..S Y=$P(PSBRPT(.1),U,6) D D^DIQ S PSBHDR(2)="ADMINISTRATION DATE: "_Y
"RTN","PSBOWA",83,0)
 ..S Y=PSBEVDT2 D D^DIQ S PSBHDR(2)=PSBHDR(2)_" to "_Y
"RTN","PSBOWA",84,0)
 ..W $$PTHDR()
"RTN","PSBOWA",85,0)
 ..K ^TMP("PSJ",$J),PSBTOT
"RTN","PSBOWA",86,0)
 ..D EN^PSJBCMA(PSBDFN,PSBRPDT,"")
"RTN","PSBOWA",87,0)
 ..F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:'PSBX  D
"RTN","PSBOWA",88,0)
 ...Q:^TMP("PSJ",$J,PSBX,0)=-1  ; No Orders
"RTN","PSBOWA",89,0)
 ...D CLEAN^PSBVT
"RTN","PSBOWA",90,0)
 ...D PSJ^PSBVT(PSBX)
"RTN","PSBOWA",91,0)
 ...Q:PSBSCHT'="C"  ; Not a Continuous
"RTN","PSBOWA",92,0)
 ...Q:PSBOSTS'="A"&(PSBOSTS'="R")  ; Active?
"RTN","PSBOWA",93,0)
 ...S (PSBCADM,PSBYES,PSBODD)=0
"RTN","PSBOWA",94,0)
 ...S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBOWA",95,0)
 ...S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBOWA",96,0)
 ...F I=1:1 Q:$P(PSBSCH,"-",I)=""  I ($P(PSBSCH,"-",I)?2N)!($P(PSBSCH,"-",I)?4N) S PSBYES=1
"RTN","PSBOWA",97,0)
 ...I PSBYES,PSBADST="",PSBSCHT'="O",PSBSCHT'="OC",PSBSCHT'="P" D  Q
"RTN","PSBOWA",98,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH)
"RTN","PSBOWA",99,0)
 ...I "PCS"'[PSBIVT,PSBONX'["U" Q
"RTN","PSBOWA",100,0)
 ...I PSBIVT["S",PSBISYR'=1 Q  ;    allow intermittent syringe only
"RTN","PSBOWA",101,0)
 ...I PSBIVT["C",PSBCHEMT'="P",PSBISYR'=1 Q
"RTN","PSBOWA",102,0)
 ...I PSBIVT["C",PSBCHEMT="A" Q  ;     allow Chemo with intermittent syringe or Piggyback type only
"RTN","PSBOWA",103,0)
 ...I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBOWA",104,0)
 ...I 'PSBYES,PSBFREQ<1 D  Q
"RTN","PSBOWA",105,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH)
"RTN","PSBOWA",106,0)
 ...I +PSBFREQ>0 D
"RTN","PSBOWA",107,0)
 ....I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBOWA",108,0)
 ...I PSBODD,PSBADST'="" D  Q
"RTN","PSBOWA",109,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH)
"RTN","PSBOWA",110,0)
 ...K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBOWA",111,0)
 ...I PSBADST="",+$G(PSBFREQ)>0,$G(PSBFREQ)<30 S PSBADST="MESSAGE",$P(PSBTOT(PSBADST,PSBOITX,PSBONX),2)="Due every "_PSBFREQ_" Mins" Q
"RTN","PSBOWA",112,0)
 ...I PSBADST="",+$G(PSBFREQ)'<30 S PSBADST=$$GETADMIN^PSBVDLU1(DFN,PSBONX,PSBOST,PSBFREQ,PSBRPDT) S:PSBADST'="" PSBCADM=1
"RTN","PSBOWA",113,0)
 ...E  S ^TMP("PSB",$J,"GETADMIN",0)=PSBADST
"RTN","PSBOWA",114,0)
 ...Q:PSBADST=""
"RTN","PSBOWA",115,0)
 ...I PSBONX'["V" D  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",116,0)
 ...I PSBONX["V",PSBSCH'=""  Q:'$$OKAY^PSBVDLU1(PSBOST,PSBRPDT,PSBSCH,PSBONX,PSBOIT,PSBFREQ)
"RTN","PSBOWA",117,0)
 ...F PSBXX=0:1 Q:'$D(^TMP("PSB",$J,"GETADMIN",PSBXX))  S PSBADST=$G(^TMP("PSB",$J,"GETADMIN",PSBXX)) D
"RTN","PSBOWA",118,0)
 ....F Y=1:1:$L(PSBADST,"-") S Z=+("."_$P(PSBADST,"-",Y)) D
"RTN","PSBOWA",119,0)
 .....Q:(PSBRPDT+Z)<$E(PSBOST,1,12)  ; Start Date
"RTN","PSBOWA",120,0)
 .....Q:(PSBRPDT+Z)'<$E(PSBOSP,1,12)  ; Stop Date
"RTN","PSBOWA",121,0)
 .....;For Invalid admin times
"RTN","PSBOWA",122,0)
 .....D:($P(PSBADST,"-",Y)'?2N)&($P(PSBADST,"-",Y)'?4N)
"RTN","PSBOWA",123,0)
 ......D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBOWA",124,0)
 .....S PSBSM=$S(PSBHSM=1:"HSM",PSBSM=1:"SM",1:"")
"RTN","PSBOWA",125,0)
 .....;*** Local array to include order no
"RTN","PSBOWA",126,0)
 .....S PSBTOT(Z,PSBOITX,PSBONX)=PSBSM_U_"Dosage: "_PSBDOSE_"  Route: "_PSBMR_"  "_PSBIFR
"RTN","PSBOWA",127,0)
 ..S PSBX="" F  S PSBX=$O(PSBTOT(PSBX)) Q:PSBX=""  D
"RTN","PSBOWA",128,0)
 ...W !
"RTN","PSBOWA",129,0)
 ...S PSBY="" F  S PSBY=$O(PSBTOT(PSBX,PSBY)) Q:PSBY=""  D
"RTN","PSBOWA",130,0)
 ....S PSBZ="" F  S PSBZ=$O(PSBTOT(PSBX,PSBY,PSBZ)) Q:PSBZ=""  D
"RTN","PSBOWA",131,0)
 .....W:$Y>(IOSL-6) $$PTFTR^PSBOHDR(),$$PTHDR()
"RTN","PSBOWA",132,0)
 .....I PSBX="MESSAGE" W !,$P(PSBTOT(PSBX,PSBY,PSBZ),U,1),?20,PSBY Q
"RTN","PSBOWA",133,0)
 .....W !,$$TIMEOUT^PSBUTL(PSBX),?10
"RTN","PSBOWA",134,0)
 .....W $P(PSBTOT(PSBX,PSBY,PSBZ),U,1),?20,PSBY,?55,$P(PSBTOT(PSBX,PSBY,PSBZ),U,2)
"RTN","PSBOWA",135,0)
 ..W $$PTFTR^PSBOHDR()
"RTN","PSBOWA",136,0)
 .K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOWA",137,0)
 .Q
"RTN","PSBOWA",138,0)
 ;
"RTN","PSBOWA",139,0)
WRDHDR() ;
"RTN","PSBOWA",140,0)
 S PSBHDR(1)="WARD ADMINISTRATION TIMES"
"RTN","PSBOWA",141,0)
 D WARD^PSBOHDR(PSBWRD,.PSBHDR)
"RTN","PSBOWA",142,0)
 S Y=PSBRPDT D D^DIQ
"RTN","PSBOWA",143,0)
 W !,"Patient Name",?64,Y_" Administration Times"
"RTN","PSBOWA",144,0)
 W !,"Room-Bed",?32
"RTN","PSBOWA",145,0)
 F X=0,.01:.01:.24 W $J($E(X_"00",2,3),4)
"RTN","PSBOWA",146,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",147,0)
 Q ""
"RTN","PSBOWA",148,0)
 ;
"RTN","PSBOWA",149,0)
PTHDR() ;
"RTN","PSBOWA",150,0)
 S PSBHDR(1)="PATIENT ADMINISTRATION TIMES"
"RTN","PSBOWA",151,0)
 D PT^PSBOHDR(PSBDFN,.PSBHDR)
"RTN","PSBOWA",152,0)
 W !,"Date/Time",?10,"Self Med",?20,"Medication",?55,"Dose/Route"
"RTN","PSBOWA",153,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOWA",154,0)
 S Y=PSBRPDT D D^DIQ
"RTN","PSBOWA",155,0)
 W !!,Y,!
"RTN","PSBOWA",156,0)
 Q ""
"RTN","PSBOWA",157,0)
 ;
"RTN","PSBRPC")
0^8^B83859906^B92329356
"RTN","PSBRPC",1,0)
PSBRPC ;BIRMINGHAM/EFC-BCMA RPC BROKER CALLS ;Mar 2004
"RTN","PSBRPC",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,13,32**;Mar 2004;Build 32
"RTN","PSBRPC",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBRPC",4,0)
 ;
"RTN","PSBRPC",5,0)
 ; Reference/IA
"RTN","PSBRPC",6,0)
 ; EN1^GMRADPT/10099
"RTN","PSBRPC",7,0)
 ; EN6^GMRVUTL/1120
"RTN","PSBRPC",8,0)
 ; DEM^VADPT/10061
"RTN","PSBRPC",9,0)
 ; IN5^VADPT/10061
"RTN","PSBRPC",10,0)
 ; File 200/10060
"RTN","PSBRPC",11,0)
 ; File 211.4/1409
"RTN","PSBRPC",12,0)
 ; CHECKAV^XUSRB/2882
"RTN","PSBRPC",13,0)
 ; GUIMTD^DPTLK6/3023
"RTN","PSBRPC",14,0)
 ; ^ORD(101.24/3429
"RTN","PSBRPC",15,0)
 ; File 2/10035
"RTN","PSBRPC",16,0)
 ; File 4/10090
"RTN","PSBRPC",17,0)
 ; EN1^GMRVUT0/1446
"RTN","PSBRPC",18,0)
 ; HASH^XUSHSHP/10045
"RTN","PSBRPC",19,0)
 ; $$DECRYP^XUSRB1/2241
"RTN","PSBRPC",20,0)
 ; ^DIC(42/1377
"RTN","PSBRPC",21,0)
 ; ^DIC(42/2440
"RTN","PSBRPC",22,0)
 ; $$GETACT^DGPFAPI/3860
"RTN","PSBRPC",23,0)
 ; $$GETICN^MPIF001/2701
"RTN","PSBRPC",24,0)
 ; $$GETDFN^MPIF001/2701
"RTN","PSBRPC",25,0)
 ; $$PROD^XUPROD/4440
"RTN","PSBRPC",26,0)
 ; $$GET^XPAR/2263
"RTN","PSBRPC",27,0)
 ; EN^XPAR/2263
"RTN","PSBRPC",28,0)
 ; $$BASE^XLFUTL/2622
"RTN","PSBRPC",29,0)
FMDATE(RESULTS,X) ;
"RTN","PSBRPC",30,0)
 ; RPC: PSB FMDATE   Descr: Returns FM D/T frm Clnt DateToStr()
"RTN","PSBRPC",31,0)
 I $P(X,"@",2)="0000" S $P(X,"@",2)="0001"
"RTN","PSBRPC",32,0)
 ;if no time for dates, append the current time
"RTN","PSBRPC",33,0)
 I $P(X,"@",2)="",X'?1"N" D  S $P(X,"@",2)=$P(Y,"@",2)
"RTN","PSBRPC",34,0)
 . N X
"RTN","PSBRPC",35,0)
 . S X="N",%DT="T" D ^%DT,DD^%DT
"RTN","PSBRPC",36,0)
 S %DT="T" D ^%DT
"RTN","PSBRPC",37,0)
 I +Y<1 S RESULTS(0)="-1^Invalid Date/Time" Q
"RTN","PSBRPC",38,0)
 S RESULTS(0)=Y D D^DIQ
"RTN","PSBRPC",39,0)
 S RESULTS(0)=RESULTS(0)_U_Y
"RTN","PSBRPC",40,0)
 Q
"RTN","PSBRPC",41,0)
USRLOAD(RESULTS,DUMMY) ;
"RTN","PSBRPC",42,0)
 ; RPC: PSB USERLOAD
"RTN","PSBRPC",43,0)
 S RESULTS(0)=DUZ ;UsrIEN
"RTN","PSBRPC",44,0)
 S RESULTS(1)=$$GET1^DIQ(200,DUZ_",",.01) ; Usr Nm
"RTN","PSBRPC",45,0)
 S RESULTS(2)=$S($D(^XUSEC("PSB STUDENT",DUZ)):1,1:0) ; Studnt?
"RTN","PSBRPC",46,0)
 S RESULTS(3)=$S($D(^XUSEC("PSB MANAGER",DUZ)):1,1:0) ; Mgr?
"RTN","PSBRPC",47,0)
 S RESULTS(4)=$S($D(^XUSEC("PSB CPRS MED BUTTON",DUZ)):1,1:0)
"RTN","PSBRPC",48,0)
 S RESULTS(5)=$$GET^XPAR("USR","PSB WINDOW")
"RTN","PSBRPC",49,0)
 S X=$S(+$$GET^XPAR("ALL","PSB VDL INCL CONT"):"T",1:"F")
"RTN","PSBRPC",50,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL PRN"):"T",1:"F")
"RTN","PSBRPC",51,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL ONE-TIME"):"T",1:"F")
"RTN","PSBRPC",52,0)
 S X=X_"/"_$S(+$$GET^XPAR("ALL","PSB VDL INCL ON-CALL"):"T",1:"F")
"RTN","PSBRPC",53,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL SORT COLUMN")
"RTN","PSBRPC",54,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL PB SORT COLUMN")
"RTN","PSBRPC",55,0)
 S X=X_"/"_+$$GET^XPAR("ALL","PSB VDL IV SORT COLUMN")
"RTN","PSBRPC",56,0)
 S RESULTS(6)=X ;VDL Setp
"RTN","PSBRPC",57,0)
 S RESULTS(7)=+$G(DUZ(2))
"RTN","PSBRPC",58,0)
 I RESULTS(7) S RESULTS(8)=$$GET1^DIQ(4,RESULTS(7)_",",.01)
"RTN","PSBRPC",59,0)
 E  S RESULTS(8)="Undefined Division"
"RTN","PSBRPC",60,0)
 S RESULTS(7)=RESULTS(7)_U_$P($$SITE^VASITE,U,3)
"RTN","PSBRPC",61,0)
 I $T(PROD^XUPROD)]"" S RESULTS(7)=RESULTS(7)_U_$$PROD^XUPROD(1)
"RTN","PSBRPC",62,0)
 S RESULTS(9)=+$$GET^XPAR("DIV","PSB ADMIN ESIG")
"RTN","PSBRPC",63,0)
 S RESULTS(10)=+$$GET^XPAR("DIV","PSB ONLINE")
"RTN","PSBRPC",64,0)
 S RESULTS(11)=$G(DTIME,300)
"RTN","PSBRPC",65,0)
 S RESULTS(12)=$$GET^XPAR("USR","PSB UNIT DOSE COLUMN WIDTHS")
"RTN","PSBRPC",66,0)
 S RESULTS(13)=$J_"^"_$$BASE^XLFUTL($J,10,16)
"RTN","PSBRPC",67,0)
 S RESULTS(14)=$$GET^XPAR("USR","PSB IVPB COLUMN WIDTHS")
"RTN","PSBRPC",68,0)
 S RESULTS(15)=$$GET^XPAR("USR","PSB IV COLUMN WIDTHS")
"RTN","PSBRPC",69,0)
 S RESULTS(16)=$$GET^XPAR("USR","PSB PRINTER USER DEFAULT")
"RTN","PSBRPC",70,0)
 S RESULTS(17)=$$GET^XPAR("USR","PSB GUI DEFAULT PRINTER")
"RTN","PSBRPC",71,0)
 S RESULTS(18)=$S($D(^XUSEC("PSB READ ONLY",DUZ)):1,1:0)
"RTN","PSBRPC",72,0)
 S RESULTS(19)=$$GET^XPAR("USR","PSB COVERSHEET VIEWS COL SORT")
"RTN","PSBRPC",73,0)
 S RESULTS(20)=$$GET^XPAR("USR","PSB COVERSHEET V1 COL WIDTHS")
"RTN","PSBRPC",74,0)
 S RESULTS(21)=$$GET^XPAR("USR","PSB COVERSHEET V2 COL WIDTHS")
"RTN","PSBRPC",75,0)
 S RESULTS(22)=$$GET^XPAR("USR","PSB COVERSHEET V3 COL WIDTHS")
"RTN","PSBRPC",76,0)
 S RESULTS(23)=$$GET^XPAR("USR","PSB COVERSHEET V4 COL WIDTHS")
"RTN","PSBRPC",77,0)
 Q
"RTN","PSBRPC",78,0)
USRSAVE(RESULTS,PSBWIN,PSBVDL,PSBUDCW,PSBPBCW,PSBIVCW,PSBDEV,PSBCSRT,PSBCV1,PSBCV2,PSBCV3,PSBCV4) ;
"RTN","PSBRPC",79,0)
 ; RPC: PSB USERSAVE  ; Saves user settings.
"RTN","PSBRPC",80,0)
 S RESULTS(0)="-1^FAILED - Parameters Save"
"RTN","PSBRPC",81,0)
 S PSBWIN=$G(PSBWIN),PSBVDL=$G(PSBVDL),PSBUDCW=$G(PSBUDCW)
"RTN","PSBRPC",82,0)
 S PSBPBCW=$G(PSBPBCW),PSBIVCW=$G(PSBIVCW),PSBDEV=$G(PSBDEV)
"RTN","PSBRPC",83,0)
 S PSBCSRT=$G(PSBCSRT),PSBCV1=$G(PSBCV1),PSBCV2=$G(PSBCV2),PSBCV3=$G(PSBCV3),PSBCV4=$G(PSBCV4)
"RTN","PSBRPC",84,0)
 D EN^XPAR("USR","PSB WINDOW",1,PSBWIN)
"RTN","PSBRPC",85,0)
 D EN^XPAR("USR","PSB VDL INCL CONT",1,$P(PSBVDL,"/",1)["T")
"RTN","PSBRPC",86,0)
 D EN^XPAR("USR","PSB VDL INCL PRN",1,$P(PSBVDL,"/",2)["T")
"RTN","PSBRPC",87,0)
 D EN^XPAR("USR","PSB VDL INCL ONE-TIME",1,$P(PSBVDL,"/",3)["T")
"RTN","PSBRPC",88,0)
 D EN^XPAR("USR","PSB VDL INCL ON-CALL",1,$P(PSBVDL,"/",4)["T")
"RTN","PSBRPC",89,0)
 D EN^XPAR("USR","PSB VDL SORT COLUMN",1,+$P(PSBVDL,"/",5))
"RTN","PSBRPC",90,0)
 D EN^XPAR("USR","PSB VDL PB SORT COLUMN",1,+$P(PSBVDL,"/",6))
"RTN","PSBRPC",91,0)
 D EN^XPAR("USR","PSB VDL IV SORT COLUMN",1,+$P(PSBVDL,"/",7))
"RTN","PSBRPC",92,0)
 D EN^XPAR("USR","PSB UNIT DOSE COLUMN WIDTHS",1,PSBUDCW)
"RTN","PSBRPC",93,0)
 D EN^XPAR("USR","PSB IVPB COLUMN WIDTHS",1,PSBPBCW)
"RTN","PSBRPC",94,0)
 D EN^XPAR("USR","PSB IV COLUMN WIDTHS",1,PSBIVCW)
"RTN","PSBRPC",95,0)
 D EN^XPAR("USR","PSB GUI DEFAULT PRINTER",1,PSBDEV)
"RTN","PSBRPC",96,0)
 D EN^XPAR("USR","PSB COVERSHEET VIEWS COL SORT",1,PSBCSRT)
"RTN","PSBRPC",97,0)
 D EN^XPAR("USR","PSB COVERSHEET V1 COL WIDTHS",1,PSBCV1)
"RTN","PSBRPC",98,0)
 D EN^XPAR("USR","PSB COVERSHEET V2 COL WIDTHS",1,PSBCV2)
"RTN","PSBRPC",99,0)
 D EN^XPAR("USR","PSB COVERSHEET V3 COL WIDTHS",1,PSBCV3)
"RTN","PSBRPC",100,0)
 D EN^XPAR("USR","PSB COVERSHEET V4 COL WIDTHS",1,PSBCV4)
"RTN","PSBRPC",101,0)
 S RESULTS(0)="1^Parameters Saved"
"RTN","PSBRPC",102,0)
 Q
"RTN","PSBRPC",103,0)
INST(RESULTS,PSBACC,PSBVER) ;
"RTN","PSBRPC",104,0)
 ; RPC: PSB INSTRUCTOR
"RTN","PSBRPC",105,0)
 ; Descr:
"RTN","PSBRPC",106,0)
 ; Used by frmInstructor to validate an instructor(s) at
"RTN","PSBRPC",107,0)
 ; the client via encrypted A/V Code.
"RTN","PSBRPC",108,0)
 S PSBACC=$$DECRYP^XUSRB1(PSBACC)
"RTN","PSBRPC",109,0)
 S PSBVER=$$DECRYP^XUSRB1(PSBVER)
"RTN","PSBRPC",110,0)
 S PSBINST=$$CHECKAV^XUSRB(PSBACC_";"_PSBVER)
"RTN","PSBRPC",111,0)
 I PSBINST<1 S RESULTS(0)="-1^Invalid Instructor Sign-On" K PSBINST Q
"RTN","PSBRPC",112,0)
 I '$D(^XUSEC("PSB INSTRUCTOR",PSBINST)) S RESULTS(0)="-1^Instructor doesn't have authority" K PSBINST Q
"RTN","PSBRPC",113,0)
 S PSBINST(0)=$$GET1^DIQ(200,PSBINST_",",.01)
"RTN","PSBRPC",114,0)
 S RESULTS(0)=PSBINST_U_PSBINST(0)
"RTN","PSBRPC",115,0)
 Q
"RTN","PSBRPC",116,0)
ESIG(RESULTS,PSBESIG) ;
"RTN","PSBRPC",117,0)
 ; RPC: PSB VALIDATE ESIG  ; Validate the data in PSBESIG against user (DUZ)
"RTN","PSBRPC",118,0)
 S PSBDSIG=$P($G(PSBESIG),U,2) I PSBDSIG'="" S PSBDSIG=$$DECRYP^XUSRB1(PSBDSIG),PSBESIG=PSBDSIG
"RTN","PSBRPC",119,0)
 I $G(PSBESIG)="" S RESULTS(0)="-1^Must Supply ESig" Q
"RTN","PSBRPC",120,0)
 S X=PSBESIG D HASH^XUSHSHP
"RTN","PSBRPC",121,0)
 I X'=$$GET1^DIQ(200,DUZ_",",20.4,"I") S RESULTS(0)="-1^Invalid ESig"
"RTN","PSBRPC",122,0)
 E  S RESULTS(0)="1^ESig Verified"
"RTN","PSBRPC",123,0)
 Q
"RTN","PSBRPC",124,0)
SCANPT(RESULTS,PSBDATA) ; Lookup Pt by Full SSN
"RTN","PSBRPC",125,0)
 ; RPC: PSB SCANPT
"RTN","PSBRPC",126,0)
 ; File #2 lookup either by full SSN
"RTN","PSBRPC",127,0)
 ; returns -1 error / patient data
"RTN","PSBRPC",128,0)
 ; Check for Interleave 2 of 5 Check Digit on SSN and remove
"RTN","PSBRPC",129,0)
 N DFN
"RTN","PSBRPC",130,0)
 I "SS"[$P($G(PSBDATA),"^",3)  D  Q:RESULTS(1)<0
"RTN","PSBRPC",131,0)
 .S:$P(PSBDATA,"^")?1"0"9N.U PSBDATA=$E(PSBDATA,2,99) N PSBCNT
"RTN","PSBRPC",132,0)
 .I $P(PSBDATA,U)'?9N.1U S RESULTS(0)=1,RESULTS(1)="-1^Invalid Patient Lookup" Q
"RTN","PSBRPC",133,0)
 .S X=$$FIND1^DIC(2,"","",$P(PSBDATA,U),"SSN")
"RTN","PSBRPC",134,0)
 .I X<1 S RESULTS(0)=1,RESULTS(1)="-1^Invalid Patient Lookup" Q
"RTN","PSBRPC",135,0)
 .S (DFN,RESULTS(1),PSBDFN)=X
"RTN","PSBRPC",136,0)
 .S PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN=""
"RTN","PSBRPC",137,0)
 I $G(DFN)']"" D  Q:+PSBDFN'>0
"RTN","PSBRPC",138,0)
 .; CCOW !
"RTN","PSBRPC",139,0)
 .I "DF"[$P($G(PSBDATA),"^",3) S PSBDFN=$P($G(PSBDATA),"^"),PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN="",RESULTS(0)=1,RESULTS(1)="-1^Cannot find ICN via DFN"
"RTN","PSBRPC",140,0)
 .I "IC"[$P($G(PSBDATA),"^",3) S PSBICN=$P($G(PSBDATA),"^"),PSBDFN=$$GETDFN^MPIF001(PSBICN) I +PSBDFN=-1 S PSBDFN="",RESULTS(0)=1,RESULTS(1)="-1^Cannot find DFN via ICN" Q
"RTN","PSBRPC",141,0)
 .S (DFN,RESULTS(1))=PSBDFN
"RTN","PSBRPC",142,0)
 K VADM,VAIN
"RTN","PSBRPC",143,0)
 D DEM^VADPT,IN5^VADPT
"RTN","PSBRPC",144,0)
 I ('$P(PSBDATA,U,2))&('VAIP(13)&'VADM(6)) S RESULTS(0)=1,RESULTS(1)="-1^Patient has been DISCHARGED" I ($P($G(PSBDATA),U,3)'["IC")&($P($G(PSBDATA),U,3)'["DF") K VAIP,VADM Q
"RTN","PSBRPC",145,0)
 I ('$P(PSBDATA,U,2))&(VADM(6)'="") S RESULTS(0)=1,RESULTS(1)="-1^"_"This patient died "_$TR($P(VADM(6),U,2),"@"," ") I ($P($G(PSBDATA),U,3)'["IC")&($P($G(PSBDATA),U,3)'["DF") K VAIP,VADM Q
"RTN","PSBRPC",146,0)
 S RESULTS(1)=PSBDFN
"RTN","PSBRPC",147,0)
 F X=1,2,3,4,5 S RESULTS(X+1)=$G(VADM(X))
"RTN","PSBRPC",148,0)
 F X=3,4,5,6,7,8,9,10,11 S RESULTS(X+4)=$G(VAIP(X))
"RTN","PSBRPC",149,0)
 S $P(RESULTS(9),U,3)=$$GET1^DIQ(42,$P(RESULTS(9),U)_",",44,"I")_"^"_$$GET1^DIQ(42,$P(RESULTS(9),U)_",",44)
"RTN","PSBRPC",150,0)
 S GMRVSTR="HT" D EN6^GMRVUTL
"RTN","PSBRPC",151,0)
 S X=+$P(X,U,8) S:X X=X*2.54\1 S PSBHDR("HEIGHT")=$S(X:X_"cm",1:"*")
"RTN","PSBRPC",152,0)
 S RESULTS(16)=PSBHDR("HEIGHT")
"RTN","PSBRPC",153,0)
 S GMRVSTR="WT" D EN6^GMRVUTL
"RTN","PSBRPC",154,0)
 S X=+$P(X,U,8) S X=$J(X/2.2,0,2) S PSBHDR("WEIGHT")=$S(X:X_"kg",1:"*")
"RTN","PSBRPC",155,0)
 S RESULTS(17)=PSBHDR("WEIGHT")
"RTN","PSBRPC",156,0)
 S GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSBRPC",157,0)
 I $O(GMRAL(0)) S RESULTS(18)=1
"RTN","PSBRPC",158,0)
 E  S RESULTS(18)=0
"RTN","PSBRPC",159,0)
 ; Means Tst
"RTN","PSBRPC",160,0)
 D GUIMTD^DPTLK6(.PSBDATA,PSBDFN)
"RTN","PSBRPC",161,0)
 S RESULTS(19)=+$G(PSBDATA(1))_U_$G(PSBDATA(2))_U_$G(PSBDATA(3))
"RTN","PSBRPC",162,0)
 S PSBICN=$$GETICN^MPIF001(PSBDFN) I +PSBICN=-1 S PSBICN=""
"RTN","PSBRPC",163,0)
 S RESULTS(20)=PSBICN
"RTN","PSBRPC",164,0)
 S RESULTS(21)="",RESULTS(0)=21
"RTN","PSBRPC",165,0)
 S:VADM(6)'="" RESULTS(21)="This patient died "_$TR($P(VADM(6),U,2),"@"," ")
"RTN","PSBRPC",166,0)
 S:('VAIP(13))&('VADM(6)) RESULTS(21)="Patient has been DISCHARGED"
"RTN","PSBRPC",167,0)
 S (RESULTS(0),PSBCNT)=22
"RTN","PSBRPC",168,0)
 S RESULTS(PSBCNT)=""
"RTN","PSBRPC",169,0)
 F PSBINDX=1:1:($$GETACT^DGPFAPI(PSBDFN,.PSBPTFLG)) D
"RTN","PSBRPC",170,0)
 .Q:'$D(PSBPTFLG)  Q:'$D(@(PSBPTFLG_"(PSBINDX,""FLAG"")"))  S PSBPFLAG="PATFLG",$P(PSBPFLAG,U,2)=$P(@(PSBPTFLG_"(PSBINDX,""FLAG"")"),"^",2)
"RTN","PSBRPC",171,0)
 .S $P(PSBPFLAG,U,3)=PSBINDX,PSBCNT=21+PSBINDX,RESULTS(PSBCNT)=PSBPFLAG
"RTN","PSBRPC",172,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBRPC",173,0)
 I $D(PSBPTFLG) K @PSBPTFLG
"RTN","PSBRPC",174,0)
 K VAIP,VADM
"RTN","PSBRPC",175,0)
 Q
"RTN","PSBRPC",176,0)
MAX(RESULTS,PSBDAYS) ;
"RTN","PSBRPC",177,0)
 ; RPC: PSB MAXDAYS  ; Max days - MAH
"RTN","PSBRPC",178,0)
 S X=$O(^ORD(101.24,"B","ORRP BCMA MAH",""))
"RTN","PSBRPC",179,0)
 S RESULTS(0)=$$GET1^DIQ(101.24,X_",",.42)
"RTN","PSBRPC",180,0)
 Q
"RTN","PSBRPC",181,0)
NWLIST(RESULTS,DUMMY) ; ward/nurs File #211.4
"RTN","PSBRPC",182,0)
 K ^TMP("PSB",$J)
"RTN","PSBRPC",183,0)
 S PSBIEN=0 F  S PSBIEN=$O(^NURSF(211.4,PSBIEN)) Q:PSBIEN'?.N  D
"RTN","PSBRPC",184,0)
 .S ^TMP("PSB",$J,$$GET1^DIQ(211.4,PSBIEN_",",.01)_" [NURS UNIT]")=PSBIEN
"RTN","PSBRPC",185,0)
 .S PSBX=0 F  S PSBX=$O(^NURSF(211.4,PSBIEN,3,PSBX)) Q:PSBX=""  D
"RTN","PSBRPC",186,0)
 ..S PSBWIEN=$P(^NURSF(211.4,PSBIEN,3,PSBX,0),"^")
"RTN","PSBRPC",187,0)
 ..I $$GET1^DIQ(42,PSBWIEN_",",.01)]"" S ^TMP("PSB",$J,$$GET1^DIQ(42,PSBWIEN_",",.01)_" [MAS WARD]")=PSBIEN
"RTN","PSBRPC",188,0)
 S RESULTS(0)=0
"RTN","PSBRPC",189,0)
 S X="" F  S X=$O(^TMP("PSB",$J,X)) Q:X=""  D
"RTN","PSBRPC",190,0)
 .S RESULTS(0)=RESULTS(0)+1
"RTN","PSBRPC",191,0)
 .S RESULTS(RESULTS(0))=^TMP("PSB",$J,X)_U_X_U_$S(($$GET1^DIQ(211.4,^TMP("PSB",$J,X)_",",1)="ACTIVE")&($$GET1^DIQ(211.4,^TMP("PSB",$J,X)_",",1.5)'="**INACTIVE**"):"1",1:"0")
"RTN","PSBRPC",192,0)
 K ^TMP("PSB",$J)
"RTN","PSBRPC",193,0)
 Q
"RTN","PSBRPC",194,0)
VITALS(RESULTS,DFN) ;Vitals API
"RTN","PSBRPC",195,0)
 ; RPC PSB VITALS
"RTN","PSBRPC",196,0)
 K RESULTS
"RTN","PSBRPC",197,0)
 N PSBSTRT,PSBSTOP,PSBNOW
"RTN","PSBRPC",198,0)
 S PSBDFN=DFN,GMRVSTR="T;P;R;BP;PN"
"RTN","PSBRPC",199,0)
 D NOW^%DTC S PSBNOW=%,PSBSTRT=$$FMADD^XLFDT(PSBNOW,"",-168),PSBSTOP=PSBNOW,GMRVSTR(0)=PSBSTRT_U_PSBSTOP_U_4_U
"RTN","PSBRPC",200,0)
 K ^UTILITY($J,"GMRVD")
"RTN","PSBRPC",201,0)
 D EN1^GMRVUT0
"RTN","PSBRPC",202,0)
 S PSBCNT=1
"RTN","PSBRPC",203,0)
 I '$D(^UTILITY($J,"GMRVD")) S RESULTS(0)=PSBCNT,RESULTS(PSBCNT)="No Vitals to report" Q
"RTN","PSBRPC",204,0)
 S PSBTYP=""
"RTN","PSBRPC",205,0)
 F  S PSBTYP=$O(^UTILITY($J,"GMRVD",PSBTYP)) Q:PSBTYP=""  D
"RTN","PSBRPC",206,0)
 .S PSBRDT=""
"RTN","PSBRPC",207,0)
 .F  S PSBRDT=$O(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT)) Q:PSBRDT=""  D
"RTN","PSBRPC",208,0)
 ..S PSBIEN=""
"RTN","PSBRPC",209,0)
 ..F  S PSBIEN=$O(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT,PSBIEN)) Q:PSBIEN=""  D
"RTN","PSBRPC",210,0)
 ...S PSBDATA=($G(^UTILITY($J,"GMRVD",PSBTYP,PSBRDT,PSBIEN)))
"RTN","PSBRPC",211,0)
 ...S RESULTS(PSBCNT)=PSBTYP_U_$P(PSBDATA,U,1,2)_U_$P(PSBDATA,U,8)
"RTN","PSBRPC",212,0)
 ...S PSBCNT=PSBCNT+1
"RTN","PSBRPC",213,0)
 S RESULTS(0)=PSBCNT-1
"RTN","PSBRPC",214,0)
 K ^UTILITY($J,"GMRVD"),GMRBSTR,PSBDFN,PSBTYPE,PSBDATA,PSBCNT
"RTN","PSBRPC",215,0)
 Q
"RTN","PSBRPC2")
0^34^B45066949^B45008949
"RTN","PSBRPC2",1,0)
PSBRPC2 ;BIRMINGHAM/EFC-BCMA RPC BROKER CALLS ;Mar 2004
"RTN","PSBRPC2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,16,32**;Mar 2004;Build 32
"RTN","PSBRPC2",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBRPC2",4,0)
 ;
"RTN","PSBRPC2",5,0)
 ; Reference/IA
"RTN","PSBRPC2",6,0)
 ; File 50/221
"RTN","PSBRPC2",7,0)
 ; File 52.6/436
"RTN","PSBRPC2",8,0)
 ; File 52.7/437
"RTN","PSBRPC2",9,0)
 ; File 200/10060
"RTN","PSBRPC2",10,0)
GETOHIST(RESULTS,DFN,PSBORD) ;
"RTN","PSBRPC2",11,0)
 S RESULTS=$NAME(^TMP("PSB",$J)),PSB=0 K ^TMP("PSB",$J)
"RTN","PSBRPC2",12,0)
 S ^TMP("PSB",$J,0)=1,^TMP("PSB",$J,1)="-1^No History On File"
"RTN","PSBRPC2",13,0)
 D NOW^%DTC S PSBNOW=$P(%,".",1),PSBNOWZ=%
"RTN","PSBRPC2",14,0)
 D EN^PSBPOIV(DFN,PSBORD)
"RTN","PSBRPC2",15,0)
 S PSBUID=DFN_"V"_99999 F  S PSBUID=$O(^TMP("PSBAR",$J,PSBUID),-1) Q:PSBUID=""  D
"RTN","PSBRPC2",16,0)
 .S PSBUIDS=^TMP("PSBAR",$J,PSBUID)
"RTN","PSBRPC2",17,0)
 .I ((PSBOSTS="D")!(PSBOSTS="E")),$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" Q   ; only want the infusing bag on a dc'ed order
"RTN","PSBRPC2",18,0)
 .I (PSBOSTS="A"),(PSBOSP<PSBNOWZ),$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" S PSBOSTS="E" Q  ; only want the infusing bag on an expired order
"RTN","PSBRPC2",19,0)
 .I $P(PSBUIDS,U,2)'="" D  Q  ; get orders from med log (53.79)
"RTN","PSBRPC2",20,0)
 ..S PSBMLOR=$P(PSBUIDS,U,4),PSBIEN=$O(^PSB(53.79,"AUID",DFN,PSBMLOR,PSBUID,""))
"RTN","PSBRPC2",21,0)
 ..S PSBLADT=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBRPC2",22,0)
 ..S PSBLASTS=$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBRPC2",23,0)
 ..I PSBLASTS="M",$P(PSBUIDS,U,8)'="" Q
"RTN","PSBRPC2",24,0)
 ..S PSBINJS=$P(^PSB(53.79,PSBIEN,.1),U,6)
"RTN","PSBRPC2",25,0)
 ..S PSB=PSB+1,^TMP("PSB",$J,PSB)=PSBORD_U_PSBUID_U_PSBIEN_U_PSBLADT_U_PSBLASTS_U_PSBINJS
"RTN","PSBRPC2",26,0)
 ..F PSBL=1:1 Q:'$D(^PSB(53.79,PSBIEN,.6,PSBL,0))  S PSB=PSB+1,^TMP("PSB",$J,PSB)="ADD^"_^PSB(53.79,PSBIEN,.6,PSBL,0)
"RTN","PSBRPC2",27,0)
 ..F PSBL=1:1 Q:'$D(^PSB(53.79,PSBIEN,.7,PSBL,0))  S PSB=PSB+1,^TMP("PSB",$J,PSB)="SOL^"_^PSB(53.79,PSBIEN,.7,PSBL,0)
"RTN","PSBRPC2",28,0)
 ..S PSB=PSB+1,^TMP("PSB",$J,PSB)="END"
"RTN","PSBRPC2",29,0)
 .I $P(PSBUIDS,U,1)="I" Q  ; IV parameters say bag is invalid
"RTN","PSBRPC2",30,0)
 .I $P(PSBUIDS,U,8)'="",$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" Q  ; label has been reprinted/distroyed etc. - bag is not infusing or stopped
"RTN","PSBRPC2",31,0)
 .S PSB=PSB+1,^TMP("PSB",$J,PSB)=$P(PSBUIDS,U,5)_U_PSBUID_U_U_PSBNOW_U_"A"
"RTN","PSBRPC2",32,0)
 .S PSBUIDP=$P(PSBUIDS,U,10,999)
"RTN","PSBRPC2",33,0)
 .F Y=3:1 S PSBMEDTY=$P(PSBUIDP,U,Y) Q:PSBMEDTY=""  D
"RTN","PSBRPC2",34,0)
 ..D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$P(PSBUIDS,U,5))
"RTN","PSBRPC2",35,0)
 ..I $P(PSBMEDTY,";",1)="ADD" F Z=1:1 S PSBAD=$G(PSBADA(Z)) Q:PSBAD=""  I $P(PSBADA(Z),U,2)=$P(PSBMEDTY,";",2) S PSB=PSB+1,^TMP("PSB",$J,PSB)=PSBADA(Z) Q
"RTN","PSBRPC2",36,0)
 ..I $P(PSBMEDTY,";",1)="SOL" F Z=1:1 S PSBSOL=$G(PSBSOLA(Z)) Q:PSBSOL=""  I $P(PSBSOLA(Z),U,2)=$P(PSBMEDTY,";",2) S PSB=PSB+1,^TMP("PSB",$J,PSB)=PSBSOLA(Z) Q
"RTN","PSBRPC2",37,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBRPC2",38,0)
 .S PSB=PSB+1,^TMP("PSB",$J,PSB)="END"
"RTN","PSBRPC2",39,0)
 F II=1:1 S I=$P(PSBONXS,U,II) Q:I=""  D  ; get ward stocks
"RTN","PSBRPC2",40,0)
 .S PSBUID="" F  S PSBUID=$O(^PSB(53.79,"AUID",DFN,I,PSBUID)) Q:PSBUID=""  D
"RTN","PSBRPC2",41,0)
 ..I PSBUID'["WS" Q  ; not a ward stock
"RTN","PSBRPC2",42,0)
 ..S PSBIEN=$O(^PSB(53.79,"AUID",DFN,I,PSBUID,""))
"RTN","PSBRPC2",43,0)
 ..S PSBLADT=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBRPC2",44,0)
 ..S PSBLASTS=$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBRPC2",45,0)
 ..I PSBOSTS="D",PSBLASTS'="I",PSBLASTS'="S" Q  ; want "not completed" on DC'ed orders
"RTN","PSBRPC2",46,0)
 ..I (PSBOSTS="A"),(PSBOSP<PSBNOWZ),PSBLASTS'="I",PSBLASTS'="S" Q
"RTN","PSBRPC2",47,0)
 ..S PSBINJS=$P(^PSB(53.79,PSBIEN,.1),U,6)
"RTN","PSBRPC2",48,0)
 ..S PSB=PSB+1,^TMP("PSB",$J,PSB)=PSBORD_U_PSBUID_U_PSBIEN_U_PSBLADT_U_PSBLASTS_U_PSBINJS
"RTN","PSBRPC2",49,0)
 ..F PSBL=1:1 Q:'$D(^PSB(53.79,PSBIEN,.6,PSBL,0))  S PSB=PSB+1,^TMP("PSB",$J,PSB)="ADD^"_^PSB(53.79,PSBIEN,.6,PSBL,0)
"RTN","PSBRPC2",50,0)
 ..F PSBL=1:1 Q:'$D(^PSB(53.79,PSBIEN,.7,PSBL,0))  S PSB=PSB+1,^TMP("PSB",$J,PSB)="SOL^"_^PSB(53.79,PSBIEN,.7,PSBL,0)
"RTN","PSBRPC2",51,0)
 ..S PSB=PSB+1,^TMP("PSB",$J,PSB)="END"
"RTN","PSBRPC2",52,0)
 S ^TMP("PSB",$J,0)=PSB
"RTN","PSBRPC2",53,0)
 K ^TMP("PSBAR",$J)
"RTN","PSBRPC2",54,0)
 Q
"RTN","PSBRPC2",55,0)
 ;
"RTN","PSBRPC2",56,0)
BAGDTL(RESULTS,PSBUID,PSBORD)  ; bag detail
"RTN","PSBRPC2",57,0)
 I $G(DFN)="" S DFN=+PSBUID
"RTN","PSBRPC2",58,0)
 S (PSBIEN,X)="" F  S X=$O(^PSB(53.79,"AUID",DFN,X)) Q:X=""  S:$D(^PSB(53.79,"AUID",DFN,X,PSBUID)) PSBIEN=$O(^PSB(53.79,"AUID",DFN,X,PSBUID,"")) Q:PSBIEN]""
"RTN","PSBRPC2",59,0)
 I PSBIEN'>0 S RESULTS(0)=1,RESULTS(1)="-1^No History On File" Q
"RTN","PSBRPC2",60,0)
 M PSBMLA=^PSB(53.79,PSBIEN)
"RTN","PSBRPC2",61,0)
 S X=$P(^PSB(53.79,PSBIEN,0),U,9)
"RTN","PSBRPC2",62,0)
 S PSBLAC=$S(X="I":"INFUSING",X="G":"GIVEN",X="C":"COMPLETE",X="H":"HELD",X="R":"REFUSED",X="RM":"REMOVED",X="S":"STOPPED",X="M":"MISSING",1:"NO ACTION")
"RTN","PSBRPC2",63,0)
 ; comments
"RTN","PSBRPC2",64,0)
 S PSBX="0" F  S PSBX=$O(PSBMLA(.3,PSBX)) Q:PSBX=""  S PSBTMP(10000000-$P(PSBMLA(.3,PSBX,0),U,3),"C")=$P(PSBMLA(.3,PSBX,0),U,3)_U_$$INITIAL($P(PSBMLA(.3,PSBX,0),U,2))_U_U_$P(PSBMLA(.3,PSBX,0),U,1)
"RTN","PSBRPC2",65,0)
 ; audit
"RTN","PSBRPC2",66,0)
 S PSBGA="" I $D(PSBMLA(.9,0)) D
"RTN","PSBRPC2",67,0)
 .S PSBX="0" F  S PSBX=$O(PSBMLA(.9,PSBX)) Q:PSBX=""  I ((PSBMLA(.9,PSBX,0)["ACTION STATUS")!(PSBMLA(.9,PSBX,0)["ADMINISTRATION STATUS")) D  Q
"RTN","PSBRPC2",68,0)
 ..S PSBDATE=$P(PSBMLA(0),U,4) I (PSBX-2)>0 D DT^DILF("ENPST",$P(PSBMLA(.9,PSBX-2,0),"'",2),.PSBDATE)
"RTN","PSBRPC2",69,0)
 ..S PSBTMP(10000000-PSBDATE,"B")=PSBDATE_U_$$INITIAL($P(PSBMLA(0),U,5))_U_$P(PSBMLA(.9,PSBX,0),"'",2)
"RTN","PSBRPC2",70,0)
 ..S PSBGA=1
"RTN","PSBRPC2",71,0)
 .S PSBX="0" F  S PSBX=$O(PSBMLA(.9,PSBX)) Q:PSBX=""  I ((PSBMLA(.9,PSBX,0)["ACTION STATUS")!(PSBMLA(.9,PSBX,0)["ADMINISTRATION STATUS"))  D
"RTN","PSBRPC2",72,0)
 ..S PSBTMP(10000000-$P(PSBMLA(.9,PSBX,0),U,1),"B")=$P(PSBMLA(.9,PSBX,0),U,1)_U_$$INITIAL($P(PSBMLA(.9,PSBX,0),U,2))_U_$P($P(PSBMLA(.9,PSBX,0),U,3),"'",2)
"RTN","PSBRPC2",73,0)
 ..S PSBGA=1
"RTN","PSBRPC2",74,0)
 I PSBGA'=1 S PSBTMP(10000000-$P(PSBMLA(0),U,6),"A")=$P(PSBMLA(0),U,6)_U_$$INITIAL($P(PSBMLA(0),U,7))_U_PSBLAC
"RTN","PSBRPC2",75,0)
 S PSBQRY="PSBTMP",PSBCNT=1 F  S PSBQRY=$Q(@PSBQRY) Q:PSBQRY=""  D  ; does comment go with action
"RTN","PSBRPC2",76,0)
 .S PSBPQRY=$Q(@PSBQRY,-1)
"RTN","PSBRPC2",77,0)
 .I PSBPQRY="" S RESULTS(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1 Q  ; no previous action
"RTN","PSBRPC2",78,0)
 .I $QS(PSBPQRY,2)="C"  S RESULTS(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1 Q  ; previous line is a comment
"RTN","PSBRPC2",79,0)
 .I $QS(PSBQRY,2)="C",$E($P(@$Q(@PSBQRY,-1),U,1),1,12)=$E($P(@PSBQRY,U,1),1,12),$P(@$Q(@PSBQRY,-1),U,2)=$P(@PSBQRY,U,2) S X=$P(@PSBQRY,U,4),$P(RESULTS(PSBCNT-1),U,4)=X Q
"RTN","PSBRPC2",80,0)
 .S RESULTS(PSBCNT)=@PSBQRY,PSBCNT=PSBCNT+1
"RTN","PSBRPC2",81,0)
 S RESULTS(0)=PSBCNT-1
"RTN","PSBRPC2",82,0)
 K PSBMLA,PSBIEN,PSBTMP,PSBQRY
"RTN","PSBRPC2",83,0)
 Q
"RTN","PSBRPC2",84,0)
 ;
"RTN","PSBRPC2",85,0)
INITIAL(PSBDUZ) ;
"RTN","PSBRPC2",86,0)
 Q $$GET1^DIQ(200,PSBDUZ,"INITIAL")
"RTN","PSBRPC2",87,0)
SCANMED(RESULTS,PSBDIEN,PSBTAB)  ; Lookup Medication
"RTN","PSBRPC2",88,0)
 ;
"RTN","PSBRPC2",89,0)
 ; RPC: PSB SCANMED
"RTN","PSBRPC2",90,0)
 ;
"RTN","PSBRPC2",91,0)
 ; Description:
"RTN","PSBRPC2",92,0)
 ; Does a lookup on file 50 returns -1 on invalid lookup or
"RTN","PSBRPC2",93,0)
 ; IEN^DrugName on success
"RTN","PSBRPC2",94,0)
 ;
"RTN","PSBRPC2",95,0)
 D NOW^%DTC S PSBDT=%
"RTN","PSBRPC2",96,0)
 S PSBCNT=0
"RTN","PSBRPC2",97,0)
 I $L(PSBDIEN)>40 S PSBDIEN=$E(PSBDIEN,1,40)
"RTN","PSBRPC2",98,0)
 S RESULTS(PSBCNT)=1
"RTN","PSBRPC2",99,0)
 S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)="-1^Invalid Medication Lookup"
"RTN","PSBRPC2",100,0)
 I $$GET^XPAR("DIV","PSB ROBOT RX"),PSBDIEN?1"3"15N!(PSBDIEN?1"3"17N),123[$E(PSBDIEN,12) S PSBDIEN=$E(PSBDIEN,2,11)
"RTN","PSBRPC2",101,0)
 I PSBTAB="UDTAB" D  Q
"RTN","PSBRPC2",102,0)
 .S X=$$FIND1^DIC(50,"","AX",PSBDIEN,"B^C")
"RTN","PSBRPC2",103,0)
 .I X<1 Q
"RTN","PSBRPC2",104,0)
 .E  S RESULTS(PSBCNT)="DD"_U_X_U_$$GET1^DIQ(50,X_",",.01)
"RTN","PSBRPC2",105,0)
 ;
"RTN","PSBRPC2",106,0)
 ; IV/IVPB ward stock scan
"RTN","PSBRPC2",107,0)
 ;
"RTN","PSBRPC2",108,0)
 S PSBDIEN=$$FIND1^DIC(50,"","AX",PSBDIEN,"B^C") I PSBDIEN<1 Q
"RTN","PSBRPC2",109,0)
 S PSBOIT=$$GET1^DIQ(50,PSBDIEN,"PHARMACY ORDERABLE ITEM","I")
"RTN","PSBRPC2",110,0)
 I $D(^PSDRUG("A527",PSBDIEN)) S X="" F  S X=$O(^PSDRUG("A527",PSBDIEN,X)) Q:X=""  D
"RTN","PSBRPC2",111,0)
 .S PSBINACT=$$GET1^DIQ(52.7,X,8,"I") I PSBINACT]"",PSBINACT'>PSBDT Q
"RTN","PSBRPC2",112,0)
 .S RESULTS(PSBCNT)="SOL"_U_X_U_$$GET1^DIQ(50,PSBDIEN_",",.01),PSBCNT=PSBCNT+1,RESULTS(0)=PSBCNT-1
"RTN","PSBRPC2",113,0)
 I $D(^PSDRUG("A526",PSBDIEN)) S X="" F  S X=$O(^PSDRUG("A526",PSBDIEN,X)) Q:X=""  D
"RTN","PSBRPC2",114,0)
 .S PSBINACT=$$GET1^DIQ(52.6,X,12,"I") I PSBINACT]"",PSBINACT'>PSBDT Q
"RTN","PSBRPC2",115,0)
 .S RESULTS(PSBCNT)="ADD"_U_X_U_$$GET1^DIQ(50,PSBDIEN_",",.01),PSBCNT=PSBCNT+1,RESULTS(0)=PSBCNT-1
"RTN","PSBRPC2",116,0)
 ;
"RTN","PSBRPC2",117,0)
 I PSBTAB="PBTAB",$$FIND1^DIC(50,"","AX",PSBDIEN,"B^C")'<1 S X=$$FIND1^DIC(50,"","AX",PSBDIEN,"B^C"),RESULTS(PSBCNT)="DD"_U_X_U_$$GET1^DIQ(50,X_",",.01),PSBCNT=PSBCNT+1,RESULTS(0)=PSBCNT-1
"RTN","PSBRPC2",118,0)
 Q
"RTN","PSBRPC2",119,0)
 ;
"RTN","PSBRPC3")
0^9^B308923^B859177
"RTN","PSBRPC3",1,0)
PSBRPC3 ;BIRMINGHAM/VRN-BCMA RPC BROKER CALLS ;Mar 2004
"RTN","PSBRPC3",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,4,16,13,10,32**;Mar 2004;Build 32
"RTN","PSBRPC3",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBRPC3",4,0)
 ;
"RTN","PSBRPC3",5,0)
GUICHK(RESULTS,DUMMY) ;
"RTN","PSBRPC3",6,0)
 ;
"RTN","PSBRPC3",7,0)
 ; RPC : PSB VERSION CHECK
"RTN","PSBRPC3",8,0)
 ;
"RTN","PSBRPC3",9,0)
 K RESULTS
"RTN","PSBRPC3",10,0)
 N PSBCURR,PSBPREV,PSBCNT
"RTN","PSBRPC3",11,0)
 S PSBCURR="3.0.32.*",PSBPREV="",PSBCNT=0
"RTN","PSBRPC3",12,0)
 S PSBCNT=PSBCNT+1
"RTN","PSBRPC3",13,0)
 S RESULTS(PSBCNT)=PSBCURR_U_PSBPREV
"RTN","PSBRPC3",14,0)
 S RESULTS(0)=PSBCNT
"RTN","PSBRPC3",15,0)
 Q
"RTN","PSBRPC3",16,0)
 ;
"RTN","PSBRPCMO")
0^20^B85114141^B57948818
"RTN","PSBRPCMO",1,0)
PSBRPCMO ;BIRMINGHAM/EFC-MED ORDER BUTTON FUNCTIONS ;Mar 2004
"RTN","PSBRPCMO",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,32**;Mar 2004;Build 32
"RTN","PSBRPCMO",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBRPCMO",4,0)
 ; Reference/IA
"RTN","PSBRPCMO",5,0)
 ; ^XUSEC("PROVIDER")/10076
"RTN","PSBRPCMO",6,0)
 ; ^%DTC/10000 
"RTN","PSBRPCMO",7,0)
 ; ^XPAR/2263
"RTN","PSBRPCMO",8,0)
 ; File 50/221
"RTN","PSBRPCMO",9,0)
 ; File 50.7/2880
"RTN","PSBRPCMO",10,0)
 ; File 200/10060
"RTN","PSBRPCMO",11,0)
 ; File 52.6/436
"RTN","PSBRPCMO",12,0)
 ; File 52.7/437
"RTN","PSBRPCMO",13,0)
 ; $$EN^ORBCMA2/3616
"RTN","PSBRPCMO",14,0)
 ; C^PSN50P65/4543
"RTN","PSBRPCMO",15,0)
OILST(RESULTS,PSBSCAN,PSBOTYP) ;
"RTN","PSBRPCMO",16,0)
 I PSBOTYP="VAC" D VACLKU Q
"RTN","PSBRPCMO",17,0)
 I $L(PSBSCAN?.N)>31 S PSBSCAN=$E(PSBSCAN,1,31)
"RTN","PSBRPCMO",18,0)
 S PSBSCAN=$TR(PSBSCAN,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSBRPCMO",19,0)
 D NOW^%DTC S PSBDT=%
"RTN","PSBRPCMO",20,0)
 I $$GET^XPAR("DIV","PSB ROBOT RX"),PSBSCAN?1"3"15N!(PSBSCAN?1"3"17N),123[$E(PSBSCAN,12) S PSBSCAN=$E(PSBSCAN,2,11)
"RTN","PSBRPCMO",21,0)
 S PSBCNT=0
"RTN","PSBRPCMO",22,0)
 I PSBSCAN?.N I PSBOTYP'="OIT" D  ;is a scanned bar code
"RTN","PSBRPCMO",23,0)
 .I '$D(^PSDRUG(PSBSCAN)) S PSBSCAN=$$FIND1^DIC(50,"","AX",PSBSCAN,"B^C") I PSBSCAN<1 Q  ; not in the drug file
"RTN","PSBRPCMO",24,0)
 .Q:PSBOTYP="UD"&($P($G(^PSDRUG(PSBSCAN,2)),U,3)'["U")
"RTN","PSBRPCMO",25,0)
 .Q:PSBOTYP="UD"&($G(^PSDRUG(PSBSCAN,"I"))&(+$G(^("I"))'>PSBDT))
"RTN","PSBRPCMO",26,0)
 .S PSBOIEN=$$GET1^DIQ(50,PSBSCAN,"PHARMACY ORDERABLE ITEM","I") Q:PSBOIEN=""  ;orderable item ien
"RTN","PSBRPCMO",27,0)
 .D CPRS
"RTN","PSBRPCMO",28,0)
 .Q:PSBCPRS]""&(PSBCPRS'>PSBDT)
"RTN","PSBRPCMO",29,0)
 .;cprs orderable inact dt?
"RTN","PSBRPCMO",30,0)
 .I $P(A,U,4)="" Q
"RTN","PSBRPCMO",31,0)
 .I +$P(A,U,4)=0 Q  ;not inpat pharm item
"RTN","PSBRPCMO",32,0)
 .S PSBPOI=$$GET1^DIQ(50.7,PSBOIEN,.01)
"RTN","PSBRPCMO",33,0)
 .S PSBDD=$$GET1^DIQ(50,PSBSCAN,.01)
"RTN","PSBRPCMO",34,0)
 .I PSBOTYP="UD" D  Q
"RTN","PSBRPCMO",35,0)
 ..S PSBDRUG="DD"_U_PSBSCAN_U_PSBDD_U_PSBOIEN_U_PSBPOI_U_PSBORIEN_U_PSBORNM
"RTN","PSBRPCMO",36,0)
 ..S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBDRUG,RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",37,0)
 .I PSBOTYP="IV" D  Q
"RTN","PSBRPCMO",38,0)
 ..S PSBCNT=0
"RTN","PSBRPCMO",39,0)
 ..I $P(A,U,4)=2 D
"RTN","PSBRPCMO",40,0)
 ...I $D(^PSDRUG("A527",PSBSCAN)) D SOLN
"RTN","PSBRPCMO",41,0)
 ...I $D(^PSDRUG("A526",PSBSCAN)) D ADD
"RTN","PSBRPCMO",42,0)
 .S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)="-1^Medication does not match ordertype",RESULTS(0)=PSBCNT Q
"RTN","PSBRPCMO",43,0)
 I PSBSCAN?.N I PSBOTYP="OIT" D  ;scanned?
"RTN","PSBRPCMO",44,0)
 .I '$D(^PS(50.7,PSBSCAN)) S PSBSCAN=$$FIND1^DIC(50.7,"","AX",PSBSCAN,"B^C") I PSBSCAN<1 Q  ; not in the OItem file
"RTN","PSBRPCMO",45,0)
 .S PSBOIEN=PSBSCAN Q:PSBOIEN=""  ;ord item ien
"RTN","PSBRPCMO",46,0)
 .D CPRS
"RTN","PSBRPCMO",47,0)
 .Q:PSBCPRS]""&(PSBCPRS'>PSBDT)
"RTN","PSBRPCMO",48,0)
 .;cprs orderable inact dt?
"RTN","PSBRPCMO",49,0)
 .I $P(A,U,4)="" Q
"RTN","PSBRPCMO",50,0)
 .I +$P(A,U,4)=0 Q  ;not inpat pharm item
"RTN","PSBRPCMO",51,0)
 .S PSBPOI=$$GET1^DIQ(50.7,PSBOIEN,.01)
"RTN","PSBRPCMO",52,0)
 .S PSBDIEN=$$GETDRN^PSBOMT(PSBPOI)
"RTN","PSBRPCMO",53,0)
 .S PSBDD=$$GET1^DIQ(50,PSBDIEN,.01)
"RTN","PSBRPCMO",54,0)
 .S PSBDRUG="OIT"_U_PSBSCAN_U_PSBPOI_U_PSBDIEN_U_PSBDD_U_PSBORIEN_U_PSBORNM
"RTN","PSBRPCMO",55,0)
 .S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBDRUG,RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",56,0)
 .;
"RTN","PSBRPCMO",57,0)
 I PSBSCAN'?.N D
"RTN","PSBRPCMO",58,0)
 .I PSBOTYP="OIT" D OITMB
"RTN","PSBRPCMO",59,0)
 .I PSBOTYP'="OIT" K PSBMSG D LIST^DIC(50,"","2.1I;2.1","P","","",PSBSCAN,"B","","","^TMP(""PSBLST"",$J)","PSBMSG")
"RTN","PSBRPCMO",60,0)
 .;alpha-numerc look up "B" index drug file
"RTN","PSBRPCMO",61,0)
 .S X=0 F  S X=$O(^TMP("PSBLST",$J,"DILIST",X)) Q:X=""  D
"RTN","PSBRPCMO",62,0)
 ..Q:$P(^TMP("PSBLST",$J,"DILIST",X,0),U,3)=""
"RTN","PSBRPCMO",63,0)
 ..Q:$P(^TMP("PSBLST",$J,"DILIST",X,0),U,4)=""
"RTN","PSBRPCMO",64,0)
 ..I PSBOTYP'="OIT" D
"RTN","PSBRPCMO",65,0)
 ...I $P(^TMP("PSBLST",$J,"DILIST",X,0),U,3)'?.N S $P(^TMP("PSBLST",$J,"DILIST",X,0),U,3,99)=$P(^TMP("PSBLST",$J,"DILIST",X,0),U,4,99) Q
"RTN","PSBRPCMO",66,0)
 ...S ^TMP("PSB",$J,$P(^TMP("PSBLST",$J,"DILIST",X,0),U))=^TMP("PSBLST",$J,"DILIST",X,0)
"RTN","PSBRPCMO",67,0)
 ..I PSBOTYP="OIT" S ^TMP("PSB",$J,$P(^TMP("PSBLST",$J,"DILIST",X,0),U))=^TMP("PSBLST",$J,"DILIST",X,0)
"RTN","PSBRPCMO",68,0)
 .I PSBOTYP="OIT" D OITMC
"RTN","PSBRPCMO",69,0)
 .I PSBOTYP'="OIT"  K ^TMP("PSBLST",$J,"DILIST"),PSBMSG D LIST^DIC(50,"","2.1I;2.1","P","","",PSBSCAN,"C","","","^TMP(""PSBLST"",$J)","PSBMSG")
"RTN","PSBRPCMO",70,0)
 .;alpha-numerc look up "C" index drug file
"RTN","PSBRPCMO",71,0)
 .S X=0 F  S X=$O(^TMP("PSBLST",$J,"DILIST",X)) Q:X=""  D
"RTN","PSBRPCMO",72,0)
 ..Q:$P(^TMP("PSBLST",$J,"DILIST",X,0),U,3)=""
"RTN","PSBRPCMO",73,0)
 ..Q:$P(^TMP("PSBLST",$J,"DILIST",X,0),U,4)=""
"RTN","PSBRPCMO",74,0)
 ..I PSBOTYP'="OIT" D
"RTN","PSBRPCMO",75,0)
 ...I $P(^TMP("PSBLST",$J,"DILIST",X,0),U,3)'?.N S $P(^TMP("PSBLST",$J,"DILIST",X,0),U,3,99)=$P(^TMP("PSBLST",$J,"DILIST",X,0),U,4,99) Q
"RTN","PSBRPCMO",76,0)
 ...S ^TMP("PSB",$J,$P(^TMP("PSBLST",$J,"DILIST",X,0),U))=$P(^TMP("PSBLST",$J,"DILIST",X,0),U)_U_$P($G(^PSDRUG($P(^TMP("PSBLST",$J,"DILIST",X,0),U),0)),U)_U_$P(^TMP("PSBLST",$J,"DILIST",X,0),U,3,99)
"RTN","PSBRPCMO",77,0)
 ..I PSBOTYP="OIT" S ^TMP("PSB",$J,$P(^TMP("PSBLST",$J,"DILIST",X,0),U))=$P(^TMP("PSBLST",$J,"DILIST",X,0),U)_U_$P($G(^PSDRUG($P(^TMP("PSBLST",$J,"DILIST",X,0),U),0)),U)_U_$P(^TMP("PSBLST",$J,"DILIST",X,0),U,3,99)
"RTN","PSBRPCMO",78,0)
 .S PSBCNT=0,RESULTS(0)=0,PSBTLNG=0
"RTN","PSBRPCMO",79,0)
 .S X="" K PSBGOT F  S X=$O(^TMP("PSB",$J,X)) Q:((+X=0)!(PSBTLNG=1))  D
"RTN","PSBRPCMO",80,0)
 ..I PSBOTYP'="OIT" D
"RTN","PSBRPCMO",81,0)
 ...I $P(^TMP("PSB",$J,X),U,3)'?.N S $P(^TMP("PSB",$J,X),U,3,99)=$P(^TMP("PSB",$J,X),U,4,99)
"RTN","PSBRPCMO",82,0)
 ...S PSBOIEN=$P(^TMP("PSB",$J,X),U,3)
"RTN","PSBRPCMO",83,0)
 ...S PSBSCIEN=$P(^TMP("PSB",$J,X),U,1)
"RTN","PSBRPCMO",84,0)
 ..I PSBOTYP'="OIT" Q:PSBOTYP="UD"&($P($G(^PSDRUG(PSBSCIEN,2)),U,3)'["U")
"RTN","PSBRPCMO",85,0)
 ..I PSBOTYP'="OIT" Q:PSBOTYP="UD"&($G(^PSDRUG(PSBSCIEN,"I"))&(+$G(^("I"))'>PSBDT))
"RTN","PSBRPCMO",86,0)
 ..I PSBOTYP="OIT" D
"RTN","PSBRPCMO",87,0)
 ...S PSBOIEN=$P(^TMP("PSB",$J,X),U)
"RTN","PSBRPCMO",88,0)
 ..D CPRS
"RTN","PSBRPCMO",89,0)
 ..Q:PSBCPRS]""&(PSBCPRS'>PSBDT)
"RTN","PSBRPCMO",90,0)
 ..;cprs orderable inact dt?
"RTN","PSBRPCMO",91,0)
 ..I $P(A,U,4)="" Q
"RTN","PSBRPCMO",92,0)
 ..I +$P(A,U,4)=0 Q  ;not inpat pharm item
"RTN","PSBRPCMO",93,0)
 ..I PSBOTYP="OIT" D  Q
"RTN","PSBRPCMO",94,0)
 ...I $D(PSBGOT($P(^TMP("PSB",$J,X),U,4))) S $P(RESULTS(PSBCNT),U,2)=$P(RESULTS(PSBCNT),U,2)_","_$P(^TMP("PSB",$J,X),U) Q
"RTN","PSBRPCMO",95,0)
 ...S PSBDRUG="OIT"_U_$P(^TMP("PSB",$J,X),U)_U_$P(^TMP("PSB",$J,X),U,3,4)_U_PSBORIEN_U_PSBORNM,PSBGOT($P(^TMP("PSB",$J,X),U,4))=""
"RTN","PSBRPCMO",96,0)
 ...S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBDRUG,RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",97,0)
 ..I PSBOTYP="UD" D  Q
"RTN","PSBRPCMO",98,0)
 ...S PSBDRUG="DD"_U_$P(^TMP("PSB",$J,X),U,1,2)_U_$P(^TMP("PSB",$J,X),U,3,4)_U_PSBORIEN_U_PSBORNM
"RTN","PSBRPCMO",99,0)
 ...S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBDRUG,RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",100,0)
 ..I PSBOTYP="IV" D  Q
"RTN","PSBRPCMO",101,0)
 ...I $P(A,U,4)=2 D
"RTN","PSBRPCMO",102,0)
 ....I $D(^PSDRUG("A527",PSBSCIEN)) D SOLNAL
"RTN","PSBRPCMO",103,0)
 ....I $D(^PSDRUG("A526",PSBSCIEN)) D ADDAL
"RTN","PSBRPCMO",104,0)
 ..I RESULTS(0)>100 K RESULTS S RESULTS(0)=1,RESULTS(1)=-2,PSBTLNG=1 Q
"RTN","PSBRPCMO",105,0)
 I $G(RESULTS(1))="" S RESULTS(0)=1,RESULTS(1)="-1^Invalid Medication Lookup"
"RTN","PSBRPCMO",106,0)
 K PSBDD,PSBDRUG,PSBDT,PSBDTYP,PSBSCIEN,PSBOIEN,PSBORNM,PSBORIEN,PSBPOI,PSBSCAN,PSBTLNG,PSBID,PSBCPRS,^TMP("PSB",$J),^TMP("PSBLST",$J)
"RTN","PSBRPCMO",107,0)
 Q
"RTN","PSBRPCMO",108,0)
CPRS ;
"RTN","PSBRPCMO",109,0)
 S PSBID=PSBOIEN_";99PSP"
"RTN","PSBRPCMO",110,0)
 S A=$$EN^ORBCMA2(PSBID)
"RTN","PSBRPCMO",111,0)
 S PSBORNM=$P(A,U,2)
"RTN","PSBRPCMO",112,0)
 S PSBORIEN=$P(A,U,1)
"RTN","PSBRPCMO",113,0)
 S PSBCPRS=$P(A,U,3)
"RTN","PSBRPCMO",114,0)
 Q
"RTN","PSBRPCMO",115,0)
SOLN     ;
"RTN","PSBRPCMO",116,0)
 S X="" F  S X=$O(^PSDRUG("A527",PSBSCAN,X)) Q:X=""  D
"RTN","PSBRPCMO",117,0)
 .S PSBINACT=$$GET1^DIQ(52.7,X,8,"I") I PSBINACT]"",PSBINACT'>PSBDT Q
"RTN","PSBRPCMO",118,0)
 .S PSBDRUG="SOL"_U_PSBSCAN_U_PSBDD_U_PSBOIEN_U_PSBPOI_U_PSBORIEN_U_PSBORNM
"RTN","PSBRPCMO",119,0)
 .S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBDRUG_U_X_U_$$GET1^DIQ(52.7,X_",",.01)_U_$$GET1^DIQ(52.7,X_",",2),RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",120,0)
 Q
"RTN","PSBRPCMO",121,0)
ADD      ;
"RTN","PSBRPCMO",122,0)
 S X="" F  S X=$O(^PSDRUG("A526",PSBSCAN,X)) Q:X=""  D
"RTN","PSBRPCMO",123,0)
 .S PSBINACT=$$GET1^DIQ(52.6,X,12,"I") I PSBINACT]"",PSBINACT'>PSBDT Q
"RTN","PSBRPCMO",124,0)
 .S PSBDRUG="ADD"_U_PSBSCAN_U_PSBDD_U_PSBOIEN_U_PSBPOI_U_PSBORIEN_U_PSBORNM
"RTN","PSBRPCMO",125,0)
 .S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBDRUG_U_X_U_$$GET1^DIQ(52.6,X_",",.01),RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",126,0)
 Q
"RTN","PSBRPCMO",127,0)
OITMB ;
"RTN","PSBRPCMO",128,0)
 K PSBMSG D LIST^DIC(50.7,"",".01I;.01","P","","",PSBSCAN,"B","","","^TMP(""PSBLST"",$J)","PSBMSG")
"RTN","PSBRPCMO",129,0)
 Q
"RTN","PSBRPCMO",130,0)
OITMC ;
"RTN","PSBRPCMO",131,0)
 K PSBMSG D LIST^DIC(50.7,"",".01I;.01","P","","",PSBSCAN,"C","","","^TMP(""PSBLST"",$J)","PSBMSG")
"RTN","PSBRPCMO",132,0)
 Q
"RTN","PSBRPCMO",133,0)
SOLNAL   ;
"RTN","PSBRPCMO",134,0)
 S Y="" F  S Y=$O(^PSDRUG("A527",PSBSCIEN,Y)) Q:Y=""  D
"RTN","PSBRPCMO",135,0)
 .S PSBINACT=$$GET1^DIQ(52.7,Y,8,"I") I PSBINACT]"",PSBINACT'>PSBDT Q
"RTN","PSBRPCMO",136,0)
 .S PSBDRUG="SOL"_U_$P(^TMP("PSB",$J,X),U,1,2)_U_$P(^TMP("PSB",$J,X),U,3,4)_U_PSBORIEN_U_PSBORNM
"RTN","PSBRPCMO",137,0)
 .S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBDRUG_U_Y_U_$$GET1^DIQ(52.7,Y_",",.01)_U_$$GET1^DIQ(52.7,Y_",",2),RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",138,0)
 Q
"RTN","PSBRPCMO",139,0)
ADDAL    ;
"RTN","PSBRPCMO",140,0)
 S Y="" F  S Y=$O(^PSDRUG("A526",PSBSCIEN,Y)) Q:Y=""  D
"RTN","PSBRPCMO",141,0)
 .S PSBINACT=$$GET1^DIQ(52.6,Y,12,"I") I PSBINACT]"",PSBINACT'>PSBDT Q
"RTN","PSBRPCMO",142,0)
 .S PSBDRUG="ADD"_U_$P(^TMP("PSB",$J,X),U,1,2)_U_$P(^TMP("PSB",$J,X),U,3,4)_U_PSBORIEN_U_PSBORNM
"RTN","PSBRPCMO",143,0)
 .S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBDRUG_U_Y_U_$$GET1^DIQ(52.6,Y_",",.01),RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",144,0)
 Q
"RTN","PSBRPCMO",145,0)
PROVLST(RESULTS,PSBIN) ;
"RTN","PSBRPCMO",146,0)
 K ^TMP("PSB",$J) D NOW^%DTC
"RTN","PSBRPCMO",147,0)
 S PSBIN=$TR(PSBIN,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","PSBRPCMO",148,0)
 S RESULTS(0)=1,RESULTS(1)="-1^No provider matching input.",PSBTLNG=0
"RTN","PSBRPCMO",149,0)
 D LIST^DIC(200,"","","P","","",PSBIN,"B","","","^TMP(""PSB"",$J)","PSBMSG")
"RTN","PSBRPCMO",150,0)
 S X=0 F  S X=$O(^TMP("PSB",$J,"DILIST",X)) Q:((X="")!(PSBTLNG=1))  D
"RTN","PSBRPCMO",151,0)
 .S PSBIEN=$P(^TMP("PSB",$J,"DILIST",X,0),U,1)
"RTN","PSBRPCMO",152,0)
 .I '$D(^XUSEC("PROVIDER",PSBIEN)) Q
"RTN","PSBRPCMO",153,0)
 .S PSBIACT=$$GET1^DIQ(200,PSBIEN_",",53.4,"I")
"RTN","PSBRPCMO",154,0)
 .Q:PSBIACT'=""&(+PSBIACT'>%)  ;if Inactive date and date is less than now Q
"RTN","PSBRPCMO",155,0)
 .S PSBTERM=$$GET1^DIQ(200,PSBIEN_",",9.2,"I")
"RTN","PSBRPCMO",156,0)
 .Q:PSBTERM'=""&(+PSBTERM'>%)  ;if termination date and date is less than now Q
"RTN","PSBRPCMO",157,0)
 .S PSBAUTH=$$GET1^DIQ(200,PSBIEN_",",53.1,"I") I PSBAUTH'=1 Q  ;is AUTHORIZED TO WRITE MED ORDERS
"RTN","PSBRPCMO",158,0)
 .I RESULTS(1)["-1" S RESULTS(0)=0
"RTN","PSBRPCMO",159,0)
 .S RESULTS(0)=RESULTS(0)+1,RESULTS(RESULTS(0))=$P(^TMP("PSB",$J,"DILIST",X,0),U,1,2)
"RTN","PSBRPCMO",160,0)
 .I RESULTS(0)>100 K RESULTS S RESULTS(0)=1,RESULTS(1)=-2,PSBTLNG=1
"RTN","PSBRPCMO",161,0)
 K ^TMP("PSB",$J),PSBIN,PSBTLNG,PSBIACT,PSBIEN,PSBTERM,PSBAUTH
"RTN","PSBRPCMO",162,0)
 Q
"RTN","PSBRPCMO",163,0)
ORDER(RESULTS,PSBHDR,PSBREC) ;
"RTN","PSBRPCMO",164,0)
 S RESULTS(0)=1,RESULTS(1)="-1^Data not filed"
"RTN","PSBRPCMO",165,0)
 S PSBDFN=$P(PSBHDR,U,1),PSBMON=$P(PSBHDR,U,2),PSBSCH=$P(PSBHDR,U,3)
"RTN","PSBRPCMO",166,0)
 S ^TMP("PSBMO",$J,PSBDFN,PSBMON,0)=PSBDFN_U_PSBMON_U_PSBREC(0)_U_PSBREC(1)_U_PSBREC(2)_U_PSBSCH
"RTN","PSBRPCMO",167,0)
 S ^TMP("PSBMO",$J,PSBDFN,PSBMON,700,0)=0,^TMP("PSBMO",$J,PSBDFN,PSBMON,800,0)=0,^TMP("PSBMO",$J,PSBDFN,PSBMON,900,0)=0
"RTN","PSBRPCMO",168,0)
 I PSBREC(3)>0 D
"RTN","PSBRPCMO",169,0)
 .S ^TMP("PSBMO",$J,PSBDFN,PSBMON,700,0)=PSBREC(3)
"RTN","PSBRPCMO",170,0)
 .F I=1:1:PSBREC(3) D
"RTN","PSBRPCMO",171,0)
 ..S ^TMP("PSBMO",$J,PSBDFN,PSBMON,700,I,0)=$P(PSBREC(4),U,1)_U_$P(PSBREC(4),U,2)
"RTN","PSBRPCMO",172,0)
 ..S PSBREC(4)=$P(PSBREC(4),U,3,99)
"RTN","PSBRPCMO",173,0)
 I PSBREC(5)>0 D
"RTN","PSBRPCMO",174,0)
 .S ^TMP("PSBMO",$J,PSBDFN,PSBMON,800,0)=PSBREC(5)
"RTN","PSBRPCMO",175,0)
 .F I=1:1:PSBREC(5) S ^TMP("PSBMO",$J,PSBDFN,PSBMON,800,I,0)=$P(PSBREC(6),U,I)
"RTN","PSBRPCMO",176,0)
 I PSBREC(7)>0 D
"RTN","PSBRPCMO",177,0)
 .S ^TMP("PSBMO",$J,PSBDFN,PSBMON,900,0)=PSBREC(7)
"RTN","PSBRPCMO",178,0)
 .F I=1:1:PSBREC(7) S ^TMP("PSBMO",$J,PSBDFN,PSBMON,900,I,0)=$P(PSBREC(8),U,I)
"RTN","PSBRPCMO",179,0)
 S ^TMP("PSBMO",$J,PSBDFN,PSBMON,"PSB")=DUZ_U_DUZ(2)_U_PSBREC(9)_U_$G(PSBREC(10))
"RTN","PSBRPCMO",180,0)
 S RESULTS(0)=1,RESULTS(1)="1^Data successfully filed"
"RTN","PSBRPCMO",181,0)
 Q
"RTN","PSBRPCMO",182,0)
VACLKU ; 
"RTN","PSBRPCMO",183,0)
 D C^PSN50P65(,PSBSCAN,"PSBLST")
"RTN","PSBRPCMO",184,0)
 S PSBCNT=0,RESULTS(0)=0,PSBTLNG=0
"RTN","PSBRPCMO",185,0)
 S X=0 F  S X=$O(^TMP($J,"PSBLST",X)) Q:((+X=0)!(PSBTLNG=1))  D
"RTN","PSBRPCMO",186,0)
 .S PSBVAC="VAC"_U_X_U_^TMP($J,"PSBLST",X,1)_U_^TMP($J,"PSBLST",X,.01)
"RTN","PSBRPCMO",187,0)
 .S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBVAC,RESULTS(0)=PSBCNT
"RTN","PSBRPCMO",188,0)
 .I RESULTS(0)>100 K RESULTS S RESULTS(0)=1,RESULTS(1)=-2,PSBTLNG=1 Q
"RTN","PSBRPCMO",189,0)
 I $G(RESULTS(1))="" S RESULTS(0)=1,RESULTS(1)="-1^Invalid Medication Lookup"
"RTN","PSBRPCMO",190,0)
 K ^TMP($J,"PSBLST"),PSBVAC
"RTN","PSBRPCMO",191,0)
 Q
"RTN","PSBVDLIV")
0^4^B64891232^B63842623
"RTN","PSBVDLIV",1,0)
PSBVDLIV ;BIRMINGHAM/EFC-BCMA IV VIRTUAL DUE LIST ;Mar 2004
"RTN","PSBVDLIV",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,38,32**;Mar 2004;Build 32
"RTN","PSBVDLIV",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLIV",4,0)
 ;
"RTN","PSBVDLIV",5,0)
 ; Reference/IA
"RTN","PSBVDLIV",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLIV",7,0)
 ; EN^PSJBCMA1/2829 
"RTN","PSBVDLIV",8,0)
 ;
"RTN","PSBVDLIV",9,0)
EN(DFN,PSBDT) ; Default Order List Return for Today
"RTN","PSBVDLIV",10,0)
 ;
"RTN","PSBVDLIV",11,0)
 ; RPC: PSB GETORDERLIST
"RTN","PSBVDLIV",12,0)
 ;
"RTN","PSBVDLIV",13,0)
 ; Description:
"RTN","PSBVDLIV",14,0)
 ; Returns the current IV order set for today to display on the
"RTN","PSBVDLIV",15,0)
 ; client VDL
"RTN","PSBVDLIV",16,0)
 ;
"RTN","PSBVDLIV",17,0)
 N PSBDATA,PSBTBOUT,PSBDOADD
"RTN","PSBVDLIV",18,0)
 S PSBTBOUT=0,PSBDOADD=0
"RTN","PSBVDLIV",19,0)
 S:PSBTAB="IVTAB" PSBDOADD=1
"RTN","PSBVDLIV",20,0)
 ;
"RTN","PSBVDLIV",21,0)
 ; Passing PSBDT as 3rd parameter turns off the V.1.0 One-Time lookback
"RTN","PSBVDLIV",22,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J,"ON IVTAB") S X1=PSBDT,X2=-3 D C^%DTC S PSBDT2=X D EN^PSJBCMA(DFN,PSBDT2,PSBDT)
"RTN","PSBVDLIV",23,0)
 ;
"RTN","PSBVDLIV",24,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 Q  ; No orders
"RTN","PSBVDLIV",25,0)
 ;
"RTN","PSBVDLIV",26,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLIV",27,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLIV",28,0)
 .;
"RTN","PSBVDLIV",29,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLIV",30,0)
 .;
"RTN","PSBVDLIV",31,0)
 .Q:PSBONX'["V"  ; IVs only
"RTN","PSBVDLIV",32,0)
 .Q:PSBIVT["P"  ; No piggybacks
"RTN","PSBVDLIV",33,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLIV",34,0)
 .Q:PSBOST>($$FMADD^XLFDT($$NOW^XLFDT,,,$$GET^XPAR("DIV","PSB ADMIN BEFORE")))
"RTN","PSBVDLIV",35,0)
 .; Need to see if "last order" in chain is active/not pending.
"RTN","PSBVDLIV",36,0)
 .S PSBFON1=PSBFON,PSBLOOP=0 I $G(PSBFON)]"" S PSBLACTV=$S($G(PSBFON)["P":0,1:1) S PSBFON2=$G(PSBFON) I 'PSBLACTV F  D  Q:($G(PSBFON)="")!($G(PSBFON1)=$G(PSBFON2))!(PSBLOOP)!(PSBLACTV)  ;
"RTN","PSBVDLIV",37,0)
 ..I $G(PSBFON)["P" K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBFON2,1) I ^TMP("PSJ1",$J,0)=-1 S PSBFON=""
"RTN","PSBVDLIV",38,0)
 ..D:$G(PSBFON)["" CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBFON2)
"RTN","PSBVDLIV",39,0)
 ..I PSBFON=PSBFON2 S PSBLOOP=1,PSBLACTV=0 Q
"RTN","PSBVDLIV",40,0)
 ..S PSBLACTV=$S($G(PSBFON)["P":0,$G(PSBFON)']"":PSBLACTV,1:1),PSBFON2=$G(PSBFON)
"RTN","PSBVDLIV",41,0)
 ..S:(PSBLACTV)&($G(PSBOST)>($$FMADD^XLFDT($$NOW^XLFDT,,,$$GET^XPAR("DIV","PSB ADMIN BEFORE")))) PSBLACTV=0
"RTN","PSBVDLIV",42,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX) ;Refresh data
"RTN","PSBVDLIV",43,0)
 .K PSBCOMP,PSBCOMPX,PSBINFDT,PSBINFST D INFUSING^PSBVDLU2
"RTN","PSBVDLIV",44,0)
 .D NOW^%DTC
"RTN","PSBVDLIV",45,0)
 .I ((PSBOSTS="A")!(PSBOSTS="R"))&(PSBOSP<%) S PSBOSTS="E"
"RTN","PSBVDLIV",46,0)
 .I (PSBOSTS["D")&(PSBCOMP=0) Q  ;     Is it DC'd and not infusing or stopped
"RTN","PSBVDLIV",47,0)
 .I PSBOSTS="E",PSBCOMP=0 Q  ; Is expired and not infusing or stopped
"RTN","PSBVDLIV",48,0)
 .I PSBOSTS="D",PSBCOMP=1,($G(PSBFON)]""),PSBLACTV Q  ; order is DC'ed   will be picked up by following order
"RTN","PSBVDLIV",49,0)
 .I PSBOSTS="E",PSBCOMP=1,($G(PSBFON)]""),PSBLACTV Q  ; order is expired will be picked up by following order
"RTN","PSBVDLIV",50,0)
 .I PSBOSTS="R",PSBFOR="R",PSBOSP<PSBWBEG Q  ; order is renewed bag picked up by following order
"RTN","PSBVDLIV",51,0)
 .Q:$G(^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBONX))=1  ; The "previous order" is displayed on the VDL!
"RTN","PSBVDLIV",52,0)
 .I (PSBOSTS["E")&(PSBCOMP=0) Q  ;     Is it expired and not infusing
"RTN","PSBVDLIV",53,0)
 .I PSBIVT["S",PSBISYR=1 Q  ;     No intermittent syringes - done on PB tab
"RTN","PSBVDLIV",54,0)
 .I PSBIVT["C",PSBISYR=1 Q  ;     No intermittent syringes - done on PB tab
"RTN","PSBVDLIV",55,0)
 .I PSBIVT["C",PSBCHEMT="P" Q  ;  No Piggyback Chemos
"RTN","PSBVDLIV",56,0)
 .I PSBNGF&(PSBCOMP=1) Q  ;         Is it marked DO NOT GIVE!
"RTN","PSBVDLIV",57,0)
 .;
"RTN","PSBVDLIV",58,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLIV",59,0)
 .;
"RTN","PSBVDLIV",60,0)
 .D NOW^%DTC
"RTN","PSBVDLIV",61,0)
 .I PSBOSP<%,PSBOSTS'="R",PSBCOMP'=1 Q
"RTN","PSBVDLIV",62,0)
 .;
"RTN","PSBVDLIV",63,0)
 .; include Active, Renewed, ReInstated and On Call and Hold and Expired infusing
"RTN","PSBVDLIV",64,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call or Hold)
"RTN","PSBVDLIV",65,0)
 .Q:PSBSCHT'="O"&((PSBOSTS'="A")&(PSBOSTS'="R")&(PSBOSTS'="RE")&(PSBOSTS'="O")&(PSBOSTS'="D")&(PSBOSTS'="H")&(PSBOSTS'="E"))
"RTN","PSBVDLIV",66,0)
 .;
"RTN","PSBVDLIV",67,0)
 .; Is One Time Given
"RTN","PSBVDLIV",68,0)
 .;
"RTN","PSBVDLIV",69,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLIV",70,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLIV",71,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLIV",72,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLIV",73,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBON,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLIV",74,0)
 .;
"RTN","PSBVDLIV",75,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLIV",76,0)
 .;
"RTN","PSBVDLIV",77,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLIV",78,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLIV",79,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLIV",80,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLIV",81,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBON,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLIV",82,0)
 .;
"RTN","PSBVDLIV",83,0)
OK .S PSBSTRT=PSBOST ; Order Start Date/Time
"RTN","PSBVDLIV",84,0)
 .S PSBSTOP=PSBOSP ; Order Stop Date/Time
"RTN","PSBVDLIV",85,0)
 .;
"RTN","PSBVDLIV",86,0)
 .S PSBREC=""
"RTN","PSBVDLIV",87,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLIV",88,0)
 .S $P(PSBREC,U,2)=PSBONX ; Order
"RTN","PSBVDLIV",89,0)
 .S $P(PSBREC,U,3)=+PSBON ; order ien
"RTN","PSBVDLIV",90,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLIV",91,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLIV",92,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLIV",93,0)
 .S Y=""
"RTN","PSBVDLIV",94,0)
 .S:PSBSM Y="SM"
"RTN","PSBVDLIV",95,0)
 .S:PSBHSM Y="HSM"
"RTN","PSBVDLIV",96,0)
 .S $P(PSBREC,U,7)=Y ; self med
"RTN","PSBVDLIV",97,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLIV",98,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLIV",99,0)
 .S $P(PSBREC,U,10)=PSBMR ; med route
"RTN","PSBVDLIV",100,0)
 .; IV Information Column *new*  -  status date/time
"RTN","PSBVDLIV",101,0)
 .; (only stopped or infusing)
"RTN","PSBVDLIV",102,0)
 .;
"RTN","PSBVDLIV",103,0)
 .D:PSBCOMP 
"RTN","PSBVDLIV",104,0)
 ..S $P(PSBREC,U,11)=PSBINFDT K PSBINFDT
"RTN","PSBVDLIV",105,0)
 ..S PSBSTUS=PSBINFST,$P(PSBREC,U,20)=PSBSTUS K PSBINFST
"RTN","PSBVDLIV",106,0)
 .S $P(PSBREC,U,14)="" ; admin date inserted below
"RTN","PSBVDLIV",107,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLIV",108,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;Set injectable med route flag
"RTN","PSBVDLIV",109,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLIV",110,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLIV",111,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLIV",112,0)
 .S $P(PSBREC,U,18)=PSBIVT  ;IV TYPE
"RTN","PSBVDLIV",113,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLIV",114,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLIV",115,0)
 .S $P(PSBREC,U,26)=PSBSTOP
"RTN","PSBVDLIV",116,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLIV",117,0)
 .;
"RTN","PSBVDLIV",118,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLIV",119,0)
 .D NOW^%DTC
"RTN","PSBVDLIV",120,0)
 .S (PSBDDS,PSBSOLS,PSBADDS)="0"
"RTN","PSBVDLIV",121,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLIV",122,0)
 ..Q:$P(PSBDDA(Y),U,4)&($P(PSBDDA(Y),U,4)<%)  ; Inactive
"RTN","PSBVDLIV",123,0)
 ..S:$P(PSBDDA(Y),U,3)="" $P(PSBDDA(Y),U,3)=1
"RTN","PSBVDLIV",124,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,3)
"RTN","PSBVDLIV",125,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLIV",126,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLIV",127,0)
 .S PSBQRR=0
"RTN","PSBVDLIV",128,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLIV",129,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"IVTAB",0)=2,^TMP("PSB",$J,"IVTAB",1)=1,^TMP("PSB",$J,"IVTAB",2)=1 Q
"RTN","PSBVDLIV",130,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"IVTAB")
"RTN","PSBVDLIV",131,0)
 ..S:$G(PSBFON)'="" ^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBFON)=1  ; Now do not have to place "following order" on VDL!
"RTN","PSBVDLIV",132,0)
 .;
"RTN","PSBVDLIV",133,0)
 .; IV's - don't worry about admin times if blank
"RTN","PSBVDLIV",134,0)
 .I PSBONX["V",PSBIVT'="P",PSBADST="" D  Q
"RTN","PSBVDLIV",135,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"IVTAB",0)=2,^TMP("PSB",$J,"IVTAB",1)=1,^TMP("PSB",$J,"IVTAB",2)=1 Q
"RTN","PSBVDLIV",136,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"IVTAB")
"RTN","PSBVDLIV",137,0)
 ..S:$G(PSBFON)'="" ^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBFON)=1  ; Now do not have to place "following order" on VDL!
"RTN","PSBVDLIV",138,0)
 .;
"RTN","PSBVDLIV",139,0)
 .; Now we deal with only continuous
"RTN","PSBVDLIV",140,0)
 .; process admintimes
"RTN","PSBVDLIV",141,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLIV",142,0)
 .S PSBADMIN=PSBADST
"RTN","PSBVDLIV",143,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLIV",144,0)
 .; build all orders for both days.
"RTN","PSBVDLIV",145,0)
 .F PSBY=1:1 Q:$P(PSBADMIN,"-",PSBY)=""  D
"RTN","PSBVDLIV",146,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLIV",147,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLIV",148,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLIV",149,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLIV",150,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,$P(PSB,"."),PSBSCH,PSBON,PSBOITX,PSBFREQ)  ; Okay on this date?
"RTN","PSBVDLIV",151,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"IVTAB",0)=2,^TMP("PSB",$J,"IVTAB",1)=1,^TMP("PSB",$J,"IVTAB",2)=1 Q
"RTN","PSBVDLIV",152,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"IVTAB")
"RTN","PSBVDLIV",153,0)
 .....S:$G(PSBFON)'="" ^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBFON)=1  ; Now do not have to place "following order" on VDL!
"RTN","PSBVDLIV",154,0)
 ..;
"RTN","PSBVDLIV",155,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLIV",156,0)
 ..;
"RTN","PSBVDLIV",157,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLIV",158,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLIV",159,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLIV",160,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLIV",161,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,$P(PSB,"."),PSBSCH,PSBON,PSBOITX,PSBFREQ)  ; Okay on this date?
"RTN","PSBVDLIV",162,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"IVTAB",0)=2,^TMP("PSB",$J,"IVTAB",1)=1,^TMP("PSB",$J,"IVTAB",2)=1 Q
"RTN","PSBVDLIV",163,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"IVTAB")
"RTN","PSBVDLIV",164,0)
 .....S:$G(PSBFON)'="" ^TMP("PSB",$J,"ON IVTAB",PSBDFN,PSBFON)=1  ; Now do not have to place "following order" on VDL!
"RTN","PSBVDLIV",165,0)
 K ^TMP("PSB",$J,"ON IVTAB")
"RTN","PSBVDLIV",166,0)
 ;
"RTN","PSBVDLIV",167,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLIV",168,0)
 D:PSBDOADD VNURSE^PSBVDLU1("IVTAB")
"RTN","PSBVDLIV",169,0)
 Q
"RTN","PSBVDLIV",170,0)
 ;
"RTN","PSBVDLPA")
0^5^B14269573^B13072762
"RTN","PSBVDLPA",1,0)
PSBVDLPA ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;Mar 2004
"RTN","PSBVDLPA",2,0)
 ;;3.0;BAR CODE MED ADMIN;**5,16,13,38,32**;Mar 2004;Build 32
"RTN","PSBVDLPA",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLPA",4,0)
 ;
"RTN","PSBVDLPA",5,0)
 ; called by PSBVDLUD to find patches not removed
"RTN","PSBVDLPA",6,0)
 ;
"RTN","PSBVDLPA",7,0)
 ; Reference/IA
"RTN","PSBVDLPA",8,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLPA",9,0)
 ; $$FMADD^XLFDT/10103
"RTN","PSBVDLPA",10,0)
 ;
"RTN","PSBVDLPA",11,0)
EN ;
"RTN","PSBVDLPA",12,0)
 S PSBGNODE="^PSB(53.79,"_"""APATCH"""_","_DFN_")"
"RTN","PSBVDLPA",13,0)
 F  S PSBGNODE=$Q(@PSBGNODE) Q:PSBGNODE']""  Q:($QS(PSBGNODE,2)'="APATCH")!($QS(PSBGNODE,3)'=DFN)  D
"RTN","PSBVDLPA",14,0)
 .S PSBIEN=$QS(PSBGNODE,5)
"RTN","PSBVDLPA",15,0)
 .I '$D(^PSB(53.79,PSBIEN,.5,1)) Q
"RTN","PSBVDLPA",16,0)
 .I $P(^PSB(53.79,PSBIEN,.5,1,0),U,4)'="PATCH" Q
"RTN","PSBVDLPA",17,0)
 .I "G"'[$P(^PSB(53.79,PSBIEN,0),U,9)!($D(PSBONVDL(PSBIEN))) Q
"RTN","PSBVDLPA",18,0)
 .S PSBPBK=+($$GET^XPAR("DIV","PSB VDL PATCH DAYS"))
"RTN","PSBVDLPA",19,0)
 .S PSBZON=$P(^PSB(53.79,PSBIEN,.1),"^")
"RTN","PSBVDLPA",20,0)
 .D CLEAN^PSBVT
"RTN","PSBVDLPA",21,0)
 .D PSJ1^PSBVT(DFN,PSBZON)
"RTN","PSBVDLPA",22,0)
 .I PSBPBK'=0 D NOW^%DTC I ($$FMADD^XLFDT($P(PSBOSP,"."),(PSBPBK))<X) Q
"RTN","PSBVDLPA",23,0)
 .S $P(PSBREC,U,1)=DFN  ; dfn
"RTN","PSBVDLPA",24,0)
 .S $P(PSBREC,U,2)=PSBONX  ; order numer
"RTN","PSBVDLPA",25,0)
 .S $P(PSBREC,U,3)=PSBON  ; order ien
"RTN","PSBVDLPA",26,0)
 .S $P(PSBREC,U,4)="U"  ; order type U unit dose
"RTN","PSBVDLPA",27,0)
 .S $P(PSBREC,U,5)=PSBSCHT
"RTN","PSBVDLPA",28,0)
 .S $P(PSBREC,U,6)=PSBSCH
"RTN","PSBVDLPA",29,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"")
"RTN","PSBVDLPA",30,0)
 .S $P(PSBREC,U,8)=PSBOITX
"RTN","PSBVDLPA",31,0)
 .S $P(PSBREC,U,9)=PSBDOSE
"RTN","PSBVDLPA",32,0)
 .S $P(PSBREC,U,10)=PSBMR
"RTN","PSBVDLPA",33,0)
 .S:$D(PSBHSTAX(PSBOIT)) $P(PSBREC,U,11)=$O(PSBHSTAX(PSBOIT,""),-1),$P(PSBREC,U,20)=$O(PSBHSTAX(PSBOIT,$P(PSBREC,U,11),""),-1)
"RTN","PSBVDLPA",34,0)
 .D:'$D(PSBHSTAX(PSBOIT))
"RTN","PSBVDLPA",35,0)
 ..N PSBX,PSBY,PSBDONE S PSBDONE=0,PSBX="" F  S PSBX=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,PSBX),-1) Q:PSBX=""  D:'PSBDONE
"RTN","PSBVDLPA",36,0)
 ...S PSBY="" F  S PSBY=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,PSBX,PSBY),-1) Q:PSBY=""  D:'PSBDONE
"RTN","PSBVDLPA",37,0)
 ....S:$P(^PSB(53.79,PSBY,0),U,9)'="N" $P(PSBREC,U,20)=$P(^PSB(53.79,PSBY,0),U,9) S:($P(PSBREC,U,20)'="N")&($P(PSBREC,U,20)]"") $P(PSBREC,U,11)=PSBX,PSBDONE=1
"RTN","PSBVDLPA",38,0)
 .S $P(PSBREC,U,12)=PSBIEN
"RTN","PSBVDLPA",39,0)
 .S $P(PSBREC,U,13)="G"
"RTN","PSBVDLPA",40,0)
 .S $P(PSBREC,U,14)=$P(^PSB(53.79,PSBIEN,.1),U,3)
"RTN","PSBVDLPA",41,0)
 .I $P(PSBREC,U,14)="" S $P(PSBREC,U,14)=PSBNOW\1
"RTN","PSBVDLPA",42,0)
 .S $P(PSBREC,U,15)=PSBOIT
"RTN","PSBVDLPA",43,0)
 .D:($G(PSBTAB)="CVRSHT")!($G(PSBTAB)="UDTAB")
"RTN","PSBVDLPA",44,0)
 ..S $P(PSBREC,U,16)=$S($G(PSBX)="":0,1:PSBNJECT)  ;Set injectable med route flag
"RTN","PSBVDLPA",45,0)
 ..I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPA",46,0)
 ..E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPA",47,0)
 ..S $P(PSBREC,U,19)=$S(PSBVNI]"":PSBVNI,PSBVNI']"":"***")
"RTN","PSBVDLPA",48,0)
 ..S $P(PSBREC,U,23)=""
"RTN","PSBVDLPA",49,0)
 ..S $P(PSBREC,U,26)=PSBOSP
"RTN","PSBVDLPA",50,0)
 ..S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL($P(PSBREC,U),$P(PSBREC,U,15))
"RTN","PSBVDLPA",51,0)
 ..S $P(PSBREC,U,28)=0
"RTN","PSBVDLPA",52,0)
 ..I ($G(PSBTAB)="CVRSHT") S $P(PSBREC,U,28)=1
"RTN","PSBVDLPA",53,0)
 ..I ($G(PSBTAB)="UDTAB") I PSBSCHT'="O" S:(PSBOSTS="E")!(PSBOSTS["D") $P(PSBREC,U,28)=1
"RTN","PSBVDLPA",54,0)
 ..; Place into Coversheet activity ARRAY
"RTN","PSBVDLPA",55,0)
 ..S PSBDIDX="" I $D(^PSB(53.79,"AORD",DFN,PSBONX)) D
"RTN","PSBVDLPA",56,0)
 ...S PSBXDTI="",PSBXDTI=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBXDTI),-1)
"RTN","PSBVDLPA",57,0)
 ...Q:'$D(^PSB(53.79,"AORD",DFN,PSBONX,PSBXDTI,PSBIEN))
"RTN","PSBVDLPA",58,0)
 ...S PSBADMX(PSBONX,PSBXDTI,PSBIEN)="",PSBDIDX=1
"RTN","PSBVDLPA",59,0)
 ..I ('PSBDIDX)&$D(^PSB(53.79,"AORDX",DFN,PSBONX)) D
"RTN","PSBVDLPA",60,0)
 ...S PSBXXDTI="",PSBXXDTI=$O(^PSB(53.79,"AORDX",DFN,PSBONX,PSBXXDTI),-1)
"RTN","PSBVDLPA",61,0)
 ...Q:'$D(^PSB(53.79,"AORDX",DFN,PSBONX,PSBXXDTI,PSBIEN))
"RTN","PSBVDLPA",62,0)
 ...S PSBADMX(PSBONX,PSBXXDTI,PSBIEN)=""
"RTN","PSBVDLPA",63,0)
 .S $P(PSBREC,U,18)="PATCH"
"RTN","PSBVDLPA",64,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPA",65,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPA",66,0)
 .S PSBDDS="" F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1 S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4),$P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPA",67,0)
 .S PSBQRR=1
"RTN","PSBVDLPA",68,0)
 .D ADD^PSBVDLU1(PSBREC,PSBOTXT,$P(PSBREC,U,14),PSBDDS,"","",$S($G(PSBTAB)="CVRSHT":"CVRSHT",1:"UDTAB"))
"RTN","PSBVDLPA",69,0)
 K PSBPBK,PSBONVDL
"RTN","PSBVDLPA",70,0)
 Q
"RTN","PSBVDLPB")
0^6^B84339599^B83184850
"RTN","PSBVDLPB",1,0)
PSBVDLPB ;BIRMINGHAM/EFC-BCMA IV VIRTUAL DUE LIST ;Mar 2004
"RTN","PSBVDLPB",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13,38,32**;Mar 2004;Build 32
"RTN","PSBVDLPB",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLPB",4,0)
 ;
"RTN","PSBVDLPB",5,0)
 ; Reference/IA
"RTN","PSBVDLPB",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLPB",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLPB",8,0)
 ; File 200/10060
"RTN","PSBVDLPB",9,0)
 ;
"RTN","PSBVDLPB",10,0)
EN(DFN,PSBDT) ; Default Order List Return for Today
"RTN","PSBVDLPB",11,0)
 ;
"RTN","PSBVDLPB",12,0)
 ; RPC: PSB GETORDERLIST
"RTN","PSBVDLPB",13,0)
 ;
"RTN","PSBVDLPB",14,0)
 ; Description:
"RTN","PSBVDLPB",15,0)
 ; Returns the current IV order set for today to display on the
"RTN","PSBVDLPB",16,0)
 ; client VDL
"RTN","PSBVDLPB",17,0)
 ;
"RTN","PSBVDLPB",18,0)
 ;
"RTN","PSBVDLPB",19,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLPB",20,0)
 S PSBTBOUT=0,PSBDOADD=0
"RTN","PSBVDLPB",21,0)
 S:PSBTAB="PBTAB" PSBDOADD=1
"RTN","PSBVDLPB",22,0)
 ;
"RTN","PSBVDLPB",23,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLPB",24,0)
 ;
"RTN","PSBVDLPB",25,0)
 I $G(^TMP("PSJ",$J,1,0))=-1 Q  ; No orders
"RTN","PSBVDLPB",26,0)
 ;
"RTN","PSBVDLPB",27,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLPB",28,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLPB",29,0)
 .;
"RTN","PSBVDLPB",30,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLPB",31,0)
 .;
"RTN","PSBVDLPB",32,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLPB",33,0)
 .Q:'$$IVPTAB^PSBVDLU3(PSBOTYP,PSBIVT,PSBISYR,PSBCHEMT,PSBIVPSH)
"RTN","PSBVDLPB",34,0)
 .Q:PSBOST>PSBWADM  ; Order Start Date/Time > admin window
"RTN","PSBVDLPB",35,0)
 .Q:PSBOSP<PSBWBEG  ; For all Order Stop Date/Time < vdl window
"RTN","PSBVDLPB",36,0)
 .Q:PSBOSTS["D"  ;     Is it DC'd
"RTN","PSBVDLPB",37,0)
 .Q:PSBNGF  ;  Is it marked DO NOT GIVE!
"RTN","PSBVDLPB",38,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLPB",39,0)
 .;
"RTN","PSBVDLPB",40,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",41,0)
 .Q:PSBOSP<%
"RTN","PSBVDLPB",42,0)
 .;
"RTN","PSBVDLPB",43,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLPB",44,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLPB",45,0)
 .Q:PSBSCHT'="O"&((PSBOSTS'="A")&(PSBOSTS'="R")&(PSBOSTS'="RE")&(PSBOSTS'="O")&(PSBOSTS'="H"))
"RTN","PSBVDLPB",46,0)
 .;
"RTN","PSBVDLPB",47,0)
 .; Is One Time Given
"RTN","PSBVDLPB",48,0)
 .;
"RTN","PSBVDLPB",49,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLPB",50,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",51,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",52,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBONX)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",53,0)
 .;
"RTN","PSBVDLPB",54,0)
 .; How long does One Time remain on VDL ?
"RTN","PSBVDLPB",55,0)
 .S PSBRMN=1
"RTN","PSBVDLPB",56,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST,%>PSBOSP S PSBRMN=0
"RTN","PSBVDLPB",57,0)
 .Q:'PSBRMN
"RTN","PSBVDLPB",58,0)
 .;
"RTN","PSBVDLPB",59,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLPB",60,0)
 .;
"RTN","PSBVDLPB",61,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLPB",62,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLPB",63,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLPB",64,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  S:($P(^PSB(53.79,Y,.1),U)=PSBON)&($P(^PSB(53.79,Y,0),U,9)="G") PSBGVN=1,(X,Y)=0
"RTN","PSBVDLPB",65,0)
 .;
"RTN","PSBVDLPB",66,0)
 .S PSBSTRT=PSBOST ; Order Start Date/Time
"RTN","PSBVDLPB",67,0)
 .S PSBSTOP=PSBOSP ; Order Stop Date/Time
"RTN","PSBVDLPB",68,0)
 .;
"RTN","PSBVDLPB",69,0)
 .S PSBREC=""
"RTN","PSBVDLPB",70,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLPB",71,0)
 .S $P(PSBREC,U,2)=PSBONX ; Order
"RTN","PSBVDLPB",72,0)
 .S $P(PSBREC,U,3)=+PSBON ; order ien
"RTN","PSBVDLPB",73,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLPB",74,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLPB",75,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLPB",76,0)
 .S Y=""
"RTN","PSBVDLPB",77,0)
 .S:PSBSM Y="SM"
"RTN","PSBVDLPB",78,0)
 .S:PSBHSM Y="HSM"
"RTN","PSBVDLPB",79,0)
 .S $P(PSBREC,U,7)=Y ; self med
"RTN","PSBVDLPB",80,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLPB",81,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLPB",82,0)
 .S $P(PSBREC,U,10)=PSBMR ;med route
"RTN","PSBVDLPB",83,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLPB",84,0)
 .S (YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLPB",85,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLPB",86,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLPB",87,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLPB",88,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLPB",89,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLPB",90,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLPB",91,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",92,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLPB",93,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLPB",94,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLPB",95,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLPB",96,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLPB",97,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLPB",98,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLPB",99,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLPB",100,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLPB",101,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLPB",102,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLPB",103,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",104,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLPB",105,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLPB",106,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLPB",107,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLPB",108,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLPB",109,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLPB",110,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLPB",111,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLPB",112,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLPB",113,0)
 .S $P(PSBREC,U,14)="" ;admin date inserted below
"RTN","PSBVDLPB",114,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLPB",115,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;Set injectable med route flag
"RTN","PSBVDLPB",116,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLPB",117,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLPB",118,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLPB",119,0)
 .S $P(PSBREC,U,18)=PSBIVT  ;IV TYPE - dosage form
"RTN","PSBVDLPB",120,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ;last action status
"RTN","PSBVDLPB",121,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLPB",122,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLPB",123,0)
 .S $P(PSBREC,U,26)=PSBSTOP
"RTN","PSBVDLPB",124,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLPB",125,0)
 .;
"RTN","PSBVDLPB",126,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLPB",127,0)
 .D NOW^%DTC
"RTN","PSBVDLPB",128,0)
 .S (PSBDDS,PSBSOLS,PSBADDS)="0"
"RTN","PSBVDLPB",129,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLPB",130,0)
 ..Q:$P(PSBDDA(Y),U,4)&($P(PSBDDA(Y),U,4)<%)  ; Inactive
"RTN","PSBVDLPB",131,0)
 ..S:$P(PSBDDA(Y),U,3)="" $P(PSBDDA(Y),U,3)=1
"RTN","PSBVDLPB",132,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,3)
"RTN","PSBVDLPB",133,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLPB",134,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLPB",135,0)
 .S PSBQRR=0
"RTN","PSBVDLPB",136,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D  Q
"RTN","PSBVDLPB",137,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",138,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",139,0)
 .;
"RTN","PSBVDLPB",140,0)
 .; IV's - don't worry about admin times if blank
"RTN","PSBVDLPB",141,0)
 .I PSBONX["V","PSC"'[PSBIVT,PSBADST="" D  Q
"RTN","PSBVDLPB",142,0)
 ..I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",143,0)
 ..D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1_".",PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",144,0)
 .;
"RTN","PSBVDLPB",145,0)
 .; Now we deal with only continuous
"RTN","PSBVDLPB",146,0)
 .; process admintimes
"RTN","PSBVDLPB",147,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLPB",148,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLPB",149,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",150,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLPB",151,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLPB",152,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLPB",153,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLPB",154,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLPB",155,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLPB",156,0)
 .S PSBADMIN=PSBADST
"RTN","PSBVDLPB",157,0)
 .I (PSBADMIN="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("PBTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLPB",158,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLPB",159,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLPB",160,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLPB",161,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLPB",162,0)
 .; build all orders for both days.
"RTN","PSBVDLPB",163,0)
 .F PSBY=1:1 Q:$P(PSBADMIN,"-",PSBY)=""  D
"RTN","PSBVDLPB",164,0)
 ..;For invalid admin times
"RTN","PSBVDLPB",165,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLPB",166,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLPB",167,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",168,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",169,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",170,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",171,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",172,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",173,0)
 ..;
"RTN","PSBVDLPB",174,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLPB",175,0)
 ..;
"RTN","PSBVDLPB",176,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLPB",177,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADMIN,"-",PSBY))
"RTN","PSBVDLPB",178,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLPB",179,0)
 ...D:(PSB'<PSBSTRT)&(PSB<PSBSTOP)  ; Make sure this time is active
"RTN","PSBVDLPB",180,0)
 ....D:$$OKAY^PSBVDLU1(PSBSTRT,PSB,PSBSCH,PSBON,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLPB",181,0)
 .....I 'PSBDOADD S PSBTBOUT=1,^TMP("PSB",$J,"PBTAB",0)=2,^TMP("PSB",$J,"PBTAB",1)=1,^TMP("PSB",$J,"PBTAB",2)=1 Q
"RTN","PSBVDLPB",182,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"PBTAB")
"RTN","PSBVDLPB",183,0)
 ;
"RTN","PSBVDLPB",184,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLPB",185,0)
 D:PSBDOADD VNURSE^PSBVDLU1("PBTAB")
"RTN","PSBVDLPB",186,0)
 Q
"RTN","PSBVDLPB",187,0)
 ;
"RTN","PSBVDLU1")
0^33^B56720920^B56415430
"RTN","PSBVDLU1",1,0)
PSBVDLU1 ;BIRMINGHAM/EFC-VIRTUAL DUE LIST (VDL) UTILITIES ;Mar 2004
"RTN","PSBVDLU1",2,0)
 ;;3.0;BAR CODE MED ADMIN;**13,32**;Mar 2004;Build 32
"RTN","PSBVDLU1",3,0)
 ;
"RTN","PSBVDLU1",4,0)
 ; Reference/IA
"RTN","PSBVDLU1",5,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBVDLU1",6,0)
 ;
"RTN","PSBVDLU1",7,0)
ODDSCH(PSBTABX) ;
"RTN","PSBVDLU1",8,0)
 I (PSBOST'<PSBWBEG)&(PSBOST'>PSBWEND) D ADD(PSBREC,PSBOTXT,PSBOST,PSBDDS,PSBSOLS,PSBADDS,PSBTABX)  ;Include start date/time as admin
"RTN","PSBVDLU1",9,0)
 S PSBQUIT=0,PSBCDT=PSBOST F  S PSBCDT=$$FMADD^XLFDT(PSBCDT,"","",PSBFREQ) Q:PSBQUIT=1  D
"RTN","PSBVDLU1",10,0)
 .I $P(PSBCDT,".",2)="" S PSBCDT=PSBCDT-1_".24"
"RTN","PSBVDLU1",11,0)
 .I PSBCDT>PSBWEND S PSBQUIT=1 Q
"RTN","PSBVDLU1",12,0)
 .I PSBCDT'<PSBWBEG,PSBCDT<PSBOSP D ADD(PSBREC,PSBOTXT,PSBCDT,PSBDDS,PSBSOLS,PSBADDS,PSBTABX) Q
"RTN","PSBVDLU1",13,0)
 Q
"RTN","PSBVDLU1",14,0)
GETFREQ(PSBDFN,PSBORDN) ;
"RTN","PSBVDLU1",15,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",16,0)
 D EN^PSJBCMA1(PSBDFN,PSBORDN,1)
"RTN","PSBVDLU1",17,0)
 S PSBFREQ=$P(^TMP("PSJ1",$J,4),U,11)
"RTN","PSBVDLU1",18,0)
 S PSBSCHBR=$P(^TMP("PSJ1",$J,2),"^",5)
"RTN","PSBVDLU1",19,0)
 I $$PSBDCHK1^PSBVT1(PSBSCHBR) S PSBFREQ=""
"RTN","PSBVDLU1",20,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",21,0)
 Q PSBFREQ
"RTN","PSBVDLU1",22,0)
 ;
"RTN","PSBVDLU1",23,0)
GETADMIN(PSBDFN,PSBORDN,PSBSTRT,PSBFREQ,PSBEVDT) ;
"RTN","PSBVDLU1",24,0)
 ;Determine administration times of an odd schedule for today
"RTN","PSBVDLU1",25,0)
 N PSBADMIN
"RTN","PSBVDLU1",26,0)
 K ^TMP("PSB",$J,"GETADMIN")
"RTN","PSBVDLU1",27,0)
 D EN^PSJBCMA1(PSBDFN,PSBORDN,1)
"RTN","PSBVDLU1",28,0)
 S PSBADMIN=$P(^TMP("PSJ1",$J,4),U,9),PSBFREQ=$P(^TMP("PSJ1",$J,4),U,11),^TMP("PSB",$J,"GETADMIN",0)=PSBADMIN
"RTN","PSBVDLU1",29,0)
 I $E(PSBFREQ)'?1N K ^TMP("PSJ1",$J) Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",30,0)
 I PSBFREQ=0 K ^TMP("PSJ1",$J) Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",31,0)
 I PSBSTRT'<PSBEVDT S PSBADMIN=$E($P(PSBSTRT,".",2)_"0000",1,4),^TMP("PSB",$J,"GETADMIN",0)=PSBADMIN
"RTN","PSBVDLU1",32,0)
 S PSBCDT=PSBSTRT,(PSBADTMX,PSBQUIT)=0 F  S PSBCDT=$$FMADD^XLFDT(PSBCDT,"","",PSBFREQ) D  Q:PSBQUIT=1
"RTN","PSBVDLU1",33,0)
 .I $P(PSBCDT,".",2)="" S PSBCDT=PSBCDT-1_".24"
"RTN","PSBVDLU1",34,0)
 .I (PSBCDT\1)>(PSBEVDT\1) S PSBQUIT=1 Q
"RTN","PSBVDLU1",35,0)
 .I (PSBCDT\1)=(PSBEVDT\1) S PSBADMIN=PSBADMIN_$S(PSBADMIN="":"",1:"-")_$E($P(PSBCDT,".",2)_"0000",1,4)
"RTN","PSBVDLU1",36,0)
 .S ^TMP("PSB",$J,"GETADMIN",PSBADTMX)=PSBADMIN
"RTN","PSBVDLU1",37,0)
 .S:($L(PSBADMIN)+5)>255 PSBADTMX=PSBADTMX+1,PSBADMIN=""
"RTN","PSBVDLU1",38,0)
 K ^TMP("PSJ1",$J),PSBADTMX
"RTN","PSBVDLU1",39,0)
 Q $G(^TMP("PSB",$J,"GETADMIN",0))
"RTN","PSBVDLU1",40,0)
 ;
"RTN","PSBVDLU1",41,0)
ADD(PSBREC,PSBSI,PSBDT,PSBDD,PSBSOL,PSBADD,PSBTAB) ;
"RTN","PSBVDLU1",42,0)
 ;
"RTN","PSBVDLU1",43,0)
 ; Description: Add order to ^TMP("PSB",$J,PSBTAB,...) for RPC Return RESULTS
"RTN","PSBVDLU1",44,0)
 ;
"RTN","PSBVDLU1",45,0)
 ; PSBREC=order hdr from above
"RTN","PSBVDLU1",46,0)
 ; PSBSI=special instructions
"RTN","PSBVDLU1",47,0)
 ; PSBDT=admin date/time
"RTN","PSBVDLU1",48,0)
 ; PSBDD=Dispense Drugs
"RTN","PSBVDLU1",49,0)
 ; PSBSOL=Solutions
"RTN","PSBVDLU1",50,0)
 ; PSBADD=Additives
"RTN","PSBVDLU1",51,0)
 ;
"RTN","PSBVDLU1",52,0)
 N PSB
"RTN","PSBVDLU1",53,0)
 S PSBDT=$E(PSBDT,1,12),PSBQR=0
"RTN","PSBVDLU1",54,0)
 S PSB=$O(^TMP("PSB",$J,PSBTAB,""),-1) ; Get next node
"RTN","PSBVDLU1",55,0)
 S $P(PSBREC,U,14)=PSBDT ; Admin Time sits in ^14
"RTN","PSBVDLU1",56,0)
 I $P(PSBREC,U,5)'="O" S X=$O(^PSB(53.79,"AORD",DFN,PSBONX,PSBDT,0)) D:X
"RTN","PSBVDLU1",57,0)
 .S $P(PSBREC,U,12)=X
"RTN","PSBVDLU1",58,0)
 .K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLU1",59,0)
 .S PSBSTUS=$P(^PSB(53.79,X,0),U,9),$P(PSBREC,U,13)=$S(PSBSTUS="N":"",(PSBSTUS="")&$G(PSBLCK):"U",1:PSBSTUS),$P(PSBREC,U,23)=$P(^PSB(53.79,X,0),U,10),$P(PSBREC,U,24)=$P(^PSB(53.79,X,0),U,7)
"RTN","PSBVDLU1",60,0)
 .I $D(^PSB(53.79,X)) I PSBDOSEF="PATCH",PSBSTUS="G",PSBDT=$P(^PSB(53.79,X,.1),U,3),PSBQRR=0 S PSBQR=1
"RTN","PSBVDLU1",61,0)
 .I PSBSTUS="G",$G(PSBFLAG) D CHECK ;Get the correct dispense drug
"RTN","PSBVDLU1",62,0)
 I ($P(PSBREC,U,5)="O") D
"RTN","PSBVDLU1",63,0)
 .S X=$O(^PSB(53.79,"AORDX",DFN,PSBONX,"")) Q:X=""
"RTN","PSBVDLU1",64,0)
 .S Y=$O(^PSB(53.79,"AORDX",DFN,PSBONX,X,"")) Q:Y=""  S $P(PSBREC,U,12)=Y
"RTN","PSBVDLU1",65,0)
 .K PSBLCK L +^PSB(53.79,Y):1  I  L -^PSB(53.79,Y) S PSBLCK=1
"RTN","PSBVDLU1",66,0)
 .S PSBSTUS=$P(^PSB(53.79,Y,0),U,9),$P(PSBREC,U,13)=$S(PSBSTUS="N":"",(PSBSTUS="")&$G(PSBLCK):"U",1:PSBSTUS),$P(PSBREC,U,24)=$P(^PSB(53.79,Y,0),U,7)
"RTN","PSBVDLU1",67,0)
 .I $D(^PSB(53.79,Y)) I PSBDOSEF="PATCH",PSBSTUS="G",PSBDT=$P(^PSB(53.79,Y,.1),U,3),PSBQRR=0 S PSBQR=1
"RTN","PSBVDLU1",68,0)
 .I PSBSTUS="G",$G(PSBFLAG) D CHECK
"RTN","PSBVDLU1",69,0)
 Q:PSBQR=1
"RTN","PSBVDLU1",70,0)
 S $P(PSBREC,U,25)=0 I $G(PSBTRFL),$P(PSBREC,U,11)]"",$P(PSBREC,U,11)'<$G(PSBNTDT),$P(PSBREC,U,11)'>$G(PSBTRDT) S $P(PSBREC,U,25)=1
"RTN","PSBVDLU1",71,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBREC ; Order Hdr
"RTN","PSBVDLU1",72,0)
 I $P(PSBREC,U,12)]"" S PSBONVDL($P(PSBREC,U,12))=""
"RTN","PSBVDLU1",73,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSI ; Special Instructions
"RTN","PSBVDLU1",74,0)
 ; add dispense drugs
"RTN","PSBVDLU1",75,0)
 I $D(PSBDDA) S X="" F  S X=$O(PSBDDA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBDDA(X)
"RTN","PSBVDLU1",76,0)
 S PSBCHDT=0
"RTN","PSBVDLU1",77,0)
 I (PSBTAB'["CVRSHT"),(PSBONX["V"),(PSBOSTS="D"),($G(PSBFOR)="") D  Q  ;get infusing bag from DCed but not DEed orders
"RTN","PSBVDLU1",78,0)
 .D PSJ^PSBVT(PSBX)
"RTN","PSBVDLU1",79,0)
 .D INFUSING^PSBVDLU2 I PSBCOMP=0 Q
"RTN","PSBVDLU1",80,0)
 .I $D(PSBSOLA) S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSOLA(X)
"RTN","PSBVDLU1",81,0)
 .I $D(PSBADA) S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBADA(X)
"RTN","PSBVDLU1",82,0)
 .S X="" F  S X=$O(PSBPORA(PSBONX,X)) S PSBUID=$P(PSBPORA(PSBONX,X),U,1) Q:PSBUID]""  Q:X=""
"RTN","PSBVDLU1",83,0)
 .I PSBUID["P" Q
"RTN","PSBVDLU1",84,0)
 .I PSBUID["WS" D
"RTN","PSBVDLU1",85,0)
 ..S PSBNODE=$O(^PSB(53.79,"AUID",DFN,X,PSBUID,""))
"RTN","PSBVDLU1",86,0)
 ..S PSBUIDA(PSBUID)="ID"_U_PSBUID
"RTN","PSBVDLU1",87,0)
 ..S X=0 F  S X=$O(^PSB(53.79,PSBNODE,.6,X)) Q:'X  S PSBUIDA(PSBUID)=PSBUIDA(PSBUID)_U_"ADD;"_$P(^PSB(53.79,PSBNODE,.6,X,0),U,1)
"RTN","PSBVDLU1",88,0)
 ..S X=0 F  S X=$O(^PSB(53.79,PSBNODE,.7,X)) Q:'X  S PSBUIDA(PSBUID)=PSBUIDA(PSBUID)_U_"SOL;"_$P(^PSB(53.79,PSBNODE,.7,X,0),U,1)
"RTN","PSBVDLU1",89,0)
 .S PSBSONX=PSBONX
"RTN","PSBVDLU1",90,0)
 .I '$D(PSBUIDA(PSBUID)) S PSBCKOR="" F  S PSBCKOR=$O(PSBPORA(PSBSONX,PSBCKOR)) Q:PSBCKOR=""  D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBCKOR) Q:$D(PSBUIDA(PSBUID))
"RTN","PSBVDLU1",91,0)
 .S PSBONX=PSBSONX
"RTN","PSBVDLU1",92,0)
 .S:$D(PSBUIDA(PSBUID)) PSB=PSB+2,^TMP("PSB",$J,PSBTAB,PSB-1)=PSBUIDA(PSBUID),^TMP("PSB",$J,PSBTAB,PSB)="END"
"RTN","PSBVDLU1",93,0)
 .D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$O(PSBPORA("")))
"RTN","PSBVDLU1",94,0)
 ; add additives
"RTN","PSBVDLU1",95,0)
 I $D(PSBADA) S X="" F  S X=$O(PSBADA(X)) Q:X=""  S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBADA(X)
"RTN","PSBVDLU1",96,0)
 ; add solutions
"RTN","PSBVDLU1",97,0)
 I $D(PSBSOLA) S X="" F  S X=$O(PSBSOLA(X)) Q:X=""  S $P(PSBSOLA(X),U,5)="",PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=PSBSOLA(X)
"RTN","PSBVDLU1",98,0)
 I PSBONX["V" D EN^PSBPOIV(DFN,PSBONX)  ; get bags
"RTN","PSBVDLU1",99,0)
 I $D(^TMP("PSBAR",$J)) S PSBUID=DFN_"V"_99999 F  S PSBUID=$O(^TMP("PSBAR",$J,PSBUID),-1) Q:PSBUID=""  D
"RTN","PSBVDLU1",100,0)
 .S PSBUIDS=^TMP("PSBAR",$J,PSBUID)
"RTN","PSBVDLU1",101,0)
 .I $P(PSBUIDS,U,1)="I",$P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S" Q  ; bag has invalid IV parameter, is not infusing or stopped
"RTN","PSBVDLU1",102,0)
 .I $P(PSBUIDS,U,2)'="I",$P(PSBUIDS,U,2)'="S",$P(PSBUIDS,U,8)'="" Q  ; label is no longer valid, bag is not infusing or stopped
"RTN","PSBVDLU1",103,0)
 .I $P(PSBUIDS,U,2)="C" Q  ; bag is completed
"RTN","PSBVDLU1",104,0)
 .I $P(PSBUIDS,U,2)="G" Q  ; bag is given (PBTAB)
"RTN","PSBVDLU1",105,0)
 .S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)=$P(PSBUIDS,U,10,999)
"RTN","PSBVDLU1",106,0)
 K ^TMP("PSBAR",$J)
"RTN","PSBVDLU1",107,0)
 S PSB=PSB+1,^TMP("PSB",$J,PSBTAB,PSB)="END"
"RTN","PSBVDLU1",108,0)
 S ^TMP("PSB",$J,PSBTAB,0)=PSB
"RTN","PSBVDLU1",109,0)
 Q
"RTN","PSBVDLU1",110,0)
 ;
"RTN","PSBVDLU1",111,0)
CHECK S FILE=53.795,PSBNODE=.5,PSBIENS=X_","
"RTN","PSBVDLU1",112,0)
 F I=0:0 S I=$O(^PSB(53.79,X,PSBNODE,I)) Q:'I  S $P(PSBDDS,U,3,4)=$$GET1^DIQ(FILE,I_","_PSBIENS,.01,"I")_U_$$GET1^DIQ(FILE,I_","_PSBIENS,.01)
"RTN","PSBVDLU1",113,0)
 Q
"RTN","PSBVDLU1",114,0)
 ;
"RTN","PSBVDLU1",115,0)
VNURSE(PSBTAB) ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLU1",116,0)
 F PSBLP=1:1:$P(^TMP("PSB",$J,PSBTAB,0),U,1) S X=^TMP("PSB",$J,PSBTAB,PSBLP) I $P(X,U)=DFN D
"RTN","PSBVDLU1",117,0)
 .K ^TMP("PSJ1",$J)
"RTN","PSBVDLU1",118,0)
 .D PSJ1^PSBVT(DFN,$P(X,U,2))
"RTN","PSBVDLU1",119,0)
 .S $P(^TMP("PSB",$J,PSBTAB,PSBLP),U,19)=$S(PSBVNI]"":PSBVNI,1:"***")
"RTN","PSBVDLU1",120,0)
 K PSBLP,PSBTAB
"RTN","PSBVDLU1",121,0)
 Q
"RTN","PSBVDLU1",122,0)
 ;
"RTN","PSBVDLU1",123,0)
OKAY(PSBSTRT,PSBADMIN,PSBSCH,PSBORDER,PSBDRUG,PSBFREQ,PSBOSTS) ;
"RTN","PSBVDLU1",124,0)
 ;
"RTN","PSBVDLU1",125,0)
 ; Description: Determines if an order schedule is valid for
"RTN","PSBVDLU1",126,0)
 ;  the date in PSBADMIN (i.e. Q4D, is it valid today)
"RTN","PSBVDLU1",127,0)
 ;
"RTN","PSBVDLU1",128,0)
 ; PSBSTRT:  Start Date of order (Time ignored)
"RTN","PSBVDLU1",129,0)
 ; PSBADMIN: Date of administration to check (Time ignored)
"RTN","PSBVDLU1",130,0)
 ; PSBSCH:  Schedule (i.e. MO-WE-FR@0900 or Q48H...)
"RTN","PSBVDLU1",131,0)
 ; PSBORDER: Order reference
"RTN","PSBVDLU1",132,0)
 ; PSBDRUG:  Drug ordered (Orderable Item)
"RTN","PSBVDLU1",133,0)
 ; PSBOSTS: The status of the order
"RTN","PSBVDLU1",134,0)
 ;
"RTN","PSBVDLU1",135,0)
 N PSBOKAY,PSBDAYS,PSBDOW
"RTN","PSBVDLU1",136,0)
 S PSBOSTS=$G(PSBOSTS)
"RTN","PSBVDLU1",137,0)
 ;
"RTN","PSBVDLU1",138,0)
 S PSBOKAY=0  ; Default Flag
"RTN","PSBVDLU1",139,0)
 I PSBFREQ'="",PSBFREQ'="D",PSBFREQ'>1440 Q 1
"RTN","PSBVDLU1",140,0)
 ;PRN and ONE TIMES show everyday
"RTN","PSBVDLU1",141,0)
 I (PSBSCHT="P")!(PSBSCHT="O") Q 1
"RTN","PSBVDLU1",142,0)
 S PSBDAYS=$$DAYS(PSBSCH)
"RTN","PSBVDLU1",143,0)
 ;
"RTN","PSBVDLU1",144,0)
 I PSBDAYS=1 S PSBOKAY=1 Q PSBOKAY  ; Order is everyday
"RTN","PSBVDLU1",145,0)
 ;
"RTN","PSBVDLU1",146,0)
 ; find out if today is a good day for multi days
"RTN","PSBVDLU1",147,0)
 S PSBOKAY=0,PSBRDTE=PSBSTRT
"RTN","PSBVDLU1",148,0)
 S PSBADBR=PSBADMIN\1
"RTN","PSBVDLU1",149,0)
 S PSBENR=(PSBADMIN\1)+1
"RTN","PSBVDLU1",150,0)
 I PSBDAYS>1 D  Q PSBOKAY
"RTN","PSBVDLU1",151,0)
 .I PSBADBR=(PSBSTRT\1) S PSBOKAY=1
"RTN","PSBVDLU1",152,0)
 .F  S PSBRDTE=$$FMADD^XLFDT(PSBRDTE,"","",PSBFREQ) Q:PSBRDTE>PSBENR  D
"RTN","PSBVDLU1",153,0)
 ..I $P(PSBRDTE,".",2)="" S PSBRDTE=PSBRDTE-1_".24"
"RTN","PSBVDLU1",154,0)
 ..I PSBRDTE\1=PSBADBR S PSBOKAY=1
"RTN","PSBVDLU1",155,0)
 ..I PSBOKAY="1" Q
"RTN","PSBVDLU1",156,0)
 ;
"RTN","PSBVDLU1",157,0)
 ; Try the MO-WE-FR@0800 thing as last resort
"RTN","PSBVDLU1",158,0)
 S X=PSBADMIN D H^%DTC I %Y=-1 D  Q PSBOKAY  ; Error
"RTN","PSBVDLU1",159,0)
 .S PSBOKAY=0
"RTN","PSBVDLU1",160,0)
 .Q:PSBOSTS="E"
"RTN","PSBVDLU1",161,0)
 .Q:$G(PSBMHND)="PSBOMH"
"RTN","PSBVDLU1",162,0)
 .D ERROR^PSBMLU($G(PSBORDER,"UNKNOWN"),$G(PSBDRUG,""),DFN,"Unable to determine schedule "_PSBSCH,PSBSCH)
"RTN","PSBVDLU1",163,0)
 S PSBDOW=$P("SU^MO^TU^WE^TH^FR^SA",U,%Y+1)
"RTN","PSBVDLU1",164,0)
 I $F(PSBSCH,PSBDOW)>0 S PSBOKAY=1 Q PSBOKAY
"RTN","PSBVDLU1",165,0)
 S PSBOKAY=0
"RTN","PSBVDLU1",166,0)
 Q PSBOKAY
"RTN","PSBVDLU1",167,0)
 ;
"RTN","PSBVDLU1",168,0)
DAYS(PSB) ; Return days between doses (-1: error, 1:everyday 2: QOD...)
"RTN","PSBVDLU1",169,0)
 ;
"RTN","PSBVDLU1",170,0)
 ; Is it a PRN
"RTN","PSBVDLU1",171,0)
 I PSB?.E1"PRN".E Q 1  ; Straight PRN - As Needed
"RTN","PSBVDLU1",172,0)
 ;
"RTN","PSBVDLU1",173,0)
 S PSB=$TR(PSB," ","")
"RTN","PSBVDLU1",174,0)
 I PSB?2.4N.E Q 1
"RTN","PSBVDLU1",175,0)
 S X=PSBFREQ/1440 Q X
"RTN","PSBVDLU1",176,0)
 ;
"RTN","PSBVDLU1",177,0)
 Q
"RTN","PSBVDLU1",178,0)
 ;
"RTN","PSBVDLU1",179,0)
LAST ;
"RTN","PSBVDLU1",180,0)
 S PSBCC=0
"RTN","PSBVDLU1",181,0)
 S ZZ="" F  S ZZ=$O(^PSB(53.79,X,.3,ZZ),-1) Q:'ZZ  Q:PSBFLAG=1  S PSBDATA2=$G(^(ZZ,0)) D
"RTN","PSBVDLU1",182,0)
 .S PSBCC=PSBCC+1
"RTN","PSBVDLU1",183,0)
 .I (PSBCC=2)!($P($P(PSBDATA2,U)," ")="Refused:")!($P($P(PSBDATA2,U)," ")="Held:") S $P(PSBREC,U,11)=$P(PSBDATA2,U,3),PSBFLAG=1
"RTN","PSBVDLU1",184,0)
 Q
"RTN","PSBVDLU1",185,0)
 ;
"RTN","PSBVDLUD")
0^7^B76110020^B75040119
"RTN","PSBVDLUD",1,0)
PSBVDLUD ;BIRMINGHAM/EFC-BCMA UNIT DOSE VIRTUAL DUE LIST FUNCTIONS ;Mar 2004
"RTN","PSBVDLUD",2,0)
 ;;3.0;BAR CODE MED ADMIN;**11,13,38,32**;Mar 2004;Build 32
"RTN","PSBVDLUD",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLUD",4,0)
 ;
"RTN","PSBVDLUD",5,0)
 ; Reference/IA
"RTN","PSBVDLUD",6,0)
 ; EN^PSJBCMA/2828
"RTN","PSBVDLUD",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLUD",8,0)
 ;
"RTN","PSBVDLUD",9,0)
EN(DFN,PSBDT) ;
"RTN","PSBVDLUD",10,0)
 ;
"RTN","PSBVDLUD",11,0)
 ;
"RTN","PSBVDLUD",12,0)
 ; Description:
"RTN","PSBVDLUD",13,0)
 ; Returns the current unit dose order set for today to display
"RTN","PSBVDLUD",14,0)
 ; on the client VDL
"RTN","PSBVDLUD",15,0)
 ;
"RTN","PSBVDLUD",16,0)
 N PSBDATA,PSBTBOUT
"RTN","PSBVDLUD",17,0)
 S PSBTBOUT=0
"RTN","PSBVDLUD",18,0)
 ;
"RTN","PSBVDLUD",19,0)
 ;This routine now re-uses the ^TMP("PSJ",$J global built in PSBVDLTB
"RTN","PSBVDLUD",20,0)
 ;
"RTN","PSBVDLUD",21,0)
 G:$G(^TMP("PSJ",$J,1,0))=-1 1
"RTN","PSBVDLUD",22,0)
 F PSBX=0:0 S PSBX=$O(^TMP("PSJ",$J,PSBX)) Q:('PSBX)!(PSBTBOUT)  D
"RTN","PSBVDLUD",23,0)
 .S:(PSBTAB'="UDTAB")&($G(^TMP("PSB",$J,"UDTAB",2))>0) PSBTBOUT=1
"RTN","PSBVDLUD",24,0)
 .D CLEAN^PSBVT,PSJ^PSBVT(PSBX)
"RTN","PSBVDLUD",25,0)
 .;
"RTN","PSBVDLUD",26,0)
 .; << Standard checks for ALL orders >>
"RTN","PSBVDLUD",27,0)
 .;
"RTN","PSBVDLUD",28,0)
 .Q:PSBONX["V"  ;No IVs on UD tab
"RTN","PSBVDLUD",29,0)
 .Q:PSBONX["P"  ;     No Pending Orders
"RTN","PSBVDLUD",30,0)
 .Q:PSBOST>PSBWADM  ; Order Start Date/Time > admin window
"RTN","PSBVDLUD",31,0)
 .Q:PSBOSP<PSBWBEG  ; For Non one-times Order Stop Date/Time < vdl window
"RTN","PSBVDLUD",32,0)
 .Q:PSBOSTS["D"  ;     Is it DC'd
"RTN","PSBVDLUD",33,0)
 .Q:PSBNGF  ;         Is it marked DO NOT GIVE!
"RTN","PSBVDLUD",34,0)
 .Q:PSBIVPSH
"RTN","PSBVDLUD",35,0)
 .;
"RTN","PSBVDLUD",36,0)
 .; Non One-Times with stop date/time < now
"RTN","PSBVDLUD",37,0)
 .;
"RTN","PSBVDLUD",38,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",39,0)
 .Q:PSBOSP<%
"RTN","PSBVDLUD",40,0)
 .;
"RTN","PSBVDLUD",41,0)
 .; include Active, Renewed, ReInstated and On Call
"RTN","PSBVDLUD",42,0)
 .; (Is it not one time)&(Is it not active or renewed or On Call)
"RTN","PSBVDLUD",43,0)
 .I PSBSCHT'="O",PSBOSTS'="A",PSBOSTS'="H",PSBOSTS'="R",PSBOSTS'="RE",PSBOSTS'="O" Q
"RTN","PSBVDLUD",44,0)
 .;
"RTN","PSBVDLUD",45,0)
 .; Is One Time Given
"RTN","PSBVDLUD",46,0)
 .;
"RTN","PSBVDLUD",47,0)
 .I PSBSCHT="O" D  Q:PSBGVN
"RTN","PSBVDLUD",48,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",49,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",50,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",51,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",52,0)
 .;
"RTN","PSBVDLUD",53,0)
 .; How long does One Time remain on VDL ??
"RTN","PSBVDLUD",54,0)
 .S PSBRMN=1
"RTN","PSBVDLUD",55,0)
 .I PSBSCHT="O",PSBOSP'=PSBOST&(%>PSBOSP) S PSBRMN=0
"RTN","PSBVDLUD",56,0)
 .Q:'PSBRMN
"RTN","PSBVDLUD",57,0)
 .; Is On-Call Given, Can it be given more than once
"RTN","PSBVDLUD",58,0)
 .;
"RTN","PSBVDLUD",59,0)
 .I PSBSCHT="OC" D  Q:PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))
"RTN","PSBVDLUD",60,0)
 ..S (PSBGVN,X,Y)=""
"RTN","PSBVDLUD",61,0)
 ..F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1) Q:'X  D
"RTN","PSBVDLUD",62,0)
 ...F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  D
"RTN","PSBVDLUD",63,0)
 ....I $P(^PSB(53.79,Y,.1),U)=PSBONX,$P(^PSB(53.79,Y,0),U,9)="G" S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLUD",64,0)
 .;
"RTN","PSBVDLUD",65,0)
 .S PSBREC=""
"RTN","PSBVDLUD",66,0)
 .S $P(PSBREC,U,1)=DFN ; dfn
"RTN","PSBVDLUD",67,0)
 .S $P(PSBREC,U,2)=PSBONX ; order
"RTN","PSBVDLUD",68,0)
 .S $P(PSBREC,U,3)=PSBON ; order ien
"RTN","PSBVDLUD",69,0)
 .S $P(PSBREC,U,4)=PSBOTYP ; iv/ud/pending
"RTN","PSBVDLUD",70,0)
 .S $P(PSBREC,U,5)=PSBSCHT ; schedule type
"RTN","PSBVDLUD",71,0)
 .S $P(PSBREC,U,6)=PSBSCH ; schedule
"RTN","PSBVDLUD",72,0)
 .S $P(PSBREC,U,7)=$S(PSBHSM:"HSM",PSBSM:"SM",1:"") ; self med
"RTN","PSBVDLUD",73,0)
 .S $P(PSBREC,U,8)=PSBOITX ; drugname
"RTN","PSBVDLUD",74,0)
 .S $P(PSBREC,U,9)=PSBDOSE_" "_PSBIFR ; dosage
"RTN","PSBVDLUD",75,0)
 .S $P(PSBREC,U,10)=PSBMR ; med route
"RTN","PSBVDLUD",76,0)
 .; Last Given from the AOIP X-Ref - not given status not excepted
"RTN","PSBVDLUD",77,0)
 .S (PSBCNT,PSBFLAG)=0,(YZ,PSBSTUS,PSBADMER)="" K PSBHSTA,PSBHSTAX
"RTN","PSBVDLUD",78,0)
 .F XZ=1:1:20 S YZ=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ),-1),(PSBCNT,PSBFLAG)=0 Q:YZ=""  D
"RTN","PSBVDLUD",79,0)
 ..S:YZ>0 $P(PSBREC,U,11)=YZ
"RTN","PSBVDLUD",80,0)
 ..S X="" F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,YZ,X),-1) Q:X=""  D
"RTN","PSBVDLUD",81,0)
 ...K PSBLCK L +^PSB(53.79,X):1  I  L -^PSB(53.79,X) S PSBLCK=1
"RTN","PSBVDLUD",82,0)
 ...S PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLUD",83,0)
 ...I $G(PSBSTUS)="" S:'$G(PSBLCK) PSBSTUS="X" I $G(PSBLCK) S PSBADMER=1 D
"RTN","PSBVDLUD",84,0)
 ....K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLUD",85,0)
 ....S PSBPARM6=X,Y=$P(^PSB(53.79,X,.1),U,3) D DD^%DT S PSBPARM3=Y,Y=$P(^PSB(53.79,X,0),U,6) D DD^%DT S PSBPARM5=Y
"RTN","PSBVDLUD",86,0)
 ....S PSBPARM7=$P(^PSB(53.79,X,0),U,7) S PSBPARM7="( # "_PSBPARM7_" ) "_$$GET1^DIQ(200,PSBPARM7_",",.01)
"RTN","PSBVDLUD",87,0)
 ....K PSBXTMP S PSBXTMP=PSBONX
"RTN","PSBVDLUD",88,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,$$GET1^DIQ(53.79,PSBPARM6_",",.11))
"RTN","PSBVDLUD",89,0)
 ....D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,PSBPARM3_" admin's ACTION STATUS is ""UNKNOWN"".",PSBSCH,PSBPARM5,PSBPARM6,PSBPARM7) ;  SEND AN E-MAIL
"RTN","PSBVDLUD",90,0)
 ....D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXTMP)  ;Reset Variables
"RTN","PSBVDLUD",91,0)
 ....S X=PSBPARM6 K PSBPARM3,PSBPARM5,PSBPARM6,PSBPARM7
"RTN","PSBVDLUD",92,0)
 ...K PSBLCK S:(PSBSTUS']"") PSBSTUS="U"  I PSBSTUS'="N",($G(PSBSTUS)'="X") S PSBFLAG=1,PSBHSTA(YZ,$G(PSBSTUS))="ORIG"_U_X
"RTN","PSBVDLUD",93,0)
 ...D:PSBSTUS="N"
"RTN","PSBVDLUD",94,0)
 ....S $P(PSBREC,U,11)=""
"RTN","PSBVDLUD",95,0)
 ....S Z="" F  S Z=$O(^PSB(53.79,X,.9,Z),-1) Q:'Z  Q:PSBFLAG=1  S PSBDATA=$G(^(Z,0)) D
"RTN","PSBVDLUD",96,0)
 .....I (PSBDATA["Set to 'NOT GIVEN'")!(PSBDATA["Set to 'GIVEN'")!(PSBDATA["Set to 'REFUSED'")!(PSBDATA["Set to 'HELD'")!(PSBDATA["Set to 'MISSING DOSE'")!(PSBDATA["Set to 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",97,0)
 .....I (PSBDATA["STATUS 'HELD'")!(PSBDATA["STATUS 'GIVEN'")!(PSBDATA["STATUS 'REFUSED'")!(PSBDATA["STATUS 'MISSING DOSE'")!(PSBDATA["STATUS 'REMOVED'") S PSBCNT=PSBCNT+1
"RTN","PSBVDLUD",98,0)
 .....I PSBCNT#2=0,PSBDATA["'REFUSED'" S PSBSTUS="R" D LAST^PSBVDLU1
"RTN","PSBVDLUD",99,0)
 .....I PSBCNT#2=0,PSBDATA["'HELD'" S PSBSTUS="H" D LAST^PSBVDLU1
"RTN","PSBVDLUD",100,0)
 .....I PSBCNT#2=0,PSBDATA["'MISSING DOSE'" S PSBSTUS="M" D LAST^PSBVDLU1
"RTN","PSBVDLUD",101,0)
 .....I PSBCNT#2=0,PSBDATA["'REMOVED'" S PSBSTUS="RM" D LAST^PSBVDLU1
"RTN","PSBVDLUD",102,0)
 .....I PSBFLAG=1,'$D(PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))) S PSBHSTA($P(PSBREC,U,11),$G(PSBSTUS))=Z_U_X
"RTN","PSBVDLUD",103,0)
 .I $D(PSBHSTA) S $P(PSBREC,U,11)=$O(PSBHSTA(""),-1),PSBSTUS=$O(PSBHSTA($P(PSBREC,U,11),""),-1) M PSBHSTAX(PSBOIT)=PSBHSTA K PSBHSTA  ;last action date/time
"RTN","PSBVDLUD",104,0)
 .S $P(PSBREC,U,12)=""  ;med log ien inserted below for actual date
"RTN","PSBVDLUD",105,0)
 .S $P(PSBREC,U,13)=""  ;med log status inserted below for actual date
"RTN","PSBVDLUD",106,0)
 .S $P(PSBREC,U,14)="" ; admin date inserted below
"RTN","PSBVDLUD",107,0)
 .S $P(PSBREC,U,15)=PSBOIT ; OI Pointer
"RTN","PSBVDLUD",108,0)
 .S $P(PSBREC,U,16)=PSBNJECT  ;med route injectable flag
"RTN","PSBVDLUD",109,0)
 .; Variable dosage entered as ####-####?
"RTN","PSBVDLUD",110,0)
 .I $P(PSBREC,U,9)?1.4N1"-"1.4N.E S $P(PSBREC,U,17)=1
"RTN","PSBVDLUD",111,0)
 .E  S $P(PSBREC,U,17)=0
"RTN","PSBVDLUD",112,0)
 .S:PSBDOSEF?1"CAP".E!(PSBDOSEF?1"TAB".E)!(PSBDOSEF="PATCH") $P(PSBREC,U,18)=PSBDOSEF ; dosage form
"RTN","PSBVDLUD",113,0)
 .S $P(PSBREC,U,20)=$S((PSBSTUS="X")!(PSBSTUS="N"):"",1:PSBSTUS) ; last action status
"RTN","PSBVDLUD",114,0)
 .S $P(PSBREC,U,21)=PSBOST
"RTN","PSBVDLUD",115,0)
 .S $P(PSBREC,U,22)=PSBOSTS
"RTN","PSBVDLUD",116,0)
 .S $P(PSBREC,U,26)=PSBOSP
"RTN","PSBVDLUD",117,0)
 .S $P(PSBREC,U,27)=$$LASTG^PSBCSUTL(DFN,PSBOIT)
"RTN","PSBVDLUD",118,0)
 .;
"RTN","PSBVDLUD",119,0)
 .; Gather Dispense Drugs
"RTN","PSBVDLUD",120,0)
 .D NOW^%DTC
"RTN","PSBVDLUD",121,0)
 .S (PSBDDS,PSBSOLS,PSBADDS,PSBFLAG)="0"
"RTN","PSBVDLUD",122,0)
 .F Y=0:0 S Y=$O(PSBDDA(Y)) Q:'Y  D
"RTN","PSBVDLUD",123,0)
 ..I $P(PSBDDA(Y),U,5)=$P(%,".") S PSBFLAG=1 ;If drug was inactivated
"RTN","PSBVDLUD",124,0)
 ..Q:$P(PSBDDA(Y),U,5)&($P(PSBDDA(Y),U,5)<%)  ; Inactive
"RTN","PSBVDLUD",125,0)
 ..S:$P(PSBDDA(Y),U,4)="" $P(PSBDDA(Y),U,4)=1
"RTN","PSBVDLUD",126,0)
 ..S PSBDDS=PSBDDS_U_$P(PSBDDA(Y),U,1,4)
"RTN","PSBVDLUD",127,0)
 ..S $P(PSBDDS,U,1)=PSBDDS+1
"RTN","PSBVDLUD",128,0)
 .;
"RTN","PSBVDLUD",129,0)
 .; On-Call One Time PRN orders
"RTN","PSBVDLUD",130,0)
 .S PSBQRR=0
"RTN","PSBVDLUD",131,0)
 .I "^O^OC^P^"[(U_PSBSCHT_U) D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSBNOW\1,PSBDDS,PSBSOLS,PSBADDS,"UDTAB") Q
"RTN","PSBVDLUD",132,0)
 .;
"RTN","PSBVDLUD",133,0)
 .; Now we deal with only continuous
"RTN","PSBVDLUD",134,0)
 .; process admintimes
"RTN","PSBVDLUD",135,0)
 .; Display an order on the VDL based on the frequency received from IPM **PSB*2.0*3
"RTN","PSBVDLUD",136,0)
 .S (PSBYES,PSBODD,PSBYTF)=0
"RTN","PSBVDLUD",137,0)
 .I PSBSCH="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"No Schedule on this order")
"RTN","PSBVDLUD",138,0)
 .S:$$PSBDCHK1^PSBVT1(PSBSCH) PSBYES=1
"RTN","PSBVDLUD",139,0)
 .I PSBYES,PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLUD",140,0)
 .F I=1:1 Q:$P(PSBSCH,"-",I)=""  I $P(PSBSCH,"-",I)?2N!($P(PSBSCH,"-",I)?4N) S PSBYES=1,PSBYTF=1
"RTN","PSBVDLUD",141,0)
 .I PSBSCHT="C",PSBYTF="1",PSBADST="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Admin times required",PSBSCH) Q
"RTN","PSBVDLUD",142,0)
 .S PSBFREQ=$$GETFREQ^PSBVDLU1(DFN,PSBONX)
"RTN","PSBVDLUD",143,0)
 .I PSBFREQ="O" S PSBFREQ=1440
"RTN","PSBVDLUD",144,0)
 .I PSBFREQ="D" S PSBFREQ=""
"RTN","PSBVDLUD",145,0)
 .I 'PSBYES,PSBFREQ<1 D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid frequency received from order",PSBSCH) Q
"RTN","PSBVDLUD",146,0)
 .I (PSBADST="")&(+PSBFREQ>0) D ODDSCH^PSBVDLU1("UDTAB") Q  ;calculate admin times based on frequency
"RTN","PSBVDLUD",147,0)
 .; No admin times, MAYDAY MAYDAY!!
"RTN","PSBVDLUD",148,0)
 .I +PSBFREQ>0 I (PSBFREQ#1440'=0),(1440#PSBFREQ'=0) S PSBODD=1
"RTN","PSBVDLUD",149,0)
 .I PSBODD,PSBADST'="" D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Administration Times on ODD SCHEDULE",PSBSCH) Q
"RTN","PSBVDLUD",150,0)
 .; process admin times against beginning and ending date
"RTN","PSBVDLUD",151,0)
 .; build all orders for both days.
"RTN","PSBVDLUD",152,0)
 .F PSBY=1:1 Q:$P(PSBADST,"-",PSBY)=""  D
"RTN","PSBVDLUD",153,0)
 ..;For invalid admin times
"RTN","PSBVDLUD",154,0)
 ..I ($P(PSBADST,"-",PSBY)'?2N)&($P(PSBADST,"-",PSBY)'?4N) D ERROR^PSBMLU(PSBONX,PSBOITX,DFN,"Invalid Admin times",PSBSCH)
"RTN","PSBVDLUD",155,0)
 ..; apply this time to the beginning window date
"RTN","PSBVDLUD",156,0)
 ..S PSB=+(PSBWBEG\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",157,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",158,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",159,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",160,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",161,0)
 ..;
"RTN","PSBVDLUD",162,0)
 ..Q:(PSBWBEG\1)=(PSBWEND\1)  ; Window only has one day rare but possible
"RTN","PSBVDLUD",163,0)
 ..;
"RTN","PSBVDLUD",164,0)
 ..; apply this time to the ending window date
"RTN","PSBVDLUD",165,0)
 ..S PSB=+(PSBWEND\1_"."_$P(PSBADST,"-",PSBY))
"RTN","PSBVDLUD",166,0)
 ..D:(PSB'<PSBWBEG)&(PSB'>PSBWEND)  ; Make sure it is in the window
"RTN","PSBVDLUD",167,0)
 ...D:(PSB'<PSBOST)&(PSB<PSBOSP)  ; Make sure this time is active
"RTN","PSBVDLUD",168,0)
 ....D:$$OKAY^PSBVDLU1(PSBOST,PSB,PSBSCH,PSBONX,PSBOITX,PSBFREQ,PSBOSTS)  ; Okay on this date?
"RTN","PSBVDLUD",169,0)
 .....D ADD^PSBVDLU1(PSBREC,PSBOTXT,PSB,PSBDDS,PSBSOLS,PSBADDS,"UDTAB")
"RTN","PSBVDLUD",170,0)
 .K PSBSTUS
"RTN","PSBVDLUD",171,0)
1 K PSBREC D EN^PSBVDLPA
"RTN","PSBVDLUD",172,0)
 ;add initials of verifying pharmacist/verifying nurse
"RTN","PSBVDLUD",173,0)
 D:PSBTAB="UDTAB" VNURSE^PSBVDLU1("UDTAB")
"RTN","PSBVDLUD",174,0)
 D CLEAN^PSBVT
"RTN","PSBVDLUD",175,0)
 Q
"RTN","PSBVDLUD",176,0)
 ;
"RTN","PSBVDLVL")
0^22^B63610275^B60130860
"RTN","PSBVDLVL",1,0)
PSBVDLVL ;BIRMINGHAM/EFC-BCMA VIRTUAL DUE LIST FUNCTIONS ;Mar 2004
"RTN","PSBVDLVL",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,3,12,11,13,32**;Mar 2004;Build 32
"RTN","PSBVDLVL",3,0)
 ;Per VHA Directive 2004-038 (or future revisions regarding same), this routine should not be modified.
"RTN","PSBVDLVL",4,0)
 ;
"RTN","PSBVDLVL",5,0)
 ;
"RTN","PSBVDLVL",6,0)
 ; Reference/IA
"RTN","PSBVDLVL",7,0)
 ; $$GET^XPAR/2263
"RTN","PSBVDLVL",8,0)
 ; 
"RTN","PSBVDLVL",9,0)
EN(RESULTS,DFN,PSBXOR,PSBTYPE,PSBADMIN,PSBTAB,PSBUID,PSBASTS,PSBORSTS,PSBRMV) ;
"RTN","PSBVDLVL",10,0)
 ;
"RTN","PSBVDLVL",11,0)
 ; RPC: PSB VALIDATE ORDER
"RTN","PSBVDLVL",12,0)
 ;
"RTN","PSBVDLVL",13,0)
 ; Description: Final check of order against an actual administration
"RTN","PSBVDLVL",14,0)
 ;              date/time used immediately after scanned med has been
"RTN","PSBVDLVL",15,0)
 ;              validated to be a good un-administered order.
"RTN","PSBVDLVL",16,0)
 ;
"RTN","PSBVDLVL",17,0)
 K PSBTST
"RTN","PSBVDLVL",18,0)
 N PSBFLAG
"RTN","PSBVDLVL",19,0)
 I PSBRMV="I" D GETOHIST^PSBRPC2(.PSBTST,DFN,PSBXOR_PSBTYPE) S I=0 F  S I=$O(PSBTST(I)) Q:I=""  I $P(PSBTST(I),U,5)="I" S RESULTS(0)=1,RESULTS(1)="-2^" K PSBTST Q
"RTN","PSBVDLVL",20,0)
 K PSBOKAY D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBXOR_PSBTYPE) S PSB=0
"RTN","PSBVDLVL",21,0)
 S RESULTS(0)=1,RESULTS(1)="-1^***Unable to determine administration" ; Default Flag will be overwritten by anything
"RTN","PSBVDLVL",22,0)
 D NOW^%DTC
"RTN","PSBVDLVL",23,0)
 I ((PSBOSTS="A")!(PSBOSTS="R"))&(PSBOSP<%) S PSBOSTS="E"
"RTN","PSBVDLVL",24,0)
 I PSBORSTS'=PSBOSTS,((PSBSCHT'="O")&(PSBOSTS'="E")) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-2^ORDER STATUS MISMATCH" Q
"RTN","PSBVDLVL",25,0)
 I ((PSBTAB="UDTAB")!(PSBTAB="PBTAB")),((PSBRMV="RM")!(PSBRMV="N")) D  Q
"RTN","PSBVDLVL",26,0)
 .S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^OKAY TO REMOVE"  ; patch removal does not follow rest of validte rules
"RTN","PSBVDLVL",27,0)
 .I PSBASTS="" Q  ;status is not given - don't check for missmatch
"RTN","PSBVDLVL",28,0)
 .I $D(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN)) S X=$O(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN,"")) I $P($G(^PSB(53.79,+X,0)),U,9)'=PSBASTS  S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-2^Admin status mismatch"
"RTN","PSBVDLVL",29,0)
 I PSBTYPE="V",PSBSCHT'="P",((PSBUID="")!(PSBUID["WS")) S RESULTS(0)=1,RESULTS(1)="0^Okay to administer" Q:PSBTAB="IVTAB"
"RTN","PSBVDLVL",30,0)
 I PSBTYPE="V",PSBUID'="" D  Q:PSBTAB="IVTAB"  ; validate IV bags Piggybacks have additional tests
"RTN","PSBVDLVL",31,0)
 .S PSB=0,PSBSUID=PSBUID D EN^PSBPOIV(DFN,PSBXOR_PSBTYPE)
"RTN","PSBVDLVL",32,0)
 .S X="" F  S X=$O(^TMP("PSBAR",$J,X)) Q:X=""  D
"RTN","PSBVDLVL",33,0)
 ..I PSBSUID'=X Q
"RTN","PSBVDLVL",34,0)
 ..S PSBUIDS=^TMP("PSBAR",$J,X)
"RTN","PSBVDLVL",35,0)
 ..I $P(PSBUIDS,U,2)="I"!($P(PSBUIDS,U,2)="S") S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Okay to administer" Q  ; is infusing or stopped
"RTN","PSBVDLVL",36,0)
 ..I $P(PSBUIDS,U,1)="I" S Y=$P(^TMP("PSBAR",$J,"I"),U,2) D DD^%DT S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=$P(^TMP("PSBAR",$J,"I"),U,3,99)_"  "_Y Q
"RTN","PSBVDLVL",37,0)
 ..I $P(PSBUIDS,U,1)["W" S PSBWS=$P(PSBUIDS,U,1) F PSBWM=2:1 Q:$P(PSBWS,";",PSBWM)=""  D
"RTN","PSBVDLVL",38,0)
 ...S Y=$P(^TMP("PSBAR",$J,"W",$P(PSBWS,";",PSBWM)),U,2) D DD^%DT S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=$P(^TMP("PSBAR",$J,"W",$P(PSBWS,";",PSBWM)),U,3,99)_" "_Y
"RTN","PSBVDLVL",39,0)
 ..S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Okay to administer"
"RTN","PSBVDLVL",40,0)
 .K ^TMP("PSBAR",$J)
"RTN","PSBVDLVL",41,0)
 ;
"RTN","PSBVDLVL",42,0)
 ; no IV orders
"RTN","PSBVDLVL",43,0)
 ;
"RTN","PSBVDLVL",44,0)
 D NOW^%DTC
"RTN","PSBVDLVL",45,0)
 I PSBOSTS="H" S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="0^Order is on Provider Hold" Q
"RTN","PSBVDLVL",46,0)
 I PSBSCHT'="O"&(%<($$FMADD^XLFDT(PSBOST,"","",$$GET^XPAR("ALL","PSB ADMIN BEFORE")*-1))) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-1^Order Not Active" Q
"RTN","PSBVDLVL",47,0)
 I PSBSCHT'="O"&(%>PSBOSP) S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)="-1^Order Not Active" Q
"RTN","PSBVDLVL",48,0)
 I (PSBSCHT="C")!((PSBSCHT="P")&(PSBDOSEF="PATCH")) D
"RTN","PSBVDLVL",49,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",50,0)
 .I PSBASTS["*UNKNOWN*" S PSBOKAY="-1^This administration has *UNKNOWN* status" Q
"RTN","PSBVDLVL",51,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",52,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",53,0)
 .S PSBFLAG=0 I PSBRMV="M"!(PSBRMV="H")!(PSBRMV="R") S PSBFLAG=1
"RTN","PSBVDLVL",54,0)
 .I $D(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE)) D  Q:X
"RTN","PSBVDLVL",55,0)
 ..S X=0,PSBLADT=$O(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE,""),-1),PSBLAIEN=$O(^PSB(53.79,"AORDX",DFN,PSBXOR_PSBTYPE,PSBLADT,""),-1)
"RTN","PSBVDLVL",56,0)
 ..I $P($G(^PSB(53.79,PSBLAIEN,0)),U,9)="G",$P($G(^PSB(53.79,PSBLAIEN,.5,1,0)),U,4)="PATCH",PSBFLAG=0 S X=1,PSBOKAY="-1^Previous patch has not been removed" Q
"RTN","PSBVDLVL",57,0)
 .I $D(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN)) D  Q:+PSBOKAY<0
"RTN","PSBVDLVL",58,0)
 ..S X=$O(^PSB(53.79,"AORD",DFN,PSBXOR_PSBTYPE,+PSBADMIN,""))
"RTN","PSBVDLVL",59,0)
 ..L +^PSB(53.79,+X):1
"RTN","PSBVDLVL",60,0)
 ..I  L -^PSB(53.79,+X)
"RTN","PSBVDLVL",61,0)
 ..E  S PSBOKAY="-1^The "_$$GET1^DIQ(53.79,+X_",",.13)_" administration is being edited by another" Q
"RTN","PSBVDLVL",62,0)
 ..I $G(PSBASTS)]"" D  Q:+PSBOKAY<0
"RTN","PSBVDLVL",63,0)
 ...I $P($G(^PSB(53.79,+X,0)),U,9)="" Q
"RTN","PSBVDLVL",64,0)
 ...I $P($G(^PSB(53.79,+X,0)),U,9)'=PSBASTS S PSBOKAY="-2^Admin status mismatch" Q
"RTN","PSBVDLVL",65,0)
 .; Minutes before
"RTN","PSBVDLVL",66,0)
 .S PSBWIN1=$$GET^XPAR("DIV","PSB ADMIN BEFORE")*-1
"RTN","PSBVDLVL",67,0)
 .; Minutes After
"RTN","PSBVDLVL",68,0)
 .S PSBWIN2=$$GET^XPAR("DIV","PSB ADMIN AFTER")
"RTN","PSBVDLVL",69,0)
 .D NOW^%DTC S PSBMIN=$$DIFF^PSBUTL(PSBADMIN,%)
"RTN","PSBVDLVL",70,0)
 .; PENDING A PC SOLUTION!
"RTN","PSBVDLVL",71,0)
 .I PSBMIN<PSBWIN1 S PSBOKAY="1^Admin is "_(PSBMIN*-1)_" minutes before the scheduled administration time" Q
"RTN","PSBVDLVL",72,0)
 .I PSBMIN>PSBWIN2 S PSBOKAY="1^Admin is "_(PSBMIN)_" minutes after the scheduled administration time" Q
"RTN","PSBVDLVL",73,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",74,0)
 ; Validate a PRN Order
"RTN","PSBVDLVL",75,0)
 D:(PSBSCHT="P")
"RTN","PSBVDLVL",76,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",77,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",78,0)
 .I (+($G(PSBOKAY))<0)&(PSBDOSEF="PATCH") Q  ;A Patch may have to be removed.
"RTN","PSBVDLVL",79,0)
 .S PSBOKAY="1^"
"RTN","PSBVDLVL",80,0)
 .; Get Last Four Givens
"RTN","PSBVDLVL",81,0)
 .S PSBDT=""
"RTN","PSBVDLVL",82,0)
 .F  S PSBDT=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,PSBDT),-1) Q:PSBDT=""  D
"RTN","PSBVDLVL",83,0)
 ..S PSBDA=""
"RTN","PSBVDLVL",84,0)
 ..F  S PSBDA=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,PSBDT,PSBDA),-1) Q:'PSBDA  D
"RTN","PSBVDLVL",85,0)
 ...S (PSBCNT1,PSBCNT2,PSBCNT3)=0
"RTN","PSBVDLVL",86,0)
 ...S PSBLADT=$$GET1^DIQ(53.79,PSBDA_",",.06,"I")
"RTN","PSBVDLVL",87,0)
 ...S PSBSTUS=$$GET1^DIQ(53.79,PSBDA_",",.09)
"RTN","PSBVDLVL",88,0)
 ...S:PSBSTUS="" PSBSTUS="U"
"RTN","PSBVDLVL",89,0)
 ...S PSBSCH=$$GET1^DIQ(53.79,PSBDA_",",.12)
"RTN","PSBVDLVL",90,0)
 ...S PSBRSN=$$GET1^DIQ(53.79,PSBDA_",",.21)
"RTN","PSBVDLVL",91,0)
 ...S PSBINJ=$$GET1^DIQ(53.79,PSBDA_",",.16)
"RTN","PSBVDLVL",92,0)
 ...Q:$P(^PSB(53.79,PSBDA,0),U,9)="N"
"RTN","PSBVDLVL",93,0)
 ...F PSBZ=.5,.6,.7 F PSBY=0:0 S PSBY=$O(^PSB(53.79,PSBDA,PSBZ,PSBY)) Q:'PSBY  D
"RTN","PSBVDLVL",94,0)
 ....Q:'$D(^PSB(53.79,PSBDA,PSBZ,PSBY))
"RTN","PSBVDLVL",95,0)
 ....S PSBDD=$S(PSBZ=.5:53.795,PSBZ=.6:53.796,1:53.797)
"RTN","PSBVDLVL",96,0)
 ....S PSBUNIT=$$GET1^DIQ(PSBDD,PSBY_","_PSBDA_",",.03)
"RTN","PSBVDLVL",97,0)
 ....S PSBUNFR=$$GET1^DIQ(PSBDD,PSBY_","_PSBDA_",",.04)
"RTN","PSBVDLVL",98,0)
 ....I PSBZ=.5 S PSBCNT1=PSBCNT1+1
"RTN","PSBVDLVL",99,0)
 ....I PSBZ=.6 S PSBCNT2=PSBCNT2+1
"RTN","PSBVDLVL",100,0)
 ....I PSBZ=.7 S PSBCNT3=PSBCNT3+1
"RTN","PSBVDLVL",101,0)
 ...;Units given or free text not to display for multiple dispense drugs or additives and solution
"RTN","PSBVDLVL",102,0)
 ...I (PSBCNT1>1)!(PSBCNT2>0)!(PSBCNT3>0) S (PSBUNIT,PSBUNFR)=""
"RTN","PSBVDLVL",103,0)
 ...S X=PSBLADT_U
"RTN","PSBVDLVL",104,0)
 ...S X=X_PSBSTUS_U_PSBSCH_U_$G(PSBRSN)_U_$G(PSBINJ)_U_$G(PSBUNIT)_U_$G(PSBUNFR)
"RTN","PSBVDLVL",105,0)
 ...S PSBOKAY($O(PSBOKAY(""),-1)+1)=3_U_X
"RTN","PSBVDLVL",106,0)
 ...S:$D(PSBOKAY(4)) PSBDT=0
"RTN","PSBVDLVL",107,0)
 .S X1=$$LASTG^PSBCSUTL(DFN,+PSBOIT) I X1>0 S PSBOKAY($O(PSBOKAY(""),-1)+1)=4_U_X1
"RTN","PSBVDLVL",108,0)
 ; Validate a One-Time Order
"RTN","PSBVDLVL",109,0)
 D:PSBSCHT="O"
"RTN","PSBVDLVL",110,0)
 .S (PSBGVN,X,Y)=""
"RTN","PSBVDLVL",111,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1)  Q:'X  F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  I $P(^PSB(53.79,Y,.1),U)=PSBONX,"G"[$P(^PSB(53.79,Y,0),U,9) S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLVL",112,0)
 .I PSBGVN S PSBOKAY="-1^Dose Already on medication Log" Q
"RTN","PSBVDLVL",113,0)
 .; One Time are automatically expired so we don't check STATUS here
"RTN","PSBVDLVL",114,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",115,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",116,0)
 ; Validate an On Call Order
"RTN","PSBVDLVL",117,0)
 D:PSBSCHT="OC"
"RTN","PSBVDLVL",118,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",119,0)
 .S (PSBGVN,X,Y)=""
"RTN","PSBVDLVL",120,0)
 .F  S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X),-1)  Q:'X  F  S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,X,Y),-1) Q:'Y  I $P(^PSB(53.79,Y,.1),U)=PSBONX,"G"[$P(^PSB(53.79,Y,0),U,9) S PSBGVN=1,(X,Y)=0
"RTN","PSBVDLVL",121,0)
 .I PSBGVN&('$$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL")) S PSBOKAY="-1^Dose Already on medication Log" Q
"RTN","PSBVDLVL",122,0)
 .I PSBOSTS'="A",PSBOSTS'="R",PSBOSTS'="O" S PSBOKAY="-1^Order Not Active" Q
"RTN","PSBVDLVL",123,0)
 .I PSBNGF S PSBOKAY="-1^marked DO NOT GIVE" Q
"RTN","PSBVDLVL",124,0)
 .I PSBGVN&($$GET^XPAR("DIV","PSB ADMIN MULTIPLE ONCALL"))&(PSBDOSEF="PATCH") S PSBOKAY="-1^Previous patch has not been removed" Q
"RTN","PSBVDLVL",125,0)
 .S PSBOKAY="0^Okay to administer"
"RTN","PSBVDLVL",126,0)
 ;
"RTN","PSBVDLVL",127,0)
 D:+PSBOKAY'<0
"RTN","PSBVDLVL",128,0)
 .N PSBDIFF,Y
"RTN","PSBVDLVL",129,0)
 .D:(PSBSCHT="C")!(PSBSCHT="OC"&('$G(PSBGVN)))
"RTN","PSBVDLVL",130,0)
 ..; On-call or cont and not on the log.
"RTN","PSBVDLVL",131,0)
 ..S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,""),-1)
"RTN","PSBVDLVL",132,0)
 ..;Check for the status of the medication and insert status in the text
"RTN","PSBVDLVL",133,0)
 ..I Y]"" S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,Y,""),-1),PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLVL",134,0)
 ..S:Y']"" PSBSTUS=""
"RTN","PSBVDLVL",135,0)
 ..I PSBSTUS="N" D  Q:$G(PSBQUIT)
"RTN","PSBVDLVL",136,0)
 ...S X=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y,X),-1)
"RTN","PSBVDLVL",137,0)
 ...D:X']""
"RTN","PSBVDLVL",138,0)
 ....S Y=$O(^PSB(53.79,"AOIP",DFN,PSBOIT,Y),-1) I Y']"" S PSBQUIT=1 Q
"RTN","PSBVDLVL",139,0)
 ....S X=$O(^PSB(53.79,"AOIP",DFN,+PSBOIT,Y,""),-1),PSBSTUS=$P(^PSB(53.79,X,0),U,9)
"RTN","PSBVDLVL",140,0)
 ..S PSBDIFF=$$FMDIFF^XLFDT($$NOW^XLFDT(),Y,2)
"RTN","PSBVDLVL",141,0)
 ..Q:PSBDIFF>7200  ; Greater than 2 hours
"RTN","PSBVDLVL",142,0)
 ..I (PSBSTUS="G")!(PSBSTUS="H")!(PSBSTUS="R")!(PSBSTUS="RM") D
"RTN","PSBVDLVL",143,0)
 ...S PSBSTUS=$$GET1^DIQ(53.79,X_",",.09)
"RTN","PSBVDLVL",144,0)
 ...I PSBSTUS'="" D
"RTN","PSBVDLVL",145,0)
 ....S Y="1^*** NOTICE, "_PSBOITX_" was "_PSBSTUS_" "_(PSBDIFF\60)_" minutes ago."
"RTN","PSBVDLVL",146,0)
 ....I +PSBOKAY=1 S PSBOKAY(1)=Y
"RTN","PSBVDLVL",147,0)
 ....E  S PSBOKAY=Y
"RTN","PSBVDLVL",148,0)
 ;
"RTN","PSBVDLVL",149,0)
 S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=PSBOKAY
"RTN","PSBVDLVL",150,0)
 F X=1:1 Q:'$D(PSBOKAY(X))  S PSB=PSB+1,RESULTS(0)=PSB,RESULTS(PSB)=PSBOKAY(X)
"RTN","PSBVDLVL",151,0)
 Q
"RTN","PSBVDLVL",152,0)
 ;
"UP",53.69,53.692,-1)
53.69^2
"UP",53.69,53.692,0)
53.692
"VER")
8.0^22.0
"^DD",53.69,53.69,.05,0)
TYPE OF REQUEST^F^^0;5^K:$L(X)>2!($L(X)<2)!'(X'?1P.E) X
"^DD",53.69,53.69,.05,.1)
Type of Request
"^DD",53.69,53.69,.05,3)
Answer must be 2 characters in length
"^DD",53.69,53.69,.05,21,0)
^^26^26^3070612^
"^DD",53.69,53.69,.05,21,1,0)
Automatically stuffed at record creation with the type of report that is
"^DD",53.69,53.69,.05,21,2,0)
being requested.  Used to drive the report later on by appending the
"^DD",53.69,53.69,.05,21,3,0)
internal code to "DQ^PSBO"_type for the routine reference to run.  (i.e.
"^DD",53.69,53.69,.05,21,4,0)
ML for med log would call DQ^PSBOML to generate the report.) 
"^DD",53.69,53.69,.05,21,5,0)
Report types DL = Due List
"^DD",53.69,53.69,.05,21,6,0)
             MH = Medication Admin History (MAH)
"^DD",53.69,53.69,.05,21,7,0)
             ML = Med Log
"^DD",53.69,53.69,.05,21,8,0)
             MM = Missed Medications
"^DD",53.69,53.69,.05,21,9,0)
             PE = PRN Effectiveness List
"^DD",53.69,53.69,.05,21,10,0)
             PM = Patient Medication History
"^DD",53.69,53.69,.05,21,11,0)
             WA = Ward Administration Times
"^DD",53.69,53.69,.05,21,12,0)
             MV = Medication Variance Log
"^DD",53.69,53.69,.05,21,13,0)
             BL = Bar Code Label
"^DD",53.69,53.69,.05,21,14,0)
             MD = Missing Dose Follow-up
"^DD",53.69,53.69,.05,21,15,0)
             AL = Allergy Report
"^DD",53.69,53.69,.05,21,16,0)
             PI = Patient Inquiry
"^DD",53.69,53.69,.05,21,17,0)
             DO = Display Order
"^DD",53.69,53.69,.05,21,18,0)
             VT = Vitals Cumulative
"^DD",53.69,53.69,.05,21,19,0)
             PF = Patient Record Flag
"^DD",53.69,53.69,.05,21,20,0)
             XA = Unknown Action Status Report
"^DD",53.69,53.69,.05,21,21,0)
             CE = BCMA Coversheet Expired Orders Report
"^DD",53.69,53.69,.05,21,22,0)
             CI = BCMA Coversheet IV Overview Report
"^DD",53.69,53.69,.05,21,23,0)
             CM = BCMA Coversheet Medication Overview Report
"^DD",53.69,53.69,.05,21,24,0)
             CP = BCMA Coversheet PRN Overview Report
"^DD",53.69,53.69,.05,21,25,0)
             IV = BCMA IV Bag Status Report
"^DD",53.69,53.69,.05,21,26,0)
             MT = BCMA Medication Therapy Report
"^DD",53.69,53.69,.05,"DT")
3070612
"^DD",53.69,53.69,.61,0)
CRITERIA^F^^1;1^K:$L(X)>250!($L(X)<1) X
"^DD",53.69,53.69,.61,3)
Answer must be 1-250 characters in length
"^DD",53.69,53.69,.61,21,0)
^^2^2^3070717^
"^DD",53.69,53.69,.61,21,1,0)
(Free Text)  Custom "flags" and "parameters" to support processing of the 
"^DD",53.69,53.69,.61,21,2,0)
requested report.
"^DD",53.69,53.69,.61,"DT")
3070717
"^DD",53.69,53.69,1,0)
INPUT LIST^53.692^^2;0
"^DD",53.69,53.69,1,21,0)
^^2^2^3070717^
"^DD",53.69,53.69,1,21,1,0)
(Multiple)  List of custom data items to be used when processing the
"^DD",53.69,53.69,1,21,2,0)
requested report.
"^DD",53.69,53.692,0)
INPUT LIST SUB-FIELD^^.01^1
"^DD",53.69,53.692,0,"DT")
3070717
"^DD",53.69,53.692,0,"IX","B",53.692,.01)

"^DD",53.69,53.692,0,"NM","INPUT LIST")

"^DD",53.69,53.692,0,"UP")
53.69
"^DD",53.69,53.692,.01,0)
INPUT LIST^MF^^0;1^K:$L(X)>90!($L(X)<1) X
"^DD",53.69,53.692,.01,1,0)
^.1
"^DD",53.69,53.692,.01,1,1,0)
53.692^B
"^DD",53.69,53.692,.01,1,1,1)
S ^PSB(53.69,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",53.69,53.692,.01,1,1,2)
K ^PSB(53.69,DA(1),2,"B",$E(X,1,30),DA)
"^DD",53.69,53.692,.01,3)
Answer must be 1-90 characters in length.
"^DD",53.69,53.692,.01,"DT")
3070717
"BLD",6328,6)
^28
**END**
**END**
