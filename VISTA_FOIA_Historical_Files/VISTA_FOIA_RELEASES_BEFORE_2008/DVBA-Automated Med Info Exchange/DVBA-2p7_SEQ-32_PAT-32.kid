Released DVBA*2.7*32 SEQ #32
Extracted from mail message
**KIDS**:DVBA*2.7*32^

**INSTALL NAME**
DVBA*2.7*32
"BLD",2590,0)
DVBA*2.7*32^AUTOMATED MED INFO EXCHANGE^0^3000602^y
"BLD",2590,1,0)
^^2^2^3000602^
"BLD",2590,1,1,0)
Address various problems related to claim folder location, division, and
"BLD",2590,1,2,0)
station number being null.
"BLD",2590,4,0)
^9.64PA^^
"BLD",2590,"ABPKG")
n
"BLD",2590,"KRN",0)
^9.67PA^19^17
"BLD",2590,"KRN",.4,0)
.4
"BLD",2590,"KRN",.401,0)
.401
"BLD",2590,"KRN",.402,0)
.402
"BLD",2590,"KRN",.403,0)
.403
"BLD",2590,"KRN",.5,0)
.5
"BLD",2590,"KRN",.84,0)
.84
"BLD",2590,"KRN",3.6,0)
3.6
"BLD",2590,"KRN",3.8,0)
3.8
"BLD",2590,"KRN",9.2,0)
9.2
"BLD",2590,"KRN",9.8,0)
9.8
"BLD",2590,"KRN",9.8,"NM",0)
^9.68A^5^4
"BLD",2590,"KRN",9.8,"NM",1,0)
DVBAUTIL^^0^B26516388
"BLD",2590,"KRN",9.8,"NM",3,0)
DVBARQP^^0^B51463332
"BLD",2590,"KRN",9.8,"NM",4,0)
DVBCRPON^^0^B16783860
"BLD",2590,"KRN",9.8,"NM",5,0)
DVBADSCK^^0^B20682184
"BLD",2590,"KRN",9.8,"NM","B","DVBADSCK",5)

"BLD",2590,"KRN",9.8,"NM","B","DVBARQP",3)

"BLD",2590,"KRN",9.8,"NM","B","DVBAUTIL",1)

"BLD",2590,"KRN",9.8,"NM","B","DVBCRPON",4)

"BLD",2590,"KRN",19,0)
19
"BLD",2590,"KRN",19,"NM",0)
^9.68A^^
"BLD",2590,"KRN",19.1,0)
19.1
"BLD",2590,"KRN",101,0)
101
"BLD",2590,"KRN",409.61,0)
409.61
"BLD",2590,"KRN",771,0)
771
"BLD",2590,"KRN",870,0)
870
"BLD",2590,"KRN",8994,0)
8994
"BLD",2590,"KRN","B",.4,.4)

"BLD",2590,"KRN","B",.401,.401)

"BLD",2590,"KRN","B",.402,.402)

"BLD",2590,"KRN","B",.403,.403)

"BLD",2590,"KRN","B",.5,.5)

"BLD",2590,"KRN","B",.84,.84)

"BLD",2590,"KRN","B",3.6,3.6)

"BLD",2590,"KRN","B",3.8,3.8)

"BLD",2590,"KRN","B",9.2,9.2)

"BLD",2590,"KRN","B",9.8,9.8)

"BLD",2590,"KRN","B",19,19)

"BLD",2590,"KRN","B",19.1,19.1)

"BLD",2590,"KRN","B",101,101)

"BLD",2590,"KRN","B",409.61,409.61)

"BLD",2590,"KRN","B",771,771)

"BLD",2590,"KRN","B",870,870)

"BLD",2590,"KRN","B",8994,8994)

"BLD",2590,"QUES",0)
^9.62^^
"BLD",2590,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",223,-1)
1^1
"PKG",223,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",223,20,0)
^9.402P^^
"PKG",223,22,0)
^9.49I^1^1
"PKG",223,22,1,0)
2.7^2950410^2950508
"PKG",223,22,1,"PAH",1,0)
32^3000602^100824
"PKG",223,22,1,"PAH",1,1,0)
^^2^2^3000602
"PKG",223,22,1,"PAH",1,1,1,0)
Address various problems related to claim folder location, division, and
"PKG",223,22,1,"PAH",1,1,2,0)
station number being null.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DVBADSCK")
0^5^B20682184
"RTN","DVBADSCK",1,0)
DVBADSCK ;ALB/GTS-557/THM-DISCHARGE CHECKER ;21 JUL 89
"RTN","DVBADSCK",2,0)
 ;;2.7;AMIE;**15,14,24,32**;Apr 10, 1995
"RTN","DVBADSCK",3,0)
 ;
"RTN","DVBADSCK",4,0)
 S DVBAMAN=""
"RTN","DVBADSCK",5,0)
 D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL
"RTN","DVBADSCK",6,0)
 S HD="MANUAL 7132 PROCESSING" D HOME^%ZIS K ^TMP($J)
"RTN","DVBADSCK",7,0)
DATE S %DT(0)=-DT,%DT="AE",%DT("A")="Enter BEGINNING date: "
"RTN","DVBADSCK",8,0)
 W @IOF,!?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBADSCK",9,0)
 D ^%DT G:Y<0 KILL S (BDATE,BDATE1)=Y,BDATE=BDATE-.1
"RTN","DVBADSCK",10,0)
 S %DT("A")="     and ENDING date: ",%DT="AE" D ^%DT G:Y<0 DATE S (EDATE1,EDATE)=Y,EDATE=EDATE+.5
"RTN","DVBADSCK",11,0)
 I EDATE<BDATE W *7,!!,"Invalid date sequence." H 3 G DATE
"RTN","DVBADSCK",12,0)
 K %DT S Y=DT X ^DD("DD") S FDT(0)=Y
"RTN","DVBADSCK",13,0)
 W !! S %ZIS="AEQ",%ZIS("A")="Enter output device: " D ^%ZIS K %ZIS G:POP KILL
"RTN","DVBADSCK",14,0)
 I $D(IO("Q")) S ZTRTN="DATA^DVBADSCK",ZTIO=ION,NOASK=1,ZTDESC="AMIE Discharge Checker" F I="BDATE*","EDATE*","FDT(0)","HD","NOASK","DVBAMAN" S ZTSAVE(I)=""
"RTN","DVBADSCK",15,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued.",! G KILL
"RTN","DVBADSCK",16,0)
 G DATA
"RTN","DVBADSCK",17,0)
 ;
"RTN","DVBADSCK",18,0)
ZTM D NOPARM^DVBAUTL2 G:$D(DVBAQUIT) KILL
"RTN","DVBADSCK",19,0)
 I '$D(DT) S X="T" D ^%DT S DT=Y
"RTN","DVBADSCK",20,0)
 S Y=DT X ^DD("DD") S FDT(0)=Y
"RTN","DVBADSCK",21,0)
 K ^TMP($J) S X="T-1" D ^%DT Q:Y<0  S (BDATE,BDATE1)=Y,BDATE=Y-.1,(EDATE1,EDATE)=Y,EDATE=Y+.5 G DATA
"RTN","DVBADSCK",22,0)
 ;
"RTN","DVBADSCK",23,0)
CHK ;* Find the IFN of the 7131 which matches the admission date (If a 7131
"RTN","DVBADSCK",24,0)
 ;*  exists).
"RTN","DVBADSCK",25,0)
 F XDA=0:0 S XDA=$O(^DVB(396,"B",DFN,XDA)) Q:XDA=""  I $P($G(^DVB(396,XDA,0)),U,4)=ADMDT&($P($G(^DVB(396,XDA,2)),U,10)="A") Q
"RTN","DVBADSCK",26,0)
 QUIT
"RTN","DVBADSCK",27,0)
 ;
"RTN","DVBADSCK",28,0)
SET ;* Set up TMP global of admissions for discharges within range
"RTN","DVBADSCK",29,0)
 S DFN=DA,VAINDT=$S($D(^DGPM(+MB,0)):$P(^(0),U,1),1:""),VAINDT=VAINDT-.000002,VA200="" D INP^VADPT K VA200 S ADMDT=$P(VAIN(7),U,1),ADMNUM=VAIN(1)
"RTN","DVBADSCK",30,0)
 ;I ADMDT]"" S ADMDT=$P(ADMDT,".",1)
"RTN","DVBADSCK",31,0)
 Q:ADMDT=""  S ^TMP($J,ADMDT,+ADMNUM,DA)=""
"RTN","DVBADSCK",32,0)
 Q
"RTN","DVBADSCK",33,0)
 ;
"RTN","DVBADSCK",34,0)
SET1 ;* Get the discharge type and execute CREATE and CREAT1 as needed
"RTN","DVBADSCK",35,0)
 S DCHPTR=$P(^DGPM(LADM,0),U,17),TDIS=$S($D(^DGPM(+DCHPTR,0)):$P(^(0),U,18),1:"") I TDIS="" S TDIS="Unknown discharge type"
"RTN","DVBADSCK",36,0)
 S:'$D(^DG(405.2,+TDIS,0)) TDIS="Unknown discharge type" I $D(^(0)) S TDIS=$S($P(^DG(405.2,+TDIS,0),U,1)]"":$P(^(0),U,1),1:"Unknown discharge type")
"RTN","DVBADSCK",37,0)
 I XDA]"",$D(^DVB(396,XDA,0)) D CREATE Q
"RTN","DVBADSCK",38,0)
 I TDIS["DEATH"!(TDIS["TO CNH") D CREAT1
"RTN","DVBADSCK",39,0)
 Q
"RTN","DVBADSCK",40,0)
 ;
"RTN","DVBADSCK",41,0)
LOOK ;* Loop through Admission Date TMP global execute CHK and SET1
"RTN","DVBADSCK",42,0)
 K MA,DA,MB F ADMDT=0:0 S ADMDT=$O(^TMP($J,ADMDT)) Q:ADMDT=""  F LADM=0:0 S LADM=$O(^TMP($J,ADMDT,LADM)) Q:LADM=""  F DFN=0:0 S DFN=$O(^TMP($J,ADMDT,LADM,DFN)) Q:DFN=""  D CHK,SET1
"RTN","DVBADSCK",43,0)
 Q
"RTN","DVBADSCK",44,0)
 ;
"RTN","DVBADSCK",45,0)
DATA U IO W:(IOST?1"C-".E) @IOF
"RTN","DVBADSCK",46,0)
 W !,"Notices of discharge created on "_FDT(0)_" for discharge date range " S Y=$P(BDATE1,".",1) X ^DD("DD") W Y," TO " S Y=$P(EDATE1,".",1) X ^DD("DD") W Y,!!!
"RTN","DVBADSCK",47,0)
 W "Name",?35,"SSN",?50,"Admission date",! F LINE=1:1:IOM W "-"
"RTN","DVBADSCK",48,0)
 ;
"RTN","DVBADSCK",49,0)
 ;* Set up XRO array containing regional office station numbers
"RTN","DVBADSCK",50,0)
 ;*  contained in the AMIE Site Parameter File
"RTN","DVBADSCK",51,0)
 ;
"RTN","DVBADSCK",52,0)
 F I=0:0 S I=$O(^DVB(396.1,1,1,I)) Q:I=""!(+I=0)  S J=$P(^(I,0),U,1),J=$S($D(^DIC(4,+J,99)):$P(^(99),U),1:"") I J]"" S XRO(J)=""
"RTN","DVBADSCK",53,0)
 ;
"RTN","DVBADSCK",54,0)
 ;* Loop through Discharges ("AMV3") within entered date range DO SET
"RTN","DVBADSCK",55,0)
 ;*  when a discharge is found
"RTN","DVBADSCK",56,0)
 ;
"RTN","DVBADSCK",57,0)
 W !! S COUNT=0,MA=BDATE F J=0:0 S MA=$O(^DGPM("AMV3",MA)) Q:$P(MA,".")>EDATE!(MA="")  F DA=0:0 S DA=$O(^DGPM("AMV3",MA,DA)) Q:DA=""  F MB=0:0 S MB=$O(^DGPM("AMV3",MA,DA,MB)) Q:MB=""  I MA'>EDATE D SET
"RTN","DVBADSCK",58,0)
 ;
"RTN","DVBADSCK",59,0)
 ;* Loop through admission date TMP global
"RTN","DVBADSCK",60,0)
 ;
"RTN","DVBADSCK",61,0)
 D LOOK W @IOF,!!!,"Notice to MAS operator on ",FDT(0),!!! I '$D(NEW) W "There were no NOTICES OF DISCHARGE to create.",!!!
"RTN","DVBADSCK",62,0)
 I $D(NEW) W "There ",$S(COUNT=1:"was ",1:"were ")_COUNT_$S(COUNT=1:" notice",1:" notices")_" of discharge created.",!!!
"RTN","DVBADSCK",63,0)
 ;
"RTN","DVBADSCK",64,0)
KILL I $D(DVBAMAN)&($D(ZTQUEUED)) D KILL^%ZTLOAD
"RTN","DVBADSCK",65,0)
 K NEW,COUNT,XRO G KILL^DVBAUTIL
"RTN","DVBADSCK",66,0)
 ;
"RTN","DVBADSCK",67,0)
CREATE ;create notice
"RTN","DVBADSCK",68,0)
 ;* If a Notice of Discharge is requested on 7131, created it
"RTN","DVBADSCK",69,0)
 I $D(^DVB(396,XDA,2)) Q:$P(^(2),U,10)="L"
"RTN","DVBADSCK",70,0)
 Q:$P(^DVB(396,XDA,0),U,5)'="YES"  Q:$P(^(0),U,9)'="P"
"RTN","DVBADSCK",71,0)
 S XADMDT=$P(^DVB(396,XDA,0),U,4) Q:ADMDT'=XADMDT
"RTN","DVBADSCK",72,0)
CREAT1 Q:'$D(^DPT(DFN,0))  D ADM^DVBAVDPT
"RTN","DVBADSCK",73,0)
 I $G(CFLOC)="" Q   ;No station # for a claim folder location.
"RTN","DVBADSCK",74,0)
 I '$D(XRO(CFLOC))&(CFLOC'=376) Q  ;not a user RO
"RTN","DVBADSCK",75,0)
 I CFLOC=376,TDIS["DEATH" S CFLOC=$O(XRO(0)) Q:CFLOC=""
"RTN","DVBADSCK",76,0)
 Q:$D(^DVB(396.2,"D",ADMDT,DFN))  ;quit if one for admit date exists
"RTN","DVBADSCK",77,0)
 S (DIC,DIE)="^DVB(396.2,",DR="3.5///"_CFLOC_";1///"_ADMDT_";2///"_LADM_";3///R" S DLAYGO=396.2,DIC(0)="QLM",X=""""_SSN_"""" D ^DIC Q:+Y<0  S DA=+Y D ^DIE S NEW=1,COUNT=COUNT+1 K DLAYGO
"RTN","DVBADSCK",78,0)
 W PNAM,?35,SSN S Y=ADMDT X ^DD("DD") W ?50,Y,?70,TDIS,!
"RTN","DVBADSCK",79,0)
 Q
"RTN","DVBADSCK",80,0)
 ;
"RTN","DVBADSCK",81,0)
DOC ;XADMDT=admission date on 7131
"RTN","DVBADSCK",82,0)
 ;XDA=7131 file pointer--not all patients will have it
"RTN","DVBADSCK",83,0)
 ;DA=patient file pointer
"RTN","DVBADSCK",84,0)
 ;MB,LADM=admission pointers
"RTN","DVBADSCK",85,0)
 ;NOTE: DEATH,TO CNH discharges will NOT record discharge dates
"RTN","DVBARQP")
0^3^B51463332
"RTN","DVBARQP",1,0)
DVBARQP ;ALB/JLU-7131 request processing routine ;1/28/93
"RTN","DVBARQP",2,0)
 ;;2.7;AMIE;**32**;Apr 10, 1995
"RTN","DVBARQP",3,0)
BEG ;
"RTN","DVBARQP",4,0)
 D INITIAL
"RTN","DVBARQP",5,0)
 D INITRPT^DVBAUTL3
"RTN","DVBARQP",6,0)
 F  DO  I DVBANY>0!($D(DTOUT)) Q
"RTN","DVBARQP",7,0)
 .S DVBAOUT=0
"RTN","DVBARQP",8,0)
 .F  DO  I $D(DTOUT)!($D(DUOUT))!(DVBAOUT) Q
"RTN","DVBARQP",9,0)
 ..D DRAW
"RTN","DVBARQP",10,0)
 ..D READ I $D(DTOUT)!($D(DUOUT))!(DVBAOUT) Q
"RTN","DVBARQP",11,0)
 ..D ADJ
"RTN","DVBARQP",12,0)
 ..Q
"RTN","DVBARQP",13,0)
 .D FILE
"RTN","DVBARQP",14,0)
 .Q
"RTN","DVBARQP",15,0)
 D EXIT
"RTN","DVBARQP",16,0)
 Q
"RTN","DVBARQP",17,0)
 ;
"RTN","DVBARQP",18,0)
EXIT K A,ADMNUM,DA,DIE,DIR,DR,DTOUT,DUOUT,DVBADSCH,DVBAER,DVBAHD21,DVBAHD22,DVBALN,DVBAOLD,DVBAOUT,DVBARPT,DVBATDT,DVBATITL,DVBAX,X,Z,DVBAP,DVBAO,DVBANY
"RTN","DVBARQP",19,0)
 Q
"RTN","DVBARQP",20,0)
 ;
"RTN","DVBARQP",21,0)
INITIAL ;This subroutine will initialize most of the variable needed for this
"RTN","DVBARQP",22,0)
 ;option.
"RTN","DVBARQP",23,0)
 S $P(DVBALN,"-",80)=""
"RTN","DVBARQP",24,0)
 S DVBATITL="7131 Report Requesting"
"RTN","DVBARQP",25,0)
 S X="NOW",%DT="ST"
"RTN","DVBARQP",26,0)
 D ^%DT
"RTN","DVBARQP",27,0)
 X ^DD("DD")
"RTN","DVBARQP",28,0)
 S DVBATDT=Y
"RTN","DVBARQP",29,0)
 I $D(ADMNUM) D ADM
"RTN","DVBARQP",30,0)
 I DVBDOC="L" D ACT
"RTN","DVBARQP",31,0)
 D SSNOUT^DVBCUTIL
"RTN","DVBARQP",32,0)
 S SSN=DVBCSSNO
"RTN","DVBARQP",33,0)
 S DVBANY=0
"RTN","DVBARQP",34,0)
 Q
"RTN","DVBARQP",35,0)
 ;
"RTN","DVBARQP",36,0)
ADM ;sets up admission date variable and discharge variable if applicable
"RTN","DVBARQP",37,0)
 S Y=DVBREQDT
"RTN","DVBARQP",38,0)
 D DD^%DT
"RTN","DVBARQP",39,0)
 S DVBAHD21="Admission Date: "_Y
"RTN","DVBARQP",40,0)
 I '$D(^DGPM(+ADMNUM,0)) K Y Q
"RTN","DVBARQP",41,0)
 I $P(^DGPM(+ADMNUM,0),U,17)]"" DO
"RTN","DVBARQP",42,0)
 .S Y=$P(^(0),U,17) ;naked from line before
"RTN","DVBARQP",43,0)
 .S Y=$P(^DGPM(+Y,0),U,1)
"RTN","DVBARQP",44,0)
 .D DD^%DT
"RTN","DVBARQP",45,0)
 .S DVBADSCH=Y
"RTN","DVBARQP",46,0)
 .S DVBAHD22="Discharge Date: "_Y
"RTN","DVBARQP",47,0)
 .Q
"RTN","DVBARQP",48,0)
 K Y
"RTN","DVBARQP",49,0)
 Q
"RTN","DVBARQP",50,0)
 ;
"RTN","DVBARQP",51,0)
ACT ;sets up activity date variable
"RTN","DVBARQP",52,0)
 S Y=DVBREQDT
"RTN","DVBARQP",53,0)
 D DD^%DT
"RTN","DVBARQP",54,0)
 S DVBAHD21="Activity Date: "_Y
"RTN","DVBARQP",55,0)
 K Y
"RTN","DVBARQP",56,0)
 Q
"RTN","DVBARQP",57,0)
 ;
"RTN","DVBARQP",58,0)
DRAW ;This subroutine will draw the screen
"RTN","DVBARQP",59,0)
 I IOST?1"C-".E W @IOF
"RTN","DVBARQP",60,0)
 W "Information Request Form"
"RTN","DVBARQP",61,0)
 W ?35,HNAME
"RTN","DVBARQP",62,0)
 W ?59,DVBATDT
"RTN","DVBARQP",63,0)
 W !,DVBALN
"RTN","DVBARQP",64,0)
 W !,"Patient: "
"RTN","DVBARQP",65,0)
 W PNAM
"RTN","DVBARQP",66,0)
 W ?54,"SSN: "
"RTN","DVBARQP",67,0)
 W SSN
"RTN","DVBARQP",68,0)
 W !,"Claim #: ",CNUM,!
"RTN","DVBARQP",69,0)
 W DVBAHD21
"RTN","DVBARQP",70,0)
 W:$D(DVBAHD22) ?40,DVBAHD22
"RTN","DVBARQP",71,0)
 W !!,?9,"Report",?37,"Selected",?60,"Status"
"RTN","DVBARQP",72,0)
 W !,DVBALN
"RTN","DVBARQP",73,0)
 F DVBAX=0:0 S DVBAX=$O(DVBARPT(DVBAX)) Q:'DVBAX  D DRAW1
"RTN","DVBARQP",74,0)
 W !,DVBALN
"RTN","DVBARQP",75,0)
 Q
"RTN","DVBARQP",76,0)
 ;
"RTN","DVBARQP",77,0)
DRAW1 ;rights the reports to the screen
"RTN","DVBARQP",78,0)
 W !,DVBAX
"RTN","DVBARQP",79,0)
 W ?3,$P(DVBARPT(DVBAX),U,1)
"RTN","DVBARQP",80,0)
 W ?40,$S($P(DVBARPT(DVBAX),U,2)["Y":"YES",1:"NO")
"RTN","DVBARQP",81,0)
 W ?60,$S($P(DVBARPT(DVBAX),U,3)="C":"Completed",$P(DVBARPT(DVBAX),U,3)="P":"Pending",1:"")
"RTN","DVBARQP",82,0)
 Q
"RTN","DVBARQP",83,0)
 ;
"RTN","DVBARQP",84,0)
READ ;reads the user answer
"RTN","DVBARQP",85,0)
 S DIR(0)="LAO^1:10^K:X[""."" X"
"RTN","DVBARQP",86,0)
 S DIR("A")="Select Report: "
"RTN","DVBARQP",87,0)
 S DIR("?",1)="Select a number or range of numbers from 1 to 10 (1,3,5 or 2-4,8).  This will"
"RTN","DVBARQP",88,0)
 S DIR("?",2)="initially mark the report as 'YES'.  If the number is selected again then it"
"RTN","DVBARQP",89,0)
 S DIR("?")="will be changed to 'NO' or vice versa"
"RTN","DVBARQP",90,0)
 D ^DIR
"RTN","DVBARQP",91,0)
 I $D(DUOUT)!($D(DTOUT)) Q
"RTN","DVBARQP",92,0)
 I 'Y S DVBAOUT=1
"RTN","DVBARQP",93,0)
 Q
"RTN","DVBARQP",94,0)
 ;
"RTN","DVBARQP",95,0)
ADJ ;This subroutine adjusts the local array
"RTN","DVBARQP",96,0)
 K DVBAER
"RTN","DVBARQP",97,0)
 N X,A,FLOP
"RTN","DVBARQP",98,0)
 F X=1:1:10 S A=$P(Y,",",X) Q:'A  D DISC
"RTN","DVBARQP",99,0)
 Q
"RTN","DVBARQP",100,0)
 ;
"RTN","DVBARQP",101,0)
DISC ;checks for bad answers
"RTN","DVBARQP",102,0)
 I $D(ADMNUM),$D(DVBADSCH),A=1 DO:'$D(DVBAER)  S DVBAER=1 Q
"RTN","DVBARQP",103,0)
 .W *7,!,"Vet already discharged - you cannot request Notice of Discharge."
"RTN","DVBARQP",104,0)
 .W !,?30,"<Return> to continue."
"RTN","DVBARQP",105,0)
 .R Z:DTIME
"RTN","DVBARQP",106,0)
 .Q
"RTN","DVBARQP",107,0)
 I DVBDOC="L",(A=1!(A=2)!(A=3)!(A=9)) DO:'$D(DVBAER)  S DVBAER=1 Q
"RTN","DVBARQP",108,0)
 .W *7,!,"Cannot select 'Notice of Discharge', 'Hospital Summary', 'Certificate (21-day)', or 'Admission Report' for an activity date."
"RTN","DVBARQP",109,0)
 . W !,?30,"<Return> to continue."
"RTN","DVBARQP",110,0)
 .R Z:DTIME
"RTN","DVBARQP",111,0)
 .Q
"RTN","DVBARQP",112,0)
 ;
"RTN","DVBARQP",113,0)
 ;If Notice of Discharge selected, check patient's Claim Folder Location.
"RTN","DVBARQP",114,0)
 I A=1 S FLOP=0 D  Q:FLOP
"RTN","DVBARQP",115,0)
 . N CK S CK=$$CKCFLOC()
"RTN","DVBARQP",116,0)
 . I CK=1 S FLOP=1 W *7,!,"The patient has no Claim Folder Location in the Patient File.",!,"Notice of Discharge would not be returned.",!,?30,"<Return> to continue." R Z:DTIME
"RTN","DVBARQP",117,0)
 . I CK=2 S FLOP=1 D
"RTN","DVBARQP",118,0)
 .. W *7,!,"The patient's Claim Folder Location has no Station Number in file #4.",!,"Notice of Discharge would not be returned.",!,"Please check the Claim Folder Location and its entry in file #4.",!,?30,"<Return> to continue." R Z:DTIME
"RTN","DVBARQP",119,0)
 ;
"RTN","DVBARQP",120,0)
 ;If 21 Day Certificate selected, check patient's Claim Folder Location.
"RTN","DVBARQP",121,0)
 I A=3 S FLOP=0 D  Q:FLOP
"RTN","DVBARQP",122,0)
 . N CK S CK=$$CKCFLOC()
"RTN","DVBARQP",123,0)
 . I CK=1 S FLOP=1 W *7,!,"The patient has no Claim Folder Location in the Patient File.",!,"21 Day Certificate would not be returned.",!,?30,"<Return> to continue." R Z:DTIME
"RTN","DVBARQP",124,0)
 . I CK=2 S FLOP=1 D
"RTN","DVBARQP",125,0)
 .. W *7,!,"The patient's Claim Folder Location has no Station Number in file #4.",!,"21 Day Certificate would not be returned.",!,"Please check the Claim Folder Location and its entry in file #4.",!,?30,"<Return> to continue." R Z:DTIME
"RTN","DVBARQP",126,0)
 D CHNG
"RTN","DVBARQP",127,0)
 Q
"RTN","DVBARQP",128,0)
 ;
"RTN","DVBARQP",129,0)
CKCFLOC() ;Check if Claim Folder Location or its Station Number is null.
"RTN","DVBARQP",130,0)
 ;If Claim Folder Location and Station Number are not null, CK=0.
"RTN","DVBARQP",131,0)
 ;If Claim Folder Location is null, CK=1.
"RTN","DVBARQP",132,0)
 ;If Station Number is null, CK=2.
"RTN","DVBARQP",133,0)
 N CK,ZDFN,ZCFLOC
"RTN","DVBARQP",134,0)
 S CK=0
"RTN","DVBARQP",135,0)
 S ZDFN=$P($G(DFN),U) I $G(ZDFN)="" S CK=3 Q CK
"RTN","DVBARQP",136,0)
 S ZCFLOC=$P($G(^DPT(ZDFN,.31)),U,4)
"RTN","DVBARQP",137,0)
 I $G(ZCFLOC)="" S CK=1
"RTN","DVBARQP",138,0)
 I $G(ZCFLOC)'="" S:$P($G(^DIC(4,ZCFLOC,99)),U)="" CK=2
"RTN","DVBARQP",139,0)
 Q CK
"RTN","DVBARQP",140,0)
 ;
"RTN","DVBARQP",141,0)
CHNG ;updates the local array
"RTN","DVBARQP",142,0)
 Q:$P(DVBARPT(A),U,3)["C"
"RTN","DVBARQP",143,0)
 S DVBAOLD=$P(DVBARPT(A),U,2)
"RTN","DVBARQP",144,0)
 S DVBAOLD=$S(DVBAOLD["Y":"NO",1:"YES")
"RTN","DVBARQP",145,0)
 S $P(DVBARPT(A),U,2)=DVBAOLD
"RTN","DVBARQP",146,0)
 S $P(DVBARPT(A),U,3)=$S(DVBAOLD["Y":"P",1:"")
"RTN","DVBARQP",147,0)
 Q
"RTN","DVBARQP",148,0)
 ;
"RTN","DVBARQP",149,0)
FILE ;this subroutine sets the data into the file and asks the last three 
"RTN","DVBARQP",150,0)
 ;questions
"RTN","DVBARQP",151,0)
 I $D(DTOUT) S DVBANY=1 D DEL^DVBAUTL3(DVBAENTR):'$D(DVBAEDT) Q
"RTN","DVBARQP",152,0)
 I $D(DUOUT) DO  Q
"RTN","DVBARQP",153,0)
 .I '$D(DVBAEDT) S DVBANY=1 D DEL^DVBAUTL3(DVBAENTR) Q
"RTN","DVBARQP",154,0)
 .S DVBANY=$$ANYSEL(DVBAENTR)
"RTN","DVBARQP",155,0)
 .I DVBANY'>0 D ERR
"RTN","DVBARQP",156,0)
 .Q
"RTN","DVBARQP",157,0)
 D LAST
"RTN","DVBARQP",158,0)
 I $D(Y) I '$D(DVBAEDT) DO  Q
"RTN","DVBARQP",159,0)
 .D DEL^DVBAUTL3(DVBAENTR)
"RTN","DVBARQP",160,0)
 .S DVBANY=1
"RTN","DVBARQP",161,0)
 .Q
"RTN","DVBARQP",162,0)
 S DVBANY=$$ANYSEL(DVBAENTR)
"RTN","DVBARQP",163,0)
 I 'DVBANY D ERR Q
"RTN","DVBARQP",164,0)
 D STM^DVBCUTL4
"RTN","DVBARQP",165,0)
 D FILE^DVBAUTL3
"RTN","DVBARQP",166,0)
 S XRTN=$T(+0)
"RTN","DVBARQP",167,0)
 D SPM^DVBCUTL4
"RTN","DVBARQP",168,0)
 ;;;D TEST:'$D(DVBAEDT)
"RTN","DVBARQP",169,0)
 Q
"RTN","DVBARQP",170,0)
 ;
"RTN","DVBARQP",171,0)
ERR ;this subroutine will print out an error message when no reports are
"RTN","DVBARQP",172,0)
 ;selected on the 7131.
"RTN","DVBARQP",173,0)
 S VAR(1,0)="1,0,0,2,0^You have not selected any reports for this 7131 request"
"RTN","DVBARQP",174,0)
 S VAR(2,0)="0,0,0,1:2,0^or have selected number 4 but not entered any remarks."
"RTN","DVBARQP",175,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBARQP",176,0)
 K VAR
"RTN","DVBARQP",177,0)
 D CONTMES^DVBCUTL4
"RTN","DVBARQP",178,0)
 Q
"RTN","DVBARQP",179,0)
 ;
"RTN","DVBARQP",180,0)
ANYSEL(B) ;
"RTN","DVBARQP",181,0)
 ;This subroutine checks to see if any reports were selected on the 7131
"RTN","DVBARQP",182,0)
 ;request.
"RTN","DVBARQP",183,0)
 ;B is the internal entry number in file 396
"RTN","DVBARQP",184,0)
 N X,CNT
"RTN","DVBARQP",185,0)
 S CNT=0
"RTN","DVBARQP",186,0)
 F X=0:0 S X=$O(DVBARPT(X)) Q:'X!(CNT)  DO  ;checking each report
"RTN","DVBARQP",187,0)
 . I $P(DVBARPT(X),U,2)="YES" S CNT=1
"RTN","DVBARQP",188,0)
 .Q
"RTN","DVBARQP",189,0)
 I $P(^DVB(396,B,0),U,25)]"" S CNT=1 ;checking opt date range
"RTN","DVBARQP",190,0)
 I $P(DVBARPT(4),U,2)="YES",'$O(^DVB(396,B,5,0)) S CNT=0 ;if no remarks set to zero
"RTN","DVBARQP",191,0)
 Q CNT
"RTN","DVBARQP",192,0)
 ;
"RTN","DVBARQP",193,0)
LAST ;this subroutine will ask the last three questions
"RTN","DVBARQP",194,0)
 S DIE="^DVB(396,",DA=DVBAENTR
"RTN","DVBARQP",195,0)
 S DR="18;S X=X;19///^S X=$S($P(^DVB(396,DA,0),U,25)']"""":""@"",$P(^(0),U,26)=""C"":""C"",1:""P"");29Routing Location;.5;23///"_DT_";24///"_DT_";27///"_LOC_";28///"_OPER
"RTN","DVBARQP",196,0)
 D ^DIE
"RTN","DVBARQP",197,0)
 Q
"RTN","DVBARQP",198,0)
 ;
"RTN","DVBARQP",199,0)
TEST ;tests to see if the user wants this 7131
"RTN","DVBARQP",200,0)
 D DRAW
"RTN","DVBARQP",201,0)
 W !,*7,"Do you want to file this request"
"RTN","DVBARQP",202,0)
 S %=1 D YN^DICN
"RTN","DVBARQP",203,0)
 I %=2 D DEL^DVBAUTL3(DVBAENTR)
"RTN","DVBARQP",204,0)
 Q
"RTN","DVBAUTIL")
0^1^B26516388
"RTN","DVBAUTIL",1,0)
DVBAUTIL ;ALB ISC/THM-AMIE UTILITIES ; 1/16/91  2:58 PM
"RTN","DVBAUTIL",2,0)
 ;;2.7;AMIE;**17,32**;Apr 10, 1995
"RTN","DVBAUTIL",3,0)
 ;
"RTN","DVBAUTIL",4,0)
SORT W !!,"Sort by Regional Office number" S %=1 D YN^DICN I $D(DTOUT)!(%<0) K DTOUT S Y=-1 Q
"RTN","DVBAUTIL",5,0)
 I $D(%Y) I %Y["?" W !!,*7,"Enter Y to sort by the Regional Office number you",!,"select or enter N to get ALL Regional Offices reported." G SORT
"RTN","DVBAUTIL",6,0)
 I %'=1 S RO="N",RONUM=0 Q
"RTN","DVBAUTIL",7,0)
 I %=1 S RO="Y" G RONUM
"RTN","DVBAUTIL",8,0)
 W !,*7,"Invalid response.",!! G SORT
"RTN","DVBAUTIL",9,0)
 ;
"RTN","DVBAUTIL",10,0)
RONUM W !,"Regional Office number: " R RONUM:DTIME G:RONUM["^" SORT I '$T!(RONUM="") W *7 S Y=-1 Q
"RTN","DVBAUTIL",11,0)
 I RONUM'?1.3N W *7,"     Must be 1-3 numbers.",!! G RONUM
"RTN","DVBAUTIL",12,0)
 Q
"RTN","DVBAUTIL",13,0)
 ;
"RTN","DVBAUTIL",14,0)
KILL ;kill all variables and exit selected program
"RTN","DVBAUTIL",15,0)
 D ^%ZISC
"RTN","DVBAUTIL",16,0)
KILL1 K %DT,%ZIS,ANS,BDATE,CNUM,EDATE,L,MA,DA,NODTA,PNAM,Q,QQ,RDATE,SSN,XY,VER,J,LN,POP,FINALDTE,ADMDT,BEDSEC,CFLOC,DIAG,DCHGDT,HEAD,HEAD1,MB,RCVAA,RCVPEN,A,TYPE,C,ADMNUM,DIPGM,DIS,HNAME,DVBAQUIT,DSRP
"RTN","DVBAUTIL",17,0)
 K WARD,NOASK,^TMP($J),DTOUT,ZTSK,IO("C"),I,RO,RONUM,LADM,K,RADM,%X,%Y,%XX,%YY,X,Y,ICDAT2,ICDAT,LOS,TDIS,DIC,POP,DVBATYPS,TO,NUMSEL,REP,DVBAFIND,DVBATP,DVBAPRNT,SITE,LINE,OPER,PG,HD,HD1,HEAD2,DVBADD
"RTN","DVBAUTIL",18,0)
 K ZTIO,ZTDESC,ZTRTN,DATA,SC,LDCH,FDT(0),NAME,DIE,DR,ZX,ZI,XDA,XADMDT,DLAYGO,HD,D,DIC,Y,Z,ZTYPE,D0,D1,DI,DQ,CNM,CFLC,XDTA,MC,MD,PROCDT,ADMDATE,EDAYS,CNT,XLOC,TEMP,TEMPDA,%ZIS,%IS,DIVHD,XDIV,DVBADIV,ADIV,BDT,EDT
"RTN","DVBAUTIL",19,0)
 K ZTYPE,DO,DTAR,X,Y,HEAD,HEAD1,ADTYPE,NDCH,DOCTYPE,ELIG,INCMP,LG,OUT,LADMDT,NONE,BDATE1,XDA2,ADM,DFN,DISCH,XCN,LCN,HOSP,NODE,T,TRN,ZTSAVE,ZDT,ZDT1,ZDA,IO("Q"),IOP,BDIV,EDIV,BDT1,EDT1,NEWREQ,BED,STAT,DVBADIC,ADMNUM
"RTN","DVBAUTIL",20,0)
 K X2,DHD,DIWF,DIWL,DIWR,DVBASC,DVBAELIG,FNLDT,CFLC,HIST,DVBAELST,OLDY,PDATE,ZTDTH,DTA,VAINDT,VAIN,WWHO,SDATE,%,DVBAQUIT,NODE,NOFINAL,^TMP("ADMIT",$J),LOC,AA,DVBASTAT,OLDY,ADMDT,ANS1,CURADMDT,DVBADT,DVBAH,DVBAQ
"RTN","DVBAUTIL",21,0)
 K DVBAI,DVBAT,HEADDT,HOSPDAYS,LBEDSEC,LDCHGDT,LDIAG,LLADM,LTDIS,MSG,MSG1,VX,VY,X1,XLINE,ZJ,ZY,ZZ,LOC,QUIT,QUIT1,^UTILITY($J),^TMP("DVBA",$J),^TMP("DVBA","PEN"),^TMP("DVBA","A&A"),DVBACEPT,DCHPTR,DVBA
"RTN","DVBAUTIL",22,0)
 Q
"RTN","DVBAUTIL",23,0)
 ;
"RTN","DVBAUTIL",24,0)
LOS ;compute length of stay for discharge report
"RTN","DVBAUTIL",25,0)
 S %DT="T" S X=ADMDT D ^%DT S X2=Y
"RTN","DVBAUTIL",26,0)
 S X=DCHGDT D ^%DT S X1=Y K Y
"RTN","DVBAUTIL",27,0)
 D ^%DTC S LOS=X I LOS=0 S LOS=""
"RTN","DVBAUTIL",28,0)
 Q
"RTN","DVBAUTIL",29,0)
DATE W !,?5,"The entry of future dates is NOT allowed.",!
"RTN","DVBAUTIL",30,0)
 S %DT(0)=-DT
"RTN","DVBAUTIL",31,0)
 S %DT("A")="BEGINNING date: ",%DT="AET" D ^%DT W:X="^"!(Y=-1) !! Q:X=""!(Y=-1)  S BDATE=Y
"RTN","DVBAUTIL",32,0)
 S %DT("A")="   ENDING date: ",%DT="AET" D ^%DT S EDATE=Y Q:X="^"
"RTN","DVBAUTIL",33,0)
 I EDATE<BDATE W !!,*7,"Invalid date sequence.  Beginning date must be before the ending date.",!! H 2 G DATE
"RTN","DVBAUTIL",34,0)
 S BDATE=BDATE-.5,EDATE=EDATE+.5
"RTN","DVBAUTIL",35,0)
 D SORT K %DT(0) Q
"RTN","DVBAUTIL",36,0)
 ;
"RTN","DVBAUTIL",37,0)
DICW S DVBADIC(0,"W")="S ZX=$P(^DVB(396,+Y,0),U,4) W:$X>40 ! W ""  Admission date: "",$$FMTE^XLFDT(ZX,""5DZ"") W ""  "",$S($P(^(1),U,12)'="""":""Finalized"",1:""Open"")"
"RTN","DVBAUTIL",38,0)
 ;
"RTN","DVBAUTIL",39,0)
DICW1 S DVBADIC(1,"W")="S ZX=$P(^DVB(396,+Y,0),U,4) W:$X>40 ! W ""  Activity date: "",$$FMTE^XLFDT(ZX,""5DZ"") W ""  "",$S($P(^(1),U,12)'="""":""Finalized"",1:""Open"")"
"RTN","DVBAUTIL",40,0)
 ;
"RTN","DVBAUTIL",41,0)
DICW2 S DIC("W")="S ZTYPE=$S($D(^DVB(396,+Y,2)):$P(^(2),U,10),1:""A"") X $S(ZTYPE=""L"":DVBADIC(1,""W""),1:DVBADIC(0,""W""))"
"RTN","DVBAUTIL",42,0)
 Q
"RTN","DVBAUTIL",43,0)
 ;
"RTN","DVBAUTIL",44,0)
FINAL ;
"RTN","DVBAUTIL",45,0)
 S $P(^DVB(396.1,1,0),"^",X)=DT ;x is the corresponding date field
"RTN","DVBAUTIL",46,0)
 G KILL1
"RTN","DVBAUTIL",47,0)
 ;
"RTN","DVBAUTIL",48,0)
DUZ2 K DVBAQUIT
"RTN","DVBAUTIL",49,0)
 I $G(DUZ(2))="" W *7,!!,"You have no division code.  Please contact the site manager.",!! H 3 S DVBAQUIT=1 Q
"RTN","DVBAUTIL",50,0)
 S DVBAD2=$S($D(^DIC(4,+DUZ(2),99)):$P(^(99),U,1),1:0)
"RTN","DVBAUTIL",51,0)
 I DVBAD2=0 W *7,!!,"Your division code is invalid.",!! H 3 S DVBAQUIT=1
"RTN","DVBAUTIL",52,0)
 ; Flag if the division has no station # in the INSITUTION file.
"RTN","DVBAUTIL",53,0)
 I $G(DVBAD2)="" W *7,!!,"Your division has no station number defined in the INSTITUTION file.",!,"Please consult IRM to request a unique station number for your division.",!! H 3 S DVBAQUIT=1
"RTN","DVBAUTIL",54,0)
 Q
"RTN","DVBAUTIL",55,0)
S ;
"RTN","DVBAUTIL",56,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",57,0)
 ;of AMIE.
"RTN","DVBAUTIL",58,0)
 Q
"RTN","DVBAUTIL",59,0)
S1 ;
"RTN","DVBAUTIL",60,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",61,0)
 ;of AMIE.
"RTN","DVBAUTIL",62,0)
 Q
"RTN","DVBAUTIL",63,0)
K ;
"RTN","DVBAUTIL",64,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",65,0)
 ;of AMIE.
"RTN","DVBAUTIL",66,0)
 Q
"RTN","DVBAUTIL",67,0)
K1 ;
"RTN","DVBAUTIL",68,0)
 ;this code is currently not available but will be in future version
"RTN","DVBAUTIL",69,0)
 ;of AMIE.
"RTN","DVBAUTIL",70,0)
 Q
"RTN","DVBAUTIL",71,0)
 ;
"RTN","DVBAUTIL",72,0)
EXIT ;called from the DVBAREG1 routine, kills off variables at end.
"RTN","DVBAUTIL",73,0)
 S VAR(1,0)="0,0,0,0:2,1^"
"RTN","DVBAUTIL",74,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAUTIL",75,0)
 K VAR,ADM,ADMDT,ANS,CNUM,DA,DFN,DIC,DIE,DR,PNAM,SSN,ZA,OPER,X,Y,POP,LOC,%,ZI,ONFILE,REOPEN,DVBADIV,STAT,ZX,HD,I,NAME,HNAME,DTAR,DTOUT,%Y,DOCTYPE,%Y1,DQ,DVBADIC,OUT,ZTYPE,A,ADMNUM,ANS1,OLDY,DVBASTAT,DVBAENTR,DVBAEDT
"RTN","DVBAUTIL",76,0)
 K DVBAD2,DVBAX,DVBCSSNO,AROWOUT,DVBADM,DVBANL,DVBAPT,DVBAQUIT,DVBBDT,DVBCHK,DVBDISP,DVBEDT,DVBSPCOD,DVBVAR,DVBCNT,DVBAY,DVBDOC,DVBAIFN,DVBANS
"RTN","DVBAUTIL",77,0)
 K ^TMP("DVBA",$J),^UTILITY("DIQ1",$J)
"RTN","DVBAUTIL",78,0)
 Q
"RTN","DVBAUTIL",79,0)
 ;
"RTN","DVBCRPON")
0^4^B16783860
"RTN","DVBCRPON",1,0)
DVBCRPON ;ALB/GTS-557/THM-REPRINT C&P REPORTS ; 7/1/91  1:09 PM
"RTN","DVBCRPON",2,0)
 ;;2.7;AMIE;**2,32**;Apr 10, 1995
"RTN","DVBCRPON",3,0)
 ;
"RTN","DVBCRPON",4,0)
SETUP D HOME^%ZIS K ULINE S FF=IOF,HD="Reprint C & P Exams"
"RTN","DVBCRPON",5,0)
 S XDD=^DD("DD"),$P(ULINE,"_",70)="_"
"RTN","DVBCRPON",6,0)
 I $G(DUZ(2))<1 W !!,*7,"Your division code is invalid.",!! H 2 G EXIT
"RTN","DVBCRPON",7,0)
 S SUPER=0 I $D(^XUSEC("DVBA C SUPERVISOR",DUZ)) S SUPER=1
"RTN","DVBCRPON",8,0)
 ;
"RTN","DVBCRPON",9,0)
SETUP1 ;** Drops into if setup is ok
"RTN","DVBCRPON",10,0)
 W @IOF,!?(IOM-$L(HD)\2),HD,!!!
"RTN","DVBCRPON",11,0)
 S ONE="N",Y=DT X XDD
"RTN","DVBCRPON",12,0)
 S DVBCDT(0)=Y,PGHD="Compensation and Pension Exam Report",LOC=DUZ(2),PG=0,DVBCSITE=$S($D(^DVB(396.1,1,0)):$P(^(0),U,1),1:"Not specified")
"RTN","DVBCRPON",13,0)
 ;
"RTN","DVBCRPON",14,0)
RASK W !!,"Select Reprint Option - (D)ate or (V)eteran:  D// " R RTYPE:DTIME I RTYPE[U!('$T) G EXIT
"RTN","DVBCRPON",15,0)
 I RTYPE'=""&(RTYPE'="D"&(RTYPE'="d"&(RTYPE'="v"&(RTYPE'="V")))) S RTYPE="E"
"RTN","DVBCRPON",16,0)
 W:RTYPE="" "Date" W $S(RTYPE="D"!(RTYPE="d"):"ate",RTYPE="V"!(RTYPE="v"):"eteran",1:"") I RTYPE=""!(RTYPE="d") S RTYPE="D"
"RTN","DVBCRPON",17,0)
 I RTYPE="v" S RTYPE="V"
"RTN","DVBCRPON",18,0)
 I RTYPE'?1"D",RTYPE'?1"V" W !!,"Must be D or V" G RASK
"RTN","DVBCRPON",19,0)
 G:RTYPE="D" ADATE I RTYPE="V" S ONE="Y"
"RTN","DVBCRPON",20,0)
 ;
"RTN","DVBCRPON",21,0)
ONLYLAB ;** Dropped into if the user doesn't exit from RASK and selects to
"RTN","DVBCRPON",22,0)
 ;**  to reprint by veteran
"RTN","DVBCRPON",23,0)
 W !!,"Do you want just the Lab/X-ray results" S %=2 D YN^DICN I %=1 H 1 G REN^DVBCLABR ;** Branches to ^DVBCLABR which branches to ^DVBCPRNT
"RTN","DVBCRPON",24,0)
 I %=0 W !!,"Enter Y to get just the Lab/X-ray results for the Vet",!,"or N to get the entire exam results AND Lab/X-ray." H 2 G ONLYLAB
"RTN","DVBCRPON",25,0)
 ;
"RTN","DVBCRPON",26,0)
ADATE ;** Jumped into from RASK or dropped into from ONLYLAB
"RTN","DVBCRPON",27,0)
 I RTYPE="D" S %DT="AE",%DT("A")="Enter original printing date: ",%DT(0)=-DT D ^%DT G:+Y<0 EXIT S RUNDATE=+Y
"RTN","DVBCRPON",28,0)
 ;
"RTN","DVBCRPON",29,0)
WHO ;** Dropped into from ADATE
"RTN","DVBCRPON",30,0)
 W !!,"Reprinted by the RO or MAS ?   >> " R ANS:DTIME G:'$T EXIT I ANS=""!(ANS=U) G EXIT
"RTN","DVBCRPON",31,0)
 I ANS'="R"&(ANS'="r"&(ANS'="m"&(ANS'="M"))) S ANS="E"
"RTN","DVBCRPON",32,0)
 W $S(ANS="M"!(ANS="m"):"AS",ANS="R"!(ANS="r"):"O",1:"")
"RTN","DVBCRPON",33,0)
 S:ANS="r" ANS="R"
"RTN","DVBCRPON",34,0)
 S:ANS="m" ANS="M"
"RTN","DVBCRPON",35,0)
 I ANS'?1"R"&(ANS'?1"M") W !,"Must be R for Regional Office or M for MAS.",!!,*7 G WHO
"RTN","DVBCRPON",36,0)
 I ANS="R" K AUTO ;selects header type
"RTN","DVBCRPON",37,0)
 I ANS="M" S AUTO=1
"RTN","DVBCRPON",38,0)
 I ONE="Y" K OUT D ONEVET I $D(OUT) G EXIT
"RTN","DVBCRPON",39,0)
 ;
"RTN","DVBCRPON",40,0)
DEVICE ;** Dropped into from WHO
"RTN","DVBCRPON",41,0)
 W @IOF S %ZIS="AEQ",%ZIS("B")="0;P-OTHER",%ZIS("A")="Output device: " D ^%ZIS G:POP EXIT
"RTN","DVBCRPON",42,0)
 I $D(IO("Q")),ONE="N" S ZTRTN="GO^DVBCRPRT",ZTIO=ION,ZTDESC="2507 Final Exam Reprint" F I="XDD","D*","PGHD","RTYPE","RUNDATE","Y","AUTO","LOC","ANS","ULINE","ONE" S ZTSAVE(I)=""
"RTN","DVBCRPON",43,0)
 I $D(IO("Q")),ONE="Y" S ZTRTN="OV^DVBCRPON",ZTIO=ION,ZTDESC="Single 2507 Final Exam Reprint" F I="XDD","D*","PGHD","RTYPE","RUNDATE","Y","AUTO","LOC","ANS","ULINE","ONE" S ZTSAVE(I)=""
"RTN","DVBCRPON",44,0)
 I $D(IO("Q")) D ^%ZTLOAD W:$D(ZTSK) !!,"Request queued",!! H 1 G EXIT
"RTN","DVBCRPON",45,0)
 I ONE="N" G GO^DVBCRPRT
"RTN","DVBCRPON",46,0)
 I ONE="Y" G OV
"RTN","DVBCRPON",47,0)
 ;
"RTN","DVBCRPON",48,0)
ONEVET ;** Called from WHO when ONE=Y
"RTN","DVBCRPON",49,0)
 W !! S DIC("W")="D DICW^DVBCUTIL",DIC="^DVB(396.3,",DIC(0)="AEQM" D ^DIC I X=""!(X=U) S OUT=1 Q
"RTN","DVBCRPON",50,0)
 I +Y<0 W *7,"   ???" H 2 G ONEVET
"RTN","DVBCRPON",51,0)
 S DA=+Y
"RTN","DVBCRPON",52,0)
 S RO=$P(^DVB(396.3,DA,0),U,3) I RO'=DUZ(2)&('$D(AUTO))&(SUPER=0) W !!,*7,"Those results do not belong to your office.",!! H 3 G ONEVET
"RTN","DVBCRPON",53,0)
 I RO=DUZ(2)&('$D(AUTO))&("RC"'[($P(^DVB(396.3,DA,0),U,18))) W *7,!!,"This request has not been released to the Regional Office yet.",!! H 3 G ONEVET
"RTN","DVBCRPON",54,0)
 S PRTDATE=$P(^DVB(396.3,DA,0),U,16) I PRTDATE="" W *7,!!,"This has never been printed.",!! I SUPER=0 S OUT=1 H 3 Q
"RTN","DVBCRPON",55,0)
 Q
"RTN","DVBCRPON",56,0)
 ;
"RTN","DVBCRPON",57,0)
OV ;** Run as a background task or in real-time
"RTN","DVBCRPON",58,0)
 U IO S DA(1)=DA K DVBAON2 D SETLAB^DVBCPRNT,VARS^DVBCUTIL,STEP2^DVBCRPRT
"RTN","DVBCRPON",59,0)
 K AUTO D ^%ZISC I '$D(ZTQUEUED) G SETUP1
"RTN","DVBCRPON",60,0)
 ;
"RTN","DVBCRPON",61,0)
EXIT K AUTO S LKILL=1 D:$D(ZTQUEUED) KILL^%ZTLOAD G KILL^DVBCUTIL
"RTN","DVBCRPON",62,0)
 ;
"RTN","DVBCRPON",63,0)
 Q
"VER")
8.0^22
**END**
**END**
