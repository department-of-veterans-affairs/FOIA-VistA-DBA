Released RG*1*42 SEQ #41
Extracted from mail message
**KIDS**:RG*1.0*42^

**INSTALL NAME**
RG*1.0*42
"BLD",2240,0)
RG*1.0*42^CLINICAL INFO RESOURCE NETWORK^0^3050629^y
"BLD",2240,1,0)
^^3^3^3050629^
"BLD",2240,1,1,0)
CHANGE TO HL7 ADT-A24 AND ADT-A43 MESSAGE PROCESSING
"BLD",2240,1,2,0)
Refer to patch RG*1*42 in the FORUM Patch Module for a complete
"BLD",2240,1,3,0)
description.
"BLD",2240,4,0)
^9.64PA^^
"BLD",2240,"ABNS",0)
^9.66A^^
"BLD",2240,"ABPKG")
^^
"BLD",2240,"KRN",0)
^9.67PA^8989.52^19
"BLD",2240,"KRN",.4,0)
.4
"BLD",2240,"KRN",.401,0)
.401
"BLD",2240,"KRN",.402,0)
.402
"BLD",2240,"KRN",.403,0)
.403
"BLD",2240,"KRN",.5,0)
.5
"BLD",2240,"KRN",.84,0)
.84
"BLD",2240,"KRN",3.6,0)
3.6
"BLD",2240,"KRN",3.8,0)
3.8
"BLD",2240,"KRN",9.2,0)
9.2
"BLD",2240,"KRN",9.8,0)
9.8
"BLD",2240,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2240,"KRN",9.8,"NM",1,0)
RGADTP1^^0^B28551249
"BLD",2240,"KRN",9.8,"NM",2,0)
RGDRM02^^0^B6829689
"BLD",2240,"KRN",9.8,"NM","B","RGADTP1",1)

"BLD",2240,"KRN",9.8,"NM","B","RGDRM02",2)

"BLD",2240,"KRN",19,0)
19
"BLD",2240,"KRN",19.1,0)
19.1
"BLD",2240,"KRN",101,0)
101
"BLD",2240,"KRN",409.61,0)
409.61
"BLD",2240,"KRN",771,0)
771
"BLD",2240,"KRN",870,0)
870
"BLD",2240,"KRN",8989.51,0)
8989.51
"BLD",2240,"KRN",8989.52,0)
8989.52
"BLD",2240,"KRN",8994,0)
8994
"BLD",2240,"KRN","B",.4,.4)

"BLD",2240,"KRN","B",.401,.401)

"BLD",2240,"KRN","B",.402,.402)

"BLD",2240,"KRN","B",.403,.403)

"BLD",2240,"KRN","B",.5,.5)

"BLD",2240,"KRN","B",.84,.84)

"BLD",2240,"KRN","B",3.6,3.6)

"BLD",2240,"KRN","B",3.8,3.8)

"BLD",2240,"KRN","B",9.2,9.2)

"BLD",2240,"KRN","B",9.8,9.8)

"BLD",2240,"KRN","B",19,19)

"BLD",2240,"KRN","B",19.1,19.1)

"BLD",2240,"KRN","B",101,101)

"BLD",2240,"KRN","B",409.61,409.61)

"BLD",2240,"KRN","B",771,771)

"BLD",2240,"KRN","B",870,870)

"BLD",2240,"KRN","B",8989.51,8989.51)

"BLD",2240,"KRN","B",8989.52,8989.52)

"BLD",2240,"KRN","B",8994,8994)

"BLD",2240,"QUES",0)
^9.62^^
"BLD",2240,"REQB",0)
^9.611^2^2
"BLD",2240,"REQB",1,0)
RG*1.0*27^2
"BLD",2240,"REQB",2,0)
RG*1.0*6^2
"BLD",2240,"REQB","B","RG*1.0*27",1)

"BLD",2240,"REQB","B","RG*1.0*6",2)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
42^3050629
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3050629
"PKG",272,22,1,"PAH",1,1,1,0)
CHANGE TO HL7 ADT-A24 AND ADT-A43 MESSAGE PROCESSING
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*42 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RGADTP1")
0^1^B28551249
"RTN","RGADTP1",1,0)
RGADTP1 ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS - CONTINUED ;6/2/02
"RTN","RGADTP1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**26,27,42**;30 Apr 99
"RTN","RGADTP1",3,0)
PIDP(MSG,ARRAY,HL) ;process PID segment
"RTN","RGADTP1",4,0)
 N ID,IDS,PIDAA,PIDNTC
"RTN","RGADTP1",5,0)
 ;Since PID can be over 245 characters loop through setting a PID ARRAY
"RTN","RGADTP1",6,0)
 ;sequenced PID(1)="PID"... PID(4 or 5) can be over 245 characters so
"RTN","RGADTP1",7,0)
 ;it will also loop and place it in PID(4,1...
"RTN","RGADTP1",8,0)
 ;
"RTN","RGADTP1",9,0)
 ; Input variables
"RTN","RGADTP1",10,0)
 ;   assumes that MSG or MSG(I) will contain the PID segment
"RTN","RGADTP1",11,0)
 ; Output ARRAY ARRAY will contain the following subscripts
"RTN","RGADTP1",12,0)
 ;   SSN - patient SSN
"RTN","RGADTP1",13,0)
 ;   ICN - patient ICN
"RTN","RGADTP1",14,0)
 ;   DFN - sites local identifier
"RTN","RGADTP1",15,0)
 ;   MPISSITE - authoritative source (station# of sending site)
"RTN","RGADTP1",16,0)
 ;   SEX - patient's SEX
"RTN","RGADTP1",17,0)
 ;   MPIDOB - Date of Birth
"RTN","RGADTP1",18,0)
 ;   NAME,SURNAME,FIRST,MIDDLE,PREFIX,and SUFFIX - Patient Name
"RTN","RGADTP1",19,0)
 ;   MMN - Mother's maiden name
"RTN","RGADTP1",20,0)
 ;   POBCITY, POBSTATE - Place of birth city and state
"RTN","RGADTP1",21,0)
 ;
"RTN","RGADTP1",22,0)
 N PID,MPIJ,LNGTH,LNGTH1,PID1,SEQ,SEQ1,COMP,SUBCOMP,REP,HLECH,X,Y,CNT,NXT,ID,IDS,PIDAA,PIDNTC,NAME,LNGTH2,PIDSITE,PIDXDT,HLECH,HLFS
"RTN","RGADTP1",23,0)
 S HLFS=HL("FS"),HLECH=HL("ECH")
"RTN","RGADTP1",24,0)
 S ARRAY("DFN")="",ARRAY("ICN")="",ARRAY("CLAIMN")="",ARRAY("SSN")=""
"RTN","RGADTP1",25,0)
 S COMP=$E(HL("ECH"),1),SUBCOMP=$E(HL("ECH"),4),REP=$E(HL("ECH"),2)
"RTN","RGADTP1",26,0)
 S LNGTH=$L(MSG,HL("FS")) F SEQ=1:1:LNGTH S PID(SEQ)=$P(MSG,HL("FS"),SEQ)
"RTN","RGADTP1",27,0)
 S SEQ1=1,X=0 F  S X=$O(MSG(X)) Q:'X  S LNGTH=$L(MSG(X),HL("FS")) D
"RTN","RGADTP1",28,0)
 . F Y=1:1:LNGTH S:Y'=1 SEQ=SEQ+1 D
"RTN","RGADTP1",29,0)
 .. S NXT=$P(MSG(X),HL("FS"),Y) D
"RTN","RGADTP1",30,0)
 ... I $L($G(PID(SEQ)))=245 D  Q
"RTN","RGADTP1",31,0)
 .... I $L(NXT_$G(PID(SEQ,SEQ1)))>245 S LNGTH1=$L(PID(SEQ,SEQ1)) S LNGTH2=245-LNGTH1,PID(SEQ,SEQ1)=$G(PID(SEQ,SEQ1))_$E(NXT,1,LNGTH2),LNGTH2=LNGTH2+1,NXT=$E(NXT,LNGTH2,$L(NXT)),SEQ1=SEQ1+1
"RTN","RGADTP1",32,0)
 .... I $L(NXT_$G(PID(SEQ,SEQ1)))'>245 S PID(SEQ,SEQ1)=$G(PID(SEQ,SEQ1))_NXT
"RTN","RGADTP1",33,0)
 ... I $L(NXT_$G(PID(SEQ)))>245 S LNGTH1=$L($G(PID(SEQ))) S LNGTH2=245-LNGTH1,PID(SEQ)=$G(PID(SEQ))_$E(NXT,1,LNGTH2),LNGTH2=LNGTH2+1,NXT=$E(NXT,LNGTH2,$L(NXT)) S PID(SEQ,SEQ1)=NXT
"RTN","RGADTP1",34,0)
 ... I $L(NXT_$G(PID(SEQ)))'>245 S PID(SEQ)=$G(PID(SEQ))_NXT Q
"RTN","RGADTP1",35,0)
 ;get PID-3 Patient Identifier List (three ids should be returned ICN, SSN, and DFN)
"RTN","RGADTP1",36,0)
 N LASTID,IDCNT,CNT
"RTN","RGADTP1",37,0)
 S IDS=PID(4)
"RTN","RGADTP1",38,0)
 S LASTID=$L(IDS,REP),IDCNT=1,IDS=PID(4),CNT=1
"RTN","RGADTP1",39,0)
 F X=1:1:LASTID S ID=$P(IDS,REP,X) D
"RTN","RGADTP1",40,0)
 .;if this is the last entry check for an extension of the message and reset the key variables
"RTN","RGADTP1",41,0)
 .I X=LASTID I $D(PID(4,IDCNT)) S ID=ID_$P(PID(4,IDCNT),REP),IDS=$P(PID(4,IDCNT),REP,2,99),IDCNT=IDCNT+1,X=0,LASTID=$L(IDS,REP)
"RTN","RGADTP1",42,0)
 . ;get id, assigning authority, and name type code
"RTN","RGADTP1",43,0)
 . S PIDAA=$P($P(ID,COMP,4),SUBCOMP),PIDNTC=$P(ID,COMP,5),PIDSITE=$P($P(ID,COMP,6),SUBCOMP,2),PIDXDT=$P(ID,COMP,8)
"RTN","RGADTP1",44,0)
 . S ID=$P(ID,COMP)
"RTN","RGADTP1",45,0)
 . Q:ID=""
"RTN","RGADTP1",46,0)
 . ;check assigning authority(0363) AND name type code(0203)
"RTN","RGADTP1",47,0)
 . I PIDAA="USVHA" D
"RTN","RGADTP1",48,0)
 .. I PIDNTC="NI" D
"RTN","RGADTP1",49,0)
 ... I $G(PIDXDT)="" S ARRAY("ICN")=ID,ARRAY("MPISSITE")=PIDSITE,ARRAY(991.02)=$P(ID,"V",2)  ;National unique individual identifier
"RTN","RGADTP1",50,0)
 ... I $G(PIDXDT)'="" S ARRAY("OID",CNT)=ID_"^"_PIDAA_"^"_PIDSITE_"^"_PIDXDT,CNT=CNT+1  ;Deprecated National unique individual identifier
"RTN","RGADTP1",51,0)
 .. I PIDNTC="PI" S ARRAY("DFN")=ID,ARRAY("DFNLOC")=PIDSITE  ;Patient internal identifier
"RTN","RGADTP1",52,0)
 . I PIDAA="USSSA" D
"RTN","RGADTP1",53,0)
 .. I PIDNTC="SS" S ARRAY("SSN")=ID  ;Social Security number
"RTN","RGADTP1",54,0)
 . I PIDAA="USVBA" D
"RTN","RGADTP1",55,0)
 .. I PIDNTC="PN" S ARRAY("CLAIMN")=ID  ;VBA CLAIM#
"RTN","RGADTP1",56,0)
 ;get PID-4 alternate ID (ICN History)
"RTN","RGADTP1",57,0)
 I $G(PID(5))'="" D
"RTN","RGADTP1",58,0)
 . S CNT=1
"RTN","RGADTP1",59,0)
 . F X=1:1:$L(PID(5),REP) S ARRAY("OID",CNT)=$P(PID(5),REP,X),CNT=CNT+1
"RTN","RGADTP1",60,0)
 . S Y=0 F  S Y=$O(PID(5,Y)) Q:'Y  D
"RTN","RGADTP1",61,0)
 .. S ARRAY("OID",CNT-1)=ARRAY("OID",CNT-1)_$P(PID(5,Y),REP)
"RTN","RGADTP1",62,0)
 .. F X=2:1:$L(PID(5,Y),REP) S ARRAY("OID",CNT)=$P(PID(5,Y),REP,X),CNT=CNT+1
"RTN","RGADTP1",63,0)
 . S X=0 F  S X=$O(ARRAY("OID",X)) Q:'X  D
"RTN","RGADTP1",64,0)
 .. N ID,AA,AL S ID=$P(ARRAY("OID",X),COMP),AA=$P($P(ARRAY("OID",X),COMP,4),SUBCOMP,1),AL=$P($P(ARRAY("OID",X),COMP,6),SUBCOMP,2) S AL=$$IEN^XUAF4(AL)
"RTN","RGADTP1",65,0)
 .. S ARRAY("OID",X)=ID_"^"_AA_"^"_AL
"RTN","RGADTP1",66,0)
 ;get PID-5 Patient Name
"RTN","RGADTP1",67,0)
 I $G(PID(6))'="" S NAME=PID(6),ARRAY("SURNAME")=$P(NAME,COMP),ARRAY("FIRST")=$P(NAME,COMP,2),ARRAY("MIDDLE")=$P(NAME,COMP,3),ARRAY("PREFIX")=$P(NAME,COMP,4),ARRAY("SUFFIX")=$P(NAME,COMP,5) D
"RTN","RGADTP1",68,0)
 . S ARRAY("NAME")=$$FMNAME^HLFNC($P(PID(6),COMP,1,6))
"RTN","RGADTP1",69,0)
 ;get PID-6 Mother's maiden name
"RTN","RGADTP1",70,0)
 S ARRAY("MMN")=$P($G(PID(7)),COMP,1,5) D
"RTN","RGADTP1",71,0)
 . I $P(ARRAY("MMN"),COMP)'=HL("Q") S HLECH=HL("ECH") S ARRAY("MMN")=$$FREE^RGRSPARS($$FMNAME^HLFNC(ARRAY("MMN"))) Q
"RTN","RGADTP1",72,0)
 . I $P(ARRAY("MMN"),COMP)=HL("Q") S ARRAY("MMN")=$$FREE^RGRSPARS($P(ARRAY("MMN"),COMP))
"RTN","RGADTP1",73,0)
 ;get PID-7 Date of Birth
"RTN","RGADTP1",74,0)
 S ARRAY("MPIDOB")=$$FMDATE^HLFNC($G(PID(8)))
"RTN","RGADTP1",75,0)
 ;get PID-8 Sex
"RTN","RGADTP1",76,0)
 S ARRAY("SEX")=$G(PID(9))
"RTN","RGADTP1",77,0)
 ;get PID-11-3 ADDRESS BOTH "P"rimary and "N" Place of
"RTN","RGADTP1",78,0)
 S CNT=1
"RTN","RGADTP1",79,0)
 N ADRTYPE,ADDR
"RTN","RGADTP1",80,0)
 F X=1:1:$L(PID(12),REP) D
"RTN","RGADTP1",81,0)
 . S ADDR=$P(PID(12),REP,X),ADRTYPE=$P(ADDR,COMP,7)
"RTN","RGADTP1",82,0)
 . I ADRTYPE="P" D
"RTN","RGADTP1",83,0)
 .. S ADDR=$$FREE^RGRSPARS(ADDR)
"RTN","RGADTP1",84,0)
 .. S ARRAY(.111)=$$FREE^RGRSPARS($P(ADDR,COMP,1))  ;addr [1]
"RTN","RGADTP1",85,0)
 .. S ARRAY(.112)=$$FREE^RGRSPARS($P(ADDR,COMP,2))  ;addr [2]
"RTN","RGADTP1",86,0)
 .. S ARRAY(.113)=$$FREE^RGRSPARS($P(ADDR,COMP,8))  ;addr [3]
"RTN","RGADTP1",87,0)
 .. S ARRAY(.114)=$$FREE^RGRSPARS($P(ADDR,COMP,3))  ;city
"RTN","RGADTP1",88,0)
 .. S ARRAY(.115)=$$STATE^RGRSPARS($P(ADDR,COMP,4))  ;state
"RTN","RGADTP1",89,0)
 .. S ARRAY(.1112)=$$FREE^RGRSPARS($P(ADDR,COMP,5))  ;zip+4
"RTN","RGADTP1",90,0)
 .. N CNTYCODE S CNTYCODE=PID(13)  ;county code
"RTN","RGADTP1",91,0)
 .. S ARRAY(.117)=$$COUNTY^RGRSPARS(ARRAY(.115),CNTYCODE)
"RTN","RGADTP1",92,0)
 .. S ARRAY(.131)=$$FREE^RGRSPARS(PID(14))
"RTN","RGADTP1",93,0)
 .. S ARRAY(.132)=$$FREE^RGRSPARS(PID(15))
"RTN","RGADTP1",94,0)
 . I ADRTYPE="N" D
"RTN","RGADTP1",95,0)
 .. S ARRAY("POBCITY")=$$FREE^RGRSPARS($P(ADDR,COMP,3))  ;POB city
"RTN","RGADTP1",96,0)
 .. S ARRAY("POBSTATE")=$$STATE^RGRSPARS($P(ADDR,COMP,4))  ;POB state
"RTN","RGADTP1",97,0)
 ;marital status
"RTN","RGADTP1",98,0)
 S ARRAY(.05)=$$MARITAL^RGRSPARS(PID(17))
"RTN","RGADTP1",99,0)
 ;religious preference
"RTN","RGADTP1",100,0)
 S ARRAY(.08)=$$RELIG^RGRSPARS(PID(18))
"RTN","RGADTP1",101,0)
 ;address
"RTN","RGADTP1",102,0)
 ;get PID-29 Date of Death
"RTN","RGADTP1",103,0)
 S ARRAY("MPIDOD")=$$FREE^RGRSPARS($$FMDATE^HLFNC($G(PID(30)))),ARRAY(.351)=ARRAY("MPIDOD")
"RTN","RGADTP1",104,0)
 Q
"RTN","RGDRM02")
0^2^B6829689
"RTN","RGDRM02",1,0)
RGDRM02 ;BAY/ALS-MPI/PD AWARE DUPLICATE RECORD MERGE ;03/10/00
"RTN","RGDRM02",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**6,42**;30 Apr 99
"RTN","RGDRM02",3,0)
MRGTF(DFNFRM,DFNTO) ; Merge Treating Facility entries 
"RTN","RGDRM02",4,0)
 I '$D(DFNFRM)!'$D(DFNTO) Q
"RTN","RGDRM02",5,0)
 Q:'$D(^DGCN(391.91,"APAT",DFNFRM))
"RTN","RGDRM02",6,0)
 ; Add Treating Facilities in FROM record to Treating 
"RTN","RGDRM02",7,0)
 ; Facility List for TO record
"RTN","RGDRM02",8,0)
 S INST=0
"RTN","RGDRM02",9,0)
 F  S INST=$O(^DGCN(391.91,"APAT",DFNFRM,INST)) Q:'INST  D
"RTN","RGDRM02",10,0)
 . I '$D(^DGCN(391.91,"APAT",DFNTO,INST)) DO
"RTN","RGDRM02",11,0)
 .. ;S STANUM=0
"RTN","RGDRM02",12,0)
 .. ;S STANUM=$P($$NS^XUAF4(INST),"^",2)
"RTN","RGDRM02",13,0)
 .. D FILE^VAFCTFU(DFNTO,INST,1) ;**42
"RTN","RGDRM02",14,0)
 .. I '$D(^DGCN(391.91,"APAT",DFNTO,INST)) D
"RTN","RGDRM02",15,0)
 ... D START^RGHLLOG($G(HLMTIEN)),EXC^RGHLLOG(212,"Treating Facility Add failed for DFN: "_DFNTO_", Treating Facility: "_INST,DFNTO),STOP^RGHLLOG(0) Q
"RTN","RGDRM02",16,0)
 . ;Delete FROM record Treating Facility data
"RTN","RGDRM02",17,0)
 . S IEN=0
"RTN","RGDRM02",18,0)
 . F  S IEN=$O(^DGCN(391.91,"APAT",DFNFRM,INST,IEN)) Q:'IEN  D
"RTN","RGDRM02",19,0)
 .. S DA=IEN,DIK="^DGCN(391.91,"
"RTN","RGDRM02",20,0)
 .. D ^DIK K DIK,DA
"RTN","RGDRM02",21,0)
 K INST,STANUM,IEN
"RTN","RGDRM02",22,0)
 Q
"RTN","RGDRM02",23,0)
MRGSUB(DFNFRM,DFNTO) ; Merge Subscription entries.
"RTN","RGDRM02",24,0)
 I '$D(DFNFRM)!'$D(DFNTO) Q
"RTN","RGDRM02",25,0)
 N SUBFRM,SUBTO
"RTN","RGDRM02",26,0)
 S SUBFRM=$$SUBNUM^MPIFAPI(DFNFRM)
"RTN","RGDRM02",27,0)
 Q:SUBFRM<0  ;No subscriptions in FRM record, quit
"RTN","RGDRM02",28,0)
 S SUBTO=$$SUBNUM^MPIFAPI(DFNTO)
"RTN","RGDRM02",29,0)
 I SUBTO<0 S SUBTO=$$GETSCN^RGJCREC(DFNTO)
"RTN","RGDRM02",30,0)
 S ENTRYF=0,ENTRYT=0
"RTN","RGDRM02",31,0)
 D GET^HLSUB(SUBFRM,0,"",.FROM)
"RTN","RGDRM02",32,0)
 D GET^HLSUB(SUBTO,0,"",.TO)
"RTN","RGDRM02",33,0)
 F  S ENTRYF=$O(FROM("LINKS",ENTRYF)) Q:'ENTRYF  D
"RTN","RGDRM02",34,0)
 . S LINKF=$P(FROM("LINKS",ENTRYF),"^",2)
"RTN","RGDRM02",35,0)
 . S MATCH=0
"RTN","RGDRM02",36,0)
 . F  S ENTRYT=$O(TO("LINKS",ENTRYT)) Q:'ENTRYT  D
"RTN","RGDRM02",37,0)
 .. S LINKT=$P(TO("LINKS",ENTRYT),"^",2)
"RTN","RGDRM02",38,0)
 .. I LINKF=LINKT S MATCH=1 Q
"RTN","RGDRM02",39,0)
 . I MATCH=0 D
"RTN","RGDRM02",40,0)
 .. S TYPE=0
"RTN","RGDRM02",41,0)
 .. D UPD^HLSUB(SUBTO,LINKF,TYPE,"","","",.ER)
"RTN","RGDRM02",42,0)
 .. K TO
"RTN","RGDRM02",43,0)
 .. D GET^HLSUB(SUBTO,0,"",.TO)  ; get new list
"RTN","RGDRM02",44,0)
 .. S L=0,LINK="",ADD=0
"RTN","RGDRM02",45,0)
 .. F  S L=$O(TO("LINKS",L)) Q:'L  D
"RTN","RGDRM02",46,0)
 ... S LINK=$P(TO("LINKS",L),"^",2) I LINK=LINKF S ADD=1
"RTN","RGDRM02",47,0)
 .. I ADD=0 D
"RTN","RGDRM02",48,0)
 ... D START^RGHLLOG($G(HLMTIEN)),EXC^RGHLLOG(224,"Subscription Add Failed for DFN: "_DFNTO_", Subscriber: "_LINKF,DFNTO),STOP^RGHLLOG(0) Q
"RTN","RGDRM02",49,0)
 ; Delete FROM record subscription data and pointer to subscription file
"RTN","RGDRM02",50,0)
 N RGARR,RGERR
"RTN","RGDRM02",51,0)
 S RGARR(991.05)="@"
"RTN","RGDRM02",52,0)
 S RGERR=$$UPDATE^MPIFAPI(DFNFRM,"RGARR")
"RTN","RGDRM02",53,0)
 K ENTRYF,ENTRYT,LINKF,LINKT,TO,MATCH,FROM,LNAME,LIEN,TYPE,ER,ADD,L,LINK
"RTN","RGDRM02",54,0)
 Q
"VER")
8.0^22.0
"BLD",2240,6)
^SEQ #41
**END**
**END**
