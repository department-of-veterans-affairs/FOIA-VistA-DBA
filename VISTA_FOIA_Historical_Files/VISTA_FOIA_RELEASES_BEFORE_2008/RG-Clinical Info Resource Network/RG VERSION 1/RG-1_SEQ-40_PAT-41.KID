Released RG*1*41 SEQ #40
Extracted from mail message
**KIDS**:RG*1.0*41^

**INSTALL NAME**
RG*1.0*41
"BLD",2217,0)
RG*1.0*41^CLINICAL INFO RESOURCE NETWORK^0^3050513^y
"BLD",2217,1,0)
^^3^3^3050513^
"BLD",2217,1,1,0)
MPI REMOTE QUERY FOR STATISTICS REPORT
"BLD",2217,1,2,0)
Refer to patch RG*1*41 in the FORUM Patch Module for a complete
"BLD",2217,1,3,0)
description.
"BLD",2217,4,0)
^9.64PA^^
"BLD",2217,"ABNS",0)
^9.66A^^
"BLD",2217,"ABPKG")
^^
"BLD",2217,"KRN",0)
^9.67PA^8989.52^19
"BLD",2217,"KRN",.4,0)
.4
"BLD",2217,"KRN",.401,0)
.401
"BLD",2217,"KRN",.402,0)
.402
"BLD",2217,"KRN",.403,0)
.403
"BLD",2217,"KRN",.5,0)
.5
"BLD",2217,"KRN",.84,0)
.84
"BLD",2217,"KRN",3.6,0)
3.6
"BLD",2217,"KRN",3.8,0)
3.8
"BLD",2217,"KRN",9.2,0)
9.2
"BLD",2217,"KRN",9.8,0)
9.8
"BLD",2217,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",2217,"KRN",9.8,"NM",2,0)
RGEX04^^0^B5464160
"BLD",2217,"KRN",9.8,"NM",3,0)
RGMTUT01^^0^B78704559
"BLD",2217,"KRN",9.8,"NM",4,0)
RGMTUT02^^0^B13689876
"BLD",2217,"KRN",9.8,"NM","B","RGEX04",2)

"BLD",2217,"KRN",9.8,"NM","B","RGMTUT01",3)

"BLD",2217,"KRN",9.8,"NM","B","RGMTUT02",4)

"BLD",2217,"KRN",19,0)
19
"BLD",2217,"KRN",19.1,0)
19.1
"BLD",2217,"KRN",101,0)
101
"BLD",2217,"KRN",409.61,0)
409.61
"BLD",2217,"KRN",771,0)
771
"BLD",2217,"KRN",870,0)
870
"BLD",2217,"KRN",8989.51,0)
8989.51
"BLD",2217,"KRN",8989.52,0)
8989.52
"BLD",2217,"KRN",8994,0)
8994
"BLD",2217,"KRN","B",.4,.4)

"BLD",2217,"KRN","B",.401,.401)

"BLD",2217,"KRN","B",.402,.402)

"BLD",2217,"KRN","B",.403,.403)

"BLD",2217,"KRN","B",.5,.5)

"BLD",2217,"KRN","B",.84,.84)

"BLD",2217,"KRN","B",3.6,3.6)

"BLD",2217,"KRN","B",3.8,3.8)

"BLD",2217,"KRN","B",9.2,9.2)

"BLD",2217,"KRN","B",9.8,9.8)

"BLD",2217,"KRN","B",19,19)

"BLD",2217,"KRN","B",19.1,19.1)

"BLD",2217,"KRN","B",101,101)

"BLD",2217,"KRN","B",409.61,409.61)

"BLD",2217,"KRN","B",771,771)

"BLD",2217,"KRN","B",870,870)

"BLD",2217,"KRN","B",8989.51,8989.51)

"BLD",2217,"KRN","B",8989.52,8989.52)

"BLD",2217,"KRN","B",8994,8994)

"BLD",2217,"QUES",0)
^9.62^^
"BLD",2217,"REQB",0)
^9.611^4^3
"BLD",2217,"REQB",2,0)
RG*1.0*25^2
"BLD",2217,"REQB",3,0)
RG*1.0*31^2
"BLD",2217,"REQB",4,0)
RG*1.0*37^2
"BLD",2217,"REQB","B","RG*1.0*25",2)

"BLD",2217,"REQB","B","RG*1.0*31",3)

"BLD",2217,"REQB","B","RG*1.0*37",4)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
41^3050513
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3050513
"PKG",272,22,1,"PAH",1,1,1,0)
MPI REMOTE QUERY FOR STATISTICS REPORT
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*41 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","RGEX04")
0^2^B5464160
"RTN","RGEX04",1,0)
RGEX04 ;BAY/ALS-LIST MANAGER ROUTINE FOR MPI/PD EXCEPTION PDAT QUERY ;10/31/01
"RTN","RGEX04",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**23,25,41**;30 Apr 99
"RTN","RGEX04",3,0)
EN ;main entry point for RG EXCPT PDAT
"RTN","RGEX04",4,0)
 D EN^VALM("RG EXCPT PDAT")
"RTN","RGEX04",5,0)
 Q
"RTN","RGEX04",6,0)
HDR ; header code
"RTN","RGEX04",7,0)
 S VALMHDR(1)="MPI/PD PATIENT DATA"
"RTN","RGEX04",8,0)
 S VALMHDR(2)=""
"RTN","RGEX04",9,0)
 Q
"RTN","RGEX04",10,0)
INIT ;
"RTN","RGEX04",11,0)
 K ^TMP("RGEXC4",$J)
"RTN","RGEX04",12,0)
 K @VALMAR
"RTN","RGEX04",13,0)
 ;I '$D(ICN) G EXIT
"RTN","RGEX04",14,0)
 I '$D(^TMP("RGPDAT",$J)) G EXIT
"RTN","RGEX04",15,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","RGEX04",16,0)
 F  S X=$O(^TMP("RGPDAT",$J,X)) Q:'X  D
"RTN","RGEX04",17,0)
 . S TXT=^TMP("RGPDAT",$J,X)
"RTN","RGEX04",18,0)
 . I $E(TXT,1,12)'="Enter RETURN" D
"RTN","RGEX04",19,0)
 .. S STR=$$SETSTR^VALM1(TXT,STR,2,78)
"RTN","RGEX04",20,0)
 .. D ADDTMP
"RTN","RGEX04",21,0)
 S VALMCNT=LIN-1
"RTN","RGEX04",22,0)
 Q
"RTN","RGEX04",23,0)
ADDTMP ;
"RTN","RGEX04",24,0)
 S ^TMP("RGEXC4",$J,LIN,0)=STR
"RTN","RGEX04",25,0)
 S ^TMP("RGEXC4",$J,"IDX",LIN,LIN)=""
"RTN","RGEX04",26,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX04",27,0)
 Q
"RTN","RGEX04",28,0)
RSEND ;Send remote PDAT Query
"RTN","RGEX04",29,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",30,0)
 D FULL^VALM1
"RTN","RGEX04",31,0)
 D SEND^RGRPDAT
"RTN","RGEX04",32,0)
 D PAUSE^VALM1
"RTN","RGEX04",33,0)
 S ICN=RICN
"RTN","RGEX04",34,0)
 D INIT
"RTN","RGEX04",35,0)
 S VALMBCK="R"
"RTN","RGEX04",36,0)
 Q
"RTN","RGEX04",37,0)
RCHK ;Check remote PDAT Query
"RTN","RGEX04",38,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",39,0)
 D FULL^VALM1
"RTN","RGEX04",40,0)
 D CHKSTAT^RGRPDAT
"RTN","RGEX04",41,0)
 D PAUSE^VALM1
"RTN","RGEX04",42,0)
 S ICN=RICN
"RTN","RGEX04",43,0)
 D INIT
"RTN","RGEX04",44,0)
 S VALMBCK="R"
"RTN","RGEX04",45,0)
 Q
"RTN","RGEX04",46,0)
RDISP ;Display remote PDAT Query
"RTN","RGEX04",47,0)
 S VALMBCK="",RICN=ICN
"RTN","RGEX04",48,0)
 D FULL^VALM1
"RTN","RGEX04",49,0)
 W !!,"Display data returned from remote patient data queries."
"RTN","RGEX04",50,0)
 S TFL="",L="",Y="",ICNARR="",STATUS=""
"RTN","RGEX04",51,0)
 I '$D(^XTMP("RGPDAT"_ICN)) W !!,"No remote query sent for this patient. " G QRD
"RTN","RGEX04",52,0)
 D GETTFL^RGRPDAT(ICN,.TFL)
"RTN","RGEX04",53,0)
 W !!,"-> For ICN ",$P(ICN,"V",1),!
"RTN","RGEX04",54,0)
 I $D(TFL(0)) D
"RTN","RGEX04",55,0)
 . S X=0 F  S X=$O(TFL(X)) Q:'X  I '$D(^XTMP("RGPDAT"_ICN,X)) K TFL(X)
"RTN","RGEX04",56,0)
 D SELTF^RGRPDAT
"RTN","RGEX04",57,0)
 I '$D(TFARR) W !,"No remote query sent for this patient." G QRD
"RTN","RGEX04",58,0)
 I ((Y="")!(Y="^")) G QRD
"RTN","RGEX04",59,0)
 D PAUSE^VALM1
"RTN","RGEX04",60,0)
 D EN^RGEX05(RICN)
"RTN","RGEX04",61,0)
QRD D PAUSE^VALM1
"RTN","RGEX04",62,0)
 S ICN=RICN
"RTN","RGEX04",63,0)
 D INIT
"RTN","RGEX04",64,0)
 S VALMBCK="R"
"RTN","RGEX04",65,0)
 Q
"RTN","RGEX04",66,0)
HELP ;
"RTN","RGEX04",67,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX04",68,0)
 Q
"RTN","RGEX04",69,0)
EXIT ;
"RTN","RGEX04",70,0)
 S VALMBCK=""
"RTN","RGEX04",71,0)
 K ^TMP("RGEXC4",$J),^TMP("RGPDAT",$J),LIN,X,STR,TXT,RICN,Y,STATUS,TFL,TFARR,L,ICNARR
"RTN","RGEX04",72,0)
 S VALMBCK="R"
"RTN","RGEX04",73,0)
 Q
"RTN","RGMTUT01")
0^3^B78704559
"RTN","RGMTUT01",1,0)
RGMTUT01 ;BIR/CML-MPI/PD Compile and Correct Data Validation Data for Local Sites ;08/12/02
"RTN","RGMTUT01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20,31,41**;30 Apr 99
"RTN","RGMTUT01",3,0)
 ;
"RTN","RGMTUT01",4,0)
 ;Reference to $$UPDATE^MPIFAPI supported by IA #2706
"RTN","RGMTUT01",5,0)
 ;Reference to VAFCTFU supported by IA #2988
"RTN","RGMTUT01",6,0)
 ;Reference to ^DPT( supported by IA #2070
"RTN","RGMTUT01",7,0)
 ;Reference to ^DGCN(391.91,"APAT" supported by IA #2911
"RTN","RGMTUT01",8,0)
 ;Reference to ^%ZTSCH("TASK" supported by IA #3520
"RTN","RGMTUT01",9,0)
 ;
"RTN","RGMTUT01",10,0)
EN1 ;Use this entry point to get only display diagnostics for development team
"RTN","RGMTUT01",11,0)
 ;BYPASS=0 means prohibit times are enforced
"RTN","RGMTUT01",12,0)
 ;SITEOPT=0 means CMOR, TF, and diagnostics are included in report
"RTN","RGMTUT01",13,0)
 ;SITEOPT=1 means diagnostics are omitted from report (this is the report for the site)
"RTN","RGMTUT01",14,0)
 ;SITEOPT=2 means only diagnostics are in report
"RTN","RGMTUT01",15,0)
 ;
"RTN","RGMTUT01",16,0)
 S BYPASS=0,SITEOPT=2 G BEGIN
"RTN","RGMTUT01",17,0)
 ;
"RTN","RGMTUT01",18,0)
EN2 ;Use this entry point from remote query
"RTN","RGMTUT01",19,0)
 S BYPASS=1,SITEOPT=0 G BEGIN  ; **41
"RTN","RGMTUT01",20,0)
 ;
"RTN","RGMTUT01",21,0)
EN3 ;Use this entry point for site menu option [RG NATIONAL ICN STATISTICS] to omit
"RTN","RGMTUT01",22,0)
 ;diagnostic section from report
"RTN","RGMTUT01",23,0)
 S BYPASS=0,SITEOPT=1 G BEGIN
"RTN","RGMTUT01",24,0)
 ;
"RTN","RGMTUT01",25,0)
BY ;use this call to bypass check to prohibit primetime run
"RTN","RGMTUT01",26,0)
 S BYPASS=1,SITEOPT=2
"RTN","RGMTUT01",27,0)
 ;
"RTN","RGMTUT01",28,0)
BEGIN ;
"RTN","RGMTUT01",29,0)
 S PRT=0,QFLG=0 K RGROU
"RTN","RGMTUT01",30,0)
 I $D(^XTMP("RGMT","UT01","@@","COMPILE STARTED"))&('$D(^XTMP("RGMT","UT01","@@","COMPILE STOPPED"))) D  I QFLG G QUIT
"RTN","RGMTUT01",31,0)
 .;check running tasks to see if compile is running
"RTN","RGMTUT01",32,0)
 .S TASK=0 F  S TASK=$O(^%ZTSCH("TASK",TASK)) Q:'TASK  D
"RTN","RGMTUT01",33,0)
 ..S RGROU=$P(^%ZTSCH("TASK",TASK),"^",2)
"RTN","RGMTUT01",34,0)
 ..I RGROU="RGMTSTAT" D
"RTN","RGMTUT01",35,0)
 ...I TASK=$G(ZTSK) Q
"RTN","RGMTUT01",36,0)
 ...S QFLG=1
"RTN","RGMTUT01",37,0)
 ...I '$D(RGHLMQ) W !!,"The Stat Report is currently being compiled."
"RTN","RGMTUT01",38,0)
 .I 'QFLG K ^XTMP("RGMT","UT01"),^XTMP("RGMT","REINDDT")
"RTN","RGMTUT01",39,0)
 ;
"RTN","RGMTUT01",40,0)
 I $D(RGHLMQ) G STARTQ
"RTN","RGMTUT01",41,0)
 W !!,"This option provides the following statistics:"
"RTN","RGMTUT01",42,0)
 W !?3,"1.  Total patients assigned to each unique COORDINATING MASTER OF"
"RTN","RGMTUT01",43,0)
 W !?3,"    RECORD (CMOR)."
"RTN","RGMTUT01",44,0)
 W !?3,"2.  Total patients shared with each unique entry in the TREATING"
"RTN","RGMTUT01",45,0)
 W !?3,"    FACILITY LIST (#391.91) file."
"RTN","RGMTUT01",46,0)
 W !?3,"3.  Totals for national ICNs, local ICNs, and patients with no ICN."
"RTN","RGMTUT01",47,0)
 I SITEOPT=1 G START
"RTN","RGMTUT01",48,0)
 W !?3,"4.  Total CMOR assignments missing a matching Treating Facility."
"RTN","RGMTUT01",49,0)
 W !?3,"5.  Total patients with NATIONAL ICN and missing local Treating Facility."
"RTN","RGMTUT01",50,0)
 W !?3,"6.  Total number of patients with duplicate entries in the TREATING"
"RTN","RGMTUT01",51,0)
 W !?3,"    FACILITY LIST file (#391.91)."
"RTN","RGMTUT01",52,0)
 W !?3,"7.  Patient File xref problems for ""AICN"", ""AICNL"", and ""SSN""."
"RTN","RGMTUT01",53,0)
 W !?3,"8.  Total number of patients with a no ICN but have a CMOR assignment."
"RTN","RGMTUT01",54,0)
 W !?3,"9.  Total number of patients with a no ICN but have TF assignments."
"RTN","RGMTUT01",55,0)
 W !?3,"10. Total number of patients with a local ICN but have remote TFs."
"RTN","RGMTUT01",56,0)
 ;
"RTN","RGMTUT01",57,0)
START ;
"RTN","RGMTUT01",58,0)
 S QFLG=0
"RTN","RGMTUT01",59,0)
 I '$D(^XTMP("RGMT","UT01","@@","COMPILE STARTED")) W !!,"No data is currently available." I SITEOPT=1 G QUIT
"RTN","RGMTUT01",60,0)
 ;
"RTN","RGMTUT01",61,0)
 W !!,"===> NOTE <==="
"RTN","RGMTUT01",62,0)
 I SITEOPT=1 D
"RTN","RGMTUT01",63,0)
 .W !,"This data is compiled by a remote process initiated from the MPI in Austin"
"RTN","RGMTUT01",64,0)
 .W !,"on a regular basis for reporting purposes.  It is not compiled by the local"
"RTN","RGMTUT01",65,0)
 .W !,"site, however, the local site can view the last report that was compiled.",!
"RTN","RGMTUT01",66,0)
 ;
"RTN","RGMTUT01",67,0)
 I $D(^XTMP("RGMT","UT01","@@","COMPILE STOPPED")) D  G:QFLG QUIT I PRT D ^RGMTUT03 G QUIT
"RTN","RGMTUT01",68,0)
 .S PRT=0
"RTN","RGMTUT01",69,0)
 .S LAST=^XTMP("RGMT","UT01","@@","COMPILE STOPPED")
"RTN","RGMTUT01",70,0)
 .S LAST=$$FMTE^XLFDT(LAST)
"RTN","RGMTUT01",71,0)
 .W !,"This data was last compiled on ",LAST,"."
"RTN","RGMTUT01",72,0)
 .I SITEOPT=1 S PRT=1 Q
"RTN","RGMTUT01",73,0)
 .S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you just want a reprint of that data"
"RTN","RGMTUT01",74,0)
 .S DIR("?",1)="Enter:"
"RTN","RGMTUT01",75,0)
 .S DIR("?",2)=" ""YES"" or <RET> to reprint current data and NOT recompile."
"RTN","RGMTUT01",76,0)
 .S DIR("?",3)=" ""NO"" to recompile new data (this may take several hours)."
"RTN","RGMTUT01",77,0)
 .S DIR("?")=" ""^"" to HALT."
"RTN","RGMTUT01",78,0)
 .D ^DIR K DIR
"RTN","RGMTUT01",79,0)
 .I Y="^" S QFLG=1 Q
"RTN","RGMTUT01",80,0)
 .I +Y=1 S PRT=1 Q
"RTN","RGMTUT01",81,0)
 ;
"RTN","RGMTUT01",82,0)
STARTQ ;pick up here for queued job
"RTN","RGMTUT01",83,0)
 D NOW^%DTC
"RTN","RGMTUT01",84,0)
 ;
"RTN","RGMTUT01",85,0)
 ;check to be sure stat report not being run during prime time
"RTN","RGMTUT01",86,0)
 S TODAY=$$DOW^XLFDT($$NOW^XLFDT()) I TODAY="Saturday"!(TODAY="Sunday") S BYPASS=1
"RTN","RGMTUT01",87,0)
 S QUIT=0
"RTN","RGMTUT01",88,0)
 I 'BYPASS D  I QUIT G QUIT
"RTN","RGMTUT01",89,0)
 .S CHKTIME=$E($P(%,".",2),1,4)
"RTN","RGMTUT01",90,0)
 .I CHKTIME>"0700"&(CHKTIME<"1700") S QUIT=1 I '$D(RGHLMQ) D
"RTN","RGMTUT01",91,0)
 ..W !!,"<< STAT report cannot be compiled between 7:00am and 5:00pm! >>"
"RTN","RGMTUT01",92,0)
 ;
"RTN","RGMTUT01",93,0)
 I '$D(RGHLMQ) W !!,"Recompiling data..."
"RTN","RGMTUT01",94,0)
 ;
"RTN","RGMTUT01",95,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_$$NOW^XLFDT_"^MPI/PD Maintenance Data"
"RTN","RGMTUT01",96,0)
 K ^XTMP("RGMT","UT01"),^XTMP("RGMT","REINDDT")  ; **41
"RTN","RGMTUT01",97,0)
 S ^XTMP("RGMT","UT01","@@","COMPILE STARTED")=%
"RTN","RGMTUT01",98,0)
 ;
"RTN","RGMTUT01",99,0)
 D REIND^RGMTUT02
"RTN","RGMTUT01",100,0)
 D CMOR,TF,TFCHK
"RTN","RGMTUT01",101,0)
 ;
"RTN","RGMTUT01",102,0)
 I 'PRT D
"RTN","RGMTUT01",103,0)
 .D NOW^%DTC
"RTN","RGMTUT01",104,0)
 .S ^XTMP("RGMT","UT01","@@","COMPILE STOPPED")=%
"RTN","RGMTUT01",105,0)
 D ^RGMTUT03
"RTN","RGMTUT01",106,0)
 ;
"RTN","RGMTUT01",107,0)
QUIT ;
"RTN","RGMTUT01",108,0)
 K %,BYPASS,CHKTIME,LAST,LOC,PRT,QFLG,QUIT,SITEOPT,TODAY,Y,RGROU,TASK
"RTN","RGMTUT01",109,0)
 Q
"RTN","RGMTUT01",110,0)
 ;
"RTN","RGMTUT01",111,0)
CMOR ; Check "ACMOR" xref for:
"RTN","RGMTUT01",112,0)
 ; - existence of a TF entry for the CMOR in the TF file #391.91
"RTN","RGMTUT01",113,0)
 ; - existence of a TF for the local site (if not the CMOR)
"RTN","RGMTUT01",114,0)
 ; - CMOR totals by site
"RTN","RGMTUT01",115,0)
 ;
"RTN","RGMTUT01",116,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT01",117,0)
 .W !!,"Check #1 for:"
"RTN","RGMTUT01",118,0)
 .W !,"- Patients missing Treating Facility entries for their CMOR."
"RTN","RGMTUT01",119,0)
 .W !,"- Patients missing Treating Facility entries for their local site."
"RTN","RGMTUT01",120,0)
 .W !,"- Unique CMOR totals."
"RTN","RGMTUT01",121,0)
 ;
"RTN","RGMTUT01",122,0)
 K ^XTMP("RGMT","UT01","CMOR")
"RTN","RGMTUT01",123,0)
 K ^XTMP("RGMT","UT01","TOT CMOR MISS TF")
"RTN","RGMTUT01",124,0)
 K ^XTMP("RGMT","UT01","TOT LOC SITE MISS TF")
"RTN","RGMTUT01",125,0)
 K ^XTMP("RGMT","UT01","CMOR WITH NO ICN")
"RTN","RGMTUT01",126,0)
 S (CNT,NOICN,TOTMISSC,TOTMISSL)=0
"RTN","RGMTUT01",127,0)
 S SITESTA=$P($$SITE^VASITE(),"^",3),SITEDA=$P($$SITE^VASITE(),"^")
"RTN","RGMTUT01",128,0)
 ;
"RTN","RGMTUT01",129,0)
 S CMOR=0 F  S CMOR=$O(^DPT("ACMOR",CMOR)) Q:'CMOR  D
"RTN","RGMTUT01",130,0)
 .I '$D(CMOR(CMOR)) S CMOR(CMOR)=0
"RTN","RGMTUT01",131,0)
 .S DFN=0 F  S DFN=$O(^DPT("ACMOR",CMOR,DFN)) Q:'DFN  D
"RTN","RGMTUT01",132,0)
 ..S CNT=CNT+1 I '$D(RGHLMQ) W:'(CNT#10000) "."
"RTN","RGMTUT01",133,0)
 ..S ICN=$P($G(^DPT(DFN,"MPI")),"^")
"RTN","RGMTUT01",134,0)
 ..I $E(ICN,1,3)=SITESTA Q
"RTN","RGMTUT01",135,0)
 ..I ICN="" D  Q
"RTN","RGMTUT01",136,0)
 ...S NOICN=NOICN+1
"RTN","RGMTUT01",137,0)
 ...I '$D(RGHLMQ) W !?3,"DFN #",DFN," has no ICN and a CMOR of ",$P($$NS^XUAF4(CMOR),"^")
"RTN","RGMTUT01",138,0)
 ...S ^XTMP("RGMT","UT01","CMOR WITH NO ICN",DFN)=""
"RTN","RGMTUT01",139,0)
 ...S LOC(991.03)="@" W $$UPDATE^MPIFAPI(DFN,"LOC")
"RTN","RGMTUT01",140,0)
 ..S CMOR(CMOR)=CMOR(CMOR)+1
"RTN","RGMTUT01",141,0)
 ..I '$D(^DGCN(391.91,"APAT",DFN,CMOR)) D
"RTN","RGMTUT01",142,0)
 ...S TOTMISSC=TOTMISSC+1
"RTN","RGMTUT01",143,0)
 ...S SSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","RGMTUT01",144,0)
 ...S NAME=$P($G(^DPT(DFN,0)),"^")
"RTN","RGMTUT01",145,0)
 ...S ^XTMP("RGMT","UT01","CMOR","ZZMISSC",CMOR,DFN)="DFN/"_DFN_"^NAME/"_NAME_"^SSN/"_SSN_"^ICN/"_ICN
"RTN","RGMTUT01",146,0)
 ...D FILE^VAFCTFU(DFN,CMOR,1)
"RTN","RGMTUT01",147,0)
 ..I SITEDA'=CMOR,'$D(^DGCN(391.91,"APAT",DFN,SITEDA)) D
"RTN","RGMTUT01",148,0)
 ...S TOTMISSL=TOTMISSL+1
"RTN","RGMTUT01",149,0)
 ...S SSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","RGMTUT01",150,0)
 ...S NAME=$P($G(^DPT(DFN,0)),"^")
"RTN","RGMTUT01",151,0)
 ...S ^XTMP("RGMT","UT01","CMOR","ZZMISSL",CMOR,DFN)="DFN/"_DFN_"^NAME/"_NAME_"^SSN/"_SSN_"^ICN/"_ICN
"RTN","RGMTUT01",152,0)
 ...D FILE^VAFCTFU(DFN,SITEDA,1)
"RTN","RGMTUT01",153,0)
 ;
"RTN","RGMTUT01",154,0)
 S CMOR=0 F  S CMOR=$O(CMOR(CMOR)) Q:'CMOR  D
"RTN","RGMTUT01",155,0)
 .S CMORNM=$P($$NS^XUAF4(CMOR),"^"),CMORSTA=$P($$NS^XUAF4(CMOR),"^",2) Q:CMORSTA=""
"RTN","RGMTUT01",156,0)
 .S ^XTMP("RGMT","UT01","CMOR",CMORNM,CMORSTA)=CMOR(CMOR)
"RTN","RGMTUT01",157,0)
 S ^XTMP("RGMT","UT01","TOT CMOR MISS TF")=TOTMISSC
"RTN","RGMTUT01",158,0)
 S ^XTMP("RGMT","UT01","TOT LOC SITE MISS TF")=TOTMISSL
"RTN","RGMTUT01",159,0)
 S ^XTMP("RGMT","UT01","CMOR WITH NO ICN")=NOICN
"RTN","RGMTUT01",160,0)
 I '$D(RGHLMQ) W !,"Check #1 - Complete"
"RTN","RGMTUT01",161,0)
 K CMOR,CMORNM,CMORSTA,CNT,DFN,ICN,NAME,NOICN,SITEDA,SITESTA,SSN,TOTMISSC,TOTMISSL
"RTN","RGMTUT01",162,0)
 Q
"RTN","RGMTUT01",163,0)
 ;
"RTN","RGMTUT01",164,0)
TF ; Get totals for unique sites in the TF file (#391.91)
"RTN","RGMTUT01",165,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT01",166,0)
 .W !!,"Check #2 for:"
"RTN","RGMTUT01",167,0)
 .W !,"- Unique Treating Facility totals."
"RTN","RGMTUT01",168,0)
 K ^XTMP("RGMT","UT01","TF"),TFCNT S CNT=0
"RTN","RGMTUT01",169,0)
 S SITE=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTUT01",170,0)
 S TF=0 F  S TF=$O(^DGCN(391.91,"AINST",TF)) Q:'TF  D
"RTN","RGMTUT01",171,0)
 .S CNT=CNT+1 I '$D(RGHLMQ) W:'(CNT#10000) "."
"RTN","RGMTUT01",172,0)
 .I '$D(TFCNT(TF)) S TFCNT(TF)=0
"RTN","RGMTUT01",173,0)
 .S TFIEN=0 F  S TFIEN=$O(^DGCN(391.91,"AINST",TF,TFIEN)) Q:'TFIEN  S TFCNT(TF)=TFCNT(TF)+1
"RTN","RGMTUT01",174,0)
 S TF=0 F  S TF=$O(TFCNT(TF)) Q:'TF  D
"RTN","RGMTUT01",175,0)
 .S TFNM=$P($$NS^XUAF4(TF),"^"),TFSTA=$P($$NS^XUAF4(TF),"^",2) Q:TFSTA=""
"RTN","RGMTUT01",176,0)
 .S ^XTMP("RGMT","UT01","TF",TFNM,TFSTA)=TFCNT(TF)
"RTN","RGMTUT01",177,0)
 I '$D(RGHLMQ) W !,"Check #2 - Complete"
"RTN","RGMTUT01",178,0)
 K CNT,SITE,TF,TFCNT,TFIEN,TFNM,TFSTA
"RTN","RGMTUT01",179,0)
 Q
"RTN","RGMTUT01",180,0)
 ;
"RTN","RGMTUT01",181,0)
TFCHK ; Get totals for duplicates in TF file (#391.91)
"RTN","RGMTUT01",182,0)
 ;NOICN=# of patients found with remote TFs and no ICN
"RTN","RGMTUT01",183,0)
 ;LOCICN=# of patients found with remote TFs and a local ICN
"RTN","RGMTUT01",184,0)
 ;
"RTN","RGMTUT01",185,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT01",186,0)
 .W !!,"Check #3 for:"
"RTN","RGMTUT01",187,0)
 .W !,"- Duplicate Treating Facility assignments."
"RTN","RGMTUT01",188,0)
 .W !,"- Patients with Treating Facilities and no ICN."
"RTN","RGMTUT01",189,0)
 .W !,"- Patients remote treating Facilities and Local ICN."
"RTN","RGMTUT01",190,0)
 ;
"RTN","RGMTUT01",191,0)
 K ^XTMP("RGMT","UT01","TOT TFDUP"),^XTMP("RGMT","UT01","TOT NO ICN W/TF"),^XTMP("RGMT","UT01","TOT LOC ICN W/REMOTE TF")
"RTN","RGMTUT01",192,0)
 S (PTCNT,DUPCNT,NOICN,LOCICN)=0
"RTN","RGMTUT01",193,0)
 S SITESTA=$P($$SITE^VASITE(),"^",3),SITEDA=$P($$SITE^VASITE(),"^")
"RTN","RGMTUT01",194,0)
 S DFN=0 F  S DFN=$O(^DGCN(391.91,"APAT",DFN)) Q:'DFN  D
"RTN","RGMTUT01",195,0)
 .S PTCNT=PTCNT+1 I '$D(RGHLMQ) W:'(PTCNT#10000) "."
"RTN","RGMTUT01",196,0)
 .S TF=0 F  S TF=$O(^DGCN(391.91,"APAT",DFN,TF)) Q:'TF  D
"RTN","RGMTUT01",197,0)
 ..S MPI0=$G(^DPT(DFN,"MPI")),ICN=$P(MPI0,"^")
"RTN","RGMTUT01",198,0)
 ..;delete all TFs for patients with no ICN
"RTN","RGMTUT01",199,0)
 ..I ICN="" D  Q
"RTN","RGMTUT01",200,0)
 ...S NOICN=NOICN+1
"RTN","RGMTUT01",201,0)
 ...S TFIEN=0 F  S TFIEN=$O(^DGCN(391.91,"APAT",DFN,TF,TFIEN)) Q:'TFIEN  D
"RTN","RGMTUT01",202,0)
 ....S ^XTMP("RGMT","UT01","NO ICN WITH REMOTE OR LOCAL TF",DFN,TFIEN)=""
"RTN","RGMTUT01",203,0)
 ....D DELETE^VAFCTFU(TFIEN)
"RTN","RGMTUT01",204,0)
 ..;delete all remote TFs for patients with local ICNs
"RTN","RGMTUT01",205,0)
 ..I $E(ICN,1,3)=SITESTA,TF'=SITEDA D  Q
"RTN","RGMTUT01",206,0)
 ...S TFIEN=0 F  S TFIEN=$O(^DGCN(391.91,"APAT",DFN,TF,TFIEN)) Q:'TFIEN  D
"RTN","RGMTUT01",207,0)
 ....S LOCICN=LOCICN+1
"RTN","RGMTUT01",208,0)
 ....S ^XTMP("RGMT","UT01","LOCAL ICN WITH REMOTE TF",DFN,TFIEN)=""
"RTN","RGMTUT01",209,0)
 ....D DELETE^VAFCTFU(TFIEN)
"RTN","RGMTUT01",210,0)
 ..;look for TF dups
"RTN","RGMTUT01",211,0)
 ..S (TFCNT,TFIEN)=0 F  S TFIEN=$O(^DGCN(391.91,"APAT",DFN,TF,TFIEN)) Q:'TFIEN  D
"RTN","RGMTUT01",212,0)
 ...S TFCNT=TFCNT+1 I TFCNT>1 D
"RTN","RGMTUT01",213,0)
 ....S DUPCNT=DUPCNT+1
"RTN","RGMTUT01",214,0)
 ....S SSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","RGMTUT01",215,0)
 ....S NM=$P($G(^(0)),"^")
"RTN","RGMTUT01",216,0)
 ....S ^XTMP("RGMT","UT01","TFDUP",DFN,TFIEN)=TF_"^"_NM_"^"_SSN
"RTN","RGMTUT01",217,0)
 ....D DELETE^VAFCTFU(TFIEN)
"RTN","RGMTUT01",218,0)
 ;
"RTN","RGMTUT01",219,0)
 S ^XTMP("RGMT","UT01","TOT TFDUP")=DUPCNT
"RTN","RGMTUT01",220,0)
 S ^XTMP("RGMT","UT01","TOT NO ICN W/TF")=NOICN
"RTN","RGMTUT01",221,0)
 S ^XTMP("RGMT","UT01","TOT LOC ICN W/REMOTE TF")=LOCICN
"RTN","RGMTUT01",222,0)
 I '$D(RGHLMQ) W !,"Check #3 - Complete"
"RTN","RGMTUT01",223,0)
 K DFN,DUPCNT,ICN,LOCICN,MPI0,NM,NOICN,PTCNT,SITEDA,SITESTA,SSN,TF,TFCNT,TFIEN
"RTN","RGMTUT01",224,0)
 Q
"RTN","RGMTUT02")
0^4^B13689876
"RTN","RGMTUT02",1,0)
RGMTUT02 ;BIR/CML-MPI/PD Compile and Correct Data Validation Data for Local Sites (CON'T) ;07/30/02
"RTN","RGMTUT02",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20,37,41**;30 Apr 99
"RTN","RGMTUT02",3,0)
 ;
"RTN","RGMTUT02",4,0)
 ;Reference to ^DPT("AICN" & ^DPT("AICNL" supported by IA #2070
"RTN","RGMTUT02",5,0)
 ;Reference to $$SETLOC MPIF001 supported by IA #2705
"RTN","RGMTUT02",6,0)
 ;Reference to EDIT^VAFCPTED supported by IA #2784
"RTN","RGMTUT02",7,0)
 ;
"RTN","RGMTUT02",8,0)
 Q
"RTN","RGMTUT02",9,0)
 ;
"RTN","RGMTUT02",10,0)
REIND ;Correct any existing xref problems:
"RTN","RGMTUT02",11,0)
 ;patch RG*1.0*41 only removed code - specifically the check to see if the REIND has already run that day
"RTN","RGMTUT02",12,0)
 ; - missing SSN xref (only if they have a local or national ICN)
"RTN","RGMTUT02",13,0)
 ; - missing AICN xref
"RTN","RGMTUT02",14,0)
 ; - missing AICNL xref and field Locally assigned ICN
"RTN","RGMTUT02",15,0)
 ;Also get counts of national ICNs, Local ICNs and NO ICNs
"RTN","RGMTUT02",16,0)
 ;
"RTN","RGMTUT02",17,0)
 ;NOSSN = number of patients missing an SSN xref (only if they have a local or national ICN)
"RTN","RGMTUT02",18,0)
 ;NOAICN = number of patients missing an AICN xref
"RTN","RGMTUT02",19,0)
 ;NOAICNL = number of patients missing an AICNL xref
"RTN","RGMTUT02",20,0)
 ;NICNCNT = number of patients with a national ICN
"RTN","RGMTUT02",21,0)
 ;LICNCNT = number of patients with a local ICN
"RTN","RGMTUT02",22,0)
 ;NOICNCNT = number of patients no ICN
"RTN","RGMTUT02",23,0)
 ;
"RTN","RGMTUT02",24,0)
 K ^XTMP("RGMT","UT01","REIND")
"RTN","RGMTUT02",25,0)
 S (NOSSN,NOAICN,NOAICNL,NICNCNT,LICNCNT,NOICNCNT,DFNCNT)=0
"RTN","RGMTUT02",26,0)
 F TYPE="MISSING SSN XREF","MISSING AICN XREF","MISSING AICNL XREF","NATIONAL ICN COUNT","LOCAL ICN COUNT","NO ICN COUNT" D
"RTN","RGMTUT02",27,0)
 .S ^XTMP("RGMT","UT01","REIND",TYPE)=0
"RTN","RGMTUT02",28,0)
 ;
"RTN","RGMTUT02",29,0)
 S SITE=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTUT02",30,0)
 ;
"RTN","RGMTUT02",31,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT02",32,0)
 .W !!,"Checking for:"
"RTN","RGMTUT02",33,0)
 .W !,"Missing ""SSN"" xrefs in ^DPT"
"RTN","RGMTUT02",34,0)
 .W !,"Missing ""AICN"" xrefs in ^DPT"
"RTN","RGMTUT02",35,0)
 .W !,"Missing ""AICNL"" xrefs in ^DPT"
"RTN","RGMTUT02",36,0)
 .W !,"Counts on total National ICNs"
"RTN","RGMTUT02",37,0)
 .W !,"Counts on total Local ICNs"
"RTN","RGMTUT02",38,0)
 .W !,"Counts on total patients without ICNs"
"RTN","RGMTUT02",39,0)
 ;
"RTN","RGMTUT02",40,0)
 S DFN=0 F  S DFN=$O(^DPT(DFN)) Q:'DFN  S DFNCNT=DFNCNT+1 S MNODE=$G(^DPT(DFN,"MPI")) D
"RTN","RGMTUT02",41,0)
 .I '$D(RGHLMQ),'(DFNCNT#10000) W !,DFN
"RTN","RGMTUT02",42,0)
 .I MNODE="" S NOICNCNT=NOICNCNT+1 Q
"RTN","RGMTUT02",43,0)
 .S ICN=$P(MNODE,"^") I ICN="" S NOICNCNT=NOICNCNT+1 Q
"RTN","RGMTUT02",44,0)
 .S SSN=$P($G(^DPT(DFN,0)),"^",9)
"RTN","RGMTUT02",45,0)
 .I $G(SSN),'$D(^DPT("SSN",SSN,DFN)) S NOSSN=NOSSN+1 D
"RTN","RGMTUT02",46,0)
 ..; if SSN xref exists for a different patient, send exception and quit
"RTN","RGMTUT02",47,0)
 ..; otherwise, edit the field to set the xref
"RTN","RGMTUT02",48,0)
 ..I $D(^DPT("SSN",SSN)) D  Q
"RTN","RGMTUT02",49,0)
 ...D EXC^RGHLLOG(210,"SSN xref does not exist for patient DFN #"_DFN_" for SSN "_SSN_". This SSN appears to exist for a different patient.",DFN)
"RTN","RGMTUT02",50,0)
 ..I $L(SSN)>8 K ARR S ARR(2,.09)=SSN D EDIT^VAFCPTED(DFN,"ARR(2)",".09")
"RTN","RGMTUT02",51,0)
 .I '$D(^DPT("AICN",ICN,DFN)) S NOAICN=NOAICN+1,^DPT("AICN",ICN,DFN)=""
"RTN","RGMTUT02",52,0)
 .I $E(ICN,1,3)'=SITE S NICNCNT=NICNCNT+1 Q
"RTN","RGMTUT02",53,0)
 .I $E(ICN,1,3)=SITE D
"RTN","RGMTUT02",54,0)
 ..S LICNCNT=LICNCNT+1
"RTN","RGMTUT02",55,0)
 ..I '$D(^DPT("AICNL",1,DFN)) S LOCAL=$$SETLOC^MPIF001(DFN,1),^DPT("AICNL",1,DFN)="",NOAICNL=NOAICNL+1
"RTN","RGMTUT02",56,0)
 ;
"RTN","RGMTUT02",57,0)
 ;
"RTN","RGMTUT02",58,0)
 S ^XTMP("RGMT","UT01","REIND","MISSING SSN XREF")=NOSSN
"RTN","RGMTUT02",59,0)
 S ^XTMP("RGMT","UT01","REIND","MISSING AICN XREF")=NOAICN
"RTN","RGMTUT02",60,0)
 S ^XTMP("RGMT","UT01","REIND","MISSING AICNL XREF")=NOAICNL
"RTN","RGMTUT02",61,0)
 S ^XTMP("RGMT","UT01","REIND","NATIONAL ICN COUNT")=NICNCNT
"RTN","RGMTUT02",62,0)
 S ^XTMP("RGMT","UT01","REIND","LOCAL ICN COUNT")=LICNCNT
"RTN","RGMTUT02",63,0)
 S ^XTMP("RGMT","UT01","REIND","NO ICN COUNT")=NOICNCNT
"RTN","RGMTUT02",64,0)
 ;
"RTN","RGMTUT02",65,0)
 I '$D(RGHLMQ) D
"RTN","RGMTUT02",66,0)
 .W !!,"Results:"
"RTN","RGMTUT02",67,0)
 .W !?3,"Missing SSN xrefs created  :",?41,$J(NOSSN,7)
"RTN","RGMTUT02",68,0)
 .W !?3,"Missing AICN xrefs created :",?41,$J(NOAICN,7)
"RTN","RGMTUT02",69,0)
 .W !?3,"Missing AICNL xrefs created:",?41,$J(NOAICNL,7)
"RTN","RGMTUT02",70,0)
 .W !?3,"Total DFNs processed   : ",$J(DFNCNT,8)
"RTN","RGMTUT02",71,0)
 .W !?6,"Total National ICNs : ",$J(NICNCNT,8)
"RTN","RGMTUT02",72,0)
 .W !?6,"Total Local ICNs    : ",$J(LICNCNT,8)
"RTN","RGMTUT02",73,0)
 .W !?6,"Total without ICNs  : ",$J(NOICNCNT,8)
"RTN","RGMTUT02",74,0)
 .W !!,"(List global ^XTMP(""RGMT"",""UT01"",""REIND"" for data.)"
"RTN","RGMTUT02",75,0)
 ;
"RTN","RGMTUT02",76,0)
 K ARR,CURDT,DFN,DFNCNT,ICN,LICNCNT,LOCAL,MNODE,NICNCNT,NOAICN,NOAICNL,NOICNCNT,NOSSN,SITE,SSN,TYPE
"RTN","RGMTUT02",77,0)
 Q
"VER")
8.0^22.0
**END**
**END**
