KIDS Distribution saved on Sep 08, 2004@08:10:47
PSJ*5*110
**KIDS**:PSS*1.0*79^PSJ*5.0*110^OR*3.0*213^PSU*3.0*34^

**INSTALL NAME**
PSS*1.0*79
"BLD",4341,0)
PSS*1.0*79^PHARMACY DATA MANAGEMENT^0^3040908^y
"BLD",4341,1,0)
^^72^72^3040729^
"BLD",4341,1,1,0)
 Phase I of the Inpatient Medications Requirements for the Special Focus
"BLD",4341,1,2,0)
 Group IRA project consists of four patches. The patches are combined in
"BLD",4341,1,3,0)
 host file PSJ_PSS_OR_PSU_110.KID in order to simplify installation at VHA
"BLD",4341,1,4,0)
 facilities. Installation of this host file should be coordinated among
"BLD",4341,1,5,0)
 the four packages affected since only one installation is necessary. The
"BLD",4341,1,6,0)
 patches, in order of install, are:
"BLD",4341,1,7,0)
 
"BLD",4341,1,8,0)
      PSS*1*79   PHARMACY DATA MANAGEMENT V. 1.0
"BLD",4341,1,9,0)
      PSJ*5*110  INPATIENT MEDICATIONS V. 5.0
"BLD",4341,1,10,0)
      OR*3*213   ORDER ENTRY/RESULTS REPORTING V. 1.0
"BLD",4341,1,11,0)
      PSU*3*34   PHARMACY BENEFITS MANAGEMENT V. 3.0
"BLD",4341,1,12,0)
 
"BLD",4341,1,13,0)
 Patches PSS*1*79, OR*3*213, and PSU*3*34 contain changes to support the
"BLD",4341,1,14,0)
 following enhancements in PSJ*5*110:
"BLD",4341,1,15,0)
 
"BLD",4341,1,16,0)
 1. The Extend Stop Date on Renewal enhancements will allow an order to be
"BLD",4341,1,17,0)
 renewed without creating a new order. Editing of the start date will no
"BLD",4341,1,18,0)
 longer be allowed during the renewal process. In addition, limits have
"BLD",4341,1,19,0)
 been set on the length of time after an order expires that it may be
"BLD",4341,1,20,0)
 renewed. This is outlined in the BCMA 2001 Special Focus Report,
"BLD",4341,1,21,0)
 Requirement #11.
"BLD",4341,1,22,0)
  
"BLD",4341,1,23,0)
 2. The Complex Order enhancements will change the way complex orders are
"BLD",4341,1,24,0)
 handled by linking complex components (child orders) together. If the
"BLD",4341,1,25,0)
 actions Finish, Verify, Discontinue, or Renew are taken on one child
"BLD",4341,1,26,0)
 order, the user will be alerted that the action must be taken on all of
"BLD",4341,1,27,0)
 the complex component orders in the set. The user will then be prompted
"BLD",4341,1,28,0)
 to take the appropriate action on each child order in the complex order
"BLD",4341,1,29,0)
 set. This is outlined in BCMA 2001 Special Focus Report, Requirement #8.
"BLD",4341,1,30,0)
 
"BLD",4341,1,31,0)
 3. The STAT and NOW Order Notification enhancements will alert users
"BLD",4341,1,32,0)
 subscribing to new mail group PSJ STAT NOW PENDING ORDER when a pending
"BLD",4341,1,33,0)
 STAT or NOW order has been received from Computerized Patient Record
"BLD",4341,1,34,0)
 System (CPRS) V. 1.0. Users subscribing to the new mail group PSJ STAT
"BLD",4341,1,35,0)
 NOW ACTIVE ORDER will receive an alert when a STAT or NOW order is made
"BLD",4341,1,36,0)
 active. This is outlined in BCMA 2001 Special Focus Report, Requirement
"BLD",4341,1,37,0)
 #12.
"BLD",4341,1,38,0)
 
"BLD",4341,1,39,0)
 In order to support the Extend Stop Date for Renewals changes, new fields
"BLD",4341,1,40,0)
 will be created in the PHARMACY PATIENT file (#55) and the PHARMACY
"BLD",4341,1,41,0)
 SYSTEM file (#59.7).
"BLD",4341,1,42,0)
 
"BLD",4341,1,43,0)
 1. The PREVIOUS ORDERS FILE ENTRY sub-field (#4) will be added to the
"BLD",4341,1,44,0)
 LAST RENEW multiple (#114) in the UNIT DOSE multiple (#62) in the
"BLD",4341,1,45,0)
 PHARMACY PATIENT file (#55).
"BLD",4341,1,46,0)
 
"BLD",4341,1,47,0)
 2. The PREVIOUS ORDERS FILE ENTRY sub-field (#4) will be added to the
"BLD",4341,1,48,0)
 LAST RENEW multiple (#138) in the IV multiple (#100) in the PHARMACY
"BLD",4341,1,49,0)
 PATIENT file (#55).
"BLD",4341,1,50,0)
 
"BLD",4341,1,51,0)
 3. The EXPIRED IV TIME LIMIT field (#34) will be added to the PHARMACY
"BLD",4341,1,52,0)
 SYSTEM file (#59.7).
"BLD",4341,1,53,0)
 
"BLD",4341,1,54,0)
 4. In support of Complex Orders changes, a new cross-reference will be
"BLD",4341,1,55,0)
 created to group complex child orders by their parent order. For Unit
"BLD",4341,1,56,0)
 Dose orders, the cross-reference will be indexed by the ORDERS FILE
"BLD",4341,1,57,0)
 PARENT ORDER field (#125), the ORDERS FILE ENTRY field (#66), and the
"BLD",4341,1,58,0)
 Unit Dose order number appended with "U". For IV orders, the cross-
"BLD",4341,1,59,0)
 reference will be indexed by the ORDERS FILE PARENT ORDER field (#150),
"BLD",4341,1,60,0)
 the ORDERS FILE ENTRY field (#110), and the IV order number appended with
"BLD",4341,1,61,0)
 "V". The cross-reference definition will be created by the pre-install
"BLD",4341,1,62,0)
 routine PSSCMPLX. These are the new cross-references added to the
"BLD",4341,1,63,0)
 PHARMACY PATIENT file (#55) and the fields used as the trigger-points.
"BLD",4341,1,64,0)
 The type of these cross-references is "New", not "Traditional".
"BLD",4341,1,65,0)
 
"BLD",4341,1,66,0)
  X-ref  File/Sub-file              Trigger-point field(s)
"BLD",4341,1,67,0)
  -----------------------------------------------------------------
"BLD",4341,1,68,0)
  ACX    PHARMACY PATIENT (#55)     ORDERS FILE PARENT ORDER (#125)
"BLD",4341,1,69,0)
         /UNIT DOSE (#62)           ORDERS FILE ENTRY (#66)
"BLD",4341,1,70,0)
 
"BLD",4341,1,71,0)
  ACX1   PHARMACY PATIENT (#55)     ORDERS FILE PARENT ORDER (#150)
"BLD",4341,1,72,0)
         /IV (#100)                 ORDERS FILE ENTRY (#110)
"BLD",4341,4,0)
^9.64PA^59.7^2
"BLD",4341,4,55,0)
55
"BLD",4341,4,55,2,0)
^9.641^55.01^4
"BLD",4341,4,55,2,55.01,0)
IV  (sub-file)
"BLD",4341,4,55,2,55.01,1,0)
^9.6411^110^2
"BLD",4341,4,55,2,55.01,1,110,0)
ORDERS FILE ENTRY
"BLD",4341,4,55,2,55.01,1,150,0)
ORDERS FILE PARENT ORDER
"BLD",4341,4,55,2,55.06,0)
UNIT DOSE  (sub-file)
"BLD",4341,4,55,2,55.06,1,0)
^9.6411^66^2
"BLD",4341,4,55,2,55.06,1,66,0)
ORDERS FILE ENTRY
"BLD",4341,4,55,2,55.06,1,125,0)
ORDERS FILE PARENT ORDER
"BLD",4341,4,55,2,55.1138,0)
LAST RENEW  (sub-file)
"BLD",4341,4,55,2,55.1138,1,0)
^9.6411^4^1
"BLD",4341,4,55,2,55.1138,1,4,0)
PREVIOUS ORDERS FILE ENTRY
"BLD",4341,4,55,2,55.6114,0)
LAST RENEW  (sub-file)
"BLD",4341,4,55,2,55.6114,1,0)
^9.6411^4^1
"BLD",4341,4,55,2,55.6114,1,4,0)
PREVIOUS ORDERS FILE ENTRY
"BLD",4341,4,55,222)
y^y^p^^^^n^^n
"BLD",4341,4,55,224)

"BLD",4341,4,59.7,0)
59.7
"BLD",4341,4,59.7,2,0)
^9.641^59.7^1
"BLD",4341,4,59.7,2,59.7,0)
PHARMACY SYSTEM  (File-top level)
"BLD",4341,4,59.7,2,59.7,1,0)
^9.6411^34^1
"BLD",4341,4,59.7,2,59.7,1,34,0)
EXPIRED IV TIME LIMIT
"BLD",4341,4,59.7,222)
y^y^p^^^^n^^n
"BLD",4341,4,59.7,224)

"BLD",4341,4,"APDD",55,55.01)

"BLD",4341,4,"APDD",55,55.01,110)

"BLD",4341,4,"APDD",55,55.01,150)

"BLD",4341,4,"APDD",55,55.06)

"BLD",4341,4,"APDD",55,55.06,66)

"BLD",4341,4,"APDD",55,55.06,125)

"BLD",4341,4,"APDD",55,55.1138)

"BLD",4341,4,"APDD",55,55.1138,4)

"BLD",4341,4,"APDD",55,55.6114)

"BLD",4341,4,"APDD",55,55.6114,4)

"BLD",4341,4,"APDD",59.7,59.7)

"BLD",4341,4,"APDD",59.7,59.7,34)

"BLD",4341,4,"B",55,55)

"BLD",4341,4,"B",59.7,59.7)

"BLD",4341,"ABPKG")
n
"BLD",4341,"INI")
EN^PSSCMPLX
"BLD",4341,"INID")
^^y
"BLD",4341,"INIT")

"BLD",4341,"KRN",0)
^9.67PA^8989.52^19
"BLD",4341,"KRN",.4,0)
.4
"BLD",4341,"KRN",.401,0)
.401
"BLD",4341,"KRN",.402,0)
.402
"BLD",4341,"KRN",.403,0)
.403
"BLD",4341,"KRN",.5,0)
.5
"BLD",4341,"KRN",.84,0)
.84
"BLD",4341,"KRN",3.6,0)
3.6
"BLD",4341,"KRN",3.8,0)
3.8
"BLD",4341,"KRN",9.2,0)
9.2
"BLD",4341,"KRN",9.8,0)
9.8
"BLD",4341,"KRN",19,0)
19
"BLD",4341,"KRN",19.1,0)
19.1
"BLD",4341,"KRN",101,0)
101
"BLD",4341,"KRN",409.61,0)
409.61
"BLD",4341,"KRN",771,0)
771
"BLD",4341,"KRN",870,0)
870
"BLD",4341,"KRN",8989.51,0)
8989.51
"BLD",4341,"KRN",8989.52,0)
8989.52
"BLD",4341,"KRN",8994,0)
8994
"BLD",4341,"KRN","B",.4,.4)

"BLD",4341,"KRN","B",.401,.401)

"BLD",4341,"KRN","B",.402,.402)

"BLD",4341,"KRN","B",.403,.403)

"BLD",4341,"KRN","B",.5,.5)

"BLD",4341,"KRN","B",.84,.84)

"BLD",4341,"KRN","B",3.6,3.6)

"BLD",4341,"KRN","B",3.8,3.8)

"BLD",4341,"KRN","B",9.2,9.2)

"BLD",4341,"KRN","B",9.8,9.8)

"BLD",4341,"KRN","B",19,19)

"BLD",4341,"KRN","B",19.1,19.1)

"BLD",4341,"KRN","B",101,101)

"BLD",4341,"KRN","B",409.61,409.61)

"BLD",4341,"KRN","B",771,771)

"BLD",4341,"KRN","B",870,870)

"BLD",4341,"KRN","B",8989.51,8989.51)

"BLD",4341,"KRN","B",8989.52,8989.52)

"BLD",4341,"KRN","B",8994,8994)

"BLD",4341,"QUES",0)
^9.62^^
"BLD",4341,"REQB",0)
^9.611^^
"FIA",55)
PHARMACY PATIENT
"FIA",55,0)
^PS(55,
"FIA",55,0,0)
55P
"FIA",55,0,1)
y^y^p^^^^n^^n
"FIA",55,0,10)

"FIA",55,0,11)

"FIA",55,0,"RLRO")

"FIA",55,0,"VR")
1.0^PSS
"FIA",55,55)
1
"FIA",55,55.01)
1
"FIA",55,55.01,110)

"FIA",55,55.01,150)

"FIA",55,55.06)
1
"FIA",55,55.06,66)

"FIA",55,55.06,125)

"FIA",55,55.1138)
1
"FIA",55,55.1138,4)

"FIA",55,55.6114)
1
"FIA",55,55.6114,4)

"FIA",59.7)
PHARMACY SYSTEM
"FIA",59.7,0)
^PS(59.7,
"FIA",59.7,0,0)
59.7
"FIA",59.7,0,1)
y^y^p^^^^n^^n
"FIA",59.7,0,10)

"FIA",59.7,0,11)

"FIA",59.7,0,"RLRO")

"FIA",59.7,0,"VR")
1.0^PSS
"FIA",59.7,59.7)
1
"FIA",59.7,59.7,34)

"INI")
EN^PSSCMPLX
"IX",55,55,"ACX",0)
55^ACX^Complex Order index.^MU^^R^IR^W^55.06^^^^^S
"IX",55,55,"ACX",.1,0)
^^4^4^3040702
"IX",55,55,"ACX",.1,1,0)
This cross-reference builds an index used for finding
"IX",55,55,"ACX",.1,2,0)
all child orders associated with a particular CPRS
"IX",55,55,"ACX",.1,3,0)
parent order. The indexes are stored as
"IX",55,55,"ACX",.1,4,0)
 ^PS(55,"ACX",PARENT,ON)
"IX",55,55,"ACX",1)
S ^PS(55,"ACX",$E(X(1),1,30),$E(X(2),1,30),DA_"U")=""
"IX",55,55,"ACX",1.4)
S X=1
"IX",55,55,"ACX",2)
K ^PS(55,"ACX",$E(X(1),1,30),$E(X(2),1,30),DA_"U")
"IX",55,55,"ACX",2.4)
S X=1
"IX",55,55,"ACX",2.5)
K ^PS(55,"ACX")
"IX",55,55,"ACX",11.1,0)
^.114IA^2^2
"IX",55,55,"ACX",11.1,1,0)
1^F^55.06^125^^1^F
"IX",55,55,"ACX",11.1,2,0)
2^F^55.06^66^^2^F
"IX",55,55,"ACX1",0)
55^ACX1^Complex Order index.^MU^^R^IR^W^55.01^^^^^S
"IX",55,55,"ACX1",.1,0)
^^4^4^3040702
"IX",55,55,"ACX1",.1,1,0)
This cross-reference builds an index used for finding
"IX",55,55,"ACX1",.1,2,0)
all child orders associated with a particular CPRS
"IX",55,55,"ACX1",.1,3,0)
parent order. The indexes are stored as
"IX",55,55,"ACX1",.1,4,0)
 ^PS(55,"ACX",PARENT,ON)
"IX",55,55,"ACX1",1)
S ^PS(55,"ACX",$E(X(1),1,30),$E(X(2),1,30),DA_"V")=""
"IX",55,55,"ACX1",1.4)
S X=1
"IX",55,55,"ACX1",2)
K ^PS(55,"ACX",$E(X(1),1,30),$E(X(2),1,30),DA_"V")
"IX",55,55,"ACX1",2.4)
S X=1
"IX",55,55,"ACX1",2.5)
K ^PS(55,"ACX")
"IX",55,55,"ACX1",11.1,0)
^.114IA^2^2
"IX",55,55,"ACX1",11.1,1,0)
1^F^55.01^150^^1^F
"IX",55,55,"ACX1",11.1,2,0)
2^F^55.01^110^^2^F
"MBREQ")
0
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
79^3040908^10000000009
"PKG",517,22,1,"PAH",1,1,0)
^^72^72^3040908
"PKG",517,22,1,"PAH",1,1,1,0)
 Phase I of the Inpatient Medications Requirements for the Special Focus
"PKG",517,22,1,"PAH",1,1,2,0)
 Group IRA project consists of four patches. The patches are combined in
"PKG",517,22,1,"PAH",1,1,3,0)
 host file PSJ_PSS_OR_PSU_110.KID in order to simplify installation at VHA
"PKG",517,22,1,"PAH",1,1,4,0)
 facilities. Installation of this host file should be coordinated among
"PKG",517,22,1,"PAH",1,1,5,0)
 the four packages affected since only one installation is necessary. The
"PKG",517,22,1,"PAH",1,1,6,0)
 patches, in order of install, are:
"PKG",517,22,1,"PAH",1,1,7,0)
 
"PKG",517,22,1,"PAH",1,1,8,0)
      PSS*1*79   PHARMACY DATA MANAGEMENT V. 1.0
"PKG",517,22,1,"PAH",1,1,9,0)
      PSJ*5*110  INPATIENT MEDICATIONS V. 5.0
"PKG",517,22,1,"PAH",1,1,10,0)
      OR*3*213   ORDER ENTRY/RESULTS REPORTING V. 1.0
"PKG",517,22,1,"PAH",1,1,11,0)
      PSU*3*34   PHARMACY BENEFITS MANAGEMENT V. 3.0
"PKG",517,22,1,"PAH",1,1,12,0)
 
"PKG",517,22,1,"PAH",1,1,13,0)
 Patches PSS*1*79, OR*3*213, and PSU*3*34 contain changes to support the
"PKG",517,22,1,"PAH",1,1,14,0)
 following enhancements in PSJ*5*110:
"PKG",517,22,1,"PAH",1,1,15,0)
 
"PKG",517,22,1,"PAH",1,1,16,0)
 1. The Extend Stop Date on Renewal enhancements will allow an order to be
"PKG",517,22,1,"PAH",1,1,17,0)
 renewed without creating a new order. Editing of the start date will no
"PKG",517,22,1,"PAH",1,1,18,0)
 longer be allowed during the renewal process. In addition, limits have
"PKG",517,22,1,"PAH",1,1,19,0)
 been set on the length of time after an order expires that it may be
"PKG",517,22,1,"PAH",1,1,20,0)
 renewed. This is outlined in the BCMA 2001 Special Focus Report,
"PKG",517,22,1,"PAH",1,1,21,0)
 Requirement #11.
"PKG",517,22,1,"PAH",1,1,22,0)
  
"PKG",517,22,1,"PAH",1,1,23,0)
 2. The Complex Order enhancements will change the way complex orders are
"PKG",517,22,1,"PAH",1,1,24,0)
 handled by linking complex components (child orders) together. If the
"PKG",517,22,1,"PAH",1,1,25,0)
 actions Finish, Verify, Discontinue, or Renew are taken on one child
"PKG",517,22,1,"PAH",1,1,26,0)
 order, the user will be alerted that the action must be taken on all of
"PKG",517,22,1,"PAH",1,1,27,0)
 the complex component orders in the set. The user will then be prompted
"PKG",517,22,1,"PAH",1,1,28,0)
 to take the appropriate action on each child order in the complex order
"PKG",517,22,1,"PAH",1,1,29,0)
 set. This is outlined in BCMA 2001 Special Focus Report, Requirement #8.
"PKG",517,22,1,"PAH",1,1,30,0)
 
"PKG",517,22,1,"PAH",1,1,31,0)
 3. The STAT and NOW Order Notification enhancements will alert users
"PKG",517,22,1,"PAH",1,1,32,0)
 subscribing to new mail group PSJ STAT NOW PENDING ORDER when a pending
"PKG",517,22,1,"PAH",1,1,33,0)
 STAT or NOW order has been received from Computerized Patient Record
"PKG",517,22,1,"PAH",1,1,34,0)
 System (CPRS) V. 1.0. Users subscribing to the new mail group PSJ STAT
"PKG",517,22,1,"PAH",1,1,35,0)
 NOW ACTIVE ORDER will receive an alert when a STAT or NOW order is made
"PKG",517,22,1,"PAH",1,1,36,0)
 active. This is outlined in BCMA 2001 Special Focus Report, Requirement
"PKG",517,22,1,"PAH",1,1,37,0)
 #12.
"PKG",517,22,1,"PAH",1,1,38,0)
 
"PKG",517,22,1,"PAH",1,1,39,0)
 In order to support the Extend Stop Date for Renewals changes, new fields
"PKG",517,22,1,"PAH",1,1,40,0)
 will be created in the PHARMACY PATIENT file (#55) and the PHARMACY
"PKG",517,22,1,"PAH",1,1,41,0)
 SYSTEM file (#59.7).
"PKG",517,22,1,"PAH",1,1,42,0)
 
"PKG",517,22,1,"PAH",1,1,43,0)
 1. The PREVIOUS ORDERS FILE ENTRY sub-field (#4) will be added to the
"PKG",517,22,1,"PAH",1,1,44,0)
 LAST RENEW multiple (#114) in the UNIT DOSE multiple (#62) in the
"PKG",517,22,1,"PAH",1,1,45,0)
 PHARMACY PATIENT file (#55).
"PKG",517,22,1,"PAH",1,1,46,0)
 
"PKG",517,22,1,"PAH",1,1,47,0)
 2. The PREVIOUS ORDERS FILE ENTRY sub-field (#4) will be added to the
"PKG",517,22,1,"PAH",1,1,48,0)
 LAST RENEW multiple (#138) in the IV multiple (#100) in the PHARMACY
"PKG",517,22,1,"PAH",1,1,49,0)
 PATIENT file (#55).
"PKG",517,22,1,"PAH",1,1,50,0)
 
"PKG",517,22,1,"PAH",1,1,51,0)
 3. The EXPIRED IV TIME LIMIT field (#34) will be added to the PHARMACY
"PKG",517,22,1,"PAH",1,1,52,0)
 SYSTEM file (#59.7).
"PKG",517,22,1,"PAH",1,1,53,0)
 
"PKG",517,22,1,"PAH",1,1,54,0)
 4. In support of Complex Orders changes, a new cross-reference will be
"PKG",517,22,1,"PAH",1,1,55,0)
 created to group complex child orders by their parent order. For Unit
"PKG",517,22,1,"PAH",1,1,56,0)
 Dose orders, the cross-reference will be indexed by the ORDERS FILE
"PKG",517,22,1,"PAH",1,1,57,0)
 PARENT ORDER field (#125), the ORDERS FILE ENTRY field (#66), and the
"PKG",517,22,1,"PAH",1,1,58,0)
 Unit Dose order number appended with "U". For IV orders, the cross-
"PKG",517,22,1,"PAH",1,1,59,0)
 reference will be indexed by the ORDERS FILE PARENT ORDER field (#150),
"PKG",517,22,1,"PAH",1,1,60,0)
 the ORDERS FILE ENTRY field (#110), and the IV order number appended with
"PKG",517,22,1,"PAH",1,1,61,0)
 "V". The cross-reference definition will be created by the pre-install
"PKG",517,22,1,"PAH",1,1,62,0)
 routine PSSCMPLX. These are the new cross-references added to the
"PKG",517,22,1,"PAH",1,1,63,0)
 PHARMACY PATIENT file (#55) and the fields used as the trigger-points.
"PKG",517,22,1,"PAH",1,1,64,0)
 The type of these cross-references is "New", not "Traditional".
"PKG",517,22,1,"PAH",1,1,65,0)
 
"PKG",517,22,1,"PAH",1,1,66,0)
  X-ref  File/Sub-file              Trigger-point field(s)
"PKG",517,22,1,"PAH",1,1,67,0)
  -----------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,68,0)
  ACX    PHARMACY PATIENT (#55)     ORDERS FILE PARENT ORDER (#125)
"PKG",517,22,1,"PAH",1,1,69,0)
         /UNIT DOSE (#62)           ORDERS FILE ENTRY (#66)
"PKG",517,22,1,"PAH",1,1,70,0)
 
"PKG",517,22,1,"PAH",1,1,71,0)
  ACX1   PHARMACY PATIENT (#55)     ORDERS FILE PARENT ORDER (#150)
"PKG",517,22,1,"PAH",1,1,72,0)
         /IV (#100)                 ORDERS FILE ENTRY (#110)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSSCMPLX")
0^^B4915991
"RTN","PSSCMPLX",1,0)
PSSCMPLX ;BIR/LDT-Create cross-references for UD and IV subfiles of Pharmacy Patient file. ;02/12/2004
"RTN","PSSCMPLX",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**79**;9/30/97
"RTN","PSSCMPLX",3,0)
 ;
"RTN","PSSCMPLX",4,0)
 Q
"RTN","PSSCMPLX",5,0)
 ;
"RTN","PSSCMPLX",6,0)
 ;===============================================================
"RTN","PSSCMPLX",7,0)
EN ;Create cross-references for Pharmacy Patient.
"RTN","PSSCMPLX",8,0)
 N IND,MSG,NAME,RESULT,XREF
"RTN","PSSCMPLX",9,0)
 D BMES^XPDUTL("Creating Pharmacy Patient cross-references.")
"RTN","PSSCMPLX",10,0)
 S XREF("FILE")=55
"RTN","PSSCMPLX",11,0)
 S XREF("SET CONDITION")="S X=1"
"RTN","PSSCMPLX",12,0)
 S XREF("KILL CONDITION")="S X=1"
"RTN","PSSCMPLX",13,0)
 S XREF("WHOLE KILL")="K ^PS(55,""ACX"")"
"RTN","PSSCMPLX",14,0)
 S XREF("TYPE")="MU"
"RTN","PSSCMPLX",15,0)
 S XREF("SHORT DESCR")="Complex Order index."
"RTN","PSSCMPLX",16,0)
 S XREF("DESCR",1)="This cross-reference builds an index used for finding"
"RTN","PSSCMPLX",17,0)
 S XREF("DESCR",2)="all child orders associated with a particular CPRS"
"RTN","PSSCMPLX",18,0)
 S XREF("DESCR",3)="parent order. The indexes are stored as"
"RTN","PSSCMPLX",19,0)
 S XREF("DESCR",4)=" ^PS(55,""ACX"",PARENT,ON)"
"RTN","PSSCMPLX",20,0)
 S XREF("USE")="SORTING ONLY"
"RTN","PSSCMPLX",21,0)
 S XREF("EXECUTION")="R"
"RTN","PSSCMPLX",22,0)
 S XREF("ACTIVITY")="IR"
"RTN","PSSCMPLX",23,0)
 ;
"RTN","PSSCMPLX",24,0)
 ;Unit Dose
"RTN","PSSCMPLX",25,0)
 S XREF("ROOT FILE")=55.06
"RTN","PSSCMPLX",26,0)
 S XREF("NAME")="ACX"
"RTN","PSSCMPLX",27,0)
 S XREF("SET CONDITION")="S X=1"
"RTN","PSSCMPLX",28,0)
 S XREF("KILL CONDITION")="S X=1"
"RTN","PSSCMPLX",29,0)
 S XREF("NAME")="ACX"
"RTN","PSSCMPLX",30,0)
 S XREF("SET")="S ^PS(55,""ACX"",$E(X(1),1,30),$E(X(2),1,30),DA_""U"")="""""
"RTN","PSSCMPLX",31,0)
 S XREF("KILL")="K ^PS(55,""ACX"",$E(X(1),1,30),$E(X(2),1,30),DA_""U"")"
"RTN","PSSCMPLX",32,0)
 S XREF("VAL",1)=125
"RTN","PSSCMPLX",33,0)
 S XREF("VAL",1,"SUBSCRIPT")=1
"RTN","PSSCMPLX",34,0)
 S XREF("VAL",2)=66
"RTN","PSSCMPLX",35,0)
 S XREF("VAL",2,"SUBSCRIPT")=2
"RTN","PSSCMPLX",36,0)
 D CREIXN^DDMOD(.XREF,"k",.RESULT,"","MSG")
"RTN","PSSCMPLX",37,0)
 I RESULT="" D ERRMSG
"RTN","PSSCMPLX",38,0)
 ;
"RTN","PSSCMPLX",39,0)
 ;IV node
"RTN","PSSCMPLX",40,0)
 S XREF("ROOT FILE")=55.01
"RTN","PSSCMPLX",41,0)
 S XREF("NAME")="ACX1"
"RTN","PSSCMPLX",42,0)
 S XREF("SET")="S ^PS(55,""ACX"",$E(X(1),1,30),$E(X(2),1,30),DA_""V"")="""""
"RTN","PSSCMPLX",43,0)
 S XREF("KILL")="K ^PS(55,""ACX"",$E(X(1),1,30),$E(X(2),1,30),DA_""V"")"
"RTN","PSSCMPLX",44,0)
 S XREF("VAL",1)=150
"RTN","PSSCMPLX",45,0)
 S XREF("VAL",1,"SUBSCRIPT")=1
"RTN","PSSCMPLX",46,0)
 S XREF("VAL",2)=110
"RTN","PSSCMPLX",47,0)
 S XREF("VAL",2,"SUBSCRIPT")=2
"RTN","PSSCMPLX",48,0)
 D CREIXN^DDMOD(.XREF,"k",.RESULT,"","MSG")
"RTN","PSSCMPLX",49,0)
 I RESULT="" D ERRMSG
"RTN","PSSCMPLX",50,0)
 Q
"RTN","PSSCMPLX",51,0)
 ;
"RTN","PSSCMPLX",52,0)
ERRMSG ;
"RTN","PSSCMPLX",53,0)
 W !,"Cross reference could not be created!"
"RTN","PSSCMPLX",54,0)
 Q
"UP",55,55.01,-1)
55^IV
"UP",55,55.01,0)
55.01
"UP",55,55.06,-1)
55^5
"UP",55,55.06,0)
55.06
"UP",55,55.1138,-2)
55^IV
"UP",55,55.1138,-1)
55.01^14
"UP",55,55.1138,0)
55.1138
"UP",55,55.6114,-2)
55^5
"UP",55,55.6114,-1)
55.06^14
"UP",55,55.6114,0)
55.6114
"VER")
8.0^22.0
"^DD",55,55.01,110,0)
ORDERS FILE ENTRY^F^^0;21^K:$L(X)>30!($L(X)<1) X
"^DD",55,55.01,110,3)
Answer must be 1-30 characters in length.
"^DD",55,55.01,110,20,0)
^.3LA^1^1
"^DD",55,55.01,110,20,1,0)
PSJI
"^DD",55,55.01,110,21,0)
^^1^1^2960129^^
"^DD",55,55.01,110,21,1,0)
  This value matches this IV order to its entry in the Order file.
"^DD",55,55.01,110,"DT")
3030717
"^DD",55,55.01,150,0)
ORDERS FILE PARENT ORDER^F^^.2;8^K:$L(X)>30!($L(X)<1) X
"^DD",55,55.01,150,3)
Enter the parent, if this order is its child.
"^DD",55,55.01,150,21,0)
^.001^2^2^3030530^^^^
"^DD",55,55.01,150,21,1,0)
This is the parent of an order that may have a parent/child relationship 
"^DD",55,55.01,150,21,2,0)
in CPRS.
"^DD",55,55.01,150,"DT")
3030530
"^DD",55,55.06,66,0)
ORDERS FILE ENTRY^F^^0;21^K:$L(X)>30!($L(X)<1) X
"^DD",55,55.06,66,1,0)
^.1
"^DD",55,55.06,66,1,1,0)
55.06^AL80^MUMPS
"^DD",55,55.06,66,1,1,1)
I '$D(DIU(0)) D:$D(PSGAL(80)) KILL^PSGAL5:PSGAL(80)=X K PSGAL
"^DD",55,55.06,66,1,1,2)
I '$D(DIU(0)),'$D(PSGPO) S PSGAL(80)=X,PSGAL("C")=6000,PSGALFF=66 D ^PSGAL5
"^DD",55,55.06,66,1,1,3)
UNIT DOSE ACTIVITY LOG
"^DD",55,55.06,66,1,1,"%D",0)
^1^1^1^2960220^
"^DD",55,55.06,66,1,1,"%D",1,0)
Used by Unit Dose to log any changes made to this field.
"^DD",55,55.06,66,3)
Answer must be 1-30 characters in length.
"^DD",55,55.06,66,20,0)
^.3LA^1^1
"^DD",55,55.06,66,20,1,0)
PSJU
"^DD",55,55.06,66,21,0)
^^2^2^2960129^^^^
"^DD",55,55.06,66,21,1,0)
  This is the pointer value of the corresponding entry in the ORDERS
"^DD",55,55.06,66,21,2,0)
file (100) when the order is entered into OE/RR.
"^DD",55,55.06,66,"DT")
3030717
"^DD",55,55.06,125,0)
ORDERS FILE PARENT ORDER^F^^.2;8^K:$L(X)>30!($L(X)<1) X
"^DD",55,55.06,125,3)
Enter the parent, if this order is its child.
"^DD",55,55.06,125,21,0)
^^2^2^3030530^
"^DD",55,55.06,125,21,1,0)
This is the parent of an order that may have a parent/child relationship 
"^DD",55,55.06,125,21,2,0)
in CPRS.
"^DD",55,55.06,125,"DT")
3030530
"^DD",55,55.1138,4,0)
PREVIOUS ORDERS FILE ENTRY^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",55,55.1138,4,3)
Answer must be 1-30 characters in length.
"^DD",55,55.1138,4,21,0)
^^2^2^3031218^
"^DD",55,55.1138,4,21,1,0)
When an order is being renewed, this is the pointer value of the
"^DD",55,55.1138,4,21,2,0)
corresponding entry in the ORDERS file (100), prior to the renewal.
"^DD",55,55.1138,4,"DT")
3031214
"^DD",55,55.6114,4,0)
PREVIOUS ORDERS FILE ENTRY^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",55,55.6114,4,3)
Answer must be 1-30 characters in length.
"^DD",55,55.6114,4,21,0)
^.001^2^2^3031217^^
"^DD",55,55.6114,4,21,1,0)
When an order is being renewed, this is the pointer value of the
"^DD",55,55.6114,4,21,2,0)
corresponding entry in the ORDERS file (100), prior to the renewal.
"^DD",55,55.6114,4,"DT")
3031214
"^DD",59.7,59.7,34,0)
EXPIRED IV TIME LIMIT^NJ2,0^^31;4^K:+X'=X!(X>24)!(X<0)!(X?.E1"."1.N) X
"^DD",59.7,59.7,34,3)
Type the Number of Hours between 0 and 24 that continuous IV orders may be renewed after expiring
"^DD",59.7,59.7,34,21,0)
^^2^2^3040729^
"^DD",59.7,59.7,34,21,1,0)
The maximum number of hours after a continuous IV order expires that it 
"^DD",59.7,59.7,34,21,2,0)
may still be renewed
"^DD",59.7,59.7,34,"DT")
3040729
**INSTALL NAME**
PSJ*5.0*110
"BLD",4239,0)
PSJ*5.0*110^INPATIENT MEDICATIONS^0^3040908^y
"BLD",4239,1,0)
^^53^53^3040812^
"BLD",4239,1,1,0)
 Phase I of the Inpatient Medications Requirements for the Special Focus
"BLD",4239,1,2,0)
 Group IRA project consists of four patches. The patches are combined in
"BLD",4239,1,3,0)
 host file PSJ_PSS_OR_PSU_110.KID in order to simplify installation at VHA
"BLD",4239,1,4,0)
 facilities. Installation of this host file should be coordinated among
"BLD",4239,1,5,0)
 the four packages affected since only one installation is necessary. The
"BLD",4239,1,6,0)
 patches, in order of install, are:
"BLD",4239,1,7,0)
 
"BLD",4239,1,8,0)
      PSS*1*79   PHARMACY DATA MANAGEMENT V. 1.0
"BLD",4239,1,9,0)
      PSJ*5*110  INPATIENT MEDICATIONS V. 5.0
"BLD",4239,1,10,0)
      OR*3*213   ORDER ENTRY/RESULTS REPORTING V. 1.0
"BLD",4239,1,11,0)
      PSU*3*34   PHARMACY BENEFITS MANAGEMENT V. 3.0
"BLD",4239,1,12,0)
 
"BLD",4239,1,13,0)
 Patches PSS*1*79, OR*3*213, and PSU*3*34 contain changes to support the
"BLD",4239,1,14,0)
 following enhancements in PSJ*5*110:
"BLD",4239,1,15,0)
 
"BLD",4239,1,16,0)
 1. The Extend Stop Date on Renewal enhancements will allow an order to be
"BLD",4239,1,17,0)
 renewed without creating a new order. Editing of the start date will no
"BLD",4239,1,18,0)
 longer be allowed during the renewal process. In addition, limits have
"BLD",4239,1,19,0)
 been set on the length of time after an order expires that it may be
"BLD",4239,1,20,0)
 renewed. This is outlined in the BCMA 2001 Special Focus Report,
"BLD",4239,1,21,0)
 Requirement #11.
"BLD",4239,1,22,0)
  
"BLD",4239,1,23,0)
 2. The Complex Order enhancements will change the way complex orders are
"BLD",4239,1,24,0)
 handled by linking complex components (child orders) together. If the
"BLD",4239,1,25,0)
 actions Finish, Verify, Discontinue, or Renew are taken on one child
"BLD",4239,1,26,0)
 order, the user will be alerted that the action must be taken on all of
"BLD",4239,1,27,0)
 the complex component orders in the set. The user will then be prompted
"BLD",4239,1,28,0)
 to take the appropriate action on each child order in the complex order
"BLD",4239,1,29,0)
 set. This is outlined in BCMA 2001 Special Focus Report, Requirement #8.
"BLD",4239,1,30,0)
 
"BLD",4239,1,31,0)
 3. The STAT and NOW Order Notification enhancements will alert users
"BLD",4239,1,32,0)
 subscribing to new mail group PSJ STAT NOW PENDING ORDER when a pending
"BLD",4239,1,33,0)
 STAT or NOW order has been received from Computerized Patient Record
"BLD",4239,1,34,0)
 System (CPRS) V. 1.0. Users subscribing to the new mail group PSJ STAT
"BLD",4239,1,35,0)
 NOW ACTIVE ORDER will receive an alert when a STAT or NOW order is made
"BLD",4239,1,36,0)
 active. This is outlined in BCMA 2001 Special Focus Report, Requirement
"BLD",4239,1,37,0)
 #12.
"BLD",4239,1,38,0)
 
"BLD",4239,1,39,0)
 PSJ*5*110 contains repairs for the following defects:
"BLD",4239,1,40,0)
 
"BLD",4239,1,41,0)
 1. A site reported a problem with the non-standard schedule messages that
"BLD",4239,1,42,0)
 display in the order view and during finishing. IV orders with Pro Re
"BLD",4239,1,43,0)
 Nata (PRN) schedules displayed the messages but Unit Dose orders with PRN
"BLD",4239,1,44,0)
 schedules did not. This patch corrects the problem by including the base
"BLD",4239,1,45,0)
 PRN schedule in the non-standard check and making Unit Dose and IV orders
"BLD",4239,1,46,0)
 consistent. NOIS: MIN-1203-40699.
"BLD",4239,1,47,0)
 
"BLD",4239,1,48,0)
 2. A scheduled IV order could be created without a schedule interval when
"BLD",4239,1,49,0)
 created using an IV quick code with a schedule and admin times, but no
"BLD",4239,1,50,0)
 infusion rate. In this scenario, if an infusion rate is then entered
"BLD",4239,1,51,0)
 during the finish process, the order is filed with no schedule interval,
"BLD",4239,1,52,0)
 which is necessary to calculate when doses are due.
"BLD",4239,1,53,0)
 NOIS: SFC-0603-61122.
"BLD",4239,4,0)
^9.64PA^53.1^1
"BLD",4239,4,53.1,0)
53.1
"BLD",4239,4,53.1,2,0)
^9.641^53.1^1
"BLD",4239,4,53.1,2,53.1,0)
NON-VERIFIED ORDERS  (File-top level)
"BLD",4239,4,53.1,2,53.1,1,0)
^9.6411^125^1
"BLD",4239,4,53.1,2,53.1,1,125,0)
ORDERS FILE PARENT ORDER
"BLD",4239,4,53.1,222)
y^n^p^^^^n^^n
"BLD",4239,4,53.1,224)

"BLD",4239,4,"APDD",53.1,53.1)

"BLD",4239,4,"APDD",53.1,53.1,125)

"BLD",4239,4,"B",53.1,53.1)

"BLD",4239,"ABPKG")
n
"BLD",4239,"KRN",0)
^9.67PA^8989.52^19
"BLD",4239,"KRN",.4,0)
.4
"BLD",4239,"KRN",.401,0)
.401
"BLD",4239,"KRN",.402,0)
.402
"BLD",4239,"KRN",.403,0)
.403
"BLD",4239,"KRN",.5,0)
.5
"BLD",4239,"KRN",.84,0)
.84
"BLD",4239,"KRN",3.6,0)
3.6
"BLD",4239,"KRN",3.8,0)
3.8
"BLD",4239,"KRN",3.8,"NM",0)
^9.68A^2^2
"BLD",4239,"KRN",3.8,"NM",1,0)
PSJ STAT NOW ACTIVE ORDER^^0
"BLD",4239,"KRN",3.8,"NM",2,0)
PSJ STAT NOW PENDING ORDER^^0
"BLD",4239,"KRN",3.8,"NM","B","PSJ STAT NOW ACTIVE ORDER",1)

"BLD",4239,"KRN",3.8,"NM","B","PSJ STAT NOW PENDING ORDER",2)

"BLD",4239,"KRN",9.2,0)
9.2
"BLD",4239,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",4239,"KRN",9.8,0)
9.8
"BLD",4239,"KRN",9.8,"NM",0)
^9.68A^131^99
"BLD",4239,"KRN",9.8,"NM",18,0)
PSGPR^^0^B30527299
"BLD",4239,"KRN",9.8,"NM",19,0)
PSGVW^^0^B29380284
"BLD",4239,"KRN",9.8,"NM",27,0)
PSJHL4^^0^B57897507
"BLD",4239,"KRN",9.8,"NM",28,0)
PSJHL9^^0^B54587559
"BLD",4239,"KRN",9.8,"NM",29,0)
PSJLIACT^^0^B40633561
"BLD",4239,"KRN",9.8,"NM",30,0)
PSJLIFN^^0^B25627091
"BLD",4239,"KRN",9.8,"NM",31,0)
PSJLIORD^^0^B9589966
"BLD",4239,"KRN",9.8,"NM",32,0)
PSJLMHED^^0^B25663526
"BLD",4239,"KRN",9.8,"NM",33,0)
PSJLMPRI^^0^B17556997
"BLD",4239,"KRN",9.8,"NM",34,0)
PSJO^^0^B21417551
"BLD",4239,"KRN",9.8,"NM",35,0)
PSJO1^^0^B28978821
"BLD",4239,"KRN",9.8,"NM",36,0)
PSJOE^^0^B81121922
"BLD",4239,"KRN",9.8,"NM",37,0)
PSJOE0^^0^B27809362
"BLD",4239,"KRN",9.8,"NM",38,0)
PSJCOM^^0^B38439683
"BLD",4239,"KRN",9.8,"NM",41,0)
PSJCOMV^^0^B40989997
"BLD",4239,"KRN",9.8,"NM",42,0)
PSJOEA^^0^B27155160
"BLD",4239,"KRN",9.8,"NM",43,0)
PSGO^^0^B25169824
"BLD",4239,"KRN",9.8,"NM",44,0)
PSGOE0^^0^B12881111
"BLD",4239,"KRN",9.8,"NM",45,0)
PSGOEC^^0^B49394829
"BLD",4239,"KRN",9.8,"NM",46,0)
PSGOECS^^0^B43208185
"BLD",4239,"KRN",9.8,"NM",47,0)
PSGOEE^^0^B61389262
"BLD",4239,"KRN",9.8,"NM",48,0)
PSGOEF^^0^B48487137
"BLD",4239,"KRN",9.8,"NM",49,0)
PSGOEF1^^0^B29279351
"BLD",4239,"KRN",9.8,"NM",50,0)
PSGOER^^0^B68670827
"BLD",4239,"KRN",9.8,"NM",51,0)
PSGOERS^^0^B37263384
"BLD",4239,"KRN",9.8,"NM",52,0)
PSGOETO^^0^B30209960
"BLD",4239,"KRN",9.8,"NM",53,0)
PSGOEV^^0^B57816038
"BLD",4239,"KRN",9.8,"NM",54,0)
PSGOEVS^^0^B13320504
"BLD",4239,"KRN",9.8,"NM",55,0)
PSGOT^^0^B13094729
"BLD",4239,"KRN",9.8,"NM",56,0)
PSIVCAL^^0^B48439179
"BLD",4239,"KRN",9.8,"NM",57,0)
PSIV^^0^B25417268
"BLD",4239,"KRN",9.8,"NM",58,0)
PSIVACT^^0^B16249645
"BLD",4239,"KRN",9.8,"NM",59,0)
PSIVOPT^^0^B56145512
"BLD",4239,"KRN",9.8,"NM",60,0)
PSIVOPT2^^0^B31072778
"BLD",4239,"KRN",9.8,"NM",61,0)
PSIVORC^^0^B22263402
"BLD",4239,"KRN",9.8,"NM",62,0)
PSIVORC2^^0^B55943730
"BLD",4239,"KRN",9.8,"NM",63,0)
PSIVORFA^^0^B26803761
"BLD",4239,"KRN",9.8,"NM",64,0)
PSIVORFB^^0^B29007552
"BLD",4239,"KRN",9.8,"NM",65,0)
PSIVPRO^^0^B34459076
"BLD",4239,"KRN",9.8,"NM",66,0)
PSIVSPDC^^0^B17130051
"BLD",4239,"KRN",9.8,"NM",67,0)
PSIVUTL^^0^B27927769
"BLD",4239,"KRN",9.8,"NM",68,0)
PSJLMUT1^^0^B64674986
"BLD",4239,"KRN",9.8,"NM",69,0)
PSJOEA1^^0^B62456927
"BLD",4239,"KRN",9.8,"NM",70,0)
PSGOE1^^0^B29807928
"BLD",4239,"KRN",9.8,"NM",71,0)
PSIVORA^^0^B28741555
"BLD",4239,"KRN",9.8,"NM",73,0)
PSGOERI^^0^B16055121
"BLD",4239,"KRN",9.8,"NM",74,0)
PSGVBWU^^0^B44209962
"BLD",4239,"KRN",9.8,"NM",75,0)
PSGVBW0^^0^B34370076
"BLD",4239,"KRN",9.8,"NM",76,0)
PSGVBW^^0^B50020102
"BLD",4239,"KRN",9.8,"NM",77,0)
PSGOER0^^0^B20954490
"BLD",4239,"KRN",9.8,"NM",78,0)
PSGOTR^^0^B5594603
"BLD",4239,"KRN",9.8,"NM",79,0)
PSGOU^^0^B31137117
"BLD",4239,"KRN",9.8,"NM",81,0)
PSJHL7^^0^B44358468
"BLD",4239,"KRN",9.8,"NM",82,0)
PSJHL2^^0^B29657304
"BLD",4239,"KRN",9.8,"NM",83,0)
PSJHL3^^0^B62116348
"BLD",4239,"KRN",9.8,"NM",84,0)
PSJLIVMD^^0^B53732989
"BLD",4239,"KRN",9.8,"NM",85,0)
PSJLMGUD^^0^B29950370
"BLD",4239,"KRN",9.8,"NM",86,0)
PSJLMPRU^^0^B13350416
"BLD",4239,"KRN",9.8,"NM",87,0)
PSJLMUDE^^0^B62045724
"BLD",4239,"KRN",9.8,"NM",88,0)
PSJLIUTL^^0^B50013699
"BLD",4239,"KRN",9.8,"NM",89,0)
PSJORRE^^0^B26669113
"BLD",4239,"KRN",9.8,"NM",90,0)
PSIVOPT1^^0^B39066236
"BLD",4239,"KRN",9.8,"NM",91,0)
PSJLIVFD^^0^B37889960
"BLD",4239,"KRN",9.8,"NM",94,0)
PSIVORFE^^0^B12682889
"BLD",4239,"KRN",9.8,"NM",95,0)
PSIVORA1^^0^B17240582
"BLD",4239,"KRN",9.8,"NM",96,0)
PSGMMAR^^0^B20549668
"BLD",4239,"KRN",9.8,"NM",97,0)
PSGSICHK^^0^B45078669
"BLD",4239,"KRN",9.8,"NM",98,0)
PSIVQUI^^0^B19161013
"BLD",4239,"KRN",9.8,"NM",99,0)
PSJHL10^^0^B74133422
"BLD",4239,"KRN",9.8,"NM",100,0)
PSJORP2^^0^B17806993
"BLD",4239,"KRN",9.8,"NM",101,0)
PSJORPOE^^0^B26719442
"BLD",4239,"KRN",9.8,"NM",102,0)
PSJORRE1^^0^B35153549
"BLD",4239,"KRN",9.8,"NM",103,0)
PSJORREN^^0^B13570794
"BLD",4239,"KRN",9.8,"NM",104,0)
PSGS0^^0^B28896161
"BLD",4239,"KRN",9.8,"NM",105,0)
PSJLIFNI^^0^B10798188
"BLD",4239,"KRN",9.8,"NM",107,0)
PSJCOMR^^0^B75247362
"BLD",4239,"KRN",9.8,"NM",108,0)
PSJCOM1^^0^B47154341
"BLD",4239,"KRN",9.8,"NM",109,0)
PSGFILED^^0^B21619729
"BLD",4239,"KRN",9.8,"NM",111,0)
PSGOE8^^0^B35711863
"BLD",4239,"KRN",9.8,"NM",112,0)
PSGOE81^^0^B21126549
"BLD",4239,"KRN",9.8,"NM",113,0)
PSIVEDT^^0^B37448024
"BLD",4239,"KRN",9.8,"NM",114,0)
PSIVEDT1^^0^B27610242
"BLD",4239,"KRN",9.8,"NM",115,0)
PSIVORE^^0^B40836146
"BLD",4239,"KRN",9.8,"NM",116,0)
PSIVORE1^^0^B21473251
"BLD",4239,"KRN",9.8,"NM",117,0)
PSIVOREN^^0^B23131708
"BLD",4239,"KRN",9.8,"NM",118,0)
PSIVWL^^0^B32751610
"BLD",4239,"KRN",9.8,"NM",119,0)
PSIVOD^^0^B10484412
"BLD",4239,"KRN",9.8,"NM",120,0)
PSGOE9^^0^B32061956
"BLD",4239,"KRN",9.8,"NM",121,0)
PSGOE91^^0^B23734207
"BLD",4239,"KRN",9.8,"NM",122,0)
PSGOE92^^0^B22418933
"BLD",4239,"KRN",9.8,"NM",123,0)
PSJUTL^^0^B40218223
"BLD",4239,"KRN",9.8,"NM",124,0)
PSJUTL2^^0^B8888677
"BLD",4239,"KRN",9.8,"NM",125,0)
PSGPEN^^0^B37095115
"BLD",4239,"KRN",9.8,"NM",126,0)
PSGPL0^^0^B32182582
"BLD",4239,"KRN",9.8,"NM",127,0)
PSIVORC1^^0^B33400994
"BLD",4239,"KRN",9.8,"NM",128,0)
PSGMUTL^^0^B22021289
"BLD",4239,"KRN",9.8,"NM",129,0)
PSGLOI^^0^B33063337
"BLD",4239,"KRN",9.8,"NM",130,0)
PSGMMIVC^^0^B25751401
"BLD",4239,"KRN",9.8,"NM",131,0)
PSIVUDL^^0^B23290210
"BLD",4239,"KRN",9.8,"NM","B","PSGFILED",109)

"BLD",4239,"KRN",9.8,"NM","B","PSGLOI",129)

"BLD",4239,"KRN",9.8,"NM","B","PSGMMAR",96)

"BLD",4239,"KRN",9.8,"NM","B","PSGMMIVC",130)

"BLD",4239,"KRN",9.8,"NM","B","PSGMUTL",128)

"BLD",4239,"KRN",9.8,"NM","B","PSGO",43)

"BLD",4239,"KRN",9.8,"NM","B","PSGOE0",44)

"BLD",4239,"KRN",9.8,"NM","B","PSGOE1",70)

"BLD",4239,"KRN",9.8,"NM","B","PSGOE8",111)

"BLD",4239,"KRN",9.8,"NM","B","PSGOE81",112)

"BLD",4239,"KRN",9.8,"NM","B","PSGOE9",120)

"BLD",4239,"KRN",9.8,"NM","B","PSGOE91",121)

"BLD",4239,"KRN",9.8,"NM","B","PSGOE92",122)

"BLD",4239,"KRN",9.8,"NM","B","PSGOEC",45)

"BLD",4239,"KRN",9.8,"NM","B","PSGOECS",46)

"BLD",4239,"KRN",9.8,"NM","B","PSGOEE",47)

"BLD",4239,"KRN",9.8,"NM","B","PSGOEF",48)

"BLD",4239,"KRN",9.8,"NM","B","PSGOEF1",49)

"BLD",4239,"KRN",9.8,"NM","B","PSGOER",50)

"BLD",4239,"KRN",9.8,"NM","B","PSGOER0",77)

"BLD",4239,"KRN",9.8,"NM","B","PSGOERI",73)

"BLD",4239,"KRN",9.8,"NM","B","PSGOERS",51)

"BLD",4239,"KRN",9.8,"NM","B","PSGOETO",52)

"BLD",4239,"KRN",9.8,"NM","B","PSGOEV",53)

"BLD",4239,"KRN",9.8,"NM","B","PSGOEVS",54)

"BLD",4239,"KRN",9.8,"NM","B","PSGOT",55)

"BLD",4239,"KRN",9.8,"NM","B","PSGOTR",78)

"BLD",4239,"KRN",9.8,"NM","B","PSGOU",79)

"BLD",4239,"KRN",9.8,"NM","B","PSGPEN",125)

"BLD",4239,"KRN",9.8,"NM","B","PSGPL0",126)

"BLD",4239,"KRN",9.8,"NM","B","PSGPR",18)

"BLD",4239,"KRN",9.8,"NM","B","PSGS0",104)

"BLD",4239,"KRN",9.8,"NM","B","PSGSICHK",97)

"BLD",4239,"KRN",9.8,"NM","B","PSGVBW",76)

"BLD",4239,"KRN",9.8,"NM","B","PSGVBW0",75)

"BLD",4239,"KRN",9.8,"NM","B","PSGVBWU",74)

"BLD",4239,"KRN",9.8,"NM","B","PSGVW",19)

"BLD",4239,"KRN",9.8,"NM","B","PSIV",57)

"BLD",4239,"KRN",9.8,"NM","B","PSIVACT",58)

"BLD",4239,"KRN",9.8,"NM","B","PSIVCAL",56)

"BLD",4239,"KRN",9.8,"NM","B","PSIVEDT",113)

"BLD",4239,"KRN",9.8,"NM","B","PSIVEDT1",114)

"BLD",4239,"KRN",9.8,"NM","B","PSIVOD",119)

"BLD",4239,"KRN",9.8,"NM","B","PSIVOPT",59)

"BLD",4239,"KRN",9.8,"NM","B","PSIVOPT1",90)

"BLD",4239,"KRN",9.8,"NM","B","PSIVOPT2",60)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORA",71)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORA1",95)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORC",61)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORC1",127)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORC2",62)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORE",115)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORE1",116)

"BLD",4239,"KRN",9.8,"NM","B","PSIVOREN",117)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORFA",63)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORFB",64)

"BLD",4239,"KRN",9.8,"NM","B","PSIVORFE",94)

"BLD",4239,"KRN",9.8,"NM","B","PSIVPRO",65)

"BLD",4239,"KRN",9.8,"NM","B","PSIVQUI",98)

"BLD",4239,"KRN",9.8,"NM","B","PSIVSPDC",66)

"BLD",4239,"KRN",9.8,"NM","B","PSIVUDL",131)

"BLD",4239,"KRN",9.8,"NM","B","PSIVUTL",67)

"BLD",4239,"KRN",9.8,"NM","B","PSIVWL",118)

"BLD",4239,"KRN",9.8,"NM","B","PSJCOM",38)

"BLD",4239,"KRN",9.8,"NM","B","PSJCOM1",108)

"BLD",4239,"KRN",9.8,"NM","B","PSJCOMR",107)

"BLD",4239,"KRN",9.8,"NM","B","PSJCOMV",41)

"BLD",4239,"KRN",9.8,"NM","B","PSJHL10",99)

"BLD",4239,"KRN",9.8,"NM","B","PSJHL2",82)

"BLD",4239,"KRN",9.8,"NM","B","PSJHL3",83)

"BLD",4239,"KRN",9.8,"NM","B","PSJHL4",27)

"BLD",4239,"KRN",9.8,"NM","B","PSJHL7",81)

"BLD",4239,"KRN",9.8,"NM","B","PSJHL9",28)

"BLD",4239,"KRN",9.8,"NM","B","PSJLIACT",29)

"BLD",4239,"KRN",9.8,"NM","B","PSJLIFN",30)

"BLD",4239,"KRN",9.8,"NM","B","PSJLIFNI",105)

"BLD",4239,"KRN",9.8,"NM","B","PSJLIORD",31)

"BLD",4239,"KRN",9.8,"NM","B","PSJLIUTL",88)

"BLD",4239,"KRN",9.8,"NM","B","PSJLIVFD",91)

"BLD",4239,"KRN",9.8,"NM","B","PSJLIVMD",84)

"BLD",4239,"KRN",9.8,"NM","B","PSJLMGUD",85)

"BLD",4239,"KRN",9.8,"NM","B","PSJLMHED",32)

"BLD",4239,"KRN",9.8,"NM","B","PSJLMPRI",33)

"BLD",4239,"KRN",9.8,"NM","B","PSJLMPRU",86)

"BLD",4239,"KRN",9.8,"NM","B","PSJLMUDE",87)

"BLD",4239,"KRN",9.8,"NM","B","PSJLMUT1",68)

"BLD",4239,"KRN",9.8,"NM","B","PSJO",34)

"BLD",4239,"KRN",9.8,"NM","B","PSJO1",35)

"BLD",4239,"KRN",9.8,"NM","B","PSJOE",36)

"BLD",4239,"KRN",9.8,"NM","B","PSJOE0",37)

"BLD",4239,"KRN",9.8,"NM","B","PSJOEA",42)

"BLD",4239,"KRN",9.8,"NM","B","PSJOEA1",69)

"BLD",4239,"KRN",9.8,"NM","B","PSJORP2",100)

"BLD",4239,"KRN",9.8,"NM","B","PSJORPOE",101)

"BLD",4239,"KRN",9.8,"NM","B","PSJORRE",89)

"BLD",4239,"KRN",9.8,"NM","B","PSJORRE1",102)

"BLD",4239,"KRN",9.8,"NM","B","PSJORREN",103)

"BLD",4239,"KRN",9.8,"NM","B","PSJUTL",123)

"BLD",4239,"KRN",9.8,"NM","B","PSJUTL2",124)

"BLD",4239,"KRN",19,0)
19
"BLD",4239,"KRN",19,"NM",0)
^9.68A^^
"BLD",4239,"KRN",19.1,0)
19.1
"BLD",4239,"KRN",101,0)
101
"BLD",4239,"KRN",409.61,0)
409.61
"BLD",4239,"KRN",771,0)
771
"BLD",4239,"KRN",870,0)
870
"BLD",4239,"KRN",8989.51,0)
8989.51
"BLD",4239,"KRN",8989.52,0)
8989.52
"BLD",4239,"KRN",8994,0)
8994
"BLD",4239,"KRN","B",.4,.4)

"BLD",4239,"KRN","B",.401,.401)

"BLD",4239,"KRN","B",.402,.402)

"BLD",4239,"KRN","B",.403,.403)

"BLD",4239,"KRN","B",.5,.5)

"BLD",4239,"KRN","B",.84,.84)

"BLD",4239,"KRN","B",3.6,3.6)

"BLD",4239,"KRN","B",3.8,3.8)

"BLD",4239,"KRN","B",9.2,9.2)

"BLD",4239,"KRN","B",9.8,9.8)

"BLD",4239,"KRN","B",19,19)

"BLD",4239,"KRN","B",19.1,19.1)

"BLD",4239,"KRN","B",101,101)

"BLD",4239,"KRN","B",409.61,409.61)

"BLD",4239,"KRN","B",771,771)

"BLD",4239,"KRN","B",870,870)

"BLD",4239,"KRN","B",8989.51,8989.51)

"BLD",4239,"KRN","B",8989.52,8989.52)

"BLD",4239,"KRN","B",8994,8994)

"BLD",4239,"QUES",0)
^9.62^^
"BLD",4239,"REQB",0)
^9.611^17^13
"BLD",4239,"REQB",4,0)
PSJ*5.0*41^2
"BLD",4239,"REQB",5,0)
PSJ*5.0*34^2
"BLD",4239,"REQB",6,0)
PSS*1.0*79^2
"BLD",4239,"REQB",7,0)
PSJ*5.0*107^2
"BLD",4239,"REQB",9,0)
PSJ*5.0*117^2
"BLD",4239,"REQB",10,0)
PSJ*5.0*118^2
"BLD",4239,"REQB",11,0)
PSJ*5.0*104^2
"BLD",4239,"REQB",12,0)
PSJ*5.0*123^2
"BLD",4239,"REQB",13,0)
PSJ*5.0*119^2
"BLD",4239,"REQB",14,0)
PSJ*5.0*116^2
"BLD",4239,"REQB",15,0)
OR*3.0*190^2
"BLD",4239,"REQB",16,0)
PSJ*5.0*115^2
"BLD",4239,"REQB",17,0)
PSJ*5.0*109^2
"BLD",4239,"REQB","B","OR*3.0*190",15)

"BLD",4239,"REQB","B","PSJ*5.0*104",11)

"BLD",4239,"REQB","B","PSJ*5.0*107",7)

"BLD",4239,"REQB","B","PSJ*5.0*109",17)

"BLD",4239,"REQB","B","PSJ*5.0*115",16)

"BLD",4239,"REQB","B","PSJ*5.0*116",14)

"BLD",4239,"REQB","B","PSJ*5.0*117",9)

"BLD",4239,"REQB","B","PSJ*5.0*118",10)

"BLD",4239,"REQB","B","PSJ*5.0*119",13)

"BLD",4239,"REQB","B","PSJ*5.0*123",12)

"BLD",4239,"REQB","B","PSJ*5.0*34",5)

"BLD",4239,"REQB","B","PSJ*5.0*41",4)

"BLD",4239,"REQB","B","PSS*1.0*79",6)

"FIA",53.1)
NON-VERIFIED ORDERS
"FIA",53.1,0)
^PS(53.1,
"FIA",53.1,0,0)
53.1I
"FIA",53.1,0,1)
y^n^p^^^^n^^n
"FIA",53.1,0,10)

"FIA",53.1,0,11)

"FIA",53.1,0,"RLRO")

"FIA",53.1,0,"VR")
5.0^PSJ
"FIA",53.1,53.1)
1
"FIA",53.1,53.1,125)

"KRN",3.8,288,-1)
0^2
"KRN",3.8,288,0)
PSJ STAT NOW PENDING ORDER^PU^n^^^^
"KRN",3.8,288,3)

"KRN",3.8,288,5,0)
^3.811P
"KRN",3.8,288,6,0)
^3.812^^0
"KRN",3.8,289,-1)
0^1
"KRN",3.8,289,0)
PSJ STAT NOW ACTIVE ORDER^PU^n^^^^
"KRN",3.8,289,3)

"KRN",3.8,289,6,0)
^3.812^^0
"KRN",3.8,289,8,0)
^3.814P
"KRN",3.8,289,9,0)
^3.815P
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
110^3040908^10000000009
"PKG",197,22,1,"PAH",1,1,0)
^^53^53^3040908
"PKG",197,22,1,"PAH",1,1,1,0)
 Phase I of the Inpatient Medications Requirements for the Special Focus
"PKG",197,22,1,"PAH",1,1,2,0)
 Group IRA project consists of four patches. The patches are combined in
"PKG",197,22,1,"PAH",1,1,3,0)
 host file PSJ_PSS_OR_PSU_110.KID in order to simplify installation at VHA
"PKG",197,22,1,"PAH",1,1,4,0)
 facilities. Installation of this host file should be coordinated among
"PKG",197,22,1,"PAH",1,1,5,0)
 the four packages affected since only one installation is necessary. The
"PKG",197,22,1,"PAH",1,1,6,0)
 patches, in order of install, are:
"PKG",197,22,1,"PAH",1,1,7,0)
 
"PKG",197,22,1,"PAH",1,1,8,0)
      PSS*1*79   PHARMACY DATA MANAGEMENT V. 1.0
"PKG",197,22,1,"PAH",1,1,9,0)
      PSJ*5*110  INPATIENT MEDICATIONS V. 5.0
"PKG",197,22,1,"PAH",1,1,10,0)
      OR*3*213   ORDER ENTRY/RESULTS REPORTING V. 1.0
"PKG",197,22,1,"PAH",1,1,11,0)
      PSU*3*34   PHARMACY BENEFITS MANAGEMENT V. 3.0
"PKG",197,22,1,"PAH",1,1,12,0)
 
"PKG",197,22,1,"PAH",1,1,13,0)
 Patches PSS*1*79, OR*3*213, and PSU*3*34 contain changes to support the
"PKG",197,22,1,"PAH",1,1,14,0)
 following enhancements in PSJ*5*110:
"PKG",197,22,1,"PAH",1,1,15,0)
 
"PKG",197,22,1,"PAH",1,1,16,0)
 1. The Extend Stop Date on Renewal enhancements will allow an order to be
"PKG",197,22,1,"PAH",1,1,17,0)
 renewed without creating a new order. Editing of the start date will no
"PKG",197,22,1,"PAH",1,1,18,0)
 longer be allowed during the renewal process. In addition, limits have
"PKG",197,22,1,"PAH",1,1,19,0)
 been set on the length of time after an order expires that it may be
"PKG",197,22,1,"PAH",1,1,20,0)
 renewed. This is outlined in the BCMA 2001 Special Focus Report,
"PKG",197,22,1,"PAH",1,1,21,0)
 Requirement #11.
"PKG",197,22,1,"PAH",1,1,22,0)
  
"PKG",197,22,1,"PAH",1,1,23,0)
 2. The Complex Order enhancements will change the way complex orders are
"PKG",197,22,1,"PAH",1,1,24,0)
 handled by linking complex components (child orders) together. If the
"PKG",197,22,1,"PAH",1,1,25,0)
 actions Finish, Verify, Discontinue, or Renew are taken on one child
"PKG",197,22,1,"PAH",1,1,26,0)
 order, the user will be alerted that the action must be taken on all of
"PKG",197,22,1,"PAH",1,1,27,0)
 the complex component orders in the set. The user will then be prompted
"PKG",197,22,1,"PAH",1,1,28,0)
 to take the appropriate action on each child order in the complex order
"PKG",197,22,1,"PAH",1,1,29,0)
 set. This is outlined in BCMA 2001 Special Focus Report, Requirement #8.
"PKG",197,22,1,"PAH",1,1,30,0)
 
"PKG",197,22,1,"PAH",1,1,31,0)
 3. The STAT and NOW Order Notification enhancements will alert users
"PKG",197,22,1,"PAH",1,1,32,0)
 subscribing to new mail group PSJ STAT NOW PENDING ORDER when a pending
"PKG",197,22,1,"PAH",1,1,33,0)
 STAT or NOW order has been received from Computerized Patient Record
"PKG",197,22,1,"PAH",1,1,34,0)
 System (CPRS) V. 1.0. Users subscribing to the new mail group PSJ STAT
"PKG",197,22,1,"PAH",1,1,35,0)
 NOW ACTIVE ORDER will receive an alert when a STAT or NOW order is made
"PKG",197,22,1,"PAH",1,1,36,0)
 active. This is outlined in BCMA 2001 Special Focus Report, Requirement
"PKG",197,22,1,"PAH",1,1,37,0)
 #12.
"PKG",197,22,1,"PAH",1,1,38,0)
 
"PKG",197,22,1,"PAH",1,1,39,0)
 PSJ*5*110 contains repairs for the following defects:
"PKG",197,22,1,"PAH",1,1,40,0)
 
"PKG",197,22,1,"PAH",1,1,41,0)
 1. A site reported a problem with the non-standard schedule messages that
"PKG",197,22,1,"PAH",1,1,42,0)
 display in the order view and during finishing. IV orders with Pro Re
"PKG",197,22,1,"PAH",1,1,43,0)
 Nata (PRN) schedules displayed the messages but Unit Dose orders with PRN
"PKG",197,22,1,"PAH",1,1,44,0)
 schedules did not. This patch corrects the problem by including the base
"PKG",197,22,1,"PAH",1,1,45,0)
 PRN schedule in the non-standard check and making Unit Dose and IV orders
"PKG",197,22,1,"PAH",1,1,46,0)
 consistent. NOIS: MIN-1203-40699.
"PKG",197,22,1,"PAH",1,1,47,0)
 
"PKG",197,22,1,"PAH",1,1,48,0)
 2. A scheduled IV order could be created without a schedule interval when
"PKG",197,22,1,"PAH",1,1,49,0)
 created using an IV quick code with a schedule and admin times, but no
"PKG",197,22,1,"PAH",1,1,50,0)
 infusion rate. In this scenario, if an infusion rate is then entered
"PKG",197,22,1,"PAH",1,1,51,0)
 during the finish process, the order is filed with no schedule interval,
"PKG",197,22,1,"PAH",1,1,52,0)
 which is necessary to calculate when doses are due.
"PKG",197,22,1,"PAH",1,1,53,0)
 NOIS: SFC-0603-61122.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
99
"RTN","PSGFILED")
0^109^B21619729
"RTN","PSGFILED",1,0)
PSGFILED ;BIR/CML3-VARIOUS FILES' UPKEEP ;16 Mar 99 / 10:22 AM
"RTN","PSGFILED",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,50,63,119,110**;16 DEC 97
"RTN","PSGFILED",3,0)
 ;
"RTN","PSGFILED",4,0)
 ; Reference to ^PS(50.606 supported by DBIA# 2174.
"RTN","PSGFILED",5,0)
 ; Reference to ^PSDRUG supported by DBIA# 2192.
"RTN","PSGFILED",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA# 2181.
"RTN","PSGFILED",7,0)
 ; Reference to ^PS(51 is supported by DBIA# 2176.
"RTN","PSGFILED",8,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.     
"RTN","PSGFILED",9,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGFILED",10,0)
 ;
"RTN","PSGFILED",11,0)
DONE D ENKV^PSGSETU K D0,D1,D2,PSGRBS Q
"RTN","PSGFILED",12,0)
 ;
"RTN","PSGFILED",13,0)
GED ; generic edit
"RTN","PSGFILED",14,0)
 S DA=+Y,DR=".01;1" W ! D ^DIE Q
"RTN","PSGFILED",15,0)
 ;
"RTN","PSGFILED",16,0)
ENAT ; team file
"RTN","PSGFILED",17,0)
 F  S DIC="^PS(57.7,",DIC(0)="QEAMIL",DLAYGO=57.7,DIC("A")="Select WARD: " W ! D ^DIC K DIC,DLAYGO Q:Y'>0  S DA=+Y,DIE="^PS(57.7,",DR="[PSJUMATE]" D ^DIE
"RTN","PSGFILED",18,0)
 G DONE
"RTN","PSGFILED",19,0)
 ;
"RTN","PSGFILED",20,0)
ENAS ; schedules file - no longer used
"RTN","PSGFILED",21,0)
 ;
"RTN","PSGFILED",22,0)
ENMR ; med route file
"RTN","PSGFILED",23,0)
 NEW MRNO,MR K DIE,DIC,DR,Y
"RTN","PSGFILED",24,0)
 F  S DIC="^PS(51.2,",DIC(0)="QEAMIL",DLAYGO=51.2 W ! D ^DIC K DIC,DLAYGO Q:+Y'>0  S MRNO=+Y,MR=$P(Y,U,2),DA=+Y,DIE="^PS(51.2,",DR=".01;1;3;4" D ^DIE D DF
"RTN","PSGFILED",25,0)
 G DONE
"RTN","PSGFILED",26,0)
 ;
"RTN","PSGFILED",27,0)
ENWG ; ward group file
"RTN","PSGFILED",28,0)
 F  S DIC="^PS(57.5,",DIC(0)="QEAMIL",DLAYGO=57.5 W ! D ^DIC K DA,DIC,DR Q:+Y'>0  S DA=+Y,DIE="^PS(57.5,",DR="[PSJU WG]" D ^DIE
"RTN","PSGFILED",29,0)
 G DONE
"RTN","PSGFILED",30,0)
 ;
"RTN","PSGFILED",31,0)
ENMI ; medication instruction file
"RTN","PSGFILED",32,0)
 F  S DIC="^PS(51,",DIC(0)="QEAMIL",DLAYGO=51 W ! D ^DIC K DIC Q:+Y'>0  S DIE="^PS(51,",DA=+Y,DR=".01;1;30" D ^DIE
"RTN","PSGFILED",33,0)
 G DONE
"RTN","PSGFILED",34,0)
 ;
"RTN","PSGFILED",35,0)
ENDRG ; standard drug fields
"RTN","PSGFILED",36,0)
 D NOW^%DTC S PSGDT=% F  S DIC="^PSDRUG(",DIC(0)="AEIMOQ",DIC("A")="Select DISPENSE DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D DE
"RTN","PSGFILED",37,0)
 K PSIUA,PSIUDA,PSIUX G DONE
"RTN","PSGFILED",38,0)
 ;
"RTN","PSGFILED",39,0)
DE ;
"RTN","PSGFILED",40,0)
 I $D(^PSDRUG(+Y,"I")),^("I"),^("I")<PSGDT W $C(7),$C(7),!!?3,"*** WARNING, THIS DRUG IS INACTIVE. ***",!
"RTN","PSGFILED",41,0)
 W ! S DIE="^PSDRUG(",(DA,PSIUDA)=+Y,DR="[PSJ FILED]"
"RTN","PSGFILED",42,0)
 S PSIUX="U^UNIT DOSE PHARMACY^1" D ^PSGIU,^DIE:PSIUA'["^" K DA,DIE,DR Q
"RTN","PSGFILED",43,0)
 ;
"RTN","PSGFILED",44,0)
ENOSE ; order set enter/edit
"RTN","PSGFILED",45,0)
 K DIC F  S DLAYGO=53.2,DIC="^PS(53.2,",DIC(0)="QEAML",DIC("A")="Select ORDER SET: " W ! D ^DIC K DIC Q:Y'>0  S DA=+Y S DIE="^PS(53.2,",DR="[PSJUOSE]" D ^DIE K D0,D1,DA,DIE,DR,PSGNEDFD,PSGS0XT,PSGS0Y
"RTN","PSGFILED",46,0)
 G DONE
"RTN","PSGFILED",47,0)
 ;
"RTN","PSGFILED",48,0)
RBCHK ; used to validate room-bed
"RTN","PSGFILED",49,0)
 ;No longer used.
"RTN","PSGFILED",50,0)
 ;F Z0=0:0 S Z0=$O(^PS(57.7,DA(2),1,Z0)) Q:'Z0  I Z0'=DA(1),$D(^(Z0,1,"B",X)) W !?19,X," is already under ",$S('$D(^PS(57.7,DA(2),1,Z0,0)):"another team ("_Z0_")!",$P(^(0),"^")]"":$P(^(0),"^")_"!",1:"another team ("_Z0_")!") Q
"RTN","PSGFILED",51,0)
 ;I 'Z0,$D(^DIC(42,DA(2),2,+$O(^DIC(42,DA(2),2,"B",$P(X,"-"),0)),1,"B",$P(X,"-",2))) K Z0 Q
"RTN","PSGFILED",52,0)
 ;K X,Z0 Q
"RTN","PSGFILED",53,0)
 ;
"RTN","PSGFILED",54,0)
RBQ ; show room-beds for a ward
"RTN","PSGFILED",55,0)
 Q
"RTN","PSGFILED",56,0)
 ;
"RTN","PSGFILED",57,0)
RBNP W """^"" TO STOP: " R Z3:DTIME W:'$T $C(7) S:'$T Z3="^" W $C(13),"            ",$C(13) Q
"RTN","PSGFILED",58,0)
 ;
"RTN","PSGFILED",59,0)
ENPPD ; edit pharmacy patient data
"RTN","PSGFILED",60,0)
 ; W !!?3,"...This option is still under development...",! Q
"RTN","PSGFILED",61,0)
 ;
"RTN","PSGFILED",62,0)
ENCPDD ; edit patient's default stop date (wall)
"RTN","PSGFILED",63,0)
 D ENCV^PSGSETU I $D(XQUIT) Q
"RTN","PSGFILED",64,0)
 F  D ENAO^PSGGAO Q:PSGP'>0  D
"RTN","PSGFILED",65,0)
 .S WDN=$P($G(^DPT(PSGP,.1)),"^") W:WDN="" !!?2,"The patient is not currently on a ward."
"RTN","PSGFILED",66,0)
 .I WDN]"" S WD=$O(^DIC(42,"B",WDN,0)),WD=$O(^PS(59.6,"B",+WD,0)) I $S('WD:1,1:'$P($G(^PS(59.6,WD,0)),"^",4)) S X="PLEASE NOTE: The 'SAME STOP DATE' parameter for the ward ("_WDN_") is not turned on.  Any date entered here will be ignored "
"RTN","PSGFILED",67,0)
 .I  S X=X_"until the parameter is turned on for this ward." W $C(7),!!?2 F Y=1:1:$L(X," ") S X(1)=$P(X," ",Y) W:$L(X(1))+$X>78 ! W X(1)," "
"RTN","PSGFILED",68,0)
 .S DA=PSGP,DR="62.01T",DIE="^PS(55," W !! D ^DIE
"RTN","PSGFILED",69,0)
 K WD,WDN G DONE
"RTN","PSGFILED",70,0)
 ;
"RTN","PSGFILED",71,0)
ENSYS ; edit system file
"RTN","PSGFILED",72,0)
 ;/S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;20.412ALLOW THE CHANGE OF ORDER TYPES ON ORDERS FROM OERR;32"
"RTN","PSGFILED",73,0)
 S DIE="^PS(59.7,",DA=1,DR="21;26;26.3;26.4;26.2;26.5;26.6;26.7;34"
"RTN","PSGFILED",74,0)
 W ! D ^DIE K DIE,DA,DR Q
"RTN","PSGFILED",75,0)
 ;
"RTN","PSGFILED",76,0)
ENPLSP ; edit pick list site parameters
"RTN","PSGFILED",77,0)
 ;
"RTN","PSGFILED",78,0)
ENCS ; change current site & parameters
"RTN","PSGFILED",79,0)
 I $D(PSJSYSW0)#2 W !!,"Current site: ",$P(PSJSYSW0,"^")
"RTN","PSGFILED",80,0)
 S PSGCSF=1 D ^PSGSET,ENKV^PSGSETU W:$D(XQUIT) !!?5,"(The Inpatient site you are currently working under has not changed.)" K PSGCSF,PSGORSET,XQUIT Q
"RTN","PSGFILED",81,0)
 ;
"RTN","PSGFILED",82,0)
DF ; Add/edit Med route, instruction... to the Dosage form file.
"RTN","PSGFILED",83,0)
 S DIR("A")="Would you like to update the Dosage Form file"
"RTN","PSGFILED",84,0)
 S DIR("?")="If your answer is Yes, you will be able to Add/edit the Med routes, Instructions, Verb, Noun and Preposition that associate with this Dosage form."
"RTN","PSGFILED",85,0)
 S DIR(0)="Y",DIR("B")="Y" D ^DIR Q:Y'=1
"RTN","PSGFILED",86,0)
 NEW Y,DFNO K DIE,DIC,DA,DR
"RTN","PSGFILED",87,0)
 F  S DIC="^PS(50.606,",DIC(0)="QEAMI" D ^DIC Q:+Y'>0  S DFNO=+Y D
"RTN","PSGFILED",88,0)
 . I $G(MR)]"",'$D(^PS(50.606,DFNO,"MR","B",MRNO)) S DIE="^PS(50.606,",DR="1///"_MR,DA=DFNO D ^DIE
"RTN","PSGFILED",89,0)
 . K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",90,0)
 ;. K DIE,DIC,DR,MR S DIE="^PS(50.606,",DR="1;2;3;4;5",DA=DFNO D ^DIE
"RTN","PSGFILED",91,0)
 Q
"RTN","PSGLOI")
0^129^B33063337
"RTN","PSGLOI",1,0)
PSGLOI ;BIR/CML3-ORDER INFO (AND PRINT) FOR LABELS ;30 Apr 98 / 4:41 PM
"RTN","PSGLOI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,44,58,110**;16 DEC 97
"RTN","PSGLOI",3,0)
 ;
"RTN","PSGLOI",4,0)
 ;Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGLOI",5,0)
 ;Reference to ^PSD(58.8 is supported by DBIA 2283.
"RTN","PSGLOI",6,0)
 ;Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSGLOI",7,0)
 ;Reference to ^PS(55 is supported by DBIA 2191. 
"RTN","PSGLOI",8,0)
 ;
"RTN","PSGLOI",9,0)
ENOI ;
"RTN","PSGLOI",10,0)
 S F="^PS("_$S(PSGORD["N":"53.1,",PSGORD["P":"53.1,",1:"55,"_PSGOP_",5,")_+PSGORD_","
"RTN","PSGLOI",11,0)
 ; the quit below corrects an error if the Order has been moved to 55
"RTN","PSGLOI",12,0)
 Q:'$D(@(F_"0)"))
"RTN","PSGLOI",13,0)
 S ND=$G(@(F_"0)")),PSGLPR=$P(ND,"^",2),PSGLMR=$P(ND,"^",3),PSGLST=$P(ND,"^",7),PSGLSTAT=$P(ND,"^",9),PSGLTD=$P(ND,"^",12),PSGLOD=$P(ND,"^",14),PSGLSM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),NG=$P(ND,"^",22)
"RTN","PSGLOI",14,0)
 S ND=$G(@(F_".2)")),PSGLDRG=$P(ND,"^"),PSGLDDA=+ND,PSGLDO=$P(ND,"^",2)
"RTN","PSGLOI",15,0)
 ;
"RTN","PSGLOI",16,0)
SET ;
"RTN","PSGLOI",17,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",18,0)
 K PSGLAT S ND=$G(@(F_"2)")),(PSGLSSD,PSGLSD)=$P(ND,"^",2),(PSGLFFD,PSGLFD)=$P(ND,"^",4),PSGLAT=$P(ND,"^",5),PSGLMN=$P(ND,"^",6),PSGLSCH=$P(ND,"^"),ND=$G(^(7)),PSGLDT=+ND,PSGLR=$P(ND,"^",2)
"RTN","PSGLOI",19,0)
 I PSGLST'="R",PSGLMN="D",PSGLAT="" S PSGLAT=$E($P(PSGLSD,".",2)_"0000",1,4)
"RTN","PSGLOI",20,0)
 I PSGLAT,PSGLSCH["@" S PSGLSCH=$P(PSGLSCH,"@")
"RTN","PSGLOI",21,0)
 S (PSGLAT(0),X)=0 I PSGLFD]"",PSGLFD'>PSGDT S (PSGLAT(0),X)=5,(PSGLAT(1),PSGLAT(2),PSGLAT(4),PSGLAT(5))="****",PSGLAT(3)=$S(PSGLSTAT["D":"DC'D",1:"EX'D")
"RTN","PSGLOI",22,0)
 E  I $S(PSGLSTAT="P":1,PSGLSTAT="U":1,PSGLST="OC":1,PSGLST="P":1,1:PSGLSCH["PRN") S PSGLAT=""
"RTN","PSGLOI",23,0)
 E  I PSGLAT S PSGLAT(0)=$L(PSGLAT,"-"),X=0 D
"RTN","PSGLOI",24,0)
 .F Q=1:1:5 S PSGLAT(Q)=""
"RTN","PSGLOI",25,0)
 .S Q=PSGLAT(0),Y=PSGLAT I Q=1 S PSGLAT(3)=$P(Y,"-") Q
"RTN","PSGLOI",26,0)
 .I Q=2 S PSGLAT(1)=$P(Y,"-"),PSGLAT(5)=$P(Y,"-",2) Q
"RTN","PSGLOI",27,0)
 .I Q=3 S PSGLAT(1)=$P(Y,"-"),PSGLAT(3)=$P(Y,"-",2),PSGLAT(5)=$P(Y,"-",3) Q
"RTN","PSGLOI",28,0)
 .F Q=1:1:PSGLAT(0) S X=X+1,PSGLAT(X)=$P(PSGLAT,"-",Q) I PSGLAT(0)<4 S X=X+1 S:Q<5 PSGLAT(X)=""
"RTN","PSGLOI",29,0)
 I X<5 F Q=X+1:1:5 S:'$G(PSGLAT(Q)) PSGLAT(Q)=""
"RTN","PSGLOI",30,0)
 I $G(DFN),$G(PSGORD) N PSGLREN S PSGLREN=+$$LASTREN^PSJLMPRI(DFN,PSGORD)
"RTN","PSGLOI",31,0)
 S ND=$G(@(F_"4)")),PSGLRN=+ND,PSGLRPH=+$P(ND,"^",3) N PSGLRNDT S PSGLRNDT=$P(ND,"^",2) I PSGLRNDT,$G(PSGLREN) I $G(PSGLREN)>PSGLRNDT S PSGLRN=0
"RTN","PSGLOI",32,0)
 I NG S PSGLSI="*** NOT TO BE GIVEN ***"
"RTN","PSGLOI",33,0)
 E  S PSGLSI=$P($G(@(F_"6)")),"^") S:PSGLSI]"" PSGLSI=$$ENSET^PSGSICHK(PSGLSI)
"RTN","PSGLOI",34,0)
 ;* I PSGLSI="",$P(@(F_"0)"),U,9)="P",$O(@(F_"12,0)")) S X=0 F  S X=$O(@(F_"12,"_X_")")) Q:'X  S Z=$G(^(X,0)),Y=$L(PSGLSI) S:Y+$L(Z)'>179 PSGLSI=PSGLSI_Z_" " I Y+$L(Z)>179 S PSGLSI=PSGLSI_$E(Z,1,177-Y)_"..." Q
"RTN","PSGLOI",35,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",36,0)
 I PSGLSI="",$P(@(F_"0)"),U,9)="P",$O(@(F_"12,0)")) S X=0 F  S X=$O(@(F_"12,"_X_")")) Q:'X  S Z=$G(^(X,0)),Y=$L(PSGLSI) S:Y+$L(Z)'>179 PSGLSI=PSGLSI_Z_" " I Y+$L(Z)>179 S PSGLSI="SEE PROVIDER COMMENTS" Q
"RTN","PSGLOI",37,0)
 S PSGLDT=$$ENDTC^PSGMI(PSGLDT),PSGLOD=$E($$ENDTC^PSGMI(PSGLOD),1,5)
"RTN","PSGLOI",38,0)
 I PSGLSTAT="P"!(PSGLSTAT="U") S PSGLSD="           ",PSGLFD="              ",PSGLST=" "
"RTN","PSGLOI",39,0)
 E  S PSGLSD=$$ENDTC1^PSGMI(PSGLSD),PSGLSD=$E(PSGLSD,1,5)_$E(PSGLSD,9,14),PSGLFD=$$ENDTC1^PSGMI(PSGLFD)
"RTN","PSGLOI",40,0)
 ;I PSGLSTAT="P"!(PSGLSTAT="U") S (PSGLSD,PSGLFD)="     ",PSGLST=" "
"RTN","PSGLOI",41,0)
 ;E  S PSGLSD=$E($$ENDTC^PSGMI(PSGLSD),1,5),PSGLFD=$$ENDTC^PSGMI(PSGLFD)
"RTN","PSGLOI",42,0)
 S:'PSGLRN PSGLRN="_____" I PSGLRN,$D(^VA(200,+PSGLRN,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRN=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSGLOI",43,0)
 S:'PSGLRPH PSGLRPH="_____" I PSGLRPH,$D(^VA(200,+PSGLRPH,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRPH=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSGLOI",44,0)
 I $P($G(^PS(51.2,+PSGLMR,0)),"^")]"" S PSGLMR=$E($S($P(^(0),"^",3)]"":$P(^(0),"^",3),1:$P(^(0),"^")),1,5)
"RTN","PSGLOI",45,0)
 I $P($G(^VA(200,+PSGLPR,0)),"^")]"" S PSGLPR=$P(^(0),"^")
"RTN","PSGLOI",46,0)
 S Q=32-$L(PSGLDO)-$L(PSGLMR) I $L(PSGLSCH)>Q S PSGLSCH=$E(PSGLSCH,1,Q-3)_"..."
"RTN","PSGLOI",47,0)
 NEW DRUGNAME
"RTN","PSGLOI",48,0)
 D DRGDISP^PSJLMUT1(DFN,$S(PSGORD["A":+PSGORD_"U",PSGORD["U":+PSGORD_"U",1:+PSGORD_"P"),40,34,.DRUGNAME,0)
"RTN","PSGLOI",49,0)
 ;* N PSGNOW D NOW^%DTC S PSGNOW=% S (PSGLNF,PSGLWS)=0 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X!(PSGLWS)  S Y=$G(^(X,0)) I $P(Y,U,3)>PSGNOW!'$P(Y,U,3) S PSGLWS=$D(^PSI(58.1,"D",+Y,+PSGLWD))
"RTN","PSGLOI",50,0)
 ; naked references below refer to full reference inside indirection @(F_"2)" for either file 53.1 or 55
"RTN","PSGLOI",51,0)
 N PSGNOW D NOW^%DTC S PSGNOW=% S (PSGLNF,PSGLWS)=0 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X!(PSGLWS)  S Y=$G(^(X,0)) I $P(Y,U,3)>PSGNOW!'$P(Y,U,3) S PSGLWS=$S($D(^PSI(58.1,"D",+Y,+PSGLWD)):1,$D(^PSD(58.8,"D",+Y,+PSGLWD)):1,1:0)
"RTN","PSGLOI",52,0)
 I $D(PSGLSTOP) Q
"RTN","PSGLOI",53,0)
 ;
"RTN","PSGLOI",54,0)
ENP ;
"RTN","PSGLOI",55,0)
 ;W $C(13),?1,PSGLOD," | ",PSGLSD," | ",PSGLFD,?35,"(",PSGLBS5,")",?43,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",56,0)
 I PSGLSD["     ",+$G(@(F_"4)")) S X="P E N D I N G"
"RTN","PSGLOI",57,0)
 E  S X=PSGLSD_" |"_PSGLFD
"RTN","PSGLOI",58,0)
 W $C(13),?1,PSGLOD," |",X,?36,"(",PSGLBS5,")",?42,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",59,0)
 ;W $C(13),?1,PSGLOD," | ",X,?35,"(",PSGLBS5,")",?43,"|",PSGLAT(1),?52,PSGLPN,?88,$J($S(PSGLRB]"":PSGLRB,1:"*NF*"),12)
"RTN","PSGLOI",60,0)
 F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  D
"RTN","PSGLOI",61,0)
 . I X=1 W !?1,DRUGNAME(X),?42,PSGLST,?43,"|",PSGLAT(2),?52,PSGLSSN,?70,PSGLDOB,"  (",PSGLAGE,")",?85,$J($S(PSGLTM]"":PSGLTM,1:"NOT FOUND"),15)
"RTN","PSGLOI",62,0)
 . I X=2 W !?1,DRUGNAME(X),?43,"|",PSGLAT(3),?52,PSGLSEX,?65,"DX: ",PSGLDX
"RTN","PSGLOI",63,0)
 . S L=X+1
"RTN","PSGLOI",64,0)
 . I L=5,PSGLSI]"" W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",65,0)
 . I X>2 W !?1,DRUGNAME(X) D NXTLNE
"RTN","PSGLOI",66,0)
 I L=5,PSGLSI]"" W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",67,0)
 F Y=1:1:$L(PSGLSI," ") S Y1=$P(PSGLSI," ",Y) D
"RTN","PSGLOI",68,0)
 .I $L(Y1)>42 F  Q:$L(Y1)<42  D
"RTN","PSGLOI",69,0)
 ..S LEN=43-$X W $E(Y1,1,LEN) S Y1=$E(Y1,LEN+1,255) D NXTLNE
"RTN","PSGLOI",70,0)
 ..I L#5=0 W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",71,0)
 .I ($X+$L(Y1))>42 D NXTLNE I L#5=0 W "See next label for continuation" D NXTLNE W !,?1
"RTN","PSGLOI",72,0)
 .W Y1," "
"RTN","PSGLOI",73,0)
 D:PSGLSI]"" NXTLNE
"RTN","PSGLOI",74,0)
 I $D(PSGLAT(L+1)) F  Q:'$D(PSGLAT(L+1))  D
"RTN","PSGLOI",75,0)
 .I L#5=0 W ?1,"See next label for continuation" D NXTLNE W ! Q
"RTN","PSGLOI",76,0)
 .D NXTLNE
"RTN","PSGLOI",77,0)
 I L#5>0 F  Q:L#5=0  D NXTLNE
"RTN","PSGLOI",78,0)
 W $E("WS",1,PSGLWS*2) W:PSGLSM ?4,$E("HSM",PSGLSM,3) W ?8,$E("NF",1,PSGLNF*2),?24,"RPH:",PSGLRPH,?33," RN:",PSGLRN D NXTLNE
"RTN","PSGLOI",79,0)
 W !
"RTN","PSGLOI",80,0)
 Q
"RTN","PSGLOI",81,0)
 ;
"RTN","PSGLOI",82,0)
NXTLNE ; Print info to right of drug
"RTN","PSGLOI",83,0)
 W ?43,"|",$G(PSGLAT(L))
"RTN","PSGLOI",84,0)
 I L=4 D
"RTN","PSGLOI",85,0)
 .N Y S Y=PSGLR W ?52 W:PSGLDT PSGLDT,?77,$S(Y="NR":"RENEWAL ",Y["N":"NEW ",1:""),"ORDER "
"RTN","PSGLOI",86,0)
 .W $S(Y="E":"EDITED",Y="DE":"DC'ED (EDIT)",Y["D":"DISCONTINUED",Y="NE":"(EDIT)",PSGLR="H1":"ON HOLD",PSGLR="H0":"OFF OF HOLD",PSGLR="RE":"REINSTATED",1:"")
"RTN","PSGLOI",87,0)
 .I PSGLFFD]"",PSGLFFD'>PSGDT,PSGLR'["D" W " (EXPIRED)"
"RTN","PSGLOI",88,0)
 W:L=5 ?52,$S(PSGLWGN]"":$E(PSGLWGN,1,21),1:"NOT FOUND"),?79,$J($S(PSGLWDN]"":$E(PSGLWDN,1,21),1:"NOT FOUND"),21)
"RTN","PSGLOI",89,0)
 W !,?1 S L=L+1
"RTN","PSGLOI",90,0)
 Q
"RTN","PSGLOI",91,0)
ENKV ;*** Kill var created from this routine
"RTN","PSGLOI",92,0)
 K PSGDT,PSGLAGE,PSGLAT,PSGLBS5,PSGLDDA,PSGLDO,PSGLDOB,PSGLDRG,PSGLDT,PSGLDX,PSGLFD,PSGLFFD,PSGLMN,PSGLMR,PSGLNF,PSGLOD,PSGLPN
"RTN","PSGLOI",93,0)
 K PSGLPR,PSGLR,PSGLRB,PSGLRN,PSGLRPH,PSGLSCH,PSGLSD,PSGLSEX,PSGLSI,PSGLSM,PSGLSSD,PSGLSSN,PSGLST
"RTN","PSGLOI",94,0)
 K PSGLSTAT,PSGLSTOP,PSGLTD,PSGLTM,PSGLWD,PSGLWDN,PSGLWGN,PSGLWS,PSGNOW,PSGOP,PSGORD
"RTN","PSGLOI",95,0)
 Q
"RTN","PSGMMAR")
0^96^B20549668
"RTN","PSGMMAR",1,0)
PSGMMAR ;BIR/CML3-MULTIPLE DAY MARS - MAIN DRIVER ;14 Oct 98 / 4:28 PM
"RTN","PSGMMAR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,20,110**;16 DEC 97
"RTN","PSGMMAR",3,0)
 F  R !!,"HOW MANY DAYS? (7/14) ",PSGMARDF:DTIME S:'$T PSGMARDF="^" Q:"^"[PSGMARDF  Q:PSGMARDF=7!(PSGMARDF=14)  W $C(7),"  7 OR 14 DAY MAR!!"
"RTN","PSGMMAR",4,0)
 G:"^"[PSGMARDF DONE G EN
"RTN","PSGMMAR",5,0)
 ;
"RTN","PSGMMAR",6,0)
EN7 ;
"RTN","PSGMMAR",7,0)
 S PSGMARDF=7 G EN
"RTN","PSGMMAR",8,0)
 ;
"RTN","PSGMMAR",9,0)
EN14 ;
"RTN","PSGMMAR",10,0)
 S PSGMARDF=14
"RTN","PSGMMAR",11,0)
 ;
"RTN","PSGMMAR",12,0)
EN ;
"RTN","PSGMMAR",13,0)
 NEW DRUGNAME,F,MARLB,NAME,UP,PSGOP
"RTN","PSGMMAR",14,0)
 D ENCV^PSGSETU G:$D(XQUIT) DONE K PSGMAROF
"RTN","PSGMMAR",15,0)
 ;
"RTN","PSGMMAR",16,0)
EN1 ;
"RTN","PSGMMAR",17,0)
 D MARFORM^PSGMUTL G:'PSGMARB DONE
"RTN","PSGMMAR",18,0)
 ;
"RTN","PSGMMAR",19,0)
ENOE ;
"RTN","PSGMMAR",20,0)
 D SD^PSGMMARH W ! D ^DIR K DIR,DTOUT,DUOUT,DIRUT,DIROUT G:"^"[$E(Y) DONE S PSGMARS=$F("CPBO",Y)-1
"RTN","PSGMMAR",21,0)
 ;
"RTN","PSGMMAR",22,0)
DATE ;
"RTN","PSGMMAR",23,0)
 S %DT="ETSX",Y=-1 F  W !!,"Enter START DATE/TIME for "_PSGMARDF_" day MAR: " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" DH^PSGMMARH D ^%DT Q:Y>0
"RTN","PSGMMAR",24,0)
 I Y'>0 W $C(7),!!?5,"(No date selected, or MAR run.)" G DONE
"RTN","PSGMMAR",25,0)
 S PSGMARSD=+Y,X1=$P(+Y,"."),X2=PSGMARDF-1 D C^%DTC S PSGMARFD=X
"RTN","PSGMMAR",26,0)
 D NOW^%DTC S PSGDT=%,(PSGMARWG,PSJPWDO)=0,PSGRBPPN="",PSGMARWD=+$G(PSJPWD)
"RTN","PSGMMAR",27,0)
 I '$G(PSGMAROF),'$G(PSGOENOF)!($G(PSGSS)="") S (PSGP,PSGPAT,PSGMARWD)=0,PSGSSH="MAR" D ^PSGSEL G:"^"[PSGSS OUT D @PSGSS G:$G(PSJSTOP) OUT
"RTN","PSGMMAR",28,0)
 I PSGMARB'=1 G:$$MEDTYPE^PSJMDIR(PSGMARWD) OUT S PSGMTYPE=Y
"RTN","PSGMMAR",29,0)
 D DEV I POP!$D(IO("Q")) G DONE
"RTN","PSGMMAR",30,0)
 ;
"RTN","PSGMMAR",31,0)
ENQ ; when queued
"RTN","PSGMMAR",32,0)
 N DRGI,DRGN,DRGT,LN,P,PSIVUP,PSJORIFN,PSGMSORT
"RTN","PSGMMAR",33,0)
 D ^PSGMMAR0 I $D(^TMP($J))>9 D ^PSGMMAR1 K ^TMP($J)
"RTN","PSGMMAR",34,0)
 D ^%ZISC G DONE
"RTN","PSGMMAR",35,0)
 ;
"RTN","PSGMMAR",36,0)
OUT W $C(7),!!?5,"(No patient(s) selected for MAR run.)" K PSGPLF,PSGPLS
"RTN","PSGMMAR",37,0)
DONE ;
"RTN","PSGMMAR",38,0)
 ;* I '$D(PSGOENOF),'$D(PSGVBY) D ENKV^PSGSETU K PSGOP
"RTN","PSGMMAR",39,0)
 I '$D(PSGOENOF),'$D(PSGVBY) D ENKV^PSGSETU
"RTN","PSGMMAR",40,0)
 K:'$D(PSGVBY) PSGSS,PSGSSH
"RTN","PSGMMAR",41,0)
 D ENKV^PSGLOI
"RTN","PSGMMAR",42,0)
 K AD,ASTERS,BD,BLN,CNTR,DA1,DA2,DAO,DIC,DRG,DX,EXPIRE,FD,HX,L,LN1,LN14,LN2,LN3,LN31,LN32,LN4,LN5,LN6,LN7
"RTN","PSGMMAR",43,0)
 K MOS,MSG1,MSG2,N,ND2,NAMENEED,NEED,OPST,PSJJORD,PAGE,PN,PND,PNN,PPN,PRB,PSEX,PSSN,PSGMAPA,PSGMAPB,PSGMAPC,PSGMAPD,PSGADR,PSGALG,PSGS0Y,PSGXDT
"RTN","PSGMMAR",44,0)
 K PSGD,PSGDW,PSGMAR,PSGMARB,PSGMARDF,PSGMARED,PSGMARGD,PSGMARFD,PSGMARFP,PSGMAROC,PSGMAROF,PSGMARPT,PSGMARS,PSGMARSD,PSGMARSM,PSGMARSP
"RTN","PSGMMAR",45,0)
 K PSGMARTS,PSGMARWD,PSGMARWG,PSGMARWN,PSGMARWS,PSGMPG,PSGMPGN,PSGORD,PSGPAT,PSJDIET
"RTN","PSGMMAR",46,0)
 K DFN,NG,NO,ON,PST,PTM,PWDN,QST,PSJACNWP,R,RB,RCT,S,SD,SM,SPACES,TM,T,TD,TS,WD,WDN,WG,WGN,WS,WT,X1,X2,Y1
"RTN","PSGMMAR",47,0)
 K PSJSTOP,PSJPWDO,PSGMARO,PSGMTYPE,PSGTM,PSGTMALL,XTYPE,PSGLRPH,PSGPG
"RTN","PSGMMAR",48,0)
 K HT,PSGOENOF,PSGOES,PSGRBPPN,PSGS0XT,PSGST,PSGTIR,PSGWD,XQUIT,ZTDESC
"RTN","PSGMMAR",49,0)
 Q
"RTN","PSGMMAR",50,0)
 ;
"RTN","PSGMMAR",51,0)
G ;
"RTN","PSGMMAR",52,0)
 S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC K DIC D  I $G(PSJSTOP)=1 Q
"RTN","PSGMMAR",53,0)
 . I X="^OTHER" S PSGMARWG="^OTHER" Q
"RTN","PSGMMAR",54,0)
 . S PSGMARWG=+Y
"RTN","PSGMMAR",55,0)
 . I +Y'>0 S PSJSTOP=1
"RTN","PSGMMAR",56,0)
 D RBPPN^PSJMDIR
"RTN","PSGMMAR",57,0)
 Q
"RTN","PSGMMAR",58,0)
 ;
"RTN","PSGMMAR",59,0)
W ;
"RTN","PSGMMAR",60,0)
 S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC K DIC S PSGMARWD=+Y I +Y<0 S PSJSTOP=1 Q
"RTN","PSGMMAR",61,0)
 S PSGWD=PSGMARWD D ADMTM^PSJMDIR S Y=PSGMARWD
"RTN","PSGMMAR",62,0)
 D:'PSJSTOP RBPPN^PSJMDIR
"RTN","PSGMMAR",63,0)
 Q
"RTN","PSGMMAR",64,0)
 ;
"RTN","PSGMMAR",65,0)
P ;
"RTN","PSGMMAR",66,0)
 K PSGPAT S PSGPAT=0 F CNTR=0:1 S:CNTR PSGDICA="another" D ENP^PSGGAO:'PSGMARB,ENDPT^PSGP:PSGMARB Q:PSGP'>0  D
"RTN","PSGMMAR",67,0)
 . S PSGPAT(PSGP)="",PSGPAT=PSGP
"RTN","PSGMMAR",68,0)
 . ;*** PSGMARWD=1 when all patients are select from the same ward.
"RTN","PSGMMAR",69,0)
 . S:'$G(PSJPWDO) (PSGMARWD,PSJPWDO)=PSJPWD S PSGMARWD=$S('$G(PSGMARWD):0,PSJPWDO=PSJPWD:PSJPWD,1:0)
"RTN","PSGMMAR",70,0)
 S Y=PSGPAT S:Y'>0 PSJSTOP=1 K PSGDICA
"RTN","PSGMMAR",71,0)
 Q
"RTN","PSGMMAR",72,0)
 ;
"RTN","PSGMMAR",73,0)
DEV ;
"RTN","PSGMMAR",74,0)
 K ZTSAVE S PSGTIR="ENQ^PSGMMAR",ZTDESC=PSGMARDF_" DAY MAR" F X="PSGMARWG","PSGMARWD","PSGP","PSGPAT(","PSGDT","PSGMARSD","PSGMARFD","PSGSS","PSGMARB","PSGMARDF","PSGMARS" S ZTSAVE(X)=""
"RTN","PSGMMAR",75,0)
 F X="PSGMTYPE","PSGRBPPN","^TMP($J," S ZTSAVE(X)=""
"RTN","PSGMMAR",76,0)
 I PSGSS="W" F X="PSGTMALL","PSGTM","PSGTM(" S ZTSAVE(X)=""
"RTN","PSGMMAR",77,0)
 D ENDEV^PSGTI W:POP !!?3,"No device selected for "_PSGMARDF_" day MAR run." W:$D(ZTSK) !?3,PSGMARDF_" Day MAR Queued!" K ZTSK Q
"RTN","PSGMMAR",78,0)
 I 'IO("Q") U IO
"RTN","PSGMMAR",79,0)
 ;
"RTN","PSGMMAR",80,0)
ENOR S PSGP=+ORVP
"RTN","PSGMMAR",81,0)
ENLM ;
"RTN","PSGMMAR",82,0)
 NEW VADM
"RTN","PSGMMAR",83,0)
 D ENCV^PSGSETU I $D(QUIT) K PSGMARDF Q
"RTN","PSGMMAR",84,0)
 D ^PSJAC S PSGPAT=1,PSGPAT(PSGP)="",PSGMAROF=1,PSGSS="P" G EN1
"RTN","PSGMMIVC")
0^130^B25751401
"RTN","PSGMMIVC",1,0)
PSGMMIVC ;BIR/MV-PRT MULT DAYS MAR C ORDERS(IV) ;16 Mar 99 / 2:10 PM
"RTN","PSGMMIVC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**20,21,28,31,35,67,58,110**;16 DEC 97
"RTN","PSGMMIVC",3,0)
 ;
"RTN","PSGMMIVC",4,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSGMMIVC",5,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGMMIVC",6,0)
 ;
"RTN","PSGMMIVC",7,0)
PRT ;*** Print IV orders.
"RTN","PSGMMIVC",8,0)
 K P,DRG,PSGLRN,PSGMARTS,PSGMARGD,PSGLFFD,TS N ON55,PSJLABEL S TS=1,PSGMARGD="",PSJLABEL=1
"RTN","PSGMMIVC",9,0)
 S ON=$P(DAO,U,2),DFN=$P(PN,U,2) D:$P(DAO,U,2)["V" GT55^PSIVORFB D:$P(DAO,U,2)["P" GT531^PSIVORFA(DFN,ON)  D:P(9)]"" OS S PSGLSSD=P(2),PSGLFFD=P(3)
"RTN","PSGMMIVC",10,0)
 I $G(P("DTYP"))'=1 K P(11)
"RTN","PSGMMIVC",11,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSGMMIVC",12,0)
 D INITOPI
"RTN","PSGMMIVC",13,0)
 S PSGST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PSGST'="O" S PSGST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSGMMIVC",14,0)
 I PSGST="O",(P(2)="") S PSGST=""
"RTN","PSGMMIVC",15,0)
 NEW NAMENEED,NEED,X S NAMENEED=0
"RTN","PSGMMIVC",16,0)
 D LNNEED^PSGMIV,PRTIV
"RTN","PSGMMIVC",17,0)
 Q
"RTN","PSGMMIVC",18,0)
 ;
"RTN","PSGMMIVC",19,0)
OS ; order record set
"RTN","PSGMMIVC",20,0)
 S FD=P(3),PSGOES="",X=P(9),SD=P(2) D EN^PSGS0 S T=PSGS0XT
"RTN","PSGMMIVC",21,0)
 S QQ="" I PST["C" D DTS^PSGMMAR0(P(9)) S SD=$P(SD,"."),QQ="" F X=0:0 S X=$O(PSGD(X)) Q:'X  S QQ=QQ_$S(X<SD:"",X>FD:"",'S:$P(PSGD(X),U),$D(S(X)):$P(PSGD(X),U),1:"")
"RTN","PSGMMIVC",22,0)
 I T="D",P(11)="" S P(11)=$E($P(P(2),".",2)_"0000",1,4)
"RTN","PSGMMIVC",23,0)
 S PSGMARTS=P(11),PSGMARGD=QQ
"RTN","PSGMMIVC",24,0)
 K TS D TS^PSGMAR3(P(11))
"RTN","PSGMMIVC",25,0)
 Q
"RTN","PSGMMIVC",26,0)
 ;
"RTN","PSGMMIVC",27,0)
PRTIV ;*** Print IV order on MAR
"RTN","PSGMMIVC",28,0)
 I PSGMAROC,(PSGMAROC+LN)>6 D BOT^PSGMMAR2,HEADER^PSGMMAR2
"RTN","PSGMMIVC",29,0)
 S PSGMAROC=PSGMAROC+1 W !?6,"|",?19,"|",?48,"|",$G(TS(1)) D CELL(1,0)
"RTN","PSGMMIVC",30,0)
 W !,$E(P("LOG"),1,5)," |"
"RTN","PSGMMIVC",31,0)
 W:ON["V" $E(P(2),1,5)_$E(P(2),9,14)," |",P(3)
"RTN","PSGMMIVC",32,0)
 W:ON["P" "P E N D I N G"
"RTN","PSGMMIVC",33,0)
 W ?39,"("_$E(PSGP(0))_$E(PSSN,8,12)_")"
"RTN","PSGMMIVC",34,0)
 W ?48,"|",$G(TS(2)) D CELL(2,0) S L=3
"RTN","PSGMMIVC",35,0)
 NEW NAME
"RTN","PSGMMIVC",36,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D NAME^PSIVUTL(DRG("AD",X),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W !,NAME(Y) W:L=3 ?47,PSGST W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D L(1)
"RTN","PSGMMIVC",37,0)
 I '$G(DRG("AD",0)) D
"RTN","PSGMMIVC",38,0)
 .W !
"RTN","PSGMMIVC",39,0)
 .W:L=3 ?47,PSGST W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D L(1)
"RTN","PSGMMIVC",40,0)
 W:$G(DRG("SOL",0)) !,"in "
"RTN","PSGMMIVC",41,0)
 NEW PSJPRT2
"RTN","PSGMMIVC",42,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D NAME^PSIVUTL(DRG("SOL",X),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSGMMIVC",43,0)
 . W:(Y>1!(X>1)) ! W ?4,NAME(Y) W:L=3 ?47,PSGST W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D L(1)
"RTN","PSGMMIVC",44,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" W !?7,PSJPRT2 W:L=3 ?47,PSGST W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D L(1)
"RTN","PSGMMIVC",45,0)
 W !,$P(P("MR"),U,2)," ",P(9)," ",P(8) W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) I L>5 S PSJTMPL=L\6,PSJDIV=PSJTMPL+4 I L>PSJDIV,(L#PSJDIV>1) W ! ;I L>5,(L#5>1) W !
"RTN","PSGMMIVC",46,0)
 I '$G(DRG("SOL",0)) S L=L+1 W !,?48,"|",$G(TS(L)) D CELL(L,'(L#6))
"RTN","PSGMMIVC",47,0)
 ;I P(4)="C",'(L#5),P("OPI")="" D L(1) W !,"*CAUTION-CHEMOTHERAPY*",?48,"|",$G(TS(L)) D CELL(L,'(L#6)) W ! ;S L=L+1 
"RTN","PSGMMIVC",48,0)
 I P(4)="C",'(L#5),P("OPI")="" D
"RTN","PSGMMIVC",49,0)
 . D L(1)
"RTN","PSGMMIVC",50,0)
 . W !,"*CAUTION-CHEMOTHERAPY*",?48,"|",$G(TS(L))
"RTN","PSGMMIVC",51,0)
 . D CELL(L,'(L#6)) W ! ;S L=L+1
"RTN","PSGMMIVC",52,0)
 ;E  I P(4)="C" D L(1) W "*CAUTION-CHEMOTHERAPY*",?48,"|",$G(TS(L)) D CELL(L,'(L#6)) I (L+1)#6'=0 W !
"RTN","PSGMMIVC",53,0)
 E  I P(4)="C" D
"RTN","PSGMMIVC",54,0)
 . D L(1)
"RTN","PSGMMIVC",55,0)
 . W:L#7=0 !
"RTN","PSGMMIVC",56,0)
 . W "*CAUTION-CHEMOTHERAPY*",?48,"|",$G(TS(L))
"RTN","PSGMMIVC",57,0)
 . D CELL(L,'(L#6))
"RTN","PSGMMIVC",58,0)
 . I (L+1)#6'=0 W !
"RTN","PSGMMIVC",59,0)
 I (L#5)=0,($L($P(P("OPI"),"^"))<29),(TS<7) S L=L+1
"RTN","PSGMMIVC",60,0)
 E  D L(1)
"RTN","PSGMMIVC",61,0)
 W:P("OPI")=""&(TS>6) !
"RTN","PSGMMIVC",62,0)
 I P("OPI")'="" D
"RTN","PSGMMIVC",63,0)
 . I L#7=0 W !
"RTN","PSGMMIVC",64,0)
 . I L#5=1 W !
"RTN","PSGMMIVC",65,0)
 . N PSJTMPX S PSJTMPX=0
"RTN","PSGMMIVC",66,0)
 . F Y=1:1:$L($P(P("OPI"),"^")," ") S Y1=$P($P(P("OPI"),"^")," ",Y) D
"RTN","PSGMMIVC",67,0)
 .. I $L(Y1)>47 W $E(Y1,1,47)
"RTN","PSGMMIVC",68,0)
 .. I (PSJTMPX+$L(Y1))>47 W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)),L(1) S PSJTMPX=0 W !
"RTN","PSGMMIVC",69,0)
 .. I $L(Y1)>47 W $E(Y1,48,$L(Y1)) S PSJTMPX=$L($E(Y1,48,$L(Y1)))
"RTN","PSGMMIVC",70,0)
 .. E  W Y1," " S PSJTMPX=PSJTMPX+$L(Y1)+1
"RTN","PSGMMIVC",71,0)
 N PSGIVFL I '$O(DRG("AD",0))!'$O(DRG("SOL",0)) S PSGIVFL=1
"RTN","PSGMMIVC",72,0)
 I L>TS,(L#6) W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) S L=L+1
"RTN","PSGMMIVC",73,0)
 I (TS-1)>L W ?48,"|",$G(TS(L)) D CELL(L,'(L#6)) D
"RTN","PSGMMIVC",74,0)
 . F L=L+1:1:TS-1 D L(0) W !?48,"|",$G(TS(L)) D CELL(L,'(L#6))
"RTN","PSGMMIVC",75,0)
 . S L=L+1
"RTN","PSGMMIVC",76,0)
 F  Q:'(L#6)  W !?48,"|",$G(TS(L)) D CELL(L,'(L#6)) S L=L+1
"RTN","PSGMMIVC",77,0)
 I '(L#6),(P("OPI")="") W !
"RTN","PSGMMIVC",78,0)
 I P("OPI")]"",(L>6) W !
"RTN","PSGMMIVC",79,0)
 W ?29,"RPH: ",PSGLRPH,?38,"RN: ",PSGLRN,?48,"|",$G(TS(L)) D CELL(L,'(L#6)) W:PSGMAROC<6 !?7,LN2
"RTN","PSGMMIVC",80,0)
 Q
"RTN","PSGMMIVC",81,0)
 ;
"RTN","PSGMMIVC",82,0)
L(X) ;***Check to see if a new block if needed.
"RTN","PSGMMIVC",83,0)
 S L=L+X
"RTN","PSGMMIVC",84,0)
 I L#6=0,PSGMAROC<6 D
"RTN","PSGMMIVC",85,0)
 . W !,"See next label for continuation",?48,"|",$G(TS(L)) D CELL(L,'(L#6))
"RTN","PSGMMIVC",86,0)
 . W:PSGMAROC<6 !?7,LN2,$C(13) S $X=0 S PSGMAROC=PSGMAROC+1,L=L+1 D
"RTN","PSGMMIVC",87,0)
 . . I LN>6,(PSGMAROC>5) S MSG1="*** CONTINUE ON NEXT PAGE ***" D BOT^PSGMMAR2,HEADER^PSGMMAR2 S PSGMAROC=1
"RTN","PSGMMIVC",88,0)
 Q
"RTN","PSGMMIVC",89,0)
LN(L) ;*** Print lines within block.
"RTN","PSGMMIVC",90,0)
 N X S X=$S(L#6:LN4,1:LN7)
"RTN","PSGMMIVC",91,0)
 Q X
"RTN","PSGMMIVC",92,0)
CELL(X,X1)         ;
"RTN","PSGMMIVC",93,0)
 I ON["P",(X=6) NEW PSGLFFD,PSGMARGD S P(9)="",PSGLFFD="9999999",PSGMARGD="" W ?55 D ASTERS^PSGMMAR2 Q
"RTN","PSGMMIVC",94,0)
 I TS=1,'$G(P(11)),(X=6) W ?55 D ASTERS^PSGMMAR2 Q
"RTN","PSGMMIVC",95,0)
 I TS=1,'$G(P(11)) W ?55,$$LN(X) Q
"RTN","PSGMMIVC",96,0)
 D CELL^PSGMMAR2(X,X1)
"RTN","PSGMMIVC",97,0)
 Q
"RTN","PSGMMIVC",98,0)
INITOPI ;* Set nurse's initial and the other print info.
"RTN","PSGMMIVC",99,0)
 D RPHINIT^PSGMIV(.PSGLRPH)
"RTN","PSGMMIVC",100,0)
 S PSGLRN="_____"
"RTN","PSGMMIVC",101,0)
 I ON["V" N ND4 S ND4=$G(^PS(55,DFN,"IV",+ON,4))
"RTN","PSGMMIVC",102,0)
 I $G(ND4) D
"RTN","PSGMMIVC",103,0)
 .I $G(DFN),$G(ON) N PSGLREN S PSGLREN=+$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSGMMIVC",104,0)
 ..N PSGLRNDT S PSGLRNDT=$P(ND4,"^",2),ND4=+ND4 I PSGLRNDT,$G(PSGLREN) I $G(PSGLREN)>PSGLRNDT S ND4=0
"RTN","PSGMMIVC",105,0)
 .I ND4 D NAME(+ND4,"",.PSGLRN)
"RTN","PSGMMIVC",106,0)
 I ON["P" D
"RTN","PSGMMIVC",107,0)
 . I P("OPI")="",$O(^PS(53.1,ON,12,0)) S X=0 F  S X=$O(^PS(53.1,ON,12,X)) Q:'X  S Z=$G(^(X,0)),Y=$L(P("OPI")) S:Y+$L(Z)'>179 P("OPI")=P("OPI")_Z_" " I Y+$L(Z)>179 S P("OPI")="SEE PROVIDER COMMENTS"
"RTN","PSGMMIVC",108,0)
 . S PSGST=""
"RTN","PSGMMIVC",109,0)
 . D NAME(+$G(^PS(53.1,+ON,4)),"",.PSGLRN)
"RTN","PSGMMIVC",110,0)
 Q
"RTN","PSGMMIVC",111,0)
NAME(X,NAME,INIT)  ;Lookup in ^VA(200.
"RTN","PSGMMIVC",112,0)
 ;X = IEN in ^VA(200
"RTN","PSGMMIVC",113,0)
 ;NAME = Return the name in 200
"RTN","PSGMMIVC",114,0)
 ;INIT = Return the initial
"RTN","PSGMMIVC",115,0)
 NEW DIC,Y
"RTN","PSGMMIVC",116,0)
 S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSGMMIVC",117,0)
 S NAME=$G(Y(0,0))
"RTN","PSGMMIVC",118,0)
 S INIT=$P($G(Y(0)),U,2)
"RTN","PSGMMIVC",119,0)
 Q
"RTN","PSGMUTL")
0^128^B22021289
"RTN","PSGMUTL",1,0)
PSGMUTL ;BIR/MV-UTLILITY USE FOR THE MAR AND MEDWS. ;15 SEP 97 / 2:10 PM 
"RTN","PSGMUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,104,110**;16 DEC 97
"RTN","PSGMUTL",3,0)
 ;
"RTN","PSGMUTL",4,0)
MARFORM ;Prompt for the MAR form (Blank and Non-blank)
"RTN","PSGMUTL",5,0)
 S DIR(0)="SA^1:Print Blank MARs only;2:Print Non-Blank MARs only;3:Print both Blank and Non-Blank MARs"
"RTN","PSGMUTL",6,0)
 S DIR("A")="Select the MAR forms: ",DIR("B")="3"
"RTN","PSGMUTL",7,0)
 S DIR("?")=""
"RTN","PSGMUTL",8,0)
 S DIR("?",1)="Enter 1 to print BLANK (no data) MARs for the patient(s) you select."
"RTN","PSGMUTL",9,0)
 S DIR("?",2)="Enter 2 to print MARs complete with orders."
"RTN","PSGMUTL",10,0)
 S DIR("?",3)="Enter 3 to print both the blank MARs and the MARs complete with orders."
"RTN","PSGMUTL",11,0)
 S DIR("?",4)="Enter an  '^' to exit this option now."
"RTN","PSGMUTL",12,0)
 D ^DIR S PSGMARB=$S($D(DIRUT):0,1:Y)
"RTN","PSGMUTL",13,0)
 Q
"RTN","PSGMUTL",14,0)
BLANK(LEN) ;
"RTN","PSGMUTL",15,0)
 NEW X
"RTN","PSGMUTL",16,0)
 S $P(X," ",LEN)=" "
"RTN","PSGMUTL",17,0)
 Q $G(X)
"RTN","PSGMUTL",18,0)
 ;
"RTN","PSGMUTL",19,0)
TXT(TXT,LEN)   ;
"RTN","PSGMUTL",20,0)
 ;* Input: TXT = TXT string
"RTN","PSGMUTL",21,0)
 ;*        LEN = format length
"RTN","PSGMUTL",22,0)
 ;* Output: MARX array.
"RTN","PSGMUTL",23,0)
 ;*
"RTN","PSGMUTL",24,0)
 NEW OLD,X1,Y D SPLIT K MARX
"RTN","PSGMUTL",25,0)
 ;N OLD D SPLIT K MARX
"RTN","PSGMUTL",26,0)
 S X=0,X1=1,Y="" F  S X=$O(OLD(X)) Q:'X  D
"RTN","PSGMUTL",27,0)
 . I $L(Y_OLD(X))>LEN S MARX(X1)=Y,X1=X1+1,Y="" D
"RTN","PSGMUTL",28,0)
 .. I $E(MARX(X1-1),$L(MARX(X1-1)))'=" " Q
"RTN","PSGMUTL",29,0)
 .. S MARX(X1-1)=$E(MARX(X1-1),1,$L(MARX(X1-1))-1)
"RTN","PSGMUTL",30,0)
 . S Y=Y_OLD(X)
"RTN","PSGMUTL",31,0)
 S:Y]"" MARX(X1)=Y
"RTN","PSGMUTL",32,0)
 S MARX=X1
"RTN","PSGMUTL",33,0)
 Q
"RTN","PSGMUTL",34,0)
 ;
"RTN","PSGMUTL",35,0)
SPLIT ;* Split a word string into individual words.
"RTN","PSGMUTL",36,0)
 ;* Output: OLD(X)
"RTN","PSGMUTL",37,0)
 ;*
"RTN","PSGMUTL",38,0)
 NEW BSD,NEW,X,X1,Y
"RTN","PSGMUTL",39,0)
 S OLD(1)=TXT Q:$L(TXT)<LEN
"RTN","PSGMUTL",40,0)
 F BSD=" ","/","-" S:'$O(OLD(0)) OLD(1)=TXT D:TXT[BSD DELIM(BSD)
"RTN","PSGMUTL",41,0)
 I '$O(OLD(1)),($L(TXT)>LEN) D LEN(1,TXT) K OLD D
"RTN","PSGMUTL",42,0)
 . F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","PSGMUTL",43,0)
 Q
"RTN","PSGMUTL",44,0)
LEN(X1,OLD) ;* Wrap word around if it doesn't fit the display lenght.
"RTN","PSGMUTL",45,0)
 NEW X
"RTN","PSGMUTL",46,0)
 Q:$L(OLD)'>LEN
"RTN","PSGMUTL",47,0)
 S X=$E(OLD,1,($L(OLD)-1)) I X["/"!((X["-")&(X'["ON-CALL")) Q
"RTN","PSGMUTL",48,0)
 I $L(OLD)>LEN F X=1:1 S NEW(X1)=$E(OLD,((LEN*X)-LEN+1),(LEN*X)),X1=X1+1 Q:($L(OLD)'>(LEN*X))
"RTN","PSGMUTL",49,0)
 Q
"RTN","PSGMUTL",50,0)
DELIM(BSD) ;* BSD=" ","/","-"
"RTN","PSGMUTL",51,0)
 K NEW
"RTN","PSGMUTL",52,0)
 S X=0,X1=0 F  S X=$O(OLD(X)) Q:'X  K ONCALL F Y=1:1:$L(OLD(X),BSD) D
"RTN","PSGMUTL",53,0)
 . Q:($G(ONCALL)=Y)   ; If ON-CALL is delimited string, ignore
"RTN","PSGMUTL",54,0)
 . S X1=X1+1
"RTN","PSGMUTL",55,0)
 . S NEW(X1)=$P(OLD(X),BSD,Y)
"RTN","PSGMUTL",56,0)
 . I $L(OLD(X),BSD)>1,(Y<$L(OLD(X),BSD)) S NEW(X1)=NEW(X1)_BSD
"RTN","PSGMUTL",57,0)
 . I BSD="-",OLD(X)["ON-CALL" D   ;If dashes, check for ON-CALL
"RTN","PSGMUTL",58,0)
 .. S NEW(X1)=OLD(X),ONCALL=Y+1   ;Keep ON-CALL intact
"RTN","PSGMUTL",59,0)
 . D LEN(.X1,NEW(X1))
"RTN","PSGMUTL",60,0)
 K OLD F X=0:0 S X=$O(NEW(X)) Q:'X  S OLD(X)=NEW(X)
"RTN","PSGMUTL",61,0)
 Q
"RTN","PSGMUTL",62,0)
 ;
"RTN","PSGMUTL",63,0)
MARLB(LEN)         ;
"RTN","PSGMUTL",64,0)
 ;;;LEN=LENGHT
"RTN","PSGMUTL",65,0)
 NEW L,X,TXT K MARLB,DRUGNAME
"RTN","PSGMUTL",66,0)
 S L=1
"RTN","PSGMUTL",67,0)
 S MARLB(L)=$$BLANK(6)_"|"_$$BLANK(12)_"|",L=L+1
"RTN","PSGMUTL",68,0)
 I $G(PST)["CZ"!($G(PST)["OZ") S MARLB(L)=PSGLOD_" | P E N D I N G"
"RTN","PSGMUTL",69,0)
 E  S MARLB(L)=PSGLOD_" |"_PSGLSD_" |"_PSGLFD
"RTN","PSGMUTL",70,0)
 S MARLB(L)=$$SETSTR^VALM1("("_$E(PPN)_$E(PSSN,8,12)_")",MARLB(L),40,7)
"RTN","PSGMUTL",71,0)
 S L=L+1
"RTN","PSGMUTL",72,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSGORD_$S(PSGORD["P":"P",1:"U"),45,39,.DRUGNAME,0)
"RTN","PSGMUTL",73,0)
 F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  S MARLB(L)=DRUGNAME(X)_$S(X=1:$$BLANK(47-$L(DRUGNAME(X)))_PSGLST,1:""),L=L+1
"RTN","PSGMUTL",74,0)
 D TXT^PSGMUTL(PSGLSI,LEN)
"RTN","PSGMUTL",75,0)
 S X=0 F  S X=$O(MARX(X)) Q:'X  S MARLB(L)=MARX(X),L=L+1
"RTN","PSGMUTL",76,0)
 K MARX
"RTN","PSGMUTL",77,0)
 I $G(PSGP),$G(PSGORD),(PSGLRN]""),(PSGLRN'="O") D
"RTN","PSGMUTL",78,0)
 .N ND4 S ND4=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,4)),PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:"")
"RTN","PSGMUTL",79,0)
 .N PSGLREN,PSGLRNDT S PSGLREN=+$$LASTREN^PSJLMPRI(PSGP,PSGORD),PSGLRNDT=$P(ND4,"^",2) I PSGLREN,PSGLRNDT I PSGLREN>PSGLRNDT S PSGLRN=""
"RTN","PSGMUTL",80,0)
 S X=$E("WS",1,PSGLWS*2)_$S(PSGLSM:$E("HSM",PSGLSM,3),1:"")_$E("NF",1,PSGLNF*2)
"RTN","PSGMUTL",81,0)
 I X="",($L(MARLB(L-1))<30),(L=7) S L=L-1 D
"RTN","PSGMUTL",82,0)
 . S X=MARLB(L)_$$BLANK(29-$L(MARLB(L)))_"RPH: "_$S(PSGLRPH]""&(PSGLRPH'="0"):PSGLRPH,1:"_____")
"RTN","PSGMUTL",83,0)
 . S X=X_$$BLANK(39-$L(X))_"RN: "_$S(PSGLRN]""&(PSGLRN'="0"):PSGLRN,1:"_____")
"RTN","PSGMUTL",84,0)
 . S MARLB(L)=X
"RTN","PSGMUTL",85,0)
 E  D
"RTN","PSGMUTL",86,0)
 . S:L=5 MARLB(5)="",L=6
"RTN","PSGMUTL",87,0)
 . S X=$E("WS",1,PSGLWS*2)
"RTN","PSGMUTL",88,0)
 . S X=X_$$BLANK(4-$L(X))_$S(PSGLSM:$E("HSM",PSGLSM,3),1:"")
"RTN","PSGMUTL",89,0)
 . S X=X_$$BLANK(8-$L(X))_$E("NF",1,PSGLNF*2)
"RTN","PSGMUTL",90,0)
 . S X=X_$$BLANK(29-$L(X))_"RPH: "_$S(PSGLRPH]""&(PSGLRPH'="0"):PSGLRPH,1:"____")
"RTN","PSGMUTL",91,0)
 . S X=X_$$BLANK(39-$L(X))_"RN: "_$S(PSGLRN]""&(PSGLRN'="0"):PSGLRN,1:"_____")
"RTN","PSGMUTL",92,0)
 . S MARLB(L)=X
"RTN","PSGMUTL",93,0)
 S MARLB=L
"RTN","PSGMUTL",94,0)
 I MARLB>6!($G(TS)>6) D MARLB2
"RTN","PSGMUTL",95,0)
 Q
"RTN","PSGMUTL",96,0)
 ;
"RTN","PSGMUTL",97,0)
MARLB2 ;Slit array into 2 labels.
"RTN","PSGMUTL",98,0)
 ;TS array must be defined. (TS^PSGMAR3(ADMIN TIMES))
"RTN","PSGMUTL",99,0)
 NEW INIT,X,Y
"RTN","PSGMUTL",100,0)
 S INIT=MARLB(MARLB),Y=6
"RTN","PSGMUTL",101,0)
 F X=6:1:MARLB S X(X)=MARLB(X)
"RTN","PSGMUTL",102,0)
 F X=6:1:($S(MARLB>TS:MARLB,1:TS)-1) D
"RTN","PSGMUTL",103,0)
 . I (X#6)=0 S MARLB(X)="See next label for continuation" Q
"RTN","PSGMUTL",104,0)
 . I Y<(MARLB) S MARLB(X)=X(Y),Y=Y+1 Q
"RTN","PSGMUTL",105,0)
 . S MARLB(X)=""
"RTN","PSGMUTL",106,0)
 S X=X+1 F Y=Y:1:MARLB-1 S MARLB(X)=$G(X(Y)),X=X+1
"RTN","PSGMUTL",107,0)
 F X=X:0 Q:(X#6)=0  S MARLB(X)="",X=X+1
"RTN","PSGMUTL",108,0)
 S MARLB(X)=INIT,MARLB=X
"RTN","PSGMUTL",109,0)
 Q
"RTN","PSGMUTL",110,0)
 N X F X=6:1:MARLB S X(X+1)=MARLB(X)
"RTN","PSGMUTL",111,0)
 S MARLB(6)="See next label for continuation"
"RTN","PSGMUTL",112,0)
 F X=7:1:MARLB S MARLB(X)=X(X)
"RTN","PSGMUTL",113,0)
 F X=X+1:1:11 S MARLB(X)=""
"RTN","PSGMUTL",114,0)
 S MARLB(12)=X(MARLB+1)
"RTN","PSGMUTL",115,0)
 S MARLB=12
"RTN","PSGMUTL",116,0)
 Q
"RTN","PSGMUTL",117,0)
 ;
"RTN","PSGO")
0^43^B25169824
"RTN","PSGO",1,0)
PSGO ;BIR/CML3,MV-PRINTS PATIENT'S ORDERS ;10 Feb 98 / 1:32 PM
"RTN","PSGO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,58,110**;16 DEC 97
"RTN","PSGO",3,0)
 ;
"RTN","PSGO",4,0)
 ; Reference to ^PS(55 is is supported by DBIA #2191.
"RTN","PSGO",5,0)
 ;
"RTN","PSGO",6,0)
 K ^TMP("PSJON",$J),PSGONF S PSGOH="U N I T   D O S E   P R O F I L E" D ENGORD^PSGOU
"RTN","PSGO",7,0)
 ;
"RTN","PSGO",8,0)
EN ;
"RTN","PSGO",9,0)
 S CML=IO'=IO(0)!($E(IOST,1,2)'="C-"),NP="" N RB
"RTN","PSGO",10,0)
 U IO D GET I '$D(^TMP("PSG",$J)) W !,SLS,SLS,$E(SLS,1,24),!?22,"NO ORDERS FOUND" W:"SL"[PSGOL " FOR A ",$S(PSGOL="S":"SHORT",1:"LONG")," PROFILE."
"RTN","PSGO",11,0)
 G:NP["^" DONE
"RTN","PSGO",12,0)
 E  S (C,DRG)="",LD=0
"RTN","PSGO",13,0)
 E  D DRG G:NP["^" DONE
"RTN","PSGO",14,0)
 I CML,$S('$D(PSGPRP):1,1:PSGPRP="P") D BOT
"RTN","PSGO",15,0)
 ;
"RTN","PSGO",16,0)
DONE ;
"RTN","PSGO",17,0)
 I $S('$D(PSGPRP):1,1:PSGPRP="P") K ^TMP("PSG",$J)
"RTN","PSGO",18,0)
 S PSGON=$S('CML:ON,1:0) K:'$D(PSGVBW) PSGODT
"RTN","PSGO",19,0)
 ;
"RTN","PSGO",20,0)
D1 ;
"RTN","PSGO",21,0)
 K C,CML,DN,DO,DRG,F,GIVE,HDT,LN2,NF,ND,ND4,ND6,NP,O,ON,PF,PG,PSGHD,PSGOH,PSJTEAM,RCT,RF,RTE,S,SCH,SD,SLS,SM,ST,STS,TF,UDU,V,WD,WS,WT Q
"RTN","PSGO",22,0)
 ;
"RTN","PSGO",23,0)
DRG ;
"RTN","PSGO",24,0)
 I PSGOL'="N" F  S C=$O(^TMP("PSG",$J,C)) Q:C=""!(NP["^")  D:$S(C="BA":1,C="CC":1,C="CD":1,C["C":TF,1:1) TF F ST="C","O","OC","P","R","z" D
"RTN","PSGO",25,0)
 .F  S DRG=$O(^TMP("PSG",$J,C,ST,DRG)) Q:DRG=""!(NP["^")  S NF=^(DRG),O=$P(DRG,"^",2),DN=$P(DRG,"^") D:$Y+4>IOSL NP Q:NP["^"  D P
"RTN","PSGO",26,0)
 I PSGOL="N" F  S LD=$O(^TMP("PSG",$J,LD)) Q:'LD  S X=^(LD),NF=$P(X,U),C=$P(X,U,2),ST=$P(X,U,3),DN=$P(X,U,4),O=$P(LD,U,2) D P
"RTN","PSGO",27,0)
 Q
"RTN","PSGO",28,0)
 ;
"RTN","PSGO",29,0)
P ;Display drug data stored in ^TMP("PSG",$J
"RTN","PSGO",30,0)
 S ON=ON+1 I 'CML S ^TMP("PSJON",$J,ON)=+O_$S(C["CD":"",C["C":"P",C["BD":"",C["B":"P",1:"U") S:C'["O" PSGONC=ON
"RTN","PSGO",31,0)
 Q:PSGOL="N"
"RTN","PSGO",32,0)
 W !,$J(ON,4),?5
"RTN","PSGO",33,0)
 I C["CD" N PSJO,OO S PSJO=O,OO=0 F  S OO=$O(^PS(53.1,"ACX",PSJO,OO)) Q:'OO  S O=OO D P2 W !
"RTN","PSGO",34,0)
 I C["BD" N PSJO,OO S PSJO=O,OO=0 F  S OO=$O(^PS(53.1,"ACX",PSJO,OO)) Q:'OO  S O=OO D P2 W !
"RTN","PSGO",35,0)
 Q:C["BD"  Q:C["CD" 
"RTN","PSGO",36,0)
 ; naked references below refer to full reference inside indirection @(F_+O_".0)" for either file 53.1 or 55
"RTN","PSGO",37,0)
P2 S ND=$G(@(F_+O_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),DO=$G(^(.2))
"RTN","PSGO",38,0)
 I C="A",PSJSYSU,'$P(ND4,"^",+PSJSYSU),$P(ND4,"^",+PSJSYSU=1+9) S PSGONV=ON
"RTN","PSGO",39,0)
 I C="A"!(C="O") S:$P(ND,"^",9)'="H"&'CML PSGONR=ON D
"RTN","PSGO",40,0)
 .S V='$P(ND4,"^",UDU),V=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSGO",41,0)
 .W $S(ND4="":" ",$P(ND4,"^",12):"D",V!$P(ND4,"^",19)&$P(ND4,"^",18):"H",V!$P(ND4,"^",23)&$P(ND4,"^",22):"H",V!$P(ND4,"^",16)&$P(ND4,"^",15):"R",1:" ")
"RTN","PSGO",42,0)
 .W $S($P(DO,U,4)="D":"d",1:" ")_$S(V:"->",1:"  ")
"RTN","PSGO",43,0)
 ;I C="CA"!(C["B") W $S($P(ND4,"^",12):"D",1:" "),$S(PSJSYSU:"->",1:"") I C["B" S PSGONF=$S('$G(PSGONF):ON_U_ON,1:+PSGONF_U_ON)
"RTN","PSGO",44,0)
 I C="CA"!(C["B") W $S($P(ND4,"^",12):"D",1:" ") I C["B" S PSGONF=$S('$G(PSGONF):ON_U_ON,1:+PSGONF_U_ON)
"RTN","PSGO",45,0)
 S SM=2-$S('$P(ND,"^",5):2,1:$P(ND,"^",6)),STS=$S($P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4) I C["C" S (PSGID,SD)="",PSGOD="********"
"RTN","PSGO",46,0)
 I STS="A",($P(ND,U,27)="R") S STS="R"
"RTN","PSGO",47,0)
 S WS=0,PSGOD=$$ENDTC^PSGMI(PSGID)
"RTN","PSGO",48,0)
 S:PSJPWD WS=$$WS^PSJO(PSJPWD,PSGP,F,+O)
"RTN","PSGO",49,0)
 NEW MARX
"RTN","PSGO",50,0)
 D DRGDISP^PSJLMUT1(PSGP,+O_$S(C["B":"P",C["C":"P",1:"U"),40,54,.MARX,0)
"RTN","PSGO",51,0)
 NEW X F X=0:0 S X=$O(MARX(X)) Q:'X  W @($S(X=1:"?9",1:"!?11")) W MARX(X) D:X=1
"RTN","PSGO",52,0)
 . N RNDT,O2 S O2=O S:+O2=O O2=O2_"P" S RNDT=$$LASTREN^PSJLMPRI(PSGP,O2) I RNDT]"" S RNDT=$E($$ENDTC^PSGMI(RNDT),1,5)
"RTN","PSGO",53,0)
 . W ?50,$S(C["C":"?",ST'="z":ST,1:"?"),?53,$E(PSGOD,1,5)
"RTN","PSGO",54,0)
 . S SD=$$ENDTC^PSGMI(SD) W ?60,$E(SD,1,5),?67,STS
"RTN","PSGO",55,0)
 . I NF!WS!SM!PF!RNDT W ?71 W:NF "NF " W:WS "WS " W:RNDT RNDT_" " W:SM $E("HSM",SM,3) W:PF ?79,"*"
"RTN","PSGO",56,0)
 I ND6]"" S Y=$$ENSET^PSGSICHK($P(ND6,"^")) W !?11 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>66 !?11 W V_" "
"RTN","PSGO",57,0)
 Q
"RTN","PSGO",58,0)
 ;
"RTN","PSGO",59,0)
TF ;
"RTN","PSGO",60,0)
 NEW SLS S SLS="",$P(SLS," -",40)=""
"RTN","PSGO",61,0)
 S LN2=$S(C="A":"A C T I V E",C["CC":"P E N D I N G   R E N E W A L S",C["CD":"P E N D I N G  C O M P L E X",C["C":"P E N D I N G ",C["BD":"N O N - V E R I F E D  C O M P L E X",C["B":"N O N - V E R I F I E D",1:"N O N - A C T I V E")
"RTN","PSGO",62,0)
 W:$D(^TMP("PSG",$J,C)) !,$E($E(SLS,1,(80-$L(LN2))/2)_" "_LN2_$E(SLS,1,(80-$L(LN2))/2),1,80)
"RTN","PSGO",63,0)
 S F="^PS("_$S(C["C":"53.1,",C["B":"53.1,",1:"55,"_PSGP_",5,",1:"53.1,") S TF=$S(C["C":0,1:TF)
"RTN","PSGO",64,0)
 Q
"RTN","PSGO",65,0)
 ;
"RTN","PSGO",66,0)
GET ;
"RTN","PSGO",67,0)
 S $P(LN2,"-",81)="",PG=$D(PSGVWA),(ON,PSGONC,PSGONR,PSGONV,SLS)="",$P(SLS," -",15)="",TF=1,RB=$S(PSJPRB]"":PSJPRB,1:"*NF*"),WD=$S(PSJPWDN]"":PSJPWDN,PSJPWD:PSJPWD_";DIC(42,",1:"*NF*")
"RTN","PSGO",68,0)
 ;
"RTN","PSGO",69,0)
NP I ON,'CML W $C(7) R !," '^' TO QUIT ",NP:DTIME W:'$T $C(7) S:'$T NP="^" W:NP'["^" $C(13),"                     ",$C(13),# Q
"RTN","PSGO",70,0)
 I ON,CML D BOT
"RTN","PSGO",71,0)
 Q:$G(PSGOL)="N"
"RTN","PSGO",72,0)
 ;
"RTN","PSGO",73,0)
HEADER ;
"RTN","PSGO",74,0)
 S PG=PG+1
"RTN","PSGO",75,0)
 S:'$D(PSJOPC) PSJOPC=1 S PSJTEAM=$S($D(PSJSEL("TM")):1,1:0)
"RTN","PSGO",76,0)
 D ENTRY^PSJHEAD(PSGP,PSJOPC,PG,$G(PSJNARC),PSJTEAM)
"RTN","PSGO",77,0)
 W:PG>1 !,$E(LN2,1,80) Q
"RTN","PSGO",78,0)
 ;
"RTN","PSGO",79,0)
BOT ;
"RTN","PSGO",80,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSGO",81,0)
 W !,?2,$P(PSGP(0),"^"),?40,PSJPPID,?70,$E($P(PSJPDOB,"^",2),1,8) Q
"RTN","PSGO",82,0)
 ;
"RTN","PSGO",83,0)
ENHEAD ;
"RTN","PSGO",84,0)
 K LN2,PSGPR,PSGPRP D NOW^%DTC S HDT=$$ENDTC^PSGMI(+$E(%,1,12)),PSGVWA=1,PSGOH="U N I T   D O S E   P R O F I L E" D GET
"RTN","PSGO",85,0)
 D D1 K PSGONC,PSGONR,PSGONV,PSGVWA Q
"RTN","PSGO",86,0)
 ;
"RTN","PSGO",87,0)
ENVBW ;
"RTN","PSGO",88,0)
 S PSGOH=$S(PSGVBWTO=1:"N O N - V E R I F I E D   O R D E R S",PSGVBWTO=2:"P E N D I N G   O R D E R S",1:"N O N - V E R I F I E D / P E N D I N G   O R D E R S")
"RTN","PSGO",89,0)
 D EN Q
"RTN","PSGO",90,0)
ENPR ;
"RTN","PSGO",91,0)
 S PSGOH="U N I T  D O S E  P R O F I L E" G GET
"RTN","PSGO",92,0)
 Q
"RTN","PSGOE0")
0^44^B12881111
"RTN","PSGOE0",1,0)
PSGOE0 ;BIR/CML3-PROFILE AND ORDER ENTRY ;25 SEP 97 / 7:42 AM
"RTN","PSGOE0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSGOE0",3,0)
 ;
"RTN","PSGOE0",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE0",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGOE0",6,0)
 ; 
"RTN","PSGOE0",7,0)
START ; print orders
"RTN","PSGOE0",8,0)
 W:X]"" $P("^PROFILE",X,2) D ENL^PSGOU G:PSGOL="^" DONE G:PSGOL="N" ASK K PSGPR S PSGOEAV=0,PSJNARC=1,PSJOPC="UD" D ^PSGO I 'PSGON G ASK
"RTN","PSGOE0",9,0)
 ;
"RTN","PSGOE0",10,0)
ENVO ; view/act on orders
"RTN","PSGOE0",11,0)
 S PSGLMT=PSGON D ENASR^PSGON G:"^"[X ASK G:X["^^" DONE
"RTN","PSGOE0",12,0)
 I X="D" D EN^PSGOECS G:'$D(X) ENVO S X="^PROFILE" G START
"RTN","PSGOE0",13,0)
 I X="R" D EN^PSGOERS G:'$D(X) ENVO S X="^PROFILE" G START
"RTN","PSGOE0",14,0)
 I X="V" D EN^PSGOEVS G:'$D(X) ENVO S X="^PROFILE" G START
"RTN","PSGOE0",15,0)
 I X="F" D EN^PSGOESF G:'$D(X) ENVO S X="^PROFILE" G START
"RTN","PSGOE0",16,0)
 I PSGODDD S PSGOEA=""
"RTN","PSGOE0",17,0)
 I  F PSGOE=1:1:PSGODDD F PSGOE1=1:1:$L(PSGODDD(PSGOE),",")-1 S PSGOE2=$P(PSGODDD(PSGOE),",",PSGOE1) D EN1^PSGVW K CONT D  Q:'$D(PSGODDD)!($G(PSGOEA)["^")
"RTN","PSGOE0",18,0)
 .Q:$G(PSGOEA)["^"  I $D(PSGPRF) W !!,"Press RETURN to continue: " R CONT:DTIME W @IOF S:CONT["^" PSGOEA="^"
"RTN","PSGOE0",19,0)
 .D ^PSGOE1:'$D(PSGPRF) Q:$G(PSGOEA)["^"  I $D(PSGPRF),PSGORD["N",'$D(CONT) K DIR S DIR(0)="E" W ! D ^DIR Q:X["^"!$D(DIRUT)
"RTN","PSGOE0",20,0)
 ;
"RTN","PSGOE0",21,0)
 ;
"RTN","PSGOE0",22,0)
ASK ; new orders entered here
"RTN","PSGOE0",23,0)
 K ^TMP("PSJON",$J),DIR,DIROUT,DIRUT,DRGI,DTOUT,DUOUT,PRI,PSGLMT,PSGODDD,PSGOE1,PSGOE2,PSGOEA,PSGOEE,PSGON,PSGONC,PSGONF,PSGONR,PSGONV Q:$D(PSGPRF)  K PSGCANFL,PSGOL Q:'PSJPCAF
"RTN","PSGOE0",24,0)
 F  W !!,"New order(s) for ",$P(PSGP(0),"^"),"?  Y// " R X:DTIME W:'$T $C(7) S:'$T X="^" S:X="" X="Y" G:$P("^PROFILE",X)=""&(X'="^") START Q:"^YyNn"[X  D:X?1."?" AM W:X'?1."?" $C(7),"  ??"
"RTN","PSGOE0",25,0)
 W:"Nn"[X "  (NO)" G:"^Nn"[X DONE W "  (YES)"
"RTN","PSGOE0",26,0)
 I '$P(PSJSYSU,";",2) S PR=$P($G(^PS(55,PSGP,5.1)),"^",2) I PR D
"RTN","PSGOE0",27,0)
 .S X=$G(^VA(200,PR,"PS")) I $S('X:1,'$P(X,"^",4):0,1:DT'>$P(X,"^",4)) D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),"^",2)="",PR=""
"RTN","PSGOE0",28,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU,PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=$S($P(PSJSYSU,";",2):DUZ,1:PR) S:'PSGOEPR PSGOEPR=PSJPTSP
"RTN","PSGOE0",29,0)
 ;
"RTN","PSGOE0",30,0)
DRG ;
"RTN","PSGOE0",31,0)
 D ^PSGOE7 G:Y<0 DONE G:$P("^PROFILE",X)="" START I X?1"S."1.E D ^PSGOES G DRG
"RTN","PSGOE0",32,0)
 W ! D ^PSGOE3:$P(PSJSYSP0,"^",12),^PSGOE4:'$P(PSJSYSP0,"^",12) K PSGOEE,PSGOEOS D:$D(Y) ^PSGOETO G DRG
"RTN","PSGOE0",33,0)
 ;
"RTN","PSGOE0",34,0)
DONE ;
"RTN","PSGOE0",35,0)
 K DIR,DIROUT,DIRUT,DTOUT,DUOUT,PSG,PSGDL,PSGDLS,PSGDO,PSGDRG,PSGDRGN,PSGFD,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGNEWDT
"RTN","PSGOE0",36,0)
 K PSGOEPR,PSGOES,PSGOPR,PSGORD,PSGOROE1,PSGPR,PSGPRN,PSGS0XT,PSGS0Y,PSGSCH,PSGSD,PSGSI,PSGSM,PSGST,PSGSTN,PSGUD,PSGX,PSJNARC,PSJOPC
"RTN","PSGOE0",37,0)
 Q
"RTN","PSGOE0",38,0)
 ;
"RTN","PSGOE0",39,0)
AM ;
"RTN","PSGOE0",40,0)
 W !!?2,"Answer 'YES' (or press the RETURN key) to enter new UNIT DOSE orders for this",!,"patient.  Answer 'NO' (or '^') if there are no new orders for this patient." Q
"RTN","PSGOE1")
0^70^B29807928
"RTN","PSGOE1",1,0)
PSGOE1 ;BIR/CML3-ACTION ON INPATIENT ORDERS ;10 Mar 99 / 10:54 AM
"RTN","PSGOE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,19,26,39,58,85,80,110**;16 DEC 97
"RTN","PSGOE1",3,0)
 ;
"RTN","PSGOE1",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE1",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSGOE1",6,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSGOE1",7,0)
 ; Reference to AND^ORX8 is supported by DBIA #3632.
"RTN","PSGOE1",8,0)
EN ;       
"RTN","PSGOE1",9,0)
 K PSGDFLG,PSGPFLG S PSGOEA="^",PSGACT="",(PSGDI,PSGOENG,PSGPI,PSGRRF)=0
"RTN","PSGOE1",10,0)
 Q:'$G(DUZ)
"RTN","PSGOE1",11,0)
 D @$S(PSGORD["P":"NON",1:"ACT")
"RTN","PSGOE1",12,0)
GO ;
"RTN","PSGOE1",13,0)
 K A,ND,PSGE,PSGR,ST,X,X1,X2,Y I $D(ORACTION) K PSGDI,PSGOENG,PSGPI Q
"RTN","PSGOE1",14,0)
 ;W:$G(PSGPFLG) !!?3,"(THE ORDERABLE ITEM IS CURRENTLY LISTED AS INACTIVE.)" W:$G(PSGDFLG) !!?3,"(ONE OR ALL DISPENSE DRUGS ARE CURRENTLY LISTED AS INACTIVE OR DO NOT MATCH",!?3,"THE ORDERABLE ITEM FOR THIS ORDER.)"
"RTN","PSGOE1",15,0)
 ;I $G(PSGPFLG)!$G(PSGDFLG) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOE1",16,0)
 ;S PSGCANFL=0 ;F  D ACTO W !!,"ACTION"_$S(PSGACTO]"":" ("_PSGACTO_")",1:"")_"? " R PSGOEA:DTIME W:'$T $C(7) S:'$T PSGOEA="^" Q:"^"[PSGOEA  D CHK D:C @PSGOEA Q:PSGCANFL
"RTN","PSGOE1",17,0)
 Q
"RTN","PSGOE1",18,0)
ENACTION(PSGP,PSGORD)        ;
"RTN","PSGOE1",19,0)
 ;Returns string identifying the actions allowed on this order.
"RTN","PSGOE1",20,0)
 D EN
"RTN","PSGOE1",21,0)
 Q PSGACT
"RTN","PSGOE1",22,0)
DONE ;
"RTN","PSGOE1",23,0)
 I PSGORD["U"!(PSGORD["O") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOE1",24,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOE1",25,0)
 K C,PSGACT,PSGDFLG,PSGPFLG,PSGDI,PSGOENG,PSGPI,PSGRRF Q
"RTN","PSGOE1",26,0)
B ; bypass
"RTN","PSGOE1",27,0)
 S PSGCANFL=1
"RTN","PSGOE1",28,0)
 Q
"RTN","PSGOE1",29,0)
C ; copy an order (does NOT discontinue original order)
"RTN","PSGOE1",30,0)
 D ^PSGOD Q
"RTN","PSGOE1",31,0)
D ; discontinue (or delete) an order
"RTN","PSGOE1",32,0)
 I PSGOEAV,'$D(PSGODF) D ENDS^PSGPO Q
"RTN","PSGOE1",33,0)
 D ENO^PSGOEC(PSGP,PSGORD) Q
"RTN","PSGOE1",34,0)
E ; edit orders
"RTN","PSGOE1",35,0)
 D ^PSGOEE Q
"RTN","PSGOE1",36,0)
F ; finish released orders
"RTN","PSGOE1",37,0)
 D ^PSGOEF Q
"RTN","PSGOE1",38,0)
H(PSGP,PSGORD) ; hold
"RTN","PSGOE1",39,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(X,U,12),$P(X,U,13) W $C(7),!!,"WARNING!  THIS ORDER HAS BEEN MARKED FOR CANCELLATION."
"RTN","PSGOE1",40,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",9)="H" D ^PSGOEH0 Q
"RTN","PSGOE1",41,0)
 D ^PSGOEH1 Q
"RTN","PSGOE1",42,0)
I ; mark (or unmark) a non-verified order as 'incomplete'
"RTN","PSGOE1",43,0)
 D ^PSGOEI Q
"RTN","PSGOE1",44,0)
L ; display logs
"RTN","PSGOE1",45,0)
 D ^PSGOEL Q
"RTN","PSGOE1",46,0)
N ; mark order as 'not to be given'
"RTN","PSGOE1",47,0)
 D ^PSGOENG Q
"RTN","PSGOE1",48,0)
O ; Outpatient (discharge) med
"RTN","PSGOE1",49,0)
 W !!,"UNDER DEVELOPMENT, NOT CURRENTLY AVAILABLE."
"RTN","PSGOE1",50,0)
 Q
"RTN","PSGOE1",51,0)
P ; print expanded view
"RTN","PSGOE1",52,0)
 D ^PSGVWP Q
"RTN","PSGOE1",53,0)
R ; renew an order
"RTN","PSGOE1",54,0)
 I 'PSJSYSU,$D(^PS(55,PSGP,5,+PSGORD,4)),$P(^(4),"^",15),$P(^(4),"^",16) W !!,"THIS ORDER IS ALREADY MARKED FOR RENEWAL!" Q
"RTN","PSGOE1",55,0)
 I 'PSGRRF D ^PSGOER Q
"RTN","PSGOE1",56,0)
 D ^PSGOERI Q
"RTN","PSGOE1",57,0)
S ; show the order again
"RTN","PSGOE1",58,0)
 D EN2^PSGVW Q
"RTN","PSGOE1",59,0)
V ; verify an order
"RTN","PSGOE1",60,0)
 D EN^PSGOEV Q
"RTN","PSGOE1",61,0)
ACT ;
"RTN","PSGOE1",62,0)
 S X=$G(^PS(55,PSGP,5,+PSGORD,0)),ND0=X,ND=$G(^(4)),ND2=$G(^(2)),PSGOENG=$P(X,"^",22),PSGR=$E("R",'PSGOENG),PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8)
"RTN","PSGOE1",63,0)
 S PSGR=$E("R",'$$EXPIRED^PSGOER(PSGP,PSGORD))
"RTN","PSGOE1",64,0)
 I 'PSGOENG,PSJCOM S PSGR=$E("R",$$AND^ORX8(PSJCOM)) S:PSGR="R" PSGR=$E("R",$$RNEWOK^PSJUTL2(PSJCOM,PSGP))
"RTN","PSGOE1",65,0)
 I 'PSGOENG,PSJCOM
"RTN","PSGOE1",66,0)
 I $P(ND2,U,4)'>PSGDT D OLD Q
"RTN","PSGOE1",67,0)
 S PSGE="E" I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",+$G(^PS(55,PSGP,5,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(55,PSGP,5,+PSGORD,.2)))
"RTN","PSGOE1",68,0)
 S:$P(X,"^",26) (PSGE,PSGR)=""
"RTN","PSGOE1",69,0)
 I '$D(PSGOETOF) S PSGPI=$P(X,"^",2) I PSGPI S PSGPI=$P($G(^VA(200,PSGPI,"PS")),"^",4) S:PSGPI PSGPI=PSGPI'>DT
"RTN","PSGOE1",70,0)
 S ST=$P(X,"^",9)="H"*4 S:ST (PSGE,PSGR)=""
"RTN","PSGOE1",71,0)
 ;S PSGACT="D"_$S(+$P(^PS(55,PSGP,5,+PSGORD,.2),"^",8):"",1:PSGE)_$S($P(ND,"^",18+ST)&'$P(ND,"^",19+ST)&'$P(ND,"^",PSJSYSU):"",1:"H")_"L"_$S(ST:"",1:PSGR)
"RTN","PSGOE1",72,0)
 N CMPOK S CMPOK=1 I $$COMPLEX^PSJOE(PSGP,PSGORD) S CMPOK=+$P(^PS(55,PSGP,5,+PSGORD,.2),"^",8)
"RTN","PSGOE1",73,0)
 S PSGACT="D"_$S('$G(CMPOK):"",1:PSGE)_$S($P(ND,"^",18+ST)&'$P(ND,"^",19+ST)&'$P(ND,"^",PSJSYSU):"",1:"H")_"L"_$S(ST:"",1:PSGR)
"RTN","PSGOE1",74,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S PSGACT=PSGACT_"V"
"RTN","PSGOE1",75,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",76,0)
 Q
"RTN","PSGOE1",77,0)
OLD ;
"RTN","PSGOE1",78,0)
 S A=$P(ND0,"^",9),PSGACT=$E("H",A="H")_"L" I A'["D",A'["E" Q
"RTN","PSGOE1",79,0)
 I 'PSGOENG,($D(^XUSEC("PSJU MGR",DUZ))!$D(^XUSEC("PSJ RPHARM",DUZ))) S PSGACT="LN"
"RTN","PSGOE1",80,0)
 I PSJSYSU,'$P(ND,"^",+PSJSYSU) S:(A'["D")&($G(PSGPRIO)'="DONE") PSGACT="D"_PSGACT S PSGACT=PSGACT_"V" Q
"RTN","PSGOE1",81,0)
 Q:PSGR=""!'PSJPCAF  D NOW^%DTC S (PSGDT,X1)=+$E(%,1,12),X2=-4 D C^%DTC I $S('$P(ND2,"^",4):1,1:$P(ND2,"^",4)'>X) Q
"RTN","PSGOE1",82,0)
 I A="E",$G(PSJPRI)'="D" S PSGACT=PSGACT_PSGR Q
"RTN","PSGOE1",83,0)
 I PSJSYSU,$P(ND,"^",11) S PSGACT=PSGACT_PSGR,PSGRRF=1
"RTN","PSGOE1",84,0)
 Q
"RTN","PSGOE1",85,0)
NON ;
"RTN","PSGOE1",86,0)
 N XND
"RTN","PSGOE1",87,0)
 S (X,XND)=$G(^PS(53.1,+PSGORD,0)) I $P(X,"^",19),$D(^PS(55,PSGP,5,$P(X,"^",19))) L -^PS(53.1,+PSGORD) S PSGORD=$P(X,"^",19)_"U" G ACT
"RTN","PSGOE1",88,0)
 I $S($P(X,"^",26):1,$P(X,"^",9)["D":1,1:$P(X,"^",9)["E") S:$P(X,U,9)="P"&($P(X,U,26)) PSGACT="D" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",89,0)
 I PSGORD["U" S PSGACT="DE" S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",90,0)
 I '$D(PSGOETOF) S (PSGDFLG,PSGDI)='$$DDOK^PSGOE2("^PS(53.1,"_+PSGORD_",1,",+$G(^PS(53.1,+PSGORD,.2))),PSGPFLG='$$OIOK^PSGOE2(+$G(^PS(53.1,+PSGORD,.2)))
"RTN","PSGOE1",91,0)
 S DRG=$$STUFFDD^PSGOE2 S:DRG ^PS(53.1,+PSGORD,1,0)="^53.11P^1^1",^PS(53.1,+PSGORD,1,1,0)=DRG,^PS(53.1,+PSGORD,1,"B",DRG,1)=""
"RTN","PSGOE1",92,0)
 F DRG=0:0 S DRG=$O(^PS(53.1,+PSGORD,1,DRG)) Q:'DRG  S DRGPT=^(DRG,0) S INACTDT=$G(^PSDRUG(+DRGPT,"I")) I INACTDT,(INACTDT'>DT) S PSGDFLG=1
"RTN","PSGOE1",93,0)
 I $P(XND,U,9)="P" S PSGACT=$S(+PSJSYSU=3:"BDEF",$G(PSJRNF):"BDEF",1:"") S:(+PSJSYSU=3)&($L($T(EN1^ORCFLAG))) PSGACT=PSGACT_"G" Q
"RTN","PSGOE1",94,0)
 I '$D(PSGOETOF) S PSGPI=$P(XND,"^",2) I PSGPI S PSGPI=$P($G(^VA(200,PSGPI,"PS")),"^",4) S:PSGPI PSGPI=PSGPI'>DT
"RTN","PSGOE1",95,0)
 S PSGACT="DEI" I PSJSYSU,'PSGPI,$P(XND,"^",9)'="I" S PSGACT=PSGACT_"V"
"RTN","PSGOE1",96,0)
 ;* S PSGACT="DEI" I PSJSYSU,'PSGDI,'PSGPI,$P(X,"^",9)'="I" S PSGACT=PSGACT_"V"
"RTN","PSGOE1",97,0)
 S XND2=$G(^PS(53.1,+PSGORD,.2)) I $P(XND2,"^",8),$P(XND,"^",9)="P" S PSGACT=$TR(PSGACT,"V")
"RTN","PSGOE1",98,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSGOE1",99,0)
 I $P($G(PSGRDTX),U,2)]"",'$D(^PS(53.1,+PSGORD,2.5)) S $P(^PS(53.1,+PSGORD,2.5),U,2)=$P(PSGRDTX,U,2)
"RTN","PSGOE1",100,0)
 Q
"RTN","PSGOE1",101,0)
ACTO ;
"RTN","PSGOE1",102,0)
 S PSGACTO="" I $G(PSGACT)]"" F X=1:1:$L(PSGACT) S PSGACTO=PSGACTO_$S($E(PSGACT,X)="D":"DC",1:$E(PSGACT,X))_" "
"RTN","PSGOE1",103,0)
 S:PSGACTO]"" PSGACTO=$E(PSGACTO,1,$L(PSGACTO)-1) Q
"RTN","PSGOE8")
0^111^B35711863
"RTN","PSGOE8",1,0)
PSGOE8 ;BIR/CML3-EDIT ORDERS IN 53.1 ;25 SEP 97 / 10:58 AM
"RTN","PSGOE8",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**47,50,65,72,110**;16 DEC 97
"RTN","PSGOE8",3,0)
 ;
"RTN","PSGOE8",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE8",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE8",6,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE8",7,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116
"RTN","PSGOE8",8,0)
 ; Reference to ^DIC is supported by DBIA# 10006
"RTN","PSGOE8",9,0)
 ; Reference to ^DICN is supported by DBIA# 10009
"RTN","PSGOE8",10,0)
 ;
"RTN","PSGOE8",11,0)
101 ;Orderable Item
"RTN","PSGOE8",12,0)
 S MSG=0,F2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(F2) BACK="101^PSGOE8"
"RTN","PSGOE8",13,0)
 S %=1 I $P(PSJSYSU,";",3)>1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%
"RTN","PSGOE8",14,0)
 I %'=1 G DONE
"RTN","PSGOE8",15,0)
A101 ;
"RTN","PSGOE8",16,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",17,0)
 . W !!?5,"Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",18,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",19,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE8",20,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,101) G A101
"RTN","PSGOE8",21,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,101)
"RTN","PSGOE8",22,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A101
"RTN","PSGOE8",23,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")" D ^DIC K DIC I Y'>0 G A101
"RTN","PSGOE8",24,0)
 F  S %=2 D DH,YN^DICN Q:%
"RTN","PSGOE8",25,0)
 I %'=1 G A101
"RTN","PSGOE8",26,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE8",27,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE8",28,0)
 S PSGPDNX=1,PSGDO="",(PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG) K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) D
"RTN","PSGOE8",29,0)
 .S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)=""
"RTN","PSGOE8",30,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE8",31,0)
 G DONE
"RTN","PSGOE8",32,0)
 ;
"RTN","PSGOE8",33,0)
109 ; dosage ordered
"RTN","PSGOE8",34,0)
 S MSG=0,F2=109 S:PSGOEEF(F2) BACK="109^PSGOE8"
"RTN","PSGOE8",35,0)
A109 ;
"RTN","PSGOE8",36,0)
 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",37,0)
 . W !!?5,"Dosage may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",38,0)
 S PSGOEEF(F2)=PSGOEE
"RTN","PSGOE8",39,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE8",40,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",41,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE8",42,0)
 I $$CHECK(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE8",43,0)
 I $$CHECK(PSJSYSP)&(X="@") W $C(7),"      (Required) " G A109
"RTN","PSGOE8",44,0)
 I '$$CHECK(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE8",45,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",46,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A109
"RTN","PSGOE8",47,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE8",48,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(53.1,109) G A109
"RTN","PSGOE8",49,0)
 S PSGDO=X G DONE
"RTN","PSGOE8",50,0)
 ;
"RTN","PSGOE8",51,0)
3 ; med route
"RTN","PSGOE8",52,0)
 S MSG=0,F2=3 S:PSGOEEF(F2) BACK="3^PSGOE8"
"RTN","PSGOE8",53,0)
A3 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",54,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",55,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",56,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE8",57,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,3) G A3
"RTN","PSGOE8",58,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,3)
"RTN","PSGOE8",59,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A3
"RTN","PSGOE8",60,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE8",61,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE8",62,0)
 ;
"RTN","PSGOE8",63,0)
7 ; schedule type
"RTN","PSGOE8",64,0)
 S MSG=0,F2=7 S:PSGOEEF(F2) BACK="7^PSGOE8"
"RTN","PSGOE8",65,0)
A7 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE8",66,0)
 I X="" W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE8",67,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",68,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A7
"RTN","PSGOE8",69,0)
 ; I X="OC"!(X="R") S PSGST=X,$P(PSGNEDFD,"^",3)=X,PSGSTN=$S(X="R":"FILL on REQUEST",1:"ON CALL") W "  "_PSGSTN S PSGOEEF(7)="" G:X="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE8",70,0)
 F Y="C^CONTINUOUS","O^ONE TIME","OC^ON CALL","P^PRN","R^FILL on REQUEST" I $S(X=$P(Y,"^"):1,1:$P($P(Y,"^",2),X)="") W $S(X=$P(Y,"^"):"  "_$P(Y,"^",2),1:$P($P(Y,"^",2),X,2)) S PSGST=$P(Y,"^"),PSGSTN=$P(Y,"^",2),$P(PSGNEDFD,"^",3)=PSGST Q
"RTN","PSGOE8",71,0)
 E  W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,7) G A7
"RTN","PSGOE8",72,0)
 ; I PSGST="OC"!(PSGST="R") S PSGOEEF(7)="" G:PSGST="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE8",73,0)
 G DONE
"RTN","PSGOE8",74,0)
 ;
"RTN","PSGOE8",75,0)
26 ; schedule
"RTN","PSGOE8",76,0)
 S MSG=0,F2=26 S:PSGOEEF(F2) BACK="26^PSGOE8"
"RTN","PSGOE8",77,0)
A26 I $$PNDREN($G(PSGORD)) D  Q
"RTN","PSGOE8",78,0)
 . W !!?5,"Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSGOE8",79,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE8",80,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",81,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",82,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A26
"RTN","PSGOE8",83,0)
 N PSGOES D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,26) G A26
"RTN","PSGOE8",84,0)
 S PSGSCH=X I PSGS0Y'=PSGAT S PSGAT=PSGS0Y W !!,"NOTE: This change in schedule also changes the ADMIN TIMES.",! S MSG=1 D:$G(PSJNEWOE) PAUSE^VALM1
"RTN","PSGOE8",85,0)
 ;
"RTN","PSGOE8",86,0)
DONE ;
"RTN","PSGOE8",87,0)
 I PSGOEE G:'PSGOEEF(F2) @BACK S PSGOEE=PSGOEEF(F2)
"RTN","PSGOE8",88,0)
 K F,F0,F2 Q
"RTN","PSGOE8",89,0)
 ;
"RTN","PSGOE8",90,0)
DEL ; delete entry
"RTN","PSGOE8",91,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE8",92,0)
 Q
"RTN","PSGOE8",93,0)
 ;
"RTN","PSGOE8",94,0)
DH ;
"RTN","PSGOE8",95,0)
 W !!?2,"When the drug of an order is changed, the Dosage Ordered and Dispense Drug(s)",!,"for the order are no longer valid, and therefore deleted from the order.",!,"If possible, a new corresponding dispense drug will be added to the order."
"RTN","PSGOE8",96,0)
 W !!?2,"Answer 'YES' to continue with this change.  Answer 'NO' to select another",!,"drug or to accept the drug as it was.  Enter an '^' the exit this edit." Q
"RTN","PSGOE8",97,0)
 ;
"RTN","PSGOE8",98,0)
CHECK(PSJSYSP) ; Check to see if multiple dispense drugs
"RTN","PSGOE8",99,0)
 ; Input  -     PSJSYSP
"RTN","PSGOE8",100,0)
 ; Returns  0 = only one.
"RTN","PSGOE8",101,0)
 ;          1 = more than one
"RTN","PSGOE8",102,0)
 ; Checks Inactive Date and doesn't count if < or = today.
"RTN","PSGOE8",103,0)
 N PSJRSB,PSJINACT,PSJRBCNT S PSJRBCNT=0
"RTN","PSGOE8",104,0)
 F PSJRSB=0:0 S PSJRSB=$O(^PS(53.45,PSJSYSP,2,PSJRSB)) Q:'PSJRSB  D
"RTN","PSGOE8",105,0)
 .S PSJINACT=$P(^PS(53.45,PSJSYSP,2,PSJRSB,0),"^",3)
"RTN","PSGOE8",106,0)
 .I (PSJINACT="")!((PSJINACT>0)&(PSJINACT>DT)) D
"RTN","PSGOE8",107,0)
 ..S PSJRBCNT=$S('$D(PSJRBCNT):1,1:PSJRBCNT+1)
"RTN","PSGOE8",108,0)
 Q $S(PSJRBCNT>1:1,1:0)
"RTN","PSGOE8",109,0)
 ;
"RTN","PSGOE8",110,0)
PNDREN(PNDON) ;
"RTN","PSGOE8",111,0)
 I PNDON'["P" Q 0
"RTN","PSGOE8",112,0)
 S RNWL="^PS(53.1,"_+PNDON_",0)" S RNWL=$G(@(RNWL)) S RNWL=$S($P(RNWL,"^",24)="R":1,1:0)
"RTN","PSGOE8",113,0)
 Q RNWL
"RTN","PSGOE81")
0^112^B21126549
"RTN","PSGOE81",1,0)
PSGOE81 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;10 Mar 99 / 10:55 AM
"RTN","PSGOE81",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**26,50,64,58,82,110**;16 DEC 97
"RTN","PSGOE81",3,0)
 ;
"RTN","PSGOE81",4,0)
39 ; admin times
"RTN","PSGOE81",5,0)
 S MSG=0,PSGF2=39 S:PSGOEEF(PSGF2) BACK="39^PSGOE81"
"RTN","PSGOE81",6,0)
A39 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",7,0)
 I X="" G DONE
"RTN","PSGOE81",8,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A39
"RTN","PSGOE81",9,0)
 I X="@",'PSGAT!(PSGS0XT="D")!(PSGSCH["@") W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",10,0)
 I X="@" D DEL G:%'=1 A39 S PSGAT="" G DONE
"RTN","PSGOE81",11,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",12,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",13,0)
 S PSGAT=X,PSGS0Y=PSGAT G DONE
"RTN","PSGOE81",14,0)
 ;
"RTN","PSGOE81",15,0)
8 ; special instructions
"RTN","PSGOE81",16,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE81"
"RTN","PSGOE81",17,0)
A8 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(53.1,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE81",18,0)
 I $E(X)=U D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",19,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",20,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE81",21,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE81",22,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE81",23,0)
 Q
"RTN","PSGOE81",24,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",25,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE81",26,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",27,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",28,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE81",29,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",30,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",31,0)
 S PSGSI=X G DONE
"RTN","PSGOE81",32,0)
 ;
"RTN","PSGOE81",33,0)
10 ; start date/time
"RTN","PSGOE81",34,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE81"
"RTN","PSGOE81",35,0)
A10 ;
"RTN","PSGOE81",36,0)
 K PSGSDX N DUR,DURMIN,TMPFD
"RTN","PSGOE81",37,0)
 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE81",38,0)
 . W !?5,"Start Date may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE81",39,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",40,0)
 I X="",PSGSD W "  "_$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",41,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",42,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE81",43,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A10
"RTN","PSGOE81",44,0)
 NEW TMPX S TMPX=X,X1=+$G(PSGLI),X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE81",45,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE81",46,0)
 S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)
"RTN","PSGOE81",47,0)
 I $G(PSGORD)["P",$G(PSGP) S DUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,"P",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D
"RTN","PSGOE81",48,0)
 . S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",49,0)
 G DONE
"RTN","PSGOE81",50,0)
 ;
"RTN","PSGOE81",51,0)
25 ; stop date
"RTN","PSGOE81",52,0)
 S MSG=0,PSGF2=25 S:PSGOEEF(PSGF2) BACK="25^PSGOE81"
"RTN","PSGOE81",53,0)
A25 ;
"RTN","PSGOE81",54,0)
 K PSGFDX
"RTN","PSGOE81",55,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",56,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W25
"RTN","PSGOE81",57,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25
"RTN","PSGOE81",58,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE81",59,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE81",60,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A25 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD) ; I $P(PSGNEDFD,"^",3)="O",PSGNESD'=PSGNEFD S PSGNESD=PSGNEFD,PSGSD=PSGFD
"RTN","PSGOE81",61,0)
W25 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE81",62,0)
 ;
"RTN","PSGOE81",63,0)
 ;
"RTN","PSGOE81",64,0)
DONE ;
"RTN","PSGOE81",65,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE81",66,0)
 Q
"RTN","PSGOE81",67,0)
 ;
"RTN","PSGOE81",68,0)
FF ; up-arrow to another field
"RTN","PSGOE81",69,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE8"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE81"
"RTN","PSGOE81",70,0)
 Q
"RTN","PSGOE81",71,0)
 ;
"RTN","PSGOE81",72,0)
DEL ; delete entry
"RTN","PSGOE81",73,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE81",74,0)
 Q
"RTN","PSGOE9")
0^120^B32061956
"RTN","PSGOE9",1,0)
PSGOE9 ;BIR/CML3-EDIT ORDERS IN 55 ;13 May 98 / 7:58 AM
"RTN","PSGOE9",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,47,50,72,110**;16 DEC 97
"RTN","PSGOE9",3,0)
 ;
"RTN","PSGOE9",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE9",5,0)
 ;
"RTN","PSGOE9",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180
"RTN","PSGOE9",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178
"RTN","PSGOE9",8,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192
"RTN","PSGOE9",9,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116
"RTN","PSGOE9",10,0)
 ; Reference to ^DIC is supported by DBIA# 10006
"RTN","PSGOE9",11,0)
 ; Reference to ^DICN is supported by DBIA# 10009
"RTN","PSGOE9",12,0)
 ;
"RTN","PSGOE9",13,0)
101 ; Orderable Item (AKA primary drug)
"RTN","PSGOE9",14,0)
 S MSG=0,PSGF2=101,PSGOOPD=PSGPD,PSGOOPDN=PSGPDN S:PSGOEEF(PSGF2) BACK="101^PSGOE9"
"RTN","PSGOE9",15,0)
 S %=1 W !!,$C(7),"WARNING!  If you change the drug of an order, the Dosage Ordered and Dispense",!,"Drug(s) are deleted." F  W !,"Do you wish to continue" S %=2 D YN^DICN Q:%  D DH^PSGOE8
"RTN","PSGOE9",16,0)
 I %'=1 G DONE
"RTN","PSGOE9",17,0)
A101 ;
"RTN","PSGOE9",18,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",19,0)
 . W !!?5,"Orderable Item may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",20,0)
 W !,"ORDERABLE ITEM: ",$S(PSGPD:PSGPDN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",21,0)
 I X="",PSGPD S X=PSGPDN I PSGPD'=PSGPDN,$D(^PS(50.7,PSGPD,0)) G DONE
"RTN","PSGOE9",22,0)
 I $S(X="@":1,X]"":0,1:'PSGPD) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,101) G A101
"RTN","PSGOE9",23,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,101)
"RTN","PSGOE9",24,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A101
"RTN","PSGOE9",25,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("S")="I $$ENOISC^PSJUTL(Y,""U"")"
"RTN","PSGOE9",26,0)
 D ^DIC K DIC I Y'>0 G A101
"RTN","PSGOE9",27,0)
 F  S %=2 D DH^PSGOE8,YN^DICN Q:%
"RTN","PSGOE9",28,0)
 I %'=1 G A101
"RTN","PSGOE9",29,0)
 S (PSGPDRG,PSGPD)=+Y,(PSGPDN,PSGPDRGN)=$$OINAME^PSJLMUTL(PSGPDRG)
"RTN","PSGOE9",30,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",PSGPDRG)
"RTN","PSGOE9",31,0)
 S PSGPDNX=1,PSGPD=+Y,PSGPDN=$$OINAME^PSJLMUTL(PSGPD),PSGDO="" K ^PS(53.45,PSJSYSP,2) S X=$O(^PSDRUG("ASP",PSGPD,0)) I X,'$O(^(X)) S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^1^1",^(1,0)=X,^PS(53.45,PSJSYSP,2,"B",X,1)="" G DONE
"RTN","PSGOE9",32,0)
 D ENDRG^PSGOEF1(PSGPD,0)
"RTN","PSGOE9",33,0)
 G DONE
"RTN","PSGOE9",34,0)
 ;
"RTN","PSGOE9",35,0)
109 ; dosage ordered
"RTN","PSGOE9",36,0)
 S MSG=0,PSGF2=109 S:PSGOEEF(PSGF2) BACK="109^PSGOE9"
"RTN","PSGOE9",37,0)
A109 ;
"RTN","PSGOE9",38,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",39,0)
 . W !!?5,"Dosage may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",40,0)
 D EDITDOSE^PSJDOSE S X=PSGDO G DONE
"RTN","PSGOE9",41,0)
 W !,"DOSAGE ORDERED: ",$S(PSGDO]"":PSGDO_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",42,0)
 I X=""&(PSGDO]"") S X=PSGDO
"RTN","PSGOE9",43,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="")&(PSGDO']"") W $C(7),"    (Required) " G A109
"RTN","PSGOE9",44,0)
 I $$CHECK^PSGOE8(PSJSYSP)&(X="@") W $C(7),"  (Required)" G A109
"RTN","PSGOE9",45,0)
 I '$$CHECK^PSGOE8(PSJSYSP)&(X="@") S PSGDO="" G DONE
"RTN","PSGOE9",46,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",47,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A109
"RTN","PSGOE9",48,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSGOE9",49,0)
 I $S(X?.E1C.E:1,$L(X)>20:1,X="":0,X["^":1,X?1.P:1,1:X=+X) W $C(7),"  ",$S(X?1.P!(X=""):"(Required)",1:"??") D ENHLP^PSGOEM(55.06,109) G A109
"RTN","PSGOE9",50,0)
 S PSGDO=X G DONE
"RTN","PSGOE9",51,0)
 ;
"RTN","PSGOE9",52,0)
3 ; med route
"RTN","PSGOE9",53,0)
 S MSG=0,PSGF2=3 S:PSGOEEF(PSGF2) BACK="3^PSGOE9"
"RTN","PSGOE9",54,0)
A3 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",55,0)
 . W !!?5,"Med Route may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",56,0)
 W !,"MED ROUTE: ",$S(PSGMR:PSGMRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",57,0)
 I X="",PSGMR S X=PSGMRN I PSGMR'=PSGMRN,$D(^PS(51.2,PSGMR,0)) W "  "_$P(^(0),"^",3) G DONE
"RTN","PSGOE9",58,0)
 I $S(X="@":1,X]"":0,1:'PSGMR) W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,3) G A3
"RTN","PSGOE9",59,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,3)
"RTN","PSGOE9",60,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A3
"RTN","PSGOE9",61,0)
 K DIC S DIC="^PS(51.2,",DIC(0)="EMQZ",DIC("S")="I $P(^(0),""^"",4)" D ^DIC K DIC I Y'>0 G A3
"RTN","PSGOE9",62,0)
 S PSGMR=+Y,PSGMRN=Y(0,0) G DONE
"RTN","PSGOE9",63,0)
 ;
"RTN","PSGOE9",64,0)
7 ; schedule type
"RTN","PSGOE9",65,0)
 S MSG=0,PSGF2=7 S:PSGOEEF(PSGF2) BACK="7^PSGOE9"
"RTN","PSGOE9",66,0)
A7 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE9",67,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE9",68,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE9",69,0)
 W !,"SCHEDULE TYPE: "_$S(PSGSTN]"":PSGSTN_"// ",1:"") R X:DTIME S X=$TR(X,"coprocf","COPROCF") I X="^"!'$T S PSGOEE=0 W $C(7) G DONE
"RTN","PSGOE9",70,0)
 I X="" W:PSGSTN]"" "  ",PSGSTN G DONE
"RTN","PSGOE9",71,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",72,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A7
"RTN","PSGOE9",73,0)
 ; I X="OC"!(X="R") S PSGST=X,$P(PSGNEDFD,"^",3)=X,PSGSTN=$S(X="R":"FILL on REQUEST",1:"ON CALL") W "  "_PSGSTN S PSGOEEF(7)="" G:X="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE9",74,0)
 F Y="C^CONTINUOUS","O^ONE TIME","OC^ON CALL","P^PRN","R^FILL on REQUEST" I $S(X=$P(Y,"^"):1,1:$P($P(Y,"^",2),X)="") W $S(X=$P(Y,"^"):"  "_$P(Y,"^",2),1:$P($P(Y,"^",2),X,2)) S PSGST=$P(Y,"^"),PSGSTN=$P(Y,"^",2),$P(PSGNEDFD,"^",3)=PSGST Q
"RTN","PSGOE9",75,0)
 E  W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,7) G A7
"RTN","PSGOE9",76,0)
 ; I PSGST="OC"!(PSGST="R") S PSGOEEF(7)="" G:PSGST="R" 26 S PSGSCH=PSGSTN,(PSGS0Y,PSGS0XT)="" G 8^PSGOE41
"RTN","PSGOE9",77,0)
 G DONE
"RTN","PSGOE9",78,0)
 ;
"RTN","PSGOE9",79,0)
26 ; schedule
"RTN","PSGOE9",80,0)
 S MSG=0,PSGF2=26 S:PSGOEEF(PSGF2) BACK="26^PSGOE9"
"RTN","PSGOE9",81,0)
A26 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE9",82,0)
 . W !!?5,"Schedule may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE9",83,0)
 W !,"SCHEDULE: ",$S(PSGSCH]"":PSGSCH_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE9",84,0)
 S:X="" X=PSGSCH,PSGSCH="" I "@"[X W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",85,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",86,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A26
"RTN","PSGOE9",87,0)
 D EN^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,26) G A26
"RTN","PSGOE9",88,0)
 S PSGSCH=X I PSGS0Y'=PSGAT S PSGAT=PSGS0Y,MSG=1 W !!,"NOTE: This change in schedule also changes the ADMIN TIMES.",! S MSG=1 D:$G(PSJNEWOE) PAUSE^VALM1
"RTN","PSGOE9",89,0)
 ;
"RTN","PSGOE9",90,0)
DONE ;
"RTN","PSGOE9",91,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE9",92,0)
 K F,F0,PSGF2 Q
"RTN","PSGOE9",93,0)
 ;
"RTN","PSGOE9",94,0)
DEL ; delete entry
"RTN","PSGOE9",95,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE9",96,0)
 Q
"RTN","PSGOE91")
0^121^B23734207
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3-ACTIVE ORDER EDIT (CONT.) ;10 JUL 96 / 7:54 AM
"RTN","PSGOE91",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,64,58,110**;16 DEC 97
"RTN","PSGOE91",3,0)
 ;
"RTN","PSGOE91",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ;
"RTN","PSGOE91",6,0)
41 ; admin times
"RTN","PSGOE91",7,0)
 S MSG=0,PSGF2=41 S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",8,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",9,0)
 . W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",10,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",11,0)
 I X="" G DONE
"RTN","PSGOE91",12,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",13,0)
 I X="@",'PSGAT!(PSGS0XT="D")!(PSGSCH["@") W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",14,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="" G DONE
"RTN","PSGOE91",15,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",16,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",17,0)
 S PSGAT=X G DONE
"RTN","PSGOE91",18,0)
 ;
"RTN","PSGOE91",19,0)
8 ; special instructions
"RTN","PSGOE91",20,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",21,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",22,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE91",23,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",24,0)
 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(55.06,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE91",25,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",26,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",27,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",28,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE91",29,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",30,0)
 Q
"RTN","PSGOE91",31,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",32,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE91",33,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",34,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",35,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",36,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",37,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",38,0)
 S PSGSI=X G DONE
"RTN","PSGOE91",39,0)
 ;
"RTN","PSGOE91",40,0)
10 ; start date/time
"RTN","PSGOE91",41,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",42,0)
A10 ;
"RTN","PSGOE91",43,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",44,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",45,0)
 K PSGSDX
"RTN","PSGOE91",46,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",47,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",48,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE91",49,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",50,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",51,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",52,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",53,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE
"RTN","PSGOE91",54,0)
 ;
"RTN","PSGOE91",55,0)
34 ; stop date
"RTN","PSGOE91",56,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",57,0)
A34 ;
"RTN","PSGOE91",58,0)
 K PSGFDX
"RTN","PSGOE91",59,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",60,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",61,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",62,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",63,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",64,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",65,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",66,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A34 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE91",67,0)
W34 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",68,0)
 ;
"RTN","PSGOE91",69,0)
 ;
"RTN","PSGOE91",70,0)
DONE ;
"RTN","PSGOE91",71,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",72,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE91",73,0)
 ;
"RTN","PSGOE91",74,0)
FF ; up-arrow to another field
"RTN","PSGOE91",75,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",76,0)
 Q
"RTN","PSGOE91",77,0)
 ;
"RTN","PSGOE91",78,0)
DEL ; delete entry
"RTN","PSGOE91",79,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",80,0)
 Q
"RTN","PSGOE92")
0^122^B22418933
"RTN","PSGOE92",1,0)
PSGOE92 ;BIR/CML3-ACTIVE ORDER EDIT (CONT.) ;27 Jan 98 / 9:32 AM
"RTN","PSGOE92",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,35,50,58,81,110**;16 DEC 97
"RTN","PSGOE92",3,0)
 ;
"RTN","PSGOE92",4,0)
 ;Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE92",5,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE92",6,0)
 ;
"RTN","PSGOE92",7,0)
1 ; provider
"RTN","PSGOE92",8,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE92"
"RTN","PSGOE92",9,0)
A1 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",10,0)
 . W !!?5,"Provider may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",11,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",12,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOE92",13,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W:0 "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) G DONE
"RTN","PSGOE92",14,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOE92",15,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE92",16,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE92",17,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE92",18,0)
 ;
"RTN","PSGOE92",19,0)
5 ; self med
"RTN","PSGOE92",20,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",21,0)
 . W !!?5,"Self Med may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",22,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE92" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=""
"RTN","PSGOE92",23,0)
A5 W !,"SELF MED: " W:PSGSM]"" $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",24,0)
 ;I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE G 6
"RTN","PSGOE92",25,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)="" G 6
"RTN","PSGOE92",26,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE92",27,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE92",28,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,5) G A5
"RTN","PSGOE92",29,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)="" G 6
"RTN","PSGOE92",30,0)
 W $C(7) D ENHLP^PSGOEM(55.06,5) G A5
"RTN","PSGOE92",31,0)
 ;
"RTN","PSGOE92",32,0)
6 ; hospital supplied self med
"RTN","PSGOE92",33,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE92"
"RTN","PSGOE92",34,0)
A6 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",35,0)
 . W !!?5,"Hospital Supplied Self Med may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",36,0)
 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE92",37,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE92",38,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE92",39,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE92",40,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,6) G A6
"RTN","PSGOE92",41,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE92",42,0)
 W $C(7) D ENHLP^PSGOEM(55.06,6) G A6
"RTN","PSGOE92",43,0)
 ;
"RTN","PSGOE92",44,0)
2 ; dispense drug multiple
"RTN","PSGOE92",45,0)
 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE92",46,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE92",47,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE92",48,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE92",PSGOEEND=1
"RTN","PSGOE92",49,0)
 NEW PSGX,PSGXX F PSGXX=0:0 S PSGX=PSGXX,PSGXX=$O(^PS(53.45,PSJSYSP,2,PSGXX)) Q:'PSGXX
"RTN","PSGOE92",50,0)
 K PSGXX
"RTN","PSGOE92",51,0)
 N DA,DIE,DR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".02//1;.03" D ^DIE
"RTN","PSGOE92",52,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE92",53,0)
 D DDOC^PSGOE82(PSGX) ;* Perform allergy/adv. reaction order checks
"RTN","PSGOE92",54,0)
 NEW PSJDOSE
"RTN","PSGOE92",55,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE92",56,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S PSGOEEF(109)=1
"RTN","PSGOE92",57,0)
 K PSGOEEND G DONE
"RTN","PSGOE92",58,0)
 ;
"RTN","PSGOE92",59,0)
15 ; comments
"RTN","PSGOE92",60,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE92",61,0)
 . W !!?5,"Comments may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE92",62,0)
 S MSG=0,PSGF2=15,BACK="15^PSGOE92",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE92",63,0)
 ;
"RTN","PSGOE92",64,0)
72 ; provider comments
"RTN","PSGOE92",65,0)
 ;S MSG=0,PSGF2=72,BACK="72^PSGOE92",DA=PSJSYSP,DR=4,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE92",66,0)
 ;
"RTN","PSGOE92",67,0)
DONE ;
"RTN","PSGOE92",68,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE92",69,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE92",70,0)
 ;
"RTN","PSGOE92",71,0)
ENFF ; up-arrow to another field
"RTN","PSGOE92",72,0)
 S Y=-1 I '$D(PSGOEEF) W $C(7),"  ??" Q
"RTN","PSGOE92",73,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE92",74,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE92",75,0)
 ;
"RTN","PSGOE92",76,0)
DEL ; delete entry
"RTN","PSGOE92",77,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE92",78,0)
 Q
"RTN","PSGOE92",79,0)
 ;
"RTN","PSGOE92",80,0)
YN ; yes/no as a set of codes
"RTN","PSGOE92",81,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE92",82,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE92",83,0)
 Q
"RTN","PSGOE92",84,0)
 ;
"RTN","PSGOE92",85,0)
F101 ;;101^PSGOE9
"RTN","PSGOE92",86,0)
F109 ;;109^PSGOE9
"RTN","PSGOE92",87,0)
F3 ;;3^PSGOE9
"RTN","PSGOE92",88,0)
F7 ;;7^PSGOE9
"RTN","PSGOE92",89,0)
PSGF26 ;;26^PSGOE9
"RTN","PSGOE92",90,0)
F41 ;;41^PSGOE91
"RTN","PSGOE92",91,0)
F8 ;;8^PSGOE91
"RTN","PSGOE92",92,0)
F10 ;;10^PSGOE91
"RTN","PSGOE92",93,0)
F34 ;;34^PSGOE91
"RTN","PSGOE92",94,0)
F1 ;;1^PSGOE92
"RTN","PSGOE92",95,0)
F5 ;;5^PSGOE92
"RTN","PSGOE92",96,0)
PSGF2 ;;2^PSGOE92
"RTN","PSGOEC")
0^45^B49394829
"RTN","PSGOEC",1,0)
PSGOEC ;BIR/CML3-CANCEL ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOEC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,58,110**;16 DEC 97
"RTN","PSGOEC",3,0)
 ;
"RTN","PSGOEC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEC",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOEC",6,0)
 ; 
"RTN","PSGOEC",7,0)
ENA ; all orders
"RTN","PSGOEC",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S CF=$P(PSJSYSP0,U,5) N ND,ND1 S ND="$D(^PS(55,PSGP,5,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)",ND1="$D(^PS(53.1,PSGDA,4)),$P(^(4),U,12),$P(^(4),U,13)"
"RTN","PSGOEC",9,0)
 F  W !!,"Do you want to ",$S(CF:"discontinue",1:"mark for discontinuation")," all of this patient's orders" S %=1 D YN^DICN Q:%  D ENCAM^PSGOEM
"RTN","PSGOEC",10,0)
 S PSGCF=0 Q:%<0  S PSGCF=1,T=$E("T",'PSJSYSU) G:%=1 ENCA F T=0:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND Q
"RTN","PSGOEC",11,0)
 E  F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 Q
"RTN","PSGOEC",12,0)
 E  G DONE
"RTN","PSGOEC",13,0)
 W !!,"SOME OR ALL OF THESE ORDERS HAVE" D ENUMK^PSGOEM Q:%'=1
"RTN","PSGOEC",14,0)
 W !!,"...a few moments, please..." S PSGAL("C")=PSJSYSU*10+21400
"RTN","PSGOEC",15,0)
 F T=PSGDT:0 S T=$O(^PS(55,PSGP,5,"AUS",T)) Q:'T  F PSGDA=0:0 S PSGDA=$O(^PS(55,PSGP,5,"AUS",T,PSGDA)) Q:'PSGDA  I @ND W "." D RS,^PSGAL5
"RTN","PSGOEC",16,0)
 F PSGDA=0:0 S PSGDA=$O(^PS(53.1,"AC",PSGP,PSGDA)) Q:'PSGDA  I @ND1 W "." D RS
"RTN","PSGOEC",17,0)
 W " . . . DONE!" G DONE
"RTN","PSGOEC",18,0)
ENCA ;
"RTN","PSGOEC",19,0)
 D NOW^%DTC S (Q1,PSGDT)=+$E(%,1,12) F  S Q1=$O(^PS(55,PSGP,5,"AUS",Q1)) Q:'Q1  F Q2=0:0 S Q2=$O(^PS(55,PSGP,5,"AUS",Q1,Q2)) Q:'Q2  I $P($G(^PS(55,PSGP,5,Q2,0)),"^",21) Q
"RTN","PSGOEC",20,0)
 E  F Q2=0:0 S Q2=$O(^PS(53.1,"AC",PSGP,Q2)) Q:'Q2  I $P($G(^PS(53.1,Q2,0)),U,21) Q
"RTN","PSGOEC",21,0)
 I  S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0!('$$REQPROV) D  G DONE
"RTN","PSGOEC",22,0)
 .W !!,$C(7),"No changes made to this order." D PAUSE^VALM1
"RTN","PSGOEC",23,0)
 S PSGALR=$S('$D(PSGALO):20,PSGALO?4N&($E(PSGALO)=1):10,1:20) I $P(PSJSYSP0,U,5) D ENHE^PSJADT0 S PSGOP=PSGP D ASET
"RTN","PSGOEC",24,0)
 F SD=PSGDT:0 S SD=$O(^PS(55,PSGP,5,"AUS",SD)) Q:'SD  F PSGORD=0:0 S PSGORD=$O(^PS(55,PSGP,5,"AUS",SD,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"A" D AC
"RTN","PSGOEC",25,0)
 D NSET S CF=$P(PSJSYSP0,U,5) F PSGORD=0:0 S PSGORD=$O(^PS(53.1,"AC",PSGP,PSGORD)) Q:'PSGORD  S PSGORD=+PSGORD_"N" D NC
"RTN","PSGOEC",26,0)
 W " . . . DONE!" K PSGORD G DONE
"RTN","PSGOEC",27,0)
ENO(PSGP,PSGORD) ; single order
"RTN","PSGOEC",28,0)
 I PSGSTAT="D" W !,"This order has already been DISCONTINUED." D PAUSE^VALM1 Q
"RTN","PSGOEC",29,0)
 S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))
"RTN","PSGOEC",30,0)
 S PSJCOM=+$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSGORD,.2)),"^",8))
"RTN","PSGOEC",31,0)
 I 'CF,PSJCOM W !!,"This order is part of a complex order and CANNOT be marked for discontinuation." Q
"RTN","PSGOEC",32,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOEC",33,0)
 F  W !!,"Do you want to ",$S(PSJCOM:"discontinue this series of complex orders",CF:"discontinue this order",1:"mark this order for discontinuation") S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSGOEC",34,0)
 I %<0 S VALMBCK="" Q
"RTN","PSGOEC",35,0)
 G:%=1 SOC I $S(PSGORD["U":$D(^PS(55,PSGP,5,+PSGORD,4)),1:$D(^PS(53.1,+PSGORD,4))),$P(^(4),U,12) W !!,"THIS ORDER HAS"
"RTN","PSGOEC",36,0)
 I  D ENUMK^PSGOEM I %=1 W "..." K DA S:PSGORD["A" PSGAL("C")=PSJSYSU*10+21400,DA=+PSGORD,DA(1)=PSGP D RS,^PSGAL5:PSGORD["A" W " . . . DONE!"
"RTN","PSGOEC",37,0)
 G DONE
"RTN","PSGOEC",38,0)
SOC ;
"RTN","PSGOEC",39,0)
 I 'CF,'$P($S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,0)),1:$G(^PS(53.1,+PSGORD,0))),U,21) W !!,"...one moment, please..."
"RTN","PSGOEC",40,0)
 E  I CF S PSJNOO=$$ENNOO^PSJUTL5("D") I PSJNOO<0 D ABORT^PSGOEE G DONE
"RTN","PSGOEC",41,0)
 ; prompt for requesting provider
"RTN","PSGOEC",42,0)
 I CF,'$$REQPROV D ABORT^PSGOEE G DONE
"RTN","PSGOEC",43,0)
 K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,DA=+PSGORD,DA(1)=PSGP
"RTN","PSGOEC",44,0)
 I 'PSJCOM D
"RTN","PSGOEC",45,0)
 .I PSGORD["U" D ASET:CF,AC
"RTN","PSGOEC",46,0)
 .I PSGORD'["U" D NSET:CF,NC
"RTN","PSGOEC",47,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSGOEC",48,0)
 . I PSGORD["P" Q:('$$LOCK^PSJOEA(PSGP,PSJCOM))  D 
"RTN","PSGOEC",49,0)
 .. N O S O="" F  S O=$O(^PS(53.1,"ACX",PSJCOM,O)) Q:O=""  S (PSGORD,PSJORD)=O_"P" D NSET,NC
"RTN","PSGOEC",50,0)
 .I PSGORD["U" N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSGOEC",51,0)
 .. Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOEC",52,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOEC",53,0)
 . I OO["V" S ON55=OO D D1^PSIVOPT2 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3) D
"RTN","PSGOEC",54,0)
 .. D LOG^PSIVORAL N PSJORD S PSJORD=ON55,P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),P("NAT")=PSJNOO D HL^PSIVORA
"RTN","PSGOEC",55,0)
 . I OO["U" N PSGORD,PSJORD S (PSGORD,PSJORD)=OO D ASET^PSGOEC,AC^PSGOEC
"RTN","PSGOEC",56,0)
 Q
"RTN","PSGOEC",57,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSGOEC",58,0)
 D NOW^%DTC S NSTOP=+$E(%,1,12),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSGOEC",59,0)
 S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR="109////"_NSTOP_$S('$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7):";116////"_STP,1:"")_";100///D;.03////"_NSTOP,PSIVACT=1 D ^DIE
"RTN","PSGOEC",60,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSGOEC",61,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSGOEC",62,0)
 Q
"RTN","PSGOEC",63,0)
OUT ;
"RTN","PSGOEC",64,0)
 W $S(PSJCOM:"...ORDER ",1:"...ORDERS "),$S(CF:"DISCONTINUED!",1:"MARKED!") S PSGCANFL=1
"RTN","PSGOEC",65,0)
DONE ;
"RTN","PSGOEC",66,0)
 K CF,DA,DIE,DP,DR,ORIFN,ORETURN,PSGAL,PSGALR,PSGDA,SD,ST,T,UCF,Y Q
"RTN","PSGOEC",67,0)
ASET ;
"RTN","PSGOEC",68,0)
 S DIE="^PS(55,"_PSGP_",5,",DR="28////"_$S($P($G(^PS(55,PSGP,5,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_";Q;34////"_PSGDT_$S(T]"":";49////1",1:"")
"RTN","PSGOEC",69,0)
 Q
"RTN","PSGOEC",70,0)
NSET ;
"RTN","PSGOEC",71,0)
 S DIE="^PS(53.1,",DR="28////"_$S($P($G(^PS(53.1,+$G(PSJORD),0)),U,27)="E":"DE",$D(PSGEDIT):"DE",1:"D")_$S(T]"":";42////1",1:"")_";25////"_PSGDT Q
"RTN","PSGOEC",72,0)
AC ;
"RTN","PSGOEC",73,0)
 I 'CF K DA S $P(^PS(55,PSGP,5,+PSGORD,4),U,11,14)="^1^"_DUZ_U_PSGDT,PSGAL("C")=13040,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5
"RTN","PSGOEC",74,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",75,0)
 Q:'CF  K DA,ORIFN S PSGAL("C")=PSJSYSU*10+4000,DA=+PSGORD,DA(1)=PSGP D ^PSGAL5 S $P(^(2),U,3)=$P(^PS(55,PSGP,5,+PSGORD,2),U,4) D ^DIE S ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSGOEC",76,0)
 I PSJSYSL K DA S $P(^PS(55,PSGP,5,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD,DA(1)=PSGP D ENL^PSGVDS
"RTN","PSGOEC",77,0)
 S ORIFN=$P($G(^PS(55,PSGP,5,+PSGORD,0)),U,21) D:ORIFN DCOR^PSGOECS
"RTN","PSGOEC",78,0)
 Q
"RTN","PSGOEC",79,0)
NC ;
"RTN","PSGOEC",80,0)
 I 'CF S $P(^PS(53.1,+PSGORD,4),"^",11,14)="^1^"_DUZ_U_PSGDT
"RTN","PSGOEC",81,0)
 I 'CF,$D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOEC",82,0)
 Q:'CF  S PSGSTAT=$P($G(^PS(53.1,+PSGORD,0)),U,9),PSGORIFN=$P($G(^(0)),U,21)
"RTN","PSGOEC",83,0)
 I PSGSTAT'="U" K DA,ORIFN S DA=+PSGORD D ^DIE I PSJSYSL,PSJSYSL<3,(PSGSTAT'="P") S $P(^PS(53.1,+PSGORD,7),U,1,2)=PSGDT_U_$S($D(PSGEDIT):"DE",1:"D"),PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOEC",84,0)
 I PSGSTAT="U" K DA S DA=+PSGORD,DIK="^PS(53.1," D ^DIK
"RTN","PSGOEC",85,0)
 I PSGORIFN S ORIFN=PSGORIFN D DCOR^PSGOECS
"RTN","PSGOEC",86,0)
 Q
"RTN","PSGOEC",87,0)
T ;
"RTN","PSGOEC",88,0)
 F  W !!,"Is this due to the patient being transferred" S %=2 D YN^DICN Q:%  D ENCTM^PSGOEM1
"RTN","PSGOEC",89,0)
 S T=$S(%<0:"^",1:$E("T",%=1)) Q
"RTN","PSGOEC",90,0)
RS ;
"RTN","PSGOEC",91,0)
 ; naked ref below is from variable ND1, ^PS(53.1,PSGDA,4)
"RTN","PSGOEC",92,0)
 S $P(^(4),U,11,14)="^^^" Q
"RTN","PSGOEC",93,0)
 ;
"RTN","PSGOEC",94,0)
REQPROV()          ;
"RTN","PSGOEC",95,0)
 K PSJDCPRV,DIC,DUOUT,DTOUT,Y
"RTN","PSGOEC",96,0)
 N PROVIDER,PROVNAME,RESULT,RSB S RESULT=0
"RTN","PSGOEC",97,0)
 S PROVIDER=+$P($G(^PS(55,DFN,5.1)),"^",2),PROVNAME=""
"RTN","PSGOEC",98,0)
 I PROVIDER>0 D
"RTN","PSGOEC",99,0)
 .S DIC=200,DR="53.1;53.4",DIQ="RSB",DIQ(0)="I",DA=PROVIDER D EN^DIQ1
"RTN","PSGOEC",100,0)
 .K DIC,DR,DA,DIQ
"RTN","PSGOEC",101,0)
 .I $G(RSB(200,PROVIDER,53.1,"I"))="1"&(($G(RSB(200,PROVIDER,53.4,"I"))="")!($G(RSB(200,PROVIDER,53.4,"I"))>DT)) D
"RTN","PSGOEC",102,0)
 ..S DIC=200,DA=PROVIDER,DR=".01",DIQ="RSB",DIQ(0)="E" D EN^DIQ1
"RTN","PSGOEC",103,0)
 ..S PROVNAME=$G(RSB(200,PROVIDER,.01,"E")) K DA,DIQ,DR
"RTN","PSGOEC",104,0)
 K DIC S DIC=200,DIC(0)="AEMQZ"
"RTN","PSGOEC",105,0)
 S:PROVNAME]"" DIC("B")=PROVNAME
"RTN","PSGOEC",106,0)
 S DIC("A")="Requesting PROVIDER: "
"RTN","PSGOEC",107,0)
 S DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC
"RTN","PSGOEC",108,0)
 I +Y>0,'$D(DUOUT),'$D(DTOUT) S RESULT=1,PSJDCPRV=+Y
"RTN","PSGOEC",109,0)
 Q RESULT
"RTN","PSGOECS")
0^46^B43208185
"RTN","PSGOECS",1,0)
PSGOECS ;BIR/CML3-CANCEL SELECTED ORDERS ;02 Mar 99 / 9:29 AM
"RTN","PSGOECS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,29,44,58,81,110**;16 DEC 97
"RTN","PSGOECS",3,0)
 ;
"RTN","PSGOECS",4,0)
 ; Reference to FULL^VALM1 is supported by DBIA# 10116.
"RTN","PSGOECS",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOECS",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSGOECS",7,0)
 ;
"RTN","PSGOECS",8,0)
AM ;
"RTN","PSGOECS",9,0)
 W !,"...marking ",$P(X,U),"..." S $P(^PS(55,PSGP,5,DA,4),"^",11,14)="^1^"_DUZ_"^"_PSGDT,PSGAL("C")=13040 W "." D ^PSGAL5 W "."
"RTN","PSGOECS",10,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="C",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOECS",11,0)
 Q
"RTN","PSGOECS",12,0)
 ;
"RTN","PSGOECS",13,0)
NM ;
"RTN","PSGOECS",14,0)
 W !,"...marking ",$P(X,U),"..." S $P(^PS(53.1,DA,4),"^",11,14)="^1^"_DUZ_"^"_PSGDT W "."
"RTN","PSGOECS",15,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"N",PSGPOSD=PSGDT,PSGPOSA="C" D ENPOS^PSGVDS
"RTN","PSGOECS",16,0)
 Q
"RTN","PSGOECS",17,0)
 ;
"RTN","PSGOECS",18,0)
AC ; discontinue active order
"RTN","PSGOECS",19,0)
 K DA S DA(1)=PSGP,DA=+PSGORD
"RTN","PSGOECS",20,0)
 S X=$G(^PS(55,PSGP,5,DA,.2))
"RTN","PSGOECS",21,0)
 I $P(X,U,4)="D" W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),U,1),!,"NO ACTION WAS TAKEN ON DONE ORDER",!,$C(7) HANG 1 Q 
"RTN","PSGOECS",22,0)
 NEW XX S XX=$P(^PS(55,PSGP,5,DA,0),U,9)
"RTN","PSGOECS",23,0)
 I $S(XX="E":1,XX="D":1,XX="DE":1,1:0) W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),U,1),!,"NO ACTION WAS TAKEN ON "_$$CODES^PSIVUTL(XX,55.06,28)_" ORDER",!,$C(7) HANG 1 Q
"RTN","PSGOECS",24,0)
 S X=$$DRUGNAME^PSJLMUTL(PSGP,PSGORD)
"RTN","PSGOECS",25,0)
 I '$P(PSJSYSP0,"^",5) D AM Q
"RTN","PSGOECS",26,0)
 W !,"...discontinuing ",$P(X,U),"...",! S PSGAL("C")=PSJSYSU*10+4000 D ^PSGAL5
"RTN","PSGOECS",27,0)
 S PSGALR=20,DIE="^PS(55,"_PSGP_",5,",DR="28////D;Q;34////"_PSGDT_$S(PSJSYSU:"",1:";49////1"),DP=55.06,$P(^(2),"^",3)=$P(^PS(55,PSGP,5,DA,2),"^",4) D ^DIE S ^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOECS",28,0)
 D EN1^PSJHL2(PSGP,"OD",PSGORD) S DA(1)=PSGP,DA=+PSGORD
"RTN","PSGOECS",29,0)
 I PSJSYSL S $P(^PS(55,PSGP,5,DA,7),"^",1,2)=PSGDT_"^D",PSGTOL=2,PSGUOW=DUZ,PSGTOO=1 D ENL^PSGVDS
"RTN","PSGOECS",30,0)
 Q
"RTN","PSGOECS",31,0)
 ;
"RTN","PSGOECS",32,0)
NC ; discontinue non-verifed order
"RTN","PSGOECS",33,0)
 K DA S DA=+PSGORD,X=$G(^PS(53.1,DA,.2)),X=$$DRUGNAME^PSJLMUTL(PSGP,PSGORD)
"RTN","PSGOECS",34,0)
 I $S($P(PSJSYSP0,"^",5):0,'$D(^PS(53.1,DA,4)):1,1:$P(^(4),"^",7)'=DUZ) D NM Q
"RTN","PSGOECS",35,0)
 W !,"...discontinuing ",$P(X,U),"...",! S DIE="^PS(53.1,",DR="28////D"_$S(PSJSYSU:"",1:";42////1") D ^DIE
"RTN","PSGOECS",36,0)
 D EN1^PSJHL2(PSGP,"OC",PSGORD)
"RTN","PSGOECS",37,0)
 S DA=+PSGORD I PSJSYSL,PSJSYSL<3 S $P(^PS(53.1,DA,7),"^",1,2)=PSGDT_"^D",PSGTOO=2,PSGUOW=DUZ,PSGTOL=2 D ENL^PSGVDS
"RTN","PSGOECS",38,0)
 Q
"RTN","PSGOECS",39,0)
 ;
"RTN","PSGOECS",40,0)
EN ; enter here
"RTN","PSGOECS",41,0)
 I $G(PSJIVPRF) D ^PSIVSPDC Q  ;Use for Speed DC in IV Order Profile
"RTN","PSGOECS",42,0)
 D FULL^VALM1
"RTN","PSGOECS",43,0)
EN1 ;
"RTN","PSGOECS",44,0)
 S (PSGONC,PSGLMT)=PSJOCNT,PSGONW="C" D ENWO^PSGON I "^"[X K X G RESET
"RTN","PSGOECS",45,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSGOECS",46,0)
 W ! F PSGOECS=1:1:PSGODDD F PSGOECS1=1:1 S PSGOECS2=$P(PSGODDD(PSGOECS),",",PSGOECS1) Q:'PSGOECS2  D
"RTN","PSGOECS",47,0)
 .S PSGORD=^TMP("PSJON",$J,PSGOECS2) ; I $P($G(@($S((PSGORD["A")!(PSGORD["U"):"^PS(55,"_PSGP_",5,",(PSGORD["V"):"^PS(55,"_PSGP_",""IV"",",1:"^PS(53.1,")_(+PSGORD)_",0)")),"^",21) Q
"RTN","PSGOECS",48,0)
 S PSJNOO=$$ENNOO^PSJUTL5("D") G:PSJNOO<0 EN1
"RTN","PSGOECS",49,0)
 ;Prompt for requesting provider
"RTN","PSGOECS",50,0)
 W ! I '$$REQPROV^PSGOEC G EN1
"RTN","PSGOECS",51,0)
 W !
"RTN","PSGOECS",52,0)
 ;
"RTN","PSGOECS",53,0)
 ;F PSGOECS=1:1:PSGODDD F PSGOECS1=1:1 S PSGOECS2=$P(PSGODDD(PSGOECS),",",PSGOECS1) Q:'PSGOECS2  S (ON,PSGORD)=^TMP("PSJON",$J,PSGOECS2) D:(PSGORD["U") AC D:(PSGORD["P") NC D:(PSGORD["V") SPDCIV^PSIVSPDC
"RTN","PSGOECS",54,0)
 ;Replaced above line with block structure below.
"RTN","PSGOECS",55,0)
 N COMFLG,PSJCOM S (EXITLOOP,PSJCOM)=0
"RTN","PSGOECS",56,0)
 F PSGOECS=1:1:PSGODDD D
"RTN","PSGOECS",57,0)
 .F PSGOECS1=1:1 D  Q:EXITLOOP=1
"RTN","PSGOECS",58,0)
 ..S PSGOECS2=$P(PSGODDD(PSGOECS),",",PSGOECS1)
"RTN","PSGOECS",59,0)
 ..I 'PSGOECS2 S EXITLOOP=1 Q
"RTN","PSGOECS",60,0)
 ..S (ON,PSGORD)=^TMP("PSJON",$J,PSGOECS2)
"RTN","PSGOECS",61,0)
 ..I PSGORD=+PSGORD D DCCOM Q
"RTN","PSGOECS",62,0)
 ..I '$$LS^PSSLOCK(DFN,PSGORD) D  Q
"RTN","PSGOECS",63,0)
 ... W:PSGORD'["V" !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),"^",1),!,"NO ACTION WAS TAKEN",!,$C(7) HANG 1 Q
"RTN","PSGOECS",64,0)
 ... W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D  W !,"NO ACTION WAS TAKEN",!,$C(7) HANG 1
"RTN","PSGOECS",65,0)
 ....F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",66,0)
 .....W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",67,0)
 ..D CHKCOM I COMFLG  D
"RTN","PSGOECS",68,0)
 ... I PSGORD'["V" W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),"^",1),!,"NO ACTION WAS TAKEN",!,$C(7) HANG 1 Q
"RTN","PSGOECS",69,0)
 ... W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D  W !,"NO ACTION WAS TAKEN",!,$C(7) HANG 1
"RTN","PSGOECS",70,0)
 ....F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",71,0)
 .....W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",72,0)
 ..Q:PSJCOM
"RTN","PSGOECS",73,0)
 ..D:(PSGORD["U") AC
"RTN","PSGOECS",74,0)
 ..D:(PSGORD["P") NC
"RTN","PSGOECS",75,0)
 ..D:(PSGORD["V") SPDCIV^PSIVSPDC
"RTN","PSGOECS",76,0)
 ..; Call the unlock procedure
"RTN","PSGOECS",77,0)
 ..D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOECS",78,0)
 S X=""
"RTN","PSGOECS",79,0)
RESET ;
"RTN","PSGOECS",80,0)
 I $G(PSGORD)["V" D INIT^PSJLMHED(3) S VALMBK="R" G DONE
"RTN","PSGOECS",81,0)
 D INIT^PSJLMHED(1) S VALMBCK="R"
"RTN","PSGOECS",82,0)
 ;
"RTN","PSGOECS",83,0)
DONE ;
"RTN","PSGOECS",84,0)
 K DA,DIE,DP,DR,PSGAL,PSGALR,PSGLMT,PSGODDD,PSGOECS,PSGOECS1,PSGOECS2,PSGONW,PSGORD,PSGPOSA,PSGPOSD,PSGTOL,PSGTOO,PSGUOW,ORIFN,ORETURN,ORNATR
"RTN","PSGOECS",85,0)
 Q
"RTN","PSGOECS",86,0)
 ;
"RTN","PSGOECS",87,0)
DCOR ; Create DC order/update stop date in OE/RR.
"RTN","PSGOECS",88,0)
 S PSOC=$S(PSGORD["P":"OC",PSGORD["N":"OC",1:"OD")
"RTN","PSGOECS",89,0)
 D EN1^PSJHL2(PSGP,PSOC,PSGORD)
"RTN","PSGOECS",90,0)
 Q
"RTN","PSGOECS",91,0)
 ;
"RTN","PSGOECS",92,0)
ENOR ;
"RTN","PSGOECS",93,0)
 K DA S PSGEDIT=$S($D(PSGEDIT):PSGEDIT,1:"D"),CF=1,PSGALR=20,DA=+PSGORD,T="" I PSGORD'["U",(PSGORD'["O") D:CF NSET^PSGOEC D NC^PSGOEC D ENOR2 G DONE^PSGOEC
"RTN","PSGOECS",94,0)
 S DA(1)=PSGP D:CF ASET^PSGOEC D AC^PSGOEC
"RTN","PSGOECS",95,0)
 G DONE^PSGOEC
"RTN","PSGOECS",96,0)
 ;
"RTN","PSGOECS",97,0)
ENOR2 ;Check to see if order being DC'd is a Pending Renewal and is being DC'd due to edit.
"RTN","PSGOECS",98,0)
 I PSGEDIT="DE",$P(^PS(53.1,+PSGORD,0),U,25),$P(^PS(53.1,+PSGORD,0),U,24)="R",PSGSD<$P($G(^PS(55,PSGP,5,+$P(^PS(53.1,+PSGORD,0),U,25),2)),U,4) D
"RTN","PSGOECS",99,0)
 .K DA,DR S DA(1)=PSGP,DA=+$P(^PS(53.1,+PSGORD,0),U,25),DIE="^PS(55,"_PSGP_",5,",DR="34////"_PSGSD_";25////"_$P($G(^PS(55,PSGP,5,+$P(^PS(53.1,+PSGORD,0),U,25),2)),U,4)
"RTN","PSGOECS",100,0)
 .D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(^PS(53.1,+PSGORD,0),U,25))
"RTN","PSGOECS",101,0)
 Q
"RTN","PSGOECS",102,0)
 ;
"RTN","PSGOECS",103,0)
CHKCOM ;Check to see if order is part of complex order series.
"RTN","PSGOECS",104,0)
 S PSJCOM=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,.2)),U,8),PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8),1:$P($G(^PS(53.1,+PSGORD,.2)),U,8)),COMFLG=0
"RTN","PSGOECS",105,0)
 N PSJSTAT S PSJSTAT=$S(PSGORD["V":$P($G(^PS(55,PSGP,"IV",+PSGORD,0)),"^",17),PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",9),1:$P($G(^PS(53.1,+PSGORD,0)),"^",9))
"RTN","PSGOECS",106,0)
 Q:'PSJCOM  I "DE"[PSJSTAT Q
"RTN","PSGOECS",107,0)
 W ! I PSGORD["V" N PSJLINE S PSJLINE=1 D DSPLORDV^PSJLMUT1(PSGP,PSGORD) D
"RTN","PSGOECS",108,0)
 .F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSGOECS",109,0)
 ..W !,$G(PSJOC(ON,X))
"RTN","PSGOECS",110,0)
 I PSGORD["U" W !,$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^",1) D
"RTN","PSGOECS",111,0)
 .W !!,"is part of a complex order. If you discontinue this order the following orders",!,"will be discontinued too (unless the stop date has already been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSGOECS",112,0)
 F  W !!,"Do you want to discontinue this series of complex orders" S %=1 D YN^DICN Q:%
"RTN","PSGOECS",113,0)
 I %'=1 S COMFLG=1 Q
"RTN","PSGOECS",114,0)
 N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D  Q:COMFLG
"RTN","PSGOECS",115,0)
 .Q:OO=PSGORD  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSGOECS",116,0)
 Q:COMFLG
"RTN","PSGOECS",117,0)
 N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSGOECS",118,0)
 .I (OO["U") N PSGORD S PSGORD=OO D AC
"RTN","PSGOECS",119,0)
 .I (OO["V") N PSGORD S (ON,PSGORD)=OO D SPDCIV^PSIVSPDC
"RTN","PSGOECS",120,0)
 .D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOECS",121,0)
 Q
"RTN","PSGOECS",122,0)
 ;
"RTN","PSGOECS",123,0)
DCCOM ;DC pending/non-verified complex order
"RTN","PSGOECS",124,0)
 I '$$LOCK^PSJOEA(DFN,PSGORD) W !,"Order # ",PSGOECS2," could not be discontinued.",!,$C(7) HANG 1 Q
"RTN","PSGOECS",125,0)
 N PSGORD1 S PSGORD1=PSGORD
"RTN","PSGOECS",126,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSGORD1,PSJO)) Q:'PSJO  S PSGORD=PSJO_"P" D NC
"RTN","PSGOECS",127,0)
 Q
"RTN","PSGOEE")
0^47^B61389262
"RTN","PSGOEE",1,0)
PSGOEE ;BIR/CML3-EDIT ACTIVE OR NON-VERIFIED ORDERS ;01 May 98 / 8:44 AM
"RTN","PSGOEE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,7,29,47,64,58,82,91,110**;16 DEC 97
"RTN","PSGOEE",3,0)
 ;
"RTN","PSGOEE",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOEE",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA# 2789.
"RTN","PSGOEE",6,0)
 ; Reference to ^%RCR is supported by DBIA# 10022.
"RTN","PSGOEE",7,0)
 ;
"RTN","PSGOEE",8,0)
 D NOW^%DTC S PSGDT=% K PSGEFN,PSGOEEF S PSGOEEF=0 I PSGORD["A"!(PSGORD["O") G ACT
"RTN","PSGOEE",9,0)
531 ; edit orders in 53.1
"RTN","PSGOEE",10,0)
ENF ;
"RTN","PSGOEE",11,0)
 D EN2^PSGOEEW
"RTN","PSGOEE",12,0)
 K PSJACEPT D EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",13,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",14,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",15,0)
 E  D
"RTN","PSGOEE",16,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",17,0)
 I $G(PSGOEAV) D ACT1 Q
"RTN","PSGOEE",18,0)
 D DONE1
"RTN","PSGOEE",19,0)
 S PSGOEEF=0,PSJORD=PSGORD D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD)
"RTN","PSGOEE",20,0)
 Q
"RTN","PSGOEE",21,0)
ACT ;
"RTN","PSGOEE",22,0)
 D EN2^PSGOEEW,EDLOOP G:'$G(PSJACEPT) OUT
"RTN","PSGOEE",23,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",24,0)
 . N PSGOEENO S PSGOEENO=1 D NEW
"RTN","PSGOEE",25,0)
 E  D
"RTN","PSGOEE",26,0)
 . N PSGOEENO S PSGOEENO=0 D UPD
"RTN","PSGOEE",27,0)
 S:$D(PSGOEF)!$G(PSGOEENO) PSGCANFL=-1
"RTN","PSGOEE",28,0)
ACT1 ;I 'PSGOEAV,PSJSYSL>1 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",29,0)
 D DONE1
"RTN","PSGOEE",30,0)
 S PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD) D:PSGOEAV UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEE",31,0)
 Q
"RTN","PSGOEE",32,0)
EDIT ;
"RTN","PSGOEE",33,0)
 D FULL^VALM1
"RTN","PSGOEE",34,0)
 W ! S PSGOEER="" F Q=1:1 S Q1=$P(Y,",",Q) Q:'Q1  S X=$P($T(@(PSGOEEG_Q1)),";",3),PSGOEER=PSGOEER_X_";",PSGOEEF(+X)=Q
"RTN","PSGOEE",35,0)
 S LIMIT=$L(PSGOEER,";")-1,(PSGDEF,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>LIMIT  I +$P(PSGOEER,";",PSGOEE)=101 S PSGDEF=1
"RTN","PSGOEE",36,0)
 S PSGOEER=$E(PSGOEER,1,$L(PSGOEER)-1),(MSG,PSGOEE)=0 F  S PSGOEE=PSGOEE+1 Q:PSGOEE>$L(PSGOEER,";")  S F1=$S(PSGOEEG=3:53.1,1:55.06) I 'PSGDEF!((PSGDEF)&(+$P(PSGOEER,";",PSGOEE)'=2)) D @$P(PSGOEER,";",PSGOEE) Q:'PSGOEE
"RTN","PSGOEE",37,0)
 Q
"RTN","PSGOEE",38,0)
EDLOOP ; Continue prompting for fields to edit.
"RTN","PSGOEE",39,0)
 D:$G(Y) EDIT
"RTN","PSGOEE",40,0)
 D ENNOU^PSGOEE0 I '$G(PSGOEENO),DR="" S VALMBCK="R" Q
"RTN","PSGOEE",41,0)
 K VALMSG
"RTN","PSGOEE",42,0)
 I '$G(PSGOEENO),$G(PSGPDNX) D CKDT
"RTN","PSGOEE",43,0)
 I $G(PSGOEENO) D
"RTN","PSGOEE",44,0)
 .S VALMSG="This change will cause a new order to be created." D GTSTATUS,CHKDD,CKDT
"RTN","PSGOEE",45,0)
 .S PSGEBN=$$ENNPN^PSGMI(DUZ),PSGLIN=$$ENDD^PSGMI(PSGDT)_U_$$ENDTC^PSGMI(PSGDT)
"RTN","PSGOEE",46,0)
 D CHK^PSGOEV("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGSD_"^^"_PSGFD)
"RTN","PSGOEE",47,0)
 K VALMBCK,PSJACEPT,PSGPDNX D EN^VALM("PSJU LM ACCEPT") Q:'$G(PSJACEPT)
"RTN","PSGOEE",48,0)
 I $G(PSGOEENO) S PSJNOO=$$ENNOO^PSJUTL5("E")
"RTN","PSGOEE",49,0)
 D K1 S PSJACEPT=$S($G(PSJNOO)<0:0,1:1)
"RTN","PSGOEE",50,0)
 S VALMBCK=$S('PSJACEPT:"R",'PSGOEAV:"R",1:"Q")
"RTN","PSGOEE",51,0)
 Q
"RTN","PSGOEE",52,0)
CHKDD ;*** Check inactive Dispense drug within the order.
"RTN","PSGOEE",53,0)
 D CHKDRG^PSGOE2
"RTN","PSGOEE",54,0)
 Q
"RTN","PSGOEE",55,0)
CKDT ; Check if new start/stop dates should be calculated.
"RTN","PSGOEE",56,0)
 S PSGS0Y=$S($D(PSGS0Y):PSGS0Y,1:$G(PSGAT))
"RTN","PSGOEE",57,0)
 I ('$G(PSGNEWDT)&(PSGSD=$G(PSGOSD))&(PSGFD=$G(PSGOFD)))!($G(PSGOST)'=PSGST)!(PSGSCH'=$G(PSGOSCH))!($G(PSGPDNX)) D
"RTN","PSGOEE",58,0)
 .N PSGOES S PSGOES=1,PSGOFD=PSGFD D ^PSGNE3 S PSGSD=PSGNESD,PSGSDN=$$ENDD^PSGMI(PSGNESD)_U_$$ENDTC^PSGMI(PSGNESD),PSGFD=PSGNEFD,PSGFDN=$$ENDD^PSGMI(PSGNEFD)_U_$$ENDTC^PSGMI(PSGNEFD),PSGNEWDT=1
"RTN","PSGOEE",59,0)
 .I $D(PSGOFD),PSGOFD]"",PSGFD'=PSGOFD S PSGOEEF(25)=1
"RTN","PSGOEE",60,0)
 .I $D(PSGOSD),PSGOSD]"",PSGSD'=PSGOSD S PSGOEEF(10)=1
"RTN","PSGOEE",61,0)
 Q
"RTN","PSGOEE",62,0)
NEW3 ;
"RTN","PSGOEE",63,0)
 ;S:PSGOEAV PSGOEAV="0^1"
"RTN","PSGOEE",64,0)
NEW ;
"RTN","PSGOEE",65,0)
 W !,"...discontinuing original order..."
"RTN","PSGOEE",66,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D NEW^PSJCOM1 Q
"RTN","PSGOEE",67,0)
 ;DC and Unlock order.
"RTN","PSGOEE",68,0)
 S PSGEDIT="DE" D ENOR^PSGOECS,UNL^PSSLOCK(PSGP,PSGORD) K PSGEDIT
"RTN","PSGOEE",69,0)
 W !!," ...creating new order..." W:'PSGOEAV "(you will now work on this new order)"
"RTN","PSGOEE",70,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSGOEE",71,0)
 S PSGOORD=PSGORD D ^PSGOETO K PSGOEOS
"RTN","PSGOEE",72,0)
 I PSGOORD["U" S $P(^PS(55,PSGP,5,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",73,0)
 E  S $P(^PS(53.1,+PSGOORD,0),"^",26,27)=PSGORD_"^E"
"RTN","PSGOEE",74,0)
 N CLINAPPT S CLINAPPT=$S(PSGOORD["U":$G(^PS(55,PSGP,5,+PSGOORD,8)),PSGOORD["P":$G(^PS(53.1,+PSGOORD,"DSS")),1:"") I CLINAPPT D
"RTN","PSGOEE",75,0)
 .N DIE,DA,DR
"RTN","PSGOEE",76,0)
 .I PSGORD["U" S DIE="^PS(55,"_PSGP_",5,",DA=+PSGORD,DA(1)=PSGP,DR="130////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"131////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOEE",77,0)
 .I PSGORD["P" S DIE="^PS(53.1,",DA=+PSGORD,DR="113////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"126////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOEE",78,0)
 .I $G(DR) D ^DIE
"RTN","PSGOEE",79,0)
 I 'PSGOEAV,($G(PSGORD)["P"),'$G(^PS(53.1,+PSGORD,2.5)),$G(^PS(53.1,+PSGORD,0)) D
"RTN","PSGOEE",80,0)
 . N DUR S DUR=$$GETDUR^PSJLIVMD(PSGP,PSGORD,$S(PSGORD["P":"P",1:5),1) I DUR]"" K DA,DR,DIE S DIE="^PS(53.1,",DA=+PSGORD,DR="116////"_DUR D ^DIE
"RTN","PSGOEE",81,0)
 I PSGOEAV,+PSJSYSU=3,'$D(PSGOES) D EN^PSGPEN(PSGORD),UNL^PSSLOCK(PSGP,PSGORD) Q
"RTN","PSGOEE",82,0)
 S PSJORD=PSGORD,PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEE",83,0)
 Q
"RTN","PSGOEE",84,0)
UPD ;
"RTN","PSGOEE",85,0)
 K DA W !!,"...updating order..."
"RTN","PSGOEE",86,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEE",87,0)
 N TMP,PSGSIF S TMP=PSGOEENO N PSGOEENO S PSGOEENO=TMP
"RTN","PSGOEE",88,0)
 N II F II=1:1:$L($G(DR),";") I $E($P($G(DR),";",II),1,7)="122////" S PSGSIF=$P(PSGSI,"^",2),PSGSI=$P(PSGSI,"^") Q
"RTN","PSGOEE",89,0)
 I $G(PSJCOM),$G(PSJCOMSI) K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSGOEE",90,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSGOEE",91,0)
 .. Q:PSJCHILD=PSGORD  N DR,DA,DIE,ORD S DR=$S(PSJCHILD["V":"31////"_$G(P("OPI")),1:"8////"_$G(PSGSI)) S DR=DR_";"_$S(PSJCHILD["V":146,1:122)_"////"_+$G(PSGSIF)
"RTN","PSGOEE",92,0)
 .. I $E(DR)'="*" S DA=+PSJCHILD,DIE=$S(PSJCHILD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "." D EN1^PSJHL2(PSGP,"XX",+PSJCHILD_"U")
"RTN","PSGOEE",93,0)
 I $E(DR)'="*" S DA=+PSGORD,DIE=$S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,") S:DIE["^PS(55," DA(1)=PSGP D ^DIE W "."
"RTN","PSGOEE",94,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."
"RTN","PSGOEE",95,0)
 S $P(@(PSGOEEWF_"1,0)"),"^",2)=$S(PSGORD["U":55.07,1:53.11)_"P"
"RTN","PSGOEE",96,0)
 ; Naked reference on the line below refers to full reference using indirection to either ^PS(55 or ^PS(53.1,
"RTN","PSGOEE",97,0)
 S ND=$G(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",0)")) I $P(ND,"^",21) S ORIFN=$P(ND,"^",21),ND1=$G(^(.2)),ND2=$G(^(2)) W !,"...updating OE/RR..." D EN1^PSJHL2(PSGP,"XX",PSGORD)
"RTN","PSGOEE",98,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V" S VALMBCK="R"
"RTN","PSGOEE",99,0)
 I PSJSYSL,PSJSYSL<3 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEE",100,0)
 Q
"RTN","PSGOEE",101,0)
OUT ;
"RTN","PSGOEE",102,0)
 D ABORT K PSGNEWDT S PSGCANFL=1 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD)
"RTN","PSGOEE",103,0)
 Q
"RTN","PSGOEE",104,0)
DONE ;
"RTN","PSGOEE",105,0)
 I PSGORD["P",'$D(PSGOEF),PSGSCH]"",$O(^PS(53.1,+PSGORD,1,0)) D ENF^PSGOEE0
"RTN","PSGOEE",106,0)
DONE1 ;
"RTN","PSGOEE",107,0)
 I PSGORD["U" S X=+PSGORD L -^PS(55,PSGP,5,X)
"RTN","PSGOEE",108,0)
 E  L -^PS(53.1,+PSGORD)
"RTN","PSGOEE",109,0)
 K ^PS(53.45,+PSJSYSP,1),^(2)
"RTN","PSGOEE",110,0)
 I '$D(PSGOEF) K PSGSD,PSGSCH,PSGST,PSGFD
"RTN","PSGOEE",111,0)
 K DA,DIE,DIR,DP,DR,DRG,ND,ND0,ND1,ND2,ORIFN,PSGAL,PSGALEF,PSGAT,PSGOEE,PSGOEEF,PSGOEEG,PSGOEEWF,PSGEFN,PSGTOL,PSGTOO,PSGUOW,XREF,PSGEFN,PSGMR,PSGMRN,PSGOROE1,PSGPD,PSGPDN,PSGSI,PSGPR,PSGSM,PSGHSM,PSGSTN,PSGSDN,PSGFDN,PSGPRN
"RTN","PSGOEE",112,0)
 K PSGDO,PSGOEENO Q
"RTN","PSGOEE",113,0)
K1 ;
"RTN","PSGOEE",114,0)
 K BACK,F1,F2,PSGF2,MSG,PSGEFN,PSGNEWDT,PSGOEEF,PSGOEEND,PSGOPD,PSGOPDN,PSGOMR,PSGOMRN,PSGOSCH,PSGOSI,PSGOPR,PSGOSM,PSGOHSM,PSGOSD,PSGOFD,PSGOST,PSGOPRN,PSGOSTN,PSGOSDN,PSGOFDN,PSGODO,PSGPDRG,PSGPDRGN,PSGOEER
"RTN","PSGOEE",115,0)
 Q
"RTN","PSGOEE",116,0)
 ;
"RTN","PSGOEE",117,0)
ABORT ; Display no change message and pause.
"RTN","PSGOEE",118,0)
 S (PSGDI,PSGDFLG)='$$DDOK^PSGOE2(PSGOEEWF_"1,",+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",119,0)
 S PSGPFLG='$$OIOK^PSGOE2(+$G(@(PSGOEEWF_".2)")))
"RTN","PSGOEE",120,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSGOEE",121,0)
 Q
"RTN","PSGOEE",122,0)
 ;
"RTN","PSGOEE",123,0)
GTSTATUS ; Determine status of new order and set LM title.
"RTN","PSGOEE",124,0)
 S PSGSTAT=$S($P($G(PSJSYSP0),U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEE",125,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S(PSGSTAT="PENDING":"("_PSGPRIO_")",1:"")
"RTN","PSGOEE",126,0)
 Q
"RTN","PSGOEE",127,0)
FIELDS ;
"RTN","PSGOEE",128,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",129,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",130,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEE",131,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",132,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEE",133,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEE",134,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",135,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",136,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEE",137,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",138,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",139,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEE",140,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEE",141,0)
51 ;;101^PSGOE9;PSGOPD;PSGPD;101;1
"RTN","PSGOEE",142,0)
52 ;;109^PSGOE9;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEE",143,0)
53 ;;10^PSGOE91;PSGOSD;PSGSD;10;1
"RTN","PSGOEE",144,0)
54 ;;3^PSGOE9;PSGOMR;PSGMR;3;1
"RTN","PSGOEE",145,0)
55 ;;34^PSGOE91;PSGOFD;PSGFD;34;1 
"RTN","PSGOEE",146,0)
56 ;;7^PSGOE9;PSGOST;PSGST;7;0
"RTN","PSGOEE",147,0)
57 ;;5^PSGOE92;PSGOSM;PSGSM;5;0
"RTN","PSGOEE",148,0)
58 ;;26^PSGOE9;PSGOSCH;PSGSCH;26;1
"RTN","PSGOEE",149,0)
59 ;;41^PSGOE91;PSGOAT;PSGAT;41;0
"RTN","PSGOEE",150,0)
510 ;;1^PSGOE92;PSGOPR;PSGPR;1;1
"RTN","PSGOEE",151,0)
511 ;;8^PSGOE91;PSGOSI;PSGSI;8;0
"RTN","PSGOEE",152,0)
512 ;;2^PSGOE92;;;2;0
"RTN","PSGOEE",153,0)
513 ;;15^PSGOE92;;;15;0
"RTN","PSGOEF")
0^48^B48487137
"RTN","PSGOEF",1,0)
PSGOEF ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR ;14 May 98 / 2:17 PM
"RTN","PSGOEF",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,30,29,35,39,47,50,56,80,116,110**;16 DEC 97
"RTN","PSGOEF",3,0)
 ;
"RTN","PSGOEF",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEF",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOEF",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000
"RTN","PSGOEF",7,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSGOEF",8,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSGOEF",9,0)
 ; Reference to ^VALM1 is supported by DBIA 10116
"RTN","PSGOEF",10,0)
 ; Reference to DOSE^PSSORPH is supported by DBIA 3234.
"RTN","PSGOEF",11,0)
 ; Reference to RE^VALM4 is supported by DBIA 10120.
"RTN","PSGOEF",12,0)
 ;
"RTN","PSGOEF",13,0)
START ;
"RTN","PSGOEF",14,0)
 I '$D(^PS(53.1,+PSGORD)) W $C(7),!?3,"Cannot find this pending order (#",+PSGORD,")." Q
"RTN","PSGOEF",15,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12) K PSGFDX,PSGEFN,PSGOEEF,PSGOES,PSGONF,PSGRDTX S PSGOES=1,(PSGOEF,PSGOEEF)=0,PSGOEEG=3
"RTN","PSGOEF",16,0)
 I $D(PSJTUD) S PSGDO=$P($G(^PS(53.1,+PSGORD,.3)),U),(PSGPDRG,PSGPD)=PSJCOI,(PSGPDRGN,PSGPDN)=$$OINAME^PSJLMUTL(PSGPD)
"RTN","PSGOEF",17,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S X=PSGSCH D EN^PSGORS0 S:$D(X) PSGAT=PSGS0Y D
"RTN","PSGOEF",18,0)
 . NEW PSJDOX,PSJDOSE,PSJPIECE,PSJUNIT,PSJX,X
"RTN","PSGOEF",19,0)
 . S X=$G(^PS(53.1,+PSGORD,1,1,0)) Q:'+X
"RTN","PSGOEF",20,0)
 . D DOSE^PSSORPH(.PSJDOX,+X,"U")
"RTN","PSGOEF",21,0)
 . I $S('$D(PSJDOX):1,1:+PSJDOX(1)=-1) Q
"RTN","PSGOEF",22,0)
 . S PSJPIECE=$S($P(PSJDOX(1),U)="":3,1:1)
"RTN","PSGOEF",23,0)
 . S X=^PS(53.1,+PSGORD,.2)
"RTN","PSGOEF",24,0)
 . S:PSJPIECE=3 PSJDOSE=$P(X,U,2)
"RTN","PSGOEF",25,0)
 . S:PSJPIECE=1 PSJDOSE=$P(X,U,5),PSJUNIT=$P(X,U,6)
"RTN","PSGOEF",26,0)
 . F X=0:0 S X=$O(PSJDOX(X)) Q:+$G(PSJX)!'X  D
"RTN","PSGOEF",27,0)
 .. I PSJPIECE=3,($P(PSJDOX(X),U,3)'=PSJDOSE) Q
"RTN","PSGOEF",28,0)
 .. ;;I PSJPIECE=1,($P(PSJDOX(X),U,1)_$P(PSJDOX(X),U,2)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",29,0)
 .. I PSJPIECE=1,($P(PSJDOX(X),U,11)'=(PSJDOSE_PSJUNIT)) Q
"RTN","PSGOEF",30,0)
 .. S:+$P(PSJDOX(X),U,12) $P(^PS(53.45,PSJSYSP,2,1,0),U,2)=+$P(PSJDOX(X),U,12),PSJX=1
"RTN","PSGOEF",31,0)
 I PSGEB'=PSGOPR F X=7,11 S Y=$T(@(3_X)),@("PSGEFN("_X_")="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))="",PSGOEEF=PSGOEEF+1
"RTN","PSGOEF",32,0)
 D GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",33,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S PSGSD="" D:PSGS0Y]""
"RTN","PSGOEF",34,0)
 .; NAKED REFERENCE below refers to ^PS(53.1,+PSGORD,0) above
"RTN","PSGOEF",35,0)
 .N PSJX S PSJX=$P($G(^(0)),U,25) I PSJX="" Q
"RTN","PSGOEF",36,0)
 .I PSJX["U" S PSGSD=$P($G(^PS(55,DFN,5,+PSJX,2)),U,2) Q
"RTN","PSGOEF",37,0)
 .I PSJX["V" S PSGSD=$P($G(^PS(55,DFN,"IV",+PSJX,0)),U,2) Q
"RTN","PSGOEF",38,0)
 .I PSJX["P" S PSGSD=$P($G(^PS(53.1,+PSJX,2)),U,2)
"RTN","PSGOEF",39,0)
 S:PSGSD="" PSGSD=PSGLI
"RTN","PSGOEF",40,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",+PSGPD)
"RTN","PSGOEF",41,0)
 S:$P($G(PSGNEDFD),U,3)="" $P(PSGNEDFD,U,3)=PSGST N PSGOEA S PSGOEA="R"
"RTN","PSGOEF",42,0)
 S (PSGNESD,PSGSD)=$$ENSD^PSGNE3(PSGSCH,PSGS0Y,PSGLI,PSGSD)
"RTN","PSGOEF",43,0)
 ;if this is a renewal order, ignore any 'requested start date' received.  Use the system calculated start date.
"RTN","PSGOEF",44,0)
 I $P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" D
"RTN","PSGOEF",45,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEF",46,0)
 E  D
"RTN","PSGOEF",47,0)
 . S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSD
"RTN","PSGOEF",48,0)
 ;I $P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S X=$$DSTART^PSJDCU(DFN,$P(^PS(53.1,+PSGORD,0),U,25)) I X]"" S (PSGNESD,PSGSD)=X K PSGRSDF,PSGRSD
"RTN","PSGOEF",49,0)
 D ENFD^PSGNE3(PSGLI) S PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGFD")):PSGRDTX(+PSGORD,"PSGFD"),1:PSGNEFD)
"RTN","PSGOEF",50,0)
 N DUR,PSGRNSD S PSGRNSD=+$$LASTREN^PSJLMPRI(DFN,PSGORD) I PSGRNSD S DUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,"P",1) I DUR]"" D
"RTN","PSGOEF",51,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN S PSGFD=$$FMADD^XLFDT(PSGRNSD,,,DURMIN)
"RTN","PSGOEF",52,0)
 S PSGOFD="",PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD),PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOEF",53,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSGOEF",54,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) N DRG,DRGCNT S DRGCNT=0 D
"RTN","PSGOEF",55,0)
 .F X=0:0 S X=$O(^PSDRUG("ASP",+PSGPD,X)) Q:'X!(DRGCNT>1)  S:$P($G(^PSDRUG(+X,2)),U,3)["U" DRGCNT=DRGCNT+1,DRG=+X
"RTN","PSGOEF",56,0)
 .I DRGCNT=1 K ^PS(53.45,PSJSYSP,2) S ^PS(53.45,PSJSYSP,2,1,0)=DRG_U_1,^PS(53.45,PSJSYSP,2,0)="^53.4502^1^1",PS(53.45,PSJSYSP,2,"B",+DRG,1)=""
"RTN","PSGOEF",57,0)
 Q
"RTN","PSGOEF",58,0)
FINISH ;
"RTN","PSGOEF",59,0)
 ; force display of second screen if CPRS order checks exist
"RTN","PSGOEF",60,0)
 N NSFF S NSFF=1 K PSJNSS
"RTN","PSGOEF",61,0)
 I $G(PSGORD),$D(PSGRDTX(+PSGORD)) D  K PSGRDTX
"RTN","PSGOEF",62,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRSD")) PSGSD=PSGRDTX(+PSGORD,"PSGRSD")
"RTN","PSGOEF",63,0)
 . S:$G(PSGRDTX(+PSGORD,"PSGRFD")) PSGFD=$S($G(PSGRDTX(+PSGORD,"PSGRFD")):PSGRDTX(+PSGORD,"PSGRFD"),1:$G(PSGNEFD))
"RTN","PSGOEF",64,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8)
"RTN","PSGOEF",65,0)
 I $O(^PS(53.1,+PSGORD,12,0))!$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSGOEF",66,0)
 .Q:$G(PSJLMX)=1  ; there's no second screen to display
"RTN","PSGOEF",67,0)
 .S VALMBG=16 D RE^VALM4,PAUSE^VALM1
"RTN","PSGOEF",68,0)
 D FULL^VALM1
"RTN","PSGOEF",69,0)
 I $G(PSJPROT)=3,'$D(PSJTUD),'$$ENIVUD^PSGOEF1(PSGORD) Q
"RTN","PSGOEF",70,0)
 S CHK=0 S:$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" PSGSI=$$ENPC^PSJUTL("U",+PSJSYSP,180,PSGSI)
"RTN","PSGOEF",71,0)
 I $G(PSGOSCH)]"" D  S:$G(PSGS0XT)'<0 $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSGOEF",72,0)
 .N PSGOES,PSGS0Y,PSGSCH S X=PSGOSCH,PSGOES=1 K:$G(PSJTUD) NSFF D ENOS^PSGS0
"RTN","PSGOEF",73,0)
 I '$G(PSJTUD),$G(PSJNSS),$G(PSGS0XT),($G(PSGOSCH)]"") D NSSCONT^PSGS0(PSGOSCH,PSGS0XT) K PSJNSS
"RTN","PSGOEF",74,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10) I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")_" before it can be finished."
"RTN","PSGOEF",75,0)
 I PSGOEFF S CHK=1 W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSGOEF",76,0)
 I PSGOEFF#2 S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) G:'PSGOEE DONE
"RTN","PSGOEF",77,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(+PSGPD,0) I CHK D ABORTACC Q
"RTN","PSGOEF",78,0)
 I 'PSGOEFF D OC531^PSGOESF ; check every dispense drug from CPRS
"RTN","PSGOEF",79,0)
 ;* I 'PSGOEFF D  ; check every dispense drug from CPRS
"RTN","PSGOEF",80,0)
 ;* .K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(53.1,+PSGORD,1,1,0)))
"RTN","PSGOEF",81,0)
 S VALMBG=1
"RTN","PSGOEF",82,0)
 I 'PSGOEFF&($D(PSGORQF)) D RE^VALM4 Q
"RTN","PSGOEF",83,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSGOEF",84,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD)
"RTN","PSGOEF",85,0)
 S PSJLMFIN=1
"RTN","PSGOEF",86,0)
 K PSJACEPT I $O(^PS(53.1,+PSGORD,12,0)) S PSJLMP2=1
"RTN","PSGOEF",87,0)
 S PSGOEENO=0,PSGSTAT=$S($P(PSJSYSP0,U,9):"ACTIVE",1:"NON-VERIFIED")
"RTN","PSGOEF",88,0)
 ;/* I $G(PSJTUD) S PSGPDRG=PSGPD,PSGOEEF(108)=1,PSGOEENO=1,VALMSG="This change will cause a new order to be created."
"RTN","PSGOEF",89,0)
 NEW PSJDOSE,PSJDOX,PSJDSFLG
"RTN","PSGOEF",90,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEF",91,0)
 S:+$G(PSJDSFLG) VALMSG="Dosage Ordered & Dispense Drug are not compatible"
"RTN","PSGOEF",92,0)
 I PSGODO=PSGDO S PSGOEEF(109)=""
"RTN","PSGOEF",93,0)
 I PSGODO'=PSGDO S PSGOEENO=1,VALMSG="This change will cause a new order to be created."
"RTN","PSGOEF",94,0)
 D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEF",95,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",96,0)
 I $G(PSJRNF),$G(^PS(53.1,+PSGORD,4)) D
"RTN","PSGOEF",97,0)
 . W $C(7),!!,"ACCEPTING THIS ORDER WILL CHANGE THE STATUS TO ACTIVE."
"RTN","PSGOEF",98,0)
 . S DIR(0)="Y",DIR("A")="Do you wish to make this order Active",DIR("?",1)="Enter ""N"" if you wish to exit without Activating this order,"
"RTN","PSGOEF",99,0)
 . S DIR("?")="or ""Y"" to continue with the Activation process." D ^DIR S:'Y Y=-1 K DIR
"RTN","PSGOEF",100,0)
 I $G(PSJRNF),$G(Y)=-1 S PSJACEPT=0 D ABORTACC Q
"RTN","PSGOEF",101,0)
 I $G(PSJRNF),$G(Y)=1 S PSGOEAV=1
"RTN","PSGOEF",102,0)
 I PSGOEENO S PSJNOO=$$ENNOO^PSJUTL5("E"),PSJACEPT=$S(PSJNOO<0:0,1:1)
"RTN","PSGOEF",103,0)
ACCEPT ;
"RTN","PSGOEF",104,0)
 S VALMBCK=$S($G(PSJACEPT):"Q",1:"R")
"RTN","PSGOEF",105,0)
 I '$G(PSJACEPT) D ABORTACC Q
"RTN","PSGOEF",106,0)
 K PSGOES,PSGRSD,PSGRSDN D:PSGOEENO NEW3^PSGOEE D:'PSGOEENO UPD^PSGOEF1 I $D(PSGOEF)!PSGOEENO S PSGCANFL=-1
"RTN","PSGOEF",107,0)
 ;I 'PSGOEAV,PSJSYSL,PSJSYSL<3 S $P(^PS(53.1,+PSGORD,7),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=DUZ,PSGTOO=2,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEF",108,0)
 ;I PSGOEAV,PSJSYSL>1 S $P(@($S(PSGORD["U":"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSGORD_",7)"),"^",1,2)=PSGDT_"^"_$E("D",PSGOEENO)_"E",PSGTOL=2,PSGUOW=2,PSGTOO=PSGORD'["U"+1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEF",109,0)
 D DONE1^PSGOEE
"RTN","PSGOEF",110,0)
 D DONE
"RTN","PSGOEF",111,0)
 Q
"RTN","PSGOEF",112,0)
BYPASS ;
"RTN","PSGOEF",113,0)
 S PSGCANFL=1
"RTN","PSGOEF",114,0)
 ;
"RTN","PSGOEF",115,0)
DONE ;
"RTN","PSGOEF",116,0)
 K CHK,DA,DIE,DR,DRG,MSG,Q1,Q2 ;PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSGOEF",117,0)
 Q
"RTN","PSGOEF",118,0)
ABORTACC ; Abort Accept process.
"RTN","PSGOEF",119,0)
 D ABORT^PSGOEE K PSGOEEF D GETUD^PSJLMGUD(PSGP,PSGORD),^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),INIT^PSJLMUDE(PSGP,PSGORD) S VALMBCK="R",PSGSD=PSGNESD,PSGFD=PSGNEFD Q
"RTN","PSGOEF",120,0)
 ;
"RTN","PSGOEF",121,0)
 ;
"RTN","PSGOEF",122,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSGOEF",123,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;109;PSGODO]""
"RTN","PSGOEF",124,0)
33 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSGOEF",125,0)
34 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSGOEF",126,0)
35 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSGOEF",127,0)
36 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSGOEF",128,0)
37 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSGOEF",129,0)
38 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1      
"RTN","PSGOEF",130,0)
39 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSGOEF",131,0)
310 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSGOEF",132,0)
311 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSGOEF",133,0)
312 ;;2^PSGOE82;;;2;0
"RTN","PSGOEF",134,0)
313 ;;40^PSGOE82;;;40;0
"RTN","PSGOEF",135,0)
 ;
"RTN","PSGOEF",136,0)
AH ;
"RTN","PSGOEF",137,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSGOEF",138,0)
 Q
"RTN","PSGOEF1")
0^49^B29279351
"RTN","PSGOEF1",1,0)
PSGOEF1 ;BIR/CML3-FINISH ORDERS ENTERED THROUGH OE/RR (CONT) ;02 Feb 2001  12:20 PM
"RTN","PSGOEF1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,7,35,39,45,47,50,63,67,58,95,110**;16 DEC 97
"RTN","PSGOEF1",3,0)
 ;
"RTN","PSGOEF1",4,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116.
"RTN","PSGOEF1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOEF1",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGOEF1",7,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSGOEF1",8,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSGOEF1",9,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSGOEF1",10,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSGOEF1",11,0)
 ;
"RTN","PSGOEF1",12,0)
UPD ;
"RTN","PSGOEF1",13,0)
 W !!,"...accepting order..."
"RTN","PSGOEF1",14,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSGOEF1",15,0)
 I PSJCOM D UPD^PSJCOM Q
"RTN","PSGOEF1",16,0)
 K DA,DR S DA=+PSGORD,DIE="^PS(53.1,",DR="28////N;4////U"_";7////"_PSGST_";10////"_PSGSD_";25////"_PSGFD
"RTN","PSGOEF1",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^PS(53.1,DA,6)=PSGSI
"RTN","PSGOEF1",18,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^PS(53.1,DA,6),U)=$P(PSGSI,U)
"RTN","PSGOEF1",19,0)
 S:PSGOEFF#2 DR=DR_";26////"_PSGSCH
"RTN","PSGOEF1",20,0)
 I PSGSM,PSGOHSM'=PSGHSM S DR=DR_";5////"_PSGSM_";6////"_PSGHSM
"RTN","PSGOEF1",21,0)
 D ^DIE W "."
"RTN","PSGOEF1",22,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSGOEF1",23,0)
 ;;I $O(^PS(53.45,PSJSYSP,2,0)) S %X="^PS(53.45,"_PSJSYSP_",2,",%Y="^PS(53.1,"_+PSGORD_",1," D %XY^%RCR W "." S $P(^PS(53.1,+PSGORD,1,0),"^",2)=53.11
"RTN","PSGOEF1",24,0)
 S PSGND=$G(^PS(53.1,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSGOEF1",25,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^PS(53.1,DA,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSGOEF1",26,0)
 I $P(PSGND,U,24)="R",$P(PSGND,U,25),PSGSD<$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4) D
"RTN","PSGOEF1",27,0)
 .K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",5,",DR="34////"_PSGFD_";25////"_$P($G(^PS(55,PSGP,5,+$P(PSGND,U,25),2)),U,4)
"RTN","PSGOEF1",28,0)
 .D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25))
"RTN","PSGOEF1",29,0)
 S $P(^PS(53.1,+PSGORD,.2),U,2)=PSGDO,$P(^PS(53.1,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSGOEF1",30,0)
 I 'PSGOEAV D NEWNVAL^PSGAL5(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSGOEF1",31,0)
 I PSGOEAV,+PSJSYSU=3 D VFY^PSGOEV Q
"RTN","PSGOEF1",32,0)
 I PSGOEAV,$G(PSJRNF) D VFY^PSGOEV
"RTN","PSGOEF1",33,0)
 Q
"RTN","PSGOEF1",34,0)
 ;
"RTN","PSGOEF1",35,0)
ENDRG(PSGPDRG,DRGDA) ; enter dispense drug for order w/o one
"RTN","PSGOEF1",36,0)
 D NOW^%DTC K DRG S (DRG,Q)=0 F  S Q=$O(^PSDRUG("ASP",+PSGPDRG,Q)) Q:'Q  I $D(^PSDRUG(Q,0)),$P($G(^(2)),U,3)["U" S X=+$G(^("I")) I 'X!(X>%) S DRG=DRG+1,DRG(DRG)=Q_"^"_^(0)
"RTN","PSGOEF1",37,0)
 I 'DRG W $C(7),!!,"No dispense drugs were found for this order's Orderable Item." K DIR S DIR(0)="E" D ^DIR K DIR S CHK=-1 Q
"RTN","PSGOEF1",38,0)
 S:DRG=1 Y(0)=1
"RTN","PSGOEF1",39,0)
 I DRG>1 D  I 'Y S DRG=0,CHK=-1 Q
"RTN","PSGOEF1",40,0)
 .W !!,"CHOOSE FROM:" F Q=1:1:DRG W !?3,$J(Q,3),". ",$P(DRG(Q),"^",2)
"RTN","PSGOEF1",41,0)
 .N DIR S DIR(0)="LAO^1:"_DRG_U_"I X#1!(X[""."") K X",DIR("A")="Select DISPENSE DRUG(S) for this order: " S:DRG=1 DIR("B")=1 S DIR("?")="^D DRGH^PSGOEF1" W ! D ^DIR
"RTN","PSGOEF1",42,0)
 ;
"RTN","PSGOEF1",43,0)
 I 'DRGDA S ^PS(53.45,PSJSYSP,2,0)="^53.4502P"
"RTN","PSGOEF1",44,0)
 S DRG=Y(0) F Q1=1:1 S Q2=$P(DRG,",",Q1) Q:'Q2  D
"RTN","PSGOEF1",45,0)
 .I '$$ENCKDD(PSGP,+DRG(Q2),Q1) S DRGDA=DRGDA+1,^PS(53.45,PSJSYSP,2,DRGDA,0)=+DRG(Q2),^PS(53.45,PSJSYSP,2,"B",+DRG(Q2),DRGDA)="",DA(1)=PSJSYSP,DA=DRGDA,DIE="^PS(53.45,"_PSJSYSP_",2,",DR=".02//1" W !!,$P(DRG(Q2),U,2) D ^DIE
"RTN","PSGOEF1",46,0)
 .;I DRGDA=0,'$$ENCKDD(PSGP,+DRG(Q2)) S DRGDA=DRGDA+1,^PS(53.45,PSJSYSP,2,DRGDA,0)=+DRG(Q2),^PS(53.45,PSJSYSP,2,"B",+DRG(Q2),DRGDA)="",DA(1)=PSJSYSP,DA=DRGDA,DIE="^PS(53.45,"_PSJSYSP_",2,",DR=.02 W !!,$P(DRG(Q2),U,2) D ^DIE
"RTN","PSGOEF1",47,0)
 S PSGDI=0
"RTN","PSGOEF1",48,0)
 S:DRGDA>0 $P(^PS(53.45,PSJSYSP,2,0),"^",3,4)=DRGDA_"^"_DRGDA,CHK=0 Q
"RTN","PSGOEF1",49,0)
 Q
"RTN","PSGOEF1",50,0)
 ;
"RTN","PSGOEF1",51,0)
DRGH ;
"RTN","PSGOEF1",52,0)
 W !!?2,"This order must have at least one dispense drug before it can be completed.",!,"Select one or more items listed.  For each item selected, you will be",!,"prompted for the UNITS PER DOSE for the item."
"RTN","PSGOEF1",53,0)
 Q
"RTN","PSGOEF1",54,0)
ENIVUD(PSJORD)     ;
"RTN","PSGOEF1",55,0)
 ;Determine if user should be prompted to transfer the order to IV.
"RTN","PSGOEF1",56,0)
 ;  INPUT: PSJORD - IEN in 53.1_order location code.
"RTN","PSGOEF1",57,0)
 ; OUTPUT: 1 - Order not transferred, process as always.
"RTN","PSGOEF1",58,0)
 ;         0 - User selected to transfer order and quit upon return.
"RTN","PSGOEF1",59,0)
 ;
"RTN","PSGOEF1",60,0)
 NEW DIR,DIRUT,PSJCOI,PSJND0,Y
"RTN","PSGOEF1",61,0)
 S PSJND0=$G(^PS(53.1,+PSJORD,0)),PSJCOI=+$G(^PS(53.1,+PSJORD,.2))
"RTN","PSGOEF1",62,0)
 I $P(PSJND0,U,4)="F" Q 1
"RTN","PSGOEF1",63,0)
 D FULL^VALM1
"RTN","PSGOEF1",64,0)
 I $S($P(PSJND0,U,24)="R":1,1:'$P(PSJND0,U,13)) Q 1
"RTN","PSGOEF1",65,0)
 S DIR(0)="SAB^I:IV;U:UNIT DOSE",DIR("A")="COMPLETE THIS ORDER AS IV OR UNIT DOSE? ",DIR("B")=$S($P(PSJND0,U,4)="I":"IV",1:"UNIT DOSE")
"RTN","PSGOEF1",66,0)
 S DIR("??")="^D THELP^PSGOEF1("""_$S(DIR("B")="IV":"UNIT DOSE",1:"IV")_""","_PSJCOI_")"
"RTN","PSGOEF1",67,0)
 D ^DIR K DIR
"RTN","PSGOEF1",68,0)
 I $D(DTOUT)!$D(DUOUT) Q 0
"RTN","PSGOEF1",69,0)
 I Y="I" D  Q 0
"RTN","PSGOEF1",70,0)
 . I +PSJSYSU=1,'$G(PSJIRNF) W !!!!,"You need the PSJI RNFINISH key to finish this order as IV!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",71,0)
 . D IV^PSJLIFNI(PSJORD,PSJCOI)
"RTN","PSGOEF1",72,0)
 I Y="U" D  Q 0
"RTN","PSGOEF1",73,0)
 . I +PSJSYSU=1,'$G(PSJRNF) W !!!!,"You need the PSJ RNFINISH key to finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",74,0)
 . I $G(PSJITECH),($P(PSJSYSU,";",3)'=3) W !!!!,"You may not finish this order as Unit Dose!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSGOEF1",75,0)
 . D ENUD^PSGOEF1(PSJORD,PSJCOI)
"RTN","PSGOEF1",76,0)
 Q 1
"RTN","PSGOEF1",77,0)
 ;
"RTN","PSGOEF1",78,0)
ENUD(PSJORD,PSGPD)       ;
"RTN","PSGOEF1",79,0)
 N PSJTUD S PSJTUD=1,DFN=$P($G(^PS(53.1,+PSJORD,0)),U,15)
"RTN","PSGOEF1",80,0)
 K DRG,DRGOC,DRGT,DRGTMP,ERR,ON,ON55,P,PSJSTAR,PSJTIM,UL80
"RTN","PSGOEF1",81,0)
 D DISACTIO^PSJOE(DFN,PSJORD,$G(PSJPNV)) S VALMBCK="Q"
"RTN","PSGOEF1",82,0)
 Q
"RTN","PSGOEF1",83,0)
THELP(PKG,COI) ;
"RTN","PSGOEF1",84,0)
 W !,"Choose the package this order should be completed as a IV or Unit Dose order",!
"RTN","PSGOEF1",85,0)
 Q
"RTN","PSGOEF1",86,0)
 ;
"RTN","PSGOEF1",87,0)
ENCKDD(PSGP,PSJDRG,Q1) ;
"RTN","PSGOEF1",88,0)
 N DRG
"RTN","PSGOEF1",89,0)
 S PSGORQF=0
"RTN","PSGOEF1",90,0)
 I Q1=1 D ENDDC^PSGSICHK(PSGP,PSJDRG) Q PSGORQF
"RTN","PSGOEF1",91,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJDD,PSGORQF,PSJDD
"RTN","PSGOEF1",92,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)="",PSJDD=PSJDRG
"RTN","PSGOEF1",93,0)
 D IVSOL^PSGSICHK
"RTN","PSGOEF1",94,0)
 Q $G(PSGORQF)
"RTN","PSGOER")
0^50^B68670827
"RTN","PSGOER",1,0)
PSGOER ;BIR/CML3-RENEW A SINGLE ORDER ;07 MAR 96 / 1:23 PM
"RTN","PSGOER",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,30,29,35,70,58,95,110**;16 DEC 97
"RTN","PSGOER",3,0)
 ;
"RTN","PSGOER",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOER",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSGOER",6,0)
 ; Reference to NOW^%DTC is supported by DBIA 10000.
"RTN","PSGOER",7,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSGOER",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSGOER",9,0)
 ; Reference to ^PSBAPIPM is supported by DBIA 3564.
"RTN","PSGOER",10,0)
 ; Reference to ^PS(59.7 is supported by DBIA 2181
"RTN","PSGOER",11,0)
 ;
"RTN","PSGOER",12,0)
 ; renew a single order
"RTN","PSGOER",13,0)
 I $G(PSJCOM) D ^PSJCOMR Q
"RTN","PSGOER",14,0)
 N PSJEXPIR S PSJEXPIR=$$EXPIRED(PSGP,PSGORD) I PSJEXPIR D  Q
"RTN","PSGOER",15,0)
 .W !!?3,"  THIS ORDER" W:PSJEXPIR'=2 " HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED",!?8," ADMINISTRATIONS AND"
"RTN","PSGOER",16,0)
 .W " CANNOT BE RENEWED!" D PAUSE^VALM1
"RTN","PSGOER",17,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS ORDER",1:"MARK THIS ORDER FOR RENEWAL"),DIR("B")="YES"
"RTN","PSGOER",18,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this order",1:"mark this order for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR
"RTN","PSGOER",19,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSGOER",20,0)
 I '$D(DIRUT),PSJSYSU S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSGOER",21,0)
 D DONE,ABORT^PSGOEE
"RTN","PSGOER",22,0)
 Q
"RTN","PSGOER",23,0)
 ;
"RTN","PSGOER",24,0)
UNMARK ;  
"RTN","PSGOER",25,0)
 W !!,"THIS ORDER HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSGOER",26,0)
 S DIR("?",1)="  Answer 'YES' to unmark this order.  Answer 'NO' (or '^') to leave the order",DIR("?")="marked.  (An answer is required.)" D ^DIR
"RTN","PSGOER",27,0)
 I 'Y D ABORT^PSGOEE G DONE
"RTN","PSGOER",28,0)
 S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSGOER",29,0)
 ;
"RTN","PSGOER",30,0)
DONE ;
"RTN","PSGOER",31,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSGOER",32,0)
 ;
"RTN","PSGOER",33,0)
NEW ; get info, write record
"RTN","PSGOER",34,0)
EXTEND ; extend stop date on renewal order
"RTN","PSGOER",35,0)
 N DUOUT,PSJABT,PSGDRG,PSJREN,PSGRZERO,PSGOREAS S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSGOER",36,0)
 I $G(PSGST)="O" N ACT S ACT=$$EN^PSBAPIPM(PSGP,PSGORD) I $P(ACT,"^",2),($P(ACT,"^",3)="G") I $P(ACT,"^",2)>$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",2) D  Q
"RTN","PSGOER",37,0)
 . W !!?5,"THIS ONE-TIME ORDER HAS ALREADY BEEN GIVEN AND CANNOT BE RENEWED",! S (DIRUT,PSGORQF)=1 D READ
"RTN","PSGOER",38,0)
 D OC55
"RTN","PSGOER",39,0)
 Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOER",40,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSGOER",41,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSGOER",42,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSGOER",43,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I ($G(X)="^")!'$D(PSGFOK(106))!$G(DUOUT) D DONE,ABORT^PSGOEE S VALMBCK="R",COMQUIT=1 Q
"RTN","PSGOER",44,0)
SPEED ;
"RTN","PSGOER",45,0)
 I +$G(PSJSYSU)=3 D EN^PSGPEN(PSGORD)
"RTN","PSGOER",46,0)
 Q:$G(DUOUT)
"RTN","PSGOER",47,0)
 N PSGOEAV S PSGOEAV=+PSJSYSU
"RTN","PSGOER",48,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSGOER",49,0)
 I $$LS^PSSLOCK(PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT) D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOER",50,0)
 ;
"RTN","PSGOER",51,0)
 I 'PSGOERDP,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOER",52,0)
 W ".DONE!" S VALMBCK="Q" Q
"RTN","PSGOER",53,0)
 ;
"RTN","PSGOER",54,0)
MARK ;
"RTN","PSGOER",55,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSGOER",56,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSGOER",57,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOER",58,0)
 Q
"RTN","PSGOER",59,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSGOER",60,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSGOER",61,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSGOER",62,0)
 Q
"RTN","PSGOER",63,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSGOER",64,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG
"RTN","PSGOER",65,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOER",66,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(55,PSGP,5,+PSGORD,1,1,0)))
"RTN","PSGOER",67,0)
 I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSGOER",68,0)
 . F PSGDDI=1:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSGOER",69,0)
 Q
"RTN","PSGOER",70,0)
 ;
"RTN","PSGOER",71,0)
UPDREN(PSGORD,RNWDT,PSGOEPR,PSGOFD,PSJNOO,RDUZ) ; update renewed order
"RTN","PSGOER",72,0)
 N DR,DA,DIC,DIE,DD,DO S DR="",PSGOEENO=0,PSGOORD=PSGORD,PSGNESD=PSGSD Q:'PSGORD!'RNWDT!'PSGOEPR!'PSGOFD  S PSJNOO=$S($G(PSJNOO)]"":$G(PSJNOO),1:"E")
"RTN","PSGOER",73,0)
 S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOEORD=$P(@PSGRZERO,"^",21)
"RTN","PSGOER",74,0)
 S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5," S DR="34////^S X=PSGFD" S:$G(PSGPR) DR=DR_";1////"_PSGPR_";110////"_PSJNOO D ^DIE
"RTN","PSGOER",75,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(55,"_PSGP_",5,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="55.6114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSGOER",76,0)
 . S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$S($G(RDUZ):RDUZ,1:$G(DUZ))_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSGOER",77,0)
 K DR,DA,DIC,DIE,DD,DO S DA(1)=PSGP,DA=+PSGORD,DIE="^PS(55,"_PSGP_",5,",DR="28////A;105////@;107////@;16////@;17////@" I '$G(PSJSPEED) I $G(PSGAT)]"",$G(PSGAT)'=$P($G(@(DIE_+PSGORD_",2)")),"^",5) S DR=DR_";41////"_PSGAT
"RTN","PSGOER",78,0)
 D ^DIE
"RTN","PSGOER",79,0)
 Q
"RTN","PSGOER",80,0)
UPDRENOE(PSGP,PSGORD,RDATE) ;
"RTN","PSGOER",81,0)
 D EXPOE(PSGP,PSGORD,$G(RDATE)) ; expire original Orders File order
"RTN","PSGOER",82,0)
 I PSGORD'["P" K DA,DR,DIE S DA(1)=DFN,DA=+PSGORD,DIE="^PS(55,"_DFN_$S(PSGORD="U":",5,",1:",""IV"","),DR=$S(DIE["IV":110,1:66)_"////@" D ^DIE
"RTN","PSGOER",83,0)
 D ENUDTX^PSJOREN(PSGP,PSGORD,"NR")
"RTN","PSGOER",84,0)
 D EN1^PSJHL2(PSGP,"SN",PSGORD,"ORDER RENEWED")
"RTN","PSGOER",85,0)
 Q
"RTN","PSGOER",86,0)
 ;
"RTN","PSGOER",87,0)
READ ; hold screen
"RTN","PSGOER",88,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSGOER",89,0)
 ;W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","PSGOER",90,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSGOER",91,0)
 Q
"RTN","PSGOER",92,0)
 ;
"RTN","PSGOER",93,0)
EXPOE(DFN,PSJORDER,EXPDT) ; expire old Orders File entry
"RTN","PSGOER",94,0)
 I PSJORDER["P" S FILE="^PS(53.1,"_+PSJORDER_",0)",PSJORDER=$P(@FILE,"^",25)
"RTN","PSGOER",95,0)
 I (PSJORDER'["U"),(PSJORDER'["V") Q
"RTN","PSGOER",96,0)
 N CURDAT D NOW^%DTC S CURDAT=$$DATE2^PSJUTL2(%)
"RTN","PSGOER",97,0)
 S PSJEXPOE=$S($G(EXPDT):EXPDT,1:CURDAT) D EN1^PSJHL2(DFN,"SC",PSJORDER) K PSJEXPOE
"RTN","PSGOER",98,0)
 Q
"RTN","PSGOER",99,0)
 ;
"RTN","PSGOER",100,0)
EXPIRED(PSJX,PSJY) ;
"RTN","PSGOER",101,0)
 ; INPUT 
"RTN","PSGOER",102,0)
 ;       PSJX - Pharmacy Patient, pointer to ^PS(55
"RTN","PSGOER",103,0)
 ;       PSJY - Inpatient Order Number, pointer to
"RTN","PSGOER",104,0)
 ;                        -  IV multiple of Pharmacy Patient file if appended with "V"
"RTN","PSGOER",105,0)
 ;                        -  UD multiple of Pharmacy Patient file if appended with "U"
"RTN","PSGOER",106,0)
 ; OUTPUT
"RTN","PSGOER",107,0)
 ;   0  -  Order has not exceeded the Expired Time Limit 
"RTN","PSGOER",108,0)
 ;   1  -  Order has exceeded the Expired Time Limit
"RTN","PSGOER",109,0)
 ;
"RTN","PSGOER",110,0)
 ; Expired Time Limit: 
"RTN","PSGOER",111,0)
 ;   For UD and scheduled IV orders, the Date/Time after expiration that the next scheduled dose is due.
"RTN","PSGOER",112,0)
 ;   For continuous IV orders, the Date/Time obtained by adding the EXPIRED IV TIME LIMIT field (#95) in file 59.7 to order's expiration date.
"RTN","PSGOER",113,0)
 ;        
"RTN","PSGOER",114,0)
 N STOP,STATUS,NOW,CUTOFF,FREQ,LAST,ST,X,DFN,U,PSGDT,SD,WD,PSJPSTO,PSGDW,PSGOC,ZZND,LASTAT,LSTSTR,PSBCNT S DFN=PSJX,U="^",CUTOFF=0
"RTN","PSGOER",115,0)
 S STATUS=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",9),PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",17),1:"")
"RTN","PSGOER",116,0)
 S NOW=$S($G(PSGDT):PSGDT,1:$$DATE^PSJUTL2())
"RTN","PSGOER",117,0)
 ;S STOP=$S($G(PSGFD):PSGFD,$G(P(3)):P(3),1:"") I STOP>NOW Q 0
"RTN","PSGOER",118,0)
 S STOP=$S(PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,2)),U,4),1:$P($G(^PS(55,PSJX,"IV",+PSJY,0)),"^",3))
"RTN","PSGOER",119,0)
 I NOW<STOP Q 0
"RTN","PSGOER",120,0)
 I PSJY["U" N ND2,ND0 S ND0=$G(^PS(55,PSJX,5,+PSJY,0)),ND2=$G(^PS(55,PSJX,5,+PSJY,2)),FREQ=$P(ND2,"^",6) D
"RTN","PSGOER",121,0)
 .N SCHED S SCHED=$P($G(^PS(55,PSJX,5,+PSJY,2)),"^") I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED)
"RTN","PSGOER",122,0)
 .S LSTSTR=$P(ND2,"^",2)_"^"_$P(ND2,"^",4)_"^"_SCHED_"^"_$P(ND0,"^",7)_"^^"_$P(ND2,"^",5)
"RTN","PSGOER",123,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,($P(ND0,"^",7)="O"),($P(LAST,"^",3)="G") I LAST>$P(ND2,"^",2) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",124,0)
 .I 'LAST!(LAST>$P(ND2,"^",4)) S LAST=$$LASTAT^PSJORP2(DFN,LSTSTR) S:LAST CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",125,0)
 .I SCHED["PRN",($P(LSTSTR,"^",6)="") S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",126,0)
 .I $$DOW^PSIVUTL(SCHED) S CUTOFF=$$NXTDOW(DFN,$P(LSTSTR,"^"),$P(LSTSTR,"^",2),$P(LSTSTR,"^",3),$P(LSTSTR,"^",6)) Q
"RTN","PSGOER",127,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND2,"^",4)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",128,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,,,FREQ) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",129,0)
 I PSJY["V" N LIMIT S LIMIT=$P($G(^PS(59.7,1,31)),"^",4) S LIMIT=$S((LIMIT]""):+LIMIT,1:24) S CUTOFF=$$FMADD^XLFDT(STOP,,LIMIT) D
"RTN","PSGOER",130,0)
 .I '($G(P(4))]"") N P,YP,XP S YP=$G(^PS(55,DFN,"IV",+PSJY,0)) F XP=1:1:23 S P(XP)=$P(YP,U,XP) Q:'($G(P(4))]"")
"RTN","PSGOER",131,0)
 .Q:'$$SCHREQ^PSJLIVFD(.P)
"RTN","PSGOER",132,0)
 .N INTERVAL,LSTSTR,ND0,SCHED,IVSTYP S ND0=$G(^PS(55,PSJX,"IV",+PSJY,0)),INTERVAL=$P(ND0,"^",15),SCHED=$P(ND0,"^",9) Q:SCHED=""
"RTN","PSGOER",133,0)
 .S IVSTYP=$S($$DOW^PSIVUTL(SCHED):"D",INTERVAL="O":"O",1:"C"),LSTSTR=$P(ND0,"^",2)_"^"_$P(ND0,"^",3)_"^"_SCHED_"^"_IVSTYP_"^^"_$P(ND0,"^",11)
"RTN","PSGOER",134,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I LAST,IVSTYP="O",LAST>$P(ND0,"^",2),($P(LAST,"^",3)="G") S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",135,0)
 .I 'LAST!(LAST>$P(ND0,"^",3))!(LAST&(IVSTYP="O")) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",136,0)
 .I IVSTYP="D" S CUTOFF=$$NXTDOW(LAST,SCHED,$G(P(2)),$P($G(P(9)),"@"),$G(P(11))) Q
"RTN","PSGOER",137,0)
 .I SCHED["PRN" S FREQ=$$PRNFREQ(SCHED) S CUTOFF=$$FMADD^XLFDT(LAST,,,FREQ) Q
"RTN","PSGOER",138,0)
 .S LAST=$$EN^PSBAPIPM(PSJX,PSJY) I 'LAST!(LAST>$P(ND0,"^",3)) S CUTOFF=$$FMADD^XLFDT(NOW,,-1) Q
"RTN","PSGOER",139,0)
 .S $P(LSTSTR,"^")=$$FMADD^XLFDT(LAST,,,,1),$P(LSTSTR,"^",2)=$$FMADD^XLFDT(PSGDT,31) S CUTOFF=$$ENQ^PSJORP2(PSJX,LSTSTR)
"RTN","PSGOER",140,0)
 K LYN,PSBDT,PSBFLAG,PSBSTR
"RTN","PSGOER",141,0)
 Q $S(CUTOFF<NOW:1,1:0)
"RTN","PSGOER",142,0)
 ;
"RTN","PSGOER",143,0)
NXTDOW(DOWDFN,DOWSD,DOWFD,DOWSCH,DOWAT) ;
"RTN","PSGOER",144,0)
 N NXTADM,DOWSTR S DOWSTR=$$FMADD^XLFDT(DOWFD,,,,1)_"^"_$$FMADD^XLFDT(DOWFD,7)_"^"_DOWSCH_"^D^^"_DOWAT S NXTADM=$$ENQ^PSJORP2(DOWDFN,DOWSTR)
"RTN","PSGOER",145,0)
 Q $S(NXTADM:NXTADM,1:DOWSD)
"RTN","PSGOER",146,0)
 ;
"RTN","PSGOER",147,0)
PRNFREQ(SCHED) ;
"RTN","PSGOER",148,0)
 N D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0XT,PSGS0Y,PSGDT
"RTN","PSGOER",149,0)
 F X=$P(SCHED,"PRN"),$P(SCHED,"PRN",2),$P(SCHED," PRN"),$P(SCHED,"PRN ",2) Q:$G(PSGS0XT)  D EN^PSGORS0
"RTN","PSGOER",150,0)
 Q $S($G(PSGS0XT):PSGS0XT,1:1440)
"RTN","PSGOER0")
0^77^B20954490
"RTN","PSGOER0",1,0)
PSGOER0 ;BIR/CML3-EDIT FIELDS FOR RENEWAL ;05 May 98 / 10:58 AM
"RTN","PSGOER0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,45,47,50,63,64,70,69,58,80,110**;16 DEC 97
"RTN","PSGOER0",3,0)
 ;
"RTN","PSGOER0",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOER0",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSGOER0",6,0)
 ; Reference to ^DD(55.06 is supported by DBIA 2253.
"RTN","PSGOER0",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSGOER0",8,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSGOER0",9,0)
 ;
"RTN","PSGOER0",10,0)
DATE(PSGP,PSGORD,PSGDT) ;
"RTN","PSGOER0",11,0)
 K PSGFOK,PSJNOO S F1=55.06,PSGWLL=+$G(^PS(55,PSGP,5.1)),PSGOER0=$G(^PS(55,PSGP,5,+PSGORD,0)),PSGPDRG=+$G(^(.2)),PSGOER2=$G(^(2))
"RTN","PSGOER0",12,0)
 NEW XX S XX=$$ACTIVE^PSJORREN(PSGP,PSGORD) S:+XX=2 PSGPDRG=$P(XX,U,2)
"RTN","PSGOER0",13,0)
 I '+XX W !,"No active Orderable Item was found.",! G DONE
"RTN","PSGOER0",14,0)
 S (PSGNEDFD,PSGOERDP)=$P($$GTNEDFD^PSGOE7("U",PSGPDRG),U)
"RTN","PSGOER0",15,0)
 S PSGSCH=$P(PSGOER2,"^"),PSGST=$P(PSGOER0,"^",7),PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6)
"RTN","PSGOER0",16,0)
 S PSGOEPR=+$P(PSGOER0,"^",2),(PSGOPR,PSGPR)=$S($P(PSJSYSU,";",2):DUZ,1:+PSGOEPR)
"RTN","PSGOER0",17,0)
 S PSGOSD=+$P(PSGOER2,"^",2) S PSGOFD=+$P(PSGOER2,"^",4),PSGPRN=$P($G(^VA(200,PSGPR,0)),"^"),PSGPRI=$S($P(PSJSYSU,";",2):0,1:$P($G(^("PS")),"^",4)),PSGRO=0 S:PSGPRI PSGPRI=PSGPRI'>DT I PSGPRI S (PSGOPR,PSGPR,PSGPRN)=""
"RTN","PSGOER0",18,0)
 S PSGRNSD=$S($G(PSGLI):PSGLI,1:$G(PSGDT))
"RTN","PSGOER0",19,0)
 S PSGSD=$G(PSGOSD)
"RTN","PSGOER0",20,0)
 I PSGSD="" S PSJREN=1,PSGSD=$$ENSD^PSGNE3($S(PSGST["P":"PRN",1:$P(PSGOER2,U)),PSGS0Y,PSGDT,PSGOSD) S:PSGOSD>PSGSD PSGSD=PSGOSD K PSJREN
"RTN","PSGOER0",21,0)
 S PSGSDN=$$ENDD^PSGMI(PSGSD)
"RTN","PSGOER0",22,0)
10 ;
"RTN","PSGOER0",23,0)
 ;W !,"START DATE/TIME: "_PSGSDN
"RTN","PSGOER0",24,0)
O25 ;
"RTN","PSGOER0",25,0)
 N PSGSD,PSGNEFD S PSGSD=PSGDT
"RTN","PSGOER0",26,0)
 D ENWALL^PSGNE3(PSGSD,0,PSGP)
"RTN","PSGOER0",27,0)
 S:'$G(PSGDT) PSGDT=$$DATE2^PSJUTL2($$NOW^XLFDT)
"RTN","PSGOER0",28,0)
 N PSGNESD S PSGNESD=PSGDT D ENFD^PSGNE3(PSGNESD) I $G(PSGNEFD) S (Y,PSGFD)=PSGNEFD
"RTN","PSGOER0",29,0)
 S PSGFOK(10)="" I PSGST="O" S PSGFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGRNSD,PSGP) I PSGFD]"" S Y=PSGRNSD,X=0 G 1
"RTN","PSGOER0",30,0)
D25 K DUR,DURMIN N PKGFLG S PKGFLG=$S(PSGORD["U":5,PSGORD["V":"IV",PSGORD["P":"P",1:"") I PKGFLG]"" S DUR=$$GETDUR^PSJLIVMD(PSGP,+$G(PSGORD),PKGFLG,1) I DUR]"" D
"RTN","PSGOER0",31,0)
 .S DURMIN=($$DURMIN^PSJLIVMD(DUR)\1) I DURMIN>1 S Y=$$FMADD^XLFDT(PSGRNSD,,,DURMIN) I Y>PSGRNSD S PSGFD=Y,X=0
"RTN","PSGOER0",32,0)
 I $P($G(PSGOER2),"^",4)>PSGFD S Y=$P(PSGOER2,"^",4)
"RTN","PSGOER0",33,0)
 I $G(DUR)]"",($G(PSGORD)'["P") S DURMIN=$$DURMIN^PSJLIVMD(DUR)\1 S Y=$$FMADD^XLFDT(PSGDT,,,DURMIN)
"RTN","PSGOER0",34,0)
 S:X&$P(PSJSYSW0,"^",7) $P(Y,".",2)=$P(PSJSYSW0,"^",7) S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",35,0)
25 W !,"STOP DATE/TIME: "_PSGFDN_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",36,0)
 I X="" W "   "_PSGFDN G W25
"RTN","PSGOER0",37,0)
 I $E(X)="^" D FF G:Y>0 @Y G 25
"RTN","PSGOER0",38,0)
 S PSGF2=25 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,25)
"RTN","PSGOER0",39,0)
 I X=+X,X>0,X'>2000000 G 25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X,ND2=PSGOER2,$P(ND2,"^",2)=PSGRNSD W " ...dose limit..." D ENGO^PSGDL
"RTN","PSGOER0",40,0)
 K %DT S %DT="ERTX" D ^%DT K %DT G:Y'>0 25 S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",41,0)
W25 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOER0",42,0)
 I PSGFD<PSGSD W $C(7),!!?3,"*** The STOP date must be AFTER the START date. ***" G 25
"RTN","PSGOER0",43,0)
 S PSGFOK(25)=""
"RTN","PSGOER0",44,0)
 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S PSGFOK(1)="" Q
"RTN","PSGOER0",45,0)
1 ; provider
"RTN","PSGOER0",46,0)
 G:+PSJSYSU<3&$P(PSJSYSU,";",2) CHKDD S PSGF2=1
"RTN","PSGOER0",47,0)
A1 ;
"RTN","PSGOER0",48,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",49,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOER0",50,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) S PSGFOK(1)="" G CHKDD
"RTN","PSGOER0",51,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOER0",52,0)
 I $E(X)="^" D FF G:Y>0 @Y G A1
"RTN","PSGOER0",53,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="S X(1)=$G(^(""PS"")) I X(1),$S('$P((X(1)),""^"",4):1,1:DT<$P((X(1)),""^"",4))" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOER0",54,0)
 S PSGPR=+Y,PSGPRN=$P(Y(0,0),"^"),PSGFOK(1)=""
"RTN","PSGOER0",55,0)
CHKDD ;
"RTN","PSGOER0",56,0)
 G:$G(PSGRENEW) 106
"RTN","PSGOER0",57,0)
 I PSGORD["P"!$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",PSGPDRG) G 106
"RTN","PSGOER0",58,0)
 ;I PSGORD["P"!'$$CHKDD^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",") G 106
"RTN","PSGOER0",59,0)
 I $P(PSJSYSU,";")'=3,'$P(PSJSYSP0,U,2) W !!,"This order's dispense drug is invalid, a pharmacist must renew this order." Q
"RTN","PSGOER0",60,0)
 K ^PS(53.45,PSJSYSP,1),^(2)
"RTN","PSGOER0",61,0)
 W !!,"THE DISPENSE DRUG IS MISSING FROM THIS ORDER."
"RTN","PSGOER0",62,0)
 D ENDRG^PSGOEF1(+^PS(55,PSGP,5,+PSGORD,.2),0)
"RTN","PSGOER0",63,0)
 I $G(DUOUT)!'$G(DRG) S COMQUIT=1 Q
"RTN","PSGOER0",64,0)
106 ; nature of order
"RTN","PSGOER0",65,0)
 S PSJNOO=$$ENNOO^PSJUTL5("R") S:PSJNOO<0 COMQUIT=1
"RTN","PSGOER0",66,0)
 S:PSJNOO'<0 PSGFOK(106)=""
"RTN","PSGOER0",67,0)
DONE ;
"RTN","PSGOER0",68,0)
 K F,F0,F1,PSGF2,F3,ND2,PSGDL,PSGDLS,PSGOROE1,PSGRO,SDT Q
"RTN","PSGOER0",69,0)
FF ; "^" to another field
"RTN","PSGOER0",70,0)
 K DIC S DIC="^DD(55.06,",DIC(0)="EQ",DIC("S")="I $D(PSGFOK(+Y))",X=$E(X,2,255) D ^DIC K DIC
"RTN","PSGOER0",71,0)
 S Y=+Y Q
"RTN","PSGOERI")
0^73^B16055121
"RTN","PSGOERI",1,0)
PSGOERI ;BIR/CML3-REINSTATE A DC'D ORDER ;06 Aug 98 / 2:17 PM
"RTN","PSGOERI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**17,27,31,88,110**;16 DEC 97
"RTN","PSGOERI",3,0)
 ;
"RTN","PSGOERI",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSGOERI",5,0)
 ;
"RTN","PSGOERI",6,0)
ENRI ;
"RTN","PSGOERI",7,0)
 S PSGALR=80,PSGFD=$P($G(^PS(55,PSGP,5,+PSGORD,2)),"^",3) I 'PSGFD W:'$D(PSJUNDC) $C(7),$C(7),!?3,"I CANNOT REINSTATE THIS ORDER!  THE OLD STOP DATE IS MISSING!" Q
"RTN","PSGOERI",8,0)
 I PSGFD'>PSGDT Q:$D(PSJUNDC)  W !!,"This order has technically expired as of ",$$ENDTC^PSGMI,"." F  S %=1 W !!,"Do you want to RENEW this order" D YN^DICN Q:%  D  ;
"RTN","PSGOERI",9,0)
 .W !!?2,"This order has expired, and cannot be renewed.  But the order can be",!,"reinstated.  Answer 'YES' to reinstate the order now.  Answer 'NO' (or '^') if",!,"you do not want to reinstate this order now."
"RTN","PSGOERI",10,0)
 I PSGFD'>PSGDT G:%'=1 DONE S PSGRRF=0 D NEW^PSGOER,DONE^PSGOER G DONE
"RTN","PSGOERI",11,0)
 W:'$D(PSJUNDC) !!,"...reinstating this order..."
"RTN","PSGOERI",12,0)
 ;Create a list of recipients beyond normal mail group
"RTN","PSGOERI",13,0)
 D:$D(PSJUNDC)  ;  do only if from movement deletion 
"RTN","PSGOERI",14,0)
 .I $P(^PS(55,PSGP,5,+PSGORD,4),U,1)'="" S PSJSENTO($J,$P(^PS(55,PSGP,5,+PSGORD,4),U,1))="" ; Record verifying Nurse
"RTN","PSGOERI",15,0)
 .I $P(^PS(55,PSGP,5,+PSGORD,4),U,3)'="" S PSJSENTO($J,$P(^PS(55,PSGP,5,+PSGORD,4),U,3))="" ; Record verifying Pharmacist
"RTN","PSGOERI",16,0)
 .I $P(^PS(55,PSGP,5,+PSGORD,4),U,5)'="" S PSJSENTO($J,$P(^PS(55,PSGP,5,+PSGORD,4),U,5))="" ; Record Physician
"RTN","PSGOERI",17,0)
 ;If a duplicate order exists do not reinstate the older one.  Record in ^TMP for later advice in auto e-mail (PSJADT2)
"RTN","PSGOERI",18,0)
 D NOW^%DTC
"RTN","PSGOERI",19,0)
 I $D(PSJUNDC) I $$CHECKDUP^PSGOERI(PSGP,+PSGORD) S ^TMP("PSJNOTUNDC",$J,PSGP,PSGORD_"U")="" G DONE
"RTN","PSGOERI",20,0)
 S DR=$S(+$P($G(^PS(55,PSGP,5,+PSGORD,4)),U,18)=1:"28///H",+$P($G(^(4)),U,26)=1:"28///H",1:"28////A")_";34////"_PSGFD
"RTN","PSGOERI",21,0)
 S Z=$G(^PS(55,PSGP,5,+PSGORD,4)),$P(Z,U,11)="",$P(Z,"^",15,17)="^^" S:'$D(PSJUNDC) $P(Z,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT S ^(4)=Z W "."
"RTN","PSGOERI",22,0)
 N CHKIT S CHKIT=$G(^PS(55,PSGP,5,+PSGORD,0)) I $P(CHKIT,U,26)["P",($P(CHKIT,U,27)="R") S DR=DR_";105///@;107///@"
"RTN","PSGOERI",23,0)
 S DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=$S($D(PSJUNDC):40,1:(PSJSYSU*10))+18500 D ^PSGAL5 W "." D ^DIE W "."
"RTN","PSGOERI",24,0)
 S X=$P(^PS(55,PSGP,5,+PSGORD,0),"^",20),$P(^(0),"^",20)="" K:X ^PS(55,"AUDDD",X,PSGP,+PSGORD) ;Removed cross reference after reinstate order.
"RTN","PSGOERI",25,0)
 ;S X=$O(^ORD(101,"B","PS EVSEND OR",0))_";ORD(101,",PSOC="SC",PSJORDER=$$ORDER^PSJHLU(PSGORD) D EN1^XQOR:X K X
"RTN","PSGOERI",26,0)
 S ^TMP("PSJUNDC",$J,PSGP,PSGORD_"U")=""
"RTN","PSGOERI",27,0)
 D EN1^PSJHL2(PSGP,"SC",PSGORD_"U",$S($D(PSJUNDC):"AUTO REINSTATED",1:"REINSTATED"))
"RTN","PSGOERI",28,0)
 Q:$S('$D(PSJUNDC):0,PSGALO=18540:1,1:'$P($G(PSJSYSW0),U,15))
"RTN","PSGOERI",29,0)
 S PSGTOL=$S($D(PSJUNDC):3,1:2),PSGUOW=$S($D(PSJUNDC):PSJUOW,1:DUZ)
"RTN","PSGOERI",30,0)
 I $D(^PS(53.41,1,1,+PSGUOW,1,PSGP,1,1,1,+PSGORD)) K DIK,DA S DIK="^PS(53.41,"_1_",1,"_+PSGUOW_",1,"_PSGP_",1,1,1,",DA=+PSGORD,DA(1)=1,DA(2)=PSGP,DA(3)=+PSGUOW,DA(4)=1 D ^DIK
"RTN","PSGOERI",31,0)
 E  D
"RTN","PSGOERI",32,0)
 .S X=0 S:$D(PSJUNDC) X=$O(^PS(59.6,"B",+PSGUOW,0)),X=$P($G(^PS(59.6,+X,0)),U,15)
"RTN","PSGOERI",33,0)
 .I $S(X:1,'PSJSYSL:0,PSJSYSL<3:1,1:$P(^PS(55,PSGP,5,DA,4),"^",+PSJSYSU'=3+9)) D
"RTN","PSGOERI",34,0)
 ..K DA S DA=+PSGORD,DA(1)=PSGP,$P(^PS(55,PSGP,5,DA,7),"^",1,2)=PSGDT_"^RE",PSGTOO=1,PSGUOW=$S($D(PSJUNDC):+PSJUOW,1:DUZ) D ENL^PSGVDS W "."
"RTN","PSGOERI",35,0)
 W:'$D(PSJUNDC) ".DONE!" Q
"RTN","PSGOERI",36,0)
 ;
"RTN","PSGOERI",37,0)
DONE ;
"RTN","PSGOERI",38,0)
 K DA,DIE,DR,PSGAL,PSGALR,PSGFD,PSGID,PSGOD,RF,Z
"RTN","PSGOERI",39,0)
 Q
"RTN","PSGOERI",40,0)
CHECKDUP(PSGP,PSGORD) ;
"RTN","PSGOERI",41,0)
 N Z,ZZ,PSJCOM
"RTN","PSGOERI",42,0)
 S FOUND=0
"RTN","PSGOERI",43,0)
 S PSGX=+$G(^PS(55,PSGP,5,+PSGORD,.2)),PSJCOM=+$P($G(^(.2)),"^",8)
"RTN","PSGOERI",44,0)
 I PSGX'="" D
"RTN","PSGOERI",45,0)
 .F Z=%:0 S Z=$O(^PS(55,+PSGP,5,"AUS",Z)) Q:'Z!FOUND  D
"RTN","PSGOERI",46,0)
 ..F ZZ=0:0 S ZZ=$O(^PS(55,+PSGP,5,"AUS",Z,ZZ)) Q:'ZZ!FOUND  D
"RTN","PSGOERI",47,0)
 ...I PSJCOM>0 Q:+$P($G(^PS(55,+PSGP,5,ZZ,.2)),"^",8)=PSJCOM
"RTN","PSGOERI",48,0)
 ...I +$G(^PS(55,+PSGP,5,ZZ,.2))=PSGX D
"RTN","PSGOERI",49,0)
 ....S FOUND=1
"RTN","PSGOERI",50,0)
 Q FOUND
"RTN","PSGOERS")
0^51^B37263384
"RTN","PSGOERS",1,0)
PSGOERS ;BIR/CML3-RENEW SELECTED ORDERS ;05 DEC 97 / 8:42 AM
"RTN","PSGOERS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,29,35,47,58,110**;16 DEC 97
"RTN","PSGOERS",3,0)
 ;
"RTN","PSGOERS",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180
"RTN","PSGOERS",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOERS",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSGOERS",7,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789
"RTN","PSGOERS",8,0)
 ; Reference to NOW^%DTC is supported by DBIA 10000
"RTN","PSGOERS",9,0)
 ;
"RTN","PSGOERS",10,0)
MARK ; only mark order, not actually renew
"RTN","PSGOERS",11,0)
 W !,"...marking ",PSGPDRGN," ",PSGDO,"..." S $P(^PS(55,PSGP,5,+PSGORD,4),"^",15,17)="1^"_DUZ_"^"_PSGDT,PSGAL("C")=13180 D ^PSGAL5 W "."
"RTN","PSGOERS",12,0)
 I $D(PSJSYSO) S PSGPOSA="R",PSGPOSD=PSGDT,PSGORD=+PSGORD_"A" D ENPOS^PSGVDS
"RTN","PSGOERS",13,0)
 Q
"RTN","PSGOERS",14,0)
RENEW ; mark or renew order
"RTN","PSGOERS",15,0)
 D NOW^%DTC K DA S DA(1)=PSGP,DA=+PSGORD,PSGDT=+$E(%,1,12)
"RTN","PSGOERS",16,0)
 ; do order checking
"RTN","PSGOERS",17,0)
 N PSJABT,PSGDRG ;* S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^")
"RTN","PSGOERS",18,0)
 ;* K PSGORQF D ENDDC^PSGSICHK(PSGP,+PSGDRG)
"RTN","PSGOERS",19,0)
 D OC55^PSGOER
"RTN","PSGOERS",20,0)
 I $D(PSGORQF) W !!,"  ",PSGOERS2,". ",$P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")," ",$P(^PS(55,PSGP,5,+PSGORD,.2),"^",2),!,"...No action taken on this order...",! Q
"RTN","PSGOERS",21,0)
 ;* Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSGOERS",22,0)
 ;
"RTN","PSGOERS",23,0)
 S PSGOER1=$G(^PS(55,PSGP,5,+PSGORD,.2)),PSGDO=$P(PSGOER1,"^",2),PSGPDRG=$P(PSGOER1,"^"),PSGPDRGN=$$ENPDN^PSGMI(PSGPDRG) I '$P(PSJSYSP0,"^",3) G MARK
"RTN","PSGOERS",24,0)
 S PSGOER0=$G(^PS(55,PSGP,5,+PSGORD,0)),PSGST=$P(PSGOER0,"^",7),PSGOER2=$G(^(2)),PSGND4=$G(^(4)),PSGSI=$G(^(6)),PSGOSD=$P(PSGOER2,"^",2),PSGOFD=$P(PSGOER2,"^",4),PSGNEDFD=$P($$GTNEDFD^PSGOE7("U",PSGPDRG),U)_"^^"_PSGST
"RTN","PSGOERS",25,0)
 N PSGOEAV S PSGOEAV=1,PSGOORD=PSGORD W "." K ^PS(53.45,PSJSYSP,1),^(2)
"RTN","PSGOERS",26,0)
 I $$CHKDD() W !!,"...",PSGPDRGN," ",PSGDO," order NOT renewed..." Q
"RTN","PSGOERS",27,0)
 W !!,"...renewing ",PSGOERS2,". ",PSGPDRGN," ",PSGDO,"..."
"RTN","PSGOERS",28,0)
 S PSGMR=$P(PSGOER0,"^",3),PSGMRN=$$ENMRN^PSGMI(PSGMR),PSGSM=$P(PSGOER0,"^",5),PSGHSM=$P(PSGOER0,"^",6),PSGPDRG=$P(PSGOER1,"^"),PSGDO=$P(PSGOER1,"^",2)
"RTN","PSGOERS",29,0)
 S PSGSCH=$P(PSGOER2,"^"),PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6),PSGNESD=PSGSD,PSGNEFD=$S(PSGST="O":PSGSD,1:PSGFD)
"RTN","PSGOERS",30,0)
 S:PSJPWD'=$P(PSGOER2,U,10) PSGS0Y=$$ENRNAT^PSGOU($P(PSGOER2,U,10),+PSJPWD,PSGSCH,PSGS0Y)
"RTN","PSGOERS",31,0)
 ;K ^PS(53.45,PSJSYSP,4) S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,12,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,4,Q,0)=$G(^(Q,0))
"RTN","PSGOERS",32,0)
 I $O(^PS(55,PSGP,5,+PSGORD,3,0)) S ^PS(53.45,PSJSYSP,1,0)=^(0),Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,3,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,1,Q,0)=$G(^(Q,0))
"RTN","PSGOERS",33,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) D
"RTN","PSGOERS",34,0)
 .S X=$O(^PS(55,PSGP,5,+PSGORD,1,0)) I X S (Q,Q1)=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$S('$P(ND,"^",3):1,1:$P(ND,"^",3)>DT) S Q1=Q1+1,^PS(53.45,PSJSYSP,2,Q1,0)=$P(ND,"^",1,3)
"RTN","PSGOERS",35,0)
 D SPEED^PSGOER
"RTN","PSGOERS",36,0)
 ; PSGP,PSGORD) D UPDREN(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO),UPDRENOE(PSGP,PSGORD,PSGDT
"RTN","PSGOERS",37,0)
 ;S:$S(X:Q1,1:0) ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_Q1_"^"_Q1 D ^PSGOETO I +PSJSYSU=3,PSGOORD["O" D EN^PSGPEN(+PSGORD)
"RTN","PSGOERS",38,0)
 ;W !,"...updating original order...",! K DA S DA(1)=PSGP,DA=+PSGOORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5
"RTN","PSGOERS",39,0)
 ;I PSGORD'["O",PSGSD<PSGOFD S PSGALR=70,DIE="^PS(55,"_PSGP_",5,",DR="34////"_+PSGSD S:PSGSD'>PSGDT DR=DR_";28////E"
"RTN","PSGOERS",40,0)
 ;I  D ^DIE I $P($G(^PS(55,PSGP,5,+PSGOORD,0)),"^",21) D EN1^PSJHL2(PSGP,"SC",PSGOORD,"ORDER EXPIRED")
"RTN","PSGOERS",41,0)
 ;S $P(PSGND4,"^",12,14)="^^",$P(PSGND4,"^",15,20)="^^^^^",$P(PSGND4,"^",22,24)="^^",^PS(55,PSGP,5,+PSGOORD,4)=PSGND4,$P(^(0),"^",26,27)=PSGORD_"^R"
"RTN","PSGOERS",42,0)
 Q
"RTN","PSGOERS",43,0)
CHKDD() ;
"RTN","PSGOERS",44,0)
 I '$$CHKDD^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",") Q 0
"RTN","PSGOERS",45,0)
 I $P(PSJSYSU,";")'=3,'$P(PSJSYSP0,U,2) W !!,"This order's dispense drug is invalid, a pharmacist must renew this order." Q 1
"RTN","PSGOERS",46,0)
 W !!,"THE DISPENSE DRUG IS MISSING FROM THIS ORDER."
"RTN","PSGOERS",47,0)
 D ENDRG^PSGOEF1(+^PS(55,PSGP,5,+PSGORD,.2),0)
"RTN","PSGOERS",48,0)
 I $G(DUOUT) W !,"ORDER NOT RENEW."
"RTN","PSGOERS",49,0)
 Q $G(DUOUT)!'$G(DRG)
"RTN","PSGOERS",50,0)
EN ;
"RTN","PSGOERS",51,0)
 Q:'$$HIDDEN^PSJLMUTL("SPEED")  S PSJSPEED=1
"RTN","PSGOERS",52,0)
 N PSGONR,CODE,ST,DRG,ON S PSGOEORF=1 D FULL^VALM1
"RTN","PSGOERS",53,0)
 S CODE="",PSGONR=0 F  S CODE=$O(^TMP("PSJ",$J,CODE)) Q:CODE'="A"  D
"RTN","PSGOERS",54,0)
 .S ST="" F  S ST=$O(^TMP("PSJ",$J,CODE,ST)) Q:ST=""  D
"RTN","PSGOERS",55,0)
 ..S DRG="" F  S DRG=$O(^TMP("PSJ",$J,CODE,ST,DRG)) Q:DRG=""  S ON="" F  S ON=$O(^TMP("PSJ",$J,CODE,ST,DRG,ON)) Q:ON=""  S PSGONR=PSGONR+1
"RTN","PSGOERS",56,0)
 S PSGONW="R",PSGLMT=PSGONR D ENWO^PSGON I "^"[X K X G DONE
"RTN","PSGOERS",57,0)
 S PSGOSD=0 F PSGOERS=1:1:PSGODDD F PSGOERS1=1:1 S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1) Q:'PSGOERS2  S Y=+^TMP("PSJON",$J,PSGOERS2),F=$G(^PS(55,PSGP,5,Y,0)),D=$G(^(.2)) D HMSG I F G EN
"RTN","PSGOERS",58,0)
 I $P(PSJSYSP0,"^",3) D  I '$D(PSGFOK) S X="" G DONE
"RTN","PSGOERS",59,0)
 .NEW PSGRENEW S PSGRENEW=1
"RTN","PSGOERS",60,0)
 .S PSGORD=^TMP("PSJON",$J,+PSGODDD(1)),DA=+PSGORD,DA(1)=PSGP,PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSGP,5.1)),1:0),PSGOEE="R" W ! D DATE^PSGOER0(PSGP,PSGORD,PSGDT)
"RTN","PSGOERS",61,0)
 .I '$D(PSGFOK(106)) W $C(7),!,"...order",$E("s",$L(PSGODDD(1),",")>2)," NOT renewed..." K PSGFOK Q
"RTN","PSGOERS",62,0)
 .I 'PSGNEDFD,$P(PSJSYSW0,"^",4),PSGFD'<PSGWLL S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSGOERS",63,0)
 ;W ! F PSGOERS=1:1:PSGODDD F PSGOERS1=1:1 S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1) Q:'PSGOERS2  S PSGORD=^TMP("PSJON",$J,PSGOERS2) D RENEW
"RTN","PSGOERS",64,0)
 W !
"RTN","PSGOERS",65,0)
 S EXITLOOP=0
"RTN","PSGOERS",66,0)
 F PSGOERS=1:1:PSGODDD D
"RTN","PSGOERS",67,0)
 .F PSGOERS1=1:1 D  Q:EXITLOOP=1
"RTN","PSGOERS",68,0)
 ..S PSGOERS2=$P(PSGODDD(PSGOERS),",",PSGOERS1)
"RTN","PSGOERS",69,0)
 ..I 'PSGOERS2 S EXITLOOP=1 Q
"RTN","PSGOERS",70,0)
 ..S PSGORD=^TMP("PSJON",$J,PSGOERS2)
"RTN","PSGOERS",71,0)
 ..I $$CHKCOM Q
"RTN","PSGOERS",72,0)
 ..I '$$LS^PSSLOCK(DFN,PSGORD) W !,$P($$DRUGNAME^PSJLMUTL(DFN,PSGORD),"^",1),!,"NO ACTION WAS TAKEN",!,$C(7) HANG 1 Q
"RTN","PSGOERS",73,0)
 ..D RENEW
"RTN","PSGOERS",74,0)
 ..; Call the unlock procedure
"RTN","PSGOERS",75,0)
 ..D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSGOERS",76,0)
 ..I $G(PSGOORD) D UNL^PSSLOCK(DFN,PSGOORD)
"RTN","PSGOERS",77,0)
 S X=""
"RTN","PSGOERS",78,0)
DONE ;
"RTN","PSGOERS",79,0)
 D INIT^PSJLMHED(1)
"RTN","PSGOERS",80,0)
 K DA,DIE,DR,FDSD,PSGAL,PSGALR,PSGFD,PSGFOK,PSGLMT,PSGND4,PSGODDD,PSGOERS,PSGOERS1,PSGOERS2,PSGONW,PSGOPR,PSGORD,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGSD,PSGST,PSGTOL,PSGTOO,PSGUOW,PSGWLL,PSJSPEED
"RTN","PSGOERS",81,0)
 Q
"RTN","PSGOERS",82,0)
GRI ; get renewal info
"RTN","PSGOERS",83,0)
HMSG ; hold/'not to be given' message
"RTN","PSGOERS",84,0)
 S X=$P($G(^PS(50.7,+D,0)),"^") S:X]"" X=X_" "_$P(D,"^",2)
"RTN","PSGOERS",85,0)
 I $P(F,"^",22) S H="has been marked as 'NOT TO BE GIVEN'" D WO Q
"RTN","PSGOERS",86,0)
 I $P(F,"^",9)="H" S H="is ON HOLD" D WO Q
"RTN","PSGOERS",87,0)
 I $P(F,"^",27)]"",$P(F,"^",26) S H="has been "_$S($P(F,"^",24)="E":"EDITED",1:"RENEWED") D WO Q
"RTN","PSGOERS",88,0)
 I ($P($G(^PS(50.7,+D,0)),"^",4)]"")&($P($G(^(0)),"^",4)'>DT) S H="is no longer an active Orderable Item" D WO Q
"RTN","PSGOERS",89,0)
 N PSGDFLG,DRG,DRGPT
"RTN","PSGOERS",90,0)
 S PSGDFLG=1 F DRG=0:0 S DRG=$O(^PSDRUG("ASP",+D,DRG)) Q:'DRG  I $P(^PSDRUG(DRG,2),U,3)["U",($G(^PSDRUG(DRG,"I"))=""!($G(^("I"))>DT)) S PSGDFLG=0 Q
"RTN","PSGOERS",91,0)
 I PSGDFLG S H="is no longer an active Dispense drug" D WO Q
"RTN","PSGOERS",92,0)
 S F=0,X=$P($G(^PS(55,PSGP,5,Y,2)),"^",2) S:X>PSGOSD PSGOSD=X Q
"RTN","PSGOERS",93,0)
WO ;
"RTN","PSGOERS",94,0)
 W $C(7),"  ??",! W:X]"" !,X S H1="Order number "_$G(PSGOERS2)_" "_H_", and cannot be renewed." W ! F H2=1:1:$L(H1," ") S H3=$P(H1," ",H2) W:$L(H3)+$X>78 ! W H3," "
"RTN","PSGOERS",95,0)
 S F=1 K H,H1,H2,H3 Q
"RTN","PSGOERS",96,0)
CHKCOM() ;       Check if this order is a complex order
"RTN","PSGOERS",97,0)
 S PSJCOM=0
"RTN","PSGOERS",98,0)
 I PSGORD=+PSGORD S PSJCOM=PSGORD W !,"  Order ",PSGOERS2," is part of a complex order series, and cannot be renewed.",! H 2 Q PSJCOM
"RTN","PSGOERS",99,0)
 S PSJCOM=$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8),1:$P($G(^PS(53.1,+PSGORD,.2)),U,8))
"RTN","PSGOERS",100,0)
 I PSJCOM  W !,"  Order ",PSGOERS2," is part of a complex order series, and cannot be renewed.",! H 2
"RTN","PSGOERS",101,0)
 Q PSJCOM
"RTN","PSGOETO")
0^52^B30209960
"RTN","PSGOETO",1,0)
PSGOETO ;BIR/CML3-TRANSCRIBE ORDERS ;25 Feb 99 / 1:17 PM
"RTN","PSGOETO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,13,25,31,33,50,68,58,85,105,90,117,110**;16 DEC 97
"RTN","PSGOETO",3,0)
 ;
"RTN","PSGOETO",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSGOETO",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOETO",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGOETO",7,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSGOETO",8,0)
 ;
"RTN","PSGOETO",9,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSGOETO",10,0)
 ;I '$D(PSJOERR),PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",11,0)
 I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",12,0)
 K ND4,DA D ENGNN:'PSGOEAV,ENGNA:PSGOEAV S PSGDT=$$DATE^PSJUTL2() I $S($D(ORACTION):0,$G(PSGOEE)="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:$G(PSGOEE)'="E") D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSGP)
"RTN","PSGOETO",13,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSGOETO",14,0)
 I PSGS0XT="D",'PSGS0Y S PSGS0Y=$E(PSGNESD_"00011",9,12)
"RTN","PSGOETO",15,0)
 ;S ND=DA_U_PSGPR_U_PSGMR_U_$E("UI",$D(PSGOEOS)+1)_U_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",$D(PSGOEOS):PSGOEOS,1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",16,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",17,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGOORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSGOETO",18,0)
 I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F
"RTN","PSGOETO",19,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSGOETO",20,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOETO",21,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSGOETO",22,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSGOETO",23,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSGOETO",24,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSGOETO",25,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSGOETO",26,0)
 ;S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND,^(.2)=PSGPDRG_U_PSGDO,$P(^(.2),U,5,6)=$P($G(PSJDOSE("DO")),U,1,2),^(2)=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",27,0)
 S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND
"RTN","PSGOETO",28,0)
 ;naked reference below refers to full reference inside indirection @(F_".2)") for either file 53.1 or 55
"RTN","PSGOETO",29,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2)
"RTN","PSGOETO",30,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD),PSGPDRG=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSGOETO",31,0)
 ;naked reference below refers to full reference inside indirection @(F_"2)") for either file 53.1 or 55
"RTN","PSGOETO",32,0)
 S @(F_"2)")=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",33,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSGOETO",34,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSGOETO",35,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSGOETO",36,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSGOETO",37,0)
 ;S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,4,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"12,"_C_",0)")=X
"RTN","PSGOETO",38,0)
 ;S:C @(F_"12,0)")=U_$S(PSGOEAV:55.0612,1:53.1012)_U_C_U_C
"RTN","PSGOETO",39,0)
 I $P(ND,U,24)="R" S %X="^PS(55,"_PSGP_",5,"_+PSGORD_",12,",%Y=F_"12," D %XY^%RCR
"RTN","PSGOETO",40,0)
 W "." D CRN:'PSGOEAV,CRA:PSGOEAV
"RTN","PSGOETO",41,0)
 ; don't send message to CPRS if from Order Set and autoverify turned off
"RTN","PSGOETO",42,0)
 S PSGORD=DA_$S(PSGOEAV:"U",1:"P") D:('$D(PSGOES))!(($D(PSGOES)&(PSGOEAV))) ORSET^PSGOETO1
"RTN","PSGOETO",43,0)
 I $D(PSGOES),'$D(PSGOESON) N PSGOESON S PSGOESON=PSGORD D DISACTIO^PSJOE(DFN,PSGORD,0) D:PSGORD["U"&(PSGOESON=PSGORD)&($P(@(PSGOEEWF_"0)"),"^",9)'="D") EN^PSGPEN(PSGORD) G OUT
"RTN","PSGOETO",44,0)
 ;D DONE S PSGCANFL="" I '$D(PSGOEE),$P(PSJSYSP0,U,12)<2 S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",45,0)
 D DONE S PSGCANFL="" I '$D(PSGOEE) S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",46,0)
 I $D(PSJSYSO) S PSGPOSA="W",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOETO",47,0)
 S DA=+PSGORD,X=$P(PSGORD,DA,2) I PSJSYSL,$S(PSGOEAV:1,1:PSJSYSL<3),$S("AOU"[X:'$D(^PS(55,PSGP,5,+PSGORD,7)),1:'$D(^PS(53.1,+PSGORD,7))) D
"RTN","PSGOETO",48,0)
 .; naked ref below is from line above, ^PS(53.1,+PSGORD,7)
"RTN","PSGOETO",49,0)
 .S $P(^(7),U,1,2)=PSGDT_"^N"_$G(PSGOEE),PSGUOW=DUZ,PSGTOL=2,PSGTOO=$S("AOU"[X:1,1:2) D ENL^PSGVDS
"RTN","PSGOETO",50,0)
OUT ;
"RTN","PSGOETO",51,0)
 K PSGOETOF
"RTN","PSGOETO",52,0)
DONE ;
"RTN","PSGOETO",53,0)
 I PSGOEAV L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOETO",54,0)
 I 'PSGOEAV L -^PS(53.1,+PSGORD)
"RTN","PSGOETO",55,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE
"RTN","PSGOETO",56,0)
 Q
"RTN","PSGOETO",57,0)
CRA ;
"RTN","PSGOETO",58,0)
 S:PSGPDRG ^PS(55,PSGP,5,"C",PSGPDRG,DA)="" S (^PS(55,"AUE",PSGP,DA),^PS(55,PSGP,5,"AU",PSGST,+PSGNEFD,DA),^PS(55,PSGP,5,"AUS",+PSGNEFD,DA))="",^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)="",^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOETO",59,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+PSGNESD,X(2)=+PSGNEFD,DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOETO",60,0)
 S DA(1)=PSGP K DIK S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOETO",61,0)
 K PSGALO,PSGALR S DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+$S('$D(PSGOEE):22500,PSGOEE="E":22600,1:22700) D ^PSGAL5 Q
"RTN","PSGOETO",62,0)
CRN ;
"RTN","PSGOETO",63,0)
 S (^PS(53.1,"AC",PSGP,DA),^PS(53.1,"AS","N",PSGP,DA),^PS(53.1,"B",DA,DA),^PS(53.1,"C",PSGP,DA))="" S:PSGPDRG (^PS(53.1,"AOD",PSGP,PSGPDRG,DA),^PS(53.1,"D",PSGPDRG,DA))="" Q
"RTN","PSGOETO",64,0)
ENGNA ;
"RTN","PSGOETO",65,0)
 F  L +^PS(55,PSGP,5,0):1 S:'$D(^PS(55,PSGP,0)) ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="" S ND=$S($D(^PS(55,PSGP,5,0)):^(0),1:"^55.06IA") Q
"RTN","PSGOETO",66,0)
 F DA=$P(ND,U,3)+1:1 W "." I '$D(^PS(55,PSGP,5,DA)),'$D(^PS(55,PSGP,5,"B",DA)) L +^PS(55,PSGP,5,DA):1 I  S ^PS(55,PSGP,5,DA,0)=DA,^PS(55,PSGP,5,"B",DA,DA)="",$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,PSGP,5,0)=ND Q
"RTN","PSGOETO",67,0)
 L -^PS(55,PSGP,5,0) Q
"RTN","PSGOETO",68,0)
ENGNN ;
"RTN","PSGOETO",69,0)
 N ND F  L +^PS(59.7,1,25):1 I  S DA=+$G(^PS(59.7,1,25)) Q
"RTN","PSGOETO",70,0)
 F DA=DA+1:1 I '$D(^PS(53.1,DA)),'$D(^PS(53.1,"B",DA)) L +^PS(53.1,DA):1 I  S ^PS(59.7,1,25)=DA,^PS(53.1,DA,0)=DA,^PS(53.1,"B",DA,DA)="" Q
"RTN","PSGOETO",71,0)
 F  L +^PS(53.1,0):1 I  S ND=$G(^PS(53.1,0)),$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^(0)=ND Q
"RTN","PSGOETO",72,0)
 L -^PS(59.7,1,25),-^PS(53.1,0)
"RTN","PSGOETO",73,0)
 Q
"RTN","PSGOEV")
0^53^B57816038
"RTN","PSGOEV",1,0)
PSGOEV ;BIR/CML3-VERIFY (MAKE ACTIVE) ORDERS ;4/8/99  08:16
"RTN","PSGOEV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,7,15,28,33,50,64,58,77,78,80,110**;16 DEC 97
"RTN","PSGOEV",3,0)
 ;
"RTN","PSGOEV",4,0)
 ; Reference to ^ORD(101 supported by DBIA #872.
"RTN","PSGOEV",5,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180.
"RTN","PSGOEV",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSGOEV",7,0)
 ; Reference to ^PSSLOCK supported by DBIA #2789.
"RTN","PSGOEV",8,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA 2410.
"RTN","PSGOEV",9,0)
 ;
"RTN","PSGOEV",10,0)
EN(PSGORD) ;
"RTN","PSGOEV",11,0)
ENSF ; This entry point is used by Speed finish only.
"RTN","PSGOEV",12,0)
 ; Send SN update to CPRS if autoverify off and from Order Set entry
"RTN","PSGOEV",13,0)
 I $D(PSGOES),'PSGOEAV,PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSGOEV",14,0)
 D FULL^VALM1 I 'PSJSYSU W $C(7),$C(7),!!," THIS FUNCTION NOT AVAILABLE TO WARD STAFF." Q
"RTN","PSGOEV",15,0)
 S CHK=0 I PSGORD["P" S X=$P($G(^PS(53.1,+PSGORD,0)),"^",19) I X,$D(^PS(55,PSGP,5,$P(^(0),"^",19))) S CHK=+PSGORD,PSGORD=X_"U" L -^PS(53.1,CHK) L +^PS(55,PSGP,5,+PSGORD):1 E  W !!,"Another terminal is editing this order." G DONE
"RTN","PSGOEV",16,0)
 I +PSJSYSU=3 D DDCHK G:CHK DONE
"RTN","PSGOEV",17,0)
 I PSGORD["P" D CHK($G(^PS(53.1,+PSGORD,0)),$G(^(.2)),$G(^(2)))
"RTN","PSGOEV",18,0)
 I CHK Q:$D(PSJSPEED)  D EN^VALM("PSJU LM ACCEPT") G:'$G(PSJACEPT) DONE ;G VFY
"RTN","PSGOEV",19,0)
 G:'$D(^PS(55,PSGP,5,+PSGORD,4)) VFY I +PSJSYSU=3,$P(^(4),"^",3) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A PHARMACIST." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",20,0)
 I +PSJSYSU=1,+^PS(55,PSGP,5,+PSGORD,4) W $C(7),!!,"THIS ORDER HAS ALREADY BEEN VERIFIED BY A NURSE." S PSGACT=$P(PSGACT,"V")_$P(PSGACT,"V",2) G DONE
"RTN","PSGOEV",21,0)
 ;
"RTN","PSGOEV",22,0)
VFY ; change status, move to 55, and change label record
"RTN","PSGOEV",23,0)
 I PSGORD["P" S PSJCOM=+$P($G(^PS(53.1,+PSGORD,.2)),"^",8) I PSJCOM D VFY^PSJCOM Q
"RTN","PSGOEV",24,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSGOEV",25,0)
 ;I 'PSGOEAV D DOSECHK^PSJDOSE
"RTN","PSGOEV",26,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOEV",27,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSGOEV",28,0)
 . S PSGOEEF(109)=1
"RTN","PSGOEV",29,0)
 . S PSJACEPT=0
"RTN","PSGOEV",30,0)
 . ;D EN^VALM("PSJU LM ACCEPT")
"RTN","PSGOEV",31,0)
 D DDCHK G:CHK DONE
"RTN","PSGOEV",32,0)
 W !,"...a few moments, please..."
"RTN","PSGOEV",33,0)
 ;/I PSGORD["P" S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",34,0)
 I PSGORD["P" D
"RTN","PSGOEV",35,0)
 . N PND0,PSGORDR,PSJPRIO,PSJSCHED S PND0=^PS(53.1,+PSGORD,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D  Q
"RTN","PSGOEV",36,0)
 .. Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",37,0)
 .. N OEORD,OOEORD,FILE55,FILE55N0 S FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSGOEV",38,0)
 .. S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,PSGORD,+$$LASTREN^PSJLMPRI(DFN,PSGORD))
"RTN","PSGOEV",39,0)
 .. S PSGORDP=PSGORD,DIE="^PS(53.1,",DA=+PSGORD,DR="28////A;104////@" W "." D ^DIE
"RTN","PSGOEV",40,0)
 .. D START^PSGOTR(PSGORD,+PSGORDR) I OEORD D
"RTN","PSGOEV",41,0)
 ... K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSGOEV",42,0)
 ... D EN1^PSJHL2(DFN,"SC",PSGORDR),EN^PSGPEN(PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSGOEV",43,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in 55
"RTN","PSGOEV",44,0)
 . D REQDT^PSJLIVMD(PSGORD)
"RTN","PSGOEV",45,0)
 . S DIE="^PS(53.1,",DA=+PSGORD,DR="28////A" W "." D ^DIE,^PSGOT
"RTN","PSGOEV",46,0)
 . S PSJPRIO=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,.2)),"^",4),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,.2)),"^",4),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,.2)),"^",4))
"RTN","PSGOEV",47,0)
 . S PSJSCHED=$S(PSGORD["P":$P($G(^PS(53.1,+PSGORD,2)),"^"),PSGORD["U":$P($G(^PS(55,DFN,5,+PSGORD,2)),"^"),1:$P($G(^PS(55,PSJHLDFN,"IV",+PSGORD,0)),"^",15))
"RTN","PSGOEV",48,0)
 . I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCHED)="NOW")!($G(PSJSCHED)["STAT") D NOTIFY^PSJHL4(PSGORD,DFN,$G(PSJPRIO),$G(PSJSCHED))
"RTN","PSGOEV",49,0)
 S DA=+PSGORD,DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+22000 D ^PSGAL5 W "." S VND4=$G(^PS(55,PSGP,5,DA,4))
"RTN","PSGOEV",50,0)
 I $G(PSGRDTX) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Start Date",+$G(PSGRDTX))
"RTN","PSGOEV",51,0)
 I $P($G(PSGRDTX),U,3) D NEWUDAL^PSGAL5(PSGP,PSGORD,6090,"Requested Stop Date",+$P($G(PSGRDTX),U,3))
"RTN","PSGOEV",52,0)
 N DUR,DURON S DURON=$S($G(PSGORD):$G(PSGORD),1:"") I DURON D
"RTN","PSGOEV",53,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",1:5),1),1:"")
"RTN","PSGOEV",54,0)
 I $G(DUR)]"" S $P(^PS(55,PSGP,5,+PSGORD,2.5),"^",2)=DUR
"RTN","PSGOEV",55,0)
 D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSGOEV",56,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSGOEV",57,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSGOEV",58,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",9):1,1:$P(VND4,"^",15)) D EN^PSGPEN(+PSGORD)
"RTN","PSGOEV",59,0)
 S $P(VND4,"^",+PSJSYSU=1+9)=1 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSGOEV",60,0)
 ;S $P(VND4,"^",+PSJSYSU=1+9)=1,$P(VND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOEV",61,0)
 I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSGOEV",62,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSGOEV",63,0)
 I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSGOEV",64,0)
 I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSGOEV",65,0)
 I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSGOEV",66,0)
 I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSGOEV",67,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSGOEV",68,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSGOEV",69,0)
 S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)="" S PSGACT="C"_$S('$D(^PS(55,PSGP,5,+PSGORD,4)):"E",$P(^(4),"^",16):"",1:"E")_"RS",PSGCANFL=2
"RTN","PSGOEV",70,0)
 ;S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",(+PSJSYSU=1)&$G(PSJRNF):"SC",1:"XX"),+PSGORD_"U")
"RTN","PSGOEV",71,0)
 S VALMBCK="Q" D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSGOEV",72,0)
 D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U")
"RTN","PSGOEV",73,0)
DONE ;
"RTN","PSGOEV",74,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSGOEV",75,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSGOEV",76,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSGOEV",77,0)
 .Q:Y="N"
"RTN","PSGOEV",78,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSGOEV",79,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X Q
"RTN","PSGOEV",80,0)
 ;
"RTN","PSGOEV",81,0)
LBL ;
"RTN","PSGOEV",82,0)
 ;F Q=0:0 S Q=$O(^PS(59.4,"ALN",Q)) Q:'Q  I $D(^(Q,PSGP,"N",+PSGODA)) S ^PS(59.4,"ALN",Q,PSGP,"A",+PSGORD)=^(+PSGODA) K ^PS(59.4,"ALN",Q,PSGP,"N",+PSGODA)
"RTN","PSGOEV",83,0)
 ;I $P(PSJSYSW0,"^",+PSJSYSU=3*4+12)<2 S ^PS(59.4,"ALN",DUZ,PSGP,"A",+PSGORD)=PSJSYSW_"^"_PSGDT,$P(^PS(55,PSGP,5,+PSGORD,7),"^",1,2)=PSGDT_"^N"
"RTN","PSGOEV",84,0)
 Q
"RTN","PSGOEV",85,0)
 ;
"RTN","PSGOEV",86,0)
CHK(ND,DRG,ND2) ; checks for data in required fields
"RTN","PSGOEV",87,0)
 ; Input: ND  - ^(PS(53.1,PSGORD,0)
"RTN","PSGOEV",88,0)
 ;        DRG - ^(.2)
"RTN","PSGOEV",89,0)
 ;        ND2 - ^(2)
"RTN","PSGOEV",90,0)
 S CHK="" I DRG,$D(^PS(50.7,+DRG,0))
"RTN","PSGOEV",91,0)
 E  S CHK=1
"RTN","PSGOEV",92,0)
 I ND="" S CHK=CHK_23
"RTN","PSGOEV",93,0)
 E  S CHK=CHK_$S($P(ND,"^",3):"",1:2)_$S($P(ND,"^",7)]"":"",1:3)
"RTN","PSGOEV",94,0)
 ;The naked reference on the line below refers to the variable ND which is ^PS(53.1,PSGORD,0).
"RTN","PSGOEV",95,0)
 I ND2="" S CHK=CHK_$S('$D(^(0)):4,$P(^(0),"^",7)="OC":"",1:4)_56
"RTN","PSGOEV",96,0)
 E  S CHK=CHK_$S($P(ND2,"^")]"":"",ND="":4,$P(ND,"^",7)="OC":"",1:4)_$S($P(ND2,"^",2):"",1:5)_$S($P(ND2,"^",4):"",1:6)
"RTN","PSGOEV",97,0)
 I $$CHECK^PSGOE8(PSJSYSP),$P(DRG,U,2)="" S CHK=CHK_8
"RTN","PSGOEV",98,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSGOEV",99,0)
 S:'$$DDOK^PSGOE2("^PS(53.45,"_PSJSYSP_",2,",+DRG) CHK=CHK_7,(PSGDFLG,PSGDI)=1
"RTN","PSGOEV",100,0)
 S:'$$OIOK^PSGOE2(+DRG) PSGPFLG=1
"RTN","PSGOEV",101,0)
 Q:'CHK
"RTN","PSGOEV",102,0)
 W $C(7)
"RTN","PSGOEV",103,0)
 ;
"RTN","PSGOEV",104,0)
CHKM ;
"RTN","PSGOEV",105,0)
 D FULL^VALM1
"RTN","PSGOEV",106,0)
 ; changed to remove ^DD ref
"RTN","PSGOEV",107,0)
 W !!,"THE FOLLOWING ",$S($L(CHK)>1:"ARE",1:"IS")," EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:7 W:CHK[X !?5,$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG","^",X)
"RTN","PSGOEV",108,0)
 W !,"Orders with no dispense drugs or multiple dispense drugs",!,"require dosage ordered"
"RTN","PSGOEV",109,0)
 W:CHK]"" !!,$S($L(CHK)>1:"THESE FIELDS ARE",1:"THIS FIELD IS")," NECESSARY FOR VERIFICATION."
"RTN","PSGOEV",110,0)
 N DIR S DIR(0)="E" D ^DIR I $D(DUOUT)!$D(DTOUT) S CHK=1 Q
"RTN","PSGOEV",111,0)
 Q
"RTN","PSGOEV",112,0)
 ;
"RTN","PSGOEV",113,0)
CONT() ;
"RTN","PSGOEV",114,0)
 NEW DIR,DIRUT,Y
"RTN","PSGOEV",115,0)
 W ! K DIR,DIRUT
"RTN","PSGOEV",116,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="Yes"
"RTN","PSGOEV",117,0)
 D ^DIR
"RTN","PSGOEV",118,0)
 Q Y
"RTN","PSGOEV",119,0)
 ;
"RTN","PSGOEV",120,0)
DDCHK ; dispense drug check
"RTN","PSGOEV",121,0)
 S DRGF="^PS("_$S(PSGORD["P":"53.1,"_+PSGORD,1:"55,"_PSGP_",5,"_+PSGORD)_",",CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSGOEV",122,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSGOEV",123,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSGOEV",124,0)
 Q:CHK=0
"RTN","PSGOEV",125,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSGOEV",126,0)
 ;
"RTN","PSGOEV",127,0)
DDEDIT ;
"RTN","PSGOEV",128,0)
 ;*** Remove all dispense drug for this order
"RTN","PSGOEV",129,0)
 K @(DRGF_"1)")
"RTN","PSGOEV",130,0)
 ; The naked reference below refers to the indirect full reference in DRGF_"1,"_Q_")", which is either ^PS(53.1,+PSGORD,Q) or ^PS(55,DFN,5,+PSGORD,Q)
"RTN","PSGOEV",131,0)
 K ^PS(53.45,PSJSYSP,2) S (X,Q)=0 F  S Q=$O(@(DRGF_"1,"_Q_")")) Q:'Q  S Y=$G(^(Q,0)),X=Q S ^PS(53.45,PSJSYSP,2,Q,0)=Y I Y S ^PS(53.45,PSJSYSP,2,"B",+Y,Q)=""
"RTN","PSGOEV",132,0)
 I X S ^PS(53.45,PSJSYSP,2,0)="^53.4502P^"_X_"^"_X
"RTN","PSGOEV",133,0)
 D ENDRG^PSGOEF1(PSGPD,X)
"RTN","PSGOEV",134,0)
 I 'CHK S %X="^PS(53.45,"_PSJSYSP_",2,",%Y=DRGF_"1," D %XY^%RCR S $P(@(DRGF_"1,0)"),"^",2)=$S(DRGF[53.1:"53.11P",1:"55.07P")
"RTN","PSGOEV",135,0)
 K DRG,DRGF Q
"RTN","PSGOEV",136,0)
 ;
"RTN","PSGOEV",137,0)
AESCREEN() ;
"RTN","PSGOEV",138,0)
 ; Output: 0 - Required fields missing and DON'T allow accept
"RTN","PSGOEV",139,0)
 ;         1 - Required fields found.
"RTN","PSGOEV",140,0)
 Q:'$G(CHK) 1
"RTN","PSGOEV",141,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSGOEV",142,0)
 I Y="PSJU LM ACCEPT EDIT" Q 1
"RTN","PSGOEV",143,0)
 Q 0
"RTN","PSGOEV",144,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSGOEV",145,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSGOEV",146,0)
 ;PSGORD : IEN from 55
"RTN","PSGOEV",147,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSGOEV",148,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSGOEV",149,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSGOEV",150,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55,09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSGOEV",151,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSGOEV",152,0)
 Q
"RTN","PSGOEVS")
0^54^B13320504
"RTN","PSGOEVS",1,0)
PSGOEVS ;BIR/CML3-SPEED VERIFY SELECTED ORDERS ;05 DEC 97 / 8:43 AM
"RTN","PSGOEVS",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,110**;16 DEC 97
"RTN","PSGOEVS",3,0)
 ;
"RTN","PSGOEVS",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSGOEVS",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSGOEVS",6,0)
 ;
"RTN","PSGOEVS",7,0)
EN ;
"RTN","PSGOEVS",8,0)
 I 'PSJSYSU W $C(7),!!,"THIS FUNCTION NOT AVAILABLE TO WARD STAFF." H 3 Q
"RTN","PSGOEVS",9,0)
 I '$D(PSJOCNT) W !!,"Speed verify is not available for IVs." H 3 Q
"RTN","PSGOEVS",10,0)
 W !,"Note: Only orders created by a RENEW can be speed verified."
"RTN","PSGOEVS",11,0)
 D FULL^VALM1
"RTN","PSGOEVS",12,0)
EN2 S PSGONV=PSJOCNT,PSJSPEED=1 D NOW^%DTC S PSGDT=+$E(%,1,2)
"RTN","PSGOEVS",13,0)
 S PSGONW="V",PSGLMT=PSGONV D ENWO^PSGON S PSJRB=X I "^"[X K X G DONE
"RTN","PSGOEVS",14,0)
 F PSGOEVS=1:1:PSGODDD F PSGOEVS1=1:1 S PSGOEVS2=$P(PSGODDD(PSGOEVS),",",PSGOEVS1) Q:'PSGOEVS2  D
"RTN","PSGOEVS",15,0)
 .S PSGORD=^TMP("PSJON",$J,PSGOEVS2)
"RTN","PSGOEVS",16,0)
 .I $$CHKIV Q
"RTN","PSGOEVS",17,0)
 .I $$CHKVER Q
"RTN","PSGOEVS",18,0)
 .;I '$$ACTIONS Q
"RTN","PSGOEVS",19,0)
 .N PSJCOM I $$CHKCOM Q
"RTN","PSGOEVS",20,0)
 .I '$$RENEWED Q
"RTN","PSGOEVS",21,0)
 .I $$FROMOERR Q
"RTN","PSGOEVS",22,0)
 .D VERIFY(PSJSPEED)
"RTN","PSGOEVS",23,0)
 ;
"RTN","PSGOEVS",24,0)
DONE ;
"RTN","PSGOEVS",25,0)
 K %,DA,N,PSGAL,PSGID,PSGLMT,PSGOD,PSGODDD,PSGOEVS,PSGOEVS1,PSGOEVS2
"RTN","PSGOEVS",26,0)
 K PSGONW,PSGORD,PSJRB,PSJRENEW,PSJSPEED
"RTN","PSGOEVS",27,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","PSGOEVS",28,0)
 Q
"RTN","PSGOEVS",29,0)
 ;
"RTN","PSGOEVS",30,0)
RENEWED() ;   was it created by a renew?
"RTN","PSGOEVS",31,0)
 S PSJRENEW=1
"RTN","PSGOEVS",32,0)
 I PSGORD'["P" D
"RTN","PSGOEVS",33,0)
 .S PSJRB=$G(^PS(55,PSGP,5,+PSGORD,.2))
"RTN","PSGOEVS",34,0)
 .S PSJRB=$$NAME(PSJRB)
"RTN","PSGOEVS",35,0)
 .W !!,"  ",PSGOEVS2,".  ",PSJRB
"RTN","PSGOEVS",36,0)
 .I $P(^PS(55,PSGP,5,+PSGORD,0),"^",24)'="R" D NOTREN Q
"RTN","PSGOEVS",37,0)
 E  I PSGORD["P" D
"RTN","PSGOEVS",38,0)
 .S PSJRB=$G(^PS(53.1,+PSGORD,.2))
"RTN","PSGOEVS",39,0)
 .S PSJRB=$$NAME(PSJRB)
"RTN","PSGOEVS",40,0)
 .W !!,"  ",PSGOEVS2,".  ",PSJRB
"RTN","PSGOEVS",41,0)
 .I $P(^PS(53.1,+PSGORD,0),"^",24)'="R" D NOTREN Q
"RTN","PSGOEVS",42,0)
 Q PSJRENEW
"RTN","PSGOEVS",43,0)
 ;
"RTN","PSGOEVS",44,0)
VERIFY(PSJSPEED) ;
"RTN","PSGOEVS",45,0)
 I '$$LS^PSSLOCK(PSGP,PSGORD) W !,"NO ACTION TAKEN ON ORDER",!  ; lock single order
"RTN","PSGOEVS",46,0)
 D GETUD^PSJLMGUD(PSGP,PSGORD),EN^PSGOEV(PSGORD)
"RTN","PSGOEVS",47,0)
 D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSGOEVS",48,0)
 Q
"RTN","PSGOEVS",49,0)
 ;
"RTN","PSGOEVS",50,0)
CHKVER() ;   check if already verified
"RTN","PSGOEVS",51,0)
 I $D(^PS(55,PSGP,5,+PSGORD,4)),$P(^(4),"^",PSJSYSU) S N=$P(^(4),"^",+PSJSYSU),PSGOD=$P(^(4),"^",PSJSYSU+1)
"RTN","PSGOEVS",52,0)
 I  D VMSG H 2
"RTN","PSGOEVS",53,0)
 Q $T
"RTN","PSGOEVS",54,0)
 ;
"RTN","PSGOEVS",55,0)
CHKIV() ;   check if this order is an IV
"RTN","PSGOEVS",56,0)
 I PSGORD["V"
"RTN","PSGOEVS",57,0)
 I  W !,"  Order ",PSGOEVS2," is an IV order.",! H 2
"RTN","PSGOEVS",58,0)
 Q $T
"RTN","PSGOEVS",59,0)
CHKCOM() ;       Check if this order is a complex order
"RTN","PSGOEVS",60,0)
 S PSJCOM=0
"RTN","PSGOEVS",61,0)
 I PSGORD=+PSGORD S PSJCOM=PSGORD W !,"  Order ",PSGOEVS2," is part of a complex order series, No change made.",! H 2 Q PSJCOM
"RTN","PSGOEVS",62,0)
 S PSJCOM=$S(PSGORD["U":$P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,8),1:$P($G(^PS(53.1,+PSGORD,.2)),U,8))
"RTN","PSGOEVS",63,0)
 I PSJCOM  W !,"  Order ",PSGOEVS2," is part of a complex order series, No change made.",! H 2
"RTN","PSGOEVS",64,0)
 Q PSJCOM
"RTN","PSGOEVS",65,0)
 ;
"RTN","PSGOEVS",66,0)
VMSG ;
"RTN","PSGOEVS",67,0)
 S N=$$ENNPN^PSGMI(N),PSJRB=$G(^PS(55,PSGP,5,+PSGORD,.2))
"RTN","PSGOEVS",68,0)
 S PSJRB=$$NAME(PSJRB)
"RTN","PSGOEVS",69,0)
 W !!,"  ",PSGOEVS2,".  ",PSJRB,!,"   was verified by ",N," on "
"RTN","PSGOEVS",70,0)
 W $$ENDTC^PSGMI(PSGOD),"."
"RTN","PSGOEVS",71,0)
 Q
"RTN","PSGOEVS",72,0)
NOTREN ;
"RTN","PSGOEVS",73,0)
 W !,"   was not created from a renew, No change made!" H 2
"RTN","PSGOEVS",74,0)
 S PSJRENEW=0
"RTN","PSGOEVS",75,0)
 Q
"RTN","PSGOEVS",76,0)
 ;
"RTN","PSGOEVS",77,0)
NAME(PSJRB)        ;
"RTN","PSGOEVS",78,0)
 I PSJRB S PSJRB=$$DRUGN_" "_$P(PSJRB,"^",2)
"RTN","PSGOEVS",79,0)
 E  S PSJRB="ORDERABLE ITEM - NOT FOUND"
"RTN","PSGOEVS",80,0)
 Q PSJRB
"RTN","PSGOEVS",81,0)
 ;
"RTN","PSGOEVS",82,0)
DRUGN() Q $P($$DRUGNAME^PSJLMUTL(PSGP,PSGORD),"^")
"RTN","PSGOEVS",83,0)
 ;
"RTN","PSGOEVS",84,0)
ACTIONS()    ;
"RTN","PSGOEVS",85,0)
 ;W !," ******  ",$$ENACTION^PSGOE1(PSGP,PSGORD)
"RTN","PSGOEVS",86,0)
 I $$ENACTION^PSGOE1(PSGP,PSGORD)["V"
"RTN","PSGOEVS",87,0)
 E  W !,PSGOEVS2,". CAN'T BE VERIFIED FOR SOME REASON!  ",PSGACT
"RTN","PSGOEVS",88,0)
 Q $T
"RTN","PSGOEVS",89,0)
 ;
"RTN","PSGOEVS",90,0)
FROMOERR()         ;  is it pending from OERR?
"RTN","PSGOEVS",91,0)
 I PSGORD["P"&($P($G(^PS(53.1,+PSGORD,0)),"^",9)="P")
"RTN","PSGOEVS",92,0)
 I  D
"RTN","PSGOEVS",93,0)
 .W !,"   is Pending from Order Entry/Results Reporting"
"RTN","PSGOEVS",94,0)
 .W ", No Change made." H 2
"RTN","PSGOEVS",95,0)
 Q $T
"RTN","PSGOT")
0^55^B13094729
"RTN","PSGOT",1,0)
PSGOT ;BIR/CML3-TRANSFERS DATA FROM 53.1 TO 55 ;24 SEP 97 / 7:54 AM
"RTN","PSGOT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**13,68,90,110**;16 DEC 97
"RTN","PSGOT",3,0)
 ;
"RTN","PSGOT",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOT",5,0)
 ;
"RTN","PSGOT",6,0)
START ; get internal record number, lock record, and write
"RTN","PSGOT",7,0)
 S ODA=+PSGORD S:$D(^PS(55,PSGP,0))[0 ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="",$P(^PS(55,0),U,3,4)=PSGP_U_($P($G(^PS(55,0)),U,4)+1) F  L +^PS(55,PSGP,5,0):1 I  Q
"RTN","PSGOT",8,0)
 S ZND=$G(^PS(55,PSGP,5,0)) S:ZND="" ZND="^55.06IA" F DA=$P(ZND,"^",3)+1:1 I '$D(^PS(55,PSGP,5,DA)),'$D(^("B",DA)) L +^PS(55,PSGP,5,DA):1 I  S $P(ZND,"^",3)=DA,$P(ZND,"^",4)=$P(ZND,"^",4)+1,^PS(55,PSGP,5,0)=ZND Q
"RTN","PSGOT",9,0)
 L -^PS(55,PSGP,5,0) S ND0=^PS(53.1,ODA,0),$P(ND0,"^",23)=PSJPWD,^PS(55,PSGP,5,DA,0)=ND0
"RTN","PSGOT",10,0)
 S (ND1,^PS(55,PSGP,5,DA,.2))=$G(^PS(53.1,ODA,.2)),^PS(55,PSGP,5,DA,.3)=$G(^PS(53.1,ODA,.3)),(ND2,^PS(55,PSGP,5,DA,2))=^PS(53.1,ODA,2),^PS(55,PSGP,5,DA,4)=$G(^PS(53.1,ODA,4)),^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOT",11,0)
 S X=^PS(55,PSGP,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(ND0,"^",16),"."),$P(X,"^",8)="A",^(0)=X
"RTN","PSGOT",12,0)
 F X=6,7 I $D(^PS(53.1,ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOT",13,0)
 I $D(^PS(53.1,ODA,"DSS")) S ^PS(55,PSGP,5,DA,8)=^("DSS")
"RTN","PSGOT",14,0)
 I $O(^PS(53.1,ODA,1,0)) S (C,X)=0 F  S X=$O(^PS(53.1,ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOT",15,0)
 ;F C=0:0 S C=$O(^PS(55,PSGP,5,DA,1,C)) Q:'C  S X=+$G(^(C,0)) S:X ^PS(55,PSGP,5,DA,1,"B",X,C)=""
"RTN","PSGOT",16,0)
 I $O(^PS(53.1,ODA,1,0)) S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOT",17,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOT",18,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOT",19,0)
 ;F X=3,12 I $O(^PS(53.1,ODA,X,0)) S ^PS(55,PSGP,5,DA,X,0)=^(0) F C=0:0 S C=$O(^PS(53.1,ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0)
"RTN","PSGOT",20,0)
 S $P(^PS(53.1,ODA,0),"^",19)=DA
"RTN","PSGOT",21,0)
CR ; set x-refs
"RTN","PSGOT",22,0)
 N A
"RTN","PSGOT",23,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOT",24,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,PSGP,5,"AU",$P(ND0,"^",7),+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",25,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",26,0)
 S ^PS(55,PSGP,5,"C",+ND1,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOT",27,0)
 S ^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOT",28,0)
 I $D(^PS(55,PSGP,5,DA,8)) S A=^(8),^PS(55,"AUDC",+$P(ND2,"^",4),+A,PSGP,DA)=""
"RTN","PSGOT",29,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOT",30,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOT",31,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,ODA)) K ^(ODA) D ENL^PSGVDS
"RTN","PSGOT",32,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOT",33,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOT",34,0)
 S PSGNODE=$G(^PS(55,PSGP,5,DA,0)),PSG25=$P(PSGNODE,"^",25),PSG26=$P(PSGNODE,"^",26)
"RTN","PSGOT",35,0)
 I PSG25 S X=$S(PSG25["V":"^PS(55,"_PSGP_",""IV"",",PSG25["U"!(PSG25["A"):"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSG25_","_$E("02",PSG25["V"+1)_")" I $D(@X) S $P(@X,"^",$S(PSG25["V":6,1:26))=DA_"U"
"RTN","PSGOT",36,0)
 I $P(PSGNODE,"^",26),$P(PSGNODE,"^",26)'["V",$D(^PS(55,PSGP,5,+$P(PSGNODE,"^",26),0)) S $P(^(0),"^",25)=DA_"U"
"RTN","PSGOT",37,0)
 ;I $P(PSGNODE,"^",21) S X=$O(^ORD(101,"B","PS EVSEND OR",0))_";ORD(101,",PSOC="SC",PSJORDER=$$ORDER^PSJHLU(PSGORD) D EN1^XQOR:X K X
"RTN","PSGOT",38,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOT",39,0)
 L -^PS(53.1,ODA) L -^PS(55,DFN,5,+PSGORD) K CNT,ND,ODA,XX,ZND Q
"RTN","PSGOTR")
0^78^B5594603
"RTN","PSGOTR",1,0)
PSGOTR ;BIR/TRANSFERS RENEW DATA FROM 53.1 TO 55 ;23 SEP 03 / 7:54 AM
"RTN","PSGOTR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSGOTR",3,0)
 ;
"RTN","PSGOTR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOTR",5,0)
 ; Reference to SPSPA^PSJXRFS is supported by DBIA 4264.
"RTN","PSGOTR",6,0)
 ;
"RTN","PSGOTR",7,0)
START(ODA,DA) ; lock record, and write
"RTN","PSGOTR",8,0)
 N OFD S OFD=""
"RTN","PSGOTR",9,0)
 S OFD=$P($G(^PS(55,PSGP,5,DA,2)),"^",4) K:OFD ^PS(55,"AUD",+OFD,PSGP,+DA)
"RTN","PSGOTR",10,0)
 S ND2=^PS(53.1,+ODA,2) S ^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOTR",11,0)
 F X=6,7 I $D(^PS(53.1,+ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOTR",12,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOTR",13,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,+ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOTR",14,0)
 S $P(^PS(53.1,+ODA,0),"^",19)=DA
"RTN","PSGOTR",15,0)
 N PSGPND0,PSGPND2 S PSGPND0=^PS(53.1,+ODA,0),PSGPND2=^(2) S RNWDT=$P(PSGPND0,"^",16),PSGOEPR=$P(PSGPND0,"^",2)
"RTN","PSGOTR",16,0)
 S PSGFD=$P(PSGPND2,"^",4),PSJNOO=$P(^PS(53.1,+ODA,.2),"^",3)
"RTN","PSGOTR",17,0)
 I '$G(DUOUT) D UPDREN^PSGOER(DA_"U",RNWDT,PSGOEPR,PSGFD,PSJNOO)
"RTN","PSGOTR",18,0)
CR ; set x-refs
"RTN","PSGOTR",19,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOTR",20,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)=""
"RTN","PSGOTR",21,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)="" I OFD,OFD'=$P(ND2,"^",4) K ^PS(55,PSGP,5,"AUS",+OFD,DA)
"RTN","PSGOTR",22,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOTR",23,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOTR",24,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,ODA)) K ^(ODA) D ENL^PSGVDS
"RTN","PSGOTR",25,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOTR",26,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOTR",27,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOTR",28,0)
 L -^PS(53.1,ODA) L -^PS(55,DFN,5,+PSGORD) K CNT,ND,ODA,XX,ZND Q
"RTN","PSGOU")
0^79^B31137117
"RTN","PSGOU",1,0)
PSGOU ;BIR/CML3,MV-PROFILE UTILITIES ;19 SEP 96 / 3:59 PM
"RTN","PSGOU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**34,110**;16 DEC 97
"RTN","PSGOU",3,0)
 ;
"RTN","PSGOU",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177
"RTN","PSGOU",5,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGOU",6,0)
 ;
"RTN","PSGOU",7,0)
ECHK ;
"RTN","PSGOU",8,0)
 D NOW^%DTC N PSGDT S PSGDT=% ;***Store PSGDT with seconds.
"RTN","PSGOU",9,0)
 S C="A",ON=O_"U" G:SD>PSGDT DS S ND=$G(^PS(55,PSGP,5,O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) DS S ND4=$G(^(4))
"RTN","PSGOU",10,0)
 I ST'="O",SD'<PSGODT,$P(ND,"^",9)="E",$P(ND4,"^",16) G DS
"RTN","PSGOU",11,0)
 I ST="O",$P(ND,"^",9)'["D",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16)) G DS
"RTN","PSGOU",12,0)
 Q:PSGOL="S"  S C="O"
"RTN","PSGOU",13,0)
 ;
"RTN","PSGOU",14,0)
DS ;
"RTN","PSGOU",15,0)
 NEW DRUGNAME D DRGDISP^PSJLMUT1(PSGP,+O_"U",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",16,0)
 ;
"RTN","PSGOU",17,0)
SET ;
"RTN","PSGOU",18,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSGOU",19,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSGOU",20,0)
 S ^TMP("PSG",$J,C,ST,DRG_"^"_ON)=$G(NF)
"RTN","PSGOU",21,0)
 Q
"RTN","PSGOU",22,0)
 ;
"RTN","PSGOU",23,0)
ENS F S=0:0 R !!,"Sort by DATE or MEDICATION:  M// ",PSGOS:DTIME D SCHK Q:CHK
"RTN","PSGOU",24,0)
 Q
"RTN","PSGOU",25,0)
 ;
"RTN","PSGOU",26,0)
ENL ;
"RTN","PSGOU",27,0)
 F  W !!,"SHORT, LONG, or NO Profile?  ",$S('$D(PSJPDD):"SHORT",'PSJPDD:"SHORT",1:"LONG"),"// " R PSGOL:DTIME W:'$T $C(7) S:'$T PSGOL="^" Q:PSGOL="^"  D LCHK Q:"^SLN"[PSGOL&($L(PSGOL)=1)
"RTN","PSGOU",28,0)
 Q
"RTN","PSGOU",29,0)
 ;
"RTN","PSGOU",30,0)
SCHK ;
"RTN","PSGOU",31,0)
 I '$T!(PSGOS["^") S PSGOS="^",CHK=1 Q
"RTN","PSGOU",32,0)
 S CHK=0 D:PSGOS["?" SM Q:PSGOS["?"  I PSGOS="" S PSGOS="M",CHK=1 W "MEDICATION" Q
"RTN","PSGOU",33,0)
 F X="DATE","MEDICATION" I $P(X,PSGOS)="" W $P(X,PSGOS,2) S PSGOS=$E(PSGOS),CHK=1 Q
"RTN","PSGOU",34,0)
 W:'CHK $C(7),"  ??" Q
"RTN","PSGOU",35,0)
 ;
"RTN","PSGOU",36,0)
SM W !!?3,"Enter 'MEDICATION' (or 'M', or press the RETURN key to have this patient's   orders shown alphabetically by drug name.  Enter 'DATE' (or 'D') to have this   patient's orders shown by start date (the newest orders showing first)."
"RTN","PSGOU",37,0)
 W "  Enter  a '^' to not show this patient's orders." Q
"RTN","PSGOU",38,0)
 ;
"RTN","PSGOU",39,0)
LCHK ;
"RTN","PSGOU",40,0)
 I PSGOL?1."?" D LM Q
"RTN","PSGOU",41,0)
 I PSGOL="" S PSGOL=$S('$D(PSJPDD):"S",'PSJPDD:"S",1:"L") W $S('$D(PSJPDD):"  SHORT",'PSJPDD:"  SHORT",1:"  LONG") Q
"RTN","PSGOU",42,0)
 I PSGOL?.E1L.E F Q=1:1:$L(PSGOL) I $E(PSGOL,Q)?1L S PSGOL=$E(PSGOL,1,Q-1)_$C($A(PSGOL,Q)-32)_$E(PSGOL,Q+1,$L(PSGOL))
"RTN","PSGOU",43,0)
 F X="NO PROFILE","LONG","SHORT" I $P(X,PSGOL)="" W $P(X,PSGOL,2) S PSGOL=$E(PSGOL) Q
"RTN","PSGOU",44,0)
 W:'$T $C(7),"  ??" Q
"RTN","PSGOU",45,0)
 ;
"RTN","PSGOU",46,0)
LM W !!?3,"Enter 'SHORT' (or 'S', or press the RETURN key) to exclude this patient's",!,"discontinued and expired orders in the following profile.  Enter 'LONG' (or 'L') to include those orders."
"RTN","PSGOU",47,0)
 W "  Enter 'NO' (or 'N') to bypass the profile com-",!,"pletely.  Enter '^' if you wish to go no further with this patient." Q
"RTN","PSGOU",48,0)
 ;
"RTN","PSGOU",49,0)
ENU ; update staus field to reflect expired orders, if necessary
"RTN","PSGOU",50,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSGOU",51,0)
ENUNM ;
"RTN","PSGOU",52,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGOU",53,0)
 F PSGO2=+PSJPAD:0 S PSGO2=$O(^PS(55,PSGP,5,"AUS",PSGO2)) Q:'PSGO2  Q:PSGO2>PSGDT  F PSGO3=0:0 S PSGO3=$O(^PS(55,PSGP,5,"AUS",PSGO2,PSGO3)) Q:'PSGO3  S PSGO4=$G(^PS(55,PSGP,5,PSGO3,0)) D
"RTN","PSGOU",54,0)
 .I PSGO4]"",$S($E($G(PSGALO),1,2)="10":"AHR"[$E($P(PSGO4,"^",9)),1:"AR"[$E($P(PSGO4,"^",9))) D ENUH
"RTN","PSGOU",55,0)
 K PSGO1,PSGO2,PSGO3,PSGO4,UD Q
"RTN","PSGOU",56,0)
 ;
"RTN","PSGOU",57,0)
ENGORD ; get and sort orders
"RTN","PSGOU",58,0)
 D NOW^%DTC S PSGDT=%,X1=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1) K ^TMP("PSG",$J)
"RTN","PSGOU",59,0)
 W:'$D(PSGPR) !!,"...a few moments, please..." D ENUNM
"RTN","PSGOU",60,0)
 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSGOU",61,0)
 Q:$D(PSGONNV)
"RTN","PSGOU",62,0)
 NEW DRUGNAME
"RTN","PSGOU",63,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",ND=$G(^PS(53.1,O,0)) I $P(ND,"^",4)="U" D
"RTN","PSGOU",64,0)
 . S ST=$P(ND,"^",7),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSGOU",65,0)
 . D DRGDISP^PSJLMUT1(PSGP,+O_"P",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",66,0)
 . S C=$S(P("PRNTON")]"":"BD",1:"BA") D SET
"RTN","PSGOU",67,0)
 Q:+PSJSYSU'=3  S SD="P",O=0
"RTN","PSGOU",68,0)
 N PRNTON F  S (PRNTON,O)=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",ND=$G(^PS(53.1,O,0)) I $P(ND,"^",4)="U" D
"RTN","PSGOU",69,0)
 . S ST=$P(ND,"^",7),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSGOU",70,0)
 . D DRGDISP^PSJLMUT1(PSGP,+O_"P",80,0,.DRUGNAME,1) S DRG=DRUGNAME(1)
"RTN","PSGOU",71,0)
 . S C=$$CKPC^PSGOU(PSGP,$P(ND,U,25),O)
"RTN","PSGOU",72,0)
 . I C="CB",$P($G(^PS(53.1,O,.2)),U,4)="S" S C="CA"
"RTN","PSGOU",73,0)
 . I P("PRNTON")]"" S C="CD"
"RTN","PSGOU",74,0)
 . D SET
"RTN","PSGOU",75,0)
 Q
"RTN","PSGOU",76,0)
 ;
"RTN","PSGOU",77,0)
MAE ; change status to expired
"RTN","PSGOU",78,0)
ENUH ;
"RTN","PSGOU",79,0)
 S $P(^PS(55,PSGP,5,PSGO3,0),"^",9)="E",ORIFN=$P(PSGO4,"^",21) I ORIFN D EN1^PSJHL2(PSGP,"SC",PSGO3_"U")
"RTN","PSGOU",80,0)
 Q
"RTN","PSGOU",81,0)
 ;
"RTN","PSGOU",82,0)
CKPC(DFN,OLDON,NEWON) ; Compare old provider comments to new for speed finish.
"RTN","PSGOU",83,0)
 N X,Y,Q,QQ,PSGOEEWF,PSJFLAG
"RTN","PSGOU",84,0)
 I $P($G(^PS(53.1,+NEWON,0)),U,24)'="R" Q "CB"
"RTN","PSGOU",85,0)
 S PSJFLAG=0,PSGOEEWF="^PS(55,"_DFN_","_$S(OLDON["V":"""IV""",1:5)_","_+OLDON_","
"RTN","PSGOU",86,0)
 S (Q,QQ)=0 F  S Q=$O(^PS(53.1,NEWON,12,Q)) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(@(PSGOEEWF_"12,"_Q_",0)")) I X'=Y S PSJFLAG=1 Q
"RTN","PSGOU",87,0)
 I PSJFLAG!$O(@(PSGOEEWF_"12,"_QQ_")")) Q "CB"
"RTN","PSGOU",88,0)
 S (Q,QQ)=0 F  S Q=$O(@(PSGOEEWF_"12,"_Q_")")) Q:'Q  S QQ=Q,X=$G(^(Q,0)),Y=$G(^PS(53.1,NEWON,12,Q,0)) I X'=Y S PSJFLAG=1 Q
"RTN","PSGOU",89,0)
 I PSJFLAG!$O(^PS(53.1,+NEWON,12,QQ)) Q "CB"
"RTN","PSGOU",90,0)
 Q "CC"
"RTN","PSGOU",91,0)
 ;
"RTN","PSGOU",92,0)
ENRNAT(OWD,NWD,SC,OAT) ; Determine admin times for renewal orders.
"RTN","PSGOU",93,0)
 ;OWD=ORIGINAL W, NWD=NEW WD LOCATION, SC=SCHEDULE, OAT=ORDER ADMIN TIMES
"RTN","PSGOU",94,0)
 N OWAT,SCP,X,Y
"RTN","PSGOU",95,0)
 S OOAT=OAT,SCP=+$O(^PS(51.1,"APPSJ",+SC,0)),WAT=$P($G(^PS(51.1,SCP,1,+$G(OWD),0)),U,2)
"RTN","PSGOU",96,0)
 F X="WAT","OAT" F Y=1:1 Q:$L(@X)>240!($P(@X,"-",Y)="")  S $P(@X,"-",Y)=$P(@X,"-",Y)_$E("0000",1,4-$L($P(@X,"-",Y)))
"RTN","PSGOU",97,0)
 I OAT'=WAT Q OOAT
"RTN","PSGOU",98,0)
 S X=$P($G(^PS(51.1,+SCP,1,NWD,0)),U,2) I X Q X
"RTN","PSGOU",99,0)
 Q OOAT
"RTN","PSGPEN")
0^125^B37095115
"RTN","PSGPEN",1,0)
PSGPEN ;BIR/CML3-FIND DEFAULT FOR PRE-EXCHANGE NEEDS ;03 Feb 99 / 9:13 AM
"RTN","PSGPEN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**30,37,50,58,115,110**;16 DEC 97
"RTN","PSGPEN",3,0)
 ;
"RTN","PSGPEN",4,0)
 ; References to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSGPEN",5,0)
 ; References to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSGPEN",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGPEN",7,0)
 ; Reference to ^PSDRUG is supported by DBIA #2192.
"RTN","PSGPEN",8,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGPEN",9,0)
 ;
"RTN","PSGPEN",10,0)
EN(PSGPENO) ;
"RTN","PSGPEN",11,0)
 S PSGPENO=+PSGPENO
"RTN","PSGPEN",12,0)
 N PSJSITE,PSJPRN S PSJSITE=0,PSJSITE=$O(^PS(59.7,PSJSITE)) I $P($G(^(PSJSITE,26)),U,5)=1 S PSJPRN=1
"RTN","PSGPEN",13,0)
 D NOW^%DTC S PSGDT=%,DT=$$DT^XLFDT,PSGPEN="" S ND=$G(^PS(55,PSGP,5,PSGPENO,0))
"RTN","PSGPEN",14,0)
 S PSGPENWS=0 I PSJPWD F Q=0:0 S Q=$O(^PS(55,PSGP,5,PSGPENO,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3),($D(^PSI(58.1,"D",+ND,PSJPWD))!$D(^PSD(58.8,"D",+ND,PSJPWD))) S PSGPENWS=1 Q
"RTN","PSGPEN",15,0)
 I PSGPENWS F  S Q=$O(^PS(55,PSGP,5,PSGPENO,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,'$P(ND,"^",3) S:'$D(^PSI(58.1,"D",+ND,PSJPWD))&'$D(^PSD(58.8,"D",+ND,PSJPWD)) PSGPENWS=0 Q:'PSGPENWS  S $P(PSGPENWS,"^",2)=1
"RTN","PSGPEN",16,0)
 I PSGPENWS W !!,"The dispense drug",$E("s",$P(PSGPENWS,"^",2))," for this order ",$S($P(PSGPENWS,"^",2):"are",1:"is a")," WARD STOCK item",$E("s",$P(PSGPENWS,"^",2)),"." S PSGPEN=0
"RTN","PSGPEN",17,0)
 I 'PSGPENWS,PSJPWD S WG=+$O(^PS(57.5,"AB",PSJPWD,0)),PSGPLS=$P($G(^PS(55,PSGP,5,PSGPENO,2)),"^",2) I PSGPLS D
"RTN","PSGPEN",18,0)
 .N RNDT S RNDT=+$$LASTREN^PSJLMPRI(PSGP,+PSGPENO_"U") I RNDT S PSGPLS=RNDT
"RTN","PSGPEN",19,0)
 .S PSGPLF=$O(^PS(53.5,"AB",WG,PSGDT)) D:'PSGPLF GF I PSGPLF S PSGPLO=PSGPENO D NCE,^PSGPL0 S:PSGPLC'<0 PSGPEN=PSGPLC
"RTN","PSGPEN",20,0)
 I $G(PSGPRIO)="DONE" S PSGPEN=0
"RTN","PSGPEN",21,0)
 ;
"RTN","PSGPEN",22,0)
UPDD ;
"RTN","PSGPEN",23,0)
 N DIR S DIR(0)="NOA^0:9999:0",DIR("A")="Pre-Exchange DOSES: ",DIR("?")="^D DH^PSGPEN" S:PSGPEN]"" DIR("B")=PSGPEN W ! D ^DIR G:'Y DONE S PSGY=+Y W !!,"...updating dispense drug(s)..."
"RTN","PSGPEN",24,0)
 F FQ=0:0 S FQ=$O(^PS(55,PSGP,5,PSGPENO,1,FQ)) Q:'FQ  S ND=$G(^(FQ,0)),$P(^(0),"^",9)="" I ND,'$P(ND,"^",3) D DD
"RTN","PSGPEN",25,0)
 ;
"RTN","PSGPEN",26,0)
DONE K PSGID,PSGMAR,PSGOD,PSGPLC,PSGPLF,PSGPLO,PSGPLS,PSGPLUD,WG Q
"RTN","PSGPEN",27,0)
 ;
"RTN","PSGPEN",28,0)
NCE ;
"RTN","PSGPEN",29,0)
 W !!,"The next cart exchange is ",$$ENDTC^PSGMI(PSGPLF),! Q
"RTN","PSGPEN",30,0)
 ;
"RTN","PSGPEN",31,0)
GF ;
"RTN","PSGPEN",32,0)
 S QQ=0 F Q=0:0 S Q=$O(^PS(53.5,"AB",WG,Q)) Q:'Q  S QQ=Q
"RTN","PSGPEN",33,0)
 I QQ S QQ=$O(^PS(53.5,"AB",WG,QQ,0)) I QQ,$D(^PS(53.5,QQ,0)) S QQ=$P(^(0),"^",4) I QQ>PSGDT S PSGPLF=QQ
"RTN","PSGPEN",34,0)
 Q
"RTN","PSGPEN",35,0)
 ;
"RTN","PSGPEN",36,0)
DD ;
"RTN","PSGPEN",37,0)
 N DA S DRG=$S($P(ND,"^")="":"NOT FOUND",'$D(^PSDRUG(+ND,0)):"NOT FOUND ("_$P(ND,"^")_")",$P(^(0),"^")]"":$P(^(0),"^"),1:$P(ND,"^")_";PSDRUG("),UD=$S('$P(ND,"^",2):1,1:$P(ND,"^",2))
"RTN","PSGPEN",38,0)
 W !,"...",DRG,?45,"U/D: ",UD,"..."
"RTN","PSGPEN",39,0)
 S PSGDA=PSGY I 'PSGPENWS,ND,PSJPWD,($D(^PSI(58.1,"D",+ND,PSJPWD))!$D(^PSD(58.8,"D",+ND,PSJPWD))) D PSGPENWS Q:'PSGDA
"RTN","PSGPEN",40,0)
 K DA,DR S PSGDA=$S(UD#1:(PSGDA*((UD\1)+1)),1:PSGDA*UD)
"RTN","PSGPEN",41,0)
 S DIE="^PS(55,"_PSGP_",5,"_PSGPENO_",1,",DA(2)=PSGP,DA(1)=PSGPENO,DA=FQ,DR=".09////"_PSGDA D ^DIE
"RTN","PSGPEN",42,0)
 D:'PSGPXN
"RTN","PSGPEN",43,0)
 .D NOW^%DTC L +^PS(53.4,0):0 S ND=$G(^PS(53.4,0)) S:ND="" ND="PRE-EXCHANGE NEEDS^53.4P" F PSGPXN=$P(ND,"^",3)+1:1 I '$D(^PS(53.4,PSGPXN)) L +^PS(53.4,PSGPXN):0 I  S ^PS(53.4,0)=$P(ND,"^",1,2)_"^"_PSGPXN_"^"_($P(ND,"^",4)+1) L -^PS(53.4,0) Q
"RTN","PSGPEN",44,0)
 .S ^PS(53.4,PSGPXN,0)=DUZ_"^"_%,^PS(53.4,"B",DUZ,PSGPXN)="",^PS(53.4,"AUD",DUZ,%,PSGPXN)="" L -^PS(53.4,PSGPXN) Q
"RTN","PSGPEN",45,0)
 I $D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,1,FQ,0)) S $P(^(0),"^",2)=$P(^(0),"^",2)+PSGDA Q
"RTN","PSGPEN",46,0)
 ; naked reference below refers to line above
"RTN","PSGPEN",47,0)
 S ^(0)=FQ_"^"_PSGDA I $D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,1,0)) S $P(^(0),"^",3,4)=FQ_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",48,0)
 ; naked reference below refers to line above
"RTN","PSGPEN",49,0)
 S ^(0)="^53.401101A^"_FQ_"^1" Q:$D(^PS(53.4,PSGPXN,1,PSGP,1,PSGPENO,0))  S ^(0)=PSGPENO
"RTN","PSGPEN",50,0)
 I $D(^PS(53.4,PSGPXN,1,PSGP,1,0)) S $P(^(0),"^",3,4)=PSGPENO_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",51,0)
 ; naked reference below is from line above
"RTN","PSGPEN",52,0)
 S ^(0)="^53.4011A^"_PSGPENO_"^1" Q:$D(^PS(53.4,PSGPXN,1,PSGP,0))  S ^(0)=PSGP
"RTN","PSGPEN",53,0)
 I $D(^PS(53.4,PSGPXN,1,0)) S $P(^(0),"^",3,4)=PSGP_"^"_($P(^(0),"^",4)+1) Q
"RTN","PSGPEN",54,0)
 ; naked reference below is from line above
"RTN","PSGPEN",55,0)
 S ^(0)="^53.401PA^"_PSGP_"^1" Q
"RTN","PSGPEN",56,0)
 ;
"RTN","PSGPEN",57,0)
DH ;
"RTN","PSGPEN",58,0)
 W !!?2,"Enter a number from 0 to 9999, 0 decimal digits."
"RTN","PSGPEN",59,0)
 W !!?2,"Enter the number DOSES needed for this order until the next cart exchange.",!,"This will be the number of times the order will be administered to the patient",!,"from the start of the order until the next cart exchange."
"RTN","PSGPEN",60,0)
 W !!?2,"PLEASE NOTE that this is DOSES, and NOT UNITS.  The doses entered will be",!,"converted to units for each dispense drug of this order, as each dispense drug",!,"may have a different units per dose." Q
"RTN","PSGPEN",61,0)
 ;
"RTN","PSGPEN",62,0)
PSGPENWS ;
"RTN","PSGPEN",63,0)
 W !,"This dispense drug is a WARD STOCK item."
"RTN","PSGPEN",64,0)
 W !,"Would you like to:",!?3,"1 - Enter 0 (no) doses needed for this dispense drug.",!?3,"2 - Enter ",PSGDA," doses needed for this dispense drug.",!?3,"3 - Enter another amount as the doses needed for this dispense drug."
"RTN","PSGPEN",65,0)
 K DIR S DIR(0)="SA^1:0 (no) doses;2:"_PSGDA_" doses;3:another amount",DIR("A")="Select ACTION: ",DIR("?")="^D WH^PSGPEN" W ! D ^DIR I Y=1!'Y S PSGDA=0 Q
"RTN","PSGPEN",66,0)
 Q:Y=2  K DIR S DIR(0)="NA^0:9999:0",DIR("A")="Pre-Exchange DOSES for this dispense drug: ",DIR("?")="^D WDH^PSGPEN" W ! D ^DIR S PSGDA=+Y Q
"RTN","PSGPEN",67,0)
 ;
"RTN","PSGPEN",68,0)
WH ;
"RTN","PSGPEN",69,0)
 S Q="This dispense drug ("_DRG_") is a ward stock item.  Select:"
"RTN","PSGPEN",70,0)
 W !! F Q1=1:1:$L(Q," ") S Q2=$P(Q," ",Q1) W:$X+$L(Q2)>78 ! W Q2," "
"RTN","PSGPEN",71,0)
 W !?3,"1 to enter 0 (no) pre-exchange doses for this dispense drug.",!?3,"2 to enter ",PSGDA," doses for this dispense drug.",!?3,"3 to enter another amount for this dispense drug." Q
"RTN","PSGPEN",72,0)
 ;
"RTN","PSGPEN",73,0)
WDH ;
"RTN","PSGPEN",74,0)
 W !!?2,"Enter a number from 0 to 9999, 0 decimal digits.  If you enter an '^' to exit",!,"NO pre-exchange doses will be entered for this dispense drug." Q
"RTN","PSGPL0")
0^126^B32182582
"RTN","PSGPL0",1,0)
PSGPL0 ;BIR/CML3-GETS UNITS COUNT FOR PSGPL & PSGPEN ;29 OCT 96 / 8:31 PM
"RTN","PSGPL0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,83,110**;16 DEC 97
"RTN","PSGPL0",3,0)
 ;
"RTN","PSGPL0",4,0)
 ; Reference to ^PS(51.1 supported by DBIA #2177.
"RTN","PSGPL0",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGPL0",6,0)
 ;
"RTN","PSGPL0",7,0)
EN ;
"RTN","PSGPL0",8,0)
 K PSGMAR S PSGPLC=0 D RUN
"RTN","PSGPL0",9,0)
 ;
"RTN","PSGPL0",10,0)
DONE K HCD,HM,I,J,PSGD,PLSD,CD,M,MID,MN,ND,ND1,OD,ST,QD1,QD2,QQ,TS,UD,WDT,WS,WS1,X,X1,X2 Q
"RTN","PSGPL0",11,0)
 ;
"RTN","PSGPL0",12,0)
RUN ; quit if fill on request prn or stop date not found
"RTN","PSGPL0",13,0)
 S ND1=$P($G(^PS(55,PSGP,5,PSGPLO,0)),"^",7) Q:('$D(PSGMFOR)&(ND1="R"))  I $F("OCP",ND1)-1'>0,('$D(PSGMFOR)) S PSGPLC="OI" Q
"RTN","PSGPL0",14,0)
 S ND=$G(^PS(55,PSGP,5,PSGPLO,2)) Q:($P(ND,"^")["PRN")&('$D(PSJPRN))  Q:$P(ND,"^")="PRN"
"RTN","PSGPL0",15,0)
 S ST=$P(ND,"^",2) N RNDT S RNDT=+$$LASTREN^PSJLMPRI(PSGP,+PSGPLO_"U") I RNDT S ST=RNDT
"RTN","PSGPL0",16,0)
 S PLSD=$P(ND,"^",4),TS=$P(ND,"^",5),MN=$P(ND,"^",6),ND=$P(ND,"^") D:ND["PRN" SETMN I $S(ST'?7N1"."1N.E:1,1:PLSD'?7N1"."1N.E) S PSGPLC="OI" Q
"RTN","PSGPL0",17,0)
ENIV ;*** Entry to be called from ^PSGMIV (24 HOUR MAR IV).
"RTN","PSGPL0",18,0)
 Q:ST'<PSGPLF  I ND1="O"!(ND1="OC")!(MN="O") S PSGPLC=PLSD'<PSGPLS S:ND1'["C"&PSGPLC PSGMAR($E(+$P(ST,".",2)_"0",1,2))="" Q
"RTN","PSGPL0",19,0)
 I (TS'>0!("24"'[$L($P(TS,"-")))),MN="",ND'["@" S PSGPLC="OI" Q
"RTN","PSGPL0",20,0)
 S CD=$S(PSGPLF>PLSD:PLSD,1:PSGPLF),OD=$S(ST>PSGPLS:ST,1:PSGPLS),MID=1 I ND["@"!(MN="D") G MWF
"RTN","PSGPL0",21,0)
 I MN>1440,TS,'(MN#1440) G TSFMN
"RTN","PSGPL0",22,0)
 I TS>0,"24"[$L($P(TS,"-")) S:PSGPLS>ST ST=PSGPLS G TS
"RTN","PSGPL0",23,0)
 ;
"RTN","PSGPL0",24,0)
MN ; if only minutes (MN) are found
"RTN","PSGPL0",25,0)
 I MN'>0 S PSGPLC="OI" Q
"RTN","PSGPL0",26,0)
 S (OD,X1)=PSGPLS,HM=MN,X2=ST D ^%DTC I X>1 S AM=X-1*1440\HM*HM D ADD S ST=X
"RTN","PSGPL0",27,0)
 S (CML,X)=ST F I=0:1 S AM=HM*I,ST=CML D:AM ADD Q:X>CD!(CD=PLSD&(X'<CD))  I X'<OD S PSGPLC=PSGPLC+1,PSGMAR($E($P(X,".",2)_"0",1,2))=""
"RTN","PSGPL0",28,0)
 S ST=CML Q
"RTN","PSGPL0",29,0)
 ;
"RTN","PSGPL0",30,0)
TSFMN ;if admin times exist and minutes#1440=0
"RTN","PSGPL0",31,0)
 S X=$P(ST,"."),MID=MN\1440 F I=0:1 S X1=$P(ST,"."),X2=MID*I D:X2 C^%DTC Q:X'<CD  I X'<(PSGPLS\1) S ST=$S(PSGPLS\1=X:$S(PSGPLS#1<(ST#1):ST,1:PSGPLS),PSGPLS\1<X:ST,1:PSGPLS) G TS
"RTN","PSGPL0",32,0)
 Q
"RTN","PSGPL0",33,0)
 ;
"RTN","PSGPL0",34,0)
TS ; admin times
"RTN","PSGPL0",35,0)
 F Q=1:1 S XX=$P(TS,"-",Q) Q:XX=""!(("."_XX)'<(ST#1))
"RTN","PSGPL0",36,0)
TS1 X:XX="" "S X1=ST\1,X2=MID D C^%DTC S ST=X,Q=1" F QQ=Q:1 S XX=$P(TS,"-",QQ) G:XX="" TS1 S ST=$P(ST,".")_"."_XX Q:ST>CD!(CD=PLSD&(ST'<CD))  S:PSGPLS'>ST PSGPLC=PSGPLC+1,PSGMAR($E(XX_"0",1,2))=""
"RTN","PSGPL0",37,0)
 Q
"RTN","PSGPL0",38,0)
 ;
"RTN","PSGPL0",39,0)
MWF ; schedule in form of WD-WD-WD@TS
"RTN","PSGPL0",40,0)
 S:ND["@" ND=$P(ND,"@") S:'TS TS=$E($P(ST,".",2)_"0000",1,4) S HCD=CD,X=$P(OD,".")
"RTN","PSGPL0",41,0)
 S MN="-" I ND'["-",ND?.E1P.E F FQ=1:1:$L(ND) I $E(ND,FQ)?1P S MN=$E(ND,FQ) Q
"RTN","PSGPL0",42,0)
 F FQ=0:1 S X1=$P(OD,"."),X2=FQ D:X2 C^%DTC Q:X>$P(HCD,".")  S CD=$S($P(HCD,".")>X:X_.24,1:HCD),ST=$S($P(OD,".")<X:X_.0001,1:OD) D DW^%DTC S X=X_"S" F FQ1=1:1:$L(ND,MN) I $P(X,$P(ND,MN,FQ1))="" D TS Q
"RTN","PSGPL0",43,0)
 Q
"RTN","PSGPL0",44,0)
 ;
"RTN","PSGPL0",45,0)
ADD ; ST=start date/time   AM=minutes (+ or -)  X=new date/time
"RTN","PSGPL0",46,0)
 S:'AM X=ST Q:'AM  S T=1 S:AM<0 T=-1,AM=-AM S X2=AM\1440,AM=AM-(X2*1440),H=AM\60,M=AM#60,HRS=+$E(ST_"00",9,10),MN=+$E(ST_"0000",11,12),X=ST\1
"RTN","PSGPL0",47,0)
 I M S MN=MN+(M*T) S:MN>59 MN=MN-60,H=H+1 S:MN<0 MN=MN+60,H=H+1
"RTN","PSGPL0",48,0)
 I H S HRS=HRS+(H*T) S:HRS>24!(HRS=24&MN) HRS=HRS-24,X2=X2+1 S:HRS<0 HRS=HRS+24,X2=X2+1
"RTN","PSGPL0",49,0)
 I X2 S X1=$P(X,"."),X2=X2*T D C^%DTC
"RTN","PSGPL0",50,0)
 S X=+(X_"."_$E(0,HRS<10)_HRS_$E(0,MN<10)_MN) K AM,H,HRS,M,MN,T Q
"RTN","PSGPL0",51,0)
 ;
"RTN","PSGPL0",52,0)
SETMN ; Set MN for PRN orders
"RTN","PSGPL0",53,0)
 Q:($G(MN)]"")!($G(TS)]"")!(ND["Q0")  S MNFL=0,MN="",TS="" F XX=0:0 S XX=$O(^PS(51.1,"AC","PSJ",ND,XX)) Q:'XX!(MNFL)  D
"RTN","PSGPL0",54,0)
 .S:$P($G(^PS(51.1,XX,0)),"^",3)'="" MN=$P($G(^(0)),"^",3),MNFL=1 S:$P($G(^(0)),"^",2)'="" TS=$P($G(^(0)),"^",2),MNFL=1 Q
"RTN","PSGPL0",55,0)
 I 'MNFL,$E(ND,1,3)'="PRN" D
"RTN","PSGPL0",56,0)
 .S PRND=$P(ND,"PRN") D:$E(PRND,$L(PRND))=" "  F XX=0:0 S XX=$O(^PS(51.1,"AC","PSJ",PRND,XX)) Q:'XX!(MNFL)  S:$P($G(^PS(51.1,XX,0)),"^",3)'="" MN=$P($G(^(0)),"^",3),MNFL=1 S:$P($G(^(0)),"^",2)'="" TS=$P($G(^(0)),"^",2),MNFL=1
"RTN","PSGPL0",57,0)
 ..F  S PRND=$E(PRND,1,$L(PRND)-1) Q:$E(PRND,$L(PRND))'=" "
"RTN","PSGPL0",58,0)
 I 'MNFL,$E(ND,1,3)="PRN" S PRND=$P(ND,"PRN",2) D:$E(PRND)=" "  F XX=0:0 S XX=$O(^PS(51.1,"AC","PSJ",PRND,XX)) Q:'XX!(MNFL)  S:$P($G(^PS(51.1,XX,0)),"^",3)'="" MN=$P($G(^(0)),"^",3),MNFL=1 S:$P($G(^(0)),"^",2)'="" TS=$P($G(^(0)),"^",2),MNFL=1
"RTN","PSGPL0",59,0)
 .F  S PRND=$E(PRND,2,$L(PRND)) Q:$E(PRND)'=" "
"RTN","PSGPL0",60,0)
 I 'MNFL D
"RTN","PSGPL0",61,0)
 .I PRND["@" D DW S:$D(PRND) TS=$P(PRND,"@",2) Q
"RTN","PSGPL0",62,0)
 .I $E(PRND,1,2)="AD" Q
"RTN","PSGPL0",63,0)
 .I $E(PRND,1,3)="BID"!($E(PRND,1,3)="TID")!($E(PRND,1,3)="QID") S MN=1440/$F("BTQ",$E(PRND)) Q
"RTN","PSGPL0",64,0)
 .S:$E(PRND)="Q" PRND=$E(PRND,2,99) S:'PRND PRND="1"_PRND S PRND1=+PRND,PRND=$P(PRND,+PRND,2),PRND2=0 S:PRND1<0 PRND1=-PRND1 S:$E(PRND)="X" PRND2=1,PRND=$E(PRND,2,99)
"RTN","PSGPL0",65,0)
 .S MN=$S((PRND["D"&(PRND'["AD"))!(PRND["AM")!(PRND["PM")!((PRND["HS")&(PRND'["THS")):1440,((PRND["H")&(PRND'["TH")):60,PRND["AC"!(PRND["PC"):480,PRND["W":10080,PRND["M":40320,1:-1) I MN>0 S:PRND["QO" MN=MN*2 S MN=MN*PRND1 Q:MN>0
"RTN","PSGPL0",66,0)
QUIT K XX,MNFL,PRND,PRND1,PRND2,QX,SDW,SWD,Z Q
"RTN","PSGPL0",67,0)
 ;
"RTN","PSGPL0",68,0)
DW ;
"RTN","PSGPL0",69,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=PRND,PRND=$P(PRND,"@",2) D ENCHK Q:'$D(PRND)  S PRND=$P(SDW,"@"),PRND(1)="-" I PRND?.E1P.E,PRND'["-" F QX=1:1:$L(PRND) I $E(PRND,QX)?1P S PRND(1)=$E(PRND,QX) Q
"RTN","PSGPL0",70,0)
 F Q=1:1:$L(PRND,PRND(1)) K:SWD="" PRND Q:SWD=""  S Z=$P(PRND,PRND(1),Q) D DWC Q:'$D(PRND)
"RTN","PSGPL0",71,0)
 K PRND(1) S:$D(PRND) PRND=SDW Q
"RTN","PSGPL0",72,0)
DWC I $L(Z)<2 K PRND Q
"RTN","PSGPL0",73,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGPL0",74,0)
 E  K PRND
"RTN","PSGPL0",75,0)
 Q
"RTN","PSGPL0",76,0)
 ;
"RTN","PSGPL0",77,0)
ENCHK ;
"RTN","PSGPL0",78,0)
 I $S($L($P(PRND,"-"))>4:1,$L(PRND)>119:1,$L(PRND)<2:1,PRND'>0:1,1:PRND'?.ANP) K PRND Q
"RTN","PSGPL0",79,0)
 S PRND(1)=$P(PRND,"-") I PRND(1)'?2N,PRND(1)'?4N K PRND Q
"RTN","PSGPL0",80,0)
 S PRND(1)=$L(PRND(1)) I PRND'["-",PRND>$E(2400,1,PRND(1)) K PRND Q
"RTN","PSGPL0",81,0)
 F PRND(2)=2:1:$L(PRND,"-") S PRND(3)=$P(PRND,"-",PRND(2)) I $S($L(PRND(3))'=PRND(1):1,PRND(3)>$E(2400,1,PRND(1)):1,1:PRND(3)'>$P(PRND,"-",PRND(2)-1)) K PRND Q
"RTN","PSGPL0",82,0)
 K:$D(PRND) PRND(1),PRND(2),PRND(3) Q
"RTN","PSGPL0",83,0)
  
"RTN","PSGPL0",84,0)
  
"RTN","PSGPR")
0^18^B30527299
"RTN","PSGPR",1,0)
PSGPR ;BIR/CML3-PATIENT PROFILE ;19 SEP 96 / 3:59 PM
"RTN","PSGPR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSGPR",3,0)
 ;* N PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",4,0)
 N PSGLI,PSGOE,PSGOEEWF,PSGOH,PSGWD,PSJPWDO,PSJSTOP,PSJTEAM
"RTN","PSGPR",5,0)
 N ACTION,CONT,PAT,LD,LN2,PFLG,PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",6,0)
 ;
"RTN","PSGPR",7,0)
 S PSJOPC="UD"
"RTN","PSGPR",8,0)
 D ENCV^PSGSETU I '$D(XQUIT) F PSGPR=0:0 S (PSGP,PSGPRWD,PSGPRWG)=0,(PSGPRWDN,PSGPRWGN)="",PSGSSH="PPR" S PSGPTMP=0,PPAGE=1 D GWP^PSJPDIR Q:'$D(PSJSEL)  D @PSJSEL("SELECT")  D ENL^PSGOU I "^N"'[PSGOL D GO
"RTN","PSGPR",9,0)
 ;
"RTN","PSGPR",10,0)
DONE ;
"RTN","PSGPR",11,0)
 D:'$D(PSGOEPRF) ENKV^PSGSETU K AND,AT,C,CA,DOB,DRGI,FQC,MF,ND,NF,O,ON,PG,PN,PSGON,PSGORD,PRI,PSGONC,PSGONR,PSGONV,PSGSEL,PX,^TMP("PSGPR",$J)
"RTN","PSGPR",12,0)
 K RCT,PSGAPTM,PSGOL,PSGOS,PSGPR,PSGSS,PSGSSH,PSGPATM,PSGPRWD,PSGPRWDN,PSGPRWG,PSGPRWGN,PSGPRA,PSGPRP,PSJOPC,PSJSEL,S1,S2,S3,S4,HDT,PSGODT,QFLG,RF,SD,SLS,SSN,TF,TM,UD,UDU,WD,WDP,WT,ZTOUT,ZTSK,OD,PDRG
"RTN","PSGPR",13,0)
 Q
"RTN","PSGPR",14,0)
 ;
"RTN","PSGPR",15,0)
GO ;
"RTN","PSGPR",16,0)
 S PSGPRP="P",PSGPRA="" S PSGSS=PSJSEL("SELECT") G:PSGSS'="P" ENDEV
"RTN","PSGPR",17,0)
 K DIR S DIR(0)="SAO^P:PROFILE;E:EXPANDED VIEWS;B:BOTH",DIR("A")="Show PROFILE only, EXPANDED VIEWS only, or BOTH: ",DIR("B")="PROFILE",DIR("?")="^D PH^PSGPR" W ! D ^DIR K DIR Q:"^"[Y  S PSGPRP=Y
"RTN","PSGPR",18,0)
 I "EB"[PSGPRP F  R !!,"Show SHORT, LONG, or NO activity log?  NO// ",AT:DTIME D ALC^PSGVW0 I Q S PSGPRA=AT Q
"RTN","PSGPR",19,0)
 Q:PSGPRA="^"
"RTN","PSGPR",20,0)
ENDEV ;
"RTN","PSGPR",21,0)
 K ZTSAVE S PSGTIR="ENQ^PSGPR",ZTDESC="PATIENT PROFILE" F X="PSGP","PSGP(","PSGSS","PSGPRWD","PSGPRWG","PSGPRWDN","PSGPRWGN","PSGOL","PSGPRA","PSGPRP","PSGPTMP","PSJSEL(","PPAGE" S ZTSAVE(X)=""
"RTN","PSGPR",22,0)
 D ENDEV^PSGTI I POP!$D(IO("Q")) G:$D(PSGOEPRF) DONE Q
"RTN","PSGPR",23,0)
 ;
"RTN","PSGPR",24,0)
ENQ ;
"RTN","PSGPR",25,0)
 K ^TMP("PSGPR",$J)
"RTN","PSGPR",26,0)
 K PSGVBY N RB,ATM S PSGPR=IO'=IO(0)!($E(IOST)'="C") N RBP S RBP=$S($D(PSJSEL("RBP")):PSJSEL("RBP"),1:"P") D @("P"_PSGSS) I PSGPR W:$Y @IOF D ^%ZISC
"RTN","PSGPR",27,0)
 G:$D(PSGOEPRF) DONE Q
"RTN","PSGPR",28,0)
 ;
"RTN","PSGPR",29,0)
G ; get ward group
"RTN","PSGPR",30,0)
 S PSGPRWG=+PSJSEL("WG"),PSGPRWGN=$P(PSJSEL("WG"),"^",2) Q
"RTN","PSGPR",31,0)
 ;
"RTN","PSGPR",32,0)
W ; get ward
"RTN","PSGPR",33,0)
 S PSGPRWD=+PSJSEL("W"),PSGPRWDN=$P(PSJSEL("W"),"^",2)
"RTN","PSGPR",34,0)
 I $D(PSJSEL("TM")) S TM="" F  S TM=$O(PSJSEL("TM",TM)) Q:TM=""  S PSGAPTM(TM)=TM
"RTN","PSGPR",35,0)
 Q
"RTN","PSGPR",36,0)
 ;
"RTN","PSGPR",37,0)
P ; get patient
"RTN","PSGPR",38,0)
 N PAT S PAT="" F  S PAT=$O(PSJSEL("P",PAT)) Q:PAT=""  S PSGP(PAT)=$O(PSJSEL("P",PAT,PSGP))
"RTN","PSGPR",39,0)
 Q
"RTN","PSGPR",40,0)
 ;
"RTN","PSGPR",41,0)
PG ;
"RTN","PSGPR",42,0)
 F PSGPRWD=0:0 S PSGPRWD=$O(^PS(57.5,"AC",PSGPRWG,PSGPRWD)) Q:'PSGPRWD  I $D(^DIC(42,PSGPRWD,0)),$P(^(0),"^")]"" S PSGPRWDN=$P(^(0),"^") D
"RTN","PSGPR",43,0)
 .F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGPRWDN,PSGP)) Q:'PSGP  D
"RTN","PSGPR",44,0)
 ..I RBP="R" S RB=$G(^DPT(PSGP,.101)) S:RB="" RB="zz" S ^TMP("PSGPR",$J,RB,PSGPRWDN,RB)=PSGP
"RTN","PSGPR",45,0)
 ..I RBP="P" D ^PSJAC S ^TMP("PSGPR",$J,PSGPRWDN,PSGP(0))=PSGP
"RTN","PSGPR",46,0)
 I $D(^TMP("PSGPR",$J)) N PSGX S PSGX="^TMP(""PSGPR"",$J)" F  S PSGX=$Q(@PSGX) Q:PSGX'[("""PSGPR"""_","_$J)  S PSGP=$G(@PSGX) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",47,0)
 Q
"RTN","PSGPR",48,0)
 ;
"RTN","PSGPR",49,0)
PW ;
"RTN","PSGPR",50,0)
 I $D(PSJSEL("TM")) S TM="" F  S TM=$O(PSJSEL("TM",TM)) Q:TM=""  S PSGPATM(TM)=TM
"RTN","PSGPR",51,0)
 F PSGP=0:0 S PSGP=$O(^DPT("CN",PSGPRWDN,PSGP)) Q:'PSGP  S RB=$G(^DPT(PSGP,.101)),TM="zz" D
"RTN","PSGPR",52,0)
 .I '$D(PSGPATM) D SET Q
"RTN","PSGPR",53,0)
 .S:RB]"" TM=$O(^PS(57.7,"AWRT",PSGPRWD,RB,0)) S:'TM TM="zz" I $D(PSGPATM("ALL"))!$D(PSGPATM(TM))  D SET Q
"RTN","PSGPR",54,0)
 I $D(^TMP("PSGPR",$J)) N PSGX S PSGX="^TMP(""PSGPR"",$J)" F  S PSGX=$Q(@PSGX) Q:PSGX'[("""PSGPR"""_","_$J)  S PSGP=$G(@PSGX) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",55,0)
 Q
"RTN","PSGPR",56,0)
 ;
"RTN","PSGPR",57,0)
SET ;
"RTN","PSGPR",58,0)
 S:TM'["zz" TM=$G(^PS(57.7,$G(PSGPRWD),1,TM,0)) I RB="" S RB="z"
"RTN","PSGPR",59,0)
 I RBP="P" D ^PSJAC S ^TMP("PSGPR",$J,TM,PSGP(0))=PSGP Q
"RTN","PSGPR",60,0)
 I RBP="R" S ^TMP("PSGPR",$J,TM,RB)=PSGP
"RTN","PSGPR",61,0)
 Q
"RTN","PSGPR",62,0)
 ;
"RTN","PSGPR",63,0)
PP ;
"RTN","PSGPR",64,0)
 S PAT="" F  S PAT=$O(PSGP(PAT)) Q:PAT=""  S PSGP=PSGP(PAT) D PP0 Q:$G(X)?1"^"."^"
"RTN","PSGPR",65,0)
 Q
"RTN","PSGPR",66,0)
 ;
"RTN","PSGPR",67,0)
PP0 ;
"RTN","PSGPR",68,0)
 N PSJACNWP S PSJACNWP=1 D ^PSJAC I PSGPRP'="E" D ^PSGO I PSGPRP="P",'PSGPR D:'PSGON READ^PSJUTL Q:$G(X)?1"^"."^"  I PSGON S (PSGONC,PSGONF,PSGONR,PSGONV,PSGPRF)=0 D ENVO^PSGOE0 K PSGPRF Q
"RTN","PSGPR",69,0)
 Q:PSGPRP="P"  I PSGPRP="E" U IO D ENGORD^PSGOU,ENPR^PSGO
"RTN","PSGPR",70,0)
 I 'PSGPR,PSGSS'="P",'$D(^TMP("PSG",$J)) D READ^PSJUTL Q
"RTN","PSGPR",71,0)
 S (S1,S2,S3,X)=""
"RTN","PSGPR",72,0)
 F  S S1=$O(^TMP("PSG",$J,S1)) Q:S1=""  F  S S2=$O(^TMP("PSG",$J,S1,S2)) Q:S2=""  F  S S3=$O(^TMP("PSG",$J,S1,S2,S3)) Q:S3=""  D PP1
"RTN","PSGPR",73,0)
 D:X'["^"&PSGPR BOT^PSGO K ^TMP("PSG",$J) Q
"RTN","PSGPR",74,0)
 ;
"RTN","PSGPR",75,0)
PP1 ;
"RTN","PSGPR",76,0)
 ;* S PSGORD=$P(S3,"^",2)_S1 D EN2^PSGVW I PSGPRA'="N" S AT=PSGPRA D ENA^PSGVW0
"RTN","PSGPR",77,0)
 S PSGORD=$P(S3,"^",2)_$S(S1["BD":"",S1["B":"P",S1["CD":"",S1["C":"P",1:"U") D EN2^PSGVW I PSGPRA'="N" S AT=PSGPRA D ENA^PSGVW0
"RTN","PSGPR",78,0)
 S X="" I 'PSGPR S DIR(0)="E" W ! D ^DIR S:$D(DIRUT) X="^" I X["^" S (S1,S2,S3)="~"
"RTN","PSGPR",79,0)
 Q
"RTN","PSGPR",80,0)
 ;
"RTN","PSGPR",81,0)
PH ;
"RTN","PSGPR",82,0)
 W !!?2,"Enter a 'P' to print ONLY the PROFILE of orders for this patient.  Enter an",!,"'E' to print ONLY the EXPANDED VIEW of the orders for this patient.  Enter a",!,"'B' to have BOTH the profile (first) and the expanded views print."
"RTN","PSGPR",83,0)
 W "  Enter an '^'to exit." Q
"RTN","PSGPR",84,0)
 ;
"RTN","PSGPR",85,0)
ENOR S (DFN,PSGP)=+ORVP
"RTN","PSGPR",86,0)
ENLM N PSJNEW,PSGPTMP,PPAGE,PSGOEPRF S PSJNEW=1
"RTN","PSGPR",87,0)
 S PSJOPC="UD",PSGPTMP=0,PPAGE=1
"RTN","PSGPR",88,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGPR",89,0)
 S PSJSEL("SELECT")="P",PSJSEL("P",$P($G(^DPT(DFN,0)),U),DFN)="" D ^VADPT
"RTN","PSGPR",90,0)
 D ^PSJAC,ENL^PSGOU I "^N"'[PSGOL D
"RTN","PSGPR",91,0)
 .S PSGSS="P",(PSGPRWD,PSGPRWG)=0,(PSGPRWDN,PSGPRWGN)=""
"RTN","PSGPR",92,0)
 .S PSGP(PSGP(0))=DFN K PSGP(0) D GO
"RTN","PSGPR",93,0)
 S PSJNKF=1 D READ^PSJUTL G DONE
"RTN","PSGS0")
0^104^B28896161
"RTN","PSGS0",1,0)
PSGS0 ;BIR/CML3-SCHEDULE PROCESSOR ;29 Jan 99 / 8:04 AM
"RTN","PSGS0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**12,25,26,50,63,74,83,116,110**;16 DEC 97
"RTN","PSGS0",3,0)
 ;
"RTN","PSGS0",4,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSGS0",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSGS0",6,0)
 ;
"RTN","PSGS0",7,0)
ENA ; entry point for train option
"RTN","PSGS0",8,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGS0",9,0)
 F  S (PSGS0Y,PSGS0XT)="" R !!,"Select STANDARD SCHEDULE: ",X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" ENQ^PSGSH I X'?1."?" D EN W:$D(X)[0 $C(7),"  ??" I $D(X)#2,'PSGS0Y,PSGS0XT W "  Every ",PSGS0XT," minutes"
"RTN","PSGS0",10,0)
 K DIC,DIE,PSGS0XT,PSGS0Y,Q,X,Y,PSGDT Q
"RTN","PSGS0",11,0)
 ;
"RTN","PSGS0",12,0)
EN3 ;
"RTN","PSGS0",13,0)
 S PSGST=$P($G(^PS(53.1,DA,0)),"^",7) G EN
"RTN","PSGS0",14,0)
 ;
"RTN","PSGS0",15,0)
EN5 ;
"RTN","PSGS0",16,0)
 S PSGST=$P($G(^PS(55,DA(1),5,DA,0)),"^",7)
"RTN","PSGS0",17,0)
 ;
"RTN","PSGS0",18,0)
EN ; validate
"RTN","PSGS0",19,0)
 ;/I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>2)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N")!($E(X,1)=" ") K X Q
"RTN","PSGS0",20,0)
 I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N")!($E(X,1)=" ") K X Q
"RTN","PSGS0",21,0)
 S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSGS0",22,0)
 I X?.E1L.E S X=$$ENLU^PSGMI(X) I '$D(PSGOES) D EN^DDIOL("  ("_X_")")
"RTN","PSGS0",23,0)
 I X["Q0" K X Q
"RTN","PSGS0",24,0)
 ;
"RTN","PSGS0",25,0)
ENOS ; order set entry
"RTN","PSGS0",26,0)
 I $G(X)="",$G(P(2)),$G(P(3)) S X=$G(P(9))
"RTN","PSGS0",27,0)
 I $G(X)="" Q
"RTN","PSGS0",28,0)
 S PSGXT=$G(PSGS0XT),(PSGS0XT,PSGS0Y,XT,Y,PSJNSS)="" I (X="ON CALL")!(X="ON-CALL")!(X="ONCALL") G Q
"RTN","PSGS0",29,0)
 I X["PRN",$$PRNOK(X) G Q
"RTN","PSGS0",30,0)
 S X0=X I X,X'["X",(X?2.4N1"-".E!(X?2.4N)) D ENCHK S:$D(X) Y=X G Q
"RTN","PSGS0",31,0)
 I $S($D(^PS(51.1,"AC","PSJ",X)):1,1:$E($O(^(X)),1,$L(X))=X) D DIC I XT]"" G Q
"RTN","PSGS0",32,0)
 I X["@" D DW S:$D(X) Y=$P(X,"@",2) G Q
"RTN","PSGS0",33,0)
 I Y'>0,$S(X="NOW":1,X="ONCE":1,X="STAT":1,X="ONE TIME":1,X="1 TIME":1,X="1TIME":1,X="1-TIME":1,X="ONETIME":1,1:X="ONE-TIME") W:'$D(PSGOES) "  (ONCE ONLY)" S Y="",XT="O" G Q
"RTN","PSGS0",34,0)
 I $G(PSGSCH)=X S PSGS0Y=$G(PSGAT),PSGS0XT=$G(PSGXT) Q
"RTN","PSGS0",35,0)
 ;
"RTN","PSGS0",36,0)
NS I (X="^")!(X="") K X Q
"RTN","PSGS0",37,0)
 N NS S NS=0,PSJNSS=0
"RTN","PSGS0",38,0)
 I Y'>0 W:'$D(PSGOES) "  (Nonstandard schedule)" S X=X0,Y="",NS=1,PSJNSS=1
"RTN","PSGS0",39,0)
 I $E(X,1,2)="AD" K X G Q
"RTN","PSGS0",40,0)
 I $E(X,1,3)="BID"!($E(X,1,3)="TID")!($E(X,1,3)="QID") S XT=1440/$F("BTQ",$E(X)) G Q
"RTN","PSGS0",41,0)
 S:$E(X)="Q" X=$E(X,2,99) S:'X X="1"_X S X1=+X,X=$P(X,+X,2),X2=0 S:X1<0 X1=-X1 S:$E(X)="X" X2=1,X=$E(X,2,99)
"RTN","PSGS0",42,0)
 S XT=$S(X["'":1,(X["D"&(X'["AD"))!(X["AM")!(X["PM")!(X["HS"&(X'["THS")):1440,X["H"&(X'["TH"):60,X["AC"!(X["PC"):480,X["W":10080,X["M":40320,1:-1) I XT<0,Y'>0 K X G Q
"RTN","PSGS0",43,0)
 S X=X0 I XT S:X2 XT=XT\X1 I 'X2 S:X["QO" XT=XT*2 S XT=XT*X1
"RTN","PSGS0",44,0)
 ;
"RTN","PSGS0",45,0)
Q ;
"RTN","PSGS0",46,0)
 ;S PSGS0XT=$S(XT]"":XT,1:""),PSGS0Y=$S(Y:Y,1:"") K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSGS0",47,0)
 S PSGS0XT=$S(XT]"":XT,1:""),PSGS0Y=$S(Y:Y,1:"") S:PSGS0XT<0 PSGS0XT=""
"RTN","PSGS0",48,0)
Q2 I $G(X)]"" I $D(^PS(51.1,"AC","PSJ",X)) N FREQ S FREQ=PSGS0XT D
"RTN","PSGS0",49,0)
 .I $$DOW^PSIVUTL(X) S PSJNSS=0 Q
"RTN","PSGS0",50,0)
 .N PSGS0XT,PSGS0Y,PSGST S PSGS0XT=FREQ D ADMIN^PSJORPOE S PSGS0XT=FREQ I $D(LYN) S I="" F  S I=$O(LYN("DILIST",2,I)) Q:'I!'$G(PSJNSS)  D
"RTN","PSGS0",51,0)
 ..S SCHFIL=LYN("DILIST",2,I) I SCHFIL S SCHFIL=$G(^PS(51.1,SCHFIL,0)) I $P(SCHFIL,"^",3) I $P(SCHFIL,"^",3),($P(SCHFIL,"^",3)=$G(PSGS0XT)) S PSJNSS=0
"RTN","PSGS0",52,0)
 I ($G(PSJNSS)&($G(VALMBCK)'="Q"))&(($G(PSGS0XT)>0)!($G(PSJLIFNI))) D NSSCONT($S($G(PSGOSCH)]"":$G(PSGOSCH),1:$G(X)),PSGS0XT)
"RTN","PSGS0",53,0)
 K QX,SDW,SWD,X0,XT,Z Q
"RTN","PSGS0",54,0)
 ;
"RTN","PSGS0",55,0)
NSSCONT(SCH,FREQ) ;
"RTN","PSGS0",56,0)
 Q:SCH=""!'FREQ!($G(VALMBCK)]"")!$G(PSGMARSD)!$G(PSIVFN1)
"RTN","PSGS0",57,0)
 I $G(PSGOES),'$G(NSFF) Q
"RTN","PSGS0",58,0)
 N PSGS0XT,PSGSCH,DIR,X,Y S PSGSCH=SCH,PSGS0XT=FREQ,PSJNSS=1
"RTN","PSGS0",59,0)
 D NSSMSG I PSJNSS]"" W !,PSJNSS S PSJNSS=1
"RTN","PSGS0",60,0)
 S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSGS0",61,0)
 K NSFF Q
"RTN","PSGS0",62,0)
 ;
"RTN","PSGS0",63,0)
NSSMSG ;
"RTN","PSGS0",64,0)
 I '(",D,O,"[(","_$G(PSGST)_",")),$G(PSJNSS),$G(PSGSCH)]"" D  Q
"RTN","PSGS0",65,0)
 . S PSJNSS="  WARNING - this non-standard schedule will be due every "_$$NSO^PSGS0(PSGS0XT)
"RTN","PSGS0",66,0)
 S PSJNSS="" Q
"RTN","PSGS0",67,0)
 ;
"RTN","PSGS0",68,0)
NSO(FQ) ;
"RTN","PSGS0",69,0)
 Q:'FQ!(FQ<0)!(",D,O,"[(","_$G(PSGST)_",")) ""
"RTN","PSGS0",70,0)
 K FRQOUT S FRQOUT=$S(FQ<60:(FQ_"minute"),(FQ<1440)&(FQ#60):(FQ_" minute"),(FQ<1440)!(FQ#1440):(FQ/60_" hour"),1:(FQ/1440_" day")) D
"RTN","PSGS0",71,0)
 . S:(+FRQOUT'=1) FRQOUT=FRQOUT_"s"
"RTN","PSGS0",72,0)
 Q FRQOUT
"RTN","PSGS0",73,0)
 ;
"RTN","PSGS0",74,0)
ENCHK ;
"RTN","PSGS0",75,0)
 I $S($L($P(X,"-"))>4:1,$L(X)>119:1,$L(X)<2:1,X'>0:1,1:X'?.ANP) K X Q
"RTN","PSGS0",76,0)
 S X(1)=$P(X,"-") I X(1)'?2N,X(1)'?4N K X Q
"RTN","PSGS0",77,0)
 S X(1)=$L(X(1)) I X'["-",X>$E(2400,1,X(1)) K X Q
"RTN","PSGS0",78,0)
 F X(2)=2:1:$L(X,"-") S X(3)=$P(X,"-",X(2)) I $S($L(X(3))'=X(1):1,X(3)>$E(2400,1,X(1)):1,1:X(3)'>$P(X,"-",X(2)-1)) K X Q
"RTN","PSGS0",79,0)
 K:$D(X) X(1),X(2),X(3) Q
"RTN","PSGS0",80,0)
 ;
"RTN","PSGS0",81,0)
DIC ;
"RTN","PSGS0",82,0)
 K DIC S DIC="^PS(51.1,",DIC(0)=$E("E",'$D(PSGOES))_"ISZ",DIC("W")="W ""  "","_$S('$D(PSJPWD):"$P(^(0),""^"",2)",'PSJPWD:"$P(^(0),""^"",2)",1:"$S($D(^PS(51.1,+Y,1,+PSJPWD,0)):$P(^(0),""^"",2),1:$P(^PS(51.1,+Y,0),""^"",2))"),D="APPSJ"
"RTN","PSGS0",83,0)
 I $D(PSGST) ;S DIC("S")="I $P(^(0),""^"",5)"_$E("'",PSGST'="O")_"=""O"""
"RTN","PSGS0",84,0)
 D IX^DIC K DIC S:$D(DIE)#2 DIC=DIE Q:Y'>0
"RTN","PSGS0",85,0)
 S XT=$S("C"[$P(Y(0),"^",5):$P(Y(0),"^",3),1:$P(Y(0),"^",5)),X=+Y,Y="" I $D(PSJPWD),$D(^PS(51.1,X,1,+PSJPWD,0)) S Y=$P(^(0),"^",2)
"RTN","PSGS0",86,0)
 S (X,X0)=Y(0,0) S:Y="" Y=$P(Y(0),"^",2) Q
"RTN","PSGS0",87,0)
DW ;
"RTN","PSGS0",88,0)
 S SWD="SUNDAYS^MONDAYS^TUESDAYS^WEDNESDAYS^THURSDAYS^FRIDAYS^SATURDAYS",SDW=X,X=$P(X,"@",2) D ENCHK Q:'$D(X)  S X=$P(SDW,"@"),X(1)="-" I X?.E1P.E,X'["-" F QX=1:1:$L(X) I $E(X,QX)?1P S X(1)=$E(X,QX) Q
"RTN","PSGS0",89,0)
 F Q=1:1:$L(X,X(1)) K:SWD="" X Q:SWD=""  S Z=$P(X,X(1),Q) D DWC Q:'$D(X)
"RTN","PSGS0",90,0)
 K X(1) S:$D(X) X=SDW Q
"RTN","PSGS0",91,0)
DWC I $L(Z)<2 K X Q
"RTN","PSGS0",92,0)
 F QX=1:1:$L(SWD,"^") S Y=$P(SWD,"^",QX) I $P(Y,Z)="" S SWD=$P(SWD,Y,2) S:$L(SWD) SWD=$E(SWD,2,50) Q
"RTN","PSGS0",93,0)
 E  K X
"RTN","PSGS0",94,0)
 Q
"RTN","PSGS0",95,0)
 ;
"RTN","PSGS0",96,0)
PRNOK(PSCH) ;
"RTN","PSGS0",97,0)
 Q:PSCH'["PRN" 0
"RTN","PSGS0",98,0)
 Q:PSCH="PRN" 1
"RTN","PSGS0",99,0)
 N BASE,I,OK S OK=0 F I=$P(PSCH,"PRN"),$P(PSCH,"PRN",2),$P(PSCH,"PRN ",2),$P(PSCH," PRN") Q:OK  I I]"",$D(^PS(51.1,"AC","PSJ",I)) S OK=1
"RTN","PSGS0",100,0)
 Q OK
"RTN","PSGSICHK")
0^97^B45078669
"RTN","PSGSICHK",1,0)
PSGSICHK ;BIR/CML3-CHECKS SPECIAL INSTRUCTIONS ;17 Aug 98 / 8:33 AM
"RTN","PSGSICHK",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,9,26,29,44,49,59,110**;16 DEC 97
"RTN","PSGSICHK",3,0)
 ;
"RTN","PSGSICHK",4,0)
 ; Reference to EN^PSOORDRG is supported by DBIA 2190.
"RTN","PSGSICHK",5,0)
 ; Reference to ^PSI(58.1 is supported by DBIA 2284.
"RTN","PSGSICHK",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGSICHK",7,0)
 ; Reference to ^PSD(58.8 is supported by DBIA 2283.
"RTN","PSGSICHK",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGSICHK",9,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGSICHK",10,0)
 ; Reference to ^PS(51 is supported by DBIA 2176.
"RTN","PSGSICHK",11,0)
 ;
"RTN","PSGSICHK",12,0)
START ;
"RTN","PSGSICHK",13,0)
 I $S(X'?.ANP:1,X["^":1,1:$L(X)>180) K X Q
"RTN","PSGSICHK",14,0)
 S Y="" F Y(1)=1:1:$L(X," ") S Y(2)=$P(X," ",Y(1)) I Y(2)]"" D CHK Q:'$D(X)
"RTN","PSGSICHK",15,0)
 ;I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) W !?3,"EXPANDS TO:",! F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  W:$L(Y(2))+$X>78 ! W Y(2)," "
"RTN","PSGSICHK",16,0)
 I $D(X),Y]"",X'=$E(Y,1,$L(Y)-1) D EN^DDIOL("EXPANDS TO: ") W Y F Y(1)=1:1 S Y(2)=$P(Y," ",Y(1)) Q:Y(2)=""  D:$L(Y(2))+$X>78 EN^DDIOL(Y(2)_" ")
"RTN","PSGSICHK",17,0)
 Q
"RTN","PSGSICHK",18,0)
 ;
"RTN","PSGSICHK",19,0)
CHK ;
"RTN","PSGSICHK",20,0)
 I $L(Y(2))<31,$D(^PS(51,+$O(^PS(51,"B",Y(2),0)),0)),$P(^(0),"^",2)]"",$P(^(0),"^",4) S Y(2)=$P(^(0),"^",2)
"RTN","PSGSICHK",21,0)
 I $L(Y)+$L(Y(2))>180 K X Q
"RTN","PSGSICHK",22,0)
 S Y=Y_Y(2)_" " Q
"RTN","PSGSICHK",23,0)
 ;
"RTN","PSGSICHK",24,0)
ENSET(X) ; expands the SPECIAL INSTRUCTIONS field contained in X into Y
"RTN","PSGSICHK",25,0)
 N X1,X2,Y S Y=""
"RTN","PSGSICHK",26,0)
 F X1=1:1:$L(X," ") S X2=$P(X," ",X1) I X2]"" S Y=Y_$S($L(X2)>30:X2,'$D(^PS(51,+$O(^PS(51,"B",X2,0)),0)):X2,$P(^(0),"^",2)]""&$P(^(0),"^",4):$P(^(0),"^",2),1:X2)_" "
"RTN","PSGSICHK",27,0)
 S Y=$E(Y,1,$L(Y)-1) Q Y
"RTN","PSGSICHK",28,0)
 ;
"RTN","PSGSICHK",29,0)
END ; used by DRUG (55.06,101 & 53.1,101) x-refs to warn user if patient is receiving or about to receive the drug just ordered
"RTN","PSGSICHK",30,0)
 Q:$D(PSJHLSKP)
"RTN","PSGSICHK",31,0)
 N Z,ZZ,STATUSNP I $G(PSJPWD)&($P($G(PSJSYSU),";")=3)&($G(PSGDRG)) I ($D(^PSI(58.1,"D",PSGDRG,PSJPWD)))!($D(^PSD(58.8,"D",PSGDRG,PSJPWD))) D EN^DDIOL("                         *** A WARD STOCK ITEM ***")
"RTN","PSGSICHK",32,0)
 D NOW^%DTC
"RTN","PSGSICHK",33,0)
 N PSJDCHK F Z=%:0 S Z=$O(^PS(55,+PSGP,5,"AUS",Z)) Q:'Z!$D(DUOUT)  F ZZ=0:0 S ZZ=$O(^PS(55,+PSGP,5,"AUS",Z,ZZ)) Q:'ZZ!$D(DUOUT)  I +$G(^PS(55,+PSGP,5,ZZ,.2))=PSGX D PDWCHK(+PSGP,ZZ_"U") S PSJDCHK=1
"RTN","PSGSICHK",34,0)
 F STATUSNP="N","P" F Z=0:0 S Z=$O(^PS(53.1,"AS",STATUSNP,+PSGP,Z)) Q:'Z!$D(DUOUT)  I +$G(^PS(53.1,+Z,.2))=PSGX D PDWCHK(+PSGP,Z_"P") S PSJDCHK=1
"RTN","PSGSICHK",35,0)
 I $D(PSJDCHK) N DIR D
"RTN","PSGSICHK",36,0)
 .S DIR(0)="Y",DIR("A")="Do you wish to continue entering this order",DIR("?",1)="Enter ""N"" if you wish to exit without creating a new order,"
"RTN","PSGSICHK",37,0)
 .S DIR("?")="or ""Y"" to continue with the order entry process." D ^DIR S:'Y Y=-1,X="^"
"RTN","PSGSICHK",38,0)
 K Z,ZZ
"RTN","PSGSICHK",39,0)
 Q
"RTN","PSGSICHK",40,0)
 ;
"RTN","PSGSICHK",41,0)
ENDDC(PSGP,PSJDD) ; Perform Duplicate Drug, Duplicate Class,
"RTN","PSGSICHK",42,0)
 ; Drug-Drug interaction check, Drug-Allergy interaction check.
"RTN","PSGSICHK",43,0)
 N PSJLINE,Z,ZZ,PSJFST
"RTN","PSGSICHK",44,0)
 S (PSJLINE,PSJFST)=0
"RTN","PSGSICHK",45,0)
 I $G(PSJPWD)&($P($G(PSJSYSU),";")=3)&($G(PSJDD)) I ($D(^PSI(58.1,"D",PSJDD,PSJPWD)))!($D(^PSD(58.8,"D",PSJDD,PSJPWD))) W !?25,"*** A WARD STOCK ITEM ***"
"RTN","PSGSICHK",46,0)
 D EN^PSOORDRG(PSGP,PSJDD) K PSJPDRG N INTERVEN,PSJIREQ,PSJRXREQ S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)="" S DFN=PSGP
"RTN","PSGSICHK",47,0)
 I $D(^TMP($J,"DD")) D ORDCHK^PSJLMUT1(PSGP,"DD",4)
"RTN","PSGSICHK",48,0)
 I $D(^TMP($J,"DC")) D ORDCHK^PSJLMUT1(PSGP,"DC",6)
"RTN","PSGSICHK",49,0)
IVSOL ;*** Start order check for IV solution at this point.
"RTN","PSGSICHK",50,0)
 I '$D(PSJFST) N PSJFST S PSJFST=0
"RTN","PSGSICHK",51,0)
 I $D(^TMP($J,"DI")) S INTERVEN=1 D ORDCHK^PSJLMUT1(PSGP,"DI",8)
"RTN","PSGSICHK",52,0)
 ;*** Allergy/adverse reaction check.
"RTN","PSGSICHK",53,0)
 N PTR,X
"RTN","PSGSICHK",54,0)
 S PTR=$P($G(^PSDRUG(PSJDD,"ND")),U)_"."_$P($G(^PSDRUG(PSJDD,"ND")),U,3)
"RTN","PSGSICHK",55,0)
 K ^TMP("PSJDAI",$J) S PSJACK=$$ORCHK^GMRAOR(DFN,"DR",PTR) D:$G(PSJACK)=1
"RTN","PSGSICHK",56,0)
 .S ^TMP("PSJDAI",$J,0)=1
"RTN","PSGSICHK",57,0)
 .S I=0 F  S I=$O(GMRAING(I)) Q:'I  S ^TMP("PSJDAI",$J,I,0)=GMRAING(I)
"RTN","PSGSICHK",58,0)
 I $D(^TMP("PSJDAI",$J)) S PSJPDRG=1 D
"RTN","PSGSICHK",59,0)
 .W $C(7),!!,"A Drug-Allergy Reaction exists for this medication!",!!
"RTN","PSGSICHK",60,0)
 .W !?7,"Drug: "_$P($G(^PSDRUG(PSJDD,0)),"^") I $O(^TMP("PSJDAI",$J)) W !,"Ingredients: " D
"RTN","PSGSICHK",61,0)
 ..S I=0 F  S I=$O(^TMP("PSJDAI",$J,I)) Q:'I  W:$X+$L($G(^(I,0)))+2>IOM !?19 W:I=1 $G(^TMP("PSJDAI",$J,I,0)) W:I>1 ", ",$G(^TMP("PSJDAI",$J,I,0))
"RTN","PSGSICHK",62,0)
 .W !!
"RTN","PSGSICHK",63,0)
 K PSJACK,GMRAING,I,^TMP($J)
"RTN","PSGSICHK",64,0)
 D ALGCLASS
"RTN","PSGSICHK",65,0)
CONT ; Ask user if they wish to continue in spite of an order check.
"RTN","PSGSICHK",66,0)
 Q:'$D(PSJPDRG)  N DIR S DIR(0)="Y",DIR("A")="Do you wish to continue entering this order",DIR("?",1)="Enter ""N"" if you wish to exit without creating a new order,"
"RTN","PSGSICHK",67,0)
 S DIR("?")="or ""Y"" to continue with the order entry process.",DIR("B")="NO" D ^DIR I 'Y S PSGORQF=1,X="^",COMQUIT=1 Q
"RTN","PSGSICHK",68,0)
 I 'INTERVEN!($P(PSJSYSU,";")'=3) Q
"RTN","PSGSICHK",69,0)
 ;I PSJIREQ D ^PSJRXI S:$G(PSJRXI("QFLG")) PSGORQF=1,X=U Q
"RTN","PSGSICHK",70,0)
 NEW PSJY
"RTN","PSGSICHK",71,0)
 W:PSJIREQ !!,"This is a CRITICAL interaction, you must enter an intervention log to continue"
"RTN","PSGSICHK",72,0)
 S DIR(0)="Y",DIR("A")="Do you wish to log an intervention",DIR("?",1)="Enter ""N"" if you do not wish to log an intervention,",DIR("?")="or ""Y"" to log an intervention." D ^DIR S PSJY=Y D:Y ^PSJRXI
"RTN","PSGSICHK",73,0)
 I 'PSJY,PSJIREQ S PSGORQF=1,COMQUIT=1
"RTN","PSGSICHK",74,0)
 ;I 'Y,$P(ND,U,4)="CRITICAL" S PSGORQF=1,X="^"
"RTN","PSGSICHK",75,0)
 Q
"RTN","PSGSICHK",76,0)
 ;
"RTN","PSGSICHK",77,0)
ENDL ; used by PSGTRAIN DRUG LOOK-UP option
"RTN","PSGSICHK",78,0)
 D ENCV^PSGSETU Q:$D(XQUIT)
"RTN","PSGSICHK",79,0)
 F  S DIC="^PSDRUG(",DIC(0)="AEIMOQZ",DIC("A")="Select DRUG: " W ! D ^DIC K DIC Q:+Y'>0  D SF
"RTN","PSGSICHK",80,0)
 D ENKV^PSGSETU K N5,ND,Q,Y Q
"RTN","PSGSICHK",81,0)
 ;
"RTN","PSGSICHK",82,0)
SF ;
"RTN","PSGSICHK",83,0)
 S Y=+Y,ND=$G(^PSDRUG(Y,0)),PSGID=+$G(^("I")) I PSGID W !!,"THIS DRUG IS INACTIVE AS OF ",$E($$ENDTC^PSGMI(PSGID),1,8)
"RTN","PSGSICHK",84,0)
 W !!,$S($P(ND,"^",9):"NON-",1:""),"FORMULARY ITEM" W:$P(ND,"^",10)]"" !,$P(ND,"^",10)
"RTN","PSGSICHK",85,0)
 S ND=$P($G(^PSDRUG(Y,2)),"^",3)["U" W !,$P("NOT^","^",ND+1)," A UNIT DOSE DRUG" W ! S ND=$G(^(8)),N5=$G(^(8.5)) W !?2,"DAY (nD) or DOSE (nL) LIMIT: " I ND W $P(ND,"^")
"RTN","PSGSICHK",86,0)
 W !?10,"UNIT DOSE MED ROUTE: " I $P(ND,"^",2) W $S($D(^PS(51.2,$P(ND,"^",2),0)):$P(^(0),"^"),1:$P(ND,"^",2))
"RTN","PSGSICHK",87,0)
 ; NAKED REF below refers to ^PS(51.2, on line above.
"RTN","PSGSICHK",88,0)
 W !?6,"UNIT DOSE SCHEDULE TYPE: " I $P(ND,"^",3)]"" W $P($P(";"_$P(^(0),"^",3),";"_$P(ND,"^",3)_":",2),";")
"RTN","PSGSICHK",89,0)
 W !?11,"UNIT DOSE SCHEDULE: " I $P(ND,"^",4)]"" W $P(ND,"^",4)
"RTN","PSGSICHK",90,0)
 W !,"CORRESPONDING OUTPATIENT DRUG: " I $P(ND,"^",5) W $S('$D(^PSDRUG(+$P(ND,"^",5),0)):$P(ND,"^",5),$P(^(0),"^")]"":$P(^(0),"^"),1:$P(ND,"^",5))
"RTN","PSGSICHK",91,0)
 W !?17,"ATC MNEMONIC: " I $P(N5,"^",2)]"" W $P(N5,"^",2)
"RTN","PSGSICHK",92,0)
 ;Q:'$D(^DD(50,212,0))  W !?17,$P(^(0),"^"),": " F Q=0:0 S Q=$O(^PSDRUG(Y,212,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$P(ND,"^",2) W ?31,$S('$D(^PS(57.5,+ND,0)):+ND_";PS(57.5,",$P(^(0),"^")]"":$P(^(0),"^"),1:+ND_";PS(57.5,"),?56,$P(ND,"^",2),!
"RTN","PSGSICHK",93,0)
 W !?17,"ATC CANISTER: " F Q=0:0 S Q=$O(^PSDRUG(Y,212,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$P(ND,"^",2) W ?31,$S('$D(^PS(57.5,+ND,0)):+ND_";PS(57.5,",$P(^(0),"^")]"":$P(^(0),"^"),1:+ND_";PS(57.5,"),?56,$P(ND,"^",2),!
"RTN","PSGSICHK",94,0)
 Q
"RTN","PSGSICHK",95,0)
 ;
"RTN","PSGSICHK",96,0)
OCHK ; Add drugs in current order to ^TMP("ORDERS" and call order checker.
"RTN","PSGSICHK",97,0)
 ; Set PSJOCHK=1 so OP order check doesn't Kill array.
"RTN","PSGSICHK",98,0)
 ;
"RTN","PSGSICHK",99,0)
 K ^TMP($J,"ORDERS")
"RTN","PSGSICHK",100,0)
 N PSJOCHK S PSJOCHK=1
"RTN","PSGSICHK",101,0)
PDWCHK(DFN,ON) ; Print Dup Drug order.
"RTN","PSGSICHK",102,0)
 N ND,ND0,ND2,X
"RTN","PSGSICHK",103,0)
 W:'$D(PSJDCHK) $C(7),$C(7),!!,"WARNING! THIS PATIENT HAS THE FOLLOWING ORDER(S) FOR THIS MEDICATION:",!!
"RTN","PSGSICHK",104,0)
 S ND=$$DRUGNAME^PSJLMUTL(DFN,ON)
"RTN","PSGSICHK",105,0)
 S F=$S(ON["P":"^PS(53.1,",1:"^PS(55,"_DFN_",5,"),ND0=$G(@(F_+ON_",0)")),ND2=$G(^(2)),X=$P(ND,U,2),X=$S(X=.2:$P($G(^(.2)),U,2),1:$G(^(.3)))
"RTN","PSGSICHK",106,0)
 W ?10,$P(ND,U),!,?13,"Give: ",X," ",$$ENMRN^PSGMI(+$P(ND0,U,3))," ",$P(ND2,U),!!
"RTN","PSGSICHK",107,0)
 Q
"RTN","PSGSICHK",108,0)
ALGCLASS ; checks any Drug allergies or reactions to see if
"RTN","PSGSICHK",109,0)
 ;         the new drug is the same class
"RTN","PSGSICHK",110,0)
 ; this call can be removed by commenting out the call on IVSOL+16
"RTN","PSGSICHK",111,0)
 N PSJLIST,CT,CLS,CLCHK,CNT,PSJL,LIST
"RTN","PSGSICHK",112,0)
 S GMRA="0^0^111" D EN1^GMRADPT
"RTN","PSGSICHK",113,0)
 F PSJLIST=0:0 S PSJLIST=$O(GMRAL(PSJLIST)) Q:'PSJLIST  D
"RTN","PSGSICHK",114,0)
 .K PSJAGL D EN1^GMRAOR2(PSJLIST,"PSJAGL")
"RTN","PSGSICHK",115,0)
 .; is the allergy/reaction drug class first four digits the same as the
"RTN","PSGSICHK",116,0)
 .; the class for the drug being entered?
"RTN","PSGSICHK",117,0)
 .S (CT,CLS)="" I $D(PSJAGL("V")) D
"RTN","PSGSICHK",118,0)
 ..S:$E($P($G(PSJAGL("V",1)),"^"),1,4)=$E($P($G(^PSDRUG(PSJDD,0)),"^",2),1,4) (PSJPDRG,CLCHK)=1,CNT=$S('$D(CNT):1,1:CNT+1),LIST(CNT)=$P($G(PSJAGL),"^")_"^"_$P($G(PSJAGL("V",1)),"^",2)
"RTN","PSGSICHK",119,0)
 D:$G(CLCHK)
"RTN","PSGSICHK",120,0)
 .W !!,$C(7),"A Drug-Allergy Reaction exists for this medication and/or class!"
"RTN","PSGSICHK",121,0)
 .F PSJL=0:0 S PSJL=$O(LIST(PSJL)) Q:'PSJL  D
"RTN","PSGSICHK",122,0)
 ..W !?6,"Drug: "_$P(LIST(PSJL),"^"),!,"Drug Class: "_$P(LIST(PSJL),"^",2),!
"RTN","PSGSICHK",123,0)
 Q
"RTN","PSGVBW")
0^76^B50020102
"RTN","PSGVBW",1,0)
PSGVBW ;BIR/CML3,MV-VERIFY ORDERS BY WARD, WARD GROUP, OR PATIENT ;22 Oct 98 / 3:14 PM
"RTN","PSGVBW",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**5,16,39,59,62,67,58,81,80,110**;16 DEC 97
"RTN","PSGVBW",3,0)
 ;
"RTN","PSGVBW",4,0)
 ; Reference to ^DIC(42 is supported by DBIA #10039
"RTN","PSGVBW",5,0)
 ; Reference to ^DPT( is supported by DBIA #10035
"RTN","PSGVBW",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGVBW",7,0)
 ; Reference to ^DIC is supported by DBIA #10006
"RTN","PSGVBW",8,0)
 ; Reference to ^DIR is supported by DBIA #10026
"RTN","PSGVBW",9,0)
 ; Reference to ^%DTC is supported by DBIA #10000
"RTN","PSGVBW",10,0)
 ;
"RTN","PSGVBW",11,0)
 N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSGVBW",12,0)
START ;
"RTN","PSGVBW",13,0)
 D ENCV^PSGSETU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",14,0)
 ;I ($P(PSJSYSU,";")=3)!($P(PSJSYSU,";",3)=2) 
"RTN","PSGVBW",15,0)
 D ^PSIVXU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",16,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGVBW",17,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBW",18,0)
 .K DIR S DIR(0)="Y",DIR("A")="Display an Order Summary",DIR("B")="NO"
"RTN","PSGVBW",19,0)
 .S DIR("?",1)="Enter 'YES' to see a summary of orders by type and ward group",DIR("?")="or 'NO' to go directly to patient selection."
"RTN","PSGVBW",20,0)
 .D ^DIR K DIR Q:$D(DIRUT)!$D(DUOUT)  I Y D CNTORDRS^PSGVBWU
"RTN","PSGVBW",21,0)
 K ^TMP("PSJ",$J) S PSGPXN=0 D GTOOP G:$D(DIRUT) DONE L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGVBW",22,0)
 S PSGSSH="VBW",PSGPXN=0,PSJPROT=$S($P(PSJSYSU,";",3)=3:3,$G(PSJRNF):3,$G(PSJIRNF):3,1:1)
"RTN","PSGVBW",23,0)
 S PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING")
"RTN","PSGVBW",24,0)
 F  K ^TMP("PSJSELECT",$J) D ^PSGSEL Q:"^"[PSGSS  F  S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 D @PSGSS Q:+Y'>0  D GO
"RTN","PSGVBW",25,0)
 ;
"RTN","PSGVBW",26,0)
DONE ;
"RTN","PSGVBW",27,0)
 K ^TMP("PSGVBW",$J),^TMP("PSJSELECT",$J),^TMP("PSJLIST",$J),^TMP("PSJON",$J)
"RTN","PSGVBW",28,0)
 K CHK,D0,DRGI,FQC,J,ND,ON,PN,PSGODT,PSGOEA,PSGOP,PSGSS,PSGSSH,RB,SD,ST,TM,WD,WDN,WG,PRI,PSJPNV
"RTN","PSGVBW",29,0)
 K PSGODDD,PSGOEORF,PSJORL,PSJORPCL,PSJORTOU,PSJORVP,PSGTOL,PSJTOO,PSGUOW,PSGONV,PX,PSGOEAV,PSGPX,PSGVBWTO,PSGVBWW,PSJOPC,PSGOENOF,PSJPROT,PSJLM
"RTN","PSGVBW",30,0)
 L -^PS(53.45,PSJSYSP) G:(PSGPXN&'$$DEFON^PSGPER1) ^PSGPER1 D ENKV^PSGSETU K ND Q
"RTN","PSGVBW",31,0)
 ;
"RTN","PSGVBW",32,0)
GO ;
"RTN","PSGVBW",33,0)
 I PSGSS'="P" W !,"...a few moments, please..." K ^TMP("PSGVBW",$J) D ARRAY K CHK,ON,PN,RB,SD,TM,WD,WDN,WG,X,Y
"RTN","PSGVBW",34,0)
 I PSGSS'="P",'$D(^TMP("PSGVBW",$J)) W !,$C(7),"NO ",PSGVBWW," ORDERS FOR ",$S(PSGSS="P":"PATIENT",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSGVBW",35,0)
 D ^PSGVBW0 Q
"RTN","PSGVBW",36,0)
 ;
"RTN","PSGVBW",37,0)
 ; look-ups on ward group, ward, or patient; depending on value of SS
"RTN","PSGVBW",38,0)
G ;
"RTN","PSGVBW",39,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD GROUP: "
"RTN","PSGVBW",40,0)
 S DIR("?")="^D GDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",41,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",42,0)
 ;S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: "
"RTN","PSGVBW",43,0)
GDIC ;
"RTN","PSGVBW",44,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 WG=+Y
"RTN","PSGVBW",45,0)
 W:X["?" !!,"Enter ""^OTHER"" to include all Outpatient IV orders and orders from the",!,"wards that do not belong to a ward group",!
"RTN","PSGVBW",46,0)
 Q
"RTN","PSGVBW",47,0)
W ;
"RTN","PSGVBW",48,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD: "
"RTN","PSGVBW",49,0)
 S DIR("?")="^D WDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",50,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",51,0)
WDIC ;
"RTN","PSGVBW",52,0)
 ;S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: "
"RTN","PSGVBW",53,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 WD=+Y
"RTN","PSGVBW",54,0)
 W:X["?" !!,"Enter ""^OTHER"" for Outpatient IV orders",!
"RTN","PSGVBW",55,0)
 Q
"RTN","PSGVBW",56,0)
P ;
"RTN","PSGVBW",57,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1 F  D ^PSJP Q:PSGP<0  D
"RTN","PSGVBW",58,0)
 .S PSJNV=0
"RTN","PSGVBW",59,0)
 .NEW ON,XX F ON=0:0 S ON=$O(^PS(53.1,"AS","N",PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX S PSJNV=1 Q
"RTN","PSGVBW",60,0)
 .;S PSJNV=$O(^PS(53.1,"AS","N",+PSGP,0)),PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",61,0)
 .S PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",62,0)
 .I 'PSJNV D ^PSJAC D
"RTN","PSGVBW",63,0)
 ..I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",64,0)
 ..S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",65,0)
 ..I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD!PSJNV  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  S PSJNV=1 Q
"RTN","PSGVBW",66,0)
 ..I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  S PSJNV=1 Q
"RTN","PSGVBW",67,0)
 .S X=$S(PSJTOO=1:PSJNV,PSJTOO=2:PSJPEN,1:(PSJNV+PSJPEN))
"RTN","PSGVBW",68,0)
 .I X D SETPN S ^TMP("PSJSELECT",$J,PSJCNT)=PN,^TMP("PSJSELECT",$J,"B",$P(PN,U),PSJCNT)="",PSJCNT=PSJCNT+1 Q
"RTN","PSGVBW",69,0)
 .W !,"No ",PSGVBWW," orders found for this patient."
"RTN","PSGVBW",70,0)
 S:$D(^TMP("PSJSELECT",$J)) Y=1
"RTN","PSGVBW",71,0)
 Q
"RTN","PSGVBW",72,0)
 ;
"RTN","PSGVBW",73,0)
ARRAY ; put patient(s) with non-verified orders into array
"RTN","PSGVBW",74,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",75,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING") I PSGSS="P" D IF S:$T ^TMP("PSGVBW",$J)=$P(PSGP(0),"^")_"^"_PSGP Q
"RTN","PSGVBW",76,0)
 G WD:PSGSS="W" F WD=0:0 S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D WD
"RTN","PSGVBW",77,0)
 Q
"RTN","PSGVBW",78,0)
 ;
"RTN","PSGVBW",79,0)
WD S WDN=$S($D(^DIC(42,WD,0)):$P(^(0),"^"),1:"") I WDN]"" F PSGP=0:0 S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  I $S($O(^PS(55,PSGP,5,"AUS",PSGDT)):1,1:$D(^PS(53.1,"AC",PSGP))) D ^PSJAC,IF
"RTN","PSGVBW",80,0)
 Q
"RTN","PSGVBW",81,0)
IF ;
"RTN","PSGVBW",82,0)
 W "." I PSJTOO'=1 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",PSGP,ON)) Q:'ON  S X=$P($G(^PS(53.1,ON,0)),U,4),Y=0 I "FIU"[X D  G:Y SET
"RTN","PSGVBW",83,0)
 .I PSJPAC=3 S Y=1 Q
"RTN","PSGVBW",84,0)
 .I PSJPAC=2 S Y=X'="U" Q 
"RTN","PSGVBW",85,0)
 .I PSJPAC=1 S Y=X="U"
"RTN","PSGVBW",86,0)
 Q:PSJTOO=2
"RTN","PSGVBW",87,0)
 F X="N","I" I $D(^PS(53.1,"AS",X,PSGP)) NEW XX S XX=0 D  G:XX SET
"RTN","PSGVBW",88,0)
 . NEW ON F ON=0:0 S ON=$O(^PS(53.1,"AS",X,PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) Q:XX
"RTN","PSGVBW",89,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",90,0)
 I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  G SET
"RTN","PSGVBW",91,0)
 I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  G SET
"RTN","PSGVBW",92,0)
 Q
"RTN","PSGVBW",93,0)
 ;
"RTN","PSGVBW",94,0)
IFT ;
"RTN","PSGVBW",95,0)
 S ND=$G(^PS(55,PSGP,5,ON,4)) I $S(SD>PSGDT:$S(ND="":1,'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND,"^",13):1,$P(ND,"^",19):1,$P(ND,"^",23):1,1:$P(ND,"^",16)),ST="O":$S(ND="":1,1:'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND,"^",16))
"RTN","PSGVBW",96,0)
 Q
"RTN","PSGVBW",97,0)
 ;
"RTN","PSGVBW",98,0)
IFT2 ;
"RTN","PSGVBW",99,0)
 ;S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&(ND=""):1,'$P(ND,"^",$S(+PSJSYSU=1:1,1:4)):1,1:0)
"RTN","PSGVBW",100,0)
 S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4))):1,1:0)
"RTN","PSGVBW",101,0)
 Q
"RTN","PSGVBW",102,0)
SET ;
"RTN","PSGVBW",103,0)
 S TM=$S(PSJPRB="":"",1:$P($G(^PS(57.7,WD,1,+$O(^PS(57.7,"AWRT",WD,PSJPRB,0)),0)),"^")) S:TM="" TM="zz"
"RTN","PSGVBW",104,0)
 ;
"RTN","PSGVBW",105,0)
SETPN ;
"RTN","PSGVBW",106,0)
 S PN=$P(PSGP(0),"^")_U_PSGP_U_PSJPBID S:PSGSS'="P" ^TMP("PSGVBW",$J,WDN,TM,PN)=""
"RTN","PSGVBW",107,0)
 Q
"RTN","PSGVBW",108,0)
 ;
"RTN","PSGVBW",109,0)
GTOOP ; Get 'Type Of Order' and Package
"RTN","PSGVBW",110,0)
 I $P(PSJSYSU,";",3)<2,'$G(PSJRNF),'$G(PSJIRNF) S PSJPAC=0,PSJTOO=1 D GTPAC Q
"RTN","PSGVBW",111,0)
 S (PSJPAC,PSJTOO)=0 W !!,"1) Non-Verified Orders",!,"2) Pending Orders",!!
"RTN","PSGVBW",112,0)
 N DIR S DIR(0)="LAO^1:2",DIR("A")="Select Order Type(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" D ^DIR
"RTN","PSGVBW",113,0)
 I 'Y D EXIT("TYPE OF ORDER") Q
"RTN","PSGVBW",114,0)
 S PSJTOO=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",115,0)
 D GTPAC
"RTN","PSGVBW",116,0)
 I 'PSJPAC D EXIT("PACKAGE") Q
"RTN","PSGVBW",117,0)
 Q
"RTN","PSGVBW",118,0)
GTPAC ;
"RTN","PSGVBW",119,0)
 ;S PSJTOO=$S($L(Y)>2:3,1:$P(Y,",")) Q:PSJTOO=1
"RTN","PSGVBW",120,0)
 ;I $G(PSJRNF) S PSJPAC=1 Q
"RTN","PSGVBW",121,0)
 I ($G(PSJRNF))&('$G(PSJIRNF))&(PSJTOO=2) S PSJPAC=1 Q
"RTN","PSGVBW",122,0)
 I ($G(PSJIRNF))&('$G(PSJRNF))&(PSJTOO=2) S PSJPAC=2 Q
"RTN","PSGVBW",123,0)
 W !!,"1) Unit Dose Orders",!,"2) IV Orders",!
"RTN","PSGVBW",124,0)
 K DIR S DIR(0)="LAO^1:2",DIR("A")="Select Package(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",125,0)
 S PSJPAC=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",126,0)
 Q
"RTN","PSGVBW",127,0)
EXIT(X) ;
"RTN","PSGVBW",128,0)
 W !!,X," not selected, option terminated."
"RTN","PSGVBW",129,0)
 Q
"RTN","PSGVBW",130,0)
 ;
"RTN","PSGVBW",131,0)
TOH ;
"RTN","PSGVBW",132,0)
 W !!,"SELECT FROM:",!?5,"1 - NON-VERIFIED ORDERS",!?5,"2 - PENDING ORDERS"
"RTN","PSGVBW",133,0)
 W !!?2,"Enter '1' if you want to verify non-verified orders.  Enter '2' if you",!,"want to complete pending orders.  Enter '1,2' or '1-2' if you want to do both." Q
"RTN","PSGVBW0")
0^75^B34370076
"RTN","PSGVBW0",1,0)
PSGVBW0 ;BIR/CML3,MV-SHOW NON-VERFIED ORDERS GATHERED IN PSGVBW ;17 SEP 97 /  1:41 PM
"RTN","PSGVBW0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,39,53,56,95,80,110**;16 DEC 97
"RTN","PSGVBW0",3,0)
 ;
"RTN","PSGVBW0",4,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSGVBW0",5,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSGVBW0",6,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSGVBW0",7,0)
 ;
"RTN","PSGVBW0",8,0)
START ;
"RTN","PSGVBW0",9,0)
 S (LINE,PSGOEA,PSGOEAV)="",$P(LINE,"-",81)=""
"RTN","PSGVBW0",10,0)
 K ^TMP("PSJLIST",$J) D:PSGSS'="P" DISPLAYW Q:'$O(^TMP("PSJSELECT",$J,0))
"RTN","PSGVBW0",11,0)
PROCESS ; Loop through selected patients and display profile/orders.
"RTN","PSGVBW0",12,0)
 K DIR,PSJPNV S PSJPNV=1
"RTN","PSGVBW0",13,0)
 I $P(PSJSYSU,";")=3 S X=$O(^TMP("PSJSELECT",$J,1)),DIR(0)="Y",DIR("A")="Do you want to print a profile for the"_$S(X:"se",1:"")_" patient"_$S(X:"s",1:""),DIR("B")="NO" D
"RTN","PSGVBW0",14,0)
 .D ^DIR K DIR I Y D ^PSJHVARS,^PSGVBWP,RESTORE^PSJHVARS
"RTN","PSGVBW0",15,0)
 .W !!,"Select profile type for order processing.",!!
"RTN","PSGVBW0",16,0)
 D ENL^PSGOU Q:"SNL"'[PSGOL
"RTN","PSGVBW0",17,0)
 F PSJCNT=0:0 S PSJCNT=$O(^TMP("PSJSELECT",$J,PSJCNT)) Q:'PSJCNT  D PROCESS1 S PSGOP=PSGP D ENQL^PSGLW:$P(PSJSYSL,"^",2)]"" Q:$G(PSJGOTO)="E"  I $D(^TMP("PSJSELECT",$J,+$G(PSJGOTO))) S PSJCNT=PSJGOTO-1
"RTN","PSGVBW0",18,0)
 Q
"RTN","PSGVBW0",19,0)
PROCESS1 ;
"RTN","PSGVBW0",20,0)
 S PSJPN=$G(^TMP("PSJSELECT",$J,PSJCNT)) K PSJGOTO
"RTN","PSGVBW0",21,0)
 S PSJLK=$$L^PSSLOCK($P(PSJPN,U,2),1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSGVBW0",22,0)
 K PSJGOTO D:PSJPN]"" GTORDERS
"RTN","PSGVBW0",23,0)
 I PSJLK D UL^PSSLOCK($P(PSJPN,U,2))
"RTN","PSGVBW0",24,0)
 I $G(PSGPXN),$P(PSJSYSW0,U,29)]"" D  K PSGPXPT S PSGPXN=0
"RTN","PSGVBW0",25,0)
 .S PSGPXPT=PSGP
"RTN","PSGVBW0",26,0)
 .N DFN,PSGP S (PSGP,DFN)=PSGPXPT D ^PSGPER,ENCV^PSGSETU,^PSIVXU
"RTN","PSGVBW0",27,0)
 Q
"RTN","PSGVBW0",28,0)
 ;
"RTN","PSGVBW0",29,0)
DISPLAYW ; Allow selection of patients on each ward selected.
"RTN","PSGVBW0",30,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1,PSGVBWN="" F  S PSGVBWN=$O(^TMP("PSGVBW",$J,PSGVBWN)) Q:PSGVBWN=""  D DISPLAYT
"RTN","PSGVBW0",31,0)
 Q
"RTN","PSGVBW0",32,0)
 ;
"RTN","PSGVBW0",33,0)
DISPLAYT ;
"RTN","PSGVBW0",34,0)
 NEW PSGPICK  ;PSGPICK=1-->user selected order, stop display the profile
"RTN","PSGVBW0",35,0)
 D HEADER S PSGVBTM="",PSGVBY=0 F  S PSGVBTM=$O(^TMP("PSGVBW",$J,PSGVBWN,PSGVBTM))  Q:(PSGVBTM=""!$G(PSGPICK))  D V2
"RTN","PSGVBW0",36,0)
 I PSJASK,(PSGVBY>0) D ASK
"RTN","PSGVBW0",37,0)
 Q
"RTN","PSGVBW0",38,0)
 ;
"RTN","PSGVBW0",39,0)
GTORDERS ;
"RTN","PSGVBW0",40,0)
 S (PSGP,DFN)=$P(PSJPN,U,2) K PSJACNWP D ^PSJAC
"RTN","PSGVBW0",41,0)
 I PSGOL'="N" D PROFILE Q
"RTN","PSGVBW0",42,0)
 D ENGORD^PSGVBWU
"RTN","PSGVBW0",43,0)
 ;S PSJPRIO="" F  S PSJPRIO=$O(^TMP("PSJON",$J,PSJPRIO)) Q:PSJPRIO=""  S PSJON="" F  S PSJON=$O(^TMP("PSJON",$J,PSJPRIO,PSJON)) Q:PSJON=""  D DISACTIO^PSJOE(DFN,$P(PSJON,U,2),1) Q:$D(PSJGOTO)
"RTN","PSGVBW0",44,0)
 S PSJPRIO="" F  S PSJPRIO=$O(^TMP("PSJON",$J,PSJPRIO)) Q:PSJPRIO=""  S PSJON="" D
"RTN","PSGVBW0",45,0)
 . F  S PSJON=$O(^TMP("PSJON",$J,PSJPRIO,PSJON)) Q:PSJON=""  D
"RTN","PSGVBW0",46,0)
 .. I $P(PSJON,U,2)=+$P(PSJON,U,2) Q:'$$LOCK^PSJOEA(DFN,$P(PSJON,U,2))  D GTORDER2 Q
"RTN","PSGVBW0",47,0)
 .. I '$$LS^PSSLOCK(DFN,$P(PSJON,U,2)) D DISPORD(DFN,$P(PSJON,U,2)) Q
"RTN","PSGVBW0",48,0)
 .. D DISACTIO^PSJOE(DFN,$P(PSJON,U,2),1) Q:$D(PSJGOTO)  D UNL^PSSLOCK(DFN,$P(PSJON,U,2))
"RTN","PSGVBW0",49,0)
 Q
"RTN","PSGVBW0",50,0)
 ;
"RTN","PSGVBW0",51,0)
GTORDER2 ;
"RTN","PSGVBW0",52,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",$P(PSJON,U,2),PSJO)) Q:'PSJO  D
"RTN","PSGVBW0",53,0)
 .D DISACTIO^PSJOE(DFN,PSJO_"P",1) Q:$D(PSJGOTO)
"RTN","PSGVBW0",54,0)
 I $D(^TMP("PSJCOM",$J)) N PSJORD S PSJORD=$P(PSJON,U,2) D CHK^PSJOEA1
"RTN","PSGVBW0",55,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",$P(PSJON,U,2),PSJO)) Q:'PSJO  D
"RTN","PSGVBW0",56,0)
 .D UNL^PSSLOCK(DFN,PSJO_"P") Q:$G(Y)<0
"RTN","PSGVBW0",57,0)
 Q
"RTN","PSGVBW0",58,0)
 ;
"RTN","PSGVBW0",59,0)
PROFILE ; Display the patient's profile and allow order selection.
"RTN","PSGVBW0",60,0)
 S PSGP=DFN,PSJOL=PSGOL F  D EN^VALM("PSJ LM PNV") Q:'$G(PSJORD)&'$G(PSJNEWOE)  S PSJNEWOE=0
"RTN","PSGVBW0",61,0)
 Q
"RTN","PSGVBW0",62,0)
 ;
"RTN","PSGVBW0",63,0)
DONE ;
"RTN","PSGVBW0",64,0)
 K ^TMP("PSGVBW",$J),^TMP("PSJON",$J)
"RTN","PSGVBW0",65,0)
 K CF,DA,LINE,NP,POP,PPN,PR,PSGCANFL,PSGION,PSGOL,PSGOEAV,PSGOENOF,PSGON,PSGONC,PSGONR,PSGLMT,PSGORD,PSGPRF,PSGVBA,PSGVBAF,PSGVBON,PSGVBPN,PSGVBQ,PSGVBQ1,PSGVBSD,PSGVBSS,PSGVBST,PSGVBTM,PSGVBW,PSGVBWN,PSGVBY,QQ,Z
"RTN","PSGVBW0",66,0)
 Q
"RTN","PSGVBW0",67,0)
 ;
"RTN","PSGVBW0",68,0)
V2 ;
"RTN","PSGVBW0",69,0)
 S PSGVBPN="" F  S PSGVBPN=$O(^TMP("PSGVBW",$J,PSGVBWN,PSGVBTM,PSGVBPN)) Q:(PSGVBPN=""!$G(PSGPICK))  S PSGP=$P(PSGVBPN,"^",2),PPN=$P(PSGVBPN,"^") S:PPN="" PPN=PSGP_";DPT(" D WRT
"RTN","PSGVBW0",70,0)
 Q
"RTN","PSGVBW0",71,0)
 ;
"RTN","PSGVBW0",72,0)
WRT ;
"RTN","PSGVBW0",73,0)
 S PSGVBY=PSGVBY+1,PSJASK=1
"RTN","PSGVBW0",74,0)
 W !,$J(PSGVBY,4),?6,$S(PSGVBTM'="zz":PSGVBTM,1:"Not Found"),?27,PPN," (",$P(PSGVBPN,U,3),")" S ^TMP("PSJLIST",$J,PSGVBY)=PSGVBWN_U_PSGVBTM_U_PPN_U_PSGP
"RTN","PSGVBW0",75,0)
 ;I $Y+1>IOSL,(PSGVBY>0) D ASK S PSJASK=0
"RTN","PSGVBW0",76,0)
 ;I $Y+1>IOSL,(PSGVBY>0) D ASK S PSJASK=0 W @IOF
"RTN","PSGVBW0",77,0)
 I $Y+1>IOSL,(PSGVBY>0) NEW DIR S DIR(0)="EA",DIR("A")=" '^' TO QUIT " D ^DIR D
"RTN","PSGVBW0",78,0)
 . I X="^" S PSGPICK=1  Q
"RTN","PSGVBW0",79,0)
 . S PSJASK=0 W @IOF
"RTN","PSGVBW0",80,0)
 Q
"RTN","PSGVBW0",81,0)
 ;
"RTN","PSGVBW0",82,0)
ASK ;
"RTN","PSGVBW0",83,0)
 N DIR,PSGDFN S DIR(0)="LOA^1:"_PSGVBY,DIR("A")="Select 1 - "_PSGVBY_": " D ^DIR I $D(DUOUT)!$D(DTOUT) K ^TMP("PSGVBW",$J) Q
"RTN","PSGVBW0",84,0)
 S:Y]"" PSGPICK=1
"RTN","PSGVBW0",85,0)
 F PSJINDEX=1:1:$L(Y,",")-1 D
"RTN","PSGVBW0",86,0)
 . S X=$G(^TMP("PSJLIST",$J,$P(Y,",",PSJINDEX))),PSGDFN=$P(X,"^",4)_"^"_$P(X,"^",3)
"RTN","PSGVBW0",87,0)
 . D CHK^PSJDPT(.PSGDFN,1) I PSGDFN=-1 Q
"RTN","PSGVBW0",88,0)
 . S:X]"" ^TMP("PSJSELECT",$J,PSJCNT)=$P(X,U,3,4),^TMP("PSJSELECT",$J,"B",$P(X,U,3),PSJCNT)="",PSJCNT=PSJCNT+1
"RTN","PSGVBW0",89,0)
 ;K ^TMP("PSJLIST",$J)
"RTN","PSGVBW0",90,0)
 Q
"RTN","PSGVBW0",91,0)
 ;
"RTN","PSGVBW0",92,0)
H2 ;
"RTN","PSGVBW0",93,0)
 W !!?2,"Select patients either singularly separated by commas (1,2,3), by a range of",!,"patients separated by a dash (1-3), or a combination (1,2,4-6).  To select all",!,"patients, enter 'ALL' or a dash ('-').  You can also enter '-n' to"
"RTN","PSGVBW0",94,0)
 W " select the",!,"first patient through the 'nth' patient or enter 'n-' to select the 'nth'",!,"patient through the last patient.  If a patient is selected more than once,"
"RTN","PSGVBW0",95,0)
 W !,"only the first selection is used.  (Entering '1,2,1' would return '1,2'.)" Q
"RTN","PSGVBW0",96,0)
 ;
"RTN","PSGVBW0",97,0)
HEADER ;
"RTN","PSGVBW0",98,0)
 W:$Y @IOF W !,"ORDERS NOT VERIFIED BY A ",$S($P(PSJSYSU,";",3)>1:"PHARMACIST",1:"NURSE")," - ",$S(PSGVBWN="ZZ":"^OTHER",1:PSGVBWN)
"RTN","PSGVBW0",99,0)
 W !!," No.",?7,"TEAM",?32,"PATIENT",!,LINE K PSGVBY S PSGVBY=0 Q
"RTN","PSGVBW0",100,0)
 Q
"RTN","PSGVBW0",101,0)
 ;
"RTN","PSGVBW0",102,0)
NP ;
"RTN","PSGVBW0",103,0)
 W $C(7) R !!,"ENTER AN '^' TO SELECT ORDERS NOW, OR PRESS THE RETURN KEY TO CONTINUE. ",NP:DTIME E  S NP="^"
"RTN","PSGVBW0",104,0)
 Q
"RTN","PSGVBW0",105,0)
DISPORD(DFN,ON)     ;Display the order that being lock by another user
"RTN","PSGVBW0",106,0)
 NEW PSJLINE,PSJOC,X
"RTN","PSGVBW0",107,0)
 S PSJLINE=1
"RTN","PSGVBW0",108,0)
 D DSPLORDU^PSJLMUT1(DFN,ON)
"RTN","PSGVBW0",109,0)
 W ! F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  W !,PSJOC(ON,X)
"RTN","PSGVBW0",110,0)
 Q
"RTN","PSGVBW0",111,0)
        
"RTN","PSGVBWU")
0^74^B44209962
"RTN","PSGVBWU",1,0)
PSGVBWU ;BIR/CML3,MV-GET ORDERS FOR COMPLETE/VERIFY ;15 May 98 / 9:26 AM
"RTN","PSGVBWU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,44,47,67,58,110**;16 DEC 97
"RTN","PSGVBWU",3,0)
 ;
"RTN","PSGVBWU",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGVBWU",5,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039.
"RTN","PSGVBWU",6,0)
 ; Reference to ^DPT is supported by DBIA 10035.
"RTN","PSGVBWU",7,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSGVBWU",8,0)
 ; Reference to ^%ZISS is supported by DBIA 10088.
"RTN","PSGVBWU",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSGVBWU",10,0)
 ; Reference to ^VADPT is supported by DBIA 10061.
"RTN","PSGVBWU",11,0)
 ;
"RTN","PSGVBWU",12,0)
ECHK(DFN,O,DT,SD) ;
"RTN","PSGVBWU",13,0)
 N OK S OK=0
"RTN","PSGVBWU",14,0)
 I $P($G(^PS(55,DFN,5,O,0)),U,9)'["D" S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D
"RTN","PSGVBWU",15,0)
 .;I "DE"'[$P($G(^PS(55,DFN,5,O,0)),U,9) S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D
"RTN","PSGVBWU",16,0)
 .I $S(SD>PSGDT:$S(ND="":1,'$P(ND4,U,$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND4,U,13):1,$P(ND4,U,19):1,$P(ND4,U,23):1,1:$P(ND4,U,16)),$P(ND,U,7)="O":$S(ND4="":1,1:'$P(ND4,U,$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND4,U,16)) S OK=1
"RTN","PSGVBWU",17,0)
 Q OK
"RTN","PSGVBWU",18,0)
ECHK2(DFN,O,DT,SD) ;
"RTN","PSGVBWU",19,0)
 N OK S OK=0
"RTN","PSGVBWU",20,0)
 I $P($G(^PS(55,DFN,"IV",O,0)),U,17)'["D" S ND=$G(^(0)) Q:ND="" 0  S ND4=$G(^(4)) D:SD>PSGDT
"RTN","PSGVBWU",21,0)
 . I (+PSJSYSU=1)&('$P(ND4,U,+PSJSYSU)) S OK=1 Q
"RTN","PSGVBWU",22,0)
 . I (+PSJSYSU=3)&('$P(ND4,U,+PSJSYSU+1)) S OK=1 Q
"RTN","PSGVBWU",23,0)
 Q OK
"RTN","PSGVBWU",24,0)
 ;
"RTN","PSGVBWU",25,0)
SET ;
"RTN","PSGVBWU",26,0)
 I ON["P",$G(PSJCOM)]"",$G(PRNTON)=+PSJCOM Q
"RTN","PSGVBWU",27,0)
 I ON["P",$G(PSJCOM)]"" S PRNTON=+PSJCOM,ON=+PSJCOM
"RTN","PSGVBWU",28,0)
 S PSJPRIO=$S($G(PSJPRIO)="S":"A",1:"Z"),^TMP("PSJON",$J,PSJPRIO,LD_U_ON)=""
"RTN","PSGVBWU",29,0)
 Q
"RTN","PSGVBWU",30,0)
 ;
"RTN","PSGVBWU",31,0)
CNTORDRS ; Display # pending orders by type and ward group
"RTN","PSGVBWU",32,0)
 K ^TMP("PSJ",$J) D:$G(IOST(0)) ENS^%ZISS
"RTN","PSGVBWU",33,0)
 N DFN,DIRUT,ON,TYP,PSGODT,PSJWD,PSJWG,X,X1,X2
"RTN","PSGVBWU",34,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBWU",35,0)
 W !!,"Searching for Pending and Non-Verified orders"
"RTN","PSGVBWU",36,0)
 F STAT="P","N","I" F DFN=0:0 S DFN=$O(^PS(53.1,"AS",STAT,DFN)) Q:'DFN  D
"RTN","PSGVBWU",37,0)
 .W "." S PSJWG=$$WGNM($P($G(^DPT(DFN,.1)),U))
"RTN","PSGVBWU",38,0)
 .F ON=0:0 S ON=$O(^PS(53.1,"AS",STAT,DFN,ON)) Q:'ON  D
"RTN","PSGVBWU",39,0)
 ..;S TYP=$S(STAT="N"!(STAT="I"):"N",1:$P($G(^PS(53.1,ON,0)),U,4)) D CNTSET(PSJWG,$F("FIUN",TYP)-1)
"RTN","PSGVBWU",40,0)
 ..S TYP=$P($G(^PS(53.1,ON,0)),U,4),OTYP=$S((STAT="P")&(TYP="F"):1,(STAT="P")&(TYP="I"):1,(STAT="P")&(TYP="U"):2,TYP="F":3,TYP="I":3,1:4) D CNTSET(PSJWG,OTYP)
"RTN","PSGVBWU",41,0)
 ;
"RTN","PSGVBWU",42,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBWU",43,0)
 .N PSJXR S PSJXR=$S(+PSJSYSU=3:"APV",1:"ANV") F DFN=0:0 S DFN=$O(^PS(55,PSJXR,DFN)) Q:'DFN  D
"RTN","PSGVBWU",44,0)
 ..W "." D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP F PSGORD=0:0 S PSGORD=$O(^PS(55,PSJXR,DFN,PSGORD)) Q:'PSGORD  D
"RTN","PSGVBWU",45,0)
 ...S PSGST=$P($G(^PS(55,DFN,5,PSGORD,0)),U,7),PSGFD=$P($G(^(2)),U,4) I ((PSGST="O")&(PSJPAD>0)&(PSGFD>PSJPAD))!((PSGST'="O")&(PSGFD'<PSGODT)) I $$ECHK(DFN,PSGORD,PSGDT,PSGFD) S PSJWD=$P($G(^DPT(DFN,.1)),U) I PSJWD]"" D
"RTN","PSGVBWU",46,0)
 ....S PSJWG=$$WGNM(PSJWD) D CNTSET(PSJWG,4)
"RTN","PSGVBWU",47,0)
 .N PSJXR S PSJXR=$S(+PSJSYSU=3:"APIV",1:"ANIV") F DFN=0:0 S DFN=$O(^PS(55,PSJXR,DFN)) Q:'DFN  D
"RTN","PSGVBWU",48,0)
 ..W "." D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP F PSGORD=0:0 S PSGORD=$O(^PS(55,PSJXR,DFN,PSGORD)) Q:'PSGORD  D
"RTN","PSGVBWU",49,0)
 ...S PSGFD=$P($G(^PS(55,DFN,"IV",PSGORD,0)),U,3) I $$ECHK2(DFN,PSGORD,PSGDT,PSGFD) S PSJWD=$P($G(^DPT(DFN,.1)),U) I PSJWD]"" D
"RTN","PSGVBWU",50,0)
 ....S PSJWG=$$WGNM(PSJWD) D CNTSET(PSJWG,3)
"RTN","PSGVBWU",51,0)
 I $D(^XTMP("PSJPVNV")) S PSJWD="" F  S PSJWD=$O(^DPT("CN",PSJWD)) Q:PSJWD=""  S PSJWG=$$WGNM(PSJWD) F DFN=0:0 S DFN=$O(^DPT("CN",PSJWD,DFN)) Q:'DFN  D
"RTN","PSGVBWU",52,0)
 .; removed ref to ^DGPM
"RTN","PSGVBWU",53,0)
 .;S PSJPAD=9999999.9999999-$O(^DGPM("ATID1",DFN,0))
"RTN","PSGVBWU",54,0)
 .D IN5^VADPT S PSJPAD=+VAIP(3) K VAIP
"RTN","PSGVBWU",55,0)
 .W "."
"RTN","PSGVBWU",56,0)
 .F PSJST="C","O","OC","P","R" F PSGFD=$S(PSJST="O":PSJPAD,1:PSGODT):0 S PSGFD=$O(^PS(55,DFN,5,"AU",PSJST,PSGFD)) Q:'PSGFD  D
"RTN","PSGVBWU",57,0)
 ..F PSGORD=0:0 S PSGORD=$O(^PS(55,DFN,5,"AU",PSJST,PSGFD,PSGORD)) Q:'PSGORD  I $$ECHK(DFN,PSGORD,PSGDT,PSGFD) D CNTSET(PSJWG,4)
"RTN","PSGVBWU",58,0)
 .F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,"IV","AIS",SD,O)) Q:'O  S ON=O_"V" I $$ECHK2(PSGP,O,PSGDT,SD) D CNTSET(PSJWG,3)
"RTN","PSGVBWU",59,0)
 ;
"RTN","PSGVBWU",60,0)
DISPLAY ;
"RTN","PSGVBWU",61,0)
 D CNTHEAD I '$D(^TMP("PSJ",$J)) W ?21,"No pending/non-verified orders found.",! Q
"RTN","PSGVBWU",62,0)
 S WG="" F  S WG=$O(^TMP("PSJ",$J,WG)) Q:WG=""!$D(DIRUT)  S X=$G(^(WG)) D
"RTN","PSGVBWU",63,0)
 .;W $S(WG="ZZ":"^OTHER",1:WG),?30,$J(+X,6),?44,$J(+$P(X,U,2),6),?58,$J(+$P(X,U,3),6),?72,$J(+$P(X,U,4),6),!
"RTN","PSGVBWU",64,0)
 .W $S(WG="ZZ":"^OTHER",1:WG),?26,$J(+X,6),?36,$J(+$P(X,U,2),6),?51,$J(+$P(X,U,3),6),?63,$J(+$P(X,U,4),6),!
"RTN","PSGVBWU",65,0)
 .I $Y>(IOSL-2) N DIR S DIR(0)="E" D ^DIR Q:$D(DIRUT)  D CNTHEAD
"RTN","PSGVBWU",66,0)
 Q
"RTN","PSGVBWU",67,0)
CNTSET(WG,X) ; Update counters for ward group totals
"RTN","PSGVBWU",68,0)
 ; Input: WG - Ward Group IEN
"RTN","PSGVBWU",69,0)
 ;         X - piece identifying order type.
"RTN","PSGVBWU",70,0)
 S $P(^TMP("PSJ",$J,WG),U,X)=$P($G(^TMP("PSJ",$J,WG)),U,X)+1
"RTN","PSGVBWU",71,0)
 Q
"RTN","PSGVBWU",72,0)
 ;
"RTN","PSGVBWU",73,0)
WGNM(WD) ; DETERMINE WARD GROUP NAME
"RTN","PSGVBWU",74,0)
 N WG
"RTN","PSGVBWU",75,0)
 I WD]"" S WG=+$O(^PS(57.5,"AB",+$O(^DIC(42,"B",WD,0)),0)),WG=$P($G(^PS(57.5,WG,0)),U)
"RTN","PSGVBWU",76,0)
 S:$G(WG)="" WG="ZZ"
"RTN","PSGVBWU",77,0)
 Q WG
"RTN","PSGVBWU",78,0)
 ;
"RTN","PSGVBWU",79,0)
CNTHEAD ; Header for order count.
"RTN","PSGVBWU",80,0)
 ;W @IOF,!,?16,"Pending/Non-Verified Order Totals by Ward Group",!!,?29,"Pending",?43,"Pending",?57,"Pending",!
"RTN","PSGVBWU",81,0)
 ;W "Ward Group",?30,"Fluids",?48,"IV",?55,"Unit Dose",?66,"Non-Verified",!!
"RTN","PSGVBWU",82,0)
 W @IOF,!,?16,"Pending/Non-Verified Order Totals by Ward Group/Clinic Location",!!,?33,"Pending",?56,"Non-Verified",!
"RTN","PSGVBWU",83,0)
 W "Ward Group/Clinic Location",?30,"IV",?40,"UD",?55,"IV",?67,"UD",!!
"RTN","PSGVBWU",84,0)
 Q
"RTN","PSGVBWU",85,0)
 ;
"RTN","PSGVBWU",86,0)
ENGORD ; get and sort order
"RTN","PSGVBWU",87,0)
 N PSJCOM,PRNTON
"RTN","PSGVBWU",88,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12),X1=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT),UDU=$P(PSJSYSU,";",3)>1 K ^TMP("PSJON",$J)
"RTN","PSGVBWU",89,0)
 W !!,"...a few moments, please..."
"RTN","PSGVBWU",90,0)
 I PSJTOO'=2 F PSGO2=+PSJPAD:0 S PSGO2=$O(^PS(55,PSGP,5,"AUS",PSGO2)) Q:'PSGO2  Q:PSGO2>PSGDT  F PSGO3=0:0 S PSGO3=$O(^PS(55,PSGP,5,"AUS",PSGO2,PSGO3)) Q:'PSGO3  I $D(^PS(55,PSGP,5,PSGO3,0)) S PSGO4=^(0) I "DEH"'[$E($P(PSGO4,"^",9)) D ENUH
"RTN","PSGVBWU",91,0)
 K PSGO1,PSGO2,PSGO3,PSGO4
"RTN","PSGVBWU",92,0)
 I PSJTOO'=1 F SD="I","P" F O=0:0 S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  D
"RTN","PSGVBWU",93,0)
 .S ND=$G(^PS(53.1,O,0)),PSJPRIO=$P($G(^(.2)),U,4),PSJCOM=$P($G(^(.2)),U,8),LD=$P($G(^PS(53.1,O,0)),U,16),ON=O_"P"
"RTN","PSGVBWU",94,0)
 .I $S(PSJPAC=3:1,PSJPAC=1&($P(ND,U,4)="U"):1,PSJPAC=2&($P(ND,U,4)'="U"):1,+$P(ND,U,13)&$G(PSJRNF):1,+$P(ND,U,13)&$G(PSJIRNF):1,1:0) D SET
"RTN","PSGVBWU",95,0)
 Q:PSJTOO=2
"RTN","PSGVBWU",96,0)
 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  S ON=O_"U" I $$ECHK(PSGP,O,PSGDT,SD) S LD=$P($G(^PS(55,PSGP,5,O,0)),U,16) D SET
"RTN","PSGVBWU",97,0)
 F O=0:0 S O=$O(^PS(53.1,"AS","N",PSGP,O)) Q:'O  S LD=$P($G(^PS(53.1,O,0)),U,16),PSJCOM=$P($G(^(.2)),U,8) S ON=O_"P" D SET
"RTN","PSGVBWU",98,0)
 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,"IV","AIS",SD,O)) Q:'O  S ON=O_"V" I $$ECHK2(PSGP,O,PSGDT,SD) S LD=$P($G(^PS(55,PSGP,"IV",O,2)),U) D SET
"RTN","PSGVBWU",99,0)
 Q
"RTN","PSGVBWU",100,0)
 ;
"RTN","PSGVBWU",101,0)
ENUH ;
"RTN","PSGVBWU",102,0)
 S $P(^PS(55,PSGP,5,PSGO3,0),"^",9)="E" D EN1^PSJHL2(PSGP,"SC",PSGO3_"U")
"RTN","PSGVBWU",103,0)
 Q
"RTN","PSGVBWU",104,0)
GOTOP ; Skip to a specific patient in list.
"RTN","PSGVBWU",105,0)
 I '$$HIDDEN^PSJLMUTL("JUMP") S VALMBCK="R" Q
"RTN","PSGVBWU",106,0)
 K PSJGOTO,DIR S DIR(0)="SM^J:Jump to a specific patient;E:Exit",DIR("A")="Select Action: ",DIR("B")="Exit" D ^DIR
"RTN","PSGVBWU",107,0)
 Q:"JE"'[Y
"RTN","PSGVBWU",108,0)
 I Y="E" S PSJGOTO=Y Q
"RTN","PSGVBWU",109,0)
 K DIR S DIR(0)="PO^2:AEMQZ",DIR("S")="I $P(^(0),U)]"""",$D(^TMP(""PSJSELECT"",$J,""B"",$P(^(0),U)))",DIR("??")="^D GOTOPH^PSGVBWU" D ^DIR I Y<0 S PSGTOTO=Y Q
"RTN","PSGVBWU",110,0)
 S VALMBCK="R",PSJGOTO=$S($P(Y,U,2)="":"E",1:$O(^TMP("PSJSELECT",$J,"B",$P(Y,U,2),0)))
"RTN","PSGVBWU",111,0)
 Q
"RTN","PSGVBWU",112,0)
 ;
"RTN","PSGVBWU",113,0)
GOTOPH ;
"RTN","PSGVBWU",114,0)
 F X=0:0 S X=$O(^TMP("PSJSELECT",$J,X)) Q:'X  W !,$P($G(^TMP("PSJSELECT",$J,X)),U) I X#IOSL=0 N DIR S DIR(0)="E" D ^DIR Q:$D(DIRUT)
"RTN","PSGVBWU",115,0)
 Q
"RTN","PSGVW")
0^19^B29380284
"RTN","PSGVW",1,0)
PSGVW ;BIR/CML3-EXPANDED VIEW OF AN ORDER ;17 SEP 97 /  1:41 PM
"RTN","PSGVW",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,58,85,80,104,110**;16 DEC 97
"RTN","PSGVW",3,0)
 ;
"RTN","PSGVW",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSGVW",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSGVW",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGVW",7,0)
 ; Reference to ES^ORX8 is supported by DBIA# 3632.
"RTN","PSGVW",8,0)
 ;
"RTN","PSGVW",9,0)
EN1 ;
"RTN","PSGVW",10,0)
 S PSGORD=^TMP("PSJON",$J,PSGOE2)
"RTN","PSGVW",11,0)
 ;
"RTN","PSGVW",12,0)
EN2 ;
"RTN","PSGVW",13,0)
 I PSGORD=+PSGORD N PSGO,PSGO1 S PSGO=PSGORD,PSGO1=0 F  S PSGO1=$O(^PS(53.1,"ACX",PSGO,PSGO1)) Q:'PSGO1  Q:$G(PSGOEA)["^"  S PSGORD=PSGO1_"P" D  S PSGORD=""
"RTN","PSGVW",14,0)
 . D EN21 K CONT D  Q:$G(PSGOEA)["^"
"RTN","PSGVW",15,0)
 .. W !!,"Press RETURN to continue or '^' to exit: " R CONT:DTIME W @IOF S:CONT["^" PSGOEA="^",PSGPR=1,PSJPR=1
"RTN","PSGVW",16,0)
 I PSGORD="" S PSGOEA="^" Q
"RTN","PSGVW",17,0)
EN21 ;
"RTN","PSGVW",18,0)
 K ^PS(53.45,PSJSYSP,2)
"RTN","PSGVW",19,0)
 N ESIG,PSJ21
"RTN","PSGVW",20,0)
 S NF=$S(PSGORD["P":1,PSGORD["N":1,1:0)
"RTN","PSGVW",21,0)
 S (FL,Y)="",$P(FL,"-",71)="",F="^PS("_$S(NF:"53.1,",1:"55,"_PSGP_",5,")_+PSGORD_","
"RTN","PSGVW",22,0)
 S PN=$G(PSGP(0)) S:PN="" PN=$P($G(^DPT(PSGP,0)),"^")
"RTN","PSGVW",23,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",24,0)
 S OD=$G(@(F_"0)")),STAT=$P(OD,U,9),PSJ21=$P(OD,U,21),PDRG=$G(^(.2)),INS=$G(^(.3)),AT=$G(^(2)),ND4=$G(^(4)),EB=$P(ND4,"^",7) S:'NF XU=$G(^(5)) S X=$P($G(^(6)),"^"),SIG=$G(^(6.5)),DO=$G(^(1,1,0))
"RTN","PSGVW",25,0)
 S PR=$P(OD,"^",2),MR=$P(OD,"^",3),SM=$P(OD,"^",5),HSM=$P(OD,"^",6),SCT=$S(PSGORD'["P":$P(OD,"^",7),1:""),ST=$P(OD,"^",9),(PSGLI,LID)=$P(OD,"^",16),OD=$P(OD,"^",14),DO=$P(PDRG,"^",2),ESIG=$P(PDRG,"^",3),PDRG=+PDRG
"RTN","PSGVW",26,0)
L S SCH=$P(AT,"^"),STD=$S(STAT'["P":$P(AT,"^",2),1:""),FD=$S(STAT'["P":$P(AT,"^",4),1:""),FQC=$P(AT,"^",6),AT=$P(AT,"^",5) I FQC="D",AT="" S AT=$E($P(STD,".",2)_"0000",1,4)
"RTN","PSGVW",27,0)
 S PRI=$S('PR:0,1:$P($G(^VA(200,PR,"PS")),"^",4)),DRGI=$S('PDRG:0,1:$P($G(^PS(50.7,PDRG,0)),"^",4)),PR=$$ENNPN^PSGMI(PR) S:PRI PRI=PRI'>DT S:DRGI DRGI=DRGI'>DT
"RTN","PSGVW",28,0)
 I PSJ21]"",$L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+PSJ21_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSGVW",29,0)
 S PR=PR_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSGVW",30,0)
 S DRG=$$OIDF^PSJLMUT1(+PDRG) S SI=$S(X]"":$$ENSET^PSGSICHK(X),1:"")
"RTN","PSGVW",31,0)
 F Q="FD","LID","OD","STD" S @Q=$$ENDTC^PSGMI(@Q)
"RTN","PSGVW",32,0)
 Q:$D(PSJLM)
"RTN","PSGVW",33,0)
 ;
"RTN","PSGVW",34,0)
WRT ;
"RTN","PSGVW",35,0)
 Q:($G(@(F_"0)"))="")
"RTN","PSGVW",36,0)
 W !! W:'$D(PSGVWA) ?5,FL,! W "Patient: ",PN
"RTN","PSGVW",37,0)
 W ?47,"Status: " I ST["D" W "DISCONTINUED",$S(ST["E":" (EDIT)",ST["R":" (RENEWAL)",1:"")
"RTN","PSGVW",38,0)
 E  W $S(ST="E":"EXPIRED",$P($G(@(F_"0)")),U,27)="R":"RENEWED",ST="":"NOT FOUND",ST="RE":"REINSTATED",1:$P(ST_"^ACTIVE^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^UNRELEASED","^",$F("AHINPU",ST)))
"RTN","PSGVW",39,0)
 W !,"Orderable Item: ",DRG
"RTN","PSGVW",40,0)
 W !?2,"Instructions: ",INS
"RTN","PSGVW",41,0)
 W !,"Dosage Ordered: ",DO
"RTN","PSGVW",42,0)
 S PSJDUR="" I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSGVW",43,0)
 I $G(PSGORD),($G(PSJDUR)="") S P=$S(PSGORD["U":5,1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,P)
"RTN","PSGVW",44,0)
 W !?6,"Duration: ",PSJDUR
"RTN","PSGVW",45,0)
 W ?48,"Start: ",STD
"RTN","PSGVW",46,0)
 W !?5,"Med Route: ",$S(MR:$S($D(^PS(51.2,+MR,0)):$P(^(0),"^")_$S($P(^(0),"^",3)]"":" ("_$P(^(0),"^",3)_")",1:""),1:MR),1:"NOT FOUND")
"RTN","PSGVW",47,0)
 N RNDT,PSGLRN S PSGLRN=$$LASTREN^PSJLMPRI(PSGP,PSGORD) I PSGLRN S RNDT=$$ENDTC^PSGMI(+PSGLRN) W ?46,"Renewed: ",RNDT
"RTN","PSGVW",48,0)
 W !,$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSGVW",49,0)
 W ?49,"Stop: ",FD
"RTN","PSGVW",50,0)
 I $G(PSGORD),($G(PSJDUR)="") S P=$S(PSGORD["U":5,1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,P)
"RTN","PSGVW",51,0)
 W !?1,"Schedule Type: ",$$ENSTN^PSGMI(SCT)
"RTN","PSGVW",52,0)
 W !?6,"Schedule: ",$S(SCH="":"NOT FOUND",$L(SCH)>27:$E(SCH,1,24)_"...",1:SCH)
"RTN","PSGVW",53,0)
 W !?3,$S(AT&("P"'[SCT):"Admin Times: "_AT,1:"(No Admin Times)"),!?6,"Provider: ",PR
"RTN","PSGVW",54,0)
 I SI]"" W !,"Special Instructions: " F Q=1:1:$L(SI," ") S QQ=$P(SI," ",Q) W:$L(QQ)+$X>79 !?2 W QQ," "
"RTN","PSGVW",55,0)
 W !?48,"Units",?56,"Units",?64,"Inactive",!," Dispense Drugs",?43,"U/D",?48,"Disp'd",?56,"Ret'd",?64,"Date",!,FL,$E(FL,1,10)
"RTN","PSGVW",56,0)
 ; the naked reference on the line below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",57,0)
 F X=0:0 S X=$O(@(F_"1,"_X_")")) Q:'X  S DRG=$G(^(X,0)) I DRG]"" D  ;
"RTN","PSGVW",58,0)
 .S UD=$P(DRG,"^",2),D=$P(DRG,"^",6)+$P(DRG,"^",10)+$P(DRG,"^",12),R=+$P(DRG,"^",7),Y=$P(DRG,"^",3),DRG=$P(DRG,"^") I Y S Y=$E($$ENDTC^PSGMI(Y),1,8)
"RTN","PSGVW",59,0)
 .W !?1,$$ENDDN^PSGMI(DRG),?43,$S(UD:UD,1:1),?48,D,?56,R W:Y ?64,Y Q
"RTN","PSGVW",60,0)
 ; the naked reference on the two lines below refers to the full reference created by indirect reference to F_ON, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSGVW",61,0)
 I $O(@(F_"12,0)")) W !!,"Provider Comments:" F Q=0:0 S Q=$O(@(F_"12,"_Q_")")) Q:'Q  N Y S Y=^(Q,0) W !,Y
"RTN","PSGVW",62,0)
 I $O(@(F_"3,0)")) W !!,"Comments:" F Q=0:0 S Q=$O(@(F_"3,"_Q_")")) Q:'Q  W !,^(Q,0)
"RTN","PSGVW",63,0)
ACTFLG W ! S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSGVW",64,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSGVW",65,0)
 W:AT]"" !,"ORDER ",$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSGVW",66,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" W "  (",$P(AT,"^",10),")"
"RTN","PSGVW",67,0)
 W !,"Self Med: " I SM W "SELF MED" W:HSM "  (HOSPITAL SUPPLIED)"
"RTN","PSGVW",68,0)
 I 'SM&('HSM) W "NO"
"RTN","PSGVW",69,0)
 W !!,"Entry By: ",$$ENNPN^PSGMI(EB),?52,"Entry Date: ",LID
"RTN","PSGVW",70,0)
 I $G(PSGLRN) W !,"Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2))
"RTN","PSGVW",71,0)
 W:DRGI !!?3,"(THE ORDERABLE ITEM IS CURRENTLY LISTED AS INACTIVE.)" I PRI W:'DRGI ! W !?3,"(PROVIDER IS CURRENTLY LISTED AS INACTIVE.)"
"RTN","PSGVW",72,0)
 ;
"RTN","PSGVW",73,0)
DONE ;
"RTN","PSGVW",74,0)
 K AND,D,DRG1,DRG2,AT,DO,DRG,EB,F,FD,FL,HSM,INS,LID,MR,ND4,OD,PN,PR,PSGID,PSGOD,R,SCH,SCT,SI,SIG,SM,ST,STD,UD,X,XU,Y Q
"RTN","PSGVW",75,0)
 Q
"RTN","PSIV")
0^57^B25417268
"RTN","PSIV",1,0)
PSIV ;BIR/PR,MLM-MISC UTILITIES ;19 Mar 99 / 9:45 AM
"RTN","PSIV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,16,29,38,53,56,72,58,110**;16 DEC 97
"RTN","PSIV",3,0)
 ;
"RTN","PSIV",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIV",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789
"RTN","PSIV",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000
"RTN","PSIV",7,0)
 ; Reference to ^DIC is supported by DBIA 10006
"RTN","PSIV",8,0)
 ; Reference to ^DIE is supported by DBIA 10018
"RTN","PSIV",9,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSIV",10,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSIV",11,0)
 ; Reference to ^VALM1 is supported by DBIA 10116
"RTN","PSIV",12,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIV",13,0)
 ;
"RTN","PSIV",14,0)
ENGETP ;Enter here to select patient.
"RTN","PSIV",15,0)
 K DIC S DIC("W")="W ""  "",$P(^(0),""^"",9) W:$D(^(.1)) ""  "",^(.1)",DIC="^DPT(",DIC(0)="QEM"
"RTN","PSIV",16,0)
 D FULL^VALM1
"RTN","PSIV",17,0)
GETP1 ;
"RTN","PSIV",18,0)
 S PSGPTMP=0,PPAGE=1,DFN=-1,X="Select PATIENT:^^^^1" D ENQ Q:"^"[X
"RTN","PSIV",19,0)
 D EN^PSJDPT
"RTN","PSIV",20,0)
 I Y<0 G ENGETP
"RTN","PSIV",21,0)
 N PSGP,PSJACNWP S (PSGP,DFN)=+Y D ENBOTH^PSJAC S PSJORL=$$ENORL^PSJUTL($G(VAIN(4)))
"RTN","PSIV",22,0)
 Q
"RTN","PSIV",23,0)
 ;
"RTN","PSIV",24,0)
ENYN ;Enter here for yes/no responses. This is a general reader that I have
"RTN","PSIV",25,0)
 ;been phasing out with ^DICN
"RTN","PSIV",26,0)
 S X=X_"^Y:YES;N:NO^YES,NO"
"RTN","PSIV",27,0)
 ;
"RTN","PSIV",28,0)
ENQ ;Enter here to read X. This is the general reader that I have
"RTN","PSIV",29,0)
 ;been slowly phasing out
"RTN","PSIV",30,0)
 S QUD=$P(X,"^",2) W !!,$P(X,"^")," " W:QUD]"" QUD,"// " R QUX:DTIME W:'$T $C(7) S:'$T QUX="^" S:QUX="" QUX=QUD I QUX["^"!(QUX["?") G KILL
"RTN","PSIV",31,0)
 I $L(QUX)>500 W "    ??" G ENQ
"RTN","PSIV",32,0)
 S:QUX?1L QUX=$C($A(QUX)-32)
"RTN","PSIV",33,0)
 S QUD=";"_$P(X,"^",3)_";" G:QUD'[(";"_QUX_":") VAR S QUX1=$E(QUD,$F(QUD,QUX_":"),($F(QUD,";",$F(QUD,QUX_":"))-2)) G:QUX1[":" VAR W "    ",QUX1 G KILL
"RTN","PSIV",34,0)
VAR F QUX1=1:1 S QUD=$P($P(X,"^",4),",",QUX1) Q:QUD=""  I $P(QUD,QUX)="" W $S($P(X,"^",2)=QUX:"    "_QUX,1:"")_$P(QUD,QUX,2,99) S QUX=QUD G KILL
"RTN","PSIV",35,0)
PAT I $P(X,"^",5)]"",@$P(X,"^",5,999) G KILL
"RTN","PSIV",36,0)
 W $C(7)," ???" G ENQ
"RTN","PSIV",37,0)
KILL S X=QUX K QUX,QUX1,QUD Q
"RTN","PSIV",38,0)
 ;
"RTN","PSIV",39,0)
ENADM ;Edit administration schedules.
"RTN","PSIV",40,0)
 S DIC="^PS(51.1,",DIC(0)="QEAML",DLAYGO=51.1 D ^DIC K:+Y<0 %,DA,D0,DIC,DIE,DLAYGO,DR,Z,Y Q:'$D(Y)  S DIE=DIC,DR=".01;1",DA=+Y K DIC D ^DIE G ENADM
"RTN","PSIV",41,0)
 ;
"RTN","PSIV",42,0)
ENOW D NOW^%DTC S Y=% K %,%H,%I
"RTN","PSIV",43,0)
 Q
"RTN","PSIV",44,0)
 ;
"RTN","PSIV",45,0)
ENC ;Get unit of measure for drug seleted.
"RTN","PSIV",46,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSIV",47,0)
 Q
"RTN","PSIV",48,0)
 ;
"RTN","PSIV",49,0)
ENCHS ;Needs PSIVBR (Branch point)
"RTN","PSIV",50,0)
 D ENGETP G:DFN<0 Q
"RTN","PSIV",51,0)
 ;* Lock patient if calling FROM PSJI DELETE ORDER.
"RTN","PSIV",52,0)
 ;* I PSIVBR="D ENT^PSIVPGE" S X=DFN_";DPT(" D LK^ORX2 Q:'Y
"RTN","PSIV",53,0)
 I PSIVBR="D ENT^PSIVPGE",('$$L^PSSLOCK(DFN,1)) Q
"RTN","PSIV",54,0)
OE N CONT S CONT=0
"RTN","PSIV",55,0)
 F  Q:CONT  D ENCHS1
"RTN","PSIV",56,0)
 Q:$D(ORVP)
"RTN","PSIV",57,0)
 G ENCHS
"RTN","PSIV",58,0)
ENCHS1 ;
"RTN","PSIV",59,0)
 S PSJORQF=0,CONT=0
"RTN","PSIV",60,0)
 S PSJPROT=2,PSJOL="",(PSGOP,PSGP)=DFN
"RTN","PSIV",61,0)
 K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSIV",62,0)
 S VALMCNT=30
"RTN","PSIV",63,0)
 I PSIVBR="D PROCESS^PSIVRD",(PSJOL="N") D ORDNO^PSIVRD Q
"RTN","PSIV",64,0)
 I $G(PSJNEWOE) S PSJOL="S"
"RTN","PSIV",65,0)
 I PSJOL="S"!(PSJOL="L") F  Q:CONT  S P("PT")=PSJOL D
"RTN","PSIV",66,0)
 . S PSJORQF=0,PSJNEWOE=0
"RTN","PSIV",67,0)
 . D ENNB^PSIVACT
"RTN","PSIV",68,0)
 . I '$D(^TMP("PSIV",$J)) D FULL^VALM1 W !!,?30,"NO ORDERS FOUND",! K DIR S DIR(0)="E" D ^DIR W @IOF S CONT=0
"RTN","PSIV",69,0)
 . NEW PSJIVPRF S PSJIVPRF=1
"RTN","PSIV",70,0)
 . S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSIV",71,0)
 . D EN^VALM("PSJ LM IV OE")
"RTN","PSIV",72,0)
 . I $G(VALMBCK)="Q" Q
"RTN","PSIV",73,0)
 . S CONT=1
"RTN","PSIV",74,0)
 ;* Unlock patient if come from PSJI DELETE ORDER
"RTN","PSIV",75,0)
 ;* I PSIVBR="D ENT^PSIVPGE" S X=DFN_";DPT(" D ULK^ORX2
"RTN","PSIV",76,0)
 I '$G(PSJORQF) S CONT=1
"RTN","PSIV",77,0)
 I PSIVBR="D ENT^PSIVPGE" D UL^PSSLOCK(DFN)
"RTN","PSIV",78,0)
 K PSJLMPRO
"RTN","PSIV",79,0)
 Q
"RTN","PSIV",80,0)
SELSO ;SELECT ORDER USING "SO" OPTION
"RTN","PSIV",81,0)
 S PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON,OV
"RTN","PSIV",82,0)
 Q
"RTN","PSIV",83,0)
SELNUM ;SELECT ORDERS WITH NUMBERS
"RTN","PSIV",84,0)
 S PSGLMT=^TMP("PSJPRO",$J,0),X=$P(XQORNOD(0),"=",2) D ENCHK^PSGON,OV
"RTN","PSIV",85,0)
 Q
"RTN","PSIV",86,0)
OV ;
"RTN","PSIV",87,0)
 I '$D(PSGODDD) S VALMBCK="R" Q
"RTN","PSIV",88,0)
 N DONE
"RTN","PSIV",89,0)
 F PSIVOV1=1:1:PSGODDD F PSIVOV2=1:1:$L(PSGODDD(PSIVOV1),",")-1 D
"RTN","PSIV",90,0)
 .;;S ON=+$P(PSGODDD(PSIVOV1),",",PSIVOV2),ON=$S($D(^TMP("PSIV",$J,"AB",ON)):^(ON),$D(^TMP("PSIV",$J,"PB",ON)):^(ON),$D(^TMP("PSIV",$J,"XB",ON)):^(ON),1:"") Q:'ON!$G(DONE)  D OV1
"RTN","PSIV",91,0)
 .S ON=+$P(PSGODDD(PSIVOV1),",",PSIVOV2)
"RTN","PSIV",92,0)
 .S ON=$S($D(^TMP("PSIV",$J,"AB",ON)):^(ON),$D(^TMP("PSIV",$J,"NB",ON)):^(ON),$D(^TMP("PSIV",$J,"PB",ON)):^(ON),$D(^TMP("PSIV",$J,"XB",ON)):^(ON),$D(^TMP("PSIV",$J,"NDB",ON)):^(ON),$D(^TMP("PSIV",$J,"PDB",ON)):^(ON),1:"")
"RTN","PSIV",93,0)
 .Q:'ON!$G(DONE)
"RTN","PSIV",94,0)
 .D OV1
"RTN","PSIV",95,0)
 S VALMBCK="Q"
"RTN","PSIV",96,0)
 Q
"RTN","PSIV",97,0)
OV1 ;
"RTN","PSIV",98,0)
 S (ON,ON55,P("PON"))=9999999999-ON_$S(ON["V":"V",1:"P")
"RTN","PSIV",99,0)
 I PSIVBR["D ^PSIVVW1" D
"RTN","PSIV",100,0)
 . S VALMSG="Select either ""AL"" , ""LL"" or ""AL,LL"" for both"
"RTN","PSIV",101,0)
 . S PSJORD=ON D EN^PSJLIPRF
"RTN","PSIV",102,0)
 E  D
"RTN","PSIV",103,0)
 . I PSIVBR="D ^PSIVOPT",'($$LS^PSSLOCK(PSGP,ON)) Q
"RTN","PSIV",104,0)
 . X PSIVBR
"RTN","PSIV",105,0)
 . D:PSIVBR="D ^PSIVOPT" UNL^PSSLOCK(PSGP,ON)
"RTN","PSIV",106,0)
 ;K:'$D(DUOUT) DONE
"RTN","PSIV",107,0)
 K:'$D(DUOUT)&($G(Y)'=-1) DONE
"RTN","PSIV",108,0)
 Q
"RTN","PSIV",109,0)
 ;
"RTN","PSIV",110,0)
 ;
"RTN","PSIV",111,0)
ENU ;Get IV additive strength. Called from templates.
"RTN","PSIV",112,0)
 N Y S Y=+^PS(55,DA(2),"IV",DA(1),"AD",DA,0),PSIVSTR=$$ENU^PSIVUTL(Y)
"RTN","PSIV",113,0)
 Q
"RTN","PSIV",114,0)
Q ;
"RTN","PSIV",115,0)
 K ^TMP("PSIV",$J),^TMP("PSJ",$J),^TMP("PSJPRO",$J),^TMP("PSJALL",$J),^TMP("PSJI",$J),^TMP("PSJON",$J)
"RTN","PSIV",116,0)
 K DRG,DRGI,DRGN,DRGT,ERR,I,JJ,MI,N,N2,ON,ON55,P,P1,P3,P16,P17,PNOW,PS,PSGODD,PSGODDD,PSIV,PSIVAAT,PSIVACT,PSIVADM,PSIVAT
"RTN","PSIV",117,0)
 K PSIVC,PSIVDT,PSIVFLAG,PSIVLN,PSIVNOW,PSIVNU,PSIVON,PSIVOV1,PSIVOV2,PSIVREA,PSIVSTR,PSIVSTRT,PSIVNOL,PSIVTYPE,PSJNKF
"RTN","PSIV",118,0)
 K PSJORF,PSJORIFN,RDWARD,START,STOP,SCHED,USER,V,XT
"RTN","PSIV",119,0)
 K %,%I,DIC,PSIVC,PSIVNU,PSIVON,PSIVREA,PSIVOV1,PSIVOV2,RDWARD,V,VAERR,VW,X,X2,Y,Y1,Z,Z1,Z2
"RTN","PSIV",120,0)
 ;D KVAR^VADPT ;ENKV^PSGSETU
"RTN","PSIV",121,0)
 Q
"RTN","PSIVACT")
0^58^B16249645
"RTN","PSIVACT",1,0)
PSIVACT ;BIR/PR,MLM-UPDATE ORDER STATUS AFTER PATIENT SELECTION ;16 Jul 98 / 12:51 PM
"RTN","PSIVACT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,38,58,110**;16 DEC 97
"RTN","PSIVACT",3,0)
 ;
"RTN","PSIVACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVACT",5,0)
 ;
"RTN","PSIVACT",6,0)
ENNA ; Inpatient entry point.
"RTN","PSIVACT",7,0)
 D:$D(XRTL) T0^%ZOSV
"RTN","PSIVACT",8,0)
 D NOW^%DTC S PSFDT=%,PS=0 D L D:'$G(PSIVRD) PEND
"RTN","PSIVACT",9,0)
 I $D(XRT0) S XRTN="PSIVACT" D T1^%ZOSV
"RTN","PSIVACT",10,0)
 Q
"RTN","PSIVACT",11,0)
 ;
"RTN","PSIVACT",12,0)
ENNB ; Ask profile type, gather orders.
"RTN","PSIVACT",13,0)
 D NOW^%DTC S PSFDT=%,PS=0 K ^TMP("PSIV",$J),^TMP("PSJPRO",$J)
"RTN","PSIVACT",14,0)
 S PSIVNV=$S(+PSJSYSU=1:"ANIV",+PSJSYSU=3:"APIV",1:"")
"RTN","PSIVACT",15,0)
 ;D @P("PT") D:PSIVNV]"" NVACT D:'$G(PSIVRD) PEND
"RTN","PSIVACT",16,0)
 D @P("PT") D:'$G(PSIVRD) PEND
"RTN","PSIVACT",17,0)
 I P("PT")="L",$D(XRT0) S XRTN="PSIVACT" D T1^%ZOSV
"RTN","PSIVACT",18,0)
 Q
"RTN","PSIVACT",19,0)
 ;
"RTN","PSIVACT",20,0)
L ; Long profile
"RTN","PSIVACT",21,0)
 S:'$D(PSJSYSU) PSJSYSU=""
"RTN","PSIVACT",22,0)
 F ON=0:0 K Y S ON=$O(^PS(55,DFN,"IV",+ON)) Q:'ON  D SETP
"RTN","PSIVACT",23,0)
 Q
"RTN","PSIVACT",24,0)
 ;
"RTN","PSIVACT",25,0)
S ; Short profile.
"RTN","PSIVACT",26,0)
 F PSIVDT=PSFDT:0 S PSIVDT=$O(^PS(55,DFN,"IV","AIS",PSIVDT)) Q:'PSIVDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",PSIVDT,+ON)) Q:'ON  S ON=ON_"V",P(17)=$P($G(^PS(55,DFN,"IV",+ON,0)),U,17) D ACTO
"RTN","PSIVACT",27,0)
 I +PSJSYSU=3 S PSIVNV="APIV" D NVACT K PSIVNV
"RTN","PSIVACT",28,0)
 Q
"RTN","PSIVACT",29,0)
 ;
"RTN","PSIVACT",30,0)
NVACT ; Non-verified but have active status
"RTN","PSIVACT",31,0)
 NEW ON
"RTN","PSIVACT",32,0)
 F ON=0:0 S ON=$O(^PS(55,PSIVNV,DFN,ON)) Q:'ON  D
"RTN","PSIVACT",33,0)
 . I $P($G(^PS(55,DFN,"IV",ON,0)),U,17)="E",($P($G(^(.2)),U,4)="D") S ^TMP("PSIV",$J,"A",9999999999-ON)=""
"RTN","PSIVACT",34,0)
 Q
"RTN","PSIVACT",35,0)
 ;
"RTN","PSIVACT",36,0)
PEND ; Get pending and non-verified orders from 53.1
"RTN","PSIVACT",37,0)
 N PSJCOM,PSJCOM1 S (PSJCOM,PSJCOM1)=0
"RTN","PSIVACT",38,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",DFN,ON)) Q:'ON  D  S PSJCOM1=PSJCOM
"RTN","PSIVACT",39,0)
 . NEW X S X=$P($G(^PS(53.1,ON,.2)),U,4),X=$S(X="S":1,X="A":2,X="R":3,X="P":4,1:5)
"RTN","PSIVACT",40,0)
 . S PSJCOM=$P($G(^PS(53.1,ON,.2)),U,8) I PSJCOM Q:'$$COMCHK^PSJO1(PSJCOM,2)  Q:PSJCOM=PSJCOM1
"RTN","PSIVACT",41,0)
 . I $G(^PS(53.1,ON,0)),$P(^PS(53.1,ON,0),U,4)'="U" S ^TMP("PSIV",$J,$S('PSJCOM:"P",1:"PD"),X_9999999999-ON)=""
"RTN","PSIVACT",42,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","N",DFN,ON)) Q:'ON  D  S PSJCOM1=PSJCOM
"RTN","PSIVACT",43,0)
 . NEW X S X=$P($G(^PS(53.1,ON,.2)),U,4),X=$S(X="S":1,X="A":2,X="R":3,X="P":4,1:5)
"RTN","PSIVACT",44,0)
 . S PSJCOM=$P($G(^PS(53.1,ON,.2)),U,8) I PSJCOM Q:'$$COMCHK^PSJO1(PSJCOM,2)  Q:PSJCOM=PSJCOM1
"RTN","PSIVACT",45,0)
 . I $G(^PS(53.1,ON,0)),$P(^PS(53.1,ON,0),U,4)'="U" S ^TMP("PSIV",$J,$S('PSJCOM:"N",1:"ND"),X_9999999999-ON)=""
"RTN","PSIVACT",46,0)
 .; S:$P(^PS(53.1,ON,0),U,4)'="U" ^TMP("PSIV",$J,"P",X_9999999999-ON)=""
"RTN","PSIVACT",47,0)
 ;
"RTN","PSIVACT",48,0)
QUIT ; Kill and exit.
"RTN","PSIVACT",49,0)
 K PSIVCWD,PSIVFLAG,PSIVWD,PSDFN,PSON1,PSFDT,YHOLD,JJ,XHOLD
"RTN","PSIVACT",50,0)
 Q
"RTN","PSIVACT",51,0)
 ;
"RTN","PSIVACT",52,0)
SETP ; Get partial P array,
"RTN","PSIVACT",53,0)
 S ON=ON_"V",Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,17,21 S P(X)=$P(Y,U,X)
"RTN","PSIVACT",54,0)
 S P(2)=+P(2),P(3)=+P(3) S Y(P(2))="",Y(P(3))=""
"RTN","PSIVACT",55,0)
 I P(2),P(3),P(17)'="P" D CHK
"RTN","PSIVACT",56,0)
 Q
"RTN","PSIVACT",57,0)
 ;
"RTN","PSIVACT",58,0)
CHK ; Check if order is active or expired and save accordingly.
"RTN","PSIVACT",59,0)
 S PS=PS+1 I P(17)="H" S ^TMP("PSIV",$J,"A",9999999999-ON)="" Q
"RTN","PSIVACT",60,0)
 I $O(Y(PSFDT))=P(3) D ACTO Q
"RTN","PSIVACT",61,0)
 I $O(Y(PSFDT))="" D NACTO Q
"RTN","PSIVACT",62,0)
 S:"ARO"[P(17) ^TMP("PSIV",$J,"A",9999999999-ON)="" S:"ED"[P(17) ^TMP("PSIV",$J,"X",9999999999-ON)="" S:"E"[P(17) PSIVREA="A",$P(^PS(55,DFN,"IV",+ON,0),U,17)="A",PS("A",9999999999-ON)=""
"RTN","PSIVACT",63,0)
 Q
"RTN","PSIVACT",64,0)
 ;
"RTN","PSIVACT",65,0)
ACTO ; Active orders
"RTN","PSIVACT",66,0)
 I "AE"[P(17) S ^TMP("PSIV",$J,"A",9999999999-ON)="" S:P(17)="E" $P(^PS(55,DFN,"IV",+ON,0),U,17)="A" Q
"RTN","PSIVACT",67,0)
 I "HOR"[P(17) S ^TMP("PSIV",$J,"A",9999999999-ON)="" Q
"RTN","PSIVACT",68,0)
 I "D"[P(17) S ^TMP("PSIV",$J,"X",9999999999-ON)=""
"RTN","PSIVACT",69,0)
 Q
"RTN","PSIVACT",70,0)
 ;
"RTN","PSIVACT",71,0)
NACTO ; Inactive orders
"RTN","PSIVACT",72,0)
 ;I "AER"[P(17) S ^TMP("PSIV",$J,"X",9999999999-ON)="" I "AR"[P(17) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE Q
"RTN","PSIVACT",73,0)
 I "AER"[P(17) D
"RTN","PSIVACT",74,0)
 . Q:$P(^PS(55,DFN,"IV",+ON,0),U,3)=""
"RTN","PSIVACT",75,0)
 . I +PSJSYSU=3,($P($G(^PS(55,DFN,"IV",+ON,.2)),U,4)="D"),'+$P($G(^(4)),U,4) S ^TMP("PSIV",$J,"A",9999999999-ON)="" Q
"RTN","PSIVACT",76,0)
 . S ^TMP("PSIV",$J,"X",9999999999-ON)=""
"RTN","PSIVACT",77,0)
 I "AR"[P(17) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE
"RTN","PSIVACT",78,0)
 I "OD"[P(17) S ^TMP("PSIV",$J,"X",9999999999-ON)=""
"RTN","PSIVACT",79,0)
 Q
"RTN","PSIVACT",80,0)
 ;
"RTN","PSIVACT",81,0)
DCOR ; Auto-cancel IV orders
"RTN","PSIVACT",82,0)
 ;NEED TO NEW VARIABLES LATER.
"RTN","PSIVACT",83,0)
 NEW DA,DIR,DG,ON,ON55,P,PSIVAC,PSIVACT,PSIVLN,PSIVREA,PSIVRES,PSGALO,PSGP,PSJDCDT,PSJIVDCF,PSJIVON,PSJIVORF,PSJORF,VA,VADM,VAERR
"RTN","PSIVACT",84,0)
 S PSGP=DFN,PSIVRES="Auto DC due to Surgery Package"
"RTN","PSIVACT",85,0)
 D NOW^%DTC S PSJDCDT=+%
"RTN","PSIVACT",86,0)
 D ENIV^PSJADT0
"RTN","PSIVACT",87,0)
 Q
"RTN","PSIVCAL")
0^56^B48439179
"RTN","PSIVCAL",1,0)
PSIVCAL ;BIR/RGY,PR-CALCULATES START AND STOP DATES ;12 Mar 99 / 12:42 PM
"RTN","PSIVCAL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,26,41,47,63,67,69,58,94,80,110**;16 DEC 97
"RTN","PSIVCAL",3,0)
 ;
"RTN","PSIVCAL",4,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVCAL",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVCAL",6,0)
 ; Reference to ^DD is supported by DBIA #10017.
"RTN","PSIVCAL",7,0)
 ; Reference to ^%DT is supported by DBIA #10003.
"RTN","PSIVCAL",8,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSIVCAL",9,0)
 ; Reference to ^XLFDT is supported by DBIA #10103.
"RTN","PSIVCAL",10,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVCAL",11,0)
 ;
"RTN","PSIVCAL",12,0)
ENT ;NEEDS PSIVTYPE (P(4))
"RTN","PSIVCAL",13,0)
 I $G(PSJREN) D  Q:P(2)
"RTN","PSIVCAL",14,0)
 . I $G(P("OLDON")) N P2 S P2=$G(@("^PS(55,"_DFN_",""IV"","_+P("OLDON")_",0)")),P2=$P(P2,"^",2) I P2 S P(2)=P2
"RTN","PSIVCAL",15,0)
 I $G(PSJORD)["P",$G(P("APPT"))?7N1"."1.N S START=$$DATE2^PSJUTL2(P("APPT")) G Q
"RTN","PSIVCAL",16,0)
 I $G(PSJSYSW0)=""!($P(PSJSYSW0,U,5)=2) S START=+$E(P("LOG"),1,12) G Q
"RTN","PSIVCAL",17,0)
 ;I $G(P("RES"))="R" N PSIVAC S PSIVAC="PR" D ENAD I PSIVADM S P(2)=PSIVADM Q
"RTN","PSIVCAL",18,0)
 S PSIVSN=+P("IVRM"),START="",PSIVTYPE=$G(P(4)) Q:PSIVTYPE=""
"RTN","PSIVCAL",19,0)
 N PSIV X $S($E(PSIVAC)="C":"S X=+$E(P(""LOG""),1,12) D H^%DTC S PSIV=%T",1:"S PSIV=$P($H,"","",2)") G T2:PSIVTYPE'["P"&('P(5))
"RTN","PSIVCAL",20,0)
 I P(11)']"" X $S($E(PSIVAC)="C":"S Y=+$E(P(""LOG""),1,12)",1:"D NOW^%DTC S Y=%") S Y=Y+.007\.01/100 S:'$P(Y,".",2) Y=$$MDNGHT(Y) X ^DD("DD") S START=Y G Q
"RTN","PSIVCAL",21,0)
 S X=P(11) D CHK S PX=Y,X1=PSIV\3600,X2=PSIV#3600\60,X=$E(".0",1,$L(X1)#2+1)_X1_$E("0",X2<10)_X2,START=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:"T")
"RTN","PSIVCAL",22,0)
 S X1=$P(PX,"-"),X1=$E(".0",1,$L(X1)#2+1)_X1,X2=$P(PX,"-",PSGCNT),X2=$E(".0",1,$L(X2)#2+1)_X2
"RTN","PSIVCAL",23,0)
 S NAT=+$P($G(^PS(59.6,+$O(^PS(59.6,"B",+VAIN(4),0)),0)),U,5)
"RTN","PSIVCAL",24,0)
 I '$D(PSGDT) S PSGDT=$$DATE^PSJUTL2()
"RTN","PSIVCAL",25,0)
 I X<X1,'NAT S START=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),PSGDT) G Q
"RTN","PSIVCAL",26,0)
 I X>X2 S START=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),PSGDT) G Q
"RTN","PSIVCAL",27,0)
T6 F I=2:1:PSGCNT S X1="."_$P(PX,"-",I-1),X2="."_$P(PX,"-",I) Q:+X1<X&(+X2>X)
"RTN","PSIVCAL",28,0)
 S X1=X-X1,X2=$S(NAT:0,1:X2-X),START=$S(X1<X2:$P(PX,"-",I-1),1:$P(PX,"-",I)) S:START="" START=$P(PX,"-") X $S($E(PSIVAC)="C":"S Y=$P(P(""LOG""),""."") X ^DD(""DD"") S PSIV=Y",1:"S PSIV=""TODAY""") S START=PSIV_"@"_$E("0",$L(START)=3)_START G Q
"RTN","PSIVCAL",29,0)
T2 S X=+("."_$E(10000+(PSIV\3600*100)+(PSIV#3600\60),2,5)),START=$O(^PS(59.5,PSIVSN,3,"AT",X)) S:'START START=$O(^(0)),PSIVTOM=1 I 'START S START=X K PSIVTOM
"RTN","PSIVCAL",30,0)
 S START=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:DT)_START I $D(PSIVTOM) S X1=$S($E(PSIVAC)="C":$P(P("LOG"),"."),1:DT),X2=1 D C^%DTC S Y=$P(X,".")_START K PSIVTOM
"RTN","PSIVCAL",31,0)
 S X=START,%DT="XRTX" D ^%DT
"RTN","PSIVCAL",32,0)
Q ;
"RTN","PSIVCAL",33,0)
 I START["@" S X=START,%DT="RTX" D ^%DT S START=+Y
"RTN","PSIVCAL",34,0)
 S P(2)=START
"RTN","PSIVCAL",35,0)
 I $G(PSJORD)["P" D:'$G(PSGRDTX(+PSJORD,"PSGSD")) REQDT^PSJLIVMD(PSJORD) S START=$G(PSGRDTX(+PSJORD,"PSGSD")) S P(2)=$S(START:START,1:P(2))
"RTN","PSIVCAL",36,0)
 K NAT,START,PSIVTYPE,PSIVSTRT,PSGCNT,X1,X2,PX
"RTN","PSIVCAL",37,0)
 Q
"RTN","PSIVCAL",38,0)
CHK F Y=1:1 Q:$L(X)>240!($P(X,"-",Y)="")  S $P(X,"-",Y)=$P(X,"-",Y)_$E("0000",1,4-$L($P(X,"-",Y)))
"RTN","PSIVCAL",39,0)
 S Y=X,PSGCNT=$L(X,"-") S:X]""&(PSGCNT<1) PSGCNT=1 Q
"RTN","PSIVCAL",40,0)
 ;
"RTN","PSIVCAL",41,0)
ENSTOP ; WILL CALCULATE STOP DATE FOR ORDER
"RTN","PSIVCAL",42,0)
 ;NEEDS (DFN) & ON
"RTN","PSIVCAL",43,0)
 N WALL,P3,ADX,DDLX,OIX,DRGT,PSIDAY S (WALL,P3,PSIDAY)=0
"RTN","PSIVCAL",44,0)
 D:'$G(PSIVSITE) ^PSIVSET  Q:'P(2)
"RTN","PSIVCAL",45,0)
 I P(23)'="" S PSIVTYPE="C"
"RTN","PSIVCAL",46,0)
 S STOP="",X="",PSIVSTRT=P(2),PSIVTYPE=$G(P(4)) I $G(PSJREN) D
"RTN","PSIVCAL",47,0)
 . N RDT I $G(ON)["P" S RDT=+$$LASTREN^PSJLMPRI(DFN,ON)
"RTN","PSIVCAL",48,0)
 . S PSIVSTRT=$$DATE2^PSJUTL2($S($G(RDT):RDT,1:$G(PSGDT)))
"RTN","PSIVCAL",49,0)
 I $S("^NOW^STAT^ONCE^ONE-TIME^ONE TIME^ONETIME^1TIME^1-TIME^1 TIME^"[(U_P(9)_U):1,1:0),PSIVTYPE="P"!P(5)!(P(23)="P") S X=$$ENOSD^PSJDCU(PSJSYSW0,PSIVSTRT,DFN) I X]"" S:P(11)=""&($G(ON)["P") PSIVCAL=1 G END
"RTN","PSIVCAL",50,0)
 N DUR,DURMIN I $G(PSJORD)["V" S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,"IV",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D  G END
"RTN","PSIVCAL",51,0)
 . S X=$$FMADD^XLFDT(PSIVSTRT,,,DURMIN)
"RTN","PSIVCAL",52,0)
 I $P(PSIVSITE,"^",5) D
"RTN","PSIVCAL",53,0)
 . N Z S Y=0
"RTN","PSIVCAL",54,0)
 . F  S Y=$O(^PS(55,DFN,"IV",Y)) Q:'Y  S Z=^(Y,0) D  Q:X]""
"RTN","PSIVCAL",55,0)
 .. I $P(Z,"^",17)="A",$$ONE^PSJBCMA(DFN,Y_"V",$P(Z,"^",9))'="O" S X=$P(Z,"^",3) Q
"RTN","PSIVCAL",56,0)
 S:X WALL=X
"RTN","PSIVCAL",57,0)
 S PSIDAY=$S(PSIVTYPE="A":$P(PSIVSITE,"^",4),PSIVTYPE="H":$P(PSIVSITE,"^",17),PSIVTYPE="P":$P(PSIVSITE,"^",18),PSIVTYPE="S":$P(PSIVSITE,"^",20),1:$P(PSIVSITE,"^",21))
"RTN","PSIVCAL",58,0)
 S PSJDAY="" D  I PSJDAY]"" S PSIDAY=PSJDAY G TIME
"RTN","PSIVCAL",59,0)
 . N A,B
"RTN","PSIVCAL",60,0)
 . Q:'$D(PSJORD)  S A=""
"RTN","PSIVCAL",61,0)
 . I PSJORD["P" S A=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSIVCAL",62,0)
 . I PSJORD["U" S A=$G(^PS(55,PSGP,5,+PSJORD,8))
"RTN","PSIVCAL",63,0)
 . I PSJORD["I" S A=$G(^PS(55,PSGP,"IV",+PSJORD,"DSS"))
"RTN","PSIVCAL",64,0)
 . S A=$P(A,"^") I A]"" S PSJDAY=14 I $D(^PS(53.46,"B",A)) S B=$O(^PS(53.46,"B",A,"")),PSJDAY=$P(^PS(53.46,B,0),"^",2) I PSJDAY="" S PSJDAY=14
"RTN","PSIVCAL",65,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  I $P(^PS(52.6,+$P(DRG("AD",+X),U),0),"^",4),($P(^(0),"^",4))<+PSIDAY S PSIDAY=$P(^(0),"^",4)
"RTN","PSIVCAL",66,0)
 I WALL,($$FMADD^XLFDT(PSIVSTRT,PSIDAY,"D"))>WALL S PSIDAY=$$FMDIFF^XLFDT(WALL,PSIVSTRT,1) S:PSIDAY<1 PSIDAY=""
"RTN","PSIVCAL",67,0)
 S DRGT=$S($D(DRG("AD")):"AD",1:"SOL") F ADX=0:0 S ADX=$O(DRG(DRGT,ADX)) Q:'ADX!($G(DRGTMP)&($G(DRGTN)["AD")&(DRGT="SOL"))  D
"RTN","PSIVCAL",68,0)
 . I DRGT="AD",+$P(^PS(52.6,$P(DRG(DRGT,+ADX),U),0),"^",4),(+$P(^(0),"^",4))<+Y S Y=$P(^(0),"^",4)
"RTN","PSIVCAL",69,0)
 . S OIX=+$P(DRG(DRGT,ADX),"^",6),DDLX=$P(^PS(50.7,OIX,0),"^",5) Q:'DDLX  D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",70,0)
 I '$G(DRG("AD",0)),$G(DRGTMP),($G(DRGTN)["SOL") S OIX=$P($G(DRGTMP),"^",6) I OIX S DDLX=$P(^PS(50.7,OIX,0),"^",5) I DDLX  D DDLIM(.PSIDAY,.P3)
"RTN","PSIVCAL",71,0)
 I $G(P3),$G(P(2)) I P3>P(2) S X=P3 G END
"RTN","PSIVCAL",72,0)
 S:'PSIDAY PSIDAY=1
"RTN","PSIVCAL",73,0)
TIME S X2=PSIDAY,X1=PSIVSTRT D C^%DTC S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVCAL",74,0)
END ;
"RTN","PSIVCAL",75,0)
 S P(3)=+X
"RTN","PSIVCAL",76,0)
 I $G(PSJORD)["P" D:'$G(PSGRDTX(+PSJORD,"PSGFD")) REQDT^PSJLIVMD(PSJORD) S P(3)=$S($G(PSGRDTX(+PSJORD,"PSGFD")):PSGRDTX(+PSJORD,"PSGFD"),1:P(3))
"RTN","PSIVCAL",77,0)
 S P(3)=$$DATE2^PSJUTL2(P(3)),P(2)=$$DATE2^PSJUTL2(P(2))
"RTN","PSIVCAL",78,0)
 Q
"RTN","PSIVCAL",79,0)
 ;
"RTN","PSIVCAL",80,0)
ENAD ;Will get last admin. time for order (needs dfn and on)
"RTN","PSIVCAL",81,0)
 N P4,PSIVX,PSIVY
"RTN","PSIVCAL",82,0)
 I $P(PSJSYSW0,U,5)=2 S PSIVADM=$$DATE^PSJUTL2() Q
"RTN","PSIVCAL",83,0)
 I $S($G(PSIVAC)["R":1,P(9)="QOD":1,1:P(9)?1"Q".N1"D") S PSIVADM=$$ENSD^PSGNE3(P(9),P(11),+$E(P("LOG"),1,12),+$P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,2)) Q:PSIVADM
"RTN","PSIVCAL",84,0)
 S PSIVX=X,PSIVY=Y,P4=P(4) S:P(4)="C" P4=P(23) S:P4="S" P4=$S(P(5):"P",1:"A") D NOW^%DTC S Y=%,PSIVNOW=Y I (P4="P"&(P(11)="")&'P(15))!("HA"[P4&'P(15)) S Y=Y+.007\.01/100 G QAD
"RTN","PSIVCAL",85,0)
 D P:P4="P"&('P(15)),AH:P(15)
"RTN","PSIVCAL",86,0)
QAD ;
"RTN","PSIVCAL",87,0)
 S:'$D(PSGSA) PSGSA=""
"RTN","PSIVCAL",88,0)
 S PSIVSD=Y I Y S OD=$L(PSGSA," ") I OD>2 S X=+PSGSA\1 F OD1=2:1:OD-1 I $P(PSGSA," ",OD1)'>$S(OD1>2:$P(PSGSA," ",OD1-1),1:PSGSA#1) S X1=X,X2=1 D C^%DTC
"RTN","PSIVCAL",89,0)
 I PSIVSD,OD>2 S Y=X_PSIVSD
"RTN","PSIVCAL",90,0)
 S PSIVADM=+Y,X=PSIVX,Y=PSIVY K PSGSA,PSIVSD,OD,OD1,PSIVMI,PSIVNOW S:PSIVADM<P(2) PSIVADM=P(2) Q
"RTN","PSIVCAL",91,0)
 ;
"RTN","PSIVCAL",92,0)
P S CD=PSIVNOW,PSGSA="",(PSIVSD,OD)=DT_.0001,X=P(11) D CHK S P(11)=X D ENP4^PSIVWL
"RTN","PSIVCAL",93,0)
 I PSGSA="" S PSIVSD=DT_.0001,PSIVMIN=-1440 D ENT^PSIVWL S $P(Y,".",2)=$P(P(11),"-",$L(P(11),"-")) Q
"RTN","PSIVCAL",94,0)
 S Y=$P(PSGSA," ",$L(PSGSA," ")-1) Q
"RTN","PSIVCAL",95,0)
AH F PSIVADM=0:-1 S CD=PSIVNOW,(X,X1)=DT,X2=PSIVADM D:X2 C^%DTC S X=$P(X,".") S (OD1,PSIVSD,OD)=X_.0001,PSIVMIN=P(15) D ENP3^PSIVWL Q:PSIVADM<-4!(PSGSA]"")
"RTN","PSIVCAL",96,0)
 S Y=$P(PSGSA," ",$L(PSGSA," ")-1) Q
"RTN","PSIVCAL",97,0)
MDNGHT(Y)          ;Sets Start Date/Time on orders placed between midnight and 12:30
"RTN","PSIVCAL",98,0)
 S Y=$$FMADD^XLFDT(Y,-1,0,0,0),Y=$P(Y,".")_".24" Q Y
"RTN","PSIVCAL",99,0)
 ;
"RTN","PSIVCAL",100,0)
DDLIM(PSIVDUR,STPDT) ;  
"RTN","PSIVCAL",101,0)
 N P3
"RTN","PSIVCAL",102,0)
 I DDLX["D" D  Q:(STPDT=0)
"RTN","PSIVCAL",103,0)
 . I +DDLX'<+PSIVDUR S STPDT=0 Q
"RTN","PSIVCAL",104,0)
 . S PSIVDUR=+DDLX,X2=PSIVDUR,X1=PSIVSTRT D C^%DTC S X=$P(X,"."),X=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14)) I X>P(2) S P(3)=X
"RTN","PSIVCAL",105,0)
 I DDLX["L",($G(P(9))]""),$G(P(15)),("AH"'[PSIVTYPE) D
"RTN","PSIVCAL",106,0)
 . Q:'$G(P(2))!'$G(OIX)  N FIRST,DOSAR,LAST,NEWDUR
"RTN","PSIVCAL",107,0)
 . S STRING=P(2)_"^"_$S($G(STPDT):STPDT,1:$$FMADD^XLFDT(PSGDT,30))_"^"_P(9)_"^C^"_OIX S FIRST=$$ENQ^PSJORP2(DFN,STRING)
"RTN","PSIVCAL",108,0)
 . S FIRST=$S($G(FIRST):FIRST,1:P(2)) Q:'FIRST  S DSTMP=FIRST,DOSAR(1)=DSTMP F I=2:1:DDLX+1 S DOSAR(I)=$$FMADD^XLFDT(DSTMP,,,P(15)),DSTMP=DOSAR(I)
"RTN","PSIVCAL",109,0)
 . I $D(DOSAR) S LAST=$O(DOSAR(""),-1) I LAST S LAST=DOSAR(LAST) I LAST>P(2) S NEWDUR=$$FMDIFF^XLFDT(LAST,P(2)) I NEWDUR<PSIVDUR S P(3)=LAST
"RTN","PSIVCAL",110,0)
 S P(3)=$$DATE2^PSJUTL2(P(3)),P(2)=$$DATE2^PSJUTL2(P(2)) S STPDT=P(3)
"RTN","PSIVCAL",111,0)
 Q
"RTN","PSIVEDT")
0^113^B37448024
"RTN","PSIVEDT",1,0)
PSIVEDT ;BIR/MLM-EDIT IV ORDER ;10 Feb 98 / 3:23 PM
"RTN","PSIVEDT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,110**;16 DEC 97
"RTN","PSIVEDT",3,0)
 ;
"RTN","PSIVEDT",4,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVEDT",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVEDT",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVEDT",7,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVEDT",8,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVEDT",9,0)
 ;
"RTN","PSIVEDT",10,0)
EDIT ;
"RTN","PSIVEDT",11,0)
 I $G(PSGP),$G(PSJORD)["V" I $$COMPLEX^PSJOE(PSGP,PSJORD) D
"RTN","PSIVEDT",12,0)
 . N X,Y,PARENT,P2ND S P2ND=$G(^PS(55,PSGP,"IV",+PSJORD,.2)),PARENT=$P(P2ND,"^",8)
"RTN","PSIVEDT",13,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSJORD)
"RTN","PSIVEDT",14,0)
 S DONE=0
"RTN","PSIVEDT",15,0)
 F PSIVE=1:1 S:DONE&$E(PSIVAC)="C" OREND=1 Q:PSIVE>$L(EDIT,U)!(DONE)  Q:'$L($P(EDIT,U,PSIVE))  D @($P(EDIT,U,PSIVE)) S:$E(PSIVAC,2)="N" PSIVOK=PSIVOK_U_$P(EDIT,U,PSIVE) I $E(X)=U,$L(X)>1 S:PSIVE>1 PSIVE=PSIVE-1 F  D FF Q:Y<0  D @Y Q:$E(X)'=U
"RTN","PSIVEDT",16,0)
 K EDIT,PSIVOK,PSGDI
"RTN","PSIVEDT",17,0)
 Q
"RTN","PSIVEDT",18,0)
 ;
"RTN","PSIVEDT",19,0)
1 ; Provider.
"RTN","PSIVEDT",20,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",21,0)
 . W !!?5,"This is Renewal order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",22,0)
 I $G(PSJCOM),$G(ON)'["P" D  Q
"RTN","PSIVEDT",23,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",24,0)
 S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",25,0)
 W !,"PROVIDER: "_$S($P(P(6),U,2)]"":$P(P(6),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P(6)) Q
"RTN","PSIVEDT",26,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 1
"RTN","PSIVEDT",27,0)
 I X]"" K DIC S DIC=200,DIC(0)="EQMZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),U,4):1,$P(^(""PS""),U,4)>DT:1,1:0)" D ^DIC K DIC I Y>0 S P(6)=+Y_U_Y(0,0) Q
"RTN","PSIVEDT",28,0)
 S F1=53.1,F2=1 D ENHLP^PSIVORC1 W $C(7),!!,"A Provider must be entered.",!! G 1
"RTN","PSIVEDT",29,0)
 Q
"RTN","PSIVEDT",30,0)
 ;
"RTN","PSIVEDT",31,0)
3 ; Med Route.
"RTN","PSIVEDT",32,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",33,0)
 . W !!?5,"Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",34,0)
 I $G(PSJCOM),$G(ON)'["P" D  Q
"RTN","PSIVEDT",35,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Med Route may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",36,0)
 S P(6)=$S('$G(^VA(200,+P(6),"PS")):"",'$P(^("PS"),U,4):P(6),$P(^("PS"),U,4)<DT:"",1:P(6))
"RTN","PSIVEDT",37,0)
 I P("MR")="" S X=$O(^PS(51.2,"B","INTRAVENOUS",0)) I $P($G(^PS(51.2,+X,0)),U,4) S P("MR")=+X_U_$P(^(0),U,3)
"RTN","PSIVEDT",38,0)
 W !,"MED ROUTE: "_$S($P(P("MR"),U,2)]"":$P(P("MR"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I X=U!(X=""&P("MR"))!($E(X)=U) Q
"RTN","PSIVEDT",39,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS^PSIVEDT1 G 3
"RTN","PSIVEDT",40,0)
 I X]"" K DIC S DIC=51.2,DIC(0)="EQMZ",DIC("S")="I $P(^(0),U,4)" D ^DIC K DIC I Y>0 S P("MR")=+Y_U_$P(Y(0),U,3) Q
"RTN","PSIVEDT",41,0)
 S F1=53.1,F2=3 D ENHLP^PSIVORC1 W $C(7),!!,"A Med Route must be entered." G 3
"RTN","PSIVEDT",42,0)
 Q
"RTN","PSIVEDT",43,0)
 ;
"RTN","PSIVEDT",44,0)
10 ; Start Date.
"RTN","PSIVEDT",45,0)
 D 10^PSIVEDT1
"RTN","PSIVEDT",46,0)
 Q
"RTN","PSIVEDT",47,0)
 ;
"RTN","PSIVEDT",48,0)
25 ; Stop Date.
"RTN","PSIVEDT",49,0)
 D 25^PSIVEDT1
"RTN","PSIVEDT",50,0)
 Q
"RTN","PSIVEDT",51,0)
26 ; Schedule
"RTN","PSIVEDT",52,0)
 D 26^PSIVEDT1
"RTN","PSIVEDT",53,0)
 Q
"RTN","PSIVEDT",54,0)
 ;
"RTN","PSIVEDT",55,0)
39 ; Admin Times.
"RTN","PSIVEDT",56,0)
 D 39^PSIVEDT1
"RTN","PSIVEDT",57,0)
 Q
"RTN","PSIVEDT",58,0)
 ;
"RTN","PSIVEDT",59,0)
57 ; Additive.
"RTN","PSIVEDT",60,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",61,0)
 . W !!?5,"Additive may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",62,0)
 I $G(PSJCOM),$G(ON)'["P" D  Q
"RTN","PSIVEDT",63,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Provider may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",64,0)
 I $E(PSIVAC)="O" W !!,"Only additives marked for use in IV Fluid Order Entry may be selected."
"RTN","PSIVEDT",65,0)
 S FIL=52.6,DRGT="AD",DRGTN="ADDITIVE" D DRG^PSIVEDRG,DKILL
"RTN","PSIVEDT",66,0)
 Q
"RTN","PSIVEDT",67,0)
 ;
"RTN","PSIVEDT",68,0)
58 ; Solution.
"RTN","PSIVEDT",69,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",70,0)
 . W !!?5,"Solution may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",71,0)
 S FIL=52.7,DRGT="SOL",DRGTN="SOLUTION" D DRG^PSIVEDRG
"RTN","PSIVEDT",72,0)
 ;
"RTN","PSIVEDT",73,0)
DKILL ; Kill for drug edit.
"RTN","PSIVEDT",74,0)
 K DRGI,DRGN,DRGT,DRGTN,FIL,PSIVSTR
"RTN","PSIVEDT",75,0)
 Q
"RTN","PSIVEDT",76,0)
 ;
"RTN","PSIVEDT",77,0)
59 ; Infusion Rate.
"RTN","PSIVEDT",78,0)
 D 59^PSIVEDT1
"RTN","PSIVEDT",79,0)
 Q
"RTN","PSIVEDT",80,0)
 ;
"RTN","PSIVEDT",81,0)
62 ; IV Room.
"RTN","PSIVEDT",82,0)
 N DIR S DIR(0)="PA^59.5",DIR("A")="IV Room: ",DIR("??")="^S F1=59.5,F2=.01 D ENHLP^PSIVORC1" S:P("IVRM") DIR("B")=$P(P("IVRM"),U,2)
"RTN","PSIVEDT",83,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 S P("IVRM")=Y W $P($P(Y,U,2),X,2)
"RTN","PSIVEDT",84,0)
 Q
"RTN","PSIVEDT",85,0)
 ;
"RTN","PSIVEDT",86,0)
63 ; Remarks.
"RTN","PSIVEDT",87,0)
 D 63^PSIVEDT1
"RTN","PSIVEDT",88,0)
 Q
"RTN","PSIVEDT",89,0)
 ;
"RTN","PSIVEDT",90,0)
64 ; Other Print Info.
"RTN","PSIVEDT",91,0)
 D 64^PSIVEDT1
"RTN","PSIVEDT",92,0)
 Q
"RTN","PSIVEDT",93,0)
 ;
"RTN","PSIVEDT",94,0)
66 ; Provider's comments.
"RTN","PSIVEDT",95,0)
 N DA,DIE,DIR S DA=PSIVUP,DIE="^PS(53.45,",DR=4 D ^DIE S PSGSI=X,Y=1
"RTN","PSIVEDT",96,0)
 Q
"RTN","PSIVEDT",97,0)
 ;
"RTN","PSIVEDT",98,0)
101 ; Orderable Item.
"RTN","PSIVEDT",99,0)
 I $G(P("RES"))="R" I $G(PSJORD)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT",100,0)
 . W !!?5,"This is Renewal order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",101,0)
 I $G(PSJCOM),$G(ON)'["P" D  Q
"RTN","PSIVEDT",102,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Orderable Item may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT",103,0)
 W !,"Orderable Item: "_$S(P("PD"):$P(P("PD"),U,2)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X=""&P("PD")) Q
"RTN","PSIVEDT",104,0)
 I X]"" N DIC S DIC="^PS(50.7,",DIC(0)="EMQZ",DIC("B")=$S(P("PD")]"":+$P(("PD"),U),1:""),DIC("S")="S PSJSCT=1 I $$DRGSC^PSIVUTL(Y,PSJSCT) K PSJSCT" D ^DIC K DIC I Y>0 S P("PD")=Y Q
"RTN","PSIVEDT",105,0)
 W $C(7),!!,"Orderable Item is required!",!! G 101
"RTN","PSIVEDT",106,0)
 Q
"RTN","PSIVEDT",107,0)
109 ; Dosage Ordered.
"RTN","PSIVEDT",108,0)
 W !,"DOSAGE ORDERED: "_$S(P("DO")]"":P("DO")_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P("DO")]""&(X="")) Q
"RTN","PSIVEDT",109,0)
 I X="???" D ORFLDS^PSIVEDT1 G 109
"RTN","PSIVEDT",110,0)
 D:X]"" CHK^DIE(53.1,109,"",X,.X) I $G(X)="^" W $C(7),!!,"Enter the dosage in which the Orderable Item entered should be dispensed.",! W "Answer must be 1-20 characters in length." G 109
"RTN","PSIVEDT",111,0)
 S P("DO")=X
"RTN","PSIVEDT",112,0)
 Q
"RTN","PSIVEDT",113,0)
 ;
"RTN","PSIVEDT",114,0)
FF ; up-arrow to another field.
"RTN","PSIVEDT",115,0)
 N DIC S X=$P(X,U,2),DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I U_PSIVOK_U[(U_+Y_U)" D ^DIC K DIC S Y=+Y
"RTN","PSIVEDT",116,0)
 Q
"RTN","PSIVEDT",117,0)
 ;
"RTN","PSIVEDT",118,0)
NEWDRG ; Ask if adding a new drug.
"RTN","PSIVEDT",119,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you adding "_$P(TDRG,U,2)_" as a new "_$S(DRGT="AD":"additive",1:"solution")_" for this order",DIR("B")="NO" D ^DIR I $D(DTOUT)!$D(DUOUT) Q
"RTN","PSIVEDT",120,0)
 I Y S (DRGI,DRG(DRGT,0))=DRG(DRGT,0)+1,DRG=TDRG,DRG(DRGT,+DRGI)=+DRG_U_$P(DRG,U,2) I DRGT="SOL" S X=$G(^PS(52.7,+DRG,0)),$P(DRG(DRGT,DRG),U,3)=$P(X,U,3)
"RTN","PSIVEDT",121,0)
 Q
"RTN","PSIVEDT1")
0^114^B27610242
"RTN","PSIVEDT1",1,0)
PSIVEDT1 ;BIR/MLM-EDIT IV ORDER (CONT) ;10 Mar 98 / 2:36 PM
"RTN","PSIVEDT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,7,41,47,50,64,58,116,110**;16 DEC 97
"RTN","PSIVEDT1",3,0)
 ;
"RTN","PSIVEDT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVEDT1",5,0)
 ; Reference to ^DD is supported by DBIA# 10017.
"RTN","PSIVEDT1",6,0)
 ; Reference to ^%DT is supported by DBIA# 10003.
"RTN","PSIVEDT1",7,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSIVEDT1",8,0)
 ; Reference to ^DIE is supported by DBIA# 2053.
"RTN","PSIVEDT1",9,0)
 ; Reference to ^DIR is supported by DBIA# 10026.
"RTN","PSIVEDT1",10,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116.
"RTN","PSIVEDT1",11,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSIVEDT1",12,0)
 ;
"RTN","PSIVEDT1",13,0)
10 ; Start Date
"RTN","PSIVEDT1",14,0)
 D:'P(2)&P("IVRM")!($G(PSJREN)) ENT^PSIVCAL
"RTN","PSIVEDT1",15,0)
A10 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",16,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",17,0)
 I $G(PSJCOM),$G(ON)'["P" D  Q
"RTN","PSIVEDT1",18,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Start Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",19,0)
 S Y=P(2) X ^DD("DD") W !,"START DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(P(2)&X="") Q
"RTN","PSIVEDT1",20,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 10
"RTN","PSIVEDT1",21,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S F1=53.1,F2=10 S:X="@" X="?" D ENHLP^PSIVORC1 G A10
"RTN","PSIVEDT1",22,0)
 K %DT S:X="" X=P(2) S %DT="ERTX" D ^%DT K %DT G:Y'>0 A10
"RTN","PSIVEDT1",23,0)
 I $G(P("RES"))="R",(+Y<+$P($G(^PS(55,DFN,"IV",+$G(P("OLDON")),0)),U,2)) D  G 10
"RTN","PSIVEDT1",24,0)
 .; naked ref below refers to line above
"RTN","PSIVEDT1",25,0)
 .S Y=$P(^(0),U,2) X ^DD("DD") W $C(7),!!,"Start date of order being renewed is ",Y,".",!,"Start date of renewal order must be AFTER start date of order being renewed.",!
"RTN","PSIVEDT1",26,0)
 S X1=$G(P("LOG")),X2=-7 D C^%DTC I +Y<X W !!,"Start date/time may not be entered prior to 7 days from the order's LOGIN DATE.",! D A10
"RTN","PSIVEDT1",27,0)
 S P(2)=+Y,PSGSDX=1
"RTN","PSIVEDT1",28,0)
 Q
"RTN","PSIVEDT1",29,0)
 ;
"RTN","PSIVEDT1",30,0)
25 ; Stop Date
"RTN","PSIVEDT1",31,0)
 G:$D(PSGFDX) A25
"RTN","PSIVEDT1",32,0)
 I P("IVRM")]"",$S(P(3)<P(2):1,$G(PSIVAC)["E":0,1:1) S PSIVSITE=$G(^PS(59.5,+P("IVRM"),1)),$P(PSIVSITE,"^",20,21)=$G(^PS(59.5,+P("IVRM"),5)) D ENSTOP^PSIVCAL
"RTN","PSIVEDT1",33,0)
A25 I $G(PSJCOM),$G(ON)'["P" D  Q
"RTN","PSIVEDT1",34,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Stop Date may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",35,0)
 S Y=P(3) X ^DD("DD") W !,"STOP DATE/TIME: "_$S(Y]"":Y_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 Q:X=""&P(2)  I $E(X)=U!(X=""&P(2)) Q
"RTN","PSIVEDT1",36,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 25
"RTN","PSIVEDT1",37,0)
 I X="@"!(X["?") W $C(7),"  (Required)" S F1=53.1,F2=25,X="?" D ENHLP^PSIVORC1 G A25
"RTN","PSIVEDT1",38,0)
 K %DT S:X="" X=P(3) S %DT="ERTX" D:X'=+X ^%DT
"RTN","PSIVEDT1",39,0)
 I X=+X,X>0,X'>2000000 G A25:'$$ENDL^PSGDL(P(9),X) D ENDL^PSIVSP
"RTN","PSIVEDT1",40,0)
 S X=Y S:Y<1!Y'["." X="" G:Y'>0 A25 S P(3)=+Y,PSGFDX=1
"RTN","PSIVEDT1",41,0)
 Q
"RTN","PSIVEDT1",42,0)
26 ; Schedule
"RTN","PSIVEDT1",43,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",44,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",45,0)
 I $G(PSJCOM),$G(ON)'["P" D  Q
"RTN","PSIVEDT1",46,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Schedule may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",47,0)
 W !,"SCHEDULE: ",$S(P(9)]"":P(9)_"// ",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X="") Q
"RTN","PSIVEDT1",48,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(9)="" G 26
"RTN","PSIVEDT1",49,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 26
"RTN","PSIVEDT1",50,0)
 ;/I X?1."?"!($L(X)>22)!($L(X," ")>2) S F1=55.01,F2=.09 D ENHLP^PSIVORC1 G 26
"RTN","PSIVEDT1",51,0)
 I X?1."?"!($L(X)>22)!($L(X," ")>3) S F1=55.01,F2=.09 D ENHLP^PSIVORC1 G 26
"RTN","PSIVEDT1",52,0)
 S P(7)="" N PSGOES K PSGOES D EN^PSIVSP S:XT<0 X="" I $G(X)="" W $C(7),"??" G 26
"RTN","PSIVEDT1",53,0)
 S P(9)=X,P(11)=Y,P(15)=XT
"RTN","PSIVEDT1",54,0)
 Q
"RTN","PSIVEDT1",55,0)
 ;
"RTN","PSIVEDT1",56,0)
39 ; Admin Times
"RTN","PSIVEDT1",57,0)
 I $G(P("RES"))="R" I $G(ON)["P",($P($G(^PS(53.1,+ON,0)),"^",24)="R") D  Q
"RTN","PSIVEDT1",58,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Administration times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",59,0)
 I $G(PSJCOM),$G(ON)'["P" D  Q
"RTN","PSIVEDT1",60,0)
 .Q:$G(PSJBKDR)  W !!?5,"This is a Complex Order. Admin Times may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",61,0)
 W !,"ADMINISTRATION TIMES: ",$S(P(11)]"":P(11)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $E(X)=U!(X="") Q
"RTN","PSIVEDT1",62,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(11)="" G 39
"RTN","PSIVEDT1",63,0)
 I X["?" S F1=55.01,F2=.12 D ENHLP^PSIVORC1 G 39
"RTN","PSIVEDT1",64,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 39
"RTN","PSIVEDT1",65,0)
 K:X[""""!($A(X)=45) X D:$D(X) CHK^DIE(51.1,1,"",X,.X) W:$G(X)="^"!('$D(X)) $C(7),"  ??" G:$G(X)="^"!('$D(X)) 39 S P(11)=X D:$G(PSIVCAL) ENT^PSIVCAL,ENSTOP^PSIVCAL K PSIVCAL
"RTN","PSIVEDT1",66,0)
 Q
"RTN","PSIVEDT1",67,0)
 ;
"RTN","PSIVEDT1",68,0)
59 ; Infusion Rate
"RTN","PSIVEDT1",69,0)
 I $G(P("RES"))="R" I $G(ON)["P",$P($G(^PS(53.1,+ON,0)),"^",24)="R" D  Q
"RTN","PSIVEDT1",70,0)
 . Q:'$G(PSIVRENW)  W !!?5,"This is a Renewal Order. Infusion Rate may not be edited at this point." D PAUSE^VALM1
"RTN","PSIVEDT1",71,0)
 W !,"INFUSION RATE: ",$S(P(8)]"":P(8)_"//",1:"") R X:DTIME S:'$T X=U S:X=U DONE=1 I $S($E(X)=U:1,X]"":0,1:P(8)]"") Q
"RTN","PSIVEDT1",72,0)
 I X=""&(("C^P"[P(4))!(("C^S"[P(4))&(P(5)=1))) Q
"RTN","PSIVEDT1",73,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P(8)="" G 59
"RTN","PSIVEDT1",74,0)
 I X["???",($E(P("OT"))="I"),(PSIVAC["C") D ORFLDS G 59
"RTN","PSIVEDT1",75,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVEDT1",76,0)
 I X]"" D ENI^PSIVSP W:'$D(X) $C(7)," ??" G:'$D(X) 59 S P(8)=X
"RTN","PSIVEDT1",77,0)
 I P(8)="" W $C(7),!!,"An infusion rate must be entered!" G 59
"RTN","PSIVEDT1",78,0)
 Q
"RTN","PSIVEDT1",79,0)
 ;
"RTN","PSIVEDT1",80,0)
63 ; Remarks
"RTN","PSIVEDT1",81,0)
 N DIR S X="",DIR(0)="53.1,63" S:P("REM")]"" DIR("B")=P("REM") D ^DIR I X="^"!$D(DTOUT) S DONE=1 Q
"RTN","PSIVEDT1",82,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("REM")="" G 63
"RTN","PSIVEDT1",83,0)
 I X]"",$E(X)'="^" S P("REM")=X
"RTN","PSIVEDT1",84,0)
 Q
"RTN","PSIVEDT1",85,0)
 ;
"RTN","PSIVEDT1",86,0)
64 ; Other Print Info
"RTN","PSIVEDT1",87,0)
 N DIR S X="",DIR(0)="53.1,64" S:P("OPI")]"" DIR("B")=$P(P("OPI"),"^") D ^DIR I X="^"!$D(DTOUT) S DONE=1 Q
"RTN","PSIVEDT1",88,0)
 I X="@" D DEL^PSIVEDRG S:%=1 P("OPI")="" G 64
"RTN","PSIVEDT1",89,0)
 I X]"",$E(X)'="^" S P("OPI")=X,P("OPI")=$$ENBCMA^PSJUTL("V")
"RTN","PSIVEDT1",90,0)
 Q
"RTN","PSIVEDT1",91,0)
 ;
"RTN","PSIVEDT1",92,0)
ORFLDS ; Display OE/RR fields during edit.
"RTN","PSIVEDT1",93,0)
 D FULL^VALM1
"RTN","PSIVEDT1",94,0)
 W !!,"Orderable Item: ",$P(P("PD"),U,2),!,"Give: ",$P(P("MR"),U,2)," ",P(9),!!
"RTN","PSIVEDT1",95,0)
 Q
"RTN","PSIVOD")
0^119^B10484412
"RTN","PSIVOD",1,0)
PSIVOD ;BIR/JCH-CREATE NEW IV ORDER FROM OLD ONE ;25 Nov 98 / 3:34 PM
"RTN","PSIVOD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSIVOD",3,0)
 ;
"RTN","PSIVOD",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVOD",5,0)
 ; Reference to ^ORX2 is supported by DBIA 867.
"RTN","PSIVOD",6,0)
 ;
"RTN","PSIVOD",7,0)
COPY(DFN,OLDON) ;Ask to enter new order.
"RTN","PSIVOD",8,0)
 N OLDP,PSIVCOPY,PSGCOPY M OLDP=P
"RTN","PSIVOD",9,0)
 Q:'$$HIDDEN^PSJLMUTL("COPY")  D ^PSJHVARS
"RTN","PSIVOD",10,0)
 I $P($G(^PS(55,PSGP,"IV",+PSGORD,.2)),U,4)="D",'$P($G(^(4)),"^",3) D  G Q
"RTN","PSIVOD",11,0)
 .W !!,"Nurse verified orders with a priority of DONE may not be Copied." D PAUSE^VALM1 Q
"RTN","PSIVOD",12,0)
 S PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU
"RTN","PSIVOD",13,0)
 D FULL^VALM1
"RTN","PSIVOD",14,0)
 F  W !!,"Do you want to copy this order" S %=2 D YN^DICN Q:%  D CH
"RTN","PSIVOD",15,0)
 G:%'=1 Q
"RTN","PSIVOD",16,0)
 W !!,"...copying..."
"RTN","PSIVOD",17,0)
 N PSGORD,ON,ON55,PSJORD D NEW55^PSIVORFB S ON=ON55
"RTN","PSIVOD",18,0)
 NEW X S X=DFN_";DPT(" D LK^ORX2 Q:'Y  S PSJLSORX=1
"RTN","PSIVOD",19,0)
INMED ;
"RTN","PSIVOD",20,0)
 S:'$G(PSGDT) PSGDT=$$DATE^PSJUTL2()
"RTN","PSIVOD",21,0)
 S P("RES")="N",PSIVAC="PN",P("PON")=ON55,(PSJORNAT,P("NAT"))="W",PSIVUP=+$$GTPCI^PSIVUTL,PSJORD=ON55,PSGORD=PSJORD
"RTN","PSIVOD",22,0)
 N OLDACT,PSIVCHG S OLDACT=PSGACT S PSGACT=PSGACT_"E",P(17)="N",(P("LOG"),P(2))=PSGDT,P("LF")="",P(21)=""
"RTN","PSIVOD",23,0)
 D ENT^PSIVCAL,ENSTOP^PSIVCAL
"RTN","PSIVOD",24,0)
 K PSJACEPT S VALMBCK="Q",PSIVCOPY=1,PSIVCHG=0 D ACEDIT^PSJLIACT
"RTN","PSIVOD",25,0)
 I '$G(PSGOEAV) D DEL55^PSIVORE2
"RTN","PSIVOD",26,0)
 I $G(P("NAT"))="" D  G Q
"RTN","PSIVOD",27,0)
 .D FULL^VALM1 W !!,"Order not copied" D PAUSE^VALM1
"RTN","PSIVOD",28,0)
 D OK^PSIVORE
"RTN","PSIVOD",29,0)
 L -^PS(55,DFN,"IV",+ON55) D ULK
"RTN","PSIVOD",30,0)
 D FULL^VALM1 W !!?5,"You are finished with the new order.",!,"The following ACTION prompt is for the original order." D PAUSE^VALM1
"RTN","PSIVOD",31,0)
Q ; Kill and exit.
"RTN","PSIVOD",32,0)
 L:'$D(PSJOE) -^PS(53.45,DUZ) S PSJNKF=1 D Q^PSIV
"RTN","PSIVOD",33,0)
 K FIL,I1,ND,PC,PDM,PSGDT,PSGID,PSGLMT,PSGSI,PSJNARC,PSIVAC,PSIVCHG,PSIVUP,PSIVX,PSJOPC
"RTN","PSIVOD",34,0)
 S VALMBCK="R"
"RTN","PSIVOD",35,0)
 I '$G(PSGDT) S PSGDT=$$DATE^PSJUTL2
"RTN","PSIVOD",36,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD) ; resets PSGACT after copy
"RTN","PSIVOD",37,0)
 D RESTORE^PSJHVARS
"RTN","PSIVOD",38,0)
 K P M P=OLDP
"RTN","PSIVOD",39,0)
 Q
"RTN","PSIVOD",40,0)
 ;
"RTN","PSIVOD",41,0)
ULK ;
"RTN","PSIVOD",42,0)
 Q:'$G(PSJLSORX)  ;If NEW^PSIVORE did not lock, don't kill it here.
"RTN","PSIVOD",43,0)
 NEW X S X=DFN_";DPT(" D ULK^ORX2 K PSJLSORX
"RTN","PSIVOD",44,0)
 Q
"RTN","PSIVOD",45,0)
HK ;Queue job to print MAR labels generated for this patient.
"RTN","PSIVOD",46,0)
 I PSGOP,PSGOP'=DFN D
"RTN","PSIVOD",47,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSIVOD",48,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVOD",49,0)
 S PSGOP=DFN
"RTN","PSIVOD",50,0)
 Q
"RTN","PSIVOD",51,0)
 ;
"RTN","PSIVOD",52,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(^PS(55,DFN,"IV",+ON55,"SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(^(XXX,0),U,2)
"RTN","PSIVOD",53,0)
 K XXX Q
"RTN","PSIVOD",54,0)
CH ;
"RTN","PSIVOD",55,0)
 W !!?2,"Answer 'YES' to have a new, non-verified order created for this patient,"
"RTN","PSIVOD",56,0)
 W !,"using the information from this order.  (The START and STOP dates will be",!,"recalculated.)  Enter 'NO' (or '^') to stop now."
"RTN","PSIVOD",57,0)
 Q
"RTN","PSIVOPT")
0^59^B56145512
"RTN","PSIVOPT",1,0)
PSIVOPT ;BIR/PR,MLM-OPTION DRIVER ;06 Aug 98 / 2:17 PM
"RTN","PSIVOPT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**17,27,58,88,104,110**;16 DEC 97
"RTN","PSIVOPT",3,0)
 ;
"RTN","PSIVOPT",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSIVOPT",5,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192        
"RTN","PSIVOPT",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231
"RTN","PSIVOPT",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173
"RTN","PSIVOPT",8,0)
 ;
"RTN","PSIVOPT",9,0)
 NEW PSIVLOCK S PSIVLOCK=0
"RTN","PSIVOPT",10,0)
 ;I ON["P" L +^PS(53.1,+ON):1 S:'$T PSIVLOCK=1
"RTN","PSIVOPT",11,0)
 I ON["V" L +^PS(55,DFN,"IV",+ON55):1 S:'$T PSIVLOCK=1
"RTN","PSIVOPT",12,0)
 I PSIVLOCK W !,$C(7),$C(7),"This order is being edited by another user. Try later." G K
"RTN","PSIVOPT",13,0)
 ;W ! L +^PS(55,DFN,"IV",+ON55):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." G K
"RTN","PSIVOPT",14,0)
 I PSIVAC="O"!(PSIVAC="H") S PSIVAC=PSIVAC_"(DFN,ON,P(17),P(3))"
"RTN","PSIVOPT",15,0)
 S TEX="Active order ***" I $D(UWLFLAG),UWLFLAG="1.001" S XED=0 D @PSIVAC G K
"RTN","PSIVOPT",16,0)
 S DONE=0 F  D ACT Q:DONE
"RTN","PSIVOPT",17,0)
 ;
"RTN","PSIVOPT",18,0)
UNLOCK ; Unlock order.
"RTN","PSIVOPT",19,0)
 ;I ON["P" L -^PS(53.1,+ON)
"RTN","PSIVOPT",20,0)
 ;E  L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVOPT",21,0)
 I ON["V" L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVOPT",22,0)
 ;
"RTN","PSIVOPT",23,0)
K ; Kill variables.
"RTN","PSIVOPT",24,0)
 K %,DA,DIE,DIK,DLAYGO,DNE,DR,DRG,DRGI,DRGT,ERR,HELP,J,OD,P,P16,PSIVAL,PSIVC,PSIVLOG,PSIVNOL,PSIVOK,PSIVOPT,PSIVREA,SCRNPRO,TEX,XED
"RTN","PSIVOPT",25,0)
 Q
"RTN","PSIVOPT",26,0)
ACT ; Prompt for order action.
"RTN","PSIVOPT",27,0)
 K PSJIVBD NEW PSGFDX,PSGSDX S (PSJORD,ON)=ON55
"RTN","PSIVOPT",28,0)
 S PSJCOM=$S(ON["V":$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8),1:$P($G(^PS(53.1,+ON,.2)),"^",8))
"RTN","PSIVOPT",29,0)
 D:ON["V" EN^PSJLIORD(DFN,ON)
"RTN","PSIVOPT",30,0)
 I ON["P",($P($G(^PS(53.1,+ON,0)),U,9)="N"),'PSJCOM D GT531^PSIVORFA(DFN,ON),VF^PSIVORC2 S DONE=1 Q
"RTN","PSIVOPT",31,0)
 I ON["P",PSJCOM Q:'$$LOCK^PSJOEA(DFN,PSJCOM)  N PSJO,ON,PSJORD S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJCOM,PSJO)) Q:'PSJO  Q:$G(Y)="Q"  S (PSJORD,ON)=PSJO_"P" D
"RTN","PSIVOPT",32,0)
 .D:($P($G(^PS(53.1,+ON,0)),U,9)="N") GT531^PSIVORFA(DFN,ON),VF^PSIVORC2
"RTN","PSIVOPT",33,0)
 .D:($P($G(^PS(53.1,+ON,0)),U,9)="P") EN^PSJLIFN
"RTN","PSIVOPT",34,0)
 I $G(PSJCOM) N PSJORD S PSJORD=PSJCOM D CHK^PSJOEA1
"RTN","PSIVOPT",35,0)
 I ON'["V",'+$G(PSJCOM) D EN^PSJLIFN
"RTN","PSIVOPT",36,0)
 S DONE=1
"RTN","PSIVOPT",37,0)
 Q
"RTN","PSIVOPT",38,0)
 ;
"RTN","PSIVOPT",39,0)
CK ; Check if drugs are still valid.
"RTN","PSIVOPT",40,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  D
"RTN","PSIVOPT",41,0)
 .S DRG=+$P(DRG(DRGT,DRGI),U),X=$G(^PS(FIL,DRG,"I")) I $S('X:0,DT<X:0,1:1)!$S('$G(^PSDRUG(+$P($G(^PS(FIL,DRG,0)),U,2),"I")):0,^("I")>DT:0,1:1) S ERR=1
"RTN","PSIVOPT",42,0)
 Q
"RTN","PSIVOPT",43,0)
 ;
"RTN","PSIVOPT",44,0)
D ; Discontinue order.
"RTN","PSIVOPT",45,0)
 D D^PSIVOPT2
"RTN","PSIVOPT",46,0)
 Q
"RTN","PSIVOPT",47,0)
 ;
"RTN","PSIVOPT",48,0)
O(DFN,ON,STAT,STOP) ; On/Off Call
"RTN","PSIVOPT",49,0)
 D NOW^%DTC I STAT="H",STOP<% D EXPIR Q
"RTN","PSIVOPT",50,0)
 I "OA"'[STAT W !,$C(7),"Only active orders may be placed on hold." Q
"RTN","PSIVOPT",51,0)
 S PSIVALT=1,PSIVREA=$S(STAT'="O":"O",1:"C"),(P(17),STAT)=$S(PSIVREA="O":"O",1:"A") W:PSIVREA="C" ?$X+4,$C(7),TEX
"RTN","PSIVOPT",52,0)
 D UPSTAT,LOG^PSIVORAL D:STAT="A" CKO^PSIVCHK
"RTN","PSIVOPT",53,0)
 Q
"RTN","PSIVOPT",54,0)
 ;
"RTN","PSIVOPT",55,0)
E ; Entry for Pharmacy edit
"RTN","PSIVOPT",56,0)
 N PSJEDIT1 D E^PSIVOPT1
"RTN","PSIVOPT",57,0)
 Q
"RTN","PSIVOPT",58,0)
 ;
"RTN","PSIVOPT",59,0)
R ; Renew order.
"RTN","PSIVOPT",60,0)
 D R^PSIVOPT2
"RTN","PSIVOPT",61,0)
 Q
"RTN","PSIVOPT",62,0)
 ;
"RTN","PSIVOPT",63,0)
H(DFN,ON,STAT,STOP)          ; Place order on hold.
"RTN","PSIVOPT",64,0)
 D NOW^%DTC I STAT="H" I STOP<% D EXPIR Q
"RTN","PSIVOPT",65,0)
 I "HA"'[STAT W !,$C(7),"Only active orders may be placed on hold." Q
"RTN","PSIVOPT",66,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !!,"Order unchanged." Q
"RTN","PSIVOPT",67,0)
 S PSIVALT=1,PSIVREA=$S(STAT'="H":"H",1:"U"),(P(17),STAT)=$S(PSIVREA="H":"H",1:"A") W:PSIVREA="U" ?$X+4,$C(7),TEX
"RTN","PSIVOPT",68,0)
 D UPSTAT,LOG^PSIVORAL,HOLD^PSIVOE,ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(PSIVREA="H":"H1",1:"H0")) D:STAT="A" CKO^PSIVCHK
"RTN","PSIVOPT",69,0)
 Q
"RTN","PSIVOPT",70,0)
 ;
"RTN","PSIVOPT",71,0)
S ; View order.
"RTN","PSIVOPT",72,0)
 D @$S(ON55["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON55_""")") W @IOF D EN^PSIVORV2
"RTN","PSIVOPT",73,0)
 Q
"RTN","PSIVOPT",74,0)
 ;
"RTN","PSIVOPT",75,0)
EXPIR ; Update status of expired orders.
"RTN","PSIVOPT",76,0)
 S STAT="E" D UPSTAT,EXPIR^PSIVOE W $C(7),"  This order has expired."
"RTN","PSIVOPT",77,0)
 Q
"RTN","PSIVOPT",78,0)
 ;
"RTN","PSIVOPT",79,0)
UPSTAT ; Update orders status.
"RTN","PSIVOPT",80,0)
 N DA,DR,DIE,PSIVACT S PSIVACT=1,DA=+ON55,DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"",",DR="100///"_P(17)_$S($G(PSIVREA)="H":";149///1",$G(PSIVREA)="U":";149///@",1:"") D ^DIE
"RTN","PSIVOPT",81,0)
 Q
"RTN","PSIVOPT",82,0)
 ;
"RTN","PSIVOPT",83,0)
ENIN ; Entry for inpatient order entry/profile options.
"RTN","PSIVOPT",84,0)
 N DFN,ON,P,PSIVAC S PSIVAC="C" I PSJORD["P" S (P("PON"),ON)=+PSJORD_"P",DFN=PSGP D SHOW1^PSIVORC Q
"RTN","PSIVOPT",85,0)
 S (P("PON"),ON,ON55)=+PSJORD_"V",DFN=PSGP D GT55^PSIVORFB,EN^PSIVORV2,PSIVOPT:'$D(PSJPRF)
"RTN","PSIVOPT",86,0)
 L -^PS(55,DFN,"IV",+PSJORD)
"RTN","PSIVOPT",87,0)
 Q
"RTN","PSIVOPT",88,0)
 ;
"RTN","PSIVOPT",89,0)
ENARI(DFN,ON,PSGUOW,PSIVAL) ; Auto-reinstate IV orders if movement is deleted.
"RTN","PSIVOPT",90,0)
 ;Create a list of recipients beyond normal mail group
"RTN","PSIVOPT",91,0)
 S PSGORNUM=$S($G(PSGORD):PSGORD,$G(PSJORD):PSJORD,$G(OR55):OR55,1:"")
"RTN","PSIVOPT",92,0)
 I $G(PSGORNUM) D
"RTN","PSIVOPT",93,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,0)),$P(^PS(55,PSGP,"IV",+PSGORNUM,0),U,6)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,0),U,6))="" ; Provider
"RTN","PSIVOPT",94,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,2)),$P(^PS(55,PSGP,"IV",+PSGORNUM,2),U,11)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,2),U,11))="" ; Entered by
"RTN","PSIVOPT",95,0)
 .I $D(^PS(55,PSGP,"IV",+PSGORNUM,4)),$P(^PS(55,PSGP,"IV",+PSGORNUM,4),U,1)'="" S PSJSENTO($J,$P(^PS(55,PSGP,"IV",+PSGORNUM,4),U,1))="" ; Verifying Nurse
"RTN","PSIVOPT",96,0)
 ; find pharmacist that finished the IV order
"RTN","PSIVOPT",97,0)
 N PSJX,ENTBY S PSJX=$G(^PS(55,PSGP,"IV",+ON,"A",1,0))
"RTN","PSIVOPT",98,0)
 I $P(PSJX,U,2)="F" S ENTBY=$$VA200($P(PSJX,U,3)) I ENTBY'="" S PSJSENTO($J,ENTBY)=""
"RTN","PSIVOPT",99,0)
 ;
"RTN","PSIVOPT",100,0)
 I $G(PSGALO)'=18530,$G(PSGORNUM),$$IVDUPADD^PSIVOPT(PSGP,+PSGORNUM) S ^TMP("PSJNOTUNDC",$J,PSGP,+PSGORNUM_"V")="" Q
"RTN","PSIVOPT",101,0)
 N DA,DR,DIE,DIK,PSIVREA,PSIVALCK,PSIVOPT,PSIVALT,X,Y
"RTN","PSIVOPT",102,0)
 S X=$G(^PS(55,DFN,"IV",+ON,"ADC")) I X K ^PS(55,"ADC",X,DFN,+ON),^PS(55,DFN,"IV",+ON,"ADC")
"RTN","PSIVOPT",103,0)
 S PSIVACT=1,DR=$S(+$P($G(^PS(55,DFN,"IV",+ON,4)),U,18)=1:"100///H",+$P($G(^PS(55,DFN,"IV",+ON,0)),U,10)=1:"100///H",1:"100///A")_";.03////"_+$P($G(^PS(55,DFN,"IV",+ON,2)),U,7)_";109///@;116///@;121///@"
"RTN","PSIVOPT",104,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON,DA(1)=DFN
"RTN","PSIVOPT",105,0)
 N CHKIT S CHKIT=$G(^PS(55,DFN,"IV",+ON,2)) I $P(CHKIT,U,6)["P",($P(CHKIT,U,9)="R") S DR=DR_";114///@;123///@"
"RTN","PSIVOPT",106,0)
 D ^DIE
"RTN","PSIVOPT",107,0)
 S ^TMP("PSJUNDC",$J,DFN,ON_"V")=""
"RTN","PSIVOPT",108,0)
 S ON55=ON,P(17)="A",PSIVREA=$S($D(PSJUNDC):"AI",1:"I"),PSIVALCK="STOP",(PSIVOPT,PSIVALT)=1,PSIVAL=$P($G(^PS(53.3,+PSIVAL,0)),U) D LOG^PSIVORAL
"RTN","PSIVOPT",109,0)
 ;* S Y=^PS(55,DFN,"IV",+ON,0),P(3)=+$P(Y,U,3),ORIFN=$P(Y,U,21),P(12)="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D
"RTN","PSIVOPT",110,0)
 S Y=^PS(55,DFN,"IV",+ON,0),P(3)=+$P(Y,U,3),P(12)="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D
"RTN","PSIVOPT",111,0)
 .D EN1^PSJHL2(DFN,"SC",+ON55_"V","AUTO REINSTATED")
"RTN","PSIVOPT",112,0)
 S PSGTOL=$S($D(PSJUNDC):3,1:2)
"RTN","PSIVOPT",113,0)
 Q:$S('$D(PSJUNDC):0,PSGALO=18540:1,1:'$P($G(PSJSYSW0),U,15))
"RTN","PSIVOPT",114,0)
 I $D(^PS(53.41,1,1,PSGUOW,1,DFN,1,3,1,+ON)) K DIK,DA S DIK="^PS(53.41,1,1,"_PSGUOW_",1,"_DFN_",1,3,1,",DA=+ON,DA(1)=1,DA(2)=PSGP,DA(3)=PSGUOW,DA(4)=3 D ^DIK
"RTN","PSIVOPT",115,0)
 E  K DA D ENLBL^PSIVOPT(PSGTOL,PSGUOW,DFN,3,+ON,"RE")
"RTN","PSIVOPT",116,0)
 Q
"RTN","PSIVOPT",117,0)
 ;
"RTN","PSIVOPT",118,0)
ENINP(DFN,ON) ; Entry from Inpatient Profile.
"RTN","PSIVOPT",119,0)
 N PSIVAC,ON55 S PSIVAC="PRO" D @($S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON_""")")),ENNH^PSIVORV2(ON)
"RTN","PSIVOPT",120,0)
 Q
"RTN","PSIVOPT",121,0)
ENLBL(PSGTOL,PSGUOW,PSGP,PSGTOO,DA,RES) ;
"RTN","PSIVOPT",122,0)
 ;Queue MAR labels for IV orders.
"RTN","PSIVOPT",123,0)
 Q:'$D(^DPT(PSGP,.1))  I '$D(PSJSYSW0) N PSJACPF,PSJACNWP S PSJACPF=11 D WP^PSJAC Q:'PSJSYSL
"RTN","PSIVOPT",124,0)
 N P,X,Y
"RTN","PSIVOPT",125,0)
 S X=$P(PSJSYSW0,U,2),Y=$P($G(^PS(55,PSGP,"IV",DA,0)),U,4)
"RTN","PSIVOPT",126,0)
 S Y=$S(Y="A":4,Y="H":5,Y="C":6,1:3) I X=1!(X[Y) D NOW^%DTC S PSGDT=% D ENL^PSGVDS S ^PS(55,DFN,"IV",DA,7)=PSGDT_U_RES
"RTN","PSIVOPT",127,0)
 Q
"RTN","PSIVOPT",128,0)
 ;
"RTN","PSIVOPT",129,0)
IVDUPADD(PSGP,ORDERNUM) ;
"RTN","PSIVOPT",130,0)
 N PSJCOM
"RTN","PSIVOPT",131,0)
 S DUPLOOP=0
"RTN","PSIVOPT",132,0)
 S DUPFOUND=0
"RTN","PSIVOPT",133,0)
 ;Loop through the additives of order to reinstate
"RTN","PSIVOPT",134,0)
 S PSJCOM=+$P($G(^PS(55,+PSGP,"IV",ORDERNUM,.2)),"^",8) F  S DUPLOOP=$O(^PS(55,PSGP,"IV",ORDERNUM,"AD",DUPLOOP)) Q:((DUPLOOP="")!(DUPFOUND))  D
"RTN","PSIVOPT",135,0)
 .;Get the additive code no.
"RTN","PSIVOPT",136,0)
 .S TARGET=$P(^PS(55,PSGP,"IV",ORDERNUM,"AD",DUPLOOP,0),"^",1)
"RTN","PSIVOPT",137,0)
 .D NOW^%DTC
"RTN","PSIVOPT",138,0)
 .S DATELOOP=%
"RTN","PSIVOPT",139,0)
 .;Loop through the current orders for the patient by date
"RTN","PSIVOPT",140,0)
 .F  S DATELOOP=$O(^PS(55,PSGP,"IV","AIS",DATELOOP)) Q:((DATELOOP="")!(DUPFOUND))  D
"RTN","PSIVOPT",141,0)
 ..S EXISTORD=""
"RTN","PSIVOPT",142,0)
 ..;Loop through the orders for date by order number
"RTN","PSIVOPT",143,0)
 ..F  S EXISTORD=$O(^PS(55,PSGP,"IV","AIS",DATELOOP,EXISTORD)) Q:((EXISTORD="")!(DUPFOUND))  D
"RTN","PSIVOPT",144,0)
 ...;Loop through additives for the existing order
"RTN","PSIVOPT",145,0)
 ...I PSJCOM>0 Q:+$P($G(^PS(55,+PSGP,"IV",EXISTORD,.2)),"^",8)
"RTN","PSIVOPT",146,0)
 ...S EXISTADD=0
"RTN","PSIVOPT",147,0)
 ...F  S EXISTADD=$O(^PS(55,PSGP,"IV",EXISTORD,"AD",EXISTADD)) Q:((EXISTADD="")!(DUPFOUND))  D 
"RTN","PSIVOPT",148,0)
 ....;Extract the Additive Code number for the Order
"RTN","PSIVOPT",149,0)
 ....S MATCHADD=$P(^PS(55,PSGP,"IV",EXISTORD,"AD",EXISTADD,0),"^",1)
"RTN","PSIVOPT",150,0)
 ....;If the existing order and the order to be reinstated have the same additive code then return FOUND=TRUE
"RTN","PSIVOPT",151,0)
 ....I MATCHADD=TARGET D
"RTN","PSIVOPT",152,0)
 .....S DUPFOUND=1
"RTN","PSIVOPT",153,0)
 Q DUPFOUND
"RTN","PSIVOPT",154,0)
 ;
"RTN","PSIVOPT",155,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSIVOPT",156,0)
 ; X = User name
"RTN","PSIVOPT",157,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSIVOPT",158,0)
 I +Y=-1 Q ""
"RTN","PSIVOPT",159,0)
 Q $P(Y,U)
"RTN","PSIVOPT1")
0^90^B39066236
"RTN","PSIVOPT1",1,0)
PSIVOPT1 ;BIR/MLM-EDIT/DC ORDER (BACKDOOR) ;22 OCT 97 / 3:14 PM
"RTN","PSIVOPT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,58,101,110**;16 DEC 97
"RTN","PSIVOPT1",3,0)
 ;
"RTN","PSIVOPT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVOPT1",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT1",6,0)
 ;
"RTN","PSIVOPT1",7,0)
E ; Edit order through Pharmacy.
"RTN","PSIVOPT1",8,0)
 NEW PSJEDFLG
"RTN","PSIVOPT1",9,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSIVOPT1",10,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVOPT1",11,0)
 Q
"RTN","PSIVOPT1",12,0)
ACCEPT ; To be called by ACCEPT^PSJLIACT
"RTN","PSIVOPT1",13,0)
 I $G(PSJEDFLG) S VALMBCK="" Q
"RTN","PSIVOPT1",14,0)
 I '$G(PSJEDIT1) D CKNEW I PSIVCHG D
"RTN","PSIVOPT1",15,0)
 .S P("OLDON")=ON55,Y=$G(^PS(55,DFN,"IV",+ON55,0)) D NOW^%DTC S P("LOG")=$E(%,1,12)
"RTN","PSIVOPT1",16,0)
 . S P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U)
"RTN","PSIVOPT1",17,0)
 .I $G(PSGSDX)!$G(PSGFDX) Q
"RTN","PSIVOPT1",18,0)
 .I $P(Y,U,2)=P(2),$P(Y,U,3)=P(3) D ENT^PSIVCAL S X=P(2),%DT="T" D ^%DT S P(2)=$E(Y,1,12),PSJEDIT1=1 D ENSTOP^PSIVCAL
"RTN","PSIVOPT1",19,0)
 K PSJEDFLG
"RTN","PSIVOPT1",20,0)
 D OK^PSIVOPT2
"RTN","PSIVOPT1",21,0)
 I X["N" S VALMBCK="R" Q
"RTN","PSIVOPT1",22,0)
 I X["^" D GT55^PSIVORFB W !,"Order unchanged." Q
"RTN","PSIVOPT1",23,0)
 ;;I $G(P(21))]"" D CKNEW,@$S(PSIVCHG:"NEWORD",1:"UPDATE") Q:$D(X)
"RTN","PSIVOPT1",24,0)
 I $G(P("21FLG"))]"" D CKNEW,@$S(PSIVCHG:"NEWORD",1:"UPDATE") Q:$D(X)
"RTN","PSIVOPT1",25,0)
 ;;S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2) D EN^PSIVORE,^PSIVORE1
"RTN","PSIVOPT1",26,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) S ON=ON55,OD=P(2)
"RTN","PSIVOPT1",27,0)
 ;D:ON["V" EN^PSIVORE,^PSIVORE1
"RTN","PSIVOPT1",28,0)
 D:ON["V" EN^PSIVORE
"RTN","PSIVOPT1",29,0)
 ;;I $G(PSJIVORF),PSIVCHG D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER") NEW PSIVXX S PSIVXX=$$LS^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT1",30,0)
 I $G(PSJIVORF),PSIVCHG D EN1^PSJHL2(DFN,"SN",ON55,"NEW ORDER") NEW PSIVXX S PSIVXX=$$LS^PSSLOCK(DFN,ON55)
"RTN","PSIVOPT1",31,0)
 S PSIVACEP=1
"RTN","PSIVOPT1",32,0)
 Q
"RTN","PSIVOPT1",33,0)
 ;
"RTN","PSIVOPT1",34,0)
CKNEW ; Check if new order is to be created.
"RTN","PSIVOPT1",35,0)
 N DNE,ND,TDRG S (DRG("DRGC"),DNE,PSIVCHG)=0
"RTN","PSIVOPT1",36,0)
 Q:PSIVCHG  F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  S TDRG(DRGT,+$P(DRG(DRGT,DRGI),U),DRGI)=$P(DRG(DRGT,DRGI),U,3) I $P(P("OT"),U)="F",'$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSIVOPT1",37,0)
 F DRGT="AD","SOL" Q:DRGT="SOL"&(P("DTYP")=1)  F DRGI=0:0 S DRGI=$O(^PS(55,DFN,"IV",+ON55,DRGT,DRGI)) Q:'DRGI!DNE  D
"RTN","PSIVOPT1",38,0)
 .S X=$G(^PS(55,DFN,"IV",+ON55,DRGT,DRGI,0)),DRG("DRGC")=$G(DRG("DRGC"))+1
"RTN","PSIVOPT1",39,0)
 .I $D(TDRG(DRGT,+$P(X,U),DRGI)),$P(X,U,2)=$P(TDRG(DRGT,+$P(X,U),DRGI),U) Q
"RTN","PSIVOPT1",40,0)
 .S (PSIVCHG,DNE)=1
"RTN","PSIVOPT1",41,0)
 Q:PSIVCHG
"RTN","PSIVOPT1",42,0)
 I $G(DRG("AD",0))+$S(P("DTYP")=1:0,1:+$G(DRG("SOL",0)))'=DRG("DRGC") S PSIVCHG=1 Q
"RTN","PSIVOPT1",43,0)
 S ND(0)=$G(^PS(55,DFN,"IV",+ON55,0)),ND("PD")=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSIVOPT1",44,0)
 N X S X=$S($P(ND(0),U,8)["@":$P($P(ND(0),U,8),"@"),1:$P(ND(0),U,8))
"RTN","PSIVOPT1",45,0)
 S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":X_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)_U_$P(ND(0),U,9)
"RTN","PSIVOPT1",46,0)
 S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":$S(P(8)["@":$P(P(8),"@"),1:P(8))_U,1:"")_+P(6)_U_P(2)_U_P(3)_U_P(9)) PSIVCHG=1
"RTN","PSIVOPT1",47,0)
 ;* S ND=$S($E(P("OT"))="I":$P(ND("PD"),U,1,2)_U,1:"")_$P(ND("PD"),U,3)_U_$S($E(P("OT"))'="I":$P(ND(0),U,8)_U,1:"")_+$P(ND(0),U,6)_U_$P(ND(0),U,2)_U_$P(ND(0),U,3)_U_$P(ND(0),U,9)
"RTN","PSIVOPT1",48,0)
 ;* S:ND'=($S($E(P("OT"))="I":+P("PD")_U_$G(P("DO"))_U,1:"")_+P("MR")_U_$S($E(P("OT"))'="I":P(8)_U,1:"")_+P(6)_U_P(2)_U_P(3)_U_P(9)) PSIVCHG=1
"RTN","PSIVOPT1",49,0)
 Q
"RTN","PSIVOPT1",50,0)
 ;
"RTN","PSIVOPT1",51,0)
UPDATE ; Update original order.
"RTN","PSIVOPT1",52,0)
 S PSIVALT=1,PSIVALCK="EN",PSIVREA="E",ON=ON55 K P("OLDON") D LOG^PSIVORAL
"RTN","PSIVOPT1",53,0)
 D SET55^PSIVORFB,ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"E")
"RTN","PSIVOPT1",54,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN K X Q:'PSJIVORF
"RTN","PSIVOPT1",55,0)
 S PSJORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'PSJORIFN
"RTN","PSIVOPT1",56,0)
 S P("NAT")=""
"RTN","PSIVOPT1",57,0)
 D EN1^PSJHL2(DFN,"XX",+ON55_"V","UPDATED ORDER")
"RTN","PSIVOPT1",58,0)
 K X
"RTN","PSIVOPT1",59,0)
 Q
"RTN","PSIVOPT1",60,0)
 ;
"RTN","PSIVOPT1",61,0)
NEWORD ; DC orig. order, get new order no.
"RTN","PSIVOPT1",62,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) S X=1 W !,"Order unchanged." Q
"RTN","PSIVOPT1",63,0)
 ;;S P("RES")="E",P("OLDON")=ON55,P(16)="" K ON55 D NEW55^PSIVORFB S (P("PON"),P("NEWON"),ON)=ON55,ON55=P("OLDON")
"RTN","PSIVOPT1",64,0)
 S P("RES")="E",P("OLDON")=ON55,P(16)=""
"RTN","PSIVOPT1",65,0)
 Q:$$NONVF()
"RTN","PSIVOPT1",66,0)
 K ON55 D NEW55^PSIVORFB S (P("PON"),P("NEWON"),ON)=ON55,ON55=P("OLDON")
"RTN","PSIVOPT1",67,0)
 I $P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)="A" D D1^PSIVOPT2 D
"RTN","PSIVOPT1",68,0)
 . I PSJIVORF,$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED")
"RTN","PSIVOPT1",69,0)
 . ;;S P(21)="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",70,0)
 . S P("21FLG")="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",71,0)
 . D UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT1",72,0)
 F ON55=P("NEWON"),P("OLDON") K DA,DIE,DR D
"RTN","PSIVOPT1",73,0)
 .S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR=$S((ON55=P("NEWON")&(+ON55'=+P("OLDON"))):"113////"_P("OLDON")_";122////E",1:"114////"_P("NEWON")_";123////E") D ^DIE
"RTN","PSIVOPT1",74,0)
 .I ON55=P("NEWON") N CLINAPPT S CLINAPPT=$G(^PS(55,DFN,"IV",+P("OLDON"),"DSS")) D
"RTN","PSIVOPT1",75,0)
 ..S:CLINAPPT DR=DR_";136////"_+CLINAPPT S:$P(CLINAPPT,"^",2) DR=DR_";139////"_$P(CLINAPPT,"^",2)
"RTN","PSIVOPT1",76,0)
 .D ^DIE
"RTN","PSIVOPT1",77,0)
 .Q:ON55=P("OLDON")&($P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)'="D")
"RTN","PSIVOPT1",78,0)
 .D:ON55=P("NEWON") SET55^PSIVORFB
"RTN","PSIVOPT1",79,0)
 .D:ON55=P("NEWON") VF1^PSJLIACT("","",0)
"RTN","PSIVOPT1",80,0)
 .D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(ON55=P("NEWON"):"N",1:"DE"))
"RTN","PSIVOPT1",81,0)
 .S PSIVREA="E",PSIVAL="Order "_$S(ON55=P("OLDON"):"discontinued",1:"created")_" due to edit" S:ON55=P("OLDON") PSIVALCK="STOP" D LOG^PSIVORAL
"RTN","PSIVOPT1",82,0)
 L -^PS(55,DFN,"IV",+P("OLDON")) ;D NEWENT^PSIVORFE
"RTN","PSIVOPT1",83,0)
 K X S ON55=P("NEWON"),P(17)="A" Q:'PSJIVORF  D SET^PSIVORFE
"RTN","PSIVOPT1",84,0)
 Q
"RTN","PSIVOPT1",85,0)
 ;
"RTN","PSIVOPT1",86,0)
NEWSTOP ; Set stop date for DC and renewals.
"RTN","PSIVOPT1",87,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,0)),Y=+$P(ND,U,3),$P(^PS(55,DFN,"IV",+P("OLDON"),2),U,7)=Y,NSTOP=$S(NSTOP>Y:Y,1:NSTOP),$P(^PS(55,DFN,"IV",+ON55,0),U,3)=NSTOP
"RTN","PSIVOPT1",88,0)
 K DA,DIK S DIK="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+P("OLDON") D IX^DIK K DA,DIK
"RTN","PSIVOPT1",89,0)
 Q
"RTN","PSIVOPT1",90,0)
NONVF()   ;
"RTN","PSIVOPT1",91,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVOPT1",92,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVOPT1",93,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVOPT1",94,0)
 K DA D ENGNN^PSGOETO S (ON,P("NEWON"))=DA_"P",P(17)="N"
"RTN","PSIVOPT1",95,0)
 S (P("DO"),P("PD"))=""
"RTN","PSIVOPT1",96,0)
 D GTPD^PSIVORE2,PUT531^PSIVORFA
"RTN","PSIVOPT1",97,0)
 I $P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)="A" D D1^PSIVOPT2 D
"RTN","PSIVOPT1",98,0)
 . I PSJIVORF,$P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,21) D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED")
"RTN","PSIVOPT1",99,0)
 . S P("21FLG")="" W !!,"Original order discontinued...",!!
"RTN","PSIVOPT1",100,0)
 . D UNL^PSSLOCK(DFN,+P("OLDON")_"V")
"RTN","PSIVOPT1",101,0)
 F ON55=P("NEWON"),P("OLDON") K DA,DIE,DR D
"RTN","PSIVOPT1",102,0)
 . S DA=+ON55
"RTN","PSIVOPT1",103,0)
 . S:ON55=P("NEWON") DIE="^PS(53.1,",DR="104////"_P("OLDON")_";103////E"
"RTN","PSIVOPT1",104,0)
 . S:ON55=P("OLDON") DA(1)=DFN,DIE="^PS(55,"_DFN_",""IV"",",DR="114////"_P("NEWON")_";123////E"
"RTN","PSIVOPT1",105,0)
 . D ^DIE
"RTN","PSIVOPT1",106,0)
 . Q:ON55=P("OLDON")&($P($G(^PS(55,DFN,"IV",+P("OLDON"),0)),U,17)'="D")
"RTN","PSIVOPT1",107,0)
 . I ON55=P("OLDON") D
"RTN","PSIVOPT1",108,0)
 .. D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,$S(ON55=P("NEWON"):"N",1:"DE"))
"RTN","PSIVOPT1",109,0)
 .. S PSIVALT="",PSIVREA="E",PSIVAL="Order discontinued due to edit" S PSIVALCK="STOP" D LOG^PSIVORAL
"RTN","PSIVOPT1",110,0)
 . D:ON55=P("NEWON") NEWNVAL^PSGAL5(ON55,4100,"","")
"RTN","PSIVOPT1",111,0)
 L -^PS(55,DFN,"IV",+P("OLDON"))
"RTN","PSIVOPT1",112,0)
 K X S (ON,ON55)=P("NEWON")
"RTN","PSIVOPT1",113,0)
 D EN1^PSJHL2(DFN,"SN",ON,"ORDER CREATED")
"RTN","PSIVOPT1",114,0)
 S X=$$LS^PSSLOCK(DFN,ON)
"RTN","PSIVOPT1",115,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVOPT1",116,0)
 I ON["P" N CLINAPPT S CLINAPPT=$G(^PS(55,DFN,"IV",+ON,"DSS")) I CLINAPPT D  K DIE,DA,DR
"RTN","PSIVOPT1",117,0)
 . S:CLINAPPT DR="136////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"139////"_$P(CLINAPPT,"^",2)_";" D ^DIE
"RTN","PSIVOPT1",118,0)
 S VALMBCK="Q"
"RTN","PSIVOPT1",119,0)
 S PSGACT="EL"
"RTN","PSIVOPT1",120,0)
 I P(17)="N",(P("OLDON")=""),(P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVOPT1",121,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVOPT1",122,0)
 Q 1
"RTN","PSIVOPT2")
0^60^B31072778
"RTN","PSIVOPT2",1,0)
PSIVOPT2 ;BIR/PR,MLM-OPTION DRIVER (CONT) ;02 Mar 99 / 9:27 AM
"RTN","PSIVOPT2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,29,58,110**;16 DEC 97
"RTN","PSIVOPT2",3,0)
 ;
"RTN","PSIVOPT2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVOPT2",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVOPT2",6,0)
 ;
"RTN","PSIVOPT2",7,0)
D ; Discontinue order.
"RTN","PSIVOPT2",8,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",9,0)
 ;* 8/2* D EN1^PSJHL2(DFN,"OD",+ON55_"V","ORDER DISCONTINUED"),D1
"RTN","PSIVOPT2",10,0)
 I '$$REQPROV^PSGOEC W !,$C(7),"Order Unchanged." S COMQUIT=1 Q
"RTN","PSIVOPT2",11,0)
 I 'PSJCOM D
"RTN","PSIVOPT2",12,0)
 .D D1
"RTN","PSIVOPT2",13,0)
 .S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3)
"RTN","PSIVOPT2",14,0)
 I PSJCOM N COMFLG S COMFLG=0 D
"RTN","PSIVOPT2",15,0)
 .I ON55'["P" N COMFLG,O,OO S (COMFLG,O)=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  Q:COMFLG  D
"RTN","PSIVOPT2",16,0)
 .. Q:OO=ON55  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSIVOPT2",17,0)
 I PSJCOM Q:COMFLG  N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSIVOPT2",18,0)
 .I OO["V" S ON55=OO D D1 S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG^PSIVORAL N PSJORD S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),PSJORD=ON55 D HL^PSIVORA Q
"RTN","PSIVOPT2",19,0)
 .I OO["U" N PSGORD,PSJORD,PSJNOO K DA D NOW^%DTC S PSGDT=%,T=$E("T",'PSJSYSU),PSGALR=20,PSGP=DFN,DA=+OO,DA(1)=PSGP,(PSGORD,PSJORD)=OO,PSJNOO=P("NAT") D
"RTN","PSIVOPT2",20,0)
 ..S CF=$S($P(PSJSYSP0,U,5):1,PSGORD["U":0,1:($P($G(^PS(53.1,+PSGORD,0)),U,25)=""&($P($G(^(4)),U,7)=DUZ)))  D ASET^PSGOEC,AC^PSGOEC
"RTN","PSIVOPT2",21,0)
 Q
"RTN","PSIVOPT2",22,0)
D1 N %,DA,DIE,DIU,STP,NSTOP
"RTN","PSIVOPT2",23,0)
 S NSTOP=$$DATE^PSJUTL2(),STP=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3),NSTOP=+$S(STP>NSTOP:NSTOP,1:STP),P(17)="D"
"RTN","PSIVOPT2",24,0)
 S DA(1)=DFN,DA=+ON55,DIE="^PS(55,"_DFN_",""IV"",",DR="109////"_NSTOP_$S('$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7):";116////"_STP,1:"")_";100///D;.03////"_NSTOP,PSIVACT=1 D ^DIE
"RTN","PSIVOPT2",25,0)
 I $S($G(PSIVAC)="OD":0,$G(PSIVAC)'="AD":1,$G(PSGALO)<1060:0,1:$P($G(PSJSYSW0),U,15)) S X=$S($G(PSIVAC)="AD":1,1:2) D ENLBL^PSIVOPT(X,$S(X=1:+$G(PSGUOW),1:DUZ),DFN,3,+ON55,$E("AD",1,3-X))
"RTN","PSIVOPT2",26,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF  ;* S ORIFN=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,21) Q:'ORIFN
"RTN","PSIVOPT2",27,0)
 Q
"RTN","PSIVOPT2",28,0)
 ;
"RTN","PSIVOPT2",29,0)
R ; Renew order.
"RTN","PSIVOPT2",30,0)
 ;I PSJCOM D RIV^PSJCOMR Q
"RTN","PSIVOPT2",31,0)
 I PSJCOM D ^PSJCOMR Q
"RTN","PSIVOPT2",32,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." I $G(ERR)<2 S COMQUIT=1 Q
"RTN","PSIVOPT2",33,0)
 NEW PSGORQF S PSIVRNFG=1 D ORDCHK^PSJLIFN K PSIVRNFG W !
"RTN","PSIVOPT2",34,0)
 I $G(PSGORQF) S COMQUIT=1 Q
"RTN","PSIVOPT2",35,0)
 ;
"RTN","PSIVOPT2",36,0)
R1 ;
"RTN","PSIVOPT2",37,0)
 I $$EXPIRED^PSGOER(DFN,ON55) D  Q
"RTN","PSIVOPT2",38,0)
 .W !?3,"  THIS ORDER HAS BEEN INACTIVE FOR ONE OR MORE SCHEDULED ADMINISTRATIONS"
"RTN","PSIVOPT2",39,0)
 .W !?20,"  AND CANNOT BE RENEWED!"
"RTN","PSIVOPT2",40,0)
 N PSJRNWDT,PSJOSTOP,OREASON S PSJRNWDT=$$DATE2^PSJUTL2(PSGDT),PSJOSTOP=P(3)
"RTN","PSIVOPT2",41,0)
 S (PSIVOK,EDIT)="25^1" S P2=P(2),P(2)=PSJRNWDT D EDIT^PSIVEDT S P(2)=P2 K P2 I X="^" Q
"RTN","PSIVOPT2",42,0)
 S P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+ON55,2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSIVOPT2",43,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSIVOPT2",44,0)
 S PSIVCHG=2
"RTN","PSIVOPT2",45,0)
 S P(17)="A",OREASON=P("RES"),P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSIVOPT2",46,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD Q
"RTN","PSIVOPT2",47,0)
 .S ON=ON55
"RTN","PSIVOPT2",48,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",P("RES")=OREASON D SET55^PSIVORFB
"RTN","PSIVOPT2",49,0)
 D:$P(^PS(55,DFN,"IV",+ON55,0),U,17)="A" RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSIVOPT2",50,0)
 I PSJIVORF,$P(^PS(55,DFN,"IV",+ON55,0),U,17)'="A" S X=$$LS^PSSLOCK(DFN,+ON55_"V") D
"RTN","PSIVOPT2",51,0)
 .D EXPOE^PSGOER(DFN,ON55)
"RTN","PSIVOPT2",52,0)
 .S P("RES")="R",PSJREN=1
"RTN","PSIVOPT2",53,0)
 .D ENUDTX^PSJOREN(DFN,ON55,"NR"),EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED"),UPDREN(DFN,ON55,PSJRNWDT,P(6),PSJOSTOP,P("NAT"))
"RTN","PSIVOPT2",54,0)
 S OD=P(2)
"RTN","PSIVOPT2",55,0)
 D VF1^PSJLIACT("","",1),UNL^PSSLOCK(DFN,+ON55_"V")
"RTN","PSIVOPT2",56,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSIVOPT2",57,0)
 I $G(PSJOSTOP),$G(ON55),$G(DFN) D STIX^PSIVOREN(PSJOSTOP,ON55,DFN)
"RTN","PSIVOPT2",58,0)
 Q
"RTN","PSIVOPT2",59,0)
 ;
"RTN","PSIVOPT2",60,0)
RD ; Delete for renew.
"RTN","PSIVOPT2",61,0)
 ;Q:'$G(PSJVFY)
"RTN","PSIVOPT2",62,0)
 ;D DEL55^PSIVORE2 S (ON55,P("OLDON"))=P("PON") D GT55^PSIVORFB
"RTN","PSIVOPT2",63,0)
 Q
"RTN","PSIVOPT2",64,0)
 ;
"RTN","PSIVOPT2",65,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVOPT2",66,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSIVOPT2",67,0)
 D ^PSIVCHK I $D(DUOUT) S X="^",COMQUIT=1 Q
"RTN","PSIVOPT2",68,0)
 I ERR=1 S X="N",COMQUIT=1 Q
"RTN","PSIVOPT2",69,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVOPT2",70,0)
 I $G(PSIVCHG),($G(PSIVREA)'="R") W !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVOPT2",71,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVOPT2",72,0)
 Q
"RTN","PSIVOPT2",73,0)
 ;
"RTN","PSIVOPT2",74,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSIVOPT2",75,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSIVOPT2",76,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSIVOPT2",77,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSIVOPT2",78,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSIVOPT2",79,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSIVOPT2",80,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSIVOPT2",81,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSIVOPT2",82,0)
 Q
"RTN","PSIVOPT2",83,0)
 ;
"RTN","PSIVOPT2",84,0)
UPDREN(DFN,ORD,RNWDT,PROV,OSTOPDT,PSJNOO) ;
"RTN","PSIVOPT2",85,0)
 Q:'DFN!'ORD!'RNWDT!'PROV!'OSTOPDT!(PSJNOO="")
"RTN","PSIVOPT2",86,0)
 K DR,DA,DIC,DIE,DD,DO N ND0,PSGOEORD
"RTN","PSIVOPT2",87,0)
 S DIC="^PS(55,"_DFN_",""IV"","_+ORD S ND0=$G(@(DIC_",0)")),PSGOEORD=$P(ND0,"^",21)
"RTN","PSIVOPT2",88,0)
 S DIC=DIC_",14,",DIC(0)="L",DIC("P")="55.1138DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=DFN,DA(1)=+ORD D
"RTN","PSIVOPT2",89,0)
 .S DIC("DR")=".01////"_$G(RNWDT)_";1////"_$G(DUZ)_";2////"_$G(PROV)_";3////"_$G(OSTOPDT)_";4////"_+PSGOEORD,X=$G(RNWDT) D FILE^DICN
"RTN","PSIVOPT2",90,0)
 .Q
"RTN","PSIVORA")
0^71^B28741555
"RTN","PSIVORA",1,0)
PSIVORA ;BIR/MLM-MAIN DRIVER FOR IV FLUIDS - OE/RR INTERFACE ;08 JAN 97 / 2:47 PM
"RTN","PSIVORA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,41,110**;16 DEC 97
"RTN","PSIVORA",3,0)
 ;
"RTN","PSIVORA",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVORA",5,0)
 ;
"RTN","PSIVORA",6,0)
EN ; Entry point called by IV Fluid protocol.
"RTN","PSIVORA",7,0)
 S X=ORACTION,PSIVAC="O"_$S(X=0:"N",X=1:"E",X=2:"R",X=4:"H",X=6:"D",X="8":"S",1:"") S:X'=5&(X'=7) PSIVUP=+$$GTPCI^PSIVUTL
"RTN","PSIVORA",8,0)
 S (PSGP,DFN)=+ORVP,PSJACNWP=1 D ^PSJAC I "578"[ORACTION D @ORACTION,DONE^PSIVORA1 Q
"RTN","PSIVORA",9,0)
 D ENCPP^PSIVOREN Q:'PSJIVORF!('PSJORF)  D EN1,DONE^PSIVORA1
"RTN","PSIVORA",10,0)
 Q
"RTN","PSIVORA",11,0)
 ;
"RTN","PSIVORA",12,0)
EN1 ; Take action on existing order.
"RTN","PSIVORA",13,0)
 S PSJORD=$G(ORPK) I ORGY>8 D @ORGY Q
"RTN","PSIVORA",14,0)
 I 'ORACTION D ^PSIVORFE Q
"RTN","PSIVORA",15,0)
 I '$G(ORPK) W !,"INSUFFICIENT INFORMATION, CANNOT CONTINUE." S OREND=1 Q
"RTN","PSIVORA",16,0)
 I ORPK["V",($P($G(^PS(55,DFN,"IV",+ORPK,0)),U,17)="O") D ONCALL^PSIVORV1 Q
"RTN","PSIVORA",17,0)
 I ORACTION<3 S P("FRES")=$S(ORPK["V":$P($G(^PS(55,DFN,"IV",+ORPK,2)),U,9),1:$P($G(^PS(53.1,+ORPK,0)),U,27)) I P("FRES")]"" D @$S(P("FRES")="R":"ALLREN^PSIVORV1",1:"ALLED^PSIVORV1") Q
"RTN","PSIVORA",18,0)
 S PSJORSTS=ORSTS,PSJORIFN=ORIFN L +@$S(PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD)",1:"^PS(53.1,+PSJORD)"):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",19,0)
 D @ORACTION L -@$S(PSJORD["V":"^PS(55,DFN,""IV"",+PSJORD)",1:"^PS(53.1,+PSJORD)")
"RTN","PSIVORA",20,0)
 Q
"RTN","PSIVORA",21,0)
 ;
"RTN","PSIVORA",22,0)
1 ; Edit an existing order.
"RTN","PSIVORA",23,0)
 D EDIT^PSIVORA1
"RTN","PSIVORA",24,0)
 Q
"RTN","PSIVORA",25,0)
 ;
"RTN","PSIVORA",26,0)
2 ; Renew
"RTN","PSIVORA",27,0)
 D RENEW^PSIVORA1
"RTN","PSIVORA",28,0)
 Q
"RTN","PSIVORA",29,0)
 ;
"RTN","PSIVORA",30,0)
3 ; Flag
"RTN","PSIVORA",31,0)
 Q
"RTN","PSIVORA",32,0)
 ;
"RTN","PSIVORA",33,0)
4 ; Hold
"RTN","PSIVORA",34,0)
 I ORSTS'=3,ORSTS'=6 W !,$C(7),"Only ACTIVE orders may be placed on HOLD." S OREND=1 Q
"RTN","PSIVORA",35,0)
 S PSIVREA=$S(ORSTS=6:"H",1:"U"),ON55=PSJORD,$P(^PS(55,DFN,"IV",+ON55,0),U,10)=$S(PSIVREA="H":1,1:""),Y=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(Y,U,3),P(17)=$P(Y,U,17)
"RTN","PSIVORA",36,0)
 D NOW^%DTC I ORSTS=3,P(3)<% S P(17)="E" D UPSTAT^PSIVOPT S ORSTS=7 W $C(7),"  This order has expired." Q
"RTN","PSIVORA",37,0)
 S XED=0,PSIVALT=2,P(17)=$S(PSIVREA="H":"H",1:"A") D UPSTAT^PSIVOPT,LOG^PSIVORAL S ORSTS=$S(PSIVREA="H":3,1:6)
"RTN","PSIVORA",38,0)
 Q
"RTN","PSIVORA",39,0)
 ;
"RTN","PSIVORA",40,0)
5 ; Event
"RTN","PSIVORA",41,0)
 N DA,DIE,DR,ON,P,PSIVACT,X
"RTN","PSIVORA",42,0)
 S ON=ORPK I ON["V" S X=$G(^PS(55,+ORVP,"IV",+ON,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17)
"RTN","PSIVORA",43,0)
 I ON'["V" S P(3)=$P($G(^PS(53.1,+ON,2)),U,4),P(17)=$P($G(^PS(53.1,+ON,0)),U,9)
"RTN","PSIVORA",44,0)
 Q:"AR"'[P(17)  D NOW^%DTC Q:P(3)>%
"RTN","PSIVORA",45,0)
 I ON["V" S DR="100///E",DIE="^PS(55,"_+ORVP_",""IV"",",DA(1)=+ORVP
"RTN","PSIVORA",46,0)
 I ON'["V" S DR="28///E",DIE="^PS(53.1,"
"RTN","PSIVORA",47,0)
 S PSIVACT=1,DA=+ON D ^DIE S ORSTS=7
"RTN","PSIVORA",48,0)
 Q
"RTN","PSIVORA",49,0)
 ;
"RTN","PSIVORA",50,0)
6 ; Cancel - Delete pending or unreleased orders from Nonverified orders
"RTN","PSIVORA",51,0)
 ; (53.1) and Orders (100) files.
"RTN","PSIVORA",52,0)
 I ORSTS=1 W $C(7),!,"This order has already been DISCONTINUED." Q
"RTN","PSIVORA",53,0)
 I ORSTS=7 W $C(7),!,"Expired orders cannot be DISCONTINUED." Q
"RTN","PSIVORA",54,0)
 I PSJORD'["V",ORSTS=11 D  Q
"RTN","PSIVORA",55,0)
 .S P("OLDON")=$P($G(^PS(53.1,+PSJORD,0)),U,25) I P("OLDON")  D
"RTN","PSIVORA",56,0)
 ..I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),2)) S PSJRES=$P(^(2),U,9) S:PSJRES'="R" $P(^(2),U,6)="",$P(^(2),U,9)="" ;; D:PSJRES="R" ENBKOUT^PSJOREN(DFN,PSJORD)
"RTN","PSIVORA",57,0)
 ..I P("OLDON")'["V",$D(^PS(53.1,+P("OLDON"),0)) S PSJRES=$P(^(0),U,27) S:PSJRES'="R" $P(^(0),U,26,27)="^" I PSJRES="R" ;; D ENBKOUT^PSJOREN(DFN,PSJORD)
"RTN","PSIVORA",58,0)
 .K DA,DIK S DIK="^PS(53.1,",DA=+PSJORD D ^DIK S PSGP=DFN,X="P" D ENSK^PSGAXR K DA,DIK S ORIFN=PSJORIFN,ORSTS="K" Q
"RTN","PSIVORA",59,0)
 ;
"RTN","PSIVORA",60,0)
DC ; DC order from Pharmacy complete function.
"RTN","PSIVORA",61,0)
 I PSJORD["V",'PSJCOM N PSIVREA S ON55=PSJORD,X=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17),PSIVREA="D",PSIVALT=2,PSIVALCK="STOP" D D^PSIVOPT2 D HL Q
"RTN","PSIVORA",62,0)
 I PSJORD["V",PSJCOM N PSIVREA S ON55=PSJORD,X=$G(^PS(55,DFN,"IV",+ON55,0)),P(3)=$P(X,U,3),P(17)=$P(X,U,17),PSIVREA="D",PSIVALT=2,PSIVALCK="STOP" D D^PSIVOPT2 Q
"RTN","PSIVORA",63,0)
 N DA,DR,DIE,PSJND S DA=+PSJORD,PSJND=$G(^PS(53.1,DA,0)),P("OLDON")=$P(PSJND,U,25),DIE="^PS(53.1,",DR="28///"_$S($P(PSJND,U,27)="E":"DE",1:"D") D ^DIE
"RTN","PSIVORA",64,0)
 D HL
"RTN","PSIVORA",65,0)
 Q
"RTN","PSIVORA",66,0)
HL ;
"RTN","PSIVORA",67,0)
 Q:'$D(P("NAT"))
"RTN","PSIVORA",68,0)
 ;D EN1^PSJHL2(DFN,"OC",PSJORD,"ORDER CANCELED")
"RTN","PSIVORA",69,0)
 NEW PSJCD,PSJTX
"RTN","PSIVORA",70,0)
 I PSJORD["P" N PSJNOO S PSJCD="OC",PSJTX="ORDER CANCELED",PSJNOO=$G(P("NAT"))
"RTN","PSIVORA",71,0)
 E  S PSJCD="OD",PSJTX="ORDER DISCONTINUED"
"RTN","PSIVORA",72,0)
 D EN1^PSJHL2(DFN,PSJCD,PSJORD,PSJTX)
"RTN","PSIVORA",73,0)
 ;D UNL^PSSLOCK(DFN,PSJORD)
"RTN","PSIVORA",74,0)
 Q
"RTN","PSIVORA",75,0)
 ;
"RTN","PSIVORA",76,0)
7 ; Purge
"RTN","PSIVORA",77,0)
 N ND S ND=$S(ORPK["V":$P($G(^PS(55,+ORVP,"IV",+ORPK,0)),U,17)_U_$P($G(^(0)),U,3),1:$P($G(^PS(53.1,+ORPK,0)),U,9)_U_$P($G(^(2)),U,4))
"RTN","PSIVORA",78,0)
 Q:"DE"'[$P(ND,U)  S X1=+$P(ND,U,2),X2=30 D C^%DTC S ND=X D NOW^%DTC Q:ND>%
"RTN","PSIVORA",79,0)
 I ORPK["V",$D(^PS(55,+ORVP,"IV",+ORPK,0)) S $P(^(0),U,21)=""
"RTN","PSIVORA",80,0)
 I ORPK'["V",$D(^PS(53.1,+ORPK,0)) S $P(^(0),U,21)=""
"RTN","PSIVORA",81,0)
 S ORSTS="K"
"RTN","PSIVORA",82,0)
 Q
"RTN","PSIVORA",83,0)
 ;
"RTN","PSIVORA",84,0)
8 ; Print
"RTN","PSIVORA",85,0)
 K DIR S DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!'($D(ORPK)) S OREND=1 Q
"RTN","PSIVORA",86,0)
 S:'$G(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL S:'$D(PSIVAC) PSIVAC="OS" S (ON,ON55)=ORPK,DFN=+ORVP D @$S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON_""")"),ENDT^PSIVORV1
"RTN","PSIVORA",87,0)
 Q
"RTN","PSIVORA",88,0)
 ;
"RTN","PSIVORA",89,0)
9 ; Release order (status=incomplete in 53.1, pending in 100)
"RTN","PSIVORA",90,0)
 S X=ORACTION I X=4!(X=6) D @ORACTION Q
"RTN","PSIVORA",91,0)
 Q:"36"[ORSTS  N ON,PSJORIFN S PSJORIFN=ORIFN,ON=ORPK L +^PS(53.1,+ON):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",92,0)
 S Y=$G(^PS(53.1,+ON,0)),P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25)
"RTN","PSIVORA",93,0)
 N DA,DIE,DR,OREND S DR="28////P",DIE="^PS(53.1,",DA=+ON D ^DIE
"RTN","PSIVORA",94,0)
 I P("OLDON")]"" K DA,DIE,DR S DA=P("OLDON") D
"RTN","PSIVORA",95,0)
 .I DA["V" S DA(1)=+ORPV,DIE="^PS(55,"_DA(1)_",""IV"",",DR="114////"_+ON_"P"_";123////"_P("RES")
"RTN","PSIVORA",96,0)
 .E  S DIE="^PS(53.1,",DR="105////"_ON_"P"_";107////"_P("RES") I P("RES")="E",$P($G(^PS(53.1,+P("OLDON"),0)),U,9)="D" S DR=DR_";28////DE"
"RTN","PSIVORA",97,0)
 .S DA=+DA L +@(DIE_DA_")"):1 E  D LOCKERR^PSIVORA1 Q
"RTN","PSIVORA",98,0)
 .D ^DIE L -@(DIE_DA_")")
"RTN","PSIVORA",99,0)
 L -^PS(53.1,+ON) D DONE^PSIVORA1
"RTN","PSIVORA",100,0)
 Q
"RTN","PSIVORA",101,0)
 ;
"RTN","PSIVORA",102,0)
10 ; Verify
"RTN","PSIVORA",103,0)
 Q
"RTN","PSIVORA1")
0^95^B17240582
"RTN","PSIVORA1",1,0)
PSIVORA1 ;BIR/MLM-UTILITIES FOR IV FLUIDS - OE/RR INTERFACE (CONT) ;05 FEB 97 / 1:30 PM
"RTN","PSIVORA1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,110**;16 DEC 97
"RTN","PSIVORA1",3,0)
 ;
"RTN","PSIVORA1",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSIVORA1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVORA1",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSIVORA1",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSIVORA1",8,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVORA1",9,0)
 ;
"RTN","PSIVORA1",10,0)
LOCKERR ; Display msg. if lock is unsuccessful.
"RTN","PSIVORA1",11,0)
 W $C(7),!!,"This order is being edited by another user." S OREND=1
"RTN","PSIVORA1",12,0)
 Q
"RTN","PSIVORA1",13,0)
 ;
"RTN","PSIVORA1",14,0)
EDIT ; Edit an existing order.
"RTN","PSIVORA1",15,0)
 I ORSTS=3 W !,$C(7),"Order must be removed from HOLD before editing." S OREND=1 Q
"RTN","PSIVORA1",16,0)
 I ORSTS=7 W !,$C(7),"Expired orders cannot be edited." S OREND=1 Q
"RTN","PSIVORA1",17,0)
 D NEWENT^PSIVORFE S ON=ORPK S:ON["V" ON55=+ON D @$S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA("_DFN_","""_ON_""")") F X=2,3,9,11,"IVRM" S P(X)=""
"RTN","PSIVORA1",18,0)
 S P("RES")=$S(ORSTS=11:P("RES"),1:"E")
"RTN","PSIVORA1",19,0)
 I "EN"[P("RES") S (PSIVOK,EDIT)="57^58^59^1^66"
"RTN","PSIVORA1",20,0)
 E  D REDIT
"RTN","PSIVORA1",21,0)
 N DONE S PSJORNP=+P(6) K ON55 D ENED^PSIVORV1,GTFLDS^PSIVORFE I $G(DONE) S OREND=1 Q
"RTN","PSIVORA1",22,0)
 I PSJORSTS=11 W !,"...updating order..." D UPD100^PSIVORFA,PUT531^PSIVORFA Q
"RTN","PSIVORA1",23,0)
 S P("LOG")=$$DATE^PSJUTL2(),P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U)
"RTN","PSIVORA1",24,0)
 W !,"...creating new order..." S P(17)="U",P("OLDON")=$S(PSJORSTS=5:+ON_"P",1:+ON_"V") D ENGNN^PSGOETO S ON=DA D SET^PSIVORFE D PUT531^PSIVORFA
"RTN","PSIVORA1",25,0)
 I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),2)) S $P(^(2),U,6)=ON_"U",$P(^(2),U,9)="E" Q
"RTN","PSIVORA1",26,0)
 I P("OLDON")'["V",$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON_"U"_U_"E"
"RTN","PSIVORA1",27,0)
 Q
"RTN","PSIVORA1",28,0)
 ;
"RTN","PSIVORA1",29,0)
RENEW ;Renew order through OE/RR.
"RTN","PSIVORA1",30,0)
 I $S(ORSTS=6:0,ORSTS=7:0,1:1) W !,$C(7),"Only ACTIVE OR EXPIRED orders may be RENEWED." S OREND=1 Q
"RTN","PSIVORA1",31,0)
 S ON=ORPK D GT55^PSIVORFB,REDIT
"RTN","PSIVORA1",32,0)
 K ON55 S P(17)="U",P("OLDON")=ON F X=2,3,"IVRM","MR" S P(X)=""
"RTN","PSIVORA1",33,0)
 D ENED^PSIVORV1,NEWENT^PSIVORFE,EDIT^PSIVEDT W !,"...creating new order..." D ENGNN^PSGOETO S ON=DA_"P",P("RES")="R",P("FRES")="" D SET^PSIVORFE D PUT531^PSIVORFA
"RTN","PSIVORA1",34,0)
 S $P(^PS(55,DFN,"IV",+P("OLDON"),2),U,6)=ON,$P(^(2),U,9)="R"
"RTN","PSIVORA1",35,0)
 S P("NEWON")=ON,(ON,ON55)=P("OLDON"),P("FRES")="R",P("RES")="" K ORETURN D RUPTXT^PSIVOREN(DFN,ON)
"RTN","PSIVORA1",36,0)
 Q
"RTN","PSIVORA1",37,0)
 ;
"RTN","PSIVORA1",38,0)
REDIT ; Set edit string for OE/RR renew.
"RTN","PSIVORA1",39,0)
 S X=$G(^VA(200,+DUZ,"PS")),EDIT=$S('X:"1^",'$P(X,U,4):"",$P(X,U,4)<DT:"1^",1:"")_66,PSIVOK=EDIT S:$P(EDIT,U)'=1 P(6)=DUZ_U_$P($G(^VA(200,DUZ,0)),U)
"RTN","PSIVORA1",40,0)
 Q
"RTN","PSIVORA1",41,0)
 ;
"RTN","PSIVORA1",42,0)
FLUIDQO ; Process IV Fluid quick order.
"RTN","PSIVORA1",43,0)
 N PSIVAC,PSIVOK,EDIT,DRG,ND,PSJQOD,P,PSJORNP,PSJORL S PSIVAC="ON",PSJORNP=$G(ORNP) D PS^PSIVOREN Q:PSJORPF
"RTN","PSIVORA1",44,0)
 D SETUP^PSIVORFE S P("MR")="IV"_U_$O(^PS(51.2,"C","IV",0)),DFN=+ORVP
"RTN","PSIVORA1",45,0)
 F DRG("SC")=3,4 S DRG("TYP")=$S(DRG("SC")=3:"AD",1:"SOL"),DRG(DRG("TYP"),0)=0 I $D(^PS(57.1,PSJQO,DRG("SC"))) F PSJQOD=0:0 S PSJQOD=$O(^PS(57.1,PSJQO,DRG("SC"),PSJQOD)) Q:'PSJQOD  D
"RTN","PSIVORA1",46,0)
 .S ND=$G(^PS(57.1,PSJQO,DRG("SC"),PSJQOD,0)),DRG(1)=+ND,DRG(3)=$P(ND,U,2)
"RTN","PSIVORA1",47,0)
 .S ND=$G(^PS($S(DRG("SC")=3:52.6,1:52.7),DRG(1),0)),DRG(2)=$P(ND,U),DRG(5)=$P(ND,U,13),DRG(6)=$P(ND,U,11)
"RTN","PSIVORA1",48,0)
 .S DRG(DRG("TYP"),0)=DRG(DRG("TYP"),0)+1,DRG(DRG("TYP"),DRG(DRG("TYP"),0))=DRG(1)_U_DRG(2)_U_DRG(3)_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORA1",49,0)
 S PSIVUP=+$$GTPCI^PSIVUTL
"RTN","PSIVORA1",50,0)
 ;K ^PS(53.45,PSIVUP,4) I $O(^PS(57.1,PSJQO,2,0)) S %X="^PS(57.1,"_+PSJQO_",2,",%Y="^PS(53.45,"_PSIVUP_",4," D %XY^%RCR
"RTN","PSIVORA1",51,0)
 S X=$G(^PS(57.1,+PSJQO,1)),P(8)=$P(X,U,5),PSGPCP=$P(X,U,6),(EDIT,PSIVOK)=$S(('PSGPCP&(P(8)="")):"59^66",P(8)="":"59",'PSGPCP:"66",1:"")
"RTN","PSIVORA1",52,0)
 S PSJORL=ORL,ORSTS=11 I EDIT'="" D ENED^PSIVORV1,EDIT^PSIVEDT Q:DONE
"RTN","PSIVORA1",53,0)
 K DA,DIC,ON,P("OLDON") W !!,"...transcribing this order..." D ENGNN^PSGOETO S ON=DA D NEWENT^PSIVORFE,SET^PSIVORFE D PUT531^PSIVORFA L -^PS(53.1,+ON) W !
"RTN","PSIVORA1",54,0)
 Q
"RTN","PSIVORA1",55,0)
 ;
"RTN","PSIVORA1",56,0)
DONE ; Kill variables and exit
"RTN","PSIVORA1",57,0)
 K AD,C,DO,DFN,DRG,I,NN,P,PSGP,PSJACNWP,PSIVAC,PSIVE,PSIVLOG,PSIVREA,PSIVUP,PSIVX,PSJIVORF,PSJORL,PSJORPF,PSJORNP,PSJORSTS,SOL,SPSOL,UL80 D ENIVKV^PSGSETU
"RTN","PSIVORA1",58,0)
 Q
"RTN","PSIVORC")
0^61^B22263402
"RTN","PSIVORC",1,0)
PSIVORC ;BIR/MLM-COMPLETE IV ORDERS ENTERED THROUGH OE/RR ;02 Mar 99 / 10:16 AM
"RTN","PSIVORC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,53,80,110**;16 DEC 97
"RTN","PSIVORC",3,0)
 ;
"RTN","PSIVORC",4,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039
"RTN","PSIVORC",5,0)
 ; Reference to ^DPT is supported by DBIA 10035
"RTN","PSIVORC",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000
"RTN","PSIVORC",7,0)
 ; Reference to ^DID is supported by DBIA 2052
"RTN","PSIVORC",8,0)
 ;
"RTN","PSIVORC",9,0)
EN ; Set IV parameters.
"RTN","PSIVORC",10,0)
 D SITE^PSIVORE Q:'$G(PSIVQ)  K PSIVQ
"RTN","PSIVORC",11,0)
 ;
"RTN","PSIVORC",12,0)
SELECT ;
"RTN","PSIVORC",13,0)
 F  S PSGSSH="ORVC" D ^PSGSEL Q:U[PSGSS  D GTORDRS
"RTN","PSIVORC",14,0)
 D DONE^PSIVORC1
"RTN","PSIVORC",15,0)
 Q
"RTN","PSIVORC",16,0)
GTORDRS ;
"RTN","PSIVORC",17,0)
 K ^TMP("PSIV",$J) N DIC,Y D @PSGSS Q:+$G(Y)'>0  W:PSGSS'="P" !,"...a few moments, please..." D @("G"_PSGSS)
"RTN","PSIVORC",18,0)
 I $G(Y),'$D(^TMP("PSIV",$J)) W !,$C(7),"NO PENDING ORDERS FOR ",$S(PSGSS="P":"PATIENT",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSIVORC",19,0)
 D NOW^%DTC S HDT=$$ENDTC^PSGMI(%),PSIVAC="C",DONE=0,WDN=""
"RTN","PSIVORC",20,0)
 F  S WDN=$O(^TMP("PSIV",$J,WDN)) Q:WDN=""!DONE  S PNME="" F  S PNME=$O(^TMP("PSIV",$J,WDN,PNME)) Q:PNME=""!DONE  D
"RTN","PSIVORC",21,0)
 . I PSGSS'="P" S PSGDFN=$P(PNME,";",2)_"^"_$P(PNME,";") D CHK^PSJDPT(.PSGDFN,1,1) I PSGDFN=-1 Q
"RTN","PSIVORC",22,0)
 . D PROFILE D:PSIVHD ASK
"RTN","PSIVORC",23,0)
 D:$G(PSIVHD) ASK
"RTN","PSIVORC",24,0)
 Q
"RTN","PSIVORC",25,0)
 ;
"RTN","PSIVORC",26,0)
PROFILE ; Display profile of all incomplete orders.
"RTN","PSIVORC",27,0)
 ;
"RTN","PSIVORC",28,0)
 K PSGODDD S (DFN,PSGP)=$P(PNME,";",2) D ENBOTH^PSJAC
"RTN","PSIVORC",29,0)
 S RB=PSJPRB,PG=1,PSJORL=$$ENORL^PSJUTL($G(VAIN(4))),PSJIVOF=PSJORL,PSGLMT=0,LN2="" D ENHEAD^PSJO3
"RTN","PSIVORC",30,0)
 S (DONE1,TYP)="" F  S TYP=$O(^TMP("PSIV",$J,WDN,PNME,TYP)) Q:TYP=""!(DONE1)  D:$Y+5'>IOSL GTYP F ON1=0:0 S ON1=$O(^TMP("PSIV",$J,WDN,PNME,TYP,ON1)) Q:'ON1!(DONE1)  D DISPLAY
"RTN","PSIVORC",31,0)
 Q
"RTN","PSIVORC",32,0)
 ;
"RTN","PSIVORC",33,0)
DISPLAY ; Display order on profile.
"RTN","PSIVORC",34,0)
 I $Y+5>IOSL D ASK Q:DONE1  D ENHEAD^PSJO3,GTYP
"RTN","PSIVORC",35,0)
 S PSIVHD=1,PSGLMT=PSGLMT+1,PSIVCV(PSGLMT)=ON1,PSJC="" W !?3,PSGLMT D PIV^PSIVUTL(+ON1_"P")
"RTN","PSIVORC",36,0)
 Q
"RTN","PSIVORC",37,0)
 ;
"RTN","PSIVORC",38,0)
GTYP ; Get formatted heading for type
"RTN","PSIVORC",39,0)
 N PSJD5314 D FIELD^DID(53.1,4,"","POINTER","PSJD5314")
"RTN","PSIVORC",40,0)
 ; removed ^DD ref 3-2-99, pass ^^_set of codes value
"RTN","PSIVORC",41,0)
 ; because codes^psivutl uses the 3rd piece
"RTN","PSIVORC",42,0)
 ;S X=$$CODES^PSIVUTL(TYP,"^^"_PSJD5314("POINTER")),PSIV=$S(X]"":X,1:"UNKNOWN"),X="",$P(X,"-",40-($L(PSIV)/2))="" W !,X_PSIV_X
"RTN","PSIVORC",43,0)
 S X=$$CODES^PSIVUTL(TYP,"^^"_PSJD5314("POINTER"),"")
"RTN","PSIVORC",44,0)
 S PSIV=$S(X]"":X,1:"UNKNOWN"),X="",$P(X,"-",40-($L(PSIV)/2))="" W !,X_PSIV_X
"RTN","PSIVORC",45,0)
 Q
"RTN","PSIVORC",46,0)
 ;
"RTN","PSIVORC",47,0)
ASK ; Ask which orders to view.
"RTN","PSIVORC",48,0)
 S PSIVHD=0,ACTION="ORDER" D RD1^PSGON I X="^" S (DONE,DONE1)=1 Q
"RTN","PSIVORC",49,0)
 Q:'$D(PSGODDD)  S DONE1=0 F PN=1:1:$L(PSGODDD(1),",")-1 S ON=+$P(PSGODDD(1),",",PN) Q:ON=""!DONE1  S ON=+$P(PSGODDD(1),",",PN) D SHOW
"RTN","PSIVORC",50,0)
 S DONE1=1,PSGOP=DFN D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVORC",51,0)
 Q
"RTN","PSIVORC",52,0)
 ;
"RTN","PSIVORC",53,0)
SHOW ; Display selected order and prompt for action
"RTN","PSIVORC",54,0)
 S (P("PON"),ON)=PSIVCV(ON)
"RTN","PSIVORC",55,0)
 ;
"RTN","PSIVORC",56,0)
SHOW1 ; Entry point from backdoor.
"RTN","PSIVORC",57,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON) I $G(PSIVAC)="PRO" D ENNONUM^PSIVORV2(DFN,ON) Q
"RTN","PSIVORC",58,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSIVORC",59,0)
 S PSJORD=+ON D ^PSJLIFN
"RTN","PSIVORC",60,0)
 Q
"RTN","PSIVORC",61,0)
 ;
"RTN","PSIVORC",62,0)
 ; look-ups on ward group, ward, or patient; depending on value of SS
"RTN","PSIVORC",63,0)
G S DIC="^PS(57.5,",DIC(0)="QEAMI",DIC("A")="Select WARD GROUP: " W ! D ^DIC S:+Y>0 WG=+Y Q
"RTN","PSIVORC",64,0)
W S DIC="^DIC(42,",DIC(0)="QEAMI",DIC("A")="Select WARD: " W ! D ^DIC S:+Y>0 WD=+Y Q
"RTN","PSIVORC",65,0)
P D ENGETP^PSIV Q:DFN<0  S Y=1 I $D(^PS(53.1,"AS","P",+DFN)) S PNME=$G(^DPT(+DFN,0)),PNME=$P(PNME,U)_";"_DFN,WDN=$S(VAIN(4)]"":$P(VAIN(4),U,2),1:"OUTPATIENT") D GP
"RTN","PSIVORC",66,0)
 Q
"RTN","PSIVORC",67,0)
 ;
"RTN","PSIVORC",68,0)
GG ; put patient(s) with incomplete orders into array
"RTN","PSIVORC",69,0)
 F WD=0:0 S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D GW
"RTN","PSIVORC",70,0)
 Q
"RTN","PSIVORC",71,0)
GW S WDN=$G(^DIC(42,WD,0)),WDN=$P(WDN,U) I WDN]"" F DFN=0:0 S DFN=$O(^DPT("CN",WDN,DFN)) Q:'DFN  I $D(^PS(53.1,"AS","P",DFN)) S Y=$G(^DPT(+DFN,0)),PNME=$P(Y,U)_";"_DFN D:PNME]"" GP
"RTN","PSIVORC",72,0)
 Q
"RTN","PSIVORC",73,0)
GP ;
"RTN","PSIVORC",74,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",DFN,ON)) Q:'ON  S Y=$G(^PS(53.1,ON,0)),TYP=$S($P(Y,U,4)]"":$P(Y,U,4),1:"Z"),^TMP("PSIV",$J,WDN,PNME,TYP,ON)=""
"RTN","PSIVORC",75,0)
 Q
"RTN","PSIVORC",76,0)
DISCONT ; Cancel incomplete order
"RTN","PSIVORC",77,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) W !,$C(7),"Order Unchanged." Q
"RTN","PSIVORC",78,0)
 ;Prompt for requesting provider
"RTN","PSIVORC",79,0)
 W ! I '$$REQPROV^PSGOEC W !,$C(7),"Order Unchanged." Q
"RTN","PSIVORC",80,0)
 W !
"RTN","PSIVORC",81,0)
 ;
"RTN","PSIVORC",82,0)
 ;* N PSJORNAT S (PSJORIFN,ORIFN)=$P($G(^PS(53.1,+ON,0)),U,21),PSJORD=ON,PSJORNAT=P("NAT") D DC^PSIVORA ;* I PSJIVORF,PSJORIFN,(ON["V") D EN1^PSJHL2(PSGP,"OD",+ON_"V","ORDER DISCONTINUED")
"RTN","PSIVORC",83,0)
 I 'PSJCOM N PSJORNAT S PSJORIFN=$P($G(^PS(53.1,+ON,0)),U,21),PSJORD=ON,PSJORNAT=P("NAT") D DC^PSIVORA ;* I PSJIVORF,PSJORIFN,(ON["V") D EN1^PSJHL2(PSGP,"OD",+ON_"V","ORDER DISCONTINUED")
"RTN","PSIVORC",84,0)
 I PSJCOM,PSJORD["P" N O S O="" F  S O=$O(^PS(53.1,"ACX",PSJCOM,O)) Q:O=""  D
"RTN","PSIVORC",85,0)
 .S ON=O_"P",PSJORIFN=$P($G(^PS(53.1,+ON,0)),U,21),PSJORD=ON,PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC",86,0)
 W !,"Order discontinued.",!
"RTN","PSIVORC",87,0)
 Q
"RTN","PSIVORC",88,0)
 ;
"RTN","PSIVORC",89,0)
EDIT ; Edit incomplete order
"RTN","PSIVORC",90,0)
 S PSIVAC="CE" L +^PS(53.1,+ON):1 E  W !,$C(7),"This order LOCKED by another user." Q
"RTN","PSIVORC",91,0)
 D EDIT^PSIVORC2 L -^PS(53.1,+ON)
"RTN","PSIVORC",92,0)
 Q
"RTN","PSIVORC",93,0)
 ;
"RTN","PSIVORC",94,0)
FINISH ; Finish incomplete order
"RTN","PSIVORC",95,0)
 S PSIVAC="CF" L +^PS(53.1,+ON):1 E  W !,$C(7),"This order LOCKED by another user." Q
"RTN","PSIVORC",96,0)
 D FINISH^PSIVORC2 L -^PS(53.1,+ON)
"RTN","PSIVORC",97,0)
 Q
"RTN","PSIVORC1")
0^127^B33400994
"RTN","PSIVORC1",1,0)
PSIVORC1 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;13 Jan 98 / 11:36 AM
"RTN","PSIVORC1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,37,69,110**;16 DEC 97
"RTN","PSIVORC1",3,0)
 ;
"RTN","PSIVORC1",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVORC1",5,0)
 ; Reference to ^DD( is supported by DBIA 2255.
"RTN","PSIVORC1",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVORC1",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSIVORC1",8,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSIVORC1",9,0)
 ; Reference to ^DID is supported by DBIA 2052.
"RTN","PSIVORC1",10,0)
 ; Reference to ^VALM is supported by DBIA 10118.
"RTN","PSIVORC1",11,0)
 ;
"RTN","PSIVORC1",12,0)
53 ; IV Type
"RTN","PSIVORC1",13,0)
 ;*S DONE=0 N DIR S DIR(0)="SNA^A:ADMIXTURE;C:CHEMOTHERAPY;"_$S($E(PSIVAC)'["C":"H:HYPERAL;",1:"")_"P:PIGGYBACK;S:SYRINGE",DIR("A")="IV TYPE: "
"RTN","PSIVORC1",14,0)
 S DONE=0 N DIR S DIR(0)="SNA^A:ADMIXTURE;C:CHEMOTHERAPY;H:HYPERAL;P:PIGGYBACK;S:SYRINGE",DIR("A")="IV TYPE: "
"RTN","PSIVORC1",15,0)
 I $G(P("RES"))'="R" S:P(4)]"" DIR("B")="ADMIXTURE",P(4)=""
"RTN","PSIVORC1",16,0)
 D DIRQ,^DIR S:$D(DTOUT)!(X="^") DONE=1 Q:DONE  G:$E(X)="^" 53 S P(4)=Y D:"CS"[P(4) @P(4)
"RTN","PSIVORC1",17,0)
 I PSIVAC'="PN" D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC1",18,0)
OTYP ; Get order type, display type.
"RTN","PSIVORC1",19,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3) S:PSIVAC'="CF" P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I")
"RTN","PSIVORC1",20,0)
 Q
"RTN","PSIVORC1",21,0)
 ;
"RTN","PSIVORC1",22,0)
C ; Edit Chemo order
"RTN","PSIVORC1",23,0)
 N DIR S DIR(0)="SA^A:ADMIXTURE;P:PIGGYBACK;S:SYRINGE",DIR("A")="CHEMOTHERAPY TYPE: " D DIRQ,^DIR S:$D(DTOUT)!(X=U) DONE=1 Q:$E(X)="^"!(DONE)  S P(23)=Y D:P(23)["S" S
"RTN","PSIVORC1",24,0)
 Q
"RTN","PSIVORC1",25,0)
 ;
"RTN","PSIVORC1",26,0)
S ; Edit Syringe order
"RTN","PSIVORC1",27,0)
56 ; Intermittent Syringe
"RTN","PSIVORC1",28,0)
 N DIR S DIR(0)="Y",DIR("??")="^S F1=53.1,F2=56 D ENHLP^PSIVORC1",DIR("A")="INTERMITTENT SYRINGE" D ^DIR Q:$D(DIRUT)  S P(5)=Y
"RTN","PSIVORC1",29,0)
 ;
"RTN","PSIVORC1",30,0)
55 ; Syringe Size
"RTN","PSIVORC1",31,0)
 N DA,DIR S DIR(0)="53.1,55" D ^DIR I $D(DTOUT)!$D(DUOUT) S DONE=1 Q
"RTN","PSIVORC1",32,0)
 S P("SYRS")=Y
"RTN","PSIVORC1",33,0)
 Q
"RTN","PSIVORC1",34,0)
 ;
"RTN","PSIVORC1",35,0)
DIRQ ; Set DIR("?") for IV Type prompt.
"RTN","PSIVORC1",36,0)
 S DIR("?")="Enter a code from the list above.",DIR("??")="^S F1=55.01,F2="_$S(DIR("A")["CHEMO":106,1:.04)_" D ENHLP^PSIVORC1"
"RTN","PSIVORC1",37,0)
 S DIR("?",1)="CHOOSE FROM:",Y=$P(DIR(0),U,2) F X=1:1:5 S DIR("?",X+1)="              "_$P($P(Y,";",X),":")_"    "_$P($P(Y,";",X),":",2)
"RTN","PSIVORC1",38,0)
 Q
"RTN","PSIVORC1",39,0)
 ;
"RTN","PSIVORC1",40,0)
CKFLDS ; Find required fields missing data.
"RTN","PSIVORC1",41,0)
 NEW PSIVASX,PSIVASY,FIL,DRGTMP
"RTN","PSIVORC1",42,0)
 S EDIT="" F PSIVASX="AD","SOL" D
"RTN","PSIVORC1",43,0)
 .I '$D(DRG(PSIVASX)) S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58) Q
"RTN","PSIVORC1",44,0)
 .S DNE=0 F PSIVASY=0:0 S PSIVASY=$O(DRG(PSIVASX,PSIVASY)) Q:'PSIVASY!DNE  D
"RTN","PSIVORC1",45,0)
 .. I $P(DRG(PSIVASX,PSIVASY),U,3)="" S EDIT=EDIT_U_$S(PSIVASX="AD":57,1:58),DNE=1
"RTN","PSIVORC1",46,0)
 .. ;S FIL=$S(PSIVASX="AD":"52.6",1:"52.7")
"RTN","PSIVORC1",47,0)
 .. ;S DRGTMP=DRG(PSIVASX,PSIVASY) D ORDERCHK^PSIVEDRG(DFN)
"RTN","PSIVORC1",48,0)
 S:'P("MR") EDIT=EDIT_U_3 F X=8,6,2,3 I P(X)="" S EDIT=EDIT_U_$S(X=8:59,X=6:1,X=2:10,X=3:25,1:"")
"RTN","PSIVORC1",49,0)
 I P("DTYP")=1 S:P(9)="" EDIT=EDIT_U_26 S:P(11)="" EDIT=EDIT_U_39
"RTN","PSIVORC1",50,0)
 S:$E(EDIT,1)=U EDIT=$E(EDIT,2,999)
"RTN","PSIVORC1",51,0)
 Q
"RTN","PSIVORC1",52,0)
 ;
"RTN","PSIVORC1",53,0)
DONE ; Kill variables and exit
"RTN","PSIVORC1",54,0)
 K ACTION,AD,DFN,DNE,DONE,DONE1,DRG,DRGI,DRGN,DRGT,DRGTN,EDIT,ERR,F1,F2,FIL,HDT,J,LN,LN2,ND,ON,ON1,ON55,ORIFN,P,P16,PC,PDM,PG,PN,PNME,PNOW,PSGLMT,PSGODDD
"RTN","PSIVORC1",55,0)
 K PSGSS,PSGSSH,PSIV,PSIVAC,PSIVAT,PSIVCV,PSIVE,PSIVHD,PSIVLN,PSIVOK,PSIVOLD,PSIVORUT,PSIVREA,PSIVSC1,PSIVSTR,PSIVSTRT,PSIVTYPE,PSIVUP,PSIVX,PSIVX1
"RTN","PSIVORC1",56,0)
 K PSJIVORF,PSJORF,PSJORIFN,PSJORL,PSJORNP,PSJORPF,PSJORSTS,PSJIVOF,PSJNKF,PSJORD,RB,RF,SOL,STOP,TYP,UL80,WD,WDN,WG,^TMP("PSIV",$J) D ENIVKV^PSGSETU
"RTN","PSIVORC1",57,0)
 Q
"RTN","PSIVORC1",58,0)
ENHLP ; order entry fields' help
"RTN","PSIVORC1",59,0)
 N PSJHP,PSJX,PSJD
"RTN","PSIVORC1",60,0)
 ;
"RTN","PSIVORC1",61,0)
 D FIELD^DID(F1,F2,"","HELP-PROMPT","PSJHP")
"RTN","PSIVORC1",62,0)
 I X="?",$D(PSJHP("HELP-PROMPT")) S F=$G(PSJHP("HELP-PROMPT")) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSIVORC1",63,0)
 ;I X="?",$D(^DD(F1,F2,3)) S F=^(3) W !?5 F F0=1:1:$L(F," ") S F3=$P(F," ",F0) W:$L(F3)+$X>78 !?5 W F3_" "
"RTN","PSIVORC1",64,0)
 ;
"RTN","PSIVORC1",65,0)
 W:$D(^DD(F1,F2,12)) !,"("_^(12)_")" D FIELD^DID(F1,F2,"","XECUTABLE HELP","PSJX") I $D(PSJX("XECUTABLE HELP")) X PSJX("XECUTABLE HELP")
"RTN","PSIVORC1",66,0)
 ;
"RTN","PSIVORC1",67,0)
 ; new code
"RTN","PSIVORC1",68,0)
 D FIELD^DID(F1,F2,"","DESCRIPTION","PSJD")
"RTN","PSIVORC1",69,0)
 G:$S($G(X)="?":1,1:'$O(PSJD("DESCRIPTION",0))) SC F F=0:0 S F=$O(PSJD("DESCRIPTION",F)) Q:'F  I $D(PSJD("DESCRIPTION",F)) W !?2,PSJD("DESCRIPTION",F)
"RTN","PSIVORC1",70,0)
SC ;
"RTN","PSIVORC1",71,0)
 I F2=5!(F2=6) W !,"CHOOSE FROM:",!?8,0,?16,"NO",!?8,1,?16,"YES" Q
"RTN","PSIVORC1",72,0)
 Q
"RTN","PSIVORC1",73,0)
COMPLTE ;
"RTN","PSIVORC1",74,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) D ^PSIVCHK I $D(DUOUT) W $C(7),!,"Order Unchanged.",! Q
"RTN","PSIVORC1",75,0)
 G:'$D(PSIVFN1) EDIT1
"RTN","PSIVORC1",76,0)
 I ERR=1 S Y=0 G EDIT1
"RTN","PSIVORC1",77,0)
 D CKORD^PSIVORC2 I PSIVCHG D NOW^%DTC S P("LOG")=$E(%,1,12),P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U),P("INS")=""
"RTN","PSIVORC1",78,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2)
"RTN","PSIVORC1",79,0)
 W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORC1",80,0)
EDIT ;
"RTN","PSIVORC1",81,0)
 I ERR=1 W !,"Please re-edit this order" K DIR S DIR(0)="E" D ^DIR K DIR W:'Y $C(7),"order unchanged." Q:'Y  S Y=0 G EDIT1
"RTN","PSIVORC1",82,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORC1",83,0)
 K DIR S DIR(0)="Y",DIR("A")="Is this O.K.",DIR("B")=$S(ERR:"NO",1:"YES"),DIR("?",1)="Enter ""Y"" to make this an active order (only allowed if no errors were"
"RTN","PSIVORC1",84,0)
 S DIR("?")="found in order), ""N"" to edit the order, or ""^"" to leave order unchanged.",DIR("??")="^S HELP=""EDIT"" D ^PSIVHLP"
"RTN","PSIVORC1",85,0)
 D ^DIR K DIR I $D(DIRUT) K DIRUT W $C(7),"Order unchanged." Q
"RTN","PSIVORC1",86,0)
 ;*  Kill Unit dose variables when calling from ^PSJLIFNI.
"RTN","PSIVORC1",87,0)
 I +Y,$G(PSJLIFNI) D
"RTN","PSIVORC1",88,0)
 . K ND,ND4,ND6,NDP2
"RTN","PSIVORC1",89,0)
 . K PSGAT,PSGCANFL,PSGDI,PSGDO,PSGDT,PSGEB,PSGEBN,PSGEFN,PSGFD,PSGFDN
"RTN","PSIVORC1",90,0)
 . K PSGHSM,PSGLI,PSGLIN,PSGLMT,PSGMR,PSGMRN,PSGNEDFD,PSGNEF,PSGNEFD
"RTN","PSIVORC1",91,0)
 . K PSGNESD,PSGOAT,PSGODO,PSGODT,PSGEA,PSGOEAV,PSGOEEF
"RTN","PSIVORC1",92,0)
 . K PSGOEEWF,PSGOEEG,PSGOEF,PSGOENG,PSGOES,PSGOFD,PSGOFDN,PSGOHSM
"RTN","PSIVORC1",93,0)
 . K PSGOINST,PSGOMR,PSGOMRN,PSGONC
"RTN","PSIVORC1",94,0)
 . K PSGOPD,PSOPDN,PSGOPR,PSGOPRN,PSGOSD,PSGOSDN,PSGOSI,PSGOSM
"RTN","PSIVORC1",95,0)
 . K PSGOST,PSGOSTN
"RTN","PSIVORC1",96,0)
 . K PSGPD,PSGPDN,PSGPDRG,PSGDRGN,PSGPFLG,PSGPI,PSGPR,PSGPRIO,PSGPRN
"RTN","PSIVORC1",97,0)
 . K PSGPTMP,PSGRRF,PSG0XT,PSGS0Y,PSGSCH,PSGSD,PSGSDN,PSGSI,PSGSM
"RTN","PSIVORC1",98,0)
 . K PSGST,PSGSTAT,PSGSTN,PSJACNWP,PSJACOK,PSJCOI
"RTN","PSIVORC1",99,0)
EDIT1 ;
"RTN","PSIVORC1",100,0)
 NEW XFLG,PSIVY S PSIVY=Y
"RTN","PSIVORC1",101,0)
 NEW X S X=^TMP("PSJI",$J,0),VALMBG=$S((X<17):1,1:(X-(X#16)))
"RTN","PSIVORC1",102,0)
 I PSIVY=0!'$G(PSIVFN1) S PSIVFN1=1 D EN^VALM("PSJ LM IV AC/EDIT") Q
"RTN","PSIVORC1",103,0)
 S PSIVCHG=0 D EDCHK^PSIVORC2 K PSIVCHG
"RTN","PSIVORC1",104,0)
 S VALMBCK="Q",PSIVACEP=1
"RTN","PSIVORC1",105,0)
 Q
"RTN","PSIVORC2")
0^62^B55943730
"RTN","PSIVORC2",1,0)
PSIVORC2 ;BIR/MLM-PROCESS INCOMPLETE IV ORDER - CONT ;22 OCT 97 / 3:16 PM
"RTN","PSIVORC2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**29,49,50,65,58,85,101,110**;16 DEC 97
"RTN","PSIVORC2",3,0)
 ;
"RTN","PSIVORC2",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872
"RTN","PSIVORC2",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178
"RTN","PSIVORC2",6,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSIVORC2",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORC2",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORC2",9,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSIVORC2",10,0)
 ;
"RTN","PSIVORC2",11,0)
EDCHK ;Update or create new order in 55.
"RTN","PSIVORC2",12,0)
 D CKORD D:'$G(PSJIVORF) ORPARM^PSIVOREN I 'PSJIVORF W !,"Either the Inpatient Medications or the IV Medications package is not on, please check the Order Parameters file" Q
"RTN","PSIVORC2",13,0)
 I PSIVCHG,PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) W $C(7),"Order unchanged" Q
"RTN","PSIVORC2",14,0)
 ;;S:PSIVCHG P(21)=""
"RTN","PSIVORC2",15,0)
 S:PSIVCHG P("21FLG")=""
"RTN","PSIVORC2",16,0)
 I $G(PSJCOM) D IV^PSJCOMV Q
"RTN","PSIVORC2",17,0)
 Q:$$NONVF()
"RTN","PSIVORC2",18,0)
ACTIVE ;
"RTN","PSIVORC2",19,0)
 S PSJCOM=P("PRNTON")
"RTN","PSIVORC2",20,0)
 I PSJCOM D VFYIV^PSJCOMV Q
"RTN","PSIVORC2",21,0)
 S P("RES")=$P($G(^PS(53.1,+ON,0)),U,24)
"RTN","PSIVORC2",22,0)
 I P("RES")="R" S P("NEWON")=P("OLDON") D RUPDATE^PSIVOREN(DFN,ON,P(2))
"RTN","PSIVORC2",23,0)
 I P("RES")'="R" S PSJORD=ON,P(17)="A",ORSTS=6,PSJORNP=P(6) D SETNEW^PSIVORFB S P("NEWON")=ON55 D @$S(PSIVCHG:"NEWORD",1:"OLDORD")
"RTN","PSIVORC2",24,0)
 S (ON55,ON)=P("NEWON"),OD=P(2) D EN^PSIVORE
"RTN","PSIVORC2",25,0)
 D VF1^PSJLIACT("F","ORDER VERIFIED BY ",1)
"RTN","PSIVORC2",26,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORC2",27,0)
 L -^PS(53.1,+PSJORD) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSIVORC2",28,0)
 Q
"RTN","PSIVORC2",29,0)
 ;
"RTN","PSIVORC2",30,0)
CKORD ;Check if new order is to be created.
"RTN","PSIVORC2",31,0)
 N ND S PSIVCHG=0,ND(0)=$G(^PS(53.1,+ON,0)),ND("PD")=$G(^PS(53.1,+ON,.2))_U_$P(ND(0),U,3)
"RTN","PSIVORC2",32,0)
 N X S X=$P($G(^PS(53.1,+ON,8)),U,5),X=$S(P(8)["@":$P(X,"@"),1:X)
"RTN","PSIVORC2",33,0)
 S ND=$S($E(P("OT"))="I":P(8)_U_$P($G(^PS(53.1,+ON,2)),U)_U_$P(ND(0),U,3)_U_+$P(ND("PD"),U),1:X_U_$P($G(^PS(53.1,+ON,2)),U)_U_+P("MR")_U_+P("PD"))
"RTN","PSIVORC2",34,0)
 S ND=ND_U_$S($P(ND(0),U,2)=+P("CLRK"):+$P(ND(0),U,2),1:+P(6))
"RTN","PSIVORC2",35,0)
 I ND'=($S($E(P("OT"))="I":P(8),P(8)["@":$P(P(8),"@"),1:P(8))_U_P(9)_U_+P("MR")_U_+P("PD")_U_+P(6)) S PSIVCHG=1  Q
"RTN","PSIVORC2",36,0)
 Q:P(17)="P"
"RTN","PSIVORC2",37,0)
 N DNE,ND,TDRG S (DRG("DRGC"),DNE)=0
"RTN","PSIVORC2",38,0)
 Q:PSIVCHG  F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  S TDRG(DRGT,+$P(DRG(DRGT,DRGI),U),DRGI)=$P(DRG(DRGT,DRGI),U,3) I $P(P("OT"),U)="F",'$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSIVORC2",39,0)
 F DRGT="AD","SOL" Q:DRGT="SOL"&(P("DTYP")=1)  F DRGI=0:0 S DRGI=$O(^PS(53.1,+ON,DRGT,DRGI)) Q:'DRGI!DNE  D
"RTN","PSIVORC2",40,0)
 .S X=$G(^PS(53.1,+ON,DRGT,DRGI,0)),DRG("DRGC")=$G(DRG("DRGC"))+1
"RTN","PSIVORC2",41,0)
 .I $D(TDRG(DRGT,+$P(X,U),DRGI)),$P(X,U,2)=$P(TDRG(DRGT,+$P(X,U),DRGI),U) Q
"RTN","PSIVORC2",42,0)
 .S (PSIVCHG,DNE)=1
"RTN","PSIVORC2",43,0)
 Q:PSIVCHG
"RTN","PSIVORC2",44,0)
 I $G(DRG("AD",0))+$S(P("DTYP")=1:0,1:DRG("SOL",0))'=DRG("DRGC") S PSIVCHG=1 Q
"RTN","PSIVORC2",45,0)
CKPC ;
"RTN","PSIVORC2",46,0)
 Q:PSIVCHG  I $E(P("OT"))'="I" D
"RTN","PSIVORC2",47,0)
 .;
"RTN","PSIVORC2",48,0)
 .; Check IV drugs for changes.
"RTN","PSIVORC2",49,0)
 .S DNE=0 F DRGT="AD","SOL" I $D(DRG(DRGT)) S FIL="52."_$S(DRGT="AD":6,1:7) D
"RTN","PSIVORC2",50,0)
 ..N ND,TDRG F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI!DNE  S TDRG(+$P(DRG(DRGT,DRGI),U),DRGI)=DRGI,TDRG("CNT")=+$G(TDRG("CNT"))+1
"RTN","PSIVORC2",51,0)
 ..F ON1=0:0 S ON1=$O(^PS(53.1,+ON,DRGT,ON1)) Q:'+ON1!DNE  S ND=$G(^PS(53.1,+ON,DRGT,ON1,0)),ND("CNT")=$G(ND("CNT"))+1 D
"RTN","PSIVORC2",52,0)
 ...S DRG=+$P(ND,U) S:'$D(TDRG(+DRG)) (DNE,PSIVCHG)=1 F DRGI=0:0 S DRGI=$O(TDRG(+DRG,DRGI)) Q:'DRGI!DNE  I $P($G(DRG(DRGT,DRGI)),U)_U_$P($G(DRG(DRGT,DRGI)),U,3)'=$P(ND,U,1,2) S (DNE,PSIVCHG)=1
"RTN","PSIVORC2",53,0)
 ..S:$G(ND("CNT"))'=$G(TDRG("CNT")) (DNE,PSIVCHG)=1 K ND,TDRG
"RTN","PSIVORC2",54,0)
 Q
"RTN","PSIVORC2",55,0)
 ;
"RTN","PSIVORC2",56,0)
OLDORD ; Update old order, update order links.
"RTN","PSIVORC2",57,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",58,0)
 S P("OLDON")=$P($G(^PS(53.1,+ON,0)),U,25) I P("OLDON")'=ON55 S $P(^PS(55,DFN,"IV",+ON55,2),U,8)=P("RES"),$P(^(2),U,5)=P("OLDON") I P("OLDON") D
"RTN","PSIVORC2",59,0)
 .I P("OLDON")["V",$D(^PS(55,DFN,"IV",+P("OLDON"),0)) S $P(^(2),U,6)=ON55,$P(^(2),U,9)=P("RES")
"RTN","PSIVORC2",60,0)
 .I P("OLDON")["A",$D(^PS(55,DFN,5,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",61,0)
 .;I P("OLDON")["P",$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",62,0)
 .I $S(P("OLDON")["P":1,P("OLDON")["N":1,1:0),$D(^PS(53.1,+P("OLDON"),0)) S $P(^(0),U,26,27)=ON55_U_P("RES")
"RTN","PSIVORC2",63,0)
 D PUT531^PSIVORFA S $P(^PS(53.1,+ON,0),U,25,26)="^",ON=ON55 D UPD100^PSIVORFA
"RTN","PSIVORC2",64,0)
 Q
"RTN","PSIVORC2",65,0)
 ;
"RTN","PSIVORC2",66,0)
NEWORD ; Create new order, update order links.
"RTN","PSIVORC2",67,0)
 Q:P("RES")="R"
"RTN","PSIVORC2",68,0)
 S $P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",69,0)
 S P("NEWON")=$P($G(^PS(53.1,+PSJORD,0)),U,26),$P(^PS(55,DFN,"IV",+P("NEWON"),2),U,5)=PSJORD,$P(^(2),U,8)="E",ON=ON55
"RTN","PSIVORC2",70,0)
 ;;I PSJIVORF D SET^PSIVORFE D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",71,0)
 I PSJIVORF D EN1^PSJHL2(DFN,"SN",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORC2",72,0)
 Q
"RTN","PSIVORC2",73,0)
 ;
"RTN","PSIVORC2",74,0)
GTIVDRG ; Try to find an IV drug from the Orderable Item.
"RTN","PSIVORC2",75,0)
 ; If there is only 1 match to OI then stuff in DRG otherwise prompt user to select which
"RTN","PSIVORC2",76,0)
 ; ad/sol matched to OI
"RTN","PSIVORC2",77,0)
 K PSIVOI NEW FIL,ND,SCR,PSJNOW
"RTN","PSIVORC2",78,0)
 D NOW^%DTC S PSJNOW=%
"RTN","PSIVORC2",79,0)
 S SCR("S")="S ND=$P($G(^(""I"")),U) I ND=""""!(ND>PSJNOW)"
"RTN","PSIVORC2",80,0)
 F FIL=52.6,52.7 D FIND^DIC(FIL,,"@;.01;2","QXP",+P("PD"),,"AOI",SCR("S"),,"PSIVOI") I +PSIVOI("DILIST",0)>0 D  Q
"RTN","PSIVORC2",81,0)
 . S DRGT=$S(FIL=52.6:"AD",1:"SOL"),PSIVOI=DRGT
"RTN","PSIVORC2",82,0)
 . I PSIVOI="AD" D
"RTN","PSIVORC2",83,0)
 .. N XX,XXX,QC S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S XXX=+PSIVOI("DILIST",XX,0) D LIST^DIC(52.61,","_XXX_",","@;.01","PQ",,,,,,,"PSIVQC") D
"RTN","PSIVORC2",84,0)
 ... I +$G(PSIVQC("DILIST",0))>0 S QC=0 F  S QC=$O(PSIVQC("DILIST",QC)) Q:QC=""  S PSIVOI("DILIST",XX,QC,0)=PSIVQC("DILIST",QC,0)
"RTN","PSIVORC2",85,0)
 ... K PSIVQC("DILIST",0),PSIVQC("DILIST",0,"MAP")
"RTN","PSIVORC2",86,0)
 .. D RESET
"RTN","PSIVORC2",87,0)
 . I +PSIVOI("DILIST",0)=1 D
"RTN","PSIVORC2",88,0)
 .. S DRG=+PSIVOI("DILIST",1,0)
"RTN","PSIVORC2",89,0)
 .. S DNE=1,DRG(DRGT,0)=1,ND=$G(^PS(FIL,+DRG,0)),DRG(DRGT,1)=+DRG_U_$P(ND,U)_U_$S(FIL=52.7:$P(ND,U,3),1:"")_U_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORC2",90,0)
 K:+PSIVOI("DILIST",0)<2 PSIVOI
"RTN","PSIVORC2",91,0)
 Q
"RTN","PSIVORC2",92,0)
 ;
"RTN","PSIVORC2",93,0)
EDIT ; Edit incomplete order
"RTN","PSIVORC2",94,0)
 S PSIVAC="CE"
"RTN","PSIVORC2",95,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D GTIVDRG
"RTN","PSIVORC2",96,0)
 I P(4)="" D 53^PSIVORC1 Q:P(4)=""  D ^PSIVORV2
"RTN","PSIVORC2",97,0)
 D GSTRING^PSIVORE1,GTFLDS^PSIVORFE ;S (PSIVOK,EDIT)="57^58^59^3"_$S(P("DTYP")=1:"^26^39",1:"")_"^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25"_$S(+P(6)'=+P("CLRK"):"^1",1:"") D GTFLDS^PSIVORFE
"RTN","PSIVORC2",98,0)
 Q:$G(DONE)
"RTN","PSIVORC2",99,0)
 I $G(^ORD(101,+$P($G(VALM("PROTOCOL")),";"),0))["PSJ PC IV AC/EDIT ACTION" S PSIVENO=1
"RTN","PSIVORC2",100,0)
 I '$G(PSIVENO) S PSIVENO=1 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q"
"RTN","PSIVORC2",101,0)
 ;;K ON55 D COMPLTE^PSIVORC1
"RTN","PSIVORC2",102,0)
 Q
"RTN","PSIVORC2",103,0)
 ;
"RTN","PSIVORC2",104,0)
FINISH ; Ask only for missing data in incomplete IV order.
"RTN","PSIVORC2",105,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI")) I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG
"RTN","PSIVORC2",106,0)
 D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORC2",107,0)
 I 'P(2) D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSIVORC2",108,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSIVORC2",109,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSIVORC2",110,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT G COMPLTE^PSIVORC1
"RTN","PSIVORC2",111,0)
 Q
"RTN","PSIVORC2",112,0)
NONVF() ; Updated 53.1 status to non-verfied after finish.
"RTN","PSIVORC2",113,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORC2",114,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORC2",115,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORC2",116,0)
 I PSIVCHG D NWNONVF Q 1
"RTN","PSIVORC2",117,0)
 S P(17)="N",P("REN")=0
"RTN","PSIVORC2",118,0)
 D GTPD^PSIVORE2
"RTN","PSIVORC2",119,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORC2",120,0)
 S $P(^PS(53.1,+ON,.2),U)=""
"RTN","PSIVORC2",121,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",122,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",123,0)
 NEW PSIVORFA S PSIVORFA=1 D:ON["V" DEL55^PSIVORE2
"RTN","PSIVORC2",124,0)
 D EN1^PSJHL2(DFN,"XX",ON,"UPDATED ORDER")
"RTN","PSIVORC2",125,0)
 D VF
"RTN","PSIVORC2",126,0)
 Q 1
"RTN","PSIVORC2",127,0)
NWNONVF ;Create non-vf due to edit
"RTN","PSIVORC2",128,0)
 ;D NATURE^PSIVOREN I '$D(P("NAT")) Q
"RTN","PSIVORC2",129,0)
 K DA D ENGNN^PSGOETO S P("NEWON")=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORC2",130,0)
 S PSJORD=ON,$P(^PS(53.1,+ON,0),U,26,27)=P("NEWON")_U_"E",PSIVAC="CE",PSJORNAT=P("NAT") D DC^PSIVORA
"RTN","PSIVORC2",131,0)
 S P("OLDON")=ON,ON=P("NEWON")
"RTN","PSIVORC2",132,0)
 S P("RES")="E"
"RTN","PSIVORC2",133,0)
 ;D:P("DO")="" GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",134,0)
 S P("DO")="" D GTPD^PSIVORE2 ;Get dosage order if not defined for IPM IV
"RTN","PSIVORC2",135,0)
 D PUT531^PSIVORFA
"RTN","PSIVORC2",136,0)
 S $P(^PS(53.1,+ON,0),U,25,26)=P("OLDON")_U_""
"RTN","PSIVORC2",137,0)
 D NEWNVAL^PSGAL5(ON,$S(+PSJSYSU=1:22000,+PSJSYSU=3:22005,1:22006),"","")
"RTN","PSIVORC2",138,0)
 D EN1^PSJHL2(DFN,"SN",ON,"SEND ORDER NUMBER")
"RTN","PSIVORC2",139,0)
 D VF
"RTN","PSIVORC2",140,0)
 Q
"RTN","PSIVORC2",141,0)
VF ; Display Verify screen
"RTN","PSIVORC2",142,0)
 Q:ON'["P"
"RTN","PSIVORC2",143,0)
 K PSJIVBD
"RTN","PSIVORC2",144,0)
 D GT531^PSIVORFA(DFN,ON)
"RTN","PSIVORC2",145,0)
 S PSGACT="EL"
"RTN","PSIVORC2",146,0)
 I P(17)="N",(P("OLDON")=""),(+P("CLRK")=DUZ) S PSGACT="ELD"
"RTN","PSIVORC2",147,0)
 I +PSJSYSU=3!(+PSJSYSU=1) S PSGACT="DELV"
"RTN","PSIVORC2",148,0)
 I +PSJSYSU=3,$L($T(EN1^ORCFLAG)) S PSGACT=PSGACT_"G"
"RTN","PSIVORC2",149,0)
 I P("OT")="I" S PSJSTAR="(1)^(5)^(7)^(9)^(10)"
"RTN","PSIVORC2",150,0)
 I P("OT")'="I" S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSIVORC2",151,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSIVORC2",152,0)
 Q
"RTN","PSIVORC2",153,0)
 ;
"RTN","PSIVORC2",154,0)
RESET ;Reset PSIVOI("DILIST") for additives with quick codes
"RTN","PSIVORC2",155,0)
 N XX,XXX,CNT S CNT=0
"RTN","PSIVORC2",156,0)
 S XX=0 F  S XX=$O(PSIVOI("DILIST",XX)) Q:XX=""  S CNT=CNT+1,LYN(CNT)=PSIVOI("DILIST",XX,0) D
"RTN","PSIVORC2",157,0)
 . S XXX=0 F  S XXX=$O(PSIVOI("DILIST",XX,XXX)) Q:XXX=""  S CNT=CNT+1,LYN(CNT)=$P(PSIVOI("DILIST",XX,0),"^")_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^",2)_"^"_$P(PSIVOI("DILIST",XX,XXX,0),"^")_"^"_"QC"
"RTN","PSIVORC2",158,0)
 K PSIVOI("DILIST")
"RTN","PSIVORC2",159,0)
 S PSIVOI("DILIST",0)=CNT_"^*^0^"
"RTN","PSIVORC2",160,0)
 S XX=0 F  S XX=$O(LYN(XX)) Q:'XX  S PSIVOI("DILIST",XX,0)=LYN(XX)
"RTN","PSIVORC2",161,0)
 K LYN
"RTN","PSIVORC2",162,0)
 Q
"RTN","PSIVORE")
0^115^B40836146
"RTN","PSIVORE",1,0)
PSIVORE ;BIR/PR,MLM-ORDER ENTRY ;25 Nov 98 / 3:34 PM
"RTN","PSIVORE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**18,29,50,56,58,81,110**;16 DEC 97
"RTN","PSIVORE",3,0)
 ;
"RTN","PSIVORE",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVORE",5,0)
 ; Reference to ^ORX2 is supported by DBIA #867
"RTN","PSIVORE",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVORE",7,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSIVORE",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSIVORE",9,0)
 ; Reference to EN^VALM is supported by DBIA 10118.
"RTN","PSIVORE",10,0)
 ; Reference to ^VADPT is supported by DBIA 10061.
"RTN","PSIVORE",11,0)
 ;
"RTN","PSIVORE",12,0)
 N PSJNEW,PSJOUT,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSIVORE",13,0)
 ;
"RTN","PSIVORE",14,0)
 D SITE Q:'$G(PSIVQ)  K PSIVQ S PSGOP=""
"RTN","PSIVORE",15,0)
 ;
"RTN","PSIVORE",16,0)
BEG ;Get patient and make sure he is living.
"RTN","PSIVORE",17,0)
 L +^PS(53.45,DUZ):1 E  D LOCKERR^PSJOE G Q
"RTN","PSIVORE",18,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  D ASK
"RTN","PSIVORE",19,0)
 ;* F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S X=DFN_";DPT(" D LK^ORX2 Q:'Y  D ASK S X=DFN_";DPT(" D ULK^ORX2
"RTN","PSIVORE",20,0)
 NEW PSJLK
"RTN","PSIVORE",21,0)
 F  K WSCHADM S PSGPTMP=0,PPAGE=1 D ENGETP^PSIV Q:DFN<0  S PSJLK='$$L^PSSLOCK(DFN,1) Q:PSJLK  D ASK,UL^PSSLOCK(DFN)
"RTN","PSIVORE",22,0)
 I PSGOP,$P(PSJSYSL,"^",2)]"" D ENQL^PSGLW
"RTN","PSIVORE",23,0)
 G Q
"RTN","PSIVORE",24,0)
 ;
"RTN","PSIVORE",25,0)
ASK ;See if patient has been admitted.
"RTN","PSIVORE",26,0)
 I VADM(6) W !?5,"Patient has died." Q
"RTN","PSIVORE",27,0)
 I 'VAIN(4) K DIK S DIR(0)="Y",DIR("A")="Do you wish to continue",DIR("B")="NO",DIR("??")="^S HELP=""ADMYN"" D ^PSIVHLP1" W !,"This patient has not been admitted." D ^DIR K DIR Q:'Y
"RTN","PSIVORE",28,0)
 S:VAIN(4) WSCHADM=+VAIN(4)
"RTN","PSIVORE",29,0)
 ;
"RTN","PSIVORE",30,0)
SETN ;Set up patient 0 node if needed.
"RTN","PSIVORE",31,0)
 I '$D(^PS(55,DFN,0)) K DO,DA,DD,DIC,PSIVFN S:$D(^(5.1)) PSIVFN=^(5.1) K:$D(PSIVFN) ^(5.1) S (DINUM,X)=DFN,DIC(0)="L",DIC="^PS(55," D FILE^DICN S:$D(PSIVFN) ^PS(55,DFN,5.1)=PSIVFN D  K DIC,PSIVFN,DO,DA,DD
"RTN","PSIVORE",32,0)
 .; Mark PSJ and PSO as converted
"RTN","PSIVORE",33,0)
 .S $P(^PS(55,DFN,5.1),"^",11)=2
"RTN","PSIVORE",34,0)
 S PSJNARC=1
"RTN","PSIVORE",35,0)
 S PSGP=DFN,PSJPWD=+VAIN(4),PSIVAC="P",PSIVBR="D ^PSIVOPT" D HK,ENCHS1^PSIV Q:'$D(DFN)
"RTN","PSIVORE",36,0)
 Q
"RTN","PSIVORE",37,0)
 ;
"RTN","PSIVORE",38,0)
NEW ;Ask to enter new order.
"RTN","PSIVORE",39,0)
 D:'$D(VADM(1)) DEM^VADPT
"RTN","PSIVORE",40,0)
 K P,PSIVCHG,PSIVTYPE,PSJOE,DIR S DIR(0)="Y",DIR("A")="New order for "_VADM(1),DIR("B")="YES",DIR("??")="^S HELP=""NEWORD"" D ^PSIVHLP" D ^DIR K DIR Q:'Y
"RTN","PSIVORE",41,0)
 NEW X S X=DFN_";DPT(" D LK^ORX2 Q:'Y  S PSJLSORX=1
"RTN","PSIVORE",42,0)
INMED K ON55,PSJOUT S (P(4),P("OT"),P("FRES"))="" D NEW55^PSIVORFB I '$D(ON55) D ULK G:'$D(PSJOE)&('$D(PSJOUT)) NEW G Q
"RTN","PSIVORE",43,0)
 S P("RES")="N",PSIVAC="PN",P("PON")=ON55,PSIVUP=+$$GTPCI^PSIVUTL D NEW^PSIVORE2 I $G(P(2))="" D DEL55^PSIVORE2 D ULK G:'$D(PSJOE) NEW Q
"RTN","PSIVORE",44,0)
 D OK L -^PS(55,DFN,"IV",+ON55) D ULK G:'$D(PSJOE) NEW
"RTN","PSIVORE",45,0)
 ;
"RTN","PSIVORE",46,0)
Q ; Kill and exit.
"RTN","PSIVORE",47,0)
 L:'$D(PSJOE) -^PS(53.45,DUZ) S PSJNKF=1 D Q^PSIV
"RTN","PSIVORE",48,0)
 K FIL,I1,ND,PC,PDM,PSGDT,PSGID,PSGLMT,PSGSI,PSJNARC,PSIVAC,PSIVCHG,PSIVUP,PSIVX,PSJOPC
"RTN","PSIVORE",49,0)
 Q
"RTN","PSIVORE",50,0)
 ;
"RTN","PSIVORE",51,0)
ULK ;
"RTN","PSIVORE",52,0)
 Q:'$G(PSJLSORX)  ;If NEW^PSIVORE did not lock, don't kill it here.
"RTN","PSIVORE",53,0)
 NEW X S X=DFN_";DPT(" D ULK^ORX2 K PSJLSORX
"RTN","PSIVORE",54,0)
 Q
"RTN","PSIVORE",55,0)
HK ;Queue job to print MAR labels generated for this patient.
"RTN","PSIVORE",56,0)
 I PSGOP,PSGOP'=DFN D
"RTN","PSIVORE",57,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSIVORE",58,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,U,2)]"" ENQL^PSGLW
"RTN","PSIVORE",59,0)
 S PSGOP=DFN
"RTN","PSIVORE",60,0)
 Q
"RTN","PSIVORE",61,0)
 ;
"RTN","PSIVORE",62,0)
SITE ;See if site parameters are ok.
"RTN","PSIVORE",63,0)
 K PSIVQ D ^PSIVXU Q:$D(XQUIT)
"RTN","PSIVORE",64,0)
 I '$D(PSIVSN)!('$D(PSIVSITE)) W $C(7),$C(7),!!,"You have no IV ROOM parameters ... PLEASE ... PLEASE ...",!,"Exit this package and reenter properly !!",!! Q
"RTN","PSIVORE",65,0)
 D ORPARM^PSIVOREN S PSIVQ=1
"RTN","PSIVORE",66,0)
 Q
"RTN","PSIVORE",67,0)
 ;
"RTN","PSIVORE",68,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSIVORE",69,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I $G(P("PD"))="" D GTPD^PSIVORE2
"RTN","PSIVORE",70,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" G DOA
"RTN","PSIVORE",71,0)
 I ERR=1 S X="N" G BAD
"RTN","PSIVORE",72,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSIVORE",73,0)
 W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSIVORE",74,0)
 I '$G(PSIVCOPY) G:PSIVAC["R" OK1 S X="Is this O.K.: ^"_$S(ERR:"NO",1:"YES")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV
"RTN","PSIVORE",75,0)
 S PSJIVBD=1 ;var use to indicate order enter from back door
"RTN","PSIVORE",76,0)
BAD ;; I X["N" D GSTRING^PSIVORE1,^PSIVORV2,GTFLDS^PSIVORFE G OK
"RTN","PSIVORE",77,0)
 I ON55["V",($G(P(21))="") S P(17)="N"
"RTN","PSIVORE",78,0)
 I X["N" NEW PSGEBN,PSGLI S (P("INS"),PSGEBN,PSGLI)="",(PSJORD,ON)=ON55 D EN^VALM("PSJ LM IV AC/EDIT") S VALMBCK="Q" Q
"RTN","PSIVORE",79,0)
 I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSIVORE",80,0)
DOA I X["^" D DEL55^PSIVORE2 Q
"RTN","PSIVORE",81,0)
 Q:$$NONVF("SN")
"RTN","PSIVORE",82,0)
OK1 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))),P(17)="A",ORSTS=6,ON=ON55,PSJORNP=+P(6)
"RTN","PSIVORE",83,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN
"RTN","PSIVORE",84,0)
 I PSJIVORF D NATURE^PSIVOREN I '$D(P("NAT")) D DEL55^PSIVORE2 Q
"RTN","PSIVORE",85,0)
 D SET55^PSIVORFB
"RTN","PSIVORE",86,0)
 I PSJIVORF,($G(P(22))=.5) D CLINIC^PSIVOREN
"RTN","PSIVORE",87,0)
 I PSJIVORF D SET^PSIVORFE S ORNATR=P("NAT"),ON=+ON55,OD=P(2) D EN1^PSJHL2(DFN,"SN",+ON55_"V","SEND ORDER NUMBER") ;,EN1^PSJHL2(DFN,"SC",+ON55_"V","NEW ORDER CREATED")
"RTN","PSIVORE",88,0)
 D VF1^PSJLIACT("V","ORDER ENTERED AS ACTIVE BY ",1)
"RTN","PSIVORE",89,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"N")
"RTN","PSIVORE",90,0)
 ;
"RTN","PSIVORE",91,0)
CAL ;Calculate doses.
"RTN","PSIVORE",92,0)
 ;S OD=P(2) D EN,^PSIVORE1,^PSIVOPT
"RTN","PSIVORE",93,0)
 S OD=P(2) D EN,^PSIVOPT
"RTN","PSIVORE",94,0)
 Q
"RTN","PSIVORE",95,0)
 ;
"RTN","PSIVORE",96,0)
EN ;UPdate schedual interval P(15) only on continous orders.
"RTN","PSIVORE",97,0)
 ;This includes Hyp/Adm/Continuous Syringes/Chemos =>P(5)=0
"RTN","PSIVORE",98,0)
 Q:'$D(DFN)!('$D(ON55))  Q:$P(^PS(55,DFN,"IV",+ON55,0),U,4)="P"!($P(^(0),U,5))!($P(^(0),U,23)="P")
"RTN","PSIVORE",99,0)
 D SPSOL S XXX=$P(^PS(55,DFN,"IV",+ON55,0),U,8) G:'SPSOL ENQ I XXX?1N.N.1"."1N.N1" ml/hr" S P(15)=$S('XXX:0,1:SPSOL\XXX*60+(SPSOL#XXX/XXX*60+.5)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15) G ENQ
"RTN","PSIVORE",100,0)
 S P(15)=$S('$P(XXX,"@",2):0,1:1440/$P(XXX,"@",2)\1),$P(^PS(55,DFN,"IV",+ON55,0),U,15)=P(15)
"RTN","PSIVORE",101,0)
ENQ K SPSOL,XXX Q
"RTN","PSIVORE",102,0)
SPSOL S SPSOL=0 F XXX=0:0 S XXX=$O(^PS(55,DFN,"IV",+ON55,"SOL",XXX)) Q:'XXX  S SPSOL=SPSOL+$P(^(XXX,0),U,2)
"RTN","PSIVORE",103,0)
 K XXX Q
"RTN","PSIVORE",104,0)
ENIN ;Entry for Combined IV/UD order entry. Called by PSJOE0.
"RTN","PSIVORE",105,0)
 D HOLDHDR^PSJOE
"RTN","PSIVORE",106,0)
 W !
"RTN","PSIVORE",107,0)
 N PSJOUT S (DONE,FLAG)=0,PSIVAC="PN"
"RTN","PSIVORE",108,0)
ENIN1 ;
"RTN","PSIVORE",109,0)
 N DA,DIR,PSJOE,PSJPCAF,PSJSYSL,WSCHADM S:$G(VAIN(4)) WSCHADM=VAIN(4)
"RTN","PSIVORE",110,0)
 K P,PSIVCHG
"RTN","PSIVORE",111,0)
 S PSJOE=1,DIR(0)="55.01,.04O",DIR("A")="Select IV TYPE" D ^DIR
"RTN","PSIVORE",112,0)
 I X]"",X'="^",$P("^PROFILE",X)="" S PSJOEPF=X Q
"RTN","PSIVORE",113,0)
 S:$D(DTOUT) X="^" I "^"[X S PSJORQF=PSJORQF+$S(X="^":2,$G(FLAG):0,1:1),X="." Q
"RTN","PSIVORE",114,0)
 S FLAG=1,PSIVTYPE=Y,(P(5),P(23))="" I "SC"[Y D @(Y_"^PSIVORC1") S $P(PSIVTYPE,U,2)=P(23)
"RTN","PSIVORE",115,0)
 D INMED G:'$D(PSJOUT) ENIN S:$D(PSJOUT) PSJORQF=2
"RTN","PSIVORE",116,0)
 Q
"RTN","PSIVORE",117,0)
NONVF(PSJOC)  ;If file at NonVF then quit with 1
"RTN","PSIVORE",118,0)
 NEW PSGOEAV S PSGOEAV=+$P(PSJSYSP0,U,9)
"RTN","PSIVORE",119,0)
 I +PSJSYSU=3,PSGOEAV Q 0
"RTN","PSIVORE",120,0)
 I +PSJSYSU=1,PSGOEAV Q 0
"RTN","PSIVORE",121,0)
 K DA D ENGNN^PSGOETO S ON=DA_"P",P(17)="N",P("REN")=0
"RTN","PSIVORE",122,0)
 D GTPD^PSIVORE2
"RTN","PSIVORE",123,0)
 D NATURE^PSIVOREN I '$D(P("NAT")) D:ON55["V" DEL55 Q 1
"RTN","PSIVORE",124,0)
 D:$G(VAIN(4))="" CLINIC^PSIVOREN
"RTN","PSIVORE",125,0)
 W !,"...transcribing this non-verified order...."
"RTN","PSIVORE",126,0)
 D PUT531^PSIVORFA
"RTN","PSIVORE",127,0)
 D:$G(PSJOC)]"" EN1^PSJHL2(DFN,PSJOC,ON,"SEND ORDER NUMBER")
"RTN","PSIVORE",128,0)
 D:ON55["V" DEL55
"RTN","PSIVORE",129,0)
 NEW PSJORD S (ON55,PSJORD)=ON
"RTN","PSIVORE",130,0)
 D VF^PSIVORC2
"RTN","PSIVORE",131,0)
 Q 1
"RTN","PSIVORE",132,0)
DEL55 ;
"RTN","PSIVORE",133,0)
 Q:ON55["P"
"RTN","PSIVORE",134,0)
 S X=$G(^PS(55,DFN,"IV",+ON55,0))
"RTN","PSIVORE",135,0)
 I $P(X,U,21)]"",($G(^PS(55,DFN,"IV",+ON55,2))]"") S $P(^(2),U,6)=ON,$P(^PS(53.1,+ON,0),U,25)=ON55 Q
"RTN","PSIVORE",136,0)
 NEW PSIVORFA S PSIVORFA=1
"RTN","PSIVORE",137,0)
 D DEL55^PSIVORE2
"RTN","PSIVORE",138,0)
 Q 
"RTN","PSIVORE1")
0^116^B21473251
"RTN","PSIVORE1",1,0)
PSIVORE1 ;BIR/RGY,PR,MLM-ACT,NEW ORDER ;07 AUG 97 / 2:45 PM
"RTN","PSIVORE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,110**;16 DEC 97
"RTN","PSIVORE1",3,0)
 ;
"RTN","PSIVORE1",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVORE1",5,0)
 ;
"RTN","PSIVORE1",6,0)
S ;
"RTN","PSIVORE1",7,0)
 Q:+PSJSYSU'=3
"RTN","PSIVORE1",8,0)
 D NOW^%DTC S Y=% Q:P(4)=""!(P(2)="")  S:'$D(OD) OD=$S(P(2)>Y:P(2),1:Y) S PSGCNT=0,PNOW=DT K PSGSA
"RTN","PSIVORE1",9,0)
 I $G(ON),$G(DFN) N RNDT,OP2 S RNDT=+$$LASTREN^PSJLMPRI(DFN,ON) I RNDT S OP2=P(2),(OD,P(2))=RNDT
"RTN","PSIVORE1",10,0)
STR ;
"RTN","PSIVORE1",11,0)
 K PSI F I=0:0 S I=$O(^PS(59.5,PSIVSN,2,"AC",P(4),I)) Q:'I  S PSI("E",+(PNOW_"."_$P(^PS(59.5,+PSIVSN,2,I,0),U,4)))=+(PNOW_"."_$P(^(0),U))_U_I,PSI("S",+(PNOW_"."_$P(^(0),U)))=I
"RTN","PSIVORE1",12,0)
EC ;
"RTN","PSIVORE1",13,0)
 S PSIVEC=$O(PSI("E",Y)) I PSIVEC="" S X1=PNOW,X2=1 D C^%DTC S PNOW=X G STR
"RTN","PSIVORE1",14,0)
 I $O(PSI("S",PSIVEC))="" S X1=$O(PSI("S",0)),X2=1 D C^%DTC S X=$P(X,".") S PSI("S",+(X_"."_$P($O(PSI("S",0)),".",2)))=PSI("S",$O(PSI("S",0)))
"RTN","PSIVORE1",15,0)
 I $P(^PS(59.5,+PSIVSN,2,PSI("S",$O(PSI("S",PSIVEC))),0),U,6)=$O(PSI("S",PSIVEC)) S Y=PSIVEC G EC
"RTN","PSIVORE1",16,0)
 I PSIVEC'<P(2) S CD=$S(P(3)>PSIVEC:PSIVEC,1:P(3)) S:OD=CD CD=CD+.0001 D ENP3^PSIVWL
"RTN","PSIVORE1",17,0)
P ;
"RTN","PSIVORE1",18,0)
 S:'$D(PSGSA) PSGSA=""
"RTN","PSIVORE1",19,0)
 ;* W:PSGCNT !!,PSGCNT," Label",$E("s",PSGCNT>1)," needed for dose",$E("s",PSGCNT>1)," due at ...",!! F Y=1:1 S X=$P(PSGSA," ",Y) D:$E(X)="." CONVER^PSIVORE2 Q:X=""  W $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)_" : "
"RTN","PSIVORE1",20,0)
 D FULL^VALM1
"RTN","PSIVORE1",21,0)
 W:PSGCNT !!,PSGCNT," Label",$E("s",PSGCNT>1)," needed for dose",$E("s",PSGCNT>1)," due at ...",!!
"RTN","PSIVORE1",22,0)
 F Y=1:1 S X=$P(PSGSA," ",Y) S:$E(X)="." X=$$CONVER^PSIVORE2(X,Y) Q:X=""  W $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_" "_$E(X#1_"000",2,5)_" : "
"RTN","PSIVORE1",23,0)
 W ! D:$P(PSIVSITE,U,8) TL^PSIVORE2 D NOW^%DTC S Y=% S PNOW=Y I $D(^PS(59.5,PSIVSN,3,"AT")) W !!,"Next delivery time is " S X=$O(^PS(59.5,PSIVSN,3,"AT",PNOW#1)) S:X="" X=$O(^(X)) S X=$P(X,".",2)_$E("000",1,5-$L(X)) W X," ***" G B1
"RTN","PSIVORE1",24,0)
ACT ; Prompt and process label action.
"RTN","PSIVORE1",25,0)
B I PSGCNT<1 S:($G(RNDT)&$G(OP2)) P(2)=OP2 G K^PSIVORE2
"RTN","PSIVORE1",26,0)
B1 ;
"RTN","PSIVORE1",27,0)
 W ! S X="Action (PB"_$S($P(PSIVSITE,U,2):"S",1:"")_")^"_$S(PSGCNT<1:"B",$G(PSJPRI)="D":"B",$P(PSIVSITE,U,2)&$D(X):"S",1:"P")_"^^PRINT LABELS,BYPASS"_$S($P(PSIVSITE,U,2):",SUSPEND LABELS",1:"")
"RTN","PSIVORE1",28,0)
 D ENQ^PSIV S X=$E(X) S:X["?" HELP="ANSWER" D:X["?" ^PSIVHLP G:X["?" B1 I "B^"[X G K^PSIVORE2
"RTN","PSIVORE1",29,0)
 I "S"[X,$D(^PS(55,"PSIVSUS",PSIVSN,DFN,ON)) D C^PSIVORE2 W !!,"There ",$S(SNM>1:"are",1:"is")," already ",SNM," LABEL",$E("S",SNM>1)," suspended for this order." K SNM,DAT
"RTN","PSIVORE1",30,0)
SS ;
"RTN","PSIVORE1",31,0)
 S PSIVA=X,X="# of labels^"_PSGCNT_"^^^QUX=+QUX&(QUX?1N.N)" D ENQ^PSIV W !!
"RTN","PSIVORE1",32,0)
 S PSIVLABN=X I X["?" S X=PSIVA W !,"Enter # labels to act on." G SS
"RTN","PSIVORE1",33,0)
 I 'X W " No action taken ***" G B1
"RTN","PSIVORE1",34,0)
 I PSIVA="S",$D(^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,PNOW)) W $C(7),"NO Labels suspended, Wait 8 seconds and try again." D NOW^%DTC S Y=% S PNOW=Y G B1
"RTN","PSIVORE1",35,0)
 S $P(^(0),U,16)=$P(^PS(55,DFN,"IV",+ON,0),U,16)+X,PSIVNOL=+X,PSGCNT=PSGCNT-X,PSIVDOSE=$P(PSGSA," ",1,X),PLAST=$P(PSGSA," "),PLAST="."_$P(PLAST,".",2),PSGSA=$P(PSGSA," ",X+1,999) I PLAST>$P(PSGSA," ") S UP1=1
"RTN","PSIVORE1",36,0)
 S P(16)=$P(^PS(55,DFN,"IV",+ON,0),U,16)
"RTN","PSIVORE1",37,0)
 I $D(UP1) S:$D(X1)#2 XX1=X1 S:$D(X2)#2 XX2=X2 S X1=$E(PSIVDOSE,1,7),X2=1 D C^%DTC S PSGSA=X_PSGSA S:$D(XX1) X1=XX1 S:$D(XX2) X2=XX2 K XX2,XX1
"RTN","PSIVORE1",38,0)
 I '$D(UP1) S PSGSA=$E(PSIVDOSE,1,7)_PSGSA
"RTN","PSIVORE1",39,0)
 K UP1 I PSIVA="S" S ^PS(55,"PSIVSUS",PSIVSN,DFN,+ON,PNOW)=PSIVLABN_U_PSIVDOSE_U_P(16),Y=0,P(16)=P(16)+X W " ... ",PSIVLABN," Label",$E("s",PSIVLABN>1)," suspended !" S ACTION=5,PSIVNOL=PSIVLABN,TRACK=4 D ^PSIVLTR,NOW^%DTC S Y=% S PNOW=Y K X G B
"RTN","PSIVORE1",40,0)
 S IONOFF="" I PSIVPL=ION S P16=P(16),ACTION=1,TRACK=4 D ^PSIVLTR D ^PSIVHYPL:P(4)="H",^PSIVLABL:"APSC"[P(4) S P(16)=$P(^PS(55,DFN,"IV",+ON,0),U,16) G B
"RTN","PSIVORE1",41,0)
 W ! S P16=P(16),P(16)=P(16)+X,ZTDTH=$H,ZTIO=PSIVPL F Y="IONOFF","P16","PSIVDOSE","PSIVSITE","PSIVSN","PSIVNOL","DFN","ON","PSJSYSL","PSJSYSW0","PSJSYSW","PSJSYSP","PSJSYSP0","PSJSYSU" S ZTSAVE(Y)=""
"RTN","PSIVORE1",42,0)
 S ZTDESC="PRINT IV LABELS",ZTRTN="DEQ^PSIVORE2" D ^%ZTLOAD G B
"RTN","PSIVORE1",43,0)
GSTRING ; Setup edit "^" string.
"RTN","PSIVORE1",44,0)
 S PSIVOK="57^58^59^10^3^25^26^39^1^64^63"_$S($E(P("OT"))="I":"^101",1:"")
"RTN","PSIVORE1",45,0)
 S EDIT="57^58^59^10^3^25^26^39^1^"_$S(P("OT")="I":"101^",1:"")_"64^63"
"RTN","PSIVORE1",46,0)
 ;* S EDIT="57^58^59^10^3^25^26^39^1^"_$S(P("DTYP")=1:"101^",1:"")_"64^63"
"RTN","PSIVORE1",47,0)
 Q
"RTN","PSIVOREN")
0^117^B23131708
"RTN","PSIVOREN",1,0)
PSIVOREN ;BIR/MLM-UTILITIES FOR IV FLUIDS - OE/RR INTERFACE ; 25 Sep 98 / 2:00 PM
"RTN","PSIVOREN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,69,110**;16 DEC 97
"RTN","PSIVOREN",3,0)
 ;
"RTN","PSIVOREN",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVOREN",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVOREN",6,0)
 ; Reference to ^DIE is suppoted by DBIA 10018.
"RTN","PSIVOREN",7,0)
 ;
"RTN","PSIVOREN",8,0)
ENCPP ; Check Package Parameter
"RTN","PSIVOREN",9,0)
 D ORPARM I 'PSJORF W !!,"Inpatient Medications is not turned on for OE/RR.",!,"You will not be able to enter or edit IV or Unit Dose orders."
"RTN","PSIVOREN",10,0)
 I 'PSJIVORF W !!,"IV Medications is not turned on for OE/RR.",!,"You will not be able to enter or edit IV orders."
"RTN","PSIVOREN",11,0)
 I 'PSJORF!'PSJIVORF S PSJIVORF="" D DONE^PSIVORA1 Q
"RTN","PSIVOREN",12,0)
 S PSJORL=ORL,PSJORPF=0,P("OT")="F^",PSJORNP=ORNP
"RTN","PSIVOREN",13,0)
 ;; S PSJORL=ORL,PSJORPF=0,P("OT")="F^"_$O(^ORD(101,"B","PSJI OR PAT FLUID OE",0))_";ORD(101,",PSJORNP=ORNP
"RTN","PSIVOREN",14,0)
 Q
"RTN","PSIVOREN",15,0)
 ;
"RTN","PSIVOREN",16,0)
PS ; Check if MD is authorized to write med. orders.
"RTN","PSIVOREN",17,0)
 S PSJORPF=0 S:PSJORNP X=$G(^VA(200,+PSJORNP,"PS")) Q:$S('PSJORNP:0,'X:0,'$P(X,U,4):1,$P(X,U,4)>DT:1,1:0)  D
"RTN","PSIVOREN",18,0)
 .W !?2,"(The selected PROVIDER is NOT qualified to write MEDICATION orders.  You must",!,"select a valid provider to be able to continue with Inpatient Medications.)"
"RTN","PSIVOREN",19,0)
 .K DIC S DIC="^VA(200,",DIC(0)="AEMQZ",DIC("A")="Select PHARMACY PROVIDER: ",DIC("S")="S PSIV=$G(^(""PS"")) I PSIV,$S($P(PSIV,""^"",4)="""":1,DT<$P(PSIV,""^"",4):1,1:0)" F  W ! D ^DIC Q:$D(DUOUT)!$D(DTOUT)!(Y>0)  W $C(7),"  (Required.)"
"RTN","PSIVOREN",20,0)
 .K DIC S:Y'>0 PSJORPF=11 S:Y>0 (ORNP,PSJORNP)=+Y Q
"RTN","PSIVOREN",21,0)
 Q
"RTN","PSIVOREN",22,0)
 ;
"RTN","PSIVOREN",23,0)
RUPDATE(DFN,ON,NSTRT) ;
"RTN","PSIVOREN",24,0)
 ; Update renewal orders (called from Pharmacy options).
"RTN","PSIVOREN",25,0)
 N DA,DIE,DR,ND,NSTOP,OSTOP,NOO,ORETURN,PSIVACT,PSIVAL,PSIVALCK,PSJOSTRT S DIE="^PS(55,"_DFN_","
"RTN","PSIVOREN",26,0)
 I ON["P" S OLDON=$P($G(^PS(53.1,+ON,0)),"^",25),NOO=$P($G(^PS(53.1,+ON,.2)),"^",3)
"RTN","PSIVOREN",27,0)
 I ON["V" S OLDON=ON,NOO=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",5)
"RTN","PSIVOREN",28,0)
 I ON["U" S OLDON=$P($G(^PS(55,DFN,5,+ON,0)),U,25)
"RTN","PSIVOREN",29,0)
 I OLDON["P" S OLDON=$P($G(^PS(53.1,+OLDON,0)),U,25)
"RTN","PSIVOREN",30,0)
 I OLDON["V" S ON55=OLDON,X=$G(^PS(55,DFN,"IV",+OLDON,2)),PSJOSTRT=$P(X,U,7),OSTOP=$P($G(^(0)),U,3),DIE=DIE_"""IV"",",DR="100////A",PSIVACT=1
"RTN","PSIVOREN",31,0)
 I OLDON["U" S X=$G(^PS(55,DFN,5,+OLDON,2)),PSJOSTRT=$P(X,U,7),OSTOP=$P(X,U,4),DIE=DIE_"5,"
"RTN","PSIVOREN",32,0)
 S NSTOP=+$S($G(P(3)):P(3),1:0),DA=+OLDON,DA(1)=DFN I 'NSTOP W !,"CAN'T RENEW THIS ORDER!" D PAUSE^VALM1 Q
"RTN","PSIVOREN",33,0)
 I OSTOP>NSTOP W !,"NEW STOP DATE IS LESS THAN PREVIOUS STOP DATE" D PAUSE^VALM1
"RTN","PSIVOREN",34,0)
 ;
"RTN","PSIVOREN",35,0)
 I ON["V"!(ON["P") D EXPOE^PSGOER(DFN,ON)
"RTN","PSIVOREN",36,0)
 ;
"RTN","PSIVOREN",37,0)
 S DR=DR_";"_$S(OLDON["V":.03,OLDON["U":34,1:25)_"////"_NSTOP_";"_$S(OLDON["V":"114////@;123////@",1:"105////@;107////@") D ^DIE
"RTN","PSIVOREN",38,0)
 I ON["P" S DIE="^PS(53.1,",DR="28////A;105////@;16////@;17////@",DA=+ON D ^DIE D
"RTN","PSIVOREN",39,0)
 .N NOEORD S NOEORD=$P(^PS(53.1,+ON,0),U,21) I NOEORD K DA,DR,DIE S DIE="^PS(55,"_DFN_",""IV"",",DA(1)=DFN,DA=+ON55,DR="110////"_+NOEORD D ^DIE I NOEORD[";" S $P(^PS(53.1,+ON,0),U,21)=NOEORD
"RTN","PSIVOREN",40,0)
 I ON["V" S DIE="^PS(55,DFN,""IV"",",DR="100////A;114////@;16////@;17////@",DA=+ON55 D ^DIE
"RTN","PSIVOREN",41,0)
 N RDT S RDT=$P($G(@("^PS(53.1,"_+ON_",14,0)")),U,3) S:RDT RDT=+(^(RDT,0)) S RDT=$S(RDT:RDT,1:$$DATE^PSJUTL2) I RDT D UPDREN^PSIVOPT2(DFN,OLDON,RDT,+P(6),+$G(OSTOP),$G(NOO))
"RTN","PSIVOREN",42,0)
 ;
"RTN","PSIVOREN",43,0)
 I OLDON["V" S (ON,ON55)=OLDON,PSIVAL="",PSIVALCK="STOP",(P("FRES"),PSIVREA)="R" D LOG^PSIVORAL I $G(ON55),$G(OSTOP),$G(DFN) D STIX(OSTOP,OLDON,DFN)
"RTN","PSIVOREN",44,0)
 D:'$D(PSJIVORF) ORPARM Q:'PSJIVORF
"RTN","PSIVOREN",45,0)
 Q
"RTN","PSIVOREN",46,0)
 ;
"RTN","PSIVOREN",47,0)
RUPTXT(DFN,OLDON) ;
"RTN","PSIVOREN",48,0)
 ;Update ORTX( in OE/RR
"RTN","PSIVOREN",49,0)
 I OLDON'["V" ;; D ENUDTX^PSJOREN(DFN,OLDON,"OR") S ORIFN=$P($G(^PS(55,DFN,"IV",+OLDON,0)),U,21)
"RTN","PSIVOREN",50,0)
 I OLDON["V" S P("FRES")="R" D GTPC^PSIVORFB(OLDON),SORTX^PSIVORFE S ORIFN=$P($G(^PS(55,DFN,"IV",+OLDON,0)),U,21)
"RTN","PSIVOREN",51,0)
 ;; F X=0:0 S X=$O(ORTX(X)) Q:'X  S ORETURN("ORTX",X)=ORTX(X)
"RTN","PSIVOREN",52,0)
 Q
"RTN","PSIVOREN",53,0)
 ;
"RTN","PSIVOREN",54,0)
ORPARM ;Check if inpatient pkges are on.
"RTN","PSIVOREN",55,0)
 S (PSJORF,PSJIVORF)=1
"RTN","PSIVOREN",56,0)
 Q
"RTN","PSIVOREN",57,0)
 ;
"RTN","PSIVOREN",58,0)
NATURE ; Ask nature of order.
"RTN","PSIVOREN",59,0)
 I '+$G(PSJSYSU) S P("NAT")="W" Q
"RTN","PSIVOREN",60,0)
 K P("NAT") NEW X
"RTN","PSIVOREN",61,0)
 I $D(XQORNOD(0)) S X=$E($P(XQORNOD(0),U,3),1,1) S:X="" X="E"
"RTN","PSIVOREN",62,0)
 ;* S:'$D(X) X="N" S:X="A" X="E"
"RTN","PSIVOREN",63,0)
 S:'$D(X) X="N" S:"AF"[X X="E"
"RTN","PSIVOREN",64,0)
 I $G(PSIVCOPY) S X="N"
"RTN","PSIVOREN",65,0)
 S P("NAT")=$$ENNOO^PSJUTL5(X)
"RTN","PSIVOREN",66,0)
 K:P("NAT")=-1 P("NAT")
"RTN","PSIVOREN",67,0)
 Q
"RTN","PSIVOREN",68,0)
CLINIC ;Ask clinic where outpt is being seen for DSS
"RTN","PSIVOREN",69,0)
 K P("CLIN") NEW X1,X2,X,PSJDT,DIC,Y
"RTN","PSIVOREN",70,0)
 S X1=DT,X2=-7 D C^%DTC S PSJDT=X
"RTN","PSIVOREN",71,0)
 S DIC("S")="I $P($G(^SC(Y,0)),U,3)=""C"",$S('$P($G(^(""I"")),U):1,($P($G(^(""I"")),U)>PSJDT):1,(($P($G(^(""I"")),U)<PSJDT)&($P($G(^(""I"")),U,2)]"""")&(DT>$P($G(^(""I"")),U,2))):1,1:0)"
"RTN","PSIVOREN",72,0)
 S DIC=44,DIC(0)="QEAZ",DIC("A")="Select CLINIC LOCATION: " D ^DIC
"RTN","PSIVOREN",73,0)
 I $S($D(DTOUT):1,$D(DUOUT):1,1:0) Q
"RTN","PSIVOREN",74,0)
 S:+Y>0 P("CLIN")=+Y,$P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=+Y
"RTN","PSIVOREN",75,0)
 Q
"RTN","PSIVOREN",76,0)
 ;
"RTN","PSIVOREN",77,0)
STIX(OST,OON,DFN) ; Check start index, cleanup old start
"RTN","PSIVOREN",78,0)
 I $G(OST),$G(OON) S OS="" F  S OS=$O(^PS(55,DFN,"IV","AIS",OS)) Q:'OS  D
"RTN","PSIVOREN",79,0)
 . Q:'$D(^PS(55,DFN,"IV","AIS",OS,+OON))
"RTN","PSIVOREN",80,0)
 . I $P($G(^PS(55,DFN,"IV",+OON,0)),"^",3)'=OS K ^PS(55,DFN,"IV","AIS",OS,+OON)
"RTN","PSIVOREN",81,0)
 Q
"RTN","PSIVORFA")
0^63^B26803761
"RTN","PSIVORFA",1,0)
PSIVORFA ;BIR/MLM-FILE/RETRIEVE ORDERS IN 53.1 ;26 Jun 98 / 9:16 AM
"RTN","PSIVORFA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,7,18,28,50,71,58,91,80,110**;16 DEC 97
"RTN","PSIVORFA",3,0)
 ;
"RTN","PSIVORFA",4,0)
 ; Reference to ^PS(52.7 supported by DBIA 2173.
"RTN","PSIVORFA",5,0)
 ; Reference to ^PS(52.6 supported by DBIA 1231.
"RTN","PSIVORFA",6,0)
 ; Reference to ^PS(51.1 supported by DBIA 2177.
"RTN","PSIVORFA",7,0)
 ; Reference to ^PS(51.2 supported by DBIA 2178.
"RTN","PSIVORFA",8,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVORFA",9,0)
 ; Reference to ^DIK is supported by DBIA 10013.
"RTN","PSIVORFA",10,0)
 ;
"RTN","PSIVORFA",11,0)
GT531(DFN,ON) ; Retrieve order data from 53.1 and place into local array
"RTN","PSIVORFA",12,0)
 ;
"RTN","PSIVORFA",13,0)
 NEW PSGOES S PSGOES=1
"RTN","PSIVORFA",14,0)
 F X="CUM","LF","LFA","LF","PRNTON" S P(X)=""
"RTN","PSIVORFA",15,0)
 S Y=$G(^PS(53.1,+ON,0)),P(17)=$P(Y,U,9),P("LOG")=$P(Y,U,16),(P(21),P("21FLG"),PSJORIFN)=$P(Y,U,21)
"RTN","PSIVORFA",16,0)
 S P("RES")=$P(Y,U,24),P("OLDON")=$P(Y,U,25),P("NEWON")=$P(Y,U,26),P("FRES")=$P(Y,U,27)
"RTN","PSIVORFA",17,0)
 S P("MR")=$P(Y,U,3),P(6)=+$P(Y,U,2),Y=$G(^VA(200,+P(6),0)),$P(P(6),U,2)=$P(Y,U),Y=$G(^PS(51.2,+P("MR"),0)),$P(P("MR"),U,2)=$S($P(Y,U,3)]"":$P(Y,U,3),1:$P(Y,U))
"RTN","PSIVORFA",18,0)
 S Y=$G(^PS(53.1,+ON,.2)),P("PD")=$S(+Y:$P(Y,U)_U_$$OIDF^PSJLMUT1(+Y),1:""),P("DO")=$P(Y,U,2),P("NAT")=$P(Y,U,3),P("PRY")=$P(Y,U,4),(PSJCOM,P("PRNTON"))=$P(Y,U,8)
"RTN","PSIVORFA",19,0)
 S P("INS")=$G(^PS(53.1,+ON,.3))
"RTN","PSIVORFA",20,0)
 I $G(^PS(53.1,+ON,4))]"" S P("NINIT")=$P(^(4),U),P("NINITDT")=$P(^(4),U,2)
"RTN","PSIVORFA",21,0)
 NEW NAME S NAME=""
"RTN","PSIVORFA",22,0)
 I $D(^PS(53.1,+ON,1,1)) D DD^PSJLMUT1("^PS(53.1,+ON,",.NAME)
"RTN","PSIVORFA",23,0)
 S P("INS")=P("INS")_$S(P("INS")]"":" of ",1:"")_NAME
"RTN","PSIVORFA",24,0)
 S P("APPT")=$G(^PS(53.1,+ON,"DSS")),P("CLIN")=$P(P("APPT"),"^"),P("APPT")=$P(P("APPT"),"^",2)
"RTN","PSIVORFA",25,0)
 ;;S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$P(Y,U,6),Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",26,0)
 S Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(11)=$P(Y,U,5),P(15)=$P(Y,U,6),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4)
"RTN","PSIVORFA",27,0)
 S Y=$G(^PS(53.1,+ON,4)),P("CLRK")=$P(Y,U,7)_U_$P($G(^VA(200,+$P(Y,U,7),0)),U),P("REN")=$P(Y,U,9),X=P(9)
"RTN","PSIVORFA",28,0)
 I $P($G(^PS(53.1,+ON,0)),U,7)="P",(P(9)'["PRN") S P(9)=P(9)_" PRN"
"RTN","PSIVORFA",29,0)
 K PSGST,XT
"RTN","PSIVORFA",30,0)
 I P(9)]"",(P(11)="") D  S P(15)=$S($G(XT)]""&'+$G(XT):XT,+$G(XT)>0:XT,1:1440),P(11)=Y
"RTN","PSIVORFA",31,0)
 . I $O(^PS(51.1,"APPSJ",P(9),0)) D DIC^PSGORS0 Q
"RTN","PSIVORFA",32,0)
 . I '$O(^PS(51.1,"APPSJ",P(9),0)) N NOECH,PSGSCH S NOECH=1 D EN^PSIVSP
"RTN","PSIVORFA",33,0)
 S Y=$G(^PS(53.1,+ON,8)),P(4)=$P(Y,U),P(23)=$P(Y,U,2),P("SYRS")=$P(Y,U,3),P(5)=$P(Y,U,4),P(8)=$P(Y,U,5),P(7)=$P(Y,U,7),P("IVRM")=$P(Y,U,8)
"RTN","PSIVORFA",34,0)
 S:'P("IVRM")&($D(PSIVSN)) P("IVRM")=+PSIVSN S Y=$G(^PS(59.5,+P("IVRM"),0)),$P(P("IVRM"),U,2)=$P(Y,U),Y=$G(^PS(53.1,+ON,9)),P("REM")=$P(Y,U),P("OPI")=$P(Y,U,2,3)
"RTN","PSIVORFA",35,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFA",36,0)
 S P("PACT")=$G(^PS(53.1,+ON,"A",1,0))
"RTN","PSIVORFA",37,0)
 ;;D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON) S (P(2),P(3))="" ;L -^PS(53.1,+ON)
"RTN","PSIVORFA",38,0)
 D GTDRG,GTOT^PSIVUTL(P(4)) D:'$D(PSJLABEL) GTPC(ON)
"RTN","PSIVORFA",39,0)
 Q
"RTN","PSIVORFA",40,0)
GTDRG ;
"RTN","PSIVORFA",41,0)
 K DRG F X="AD","SOL" S FIL=$S(X="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(53.1,+ON,X,Y)) Q:'Y  D
"RTN","PSIVORFA",42,0)
 .S (DRGI,DRG(X,0))=$G(DRG(X,0))+1,DRG=$G(^PS(53.1,+ON,X,Y,0)),ND=$G(^PS(FIL,+DRG,0)),DRGN=$P(ND,U),DRG(X,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFA",43,0)
 Q
"RTN","PSIVORFA",44,0)
 ;
"RTN","PSIVORFA",45,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFA",46,0)
 ;S:'$D(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL K ^PS(53.45,PSIVUP,4) I $O(^PS(53.1,+ON,12,0)) S %X="^PS(53.1,"_+ON_",12,",%Y="^PS(53.45,"_PSIVUP_",4," D %XY^%RCR
"RTN","PSIVORFA",47,0)
 Q
"RTN","PSIVORFA",48,0)
 ;
"RTN","PSIVORFA",49,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSIVORFA",50,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSIVORFA",51,0)
 ;;S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,21)=$S("AD"'[P(17):PSJORIFN,1:""),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",52,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSIVORFA",53,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7)_"^"_+P("IVRM"),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSIVORFA",54,0)
 S $P(ND(4),U,1,2)=$G(P("NINIT"))_U_$G(P("NINITDT"))
"RTN","PSIVORFA",55,0)
 S:+$G(P("CLIN")) $P(^PS(53.1,+ON,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFA",56,0)
 S:+$G(P("APPT")) $P(^PS(53.1,+ON,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFA",57,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P") I $G(^PS(53.1,+ON,2.5))="" N DUR S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S((PSJORD["P"):"P",1:"IV"),1) I DUR]"" S $P(^PS(53.1,+ON,2.5),"^",2)=DUR
"RTN","PSIVORFA",58,0)
 F X=0,2,4,8,9 S ^PS(53.1,+ON,X)=ND(X)
"RTN","PSIVORFA",59,0)
 ;;S:+P("PD") ^PS(53.1,+ON,.2)=+P("PD")_U_P("DO")
"RTN","PSIVORFA",60,0)
 S:'+$G(^PS(53.1,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSIVORFA",61,0)
 ;;K ^PS(53.1,+ON,12) I $O(^PS(53.45,PSIVUP,4,0)) S %X="^PS(53.45,"_PSIVUP_",4,",%Y="^PS(53.1,"_+ON_",12," D %XY^%RCR
"RTN","PSIVORFA",62,0)
 ;;K ^PS(53.45,+PSIVUP,4)
"RTN","PSIVORFA",63,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSIVORFA",64,0)
 K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSIVORFA",65,0)
 K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSIVORFA",66,0)
 S:P(15)="D" $P(^PS(53.1,+ON,2),U,6)="D"
"RTN","PSIVORFA",67,0)
 Q
"RTN","PSIVORFA",68,0)
 ;
"RTN","PSIVORFA",69,0)
UPD100 ; Update order data in file 100
"RTN","PSIVORFA",70,0)
 D:'$D(PSJIVORF) ORPARM^PSIVOREN Q:'PSJIVORF
"RTN","PSIVORFA",71,0)
 ;* S ORIFN=PSJORIFN,PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE K ORETURN ;; F X="OREVENT","ORSTS","ORSTRT","ORSTOP","ORPK","ORPCL","ORNP","ORPK" S ORETURN(X)=@X
"RTN","PSIVORFA",72,0)
 S PSJORL=$$ENORL^PSJUTL($G(VAIN(4))) D SET^PSIVORFE
"RTN","PSIVORFA",73,0)
 Q
"RTN","PSIVORFA",74,0)
 ;
"RTN","PSIVORFA",75,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSIVORFA",76,0)
 K ^PS(53.1,+ON,DRGT) S ^PS(53.1,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSIVORFA",77,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFA",78,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFA",79,0)
 .S ^PS(53.1,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+ON,DRGT,+DRG,0)=Y
"RTN","PSIVORFA",80,0)
 Q
"RTN","PSIVORFB")
0^64^B29007552
"RTN","PSIVORFB",1,0)
PSIVORFB ;BIR/MLM-FILE/RETRIEVE ORDERS IN ^PS(55 ;25 Sep 98 / 2:24 PM
"RTN","PSIVORFB",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,28,68,58,85,110**;16 DEC 97
"RTN","PSIVORFB",3,0)
 ;
"RTN","PSIVORFB",4,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORFB",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORFB",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVORFB",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSIVORFB",8,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVORFB",9,0)
 ; Reference to ^VA(200 is supported by DBIA #10060.
"RTN","PSIVORFB",10,0)
 ; Reference to ^DIC is supported by DBIA #10006.
"RTN","PSIVORFB",11,0)
 ; Reference to ^DIK is supported by DBIA #10013.
"RTN","PSIVORFB",12,0)
 ;
"RTN","PSIVORFB",13,0)
NEW55 ; Get new order number in 55.
"RTN","PSIVORFB",14,0)
 N DA,DD,DO,DIC,DLAYGO,X,Y
"RTN","PSIVORFB",15,0)
 I $D(^PS(55,+DFN)),'$D(^PS(55,+DFN,0)) D ENSET0^PSGNE3(+DFN)
"RTN","PSIVORFB",16,0)
 S DIC="^PS(55,",DIC(0)="LN",DLAYGO=55,(DINUM,X)=+DFN D ^DIC Q:Y<0
"RTN","PSIVORFB",17,0)
LOCK0 F  L +^PS(55,DFN,"IV",0):0 I  Q
"RTN","PSIVORFB",18,0)
 S ND=$S($D(^PS(55,DFN,"IV",0)):^(0),1:"^55.01") F DA=$P(ND,"^",3)+1:1 W "." I '$D(^PS(55,DFN,"IV",DA)) S $P(ND,"^",3)=DA,$P(ND,"^",4)=$P(ND,"^",4)+1,^PS(55,DFN,"IV",0)=ND Q
"RTN","PSIVORFB",19,0)
 L +^PS(55,DFN,"IV",+DA):0 E  G LOCK0
"RTN","PSIVORFB",20,0)
 S ^PS(55,DFN,"IV",+DA,0)=+DA,^PS(55,DFN,"IV","B",+DA,+DA)=""
"RTN","PSIVORFB",21,0)
 L -^PS(55,DFN,"IV",0) S ON55=+DA_"V"
"RTN","PSIVORFB",22,0)
 Q
"RTN","PSIVORFB",23,0)
 ;
"RTN","PSIVORFB",24,0)
SET55 ; Move data from local variables to 55.
"RTN","PSIVORFB",25,0)
 I '$D(ON55) W !,"*** Can't create this order at this time ***" Q
"RTN","PSIVORFB",26,0)
 N DA,DIK,ND,PSIVACT,PSIVDUR
"RTN","PSIVORFB",27,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON55,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSIVORFB",28,0)
 S ND(.3)=$G(P("INS")),ND(2.5)="" I $G(PSGORD) S PSIVDUR=$$GETDUR^PSJLIVMD(DFN,PSGORD,$E(PSGORD,$L(PSGORD)),1) I PSIVDUR]"" S ND(2.5)="^"_PSIVDUR
"RTN","PSIVORFB",29,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSIVORFB",30,0)
 F X=0,1,2.5,3,.2,.3 S ^PS(55,DFN,"IV",+ON55,X)=ND(X)
"RTN","PSIVORFB",31,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSIVORFB",32,0)
 S X=^PS(55,DFN,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(P("LOG"),"^"),"."),$P(X,"^",8)="A",^(0)=X
"RTN","PSIVORFB",33,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,11)=+P("CLRK")
"RTN","PSIVORFB",34,0)
 S:+$G(P("CLIN")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFB",35,0)
 S:+$G(P("APPT")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFB",36,0)
 S:+$G(P("NINIT")) ^PS(55,DFN,"IV",+ON55,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSIVORFB",37,0)
 ;S:'$D(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL K ^PS(55,DFN,"IV",+ON55,5) I $O(^PS(53.45,PSIVUP,4,0)) S %X="^PS(53.45,"_PSIVUP_",4,",%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSIVORFB",38,0)
 I '$G(PSIVCHG)!($G(PSJREN)&($G(PSIVCHG)=2)) I $G(P("PON")),P("PON")'=ON55 D
"RTN","PSIVORFB",39,0)
 . N X S X=$S(P("PON")["P":"^PS(53.1,+P(""PON""),12,0)",P("PON")["V"&$G(PSJREN):"^PS(55,DFN,""IV"",+P(""PON""),5,0)",1:"") Q:X=""
"RTN","PSIVORFB",40,0)
 . I $O(@X) S %X=X,%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSIVORFB",41,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSIVORFB",42,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSIVORFB",43,0)
 I $G(PSJCOM),$G(PSJCOMSI),$G(PSJORD)["V" K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSIVORFB",44,0)
 . N PSJCHILD S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  S PSJCHILD(+PSJCHILD)=PSJCOM
"RTN","PSIVORFB",45,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(PSJCHILD(PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSIVORFB",46,0)
 .. Q:PSJCHILD=PSJORD  K DR,DA,DIE,ORD S DR="31////"_$P($G(P("OPI")),"^",1,2),DA(1)=DFN
"RTN","PSIVORFB",47,0)
 .. N ON,ON55 S (ON,ON55)=+PSJCHILD_"V" S:+$G(PSJPINIT)'>0 PSJPINIT=DUZ S PSIVALT=1,PSIVAL="COMPLEX ORDER" D ENTACT^PSIVAL D
"RTN","PSIVORFB",48,0)
 ... I $P($G(^PS(55,DFN,"IV",+ON55,3)),"^")'=$P(P("OPI"),"^") S P("FC")="OTHER PRINT INFO^"_$P($G(^(3)),"^")_U_$P(P("OPI"),"^") D GTFC^PSIVORAL
"RTN","PSIVORFB",49,0)
 ... I $D(^PS(55,DFN,"IV",+ON55,0)) S ^PS(55,DFN,"IV",+ON55,3)=P("OPI") D EN1^PSJHL2(DFN,"XX",ON55)
"RTN","PSIVORFB",50,0)
 Q
"RTN","PSIVORFB",51,0)
 ;
"RTN","PSIVORFB",52,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSIVORFB",53,0)
 K ^PS(55,DFN,"IV",+ON55,DRGT) S ^PS(55,DFN,"IV",+ON55,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSIVORFB",54,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFB",55,0)
 .S Y=^PS(55,DFN,"IV",+ON55,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFB",56,0)
 .S ^PS(55,DFN,"IV",+ON55,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(55,DFN,"IV",+ON55,DRGT,+DRG,0)=Y
"RTN","PSIVORFB",57,0)
 Q
"RTN","PSIVORFB",58,0)
GT55 ; Retrieve data from 55 into local array
"RTN","PSIVORFB",59,0)
 K DRG,DRGN,P S:'$D(ON55) ON55=ON S P("REN")="",Y=$G(^PS(55,DFN,"IV",+ON55,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVORFB",60,0)
 S P("21FLG")=P(21)
"RTN","PSIVORFB",61,0)
 S P("PON")=ON55,PSJORIFN=P(21),P(6)=P(6)_U_$P($G(^VA(200,+P(6),0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,DFN,"IV",+ON55,1))
"RTN","PSIVORFB",62,0)
 S Y=$G(^PS(55,DFN,"IV",+ON55,2)),P("LOG")=$P(Y,U),P("IVRM")=$P(Y,U,2)_U_$P($G(^PS(59.5,+$P(Y,U,2),0)),U)
"RTN","PSIVORFB",63,0)
 S P("CLRK")=$P(Y,U,11)_U_$P($G(^VA(200,+$P(Y,U,11),0)),U),P("RES")=$P(Y,U,8),P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,DFN,"IV",+ON55,3))
"RTN","PSIVORFB",64,0)
 S P("INS")=$G(^PS(55,DFN,"IV",+ON55,.3))
"RTN","PSIVORFB",65,0)
 S P("CLIN")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^")
"RTN","PSIVORFB",66,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFB",67,0)
 D:'$D(PSJLABEL) GTPC(ON55) S ND=$G(^PS(55,DFN,"IV",+ON55,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$$OIDF^PSJLMUT1(+ND)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2),P("PRY")=$P(ND,U,4),P("NAT")=$P(ND,U,5),(PSJCOM,P("PRNTON"))=$P(ND,U,8)
"RTN","PSIVORFB",68,0)
 I P("PRY")="D",'+P("IVRM") S P("IVRM")=+$G(PSIVSN)_U_$P($G(^PS(59.5,+$G(PSIVSN),0)),U)
"RTN","PSIVORFB",69,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U)) D GTCUM
"RTN","PSIVORFB",70,0)
 D GTDRG,GTOT^PSIVUTL(P(4))
"RTN","PSIVORFB",71,0)
K ; Kill and exit.
"RTN","PSIVORFB",72,0)
 K FIL,ND
"RTN","PSIVORFB",73,0)
 Q
"RTN","PSIVORFB",74,0)
GTDRG ; Get drug info and place in DRG(.
"RTN","PSIVORFB",75,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,DFN,"IV",+ON55,DRGT,Y)) Q:'Y  D
"RTN","PSIVORFB",76,0)
 .; naked ref below refers to line above
"RTN","PSIVORFB",77,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1
"RTN","PSIVORFB",78,0)
 .S DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFB",79,0)
 Q
"RTN","PSIVORFB",80,0)
 ;
"RTN","PSIVORFB",81,0)
GTCUM ; Retrieve dispensing info.
"RTN","PSIVORFB",82,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,9)),P("LF")=$P(ND,U),P("LFA")=$P(ND,U,2),P("CUM")=$P(ND,U,3)
"RTN","PSIVORFB",83,0)
 Q
"RTN","PSIVORFB",84,0)
 ;
"RTN","PSIVORFB",85,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFB",86,0)
 ;S:'$D(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL K ^PS(53.45,PSIVUP,4)
"RTN","PSIVORFB",87,0)
 ;K ^PS(53.45,PSIVUP,4) I $O(^PS(55,DFN,"IV",+ON,5,0)) S %X="^PS(55,"_DFN_",""IV"","_+ON_",5,",%Y="^PS(53.45,"_PSIVUP_",4," D %XY^%RCR
"RTN","PSIVORFB",88,0)
 Q
"RTN","PSIVORFB",89,0)
 ;
"RTN","PSIVORFB",90,0)
SETNEW ; Create new order and set
"RTN","PSIVORFB",91,0)
 D NEW55,SET55
"RTN","PSIVORFB",92,0)
 Q
"RTN","PSIVORFE")
0^94^B12682889
"RTN","PSIVORFE",1,0)
PSIVORFE ;BIR/MLM-IV FLUID ORDER ENTRY FOR OE/RR FRONT DOOR. ;26 NOV 97 / 9:55 AM 
"RTN","PSIVORFE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,81,110**;16 DEC 97
"RTN","PSIVORFE",3,0)
 ;
"RTN","PSIVORFE",4,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSIVORFE",5,0)
 ;
"RTN","PSIVORFE",6,0)
EN ; Entry pt. to create new IV Fluid order.
"RTN","PSIVORFE",7,0)
 S PSJORNP=$G(ORNP) D PS^PSIVOREN Q:PSJORPF  F  D NEWORD Q:DONE
"RTN","PSIVORFE",8,0)
 D DONE^PSIVORA1
"RTN","PSIVORFE",9,0)
 Q
"RTN","PSIVORFE",10,0)
 ;
"RTN","PSIVORFE",11,0)
NEWORD ; Create new IV Fluid order.
"RTN","PSIVORFE",12,0)
 D SETUP S EDIT=58,PSIVOK="" D EDIT^PSIVEDT I '$D(DRG("SOL")) S DONE=1 Q
"RTN","PSIVORFE",13,0)
 ; Removed reference to tag 66 of PSIVEDT-backdoor Pharm Prov comments
"RTN","PSIVORFE",14,0)
 S EDIT="57^59",PSIVOK=58 D EDIT^PSIVEDT Q:DONE
"RTN","PSIVORFE",15,0)
 K DA,DIC,ON,P("OLDON") W !!,"...transcribing this order..." D ENGNN^PSGOETO S ON=DA D PUT531^PSIVORFA L -^PS(53.1,+ON) W !
"RTN","PSIVORFE",16,0)
 Q
"RTN","PSIVORFE",17,0)
 ;
"RTN","PSIVORFE",18,0)
GTFLDS ;Ask field no.s to be edited.
"RTN","PSIVORFE",19,0)
 N PSGEFN F X=1:1:$L(EDIT,U) S PSGEFN(X)=$P(EDIT,U,X)_U_$S($P(EDIT,U,X)=999:"Edit OE/RR Fields",1:$$CODES2^PSIVUTL(53.1,$P(EDIT,U,X)))
"RTN","PSIVORFE",20,0)
 S Y=$P($G(XQORNOD(0)),"=",2)
"RTN","PSIVORFE",21,0)
 S PSGEFN=1_":"_$L(EDIT,U),PSJDTYP=$E(PSIVAC,1) D:Y="" ENEFA^PSGON K PSJDTYP I '$G(Y) S:PSIVAC="OE" DONE=1 S PSJEDFLG=1 Q
"RTN","PSIVORFE",22,0)
 S X=EDIT,EDIT="" F X1=1:1:$L(Y,",") S:$P(X,U,$P(Y,",",X1)) $P(EDIT,"^",X1)=$P(X,U,$P(Y,",",X1))
"RTN","PSIVORFE",23,0)
 N PSIVRENW S PSIVRENW=1
"RTN","PSIVORFE",24,0)
 D EDIT^PSIVEDT
"RTN","PSIVORFE",25,0)
 K PSIVRENW
"RTN","PSIVORFE",26,0)
 Q
"RTN","PSIVORFE",27,0)
 ;
"RTN","PSIVORFE",28,0)
SET ; Set variables needed to create/update orders in the ORDERS file (100).
"RTN","PSIVORFE",29,0)
 Q
"RTN","PSIVORFE",30,0)
 ;*** NO LONGER NEEDED IN 5.0
"RTN","PSIVORFE",31,0)
 N DRGT,PLN,X K OREVENT,ORETURN,ORSTRT,ORSTOP,ORTX
"RTN","PSIVORFE",32,0)
 S ORL=$$ENORL^PSJUTL($G(VAIN(4)))
"RTN","PSIVORFE",33,0)
 S ORLOG=P("LOG"),ORSTRT=P(2),OREVENT=$S('P(3):"",1:P(3)_";E"),ORSTOP=P(3),ORNP=+P(6),P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I")
"RTN","PSIVORFE",34,0)
 D GTOT^PSIVUTL(P(4)) ;* S ORPCL=$P(P("OT"),U,2)
"RTN","PSIVORFE",35,0)
 ;* S Y=P(17),ORSTS=$S("AO"[Y:6,Y="E":7,Y="H":3,Y="D":1,Y="U":11,1:5),ORVP=DFN_";DPT(",ORPK=+ON_$S(ORSTS=5:"P",ORSTS=11:"P",1:"V")
"RTN","PSIVORFE",36,0)
SORTX ;Set up ORTX(.
"RTN","PSIVORFE",37,0)
 Q
"RTN","PSIVORFE",38,0)
 ;*** NO LONGER NEEDED IN 5.0
"RTN","PSIVORFE",39,0)
 I $E(P("OT"))="H" D
"RTN","PSIVORFE",40,0)
 .S ORTX(1)="* TPN * in ",PLN=2 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  S ORTX(PLN)=$S($P($G(DRG("SOL",X)),U,2)]"":$P(DRG("SOL",X),U,2),1:"*NF*"),PLN=PLN+1
"RTN","PSIVORFE",41,0)
 .S ORTX(PLN)=$S(P(8)]"":P(8),1:P(9)),PLN=PLN+1
"RTN","PSIVORFE",42,0)
 I $E(P("OT"))="F" D ORTXF
"RTN","PSIVORFE",43,0)
 I $E(P("OT"))="I" S ORTX(1)=$P(P("PD"),U,2),ORTX(2)="Give: "_$P(P("MR"),U,2)_" "_$S(P(9)]"":P(9),1:P(8)),PLN=3
"RTN","PSIVORFE",44,0)
 S ORTX(1)=$S($G(P("FRES"))="R":"RENEWED -",$G(P("RES"))="R":"RENEWAL -",1:"")_ORTX(1)
"RTN","PSIVORFE",45,0)
 ;I $D(^PS(53.45,+$G(PSIVUP),4)) F PC=0:0 S PC=$O(^PS(53.45,PSIVUP,4,PC)) Q:'PC  S ORTX(PLN)=$G(^PS(53.45,PSIVUP,4,PC,0)),PLN=PLN+1
"RTN","PSIVORFE",46,0)
 Q
"RTN","PSIVORFE",47,0)
 ;
"RTN","PSIVORFE",48,0)
ORTXF ; Set up ORTX( for Fluids.
"RTN","PSIVORFE",49,0)
 Q
"RTN","PSIVORFE",50,0)
 ;*** NO LONGER NEEDED IN 5.0
"RTN","PSIVORFE",51,0)
 N SOLF
"RTN","PSIVORFE",52,0)
 S PLN=1 F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  D
"RTN","PSIVORFE",53,0)
 .S ORTX(PLN)=$S($P(DRG(DRGT,DRGI),U,2)="":"*NF*",1:$P(DRG(DRGT,DRGI),U,2)_" "_$P(DRG(DRGT,DRGI),U,3)),PLN=PLN+1 I DRGT="SOL",('$G(SOLF)) S ORTX(PLN-1)="in "_ORTX(PLN-1),SOLF=1
"RTN","PSIVORFE",54,0)
 S ORTX(PLN)=$S(P(8)]"":P(8),1:P(9)),PLN=PLN+1
"RTN","PSIVORFE",55,0)
 Q
"RTN","PSIVORFE",56,0)
 ;
"RTN","PSIVORFE",57,0)
SETUP ; Initialize variables.
"RTN","PSIVORFE",58,0)
 K DRG D NEWENT S DRGN="" F X=2,3,5,7,8,9,11,15,23,"AD","DO","IVRM","MR","NEWON","PC","PD","OLDON","OPI","REM","REN","SI","SOL","SYRS" S P(X)=""
"RTN","PSIVORFE",59,0)
 S PSJORSTS=11,P("OT")="F^",P("RES")="N",P(4)="A",P(17)="U",Y=$G(^VA(200,+PSJORNP,0)),P(6)=+PSJORNP_U_$P(Y,U)
"RTN","PSIVORFE",60,0)
 ;; S PSJORSTS=11,P("OT")="F^"_$O(^ORD(101,"B","PSJI OR PAT FLUID OE",0))_";ORD(101,",P("RES")="N",P(4)="A",P(17)="U",Y=$G(^VA(200,+PSJORNP,0)),P(6)=+PSJORNP_U_$P(Y,U)
"RTN","PSIVORFE",61,0)
 Q
"RTN","PSIVORFE",62,0)
 ;
"RTN","PSIVORFE",63,0)
NEWENT ; Get login date/entry code for new order
"RTN","PSIVORFE",64,0)
 S P("LOG")=$$DATE^PSJUTL2(),P("CLRK")=DUZ_U_$P($G(^VA(200,DUZ,0)),U)
"RTN","PSIVORFE",65,0)
 Q
"RTN","PSIVPRO")
0^65^B34459076
"RTN","PSIVPRO",1,0)
PSIVPRO ;BIR/PR,MLM-PROFILE AN ORDER ;01 OCT 96 / 9:48 AM
"RTN","PSIVPRO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**38,58,85,110**;16 DEC 97
"RTN","PSIVPRO",3,0)
 ;
"RTN","PSIVPRO",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVPRO",5,0)
 ;        
"RTN","PSIVPRO",6,0)
 ;Needs DFN and ^TMP("PSIV",$J) array
"RTN","PSIVPRO",7,0)
 S PSJLN=1,PSIVX2=0
"RTN","PSIVPRO",8,0)
 S PSIVST=$O(^TMP("PSIV",$J,0)),X="",(PSIVON,PS)=0 D REACT I PSIVST]"" F PSIVX1=1:1 D PSIVST Q:'PSIVON  D PR
"RTN","PSIVPRO",9,0)
 S ^TMP("PSJPRO",$J,0)=PSIVX2,VALMCNT=PSJLN-1
"RTN","PSIVPRO",10,0)
 I $G(PSIVBR)="D ^PSIVOPT" S VALM("TITLE")="IV Order Entry"
"RTN","PSIVPRO",11,0)
 E  S VALM("TITLE")="IV Profile"
"RTN","PSIVPRO",12,0)
QUIT ; Kill and exit.
"RTN","PSIVPRO",13,0)
 S ON=X K ADM,AL,DRG,GMRA,GMRAL,PSIVST,PSIVX1,PSIVX2,Y,NAD,N0,X3,X4,X5
"RTN","PSIVPRO",14,0)
 Q
"RTN","PSIVPRO",15,0)
 ;
"RTN","PSIVPRO",16,0)
PSIVST ;
"RTN","PSIVPRO",17,0)
 S PSIVON=$O(^TMP("PSIV",$J,PSIVST,PSIVON)) I 'PSIVON S PSIVST=$O(^TMP("PSIV",$J,PSIVST_"Z")) I PSIVST]"" S PSIVON=$O(^TMP("PSIV",$J,PSIVST,0)) D HDL
"RTN","PSIVPRO",18,0)
 Q
"RTN","PSIVPRO",19,0)
REACT ;
"RTN","PSIVPRO",20,0)
 S PSJL="#   Additive",PSJL=$$SETSTR^VALM1("Last fill",PSJL,32,9)
"RTN","PSIVPRO",21,0)
 S PSJL=$$SETSTR^VALM1("Type",PSJL,49,4),PSJL=$$SETSTR^VALM1(" Start   Stop  Stat",PSJL,54,19)
"RTN","PSIVPRO",22,0)
 S PSJL=$$SETSTR^VALM1("Renew",PSJL,74,5)
"RTN","PSIVPRO",23,0)
 D SETTMP^PSJLMPRI
"RTN","PSIVPRO",24,0)
HDL ; Display type heading.
"RTN","PSIVPRO",25,0)
 S PSJL=""
"RTN","PSIVPRO",26,0)
 D ACL:PSIVST="A",POL:PSIVST="P",POCL:PSIVST="PD",NVL:PSIVST="N",NVCL:PSIVST="ND",NOL:PSIVST="X",NOC:PSIVST="" S X=""
"RTN","PSIVPRO",27,0)
 S PSJL=$E(PSJL,1,79) D SETTMP^PSJLMPRI
"RTN","PSIVPRO",28,0)
 Q
"RTN","PSIVPRO",29,0)
 ;
"RTN","PSIVPRO",30,0)
PR ; Get & display order.
"RTN","PSIVPRO",31,0)
 S (ON,ON55)=9999999999-($S(PSIVST["P":$E(PSIVON,2,11),PSIVST["N":$E(PSIVON,2,11),1:PSIVON))_$S(PSIVST["P":"P",PSIVST["N":"P",1:"V") D @$S(PSIVST["P":"GT531^PSIVORFA(DFN,ON)",PSIVST["N":"GT531^PSIVORFA(DFN,ON)",1:"GT55^PSIVORFB")
"RTN","PSIVPRO",32,0)
 S X="",PS=PSIVX1 K ^TMP("PSIV",$J,PSIVST,PSIVON) S ^TMP("PSIV",$J,PSIVST_"B",PSIVX1)=$S(PSIVST["P":$E(PSIVON,2,11),PSIVST["N":$E(PSIVON,2,11),1:PSIVON)_$S(PSIVST["P":"P",PSIVST["N":"P",1:"V")
"RTN","PSIVPRO",33,0)
 I PSIVST["D" N PSJO,PSIVX3 S PSIVX3=PSIVX1,PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJCOM,PSJO)) Q:'PSJO  S ON=PSJO_"P" D GT531^PSIVORFA(DFN,ON),ENPL S PSIVX1=""
"RTN","PSIVPRO",34,0)
 I PSIVST["D" S PSIVX1=PSIVX3 Q
"RTN","PSIVPRO",35,0)
 ;
"RTN","PSIVPRO",36,0)
ENPL ;
"RTN","PSIVPRO",37,0)
 NEW MARX,DRUGNAME,X,XX
"RTN","PSIVPRO",38,0)
 S PSJL=$J(PSIVX1,4) I ON["P",(P("OT")'="F"),P(4)'="H" D  Q
"RTN","PSIVPRO",39,0)
 . I $D(VALMEVL) D
"RTN","PSIVPRO",40,0)
 .. N PSJFLAG
"RTN","PSIVPRO",41,0)
 .. S PSJFLAG=$P($S(ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:$G(^PS(53.1,+ON,.2))),U,7)
"RTN","PSIVPRO",42,0)
 .. I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSIVPRO",43,0)
 . D DRGDISP^PSJLMUT1(DFN,ON,34,59,.DRUGNAME,0)
"RTN","PSIVPRO",44,0)
 . NEW X F X=0:0 S X=$O(DRUGNAME(X)) Q:'X  S:X>1 PSJL="" S PSJL=$$SETSTR^VALM1(DRUGNAME(X),PSJL,$S(X=1:6,1:7),$S(X=1:34,1:65)) D:X=1 V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",45,0)
 S X=$J(PSIVX1,4)_$S(P("PRY")="D":" d",1:"  ")
"RTN","PSIVPRO",46,0)
 I ON["V" S XX=$G(^PS(55,DFN,"IV",+ON,4)) D
"RTN","PSIVPRO",47,0)
 . I +PSJSYSU=1,'+XX S X=X_"->"
"RTN","PSIVPRO",48,0)
 . I +PSJSYSU=3,'+$P(XX,U,4) S X=X_"->"
"RTN","PSIVPRO",49,0)
 S PSJL=X
"RTN","PSIVPRO",50,0)
 I $D(VALMEVL) D
"RTN","PSIVPRO",51,0)
 . N PSJFLAG
"RTN","PSIVPRO",52,0)
 . S PSJFLAG=$P($S(ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:$G(^PS(53.1,+ON,.2))),U,7)
"RTN","PSIVPRO",53,0)
 . I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSIVPRO",54,0)
 D AD,SOL
"RTN","PSIVPRO",55,0)
 Q
"RTN","PSIVPRO",56,0)
SOL ;
"RTN","PSIVPRO",57,0)
 NEW NAME,PSJNOAD,L ;S PSJNOAD=0,L=34
"RTN","PSIVPRO",58,0)
 S NAD=0 F  S NAD=$O(DRG("SOL",NAD)) Q:'NAD  D
"RTN","PSIVPRO",59,0)
 . K NAME S L=34,PSJNOAD=0
"RTN","PSIVPRO",60,0)
 . I '$D(DRG("AD",1)),NAD=1 S PSJNOAD=1,L=27
"RTN","PSIVPRO",61,0)
 . S:NAD=1 PSJL=$$SETSTR^VALM1("in",PSJL,6,11)
"RTN","PSIVPRO",62,0)
 . D NAME^PSIVUTL(DRG("SOL",NAD),L,.NAME,0)
"RTN","PSIVPRO",63,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  S:(NAD>1!(X>1)) PSJL="" S PSJL=$$SETSTR^VALM1(NAME(X),PSJL,9,34) D:X=1&PSJNOAD V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",64,0)
 . S PSJL=""
"RTN","PSIVPRO",65,0)
 Q
"RTN","PSIVPRO",66,0)
AD ;
"RTN","PSIVPRO",67,0)
 NEW NAME
"RTN","PSIVPRO",68,0)
 S NAD=0 F  S NAD=$O(DRG("AD",NAD)) Q:'NAD  D
"RTN","PSIVPRO",69,0)
 . K NAME
"RTN","PSIVPRO",70,0)
 . D NAME^PSIVUTL(DRG("AD",NAD),30,.NAME,1)
"RTN","PSIVPRO",71,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  S:(NAD>1!(X>1)) PSJL="" S PSJL=$$SETSTR^VALM1(NAME(X),PSJL,6,34) D:(NAD=1&(X=1)) V D SETTMP^PSJLMPRI
"RTN","PSIVPRO",72,0)
 . S PSJL=""
"RTN","PSIVPRO",73,0)
 Q
"RTN","PSIVPRO",74,0)
 ;
"RTN","PSIVPRO",75,0)
V S Y=$S(ON["V":$P($G(^PS(55,DFN,"IV",+ON,9)),U),1:"")
"RTN","PSIVPRO",76,0)
 I +Y>0 X ^DD("DD") S Y=$P(Y,",")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVPRO",77,0)
 E  S Y="**   N/P  **"
"RTN","PSIVPRO",78,0)
 S PSJL=$$SETSTR^VALM1(Y,PSJL,33,12)
"RTN","PSIVPRO",79,0)
 S PSJL=$$SETSTR^VALM1(" #"_$S(ON["V":+$P($G(^PS(55,DFN,"IV",+ON,9)),U,2),1:0),PSJL,46,3)
"RTN","PSIVPRO",80,0)
 S:PSIVX1]"" PSIVX2=PSIVX2+1
"RTN","PSIVPRO",81,0)
 D REST
"RTN","PSIVPRO",82,0)
 Q
"RTN","PSIVPRO",83,0)
ACL ;
"RTN","PSIVPRO",84,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" A c t i v e "
"RTN","PSIVPRO",85,0)
 Q
"RTN","PSIVPRO",86,0)
NVL ;
"RTN","PSIVPRO",87,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o n - V e r i f i e d "
"RTN","PSIVPRO",88,0)
 Q
"RTN","PSIVPRO",89,0)
NVCL ;
"RTN","PSIVPRO",90,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o n - V e r i f i e d  C o m p l e x "
"RTN","PSIVPRO",91,0)
 Q
"RTN","PSIVPRO",92,0)
POL ;
"RTN","PSIVPRO",93,0)
 F X3=1:1:71 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" P e n d i n g "
"RTN","PSIVPRO",94,0)
 Q
"RTN","PSIVPRO",95,0)
POCL ;
"RTN","PSIVPRO",96,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" P e n d i n g  C o m p l e x "
"RTN","PSIVPRO",97,0)
 Q
"RTN","PSIVPRO",98,0)
NOL ;
"RTN","PSIVPRO",99,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" N o t   A c t i v e "
"RTN","PSIVPRO",100,0)
 Q
"RTN","PSIVPRO",101,0)
NOC ;
"RTN","PSIVPRO",102,0)
 F X3=1:1:66 S PSJL=PSJL_"-" S:X3=34 PSJL=PSJL_" No current IV information "
"RTN","PSIVPRO",103,0)
 ;
"RTN","PSIVPRO",104,0)
 S PSJL=""
"RTN","PSIVPRO",105,0)
 Q
"RTN","PSIVPRO",106,0)
REST ;
"RTN","PSIVPRO",107,0)
 S PSJL=$$SETSTR^VALM1(P(4),PSJL,52,1)
"RTN","PSIVPRO",108,0)
 S PSJL=$$SETSTR^VALM1($E($$ENDTC^PSGMI(P(2)),1,5),PSJL,55,5)
"RTN","PSIVPRO",109,0)
 S PSJL=$$SETSTR^VALM1($E($$ENDTC^PSGMI(P(3)),1,5),PSJL,62,5)
"RTN","PSIVPRO",110,0)
 S PSJL=$$SETSTR^VALM1($S(P(17)="R"&(ON'["V"):"R/I",1:P(17)),PSJL,69,1)
"RTN","PSIVPRO",111,0)
 S PSJL=$$SETSTR^VALM1($S(ON["P":P("PRY"),1:""),PSJL,71,1)
"RTN","PSIVPRO",112,0)
 N PSJLRN S PSJLRN=$$LASTREN^PSJLMPRI(DFN,ON55) I PSJLRN S PSJLRN=$E($$ENDTC^PSGMI(PSJLRN),1,5) S PSJL=$$SETSTR^VALM1(PSJLRN,PSJL,74,5)
"RTN","PSIVPRO",113,0)
 Q
"RTN","PSIVPRO",114,0)
XCHK ;
"RTN","PSIVPRO",115,0)
 I $E(X)="?" W !!?2,"Select order",$E("s",PS'=1)," (1" W:PS>1 "-",PS W ")."
"RTN","PSIVPRO",116,0)
 I $E(X)="?" W:$S($O(^TMP("PSIV",$J,PSIVST,ON)):1,1:$O(^TMP("PSIV",$J,PSIVST))]"") "  Press RETURN to view more orders, or enter '^' to abort",!,"the profile, or 'A' to view Allergies." D:$E(X,1,2)="??" H2^PSGON K X Q
"RTN","PSIVPRO",117,0)
 S PSGLMT=PS D ^PSGON Q
"RTN","PSIVPRO",118,0)
 ;
"RTN","PSIVPRO",119,0)
PSPD S Y=$S(PSIVST'="P":$P($G(^PS(55,DFN,"IV",+ON,9)),U),1:"")
"RTN","PSIVPRO",120,0)
 X ^DD("DD") S:Y="" PSJL=$$SETSTR^VALM1("**   N/P  **",PSJL,36,12)
"RTN","PSIVPRO",121,0)
 S:Y'="" PSJL=$$SETSTR^VALM1($P(Y,","),PSJL,36,7),PSJL=$$SETSTR^VALM1($P($P(Y,"@",2),":",1,2),PSJL,43,45)
"RTN","PSIVPRO",122,0)
 S PSJL=PSJL_" #"_$S(Y="":0,1:$P(^PS(55,DFN,"IV",+ON,9),U,2))
"RTN","PSIVPRO",123,0)
 D REST
"RTN","PSIVPRO",124,0)
 Q
"RTN","PSIVQUI")
0^98^B19161013
"RTN","PSIVQUI",1,0)
PSIVQUI ;BIR/RGY,MLM-HANDLE QUICK CODE ENTRIES ;15 Dec 98 / 8:29 AM
"RTN","PSIVQUI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**21,50,65,73,76,93,104,110**;16 DEC 97
"RTN","PSIVQUI",3,0)
 ;
"RTN","PSIVQUI",4,0)
 ;Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIVQUI",5,0)
 ;Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSIVQUI",6,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231
"RTN","PSIVQUI",7,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173
"RTN","PSIVQUI",8,0)
 ;
"RTN","PSIVQUI",9,0)
 N X,PSIVSC1 S (PSIVAT,PSIVAAT,PSIVWAT)="",PSIVQUIY=Y,(X,PSIVQUIX)=PSIVX
"RTN","PSIVQUI",10,0)
 Q:'Y!(PSIVQUIX="")  S PSIVX0=$O(^PS(52.6,"C",X,+Y,0)),PSIVX0=$G(^PS(52.6,+Y,1,PSIVX0,0))
"RTN","PSIVQUI",11,0)
 I $P(PSIVX0,"^",5)]""!$P(PSIVX0,"^",6)!(P(5)) S PSIVAAT=$P(PSIVX0,"^",6)
"RTN","PSIVQUI",12,0)
 K PSIVX0 S Y=PSIVQUIY,Y(0)=$G(^PS(52.6,+Y,0)),X=PSIVQUIX
"RTN","PSIVQUI",13,0)
 Q:$S('$D(X):1,'$D(^PS(52.6,"C",X)):1,1:0)!'$D(P(4))
"RTN","PSIVQUI",14,0)
SET K DRG S PSIVX0=$S($D(^PS(52.6,+Y,1,+$O(^PS(52.6,"C",X,+Y,0)),0)):^(0),1:""),(DRGI,DRG("AD",0))=1,TDRG("AD",+Y,DRGI)="",DRG("AD",DRGI)=+Y_U_$P(Y(0),U)_U_$P(PSIVX0,"^",2)_U_U_$P(Y(0),U,13)_U_$P(Y(0),U,11)
"RTN","PSIVQUI",15,0)
 N PSIVQZ,PSIVADD0,PSIVSZ,PSIVAZ,PSIVXAT,PSIVSIEN,PSIVXW S PSIVSIEN=0
"RTN","PSIVQUI",16,0)
 I $P(PSIVX0,U,4)]"" S P("OPI")=$P(PSIVX0,U,4)
"RTN","PSIVQUI",17,0)
 I $P(PSIVX0,U,7)?1N.N D  Q:$G(PSGORQF)
"RTN","PSIVQUI",18,0)
 . S ND=$G(^PS(52.7,$P(PSIVX0,U,7),0))
"RTN","PSIVQUI",19,0)
 . W !!,"SOLUTION: ",$P(ND,U),!
"RTN","PSIVQUI",20,0)
 . N FIL S FIL="52.7",DRGTMP=$P(PSIVX0,U,7) D ORDERCHK^PSIVEDRG(DFN,ON55,1)
"RTN","PSIVQUI",21,0)
 . I $G(PSGORQF) S X="^",DONE=1 Q
"RTN","PSIVQUI",22,0)
 . S DRG("SOL",0)=1,DRG("SOL",1)=$P(PSIVX0,U,7)_U_$P(ND,U)_U_$P(ND,U,3)_U_U_$P(ND,U,13)_U_$P(ND,U,11),TDRG("SOL",$P(PSIVX0,U,7),1)=""
"RTN","PSIVQUI",23,0)
 I $P(PSIVX0,U,5)]""!P(5) S X=$P(PSIVX0,U,5)
"RTN","PSIVQUI",24,0)
 S PSIVQZ=$P(PSIVX0,U,5),PSIVQAZ=$P(PSIVX0,U,6),PSIVADD0=$G(^PS(52.6,+PSIVQUIY,0)),X=PSIVQZ
"RTN","PSIVQUI",25,0)
 S PSIVSZ=$P(PSIVADD0,"^",5),PSIVAZ=$P(PSIVADD0,"^",6)
"RTN","PSIVQUI",26,0)
 S PSIVAAT=$S(PSIVQZ]""&(PSIVQAZ]""):PSIVQAZ,PSIVQZ=""&(PSIVSZ]""):PSIVAZ,PSIVQZ=PSIVSZ:PSIVAZ,1:"")
"RTN","PSIVQUI",27,0)
 I $P(PSIVX0,U,5)']""!P(5) S X=$S(X]"":X,1:$P($G(^PS(52.6,+PSIVQUIY,0)),"^",5))
"RTN","PSIVQUI",28,0)
 ;
"RTN","PSIVQUI",29,0)
 ; If a sched was found, check all matching schedules 
"RTN","PSIVQUI",30,0)
 ; in 51.1 against $P(PSIVX0,"^",5), PSIVAAT, PSIVWAT
"RTN","PSIVQUI",31,0)
 I PSIVQZ]"",$G(X)'="" S ZZ=0 D
"RTN","PSIVQUI",32,0)
 .;if ZZ sched/times matches quick code sched/times, use the schedule
"RTN","PSIVQUI",33,0)
 .F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",34,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",35,0)
 ..I PSIVXAT=$P(PSIVX0,"^",6) S PSIVAT=$P(PSIVX0,"^",6),PSIVSIEN=ZZ
"RTN","PSIVQUI",36,0)
 ;
"RTN","PSIVQUI",37,0)
 ; If quick code has no schedule, check IV additive
"RTN","PSIVQUI",38,0)
 I PSIVAT="",$P(PSIVX0,"^",5)="",$G(X)'="" S ZZ=0 D 
"RTN","PSIVQUI",39,0)
 .F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",40,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",41,0)
 ..I PSIVAAT=PSIVXAT,(X=PSIVSZ) S PSIVAT=PSIVAAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",42,0)
 .I PSIVAT="",PSIVAAT]"" S PSIVAT=PSIVAAT,$P(PSIVX0,"^",6)=PSIVAAT,$P(PSIVX0,"^",5)=PSIVSZ,PSIVSIEN=-1
"RTN","PSIVQUI",43,0)
 ;
"RTN","PSIVQUI",44,0)
 ; If quick code has schedule, no admin times, use ward times
"RTN","PSIVQUI",45,0)
 I PSIVAT="",PSIVQZ]"",$G(X)'="" D
"RTN","PSIVQUI",46,0)
 .S PSIVXW=$S($G(WSCHADM):WSCHADM,$G(VAIN(4)):+VAIN(4),1:"") Q:'PSIVXW
"RTN","PSIVQUI",47,0)
 .S ZZ=0 F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",48,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",49,0)
 ..S PSIVWAT=$P($G(^PS(51.1,ZZ,1,+PSIVXW,0)),"^",2)
"RTN","PSIVQUI",50,0)
 ..I PSIVWAT]"" S PSIVAT=PSIVWAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",51,0)
 ;
"RTN","PSIVQUI",52,0)
 ; No ward times; go back to IV additive. If quick code has schedule,
"RTN","PSIVQUI",53,0)
 ; make sure it matches IV additive
"RTN","PSIVQUI",54,0)
 I PSIVAT="",PSIVAAT]"",PSIVWAT="",$G(X) D
"RTN","PSIVQUI",55,0)
 .S ZZ=0 F  S ZZ=$O(^PS(51.1,"AC","PSJ",X,ZZ)) Q:'ZZ!PSIVSIEN  D  Q:PSIVSIEN
"RTN","PSIVQUI",56,0)
 ..N PSIVXAT S PSIVXAT=$P(^PS(51.1,ZZ,0),"^",2) Q:PSIVXAT=""
"RTN","PSIVQUI",57,0)
 ..I (PSIVQZ=X&(PSIVQZ=PSIVSZ))!(PSIVQZ=""&(PSIVSZ]"")) I PSIVXAT=PSIVAAT D  Q
"RTN","PSIVQUI",58,0)
 ...S PSIVAT=PSIVAAT,PSIVSIEN=ZZ
"RTN","PSIVQUI",59,0)
 .I PSIVAT="" S PSIVAT=PSIVAAT,$P(PSIVX0,"^",6)=PSIVAAT,$P(PSIVX0,"^",5)=X,PSIVSIEN=-1
"RTN","PSIVQUI",60,0)
 I $G(PSIVSIEN) S Y=$S(PSIVSIEN>0:PSIVSIEN,1:"") N PSGOES S PSGOES=1
"RTN","PSIVQUI",61,0)
 I X="" S (Y,PSIVQUIY)=""
"RTN","PSIVQUI",62,0)
 S PSIVSPQF=1 D EN^PSIVSP K PSIVSPQF
"RTN","PSIVQUI",63,0)
 S P(11)=$S($P(PSIVX0,"^",6)]"":$P(PSIVX0,"^",6),(PSIVQZ]""&(PSIVWAT]"")):PSIVWAT,PSIVAAT]"":PSIVAAT,$G(P(11))]"":$G(P(11)),1:PSIVAT)
"RTN","PSIVQUI",64,0)
 S X=$P(PSIVX0,"^",3)
"RTN","PSIVQUI",65,0)
 I $P(PSIVX0,U,8) D
"RTN","PSIVQUI",66,0)
 .S P("MR")=+$P(PSIVX0,U,8)_U_$S($P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U,3):$P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U,3),1:$E($P($G(^PS(51.2,+$P(PSIVX0,U,8),0)),U),1,5))
"RTN","PSIVQUI",67,0)
 W " ",X D ENI^PSIVSP I '$D(X) W $C(7),"  --> Invalid infusion rate !!" I '$$SCHREQ^PSJLIVFD(.P) S P(15)=0
"RTN","PSIVQUI",68,0)
 I $$SCHREQ^PSJLIVFD(.P),'$$DOW^PSIVUTL($G(P(9))),'(P(15)>0) S P(15)=$$INTERVAL^PSIVUTL(.P)
"RTN","PSIVQUI",69,0)
 S PSIVOK="57^58^59^3^26^39^63^64^"_$S($E(P("OT"))="I":"101^109^",1:"")_"10^25^1"
"RTN","PSIVQUI",70,0)
 S P(17)="A",P(8)=$S($D(X):X,1:""),PSIVE=0,PSIVSTR="QUICK CODE",(DRG(2),Y)="",EDIT=$S(+P("MR"):"",1:"3^")_$P(EDIT,"64^",2) K ND,PSIVX0,PSIVSC,PSIVX
"RTN","PSIVQUI",71,0)
 Q
"RTN","PSIVSPDC")
0^66^B17130051
"RTN","PSIVSPDC",1,0)
PSIVSPDC ;BIR/PR,MV-SPEED DC IV ORDERS ;02 Mar 99 / 9:27 AM
"RTN","PSIVSPDC",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**23,29,38,58,110**;16 DEC 97
"RTN","PSIVSPDC",3,0)
 ;
"RTN","PSIVSPDC",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSIVSPDC",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSIVSPDC",6,0)
 ;
"RTN","PSIVSPDC",7,0)
EN ;Loop thru to find IV ien to DC
"RTN","PSIVSPDC",8,0)
 I $S(+PSJSYSU=3:0,+PSJSYSU=1:0,1:1) D  Q
"RTN","PSIVSPDC",9,0)
 . W !,"You're not allowed to DC orders." D PAUSE^VALM1
"RTN","PSIVSPDC",10,0)
 NEW ON,ON55,PSIVX,SORT,NAT,PSIVAL,PSJORD,PSGODDD,DIR
"RTN","PSIVSPDC",11,0)
 S PSGLMT=$O(^TMP("PSIV",$J,"XB",0))-1
"RTN","PSIVSPDC",12,0)
 S:PSGLMT<1 PSGLMT=$G(^TMP("PSJPRO",$J,0))
"RTN","PSIVSPDC",13,0)
 Q:'+PSGLMT
"RTN","PSIVSPDC",14,0)
 S DIR("?")="Enter the order number(s) to be Discontinued"
"RTN","PSIVSPDC",15,0)
 S DIR(0)="L^1:"_PSGLMT,DIR("A")="DISCONTINUE which orders" D ^DIR
"RTN","PSIVSPDC",16,0)
 S PSGODDD=Y Q:$D(DIRUT)
"RTN","PSIVSPDC",17,0)
 ;prompt for nature of order and requesting provider
"RTN","PSIVSPDC",18,0)
 D NATURE^PSIVOREN I '$D(P("NAT"))!'$$REQPROV^PSGOEC W !,$C(7),"No order(s) was DC." H 2 Q
"RTN","PSIVSPDC",19,0)
 S NAT=P("NAT") D COMMENT
"RTN","PSIVSPDC",20,0)
 N COMFLG,PSJCOM S PSJCOM=0
"RTN","PSIVSPDC",21,0)
 S SORT="" F  S SORT=$O(^TMP("PSIV",$J,SORT)) Q:SORT=""  F PSIVX=0:0 S PSIVX=$O(^TMP("PSIV",$J,SORT,PSIVX)) Q:'PSIVX  I PSGODDD[PSIVX S ON=^(PSIVX),ON=(9999999999-ON)_$E(ON,11,11) D
"RTN","PSIVSPDC",22,0)
 . D CHKCOM I COMFLG D PRNT Q
"RTN","PSIVSPDC",23,0)
 . D:'PSJCOM SPDCIV
"RTN","PSIVSPDC",24,0)
 Q
"RTN","PSIVSPDC",25,0)
SPDCIV ;Speed DC orders
"RTN","PSIVSPDC",26,0)
 S (PSJORD,ON55)=ON
"RTN","PSIVSPDC",27,0)
 I ON["V",$P($G(^PS(55,DFN,"IV",+ON55,.2)),U,4)="D" W !,"             *****        DONE ORDER        *****" D PRNT Q
"RTN","PSIVSPDC",28,0)
 I '$$LS^PSSLOCK(DFN,ON) D PRNT Q
"RTN","PSIVSPDC",29,0)
 I ON["V" D  Q
"RTN","PSIVSPDC",30,0)
 . S P(3)=$P($G(^PS(55,DFN,"IV",+ON55,0)),U,3)
"RTN","PSIVSPDC",31,0)
 . D NOW^%DTC Q:P(3)<%
"RTN","PSIVSPDC",32,0)
 . D D1^PSIVOPT2
"RTN","PSIVSPDC",33,0)
 . S PSIVALT=1,PSIVALCK="STOP",PSIVREA="D",ON=ON55 D LOG
"RTN","PSIVSPDC",34,0)
 . S:'$D(P("NAT")) P("NAT")=$G(PSJNOO) D HL^PSIVORA
"RTN","PSIVSPDC",35,0)
 . D UNL^PSSLOCK(DFN,ON)
"RTN","PSIVSPDC",36,0)
 .;;I $D(PSJNOO) S P("NAT")=PSJNOO D EN1^PSJHL2(DFN,"OC",PSJORD,"ORDER CANCELED")
"RTN","PSIVSPDC",37,0)
 N DA,DR,DIE,PSJND S DA=+PSJORD,PSJND=$G(^PS(53.1,DA,0)),P("OLDON")=$P(PSJND,U,25),DIE="^PS(53.1,",DR="28///"_$S($P(PSJND,U,27)="E":"DE",1:"D") D ^DIE
"RTN","PSIVSPDC",38,0)
 D HL^PSIVORA
"RTN","PSIVSPDC",39,0)
 D UNL^PSSLOCK(DFN,ON)
"RTN","PSIVSPDC",40,0)
 Q
"RTN","PSIVSPDC",41,0)
COMMENT ;Ask for activity log comments.
"RTN","PSIVSPDC",42,0)
 I $G(PSIVALT)=1,'$G(PSJUNDC) K DA,DIR S DIR(0)="55.04,.04" D ^DIR K DA,DIR S PSIVAL=$S($D(DIRUT):"",1:Y)
"RTN","PSIVSPDC",43,0)
 Q
"RTN","PSIVSPDC",44,0)
LOG ;Record activity log comments.
"RTN","PSIVSPDC",45,0)
 S:$G(PSIVALT)=2 PSIVAL="Action taken using OE/RR options." D ENTACT^PSIVAL
"RTN","PSIVSPDC",46,0)
 K DA,DIE,DR S DA(2)=DFN,DA(1)=+ON55,DA=PSIVLN,DIE="^PS(55,"_DFN_",""IV"","_+ON55_",""A"",",DR=".02////"_PSIVREA_";.03////"_$P(^VA(200,DUZ,0),U)_";.04////^S X=$G(PSIVAL)"_";.06////"_DUZ D ^DIE
"RTN","PSIVSPDC",47,0)
 D STOP^PSIVORAL ;* Record the stop dates
"RTN","PSIVSPDC",48,0)
 Q
"RTN","PSIVSPDC",49,0)
PRNT ; DISPLAY IV ORDER AND PRINT MESSAGE
"RTN","PSIVSPDC",50,0)
 N PSJLINE,PSJOC S PSJLINE=1
"RTN","PSIVSPDC",51,0)
 D DSPLORDV^PSJLMUT1(DFN,ON)
"RTN","PSIVSPDC",52,0)
 F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSIVSPDC",53,0)
 .W !,$G(PSJOC(ON,X))
"RTN","PSIVSPDC",54,0)
 W !,"             ***** NO ACTION TAKEN ON ORDER *****",!
"RTN","PSIVSPDC",55,0)
 Q
"RTN","PSIVSPDC",56,0)
CHKCOM ;Check to see if order is part of complex order series.
"RTN","PSIVSPDC",57,0)
 N PSJSTAT
"RTN","PSIVSPDC",58,0)
 S PSJCOM=$P($G(^PS(55,PSGP,"IV",+ON,.2)),U,8),COMFLG=0,PSJSTAT=$P($G(^(0)),"^",17)
"RTN","PSIVSPDC",59,0)
 Q:'PSJCOM  I "DE"[PSJSTAT Q
"RTN","PSIVSPDC",60,0)
 N PSJLINE,PSJOC S PSJLINE=1
"RTN","PSIVSPDC",61,0)
 D DSPLORDV^PSJLMUT1(DFN,ON)
"RTN","PSIVSPDC",62,0)
 W ! F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  D
"RTN","PSIVSPDC",63,0)
 .W !,$G(PSJOC(ON,X))
"RTN","PSIVSPDC",64,0)
 W !,"is part of a complex order. If you discontinue this order the following orders",!,"will be discontinued too (unless the stop date has already been reached)." D CMPLX^PSJCOM1(DFN,PSJCOM,ON)
"RTN","PSIVSPDC",65,0)
 F  W !!,"Do you want to discontinue this series of complex orders" S %=1 D YN^DICN Q:%
"RTN","PSIVSPDC",66,0)
 I %'=1 S COMFLG=1 Q
"RTN","PSIVSPDC",67,0)
 N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D  Q:COMFLG
"RTN","PSIVSPDC",68,0)
 .Q:OO=ON  I '$$LS^PSSLOCK(DFN,OO) S COMFLG=1 Q
"RTN","PSIVSPDC",69,0)
 Q:COMFLG
"RTN","PSIVSPDC",70,0)
 N O,OO S O=0,OO="" F  S O=$O(^PS(55,"ACX",PSJCOM,O)) Q:'O  F  S OO=$O(^PS(55,"ACX",PSJCOM,O,OO)) Q:OO=""  D
"RTN","PSIVSPDC",71,0)
 .I (OO["U") N PSGORD S PSGORD=OO D AC^PSGOECS
"RTN","PSIVSPDC",72,0)
 .I (OO["V") N PSGORD S (ON,PSGORD)=OO D SPDCIV^PSIVSPDC
"RTN","PSIVSPDC",73,0)
 .D UNL^PSSLOCK(DFN,PSGORD)
"RTN","PSIVUDL")
0^131^B23290210
"RTN","PSIVUDL",1,0)
PSIVUDL ;BIR/PR,MLM-IV ORDER INFORMATION FOR UNIT DOSE LABEL ;25 Nov 98 / 9:12 AM
"RTN","PSIVUDL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**21,58,110**;16 DEC 97
"RTN","PSIVUDL",3,0)
 ;
"RTN","PSIVUDL",4,0)
 ; References to ^PS(52.6 supported by DBIA #1231
"RTN","PSIVUDL",5,0)
 ; References to ^PS(52.7 supported by DBIA #2173
"RTN","PSIVUDL",6,0)
 ; References to ^PS(55 supported by DBIA #2191
"RTN","PSIVUDL",7,0)
 ;
"RTN","PSIVUDL",8,0)
 ;Needs DFN and PSJORD
"RTN","PSIVUDL",9,0)
EN(DFN,ON,PSJLWD,PSJLRB) ; Entry to print MAR label for all types of IV orders.
"RTN","PSIVUDL",10,0)
 N PSJLABEL,VAIN,VADM S (PSJACNWP,PSJLABEL)=1 D ENIV^PSJAC
"RTN","PSIVUDL",11,0)
 S PSJTM=$S(PSJLRB]"":$P($G(^PS(57.7,+PSJLWD,1,+$O(^PS(57.7,"AWRT",+PSJLWD,PSJLRB,0)),0)),U),1:""),PSJWGN=$P($G(^PS(57.5,+$O(^PS(57.5,"AB",+PSJLWD,0)),0)),U)
"RTN","PSIVUDL",12,0)
 K PSJLAT,ON55 D @$S(ON["V":"GT55^PSIVORFB",1:"GT531^PSIVORFA(DFN,ON)") S (MSG,PSJRPH,PSJLDT,PSJLR)="" S:ON["V" X=$G(^PS(55,DFN,"IV",+ON,7)),PSJLDT=+X,PSJLR=$P(X,U,2)
"RTN","PSIVUDL",13,0)
 I ON["P",(P("OPI")=""),$O(^PS(53.1,+ON,12,0)) F X=0:0 S X=$O(^PS(53.1,+ON,12,X)) Q:'X!($L(P("OPI"))>180)  S P("OPI")=P("OPI")_" "_$G(^(X,0))
"RTN","PSIVUDL",14,0)
 S PSJLAT=P(11),PSGLST=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I PSGLST'="O" S PSGLST=$S(P(9)["PRN":"P",1:"C")
"RTN","PSIVUDL",15,0)
 S:ON["P" PSGLST=""
"RTN","PSIVUDL",16,0)
 F X="LOG",2,3 S:P(X) P(X)=$$ENDTC1^PSGMI(P(X))
"RTN","PSIVUDL",17,0)
 D RPHINIT^PSGMIV(.PSJRPH)
"RTN","PSIVUDL",18,0)
 S X=P(17),(PSJLAT(1),PSJLAT(2),PSJLAT(4),PSJLAT(5))=$S(X="D"!(X="E"):"****",1:""),PSJLAT(3)=$S(X="D":"DC'D",X="E":"EX'D",1:""),PSJLAT(0)=$S(X="D":0,X="E":0,1:$L(PSJLAT,"-"))
"RTN","PSIVUDL",19,0)
 I PSJLAT(0) D
"RTN","PSIVUDL",20,0)
 .F X=1:1:5 S PSJLAT(X)=""
"RTN","PSIVUDL",21,0)
 .I PSJLAT(0)=1 S PSJLAT(3)=$P(PSJLAT,"-") Q
"RTN","PSIVUDL",22,0)
 .I PSJLAT(0)=2 S PSJLAT(1)=$P(PSJLAT,"-"),PSJLAT(5)=$P(PSJLAT,"-",2) Q
"RTN","PSIVUDL",23,0)
 .I PSJLAT(0)=3 S PSJLAT(1)=$P(PSJLAT,"-"),PSJLAT(3)=$P(PSJLAT,"-",2),PSJLAT(5)=$P(PSJLAT,"-",3) Q
"RTN","PSIVUDL",24,0)
 .F X=1:1:PSJLAT(0) S PSJLAT(X)=$P(PSJLAT,"-",X)
"RTN","PSIVUDL",25,0)
 ;
"RTN","PSIVUDL",26,0)
ENP ; Print MAR label for IV order.
"RTN","PSIVUDL",27,0)
 S PSGLRN=$S(ON["P":$G(^PS(53.1,+ON,4)),1:$G(^PS(55,DFN,"IV",+ON,4)))
"RTN","PSIVUDL",28,0)
 I $G(DFN),$G(ON) N PSGLREN S PSGLREN=+$$LASTREN^PSJLMPRI(DFN,ON)
"RTN","PSIVUDL",29,0)
 N PSGLRNDT S PSGLRNDT=$P(PSGLRN,"^",2),PSGLRN=+PSGLRN I PSGLRNDT,$G(PSGLREN) I $G(PSGLREN)>PSGLRNDT S PSGLRN=0
"RTN","PSIVUDL",30,0)
 I ON["P",P(2)="",+PSGLRN S X="P E N D I N G"
"RTN","PSIVUDL",31,0)
 E  S X=$S(P(2)]"":$E(P(2),1,5)_$E(P(2),9,14),1:"           ")_" |"_P(3)
"RTN","PSIVUDL",32,0)
 W $C(13),?1,$E(P("LOG"),1,5)," |",X,?36,"(",$E(VADM(1),1),$E(VADM(2),6,9),")",?42,"|",$G(PSJLAT(1)),?52,VADM(1),?88,$J($S(PSJLRB]"":PSJLRB,1:"*NF*"),12)
"RTN","PSIVUDL",33,0)
 S:'+PSGLRN PSGLRN="_____"
"RTN","PSIVUDL",34,0)
 I +PSGLRN,$D(^VA(200,+PSGLRN,0))#2 S X=^(0),X=$S($P(X,"^",2)]"":$P(X,"^",2),1:$P(X,"^")),PSGLRN=$S(X'[",":X,1:$E(X,$F(X,","))_$E(X))
"RTN","PSIVUDL",35,0)
 S PSJCNT=2,X=0,MSG="",PSJCONT="See next label for continuation"
"RTN","PSIVUDL",36,0)
 NEW NAME
"RTN","PSIVUDL",37,0)
 W ! F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D NAME^PSIVUTL(DRG("AD",X),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W ?1,NAME(Y) D NXTLNE(1) S:$P($G(^PS(52.6,+DRG("AD",+X),0)),U,9)]"" MSG=MSG_$P($G(^(0)),U,9)_" "
"RTN","PSIVUDL",38,0)
 ;*W:$G(DRG("SOL",0)) ?1,"in " F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D NAME^PSIVUTL(DRG("SOL",X),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  W ?4,NAME(Y) D NXTLNE(1)
"RTN","PSIVUDL",39,0)
 NEW PSJPRT2
"RTN","PSIVUDL",40,0)
 W:$G(DRG("SOL",0)) ?1,"in " F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D NAME^PSIVUTL(DRG("SOL",X),47,.NAME,1) F Y=0:0 S Y=$O(NAME(Y)) Q:'Y  D
"RTN","PSIVUDL",41,0)
 . W ?4,NAME(Y) D NXTLNE(1)
"RTN","PSIVUDL",42,0)
 . S PSJPRT2=$P(^PS(52.7,+DRG("SOL",X),0),U,4) I PSJPRT2]"" W !?7,PSJPRT2 D NXTLNE(1)
"RTN","PSIVUDL",43,0)
 I MSG]"" S P("OPI")=MSG_P("OPI") S:$L($P(P("OPI"),"^"))>180 $P(P("OPI"),"^")=$E($P(P("OPI"),"^"),1,177)_"..."
"RTN","PSIVUDL",44,0)
 W ?1,$P(P("MR"),U,2)," ",P(9)," ",P(8) I P("OPI")]""!$D(PSJLAT(PSJCNT+1))!(P(4)="C") D NXTLNE($S($L($P(P("OPI"),"^"))>22:1,P(4)'="C":0,1:$L($P(P("OPI"),"^"))))
"RTN","PSIVUDL",45,0)
 I P(4)="C" W "*CAUTION-CHEMOTHERAPY*" D:$L($P(P("OPI"),"^")) NXTLNE($L($P(P("OPI"),"^"))>22)
"RTN","PSIVUDL",46,0)
 I P("OPI")]"" W ?1,"" F Y=1:1:$L($P(P("OPI"),"^")," ") D
"RTN","PSIVUDL",47,0)
 .S Y1=$P($P(P("OPI"),"^")," ",Y) I $X+$L(Y1)>42 D NXTLNE($L($P($P(P("OPI"),"^")," ",Y))>23) W ?1
"RTN","PSIVUDL",48,0)
 .W Y1," "
"RTN","PSIVUDL",49,0)
 D:$X>24 NXTLNE(1)
"RTN","PSIVUDL",50,0)
 I $D(PSJLAT(PSJCNT+1)) F  Q:'$D(PSJLAT(PSJCNT+1))  D
"RTN","PSIVUDL",51,0)
 .I PSJCNT#5=0 W ?1,PSJCONT D NXTLNE(2) W ?1 Q
"RTN","PSIVUDL",52,0)
 .D NXTLNE($D(PSJLAT(PSJCNT+2)))
"RTN","PSIVUDL",53,0)
 I PSJCNT#5>0 F  Q:PSJCNT#5=0  D NXTLNE(0)
"RTN","PSIVUDL",54,0)
 W ?24,"RPH:",PSJRPH,?33," RN:",PSGLRN D NXTLNE($D(PSJLAT(PSJCNT+1))) W !
"RTN","PSIVUDL",55,0)
 ;* W ?24,"RPH:",$S(PSJRPH]"":PSJRPH,1:"_____"),?33," RN:_____" D NXTLNE($D(PSJLAT(PSJCNT+1))) W !
"RTN","PSIVUDL",56,0)
DONE ;
"RTN","PSIVUDL",57,0)
 K DRG,MSG,NL,ON55,PSJTM,P,PSJLAT,PSJRPH,PSJACNWP,PSJCNT,PSJLDT,PSJLR,PSJTM,PSJWGN,X,Y,Y1
"RTN","PSIVUDL",58,0)
 Q
"RTN","PSIVUDL",59,0)
NXTLNE(NL) ; Print info to right of drug (x=line number,NL=new label)
"RTN","PSIVUDL",60,0)
 N Y
"RTN","PSIVUDL",61,0)
 W:PSJCNT=2 ?42,PSGLST W ?43,"|",$G(PSJLAT(PSJCNT)) I PSJCNT=2 W ?52,$P(VADM(2),U,2),?70,$E($$ENDTC^PSGMI(+VADM(3)),1,8),"  (",VADM(4),")",?85,$J($S(PSJTM]"":PSJTM,1:"NOT FOUND"),15)
"RTN","PSIVUDL",62,0)
 I PSJCNT=3 W ?52,$S(VADM(5)]"":$P(VADM(5),U,2),1:"____"),?65,"DX: ",VAIN(9)
"RTN","PSIVUDL",63,0)
 I PSJCNT=4,PSJLDT S Y=PSJLR D
"RTN","PSIVUDL",64,0)
 .W ?52,$$ENDTC^PSGMI(PSJLDT)
"RTN","PSIVUDL",65,0)
 .W ?77,$S(Y="N":"NEW ",Y="R":"RENEWAL ",1:""),"ORDER ",$S(Y="AD":"AUTO-DC'ED",Y="N":"",Y="E":"EDITED",Y="DE":"DC'ED (EDIT)",Y["D":"DISCONTINUED",Y="H1":"ON HOLD",Y="H0":"OFF OF HOLD",Y="ARI":"AUTO-REINSTATED",Y="RI":"REINSTATED",1:"")
"RTN","PSIVUDL",66,0)
 I PSJCNT=5 W ?52,$S(PSJWGN]"":$E(PSJWGN,1,21),1:"NOT FOUND"),?79,$J($S($P(PSJLWD,U,2)]"":$P(PSJLWD,U,2),1:"NOT FOUND"),21)
"RTN","PSIVUDL",67,0)
 W !,?1 S PSJCNT=PSJCNT+1 I NL=2 W !,?1 S NL=0
"RTN","PSIVUDL",68,0)
 I PSJCNT#5=0,NL W ?1,PSJCONT D NXTLNE(2)
"RTN","PSIVUDL",69,0)
 Q
"RTN","PSIVUTL")
0^67^B27927769
"RTN","PSIVUTL",1,0)
PSIVUTL ;BIR/MLM-IV UTILITIES ;07 SEP 97 / 2:17 PM 
"RTN","PSIVUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**69,58,81,85,110**;16 DEC 97
"RTN","PSIVUTL",3,0)
 ;
"RTN","PSIVUTL",4,0)
 ; Reference to ^DD("DD" is supported by DBIA 10017.
"RTN","PSIVUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSIVUTL",6,0)
 ; Reference to ^PS(52.6 is supported y DBIA 1231.
"RTN","PSIVUTL",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSIVUTL",8,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSIVUTL",9,0)
 ;
"RTN","PSIVUTL",10,0)
DRGSC(Y,PSJSCT) ; Called to set DIC("S") when selecting  Orderable Items.
"RTN","PSIVUTL",11,0)
 N OK,ND,NDU,NDI S OK=0
"RTN","PSIVUTL",12,0)
 S ND=$G(^PS(50.7,+Y,0))
"RTN","PSIVUTL",13,0)
 ;I $P(ND,U,3) S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL",14,0)
 S OK=$S('$P(ND,U,4):1,$P(ND,U,4)>DT:1,1:0)
"RTN","PSIVUTL",15,0)
 Q OK
"RTN","PSIVUTL",16,0)
 ;
"RTN","PSIVUTL",17,0)
IVDRGSC(Y) ; Set DIC("S") for IV additive/solution selection.
"RTN","PSIVUTL",18,0)
 ;;N Y S Y="S X(1)=$G(^(0)),X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0),$D(^PSDRUG(+$P(X(1),U,2),0)) S X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0)"
"RTN","PSIVUTL",19,0)
 ; Naked reference below refers to full reference in Y, which is either ^PS(52.6, or ^PS(52.7
"RTN","PSIVUTL",20,0)
 N Y S Y="S X(1)=$G(^(0)),X(2)=$G(^(""I"")) I $S('X(2):1,X(2)>DT:1,1:0),$D(^PSDRUG(+$P(X(1),U,2),0)) S X(2)=$G(^(""I"")) I $S('+$P(X(1),U,11):0,'X(2):1,X(2)>DT:1,1:0)"
"RTN","PSIVUTL",21,0)
 Q Y
"RTN","PSIVUTL",22,0)
 ;
"RTN","PSIVUTL",23,0)
ENU(Y) ;Get IV additive strength.
"RTN","PSIVUTL",24,0)
 N X S X=$P(^PS(52.6,+Y,0),U,3),Y=$$CODES^PSIVUTL(X,52.6,2)
"RTN","PSIVUTL",25,0)
 Q Y
"RTN","PSIVUTL",26,0)
 ;
"RTN","PSIVUTL",27,0)
CODES(PSJCD,PSJF,PSJFLD) ; Get name from code. 
"RTN","PSIVUTL",28,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",29,0)
 D FIELD^DID(PSJF,PSJFLD,"","POINTER","PSJDD")
"RTN","PSIVUTL",30,0)
 S Y=$G(PSJDD("POINTER")) K PSJDD
"RTN","PSIVUTL",31,0)
 S Y=$P($P(";"_Y,";"_PSJCD_":",2),";")
"RTN","PSIVUTL",32,0)
 Q Y
"RTN","PSIVUTL",33,0)
 ;
"RTN","PSIVUTL",34,0)
CODES1(PSJCD,PSJF,PSJFLD)       ;Check to see if code is valid.
"RTN","PSIVUTL",35,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",36,0)
 D FIELD^DID(PSJF,PSJFLD,"","POINTER","PSJDD")
"RTN","PSIVUTL",37,0)
 I PSJDD("POINTER")'[PSJCD_":"  K PSJDD Q 0
"RTN","PSIVUTL",38,0)
 K PSJDD Q 1
"RTN","PSIVUTL",39,0)
 ;
"RTN","PSIVUTL",40,0)
CODES2(PSJF,PSJFLD)     ;Get field name
"RTN","PSIVUTL",41,0)
 ; PSJF = one of following files: ^PS(55, ^PS(53.1, ^PS(52.6
"RTN","PSIVUTL",42,0)
 D FIELD^DID(PSJF,PSJFLD,"","LABEL","PSJDD")
"RTN","PSIVUTL",43,0)
 Q PSJDD("LABEL")
"RTN","PSIVUTL",44,0)
 ;
"RTN","PSIVUTL",45,0)
GTPCI(Y) ; Set up "work" area for provider comments.
"RTN","PSIVUTL",46,0)
 N DIC,DINUM,DLAYGO,X S DIC="^PS(53.45,",DIC(0)="LNZ",DLAYGO=53.45,(DINUM,X)=+DUZ D ^DIC
"RTN","PSIVUTL",47,0)
 Q Y
"RTN","PSIVUTL",48,0)
 ;
"RTN","PSIVUTL",49,0)
WDTE(Y) ; Format and print date.
"RTN","PSIVUTL",50,0)
 I 'Y S Y="******"
"RTN","PSIVUTL",51,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSIVUTL",52,0)
 Q Y
"RTN","PSIVUTL",53,0)
GTOT(Y) ; Get order type & protocol
"RTN","PSIVUTL",54,0)
 S P("OT")=$S(Y="A":"F",Y="H":"H",1:"I")
"RTN","PSIVUTL",55,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I" Q
"RTN","PSIVUTL",56,0)
 Q
"RTN","PSIVUTL",57,0)
 ;
"RTN","PSIVUTL",58,0)
PIV(ON) ; Display IV orders.
"RTN","PSIVUTL",59,0)
 N DRG,ON55,P,PSJORIFN,TYP,X,Y S TYP="?" I ON["V" D
"RTN","PSIVUTL",60,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSIVUTL",61,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSIVUTL",62,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSIVUTL",63,0)
 .W $S($P($G(^PS(55,DFN,"IV",+ON,.2)),U,4)="D":" d",1:"  ")
"RTN","PSIVUTL",64,0)
 .S X=$G(^PS(55,DFN,"IV",+ON,4)) I +PSJSYSU,'+$P(X,U,$S(+PSJSYSU=3:4,1:++PSJSYSU)) W "->"
"RTN","PSIVUTL",65,0)
 I ON=+ON N O S O="" F  S O=$O(^PS(53.1,"ACX",ON,O)) Q:O=""  D
"RTN","PSIVUTL",66,0)
 . S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+O,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) D PIV(O_"P") W !
"RTN","PSIVUTL",67,0)
 I ON["P" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) I $E(P("OT"))="I" D  Q
"RTN","PSIVUTL",68,0)
 . NEW MARX,PSIVX D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,54,.MARX,0)
"RTN","PSIVUTL",69,0)
 . F PSIVX=0:0 S PSIVX=$O(MARX(PSIVX)) Q:'PSIVX  W @($S(PSIVX=1:"?9",1:"!?11")),MARX(PSIVX) D:PSIVX=1 PIV1
"RTN","PSIVUTL",70,0)
 NEW DRGX S DRGX=0 F  S DRGX=$O(DRG("AD",DRGX)) Q:'DRGX  D PIVAD
"RTN","PSIVUTL",71,0)
SOL ;
"RTN","PSIVUTL",72,0)
 NEW NAME
"RTN","PSIVUTL",73,0)
 S DRGX=0 F  S DRGX=$O(DRG("SOL",DRGX)) Q:'DRGX  D
"RTN","PSIVUTL",74,0)
 . D NAME(DRG("SOL",DRGX),39,.NAME,0)
"RTN","PSIVUTL",75,0)
 . W:($D(DRG("AD",1))!(DRGX>1)) ! W:DRGX=1 ?9,"in "
"RTN","PSIVUTL",76,0)
 . F X=0:0 S X=$O(NAME(X)) Q:'X  W ?12 W NAME(X) I X=1,DRGX=1,'$D(DRG("AD",1)) D PIV1
"RTN","PSIVUTL",77,0)
 Q
"RTN","PSIVUTL",78,0)
PIVAD ; Print IV Additives.
"RTN","PSIVUTL",79,0)
 NEW NAME,PSGX
"RTN","PSIVUTL",80,0)
 D NAME(DRG("AD",DRGX),39,.NAME,1)
"RTN","PSIVUTL",81,0)
 F PSGX=0:0 S PSGX=$O(NAME(PSGX)) Q:'PSGX  W:(DRGX'=1!(PSGX'=1)) ! W ?9,NAME(PSGX) I PSGX=1,DRGX=1 D PIV1
"RTN","PSIVUTL",82,0)
 Q
"RTN","PSIVUTL",83,0)
 ;
"RTN","PSIVUTL",84,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSIVUTL",85,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSIVUTL",86,0)
 I '$D(PSJEXTP) W ?50,TYP,?53,P(2),?60,P(3),?67,P(17) Q
"RTN","PSIVUTL",87,0)
 W ?50,TYP,?53,P(2),?63,P(3),?73,P(17)
"RTN","PSIVUTL",88,0)
 Q
"RTN","PSIVUTL",89,0)
59 ; Validate the Infusion rate entered using IV Quick order code.
"RTN","PSIVUTL",90,0)
 N I F I=2,3,5,7,8,9,11,15,23 S P(I)=""
"RTN","PSIVUTL",91,0)
 S P(4)="A",P(8)=$P($G(^PS(57.1,PSJQO,1)),U,5)
"RTN","PSIVUTL",92,0)
 I $G(^PS(57.1,PSJQO,4,1,0)) S DRG("SOL",1)=^(0),DRG("SOL",0)=1
"RTN","PSIVUTL",93,0)
 I X["?" S F1=53.1,F2=59 D ENHLP^PSIVORC1 G 59
"RTN","PSIVUTL",94,0)
 I X]"" D ENI^PSIVSP S:$D(X) P(8)=X
"RTN","PSIVUTL",95,0)
 Q
"RTN","PSIVUTL",96,0)
WRTDRG(X,L)       ; Format and print drug name, strength and bottle no.
"RTN","PSIVUTL",97,0)
 N Y S Y=" "_$P(X,U,3) S:$P(X,U,4) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL",98,0)
 Q $E($P(X,U,2),1,(L-$L(Y)))_Y
"RTN","PSIVUTL",99,0)
 ;
"RTN","PSIVUTL",100,0)
NAME(X,L,MARX,AD)        ; Format Additive display.
"RTN","PSIVUTL",101,0)
 ;INPUT : X=DRG("AD",DRG)  L=Display length   AD=for Addtive(1/0)
"RTN","PSIVUTL",102,0)
 ;OUTPUT: AD(X)  if X=2 that means there is a second line to display
"RTN","PSIVUTL",103,0)
 N Y K MARX S Y=$P(X,U,3) S:(AD&$P(X,U,4)) Y=Y_" ("_$P(X,U,4)_")"
"RTN","PSIVUTL",104,0)
 ;* S:'AD Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@"))
"RTN","PSIVUTL",105,0)
 I 'AD!('$O(DRG("SOL",0))) D
"RTN","PSIVUTL",106,0)
 .I $G(PSJL)["  in" S Y=Y_" "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@")) Q
"RTN","PSIVUTL",107,0)
 .I $G(DRGX)]"",DRGX'>1 S Y=Y_"  "_$S(P(4)="P"!($G(P(23))="P")!$G(P(5)):P(9),1:$P(P(8),"@")) Q
"RTN","PSIVUTL",108,0)
 ;I ($L($P(X,U,2))+$L(Y)+1)>L S NAME(1)=$P(X,U,2),NAME(2)="   "_Y Q
"RTN","PSIVUTL",109,0)
 I ($L($P(X,U,2))+$L(Y)+1)>L D TXT^PSGMUTL($P(X,U,2)_" "_Y,L) S:AD MARX(2)="   "_MARX(2) Q
"RTN","PSIVUTL",110,0)
 S MARX(1)=$P(X,U,2)_" "_Y
"RTN","PSIVUTL",111,0)
 Q
"RTN","PSIVUTL",112,0)
 ;
"RTN","PSIVUTL",113,0)
INTERVAL(IVAR) ;
"RTN","PSIVUTL",114,0)
 N P,X,PSGOES M P=IVAR S X=$G(P(9)),PSGOES=1
"RTN","PSIVUTL",115,0)
 D EN^PSIVSP S IVAR(15)=$S($G(P(15)):P(15),1:1440)
"RTN","PSIVUTL",116,0)
 Q IVAR(15)
"RTN","PSIVUTL",117,0)
 ;
"RTN","PSIVUTL",118,0)
DOW(SCHED) ;
"RTN","PSIVUTL",119,0)
 Q:SCHED="" 0
"RTN","PSIVUTL",120,0)
 N P9,PSIVX,X S PSIVX=0 S P9=SCHED
"RTN","PSIVUTL",121,0)
 I +$O(^PS(51.1,"APPSJ",SCHED,0)) S PSIVX=1 S P9=$P(SCHED,"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVUTL",122,0)
 . I '("MON,TUE,WED,THU,FRI,SAT,SUN"[$P(P9,"-",X)) S PSIVX=0 Q
"RTN","PSIVUTL",123,0)
 Q:PSIVX +PSIVX
"RTN","PSIVUTL",124,0)
 I '$D(^PS(51.1,"APPSJ",SCHED)) S PSIVX=1,P9=$P(SCHED,"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVUTL",125,0)
 . I '(",MO,TU,WE,TH,FR,SA,SU,"[(","_$P(P9,"-",X)_",")) S PSIVX=0 Q
"RTN","PSIVUTL",126,0)
 Q +PSIVX
"RTN","PSIVWL")
0^118^B32751610
"RTN","PSIVWL",1,0)
PSIVWL ;BIR/RGY,PR-COMPILE AND PRT WARD LIST ;13 MAR 97 / 10:18 AM
"RTN","PSIVWL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**41,54,74,84,93,110**;16 DEC 97
"RTN","PSIVWL",3,0)
 ;
"RTN","PSIVWL",4,0)
 ; Reference to ^PS(51.1 is supported by DBIA 2177
"RTN","PSIVWL",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVWL",6,0)
 ;
"RTN","PSIVWL",7,0)
 K WRD W !!,"Run ward list for DATE: TODAY//" R X:DTIME S:'$T X="^" S:X="" X="T" G Q:X["^" K %DT S %DT="XE" D ^%DT G:Y<0 PSIVWL
"RTN","PSIVWL",8,0)
 S PSIVDT=Y\1 I Y<DT D ENRSET^PSIVWL1 G PSIVWL
"RTN","PSIVWL",9,0)
 D ^PSIVWL1 I '$D(PSIVOD)!('$D(PSIVCD)) G Q
"RTN","PSIVWL",10,0)
 I PSIVPR'=ION D QUE G Q
"RTN","PSIVWL",11,0)
DEQ ;
"RTN","PSIVWL",12,0)
 N PSJOK
"RTN","PSIVWL",13,0)
 D NOW^%DTC S Y=% L +^PS(55,"PSIVWL",PSIVSN):1 E  W:$Y @IOF W !!,"**** WARNING --- WARD LIST NOT RUN, LABEL RUN IN PROGRESS ****" G Q
"RTN","PSIVWL",14,0)
 D:$D(XRTL) T0^%ZOSV S NOFLG=0
"RTN","PSIVWL",15,0)
 S PSIVT="" D ENINIT^PSIVWL1 F PSIV1=0:0 S PSIVT=$O(PSIVOD(PSIVT)) Q:PSIVT=""  S PSIVDT1=PSIVOD(PSIVT)-.0001 F PSIV1=0:0 S PSIVDT1=$O(^PS(55,"AIV",PSIVDT1)) Q:'PSIVDT1  D MAN1
"RTN","PSIVWL",16,0)
 I $D(XRTL) S XRTN="PSIVWL" D T1^%ZOSV
"RTN","PSIVWL",17,0)
 D ENT^PSIVWL1
"RTN","PSIVWL",18,0)
Q L -^PS(55,"PSIVWL",PSIVSN) W:'$D(PSIVPR)&($Y) @IOF K MI,ON,NOFLG,PSCT,PSGCNT,PSGSA,PSIVMT,DIC,PSIVRUN,%DT,PSIVDT1,PSIVDT,PSIV,PSIVOD
"RTN","PSIVWL",19,0)
 K PSIVCD,PSM,%T,D,DFN,I,P,PSIV1,VAERR,X,Y,Z,Z1,Z2,ZTSK S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSIVWL",20,0)
 Q
"RTN","PSIVWL",21,0)
SETP S Y=^PS(55,DFN,"IV",ON,0) F X=1:1:23 S P(X)=$P(Y,"^",X)
"RTN","PSIVWL",22,0)
 N A,PSJST
"RTN","PSIVWL",23,0)
 S PSJST=$$ONE^PSJBCMA(DFN,ON,P(9))
"RTN","PSIVWL",24,0)
 S PSJOK=1 I PSJST="O" S A=0 F  S A=$O(^PS(55,DFN,"IV",+ON,"LAB",A)) Q:A=""  I $P($G(^(A,0)),"^",3)=1 S PSJOK=0 Q
"RTN","PSIVWL",25,0)
 Q
"RTN","PSIVWL",26,0)
MAN1 F DFN=0:0 S DFN=$O(^PS(55,"AIV",PSIVDT1,DFN)) Q:'DFN  S PSIV("NME")=$P($G(^DPT(DFN,0)),U) D INP^VADPT F ON=0:0 S ON=$O(^PS(55,"AIV",PSIVDT1,DFN,ON)) Q:'ON  Q:NOFLG=1  D SETP I PSJOK D MAN3
"RTN","PSIVWL",27,0)
 Q
"RTN","PSIVWL",28,0)
MAN2 S ^PS(55,"PSIVWL",PSIVSN,$S($P(VAIN(4),U,2)]"":$P(VAIN(4),U,2),1:"Outpatient IV"),P(4)_PSIVOD(P(4)),DFN,ON)=$S($P(P(8),"@",2)'=0:PSGCNT,1:0)_"^"_PSGSA_"^"_$P(^PS(55,DFN,"IV",ON,0),"^",16)
"RTN","PSIVWL",29,0)
 S $P(^(0),"^",16)=$P(^PS(55,DFN,"IV",ON,0),"^",16)+PSGCNT Q
"RTN","PSIVWL",30,0)
 Q
"RTN","PSIVWL",31,0)
MAN3 ;I P(4)=""!(P(4)'=PSIVT) S NOFLG=1 D NOW^%DTC S PSIVRUN=$E(%,1,12) K %,%I,%H D HDR^PSIVWL1 W !!,"****NO DATA FOUND FOR THIS REPORT!***" Q
"RTN","PSIVWL",32,0)
 Q:P(4)=""!(P(4)'=PSIVT)
"RTN","PSIVWL",33,0)
 Q:'$D(PSIVOD(P(4)))!("DPN"[P(17))!($S($D(^PS(55,DFN,"IV",ON,2)):PSIVSN'=$P(^(2),"^",2),1:0))
"RTN","PSIVWL",34,0)
 I "OH"[P(17) S PSGSA="",PSGCNT=0 D MAN2 Q
"RTN","PSIVWL",35,0)
 S CD=$S(PSIVCD(PSIVT)<P(3):PSIVCD(PSIVT),1:P(3)),OD=$S(P(2)>PSIVOD(PSIVT):P(2),1:PSIVOD(PSIVT)) D ENP3,MAN2 Q
"RTN","PSIVWL",36,0)
QUE S ZTIO=PSIVPR,ZTDESC="IV WARD LIST",ZTRTN="DEQ^PSIVWL",PSIVT="" F I=0:0 S PSIVT=$O(PSIVMT(PSIVT)) Q:PSIVT=""  S (ZTSAVE("PSIVCD("""_PSIVT_""")"),ZTSAVE("PSIVMT("""_PSIVT_""")"),ZTSAVE("PSIVOD("""_PSIVT_""")"))=""
"RTN","PSIVWL",37,0)
 F X="PSIVSN","PSIVDT","PSIVSITE","PSJSYSW0","PSJSYSP0","PSJSYSU" S ZTSAVE(X)=""
"RTN","PSIVWL",38,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"Queued." Q
"RTN","PSIVWL",39,0)
ENP3 ;
"RTN","PSIVWL",40,0)
 ;Needs DFN,ON P-array, OD and CD
"RTN","PSIVWL",41,0)
 Q:'P(2)!'P(3)  S PSIVMI=P(15),PSIVSD=P(2),PSGSA="",PSGCNT=0 S:PSIVMI>1440 P(11)=""
"RTN","PSIVWL",42,0)
 I P(11) G:"AH"[P(4) QSP F X="STAT","ONCE","NOW","ONE-TIME","ONE TIME","ONETIME","1-TIME","1 TIME","1-TIME" I $S(X=P(9):1,1:(P(9)[X)),PSIVSD'<OD,PSIVSD'>CD S PSGSA=PSIVSD_" " G QSP
"RTN","PSIVWL",43,0)
 I P(4)="P"!(P(5))!(P(23)="P"),P(11) D CHK,ENP4 G QSP
"RTN","PSIVWL",44,0)
 G:P(11) QSP I PSIVMI,OD\1>(PSIVSD\1) S X1=OD,X2=PSIVSD D ^%DTC I X>1 S X=X-1,PSIVMIN=X*1440\PSIVMI*PSIVMI D ENT S PSIVSD=Y
"RTN","PSIVWL",45,0)
 I PSIVSD'<OD,PSIVSD<CD S Y=PSIVSD,PSGSA=Y_" "
"RTN","PSIVWL",46,0)
 I PSIVMI F X=0:0 S PSIVMIN=PSIVMI D ENT Q:Y>CD!(Y=CD&(CD=P(3)))  S PSIVSD=Y I Y'<OD,Y'>CD S:$L(PSGSA)+$L(Y)'>240 PSGSA=PSGSA_$S(PSGSA'="":"."_$P(Y,".",2),1:Y)_" "
"RTN","PSIVWL",47,0)
QSP S PSGCNT=$L(PSGSA," ")-1 K PSIVMI,OD,CD,PSIVSD Q
"RTN","PSIVWL",48,0)
CHK F Y=1:1 Q:$L(P(11))>240!($P(P(11),"-",Y)="")  S $P(P(11),"-",Y)=$P(P(11),"-",Y)_$E("0000",1,4-$L($P(P(11),"-",Y)))
"RTN","PSIVWL",49,0)
 Q
"RTN","PSIVWL",50,0)
ENP4 ;
"RTN","PSIVWL",51,0)
 Q:PSIVSD>CD     S PSIVSD=OD\1 I $G(P(2)),PSIVSD<P(2) S PSIVSD=P(2)\1
"RTN","PSIVWL",52,0)
 NEW ODCDWD,ADM,ADMSD,ADMTM,PSIVX,P9
"RTN","PSIVWL",53,0)
 F X=OD,CD D DW^%DTC S ODCDWD=$G(ODCDWD)_$E(X,1,3)_U
"RTN","PSIVWL",54,0)
 I +$O(^PS(51.1,"APPSJ",P(9),0)) S PSIVX=1 S P9=$P(P(9),"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVWL",55,0)
 . I '("MON,TUE,WED,THU,FRI,SAT,SUN"[$P(P9,"-",X)) S PSIVX=0 Q
"RTN","PSIVWL",56,0)
 . I ODCDWD[$E($P(P9,"-",X),1,2) D
"RTN","PSIVWL",57,0)
 .. S ADMSD=$S($P(ODCDWD,"^")[$P(P9,"-",X):OD,1:CD)\1
"RTN","PSIVWL",58,0)
 .. F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:ADMSD)_"."_ADMTM_" "
"RTN","PSIVWL",59,0)
 .. ;F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:PSIVSD)_"."_ADMTM_" "
"RTN","PSIVWL",60,0)
 Q:+$G(PSIVX)
"RTN","PSIVWL",61,0)
 I '$D(^PS(51.1,"APPSJ",P(9))) S PSIVX=1,P9=$P(P(9),"@") F X=1:1:$L(P9,"-") D  Q:'$G(PSIVX)
"RTN","PSIVWL",62,0)
 . I '(",MO,TU,WE,TH,FR,SA,SU"[(","_$P(P9,"-",X)_",")) S PSIVX=0 Q
"RTN","PSIVWL",63,0)
 . I ODCDWD[$E($P(P9,"-",X),1,2) D
"RTN","PSIVWL",64,0)
 .. S ADMSD=$S($P(ODCDWD,"^")[$P(P9,"-",X):OD,1:CD)\1
"RTN","PSIVWL",65,0)
 .. F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:ADMSD)_"."_ADMTM_" "
"RTN","PSIVWL",66,0)
 .. ;F ADM=1:1:$L(P(11),"-") S ADMTM=$P(P(11),"-",ADM) I OD'>(ADMSD_"."_ADMTM),(CD'<(ADMSD_"."_ADMTM)) S PSGSA=PSGSA_$S(PSGSA'="":"",1:PSIVSD)_"."_ADMTM_" "
"RTN","PSIVWL",67,0)
 Q:+$G(PSIVX)
"RTN","PSIVWL",68,0)
 F Y=1:1 S (PSIVMI,MI)=$P(P(11),"-",Y),PSIVSD=+(PSIVSD\1_"."_MI) Q:PSIVSD>CD  X:MI="" "S X1=PSIVSD,X2=1 D C^%DTC S PSIVSD=X,Y=0" I MI,PSIVSD'<OD,PSIVSD'>CD,PSIVSD'=P(3),'P(7) S PSGSA=PSGSA_$S(PSGSA'="":"."_$P(PSIVSD,".",2),1:PSIVSD)_" "
"RTN","PSIVWL",69,0)
 ; INSTALL PRECEEDING LINE WITH VERSION 17.3 OF FILEMAN
"RTN","PSIVWL",70,0)
 Q
"RTN","PSIVWL",71,0)
ENT ;PSIVMIN=# of min. to add or sub, PSIVSD=date to add or sub from in FM format -- Answer ret. in 'Y'
"RTN","PSIVWL",72,0)
 S X2=PSIVMIN\1440,HOUR=(PSIVMIN-(1440*X2))\60,MIN=(PSIVMIN-(1440*X2)-(60*HOUR))#$S(PSIVMIN<0:-60,1:60),X1=PSIVSD\1,HR=$E(PSIVSD,9,10),MI=$E(PSIVSD,11,12)
"RTN","PSIVWL",73,0)
 S:$L(HR)=1 HR=HR_0 S:$L(MI)=1 MI=MI_0 S MI=MI+MIN S:MI>59 MI=MI-60,HR=HR+1
"RTN","PSIVWL",74,0)
 S:MI<0 MI=MI+60,HR=HR-1 S HR=HR+HOUR S:HR>23 HR=HR-24,X2=X2+1 S:HR<0 HR=HR+24,X2=X2-1 S:HR+MI=0 X2=X2-1,HR=24,MI=0 S:HR<10 HR=0_HR S:MI<10 MI=0_MI S X=X1 D:X2 C^%DTC S X=$P(X,".") S Y=+(X_"."_HR_MI)
"RTN","PSIVWL",75,0)
 ; install with verson 17.3 of fm
"RTN","PSIVWL",76,0)
 K HR,MI,X1,X2,HOUR,MIN,PSIVMIN,O,MI Q
"RTN","PSJCOM")
0^38^B38439683
"RTN","PSJCOM",1,0)
PSJCOM ;BIR/CML3-FINISH COMPLEX UNIT DOSE ORDERS ENTERED THROUGH OE/RR ;02 Feb 2001  12:20 PM
"RTN","PSJCOM",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSJCOM",3,0)
 ;
"RTN","PSJCOM",4,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJCOM",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOM",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJCOM",7,0)
 ; Reference to ^%RCR is supported by DBIA 10022.
"RTN","PSJCOM",8,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOM",9,0)
 ; Reference to ^TIUEDIT is supported by DBIA 2410.
"RTN","PSJCOM",10,0)
 ;
"RTN","PSJCOM",11,0)
UPD ;
"RTN","PSJCOM",12,0)
 Q:'PSJCOM
"RTN","PSJCOM",13,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",14,0)
 I PSGST="",(PSGSCH="NOW"!(PSGSCH="ONCE")) S PSGST="O"
"RTN","PSJCOM",15,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="N",$P(^(0),"^",4)="U",$P(^(0),"^",7)=PSGST,$P(^TMP("PSJCOM",$J,+PSGORD,2),"^",2)=PSGSD,$P(^(2),"^",4)=PSGFD
"RTN","PSJCOM",16,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)'="R" S ^TMP("PSJCOM",$J,+PSGORD,6)=PSGSI
"RTN","PSJCOM",17,0)
 I $D(PSGSI),$P($G(^PS(53.1,+PSGORD,0)),U,24)="R" S $P(^TMP("PSJCOM",$J,+PSGORD,6),U)=$P(PSGSI,U)
"RTN","PSJCOM",18,0)
 S:$D(PSGSCH) $P(^TMP("PSJCOM",$J,+PSGORD,2),"^")=PSGSCH
"RTN","PSJCOM",19,0)
 I PSGSM,PSGOHSM'=PSGHSM S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",5)=PSGSM,$P(^TMP("PSJCOM",$J,+PSGORD,0),"^",6)=PSGHSM
"RTN","PSJCOM",20,0)
 W "."
"RTN","PSJCOM",21,0)
 S PSGOEEWF="^TMP(""PSJCOM"",$J,+PSGORD,"
"RTN","PSJCOM",22,0)
 F Q=1,3 K @(PSGOEEWF_Q_")") S %X="^PS(53.45,"_PSJSYSP_","_$S(Q=1:2,1:1)_",",%Y=PSGOEEWF_Q_"," K @(PSGOEEWF_Q_")") D %XY^%RCR W "."  ;MOU-0100-30945
"RTN","PSJCOM",23,0)
 S PSGND=$G(^TMP("PSJCOM",$J,+PSGORD,0)),X=$P(PSGND,U,24)
"RTN","PSJCOM",24,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM",25,0)
 I $S(X="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:X'="E") S X=$G(^TMP("PSJCOM",$J,+PSGORD,2)) D ENWALL^PSGNE3(+$P(X,U,2),+$P(X,U,4),PSGP)
"RTN","PSJCOM",26,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,.2),U,2)=PSGDO,$P(^TMP("PSJCOM",$J,+PSGORD,2),U,5)=PSGAT S:$G(PSGS0XT) $P(^(2),U,6)=PSGS0XT
"RTN","PSJCOM",27,0)
 I 'PSGOEAV D NEWNVAL(PSGORD,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSJCOM",28,0)
 I PSGOEAV,+PSJSYSU=3 D VFY Q
"RTN","PSJCOM",29,0)
 I PSGOEAV,$G(PSJRNF) D VFY
"RTN","PSJCOM",30,0)
 Q
"RTN","PSJCOM",31,0)
VFY ; change status, move to 55, and change label record
"RTN","PSJCOM",32,0)
 Q:'PSJCOM
"RTN","PSJCOM",33,0)
 I '$D(^TMP("PSJCOM",$J,+PSGORD)) M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM",34,0)
 NEW PSJDOSE,PSJDSFLG
"RTN","PSJCOM",35,0)
 D DOSECHK^PSJDOSE
"RTN","PSJCOM",36,0)
 I +$G(PSJDSFLG) D SETVAR^PSJDOSE W !!,PSJDOSE("WARN"),!,PSJDOSE("WARN1") I '$$CONT() W !,"...order was not verified..." D PAUSE^VALM1 D  Q:'$G(PSJACEPT)
"RTN","PSJCOM",37,0)
 . S PSGOEEF(109)=1
"RTN","PSJCOM",38,0)
 . S PSJACEPT=0
"RTN","PSJCOM",39,0)
 D DDCHK G:CHK DONE
"RTN","PSJCOM",40,0)
 W !,"...a few moments, please..."
"RTN","PSJCOM",41,0)
 I PSGORD["P" D
"RTN","PSJCOM",42,0)
 . S PSGORDP=PSGORD ;Used in ACTLOG to update activity log in ^TMP
"RTN","PSJCOM",43,0)
 . I '$D(^TMP("PSJCOM2",$J,+PSGORD)) D  Q
"RTN","PSJCOM",44,0)
 .. NEW PSGX S PSGX=$G(^TMP("PSJCOM",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",45,0)
 .. S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",46,0)
 .  NEW PSGX S PSGX=$G(^TMP("PSJCOM2",$J,+PSGORD,2.5)),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOM",47,0)
 .  S $P(^TMP("PSJCOM2",$J,+PSGORD,0),"^",9)="A" W "." ;D ^PSGOT
"RTN","PSJCOM",48,0)
 D NEWNVAL(+PSGORD,(PSJSYSU*10+22000)) W "."
"RTN","PSJCOM",49,0)
 S VND4=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):$G(^TMP("PSJCOM",$J,+PSGORD,4)),1:$G(^TMP("PSJCOM2",$J,+PSGORD,4)))
"RTN","PSJCOM",50,0)
 I $G(PSGRSD) D
"RTN","PSJCOM",51,0)
 . S PSGRSD=$$ENDTC^PSGMI(PSGRSD) D NEWNVAL(PSGORD,6090,"Requested Start Date",PSGRSD)
"RTN","PSJCOM",52,0)
 . S PSGRFD=$$ENDTC^PSGMI(PSGRFD) D NEWNVAL(PSGORD,6090,"Requested Stop Date",PSGRFD)
"RTN","PSJCOM",53,0)
 N DUR,DURORD S DURON=$S($G(ON)&($G(PSGORD)["U"):ON,$G(PSGORD):PSGORD,1:"") Q:'DURON  D
"RTN","PSJCOM",54,0)
 . S DUR=$S($P($G(PSGRDTX),U,2)]"":$P($G(PSGRDTX),U,2),1:$$GETDUR^PSJLIVMD(PSGP,+DURON,$S($G(DURON)["P":"P",$G(DURON)["V":"IV",1:5),1),1:"")
"RTN","PSJCOM",55,0)
 I DUR]"" S $P(^TMP("PSJCOM2",$J,+PSGORD,2.5),"^",2)=DUR
"RTN","PSJCOM",56,0)
 ;D:$D(PSGORDP) ACTLOG(PSGORDP,PSGP,PSGORD)
"RTN","PSJCOM",57,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSJCOM",58,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSJCOM",59,0)
 I +PSJSYSU=3,PSGORD'["O",$S(X:0,'$P(VND4,"^",16):1,1:$P(VND4,"^",15)) ;D EN^PSGPEN(+PSGORD)
"RTN","PSJCOM",60,0)
 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSJCOM",61,0)
 ;S $P(VND4,"^",+PSJSYSU=1+9)=1,$P(VND4,U,+PSJSYSU=3+9)=0
"RTN","PSJCOM",62,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)=""
"RTN","PSJCOM",63,0)
 S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT
"RTN","PSJCOM",64,0)
 S:'$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM",$J,+PSGORD,4)=VND4 S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J,+PSGORD,4)=VND4
"RTN","PSJCOM",65,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSJCOM",66,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSJCOM",67,0)
 S VALMBCK="Q"
"RTN","PSJCOM",68,0)
 S ^TMP("PSJCOM",$J)="A" S:$D(^TMP("PSJCOM2",$J,+PSGORD)) ^TMP("PSJCOM2",$J)="A"
"RTN","PSJCOM",69,0)
 ;
"RTN","PSJCOM",70,0)
DONE ;
"RTN","PSJCOM",71,0)
 W:CHK !!,"...order NOT verified..."
"RTN","PSJCOM",72,0)
 I '$D(PSJSPEED),'CHK,+PSJSYSU=3,$G(PSJPRI)="D" D
"RTN","PSJCOM",73,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJCOM",74,0)
 .Q:Y="N"
"RTN","PSJCOM",75,0)
 .D MAIN^TIUEDIT(3,.TIUDA,PSGP,"","","","",1)
"RTN","PSJCOM",76,0)
 S VALMBCK="Q" K CHK,DA,DIE,F,DP,DR,ND,PSGAL,PSGODA,PSJDOSE,PSJVAR,VND4,X Q
"RTN","PSJCOM",77,0)
 ;
"RTN","PSJCOM",78,0)
DDCHK ; dispense drug check
"RTN","PSJCOM",79,0)
 S DRGF=$S('$D(^TMP("PSJCOM2",$J,+PSGORD)):"^TMP(""PSJCOM"","_$J_","_+PSGORD_",",1:"^TMP(""PSJCOM2"","_$J_","_+PSGORD_","),CHK=$S('$O(@(DRGF_"1,0)")):7,1:0)
"RTN","PSJCOM",80,0)
 S PSGPD=$G(@(DRGF_".2)"))
"RTN","PSJCOM",81,0)
 S CHK=$S('$$DDOK^PSGOE2(DRGF_"1,",PSGPD):7,1:0)
"RTN","PSJCOM",82,0)
 Q:CHK=0
"RTN","PSJCOM",83,0)
 W $C(7),!!,"This order must have at least one valid, active dispense drug to be verified."
"RTN","PSJCOM",84,0)
 ;
"RTN","PSJCOM",85,0)
CONT() ;
"RTN","PSJCOM",86,0)
 NEW DIR,DIRUT,Y
"RTN","PSJCOM",87,0)
 W ! K DIR,DIRUT
"RTN","PSJCOM",88,0)
 S DIR(0)="Y",DIR("A")="Would you like to continue verifying the order",DIR("B")="Yes"
"RTN","PSJCOM",89,0)
 D ^DIR
"RTN","PSJCOM",90,0)
 Q Y
"RTN","PSJCOM",91,0)
 ;
"RTN","PSJCOM",92,0)
NEWNVAL(PSGALORD,PSGALC,PSGFLD,PSGOLD)  ;
"RTN","PSJCOM",93,0)
 ;
"RTN","PSJCOM",94,0)
 ;Where  PSGALORD = PSGORD (Required)
"RTN","PSJCOM",95,0)
 ;       PSGALC   = ACTIVITY CODE FROM #53.3 (Required)
"RTN","PSJCOM",96,0)
 ;       PSGFLD   = FIELD THAT CHANGED (Free text, optional)
"RTN","PSJCOM",97,0)
 ;       PSGOLD   = THE FIELDS OLD DATA VALUE (Free text, optional)
"RTN","PSJCOM",98,0)
 ;
"RTN","PSJCOM",99,0)
 ;N PSGALORD,PSGALC,PSGFLD,PSGOLD
"RTN","PSJCOM",100,0)
 ;
"RTN","PSJCOM",101,0)
 ; Create 0 node activity log for order if none exists, and get next entry number
"RTN","PSJCOM",102,0)
 I '$D(^TMP("PSJCOM2",$J,+PSGALORD)) D  Q
"RTN","PSJCOM",103,0)
 . S QQ=$G(^TMP("PSJCOM",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",104,0)
 . ;Set up data to be held in activity log record
"RTN","PSJCOM",105,0)
 . D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",106,0)
 . I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",107,0)
 . S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",108,0)
 . ; Create activity log entry
"RTN","PSJCOM",109,0)
 . S ^TMP("PSJCOM",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",110,0)
 S QQ=$G(^TMP("PSJCOM2",$J,+PSGALORD,"A",0)) S:QQ="" QQ="^53.1119D" F Q=$P(QQ,"^",3)+1:1 I '$D(^(Q)) S $P(QQ,"^",3,4)=Q_"^"_Q,^(0)=QQ,PSGAL("N")=Q Q
"RTN","PSJCOM",111,0)
 ;Set up data to be held in activity log record
"RTN","PSJCOM",112,0)
 D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOM",113,0)
 I $L($G(PSGOLD))>170 S PSGOLD=$E(PSGOLD,1,167)_"..." ; Use of ... indicates old data field was greater than 170 characters
"RTN","PSJCOM",114,0)
 S Q=%_"^"_$S(PSGALC=6010:"AUTO CANCEL",$D(DUZ)[0:"UNKNOWN",DUZ]"":DUZ,1:"UNKNOWN")_"^"_PSGALC_"^"_$S($D(PSGFLD):PSGFLD,1:"")_"^"_$S($D(PSGOLD):PSGOLD,1:"")
"RTN","PSJCOM",115,0)
 ; Create activity log entry
"RTN","PSJCOM",116,0)
 S ^TMP("PSJCOM2",$J,+PSGALORD,"A",PSGAL("N"),0)=Q
"RTN","PSJCOM",117,0)
 Q
"RTN","PSJCOM1")
0^108^B47154341
"RTN","PSJCOM1",1,0)
PSJCOM1 ;BIR/CML3-DISPLAY COMPLEX ORDERS FOR DISCONTINUE ;02 Feb 2001  12:20 PM
"RTN","PSJCOM1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSJCOM1",3,0)
 ;
"RTN","PSJCOM1",4,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJCOM1",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOM1",6,0)
 ; Reference to ^%DTC is supported by DBIA 10000.
"RTN","PSJCOM1",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJCOM1",8,0)
 ; Reference to ^DIE is supported by DBIA 10018.
"RTN","PSJCOM1",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOM1",10,0)
 ;
"RTN","PSJCOM1",11,0)
CMPLX(PSGP,ON,PSGORD) ;
"RTN","PSJCOM1",12,0)
 D PAUSE K PSJCM
"RTN","PSJCOM1",13,0)
 N PSJLINE,PSX,PSCM
"RTN","PSJCOM1",14,0)
 S PSJLINE=1
"RTN","PSJCOM1",15,0)
 I PSGORD["P" N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",ON,PSJO)) Q:'PSJO  D
"RTN","PSJCOM1",16,0)
 .Q:PSJO=+PSGORD  S PSJOO=PSGORD D DSPLORDU(PSGP,PSJO_"P") S PSJCM(PSJO_"P",PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJCOM1",17,0)
 I PSGORD'["P" N PSJO,PSJOO S PSJOO="",PSJO=0 F  S PSJO=$O(^PS(55,"ACX",ON,PSJO)) Q:'PSJO  F  S PSJOO=$O(^PS(55,"ACX",ON,PSJO,PSJOO)) Q:PSJOO=""  D
"RTN","PSJCOM1",18,0)
 .Q:PSJOO=PSGORD  D:PSJOO["U" DSPLORDU(PSGP,PSJOO) D:PSJOO["V" DSPLORDV(PSGP,PSJOO) S PSJCM(PSJOO,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJCOM1",19,0)
 N ON S ON="" F  S ON=$O(PSJCM(ON)) Q:ON=""  D
"RTN","PSJCOM1",20,0)
 .W ! F PSX=0:0 S PSX=$O(PSJCM(ON,PSX)) Q:'PSX  D
"RTN","PSJCOM1",21,0)
 ..W !,PSJCM(ON,PSX) D:'(PSX#6) PAUSE
"RTN","PSJCOM1",22,0)
 W !
"RTN","PSJCOM1",23,0)
 Q
"RTN","PSJCOM1",24,0)
 ;
"RTN","PSJCOM1",25,0)
CMPLX2(PSGP,ON,PSGORD) ;
"RTN","PSJCOM1",26,0)
 Q:'$G(PSJPREX)!(PSGORD'["U")
"RTN","PSJCOM1",27,0)
 N PSJLINE S PSJLINE=0
"RTN","PSJCOM1",28,0)
 D FULL^VALM1
"RTN","PSJCOM1",29,0)
 D DSPLORDU(PSGP,PSGORD)
"RTN","PSJCOM1",30,0)
 W ! S PSJLINE="" F  S PSJLINE=$O(PSJCM(PSGORD,PSJLINE)) Q:PSJLINE=""  W !,PSJCM(PSGORD,PSJLINE) D:'((PSJLINE+1)#6) PAUSE
"RTN","PSJCOM1",31,0)
 D EN^PSGPEN(PSGORD) K PSJPREX
"RTN","PSJCOM1",32,0)
 W !
"RTN","PSJCOM1",33,0)
 Q
"RTN","PSJCOM1",34,0)
 ;
"RTN","PSJCOM1",35,0)
UPDATE ; Refresh array, actions, & display.
"RTN","PSJCOM1",36,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJCOM1",37,0)
 Q
"RTN","PSJCOM1",38,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJCOM1",39,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJCOM1",40,0)
 Q
"RTN","PSJCOM1",41,0)
 ;
"RTN","PSJCOM1",42,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJCOM1",43,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y K PSJCM
"RTN","PSJCOM1",44,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJCOM1",45,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJCOM1",46,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJCOM1",47,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJCOM1",48,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJCOM1",49,0)
 S STAT=$P(NODE0,U,9)
"RTN","PSJCOM1",50,0)
 D NOW^%DTC I "A"[STAT I $P(NODE2,U,4)<% D EXPIRE S STAT="E"
"RTN","PSJCOM1",51,0)
 I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJCOM1",52,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJCOM1",53,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJCOM1",54,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJCOM1",55,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1)
"RTN","PSJCOM1",56,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJCOM1",57,0)
 . S PSJCM(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJCOM1",58,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJCOM1",59,0)
 Q
"RTN","PSJCOM1",60,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJCOM1",61,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y
"RTN","PSJCOM1",62,0)
 S TYP="?" I ON["V" D
"RTN","PSJCOM1",63,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJCOM1",64,0)
 .D NOW^%DTC I "A"[P(17) I P(3)<% D EXPIRE S P(17)="E"
"RTN","PSJCOM1",65,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJCOM1",66,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJCOM1",67,0)
 S PSJCT=0,PSJL=""
"RTN","PSJCOM1",68,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJCOM1",69,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJCOM1",70,0)
 Q
"RTN","PSJCOM1",71,0)
SOL ;
"RTN","PSJCOM1",72,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"        in"
"RTN","PSJCOM1",73,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJCOM1",74,0)
 Q
"RTN","PSJCOM1",75,0)
PIVAD ; Print IV Additives.
"RTN","PSJCOM1",76,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJCOM1",77,0)
 Q
"RTN","PSJCOM1",78,0)
 ;
"RTN","PSJCOM1",79,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJCOM1",80,0)
 K PSJIVFLG
"RTN","PSJCOM1",81,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJCOM1",82,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJCOM1",83,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJCOM1",84,0)
 Q
"RTN","PSJCOM1",85,0)
SETTMP ;
"RTN","PSJCOM1",86,0)
 S PSJCM(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJCOM1",87,0)
 Q
"RTN","PSJCOM1",88,0)
PAUSE ;
"RTN","PSJCOM1",89,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSJCOM1",90,0)
 Q
"RTN","PSJCOM1",91,0)
NEW ;
"RTN","PSJCOM1",92,0)
 Q:'PSJCOM
"RTN","PSJCOM1",93,0)
 Q:PSGORD'["P"
"RTN","PSJCOM1",94,0)
 M ^TMP("PSJCOM",$J,+PSGORD)=^PS(53.1,+PSGORD)
"RTN","PSJCOM1",95,0)
 S PSGS0Y=PSGAT,PSGNESD=PSGSD,PSGNEFD=PSGFD,PSGOEPR=PSGPR,PSGPDRG=PSGPD,PSGPDRGN=PSGPDN,PSGOEE="E"
"RTN","PSJCOM1",96,0)
 S $P(^TMP("PSJCOM",$J,+PSGORD,0),"^",27)="E",$P(^(0),"^",9)="DE"
"RTN","PSJCOM1",97,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSJCOM1",98,0)
 ;I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSJCOM1",99,0)
 K ND4,DA D NOW^%DTC S PSGDT=+$E(%,1,12),DA=+PSGORD
"RTN","PSJCOM1",100,0)
 S PSJOWALL=+$G(^PS(55,PSGP,5.1))
"RTN","PSJCOM1",101,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSJCOM1",102,0)
 I PSGS0XT="D",'PSGS0Y S PSGS0Y=$E(PSGNESD_"00011",9,12)
"RTN","PSJCOM1",103,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJCOM1",104,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSJCOM1",105,0)
 ;I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F
"RTN","PSJCOM1",106,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSJCOM1",107,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSJCOM1",108,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSJCOM1",109,0)
 S F="^TMP(""PSJCOM2"","_$J_","_DA_",",@(F_"0)")=ND
"RTN","PSJCOM1",110,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",111,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2) S:PSJCOM]"" $P(^(.2),"^",8)=PSJCOM
"RTN","PSJCOM1",112,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSJCOM1",113,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",114,0)
 S @(F_"2)")=$P(ND2,"^",1,6),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSJCOM1",115,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",116,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSJCOM1",117,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSJCOM1",118,0)
 ; Naked references below refers to full reference in F which is ^TMP("PSJCOM2",$J,DA,
"RTN","PSJCOM1",119,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSJCOM1",120,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSJCOM1",121,0)
 S:C @(F_"12,0)")=U_$S(PSGOEAV:55.0612,1:53.1012)_U_C_U_C
"RTN","PSJCOM1",122,0)
 W "."
"RTN","PSJCOM1",123,0)
OUT ;
"RTN","PSJCOM1",124,0)
 K PSGOETOF
"RTN","PSJCOM1",125,0)
DONE ;
"RTN","PSJCOM1",126,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE
"RTN","PSJCOM1",127,0)
 Q
"RTN","PSJCOM1",128,0)
EXPIRE ;Change status of order to expired and send notice to OE/RR
"RTN","PSJCOM1",129,0)
 N DA,DIE,DR,PSGPO,PSIVACT
"RTN","PSJCOM1",130,0)
 Q:'$G(PSJOO)!($G(PSJOO)["P")
"RTN","PSJCOM1",131,0)
 S STATUS="E",(PSGPO,PSIVACT)=1,DA=+PSJOO,DA(1)=PSGP,DIE=$S(PSJOO["V":"^PS(55,"_PSGP_",""IV"",",1:"^PS(55,"_PSGP_",5,"),DR=$S(PSJOO["V":"100////E",1:"28////E") D ^DIE
"RTN","PSJCOM1",132,0)
 D EN1^PSJHL2(PSGP,"SC",PSJOO)
"RTN","PSJCOM1",133,0)
 Q
"RTN","PSJCOMR")
0^107^B75247362
"RTN","PSJCOMR",1,0)
PSJCOMR ;BIR/CML3-RENEW A COMPLEX ORDER SERIES ;07 MAR 96 / 1:23 PM
"RTN","PSJCOMR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSJCOMR",3,0)
 ;
"RTN","PSJCOMR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSJCOMR",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSJCOMR",6,0)
 ; Reference to NOW^%DTC is supported by DBIA 10000.
"RTN","PSJCOMR",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOMR",8,0)
 ;
"RTN","PSJCOMR",9,0)
 ; renew a complex order series
"RTN","PSJCOMR",10,0)
 Q:'PSJCOM  K COMQUIT
"RTN","PSJCOMR",11,0)
 W !!,"This order is part of a complex order. If you "_$S($P(PSJSYSP0,"^",3):"RENEW",1:"MARK")_" this order the",!,"following orders will be "_$S($P(PSJSYSP0,"^",3):"RENEWED",1:"MARKED")_" too." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSJCOMR",12,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS COMPLEX ORDER SERIES",1:"MARK THIS COMPLEX ORDER SERIES FOR RENEWAL"),DIR("B")="YES"
"RTN","PSJCOMR",13,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this complex order series",1:"mark this complex order series for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR K DIR
"RTN","PSJCOMR",14,0)
 I 'Y N DIR D ABORT G DONE
"RTN","PSJCOMR",15,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSJCOMR",16,0)
 I '$D(DIRUT),PSJSYSU I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSJCOMR",17,0)
 D DONE,ABORT^PSGOEE
"RTN","PSJCOMR",18,0)
 Q
"RTN","PSJCOMR",19,0)
 ;
"RTN","PSJCOMR",20,0)
UNMARK ;  
"RTN","PSJCOMR",21,0)
 W !!,"THIS COMPLEX ORDER SERIES HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSJCOMR",22,0)
 S DIR("?",1)="  Answer 'YES' to unmark this complex order series.  Answer 'NO' (or '^') to leave the complex",DIR("?")="order series marked.  (An answer is required.)" D ^DIR
"RTN","PSJCOMR",23,0)
 I 'Y N DIR D ABORT^PSGOEE G DONE
"RTN","PSJCOMR",24,0)
 N PSGORD,XX,X S XX=0,X="" F  S XX=$O(^PS(55,"ACX",PSJCOM,XX)) Q:'XX  F  S X=$O(^PS(55,"ACX",PSJCOM,XX,X)) Q:X=""  S PSGORD=X D
"RTN","PSJCOMR",25,0)
 .S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJCOMR",26,0)
 .S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSJCOMR",27,0)
 ;
"RTN","PSJCOMR",28,0)
DONE ;
"RTN","PSJCOMR",29,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSJCOMR",30,0)
 ;
"RTN","PSJCOMR",31,0)
NEW ; get info, write record
"RTN","PSJCOMR",32,0)
 K ^TMP("PSJCOMR",$J)
"RTN","PSJCOMR",33,0)
 N DUOUT,PSGORD,TMPP,TMPO,PS55ACX,TMPDUZ,TMPOE,COMQUIT S TMPP=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",34,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP!$G(COMQUIT)  D
"RTN","PSJCOMR",35,0)
 . S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""!$G(COMQUIT)  S PSGORD=TMPO D:PSGORD["U" NEWUD  I PSGORD["V" D NEWIV
"RTN","PSJCOMR",36,0)
 I $G(COMQUIT)!$G(DUOUT)  W !!,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJCOMR",37,0)
 I '$G(COMQUIT)&'$G(DUOUT) S TMPOE=0 F  S TMPOE=$O(^PS(55,"ACX",PSJCOM,TMPOE)) Q:TMPOE=""  S TMPO=0 F  S TMPO=$O(^PS(55,"ACX",PSJCOM,TMPOE,TMPO)) Q:'TMPO!$G(COMQUIT)  S PSGORD=TMPO D
"RTN","PSJCOMR",38,0)
 . K VSTRING S VSTRING=$G(^TMP("PSJCOMR",$J,PSJCOM,TMPO)) I PSGORD'=$P(VSTRING,"^",2) S COMQUIT=1 Q
"RTN","PSJCOMR",39,0)
 . S PSGP=$P(VSTRING,"^"),PSGDT=$P(VSTRING,"^",3),PSGOEPR=$P(VSTRING,"^",4),PSGOFD=$P(VSTRING,"^",5),PSGFD=$P(VSTRING,"^",6),PSJNOO=$P(VSTRING,"^",7),TMPDUZ=$P(VSTRING,"^",8)
"RTN","PSJCOMR",40,0)
 . D:PSGORD["U" FILEUD D:PSGORD["V" FILEIV
"RTN","PSJCOMR",41,0)
 K ^TMP("PSJCOMR",$J),VSTRING
"RTN","PSJCOMR",42,0)
 Q
"RTN","PSJCOMR",43,0)
NEWUD N PSJABT,PSGDRG,PSJREN,X,XX,PSGORDP,UDSTRING S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSJCOMR",44,0)
 D OC55
"RTN","PSJCOMR",45,0)
 Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSJCOMR",46,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSJCOMR",47,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSJCOMR",48,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSJCOMR",49,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I '$D(PSGFOK(106)) D DONE,ABORT^PSGOEE S VALMBCK="R" Q
"RTN","PSJCOMR",50,0)
 W !!,"...updating order..." N PSGOEAV S PSGOEAV=+PSJSYSU,PSGOORD=PSGORD,PSGOER1=$G(^PS(55,PSGP,5,+PSGORD,.2)),PSGSI=$G(^(6)) W "."
"RTN","PSJCOMR",51,0)
 S PSGMR=$P(PSGOER0,"^",3),PSGSM=$P(PSGOER0,"^",5),PSGHSM=$P(PSGOER0,"^",6)
"RTN","PSJCOMR",52,0)
 S PSGMRN=$$ENMRN^PSGMI(PSGMR),PSGPDRGN=$$ENPDN^PSGMI(PSGPDRG),PSGDO=$P(PSGOER1,"^",2),PSGSCH=$P(PSGOER2,"^")
"RTN","PSJCOMR",53,0)
 S PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6),PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSJCOMR",54,0)
 S:PSJPWD'=$P(PSGOER2,U,10) PSGS0Y=$$ENRNAT^PSGOU($P(PSGOER2,U,10),+PSJPWD,PSGSCH,PSGS0Y)
"RTN","PSJCOMR",55,0)
 S UDSTRING=PSGP_"^"_PSGORD_"^"_PSGDT_"^"_PSGOEPR_"^"_PSGOFD_"^"_PSGFD_"^"_PSJNOO F II=1:1:$L(UDSTRING,"^") I $P(UDSTRING,"^",II)="" K UDSTRING
"RTN","PSJCOMR",56,0)
 I '$D(UDSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",57,0)
 S:$G(DUZ) UDSTRING=UDSTRING_"^"_DUZ D TEMP(UDSTRING)
"RTN","PSJCOMR",58,0)
 Q
"RTN","PSJCOMR",59,0)
 ;
"RTN","PSJCOMR",60,0)
FILEUD ;
"RTN","PSJCOMR",61,0)
 ;Changed the reference to the type "O" for order numbers previously in v4.5
"RTN","PSJCOMR",62,0)
 N X,PSJORD,PSGOERDP,PSGOREAS,PSGRZERO S PSJORD=PSGORD
"RTN","PSJCOMR",63,0)
 S X=$$LS^PSSLOCK(PSGP,PSGORD)  S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOREAS=$P(@(PSGRZERO),"^",24) D
"RTN","PSJCOMR",64,0)
 . S $P(@PSGRZERO,"^",24)="R" D UPDREN^PSGOER(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO,$G(TMPDUZ)),UPDRENOE^PSGOER(PSGP,PSGORD) S $P(@PSGRZERO,"^",24)=PSGOREAS
"RTN","PSJCOMR",65,0)
 I +$G(PSJSYSU)=3,$G(PSJCOM) S PSJPREX=1 D CMPLX2^PSJCOM1(PSGP,PSJCOM,PSGORD) K PSJPREX
"RTN","PSJCOMR",66,0)
 ;Dummy line to execute lock above for each renewal.
"RTN","PSJCOMR",67,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSJCOMR",68,0)
 I '$G(PSGOERDP),$P(PSJSYSW0,"^",4) I $G(PSGFD),$G(PSGWLL),(PSGFD'<PSGWLL) S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSJCOMR",69,0)
 D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSJCOMR",70,0)
 W ".DONE!" S VALMBCK="Q"
"RTN","PSJCOMR",71,0)
 Q
"RTN","PSJCOMR",72,0)
 ;
"RTN","PSJCOMR",73,0)
MARK ;
"RTN","PSJCOMR",74,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSJCOMR",75,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSJCOMR",76,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSJCOMR",77,0)
 Q
"RTN","PSJCOMR",78,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSJCOMR",79,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSJCOMR",80,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSJCOMR",81,0)
 Q
"RTN","PSJCOMR",82,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSJCOMR",83,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG
"RTN","PSJCOMR",84,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSJCOMR",85,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(55,PSGP,5,+PSGORD,1,1,0)))
"RTN","PSJCOMR",86,0)
 I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSJCOMR",87,0)
 . F PSGDDI=1:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSJCOMR",88,0)
 Q
"RTN","PSJCOMR",89,0)
 ;
"RTN","PSJCOMR",90,0)
RIV ; Renew order.
"RTN","PSJCOMR",91,0)
 Q:'PSJCOM  N PSGORD,TMPP,TMPO S (TMPP,TMPO)=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",92,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP  S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""  D
"RTN","PSJCOMR",93,0)
 . S PSGORD=TMPO D:PSGORD["U" NEWUD  D:PSGORD["V" NEWIV
"RTN","PSJCOMR",94,0)
 Q
"RTN","PSJCOMR",95,0)
NEWIV ;Renew complex IV orders
"RTN","PSJCOMR",96,0)
 N X,XX
"RTN","PSJCOMR",97,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." Q:$G(ERR)<2
"RTN","PSJCOMR",98,0)
 NEW PSGORQF S PSIVRNFG=1 D ORDCHK^PSJLIFN K PSIVRNFG Q:$G(PSGORQF)  W !
"RTN","PSJCOMR",99,0)
 I $G(PSGORD)["V" S ON55=PSGORD S P("OLDON")=$P(^PS(55,DFN,"IV",+PSGORD,2),"^",5) S:'P("OLDON") P("OLDON")=ON55
"RTN","PSJCOMR",100,0)
 ;
"RTN","PSJCOMR",101,0)
R1 N PSIVND0,PSIVND2,PSIVREAS,PSIVOFD,IVSTRING,P2,PSJBKDR S PSJBKDR=1
"RTN","PSJCOMR",102,0)
 S P("NEWON")=ON55,(PSIVOK,EDIT)="25^1",P2=P(2) S P(2)=$$DATE^PSJUTL2 D EDIT^PSIVEDT S P(2)=P2 I X="^" D RD Q
"RTN","PSJCOMR",103,0)
 S:+VAIN(4)'=$P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10) P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSJCOMR",104,0)
 S PSIVCHG=2
"RTN","PSJCOMR",105,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSJCOMR",106,0)
 S P(17)="A",P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSJCOMR",107,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD S COMQUIT=1 Q
"RTN","PSJCOMR",108,0)
 .S ON=ON55 ;D SET^PSIVORFE
"RTN","PSJCOMR",109,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",PSIVOFD=$P($G(^PS(55,DFN,"IV",+PSGORD,0)),"^",3)
"RTN","PSJCOMR",110,0)
 S IVSTRING=DFN_"^"_ON55_"^"_$$DATE^PSJUTL2()_"^"_+$G(P(6))_"^"_PSIVOFD_"^"_P(3)_"^"_P("NAT") F II=1:1:$L(IVSTRING,"^") I $P(IVSTRING,"^",II)="" K IVSTRING
"RTN","PSJCOMR",111,0)
 I '$D(IVSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",112,0)
 S:$G(DUZ) IVSTRING=IVSTRING_"^"_DUZ D TEMP(IVSTRING)
"RTN","PSJCOMR",113,0)
 Q
"RTN","PSJCOMR",114,0)
 ;
"RTN","PSJCOMR",115,0)
FILEIV ;
"RTN","PSJCOMR",116,0)
 N X,ON,ON55,PSJORD,P,PSIVTMP,PSIVZERO,OREAS
"RTN","PSJCOMR",117,0)
 S X=$$LS^PSSLOCK(DFN,+PSGORD_"V") S PSIVZERO="^PS(55,"_DFN_",""IV"","_+PSGORD_",0)" S PSIVTMP0=$G(@PSIVZERO) Q:'PSIVTMP0
"RTN","PSJCOMR",118,0)
 S PSIVTMP2="^PS(55,"_DFN_",""IV"","_+PSGORD_",2)",OREAS=$P(PSIVTMP2,"^",8),$P(@PSIVTMP2,"^",8)="R"
"RTN","PSJCOMR",119,0)
 F I=1:1:$L(PSIVTMP0,"^") S P(I)=$P(PSIVTMP0,"^",I)
"RTN","PSJCOMR",120,0)
 S (ON,ON55,PSJORD)=PSGORD,P(3)=PSGFD,P(6)=PSGOEPR,P("NAT")=PSJNOO,PSIVOFD=PSGOFD D RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSJCOMR",121,0)
 Q:'PSJIVORF
"RTN","PSJCOMR",122,0)
 D EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED")
"RTN","PSJCOMR",123,0)
 S OD=P(2) D EN^PSIVORE
"RTN","PSJCOMR",124,0)
 D VF1^PSJLIACT("","",0),UNL^PSSLOCK(DFN,+ON55_"V") S $P(@PSIVTMP2,"^",8)=OREAS
"RTN","PSJCOMR",125,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSJCOMR",126,0)
 Q
"RTN","PSJCOMR",127,0)
 ;
"RTN","PSJCOMR",128,0)
TEMP(VARS) ;
"RTN","PSJCOMR",129,0)
 Q:'PSJCOM  S ^TMP("PSJCOMR",$J,PSJCOM,PSGORD)=VARS
"RTN","PSJCOMR",130,0)
 Q
"RTN","PSJCOMR",131,0)
 ;
"RTN","PSJCOMR",132,0)
RD ; Delete for renew.
"RTN","PSJCOMR",133,0)
 ;Q:'$G(PSJVFY)
"RTN","PSJCOMR",134,0)
 D DEL55^PSIVORE2 S (ON55,P("PON"))=P("OLDON") D GT55^PSIVORFB
"RTN","PSJCOMR",135,0)
 Q
"RTN","PSJCOMR",136,0)
 ;
"RTN","PSJCOMR",137,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSJCOMR",138,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSJCOMR",139,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" Q
"RTN","PSJCOMR",140,0)
 I ERR=1 S X="N" Q
"RTN","PSJCOMR",141,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSJCOMR",142,0)
 ;W:$G(PSIVCHG) !,"*** This change will cause a new order to be created. ***"
"RTN","PSJCOMR",143,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSJCOMR",144,0)
 Q
"RTN","PSJCOMR",145,0)
 ;
"RTN","PSJCOMR",146,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSJCOMR",147,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSJCOMR",148,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSJCOMR",149,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSJCOMR",150,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSJCOMR",151,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSJCOMR",152,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSJCOMR",153,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSJCOMR",154,0)
 Q
"RTN","PSJCOMR",155,0)
 ;
"RTN","PSJCOMR",156,0)
ABORT ; No changes
"RTN","PSJCOMR",157,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSJCOMR",158,0)
 Q
"RTN","PSJCOMV")
0^41^B40989997
"RTN","PSJCOMV",1,0)
PSJCOMV ;BIR/CML3-FINISH COMPLEX IV ORDERS ENTERED THROUGH OE/RR ;02 Feb 2001  12:20 PM
"RTN","PSJCOMV",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSJCOMV",3,0)
 ;
"RTN","PSJCOMV",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJCOMV",5,0)
 ; Reference to ^%DTC is supported by DBIA 10000..
"RTN","PSJCOMV",6,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOMV",7,0)
 ;
"RTN","PSJCOMV",8,0)
 ;
"RTN","PSJCOMV",9,0)
IV ; Move IV data in local variables to ^TMP
"RTN","PSJCOMV",10,0)
 Q:'PSJCOM  Q:ON'["P"
"RTN","PSJCOMV",11,0)
 M ^TMP("PSJCOM",$J,+ON)=^PS(53.1,+ON)
"RTN","PSJCOMV",12,0)
 S P(17)="N"
"RTN","PSJCOMV",13,0)
 ;I PSIVCHG D NEWIV Q
"RTN","PSJCOMV",14,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSJCOMV",15,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJCOMV",16,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJCOMV",17,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",18,0)
 F X=0,2,4,8,9 S ^TMP("PSJCOM",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",19,0)
 S:'+$G(^TMP("PSJCOM",$J,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSJCOMV",20,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSJCOMV",21,0)
 ;K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSJCOMV",22,0)
 ;K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSJCOMV",23,0)
 I '+$P(PSJSYSP0,"^",9) D NEWNVAL^PSJCOM(ON,$S(+PSJSYSU=3:22005,1:22000))
"RTN","PSJCOMV",24,0)
 I +PSJSYSU=3,+$P(PSJSYSP0,U,9) D VFYIV Q
"RTN","PSJCOMV",25,0)
 I +PSJSYSU=1,+$P(PSJSYSP0,U,9),$G(PSJIRNF) D VFYIV
"RTN","PSJCOMV",26,0)
 I $G(PSIVENO),($P(^PS(53.1,+PSJORD,0),U,9)="N") D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSJCOMV",27,0)
 Q
"RTN","PSJCOMV",28,0)
 ;
"RTN","PSJCOMV",29,0)
VFYIV ;
"RTN","PSJCOMV",30,0)
 Q:'PSJCOM
"RTN","PSJCOMV",31,0)
 I '$D(^TMP("PSJCOM",$J,+ON)) M ^TMP("PSJCOM",$J,+ON)=^PS(53.1,+ON) D
"RTN","PSJCOMV",32,0)
 . N CHILD,ORDER S ORDER=0 F  S ORDER=$O(^PS(53.1,"ACX",PSJCOM,ORDER)) Q:'ORDER  M ^TMP("PSJCOM",$J,+ORDER)=^PS(53.1,+ORDER)
"RTN","PSJCOMV",33,0)
 I ON["P" D
"RTN","PSJCOMV",34,0)
 . S P(17)="A"
"RTN","PSJCOMV",35,0)
 . S PSGORDP=ON ;Used in ACTLOG to update activity log in ^TMP
"RTN","PSJCOMV",36,0)
 . NEW PSGX S PSGX=$S($D(^TMP("PSJCOM2",$J,+ON,2.5)):$G(^TMP("PSJCOM2",$J,+ON,2.5)),1:$G(^TMP("PSJCOM2",$J,+ON,2.5))),PSGRSD=$P(PSGX,U),PSGRFD=$P(PSGX,U,3)
"RTN","PSJCOMV",37,0)
 . S:$D(^TMP("PSJCOM2",$J,+ON,0)) $P(^TMP("PSJCOM2",$J,+ON,0),"^",9)=P(17) S:'$D(^TMP("PSJCOM2",$J,+ON,0)) $P(^TMP("PSJCOM",$J,+ON,0),"^",9)=P(17) W "." ;D ^PSGOT
"RTN","PSJCOMV",38,0)
 D NEWNVAL^PSJCOM(ON,(PSJSYSU*10+22000)) W "."
"RTN","PSJCOMV",39,0)
 S VND4=$S('$D(^TMP("PSJCOM2",$J,+ON)):$G(^TMP("PSJCOM",$J,+ON,4)),1:$G(^TMP("PSJCOM2",$J,+ON,4)))
"RTN","PSJCOMV",40,0)
 S VND2P5=$$GETDUR^PSJLIVMD(DFN,ON,$E(ON,$L(ON)),1) I VND2P5]"" D
"RTN","PSJCOMV",41,0)
 . S:'$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM",$J,+ON,2.5)="^"_VND2P5 Q
"RTN","PSJCOMV",42,0)
 . S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J,+ON,2.5)="^"_VND2P5
"RTN","PSJCOMV",43,0)
 I $G(PSGRSD) D
"RTN","PSJCOMV",44,0)
 . S PSGRSD=$$ENDTC^PSGMI(PSGRSD) D NEWNVAL^PSJCOM(ON,6090,"Requested Start Date",PSGRSD)
"RTN","PSJCOMV",45,0)
 . S PSGRFD=$$ENDTC^PSGMI(PSGRFD) D NEWNVAL^PSJCOM(ON,6090,"Requested Stop Date",PSGRFD)
"RTN","PSJCOMV",46,0)
 K PSGRSD,PSGRFD,PSGALFN
"RTN","PSJCOMV",47,0)
 NEW X S X=0 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S X=1
"RTN","PSJCOMV",48,0)
 I +PSJSYSU=3,ON'["O",$S(X:0,'$P(VND4,"^",16):1,1:$P(VND4,"^",15)) ; D EN^PSGPEN(+ON)
"RTN","PSJCOMV",49,0)
 S:'$P(VND4,U,+PSJSYSU=3+9) $P(VND4,U,+PSJSYSU=3+9)=+$P(VND4,U,+PSJSYSU=3+9)
"RTN","PSJCOMV",50,0)
 S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^TMP("PSJCOM",$J,+ON,4)=VND4
"RTN","PSJCOMV",51,0)
 S:'$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM",$J,+ON,4)=VND4 S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J,+ON,4)=VND4
"RTN","PSJCOMV",52,0)
 W:'$D(PSJSPEED) ! W !,"ORDER VERIFIED.",!
"RTN","PSJCOMV",53,0)
 I '$D(PSJSPEED) K DIR S DIR(0)="E" D ^DIR K DIR
"RTN","PSJCOMV",54,0)
 S VALMBCK="Q"
"RTN","PSJCOMV",55,0)
 S ^TMP("PSJCOM",$J)="A" S:$D(^TMP("PSJCOM2",$J,+ON)) ^TMP("PSJCOM2",$J)="A" Q
"RTN","PSJCOMV",56,0)
 ;
"RTN","PSJCOMV",57,0)
PTD531 ; Move drug data from local array into ^TMP
"RTN","PSJCOMV",58,0)
 K ^TMP("PSJCOM",$J,DRGT) S ^TMP("PSJCOM",$J,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSJCOMV",59,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",60,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^TMP("PSJCOM",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",61,0)
 .S ^TMP("PSJCOM",$J,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",62,0)
 Q
"RTN","PSJCOMV",63,0)
 ;
"RTN","PSJCOMV",64,0)
NEWIV ;Create new IV order in appropriate file format
"RTN","PSJCOMV",65,0)
 M ^TMP("PSJCOM2",$J,+ON)=^PS(53.1,+ON)
"RTN","PSJCOMV",66,0)
 S $P(^TMP("PSJCOM",$J,+ON,0),"^",9)="DE",P("OLDON")=+ON_"P",P("RES")="E"
"RTN","PSJCOMV",67,0)
 I +$P(PSJSYSP0,U,9) D NEWAIV Q
"RTN","PSJCOMV",68,0)
 S ND(0)=+ON_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_$P(P("OT"),U)_U_U_U_"C",$P(ND(0),U,9)=P(17),$P(ND(0),U,21)=$G(P(21))
"RTN","PSJCOMV",69,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_DFN_U_P("LOG"),$P(ND(0),U,24,26)=$G(P("RES"))_U_$G(P("OLDON"))_U_$G(P("NEWON")) S ND(2)=P(9)_U_P(2)_U_U_P(3)_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJCOMV",70,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJCOMV",71,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM2",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",72,0)
 F X=0,2,4,8,9 S ^TMP("PSJCOM2",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",73,0)
 S:'+$G(^TMP("PSJCOM2",$J,+ON,.2)) $P(^(.2),U,1,3)=+P("PD")_U_P("DO")_U_$G(P("NAT"))
"RTN","PSJCOMV",74,0)
 I $G(P("PRNTON"))]"" S $P(^TMP("PSJCOM2",$J,+ON,.2),"^",8)=$G(P("PRNTON"))
"RTN","PSJCOMV",75,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD5312
"RTN","PSJCOMV",76,0)
 ;K DA,DIK S PSGS0Y=P(11),PSGS0XT=P(15),DA=+ON,DIK="^PS(53.1," D IX^DIK K DA,DIK,PSGS0Y,PSGS0XT,ND,^PS(53.1,"AS","P",DFN,+ON)
"RTN","PSJCOMV",77,0)
 ;K:P(17)="A" ^PS(53.1,"AS","N",DFN,+ON)
"RTN","PSJCOMV",78,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE")
"RTN","PSJCOMV",79,0)
 Q
"RTN","PSJCOMV",80,0)
 ;
"RTN","PSJCOMV",81,0)
PTD5312 ; Move drug data from local array into ^TMP
"RTN","PSJCOMV",82,0)
 K ^TMP("PSJCOM2",$J,DRGT) S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=$S(DRGT="AD":"^53.157^0^0",1:"^53.158^0^0")
"RTN","PSJCOMV",83,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",84,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^TMP("PSJCOM2",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",85,0)
 .S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM2",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",86,0)
 Q
"RTN","PSJCOMV",87,0)
 ;
"RTN","PSJCOMV",88,0)
NEWAIV ;Creates new IV order in the file 55 format
"RTN","PSJCOMV",89,0)
 N DA,DIK,ND,PSIVACT
"RTN","PSJCOMV",90,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJCOMV",91,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSJCOMV",92,0)
 S ND(.3)=$G(P("INS"))
"RTN","PSJCOMV",93,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSJCOMV",94,0)
 F X=0,1,3,.2,.3 S ^TMP("PSJCOM2",$J,+ON,X)=ND(X)
"RTN","PSJCOMV",95,0)
 S $P(^TMP("PSJCOM2",$J,+ON,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSJCOMV",96,0)
 ;S X=^PS(55,DFN,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(P("LOG"),"^"),"."),$P(X,"^",8)="A",^(0)=X
"RTN","PSJCOMV",97,0)
 S $P(^TMP("PSJCOM2",$J,+ON,2),U,11)=+P("CLRK")
"RTN","PSJCOMV",98,0)
 S:+$G(P("CLIN")) ^TMP("PSJCOM2",$J,+ON,"DSS")=P("CLIN")
"RTN","PSJCOMV",99,0)
 S:+$G(P("NINIT")) ^TMP("PSJCOM2",$J,+ON,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSJCOMV",100,0)
 I +PSJSYSU=3 S $P(^TMP("PSJCOM2",$J,+ON,4),"^",4)=DUZ,$P(^TMP("PSJCOM2",$J,+ON,4),"^",5)=PSGDT,$P(^TMP("PSJCOM2",$J,+ON,4),"^",9)=1
"RTN","PSJCOMV",101,0)
 I +PSJSYSU=1 S $P(^TMP("PSJCOM2",$J,+ON,4),"^",10)=1
"RTN","PSJCOMV",102,0)
 ;S:'$D(PSIVUP) PSIVUP=+$$GTPCI^PSIVUTL K ^PS(55,DFN,"IV",+ON55,5) I $O(^PS(53.45,PSIVUP,4,0)) S %X="^PS(53.45,"_PSIVUP_",4,",%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSJCOMV",103,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSJCOMV",104,0)
 ;K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSJCOMV",105,0)
 Q
"RTN","PSJCOMV",106,0)
 ;
"RTN","PSJCOMV",107,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSJCOMV",108,0)
 K ^TMP("PSJCOM2",$J,+ON,DRGT) S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSJCOMV",109,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJCOMV",110,0)
 .S Y=^TMP("PSJCOM2",$J,+ON,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJCOMV",111,0)
 .S ^TMP("PSJCOM2",$J,+ON,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^TMP("PSJCOM2",$J,+ON,DRGT,+DRG,0)=Y
"RTN","PSJCOMV",112,0)
 Q
"RTN","PSJHL10")
0^99^B74133422
"RTN","PSJHL10",1,0)
PSJHL10  ;BIR/LDT-VALIDATE INCOMING HL7 DATA/CREATE NEW ORDER ;08 Jul 99 / 10:50 AM
"RTN","PSJHL10",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,78,91,109,110**;16 DEC 97
"RTN","PSJHL10",3,0)
 ;
"RTN","PSJHL10",4,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJHL10",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL10",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL10",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL10",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL10",9,0)
 ; Reference to ^PSBAPIPM is supported by DBIA# 3564.
"RTN","PSJHL10",10,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL10",11,0)
 ;
"RTN","PSJHL10",12,0)
VALID ;
"RTN","PSJHL10",13,0)
 ;Call BCMA for rest of data
"RTN","PSJHL10",14,0)
 D MOB^PSBAPIPM(PSJHLDFN,+PSJORDER)
"RTN","PSJHL10",15,0)
 N DATA0,CHK S DATA0=$G(^TMP("PSB",$J,0)) I DATA0=-1 S PSREASON="Missing data, unable to file" D ERROR Q
"RTN","PSJHL10",16,0)
 I $P(DATA0,"^")'=PSJHLDFN S PSREASON="Patient does not match" D ERROR Q
"RTN","PSJHL10",17,0)
 I $P(DATA0,"^",2)'=+PSJORDER S PSREASON="Order number does not match" D ERROR Q
"RTN","PSJHL10",18,0)
 N VAIP S DFN=PSJHLDFN,VAIP("D")=$G(LOGIN) D IN5^VADPT
"RTN","PSJHL10",19,0)
 ;If UD do UD set/validate.
"RTN","PSJHL10",20,0)
 I $P(DATA0,"^",3)="" D UDSET
"RTN","PSJHL10",21,0)
 ;If IV do IV set/validate.
"RTN","PSJHL10",22,0)
 I $P(DATA0,"^",3)]"" D IVSET
"RTN","PSJHL10",23,0)
 D:'CHK EN1^PSJHL2(PSJHLDFN,"OK",PSGORD),EN1^PSJHL2(PSJHLDFN,"SC",PSGORD),EN1^PSJHL2(PSJHLDFN,"ZV",PSGORD),MOBR^PSBAPIPM(PSJHLDFN,+PSJORDER,PSGORD)
"RTN","PSJHL10",24,0)
 Q
"RTN","PSJHL10",25,0)
 ;
"RTN","PSJHL10",26,0)
ERROR ;Sends error msg to CPRS, logs error in OE/RR Errors file
"RTN","PSJHL10",27,0)
 S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON,.PSJMSG),MOBR^PSBAPIPM(PSJHLDFN,+PSJORDER)
"RTN","PSJHL10",28,0)
 D EN1^PSJHLERR(PSJHLDFN,"OC",PSJORDER,PSREASON) S QFLG=1 K ^TMP("PSJNVO",$J),^TMP("PSB",$J)
"RTN","PSJHL10",29,0)
 Q
"RTN","PSJHL10",30,0)
 ;
"RTN","PSJHL10",31,0)
UDSET ;Set up UD variables
"RTN","PSJHL10",32,0)
 N PSGPR,PSGMR,PSGSM,PSGHSM,PSGST,PSGP,PSGSCH,PSGPDRG,PSGDO,PSGNESD,PSGNEFD,PSGOEAV,PSJSYSU,PSGS0XT,PSGS0Y
"RTN","PSJHL10",33,0)
 S PSGPR=PROVIDER,PSGMR=ROUTE,PSGSM=0,PSGHSM="",PSGST="O",PSGP=PSJHLDFN,PSGSCH=SCHEDULE,PSGPDRG=PSITEM
"RTN","PSJHL10",34,0)
 S (PSGNESD,PSGNEFD)=+$P(DATA0,"^",5),PSGOEAV=1,PSJSYSU=1,PSGS0XT="O",PSGS0Y=""
"RTN","PSJHL10",35,0)
 I $G(DOSE)]"",$G(UNIT)]"" S PSGDO=DOSE_UNIT
"RTN","PSJHL10",36,0)
 I $G(PSGDO)']"",$G(INSTR)]"" S PSGDO=$$TRIM^XLFSTR(INSTR,"R"," ")
"RTN","PSJHL10",37,0)
 S CHK=""
"RTN","PSJHL10",38,0)
 S ND=U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_"E"_"^^^^^"_LOGIN_U_PSGP_U_LOGIN
"RTN","PSJHL10",39,0)
 D CHK("^^"_PSGMR_"^^^^"_PSGST,PSGPDRG_U_PSGDO,PSGSCH_U_PSGNESD_"^^"_PSGNEFD)
"RTN","PSJHL10",40,0)
 I CHK D ERROR Q
"RTN","PSJHL10",41,0)
 I PSGSCH'="STAT",PSGSCH'="NOW" S PSREASON="Invalid Schedule" S CHK=1 D ERROR Q
"RTN","PSJHL10",42,0)
 I ORDCON'="V",ORDCON'="P" S PSREASON="Invalid Nature of Order" S CHK=1 D ERROR Q
"RTN","PSJHL10",43,0)
 D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSJHL10",44,0)
 S ND0=ND D ENGNA^PSGOETO
"RTN","PSJHL10",45,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSJHL10",46,0)
 S ND0=DA_ND0
"RTN","PSJHL10",47,0)
 S $P(ND0,"^",21)=PSJORDER
"RTN","PSJHL10",48,0)
 S ND2=PSGSCH_U_PSGNESD_"^^"_PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+VAIP(5)
"RTN","PSJHL10",49,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSJHL10",50,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_+$P(DATA0,"^",5),$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSJHL10",51,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSJHL10",52,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSJHL10",53,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSJHL10",54,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSJHL10",55,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSJHL10",56,0)
 S F="^PS(55,"_PSGP_",5,"_DA_",",@(F_"0)")=ND0
"RTN","PSJHL10",57,0)
 ;naked reference on the four (4) lines below refer to the full ref to ^PS(55,PSGP,5,DA created by indirection using variable F
"RTN","PSJHL10",58,0)
 I $G(INSTR)]"" S @(F_".3)")=INSTR
"RTN","PSJHL10",59,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO S $P(^(.2),U,3,6)=$G(ORDCON)_"^"_$E(PRIORITY,2)_"^"_$G(DOSE)_"^"_$G(UNIT)
"RTN","PSJHL10",60,0)
 S @(F_"2)")=ND2,^(4)=ND4
"RTN","PSJHL10",61,0)
 S (C,X)=0 F  S X=$O(^TMP("PSB",$J,700,X)) Q:'X  S D=$G(^(X,0)) I D S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSJHL10",62,0)
 S:C @(F_"1,0)")=U_"55.07P^"_C_U_C
"RTN","PSJHL10",63,0)
 I $D(PROCOM) D
"RTN","PSJHL10",64,0)
 .;naked refs on the three lines below refer to the full ref to ^PS(55,PSGP,5,DA created by indrection using variable F
"RTN","PSJHL10",65,0)
 .I '$D(@(F_"12,0)")) S ^(0)=U_55.0612_U_0_U_0
"RTN","PSJHL10",66,0)
 .S JJ=0 F  S JJ=$O(PROCOM(JJ)) Q:'JJ  S $P(@(F_"12,0)"),"^",3,4)=JJ_"^"_JJ,@(F_"12,"_JJ_",0)")=PROCOM(JJ)
"RTN","PSJHL10",67,0)
 S @(F_"6)")=$$ENPC^PSJHL11("U",180)
"RTN","PSJHL10",68,0)
 D CRA^PSGOETO
"RTN","PSJHL10",69,0)
 L -^PS(55,DFN,5,DA)
"RTN","PSJHL10",70,0)
 S PSGORD=DA_"U"
"RTN","PSJHL10",71,0)
OUT ;
"RTN","PSJHL10",72,0)
 Q
"RTN","PSJHL10",73,0)
 ;
"RTN","PSJHL10",74,0)
CHK(X,Y,Z)      ;Check for required fields
"RTN","PSJHL10",75,0)
 ; Input: X="^^"_MED ROUTE_"^^^^"_SCH TYPE
"RTN","PSJHL10",76,0)
 ;        Y=ORDERABLE ITEM_"^"_DOSAGE ORDERED
"RTN","PSJHL10",77,0)
 ;        Z=SCHEDULE_"^"_START DATE/TIME_"^^"_STOP DATE/TIME
"RTN","PSJHL10",78,0)
 D CHK^PSJHL7(X,Y,Z)
"RTN","PSJHL10",79,0)
 Q
"RTN","PSJHL10",80,0)
 ;
"RTN","PSJHL10",81,0)
DDOK(PSJF,OI) ;Check to be sure all dispense drugs that are active in the
"RTN","PSJHL10",82,0)
 ;order are valid.
"RTN","PSJHL10",83,0)
 ; Input: PSJF - File root of the order including all but the IEN of 
"RTN","PSJHL10",84,0)
 ;               the drug. (EX "^PS(53.45,X,2,")
"RTN","PSJHL10",85,0)
 ;        OI   - IEN of the order's orderable item
"RTN","PSJHL10",86,0)
 ; Output: 1 - all active DD's in the order are valid
"RTN","PSJHL10",87,0)
 ;         0 - no DD's active DD's or at least one active is invalid
"RTN","PSJHL10",88,0)
 N DDCNT,ND,PSJ,PSJ1 S (PSJ1,DDCNT)=0
"RTN","PSJHL10",89,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=+$E(%,1,12)
"RTN","PSJHL10",90,0)
 I '$O(@(PSJF_"0)")) Q 1
"RTN","PSJHL10",91,0)
 ; Naked reference below refers to ^PS(53.45, created using indirection in variable PSJF
"RTN","PSJHL10",92,0)
 F PSJ=0:0 S PSJ=$O(@(PSJF_PSJ_")")) Q:'PSJ  S ND=$G(@(PSJF_PSJ_",0)"))  D
"RTN","PSJHL10",93,0)
 .S DDCNT=DDCNT+1
"RTN","PSJHL10",94,0)
 .S PSJ1=$S('$D(^PSDRUG(+ND,0)):1,$P($G(^(2)),U,3)'["U":1,+$G(^(2))'=+OI:1,$G(^("I"))="":0,1:^("I")'>PSGDT)
"RTN","PSJHL10",95,0)
 Q $S('DDCNT:0,PSJ1=1:0,1:1)
"RTN","PSJHL10",96,0)
 ;
"RTN","PSJHL10",97,0)
IVSET ;
"RTN","PSJHL10",98,0)
 N P,DFN S DFN=PSJHLDFN,CHK=""
"RTN","PSJHL10",99,0)
 F X=1:1:23 S P(X)=""
"RTN","PSJHL10",100,0)
 S (P(2),P(3),P("NINITDT"))=+$P(DATA0,"^",5),P("LOG")=LOGIN,P(4)=$P(DATA0,"^",3),P(5)=$S(P(4)="S":$P(DATA0,"^",4),1:""),P(6)=PROVIDER,P(8)=$G(INFRT),P(9)=$G(SCHEDULE),P(17)="E",P(21)=PSJORDER,P(22)=LOC
"RTN","PSJHL10",101,0)
 S:P(4)="P" P(9)=$P(DATA0,"^",6)
"RTN","PSJHL10",102,0)
 I P(4)="S",P(5)=1 S P(9)=$P(DATA0,"^",6)
"RTN","PSJHL10",103,0)
 S P("MR")=$S(P(4)="P":$O(^PS(51.2,"B","IV PIGGYBACK",0)),1:$O(^PS(51.2,"B","INTRAVENOUS",0)))
"RTN","PSJHL10",104,0)
 S (P("CLRK"),P("NINIT"))=CLERK,P("PD")=PSITEM,(P("IVRM"),P("SYRS"),P("CLIN"),P("FRES"),P("OPI"))="",P("RES")=ROC,P("PRY")=$E(PRIORITY,2),P("REM")=""
"RTN","PSJHL10",105,0)
 I $$SCHREQ^PSJLIVFD(.P),P(15)'>0 N P15 S P15=$$INTERVAL^PSIVUTL(.P)
"RTN","PSJHL10",106,0)
 D CHKIV I CHK D ERROR Q
"RTN","PSJHL10",107,0)
 D SETN
"RTN","PSJHL10",108,0)
 D NEW55^PSIVORFB
"RTN","PSJHL10",109,0)
 N DA,DIK,ND,PSIVACT
"RTN","PSJHL10",110,0)
 S ND(0)=+ON55 F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSJHL10",111,0)
 S ND(.3)=$G(P("INS"))
"RTN","PSJHL10",112,0)
 S $P(ND(0),U,17)="E",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(ORDCON) F X=0,1,3,.2,.3 S ^PS(55,DFN,"IV",+ON55,X)=ND(X)
"RTN","PSJHL10",113,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,1,4)=P("LOG")_U_P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSJHL10",114,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,11)=+P("CLRK")
"RTN","PSJHL10",115,0)
 S:+$G(P("CLIN")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=P("CLIN")
"RTN","PSJHL10",116,0)
 S:+$G(P("NINIT")) ^PS(55,DFN,"IV",+ON55,4)=P("NINIT")_U_P("NINITDT")_"^^^^^^^^"_"1"
"RTN","PSJHL10",117,0)
 S ^PS(55,"APIV",DFN,+ON55)=""
"RTN","PSJHL10",118,0)
 I $D(PROCOM) D
"RTN","PSJHL10",119,0)
 .I '$D(^PS(55,DFN,"IV",+ON55,5,0)) S ^(0)=U_55.1115_U_0_U_0
"RTN","PSJHL10",120,0)
 .S JJ=0 F  S JJ=$O(PROCOM(JJ)) Q:'JJ  S $P(^PS(55,DFN,"IV",+ON55,5,0),"^",3,4)=JJ_"^"_JJ,^PS(55,DFN,"IV",+ON55,5,JJ,0)=PROCOM(JJ)
"RTN","PSJHL10",121,0)
 S ^PS(55,DFN,"IV",+ON55,3)=$$ENPC^PSJHL11("V",60)
"RTN","PSJHL10",122,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSJHL10",123,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSJHL10",124,0)
 L -^PS(55,DFN,"IV",DA)
"RTN","PSJHL10",125,0)
 S PSGORD=ON55
"RTN","PSJHL10",126,0)
 Q
"RTN","PSJHL10",127,0)
 ;
"RTN","PSJHL10",128,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSJHL10",129,0)
 K ^PS(55,DFN,"IV",+ON55,DRGT) S ^PS(55,DFN,"IV",+ON55,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSJHL10",130,0)
 F X=0:0 S X=$O(^TMP("PSB",$J,$S(DRGT="AD":800,1:900),X)) Q:'X  D
"RTN","PSJHL10",131,0)
 .S Y=^PS(55,DFN,"IV",+ON55,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJHL10",132,0)
 .S ^PS(55,DFN,"IV",+ON55,DRGT,0)=Y,^PS(55,DFN,"IV",+ON55,DRGT,+DRG,0)=$P(^TMP("PSB",$J,$S(DRGT="AD":800,1:900),X,0),"^")_"^"_$P(^TMP("PSJNVO",$J,DRGT,+DRG,0),"^",2)
"RTN","PSJHL10",133,0)
 Q
"RTN","PSJHL10",134,0)
 ;
"RTN","PSJHL10",135,0)
SETN ;Set up patient 0 node if needed.
"RTN","PSJHL10",136,0)
 I '$D(^PS(55,DFN,0)) K DO,DA,DD,DIC,PSIVFN S:$D(^(5.1)) PSIVFN=^(5.1) K:$D(PSIVFN) ^(5.1) S (DINUM,X)=DFN,DIC(0)="L",DIC="^PS(55," D FILE^DICN S:$D(PSIVFN) ^PS(55,DFN,5.1)=PSIVFN D  K DIC,PSIVFN,DO,DA,DD
"RTN","PSJHL10",137,0)
 .; Mark PSJ and PSO as converted
"RTN","PSJHL10",138,0)
 .S $P(^PS(55,DFN,5.1),"^",11)=2
"RTN","PSJHL10",139,0)
 Q
"RTN","PSJHL10",140,0)
 ;
"RTN","PSJHL10",141,0)
CHKIV ;Validate IV data
"RTN","PSJHL10",142,0)
 N OK S OK=0
"RTN","PSJHL10",143,0)
 I "APS"'[P(4) S CHK=1,PSREASON="Invalid IV Type" Q
"RTN","PSJHL10",144,0)
 I P(9)="",P(4)="P" S CHK=1,PSREASON="Piggyback IV Type requires a schedule" Q
"RTN","PSJHL10",145,0)
 I P(4)="S",P(5)=1,P(9)="" S CHK=1,PSREASON="Intermittent Syringe IV Type requires a schedule" Q
"RTN","PSJHL10",146,0)
 I P(9)'="STAT",(P(9)'="NOW"),P(9)'="" S CHK=1,PSREASON="Invalid Schedule" Q
"RTN","PSJHL10",147,0)
 I ORDCON'="V",ORDCON'="P" S CHK=1,PSREASON="Invalid Nature of Order" Q
"RTN","PSJHL10",148,0)
 I +$G(^TMP("PSB",$J,800,0))=0,+$G(^TMP("PSB",$J,900,0))=0 S CHK=1,PSREASON="IV orders must have at least one additive or solution" Q
"RTN","PSJHL10",149,0)
 I +$G(^TMP("PSB",$J,900,0))=0,P(4)'="P" S CHK=1,PSREASON="You must have at least one solution for this order." Q
"RTN","PSJHL10",150,0)
 I +$G(^TMP("PSB",$J,800,0))'=+$G(^TMP("PSJNVO",$J,"AD",0)) S CHK=1,PSREASON="Number of additives in BCMA & CPRS do not match." Q
"RTN","PSJHL10",151,0)
 I +$G(^TMP("PSB",$J,900,0))'=+$G(^TMP("PSJNVO",$J,"SOL",0)) S CHK=1,PSREASON="Number of solutions in BCMA & CPRS do not match." Q
"RTN","PSJHL10",152,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F DRGI=0:0 S DRGI=$O(^TMP("PSB",$J,$S(DRGT="AD":800,1:900),DRGI)) Q:'DRGI  S DRG=$G(^TMP("PSB",$J,$S(DRGT="AD":800,1:900),DRGI,0)) D DRG,@DRGT Q:CHK=1
"RTN","PSJHL10",153,0)
 I 'OK,'CHK S CHK=1,PSREASON="The Orderable Item does not match any of the additives or solutions in this order" Q
"RTN","PSJHL10",154,0)
 Q
"RTN","PSJHL10",155,0)
 ;
"RTN","PSJHL10",156,0)
AD ;Check additives
"RTN","PSJHL10",157,0)
 I '$D(^PS(FIL,+DRG,0)) S CHK=1,PSREASON="Additive "_+DRG_" does not exist in the additive file" Q
"RTN","PSJHL10",158,0)
 ;Naked reference below refers to ^PS(52.6,+DRG,0)
"RTN","PSJHL10",159,0)
 I $P(^(0),"^",11)=PSITEM S OK=1
"RTN","PSJHL10",160,0)
 I $$ENU^PSIVUTL(+DRG)'=$P($P(^TMP("PSJNVO",$J,DRGT,+DRGI,0),"^",2)," ",2,99)!(+$P(^TMP("PSJNVO",$J,DRGT,+DRGI,0),"^",2)'>0) S CHK=1,PSREASON="Invalid strength entered for additive "_+DRG Q
"RTN","PSJHL10",161,0)
 Q
"RTN","PSJHL10",162,0)
SOL ;Check solutions
"RTN","PSJHL10",163,0)
 I '$D(^PS(FIL,+DRG,0)) S CHK=1,PSREASON="Solution "_+DRG_" does not exist in the solution file" Q
"RTN","PSJHL10",164,0)
 ;Naked reference below refers to ^PS(52.7,+DRG,0)
"RTN","PSJHL10",165,0)
 I $P(^(0),"^",11)=PSITEM S OK=1
"RTN","PSJHL10",166,0)
 I +$P(^TMP("PSJNVO",$J,DRGT,+DRGI,0),"^",2)>9999!(+$P(^TMP("PSJNVO",$J,DRGT,+DRGI,0),"^",2)'>0) S CHK=1,PSREASON="Volume on "_+DRG_" is an invalid strength" Q
"RTN","PSJHL10",167,0)
 Q
"RTN","PSJHL10",168,0)
DRG ;Check to be sure additive/solutions are active
"RTN","PSJHL10",169,0)
 I $S('$G(^PS(FIL,+DRG,"I")):0,^("I")>DT:0,1:1) S CHK=1,PSREASON="An additive or solution is inactive" Q
"RTN","PSJHL10",170,0)
 Q
"RTN","PSJHL2")
0^82^B29657304
"RTN","PSJHL2",1,0)
PSJHL2 ;BIR/RLW-PATIENT ID AND VISIT SEGMENTS ;22 Nov 1999  9:27 AM
"RTN","PSJHL2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,18,16,23,28,42,50,70,58,100,102,110**;16 DEC 97
"RTN","PSJHL2",3,0)
 ;
"RTN","PSJHL2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL2",5,0)
 ; Reference to ^SC("B" is supported by DBIA# 10040.
"RTN","PSJHL2",6,0)
 ; Reference to $$FMTHL7^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL2",7,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL2",8,0)
 ;
"RTN","PSJHL2",9,0)
EN1(PSJHLDFN,PSOC,PSJORDER,PSREASON) ; start here
"RTN","PSJHL2",10,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL2",11,0)
 ;               PSJORDER* (order_file (N,P,V, etc))
"RTN","PSJHL2",12,0)
 ;               PSOC* (order control code - NW for new order, OK to return filler number to OE/RR, OC for order canceled, SC for status change)
"RTN","PSJHL2",13,0)
 ;               PSREASON* (text reason)
"RTN","PSJHL2",14,0)
 ; *=optional, only required if an order segment is also to be generated
"RTN","PSJHL2",15,0)
START ;
"RTN","PSJHL2",16,0)
 K ^TMP("PSJHLS",$J,"PS")
"RTN","PSJHL2",17,0)
 N CLERK,J,LIMIT,NAME,NEXT,NODE1,NODE2,NODE4,NOO,PSJCLEAR,PSJHINST,PSJHLSDT,PROVIDER,PSJI,ROOMBED,RXORDER,STATUS,UNDO,VERIFY,WARD
"RTN","PSJHL2",18,0)
 S RXORDER=PSJORDER,PSJORDER=$S((PSJORDER["N")!(PSJORDER["P"):"^PS(53.1,"_+PSJORDER,PSJORDER["V":"^PS(55,"_PSJHLDFN_",""IV"","_+PSJORDER,1:"^PS(55,"_PSJHLDFN_",5,"_+PSJORDER)_","
"RTN","PSJHL2",19,0)
 I RXORDER["P",$P($G(@(PSJORDER_"0)")),U,15)'=PSJHLDFN S ORDCON="Patient does not match/PSJHL2" S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(ORDCON) Q
"RTN","PSJHL2",20,0)
 S UNDO=$S("OC^CR"[PSOC:1,1:0)
"RTN","PSJHL2",21,0)
 D INIT,PID,PV1,ORC
"RTN","PSJHL2",22,0)
 D @$S("SN^SC^OC^OD^DR^CR^OH^OR^XX^ZC^XR"[PSOC:"EN1^PSJHL3(PSJHLDFN,PSOC,PSJORDER)",1:"CALL^PSJHLU(PSJI)")
"RTN","PSJHL2",23,0)
 I UNDO D UNDO
"RTN","PSJHL2",24,0)
 K ^TMP("PSJHLS",$J,"PS"),FIELD
"RTN","PSJHL2",25,0)
 Q
"RTN","PSJHL2",26,0)
 ;
"RTN","PSJHL2",27,0)
INIT ; initialize HL7 variables, set master file identification segment
"RTN","PSJHL2",28,0)
 ; PSJHLMTN = message type - ORR for messages sent as a response to an OE/RR event; ORM for "unsolicited" messages.
"RTN","PSJHL2",29,0)
 S PSJI=0,PSJHLMTN=$S($G(PSJHLMTN)]"":PSJHLMTN,1:"ORM")
"RTN","PSJHL2",30,0)
 D INIT^PSJHLU
"RTN","PSJHL2",31,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL2",32,0)
 S FIELD(0)="MSH",FIELD(1)="^~\&",FIELD(2)="PHARMACY",FIELD(3)=$G(PSJHINST),FIELD(8)=PSJHLMTN
"RTN","PSJHL2",33,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",34,0)
 Q
"RTN","PSJHL2",35,0)
 ;
"RTN","PSJHL2",36,0)
PID ; get patient data, format PID SEGMENT
"RTN","PSJHL2",37,0)
 S LIMIT=22 X PSJCLEAR
"RTN","PSJHL2",38,0)
 S FIELD(0)="PID"
"RTN","PSJHL2",39,0)
 S FIELD(3)=PSJHLDFN
"RTN","PSJHL2",40,0)
 N DFN S DFN=PSJHLDFN D DEM^VADPT S FIELD(5)=VADM(1)
"RTN","PSJHL2",41,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",42,0)
 Q
"RTN","PSJHL2",43,0)
 ;
"RTN","PSJHL2",44,0)
PV1 ; get patient visit information, format PV1 segment
"RTN","PSJHL2",45,0)
 S LIMIT=50 X PSJCLEAR
"RTN","PSJHL2",46,0)
 S FIELD(0)="PV1"
"RTN","PSJHL2",47,0)
 I PSJHLMTN="ORR" S FIELD(3)=LOC
"RTN","PSJHL2",48,0)
 I PSJHLMTN="ORM" D
"RTN","PSJHL2",49,0)
 .S LOC="",WARD=$G(^DPT(PSJHLDFN,.1)),LOC=$S($G(WARD)]"":$O(^SC("B",WARD,LOC)),1:LOC)
"RTN","PSJHL2",50,0)
 .I $G(LOC)="" D
"RTN","PSJHL2",51,0)
 .. I RXORDER["P",($G(^PS(53.1,+RXORDER,"DSS"))) S LOC=$P(^("DSS"),"^")
"RTN","PSJHL2",52,0)
 .. I RXORDER["V",($G(^PS(55,PSJHLDFN,"IV",+RXORDER,"DSS"))) S LOC=$P(^("DSS"),"^")
"RTN","PSJHL2",53,0)
 .I $G(LOC)]"" S ROOMBED=$G(^DPT(PSJHLDFN,.101)),LOC=LOC_"^"_ROOMBED
"RTN","PSJHL2",54,0)
 .S FIELD(3)=LOC
"RTN","PSJHL2",55,0)
 S FIELD(2)=$S($G(CLASS)="O":CLASS,1:"I")
"RTN","PSJHL2",56,0)
 I FIELD(2)="I" N DFN S DFN=PSJHLDFN D INP^VADPT S FIELD(19)=VAIN(1)
"RTN","PSJHL2",57,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",58,0)
 Q
"RTN","PSJHL2",59,0)
 ;
"RTN","PSJHL2",60,0)
ORC ; order control segment
"RTN","PSJHL2",61,0)
 S LIMIT=18 X PSJCLEAR
"RTN","PSJHL2",62,0)
 Q:'$D(PSJORDER)!'$D(PSOC)
"RTN","PSJHL2",63,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)"))
"RTN","PSJHL2",64,0)
 S NODE4=$G(@(PSJORDER_"4)"))
"RTN","PSJHL2",65,0)
 S FIELD(0)="ORC"
"RTN","PSJHL2",66,0)
 S FIELD(1)=PSOC
"RTN","PSJHL2",67,0)
 S FIELD(2)=$S(PSOC="SN":"",1:$P(NODE1,"^",21))_"^OR" I $P(FIELD(2),"^")=0 S $P(FIELD(2),"^")="" ; IV orders are created with a zero in the oerr order number, for some reason
"RTN","PSJHL2",68,0)
 S FIELD(3)=RXORDER_"^PS"
"RTN","PSJHL2",69,0)
 ; translate Pharmacy status code to HL7 status code, set in FIELD(5)
"RTN","PSJHL2",70,0)
 S STATUS=$S($G(PSJEXPOE):"E",(($P(NODE1,"^",17)]"")&(RXORDER["V")):($P(NODE1,"^",17)),($P(NODE1,"^",9)]""):$P(NODE1,"^",9),$G(PSIVCOPY):"DE",1:"")
"RTN","PSJHL2",71,0)
 D @STATUS
"RTN","PSJHL2",72,0)
 I STATUS="U",RXORDER["P" S FIELD(3)="^PS"
"RTN","PSJHL2",73,0)
 S FIELD(9)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE2,"^")),1:$$FMTHL7^XLFDT($P(NODE1,"^",16)))
"RTN","PSJHL2",74,0)
 S CLERK=$S(RXORDER["V":$P(NODE2,"^",11),1:$P(NODE4,"^",7))
"RTN","PSJHL2",75,0)
 S NAME=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL2",76,0)
 S FIELD(10)=CLERK_"^"_NAME
"RTN","PSJHL2",77,0)
 I PSOC="ZV"!($G(PSJBCBU)) S VERIFY=$P($G(NODE4),"^"),FIELD(11)=VERIFY_"^"_$P($G(^VA(200,+VERIFY,0)),"^"),FIELD(9)=$$FMTHL7^XLFDT($P(NODE4,"^",2))
"RTN","PSJHL2",78,0)
 S PROVIDER=$S($G(PSJDCPRV)]"":$G(PSJDCPRV),RXORDER["V":$P(NODE1,"^",6),1:$P(NODE1,"^",2)) K PSJDCPRV
"RTN","PSJHL2",79,0)
 S NAME=$P($G(^VA(200,+PROVIDER,0)),"^")
"RTN","PSJHL2",80,0)
 S FIELD(12)=PROVIDER_"^"_NAME
"RTN","PSJHL2",81,0)
 S FIELD(15)=$S(RXORDER["V":$$FMTHL7^XLFDT($P(NODE1,"^",2)),1:$$FMTHL7^XLFDT($P(NODE2,"^",2)))
"RTN","PSJHL2",82,0)
 I $S(RXORDER["V":$P(NODE2,"^",8)="R",1:$P(NODE1,"^",24)="R")
"RTN","PSJHL2",83,0)
 N FIELD9 S FIELD9=$$FMTHL7^XLFDT($$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)) I FIELD9>FIELD(9) S FIELD(9)=FIELD9,FIELD(15)=FIELD9
"RTN","PSJHL2",84,0)
 S NOO=$S(PSJORDER["IV":$G(P("NAT")),(($G(PSJNOO)="")&($G(P("NAT"))]"")):$G(P("NAT")),1:$G(PSJNOO)),PSREASON=$S(NOO="D":"",1:$G(PSREASON))
"RTN","PSJHL2",85,0)
 S FIELD(16)=NOO_U_$S(NOO="P":"Telephoned",NOO="D":"Duplicate",NOO="X":"Rejected",NOO="A":"Auto",NOO="S":"Service Correction",NOO="W":"Written",NOO="V":"Verbal",NOO="E":"Physician Entered",NOO="I":"Policy",1:"")_U_"99ORN"_U_U_$G(PSREASON)_U
"RTN","PSJHL2",86,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY
"RTN","PSJHL2",87,0)
 Q
"RTN","PSJHL2",88,0)
 ;
"RTN","PSJHL2",89,0)
DISPLAY ; just for testing
"RTN","PSJHL2",90,0)
 I $G(MSGTEST) W ! F NEXT=0:1:LIMIT W FIELD(NEXT)_"|"
"RTN","PSJHL2",91,0)
 Q
"RTN","PSJHL2",92,0)
UNDO ;Undo Renew if Pending Renewal is dc'd
"RTN","PSJHL2",93,0)
 I RXORDER["P",(STATUS="D"),($G(PSJNOO)'="A"),($P(NODE1,U,24)="R") D ENBKOUT^PSJOREN(PSJHLDFN,RXORDER)
"RTN","PSJHL2",94,0)
 Q
"RTN","PSJHL2",95,0)
 ;
"RTN","PSJHL2",96,0)
A S FIELD(5)="CM" Q  ; active
"RTN","PSJHL2",97,0)
D S FIELD(5)="DC" Q  ; discontinued
"RTN","PSJHL2",98,0)
I S FIELD(5)="IP" Q  ; incomplete
"RTN","PSJHL2",99,0)
N S FIELD(5)="IP" Q  ; non-verified
"RTN","PSJHL2",100,0)
U S FIELD(5)="ZX" Q  ; unreleased
"RTN","PSJHL2",101,0)
P S FIELD(5)="IP" Q  ; pending
"RTN","PSJHL2",102,0)
DE S FIELD(5)="RP" Q  ; discontinued (edit)
"RTN","PSJHL2",103,0)
E S FIELD(5)="ZE" Q  ; expired
"RTN","PSJHL2",104,0)
H S FIELD(5)="HD" Q  ; hold
"RTN","PSJHL2",105,0)
R S FIELD(5)="ZZ" Q  ; renewed
"RTN","PSJHL2",106,0)
RE S FIELD(5)="CM" Q  ; reinstated
"RTN","PSJHL2",107,0)
DR S FIELD(5)="DC" Q  ; discontinued (renewal)
"RTN","PSJHL2",108,0)
O S FIELD(5)="HD" Q  ; on call (is this kind of like HOLD?)
"RTN","PSJHL3")
0^83^B62116348
"RTN","PSJHL3",1,0)
PSJHL3 ;BIR/RLW-PHARMACY ORDER SEGMENTS ;04 Aug 98 / 10:10 AM
"RTN","PSJHL3",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,11,14,40,42,47,50,56,58,92,101,102,123,110**;16 DEC 97
"RTN","PSJHL3",3,0)
 ;
"RTN","PSJHL3",4,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJHL3",5,0)
 ; Reference to ^PS(50.607 is supported by DBIA# 2221.        
"RTN","PSJHL3",6,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL3",7,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL3",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL3",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL3",10,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL3",11,0)
 ; Reference to ^PSDRUG( is supported by DBIA# 2192.
"RTN","PSJHL3",12,0)
 ; Reference to ^PSNDF( is supported by DBIA# 2195.
"RTN","PSJHL3",13,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL3",14,0)
 ; Reference to ^PSNAPIS is supported by DBIA# 2531.
"RTN","PSJHL3",15,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL3",16,0)
 ; Reference to ^PSSUTIL1 is supported by DBIA# 3179.
"RTN","PSJHL3",17,0)
 ;
"RTN","PSJHL3",18,0)
EN1(PSJHLDFN,PSOC,PSJORDER) ; start here
"RTN","PSJHL3",19,0)
 ; passed in are PSJHLDFN (patient ien)
"RTN","PSJHL3",20,0)
 ;               PSJORDER (file root of order)
"RTN","PSJHL3",21,0)
 ;               OC (order control code - NW for new order, OK for finished order, OC for order canceled)
"RTN","PSJHL3",22,0)
 I $G(PSJHLDFN)']""!$G(PSOC)']""!$G(PSJORDER)']"" W !,"INSUFFICIENT DATA FOR ^PSJHL3" Q
"RTN","PSJHL3",23,0)
 N COMMENTS,DDIEA,DDNUM,DOSE,DOSEFORM,DOSEOR,NAME,DURATION,IVTYPE,NODE1,NODE2,NDNODE,OINODE,PSGPLS,PSGPLF,PRODNAME,SPDIEN,UNIT,UNITS,CNT,DDIEN,SCHEDULE
"RTN","PSJHL3",24,0)
 D INIT
"RTN","PSJHL3",25,0)
 S IVTYPE=$S(RXORDER["U":"",1:$$IVTYPE^PSJHLU(PSJORDER))
"RTN","PSJHL3",26,0)
 D RXO,RXE D:(IVTYPE'="F")!($G(PSJBCBU)) RXR D ZRX
"RTN","PSJHL3",27,0)
 D CALL^PSJHLU(PSJI)
"RTN","PSJHL3",28,0)
 Q
"RTN","PSJHL3",29,0)
 ;
"RTN","PSJHL3",30,0)
INIT ; initialize HL7 variables
"RTN","PSJHL3",31,0)
 D INIT^PSJHLU
"RTN","PSJHL3",32,0)
 Q
"RTN","PSJHL3",33,0)
 ;
"RTN","PSJHL3",34,0)
RXO ; pharmacy prescription order segment (used to send Orderable Item to OE/RR)
"RTN","PSJHL3",35,0)
 S LIMIT=17 X PSJCLEAR
"RTN","PSJHL3",36,0)
 S FIELD(0)="RXO"
"RTN","PSJHL3",37,0)
 S OINODE=$G(@(PSJORDER_".2)"))
"RTN","PSJHL3",38,0)
 S SPDIEN=+$P(OINODE,"^"),DOSEOR=$P(OINODE,"^",2),DOSE=$P(OINODE,"^",5),UNIT=$P(OINODE,"^",6)
"RTN","PSJHL3",39,0)
 S FIELD(1)=$S(SPDIEN=0:"^^^^",1:"^^^"_SPDIEN_"^")
"RTN","PSJHL3",40,0)
 I SPDIEN S DOSEFORM=$P($G(^PS(50.7,SPDIEN,0)),"^",2),NAME=$P($G(^PS(50.606,+DOSEFORM,0)),"^"),FIELD(1)=FIELD(1)_$P($G(^PS(50.7,SPDIEN,0)),"^")_" "_NAME
"RTN","PSJHL3",41,0)
 S FIELD(1)=FIELD(1)_"^99PSP"
"RTN","PSJHL3",42,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",43,0)
 Q
"RTN","PSJHL3",44,0)
 ;
"RTN","PSJHL3",45,0)
RXE ; pharmacy encoded order segment
"RTN","PSJHL3",46,0)
 S (UNITS,NDNODE,SPDIEN,PRODNAME,DDNUM,DDIEN,CNT)="",LIMIT=26 X PSJCLEAR
"RTN","PSJHL3",47,0)
 S FIELD(0)="RXE"
"RTN","PSJHL3",48,0)
 S NODE1=$G(@(PSJORDER_"0)")),NODE2=$G(@(PSJORDER_"2)"))
"RTN","PSJHL3",49,0)
 I RXORDER["V" D IVRXE Q
"RTN","PSJHL3",50,0)
 I RXORDER["P",IVTYPE="F" D IVRXE Q
"RTN","PSJHL3",51,0)
 I RXORDER["P",$P(NODE1,"^",4)="H" D IVRXE Q
"RTN","PSJHL3",52,0)
 ;S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4),X1=PSGPLF,X2=PSGPLS D ^%DTC S DURATION="D"_X
"RTN","PSJHL3",53,0)
 N RENEW S RENEW=$$LASTREN^PSJLMPRI(PSJHLDFN,RXORDER)
"RTN","PSJHL3",54,0)
 S PSGPLS=$S($G(PSJEXPOE):$P(NODE2,"^",2),RENEW>$P(NODE2,"^",2):RENEW,1:$P(NODE2,"^",2))
"RTN","PSJHL3",55,0)
 S PSGPLF=$S($G(PSJEXPOE):PSJEXPOE,1:$P(NODE2,"^",4))
"RTN","PSJHL3",56,0)
 ;S FIELD(1)="^"_$P(NODE2,"^")_$S($G(PSJBCBU):"&"_$P(NODE2,"^",5),1:"")_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",57,0)
 S FIELD(1)="^"_$P(NODE2,"^")_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",58,0)
 S FIELD(21)="^"_$P(NODE2,"^",5)_"^99PSA^^^"
"RTN","PSJHL3",59,0)
 I ($G(DOSEOR)']"")!($O(@(PSJORDER_"1,"" "")"),-1)=1) D
"RTN","PSJHL3",60,0)
 .S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  Q:CNT=1  S DDIEN=+$G(@(PSJORDER_"1,"_DDNUM_",0)")) D
"RTN","PSJHL3",61,0)
 ..S FIELD(1)=$S($P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2)="":"1",1:$P(@(PSJORDER_"1,"_DDNUM_",0)"),"^",2))_"&"_FIELD(1)
"RTN","PSJHL3",62,0)
 ..S FIELD(1)=DOSE_"&"_UNIT_"&"_FIELD(1),$P(FIELD(1),"^",8)=$S($G(DOSEOR)]"":$G(DOSEOR),1:DOSE_UNIT)
"RTN","PSJHL3",63,0)
 ..S:$P(FIELD(1),"^",8)="" $P(FIELD(1),"^",8)=$G(@(PSJORDER_".3)"))
"RTN","PSJHL3",64,0)
 ..S NDNODE=$G(^PSDRUG(DDIEN,"ND"))
"RTN","PSJHL3",65,0)
 ..;  CHANGE FOR NEW NDF CALL
"RTN","PSJHL3",66,0)
 ..;S PRODNAME=$S($G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",67,0)
 ..S PRODNAME=$S($T(^PSNAPIS)]"":$$PROD0^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),$G(^PSNDF(+NDNODE,5,+$P(NDNODE,"^",3),0))]"":^(0),1:"N/A")
"RTN","PSJHL3",68,0)
 ..S:PRODNAME="" PRODNAME="N/A"
"RTN","PSJHL3",69,0)
 ..S FIELD(2)=$S(PRODNAME="N/A":"^^",1:+NDNODE_"."_+$P(NDNODE,"^",3)_"^"_$P(NDNODE,"^",2)_"^"_"99NDF")_"^"_DDIEN_"^"_$P($G(^PSDRUG(DDIEN,0)),"^")_"^"_"99PSD"
"RTN","PSJHL3",70,0)
 ..;S UNITS=$S(PRODNAME="N/A":"N/A",1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^"))
"RTN","PSJHL3",71,0)
 ..S UNITS=$S(PRODNAME="N/A":"N/A",1:$S($T(^PSNAPIS)]"":$P($$DFSU^PSNAPIS(+NDNODE,$P(NDNODE,"^",3)),"^",5),1:$P($G(^PSNDF(+NDNODE,2,+$P(PRODNAME,"^",2),3,+$P(PRODNAME,"^",3),4,+$P(PRODNAME,"^",4),0)),"^")))
"RTN","PSJHL3",72,0)
 ..S FIELD(5)="^^^"_UNITS_"^"_$P($G(^PS(50.607,UNITS,0)),"^")_"^99PSU"
"RTN","PSJHL3",73,0)
 ..S FIELD(6)="^^^"_$G(DOSEFORM)_"^"_$P($G(^PS(50.606,+$G(DOSEFORM),0)),"^")_"^99PSF"
"RTN","PSJHL3",74,0)
 ..S FIELD(25)=$$EN^PSSUTIL1(DDIEN),FIELD(26)=$P(FIELD(25),"|",2),FIELD(25)=$P(FIELD(25),"|")
"RTN","PSJHL3",75,0)
 ..S CNT=CNT+1
"RTN","PSJHL3",76,0)
 E  S $P(FIELD(1),"^",8)=DOSEOR
"RTN","PSJHL3",77,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^"),FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",78,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",79,0)
 K SEGMENT S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHL3",80,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",81,0)
 I $P($G(@(PSJORDER_"6)")),"^")]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"6)")),"^") D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",82,0)
 I PSJORDER["P",$P($G(@(PSJORDER_"9)")),"^",2)]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"9)")),"^",2) D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",83,0)
 Q
"RTN","PSJHL3",84,0)
 ;
"RTN","PSJHL3",85,0)
IVRXE ; RXE segment for IV orders
"RTN","PSJHL3",86,0)
 ; if it's an Inpatient Med IV order, send the RXE with dispense drug
"RTN","PSJHL3",87,0)
 ; information.  If it's an IV FLUID order, send just the start/stop
"RTN","PSJHL3",88,0)
 ; date, duration in the RXE and send an RXC for each additive and
"RTN","PSJHL3",89,0)
 ; solution.
"RTN","PSJHL3",90,0)
 N ADSNODE
"RTN","PSJHL3",91,0)
 I RXORDER["V" S PSGPLS=$P(NODE1,"^",2),PSGPLF=$P(NODE1,"^",3)
"RTN","PSJHL3",92,0)
 E  S PSGPLS=$P(NODE2,"^",2),PSGPLF=$P(NODE2,"^",4)
"RTN","PSJHL3",93,0)
 ;S X1=PSGPLF,X2=PSGPLS D ^%DTC S DURATION=$S(X]"":"D"_X,1:"")
"RTN","PSJHL3",94,0)
 S FIELD(1)="^"_$S(PSJORDER["IV":$P(NODE1,"^",9),1:$P(NODE2,"^"))_"^^"_$$FMTHL7^XLFDT(PSGPLS)_"^"_$$FMTHL7^XLFDT(PSGPLF)
"RTN","PSJHL3",95,0)
 ;S:$G(PSJBCBU) $P(FIELD(1),"^",2)=$P(FIELD(1),"^",2)_"&"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))
"RTN","PSJHL3",96,0)
 S FIELD(21)="^"_$S(PSJORDER["IV":$P(NODE1,"^",11),1:$P(NODE2,"^",5))_"^99PSA^^^"
"RTN","PSJHL3",97,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHL3",98,0)
 S FIELD(14)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",99,0)
 N X,Y
"RTN","PSJHL3",100,0)
 I RXORDER["V" S INFUSE=$P(NODE1,"^",8)
"RTN","PSJHL3",101,0)
 E  S INFUSE=$P($G(@(PSJORDER_"8)")),"^",5)
"RTN","PSJHL3",102,0)
 I INFUSE?1N.N1" ml/hr" S FIELD(23)=+INFUSE,Y=$P(INFUSE,+INFUSE,2),Y=$$TRIM^XLFSTR(Y,"LR"," "),FIELD(24)="^^^^"_Y_"^PSU"
"RTN","PSJHL3",103,0)
 I FIELD(23)="",FIELD(24)="" S FIELD(23)=INFUSE
"RTN","PSJHL3",104,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",105,0)
 K SEGMENT I RXORDER["V" S JJ=0 F  S JJ=$O(@(PSJORDER_"5,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"5,"_JJ_",0)"))
"RTN","PSJHL3",106,0)
 E  S JJ=0 F  S JJ=$O(@(PSJORDER_"12,"_JJ_")")) Q:'JJ  S SEGMENT(JJ-1)=$G(@(PSJORDER_"12,"_JJ_",0)"))
"RTN","PSJHL3",107,0)
 I $D(SEGMENT(0)) S SEGMENT(0)="NTE|6|L|"_SEGMENT(0) D SET^PSJHLU K SEGMENT,JJ
"RTN","PSJHL3",108,0)
 I RXORDER["V",$P($G(@(PSJORDER_"3)")),"^")]"" K SEGMENT S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"3)")),"^") D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",109,0)
 I RXORDER["P",$P($G(@(PSJORDER_"9)")),U,2)]"" S SEGMENT(0)="NTE|21|L|"_$P($G(@(PSJORDER_"9)")),U,2) D SET^PSJHLU K SEGMENT
"RTN","PSJHL3",110,0)
 ;
"RTN","PSJHL3",111,0)
RXC ;component segments
"RTN","PSJHL3",112,0)
 N ADDITIVE,SOLUTION,SUB,TYPE,AD,SOL,PTR,NUM
"RTN","PSJHL3",113,0)
 S LIMIT=24 X PSJCLEAR
"RTN","PSJHL3",114,0)
 S FIELD(0)="RXC"
"RTN","PSJHL3",115,0)
 ; In the line below, the naked reference refers to the full global reference represented in PSJORDER_TYPE...
"RTN","PSJHL3",116,0)
 ; This could be a reference to either ^PS(53.1 or ^PS(55
"RTN","PSJHL3",117,0)
 S AD="AD",SOL="SOL" F TYPE="AD","SOL" S SUB=0 F  S SUB=$O(@(PSJORDER_TYPE_","_SUB_")")) Q:SUB=""  S NODE1=$G(^(SUB,0)) Q:NODE1=""  D
"RTN","PSJHL3",118,0)
 .S FIELD(1)=$S(TYPE="AD":"A",1:"B")
"RTN","PSJHL3",119,0)
 .S PTR=+$S(TYPE="AD":+$P($G(^PS(52.6,$P(NODE1,"^"),0)),"^",11),1:+$P($G(^PS(52.7,$P(NODE1,"^"),0)),"^",11))
"RTN","PSJHL3",120,0)
 .S FIELD(2)="^^^"_$S($G(PSJBCBU):+$P(NODE1,"^"),1:PTR)_"^"_$S($G(PSJBCBU):$S(TYPE="AD":$P($G(^PS(52.6,+$P(NODE1,"^"),0)),"^"),1:$P($G(^PS(52.7,+$P(NODE1,"^"),0)),"^")_" "_$P($G(^(0)),U,4)),1:$P($G(^PS(50.7,PTR,0)),"^"))
"RTN","PSJHL3",121,0)
 .S:(TYPE="AD"&$G(PSJBCBU)) FIELD(2)=FIELD(2)_$S($P(NODE1,"^",3)]"":" BOTTLE: "_$P(NODE1,"^",3),1:"")
"RTN","PSJHL3",122,0)
 .S FIELD(2)=FIELD(2)_"^99PSP"
"RTN","PSJHL3",123,0)
 .S FIELD(3)=$P($P(NODE1,"^",2)," ")
"RTN","PSJHL3",124,0)
 .S FIELD(4)=$P($P(NODE1,"^",2)," ",2)
"RTN","PSJHL3",125,0)
 .S NUM=$S(FIELD(4)="":"","ML^LITER^MCG^MG^GM^UNITS^IU^MEQ^MM^MU^THOUU"[FIELD(4):$P($T(@(FIELD(4))),";",3),1:"")
"RTN","PSJHL3",126,0)
 .S FIELD(4)="^^^"_NUM_"^"_FIELD(4)_"^99OTH"
"RTN","PSJHL3",127,0)
 .D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",128,0)
 Q
"RTN","PSJHL3",129,0)
 ;
"RTN","PSJHL3",130,0)
RXR ; med route segment
"RTN","PSJHL3",131,0)
 S LIMIT=4 X PSJCLEAR
"RTN","PSJHL3",132,0)
 S FIELD(0)="RXR"
"RTN","PSJHL3",133,0)
 I PSJORDER["IV" S FIELD(1)="^^^"_$P($G(@(PSJORDER_".2)")),"^",3) Q:$P(FIELD(1),U,4)=""  D
"RTN","PSJHL3",134,0)
 .S FIELD(1)=FIELD(1)_"^"_$P($G(^PS(51.2,+$P(FIELD(1),"^",4),0)),"^")_"^99PSR"
"RTN","PSJHL3",135,0)
 .S:$G(PSJBCBU) FIELD(4)="^^^"_$P($G(@(PSJORDER_"0)")),"^",4)_"^"_$$CODES^PSIVUTL($P($G(@(PSJORDER_"0)")),"^",4),55.01,.04)_"^99PSR"
"RTN","PSJHL3",136,0)
 S:FIELD(1)="" FIELD(1)="^^^"_$P(NODE1,"^",3)_"^"_$P($G(^PS(51.2,+$P(NODE1,"^",3),0)),"^")_"^99PSR"
"RTN","PSJHL3",137,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",138,0)
 Q
"RTN","PSJHL3",139,0)
 ;
"RTN","PSJHL3",140,0)
ZRX ; pharmacy Z-segment
"RTN","PSJHL3",141,0)
 S LIMIT=6 X PSJCLEAR
"RTN","PSJHL3",142,0)
 S FIELD(0)="ZRX"
"RTN","PSJHL3",143,0)
 I '$G(PSJREN) N PREON,PSJREN I $G(PSJORD)["U"&($P(NODE1,"^",24)="R") S PSJREN=1
"RTN","PSJHL3",144,0)
 I $G(PSJORD)["V"&($P(NODE2,"^",8)="R") S PSJREN=1
"RTN","PSJHL3",145,0)
 S PREON=$S($G(PSJREN):$G(PSJORD),PSJORDER["IV":$P(NODE2,"^",5),1:$P(NODE1,"^",25))
"RTN","PSJHL3",146,0)
 S FIELD(1)=$S(PREON["P":$P($G(^PS(53.1,+PREON,0)),"^",21),PREON["V":$P($G(^PS(55,PSJHLDFN,"IV",+PREON,0)),"^",21),1:$P($G(^PS(55,PSJHLDFN,5,+PREON,0)),"^",21))
"RTN","PSJHL3",147,0)
 S FIELD(2)=$S(PSJORDER["IV":$G(P("NAT")),1:$G(PSJNOO))
"RTN","PSJHL3",148,0)
 S FIELD(3)=$S($G(PSJREN):"R",PSJORDER["IV":$P(NODE2,"^",8),1:$P(NODE1,"^",24))
"RTN","PSJHL3",149,0)
 I FIELD(3)="" I PSOC="SN" S FIELD(3)="N"
"RTN","PSJHL3",150,0)
 S NAME=$P($G(^VA(200,DUZ,0)),"^")
"RTN","PSJHL3",151,0)
 S FIELD(5)=DUZ_"^"_NAME_"^"_"99NP"
"RTN","PSJHL3",152,0)
 S FIELD(6)=$S($G(IVTYPE)="F":"IV",$P($G(@(PSJORDER_"0)")),U,4)="H":"TPN",1:"")
"RTN","PSJHL3",153,0)
 D SEGMENT^PSJHLU(LIMIT),DISPLAY^PSJHL2
"RTN","PSJHL3",154,0)
 Q
"RTN","PSJHL3",155,0)
 ;
"RTN","PSJHL3",156,0)
CNT ;Count dispense drugs for an order
"RTN","PSJHL3",157,0)
 S (CNT,DDNUM)=0 F  S DDNUM=$O(@(PSJORDER_"1,"_DDNUM_")")) Q:'DDNUM  S CNT=CNT+1
"RTN","PSJHL3",158,0)
 Q
"RTN","PSJHL3",159,0)
ML ;;PSIV-1
"RTN","PSJHL3",160,0)
LITER ;;PSIV-2
"RTN","PSJHL3",161,0)
MCG ;;PSIV-3
"RTN","PSJHL3",162,0)
MG ;;PSIV-4
"RTN","PSJHL3",163,0)
GM ;;PSIV-5
"RTN","PSJHL3",164,0)
UNITS ;;PSIV-6
"RTN","PSJHL3",165,0)
IU ;;PSIV-7
"RTN","PSJHL3",166,0)
MEQ ;;PSIV-8
"RTN","PSJHL3",167,0)
MM ;;PSIV-9
"RTN","PSJHL3",168,0)
MU ;;PSIV-10
"RTN","PSJHL3",169,0)
THOUU ;;PSIV-11
"RTN","PSJHL4")
0^27^B57897507
"RTN","PSJHL4",1,0)
PSJHL4 ;BIR/RLW-DECODE HL7 /MESSSAGE FROM OE/RR ;16 Mar 99 / 4:55 PM
"RTN","PSJHL4",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,12,27,34,40,42,55,47,50,56,58,98,85,105,107,110**;16 DEC 97
"RTN","PSJHL4",3,0)
 ;
"RTN","PSJHL4",4,0)
 ; Reference to $$EN^PSOHLNEW is supported by DBIA# 2188.
"RTN","PSJHL4",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL4",6,0)
 ; Reference to ^%ZOSF is supported by DBIA# 10096.
"RTN","PSJHL4",7,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL4",8,0)
 ; Reference to ^DIK is supported by DBIA# 10013.
"RTN","PSJHL4",9,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL4",10,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL4",11,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL4",12,0)
 ;
"RTN","PSJHL4",13,0)
EN(PSJMSG) ; start here
"RTN","PSJHL4",14,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",15,0)
 N ADCNT,SOLCNT,OCCNT
"RTN","PSJHL4",16,0)
 N ACKDATE,ADDITIVE,ADMINSTR,APPL,COMMENT,PSJHLDFN,DISPENSE,DOSE,DURATION,II,INSTR,J,JJ,JJJ,K,LOGIN,NEWORDER,NURSEACK,OBXFL,OCNARR,OCPROV,OCRSN,ORDER,PRIORITY,PSITEM,ORDCON,PROCOM,PSJORDER,PSREASON
"RTN","PSJHL4",17,0)
 N LOC,PROVIDER,PSPR,PSOC,PTR,QQ,REQST,ROUTE,RXON,RXORDER,SCHEDULE,SEGMENT,SOLUTION,STPDT,STRENGTH,TEXT,CLERK,INFRT,IVTYP,SCHTYP,PREON,NOO,ROC,FREQ,CLASS,PSJHLMTN,UNIT,UNITS,QFLG,VOLUME,TVOLUME,PSGP
"RTN","PSJHL4",18,0)
 N PSJASTP,FLDATE,FLCMNT,PSJFLAG,PSJYN,PRNTON,APPT
"RTN","PSJHL4",19,0)
 S (ADCNT,SOLCNT,OCCNT,II,TVOLUME)="",(OBXFL,QFLG)=0,PSJHLMTN="ORR" F  S II=$O(PSJMSG(II)) Q:'II  D DECODE Q:QFLG  D @FIELD(0) Q:$G(CLASS)="O"  Q:QFLG
"RTN","PSJHL4",20,0)
 I ($G(CLASS)'="I")!(QFLG) G END
"RTN","PSJHL4",21,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") N DIK,DA S DIK="^PS(53.1,",DA=NEWORDER D EN1^DIK L -^PS(53.1,NEWORDER)
"RTN","PSJHL4",22,0)
 I ($G(PSOC)="NW")!($G(PSOC)="XO") D EN1^PSJHL2(PSJHLDFN,$S(PSOC="NW":"OK",1:"XR"),NEWORDER_"P")
"RTN","PSJHL4",23,0)
END ;
"RTN","PSJHL4",24,0)
 K ^TMP("PSJNVO",$J)
"RTN","PSJHL4",25,0)
 I (",S,A,")[(","_$G(PRIORITY)_",")!($G(SCHEDULE)="NOW")!($G(SCHEDULE)["STAT") D
"RTN","PSJHL4",26,0)
 . I $G(PRIORITY)="ZD",$G(PSGORD) D NOTIFY(PSGORD_$S(PSGORD["V":"V",PSGORD["U":"U",1:""),PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",27,0)
 . I $G(NEWORDER) D NOTIFY(NEWORDER_"P",PSJHLDFN,$G(PRIORITY),$G(SCHEDULE))
"RTN","PSJHL4",28,0)
 Q
"RTN","PSJHL4",29,0)
 ;
"RTN","PSJHL4",30,0)
DECODE ;break segment down into fields
"RTN","PSJHL4",31,0)
 K FIELD
"RTN","PSJHL4",32,0)
 S SEGMENT=$G(PSJMSG(II))
"RTN","PSJHL4",33,0)
 S J=0
"RTN","PSJHL4",34,0)
 F  Q:$G(SEGMENT)=""  D
"RTN","PSJHL4",35,0)
 .;get fields from segment
"RTN","PSJHL4",36,0)
 .I SEGMENT["|" S FIELD(J)=$P(SEGMENT,"|"),SEGMENT=$E(SEGMENT,$L(FIELD(J))+2,$L(SEGMENT)),J=J+1 Q
"RTN","PSJHL4",37,0)
 .I SEGMENT'["|" S FIELD(J)=SEGMENT,SEGMENT="" Q
"RTN","PSJHL4",38,0)
 Q
"RTN","PSJHL4",39,0)
 ;
"RTN","PSJHL4",40,0)
NOTIFY(ORDER,PSJHLDFN,PRIO,PSJSCHED) ;
"RTN","PSJHL4",41,0)
 N NTFYREAS,WARD,MGROUP,NTFSTAT,DRUG,DRIEN,PNAME,ORDATE,DO,PSG,XMY,VADPT,LASTFOUR
"RTN","PSJHL4",42,0)
 Q:($G(PRIO)=""&($G(PSJSCHED)=""))
"RTN","PSJHL4",43,0)
 S DFN=PSJHLDFN D DEM^VADPT S LASTFOUR=$P($P(VADM(2),"^",2),"-",3)
"RTN","PSJHL4",44,0)
 S NTFYREAS=$S((",S,A,")[(","_PRIO_","):1,($G(PSJSCHED)="NOW"):2,($G(PSJSCHED)="STAT"):3,1:0) Q:'NTFYREAS
"RTN","PSJHL4",45,0)
 S MGROUP="G.PSJ STAT NOW ACTIVE ORDER@"_$G(^XMB("NETNAME")),NTFSTAT="ACTIVE"
"RTN","PSJHL4",46,0)
 I ORDER["P" D PND S MGROUP="G.PSJ STAT NOW PENDING ORDER@"_$G(^XMB("NETNAME")),NTFSTAT="PENDING"
"RTN","PSJHL4",47,0)
 I ORDER["U" D UD
"RTN","PSJHL4",48,0)
 I ORDER["V" D IV
"RTN","PSJHL4",49,0)
 S PNAME=$P($G(^DPT(+PSJHLDFN,0)),"^") S:$G(RTE) RTE=$P(^PS(51.2,+RTE,0),"^",3)
"RTN","PSJHL4",50,0)
 S DRUG=$S(DRIEN:$P($G(^PS(50.7,+DRIEN,0)),"^"),1:""),WARD=$G(^DPT(PSJHLDFN,.1))
"RTN","PSJHL4",51,0)
 S XMY(MGROUP)="",XMDUZ="MEDICATIONS,INPATIENT",XMSUB=$G(WARD)
"RTN","PSJHL4",52,0)
 S XMSUB=XMSUB_"-"_NTFSTAT_" "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",$G(NTFYREAS)=3:"STAT",1:"")_"-"
"RTN","PSJHL4",53,0)
 S XMSUB=XMSUB_$E(PNAME,1,65-$L(XMSUB))
"RTN","PSJHL4",54,0)
 S XMTEXT="PSG("
"RTN","PSJHL4",55,0)
 S PSG(1,0)="Inpatient Medications has received the following "_$S($G(PRIO)="A":"ASAP",$G(PRIO)="S":"STAT",$G(NTFYREAS)=2:"NOW",1:"")_" order ("_NTFSTAT_")"
"RTN","PSJHL4",56,0)
 S PSG(2,0)=""
"RTN","PSJHL4",57,0)
 S PSG(3,0)="          Patient:     "_PNAME I $G(LASTFOUR) S PSG(3,0)=PSG(3,0)_"  ("_LASTFOUR_")"
"RTN","PSJHL4",58,0)
 S PSG(4,0)="Order Information:     "_DRUG_" "_DO_" "_RTE_" "_$G(PSJSCHED)
"RTN","PSJHL4",59,0)
 S PSG(5,0)="       Order Date:     "_$$ENDTC^PSGMI(ORDATE)
"RTN","PSJHL4",60,0)
 D ^XMD
"RTN","PSJHL4",61,0)
 Q
"RTN","PSJHL4",62,0)
 ;
"RTN","PSJHL4",63,0)
PND ;
"RTN","PSJHL4",64,0)
 Q:'$D(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",65,0)
 N NDP2,ND0 S NDP2=$G(^PS(53.1,+ORDER,.2)),ND0=$G(^PS(53.1,+ORDER,0))
"RTN","PSJHL4",66,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",67,0)
 S SCHED=$P($G(^PS(53.1,+ORDER,2)),"^")
"RTN","PSJHL4",68,0)
 Q
"RTN","PSJHL4",69,0)
UD ;
"RTN","PSJHL4",70,0)
 Q:'$D(^PS(55,PSJHLDFN,5,+ORDER,0))
"RTN","PSJHL4",71,0)
 N ND2,ND0 S ND0=$G(^PS(55,PSJHLDFN,5,+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,5,+ORDER,2)),NDP2=$G(^PS(55,PSJHLDFN,5,+ORDER,.2))
"RTN","PSJHL4",72,0)
 S DRIEN=+$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(ND0,"^",3),ORDATE=$P(ND0,"^",14)
"RTN","PSJHL4",73,0)
 S SCHED=$P(ND2,"^")
"RTN","PSJHL4",74,0)
 Q
"RTN","PSJHL4",75,0)
IV ;
"RTN","PSJHL4",76,0)
 Q:'$D(^PS(55,PSJHLDFN,"IV",+ORDER,0))
"RTN","PSJHL4",77,0)
 N ND2,NDP2,ND0 S ND0=$G(^PS(55,PSJHLDFN,"IV",+ORDER,0)),ND2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,2))
"RTN","PSJHL4",78,0)
 S NDP2=$G(^PS(55,PSJHLDFN,"IV",+ORDER,.2))
"RTN","PSJHL4",79,0)
 S DRIEN=$P(NDP2,"^"),DO=$P(NDP2,"^",2),RTE=$P(NDP2,"^",3)
"RTN","PSJHL4",80,0)
 S ORDATE=$P(ND2,"^"),SCHED=$P(ND0,"^",9)
"RTN","PSJHL4",81,0)
 Q
"RTN","PSJHL4",82,0)
MSH ;
"RTN","PSJHL4",83,0)
 S PSOC=FIELD(8)
"RTN","PSJHL4",84,0)
 Q
"RTN","PSJHL4",85,0)
 ;
"RTN","PSJHL4",86,0)
PID ;
"RTN","PSJHL4",87,0)
 S PSJHLDFN=FIELD(3)
"RTN","PSJHL4",88,0)
 Q
"RTN","PSJHL4",89,0)
 ;
"RTN","PSJHL4",90,0)
PV1 ;
"RTN","PSJHL4",91,0)
 N A
"RTN","PSJHL4",92,0)
 S CLASS=FIELD(2),LOC=FIELD(3),APPT="" I $G(FIELD(44))]"" S APPT=+$$HL7TFM^XLFDT(FIELD(44))
"RTN","PSJHL4",93,0)
 I "IO"'[CLASS S PSREASON="Invalid patient class" Q
"RTN","PSJHL4",94,0)
 ;N II K PSJNVA S II="" F  S II=$O(PSJMSG(II)) Q:'II  D  Q:CLASS="O"
"RTN","PSJHL4",95,0)
 N QQ K PSJNVA S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  D  Q:$G(PSJNVA)
"RTN","PSJHL4",96,0)
 .S X=$G(PSJMSG(QQ))
"RTN","PSJHL4",97,0)
 .I $P(X,"|")="ZRN" S PSJNVA=1,CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",98,0)
 .;I $P(X,"|")="ZRN" S PSJNVA=1 D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",99,0)
 ; OBR check - enable outpatient flagging from backdoor
"RTN","PSJHL4",100,0)
 I $G(PSJNVA) K PSJNVA Q
"RTN","PSJHL4",101,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="OBR" D  Q:$P(PSJMSG(QQ),"|")="OBR"
"RTN","PSJHL4",102,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",103,0)
 I CLASS="O" N QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="ORC" D  Q:$P(PSJMSG(QQ),"|")="ORC"
"RTN","PSJHL4",104,0)
 .S RXON=$P(PSJMSG(QQ),"|",4) I RXON]"" S RXON=$P(RXON,"^") I "ABNPUV"[$E(RXON,$L(RXON)) S CLASS="I"
"RTN","PSJHL4",105,0)
 I CLASS="O" N CHK,QQ S QQ=II F  S QQ=$O(PSJMSG(QQ)) Q:'QQ  I $P(PSJMSG(QQ),"|")="RXO" D  Q:$P(PSJMSG(QQ),"|")="RXO"
"RTN","PSJHL4",106,0)
 .S CHK=$P(PSJMSG(QQ),"|",2),CHK=$S($P(CHK,"^",5)="IV":"IV",1:$P(CHK,"^",4))
"RTN","PSJHL4",107,0)
 .I CHK="IV" S CLASS="I" Q
"RTN","PSJHL4",108,0)
 .I 'CHK S PSREASON="Missing or Invalid Orderable Item",CLASS="I" Q
"RTN","PSJHL4",109,0)
 .I $P($G(^PS(50.7,CHK,0)),"^",3)=1 S CLASS="I" Q
"RTN","PSJHL4",110,0)
 D:CLASS="O" EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",111,0)
 Q
"RTN","PSJHL4",112,0)
 ;
"RTN","PSJHL4",113,0)
ORC ;
"RTN","PSJHL4",114,0)
 S PSOC=FIELD(1)
"RTN","PSJHL4",115,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",116,0)
 I $G(PSREASON)]"" D ERROR^PSJHL9 Q
"RTN","PSJHL4",117,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",118,0)
 I PSOC="NA" D ASSIGN^PSJHL5 Q
"RTN","PSJHL4",119,0)
 S CLERK=+$G(FIELD(10))
"RTN","PSJHL4",120,0)
 S PROVIDER=+$G(FIELD(12)) D:PSOC="NW"
"RTN","PSJHL4",121,0)
 .I PROVIDER=0 S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q 
"RTN","PSJHL4",122,0)
 .I PROVIDER>0 S PSPR=$G(^VA(200,+PROVIDER,"PS")) I '$D(PSPR)!'(PSPR)!$S($P(PSPR,"^",4)="":0,1:$P(PSPR,"^",4)'>DT) S PSREASON="Invalid Provider" D ERROR^PSJHL9 Q
"RTN","PSJHL4",123,0)
 S UNITS=$P(FIELD(7),"^"),INSTR=$P(FIELD(7),"^",8)
"RTN","PSJHL4",124,0)
 S:UNITS["&" DOSE=$P(UNITS,"&"),UNIT=$P(UNITS,"&",2),UNITS=$P(UNITS,"&",3)
"RTN","PSJHL4",125,0)
 S SCHEDULE=$P(FIELD(7),"^",2),PRIORITY=$P(FIELD(7),"^",6) S:SCHEDULE["PRN" SCHTYP="P"
"RTN","PSJHL4",126,0)
 S DURATION=$P(FIELD(7),"^",3),REQST=$P(FIELD(7),"^",4) S:REQST'="" REQST=+$E(+$$HL7TFM^XLFDT(REQST),1,12) S REQST=$$DATE2^PSJUTL2(REQST)
"RTN","PSJHL4",127,0)
 S PRIORITY=$S($G(PRIORITY)]"":PRIORITY,1:"R")
"RTN","PSJHL4",128,0)
 I $E(SCHEDULE,1)=" " S PSREASON="Invalid Schedule" D ERROR^PSJHL9 Q
"RTN","PSJHL4",129,0)
 S PRNTON=$P(FIELD(8),"^")
"RTN","PSJHL4",130,0)
 S NURSEACK=$G(FIELD(11))
"RTN","PSJHL4",131,0)
 S LOGIN=$G(FIELD(15)) S:LOGIN'="" LOGIN=+$E(+$$HL7TFM^XLFDT(FIELD(15)),1,12) S LOGIN=$$DATE2^PSJUTL2(LOGIN)
"RTN","PSJHL4",132,0)
 S:$G(NURSEACK)]"" ACKDATE=LOGIN
"RTN","PSJHL4",133,0)
 S ORDCON=$P($G(FIELD(16)),U) I ORDCON="A" S PSJASTP=$G(FIELD(9)) S:$G(PSJASTP)'="" PSJASTP=+$E(+$$HL7TFM^XLFDT(PSJASTP),1,12) S PSJASTP=$$DATE2^PSJUTL2(PSJASTP)
"RTN","PSJHL4",134,0)
 I (PSOC="CA")!(PSOC="DC") D CANCEL^PSJHL6 Q
"RTN","PSJHL4",135,0)
 I PSOC="HD" D HOLD^PSJHL6 Q
"RTN","PSJHL4",136,0)
 I PSOC="RL" D UNHOLD^PSJHL6 Q
"RTN","PSJHL4",137,0)
 I PSOC="ZV" D NURSEACK^PSJHL5 Q
"RTN","PSJHL4",138,0)
 I PSOC="SS" D STATUS^PSJHL5 Q
"RTN","PSJHL4",139,0)
 I PSOC="Z@" N X S X="PSJHL8" X ^%ZOSF("TEST") I  D PURGE^PSJHL8 Q
"RTN","PSJHL4",140,0)
 I PSOC="DE" S QFLG=1 Q
"RTN","PSJHL4",141,0)
 Q
"RTN","PSJHL4",142,0)
OBR ; This segment is used to pass flagging information from CPRS.
"RTN","PSJHL4",143,0)
 S ORDER=FIELD(2)
"RTN","PSJHL4",144,0)
 S PSJORDER=$P(FIELD(2),"^"),RXON=$P(FIELD(3),"^"),RXORDER=$S((RXON["N")!(RXON["P"):"^PS(53.1,"_+RXON_",",RXON["V":"^PS(55,"_PSJHLDFN_",""IV"","_+RXON_",",1:"^PS(55,"_PSJHLDFN_",5,"_+RXON_",")
"RTN","PSJHL4",145,0)
 S PSJFLAG=FIELD(4)
"RTN","PSJHL4",146,0)
 S FLDATE=$G(FIELD(7)) S:FLDATE'="" FLDATE=+$E(+$$HL7TFM^XLFDT(FIELD(7)),1,12) S FLDATE=$$DATE2^PSJUTL2(FLDATE)
"RTN","PSJHL4",147,0)
 S CLERK=+$G(FIELD(16))
"RTN","PSJHL4",148,0)
 S PSJYN=$G(FIELD(24))
"RTN","PSJHL4",149,0)
 S FLCMNT=$G(FIELD(13))
"RTN","PSJHL4",150,0)
 I PSOC="ORU" D FLAG^PSJHL5
"RTN","PSJHL4",151,0)
 Q
"RTN","PSJHL4",152,0)
RXC ; IV order
"RTN","PSJHL4",153,0)
 D RXC^PSJHL4A
"RTN","PSJHL4",154,0)
 Q
"RTN","PSJHL4",155,0)
 ;
"RTN","PSJHL4",156,0)
RXO ;
"RTN","PSJHL4",157,0)
 D RXO^PSJHL4A
"RTN","PSJHL4",158,0)
 Q
"RTN","PSJHL4",159,0)
 ;
"RTN","PSJHL4",160,0)
RXR ;
"RTN","PSJHL4",161,0)
 S ROUTE=$P(FIELD(1),"^",4)
"RTN","PSJHL4",162,0)
 Q
"RTN","PSJHL4",163,0)
 ;
"RTN","PSJHL4",164,0)
OBX ;
"RTN","PSJHL4",165,0)
 D OBX^PSJHL4A
"RTN","PSJHL4",166,0)
 Q
"RTN","PSJHL4",167,0)
 ;
"RTN","PSJHL4",168,0)
NTE ;
"RTN","PSJHL4",169,0)
 D NTE^PSJHL4A
"RTN","PSJHL4",170,0)
 Q
"RTN","PSJHL4",171,0)
 ;
"RTN","PSJHL4",172,0)
ZRX ;
"RTN","PSJHL4",173,0)
 D ZRX^PSJHL4A
"RTN","PSJHL4",174,0)
 Q
"RTN","PSJHL4",175,0)
 ;
"RTN","PSJHL4",176,0)
ZSC ;Service Connected - Not Used by Inpatient
"RTN","PSJHL4",177,0)
 Q
"RTN","PSJHL4",178,0)
 ;
"RTN","PSJHL4",179,0)
ZRN ;Non-VA Med (Herbal/OTC)
"RTN","PSJHL4",180,0)
 S CLASS="O" D EN^PSOHLNEW(.PSJMSG)
"RTN","PSJHL4",181,0)
 Q
"RTN","PSJHL4",182,0)
DG1 ;Billing Awareness - Not used by Inpatient
"RTN","PSJHL4",183,0)
 Q
"RTN","PSJHL7")
0^81^B44358468
"RTN","PSJHL7",1,0)
PSJHL7 ;BIR/LDT-ACTIONS ON HL7 MESSAGES FROM OE/RR (CONT) ;29 AUG 96 / 11:18 AM
"RTN","PSJHL7",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**42,47,50,70,82,110**;16 DEC 97
"RTN","PSJHL7",3,0)
 ;
"RTN","PSJHL7",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL7",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJHL7",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL7",7,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJHL7",8,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJHL7",9,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL7",10,0)
 ; Reference to ^SC( is supported by DBIA# 10040.
"RTN","PSJHL7",11,0)
 ; Reference to ^TMP("PSB" is supported by DBIA# 3564.
"RTN","PSJHL7",12,0)
 ; 
"RTN","PSJHL7",13,0)
RENEW ;Renew orders from OE/RR
"RTN","PSJHL7",14,0)
 N PSJSYSW0,PSJSYSW,WRDPTR,PSJOSTOP
"RTN","PSJHL7",15,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(LOC) S WRDPTR=$G(^SC(+LOC,42)) S:WRDPTR]"" PSJSYSW=+$O(^PS(59.6,"B",WRDPTR,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJHL7",16,0)
 I PREON["V" D IVSET G DONE
"RTN","PSJHL7",17,0)
 N ND,ND1,ND2,PSGSI,PSGMR,PSGSM,PSGHSM,PSGST,OIDRG,PSGDO,PSGSCH,PSGSOY,PSGOXT,PSGNEDFD,DRUGS
"RTN","PSJHL7",18,0)
 S ND=$G(^PS(55,PSJHLDFN,5,+PREON,0)),ND1=$G(^(.2)),ND2=$G(^(2)),PSGSI=$G(^(6)),PSGWLL=$S($P(PSJSYSW0,"^",4):+$G(^PS(55,PSJHLDFN,5.1)),1:0)
"RTN","PSJHL7",19,0)
 I +PSITEM>0,PSITEM'=+$P(ND1,"^") S $P(ND1,"^")=PSITEM
"RTN","PSJHL7",20,0)
 S PSGMR=$P(ND,"^",3),PSGSM=$P(ND,"^",5),PSGHSM=$P(ND,"^",6),PSGST=$P(ND,"^",7),OIDRG=$P(ND1,"^"),PSGDO=$P(ND1,"^",2),DOSE=$P(ND1,"^",5),UNIT=$P(ND1,"^",6),PSGSCH=$P(ND2,"^")
"RTN","PSJHL7",21,0)
 S PSGSOY=$P(ND2,"^",5),PSGOXT=$P(ND2,"^",6),PSGNEDFD=$P($$GTNEDFD^PSGOE7("UI",OIDRG),"^")
"RTN","PSJHL7",22,0)
 S:$P(LOC,"^")'=$P(ND2,"^",10) PSGSOY=$$ENRNAT^PSJHL7($P(ND2,"^",10),+LOC,PSGSCH,PSGSOY)
"RTN","PSJHL7",23,0)
 S X=$O(^PS(55,PSJHLDFN,5,+PREON,1,0)) I X S (Q,Q1)=0 F  S Q=$O(^PS(55,PSJHLDFN,5,+PREON,1,Q)) Q:'Q  S ND=$G(^(Q,0)) I ND,$S('$P(ND,"^",3):1,1:$P(ND,"^",3)>DT) S Q1=Q1+1,DRUGS(Q1)=$P(ND,"^",1,3)
"RTN","PSJHL7",24,0)
 S (PSGNESD,PSGNEFD)="" D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSJHLDFN)
"RTN","PSJHL7",25,0)
 I PSGOXT="D",'PSGSOY S PSGSOY=+$E(PSGNESD_"00011",9,12)
"RTN","PSJHL7",26,0)
 S ND=NEWORDER_U_PROVIDER_U_PSGMR_U_"U"_U_PSGSM_U_PSGHSM_U_PSGST_"^^P^^^^^"_LOGIN_U_PSJHLDFN_U_LOGIN S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSJHL7",27,0)
 S $P(ND,U,21)=$P(ORDER,U),$P(ND,U,24,25)=ROC_U_PREON
"RTN","PSJHL7",28,0)
 F X="PSGNESD","PSGNEFD" S:@X]"" @X=+@X
"RTN","PSJHL7",29,0)
 S ND2=PSGSCH_U_PSGNESD_"^^"_PSGNEFD_U_PSGSOY_U_PSGOXT
"RTN","PSJHL7",30,0)
 S F="^PS(53.1,"_NEWORDER_",",@(F_"0)")=ND,^(.2)=OIDRG_U_PSGDO_U_ORDCON_U_PRIORITY_U_DOSE_U_UNIT_U_U_$G(PRNTON),^(2)=ND2 S:$G(PSGSI)]"" ^(6)=PSGSI
"RTN","PSJHL7",31,0)
 I $D(DRUGS) D
"RTN","PSJHL7",32,0)
 .I $D(@(F_"1,0)")) K @(F_"1)")
"RTN","PSJHL7",33,0)
 .; Naked reference below refers to full reference to ^PS(53.1,+NEWORDER in variable F created using indirection.
"RTN","PSJHL7",34,0)
 .I '$D(@(F_"1,0)")) S ^(0)="^53.11P^0^0"
"RTN","PSJHL7",35,0)
 .S JJ=0 F  S JJ=$O(DRUGS(JJ)) Q:'JJ  I $S('$P(DRUGS(JJ),U,3):1,1:$P(DRUGS(JJ),U,3)>DT) S $P(@(F_"1,0)"),"^",3,4)=JJ_"^"_JJ,@(F_"1,"_JJ_",0)")=$P(DRUGS(JJ),U,1,2),@(F_"1,""B"","_+DRUGS(JJ)_","_JJ_")")=""
"RTN","PSJHL7",36,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",5,"_+$G(PREON)_",2)")),PSJOSTOP=$P(PSJOSTOP,"^",4) D REN531(NEWORDER,$P(ND,"^",14),$P(ND,"^",2),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",37,0)
 ;
"RTN","PSJHL7",38,0)
DONE ;
"RTN","PSJHL7",39,0)
 N DA,DR,DIE,PSIVACT,PSIVALT,ON55,PSIVREA
"RTN","PSJHL7",40,0)
 S DIE=$S(PREON["V":"^PS(55,"_PSJHLDFN_",""IV"",",1:"^PS(55,"_PSJHLDFN_",5,"),DA=+PREON,DA(1)=PSJHLDFN,DR=$S(PREON["V":"100////R;123////R;114////"_PSJORDER,1:"28////R;107////R;105////"_PSJORDER)
"RTN","PSJHL7",41,0)
 I PREON["A"!(PREON["U") S PSGAL("C")=18000 D ^PSGAL5
"RTN","PSJHL7",42,0)
 I PREON["V" S PSIVACT=1,PSIVALT=2,ON55=PREON,PSIVREA="R"
"RTN","PSJHL7",43,0)
 D ^DIE
"RTN","PSJHL7",44,0)
 I PREON["V" N DFN S DFN=PSJHLDFN D LOG^PSIVORAL
"RTN","PSJHL7",45,0)
 S PSJHLMTN="ORM" D EN1^PSJHL2(PSJHLDFN,"SC",PREON) S PSJHLMTN="ORR",PSOC="NW"
"RTN","PSJHL7",46,0)
 Q
"RTN","PSJHL7",47,0)
IVSET ;
"RTN","PSJHL7",48,0)
 N DRG,DRGN,P
"RTN","PSJHL7",49,0)
 S P("RES")="R",P("REN")="",Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSJHL7",50,0)
 S P("PON")=PREON,P(21)=$P(ORDER,U),P(6)=PROVIDER_U_$P($G(^VA(200,+PROVIDER,0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,PSJHLDFN,"IV",+PREON,1))
"RTN","PSJHL7",51,0)
 S Y=$G(^PS(55,PSJHLDFN,"IV",+PREON,2)),P("LOG")=LOGIN
"RTN","PSJHL7",52,0)
 S P("CLRK")=CLERK_U_$P($G(^VA(200,+CLERK,0)),U),P("RES")=ROC,P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,PSJHLDFN,"IV",+PREON,3))
"RTN","PSJHL7",53,0)
 S ND=$G(^PS(55,PSJHLDFN,"IV",+PREON,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2)
"RTN","PSJHL7",54,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U))
"RTN","PSJHL7",55,0)
 D GTDRG
"RTN","PSJHL7",56,0)
 S P("OT")=$S(P(4)="A":"F",P(4)="H":"I",1:"I")
"RTN","PSJHL7",57,0)
 I P("OT")="F" F DRGT="AD","SOL" F DRGI=0:0 S DRGI=$O(DRG(DRGT,DRGI)) Q:'DRGI  I '$P(DRG(DRGT,DRGI),U,5) S P("OT")="I"
"RTN","PSJHL7",58,0)
PUT531 ; Move data in local variables to 53.1
"RTN","PSJHL7",59,0)
 S ND(0)=+NEWORDER_U_+P(6)_U_$S(+P("MR"):+P("MR"),1:"")_U_P("OT")_U_U_U_"C",$P(ND(0),U,9)="P"
"RTN","PSJHL7",60,0)
 S $P(ND(0),U,14,16)=P("LOG")_U_PSJHLDFN_U_P("LOG"),$P(ND(0),U,21)=P(21),$P(ND(0),U,24,26)=$G(P("RES"))_U_P("PON")
"RTN","PSJHL7",61,0)
 S ND(2)=P(9)_U_U_U_U_P(11)_U_P(15),$P(ND(4),U,7,9)=+P("CLRK")_U_U_P("REN")
"RTN","PSJHL7",62,0)
 S ND(8)=P(4)_U_P(23)_U_P("SYRS")_U_P(5)_U_P(8)_"^^"_P(7),ND(9)=$S($L(P("REM")_P("OPI")):P("REM")_U_P("OPI"),1:"")
"RTN","PSJHL7",63,0)
 F X=0,2,4,8,9 S ^PS(53.1,+NEWORDER,X)=ND(X)
"RTN","PSJHL7",64,0)
 S:+P("PD") ^PS(53.1,+NEWORDER,.2)=+P("PD")_U_P("DO")
"RTN","PSJHL7",65,0)
 S $P(^PS(53.1,+NEWORDER,.2),"^",3,4)=ORDCON_U_PRIORITY I $G(PRNTON) S $P(^PS(53.1,+NEWORDER,.2),"^",8)=PRNTON
"RTN","PSJHL7",66,0)
 F DRGT="AD","SOL" D:$D(DRG(DRGT)) PTD531
"RTN","PSJHL7",67,0)
 S PSJOSTOP=$G(@("^PS(55,"_PSJHLDFN_",""IV"","_+PREON_",0)")),PSJOSTOP=$P(PSJOSTOP,"^",3) D
"RTN","PSJHL7",68,0)
 .N IVND S IVND=$G(^PS(53.1,+NEWORDER,0)) D REN531(NEWORDER,$P(IVND,"^",14),$P(ND,"^",2),PSJOSTOP,PSJHLDFN)
"RTN","PSJHL7",69,0)
 Q
"RTN","PSJHL7",70,0)
PTD531 ; Move drug data from local array into 53.1
"RTN","PSJHL7",71,0)
 K ^PS(53.1,+NEWORDER,DRGT) S ^PS(53.1,+NEWORDER,DRGT,0)=$S(DRGT="AD":"^53.157PA^0^0",1:"^53.158PA^0^0")
"RTN","PSJHL7",72,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSJHL7",73,0)
 .S X1=$P(DRG(DRGT,X),U),Y=^PS(53.1,+NEWORDER,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSJHL7",74,0)
 .S ^PS(53.1,+NEWORDER,DRGT,0)=Y,Y=+X1_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(53.1,+NEWORDER,DRGT,+DRG,0)=Y,^PS(53.1,+NEWORDER,DRGT,"B",+X1,+DRG)=""
"RTN","PSJHL7",75,0)
 I $G(P("RES"))="R",($G(ND(0))]"") D REN531(+NEWORDER,$P(ND(0),"^",14),$P(ND(0),"^",2),$G(P(3)),$G(DFN))
"RTN","PSJHL7",76,0)
 Q
"RTN","PSJHL7",77,0)
 ;
"RTN","PSJHL7",78,0)
ENRNAT(OWD,NWD,SC,OAT) ;Determine admin times for renewal orders.
"RTN","PSJHL7",79,0)
 ;OWD=ORIGINAL W,NWD=NEW WD LOCATION, SC=SCHEDULE, OAT=ORDER ADMIN TIMES
"RTN","PSJHL7",80,0)
 N OWAT,SCP,X,Y
"RTN","PSJHL7",81,0)
 S OOAT=OAT,SCP=+$O(^PS(51.1,"APPSJ",+SC,0)),WAT=$P($G(^PS(51.1,SCP,1,+$G(OWD),0)),U,2)
"RTN","PSJHL7",82,0)
 F X="WAT","OAT" F Y=1:1 Q:$L(@X)>240!($P(@X,"-",Y)="")  S $P(@X,"-",Y)=$P(@X,"-",Y)_$E("0000",1,4-$L($P(@X,"-",Y)))
"RTN","PSJHL7",83,0)
 I OAT'=WAT Q OOAT
"RTN","PSJHL7",84,0)
 S X=$P($G(^PS(51.1,+SCP,1,NWD,0)),U,2) I X Q X
"RTN","PSJHL7",85,0)
 Q OOAT
"RTN","PSJHL7",86,0)
 ;
"RTN","PSJHL7",87,0)
GTDRG ; Get drug info and place in DRG(.
"RTN","PSJHL7",88,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,PSJHLDFN,"IV",+PREON,DRGT,Y)) Q:'Y  D
"RTN","PSJHL7",89,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1,DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSJHL7",90,0)
 Q
"RTN","PSJHL7",91,0)
 ;
"RTN","PSJHL7",92,0)
REN531(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSGP) ;
"RTN","PSJHL7",93,0)
 Q:'PSGORD!'PSGDT!'PSGOEPR!'PSGOFD!'PSGP
"RTN","PSJHL7",94,0)
 K DR,DA,DIC,DIE,DD,DO S DIC="^PS(53.1,"_+PSGORD_",14,",DIC(0)="L",DIC("P")="53.1114DA",ND14=$G(@(DIC_"0)")),DINUM=$P(ND14,"^",3)+1,DA(2)=PSGP,DA(1)=+PSGORD D
"RTN","PSJHL7",95,0)
 . S DIC("DR")=".01////"_$G(PSGDT)_";1////"_$G(DUZ)_";2////"_$G(PSGOEPR)_";3////"_$G(PSGOFD),X=$G(PSGDT) D FILE^DICN
"RTN","PSJHL7",96,0)
 Q
"RTN","PSJHL7",97,0)
 ;
"RTN","PSJHL7",98,0)
CHK(X,Y,Z) ;Check for required fields
"RTN","PSJHL7",99,0)
 ; Input: X="^^"_MED ROUTE_"^^^^"_SCH TYPE
"RTN","PSJHL7",100,0)
 ;        Y=ORDERABLE ITEM_"^"_DOSAGE ORDERED
"RTN","PSJHL7",101,0)
 ;        Z=SCHEDULE_"^"_START DATE/TIME_"^^"_STOP DATE/TIME
"RTN","PSJHL7",102,0)
 S:'$D(^PS(50.7,+Y,0)) CHK=1
"RTN","PSJHL7",103,0)
 I ND="" S CHK=CHK_23
"RTN","PSJHL7",104,0)
 E  S CHK=CHK_$S($P(X,"^",3):"",1:2)_$S($P(X,"^",7)]"":"",1:3)
"RTN","PSJHL7",105,0)
 K PSGDFLG,PSGPFLG S PSGDI=0
"RTN","PSJHL7",106,0)
 S:'$$DDOK^PSJHL10("^TMP(""PSB"","_$J_",700,",+Y) CHK=CHK_7
"RTN","PSJHL7",107,0)
 ;
"RTN","PSJHL7",108,0)
CHKM ;
"RTN","PSJHL7",109,0)
 Q:'CHK
"RTN","PSJHL7",110,0)
 S MSG="THE FOLLOWING "_$S($L(CHK)>1:"ARE",1:"IS")_" EITHER INVALID OR MISSING FROM THIS ORDER:" F X=1:1:7 S:CHK[X MSG2=$P("ORDERABLE ITEM^MED ROUTE^SCHEDULE TYPE^SCHEDULE^START DATE/TIME^STOP DATE/TIME^DISPENSE DRUG","^",X)
"RTN","PSJHL7",111,0)
 S PSREASON=MSG_MSG2
"RTN","PSJHL7",112,0)
 Q
"RTN","PSJHL9")
0^28^B54587559
"RTN","PSJHL9",1,0)
PSJHL9 ;BIR/LDT-VALIDATE INCOMING HL7 DATA/CREATE NEW ORDER ;08 Jul 99 / 10:50 AM
"RTN","PSJHL9",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,18,31,42,47,50,63,72,75,58,80,110**;16 DEC 97
"RTN","PSJHL9",3,0)
 ;
"RTN","PSJHL9",4,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJHL9",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJHL9",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJHL9",7,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJHL9",8,0)
 ; Reference to ^%ZOSF is supported by DBIA# 10096.
"RTN","PSJHL9",9,0)
 ; Reference to ^SC is supported by DBIA# 10040.
"RTN","PSJHL9",10,0)
 ; Reference to ^VA(200 is supported by DBIA# 10060.
"RTN","PSJHL9",11,0)
 ; Reference to ^%DT is supported by DBIA# 10003.
"RTN","PSJHL9",12,0)
 ; Reference to ^DIE is supported by DBIA# 10018.
"RTN","PSJHL9",13,0)
 ; Reference to ^ORERR is supported by DBIA# 2187.
"RTN","PSJHL9",14,0)
 ; Reference to ^VADPT is supported by DBIA# 10061.
"RTN","PSJHL9",15,0)
 ; Reference to ^XLFDT is supported by DBIA# 10103.
"RTN","PSJHL9",16,0)
 ; Reference to ^XLFSTR is supported by DBIA# 10104.
"RTN","PSJHL9",17,0)
 ;
"RTN","PSJHL9",18,0)
VALID ;
"RTN","PSJHL9",19,0)
 I APPL="",PSITEM="" S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",20,0)
 I PSITEM]"",'$D(^PS(50.7,+PSITEM,0)) S PSREASON="Missing or invalid Orderable Item" D ERROR Q
"RTN","PSJHL9",21,0)
 I $G(APPL)'["B",$G(APPL)'["A",+$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",22,0)
 S APPL=$S($G(APPL)["B":"F",$G(APPL)["A":"F",$G(DISPENSE)]"":$$ORTYP(ROUTE,DISPENSE),1:$$TRYAGAIN(ROUTE,PSITEM))
"RTN","PSJHL9",23,0)
 S:APPL="" APPL="IP"
"RTN","PSJHL9",24,0)
 I APPL'="F" D
"RTN","PSJHL9",25,0)
 .I $G(SCHEDULE)]"" N X S X=SCHEDULE D  S SCHEDULE=X
"RTN","PSJHL9",26,0)
 ..I X[""""!($A(X)=45)!(X?.E1C.E)!($L(X," ")>3)!($L(X)>70)!($L(X)<1)!(X["P RN")!(X["PR N") S X="" Q
"RTN","PSJHL9",27,0)
 ..I X?.E1L.E S X=$$ENLU^PSGMI(X)
"RTN","PSJHL9",28,0)
 ..S X=$$TRIM^XLFSTR(X,"R"," ")
"RTN","PSJHL9",29,0)
 ..I X["Q0" S X="" Q
"RTN","PSJHL9",30,0)
 .I APPL["U",$G(SCHEDULE)="" S PSREASON="Missing or invalid schedule" D ERROR Q
"RTN","PSJHL9",31,0)
 .N DFN S DFN=PSJHLDFN D IN5^VADPT I 'VAIP(5) D:APPT=""  I APPL="UN",APPT="" S PSREASON="Cannot place Unit Dose orders for an Outpatient" D ERROR Q
"RTN","PSJHL9",32,0)
 .. I APPL="UP" S APPL="IN" Q
"RTN","PSJHL9",33,0)
 .. I APPL="IP" S APPL="IN" Q
"RTN","PSJHL9",34,0)
 .I $G(ROC)'="R",$G(ROUTE)'>0 S PSREASON="Missing or invalid Med Route" D ERROR Q
"RTN","PSJHL9",35,0)
 I APPL="F" D
"RTN","PSJHL9",36,0)
 .I '$O(^TMP("PSJNVO",$J,"SOL",0))&('$O(^TMP("PSJNVO",$J,"AD",0))) S PSREASON="IV Fluid orders must have at least one additive or solution" D ERROR Q
"RTN","PSJHL9",37,0)
 .I $G(INFRT)="" S PSREASON="Invalid Infusion Rate" D ERROR Q
"RTN","PSJHL9",38,0)
 Q
"RTN","PSJHL9",39,0)
 ;
"RTN","PSJHL9",40,0)
ERROR ;Sends error msg to CPRS, logs error in OE/RR Errors file
"RTN","PSJHL9",41,0)
 S X="ORERR" X ^%ZOSF("TEST") I  D EN^ORERR(PSREASON,.PSJMSG)
"RTN","PSJHL9",42,0)
 D EN1^PSJHLERR(PSJHLDFN,$S(PSOC="XO":"UX",1:"OC"),$P(ORDER,U),PSREASON) S QFLG=1 K ^TMP("PSJNVO",$J)
"RTN","PSJHL9",43,0)
 Q
"RTN","PSJHL9",44,0)
 ;
"RTN","PSJHL9",45,0)
NVO ; put new orders in non-verified orders file
"RTN","PSJHL9",46,0)
 I '$D(ROUTE) S ROUTE=""
"RTN","PSJHL9",47,0)
 S:APPL="F" ROUTE=$O(^PS(51.2,"B","INTRAVENOUS",0))
"RTN","PSJHL9",48,0)
 N DA,DR,DIE D ENGNN^PSGOETO S DIE="^PS(53.1,"
"RTN","PSJHL9",49,0)
 S DR="1////"_PROVIDER_";3////"_ROUTE_";4////"_$E(APPL)_";28////P"_";108////"_PSITEM_";27.1////"_LOGIN_";27////"_LOGIN_";.5////"_PSJHLDFN_";.24////"_PRIORITY_";125////"_$G(PRNTON)
"RTN","PSJHL9",50,0)
 I $G(LOC)]"" S:$P($G(^SC(LOC,0)),U,3)="C" DR=DR_";113////"_LOC_";126////"_$G(APPT)
"RTN","PSJHL9",51,0)
 D ^DIE K PSJHLSKP S NEWORDER=DA,PSJORDER=DA_"P"
"RTN","PSJHL9",52,0)
 S $P(^PS(55,PSJHLDFN,5.1),"^",2)=PROVIDER
"RTN","PSJHL9",53,0)
 S:$G(ORDER)]"" $P(^PS(53.1,DA,0),"^",21)=$P(ORDER,"^")
"RTN","PSJHL9",54,0)
 S:$G(APPL)["P" $P(^PS(53.1,DA,0),"^",13)=1
"RTN","PSJHL9",55,0)
 S $P(^PS(53.1,DA,0),"^",18)=DA
"RTN","PSJHL9",56,0)
 S:$G(ROC)]"" $P(^PS(53.1,DA,0),"^",24)=ROC
"RTN","PSJHL9",57,0)
 S:$G(PREON)]"" $P(^PS(53.1,DA,0),"^",25)=PREON
"RTN","PSJHL9",58,0)
 S:$G(REQST)]"" $P(^PS(53.1,DA,2.5),"^")=REQST
"RTN","PSJHL9",59,0)
 S:$G(DURATION)]"" $P(^PS(53.1,DA,2.5),"^",2)=DURATION
"RTN","PSJHL9",60,0)
 I $G(REQST)]"",$G(DURATION)]"" S $P(^PS(53.1,DA,2.5),"^",3)=$$STOP(REQST,DURATION)
"RTN","PSJHL9",61,0)
 S:$G(INSTR)]"" $P(^PS(53.1,DA,.3),"^")=INSTR
"RTN","PSJHL9",62,0)
 S:$G(INFRT)]"" ^PS(53.1,DA,8)=IVTYP_"^^^^"_INFRT
"RTN","PSJHL9",63,0)
 S:$G(FREQ)]"" $P(^PS(53.1,DA,2),"^",6)=FREQ
"RTN","PSJHL9",64,0)
 S:$G(SCHTYP)]"" $P(^PS(53.1,DA,0),"^",7)=SCHTYP
"RTN","PSJHL9",65,0)
 I $G(APPL)'="I" I $G(INSTR)]"" N X S X=INSTR D STRIP I $S(X?.E1C.E:0,$L(X)>60:0,X="":0,X["^":0,X?1.P:1,1:1) S $P(^PS(53.1,DA,.2),"^",2)=X,$P(^PS(53.1,DA,.2),"^",5,6)=$G(DOSE)_"^"_$G(UNIT)
"RTN","PSJHL9",66,0)
 S $P(^PS(53.1,DA,.2),"^",3)=ORDCON
"RTN","PSJHL9",67,0)
 I $G(SCHEDULE)]"" S ^PS(53.1,DA,2)=SCHEDULE
"RTN","PSJHL9",68,0)
 I $G(APPL)="I" I $G(UNITS)]"" S $P(^PS(53.1,DA,.3),"^")=UNITS
"RTN","PSJHL9",69,0)
 S ^PS(53.1,DA,4)="^^^^^^"_CLERK
"RTN","PSJHL9",70,0)
 I $G(DISPENSE) S ^PS(53.1,DA,1,0)="^53.11P^1^1",^PS(53.1,DA,1,1,0)=DISPENSE_"^"_UNITS,^PS(53.1,DA,1,"B",$E(DISPENSE,1,30),1)=""
"RTN","PSJHL9",71,0)
 I $D(PROCOM) D
"RTN","PSJHL9",72,0)
 .I '$D(^PS(53.1,DA,12,0)) S ^(0)="^53.1012^0^0"
"RTN","PSJHL9",73,0)
 .S JJ=0 F  S JJ=$O(PROCOM(JJ)) Q:'JJ  S $P(^PS(53.1,DA,12,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,12,JJ,0)=PROCOM(JJ)
"RTN","PSJHL9",74,0)
 I $D(ADMINSTR) D
"RTN","PSJHL9",75,0)
 .I '$D(^PS(53.1,DA,3,0)) S ^(0)="^53.12^0^0"
"RTN","PSJHL9",76,0)
 .S JJ=0 F  S JJ=$O(ADMINSTR(JJ)) Q:'JJ  S $P(^PS(53.1,DA,3,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,3,JJ,0)=ADMINSTR(JJ)
"RTN","PSJHL9",77,0)
 I $D(^TMP("PSJNVO",$J,"AD")) D
"RTN","PSJHL9",78,0)
 .S ^PS(53.1,DA,"AD",0)="^53.157PA^0^0"
"RTN","PSJHL9",79,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"AD",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"AD",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"AD",JJ,0)=^TMP("PSJNVO",$J,"AD",JJ,0),^PS(53.1,DA,"AD","B",$P(^TMP("PSJNVO",$J,"AD",JJ,0),"^"),JJ)=""
"RTN","PSJHL9",80,0)
 I $D(^TMP("PSJNVO",$J,"SOL")) D
"RTN","PSJHL9",81,0)
 .S ^PS(53.1,DA,"SOL",0)="^53.158PA^0^0"
"RTN","PSJHL9",82,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,"SOL",JJ)) Q:'JJ  S $P(^PS(53.1,DA,"SOL",0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,"SOL",JJ,0)=^TMP("PSJNVO",$J,"SOL",JJ,0),^PS(53.1,DA,"SOL","B",$P(^TMP("PSJNVO",$J,"SOL",JJ,0),"^"),JJ)=""
"RTN","PSJHL9",83,0)
 I $O(^TMP("PSJNVO",$J,10,0)) D
"RTN","PSJHL9",84,0)
 .S ^PS(53.1,DA,10,0)="^53.1112A^0^0"
"RTN","PSJHL9",85,0)
 .S JJ=0 F  S JJ=$O(^TMP("PSJNVO",$J,10,JJ)) Q:'JJ  S $P(^PS(53.1,DA,10,0),"^",3,4)=JJ_"^"_JJ,^PS(53.1,DA,10,JJ,0)=^TMP("PSJNVO",$J,10,JJ,0),^PS(53.1,DA,10,"B",$E(^TMP("PSJNVO",$J,10,JJ,0),1,30),JJ)="" D
"RTN","PSJHL9",86,0)
 ..S ^PS(53.1,DA,10,JJ,1)=$P($G(^VA(200,+CLERK,0)),"^")
"RTN","PSJHL9",87,0)
 ..I $O(^TMP("PSJNVO",$J,10,JJ,2,0)) S ^PS(53.1,DA,10,JJ,2,0)="^53.11122^0^0" D
"RTN","PSJHL9",88,0)
 ...S QQ=0 F  S QQ=$O(^TMP("PSJNVO",$J,10,JJ,2,QQ)) Q:'QQ  S $P(^PS(53.1,DA,10,JJ,2,0),"^",3,4)=QQ_"^"_QQ,^PS(53.1,DA,10,JJ,2,QQ,0)=^TMP("PSJNVO",$J,10,JJ,2,QQ,0)
"RTN","PSJHL9",89,0)
 Q
"RTN","PSJHL9",90,0)
STRIP ;Strips spaces off the end of instructions.
"RTN","PSJHL9",91,0)
 I $E(X,$L(X))=" " F  S X=$E(X,1,$L(X)-1) Q:$E(X,$L(X))'=" "
"RTN","PSJHL9",92,0)
 Q
"RTN","PSJHL9",93,0)
 ;
"RTN","PSJHL9",94,0)
ORTYP(MDRT,DDRG)        ;Entry point to determine order type for 53.1
"RTN","PSJHL9",95,0)
 ;MDRT=Med Route from 51.2, DDRG=Dispense Drug
"RTN","PSJHL9",96,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PSDRUG(DDRG,2),"^",3)'["U" S ORTYP="" Q ORTYP
"RTN","PSJHL9",97,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IN" Q ORTYP
"RTN","PSJHL9",98,0)
 I $P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",99,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PS(51.2,MDRT,0),"^",6)=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",100,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["I",$P(^PSDRUG(DDRG,2),"^",3)'["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="IP" Q ORTYP
"RTN","PSJHL9",101,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PSDRUG(DDRG,2),"^",3)'["I",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UN" Q ORTYP
"RTN","PSJHL9",102,0)
 I $P(^PSDRUG(DDRG,2),"^",3)["U",$P(^PS(51.2,MDRT,0),"^",6)'=1 S ORTYP="UP" Q ORTYP
"RTN","PSJHL9",103,0)
 S ORTYP="" Q ORTYP
"RTN","PSJHL9",104,0)
 ;
"RTN","PSJHL9",105,0)
TRYAGAIN(MDRT,OI)       ;
"RTN","PSJHL9",106,0)
 ;MDRT=Med Route from 51.2, OI=Orderable Item
"RTN","PSJHL9",107,0)
 N ORTYPI,ORTYPU,ORTYPP
"RTN","PSJHL9",108,0)
 S ORTYP="",ORTYPI=0,ORTYPU=0,ORTYPP=0
"RTN","PSJHL9",109,0)
 N DDRG S DDRG=0 F  S DDRG=$O(^PSDRUG("ASP",OI,DDRG)) Q:'DDRG  D 
"RTN","PSJHL9",110,0)
 .I $G(^PSDRUG(DDRG,"I"))]"" Q:^PSDRUG(DDRG,"I")'>DT
"RTN","PSJHL9",111,0)
 .S ORTYP=$$ORTYP(MDRT,DDRG)  D
"RTN","PSJHL9",112,0)
 ..I ORTYP["I" S ORTYPI=ORTYPI+1
"RTN","PSJHL9",113,0)
 ..I ORTYP["U" S ORTYPU=ORTYPU+1
"RTN","PSJHL9",114,0)
 ..I ORTYP["P" S ORTYPP=ORTYPP+1
"RTN","PSJHL9",115,0)
 S ORTYP=$S(ORTYPU>ORTYPI:"U",1:"I") S ORTYP=ORTYP_$S(ORTYPP>0:"P",1:"N")
"RTN","PSJHL9",116,0)
 Q ORTYP
"RTN","PSJHL9",117,0)
 ;
"RTN","PSJHL9",118,0)
STOP(REQST,DURA)   ;
"RTN","PSJHL9",119,0)
 ;REQST=Requested start date, DURA=Duration from CPRS
"RTN","PSJHL9",120,0)
 I DURA["L",DURA?1A1".".N S DAYS=$$DAY($E(REQST,1,5)),DURA="H"_((DAYS*$P(DURA,"L",2))*24)
"RTN","PSJHL9",121,0)
 I DURA["L",DURA?1A.1N.N1"."1N.N D  Q STOP
"RTN","PSJHL9",122,0)
 .S NUM=$E(REQST,4,5)+$P($P(DURA,"."),"L",2),NUM=$S(NUM<10:"0"_NUM,NUM<13:NUM,1:$S((NUM-12)<10:"0"_(NUM-12),1:(NUM-12))),DATE=$E(REQST,1,3)_NUM
"RTN","PSJHL9",123,0)
 .S DAYS=$$DAY(DATE),STOP=$$SCH^XLFDT($P($P(DURA,"."),"L",2)_"M",$P(REQST,"."))_"."_$P(REQST,".",2),DEL=$P($P(DURA,"L",2),"."),STOP=$$FMADD^XLFDT(STOP,"",((DAYS*$P(DURA,DEL,2))*24))
"RTN","PSJHL9",124,0)
 I DURA["L" S STOP=$P($$SCH^XLFDT($P(DURA,"L",2)_"M",$P(REQST,".")),".")_"."_$P(REQST,".",2) Q STOP
"RTN","PSJHL9",125,0)
 I DURA["W",DURA["." S DURA="H"_(($P(DURA,"W",2)*7)*24)
"RTN","PSJHL9",126,0)
 I DURA["D",DURA["." S DURA="H"_($P(DURA,"D",2)*24)
"RTN","PSJHL9",127,0)
 I +DURA=DURA,DURA["." S DURA="H"_(DURA*24)
"RTN","PSJHL9",128,0)
 S STOP=$$FMADD^XLFDT(REQST,$S(DURA["W":$P(DURA,"W",2)*7,DURA["D":$P(DURA,"D",2),+DURA=DURA:+DURA,1:""),$S(DURA["H":$P(DURA,"H",2),1:""),$S(DURA["M":$P(DURA,"M",2),1:""),$S(DURA["S":$P(DURA,"S",2),1:""))
"RTN","PSJHL9",129,0)
 Q STOP
"RTN","PSJHL9",130,0)
ZQDATE(DATE,MONTHS)  ;BUMP DATE BY A MONTH (OR SO)
"RTN","PSJHL9",131,0)
 ;;
"RTN","PSJHL9",132,0)
 S X=$E($P(DATE,"."),1,5)+($E($P(DATE,"."),4,5)>(12-MONTHS)*88+MONTHS)_$E($P(DATE,"."),6,7) F  D ^%DT Q:Y>0  S X=X-1
"RTN","PSJHL9",133,0)
 S NEWDATE=X_"."_$P(DATE,".",2)
"RTN","PSJHL9",134,0)
 Q NEWDATE
"RTN","PSJHL9",135,0)
DAY(DATE) ;DATE=FIRST FIVE DIGITS OF FM DATE
"RTN","PSJHL9",136,0)
 N X
"RTN","PSJHL9",137,0)
 I DATE'?5N Q -1
"RTN","PSJHL9",138,0)
 S X=$E(DATE,4,5) I X<1!(X>12) Q -1
"RTN","PSJHL9",139,0)
 S X=DATE+1+(X=12*88)_"01"
"RTN","PSJHL9",140,0)
 Q $E($$FMADD^XLFDT(X,-1),6,7)
"RTN","PSJLIACT")
0^29^B40633561
"RTN","PSJLIACT",1,0)
PSJLIACT ;BIR/MV-IV ACTION ;28 Jul 98 / 8:50 AM
"RTN","PSJLIACT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**15,47,62,58,82,97,80,110**;16 DEC 97
"RTN","PSJLIACT",3,0)
 ;
"RTN","PSJLIACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLIACT",5,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJLIACT",6,0)
 ; Reference to MAIN^TIUEDIT is supported by DBIA 2410.
"RTN","PSJLIACT",7,0)
 ;
"RTN","PSJLIACT",8,0)
DC ; Discontinue order
"RTN","PSJLIACT",9,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",10,0)
 S PSJCOM=+$S(PSJORD["V":$P($G(^PS(55,DFN,"IV",+PSJORD,.2)),"^",8),1:$P($G(^PS(53.1,+PSJORD,.2)),"^",8))
"RTN","PSJLIACT",11,0)
 I PSJCOM W !!,"This order is part of a complex order. If you discontinue this order the",!,"following orders will be discontinued too (unless the stop date has already",!,"been reached)." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSJORD)
"RTN","PSJLIACT",12,0)
 I PSJCOM F  W !!,"Do you want to discontinue this order" S %=1 D YN^DICN Q:%  D ENCOM^PSGOEM
"RTN","PSJLIACT",13,0)
 I PSJCOM,%'=1 S VALMBK="" Q
"RTN","PSJLIACT",14,0)
 I PSJORD["V" D DC^PSIVORA,EN^PSJLIORD(DFN,ON) Q
"RTN","PSJLIACT",15,0)
 D:PSJORD["P" DISCONT^PSIVORC
"RTN","PSJLIACT",16,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",17,0)
 Q
"RTN","PSJLIACT",18,0)
ACEDIT ; Display LM screen and AC and EDit actions
"RTN","PSJLIACT",19,0)
 ;K PSIVFN1 ; if not set display the second screen when finish.
"RTN","PSJLIACT",20,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",21,0)
 S VALMBCK=$S($G(PSIVACEP):"Q",1:"R")
"RTN","PSJLIACT",22,0)
 Q
"RTN","PSJLIACT",23,0)
AEEXIT ; Call for EXIT CODE in PSJ LM IV AC/EDIT
"RTN","PSJLIACT",24,0)
 D:ON["V" GT55^PSIVORFB
"RTN","PSJLIACT",25,0)
 I ON["P" D GT531^PSIVORFA(DFN,ON) D:P("OT")'="I" GTDATA^PSJLIFN
"RTN","PSJLIACT",26,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",27,0)
 K PSIVENO
"RTN","PSJLIACT",28,0)
 Q
"RTN","PSJLIACT",29,0)
EDIT ; Edit order
"RTN","PSJLIACT",30,0)
 K PSIVFN1 NEW PSIVNBD
"RTN","PSJLIACT",31,0)
 I $D(PSGACT),PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJLIACT",32,0)
 D EDIT1
"RTN","PSJLIACT",33,0)
 ;Q:$D(PSIVNBD)
"RTN","PSJLIACT",34,0)
 Q:$D(PSIVNBD)!($G(PSIVCOPY)&'$G(PSIVENO))
"RTN","PSJLIACT",35,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",36,0)
 S VALMBCK=$S($G(PSIVFN1):"Q",1:"R")
"RTN","PSJLIACT",37,0)
 Q
"RTN","PSJLIACT",38,0)
EDIT1 ;
"RTN","PSJLIACT",39,0)
 ;Ensure P() is defined
"RTN","PSJLIACT",40,0)
 I $D(P)<10 S XQORQUIT=1,P("PON")="",PSIVNBD=1 D  Q
"RTN","PSJLIACT",41,0)
 .W !,"WARNING: An error has occurred. Changes will not be saved"
"RTN","PSJLIACT",42,0)
 .D PAUSE^VALM1
"RTN","PSJLIACT",43,0)
 .S VALMBCK="Q"
"RTN","PSJLIACT",44,0)
 I "ANP"'[P(17) W !,"You cannot edit an inactive order" D PAUSE^VALM1 Q
"RTN","PSJLIACT",45,0)
 S:$G(ON55)="" ON55=$G(PSJORD)
"RTN","PSJLIACT",46,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",47,0)
 ;* Edit a new back door order
"RTN","PSJLIACT",48,0)
 ;;I ($G(ON55)["V"&($G(P(21))="")) D  Q
"RTN","PSJLIACT",49,0)
 I ($G(ON55)["V"&($G(P("21FLG"))="")) D  Q
"RTN","PSJLIACT",50,0)
 . D GSTRING^PSIVORE1,GTFLDS^PSIVORFE
"RTN","PSJLIACT",51,0)
 . I $G(ON55)["V",'$G(DONE) D OK^PSIVORE
"RTN","PSJLIACT",52,0)
 . S VALMBCK="Q",PSIVNBD=1
"RTN","PSJLIACT",53,0)
 ;* Edit an active order
"RTN","PSJLIACT",54,0)
 I $G(ON55)["V" NEW PSJEDIT1 D E^PSIVOPT1 D  Q
"RTN","PSJLIACT",55,0)
 . I $G(PSJIVBD) K PSJIVBD D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",56,0)
 I $G(ON55)["P" D EDIT^PSIVORC ;Edit incomplete order.
"RTN","PSJLIACT",57,0)
 Q
"RTN","PSJLIACT",58,0)
ACCEPT ; Accept order
"RTN","PSJLIACT",59,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",60,0)
 ;Accept IV from back door.
"RTN","PSJLIACT",61,0)
 I $G(PSJIVBD) K PSJIVBD D OK^PSIVORE S VALMBCK="Q" Q
"RTN","PSJLIACT",62,0)
 I ON["V" D ACCEPT^PSIVOPT1 Q
"RTN","PSJLIACT",63,0)
 S PSIVFN1=1
"RTN","PSJLIACT",64,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIACT",65,0)
 S VALMBCK="Q"
"RTN","PSJLIACT",66,0)
 Q
"RTN","PSJLIACT",67,0)
R ; Renewal
"RTN","PSJLIACT",68,0)
 S PSJREN=1
"RTN","PSJLIACT",69,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",70,0)
 NEW PSIVAC S PSIVAC="PR" K PSGFDX
"RTN","PSJLIACT",71,0)
 D R^PSIVOPT
"RTN","PSJLIACT",72,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",73,0)
 K PSJREN
"RTN","PSJLIACT",74,0)
 Q
"RTN","PSJLIACT",75,0)
H ; Hold
"RTN","PSJLIACT",76,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",77,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",78,0)
 D H^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",79,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",80,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",81,0)
 Q
"RTN","PSJLIACT",82,0)
L ; Activity Log
"RTN","PSJLIACT",83,0)
 NEW PSIVLAB,PSIVLOG,PSJHIS S (PSIVLAB,PSIVLOG)=1
"RTN","PSJLIACT",84,0)
 D EN^PSIVVW1
"RTN","PSJLIACT",85,0)
 D EN^PSJLIVMD
"RTN","PSJLIACT",86,0)
 S VALMBCK="R"
"RTN","PSJLIACT",87,0)
 Q
"RTN","PSJLIACT",88,0)
O ; On Call
"RTN","PSJLIACT",89,0)
 NEW TEX S TEX="Active order ***"
"RTN","PSJLIACT",90,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIACT",91,0)
 D O^PSIVOPT(DFN,ON,P(17),P(3))
"RTN","PSJLIACT",92,0)
 D:P(17)="A" PAUSE^VALM1
"RTN","PSJLIACT",93,0)
 D EN^PSJLIORD(DFN,ON)
"RTN","PSJLIACT",94,0)
 Q
"RTN","PSJLIACT",95,0)
VF ; Make the order active
"RTN","PSJLIACT",96,0)
 NEW PSIVCHG S PSIVCHG=0
"RTN","PSJLIACT",97,0)
 I ON["V" S ON55=ON D VF1("V","ORDER VERIFIED BY ",1) Q
"RTN","PSJLIACT",98,0)
 D ACTIVE^PSIVORC2
"RTN","PSJLIACT",99,0)
 Q
"RTN","PSJLIACT",100,0)
VF1(PSIVREA,PSIVAL,PSIVLOG) ;
"RTN","PSJLIACT",101,0)
 ;Update 4 node and set activity log.
"RTN","PSJLIACT",102,0)
 ;PSIVREA: the reason use by LOG^PSIVORAL
"RTN","PSJLIACT",103,0)
 ;PSIVAL : the description reason
"RTN","PSJLIACT",104,0)
 ;PSIVLOG: Log an activity if = 1
"RTN","PSJLIACT",105,0)
 I '+$G(OD)!($L($G(OD))>16) K OD
"RTN","PSJLIACT",106,0)
 D:+PSJSYSU=3 ^PSIVORE1
"RTN","PSJLIACT",107,0)
 NEW DIE,DA,DR,PSJX,XX,PSIVACT,PSJRQND
"RTN","PSJLIACT",108,0)
 S PSIVACT=1
"RTN","PSJLIACT",109,0)
 S PSJX=$G(^PS(55,DFN,"IV",+ON55,4)),XX=""
"RTN","PSJLIACT",110,0)
 I $P(PSJX,U)="" S XX=";143////0"
"RTN","PSJLIACT",111,0)
 I $P(PSJX,U,4)="" S XX=XX_U_";142////0"
"RTN","PSJLIACT",112,0)
 D NOW^%DTC
"RTN","PSJLIACT",113,0)
 S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",114,0)
 I +PSJSYSU=3 S DR="140////"_DUZ_";141////"_$E(%,1,12)_";142////1"_$P(XX,U)
"RTN","PSJLIACT",115,0)
 I +PSJSYSU=1 S DR="16////"_DUZ_";17////"_$E(%,1,12)_";143////1"_$P(XX,U,2)
"RTN","PSJLIACT",116,0)
 I $G(P("PRY"))="D" S DR=DR_";.22////"_+P("IVRM")
"RTN","PSJLIACT",117,0)
 D ^DIE
"RTN","PSJLIACT",118,0)
 ; If pending IV renew is edited during finish, go back and DE the original active order left in RENEWED status
"RTN","PSJLIACT",119,0)
 S PREREN=$S(ON55["V":$G(@(DIE_"+ON55,2)")),1:""),PREREN=$P(PREREN,"^",5) I PREREN D  K PREREN
"RTN","PSJLIACT",120,0)
 . I PREREN["P" S PREREN=$G(@("^PS(53.1,+PREREN,0)")),PREREN=$P(PREREN,"^",25)
"RTN","PSJLIACT",121,0)
 . I PREREN["V" N PRERENOD S PRERENOD=$G(@("^PS(55,DFN,""IV"",+PREREN,0)")) I $P(PRERENOD,"^",17)="R",($G(P("RES"))="E") D
"RTN","PSJLIACT",122,0)
 ..  S DIE="^PS(55,"_DFN_",""IV"",",DA=+PREREN,DA(1)=DFN
"RTN","PSJLIACT",123,0)
 ..  S DR="100////D;.03////"_PSGDT S ORIGSTOP=$P($G(@("^PS(55,DFN,""IV"",+PREREN,2)")),"^",3) I ORIGSTOP S DR=DR_";116////"_ORIGSTOP
"RTN","PSJLIACT",124,0)
 ..  D ^DIE D EN1^PSJHL2(DFN,"SC",PREREN)
"RTN","PSJLIACT",125,0)
 K DR,DIE,DA
"RTN","PSJLIACT",126,0)
 ;I ((+PSJSYSU=3)&($G(PSJPRI)="D"))!((+PSJSYSU=3)&($G(P("PRY"))="D")) D
"RTN","PSJLIACT",127,0)
 I (+PSJSYSU=3)&($G(P("PRY"))="D") D
"RTN","PSJLIACT",128,0)
 .N DIR W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Do you want to enter a Progress Note",DIR("B")="No" D ^DIR
"RTN","PSJLIACT",129,0)
 .Q:Y="N"
"RTN","PSJLIACT",130,0)
 .D MAIN^TIUEDIT(3,.TIUDA,DFN,"","","","",1)
"RTN","PSJLIACT",131,0)
 Q:'$G(PSIVLOG)
"RTN","PSJLIACT",132,0)
 I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D
"RTN","PSJLIACT",133,0)
 . NEW DIC,DA,X,Y,XX,DO D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJLIACT",134,0)
 . S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJLIACT",135,0)
 . S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJLIACT",136,0)
 . S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJLIACT",137,0)
 . D FILE^DICN
"RTN","PSJLIACT",138,0)
 NEW PSIVALCK
"RTN","PSJLIACT",139,0)
 S PSIVREA="V",PSIVALT=""
"RTN","PSJLIACT",140,0)
 S PSIVAL=PSIVAL_$S(+PSJSYSU=3:"PHARMACIST",1:"NURSE")
"RTN","PSJLIACT",141,0)
 D LOG^PSIVORAL K PSIVAL,PSIVREA,PSIVLN
"RTN","PSJLIACT",142,0)
 I $G(PSJORD)["P" S PSIVREA="V",PSIVALT="",PSGRDTX=$G(^PS(53.1,+PSJORD,2.5)) D
"RTN","PSJLIACT",143,0)
 . I $G(PSGRDTX) S PSIVAL="Requested Start Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U))) D LOG^PSIVORAL
"RTN","PSJLIACT",144,0)
 . I $P(PSGRDTX,U,3) S PSIVREA="V",PSIVALT="" S PSIVAL="Requested Stop Date: "_$$ENDTC^PSGMI($$DATE2^PSJUTL2($P(PSGRDTX,U,3))) D LOG^PSIVORAL
"RTN","PSJLIACT",145,0)
 N DUR I $G(PSJORD) S DUR=$$GETDUR^PSJLIVMD(DFN,+PSJORD,$S(PSJORD["P":"P",1:"IV"),1) I DUR]""  D
"RTN","PSJLIACT",146,0)
 . K DR S DIE="^PS(55,"_DFN_",""IV"",",DA=+ON55,DA(1)=DFN
"RTN","PSJLIACT",147,0)
 . S DR="151////"_DUR
"RTN","PSJLIACT",148,0)
 . D ^DIE
"RTN","PSJLIACT",149,0)
 D EN1^PSJHL2(DFN,"SC",ON55)
"RTN","PSJLIACT",150,0)
 D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON55)
"RTN","PSJLIACT",151,0)
 D GT55^PSIVORFB S OLDON=$P($G(^PS(55,DFN,"IV",+ON55,2)),"^",5),P("OLDON")=OLDON
"RTN","PSJLIACT",152,0)
 N PSJPRIO,PSJSCH,NODE0,NODEP2 S NODE0=$G(^PS(55,DFN,"IV",+ON55,0)),NODEP2=$G(^PS(55,DFN,"IV",+ON55,.2))
"RTN","PSJLIACT",153,0)
 S PSJPRIO=$P(NODEP2,"^",4),PSJSCH=$P(NODE0,"^",9)
"RTN","PSJLIACT",154,0)
 I (",S,A,")[(","_$G(PSJPRIO)_",")!($G(PSJSCH)="NOW")!($G(PSJSCH)["STAT") D NOTIFY^PSJHL4(ON55,DFN,$G(PSJPRIO),$G(PSJSCH))
"RTN","PSJLIACT",155,0)
 Q
"RTN","PSJLIFN")
0^30^B25627091
"RTN","PSJLIFN",1,0)
PSJLIFN ;BIR/MV-IV FINISH USING LM ;13 Jan 98 / 11:32 AM
"RTN","PSJLIFN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,29,34,37,42,47,50,56,94,80,116,110**;16 DEC 97
"RTN","PSJLIFN",3,0)
 ;
"RTN","PSJLIFN",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSJLIFN",5,0)
 ; Reference to ^PS(52.6 supported by DBIA #1231.
"RTN","PSJLIFN",6,0)
 ; Reference to ^PS(52.7 supported by DBIA #2173.
"RTN","PSJLIFN",7,0)
 ; Reference to ^PSDRUG( is supported by DBIA #2192.
"RTN","PSJLIFN",8,0)
 ; Reference to ^PSOORDRG is supported by DBIA #2190.
"RTN","PSJLIFN",9,0)
 ; Reference to ^%DT is supported by DBIA #10003.
"RTN","PSJLIFN",10,0)
 ; Reference to ^VALM is supported by DBIA #10118.
"RTN","PSJLIFN",11,0)
 ; Reference to ^VALM1 is supported by DBIA #10116.
"RTN","PSJLIFN",12,0)
 ; Reference to RE^VALM4 is supported by DBIA #10120.
"RTN","PSJLIFN",13,0)
 ;
"RTN","PSJLIFN",14,0)
EN ; Display order with numbers.
"RTN","PSJLIFN",15,0)
 L +^PS(53.1,+PSJORD):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." D PAUSE^VALM1 Q
"RTN","PSJLIFN",16,0)
 D PENDING K PSJREN
"RTN","PSJLIFN",17,0)
 L -^PS(53.1,+PSJORD)
"RTN","PSJLIFN",18,0)
 Q
"RTN","PSJLIFN",19,0)
PENDING ; Process pending order.
"RTN","PSJLIFN",20,0)
 ;* PSIVFN1 is use so it will dipslay the AC/Edit screen
"RTN","PSJLIFN",21,0)
 ;* instead of go to the "IS this O.K." prompt
"RTN","PSJLIFN",22,0)
 ;* PSIVACEP only when accept the order. Original screen won't redisp.
"RTN","PSJLIFN",23,0)
 ;* PSJLMX is defined in WRTDRG^PSIVUTL and it was being call in PSJLIVMD & PSJLIVFD
"RTN","PSJLIFN",24,0)
 ;*        to count # of AD/SOL 
"RTN","PSJLIFN",25,0)
 NEW PSIVFN1,PSIVACEP,PSJLMX,PSIVOI
"RTN","PSJLIFN",26,0)
 S PSIVAC="CF" S (P("PON"),ON)=+PSJORD_"P",DFN=PSGP
"RTN","PSJLIFN",27,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON)
"RTN","PSJLIFN",28,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIFN",29,0)
 NEW PSJL
"RTN","PSJLIFN",30,0)
 N PSIVNUM,PSJSTAR S PSIVNUM=1
"RTN","PSJLIFN",31,0)
 Q:ON'=PSJORD
"RTN","PSJLIFN",32,0)
 I $G(PSJLYN)]"" Q:ON'=PSJLYN
"RTN","PSJLIFN",33,0)
 S PSJMAI=ON
"RTN","PSJLIFN",34,0)
 I P("OT")="I" D  Q
"RTN","PSJLIFN",35,0)
 . S PSJSTAR="(5)^(7)^(9)^(10)"
"RTN","PSJLIFN",36,0)
 . D EN^VALM("PSJ LM IV INPT PENDING") ;; ^PSJLIVMD
"RTN","PSJLIFN",37,0)
 S PSJSTAR="(1)^(2)^(3)^(5)^(7)^(9)"
"RTN","PSJLIFN",38,0)
 D GTDATA D EN^VALM("PSJ LM IV PENDING") ;; ^PSJLIVFD
"RTN","PSJLIFN",39,0)
 K PSJMAI Q
"RTN","PSJLIFN",40,0)
 ;
"RTN","PSJLIFN",41,0)
DISPLAY ;
"RTN","PSJLIFN",42,0)
 S PSGACT=""
"RTN","PSJLIFN",43,0)
 S VALMSG="Press Return to continue"
"RTN","PSJLIFN",44,0)
 D:$E(P("OT"))="I" EN^VALM("PSJ LM IV INPT DISPLAY")
"RTN","PSJLIFN",45,0)
 D:$E(P("OT"))'="I" EN^VALM("PSJ LM IV DISPLAY")
"RTN","PSJLIFN",46,0)
 K PSJDISP
"RTN","PSJLIFN",47,0)
 S:'$G(PSJHIS) VALMBCK=""
"RTN","PSJLIFN",48,0)
 Q
"RTN","PSJLIFN",49,0)
GTDATA ;
"RTN","PSJLIFN",50,0)
 ;* D:P(4)="" 53^PSIVORC1 Q:P(4)=""  S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSJLIFN",51,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSJLIFN",52,0)
 I 'P(2) D
"RTN","PSJLIFN",53,0)
 .I P("RES")="R" S PSJREN=1
"RTN","PSJLIFN",54,0)
 .D ENT^PSIVCAL K %DT S X=P(2),%DT="RTX" D ^%DT S P(2)=+Y
"RTN","PSJLIFN",55,0)
 I 'P(3) D ENSTOP^PSIVCAL K %DT S X=P(3),%DT="RTX" D ^%DT S P(3)=+Y
"RTN","PSJLIFN",56,0)
 I 'P("MR") S P("MR")=$O(^PS(51.2,"B","INTRAVENOUS",0))_"^IV"
"RTN","PSJLIFN",57,0)
 Q
"RTN","PSJLIFN",58,0)
FINISH ; Prompt for missing data
"RTN","PSJLIFN",59,0)
 ;* Ord chk for Inpat. pending only. Pend renew should not be checked.
"RTN","PSJLIFN",60,0)
 ;* PSIVOCON needed so this order will be excluded from the order
"RTN","PSJLIFN",61,0)
 ;*          list(ORDCHK^PSJLMUT1)
"RTN","PSJLIFN",62,0)
 ;* PSGORQF defined means cancel the order due to order check.
"RTN","PSJLIFN",63,0)
 ;Q:'$$LS^PSSLOCK(DFN,PSJORD)
"RTN","PSJLIFN",64,0)
 N PSJCOM S PSJCOM=+$P($G(^PS(53.1,+PSJORD,.2)),"^",8)
"RTN","PSJLIFN",65,0)
 K PSJIVBD,PSGRDTX
"RTN","PSJLIFN",66,0)
 N FIL,PSIVS,DRGOC,PSIVXD,DRGTMP,PSIVOCON,PSGORQF,ON55,NSFF S NSFF=1
"RTN","PSJLIFN",67,0)
 S (ON,PSIVOCON,ON55,PSGORD)=PSJORD Q:PSJORD'=PSJMAI  I $G(PSJLYN)]"" Q:PSJORD'=PSJLYN
"RTN","PSJLIFN",68,0)
 D UDVARS^PSJLIORD
"RTN","PSJLIFN",69,0)
 I $G(PSJPROT)=3,'$$ENIVUD^PSGOEF1(PSJORD) K NSFF Q
"RTN","PSJLIFN",70,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIFN",71,0)
 ; force the display of the second screen if CPRS order checks exist
"RTN","PSJLIFN",72,0)
 I $O(^PS(53.1,+PSJORD,12,0))!$O(^PS(53.1,+PSJORD,10,0)) D
"RTN","PSJLIFN",73,0)
 .Q:$G(PSJLMX)=1   ;no second screen to display
"RTN","PSJLIFN",74,0)
 .S VALMBG=16 D RE^VALM4,PAUSE^VALM1 S VALMBG=1
"RTN","PSJLIFN",75,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI"))
"RTN","PSJLIFN",76,0)
 ;I $E(P("OT"))="I" D GTDATA Q:P(4)=""
"RTN","PSJLIFN",77,0)
 ;I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) D
"RTN","PSJLIFN",78,0)
 I $G(P("RES"))'="R" D 53^PSIVORC1
"RTN","PSJLIFN",79,0)
 I $G(P(4))]"",$G(P(15))]"",$G(P(9))]"",$$SCHREQ^PSJLIVFD(.P) D
"RTN","PSJLIFN",80,0)
 . N PSGS0XT,X,PSJNSS S PSJNSS=1,X=P(9),PSGS0XT=P(15) D Q2^PSGS0
"RTN","PSJLIFN",81,0)
 I P(4)="" D RE^VALM4 Q
"RTN","PSJLIFN",82,0)
 I $E(P("OT"))="I" D GTDATA  D
"RTN","PSJLIFN",83,0)
 . I '$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFN",84,0)
 . D ORDCHK
"RTN","PSJLIFN",85,0)
 S VALMBG=1
"RTN","PSJLIFN",86,0)
 I $E(P("OT"))="F" S DNE=0 D ORDCHK I $G(PSGORQF) D RE^VALM4 Q
"RTN","PSJLIFN",87,0)
 I $D(PSGORQF) S VALMBCK="R",P(4)="" K DRG Q
"RTN","PSJLIFN",88,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT
"RTN","PSJLIFN",89,0)
 I $G(DONE) S VALMBCK="R" Q
"RTN","PSJLIFN",90,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIFN",91,0)
 S:$G(PSIVACEP) VALMBCK="Q"
"RTN","PSJLIFN",92,0)
 I $G(PSGORQF) S VALMBG=1 D RE^VALM4
"RTN","PSJLIFN",93,0)
 K NSFF
"RTN","PSJLIFN",94,0)
 Q
"RTN","PSJLIFN",95,0)
ORDCHK ;* Do order check for Inpatient Meds IV.
"RTN","PSJLIFN",96,0)
 ; PSGORQF is defined (CONT^PSGSICHK) if not log an intervention
"RTN","PSJLIFN",97,0)
 K PSGORQF
"RTN","PSJLIFN",98,0)
 NEW DRGOC
"RTN","PSJLIFN",99,0)
 D OCORD Q:$G(PSGORQF) 
"RTN","PSJLIFN",100,0)
 ;D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL
"RTN","PSJLIFN",101,0)
ORDCHKA ;* Do order check agaist existing orders on the profile
"RTN","PSJLIFN",102,0)
 F PSIVAS="AD","SOL" Q:$G(PSGORQF)  S FIL=$S(PSIVAS="AD":52.6,1:52.7) D
"RTN","PSJLIFN",103,0)
 . F PSIVX=0:0 S PSIVX=$O(DRG(PSIVAS,PSIVX)) Q:'PSIVX!($G(PSGORQF))  D
"RTN","PSJLIFN",104,0)
 .. S DRGTMP=DRG(PSIVAS,PSIVX)
"RTN","PSJLIFN",105,0)
 .. ;* Do only 1 duplicate warning when order has >1 of the same additive
"RTN","PSJLIFN",106,0)
 .. Q:$D(PSJADTMP(+DRGTMP))
"RTN","PSJLIFN",107,0)
 .. D ORDERCHK^PSIVEDRG(PSGP,ON,$D(DRGOC(ON)))
"RTN","PSJLIFN",108,0)
 .. S DRGOC(ON,PSIVAS,PSIVX)=DRG(PSIVAS,PSIVX)
"RTN","PSJLIFN",109,0)
 .. S PSJADTMP(+DRGTMP)=""
"RTN","PSJLIFN",110,0)
 K PSJADTMP
"RTN","PSJLIFN",111,0)
 Q
"RTN","PSJLIFN",112,0)
OCORD ;* Do order check for each drug against the drugs within the order.
"RTN","PSJLIFN",113,0)
 NEW X,Y,DDRUG,PSIVX,PSJAD,PSJSOL,TMPDRG
"RTN","PSJLIFN",114,0)
 D SAVEDRG^PSIVEDRG(.TMPDRG,.DRG)
"RTN","PSJLIFN",115,0)
 ; Find the corresponding DD for the additive within the order
"RTN","PSJLIFN",116,0)
 F X=0:0 S X=$O(DRG("AD",X)) Q:'X  D
"RTN","PSJLIFN",117,0)
 . S DDRUG=$P($G(^PS(52.6,+DRG("AD",X),0)),U,2)
"RTN","PSJLIFN",118,0)
 . S:+DDRUG (DDRUG(DDRUG),PSJAD(DDRUG))=$D(DDRUG(DDRUG))+1
"RTN","PSJLIFN",119,0)
 ;
"RTN","PSJLIFN",120,0)
 ; Find the corresponding DD for the solution
"RTN","PSJLIFN",121,0)
 ;
"RTN","PSJLIFN",122,0)
 F X=0:0 S X=$O(DRG("SOL",X)) Q:'X  D
"RTN","PSJLIFN",123,0)
 . S DDRUG=$P($G(^PS(52.7,+DRG("SOL",X),0)),U,2)
"RTN","PSJLIFN",124,0)
 . S:+DDRUG (DDRUG(DDRUG),PSJSOL(DDRUG))=$D(DDRUG(DDRUG))+1
"RTN","PSJLIFN",125,0)
 ;
"RTN","PSJLIFN",126,0)
 ; Loop thru each additive to check for DD,DI & DC against the
"RTN","PSJLIFN",127,0)
 ; order's dispense drugs
"RTN","PSJLIFN",128,0)
 ;
"RTN","PSJLIFN",129,0)
 NEW PSJDFN,INTERVEN S INTERVEN=""
"RTN","PSJLIFN",130,0)
 S PSJDFN=DFN ;DFN will be killed when call ^PSOORDRG
"RTN","PSJLIFN",131,0)
 F PSIVX=0:0 S PSIVX=$O(PSJAD(PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFN",132,0)
 . K DDRUG(PSIVX) D DRGCHK^PSOORDRG(PSJDFN,PSIVX,.DDRUG)
"RTN","PSJLIFN",133,0)
 . I PSJAD(PSIVX)>1 S ^TMP($J,"DD",1,0)=PSIVX_U_$P($G(^PSDRUG(PSIVX,0)),U)_"^^"_ON_";I"
"RTN","PSJLIFN",134,0)
 . NEW TYPE F TYPE="DD","DI","DC" D ORDCHK^PSJLIFNI(PSJDFN,TYPE)
"RTN","PSJLIFN",135,0)
 F PSIVX=0:0 S PSIVX=$O(PSJSOL(PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFN",136,0)
 . K DDRUG(PSIVX) D DRGCHK^PSOORDRG(PSJDFN,PSIVX,.DDRUG)
"RTN","PSJLIFN",137,0)
 . NEW TYPE F TYPE="DI" D ORDCHK^PSJLIFNI(PSJDFN,TYPE)
"RTN","PSJLIFN",138,0)
 S DFN=PSJDFN
"RTN","PSJLIFN",139,0)
 D SAVEDRG^PSIVEDRG(.DRG,.TMPDRG)
"RTN","PSJLIFN",140,0)
 Q
"RTN","PSJLIFNI")
0^105^B10798188
"RTN","PSJLIFNI",1,0)
PSJLIFNI ;BIR/MV-U/D ORDER FINISHES AS IV ;13 Jan 98 / 11:32 AM
"RTN","PSJLIFNI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,29,34,37,50,94,116,110**;16 DEC 97
"RTN","PSJLIFNI",3,0)
 ;
"RTN","PSJLIFNI",4,0)
IV(PSJORD,OI) ; Prompt for missing data to be finished as IV.
"RTN","PSJLIFNI",5,0)
 L +^PS(53.1,+PSJORD):1 I '$T W !,$C(7),$C(7),"This order is being edited by another user. Try later." D PAUSE^VALM1 Q
"RTN","PSJLIFNI",6,0)
 D HOLDHDR^PSJOE
"RTN","PSJLIFNI",7,0)
 ;** PSIVFN1 is use so it will dipslay the AC/Edit screen
"RTN","PSJLIFNI",8,0)
 ;** instead of go to the "IS this O.K." prompt
"RTN","PSJLIFNI",9,0)
 ;** PSJLIFNI is a flag to indicate U/D finishes as IV.
"RTN","PSJLIFNI",10,0)
 K PSJIVBD
"RTN","PSJLIFNI",11,0)
 NEW PSIVFN1,ON55,PSGORQF,PSIVACEP,DRGOC,PSJLIFNI,PSIVOI
"RTN","PSJLIFNI",12,0)
 S PSJLIFNI=1
"RTN","PSJLIFNI",13,0)
 S PSIVAC="CF" S (P("PON"),ON,ON55)=+PSJORD_"P",DFN=PSGP
"RTN","PSJLIFNI",14,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT531^PSIVORFA(DFN,ON) S P("PD")=OI_U_$$OIDF^PSJLMUT1(+OI)
"RTN","PSJLIFNI",15,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIFNI",16,0)
 S P("OPI")=$$ENPC^PSJUTL("V",+PSIVUP,60,P("OPI"))
"RTN","PSJLIFNI",17,0)
 D 53^PSIVORC1
"RTN","PSJLIFNI",18,0)
 I $E(P("OT"))="I" D GTDATA^PSJLIFN Q:P(4)=""
"RTN","PSJLIFNI",19,0)
 I $$SCHREQ^PSJLIVFD(.P),(P(9))]"",'$$PRNOK^PSGS0(P(9)) N PSGOES,X,PSGS0XT,PSJNSS S PSJNSS=1,PSGOES=1,X=P(9),PSGS0XT=P(15) D Q2^PSGS0
"RTN","PSJLIFNI",20,0)
 I $E(P("OT"))="I",'$D(DRG("AD")),('$D(DRG("SOL"))) S DNE=0 D GTIVDRG^PSIVORC2 S P(3)="" D ENSTOP^PSIVCAL D ORDCHK^PSJLIFN
"RTN","PSJLIFNI",21,0)
 I $D(PSGORQF) S VALMBCK="R",P(4)="" K DRG Q
"RTN","PSJLIFNI",22,0)
 S ^TMP("PSJI",$J,0)=""
"RTN","PSJLIFNI",23,0)
 S PSIVOK="1^3^10^25^26^39^57^58^59^63^64" D CKFLDS^PSIVORC1 D:EDIT]"" EDIT^PSIVEDT
"RTN","PSJLIFNI",24,0)
 I $G(DONE) S VALMBCK="R" D EXIT Q
"RTN","PSJLIFNI",25,0)
 D COMPLTE^PSIVORC1
"RTN","PSJLIFNI",26,0)
 S:$D(PSIVACEP) VALMBCK="Q"
"RTN","PSJLIFNI",27,0)
EXIT ;
"RTN","PSJLIFNI",28,0)
 L -^PS(53.1,+PSJORD)
"RTN","PSJLIFNI",29,0)
 Q
"RTN","PSJLIFNI",30,0)
ORDCHK(DFN,TYPE) ;
"RTN","PSJLIFNI",31,0)
 ;TYPE ="DD" - Duplicate drug
"RTN","PSJLIFNI",32,0)
 ;     ="DC" - Duplicate class
"RTN","PSJLIFNI",33,0)
 ;     -"DI" - Drug Interaction
"RTN","PSJLIFNI",34,0)
 ;
"RTN","PSJLIFNI",35,0)
 NEW ON,PSJL,PSIVX,PSJOC,PSJORIEN,PSJPACK,PSJLINE
"RTN","PSJLIFNI",36,0)
 S PSJOC=0,PSJLINE=1
"RTN","PSJLIFNI",37,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP($J,TYPE,PSIVX)) Q:'PSIVX  D
"RTN","PSJLIFNI",38,0)
 . I TYPE="DI",($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL") S PSJIREQ=1
"RTN","PSJLIFNI",39,0)
 . D WRITE(TYPE),CONT^PSGSICHK
"RTN","PSJLIFNI",40,0)
 .; I ON["V" D
"RTN","PSJLIFNI",41,0)
 .;. I '$O(^PS(55,DFN,"IV",+ON,0)) D SETPSJOC Q
"RTN","PSJLIFNI",42,0)
 .;. D DSPLORDV(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLIFNI",43,0)
 .; I ON'["V" D DSPLORDU(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLIFNI",44,0)
 .; S PSJOC(ON,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJLIFNI",45,0)
 ;D:PSJOC WRITE(TYPE)
"RTN","PSJLIFNI",46,0)
 ;S ON="" F  S ON=$O(PSJOC(ON)) Q:ON=""  W ! S PSJLINE=PSJLINE+1 D
"RTN","PSJLIFNI",47,0)
 ;. F PSIVX=0:0 S PSIVX=$O(PSJOC(ON,PSIVX)) Q:'PSIVX  W !,PSJOC(ON,PSIVX)  S PSJLINE=PSJLINE+1 D:'(PSIVX#6) PAUSE
"RTN","PSJLIFNI",48,0)
 ;W !
"RTN","PSJLIFNI",49,0)
 Q
"RTN","PSJLIFNI",50,0)
WRITE(TYPE) ;Display order check description
"RTN","PSJLIFNI",51,0)
 S PSJPDRG=1
"RTN","PSJLIFNI",52,0)
 I TYPE="DD" W !!,"There are duplicate ",$P(^TMP($J,TYPE,PSIVX,0),U,2),!,"medications prescribed for this order.",! Q
"RTN","PSJLIFNI",53,0)
 I TYPE="DC" W !!,"This medication: ",$P(^TMP($J,TYPE,PSIVX,0),U,4),!,"is in the same class as the following medication(s) within this order: "
"RTN","PSJLIFNI",54,0)
 I TYPE="DI" W !!,"This medication: ",$P(^TMP($J,TYPE,PSIVX,0),U,2),!,"has an interaction with the following medication(s) within this order: "
"RTN","PSJLIFNI",55,0)
 F X=0:0 S X=$O(^TMP($J,TYPE,X)) Q:'X  W !,$S(TYPE="DC":$P(^TMP($J,TYPE,X,0),U,4),TYPE="DI":$P(^TMP($J,TYPE,X,0),U,6),1:$P(^TMP($J,TYPE,X,0),U,2)),!
"RTN","PSJLIFNI",56,0)
 Q
"RTN","PSJLIORD")
0^31^B9589966
"RTN","PSJLIORD",1,0)
PSJLIORD ;BIR/MV-INPATIENT ORDER ENTRY FOR IV ;10 Mar 98 / 4:19 PM
"RTN","PSJLIORD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**1,16,29,58,85,110**;16 DEC 97
"RTN","PSJLIORD",3,0)
 ;
"RTN","PSJLIORD",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIORD",5,0)
 ; Reference to EN1^ORCFLAG is supported by DBIA #3620.
"RTN","PSJLIORD",6,0)
 ; Reference to AND^ORX8 is supported by DBIA #3632.
"RTN","PSJLIORD",7,0)
 ;
"RTN","PSJLIORD",8,0)
EN(DFN,PSJORD) ; Display order with numbers.
"RTN","PSJLIORD",9,0)
 ;N ON,ON55,P,PSIVAC,PSGEBN,PSGLI,PSJSTAR
"RTN","PSJLIORD",10,0)
 N ON55,P,PSIVAC,PSGEBN,PSGLI,PSJSTAR
"RTN","PSJLIORD",11,0)
 D UDVARS
"RTN","PSJLIORD",12,0)
 S (PSGEBN,PSGLI)=""
"RTN","PSJLIORD",13,0)
 ;* S PSIVAC="C" S (P("PON"),ON,ON55)=+PSJORD_"V"
"RTN","PSJLIORD",14,0)
 S PSIVAC="E" S (P("PON"),ON,ON55)=+PSJORD_"V"
"RTN","PSJLIORD",15,0)
 S PSIVUP=+$$GTPCI^PSIVUTL D GT55^PSIVORFB
"RTN","PSJLIORD",16,0)
 D:'$D(P("OT")) GTOT^PSIVUTL(P(4))
"RTN","PSJLIORD",17,0)
 NEW PSJL
"RTN","PSJLIORD",18,0)
 N PSIVNUM S PSIVNUM=1
"RTN","PSJLIORD",19,0)
 ;;I $E(P("OT"))'="F" S PSJSTAR="(1)^(4)^(5)^(6)^(7)^(9)^(10)"
"RTN","PSJLIORD",20,0)
 I $E(P("OT"))="I" S PSJSTAR="(1)^(4)^(5)^(6)^(7)^(9)^(10)"
"RTN","PSJLIORD",21,0)
 E  S PSJSTAR="(1)^(2)^(3)^(4)^(5)^(6)^(7)^(9)" D GTDATA^PSJLIFN
"RTN","PSJLIORD",22,0)
 NEW PSGACT D PSGACT
"RTN","PSJLIORD",23,0)
 ;* Only allow activity logs for non pharmacist/RN personel if coming
"RTN","PSJLIORD",24,0)
 ;* from the Non-verify/pending option.
"RTN","PSJLIORD",25,0)
 I '+$P(PSJSYSU,";"),$G(PSJPNV) S PSGACT="L"
"RTN","PSJLIORD",26,0)
 D EN^VALM("PSJ LM IV INPT ACTIVE") ; Call to EN^PSJLIVMD
"RTN","PSJLIORD",27,0)
 S VALMBCK="Q"
"RTN","PSJLIORD",28,0)
 Q
"RTN","PSJLIORD",29,0)
 ;
"RTN","PSJLIORD",30,0)
PSGACT ;Setup selectable actions based on order's status
"RTN","PSJLIORD",31,0)
 S (X,XKEYS)=$$CHKKEYS()
"RTN","PSJLIORD",32,0)
 N PSGR S PSGACT=""
"RTN","PSJLIORD",33,0)
 S PSJCOM=$P($G(^PS(55,DFN,"IV",+ON55,.2)),U,8)
"RTN","PSJLIORD",34,0)
 I PSJCOM S PSGR=0
"RTN","PSJLIORD",35,0)
 I PSJCOM S PSGR=$$AND^ORX8(PSJCOM) S:PSGR=1 PSGR=$$RNEWOK^PSJUTL2(PSJCOM,DFN)
"RTN","PSJLIORD",36,0)
 I 'PSJCOM S PSGR='$$EXPIRED^PSGOER(DFN,ON55)
"RTN","PSJLIORD",37,0)
 S X=XKEYS
"RTN","PSJLIORD",38,0)
 ;I P(17)="A" S PSGACT=$S(PSJCOM:"L",1:"EL") S:+X PSGACT=PSGACT_"DO"_$S(P(10):"",1:"H")_$S(PSGR:"R",1:"")
"RTN","PSJLIORD",39,0)
 ;I P(17)="A" S PSGACT="L" S:+X PSGACT=$S(P(10):"DROL",1:"DHROL")
"RTN","PSJLIORD",40,0)
 I P(17)="A" S PSGACT="EL" S:+X PSGACT=PSGACT_"DO"_$S(P(10):"",1:"H")_$S(PSGR:"R",1:"")
"RTN","PSJLIORD",41,0)
 I P(17)="H" S PSGACT="L" S:+X PSGACT=$S(P(10):"DL",1:"DHL")
"RTN","PSJLIORD",42,0)
 I P(17)="R" S PSGACT="L" S:+X PSGACT="DL"
"RTN","PSJLIORD",43,0)
 I P(17)="D" S PSGACT="L"
"RTN","PSJLIORD",44,0)
 I P(17)="D"&P(12) S PSGACT="L" S:+X PSGACT="L"_$S(PSGR:"R",1:"")
"RTN","PSJLIORD",45,0)
 I P(17)="E" S PSGACT="L" D:+X
"RTN","PSJLIORD",46,0)
 . I $P($G(^PS(55,DFN,"IV",+ON55,.2)),U,4)="D" Q
"RTN","PSJLIORD",47,0)
 . S PSGACT="L"_$S($P($G(^PS(55,DFN,"IV",+ON55,2)),U,6):"",PSGR:"R",1:"")
"RTN","PSJLIORD",48,0)
 I P(17)="O" S PSGACT="L" S:+X PSGACT="DOL"
"RTN","PSJLIORD",49,0)
 I P(17)="N" S PSGACT="EL" S:+X PSGACT="DELV"
"RTN","PSJLIORD",50,0)
 S PSGACT=PSGACT_$P(X,U,2)
"RTN","PSJLIORD",51,0)
 Q
"RTN","PSJLIORD",52,0)
UDVARS ;* Remove un-use variables.
"RTN","PSJLIORD",53,0)
 K PSGCANFL,PSGDI,PSGDO,PSGEB,PSGEBN,PSGFD,PSGFDN,PSHSM,PSGLI
"RTN","PSJLIORD",54,0)
 K PSGLIN,PSGLMT,PSGMR,PSGMRN,PSGNEF,PSGOAT
"RTN","PSJLIORD",55,0)
 K PSGODO,PSGODT,PSGOEA,PSGOEAV,PSGOEEWF,PSGOENG,PSGOFD,PSGOFDN
"RTN","PSJLIORD",56,0)
 K PSGOHSM,PSGOINST,PSGOMR,PSGOMRN,PSGONC,PSGOPD,PSGOPDN,PSGOPR
"RTN","PSJLIORD",57,0)
 K PSGOPRN,PSGOSCH,PSGOSD,PSGOSDN,PSGOSI,PSGOSM,PSGOST,PSGOSTN
"RTN","PSJLIORD",58,0)
 K PSGPD,PSGPDN,PSGPI,PSGPR,PSGPRIO,PSGPRN,PSGPTMP,PSGRRF,PSGS0XT
"RTN","PSJLIORD",59,0)
 K PSGS0Y,PSGSCH,PSGSD,PSGSDN,PSGSI,PSGSM,PSGST,PSGSTAT,PSGSTN
"RTN","PSJLIORD",60,0)
 K PSGEFN,PSGOEFN,PSGOEEF,PSGOEEG,PSGOEEND,PSGPDRG,PSGPDRGN
"RTN","PSJLIORD",61,0)
 K PSGNESDO,PSGNODE,PSGOEDMR,PSGOEPR,PSGPEN,PSGPENWS
"RTN","PSJLIORD",62,0)
 Q
"RTN","PSJLIORD",63,0)
CHKKEYS()  ;* Check for users' key to set up appropriate actions
"RTN","PSJLIORD",64,0)
 ;Output:
"RTN","PSJLIORD",65,0)
 ;  X=a^b
"RTN","PSJLIORD",66,0)
 ;  a=1 for either RN or Pharmacist; 0 for other
"RTN","PSJLIORD",67,0)
 ;  b="V" if not verified by key owner
"RTN","PSJLIORD",68,0)
 S XX=$G(^PS(55,DFN,"IV",+ON,4)),X=0
"RTN","PSJLIORD",69,0)
 I +PSJSYSU=3 S X=1 D
"RTN","PSJLIORD",70,0)
 . I '+$P(XX,U,4) S $P(X,U,2)="V"
"RTN","PSJLIORD",71,0)
 . I $L($T(EN1^ORCFLAG)) S $P(X,U,2)=$P(X,U,2)_"G"
"RTN","PSJLIORD",72,0)
 I +PSJSYSU=1 S X=1 D
"RTN","PSJLIORD",73,0)
 . I '+XX S $P(X,U,2)="V"
"RTN","PSJLIORD",74,0)
 Q X
"RTN","PSJLIUTL")
0^88^B50013699
"RTN","PSJLIUTL",1,0)
PSJLIUTL ;BIR/MV-IV LM utilities modules ;25 APR 00 / 4:28 PM
"RTN","PSJLIUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**39,50,58,81,85,110**;16 DEC 97
"RTN","PSJLIUTL",3,0)
 ;
"RTN","PSJLIUTL",4,0)
 ; Reference to ^ORD(101 is supported by DBIA #872.
"RTN","PSJLIUTL",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJLIUTL",6,0)
 ; Reference to ES^ORX8 is supported by DBIA #3632.
"RTN","PSJLIUTL",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJLIUTL",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJLIUTL",9,0)
 ;
"RTN","PSJLIUTL",10,0)
 ; NFI changes for FR#2@wrtdrg(drgt)
"RTN","PSJLIUTL",11,0)
FLDNO(X,COL)    ; Display the number next to the field name.
"RTN","PSJLIUTL",12,0)
 ;
"RTN","PSJLIUTL",13,0)
 ; X=Text; COL=Column to start from
"RTN","PSJLIUTL",14,0)
 ;
"RTN","PSJLIUTL",15,0)
 S:'$D(PSJSTAR) PSJSTAR=""
"RTN","PSJLIUTL",16,0)
 NEW PSJOLDOT S PSJOLDOT=P("OT") D GTOT^PSIVUTL(P(4))
"RTN","PSJLIUTL",17,0)
 S X=$S((X="(3)"&(P("OT")="I")):" ",PSJSTAR[X:"*",1:" ")_X
"RTN","PSJLIUTL",18,0)
 S PSJL=$$SETSTR^VALM1($S(($G(PSJHIS)&(ON'=PSJORD)):"",1:X),PSJL,COL,5)
"RTN","PSJLIUTL",19,0)
 Q
"RTN","PSJLIUTL",20,0)
 ;
"RTN","PSJLIUTL",21,0)
LONG(Y,COL,LEN) ; Display long fields.
"RTN","PSJLIUTL",22,0)
 ;
"RTN","PSJLIUTL",23,0)
 ; Y=Text string; COL=Start prt at this col; LEN=Total lenght per line.
"RTN","PSJLIUTL",24,0)
 ;
"RTN","PSJLIUTL",25,0)
 N STRLEN,STR S STR="",STRLEN=1
"RTN","PSJLIUTL",26,0)
 ; If string has no blank space.
"RTN","PSJLIUTL",27,0)
 I $L(Y," ")=1,$L(Y)>LEN D  Q
"RTN","PSJLIUTL",28,0)
 . S LINE=$L(Y)\LEN+$S($L(Y)#LEN:1,1:0)
"RTN","PSJLIUTL",29,0)
 . F X=1:1:LINE-1 D
"RTN","PSJLIUTL",30,0)
 . . S PSJL=$$SETSTR^VALM1($E(Y,STRLEN,LEN*X),PSJL,COL,LEN)
"RTN","PSJLIUTL",31,0)
 . . D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL="",STRLEN=LEN*X+1
"RTN","PSJLIUTL",32,0)
 . S PSJL=$$SETSTR^VALM1($E(Y,STRLEN,LEN*LINE),PSJL,COL,LEN)
"RTN","PSJLIUTL",33,0)
 ;
"RTN","PSJLIUTL",34,0)
 F X=1:1:$L(Y," ") D
"RTN","PSJLIUTL",35,0)
 . I $L(STR)+$L($P(Y," ",X))>LEN D
"RTN","PSJLIUTL",36,0)
 . . S PSJL=$$SETSTR^VALM1(STR,PSJL,COL,LEN)
"RTN","PSJLIUTL",37,0)
 . . D SETTMP^PSJLMPRU("PSJI",PSJL) S (STR,PSJL)=""
"RTN","PSJLIUTL",38,0)
 . S STR=STR_$P(Y," ",X)_" "
"RTN","PSJLIUTL",39,0)
 S PSJL=$$SETSTR^VALM1(STR,PSJL,COL,LEN)
"RTN","PSJLIUTL",40,0)
 Q
"RTN","PSJLIUTL",41,0)
 ;
"RTN","PSJLIUTL",42,0)
WRTDRG(DRGT) ; Print AD/SOL drugs for "backdoor" view.
"RTN","PSJLIUTL",43,0)
 NEW DRGX,PSJIVIEN,PSJX
"RTN","PSJLIUTL",44,0)
 F DRGX=0:0 S DRGX=$O(DRG(DRGT,DRGX)) Q:'DRGX  D
"RTN","PSJLIUTL",45,0)
 . S (PSJIVIEN,X)=$G(DRG(DRGT,DRGX)) I DRGT="SOL",$P($G(^PS(52.7,+X,0)),U,4)]"" S $P(X,U,2)=$P(X,U,2)_" "_$P(^(0),U,4)
"RTN","PSJLIUTL",46,0)
 . S PSJL="",PSJX=$S($P(X,U,2)]"":$P(X,U,2)_" "_$P(X,U,3)_" "_$P(X,U,4),1:"*** Undefined ***")
"RTN","PSJLIUTL",47,0)
 . NEW PSJNF D NFIV^PSJDIN($S(DRGT="AD":52.6,1:52.7),+PSJIVIEN,.PSJNF)
"RTN","PSJLIUTL",48,0)
 . S PSJX=PSJX_PSJNF("NF")
"RTN","PSJLIUTL",49,0)
 . S PSJL=$$SETSTR^VALM1(PSJX,PSJL,8,72)
"RTN","PSJLIUTL",50,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIUTL",51,0)
 . ;PSJLMX is newed in AD^PSJLIVMD & AD^PSJLIVFD.  This var count # of ad/sol so we knows
"RTN","PSJLIUTL",52,0)
 . ;which line to blink the Requested start/stop dates.
"RTN","PSJLIUTL",53,0)
 . S PSJLMX=$G(PSJLMX)+1
"RTN","PSJLIUTL",54,0)
 Q
"RTN","PSJLIUTL",55,0)
 ;
"RTN","PSJLIUTL",56,0)
WTPC ; Write provider comments.
"RTN","PSJLIUTL",57,0)
 ;F PSIVX=0:0 S PSIVX=$O(^PS(53.45,PSIVUP,4,PSIVX)) Q:'PSIVX!$D(DUOUT)!$D(DTOUT)  S Y=$G(^PS(53.45,PSIVUP,4,PSIVX,0)) D LONG(Y,22,58) D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIUTL",58,0)
 Q:$G(PSIVCHG)=1
"RTN","PSJLIUTL",59,0)
 I $G(PSJORD),PSJORD["P" F PSIVX=0:0 S PSIVX=$O(^PS(53.1,+PSJORD,12,PSIVX)) Q:'PSIVX!$D(DUOUT)!$D(DTOUT)  S Y=$G(^PS(53.1,+PSJORD,12,PSIVX,0)) D LONG(Y,22,58) D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIUTL",60,0)
 I $G(PSJORD),PSJORD'["P" F PSIVX=0:0 S PSIVX=$O(^PS(55,DFN,"IV",+PSJORD,5,PSIVX)) Q:'PSIVX!$D(DUOUT)!$D(DTOUT)  S Y=$G(^PS(55,DFN,"IV",+PSJORD,5,PSIVX,0)) D LONG(Y,22,58) D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIUTL",61,0)
 Q
"RTN","PSJLIUTL",62,0)
 ;
"RTN","PSJLIUTL",63,0)
TYPE() ; IV Type
"RTN","PSJLIUTL",64,0)
 S X=$$CODES^PSIVUTL(P(4),53.1,53) S X=$S($E(X)="C":"CHEMO",1:X)_$S(P(23)'="":" ("_P(23)_")",1:"")_$S(P(5)=1:" (I)",P(5)=0:"(C)",1:"")
"RTN","PSJLIUTL",65,0)
 Q X
"RTN","PSJLIUTL",66,0)
 ;
"RTN","PSJLIUTL",67,0)
STARTDT() ; Start Date
"RTN","PSJLIUTL",68,0)
 S X="" I $D(PSIVNUM) S:P("DTYP") X=$S(P(17)="P"!(PSIVAC="PN"):" ",1:"*")_$S(P("DTYP")=1:"(12)",$E(P("OT"))="I":"(10)",1:"(8)")
"RTN","PSJLIUTL",69,0)
 Q $$ENDTC^PSGMI(P(2))
"RTN","PSJLIUTL",70,0)
 ;
"RTN","PSJLIUTL",71,0)
STOPDT() ; Stop Date
"RTN","PSJLIUTL",72,0)
 S X="" I $D(PSIVNUM) S:P("DTYP") X=$S(P(17)="P"!(PSIVAC="PN"):" ",1:"*")_$S(P("DTYP")=1:"(13)",$E(P("OT"))="I":"(11)",1:"(9)")
"RTN","PSJLIUTL",73,0)
 Q $$ENDTC^PSGMI(P(3))
"RTN","PSJLIUTL",74,0)
 ;
"RTN","PSJLIUTL",75,0)
PROVIDER() ; Provider
"RTN","PSJLIUTL",76,0)
 S X="" I $D(PSIVNUM),P("DTYP") S X=$S(PSIVAC="PN":" ",1:"*")_$S(P("DTYP")=1:"(14)",$E(P("OT"))="I":"(12)",1:"(10)") ;I P(17)="P",(+P("CLRK")=+P(6)) S X=""
"RTN","PSJLIUTL",77,0)
 I $G(P(21))]"",$L($T(ES^ORX8)) N ESIG,ESIG1 S ESIG=P("NAT"),ESIG1=$$ES^ORX8(+P(21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLIUTL",78,0)
 S X=$S($P(P(6),U,2)]"":$E($P(P(6),U,2),1,23),1:"*** Undefined") S:$G(ESIG)]"" X=X_" ["_$$LOW^XLFSTR(ESIG)_"]"
"RTN","PSJLIUTL",79,0)
 Q X
"RTN","PSJLIUTL",80,0)
WDTE(Y) ; Format and print date.
"RTN","PSJLIUTL",81,0)
 I 'Y S Y=""
"RTN","PSJLIUTL",82,0)
 E  X ^DD("DD") S Y=$P(Y,"@")_" "_$P($P(Y,"@",2),":",1,2)
"RTN","PSJLIUTL",83,0)
 Q Y
"RTN","PSJLIUTL",84,0)
 ;
"RTN","PSJLIUTL",85,0)
ACTIONS()          ;
"RTN","PSJLIUTL",86,0)
 N DIC,X,Y
"RTN","PSJLIUTL",87,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLIUTL",88,0)
 I Y="PSJI LM DISCONTINUE" Q $S(PSGACT["D":1,1:0)
"RTN","PSJLIUTL",89,0)
 I Y="PSJI LM EDIT" Q $S(PSGACT["E":1,1:0)
"RTN","PSJLIUTL",90,0)
 I Y="PSJI PC RENEWAL" Q $S(PSGACT["R":1,1:0)
"RTN","PSJLIUTL",91,0)
 I Y="PSJI PC HOLD" Q $S(PSGACT["H":1,1:0)
"RTN","PSJLIUTL",92,0)
 I Y="PSJI PC ONCALL" Q $S(PSGACT["O":1,1:0)
"RTN","PSJLIUTL",93,0)
 I Y="PSJI LM VERIFY" Q $S(PSGACT["V":1,1:0)
"RTN","PSJLIUTL",94,0)
 I Y="PSJ LM FLAG" Q $S(PSGACT["G":1,1:0)
"RTN","PSJLIUTL",95,0)
 Q 1
"RTN","PSJLIUTL",96,0)
 ;
"RTN","PSJLIUTL",97,0)
ACT() ;
"RTN","PSJLIUTL",98,0)
 NEW Y
"RTN","PSJLIUTL",99,0)
 S Y=$P($G(^ORD(101,+$G(^ORD(101,DA(1),10,DA,0)),0)),U) I Y="" Q 0
"RTN","PSJLIUTL",100,0)
 I $G(PSJHIDFG),(Y="PSJ LM NEW ORDER") Q 0
"RTN","PSJLIUTL",101,0)
 I Y="PSJ LM NEW ORDER FROM PROFILE" Q $S($G(PSIVBR)="D ^PSIVOPT":1,1:0)
"RTN","PSJLIUTL",102,0)
 Q 1
"RTN","PSJLIUTL",103,0)
 ;
"RTN","PSJLIUTL",104,0)
REQDT(ORDER) ;
"RTN","PSJLIUTL",105,0)
 Q:$G(ORDER)'["P"  N ND0,PARENT I '$D(PSGRDTX(+ORDER)) K PSGRDTX
"RTN","PSJLIUTL",106,0)
 S PSGRDTX=$G(^PS(53.1,+ORDER,2.5)),ND0=$G(^PS(53.1,+ORDER,0)),PARENT=$P($G(^PS(53.1,+ORDER,.2)),"^",8),(PSGRSD,PSGRSDN,PSGRFD,PSGRFDN)=""
"RTN","PSJLIUTL",107,0)
 Q:'$G(PSGRDTX)  I '$P(PSGRDTX,"^",3)&'PARENT Q  ; Complex orders (duration OR parent) only?
"RTN","PSJLIUTL",108,0)
 I $P(ND0,U,9)'["P"!($P(ND0,U,24)="R") K PSGRDTX,PSGRFD,PSGRFDN Q
"RTN","PSJLIUTL",109,0)
 S $P(PSGRDTX,U,4)=ORDER
"RTN","PSJLIUTL",110,0)
 S PSGSD=$S($G(P(2)):P(2),1:$G(PSGSD)) I $L(PSGSD)>6 S PSGSD=$$DATE2^PSJUTL2(PSGSD)
"RTN","PSJLIUTL",111,0)
 S PSGFD=$S($G(P(3)):P(3),1:$G(PSGFD)) I $L(PSGFD)>6 S PSGFD=$$DATE2^PSJUTL2(PSGFD)
"RTN","PSJLIUTL",112,0)
 I $G(PSGSD),$G(PSGRDTX(+ORDER,"PSGSD")) I (","_PSGRDTX(+ORDER,"PSGSD")_","_PSGRDTX(+ORDER,"PSGRSD")_",")'[(","_PSGSD_",") D
"RTN","PSJLIUTL",113,0)
 . S PSGRDTX(+ORDER,"PSGSD")=PSGSD
"RTN","PSJLIUTL",114,0)
 I $G(PSGFD),$G(PSGRDTX(+ORDER,"PSGFD")) I (","_PSGRDTX(+ORDER,"PSGFD")_","_PSGRDTX(+ORDER,"PSGRFD")_",")'[(","_PSGFD_",") D
"RTN","PSJLIUTL",115,0)
 . S PSGRDTX(+ORDER,"PSGFD")=PSGFD
"RTN","PSJLIUTL",116,0)
 I $G(PSGSD),'$G(PSGRDTX(+ORDER,"PSGSD")) D
"RTN","PSJLIUTL",117,0)
 . S PSGRSD=$S($G(PSGRDTX(+ORDER,"PSGRSD")):PSGRDTX(+ORDER,"PSGRSD"),1:$P(PSGRDTX,U)) Q:'PSGRSD
"RTN","PSJLIUTL",118,0)
 . S A=PSGRSD,PSGRSD=PSGSD,PSGSD=A
"RTN","PSJLIUTL",119,0)
 . S PSGRDTX(+ORDER,"PSGRSD")=PSGRSD,PSGRDTX(+ORDER,"PSGSD")=PSGSD I $G(P(4))]"",PSGSD]"" S P(2)=PSGSD
"RTN","PSJLIUTL",120,0)
 . I PARENT,($P($G(PSGSRDTX),"^",3)="") S PSGNESD=PSGSD
"RTN","PSJLIUTL",121,0)
 I $G(PSGFD),'$G(PSGRDTX(+ORDER,"PSGFD")) D
"RTN","PSJLIUTL",122,0)
 . S PSGRFD=$S($D(PSGRDTX(+ORDER,"PSGRFD")):PSGRDTX(+ORDER,"PSGRFD"),1:$P(PSGRDTX,U,3)) Q:'PSGRFD
"RTN","PSJLIUTL",123,0)
 . S A=PSGRFD,PSGRFD=$S($G(PSGFD):PSGFD,1:$G(PSGNEFD)),PSGFD=A
"RTN","PSJLIUTL",124,0)
 . S PSGRDTX(+ORDER,"PSGRFD")=PSGRFD,(PSGNEFD,PSGRDTX(+ORDER,"PSGFD"))=PSGFD I $G(P(4))]"",PSGFD]"" S P(3)=PSGFD
"RTN","PSJLIUTL",125,0)
 S PSGSD=$S($G(PSGRDTX(+ORDER,"PSGSD")):PSGRDTX(+ORDER,"PSGSD"),1:$G(PSGSD)) I $G(P(4))]"",$L(PSGSD)>6 S P(2)=$$DATE2^PSJUTL2(PSGSD)
"RTN","PSJLIUTL",126,0)
 I $G(PSGSD) S PSGSDN=$$ENDD^PSGMI(PSGSD)_U_$$ENDTC^PSGMI(PSGSD)
"RTN","PSJLIUTL",127,0)
 S PSGRSD=$S($G(PSGRDTX(+ORDER,"PSGRSD")):PSGRDTX(+ORDER,"PSGRSD"),1:$G(PSGRSD))
"RTN","PSJLIUTL",128,0)
 I $G(PSGRSD) S PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIUTL",129,0)
 I $G(PSGRDTX(+ORDER,"PSGFD")),$G(PSGSD) I PSGSD>PSGRDTX(+ORDER,"PSGFD") N DUR S DUR=$P($G(PSGRDTX),U,2) D
"RTN","PSJLIUTL",130,0)
 . N DURMIN S DURMIN=$$DURMIN^PSJLIVMD(DUR) S (PSGFD,PSGRDTX(+ORDER,"PSGFD"))=$$FMADD^XLFDT(PSGSD,,,$S(DURMIN:DURMIN,1:1440))
"RTN","PSJLIUTL",131,0)
 S PSGFD=$S($G(PSGRDTX(+ORDER,"PSGFD")):PSGRDTX(+ORDER,"PSGFD"),1:$G(PSGFD)) D
"RTN","PSJLIUTL",132,0)
 . I PSGFD<PSGSD,$G(PSGFD),ORDER'["V" N PSGST I $G(DFN) S PSGST=$S(PSGORD["P":$P(^PS(53.1,+PSGORD,0),"^",7),1:$P(^PS(55,DFN,5,+PSGORD,0),"^",7)) D
"RTN","PSJLIUTL",133,0)
 .. D ENFD^PSGNE3(PSGSD) I PSGNEFD>PSGSD S PSGFD=PSGNEFD
"RTN","PSJLIUTL",134,0)
 . I PSGFD<PSGSD,$G(PSGFD),ORDER["V" D ENSTOP^PSIVCAL I P(3)>P(2) S PSGFD=P(3)
"RTN","PSJLIUTL",135,0)
 . I $G(P(4))]"",$L(PSGFD)>6 S P(3)=$$DATE2^PSJUTL2(PSGFD)
"RTN","PSJLIUTL",136,0)
 I $G(PSGFD) S PSGFDN=$$ENDD^PSGMI(PSGFD)_U_$$ENDTC^PSGMI(PSGFD)
"RTN","PSJLIUTL",137,0)
 S PSGRFD=$S($G(PSGRDTX(+ORDER,"PSGRFD")):PSGRDTX(+ORDER,"PSGRFD"),1:$G(PSGRFD))
"RTN","PSJLIUTL",138,0)
 I $G(PSGRFD) S PSGRFDN=$$ENDTC^PSGMI(PSGRFD)
"RTN","PSJLIUTL",139,0)
 Q
"RTN","PSJLIVFD")
0^91^B37889960
"RTN","PSJLIVFD",1,0)
PSJLIVFD ;BIR/MV-SETUP LM TEMPLATE FOR IV FLUID ;4 Aug 00 / 2:37 PM
"RTN","PSJLIVFD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,50,63,64,58,81,91,80,116,110**;16 DEC 97
"RTN","PSJLIVFD",3,0)
 ;
"RTN","PSJLIVFD",4,0)
 ; Reference to ^VALM0 is supported by DBIA # 2615.
"RTN","PSJLIVFD",5,0)
 ;
"RTN","PSJLIVFD",6,0)
 ;NFI changes for FR# 3@AD+4
"RTN","PSJLIVFD",7,0)
 ;
"RTN","PSJLIVFD",8,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVFD",9,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVFD",10,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVFD",11,0)
 S PSJLN=1
"RTN","PSJLIVFD",12,0)
AD ;
"RTN","PSJLIVFD",13,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVFD",14,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVFD",15,0)
 S PSJL=PSJL_"Additives:"
"RTN","PSJLIVFD",16,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,30,14)_+P("PON")
"RTN","PSJLIVFD",17,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVFD",18,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVFD",19,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVFD",20,0)
 I '$D(IORVON),$D(IOST(0)) D ENS^%ZISS,TERM^VALM0
"RTN","PSJLIVFD",21,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVFD",22,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",23,0)
 D:+$G(PSJLMX) CLRDSPL^PSJLIVMD
"RTN","PSJLIVFD",24,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVFD",25,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVFD",26,0)
SOL ;
"RTN","PSJLIVFD",27,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVFD",28,0)
 S PSJL=PSJL_"Solutions:"
"RTN","PSJLIVFD",29,0)
 I P("SYRS")]"" D
"RTN","PSJLIVFD",30,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,10)_$E(P("SYRS"),1,13)
"RTN","PSJLIVFD",31,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVFD",32,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",33,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVFD",34,0)
DUR ;
"RTN","PSJLIVFD",35,0)
 S PSJL=""
"RTN","PSJLIVFD",36,0)
 S PSJL=$$SETSTR^VALM1("Duration: ",PSJL,12,10)
"RTN","PSJLIVFD",37,0)
 S PSJL=PSJL_$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVFD",38,0)
START ;
"RTN","PSJLIVFD",39,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVFD",40,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVFD",41,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",42,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVFD",43,0)
 S PSJL="" I $G(PSJORD)["P",$G(PSGRDTX) D
"RTN","PSJLIVFD",44,0)
 . N RSDLABL,PSJRQB,PSJRQL,PSGRSD,PSGSRSDN
"RTN","PSJLIVFD",45,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVFD",46,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVFD",47,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVFD",48,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVFD",49,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT^PSJLIVMD(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL),SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",50,0)
INFRATE ;
"RTN","PSJLIVFD",51,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVFD",52,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVFD",53,0)
 D LONG^PSJLIUTL(P(8),22,24)
"RTN","PSJLIVFD",54,0)
LASTREN ;
"RTN","PSJLIVFD",55,0)
 N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGRNDT D
"RTN","PSJLIVFD",56,0)
 . S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVFD",57,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",58,0)
MR ;
"RTN","PSJLIVFD",59,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVFD",60,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVFD",61,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVFD",62,0)
STOP ;
"RTN","PSJLIVFD",63,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVFD",64,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$$STOPDT^PSJLIUTL
"RTN","PSJLIVFD",65,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",66,0)
 S PSJL=""
"RTN","PSJLIVFD",67,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(DFN,PSJORD)
"RTN","PSJLIVFD",68,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVFD",69,0)
 ;D:$G(PSGRFD) DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," REQUESTED STOP: ",P(3)'=PSGRFD)
"RTN","PSJLIVFD",70,0)
 I $G(PSGRDTX(+PSJORD,"PSGRFD")) S PSGRFD=PSGRDTX(+PSJORD,"PSGRFD"),PSGRFDN=$$ENDTC^PSGMI(PSGRFD) D
"RTN","PSJLIVFD",71,0)
 . D DSPLYDT^PSJLIVMD(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",0,51,29)
"RTN","PSJLIVFD",72,0)
 D:($G(PSJBCMA)]"")!($G(PSGRFD)]"") SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",73,0)
SCH ;
"RTN","PSJLIVFD",74,0)
 K SCHMSG I $G(PSJNSS),$$SCHREQ(.P),$G(P(15)) S SCHMSG=$$NSO^PSGS0(P(15)) S:SCHMSG]"" SCHMSG=" ("_SCHMSG_")"
"RTN","PSJLIVFD",75,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVFD",76,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVFD",77,0)
 D LONG^PSJLIUTL(P(9),22,32) S PSJL=PSJL_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG)
"RTN","PSJLIVFD",78,0)
LASTFL ;
"RTN","PSJLIVFD",79,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVFD",80,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVFD",81,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",82,0)
ADM ;
"RTN","PSJLIVFD",83,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVFD",84,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVFD",85,0)
 D LONG^PSJLIUTL(P(11),22,30)
"RTN","PSJLIVFD",86,0)
QTY ;
"RTN","PSJLIVFD",87,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVFD",88,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",89,0)
PROVIDER ;
"RTN","PSJLIVFD",90,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVFD",91,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVFD",92,0)
CUMDOSES ;
"RTN","PSJLIVFD",93,0)
 ;S PSJL=$$SETSTR^VALM1("Cumulative Doses:",PSJL,45,17)_P("CUM")
"RTN","PSJLIVFD",94,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVFD",95,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",96,0)
OPI ;
"RTN","PSJLIVFD",97,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVFD",98,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVFD",99,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",100,0)
PC ;
"RTN","PSJLIVFD",101,0)
 S PSJL=""
"RTN","PSJLIVFD",102,0)
 ;S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D SETTMP^PSJLMPRU("PSJI",PSJL) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",103,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVFD",104,0)
REMARK ;
"RTN","PSJLIVFD",105,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",106,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVFD",107,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVFD",108,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVFD",109,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",110,0)
IVROOM ;
"RTN","PSJLIVFD",111,0)
 S PSJL=""
"RTN","PSJLIVFD",112,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVFD",113,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",114,0)
ENTRY ;
"RTN","PSJLIVFD",115,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVFD",116,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,18),1:"*** Undefined")
"RTN","PSJLIVFD",117,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVFD",118,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",119,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVFD",120,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVFD",121,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S(ON["P":28,1:100))_" IV "
"RTN","PSJLIVFD",122,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVFD",123,0)
 I $G(P("PON"))["P" D ORDCHK
"RTN","PSJLIVFD",124,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVFD",125,0)
 Q
"RTN","PSJLIVFD",126,0)
 ;
"RTN","PSJLIVFD",127,0)
ORDCHK ;Display order check for pending order
"RTN","PSJLIVFD",128,0)
 Q:'$O(^PS(53.1,+ON,10,0))
"RTN","PSJLIVFD",129,0)
 NEW PSJIVX,PSJIVXX
"RTN","PSJLIVFD",130,0)
 F PSJIVX=0:0 S PSJIVX=$O(^PS(53.1,+ON,10,PSJIVX)) Q:'PSJIVX  D
"RTN","PSJLIVFD",131,0)
 . D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVFD",132,0)
 . S PSJL="Order Checks       :" D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,0)),22,60)
"RTN","PSJLIVFD",133,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",134,0)
 . S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+ON,10,PSJIVX,1)),U)
"RTN","PSJLIVFD",135,0)
 . D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVFD",136,0)
 . S PSJL="Overriding Reason  : "
"RTN","PSJLIVFD",137,0)
 . F PSJIVXX=0:0 S PSJIVXX=$O(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX)) Q:'PSJIVXX  D
"RTN","PSJLIVFD",138,0)
 .. D LONG^PSJLIUTL($G(^PS(53.1,+ON,10,PSJIVX,2,PSJIVXX,0)),22,60)
"RTN","PSJLIVFD",139,0)
 .. D SETTMP^PSJLMPRU("PSJI",PSJL) S PSJL=""
"RTN","PSJLIVFD",140,0)
 Q
"RTN","PSJLIVFD",141,0)
 ;
"RTN","PSJLIVFD",142,0)
SCHREQ(IVAR) ;
"RTN","PSJLIVFD",143,0)
 I $G(IVAR(4))="P"!($G(IVAR(23))="P")!($G(IVAR(5))) Q 1
"RTN","PSJLIVFD",144,0)
 Q 0
"RTN","PSJLIVMD")
0^84^B53732989
"RTN","PSJLIVMD",1,0)
PSJLIVMD ;BIR/MV-SETUP LM TEMPLATE FOR INPT MED. IV ;4 Aug 00 / 4:29 PM
"RTN","PSJLIVMD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**37,50,63,58,81,91,80,116,110**;16 DEC 97
"RTN","PSJLIVMD",3,0)
 ;
"RTN","PSJLIVMD",4,0)
EN ; Build LM template to display IV order.
"RTN","PSJLIVMD",5,0)
 D GTOT^PSIVUTL(P(4))
"RTN","PSJLIVMD",6,0)
 S:'$D(PSJSTAR) PSJSTAR="" S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",7,0)
 I $E(P("OT"))'="I" D EN^PSJLIVFD Q
"RTN","PSJLIVMD",8,0)
 K ^TMP("PSJI",$J)
"RTN","PSJLIVMD",9,0)
 S UL80="",$P(UL80,"=",80)=""
"RTN","PSJLIVMD",10,0)
 S PSJLN=1
"RTN","PSJLIVMD",11,0)
 I $G(PSIV531),P("PON")["P" S (P(2),P(3),P(4))=""
"RTN","PSJLIVMD",12,0)
AD ;
"RTN","PSJLIVMD",13,0)
 NEW VALMEVL S VALMEVL=1
"RTN","PSJLIVMD",14,0)
 S PSJL="" D FLDNO^PSJLIUTL("(1)",1)
"RTN","PSJLIVMD",15,0)
 S PSJL=PSJL_" Additives:"
"RTN","PSJLIVMD",16,0)
 S:$G(P("PON"))["V"&(P(17)'="N") PSJL=$$SETSTR^VALM1("Order number:",PSJL,28,14)_+P("PON")
"RTN","PSJLIVMD",17,0)
 S PSJL=$$SETSTR^VALM1("Type:",PSJL,57,6)_$$TYPE^PSJLIUTL
"RTN","PSJLIVMD",18,0)
 NEW PSJVD S PSJVD=$$DINFLIV^PSJDIN(.DRG)
"RTN","PSJLIVMD",19,0)
 S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,6)
"RTN","PSJLIVMD",20,0)
 I $D(IORVON),(PSJVD]"") D CNTRL^VALM10(1,76,5,IORVON,IORVOFF,0) K PSJVD
"RTN","PSJLIVMD",21,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",22,0)
 D:+$G(PSJLMX) CLRDSPL
"RTN","PSJLIVMD",23,0)
 ;PSJLMX count number of lines needed to display the add/sol
"RTN","PSJLIVMD",24,0)
 S PSJLMX=0 D WRTDRG^PSJLIUTL("AD")
"RTN","PSJLIVMD",25,0)
SOL ;
"RTN","PSJLIVMD",26,0)
 S PSJL="" D FLDNO^PSJLIUTL("(2)",1)
"RTN","PSJLIVMD",27,0)
 S PSJL=PSJL_" Solutions:"
"RTN","PSJLIVMD",28,0)
 I P("SYRS")]"" D
"RTN","PSJLIVMD",29,0)
 . S PSJL=$$SETSTR^VALM1("Syr. Size:",PSJL,52,11)_$E(P("SYRS"),1,13)
"RTN","PSJLIVMD",30,0)
 . S:$L(P("SYRS"))>13 PSJL=PSJL_"..."
"RTN","PSJLIVMD",31,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",32,0)
 D WRTDRG^PSJLIUTL("SOL")
"RTN","PSJLIVMD",33,0)
 D DUR
"RTN","PSJLIVMD",34,0)
START ;
"RTN","PSJLIVMD",35,0)
 NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJLIVMD",36,0)
 D REQDT(ON)
"RTN","PSJLIVMD",37,0)
 D FLDNO^PSJLIUTL("(4)",47)
"RTN","PSJLIVMD",38,0)
 S PSJL=$$SETSTR^VALM1("Start:",PSJL,56,7)_$$STARTDT^PSJLIUTL
"RTN","PSJLIVMD",39,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",40,0)
INFRATE ;
"RTN","PSJLIVMD",41,0)
 S PSJL="" D FLDNO^PSJLIUTL("(3)",1)
"RTN","PSJLIVMD",42,0)
 S PSJL=$$SETSTR^VALM1("Infusion Rate:",PSJL,7,15)
"RTN","PSJLIVMD",43,0)
 D LONG^PSJLIUTL(P(8),22,23)
"RTN","PSJLIVMD",44,0)
RSTART ;
"RTN","PSJLIVMD",45,0)
 I $G(ON)["P" N PSGNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) D
"RTN","PSJLIVMD",46,0)
 . I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32) Q
"RTN","PSJLIVMD",47,0)
 . Q:'$G(PSGRDTX)  N PSJRQB,PSJRQL,RSDLABL,PSGRSD,PSGRSDN
"RTN","PSJLIVMD",48,0)
 . S RSDLABL="     REQUESTED START: ",PSJRQB=41,PSJRQL=39,PSGRSD="",PSGRSDN=""
"RTN","PSJLIVMD",49,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$G(P(2)) S PSJRQB=51,PSJRQL=29 D
"RTN","PSJLIVMD",50,0)
 .. S PSGRSD=PSGRDTX(+$G(PSJORD),"PSGRSD"),PSGRSDN=$$ENDTC^PSGMI(+PSGRSD),RSDLABL="Calc Start: "
"RTN","PSJLIVMD",51,0)
 . I '$G(P(2)),'$P(PSGRDTX,U,3) S PSGRSD=+PSGRDTX,PSGRSDN=$$ENDTC^PSGMI(PSGRSD)
"RTN","PSJLIVMD",52,0)
 . I $G(PSGRSD),($G(PSGRSDN)]"") D DSPLYDT(PSJLMX+5,.PSGRSD,.PSGRSDN,RSDLABL,1,PSJRQB,PSJRQL)  ;,SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",53,0)
 I $G(ON)["V" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,ON) I PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,54,32)
"RTN","PSJLIVMD",54,0)
 I PSJL]"" D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",55,0)
 ;
"RTN","PSJLIVMD",56,0)
MR ;
"RTN","PSJLIVMD",57,0)
 S PSJL="" D FLDNO^PSJLIUTL("(5)",1)
"RTN","PSJLIVMD",58,0)
 S PSJL=$$SETSTR^VALM1("Med Route:",PSJL,11,11)
"RTN","PSJLIVMD",59,0)
 S PSJL=PSJL_$P(P("MR"),U,2)
"RTN","PSJLIVMD",60,0)
STOP ;
"RTN","PSJLIVMD",61,0)
 S:'$D(PSGP) PSGP=DFN
"RTN","PSJLIVMD",62,0)
 D FLDNO^PSJLIUTL("(6)",47)
"RTN","PSJLIVMD",63,0)
 S PSJL=$$SETSTR^VALM1("Stop:",PSJL,57,6)_$$STOPDT^PSJLIUTL
"RTN","PSJLIVMD",64,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",65,0)
 S PSJL=""
"RTN","PSJLIVMD",66,0)
 N PSJBCMA S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSJORD)
"RTN","PSJLIVMD",67,0)
 I $G(PSJBCMA)]"",$G(DFN) S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLIVMD",68,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$G(P(3)) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")) D
"RTN","PSJLIVMD",69,0)
 . D DSPLYDT(PSJLMX+7,.PSGRFD,.PSGRFDN," Calc Stop: ",1,51,29)
"RTN","PSJLIVMD",70,0)
 I ($G(PSJBCMA)]"")!($G(PSGRDTX(+$G(PSJORD),"PSGRFD"))&$G(P(3))) D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",71,0)
SCH ;
"RTN","PSJLIVMD",72,0)
 K SCHMSG K PSJNSS I $$SCHREQ^PSJLIVFD(.P),$G(P(9))]"",'$$PRNOK^PSGS0(P(9)),'$$DOW^PSIVUTL(P(9)) D
"RTN","PSJLIVMD",73,0)
 . N PSGS0XT,PSGOES,X,PSJNSS,PSGS0Y S PSJNSS=1,PSGOES=1,X=P(9),PSGS0XT=$G(P(15)) D Q2^PSGS0
"RTN","PSJLIVMD",74,0)
 . I PSJNSS S SCHMSG=$$NSO^PSGS0(P(15)) S:SCHMSG]"" SCHMSG=" ("_SCHMSG_")"
"RTN","PSJLIVMD",75,0)
 S PSJL="" D FLDNO^PSJLIUTL("(7)",1)
"RTN","PSJLIVMD",76,0)
 S PSJL=$$SETSTR^VALM1("Schedule:",PSJL,12,11)
"RTN","PSJLIVMD",77,0)
 D LONG^PSJLIUTL(P(9)_$S(P(7):"@0 labels a day",1:"")_$G(SCHMSG),22,31)
"RTN","PSJLIVMD",78,0)
LASTFL ;
"RTN","PSJLIVMD",79,0)
 S PSJL=$$SETSTR^VALM1("Last Fill:",PSJL,52,11)
"RTN","PSJLIVMD",80,0)
 S PSJL=PSJL_$$ENDTC^PSGMI(P("LF"))
"RTN","PSJLIVMD",81,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",82,0)
ADM ;
"RTN","PSJLIVMD",83,0)
 S PSJL="" D FLDNO^PSJLIUTL("(8)",1)
"RTN","PSJLIVMD",84,0)
 S PSJL=$$SETSTR^VALM1("Admin Times:",PSJL,9,14)
"RTN","PSJLIVMD",85,0)
 NEW NOECH
"RTN","PSJLIVMD",86,0)
 D LONG^PSJLIUTL(P(11),22,29)
"RTN","PSJLIVMD",87,0)
QTY ;
"RTN","PSJLIVMD",88,0)
 S PSJL=$$SETSTR^VALM1("Quantity:",PSJL,53,10)_+P("LFA")
"RTN","PSJLIVMD",89,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",90,0)
PROVIDER ;
"RTN","PSJLIVMD",91,0)
 S PSJL="" D FLDNO^PSJLIUTL("(9)",1)
"RTN","PSJLIVMD",92,0)
 S PSJL=$$SETSTR^VALM1("Provider:",PSJL,12,10)_$$PROVIDER^PSJLIUTL
"RTN","PSJLIVMD",93,0)
CUMDOSES ;
"RTN","PSJLIVMD",94,0)
 S PSJL=$$SETSTR^VALM1("Cum. Doses:",PSJL,51,12)_P("CUM")
"RTN","PSJLIVMD",95,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",96,0)
OI ;
"RTN","PSJLIVMD",97,0)
 S PSJL="" D FLDNO^PSJLIUTL("(10)",1)
"RTN","PSJLIVMD",98,0)
 S PSJL=$$SETSTR^VALM1("Orderable Item:",PSJL,6,16)_$P(P("PD"),U,2)_$$OINF^PSJDIN(+P("PD"))
"RTN","PSJLIVMD",99,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",100,0)
INS ;
"RTN","PSJLIVMD",101,0)
 S PSJL=""
"RTN","PSJLIVMD",102,0)
 S PSJL=$$SETSTR^VALM1("Instructions:",PSJL,8,14)
"RTN","PSJLIVMD",103,0)
 D LONG^PSJLIUTL(P("INS"),22,58)
"RTN","PSJLIVMD",104,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",105,0)
OPI ;
"RTN","PSJLIVMD",106,0)
 S PSJL="" D FLDNO^PSJLIUTL("(11)",1)
"RTN","PSJLIVMD",107,0)
 S PSJL=$$SETSTR^VALM1("Other Print"_$S($P(P("OPI"),"^",2)=1:"!: ",1:": "),PSJL,9,13)_$P(P("OPI"),"^")
"RTN","PSJLIVMD",108,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",109,0)
PC ;
"RTN","PSJLIVMD",110,0)
 S PSJL=""
"RTN","PSJLIVMD",111,0)
 S PSJL=$$SETSTR^VALM1("Provider Comments:",PSJL,3,18) D WTPC^PSJLIUTL
"RTN","PSJLIVMD",112,0)
REMARK ;
"RTN","PSJLIVMD",113,0)
 D SETTMP^PSJLMPRU("PSJI","")
"RTN","PSJLIVMD",114,0)
 S PSJL="" D FLDNO^PSJLIUTL("(12)",1)
"RTN","PSJLIVMD",115,0)
 S PSJL=$$SETSTR^VALM1("Remarks :",PSJL,8,10)
"RTN","PSJLIVMD",116,0)
 D LONG^PSJLIUTL(P("REM"),18,62)
"RTN","PSJLIVMD",117,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",118,0)
IVROOM ;
"RTN","PSJLIVMD",119,0)
 S PSJL=""
"RTN","PSJLIVMD",120,0)
 S PSJL=$$SETSTR^VALM1("IV Room:",PSJL,9,9)_$P(P("IVRM"),U,2)
"RTN","PSJLIVMD",121,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",122,0)
ENTRY ;
"RTN","PSJLIVMD",123,0)
 S PSJL="",PSJL=$$SETSTR^VALM1("Entry By:",PSJL,8,10)
"RTN","PSJLIVMD",124,0)
 S PSJL=PSJL_$S($P(P("CLRK"),U,2)]"":$E($P(P("CLRK"),U,2),1,24),1:"*** Undefined")
"RTN","PSJLIVMD",125,0)
 S PSJL=$$SETSTR^VALM1("Entry Date:",PSJL,51,12)_$$ENDTC^PSGMI(P("LOG"))
"RTN","PSJLIVMD",126,0)
 D SETTMP^PSJLMPRU("PSJI",PSJL)
"RTN","PSJLIVMD",127,0)
 S PSJL="" S PSGLRN=$$LASTRNBY^PSJLMPRI(DFN,$S($G(PSJORD):PSJORD,1:$G(ON))) I PSGLRN D
"RTN","PSJLIVMD",128,0)
 . S PSJL=$$SETSTR^VALM1("Renewed By: ",PSJL,6,12)_$$ENNPN^PSGMI(PSGLRN) D SETTMP^PSJLMPRU("PSJI",PSJL) K PSGLRN
"RTN","PSJLIVMD",129,0)
 S VALM("TITLE")=$$CODES^PSIVUTL(P(17),$S($G(ON)["P":53.1,1:55.01),$S($G(ON)["P":28,1:100))_" IV "
"RTN","PSJLIVMD",130,0)
 I $G(P("PRY"))="D"!($G(P("PON"))["P") S VALM("TITLE")=VALM("TITLE")_$S($G(P("PRY"))="":"",1:"("_$$CODES^PSIVUTL(P("PRY"),53.1,.24)_")")
"RTN","PSJLIVMD",131,0)
 I $G(P("PON"))["P" D ORDCHK^PSJLIVFD
"RTN","PSJLIVMD",132,0)
 S VALMCNT=PSJLN-1,^TMP("PSJI",$J,0)=VALMCNT
"RTN","PSJLIVMD",133,0)
 Q
"RTN","PSJLIVMD",134,0)
DSPLYDT(PSJLN,PSGRDT,PSGRDTN,TXT,PSJFSH,PSJRDBEG,PSJRDLEN)  ;
"RTN","PSJLIVMD",135,0)
 ;LINE   : Line number the Requested Start and Stop dates are display in
"RTN","PSJLIVMD",136,0)
 ;PSGRDT : Either it is the requested start or stop date in FM format
"RTN","PSJLIVMD",137,0)
 ;PSGRDTN: Either it is the requested start or stop date in IPM format
"RTN","PSJLIVMD",138,0)
 ;TXT    : The display text
"RTN","PSJLIVMD",139,0)
 ;PSJFSH     : if it is 1 then flash
"RTN","PSJLIVMD",140,0)
 ;
"RTN","PSJLIVMD",141,0)
 S:'$G(PSJRDBEG) PSJRDBEG=41,PSJRDLEN=39
"RTN","PSJLIVMD",142,0)
 S PSJL=$$SETSTR^VALM1(TXT_PSGRDTN,PSJL,PSJRDBEG,PSJRDLEN)
"RTN","PSJLIVMD",143,0)
 Q
"RTN","PSJLIVMD",144,0)
CLRDSPL ;
"RTN","PSJLIVMD",145,0)
 ;Clear the blinking after edit the pending order.
"RTN","PSJLIVMD",146,0)
 ;Without it more than the requested start and stop dates are blinking at the ac/edit screen
"RTN","PSJLIVMD",147,0)
 ;PSJLMX: # ad/sol counted in WRTDRG^PSJLIUTL
"RTN","PSJLIVMD",148,0)
 Q:'$D(IOBOFF)
"RTN","PSJLIVMD",149,0)
 NEW PSJX
"RTN","PSJLIVMD",150,0)
 F PSJX=5:1:PSJLMX+7 D CNTRL^VALM10(PSJX,36,80,IOBOFF,IOINORM)
"RTN","PSJLIVMD",151,0)
 Q
"RTN","PSJLIVMD",152,0)
REQDT(ORDER)       ;Get requested date if it is a pending order
"RTN","PSJLIVMD",153,0)
 ;ORDER  : Pending Order Number (PSJORD or PSGORD)
"RTN","PSJLIVMD",154,0)
 Q:ORDER'["P"  D REQDT^PSJLIUTL(ORDER)
"RTN","PSJLIVMD",155,0)
 Q
"RTN","PSJLIVMD",156,0)
 ;
"RTN","PSJLIVMD",157,0)
GETDUR(PAT,ORD,PKG,RAW) ;
"RTN","PSJLIVMD",158,0)
 ; PAT= Patient DFN
"RTN","PSJLIVMD",159,0)
 ; ORD= Order #
"RTN","PSJLIVMD",160,0)
 ; PKG= 5(UD), "IV"(IV), "P"(Pending)
"RTN","PSJLIVMD",161,0)
 N ACT,DUR,ND,ND25,F S DUR="",ORD=+ORD
"RTN","PSJLIVMD",162,0)
 I PKG="P" S ND=$G(^PS(53.1,+ORD,0)) D  Q DUR
"RTN","PSJLIVMD",163,0)
 . I ND S ND25=$S(($P(ND,U,15)=PAT):$G(^PS(53.1,+ORD,2.5)),1:"") S DUR=$P(ND25,U,2),DUR=$S($G(RAW):DUR,1:$$FMTDUR(DUR))
"RTN","PSJLIVMD",164,0)
 S F="^PS(55,PAT,PKG,ORD,2.5)" Q:'$D(@(F)) DUR
"RTN","PSJLIVMD",165,0)
 S ND=$G(@(F)) S DUR=$P(ND,U,2) S:'$G(RAW) DUR=$$FMTDUR(DUR)
"RTN","PSJLIVMD",166,0)
 Q DUR
"RTN","PSJLIVMD",167,0)
 ;
"RTN","PSJLIVMD",168,0)
FMTDUR(DURCODE) ;
"RTN","PSJLIVMD",169,0)
 N DUNIT,DNUM,BAD S BAD=0
"RTN","PSJLIVMD",170,0)
 S DUNIT=$E(DURCODE),DNUM=$P(DURCODE,DUNIT,2) I 'DNUM S BAD=1
"RTN","PSJLIVMD",171,0)
 S DUNIT=$S(DUNIT="D":" day",DUNIT="H":" hour",DUNIT="W":" week",DUNIT="L":" month",DUNIT="M":" minute",DUNIT="S":" second",1:"")
"RTN","PSJLIVMD",172,0)
 S:DUNIT="" BAD=1 S:DNUM'=1 DUNIT=DUNIT_"s"
"RTN","PSJLIVMD",173,0)
 Q $S(BAD:"",1:DNUM_DUNIT)
"RTN","PSJLIVMD",174,0)
 ;
"RTN","PSJLIVMD",175,0)
DURMIN(DCOD) ;
"RTN","PSJLIVMD",176,0)
 N DUR,DMIN,CHR S DUR="" F I=1:1:$L(DCOD) S CHR=$E(DCOD,I) I CHR?1N S DUR=DUR_CHR
"RTN","PSJLIVMD",177,0)
 S DMIN=DUR*$S(DCOD["L":43200,DCOD["W":10080,DCOD["M":1,DCOD["S":(1/60),DCOD["D":1440,1:0) S DMIN=+$FN(DMIN,"",1)
"RTN","PSJLIVMD",178,0)
 Q DMIN
"RTN","PSJLIVMD",179,0)
 ;
"RTN","PSJLIVMD",180,0)
DUR ;
"RTN","PSJLIVMD",181,0)
 Q:'$G(PSJORD)  S PSJL=""
"RTN","PSJLIVMD",182,0)
 S PSJL=$$SETSTR^VALM1("Duration: ",PSJL,12,10)
"RTN","PSJLIVMD",183,0)
 S PSJL=PSJL_$$GETDUR^PSJLIVMD(PSGP,+PSJORD,$S(PSJORD["P":"P",1:"IV"))
"RTN","PSJLIVMD",184,0)
 Q
"RTN","PSJLMGUD")
0^85^B29950370
"RTN","PSJLMGUD",1,0)
PSJLMGUD ;BIR/MLM-INITIALIZE UNIT DOSE ORDER FIELDS FOR DISPLAY ;05 Feb 99 / 9:46 AM
"RTN","PSJLMGUD",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**25,58,85,116,110**;16 DEC 97
"RTN","PSJLMGUD",3,0)
 ;
"RTN","PSJLMGUD",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178
"RTN","PSJLMGUD",5,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192 
"RTN","PSJLMGUD",6,0)
 ; Reference to ^PS(55   is supported by DBIA 2191
"RTN","PSJLMGUD",7,0)
 ; Reference to ES^ORX8 is supported by DBIA 3632
"RTN","PSJLMGUD",8,0)
 ;
"RTN","PSJLMGUD",9,0)
GETUD(DFN,PSGORD) ;
"RTN","PSJLMGUD",10,0)
 ;
"RTN","PSJLMGUD",11,0)
EN2 ;
"RTN","PSJLMGUD",12,0)
 N %X,%Y,ND2,DO,DRGI,FD,FL,FQC,NF,ND,PRI,SD,SIG,ST,STD,X,Y,ESIG
"RTN","PSJLMGUD",13,0)
 K GMRAL,P
"RTN","PSJLMGUD",14,0)
 S NF=$S(PSGORD["U":0,PSGORD["A":0,PSGORD["O":0,1:1) I NF,$D(^PS(53.1,+PSGORD,0)),$P(^(0),"^",19),$D(^PS(55,DFN,5,$P(^(0),"^",19))),(+$P(^(0),"^",19)'=+$P(^(0),"^",25)) S PSGORD=+$P(^PS(53.1,+PSGORD,0),"^",19)_"U",NF=0
"RTN","PSJLMGUD",15,0)
 S (FL,Y)="",$P(FL,"-",71)="",PSGOEEWF="^PS("_$S(NF:"53.1,",1:"55,"_DFN_",5,")_+PSGORD_","
"RTN","PSJLMGUD",16,0)
 ; The naked reference on the line below refers to the full reference created by indirect reference to F, where F may refer to ^PS(53.1 or the IV or UD multiple ^PS(55
"RTN","PSJLMGUD",17,0)
 S ND=$G(@(PSGOEEWF_"0)")),ND2=$G(^(2)),PSGEB=$P($G(^(4)),"^",7),PSGOSI=$G(^(6)),SIG=$G(^(6.5)),DO=$G(^(.2)),PSGOINST=$G(^(.3)),ESIG=$P(DO,U,3),PSG14=$P($G(^(14,0)),"^",3)
"RTN","PSJLMGUD",18,0)
 I PSG14 S PSGLRN=$G(@(PSGOEEWF_"14,"_PSG14_",0)"))
"RTN","PSJLMGUD",19,0)
 S PSGOPD=+DO,PSGODO=$P(DO,U,2),PSGOPDN=$$OINAME^PSJLMUTL(+DO),X=$P(DO,U,4),PSGPRIO=$P("STAT^ASAP^ROUTINE^PREOP^TIME CRITICAL^DONE",U,$F("SARPTD",X)-1),PSJPRI=X
"RTN","PSJLMGUD",20,0)
 S PSGOPR=$P(ND,"^",2),PSGOMR=$P(ND,"^",3),PSGOSM=$P(ND,"^",5),PSGOHSM=$P(ND,"^",6),(PSGOST,ST)=$P(ND,"^",7),STT=$P(ND,"^",9),PSGOMRN=$S('PSGOMR:"",1:$P($G(^PS(51.2,PSGOMR,0)),"^")) S:PSGOMRN="" PSGOMRN=PSGOMR
"RTN","PSJLMGUD",21,0)
 S PSGLI=$P(ND,U,16),PSGOSCH=$P(ND2,"^"),(PSGOSD,SD)=$P(ND2,"^",2),(FD,PSGOFD)=$P(ND2,"^",4),(FQC,PSGS0XT)=$P(ND2,"^",6),(PSGOAT,PSGS0Y)=$P(ND2,"^",5)
"RTN","PSJLMGUD",22,0)
 S PSGLIN=$$ENDD^PSGMI(PSGLI)_U_$$ENDTC^PSGMI(PSGLI)
"RTN","PSJLMGUD",23,0)
 I FQC="D",PSGOAT="" S PSGOAT=$E($P(SD,".",2)_"0000",1,4)
"RTN","PSJLMGUD",24,0)
 S PRI=$S('PSGOPR:0,1:$P($G(^VA(200,PSGOPR,"PS")),"^",4)),DRGI=$S(PSGOPD'=+PSGOPD:0,1:+$G(^PSDRUG(+PSGOPD,"I"))) S:PRI PRI=DT'<PRI S:DRGI DRGI=DT'<DRGI
"RTN","PSJLMGUD",25,0)
 S PSGOPRN=$S('PSGOPR:"",1:$P($G(^VA(200,PSGOPR,0)),"^")) S:PSGOPRN="" PSGOPRN=PSGOPR I PSGOSI]"" S PSGOSI=$$ENSET^PSGSICHK(PSGOSI)
"RTN","PSJLMGUD",26,0)
 I $L($T(ES^ORX8)) N ESIG1 S ESIG1=$$ES^ORX8(+$P(ND,U,21)_";1") S:ESIG1=1 ESIG="ES"
"RTN","PSJLMGUD",27,0)
 S PSGOPRN=PSGOPRN_$S(ESIG]"":" ["_$$LOW^XLFSTR(ESIG)_"]",1:"")
"RTN","PSJLMGUD",28,0)
 S PSGEBN=$$ENNPN^PSGMI(PSGEB) S:$P(ND,U,27)="R" STT="R"
"RTN","PSJLMGUD",29,0)
 S X=STT,PSGSTAT=$S(X="":"NOT FOUND",X="DE":"DISCONTINUED (EDIT)",X="DR":"DISCONTINUED (RENEWAL)",X="RE":"REINSTATED",1:$P(X_"^ACTIVE^DISCONTINUED^EXPIRED^HOLD^INCOMPLETE^NON-VERIFIED^PENDING^RENEWED^UNRELEASED","^",$F("ADEHINPRU",X)))
"RTN","PSJLMGUD",30,0)
 ;
"RTN","PSJLMGUD",31,0)
SET ;
"RTN","PSJLMGUD",32,0)
 I STT="P" S (FD,SD,ST)=""
"RTN","PSJLMGUD",33,0)
 S PSGOSTN=$$ENSTN^PSGMI(ST),(PSGOFDN,PSGOSDN)="" I SD S PSGOSDN=$$ENDD^PSGMI(SD)_"^"_$$ENDTC^PSGMI(SD)
"RTN","PSJLMGUD",34,0)
 I FD S PSGOFDN=$$ENDD^PSGMI(FD)_"^"_$$ENDTC^PSGMI(FD)
"RTN","PSJLMGUD",35,0)
 F X="PD","PDN","MR","MRN","ST","STN","SCH","SI","SD","SDN","FD","FDN","SM","HSM","PR","PRN","DO","AT" S @("PSG"_X)=@("PSGO"_X)
"RTN","PSJLMGUD",36,0)
 K ^PS(53.45,PSJSYSP,1),^(2) S %X=PSGOEEWF_"3,",%Y="^PS(53.45,"_PSJSYSP_",1," D %XY^%RCR S %X=PSGOEEWF_"1,",%Y="^PS(53.45,"_PSJSYSP_",2," D %XY^%RCR
"RTN","PSJLMGUD",37,0)
 S $P(^PS(53.45,PSJSYSP,2,0),"^",2)="53.4502P"
"RTN","PSJLMGUD",38,0)
 K PSJNSS I $G(PSGSCH)'="" D  K PSJNSS
"RTN","PSJLMGUD",39,0)
 . ;N PSGS0XT,PSGOES,Y S X=PSGSCH N PSGSCH S PSGSCH="" S:($G(VALMBCK)]"")!'$G(NSFF)!$G(PSJTUD) PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",40,0)
 . N PSGS0XT,Y,PSGOES S X=PSGSCH N PSGSCH S PSGSCH="",PSGOES=1
"RTN","PSJLMGUD",41,0)
 . D ENOS^PSGS0
"RTN","PSJLMGUD",42,0)
 Q
"RTN","PSJLMGUD",43,0)
 ;
"RTN","PSJLMGUD",44,0)
FINISH ;
"RTN","PSJLMGUD",45,0)
 I '$G(PSGS0XT),PSGOSCH]"" D  S $P(^PS(53.1,+PSGORD,2),"^",6)=PSGS0XT
"RTN","PSJLMGUD",46,0)
 .N PSGOES,PSGS0Y S X=PSGOSCH,PSGOES=1 D ENOS^PSGS0
"RTN","PSJLMGUD",47,0)
 S PSGOEFF=PSGOSCH=""+('$O(^PS(53.45,PSJSYSP,2,0))*10) I PSGOEFF S X=$S(PSGOEFF#2:" a SCHEDULE",1:"")_$S(PSGOEFF=11:" and",1:"")_$S(PSGOEFF>9:" at least one DISPENSE DRUG",1:"")_" before it can be finished."
"RTN","PSJLMGUD",48,0)
 I PSGOEFF W $C(7),!!,"PLEASE NOTE: This order must have" F Q=1:1:$L(X," ") S Y=$P(X," ",Q) W:$L(Y)+$X>78 ! W Y," "
"RTN","PSJLMGUD",49,0)
 I PSGOEFF#2 S F1=53.1,MSG=0,Y=$T(35),@("PSGFN(35)="_$P(Y,";",7)),PSGOEEF(+$P(Y,";",3))=1,(PSGOEE,PSGOEEF)=1 W ! D @$P($T(35),";",3) G:'PSGOEE DONE
"RTN","PSJLMGUD",50,0)
 I PSGOEFF>9 S CHK=7 D ENDRG^PSGOEF1(PSGOPD,0) G:CHK DONE
"RTN","PSJLMGUD",51,0)
 I $G(MSG) K DIR S DIR(0)="E" W !! D ^DIR
"RTN","PSJLMGUD",52,0)
 I PSGOEFF D:PSGST="" GTST^PSGOE6(+PSGORD) N XQORM D EN^VALM("PSJ LM OE DISPLAY") G DONE ;D ENW^PSGOEEW
"RTN","PSJLMGUD",53,0)
 ;
"RTN","PSJLMGUD",54,0)
ACCEPT ;
"RTN","PSJLMGUD",55,0)
 D UPD^PSGOEF1 G DONE
"RTN","PSJLMGUD",56,0)
BYPASS ;
"RTN","PSJLMGUD",57,0)
 S PSGCANFL=1 G DONE
"RTN","PSJLMGUD",58,0)
 ;
"RTN","PSJLMGUD",59,0)
EDIT ;    
"RTN","PSJLMGUD",60,0)
 S PSGPDRG=PSGOPD,PSGPDRGN=PSGOPDN K PSGOEEND D ENF^PSGOEE I PSGCANFL=-1 D UPD^PSGOEF1
"RTN","PSJLMGUD",61,0)
 ;
"RTN","PSJLMGUD",62,0)
DONE ;
"RTN","PSJLMGUD",63,0)
 K CHK,DA,DIE,DR,DRG,MSG,ORETURN,ORIFN,PSGEB,PSGEFN,PSGND,PSGOEE,PSGOEEF,PSGOEEND,PSGOEEG,PSGOEF,PSGOEFF,PSGOES,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGPDRG,PSGDRGN,PSG0XT,PSGS0Y,OSGSD,Q1,Q2
"RTN","PSJLMGUD",64,0)
 Q
"RTN","PSJLMGUD",65,0)
 ;
"RTN","PSJLMGUD",66,0)
 ;
"RTN","PSJLMGUD",67,0)
31 ;;101^PSGOE8;PSGOPD;PSGPD;101;1
"RTN","PSJLMGUD",68,0)
32 ;;109^PSGOE8;PSGODO;PSGDO;102;PSGODO]""
"RTN","PSJLMGUD",69,0)
33 ;;3^PSGOE8;PSGOMR;PSGMR;3;1
"RTN","PSJLMGUD",70,0)
34 ;;7^PSGOE8;PSGOST;PSGST;7;0
"RTN","PSJLMGUD",71,0)
35 ;;26^PSGOE8;PSGOSCH;PSGSCH;26;1
"RTN","PSJLMGUD",72,0)
36 ;;39^PSGOE81;PSGOAT;PSGAT;39;0
"RTN","PSJLMGUD",73,0)
37 ;;1^PSGOE82;PSGOPR;PSGPR;1;1
"RTN","PSJLMGUD",74,0)
38 ;;8^PSGOE81;PSGOSI;PSGSI;8;0
"RTN","PSJLMGUD",75,0)
39 ;;2^PSGOE82;;;2;0
"RTN","PSJLMGUD",76,0)
310 ;;40^PSGOE82;;;40;0
"RTN","PSJLMGUD",77,0)
311 ;;66^PSGOE82;;;66;1
"RTN","PSJLMGUD",78,0)
312 ;;10^PSGOE81;PSGOSD;PSGSD;10;0
"RTN","PSJLMGUD",79,0)
313 ;;25^PSGOE81;PSGOFD;PSGFD;25;0
"RTN","PSJLMGUD",80,0)
314 ;;5^PSGOE82;PSGOSM;PSGSM;5;0
"RTN","PSJLMGUD",81,0)
 ;
"RTN","PSJLMGUD",82,0)
AH ;
"RTN","PSJLMGUD",83,0)
 W !!?2,"Answer 'YES' to accept this order as a NON-VERIFIED UNIT DOSE order.  Answer",!,"'NO' to edit this order now.  Enter '^' to BYPASS this order, leaving it as",!,"a PENDING INPATIENT order."
"RTN","PSJLMGUD",84,0)
 Q
"RTN","PSJLMHED")
0^32^B25663526
"RTN","PSJLMHED",1,0)
PSJLMHED ;BIR/MLM-BUILD LM HEADERS ;28 Jan 98 / 2:18 PM
"RTN","PSJLMHED",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,58,85,110**;16 DEC 97
"RTN","PSJLMHED",3,0)
 ;
"RTN","PSJLMHED",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMHED",5,0)
 ; Reference to CWAD^ORQPT2 is supported by DBIA 2831.
"RTN","PSJLMHED",6,0)
 ; Reference to ^SC is supported by DBIA 10040.
"RTN","PSJLMHED",7,0)
 ;
"RTN","PSJLMHED",8,0)
HDR(DFN) ; -- list screen header
"RTN","PSJLMHED",9,0)
 ;   input:       DFN := ifn of pat
"RTN","PSJLMHED",10,0)
 ;  output:  VALMHDR() := hdr array
"RTN","PSJLMHED",11,0)
 ;
"RTN","PSJLMHED",12,0)
 K VAIN,VADM,GMRA,PSJACNWP,PSJ,VAERR,VA,X
"RTN","PSJLMHED",13,0)
 S PSJACNWP=1 D ENBOTH^PSJAC
"RTN","PSJLMHED",14,0)
 ; Commented out due to implement of CWAD
"RTN","PSJLMHED",15,0)
 ;S GMRA="0^0^111" D EN1^GMRADPT,HDRO(DFN)
"RTN","PSJLMHED",16,0)
 D HDRO(DFN)
"RTN","PSJLMHED",17,0)
 S PSJ="   Sex: "_$P(PSJPSEX,U,2),VALMHDR(4)=$$SETSTR^VALM1($S(PSJPDD:"Last ",1:"     ")_"Admitted: "_$P(PSJPAD,U,2),PSJ,45,23)
"RTN","PSJLMHED",18,0)
 ;S PSJ="    Dx: "_PSJPDX,VALMHDR(5)=$$SETSTR^VALM1("Last transferred: "_$$ENDTC^PSGMI(PSJPTD),PSJ,42,26)
"RTN","PSJLMHED",19,0)
 S PSJ="    Dx: "_PSJPDX
"RTN","PSJLMHED",20,0)
 S:PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Discharged: "_$E($P(PSJPDD,U,2),1,8),PSJ,48,26)
"RTN","PSJLMHED",21,0)
 S:'PSJPDD VALMHDR(5)=$$SETSTR^VALM1("Last transferred: "_$$ENDTC^PSGMI(PSJPTD),PSJ,42,26)
"RTN","PSJLMHED",22,0)
 Q
"RTN","PSJLMHED",23,0)
 ;
"RTN","PSJLMHED",24,0)
HDRO(DFN) ; Standardized part of profile header.
"RTN","PSJLMHED",25,0)
 N PSJCLIN,PSJAPPT,PSJCLINN,RMORDT S (PSJCLIN,PSJAPPT)=0,(RMORDAT,PSJCLINN)="" I $G(PSJORD) D
"RTN","PSJLMHED",26,0)
 . S PSJCLIN=$S($G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,"DSS")),$G(PSJORD)["U":$G(^PS(55,DFN,5,+PSJORD,8)),$G(PSJORD)["P":$G(^PS(53.1,+PSJORD,"DSS")),1:"")
"RTN","PSJLMHED",27,0)
 . S:PSJCLIN PSJAPPT=$P($G(PSJCLIN),U,2) I PSJCLIN,PSJAPPT S PSJCLINN=$P($G(^SC(+PSJCLIN,0)),U)
"RTN","PSJLMHED",28,0)
 K VALMHDR I PSJCLINN]"" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1("   Clinic: "_PSJCLINN,PSJ,28,26)
"RTN","PSJLMHED",29,0)
 I PSJCLINN="" S PSJ=VADM(1),PSJ=$$SETSTR^VALM1($S('PSJPDD:"     ",1:"Last ")_"Ward: "_PSJPWDN,PSJ,30,18)
"RTN","PSJLMHED",30,0)
 ;* S:$O(GMRAL(0)) X=IORVON_"<A>"_IORVOFF,PSJ=$$SETSTR^VALM1(X,PSJ,80-$L(X),80) S VALMHDR(1)=PSJ
"RTN","PSJLMHED",31,0)
 S X=$$CWAD^ORQPT2(DFN)
"RTN","PSJLMHED",32,0)
 ;S X=$O(GMRAL(0)) I X S X=$S($P(GMRAL(X),U,2)="NKA":0,1:1)
"RTN","PSJLMHED",33,0)
 S:X]"" X=IORVON_X_IORVOFF,PSJ=$$SETSTR^VALM1(X,PSJ,80-$L(X),80) S VALMHDR(1)=PSJ
"RTN","PSJLMHED",34,0)
 S PSJ="   PID: "_$P(PSJPSSN,U,2)
"RTN","PSJLMHED",35,0)
 S RMORDT=$S($G(PSJPDD):"Last ",1:"     ")_"Room-Bed: "_$G(PSJPRB)
"RTN","PSJLMHED",36,0)
 I PSJCLINN]"",PSJAPPT S RMORDT="Clinic Date: "_$$ENDTC^PSGMI(PSJAPPT),RMORDT=$P(RMORDT,"  ")_" "_$P(RMORDT,"  ",2)
"RTN","PSJLMHED",37,0)
 S PSJ=$$SETSTR^VALM1(RMORDT,PSJ,26,28),VALMHDR(2)=$$SETSTR^VALM1("Ht(cm): "_PSJPHT_" "_PSJPHTD,PSJ,55,25)
"RTN","PSJLMHED",38,0)
 S PSJ="   DOB: "_$P($P(PSJPDOB,U,2)," ")_" ("_PSJPAGE_")",VALMHDR(3)=$$SETSTR^VALM1("Wt(kg): "_PSJPWT_" "_PSJPWTD,PSJ,55,25)
"RTN","PSJLMHED",39,0)
 Q
"RTN","PSJLMHED",40,0)
 ;
"RTN","PSJLMHED",41,0)
INIT(PSJPROT) ; -- init bld vars
"RTN","PSJLMHED",42,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJLMHED",43,0)
 K PSJUDPRF,^TMP("PSJ",$J),^TMP("PSJON",$J),^TMP("PSJPRO",$J)
"RTN","PSJLMHED",44,0)
 S:PSJPROT=1 PSJUDPRF=1
"RTN","PSJLMHED",45,0)
 D KILL^VALM10(),EN^PSJO1(PSJPROT)
"RTN","PSJLMHED",46,0)
 I '$D(^TMP("PSJ",$J)) W !!,?22,"NO ORDERS FOUND FOR "_$S(PSJOL="S":"SHORT",1:"LONG")_" PROFILE." S VALMQUIT=1 D PAUSE^PSJLMUTL Q
"RTN","PSJLMHED",47,0)
 S PSJTF=0,PSJLN=1,PSJEN=1,PSJC="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D
"RTN","PSJLMHED",48,0)
 .S PSJF="^PS("_$S("AO"[PSJC:"55,"_PSGP_",5,",1:"53.1,")
"RTN","PSJLMHED",49,0)
 .I PSJTF'=$E(PSJC,1)!(PSJC="CC")!(PSJC="CD")!(PSJC="BD") D TF S PSJTF=$E(PSJC,1)
"RTN","PSJLMHED",50,0)
 .S PSJST="" F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  D
"RTN","PSJLMHED",51,0)
 ..S PSJS="" F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""  D ON
"RTN","PSJLMHED",52,0)
 S VALMCNT=PSJLN-1 ;,^TMP("PSJPRO",$J,0)=PSJEN
"RTN","PSJLMHED",53,0)
DONE ;
"RTN","PSJLMHED",54,0)
 K PSJC,PSJEN,PSJLN,PSJST,PSJS,CNT,PSJPRI
"RTN","PSJLMHED",55,0)
 Q
"RTN","PSJLMHED",56,0)
 ;
"RTN","PSJLMHED",57,0)
ON ;
"RTN","PSJLMHED",58,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJLMHED",59,0)
 S PSJO="" F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO)   D
"RTN","PSJLMHED",60,0)
 .N PRJPRI S PSJPRI=$S(PSJO["V":$P($G(^PS(55,PSGP,"IV",+PSJO,.2)),"^",4),PSJO["U":$P($G(^PS(55,PSGP,5,+PSJO,.2)),"^",4),1:$P($G(^PS(53.1,+PSJO,.2)),"^",4))
"RTN","PSJLMHED",61,0)
 .;S ^TMP("PSJON",$J,PSJEN)=PSJO,PSJL=$J(PSJEN,4)_$S(PSJPRI="D":"d",1:"") D @$S(PSJO["V":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",PSJO["P":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",1:"PUD^PSJLMPRU(PSGP,PSJO,PSJF,DN)") S ^TMP("PSJPRO",$J,0)=PSJEN,PSJEN=PSJEN+1
"RTN","PSJLMHED",62,0)
 .S ^TMP("PSJON",$J,PSJEN)=PSJO,PSJL=$J(PSJEN,4) D @$S(PSJO["V":"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)",PSJO["U":"PUD^PSJLMPRU(PSGP,PSJO,PSJF,DN)",1:"PIV^PSJLMPRI(PSGP,PSJO,PSJF,DN)") S ^TMP("PSJPRO",$J,0)=PSJEN,PSJEN=PSJEN+1
"RTN","PSJLMHED",63,0)
 Q
"RTN","PSJLMHED",64,0)
 ;
"RTN","PSJLMHED",65,0)
TF ; Set up order type header
"RTN","PSJLMHED",66,0)
 I $D(^TMP("PSJ",$J,PSJC)) D
"RTN","PSJLMHED",67,0)
 .N C,X,Y S C=PSJC,Y="",$P(Y," -",40)=""
"RTN","PSJLMHED",68,0)
 .S X=$S(C="A":"A C T I V E",C["CC":"P E N D I N G   R E N E W A L S",C["CD":"P E N D I N G  C O M P L E X",C["C":"P E N D I N G ",C["BD":"N O N - V E R I F I E D  C O M P L E X",C["B":"N O N - V E R I F I E D",1:"N O N - A C T I V E")
"RTN","PSJLMHED",69,0)
 .S ^TMP("PSJPRO",$J,PSJLN,0)=$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80),PSJLN=PSJLN+1
"RTN","PSJLMHED",70,0)
 .;S ^TMP("PSJPRO",$J,PSJLN,0)=X_$S(PSJC["A":" - - - A C T I V E - - -",PSJC["NZ":" - - P E N D I N G - - -",PSJC["N":" N O N - V E R I F I E D",1:" - N O N - A C T I V E -")_X,PSJLN=PSJLN+1
"RTN","PSJLMHED",71,0)
 ;S TF=$S(PSJC["NZ":TF,PSJC["N":0,1:TF)
"RTN","PSJLMHED",72,0)
 Q
"RTN","PSJLMHED",73,0)
TEST ;
"RTN","PSJLMHED",74,0)
 N X,Y S Y="",$P(Y," -",40)=""
"RTN","PSJLMHED",75,0)
 F X="A C T I V E","P E N D I N G   R E N E W A L S","P E N D I N G ","N O N - V E R I F I E D","N O N - A C T I V E" W !,$E($E(Y,1,(80-$L(X))/2)_" "_X_$E(Y,1,(80-$L(X))/2),1,80)
"RTN","PSJLMHED",76,0)
 Q
"RTN","PSJLMPRI")
0^33^B17556997
"RTN","PSJLMPRI",1,0)
PSJLMPRI ;BIR/MLM-INPATIENT LISTMAN IV PROFILE UTILITIES ;01 JUL 96 / 2:24 PM
"RTN","PSJLMPRI",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**58,85,118,110**;16 DEC 97
"RTN","PSJLMPRI",3,0)
 ;
"RTN","PSJLMPRI",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRI",5,0)
 ;
"RTN","PSJLMPRI",6,0)
PIV(DFN,ON,PSJF,DN)       ;Setup LM display for IV order. 
"RTN","PSJLMPRI",7,0)
 N ND14,DRG,ON55,P,PSJORIFN,TYP,V,X,Y,PSJFLAG S TYP="?" I ON["V" D
"RTN","PSJLMPRI",8,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJLMPRI",9,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMPRI",10,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMPRI",11,0)
 .S P("PRY")=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,4),PSJFLAG=$P($G(^(.2)),U,7)
"RTN","PSJLMPRI",12,0)
 .S ND4=$G(^PS(55,DFN,"IV",+ON,4)),V=$S(P("PRY")="D":"d",1:" ")_$S((+PSJSYSU=1&'+$P(ND4,U)):"->",(+PSJSYSU=3&'+$P(ND4,U,4)):"->",1:"") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRI",13,0)
 .S PSJL=$$SETSTR^VALM1(V,PSJL,6,3)
"RTN","PSJLMPRI",14,0)
 .S ND14=$G(^PS(55,DFN,"IV",+ON,14,0)),ND14=$P(ND14,U,3) S:ND14 ND14=+$G(^(ND14,0))
"RTN","PSJLMPRI",15,0)
 I ON=+ON N PSJEN2,O S PSJEN2=PSJEN,O="" F  S O=$O(^PS(53.1,"ACX",ON,O)) Q:O=""  D
"RTN","PSJLMPRI",16,0)
 .I PSJEN2'=PSJEN S PSJL=$J(PSJEN2,4)
"RTN","PSJLMPRI",17,0)
 .S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+O,O)),U,9),Y=+$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U),PSJFLAG=$P($G(^(.2)),U,7)
"RTN","PSJLMPRI",18,0)
 .D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4)) D @$S($E(P("OT"))'="F":"PUD^PSJLMPRU(DFN,O_""P"",PSJF,DN)",1:"PIV^PSJLMPRI(DFN,O_""P"",PSJF,DN)") S PSJEN2=""
"RTN","PSJLMPRI",19,0)
 I ON["P" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U),PSJFLAG=$P($G(^(.2)),U,7) D  I $E(P("OT"))'="F" D PUD^PSJLMPRU(DFN,ON,PSJF,DN) Q
"RTN","PSJLMPRI",20,0)
 . D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMPRI",21,0)
 . S ND14=$G(^PS(53.1,+ON,14,0)),ND14=$P(ND14,U,3) S:ND14 ND14=+$G(^(ND14,0))
"RTN","PSJLMPRI",22,0)
 I $G(PSJFLAG) D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRI",23,0)
 NEW PSJIVFLG S PSJIVFLG=1
"RTN","PSJLMPRI",24,0)
 S DRG=+$O(DRG("AD",0)) D:DRG PIVAD F  S DRG=$O(DRG("AD",DRG)) Q:'DRG  S PSJL="" D PIVAD
"RTN","PSJLMPRI",25,0)
SOL ;
"RTN","PSJLMPRI",26,0)
 S PSJL=$S($G(PSJIVFLG):PSJL_$S(ON["V":"in",1:"    in"),1:"        in")
"RTN","PSJLMPRI",27,0)
 NEW DRGX,NAME
"RTN","PSJLMPRI",28,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJLMPRI",29,0)
 ;S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:'$G(PSJIVFLG) SETTMP D:$G(PSJIVFLG) PIV1 S PSJL="      "
"RTN","PSJLMPRI",30,0)
 Q
"RTN","PSJLMPRI",31,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMPRI",32,0)
 NEW NAME
"RTN","PSJLMPRI",33,0)
 D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1)
"RTN","PSJLMPRI",34,0)
 I $D(NAME(2)) S PSJL=$$SETSTR^VALM1(NAME(1),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="",PSJL=$$SETSTR^VALM1(NAME(2),PSJL,9,60) D SETTMP
"RTN","PSJLMPRI",35,0)
 I '$D(NAME(2)) S PSJL=$$SETSTR^VALM1(NAME(1),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJLMPRI",36,0)
 Q
"RTN","PSJLMPRI",37,0)
 ;
"RTN","PSJLMPRI",38,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMPRI",39,0)
 K PSJIVFLG
"RTN","PSJLMPRI",40,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMPRI",41,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJLMPRI",42,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJLMPRI",43,0)
 I $G(ND14) S ND14=$$ENDTC^PSGMI((ND14)) S PSJL=$$SETSTR^VALM1(ND14,PSJL,$S($D(PSJEXTP):75,1:72),5) K ND14
"RTN","PSJLMPRI",44,0)
 ;* D SETTMP
"RTN","PSJLMPRI",45,0)
 Q
"RTN","PSJLMPRI",46,0)
SETTMP ;
"RTN","PSJLMPRI",47,0)
 S ^TMP($S($G(PSIVLBNM)]"":PSIVLBNM,1:"PSJPRO"),$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRI",48,0)
 Q
"RTN","PSJLMPRI",49,0)
 ;
"RTN","PSJLMPRI",50,0)
LASTREN(DFN,ON) ;
"RTN","PSJLMPRI",51,0)
 N FIL,RNDT,ND0,ND14 S ND14="" I '$G(ON)!'$G(DFN) Q 0
"RTN","PSJLMPRI",52,0)
 S FIL=$S(ON["P":"^PS(53.1,"_+ON_",14,0)",ON["V":"^PS(55,"_DFN_",""IV"","_+ON_",14,0)",ON["U":"^PS(55,"_DFN_",5,"_+ON_",14,0)",1:"")
"RTN","PSJLMPRI",53,0)
 ; Naked reference below refers to either ^PS(53.1,+ON,14,0), ^PS(55,+ON,5,14,0), or ^PS(55,+ON,5,14,0) created using indirection in variable FIL.
"RTN","PSJLMPRI",54,0)
 Q:FIL="" 0
"RTN","PSJLMPRI",55,0)
 S ND14=$G(@(FIL)) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0))
"RTN","PSJLMPRI",56,0)
 Q ND14
"RTN","PSJLMPRI",57,0)
 ;
"RTN","PSJLMPRI",58,0)
LASTRNBY(DFN,ON) ;
"RTN","PSJLMPRI",59,0)
 N FIL,RNBY,ND0,ND14 S RNBY=""
"RTN","PSJLMPRI",60,0)
 S FIL=$S(ON["P":"^PS(53.1,"_+ON_",14,0)",ON["V":"^PS(55,"_DFN_",""IV"","_+ON_",14,0)",ON["U":"^PS(55,"_DFN_",5,"_+ON_",14,0)",1:"")
"RTN","PSJLMPRI",61,0)
 ; Naked reference below refers to either ^PS(53.1,+ON,14,0), ^PS(55,+ON,5,14,0), or ^PS(55,+ON,5,14,0) created using indirection in variable FIL.
"RTN","PSJLMPRI",62,0)
 Q:FIL="" 0
"RTN","PSJLMPRI",63,0)
 S ND14=$G(@(FIL)) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNBY=$P(ND14,"^",2)
"RTN","PSJLMPRI",64,0)
 Q RNBY
"RTN","PSJLMPRU")
0^86^B13350416
"RTN","PSJLMPRU",1,0)
PSJLMPRU ;BIR/MLM-INPATIENT LISTMAN UD PROFILE UTILITIES ;27 Aug 98 / 8:45 AM
"RTN","PSJLMPRU",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**16,58,85,110**;16 DEC 97
"RTN","PSJLMPRU",3,0)
 ;
"RTN","PSJLMPRU",4,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJLMPRU",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJLMPRU",6,0)
 ;
"RTN","PSJLMPRU",7,0)
PUD(DFN,ON,PSJF,DN) ; Setup LM profile view for UD
"RTN","PSJLMPRU",8,0)
 N PSJFLAG,PSJV
"RTN","PSJLMPRU",9,0)
 ; Naked references on the two lines below refer to full reference ^PS(55,DFN,5,+ON in PSJF using indirection.
"RTN","PSJLMPRU",10,0)
 S ND=$G(@(PSJF_+ON_",0)")),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$G(^(6)),NDP2=$G(^(.2)),PSJFLAG=$P(NDP2,U,7),X=$P(DN,U,2),DO=$S('X:"",1:$G(^(+X))) S:X=.2 DO=$P(DO,U,2)
"RTN","PSJLMPRU",11,0)
 S ND14=$G(@(PSJF_+ON_",14,0)")),RNDT="" I $P(ND14,"^",3) S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^")
"RTN","PSJLMPRU",12,0)
 I "AO"[PSJC D
"RTN","PSJLMPRU",13,0)
 .;S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",14,0)
 .S V='$P(ND4,"^",UDU),PSJL=$$SETSTR^VALM1($S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",19)&$P(ND4,"^",18):"H",$P(ND4,"^",23)&$P(ND4,"^",22):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" "),PSJL,5,1)
"RTN","PSJLMPRU",15,0)
 .;S X=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJLMPRU",16,0)
 .S PSJV=$S($P(NDP2,U,4)="D":"d",1:" ")_$S(+PSJSYSU=1&V:"->",+PSJSYSU=3&V:"->",1:"   ") I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",17,0)
 .S PSJL=$$SETSTR^VALM1(PSJV,PSJL,6,3)
"RTN","PSJLMPRU",18,0)
 ;I $S(PSJC["C":0,1:PSJC["B") S PSJL=$$SETSTR^VALM1($S($P(ND4,"^",12):"D",1:" ")_$S($P(ND,U,4)="I":"",PSJSYSU:"->",1:""),PSJL,6,3)
"RTN","PSJLMPRU",19,0)
 ;I $S(PSJC["C":0,1:PSJC["B") S PSJL=$$SETSTR^VALM1($S($P(ND4,"^",12):"D",1:" ")
"RTN","PSJLMPRU",20,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJLMPRU",21,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJLMPRU",22,0)
 ;S NF=$P(DN,"^",3),WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",23,0)
 S NF="",WS=$S(PSJPWD:$$WS^PSJO(PSJPWD,PSGP,PSJF,+ON),1:0)
"RTN","PSJLMPRU",24,0)
 N PSJDISP F PSJDISP=0:0 S PSJDISP=$O(@(PSJF_+ON_",1,"_PSJDISP_")")) Q:'PSJDISP  D
"RTN","PSJLMPRU",25,0)
 .I $P($G(^PSDRUG(+$P($G(@(PSJF_+ON_",1,"_PSJDISP_",0)")),"^"),0)),"^",9)=1 S NF=1
"RTN","PSJLMPRU",26,0)
 NEW DRUGNAME,PSGID1,SD1,LEN,PSGID1,SD1 S LEN=$S($D(PSJEXPT):8,1:5)
"RTN","PSJLMPRU",27,0)
 F X="PSGID","SD" S @(X_1)=$S(PSJC["C":"*****",1:$E($$ENDTC^PSGMI(@X),1,LEN))
"RTN","PSJLMPRU",28,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMPRU",29,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMPRU",30,0)
 . I PSJX=1 D
"RTN","PSJLMPRU",31,0)
 ..I PSJFLAG D CNTRL^VALM10(PSJLN,1,4,IORVON,IORVOFF,0)
"RTN","PSJLMPRU",32,0)
 ..S PSJL=$$SETSTR^VALM1($S($E(PSJS)="*":$P(PSJS,"^"),1:DRUGNAME(PSJX)),PSJL,9,39)
"RTN","PSJLMPRU",33,0)
 ..S PSJL=$$SETSTR^VALM1($S(PSJC["C":"?",PSJSCHT'="z":PSJSCHT,1:"?"),PSJL,50,3)
"RTN","PSJLMPRU",34,0)
 ..S PSJL=PSJL_PSGID1_"  "_SD1_"  "_$E(STAT,1)_"    "_$S($G(RNDT):$E($$ENDTC^PSGMI(RNDT),1,LEN),1:"")
"RTN","PSJLMPRU",35,0)
 ..I NF!WS!SM!PF S PSJL=$$SETSTR^VALM1($S(NF:"NF ",WS:"WS ",SM:$E("HSM",SM,3),1:""),PSJL,69,3) S:PF PSJL=$$SETSTR^VALM1("*",PSJL,79,1)
"RTN","PSJLMPRU",36,0)
 . I PSJX>1 S PSJL="",PSJL=$$SETSTR^VALM1(DRUGNAME(PSJX),PSJL,11,66)
"RTN","PSJLMPRU",37,0)
 . D SETTMP("PSJPRO",PSJL) I ($P(NDP2,U,4)="S"),STAT="P" D CNTRL^VALM10((PSJLN-1),9,9+$L(PSJL),IOINHI_IOBON,IOINORM,0)
"RTN","PSJLMPRU",38,0)
 D:$P(ND6,"^")]"" PTXT($P(ND6,"^"),"PSJPRO",10,66)
"RTN","PSJLMPRU",39,0)
 Q
"RTN","PSJLMPRU",40,0)
 ;
"RTN","PSJLMPRU",41,0)
PTXT(TXT,SUB,LM,RM) ; Display Instructions/dosage ordered.
"RTN","PSJLMPRU",42,0)
 ;* Input:       TXT = Text to display.
"RTN","PSJLMPRU",43,0)
 ;                       SUB = First subscript for ^TMP node, ** MUST be PSJ namespace **
"RTN","PSJLMPRU",44,0)
 ;                       LM  = Begin display of text after LM spaces.
"RTN","PSJLMPRU",45,0)
 ;                       RM  = Length of display text.
"RTN","PSJLMPRU",46,0)
 ;                       
"RTN","PSJLMPRU",47,0)
 S PSJL="",$P(PSJL," ",LM)="" F X=1:1 S WRD=$P(TXT," ",X) Q:WRD=""  D
"RTN","PSJLMPRU",48,0)
 .I $L(PSJL_" "_WRD)'<RM D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)=""
"RTN","PSJLMPRU",49,0)
 .I $L(PSJL_" "_WRD)'<RM S PSJL=PSJL_" "_$E(WRD,1,(RM-10)) D SETTMP(SUB,PSJL) S PSJL="",$P(PSJL," ",10)="",WRD=$E(WRD,(RM-9),$L(WRD))
"RTN","PSJLMPRU",50,0)
 .S PSJL=PSJL_" "_WRD
"RTN","PSJLMPRU",51,0)
 D SETTMP(SUB,PSJL)
"RTN","PSJLMPRU",52,0)
 Q
"RTN","PSJLMPRU",53,0)
SETTMP(SUB,PSJL) ;
"RTN","PSJLMPRU",54,0)
 S ^TMP(SUB,$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1
"RTN","PSJLMPRU",55,0)
 Q
"RTN","PSJLMUDE")
0^87^B62045724
"RTN","PSJLMUDE",1,0)
PSJLMUDE ;BIR/MLM-SHOW FIELDS FOR EDIT (LISTMAN STYLE) ;01 JUNE 00 / 2:40 PM
"RTN","PSJLMUDE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,47,50,63,64,58,80,116,110**;16 DEC 97
"RTN","PSJLMUDE",3,0)
  ;NFI-UD Fr#:2 chgs@init+4 to display non-formulary (N/F)
"RTN","PSJLMUDE",4,0)
  ;also chgs @init+23
"RTN","PSJLMUDE",5,0)
 ;
"RTN","PSJLMUDE",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJLMUDE",7,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192
"RTN","PSJLMUDE",8,0)
 ; Reference to ^VALM1 is supported by DBIA# 10116
"RTN","PSJLMUDE",9,0)
 ; Reference to ^VALM10 is supported by DBIA# 10117
"RTN","PSJLMUDE",10,0)
 ;
"RTN","PSJLMUDE",11,0)
INIT(PSGP,PSGORD) ;
"RTN","PSJLMUDE",12,0)
 N D,ND,PSJBCMA,PSJL,PSJLM,PSJLN,Q,QQ,PSJDUR K ^TMP("PSJUDE",$J)
"RTN","PSJLMUDE",13,0)
 K:$G(PSJNORD) PSGOEEF S PSJLN=1
"RTN","PSJLMUDE",14,0)
 D CLEAN^VALM10
"RTN","PSJLMUDE",15,0)
 S PSJL=$S($D(PSGEFN(1)):$E(" *",PSGEFN(1)+1)_"(1)",1:"   "),PSJL=$$SETSTR^VALM1("Orderable Item: "_PSGPDN_$$OINF^PSJDIN(PSGPD),PSJL,5,74) D  D SETTMP D:$G(PSGOEEF(108))!($G(PSGOEEF(101))) HILITE(1)
"RTN","PSJLMUDE",16,0)
 . NEW Q,PSJDDA,PSJVD F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S PSJDDA(+$G(^(Q,0)))=""
"RTN","PSJLMUDE",17,0)
 . S PSJVD=$$DINFLUD^PSJDIN(PSGPD,.PSJDDA)
"RTN","PSJLMUDE",18,0)
 . S PSJL=$$SETSTR^VALM1(PSJVD,PSJL,75,80)
"RTN","PSJLMUDE",19,0)
 . D:PSJVD]"" CNTRL^VALM10(1,75,5,IORVON,IORVOFF,0)
"RTN","PSJLMUDE",20,0)
 I $G(PSJORD)["P" D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJLMUDE",21,0)
 S PSJL="Instructions: "_PSGOINST D PTXT^PSJLMPRU(PSJL,"PSJUDE",6,80)
"RTN","PSJLMUDE",22,0)
 S PSJL=$S($D(PSGEFN(2)):$E(" *",PSGEFN(2)+1)_"(2)",1:"    "),PSJL=$$SETSTR^VALM1("Dosage Ordered: "_PSGDO,PSJL,5,76) D SETTMP D:$G(PSGOEEF(109)) HILITE(2)
"RTN","PSJLMUDE",23,0)
 I $G(PSGRDTX) S PSJDUR=$$FMTDUR^PSJLIVMD($P($G(PSGRDTX),U,2))
"RTN","PSJLMUDE",24,0)
 I $G(PSJORD),($G(PSJDUR)="") S P=$S(PSJORD["U":5,PSJORD["V":"IV",PSJORD["P":"P",1:-1) S PSJDUR=$$GETDUR^PSJLIVMD(PSGP,+PSJORD,P)
"RTN","PSJLMUDE",25,0)
 S PSJL=$$SETSTR^VALM1("Duration: "_$G(PSJDUR),PSJL,11,25)
"RTN","PSJLMUDE",26,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_$P(PSGSDN,U,2),PSJL,54,26) D:$G(PSGOEEF(10)) HILITE(3)
"RTN","PSJLMUDE",27,0)
 I $G(PSGORD)["P" N ND0,OLDO S ND0=@(PSGOEEWF_"0)") I $P(ND0,"^",24)="R" S OLDO=$P(ND0,"^",25) I OLDO,(OLDO["U") D
"RTN","PSJLMUDE",28,0)
 . N OSTRT,OSTRTN S OSTRT=$G(@("^PS(55,"_PSGP_",5,"_+OLDO_",2)")),OSTRT=$P(OSTRT,"^",2) Q:'OSTRT  S OSTRTN=$$ENDTC^PSGMI(+OSTRT)
"RTN","PSJLMUDE",29,0)
 . S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(3)):$E(" *",PSGEFN(3)+1)_"(3)",1:"    ")_"Start: "_OSTRTN,PSJL,54,26)
"RTN","PSJLMUDE",30,0)
 D SETTMP
"RTN","PSJLMUDE",31,0)
 S PSJL=$S($D(PSGEFN(4)):$E(" *",PSGEFN(4)+1)_"(4)",1:"    "),PSJL=$$SETSTR^VALM1("Med Route: "_PSGMRN,PSJL,10,35) D:$G(PSGOEEF(3)) HILITE(4)
"RTN","PSJLMUDE",32,0)
 I $G(PSJORD)["P" N PSGRNDT S PSGRNDT=$$LASTREN^PSJLMPRI(DFN,PSGORD) S:PSGRNDT PSGRNDT=$$ENDTC^PSGMI(+PSGRNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",33,0)
 I '$G(PSGRNDT),$G(PSGRDTX) D
"RTN","PSJLMUDE",34,0)
 . I $D(PSGRDTX)<10 S PSGRSDN=$$ENDTC^PSGMI(+PSGRDTX),PSJL=$$SETSTR^VALM1("REQUESTED START: "_PSGRSDN,PSJL,48,32) Q
"RTN","PSJLMUDE",35,0)
 . I $G(PSGRDTX(+$G(PSJORD),"PSGRSD")),$P($G(PSGSDN),U,2) S PSGRSDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRSD")),PSJL=$$SETSTR^VALM1("Calc Start: "_PSGRSDN,PSJL,53,32) D
"RTN","PSJLMUDE",36,0)
 .. I PSGSD'=PSGRDTX(+PSJORD,"PSGRSD") D CNTRL^VALM10(5,53,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",37,0)
 ; Indirect reference in PSGOEEWF below refers to either ^PS(53.1 or ^PS(55,DFN,5,
"RTN","PSJLMUDE",38,0)
 I $G(PSJORD)["U" N ND14 S ND14=$G(@(PSGOEEWF_"14,0)")) I ND14]"" S ND14=$G(^($P(ND14,"^",3),0)),RNDT=$P(ND14,"^") I RNDT D
"RTN","PSJLMUDE",39,0)
 . N PSGRNDT S PSGRNDT=$$ENDTC^PSGMI(+RNDT),PSJL=$$SETSTR^VALM1("Renewed: "_PSGRNDT,PSJL,56,32)
"RTN","PSJLMUDE",40,0)
 D SETTMP
"RTN","PSJLMUDE",41,0)
 I PSGORD]"" S PSJBCMA=$$BCMALG^PSJUTL2(PSGP,PSGORD)
"RTN","PSJLMUDE",42,0)
 I $G(PSJBCMA)]"" S PSJL=$$SETSTR^VALM1(PSJBCMA,PSJL,1,52)
"RTN","PSJLMUDE",43,0)
 S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(5)):$E(" *",PSGEFN(5)+1)_"(5)",1:"     ")_" Stop: "_$P(PSGFDN,U,2),PSJL,54,26) D SETTMP D:$G(PSGOEEF(25))!($G(PSGOEEF(34))) HILITE(5)
"RTN","PSJLMUDE",44,0)
 S PSJL=$S($D(PSGEFN(6)):$E(" *",PSGEFN(6)+1)_"(6)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule Type: "_PSGSTN,PSJL,6,45) D:$G(PSGOEEF(7)) HILITE(6)
"RTN","PSJLMUDE",45,0)
 I $G(PSJORD)["P",$G(PSGRDTX(+$G(PSJORD),"PSGRFD")),$P($G(PSGFDN),U,2) S PSGRFDN=$$ENDTC^PSGMI(PSGRDTX(+PSJORD,"PSGRFD")),PSJL=$$SETSTR^VALM1("Calc Stop: "_PSGRFDN,PSJL,54,26) D
"RTN","PSJLMUDE",46,0)
 . I PSGFD'=PSGRDTX(+PSJORD,"PSGRFD") D CNTRL^VALM10(7,54,80,IORVON,IORVOFF)
"RTN","PSJLMUDE",47,0)
 D SETTMP
"RTN","PSJLMUDE",48,0)
 S PSGSMN=$P("NO^YES",U,PSGSM+1)
"RTN","PSJLMUDE",49,0)
 N SCHMSG K PSJNSS I $G(PSGSCH)]"",$G(PSGS0XT) N FREQ S FREQ=PSGS0XT D
"RTN","PSJLMUDE",50,0)
 . N PSGOES,X,PSJNSS,PSGS0XT  S PSJNSS=1,PSGOES=1,X=PSGSCH,PSGS0XT=FREQ N PSGSCH D Q2^PSGS0
"RTN","PSJLMUDE",51,0)
 . I PSJNSS S SCHMSG=$$NSO^PSGS0(PSGS0XT) S:SCHMSG]"" SCHMSG=" ("_SCHMSG_")"
"RTN","PSJLMUDE",52,0)
 S PSJL=$S($D(PSGEFN(8)):$E(" *",PSGEFN(8)+1)_"(8)",1:"   "),PSJL=$$SETSTR^VALM1("Schedule: "_PSGSCH_$G(SCHMSG),PSJL,11,68) D SETTMP D:$G(PSGOEEF(26)) HILITE(8)
"RTN","PSJLMUDE",53,0)
 S PSJL=$S($D(PSGEFN(9)):$E(" *",PSGEFN(9)+1)_"(9)",1:"   "),PSJL=$$SETSTR^VALM1("Admin Times: "_PSGAT,PSJL,8,71) D SETTMP D:$G(PSGOEEF(39))!($G(PSGOEEF(41))) HILITE(9)
"RTN","PSJLMUDE",54,0)
 S PSJL=$S($D(PSGEFN(10)):$E(" *",PSGEFN(10)+1)_"(10)",1:"   "),PSJL=$$SETSTR^VALM1("Provider: "_PSGPRN,PSJL,11,68) D:$G(PSGOEEF(1)) HILITE(10) D SETTMP
"RTN","PSJLMUDE",55,0)
 ;S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,56,24) S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,71,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",56,0)
 S PSJL=$S($D(PSGEFN(11)):$E(" *",PSGEFN(11))_"(11)",1:"   ")_" Special Instructions"_$S($P(PSGSI,"^",2)=1:"!: ",1:": ")_$P(PSGSI,"^") D PTXT^PSJLMPRU(PSJL,"PSJUDE",1,80)
"RTN","PSJLMUDE",57,0)
 S PSJL="" D SETTMP D:$G(PSGOEEF(8)) HILITE(11)
"RTN","PSJLMUDE",58,0)
 ; E3R 16130
"RTN","PSJLMUDE",59,0)
 I $O(^PS(53.45,PSJSYSP,2,1)) F  S PSJL="" D SETTMP Q:PSJLN>15
"RTN","PSJLMUDE",60,0)
 S PSJL=$S($D(PSGEFN(12)):$E(" *",PSGEFN(12))_" (12)",1:"   ")_" Dispense Drug",PSJL=$$SETSTR^VALM1("U/D",PSJL,54,60),PSJL=$$SETSTR^VALM1("Inactive Date",PSJL,65,16) D SETTMP,CNTRL^VALM10(13,1,80,IOUON,IOUOFF,0)
"RTN","PSJLMUDE",61,0)
 ;S $P(PSJL,"-",80)="" D SETTMP
"RTN","PSJLMUDE",62,0)
 NEW PSJX
"RTN","PSJLMUDE",63,0)
 F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,2,Q)) Q:'Q  S ND=$G(^(Q,0)) D
"RTN","PSJLMUDE",64,0)
 .S D=$P(ND,"^"),PSGID=$P(ND,"^",3) I PSGID S PSGID=$$ENDTC^PSGMI(PSGID)
"RTN","PSJLMUDE",65,0)
 .S D=$S(D="":"NOT FOUND",'$D(^PSDRUG(D,0)):D,$P(^(0),"^")]"":$P(^(0),"^"),1:D_";PSDRUG(")
"RTN","PSJLMUDE",66,0)
 .S PSJL="      "_D_$$DDNF^PSJDIN(+ND),PSJL=$$SETSTR^VALM1($S($P(ND,"^",2):$S($P(ND,"^",2)=.5:"1/2",$P(ND,"^",2)=.25:"1/4",1:$P(ND,"^",2)),1:1),PSJL,54,63) S:PSGID PSJL=$$SETSTR^VALM1(PSGID,PSJL,65,16) D  D SETTMP
"RTN","PSJLMUDE",67,0)
 ..S PSJX=$G(PSJX)+1
"RTN","PSJLMUDE",68,0)
 ..I $G(PSGOEEF(109)) D CNTRL^VALM10(13+PSJX,7,73,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",69,0)
 I $S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,0)),1:$O(^PS(55,PSGP,5,+PSGORD,12,0))) S PSJL="Provider Comments:" D SETTMP S PSJL="" D
"RTN","PSJLMUDE",70,0)
 .F Q=0:0 S Q=$S(PSGORD["P":$O(^PS(53.1,+$G(PSGORD),12,Q)),1:$O(^PS(55,PSGP,5,+PSGORD,12,Q))) Q:'Q  S PSJL=$G(^(Q,0)) D SETTMP
"RTN","PSJLMUDE",71,0)
 D SETTMP S PSJL=$$SETSTR^VALM1($S($D(PSGEFN(7)):$E(" *",PSGEFN(7)+1)_"(7)",1:"   ")_"Self Med: "_PSGSMN,PSJL,1,24)
"RTN","PSJLMUDE",72,0)
 S:PSGSM&PSGHSM PSJL=$$SETSTR^VALM1("  (HS)",PSJL,16,7) D SETTMP D:$G(PSGOEEF(5)) HILITE(7)
"RTN","PSJLMUDE",73,0)
 D SETTMP S PSJL="Entry By: "_PSGEBN,PSJL=$$SETSTR^VALM1("Entry Date: "_$P(PSGLIN,U,2),PSJL,51,39) D SETTMP
"RTN","PSJLMUDE",74,0)
 I $G(PSGLRN) D SETTMP S PSJL="Renewed By: "_$$ENNPN^PSGMI($P(PSGLRN,"^",2)) D SETTMP
"RTN","PSJLMUDE",75,0)
 D SETTMP S PSJL="(13)"_" Comments:"
"RTN","PSJLMUDE",76,0)
 D:'$O(^PS(53.45,PSJSYSP,1,0)) SETTMP
"RTN","PSJLMUDE",77,0)
 D SETTMP F Q=0:0 S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S PSJWPL=PSJL_$S($E(PSJL)=" ":"",1:" ")_$G(^(Q,0)),PSJL="" D DISPLAY
"RTN","PSJLMUDE",78,0)
 D SETTMP
"RTN","PSJLMUDE",79,0)
 I PSGORD["P",($P($G(^PS(53.1,+PSGORD,0)),U,9)="P"),$O(^PS(53.1,+PSGORD,10,0)) D
"RTN","PSJLMUDE",80,0)
 .D SETTMP S PSJL="Order Checks:" D SETTMP
"RTN","PSJLMUDE",81,0)
 .F Q=0:0 S Q=$O(^PS(53.1,+PSGORD,10,Q)) Q:'Q  D
"RTN","PSJLMUDE",82,0)
 ..S PSJL="" D SETTMP S PSJL=$G(^PS(53.1,+PSGORD,10,Q,0)) D SETTMP
"RTN","PSJLMUDE",83,0)
 ..S PSJL="Overriding Provider: "_$P($G(^PS(53.1,+PSGORD,10,Q,1)),U) D SETTMP
"RTN","PSJLMUDE",84,0)
 ..S PSJL="Overriding Reason: " F X=0:0 S X=$O(^PS(53.1,+PSGORD,10,Q,2,X)) Q:'X   D
"RTN","PSJLMUDE",85,0)
 ...S PSJL=PSJL_$G(^PS(53.1,+PSGORD,10,Q,2,X,0)) D SETTMP S PSJL="                   "
"RTN","PSJLMUDE",86,0)
ACTFLG ;
"RTN","PSJLMUDE",87,0)
 S ND4=$S(PSGORD["P":$G(^PS(53.1,+PSGORD,4)),1:$G(^PS(55,PSGP,5,+PSGORD,4)))
"RTN","PSJLMUDE",88,0)
 S AT="",Y="12,13,D,18,19,H1,22,23,H0,15,16,R" F X=1:3:12 I $P(ND4,"^",$P(Y,",",X)),$P(ND4,"^",$P(Y,",",X+1)) S AT=$P(Y,",",X+2) Q
"RTN","PSJLMUDE",89,0)
 I AT="",'$P(ND4,"^",$S($P(PSJSYSU,";",3)>1:3,1:1)) S AT="V"_$S($P(ND4,"^",18):"H1",$P(ND4,"^",22):"H0",$P(ND4,"^",15):"R",1:"")
"RTN","PSJLMUDE",90,0)
 I AT]"" D
"RTN","PSJLMUDE",91,0)
 .S PSJL="" D SETTMP
"RTN","PSJLMUDE",92,0)
 .S PSJL="ORDER "_$S(AT["V":"NOT VERIFIED"_$S($P(AT,"V",2)="":"",1:" ("_$S(AT["H1":"ON HOLD",AT["H0":"OFF HOLD",1:"RENEWAL")_")"),1:"MARKED TO BE "_$S(AT["D":"CANCELLED",AT["H1":"PLACED ON HOLD",AT["H0":"TAKEN OFF OF HOLD",1:"RENEWED"))
"RTN","PSJLMUDE",93,0)
 I AT'["V",AT["H1",$D(^PS(55,PSGP,5.1)) S AT=^(5.1) I $P(AT,"^",7),$P(AT,"^",10)]"" S PSJL=PSJL_"  ("_$P(AT,"^",10)_")"
"RTN","PSJLMUDE",94,0)
 D SETTMP
"RTN","PSJLMUDE",95,0)
 S VALMCNT=PSJLN-1
"RTN","PSJLMUDE",96,0)
 K PSGSMN,Q,Y,Y1,Y2,PSGLRN
"RTN","PSJLMUDE",97,0)
 S VALM("TITLE")=PSGSTAT_" UNIT DOSE "_$S((PSGSTAT="PENDING")&($G(PSGPRIO)]""):"("_PSGPRIO_")",$G(PSGPRIO)="DONE":"("_PSGPRIO_")",1:"") I $D(PSJLMP2) S VALMBG=16 K PSJLMP2
"RTN","PSJLMUDE",98,0)
TEST ;
"RTN","PSJLMUDE",99,0)
 I $G(PSGPFLG) S VALMSG="INVALID ORDERABLE ITEM"
"RTN","PSJLMUDE",100,0)
 I $G(PSGDI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" DISPENSE DRUG"
"RTN","PSJLMUDE",101,0)
 I $G(PSGPI) S VALMSG=$S($G(VALMSG)="":"INVALID",1:VALMSG_",")_" PROVIDER"
"RTN","PSJLMUDE",102,0)
 Q
"RTN","PSJLMUDE",103,0)
DISPLAY ;
"RTN","PSJLMUDE",104,0)
 S PSJL=PSJWPL D SETTMP
"RTN","PSJLMUDE",105,0)
 ;F X=1:1 S WRD=$P(PSJWPL," ",X) Q:WRD=""  D
"RTN","PSJLMUDE",106,0)
 ;.I $L(PSJL_" "_WRD)'<80 D SETTMP S PSJL=$P(PSJWPL,PSJL,2) S:$E(PSJL,1)=" " PSJL=$E(PSJL,2,999),PSJWPL="" Q
"RTN","PSJLMUDE",107,0)
 ;.S PSJL=PSJL_$S(PSJL="":"",1:" ")_WRD
"RTN","PSJLMUDE",108,0)
 Q
"RTN","PSJLMUDE",109,0)
 ;
"RTN","PSJLMUDE",110,0)
SETTMP ;
"RTN","PSJLMUDE",111,0)
 S ^TMP("PSJUDE",$J,PSJLN,0)=PSJL,PSJLN=PSJLN+1,PSJL=""
"RTN","PSJLMUDE",112,0)
 Q
"RTN","PSJLMUDE",113,0)
 ;
"RTN","PSJLMUDE",114,0)
HILITE(FLD) ; 
"RTN","PSJLMUDE",115,0)
 N COL,LIN,WID,X
"RTN","PSJLMUDE",116,0)
 ;Q:'$G(PSGOEENO)
"RTN","PSJLMUDE",117,0)
 S X="$T("_FLD_"^PSJLMUDE)",@("X="_X),X=$P(X,";;",2),LIN=+X,COL=$P(X,",",2),LAB=$P(X,",",3),X=$P(X,",",4),WID=(LAB+$L(@X))
"RTN","PSJLMUDE",118,0)
 ;D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IOINORM,0)
"RTN","PSJLMUDE",119,0)
 I FLD=7 S LIN=+$G(PSJLN)-1 Q:LIN<13
"RTN","PSJLMUDE",120,0)
 D CNTRL^VALM10(LIN,COL,WID,IORVON_IOBON,IORVOFF_IOBOFF,0)
"RTN","PSJLMUDE",121,0)
 Q
"RTN","PSJLMUDE",122,0)
 ;
"RTN","PSJLMUDE",123,0)
1 ;;1,5,16,PSGPDN
"RTN","PSJLMUDE",124,0)
2 ;;3,5,16,PSGDO
"RTN","PSJLMUDE",125,0)
3 ;;4,58,7,PSGSDN
"RTN","PSJLMUDE",126,0)
4 ;;5,10,11,PSGMRN
"RTN","PSJLMUDE",127,0)
5 ;;6,59,6,PSGFDN
"RTN","PSJLMUDE",128,0)
6 ;;7,6,15,PSGSTN
"RTN","PSJLMUDE",129,0)
7 ;;18,5,14,PSGSMN
"RTN","PSJLMUDE",130,0)
8 ;;8,11,12,PSGSCH
"RTN","PSJLMUDE",131,0)
9 ;;9,8,13,PSGAT
"RTN","PSJLMUDE",132,0)
10 ;;10,11,10,PSGPRN
"RTN","PSJLMUDE",133,0)
11 ;;11,7,22,PSGSI
"RTN","PSJLMUDE",134,0)
ENKILL ;
"RTN","PSJLMUDE",135,0)
 K PSGAT,PSGEB,PSGEFN,PSGFD,PSGHSM,PSGNEFD,PSGNESD,PSGOEEF,PSGOEER,PSGOFD,PSGOHSM,PSGOMR,PSGOMRN,PSGOPD,PSGOPDN,PSGOPR,PSGOSCH,PSGOSD,PSGOSM,PSGOST,PSGPD,PSGPDN,PSGPR,PSGSD,PSGSM Q
"RTN","PSJLMUT1")
0^68^B64674986
"RTN","PSJLMUT1",1,0)
PSJLMUT1 ;BIR/MLM-DRUG NAME DISPLAY ;05 Feb 98 / 1:39 PM
"RTN","PSJLMUT1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**4,27,29,49,58,107,110**;16 DEC 97
"RTN","PSJLMUT1",3,0)
 ;
"RTN","PSJLMUT1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJLMUT1",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJLMUT1",6,0)
 ; Reference to ^PS(50.606 is supported by DBIA# 2174.
"RTN","PSJLMUT1",7,0)
 ; Reference to EN^PSODRDU2 is supported by DBIA# 2189.
"RTN","PSJLMUT1",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJLMUT1",9,0)
 ;
"RTN","PSJLMUT1",10,0)
DRGDISP(DFN,ON,NL,GL,NAME,DRUGONLY)       ;
"RTN","PSJLMUT1",11,0)
 ;; DRUGONLY = 1/0 - Only the drug name will be returned.
"RTN","PSJLMUT1",12,0)
 ;; NL       = The drug name display length
"RTN","PSJLMUT1",13,0)
 ;; GL       = The give line display length, total length-6 ("Give: ")
"RTN","PSJLMUT1",14,0)
 ;; NAME(X)  = Drug name and give line in displayable format.
"RTN","PSJLMUT1",15,0)
 ;; ON       = IEN#_U/P (U=Unit Dose; P=Pending)
"RTN","PSJLMUT1",16,0)
 ;
"RTN","PSJLMUT1",17,0)
 NEW F,OIND,MARX,MR,NOTGV,SCH,PSGUPDDO,PSGGV,X,PSGX,PSGINS,DRUGNAME
"RTN","PSJLMUT1",18,0)
 K NAME S PSGINS=""
"RTN","PSJLMUT1",19,0)
 S:ON["U" F="^PS(55,DFN,5,+ON,"
"RTN","PSJLMUT1",20,0)
 I ON["P" S F="^PS(53.1,+ON,",X=$G(@(F_".3)")),PSGINS=$S(X]"":X,1:"")
"RTN","PSJLMUT1",21,0)
 I $G(@(F_"0)"))="" S NAME(1)="NOT FOUND" Q
"RTN","PSJLMUT1",22,0)
 S OIND=$G(@(F_".2)")),PSGUPDDO=$P(OIND,U,2),X=@(F_"0)"),NOTGV=$P(X,U,22),MR=$$ENMRN^PSGMI(+$P(X,U,3))
"RTN","PSJLMUT1",23,0)
 I '+OIND,($P(X,U,4)'="U") NEW DRG D GTDRG^PSIVORFA F X="AD","SOL" Q:+OIND  F PSGX=0:0 S PSGX=$O(DRG(X,PSGX)) Q:'PSGX  S OIND=$P(DRG(X,PSGX),U,6) Q:+OIND
"RTN","PSJLMUT1",24,0)
 S SCH=$P($G(@(F_"2)")),U)
"RTN","PSJLMUT1",25,0)
 I +$O(@(F_"1,0)")),'+$O(@(F_"1,1)")),PSGUPDDO="" D DD(F,.DRUGNAME)
"RTN","PSJLMUT1",26,0)
 S:($G(DRUGNAME)=""!($G(DRUGNAME)["NOT FOUND")) DRUGNAME=$$OIDF(OIND)
"RTN","PSJLMUT1",27,0)
 ;S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_PSGINS_PSGUPDDO_" "_MR_" "_SCH
"RTN","PSJLMUT1",28,0)
 S PSGGV=$S(NOTGV:"*** NOT TO BE GIVEN *** ",1:"")_$S(('$D(PSJPDDDP)&('$L(PSGUPDDO))):PSGINS,1:PSGUPDDO)_" "_MR_" "_SCH
"RTN","PSJLMUT1",29,0)
 S PSGX=0 K PSJPDDDP
"RTN","PSJLMUT1",30,0)
 D TXT^PSGMUTL(DRUGNAME,NL) F X=0:0 S X=$O(MARX(X)) Q:'X  S NAME(X)=$S(X>1:"  ",1:"")_MARX(X),PSGX=X
"RTN","PSJLMUT1",31,0)
 Q:+DRUGONLY
"RTN","PSJLMUT1",32,0)
 D TXT^PSGMUTL(PSGGV,GL) F X=0:0 S X=$O(MARX(X)) Q:'X  D
"RTN","PSJLMUT1",33,0)
 . I X=1 S NAME(PSGX+X)="Give: "_MARX(X) Q
"RTN","PSJLMUT1",34,0)
 . S NAME(PSGX+X)=$S(X>1:"      ",1:"")_MARX(X)
"RTN","PSJLMUT1",35,0)
 Q
"RTN","PSJLMUT1",36,0)
OIDF(OIND)    ; Return Orderable Item name and Dosage form.
"RTN","PSJLMUT1",37,0)
 ;; +OIND = orderable item IEN
"RTN","PSJLMUT1",38,0)
 NEW X,NAME
"RTN","PSJLMUT1",39,0)
 S X=$G(^PS(50.7,+OIND,0))
"RTN","PSJLMUT1",40,0)
 S:$P(X,U)]"" NAME=$P(X,U)_" "_$P($G(^PS(50.606,+$P(X,U,2),0)),U)
"RTN","PSJLMUT1",41,0)
 Q $S($G(NAME)]"":NAME,1:"NOT FOUND "_+OIND_";PS(50.7")
"RTN","PSJLMUT1",42,0)
 ;
"RTN","PSJLMUT1",43,0)
DD(F,NAME)        ; Return Dispense drug name.
"RTN","PSJLMUT1",44,0)
 ;; F = "^PS(55,DFN,5,+ON," or "^PS(53.1,+ON,"
"RTN","PSJLMUT1",45,0)
 NEW X K NAME
"RTN","PSJLMUT1",46,0)
 S X=$O(@(F_"1,0)")),X=$G(@(F_"1,"_+X_",0)"))
"RTN","PSJLMUT1",47,0)
 I $P(X,U)]"" S NAME=$P($G(^PSDRUG(+X,0)),U)
"RTN","PSJLMUT1",48,0)
 E  S NAME="NOT FOUND "_+X_";PSDRUG"
"RTN","PSJLMUT1",49,0)
 I '$O(@(F_"1,1)")),+$P(X,U,2)>1 S PSGUPDDO=+$P(X,U,2)
"RTN","PSJLMUT1",50,0)
 S PSJPDDDP=1
"RTN","PSJLMUT1",51,0)
 Q
"RTN","PSJLMUT1",52,0)
DSPLORDU(PSGP,ON)   ; Display UD order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",53,0)
 NEW DRUGNAME,F,NODE0,NODE2,PSJID,PSJX,SCH,SD,STAT,X,Y
"RTN","PSJLMUT1",54,0)
 S F=$S(ON["U":"^PS(55,PSGP,5,"_+ON_",",1:"^PS(53.1,"_+ON_",")
"RTN","PSJLMUT1",55,0)
 S NODE0=$G(@(F_"0)")),NODE2=$G(@(F_"2)"))
"RTN","PSJLMUT1",56,0)
 D DRGDISP^PSJLMUT1(PSGP,ON,39,54,.DRUGNAME,0)
"RTN","PSJLMUT1",57,0)
 I ON["P",$P(NODE0,U,4)="F" D DSPLORDV(PSGP,ON) Q
"RTN","PSJLMUT1",58,0)
 S SCH=$P(NODE0,U,7)
"RTN","PSJLMUT1",59,0)
 S STAT=$P(NODE0,U,9) I STAT="A",$P(NODE0,U,27)="R" S STAT="R"
"RTN","PSJLMUT1",60,0)
 I STAT'="P" S PSJID=$E($$ENDTC^PSGMI($P(NODE2,U,2)),1,5),SD=$E($$ENDTC^PSGMI($P(NODE2,U,4)),1,5)
"RTN","PSJLMUT1",61,0)
 I STAT="P" S (PSJID,SD)="*****",SCH="?"
"RTN","PSJLMUT1",62,0)
 F PSJX=0:0 S PSJX=$O(DRUGNAME(PSJX)) Q:'PSJX  D
"RTN","PSJLMUT1",63,0)
 . S:PSJX=1 X=SCH_"  "_PSJID_"  "_SD_"  "_$E(STAT,1)
"RTN","PSJLMUT1",64,0)
 . S:PSJX=1 DRUGNAME(1)=$$SETSTR^VALM1(X,$E(DRUGNAME(1),1,40),42,20)
"RTN","PSJLMUT1",65,0)
 . S PSJOC(ON,PSJLINE)="        "_DRUGNAME(PSJX)
"RTN","PSJLMUT1",66,0)
 . S PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",67,0)
 Q
"RTN","PSJLMUT1",68,0)
DSPLORDV(DFN,ON)   ; Display IV order for order check as in the Inpat Profile.
"RTN","PSJLMUT1",69,0)
 N DRG,DRGI,DRGT,DRGX,FIL,ND,ON55,P,PSJIVFLG,PSJORIFN,TYP,X,Y
"RTN","PSJLMUT1",70,0)
 S TYP="?" I ON["V" D
"RTN","PSJLMUT1",71,0)
 .S Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,5,8,9,17,23 S P(X)=$P(Y,U,X)
"RTN","PSJLMUT1",72,0)
 .S TYP=$$ONE^PSJBCMA(DFN,ON,P(9),P(2),P(3)) I TYP'="O" S TYP="C"
"RTN","PSJLMUT1",73,0)
 .S ON55=ON,P("OT")=$S(P(4)="A":"F",P(4)="H":"H",1:"I") D GTDRG^PSIVORFB,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",74,0)
 S PSJCT=0,PSJL=""
"RTN","PSJLMUT1",75,0)
 I ON'["V" S (P(2),P(3))="",P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^(8)),P(4)=$P(Y,U),P(8)=$P(Y,U,5),P(9)=$P($G(^(2)),U) D GTDRG^PSIVORFA,GTOT^PSIVUTL(P(4))
"RTN","PSJLMUT1",76,0)
 S PSJIVFLG=1 D PIVAD,SOL
"RTN","PSJLMUT1",77,0)
 Q
"RTN","PSJLMUT1",78,0)
SOL ;
"RTN","PSJLMUT1",79,0)
 S PSJL=$S($G(PSJIVFLG):PSJL,1:"")_"        in"
"RTN","PSJLMUT1",80,0)
 S DRG=0 F  S DRG=+$O(DRG("SOL",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("SOL",DRG),39,.NAME,0) S DRGX=0 F  S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,12,60) D:$G(PSJIVFLG) PIV1 D SETTMP S PSJL="      "
"RTN","PSJLMUT1",81,0)
 Q
"RTN","PSJLMUT1",82,0)
PIVAD ; Print IV Additives.
"RTN","PSJLMUT1",83,0)
 F DRG=0:0 S DRG=$O(DRG("AD",DRG)) Q:'DRG  D NAME^PSIVUTL(DRG("AD",DRG),39,.NAME,1) F DRGX=0:0 S DRGX=$O(NAME(DRGX)) Q:'DRGX  S PSJL=$$SETSTR^VALM1(NAME(DRGX),PSJL,9,60) D:$G(PSJIVFLG) PIV1 D SETTMP
"RTN","PSJLMUT1",84,0)
 Q
"RTN","PSJLMUT1",85,0)
 ;
"RTN","PSJLMUT1",86,0)
PIV1 ; Print Sched type, start/stop dates, and status.
"RTN","PSJLMUT1",87,0)
 K PSJIVFLG
"RTN","PSJLMUT1",88,0)
 F X=2,3 S P(X)=$E($$ENDTC^PSGMI(P(X)),1,$S($D(PSJEXTP):8,1:5))
"RTN","PSJLMUT1",89,0)
 I '$D(PSJEXTP) S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),PSJL,53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,60,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,67,1)
"RTN","PSJLMUT1",90,0)
 E  S PSJL=$$SETSTR^VALM1(TYP,PSJL,50,1),PSJL=$$SETSTR^VALM1(P(2),53,7),PSJL=$$SETSTR^VALM1(P(3),PSJL,63,7),PSJL=$$SETSTR^VALM1(P(17),PSJL,73,1)
"RTN","PSJLMUT1",91,0)
 Q
"RTN","PSJLMUT1",92,0)
SETTMP ;
"RTN","PSJLMUT1",93,0)
 S PSJOC(ON,PSJLINE)=PSJL,PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",94,0)
 Q
"RTN","PSJLMUT1",95,0)
ORDCHK(DFN,TYPE,PIECE)   ;
"RTN","PSJLMUT1",96,0)
 ;TYPE ="DD" - Duplicate drug
"RTN","PSJLMUT1",97,0)
 ;     ="DC" - Duplicate class
"RTN","PSJLMUT1",98,0)
 ;     -"DI" - Drug Interaction
"RTN","PSJLMUT1",99,0)
 ;PIECE = The piece order number is return from ^TMP($J,"DD"...
"RTN","PSJLMUT1",100,0)
 ;PSJOC(ON,x) = Array of inpatient orders to be displayed
"RTN","PSJLMUT1",101,0)
 ;
"RTN","PSJLMUT1",102,0)
 NEW ON,PSJL,PSIVX,PSJOC,PSJORIEN,PSJPACK,PSJLINE
"RTN","PSJLMUT1",103,0)
 S PSJOC=0,PSJLINE=1
"RTN","PSJLMUT1",104,0)
 F PSIVX=0:0 S PSIVX=$O(^TMP($J,TYPE,PSIVX)) Q:'PSIVX  D
"RTN","PSJLMUT1",105,0)
 . S PSJPACK=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE)
"RTN","PSJLMUT1",106,0)
 . I $G(PSGORD) S PSJORD=PSGORD ; Set PSJORD if PSGORD exists and is not Null
"RTN","PSJLMUT1",107,0)
 . I $G(PSJORD)]"" I $S($D(PSJORD):$G(PSJORD),1:$G(PSGORD))'["V",$P(PSJPACK,";")=$S($D(PSJORD):$G(PSJORD),1:$G(PSGORD)) Q  ; don't flag order that is being renewed as duplicate, only checks Unit Dose orders
"RTN","PSJLMUT1",108,0)
 . I $G(PSJCOM),($G(PSJORD)["P") Q:$D(^PS(53.1,"ACX",PSJCOM,+PSJPACK))
"RTN","PSJLMUT1",109,0)
 . ; Don't flag if pending renewal from CPRS
"RTN","PSJLMUT1",110,0)
 . I $G(PSJORD)]"",(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),"^",24)="R"),($P(PSJPACK,";")["U"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",27)="R"),($P($G(^PS(55,DFN,5,+$P(PSJPACK,";"),0)),"^",26)=PSJORD) Q
"RTN","PSJLMUT1",111,0)
 . I $G(PSIVRNFG),$G(ON55)["V",$P(PSJPACK,";")=$G(ON55) Q  ;PSIVRNFG set and kill in R+2^PSIVOPT2. Needed to do dupl. check on new order but not renew.
"RTN","PSJLMUT1",112,0)
 . S PSJORIEN=$P(^TMP($J,TYPE,PSIVX,0),U,PIECE-1)
"RTN","PSJLMUT1",113,0)
 . I TYPE="DI",($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL") S PSJIREQ=1
"RTN","PSJLMUT1",114,0)
 . ; Adding Drug Interactions check for use in Intervention defaults in PSJRXI.
"RTN","PSJLMUT1",115,0)
 . I TYPE="DI" S PSJRXREQ=$S($P(^TMP($J,TYPE,PSIVX,0),U,4)="CRITICAL":1,1:2)
"RTN","PSJLMUT1",116,0)
 . ;I $P(PSJPACK,";",2)["O" D  Q
"RTN","PSJLMUT1",117,0)
 . N X S X=$P(PSJPACK,";",2) I X["O" D  Q
"RTN","PSJLMUT1",118,0)
 ..  D:PSJFST=1 PAUSE
"RTN","PSJLMUT1",119,0)
 ..  ;W !!,"The patient has this outpatient order:",!
"RTN","PSJLMUT1",120,0)
 ..  W !!,"The patient has this "_$S($P(PSJPACK,";")["N":"Non-VA Meds",$P(PSJPACK,";",2)["O":"Outpatient",1:"")_" order:",!
"RTN","PSJLMUT1",121,0)
 ..  D EN^PSODRDU2(DFN,PSJPACK),PAUSE S PSJPDRG=1,PSJFST=$S(PSJFST=0:PSJFST+2,1:PSJFST+1)
"RTN","PSJLMUT1",122,0)
 . S ON=$P(PSJPACK,";") Q:$D(PSJOC(ON))
"RTN","PSJLMUT1",123,0)
 . I ON=$G(PSIVOCON),+PSJORIEN Q
"RTN","PSJLMUT1",124,0)
 . I ON=$G(PSIVOCON),'+PSJORIEN D SETPSJOC Q
"RTN","PSJLMUT1",125,0)
 . ;S PSJOC=PSJOC+1,PSJPDRG=1 D:PSJOC=1 WRITE(TYPE)
"RTN","PSJLMUT1",126,0)
 . I ON["V" D
"RTN","PSJLMUT1",127,0)
 .. I '$O(^PS(55,DFN,"IV",+ON,0)) D SETPSJOC Q
"RTN","PSJLMUT1",128,0)
 .. D DSPLORDV(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",129,0)
 . I ON'["V" D DSPLORDU(DFN,ON) S PSJOC=PSJOC+1
"RTN","PSJLMUT1",130,0)
 . S PSJOC(ON,PSJLINE)="",PSJLINE=PSJLINE+1
"RTN","PSJLMUT1",131,0)
 D:PSJOC WRITE(TYPE)
"RTN","PSJLMUT1",132,0)
 S ON="" F  S ON=$O(PSJOC(ON)) Q:ON=""  W ! S PSJLINE=PSJLINE+1,PSJFST=PSJFST+1 D
"RTN","PSJLMUT1",133,0)
 . F PSIVX=0:0 S PSIVX=$O(PSJOC(ON,PSIVX)) Q:'PSIVX  W !,PSJOC(ON,PSIVX) S PSJLINE=PSJLINE+1 D:'(PSIVX#6) PAUSE
"RTN","PSJLMUT1",134,0)
 W !
"RTN","PSJLMUT1",135,0)
 Q
"RTN","PSJLMUT1",136,0)
SETPSJOC ;Set PSJOC array to be displayed later
"RTN","PSJLMUT1",137,0)
 NEW PIECE S PIECE=$S(TYPE="DC":4,1:2)
"RTN","PSJLMUT1",138,0)
 S X=$$SETSTR^VALM1($P(^TMP($J,TYPE,PSIVX,0),U,PIECE),"",9,40)
"RTN","PSJLMUT1",139,0)
 S X=$$SETSTR^VALM1("* EXISTS IN CURRENT ORDER *",X,50,27)
"RTN","PSJLMUT1",140,0)
 S PSJOC(ON,PSJLINE)=X,PSJLINE=PSJLINE+1,PSJOC=PSJOC+1
"RTN","PSJLMUT1",141,0)
 Q
"RTN","PSJLMUT1",142,0)
WRITE(TYPE)        ;Display order check description
"RTN","PSJLMUT1",143,0)
 S PSJPDRG=1
"RTN","PSJLMUT1",144,0)
 I TYPE="DD" W !!,"This patient is already receiving the following order",$S(PSJOC>1:"s",1:"")," for ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"this drug"),":",!
"RTN","PSJLMUT1",145,0)
 I TYPE="DC" W !!,"This patient is already receiving ",$S(PSJOC>1:"orders",1:"an order")," for the following drug",$S(PSJOC>1:"s",1:"")," in the same",!,"class as ",$S($G(PSJDD)]"":$P($G(^PSDRUG(PSJDD,0)),U),1:"the drug selected"),":",!
"RTN","PSJLMUT1",146,0)
 I TYPE="DI" W !!,"This patient is receiving the following medication",$S(PSJOC>1:"s",1:"")," that ha",$S(PSJOC>1:"ve",1:"s")," an interaction",!,"with ",$P($G(^PSDRUG(PSJDD,0)),U),":",!
"RTN","PSJLMUT1",147,0)
 Q
"RTN","PSJLMUT1",148,0)
PAUSE ;
"RTN","PSJLMUT1",149,0)
 K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W !
"RTN","PSJLMUT1",150,0)
 Q
"RTN","PSJO")
0^34^B21417551
"RTN","PSJO",1,0)
PSJO ;BIR/CML3,PR-GET AND PRINT INPATIENT ORDERS ;28 Jun 99 / 10:20 AM
"RTN","PSJO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,58,110**;16 DEC 97
"RTN","PSJO",3,0)
 ;
"RTN","PSJO",4,0)
 ; Reference to ^PSD(58.8 supported by DBIA #2283.
"RTN","PSJO",5,0)
 ; Reference to ^PSI(58.1 supported by DBIA #2284.
"RTN","PSJO",6,0)
 ; Reference to ^PS(55 supported by DBIA #2191.
"RTN","PSJO",7,0)
 ;
"RTN","PSJO",8,0)
 K ^TMP("PSJON",$J),^TMP("PSJ",$J) D @$S($D(PSJEXTP):"EN^PSJH1",1:"EN^PSJO1(3)")
"RTN","PSJO",9,0)
 S PSJDEV=IO'=IO(0)!($E(IOST,1,2)'="C-"),(NP,PSGON,PSJON)=""
"RTN","PSJO",10,0)
 U IO D ENGET^PSJO3 I '$D(^TMP("PSJ",$J)) W !,SLS,SLS,$E(SLS,1,25),!!?22,"NO ORDERS FOUND FOR ",$S(PSJOL="S":"SHORT",1:"LONG")," PROFILE."
"RTN","PSJO",11,0)
 E  S (PSJC,PSJS,PSJO,PSJST)="" F  S PSJC=$O(^TMP("PSJ",$J,PSJC)) Q:PSJC=""  D  G:NP["^" DONE
"RTN","PSJO",12,0)
 .D:$S((PSJC["B"&'TF):0,PSJC'["A":1,1:1) TF
"RTN","PSJO",13,0)
 .F  S PSJST=$O(^TMP("PSJ",$J,PSJC,PSJST)) Q:PSJST=""  F  S PSJS=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS)) Q:PSJS=""!(NP[U)  D ON
"RTN","PSJO",14,0)
 G:NP[U DONE I PSJDEV,$S('$D(PSJPRP):1,1:PSJPRP="P") D BOT
"RTN","PSJO",15,0)
 ;
"RTN","PSJO",16,0)
DONE ;
"RTN","PSJO",17,0)
 I $S('$D(PSJPRP):1,1:PSJPRP="P") K ^TMP("PSJ",$J)
"RTN","PSJO",18,0)
 S PSGON=PSJON K:'$D(PSGVBW) PSGODT K %,%H,%I,C,DN,DO,DRG,FQ,GIVE,HDT,I,JJ,LN2,N,ND,ND4,ND6,NF,NP,O,ON,ORIFN,ORTX,P,PF,PG,PS,PSGID,PSGOD,PSIVSC,PSIVST,PSIVTY,PSJC,PSJDEV,PSJF,PSJO,PSJOS,PSJS,PSJSCHT,PSJST,QQ,RB,RTE,SCH,SD,SLS,SM
"RTN","PSJO",19,0)
 K ST,START,STAT,SUB,TF,TYP,UDU,UPD,V,WS,X,X1,X2,Y Q
"RTN","PSJO",20,0)
 ;
"RTN","PSJO",21,0)
ON ;
"RTN","PSJO",22,0)
 S PSJSCHT=$S(PSJOS:PSJS,1:PSJST)
"RTN","PSJO",23,0)
 F FQ=0:0 S PSJO=$O(^TMP("PSJ",$J,PSJC,PSJST,PSJS,PSJO)) Q:PSJO=""  S DN=^(PSJO) D:$Y+6>IOSL ENNP^PSJO3 Q:NP["^"  D  ;
"RTN","PSJO",24,0)
 .S PSJON=PSJON+1 S:'PSJDEV ^TMP("PSJON",$J,PSJON)=PSJO W !,$J(PSJON,4),?5 D @$S(PSJO["V":"PIV^PSIVUTL(PSJO)",PSJO["U":"PUD",1:"PIV^PSIVUTL(PSJO)")
"RTN","PSJO",25,0)
 Q
"RTN","PSJO",26,0)
 ;
"RTN","PSJO",27,0)
PUD ; print unit dose
"RTN","PSJO",28,0)
 ; Naked reference below refers to full reference ^PS(53.1,+PSJO,0) or ^PS(55,DFN,5,+PSJO,0) using indirection.
"RTN","PSJO",29,0)
 S ND=$S($D(@(PSJF_+PSJO_",0)")):^(0),1:""),SCH=$G(^(2)),ND4=$G(^(4)),ND6=$P($G(^(6)),"^"),DO=$S($P(DN,"^",2)=.2:$P($G(@(PSJF_+PSJO_",.2)")),"^",2),1:$G(@(PSJF_+PSJO_",.3)")))
"RTN","PSJO",30,0)
 ;I PSJC["A" S V='$P(ND4,"^",UDU) W $S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" ") W:V&(PSJSYSU) "->"
"RTN","PSJO",31,0)
 I "AO"[PSJC D
"RTN","PSJO",32,0)
 .S V='$P(ND4,"^",UDU),V=$S(+PSJSYSU=1&V:1,+PSJSYSU=3&V:1,1:0)
"RTN","PSJO",33,0)
 .W $S(ND4="":" ",$P(ND4,"^",12):"D",$P(ND4,"^",18)&($P(ND4,"^",19)!V):"H",$P(ND4,"^",22)&($P(ND4,"^",23)!V):"H",$P(ND4,"^",15)&($P(ND4,"^",16)!V):"R",1:" ")
"RTN","PSJO",34,0)
 .W $S($P($G(@(PSJF_+PSJO_",.2)")),"^",4)="D":"d",1:" ")_$S(V:"->",1:"  ")
"RTN","PSJO",35,0)
 ;I $S(PSJC["NZ":0,1:PSJC["N") W $S($P(ND4,"^",12):"D",1:" "),$S(PSJSYSU:"->",1:"")
"RTN","PSJO",36,0)
 I $S(PSJC["NZ":0,1:PSJC["N") W $S($P(ND4,"^",12):"D",1:" ")
"RTN","PSJO",37,0)
 S RTE=$P(ND,"^",3),SM=$S('$P(ND,"^",5):0,$P(ND,"^",6):1,1:2),STAT=$S($P(ND,"^",9)]"":$P(ND,"^",9),1:"NF"),PF=$E("*",$P(ND,"^",20)>0),PSGID=$P(SCH,"^",2),SD=$P(SCH,"^",4),SCH=$P(SCH,"^")
"RTN","PSJO",38,0)
 I STAT="A",$P(ND,U,27)="R" S STAT="R"
"RTN","PSJO",39,0)
 S NF=$P(DN,"^",2),WS=$S(PSJPWD:$$WS(PSJPWD,PSGP,PSJF,PSJO),1:0)
"RTN","PSJO",40,0)
 NEW MARX,PSJRNDT
"RTN","PSJO",41,0)
 S PSJRNDT=$$LASTREN^PSJLMPRI(DFN,PSJO) S:PSJRNDT PSJRNDT=$E($$ENDTC^PSGMI(+PSJRNDT),1,5)
"RTN","PSJO",42,0)
 D DRGDISP^PSJLMUT1(PSGP,+PSJO_$S(PSJC["A":"U",PSJC["O":"U",1:"P"),40,54,.MARX,0)
"RTN","PSJO",43,0)
 F X=0:0 S X=$O(MARX(X)) Q:'X  W @($S(X=1:"?9",1:"!?11")),$S($E(PSJS)="*":$P(PSJS,"^"),1:MARX(X)) D:X=1
"RTN","PSJO",44,0)
 . W ?50,$S(PSJC["NZ":"?",PSJSCHT'="z":PSJSCHT,1:"?")
"RTN","PSJO",45,0)
 . W:'$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,5)),?60,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,5)),?67,STAT
"RTN","PSJO",46,0)
 . W:$D(PSJEXTP) ?53,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(PSGID),1,8)),?63,$S(PSJC["NZ":"*****",1:$E($$ENDTC^PSGMI(SD),1,8)),?73,STAT
"RTN","PSJO",47,0)
 . I NF!WS!SM!PF!(PSJRNDT]"") W ?71 W:NF "NF " W:WS "WS " W:SM $E("HSM",SM,3) W:$G(PSJRNDT) PSJRNDT W:PF ?79,"*"
"RTN","PSJO",48,0)
 I ND6]"" S Y=$$ENSET^PSGSICHK(ND6) W !?11 F X=1:1:$L(Y," ") S V=$P(Y," ",X) W:$L(V)+$X>66 !?11 W V_" "
"RTN","PSJO",49,0)
 Q
"RTN","PSJO",50,0)
 ;
"RTN","PSJO",51,0)
TF ;
"RTN","PSJO",52,0)
 NEW SLS,C S SLS="",C=PSJC,$P(SLS," -",40)=""
"RTN","PSJO",53,0)
 S LN2=$S(C="A":"A C T I V E",C["CC":"P E N D I N G   R E N E W A L S",C["CD":"P E N D I N G   C O M P L E X",C["BD":"N O N - V E R I F I E D  C O M P L E X",C["C":"P E N D I N G ",C["B":"N O N - V E R I F I E D",1:"N O N - A C T I V E")
"RTN","PSJO",54,0)
 W:$D(^TMP("PSJ",$J,PSJC)) !,$E($E(SLS,1,(80-$L(LN2))/2)_" "_LN2_$E(SLS,1,(80-$L(LN2))/2),1,80)
"RTN","PSJO",55,0)
 S PSJF="^PS("_$S(PSJC'["C":"55,"_PSGP_",5,",1:"53.1,") S TF=$S(PSJC["C":0,1:TF)
"RTN","PSJO",56,0)
 Q
"RTN","PSJO",57,0)
 ;
"RTN","PSJO",58,0)
 ;
"RTN","PSJO",59,0)
BOT ; print name, ssn, and dob on bottom of page
"RTN","PSJO",60,0)
 F Q=$Y:1:IOSL-4 W !
"RTN","PSJO",61,0)
 W !,?2,$P(PSGP(0),"^"),?40,PSJPPID,?70,$E($P(PSJPDOB,"^",2),1,8)
"RTN","PSJO",62,0)
 Q
"RTN","PSJO",63,0)
WS(PSJPWD,PSGP,PSJF,PSJO) ; - WARD STOCK flag, input=(ward,dfn,file root,order)
"RTN","PSJO",64,0)
 ; Naked reference below refers to full reference ^PS(55,DFN,5,+PSJO,1,"B",PSWS) using indirection.
"RTN","PSJO",65,0)
 S WS=0,PSJF=PSJF_+PSJO_",1,""B"")" I $D(@PSJF) N PSWS S PSWS=0 F  S PSWS=$O(^("B",PSWS)) Q:'PSWS  S WS=$$WSCHK(PSJPWD,PSWS) Q:WS
"RTN","PSJO",66,0)
 Q WS
"RTN","PSJO",67,0)
 ;
"RTN","PSJO",68,0)
WSCHK(PSJPWD,PSWS) ; Determine if drug is ward stock item.
"RTN","PSJO",69,0)
 Q $S(PSJPWD:$S($D(^PSI(58.1,"D",PSWS,PSJPWD)):1,$D(^PSD(58.8,"D",PSWS,PSJPWD)):1,1:0),1:0)
"RTN","PSJO1")
0^35^B28978821
"RTN","PSJO1",1,0)
PSJO1 ;BIR/CML3,PR-GET UNIT DOSE/IV ORDERS FOR INPATIENT ;15 May 98 / 9:28 AM
"RTN","PSJO1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,47,56,58,109,110**;16 DEC 97
"RTN","PSJO1",3,0)
 ;
"RTN","PSJO1",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJO1",5,0)
 ; Reference to ^%DTC is supported by DBIA# 10000.
"RTN","PSJO1",6,0)
 ; Reference to ^%ZOSV is supported by DBIA# 10097.
"RTN","PSJO1",7,0)
 ; Reference to XLFDT is supported by DBIA# 10103.
"RTN","PSJO1",8,0)
 ;
"RTN","PSJO1",9,0)
ECHK ;
"RTN","PSJO1",10,0)
 S C="A",ON=+O_"U",START=$G(^PS(55,PSGP,5,+O,2)),STOP=$P(START,U,4),START=$P(START,U,2) S:PSJOS START=-START
"RTN","PSJO1",11,0)
 I +START>PSGDT,(STOP>PSGDT) G SET
"RTN","PSJO1",12,0)
 S ND=$G(^PS(55,PSGP,5,+O,0)) G:$S($P(ND,"^",9)="":1,1:"DE"'[$P(ND,"^",9)) SET S ND4=$G(^PS(55,PSGP,5,+O,4)) I ST'="O",SD'<PSGODT,$S($P(ND,"^",9)="E":$P(ND4,"^",16),1:0)
"RTN","PSJO1",13,0)
 E  I ST="O",$P(ND,"^",9)="E",$S('$P(ND4,"^",UDU):1,SD<PSGODT:0,1:$P(ND4,"^",16))
"RTN","PSJO1",14,0)
 E  Q:PSJOL="S"  S C="O"
"RTN","PSJO1",15,0)
 ;
"RTN","PSJO1",16,0)
SET ;
"RTN","PSJO1",17,0)
 I ON["P",($D(PRNTON)!($D(P("PRNTON")))) N PSJOK S PSJOK=$$COMCHK($S($G(P("PRNTON"))]"":P("PRNTON"),$G(PRNTON)]"":PRNTON,1:""),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",18,0)
 NEW DRUGNAME D DRGDISP^PSJLMUT1(PSGP,ON,40,0,.DRUGNAME,1)
"RTN","PSJO1",19,0)
 S DN=DRUGNAME(1),SUB=$S(PSJOS:START,1:$E(DN,1,40))
"RTN","PSJO1",20,0)
 I ON["P",$G(P("PRNTON"))]"",$G(PRNTON)=+P("PRNTON") Q
"RTN","PSJO1",21,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",22,0)
 S ^TMP("PSJ",$J,C,$S(PSJOS:SUB,1:ST),$S(PSJOS:ST,1:SUB),ON)=DN_"^"_$G(NF),PSJOCNT=PSJOCNT+1 Q
"RTN","PSJO1",23,0)
 ;
"RTN","PSJO1",24,0)
IVSET ;Set IV data in ^TMP("PSJ",$J,.
"RTN","PSJO1",25,0)
 N DRG,DRGT,ON55,ORTX,P,STAT,TYP,X,Y,NAME,ND
"RTN","PSJO1",26,0)
 I ON["V" S ON55=ON,Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,4,9,17 S P(X)=$P(Y,U,X)
"RTN","PSJO1",27,0)
 I ON["V",(P(2)=""),(P(3)="") Q
"RTN","PSJO1",28,0)
 I ON'["V" S ND=$G(^PS(53.1,+ON,0)) I 'ND K ^PS(53.1,"AS",SD,PSGP,+ON) Q
"RTN","PSJO1",29,0)
 I ON'["V",ND S P(17)=$P($G(^PS(53.1,+ON,0)),U,9),Y=$G(^PS(53.1,+ON,2)),P(9)=$P(Y,U),P(2)=$P(Y,U,2),P(3)=$P(Y,U,4),P(4)=$P($G(^PS(53.1,+ON,8)),U),P("PRNTON")=$P($G(^PS(53.1,+ON,.2)),U,8)
"RTN","PSJO1",30,0)
 I ON'["V",P("PRNTON")]"" N PSJOK S PSJOK=$$COMCHK(P("PRNTON"),PSJPTYP) Q:'PSJOK
"RTN","PSJO1",31,0)
 D @$S(ON["V":"GTDRG^PSIVORFB",1:"GTDRG^PSIVORFA"),GTOT^PSIVUTL(P(4))
"RTN","PSJO1",32,0)
 I $G(DRG) S DRGT=$S($G(DRG("AD",1))]"":$P($G(DRG("AD",1)),U,2),1:$P($G(DRG("SOL",1)),U,2)),ORTX=DRGT
"RTN","PSJO1",33,0)
 I $G(ORTX)="",(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",34,0)
 ;* I $G(ORTX)=""!(ON'["V") D DRGDISP^PSJLMUT1(PSGP,+ON_"P",40,"",.NAME,1) S ORTX=NAME(1)
"RTN","PSJO1",35,0)
 S:$G(ORTX)="" ORTX="NOT FOUND"
"RTN","PSJO1",36,0)
 ;
"RTN","PSJO1",37,0)
IVSET1 ;
"RTN","PSJO1",38,0)
 ;* S TYP=$S(P(2)=P(3):"O",1:"C"),STAT=$S("ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",39,0)
 S TYP=$$ONE^PSJBCMA(PSGP,ON,P(9),P(2),P(3)) I TYP'="O" S TYP=$S(ON["P":"z",1:"C")
"RTN","PSJO1",40,0)
 S STAT=$S($G(PSJPRI)="D":"A","ED"[P(17):"O",P(17)="P":"P",1:"A")
"RTN","PSJO1",41,0)
 I P(17)="P" S STAT="C"_$S($P($G(^PS(53.1,+ON,.2)),U,8)]"":"D",$P($G(^PS(53.1,+ON,.2)),U,4)="S":"A",$P($G(^(0)),U,24)="R":"C",1:"B")
"RTN","PSJO1",42,0)
 I ON["P",$G(P("PRNTON"))]"",PRNTON=+P("PRNTON") Q
"RTN","PSJO1",43,0)
 I ON["P",$G(P("PRNTON"))]"" S PRNTON=+P("PRNTON"),ON=+P("PRNTON")
"RTN","PSJO1",44,0)
 S ^TMP("PSJ",$J,STAT,$S(PSJOS:-P(2),1:TYP),$S(PSJOS:TYP,1:ORTX),ON)="^F",PSJOCNT=PSJOCNT+1
"RTN","PSJO1",45,0)
 Q
"RTN","PSJO1",46,0)
 ;
"RTN","PSJO1",47,0)
ENU ; update status field to reflect expired orders, if necessary
"RTN","PSJO1",48,0)
 W !!,"...a few moments, I have some updating to do..."
"RTN","PSJO1",49,0)
ENUNM ;
"RTN","PSJO1",50,0)
 F Q=+PSJPAD:0 S Q=$O(^PS(55,PSGP,5,"AUS",Q)) Q:'Q!(Q>PSGDT)  S UPD=Q F QQ=0:0 S QQ=$O(^PS(55,PSGP,5,"AUS",Q,QQ)) Q:'QQ  I $D(^PS(55,PSGP,5,QQ,0)),"DEH"'[$E($P(^(0),"^",9)) D
"RTN","PSJO1",51,0)
 .; naked ref below refers to line above
"RTN","PSJO1",52,0)
 .S $P(^(0),"^",9)="E",ORIFN=$P(^(0),"^",21) D EN1^PSJHL2(PSGP,"SC",QQ_"U")
"RTN","PSJO1",53,0)
 K UPD Q
"RTN","PSJO1",54,0)
 ;
"RTN","PSJO1",55,0)
EN(PSJPTYP) ; enter here
"RTN","PSJO1",56,0)
 ; PSJPTYP=1:UD ONLY, 2:IV ONLY, 3:BOTH
"RTN","PSJO1",57,0)
 N PSJX,PSJY
"RTN","PSJO1",58,0)
 S PSJOL=$G(PSJOL)  ; Initialize if no 'View Profile' option selected
"RTN","PSJO1",59,0)
 I PSJOL="L",$D(XRTL) D T0^%ZOSV
"RTN","PSJO1",60,0)
 K ^TMP("PSJ",$J) D NOW^%DTC S PSGDT=+$E(%,1,12),DT=$$DT^XLFDT,PSJOS=$P(PSJSYSP0,"^",11),UDU=$S($P(PSJSYSU,";",3)>1:3,1:1)
"RTN","PSJO1",61,0)
 S PSJOCNT=0 I PSJPTYP>1 F PSJORD=0:0 S PSJORD=$O(^PS(55,DFN,"IV",PSJORD)) Q:'PSJORD  D
"RTN","PSJO1",62,0)
 .S PSJX=$G(^PS(55,DFN,"IV",+PSJORD,0))
"RTN","PSJO1",63,0)
 .S PSJY=$P(PSJX,U,17)
"RTN","PSJO1",64,0)
 .I $P(PSJX,U,3)<PSGDT,"AR"[PSJY S $P(^PS(55,DFN,"IV",+PSJORD,0),U,17)="E",PSJY="E",ON=+PSJORD D EXPIR^PSIVOE
"RTN","PSJO1",65,0)
 .I +PSJSYSU=3,('+$P($G(^PS(55,DFN,"IV",+PSJORD,4)),U,4)),($P($G(^(.2)),U,4)="D") S PSJPRI="D"
"RTN","PSJO1",66,0)
 .I $S($G(PSJPRI)="D":1,PSJY="P":0,PSJOL="L":1,1:"DPE"'[PSJY) S ON=+PSJORD_"V" D IVSET K PSJPRI
"RTN","PSJO1",67,0)
 D NOW^%DTC S PSJIVOF=PSJOCNT,PSGDT=%,(X1,DT)=$P(%,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),HDT=$$ENDTC^PSGMI(PSGDT)
"RTN","PSJO1",68,0)
 D ENUNM
"RTN","PSJO1",69,0)
 I PSJPTYP'=2 F ST="C","O","OC","P","R" F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F O=0:0 S O=$O(^PS(55,PSGP,5,"AU",ST,SD,O)) Q:'O  D ECHK
"RTN","PSJO1",70,0)
 Q:$D(PSGONNV)
"RTN","PSJO1",71,0)
 ;I PSJPTYP'=2 F SD="I","N" S O=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",72,0)
 N PRNTON F SD="I","N" S (PRNTON,O)=0 F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=+O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D NVSET
"RTN","PSJO1",73,0)
 ;I $S(+PSJSYSU=3:1,1:$D(PSGLPF)) S O=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",74,0)
 N PRNTON S (PRNTON,O)=0,SD="P" F  S O=$O(^PS(53.1,"AS",SD,PSGP,O)) Q:'O  S ON=O_"P",X=$P($G(^PS(53.1,+O,0)),U,4) I $S(PSJPTYP=3:1,PSJPTYP=1&("FI"[X):0,1:1) D @$S("FI"[X:"IVSET",1:"NVSET")
"RTN","PSJO1",75,0)
 I PSJOL="L",$D(XRT0) S XRTN="PSJO1" D T1^%ZOSV
"RTN","PSJO1",76,0)
 Q
"RTN","PSJO1",77,0)
 ;
"RTN","PSJO1",78,0)
NVSET ; Set up orders from 53.1.
"RTN","PSJO1",79,0)
 N ND S ND=$G(^PS(53.1,O,0)) I 'ND D  Q
"RTN","PSJO1",80,0)
 .K ^PS(53.1,"AS",SD,PSGP,O)
"RTN","PSJO1",81,0)
 S ST=$P($G(^PS(53.1,O,0)),U,7),START=-$P($G(^(2)),U,2),P("PRNTON")=$P($G(^PS(53.1,O,.2)),"^",8) S:ST="" ST="z"
"RTN","PSJO1",82,0)
 S C=$S(((SD="N")&($P($G(^PS(53.1,O,.2)),U,8)]"")):"BD",SD="N":"BA",SD="I":"BB",$P($G(^PS(53.1,O,.2)),U,8)]"":"CD",$P($G(^PS(53.1,O,.2)),U,4)="S":"CA",$P($G(^(0)),U,24)="R":"CC",1:"CB")
"RTN","PSJO1",83,0)
 ;I C="CC" S C=$$CKPC^PSGOU(PSGP,+$P($G(^PS(53.1,O,0)),U,25),O)
"RTN","PSJO1",84,0)
 D SET
"RTN","PSJO1",85,0)
 Q
"RTN","PSJO1",86,0)
 ;
"RTN","PSJO1",87,0)
KILL ;
"RTN","PSJO1",88,0)
 K P,STAT,TYP,ORTX,N,JJ
"RTN","PSJO1",89,0)
 Q
"RTN","PSJO1",90,0)
COMCHK(PSJCOM,PSJPTYP) ;Check complex orders for order type
"RTN","PSJO1",91,0)
 S OK=0
"RTN","PSJO1",92,0)
 I PSJCOM=0 S OK=1 Q OK
"RTN","PSJO1",93,0)
 I PSJCOM=""  Q OK
"RTN","PSJO1",94,0)
 I PSJPTYP="" Q OK
"RTN","PSJO1",95,0)
 I '$D(^PS(53.1,"ACX",PSJCOM)) Q OK
"RTN","PSJO1",96,0)
 S OK=1 I PSJPTYP=3 Q OK
"RTN","PSJO1",97,0)
 N PSJON S PSJON=""
"RTN","PSJO1",98,0)
 F  S PSJON=$O(^PS(53.1,"ACX",PSJCOM,PSJON)) Q:'PSJON  D  Q:OK=0
"RTN","PSJO1",99,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)'="U",PSJPTYP=1 S OK=0 Q
"RTN","PSJO1",100,0)
 .I $P($G(^PS(53.1,PSJON,0)),"^",4)="U",PSJPTYP=2 S OK=0 Q
"RTN","PSJO1",101,0)
 Q OK
"RTN","PSJOE")
0^36^B81121922
"RTN","PSJOE",1,0)
PSJOE ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**7,26,29,33,42,50,56,72,58,85,95,80,110**;16 DEC 97
"RTN","PSJOE",3,0)
 ;
"RTN","PSJOE",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOE",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOE",6,0)
 ; Reference to FULL^VALM1 and PAUSE^VALM1 is supported by DBIA #10116.
"RTN","PSJOE",7,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOE",8,0)
 ; Reference to ^DPT is supported by DBIA #10035.
"RTN","PSJOE",9,0)
 ; Reference to ^ORCFLAG is supported by DBIA #3620.
"RTN","PSJOE",10,0)
 ; Reference to ^SDAMA203 is supported by DBIA #4133.
"RTN","PSJOE",11,0)
 ;
"RTN","PSJOE",12,0)
EN ; Start Inpatient LM OE
"RTN","PSJOE",13,0)
 N PSJLK,PSJNEWOE,PSJLMCON,PSJPROT,XQORS,VALMEVL D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",14,0)
 I $D(XQUIT) K XQUIT G DONE
"RTN","PSJOE",15,0)
 K PSGVBY,PSJPR S (PSJOL,PSJACOK,PSGOP,PSGNEF,PSGOEAV,PSGPXN)="" L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE^PSJOE
"RTN","PSJOE",16,0)
 F  S (PSJLMCON,PSGPTMP)=0 D ^PSJP,HK Q:PSGP'>0  S PSJPROT=3,DFN=PSGP D ^PSJAC D  I PSJLK D UL^PSSLOCK(PSGP)
"RTN","PSJOE",17,0)
 .K ^TMP("PSJ",$J)
"RTN","PSJOE",18,0)
 .S PSJLK=$$L^PSSLOCK(PSGP,1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSJOE",19,0)
 .K PSJLMPRO D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",20,0)
 .N NXTPT S NXTPT=0 F  Q:$G(NXTPT)  D
"RTN","PSJOE",21,0)
 ..K PSGRDTX
"RTN","PSJOE",22,0)
 ..I $G(PSJLMCON)!$G(PSJNEWOE) D
"RTN","PSJOE",23,0)
 ...S PSJOL=$S(",S,L,"[(","_$G(PSJOL)_","):PSJOL,1:"S")
"RTN","PSJOE",24,0)
 ...S PSJLMPRO=1,PSJLMCON=1,PSJNEWOE=0 D EN^VALM("PSJ LM OE")
"RTN","PSJOE",25,0)
 ..I $G(PSJNEWOE)!($G(VALMBCK)="Q") S PSJNEWOE=0 Q
"RTN","PSJOE",26,0)
 ..I $G(PSJLMCON)&$G(PSJLMPRO)&'$D(^TMP("PSJ",$J)) D  Q
"RTN","PSJOE",27,0)
 ...S PSJLMCON=0,PSJLMPRO=0 D EN^VALM("PSJ LM BRIEF PATIENT INFO")
"RTN","PSJOE",28,0)
 ...I $G(PSJNEWOE) S NXTPT=0 Q
"RTN","PSJOE",29,0)
 ...S NXTPT=1
"RTN","PSJOE",30,0)
 ..S NXTPT=1,PSJNEWOE=0
"RTN","PSJOE",31,0)
 .S PSJOL="S"
"RTN","PSJOE",32,0)
 .I $G(PSGPXN) I $P(PSJSYSW0,U,29)]""!($G(PSJCOM)) S PSGPXPT=PSGP D  K PSGPXPT S PSGPXN=0
"RTN","PSJOE",33,0)
 ..N DFN,PSGP,PSJPXDP
"RTN","PSJOE",34,0)
 ..I $P(PSJSYSW0,U,29)="" S PSJPDXP=1,$P(PSJSYSW0,U,29)=$I
"RTN","PSJOE",35,0)
 ..S (PSGP,DFN)=PSGPXPT D ^PSGPER S:$G(PSJPDXP) $P(PSJSYSW0,U,29)="" K PSJPDXP
"RTN","PSJOE",36,0)
 .D ENCV^PSGSETU,^PSIVXU
"RTN","PSJOE",37,0)
 K PSJLMPRO,^TMP("PSJPRO",$J),^TMP("PSJ",$J),^TMP("PSJON",$J)
"RTN","PSJOE",38,0)
 ;
"RTN","PSJOE",39,0)
DONE ;
"RTN","PSJOE",40,0)
 K AC,ACTION,D1,D2,MI,N,ON,P3,PNOW,PSIVAT,PSIVLN,PSIVSTR L -^PS(53.45,PSJSYSP)
"RTN","PSJOE",41,0)
 K DA,DRG,NE,PSGCF,PSGCANFL,PSGNEDFD,PSGNEF,PSGNEFD,PSGNEPR,PSGNESD,PSJACOK,PSJOE,PSJOECNT,PSJOEPF,PSJORD,PSGOEA,PSGOEAV,PSGOL,PSGOS,PSGON,PSGOP,PSGORD,PSGS0XT,PSGS0Y,RCT,ST,WD,XREF,Z,PSJIVORF,PSJIVPCL
"RTN","PSJOE",42,0)
 K PSGOEORF,PSIVREA,PSJOPC,PSJORL,PSJORPCL,PSJORTOI,RF,WSCHADM,PSJLM
"RTN","PSJOE",43,0)
 K DIU,DRGI,FLAG,FQC,ND2,PRI,PSGOE,PSGPRI,PSGSDN,PSGOEDMR,PSGOEPR,PSGPTS,PSGTOL,PSGTOO,PSGUOW,PSJIVOF,PSJOCNT,PSJON,PSJORQF,PSJORTOU,PSJORVP
"RTN","PSJOE",44,0)
 G:($G(PSGPXN)&'$$DEFON^PSGPER1) ^PSGPER1 D ENIVKV^PSGSETU
"RTN","PSJOE",45,0)
 Q
"RTN","PSJOE",46,0)
 ;
"RTN","PSJOE",47,0)
HK ; HouseKeeping (a nice COBOL term)
"RTN","PSJOE",48,0)
 I PSGOP,PSGOP'=PSGP D
"RTN","PSJOE",49,0)
 .N PSJACPF,PSJACNWP,PSJPWD,PSJSYSL,PSJSYSW,PSJSYSW0,DFN,VAIN,VAERR S DFN=PSGOP
"RTN","PSJOE",50,0)
 .D INP^VADPT S PSJPWD=+VAIN(4) I PSJPWD S PSJACPF=10 D WP^PSJAC D:$P(PSJSYSL,"^",2)]"" ENQL^PSGLW
"RTN","PSJOE",51,0)
 Q:PSGP<0
"RTN","PSJOE",52,0)
 S (DFN,PSGOP)=PSGP,X=""
"RTN","PSJOE",53,0)
 Q
"RTN","PSJOE",54,0)
 ;
"RTN","PSJOE",55,0)
SELECT ; Select order from list
"RTN","PSJOE",56,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J)
"RTN","PSJOE",57,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0) D ENASR^PSGON
"RTN","PSJOE",58,0)
 I "^"[X S VALMQUIT=1 Q
"RTN","PSJOE",59,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL!($G(Y)<0)  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",60,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA Q:PSJORD=""!($G(Y)<0)  Q:PSJORD=+PSJORD  D
"RTN","PSJOE",61,0)
 ..Q:('$$LS^PSSLOCK(PSGP,PSJORD))
"RTN","PSJOE",62,0)
 ..Q:PSJORD=+PSJORD
"RTN","PSJOE",63,0)
 ..S PSGORD=""
"RTN","PSJOE",64,0)
 ..D DISACTIO(PSGP,PSJORD,"") S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",65,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD) Q:$G(Y)<0
"RTN","PSJOE",66,0)
 S VALMBCK="Q"
"RTN","PSJOE",67,0)
 K PSJLM
"RTN","PSJOE",68,0)
 Q
"RTN","PSJOE",69,0)
 ;
"RTN","PSJOE",70,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOE",71,0)
 ; DFN    - Patient IEN
"RTN","PSJOE",72,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOE",73,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOE",74,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55
"RTN","PSJOE",75,0)
 D OLDCOM^PSJOE0(DFN,PSJORD)
"RTN","PSJOE",76,0)
 S PSGP=DFN D ENIV^PSJAC I PSJORD["V" D EN^PSJLIORD(DFN,PSJORD) Q
"RTN","PSJOE",77,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOE",78,0)
 ;S PSGPD=$S(PSJORD["P":$P($G(^PS(53.1,+PSJORD,.2)),U),1:$P($G(^PS(55,DFN,5,+PSJORD,.2)),U))
"RTN","PSJOE",79,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOE",80,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOE",81,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOE",82,0)
 . I PSJORD["U" L +^PS(55,PSGP,5,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",83,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOE",84,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOE",85,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOE",86,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",87,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) L -^PS(53.1,+PSJORD) Q
"RTN","PSJOE",88,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOE",89,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOE",90,0)
 .. N ON S ON=PSJORD D VF^PSIVORC2
"RTN","PSJOE",91,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOE",92,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOE",93,0)
 ..I $P(PSJXX1,U,4)="U",(+PSJPDD) D  Q:$G(PSJIVFLG)
"RTN","PSJOE",94,0)
 ... N VAIP S CLINIC=$G(^PS(53.1,+PSJORD,"DSS")),APPT=$P(CLINIC,"^",2),CLINIC=$P(CLINIC,"^") I $$PATCH^XPDUTL("SD*5.3*285") I $$SDIMO^SDAMA203(CLINIC,DFN)>-1 Q
"RTN","PSJOE",95,0)
 ... W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1
"RTN","PSJOE",96,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOE",97,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOE",98,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOE",99,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") Q
"RTN","PSJOE",100,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOE",101,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOE",102,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOE",103,0)
 I PSJORD["P" L -^PS(53.1,+PSJORD)
"RTN","PSJOE",104,0)
 I PSJORD["U" L -^PS(55,PSGP,5,+PSJORD)
"RTN","PSJOE",105,0)
 ;Send SN to CPRS if autoverify OFF and Order Set Entry and no 21st piece
"RTN","PSJOE",106,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOE",107,0)
 D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOE",108,0)
 Q
"RTN","PSJOE",109,0)
EDIT(PSGP,PSGORD,PROMPT) ;
"RTN","PSJOE",110,0)
 I "DE"[$$GTSTATUS(PSGP,PSGORD) W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",111,0)
 I PSGACT'["E" W !,"This order may not be edited." D PAUSE^VALM1 Q
"RTN","PSJOE",112,0)
 S PSGNEDFD="" D HOLDHDR,@$S('PROMPT:"ENEFA2^PSGON",1:"ENEFA^PSGON") I 'Y D ABORT^PSGOEE Q
"RTN","PSJOE",113,0)
 I PSGORD["P" D ENF^PSGOEE Q
"RTN","PSJOE",114,0)
 D ACT^PSGOEE
"RTN","PSJOE",115,0)
 Q
"RTN","PSJOE",116,0)
RENEW(PSGP,PSGORD) ;
"RTN","PSJOE",117,0)
 D HOLDHDR
"RTN","PSJOE",118,0)
 I 'PSJSYSU,$P($G(^PS(55,PSGP,5,+PSGORD,4)),U,15),$P($G(^(4)),U,16) W !!,"This order is already marked for renewal!" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","PSJOE",119,0)
 I 'PSGRRF D ^PSGOER Q
"RTN","PSJOE",120,0)
 D ^PSGOERI
"RTN","PSJOE",121,0)
 Q
"RTN","PSJOE",122,0)
 ;
"RTN","PSJOE",123,0)
GTSTATUS(DFN,ON)   ;
"RTN","PSJOE",124,0)
 I ON["P" Q $P($G(^PS(53.1,+ON,0)),U,9)
"RTN","PSJOE",125,0)
 I ON["U" Q $P($G(^PS(55,DFN,5,+ON,0)),U,9)
"RTN","PSJOE",126,0)
 Q $P($G(^PS(55,DFN,"IV",+ON,0)),U,17)
"RTN","PSJOE",127,0)
 ;
"RTN","PSJOE",128,0)
DC(DFN,PSJORD) ; DC IV, UD, or pending orders.
"RTN","PSJOE",129,0)
 D HOLDHDR
"RTN","PSJOE",130,0)
 S X=$$GTSTATUS(DFN,PSJORD) I X="D"!(X="DE") W !,"This order has already been DISCONTINUED." D PAUSE^VALM1 Q
"RTN","PSJOE",131,0)
 D ENO^PSGOEC(DFN,PSJORD) ;,GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S VALMBCK="Q"
"RTN","PSJOE",132,0)
 S VALMBCK="Q"
"RTN","PSJOE",133,0)
 Q
"RTN","PSJOE",134,0)
HOLD(DFN,PSJORD) ; Change order's status from ACTIVE<->HOLD
"RTN","PSJOE",135,0)
 D HOLDHDR
"RTN","PSJOE",136,0)
 I PSJORD["V" D H^PSIVOPT(DFN,PSJORD,P(17),P(3))
"RTN","PSJOE",137,0)
 I PSJORD'["V" D H^PSGOE1(DFN,PSJORD)
"RTN","PSJOE",138,0)
 D GETUD^PSJLMGUD(DFN,PSJORD),INIT^PSJLMUDE(DFN,PSJORD) S PSGACT=$$ENACTION^PSGOE1(DFN,PSJORD),VALMBCK="R"
"RTN","PSJOE",139,0)
 Q
"RTN","PSJOE",140,0)
 ;
"RTN","PSJOE",141,0)
COPY(PSGP,PSGORD)  ; Copy an order (does not discontinue original order)
"RTN","PSJOE",142,0)
 I $D(PSGCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",143,0)
 ;I PSGORD["V" N PSIVCOPY S PSIVCOPY=1 W !!,"You cannot copy an IV order." D PAUSE^VALM1 Q
"RTN","PSJOE",144,0)
 I PSGORD["P" W !!,"You cannot copy this "_$S($G(PSGSTAT)]"":PSGSTAT,1:"PENDING IV")_" order." D PAUSE^VALM1 Q
"RTN","PSJOE",145,0)
 I PSGORD["V" D  Q
"RTN","PSJOE",146,0)
 .I $G(PSIVCOPY) W !!,"You cannot copy the order at this time" D PAUSE^VALM1 Q
"RTN","PSJOE",147,0)
 .D COPY^PSIVOD(PSGP,PSGORD) Q
"RTN","PSJOE",148,0)
 Q:'$$HIDDEN^PSJLMUTL("COPY")
"RTN","PSJOE",149,0)
 D ^PSJHVARS
"RTN","PSJOE",150,0)
 I $P($G(^PS(55,PSGP,5,+PSGORD,.2)),U,4)="D",'$P($G(^(4)),"^",3) W !!,"Nurse verified orders with a priority of DONE may not be Copied." D PAUSE^VALM1 Q
"RTN","PSJOE",151,0)
 S PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU
"RTN","PSJOE",152,0)
 S PSGCOPY=1
"RTN","PSJOE",153,0)
 D FULL^VALM1,^PSGOD
"RTN","PSJOE",154,0)
 S VALMBCK="R"
"RTN","PSJOE",155,0)
 K PSGCOPY
"RTN","PSJOE",156,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSGORD) ; resets PSGACT after copy
"RTN","PSJOE",157,0)
 D RESTORE^PSJHVARS
"RTN","PSJOE",158,0)
 Q
"RTN","PSJOE",159,0)
 ;
"RTN","PSJOE",160,0)
UPDATE ; Refresh array, actions, & display.
"RTN","PSJOE",161,0)
 D GETUD^PSJLMGUD(DFN,ON),INIT^PSJLMUDE(DFN,ON) S VALMBCK="R"
"RTN","PSJOE",162,0)
 Q
"RTN","PSJOE",163,0)
FINISH ;
"RTN","PSJOE",164,0)
 D FINISH^PSGOEF,PAUSE^VALM1
"RTN","PSJOE",165,0)
 Q
"RTN","PSJOE",166,0)
 ;
"RTN","PSJOE",167,0)
LOG(DFN,PSGORD)        ;
"RTN","PSJOE",168,0)
 D FULL^VALM1,ENLM^PSGOEL(DFN,PSGORD),PAUSE^VALM1 S VALMBCK="R"
"RTN","PSJOE",169,0)
 Q
"RTN","PSJOE",170,0)
NEWSEL ;
"RTN","PSJOE",171,0)
 N PSGLMT,PSGODDD,PSJLMQT,PSJLMFIN,PSJUDPRF,PSGRDTX K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J)
"RTN","PSJOE",172,0)
 S X=$P(XQORNOD(0),"=",2)
"RTN","PSJOE",173,0)
 S PSGONC=1,PSGLMT=^TMP("PSJPRO",$J,0)
"RTN","PSJOE",174,0)
 D ENCHK^PSGON I '$O(PSGODDD(0)) S VALMQUIT=1 Q
"RTN","PSJOE",175,0)
 S PSJLM=1,PSJSEL=0 F  S PSJSEL=$O(PSGODDD(PSJSEL)) Q:'PSJSEL  F PSJSEL1=1:1:$L(PSGODDD(PSJSEL),",")-1 D
"RTN","PSJOE",176,0)
 .;S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) Q:PSJORD=""  D DISACTIO(PSGP,PSJORD,$G(PSJPNV))
"RTN","PSJOE",177,0)
 .S PSJORD=$G(^TMP("PSJON",$J,+$P(PSGODDD(PSJSEL),",",PSJSEL1))) D:PSJORD=+PSJORD SELECT^PSJOEA
"RTN","PSJOE",178,0)
 .Q:PSJORD=+PSJORD 
"RTN","PSJOE",179,0)
 .Q:PSJORD=""!($G(Y)<0)  Q:('$$LS^PSSLOCK(PSGP,PSJORD))  D
"RTN","PSJOE",180,0)
 ..S PSGORD=""
"RTN","PSJOE",181,0)
 ..S ON=PSJORD
"RTN","PSJOE",182,0)
 ..D DISACTIO(PSGP,PSJORD,$G(PSJPNV)) S:PSJORD["V" PSJORD=ON
"RTN","PSJOE",183,0)
 ..D UNL^PSSLOCK(PSGP,PSJORD) Q:$G(Y)<0
"RTN","PSJOE",184,0)
 S VALMBCK="Q"
"RTN","PSJOE",185,0)
 K PSJLM
"RTN","PSJOE",186,0)
 Q
"RTN","PSJOE",187,0)
HOLDHDR ; Freeze header text while processing order actions
"RTN","PSJOE",188,0)
 I $D(VALM("TM")) S IOTM=VALM("TM"),IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PSJOE",189,0)
 Q
"RTN","PSJOE",190,0)
LOCKERR ;
"RTN","PSJOE",191,0)
 W !!,$C(7),"You are entering or editing an Inpatient Medication order in another session.",!,"Only one order entry/edit session is allowed for a user at a time.",!! N DIR S DIR(0)="E" D ^DIR
"RTN","PSJOE",192,0)
 Q
"RTN","PSJOE",193,0)
FLAG(DFN,PSJORD) ;Flag order through CPRS entrypoint.
"RTN","PSJOE",194,0)
 N ORIFN,NODE0
"RTN","PSJOE",195,0)
 S NODE0=$S(PSJORD["V":$G(^PS(55,DFN,"IV",+PSJORD,0)),PSJORD["U":$G(^PS(55,DFN,5,+PSJORD,0)),1:^PS(53.1,+PSJORD,0))
"RTN","PSJOE",196,0)
 S ORIFN=$P(NODE0,"^",21)
"RTN","PSJOE",197,0)
 D EN1^ORCFLAG(ORIFN)
"RTN","PSJOE",198,0)
 D PAUSE^VALM1
"RTN","PSJOE",199,0)
 Q
"RTN","PSJOE",200,0)
 ;
"RTN","PSJOE",201,0)
COMPLEX(DFN,ON) ;
"RTN","PSJOE",202,0)
 N NDP2,COM
"RTN","PSJOE",203,0)
 S NDP2=$S(ON["P":$G(^PS(53.1,+ON,.2)),ON["U":$G(^PS(55,DFN,5,+ON,.2)),ON["V":$G(^PS(55,DFN,"IV",+ON,.2)),1:"")
"RTN","PSJOE",204,0)
 S COM=$P(NDP2,"^",8) I COM Q 1
"RTN","PSJOE",205,0)
 Q 0
"RTN","PSJOE0")
0^37^B27809362
"RTN","PSJOE0",1,0)
PSJOE0 ;BIR/CML3-INPATIENT PROFILE AND ORDER ENTRY ;17 SEP 97 /  1:41 PM
"RTN","PSJOE0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**47,56,110**;16 DEC 97
"RTN","PSJOE0",3,0)
 ;
"RTN","PSJOE0",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJOE0",5,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJOE0",6,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJOE0",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJOE0",8,0)
 ;
"RTN","PSJOE0",9,0)
START ; print orders
"RTN","PSJOE0",10,0)
 W:X]"" $P("^PROFILE",X,2) D ENL^PSJO3 G:PSJOL="^" DONE Q:PSJOL="N"  K PSJPR S PSGOEAV=0,PSJNARC=1 D ^PSJO I 'PSJON Q
"RTN","PSJOE0",11,0)
 ;
"RTN","PSJOE0",12,0)
ENVW ; ask user to select or view any of the orders shown
"RTN","PSJOE0",13,0)
 S (PSGONC,PSGONR,PSGONV)=0,PSGLMT=PSJON S:$D(PSJPRF) PSGPRF=1 D ENASR^PSGON K PSGPRF
"RTN","PSJOE0",14,0)
 ;G:X="^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",15,0)
 G:X["^" DONE I X]"" S PSGOEA=""
"RTN","PSJOE0",16,0)
 K PSJDLW
"RTN","PSJOE0",17,0)
 I  F PSJOE=1:1:PSGODDD S PSGOE=PSJOE F PSJOE1=1:1:$L(PSGODDD(PSJOE),",")-1 S PSJOE2=$P(PSGODDD(PSJOE),",",PSJOE1),(PSGORD,PSJORD)=^TMP("PSJON",$J,PSJOE2) G:$D(PSJDLW) DONE D 
"RTN","PSJOE0",18,0)
 .I PSJORD=+PSJORD N PSJO,PSJO1 S PSJO=PSJORD,PSJO1=0 F  S PSJO1=$O(^PS(53.1,"ACX",PSJO,PSJO1)) Q:'PSJO1  Q:PSGOEA["^"  Q:$D(PSJDLW)  S PSJORD=PSJO1_"P" D GODO S PSJORD=""
"RTN","PSJOE0",19,0)
 .Q:PSJORD=""  Q:PSGOEA["^"
"RTN","PSJOE0",20,0)
 .D GODO Q:PSGOEA["^"
"RTN","PSJOE0",21,0)
 Q
"RTN","PSJOE0",22,0)
 ;
"RTN","PSJOE0",23,0)
LMNEW(PSGP,PSJPROT) ;Entry point for new order entry from listman.
"RTN","PSJOE0",24,0)
 ; PSGP = DFN
"RTN","PSJOE0",25,0)
 ; PSJPROT=1:UD ONLY; 2:IV ONLY; 3:BOTH
"RTN","PSJOE0",26,0)
 ;
"RTN","PSJOE0",27,0)
 ;S VALM("BM")=9 D CKNEW
"RTN","PSJOE0",28,0)
 D CKNEW N PSJUDPRF S PSJNEWOE=1
"RTN","PSJOE0",29,0)
 S PSGPTS=PSJPTS,PSGOEAV=$P(PSJSYSP0,U,9)&PSJSYSU,PSGOEDMR=$O(^PS(51.2,"B","ORAL",0)),PSGOEPR=$S($D(^PS(55,PSGP,5.1)):$P(^(5.1),"^",2),1:0),PSJORQF=0,PSJOEPF=""
"RTN","PSJOE0",30,0)
 I PSGOEPR>0,$D(^VA(200,+PSGOEPR,"PS")) S PSGOEPR=$S('$P(^("PS"),"^",4):PSGOEPR,($P(^("PS"),"^",4)<DT):0,1:PSGOEPR)
"RTN","PSJOE0",31,0)
 S:'PSGOEPR PSGOEPR=PSJPTSP
"RTN","PSJOE0",32,0)
 ;* F PSJOE=0:0 Q:PSJORQF  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1,(+PSJSYSU=3) D ENIN^PSIVORE
"RTN","PSJOE0",33,0)
 ;F PSJOE=0:0 Q:PSJORQF  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",34,0)
 ; line below fixes bug in line above - infinite loop when selecting New Order in Unit Dose OE for Outpatient.
"RTN","PSJOE0",35,0)
 F PSJOE=0:0 Q:PSJORQF!('(PSJPCAF&(PSJPROT'=2))&(PSJPROT'>1))  D:PSJPCAF&(PSJPROT'=2) EN^PSJOE1 K PSGEFN,PSGOEF I PSJPROT>1 D ENIN^PSIVORE
"RTN","PSJOE0",36,0)
 Q
"RTN","PSJOE0",37,0)
 ;
"RTN","PSJOE0",38,0)
DONE ;
"RTN","PSJOE0",39,0)
 K PSG,PSGDL,PSGDLS,PSGDO,PSGDRG,PSGDRGN,PSGFD,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGOES,PSGOPR,PSGORD,PSGOROE1,PSGPR,PSGPRN,PSGS0XT,PSGS0Y,PSGSCH,PSGSD,PSGSI,PSGSM,PSGST,PSGSTN,PSGUD,PSGX,PSJDLW,PSJLM,PSJNARC,PSIVAC
"RTN","PSJOE0",40,0)
 K P,PSGEFN,PSGOEEF
"RTN","PSJOE0",41,0)
 Q
"RTN","PSJOE0",42,0)
 ;
"RTN","PSJOE0",43,0)
CKNEW ;
"RTN","PSJOE0",44,0)
 K CF,CHK,OD,PSGLMT,PSGODDD,PSGOEA,PSGON,PSGONC,PSGONR,PSGONV,PSJOE1,PSJOE2 Q:$D(PSJPRF)
"RTN","PSJOE0",45,0)
 I $P(PSJPDD,"^",3) W !!?2,"Patient is shown as deceased.  You may not enter orders for this patient." D CONT Q
"RTN","PSJOE0",46,0)
 I 'PSJPCAF W !!,"(NOTE: You cannot enter Unit Dose orders for this patient.)" D CONT
"RTN","PSJOE0",47,0)
 Q
"RTN","PSJOE0",48,0)
 ;
"RTN","PSJOE0",49,0)
CONT ;
"RTN","PSJOE0",50,0)
 K DIR S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR
"RTN","PSJOE0",51,0)
 Q
"RTN","PSJOE0",52,0)
 ;
"RTN","PSJOE0",53,0)
GODO ;Display selected order.
"RTN","PSJOE0",54,0)
 S PSIVAC="C" I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),"^",4)="F",1:0) D @$S($D(PSJPRP):"ENINP^PSIVOPT(DFN,PSJORD)",1:"ENIN^PSIVOPT") G GODO1
"RTN","PSJOE0",55,0)
 I '$D(PSJPRP),(PSJORD["P"),($P($G(^PS(53.1,+PSJORD,0)),U,4)="I") D ASKTYP Q:$D(DIRUT)  I Y="I" D ENIN^PSIVOPT G GODO1
"RTN","PSJOE0",56,0)
 S PSGORD=PSJORD D EN2^PSGVW,^PSGOE1:'$D(PSJPRF)
"RTN","PSJOE0",57,0)
GODO1 ;
"RTN","PSJOE0",58,0)
 I $D(PSJPRP),'PSJPR K DIR S DIR(0)="E" D ^DIR K DIR S:$D(DUOUT)!$D(DTOUT) PSJDLW=1 Q:$D(PSJDLW)  W:$Y @IOF
"RTN","PSJOE0",59,0)
 Q
"RTN","PSJOE0",60,0)
 ;
"RTN","PSJOE0",61,0)
ASKTYP ; Ask if completing as IV or UD.
"RTN","PSJOE0",62,0)
 Q
"RTN","PSJOE0",63,0)
 W !! D PIV^PSIVUTL(+PSJORD_"P")
"RTN","PSJOE0",64,0)
 I $G(PSJPDD) S DIR(0)="E" D ^DIR S Y="I" Q
"RTN","PSJOE0",65,0)
 W ! K DIR S DIR(0)="SOA^U:Unit Dose;I:IV Medication",DIR("A")="Do you wish to complete this as an IV or Unit Dose order (I/U)? ",DIR("?")="^D PENDIU^PSJO3" D ^DIR
"RTN","PSJOE0",66,0)
 Q
"RTN","PSJOE0",67,0)
 ;
"RTN","PSJOE0",68,0)
OLDCOM(DFN,PSJORD) ;
"RTN","PSJOE0",69,0)
 Q:$$COMPLEX^PSJOE(DFN,PSJORD)
"RTN","PSJOE0",70,0)
 N DURFLG S DURFLG=$S($G(PSJORD)["P":$G(^PS(53.1,+PSJORD,2.5)),$G(PSJORD)["V":$G(^PS(55,DFN,"IV",+PSJORD,2.5)),1:$G(^PS(55,DFN,5,+PSJORD,2.5))) I $P(DURFLG,"^",2)]"" D
"RTN","PSJOE0",71,0)
 . D CLEAR^VALM1 W !!!!!?21," * WARNING * "
"RTN","PSJOE0",72,0)
 . W !!!?5,"The following order contains a Requested Duration"
"RTN","PSJOE0",73,0)
 . W !?12,"and may be part of a complex dose!"
"RTN","PSJOE0",74,0)
 . W !!," Review the entire profile to determine appropriate action(s).",!!!!!!! D PAUSE^VALM1
"RTN","PSJOE0",75,0)
 . D CLEAR^VALM1 W !!!!!?21," * WARNING * "
"RTN","PSJOE0",76,0)
 . W !!!?5,"The following order contains a Requested Duration"
"RTN","PSJOE0",77,0)
 . W !?12,"and may be part of a complex dose!"
"RTN","PSJOE0",78,0)
 . W !!," Review the entire profile to determine appropriate action(s).",!!!!!!! D PAUSE^VALM1
"RTN","PSJOE0",79,0)
 Q
"RTN","PSJOE0",80,0)
AM ;
"RTN","PSJOE0",81,0)
 W !!?2,"Enter a 'Y' (or press the RETURN key) to enter new INPATIENT orders for this",!,"patient.  Enter an 'N' (or an '^') if there are no new orders for this patient."
"RTN","PSJOE0",82,0)
 W:'PSJPCAF !!?2,"PLEASE NOTE: The patient selected is NOT shown as currently admitted.",!,"Therefore, you cannot enter Unit Dose orders for this patient.  (You can enter",!,"IV orders.)" Q
"RTN","PSJOEA")
0^42^B27155160
"RTN","PSJOEA",1,0)
PSJOEA ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSJOEA",3,0)
 ;
"RTN","PSJOEA",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOEA",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOEA",7,0)
 ; Reference to ^DPT is supported by DBIA #10035.
"RTN","PSJOEA",8,0)
 ;
"RTN","PSJOEA",9,0)
LOCK(DFN,PSJORD) ; Check to see if the order is already locked
"RTN","PSJOEA",10,0)
 N Q S Q=0
"RTN","PSJOEA",11,0)
 I PSJORD=+PSJORD N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  S Q=$$LS^PSSLOCK(DFN,PSJO_"P") I 'Q Q
"RTN","PSJOEA",12,0)
 I Q Q 1
"RTN","PSJOEA",13,0)
 Q 0
"RTN","PSJOEA",14,0)
 ;
"RTN","PSJOEA",15,0)
SELECT ;
"RTN","PSJOEA",16,0)
 Q:PSJORD=""!($G(Y)<0)  Q:('$$LOCK^PSJOEA(PSGP,PSJORD))
"RTN","PSJOEA",17,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",18,0)
 .S PSGORD=""
"RTN","PSJOEA",19,0)
 .S ON=PSJO_"P"
"RTN","PSJOEA",20,0)
 .D DISACTIO(PSGP,PSJO_"P",$G(PSJPNV)) S:$G(PSJO)["V" O=ON
"RTN","PSJOEA",21,0)
 I $D(^TMP("PSJCOM",$J)) D CHK^PSJOEA1
"RTN","PSJOEA",22,0)
 S:'$G(PSGP) PSGP=$G(DFN)
"RTN","PSJOEA",23,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",24,0)
 .D UNL^PSSLOCK(PSGP,PSJO_"P") Q:$G(Y)<0
"RTN","PSJOEA",25,0)
 Q
"RTN","PSJOEA",26,0)
 ;
"RTN","PSJOEA",27,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOEA",28,0)
 ; DFN    - Patient IEN
"RTN","PSJOEA",29,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOEA",30,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOEA",31,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55
"RTN","PSJOEA",32,0)
 Q:PSJORD'["P"
"RTN","PSJOEA",33,0)
 S PSGP=DFN D ENIV^PSJAC
"RTN","PSJOEA",34,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOEA",35,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOEA",36,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOEA",37,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOEA",38,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOEA",39,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOEA",40,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOEA",41,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",42,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",43,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOEA",44,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOEA",45,0)
 .. D GT531^PSIVORFA(+PSGP,PSJORD),VF^PSIVORC2
"RTN","PSJOEA",46,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOEA",47,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOEA",48,0)
 ..I $P(PSJXX1,U,4)="U",(+PSJPDD) W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1 Q
"RTN","PSJOEA",49,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOEA",50,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOEA",51,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOEA",52,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") Q
"RTN","PSJOEA",53,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOEA",54,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOEA",55,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOEA",56,0)
 ;I PSJORD["P" L -^PS(53.1,+PSJORD)
"RTN","PSJOEA",57,0)
 ;I PSJORD["U" L -^PS(55,PSGP,5,+PSJORD)
"RTN","PSJOEA",58,0)
 ;Send SN to CPRS if autoverify OFF and Order Set Entry and no 21st piece
"RTN","PSJOEA",59,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOEA",60,0)
 ;D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOEA",61,0)
 Q
"RTN","PSJOEA",62,0)
 ;
"RTN","PSJOEA",63,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSJOEA",64,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSJOEA",65,0)
 ;PSGORD : IEN from 55
"RTN","PSJOEA",66,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSJOEA",67,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSJOEA",68,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSJOEA",69,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55,09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSJOEA",70,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSJOEA",71,0)
 Q
"RTN","PSJOEA",72,0)
 ;
"RTN","PSJOEA",73,0)
UD ;
"RTN","PSJOEA",74,0)
 N DA,DR,DIE D ENGNA^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA
"RTN","PSJOEA",75,0)
 M ^PS(55,PSGP,5,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S PSJNOO=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,3) D EN1^PSJHL2(PSGP,"SN",+DA_"U")
"RTN","PSJOEA",76,0)
 N PSGPDRG,PSGST,PSGNESD,PSGNEFD,ND2
"RTN","PSJOEA",77,0)
 S PSGPDRG=$P($G(^PS(55,PSGP,5,DA,.2)),"^"),PSGST=$P($G(^PS(55,PSGP,5,DA,0)),"^",7)
"RTN","PSJOEA",78,0)
 S ND2=$G(^PS(55,PSGP,5,DA,2)),PSGNESD=$P(ND2,"^",2),PSGNEFD=$P(ND2,"^",4) D CRA^PSGOETO
"RTN","PSJOEA",79,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO)
"RTN","PSJOEA",80,0)
 I $G(DA) S PSJPREX=1 D CMPLX2^PSJCOM1(PSGP,PSJORD,+DA_"U") K PSJPREX
"RTN","PSJOEA",81,0)
 Q
"RTN","PSJOEA",82,0)
IV ; 
"RTN","PSJOEA",83,0)
 K ON55 I $P($G(^PS(53.1,+PSJO,0)),"^",24)="R",$P($G(^PS(53.1,+PSJO,0)),"^",25) S ON55=$P(^PS(53.1,+PSJO,0),"^",25)
"RTN","PSJOEA",84,0)
 I '$G(ON55) D NEW55^PSIVORFB
"RTN","PSJOEA",85,0)
 S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=ON55,$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=+ON55
"RTN","PSJOEA",86,0)
 S $P(^TMP("PSJCOM2",$J,PSJO,2),U,5)=PSJO_"P",$P(^TMP("PSJCOM",$J,PSJO,0),U,26)=ON55
"RTN","PSJOEA",87,0)
 M ^PS(55,DFN,"IV",+ON55)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S P("NAT")=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,5) D EN1^PSJHL2(PSGP,"SN",ON55)
"RTN","PSJOEA",88,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSJOEA",89,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO)
"RTN","PSJOEA",90,0)
 Q
"RTN","PSJOEA1")
0^69^B62456927
"RTN","PSJOEA1",1,0)
PSJOEA1 ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110**;16 DEC 97
"RTN","PSJOEA1",3,0)
 ;
"RTN","PSJOEA1",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA1",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789.
"RTN","PSJOEA1",6,0)
 ;
"RTN","PSJOEA1",7,0)
CHK ;Check to be sure all the orders in the complex order series are completed.
"RTN","PSJOEA1",8,0)
 N COMQUIT,PSJCOMV,PSJOT,PSJSTAT,PSJSTAT2,PSGND2P5,DUR,ND14 S (PSJCOMV,COMQUIT)=0,PSJSTAT2=""
"RTN","PSJOEA1",9,0)
 I '$D(^TMP("PSJCOM",$J)) Q
"RTN","PSJOEA1",10,0)
 I $D(^TMP("PSJCOM",$J)) N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  Q:COMQUIT  S PSJOT=$P(^PS(53.1,PSJO,0),"^",4) D
"RTN","PSJOEA1",11,0)
 . I '$D(^TMP("PSJCOM",$J,PSJO,0)) S COMQUIT=2 Q:COMQUIT
"RTN","PSJOEA1",12,0)
 . S PSJSTAT=$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)
"RTN","PSJOEA1",13,0)
 . I PSJSTAT="DE" S PSJSTAT=$P($G(^TMP("PSJCOM2",$J,PSJO,0)),"^",9) I PSJSTAT="" S COMQUIT=1 Q
"RTN","PSJOEA1",14,0)
 . S:PSJSTAT2="" PSJSTAT2=PSJSTAT S:PSJSTAT'=PSJSTAT2 COMQUIT=2 Q:COMQUIT  S PSJSTAT2=PSJSTAT
"RTN","PSJOEA1",15,0)
 I COMQUIT,PSJOT="U",$G(^TMP("PSJCOM",$J))'="A" S:$G(PSJOWALL)]"" $P(^PS(55,PSGP,5.1),U)=PSJOWALL
"RTN","PSJOEA1",16,0)
 I (COMQUIT=2)!(COMQUIT&($G(^TMP("PSJCOM",$J))'="A")) W !,"By not finishing all the orders, none of the orders will be updated." D PAUSE^VALM1 Q
"RTN","PSJOEA1",17,0)
 I 'COMQUIT N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  D
"RTN","PSJOEA1",18,0)
 .S PSGS0Y=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",5),PSGS0XT=$P($G(^TMP("PSJCOM",$J,+PSJO,2)),"^",6)
"RTN","PSJOEA1",19,0)
 .N DIE,DA,DR S DR="28////^S X=$P(^TMP(""PSJCOM"",$J,+PSJO,0),""^"",9)",DA=+PSJO,DIE="^PS(53.1," D ^DIE
"RTN","PSJOEA1",20,0)
 .N DIK,DA S DIK="^PS(53.1,",DA=+PSJO D IX^DIK
"RTN","PSJOEA1",21,0)
 .M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO)
"RTN","PSJOEA1",22,0)
 .S PSGND=$G(^PS(53.1,+PSJO,0)),PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2),ND14=$$LASTREN^PSJLMPRI(DFN,+PSJO_"P")
"RTN","PSJOEA1",23,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,24)="R" D
"RTN","PSJOEA1",24,0)
 ..N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0) I $P(PND0,U,24)="R" S PSGORDR=$P(PND0,U,25) D
"RTN","PSJOEA1",25,0)
 ...S:'$G(PSGP) PSGP=$G(DFN) Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA1",26,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_$S($P(PND0,U,4)="U":",5,",1:",""IV"","),FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA1",27,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA1",28,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA1",29,0)
 ...D START^PSGOTR(+PSJO_"P",+PSGORDR) I OEORD D
"RTN","PSJOEA1",30,0)
 ....K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=$S(DIE["IV":110,1:66)_"////"_+OEORD
"RTN","PSJOEA1",31,0)
 ....S:$P(PNDP2,U,8) DR=DR_";125////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA1",32,0)
 ....D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(DFN,PSGORDR)
"RTN","PSJOEA1",33,0)
 ..I '$G(COMQUIT),$G(ND14) S DA=+$P(PSGND,U,25) I DA D UPDREN^PSGOER(DA,$P(ND14,U),$P(ND14,U,3),$P(ND14,U,4),$P($G(^PS(53.1,+PSJO,.2)),U,3),$P(ND14,U,2))
"RTN","PSJOEA1",34,0)
 .I '$G(PSGP) S:$G(DFN) PSGP=DFN
"RTN","PSJOEA1",35,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,24)="R",$P(PSGND,U,25),$P($G(^PS(53.1,+PSJO,2)),U,2)<$P($G(^PS(55,PSGP,"IV",+$P(PSGND,U,25),0)),U,3) D
"RTN","PSJOEA1",36,0)
 ..K DA,DR S DA(1)=PSGP,DA=+$P(PSGND,U,25),DIE="^PS(55,"_PSGP_",""IV"",",DR=".03////"_$P($G(^PS(53.1,+PSJO,2)),U,2)_";116////"_$P($G(^PS(55,PSGP,"IV",+$P(PSGND,U,25),0)),U,3)
"RTN","PSJOEA1",37,0)
 ..D ^DIE,EN1^PSJHL2(PSGP,"XX",$P(PSGND,U,25)) L -^PS(53.1,+PSJO)
"RTN","PSJOEA1",38,0)
 .I $P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="N" D
"RTN","PSJOEA1",39,0)
 ..S:'$G(PSGP) PSGP=DFN S PSGS0Y=$P($G(^TMP("PSJCOM2",$J,+PSJO,2)),"^",5)
"RTN","PSJOEA1",40,0)
 ..N DA,DR,DIE D ENGNN^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"P",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA
"RTN","PSJOEA1",41,0)
 ..S DR="28////^S X=$P(^TMP(""PSJCOM2"",$J,+PSJO,0),""^"",9)",DIE="^PS(53.1," D ^DIE
"RTN","PSJOEA1",42,0)
 ..M ^PS(53.1,DA)=^TMP("PSJCOM2",$J,+PSJO) N DIK S DIK="^PS(53.1," D IX^DIK
"RTN","PSJOEA1",43,0)
 ..I $P(^PS(53.1,+PSJO,2),"^",5)'=$P(^TMP("PSJCOM2",$J,+PSJO,2),"^",5) S $P(^PS(53.1,+PSJO,2),"^",5)=$P(^TMP("PSJCOM2",$J,+PSJO,2),"^",5)
"RTN","PSJOEA1",44,0)
 ..D EN1^PSJHL2(PSGP,"OD",+PSJO_"P"),EN1^PSJHL2(PSGP,"SN",+DA_"P")
"RTN","PSJOEA1",45,0)
 ..K ^PS(53.1,"ACX",PSJORD,PSJO) L -^PS(53.1,+PSJO) L -^PS(53.1,DA)
"RTN","PSJOEA1",46,0)
 I '$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  Q:PSJCOMV  D
"RTN","PSJOEA1",47,0)
 .S:'$D(^TMP("PSJCOM",$J,PSJO)) PSJCOMV=1 Q
"RTN","PSJOEA1",48,0)
 .I $P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",'$D(^TMP("PSJCOM2",$J,PSJO,0)) S PSJCOMV=1 Q
"RTN","PSJOEA1",49,0)
 .I $P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U",$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)'="A" S PSJCOMV=1 Q
"RTN","PSJOEA1",50,0)
 .I $P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM",$J,PSJO,0),"^",9)'="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)'="A" S PSJCOMV=1
"RTN","PSJOEA1",51,0)
 I ($G(COMQUIT)=2)!(($G(COMQUIT)!PSJCOMV)&$G(^TMP("PSJCOM",$J))="A") K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J) W !,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJOEA1",52,0)
 I 'PSJCOMV,'$G(COMQUIT) N PSJO S PSJO=0 F  S PSJO=$O(^TMP("PSJCOM",$J,PSJO)) Q:'PSJO  S PSGORD=+PSJO_"P",PSGND=$G(^PS(53.1,+PSJO,0)) D
"RTN","PSJOEA1",53,0)
 .S PSGP=$P(PSGND,"^",15)
"RTN","PSJOEA1",54,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="A",($P(PSGND,U,24)'="R") D ^PSGOT D  Q
"RTN","PSJOEA1",55,0)
 ..M ^PS(55,PSGP,5,+PSGORD,4)=^PS(53.1,PSJO,4)
"RTN","PSJOEA1",56,0)
 ..N PSGND2P5 S PSGND2P5=$G(^PS(53.1,+PSJO,2.5)),DUR=$P(PSGND2P5,"^",2) I $G(DUR)]"" N DA,DR,DIE S DIE="^PS(55,"_PSGP_",5,",DA(1)=PSGP,DA=+PSGORD,DR="126////"_$G(DUR) D ^DIE
"RTN","PSJOEA1",57,0)
 ..D ACTLOG^PSJOEA(PSJO,PSGP,PSGORD)
"RTN","PSJOEA1",58,0)
 ..S VND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJOEA1",59,0)
 ..I PSJSYSL>1 S $P(^PS(55,PSGP,5,+PSGORD,7),U)=PSGDT S:$P(^(7),U,2)="" $P(^(7),U,2)="N"_$S($P(^PS(55,PSGP,5,+PSGORD,0),"^",24)="E":"E",1:"") S PSGTOL=2,PSGUOW=DUZ,PSGTOO=1,DA=+PSGORD D ENL^PSGVDS
"RTN","PSJOEA1",60,0)
 ..S:$P(VND4,"^",15)&'$P(VND4,"^",16) $P(VND4,"^",15)="" S:$P(VND4,"^",18)&'$P(VND4,"^",19) $P(VND4,"^",18)="" S:$P(VND4,"^",22)&'$P(VND4,"^",23) $P(VND4,"^",22)="" S $P(VND4,"^",PSJSYSU,PSJSYSU+1)=DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=VND4
"RTN","PSJOEA1",61,0)
 ..;I '$P(VND4,U,9) S ^PS(55,"APV",PSGP,+PSGORD)=""
"RTN","PSJOEA1",62,0)
 ..I '$P(VND4,U,10) S ^PS(55,"ANV",PSGP,+PSGORD)=""
"RTN","PSJOEA1",63,0)
 ..I $P(VND4,U,9) K ^PS(55,"APV",PSGP,+PSGORD)
"RTN","PSJOEA1",64,0)
 ..I $P(VND4,U,10) K ^PS(55,"ANV",PSGP,+PSGORD)
"RTN","PSJOEA1",65,0)
 ..S:+PSJSYSU=3 ^PS(55,"AUE",PSGP,+PSGORD)=""
"RTN","PSJOEA1",66,0)
 ..S PSJCOM=$P($G(^PS(55,PSGP,5,+PSGORD,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO) S $P(^PS(55,PSGP,5,+PSGORD,4),"^",9)=1
"RTN","PSJOEA1",67,0)
 ..D EN1^PSJHL2(PSGP,$S(+PSJSYSU=3:"SC",+PSJSYSU=1:"SC",1:"XX"),+PSGORD_"U")     ; allow status change to be sent for pharmacists & nurses
"RTN","PSJOEA1",68,0)
 ..D:+PSJSYSU=1 EN1^PSJHL2(PSGP,"ZV",+PSGORD_"U") L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSJOEA1",69,0)
 ..S PSJPREX=1 D CMPLX2^PSJCOM1(PSGP,PSJORD,PSGORD) K PSJPREX
"RTN","PSJOEA1",70,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="A" D GT531^PSIVORFA(PSGP,PSJO_"P") D  Q
"RTN","PSJOEA1",71,0)
 ..S ON55="" I $P(PSGND,"^",24)="R" S ON55=$P(PSGND,"^",25) D
"RTN","PSJOEA1",72,0)
 ...N PND0,PSGORDR S PND0=^PS(53.1,+PSJO,0),PSGORDR=$P(PND0,U,25)
"RTN","PSJOEA1",73,0)
 ...Q:'$$LS^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA1",74,0)
 ...N OEORD,OOEORD,FILE55,FILE55N0,PNDP2 S PNDP2=^PS(53.1,+PSJO,.2),FILE55="^PS(55,"_DFN_",""IV"",",FILE55N0=FILE55_+PSGORDR_",0)"
"RTN","PSJOEA1",75,0)
 ...S OEORD=$P(PND0,U,21) I PSGORDR S OOEORD=$P(@FILE55N0,"^",21) I OEORD'=OOEORD D EXPOE^PSGOER(DFN,+PSJO_"P",+$$LASTREN^PSJLMPRI(DFN,+PSJO_"P"))
"RTN","PSJOEA1",76,0)
 ...S PSGORDP=PSJO,DIE="^PS(53.1,",DA=+PSJO,DR="28////A;104////@" W "." D ^DIE
"RTN","PSJOEA1",77,0)
 ...Q:'$G(OEORD)  K DA,DR,DIE S DA(1)=DFN,DA=+PSGORDR,DIE=FILE55,DR=110_"////"_+OEORD
"RTN","PSJOEA1",78,0)
 ...S:$P(PNDP2,U,8) DR=DR_";150////"_$P(PNDP2,U,8) D ^DIE S DIE=FILE55_+PSGORDR_",0)",$P(@DIE,U,21)=OEORD
"RTN","PSJOEA1",79,0)
 ...D EN1^PSJHL2(DFN,"SC",PSGORDR),UNL^PSSLOCK(PSGP,PSGORDR)
"RTN","PSJOEA1",80,0)
 ..I 'ON55 D SETNEW^PSIVORFB
"RTN","PSJOEA1",81,0)
 ..S (P("NEWON"),ON)=ON55,PSGP=$P(PSGND,U,15)
"RTN","PSJOEA1",82,0)
 ..S VND4=$G(^TMP("PSJCOM",$J,+PSJO,4)) D
"RTN","PSJOEA1",83,0)
 ...N PSJRN,PSJRNDT,PSJRPH,PSJRPHD,PSJPVFL,PSJNVFL,DR,DIE,DA
"RTN","PSJOEA1",84,0)
 ...S (PSJPVFL,PSJNVFL)=""
"RTN","PSJOEA1",85,0)
 ...S PSJRN=$P(VND4,U,1),PSJRNDT=$P(VND4,U,2),PSJRPH=$P(VND4,U,3),PSJRPHD=$P(VND4,U,4),PSJPVFL=$P(VND4,U,16) S:PSJRN]"" PSJNVFL=1
"RTN","PSJOEA1",86,0)
 ...S DR="16////"_PSJRN_";17////"_PSJRNDT_";140////"_PSJRPH_";141////"_PSJRPHD_";142////"_PSJPVFL_";143////"_PSJNVFL
"RTN","PSJOEA1",87,0)
 ...S DA(1)=PSGP,DA=+ON55,DIE="^PS(55,"_PSGP_",""IV""," D ^DIE
"RTN","PSJOEA1",88,0)
 ..D:P("RES")="R" RUPDATE^PSIVOREN(PSGP,ON,P(2))
"RTN","PSJOEA1",89,0)
 ..I +PSJSYSU=3 K OD D ^PSIVORE1 ;LABEL STUFF
"RTN","PSJOEA1",90,0)
 ..I $G(P("PACT"))]"",+$P(P("PACT"),U,2),+$P(P("PACT"),U,3) D  Q
"RTN","PSJOEA1",91,0)
 ...NEW DIC,DA,X,Y,XX D NAME^PSJBCMA1($P(P("PACT"),U,2),.XX)
"RTN","PSJOEA1",92,0)
 ...S DIC(0)="L",DA(1)=DFN,DA(2)=+ON55,X=1
"RTN","PSJOEA1",93,0)
 ...S DIC="^PS(55,"_DA(1)_",""IV"","_DA(2)_",""A"","
"RTN","PSJOEA1",94,0)
 ...S DIC("DR")=".02////F;.03////"_XX_";.04////"_$P($G(^PS(53.3,+$P(P("PACT"),U,3),0)),U)_";.05////"_$P(P("PACT"),U)_";.06////"_$P(P("PACT"),U,2)
"RTN","PSJOEA1",95,0)
 ...D FILE^DICN
"RTN","PSJOEA1",96,0)
 ...N DIK,DA,PSIVACT S DIK="^PS(55,"_DFN_",""IV"",",DA=+ON,PSIVACT="" D IX^DIK
"RTN","PSJOEA1",97,0)
 ...S PSJCOM=$P($G(^PS(55,DFN,"IV",+ON,.2)),"^",8) I PSJCOM]"" K ^PS(53.1,"ACX",PSJCOM,PSJO)
"RTN","PSJOEA1",98,0)
 ...D EN1^PSJHL2(DFN,"SC",ON)
"RTN","PSJOEA1",99,0)
 ...D:+PSJSYSU=1 EN1^PSJHL2(DFN,"ZV",ON) L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA1",100,0)
 ..L -^PS(55,DFN,"IV",+ON) I $G(ON55) L -^PS(55,DFN,"IV",+ON55)
"RTN","PSJOEA1",101,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA1",102,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",9)="A",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)="U" S PSGP=$P(PSGND,U,15) D UD^PSJOEA
"RTN","PSJOEA1",103,0)
 .I $P(PSGND,U,4)'="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA1",104,0)
 .I $P(PSGND,U,4)="U",$P(PSGND,U,9)="DE",$D(^TMP("PSJCOM2",$J,PSJO,0)),$P(^TMP("PSJCOM2",$J,PSJO,0),"^",4)'="U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^",17)="A" S DFN=$S($G(PSGP)]"":PSGP,1:$P(PSGND,U,15)) D IV^PSJOEA
"RTN","PSJOEA1",105,0)
 K ^TMP("PSJCOM",$J),^TMP("PSJCOM2",$J),PSJOWALL
"RTN","PSJOEA1",106,0)
 Q
"RTN","PSJORP2")
0^100^B17806993
"RTN","PSJORP2",1,0)
PSJORP2 ;BIR/JCH-CALCULATE FIRST DOSE FOR OE/RR 3.0 ;27 Feb 03 / 9:40 AM
"RTN","PSJORP2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**80,110**;16 DEC 97
"RTN","PSJORP2",3,0)
 ;
"RTN","PSJORP2",4,0)
 Q
"RTN","PSJORP2",5,0)
ENQ(PSGP,INFO) ; start
"RTN","PSJORP2",6,0)
 ; INFO (piece 1) = START DATE/TIME
"RTN","PSJORP2",7,0)
 ; INFO (piece 2) = STOP DATE/TIME
"RTN","PSJORP2",8,0)
 ; INFO (piece 3) = SCHEDULE
"RTN","PSJORP2",9,0)
 ; INFO (piece 4) = SCHEDULE TYPE
"RTN","PSJORP2",10,0)
 ; INFO (piece 5) = ORDERABLE ITEM
"RTN","PSJORP2",11,0)
 ; INFO (piece 6) = ADMIN TIMES
"RTN","PSJORP2",12,0)
 ;
"RTN","PSJORP2",13,0)
 N PSGNESD,PSGSD,PSGNEFD,PSGFD,PSGSCH,PSGST,PST,PSGS0XT,PSGS0Y,PSGED,SCHFREQ,FIRST,PSGDF,PSGS
"RTN","PSJORP2",14,0)
 S (PSGSD,PSGNESD)=$P(INFO,U),(PSGFD,PSGNEFD)=$P(INFO,U,2),PSGSCH=$P(INFO,U,3),(PSGST,PST)=$P(INFO,U,4),PSGS0Y=$P(INFO,U,6)
"RTN","PSJORP2",15,0)
 S PSGST=$S(PSGST="O":"O",1:"C"),PSGS0XT="",FIRST=""
"RTN","PSJORP2",16,0)
 Q:'PSGSD "" S X=PSGSCH D ADMIN^PSJORPOE
"RTN","PSJORP2",17,0)
 I ($P(INFO,"^",6)]""),($G(PSGS0Y)'=$P(INFO,"^",6)) S PSGS0Y=$P(INFO,"^",6)
"RTN","PSJORP2",18,0)
 I $G(PSJLSTAT),'$G(PSGS0XT),'$$DOW^PSIVUTL(PSGSCH) D
"RTN","PSJORP2",19,0)
 .N D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0Y,PSGDT S X=$P(INFO,"^",3) I X]"" D EN^PSGORS0
"RTN","PSJORP2",20,0)
 I '$G(PSJLSTAT) S X2=$S(PSGS0XT>1440:(PSGS0XT\1440)+1,1:7),X1=PSGSD D C^%DTC S (PSGFD,PSGNEFD)=X
"RTN","PSJORP2",21,0)
 I 'PSGS0Y S:PSGSCH["@" PSGS0Y=$P(PSGSCH,"@",2) I 'PSGS0Y S PSGS0Y=$P(PSGSD,".",2) I $G(PSGST)'="O",($E(PSGS0Y,1,2)<23) D
"RTN","PSJORP2",22,0)
 . N DCAL S DCAL=$E($$FMADD^XLFDT(PSGSD,0,1,0,0),9,10) S:DCAL PSGS0Y=DCAL
"RTN","PSJORP2",23,0)
 S PSGS=$S(PSGST="C":1,PSGST="P":2,PSGST="O":4,1:"")
"RTN","PSJORP2",24,0)
 S X2=PSGNESD,X1=PSGNEFD D ^%DTC S PSGDF=X+30
"RTN","PSJORP2",25,0)
 K PSGD S X=$P(PSGSD,"."),PSGDW="" F Q=0:1:PSGDF-1 S X1=$P(PSGSD,"."),X2=Q D:Q C^%DTC S PSGD(X)=$E(X,4,5)_"/"_$E(X,6,7),HX=X D DW^%DTC S $P(PSGD(HX),U,2)=X
"RTN","PSJORP2",26,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSJORP2",27,0)
 S PST=PSGST,PSGED=PSGSD D OS(PSGP,PSGST)
"RTN","PSJORP2",28,0)
 I $D(PSGD)<10 Q ""
"RTN","PSJORP2",29,0)
 D PRT(X) I $G(PSJLSTAT) S:$G(LAST)>PSGFD LAST=PSGFD Q +$G(LAST)
"RTN","PSJORP2",30,0)
 I $G(FIRST)<PSGSD S FIRST=PSGSD
"RTN","PSJORP2",31,0)
 K PSGD,TS,PSGGD,X,S,Q,QQ,QST
"RTN","PSJORP2",32,0)
 Q FIRST
"RTN","PSJORP2",33,0)
 ;
"RTN","PSJORP2",34,0)
OS(PSGP,PSGST) ; order record set
"RTN","PSJORP2",35,0)
 S SD=PSGNESD I $S($P(SD,".")>PSGNEFD:1,PSGS=1:PSGSCH["PRN",1:0) Q
"RTN","PSJORP2",36,0)
 S FD=PSGNEFD,T=PSGS0XT
"RTN","PSJORP2",37,0)
 S QST=$S(PST="C"!(PST="O"):PST,PST="OC":"OA",PST="P":"OP",PSGSCH["PRN":"OR",1:"CR")
"RTN","PSJORP2",38,0)
 S QQ="" I QST["C" D DTS(PSGSCH) S SD=$P(SD,"."),QQ="" F X=0:0 S X=$O(PSGD(X)) Q:'X  D
"RTN","PSJORP2",39,0)
 . S QQ=QQ_$S(X<SD:"",X>FD:"",'S:$P(PSGD(X),U),$D(S(X)):$P(PSGD(X),U),1:"")
"RTN","PSJORP2",40,0)
 I PSGS0XT="D",PSGS0Y="" S PSGS0Y=$P(PSGNESD,".",2)
"RTN","PSJORP2",41,0)
 S X=$S(QST["C"!(QST="O"):PSGS0Y,1:"")_U_QQ
"RTN","PSJORP2",42,0)
 Q
"RTN","PSJORP2",43,0)
 ;
"RTN","PSJORP2",44,0)
DTS(SCHEDULE) ;
"RTN","PSJORP2",45,0)
 K S S S=0 I SCHEDULE["@"!(PSGST="D") S WD=$S(SCHEDULE["@":$P(SCHEDULE,"@"),1:SCHEDULE) D
"RTN","PSJORP2",46,0)
 . F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  F QQ=1:1:$L(WD,"-") I $P($P(PSGD(Q),U,2),$P(WD,"-",QQ))="" S S(Q)="",S=S+1 Q
"RTN","PSJORP2",47,0)
 Q:SCHEDULE["@"!(T="D")  Q:T'>1440  S WD=$P(PSGSD,".") I '(T#1440) S (SD,X)=$P(SD,"."),PSGT=T\1440 D
"RTN","PSJORP2",48,0)
 . F QQ=0:1 S X1=SD,X2=QQ*PSGT D:X2 C^%DTC I X'<WD S S=S+1 Q:X>PSGFD  Q:X>FD  S S(X)=""
"RTN","PSJORP2",49,0)
 K PSGT Q:'(T#1440)  S PSGT=T,X1=PSGSD,(ST,X2)=SD I PSGSD>SD D ^%DTC I X>1 S ST=$$EN^PSGCT(SD,X-1*1440\T*T)
"RTN","PSJORP2",50,0)
 S (PSGS,X)=ST F PSGX=0:1 S AM=PSGT*PSGX,ST=PSGS S:AM X=$$EN^PSGCT(ST,AM) S X=$P(X,".") I X'<WD Q:X>PSGFD  Q:X>FD  I '$D(S(X)) S S=S+1,S(X)=""
"RTN","PSJORP2",51,0)
 K AM,ST,PSGS,PSGT,PSGX Q
"RTN","PSJORP2",52,0)
 ;
"RTN","PSJORP2",53,0)
PRT(PSGTS) ; order info
"RTN","PSJORP2",54,0)
 S PSGGD=$P(PSGTS,"^",2),PSGTS=$P(PSGTS,"^") S PSJPSTO=PST
"RTN","PSJORP2",55,0)
 D TS(PSGTS) D FIRST D:$G(PSJLSTAT) LAST
"RTN","PSJORP2",56,0)
 S PSGOC=$G(PSGOC)+1
"RTN","PSJORP2",57,0)
 Q
"RTN","PSJORP2",58,0)
 ;
"RTN","PSJORP2",59,0)
FIRST ; find expected first dose
"RTN","PSJORP2",60,0)
 N QTS,ADMIN S FIRST=""
"RTN","PSJORP2",61,0)
 I PST["CZ" NEW PSGLFFD,PSGGD S P(9)="",PSGLFFD="9999999",PSGGD="" Q
"RTN","PSJORP2",62,0)
 I TS=1,'PSGTS S P(9)=1 K P(9) Q
"RTN","PSJORP2",63,0)
 F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q!$G(FIRST)  S ADMIN=0 F  S ADMIN=$O(TS(ADMIN)) Q:'ADMIN!$G(FIRST)  D
"RTN","PSJORP2",64,0)
 . S QTS=Q_"."_TS(ADMIN)
"RTN","PSJORP2",65,0)
 . S FIRST=$S(QTS<PSGSD:"",QTS'<PSGFD:"",PSGGD="":"",PSGGD[$P(PSGD(Q),"^"):QTS,1:"")
"RTN","PSJORP2",66,0)
 Q
"RTN","PSJORP2",67,0)
 ;
"RTN","PSJORP2",68,0)
LAST ; find expected last dose
"RTN","PSJORP2",69,0)
 N QTS,ADMIN S LAST=""
"RTN","PSJORP2",70,0)
 I PST["CZ" NEW PSGLFFD,PSGGD S P(9)="",PSGLFFD="9999999",PSGGD="" Q
"RTN","PSJORP2",71,0)
 I TS=1,'PSGTS S P(9)=1 K P(9) Q
"RTN","PSJORP2",72,0)
 S Q=99999999 F  S Q=$O(PSGD(Q),-1) Q:'Q!$G(LAST)  S ADMIN="" F  S ADMIN=$O(TS(ADMIN),-1) Q:'ADMIN!$G(LAST)  D
"RTN","PSJORP2",73,0)
 . S QTS=Q_"."_TS(ADMIN)
"RTN","PSJORP2",74,0)
 . S LAST=$S(QTS>PSGFD:"",QTS'>PSGSD:"",PSGGD="":"",PSGGD[$P(PSGD(Q),"^"):QTS,1:"")
"RTN","PSJORP2",75,0)
 Q
"RTN","PSJORP2",76,0)
 ;
"RTN","PSJORP2",77,0)
TS(X) ;
"RTN","PSJORP2",78,0)
 K TS S TS=$L(X,"-") F Q=1:1:TS S TS(Q)=$P(X,"-",Q)
"RTN","PSJORP2",79,0)
 Q
"RTN","PSJORP2",80,0)
 ;
"RTN","PSJORP2",81,0)
LASTAT(PSGP,INFO) ;
"RTN","PSJORP2",82,0)
 N LSTDT,PSJLSTAT S LASTAT=0,PSJLSTAT=1 S LASTAT=$$ENQ(PSGP,INFO)
"RTN","PSJORP2",83,0)
 I (LASTAT>$P(INFO,"^",2)!'LASTAT) S LASTAT=$P(INFO,"^",2)
"RTN","PSJORP2",84,0)
 K PSGD,TS,PSGGD,X,S,Q,QQ,QST
"RTN","PSJORP2",85,0)
 Q LASTAT
"RTN","PSJORPOE")
0^101^B26719442
"RTN","PSJORPOE",1,0)
PSJORPOE ;BIR/MLM,LDT-MISC. PROCEDURE CALLS FOR OE/RR 3.0 ;24 Feb 99 / 10:43 AM
"RTN","PSJORPOE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,56,92,80,110**;16 DEC 97
"RTN","PSJORPOE",3,0)
 ;
"RTN","PSJORPOE",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA# 2180.
"RTN","PSJORPOE",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA# 2178.
"RTN","PSJORPOE",6,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJORPOE",7,0)
 ; Reference to ^PS(51.1 is supported by DBIA# 2177.
"RTN","PSJORPOE",8,0)
 ; Reference to ^PS(52.6 is supported by DBIA# 1231.
"RTN","PSJORPOE",9,0)
 ; Reference to ^PS(52.7 is supported by DBIA# 2173.
"RTN","PSJORPOE",10,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSJORPOE",11,0)
 ;
"RTN","PSJORPOE",12,0)
STARTSTP(PSGP,SCH,OI,PSJPWD,PSGORD) ;
"RTN","PSJORPOE",13,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",14,0)
 ; SCH=Schedule
"RTN","PSJORPOE",15,0)
 ; OI=Orderable Item        
"RTN","PSJORPOE",16,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",17,0)
 ; PSGORD=Pharmacy Order Number if the order being placed is a Renewal (Optional)
"RTN","PSJORPOE",18,0)
 ;
"RTN","PSJORPOE",19,0)
 Q:+PSGP'>0 ""
"RTN","PSJORPOE",20,0)
 Q:SCH']"" ""
"RTN","PSJORPOE",21,0)
 Q:+OI'>0 ""
"RTN","PSJORPOE",22,0)
 I SCH?.E1L.E S SCH=$$ENLU^PSGMI(SCH)
"RTN","PSJORPOE",23,0)
 K DFN,PSGNEFDO,PSGNEFD,PSGST,PSGSCH,PSGNEDFD,PSGNESD,PSJSYSW,PSJSYSW0
"RTN","PSJORPOE",24,0)
 S:'$D(PSGS0XT) PSGS0XT="" S:'$D(PSGS0Y) PSGSOY=""
"RTN","PSJORPOE",25,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",26,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",27,0)
 S RESULT=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",28,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",29,0)
 N %,PSGXSCH D NOW^%DTC S PSGDT=%,DFN=PSGP,(PSGSCH,PSGXSCH)=SCH
"RTN","PSJORPOE",30,0)
 S X=PSGSCH D ADMIN
"RTN","PSJORPOE",31,0)
 I $G(PSGORD)]"" D
"RTN","PSJORPOE",32,0)
 .S PSGNESD=$$DSTART^PSJDCU(PSGP,PSGORD) I PSGNESD]"" S RESULT=RESULT_"^"_PSGNESD Q
"RTN","PSJORPOE",33,0)
 .S ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,2)),1:$G(^PS(55,PSGP,"IV",+PSGORD,0)))
"RTN","PSJORPOE",34,0)
 .N PSJADM,PSJSTRT S PSJADM=$S(PSGORD["U":$P(ND,"^",5),1:$P(ND,"^",11)),PSJSTRT=$P(ND,"^",2),PSJREN=1
"RTN","PSJORPOE",35,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",36,0)
 I $G(PSGNESD)="" S RESULT=RESULT_"^"_$$ENSD^PSGNE3(PSGSCH,$S($G(PSJADM)]"":$G(PSJADM),1:PSGS0Y),PSGDT,$S($G(PSJSTRT)]"":$G(PSJSTRT),1:PSGDT))
"RTN","PSJORPOE",37,0)
 ;S Y=$P(RESULT,"^",2) X ^DD("DD") S RESULT=RESULT_"^"_Y
"RTN","PSJORPOE",38,0)
 S PSGNESD=$P(RESULT,"^",2)
"RTN","PSJORPOE",39,0)
 S PSGNEDFD=$$GTNEDFD^PSGOE7("U",OI)
"RTN","PSJORPOE",40,0)
 K PSGODF,PSGOES,PSJREN
"RTN","PSJORPOE",41,0)
 S SCH=PSGXSCH
"RTN","PSJORPOE",42,0)
 D ENFD^PSGNE3(PSGDT) S RESULT=RESULT_"^"_$G(PSGNEFD) ;_"^"_$G(PSGNEFDO)
"RTN","PSJORPOE",43,0)
 N DATE S DATE=$$FMDIFF^XLFDT($P(RESULT,"^",3),$P(RESULT,"^",2),3)
"RTN","PSJORPOE",44,0)
 S $P(RESULT,"^",3)=$S(+DATE>0:+DATE_"D",$P($P(DATE," ",2),":")>0:$P($P(DATE," ",2),":")_"H",1:0)
"RTN","PSJORPOE",45,0)
 ;S RESULT=RESULT_"^"_$P($$RESOLVE(PSGP,SCH,OI,"NEXT"),"^",2)
"RTN","PSJORPOE",46,0)
 N STRING S STRING=PSGNESD_U_PSGNEFD_U_$G(PSGSCH)_U_$G(PSGST)_U_$G(OI) I ($P($G(ZZND),U,2)]"") S STRING=STRING_U_$P(ZZND,U,2)
"RTN","PSJORPOE",47,0)
 S RESULT=RESULT_"^"_$$ENQ^PSJORP2(PSGP,STRING)
"RTN","PSJORPOE",48,0)
 D KVAR^VADPT K LYN,ND,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ
"RTN","PSJORPOE",49,0)
 ;RESULT=WARD PARAMETER^DEFAULT START DATE/TIME^#_D(NUMBER OF DAYS ORDER LASTS) OR #_H(NUMBER OF HOURS ORDER LASTS)^EXPECTED FIRST DOSE
"RTN","PSJORPOE",50,0)
 Q RESULT
"RTN","PSJORPOE",51,0)
 ;
"RTN","PSJORPOE",52,0)
RESOLVE(PSGP,SCH,OI,PCH,PSJPWD) ;
"RTN","PSJORPOE",53,0)
 ; PSGP=Patient IEN
"RTN","PSJORPOE",54,0)
 ; SCH=Schedule
"RTN","PSJORPOE",55,0)
 ; OI=Orderable Item
"RTN","PSJORPOE",56,0)
 ; PCH=Providers Choice
"RTN","PSJORPOE",57,0)
 ; PSJPWD=Ward Location (Optional)
"RTN","PSJORPOE",58,0)
 ;
"RTN","PSJORPOE",59,0)
 N PSJSYSW0,PSJSYSW,PSGSCH,PSGOES,PSGS0Y,DFN
"RTN","PSJORPOE",60,0)
 I $G(PSJPWD)']"" S DFN=PSGP D IN5^VADPT S:VAIP(5)]"" PSJPWD=+VAIP(5)
"RTN","PSJORPOE",61,0)
 S PSJSYSW0="",PSJSYSW=0 I $G(PSJPWD)]"" S PSJSYSW=+$O(^PS(59.6,"B",PSJPWD,0)) I PSJSYSW S PSJSYSW0=$G(^PS(59.6,PSJSYSW,0))
"RTN","PSJORPOE",62,0)
 S $P(PSJSYSW0,"^",5)=$S($$ONE(SCH):2,PCH="NEXT":1,1:0)
"RTN","PSJORPOE",63,0)
 S RESULT1=$S($P(PSJSYSW0,"^",5)=0:"CLOSEST",$P(PSJSYSW0,"^",5)=1:"NEXT",1:"NOW")
"RTN","PSJORPOE",64,0)
 I OI]"" S PSGST=$S($P($G(^PS(50.7,OI,0)),"^",7)]"":$P($G(^PS(50.7,OI,0)),"^",7),1:"C")
"RTN","PSJORPOE",65,0)
 N % D NOW^%DTC S PSGDT=%,DFN=PSGP,PSGSCH=SCH
"RTN","PSJORPOE",66,0)
 S X=PSGSCH D ADMIN
"RTN","PSJORPOE",67,0)
 S RESULT1=RESULT1_"^"_$$ENSD^PSGNE3(SCH,PSGS0Y,PSGDT,PSGDT)
"RTN","PSJORPOE",68,0)
 D KVAR^VADPT K LYN,PSGDT,PSGNEDFD,PSGNEFD,PSGNEFDO,PSGNESD,PSGS0Y,PSGSCH,PSGST,PSJSYSW,PSJSYSW0,ZZ,PSGS0XT,PSGS0Y
"RTN","PSJORPOE",69,0)
 Q RESULT1
"RTN","PSJORPOE",70,0)
 ;
"RTN","PSJORPOE",71,0)
SCHREQ(MR,OI,DD)  ;
"RTN","PSJORPOE",72,0)
 ; MR=Medication Route from 51.2 (Required)
"RTN","PSJORPOE",73,0)
 ; OI=Orderable Item from 50.7 (Optional)
"RTN","PSJORPOE",74,0)
 ; DD=Dispense Drug from 50 (Optional)
"RTN","PSJORPOE",75,0)
 N ADDITIVE,SOLUTION S REQ=0,(SOLUTION,ADDITIVE)=""
"RTN","PSJORPOE",76,0)
 I '+$G(MR) S REQ=1 Q REQ
"RTN","PSJORPOE",77,0)
 I '+$G(OI),'+$G(DD) S REQ=1 Q REQ
"RTN","PSJORPOE",78,0)
 I +$G(DD) S:$P($G(^PSDRUG(+DD,2)),U,3)["U" REQ=1 Q REQ
"RTN","PSJORPOE",79,0)
 I '$D(PS(51.2,+MR,0)) S REQ=1 Q REQ
"RTN","PSJORPOE",80,0)
 I $P($G(^PS(51.2,+MR,0)),"^",6)=1 D
"RTN","PSJORPOE",81,0)
 .I +$G(OI) D
"RTN","PSJORPOE",82,0)
 ..I '$D(^PS(50.7,+OI,0)) S REQ=1 Q
"RTN","PSJORPOE",83,0)
 ..F  S SOLUTION=$O(^PS(52.7,"AOI",+OI,SOLUTION)) Q:'SOLUTION  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.7,SOLUTION,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",84,0)
 ..F  S ADDITIVE=$O(^PS(52.6,"AOI",+OI,ADDITIVE)) Q:'ADDITIVE  Q:REQ=1  S:$P(^PSDRUG(+$P(^PS(52.6,ADDITIVE,0),U,2),2),U,3)["U" REQ=1
"RTN","PSJORPOE",85,0)
 Q REQ
"RTN","PSJORPOE",86,0)
 ;
"RTN","PSJORPOE",87,0)
ADMIN ; Get admin times associated with schedule
"RTN","PSJORPOE",88,0)
 S PSGS0Y="",ZZ=0
"RTN","PSJORPOE",89,0)
 D FIND^DIC(51.1,,,,X,,"APPSJ",,,"LYN")
"RTN","PSJORPOE",90,0)
 S ZZ=$O(LYN("DILIST",2,ZZ)) I ZZ S ZZ=+LYN("DILIST",2,ZZ) I ZZ S ZZND=$G(^PS(51.1,ZZ,0)) S PSGST=$P(ZZND,U,5),PSGS0XT=$P(ZZND,U,3) I $G(PSJPWD) D
"RTN","PSJORPOE",91,0)
 . N ZZNDW S ZZNDW=$G(^PS(51.1,ZZ,1,PSJPWD,0)) I $P(ZZNDW,"^",2)]"" S PSGS0Y=$P(ZZNDW,"^",2),$P(ZZND,"^",2)=PSGS0Y
"RTN","PSJORPOE",92,0)
 S ZZ=0 F  S ZZ=$O(LYN("DILIST",1,ZZ)) Q:'ZZ  I $G(LYN("DILIST",1,ZZ))'=X K LYN("DILIST",1,ZZ),LYN("DILIST",2,ZZ),LYN("DILIST","ID",ZZ,1)
"RTN","PSJORPOE",93,0)
 I $D(PSJPWD) S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  I $P($G(^PS(51.1,+LYN("DILIST",2,ZZ),1,+PSJPWD,0)),U,2)]"" S PSGS0Y=$P($G(^(0)),U,2)
"RTN","PSJORPOE",94,0)
 Q:PSGS0Y]""  S ZZ=0 F  S ZZ=$O(LYN("DILIST",2,ZZ)) Q:'ZZ  Q:PSGS0Y]""  I $G(LYN("DILIST","ID",ZZ,1))]"" S PSGS0Y=$G(LYN("DILIST","ID",ZZ,1))
"RTN","PSJORPOE",95,0)
 Q
"RTN","PSJORPOE",96,0)
 ;
"RTN","PSJORPOE",97,0)
ONE(SCH) ;
"RTN","PSJORPOE",98,0)
 ; SCH=Admin Schedule
"RTN","PSJORPOE",99,0)
 ; Returns 0 = (zero) Not a one time schedule.
"RTN","PSJORPOE",100,0)
 ;         1 =  One time schedule. 
"RTN","PSJORPOE",101,0)
 Q:$G(SCH)="" 0
"RTN","PSJORPOE",102,0)
 N X,SCHLST
"RTN","PSJORPOE",103,0)
 S SCHLST=",TODAY,ONCE,NOW,ONE TIME,ONETIME,ONE-TIME,1TIME,1 TIME,1-TIME,STAT,"
"RTN","PSJORPOE",104,0)
 I SCHLST[(","_SCH_",") Q 1
"RTN","PSJORPOE",105,0)
 I $D(^PS(51.1,"AC","PSJ",SCH)) S X=$O(^(SCH,"")) S X=$P(^PS(51.1,X,0),"^",5) Q $S(X="O":1,1:0)
"RTN","PSJORPOE",106,0)
 Q 0
"RTN","PSJORRE")
0^89^B26669113
"RTN","PSJORRE",1,0)
PSJORRE ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (CONDENSED) ;28 Jan 99 / 12:56 PM
"RTN","PSJORRE",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**22,51,50,58,81,110**;16 DEC 97
"RTN","PSJORRE",3,0)
 ;
"RTN","PSJORRE",4,0)
 ;Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE",5,0)
 ;Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE",6,0)
 ;Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE",7,0)
 ;Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJORRE",8,0)
 ;Reference to OTF^OR3CONV is supported by DBIA 2412.
"RTN","PSJORRE",9,0)
 ;Reference to ^TMP("PS" is documented in DBIA #2383.
"RTN","PSJORRE",10,0)
 ;
"RTN","PSJORRE",11,0)
OCL(DFN,BDT,EDT,TFN)         ; return condensed list of inpat meds
"RTN","PSJORRE",12,0)
 N ADM,CNT,DN,DO,F,FON,INFUS,INST,MR,ND,ND0,ND2,ND6,ON,PON,PST,SCH,SIO,STAT,TYPE,UNITS,WBDT,X,Y
"RTN","PSJORRE",13,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJORRE",14,0)
 F  S X=$$OTF^OR3CONV(DFN,$S($E($G(IOST),1)="C":0,1:1)) Q:+X'<0  D
"RTN","PSJORRE",15,0)
 .I +X=-1 H 3
"RTN","PSJORRE",16,0)
 ; PON=placer order number (oerr), FON=filler order number
"RTN","PSJORRE",17,0)
 S:BDT="" BDT=DT S WBDT=BDT_".000001"
"RTN","PSJORRE",18,0)
 S:EDT="" EDT=9999999
"RTN","PSJORRE",19,0)
 S:EDT'["." EDT=EDT_".999999"
"RTN","PSJORRE",20,0)
 S F="^PS(55,DFN,5," F  S WBDT=$O(^PS(55,DFN,5,"AUS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,5,"AUS",WBDT,ON)) Q:'ON  D UDTMP
"RTN","PSJORRE",21,0)
 S F="^PS(53.1," F PST="P","N" F ON=0:0 S ON=$O(^PS(53.1,"AS",PST,DFN,ON)) Q:'ON  S X=$P($G(^PS(53.1,+ON,0)),U,4) D @$S(X="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE",22,0)
 S F="^PS(55,"_DFN_",""IV"",",WBDT=BDT-1 F  S WBDT=$O(^PS(55,DFN,"IV","AIS",WBDT)) Q:'WBDT  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",WBDT,ON)) Q:'ON  D IVTMP
"RTN","PSJORRE",23,0)
 Q
"RTN","PSJORRE",24,0)
 ;
"RTN","PSJORRE",25,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE",26,0)
 N PROVIDER,RNWDT,EDTCMPLX,NDP2 S (MR,SCH,INST,PON)="",FON=+ON_$S(F["53.1":"P",1:"U")
"RTN","PSJORRE",27,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",28,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",29,0)
 S ND2=$G(@(F_ON_",2)")) I 'EDTCMPLX I F'["53.1",($P(ND2,U,2)>EDT) Q
"RTN","PSJORRE",30,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F["53.1",($P(ND0,U,16)>EDT) Q
"RTN","PSJORRE",31,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(FON["P":53.1,1:55.06),28)
"RTN","PSJORRE",32,0)
 S ND6=$P($G(@(F_ON_",6)")),"^"),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",33,0)
 S FON=+ON_$S(F["53.1":"P",1:"U"),DO=$P($G(@(F_ON_",.2)")),"^",2)
"RTN","PSJORRE",34,0)
 D DRGDISP^PSJLMUT1(DFN,FON,40,0,.DN,1)
"RTN","PSJORRE",35,0)
 ;S UNITS="" I '$O(@(F_+ON_",1,1)")),DO="" S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2)
"RTN","PSJORRE",36,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(FON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE",37,0)
 S:+$P(ND0,U,3) MR=$$MR^PSJORRE1(+$P(ND0,U,3))
"RTN","PSJORRE",38,0)
 N NOTGIVEN S NOTGIVEN=$S(FON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE",39,0)
 S TFN=TFN+1
"RTN","PSJORRE",40,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_$P(ND2,U,2)_U_$G(RNWDT)
"RTN","PSJORRE",41,0)
 ;*S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN(1)_"^^"_$P(ND2,U,4)_"^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_STAT_U_U_U_U_$P($G(^PS(55,DFN,5,+ON,0)),"^",22)_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))
"RTN","PSJORRE",42,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE",43,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",44,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",45,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,TFN,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE",46,0)
 ;S:$P(ND0,U,7)]"" ^TMP("PS",$J,TFN,"SCH",0)=1,$P(^TMP("PS",$J,TFN,"SCH",1,0),U,2)=$P(ND0,U,7)
"RTN","PSJORRE",47,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",48,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,TFN,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE",49,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,TFN,"SIO",1,0)=ND6
"RTN","PSJORRE",50,0)
 Q
"RTN","PSJORRE",51,0)
 ;
"RTN","PSJORRE",52,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE",53,0)
 N PROVIDER,START,STOP,EDTCMPLX,NDP2
"RTN","PSJORRE",54,0)
 S NDP2=$G(@(F_ON_",.2)")) S EDTCMPLX=$P(NDP2,"^",8)
"RTN","PSJORRE",55,0)
 S ND0=$G(@(F_ON_",0)")) I 'EDTCMPLX I F'["53.1",($P(ND0,U,2)>EDT) Q
"RTN","PSJORRE",56,0)
 S FON=+ON_$S(F["53.1":"P",1:"V"),TFN=TFN+1,CNT=0
"RTN","PSJORRE",57,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,FON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE",58,0)
 F X=0:0 S X=$O(@(F_ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,TFN,"A",CNT,0)=Y
"RTN","PSJORRE",59,0)
 S ^TMP("PS",$J,TFN,"A",0)=CNT,CNT=0
"RTN","PSJORRE",60,0)
 F X=0:0 S X=$O(@(F_ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,TFN,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE",61,0)
 S ^TMP("PS",$J,TFN,"B",0)=CNT
"RTN","PSJORRE",62,0)
 S TYPE=$P(ND0,U,4),(MR,SCH,INST,INFUS)=""
"RTN","PSJORRE",63,0)
 I FON["P" S ND2=$G(^PS(53.1,+ON,2)),SCH=$P(ND2,U),START=$P(ND2,U,2),STOP=$P(ND2,U,4),MR=$P(ND0,U,3),INFUS=$P($G(^PS(53.1,+ON,8)),U,5),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28),ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE",64,0)
 I FON'["P" S START=$P(ND0,U,2),STOP=$P(ND0,U,3),SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),MR=$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100),ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE",65,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE",66,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE",67,0)
 S:MR MR=$$MR^PSJORRE1(+MR),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE",68,0)
 ;S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_$P(ND0,U,3)_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT
"RTN","PSJORRE",69,0)
 S ^TMP("PS",$J,TFN,0)=FON_";I"_U_DN_U_INFUS_U_STOP_"^^"_DO_"^^"_$P(ND0,"^",21)_U_STAT_U_U_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_START_U_$G(RNWDT)
"RTN","PSJORRE",70,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRE",71,0)
 I PROVIDER S ^TMP("PS",$J,TFN,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE",72,0)
 S ^TMP("PS",$J,TFN,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,TFN,"MDR",1,0)=MR
"RTN","PSJORRE",73,0)
 S ^TMP("PS",$J,TFN,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,TFN,"SIG",1,0)=INST
"RTN","PSJORRE",74,0)
 S ^TMP("PS",$J,TFN,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,TFN,"SCH",1,0)=SCH
"RTN","PSJORRE",75,0)
 ;I FON["P" S:$P(ND0,U,7)]"" ^TMP("PS",$J,TFN,"SCH",0)=1,$P(^TMP("PS",$J,TFN,"SCH",1,0),U,2)=$P(ND0,U,7)
"RTN","PSJORRE",76,0)
 S ^TMP("PS",$J,TFN,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,TFN,"ADM",1,0)=ADM
"RTN","PSJORRE",77,0)
 S ^TMP("PS",$J,TFN,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,TFN,"SIO",1,0)=SIO
"RTN","PSJORRE",78,0)
 Q
"RTN","PSJORRE",79,0)
STAT(Y,X) ;* Return the full status instead of just the code for U/D.
"RTN","PSJORRE",80,0)
 S X=$P($P(";"_$P(Y,U,3),";"_X_":",2),";")
"RTN","PSJORRE",81,0)
 Q X
"RTN","PSJORRE1")
0^102^B35153549
"RTN","PSJORRE1",1,0)
PSJORRE1 ;BIR/MV-RETURN INPATIENT ACTIVE MEDS (EXPANDED) ;29 Jan 99 / 8:49 AM
"RTN","PSJORRE1",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**22,51,50,58,81,91,110**;16 DEC 97
"RTN","PSJORRE1",3,0)
 ;
"RTN","PSJORRE1",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSJORRE1",5,0)
 ; Reference to ^PS(52.6 is supported by DBIA 1231.
"RTN","PSJORRE1",6,0)
 ; Reference to ^PS(52.7 is supported by DBIA 2173.
"RTN","PSJORRE1",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSJORRE1",8,0)
 ; Reference to ^PSDRUG is supported by DBIA 2192.
"RTN","PSJORRE1",9,0)
 ; Reference to OTF^OR3CONV is supported by DBIA 2412.
"RTN","PSJORRE1",10,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSJORRE1",11,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJORRE1",12,0)
 ; Reference to ^TMP("PS" is documented in DBIA #2384.
"RTN","PSJORRE1",13,0)
 ;
"RTN","PSJORRE1",14,0)
OEL(DFN,ON)         ; return list of expanded inpat meds
"RTN","PSJORRE1",15,0)
 K ^TMP("PS",$J)
"RTN","PSJORRE1",16,0)
 N ADM,CNT,DN,DO,F,INFUS,INST,MR,ND,ND0,ND2,ND6,NDOI,SCH,SIO,START,STAT,STOP,TYP,UNITS,X,Y
"RTN","PSJORRE1",17,0)
 ;Check if 5.0 order conversion should be run for the selected patient.
"RTN","PSJORRE1",18,0)
 ;I '$P($G(^PS(55,DFN,5.1)),U,11) D CONVERT^PSJUTL1(DFN,0)
"RTN","PSJORRE1",19,0)
 F  S X=$$OTF^OR3CONV(DFN,$S($E(IOST,1)="C":0,1:1)) Q:+X'<0  D
"RTN","PSJORRE1",20,0)
 .I +X=-1 H 3
"RTN","PSJORRE1",21,0)
 S F=$S(ON["P":"^PS(53.1,",ON["U":"^PS(55,DFN,5,",1:"^PS(55,"_DFN_",""IV"",")
"RTN","PSJORRE1",22,0)
 I ON'["P",'$D(@(F_+ON_")")) Q
"RTN","PSJORRE1",23,0)
 I ON["P" S X=$G(^PS(53.1,+ON,0)) Q:$P(X,U,15)'=DFN  S TYP=$P(X,U,4) D @$S(TYP="U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",24,0)
 D:ON'["P" @$S(ON["U":"UDTMP",1:"IVTMP")
"RTN","PSJORRE1",25,0)
 S Y=$S(ON["V":5,1:12),CNT=0
"RTN","PSJORRE1",26,0)
 I $O(@(F_+ON_","_Y_",0)")) D
"RTN","PSJORRE1",27,0)
 . F X=0:0 S X=$O(@(F_+ON_","_Y_","_X_")")) Q:'X  D
"RTN","PSJORRE1",28,0)
 ..S CNT=CNT+1,ND=$G(@(F_+ON_","_Y_","_X_",0)")),^TMP("PS",$J,"PC",CNT,0)=ND
"RTN","PSJORRE1",29,0)
 S ^TMP("PS",$J,"PC",0)=CNT
"RTN","PSJORRE1",30,0)
 Q
"RTN","PSJORRE1",31,0)
 ;
"RTN","PSJORRE1",32,0)
UDTMP ;*** Set ^TMP for Unit dose orders.
"RTN","PSJORRE1",33,0)
 N DO,DN,INST,X,Y,PROVIDER,NOTGIVEN,RNWDT
"RTN","PSJORRE1",34,0)
 S (MR,SCH,INST)=""
"RTN","PSJORRE1",35,0)
 S ND2=$G(@(F_+ON_",2)")),ND0=$G(@(F_+ON_",0)"))
"RTN","PSJORRE1",36,0)
 S ND6=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE1",37,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",38,0)
 S STAT=$$CODES^PSIVUTL($P(ND0,U,9),$S(ON["P":53.1,1:55.06),28)
"RTN","PSJORRE1",39,0)
 D DRGDISP^PSJLMUT1(DFN,ON,40,0,.DN,1)
"RTN","PSJORRE1",40,0)
 S NDOI=$G(@(F_+ON_",.2)")),DO=$P(NDOI,U,2)
"RTN","PSJORRE1",41,0)
 ;S UNITS="" I '$O(@(F_+ON_",1,1)")),DO="" S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2)
"RTN","PSJORRE1",42,0)
 S UNITS="" I '$O(@(F_+ON_",1,1)")) S UNITS=$P($G(@(F_+ON_",1,1,0)")),U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE1",43,0)
 S MR=$$MR(+$P(ND0,U,3)),INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",44,0)
 S NOTGIVEN=$S(ON["U":$P($G(^PS(55,DFN,5,+ON,0)),"^",22),1:"")
"RTN","PSJORRE1",45,0)
 S ^TMP("PS",$J,0)=DN(1)_"^^"_$P(ND2,U,4)_"^^"_$P(ND2,U,2)_U_STAT_"^^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_U_NOTGIVEN_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",46,0)
 ;S ^TMP("PS",$J,0)=DN(1)_"^^"_$P(ND2,U,4)_"^^"_$P(ND2,U,2)_U_STAT_"^^^"_DO_U_UNITS_U_$P(ND0,U,21)_U_U_$P($G(^PS(55,DFN,5,+ON,0)),"^",22)_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))
"RTN","PSJORRE1",47,0)
 S PROVIDER=$P($G(@(F_+ON_",0)")),"^",2)
"RTN","PSJORRE1",48,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",49,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",50,0)
 S ^TMP("PS",$J,"SCH",0)=$P(ND2,U)]"" S:$P(ND2,U)]"" ^TMP("PS",$J,"SCH",1,0)=$P(ND2,U)
"RTN","PSJORRE1",51,0)
 S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",52,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",53,0)
 S ^TMP("PS",$J,"ADM",0)=$P(ND2,U,5)]"" S:$P(ND2,U,5)]"" ^TMP("PS",$J,"ADM",1,0)=$P(ND2,U,5)
"RTN","PSJORRE1",54,0)
 S ^TMP("PS",$J,"SIO",0)=ND6]"" S:ND6]"" ^TMP("PS",$J,"SIO",1,0)=ND6
"RTN","PSJORRE1",55,0)
 NEW VERPHARM S:ON["U" VERPHARM=$P($G(@(F_+ON_",4)")),U,3)
"RTN","PSJORRE1",56,0)
 S:+$G(VERPHARM) $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",57,0)
 NEW PSJDD,INACTDT,NDDD,OUTOI,PSJOUT S CNT=0
"RTN","PSJORRE1",58,0)
 F PSJDD=0:0 S PSJDD=$O(@(F_+ON_",1,PSJDD)")) Q:'PSJDD  D
"RTN","PSJORRE1",59,0)
 . S NDDD=@(F_+ON_",1,PSJDD,0)")
"RTN","PSJORRE1",60,0)
 . I $P(NDDD,U,3)]"",($P(NDDD,U,3)'>DT) Q
"RTN","PSJORRE1",61,0)
 . S PSJOUT=$P($G(^PSDRUG(+NDDD,8)),U,5)
"RTN","PSJORRE1",62,0)
 . I +PSJOUT D
"RTN","PSJORRE1",63,0)
 .. S INACTDT=$G(^PSDRUG(+PSJOUT,"I")),OUTOI=+$G(^PSDRUG(+PSJOUT,2))
"RTN","PSJORRE1",64,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",65,0)
 . I '+PSJOUT,($P($G(^PSDRUG(+NDDD,2)),U,3)["O") D
"RTN","PSJORRE1",66,0)
 .. S PSJOUT=+NDDD,OUTOI=+NDOI
"RTN","PSJORRE1",67,0)
 .. S INACTDT=$G(^PSDRUG(+NDDD,"I"))
"RTN","PSJORRE1",68,0)
 .. I INACTDT]"",(INACTDT'>DT) S (PSJOUT,OUTOI)=""
"RTN","PSJORRE1",69,0)
 . ;* S UNITS=$S('+$P(NDDD,U,2):1,1:$P(NDDD,U,2))
"RTN","PSJORRE1",70,0)
 . S UNITS=$P(NDDD,U,2) S:(ON["U")&(UNITS="") UNITS=1
"RTN","PSJORRE1",71,0)
 . S CNT=CNT+1,^TMP("PS",$J,"DD",CNT,0)=+NDDD_U_UNITS_U_PSJOUT_U_$G(OUTOI)
"RTN","PSJORRE1",72,0)
 S ^TMP("PS",$J,"DD",0)=CNT
"RTN","PSJORRE1",73,0)
 Q
"RTN","PSJORRE1",74,0)
 ;
"RTN","PSJORRE1",75,0)
IVTMP ;*** Set ^TMP for IV orders.
"RTN","PSJORRE1",76,0)
 N PROVIDER,RNWDT S ND0=$G(@(F_+ON_",0)")),CNT=0
"RTN","PSJORRE1",77,0)
 F X=0:0 S X=$O(@(F_+ON_",""AD"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""AD"","_X_",0)")),DN=$P($G(^PS(52.6,+ND,0)),U),Y=DN_U_$P(ND,U,2) S:$P(ND,U,3) Y=Y_U_$P(ND,U,3) S CNT=CNT+1,^TMP("PS",$J,"A",CNT,0)=Y
"RTN","PSJORRE1",78,0)
 S RNWDT=$$LASTREN^PSJLMPRI(DFN,ON) I RNWDT S RNWDT=+RNWDT
"RTN","PSJORRE1",79,0)
 S ^TMP("PS",$J,"A",0)=CNT,CNT=0
"RTN","PSJORRE1",80,0)
 F X=0:0 S X=$O(@(F_+ON_",""SOL"","_X_")")) Q:'X  S ND=$G(@(F_+ON_",""SOL"","_X_",0)")),DN=$G(^PS(52.7,+ND,0)),CNT=CNT+1,^TMP("PS",$J,"B",CNT,0)=$P(DN,U)_U_$P(ND,U,2)_U_$P(DN,U,4)
"RTN","PSJORRE1",81,0)
 S ^TMP("PS",$J,"B",0)=CNT
"RTN","PSJORRE1",82,0)
 S INST=$G(@(F_+ON_",.3)"))
"RTN","PSJORRE1",83,0)
 I ON["P" D
"RTN","PSJORRE1",84,0)
 . S SCH=$P($G(^PS(53.1,+ON,2)),U)
"RTN","PSJORRE1",85,0)
 . S PROVIDER=$P(ND0,U,2)
"RTN","PSJORRE1",86,0)
 . S MR=$$MR(+$P(ND0,U,3)),STAT=$$CODES^PSIVUTL($P(ND0,U,9),53.1,28)
"RTN","PSJORRE1",87,0)
 . S INFUS=$P($G(^PS(53.1,+ON,8)),U,5)
"RTN","PSJORRE1",88,0)
 . S ND2=$G(@(F_+ON_",2)")),START=$P(ND2,U,2),STOP=$P(ND2,U,4)
"RTN","PSJORRE1",89,0)
 . S ADM=$P(ND2,U,5),SIO=$P($G(@(F_+ON_",6)")),"^")
"RTN","PSJORRE1",90,0)
 I ON'["P"  D
"RTN","PSJORRE1",91,0)
 . S PROVIDER=$P(ND0,U,6)
"RTN","PSJORRE1",92,0)
 . S SCH=$P(ND0,U,9),INFUS=$P(ND0,U,8),STAT=$$CODES^PSIVUTL($P(ND0,U,17),55.01,100)
"RTN","PSJORRE1",93,0)
 . S MR=$$MR(+$P($G(^PS(55,DFN,"IV",+ON,.2)),U,3))
"RTN","PSJORRE1",94,0)
 . S START=$P(ND0,U,2),STOP=$P(ND0,U,3)
"RTN","PSJORRE1",95,0)
 . S ADM=$P(ND0,U,11),SIO=$P($G(@(F_+ON_",3)")),"^")
"RTN","PSJORRE1",96,0)
 . NEW VERPHARM S VERPHARM=$P($G(^PS(55,DFN,"IV",+ON,4)),U,4)
"RTN","PSJORRE1",97,0)
 . S:+VERPHARM $P(^TMP("PS",$J,"RXN",0),U,5)=VERPHARM
"RTN","PSJORRE1",98,0)
 S DN=$G(@(F_+ON_",.2)")),DO=$P(DN,U,2)
"RTN","PSJORRE1",99,0)
 S DN=$S(+$P(DN,U):$$OIDF^PSJLMUT1($P(DN,U)),1:"")
"RTN","PSJORRE1",100,0)
 S ^TMP("PS",$J,0)=DN_U_INFUS_U_STOP_"^^"_START_U_STAT_"^^^"_DO_"^^"_$P(ND0,U,21)_U_U_U_($P(ND0,U,9)="P"&($P(ND0,U,24)="R"))_U_U_$G(RNWDT)
"RTN","PSJORRE1",101,0)
 ;*S PROVIDER=$P($G(@(F_+ON_",0)")),"^",6)
"RTN","PSJORRE1",102,0)
 I PROVIDER S ^TMP("PS",$J,"P",0)=PROVIDER_"^"_$P($G(^VA(200,PROVIDER,0)),"^")
"RTN","PSJORRE1",103,0)
 S ^TMP("PS",$J,"MDR",0)=MR]"" S:MR]"" ^TMP("PS",$J,"MDR",1,0)=MR
"RTN","PSJORRE1",104,0)
 S ^TMP("PS",$J,"SCH",0)=SCH]"" S:SCH]"" ^TMP("PS",$J,"SCH",1,0)=SCH
"RTN","PSJORRE1",105,0)
 I ON["P" S:$P(ND0,U,7)]"" ^TMP("PS",$J,"SCH",0)=1,$P(^TMP("PS",$J,"SCH",1,0),U,2)=$$GTSCHT($P(ND0,U,7))_"^"_$P(ND0,U,7)
"RTN","PSJORRE1",106,0)
 S ^TMP("PS",$J,"SIG",0)=INST]"" S:INST]"" ^TMP("PS",$J,"SIG",1,0)=INST
"RTN","PSJORRE1",107,0)
 S ^TMP("PS",$J,"ADM",0)=ADM]"" S:ADM]"" ^TMP("PS",$J,"ADM",1,0)=ADM
"RTN","PSJORRE1",108,0)
 S ^TMP("PS",$J,"SIO",0)=SIO]"" S:SIO]"" ^TMP("PS",$J,"SIO",1,0)=SIO
"RTN","PSJORRE1",109,0)
 Q
"RTN","PSJORRE1",110,0)
 ;
"RTN","PSJORRE1",111,0)
MR(X) ;RETURN MED ROUTE ABBR. IF THE ABBR="" RETURN MED ROUTE'S NAME.
"RTN","PSJORRE1",112,0)
 S X=$G(^PS(51.2,X,0))
"RTN","PSJORRE1",113,0)
 Q $S($P(X,U,3)]"":$P(X,U,3),1:$P(X,U))
"RTN","PSJORRE1",114,0)
 ;
"RTN","PSJORRE1",115,0)
GTSTAT(X) ;
"RTN","PSJORRE1",116,0)
 Q $S(X="A":"ACTIVE",X="D":"DISCONTINUED",X="I":"INCOMPLETE",X="N":"NON-VERFIED",X="U":"UNRELEASED",X="P":"PENDING",X="DE":"DISCONTINUED (EDIT)",X="O":"ON CALL",1:"NOT FOUND")
"RTN","PSJORRE1",117,0)
 ;
"RTN","PSJORRE1",118,0)
VA200(X) ;Return the IEN for the user.
"RTN","PSJORRE1",119,0)
 ; X = User name
"RTN","PSJORRE1",120,0)
 NEW DIC,Y S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSJORRE1",121,0)
 I +Y=-1 Q ""
"RTN","PSJORRE1",122,0)
 Q $P(Y,U)
"RTN","PSJORRE1",123,0)
GTSCHT(X)       ;
"RTN","PSJORRE1",124,0)
 Q $S(X="C":"CONTINUOUS",X="O":"ONE TIME",X="P":"PRN",X="R":"FILL ON REQUEST",X="OC":"ON CALL",1:"NOT FOUND")
"RTN","PSJORREN")
0^103^B13570794
"RTN","PSJORREN",1,0)
PSJORREN ;BIR/MV-RENEWAL FLAG ;6 DEC 00 / 3:11 PM 
"RTN","PSJORREN",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,70,58,89,91,110**;16 DEC 97
"RTN","PSJORREN",3,0)
 ;
"RTN","PSJORREN",4,0)
 ; Reference to ^PS(50.7 supported by DBIA #2180
"RTN","PSJORREN",5,0)
 ; References to ^PS(52.6 supported by DBIA #1231
"RTN","PSJORREN",6,0)
 ; References to ^PS(52.7 supported by DBIA #2173
"RTN","PSJORREN",7,0)
 ; References to ^PS(55 supported by DBIA #2191
"RTN","PSJORREN",8,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192
"RTN","PSJORREN",9,0)
 ;
"RTN","PSJORREN",10,0)
ACTIVE(DFN,ON) ;
"RTN","PSJORREN",11,0)
 ;DFN: Patient IEN
"RTN","PSJORREN",12,0)
 ;ON : Order number_"U/V/P"
"RTN","PSJORREN",13,0)
 ;Output: 0^reason not renewable (Can't renew)
"RTN","PSJORREN",14,0)
 ;        2^New OI (Need to create a new order as in edit)
"RTN","PSJORREN",15,0)
 ;          note: with PSJ*5*70 - instead of 2, IV order will return 0
"RTN","PSJORREN",16,0)
 ;        1 (OK to renew)
"RTN","PSJORREN",17,0)
 NEW PSJRT,PSJEXP
"RTN","PSJORREN",18,0)
 D:ON["U" UD
"RTN","PSJORREN",19,0)
 D:ON["V" IV
"RTN","PSJORREN",20,0)
 I (+$G(PSJRT)=1) S PSJEXP=$$EXPIRED^PSGOER(DFN,ON) I PSJEXP S PSJRT="0^Expired Time Limit Exceeded"
"RTN","PSJORREN",21,0)
 Q $G(PSJRT)
"RTN","PSJORREN",22,0)
UD ;
"RTN","PSJORREN",23,0)
 ;If both PSJRT(2) & (3) existed it meant order has multiple DDs and one
"RTN","PSJORREN",24,0)
 ;is tied to a different OI. It's best to not allow renewal of the order.
"RTN","PSJORREN",25,0)
 ;
"RTN","PSJORREN",26,0)
 NEW PSJDD,PSJDDOI,PSJDDX,PSJACT,PSJOI,PSJOIACT,PSJUSE,PSJPRI,X
"RTN","PSJORREN",27,0)
 K PSJRT
"RTN","PSJORREN",28,0)
 S PSJOI=+^PS(55,DFN,5,+ON,.2)
"RTN","PSJORREN",29,0)
 S PSJPRI=$P(^PS(55,DFN,5,+ON,.2),"^",4)
"RTN","PSJORREN",30,0)
 I PSJPRI="D" S PSJRT="0^Orders with a Done priority may not be renewed" Q
"RTN","PSJORREN",31,0)
 F PSJDD=0:0 S PSJDD=$O(^PS(55,DFN,5,+ON,1,PSJDD)) Q:('PSJDD!$D(PSJRT(1)))  D
"RTN","PSJORREN",32,0)
 . S (PSJACT,PSJOIACT)=0 S PSJDDX=^PS(55,DFN,5,+ON,1,PSJDD,0)
"RTN","PSJORREN",33,0)
 . S X=$P(PSJDDX,U,3) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",34,0)
 . S X=$G(^PSDRUG(+PSJDDX,"I")) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",35,0)
 . S X=$G(^PSDRUG(+PSJDDX,2)),PSJUSE=$P(X,U,3)["U",PSJDDOI=+X I '+PSJDDOI S PSJRT(3)="0^Dispense drug is not matched to an Orderable Item" Q
"RTN","PSJORREN",36,0)
 . S X=$P($G(^PS(50.7,+PSJDDOI,0)),U,4) I X]"",(X'>DT) S PSJOIACT=1
"RTN","PSJORREN",37,0)
 . I 'PSJACT,PSJUSE D  Q
"RTN","PSJORREN",38,0)
 .. I PSJOI=PSJDDOI D  Q
"RTN","PSJORREN",39,0)
 ... I 'PSJOIACT S PSJRT(1)=1 Q
"RTN","PSJORREN",40,0)
 ... S:PSJOIACT PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",41,0)
 .. I +PSJDDOI,(PSJOI'=PSJDDOI) D
"RTN","PSJORREN",42,0)
 ... S:'PSJOIACT PSJRT(2)="2"_U_PSJDDOI
"RTN","PSJORREN",43,0)
 ... S:PSJOIACT PSJRT(3)="0^Dispense drug ties to an inactive Orderable Item"
"RTN","PSJORREN",44,0)
 . I PSJACT S PSJRT(3)="0^This drug has been Inactivated"
"RTN","PSJORREN",45,0)
 . I 'PSJUSE S PSJRT(3)="0^Drug is No longer used in Inpatient Meds"
"RTN","PSJORREN",46,0)
 I $D(PSJRT(1)) S PSJRT=1 Q
"RTN","PSJORREN",47,0)
 I $D(PSJRT(2)),$D(PSJRT(3)) S PSJRT=PSJRT(3) Q
"RTN","PSJORREN",48,0)
 I '$D(PSJRT) S PSJRT="0^Order has no Dispense drug" Q
"RTN","PSJORREN",49,0)
 S X=$O(PSJRT(0)),PSJRT=$G(PSJRT(X))
"RTN","PSJORREN",50,0)
 Q
"RTN","PSJORREN",51,0)
IV ;
"RTN","PSJORREN",52,0)
 NEW FIL,PSJACT,PSJAS,PSJASNO,PSJASOI,PSJCNT,PSJIEN,PSJOI,PSJOIACT,PSJPRI,X
"RTN","PSJORREN",53,0)
 K PSJRT
"RTN","PSJORREN",54,0)
 S PSJCNT=0
"RTN","PSJORREN",55,0)
 S PSJOI=+$G(^PS(55,DFN,"IV",+ON,.2))
"RTN","PSJORREN",56,0)
 S PSJPRI=$P(^PS(55,DFN,"IV",+ON,.2),"^",4)
"RTN","PSJORREN",57,0)
 I PSJPRI="D" S PSJRT="0^Orders with a Done priority may not be renewed" Q
"RTN","PSJORREN",58,0)
 F FIL="AD","SOL"  F PSJAS=0:0 S PSJAS=$O(^PS(55,DFN,"IV",+ON,FIL,PSJAS)) Q:'PSJAS  D
"RTN","PSJORREN",59,0)
 . S (PSJACT,PSJOIACT)=0
"RTN","PSJORREN",60,0)
 . S PSJASNO=$S(FIL="AD":52.6,1:52.7)
"RTN","PSJORREN",61,0)
 . S PSJIEN=+^PS(55,DFN,"IV",+ON,FIL,PSJAS,0)
"RTN","PSJORREN",62,0)
 . S X=$G(^PS(PSJASNO,+PSJIEN,"I")) I X]"",(X'>DT) S PSJACT=1
"RTN","PSJORREN",63,0)
 . S PSJASOI=$P(^PS(PSJASNO,PSJIEN,0),U,11)
"RTN","PSJORREN",64,0)
 . S X=$P($G(^PS(50.7,+PSJASOI,0)),U,4) I X]"",(X'>DT) S PSJOIACT=1
"RTN","PSJORREN",65,0)
 . I PSJACT S PSJCNT=PSJCNT+1,PSJRT(3)="0^Inactive "_$S(FIL="AD":"Additive",1:"Solution") Q
"RTN","PSJORREN",66,0)
 . I PSJOI=PSJASOI D  Q
"RTN","PSJORREN",67,0)
 .. I 'PSJOIACT S PSJRT(1)="" Q
"RTN","PSJORREN",68,0)
 .. I PSJOIACT S PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",69,0)
 . I PSJOI'=PSJASOI D
"RTN","PSJORREN",70,0)
 .. I 'PSJOIACT S PSJCNT=PSJCNT+1,PSJRT(2)=2_U_PSJASOI
"RTN","PSJORREN",71,0)
 .. I PSJOIACT S PSJRT(3)="0^Inactive Orderable Item"
"RTN","PSJORREN",72,0)
 I $D(PSJRT(1)) S PSJRT=1 Q
"RTN","PSJORREN",73,0)
 I $D(PSJRT(3)) S PSJRT=PSJRT(3) Q
"RTN","PSJORREN",74,0)
 ;I $D(PSJRT(2)),PSJCNT=1 S PSJRT=PSJRT(2) Q
"RTN","PSJORREN",75,0)
 I $D(PSJRT(2)),PSJCNT=1 S PSJRT="0^New Orderable Item" Q
"RTN","PSJORREN",76,0)
 S PSJRT="0^Inactive drug"
"RTN","PSJORREN",77,0)
 Q
"RTN","PSJUTL")
0^123^B40218223
"RTN","PSJUTL",1,0)
PSJUTL ;BIR/MLM-MISC. INPATIENT UTILITIES ;17 Mar 98 / 11:05 AM
"RTN","PSJUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,47,58,80,110**;16 DEC 97
"RTN","PSJUTL",3,0)
 ;
"RTN","PSJUTL",4,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039.
"RTN","PSJUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJUTL",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJUTL",7,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJUTL",8,0)
 ; Reference to ^DIC1 is supported by DBIA 10007.
"RTN","PSJUTL",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJUTL",10,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJUTL",11,0)
 ;
"RTN","PSJUTL",12,0)
ENDL ; device look-up
"RTN","PSJUTL",13,0)
 N DA,DIC,DIE,DIX,DO,DR
"RTN","PSJUTL",14,0)
 S DIC="^%ZIS(1,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",15,0)
 S X=Y(0,0)
"RTN","PSJUTL",16,0)
 Q
"RTN","PSJUTL",17,0)
 ;
"RTN","PSJUTL",18,0)
ENDH(X) ; device help
"RTN","PSJUTL",19,0)
 N D,XQH,DA,DIC,DIE,DO,DR,DZ
"RTN","PSJUTL",20,0)
 S DIC="^%ZIS(1,",DIC(0)="EIM" D DO^DIC1,^DIC
"RTN","PSJUTL",21,0)
 Q
"RTN","PSJUTL",22,0)
 ;
"RTN","PSJUTL",23,0)
READ ; hold screen
"RTN","PSJUTL",24,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSJUTL",25,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","PSJUTL",26,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSJUTL",27,0)
 Q
"RTN","PSJUTL",28,0)
 ;
"RTN","PSJUTL",29,0)
ENOISC(PSJOI,USAGE)          ;Set DIC("S") so that only Orderable Items with at 
"RTN","PSJUTL",30,0)
 ;least 1 active dispense drug for the specified usage.
"RTN","PSJUTL",31,0)
 ;Input:  PSJOI IEN of Orderable Item selected
"RTN","PSJUTL",32,0)
 ;        USAGE - Type of drugs (UD,IV,etc) to be selected
"RTN","PSJUTL",33,0)
 ;Output: 1-At least one dispense drug found
"RTN","PSJUTL",34,0)
 ;        0-None found
"RTN","PSJUTL",35,0)
 N FOUND,PSJ
"RTN","PSJUTL",36,0)
 S PSJ=$P($G(^PS(50.7,+PSJOI,0)),U,4),FOUND=$S('PSJ:1,PSJ>DT:1,1:0)
"RTN","PSJUTL",37,0)
 I FOUND S FOUND=0 F PSJ=0:0 S PSJ=$O(^PSDRUG("ASP",PSJOI,PSJ)) Q:FOUND!'PSJ  I $P($G(^PSDRUG(PSJ,2)),U,3)[USAGE,'$G(^("I"))!($G(^("I"))'<DT) S FOUND=1
"RTN","PSJUTL",38,0)
 Q FOUND
"RTN","PSJUTL",39,0)
 ;
"RTN","PSJUTL",40,0)
AADR ; display allergies and adverse reactions
"RTN","PSJUTL",41,0)
 D ATS^PSJMUTL(60,50,1) N A,B
"RTN","PSJUTL",42,0)
 I (PSGALG=0)&(PSGADR=0) W !!,"No allergies or ADRs on file."
"RTN","PSJUTL",43,0)
 I PSGALG'=0 W !!,"Allergies: " S B="PSGALG" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",44,0)
 I PSGADR'=0 W !,"      ADR: " S B="PSGADR" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",45,0)
 D READ K PSGALG,PSGADR Q
"RTN","PSJUTL",46,0)
 ;
"RTN","PSJUTL",47,0)
ENALU ; application look-up
"RTN","PSJUTL",48,0)
 N PSJ S PSJ=DA(1) N DA,DIC,DIE,DIX,DO,DR S DIC="^PS(50.35,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",49,0)
 S X=$P(Y(0),"^",2) K:$S(X="":1,1:$D(^PS(50.3,PSJ,1,"B",X))) X
"RTN","PSJUTL",50,0)
 Q
"RTN","PSJUTL",51,0)
 ;
"RTN","PSJUTL",52,0)
ENAQ ; application query
"RTN","PSJUTL",53,0)
 S X=DZ N D,DA,DIC,DIE,DO,DR,DZ,XQH S DIC="^PS(50.35,",DIC(0)="EIMQ" D DO^DIC1,^DIC
"RTN","PSJUTL",54,0)
 Q
"RTN","PSJUTL",55,0)
 ;
"RTN","PSJUTL",56,0)
ENPC(PSJTYP,PSJSYSP,LEN,TEXT) ; Copy Provider Comments -> Special Instructions.
"RTN","PSJUTL",57,0)
 Q:'$D(^PS(53.1,+$G(PSJORD),12,1,0)) ""
"RTN","PSJUTL",58,0)
 N DIR,PSGSI,PSGOEE,X,Y
"RTN","PSJUTL",59,0)
 S Y="" F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  S Y=Y_^(X,0)_" " Q:$L(Y)>LEN
"RTN","PSJUTL",60,0)
 S:$G(PSJTYP)'="V" Y=$$ENSET^PSGSICHK(Y) S:$G(PSJTYP)="V" Y=$E(Y,1,$L(Y)-1)
"RTN","PSJUTL",61,0)
 I $L(Y)'<LEN S PSGOEE=0 D REDISP Q PSGSI
"RTN","PSJUTL",62,0)
 S PSGSI=Y W ! S DIR(0)="S^Y:Yes;N:No;!:Copy and flag for display in a BCMA Message Box",DIR("A")="Copy the Provider Comments into "_$$ENFIELD(PSJTYP)_" (Yes/No/!)",DIR("??")="^D ENPCHLP1^PSJUTL(PSJTYP)" D ^DIR
"RTN","PSJUTL",63,0)
 Q:Y="Y" PSGSI
"RTN","PSJUTL",64,0)
 Q:Y="!" PSGSI_"^1"
"RTN","PSJUTL",65,0)
 Q ""
"RTN","PSJUTL",66,0)
 ;
"RTN","PSJUTL",67,0)
REDISP ; Redisplay Provider Comments and allow entry of Spec. Instructions.
"RTN","PSJUTL",68,0)
 D CLEAR^VALM1 F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  W ^(X,0),!
"RTN","PSJUTL",69,0)
 W !! S PSGSI=""
"RTN","PSJUTL",70,0)
 D:PSJTYP'="V" 8^PSGOE81
"RTN","PSJUTL",71,0)
 I PSJTYP="V" D 64^PSIVEDT1 S PSGSI=P("OPI")
"RTN","PSJUTL",72,0)
 Q
"RTN","PSJUTL",73,0)
 ;
"RTN","PSJUTL",74,0)
ENPCHLP1(Y) ; Display help messages for Provider Comment copy.
"RTN","PSJUTL",75,0)
 W !,"Enter ""YES"" to copy Provider Comments into the ",$$ENFIELD(Y)," field",!,"or ""NO"" to bypass",!,"or ""!"" to copy the Provider Comments into the ",$$ENFIELD(PSJTYP)," field",!,"and flag them for display in a BCMA Message Box",!!
"RTN","PSJUTL",76,0)
 Q
"RTN","PSJUTL",77,0)
ENPCHLP2(Y,X) ;
"RTN","PSJUTL",78,0)
 W !,"The Provider Comments entered for this order are longer than the space available",!,"in the ",$$ENFIELD(Y)," field.",!!,"Enter ""YES"" to copy the first ",X-3," characters into the ",$$ENFIELD(Y),!,"field, or ""NO"" to continue.",!!
"RTN","PSJUTL",79,0)
 Q
"RTN","PSJUTL",80,0)
ENBCMA(PSJTYP)  ;
"RTN","PSJUTL",81,0)
 N DIR,X,Y
"RTN","PSJUTL",82,0)
 W !!,"Would you like to flag the ",$$ENFIELD(PSJTYP)," field for display in a BCMA",!,"Message box?"
"RTN","PSJUTL",83,0)
 W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Flag the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",84,0)
 K PSJCOMSI I $G(PSJCOM),$G(PSJORD)'["P" N TEXT S TEXT=$S(PSJTYP="U":$G(PSGSI),1:$G(P("OPI"))) S PSJCOMSI=$$COMSI(PSJCOM,TEXT)
"RTN","PSJUTL",85,0)
 Q:Y="Y" $S($G(PSJTYP)="U":$P(PSGSI,"^")_"^1",1:$P(P("OPI"),"^")_"^1")
"RTN","PSJUTL",86,0)
 Q $S(PSJTYP="U":$P(PSGSI,"^"),1:$P($G(P("OPI")),"^"))
"RTN","PSJUTL",87,0)
ENFIELD(Y) ;
"RTN","PSJUTL",88,0)
 Q $S(Y="V":"Other Print Info",1:"Special Instructions")
"RTN","PSJUTL",89,0)
 ;
"RTN","PSJUTL",90,0)
COMSI(PARENT,INSTR) ;
"RTN","PSJUTL",91,0)
 N DIR,X,Y
"RTN","PSJUTL",92,0)
 W !!!!?15,"** WARNING **",!?5,"This order is part of a complex order."
"RTN","PSJUTL",93,0)
 W !!,"Would you like to copy the ",$$ENFIELD(PSJTYP)
"RTN","PSJUTL",94,0)
 W !,"to the other orders in the complex order?"
"RTN","PSJUTL",95,0)
 S DIR(0)="S^Y:Yes;N:No",DIR("A")="     Copy the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",96,0)
 Q:Y="Y" 1
"RTN","PSJUTL",97,0)
 Q 0
"RTN","PSJUTL",98,0)
 ;
"RTN","PSJUTL",99,0)
ENORL(X) ; Return patient's location as variable ptr.
"RTN","PSJUTL",100,0)
 Q $S(+$G(^DIC(42,+X,44)):+$G(^(44))_";SC(",$D(^DIC(42,+X,0)):+X_";DIC(42,",1:"")
"RTN","PSJUTL",101,0)
 ;
"RTN","PSJUTL",102,0)
ENMARD() ; validate MAR SELECTION DEFAULT string in WARD PARMS file.
"RTN","PSJUTL",103,0)
 N PSJANS,PSJX1,PSJX2,RANGE,Q
"RTN","PSJUTL",104,0)
 S RANGE="1:6" F PSJX1=1:1:6 S RANGE(PSJX1)=""
"RTN","PSJUTL",105,0)
 S:$E(X)="-" X=+RANGE_X S:$E($L(X))="-" X=X_$P(RANGE,":",2)
"RTN","PSJUTL",106,0)
 S PSJANS="" F Q=1:1:$L(X,",") S PSJX1=$P(X,",",Q) D FS Q:'$D(PSJANS)
"RTN","PSJUTL",107,0)
 Q:'$G(PSJANS) 0
"RTN","PSJUTL",108,0)
 S PSJANS=$E(PSJANS,1,$L(PSJANS)-1) F Q=1:1:$L(PSJANS,",") D  Q:'$D(PSJANS)
"RTN","PSJUTL",109,0)
 .I $P(PSJANS,",",Q)=1,$L(PSJANS,",")>1 W !!,"All Medications (1) may not be selected in combination with other types." K PSJANS Q
"RTN","PSJUTL",110,0)
 .W ?47,$P(PSJANS,",",Q)," - ",$P($T(@$P(PSJANS,",",Q)),";;",2),!
"RTN","PSJUTL",111,0)
 S:$G(PSJANS) X=PSJANS Q $G(PSJANS)
"RTN","PSJUTL",112,0)
 ;
"RTN","PSJUTL",113,0)
FS ;
"RTN","PSJUTL",114,0)
 I $S(PSJX1?1.N1"-"1.N:0,PSJX1'?1.N:1,'$D(RANGE(PSJX1)):1,1:","_PSJANS[PSJX1) K PSJANS Q
"RTN","PSJUTL",115,0)
 I PSJX1'["-" S PSJANS=PSJANS_PSJX1_"," Q
"RTN","PSJUTL",116,0)
 S PSJX2=+PSJX1,PSJANS=PSJANS_PSJX2_","
"RTN","PSJUTL",117,0)
 F  S PSJX2=$O(RANGE(PSJX2)) K:$S(X="":1,","_PSJANS[PSJX2:1,1:PSJX2>$P(PSJX1,"-",2)) PSJANS Q:'$D(PSJANS)  S PSJANS=PSJANS_PSJX2_"," Q:PSJX2=$P(PSJX1,"-",2)
"RTN","PSJUTL",118,0)
 Q
"RTN","PSJUTL",119,0)
 ;
"RTN","PSJUTL",120,0)
ENMARDH ;Help text for MAR default answer.
"RTN","PSJUTL",121,0)
 W !!?2,"Enter the number corresponding to the type of orders to be included on MARs",!,"printed for this ward. Multiple types (except 1) may be selected using ""-""",!,"or "","" as delimiters.",!!,"Choose from: ",!
"RTN","PSJUTL",122,0)
 N X F X=1:1:6 W !?13,X," - ",$P($T(@X),";;",2)
"RTN","PSJUTL",123,0)
 W !
"RTN","PSJUTL",124,0)
 Q
"RTN","PSJUTL",125,0)
1 ;;All Medications
"RTN","PSJUTL",126,0)
2 ;;Non-IV Medications only
"RTN","PSJUTL",127,0)
3 ;;IV Piggybacks
"RTN","PSJUTL",128,0)
4 ;;LVPs
"RTN","PSJUTL",129,0)
5 ;;TPNs
"RTN","PSJUTL",130,0)
6 ;;Chemotherapy Medications (IV)
"RTN","PSJUTL2")
0^124^B8888677
"RTN","PSJUTL2",1,0)
PSJUTL2  ;BIR/LDT-MISC UTILITIES FOR INPATIENT MEDICATIONS ;18 Aug 98 / 2:48 PM
"RTN","PSJUTL2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**63,58,81,105,110**;16 DEC 97
"RTN","PSJUTL2",3,0)
 ;
"RTN","PSJUTL2",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSJUTL2",5,0)
 ; Reference to ^PSBAPIPM is supported by DBIA# 3564.
"RTN","PSJUTL2",6,0)
 ;
"RTN","PSJUTL2",7,0)
BCMALG(PSJX,PSJY)     ;Returns BCMA Last Action formatted for printing
"RTN","PSJUTL2",8,0)
 N PSJLAST S PSJLACT=""
"RTN","PSJUTL2",9,0)
 I PSJY["V" Q:$G(^PS(55,PSJX,"IV",+PSJY,.2))="" ""
"RTN","PSJUTL2",10,0)
 S PSJLAST=$$EN^PSBAPIPM(PSJX,PSJY)
"RTN","PSJUTL2",11,0)
 I PSJLAST]"" S PSJLACT="BCMA ORDER LAST ACTION: "_$$ENDTC1^PSGMI($P(PSJLAST,"^",2))_" "_$$EXTERNAL^DILFD(53.79,.09,"",$P(PSJLAST,"^",3))
"RTN","PSJUTL2",12,0)
 I PSJLAST="" D PREV
"RTN","PSJUTL2",13,0)
 Q PSJLACT
"RTN","PSJUTL2",14,0)
 ;
"RTN","PSJUTL2",15,0)
PREV ;If the original order has no administration data logged against it then check to see if there is data for the previous order.
"RTN","PSJUTL2",16,0)
 N PREON
"RTN","PSJUTL2",17,0)
 S PREON=$S(PSJY["V":$P($G(^PS(55,PSJX,"IV",+PSJY,2)),"^",5),PSJY["U":$P($G(^PS(55,PSJX,5,+PSJY,0)),"^",25),1:$P($G(^PS(53.1,+PSJY,0)),"^",25))
"RTN","PSJUTL2",18,0)
 I PREON]"" S PSJLAST=$$EN^PSBAPIPM(PSJX,PREON)
"RTN","PSJUTL2",19,0)
 I PSJLAST]"" S PSJLACT="BCMA ORDER LAST ACTION: "_$$ENDTC1^PSGMI($P(PSJLAST,"^",2))_" "_$$EXTERNAL^DILFD(53.79,.09,"",$P(PSJLAST,"^",3))_"*"
"RTN","PSJUTL2",20,0)
 Q
"RTN","PSJUTL2",21,0)
 ;
"RTN","PSJUTL2",22,0)
DATE() ;Returns date in fileman format with a time in hours and minutes.
"RTN","PSJUTL2",23,0)
 S PSGDT="" N X,TIM
"RTN","PSJUTL2",24,0)
 D NOW^%DTC D
"RTN","PSJUTL2",25,0)
 .I $L(%)=12 S X=% Q
"RTN","PSJUTL2",26,0)
 .I $L(%)=14 S X=$E(%,13,14) S:X>29 X=$E(%,1,12)_5 S:X'>29 X=$E(%,1,12)_1 Q
"RTN","PSJUTL2",27,0)
 .I $L(%)=13 S X=$E(%,13)_0 S:X>29 X=$E(%,1,12)_5 S:X'>29 X=$E(%,1,12)_1 Q
"RTN","PSJUTL2",28,0)
 S PSGDT=$S($G(X)]"":+$FN($G(X),"",4),1:PSJDT) I '$P(PSGDT,".",2) S PSGDT=$$FMADD^XLFDT(PSGDT,-1,0,0,0)_.24
"RTN","PSJUTL2",29,0)
 S TIM=$P(PSGDT,".",2) I $E(TIM,3)=6 S TIM=$E(TIM,1,2)+1,PSGDT=$P(PSGDT,".")_"."_$TR($J(TIM,2)," ",0)
"RTN","PSJUTL2",30,0)
 Q PSGDT
"RTN","PSJUTL2",31,0)
 ;
"RTN","PSJUTL2",32,0)
DATE2(PSJDT) ;Returns date in fileman format with a time in hours and minutes
"RTN","PSJUTL2",33,0)
 Q:'$G(PSJDT) ""
"RTN","PSJUTL2",34,0)
 N X,TIM D
"RTN","PSJUTL2",35,0)
 .I $L(PSJDT)=12 S X=PSJDT Q
"RTN","PSJUTL2",36,0)
 .I $L(PSJDT)=14 S X=$E(PSJDT,13,14) S:X>29 X=$E(PSJDT,1,12)_5 S:X'>29 X=$E(PSJDT,1,12)_1 Q
"RTN","PSJUTL2",37,0)
 .I $L(PSJDT)=13 S X=$E(PSJDT,13)_0 S:X>29 X=$E(PSJDT,1,12)_5 S:X'>29 X=$E(PSJDT,1,12)_1 Q
"RTN","PSJUTL2",38,0)
 S PSJDT=$S($G(X)]"":+$FN($G(X),"",4),1:PSJDT) I '$P(PSJDT,".",2) S PSJDT=$$FMADD^XLFDT(PSJDT,-1,0,0,0)_.24
"RTN","PSJUTL2",39,0)
 S TIM=$P(PSJDT,".",2) I $E(TIM,3)=6 S TIM=$E(TIM,1,2)+1,PSJDT=$P(PSJDT,".")_"."_$TR($J(TIM,2)," ",0)
"RTN","PSJUTL2",40,0)
 Q PSJDT
"RTN","PSJUTL2",41,0)
 ;
"RTN","PSJUTL2",42,0)
RNEWOK(DAD,PSJDFN) ;Returns 1 or 0 if all in complex order series are active.
"RTN","PSJUTL2",43,0)
 N F,I,II,Y,NODE0,STAT S Y=1,I=0,II=""
"RTN","PSJUTL2",44,0)
 F  S I=$O(^PS(55,"ACX",DAD,I)) Q:'I  F  S II=$O(^PS(55,"ACX",DAD,I,II)) Q:II=""  D  Q:Y=0
"RTN","PSJUTL2",45,0)
 .S F=$S(II["V":"^PS(55,"_PSJDFN_",""IV"","_+II,II["U":"^PS(55,"_PSJDFN_",5,"_+II,1:"") S:F="" Y=0 Q:Y=0
"RTN","PSJUTL2",46,0)
 .S NODE0=$G(@(F_",0)")),STAT=$S(II["V":($P(NODE0,"^",17)),1:($P(NODE0,"^",9))) I STAT'="A" S Y=0 I STAT="E" D
"RTN","PSJUTL2",47,0)
 ..S Y='$$EXPIRED^PSGOER(PSJDFN,II)
"RTN","PSJUTL2",48,0)
 Q Y
"VER")
8.0^22.0
"^DD",53.1,53.1,125,0)
ORDERS FILE PARENT ORDER^P100'^OR(100,^.2;8^Q
"^DD",53.1,53.1,125,1,0)
^.1
"^DD",53.1,53.1,125,1,1,0)
53.1^ACX
"^DD",53.1,53.1,125,1,1,1)
I ($G(SCHEDULE)'="NOW") S ^PS(53.1,"ACX",$E(X,1,30),DA)=""
"^DD",53.1,53.1,125,1,1,2)
K ^PS(53.1,"ACX",$E(X,1,30),DA)
"^DD",53.1,53.1,125,1,1,"%D",0)
^^4^4^3040806^
"^DD",53.1,53.1,125,1,1,"%D",1,0)
This cross reference is created each time a component of a complex order 
"^DD",53.1,53.1,125,1,1,"%D",2,0)
(child order) is received from CPRS. This cross reference will not be 
"^DD",53.1,53.1,125,1,1,"%D",3,0)
created for orders with a schedule of NOW, effectively disassociating the 
"^DD",53.1,53.1,125,1,1,"%D",4,0)
NOW order from the other child orders in the complex order.
"^DD",53.1,53.1,125,1,1,"DT")
3030716
"^DD",53.1,53.1,125,3)
Enter the parent, if this order is its child.
"^DD",53.1,53.1,125,21,0)
^^2^2^3020828^
"^DD",53.1,53.1,125,21,1,0)
This is the parent of an order that may have a parent/child relationship 
"^DD",53.1,53.1,125,21,2,0)
in CPRS.
"^DD",53.1,53.1,125,"DT")
3030716
**INSTALL NAME**
OR*3.0*213
"BLD",4339,0)
OR*3.0*213^ORDER ENTRY/RESULTS REPORTING^0^3040908^y
"BLD",4339,4,0)
^9.64PA^^
"BLD",4339,"KRN",0)
^9.67PA^8989.52^19
"BLD",4339,"KRN",.4,0)
.4
"BLD",4339,"KRN",.401,0)
.401
"BLD",4339,"KRN",.402,0)
.402
"BLD",4339,"KRN",.403,0)
.403
"BLD",4339,"KRN",.5,0)
.5
"BLD",4339,"KRN",.84,0)
.84
"BLD",4339,"KRN",3.6,0)
3.6
"BLD",4339,"KRN",3.8,0)
3.8
"BLD",4339,"KRN",9.2,0)
9.2
"BLD",4339,"KRN",9.8,0)
9.8
"BLD",4339,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",4339,"KRN",9.8,"NM",1,0)
ORMPS^^0^B74518847
"BLD",4339,"KRN",9.8,"NM",2,0)
ORMPS3^^0^B6681495
"BLD",4339,"KRN",9.8,"NM",3,0)
ORQ2^^0^B36745923
"BLD",4339,"KRN",9.8,"NM",4,0)
ORWDXR^^0^B36855643
"BLD",4339,"KRN",9.8,"NM",5,0)
ORWDXA^^0^B75626586
"BLD",4339,"KRN",9.8,"NM",6,0)
ORCACT01^^0^B74547868
"BLD",4339,"KRN",9.8,"NM","B","ORCACT01",6)

"BLD",4339,"KRN",9.8,"NM","B","ORMPS",1)

"BLD",4339,"KRN",9.8,"NM","B","ORMPS3",2)

"BLD",4339,"KRN",9.8,"NM","B","ORQ2",3)

"BLD",4339,"KRN",9.8,"NM","B","ORWDXA",5)

"BLD",4339,"KRN",9.8,"NM","B","ORWDXR",4)

"BLD",4339,"KRN",19,0)
19
"BLD",4339,"KRN",19.1,0)
19.1
"BLD",4339,"KRN",101,0)
101
"BLD",4339,"KRN",409.61,0)
409.61
"BLD",4339,"KRN",771,0)
771
"BLD",4339,"KRN",870,0)
870
"BLD",4339,"KRN",8989.51,0)
8989.51
"BLD",4339,"KRN",8989.52,0)
8989.52
"BLD",4339,"KRN",8994,0)
8994
"BLD",4339,"KRN","B",.4,.4)

"BLD",4339,"KRN","B",.401,.401)

"BLD",4339,"KRN","B",.402,.402)

"BLD",4339,"KRN","B",.403,.403)

"BLD",4339,"KRN","B",.5,.5)

"BLD",4339,"KRN","B",.84,.84)

"BLD",4339,"KRN","B",3.6,3.6)

"BLD",4339,"KRN","B",3.8,3.8)

"BLD",4339,"KRN","B",9.2,9.2)

"BLD",4339,"KRN","B",9.8,9.8)

"BLD",4339,"KRN","B",19,19)

"BLD",4339,"KRN","B",19.1,19.1)

"BLD",4339,"KRN","B",101,101)

"BLD",4339,"KRN","B",409.61,409.61)

"BLD",4339,"KRN","B",771,771)

"BLD",4339,"KRN","B",870,870)

"BLD",4339,"KRN","B",8989.51,8989.51)

"BLD",4339,"KRN","B",8989.52,8989.52)

"BLD",4339,"KRN","B",8994,8994)

"BLD",4339,"QUES",0)
^9.62^^
"BLD",4339,"REQB",0)
^9.611^1^1
"BLD",4339,"REQB",1,0)
OR*3.0*190^2
"BLD",4339,"REQB","B","OR*3.0*190",1)

"MBREQ")
0
"PKG",170,-1)
1^1
"PKG",170,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
3.0^2971217^2980917^11712
"PKG",170,22,1,"PAH",1,0)
213^3040908^10000000009
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","ORCACT01")
0^6^B74547868
"RTN","ORCACT01",1,0)
ORCACT01 ;SLC/MKB-Validate order actions cont ;5/6/04  20:39
"RTN","ORCACT01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,134,141,163,187,190,213**;Dec 17, 1997
"RTN","ORCACT01",3,0)
 ;
"RTN","ORCACT01",4,0)
ES ; -- sign [on chart]
"RTN","ORCACT01",5,0)
 I ORDSTS=11,VER<3,PKG'="OR" S ERROR="This order cannot be released and must be discontinued!" Q
"RTN","ORCACT01",6,0)
 N X I ACTSTS=11!(ACTSTS=10) D  Q:$L($G(ERROR))
"RTN","ORCACT01",7,0)
 . I $P(ORA0,U,2)="DC",$$DONE^ORCACT0 D CANCEL^ORCSEND(+IFN),UNOTIF^ORCSIGN S OREBUILD=1 Q
"RTN","ORCACT01",8,0)
 . S X=$$DISABLED^ORCACT0 I X S ERROR=$P(X,U,2) Q
"RTN","ORCACT01",9,0)
 I ACTION="OC",$G(DG)="NV RX" S:MEDPARM<2 ERROR="You are not authorized to release non-VA med orders!" Q
"RTN","ORCACT01",10,0)
 S X=$P(ORA0,U,4) I X=3 S:ACTSTS'=11&(ACTSTS'=10) ERROR="This order does not require a signature!" Q
"RTN","ORCACT01",11,0)
 I X'=2 S ERROR="This order has been signed!" Q
"RTN","ORCACT01",12,0)
 I DG="O RX",ACTION'="ES",ACTION'="DS",$G(NATR)'="I" S ERROR="Outpatient meds may not be released without a clinician's signature!" Q
"RTN","ORCACT01",13,0)
 I (ACTION="ES"!(ACTION="DS")),$D(^XUSEC("ORELSE",DUZ)),$P(OR0,U,16)'<2 S ERROR="You are not privileged to sign this order!" Q
"RTN","ORCACT01",14,0)
 I ACTION="OC" S:MEDPARM<2 ERROR="You are not authorized to release med orders!" Q
"RTN","ORCACT01",15,0)
 I ACTION="RS" D  Q:$D(ERROR)  Q:$G(NATR)'="I"
"RTN","ORCACT01",16,0)
 . Q:ACTSTS=11  Q:ACTSTS=10  ;unreleased - ok
"RTN","ORCACT01",17,0)
 . S ERROR="This order has already been released!"
"RTN","ORCACT01",18,0)
ES1 I PKG="PS" D  ;authorized to write meds?
"RTN","ORCACT01",19,0)
 . N TYPE,OI,PSOI,DEAFLG,PKI
"RTN","ORCACT01",20,0)
 . S X=$G(^VA(200,DUZ,"PS"))
"RTN","ORCACT01",21,0)
 . I '$P(X,U) S ERROR="You are not authorized to sign med orders!" Q
"RTN","ORCACT01",22,0)
 . I $P(X,U,4),$$NOW^XLFDT>$P(X,U,4) S ERROR="You are no longer authorized to sign med orders!" Q
"RTN","ORCACT01",23,0)
 . Q:DG="IV RX"  Q:$P(ORA0,U,2)="DC"  ;don't need to ck DEA#
"RTN","ORCACT01",24,0)
 . S OI=+$$VALUE^ORX8(+IFN,"ORDERABLE")
"RTN","ORCACT01",25,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2) Q:PSOI'>0
"RTN","ORCACT01",26,0)
 . S TYPE=$S($P(DG," ")="O":"O",1:"I"),DEAFLG=$$OIDEA^PSSUTLA1(PSOI,TYPE)
"RTN","ORCACT01",27,0)
 . I DEAFLG>0,'$L($$DEA^XUSER()) S ERROR="You must have a valid DEA# or VA# to sign this order!" Q
"RTN","ORCACT01",28,0)
 . D PKISITE^ORWOR(.PKI)
"RTN","ORCACT01",29,0)
 . I $G(PKI),ACTION="RS",DEAFLG=1 S ERROR="This order cannot be released without a Digital Signature" Q
"RTN","ORCACT01",30,0)
 Q
"RTN","ORCACT01",31,0)
 ;
"RTN","ORCACT01",32,0)
XFR ; -- transfer to inpt/outpt [IFN=order to be transferred]
"RTN","ORCACT01",33,0)
 N OI,PS I DG="TPN" S ERROR="TPN orders may not be copied!" Q
"RTN","ORCACT01",34,0)
 I $$INACTIVE S ERROR="Orders for inactive orderables may not be transferred; please enter a new order!" Q
"RTN","ORCACT01",35,0)
 S OI=+$O(^OR(100,+IFN,.1,"B",0)),ORPS=$G(^ORD(101.43,OI,"PS"))
"RTN","ORCACT01",36,0)
 I DG="UD RX",'$P(ORPS,U,2) S ERROR="This drug may not be ordered for an outpatient!" Q
"RTN","ORCACT01",37,0)
 I DG="O RX" D  Q:$L($G(ERROR))
"RTN","ORCACT01",38,0)
 . I '$P(ORPS,U) S ERROR="This drug may not be ordered for an inpatient!" Q
"RTN","ORCACT01",39,0)
 . D:$O(^OR(100,+IFN,4.5,"ID","MISC",0)) DOSES^ORCACT02(+IFN)
"RTN","ORCACT01",40,0)
 Q
"RTN","ORCACT01",41,0)
 ;
"RTN","ORCACT01",42,0)
RW ; -- rewrite/copy
"RTN","ORCACT01",43,0)
 I ACTSTS=12 S ERROR="Orders that have been dc'd due to editing may not be copied!" Q
"RTN","ORCACT01",44,0)
 I DG="NV RX" S ERROR="Non-VA Med orders cannot be copied!" Q
"RTN","ORCACT01",45,0)
 I DG="TPN" S ERROR="TPN orders may not be rewritten!" Q
"RTN","ORCACT01",46,0)
 I DG="UD RX",$$NTBG(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be rewritten!" Q
"RTN","ORCACT01",47,0)
 I $$INACTIVE S ERROR="Orders for inactive orderables may not be copied; please enter a new order!" Q
"RTN","ORCACT01",48,0)
 I PKG="PS",'$$MEDOK S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",49,0)
 I DG="O RX",$O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old form
"RTN","ORCACT01",50,0)
 Q
"RTN","ORCACT01",51,0)
 ;
"RTN","ORCACT01",52,0)
RN ; -- renew
"RTN","ORCACT01",53,0)
 I PKG'="PS",PKG'="OR" S ERROR="This order may not be renewed!" Q
"RTN","ORCACT01",54,0)
 I (ORDSTS=11)!(ORDSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT01",55,0)
 I ACTSTS=12 S ERROR="Orders that have been dc'd due to editing may not be renewed!" Q
"RTN","ORCACT01",56,0)
 I $P(OR3,U,6) S ERROR="This order has already been "_$S($P($G(^OR(100,+$P(OR3,U,6),3)),U,11)=1:"changed!",1:"renewed!") Q
"RTN","ORCACT01",57,0)
 I PKG="OR" D  Q  ;Generic orders
"RTN","ORCACT01",58,0)
 . I $$INACTIVE S ERROR="Orders for inactive orderables may not be renewed!" Q
"RTN","ORCACT01",59,0)
 . I DG="ADT" S ERROR="M.A.S. orders may not be renewed!" Q
"RTN","ORCACT01",60,0)
 . I "^1^2^6^7^"[(U_ORDSTS_U) Q  ;ok
"RTN","ORCACT01",61,0)
 . S ERROR="This order may not be renewed!"
"RTN","ORCACT01",62,0)
 I (PKG="PS"),$$INACTIVE S ERROR="Orders for inactive orderables may not be renewed!" Q
"RTN","ORCACT01",63,0)
 I '$$MEDOK S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",64,0)
RN1 N PSIFN S PSIFN=$G(^OR(100,+IFN,4))
"RTN","ORCACT01",65,0)
 I PSIFN<1,'$O(^OR(100,+IFN,2,0)) S ERROR="Missing or invalid order number!" Q
"RTN","ORCACT01",66,0)
 I DG="O RX" D  Q  ;Outpt Meds
"RTN","ORCACT01",67,0)
 . N ORZ,ORD S ORZ=$L($T(RENEW^PSORENW),",")
"RTN","ORCACT01",68,0)
 . I ORZ>1 S ORD=+$$VALUE^ORX8(+IFN,"DRUG"),X=$$RENEW^PSORENW(PSIFN,ORD)
"RTN","ORCACT01",69,0)
 . S:ORZ'>1 X=$$RENEW^PSORENW(PSIFN) I X<1 S ERROR=$P(X,U,2) Q
"RTN","ORCACT01",70,0)
 . S X=+$P(X,U,2) D:X RESET(+IFN,X)
"RTN","ORCACT01",71,0)
 . I $O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old format
"RTN","ORCACT01",72,0)
 I DG="UD RX",$$NTBG(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be renewed!" Q
"RTN","ORCACT01",73,0)
 I ORDSTS=7,'$$IV,$P(OR0,U,9)<$$FMADD^XLFDT(DT,-4)  S ERROR="Inpatient med orders may not be renewed more than 4 days after expiration!" Q
"RTN","ORCACT01",74,0)
 I ORDSTS'=6,ORDSTS'=7 S ERROR="This order may not be renewed!" Q
"RTN","ORCACT01",75,0)
RN2 I $O(^OR(100,+IFN,2,0))!$P(OR3,U,9) D  Q:$D(ERROR)!'PSIFN
"RTN","ORCACT01",76,0)
 . I $P(OR3,U,9),$$VALUE^ORX8(+IFN,"SCHEDULE",1,"E")="NOW" S ERROR="One-time NOW orders may not be renewed!" Q
"RTN","ORCACT01",77,0)
 . N DAD,ORD3,I,Y S DAD=$S($P(OR3,U,9):+$P(OR3,U,9),1:+IFN),Y=0
"RTN","ORCACT01",78,0)
 . S ORD3=$G(^OR(100,DAD,3)) I $P(ORD3,U,6) S ERROR="This complex order has already been renewed!" Q
"RTN","ORCACT01",79,0)
 . I $P(ORD3,U,3)'=6 S ERROR="This complex order is not active and may not be renewed!" Q
"RTN","ORCACT01",80,0)
 . I '$$AND^ORX8(DAD) S ERROR="Complex orders with sequential doses may not be renewed!" Q
"RTN","ORCACT01",81,0)
 . S I=0 F  S I=+$O(^OR(100,DAD,2,I)) Q:I<1  D  Q:Y
"RTN","ORCACT01",82,0)
 .. I I=+$O(^OR(100,DAD,2,0)),$$VALUE^ORX8(I,"SCHEDULE",1,"E")="NOW",$$VALUE^ORX8(DAD,"NOW") Q  ;ignore NOW orders
"RTN","ORCACT01",83,0)
 .. I $P($G(^OR(100,I,3)),U,3)'=6 S Y=1,ERROR="Complex orders with terminated doses may not be renewed!" Q
"RTN","ORCACT01",84,0)
 .. I PSIFN<1 S X=$$ACTIVE^PSJORREN(+ORVP,$G(^OR(100,I,4))) I +X'=1 S ERROR="This order may not be renewed: "_$S(+X>1:"Inactive orderable item",1:$P(X,U,2)) Q
"RTN","ORCACT01",85,0)
 ;I DG="TPN" S ERROR="TPN orders may not be renewed!" Q
"RTN","ORCACT01",86,0)
 S X=$$ACTIVE^PSJORREN(+ORVP,PSIFN) Q:+X=1  ;Ok
"RTN","ORCACT01",87,0)
 I +X>1,$P(X,U,2) D RESET(+IFN,+$P(X,U,2)) Q  ;replace OI
"RTN","ORCACT01",88,0)
 S ERROR="This order may not be renewed: "_$P(X,U,2)
"RTN","ORCACT01",89,0)
 Q
"RTN","ORCACT01",90,0)
 ;
"RTN","ORCACT01",91,0)
XX ; -- edit/change--
"RTN","ORCACT01",92,0)
 I PKG="RA",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Radiology cannot be changed!" Q
"RTN","ORCACT01",93,0)
 I PKG="LR",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Lab cannot be changed!" Q
"RTN","ORCACT01",94,0)
 I PKG="FH",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Dietetics cannot be changed!" Q
"RTN","ORCACT01",95,0)
 I PKG="GMRC",ORDSTS'=11,ORDSTS'=10 S ERROR="Orders released to Consults cannot be changed!" Q
"RTN","ORCACT01",96,0)
 I DG="TPN" S ERROR="TPN orders may not be changed!" Q
"RTN","ORCACT01",97,0)
 I ORDSTS=3 S ERROR="Orders on hold may not be changed!" Q
"RTN","ORCACT01",98,0)
 I DG="UD RX",$$NTBG(+IFN) S ERROR="This order has been marked 'Not to be Given' and may not be changed!" Q
"RTN","ORCACT01",99,0)
 I $O(^OR(100,+IFN,2,0)) S ERROR="Complex orders may not be changed!" Q
"RTN","ORCACT01",100,0)
 I $P(OR3,U,9) D  Q:$D(ERROR)
"RTN","ORCACT01",101,0)
 . Q:$$VALUE^ORX8(+IFN,"SCHEDULE",1,"E")="NOW"  ;NOW ok
"RTN","ORCACT01",102,0)
 . Q:'$O(^OR(100,+$P(OR3,U,9),4.5,"ID","CONJ",0))  ;no conj=1dose/ok
"RTN","ORCACT01",103,0)
 . S ERROR="Complex orders may not be changed!" Q
"RTN","ORCACT01",104,0)
 I $P(OR3,U,6) S ERROR="This order may not be changed - a "_$S($P($G(^OR(100,+$P(OR3,U,6),3)),U,11)=1:"change",1:"renewal")_" order already exists!" Q
"RTN","ORCACT01",105,0)
 I $P(OR3,U,11)=2 D  Q:$D(ERROR)
"RTN","ORCACT01",106,0)
 . I (ORDSTS=10!(ORDSTS=11)),DG'="O RX" S ERROR="Unreleased renewals may not be changed!" Q
"RTN","ORCACT01",107,0)
 . I PKG="PS",ORDSTS=5 S ERROR="Pending renewals may not be changed!" Q
"RTN","ORCACT01",108,0)
 I $$INACTIVE S ERROR="Orders for inactive orderables may not be changed; please enter a new order!" Q
"RTN","ORCACT01",109,0)
 I PKG="PS",'$$MEDOK S ERROR="This drug may not be ordered!" Q
"RTN","ORCACT01",110,0)
 I DG="O RX",$O(^OR(100,+IFN,4.5,"ID","MISC",0)) D DOSES^ORCACT02(+IFN) ;old form
"RTN","ORCACT01",111,0)
 Q
"RTN","ORCACT01",112,0)
 ;
"RTN","ORCACT01",113,0)
INACTIVE() ; -- Returns 1 or 0, if OI is now inactive
"RTN","ORCACT01",114,0)
 N I,OI,PREOI,PREOIX,X,Y,ORNOW,DD,PSOI S Y=0,ORNOW=$$NOW^XLFDT
"RTN","ORCACT01",115,0)
 S I=0 F  S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",I)) Q:I'>0  D  Q:Y
"RTN","ORCACT01",116,0)
 . S OI=+$G(^OR(100,+IFN,4.5,I,1))
"RTN","ORCACT01",117,0)
 . I OI S X=$G(^ORD(101.43,OI,.1)) I X,X<ORNOW S Y=1
"RTN","ORCACT01",118,0)
 I Y,PKG="PS",DG'="IV RX" D  ;replacement OI?
"RTN","ORCACT01",119,0)
 . S I=+$O(^OR(100,+IFN,4.5,"ID","DRUG",0)) Q:I'>0  ;first
"RTN","ORCACT01",120,0)
 . S DD=+$G(^OR(100,+IFN,4.5,I,1)) Q:DD'>0  Q:$G(OI)'>0
"RTN","ORCACT01",121,0)
 . S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2),X=$$ITEM^PSSUTIL1(PSOI,DD)
"RTN","ORCACT01",122,0)
 . Q:X'>0  S X=+$O(^ORD(101.43,"ID",+$P(X,U,2)_";99PSP",0)) Q:X'>0
"RTN","ORCACT01",123,0)
 . I $G(^ORD(101.43,X,.1)),$G(^(.1))<ORNOW Q  ;make sure new OI is active
"RTN","ORCACT01",124,0)
 . S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT01",125,0)
 . IF I D
"RTN","ORCACT01",126,0)
 . . S PREOI=$G(^OR(100,+IFN,4.5,I,1))
"RTN","ORCACT01",127,0)
 . . S PREOIX=$O(^OR(100,+IFN,.1,"B",PREOI,0))
"RTN","ORCACT01",128,0)
 . . K ^OR(100,+IFN,.1,"B",PREOI,PREOIX)
"RTN","ORCACT01",129,0)
 . . S ^OR(100,+IFN,.1,"B",X,PREOIX)=""
"RTN","ORCACT01",130,0)
 . . S ^OR(100,+IFN,.1,PREOIX,0)=X
"RTN","ORCACT01",131,0)
 . . S ^OR(100,+IFN,4.5,I,1)=X
"RTN","ORCACT01",132,0)
 . . S Y=0 ;reset
"RTN","ORCACT01",133,0)
 Q Y
"RTN","ORCACT01",134,0)
 ;
"RTN","ORCACT01",135,0)
MEDOK() ; -- Returns 1 or 0, if med OI usage=Y
"RTN","ORCACT01",136,0)
 N Y,OI,ORPS,X S Y=1,X=$P(OR0,U,12)
"RTN","ORCACT01",137,0)
 I (DG="SPLY")!(DG="O RX")!(DG="I RX")!(DG="UD RX") D
"RTN","ORCACT01",138,0)
 . S OI=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT01",139,0)
 . S OI=+$G(^OR(100,+IFN,4.5,OI,1))
"RTN","ORCACT01",140,0)
 . S ORPS=$G(^ORD(101.43,OI,"PS"))
"RTN","ORCACT01",141,0)
 I DG="SPLY",'$P(ORPS,U,5) S Y=0
"RTN","ORCACT01",142,0)
 I DG="O RX",'(X="O"&$P(ORPS,U,2)),'(X="I"&($P(ORPS,U)=2)) S Y=0
"RTN","ORCACT01",143,0)
 I DG="I RX"!(DG="UD RX"),'$P(ORPS,U) S Y=0
"RTN","ORCACT01",144,0)
 I DG="IV RX" D
"RTN","ORCACT01",145,0)
 . N I,X0,X1 S I=0
"RTN","ORCACT01",146,0)
 . F  S I=+$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",I)) Q:I<1  D  Q:Y<1
"RTN","ORCACT01",147,0)
 .. S X0=$G(^OR(100,+IFN,4.5,I,0)),X1=+$G(^(1))
"RTN","ORCACT01",148,0)
 .. I $P($G(^ORD(101.41,+$P(X0,U,2),0)),U)["ADDITIVE" S:'$P($G(^ORD(101.43,X1,"PS")),U,4) Y=0 Q
"RTN","ORCACT01",149,0)
 .. S:'$P($G(^ORD(101.43,X1,"PS")),U,3) Y=0
"RTN","ORCACT01",150,0)
 Q Y
"RTN","ORCACT01",151,0)
 ;
"RTN","ORCACT01",152,0)
IV() ; -- IV order, either Inpt or Fluid?
"RTN","ORCACT01",153,0)
 I DG="IV RX" Q 1
"RTN","ORCACT01",154,0)
 N I,OI,X S I=+$O(^OR(100,IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT01",155,0)
 S OI=+$G(^OR(100,IFN,4.5,+I,1)),X=$P($G(^ORD(101.43,+OI,"PS")),U)
"RTN","ORCACT01",156,0)
 Q (X>1)
"RTN","ORCACT01",157,0)
 ;
"RTN","ORCACT01",158,0)
NTBG(ORIFN) ; -- Inpt order marked as 'Not to be Given'?
"RTN","ORCACT01",159,0)
 N PSIFN,Y,ORI,ORCH S Y=""
"RTN","ORCACT01",160,0)
 S PSIFN=$G(^OR(100,+ORIFN,4)) I PSIFN>0 Q $$ENNG^PSJORUT2(+ORVP,PSIFN)
"RTN","ORCACT01",161,0)
 S ORI=0 F  S ORI=$O(^OR(100,+ORIFN,2,ORI)) Q:ORI'>0  S ORCH=+$G(^(ORI,0)),PSIFN=$G(^OR(100,ORCH,4)) I PSIFN>0 S Y=$$ENNG^PSJORUT2(+ORVP,PSIFN) Q:Y
"RTN","ORCACT01",162,0)
 Q Y
"RTN","ORCACT01",163,0)
 ;
"RTN","ORCACT01",164,0)
RESET(IFN,NEWOI)   ; -- Update OI if changed before renewing
"RTN","ORCACT01",165,0)
 Q:'$G(IFN)  Q:'$D(^OR(100,+IFN,0))  Q:'$G(NEWOI)
"RTN","ORCACT01",166,0)
 N I,ORIT S ORIT=+$O(^ORD(101.43,"ID",NEWOI_";99PSP",0)) Q:ORIT'>0
"RTN","ORCACT01",167,0)
 S I=$O(^OR(100,+IFN,4.5,"ID","ORDERABLE",0))
"RTN","ORCACT01",168,0)
 S:I ^OR(100,+IFN,4.5,I,1)=ORIT
"RTN","ORCACT01",169,0)
 Q
"RTN","ORMPS")
0^1^B74518847
"RTN","ORMPS",1,0)
ORMPS ; SLC/MKB - Process Pharmacy ORM msgs ;12/3/03  10:32
"RTN","ORMPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,54,62,86,92,94,116,138,152,141,165,149,213**;Dec 17, 1997
"RTN","ORMPS",3,0)
 ;
"RTN","ORMPS",4,0)
EN ; -- entry point for PS messages
"RTN","ORMPS",5,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMPS",6,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZC",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMPS",7,0)
 N ORSTS,RXE,ZRX,ORWHO,ORNOW
"RTN","ORMPS",8,0)
 S ORSTS=$$STATUS(ORDSTS),RXE=$$RXE,ZRX=$$ZRX D QT^ORMPS1 ;QT in RXE
"RTN","ORMPS",9,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORWHO=+$P(ZRX,"|",6) S:'ORWHO ORWHO=DUZ
"RTN","ORMPS",10,0)
 S:ORLOG ORLOG=+$E(ORLOG,1,12) ;no seconds
"RTN","ORMPS",11,0)
 S:'$L(ORNATR) ORNATR=$P(ZRX,"|",3) S:OREASON["^" OREASON=$P(OREASON,U,5)
"RTN","ORMPS",12,0)
 I ORNATR="D",'$L(OREASON) S OREASON="DUPLICATE"
"RTN","ORMPS",13,0)
 D @ORDCNTRL
"RTN","ORMPS",14,0)
 Q
"RTN","ORMPS",15,0)
 ;
"RTN","ORMPS",16,0)
ZV ; -- Verified
"RTN","ORMPS",17,0)
 N ORUSR,ORVER,ORDA,ORES,ORI
"RTN","ORMPS",18,0)
 S ORUSR=+$P(ORC,"|",12),ORVER="N" Q:'ORUSR
"RTN","ORMPS",19,0)
 S ORDA=+$P($G(^OR(100,+ORIFN,3)),U,7),ORES(+ORIFN_";"_ORDA)=""
"RTN","ORMPS",20,0)
 Q:$P($G(^OR(100,+ORIFN,8,ORDA,0)),U,8)  ;already verified
"RTN","ORMPS",21,0)
 D REPLCD^ORCACT1 ;get unverified replaced orders
"RTN","ORMPS",22,0)
 S ORI="" F  S ORI=$O(ORES(ORI)) Q:ORI=""  D
"RTN","ORMPS",23,0)
 . S ORDA=+$P(ORI,";",2)
"RTN","ORMPS",24,0)
 . D VERIFY^ORCSAVE2(+ORI,ORDA,"N",ORUSR,ORLOG)
"RTN","ORMPS",25,0)
 Q
"RTN","ORMPS",26,0)
 ;
"RTN","ORMPS",27,0)
ZP ; -- Purged
"RTN","ORMPS",28,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMPS",29,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^15^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ;Remove pkg reference, sts=lapsed if still active
"RTN","ORMPS",30,0)
 Q
"RTN","ORMPS",31,0)
 ;
"RTN","ORMPS",32,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMPS",33,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMPS",34,0)
 Q
"RTN","ORMPS",35,0)
 ;
"RTN","ORMPS",36,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMPS",37,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ;update Last Activity
"RTN","ORMPS",38,0)
 Q
"RTN","ORMPS",39,0)
 ;
"RTN","ORMPS",40,0)
XR ; -- Changed as requested [ack]
"RTN","ORMPS",41,0)
 N ORIG S ORIG=$P(^OR(100,+ORIFN,3),U,5) I ORIG,$P(^OR(100,ORIG,3),U,3)'=12 D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORMPS",42,0)
OK ; -- Order accepted, PS order # assigned [ack]
"RTN","ORMPS",43,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ;PS identifier
"RTN","ORMPS",44,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",45,0)
 Q
"RTN","ORMPS",46,0)
 ;
"RTN","ORMPS",47,0)
ZC ; -- Convert existing 2.5 orders to 3.0 format
"RTN","ORMPS",48,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT
"RTN","ORMPS",49,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",50,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",51,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",52,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J)
"RTN","ORMPS",53,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1")
"RTN","ORMPS",54,0)
ZC1 ; continue ... save responses, post reply
"RTN","ORMPS",55,0)
 Q:$D(ORERR)  I 'ORIFN!('$D(^OR(100,+ORIFN,0))) D  Q  ;create
"RTN","ORMPS",56,0)
 . K ORIFN D SN1 Q:'$G(ORIFN)  S ORDCNTRL="SN"
"RTN","ORMPS",57,0)
 . I ORSTOP,ORSTOP<ORNOW S $P(^OR(100,ORIFN,3),U)=ORSTOP
"RTN","ORMPS",58,0)
 S ORIFN=+ORIFN D RESPONSE^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",59,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(0),U,5)=+ORDIALOG_";ORD(101.41,"
"RTN","ORMPS",60,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP),STATUS^ORCSAVE2(ORIFN,ORSTS):ORSTS
"RTN","ORMPS",61,0)
 Q
"RTN","ORMPS",62,0)
 ;
"RTN","ORMPS",63,0)
SN ; -- New backdoor order, return OE# via NA msg
"RTN","ORMPS",64,0)
 I $$FINISHED^ORMPS2 D RO^ORMPS2 Q  ;change action instead
"RTN","ORMPS",65,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT,ZSC
"RTN","ORMPS",66,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",67,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",68,0)
 ; I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMPS",69,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",70,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J),ORIFN
"RTN","ORMPS",71,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS",72,0)
SN1 ; continue ... save order, post messsage
"RTN","ORMPS",73,0)
 D EN^ORCSAVE I '$G(ORIFN) S ORERR="Cannot create new order" G SNQ
"RTN","ORMPS",74,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4) I ORIG D  ;set fwd/bwd ptrs
"RTN","ORMPS",75,0)
 . S TYPE=$S(TYPE="R":2,1:1) Q:'$D(^OR(100,ORIG,0))
"RTN","ORMPS",76,0)
 . S $P(^OR(100,ORIFN,3),U,5)=ORIG,$P(^(3),U,11)=TYPE
"RTN","ORMPS",77,0)
 . S $P(^OR(100,ORIG,3),U,6)=ORIFN,EVNT=$P(^(0),U,17)
"RTN","ORMPS",78,0)
 . I $L(EVNT),TYPE=1 S $P(^OR(100,ORIFN,0),U,17)=EVNT
"RTN","ORMPS",79,0)
 . I TYPE=2,$G(ORCAT)="I" S ORSTRT=ORLOG D PARENT^ORMPS3 ;ck if complex
"RTN","ORMPS",80,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",81,0)
SN2 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",82,0)
 D:ORSTS STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMPS",83,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR)
"RTN","ORMPS",84,0)
 ; if unsigned edit, leave ORIFN unsigned & mark ORIG as Sig Not Req'd
"RTN","ORMPS",85,0)
 S ORSIG=$S('ORIG:1,TYPE'=1:1,$P($G(^OR(100,ORIG,8,1,0)),U,4)'=2:1,1:0)
"RTN","ORMPS",86,0)
 D SIGSTS^ORCSAVE2(ORIFN,1):ORSIG,SIGN^ORCSAVE2(ORIG,,,5,1):'ORSIG
"RTN","ORMPS",87,0)
 I ORDCNTRL="SN" D  ;print
"RTN","ORMPS",88,0)
 . S:ORNATR="" $P(^OR(100,ORIFN,8,1,0),U,12)="" ;CHCS/OP orders
"RTN","ORMPS",89,0)
 . S ORP(1)=ORIFN_";1"_$S(ORNATR="":"^^^^1",$G(ORL):"^1",1:"")
"RTN","ORMPS",90,0)
 . I ORP(1)["^" D PRINTS^ORWD1(.ORP,+$G(ORL))
"RTN","ORMPS",91,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMPS",92,0)
SNQ K ^TMP("ORWORD",$J)
"RTN","ORMPS",93,0)
 Q
"RTN","ORMPS",94,0)
 ;
"RTN","ORMPS",95,0)
XX ; -- Changed (new order not necessary)
"RTN","ORMPS",96,0)
 Q:$P($G(^OR(100,+ORIFN,3)),U,3)=5  ;pending - update when finished
"RTN","ORMPS",97,0)
 I '$$CHANGED^ORMPS2 D SC Q  ;ck sts/dates only
"RTN","ORMPS",98,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS",99,0)
 S:ORNATR="" ORNATR="S" D RO^ORMPS2
"RTN","ORMPS",100,0)
 Q
"RTN","ORMPS",101,0)
 ;
"RTN","ORMPS",102,0)
SC ; -- Status changed (verified, expired, suspended, renewed, reinstate)
"RTN","ORMPS",103,0)
 N OR0,OR3,ZSC,DONE S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORMPS",104,0)
 I $P(OR3,U,3)=5,ORSTS=6 D  Q:$G(DONE)
"RTN","ORMPS",105,0)
 . I $$CHANGED^ORMPS2 S ORNATR="S" D RO^ORMPS2 S DONE=1 Q
"RTN","ORMPS",106,0)
 . I $P(ZRX,"|",7)="TPN",+$P(OR0,U,11)'=$O(^ORD(100.98,"B","TPN",0)) D
"RTN","ORMPS",107,0)
 .. N DA,DR,DIE,ORDG S ORDG=+$O(^ORD(100.98,"B","TPN",0))
"RTN","ORMPS",108,0)
 .. S DA=+ORIFN,DR="23////"_ORDG,DIE="^OR(100," D ^DIE
"RTN","ORMPS",109,0)
 . I $P(OR3,U,11)=2,$P(OR0,U,12)="I" S ORSTRT=+$P($G(^OR(100,+ORIFN,8,1,0)),U,16) ;use Release Date for inpt renewals
"RTN","ORMPS",110,0)
 I $P(OR0,U,12)="I",$P(ZRX,"|",4)="R",+$P(ZRX,"|",2)=+ORIFN S ORSTRT=$P(OR0,U,8) ;keep orig start when renewed
"RTN","ORMPS",111,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",112,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",113,0)
 I ORSTS=$P(OR3,U,3),ORSTOP'=$P(OR0,U,9) D SETALL^ORDD100(+ORIFN) ;AC xrf
"RTN","ORMPS",114,0)
 S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",115,0)
 I "^1^13^"[(U_$P(OR3,U,3)_U),"^3^5^6^15^"[(U_ORSTS_U) D  ;reinstated
"RTN","ORMPS",116,0)
 . I $P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="DC" S ^(2)=ORNOW_U_ORWHO ; When^Who reinstated order
"RTN","ORMPS",117,0)
 . S I="?" F  S I=$O(^OR(100,+ORIFN,8,I),-1) Q:'+I  I $P(^(I,0),U,15)="" S $P(^OR(100,+ORIFN,3),U,7)=I Q  ;138 Finds current action
"RTN","ORMPS",118,0)
 . K ^OR(100,+ORIFN,6) D SETALL^ORDD100(+ORIFN)
"RTN","ORMPS",119,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,+ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",120,0)
 Q
"RTN","ORMPS",121,0)
 ;
"RTN","ORMPS",122,0)
STATUS(X) ; -- Returns order status from HL7 code
"RTN","ORMPS",123,0)
 N Y S Y=$S(X="IP":5,X="CM":6,X="DC":1,X="ZE":7,X="HD":3,X="ZX":11,X="RP":12,X="ZZ":15,X="ZS":6,X="ZU":6,1:"")
"RTN","ORMPS",124,0)
 Q Y
"RTN","ORMPS",125,0)
 ;
"RTN","ORMPS",126,0)
DE ; -- Data Errors in SS msg
"RTN","ORMPS",127,0)
 Q
"RTN","ORMPS",128,0)
 ;
"RTN","ORMPS",129,0)
UA ; -- Unable to accept [ack]
"RTN","ORMPS",130,0)
UX ; -- Unable to change [ack]
"RTN","ORMPS",131,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMPS",132,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORNOW_U_U_OREASON
"RTN","ORMPS",133,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr if pending renewal
"RTN","ORMPS",134,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMPS",135,0)
UC ; -- Unable to cancel [ack]
"RTN","ORMPS",136,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMPS",137,0)
UH ; -- Unable to hold [ack]
"RTN","ORMPS",138,0)
UR ; -- Unable to release hold [ack]
"RTN","ORMPS",139,0)
 N ORDA S ORDA=+$P(ORIFN,";",2) I ORDA D
"RTN","ORMPS",140,0)
 . S $P(^OR(100,+ORIFN,8,ORDA,0),U,15)=13 ;request rejected
"RTN","ORMPS",141,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,ORDA,1)=OREASON
"RTN","ORMPS",142,0)
 Q
"RTN","ORMPS",143,0)
 ;
"RTN","ORMPS",144,0)
OC ; -- Cancelled (prior to pharmacist's verification)
"RTN","ORMPS",145,0)
 G:ORTYPE="ORR" UA S:ORNATR="A" ORWHO=""
"RTN","ORMPS",146,0)
 S:'ORSTS ORSTS=13 S:ORSTS=12 ORNATR="S"
"RTN","ORMPS",147,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",148,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr when pending renewal cancelled
"RTN","ORMPS",149,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",150,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",151,0)
 Q
"RTN","ORMPS",152,0)
 ;
"RTN","ORMPS",153,0)
CR ; -- Cancelled [ack]
"RTN","ORMPS",154,0)
 D STATUS^ORCSAVE2(+ORIFN,13) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",155,0)
 Q
"RTN","ORMPS",156,0)
 ;
"RTN","ORMPS",157,0)
OD ; -- Discontinued (cancelled after pharmacist's verification)
"RTN","ORMPS",158,0)
 S:'ORSTS ORSTS=1 S:ORSTS=12 ORNATR="C"
"RTN","ORMPS",159,0)
 I ORNATR="A" S ORWHO="" I $G(DGPMT)=3,$$MVT^DGPMOBS(DGPMDA) D XTMP^ORMEVNT ;save order#
"RTN","ORMPS",160,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",161,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",162,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",163,0)
 Q
"RTN","ORMPS",164,0)
 ;
"RTN","ORMPS",165,0)
DR ; -- Discontinued [ack]
"RTN","ORMPS",166,0)
 D STATUS^ORCSAVE2(+ORIFN,1) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",167,0)
 Q
"RTN","ORMPS",168,0)
 ;
"RTN","ORMPS",169,0)
OH ; -- Held
"RTN","ORMPS",170,0)
 S:'ORSTS ORSTS=3 D UPDATE(ORSTS,"HD")
"RTN","ORMPS",171,0)
 Q
"RTN","ORMPS",172,0)
 ;
"RTN","ORMPS",173,0)
HR ; -- Held [ack]
"RTN","ORMPS",174,0)
 D STATUS^ORCSAVE2(+ORIFN,3)
"RTN","ORMPS",175,0)
 Q
"RTN","ORMPS",176,0)
 ;
"RTN","ORMPS",177,0)
RL ; -- Released hold
"RTN","ORMPS",178,0)
OE ; -- Released hold
"RTN","ORMPS",179,0)
 N ORDA S ORDA=+$P(^OR(100,+ORIFN,3),U,7)
"RTN","ORMPS",180,0)
 I $P($G(^OR(100,+ORIFN,8,ORDA,0)),U,2)="HD" S $P(^(2),U,1,2)=ORNOW_U_ORWHO
"RTN","ORMPS",181,0)
 S:'$G(ORSTS) ORSTS=6 D UPDATE(ORSTS,"RL")
"RTN","ORMPS",182,0)
 Q
"RTN","ORMPS",183,0)
 ;
"RTN","ORMPS",184,0)
OR ; -- Released / [ack]
"RTN","ORMPS",185,0)
 S:'ORSTS ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",186,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",187,0)
 Q
"RTN","ORMPS",188,0)
 ;
"RTN","ORMPS",189,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMPS",190,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",191,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",192,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMPS",193,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORNOW,ORWHO)
"RTN","ORMPS",194,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS",195,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS",196,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMPS",197,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS",198,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMPS",199,0)
 I 'ORX,ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMPS",200,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMPS",201,0)
 Q
"RTN","ORMPS",202,0)
 ;
"RTN","ORMPS",203,0)
RXO() ; -- Return subscript of RXO segment
"RTN","ORMPS",204,0)
 N I,X S X="",I=$O(@ORMSG@(+ORC))
"RTN","ORMPS",205,0)
 I I,$E(@ORMSG@(I),1,3)="RXO" S X=I_U_@ORMSG@(I)
"RTN","ORMPS",206,0)
 Q X
"RTN","ORMPS",207,0)
 ;
"RTN","ORMPS",208,0)
RXE() ; -- Return subscript of RXE segment
"RTN","ORMPS",209,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",210,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXE" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",211,0)
 Q X
"RTN","ORMPS",212,0)
 ;
"RTN","ORMPS",213,0)
RXR() ; -- Return subscript of RXR segment
"RTN","ORMPS",214,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",215,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXR" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",216,0)
 Q X
"RTN","ORMPS",217,0)
 ;
"RTN","ORMPS",218,0)
RXC() ; -- Return subscript of [first] RXC segment
"RTN","ORMPS",219,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",220,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXC" S X=I Q
"RTN","ORMPS",221,0)
 Q X
"RTN","ORMPS",222,0)
 ;
"RTN","ORMPS",223,0)
ZRX() ; -- Return subscript of ZRX segment
"RTN","ORMPS",224,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",225,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZRX" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",226,0)
 Q X
"RTN","ORMPS3")
0^2^B6681495
"RTN","ORMPS3",1,0)
ORMPS3 ;SLC/MKB - Process Pharmacy ORM msgs cont ;12/3/03  10:32
"RTN","ORMPS3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**213**;Dec 17, 1997
"RTN","ORMPS3",3,0)
 ;
"RTN","ORMPS3",4,0)
PTR(X) ; -- Return ptr to prompt OR GTX X
"RTN","ORMPS3",5,0)
 Q +$O(^ORD(101.41,"AB","OR GTX "_X,0))
"RTN","ORMPS3",6,0)
 ;
"RTN","ORMPS3",7,0)
PARENT ; -- create parent order for backdoor complex renewals
"RTN","ORMPS3",8,0)
 ;    Expects ORIFN, ORIG, ORDIALOG()
"RTN","ORMPS3",9,0)
 ;Q:'$$PATCH^XPDUTL("PSJ*5.0*110")
"RTN","ORMPS3",10,0)
 N ORIGDAD,ORIFNDAD,HDR S ORIGDAD=$P($G(^OR(100,ORIG,3)),U,9)
"RTN","ORMPS3",11,0)
 Q:ORIGDAD<1  Q:$$DOSES^ORCACT4(ORIGDAD)'>1  ;cont if complex
"RTN","ORMPS3",12,0)
 S ORIFNDAD=$P($G(^OR(100,ORIGDAD,3)),U,6) I ORIFNDAD<1 D  G P1
"RTN","ORMPS3",13,0)
 . N ORIFN D EN^ORCSAVE Q:ORIFN<1
"RTN","ORMPS3",14,0)
 . S $P(^OR(100,ORIFN,3),U,5)=ORIGDAD,$P(^(3),U,8)=1,$P(^(3),U,11)=2
"RTN","ORMPS3",15,0)
 . S $P(^OR(100,ORIGDAD,3),U,6)=ORIFN,ORIFNDAD=ORIFN
"RTN","ORMPS3",16,0)
 . D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR)
"RTN","ORMPS3",17,0)
 . D SIGSTS^ORCSAVE2(ORIFN,1),DATES^ORCSAVE2(ORIFN,ORSTRT)
"RTN","ORMPS3",18,0)
 . I $P(^OR(100,ORIFN,8,1,0),U,4)=2 S $P(^(0),U,4)="" K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;sign children instead
"RTN","ORMPS3",19,0)
 . ;STATUS updated in SN2^ORMPS from child orders
"RTN","ORMPS3",20,0)
P0 ; -- just add conjunction, new dose if DAD already exists
"RTN","ORMPS3",21,0)
 N INST,DA,PTR,ID,P,I,J,X
"RTN","ORMPS3",22,0)
 S INST=$$DOSES^ORCACT4(ORIFNDAD),DA=$O(^OR(100,ORIFNDAD,4.5,"A"),-1)
"RTN","ORMPS3",23,0)
 S PTR=$$PTR("AND/THEN"),ID="CONJ",DA=DA+1
"RTN","ORMPS3",24,0)
 S ^OR(100,ORIFNDAD,4.5,DA,0)=U_PTR_U_INST_U_ID,^(1)="A"
"RTN","ORMPS3",25,0)
 S ^OR(100,ORIFNDAD,4.5,"ID","CONJ",DA)="",INST=INST+1
"RTN","ORMPS3",26,0)
 F P="INSTRUCTIONS","ROUTE","SCHEDULE","DURATION","DOSE","DISPENSE DRUG" D
"RTN","ORMPS3",27,0)
 . S PTR=$$PTR(P) Q:'$L($G(ORDIALOG(PTR,1)))
"RTN","ORMPS3",28,0)
 . S DA=DA+1,ID=$P($G(^ORD(101.41,PTR,1)),U,3)
"RTN","ORMPS3",29,0)
 . S ^OR(100,ORIFNDAD,4.5,DA,0)=U_PTR_U_INST_U_ID,^(1)=ORDIALOG(PTR,1)
"RTN","ORMPS3",30,0)
 . S ^OR(100,ORIFNDAD,4.5,"ID",ID,DA)=""
"RTN","ORMPS3",31,0)
 S $P(^OR(100,ORIFNDAD,4.5,0),U,3,4)=DA_U_DA
"RTN","ORMPS3",32,0)
 S P=$$PTR("SIG"),DA=+$O(^OR(100,ORIFNDAD,4.5,"ID","SIG",0))
"RTN","ORMPS3",33,0)
 S I=+$O(^OR(100,ORIFNDAD,4.5,DA,2,""),-1),X=$G(^(I,0)) S:$L(X) X=X_" AND",^(0)=X
"RTN","ORMPS3",34,0)
 S J=0 F  S J=$O(^TMP("ORWORD",$J,PTR,1,J)) Q:J<1  S I=I+1,^OR(100,ORIFNDAD,4.5,DA,2,I,0)=^TMP("ORWORD",$J,PTR,1,J,0)
"RTN","ORMPS3",35,0)
 S $P(^OR(100,ORIFNDAD,4.5,DA,2,0),U,3,4)=I_U_I
"RTN","ORMPS3",36,0)
 ; -- rebuild order text w/new SIG
"RTN","ORMPS3",37,0)
 K ^TMP("ORWORD",$J,PTR) M ^TMP("ORWORD",$J,PTR,1)=^OR(100,ORIFNDAD,4.5,DA,2)
"RTN","ORMPS3",38,0)
 K ^OR(100,ORIFNDAD,8,1,.1) D ORDTEXT^ORCSAVE1(ORIFNDAD_";1")
"RTN","ORMPS3",39,0)
P1 ; -- set up links
"RTN","ORMPS3",40,0)
 S $P(^OR(100,ORIFN,3),U,9)=ORIFNDAD
"RTN","ORMPS3",41,0)
 S HDR=$G(^OR(100,ORIFNDAD,2,0)),^(0)="^100.002PA^"_ORIFN_U_($P(HDR,U,4)+1),^(ORIFN,0)=ORIFN
"RTN","ORMPS3",42,0)
 Q
"RTN","ORQ2")
0^3^B36745923
"RTN","ORQ2",1,0)
ORQ2 ; SLC/MKB - Detailed Order Report ;12/3/03  10:32
"RTN","ORQ2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,56,75,94,141,213**;Dec 17, 1997
"RTN","ORQ2",3,0)
DETAIL(ORY,ORIFN) ; -- Returns details of order ORIFN in ORY(#)
"RTN","ORQ2",4,0)
 N X,X2,I,CNT,ORDIALOG,OR0,OR3,OR6,SEQ,ITEM,PRMT,MULT,FIRST,TITLE,INST,DIWL,DIWR,DIWF,ACTION,VAIN,ORIGVIEW,ORNMSP,ORYT
"RTN","ORQ2",5,0)
 S CNT=0,ORIFN=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6))
"RTN","ORQ2",6,0)
 K @ORY,ORYT S ORIGVIEW=1 D TEXT^ORQ12(.ORYT,+ORIFN_";"_+$P(OR3,U,7),80) ;CurrTx
"RTN","ORQ2",7,0)
 M @ORY=ORYT ;Move text to global
"RTN","ORQ2",8,0)
 S I=0 F CNT=1:1 S I=$O(ORYT(I)) Q:I'>0  D:$D(IORVON) SETVIDEO(I,1,$L(ORYT(I)),IORVON,IORVOFF)
"RTN","ORQ2",9,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",10,0)
D1 I $O(^OR(100,+ORIFN,2,0)) D
"RTN","ORQ2",11,0)
 . S CNT=CNT+1,@ORY@(CNT)="Sub Orders:"
"RTN","ORQ2",12,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,11,IOUON,IOUOFF)
"RTN","ORQ2",13,0)
 . N IFN S IFN=0
"RTN","ORQ2",14,0)
 . F  S IFN=+$O(^OR(100,+ORIFN,2,IFN)) Q:IFN<1  I $D(^OR(100,IFN,0)) D SUB(IFN)
"RTN","ORQ2",15,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",16,0)
 I $P(OR3,U,9),$D(^OR(100,+$P(OR3,U,9),0)) D
"RTN","ORQ2",17,0)
 . S CNT=CNT+1,@ORY@(CNT)="Parent Order:"
"RTN","ORQ2",18,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,12,IOUON,IOUOFF)
"RTN","ORQ2",19,0)
 . D SUB(+$P(OR3,U,9))
"RTN","ORQ2",20,0)
 . S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",21,0)
 I $P(OR3,U,11)=1,$P(OR3,U,5) D  ;Changed - show previous order
"RTN","ORQ2",22,0)
 . S CNT=CNT+1,@ORY@(CNT)="Previous Order:"
"RTN","ORQ2",23,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,15,IOUON,IOUOFF) ;prev order original text
"RTN","ORQ2",24,0)
 . N ORZ,I,ORIGVIEW S ORIGVIEW=2 D TEXT^ORQ12(.ORZ,+$P(OR3,U,5),55)
"RTN","ORQ2",25,0)
 . S CNT=CNT+1,@ORY@(CNT)="     Order Text:        "_$G(ORZ(1))
"RTN","ORQ2",26,0)
 . S I=1 F  S I=$O(ORZ(I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$$REPEAT^XLFSTR(" ",24)_$G(ORZ(I))
"RTN","ORQ2",27,0)
D2 S CNT=CNT+1,@ORY@(CNT)="Activity:"
"RTN","ORQ2",28,0)
 D:$D(IOUON) SETVIDEO(CNT,1,9,IOUON,IOUOFF)
"RTN","ORQ2",29,0)
 S DIWL=1,DIWR=64,DIWF="C64",ORI=0 K ^UTILITY($J,"W")
"RTN","ORQ2",30,0)
 F  S ORI=$O(^OR(100,ORIFN,8,ORI)) Q:ORI'>0  S ACTION=$G(^(ORI,0)) D ACT^ORQ20
"RTN","ORQ2",31,0)
 I "^1^12^13^"[(U_$P(OR3,U,3)_U),$L(OR6),$P(ACTION,U,2)'="DC" D DC^ORQ20
"RTN","ORQ2",32,0)
 I $P(OR3,U,3)=2,$P(OR6,U,6) S CNT=CNT+1,@ORY@(CNT)=$$DATE^ORQ20($P(OR6,U,6))_"  Completed"_$S($P(OR6,U,7):" by "_$$USER^ORQ20($P(OR6,U,7)),1:"")
"RTN","ORQ2",33,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",34,0)
D3 S CNT=CNT+1,@ORY@(CNT)="Current Data:"
"RTN","ORQ2",35,0)
 D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",36,0)
 D VA I $G(VAIN(2)) S CNT=CNT+1,@ORY@(CNT)="Current Primary Provider:     "_$P(VAIN(2),"^",2)
"RTN","ORQ2",37,0)
 I $G(VAIN(11)) S CNT=CNT+1,@ORY@(CNT)="Current Attending Physician:  "_$P(VAIN(11),"^",2)
"RTN","ORQ2",38,0)
 S CNT=CNT+1,@ORY@(CNT)="Treating Specialty:           "_$P($G(^DIC(45.7,+$P(OR0,U,13),0)),U)
"RTN","ORQ2",39,0)
 S CNT=CNT+1,@ORY@(CNT)="Ordering Location:            "_$P($G(^SC(+$P(OR0,U,10),0)),U)
"RTN","ORQ2",40,0)
 S CNT=CNT+1,@ORY@(CNT)="Start Date/Time:              "_$S($P(OR0,U,8):$$DATE^ORQ20($P(OR0,U,8)),1:"")
"RTN","ORQ2",41,0)
 I $P(OR3,U,5),$P(OR3,U,11)=2 S X=$$ORIG(ORIFN),@ORY@(CNT)=@ORY@(CNT)_" (originally "_$$DATE^ORQ20(X)_")"
"RTN","ORQ2",42,0)
 S CNT=CNT+1,@ORY@(CNT)="Stop Date/Time:               "_$S($P(OR0,U,9):$$DATE^ORQ20($P(OR0,U,9)),1:"")
"RTN","ORQ2",43,0)
 S CNT=CNT+1,@ORY@(CNT)="Current Status:               "_$S($D(^ORD(100.01,+$P(OR3,U,3),0)):$P(^(0),"^"),1:"-")
"RTN","ORQ2",44,0)
 I $$GET^XPAR("ALL","ORPF SHOW STATUS DESCRIPTION",1,"I"),$P(OR3,U,3),$D(^ORD(100.01,$P(OR3,U,3),0)) N J S J=0 F  S J=$O(^ORD(100.01,$P(OR3,U,3),1,J)) Q:J<1  S CNT=CNT+1,@ORY@(CNT)="  "_^(J,0)
"RTN","ORQ2",45,0)
 S CNT=CNT+1,@ORY@(CNT)="Order #"_ORIFN
"RTN","ORQ2",46,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",47,0)
D4 S CNT=CNT+1,@ORY@(CNT)="Order:" D:$D(IOUON) SETVIDEO(CNT,1,6,IOUON,IOUOFF)
"RTN","ORQ2",48,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORQ2",49,0)
 I '$O(^OR(100,ORIFN,4.5,0)),ORNMSP="RA" D RAD^ORQ21("") Q
"RTN","ORQ2",50,0)
 S ORDIALOG=$P(OR0,U,5) Q:$P(ORDIALOG,";",2)="ORD(101,"  ; 2.5 order
"RTN","ORQ2",51,0)
 D GETDLG^ORCD(+ORDIALOG),GETORDER^ORCD(ORIFN)
"RTN","ORQ2",52,0)
 S DIWL=1,DIWR=50,DIWF="C50"
"RTN","ORQ2",53,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORQ2",54,0)
 . S ITEM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)) Q:$P(ITEM,U,11)  ; child
"RTN","ORQ2",55,0)
 . S PRMT=$P(ITEM,U,2),MULT=$P(ITEM,U,7) Q:$P(ITEM,U,9)["*"  ;hide
"RTN","ORQ2",56,0)
 . S FIRST=$O(ORDIALOG(PRMT,0)) Q:'FIRST  ; no values
"RTN","ORQ2",57,0)
 . S TITLE=$S(MULT&$L($G(ORDIALOG(PRMT,"TTL"))):ORDIALOG(PRMT,"TTL"),1:ORDIALOG(PRMT,"A"))
"RTN","ORQ2",58,0)
 . S TITLE=TITLE_$$REPEAT^XLFSTR(" ",30-$L(TITLE))
"RTN","ORQ2",59,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PRMT,INST)) Q:INST'>0  D
"RTN","ORQ2",60,0)
 . . I $E(ORDIALOG(PRMT,0))="W" D WP Q
"RTN","ORQ2",61,0)
 . . K ^UTILITY($J,"W") S X=$$EXT^ORCD(PRMT,INST) D ^DIWP
"RTN","ORQ2",62,0)
 . . D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PRMT)) CHILDREN(PRMT)
"RTN","ORQ2",63,0)
 . . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=$S((INST=FIRST)&(I=1):TITLE,1:$$REPEAT^XLFSTR(" ",30))_^(I,0)
"RTN","ORQ2",64,0)
 I ORNMSP="GMRC",$G(^OR(100,ORIFN,4)) S CNT=CNT+1,@ORY@(CNT)="Consult No.:                  "_+^(4)
"RTN","ORQ2",65,0)
 S CNT=CNT+1,@ORY@(CNT)="   " ;blank
"RTN","ORQ2",66,0)
 D RAD^ORQ21(1):ORNMSP="RA",MED^ORQ21:ORNMSP="PS" ;add'l data
"RTN","ORQ2",67,0)
D5 I $O(^OR(100,+ORIFN,9,0)) D
"RTN","ORQ2",68,0)
 . N CK,OK,X0,X,CDL,I S CNT=CNT+1,@ORY@(CNT)="Order Checks:"
"RTN","ORQ2",69,0)
 . D:$D(IOUON) SETVIDEO(CNT,1,13,IOUON,IOUOFF)
"RTN","ORQ2",70,0)
 . S CK=0 F  S CK=$O(^OR(100,+ORIFN,9,CK)) Q:CK'>0  S X0=$G(^(CK,0)),X=$G(^(1)) D
"RTN","ORQ2",71,0)
 .. S CDL=$$CDL($P(X0,U,2)) I $P(X0,U,6),'$D(OK) S OK=$P(X0,U,4,6)
"RTN","ORQ2",72,0)
 .. I $L(X)'>68 S CNT=CNT+1,@ORY@(CNT)=CDL_X Q
"RTN","ORQ2",73,0)
 .. S DIWL=1,DIWR=68,DIWF="C68" K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",74,0)
 .. S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)=CDL_^(I,0),CDL="            "
"RTN","ORQ2",75,0)
 . Q:'$L($G(OK))  S CNT=CNT+1,@ORY@(CNT)="Override:   "_$S($P(OK,U,2):$$USER^ORQ20($P(OK,U,2))_" on ",1:"")_$$DATE^ORQ20($P(OK,U,3))
"RTN","ORQ2",76,0)
 . I $L($P(OK,U))'>68 S CNT=CNT+1,@ORY@(CNT)="            "_$P(OK,U) Q
"RTN","ORQ2",77,0)
 . S DIWL=1,DIWR=68,DIWF="C68",X=$P(OK,U) K ^UTILITY($J,"W") D ^DIWP
"RTN","ORQ2",78,0)
 . S I=0 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:I'>0  S CNT=CNT+1,@ORY@(CNT)="            "_^(I,0)
"RTN","ORQ2",79,0)
 K ^TMP("ORWORD",$J),^UTILITY($J,"W")
"RTN","ORQ2",80,0)
 Q
"RTN","ORQ2",81,0)
 ;
"RTN","ORQ2",82,0)
SUB(IFN) ; -- add suborder or parent
"RTN","ORQ2",83,0)
 N ORCY,STS,STRT,IG D TEXT^ORQ12(.ORCY,IFN,58)
"RTN","ORQ2",84,0)
 S STS=$G(^ORD(100.01,+$P($G(^OR(100,IFN,3)),U,3),.1))
"RTN","ORQ2",85,0)
 S STRT=$P(^OR(100,IFN,0),U,8) S:STRT'="" STRT=$$DATE^ORQ20(STRT)
"RTN","ORQ2",86,0)
 S IG=0 F  S IG=$O(ORCY(IG)) Q:IG<1  S CNT=CNT+1,@ORY@(CNT)=$J(STS,4)_" "_ORCY(IG)_" "_STRT,(STS,STRT)=" "
"RTN","ORQ2",87,0)
 Q
"RTN","ORQ2",88,0)
 ;
"RTN","ORQ2",89,0)
WP ; -- add word-processing
"RTN","ORQ2",90,0)
 N WP,ORI,X M WP=@ORDIALOG(PRMT,INST)
"RTN","ORQ2",91,0)
 S CNT=CNT+1,@ORY@(CNT)=TITLE
"RTN","ORQ2",92,0)
 S ORI=0 F  S ORI=$O(WP(ORI)) Q:ORI'>0  S X=WP(ORI,0) S:X'="" CNT=CNT+1,@ORY@(CNT)="  "_X
"RTN","ORQ2",93,0)
 Q
"RTN","ORQ2",94,0)
 ;
"RTN","ORQ2",95,0)
CHILDREN(PARENT) ; -- add children
"RTN","ORQ2",96,0)
 N SEQ,DA,ITM,PRMT,TYPE,X
"RTN","ORQ2",97,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,SEQ)) Q:SEQ'>0  S DA=$O(^(SEQ,0)) D
"RTN","ORQ2",98,0)
 . S ITM=$G(^ORD(101.41,+ORDIALOG,10,DA,0)),PRMT=$P(ITM,U,2)
"RTN","ORQ2",99,0)
 . Q:$G(ORDIALOG(PRMT,INST))=""  Q:$P(ITM,U,9)["*"  ;no value or hide
"RTN","ORQ2",100,0)
 . S TYPE=$E(ORDIALOG(PRMT,0)) D:TYPE="W" WP
"RTN","ORQ2",101,0)
 . I TYPE'="W" S X=$$EXT^ORCD(PRMT,INST) D ^DIWP
"RTN","ORQ2",102,0)
 Q
"RTN","ORQ2",103,0)
 ;
"RTN","ORQ2",104,0)
SETVIDEO(LINE,COL,WIDTH,ON,OFF) ; -- set video attributes
"RTN","ORQ2",105,0)
 S ORY("VIDEO",LINE,COL,WIDTH)=ON
"RTN","ORQ2",106,0)
 S ORY("VIDEO",LINE,COL+WIDTH,0)=OFF
"RTN","ORQ2",107,0)
 Q
"RTN","ORQ2",108,0)
 ;
"RTN","ORQ2",109,0)
VA ; -- Call VADPT
"RTN","ORQ2",110,0)
 N ORY,DFN,Y S DFN=+$P(OR0,"^",2) D OERR^VADPT
"RTN","ORQ2",111,0)
 Q
"RTN","ORQ2",112,0)
 ;
"RTN","ORQ2",113,0)
CDL(X) ; -- Returns Clinical Danger Level X
"RTN","ORQ2",114,0)
 N Y S Y=$S(X=1:"HIGH:",X=2:"MODERATE:",X=3:"LOW:",1:"NONE:")
"RTN","ORQ2",115,0)
 S Y=$E(Y_"        ",1,12)
"RTN","ORQ2",116,0)
 Q Y
"RTN","ORQ2",117,0)
 ;
"RTN","ORQ2",118,0)
ORIG(IFN) ; -- Return original start date of [renewal] order
"RTN","ORQ2",119,0)
 N I,Y,X3,DONE
"RTN","ORQ2",120,0)
 S I=IFN,Y=$P($G(^OR(100,IFN,0)),U,8),DONE=0
"RTN","ORQ2",121,0)
 F  S X3=$G(^OR(100,I,3)) D  Q:DONE
"RTN","ORQ2",122,0)
 . I $P(X3,U,11)=2,$P(X3,U,5) S I=$P(X3,U,5) Q  ;loop
"RTN","ORQ2",123,0)
 . S Y=$P($G(^OR(100,I,0)),U,8),DONE=1
"RTN","ORQ2",124,0)
 Q Y
"RTN","ORWDXA")
0^5^B75626586
"RTN","ORWDXA",1,0)
ORWDXA ; SLC/KCM/JLI - Utilites for Order Actions ;5/6/04  14:50
"RTN","ORWDXA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,116,132,148,141,149,187,213**;Dec 17, 1997
"RTN","ORWDXA",3,0)
 ;
"RTN","ORWDXA",4,0)
VALID(VAL,ORID,ACTION,ORNP,ORWNAT) ; Return error message if not valid action for order
"RTN","ORWDXA",5,0)
 N ORACT,ORVP,ORVER,ORIFN,PRTID S VAL="",PRTID=0
"RTN","ORWDXA",6,0)
 I +ORID=0 S VAL="This order has been deleted." Q
"RTN","ORWDXA",7,0)
 I '$D(^OR(100,+ORID,0)) S VAL="This order has been deleted!" Q
"RTN","ORWDXA",8,0)
 I ACTION="XFR",'$L($T(XFR^ORCACT01)) S ACTION="RW" ; for pre-POE
"RTN","ORWDXA",9,0)
 S ORIFN=ORID,ORVP=$P(^OR(100,+ORID,0),U,2)  ; ORCACT0 expects defined
"RTN","ORWDXA",10,0)
 I (ACTION="RN") D  Q:$L(VAL)  ; ** There's got to be a better way!
"RTN","ORWDXA",11,0)
 . N DLG S DLG=$P(^OR(100,+ORID,0),U,5) Q:DLG'[";ORD(101.41,"
"RTN","ORWDXA",12,0)
 . I $G(^ORD(101.41,+DLG,3))'["PROVIDER^ORCDPSIV" Q
"RTN","ORWDXA",13,0)
 . D AUTH^ORWDPS32(.VAL,ORNP)
"RTN","ORWDXA",14,0)
 . I VAL S VAL=$P(VAL,U,2)
"RTN","ORWDXA",15,0)
 . E  S VAL=""
"RTN","ORWDXA",16,0)
 S ORVER=$S(ACTION="CR":"R",$D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:"^")
"RTN","ORWDXA",17,0)
 I ACTION="CR" S ACTION="VR"
"RTN","ORWDXA",18,0)
 I (ACTION="ES")!(ACTION="OC")!(ACTION="RS") S ORACT=ACTION ; why not defined???
"RTN","ORWDXA",19,0)
 I (ACTION="VR"),'($D(^XUSEC("ORELSE",DUZ))!$D(^XUSEC("OREMAS",DUZ))) D  Q
"RTN","ORWDXA",20,0)
 . S VAL="You are not authorized to verify these orders."
"RTN","ORWDXA",21,0)
 I $L(VAL) Q
"RTN","ORWDXA",22,0)
 N OIIEN,ISIV,IVOD
"RTN","ORWDXA",23,0)
 S (ISIV,OIIEN,IVOD)=0
"RTN","ORWDXA",24,0)
 I (ACTION="RW")!(ACTION="XX")!(ACTION="XFR") D  Q:$L(VAL)
"RTN","ORWDXA",25,0)
 . S ISIV=$P(^OR(100,+ORID,0),U,11)
"RTN","ORWDXA",26,0)
 . I ISIV,($P(^ORD(100.98,ISIV,0),U,3)="IV RX") S IVOD=1
"RTN","ORWDXA",27,0)
 . D:'IVOD GTORITM^ORWDXR(.OIIEN,+ORID)
"RTN","ORWDXA",28,0)
 . D:OIIEN ISACTOI(.VAL,OIIEN) I $L(VAL)>0 Q
"RTN","ORWDXA",29,0)
 . N DLG,FRM
"RTN","ORWDXA",30,0)
 . S DLG=$P(^OR(100,+ORID,0),U,5),FRM=0
"RTN","ORWDXA",31,0)
 . I $P(DLG,";",2)'="ORD(101.41," S DLG=0
"RTN","ORWDXA",32,0)
 . I DLG D FORMID^ORWDXM(.FRM,+DLG)
"RTN","ORWDXA",33,0)
 . I '(DLG&FRM) D
"RTN","ORWDXA",34,0)
 . . S VAL="Copy & Change are not implemented for this order that predates CPRS."
"RTN","ORWDXA",35,0)
 N OREBUILD  ; sometimes left defined by $$VALID
"RTN","ORWDXA",36,0)
 I $$VALID^ORCACT0(ORID,ACTION,.VAL,$G(ORWNAT)) S VAL="" ; VAL=error
"RTN","ORWDXA",37,0)
 Q
"RTN","ORWDXA",38,0)
HOLD(REC,ORID,ORNP)  ; Place an order on hold
"RTN","ORWDXA",39,0)
 N ACTDA
"RTN","ORWDXA",40,0)
 S ACTDA=$$ACTION^ORCSAVE("HD",+ORID,ORNP)
"RTN","ORWDXA",41,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",42,0)
 Q
"RTN","ORWDXA",43,0)
UNHOLD(REC,ORID,ORNP)  ; Release an order from hold
"RTN","ORWDXA",44,0)
 N ACTDA
"RTN","ORWDXA",45,0)
 S ACTDA=$$ACTION^ORCSAVE("RL",+ORID,ORNP)
"RTN","ORWDXA",46,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",47,0)
 Q
"RTN","ORWDXA",48,0)
DC(REC,ORID,ORNP,ORL,REASON)   ; Discontinue/Cancel/Delete an order
"RTN","ORWDXA",49,0)
 N NATURE,CREATE,PRINT,STATUS,ACTDA,SIGSTS
"RTN","ORWDXA",50,0)
 N X3,X8,CURRACT
"RTN","ORWDXA",51,0)
 Q:'+ORID
"RTN","ORWDXA",52,0)
 S CURRACT=0
"RTN","ORWDXA",53,0)
 S ORL(2)=ORL_";SC(",ORL=ORL(2),NATURE=""
"RTN","ORWDXA",54,0)
 I REASON S NATURE=$P(^ORD(100.02,$P(^ORD(100.03,REASON,0),U,7),0),U,2)
"RTN","ORWDXA",55,0)
 S:NATURE="" NATURE="W"  ; S:ORNP=DUZ NATURE="E" 
"RTN","ORWDXA",56,0)
 S CREATE=$$CREATE^ORX1(NATURE),PRINT=$$PRINT^ORCACT2(NATURE)
"RTN","ORWDXA",57,0)
 S X3=$G(^OR(100,+ORID,3))
"RTN","ORWDXA",58,0)
 S CURRACT=$P(X3,U,7) S:CURRACT<1 CURRACT=+$O(^OR(100,+ORID,8,"?"),-1)
"RTN","ORWDXA",59,0)
 I '$D(^OR(100,+ORID,8,+$P(ORID,";",2),0)) D
"RTN","ORWDXA",60,0)
 . S X8=$G(^OR(100,+ORID,8,CURRACT,0))
"RTN","ORWDXA",61,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",62,0)
 . S $P(ORID,";",2)=CURRACT
"RTN","ORWDXA",63,0)
 E  D
"RTN","ORWDXA",64,0)
 . S X8=^OR(100,+ORID,8,+$P(ORID,";",2),0)
"RTN","ORWDXA",65,0)
 . S SIGSTS=$P(X8,U,4)
"RTN","ORWDXA",66,0)
 I '$D(SIGSTS) S SIGSTS=1
"RTN","ORWDXA",67,0)
 S STATUS=$P($G(^OR(100,+ORID,8,+$P(ORID,";",2),0)),U,15)
"RTN","ORWDXA",68,0)
 I (STATUS=10)!(STATUS=11) D  Q   ; delete/cancel unreleased order
"RTN","ORWDXA",69,0)
 . N RPLORD
"RTN","ORWDXA",70,0)
 . S RPLORD=$P($G(^OR(100,+ORID,3)),U,5)    ; replaced order
"RTN","ORWDXA",71,0)
 . D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",72,0)
 . I STATUS=10,($P(X8,U,4)'=2) D  ; CANCEL signed, delayed, unreleased
"RTN","ORWDXA",73,0)
 . . ; taken from CLRDLY^ORCACT2
"RTN","ORWDXA",74,0)
 . . I REASON D SET^ORCACT2(+ORID,NATURE,REASON)
"RTN","ORWDXA",75,0)
 . . I 'REASON D SET^ORCACT2(+ORID,"M","","Delayed Order Cancelled")
"RTN","ORWDXA",76,0)
 . . D STATUS^ORCSAVE2(+ORID,13) S $P(^OR(100,+ORID,8,1,0),U,15)=13
"RTN","ORWDXA",77,0)
 . E  D                           ; DELETE unsigned, unreleased
"RTN","ORWDXA",78,0)
 . . I $P(X8,U,2)="DC" K ^OR(100,+ORID,6)
"RTN","ORWDXA",79,0)
 . . ; delete fwd ptr to order about to be deleted
"RTN","ORWDXA",80,0)
 . . I RPLORD,$P(X8,U,2)="NW" S $P(^OR(100,RPLORD,3),U,6)=""
"RTN","ORWDXA",81,0)
 . . ; delete ptr to order in Patient Event file #100.2
"RTN","ORWDXA",82,0)
 . . N EVT S EVT=$P($G(^OR(100,+ORID,0)),U,17) I EVT,EVT=+$O(^ORE(100.2,"AO",+ORID,0)) S $P(^ORE(100.2,EVT,0),U,4)="" K ^ORE(100.2,"AO",+ORID,EVT)
"RTN","ORWDXA",83,0)
 . . D DELETE^ORCSAVE2(ORID)
"RTN","ORWDXA",84,0)
 . I RPLORD,'(SIGSTS=1) S ORID=RPLORD  ; for Renews & Changes, show replaced order
"RTN","ORWDXA",85,0)
 . I '$D(^OR(100,+ORID)) D
"RTN","ORWDXA",86,0)
 . . S $P(REC(1),U)="~0",REC(2)="tDELETED: "_$E(REC(2),2,245)
"RTN","ORWDXA",87,0)
 . E  D
"RTN","ORWDXA",88,0)
 . . K REC
"RTN","ORWDXA",89,0)
 . . D GETBYIFN^ORWORR(.REC,+ORID_";"_$P($G(^OR(100,+ORID,3)),U,7))
"RTN","ORWDXA",90,0)
 . S $P(REC(1),U,14)=2 ; DCType = deletion
"RTN","ORWDXA",91,0)
 I CREATE D
"RTN","ORWDXA",92,0)
 . S ACTDA=$$ACTION^ORCSAVE("DC",+ORID,ORNP)
"RTN","ORWDXA",93,0)
 . D SET^ORCACT2(+ORID,NATURE,REASON)
"RTN","ORWDXA",94,0)
 E  D 
"RTN","ORWDXA",95,0)
 . D EN^ORCSEND(+ORID,"DC",3,1,NATURE,REASON)
"RTN","ORWDXA",96,0)
 . S ACTDA=$P(ORID,";",2)
"RTN","ORWDXA",97,0)
 . I PRINT ; do something to print this
"RTN","ORWDXA",98,0)
 D GETBYIFN^ORWORR(.REC,+ORID_";"_ACTDA)
"RTN","ORWDXA",99,0)
 S $P(REC(1),U,14)=$S(CREATE:1,1:3)  ;DCType - 1=NewOrder, 3=NewStatus
"RTN","ORWDXA",100,0)
 Q
"RTN","ORWDXA",101,0)
DCREASON(LST)   ; Return a list of DC reasons
"RTN","ORWDXA",102,0)
 N IEN,ILST,X
"RTN","ORWDXA",103,0)
 S ILST=1,LST(ILST)="~DCReason"
"RTN","ORWDXA",104,0)
 S IEN=0 F  S IEN=$O(^ORD(100.03,IEN)) Q:'IEN  S X=^(IEN,0) D
"RTN","ORWDXA",105,0)
 . I $P(X,U,4) Q                              ; inactive
"RTN","ORWDXA",106,0)
 . I $P(X,U,5)'=+$O(^DIC(9.4,"C","OR",0)) Q   ; not OR pkg
"RTN","ORWDXA",107,0)
 . I $P(X,U,7)=+$O(^ORD(100.02,"C","A",0)) Q  ; nature=auto
"RTN","ORWDXA",108,0)
 . S ILST=ILST+1,LST(ILST)="i"_IEN_U_$P(X,U)
"RTN","ORWDXA",109,0)
 S IEN=$O(^ORD(100.03,"C","ORREQ",0))
"RTN","ORWDXA",110,0)
 I IEN S ILST=ILST+1,LST(ILST)="d"_IEN_U_$P(^ORD(100.03,IEN,0),U)
"RTN","ORWDXA",111,0)
 Q
"RTN","ORWDXA",112,0)
DCREQIEN(VAL)   ; Return the IEN for Requesting Physician Cancelled reason
"RTN","ORWDXA",113,0)
 S VAL=$O(^ORD(100.03,"S","REQ",0))
"RTN","ORWDXA",114,0)
 Q
"RTN","ORWDXA",115,0)
COMPLETE(REC,ORID,ESCODE)      ; Complete an order (generic orders)
"RTN","ORWDXA",116,0)
 ;N X S X=+$E($$NOW^XLFDT,1,12)
"RTN","ORWDXA",117,0)
 ;D DATES^ORCSAVE2(+ORID,,X)
"RTN","ORWDXA",118,0)
 ;D STATUS^ORCSAVE2(+ORID,2)
"RTN","ORWDXA",119,0)
 ; validate ESCode
"RTN","ORWDXA",120,0)
 D COMP^ORCSAVE2(ORID)
"RTN","ORWDXA",121,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",122,0)
 Q
"RTN","ORWDXA",123,0)
VERIFY(REC,ORID,ESCODE,ORVER) ; Verify an order
"RTN","ORWDXA",124,0)
 ; validate ESCode
"RTN","ORWDXA",125,0)
 S ORVER=$G(ORVER,$S($D(^XUSEC("ORELSE",DUZ)):"N",$D(^XUSEC("OREMAS",DUZ)):"C",1:U))
"RTN","ORWDXA",126,0)
 I ORVER'=U D
"RTN","ORWDXA",127,0)
 . N ORIFN,ORES,ORI
"RTN","ORWDXA",128,0)
 . ; to match 56, need to VERIFY any replaced orders:
"RTN","ORWDXA",129,0)
 . S ORIFN=ORID,ORES(ORIFN)="" D REPLCD^ORCACT1
"RTN","ORWDXA",130,0)
 . S ORI="" F  S ORI=$O(ORES(ORI)) Q:ORI=""  D EN^ORCSEND(ORI,"VR","",""),UNLK1^ORX2(+ORI):ORI'=ORID ;ORID locked prior
"RTN","ORWDXA",131,0)
 D GETBYIFN^ORWORR(.REC,ORID)
"RTN","ORWDXA",132,0)
 Q
"RTN","ORWDXA",133,0)
ALERT(DUMMY,ORID,ORDUZ)       ;send alert to user (ORDUZ) when order (ORID) resulted
"RTN","ORWDXA",134,0)
 ;if no user passed from GUI, use ordering provider:
"RTN","ORWDXA",135,0)
 I $G(ORDUZ)<1 S ORDUZ=+$$ORDERER^ORQOR2(+ORID)
"RTN","ORWDXA",136,0)
 I $L($G(ORDUZ))<1 S ORDUZ=DUZ
"RTN","ORWDXA",137,0)
 S DUMMY=1,$P(^OR(100,+ORID,3),U,10)=ORDUZ
"RTN","ORWDXA",138,0)
 Q
"RTN","ORWDXA",139,0)
FLAG(REC,ORIFN,OREASON,ORNP)   ; Flag an order
"RTN","ORWDXA",140,0)
 N ORB,ORVP,DA,ORPS
"RTN","ORWDXA",141,0)
 D BULLETIN
"RTN","ORWDXA",142,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",143,0)
 K ^OR(100,+ORIFN,8,DA,3) S ^(3)="1^"_$G(XMZ)_U_+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON
"RTN","ORWDXA",144,0)
 D KILL^XM,MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",145,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ; Last Activity
"RTN","ORWDXA",146,0)
 I +$G(ORNP)<1 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",147,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^1" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",148,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",149,0)
 Q
"RTN","ORWDXA",150,0)
BULLETIN        ; Send flagged order bulletin (USED BY FLAG)
"RTN","ORWDXA",151,0)
 N OR0,OR3,ORDTXT,XMB,XMY,XMDUZ,ORENT,BULL,ORSRV,ORUSR
"RTN","ORWDXA",152,0)
 S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORWDXA",153,0)
 ;CLA - 3/21/96:
"RTN","ORWDXA",154,0)
 S ORUSR=+$P(OR0,U,4)
"RTN","ORWDXA",155,0)
 S ORSRV=$G(^VA(200,ORUSR,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORWDXA",156,0)
 S ORENT="USR.`"_ORUSR_"^SRV.`"_$G(ORSRV)_"^DIV^SYS^PKG"
"RTN","ORWDXA",157,0)
 S BULL=$$GET^XPAR(ORENT,"ORB FLAGGED ORDERS BULLETIN",1,"Q")
"RTN","ORWDXA",158,0)
 Q:$G(BULL)'="Y"   ;quit if parameter value is not 'Y'es
"RTN","ORWDXA",159,0)
 ;
"RTN","ORWDXA",160,0)
 S XMB="OR FLAGGED ORDER",XMDUZ=DUZ,XMY(+$P(OR0,U,4))=""
"RTN","ORWDXA",161,0)
 S XMB(1)=$P(^DPT(+$P(OR0,U,2),0),U),XMB(2)=$P(^(0),U,9),XMB(3)="" ;sb AGE
"RTN","ORWDXA",162,0)
 S XMB(4)=$$FMTE^XLFDT($P(OR0,U,7))
"RTN","ORWDXA",163,0)
 D TEXT^ORQ12(.ORDTXT,+ORIFN,80)
"RTN","ORWDXA",164,0)
 S XMB(5)=$G(ORDTXT(1)),XMB(6)=$G(ORDTXT(2)),XMB(7)=$G(ORDTXT(3))
"RTN","ORWDXA",165,0)
 S XMB(8)=$$FMTE^XLFDT($P(OR0,U,8)),XMB(9)=$$FMTE^XLFDT($P(OR0,U,9)),XMB(10)=OREASON
"RTN","ORWDXA",166,0)
 S XMB(11)=$P($G(^ORD(100.01,+$P(OR3,U,3),0)),U)
"RTN","ORWDXA",167,0)
 D EN^XMB
"RTN","ORWDXA",168,0)
 Q
"RTN","ORWDXA",169,0)
UNFLAG(REC,ORIFN,OREASON)       ; Unflag an order
"RTN","ORWDXA",170,0)
 N DA,ORB,ORNP,ORVP,ORPS
"RTN","ORWDXA",171,0)
 S DA=$P(ORIFN,";",2),ORVP=+$P(^OR(100,+ORIFN,0),U,2)
"RTN","ORWDXA",172,0)
 S $P(^OR(100,+ORIFN,8,DA,3),U)=0,$P(^(3),U,6,8)=+$E($$NOW^XLFDT,1,12)_U_DUZ_U_OREASON D MSG^ORCFLAG(ORIFN)
"RTN","ORWDXA",173,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT  ; Last Activity
"RTN","ORWDXA",174,0)
 S ORNP=+$P($G(^OR(100,+ORIFN,8,DA,0)),U,3)
"RTN","ORWDXA",175,0)
 S ORB=+ORVP_U_+ORIFN_U_ORNP_"^0" D EN^OCXOERR(ORB) ; notification
"RTN","ORWDXA",176,0)
 D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXA",177,0)
 Q
"RTN","ORWDXA",178,0)
FLAGTXT(LST,ORID)      ; Return flag reason
"RTN","ORWDXA",179,0)
 N FLAG
"RTN","ORWDXA",180,0)
 S FLAG=$G(^OR(100,+ORID,8,$P(ORID,";",2),3))
"RTN","ORWDXA",181,0)
 S LST(1)="FLAGGED: "_$$FMTE^XLFDT($P(FLAG,U,3))_" by "_$P($G(^VA(200,+$P(FLAG,U,4),0)),U)
"RTN","ORWDXA",182,0)
 S LST(2)=$P(FLAG,U,5) ; reason
"RTN","ORWDXA",183,0)
 Q
"RTN","ORWDXA",184,0)
WCGET(LST,ORID) ; Return ward comments
"RTN","ORWDXA",185,0)
 N I,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",186,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,8,ACT,5,I)) Q:'I  S LST(I)=$G(^(I,0))
"RTN","ORWDXA",187,0)
 Q
"RTN","ORWDXA",188,0)
WCPUT(ERR,ORID,WCLST) ; Set ward comments for order
"RTN","ORWDXA",189,0)
 N DIERR,ERRLST,ORIFN,ACT S ORIFN=+ORID,ACT=+$P(ORID,";",2)
"RTN","ORWDXA",190,0)
 D WP^DIE(100.008,ACT_","_ORIFN_",",50,"","WCLST","ERRLST")
"RTN","ORWDXA",191,0)
 S ERR="" I $D(DIERR) S ERR="An error occurred while saving comments."
"RTN","ORWDXA",192,0)
 Q
"RTN","ORWDXA",193,0)
OFCPLX(ORY,ORID,PRTORDER) ;Check if ORID is an child of the PRTORDER
"RTN","ORWDXA",194,0)
 N NUMCHDS,NOWID,NOWVAL,X3,ORDA,ISNOW
"RTN","ORWDXA",195,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXA",196,0)
 S ISNOW=0
"RTN","ORWDXA",197,0)
 D ISNOW^ORWDXR(.ISNOW,+ORID)
"RTN","ORWDXA",198,0)
 Q:ISNOW
"RTN","ORWDXA",199,0)
 N PKG
"RTN","ORWDXA",200,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXA",201,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXA",202,0)
 I PKG'="PS" Q
"RTN","ORWDXA",203,0)
 I $L($G(^OR(100,+ORID,3))),('$L($P(^(3),U,9))) Q
"RTN","ORWDXA",204,0)
 S (NUMCHDS,NOWID,NOWVAL,X3,ORDA)=0
"RTN","ORWDXA",205,0)
 S PRTORDER=+$P(^(3),U,9)
"RTN","ORWDXA",206,0)
 S X3=$G(^OR(100,PRTORDER,3)),ORDA=$P(X3,U,7)
"RTN","ORWDXA",207,0)
 S PRTORDER=PRTORDER_";"_ORDA
"RTN","ORWDXA",208,0)
 S NUMCHDS=$P($G(^OR(100,+PRTORDER,2,0)),U,4)
"RTN","ORWDXA",209,0)
 I NUMCHDS>2 S ORY="COMPLEX-PSI"_U_PRTORDER
"RTN","ORWDXA",210,0)
 S:$D(^OR(100,+PRTORDER,4.5,"ID","NOW")) NOWID=$O(^("NOW",0))
"RTN","ORWDXA",211,0)
 S:NOWID NOWVAL=$G(^OR(100,+PRTORDER,4.5,NOWID,1))
"RTN","ORWDXA",212,0)
 I NOWVAL=1 Q
"RTN","ORWDXA",213,0)
 E  S ORY="COMPLEX-PSI"_U_PRTORDER
"RTN","ORWDXA",214,0)
 Q
"RTN","ORWDXA",215,0)
ISACTOI(ORY,OI) ;If it's an active orderable item
"RTN","ORWDXA",216,0)
 I $G(^ORD(101.43,+OI,.1)),^(.1)'>$$NOW^XLFDT D
"RTN","ORWDXA",217,0)
 . S ORY=$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore."
"RTN","ORWDXA",218,0)
 Q
"RTN","ORWDXR")
0^4^B36855643
"RTN","ORWDXR",1,0)
ORWDXR ; SLC/KCM/JDL - Utilites for Order Actions ;5/6/04  14:50
"RTN","ORWDXR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,125,131,134,141,149,187,190,213**;Dec 17, 1997
"RTN","ORWDXR",3,0)
 ;
"RTN","ORWDXR",4,0)
ISREL(VAL,ORIFN) ; Return true if an order has been released
"RTN","ORWDXR",5,0)
 N STS S STS=$P(^OR(100,+ORIFN,3),U,3)
"RTN","ORWDXR",6,0)
 S VAL=$S(STS=10:0,STS=11:0,1:1)  ; false if delayed or unreleased order
"RTN","ORWDXR",7,0)
 Q
"RTN","ORWDXR",8,0)
RENEW(REC,ORIFN,ORVP,ORNP,ORL,FLDS,CPLX,ORAPPT) ; Renew an order
"RTN","ORWDXR",9,0)
 N ORDG
"RTN","ORWDXR",10,0)
 N ORDUZ,ORSTS,OREVENT,ORCAT,ORDA,ORTS,ORNEW,ORCHECK,ORLOG,ORPKG
"RTN","ORWDXR",11,0)
 N ORDIALOG,PRMT,X0
"RTN","ORWDXR",12,0)
 N FSTDOSE,FST
"RTN","ORWDXR",13,0)
 S (FSTDOSE,FST)=0
"RTN","ORWDXR",14,0)
 I '$D(CPLX) S CPLX=0
"RTN","ORWDXR",15,0)
 I '$G(ORAPPT) S ORAPPT=""
"RTN","ORWDXR",16,0)
 S ORVP=ORVP_";DPT(",ORL(2)=ORL_";SC(",ORL=ORL(2)
"RTN","ORWDXR",17,0)
 S X0=^OR(100,+ORIFN,0)
"RTN","ORWDXR",18,0)
 S ORDG=$P(X0,U,11)
"RTN","ORWDXR",19,0)
 S ORPKG=$P(X0,U,14)
"RTN","ORWDXR",20,0)
 I $D(FLDS("ORCHECK")) M ORCHECK=FLDS("ORCHECK")
"RTN","ORWDXR",21,0)
 I $P(X0,U,5)["101.41," D                        ; version 3
"RTN","ORWDXR",22,0)
 . S ORDIALOG=+$P(X0,U,5),ORCAT=$P(^OR(100,+ORIFN,0),U,12)
"RTN","ORWDXR",23,0)
 . D GETDLG^ORCD(ORDIALOG),GETORDER^ORCD(+ORIFN)
"RTN","ORWDXR",24,0)
 . I CPLX S FSTDOSE=$P($G(ORDIALOG("B","FIRST DOSE")),U,2) S:'FSTDOSE FSTDOSE=$$PTR^ORCD("OR GTX NOW")
"RTN","ORWDXR",25,0)
 . I FSTDOSE,$G(ORDIALOG(FSTDOSE,1)) K ORDIALOG(FSTDOSE,1)
"RTN","ORWDXR",26,0)
 E  D                                            ; version 2.5 generic
"RTN","ORWDXR",27,0)
 . S ORDIALOG=$O(^ORD(101.41,"B","OR GXTEXT WORD PROCESSING ORDE",0))
"RTN","ORWDXR",28,0)
 . D GETDLG^ORCD(ORDIALOG)
"RTN","ORWDXR",29,0)
 . S PRMT=$O(^ORD(101.41,"B","OR GTX WORD PROCESSING 1",0))
"RTN","ORWDXR",30,0)
 . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWDXR",31,0)
 . M ^TMP("ORWORD",$J,PRMT,1)=^OR(100,+ORIFN,1)
"RTN","ORWDXR",32,0)
 . S PRMT=$O(^ORD(101.41,"B","OR GTX START DATE/TIME",0))
"RTN","ORWDXR",33,0)
 . I $P(X0,U,9) S ORDIALOG(PRMT,1)=$P(X0,U,9)
"RTN","ORWDXR",34,0)
 I +FLDS(1)=999 D  ; generic order
"RTN","ORWDXR",35,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX START DATE/TIME"),1)=$P(FLDS(1),U,2)
"RTN","ORWDXR",36,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX STOP DATE/TIME"),1)=$P(FLDS(1),U,3)
"RTN","ORWDXR",37,0)
 I ($O(^ORD(101.41,"AB","PS MEDS",0))>0),(+FLDS(1)=130)!(+FLDS(1)=135)!(+FLDS(1)=140),'$L($G(ORDIALOG($$PTR^ORCD("OR GTX SIG"),1))) D
"RTN","ORWDXR",38,0)
 . N ORDOSE,ORDRUG,ORCAT,ORWPSOI,PROMPT,DRUG
"RTN","ORWDXR",39,0)
 . S ORCAT=$P($G(^OR(100,+ORIFN,0)),U,12)
"RTN","ORWDXR",40,0)
 . S PROMPT=$$PTR^ORCD("OR GTX INSTRUCTIONS")
"RTN","ORWDXR",41,0)
 . S ORDRUG=$G(ORDIALOG($$PTR^ORCD("OR GTX DISPENSE DRUG"),1))
"RTN","ORWDXR",42,0)
 . S ORWPSOI=+$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORWDXR",43,0)
 . I ORWPSOI S ORWPSOI=+$P($G(^ORD(101.43,+ORWPSOI,0)),U,2)
"RTN","ORWDXR",44,0)
 . D DOSE^PSSORUTL(.ORDOSE,ORWPSOI,$S(ORCAT="I":"U",1:"O"),ORVP)       ; dflt doses
"RTN","ORWDXR",45,0)
 . D D1^ORCDPS2  ; set up ORDOSE
"RTN","ORWDXR",46,0)
 . S DRUG=$G(ORDOSE("DD",+ORDRUG))
"RTN","ORWDXR",47,0)
 . I DRUG,ORCAT="O" D RESETID^ORCDPS
"RTN","ORWDXR",48,0)
 . D SIG^ORCDPS2
"RTN","ORWDXR",49,0)
 I +FLDS(1)=140 D  ; outpatient meds
"RTN","ORWDXR",50,0)
 . K ORDIALOG($$PTR^ORCD("OR GTX START DATE"),1) ; remove effective dt
"RTN","ORWDXR",51,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX REFILLS"),1)=$P(FLDS(1),U,4)
"RTN","ORWDXR",52,0)
 . S ORDIALOG($$PTR^ORCD("OR GTX ROUTING"),1)=$P(FLDS(1),U,5)
"RTN","ORWDXR",53,0)
 . S PRMT=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORWDXR",54,0)
 . K ^TMP("ORWORD",$J,PRMT,1)
"RTN","ORWDXR",55,0)
 . S I=1 F  S I=$O(FLDS(I)) Q:'I  S ^TMP("ORWORD",$J,PRMT,1,I-1,0)=FLDS(I)
"RTN","ORWDXR",56,0)
 . S ^TMP("ORWORD",$J,PRMT,1,0)=U_U_(I-1)_U_(I-1)_U_DT_U
"RTN","ORWDXR",57,0)
 . S ORDIALOG(PRMT,1)=$NA(^TMP("ORWORD",$J,PRMT,1))
"RTN","ORWDXR",58,0)
 D RN^ORCSAVE
"RTN","ORWDXR",59,0)
 S REC="" S ORIFN=+ORIFN_";"_ORDA D GETBYIFN^ORWORR(.REC,ORIFN)
"RTN","ORWDXR",60,0)
 Q
"RTN","ORWDXR",61,0)
RNWFLDS(LST,ORIFN)      ; Return fields for renew action
"RTN","ORWDXR",62,0)
 ; LST(0)=RenewType^Start^Stop^Refills^Pickup  LST(n)=Comments
"RTN","ORWDXR",63,0)
 N X0,DG,PKG,RNWTYPE,START,STOP,REFILLS
"RTN","ORWDXR",64,0)
 S ORIFN=+ORIFN,X0=^OR(100,ORIFN,0),DG=$P(X0,U,11),PKG=$P(X0,U,14)
"RTN","ORWDXR",65,0)
 S PKG=$E($P(^DIC(9.4,PKG,0),U,2),1,2),DG=$P(^ORD(100.98,DG,0),U,3)
"RTN","ORWDXR",66,0)
 S LST(0)=$S(PKG="OR":999,PKG="PS"&(DG="O RX"):140,PKG="PS"&(DG="UD RX"):130,PKG="PS"&(DG="NV RX"):145,1:0)
"RTN","ORWDXR",67,0)
 I +LST(0)=140 D
"RTN","ORWDXR",68,0)
 . S LST(0)=LST(0)_U_U_U_+$$VAL(ORIFN,"REFILLS")_U_$$VAL(ORIFN,"PICKUP")
"RTN","ORWDXR",69,0)
 . D WPVAL(.LST,ORIFN,"COMMENT")
"RTN","ORWDXR",70,0)
 I +LST(0)=999 S LST(0)=LST(0)_U_$$VAL(ORIFN,"START")_U_$$VAL(ORIFN,"STOP")
"RTN","ORWDXR",71,0)
 ; make sure start/stop times are relative times, otherwise use NOW, no Stop
"RTN","ORWDXR",72,0)
 I +$P(LST(0),U,2) S $P(LST(0),U,2)="NOW"
"RTN","ORWDXR",73,0)
 I +$P(LST(0),U,3)!($P(LST(0),U,3)="0") S $P(LST(0),U,3)=""
"RTN","ORWDXR",74,0)
 Q
"RTN","ORWDXR",75,0)
VAL(ORIFN,ID)   ; Return value for order response
"RTN","ORWDXR",76,0)
 N DA S DA=+$O(^OR(100,ORIFN,4.5,"ID",ID,0))
"RTN","ORWDXR",77,0)
 Q $G(^OR(100,ORIFN,4.5,DA,1))
"RTN","ORWDXR",78,0)
WPVAL(TXT,ORIFN,ID)    ; Return word processing value
"RTN","ORWDXR",79,0)
 N DA S DA=+$O(^OR(100,ORIFN,4.5,"ID",ID,0))
"RTN","ORWDXR",80,0)
 S I=0 F  S I=$O(^OR(100,ORIFN,4.5,DA,2,I)) Q:'I  S TXT(I)=^(I,0)
"RTN","ORWDXR",81,0)
 Q
"RTN","ORWDXR",82,0)
CHKACT(ORDERID,ORWSIG,ORWREL,ORWNATR) ; Return error if can't sign/release order
"RTN","ORWDXR",83,0)
 N ORACT,ORWERR
"RTN","ORWDXR",84,0)
 ; begin case
"RTN","ORWDXR",85,0)
 S ORACT=""
"RTN","ORWDXR",86,0)
 I (ORWSIG=1),$D(^XUSEC("ORES",DUZ)) S ORACT="ES" G XC1
"RTN","ORWDXR",87,0)
 I (ORWSIG=7),$D(^XUSEC("ORES",DUZ)) S ORACT="DS" G XC1
"RTN","ORWDXR",88,0)
 I ORWREL,(ORWNATR="W") S ORACT="OC" G XC1
"RTN","ORWDXR",89,0)
 I ORWREL S ORACT="RS" S:$P($G(^OR(100,+ORDERID,0)),U,16)<2 ORACT="ES"
"RTN","ORWDXR",90,0)
XC1 ; end case
"RTN","ORWDXR",91,0)
 S ORWERR=""
"RTN","ORWDXR",92,0)
 I $L(ORACT),$$VALID^ORCACT0(ORDERID,ORACT,.ORWERR,ORWNATR) S ORWERR=""
"RTN","ORWDXR",93,0)
 Q ORWERR
"RTN","ORWDXR",94,0)
GTORITM(Y,ORIFN)        ;-- Get back the orderable item IEN
"RTN","ORWDXR",95,0)
 S ORIFN=+ORIFN
"RTN","ORWDXR",96,0)
 S Y=$$VALUE^ORCSAVE2(ORIFN,"ORDERABLE")
"RTN","ORWDXR",97,0)
 Q
"RTN","ORWDXR",98,0)
GETPKG(Y,IFN) ;Get package for an order
"RTN","ORWDXR",99,0)
 N ORDERID,PKGID
"RTN","ORWDXR",100,0)
 Q:+IFN<1
"RTN","ORWDXR",101,0)
 S ORDERID=+IFN,Y=""
"RTN","ORWDXR",102,0)
 S PKGID=$P(^OR(100,ORDERID,0),U,14)
"RTN","ORWDXR",103,0)
 S:PKGID>0 Y=$P(^DIC(9.4,PKGID,0),U,2)
"RTN","ORWDXR",104,0)
 Q
"RTN","ORWDXR",105,0)
ISCPLX(ORY,ORID) ; 1: is complex order 0: is not
"RTN","ORWDXR",106,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",107,0)
 N PKG
"RTN","ORWDXR",108,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",109,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",110,0)
 I PKG'="PS" Q
"RTN","ORWDXR",111,0)
 N NUMCHDS,NOWID,NOWVAL
"RTN","ORWDXR",112,0)
 S (NOWVAL,NOWID)=0
"RTN","ORWDXR",113,0)
 S NUMCHDS=$P($G(^OR(100,+ORID,2,0)),U,4)
"RTN","ORWDXR",114,0)
 I NUMCHDS>2 S ORY=1 Q
"RTN","ORWDXR",115,0)
 I NUMCHDS=2 D
"RTN","ORWDXR",116,0)
 . S ORY=1
"RTN","ORWDXR",117,0)
 . S:$D(^OR(100,+ORID,4.5,"ID","NOW")) NOWID=$O(^("NOW",0))
"RTN","ORWDXR",118,0)
 . S:NOWID NOWVAL=$G(^OR(100,+ORID,4.5,NOWID,1))
"RTN","ORWDXR",119,0)
 I NOWVAL=1 S ORY=0 Q
"RTN","ORWDXR",120,0)
 Q
"RTN","ORWDXR",121,0)
ORCPLX(ORY,ORID,ORACT) ;Return children orders of the complex order
"RTN","ORWDXR",122,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",123,0)
 N PKG,LACT,OELACT,ISNOW
"RTN","ORWDXR",124,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",125,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",126,0)
 I PKG'="PS" Q
"RTN","ORWDXR",127,0)
 N CHLDCNT,IDX,X3
"RTN","ORWDXR",128,0)
 S (CHLDCNT,IDX)=0
"RTN","ORWDXR",129,0)
 S:$L($G(^OR(100,+ORID,2,0))) CHLDCNT=$P(^(0),U,4)
"RTN","ORWDXR",130,0)
 I 'CHLDCNT Q
"RTN","ORWDXR",131,0)
 F  S IDX=$O(^OR(100,+ORID,2,IDX)) Q:'IDX  D
"RTN","ORWDXR",132,0)
 . S (LACT,OELACT,ISNOW)=0
"RTN","ORWDXR",133,0)
 . D ISNOW(.ISNOW,IDX)
"RTN","ORWDXR",134,0)
 . Q:ISNOW
"RTN","ORWDXR",135,0)
 . S X3=$G(^OR(100,IDX,3))
"RTN","ORWDXR",136,0)
 . S LACT=$P(X3,U,7)
"RTN","ORWDXR",137,0)
 . F  S OELACT=$O(^OR(100,IDX,8,OELACT),-1) Q:OELACT
"RTN","ORWDXR",138,0)
 . S:OELACT>LACT LACT=OELACT
"RTN","ORWDXR",139,0)
 . S ORY(IDX)=IDX_";"_LACT
"RTN","ORWDXR",140,0)
 Q
"RTN","ORWDXR",141,0)
CANRN(ORY,ORID) ; Check conjunction for renew.
"RTN","ORWDXR",142,0)
 ; All conjunctioni = "And" return 1
"RTN","ORWDXR",143,0)
 ; Has a "Then" return 0
"RTN","ORWDXR",144,0)
 Q:'$G(^OR(100,+ORID,0))
"RTN","ORWDXR",145,0)
 N PKG
"RTN","ORWDXR",146,0)
 S PKG=$P($G(^OR(100,+ORID,0)),U,14)
"RTN","ORWDXR",147,0)
 S PKG=$$NMSP^ORCD(PKG)
"RTN","ORWDXR",148,0)
 I PKG'="PS" Q
"RTN","ORWDXR",149,0)
 N INDX,INDY,CANRENEW
"RTN","ORWDXR",150,0)
 S INDX=0
"RTN","ORWDXR",151,0)
 S CANRENEW=1
"RTN","ORWDXR",152,0)
 N CHID
"RTN","ORWDXR",153,0)
 S CHID=0 F  S CHID=$O(^OR(100,+ORID,2,CHID)) Q:'CHID  D
"RTN","ORWDXR",154,0)
 . N ORSTS,ACTIVE S ORSTS=0
"RTN","ORWDXR",155,0)
 . S ORSTS=$P($G(^OR(100,CHID,3)),U,3)
"RTN","ORWDXR",156,0)
 . S ACTIVE=$O(^ORD(100.01,"B","ACTIVE",0))
"RTN","ORWDXR",157,0)
 . I ACTIVE'=ORSTS S CANRENEW=0
"RTN","ORWDXR",158,0)
 I 'CANRENEW S ORY=CANRENEW Q
"RTN","ORWDXR",159,0)
 F  S INDX=$O(^OR(100,+ORID,4.5,"ID","CONJ",INDX)) Q:'INDX  D
"RTN","ORWDXR",160,0)
 . S INDY=0 F  S INDY=$O(^OR(100,+ORID,4.5,INDX,INDY)) Q:'INDY  D
"RTN","ORWDXR",161,0)
 . . I $G(^(INDY))="T" S CANRENEW=0 Q
"RTN","ORWDXR",162,0)
 . I CANRENEW=0 Q
"RTN","ORWDXR",163,0)
 S ORY=CANRENEW
"RTN","ORWDXR",164,0)
 Q
"RTN","ORWDXR",165,0)
ISNOW(ORY,ORID) ; Is first time now order?
"RTN","ORWDXR",166,0)
 N SCH
"RTN","ORWDXR",167,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","ORWDXR",168,0)
 S SCH=""
"RTN","ORWDXR",169,0)
 S SCH=$O(^OR(100,+ORID,4.5,"ID","SCHEDULE",0))
"RTN","ORWDXR",170,0)
 S:SCH SCH=$G(^OR(100,+ORID,4.5,SCH,1))
"RTN","ORWDXR",171,0)
 S:SCH="NOW" ORY=1
"RTN","ORWDXR",172,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
PSU*3.0*34
"BLD",4484,0)
PSU*3.0*34^PHARMACY BENEFITS MANAGEMENT^0^3040908^y
"BLD",4484,1,0)
^^65^65^3040907^
"BLD",4484,1,1,0)
 Phase I of the Inpatient Medications Requirements for the Special Focus
"BLD",4484,1,2,0)
 Group IRA project consists of four patches. The patches are combined in
"BLD",4484,1,3,0)
 host file PSJ_PSS_OR_PSU_110.KID in order to simplify installation at VHA
"BLD",4484,1,4,0)
 facilities. Installation of this host file should be coordinated among
"BLD",4484,1,5,0)
 the four packages affected since only one installation is necessary. The
"BLD",4484,1,6,0)
 patches, in order of install, are:
"BLD",4484,1,7,0)
 
"BLD",4484,1,8,0)
      PSS*1*79   PHARMACY DATA MANAGEMENT V. 1.0
"BLD",4484,1,9,0)
      PSJ*5*110  INPATIENT MEDICATIONS V. 5.0
"BLD",4484,1,10,0)
      OR*3*213   ORDER ENTRY/RESULTS REPORTING V. 1.0
"BLD",4484,1,11,0)
      PSU*3*34   PHARMACY BENEFITS MANAGEMENT V. 3.0
"BLD",4484,1,12,0)
 
"BLD",4484,1,13,0)
 Patches PSS*1*79, OR*3*213, and PSU*3*34 contain changes to support the
"BLD",4484,1,14,0)
 following enhancements in PSJ*5*110:
"BLD",4484,1,15,0)
 
"BLD",4484,1,16,0)
 1. The Extend Stop Date on Renewal enhancements will allow an order to be
"BLD",4484,1,17,0)
 renewed without creating a new order. Editing of the start date will no
"BLD",4484,1,18,0)
 longer be allowed during the renewal process. In addition, limits have
"BLD",4484,1,19,0)
 been set on the length of time after an order expires that it may be
"BLD",4484,1,20,0)
 renewed. This is outlined in the BCMA 2001 Special Focus Report,
"BLD",4484,1,21,0)
 Requirement #11.
"BLD",4484,1,22,0)
 
"BLD",4484,1,23,0)
 2. The Complex Order enhancements will change the way complex orders are
"BLD",4484,1,24,0)
 handled by linking complex components (child orders) together. If the
"BLD",4484,1,25,0)
 actions Finish, Verify, Discontinue, or Renew are taken on one child
"BLD",4484,1,26,0)
 order, the user will be alerted that the action must be taken on all of
"BLD",4484,1,27,0)
 the complex component orders in the set. The user will then be prompted
"BLD",4484,1,28,0)
 to take the appropriate action on each child order in the complex order
"BLD",4484,1,29,0)
 set. This is outlined in BCMA 2001 Special Focus Report, Requirement #8.
"BLD",4484,1,30,0)
  
"BLD",4484,1,31,0)
 3. The STAT and NOW Order Notification enhancements will alert users
"BLD",4484,1,32,0)
 subscribing to new mail group PSJ STAT NOW PENDING ORDER when a pending
"BLD",4484,1,33,0)
 STAT or NOW order has been received from Computerized Patient Record
"BLD",4484,1,34,0)
 System (CPRS) V. 1.0. Users subscribing to the new mail group PSJ STAT
"BLD",4484,1,35,0)
 NOW ACTIVE ORDER will receive an alert when a STAT or NOW order is made
"BLD",4484,1,36,0)
 active. This is outlined in BCMA 2001 Special Focus Report, Requirement
"BLD",4484,1,37,0)
 #12.
"BLD",4484,1,38,0)
 
"BLD",4484,1,39,0)
 Changes to PHARMACY BENEFITS MANAGEMENT (PBM) V. 3.0 have been included
"BLD",4484,1,40,0)
 in this patch to address the following issues:
"BLD",4484,1,41,0)
 
"BLD",4484,1,42,0)
 1. Problem:  The changes to renewed orders introduced by the Inpatient
"BLD",4484,1,43,0)
 Medications Requirements for the Special Focus Group IRA, Phase I project
"BLD",4484,1,44,0)
 will allow renewed orders to have an active status for periods of time
"BLD",4484,1,45,0)
 that exceed the current PHARMACY BENEFITS MANAGEMENT (PBM) V. 3.0 time
"BLD",4484,1,46,0)
 period parameters.
"BLD",4484,1,47,0)
 
"BLD",4484,1,48,0)
 Solution:  The code searching for IV and Unit Dose activity within the
"BLD",4484,1,49,0)
 transmitting period has been modified to accommodate the extended periods
"BLD",4484,1,50,0)
 of time orders may contain an active status as a result of the changes
"BLD",4484,1,51,0)
 introduced by the Inpatient Medications Requirements for the Special 
"BLD",4484,1,52,0)
 Focus Group IRA, Phase I project.
"BLD",4484,1,53,0)
 
"BLD",4484,1,54,0)
 2. Problem: In several extracts only the first portion of the patient
"BLD",4484,1,55,0)
 Integration Control Number is being extracted. The entire Integration
"BLD",4484,1,56,0)
 Control Number needs to be exported.
"BLD",4484,1,57,0)
 
"BLD",4484,1,58,0)
 Solution: Patch PSU*3*34 will correct and extract the entire Integration
"BLD",4484,1,59,0)
 Control Number in the IV multiple (#100) in the Pharmacy Patient file
"BLD",4484,1,60,0)
 (#55) and the UNIT DOSE multiple (#62) in the Pharmacy Patient file
"BLD",4484,1,61,0)
 (#55).
"BLD",4484,1,62,0)
 
"BLD",4484,1,63,0)
 Patch PSU*3*24 will correct the problem in all other applicable files.
"BLD",4484,1,64,0)
 This is being done so that patch 24 and 34 can move forward without
"BLD",4484,1,65,0)
 conflict.
"BLD",4484,4,0)
^9.64PA^^
"BLD",4484,"KRN",0)
^9.67PA^8989.52^19
"BLD",4484,"KRN",.4,0)
.4
"BLD",4484,"KRN",.401,0)
.401
"BLD",4484,"KRN",.402,0)
.402
"BLD",4484,"KRN",.403,0)
.403
"BLD",4484,"KRN",.5,0)
.5
"BLD",4484,"KRN",.84,0)
.84
"BLD",4484,"KRN",3.6,0)
3.6
"BLD",4484,"KRN",3.8,0)
3.8
"BLD",4484,"KRN",9.2,0)
9.2
"BLD",4484,"KRN",9.8,0)
9.8
"BLD",4484,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4484,"KRN",9.8,"NM",1,0)
PSUIV1^^0^B72335798
"BLD",4484,"KRN",9.8,"NM",2,0)
PSUUD1^^0^B20884091
"BLD",4484,"KRN",9.8,"NM",3,0)
PSUUD2^^0^B16496136
"BLD",4484,"KRN",9.8,"NM","B","PSUIV1",1)

"BLD",4484,"KRN",9.8,"NM","B","PSUUD1",2)

"BLD",4484,"KRN",9.8,"NM","B","PSUUD2",3)

"BLD",4484,"KRN",19,0)
19
"BLD",4484,"KRN",19.1,0)
19.1
"BLD",4484,"KRN",101,0)
101
"BLD",4484,"KRN",409.61,0)
409.61
"BLD",4484,"KRN",771,0)
771
"BLD",4484,"KRN",870,0)
870
"BLD",4484,"KRN",8989.51,0)
8989.51
"BLD",4484,"KRN",8989.52,0)
8989.52
"BLD",4484,"KRN",8994,0)
8994
"BLD",4484,"KRN","B",.4,.4)

"BLD",4484,"KRN","B",.401,.401)

"BLD",4484,"KRN","B",.402,.402)

"BLD",4484,"KRN","B",.403,.403)

"BLD",4484,"KRN","B",.5,.5)

"BLD",4484,"KRN","B",.84,.84)

"BLD",4484,"KRN","B",3.6,3.6)

"BLD",4484,"KRN","B",3.8,3.8)

"BLD",4484,"KRN","B",9.2,9.2)

"BLD",4484,"KRN","B",9.8,9.8)

"BLD",4484,"KRN","B",19,19)

"BLD",4484,"KRN","B",19.1,19.1)

"BLD",4484,"KRN","B",101,101)

"BLD",4484,"KRN","B",409.61,409.61)

"BLD",4484,"KRN","B",771,771)

"BLD",4484,"KRN","B",870,870)

"BLD",4484,"KRN","B",8989.51,8989.51)

"BLD",4484,"KRN","B",8989.52,8989.52)

"BLD",4484,"KRN","B",8994,8994)

"BLD",4484,"QUES",0)
^9.62^^
"BLD",4484,"REQB",0)
^9.611^1^1
"BLD",4484,"REQB",1,0)
PSU*3.0*19^2
"BLD",4484,"REQB","B","PSU*3.0*19",1)

"MBREQ")
0
"PKG",367,-1)
1^1
"PKG",367,0)
PHARMACY BENEFITS MANAGEMENT^PSU^PHARMACY BENEFITS MANAGEMENT
"PKG",367,22,0)
^9.49I^1^1
"PKG",367,22,1,0)
3.0^2981015^2981030^11595
"PKG",367,22,1,"PAH",1,0)
34^3040908^10000000009
"PKG",367,22,1,"PAH",1,1,0)
^^65^65^3040908
"PKG",367,22,1,"PAH",1,1,1,0)
 Phase I of the Inpatient Medications Requirements for the Special Focus
"PKG",367,22,1,"PAH",1,1,2,0)
 Group IRA project consists of four patches. The patches are combined in
"PKG",367,22,1,"PAH",1,1,3,0)
 host file PSJ_PSS_OR_PSU_110.KID in order to simplify installation at VHA
"PKG",367,22,1,"PAH",1,1,4,0)
 facilities. Installation of this host file should be coordinated among
"PKG",367,22,1,"PAH",1,1,5,0)
 the four packages affected since only one installation is necessary. The
"PKG",367,22,1,"PAH",1,1,6,0)
 patches, in order of install, are:
"PKG",367,22,1,"PAH",1,1,7,0)
 
"PKG",367,22,1,"PAH",1,1,8,0)
      PSS*1*79   PHARMACY DATA MANAGEMENT V. 1.0
"PKG",367,22,1,"PAH",1,1,9,0)
      PSJ*5*110  INPATIENT MEDICATIONS V. 5.0
"PKG",367,22,1,"PAH",1,1,10,0)
      OR*3*213   ORDER ENTRY/RESULTS REPORTING V. 1.0
"PKG",367,22,1,"PAH",1,1,11,0)
      PSU*3*34   PHARMACY BENEFITS MANAGEMENT V. 3.0
"PKG",367,22,1,"PAH",1,1,12,0)
 
"PKG",367,22,1,"PAH",1,1,13,0)
 Patches PSS*1*79, OR*3*213, and PSU*3*34 contain changes to support the
"PKG",367,22,1,"PAH",1,1,14,0)
 following enhancements in PSJ*5*110:
"PKG",367,22,1,"PAH",1,1,15,0)
 
"PKG",367,22,1,"PAH",1,1,16,0)
 1. The Extend Stop Date on Renewal enhancements will allow an order to be
"PKG",367,22,1,"PAH",1,1,17,0)
 renewed without creating a new order. Editing of the start date will no
"PKG",367,22,1,"PAH",1,1,18,0)
 longer be allowed during the renewal process. In addition, limits have
"PKG",367,22,1,"PAH",1,1,19,0)
 been set on the length of time after an order expires that it may be
"PKG",367,22,1,"PAH",1,1,20,0)
 renewed. This is outlined in the BCMA 2001 Special Focus Report,
"PKG",367,22,1,"PAH",1,1,21,0)
 Requirement #11.
"PKG",367,22,1,"PAH",1,1,22,0)
 
"PKG",367,22,1,"PAH",1,1,23,0)
 2. The Complex Order enhancements will change the way complex orders are
"PKG",367,22,1,"PAH",1,1,24,0)
 handled by linking complex components (child orders) together. If the
"PKG",367,22,1,"PAH",1,1,25,0)
 actions Finish, Verify, Discontinue, or Renew are taken on one child
"PKG",367,22,1,"PAH",1,1,26,0)
 order, the user will be alerted that the action must be taken on all of
"PKG",367,22,1,"PAH",1,1,27,0)
 the complex component orders in the set. The user will then be prompted
"PKG",367,22,1,"PAH",1,1,28,0)
 to take the appropriate action on each child order in the complex order
"PKG",367,22,1,"PAH",1,1,29,0)
 set. This is outlined in BCMA 2001 Special Focus Report, Requirement #8.
"PKG",367,22,1,"PAH",1,1,30,0)
  
"PKG",367,22,1,"PAH",1,1,31,0)
 3. The STAT and NOW Order Notification enhancements will alert users
"PKG",367,22,1,"PAH",1,1,32,0)
 subscribing to new mail group PSJ STAT NOW PENDING ORDER when a pending
"PKG",367,22,1,"PAH",1,1,33,0)
 STAT or NOW order has been received from Computerized Patient Record
"PKG",367,22,1,"PAH",1,1,34,0)
 System (CPRS) V. 1.0. Users subscribing to the new mail group PSJ STAT
"PKG",367,22,1,"PAH",1,1,35,0)
 NOW ACTIVE ORDER will receive an alert when a STAT or NOW order is made
"PKG",367,22,1,"PAH",1,1,36,0)
 active. This is outlined in BCMA 2001 Special Focus Report, Requirement
"PKG",367,22,1,"PAH",1,1,37,0)
 #12.
"PKG",367,22,1,"PAH",1,1,38,0)
 
"PKG",367,22,1,"PAH",1,1,39,0)
 Changes to PHARMACY BENEFITS MANAGEMENT (PBM) V. 3.0 have been included
"PKG",367,22,1,"PAH",1,1,40,0)
 in this patch to address the following issues:
"PKG",367,22,1,"PAH",1,1,41,0)
 
"PKG",367,22,1,"PAH",1,1,42,0)
 1. Problem:  The changes to renewed orders introduced by the Inpatient
"PKG",367,22,1,"PAH",1,1,43,0)
 Medications Requirements for the Special Focus Group IRA, Phase I project
"PKG",367,22,1,"PAH",1,1,44,0)
 will allow renewed orders to have an active status for periods of time
"PKG",367,22,1,"PAH",1,1,45,0)
 that exceed the current PHARMACY BENEFITS MANAGEMENT (PBM) V. 3.0 time
"PKG",367,22,1,"PAH",1,1,46,0)
 period parameters.
"PKG",367,22,1,"PAH",1,1,47,0)
 
"PKG",367,22,1,"PAH",1,1,48,0)
 Solution:  The code searching for IV and Unit Dose activity within the
"PKG",367,22,1,"PAH",1,1,49,0)
 transmitting period has been modified to accommodate the extended periods
"PKG",367,22,1,"PAH",1,1,50,0)
 of time orders may contain an active status as a result of the changes
"PKG",367,22,1,"PAH",1,1,51,0)
 introduced by the Inpatient Medications Requirements for the Special 
"PKG",367,22,1,"PAH",1,1,52,0)
 Focus Group IRA, Phase I project.
"PKG",367,22,1,"PAH",1,1,53,0)
 
"PKG",367,22,1,"PAH",1,1,54,0)
 2. Problem: In several extracts only the first portion of the patient
"PKG",367,22,1,"PAH",1,1,55,0)
 Integration Control Number is being extracted. The entire Integration
"PKG",367,22,1,"PAH",1,1,56,0)
 Control Number needs to be exported.
"PKG",367,22,1,"PAH",1,1,57,0)
 
"PKG",367,22,1,"PAH",1,1,58,0)
 Solution: Patch PSU*3*34 will correct and extract the entire Integration
"PKG",367,22,1,"PAH",1,1,59,0)
 Control Number in the IV multiple (#100) in the Pharmacy Patient file
"PKG",367,22,1,"PAH",1,1,60,0)
 (#55) and the UNIT DOSE multiple (#62) in the Pharmacy Patient file
"PKG",367,22,1,"PAH",1,1,61,0)
 (#55).
"PKG",367,22,1,"PAH",1,1,62,0)
 
"PKG",367,22,1,"PAH",1,1,63,0)
 Patch PSU*3*24 will correct the problem in all other applicable files.
"PKG",367,22,1,"PAH",1,1,64,0)
 This is being done so that patch 24 and 34 can move forward without
"PKG",367,22,1,"PAH",1,1,65,0)
 conflict.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSUIV1")
0^1^B72335798
"RTN","PSUIV1",1,0)
PSUIV1 ;BIR/CFL - Extract Data of PBM IV Module ;25 AUG 1998
"RTN","PSUIV1",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**1,3,14,16,19,34**;Oct 15, 1998
"RTN","PSUIV1",3,0)
 ;DBIAs
"RTN","PSUIV1",4,0)
 ; Reference to file #55   supported by DBIA 2497
"RTN","PSUIV1",5,0)
 ; Reference to file #59.5 supported by DBIA 2499
"RTN","PSUIV1",6,0)
 ; Reference to file #40.8 supported by DBIA 2438
"RTN","PSUIV1",7,0)
 ; Reference to file #7    supported by DBIA 2495
"RTN","PSUIV1",8,0)
 ; Reference to file #49   supported by DBIA 10093
"RTN","PSUIV1",9,0)
 ; Reference to file #52.6 supported by DBIA 436
"RTN","PSUIV1",10,0)
 ; Reference to file #50   supported by DBIA 221
"RTN","PSUIV1",11,0)
 ; Reference to file #52.7 supported by DBIA 437
"RTN","PSUIV1",12,0)
 ; Reference to file #2    supported by DBIA 10035
"RTN","PSUIV1",13,0)
 ; Reference to file #200  supported by DBIA 10060
"RTN","PSUIV1",14,0)
 ;
"RTN","PSUIV1",15,0)
IVDATA ;Loop through IV data
"RTN","PSUIV1",16,0)
 N PSUDOC1
"RTN","PSUIV1",17,0)
 K PSUSSNA,PSUORDA
"RTN","PSUIV1",18,0)
 ; *34 |==>
"RTN","PSUIV1",19,0)
 S PSUIVDT=PSUSDT\1-.0001 ;use 1st day of extract for 'stop date' scan
"RTN","PSUIV1",20,0)
 S PSUTEDT=PSUEDT\1+.2359
"RTN","PSUIV1",21,0)
 F  S PSUIVDT=$O(^PS(55,"AIV",PSUIVDT)) Q:'PSUIVDT  D
"RTN","PSUIV1",22,0)
 .S PSUPDA=""
"RTN","PSUIV1",23,0)
 .F  S PSUPDA=$O(^PS(55,"AIV",PSUIVDT,PSUPDA)) Q:'PSUPDA  D
"RTN","PSUIV1",24,0)
 ..S PSUODA=""
"RTN","PSUIV1",25,0)
 ..F  S PSUODA=$O(^PS(55,"AIV",PSUIVDT,PSUPDA,PSUODA)) Q:'PSUODA  D
"RTN","PSUIV1",26,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUHLD",PSUODA)=""   ;should be the D0's for file 55.01 ; <==| *34
"RTN","PSUIV1",27,0)
 ...S COUNT=0
"RTN","PSUIV1",28,0)
 ...S PSUDIV=""
"RTN","PSUIV1",29,0)
 ...K PSUIV
"RTN","PSUIV1",30,0)
 ...; screen test patients
"RTN","PSUIV1",31,0)
 ...Q:$$TESTPAT^PSUTL1(PSUPDA)
"RTN","PSUIV1",32,0)
 ...S XX=$$VALI^PSUTL(55.01,"PSUPDA,PSUODA",.02) Q:XX>PSUTEDT  ;*34
"RTN","PSUIV1",33,0)
 ...K PSUIV ;*34
"RTN","PSUIV1",34,0)
 ...D GETS^PSUTL(55.01,"PSUPDA,PSUODA",".01;.02;.03;.04;.06;.08;.09;.22;104;106;108","PSUIV","I")
"RTN","PSUIV1",35,0)
 ...;.01-Order num;.02-Start Dt;.03-Stop Dt;.04-Type;.06-Provider
"RTN","PSUIV1",36,0)
 ...;104-Ward;106-Chemotherapy Type;108-Intermittent Syringe
"RTN","PSUIV1",37,0)
 ...Q:'$D(PSUIV)
"RTN","PSUIV1",38,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUPIEN",PSUPDA)=""     ;Patient IEN's ;*34
"RTN","PSUIV1",39,0)
 ...D MOVEI^PSUTL("PSUIV")
"RTN","PSUIV1",40,0)
 ...S PSUIV(.02)=PSUIV(.02)\1
"RTN","PSUIV1",41,0)
 ...S PSUIV(.03)=PSUIV(.03)\1
"RTN","PSUIV1",42,0)
 ...I PSUIV(.22)'="" S PSUDIV=$$VALI^PSUTL(59.5,PSUIV(.22),.02)
"RTN","PSUIV1",43,0)
 ...S PSUFAC=$$VALI^PSUTL(40.8,PSUDIV,1) S:PSUFAC="" PSUFAC=PSUSNDR
"RTN","PSUIV1",44,0)
 ...S PSUFAC(PSUFAC)=""
"RTN","PSUIV1",45,0)
 ...S PSUOUTP=$S(PSUIV(104)=.5:"Y",1:"N")
"RTN","PSUIV1",46,0)
 ...S DFN=PSUPDA D PID^VADPT
"RTN","PSUIV1",47,0)
 ...S PSUSSN=$TR(VA("PID"),"^-","")
"RTN","PSUIV1",48,0)
 ...D ICN
"RTN","PSUIV1",49,0)
 ...K PSUDOC
"RTN","PSUIV1",50,0)
 ...D GETS^PSUTL(200,"PSUIV(.06)","9;29;53.5","PSUDOC","I")
"RTN","PSUIV1",51,0)
 ...D MOVEI^PSUTL("PSUDOC")
"RTN","PSUIV1",52,0)
 ...I PSUDOC(9)="" S PSUVSSN1=999999999
"RTN","PSUIV1",53,0)
 ...I PSUDOC(9)'="" S PSUVSSN1=PSUDOC(9)
"RTN","PSUIV1",54,0)
 ...S ^XTMP("PSU_"_PSUJOB,"PSUPDR",PSUVSSN1,PSUIV(.06))=""
"RTN","PSUIV1",55,0)
 ...S (PSUPCLS,PSUSP1,PSUSP2)=""
"RTN","PSUIV1",56,0)
 ...I PSUDOC(53.5)'="" D
"RTN","PSUIV1",57,0)
 ....S PSUPCLS=$$VALI^PSUTL(7,PSUDOC(53.5),1)
"RTN","PSUIV1",58,0)
 ....I PSUPCLS="" S PSUPCLS=$$VALI^PSUTL(7,PSUDOC(53.5),.01)
"RTN","PSUIV1",59,0)
 ...S PSUPSV=$S($L($G(PSUDOC(29))):$$VAL^PSUTL(49,PSUDOC(29),.01),1:"")
"RTN","PSUIV1",60,0)
 ...S PSUPSV=$$UPPER^PSUTL(PSUPSV),PSUSERV=""
"RTN","PSUIV1",61,0)
 ...I $L(PSUPSV),$D(PSECT(PSUPSV)) S PSUSERV=PSECT(PSUPSV)
"RTN","PSUIV1",62,0)
 ...S SPECPTR=$$GET^XUA4A72(PSUIV(.06),PSUIVDT)
"RTN","PSUIV1",63,0)
 ...S PSUSP1=$P(SPECPTR,U,3),PSUSP2=$P(SPECPTR,U,4)
"RTN","PSUIV1",64,0)
 ...D OCCAMT
"RTN","PSUIV1",65,0)
 ...I PSUFND D
"RTN","PSUIV1",66,0)
 ....D GETRATE^PSUIV2(PSUIV(.04))
"RTN","PSUIV1",67,0)
 ....D SETTOT
"RTN","PSUIV1",68,0)
 ....S RECTYP=""
"RTN","PSUIV1",69,0)
 ....D ADDTIV
"RTN","PSUIV1",70,0)
 ....D SOLUTN
"RTN","PSUIV1",71,0)
 I $D(^XTMP(PSUIVSUB,"RECORDS")) D SETSUM^PSUIV2
"RTN","PSUIV1",72,0)
 Q
"RTN","PSUIV1",73,0)
 ;
"RTN","PSUIV1",74,0)
ICN ;Find patient ICN 
"RTN","PSUIV1",75,0)
 ;VMP OIFO BAY PINES;ELR;PSU*3.0*24
"RTN","PSUIV1",76,0)
 ;
"RTN","PSUIV1",77,0)
 N PSUPICN,PSUPICN1,PSUICN
"RTN","PSUIV1",78,0)
 S PSUPTN=0
"RTN","PSUIV1",79,0)
 I $G(PSUSSN),PSUSSN'="" D
"RTN","PSUIV1",80,0)
 .F  S PSUPTN=$O(^DPT("SSN",PSUSSN,PSUPTN)) Q:PSUPTN=""  D
"RTN","PSUIV1",81,0)
 ..S PSUPICN1=$$GETICN^MPIF001(PSUPTN) D
"RTN","PSUIV1",82,0)
 ...I PSUPICN1'[-1 D
"RTN","PSUIV1",83,0)
 ....S ^XTMP("PSU_"_PSUJOB,"PSUPICN")=PSUPICN1
"RTN","PSUIV1",84,0)
 ...I PSUPICN1[-1 S ^XTMP("PSU_"_PSUJOB,"PSUPICN")=""
"RTN","PSUIV1",85,0)
 Q
"RTN","PSUIV1",86,0)
 ;
"RTN","PSUIV1",87,0)
 ;
"RTN","PSUIV1",88,0)
OCCAMT ;Calculate the number of dispensing occurrences
"RTN","PSUIV1",89,0)
 S (PSUFND,PSUDISP,PSUPULL,OCC,PSUDISPT,PSURECT,PSUDEST,PSUCAN)=0
"RTN","PSUIV1",90,0)
 F  S OCC=$O(^PS(55,PSUPDA,"IV",PSUODA,"LAB",OCC)) Q:'OCC  D
"RTN","PSUIV1",91,0)
 .K PSUOCC
"RTN","PSUIV1",92,0)
 .D GETS^PSUTL(55.1111,"PSUPDA,PSUODA,OCC","1;2;4;6","PSUOCC","I")
"RTN","PSUIV1",93,0)
 .D MOVEI^PSUTL("PSUOCC")
"RTN","PSUIV1",94,0)
 .S PSUOCC(1)=PSUOCC(1)\1
"RTN","PSUIV1",95,0)
 .I PSUOCC(1)<PSUSDT!(PSUOCC(1)>PSUTEDT) Q  ;*34
"RTN","PSUIV1",96,0)
 .S PSUFND=1
"RTN","PSUIV1",97,0)
 .I PSUOCC(6)=1,PSUOCC(2)=1 D
"RTN","PSUIV1",98,0)
 ..S PSUDISP=PSUDISP+PSUOCC(4)
"RTN","PSUIV1",99,0)
 ..S PSUDISPT=PSUDISP                        ;Total IV dispensed
"RTN","PSUIV1",100,0)
 ..S PSUPULL=PSUPULL+PSUOCC(4)
"RTN","PSUIV1",101,0)
 ..S ^XTMP(PSUIVSUB,"TYPE_"_PSUIV(.04),PSUFAC)=PSUOCC(4)+$G(^XTMP(PSUIVSUB,"TYPE_"_PSUIV(.04),PSUFAC))
"RTN","PSUIV1",102,0)
 ..I PSUOUTP="Y" D  ; Total outpatient IV's dispensed
"RTN","PSUIV1",103,0)
 ...S ^XTMP(PSUIVSUB,"ODISP",PSUFAC)=$G(^XTMP(PSUIVSUB,"ODISP",PSUFAC))+PSUOCC(4)
"RTN","PSUIV1",104,0)
 .I (PSUOCC(2)=2)!(PSUOCC(2)=4) S PSUDISP=PSUDISP-PSUOCC(4) ;Net dispensed
"RTN","PSUIV1",105,0)
 Q
"RTN","PSUIV1",106,0)
SETTOT ;Set totals
"RTN","PSUIV1",107,0)
 ; Total number of IV's ordered
"RTN","PSUIV1",108,0)
 S ^XTMP(PSUIVSUB,"ORD",PSUFAC)=$G(^XTMP(PSUIVSUB,"ORD",PSUFAC))+1
"RTN","PSUIV1",109,0)
 ; Total number of IV patients
"RTN","PSUIV1",110,0)
 I '$D(^XTMP(PSUIVSUB,"PAT",PSUSSN,PSUFAC)) D
"RTN","PSUIV1",111,0)
 .S ^XTMP(PSUIVSUB,"SSN",PSUFAC)=$G(^XTMP(PSUIVSUB,"SSN",PSUFAC))+1
"RTN","PSUIV1",112,0)
 .S ^XTMP(PSUIVSUB,"PAT",PSUSSN,PSUFAC)=""
"RTN","PSUIV1",113,0)
 .S PSUDIV=PSUFAC D GETDIV^PSUIV3 I PSUDIVNM'="" D
"RTN","PSUIV1",114,0)
 ..S ^XTMP("PSU_"_PSUJOB,"PSUDIV",PSUDIVNM,PSUSSN)=""  ;Pt demo summary
"RTN","PSUIV1",115,0)
 .I PSUDIVNM="" S ^XTMP("PSU_"_PSUJOB,"PSUDIV",PSUDIV,PSUSSN)=""
"RTN","PSUIV1",116,0)
 I PSUOUTP="Y" D
"RTN","PSUIV1",117,0)
 .; Total outpatient IV's ordered
"RTN","PSUIV1",118,0)
 .S ^XTMP(PSUIVSUB,"OORD",PSUFAC)=$G(^XTMP(PSUIVSUB,"OORD",PSUFAC))+1
"RTN","PSUIV1",119,0)
 Q
"RTN","PSUIV1",120,0)
ADDTIV ;Loop through each additive
"RTN","PSUIV1",121,0)
 S (PSUNITS,ADTIV)=0
"RTN","PSUIV1",122,0)
 F  S ADTIV=$O(^PS(55,PSUPDA,"IV",PSUODA,"AD",ADTIV)) Q:'ADTIV  D
"RTN","PSUIV1",123,0)
 .K PSUADDTV,PSUGNRIC,PSUADD
"RTN","PSUIV1",124,0)
 .D GETS^PSUTL(55.02,"PSUPDA,PSUODA,ADTIV",".01;.02","PSUADDTV","I")
"RTN","PSUIV1",125,0)
 .D MOVEI^PSUTL("PSUADDTV")
"RTN","PSUIV1",126,0)
 .D GETS^PSUTL(52.6,"PSUADDTV(.01)",".01;1;7","PSUGNRIC","I")
"RTN","PSUIV1",127,0)
 .D MOVEI^PSUTL("PSUGNRIC")
"RTN","PSUIV1",128,0)
 .S PSUPNAM=PSUGNRIC(.01)
"RTN","PSUIV1",129,0)
 .S PSUDGU=$$VAL^PSUTL(52.6,PSUADDTV(.01),2)
"RTN","PSUIV1",130,0)
 .S PSUDGDA=PSUGNRIC(1)
"RTN","PSUIV1",131,0)
 .D GETS^PSUTL(50,"PSUDGDA",".01;2;20;21;22;25;31;51;52;3","PSUADD","I")
"RTN","PSUIV1",132,0)
 .D MOVEI^PSUTL("PSUADD")
"RTN","PSUIV1",133,0)
 .S PSUGNM=PSUADD(.01)
"RTN","PSUIV1",134,0)
 .S PSUDCLS=PSUADD(2)
"RTN","PSUIV1",135,0)
 .S PSUPRNM=PSUADD(21)
"RTN","PSUIV1",136,0)
 .S PSUNDC=PSUADD(31)
"RTN","PSUIV1",137,0)
 .S PSUNFI=PSUADD(51)
"RTN","PSUIV1",138,0)
 .S PSUNADR=PSUADD(20)
"RTN","PSUIV1",139,0)
 .S PSUNDCL=PSUADD(22)
"RTN","PSUIV1",140,0)
 .S PSUDEA=PSUADD(3)
"RTN","PSUIV1",141,0)
 .S PSUNAF=$S(PSUADD(52):"N/F",1:"")
"RTN","PSUIV1",142,0)
 .D SETVAR
"RTN","PSUIV1",143,0)
 .S PSUSTRN=+PSUADDTV(.02)
"RTN","PSUIV1",144,0)
 .;
"RTN","PSUIV1",145,0)
 .;DAM  Add AMIS Additive data
"RTN","PSUIV1",146,0)
 .N PSUTDSP1
"RTN","PSUIV1",147,0)
 .S PSUTDSP1=$G(PSUDISPT)*PSUSTRN       ;Total Additive units dispensed
"RTN","PSUIV1",148,0)
 .;
"RTN","PSUIV1",149,0)
 .N PSURCY1
"RTN","PSUIV1",150,0)
 .S PSURCY1=$G(PSURECT)*PSUSTRN         ;Total Additive units recycled
"RTN","PSUIV1",151,0)
 .;
"RTN","PSUIV1",152,0)
 .N PSUDES1
"RTN","PSUIV1",153,0)
 .S PSUDES1=$G(PSUDEST)*PSUSTRN      ;Total Additive units destroyed
"RTN","PSUIV1",154,0)
 .;
"RTN","PSUIV1",155,0)
 .N PSUCAN1
"RTN","PSUIV1",156,0)
 .S PSUCAN1=$G(PSUCAN)*PSUSTRN         ;Total Additive units cancelled
"RTN","PSUIV1",157,0)
 .;END DAM
"RTN","PSUIV1",158,0)
 .;
"RTN","PSUIV1",159,0)
 .S PSUNITS=PSUDISP*PSUSTRN
"RTN","PSUIV1",160,0)
 .S PSUBAGS=PSUPULL*PSUSTRN
"RTN","PSUIV1",161,0)
 .S PSUDCST=PSUGNRIC(7)
"RTN","PSUIV1",162,0)
 .S RECIND="A"
"RTN","PSUIV1",163,0)
 .D CALC
"RTN","PSUIV1",164,0)
 .D SETREC^PSUIV2
"RTN","PSUIV1",165,0)
 .D SETDRUG^PSUIV2
"RTN","PSUIV1",166,0)
 Q
"RTN","PSUIV1",167,0)
SOLUTN ;Loop through each solution
"RTN","PSUIV1",168,0)
 S (PSUNITS,SOLDA)=0 F  S SOLDA=$O(^PS(55,PSUPDA,"IV",PSUODA,"SOL",SOLDA)) Q:'SOLDA  D
"RTN","PSUIV1",169,0)
 .K PSUSOL,GENRIC,SOLDRUG
"RTN","PSUIV1",170,0)
 .D GETS^PSUTL(55.11,"PSUPDA,PSUODA,SOLDA",".01;1","PSUSOL","I")
"RTN","PSUIV1",171,0)
 .D MOVEI^PSUTL("PSUSOL")
"RTN","PSUIV1",172,0)
 .D GETS^PSUTL(52.7,"PSUSOL(.01)",".01;1;7","GENRIC","I")
"RTN","PSUIV1",173,0)
 .D MOVEI^PSUTL("GENRIC")
"RTN","PSUIV1",174,0)
 .S PSUPNAM=GENRIC(.01)
"RTN","PSUIV1",175,0)
 .S PSUDGU="ML"
"RTN","PSUIV1",176,0)
 .S PSUDGDA=GENRIC(1)
"RTN","PSUIV1",177,0)
 .D GETS^PSUTL(50,"PSUDGDA",".01;2;20;21;22;25;31;51;52;3","SOLDRUG","I")
"RTN","PSUIV1",178,0)
 .D MOVEI^PSUTL("SOLDRUG")
"RTN","PSUIV1",179,0)
 .S PSUGNM=SOLDRUG(.01)
"RTN","PSUIV1",180,0)
 .S PSUDCLS=SOLDRUG(2)
"RTN","PSUIV1",181,0)
 .S PSUPRNM=SOLDRUG(21)
"RTN","PSUIV1",182,0)
 .S PSUNDC=SOLDRUG(31)
"RTN","PSUIV1",183,0)
 .S PSUNFI=SOLDRUG(51)
"RTN","PSUIV1",184,0)
 .S PSUNADR=SOLDRUG(20)
"RTN","PSUIV1",185,0)
 .S PSUNDCL=SOLDRUG(22)
"RTN","PSUIV1",186,0)
 .S PSUDEA=SOLDRUG(3)
"RTN","PSUIV1",187,0)
 .S PSUNAF=$S(SOLDRUG(52):"N/F",1:"")
"RTN","PSUIV1",188,0)
 .D SETVAR
"RTN","PSUIV1",189,0)
 .S VOLUME=+PSUSOL(1)
"RTN","PSUIV1",190,0)
 .;
"RTN","PSUIV1",191,0)
 .;DAM ADD AMIS SOLUTION DATA
"RTN","PSUIV1",192,0)
 .N PSUTSOL1
"RTN","PSUIV1",193,0)
 .S PSUTSOL1=$G(PSUDISPT)*VOLUME    ;Total Solution units dispensed
"RTN","PSUIV1",194,0)
 .;
"RTN","PSUIV1",195,0)
 .N PSUTRS1
"RTN","PSUIV1",196,0)
 .S PSUTRS1=$G(PSURECT)*VOLUME       ;Total Solution units recycled
"RTN","PSUIV1",197,0)
 .;
"RTN","PSUIV1",198,0)
 .N PSUTDS1
"RTN","PSUIV1",199,0)
 .S PSUTDS1=$G(PSUDEST)*VOLUME     ;Total Solution units destroyed
"RTN","PSUIV1",200,0)
 .;
"RTN","PSUIV1",201,0)
 .N PSUTCS1
"RTN","PSUIV1",202,0)
 .S PSUTCS1=$G(PSUCAN)*VOLUME        ;Total Solution units cancelled
"RTN","PSUIV1",203,0)
 .;END DAM
"RTN","PSUIV1",204,0)
 .;
"RTN","PSUIV1",205,0)
 .S PSUNITS=PSUDISP*VOLUME
"RTN","PSUIV1",206,0)
 .S PSUBAGS=PSUPULL*VOLUME
"RTN","PSUIV1",207,0)
 .S PSUDCST=GENRIC(7)
"RTN","PSUIV1",208,0)
 .S RECIND="S"
"RTN","PSUIV1",209,0)
 .D CALC
"RTN","PSUIV1",210,0)
 .D SETREC^PSUIV2
"RTN","PSUIV1",211,0)
 .D SETDRUG^PSUIV2
"RTN","PSUIV1",212,0)
 Q
"RTN","PSUIV1",213,0)
SETVAR ;Setup common variables for IV Additives and Solutions
"RTN","PSUIV1",214,0)
 I PSUGNM="" S PSUGNM="UNKNOWN GENERIC NAME"
"RTN","PSUIV1",215,0)
 I PSUPRNM="" S PSUPRNM="UNKNOWN VA PRODUCT NAME"
"RTN","PSUIV1",216,0)
 I PSUNDC="" S PSUNDC="No NDC"
"RTN","PSUIV1",217,0)
 I PSUNFI=1 S PSUNFI="N/F"
"RTN","PSUIV1",218,0)
 S (PSIVNFI,PSIVNFR)=""
"RTN","PSUIV1",219,0)
 I $$VERSION^XPDUTL("PSN")'<4 D
"RTN","PSUIV1",220,0)
 .S PSIVNFI=$$FORMI^PSNAPIS(PSUNADR,PSUNDCL)
"RTN","PSUIV1",221,0)
 .S PSIVNFR=$$FORMR^PSNAPIS(PSUNADR,PSUNDCL)>0
"RTN","PSUIV1",222,0)
 Q
"RTN","PSUIV1",223,0)
CALC ;Do calculations for additives and solutions
"RTN","PSUIV1",224,0)
 S ^XTMP(PSUIVSUB,"CST",PSUFAC)=(PSUNITS*PSUDCST)+$G(^XTMP(PSUIVSUB,"CST",PSUFAC))
"RTN","PSUIV1",225,0)
 S RECTYP=""
"RTN","PSUIV1",226,0)
 S COUNT=COUNT+1
"RTN","PSUIV1",227,0)
 S:COUNT=1 RECTYP="P"
"RTN","PSUIV1",228,0)
 I PSUOUTP="Y" D
"RTN","PSUIV1",229,0)
 .S ^XTMP(PSUIVSUB,"OCST",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"OCST",PSUFAC))
"RTN","PSUIV1",230,0)
 I PSUIV(.04)="P" D
"RTN","PSUIV1",231,0)
 .S ^XTMP(PSUIVSUB,"SPIG",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SPIG",PSUFAC))
"RTN","PSUIV1",232,0)
 I PSUIV(.04)="A" D
"RTN","PSUIV1",233,0)
 .S ^XTMP(PSUIVSUB,"SADM",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SADM",PSUFAC))
"RTN","PSUIV1",234,0)
 I PSUIV(.04)="H" D
"RTN","PSUIV1",235,0)
 .S ^XTMP(PSUIVSUB,"SHYP",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SHYP",PSUFAC))
"RTN","PSUIV1",236,0)
 I PSUIV(.04)="S" D
"RTN","PSUIV1",237,0)
 .S ^XTMP(PSUIVSUB,"SSYR",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SSYR",PSUFAC))
"RTN","PSUIV1",238,0)
 I PSUIV(.04)="C" D
"RTN","PSUIV1",239,0)
 .S ^XTMP(PSUIVSUB,"SCHEM",PSUFAC)=(PSUDCST*PSUBAGS)+$G(^XTMP(PSUIVSUB,"SCHEM",PSUFAC))
"RTN","PSUIV1",240,0)
 Q
"RTN","PSUUD1")
0^2^B20884091
"RTN","PSUUD1",1,0)
PSUUD1 ;BIR/TJH - PBM UNIT DOSE MODULE ;12 AUG 1999
"RTN","PSUUD1",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**1,8,14,16,19,34**;Oct 15, 1998
"RTN","PSUUD1",3,0)
 ;DBIA(s)
"RTN","PSUUD1",4,0)
 ; Reference to file #55  supported by DBIA 2497
"RTN","PSUUD1",5,0)
 ; Reference to file #7   supported by DBIA 2495
"RTN","PSUUD1",6,0)
 ; Reference to file #50  supported by DBIA 221
"RTN","PSUUD1",7,0)
 ; Reference to file #42  supported by DBIA 2440
"RTN","PSUUD1",8,0)
 ; Reference to file #40.8 supported by DBIA 2438
"RTN","PSUUD1",9,0)
 ; Reference to file #200  supported by DBIA 10060
"RTN","PSUUD1",10,0)
 ; Reference to XUA4A72    supported by DBIA 1625
"RTN","PSUUD1",11,0)
 ;
"RTN","PSUUD1",12,0)
EN ; Entry point
"RTN","PSUUD1",13,0)
 ;
"RTN","PSUUD1",14,0)
 N PSUDOC1,PSUUDST
"RTN","PSUUD1",15,0)
 D SETUP^PSUUD2 ; set up various arrays, variables needed for processing
"RTN","PSUUD1",16,0)
 ;
"RTN","PSUUD1",17,0)
 ; loop thru AUD 'stop date' index
"RTN","PSUUD1",18,0)
 ; *34 |==>
"RTN","PSUUD1",19,0)
 S PSDATE=PSUSDT\1-.0001 ;use 1st date of scan for 'stop date'
"RTN","PSUUD1",20,0)
L1 S PSDATE=$O(^PS(55,"AUD",PSDATE))
"RTN","PSUUD1",21,0)
 I (PSDATE="") G STEP2
"RTN","PSUUD1",22,0)
 S PSPAT=0,PSUTEDT=PSUEDT\1+.2359
"RTN","PSUUD1",23,0)
L2 ; loop thru patient within date
"RTN","PSUUD1",24,0)
 S PSPAT=$O(^PS(55,"AUD",PSDATE,PSPAT))
"RTN","PSUUD1",25,0)
 ; <==| *34
"RTN","PSUUD1",26,0)
 G:PSPAT'?1.N L1
"RTN","PSUUD1",27,0)
 ; SCREEN OUT TEST PATIENTS
"RTN","PSUUD1",28,0)
 G:$$TESTPAT^PSUTL1(PSPAT) L2
"RTN","PSUUD1",29,0)
 S PSDOSE=0
"RTN","PSUUD1",30,0)
L3 ; loop thru unit dose entries within patient
"RTN","PSUUD1",31,0)
 S PSDOSE=$O(^PS(55,"AUD",PSDATE,PSPAT,PSDOSE))
"RTN","PSUUD1",32,0)
 G:PSDOSE'?1.N L2
"RTN","PSUUD1",33,0)
 I '$D(^PS(55,PSPAT,5,PSDOSE,11)) G L3 ;*34
"RTN","PSUUD1",34,0)
 S ^XTMP("PSU_"_PSUJOB,"PSUHLD",PSDOSE)=""
"RTN","PSUUD1",35,0)
 K PSUDOSE
"RTN","PSUUD1",36,0)
 S XX=$$VALI^PSUTL(55.06,"PSPAT,PSDOSE",10) ;*34
"RTN","PSUUD1",37,0)
 I (XX\1)>PSUTEDT G L3  ;*34
"RTN","PSUUD1",38,0)
 ;
"RTN","PSUUD1",39,0)
 D GETS^PSUTL(55.06,"PSPAT,PSDOSE",".01;.5;1;9;10;26;34;68","PSUDOSE","I")
"RTN","PSUUD1",40,0)
 D MOVEI^PSUTL("PSUDOSE")
"RTN","PSUUD1",41,0)
 ;.01=order number, .5=patient ptr, 1=provider ptr, 9=original ward
"RTN","PSUUD1",42,0)
 ;10=start date/time, 26=schedule, 34=stop date/time, 68=last ward
"RTN","PSUUD1",43,0)
 S PSUUDST=PSUDOSE(34)\1
"RTN","PSUUD1",44,0)
 S PSUDOSE(10)=$P(PSUDOSE(10),".",1)
"RTN","PSUUD1",45,0)
 S DFN=PSUDOSE(.5) D PID^VADPT
"RTN","PSUUD1",46,0)
 S PSUSSN=$TR(VA("PID"),"^-","'")
"RTN","PSUUD1",47,0)
 I $G(PSUSSN) S ^XTMP("PSU_"_PSUJOB,"PSUTDFN",DFN,PSUSSN)=""
"RTN","PSUUD1",48,0)
 S PSUFACN=PSUSNDR,PSUX=$S($L(PSUDOSE(9)):PSUDOSE(9),1:PSUDOSE(68))
"RTN","PSUUD1",49,0)
 I $L(PSUX) D
"RTN","PSUUD1",50,0)
 .S PSUX1=$$VALI^PSUTL(42,PSUX,.015)
"RTN","PSUUD1",51,0)
 .I PSUX1'="" S PSUFACN=$$VALI^PSUTL(40.8,PSUX1,1)
"RTN","PSUUD1",52,0)
PROV ; collect provider data
"RTN","PSUUD1",53,0)
 S (PSUVCL,PSUVS1,PSUVS2)=""
"RTN","PSUUD1",54,0)
 S PSUVSSN=$$VALI^PSUTL(200,PSUDOSE(1),9)
"RTN","PSUUD1",55,0)
 I PSUVSSN="" S PSUVSSN=999999999
"RTN","PSUUD1",56,0)
 S ^XTMP("PSU_"_PSUJOB,"PSUPDR",PSUVSSN,PSUDOSE(1))=""
"RTN","PSUUD1",57,0)
 S PSUDOC(9)=PSUVSSN
"RTN","PSUUD1",58,0)
 ;
"RTN","PSUUD1",59,0)
 S PSUVCP=$$VALI^PSUTL(200,PSUDOSE(1),53.5) ; class pointer
"RTN","PSUUD1",60,0)
 I PSUVCP'="" D
"RTN","PSUUD1",61,0)
 .S PSUVCL=$$VALI^PSUTL(7,PSUVCP,1)
"RTN","PSUUD1",62,0)
 .I PSUVCL="" S PSUVCL=$$VALI^PSUTL(7,PSUVCP,.01)
"RTN","PSUUD1",63,0)
 S PSUVSV=$$VAL^PSUTL(200,PSUDOSE(1),29) ; points to # 49,.01
"RTN","PSUUD1",64,0)
 S PSUVSVX=$$UPPER^PSUTL(PSUVSV),PSUVSV=""
"RTN","PSUUD1",65,0)
 I $L(PSUVSVX),$D(PSECT(PSUVSVX)) S PSUVSV=PSECT(PSUVSVX) ; convert to abbrev. if found in list.
"RTN","PSUUD1",66,0)
 S PSUSPSTR=$$GET^XUA4A72(PSUDOSE(1),PSDATE)
"RTN","PSUUD1",67,0)
 S PSUVS1=$P(PSUSPSTR,U,3),PSUVS2=$P(PSUSPSTR,U,4)
"RTN","PSUUD1",68,0)
 K PSUDAS D DISAMT^PSUUD2 ; set up dispensed amount summary array PSUDAS ;*34
"RTN","PSUUD1",69,0)
 D TMPUD^PSUUD2 ; store Unit Dose info in REC1
"RTN","PSUUD1",70,0)
DISD ; Dispense Drug 55.06,2 Mult --> 55.07 ^PS(55,PAT,5,DOSE,1,DISP,0)
"RTN","PSUUD1",71,0)
 S PSUDDX=0
"RTN","PSUUD1",72,0)
DISDL1 S PSUDDX=$O(^PS(55,PSPAT,5,PSDOSE,1,PSUDDX)) G:PSUDDX'?1.N DISDX
"RTN","PSUUD1",73,0)
 ;
"RTN","PSUUD1",74,0)
 D GETS^PSUTL(55.07,"PSPAT,PSDOSE,PSUDDX",".01;.02;.03","PSUDISD","I")
"RTN","PSUUD1",75,0)
 ; .01 = drug pointer, .02 = units per dose, .03 = inactive date
"RTN","PSUUD1",76,0)
 D MOVEI^PSUTL("PSUDISD")
"RTN","PSUUD1",77,0)
 I $G(PSUDISD(.01))="" G DISDL1 ; missing data, go back and try another
"RTN","PSUUD1",78,0)
 I $L(PSUDISD(.03)),PSUDISD(.03)<PSUSDT G DISDL1
"RTN","PSUUD1",79,0)
 ;
"RTN","PSUUD1",80,0)
 ;DAM AMIS DATA
"RTN","PSUUD1",81,0)
 S PSUDSP="",PSURET=""
"RTN","PSUUD1",82,0)
 ;AMIS Dispensed amount
"RTN","PSUUD1",83,0)
 S PSUDSP=$G(^XTMP("PSU_"_PSUJOB,"UDSP",PSUSSN,PSUDISD(.01))) D
"RTN","PSUUD1",84,0)
 .I '$G(^XTMP("PSU_"_PSUJOB,"UDSP",PSUSSN,PSUDISD(.01))) S PSUDSP=0
"RTN","PSUUD1",85,0)
 ;
"RTN","PSUUD1",86,0)
 ;AMIS Returned amount
"RTN","PSUUD1",87,0)
 S PSURET=$G(^XTMP("PSU_"_PSUJOB,"UDRET",PSUSSN,PSUDISD(.01))) D
"RTN","PSUUD1",88,0)
 .I '$G(^XTMP("PSU_"_PSUJOB,"UDRET",PSUSSN,PSUDISD(.01))) S PSURET=0
"RTN","PSUUD1",89,0)
 ;END DAM
"RTN","PSUUD1",90,0)
 ;
"RTN","PSUUD1",91,0)
 S:PSUDISD(.02)="" PSUDISD(.02)=1 ; default to 1 if not filled per Lina B.
"RTN","PSUUD1",92,0)
 D GETS^PSUTL(50,PSUDISD(.01),".01;2;14.5;16;20;21;22;25;31;51;52;3","PSUDRUG","I")
"RTN","PSUUD1",93,0)
 I '$D(PSUDRUG) F I=.01,2,14.5,16,20,21,22,25,31,51,52,3 S PSUDRUG(I,"I")=""
"RTN","PSUUD1",94,0)
 D MOVEI^PSUTL("PSUDRUG")
"RTN","PSUUD1",95,0)
 I PSUDRUG(.01)="" S PSUDRUG(.01)="Unknown Generic Name"
"RTN","PSUUD1",96,0)
 I PSUDRUG(21)="" S PSUDRUG(21)="Unknown VA Product Name"
"RTN","PSUUD1",97,0)
 I PSUDRUG(31)="" S PSUDRUG(31)="No NDC"
"RTN","PSUUD1",98,0)
 I PSUDRUG(51)=1 S PSUDRUG(51)="N/F"
"RTN","PSUUD1",99,0)
 I PSUDRUG(52) S PSUDRUG(52)="N/F"
"RTN","PSUUD1",100,0)
 S PSUDNFI="",PSUDNFR="" ; National Formulary Indicator & Restriction
"RTN","PSUUD1",101,0)
 I $$VERSION^XPDUTL("PSN")'<4 D  ; check for v.4 or greater of NDF
"RTN","PSUUD1",102,0)
 .S PSUDNFI=$$FORMI^PSNAPIS(PSUDRUG(20),PSUDRUG(22))
"RTN","PSUUD1",103,0)
 .S PSUDNFR=$$FORMR^PSNAPIS(PSUDRUG(20),PSUDRUG(22))
"RTN","PSUUD1",104,0)
 D TMPDD^PSUUD2 ; store dispense drug data in ^XTMP global
"RTN","PSUUD1",105,0)
 D LAB^PSULR0("UD",PSUFACN,PSUDOSE(.01),PSUDOSE(.5),PSUDRUG(.01),PSUDRUG(2))
"RTN","PSUUD1",106,0)
 G DISDL1
"RTN","PSUUD1",107,0)
DISDX ; end of dispense drug, go back for next one.
"RTN","PSUUD1",108,0)
 G L3
"RTN","PSUUD1",109,0)
 ;
"RTN","PSUUD1",110,0)
STEP2 ; done with data collection, go back to ^PSUUD0
"RTN","PSUUD1",111,0)
 Q
"RTN","PSUUD2")
0^3^B16496136
"RTN","PSUUD2",1,0)
PSUUD2 ;BIR/TJH - PBM UNIT DOSE SUBROUTINES & FUNCTIONS ;24 DEC 2003
"RTN","PSUUD2",2,0)
 ;;3.0;PHARMACY BENEFITS MANAGEMENT;**1,7,14,19,34**;Oct 15, 1998
"RTN","PSUUD2",3,0)
 ;DBIA(s)
"RTN","PSUUD2",4,0)
 ; Reference to file #55  supported by DBIA 2497
"RTN","PSUUD2",5,0)
 ;
"RTN","PSUUD2",6,0)
DISAMT ; precompute dispensed amounts by drug
"RTN","PSUUD2",7,0)
 N DADATE,DADRUG,DAMT,DAHOW
"RTN","PSUUD2",8,0)
 K PSUDAS ; initialize Dispensed Amount Summary array
"RTN","PSUUD2",9,0)
 ;*34 |=>
"RTN","PSUUD2",10,0)
 S PSUXX=PSUSDT\1-.0001
"RTN","PSUUD2",11,0)
DAL134 S PSUXX=$O(^PS(55,PSPAT,5,PSDOSE,11,"B",PSUXX))
"RTN","PSUUD2",12,0)
 G:'PSUXX DISAMTQ
"RTN","PSUUD2",13,0)
 I PSUXX>PSUTEDT G DISAMTQ
"RTN","PSUUD2",14,0)
 S DISPDA=0
"RTN","PSUUD2",15,0)
 F  S DISPDA=$O(^PS(55,PSPAT,5,PSDOSE,11,"B",PSUXX,DISPDA)) Q:DISPDA'>0  D
"RTN","PSUUD2",16,0)
 . K DISPI
"RTN","PSUUD2",17,0)
 . D GETS^PSUTL(55.0611,"PSPAT,PSDOSE,DISPDA",".01;.02;.03;.05","DISPI","I")
"RTN","PSUUD2",18,0)
 . D MOVEI^PSUTL("DISPI")
"RTN","PSUUD2",19,0)
 . S DADATE=DISPI(.01)
"RTN","PSUUD2",20,0)
 . S DADRUG=$G(DISPI(.02)) G:DADRUG="" DAL134
"RTN","PSUUD2",21,0)
 . S DAMT=$G(DISPI(.03))
"RTN","PSUUD2",22,0)
 . S DAHOW=$G(DISPI(.05))
"RTN","PSUUD2",23,0)
 . S PSUDAS(DADRUG)=$G(PSUDAS(DADRUG))+$S(DAHOW=4:DAMT*-1,1:DAMT)
"RTN","PSUUD2",24,0)
 . K DISPI
"RTN","PSUUD2",25,0)
 G DAL134
"RTN","PSUUD2",26,0)
 ;*34 <=|
"RTN","PSUUD2",27,0)
DISAMTQ K ^TMP($J,"PSUTA") Q  ; exit point from DISAMT subroutine
"RTN","PSUUD2",28,0)
 ;
"RTN","PSUUD2",29,0)
SETUP ; set up some variables required later
"RTN","PSUUD2",30,0)
 D SECTN^PSUTL1
"RTN","PSUUD2",31,0)
 D DT^DILF("E",PSUSDT,.EXTD)
"RTN","PSUUD2",32,0)
 S PSURP("START")=EXTD(0)
"RTN","PSUUD2",33,0)
 D DT^DILF("E",PSUEDT,.EXTD)
"RTN","PSUUD2",34,0)
 S PSURP("END")=EXTD(0)
"RTN","PSUUD2",35,0)
 S X1=PSUSDT,X2=-101
"RTN","PSUUD2",36,0)
 D C^%DTC K %,%H,%T
"RTN","PSUUD2",37,0)
 S PSDATE=X
"RTN","PSUUD2",38,0)
 S PSUEDTIM=PSUEDT+.2400
"RTN","PSUUD2",39,0)
 S PSUJOB=$G(PSUJOB,$J),PSUUDSUB="PSUUD_"_PSUJOB
"RTN","PSUUD2",40,0)
 K ^XTMP(PSUUDSUB)
"RTN","PSUUD2",41,0)
 K PSUDTLRN
"RTN","PSUUD2",42,0)
 S X1=DT,X2=3 D C^%DTC
"RTN","PSUUD2",43,0)
 S ^XTMP(PSUUDSUB,0)=X_U_DT_U_"PSU PBM UNIT DOSE STATISTICAL DATA"
"RTN","PSUUD2",44,0)
SETUPQ Q  ; exit from SETUP
"RTN","PSUUD2",45,0)
 ;
"RTN","PSUUD2",46,0)
TMPUD ; store Unit Dose data in first half of record, pieces 2-7
"RTN","PSUUD2",47,0)
 S DLM="^",REC1="^"
"RTN","PSUUD2",48,0)
 S REC1=REC1_$TR(PSUFACN,"^","'")_DLM_$TR(PSUDOSE(10),"^","'")_DLM_$TR(PSUDOSE(.01),"^","'")
"RTN","PSUUD2",49,0)
 S REC1=REC1_DLM_PSUSSN_DLM_$TR(PSUDOSE(26),"^","'")_DLM_PSUVSSN   ;_DLM_$TR(PSUVCL,"^","'")
"RTN","PSUUD2",50,0)
 ;S REC1=REC1_DLM_$TR(PSUVSV,"^","'")_DLM_$TR(PSUVS1,"^","'")_DLM_$TR(PSUVS2,"^","'")
"RTN","PSUUD2",51,0)
TMPUDQ Q  ; exit from TMPUD
"RTN","PSUUD2",52,0)
 ;
"RTN","PSUUD2",53,0)
TMPDD ; create Dispense Drug record and store in ^XTMP
"RTN","PSUUD2",54,0)
 N PSUDAMT S PSUDAMT=$G(PSUDAS(PSUDISD(.01)))
"RTN","PSUUD2",55,0)
 Q:'PSUDAMT  ; per Lina B., do not store if dispensed amount=0
"RTN","PSUUD2",56,0)
 S DLM="^",REC2="",PSUDTLRN(PSUFACN)=+$G(PSUDTLRN(PSUFACN))+1
"RTN","PSUUD2",57,0)
 S REC2=REC1_DLM_$TR(PSUDRUG(21),"^","'")_DLM_$TR(PSUDRUG(2),"^","'")_DLM
"RTN","PSUUD2",58,0)
 S REC2=REC2_$TR(PSUDRUG(.01),"^","'")_DLM_$TR(PSUDRUG(31),"^","'")_DLM
"RTN","PSUUD2",59,0)
 S REC2=REC2_PSUDRUG(51)_DLM_PSUDNFI_DLM_PSUDNFR_DLM
"RTN","PSUUD2",60,0)
 S REC2=REC2_$TR(PSUDISD(.02),"^","'")_DLM_$TR(PSUDRUG(14.5),"^","'")_DLM
"RTN","PSUUD2",61,0)
 S REC2=REC2_$TR(PSUDRUG(16),"^","'")_DLM_PSUDAMT_DLM_PSUDRUG(52)_DLM_PSUDRUG(3)_"^"
"RTN","PSUUD2",62,0)
 ;VMP OIFO BAY PINES;ELR;PSU*3.0*24
"RTN","PSUUD2",63,0)
 D ICN^PSUIV1 S PSUPICN=$G(^XTMP("PSU_"_PSUJOB,"PSUPICN"))
"RTN","PSUUD2",64,0)
 S REC2=REC2_$G(PSUPICN)_DLM_$G(PSUDOSE(1))_DLM_PSUUDST_DLM
"RTN","PSUUD2",65,0)
 ;
"RTN","PSUUD2",66,0)
 ;DAM ADD AMIS DATA
"RTN","PSUUD2",67,0)
 S REC2=REC2_PSUDSP_DLM_PSURET_DLM
"RTN","PSUUD2",68,0)
 ;END DAM
"RTN","PSUUD2",69,0)
 ;
"RTN","PSUUD2",70,0)
 S ^XTMP(PSUUDSUB,"DETAIL",PSUFACN,PSUDTLRN(PSUFACN))=REC2
"RTN","PSUUD2",71,0)
 ; increase Unit Dose and Patient counts if not already counted
"RTN","PSUUD2",72,0)
 I '$D(^XTMP(PSUUDSUB,"ORD",PSUFACN,PSUDOSE(.01))) D
"RTN","PSUUD2",73,0)
 .S ^XTMP(PSUUDSUB,"ORD",PSUFACN,PSUDOSE(.01))=""
"RTN","PSUUD2",74,0)
 .S ^XTMP(PSUUDSUB,"ORD",PSUFACN)=1+$G(^XTMP(PSUUDSUB,"ORD",PSUFACN))
"RTN","PSUUD2",75,0)
 I '$D(^XTMP(PSUUDSUB,"SSN",PSUFACN,PSUSSN)) D
"RTN","PSUUD2",76,0)
 .S ^XTMP(PSUUDSUB,"SSN",PSUFACN,PSUSSN)=""
"RTN","PSUUD2",77,0)
 .S ^XTMP(PSUUDSUB,"SSN",PSUFACN)=1+$G(^XTMP(PSUUDSUB,"SSN",PSUFACN))
"RTN","PSUUD2",78,0)
 S PSUDIV=PSUFACN D GETDIV^PSUIV3 I PSUDIVNM'="" D
"RTN","PSUUD2",79,0)
 .S ^XTMP("PSU_"_PSUJOB,"PSUDIV",PSUDIVNM,PSUSSN)=""
"RTN","PSUUD2",80,0)
 I PSUDIVNM="" S ^XTMP("PSU_"_PSUJOB,"PSUDIV",PSUDIV,PSUSSN)=""
"RTN","PSUUD2",81,0)
 ; and store totals by drug in ^TMP("PSUUD DRUG",$J,PSUFACN
"RTN","PSUUD2",82,0)
 I '$D(^XTMP(PSUUDSUB,"DRUG",PSUFACN,PSUDRUG(.01))) D
"RTN","PSUUD2",83,0)
 .S ^XTMP(PSUUDSUB,"DRUG",PSUFACN,PSUDRUG(.01))=0_U_PSUDRUG(16)_U_PSUDRUG(51)_U_PSUDNFI
"RTN","PSUUD2",84,0)
 S $P(^XTMP(PSUUDSUB,"DRUG",PSUFACN,PSUDRUG(.01)),U,1)=$P(^XTMP(PSUUDSUB,"DRUG",PSUFACN,PSUDRUG(.01)),U,1)+PSUDAMT
"RTN","PSUUD2",85,0)
 ; and store Summary totals
"RTN","PSUUD2",86,0)
 S ^XTMP(PSUUDSUB,"DIS",PSUFACN)=PSUDAMT+$G(^XTMP(PSUUDSUB,"DIS",PSUFACN))
"RTN","PSUUD2",87,0)
 S ^XTMP(PSUUDSUB,"CST",PSUFACN)=(PSUDRUG(16)*PSUDAMT)+$G(^XTMP(PSUUDSUB,"CST",PSUFACN))
"RTN","PSUUD2",88,0)
TMPDDQ Q  ; exit from TMPDD
"VER")
8.0^22.0
**END**
**END**
