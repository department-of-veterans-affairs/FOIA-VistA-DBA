Released IB*2*316 SEQ #293
Extracted from mail message
**KIDS**:IB*2.0*316^

**INSTALL NAME**
IB*2.0*316
"BLD",6024,0)
IB*2.0*316^INTEGRATED BILLING^0^3051020^y
"BLD",6024,1,0)
^^17^17^3051017^
"BLD",6024,1,1,0)
Patch attends to the following issues:
"BLD",6024,1,2,0)
 
"BLD",6024,1,3,0)
1) To help protect the users from sending out too many IIV inquiries in a 
"BLD",6024,1,4,0)
given day, the HL7 MAXIMUM NUMBER field has been modified to be a 
"BLD",6024,1,5,0)
required field.
"BLD",6024,1,6,0)
 
"BLD",6024,1,7,0)
2) To help protect the users from extracting too many IIV inquiries in a 
"BLD",6024,1,8,0)
given day for a given IIV data extract, the MAXIMUM EXTRACT NUMBER field 
"BLD",6024,1,9,0)
has been modified to be a required field.
"BLD",6024,1,10,0)
 
"BLD",6024,1,11,0)
3) Based on a decision from the VA Chief Business Office, it was decided 
"BLD",6024,1,12,0)
that the most popular payer function should be removed. Any mention of 
"BLD",6024,1,13,0)
this functionality should be eradicated from the IIV system.
"BLD",6024,1,14,0)
 
"BLD",6024,1,15,0)
4) IIV routines will automatically disable and enable journaling itself 
"BLD",6024,1,16,0)
while doing the purge. A log of purges will now be kept in global ^ 
"BLD",6024,1,17,0)
XTMP("IBCNEKIT".
"BLD",6024,4,0)
^9.64PA^350.9^1
"BLD",6024,4,350.9,0)
350.9
"BLD",6024,4,350.9,2,0)
^9.641^350.9002^2
"BLD",6024,4,350.9,2,350.9,0)
IB SITE PARAMETERS  (File-top level)
"BLD",6024,4,350.9,2,350.9,1,0)
^9.6411^51.15^1
"BLD",6024,4,350.9,2,350.9,1,51.15,0)
HL7 MAXIMUM NUMBER
"BLD",6024,4,350.9,2,350.9002,0)
BATCH EXTRACTS  (sub-file)
"BLD",6024,4,350.9,2,350.9002,1,0)
^9.6411^.05^1
"BLD",6024,4,350.9,2,350.9002,1,.05,0)
MAXIMUM EXTRACT NUMBER
"BLD",6024,4,350.9,222)
y^n^p^^^^n^^n
"BLD",6024,4,350.9,224)

"BLD",6024,4,"APDD",350.9,350.9)

"BLD",6024,4,"APDD",350.9,350.9,51.15)

"BLD",6024,4,"APDD",350.9,350.9002)

"BLD",6024,4,"APDD",350.9,350.9002,.05)

"BLD",6024,4,"B",350.9,350.9)

"BLD",6024,"ABPKG")
n
"BLD",6024,"INIT")
IBY316PS
"BLD",6024,"KRN",0)
^9.67PA^8989.52^19
"BLD",6024,"KRN",.4,0)
.4
"BLD",6024,"KRN",.401,0)
.401
"BLD",6024,"KRN",.402,0)
.402
"BLD",6024,"KRN",.403,0)
.403
"BLD",6024,"KRN",.5,0)
.5
"BLD",6024,"KRN",.84,0)
.84
"BLD",6024,"KRN",3.6,0)
3.6
"BLD",6024,"KRN",3.8,0)
3.8
"BLD",6024,"KRN",9.2,0)
9.2
"BLD",6024,"KRN",9.8,0)
9.8
"BLD",6024,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",6024,"KRN",9.8,"NM",1,0)
IBCNEKIT^^0^B77702012
"BLD",6024,"KRN",9.8,"NM",2,0)
IBCNEKI2^^0^B9265324
"BLD",6024,"KRN",9.8,"NM",3,0)
IBJPM^^0^B11055331
"BLD",6024,"KRN",9.8,"NM",4,0)
IBJPI^^0^B59509234
"BLD",6024,"KRN",9.8,"NM",5,0)
IBJPI2^^0^B18769415
"BLD",6024,"KRN",9.8,"NM","B","IBCNEKI2",2)

"BLD",6024,"KRN",9.8,"NM","B","IBCNEKIT",1)

"BLD",6024,"KRN",9.8,"NM","B","IBJPI",4)

"BLD",6024,"KRN",9.8,"NM","B","IBJPI2",5)

"BLD",6024,"KRN",9.8,"NM","B","IBJPM",3)

"BLD",6024,"KRN",19,0)
19
"BLD",6024,"KRN",19,"NM",0)
^9.68A^^
"BLD",6024,"KRN",19.1,0)
19.1
"BLD",6024,"KRN",101,0)
101
"BLD",6024,"KRN",101,"NM",0)
^9.68A^5^5
"BLD",6024,"KRN",101,"NM",1,0)
IBJP INS VER MENU^^0
"BLD",6024,"KRN",101,"NM",2,0)
IBJP IIV BATCH EXTRACT EDIT^^4^
"BLD",6024,"KRN",101,"NM",3,0)
IBJP IIV GENERAL EDIT^^4^
"BLD",6024,"KRN",101,"NM",4,0)
IBJP IIV PAT W/O INS^^4^
"BLD",6024,"KRN",101,"NM",5,0)
IBJ EXIT^^4^
"BLD",6024,"KRN",101,"NM","B","IBJ EXIT",5)

"BLD",6024,"KRN",101,"NM","B","IBJP IIV BATCH EXTRACT EDIT",2)

"BLD",6024,"KRN",101,"NM","B","IBJP IIV GENERAL EDIT",3)

"BLD",6024,"KRN",101,"NM","B","IBJP IIV PAT W/O INS",4)

"BLD",6024,"KRN",101,"NM","B","IBJP INS VER MENU",1)

"BLD",6024,"KRN",409.61,0)
409.61
"BLD",6024,"KRN",771,0)
771
"BLD",6024,"KRN",870,0)
870
"BLD",6024,"KRN",8989.51,0)
8989.51
"BLD",6024,"KRN",8989.52,0)
8989.52
"BLD",6024,"KRN",8994,0)
8994
"BLD",6024,"KRN","B",.4,.4)

"BLD",6024,"KRN","B",.401,.401)

"BLD",6024,"KRN","B",.402,.402)

"BLD",6024,"KRN","B",.403,.403)

"BLD",6024,"KRN","B",.5,.5)

"BLD",6024,"KRN","B",.84,.84)

"BLD",6024,"KRN","B",3.6,3.6)

"BLD",6024,"KRN","B",3.8,3.8)

"BLD",6024,"KRN","B",9.2,9.2)

"BLD",6024,"KRN","B",9.8,9.8)

"BLD",6024,"KRN","B",19,19)

"BLD",6024,"KRN","B",19.1,19.1)

"BLD",6024,"KRN","B",101,101)

"BLD",6024,"KRN","B",409.61,409.61)

"BLD",6024,"KRN","B",771,771)

"BLD",6024,"KRN","B",870,870)

"BLD",6024,"KRN","B",8989.51,8989.51)

"BLD",6024,"KRN","B",8989.52,8989.52)

"BLD",6024,"KRN","B",8994,8994)

"BLD",6024,"QUES",0)
^9.62^^
"BLD",6024,"REQB",0)
^9.611^1^1
"BLD",6024,"REQB",1,0)
IB*2.0*271^2
"BLD",6024,"REQB","B","IB*2.0*271",1)

"FIA",350.9)
IB SITE PARAMETERS
"FIA",350.9,0)
^IBE(350.9,
"FIA",350.9,0,0)
350.9I
"FIA",350.9,0,1)
y^n^p^^^^n^^n
"FIA",350.9,0,10)

"FIA",350.9,0,11)

"FIA",350.9,0,"RLRO")

"FIA",350.9,0,"VR")
2.0^IB
"FIA",350.9,350.9)
1
"FIA",350.9,350.9,51.15)

"FIA",350.9,350.9002)
1
"FIA",350.9,350.9002,.05)

"INIT")
IBY316PS
"KRN",101,3045,-1)
4^5
"KRN",101,3045,0)
IBJ EXIT
"KRN",101,5453,-1)
4^2
"KRN",101,5453,0)
IBJP IIV BATCH EXTRACT EDIT
"KRN",101,5455,-1)
4^3
"KRN",101,5455,0)
IBJP IIV GENERAL EDIT
"KRN",101,5456,-1)
4^4
"KRN",101,5456,0)
IBJP IIV PAT W/O INS
"KRN",101,5457,-1)
0^1
"KRN",101,5457,0)
IBJP INS VER MENU^Insurance Verification Menu^^M^^^^^^^^INTEGRATED BILLING
"KRN",101,5457,4)
26^4
"KRN",101,5457,10,0)
^101.01PA^5^4
"KRN",101,5457,10,1,0)
5453^BE^2^
"KRN",101,5457,10,1,"^")
IBJP IIV BATCH EXTRACT EDIT
"KRN",101,5457,10,3,0)
5455^GP^1^
"KRN",101,5457,10,3,"^")
IBJP IIV GENERAL EDIT
"KRN",101,5457,10,4,0)
5456^PW^3^
"KRN",101,5457,10,4,"^")
IBJP IIV PAT W/O INS
"KRN",101,5457,10,5,0)
3045^EX^5^
"KRN",101,5457,10,5,"^")
IBJ EXIT
"KRN",101,5457,15)
I $G(IBFASTXT) S VALMBCK="Q"
"KRN",101,5457,20)
K IBFASTXT
"KRN",101,5457,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"^"),24)) ^(24)
"KRN",101,5457,26)
D SHOW^VALM
"KRN",101,5457,28)
Select Action: 
"KRN",101,5457,99)
60129,66372
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",179,-1)
1^1
"PKG",179,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",179,20,0)
^9.402P^1^1
"PKG",179,20,1,0)
2^^IBAXDR
"PKG",179,20,1,1)

"PKG",179,20,"B",2,1)

"PKG",179,22,0)
^9.49I^1^1
"PKG",179,22,1,0)
2.0^2940321^2940528
"PKG",179,22,1,"PAH",1,0)
316^3051020
"PKG",179,22,1,"PAH",1,1,0)
^^17^17^3051020
"PKG",179,22,1,"PAH",1,1,1,0)
Patch attends to the following issues:
"PKG",179,22,1,"PAH",1,1,2,0)
 
"PKG",179,22,1,"PAH",1,1,3,0)
1) To help protect the users from sending out too many IIV inquiries in a 
"PKG",179,22,1,"PAH",1,1,4,0)
given day, the HL7 MAXIMUM NUMBER field has been modified to be a 
"PKG",179,22,1,"PAH",1,1,5,0)
required field.
"PKG",179,22,1,"PAH",1,1,6,0)
 
"PKG",179,22,1,"PAH",1,1,7,0)
2) To help protect the users from extracting too many IIV inquiries in a 
"PKG",179,22,1,"PAH",1,1,8,0)
given day for a given IIV data extract, the MAXIMUM EXTRACT NUMBER field 
"PKG",179,22,1,"PAH",1,1,9,0)
has been modified to be a required field.
"PKG",179,22,1,"PAH",1,1,10,0)
 
"PKG",179,22,1,"PAH",1,1,11,0)
3) Based on a decision from the VA Chief Business Office, it was decided 
"PKG",179,22,1,"PAH",1,1,12,0)
that the most popular payer function should be removed. Any mention of 
"PKG",179,22,1,"PAH",1,1,13,0)
this functionality should be eradicated from the IIV system.
"PKG",179,22,1,"PAH",1,1,14,0)
 
"PKG",179,22,1,"PAH",1,1,15,0)
4) IIV routines will automatically disable and enable journaling itself 
"PKG",179,22,1,"PAH",1,1,16,0)
while doing the purge. A log of purges will now be kept in global ^ 
"PKG",179,22,1,"PAH",1,1,17,0)
XTMP("IBCNEKIT".
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","IBCNEKI2")
0^2^B9265324
"RTN","IBCNEKI2",1,0)
IBCNEKI2 ;DAOU/BHS - PURGE IIV DATA FILES CONT'D ;11-JUL-2002
"RTN","IBCNEKI2",2,0)
 ;;2.0;INTEGRATED BILLING;**271,316**;21-MAR-94
"RTN","IBCNEKI2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNEKI2",4,0)
 ;
"RTN","IBCNEKI2",5,0)
 ; This routine holds additional procedures for purging the IIV data
"RTN","IBCNEKI2",6,0)
 ; from the Trans Queue file (365.1) and the Response file (365).
"RTN","IBCNEKI2",7,0)
 ;
"RTN","IBCNEKI2",8,0)
 ; ---------------------------------------------------
"RTN","IBCNEKI2",9,0)
MMPURGE ; This procedure is responsible for the creation and
"RTN","IBCNEKI2",10,0)
 ; sending of the MailMan message on the first day of the month
"RTN","IBCNEKI2",11,0)
 ; if the site has data eligible to be purged and if the mail group is
"RTN","IBCNEKI2",12,0)
 ; defined appropriately in the IIV site parameters.
"RTN","IBCNEKI2",13,0)
 ;
"RTN","IBCNEKI2",14,0)
 ; Identify records eligible to be purged
"RTN","IBCNEKI2",15,0)
 NEW ENDDT,STATLIST,DATE,TQIEN,TOTTQ,PURTQ,TQS
"RTN","IBCNEKI2",16,0)
 NEW HLIEN,RPIEN,RPS,TOTRP,PURRP,MSG,MGRP
"RTN","IBCNEKI2",17,0)
 ;
"RTN","IBCNEKI2",18,0)
 ; default end date, Today minus 182 days (approx 6 months)
"RTN","IBCNEKI2",19,0)
 S ENDDT=$$FMADD^XLFDT(DT,-182)
"RTN","IBCNEKI2",20,0)
 S (TOTTQ,PURTQ,TOTRP,PURRP)=0
"RTN","IBCNEKI2",21,0)
 ;
"RTN","IBCNEKI2",22,0)
 ; This is the list of statuses that are OK to purge
"RTN","IBCNEKI2",23,0)
 ;   3=Response Received
"RTN","IBCNEKI2",24,0)
 ;   5=Communication Failure
"RTN","IBCNEKI2",25,0)
 ;   7=Cancelled
"RTN","IBCNEKI2",26,0)
 S STATLIST=",3,5,7,"
"RTN","IBCNEKI2",27,0)
 ;
"RTN","IBCNEKI2",28,0)
 S DATE=""
"RTN","IBCNEKI2",29,0)
 F  S DATE=$O(^IBCN(365.1,"AE",DATE)) Q:'DATE  S TQIEN=0 F  S TQIEN=$O(^IBCN(365.1,"AE",DATE,TQIEN)) Q:'TQIEN  S TOTTQ=TOTTQ+1 I $P(DATE,".")'>ENDDT D
"RTN","IBCNEKI2",30,0)
 . S TQS=$P($G(^IBCN(365.1,TQIEN,0)),U,4)    ; status
"RTN","IBCNEKI2",31,0)
 . I '$F(STATLIST,","_TQS_",") Q
"RTN","IBCNEKI2",32,0)
 . S PURTQ=PURTQ+1
"RTN","IBCNEKI2",33,0)
 . ; Loop thru responses to count them, too
"RTN","IBCNEKI2",34,0)
 . S HLIEN=0
"RTN","IBCNEKI2",35,0)
 . F  S HLIEN=$O(^IBCN(365.1,TQIEN,2,HLIEN)) Q:'HLIEN  D
"RTN","IBCNEKI2",36,0)
 . .  I $P($G(^IBCN(365.1,TQIEN,2,HLIEN,0)),U,3) S PURRP=PURRP+1
"RTN","IBCNEKI2",37,0)
 ;
"RTN","IBCNEKI2",38,0)
 S DATE=""
"RTN","IBCNEKI2",39,0)
 F  S DATE=$O(^IBCN(365,"AE",DATE)) Q:'DATE  S RPIEN=0 F  S RPIEN=$O(^IBCN(365,"AE",DATE,RPIEN)) Q:'RPIEN  S TOTRP=TOTRP+1 I $P(DATE,".")'>ENDDT D
"RTN","IBCNEKI2",40,0)
 . I $P($G(^IBCN(365,RPIEN,0)),U,5) Q    ; include only unsolicited
"RTN","IBCNEKI2",41,0)
 . S PURRP=PURRP+1
"RTN","IBCNEKI2",42,0)
 ;
"RTN","IBCNEKI2",43,0)
 ; Do not send message if no records are eligible
"RTN","IBCNEKI2",44,0)
 I 'PURTQ,'PURRP G MMPURGX
"RTN","IBCNEKI2",45,0)
 ;
"RTN","IBCNEKI2",46,0)
 ; Send a MailMan message with Eligible Purge counts
"RTN","IBCNEKI2",47,0)
 S MSG(1)="ATTENTION IRM:  There are IIV TRANSMISSION QUEUE and"
"RTN","IBCNEKI2",48,0)
 S MSG(2)="IIV RESPONSE records eligible to be purged."
"RTN","IBCNEKI2",49,0)
 S MSG(3)=""
"RTN","IBCNEKI2",50,0)
 S MSG(4)="File                                  Eligible   Total  "
"RTN","IBCNEKI2",51,0)
 S MSG(5)="                                       Count     Count  "
"RTN","IBCNEKI2",52,0)
 S MSG(6)="------------------------------------  --------  --------"
"RTN","IBCNEKI2",53,0)
 S MSG(7)="IIV RESPONSE FILE (#365)              "_$J(PURRP,8)_"  "_$J(TOTRP,8)
"RTN","IBCNEKI2",54,0)
 S MSG(8)="IIV TRANSMISSION QUEUE FILE (#365.1)  "_$J(PURTQ,8)_"  "_$J(TOTTQ,8)
"RTN","IBCNEKI2",55,0)
 S MSG(9)="====================================  ========  ========"
"RTN","IBCNEKI2",56,0)
 S MSG(10)="Total                                 "_$J(PURTQ+PURRP,8)_"  "_$J(TOTTQ+TOTRP,8)
"RTN","IBCNEKI2",57,0)
 S MSG(11)=""
"RTN","IBCNEKI2",58,0)
 S MSG(12)="Please run option IBCNE PURGE IIV DATA - Purge IIV Transactions,"
"RTN","IBCNEKI2",59,0)
 S MSG(13)="if you would like to purge the eligible records."
"RTN","IBCNEKI2",60,0)
 ; Set to IB site parameter MAILGROUP
"RTN","IBCNEKI2",61,0)
 S MGRP=$$MGRP^IBCNEUT5()
"RTN","IBCNEKI2",62,0)
 D MSG^IBCNEUT5(MGRP,"IIV Data Eligible for Purge","MSG(")
"RTN","IBCNEKI2",63,0)
 ;
"RTN","IBCNEKI2",64,0)
MMPURGX ;
"RTN","IBCNEKI2",65,0)
 Q
"RTN","IBCNEKI2",66,0)
 ;
"RTN","IBCNEKIT")
0^1^B77702012
"RTN","IBCNEKIT",1,0)
IBCNEKIT ;DAOU/ESG - PURGE IIV DATA FILES ;11-JUL-2002
"RTN","IBCNEKIT",2,0)
 ;;2.0;INTEGRATED BILLING;**184,271,316**;21-MAR-94
"RTN","IBCNEKIT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCNEKIT",4,0)
 ;
"RTN","IBCNEKIT",5,0)
 ; This routine handles the purging of the IIV data stored in the
"RTN","IBCNEKIT",6,0)
 ; IIV Transmission Queue file (#365.1) and in the IIV Response file (#365).
"RTN","IBCNEKIT",7,0)
 ; User can pick a date range for the purge.  Data created within 6 months
"RTN","IBCNEKIT",8,0)
 ; cannot be purged.  The actual global kills are done by a background
"RTN","IBCNEKIT",9,0)
 ; task after hours (8:00pm).
"RTN","IBCNEKIT",10,0)
 ;
"RTN","IBCNEKIT",11,0)
EN ;
"RTN","IBCNEKIT",12,0)
 NEW STOP,BEGDT,ENDDT,STATLIST
"RTN","IBCNEKIT",13,0)
 D INIT I STOP G EXIT       ; initialize/calculate default dates
"RTN","IBCNEKIT",14,0)
 D BEGDT I STOP G EXIT      ; user interface for beginning date
"RTN","IBCNEKIT",15,0)
 D ENDDT I STOP G EXIT      ; user interface for ending date
"RTN","IBCNEKIT",16,0)
 D CONFIRM I STOP G EXIT    ; confirmation message/final check
"RTN","IBCNEKIT",17,0)
 D QUEUE                    ; queuing process
"RTN","IBCNEKIT",18,0)
EXIT ;
"RTN","IBCNEKIT",19,0)
 Q
"RTN","IBCNEKIT",20,0)
 ;
"RTN","IBCNEKIT",21,0)
PURGE ; This procedure is queued to run in the background and does the
"RTN","IBCNEKIT",22,0)
 ; actual purging.  Variables available from the TaskMan call are:
"RTN","IBCNEKIT",23,0)
 ;
"RTN","IBCNEKIT",24,0)
 ; STATLIST = list of statuses that are OK to purge
"RTN","IBCNEKIT",25,0)
 ;    BEGDT = beginning date for purging
"RTN","IBCNEKIT",26,0)
 ;    ENDDT = ending date for purging
"RTN","IBCNEKIT",27,0)
 ;
"RTN","IBCNEKIT",28,0)
 N NOW,CACHE
"RTN","IBCNEKIT",29,0)
 S NOW=$$NOW^XLFDT
"RTN","IBCNEKIT",30,0)
 ;
"RTN","IBCNEKIT",31,0)
 ; Check to see if O/C is Cache, if so then cache specific journal code can be used to
"RTN","IBCNEKIT",32,0)
 ; enable/disable/enable journaling
"RTN","IBCNEKIT",33,0)
 S CACHE=0
"RTN","IBCNEKIT",34,0)
 I $P(^%ZOSF("OS"),U)="OpenM-NT" S CACHE=1
"RTN","IBCNEKIT",35,0)
 ;
"RTN","IBCNEKIT",36,0)
 ; Retain ^XTMP for seven days
"RTN","IBCNEKIT",37,0)
 I '$D(^XTMP("IBCNEKIT")) S ^XTMP("IBCNEKIT",0)=U_NOW_U_"Journaling status"
"RTN","IBCNEKIT",38,0)
 S $P(^XTMP("IBCNEKIT",0),U)=$$FMADD^XLFDT(NOW,7)
"RTN","IBCNEKIT",39,0)
 ;
"RTN","IBCNEKIT",40,0)
 I 'CACHE D
"RTN","IBCNEKIT",41,0)
 . S ^XTMP("IBCNEKIT",NOW,"STEP 1: NO ACTION")="An O/S conflict prevents journaling from disabling."
"RTN","IBCNEKIT",42,0)
 E  D
"RTN","IBCNEKIT",43,0)
 . ; Set error trap and disable journaling for this one process
"RTN","IBCNEKIT",44,0)
 . NEW $ETRAP,$ESTACK,STATUS
"RTN","IBCNEKIT",45,0)
 . S $ETRAP="D TRAP^IBCNEKIT"
"RTN","IBCNEKIT",46,0)
 . S STATUS=$$CURRENT^%NOJRN
"RTN","IBCNEKIT",47,0)
 . S STATUS=$S(STATUS=1:"Enabled",1:"Disabled")
"RTN","IBCNEKIT",48,0)
 . S ^XTMP("IBCNEKIT",NOW,"STEP 1: START")="Journaling for this process is "_STATUS_U_$$NOW^XLFDT
"RTN","IBCNEKIT",49,0)
 . ;
"RTN","IBCNEKIT",50,0)
 . D DISABLE^%NOJRN
"RTN","IBCNEKIT",51,0)
 . S STATUS=$$CURRENT^%NOJRN
"RTN","IBCNEKIT",52,0)
 . S STATUS=$S(STATUS=1:"Enabled",1:"Disabled")
"RTN","IBCNEKIT",53,0)
 . S ^XTMP("IBCNEKIT",NOW,"STEP 2: DISABLE")="Journaling for this process is "_STATUS_U_$$NOW^XLFDT
"RTN","IBCNEKIT",54,0)
 ;
"RTN","IBCNEKIT",55,0)
 ;
"RTN","IBCNEKIT",56,0)
 ; First loop through the IIV Transmission Queue file and delete all
"RTN","IBCNEKIT",57,0)
 ; records in the date range whose status is in the list
"RTN","IBCNEKIT",58,0)
 ;
"RTN","IBCNEKIT",59,0)
 NEW DATE,TQIEN,TQS,HLIEN,DIK,DA,CNT
"RTN","IBCNEKIT",60,0)
 S DATE=$O(^IBCN(365.1,"AE",BEGDT),-1),CNT=0
"RTN","IBCNEKIT",61,0)
 F  S DATE=$O(^IBCN(365.1,"AE",DATE)) Q:'DATE!($P(DATE,".",1)>ENDDT)!$G(ZTSTOP)  S TQIEN=0 F  S TQIEN=$O(^IBCN(365.1,"AE",DATE,TQIEN)) Q:'TQIEN  D  Q:$G(ZTSTOP)
"RTN","IBCNEKIT",62,0)
 . S CNT=CNT+1
"RTN","IBCNEKIT",63,0)
 . I $D(ZTQUEUED),CNT#100=0,$$S^%ZTLOAD() S ZTSTOP=1 Q
"RTN","IBCNEKIT",64,0)
 . S TQS=$P($G(^IBCN(365.1,TQIEN,0)),U,4)    ; trans queue status
"RTN","IBCNEKIT",65,0)
 . I '$F(STATLIST,","_TQS_",") Q             ; must be in the list
"RTN","IBCNEKIT",66,0)
 . ;
"RTN","IBCNEKIT",67,0)
 . ; loop through the HL7 messages multiple and kill any response
"RTN","IBCNEKIT",68,0)
 . ; records that are found for this transmission queue entry
"RTN","IBCNEKIT",69,0)
 . S HLIEN=0,DIK="^IBCN(365,"
"RTN","IBCNEKIT",70,0)
 . F  S HLIEN=$O(^IBCN(365.1,TQIEN,2,HLIEN)) Q:'HLIEN  D
"RTN","IBCNEKIT",71,0)
 .. S DA=$P($G(^IBCN(365.1,TQIEN,2,HLIEN,0)),U,3) I DA D ^DIK
"RTN","IBCNEKIT",72,0)
 .. Q
"RTN","IBCNEKIT",73,0)
 . ;
"RTN","IBCNEKIT",74,0)
 . ; now we can kill the transmission queue entry itself
"RTN","IBCNEKIT",75,0)
 . S DA=TQIEN,DIK="^IBCN(365.1," D ^DIK
"RTN","IBCNEKIT",76,0)
 . Q
"RTN","IBCNEKIT",77,0)
 ;
"RTN","IBCNEKIT",78,0)
 ; Check for a stop request
"RTN","IBCNEKIT",79,0)
 I $G(ZTSTOP) G PURGEX
"RTN","IBCNEKIT",80,0)
 ;
"RTN","IBCNEKIT",81,0)
 ; Now we must loop through the IIV Response file itself to purge any
"RTN","IBCNEKIT",82,0)
 ; response records that do not have a corresponding transmission
"RTN","IBCNEKIT",83,0)
 ; queue entry.  These are the unsolicited responses.  The status of
"RTN","IBCNEKIT",84,0)
 ; these responses is always 'response received' so we don't need to
"RTN","IBCNEKIT",85,0)
 ; check the status. For this loop, start from the very beginning of
"RTN","IBCNEKIT",86,0)
 ; the file.
"RTN","IBCNEKIT",87,0)
 ;
"RTN","IBCNEKIT",88,0)
 S DATE="",DIK="^IBCN(365,",CNT=0
"RTN","IBCNEKIT",89,0)
 F  S DATE=$O(^IBCN(365,"AE",DATE)) Q:'DATE!($P(DATE,".",1)>ENDDT)!$G(ZTSTOP)  S DA=0 F  S DA=$O(^IBCN(365,"AE",DATE,DA)) Q:'DA  D  Q:$G(ZTSTOP)
"RTN","IBCNEKIT",90,0)
 . S CNT=CNT+1
"RTN","IBCNEKIT",91,0)
 . I $D(ZTQUEUED),CNT#100=0,$$S^%ZTLOAD() S ZTSTOP=1 Q
"RTN","IBCNEKIT",92,0)
 . ;
"RTN","IBCNEKIT",93,0)
 . ; If there is a pointer to the transmission queue file, then we
"RTN","IBCNEKIT",94,0)
 . ; should get out of this loop because the purpose of this section
"RTN","IBCNEKIT",95,0)
 . ; is to purge those responses with no link to the transmission
"RTN","IBCNEKIT",96,0)
 . ; queue file.
"RTN","IBCNEKIT",97,0)
 . ;
"RTN","IBCNEKIT",98,0)
 . I $P($G(^IBCN(365,DA,0)),U,5) Q
"RTN","IBCNEKIT",99,0)
 . D ^DIK
"RTN","IBCNEKIT",100,0)
 . Q
"RTN","IBCNEKIT",101,0)
PURGEX ;
"RTN","IBCNEKIT",102,0)
 ; Turn journaling back on
"RTN","IBCNEKIT",103,0)
 I CACHE D
"RTN","IBCNEKIT",104,0)
 . D ENABLE^%NOJRN
"RTN","IBCNEKIT",105,0)
 . S STATUS=$$CURRENT^%NOJRN
"RTN","IBCNEKIT",106,0)
 . S STATUS=$S(STATUS=1:"Enabled",1:"Disabled")
"RTN","IBCNEKIT",107,0)
 . S ^XTMP("IBCNEKIT",NOW,"STEP 3: COMPLETED")="Journaling for this process is "_STATUS_U_$$NOW^XLFDT
"RTN","IBCNEKIT",108,0)
 ; Tell TaskManager to delete the task's record
"RTN","IBCNEKIT",109,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBCNEKIT",110,0)
 Q
"RTN","IBCNEKIT",111,0)
 ;
"RTN","IBCNEKIT",112,0)
TRAP ;
"RTN","IBCNEKIT",113,0)
 ; Error trap code for Purge^IBCNEKIT that was called by TaskMan
"RTN","IBCNEKIT",114,0)
 ; Re-Enable journaling before quitting this routine
"RTN","IBCNEKIT",115,0)
 ;
"RTN","IBCNEKIT",116,0)
 D ENABLE^%NOJRN
"RTN","IBCNEKIT",117,0)
 S STATUS=$$CURRENT^%NOJRN
"RTN","IBCNEKIT",118,0)
 S STATUS=$S(STATUS=1:"Enabled",1:"Disabled")
"RTN","IBCNEKIT",119,0)
 S ^XTMP("IBCNEKIT",NOW,"STEP 3: ABORTED")="Journaling for this process is "_STATUS_U_$$NOW^XLFDT
"RTN","IBCNEKIT",120,0)
 D ^%ZTER
"RTN","IBCNEKIT",121,0)
 D UNWIND^%ZTER
"RTN","IBCNEKIT",122,0)
 Q
"RTN","IBCNEKIT",123,0)
 ;
"RTN","IBCNEKIT",124,0)
INIT ; This procedure calculates the default beginning and ending dates
"RTN","IBCNEKIT",125,0)
 ; and displays screen messages about this option to the user.
"RTN","IBCNEKIT",126,0)
 ;
"RTN","IBCNEKIT",127,0)
 NEW DATE,FOUND,TQIEN,TQS,RPIEN,RPS
"RTN","IBCNEKIT",128,0)
 NEW DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCNEKIT",129,0)
 ;
"RTN","IBCNEKIT",130,0)
 S STOP=0
"RTN","IBCNEKIT",131,0)
 ;
"RTN","IBCNEKIT",132,0)
 ; This is the list of statuses that are OK to purge
"RTN","IBCNEKIT",133,0)
 ;   3=Response Received
"RTN","IBCNEKIT",134,0)
 ;   5=Communication Failure
"RTN","IBCNEKIT",135,0)
 ;   7=Cancelled
"RTN","IBCNEKIT",136,0)
 S STATLIST=",3,5,7,"
"RTN","IBCNEKIT",137,0)
 ;
"RTN","IBCNEKIT",138,0)
 ; Try to find a beginning date in the IIV Transmission Queue file
"RTN","IBCNEKIT",139,0)
 S DATE="",FOUND=0,BEGDT=DT
"RTN","IBCNEKIT",140,0)
 F  S DATE=$O(^IBCN(365.1,"AE",DATE)) Q:'DATE!FOUND  S TQIEN=0 F  S TQIEN=$O(^IBCN(365.1,"AE",DATE,TQIEN)) Q:'TQIEN  D  Q:FOUND
"RTN","IBCNEKIT",141,0)
 . S TQS=$P($G(^IBCN(365.1,TQIEN,0)),U,4)    ; status
"RTN","IBCNEKIT",142,0)
 . I '$F(STATLIST,","_TQS_",") Q
"RTN","IBCNEKIT",143,0)
 . S FOUND=1
"RTN","IBCNEKIT",144,0)
 . S BEGDT=$P(DATE,".",1)
"RTN","IBCNEKIT",145,0)
 . Q
"RTN","IBCNEKIT",146,0)
 ;
"RTN","IBCNEKIT",147,0)
 ; If not successful, try to find a beginning date in the IIV Response file.
"RTN","IBCNEKIT",148,0)
 I 'FOUND D
"RTN","IBCNEKIT",149,0)
 . S DATE=""
"RTN","IBCNEKIT",150,0)
 . F  S DATE=$O(^IBCN(365,"AE",DATE)) Q:'DATE!FOUND  S RPIEN=0 F  S RPIEN=$O(^IBCN(365,"AE",DATE,RPIEN)) Q:'RPIEN  D  Q:FOUND
"RTN","IBCNEKIT",151,0)
 .. S RPS=$P($G(^IBCN(365,RPIEN,0)),U,6)    ; status
"RTN","IBCNEKIT",152,0)
 .. I '$F(STATLIST,","_RPS_",") Q
"RTN","IBCNEKIT",153,0)
 .. S FOUND=1
"RTN","IBCNEKIT",154,0)
 .. S BEGDT=$P(DATE,".",1)
"RTN","IBCNEKIT",155,0)
 .. Q
"RTN","IBCNEKIT",156,0)
 . Q
"RTN","IBCNEKIT",157,0)
 ;
"RTN","IBCNEKIT",158,0)
 ; default end date, Today minus 182 days (approx 6 months)
"RTN","IBCNEKIT",159,0)
 S ENDDT=$$FMADD^XLFDT(DT,-182)
"RTN","IBCNEKIT",160,0)
 ;
"RTN","IBCNEKIT",161,0)
 I 'FOUND!(BEGDT>ENDDT) D  S STOP=1 G INITX
"RTN","IBCNEKIT",162,0)
 . W !!?5,"Purging of IIV data is not possible at this time."
"RTN","IBCNEKIT",163,0)
 . I 'FOUND W !?5,"There are no entries in the file that are eligible to be",!?5,"purged or there is no data in the file."
"RTN","IBCNEKIT",164,0)
 . E  W !?5,"The oldest date in the file is ",$$FMTE^XLFDT(BEGDT,"5Z"),".",!?5,"Data cannot be purged unless it is at least 6 months old."
"RTN","IBCNEKIT",165,0)
 . W ! S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNEKIT",166,0)
 . Q
"RTN","IBCNEKIT",167,0)
 ;
"RTN","IBCNEKIT",168,0)
 ; At this point, we know that there are some entries eligible for
"RTN","IBCNEKIT",169,0)
 ; purging.  Display a message to the user about this option.
"RTN","IBCNEKIT",170,0)
 W @IOF
"RTN","IBCNEKIT",171,0)
 W !?3,"Purge Electronic Insurance Identification and Verification (IIV) Data Files"
"RTN","IBCNEKIT",172,0)
 W !!!," This option will allow you to purge data from the IIV Response File (#365)"
"RTN","IBCNEKIT",173,0)
 W !," and the IIV Transmission Queue File (#365.1).  The data must be at least six"
"RTN","IBCNEKIT",174,0)
 W !," months old before it can be purged.  Only insurance transactions that have a"
"RTN","IBCNEKIT",175,0)
 W !," transmission status of ""Response Received"", ""Communication Failure"", or"
"RTN","IBCNEKIT",176,0)
 W !," ""Cancelled"" may be purged.  You will be allowed to select a date range for"
"RTN","IBCNEKIT",177,0)
 W !," this purging.  The default beginning date will be the date of the oldest"
"RTN","IBCNEKIT",178,0)
 W !," eligible record in the system.  The default ending date will be six months"
"RTN","IBCNEKIT",179,0)
 W !," ago from today's date.  You may modify this default date range.  However, you"
"RTN","IBCNEKIT",180,0)
 W !," may not select an ending date that is more recent than six months ago."
"RTN","IBCNEKIT",181,0)
 W !!
"RTN","IBCNEKIT",182,0)
INITX ;
"RTN","IBCNEKIT",183,0)
 Q
"RTN","IBCNEKIT",184,0)
 ;
"RTN","IBCNEKIT",185,0)
BEGDT ; This procedure captures the beginning date from the user.
"RTN","IBCNEKIT",186,0)
 NEW DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCNEKIT",187,0)
 S DIR(0)="DOA^"_BEGDT_":"_ENDDT_":AEX"
"RTN","IBCNEKIT",188,0)
 S DIR("A")="Enter the purge begin date: "
"RTN","IBCNEKIT",189,0)
 S DIR("B")=$$FMTE^XLFDT(BEGDT,"5Z")
"RTN","IBCNEKIT",190,0)
 S DIR("?")="This response must be a date between "_$$FMTE^XLFDT(BEGDT,"5Z")_" and "_$$FMTE^XLFDT(ENDDT,"5Z")_"."
"RTN","IBCNEKIT",191,0)
 D ^DIR K DIR
"RTN","IBCNEKIT",192,0)
 I $D(DIRUT)!'Y S STOP=1 G BEGDTX
"RTN","IBCNEKIT",193,0)
 S BEGDT=Y
"RTN","IBCNEKIT",194,0)
BEGDTX ;
"RTN","IBCNEKIT",195,0)
 Q
"RTN","IBCNEKIT",196,0)
 ;
"RTN","IBCNEKIT",197,0)
ENDDT ; This procedure captures the ending date from the user.
"RTN","IBCNEKIT",198,0)
 NEW DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCNEKIT",199,0)
 W !
"RTN","IBCNEKIT",200,0)
 S DIR(0)="DOA^"_BEGDT_":"_ENDDT_":AEX"
"RTN","IBCNEKIT",201,0)
 S DIR("A")="  Enter the purge end date: "
"RTN","IBCNEKIT",202,0)
 S DIR("B")=$$FMTE^XLFDT(ENDDT,"5Z")
"RTN","IBCNEKIT",203,0)
 S DIR("?")="This response must be a date between "_$$FMTE^XLFDT(BEGDT,"5Z")_" and "_$$FMTE^XLFDT(ENDDT,"5Z")_"."
"RTN","IBCNEKIT",204,0)
 D ^DIR K DIR
"RTN","IBCNEKIT",205,0)
 I $D(DIRUT)!'Y S STOP=1 G ENDDTX
"RTN","IBCNEKIT",206,0)
 S ENDDT=Y
"RTN","IBCNEKIT",207,0)
ENDDTX ;
"RTN","IBCNEKIT",208,0)
 Q
"RTN","IBCNEKIT",209,0)
 ;
"RTN","IBCNEKIT",210,0)
CONFIRM ; This procedure displays a confirmation message to the user and
"RTN","IBCNEKIT",211,0)
 ; asks if it is OK to proceed with the purge.
"RTN","IBCNEKIT",212,0)
 NEW DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCNEKIT",213,0)
 W !!!," You want to purge all IIV data created between "
"RTN","IBCNEKIT",214,0)
 W $$FMTE^XLFDT(BEGDT,"5Z")," and ",$$FMTE^XLFDT(ENDDT,"5Z"),"."
"RTN","IBCNEKIT",215,0)
 W !
"RTN","IBCNEKIT",216,0)
 S DIR(0)="YO",DIR("A")=" OK to continue"
"RTN","IBCNEKIT",217,0)
 S DIR("B")="NO"
"RTN","IBCNEKIT",218,0)
 D ^DIR K DIR
"RTN","IBCNEKIT",219,0)
 I 'Y S STOP=1
"RTN","IBCNEKIT",220,0)
CONFX ;
"RTN","IBCNEKIT",221,0)
 Q
"RTN","IBCNEKIT",222,0)
 ;
"RTN","IBCNEKIT",223,0)
QUEUE ; This procedure queues the purge process for later at night.
"RTN","IBCNEKIT",224,0)
 ; The concept for queuing the purge came from the insurance buffer
"RTN","IBCNEKIT",225,0)
 ; purge routine, IBCNBPG.  That purge process is also hard-coded to
"RTN","IBCNEKIT",226,0)
 ; be run at 8:00 PM just like this one is.
"RTN","IBCNEKIT",227,0)
 ;
"RTN","IBCNEKIT",228,0)
 NEW ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTUCI,ZTCPU,ZTPRI,ZTSAVE,ZTKIL,ZTSYNC,ZTSK
"RTN","IBCNEKIT",229,0)
 NEW DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBCNEKIT",230,0)
 S ZTRTN="PURGE^IBCNEKIT"     ; TaskMan task entry point
"RTN","IBCNEKIT",231,0)
 S ZTDESC="Purge IIV Data"    ; Task description
"RTN","IBCNEKIT",232,0)
 S ZTDTH=DT_".20"             ; start it at 8:00 PM tonight
"RTN","IBCNEKIT",233,0)
 S ZTIO=""
"RTN","IBCNEKIT",234,0)
 S ZTSAVE("BEGDT")=""
"RTN","IBCNEKIT",235,0)
 S ZTSAVE("ENDDT")=""
"RTN","IBCNEKIT",236,0)
 S ZTSAVE("STATLIST")=""
"RTN","IBCNEKIT",237,0)
 D ^%ZTLOAD
"RTN","IBCNEKIT",238,0)
 I $G(ZTSK) W !!," Task# ",ZTSK," has been scheduled to purge the IIV data tonight at 8:00 PM."
"RTN","IBCNEKIT",239,0)
 E  W !!," TaskManager could not schedule this task.",!," Contact IRM for technical assistance."
"RTN","IBCNEKIT",240,0)
 W ! S DIR(0)="E" D ^DIR K DIR
"RTN","IBCNEKIT",241,0)
QUEUEX ;
"RTN","IBCNEKIT",242,0)
 Q
"RTN","IBJPI")
0^4^B59509234
"RTN","IBJPI",1,0)
IBJPI ;DAOU/BHS - IBJP IIV SITE PARAMETERS SCREEN ;14-JUN-2002
"RTN","IBJPI",2,0)
 ;;2.0;INTEGRATED BILLING;**184,271,316**;21-MAR-94
"RTN","IBJPI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJPI",4,0)
 ;
"RTN","IBJPI",5,0)
 ; IIV - Insurance Identification and Verification Interface
"RTN","IBJPI",6,0)
 ;
"RTN","IBJPI",7,0)
EN ; main entry pt for IBJP IIV SITE PARAMS
"RTN","IBJPI",8,0)
 N POP,X,CTRLCOL,VALMHDR,VALMCNT,%DT
"RTN","IBJPI",9,0)
 D EN^VALM("IBJP IIV SITE PARAMETERS")
"RTN","IBJPI",10,0)
 Q
"RTN","IBJPI",11,0)
 ;
"RTN","IBJPI",12,0)
HDR ; header 
"RTN","IBJPI",13,0)
 S VALMHDR(1)="Only authorized persons may edit this data."
"RTN","IBJPI",14,0)
 Q
"RTN","IBJPI",15,0)
 ;
"RTN","IBJPI",16,0)
INIT ; init vars & list array
"RTN","IBJPI",17,0)
 K ^TMP($J,"IBJPI")
"RTN","IBJPI",18,0)
 ; Kills data and video control arrays with active list
"RTN","IBJPI",19,0)
 D CLEAN^VALM10
"RTN","IBJPI",20,0)
 D BLD
"RTN","IBJPI",21,0)
 Q
"RTN","IBJPI",22,0)
 ;
"RTN","IBJPI",23,0)
HELP ; help
"RTN","IBJPI",24,0)
 D FULL^VALM1
"RTN","IBJPI",25,0)
 W @IOF
"RTN","IBJPI",26,0)
 W !,"This screen displays all of the eIIV Site Parameters used to manage the"
"RTN","IBJPI",27,0)
 W !,"eIIV application used for Insurance Identification and Verification."
"RTN","IBJPI",28,0)
 W !!,"The first section, General Parameters, concerns overall parameters"
"RTN","IBJPI",29,0)
 W !,"for monitoring the interface and controlling IIV communication"
"RTN","IBJPI",30,0)
 W !,"between VistA and the EC located in Austin."
"RTN","IBJPI",31,0)
 W !!,"The second section, Batch Extracts, concerns extract specific parameters"
"RTN","IBJPI",32,0)
 W !,"including active status, selection criteria and maximum records extracted"
"RTN","IBJPI",33,0)
 W !,"per day."
"RTN","IBJPI",34,0)
 W !!,"The third section, Patients without Insurance, concerns whether or not"
"RTN","IBJPI",35,0)
 W !,"identification inquiries should be made for patients without insurance on"
"RTN","IBJPI",36,0)
 ;W !,"inactive policies or the Most Popular Payers list below to see if the"
"RTN","IBJPI",37,0)
 W !,"inactive policies to see if the patient is covered by one of those companies"
"RTN","IBJPI",38,0)
 ;W !,"patient is covered by one of those companies or payers."
"RTN","IBJPI",39,0)
 W !,"or payers."
"RTN","IBJPI",40,0)
 ;D PAUSE^VALM1
"RTN","IBJPI",41,0)
 ;W !!,"The final section, Most Popular Payers, is a list maintained by users"
"RTN","IBJPI",42,0)
 ;W !,"of the most popular payers for that site.  This list is site-specific and"
"RTN","IBJPI",43,0)
 ;W !,"is based on the payers selected by the user as those most likely to have"
"RTN","IBJPI",44,0)
 ;W !,"coverage for a patient at the site.  The columns display whether or not the"
"RTN","IBJPI",45,0)
 ;W !,"payer is locally active or nationally active and the national payer id."
"RTN","IBJPI",46,0)
 ;W !,"The locally active flag can be updated by the site as long as the eIIV"
"RTN","IBJPI",47,0)
 ;W !,"application has not been deactivated.  The nationally active flag"
"RTN","IBJPI",48,0)
 ;W !,"is only updated by the Eligibility Communicator.  Both flags must be set"
"RTN","IBJPI",49,0)
 ;W !,"to YES for an insurance inquiry to be transmitted to the Eligibility"
"RTN","IBJPI",50,0)
 ;W !,"Communicator."
"RTN","IBJPI",51,0)
 D PAUSE^VALM1
"RTN","IBJPI",52,0)
 W @IOF
"RTN","IBJPI",53,0)
 S VALMBCK="R"
"RTN","IBJPI",54,0)
 Q
"RTN","IBJPI",55,0)
 ;
"RTN","IBJPI",56,0)
EXIT ; exit
"RTN","IBJPI",57,0)
 K ^TMP($J,"IBJPI")
"RTN","IBJPI",58,0)
 D CLEAN^VALM10
"RTN","IBJPI",59,0)
 Q
"RTN","IBJPI",60,0)
 ;
"RTN","IBJPI",61,0)
BLD ; build screen array
"RTN","IBJPI",62,0)
 N IBLN,IBCOL,IBWID,IBIIV,IBIIVB,IBIEN,CT,IBEX1,IBEX2,IBEX,IEN
"RTN","IBJPI",63,0)
 N IBST,IBDATA,DISYS,X,STATUS,AIEN,ADATA
"RTN","IBJPI",64,0)
 ;
"RTN","IBJPI",65,0)
 S (IBLN,VALMCNT)=0,IBCOL=3,IBIIV=$G(^IBE(350.9,1,51))
"RTN","IBJPI",66,0)
 ; -- Gen Params
"RTN","IBJPI",67,0)
 ; Skip line
"RTN","IBJPI",68,0)
 S IBLN=$$SET("","",IBLN,0),IBWID=48
"RTN","IBJPI",69,0)
 S IBLN=$$SETN("General Parameters",IBLN,IBCOL,1,)
"RTN","IBJPI",70,0)
 S IBLN=$$SET("Days between electronic reverification checks:  ",$P(IBIIV,U),IBLN,IBWID)
"RTN","IBJPI",71,0)
 S IBLN=$$SET("Send daily statistical report via MailMan:  ",$S($P(IBIIV,U,2):"YES",$P(IBIIV,U,2)=0:"NO",1:""),IBLN,IBWID)
"RTN","IBJPI",72,0)
 I $P(IBIIV,U,2) S IBLN=$$SET("Time of day for daily statistical report:  ",$P(IBIIV,U,3),IBLN,IBWID)
"RTN","IBJPI",73,0)
 S IBLN=$$SET("Mail Group for eIIV messages:  ",$$MGRP^IBCNEUT5,IBLN,IBWID)
"RTN","IBJPI",74,0)
 S IBLN=$$SET("HL7 Response Processing Method:  ",$S($P(IBIIV,U,13)="B":"BATCH",$P(IBIIV,U,13)="I":"IMMEDIATE",1:""),IBLN,IBWID)
"RTN","IBJPI",75,0)
 I $P(IBIIV,U,13)="B" D
"RTN","IBJPI",76,0)
 . S IBLN=$$SET("HL7 Batch Start Time:  ",$P(IBIIV,U,14),IBLN,IBWID)
"RTN","IBJPI",77,0)
 . S IBLN=$$SET("HL7 Batch Stop Time:  ",$P(IBIIV,U,19),IBLN,IBWID)
"RTN","IBJPI",78,0)
 S IBLN=$$SET("Daily Maximum HL7 Messages:  ",$P(IBIIV,U,15),IBLN,IBWID)
"RTN","IBJPI",79,0)
 S IBLN=$$SET("Contact Person:  ",$S($P(IBIIV,U,16)'="":$$GET1^DIQ(200,$P(IBIIV,U,16)_",",.01,"E"),1:""),IBLN,IBWID)
"RTN","IBJPI",80,0)
 S IBWID=62
"RTN","IBJPI",81,0)
 S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",82,0)
 S IBLN=$$SET("Receive MailMan message when unable to electronically","",IBLN,IBWID-12)
"RTN","IBJPI",83,0)
 S IBLN=$$SET("confirm insurance due to communication problem:  ",$S($P(IBIIV,U,20):"YES",$P(IBIIV,U,20)=0:"NO",1:""),IBLN,IBWID-6)
"RTN","IBJPI",84,0)
 ; Skip lines to force Batch Extracts to next page
"RTN","IBJPI",85,0)
 S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",86,0)
 S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",87,0)
 S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",88,0)
 ; Skip lines for Immediate
"RTN","IBJPI",89,0)
 I $P(IBIIV,U,13)'="B" D
"RTN","IBJPI",90,0)
 . S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",91,0)
 . S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",92,0)
 ;
"RTN","IBJPI",93,0)
 ; -- Batch Extracts
"RTN","IBJPI",94,0)
 S IBWID=43
"RTN","IBJPI",95,0)
 S IBLN=$$SETN("Batch Extracts",IBLN,IBCOL,1,)
"RTN","IBJPI",96,0)
 S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",97,0)
 S IBLN=$$SET("Extract               Selection  Maximum # to","",IBLN,IBWID)
"RTN","IBJPI",98,0)
 S IBLN=$$SETN(" Name          On/Off  Criteria   Extract/Day",IBLN,IBCOL+1,,1)
"RTN","IBJPI",99,0)
 ; Loop thru extracts
"RTN","IBJPI",100,0)
 S IEN=0 F  S IEN=$O(^IBE(350.9,1,51.17,IEN)) Q:'IEN  D
"RTN","IBJPI",101,0)
 . S IBIIVB=$G(^IBE(350.9,1,51.17,IEN,0))
"RTN","IBJPI",102,0)
 . S IBEX=+$P(IBIIVB,U)  ; Type
"RTN","IBJPI",103,0)
 . S IBST=$$FO^IBCNEUT1($S($P(IBIIVB,U)'="":$$GET1^DIQ(350.9002,$P(IBIIVB,U)_",1,",.01,"E"),1:""),14)
"RTN","IBJPI",104,0)
 . S IBST=IBST_$$FO^IBCNEUT1($S(+$P(IBIIVB,U,2):"ON",1:"OFF"),8)
"RTN","IBJPI",105,0)
 . S IBEX1=$S(+$P(IBIIVB,U,3)'=0:+$P(IBIIVB,U,3),1:$P(IBIIVB,U,3))
"RTN","IBJPI",106,0)
 . S IBEX2=$S(+$P(IBIIVB,U,4)'=0:+$P(IBIIVB,U,4),1:$P(IBIIVB,U,4))
"RTN","IBJPI",107,0)
 . S IBST=IBST_$$FO^IBCNEUT1($S(IBEX=1:"N/A",IBEX=2:IBEX1,IBEX=3!(IBEX=4):IBEX1_"/"_IBEX2,1:"ERROR"),11)
"RTN","IBJPI",108,0)
 . S IBST=IBST_$$FO^IBCNEUT1($S(+$P(IBIIVB,U,5):+$P(IBIIVB,U,5),1:$P(IBIIVB,U,5)),14)
"RTN","IBJPI",109,0)
 . S IBLN=$$SET(IBST,"",IBLN,IBWID)
"RTN","IBJPI",110,0)
 S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",111,0)
 ;
"RTN","IBJPI",112,0)
 ; -- Pts w/o Ins
"RTN","IBJPI",113,0)
 ; Skip line
"RTN","IBJPI",114,0)
 S IBLN=$$SET("","",IBLN,0),IBWID=41
"RTN","IBJPI",115,0)
 S IBLN=$$SETN("Patients Without Insurance",IBLN,IBCOL,1,)
"RTN","IBJPI",116,0)
 S IBLN=$$SET("Look at a patient's inactive insurance?  ",$S($P(IBIIV,U,8):"YES",$P(IBIIV,U,8)=0:"NO",1:""),IBLN,IBWID)
"RTN","IBJPI",117,0)
 ;S IBLN=$$SET("Attempt inquiry by most popular payers?  ",$S($P(IBIIV,U,9):"YES",$P(IBIIV,U,9)=0:"NO",1:""),IBLN,IBWID)
"RTN","IBJPI",118,0)
 ;S IBLN=$$SET("How many payers to try?  ",$P(IBIIV,U,10),IBLN,IBWID)
"RTN","IBJPI",119,0)
 S IBLN=$$SET("","",IBLN,0)
"RTN","IBJPI",120,0)
 S VALMCNT=IBLN
"RTN","IBJPI",121,0)
 Q
"RTN","IBJPI",122,0)
 ; No longer allowing the use of Most Popular Payers
"RTN","IBJPI",123,0)
 ;
"RTN","IBJPI",124,0)
 ; -- Most Popular Payers
"RTN","IBJPI",125,0)
 ; Skip line
"RTN","IBJPI",126,0)
 S IBLN=$$SET("","",IBLN,0),IBWID=12
"RTN","IBJPI",127,0)
 S IBLN=$$SETN("Most Popular Payers",IBLN,IBCOL,1,)
"RTN","IBJPI",128,0)
 ;
"RTN","IBJPI",129,0)
 S IBLN=$$SET("  Saved By:  ",$$GET1^DIQ(350.9,1,51.24),IBLN,IBWID)
"RTN","IBJPI",130,0)
 S IBLN=$$SET("Last Saved:  ",$$FMTE^XLFDT($P(IBIIV,U,21),"5Z"),IBLN,IBWID)
"RTN","IBJPI",131,0)
 S IBWID=48
"RTN","IBJPI",132,0)
 S IBST="    "_$$FO^IBCNEUT1(" ",36)_"  "_$$FO^IBCNEUT1(" ",11)_"  "_$$FO^IBCNEUT1("Nationally",10)_"  "_$$FO^IBCNEUT1("Locally",7)
"RTN","IBJPI",133,0)
 S IBLN=$$SET(IBST,"",IBLN,IBWID)
"RTN","IBJPI",134,0)
 S IBST="  #  "_$$FO^IBCNEUT1("Payer Name",36)_"  "_$$FO^IBCNEUT1("National ID",11)_"  "_$$FO^IBCNEUT1(" Active?",10)_"  "_$$FO^IBCNEUT1(" Active?",8)
"RTN","IBJPI",135,0)
 S IBLN=$$SETN(IBST,IBLN,IBCOL+1,,1)
"RTN","IBJPI",136,0)
 ; Loop thru the current List of Payers
"RTN","IBJPI",137,0)
 S (IEN,CT)=0 F  S IEN=$O(^IBE(350.9,1,51.18,IEN)) Q:'IEN  D
"RTN","IBJPI",138,0)
 . S IBIEN=$P($G(^IBE(350.9,1,51.18,IEN,0)),U) Q:'IBIEN  ; Bad IEN
"RTN","IBJPI",139,0)
 . S CT=CT+1,IBST=$$FO^IBCNEUT1(CT,2,"R")_". "
"RTN","IBJPI",140,0)
 . ; Payer Name
"RTN","IBJPI",141,0)
 . S IBST=IBST_$$FO^IBCNEUT1($P($G(^IBE(365.12,IBIEN,0)),U),36)
"RTN","IBJPI",142,0)
 . ; National ID
"RTN","IBJPI",143,0)
 . S IBST=IBST_"  "_$$FO^IBCNEUT1($P($G(^IBE(365.12,IBIEN,0)),U,2),11)
"RTN","IBJPI",144,0)
 . ; Look up the payer application data
"RTN","IBJPI",145,0)
 . S AIEN=$$PYRAPP^IBCNEUT5("IIV",IBIEN)
"RTN","IBJPI",146,0)
 . ; WARNING - IIV application does not exist
"RTN","IBJPI",147,0)
 . I AIEN="" D  Q
"RTN","IBJPI",148,0)
 . . S IBLN=$$SET(IBST,"",IBLN,IBWID)
"RTN","IBJPI",149,0)
 . . S IBST="    ** Please remove from this list: Payer not configured for IIV **"
"RTN","IBJPI",150,0)
 . . S IBLN=$$SET(IBST,"",IBLN,"")
"RTN","IBJPI",151,0)
 . S ADATA=$G(^IBE(365.12,+IBIEN,1,+AIEN,0))
"RTN","IBJPI",152,0)
 . S IBST=IBST_"  "_$$FO^IBCNEUT1($S('$P(ADATA,U,2):"  NO",1:"  YES"),9)
"RTN","IBJPI",153,0)
 . S IBST=IBST_"  "_$$FO^IBCNEUT1($S('$P(ADATA,U,3):"   NO",1:"   YES"),7)
"RTN","IBJPI",154,0)
 . S IBLN=$$SET(IBST,"",IBLN,"")
"RTN","IBJPI",155,0)
 . ; WARNING - IIV application deactivated
"RTN","IBJPI",156,0)
 . I +$P(ADATA,U,11) D  Q
"RTN","IBJPI",157,0)
 . . S IBST="    ** Please remove from this list: Payer is deactivated for IIV **"
"RTN","IBJPI",158,0)
 . . S IBLN=$$SET(IBST,"",IBLN,"")
"RTN","IBJPI",159,0)
 . ; WARNING - Id Inq Req ID = YES & Use SSN as ID = NO
"RTN","IBJPI",160,0)
 . I +$P(ADATA,U,8),'$P(ADATA,U,9) D  Q
"RTN","IBJPI",161,0)
 . . S IBST="    ** Please remove from this list: Inquiries w/o subscriber ID rejected **"
"RTN","IBJPI",162,0)
 . . S IBLN=$$SET(IBST,"",IBLN,"")
"RTN","IBJPI",163,0)
 ; No Data Found if CT=0
"RTN","IBJPI",164,0)
 I CT=0 S IBLN=$$SET($$FO^IBCNEUT1("*** NO DATA FOUND!!!! ***",60),"",IBLN,IBWID)
"RTN","IBJPI",165,0)
 S IBLN=$$SET("","",IBLN,0),IBWID=71
"RTN","IBJPI",166,0)
 S IBLN=$$SET("A payer will be available for electronic identification only if it is","",IBLN,IBWID)
"RTN","IBJPI",167,0)
 S IBLN=$$SET($$FO^IBCNEUT1("  both nationally and locally active.",IBWID),"",IBLN,IBWID)
"RTN","IBJPI",168,0)
 ;
"RTN","IBJPI",169,0)
 S VALMCNT=IBLN
"RTN","IBJPI",170,0)
 ;
"RTN","IBJPI",171,0)
 Q
"RTN","IBJPI",172,0)
 ;
"RTN","IBJPI",173,0)
SET(TTL,DATA,LN,WID) ;
"RTN","IBJPI",174,0)
 ; TTL = caption for field
"RTN","IBJPI",175,0)
 ; DATA = field value
"RTN","IBJPI",176,0)
 ; LN = current line #
"RTN","IBJPI",177,0)
 ; WID = right justify width
"RTN","IBJPI",178,0)
 N IBY
"RTN","IBJPI",179,0)
 ; update line ct
"RTN","IBJPI",180,0)
 S LN=LN+1
"RTN","IBJPI",181,0)
 ; offset line by 3 spaces
"RTN","IBJPI",182,0)
 S IBY="   "_$J(TTL,WID)_DATA D SET1(IBY,LN,0,$L(IBY))
"RTN","IBJPI",183,0)
 Q LN
"RTN","IBJPI",184,0)
 ;
"RTN","IBJPI",185,0)
SETN(TTL,LN,COL,RV,UN) ;
"RTN","IBJPI",186,0)
 ; TTL = caption for field
"RTN","IBJPI",187,0)
 ; LN = current line #
"RTN","IBJPI",188,0)
 ; COL = column at which to start video attribute
"RTN","IBJPI",189,0)
 ; RV = 0/1 flag for reverse video
"RTN","IBJPI",190,0)
 ; UN = 0/1 flag for underline
"RTN","IBJPI",191,0)
 N IBY
"RTN","IBJPI",192,0)
 ; update line ct
"RTN","IBJPI",193,0)
 S LN=LN+1
"RTN","IBJPI",194,0)
 ; offset line by 2 spaces
"RTN","IBJPI",195,0)
 S IBY="  "_TTL D SET1(IBY,LN,COL,$L(TTL),$G(RV),$G(UN))
"RTN","IBJPI",196,0)
 Q LN
"RTN","IBJPI",197,0)
 ;
"RTN","IBJPI",198,0)
SET1(STR,LN,COL,WD,RV,UN) ; Set up ^TMP array with screen data
"RTN","IBJPI",199,0)
 ; STR = line text
"RTN","IBJPI",200,0)
 ; LN = current line #
"RTN","IBJPI",201,0)
 ; COL = column at which to start video attribute
"RTN","IBJPI",202,0)
 ; WD = width of video attribute
"RTN","IBJPI",203,0)
 ; RV = 0/1 flag for reverse video
"RTN","IBJPI",204,0)
 ; UN = 0/1 flag for underline
"RTN","IBJPI",205,0)
 D SET^VALM10(LN,STR)
"RTN","IBJPI",206,0)
 I $G(RV)'="" D CNTRL^VALM10(LN,COL,WD,IORVON,IORVOFF)
"RTN","IBJPI",207,0)
 I $G(UN)'="" D CNTRL^VALM10(LN,COL,WD-1,IOUON,IOUOFF)
"RTN","IBJPI",208,0)
 Q
"RTN","IBJPI",209,0)
 ;
"RTN","IBJPI2")
0^5^B18769415
"RTN","IBJPI2",1,0)
IBJPI2 ;DAOU/BHS - IIV SITE PARAMETERS SCREEN ACTIONS ;26-JUN-2002
"RTN","IBJPI2",2,0)
 ;;2.0;INTEGRATED BILLING;**184,271,316**;21-MAR-94
"RTN","IBJPI2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJPI2",4,0)
 ;
"RTN","IBJPI2",5,0)
 ; IIV - Insurance Identification and Verification Interface
"RTN","IBJPI2",6,0)
 ;
"RTN","IBJPI2",7,0)
 ; Only call from tag
"RTN","IBJPI2",8,0)
 Q
"RTN","IBJPI2",9,0)
 ;
"RTN","IBJPI2",10,0)
MP ; Most Popular Payer processing
"RTN","IBJPI2",11,0)
 Q
"RTN","IBJPI2",12,0)
 ; Set error trap to ensure that lock is released
"RTN","IBJPI2",13,0)
 N $ES,$ET
"RTN","IBJPI2",14,0)
 S $ET="D ER^IBJPI2"
"RTN","IBJPI2",15,0)
 ; Check lock
"RTN","IBJPI2",16,0)
 L +^IBCNE("MP"):1 I '$T W !!,"The Most Popular Payers List is being edited by another user, please retry later." D PAUSE^VALM1 G MPX
"RTN","IBJPI2",17,0)
 ; Call ListMan screen
"RTN","IBJPI2",18,0)
 D EN^IBJPI3
"RTN","IBJPI2",19,0)
 L -^IBCNE("MP")  ; Unlock
"RTN","IBJPI2",20,0)
 ;
"RTN","IBJPI2",21,0)
MPX ; MP exit pt
"RTN","IBJPI2",22,0)
 D INIT^IBJPI S VALMBCK="R"
"RTN","IBJPI2",23,0)
 Q
"RTN","IBJPI2",24,0)
 ;
"RTN","IBJPI2",25,0)
BE ; Batch Extract processing
"RTN","IBJPI2",26,0)
 ; Init vars
"RTN","IBJPI2",27,0)
 N DIR,X,Y,DIRUT,TYPE,IEN,DR,DA,DIE,DIC
"RTN","IBJPI2",28,0)
 ;
"RTN","IBJPI2",29,0)
 D FULL^VALM1
"RTN","IBJPI2",30,0)
 W @IOF,!,"Batch Extract Parameters",!
"RTN","IBJPI2",31,0)
BE1 S DIR(0)="SO^1:Buffer;2:Appt;3:Nonverified;4:No insurance"
"RTN","IBJPI2",32,0)
 S DIR("A")="Batch extract parameters to edit"
"RTN","IBJPI2",33,0)
 S DIR("?")="^D BEHLP^IBJPI2"
"RTN","IBJPI2",34,0)
 D ^DIR K DIR I $D(DIRUT) G BEX
"RTN","IBJPI2",35,0)
 S TYPE=Y
"RTN","IBJPI2",36,0)
 ;
"RTN","IBJPI2",37,0)
 S IEN=0 F  S IEN=$O(^IBE(350.9,1,51.17,IEN)) Q:'IEN  I $P($G(^IBE(350.9,1,51.17,IEN,0)),U,1)=TYPE Q
"RTN","IBJPI2",38,0)
 ;
"RTN","IBJPI2",39,0)
 I IEN=""!(IEN=0) W !,"Extract Not Defined - ERROR!" G BEX
"RTN","IBJPI2",40,0)
 ;
"RTN","IBJPI2",41,0)
 ; Display only Active and Max Ct for Buffer Extract
"RTN","IBJPI2",42,0)
 I TYPE=1 S DR=".02;.05"
"RTN","IBJPI2",43,0)
 ; Display only Active, Sel Criteria #1 and Max Ct for Appt
"RTN","IBJPI2",44,0)
 I TYPE=2 S DR=".02;.03;.05"
"RTN","IBJPI2",45,0)
 ; Display Active, Sel Crit #1, Sel Crit #2 and Max Ct for Non-verified
"RTN","IBJPI2",46,0)
 I TYPE=3 S DR=".02;.03;.04;.05"
"RTN","IBJPI2",47,0)
 ; Display Active, Sel Crit #1, Sel Crit #2 and Max Ct for No active
"RTN","IBJPI2",48,0)
 I TYPE=4 S DR=".02;.03;.04;.05"
"RTN","IBJPI2",49,0)
 S DIE="^IBE(350.9,1,51.17,",DA=IEN,DA(1)=1 D ^DIE K DA,DR,DIE,DIC,X,Y
"RTN","IBJPI2",50,0)
 G BE1
"RTN","IBJPI2",51,0)
 ;
"RTN","IBJPI2",52,0)
BEX D INIT^IBJPI S VALMBCK="R"
"RTN","IBJPI2",53,0)
 Q
"RTN","IBJPI2",54,0)
 ;
"RTN","IBJPI2",55,0)
BEHLP ; Help text display for Batch Extract selection prompt
"RTN","IBJPI2",56,0)
 N DIR
"RTN","IBJPI2",57,0)
 W @IOF
"RTN","IBJPI2",58,0)
 W !,"  Please select an extract to view/modify settings:"
"RTN","IBJPI2",59,0)
 W !!,"   1 - INS. BUFFER:  Examines entries in the Insurance Buffer to find"
"RTN","IBJPI2",60,0)
 W !,"                     patient/insurance combinations that qualify for an"
"RTN","IBJPI2",61,0)
 W !,"                     electronic insurance eligibility inquiry"
"RTN","IBJPI2",62,0)
 W !!,"   2 - APPOINTMENT:  Reviews upcoming appointments to identify patients that"
"RTN","IBJPI2",63,0)
 W !,"                     have active insurance that has not been recently verified,"
"RTN","IBJPI2",64,0)
 W !,"                     or patients that have no active insurance for which an"
"RTN","IBJPI2",65,0)
 W !,"                     ""identification"" inquiry should be made to search the"
"RTN","IBJPI2",66,0)
 W !,"                     National Healthcare Cache for previously unknown policies"
"RTN","IBJPI2",67,0)
 W !!,"   3 - NON-VERIFIED: Uses past visits to identify patients that have"
"RTN","IBJPI2",68,0)
 W !,"                     been seen recently and have active insurance coverage, but"
"RTN","IBJPI2",69,0)
 W !,"                     have not had the insurance information verified recently."
"RTN","IBJPI2",70,0)
 W !!,"   4 - NO INSURANCE: Also uses past visits, but identifies patients with no"
"RTN","IBJPI2",71,0)
 W !,"                     active insurance on file and attempts to search for"
"RTN","IBJPI2",72,0)
 W !,"                     previously unknown policies by sending an ""identification"""
"RTN","IBJPI2",73,0)
 W !,"                     inquiry to the National Healthcare Cache database and/or"
"RTN","IBJPI2",74,0)
 W !,"                     queries the most popular insurance companies"
"RTN","IBJPI2",75,0)
 D PAUSE^VALM1
"RTN","IBJPI2",76,0)
BEHLPEX Q
"RTN","IBJPI2",77,0)
 ;
"RTN","IBJPI2",78,0)
IIVEDIT(IBJDR) ; -- IBJP IIV EDIT ACTIONS (GP,PW):  Edit IIV Site Parameters
"RTN","IBJPI2",79,0)
 ; IBJDR - 0 (General Parameters section)
"RTN","IBJPI2",80,0)
 ;         1 (Patients Without Insurance section)
"RTN","IBJPI2",81,0)
 N DA,DR,DIE,DIC,X,Y
"RTN","IBJPI2",82,0)
 ;
"RTN","IBJPI2",83,0)
 D FULL^VALM1
"RTN","IBJPI2",84,0)
 W @IOF,!,$S(IBJDR=0:"General",IBJDR=1:"Patients Without Insurance",1:"Unknown")_" Parameters",!
"RTN","IBJPI2",85,0)
 ; Build string of fields to edit or input template based on IBJDR
"RTN","IBJPI2",86,0)
 I IBJDR'="" S DR=$P($T(@IBJDR),";;",2,999)
"RTN","IBJPI2",87,0)
 I DR'="" S DIE="^IBE(350.9,",DA=1 D ^DIE K DA,DR,DIE,DIC,X,Y
"RTN","IBJPI2",88,0)
 ;
"RTN","IBJPI2",89,0)
 D INIT^IBJPI S VALMBCK="R"
"RTN","IBJPI2",90,0)
 Q
"RTN","IBJPI2",91,0)
 ;
"RTN","IBJPI2",92,0)
0 ;;[IBCNE GENERAL PARAMETER EDIT]
"RTN","IBJPI2",93,0)
1 ;;51.08
"RTN","IBJPI2",94,0)
 ;
"RTN","IBJPI2",95,0)
 ;
"RTN","IBJPI2",96,0)
ER ; Unlock most popular payer and return to log error
"RTN","IBJPI2",97,0)
 L -^IBCNE("MP")
"RTN","IBJPI2",98,0)
 D ^%ZTER
"RTN","IBJPI2",99,0)
 D UNWIND^%ZTER
"RTN","IBJPI2",100,0)
 Q
"RTN","IBJPI2",101,0)
 ;
"RTN","IBJPM")
0^3^B11055331
"RTN","IBJPM",1,0)
IBJPM ;ALB/MAF,ARH - IBSP MCCR PARAMETERS SCREEN ;14-DEC-1995
"RTN","IBJPM",2,0)
 ;;2.0;INTEGRATED BILLING;**39,137,184,271,316**;21-MAR-94
"RTN","IBJPM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJPM",4,0)
 ;
"RTN","IBJPM",5,0)
EN ; -- main entry point for JOINT INQUIRY PARAMETERS option
"RTN","IBJPM",6,0)
 D EN^VALM("IBJP MCCR PARAMETERS")
"RTN","IBJPM",7,0)
 Q
"RTN","IBJPM",8,0)
 ;
"RTN","IBJPM",9,0)
HDR ; -- header code
"RTN","IBJPM",10,0)
 S VALMHDR(1)="Display/Edit MCCR Site Parameters."
"RTN","IBJPM",11,0)
 S VALMHDR(2)="Only authorized persons may edit this data."
"RTN","IBJPM",12,0)
 Q
"RTN","IBJPM",13,0)
 ;
"RTN","IBJPM",14,0)
INIT ; -- init variables and list array
"RTN","IBJPM",15,0)
 K ^TMP("IBJPM",$J)
"RTN","IBJPM",16,0)
 D BLD
"RTN","IBJPM",17,0)
 Q
"RTN","IBJPM",18,0)
 ;
"RTN","IBJPM",19,0)
HELP ; -- help code
"RTN","IBJPM",20,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBJPM",21,0)
 Q
"RTN","IBJPM",22,0)
 ;
"RTN","IBJPM",23,0)
EXIT ; -- exit code
"RTN","IBJPM",24,0)
 K ^TMP("IBJPM",$J),IBFASTXT,VALMBCK
"RTN","IBJPM",25,0)
 D CLEAR^VALM1
"RTN","IBJPM",26,0)
 Q
"RTN","IBJPM",27,0)
 ;
"RTN","IBJPM",28,0)
BLD ; -- build screen array, no variables required for input
"RTN","IBJPM",29,0)
 N IBNC,IBTC,IBTW,IBSW,IBLN,IBGRPB,IBGRPE,IBLR
"RTN","IBJPM",30,0)
 S IBNC(1)=1,IBTW(1)=0,IBTC(1)=5,IBSW(1)=30,IBNC(2)=43,IBTW(2)=0,IBTC(2)=47,IBSW(2)=30
"RTN","IBJPM",31,0)
 ;
"RTN","IBJPM",32,0)
 S (VALMCNT,IBLN)=1,IBLR=1,IBLN=$$SET("","",IBLN,IBLR),IBGRPB=IBLN
"RTN","IBJPM",33,0)
 ;
"RTN","IBJPM",34,0)
 ; - IB Site Parameters
"RTN","IBJPM",35,0)
 S IBLN=$$SETN("IB Site Parameters",IBLN,IBLR,1)
"RTN","IBJPM",36,0)
 S IBLN=$$SET("","Facility Definition",IBLN,IBLR)
"RTN","IBJPM",37,0)
 S IBLN=$$SET("","Mail Groups",IBLN,IBLR)
"RTN","IBJPM",38,0)
 S IBLN=$$SET("","Patient Billing",IBLN,IBLR)
"RTN","IBJPM",39,0)
 S IBLN=$$SET("","Third Party Billing",IBLN,IBLR)
"RTN","IBJPM",40,0)
 S IBLN=$$SET("","Provider Id",IBLN,IBLR)
"RTN","IBJPM",41,0)
 S IBLN=$$SET("","EDI Transmission",IBLN,IBLR)
"RTN","IBJPM",42,0)
 ;
"RTN","IBJPM",43,0)
 S IBLR=2,IBGRPE=IBLN,IBLN=IBGRPB
"RTN","IBJPM",44,0)
 ;
"RTN","IBJPM",45,0)
 ; - Claim Tracking Parameters
"RTN","IBJPM",46,0)
 S IBLN=$$SETN("Claims Tracking Parameters",IBLN,IBLR,1)
"RTN","IBJPM",47,0)
 S IBLN=$$SET("","General Parameters",IBLN,IBLR)
"RTN","IBJPM",48,0)
 S IBLN=$$SET("","Tracking Parameters",IBLN,IBLR)
"RTN","IBJPM",49,0)
 S IBLN=$$SET("","Random Sampling",IBLN,IBLR)
"RTN","IBJPM",50,0)
 ;
"RTN","IBJPM",51,0)
 S IBLN=$S(IBLN>IBGRPE:IBLN,1:IBGRPE),IBLR=1,IBLN=$$SET("","",IBLN,IBLR),IBGRPB=IBLN
"RTN","IBJPM",52,0)
 ;
"RTN","IBJPM",53,0)
 ; - Automated Billing Parameters
"RTN","IBJPM",54,0)
 S IBLN=$$SETN("Third Party Auto Billing Parameters",IBLN,IBLR,1)
"RTN","IBJPM",55,0)
 S IBLN=$$SET("","General Parameters",IBLN,IBLR)
"RTN","IBJPM",56,0)
 S IBLN=$$SET("","Inpatient Admission",IBLN,IBLR)
"RTN","IBJPM",57,0)
 S IBLN=$$SET("","Outpatient Visit",IBLN,IBLR)
"RTN","IBJPM",58,0)
 S IBLN=$$SET("","Prescription Refill",IBLN,IBLR)
"RTN","IBJPM",59,0)
 ;
"RTN","IBJPM",60,0)
 ; DAOU/BHS - Added 13-JUN-2002
"RTN","IBJPM",61,0)
 S IBLR=2,IBLN=IBGRPB
"RTN","IBJPM",62,0)
 ;
"RTN","IBJPM",63,0)
 ; DAOU/BHS - Added 13-JUN-2002
"RTN","IBJPM",64,0)
 ; - IIV Parameters
"RTN","IBJPM",65,0)
 S IBLN=$$SETN("Insurance Id and Verification",IBLN,IBLR,1)
"RTN","IBJPM",66,0)
 S IBLN=$$SET("","General Parameters",IBLN,IBLR)
"RTN","IBJPM",67,0)
 S IBLN=$$SET("","Batch Extracts Parameters",IBLN,IBLR)
"RTN","IBJPM",68,0)
 S IBLN=$$SET("","Patients Without Insurance",IBLN,IBLR)
"RTN","IBJPM",69,0)
 ;
"RTN","IBJPM",70,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)-1
"RTN","IBJPM",71,0)
 Q
"RTN","IBJPM",72,0)
 ;
"RTN","IBJPM",73,0)
SET(TTL,DATA,LN,LR) ;
"RTN","IBJPM",74,0)
 N IBY
"RTN","IBJPM",75,0)
 S IBY=$J(TTL,IBTW(LR))_DATA D SET1(IBY,LN,IBTC(LR),(IBTW(LR)+IBSW(LR)))
"RTN","IBJPM",76,0)
 S LN=LN+1
"RTN","IBJPM",77,0)
 Q LN
"RTN","IBJPM",78,0)
 ;
"RTN","IBJPM",79,0)
SETN(TTL,LN,LR,RV) ;
"RTN","IBJPM",80,0)
 N IBY
"RTN","IBJPM",81,0)
 S IBY=" "_TTL_" " D SET1(IBY,LN,IBNC(LR),$L(IBY),$G(RV))
"RTN","IBJPM",82,0)
 S LN=LN+1
"RTN","IBJPM",83,0)
 Q LN
"RTN","IBJPM",84,0)
 ;
"RTN","IBJPM",85,0)
SET1(STR,LN,COL,WD,RV) ; set up TMP array with screen data
"RTN","IBJPM",86,0)
 N IBX S IBX=$G(^TMP("IBJPM",$J,LN,0))
"RTN","IBJPM",87,0)
 S IBX=$$SETSTR^VALM1(STR,IBX,COL,WD)
"RTN","IBJPM",88,0)
 D SET^VALM10(LN,IBX) I $G(RV)'="" D CNTRL^VALM10(LN,COL,WD,IOINHI,IOINORM)
"RTN","IBJPM",89,0)
 Q
"RTN","IBY316PS")
0^^B1052184
"RTN","IBY316PS",1,0)
IBY316PS ;;DAOU/DJW - Post Installation Program ;13-September-2005
"RTN","IBY316PS",2,0)
 ;;2.0;INTEGRATED BILLING;**316**;21-MAR-94
"RTN","IBY316PS",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBY316PS",4,0)
 ;
"RTN","IBY316PS",5,0)
 ;
"RTN","IBY316PS",6,0)
 ;Program Description: This is the post install routine for IB*2.0*316
"RTN","IBY316PS",7,0)
 ;
"RTN","IBY316PS",8,0)
 ; Set 'INQUIRE POPULAR PAYERS'='NO'(#51.09) and 'NO. POPULAR PAYERS'=1 (#51.1)
"RTN","IBY316PS",9,0)
 ; 
"RTN","IBY316PS",10,0)
 ; Remove data from the following fields:
"RTN","IBY316PS",11,0)
 ; - 'MOST POPULAR LAST SAVE DATE' (#51.21)
"RTN","IBY316PS",12,0)
 ; - list of 'POPULAR PAYERS' (#51.18)
"RTN","IBY316PS",13,0)
 ; 
"RTN","IBY316PS",14,0)
 N DA,DIK,DIE,DR,D,D0,DIC,DQ,X,DI,%
"RTN","IBY316PS",15,0)
 S DIK="^IBE(350.9,1,51.18,",DA(1)=1,DA=0
"RTN","IBY316PS",16,0)
 F  S DA=$O(^IBE(350.9,1,51.18,DA)) Q:'DA  D ^DIK
"RTN","IBY316PS",17,0)
 ;
"RTN","IBY316PS",18,0)
 S DA=1,DIE="^IBE(350.9,",DR="51.21///@" D ^DIE
"RTN","IBY316PS",19,0)
 S DA=1,DIE="^IBE(350.9,",DR="51.1///^S X=1" D ^DIE
"RTN","IBY316PS",20,0)
 S DA=1,DIE="^IBE(350.9,",DR="51.09///^S X=0" D ^DIE
"RTN","IBY316PS",21,0)
 ;
"RTN","IBY316PS",22,0)
 Q
"UP",350.9,350.9002,-1)
350.9^51.17
"UP",350.9,350.9002,0)
350.9002
"VER")
8.0^22.0
"^DD",350.9,350.9,51.15,0)
HL7 MAXIMUM NUMBER^RNJ4,0^^51;15^K:+X'=X!(X>5000)!(X<1)!(X?.E1"."1N.N) X
"^DD",350.9,350.9,51.15,3)
Type a Number between 1 and 5000, 0 Decimal Digits
"^DD",350.9,350.9,51.15,21,0)
^^6^6^3051006^
"^DD",350.9,350.9,51.15,21,1,0)
This field allows a site to restrict the daily number of HL7
"^DD",350.9,350.9,51.15,21,2,0)
messages created and sent during the HL7 process for eIIV.
"^DD",350.9,350.9,51.15,21,3,0)
This feature can be used to manage the amount of eIIV HL7
"^DD",350.9,350.9,51.15,21,4,0)
traffic flowing through the HL7 package. The value must be
"^DD",350.9,350.9,51.15,21,5,0)
at least 20 greater than the sum of "Maximum # to Extract/Day"
"^DD",350.9,350.9,51.15,21,6,0)
for active extracts.
"^DD",350.9,350.9,51.15,"DT")
3050418
"^DD",350.9,350.9002,.05,0)
MAXIMUM EXTRACT NUMBER^RNJ4,0^^0;5^K:+X'=X!(X>5000)!(X<10)!(X?.E1"."1N.N) X
"^DD",350.9,350.9002,.05,3)
Type a Number between 10 and 5000, 0 Decimal Digits
"^DD",350.9,350.9002,.05,21,0)
^^2^2^3050418^
"^DD",350.9,350.9002,.05,21,1,0)
This field allows a site to restrict the daily number of records
"^DD",350.9,350.9002,.05,21,2,0)
extracted and placed in the IIV Transmission Queue.
"^DD",350.9,350.9002,.05,"DT")
3050418
"BLD",6024,6)
^293
**END**
**END**
