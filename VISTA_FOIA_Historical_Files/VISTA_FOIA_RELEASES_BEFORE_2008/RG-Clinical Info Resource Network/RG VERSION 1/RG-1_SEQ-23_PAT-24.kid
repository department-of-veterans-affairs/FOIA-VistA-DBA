Released RG*1*24 SEQ #23
Extracted from mail message
**KIDS**:RG*1.0*24^

**INSTALL NAME**
RG*1.0*24
"BLD",1487,0)
RG*1.0*24^CLINICAL INFO RESOURCE NETWORK^0^3020312^y
"BLD",1487,1,0)
^^3^3^3020308^
"BLD",1487,1,1,0)
CORRECTION FOR POINT OF CONTACT OPTION
"BLD",1487,1,2,0)
Refer to patch RG*1*24 in the FORUM Patch Module for a complete
"BLD",1487,1,3,0)
description.
"BLD",1487,4,0)
^9.64PA^^
"BLD",1487,"ABNS",0)
^9.66A^^
"BLD",1487,"ABPKG")
^^
"BLD",1487,"INID")
^y
"BLD",1487,"INIT")
RGP24PST
"BLD",1487,"KRN",0)
^9.67PA^8989.52^19
"BLD",1487,"KRN",.4,0)
.4
"BLD",1487,"KRN",.401,0)
.401
"BLD",1487,"KRN",.402,0)
.402
"BLD",1487,"KRN",.403,0)
.403
"BLD",1487,"KRN",.5,0)
.5
"BLD",1487,"KRN",.84,0)
.84
"BLD",1487,"KRN",3.6,0)
3.6
"BLD",1487,"KRN",3.8,0)
3.8
"BLD",1487,"KRN",9.2,0)
9.2
"BLD",1487,"KRN",9.8,0)
9.8
"BLD",1487,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",1487,"KRN",9.8,"NM",1,0)
RGP24PST^^0^B17530509
"BLD",1487,"KRN",9.8,"NM",2,0)
RGPOC^^0^B36465146
"BLD",1487,"KRN",9.8,"NM","B","RGP24PST",1)

"BLD",1487,"KRN",9.8,"NM","B","RGPOC",2)

"BLD",1487,"KRN",19,0)
19
"BLD",1487,"KRN",19.1,0)
19.1
"BLD",1487,"KRN",101,0)
101
"BLD",1487,"KRN",409.61,0)
409.61
"BLD",1487,"KRN",771,0)
771
"BLD",1487,"KRN",870,0)
870
"BLD",1487,"KRN",8989.51,0)
8989.51
"BLD",1487,"KRN",8989.52,0)
8989.52
"BLD",1487,"KRN",8994,0)
8994
"BLD",1487,"KRN","B",.4,.4)

"BLD",1487,"KRN","B",.401,.401)

"BLD",1487,"KRN","B",.402,.402)

"BLD",1487,"KRN","B",.403,.403)

"BLD",1487,"KRN","B",.5,.5)

"BLD",1487,"KRN","B",.84,.84)

"BLD",1487,"KRN","B",3.6,3.6)

"BLD",1487,"KRN","B",3.8,3.8)

"BLD",1487,"KRN","B",9.2,9.2)

"BLD",1487,"KRN","B",9.8,9.8)

"BLD",1487,"KRN","B",19,19)

"BLD",1487,"KRN","B",19.1,19.1)

"BLD",1487,"KRN","B",101,101)

"BLD",1487,"KRN","B",409.61,409.61)

"BLD",1487,"KRN","B",771,771)

"BLD",1487,"KRN","B",870,870)

"BLD",1487,"KRN","B",8989.51,8989.51)

"BLD",1487,"KRN","B",8989.52,8989.52)

"BLD",1487,"KRN","B",8994,8994)

"BLD",1487,"QUES",0)
^9.62^^
"BLD",1487,"REQB",0)
^9.611^1^1
"BLD",1487,"REQB",1,0)
RG*1.0*21^2
"BLD",1487,"REQB","B","RG*1.0*21",1)

"INIT")
RGP24PST
"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
24^3020312
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3020312
"PKG",272,22,1,"PAH",1,1,1,0)
CORRECTION FOR POINT OF CONTACT OPTION
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*24 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RGP24PST")
0^1^B17530509
"RTN","RGP24PST",1,0)
RGP24PST ;BIR/PTD-RG*1*24 PATCH POST INSTALL ROUTINE ;3/7/02
"RTN","RGP24PST",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**24**;30 Apr 99
"RTN","RGP24PST",3,0)
 ;
"RTN","RGP24PST",4,0)
 ;Reference to LINK^HLUTIL3 and $$GET1^DIQ(870 supported by IA #3335
"RTN","RGP24PST",5,0)
 ;Reference to ^VA(200, supported by IA #2589
"RTN","RGP24PST",6,0)
 ;Reference to DOMAIN (#4.2) file supported by IA #3452
"RTN","RGP24PST",7,0)
 ;
"RTN","RGP24PST",8,0)
DOMAIN ;Determine test or production account (production must have
"RTN","RGP24PST",9,0)
 ;"MPI-AUSTIN.VA.GOV" domain for logical link "MPIVA").
"RTN","RGP24PST",10,0)
 ;Get logical link IEN for "MPIVA".
"RTN","RGP24PST",11,0)
 ;Get domain for "MPIVA" logical link in HL LOGICAL LINK (#870) file.
"RTN","RGP24PST",12,0)
 N RGDOMAIN,RGDMNC S RGDOMAIN=""
"RTN","RGP24PST",13,0)
 D LINK^HLUTIL3("200M",.HLL,"I")
"RTN","RGP24PST",14,0)
 S IEN=$O(HLL(0)) I +IEN>0 S RGDOMAIN=$$GET1^DIQ(870,+IEN_",",.03)
"RTN","RGP24PST",15,0)
 S RGDMNC=$$FIND1^DIC(4.2,"","MQ","MPI-AUSTIN.VA.GOV") I RGDMNC>0 S RGDMNC=$$GET1^DIQ(4.2,RGDMNC_",",.01)
"RTN","RGP24PST",16,0)
 I RGDOMAIN="" D BMES^XPDUTL(" No domain found for MPIVA logical link in HL LOGICAL LINK (#870) file.") G QUIT
"RTN","RGP24PST",17,0)
 ;If test account, quit.
"RTN","RGP24PST",18,0)
 I RGDOMAIN'=RGDMNC D BMES^XPDUTL(" No data will be transmitted from a TEST account.") D MES^XPDUTL(" Post-install routine completed successfully.") G QUIT
"RTN","RGP24PST",19,0)
 ;Else, production account, so continue...
"RTN","RGP24PST",20,0)
 ;
"RTN","RGP24PST",21,0)
PATCH ;Determine if patch XM*7.1*198 has been installed.
"RTN","RGP24PST",22,0)
 S RGPCH=$$PATCH^XPDUTL("XM*7.1*198")
"RTN","RGP24PST",23,0)
 ;If patch XM*7.1*198 is not installed, quit.
"RTN","RGP24PST",24,0)
 I RGPCH=0 D BMES^XPDUTL(" Post-install routine completed successfully.") G QUIT
"RTN","RGP24PST",25,0)
 ;Else patch XM*7.1*198 is installed.
"RTN","RGP24PST",26,0)
 ;
"RTN","RGP24PST",27,0)
GETDATA ;Get the POC data from the CIRN SITE PARAMETER (#991.8) file.
"RTN","RGP24PST",28,0)
 D GETS^DIQ(991.8,1,"50:55","IE","RGPOC")
"RTN","RGP24PST",29,0)
 S FLD=0 F  S FLD=$O(RGPOC(991.8,"1,",FLD)) Q:'FLD  K RGIEN,RGPN D
"RTN","RGP24PST",30,0)
 .I FLD=50 I $G(RGPOC(991.8,"1,",FLD,"E"))'="" D
"RTN","RGP24PST",31,0)
 ..S RGARRAY(10)="Admin Point of Contact Name: "_$G(RGPOC(991.8,"1,",FLD,"E"))
"RTN","RGP24PST",32,0)
 ..S RGIEN=$G(RGPOC(991.8,"1,",FLD,"I"))
"RTN","RGP24PST",33,0)
 ..S RGPN=$$GET1^DIQ(200,RGIEN,.135)
"RTN","RGP24PST",34,0)
 ..S RGARRAY(11)="Admin Point of Contact Phone #: "_$S(RGPN'="":RGPN,1:"<NO DATA ON FILE>")
"RTN","RGP24PST",35,0)
 .I FLD=53 I $G(RGPOC(991.8,"1,",FLD,"E"))'="" D
"RTN","RGP24PST",36,0)
 ..S RGARRAY(20)="Alt Admin Point of Contact Name: "_$G(RGPOC(991.8,"1,",FLD,"E"))
"RTN","RGP24PST",37,0)
 ..S RGIEN=$G(RGPOC(991.8,"1,",FLD,"I"))
"RTN","RGP24PST",38,0)
 ..S RGPN=$$GET1^DIQ(200,RGIEN,.135)
"RTN","RGP24PST",39,0)
 ..S RGARRAY(21)="Alt Admin Point of Contact Phone #: "_$S(RGPN'="":RGPN,1:"<NO DATA ON FILE>")
"RTN","RGP24PST",40,0)
 .I FLD=51 I $G(RGPOC(991.8,"1,",FLD,"E"))'="" D
"RTN","RGP24PST",41,0)
 ..S RGARRAY(30)="IRM Point of Contact Name: "_$G(RGPOC(991.8,"1,",FLD,"E"))
"RTN","RGP24PST",42,0)
 ..S RGIEN=$G(RGPOC(991.8,"1,",FLD,"I"))
"RTN","RGP24PST",43,0)
 ..S RGPN=$$GET1^DIQ(200,RGIEN,.135)
"RTN","RGP24PST",44,0)
 ..S RGARRAY(31)="IRM Point of Contact Phone #: "_$S(RGPN'="":RGPN,1:"<NO DATA ON FILE>")
"RTN","RGP24PST",45,0)
 .I FLD=54 I $G(RGPOC(991.8,"1,",FLD,"E"))'="" D
"RTN","RGP24PST",46,0)
 ..S RGARRAY(40)="Alt IRM Point of Contact Name: "_$G(RGPOC(991.8,"1,",FLD,"E"))
"RTN","RGP24PST",47,0)
 ..S RGIEN=$G(RGPOC(991.8,"1,",FLD,"I"))
"RTN","RGP24PST",48,0)
 ..S RGPN=$$GET1^DIQ(200,RGIEN,.135)
"RTN","RGP24PST",49,0)
 ..S RGARRAY(41)="Alt IRM Point of Contact Phone #: "_$S(RGPN'="":RGPN,1:"<NO DATA ON FILE>")
"RTN","RGP24PST",50,0)
 .I FLD=52 I $G(RGPOC(991.8,"1,",FLD,"E"))'="" D
"RTN","RGP24PST",51,0)
 ..S RGARRAY(50)="HL7 Point of Contact Name: "_$G(RGPOC(991.8,"1,",FLD,"E"))
"RTN","RGP24PST",52,0)
 ..S RGIEN=$G(RGPOC(991.8,"1,",FLD,"I"))
"RTN","RGP24PST",53,0)
 ..S RGPN=$$GET1^DIQ(200,RGIEN,.135)
"RTN","RGP24PST",54,0)
 ..S RGARRAY(51)="HL7 Point of Contact Phone #: "_$S(RGPN'="":RGPN,1:"<NO DATA ON FILE>")
"RTN","RGP24PST",55,0)
 .I FLD=55 I $G(RGPOC(991.8,"1,",FLD,"E"))'="" D
"RTN","RGP24PST",56,0)
 ..S RGARRAY(60)="Alt HL7 Point of Contact Name: "_$G(RGPOC(991.8,"1,",FLD,"E"))
"RTN","RGP24PST",57,0)
 ..S RGIEN=$G(RGPOC(991.8,"1,",FLD,"I"))
"RTN","RGP24PST",58,0)
 ..S RGPN=$$GET1^DIQ(200,RGIEN,.135)
"RTN","RGP24PST",59,0)
 ..S RGARRAY(61)="Alt HL7 Point of Contact Phone #: "_$S(RGPN'="":RGPN,1:"<NO DATA ON FILE>")
"RTN","RGP24PST",60,0)
 ;
"RTN","RGP24PST",61,0)
 ;If no data in the RGARRAY (no data to send), quit.
"RTN","RGP24PST",62,0)
 I '$O(RGARRAY(0)) D BMES^XPDUTL(" Post-install routine completed successfully.") G QUIT
"RTN","RGP24PST",63,0)
 ;
"RTN","RGP24PST",64,0)
SEND ;Send message to Data Management Team via E-mail message.
"RTN","RGP24PST",65,0)
 N DIFROM
"RTN","RGP24PST",66,0)
 S XMSUB="POC UPDATE - SITE "_$P($$SITE^VASITE(),"^",3)
"RTN","RGP24PST",67,0)
 S XMDUZ="MPI/PD PACKAGE - RG*1*24"
"RTN","RGP24PST",68,0)
 S XMY("G.MPI/PD POC UPDATE@MPI-AUSTIN.MED.VA.GOV")=""
"RTN","RGP24PST",69,0)
 S XMTEXT="RGARRAY("
"RTN","RGP24PST",70,0)
 S RGARRAY(1)="The following point of contact information is from"
"RTN","RGP24PST",71,0)
 S RGARRAY(2)=$P($$SITE^VASITE(),"^",2)_" (station number "_$P($$SITE^VASITE(),"^",3)_")."
"RTN","RGP24PST",72,0)
 S RGARRAY(3)=""
"RTN","RGP24PST",73,0)
 D ^XMD
"RTN","RGP24PST",74,0)
 D BMES^XPDUTL(" Sending POC information to the MPI/PD Data Management team now.")
"RTN","RGP24PST",75,0)
 D MES^XPDUTL(" Post-install routine completed successfully.")
"RTN","RGP24PST",76,0)
 ;
"RTN","RGP24PST",77,0)
QUIT ;Kill variables and quit
"RTN","RGP24PST",78,0)
 K FLD,HLL,IEN,RGARRAY,RGDMNC,RGDOMAIN,RGIEN,RGPCH,RGPN,RGPOC,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","RGP24PST",79,0)
 Q
"RTN","RGPOC")
0^2^B36465146
"RTN","RGPOC",1,0)
RGPOC ;BIR/PTD-ADD/EDIT POINT OF CONTACT OPTION ;8/22/01
"RTN","RGPOC",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**21,24**;30 Apr 99
"RTN","RGPOC",3,0)
 ;
"RTN","RGPOC",4,0)
 ;Reference to ^VA(200, supported by IA #2589
"RTN","RGPOC",5,0)
 ;Reference to LINK^HLUTIL3 and $$GET1^DIQ(870 supported by IA #3335
"RTN","RGPOC",6,0)
 ;Reference to DOMAIN (#4.2) file supported by IA #3452
"RTN","RGPOC",7,0)
 ;
"RTN","RGPOC",8,0)
INTRO ;Introduction to Option
"RTN","RGPOC",9,0)
 W @IOF,!,"This option allows you to transmit information to the MPI/PD Data"
"RTN","RGPOC",10,0)
 W !,"Management team so that the Point of Contact website can be updated."
"RTN","RGPOC",11,0)
 W !!,"To obtain a list of MPI/PD Points of Contact for each facility,"
"RTN","RGPOC",12,0)
 W !,"look for the POC web link on the MPI/PD Home Page."
"RTN","RGPOC",13,0)
 W !!,"The COMMERCIAL PHONE (#.135) field in the NEW PERSON (#200) file"
"RTN","RGPOC",14,0)
 W !,"will only accept numbers and punctuation, 4-20 characters."
"RTN","RGPOC",15,0)
 W !!,"Please include the entire phone number:",!,"area code, 7 digit number and extension (e.g., AAA NNN NNNN XXXX)"
"RTN","RGPOC",16,0)
 W !!,"A contact name without a phone number will NOT be transmitted."
"RTN","RGPOC",17,0)
 W !,"                                           ==="
"RTN","RGPOC",18,0)
 ;
"RTN","RGPOC",19,0)
ASK ;Select POC to add/edit.
"RTN","RGPOC",20,0)
 W ! K DIR S DIR(0)="LA^1:7"
"RTN","RGPOC",21,0)
 S DIR("A")="Which Point of Contact information do you wish to update? "
"RTN","RGPOC",22,0)
 S DIR("A",1)="Select one or more of the following:"
"RTN","RGPOC",23,0)
 S DIR("A",2)="(A list or range of numbers can be entered, e.g., 1,3 or 2-4,6.)"
"RTN","RGPOC",24,0)
 S DIR("A",3)=""
"RTN","RGPOC",25,0)
 S DIR("A",4)="    1 - Admin POC     2 - Alt Admin POC     3 - IRM POC     4 - Alt IRM POC"
"RTN","RGPOC",26,0)
 S DIR("A",5)="    5 - HL7 POC       6 - Alt HL7 POC       7 - ALL POCs"
"RTN","RGPOC",27,0)
 S DIR("A",6)=""
"RTN","RGPOC",28,0)
 S DIR("B")="7"
"RTN","RGPOC",29,0)
 S DIR("?",1)="Enter:"
"RTN","RGPOC",30,0)
 S DIR("?",2)=" ""1"" to add/edit Administrative Point of Contact."
"RTN","RGPOC",31,0)
 S DIR("?",3)=" ""2"" to add/edit Alternate Administrative Point of Contact."
"RTN","RGPOC",32,0)
 S DIR("?",4)=" ""3"" to add/edit IRM Point of Contact."
"RTN","RGPOC",33,0)
 S DIR("?",5)=" ""4"" to add/edit Alternate IRM Point of Contact."
"RTN","RGPOC",34,0)
 S DIR("?",6)=" ""5"" to add/edit Health Level Seven Point of Contact."
"RTN","RGPOC",35,0)
 S DIR("?",7)=" ""6"" to add/edit Alternate Health Level Seven Point of Contact."
"RTN","RGPOC",36,0)
 S DIR("?",8)=" ""7"" to add/edit ALL Points of Contact."
"RTN","RGPOC",37,0)
 S DIR("?")=" You can enter a list or range of numbers, e.g., 1,3,5 or 1-3,6."
"RTN","RGPOC",38,0)
 D ^DIR G:$D(DIRUT) END S RGANS=$S(Y[7:7,1:Y)
"RTN","RGPOC",39,0)
 ;
"RTN","RGPOC",40,0)
MAIN ;Direct flow based on variable RGANS.
"RTN","RGPOC",41,0)
 S RGQUIT=0
"RTN","RGPOC",42,0)
 I RGANS["1" D POC1^RGPOC1
"RTN","RGPOC",43,0)
 I RGANS["2" D POC2^RGPOC1
"RTN","RGPOC",44,0)
 I RGANS["3" D POC3^RGPOC1
"RTN","RGPOC",45,0)
 I RGANS["4" D POC4^RGPOC1
"RTN","RGPOC",46,0)
 I RGANS["5" D POC5^RGPOC1
"RTN","RGPOC",47,0)
 I RGANS["6" D POC6^RGPOC1
"RTN","RGPOC",48,0)
 I RGANS="7" S (RGADMOFN,RGAD2OFN,RGIRMOFN,RGIR2OFN,RGHL7OFN)="" D
"RTN","RGPOC",49,0)
 .D POC1^RGPOC1 Q:RGADMONM=-1  Q:RGADMOFN=-1
"RTN","RGPOC",50,0)
 .D POC2^RGPOC1 Q:RGAD2ONM=-1  Q:RGAD2OFN=-1
"RTN","RGPOC",51,0)
 .D POC3^RGPOC1 Q:RGIRMONM=-1  Q:RGIRMOFN=-1
"RTN","RGPOC",52,0)
 .D POC4^RGPOC1 Q:RGIR2ONM=-1  Q:RGIR2OFN=-1
"RTN","RGPOC",53,0)
 .D POC5^RGPOC1 Q:RGHL7ONM=-1  Q:RGHL7OFN=-1
"RTN","RGPOC",54,0)
 .D POC6^RGPOC1
"RTN","RGPOC",55,0)
 D SEND
"RTN","RGPOC",56,0)
AGAIN ;Return to selection prompt?
"RTN","RGPOC",57,0)
 I RGQUIT=1 D END Q
"RTN","RGPOC",58,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you want to add/edit another contact"
"RTN","RGPOC",59,0)
 D ^DIR I +Y=1 D END W @IOF G ASK
"RTN","RGPOC",60,0)
 D END
"RTN","RGPOC",61,0)
 Q
"RTN","RGPOC",62,0)
 ;
"RTN","RGPOC",63,0)
SEND ;Send message to Data Management Team
"RTN","RGPOC",64,0)
 Q:'$O(RGARRAY(0))
"RTN","RGPOC",65,0)
 ;Display changed fields.
"RTN","RGPOC",66,0)
 W @IOF,!,"The following data will be transmitted to the MPI/PD Data Management team.",!
"RTN","RGPOC",67,0)
 S RGNUM=0
"RTN","RGPOC",68,0)
 F  S RGNUM=$O(RGARRAY(RGNUM)) Q:'RGNUM  W !,RGARRAY(RGNUM)
"RTN","RGPOC",69,0)
 ;
"RTN","RGPOC",70,0)
DOMAIN ;Determine test or production account (production must have
"RTN","RGPOC",71,0)
 ;"MPI-AUSTIN.VA.GOV" domain for logical link "MPIVA").
"RTN","RGPOC",72,0)
 ;Get logical link IEN for "MPIVA".
"RTN","RGPOC",73,0)
 ;Get domain for "MPIVA" logical link in HL LOGICAL LINK (#870) file.
"RTN","RGPOC",74,0)
 N RGDOMAIN,RGDMNC S RGDOMAIN=""
"RTN","RGPOC",75,0)
 D LINK^HLUTIL3("200M",.HLL,"I")
"RTN","RGPOC",76,0)
 S IEN=$O(HLL(0)) I +IEN>0 S RGDOMAIN=$$GET1^DIQ(870,+IEN_",",.03)
"RTN","RGPOC",77,0)
 S RGDMNC=$$FIND1^DIC(4.2,"","MQ","MPI-AUSTIN.VA.GOV") I RGDMNC>0 S RGDMNC=$$GET1^DIQ(4.2,RGDMNC_",",.01)
"RTN","RGPOC",78,0)
 I RGDOMAIN="" Q
"RTN","RGPOC",79,0)
 I RGDOMAIN'=RGDMNC W !!,"No data will be transmitted from a TEST account." Q  ;Not production; quit SEND.
"RTN","RGPOC",80,0)
 ;
"RTN","RGPOC",81,0)
 ;Transmit e-mail message.
"RTN","RGPOC",82,0)
 S XMSUB="POINT OF CONTACT CHANGE - SITE "_$P($$SITE^VASITE(),"^",3)
"RTN","RGPOC",83,0)
 S XMDUZ=DUZ ;name of person editing the option
"RTN","RGPOC",84,0)
 S XMY("G.MPI/PD POC UPDATE@MPI-AUSTIN.MED.VA.GOV")=""
"RTN","RGPOC",85,0)
 S XMTEXT="RGARRAY("
"RTN","RGPOC",86,0)
 ;
"RTN","RGPOC",87,0)
 S RGARRAY(1)="There has been a change in the point of contact information from"
"RTN","RGPOC",88,0)
 S RGARRAY(2)=$P($$SITE^VASITE(),"^",2)_" (station number "_$P($$SITE^VASITE(),"^",3)_")."
"RTN","RGPOC",89,0)
 S RGARRAY(3)=""
"RTN","RGPOC",90,0)
 D ^XMD
"RTN","RGPOC",91,0)
 W !!,"Sending information to the MPI/PD Data Management team now.",!
"RTN","RGPOC",92,0)
 Q
"RTN","RGPOC",93,0)
 ;
"RTN","RGPOC",94,0)
END ;Kill variables 
"RTN","RGPOC",95,0)
 K DA,DIC,DIE,DIR,DIRUT,DR,DTOUT,HLL,IEN,RGAD2NFN,RGAD2NNM,RGAD2OFN,RGAD2ONM,RGADMNFN
"RTN","RGPOC",96,0)
 K RGADMNNM,RGADMOFN,RGADMONM,RGANS,RGARRAY,RGDATA,RGDOMAIN,RGHL2NFN,RGHL2NNM,RGHL2OFN
"RTN","RGPOC",97,0)
 K RGHL2ONM,RGHL7NFN,RGHL7NNM,RGHL7OFN,RGHL7ONM,RGIR2NFN,RGIR2NNM,RGIR2OFN,RGIR2ONM
"RTN","RGPOC",98,0)
 K RGIRMNFN,RGIRMNNM,RGIRMOFN,RGIRMONM,RGNUM,RGQUIT,X,XMDUZ,XMSUB,XMTEXT,XMY,Y
"RTN","RGPOC",99,0)
 Q
"RTN","RGPOC",100,0)
 ;
"RTN","RGPOC",101,0)
NAME(RGPC,RGFLD) ;Edit IEN of POC from CIRN SITE PARAMETER (#991.8) file.
"RTN","RGPOC",102,0)
 ;RGPC -  piece number of POC on the ^RGSITE(991.8,1,"POC" node
"RTN","RGPOC",103,0)
 ;RGFLD - field number of POC to be used in the DR string
"RTN","RGPOC",104,0)
 ;Returns POC IEN before edit^POC IEN after edit OR -1^error message
"RTN","RGPOC",105,0)
 ;
"RTN","RGPOC",106,0)
 N RGOLDNAM,RGNEWNAM
"RTN","RGPOC",107,0)
 S RGOLDNAM=$P($G(^RGSITE(991.8,1,"POC")),"^",RGPC)
"RTN","RGPOC",108,0)
 L +^RGSITE(991.8):10
"RTN","RGPOC",109,0)
 S DIE="^RGSITE(991.8,",DA=1,DR=RGFLD
"RTN","RGPOC",110,0)
 D ^DIE K DA,DIE,DR
"RTN","RGPOC",111,0)
 L -^RGSITE(991.8)
"RTN","RGPOC",112,0)
 I $D(DTOUT)&(RGOLDNAM="") Q "-1^USER TIMED OUT"
"RTN","RGPOC",113,0)
 I $D(Y) Q "-1^USER UP-ARROWED OUT"
"RTN","RGPOC",114,0)
 S RGNEWNAM=$P($G(^RGSITE(991.8,1,"POC")),"^",RGPC)
"RTN","RGPOC",115,0)
 Q RGOLDNAM_"^"_RGNEWNAM
"RTN","RGPOC",116,0)
 ;
"RTN","RGPOC",117,0)
PHONE(RGIEN) ;Edit POC COMMERCIAL PHONE (#.135) from NEW PERSON (#200) file.
"RTN","RGPOC",118,0)
 ;Supported IA #10060 allows read/FileMan for all fields in ^VA(200
"RTN","RGPOC",119,0)
 ;RGIEN - IEN for NEW PERSON for whom phone number is needed
"RTN","RGPOC",120,0)
 ;Returns POC COMMERCIAL PHONE before edit^POC COMMERCIAL PHONE after edit
"RTN","RGPOC",121,0)
 ;
"RTN","RGPOC",122,0)
 N RGOLDFON,RGNEWFON
"RTN","RGPOC",123,0)
 S RGOLDFON=$$GET1^DIQ(200,RGIEN,.135)
"RTN","RGPOC",124,0)
 S RGOLDFON=$TR(RGOLDFON,",./<>?;:'[]\{}|`~!@#$%^&*-_=+","                              ")
"RTN","RGPOC",125,0)
 S RGOLDFON=$TR(RGOLDFON,"()","")
"RTN","RGPOC",126,0)
 ;Edit COMMERCIAL PHONE (#.135), NEW PERSON (#200) file
"RTN","RGPOC",127,0)
 ;IA #2589 allows write/FileMan to field .135 in ^VA(200,
"RTN","RGPOC",128,0)
 L +^VA(200,RGIEN):10
"RTN","RGPOC",129,0)
 S DIE="^VA(200,",DA=RGIEN,DR=.135
"RTN","RGPOC",130,0)
 D ^DIE K DA,DIE,DR
"RTN","RGPOC",131,0)
 L -^VA(200,RGIEN)
"RTN","RGPOC",132,0)
 I $D(DTOUT)&(RGOLDFON="") Q "-1^USER TIMED OUT"
"RTN","RGPOC",133,0)
 I $D(Y) Q "-1^USER UP-ARROWED OUT"
"RTN","RGPOC",134,0)
 S RGNEWFON=$$GET1^DIQ(200,RGIEN,.135)
"RTN","RGPOC",135,0)
 S RGNEWFON=$TR(RGNEWFON,",./<>?;:'[]\{}|`~!@#$%^&*-_=+","                             ")
"RTN","RGPOC",136,0)
 S RGNEWFON=$TR(RGNEWFON,"()","")
"RTN","RGPOC",137,0)
 Q RGOLDFON_"^"_RGNEWFON
"RTN","RGPOC",138,0)
 ;
"RTN","RGPOC",139,0)
CNVRTNM(NAME) ;Convert IEN from NEW PERSON (#200) to printable name
"RTN","RGPOC",140,0)
 ;NAME - ien for POC
"RTN","RGPOC",141,0)
 N RGNAME
"RTN","RGPOC",142,0)
 I NAME="" Q "<NULL>"
"RTN","RGPOC",143,0)
 S RGNAME=$$GET1^DIQ(200,NAME,.01)
"RTN","RGPOC",144,0)
 Q RGNAME
"RTN","RGPOC",145,0)
 ;
"RTN","RGPOC",146,0)
ERROR1(RGPOC) ;Write error message 1 for type POC.
"RTN","RGPOC",147,0)
 W !!,"No "_RGPOC_" Point of Contact identified."
"RTN","RGPOC",148,0)
 Q
"RTN","RGPOC",149,0)
 ;
"RTN","RGPOC",150,0)
ERROR2(RGPOC,RGFLD,RGOLDNAM,RGNEWNAM) ;Write error message 2 for type POC.
"RTN","RGPOC",151,0)
 W !!,"No "_RGPOC_" Point of Contact phone number identified."
"RTN","RGPOC",152,0)
 ;User timed out or up-arrowed out on phone number.
"RTN","RGPOC",153,0)
 ;Restore name value to original value, if value changed.
"RTN","RGPOC",154,0)
 I RGOLDNAM=RGNEWNAM K RGFLD,RGOLDNAM,RGNEWNAM,RGPOC Q
"RTN","RGPOC",155,0)
 L +^RGSITE(991.8):10
"RTN","RGPOC",156,0)
 S DIE="^RGSITE(991.8,",DA=1,DR=RGFLD_"///^S X=$S(RGOLDNAM="""":""@"",1:RGOLDNAM)"
"RTN","RGPOC",157,0)
 D ^DIE
"RTN","RGPOC",158,0)
 L -^RGSITE(991.8)
"RTN","RGPOC",159,0)
 K DA,DIE,DR,RGFLD,RGOLDNAM
"RTN","RGPOC",160,0)
 W !,RGPOC_" Point of Contact restored to original value."
"RTN","RGPOC",161,0)
 Q
"RTN","RGPOC",162,0)
 ;
"VER")
8.0^22.0
**END**
**END**
