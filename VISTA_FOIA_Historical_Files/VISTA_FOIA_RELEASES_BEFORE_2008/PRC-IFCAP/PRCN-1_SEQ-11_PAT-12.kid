Released PRCN*1*12 SEQ #11
Extracted from mail message
**KIDS**:PRCN*1.0*12^

**INSTALL NAME**
PRCN*1.0*12
"BLD",4676,0)
PRCN*1.0*12^EQUIPMENT/TURN-IN REQUIEST^0^3030723^y
"BLD",4676,1,0)
^^5^5^3030723^
"BLD",4676,1,1,0)
This patch addresses 3 issues. The first problem occurs when using the 
"BLD",4676,1,2,0)
option Enter New New Equipment Requests [PRCN NX NEW]. The second problem
"BLD",4676,1,3,0)
is an undefined error that occurs when editing replacement information. 
"BLD",4676,1,4,0)
The third problem is an undefined error occurring when requests are 
"BLD",4676,1,5,0)
processed in the option Create 2237 (PPM) [PRCN NX PPM 2237].
"BLD",4676,4,0)
^9.64PA^^0
"BLD",4676,"ABPKG")
n
"BLD",4676,"INID")
^
"BLD",4676,"INIT")

"BLD",4676,"KRN",0)
^9.67PA^8989.52^19
"BLD",4676,"KRN",.4,0)
.4
"BLD",4676,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4676,"KRN",.401,0)
.401
"BLD",4676,"KRN",.401,"NM",0)
^9.68A^^
"BLD",4676,"KRN",.402,0)
.402
"BLD",4676,"KRN",.402,"NM",0)
^9.68A^^
"BLD",4676,"KRN",.403,0)
.403
"BLD",4676,"KRN",.403,"NM",0)
^9.68A^^
"BLD",4676,"KRN",.5,0)
.5
"BLD",4676,"KRN",.5,"NM",0)
^9.68A^^
"BLD",4676,"KRN",.84,0)
.84
"BLD",4676,"KRN",3.6,0)
3.6
"BLD",4676,"KRN",3.8,0)
3.8
"BLD",4676,"KRN",9.2,0)
9.2
"BLD",4676,"KRN",9.8,0)
9.8
"BLD",4676,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",4676,"KRN",9.8,"NM",2,0)
PRCN2237^^0^B16769338
"BLD",4676,"KRN",9.8,"NM",3,0)
PRCNREQE^^0^B8356107
"BLD",4676,"KRN",9.8,"NM",4,0)
PRCNREQN^^0^B13603425
"BLD",4676,"KRN",9.8,"NM","B","PRCN2237",2)

"BLD",4676,"KRN",9.8,"NM","B","PRCNREQE",3)

"BLD",4676,"KRN",9.8,"NM","B","PRCNREQN",4)

"BLD",4676,"KRN",19,0)
19
"BLD",4676,"KRN",19.1,0)
19.1
"BLD",4676,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4676,"KRN",101,0)
101
"BLD",4676,"KRN",101,"NM",0)
^9.68A^^
"BLD",4676,"KRN",409.61,0)
409.61
"BLD",4676,"KRN",771,0)
771
"BLD",4676,"KRN",870,0)
870
"BLD",4676,"KRN",8989.51,0)
8989.51
"BLD",4676,"KRN",8989.52,0)
8989.52
"BLD",4676,"KRN",8994,0)
8994
"BLD",4676,"KRN","B",.4,.4)

"BLD",4676,"KRN","B",.401,.401)

"BLD",4676,"KRN","B",.402,.402)

"BLD",4676,"KRN","B",.403,.403)

"BLD",4676,"KRN","B",.5,.5)

"BLD",4676,"KRN","B",.84,.84)

"BLD",4676,"KRN","B",3.6,3.6)

"BLD",4676,"KRN","B",3.8,3.8)

"BLD",4676,"KRN","B",9.2,9.2)

"BLD",4676,"KRN","B",9.8,9.8)

"BLD",4676,"KRN","B",19,19)

"BLD",4676,"KRN","B",19.1,19.1)

"BLD",4676,"KRN","B",101,101)

"BLD",4676,"KRN","B",409.61,409.61)

"BLD",4676,"KRN","B",771,771)

"BLD",4676,"KRN","B",870,870)

"BLD",4676,"KRN","B",8989.51,8989.51)

"BLD",4676,"KRN","B",8989.52,8989.52)

"BLD",4676,"KRN","B",8994,8994)

"BLD",4676,"QUES",0)
^9.62^^
"BLD",4676,"REQB",0)
^9.611^2^2
"BLD",4676,"REQB",1,0)
PRCN*1.0*1^1
"BLD",4676,"REQB",2,0)
PRCN*1.0*11^1
"BLD",4676,"REQB","B","PRCN*1.0*1",1)

"BLD",4676,"REQB","B","PRCN*1.0*11",2)

"MBREQ")
0
"PKG",461,-1)
1^1
"PKG",461,0)
EQUIPMENT/TURN-IN REQUIEST^PRCN^EQUIPMENT/TURN-IN REQUEST
"PKG",461,20,0)
^9.402P^^
"PKG",461,22,0)
^9.49I^1^1
"PKG",461,22,1,0)
1.0^^2970528^68
"PKG",461,22,1,"PAH",1,0)
12^3030723
"PKG",461,22,1,"PAH",1,1,0)
^^5^5^3030723
"PKG",461,22,1,"PAH",1,1,1,0)
This patch addresses 3 issues. The first problem occurs when using the 
"PKG",461,22,1,"PAH",1,1,2,0)
option Enter New New Equipment Requests [PRCN NX NEW]. The second problem
"PKG",461,22,1,"PAH",1,1,3,0)
is an undefined error that occurs when editing replacement information. 
"PKG",461,22,1,"PAH",1,1,4,0)
The third problem is an undefined error occurring when requests are 
"PKG",461,22,1,"PAH",1,1,5,0)
processed in the option Create 2237 (PPM) [PRCN NX PPM 2237].
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PRCN2237")
0^2^B16769338
"RTN","PRCN2237",1,0)
PRCN2237 ;SSI/SEB,ALA-Create 2237 from completed request ;[ 01/30/97  1:45 PM ]
"RTN","PRCN2237",2,0)
 ;;1.0;Equipment/Turn-In Request;**3,11,12**;Sep 13, 1996
"RTN","PRCN2237",3,0)
EN ;  Entry point to individual 2237
"RTN","PRCN2237",4,0)
 S DIC("S")="I $P(^(0),U,7)=39!($P(^(0),U,7)=18)!($P(^(0),U,7)=19)",DIC="^PRCN(413,"
"RTN","PRCN2237",5,0)
 S DIC(0)="AEQZ" D ^DIC K DIC("S") G EXIT:Y<0 S IN=+Y
"RTN","PRCN2237",6,0)
 S PRCNTMP=$P(^PRCN(413,IN,0),U),P2237N=$S($D(^PRCS(410,"H",PRCNTMP)):0,1:1)
"RTN","PRCN2237",7,0)
 I 'P2237N D
"RTN","PRCN2237",8,0)
 . S DA=$O(^PRCS(410,"H",PRCNTMP,""))
"RTN","PRCN2237",9,0)
 . W !!,"2237 on File - Editing Transaction #: ",$P(^PRCS(410,DA,0),U),! K DA
"RTN","PRCN2237",10,0)
LIST ; Create 2237s for chosen requests
"RTN","PRCN2237",11,0)
 D EN^PRCSUT G W2:'$D(PRC("SITE")) G EXIT:'$D(PRC("QTR"))!(Y<0)
"RTN","PRCN2237",12,0)
 I P2237N D
"RTN","PRCN2237",13,0)
 . D NEW S TDA=IN D LINE
"RTN","PRCN2237",14,0)
 . ;  move justification
"RTN","PRCN2237",15,0)
 . S ^PRCS(410,DA(1),8,0)=^PRCN(413,TDA,36,0)
"RTN","PRCN2237",16,0)
 . S PRCNJ=0 F  S PRCNJ=$O(^PRCN(413,TDA,36,PRCNJ)) Q:'PRCNJ  S ^PRCS(410,DA(1),8,PRCNJ,0)=^PRCN(413,TDA,36,PRCNJ,0)
"RTN","PRCN2237",17,0)
 . K DR S (DIC,DIE)="^PRCS(410,",DA=DA(1)
"RTN","PRCN2237",18,0)
 . I $G(PRCNVNDR)'="",PRCNVNDR?.N S PRCNVNDR=$P(^PRC(440,PRCNVNDR,0),U)
"RTN","PRCN2237",19,0)
 . S DR="56///^S X=60;11//^S X=$G(PRCNVNDR);11.1;11.2;11.3;11.4;11.5;11.6;11.7;11.8;11.9;13" D ^DIE
"RTN","PRCN2237",20,0)
 . I $D(^PRCS(410,DA(1),"IT",1)) S ^PRCS(410,DA(1),10)=$O(^PRCS(410,DA(1),"IT",99),-1)_U_$P(^PRCS(410,DA(1),10),U,2,99)
"RTN","PRCN2237",21,0)
 I 'P2237N D
"RTN","PRCN2237",22,0)
 . S DA=$O(^PRCS(410,"H",PRCNTMP,"")),(DIC,DIE)="^PRCS(410,"
"RTN","PRCN2237",23,0)
 . S DR="[PRCN2237E]" D ^DIE
"RTN","PRCN2237",24,0)
 D CMP I $G(QFL)=1 W !!,$C(7),"2237 information is incomplete" G EXIT
"RTN","PRCN2237",25,0)
 D W61^PRCSEB I $G(%)=2 G EXIT
"RTN","PRCN2237",26,0)
 I $P($G(^PRCS(410,D0,7)),U,5)=""!($P($G(^(7)),U,7)="") G EXIT
"RTN","PRCN2237",27,0)
 I +$G(SPENDCP)=0 D
"RTN","PRCN2237",28,0)
 . S (DIE,DIC)="^PRCN(413,",DA=IN S:$G(PRCNT1)="" PRCNT1=$O(^PRCS(410,"H",PRCNTMP,""))
"RTN","PRCN2237",29,0)
 . S DR="6///^S X=34;7///^S X=DT;50////^S X=PRCNT1" D ^DIE
"RTN","PRCN2237",30,0)
 G EXIT
"RTN","PRCN2237",31,0)
NEW ; Create new 2237 and fill in info from a finished request
"RTN","PRCN2237",32,0)
 D EN1^PRCSUT3 G NQ:'X S X1=X D EN2^PRCSUT3 G NQ:'$D(X1) S X=X1,T1=DA
"RTN","PRCN2237",33,0)
 W !!,"This transaction is assigned transaction number: ",X
"RTN","PRCN2237",34,0)
 D LOCK^PRCSUT
"RTN","PRCN2237",35,0)
 S PRCNT1=T1,DIC="^PRCS(410,"
"RTN","PRCN2237",36,0)
 I $P(^PRCN(413,IN,0),U,14)'="" S SRTGRP=$P(^PRCN(413,IN,0),U,14)_";PRCS(410.7,"
"RTN","PRCN2237",37,0)
 S DIE=DIC,DR="[PRCN2237]" D ^DIE
"RTN","PRCN2237",38,0)
NQ K DIE,DA,DR,T1,X,X1 Q
"RTN","PRCN2237",39,0)
W2 W $C(7),!!,"You are not an authorized control point user."
"RTN","PRCN2237",40,0)
 W !,"Contact your control point official." S NGF=1
"RTN","PRCN2237",41,0)
EXIT K %,C,D,DA,DIC,DIE,DQ,DR,PRCS,PRCS2,PRCSDAA,PRCSDR,PRCSL,PRCSTT,I,N
"RTN","PRCN2237",42,0)
 K T,T1,T2,X,X1,PRCSX3,Y,PRCNTMP,QTY,COST,P2237N,PRCNT1,PRCNVNDR,TEST1
"RTN","PRCN2237",43,0)
 K IN,PRC,CURQTR,CURQTR1,PRCHQ,PRCSN,PRCST,PRCST1,SPENDCP,STRING,TEST
"RTN","PRCN2237",44,0)
 K %W,D0,DIW,DIWI,DIWT,DIWTC,DIWX,DN,OK,P1,PRCNJ,PRCSCP,PRCSERR,UTYP
"RTN","PRCN2237",45,0)
 K PRCSPG,PRCSQT,RECORD,RECORD1,RECORD10,RECORD2,RECORD3,RECORD4
"RTN","PRCN2237",46,0)
 K SKIPRNT,STKNO,TDA,TRNODE,XNAME,JUMP,POP,PRCSCST,QFL,PDD1,SRTGRP
"RTN","PRCN2237",47,0)
 Q
"RTN","PRCN2237",48,0)
LINE ; Line item copier, called from [PRCN2237] input template
"RTN","PRCN2237",49,0)
 ;NEW DIEL,Y,DG,DI,DK,DL,DM,DP,DU,D0,D1,DA,DIC,DIE,DR,DOV
"RTN","PRCN2237",50,0)
CPLINE ; Create a line item in 2237 and copy over line item from request
"RTN","PRCN2237",51,0)
 N I S (I,C)=0 F  S I=$O(^PRCN(413,TDA,1,"B",I)) Q:I'>0  S C=C+1
"RTN","PRCN2237",52,0)
 S DA=0 F  S DA=$O(^PRCN(413,TDA,1,DA)) Q:'DA  S LI=DA D L2 D  Q:$D(DUOUT)
"RTN","PRCN2237",53,0)
 . W !!,"Line Item #",DA,":",!,"Description:"
"RTN","PRCN2237",54,0)
 . F II=1:1 Q:'$D(^PRCN(413,IN,1,LI,1,II))  S DL=^(II,0) D
"RTN","PRCN2237",55,0)
 .. W !,"    ",DL S ^PRCS(410,DA(1),"IT",LI,1,II,0)=DL
"RTN","PRCN2237",56,0)
 . W ! S ^PRCS(410,DA(1),"IT",LI,1,0)="^^"_(II-1)_U_(II-1)_U_DT
"RTN","PRCN2237",57,0)
 . I $P(^PRCN(413,IN,1,LI,0),U,12)="P",$P(^(0),U,2)'="" S PRCNVNDR=$P(^(0),U,2)
"RTN","PRCN2237",58,0)
 . I $G(PRCNVNDR)="" S PRCNVNDR=$P(^PRCN(413,IN,1,LI,0),U,13)
"RTN","PRCN2237",59,0)
 . D ^DIC Q:$G(DUOUT)=1!($G(DTOUT)=1)  D ^DIE
"RTN","PRCN2237",60,0)
 K C,DLAYGO,DL,II,LI
"RTN","PRCN2237",61,0)
 Q
"RTN","PRCN2237",62,0)
L2 S DA(1)=PRCNT1,DIC(0)="LZ",DLAYGO=410,X=DA
"RTN","PRCN2237",63,0)
 S (DIE,DIC)="^PRCS(410,"_DA(1)_",""IT"","
"RTN","PRCN2237",64,0)
 I '$D(@(DIC_"0)")) S @(DIC_"0)")="^410.02AI^0^0"
"RTN","PRCN2237",65,0)
 D FILE^DICN
"RTN","PRCN2237",66,0)
 S QTY=$S($P(^PRCN(413,IN,1,LI,0),U,7)'="":$P(^(0),U,7),1:$P(^PRCN(413,IN,1,LI,0),U,5))
"RTN","PRCN2237",67,0)
 S COST=$P(^PRCN(413,IN,1,LI,0),U,4),STKNO=$P(^(0),U,3)
"RTN","PRCN2237",68,0)
 ; Special DRs to automatically copy line items from request
"RTN","PRCN2237",69,0)
 S UTYP=$O(^PRCD(420.5,"B","EA","")) S:UTYP="" UTYP="EA"
"RTN","PRCN2237",70,0)
 S (DR(1,410.02),DR)="2////^S X=QTY;3////^S X=UTYP;7////^S X=COST;4;6//^S X=STKNO;K PRCSV;10;S PRCSDR=""[2237]"""
"RTN","PRCN2237",71,0)
 S DR(1,410.02,1)="S PRCSVAR=$S($D(^PRCS(410,DA(1),""IT"",0)):^(0),1:"""");K PRCSV D 2^PRCSCK;I $D(PRCSERR)&PRCSERR S Y=""@1"" K PRCSERR;D QRB^PRCSCK;12;K PRCSMDP;"
"RTN","PRCN2237",72,0)
 Q
"RTN","PRCN2237",73,0)
CMP ;  Check for completeness of data
"RTN","PRCN2237",74,0)
 S PDD1=0 F  S PDD1=$O(^PRCS(410,D0,"IT",PDD1)) Q:'PDD1  D CMPD Q:QFL
"RTN","PRCN2237",75,0)
 Q
"RTN","PRCN2237",76,0)
CMPD S QFL=0 F I=1,2,3,4,7 I $P(^PRCS(410,D0,"IT",PDD1,0),U,I)="" S QFL=1
"RTN","PRCN2237",77,0)
 Q
"RTN","PRCNREQE")
0^3^B8356107
"RTN","PRCNREQE",1,0)
PRCNREQE ;SSI/ALA,SEB-Edit a NX Request ;[ 02/06/97  11:55 AM ]
"RTN","PRCNREQE",2,0)
 ;;1.0;Equipment/Turn-In Request;**3,11,12**;Sep 13, 1996
"RTN","PRCNREQE",3,0)
EN S DIC="^PRCN(413,",DIC(0)="AEQZ"
"RTN","PRCNREQE",4,0)
 I $G(PRCNCMF)="" S DIC("S")="S ST=$P(^(0),U,7) I ST=1!(ST=3)!(ST=4)!(ST=11)!(ST=12)!(ST=15)&($P(^(0),U,2)=DUZ)"
"RTN","PRCNREQE",5,0)
 I $G(PRCNCMF)'="" D
"RTN","PRCNREQE",6,0)
 . S PRCNC=DUZ D CMR^PRCNCMR K PRCNC
"RTN","PRCNREQE",7,0)
 . F JJ=1:1 S PRCNC=$P(PRCNCMR,U,JJ) Q:PRCNC=""  S PRCNCMR(PRCNC)=""
"RTN","PRCNREQE",8,0)
 . S DIC("S")="S ST=$P(^(0),U,7),CMRZ=$P(^(0),U,16) I ST=1!(ST=3)!(ST=5)!(ST=4)!(ST=11)!(ST=45)!(ST=17)!(ST=18)!(ST=15)&($D(PRCNCMR(CMRZ)))"
"RTN","PRCNREQE",9,0)
 D ^DIC K DIC("S") G EQ:Y<0 S IN=+Y,PRCNUSR=0 D SETUP^PRCNPRNT
"RTN","PRCNREQE",10,0)
 I $P($G(^PRCN(413,IN,2)),U,16)]"" S $P(^(2),U,16)="" K ^PRCN(413,IN,15)
"RTN","PRCNREQE",11,0)
EDIT ; Edit the transaction if desired
"RTN","PRCNREQE",12,0)
 W !,"Do you want to edit this request" S %=2 D YN^DICN G EDIT:%=0
"RTN","PRCNREQE",13,0)
 G EQ:%'=1
"RTN","PRCNREQE",14,0)
 K NEW S DIE=413,DIE("NO^")="OUTOK",DR="[PRCNEDIT]",DA=IN D ^DIE
"RTN","PRCNREQE",15,0)
 I PRCNTY="R" D
"RTN","PRCNREQE",16,0)
 . I $G(TDA)="" S TDA=$P(^PRCN(413,DA,0),U,11)
"RTN","PRCNREQE",17,0)
 . I $G(PRCNTDA)="" S PRCNTDA=TDA
"RTN","PRCNREQE",18,0)
 .  Q:$O(^PRCN(413.1,PRCNTDA,1,0))=""
"RTN","PRCNREQE",19,0)
 . S EDIT=2,DIE=413.1,DR="[PRCNTIRQ]",DA=PRCNTDA D ^DIE
"RTN","PRCNREQE",20,0)
EQ K DIC,DIE,DA,DR,IN,PRCNUSR,PRCNQT,PRCNTXT,PRCNTY,PRCNCMR,CMRZ,ST,STA
"RTN","PRCNREQE",21,0)
 K J,JJ,PRCN,PRCNC,VEN,PRCNTDA,D1,PFL,QTY,RDA,RDI,TDA,EDIT
"RTN","PRCNREQE",22,0)
 Q
"RTN","PRCNREQE",23,0)
LINE ; Display associated replacement line items
"RTN","PRCNREQE",24,0)
 S RDA=D0,RDI=D1,QTY=$P($G(^PRCN(413,RDA,1,RDI,0)),U,5)
"RTN","PRCNREQE",25,0)
EN1 N DIEL,DG,DI,DK,DL,DM,DP,DU,D0,D1,DA,DIC,DIE,DR,DQ,X,Y,DV,DOV
"RTN","PRCNREQE",26,0)
 S DIC("S")="I $P(^(0),U,3)=RDI",DA(1)=TDA,DIC(0)="AEQZ",DIC("A")="Select Replacement Line Item: "
"RTN","PRCNREQE",27,0)
 S PRCNCMR=$P(^PRCN(413.1,TDA,0),U,16)
"RTN","PRCNREQE",28,0)
 S DIC="^PRCN(413.1,"_TDA_",1," D ^DIC Q:Y<1  S RI=$P(Y,U,2),DA=+Y D DISP^PRCNTIRQ K DIC("S")
"RTN","PRCNREQE",29,0)
 S DIE("NO^")=""
"RTN","PRCNREQE",30,0)
 S DR=".01;.5Replacement Justification~;I X'=6 S Y="""";.7",DIE=DIC D ^DIE
"RTN","PRCNREQE",31,0)
 D CT I NUM<QTY D
"RTN","PRCNREQE",32,0)
 . W !,"Number of replacement items does not equal quantity"
"RTN","PRCNREQE",33,0)
 . S NM=$P($G(^PRCN(413.1,TDA,1,0)),U,3)
"RTN","PRCNREQE",34,0)
 . I NM="" S ^PRCN(413.1,TDA,1,0)="^413.11IPA^^"
"RTN","PRCNREQE",35,0)
 . D RP2^PRCNREQN
"RTN","PRCNREQE",36,0)
EXIT K TDA,RDA,RI,DA,DIE,DIC,DR
"RTN","PRCNREQE",37,0)
 Q
"RTN","PRCNREQE",38,0)
CT S NUM=0,NN="" F  S NN=$O(^PRCN(413.1,TDA,1,"AC",RDI,NN)) Q:NN=""  S NUM=NUM+1
"RTN","PRCNREQE",39,0)
 Q
"RTN","PRCNREQE",40,0)
TXT ;  Set first 20 characters into Short Description field
"RTN","PRCNREQE",41,0)
 S $P(^PRCN(413,D0,0),U,18)=""
"RTN","PRCNREQE",42,0)
 S PRCNTXT=$G(^PRCN(413,D0,1,1,1,1,0))
"RTN","PRCNREQE",43,0)
 I $L(PRCNTXT)>20 S PRCNTXT=$E(PRCNTXT,1,20)
"RTN","PRCNREQE",44,0)
 S VEN=$P($G(^PRCN(413,D0,1,D1,0)),U,2) S:VEN'="" VEN=$P(^PRC(440,VEN,0),U)
"RTN","PRCNREQE",45,0)
 S VEN=$S($G(VEN)="":$P($G(^PRCN(413,D0,1,D1,0)),U,13),1:VEN)
"RTN","PRCNREQE",46,0)
 Q
"RTN","PRCNREQE",47,0)
CMP ;  Check for completeness of data
"RTN","PRCNREQE",48,0)
 S PFL=0
"RTN","PRCNREQE",49,0)
 S PDD1=D1 D CMPD Q:QFL
"RTN","PRCNREQE",50,0)
 S PDD1=0 F  S PDD1=$O(^PRCN(413,D0,1,PDD1)) Q:'PDD1  D CMPD Q:QFL
"RTN","PRCNREQE",51,0)
 I $P(^PRCN(413,D0,0),U,9)'="R" S PFL=1
"RTN","PRCNREQE",52,0)
 Q
"RTN","PRCNREQE",53,0)
CMPD S QFL=0
"RTN","PRCNREQE",54,0)
 Q:'$D(^PRCN(413,D0,1,PDD1))
"RTN","PRCNREQE",55,0)
 F I=1,4,5,12 I $P(^PRCN(413,D0,1,PDD1,0),U,I)="" S QFL=1 Q
"RTN","PRCNREQE",56,0)
 I $P(^PRCN(413,D0,1,PDD1,0),U,12)="P" S PFL=1
"RTN","PRCNREQE",57,0)
 Q
"RTN","PRCNREQN")
0^4^B13603425
"RTN","PRCNREQN",1,0)
PRCNREQN ;SSI/ALA-Enter a New Equipment Request ;[ 11/07/96  5:06 PM ]
"RTN","PRCNREQN",2,0)
 ;;1.0;Equipment/Turn-In Request;**1,12**;Sep 13, 1996
"RTN","PRCNREQN",3,0)
EN D NOW^%DTC S PRCNDTM=% K %I,%H
"RTN","PRCNREQN",4,0)
 D FYQ^PRCNUTL S PRCF("X")="S",PRC("MDIV")=1 D ^PRCFSITE G EQ:'$D(PRC("SITE"))
"RTN","PRCNREQN",5,0)
 S DIC("A")="Select CMR: ",DIC(0)="AEQZ",DIC="^ENG(6914.1," D ^DIC G EQ:Y<1
"RTN","PRCNREQN",6,0)
 S PRCN("CMR")=$P(Y(0),U),PRCNCMR=+Y,PRCNSRV=$P(Y(0),U,5)
"RTN","PRCNREQN",7,0)
 S PRCNRSP=$P(Y(0),U,2) I PRCNRSP="" W !!,"This CMR has no responsible official",$C(7) G EN
"RTN","PRCNREQN",8,0)
 I PRCNSRV="" D  G EQ:Y<1
"RTN","PRCNREQN",9,0)
 . S DIC="^DIC(49," D ^DIC S PRCNSRV=+Y
"RTN","PRCNREQN",10,0)
 K DIC,Y,PRCNRSP
"RTN","PRCNREQN",11,0)
 ;  Build next sequential number (PRCNDA) from site, CMR, fiscal year
"RTN","PRCNREQN",12,0)
 S TST=PRC("SITE")_"-"_PRCN("CMR")_"-"_PRC("FY") D SEQ^PRCNUTL
"RTN","PRCNREQN",13,0)
 S PRCNTRN=TST_"-"_$E("00000",$L(PRCNDA)+1,5)_PRCNDA,X=PRCNTRN
"RTN","PRCNREQN",14,0)
 S DIC="^PRCN(413,",DIC(0)="L",DLAYGO=413 D FILE^DICN S (DA,PRCNRDA)=+Y
"RTN","PRCNREQN",15,0)
 W !!,"This Request has been assigned Transaction #: ",PRCNTRN,!
"RTN","PRCNREQN",16,0)
 ;  Set defaulted information into file for this transaction
"RTN","PRCNREQN",17,0)
 S DIE=413,DIE("NO^")="OUTOK",DR="[PRCNEDIT]",NEW=1 D ^DIE
"RTN","PRCNREQN",18,0)
 I $G(PRCNTY)="" S DIK="^PRCN(413," D ^DIK G EQ
"RTN","PRCNREQN",19,0)
 I PRCNTY="R" D
"RTN","PRCNREQN",20,0)
 . I $G(TDA)="" S TDA=$P(^PRCN(413,DA,0),U,11)
"RTN","PRCNREQN",21,0)
 . I $G(PRCNTDA)="" S PRCNTDA=TDA
"RTN","PRCNREQN",22,0)
 . Q:$O(^PRCN(413.1,PRCNTDA,1,0))=""
"RTN","PRCNREQN",23,0)
 . S EDIT=2,DIE=413.1,DR="[PRCNTIRQ]",DA=PRCNTDA D ^DIE
"RTN","PRCNREQN",24,0)
EQ K C,D,NEW,PRC,PRCN,PRCNCMR,PRCNDA,PRCNSRV,PRCNTRN,PRCNTY,TST,DIWF,HL0
"RTN","PRCNREQN",25,0)
 K D0,DA,DIC,DIE,DLAYGO,DR,PRCNRDA,PRCNTDA,PRCF,PRCNDTM,I,LL,PL,PRCNQT
"RTN","PRCNREQN",26,0)
 K PRCNTXT,PRCNCT,PRCNPJT,J,D1,PRCNRTN,PRCNTYP,RDA,RDI,TDA
"RTN","PRCNREQN",27,0)
 K PRCNTDA,EDIT,PFL,QTY
"RTN","PRCNREQN",28,0)
 Q
"RTN","PRCNREQN",29,0)
REP ;   Build replacement entries for Turn-In request
"RTN","PRCNREQN",30,0)
 S RDA=D0,RDI=D1,NUM=0
"RTN","PRCNREQN",31,0)
 S QTY=$P(^PRCN(413,RDA,1,RDI,0),U,5),PRCNTYP=$P(^(0),U,12)
"RTN","PRCNREQN",32,0)
 S NM=$P($G(^PRCN(413.1,TDA,1,0)),U,3)
"RTN","PRCNREQN",33,0)
 I QTY>1 W !!,"A replacement item must be entered for each quantity requested.",!
"RTN","PRCNREQN",34,0)
 I $G(PRCNCMR)="" S PRCNCMR=$P(^PRCN(413,RDA,0),U,16)
"RTN","PRCNREQN",35,0)
 I NM="" S ^PRCN(413.1,TDA,1,0)="^413.11IPA^^"
"RTN","PRCNREQN",36,0)
RP2 S NM=NM+1,NUM=NUM+1
"RTN","PRCNREQN",37,0)
 G RPX:NUM>QTY
"RTN","PRCNREQN",38,0)
 S RQ=RDI,$P(^PRCN(413.1,TDA,1,0),U,3,4)=NM_U_NM
"RTN","PRCNREQN",39,0)
 NEW DIEL,DI,DK,DL,DM,DP,DU,DIC,DIE,DA,D0,D1,D,DR,Y,DQ,DIFLD,DOV,DE,DC,DG,DH,DN,DV
"RTN","PRCNREQN",40,0)
 D GNX Q:$G(DUOUT)=1
"RTN","PRCNREQN",41,0)
 G RP2
"RTN","PRCNREQN",42,0)
GNX W !!,"Select the Replacement Item to correspond with Line Item # "_RQ_" Quantity: "_NUM
"RTN","PRCNREQN",43,0)
 S DIC("A")="Select REPLACEMENT ITEM: ",DIC="^ENG(6914,",DIC(0)="AEMQZ"
"RTN","PRCNREQN",44,0)
 S DIC("S")="I $P($G(^(2)),U,9)=PRCNCMR"
"RTN","PRCNREQN",45,0)
GID D ^DIC I Y<1&(PRCNTYP="C") Q
"RTN","PRCNREQN",46,0)
 Q:$G(DUOUT)=1
"RTN","PRCNREQN",47,0)
 I Y<1&(PRCNTYP="P") W !,$C(7),"You MUST select the Item that is being replaced for a Parent!" G GNX
"RTN","PRCNREQN",48,0)
 S RI=+Y,RIDSC=$P(Y(0),U,2) D DISP^PRCNTIRQ K DIC("S")
"RTN","PRCNREQN",49,0)
 I $D(^PRCN(413.1,"AB",RI)) W $C(7),!!,"This ITEM "_RIDSC_" already has a request on file!" K RI G GNX
"RTN","PRCNREQN",50,0)
 K ^UTILITY($J,"W") S DIWR=70,DIWL=1,DIWF=""
"RTN","PRCNREQN",51,0)
 S X="Are you sure that "_RIDSC_" is the correct item being replaced by requested item, " D ^DIWP
"RTN","PRCNREQN",52,0)
 S RQD=0 F  S RQD=$O(^PRCN(413,RDA,1,RQ,1,RQD)) Q:RQD'>0  S X=^PRCN(413,RDA,1,RQ,1,RQD,0) D ^DIWP
"RTN","PRCNREQN",53,0)
 F I=1:1:^UTILITY($J,"W",DIWL) W !,^UTILITY($J,"W",DIWL,I,0)
"RTN","PRCNREQN",54,0)
G1 W " " D YN^DICN I %=0 W !,"Enter 'Yes' to match the replacement item with item being requested." G G1
"RTN","PRCNREQN",55,0)
 I %=2 K RI,X,RIDSC G GID
"RTN","PRCNREQN",56,0)
 I %<0 Q
"RTN","PRCNREQN",57,0)
 NEW DIEL,DI,DK,DL,DM,DP,DU,DIC,DIE,DA,D0,D1,D,DR,Y,DQ,DIFLD,DOV,DE,DC,DG,DH,DN,DV
"RTN","PRCNREQN",58,0)
 S DA(1)=TDA,DA=NM,DIC="^PRCN(413.1,"_DA(1)_",1,",DIE("NO^")=""
"RTN","PRCNREQN",59,0)
 S DR=".01///^S X=RI;2///^S X=RDI;3///^S X=RIDSC;.5Replacement Justification~;I X'=6 S Y="""";.7",DIE=DIC D ^DIE
"RTN","PRCNREQN",60,0)
 K DR,DIE("NO^") Q
"RTN","PRCNREQN",61,0)
RPX K QTY,NM,RQ,NUM,DR,DOV
"RTN","PRCNREQN",62,0)
 Q
"VER")
8.0^22
**END**
**END**
