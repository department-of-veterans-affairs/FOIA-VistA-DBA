Released PSO*7*116 SEQ #118
Extracted from mail message
**KIDS**:PSO*7.0*116^

**INSTALL NAME**
PSO*7.0*116
"BLD",758,0)
PSO*7.0*116^OUTPATIENT PHARMACY^0^3030210^y
"BLD",758,1,0)
^^8^8^3020926^
"BLD",758,1,1,0)
The purpose of this patch is to support the implementation of Internet 
"BLD",758,1,2,0)
Prescription Refill for Outpatient Pharmacy V. 7.0. This request has links
"BLD",758,1,3,0)
to the Health eVet project that will provide a mechanism to obtain copies
"BLD",758,1,4,0)
of key portions of their medical record, personalize that record with
"BLD",758,1,5,0)
relevant educational information and provide links to electronic service
"BLD",758,1,6,0)
delivery capabilities, such as prescription refills. The veteran will be
"BLD",758,1,7,0)
able to request a prescription refill and review his prescription profile
"BLD",758,1,8,0)
by using a web based interface on the internet.
"BLD",758,4,0)
^9.64PA^52.43^1
"BLD",758,4,52.43,0)
52.43
"BLD",758,4,52.43,222)
y^y^f^^^^n
"BLD",758,4,"B",52.43,52.43)

"BLD",758,"ABPKG")
n
"BLD",758,"KRN",0)
^9.67PA^8989.52^19
"BLD",758,"KRN",.4,0)
.4
"BLD",758,"KRN",.401,0)
.401
"BLD",758,"KRN",.402,0)
.402
"BLD",758,"KRN",.403,0)
.403
"BLD",758,"KRN",.5,0)
.5
"BLD",758,"KRN",.84,0)
.84
"BLD",758,"KRN",3.6,0)
3.6
"BLD",758,"KRN",3.8,0)
3.8
"BLD",758,"KRN",9.2,0)
9.2
"BLD",758,"KRN",9.8,0)
9.8
"BLD",758,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",758,"KRN",9.8,"NM",1,0)
PSOPRA^^0^B14964182
"BLD",758,"KRN",9.8,"NM",2,0)
PSOPRI^^0^B22084835
"BLD",758,"KRN",9.8,"NM","B","PSOPRA",1)

"BLD",758,"KRN",9.8,"NM","B","PSOPRI",2)

"BLD",758,"KRN",19,0)
19
"BLD",758,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",758,"KRN",19,"NM",1,0)
PSO INTERNET REFILLS^^0
"BLD",758,"KRN",19,"NM",2,0)
PSO BARCODE MENU^^3
"BLD",758,"KRN",19,"NM","B","PSO BARCODE MENU",2)

"BLD",758,"KRN",19,"NM","B","PSO INTERNET REFILLS",1)

"BLD",758,"KRN",19.1,0)
19.1
"BLD",758,"KRN",101,0)
101
"BLD",758,"KRN",409.61,0)
409.61
"BLD",758,"KRN",771,0)
771
"BLD",758,"KRN",870,0)
870
"BLD",758,"KRN",8989.51,0)
8989.51
"BLD",758,"KRN",8989.52,0)
8989.52
"BLD",758,"KRN",8994,0)
8994
"BLD",758,"KRN","B",.4,.4)

"BLD",758,"KRN","B",.401,.401)

"BLD",758,"KRN","B",.402,.402)

"BLD",758,"KRN","B",.403,.403)

"BLD",758,"KRN","B",.5,.5)

"BLD",758,"KRN","B",.84,.84)

"BLD",758,"KRN","B",3.6,3.6)

"BLD",758,"KRN","B",3.8,3.8)

"BLD",758,"KRN","B",9.2,9.2)

"BLD",758,"KRN","B",9.8,9.8)

"BLD",758,"KRN","B",19,19)

"BLD",758,"KRN","B",19.1,19.1)

"BLD",758,"KRN","B",101,101)

"BLD",758,"KRN","B",409.61,409.61)

"BLD",758,"KRN","B",771,771)

"BLD",758,"KRN","B",870,870)

"BLD",758,"KRN","B",8989.51,8989.51)

"BLD",758,"KRN","B",8989.52,8989.52)

"BLD",758,"KRN","B",8994,8994)

"BLD",758,"QUES",0)
^9.62^^
"BLD",758,"REQB",0)
^9.611^^
"FIA",52.43)
PRESCRIPTION REFILL REQUEST
"FIA",52.43,0)
^PS(52.43,
"FIA",52.43,0,0)
52.43
"FIA",52.43,0,1)
y^y^f^^^^n
"FIA",52.43,0,10)

"FIA",52.43,0,11)

"FIA",52.43,0,"RLRO")

"FIA",52.43,0,"VR")
7.0^PSO
"FIA",52.43,52.43)
0
"IX",52.43,52.43,"AA",0)
52.43^AA^CROSS REFERENCE^MU^^R^IR^I^52.43^^^^^A
"IX",52.43,52.43,"AA",1)
S ^PS(52.43,"AA",X(1),X(2),X(3),DA)=""
"IX",52.43,52.43,"AA",2)
K ^PS(52.43,"AA",X(1),X(2),X(3),DA)
"IX",52.43,52.43,"AA",11.1,0)
^.114IA^3^3
"IX",52.43,52.43,"AA",11.1,1,0)
1^F^52.43^.01^20^1^F
"IX",52.43,52.43,"AA",11.1,2,0)
2^F^52.43^2^15^2^F
"IX",52.43,52.43,"AA",11.1,3,0)
3^F^52.43^3^20^3^F
"IX",52.43,52.43,"AB",0)
52.43^AB^XREF OF ALL REFILL REQUESTS^MU^^R^IR^I^52.43^^^^^A
"IX",52.43,52.43,"AB",1)
S ^PS(52.43,"AB",X(1),X(2),X(3),DA)=""
"IX",52.43,52.43,"AB",2)
K ^PS(52.43,"AB",X(1),X(2),X(3),DA)
"IX",52.43,52.43,"AB",11.1,0)
^.114IA^3^3
"IX",52.43,52.43,"AB",11.1,1,0)
1^F^52.43^.01^^1^F
"IX",52.43,52.43,"AB",11.1,2,0)
2^F^52.43^2^^2^F
"IX",52.43,52.43,"AB",11.1,3,0)
3^F^52.43^3^^3^F
"IX",52.43,52.43,"AINST",0)
52.43^AINST^QUEUE FOR PROCESSING REFILL REQUESTS^MU^^R^IR^I^52.43^^^^^A
"IX",52.43,52.43,"AINST",1)
S ^PS(52.43,"AINST",X(1),X(2),DA)=""
"IX",52.43,52.43,"AINST",2)
K ^PS(52.43,"AINST",X(1),X(2),DA)
"IX",52.43,52.43,"AINST",11.1,0)
^.114IA^2^2
"IX",52.43,52.43,"AINST",11.1,1,0)
1^F^52.43^4^^1^F
"IX",52.43,52.43,"AINST",11.1,2,0)
2^F^52.43^8^30^2^F
"IX",52.43,52.43,"AINST",11.1,2,3)

"KRN",19,1023,-1)
3^2
"KRN",19,1023,0)
PSO BARCODE MENU^Barcode Rx Menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,1023,1,0)
^19.06^3^3^3020924^^^^
"KRN",19,1023,1,1,0)
This menu contains items that allow batch barcoding refills and
"KRN",19,1023,1,2,0)
renewals of prescriptions.  This menu also has an option to check
"KRN",19,1023,1,3,0)
the quality of the barcode print.
"KRN",19,1023,10,0)
^19.01IP^3^3
"KRN",19,1023,10,3,0)
2131
"KRN",19,1023,10,3,"^")
PSO INTERNET REFILLS
"KRN",19,1023,99)
59071,40015
"KRN",19,1023,"U")
BARCODE RX MENU
"KRN",19,2131,-1)
0^1
"KRN",19,2131,0)
PSO INTERNET REFILLS^Process Internet Refills^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2131,1,0)
^^1^1^3020924^
"KRN",19,2131,1,1,0)
Process internet prescription refill requests.
"KRN",19,2131,25)
START^PSOPRI
"KRN",19,2131,"U")
PROCESS INTERNET REFILLS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
7.0^2971216^2980805^5
"PKG",16,22,1,"PAH",1,0)
116^3030210
"PKG",16,22,1,"PAH",1,1,0)
^^8^8^3030210
"PKG",16,22,1,"PAH",1,1,1,0)
The purpose of this patch is to support the implementation of Internet 
"PKG",16,22,1,"PAH",1,1,2,0)
Prescription Refill for Outpatient Pharmacy V. 7.0. This request has links
"PKG",16,22,1,"PAH",1,1,3,0)
to the Health eVet project that will provide a mechanism to obtain copies
"PKG",16,22,1,"PAH",1,1,4,0)
of key portions of their medical record, personalize that record with
"PKG",16,22,1,"PAH",1,1,5,0)
relevant educational information and provide links to electronic service
"PKG",16,22,1,"PAH",1,1,6,0)
delivery capabilities, such as prescription refills. The veteran will be
"PKG",16,22,1,"PAH",1,1,7,0)
able to request a prescription refill and review his prescription profile
"PKG",16,22,1,"PAH",1,1,8,0)
by using a web based interface on the internet.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSOPRA")
0^1^B14964182
"RTN","PSOPRA",1,0)
PSOPRA ;BIR/JLC - INTERNET PRESCRIPTION REFILL APIS ;29-AUG-2002
"RTN","PSOPRA",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**116**;DEC 1997
"RTN","PSOPRA",3,0)
 ;
"RTN","PSOPRA",4,0)
 Q
"RTN","PSOPRA",5,0)
AP1(PSOICN,PSOSSN,PSORX) ;ACCEPT REQUEST
"RTN","PSOPRA",6,0)
 ; Input:  PSOICN (required) - Integration Control Number
"RTN","PSOPRA",7,0)
 ;         PSOSSN (required) - Social Security Number
"RTN","PSOPRA",8,0)
 ;         PSORX  (required) - Prescription Number
"RTN","PSOPRA",9,0)
 ; Output: PSORET - Return Value
"RTN","PSOPRA",10,0)
 ;         See IA ... for description and values
"RTN","PSOPRA",11,0)
 ;
"RTN","PSOPRA",12,0)
 N PSORET,PSODFN,DFN,PSRX,PSRXD,IEN,PSORR,PSORXD2,PSOSITE,SITE
"RTN","PSOPRA",13,0)
 I $G(PSOICN)="" S PSORET=-4 G ENDAP1
"RTN","PSOPRA",14,0)
 S PSODFN=$$GETDFN^MPIF001(PSOICN) I PSODFN=-1 S PSORET=-4 G ENDAP1
"RTN","PSOPRA",15,0)
 I $G(PSOSSN)="" S PSORET=-4 G ENDAP1
"RTN","PSOPRA",16,0)
 S DFN=PSODFN D DEM^VADPT I $P(VADM(2),"^")'=PSOSSN S PSORET=-4 G ENDAP1
"RTN","PSOPRA",17,0)
 I $G(PSORX)="" S PSORET=-3 G ENDAP1
"RTN","PSOPRA",18,0)
 I '$D(^PSRX("B",PSORX)) S PSORET=-3 G ENDAP1
"RTN","PSOPRA",19,0)
 S PSRX=$O(^PSRX("B",PSORX,"")),PSRXD=$G(^PSRX(PSRX,0))
"RTN","PSOPRA",20,0)
 I PSRXD="" S PSORET=-3 G ENDAP1
"RTN","PSOPRA",21,0)
 I $P(PSRXD,"^",2)'=PSODFN S PSORET=-3 G ENDAP1
"RTN","PSOPRA",22,0)
 S (SITE,DA)=$P(^XMB(1,1,"XUS"),"^",17),DIC="4",DIQ(0)="IE",DR=".01;99",DIQ="PSXUTIL" D EN^DIQ1 S PSOSITE=$G(PSXUTIL(4,SITE,99,"I"))
"RTN","PSOPRA",23,0)
 I '$D(^PS(52.43,"AA",PSOICN,PSOSSN,PSORX)) G FILEAP1
"RTN","PSOPRA",24,0)
 S IEN=$O(^PS(52.43,"AA",PSOICN,PSOSSN,PSORX,""))
"RTN","PSOPRA",25,0)
 S PSORR=$G(^PS(52.43,IEN,0))
"RTN","PSOPRA",26,0)
 I $P(PSORR,"^",5)="" S PSORET=-2 G ENDAP1
"RTN","PSOPRA",27,0)
 I '+$P(PSORR,"^",6) S PSORET=-1 G ENDAP1
"RTN","PSOPRA",28,0)
FILEAP1 K DO,DIC S DIC(0)="L",DIC=52.43,X=PSOICN D FILE^DICN I Y=-1 S PSORET=0 G ENDAP1
"RTN","PSOPRA",29,0)
 K DA,DR,DIE S DA=+Y,DIE=DIC,DR="2///"_PSOSSN_";3///"_PSORX_";4///"_PSOSITE_";7///0;8///"_PSRX D ^DIE
"RTN","PSOPRA",30,0)
 S PSORET=1
"RTN","PSOPRA",31,0)
ENDAP1 Q PSORET
"RTN","PSOPRA",32,0)
 ;
"RTN","PSOPRA",33,0)
AP2(PSOICN,PSOSSN,PSORX) ;STATUS OF REQUEST
"RTN","PSOPRA",34,0)
 ; Input:  PSOICN (required) - Integration Control Number
"RTN","PSOPRA",35,0)
 ;         PSOSSN (required) - Social Security Number
"RTN","PSOPRA",36,0)
 ;         PSORX  (required) - Prescription Number
"RTN","PSOPRA",37,0)
 ; Output: PSORET - Return Value
"RTN","PSOPRA",38,0)
 ;         See IA ... for description and values
"RTN","PSOPRA",39,0)
 ;
"RTN","PSOPRA",40,0)
 N PSORET,PSODFN,DFN,PSRX,PSRXD,PSORR
"RTN","PSOPRA",41,0)
 S PSOICN=$G(PSOICN) I PSOICN=""!(PSOICN?.E1C.E)!($L(PSOICN)>120) S PSORET=-4 G ENDAP2
"RTN","PSOPRA",42,0)
 I '$D(^PS(52.43,"AA",PSOICN)) S PSORET=-4 G ENDAP2
"RTN","PSOPRA",43,0)
 S PSOSSN=$G(PSOSSN) I PSOSSN=""!(PSOSSN?.E1C.E)!($L(PSOSSN)>120) S PSORET=-4 G ENDAP2
"RTN","PSOPRA",44,0)
 I '$D(^PS(52.43,"AA",PSOICN,PSOSSN)) S PSORET=-4 G ENDAP2
"RTN","PSOPRA",45,0)
 S PSORX=$G(PSORX) I PSORX=""!(PSORX?.E1C.E)!($L(PSORX)>120) S PSORET=-3 G ENDAP2
"RTN","PSOPRA",46,0)
 I '$D(^PS(52.43,"AA",PSOICN,PSOSSN,PSORX)) S PSORET=-3 G ENDAP2
"RTN","PSOPRA",47,0)
 S IEN=$O(^PS(52.43,"AA",PSOICN,PSOSSN,PSORX,"")),PSORR=$G(^PS(52.43,IEN,0))
"RTN","PSOPRA",48,0)
 I $P(PSORR,"^",5)="" S PSORET=-2 G ENDAP2
"RTN","PSOPRA",49,0)
 S PSORET=$P(PSORR,"^",5)_"^"_$P(PSORR,"^",6)_"^Y"
"RTN","PSOPRA",50,0)
ENDAP2 Q PSORET
"RTN","PSOPRA",51,0)
 ;
"RTN","PSOPRA",52,0)
AP4 ;PROCESSED REQUESTS
"RTN","PSOPRA",53,0)
 N PSOICN,PSOSSN,PSORX,IEN,PSORR K ^TMP($J,"MHEV UPDATE")
"RTN","PSOPRA",54,0)
 I '$D(^PS(52.43,"AA")) S ^TMP($J,"MHEV UPDATE")=-1 Q
"RTN","PSOPRA",55,0)
 S PSOICN=""
"RTN","PSOPRA",56,0)
 F  S PSOICN=$O(^PS(52.43,"AA",PSOICN)) Q:PSOICN=""  D
"RTN","PSOPRA",57,0)
 . S PSOSSN=""
"RTN","PSOPRA",58,0)
 . F  S PSOSSN=$O(^PS(52.43,"AA",PSOICN,PSOSSN)) Q:PSOSSN=""  D
"RTN","PSOPRA",59,0)
 .. S PSORX=""
"RTN","PSOPRA",60,0)
 .. F  S PSORX=$O(^PS(52.43,"AA",PSOICN,PSOSSN,PSORX)) Q:PSORX=""  D
"RTN","PSOPRA",61,0)
 ... S IEN=$O(^PS(52.43,"AA",PSOICN,PSOSSN,PSORX,"")),PSORR=$G(^PS(52.43,IEN,0)) Q:$P(PSORR,"^",5)=""
"RTN","PSOPRA",62,0)
 ... S ^TMP($J,"MHEV UPDATE",PSOICN,PSORX)=$P(PSORR,"^",5)_"^"_$$GET1^DIQ(52.43,IEN_",",6)
"RTN","PSOPRA",63,0)
 I '$D(^TMP($J,"MHEV UPDATE")) S ^TMP($J,"MHEV UPDATE")=-1
"RTN","PSOPRA",64,0)
 Q
"RTN","PSOPRA",65,0)
 ;
"RTN","PSOPRA",66,0)
AP5(PSOICN,PSOSSN,PSORX) ;PROCESS MHEV UPDATE
"RTN","PSOPRA",67,0)
 ; Input:  PSOICN (required) - Integration Control Number
"RTN","PSOPRA",68,0)
 ;         PSOSSN (required) - Social Security Number
"RTN","PSOPRA",69,0)
 ;         PSORX  (required) - Prescription Number
"RTN","PSOPRA",70,0)
 ; Output: PSORET - Return Value
"RTN","PSOPRA",71,0)
 ;         See IA ... for description and values
"RTN","PSOPRA",72,0)
 ;
"RTN","PSOPRA",73,0)
 S PSOICN=$G(PSOICN) I PSOICN=""!(PSOICN?.E1C.E)!($L(PSOICN)>120) S PSORET=0 G ENDAP5
"RTN","PSOPRA",74,0)
 I '$D(^PS(52.43,"AA",PSOICN)) S PSORET=0 G ENDAP5
"RTN","PSOPRA",75,0)
 S PSOSSN=$G(PSOSSN) I PSOSSN=""!(PSOSSN?.E1C.E)!($L(PSOSSN)>120) S PSORET=0 G ENDAP5
"RTN","PSOPRA",76,0)
 I '$D(^PS(52.43,"AA",PSOICN,PSOSSN)) S PSORET=0 G ENDAP5
"RTN","PSOPRA",77,0)
 S PSORX=$G(PSORX) I PSORX=""!(PSORX?.E1C.E)!($L(PSORX)>120) S PSORET=0 G ENDAP5
"RTN","PSOPRA",78,0)
 I '$D(^PS(52.43,"AA",PSOICN,PSOSSN,PSORX)) S PSORET=0 G ENDAP5
"RTN","PSOPRA",79,0)
 K DA,DR,DIE
"RTN","PSOPRA",80,0)
 S DA=$O(^PS(52.43,"AA",PSOICN,PSOSSN,PSORX,"")),PSOIN=$P(^PS(52.43,DA,0),"^",4)
"RTN","PSOPRA",81,0)
 S DIE="^PS(52.43,",DR="7///1" D ^DIE S PSORET=1
"RTN","PSOPRA",82,0)
 K ^PS(52.43,"AA",PSOICN,PSOSSN,PSORX),^PS(52.43,"AINST",PSOIN,PSORX)
"RTN","PSOPRA",83,0)
ENDAP5 Q PSORET
"RTN","PSOPRI")
0^2^B22084835
"RTN","PSOPRI",1,0)
PSOPRI ;BIR/JLC - INTERNET PRESCRIPTION REFILL PROCESSOR ;29-AUG-2002
"RTN","PSOPRI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**116**;DEC 1997
"RTN","PSOPRI",3,0)
 ;
"RTN","PSOPRI",4,0)
 ;Reference to ^PPPPDA1 supported by DBIA 1374
"RTN","PSOPRI",5,0)
 ;Reference to ^PSSLOCK supported by DBIA 2789
"RTN","PSOPRI",6,0)
 ;
"RTN","PSOPRI",7,0)
START S PSOVEX=1
"RTN","PSOPRI",8,0)
 K PSOVEXI,PSOISITE,PSOVEXFL,PSONOF
"RTN","PSOPRI",9,0)
 S PSOVX=0 F  S PSOVX=$O(^PS(59,PSOVX)) Q:'PSOVX  I $P($G(^PS(59,PSOVX,"I")),"^"),DT>$P($G(^("I")),"^") S PSOVEXI(PSOVX)=""
"RTN","PSOPRI",10,0)
 I $O(PSOVEXI(0)) W !,"Looking for refill requests for inactive Outpatient divisions..." D
"RTN","PSOPRI",11,0)
 . S PSOVIN=0 F  S PSOVIN=$O(^PS(52.43,"AINST",PSOVIN)) Q:'PSOVIN  S PSOVXLP="" F  S PSOVXLP=$O(^PS(52.43,"AINST",PSOVIN,PSOVXLP)) Q:PSOVXLP=""  D
"RTN","PSOPRI",12,0)
 .. S PSOIEN=$O(^PS(52.43,"AINST",PSOVIN,PSOVXLP,""))
"RTN","PSOPRI",13,0)
 .. S PSOISITE=$P($G(^PSRX(PSOVXLP,2)),"^",9) Q:$G(PSOVEXI(+$G(PSOISITE)))
"RTN","PSOPRI",14,0)
 .. I PSOISITE,$D(PSOVEXI(PSOISITE)),$P($G(^PS(52.43,PSOIEN,0)),"^",5)="" S PSOVEXI(PSOISITE)=1,PSOVEXFL=1
"RTN","PSOPRI",15,0)
 . I '$G(PSOVEXFL) W ".none found.",!
"RTN","PSOPRI",16,0)
 I $G(PSOVEXFL) W !!,"The following Inactive Outpatient sites have refill requests:",! D  I Y'=1 G END
"RTN","PSOPRI",17,0)
 . S PSOVX=0 F  S PSOVX=$O(PSOVEXI(PSOVX)) Q:'PSOVX  I $G(PSOVEXI(PSOVX)) W !?5,$P($G(^PS(59,+$G(PSOVX),0)),"^")
"RTN","PSOPRI",18,0)
 . K DIR W ! S DIR(0)="E",DIR("A")="Press Return to Continue, '^' to exit" D ^DIR W ! I Y'=1 Q
"RTN","PSOPRI",19,0)
 D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) END
"RTN","PSOPRI",20,0)
 W !!!?20,"Division: "_$P(^PS(59,PSOSITE,0),"^"),!!
"RTN","PSOPRI",21,0)
 S PSOBBC1("FROM")="REFILL",PSOBBC("QFLG")=0,PSOBBC("DFLG")=0
"RTN","PSOPRI",22,0)
 I '$D(^PS(52.43,"AINST",PSOINST)) S PSOANS="N" W !!?7,$C(7),"There are no internet refills to process." G END
"RTN","PSOPRI",23,0)
 D ASK^PSOBBC W:PSOBBC("QFLG")=1 !?7,$C(7),"No internet refills were processed." G:PSOBBC("QFLG")=1 END
"RTN","PSOPRI",24,0)
IPR W ! S DIR("B")="YES",DIR("A")="Process internet refill requests at this time",DIR(0)="Y" D ^DIR K DIR S PSOANS="N" I $G(DIRUT) S PSOPTRX="" G END
"RTN","PSOPRI",25,0)
 G:Y=0 END S PSOPTRX="" I Y=1 S PSOANS="Y"
"RTN","PSOPRI",26,0)
 I PSOANS["Y" S DIR("B")="YES",DIR("A")="Process internet refills for all divisions",DIR(0)="Y" D ^DIR K DIR S PSOANS2="S" S:Y=1 PSOANS2="M" I $G(DIRUT) S PSOANS="N" G END
"RTN","PSOPRI",27,0)
IPR6 I PSOANS["Y",$G(PSOPTRX) D IPR5 ;MARK PROCESSED NODES
"RTN","PSOPRI",28,0)
 D IPR3 I $G(PSOANS)="N" D ULK G END
"RTN","PSOPRI",29,0)
 I $P(X,"-")'=PSOINST W !?7,$C(7),$C(7),$C(7),"Not from this institution.",! D ULK G IPR6
"RTN","PSOPRI",30,0)
 S (PSOBBC("IRXN"),PSOBBC("OIRXN"))=$P(X,"-",2)
"RTN","PSOPRI",31,0)
 I $G(^PSRX(PSOBBC("IRXN"),0))']"" W !,$C(7),"Rx data is not on file!",! D ULK G IPR6
"RTN","PSOPRI",32,0)
 I $P($G(^PSRX(PSOBBC("IRXN"),"STA")),"^")=13 W !,$C(7),"Rx has already been deleted." D ULK G IPR6
"RTN","PSOPRI",33,0)
 I $G(PSOBBC("DONE"))[PSOBBC("IRXN")_"," W !,$C(7),"Rx has already been entered." D ULK G IPR6
"RTN","PSOPRI",34,0)
 K X,Y D:PSOBBC("QFLG") PROCESSX^PSOBBC
"RTN","PSOPRI",35,0)
 S PSOSELSE=0 I $G(PSODFN)'=$P(^PSRX(PSOBBC("IRXN"),0),"^",2) S PSOSELSE=1 D PT^PSOBBC I $G(PSOBBC("DFLG")) K PSOSELSE D ULK G IPR6
"RTN","PSOPRI",36,0)
 I '$G(PSOSELSE) D PTC^PSOBBC I $G(PSOBBC("DFLG")) K PSOSELSE D ULK G IPR6
"RTN","PSOPRI",37,0)
 K PSOSELSE D PROFILE^PSORX1 S X="PPPPDA1" X ^%ZOSF("TEST") I  S X=$$PDA^PPPPDA1(PSODFN) W !!
"RTN","PSOPRI",38,0)
 S PSOBBC("DONE")=PSOBBC("IRXN")_"," D REFILL^PSOBBC D ULK G IPR6
"RTN","PSOPRI",39,0)
 Q
"RTN","PSOPRI",40,0)
IPR3 K PSOBBC("IRXN"),PSOXFLAG F  S PSOPTRX=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX)) D  Q:PSOANS="N"!($G(PSOXFLAG))
"RTN","PSOPRI",41,0)
 .I PSOPTRX="" S PSOANS="N" Q
"RTN","PSOPRI",42,0)
 .S PSOIEN=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX,""))
"RTN","PSOPRI",43,0)
 .I '$D(^PSRX(+PSOPTRX,0)),$P(^PS(52.43,PSOIEN,0),"^",5)="" S PSONOF=1 D IPR5 K PSONOF Q  ;SKIPS ERRONEOUS ENTRIES
"RTN","PSOPRI",44,0)
IPR4 .I PSOANS["Y" Q:$P(^PS(52.43,PSOIEN,0),"^",5)'=""  S X=PSOINST_"-"_PSOPTRX  ;SKIPS ENTRIES ALREADY PROCESSED AND FORMATS VARIABLE X
"RTN","PSOPRI",45,0)
IPR10 .I PSOANS2["S",$D(^PSRX(+PSOPTRX,0)),PSOSITE'=$P($G(^PSRX(+PSOPTRX,2)),"^",9) Q
"RTN","PSOPRI",46,0)
 .S PSOPSORX=+$G(PSOPTRX) I PSOPSORX D PSOL^PSSLOCK(PSOPSORX) I '$G(PSOMSG) K PSOPSORX,PSOMSG Q
"RTN","PSOPRI",47,0)
 .K PSOMSG S PSOXFLAG=1
"RTN","PSOPRI",48,0)
 Q
"RTN","PSOPRI",49,0)
 ;LINES CALLED TO MARK PROCESSED NODES
"RTN","PSOPRI",50,0)
IPR5 K DA,DR,DIE S DA=$O(^PS(52.43,"AINST",PSOINST,PSOPTRX,""))
"RTN","PSOPRI",51,0)
 S DIE="^PS(52.43,",DR="5////"_DT_";6///"_$S($G(PSOBBC("DFLG"))=1:"NOT FILLED",$G(PSONOF)=1:"NOT FILLED",1:"FILLED") D ^DIE ; MARKS NODE AS PROCESSED
"RTN","PSOPRI",52,0)
 Q
"RTN","PSOPRI",53,0)
END D PROCESSX^PSOBBC
"RTN","PSOPRI",54,0)
 I $P($G(^PS(59,+$G(PSOSITE),"I")),"^"),DT>$P($G(^("I")),"^") D FINAL^PSOLSET W !!,"Your Outpatient Site parameters have been deleted because you selected an",!,"inactive Outpatient Site!",!
"RTN","PSOPRI",55,0)
 K DIR,PSOBBC,PSOBBC1,PSOVIN,PSOISITE,PSOVEXFL,PSOVXLP,PSOVEX,PSOVX,PSOVEXI,PSOANS,PSOANS2,PSOPTRX,PSOXFLAG,PSOPSORX,X,Y
"RTN","PSOPRI",56,0)
 Q
"RTN","PSOPRI",57,0)
ULK ;
"RTN","PSOPRI",58,0)
 I '$G(PSOPSORX) Q
"RTN","PSOPRI",59,0)
 D PSOUL^PSSLOCK(PSOPSORX)
"RTN","PSOPRI",60,0)
 K PSOPSORX
"RTN","PSOPRI",61,0)
 Q
"SEC","^DIC",52.43,52.43,0,"AUDIT")
@
"SEC","^DIC",52.43,52.43,0,"DD")
@
"SEC","^DIC",52.43,52.43,0,"DEL")
@
"SEC","^DIC",52.43,52.43,0,"LAYGO")
@
"SEC","^DIC",52.43,52.43,0,"RD")
@
"SEC","^DIC",52.43,52.43,0,"WR")
@
"VER")
8.0^22.0
"^DD",52.43,52.43,0)
FIELD^^8^8
"^DD",52.43,52.43,0,"DDA")
N
"^DD",52.43,52.43,0,"DT")
3030207
"^DD",52.43,52.43,0,"NM","PRESCRIPTION REFILL REQUEST")

"^DD",52.43,52.43,.01,0)
PATIENT ICN^RNJ12,0^^0;1^K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."1.N) X
"^DD",52.43,52.43,.01,1,0)
^.1^^0
"^DD",52.43,52.43,.01,3)
Type a number between 1 and 999999999999, 0 Decimal Digits
"^DD",52.43,52.43,.01,21,0)
^^2^2^3030207^
"^DD",52.43,52.43,.01,21,1,0)
This is a machine-to-machine identifier for a patient. The number may 
"^DD",52.43,52.43,.01,21,2,0)
only be edited by MPI/PD.
"^DD",52.43,52.43,.01,"DT")
3030207
"^DD",52.43,52.43,2,0)
PATIENT SSN^F^^0;2^K:$L(X)>9!($L(X)<1) X
"^DD",52.43,52.43,2,3)
Answer must be 1-9 characters in length
"^DD",52.43,52.43,2,21,0)
^^3^3^3030207^
"^DD",52.43,52.43,2,21,1,0)
This is the social security number associated with this patient. In 
"^DD",52.43,52.43,2,21,2,0)
combination with the Integration Control Number, it is used to validate 
"^DD",52.43,52.43,2,21,3,0)
the patient's identification.
"^DD",52.43,52.43,2,"DT")
3030207
"^DD",52.43,52.43,3,0)
RX #^F^^0;3^K:$L(X)>25!($L(X)<1) X
"^DD",52.43,52.43,3,3)
Answer must be 1-25 characters in length
"^DD",52.43,52.43,3,21,0)
^^2^2^3030207^
"^DD",52.43,52.43,3,21,1,0)
This is the external representation of the prescription number for the
"^DD",52.43,52.43,3,21,2,0)
refill to be processed.
"^DD",52.43,52.43,3,"DT")
3030207
"^DD",52.43,52.43,4,0)
INSTITUTION^F^^0;4^K:$L(X)>10!($L(X)<1) X
"^DD",52.43,52.43,4,3)
Answer must be 1-10 characters in length
"^DD",52.43,52.43,4,21,0)
^^2^2^3030207^
"^DD",52.43,52.43,4,21,1,0)
The VA facility or institution that will be processing the refill for 
"^DD",52.43,52.43,4,21,2,0)
this prescription.
"^DD",52.43,52.43,4,"DT")
3030207
"^DD",52.43,52.43,5,0)
DATE PROCESSED^D^^0;5^S %DT="E" D ^%DT S X=Y K:3020101>X X
"^DD",52.43,52.43,5,3)
TYPE A DATE NOT EARLIER THAN JAN 01, 2002
"^DD",52.43,52.43,5,21,0)
^^1^1^3030207^
"^DD",52.43,52.43,5,21,1,0)
This is the date the pharmacy processed the refill request.
"^DD",52.43,52.43,5,"DT")
3030207
"^DD",52.43,52.43,6,0)
RESULT^S^0:NOT PROCESSED;1:FILLED;2:NOT FILLED;^0;6^Q
"^DD",52.43,52.43,6,21,0)
^^2^2^3030207^
"^DD",52.43,52.43,6,21,1,0)
The result of the pharmacy staff processing the refill request. The 
"^DD",52.43,52.43,6,21,2,0)
result may be either FILLED or NOT FILLED.
"^DD",52.43,52.43,6,"DT")
3030207
"^DD",52.43,52.43,7,0)
MHEV UPDATE^S^0:NO;1:YES;^0;7^Q
"^DD",52.43,52.43,7,21,0)
^^2^2^3030210^
"^DD",52.43,52.43,7,21,1,0)
Indicates whether or not a status update for this refill request has been 
"^DD",52.43,52.43,7,21,2,0)
sent to the My HealtheVet system.
"^DD",52.43,52.43,7,"DT")
3030210
"^DD",52.43,52.43,8,0)
PRESCRIPTION IEN^F^^0;8^K:$L(X)>20!($L(X)<1) X
"^DD",52.43,52.43,8,3)
This is the internal entry number from 52.
"^DD",52.43,52.43,8,21,0)
^^2^2^3030207^
"^DD",52.43,52.43,8,21,1,0)
This is the internal entry number of the prescription associated with 
"^DD",52.43,52.43,8,21,2,0)
this refill request.
"^DD",52.43,52.43,8,"DT")
3030207
"^DIC",52.43,52.43,0)
PRESCRIPTION REFILL REQUEST^52.43
"^DIC",52.43,52.43,0,"GL")
^PS(52.43,
"^DIC",52.43,52.43,"%",0)
^1.005^^
"^DIC",52.43,52.43,"%D",0)
^^3^3^3030210^
"^DIC",52.43,52.43,"%D",1,0)
The purpose of this file is to hold the refill requests that are 
"^DIC",52.43,52.43,"%D",2,0)
generated from the web interface in the My HealtheVet package. Requests 
"^DIC",52.43,52.43,"%D",3,0)
are filed here, to be processed by pharmacy.
"^DIC",52.43,"B","PRESCRIPTION REFILL REQUEST",52.43)

**END**
**END**
