Released RMPR*3*110 SEQ #101
Extracted from mail message
**KIDS**:RMPR*3.0*110^

**INSTALL NAME**
RMPR*3.0*110
"BLD",6155,0)
RMPR*3.0*110^PROSTHETICS^0^3060607^y
"BLD",6155,1,0)
^^4^4^3060512^
"BLD",6155,1,1,0)
1. Type of Transaction data missing in Extract.
"BLD",6155,1,2,0)
 
"BLD",6155,1,3,0)
2. HOME/O2 Suspense Issue - PROSTHETICS PATIENT RECORDS NOT LINKED
"BLD",6155,1,4,0)
    TO SUSPENSE.
"BLD",6155,4,0)
^9.64PA^^
"BLD",6155,6.3)
10
"BLD",6155,"ABPKG")
n
"BLD",6155,"INIT")
RMPR110P
"BLD",6155,"KRN",0)
^9.67PA^8989.52^19
"BLD",6155,"KRN",.4,0)
.4
"BLD",6155,"KRN",.401,0)
.401
"BLD",6155,"KRN",.402,0)
.402
"BLD",6155,"KRN",.403,0)
.403
"BLD",6155,"KRN",.5,0)
.5
"BLD",6155,"KRN",.84,0)
.84
"BLD",6155,"KRN",3.6,0)
3.6
"BLD",6155,"KRN",3.8,0)
3.8
"BLD",6155,"KRN",9.2,0)
9.2
"BLD",6155,"KRN",9.8,0)
9.8
"BLD",6155,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",6155,"KRN",9.8,"NM",1,0)
RMPOPED^^0^B85905941
"BLD",6155,"KRN",9.8,"NM",2,0)
RMPOBIL2^^0^B60026916
"BLD",6155,"KRN",9.8,"NM",3,0)
RMPOPS23^^0^B30619186
"BLD",6155,"KRN",9.8,"NM",4,0)
RMPOPST3^^0^B24131485
"BLD",6155,"KRN",9.8,"NM",5,0)
RMPR110P^^0^B43952553
"BLD",6155,"KRN",9.8,"NM","B","RMPOBIL2",2)

"BLD",6155,"KRN",9.8,"NM","B","RMPOPED",1)

"BLD",6155,"KRN",9.8,"NM","B","RMPOPS23",3)

"BLD",6155,"KRN",9.8,"NM","B","RMPOPST3",4)

"BLD",6155,"KRN",9.8,"NM","B","RMPR110P",5)

"BLD",6155,"KRN",19,0)
19
"BLD",6155,"KRN",19,"NM",0)
^9.68A^^
"BLD",6155,"KRN",19.1,0)
19.1
"BLD",6155,"KRN",101,0)
101
"BLD",6155,"KRN",409.61,0)
409.61
"BLD",6155,"KRN",771,0)
771
"BLD",6155,"KRN",870,0)
870
"BLD",6155,"KRN",8989.51,0)
8989.51
"BLD",6155,"KRN",8989.52,0)
8989.52
"BLD",6155,"KRN",8994,0)
8994
"BLD",6155,"KRN","B",.4,.4)

"BLD",6155,"KRN","B",.401,.401)

"BLD",6155,"KRN","B",.402,.402)

"BLD",6155,"KRN","B",.403,.403)

"BLD",6155,"KRN","B",.5,.5)

"BLD",6155,"KRN","B",.84,.84)

"BLD",6155,"KRN","B",3.6,3.6)

"BLD",6155,"KRN","B",3.8,3.8)

"BLD",6155,"KRN","B",9.2,9.2)

"BLD",6155,"KRN","B",9.8,9.8)

"BLD",6155,"KRN","B",19,19)

"BLD",6155,"KRN","B",19.1,19.1)

"BLD",6155,"KRN","B",101,101)

"BLD",6155,"KRN","B",409.61,409.61)

"BLD",6155,"KRN","B",771,771)

"BLD",6155,"KRN","B",870,870)

"BLD",6155,"KRN","B",8989.51,8989.51)

"BLD",6155,"KRN","B",8989.52,8989.52)

"BLD",6155,"KRN","B",8994,8994)

"BLD",6155,"QUES",0)
^9.62^^
"BLD",6155,"REQB",0)
^9.611^3^3
"BLD",6155,"REQB",1,0)
RMPR*3.0*77^2
"BLD",6155,"REQB",2,0)
RMPR*3.0*50^2
"BLD",6155,"REQB",3,0)
RMPR*3.0*98^2
"BLD",6155,"REQB","B","RMPR*3.0*50",2)

"BLD",6155,"REQB","B","RMPR*3.0*77",1)

"BLD",6155,"REQB","B","RMPR*3.0*98",3)

"INIT")
RMPR110P
"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
110^3060607
"PKG",101,22,1,"PAH",1,1,0)
^^4^4^3060607
"PKG",101,22,1,"PAH",1,1,1,0)
1. Type of Transaction data missing in Extract.
"PKG",101,22,1,"PAH",1,1,2,0)
 
"PKG",101,22,1,"PAH",1,1,3,0)
2. HOME/O2 Suspense Issue - PROSTHETICS PATIENT RECORDS NOT LINKED
"PKG",101,22,1,"PAH",1,1,4,0)
    TO SUSPENSE.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","RMPOBIL2")
0^2^B60026916^B60004905
"RTN","RMPOBIL2",1,0)
RMPOBIL2 ;EDS/MDB - HOME OXYGEN BILLING TRANSACTIONS ;7/28/98
"RTN","RMPOBIL2",2,0)
 ;;3.0;PROSTHETICS;**29,44,46,50,110**;Feb 09, 1996;Build 10
"RTN","RMPOBIL2",3,0)
 ; ODJ patch 50 - Fix crashes reported in NOIS LIT-0600-70930
"RTN","RMPOBIL2",4,0)
 Q
"RTN","RMPOBIL2",5,0)
2319 ; SHOW PAGE 8 OF 2319
"RTN","RMPOBIL2",6,0)
 ;S:$D(RMPRDFN)&('$D(RMPODFN)) RMPODFN=RMPRDFN
"RTN","RMPOBIL2",7,0)
 S RMPODFN=RMPRDFN
"RTN","RMPOBIL2",8,0)
 D BPI,DPI
"RTN","RMPOBIL2",9,0)
 K DIR S DIR(0)="E" D ^DIR I $$QUIT G ASK1^RMPRPAT
"RTN","RMPOBIL2",10,0)
 D ^RMPOBIL5
"RTN","RMPOBIL2",11,0)
 K PTI,I,RX,Y,DT1,DT2,TRX,IENS,DFN
"RTN","RMPOBIL2",12,0)
 Q
"RTN","RMPOBIL2",13,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOBIL2",14,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOBIL2",15,0)
LJ(S,W,C) ; Left justify S in a field W wide padding with char C
"RTN","RMPOBIL2",16,0)
 ;
"RTN","RMPOBIL2",17,0)
 S C=$G(C," ")   ; Default pad char is space
"RTN","RMPOBIL2",18,0)
 I $L(S)'=W S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOBIL2",19,0)
 Q $E(S,1,W)
"RTN","RMPOBIL2",20,0)
EDIT ;NEW billing transaction edit module
"RTN","RMPOBIL2",21,0)
 ;This module edits a single billing transaction (trx)
"RTN","RMPOBIL2",22,0)
 ;a single trx is identified by 4 values
"RTN","RMPOBIL2",23,0)
 ;  site, billing month, vendor, and patient
"RTN","RMPOBIL2",24,0)
 ;  these four values represent an entry in file 665.72
"RTN","RMPOBIL2",25,0)
 ;
"RTN","RMPOBIL2",26,0)
 Q:'($D(RMPOXITE)&$D(RMPORVDT)&$D(RMPOVDR)&$D(RMPODFN))
"RTN","RMPOBIL2",27,0)
 Q:'$D(^RMPO(665.72,+RMPOXITE,1,+RMPORVDT,1,+RMPOVDR,"V",+RMPODFN))
"RTN","RMPOBIL2",28,0)
 ; previous two lines for development only - shouldn't be needed
"RTN","RMPOBIL2",29,0)
 ;
"RTN","RMPOBIL2",30,0)
 D ITEM
"RTN","RMPOBIL2",31,0)
EXIT L -^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,0)
"RTN","RMPOBIL2",32,0)
 K ITM,IEN,IENS,ITMACT,PTI,TMP,ZX1,TOT,T910,OTH,A,RX,TRX,DT1,DT2
"RTN","RMPOBIL2",33,0)
 K DIC,DIE,DA,DR,DO,DD,DIR,DIK,DIROUT,DUOUT
"RTN","RMPOBIL2",34,0)
 K TIEN,FCP,DFN,I,ITEM,NEW,QUIT,TOTAL,VADM,X,Y,Z,Z1,Z2,ZV,Z3
"RTN","RMPOBIL2",35,0)
 K PSTFLG,PITM,BACKPTR,POSTED,SUSP,DFCP,C,W,S,CIEN,RMIT,RMDIC
"RTN","RMPOBIL2",36,0)
 Q
"RTN","RMPOBIL2",37,0)
QUIK ; QUICK ITEM EDIT
"RTN","RMPOBIL2",38,0)
 ;
"RTN","RMPOBIL2",39,0)
 I '$$OK2EDIT D  Q
"RTN","RMPOBIL2",40,0)
 . W !,$C(7)_"Cannot edit Accepted Transactions.  "
"RTN","RMPOBIL2",41,0)
 . W "Please 'Unaccept' first." K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL2",42,0)
 I $$LOCKED D  Q
"RTN","RMPOBIL2",43,0)
 . W !,$C(7)_"Record is locked. " K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL2",44,0)
 D ITEMD
"RTN","RMPOBIL2",45,0)
 F I=1:1:IEN D  Q:QUIT
"RTN","RMPOBIL2",46,0)
 . W !,ITM(I)
"RTN","RMPOBIL2",47,0)
 .K DR D SDICE
"RTN","RMPOBIL2",48,0)
 .S DA=IEN(I),DR="7" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",49,0)
 .S Z=^RMPO(665.72,DA(4),1,DA(3),1,DA(2),"V",DA(1),1,DA,0)
"RTN","RMPOBIL2",50,0)
 .S Z1=$P(Z,U,7),Z2=$P(Z,U,5),Z3=$P(Z,U,11)
"RTN","RMPOBIL2",51,0)
 .S DR="6///"_((Z1*Z2)-Z3) D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",52,0)
 D BII,DII
"RTN","RMPOBIL2",53,0)
 K DIR S DIR(0)="E" D ^DIR Q:$$QUIT
"RTN","RMPOBIL2",54,0)
 G EXIT
"RTN","RMPOBIL2",55,0)
 Q
"RTN","RMPOBIL2",56,0)
ITEM ; Main edit loop
"RTN","RMPOBIL2",57,0)
 ;
"RTN","RMPOBIL2",58,0)
 I '$$OK2EDIT D  Q
"RTN","RMPOBIL2",59,0)
 . W !,$C(7)_"Cannot edit Accepted Transactions.  "
"RTN","RMPOBIL2",60,0)
 . W "Please 'Unaccept' first." K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL2",61,0)
 I $$LOCKED D  Q
"RTN","RMPOBIL2",62,0)
 . W !,$C(7)_"Record is locked. " K DIR S DIR(0)="E" D ^DIR
"RTN","RMPOBIL2",63,0)
 ;
"RTN","RMPOBIL2",64,0)
ITEMLOOP ;
"RTN","RMPOBIL2",65,0)
 ;
"RTN","RMPOBIL2",66,0)
 S QUIT=0
"RTN","RMPOBIL2",67,0)
 D ITEMD
"RTN","RMPOBIL2",68,0)
 ; ask for ACTION, quit if <return>, timeout, etc
"RTN","RMPOBIL2",69,0)
 S ITMACT=$$ITEMO Q:$$QUIT!(ITMACT="")
"RTN","RMPOBIL2",70,0)
 ; if they entered 'A', do ADD ITEM, then edit it
"RTN","RMPOBIL2",71,0)
 I ITMACT="A" D ITEMA Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEMLOOP
"RTN","RMPOBIL2",72,0)
 ; if they entered 'D', select an item, then delete it
"RTN","RMPOBIL2",73,0)
 I ITMACT="D" D ITEMS Q:QUIT!(ITEM="")  D ITEMK G ITEMLOOP
"RTN","RMPOBIL2",74,0)
 ; if they entered 'E', select an item, then edit it
"RTN","RMPOBIL2",75,0)
 I ITMACT="E" D ITEMS Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEMLOOP
"RTN","RMPOBIL2",76,0)
 ; if they entered 'Z', select an item, then zero it
"RTN","RMPOBIL2",77,0)
 I ITMACT="Z" D ITEMS Q:QUIT!(ITEM="")  D ITEMZ Q:QUIT  G ITEMLOOP
"RTN","RMPOBIL2",78,0)
 G ITEMLOOP
"RTN","RMPOBIL2",79,0)
 Q
"RTN","RMPOBIL2",80,0)
OK2EDIT() ;
"RTN","RMPOBIL2",81,0)
 ;
"RTN","RMPOBIL2",82,0)
 Q $P(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,0),U,2)'="Y"
"RTN","RMPOBIL2",83,0)
 Q
"RTN","RMPOBIL2",84,0)
LOCKED() ;
"RTN","RMPOBIL2",85,0)
 ;
"RTN","RMPOBIL2",86,0)
 L +^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,0):2
"RTN","RMPOBIL2",87,0)
 Q '$T
"RTN","RMPOBIL2",88,0)
 Q
"RTN","RMPOBIL2",89,0)
ITEMD ; Display items
"RTN","RMPOBIL2",90,0)
 ;
"RTN","RMPOBIL2",91,0)
 D BPI,DPI,BII,DII
"RTN","RMPOBIL2",92,0)
 Q
"RTN","RMPOBIL2",93,0)
BPI ; Build pt info hdr
"RTN","RMPOBIL2",94,0)
 K PTI
"RTN","RMPOBIL2",95,0)
 ; Name,SSN
"RTN","RMPOBIL2",96,0)
 S DFN=RMPODFN D DEM^VADPT
"RTN","RMPOBIL2",97,0)
 S PTI(1)=VADM(1)_"    "_$P(VADM(2),U,2)
"RTN","RMPOBIL2",98,0)
 ; Current Rx (IEN on ACT DATE)
"RTN","RMPOBIL2",99,0)
 S RX=$O(^RMPR(665,RMPODFN,"RMPOB"," "),-1)
"RTN","RMPOBIL2",100,0)
 Q:'RX
"RTN","RMPOBIL2",101,0)
 S Y=$P(^RMPR(665,RMPODFN,"RMPOB",RX,0),U) X ^DD("DD") S DT1=Y
"RTN","RMPOBIL2",102,0)
 S Y=$P(^RMPR(665,RMPODFN,"RMPOB",RX,0),U,3) X ^DD("DD") S DT2=Y
"RTN","RMPOBIL2",103,0)
 S PTI(2)="Current Prescription (#"_RX_")"
"RTN","RMPOBIL2",104,0)
 S PTI(3)="      Active Date: "_DT1_"    Expiration Date: "_DT2
"RTN","RMPOBIL2",105,0)
 ; Rx Remarks
"RTN","RMPOBIL2",106,0)
 K TRX
"RTN","RMPOBIL2",107,0)
 S IENS=RX_","_RMPODFN_","
"RTN","RMPOBIL2",108,0)
 D GETS^DIQ(665.193,IENS,3,,"TRX")
"RTN","RMPOBIL2",109,0)
 S I=0 F  S I=$O(TRX(665.193,IENS,3,I)) Q:I=""  D
"RTN","RMPOBIL2",110,0)
 . S PTI(3+I)="      "_TRX(665.193,IENS,3,I)
"RTN","RMPOBIL2",111,0)
 Q
"RTN","RMPOBIL2",112,0)
DPI ; Display pt info hdr
"RTN","RMPOBIL2",113,0)
 S I=0 F  S I=$O(PTI(I)) Q:I=""  W !,PTI(I)
"RTN","RMPOBIL2",114,0)
 Q
"RTN","RMPOBIL2",115,0)
BII ; Build item info array
"RTN","RMPOBIL2",116,0)
 K TRX,ITM,TOT,SUSP,POSTED,PITM,IEN,CIEN
"RTN","RMPOBIL2",117,0)
 S SUSP=0,CIEN=1
"RTN","RMPOBIL2",118,0)
 S IENS=RMPODFN_","_RMPOVDR_","_RMPORVDT_","_RMPOXITE
"RTN","RMPOBIL2",119,0)
 D GETS^DIQ(665.72319,IENS,"**","IE","TRX")
"RTN","RMPOBIL2",120,0)
 S ZX1=""
"RTN","RMPOBIL2",121,0)
 F IEN=0:1 S ZX1=$O(TRX(665.723191,ZX1)) Q:ZX1=""  D
"RTN","RMPOBIL2",122,0)
 . K TMP M TMP=TRX(665.723191,ZX1)
"RTN","RMPOBIL2",123,0)
 . F Z=5,6,10 S TMP(Z,"E")=$J($G(TMP(Z,"E")),0,2)
"RTN","RMPOBIL2",124,0)
 . S TIEN=+ZX1 D BIIL
"RTN","RMPOBIL2",125,0)
 K TMP
"RTN","RMPOBIL2",126,0)
 S TMP(2,"E")="HCPCS"
"RTN","RMPOBIL2",127,0)
 S TMP(.01,"E")="Description"
"RTN","RMPOBIL2",128,0)
 S TMP(3,"E")="FCP"
"RTN","RMPOBIL2",129,0)
 S TMP(7,"E")="Qty"
"RTN","RMPOBIL2",130,0)
 S TMP(5,"E")="Cost"
"RTN","RMPOBIL2",131,0)
 S TMP(6,"E")="Total"
"RTN","RMPOBIL2",132,0)
 S TMP(8,"I")=" "
"RTN","RMPOBIL2",133,0)
 S TMP(10,"E")="Susp."
"RTN","RMPOBIL2",134,0)
 S (CIEN,TIEN)=0 D BIIL
"RTN","RMPOBIL2",135,0)
 Q
"RTN","RMPOBIL2",136,0)
BIIL ;Build detail line
"RTN","RMPOBIL2",137,0)
 ;
"RTN","RMPOBIL2",138,0)
 S:TIEN IEN(CIEN)=TIEN ;S:TIEN IEN(TIEN)=TIEN
"RTN","RMPOBIL2",139,0)
 S ITM(CIEN)="   "
"RTN","RMPOBIL2",140,0)
 ;S:TIEN ITM(TIEN)=$J(TIEN,2)_"."                     ; ITEM #
"RTN","RMPOBIL2",141,0)
 S:TIEN ITM(CIEN)=$J(CIEN,2)_"."                          ; ITEM #
"RTN","RMPOBIL2",142,0)
 S PSTFLG=$S($G(TMP(8,"I"))="Y":"p",1:" ")
"RTN","RMPOBIL2",143,0)
 S BACKPTR=$G(TMP(12,"I"))
"RTN","RMPOBIL2",144,0)
 S TMP(.01,"E")=$G(TMP(.01,"E"))_"                          "
"RTN","RMPOBIL2",145,0)
 S ITM(CIEN)=ITM(CIEN)_$$LJ(PSTFLG,2)                      ; POSTED
"RTN","RMPOBIL2",146,0)
 S ITM(CIEN)=ITM(CIEN)_$$LJ($G(TMP(2,"E")),7)              ; HCPCS
"RTN","RMPOBIL2",147,0)
 S ITM(CIEN)=ITM(CIEN)_$$LJ($G(TMP(.01,"E")),30)           ; ITEM DESCR
"RTN","RMPOBIL2",148,0)
 S ITM(CIEN)=ITM(CIEN)_"  "_$$LJ($P($G(TMP(3,"E"))," "),5)  ; FCP
"RTN","RMPOBIL2",149,0)
 S ITM(CIEN)=ITM(CIEN)_$J($G(TMP(7,"E")),5)                 ; QTY
"RTN","RMPOBIL2",150,0)
 S ITM(CIEN)=ITM(CIEN)_$J($G(TMP(5,"E")),8)                 ; UNIT COST
"RTN","RMPOBIL2",151,0)
 S ITM(CIEN)=ITM(CIEN)_$J($G(TMP(10,"E")),8)                ; SUSP
"RTN","RMPOBIL2",152,0)
 S ITM(CIEN)=ITM(CIEN)_$J($G(TMP(6,"E")),8)                 ; QTY * CST
"RTN","RMPOBIL2",153,0)
 ; Quit if we're doing the header
"RTN","RMPOBIL2",154,0)
 Q:TIEN=0
"RTN","RMPOBIL2",155,0)
 I $G(TMP(8,"I"))="Y" S POSTED(TIEN)=""
"RTN","RMPOBIL2",156,0)
 ; Do totals while we're here
"RTN","RMPOBIL2",157,0)
 S FCP=+TMP(3,"E"),TOTAL=TMP(6,"E")
"RTN","RMPOBIL2",158,0)
 S TOT(FCP)=$G(TOT(FCP))+TOTAL
"RTN","RMPOBIL2",159,0)
 S TOT=$G(TOT)+TOTAL
"RTN","RMPOBIL2",160,0)
 S SUSP=SUSP+$G(TMP(10,"E")),CIEN=CIEN+1
"RTN","RMPOBIL2",161,0)
 Q
"RTN","RMPOBIL2",162,0)
DII ; Display item info array
"RTN","RMPOBIL2",163,0)
 Q:'$G(IEN)
"RTN","RMPOBIL2",164,0)
 W ! F I=0:1:IEN W !,ITM(I)
"RTN","RMPOBIL2",165,0)
 W !!,"TOTAL COST",?72,$J(TOT,6,2),!
"RTN","RMPOBIL2",166,0)
 W !,"Total 910 Charges:",?72,$J(+$G(TOT(910)),6,2),!
"RTN","RMPOBIL2",167,0)
 W !,"Total Station FCP Charges:",?72,$J(TOT-$G(TOT(910)),6,2),!
"RTN","RMPOBIL2",168,0)
 W:SUSP !,"Total Suspended Charges:",?72,$J(SUSP,6,2),!
"RTN","RMPOBIL2",169,0)
 Q
"RTN","RMPOBIL2",170,0)
ITEMO() ; Select action (A/E/D/Z)
"RTN","RMPOBIL2",171,0)
 K DIR
"RTN","RMPOBIL2",172,0)
 S DIR(0)="SBO^A:Add;D:Delete;E:Edit;Z:Zero"
"RTN","RMPOBIL2",173,0)
 S DIR("A")="Select ACTION" D ^DIR
"RTN","RMPOBIL2",174,0)
 Q Y
"RTN","RMPOBIL2",175,0)
 Q
"RTN","RMPOBIL2",176,0)
ITEMA ; Add an item
"RTN","RMPOBIL2",177,0)
 S ITEM=""
"RTN","RMPOBIL2",178,0)
 K DIC S DIC="^RMPR(661,",DIC(0)="AEQMZ" D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOBIL2",179,0)
 S NEW=+Y
"RTN","RMPOBIL2",180,0)
 K DD,DO D SDICE S DIC(0)="LN" S X=NEW
"RTN","RMPOBIL2",181,0)
 D FILE^DICN Q:Y<0!$$QUIT
"RTN","RMPOBIL2",182,0)
 S DA=+Y,DR="2;9" D ^DIE I $$EQUIT S DIK=DIE D WAK Q
"RTN","RMPOBIL2",183,0)
 ;S FCP=$$GETFCP^RMPOBILU I $$QUIT!(FCP<0) S DIK=DIE D WAK Q
"RTN","RMPOBIL2",184,0)
 ;S DR="3///"_$P(FCP,U,2) D ^DIE I $$EQUIT S DIK=DIE D WAK Q
"RTN","RMPOBIL2",185,0)
 ;S ITEM=DA,IEN=$G(IEN)+1,IEN(IEN)=ITEM
"RTN","RMPOBIL2",186,0)
 S IEN=$G(IEN)+1,IEN(IEN)=DA,ITEM=IEN
"RTN","RMPOBIL2",187,0)
 Q
"RTN","RMPOBIL2",188,0)
SDICE ; Set DIC,DIE,DA for adding Trx items
"RTN","RMPOBIL2",189,0)
 K DIC,DIE,DA
"RTN","RMPOBIL2",190,0)
 S ZV=",""V"","
"RTN","RMPOBIL2",191,0)
 S DA(1)=RMPODFN,DA(2)=RMPOVDR,DA(3)=RMPORVDT,DA(4)=RMPOXITE
"RTN","RMPOBIL2",192,0)
 S DIC="^RMPO(665.72,"_DA(4)_",1,"_DA(3)_",1,"_DA(2)_ZV_DA(1)_",1,"
"RTN","RMPOBIL2",193,0)
 S DIE=DIC
"RTN","RMPOBIL2",194,0)
 Q
"RTN","RMPOBIL2",195,0)
ITEMS ; Select an item
"RTN","RMPOBIL2",196,0)
 I IEN=1 S ITEM=1 Q
"RTN","RMPOBIL2",197,0)
 K DIR
"RTN","RMPOBIL2",198,0)
 S ITEM=""
"RTN","RMPOBIL2",199,0)
 S DIR(0)="NO^1:"_IEN,DIR("A")="Select an ITEM"
"RTN","RMPOBIL2",200,0)
 S DIR("?")="Note:  You cannot select POSTED items"
"RTN","RMPOBIL2",201,0)
 M DIR("?")=ITM
"RTN","RMPOBIL2",202,0)
 D ^DIR Q:Y'>0!$$QUIT
"RTN","RMPOBIL2",203,0)
 I $D(POSTED(+Y)) D  G ITEMS
"RTN","RMPOBIL2",204,0)
 . W !,$C(7)_"Item "_(+Y)_" has been POSTED!"
"RTN","RMPOBIL2",205,0)
 S ITEM=+Y I $P($G(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,1,ITEM,0)),U,8)="Y" S PITM=ITEM
"RTN","RMPOBIL2",206,0)
 S BACKPTR=$P($G(^RMPO(665.72,RMPOXITE,1,RMPORVDT,1,RMPOVDR,"V",RMPODFN,1,ITEM,0)),U,13)
"RTN","RMPOBIL2",207,0)
 I $G(BACKPTR),$D(^RMPR(665,RMPODFN,"RMPOC",BACKPTR,0)),$P(^RMPR(665,RMPODFN,"RMPOC",BACKPTR,0),U,11)="Y" S PITM=ITEM
"RTN","RMPOBIL2",208,0)
 Q
"RTN","RMPOBIL2",209,0)
ITEME ; Edit an item
"RTN","RMPOBIL2",210,0)
 K DR D SDICE
"RTN","RMPOBIL2",211,0)
 S DIE("NO^")="BACK"
"RTN","RMPOBIL2",212,0)
 S DA=IEN(ITEM),DR="1;7;S Z1=X;5;S Z2=X;4" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",213,0)
SACK S DR="10;S Z3=X" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",214,0)
 I Z3>(Z1*Z2) D  G SACK
"RTN","RMPOBIL2",215,0)
 . W !,"SUSPENDED AMT SHOULD NOT BE GREATER THAN TOTAL AMOUNT!"
"RTN","RMPOBIL2",216,0)
 S DR="11"_$S(+X=0:"///@",1:"") D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",217,0)
 S DR="6///"_((Z1*Z2)-Z3) D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",218,0)
 S DFCP=$P(^RMPO(665.72,DA(4),1,DA(3),1,DA(2),"V",DA(1),1,DA,0),U,3)
"RTN","RMPOBIL2",219,0)
 F  D  Q:(FCP>0)!QUIT
"RTN","RMPOBIL2",220,0)
 . S FCP=$P($$GETFCP^RMPOBILU(DFCP),U,2) Q:$$QUIT
"RTN","RMPOBIL2",221,0)
 . I FCP<0!(FCP="") W $C(7)_"REQUIRED FIELD!"
"RTN","RMPOBIL2",222,0)
 I FCP>0 S DR="3R///"_FCP_";13R;14" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",223,0)
 Q
"RTN","RMPOBIL2",224,0)
ITEMZ ; Zero an item
"RTN","RMPOBIL2",225,0)
 K DR D SDICE
"RTN","RMPOBIL2",226,0)
 S DA=IEN(ITEM),DR="5///0;6///0;10///0;11///@" D ^DIE Q:$$EQUIT
"RTN","RMPOBIL2",227,0)
 Q
"RTN","RMPOBIL2",228,0)
ITEMK ; Delete an item
"RTN","RMPOBIL2",229,0)
 D SDICE
"RTN","RMPOBIL2",230,0)
 S RMDIC=DIC_IEN(ITEM)_",0)",RMIT=$G(@RMDIC),PITM=$P(RMIT,U,8)
"RTN","RMPOBIL2",231,0)
 I PITM="Y" D  Q
"RTN","RMPOBIL2",232,0)
 . W !,"Can't delete PRIMARY ITEM!"
"RTN","RMPOBIL2",233,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you SURE you want to delete this item"
"RTN","RMPOBIL2",234,0)
 S DIR("B")="NO" D ^DIR Q:Y'>0
"RTN","RMPOBIL2",235,0)
 K DIK,DA D SDICE S DIK=DIC,DA=IEN(ITEM)
"RTN","RMPOBIL2",236,0)
WAK D ^DIK W "  ...deleted!"
"RTN","RMPOBIL2",237,0)
 Q
"RTN","RMPOPED")
0^1^B85905941^B86444066
"RTN","RMPOPED",1,0)
RMPOPED ;EDS/MDB,DDW,RVD - HOME OXYGEN MISC FILE EDITS ;7/24/98
"RTN","RMPOPED",2,0)
 ;;3.0;PROSTHETICS;**29,44,41,52,77,110**;Feb 09, 1996;Build 10
"RTN","RMPOPED",3,0)
 ;
"RTN","RMPOPED",4,0)
 ; HNC - patch 52
"RTN","RMPOPED",5,0)
 ;                 modified SITECHK sub
"RTN","RMPOPED",6,0)
 ;                 X will be undefined from GETS^DIQ if field is null
"RTN","RMPOPED",7,0)
 ;                 added $G.
"RTN","RMPOPED",8,0)
 ;RVD - patch #77  use Fileman to set items that are not Primary item
"RTN","RMPOPED",9,0)
 ;                 to 'N' in order to set correctly the 'AC' cross-ref.
"RTN","RMPOPED",10,0)
 Q
"RTN","RMPOPED",11,0)
UNLOCK I $D(RMPODFN) L -^RMPR(665,RMPODFN)
"RTN","RMPOPED",12,0)
 Q
"RTN","RMPOPED",13,0)
EXIT K DIC,DIE,DIR,DIK,X,Y,Z,DR,DA,DD,DO,D0,DTOUT,DIROUT,DUOUT,DIRUT,QUIT,DFN,ITEM,ITEMS,IEN,IENS,ITMACT,ITM,C,S,W,PI,VDR,ZST
"RTN","RMPOPED",14,0)
 D UNLOCK
"RTN","RMPOPED",15,0)
 Q
"RTN","RMPOPED",16,0)
 ;
"RTN","RMPOPED",17,0)
KEY ;user must have the RMPRSUPERVISOR key in order to add a new patient.
"RTN","RMPOPED",18,0)
 ;option name is EDIT HOME OXYGEN PATIENT
"RTN","RMPOPED",19,0)
 N KEY
"RTN","RMPOPED",20,0)
 S KEY=$O(^DIC(19.1,"B","RMPRSUPERVISOR",0))
"RTN","RMPOPED",21,0)
 I '$D(^VA(200,DUZ,51,KEY)) D  Q
"RTN","RMPOPED",22,0)
 . W !!,"You do not hold the RMPSUPERVISOR key!!"
"RTN","RMPOPED",23,0)
 G PAT
"RTN","RMPOPED",24,0)
 ;
"RTN","RMPOPED",25,0)
SITE ; Editing of Home Oxygen site parameter file.
"RTN","RMPOPED",26,0)
 K DIC,DIE,DA,DR,DD,RMPOXITE
"RTN","RMPOPED",27,0)
 S DIC="^RMPR(669.9,",DIC(0)="QEAMLZ",DIC("A")="Select SITE: "
"RTN","RMPOPED",28,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",29,0)
 K DIC("A")
"RTN","RMPOPED",30,0)
 S (DA,RMPOXITE)=+Y
"RTN","RMPOPED",31,0)
 ; Lock it...
"RTN","RMPOPED",32,0)
 L +^RMPR(669.9,RMPOXITE):2
"RTN","RMPOPED",33,0)
 I '$T D  G SITE
"RTN","RMPOPED",34,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try again later."
"RTN","RMPOPED",35,0)
 ; Edit it
"RTN","RMPOPED",36,0)
 S DIE=DIC,DR="60;61;62;65" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",37,0)
 ; Edit FCP
"RTN","RMPOPED",38,0)
 K DIC,DA,DD,DR,DIE
"RTN","RMPOPED",39,0)
 ;
"RTN","RMPOPED",40,0)
 ; Done.  Unlock
"RTN","RMPOPED",41,0)
 L -^RMPR(669.9,RMPOXITE)
"RTN","RMPOPED",42,0)
 G SITE
"RTN","RMPOPED",43,0)
 ;
"RTN","RMPOPED",44,0)
FCPHLP ; Executable help for FCP multiple in 669.9
"RTN","RMPOPED",45,0)
 ;
"RTN","RMPOPED",46,0)
 Q
"RTN","RMPOPED",47,0)
FCPIX ; Input transform for FCP multiple in 669.9
"RTN","RMPOPED",48,0)
 ;
"RTN","RMPOPED",49,0)
 Q:'$D(X)
"RTN","RMPOPED",50,0)
 I $L(X)>30!($L(X)<3) K X Q
"RTN","RMPOPED",51,0)
 S ZST=$P(^RMPR(669.9,D0,4),U,1),RMPOX=X
"RTN","RMPOPED",52,0)
 D FIND^DIC(420.01,","_ZST_",",".01;","M",X,1,,,,"X")
"RTN","RMPOPED",53,0)
 S X=$S($D(X("DILIST","ID",1,.01)):X("DILIST","ID",1,.01),1:RMPOX)
"RTN","RMPOPED",54,0)
 K X("DILIST"),RMPOX
"RTN","RMPOPED",55,0)
 I $G(ZST),('$D(^PRC(420,+ZST,1,"B",X))) W !,"Control Point is not a valid IFCAP FCP.." K X
"RTN","RMPOPED",56,0)
 Q
"RTN","RMPOPED",57,0)
ACT ;activate/inactivate a home oxygen patient
"RTN","RMPOPED",58,0)
 ;Set up site variables.
"RTN","RMPOPED",59,0)
 D HOSITE^RMPOUTL0 I QUIT D EXIT Q
"RTN","RMPOPED",60,0)
 W @IOF
"RTN","RMPOPED",61,0)
 ;
"RTN","RMPOPED",62,0)
ACT1 ;Toggle ACTIVATE/INACTIVATE functions.
"RTN","RMPOPED",63,0)
 N NAME K DIC,DA
"RTN","RMPOPED",64,0)
 S DIC="^RMPR(665,",DIC(0)="QEAMZ" D ^DIC I Y<0!$$QUIT D EXIT Q
"RTN","RMPOPED",65,0)
 S DIE=DIC,DA=+Y,NAME=Y(0,0)
"RTN","RMPOPED",66,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",67,0)
 I '$T D  G ACT1
"RTN","RMPOPED",68,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try later."
"RTN","RMPOPED",69,0)
 ;If the patient has never been activated, quit.
"RTN","RMPOPED",70,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,2)="" D  G ACT1
"RTN","RMPOPED",71,0)
 . W !!,$C(7)_NAME_" has not been added as a Home Oxygen patient."
"RTN","RMPOPED",72,0)
 . W !,"Please add using the ""Add/Edit Home Oxygen Patient"" option."
"RTN","RMPOPED",73,0)
 ;If the patient is active, perform inactivation actions.
"RTN","RMPOPED",74,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)="" D INACTVT^RMPOPED G ACT1
"RTN","RMPOPED",75,0)
 ;If the patient is inactive, perform activation actions.
"RTN","RMPOPED",76,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)'="" D ACTVT^RMPOPED G ACT1
"RTN","RMPOPED",77,0)
 Q
"RTN","RMPOPED",78,0)
INACTVT ; Inactivate the patient if user wants to.
"RTN","RMPOPED",79,0)
 ; Confirm if the user wants to proceed.
"RTN","RMPOPED",80,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",81,0)
 S DIR("A")="Are you sure you want to inactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",82,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",83,0)
 S DR="19.5//TODAY;19.6;19.7////"_DUZ,DIE("NO^")="BACK"
"RTN","RMPOPED",84,0)
 D ^DIE
"RTN","RMPOPED",85,0)
 Q
"RTN","RMPOPED",86,0)
 ;
"RTN","RMPOPED",87,0)
ACTVT ;Activate the patient if the user wants to.
"RTN","RMPOPED",88,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",89,0)
 S DIR("A")="Are you sure you want to reactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",90,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",91,0)
 S DR="19.2//TODAY;19.5///@;19.6///@;19.7///@"
"RTN","RMPOPED",92,0)
 S DIE("NO^")="BACK"
"RTN","RMPOPED",93,0)
 D ^DIE
"RTN","RMPOPED",94,0)
 Q
"RTN","RMPOPED",95,0)
PAT ;Add/Edit Home Oxygen Patient
"RTN","RMPOPED",96,0)
 S QUIT=0
"RTN","RMPOPED",97,0)
 D HOSITE^RMPOUTL0
"RTN","RMPOPED",98,0)
 I '$D(RMPOXITE)!QUIT D EXIT Q
"RTN","RMPOPED",99,0)
LOOP ;
"RTN","RMPOPED",100,0)
 S QUIT=0
"RTN","RMPOPED",101,0)
 D LOOKUP I QUIT!'$D(RMPODFN) D EXIT Q
"RTN","RMPOPED",102,0)
 D EDBLK I QUIT D EXIT Q
"RTN","RMPOPED",103,0)
 D UNLOCK G LOOP
"RTN","RMPOPED",104,0)
EDBLK ;
"RTN","RMPOPED",105,0)
 D SITECHK Q:QUIT
"RTN","RMPOPED",106,0)
 D DEMOG Q:QUIT
"RTN","RMPOPED",107,0)
 D RX Q:QUIT
"RTN","RMPOPED",108,0)
 D ITEM
"RTN","RMPOPED",109,0)
 Q
"RTN","RMPOPED",110,0)
 ;called by ^RMPOBIL1, providing RMPOPATN as the X variable
"RTN","RMPOPED",111,0)
EDIT ;From Billing...
"RTN","RMPOPED",112,0)
 I '$D(RMPODFN) S RMPODFN=$TR($G(RMPOPATN),"`")
"RTN","RMPOPED",113,0)
 Q:'$D(^RMPR(665,+RMPODFN,0))
"RTN","RMPOPED",114,0)
 W !,"EDITING "_$P(^DPT(RMPODFN,0),U)_"...",!
"RTN","RMPOPED",115,0)
 S QUIT=0,DA=RMPODFN
"RTN","RMPOPED",116,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",117,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" Q
"RTN","RMPOPED",118,0)
 D EDBLK,EXIT
"RTN","RMPOPED",119,0)
 Q
"RTN","RMPOPED",120,0)
LOOKUP ;First look-up the patient
"RTN","RMPOPED",121,0)
 K DIC,DIE,DA,DR,RMPODFN
"RTN","RMPOPED",122,0)
 W !!! S DIC="^RMPR(665,",DIC(0)="LQEAMZ"
"RTN","RMPOPED",123,0)
 D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOPED",124,0)
CONT S (RMPODFN,DA)=+Y
"RTN","RMPOPED",125,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",126,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" G LOOKUP
"RTN","RMPOPED",127,0)
 Q
"RTN","RMPOPED",128,0)
 ;
"RTN","RMPOPED",129,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOPED",130,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOPED",131,0)
LJ(S,W,C) ; LEFT JUSTIFY S IN A FIELD W WIDE PADDING WITH CHAR F
"RTN","RMPOPED",132,0)
 ;
"RTN","RMPOPED",133,0)
 S C=$G(C," ")   ;DEFAULT PAD CHAR IS SPACE
"RTN","RMPOPED",134,0)
 S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOPED",135,0)
 Q S
"RTN","RMPOPED",136,0)
 ;
"RTN","RMPOPED",137,0)
SITECHK ;If user chooses patient from site different from billing site
"RTN","RMPOPED",138,0)
 ;
"RTN","RMPOPED",139,0)
 S Y=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,7)
"RTN","RMPOPED",140,0)
 Q:Y=RMPOXITE    ;Site is the same.. 
"RTN","RMPOPED",141,0)
 I Y="" D SET Q   ;Site not defined, stuff RMPOXITE...
"RTN","RMPOPED",142,0)
 ; Site is different...
"RTN","RMPOPED",143,0)
 S IENS=RMPODFN_","
"RTN","RMPOPED",144,0)
 D GETS^DIQ(665,IENS,19.12,"E","X")
"RTN","RMPOPED",145,0)
 W !!,"Patient's Home Oxygen Contract Location (HOCL) is "
"RTN","RMPOPED",146,0)
 W $G(X(665,IENS,19.12,"E"))
"RTN","RMPOPED",147,0)
 W !,"You are working on billing for HOCL "_RMPO("NAME"),!
"RTN","RMPOPED",148,0)
 K DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","RMPOPED",149,0)
 S DIR("A")="Should I change this patient's HOCL to "_RMPO("NAME")
"RTN","RMPOPED",150,0)
 D ^DIR Q:$$QUIT!(Y=0)
"RTN","RMPOPED",151,0)
 D SET
"RTN","RMPOPED",152,0)
 Q
"RTN","RMPOPED",153,0)
SET ;
"RTN","RMPOPED",154,0)
 K DIE,DR,DA
"RTN","RMPOPED",155,0)
 S DA=RMPODFN
"RTN","RMPOPED",156,0)
 ;W "HERE,RMPOXITE=",RMPOXITE
"RTN","RMPOPED",157,0)
 S DIE="^RMPR(665,",DR="19.12////"_RMPOXITE D ^DIE
"RTN","RMPOPED",158,0)
 Q
"RTN","RMPOPED",159,0)
 ;
"RTN","RMPOPED",160,0)
DEMOG ;First edit the patient's basic fields
"RTN","RMPOPED",161,0)
 ;
"RTN","RMPOPED",162,0)
 K DIE,DR,DA
"RTN","RMPOPED",163,0)
 S DA=RMPODFN
"RTN","RMPOPED",164,0)
 S DIE="^RMPR(665,",DR="19.1" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",165,0)
 S RMPOELIG=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U)
"RTN","RMPOPED",166,0)
 K DR S DR="19.11"_$S(RMPOELIG="D":"",1:"///@")_";19.12"
"RTN","RMPOPED",167,0)
 D ^DIE Q:$$EQUIT
"RTN","RMPOPED",168,0)
 K DR S Y=DT X ^DD("DD") S DR="19.2//"_Y D ^DIE Q:$$QUIT
"RTN","RMPOPED",169,0)
 Q
"RTN","RMPOPED",170,0)
 ;
"RTN","RMPOPED",171,0)
RX ;Edit the Rx Data
"RTN","RMPOPED",172,0)
 ;
"RTN","RMPOPED",173,0)
 K DIC,DIE,DA,DR
"RTN","RMPOPED",174,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOB"",",DIC(0)="AEQLZ"
"RTN","RMPOPED",175,0)
 S DA(1)=RMPODFN,DIC("P")="665.193D"
"RTN","RMPOPED",176,0)
 I $D(^DISV(DUZ,DIC)) S Y=^(DIC) I $D(@(DIC_(+Y)_",0)")) D
"RTN","RMPOPED",177,0)
 . S DIC("B")=$P(^(0),U,1)
"RTN","RMPOPED",178,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",179,0)
 S DIE=DIC,DA=+Y,DR=".01;2//^D EXPIRE^RMPOBIL4;3" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",180,0)
 Q
"RTN","RMPOPED",181,0)
 ;
"RTN","RMPOPED",182,0)
ITEM ;Add/Edit Items
"RTN","RMPOPED",183,0)
 ;
"RTN","RMPOPED",184,0)
 ; Display items
"RTN","RMPOPED",185,0)
 D ITEMD
"RTN","RMPOPED",186,0)
 ; If no items on file, then only allow ADD PRIMARY ITEM
"RTN","RMPOPED",187,0)
 I '$D(IEN) D ITEMP Q:QUIT!(ITEM="")  G ITEM
"RTN","RMPOPED",188,0)
 ; ask for ACTION, quit if <return>, timeout, etc
"RTN","RMPOPED",189,0)
 S ITMACT=$$ITEMO Q:$$QUIT!(ITMACT="")
"RTN","RMPOPED",190,0)
 ; if they entered 'A', do ADD ITEM, then edit it
"RTN","RMPOPED",191,0)
 I ITMACT="A" D ITEMA Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",192,0)
 ; if they entered 'D', select an item, then delete it
"RTN","RMPOPED",193,0)
 I ITMACT="D" D ITEMS Q:QUIT!(ITEM="")  D ITEMK G ITEM
"RTN","RMPOPED",194,0)
 ; if they entered 'E', select an item, then edit it
"RTN","RMPOPED",195,0)
 I ITMACT="E" D ITEMS Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",196,0)
 G ITEM
"RTN","RMPOPED",197,0)
 Q
"RTN","RMPOPED",198,0)
ITEMP ; Add Primary Item
"RTN","RMPOPED",199,0)
 W !!,$C(7)_"No items found, please enter PRIMARY ITEM",!
"RTN","RMPOPED",200,0)
 D ITEMA Q:QUIT!(ITEM="")
"RTN","RMPOPED",201,0)
 S PI="///Y" D ITEME K PI
"RTN","RMPOPED",202,0)
 Q
"RTN","RMPOPED",203,0)
ITEMA ; Add Items
"RTN","RMPOPED",204,0)
 S ITEM=""
"RTN","RMPOPED",205,0)
 K DIC S DIC="^RMPR(661,",DIC(0)="AEQMZ" D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",206,0)
 K DD,DO,DA,DIC
"RTN","RMPOPED",207,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOC"",",DIC(0)="L"
"RTN","RMPOPED",208,0)
 S DIC("P")=$P(^DD(665,19.4,0),U,2),DA(1)=RMPODFN,X=+Y
"RTN","RMPOPED",209,0)
 D FILE^DICN I Y>0 S IEN=$G(IEN)+1,IEN(IEN)=+Y,ITEM=IEN
"RTN","RMPOPED",210,0)
 Q
"RTN","RMPOPED",211,0)
ITEMS ; Select Item
"RTN","RMPOPED",212,0)
 ; Return ITEM = index into both ITEMS and IEN arrays
"RTN","RMPOPED",213,0)
 I IEN=1 S ITEM=1 W "  ",$E(ITEMS(1),1,33) Q
"RTN","RMPOPED",214,0)
 K DIR
"RTN","RMPOPED",215,0)
 S ITEM=""
"RTN","RMPOPED",216,0)
 S DIR(0)="NO^1:"_IEN,DIR("A")="Select an ITEM"
"RTN","RMPOPED",217,0)
 S DIR("?")="Select an item from the list"
"RTN","RMPOPED",218,0)
 M DIR("?")=ITEMS
"RTN","RMPOPED",219,0)
 D ^DIR Q:Y'>0!$$QUIT
"RTN","RMPOPED",220,0)
 S ITEM=+Y W "  ",$E(ITEMS(ITEM),1,33)
"RTN","RMPOPED",221,0)
 Q
"RTN","RMPOPED",222,0)
ITEME ; Edit an Item
"RTN","RMPOPED",223,0)
 N FCP,DFCP,RMCPTHCP,RMCPRENT K DIE,DA,DR,RMCPT
"RTN","RMPOPED",224,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIE="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",225,0)
 D ITEMEP Q:QUIT
"RTN","RMPOPED",226,0)
 S DR=".01R;6R" D ^DIE Q:$$EQUIT!('$D(DA))
"RTN","RMPOPED",227,0)
 S RMCPTHCP=$P($G(^RMPR(665,RMPODFN,"RMPOC",DA,0)),U,7)
"RTN","RMPOPED",228,0)
 S RMCPT=$P($G(^RMPR(661.1,RMCPTHCP,4)),U,1) S DR=""
"RTN","RMPOPED",229,0)
 S RMCPRENT=$P($G(^RMPR(661.1,RMCPTHCP,5)),U,1)
"RTN","RMPOPED",230,0)
 I RMCPT["RR",(RMCPRENT=1) S DR="11;"
"RTN","RMPOPED",231,0)
 I RMCPT["QH" S DR=DR_"12;"
"RTN","RMPOPED",232,0)
 S DR=DR_"1R;2R;3R;4;7;8;9R" K RMCPRENT,RMCPTHCP
"RTN","RMPOPED",233,0)
 D ^DIE I $D(DA),$D(RMCPT),(RMCPT'["RR") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,12)=""
"RTN","RMPOPED",234,0)
 I $D(DA),$D(RMCPT),(RMCPT'["QH") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,13)=""
"RTN","RMPOPED",235,0)
 Q:$$EQUIT
"RTN","RMPOPED",236,0)
 ; Kludge to "point" to file 420
"RTN","RMPOPED",237,0)
 S DFCP=$P(^RMPR(665,RMPODFN,"RMPOC",IEN(ITEM),0),U,6)
"RTN","RMPOPED",238,0)
 F  D  Q:(FCP>0)!QUIT
"RTN","RMPOPED",239,0)
 . S FCP=$$GETFCP^RMPOBILU(DFCP) Q:QUIT
"RTN","RMPOPED",240,0)
 . I FCP<0 W $C(7)_"REQUIRED FIELD!"
"RTN","RMPOPED",241,0)
 I FCP>0 S DR="5///"_$P(FCP,U,2) D ^DIE Q:$$EQUIT
"RTN","RMPOPED",242,0)
 ; End Kludge
"RTN","RMPOPED",243,0)
 ;S DR="7:9" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",244,0)
 Q
"RTN","RMPOPED",245,0)
ITEMEP ; Primary Item edit...
"RTN","RMPOPED",246,0)
 N PIEN,PFLG,RMDA,RMNO
"RTN","RMPOPED",247,0)
 S RMDA=DA,DR="10" D ^DIE Q:$$QUIT
"RTN","RMPOPED",248,0)
 I $P(^RMPR(665,RMPODFN,"RMPOC",RMDA,0),U,11)'="Y" Q
"RTN","RMPOPED",249,0)
 ; Logic to control toggling of Primary Item flag...
"RTN","RMPOPED",250,0)
 S RMNO="N"
"RTN","RMPOPED",251,0)
 F RMX=0:0 S RMX=$O(^RMPR(665,RMPODFN,"RMPOC",RMX)) Q:RMX'>0  D
"RTN","RMPOPED",252,0)
 . Q:RMDA=RMX
"RTN","RMPOPED",253,0)
 . S DA=RMX,DR="10///^S X=RMNO" D ^DIE
"RTN","RMPOPED",254,0)
 S DA=RMDA
"RTN","RMPOPED",255,0)
 Q
"RTN","RMPOPED",256,0)
PIEN(DFN) ; FIND PRIMARY ITEM
"RTN","RMPOPED",257,0)
 ; RETURN IEN OF P.I. IN MULTIPLE ^ IEN IN FILE 661
"RTN","RMPOPED",258,0)
 N X,PIEN
"RTN","RMPOPED",259,0)
 S X=0,PIEN=0
"RTN","RMPOPED",260,0)
 F  S X=$O(^RMPR(665,DFN,"RMPOC",X)) Q:X'>0  D  Q:PIEN
"RTN","RMPOPED",261,0)
 . S:$P(^RMPR(665,DFN,"RMPOC",X,0),U,11)="Y" PIEN=X
"RTN","RMPOPED",262,0)
 S:PIEN PIEN=PIEN_U_$P(^RMPR(665,DFN,"RMPOC",PIEN,0),U,1)
"RTN","RMPOPED",263,0)
 Q PIEN
"RTN","RMPOPED",264,0)
ITEMD ; Display Items
"RTN","RMPOPED",265,0)
 N I,Z,PIF,ITMNM,VDRNM
"RTN","RMPOPED",266,0)
 K IEN,ITEMS S I=0
"RTN","RMPOPED",267,0)
 Q:$O(^RMPR(665,RMPODFN,"RMPOC",0))'>0
"RTN","RMPOPED",268,0)
 W !!,"The following items are already in this patient's template:",!
"RTN","RMPOPED",269,0)
 F IEN=1:1 S I=$O(^RMPR(665,RMPODFN,"RMPOC",I)) Q:I'>0  D
"RTN","RMPOPED",270,0)
 . S Z=^RMPR(665,RMPODFN,"RMPOC",I,0)
"RTN","RMPOPED",271,0)
 . S PIF=$S($P(Z,U,11)="Y":"*",1:" ")
"RTN","RMPOPED",272,0)
 . S ITMNM=$$ITEMNM($P(Z,U)),VDRNM=$$VDRNM($P(Z,U,2))
"RTN","RMPOPED",273,0)
 .; K X S IENS=$P(Z,U)_","
"RTN","RMPOPED",274,0)
 .; D GETS^DIQ(661,IENS,.01,"","X") S ITMNM=$E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",275,0)
 .; S IENS=$P(Z,U,2)_",",VDRNM="<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",276,0)
 .; I IENS'="," D GETS^DIQ(440,IENS,.01,"","X") S VDRNM=X(440,IENS,.01)
"RTN","RMPOPED",277,0)
 . S IEN(IEN)=I
"RTN","RMPOPED",278,0)
 . S ITEMS(IEN)=" "_PIF_$J(IEN,4)_"  "_$$LJ(ITMNM,38)_$E(VDRNM,1,30)
"RTN","RMPOPED",279,0)
 . W !,ITEMS(IEN)
"RTN","RMPOPED",280,0)
 W !!," * = Primary Item",!
"RTN","RMPOPED",281,0)
 S IEN=IEN-1
"RTN","RMPOPED",282,0)
 Q
"RTN","RMPOPED",283,0)
ITEMNM(ITM) ; RETURN ITEM NAME
"RTN","RMPOPED",284,0)
 S IENS=ITM_","
"RTN","RMPOPED",285,0)
 D GETS^DIQ(661,IENS,.01,"","X")
"RTN","RMPOPED",286,0)
 Q $E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",287,0)
VDRNM(VDR) ; RETURN VENDOR NAME
"RTN","RMPOPED",288,0)
 I VDR="" Q "<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",289,0)
 S IENS=VDR_"," D GETS^DIQ(440,IENS,.01,"","X")
"RTN","RMPOPED",290,0)
 Q X(440,IENS,.01)
"RTN","RMPOPED",291,0)
ITEMK ; Delete an Item
"RTN","RMPOPED",292,0)
 ;
"RTN","RMPOPED",293,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you SURE you want to delete this item"
"RTN","RMPOPED",294,0)
 S DIR("B")="NO" D ^DIR Q:Y'>0
"RTN","RMPOPED",295,0)
 K DIK,DA
"RTN","RMPOPED",296,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIK="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",297,0)
 D ^DIK W "  ...deleted!"
"RTN","RMPOPED",298,0)
 Q
"RTN","RMPOPED",299,0)
ITEMO() ; Choose Option
"RTN","RMPOPED",300,0)
 K DIR
"RTN","RMPOPED",301,0)
 S DIR(0)="SBO^A:Add;D:Delete;E:Edit",DIR("A")="Select ACTION" D ^DIR
"RTN","RMPOPED",302,0)
 Q Y
"RTN","RMPOPED",303,0)
 Q
"RTN","RMPOPS23")
0^3^B30619186^B30575942
"RTN","RMPOPS23",1,0)
RMPOPS23 ;HIN/RVD - HOME OXYGEN BILLING - POST TO 2319 ;5/18/99
"RTN","RMPOPS23",2,0)
 ;;3.0;PROSTHETICS;**29,44,41,110**;Feb 09, 1996;Build 10
"RTN","RMPOPS23",3,0)
 ;
"RTN","RMPOPS23",4,0)
 ;This routine will only post records already been posted in IFCAP.
"RTN","RMPOPS23",5,0)
 ;Patient records are sorted by fund control point (FCP), DFN and
"RTN","RMPOPS23",6,0)
 ;then post to 2319.
"RTN","RMPOPS23",7,0)
 Q
"RTN","RMPOPS23",8,0)
 ;
"RTN","RMPOPS23",9,0)
POST ;main module to post billing transactions to 2319
"RTN","RMPOPS23",10,0)
 D HOME^%ZIS S QUIT=0
"RTN","RMPOPS23",11,0)
 D HOSITE^RMPOUTL0 Q:('$D(RMPOXITE))!QUIT
"RTN","RMPOPS23",12,0)
 D MONTH^RMPOBIL0() Q:$D(RMPODATE)=0!QUIT
"RTN","RMPOPS23",13,0)
 D VENDOR^RMPOBIL0() Q:$D(RMPOVDR)=0!QUIT
"RTN","RMPOPS23",14,0)
 S FIL=665.72,SITE=RMPOXITE,RVDT=RMPODATE,VDR=RMPOVDR,QUIT=0
"RTN","RMPOPS23",15,0)
 W !,"Processing..." D BUILD
"RTN","RMPOPS23",16,0)
 I $O(^TMP($J,""))="" W !,"Everything posted okay!!" G EXIT
"RTN","RMPOPS23",17,0)
 S FCP="" F  S FCP=$O(^TMP($J,FCP)) Q:FCP=""  F DFN=0:0 S DFN=$O(^TMP($J,FCP,DFN)) Q:DFN'>0  D F660
"RTN","RMPOPS23",18,0)
 ;K DIR S DIR(0)="FO",DIR("A")="Press any Key to Continue" D ^DIR
"RTN","RMPOPS23",19,0)
 ;
"RTN","RMPOPS23",20,0)
EXIT ;
"RTN","RMPOPS23",21,0)
 K ^TMP($J)
"RTN","RMPOPS23",22,0)
 ;K DFN,ITM,ITDT,ITNO,PATNAM,PATSSN,LNAM,PATFLG,ITSTR,FCP,LCK,ITOT
"RTN","RMPOPS23",23,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPOPS23",24,0)
 Q
"RTN","RMPOPS23",25,0)
 ;
"RTN","RMPOPS23",26,0)
BUILD ;Build array IFCAP with patient transactions to post
"RTN","RMPOPS23",27,0)
 ;Separate patient individual items by fund control point
"RTN","RMPOPS23",28,0)
 ;tMP($J) array
"RTN","RMPOPS23",29,0)
 ;   ^TMP($J,FCP)=FCP total^Post flag^error message^purchase card total
"RTN","RMPOPS23",30,0)
 ;   ^TMP($J,FCP,DFN)=patient tot^pat last name_" "_4 digit SSN^post flag^
"RTN","RMPOPS23",31,0)
 ;                  IFCAP error message^pat name
"RTN","RMPOPS23",32,0)
 ;   ^TMP($J,FCP,DFN,ITEM)=item tot
"RTN","RMPOPS23",33,0)
 K ^TMP($J)
"RTN","RMPOPS23",34,0)
 S DFN=0 F  S DFN=$O(^RMPO(FIL,SITE,1,RVDT,1,VDR,"V",DFN)) Q:DFN'>0  D
"RTN","RMPOPS23",35,0)
 . S PATFLG=^RMPO(FIL,SITE,1,RVDT,1,VDR,"V",DFN,0)
"RTN","RMPOPS23",36,0)
 . ;check patient post flag
"RTN","RMPOPS23",37,0)
 . Q:$P(PATFLG,U,3)'="Y"
"RTN","RMPOPS23",38,0)
 . D DEM^VADPT S PATNAM=VADM(1),PATSSN=VA("BID") ;patient name & ssn
"RTN","RMPOPS23",39,0)
 . ;lock patient record
"RTN","RMPOPS23",40,0)
 . S LCK=$$PATLCK() I 'LCK W !,PATNAM," record locked by another user" Q
"RTN","RMPOPS23",41,0)
 . ;get items not posted for each patient
"RTN","RMPOPS23",42,0)
 . S ITM=0
"RTN","RMPOPS23",43,0)
 . F  S ITM=$O(^RMPO(FIL,SITE,1,RVDT,1,VDR,"V",DFN,1,ITM)) Q:'ITM  D
"RTN","RMPOPS23",44,0)
 . . S ITDT=^RMPO(FIL,SITE,1,RVDT,1,VDR,"V",DFN,1,ITM,0)
"RTN","RMPOPS23",45,0)
 . . ;check if item posted
"RTN","RMPOPS23",46,0)
 . . Q:$P(ITDT,U,10)'="Y"
"RTN","RMPOPS23",47,0)
 . . Q:$P(ITDT,U,16)>0
"RTN","RMPOPS23",48,0)
 . . S ITNO=$P(ITDT,U),FCP=$P(ITDT,U,3),ITOT=$P(ITDT,U,6)
"RTN","RMPOPS23",49,0)
 . . I ITOT'>0 Q  ;no amount to post
"RTN","RMPOPS23",50,0)
 . . I FCP="" Q  ;no fund control point
"RTN","RMPOPS23",51,0)
 . . ;set ^TMP($J) array
"RTN","RMPOPS23",52,0)
 . . S ^TMP($J,FCP)=$S('$D(^TMP($J,FCP)):0.00,1:^TMP($J,FCP))+ITOT
"RTN","RMPOPS23",53,0)
 . . I $G(^TMP($J,FCP,DFN))="" D
"RTN","RMPOPS23",54,0)
 . . . S LNAM=$E($P(PATNAM,",")_"       ",1,7)
"RTN","RMPOPS23",55,0)
 . . . S ^TMP($J,FCP,DFN)="^"_LNAM_" "_PATSSN_"^^^"_$E(PATNAM,1,18)
"RTN","RMPOPS23",56,0)
 . . S $P(^TMP($J,FCP,DFN),U)=+^TMP($J,FCP,DFN)+ITOT,^TMP($J,FCP,DFN,ITM)=ITOT
"RTN","RMPOPS23",57,0)
 . D UNLKPAT
"RTN","RMPOPS23",58,0)
 Q
"RTN","RMPOPS23",59,0)
 ;
"RTN","RMPOPS23",60,0)
F660 ;Post to file ^RMPR(660 for form 2319
"RTN","RMPOPS23",61,0)
 S D665A=$G(^RMPR(665,DFN,"RMPOA")) I D665A="" Q
"RTN","RMPOPS23",62,0)
 D  ;AMIS grouper number
"RTN","RMPOPS23",63,0)
 . L +^RMPR(669.9,RMPOXITE,0):9999 I $T=0 S RMPOG=DT_$P(DT,2,3) Q
"RTN","RMPOPS23",64,0)
 . S RMPOG=$P(^RMPR(669.9,RMPOXITE,0),U,7),RMPOG=RMPOG-1
"RTN","RMPOPS23",65,0)
 . S $P(^RMPR(669.9,RMPOXITE,0),U,7)=RMPOG
"RTN","RMPOPS23",66,0)
 . L -^RMPR(669.9,RMPOXITE,0)
"RTN","RMPOPS23",67,0)
 S TRXDT=$P(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RMPOVDR,0),U,2)
"RTN","RMPOPS23",68,0)
 S RFCPIEN=$O(^RMPO(665.72,1,1,RMPODATE,2,"B",FCP,0))
"RTN","RMPOPS23",69,0)
 S SRVORD=$P(^RMPO(665.72,RMPOXITE,1,RMPODATE,2,RFCPIEN,0),U,4)
"RTN","RMPOPS23",70,0)
 S PAYINF=$P(^RMPO(665.72,RMPOXITE,1,RMPODATE,2,RFCPIEN,0),U,2)
"RTN","RMPOPS23",71,0)
 S ITM=0 F  S ITM=$O(^TMP($J,FCP,DFN,ITM)) Q:ITM'>0  D
"RTN","RMPOPS23",72,0)
 . S ITMD=$G(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RMPOVDR,"V",DFN,1,ITM,0))
"RTN","RMPOPS23",73,0)
 . S RMITEM=$P(ITMD,U,1)
"RTN","RMPOPS23",74,0)
 . I $G(RMITEM),$D(^RMPR(661,RMITEM,0)) S RITIEN=$P(^RMPR(661,RMITEM,0),U,1)
"RTN","RMPOPS23",75,0)
 . I ITMD="" Q
"RTN","RMPOPS23",76,0)
 . I $P(ITMD,U,6)'>0 Q       ;nothing posted to IFCAP
"RTN","RMPOPS23",77,0)
 . S RMCPHC=$P(ITMD,U,2),RMCPT="",RMCPRENT=$P(ITMD,U,18),RMCPSO="C"
"RTN","RMPOPS23",78,0)
 . S RMCPTY=$P(ITMD,U,14),RMCPQH=$P(ITMD,U,19)
"RTN","RMPOPS23",79,0)
 . S RMCPT1=$G(^RMPR(661.1,RMCPHC,4))
"RTN","RMPOPS23",80,0)
 . I RMCPT1["RP",((RMCPTY="R")!(RMCPTY="X")) S RMCPT=RMCPT_"RP,"
"RTN","RMPOPS23",81,0)
 . I RMCPT1["QH",($G(RMCPQH)) S RMCPT=RMCPT_"QH,"
"RTN","RMPOPS23",82,0)
 . I (RMCPRENT=1),(RMCPT1["RR") S RMCPT=RMCPT_"RR,"
"RTN","RMPOPS23",83,0)
 . I RMCPT1["NU",(RMCPT'["RR") S RMCPT=RMCPT_"NU,"
"RTN","RMPOPS23",84,0)
 . I $L(RMCPT)>2 S RMCLEN=$L(RMCPT),RMCPT=$E(RMCPT,1,RMCLEN-1)
"RTN","RMPOPS23",85,0)
 . S DIC="^RMPR(660,",DIC(0)="L",X=DT
"RTN","RMPOPS23",86,0)
 . K DD,DO D FILE^DICN I +Y<0 Q
"RTN","RMPOPS23",87,0)
 . S D6I=+Y,D6X=D6I_","
"RTN","RMPOPS23",88,0)
 . K DIE,DA,DR S DA(4)=RMPOXITE,DA(3)=RMPODATE,DA(2)=RMPOVDR,DA(1)=DFN
"RTN","RMPOPS23",89,0)
 . S DIE="^RMPO(665.72,"_DA(4)_",1,"_DA(3)_",1,"_DA(2)_",""V"","_DA(1)
"RTN","RMPOPS23",90,0)
 . S DIE=DIE_",1,",DA=ITM,DR="15////^S X=D6I" D ^DIE
"RTN","RMPOPS23",91,0)
 . S D660(660,D6X,.02)=DFN                 ;Patient name pointer
"RTN","RMPOPS23",92,0)
 . S D660(660,D6X,1)=TRXDT                 ;Request date
"RTN","RMPOPS23",93,0)
 . S D660(660,D6X,2)=$P(ITMD,U,14)         ;Type of transaction
"RTN","RMPOPS23",94,0)
 . S D660(660,D6X,4)=$P(ITMD,U)            ;item
"RTN","RMPOPS23",95,0)
 . S D660(660,D6X,4.1)=$P(^RMPR(661.1,$P(ITMD,U,2),0),U,4) ;HCPCS
"RTN","RMPOPS23",96,0)
 . S D660(660,D6X,4.5)=$P(ITMD,U,2)        ;PSAS HCPCS
"RTN","RMPOPS23",97,0)
 . S D660(660,D6X,4.7)=RMCPT               ;RMCPT
"RTN","RMPOPS23",98,0)
 . S D660(660,D6X,5)=$P(ITMD,U,7)          ;quantity
"RTN","RMPOPS23",99,0)
 . S D660(660,D6X,7)=RMPOVDR               ;vendor
"RTN","RMPOPS23",100,0)
 . S D660(660,D6X,8)=RMPO("STA")           ;station
"RTN","RMPOPS23",101,0)
 . S D660(660,D6X,10)=DT                   ;Delivery date
"RTN","RMPOPS23",102,0)
 . I $P(PAYINF,U) S D660(660,D6X,11)=9
"RTN","RMPOPS23",103,0)
 . I $P(PAYINF,U)="P" S D660(660,D6X,11)=14
"RTN","RMPOPS23",104,0)
 . S D660(660,D6X,23)=SRVORD               ;IFCAP transaction number
"RTN","RMPOPS23",105,0)
 . S D660(660,D6X,12)="C"                  ;Source
"RTN","RMPOPS23",106,0)
 . S D660(660,D6X,14)=$P(ITMD,U,6)         ;total cost
"RTN","RMPOPS23",107,0)
 . S D660(660,D6X,16)=$P(ITMD,U,4)         ;remarks
"RTN","RMPOPS23",108,0)
 . S SUSDES=$S($P(ITMD,U,11)'="":"Suspended Amt "_$P(ITMD,U,11)_" ",1:"")
"RTN","RMPOPS23",109,0)
 . S D660(660,D6X,24)=SUSDES_$P(ITMD,U,12) ;description
"RTN","RMPOPS23",110,0)
 . S D660(660,D6X,27)=DUZ                  ;initator
"RTN","RMPOPS23",111,0)
 . S D660(660,D6X,62)=$P(D665A,U)          ;patient category
"RTN","RMPOPS23",112,0)
 . S D660(660,D6X,63)=$P(D665A,U,5)        ;special category
"RTN","RMPOPS23",113,0)
 . S D660(660,D6X,68)=RMPOG
"RTN","RMPOPS23",114,0)
 . S D660(660,D6X,78)=$P(ITMD,U,15)        ;unit of issue
"RTN","RMPOPS23",115,0)
 . D FILE^DIE("K","D660","ERR")
"RTN","RMPOPS23",116,0)
 . I $D(ERR) D
"RTN","RMPOPS23",117,0)
 . . W !!,"Posting to 2319 for item ",ITM," patient ",DFN," failed."
"RTN","RMPOPS23",118,0)
 . . W "Posting will be done later"
"RTN","RMPOPS23",119,0)
 . I '$D(ERR),$D(^DPT(DFN,0)),$D(^PRC(441,RITIEN,0)) D
"RTN","RMPOPS23",120,0)
 . . W !,"Patient: ",$P(^DPT(DFN,0),U,1)," Item: ",ITM," posted to 2319."
"RTN","RMPOPS23",121,0)
 K DIC,X,Y
"RTN","RMPOPS23",122,0)
 Q
"RTN","RMPOPS23",123,0)
 ;
"RTN","RMPOPS23",124,0)
PATLCK() ;Lock patient level in ^RMPO(665.72
"RTN","RMPOPS23",125,0)
 L +^RMPO(FIL,SITE,1,RVDT,1,VDR,"V",DFN,0):5
"RTN","RMPOPS23",126,0)
 Q $T
"RTN","RMPOPS23",127,0)
 ;
"RTN","RMPOPS23",128,0)
UNLKPAT ;Unlock patient level in ^RMPO(665.72
"RTN","RMPOPS23",129,0)
 L -^RMPO(FIL,SITE,1,RVDT,1,VDR,"V",DFN,0)
"RTN","RMPOPS23",130,0)
 Q
"RTN","RMPOPS23",131,0)
 ;
"RTN","RMPOPS23",132,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOPST3")
0^4^B24131485^B24093511
"RTN","RMPOPST3",1,0)
RMPOPST3 ;EDS/JAM,HinesIO/DDA - HOME OXYGEN BILLING TRANSACTIONS/ACCEPT FOR POST ;7/24/98
"RTN","RMPOPST3",2,0)
 ;;3.0;PROSTHETICS;**29,44,41,98,110**;Feb 09, 1996;Build 10
"RTN","RMPOPST3",3,0)
 ;This subroutine is part of the billing module. Check file 665.72
"RTN","RMPOPST3",4,0)
 ;for accepted transactions not yet posted.
"RTN","RMPOPST3",5,0)
 Q
"RTN","RMPOPST3",6,0)
ACCEPT ; Check for accepted entries and post if user indicates
"RTN","RMPOPST3",7,0)
 N DFNS
"RTN","RMPOPST3",8,0)
 D FNDACC I $O(DFNS(""))="" Q
"RTN","RMPOPST3",9,0)
 D PSTACC
"RTN","RMPOPST3",10,0)
 Q  ;ACCEPT
"RTN","RMPOPST3",11,0)
 ;
"RTN","RMPOPST3",12,0)
TEST ;set test data
"RTN","RMPOPST3",13,0)
 N RMPOXITE,RMPOVDR,RMPODATE,DFNS
"RTN","RMPOPST3",14,0)
 S RMPOXITE=1,RMPOVDR=10,RMPODATE=2981200,DFNS(47)=""
"RTN","RMPOPST3",15,0)
 S RMPO("STA")=521
"RTN","RMPOPST3",16,0)
 D FNDACC I $O(DFNS(""))="" Q
"RTN","RMPOPST3",17,0)
 D PSTACC
"RTN","RMPOPST3",18,0)
 Q  ;TEST
"RTN","RMPOPST3",19,0)
 ;
"RTN","RMPOPST3",20,0)
FNDACC ;Check records to ensure all accepted transactions are posted.
"RTN","RMPOPST3",21,0)
 N DFN,BILDT,SITE,FIL,VDR,I
"RTN","RMPOPST3",22,0)
 S FIL=665.72,SITE=RMPOXITE,BILDT=RMPODATE,VDR=RMPOVDR
"RTN","RMPOPST3",23,0)
 S DFN=0
"RTN","RMPOPST3",24,0)
 F I=1:1 S DFN=$O(^RMPO(FIL,SITE,1,BILDT,1,VDR,"V",DFN)) Q:'DFN  D
"RTN","RMPOPST3",25,0)
 . ;check if patient transaction posted
"RTN","RMPOPST3",26,0)
 . I $P(^RMPO(FIL,SITE,1,BILDT,1,VDR,"V",DFN,0),U,3)="Y" Q
"RTN","RMPOPST3",27,0)
 . ;check if patient transaction accepted
"RTN","RMPOPST3",28,0)
 . I $P(^RMPO(FIL,SITE,1,BILDT,1,VDR,"V",DFN,0),U,2)'="Y" Q
"RTN","RMPOPST3",29,0)
 . I I=10 D
"RTN","RMPOPST3",30,0)
 . . W !!,"Verifying all accepted transactions posted. Please be patient"
"RTN","RMPOPST3",31,0)
 . S DFNS(DFN)=""
"RTN","RMPOPST3",32,0)
 Q  ;FNDACC
"RTN","RMPOPST3",33,0)
 ;
"RTN","RMPOPST3",34,0)
PSTACC ;Post accepted transactions if so indicated by user
"RTN","RMPOPST3",35,0)
 N MES K DIR
"RTN","RMPOPST3",36,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","RMPOPST3",37,0)
 S MES="There are patients whose billing transactions have been accepted"
"RTN","RMPOPST3",38,0)
 S DIR("A",1)=MES,DIR("A",2)=" and not yet posted"
"RTN","RMPOPST3",39,0)
 S DIR("A")="Would you like to post them now"
"RTN","RMPOPST3",40,0)
 S DIR("?")="YES will Post accepted transaction and NO will not post"
"RTN","RMPOPST3",41,0)
 D ^DIR
"RTN","RMPOPST3",42,0)
 I 'Y!($D(DIRUT))!($D(DIROUT)) Q
"RTN","RMPOPST3",43,0)
 ;Call post module to post transactions
"RTN","RMPOPST3",44,0)
 D POST^RMPOPST0
"RTN","RMPOPST3",45,0)
 K DIR,DIRUT,DIROUT,Y
"RTN","RMPOPST3",46,0)
 Q  ;PSTACC
"RTN","RMPOPST3",47,0)
F660 ;Post to file ^RMPR(660 for form 2319
"RTN","RMPOPST3",48,0)
 N ITM,ITMD,D665A,SUSDES,TRXDT,D660,D6I,D6X,RMPOG,ERR
"RTN","RMPOPST3",49,0)
 S D665A=$G(^RMPR(665,DFN,"RMPOA")) I D665A="" Q
"RTN","RMPOPST3",50,0)
 D  ;AMIS grouper number
"RTN","RMPOPST3",51,0)
 . L +^RMPR(669.9,RMPOXITE,0):9999 I $T=0 S RMPOG=DT_$P(DT,2,3) Q
"RTN","RMPOPST3",52,0)
 . S RMPOG=$P(^RMPR(669.9,RMPOXITE,0),U,7),RMPOG=RMPOG-1
"RTN","RMPOPST3",53,0)
 . S $P(^RMPR(669.9,RMPOXITE,0),U,7)=RMPOG
"RTN","RMPOPST3",54,0)
 . L -^RMPR(669.9,RMPOXITE,0)
"RTN","RMPOPST3",55,0)
 S TRXDT=$P(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RMPOVDR,0),U,2)
"RTN","RMPOPST3",56,0)
 S ITM="" F  S ITM=$O(^TMP($J,FCP,DFN,ITM)) Q:ITM=""  D
"RTN","RMPOPST3",57,0)
 . S ITMD=$G(^RMPO(665.72,RMPOXITE,1,RMPODATE,1,RMPOVDR,"V",DFN,1,ITM,0))
"RTN","RMPOPST3",58,0)
 . I ITMD="" Q
"RTN","RMPOPST3",59,0)
 .; I $P(ITMD,U,6)'>0 Q       ;nothing posted to IFCAP
"RTN","RMPOPST3",60,0)
 . S RMCPHC=$P(ITMD,U,2),RMCPT="",RMCPRENT=$P(ITMD,U,18),RMCPSO="C"
"RTN","RMPOPST3",61,0)
 . S RMCPTY=$P(ITMD,U,14),RMCPQH=$P(ITMD,U,19)
"RTN","RMPOPST3",62,0)
 . S RMCPT1=$G(^RMPR(661.1,RMCPHC,4))
"RTN","RMPOPST3",63,0)
 . I RMCPT1["RP",((RMCPTY="R")!(RMCPTY="X")) S RMCPT=RMCPT_"RP,"
"RTN","RMPOPST3",64,0)
 . I RMCPT1["QH",($G(RMCPQH)) S RMCPT=RMCPT_"QH,"
"RTN","RMPOPST3",65,0)
 . I (RMCPRENT=1),(RMCPT1["RR") S RMCPT=RMCPT_"RR,"
"RTN","RMPOPST3",66,0)
 . I RMCPT1["NU",(RMCPT'["RR") S RMCPT=RMCPT_"NU,"
"RTN","RMPOPST3",67,0)
 . I $L(RMCPT)>2 S RMCLEN=$L(RMCPT),RMCPT=$E(RMCPT,1,RMCLEN-1)
"RTN","RMPOPST3",68,0)
 . S DIC="^RMPR(660,",DIC(0)="L",X=DT
"RTN","RMPOPST3",69,0)
 . K DD,DO D FILE^DICN I +Y<0 Q
"RTN","RMPOPST3",70,0)
 . S D6I=+Y,D6X=D6I_","
"RTN","RMPOPST3",71,0)
 . K DIE,DA,DR S DA(4)=RMPOXITE,DA(3)=RMPODATE,DA(2)=RMPOVDR,DA(1)=DFN
"RTN","RMPOPST3",72,0)
 . S DIE="^RMPO(665.72,"_DA(4)_",1,"_DA(3)_",1,"_DA(2)_",""V"","_DA(1)
"RTN","RMPOPST3",73,0)
 . S DIE=DIE_",1,",DA=ITM,DR="15////^S X=D6I" D ^DIE
"RTN","RMPOPST3",74,0)
 . S D660(660,D6X,.02)=DFN                 ;Patient name pointer
"RTN","RMPOPST3",75,0)
 . S D660(660,D6X,1)=TRXDT                 ;Request date
"RTN","RMPOPST3",76,0)
 . S D660(660,D6X,2)=$P(ITMD,U,14)         ;Type of transaction
"RTN","RMPOPST3",77,0)
 . S D660(660,D6X,4)=$P(ITMD,U)            ;item
"RTN","RMPOPST3",78,0)
 . S D660(660,D6X,4.1)=$P(^RMPR(661.1,$P(ITMD,U,2),0),U,4) ;HCPCS
"RTN","RMPOPST3",79,0)
 . S D660(660,D6X,4.5)=$P(ITMD,U,2)        ;PSAS HCPCS
"RTN","RMPOPST3",80,0)
 . S D660(660,D6X,4.7)=RMCPT               ;CPT MODIFIER
"RTN","RMPOPST3",81,0)
 . S D660(660,D6X,5)=$P(ITMD,U,7)-$P(ITMD,U,17)          ;quantity
"RTN","RMPOPST3",82,0)
 . S D660(660,D6X,7)=RMPOVDR               ;vendor
"RTN","RMPOPST3",83,0)
 . S D660(660,D6X,8)=RMPO("STA")           ;station
"RTN","RMPOPST3",84,0)
 . S D660(660,D6X,10)=CURDT                ;Delivery date
"RTN","RMPOPST3",85,0)
 . D
"RTN","RMPOPST3",86,0)
 . . I $P(PAYINF,U) D  Q
"RTN","RMPOPST3",87,0)
 . . . S D660(660,D6X,11)=9                ;form requested on(1358)
"RTN","RMPOPST3",88,0)
 . . . ;IFCAP transaction number - from file 424
"RTN","RMPOPST3",89,0)
 . . . I $G(IEN424)'="" S D660(660,D6X,23)=$P($G(^PRC(424,IEN424,0)),U)
"RTN","RMPOPST3",90,0)
 . . S D660(660,D6X,11)=14                 ;form requested on (visa)
"RTN","RMPOPST3",91,0)
 . . S D660(660,D6X,23)=SRVORD             ;IFCAP transaction number
"RTN","RMPOPST3",92,0)
 . S D660(660,D6X,12)="C"                  ;Source
"RTN","RMPOPST3",93,0)
 . S D660(660,D6X,14)=$P(ITMD,U,6)         ;total cost
"RTN","RMPOPST3",94,0)
 . S D660(660,D6X,16)=$P(ITMD,U,4)         ;remarks
"RTN","RMPOPST3",95,0)
 . S SUSDES=$S($P(ITMD,U,11)'="":"Suspended Amt "_$P(ITMD,U,11)_" ",1:"")
"RTN","RMPOPST3",96,0)
 . S D660(660,D6X,24)=SUSDES_$P(ITMD,U,12) ;description
"RTN","RMPOPST3",97,0)
 . S D660(660,D6X,27)=DUZ                  ;initiator
"RTN","RMPOPST3",98,0)
 . S D660(660,D6X,62)=$P(D665A,U)          ;patient category
"RTN","RMPOPST3",99,0)
 . S D660(660,D6X,63)=$P(D665A,U,5)        ;special category
"RTN","RMPOPST3",100,0)
 . S D660(660,D6X,68)=RMPOG
"RTN","RMPOPST3",101,0)
 . S D660(660,D6X,78)=$P(ITMD,U,15)        ;unit of issue
"RTN","RMPOPST3",102,0)
 . D FILE^DIE("K","D660","ERR")
"RTN","RMPOPST3",103,0)
 . I $D(ERR) D
"RTN","RMPOPST3",104,0)
 . . W !!,"Posting to 2319 for item ",ITM," patient ",DFN," failed."
"RTN","RMPOPST3",105,0)
 . . W "Posting will be done later"
"RTN","RMPOPST3",106,0)
 . . Q
"RTN","RMPOPST3",107,0)
 . ; RMPR*3*98
"RTN","RMPOPST3",108,0)
 . ; CALL TO PROCESS PFSS CHARGE MESSAGE
"RTN","RMPOPST3",109,0)
 . I '$D(ERR) D CHARGE^RMPOPF
"RTN","RMPOPST3",110,0)
 . Q
"RTN","RMPOPST3",111,0)
 K DIC,X,Y
"RTN","RMPOPST3",112,0)
 Q
"RTN","RMPR110P")
0^5^B43952553
"RTN","RMPR110P",1,0)
RMPR110P ;VMP/RB - LOCATE/FIX/REPORT POINTER PROBLEMS 665.72 TO 660 ;05/02/06
"RTN","RMPR110P",2,0)
 ;;3.0;Prosthetics;**110**;06/20/05;Build 10
"RTN","RMPR110P",3,0)
 ;;
"RTN","RMPR110P",4,0)
 ;1. Post install to locate/fix/report pointer error issues between
"RTN","RMPR110P",5,0)
 ;   file 665.72 and 660 caused by inept fileman stuff during
"RTN","RMPR110P",6,0)
 ;   O2 Post Billing.
"RTN","RMPR110P",7,0)
 S (SITE,RECTOT,ERRTOT)=0 K ^TMP($J,"RMPR110P"),^TMP("RMPRFIX",$J)
"RTN","RMPR110P",8,0)
A1 S SITE=$O(^RMPO(665.72,SITE)),MON=0 G B10:SITE=""!(SITE]"@")
"RTN","RMPR110P",9,0)
A1A S MON=$O(^RMPO(665.72,SITE,1,MON)),VEND=0 G A1:MON=""
"RTN","RMPR110P",10,0)
A2 S VEND=$O(^RMPO(665.72,SITE,1,MON,1,VEND)),DFN=0 G A1A:VEND=""
"RTN","RMPR110P",11,0)
A3 K IT S IT=0 S DFN=$O(^RMPO(665.72,SITE,1,MON,1,VEND,"V",DFN)),ITEM=0 G:DFN=""!(DFN]"@") A2
"RTN","RMPR110P",12,0)
A4 S ITEM=$O(^RMPO(665.72,SITE,1,MON,1,VEND,"V",DFN,1,ITEM)) G:ITEM=""!(ITEM]"@") A3
"RTN","RMPR110P",13,0)
 S RR=^RMPO(665.72,SITE,1,MON,1,VEND,"V",DFN,1,ITEM,0),R660=$P(RR,U,16)
"RTN","RMPR110P",14,0)
 G A4:R660="" S R6=$G(^RMPR(660,R660,0)) I R6="" S ^TMP($J,"RMPR110P",6,SITE,MON,VEND,DFN,ITEM)=RR
"RTN","RMPR110P",15,0)
 I DFN'=$P(R6,U,2) D
"RTN","RMPR110P",16,0)
 . S ERRTOT=ERRTOT+1
"RTN","RMPR110P",17,0)
 . S ^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,1,ITEM,R660,0)=ITEM_U_IT_U_$P(R6,U,11)
"RTN","RMPR110P",18,0)
 . S ^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,1,ITEM,R660,1)=^RMPO(665.72,SITE,1,MON,1,VEND,"V",DFN,1,ITEM,0)
"RTN","RMPR110P",19,0)
 I IT=0,DFN=$P(R6,U,2) S IT=R660
"RTN","RMPR110P",20,0)
 G A4
"RTN","RMPR110P",21,0)
B10 ;GRAB ALL ERROR 665.72 POINTER RELATIONS AND DETERMINE CORRECT POINTER
"RTN","RMPR110P",22,0)
 S SITE=0,U="^",CHK=$P(^RMPR(660,0),U,3)
"RTN","RMPR110P",23,0)
B11 S SITE=$O(^TMP($J,"RMPR110P",1,SITE)),MON=0,VEND=0 G PRINT:SITE=""
"RTN","RMPR110P",24,0)
B11B S MON=$O(^TMP($J,"RMPR110P",1,SITE,MON)),VEND=0 G B11:MON=""
"RTN","RMPR110P",25,0)
B12 S VEND=$O(^TMP($J,"RMPR110P",1,SITE,MON,VEND)),DFN=0 G B11B:VEND=""
"RTN","RMPR110P",26,0)
B13 S DFN=$O(^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN)),ITEM=0 K ER  S RSH="" G B12:DFN="" S ^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,3)=""
"RTN","RMPR110P",27,0)
B14 S ITEM=$O(^RMPO(665.72,SITE,1,MON,1,VEND,"V",DFN,1,ITEM)) G C15:ITEM=""!(ITEM]"@")
"RTN","RMPR110P",28,0)
 S R=^RMPO(665.72,SITE,1,MON,1,VEND,"V",DFN,1,ITEM,0),R660=$P(R,U,16)
"RTN","RMPR110P",29,0)
 G:R660="" B14
"RTN","RMPR110P",30,0)
 S ^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,2,ITEM,R660)=$G(^RMPR(660,R660,0)),ER(R660)=ITEM
"RTN","RMPR110P",31,0)
 G B14
"RTN","RMPR110P",32,0)
C15 S BADITEM=0,XITEM=0
"RTN","RMPR110P",33,0)
C16 S XITEM=$O(^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,1,XITEM)),BAD660=0 G:XITEM="" B13
"RTN","RMPR110P",34,0)
C17 S BAD660=$O(^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,1,XITEM,BAD660))
"RTN","RMPR110P",35,0)
 S B0=^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,1,XITEM,BAD660,0),B1=^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,1,XITEM,BAD660,1)
"RTN","RMPR110P",36,0)
 S RSH=$P(B0,U,2),LK1=RSH-5000,LK2=RSH+5000 S:LK1<0 LK1=0
"RTN","RMPR110P",37,0)
 S FIND660=+$P(B0,U,3) I FIND660 D  G:FIND660 C19
"RTN","RMPR110P",38,0)
 . S REC660=$G(^RMPR(660,FIND660,0))
"RTN","RMPR110P",39,0)
 . I DFN'=$P(REC660,U,2) S FIND660=0
"RTN","RMPR110P",40,0)
C18 S FIND660=0 F I=LK1:1:LK2 S REC660=$G(^RMPR(660,I,0)) D:REC660'=""  Q:FIND660
"RTN","RMPR110P",41,0)
 . Q:$P(REC660,U,2)'=DFN
"RTN","RMPR110P",42,0)
 . Q:$P(REC660,U,9)'=VEND
"RTN","RMPR110P",43,0)
 . Q:$P(REC660,U,6)'=$P(B1,U)
"RTN","RMPR110P",44,0)
 . Q:$P(REC660,U,7)'=$P(B1,U,7)
"RTN","RMPR110P",45,0)
 . Q:$FN($P(REC660,U,16),"p",2)'=$FN($P(B1,U,6),"p",2)
"RTN","RMPR110P",46,0)
 . Q:$P(REC660,U,8)'=$P(B1,U,15)
"RTN","RMPR110P",47,0)
 . S FIND660=I
"RTN","RMPR110P",48,0)
 I FIND660=0,RSH=0 G C30
"RTN","RMPR110P",49,0)
C19 I FIND660 D
"RTN","RMPR110P",50,0)
 . S ^TMP($J,"RMPR110P",2,SITE,MON,VEND,DFN,1,XITEM,BAD660)=B0_"^"_FIND660_"^"_REC660
"RTN","RMPR110P",51,0)
 . I DFN'=$P(REC660,U,2) S ^TMP($J,"RMPR110P",4,SITE,MON,VEND,DFN,1,XITEM,BAD660)=B0_"^"_FIND660_"^"_REC660 Q  ;FIND 660 DOES NOT MATCH DFN VALUE FOUND
"RTN","RMPR110P",52,0)
 . I FIND660'=$P(B0,U,3) S ^TMP($J,"RMPR110P",3,SITE,MON,VEND,DFN,1,XITEM,BAD660)=B0_"^"_FIND660  ;FIND 660 DOES NOT MATCH RECORDED VALUE FOUND
"RTN","RMPR110P",53,0)
 . S ^TMP($J,"RMPR110P",1,SITE,MON,VEND,DFN,3,XITEM,FIND660,0)=^RMPR(660,FIND660,0)
"RTN","RMPR110P",54,0)
 . ;SET CORRECT 660 POINTER INTO 665.72 HERE
"RTN","RMPR110P",55,0)
 . K DIE,DA,DR S DA(4)=SITE,DA(3)=MON,DA(2)=VEND,DA(1)=DFN
"RTN","RMPR110P",56,0)
 . S DIE="^RMPO(665.72,"_DA(4)_",1,"_DA(3)_",1,"_DA(2)_",""V"","_DA(1)
"RTN","RMPR110P",57,0)
 . S DIE=DIE_",1,",DA=XITEM,DR="15////^S X=FIND660" D ^DIE
"RTN","RMPR110P",58,0)
 I 'FIND660 S ^TMP($J,"RMPR110P",5,SITE,MON,VEND,DFN,1,XITEM,BAD660)=B0   ;CANNOT LOGICALLY LOCATE CORRECT POINTER........
"RTN","RMPR110P",59,0)
 G C16
"RTN","RMPR110P",60,0)
C30 S FIND660=+$P(B0,U,3),REC660="",F660=0 S:FIND660 REC660=$G(^RMPR(660,FIND660,0)) G:FIND660?.N&(DFN=$P(REC660,U,2)) C19 S XX=DFN,YY=0,X660="",FIND660=0
"RTN","RMPR110P",61,0)
C31 S XX=$O(^RMPO(665.72,SITE,1,MON,1,VEND,"V",DFN),-1),YY=0 Q:XX=""
"RTN","RMPR110P",62,0)
C32 I $D(^TMP($J,"RMPR110P",1,SITE,MON,VEND,XX)) S XX=$O(^RMPO(665.72,SITE,1,MON,1,VEND,"V",XX),-1) Q:XX=""  G C32
"RTN","RMPR110P",63,0)
 F  S YY=$O(^RMPO(665.72,SITE,1,MON,1,VEND,"V",XX,1,YY)) Q:YY=""!(YY]"@")  S X660=$P(^RMPO(665.72,SITE,1,MON,1,VEND,"V",XX,1,YY,0),U,16)
"RTN","RMPR110P",64,0)
 S REC660=""
"RTN","RMPR110P",65,0)
 I X660 F I=1:1:5 I $D(^RMPR(660,X660+I)) S FIND660=X660+I,REC660=^RMPR(660,FIND660,0) Q:DFN=$P(REC660,U,2)
"RTN","RMPR110P",66,0)
 I $P(REC660,U,2)'=DFN D  G:'FIND660 C18
"RTN","RMPR110P",67,0)
 . I +$P(B0,U,3)>5000 S F660=$P(B0,U,3)\1
"RTN","RMPR110P",68,0)
 . I X660,'F660 S F660=X660
"RTN","RMPR110P",69,0)
 . S LK1=F660-5000,LK2=F660+5000,FIND660=0,RSH=1 S:LK1<0 LK1=0
"RTN","RMPR110P",70,0)
 G C19
"RTN","RMPR110P",71,0)
PRINT ;
"RTN","RMPR110P",72,0)
 D NOW^%DTC S Y=% X ^DD("DD") S RMRDATE=Y
"RTN","RMPR110P",73,0)
PRINT2 ; Update the ^TMP("RMPRFIX" MAIL REPORT
"RTN","RMPR110P",74,0)
 ;
"RTN","RMPR110P",75,0)
 S SP="",$P(SP," ",85)=" "
"RTN","RMPR110P",76,0)
 S ^TMP("RMPRFIX",$J,1)="File 665.72/660 Pointer Errors"_$E(SP,1,16)_"Run Date: "_RMRDATE_$E(SP,1,10)
"RTN","RMPR110P",77,0)
 S ^TMP("RMPRFIX",$J,2)=$E(SP,1,3)_". . . 660 pointer error internal info . . ."
"RTN","RMPR110P",78,0)
 S ^TMP("RMPRFIX",$J,3)="site    month    vendor      DFN      item   660 pntr"_$E(SP,1,8)_"660 ptr correction"
"RTN","RMPR110P",79,0)
 S ^TMP("RMPRFIX",$J,4)=""
"RTN","RMPR110P",80,0)
 S CNT110=4
"RTN","RMPR110P",81,0)
 N RMEND,PG S RTYP=2
"RTN","RMPR110P",82,0)
 S (SITE,PG)=0,U="^",IOSL=66 S:$E(IOST,1,2)="C-" IOSL=22
"RTN","RMPR110P",83,0)
P1 S SITE=$O(^TMP($J,"RMPR110P",RTYP,SITE)),MON=0 G PRINT3:SITE=""
"RTN","RMPR110P",84,0)
P1A S MON=$O(^TMP($J,"RMPR110P",RTYP,SITE,MON)),VEND=0 G P1:MON=""
"RTN","RMPR110P",85,0)
P2 S VEND=$O(^TMP($J,"RMPR110P",RTYP,SITE,MON,VEND)),DFN=0 G P1A:VEND=""
"RTN","RMPR110P",86,0)
P3 S DFN=$O(^TMP($J,"RMPR110P",RTYP,SITE,MON,VEND,DFN)),ITEM=0 G:DFN="" P2
"RTN","RMPR110P",87,0)
P5 S BADITEM=0,XITEM=0
"RTN","RMPR110P",88,0)
P6 S XITEM=$O(^TMP($J,"RMPR110P",RTYP,SITE,MON,VEND,DFN,1,XITEM)),BAD660=0 G:XITEM="" P3
"RTN","RMPR110P",89,0)
 S BAD660=$O(^TMP($J,"RMPR110P",RTYP,SITE,MON,VEND,DFN,1,XITEM,BAD660))
"RTN","RMPR110P",90,0)
 S B0=^TMP($J,"RMPR110P",RTYP,SITE,MON,VEND,DFN,1,XITEM,BAD660)
"RTN","RMPR110P",91,0)
 S CNT110=CNT110+1,^TMP("RMPRFIX",$J,CNT110)=$J(SITE,3)_$J(MON,11)_$J(VEND,9)_$J(DFN,11)_$J(XITEM,7)_$J(BAD660,10)_$J($P(B0,U,4),18)
"RTN","RMPR110P",92,0)
 G P6
"RTN","RMPR110P",93,0)
PRINT3 I RTYP=2 D
"RTN","RMPR110P",94,0)
 . S CNT110=CNT110+1,^TMP("RMPRFIX",$J,CNT110)=""
"RTN","RMPR110P",95,0)
 . S CNT110=CNT110+1,^TMP("RMPRFIX",$J,CNT110)="==>>>  TOTAL POINTERS CORRECTED: "_ERRTOT
"RTN","RMPR110P",96,0)
 I RTYP=2 S RTYP=4,(SITE,PG)=0 D  G P1
"RTN","RMPR110P",97,0)
 . F I=1:1:4 S CNT110=CNT110+1,^TMP("RMPRFIX",$J,CNT110)=""
"RTN","RMPR110P",98,0)
 . S CNT110=CNT110+1,^TMP("RMPRFIX",$J,CNT110)="==>>>  NEW 660 RECORD DOES NOT MATCH DFN OF 665.72, NOT CORRECTED"
"RTN","RMPR110P",99,0)
 I RTYP=4 S RTYP=5,(SITE,PG)=0 D  G P1
"RTN","RMPR110P",100,0)
 . F I=1:1:4 S CNT110=CNT110+1,^TMP("RMPRFIX",$J,CNT110)=""
"RTN","RMPR110P",101,0)
 . S CNT110=CNT110+1,^TMP("RMPRFIX",$J,CNT110)="==>>>  LOGICAL POINTER COULD NOT BE FOUND FOR 665.72 ENTRY, NOT CORRECTED"
"RTN","RMPR110P",102,0)
 D MAIL
"RTN","RMPR110P",103,0)
EXIT K SITE,RECTOT,ERRTOT,MON,VEND,IT,DFN,ITEM,RR,R660,R6,DTOUT,ANS,CHK,BADITEM,XITEM,B0,B1,RSH,LK1,LK2,FIND660
"RTN","RMPR110P",104,0)
 K REC660,XX,YY,X660,RMRDATE,PG,RTYP,RMEND,DIE,DA,DR,DIR,%,BAD660,F660,R,SP,Y
"RTN","RMPR110P",105,0)
 K ^TMP($J),^TMP("RMPRTXT",$J),^TMP("RMPRFIX",$J)
"RTN","RMPR110P",106,0)
 Q
"RTN","RMPR110P",107,0)
MAIL ;Send results of cleanup in a mail message to initiator
"RTN","RMPR110P",108,0)
 N I,XMSUB,XMTEXT,XMDUZ,XMY,DIFROM,CNT110
"RTN","RMPR110P",109,0)
 S XMSUB="Patch RMPR*3.0*110 Clean up completed"
"RTN","RMPR110P",110,0)
 S XMDUZ="Patch RMPR*3.0*110 Clean up job"
"RTN","RMPR110P",111,0)
 S XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","RMPR110P",112,0)
 S XMTEXT="^TMP(""RMPRTXT"",$J,"
"RTN","RMPR110P",113,0)
 K ^TMP("RMPRTXT",$J)
"RTN","RMPR110P",114,0)
 ; set up header and count
"RTN","RMPR110P",115,0)
 S I=1
"RTN","RMPR110P",116,0)
 S ^TMP("RMPRTXT",$J,I)="The correction of invalid pointers between files 665.72 & 660 has completed.",I=I+1
"RTN","RMPR110P",117,0)
 S ^TMP("RMPRTXT",$J,I)="Below is a listing of pointers found and the correct pointer located",I=I+1
"RTN","RMPR110P",118,0)
 S ^TMP("RMPRTXT",$J,I)="",I=I+1
"RTN","RMPR110P",119,0)
 S ^TMP("RMPRTXT",$J,I)="",I=I+1
"RTN","RMPR110P",120,0)
 I ERRTOT=0 S ^TMP("RMPRTXT",$J,I)="No pointer errors found for files 660/665.72.",I=I+1
"RTN","RMPR110P",121,0)
 S ^TMP("RMPRTXT",$J,I)="",I=I+1
"RTN","RMPR110P",122,0)
 ; set up message text
"RTN","RMPR110P",123,0)
 S CNT110=0 F  S CNT110=$O(^TMP("RMPRFIX",$J,CNT110)) Q:CNT110=""  D
"RTN","RMPR110P",124,0)
 .S ^TMP("RMPRTXT",$J,I)=^TMP("RMPRFIX",$J,CNT110),I=I+1
"RTN","RMPR110P",125,0)
 D ^XMD ;send results
"RTN","RMPR110P",126,0)
 Q
"VER")
8.0^22.0
"BLD",6155,6)
^101
**END**
**END**
