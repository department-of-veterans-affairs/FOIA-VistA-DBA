Released XU*8*267 SEQ #231
Extracted from mail message
**KIDS**:XU*8.0*267^

**INSTALL NAME**
XU*8.0*267
"BLD",629,0)
XU*8.0*267^KERNEL^0^3030102^y
"BLD",629,1,0)
^^2^2^3021105^^
"BLD",629,1,1,0)
Please refer to the Description in FORUM Patch Module for details.
"BLD",629,1,2,0)
XU*8*267  DEA API and INST DEA #
"BLD",629,4,0)
^9.64PA^200^2
"BLD",629,4,4,0)
4
"BLD",629,4,4,2,0)
^9.641^4^1
"BLD",629,4,4,2,4,0)
INSTITUTION  (File-top level)
"BLD",629,4,4,2,4,1,0)
^9.6411^52^1
"BLD",629,4,4,2,4,1,52,0)
FACILITY DEA NUMBER
"BLD",629,4,4,222)
y^y^p^^^^n^^n
"BLD",629,4,4,224)

"BLD",629,4,200,0)
200
"BLD",629,4,200,2,0)
^9.641^200^1
"BLD",629,4,200,2,200,0)
NEW PERSON  (File-top level)
"BLD",629,4,200,2,200,1,0)
^9.6411^53.2^1
"BLD",629,4,200,2,200,1,53.2,0)
DEA#
"BLD",629,4,200,222)
y^y^p^^^^n^^n
"BLD",629,4,200,224)

"BLD",629,4,"APDD",4,4)

"BLD",629,4,"APDD",4,4,52)

"BLD",629,4,"APDD",200,200)

"BLD",629,4,"APDD",200,200,53.2)

"BLD",629,4,"B",4,4)

"BLD",629,4,"B",200,200)

"BLD",629,"KRN",0)
^9.67PA^8989.52^19
"BLD",629,"KRN",.4,0)
.4
"BLD",629,"KRN",.401,0)
.401
"BLD",629,"KRN",.402,0)
.402
"BLD",629,"KRN",.403,0)
.403
"BLD",629,"KRN",.5,0)
.5
"BLD",629,"KRN",.84,0)
.84
"BLD",629,"KRN",3.6,0)
3.6
"BLD",629,"KRN",3.8,0)
3.8
"BLD",629,"KRN",9.2,0)
9.2
"BLD",629,"KRN",9.8,0)
9.8
"BLD",629,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",629,"KRN",9.8,"NM",1,0)
XUSER^^0^B5062580
"BLD",629,"KRN",9.8,"NM",2,0)
XUSER2^^0^B1702237
"BLD",629,"KRN",9.8,"NM","B","XUSER",1)

"BLD",629,"KRN",9.8,"NM","B","XUSER2",2)

"BLD",629,"KRN",19,0)
19
"BLD",629,"KRN",19.1,0)
19.1
"BLD",629,"KRN",101,0)
101
"BLD",629,"KRN",409.61,0)
409.61
"BLD",629,"KRN",771,0)
771
"BLD",629,"KRN",870,0)
870
"BLD",629,"KRN",8989.51,0)
8989.51
"BLD",629,"KRN",8989.52,0)
8989.52
"BLD",629,"KRN",8994,0)
8994
"BLD",629,"KRN","B",.4,.4)

"BLD",629,"KRN","B",.401,.401)

"BLD",629,"KRN","B",.402,.402)

"BLD",629,"KRN","B",.403,.403)

"BLD",629,"KRN","B",.5,.5)

"BLD",629,"KRN","B",.84,.84)

"BLD",629,"KRN","B",3.6,3.6)

"BLD",629,"KRN","B",3.8,3.8)

"BLD",629,"KRN","B",9.2,9.2)

"BLD",629,"KRN","B",9.8,9.8)

"BLD",629,"KRN","B",19,19)

"BLD",629,"KRN","B",19.1,19.1)

"BLD",629,"KRN","B",101,101)

"BLD",629,"KRN","B",409.61,409.61)

"BLD",629,"KRN","B",771,771)

"BLD",629,"KRN","B",870,870)

"BLD",629,"KRN","B",8989.51,8989.51)

"BLD",629,"KRN","B",8989.52,8989.52)

"BLD",629,"KRN","B",8994,8994)

"FIA",4)
INSTITUTION
"FIA",4,0)
^DIC(4,
"FIA",4,0,0)
4I
"FIA",4,0,1)
y^y^p^^^^n^^n
"FIA",4,0,10)

"FIA",4,0,11)

"FIA",4,0,"RLRO")

"FIA",4,0,"VR")
8.0^XU
"FIA",4,4)
1
"FIA",4,4,52)

"FIA",200)
NEW PERSON
"FIA",200,0)
^VA(200,
"FIA",200,0,0)
200I
"FIA",200,0,1)
y^y^p^^^^n^^n
"FIA",200,0,10)

"FIA",200,0,11)

"FIA",200,0,"RLRO")

"FIA",200,0,"VR")
8.0^XU
"FIA",200,200)
1
"FIA",200,200,53.2)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
267^3030102
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3030102
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
XU*8*267  DEA API and INST DEA #
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XUSER")
0^1^B5062580
"RTN","XUSER",1,0)
XUSER ;SFISC/RWF - A common set of user functions ;11/07/2002  17:07
"RTN","XUSER",2,0)
 ;;8.0;KERNEL;**75,97,99,150,226,267**;Jul 10, 1995
"RTN","XUSER",3,0)
 ;Covered under DBIA #2343
"RTN","XUSER",4,0)
 Q
"RTN","XUSER",5,0)
LOOKUP(XUF) ;Do a user lookup
"RTN","XUSER",6,0)
 ;Parameter, "Q" to NOT ask OK.
"RTN","XUSER",7,0)
 ;Parameter, "A" Don't select current users who have a termination
"RTN","XUSER",8,0)
 ;               date prior to today's date
"RTN","XUSER",9,0)
 N DIC,XUDA,DIR,Y
"RTN","XUSER",10,0)
LK1 S DIC="^VA(200,",DIC(0)="AEMQZ" D ^DIC S XUDA=Y G:Y'>0 LKX
"RTN","XUSER",11,0)
 S Y=$P(Y(0),"^",11) I Y>0,Y<DT W !?15,"This user was terminated on ",$$FMTE^XLFDT(Y) I $G(XUF)["A" S XUDA=-1 G LK1
"RTN","XUSER",12,0)
 G:$G(XUF)["Q" LKX
"RTN","XUSER",13,0)
 S DIR(0)="Y",DIR("A")=" Is "_$P(XUDA,U,2)_" the one you want",DIR("B")="YES" D ^DIR
"RTN","XUSER",14,0)
 I Y'=1 S XUDA=-1 G:'$D(DIRUT) LK1
"RTN","XUSER",15,0)
LKX Q XUDA
"RTN","XUSER",16,0)
 ;
"RTN","XUSER",17,0)
ACTIVE(XUDA) ;Get if a user is active.
"RTN","XUSER",18,0)
 N %,X1,X2
"RTN","XUSER",19,0)
 S X1=$G(^VA(200,+$G(XUDA),0)),X2=$S(X1="":"",1:0)
"RTN","XUSER",20,0)
 I $L($P(X1,U,3)) S X2="1^"_$S($L($P($G(^VA(200,XUDA,.1)),U,2)):"ACTIVE",1:"NEW")
"RTN","XUSER",21,0)
 S:$P(X1,U,7)=1 X2="0^DISUSER"
"RTN","XUSER",22,0)
 S:X2["ACTIVE" $P(X2,U,3)=$P($G(^VA(200,XUDA,1.1)),U) ;Return last sign-on
"RTN","XUSER",23,0)
 S %=$P(X1,U,11) I %>0,%<DT S X2="0^TERMINATED^"_%
"RTN","XUSER",24,0)
 Q X2
"RTN","XUSER",25,0)
 ;
"RTN","XUSER",26,0)
PROVIDER(XUDA,XUF) ;See if user qualifies as a CPRS provider
"RTN","XUSER",27,0)
 ;At this time the only test is that the user isn't terminated
"RTN","XUSER",28,0)
 N %,X1,X2
"RTN","XUSER",29,0)
 S X1=$G(^VA(200,+$G(XUDA),0)),X2=$S(X1="":"",1:1)
"RTN","XUSER",30,0)
 S %=$P(X1,U,11) I %>0,%<DT S X2="0^TERMINATED^"_%
"RTN","XUSER",31,0)
 Q X2
"RTN","XUSER",32,0)
 ;
"RTN","XUSER",33,0)
DEA(FG) ;sr. ef. Return users DEA # or Facility DEA_"-"_user VA# or null
"RTN","XUSER",34,0)
 ;If FG is 1: DEA# or VA#
"RTN","XUSER",35,0)
 N DEA,VA,IN,N,N1
"RTN","XUSER",36,0)
 S N=$G(^VA(200,DUZ,"PS")),N1=$G(^VA(200,DUZ,"QAR"))
"RTN","XUSER",37,0)
 S DEA=$P(N,U,2),VA=$P(N,U,3)
"RTN","XUSER",38,0)
 I $L(DEA),$S('$L($P(N1,U,9)):1,1:$P(N1,U,9)>DT) Q DEA
"RTN","XUSER",39,0)
 I $G(FG) Q VA
"RTN","XUSER",40,0)
 S IN=$P($G(^DIC(4,+DUZ(2),"DEA")),U)
"RTN","XUSER",41,0)
 I $L(VA),$L(IN) Q IN_"-"_VA
"RTN","XUSER",42,0)
 Q ""
"RTN","XUSER",43,0)
 ;
"RTN","XUSER",44,0)
DIV4(XUROOT,XUDUZ) ;Return the Divisions that this user is assigned to.
"RTN","XUSER",45,0)
 ;Returns 0 - no institution for user, 1 - institution for user
"RTN","XUSER",46,0)
 ;XUROOT is passed by reference.
"RTN","XUSER",47,0)
 N %,%1 S:$G(XUDUZ)="" XUDUZ=DUZ S (%,%1)=0
"RTN","XUSER",48,0)
 F  S %=$O(^VA(200,XUDUZ,2,%)) Q:%'>0  S XUROOT(%)=$P($G(^(%,0)),U,2),%1=1
"RTN","XUSER",49,0)
 Q %1
"RTN","XUSER",50,0)
 ;
"RTN","XUSER",51,0)
NAME(IEN,FL) ;Return the full name from Name Components file
"RTN","XUSER",52,0)
 N NA S NA("FILE")=200,NA("FIELD")=.01,NA("IENS")=IEN
"RTN","XUSER",53,0)
 S FL=$G(FL,"G") ;Valid are Famly or Given
"RTN","XUSER",54,0)
 S:"FG"'[FL FL="G"
"RTN","XUSER",55,0)
 Q $$NAMEFMT^XLFNAME(.NA,FL,"CMDP")
"RTN","XUSER",56,0)
 ;
"RTN","XUSER",57,0)
HL7(IEN) ;Return a HL7 name from the components file
"RTN","XUSER",58,0)
 N NA S NA("FILE")=200,NA("FIELD")=.01,NA("IENS")=IEN
"RTN","XUSER",59,0)
 Q $$HLNAME^XLFNAME(.NA,"","~")
"RTN","XUSER2")
0^2^B1702237
"RTN","XUSER2",1,0)
XUSER2 ;ISF/RWF - New Person File Utilities ;11/25/2002  08:20
"RTN","XUSER2",2,0)
 ;;8.0;KERNEL;**267**;Jul 10, 1995
"RTN","XUSER2",3,0)
 Q
"RTN","XUSER2",4,0)
VALDEA(X,F) ;Check for a valid DEA#
"RTN","XUSER2",5,0)
 ;Returns 0 for NOT Valid, 1 for Valid
"RTN","XUSER2",6,0)
 ;F = 1 for Facility DEA check.
"RTN","XUSER2",7,0)
 I $D(X) K:$L(X)>9!($L(X)<9)!'(X?2U7N) X
"RTN","XUSER2",8,0)
 S F=$G(F)
"RTN","XUSER2",9,0)
 I $D(X),'F,$D(^VA(200,"PS1",X)),$O(^(X,0))'=DA D EN^DDIOL($C(7)_"CAN'T FILE: DUPLICATE DEA NUMBER") K X
"RTN","XUSER2",10,0)
 I $D(X),'F,$D(DA),$E(X,2)'=$E($P(^VA(200,DA,0),"^")) D EN^DDIOL($C(7)_"WARNING: DEA# FORMAT MISMATCH -- CHECK SECOND LETTER")
"RTN","XUSER2",11,0)
 I $D(X),'$$DEANUM(X) D EN^DDIOL($C(7)_"CAN'T FILE: DEA# FORMAT MISMATCH -- NUMERIC ALGORITHM FAILED") K X
"RTN","XUSER2",12,0)
 Q $D(X)
"RTN","XUSER2",13,0)
 ;
"RTN","XUSER2",14,0)
DEANUM(X) ;Check DEA # part
"RTN","XUSER2",15,0)
 N VA1,VA2
"RTN","XUSER2",16,0)
 S VA1=$E(X,3)+$E(X,5)+$E(X,7)+(2*($E(X,4)+$E(X,6)+$E(X,8)))
"RTN","XUSER2",17,0)
 S VA1=VA1#10,VA2=$E(X,9)
"RTN","XUSER2",18,0)
 Q VA1=VA2
"VER")
8.0^22.0
"^DD",4,4,52,0)
FACILITY DEA NUMBER^FX^^DEA;1^K:'$$VALDEA^XUSER2(X,1) X
"^DD",4,4,52,3)
Answer with a DEA ID, must be 9 characters in length
"^DD",4,4,52,21,0)
^^2^2^3021223^^^
"^DD",4,4,52,21,1,0)
This field holds the facility DEA number. This allows house officers who 
"^DD",4,4,52,21,2,0)
do not have their own DEA # to use a VA # for Digital Signatures.
"^DD",4,4,52,23,0)
^^22^22^3021223^
"^DD",4,4,52,23,1,0)
This value is checked by the call to $$VALDEA^XUSER2(x).
"^DD",4,4,52,23,2,0)
This is the algorithm
"^DD",4,4,52,23,3,0)
 
"^DD",4,4,52,23,4,0)
The first letter for practitioners (physicians, dentists, veterinarians,
"^DD",4,4,52,23,5,0)
pharmacies etc.) is either an "A" or "B"
"^DD",4,4,52,23,6,0)
 
"^DD",4,4,52,23,7,0)
The second letter should be the first letter of the practitioner's last
"^DD",4,4,52,23,8,0)
name.  Sometimes this does not match if the registrant changed their name 
"^DD",4,4,52,23,9,0)
or the DEA did not get it correct the first time.
"^DD",4,4,52,23,10,0)
 
"^DD",4,4,52,23,11,0)
The check digit algorithm is as follows:
"^DD",4,4,52,23,12,0)
 
"^DD",4,4,52,23,13,0)
AS1234563
"^DD",4,4,52,23,14,0)
 
"^DD",4,4,52,23,15,0)
1 + 3 + 5 =   9
"^DD",4,4,52,23,16,0)
2 + 4 + 6 = 12 x 2 = 24
"^DD",4,4,52,23,17,0)
 
"^DD",4,4,52,23,18,0)
9 + 24 = 33
"^DD",4,4,52,23,19,0)
 
"^DD",4,4,52,23,20,0)
The last digit of the total must equal the check digit (the last
"^DD",4,4,52,23,21,0)
digit of the DEA number).
"^DD",4,4,52,23,22,0)
(33#10)=$E("AS1234563",9)
"^DD",4,4,52,"DT")
3021223
"^DD",200,200,53.2,0)
DEA#^FX^^PS;2^K:'$$VALDEA^XUSER2(X) X
"^DD",200,200,53.2,1,0)
^.1^^-1
"^DD",200,200,53.2,1,1,0)
200^PS1
"^DD",200,200,53.2,1,1,1)
S ^VA(200,"PS1",$E(X,1,30),DA)=""
"^DD",200,200,53.2,1,1,2)
K ^VA(200,"PS1",$E(X,1,30),DA)
"^DD",200,200,53.2,1,1,3)
Lookup providers by their DEA number
"^DD",200,200,53.2,1,1,"%D",0)
^^1^1^2931208^^
"^DD",200,200,53.2,1,1,"%D",1,0)
This was 'APS1' before.  Also used to stop duplicate numbers.
"^DD",200,200,53.2,1,1,"DT")
2930924
"^DD",200,200,53.2,3)
Enter the DEA number 2 letters 7 numbers.
"^DD",200,200,53.2,4)
W:$X>5 ! W ?5,"Enter the DEA number as two upper case letters followed by 7 digits",!,?5,"e.g. AA1234567.  Each provider must have a unique number.",!
"^DD",200,200,53.2,20,0)
^.3LA^1^1
"^DD",200,200,53.2,20,1,0)
PS
"^DD",200,200,53.2,20,2,0)
PSO
"^DD",200,200,53.2,21,0)
^^3^3^3021223^
"^DD",200,200,53.2,21,1,0)
This field is used to enter the drug enforcement agency (DEA) number.
"^DD",200,200,53.2,21,2,0)
Enter the DEA number as two upper case letters followed by 7 digits.
"^DD",200,200,53.2,21,3,0)
e.g. AA1234567.  Each provider must have a unique number.
"^DD",200,200,53.2,23,0)
^^21^21^3021223^
"^DD",200,200,53.2,23,1,0)
This is the algorithm for DEA # checking.
"^DD",200,200,53.2,23,2,0)

"^DD",200,200,53.2,23,3,0)
The first letter for practitioners (physicians, dentists, veterinarians,
"^DD",200,200,53.2,23,4,0)
pharmacies etc.) is either an "A" or "B"
"^DD",200,200,53.2,23,5,0)
 
"^DD",200,200,53.2,23,6,0)
The second letter should be the first letter of the practitioner's last
"^DD",200,200,53.2,23,7,0)
name.  Sometimes this does not match if the registrant changed their name 
"^DD",200,200,53.2,23,8,0)
or the DEA did not get it correct the first time.
"^DD",200,200,53.2,23,9,0)
 
"^DD",200,200,53.2,23,10,0)
The check digit algorithm is as follows:
"^DD",200,200,53.2,23,11,0)
 
"^DD",200,200,53.2,23,12,0)
AS1234563
"^DD",200,200,53.2,23,13,0)
 
"^DD",200,200,53.2,23,14,0)
1 + 3 + 5 =   9
"^DD",200,200,53.2,23,15,0)
2 + 4 + 6 = 12 x 2 = 24
"^DD",200,200,53.2,23,16,0)
 
"^DD",200,200,53.2,23,17,0)
9 + 24 = 33
"^DD",200,200,53.2,23,18,0)
 
"^DD",200,200,53.2,23,19,0)
The last digit of the total must equal the check digit (the last
"^DD",200,200,53.2,23,20,0)
digit of the DEA number).
"^DD",200,200,53.2,23,21,0)
(33#10)=$E("AS1234563",9)
"^DD",200,200,53.2,"DT")
3021223
**END**
**END**
