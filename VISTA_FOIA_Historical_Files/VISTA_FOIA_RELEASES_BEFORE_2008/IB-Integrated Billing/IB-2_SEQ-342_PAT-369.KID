Released IB*2*369 SEQ #342
Extracted from mail message
**KIDS**:IB*2.0*369^

**INSTALL NAME**
IB*2.0*369
"BLD",6526,0)
IB*2.0*369^INTEGRATED BILLING^0^3070827^y
"BLD",6526,1,0)
^^1^1^3070423^
"BLD",6526,1,1,0)
IB API'S to support the SD ASCD (SCAM) project.
"BLD",6526,4,0)
^9.64PA^^
"BLD",6526,6.3)
2
"BLD",6526,"KRN",0)
^9.67PA^8989.52^19
"BLD",6526,"KRN",.4,0)
.4
"BLD",6526,"KRN",.401,0)
.401
"BLD",6526,"KRN",.402,0)
.402
"BLD",6526,"KRN",.403,0)
.403
"BLD",6526,"KRN",.5,0)
.5
"BLD",6526,"KRN",.84,0)
.84
"BLD",6526,"KRN",3.6,0)
3.6
"BLD",6526,"KRN",3.8,0)
3.8
"BLD",6526,"KRN",9.2,0)
9.2
"BLD",6526,"KRN",9.8,0)
9.8
"BLD",6526,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6526,"KRN",9.8,"NM",1,0)
IBRSUTL^^0^B26299507
"BLD",6526,"KRN",9.8,"NM","B","IBRSUTL",1)

"BLD",6526,"KRN",19,0)
19
"BLD",6526,"KRN",19.1,0)
19.1
"BLD",6526,"KRN",101,0)
101
"BLD",6526,"KRN",409.61,0)
409.61
"BLD",6526,"KRN",771,0)
771
"BLD",6526,"KRN",870,0)
870
"BLD",6526,"KRN",8989.51,0)
8989.51
"BLD",6526,"KRN",8989.52,0)
8989.52
"BLD",6526,"KRN",8994,0)
8994
"BLD",6526,"KRN","B",.4,.4)

"BLD",6526,"KRN","B",.401,.401)

"BLD",6526,"KRN","B",.402,.402)

"BLD",6526,"KRN","B",.403,.403)

"BLD",6526,"KRN","B",.5,.5)

"BLD",6526,"KRN","B",.84,.84)

"BLD",6526,"KRN","B",3.6,3.6)

"BLD",6526,"KRN","B",3.8,3.8)

"BLD",6526,"KRN","B",9.2,9.2)

"BLD",6526,"KRN","B",9.8,9.8)

"BLD",6526,"KRN","B",19,19)

"BLD",6526,"KRN","B",19.1,19.1)

"BLD",6526,"KRN","B",101,101)

"BLD",6526,"KRN","B",409.61,409.61)

"BLD",6526,"KRN","B",771,771)

"BLD",6526,"KRN","B",870,870)

"BLD",6526,"KRN","B",8989.51,8989.51)

"BLD",6526,"KRN","B",8989.52,8989.52)

"BLD",6526,"KRN","B",8994,8994)

"BLD",6526,"QUES",0)
^9.62^^
"BLD",6526,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321
"PKG",200,22,1,"PAH",1,0)
369^3070827
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3070827
"PKG",200,22,1,"PAH",1,1,1,0)
IB API'S to support the SD ASCD (SCAM) project.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","IBRSUTL")
0^1^B26299507^n/a
"RTN","IBRSUTL",1,0)
IBRSUTL ;ALB/ARH - ASCD INTERFACE UTILITIES ; 23-MAR-07
"RTN","IBRSUTL",2,0)
 ;;2.0;INTEGRATED BILLING;**369**;21-MAR-94;Build 2
"RTN","IBRSUTL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBRSUTL",4,0)
 ;
"RTN","IBRSUTL",5,0)
CT(IB0E) ; Return Claims Tracking record for Outpatient Encounter
"RTN","IBRSUTL",6,0)
 ; Input:  IB0E - IEN of Outpatient Encounter #409.68
"RTN","IBRSUTL",7,0)
 ; Output: IEN of Outpatient Encounters Claims Tracking record #356
"RTN","IBRSUTL",8,0)
 ;         or null if no CT entry found
"RTN","IBRSUTL",9,0)
 ;
"RTN","IBRSUTL",10,0)
 N IBTRN S IBTRN="" I +$G(IB0E) S IBTRN=$O(^IBT(356,"ASCE",+IB0E,0))
"RTN","IBRSUTL",11,0)
 Q IBTRN
"RTN","IBRSUTL",12,0)
 ;
"RTN","IBRSUTL",13,0)
RNBU(IB0E,CHNG) ; Update Claims Tracking record Reason Not Billable for an Outpatient Encounter
"RTN","IBRSUTL",14,0)
 ; Input:  IB0E - IEN of Outpatient Encounter #409.68
"RTN","IBRSUTL",15,0)
 ;         CHNG - 1 if Outpatient Encounter changed from NSC to SC
"RTN","IBRSUTL",16,0)
 ;                2 if Outpatient Encounter changed from SC to NSC
"RTN","IBRSUTL",17,0)
 ; Output: 1 - Reason Not Billable SC TREATMENT was added to Outpatient Encounters Claims Tracking Record
"RTN","IBRSUTL",18,0)
 ;             also adds CT Billable Finding of NSC TO SC and Last Reviewed By
"RTN","IBRSUTL",19,0)
 ;         2 - Reason Not Billable SC TREATMENT was deleted from Outpatient Encounters Claims Tracking Record
"RTN","IBRSUTL",20,0)
 ;             also adds CT Billable Finding of SC TO NSC and Last Reviewed By
"RTN","IBRSUTL",21,0)
 ;         0 - no change made
"RTN","IBRSUTL",22,0)
 ;
"RTN","IBRSUTL",23,0)
 N DA,DR,DIC,DIE,DD,DO,DLAYGO,IBTRN,IBUPD,IBRNBSC,IBCTRNB,X,Y S DLAYGO=356.03,IBUPD=0
"RTN","IBRSUTL",24,0)
 I +$G(IB0E) S IBTRN=+$$CT(IB0E) I +IBTRN S IBCTRNB=$P($G(^IBT(356,IBTRN,0)),U,19)
"RTN","IBRSUTL",25,0)
 S IBRNBSC=$O(^IBE(356.8,"B","SC TREATMENT",""))
"RTN","IBRSUTL",26,0)
 ;
"RTN","IBRSUTL",27,0)
 I +$G(CHNG)=1,+IBTRN,IBCTRNB="" D  S IBUPD=1 ; if CT has no RNB then add RNB of SC - NSC to SC
"RTN","IBRSUTL",28,0)
 . S DA=IBTRN,DIE="^IBT(356,",DR=".19////"_IBRNBSC_";2.02////"_DUZ D ^DIE K DIE,DIC,DA,DR,X,Y
"RTN","IBRSUTL",29,0)
 . S X=$O(^IBT(356.85,"B","NSC TO SC",0)) I +X S DIC(0)="L",DA(1)=IBTRN,DIC="^IBT(356,"_DA(1)_",3," D FILE^DICN
"RTN","IBRSUTL",30,0)
 ;
"RTN","IBRSUTL",31,0)
 I +$G(CHNG)=2,+IBTRN,IBCTRNB=IBRNBSC D  S IBUPD=2 ; if CT has SC RNB then delete RNB - SC to NSC
"RTN","IBRSUTL",32,0)
 . S DA=IBTRN,DIE="^IBT(356,",DR=".19////@;2.02////"_DUZ D ^DIE K DIE,DIC,DA,DR,X,Y
"RTN","IBRSUTL",33,0)
 . S X=$O(^IBT(356.85,"B","SC TO NSC",0)) I +X S DIC(0)="L",DA(1)=IBTRN,DIC="^IBT(356,"_DA(1)_",3," D FILE^DICN
"RTN","IBRSUTL",34,0)
 ;
"RTN","IBRSUTL",35,0)
 Q IBUPD
"RTN","IBRSUTL",36,0)
 ;
"RTN","IBRSUTL",37,0)
FPBILL(IB0E) ; Return First Party Bill data for Outpatient Encounter, last encounter transaction if not cancelled
"RTN","IBRSUTL",38,0)
 ; Input:  IB0E - IEN of Outpatient Encounter #409.68
"RTN","IBRSUTL",39,0)
 ; Output: First Party AR Bill Number (#350,.11) ^ AR Transaction Number (#350,.12) ^ Total Charge (#350,.07)
"RTN","IBRSUTL",40,0)
 ;         null if no active First Party Bill found for encounter
"RTN","IBRSUTL",41,0)
 ;
"RTN","IBRSUTL",42,0)
 N IB0E0,DFN,IBFROM,IBIFN,IBFP0,IBFND,IBDT,IBPAR,IBNDT,IBLAST S IBFROM="409.68:"_$G(IB0E) S IBFND=""
"RTN","IBRSUTL",43,0)
 S IB0E0=$$SCE^IBSDU(+$G(IB0E)),DFN=$P(IB0E0,U,2),IBDT=+IB0E0\1
"RTN","IBRSUTL",44,0)
 ;
"RTN","IBRSUTL",45,0)
 I +DFN S IBIFN=0 F  S IBIFN=$O(^IB("AFDT",DFN,-IBDT,IBIFN)) Q:'IBIFN  D
"RTN","IBRSUTL",46,0)
 . S IBFP0=$G(^IB(IBIFN,0)) I IBFROM'=$P(IBFP0,U,4) Q
"RTN","IBRSUTL",47,0)
 . S IBPAR=$P(IBFP0,U,9),IBNDT=$O(^IB("APDT",IBPAR,"")),IBLAST=$O(^IB("APDT",IBPAR,IBNDT,""),-1) Q:'IBLAST
"RTN","IBRSUTL",48,0)
 . S IBFP0=$G(^IB(IBLAST,0)) I $P($G(^IBE(350.1,+$P(IBFP0,U,3),0)),U,5)=2 S IBFND="" Q  ; action type cancelled
"RTN","IBRSUTL",49,0)
 . I +$P($G(^IBE(350.21,+$P(IBFP0,U,5),0)),U,5) S IBFND="" Q  ; status cancelled
"RTN","IBRSUTL",50,0)
 . S IBFND=$P(IBFP0,U,11)_U_$P(IBFP0,U,12)_U_$P(IBFP0,U,7)
"RTN","IBRSUTL",51,0)
 ;
"RTN","IBRSUTL",52,0)
 Q IBFND
"RTN","IBRSUTL",53,0)
 ;
"RTN","IBRSUTL",54,0)
TPBILL(IB0E) ; Return Third Party Bill numbers for Outpatient Encounter, only not cancelled
"RTN","IBRSUTL",55,0)
 ; Input:  IB0E - IEN of Outpatient Encounter #409.68
"RTN","IBRSUTL",56,0)
 ; Output: Third Party Bill Number (#399,.01) ^ Third Party Bill Number (#399,.01) ^ ...
"RTN","IBRSUTL",57,0)
 ;         or null if no Third Party Bill found for encounter
"RTN","IBRSUTL",58,0)
 ;
"RTN","IBRSUTL",59,0)
 N IB0E0,DFN,IBDT,IBOPV,IBIFN,IBTP0,IBCPT,IBFND S IBFND=""
"RTN","IBRSUTL",60,0)
 S IB0E0=$$SCE^IBSDU(+$G(IB0E)),DFN=$P(IB0E0,U,2),IBDT=+IB0E0\1
"RTN","IBRSUTL",61,0)
 ;
"RTN","IBRSUTL",62,0)
 I +DFN S IBOPV=IBDT-.1 F  S IBOPV=$O(^DGCR(399,"AOPV",DFN,IBOPV)) Q:'IBOPV!(IBOPV>(IBDT+.6))  D
"RTN","IBRSUTL",63,0)
 . S IBIFN=0 F  S IBIFN=$O(^DGCR(399,"AOPV",DFN,IBOPV,IBIFN)) Q:'IBIFN  D
"RTN","IBRSUTL",64,0)
 .. S IBTP0=$G(^DGCR(399,IBIFN,0)) I $P(IBTP0,U,13)=7 Q
"RTN","IBRSUTL",65,0)
 .. ;
"RTN","IBRSUTL",66,0)
 .. S IBCPT=0 F  S IBCPT=$O(^DGCR(399,IBIFN,"CP",IBCPT)) Q:'IBCPT  I +$P($G(^DGCR(399,IBIFN,"CP",IBCPT,0)),U,20)=IB0E S IBFND=IBFND_$P(IBTP0,U,1)_U Q
"RTN","IBRSUTL",67,0)
 ;
"RTN","IBRSUTL",68,0)
 Q IBFND
"RTN","IBRSUTL",69,0)
 ;
"RTN","IBRSUTL",70,0)
FIRST(IB0E) ; Return true if Outpatient Encounter is Billable for First Party
"RTN","IBRSUTL",71,0)
 ; Input:  IB0E - IEN of Outpatient Encounter #409.68
"RTN","IBRSUTL",72,0)
 ; Output: 0 ^ non-billable reason
"RTN","IBRSUTL",73,0)
 ;         1 if encounter is First Party billable
"RTN","IBRSUTL",74,0)
 ; 
"RTN","IBRSUTL",75,0)
 N IB0E0,DFN,IBDT,IBFND S IB0E=+$G(IB0E),IBFND=1
"RTN","IBRSUTL",76,0)
 S IB0E0=$$SCE^IBSDU(+$G(IB0E)),DFN=$P(IB0E0,U,2),IBDT=+IB0E0\1 I 'DFN Q 0
"RTN","IBRSUTL",77,0)
 ;
"RTN","IBRSUTL",78,0)
 I '$$BIL^DGMTUB(DFN,+IBDT) S IBFND=0_U_"Patient not MT billable"
"RTN","IBRSUTL",79,0)
 I '$$APPTCT^IBEFUNC(IB0E0) S IBFND=0_U_"Appt Status, not billable"
"RTN","IBRSUTL",80,0)
 I $$NCTCL^IBEFUNC(IB0E0) S IBFND=0_U_"Non-count Clinic, not billable"
"RTN","IBRSUTL",81,0)
 I $$IGN^IBEFUNC(+$P(IB0E0,U,10),IBDT) S IBFND=0_U_"Appt Type not MT billable"
"RTN","IBRSUTL",82,0)
 I $$NBCL^IBEFUNC(+$P(IB0E0,U,4),IBDT) S IBFND=0_U_"Clinic not MT billable"
"RTN","IBRSUTL",83,0)
 I $$NBCSC^IBEFUNC(+$P(IB0E0,U,3),IBDT) S IBFND=0_U_"Stop code not MT billable"
"RTN","IBRSUTL",84,0)
 ;
"RTN","IBRSUTL",85,0)
 Q IBFND
"RTN","IBRSUTL",86,0)
 ;
"RTN","IBRSUTL",87,0)
THIRD(IB0E) ; Return true if Outpatient Encounter is Billable for Third Party
"RTN","IBRSUTL",88,0)
 ; Input:  IB0E - IEN of Outpatient Encounter #409.68
"RTN","IBRSUTL",89,0)
 ; Output: 0 ^ non-billable reason
"RTN","IBRSUTL",90,0)
 ;         1 if encounter is Third Party billable
"RTN","IBRSUTL",91,0)
 ;
"RTN","IBRSUTL",92,0)
 N IB0E0,DFN,IBDT,IBFND S IB0E=+$G(IB0E),IBFND=1
"RTN","IBRSUTL",93,0)
 S IB0E0=$$SCE^IBSDU(+$G(IB0E)),DFN=$P(IB0E0,U,2),IBDT=+IB0E0\1 I 'DFN Q 0
"RTN","IBRSUTL",94,0)
 ;
"RTN","IBRSUTL",95,0)
 I '$$APPTCT^IBEFUNC(IB0E0) S IBFND=0_U_"Appt Status, not billable"
"RTN","IBRSUTL",96,0)
 I $$NCTCL^IBEFUNC(IB0E0) S IBFND=0_U_"Non-count Clinic, not billable"
"RTN","IBRSUTL",97,0)
 I '$$RPT^IBEFUNC(+$P(IB0E0,U,10),IBDT) S IBFND=0_U_"Appt Type not TP billable"
"RTN","IBRSUTL",98,0)
 I $$NBCT^IBEFUNC(+$P(IB0E0,U,4),IBDT) S IBFND=0_U_"Clinic not TP billable"
"RTN","IBRSUTL",99,0)
 I $$NBST^IBEFUNC(+$P(IB0E0,U,3),IBDT) S IBFND=0_U_"Stop code not TP billable"
"RTN","IBRSUTL",100,0)
 ;
"RTN","IBRSUTL",101,0)
 Q IBFND
"RTN","IBRSUTL",102,0)
 ;
"RTN","IBRSUTL",103,0)
TPCHG(IB0E) ; Return Outpatient Encounters potential Third Party charges, based on encounters procedures
"RTN","IBRSUTL",104,0)
 ; Input:  IB0E - IEN of Outpatient Encounter #409.68
"RTN","IBRSUTL",105,0)
 ; Output: Total Institutional Amount ^ Total Professional Amount
"RTN","IBRSUTL",106,0)
 ;         0 if no encounter billable procedures with charges
"RTN","IBRSUTL",107,0)
 ;
"RTN","IBRSUTL",108,0)
 N IB0E0,DFN,IBDT,IBDV,IBRT,IBCPTS,IBZERR,IBFN,IBCPT,IBINST,IBPROF,IBFND S (IBINST,IBPROF)=0,IBFND=0
"RTN","IBRSUTL",109,0)
 S IB0E0=$$SCE^IBSDU(+$G(IB0E)),DFN=$P(IB0E0,U,2),IBDT=+IB0E0\1,IBDV=$P(IB0E0,U,11) I 'DFN Q 0
"RTN","IBRSUTL",110,0)
 S IBRT=$O(^DGCR(399.3,"B","REIMBURSABLE INS.")) I 'IBRT S IBRT=8
"RTN","IBRSUTL",111,0)
 I '$$THIRD(IB0E) Q 0
"RTN","IBRSUTL",112,0)
 ;
"RTN","IBRSUTL",113,0)
 D GETCPT^SDOE(IB0E,"IBCPTS","IBZERR")
"RTN","IBRSUTL",114,0)
 S IBFN=0 F  S IBFN=$O(IBCPTS(IBFN)) Q:'IBFN  D  S IBFND=IBINST_U_IBPROF
"RTN","IBRSUTL",115,0)
 . S IBCPT=$P(IBCPTS(IBFN),U,1)
"RTN","IBRSUTL",116,0)
 . ;
"RTN","IBRSUTL",117,0)
 . S IBINST=IBINST+$$BICOST^IBCRCI(IBRT,3,IBDT,"PROCEDURE",IBCPT,,IBDV,1,1)
"RTN","IBRSUTL",118,0)
 . S IBPROF=IBPROF+$$BICOST^IBCRCI(IBRT,3,IBDT,"PROCEDURE",IBCPT,,IBDV,1,2)
"RTN","IBRSUTL",119,0)
 ;
"RTN","IBRSUTL",120,0)
 Q IBFND
"VER")
8.0^22.0
"BLD",6526,6)
^342
**END**
**END**
