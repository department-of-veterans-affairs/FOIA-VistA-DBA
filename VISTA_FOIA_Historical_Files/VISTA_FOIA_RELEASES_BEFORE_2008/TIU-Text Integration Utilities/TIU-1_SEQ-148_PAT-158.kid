Released TIU*1*158 SEQ #148
Extracted from mail message
**KIDS**:TIU*1.0*158^

**INSTALL NAME**
TIU*1.0*158
"BLD",4237,0)
TIU*1.0*158^TEXT INTEGRATION UTILITIES^0^3030626^y
"BLD",4237,1,0)
^^2^2^3030310^
"BLD",4237,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",4237,1,2,0)
under TIU*1.0*158.
"BLD",4237,4,0)
^9.64PA^^
"BLD",4237,"ABPKG")
n
"BLD",4237,"KRN",0)
^9.67PA^8989.52^19
"BLD",4237,"KRN",.4,0)
.4
"BLD",4237,"KRN",.401,0)
.401
"BLD",4237,"KRN",.402,0)
.402
"BLD",4237,"KRN",.403,0)
.403
"BLD",4237,"KRN",.5,0)
.5
"BLD",4237,"KRN",.84,0)
.84
"BLD",4237,"KRN",3.6,0)
3.6
"BLD",4237,"KRN",3.8,0)
3.8
"BLD",4237,"KRN",9.2,0)
9.2
"BLD",4237,"KRN",9.8,0)
9.8
"BLD",4237,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4237,"KRN",9.8,"NM",1,0)
TIUAL1^^0^B87325543
"BLD",4237,"KRN",9.8,"NM",2,0)
TIUALFUN^^0^B75419288
"BLD",4237,"KRN",9.8,"NM",3,0)
TIUALRT^^0^B46061417
"BLD",4237,"KRN",9.8,"NM",4,0)
TIUALSET^^0^B21267317
"BLD",4237,"KRN",9.8,"NM","B","TIUAL1",1)

"BLD",4237,"KRN",9.8,"NM","B","TIUALFUN",2)

"BLD",4237,"KRN",9.8,"NM","B","TIUALRT",3)

"BLD",4237,"KRN",9.8,"NM","B","TIUALSET",4)

"BLD",4237,"KRN",19,0)
19
"BLD",4237,"KRN",19,"NM",0)
^9.68A^3^2
"BLD",4237,"KRN",19,"NM",2,0)
TIU ALERT TOOLS^^0
"BLD",4237,"KRN",19,"NM",3,0)
TIU IRM MAINTENANCE MENU^^2
"BLD",4237,"KRN",19,"NM","B","TIU ALERT TOOLS",2)

"BLD",4237,"KRN",19,"NM","B","TIU IRM MAINTENANCE MENU",3)

"BLD",4237,"KRN",19.1,0)
19.1
"BLD",4237,"KRN",101,0)
101
"BLD",4237,"KRN",101,"NM",0)
^9.68A^17^17
"BLD",4237,"KRN",101,"NM",1,0)
TIU ALERTS 3RD PERSON ALERT^^0
"BLD",4237,"KRN",101,"NM",2,0)
TIU ALERTS BROWSE^^0
"BLD",4237,"KRN",101,"NM",3,0)
TIU ALERTS CHANGE SEARCH CRITERIA^^0
"BLD",4237,"KRN",101,"NM",4,0)
TIU ALERTS COMBO^^0
"BLD",4237,"KRN",101,"NM",5,0)
TIU ALERTS DELETE^^0
"BLD",4237,"KRN",101,"NM",6,0)
TIU ALERTS MENU^^0
"BLD",4237,"KRN",101,"NM",7,0)
TIU ALERTS RESEND ALERT^^0
"BLD",4237,"KRN",101,"NM",8,0)
TIU ALERTS SEARCH ADDITIONAL SIGNER^^0
"BLD",4237,"KRN",101,"NM",9,0)
TIU ALERTS SEARCH ATTENDING PHYSICIAN^^0
"BLD",4237,"KRN",101,"NM",10,0)
TIU ALERTS SEARCH AUTHOR^^0
"BLD",4237,"KRN",101,"NM",11,0)
TIU ALERTS SEARCH DICTATOR^^0
"BLD",4237,"KRN",101,"NM",12,0)
TIU ALERTS SEARCH EXPECTED COSIGNER^^0
"BLD",4237,"KRN",101,"NM",13,0)
TIU ALERTS SEARCH MENU^^0
"BLD",4237,"KRN",101,"NM",14,0)
TIU ALERTS SELECT^^0
"BLD",4237,"KRN",101,"NM",15,0)
TIU ALERTS ID SIGNER^^0
"BLD",4237,"KRN",101,"NM",16,0)
TIU ALERTS EDIT^^0
"BLD",4237,"KRN",101,"NM",17,0)
TIU ALERTS DETAILED DISPLAY^^0
"BLD",4237,"KRN",101,"NM","B","TIU ALERTS 3RD PERSON ALERT",1)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS BROWSE",2)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS CHANGE SEARCH CRITERIA",3)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS COMBO",4)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS DELETE",5)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS DETAILED DISPLAY",17)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS EDIT",16)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS ID SIGNER",15)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS MENU",6)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS RESEND ALERT",7)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS SEARCH ADDITIONAL SIGNER",8)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS SEARCH ATTENDING PHYSICIAN",9)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS SEARCH AUTHOR",10)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS SEARCH DICTATOR",11)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS SEARCH EXPECTED COSIGNER",12)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS SEARCH MENU",13)

"BLD",4237,"KRN",101,"NM","B","TIU ALERTS SELECT",14)

"BLD",4237,"KRN",409.61,0)
409.61
"BLD",4237,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",4237,"KRN",409.61,"NM",1,0)
TIU ALERTS^^0
"BLD",4237,"KRN",409.61,"NM","B","TIU ALERTS",1)

"BLD",4237,"KRN",771,0)
771
"BLD",4237,"KRN",870,0)
870
"BLD",4237,"KRN",8989.51,0)
8989.51
"BLD",4237,"KRN",8989.52,0)
8989.52
"BLD",4237,"KRN",8994,0)
8994
"BLD",4237,"KRN","B",.4,.4)

"BLD",4237,"KRN","B",.401,.401)

"BLD",4237,"KRN","B",.402,.402)

"BLD",4237,"KRN","B",.403,.403)

"BLD",4237,"KRN","B",.5,.5)

"BLD",4237,"KRN","B",.84,.84)

"BLD",4237,"KRN","B",3.6,3.6)

"BLD",4237,"KRN","B",3.8,3.8)

"BLD",4237,"KRN","B",9.2,9.2)

"BLD",4237,"KRN","B",9.8,9.8)

"BLD",4237,"KRN","B",19,19)

"BLD",4237,"KRN","B",19.1,19.1)

"BLD",4237,"KRN","B",101,101)

"BLD",4237,"KRN","B",409.61,409.61)

"BLD",4237,"KRN","B",771,771)

"BLD",4237,"KRN","B",870,870)

"BLD",4237,"KRN","B",8989.51,8989.51)

"BLD",4237,"KRN","B",8989.52,8989.52)

"BLD",4237,"KRN","B",8994,8994)

"BLD",4237,"QUES",0)
^9.62^^
"BLD",4237,"REQB",0)
^9.611^2^2
"BLD",4237,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",4237,"REQB",2,0)
TIU*1.0*151^2
"BLD",4237,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"BLD",4237,"REQB","B","TIU*1.0*151",2)

"KRN",19,5287,-1)
2^3
"KRN",19,5287,0)
TIU IRM MAINTENANCE MENU^TIU Maintenance Menu^^M^123456789078^^^^^^^193^y^1^1
"KRN",19,5287,10,0)
^19.01IP^10^10
"KRN",19,5287,10,10,0)
9142^5^5
"KRN",19,5287,10,10,"^")
TIU ALERT TOOLS
"KRN",19,5287,"U")
TIU MAINTENANCE MENU
"KRN",19,9142,-1)
0^2
"KRN",19,9142,0)
TIU ALERT TOOLS^TIU Alert Tools^^R^^^^^^^^
"KRN",19,9142,25)
EN^TIUAL1
"KRN",19,9142,"U")
TIU ALERT TOOLS
"KRN",101,6282,-1)
0^6
"KRN",101,6282,0)
TIU ALERTS MENU^TIU Alerts Menu^^M^^^^^^^^
"KRN",101,6282,4)
40
"KRN",101,6282,10,0)
^101.01PA^10^10
"KRN",101,6282,10,1,0)
6291^^1^
"KRN",101,6282,10,1,"^")
TIU ALERTS BROWSE
"KRN",101,6282,10,2,0)
6288^^2^
"KRN",101,6282,10,2,"^")
TIU ALERTS CHANGE SEARCH CRITERIA
"KRN",101,6282,10,3,0)
6287^^3^
"KRN",101,6282,10,3,"^")
TIU ALERTS COMBO
"KRN",101,6282,10,4,0)
6290^^4^
"KRN",101,6282,10,4,"^")
TIU ALERTS DELETE
"KRN",101,6282,10,5,0)
6312^^6^
"KRN",101,6282,10,5,"^")
TIU ALERTS EDIT
"KRN",101,6282,10,6,0)
6311^^7^
"KRN",101,6282,10,6,"^")
TIU ALERTS ID SIGNER
"KRN",101,6282,10,7,0)
6285^^8^
"KRN",101,6282,10,7,"^")
TIU ALERTS RESEND ALERT
"KRN",101,6282,10,8,0)
6284^^9^
"KRN",101,6282,10,8,"^")
TIU ALERTS 3RD PERSON ALERT
"KRN",101,6282,10,9,0)
6286^^10^
"KRN",101,6282,10,9,"^")
TIU ALERTS SELECT
"KRN",101,6282,10,10,0)
6325^^5^
"KRN",101,6282,10,10,"^")
TIU ALERTS DETAILED DISPLAY
"KRN",101,6282,15)
D LSEXIT^TIUAL1
"KRN",101,6282,26)
D SHOW^VALM
"KRN",101,6282,28)
Select Action:
"KRN",101,6282,99)
59309,36504
"KRN",101,6284,-1)
0^1
"KRN",101,6284,0)
TIU ALERTS 3RD PERSON ALERT^Third Party Alert(s)^^A^^^^^^^^
"KRN",101,6284,15)
S VALMBCK="R"
"KRN",101,6284,20)
D SELECT^TIUALFUN("THIRD")
"KRN",101,6284,99)
59309,36433
"KRN",101,6285,-1)
0^7
"KRN",101,6285,0)
TIU ALERTS RESEND ALERT^Resend Alert(s)^^A^^^^^^^^
"KRN",101,6285,15)
S VALMBCK="R"
"KRN",101,6285,20)
D SELECT^TIUALFUN("RESEND")
"KRN",101,6285,99)
59309,36433
"KRN",101,6286,-1)
0^14
"KRN",101,6286,0)
TIU ALERTS SELECT^^^A^^^^^^^^
"KRN",101,6286,15)
S VALMBCK="R"
"KRN",101,6286,20)
D SELECT^TIUALFUN("ASKUSR")
"KRN",101,6287,-1)
0^4
"KRN",101,6287,0)
TIU ALERTS COMBO^Combo Alert(s)^^A^^^^^^^^
"KRN",101,6287,15)
S VALMBCK="R"
"KRN",101,6287,20)
D SELECT^TIUALFUN("COMBO")
"KRN",101,6287,99)
59309,36433
"KRN",101,6288,-1)
0^3
"KRN",101,6288,0)
TIU ALERTS CHANGE SEARCH CRITERIA^Change View^^A^^^^^^^^
"KRN",101,6288,15)
S VALMBCK="R"
"KRN",101,6288,20)
D CHNGSRCH^TIUAL1
"KRN",101,6288,99)
59309,36433
"KRN",101,6290,-1)
0^5
"KRN",101,6290,0)
TIU ALERTS DELETE^Delete Alert(s)^^A^^^^^^^^
"KRN",101,6290,15)
S VALMBCK="R"
"KRN",101,6290,20)
D SELECT^TIUALFUN("ALRTDEL")
"KRN",101,6290,99)
59309,36433
"KRN",101,6291,-1)
0^2
"KRN",101,6291,0)
TIU ALERTS BROWSE^Browse^^A^^^^^^^^
"KRN",101,6291,15)
S VALMBCK="R"
"KRN",101,6291,20)
D BROWSE^TIUALFUN
"KRN",101,6291,99)
59309,36433
"KRN",101,6297,-1)
0^10
"KRN",101,6297,0)
TIU ALERTS SEARCH AUTHOR^Author^^A^^^^^^^^
"KRN",101,6297,99)
59309,36433
"KRN",101,6298,-1)
0^11
"KRN",101,6298,0)
TIU ALERTS SEARCH DICTATOR^Dictator^^A^^^^^^^^
"KRN",101,6298,99)
59309,36434
"KRN",101,6299,-1)
0^12
"KRN",101,6299,0)
TIU ALERTS SEARCH EXPECTED COSIGNER^Expected Cosigner^^A^^^^^^^^
"KRN",101,6299,99)
59309,36434
"KRN",101,6300,-1)
0^9
"KRN",101,6300,0)
TIU ALERTS SEARCH ATTENDING PHYSICIAN^Attending Physician^^A^^^^^^^^
"KRN",101,6300,99)
59309,36434
"KRN",101,6301,-1)
0^8
"KRN",101,6301,0)
TIU ALERTS SEARCH ADDITIONAL SIGNER^Additional Signer^^A^^^^^^^^
"KRN",101,6301,99)
59309,36434
"KRN",101,6302,-1)
0^13
"KRN",101,6302,0)
TIU ALERTS SEARCH MENU^Select SEARCH CRITERIA^^M^^^^^^^^
"KRN",101,6302,4)
26
"KRN",101,6302,10,0)
^101.01PA^5^5
"KRN",101,6302,10,1,0)
6297^1^1^
"KRN",101,6302,10,1,"^")
TIU ALERTS SEARCH AUTHOR
"KRN",101,6302,10,2,0)
6298^2^2^
"KRN",101,6302,10,2,"^")
TIU ALERTS SEARCH DICTATOR
"KRN",101,6302,10,3,0)
6299^3^3^
"KRN",101,6302,10,3,"^")
TIU ALERTS SEARCH EXPECTED COSIGNER
"KRN",101,6302,10,4,0)
6300^4^4^
"KRN",101,6302,10,4,"^")
TIU ALERTS SEARCH ATTENDING PHYSICIAN
"KRN",101,6302,10,5,0)
6301^5^5^
"KRN",101,6302,10,5,"^")
TIU ALERTS SEARCH ADDITIONAL SIGNER
"KRN",101,6302,99)
59309,36434
"KRN",101,6311,-1)
0^15
"KRN",101,6311,0)
TIU ALERTS ID SIGNER^Identify Signers^^A^^^^^^^^
"KRN",101,6311,15)
S VALMBCK="R"
"KRN",101,6311,20)
D IDSIGNER^TIUALFUN
"KRN",101,6311,99)
59309,36434
"KRN",101,6312,-1)
0^16
"KRN",101,6312,0)
TIU ALERTS EDIT^Edit^^A^^^^^^^^
"KRN",101,6312,15)
S VALMBCK="R"
"KRN",101,6312,20)
D EDIT^TIUAL1
"KRN",101,6312,99)
59309,36434
"KRN",101,6325,-1)
0^17
"KRN",101,6325,0)
TIU ALERTS DETAILED DISPLAY^Detailed Display^^A^^^^^^^^
"KRN",101,6325,15)
S VALMBCK="R"
"KRN",101,6325,20)
D DETDISP^TIUALSET
"KRN",101,6325,99)
59309,36434
"KRN",409.61,883,-1)
0^1
"KRN",409.61,883,0)
TIU ALERTS^1^^160^6^17^1^1^^TIU ALERTS MENU^TIU Alert Tools^^^1
"KRN",409.61,883,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,883,"COL",0)
^409.621^8^8
"KRN",409.61,883,"COL",1,0)
Patient^6^7^Patient
"KRN",409.61,883,"COL",2,0)
Document^28^8^Document
"KRN",409.61,883,"COL",3,0)
Ref Date^60^8^Ref Date
"KRN",409.61,883,"COL",4,0)
Status^70^10^Status
"KRN",409.61,883,"COL",5,0)
Author/Dictator^88^17^Author/Dictator
"KRN",409.61,883,"COL",6,0)
Expected Cosigner^107^17^Expected Cosigner
"KRN",409.61,883,"COL",7,0)
Attending^126^17^Attending Phy.
"KRN",409.61,883,"COL",8,0)
Additional Signer^145^15^Add'l Signer
"KRN",409.61,883,"COL","B","Additional Signer",8)

"KRN",409.61,883,"COL","B","Attending",7)

"KRN",409.61,883,"COL","B","Author/Dictator",5)

"KRN",409.61,883,"COL","B","Document",2)

"KRN",409.61,883,"COL","B","Expected Cosigner",6)

"KRN",409.61,883,"COL","B","Patient",1)

"KRN",409.61,883,"COL","B","Ref Date",3)

"KRN",409.61,883,"COL","B","Status",4)

"KRN",409.61,883,"FNL")
D EXIT^TIUAL1
"KRN",409.61,883,"HDR")
D HDR^TIUAL1
"KRN",409.61,883,"HLP")
D HELP^TIUAL1
"KRN",409.61,883,"INIT")
D INIT^TIUAL1
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
158^3030626^123456789078
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3030626
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1.0*158.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","TIUAL1")
0^1^B87325543
"RTN","TIUAL1",1,0)
TIUAL1 ;SLC/AJB - TIU Alerts List Manager ; Mar 17, 2003
"RTN","TIUAL1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**158**;Jun 20, 1997
"RTN","TIUAL1",3,0)
 ;
"RTN","TIUAL1",4,0)
 Q
"RTN","TIUAL1",5,0)
CHNGSRCH ; allows user to change search parameters
"RTN","TIUAL1",6,0)
 D FULL^VALM1
"RTN","TIUAL1",7,0)
 W @IOF
"RTN","TIUAL1",8,0)
 D SETUP^TIUALSET
"RTN","TIUAL1",9,0)
 I $D(TIU("QUIT")) K TIU("QUIT") S VALMBCK="R" Q
"RTN","TIUAL1",10,0)
 K ^TMP("TIUDA",$J),^TMP("TIUDOC",$J) D CLEAN^VALM10,INIT,HDR S VALMBG=1
"RTN","TIUAL1",11,0)
 Q
"RTN","TIUAL1",12,0)
EDIT ;
"RTN","TIUAL1",13,0)
 N D,DIV,TIUDA,TIUCHNG,TIUDCSNR,TIUDIV1,TIUESNR,TIUNODE
"RTN","TIUAL1",14,0)
 N TIUFPRIV,TIUPREF,TIUPRM0,TIUPRM1,TIURQCS,TIUS,TIUSEL,X,Y
"RTN","TIUAL1",15,0)
 D FULL^VALM1
"RTN","TIUAL1",16,0)
 I TIU("CNT")=0 W !,"No documents to select." H 3 Q
"RTN","TIUAL1",17,0)
 S TIUSEL=$P(XQORNOD(0),"=",2)
"RTN","TIUAL1",18,0)
 I TIUSEL="" D  Q:TIUSEL=U!($D(DIRUT))
"RTN","TIUAL1",19,0)
 . N DIR,X,Y
"RTN","TIUAL1",20,0)
 . S DIR("A")="Select Document: (1-"_VALMLST_") "
"RTN","TIUAL1",21,0)
 . S DIR(0)="NA^1:"_VALMLST
"RTN","TIUAL1",22,0)
 . D ^DIR S TIUSEL=Y
"RTN","TIUAL1",23,0)
 I $A($E(TIUSEL,$L(TIUSEL)))<48!($A($E(TIUSEL,$L(TIUSEL)))>57) S TIUSEL=$E(TIUSEL,1,$L(TIUSEL)-1)
"RTN","TIUAL1",24,0)
 F X=1:1  Q:$P(TIUSEL,",",X)=""  S TIUC($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUAL1",25,0)
 S TIUDA=TIUC(TIUSEL)
"RTN","TIUAL1",26,0)
 D EDIT1^TIURA
"RTN","TIUAL1",27,0)
 D UPDATE^TIUALSET
"RTN","TIUAL1",28,0)
 Q
"RTN","TIUAL1",29,0)
EN ; main entry point for TIU ALERTS
"RTN","TIUAL1",30,0)
 N %DT,D0,POP,TIU,TIUC,TIUTMP,X,Y
"RTN","TIUAL1",31,0)
 K ^TMP("TIUDA",$J),^TMP("TIUDOC",$J)
"RTN","TIUAL1",32,0)
 D SETUP^TIUALSET Q:$D(TIU("QUIT"))
"RTN","TIUAL1",33,0)
 D EN^VALM("TIU ALERTS")
"RTN","TIUAL1",34,0)
 K ^TMP("TIUDA",$J),^TMP("TIUDOC",$J)
"RTN","TIUAL1",35,0)
 Q
"RTN","TIUAL1",36,0)
EVAL(TIUDA) ;
"RTN","TIUAL1",37,0)
 N TIUCHK,TIUCNT,TIUY
"RTN","TIUAL1",38,0)
 S TIUCHK="" F  S TIUCHK=$O(TIU("S",TIUCHK)) Q:TIUCHK=""  I $P(TIUD0,U,5)=+TIU("S",TIUCHK),$P(TIUD13,U)'<TIU("D",1),$P(TIUD13,U)'>TIU("D",2) S TIUY=1
"RTN","TIUAL1",39,0)
 I $G(TIUY),$P(TIUCAT,U)="CA",$P(TIUD12,U,2)=+TIU("P") Q 1
"RTN","TIUAL1",40,0)
 I $G(TIUY),$P(TIUCAT,U)="AE",$D(^TIU(8925.7,"AE",TIUDA,TIU("P"))) Q 1
"RTN","TIUAL1",41,0)
 I $G(TIUY),$P(TIUCAT,U)="CS",$P(TIUCAT,U,2)="Expected Cosigner",$P(TIUD12,U,8)=+TIU("P") Q 1
"RTN","TIUAL1",42,0)
 I $G(TIUY),$P(TIUCAT,U)="CS",$P(TIUCAT,U,2)="Attending Physician",$P(TIUD12,U,9)=+TIU("P") Q 1
"RTN","TIUAL1",43,0)
 I $G(TIUY),$P(TIUCAT,U)="CS",$P(TIUCAT,U,3)="Attending Physician",$P(TIUD12,U,9)=+TIU("P") Q 1
"RTN","TIUAL1",44,0)
 Q +$G(TIUY)
"RTN","TIUAL1",45,0)
EXIT ; exit code
"RTN","TIUAL1",46,0)
 Q
"RTN","TIUAL1",47,0)
EXPND ; expand code
"RTN","TIUAL1",48,0)
 Q
"RTN","TIUAL1",49,0)
FMTDT(DATE) ; formats date
"RTN","TIUAL1",50,0)
 N TMPDATE
"RTN","TIUAL1",51,0)
 S TMPDATE=$$FDATE^VALM1(DATE)
"RTN","TIUAL1",52,0)
 I $P(TMPDATE,"/")="00",$P(TMPDATE,"/",2)="00" Q $$FMTE^XLFDT(DATE,"D")
"RTN","TIUAL1",53,0)
 I $P(TMPDATE,"/",2)="00" S TMPDATE=$E(TMPDATE,1,3)_$E(TMPDATE,7,8)
"RTN","TIUAL1",54,0)
 Q TMPDATE
"RTN","TIUAL1",55,0)
HDR ; header code
"RTN","TIUAL1",56,0)
 N HDRTITLE,X,Y
"RTN","TIUAL1",57,0)
 S HDRTITLE(1)=$S(TIU("S")=1:$$UPPER^VALM1($P(TIU("S",1),U,3))_" Documents",1:"Clinical Documents")
"RTN","TIUAL1",58,0)
 S HDRTITLE(2)=TIU("CNT")_" "_$S(TIU("CNT")=1:"Document",1:"Documents")
"RTN","TIUAL1",59,0)
 S HDRTITLE(3)="for ("_$E($$GET1^DIQ(200,TIU("P")_",",.01),1,35)_")"_" from "_$$FMTDT(TIU("D",1))_" to "_$$FMTDT(TIU("D",2))
"RTN","TIUAL1",60,0)
 S (X,Y)=""
"RTN","TIUAL1",61,0)
 F  S X=$O(TIU("C",X)) Q:X=""  S Y=Y_TIU("C",X)
"RTN","TIUAL1",62,0)
 S Y="by "_"("_$$UP^XLFSTR($TR($E(Y,2,67),U,","))_")"
"RTN","TIUAL1",63,0)
 S $P(HDRTITLE(1)," ",IOM-($L(HDRTITLE(1))+$L(HDRTITLE(2))))="",HDRTITLE(1)=HDRTITLE(1)_HDRTITLE(2)
"RTN","TIUAL1",64,0)
 S VALMHDR(1)=HDRTITLE(1)
"RTN","TIUAL1",65,0)
 S VALMHDR(2)=$$SETSTR^VALM1(Y,"",(IOM-$L(Y))/2,$L(Y))
"RTN","TIUAL1",66,0)
 S VALMHDR(3)=$$SETSTR^VALM1(HDRTITLE(3),"",(IOM-$L(HDRTITLE(3)))/2,$L(HDRTITLE(3)))
"RTN","TIUAL1",67,0)
 D XQORM
"RTN","TIUAL1",68,0)
 Q
"RTN","TIUAL1",69,0)
HELP ; help code
"RTN","TIUAL1",70,0)
 N DIR
"RTN","TIUAL1",71,0)
 I X="?" S DIR("A")="Enter RETURN to continue or '^' to exit",DIR(0)="E"
"RTN","TIUAL1",72,0)
 D FULL^VALM1
"RTN","TIUAL1",73,0)
 W !!,"The following actions are available:"
"RTN","TIUAL1",74,0)
 W !,"Browse a Document  - View a selected document (if authorized)"
"RTN","TIUAL1",75,0)
 W !,"Change View        - Modify search criteria"
"RTN","TIUAL1",76,0)
 W !,"Combination Alerts - Send alerts to expected signers and 3rd parties"
"RTN","TIUAL1",77,0)
 W !,"Delete Alerts      - Delete a document's alerts"
"RTN","TIUAL1",78,0)
 W !,"Detailed Display   - View detailed display of a document (if authorized)"
"RTN","TIUAL1",79,0)
 W !,"Edit a Document    - Edit a selected document (if authorized)"
"RTN","TIUAL1",80,0)
 W !,"Identify Signers   - Identify/Change Signers of a document (if authorized)"
"RTN","TIUAL1",81,0)
 W !,"Resend Alerts      - Resend alerts to expected signers"
"RTN","TIUAL1",82,0)
 W !,"Third Party Alerts - Send alerts to one or more 3rd parties",!
"RTN","TIUAL1",83,0)
 I $D(DIR("A")) D ^DIR
"RTN","TIUAL1",84,0)
 S VALMBCK="R"
"RTN","TIUAL1",85,0)
 Q
"RTN","TIUAL1",86,0)
INIT ; finds documents and prepares LM display
"RTN","TIUAL1",87,0)
 N CNT,TIUCNT,TIUDA,TIUDOC,TIUDT,TIUTMP
"RTN","TIUAL1",88,0)
 S CNT="",(TIUCNT,TIU("CNT"))=0
"RTN","TIUAL1",89,0)
 S TIU("IOCUOFF")=$C(27)_"[?25l",TIU("IOCUON")=$C(27)_"[?25h"
"RTN","TIUAL1",90,0)
 W TIU("IOCUOFF")
"RTN","TIUAL1",91,0)
 W !,"Searching for the documents."
"RTN","TIUAL1",92,0)
 F  S CNT=$O(TIU("C",CNT)) Q:CNT=""  D INIT2(CNT_TIU("C",CNT))
"RTN","TIUAL1",93,0)
 S TIUTMP=0,(CNT,TIUDA,TIUDT)=""
"RTN","TIUAL1",94,0)
 F  S TIUDT=$O(^TMP("TIUDOC",$J,TIUDT)) Q:TIUDT=""  F  S CNT=$O(^TMP("TIUDOC",$J,TIUDT,CNT)) Q:CNT=""  F  S TIUDA=$O(^TMP("TIUDOC",$J,TIUDT,CNT,TIUDA)) Q:TIUDA=""  D
"RTN","TIUAL1",95,0)
 . N TIUDISP,TIUNODE
"RTN","TIUAL1",96,0)
 . S TIUTMP=TIUTMP+1
"RTN","TIUAL1",97,0)
 . W:TIUTMP#3=0 "."
"RTN","TIUAL1",98,0)
 . S TIUDISP("PATIENT")=$P($P(^TMP("TIUDOC",$J,TIUDT,CNT,TIUDA),U,2),",")_","_$E($P($P(^TMP("TIUDOC",$J,TIUDT,CNT,TIUDA),U,2),",",2),1)
"RTN","TIUAL1",99,0)
 . S TIUDISP("L4")="("_$E(TIUDISP("PATIENT"))_$E($P($G(^DPT(+$P(^TIU(8925,TIUDA,0),U,2),0)),U,9),6,9)_")"
"RTN","TIUAL1",100,0)
 . S TIUNODE=^TMP("TIUDOC",$J,TIUDT,CNT,TIUDA)
"RTN","TIUAL1",101,0)
 . S TIUDISP("TITLE")=$E($S(+TIUNODE>0:"_ "_$P(TIUNODE,U,3),$P(TIUNODE,U)="A":"  |_"_$P(TIUNODE,U,3),1:$P(TIUNODE,U,3)),1,36)
"RTN","TIUAL1",102,0)
 . S TIUDISP("REFDT")=$$FMTDT($P(^TMP("TIUDOC",$J,TIUDT,CNT,TIUDA),U,4))
"RTN","TIUAL1",103,0)
 . S TIUDISP("S")=$P(^TMP("TIUDOC",$J,TIUDT,CNT,TIUDA),U,5)
"RTN","TIUAL1",104,0)
 . S TIUDISP("A/D")=$$GET1^DIQ(8925,TIUDA,1202)
"RTN","TIUAL1",105,0)
 . S TIUDISP("EC")=$$GET1^DIQ(8925,TIUDA,1208)
"RTN","TIUAL1",106,0)
 . S TIUDISP("ATT")=$$GET1^DIQ(8925,TIUDA,1209)
"RTN","TIUAL1",107,0)
 . S TIUDISP("ADS")=$$GET1^DIQ(8925.7,$P(TIUNODE,U,6),.03)
"RTN","TIUAL1",108,0)
 . S TIUDISP=$$SETSTR^VALM1(TIUTMP,"",1,5)
"RTN","TIUAL1",109,0)
 . S TIUDISP=$$SETSTR^VALM1(TIUDISP("PATIENT"),TIUDISP,6,26)
"RTN","TIUAL1",110,0)
 . S TIUDISP=$$SETSTR^VALM1(TIUDISP("L4"),TIUDISP,20,26)
"RTN","TIUAL1",111,0)
 . S TIUDISP=$$SETSTR^VALM1($E(TIUDISP("TITLE"),1,30),TIUDISP,28,58)
"RTN","TIUAL1",112,0)
 . S TIUDISP=$$SETSTR^VALM1(TIUDISP("REFDT"),TIUDISP,60,68)
"RTN","TIUAL1",113,0)
 . S TIUDISP=$$SETSTR^VALM1($$LOW^XLFSTR(TIUDISP("S")),TIUDISP,70,80)
"RTN","TIUAL1",114,0)
 . S TIUDISP=$$SETSTR^VALM1(TIUTMP,TIUDISP,81,86)
"RTN","TIUAL1",115,0)
 . S TIUDISP=$$SETSTR^VALM1($E(TIUDISP("A/D"),1,17),TIUDISP,88,105)
"RTN","TIUAL1",116,0)
 . S TIUDISP=$$SETSTR^VALM1($E($G(TIUDISP("EC")),1,17),TIUDISP,107,124)
"RTN","TIUAL1",117,0)
 . S TIUDISP=$$SETSTR^VALM1($E($G(TIUDISP("ATT")),1,17),TIUDISP,126,143)
"RTN","TIUAL1",118,0)
 . S TIUDISP=$$SETSTR^VALM1($E($G(TIUDISP("ADS")),1,15),TIUDISP,145,160)
"RTN","TIUAL1",119,0)
 . D SET^VALM10(TIUTMP,$E(TIUDISP,1,160),TIUDA)
"RTN","TIUAL1",120,0)
 S VALMCNT=TIUTMP
"RTN","TIUAL1",121,0)
 I VALMCNT=0 S VALMCNT=1 D
"RTN","TIUAL1",122,0)
 . D SET^VALM10(1," ",0)
"RTN","TIUAL1",123,0)
 . S TIUDOC="No records found to satisfy search criteria."
"RTN","TIUAL1",124,0)
 . S TIUDOC=$$SETSTR^VALM1(TIUDOC,"",(IOM-$L(TIUDOC))/2,$L(TIUDOC))
"RTN","TIUAL1",125,0)
 . D SET^VALM10(2,TIUDOC,0)
"RTN","TIUAL1",126,0)
 W TIU("IOCUON")
"RTN","TIUAL1",127,0)
 Q
"RTN","TIUAL1",128,0)
INIT2(TIUCAT) ;
"RTN","TIUAL1",129,0)
 S TIUDA=""
"RTN","TIUAL1",130,0)
 I $P(TIUCAT,U)'="AE" F  S TIUDA=$O(^TIU(8925,$P(TIUCAT,U),TIU("P"),TIUDA)) Q:TIUDA=""  D
"RTN","TIUAL1",131,0)
 . N TIUD0,TIUD12,TIUD13
"RTN","TIUAL1",132,0)
 . S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUAL1",133,0)
 . S TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUAL1",134,0)
 . S TIUD13=$G(^TIU(8925,TIUDA,13))
"RTN","TIUAL1",135,0)
 . I TIUD0=""!(TIUD12="")!(TIUD13="") Q
"RTN","TIUAL1",136,0)
 . I $$EVAL(TIUDA) S ^TMP("TIUDA",$J,TIUDA)="",TIU("CNT")=TIU("CNT")+1
"RTN","TIUAL1",137,0)
 I $P(TIUCAT,U)="AE" F  S TIUDA=$O(^TIU(8925.7,"AE",TIUDA)) Q:TIUDA=""  I $D(^TIU(8925.7,"AE",TIUDA,TIU("P"))) D
"RTN","TIUAL1",138,0)
 . S TIU("AS")="",TIU("AS")=$O(^TIU(8925.7,"AE",TIUDA,TIU("P"),TIU("AS")))
"RTN","TIUAL1",139,0)
 . I $P($G(^TIU(8925.7,TIU("AS"),0)),U,4),$P($G(^TIU(8925.7,TIU("AS"),0)),U,5)=TIU("P") Q
"RTN","TIUAL1",140,0)
 . N TIUD0,TIUD12,TIUD13
"RTN","TIUAL1",141,0)
 . S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUAL1",142,0)
 . S TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUAL1",143,0)
 . S TIUD13=$G(^TIU(8925,TIUDA,13))
"RTN","TIUAL1",144,0)
 . I TIUD0=""!(TIUD12="")!(TIUD13="") Q
"RTN","TIUAL1",145,0)
 . I $$EVAL(TIUDA) S ^TMP("TIUDA",$J,TIUDA)=""_U_"AE"_U_$G(TIU("AS")),TIU("CNT")=TIU("CNT")+1
"RTN","TIUAL1",146,0)
 . K TIU("AS")
"RTN","TIUAL1",147,0)
 F  S TIUDA=$O(^TMP("TIUDA",$J,TIUDA)) Q:TIUDA=""  D
"RTN","TIUAL1",148,0)
 . I +^TMP("TIUDA",$J,TIUDA)=1 Q
"RTN","TIUAL1",149,0)
 . N TIUD0,TIUD12,TIUD13
"RTN","TIUAL1",150,0)
 . S TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIUAL1",151,0)
 . S TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIUAL1",152,0)
 . S TIUD13=$G(^TIU(8925,TIUDA,13))
"RTN","TIUAL1",153,0)
 . I TIUD0=""!(TIUD12="")!(TIUD13="") Q
"RTN","TIUAL1",154,0)
 . W:TIUCNT#3=0 "."
"RTN","TIUAL1",155,0)
 . I +$$HASKIDS^TIUSRVLI(TIUDA),$P(^TMP("TIUDA",$J,TIUDA),U,2)'="AE" D  Q
"RTN","TIUAL1",156,0)
 . . N TMPCNT
"RTN","TIUAL1",157,0)
 . . S TIUCNT=TIUCNT+1,TMPCNT=TIUCNT
"RTN","TIUAL1",158,0)
 . . S ^TMP("TIUDA",$J,TIUDA)=1
"RTN","TIUAL1",159,0)
 . . N CHILD,I,SEQUENCE,TIUI
"RTN","TIUAL1",160,0)
 . . S CHILD="CHILD",(SEQUENCE,TIUI)=""
"RTN","TIUAL1",161,0)
 . . D SETKIDS^TIUSRVLI(.CHILD,TIUDA,.TIUI) I $G(TIUI)="" Q
"RTN","TIUAL1",162,0)
 . . F I=1:1:TIUI I $D(^TMP("TIUDA",$J,+CHILD(I))),'+$G(^TMP("TIUDA",$J,+CHILD(I))) D
"RTN","TIUAL1",163,0)
 . . . N TIUREFDT
"RTN","TIUAL1",164,0)
 . . . S TIUCNT=TIUCNT+1
"RTN","TIUAL1",165,0)
 . . . S ^TMP("TIUDA",$J,+CHILD(I))=1
"RTN","TIUAL1",166,0)
 . . . S TIUREFDT=+^TIU(8925,+CHILD(I),13)
"RTN","TIUAL1",167,0)
 . . . I $$GET1^DIQ(8925,+CHILD(I),.01)'["Addendum" S ^TMP("TIUDOC",$J,+TIUD13,TIUCNT,+CHILD(I))="A"_U_$$GET1^DIQ(8925,TIUDA,.02)_U_$$GET1^DIQ(8925,+CHILD(I),.01)_U_TIUREFDT_U_$$GET1^DIQ(8925,+CHILD(I),.05)
"RTN","TIUAL1",168,0)
 . . . E  S ^TMP("TIUDOC",$J,+TIUD13,TIUCNT,+CHILD(I))="A"_U_$$GET1^DIQ(8925,TIUDA,.02)_U_"Addendum to "_$$GET1^DIQ(8925,TIUDA,.01)_U_TIUREFDT_U_$$GET1^DIQ(8925,+CHILD(I),.05)
"RTN","TIUAL1",169,0)
 . . S ^TMP("TIUDOC",$J,+TIUD13,TMPCNT,TIUDA)=(TIUCNT-TMPCNT)_U_$$GET1^DIQ(8925,TIUDA,.02)_U_$$GET1^DIQ(8925,TIUDA,.01)_U_+TIUD13_U_$$GET1^DIQ(8925,TIUDA,.05)
"RTN","TIUAL1",170,0)
 . I $P(^TMP("TIUDA",$J,TIUDA),U,2)="AE"!(+$$HASDAD^TIUSRVLI(TIUDA)) D  Q
"RTN","TIUAL1",171,0)
 . . N TIUAS
"RTN","TIUAL1",172,0)
 . . S TIUCNT=TIUCNT+1
"RTN","TIUAL1",173,0)
 . . S $P(^TMP("TIUDA",$J,TIUDA),U)=1
"RTN","TIUAL1",174,0)
 . . S TIUAS=$P(^TMP("TIUDA",$J,TIUDA),U,3)
"RTN","TIUAL1",175,0)
 . . I $$GET1^DIQ(8925,TIUDA,.01)'["Addendum" S ^TMP("TIUDOC",$J,+TIUD13,TIUCNT,TIUDA)=U_$$GET1^DIQ(8925,TIUDA,.02)_U_$$GET1^DIQ(8925,TIUDA,.01)_U_+TIUD13_U_$$GET1^DIQ(8925,TIUDA,.05)_U_TIUAS
"RTN","TIUAL1",176,0)
 . . E  D
"RTN","TIUAL1",177,0)
 . . . N PARENT,SEQUENCE,TIUI
"RTN","TIUAL1",178,0)
 . . . S PARENT="PARENT",(SEQUENCE,TIUI)=""
"RTN","TIUAL1",179,0)
 . . . D SETDAD^TIUSRVLI(.PARENT,TIUDA,.TIUI) I $G(TIUI)="" Q
"RTN","TIUAL1",180,0)
 . . . S ^TMP("TIUDOC",$J,+TIUD13,TIUCNT,TIUDA)=U_$$GET1^DIQ(8925,TIUDA,.02)_U_"Addendum to "_$$GET1^DIQ(8925,+PARENT(TIUI),.01)_U_$P(TIUD13,U)_U_$$GET1^DIQ(8925,TIUDA,.05)_U_TIUAS
"RTN","TIUAL1",181,0)
 . I '+$$HASKIDS^TIUSRVLI(TIUDA),'+$$HASDAD^TIUSRVLI(TIUDA) D  Q
"RTN","TIUAL1",182,0)
 . . S TIUCNT=TIUCNT+1
"RTN","TIUAL1",183,0)
 . . S ^TMP("TIUDA",$J,TIUDA)=1
"RTN","TIUAL1",184,0)
 . . S ^TMP("TIUDOC",$J,+TIUD13,TIUCNT,TIUDA)=U_$$GET1^DIQ(8925,TIUDA,.02)_U_$$GET1^DIQ(8925,TIUDA,.01)_U_$P(TIUD13,U)_U_$$GET1^DIQ(8925,TIUDA,.05)
"RTN","TIUAL1",185,0)
 Q
"RTN","TIUAL1",186,0)
LSEXIT ; exit code
"RTN","TIUAL1",187,0)
 D XQORM
"RTN","TIUAL1",188,0)
 Q
"RTN","TIUAL1",189,0)
SELSTAT(Y,PARM,DEF,MENU) ; Select Signature status
"RTN","TIUAL1",190,0)
 N I,XQORM,X,TIUY
"RTN","TIUAL1",191,0)
 S XQORM=+$O(^ORD(101,"B",MENU,0))_";ORD(101,"
"RTN","TIUAL1",192,0)
 I +XQORM'>0 W !,"Status selection unavailable." S TIUY=-1 G STATX
"RTN","TIUAL1",193,0)
 S XQORM(0)=$G(PARM),XQORM("A")=$S(MENU="TIU STATUS MENU":"Select DOCUMENT STATUS: ",1:"Select SEARCH CATEGORY: ")
"RTN","TIUAL1",194,0)
 I $S(PARM="F":1,PARM="R":1,1:0) S X=DEF
"RTN","TIUAL1",195,0)
 S XQORM("B")=DEF D EN^XQORM
"RTN","TIUAL1",196,0)
 S TIUY=$G(Y)
"RTN","TIUAL1",197,0)
 I MENU="TIU STATUS MENU",+$G(Y)=1,(+$G(Y(1))=7) S Y=2,Y(2)="8^4843^amended^8"
"RTN","TIUAL1",198,0)
STATX Q TIUY
"RTN","TIUAL1",199,0)
XQORM ;
"RTN","TIUAL1",200,0)
 S XQORM("#")=$O(^ORD(101,"B","TIU ALERTS SELECT",0))_U_"1:"_VALMCNT
"RTN","TIUAL1",201,0)
 Q
"RTN","TIUALFUN")
0^2^B75419288
"RTN","TIUALFUN",1,0)
TIUALFUN ;SLC/AJB - TIU Alert Functions; Mar 17, 2003
"RTN","TIUALFUN",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**158**;Jun 20, 1997
"RTN","TIUALFUN",3,0)
 ;
"RTN","TIUALFUN",4,0)
 Q
"RTN","TIUALFUN",5,0)
ALRTDEL ;
"RTN","TIUALFUN",6,0)
 S TIU("DELETE")=1
"RTN","TIUALFUN",7,0)
 S TIU("MSG")="     Delete Alerts for the following documents:"
"RTN","TIUALFUN",8,0)
 D RESEND
"RTN","TIUALFUN",9,0)
 K TIU("DELETE"),TIU("MSG")
"RTN","TIUALFUN",10,0)
 Q
"RTN","TIUALFUN",11,0)
ASKUSR ;
"RTN","TIUALFUN",12,0)
 N TIUTMP
"RTN","TIUALFUN",13,0)
 D   I TIUTMP("ASK")=-1 S TIU("QUIT")=1 Q
"RTN","TIUALFUN",14,0)
 . N DIR,POP,TIUCONT,X,Y
"RTN","TIUALFUN",15,0)
 . S DIR(0)="SA^1:Browse Document;2:Combination Alerts;3:Delete Alerts;4:Detailed Display;5:Edit a Document;6:Identify Signers;7:Resend Alerts;8:Third Party Alerts"
"RTN","TIUALFUN",16,0)
 . S DIR("A")="Select ACTION: "
"RTN","TIUALFUN",17,0)
 . S DIR("B")="RESEND ALERTS"
"RTN","TIUALFUN",18,0)
 . S DIR("L",1)="1.  Browse a Document   4.  Detailed Display    7.  Resend Alerts"
"RTN","TIUALFUN",19,0)
 . S DIR("L",2)="2.  Combination Alerts  5.  Edit a Document     8.  Third Party Alerts"
"RTN","TIUALFUN",20,0)
 . S DIR("L",3)="3.  Delete Alerts       6.  Identify Signers"
"RTN","TIUALFUN",21,0)
 . S DIR("L",4)=""
"RTN","TIUALFUN",22,0)
 . S DIR("L")="Enter selection by typing the name, number, or abbreviation"
"RTN","TIUALFUN",23,0)
 . S DIR("?",1)="The following actions are available:"
"RTN","TIUALFUN",24,0)
 . S DIR("?",2)="Browse a Document  - View a selected document (if authorized)"
"RTN","TIUALFUN",25,0)
 . S DIR("?",3)="Combination Alerts - Send alerts to expected signers and 3rd parties"
"RTN","TIUALFUN",26,0)
 . S DIR("?",4)="Delete Alerts      - Delete a document's alerts"
"RTN","TIUALFUN",27,0)
 . S DIR("?",5)="Detailed Display   - View detailed display of a document (if authorized)"
"RTN","TIUALFUN",28,0)
 . S DIR("?",6)="Edit a Document    - Edit a selected document (if authorized)"
"RTN","TIUALFUN",29,0)
 . S DIR("?",7)="Identify Signers   - Identify/Change Signers of a document (if authorized)"
"RTN","TIUALFUN",30,0)
 . S DIR("?",8)="Resend Alerts      - Resend alerts to expected signers"
"RTN","TIUALFUN",31,0)
 . S DIR("?")="Third Party Alerts - Send alerts to one or more 3rd parties"
"RTN","TIUALFUN",32,0)
 . F  D ^DIR D  Q:$G(TIUCONT)!$D(DIRUT)
"RTN","TIUALFUN",33,0)
 . . I $D(TIUC(2)),+Y=1 W !,"You can only browse one document at a time.  Select another action." Q
"RTN","TIUALFUN",34,0)
 . . I $D(TIUC(2)),+Y=4 W !,"You can only view the detailed display of one document at a time.",!,"Select another action." Q
"RTN","TIUALFUN",35,0)
 . . I $D(TIUC(2)),+Y=5 W !,"You can only edit one document at a time.  Select another action." Q
"RTN","TIUALFUN",36,0)
 . . I $D(TIUC(2)),+Y=6 W !,"You can only identify signers one document at a time.  Select another action." Q
"RTN","TIUALFUN",37,0)
 . . S TIUCONT=1
"RTN","TIUALFUN",38,0)
 . S TIUTMP("ASK")=$S(+Y=1:"BROWSE",+Y=2:"COMBO",+Y=3:"ALRTDEL",+Y=4:"DETDISP^TIUALSET",+Y=5:"EDIT^TIUAL1",+Y=6:"IDSIGNER",+Y=7:"RESEND",+Y=8:"THIRD",Y=U:-1,1:-1)
"RTN","TIUALFUN",39,0)
 D @TIUTMP("ASK")
"RTN","TIUALFUN",40,0)
 Q
"RTN","TIUALFUN",41,0)
BROWSE ;
"RTN","TIUALFUN",42,0)
 N TEMP,TIUCNT,TIUSEL,TIUQUIK,TIUDA,TIUPRM0,TIUPRM1,TIUPRM3,RSTOK S TIUQUIK=1
"RTN","TIUALFUN",43,0)
 K TIUC
"RTN","TIUALFUN",44,0)
 D FULL^VALM1
"RTN","TIUALFUN",45,0)
 I TIU("CNT")=0 W !,"No documents to select." H 3 Q
"RTN","TIUALFUN",46,0)
 S TIUSEL=$P(XQORNOD(0),"=",2)
"RTN","TIUALFUN",47,0)
 I TIUSEL="" D  Q:TIUSEL=U!($D(DIRUT))
"RTN","TIUALFUN",48,0)
 . N DIR,X,Y
"RTN","TIUALFUN",49,0)
 . S DIR("A")="Select Document: (1-"_VALMLST_") "
"RTN","TIUALFUN",50,0)
 . S DIR(0)="NA^1:"_VALMLST
"RTN","TIUALFUN",51,0)
 . D ^DIR S TIUSEL=Y
"RTN","TIUALFUN",52,0)
 I $A($E(TIUSEL,$L(TIUSEL)))<48!($A($E(TIUSEL,$L(TIUSEL)))>57) S TIUSEL=$E(TIUSEL,1,$L(TIUSEL)-1)
"RTN","TIUALFUN",53,0)
 F X=1:1  Q:$P(TIUSEL,",",X)=""  S TIUC($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUALFUN",54,0)
 S TIUDA=TIUC(TIUSEL)
"RTN","TIUALFUN",55,0)
 S RSTOK=$$DOCCHK^TIULRR(TIUDA)
"RTN","TIUALFUN",56,0)
 I RSTOK'>0 D  Q
"RTN","TIUALFUN",57,0)
 . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIUALFUN",58,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIUALFUN",59,0)
 I $P(^TIU(8925,+TIUDA,0),U,5)'<7,'+$$ISSIGNR^TIUALRT(TIUDA,DUZ)
"RTN","TIUALFUN",60,0)
 D:'$D(TIUPRM0)!'$D(TIUPRM1) SETPARM^TIULE
"RTN","TIUALFUN",61,0)
 S TEMP("CNT")=TIU("CNT"),TEMP("P")=TIU("P"),TEMP("S")=TIU("S")
"RTN","TIUALFUN",62,0)
 S TEMP("D",1)=TIU("D",1),TEMP("D",2)=TIU("D",2)
"RTN","TIUALFUN",63,0)
 S TEMP=""
"RTN","TIUALFUN",64,0)
 F  S TEMP=$O(TIU("C",TEMP)) Q:TEMP=""  S TEMP("C",TEMP)=TIU("C",TEMP)
"RTN","TIUALFUN",65,0)
 F TIUCNT=1:1:TIU("S") S TEMP("S",TIUCNT)=TIU("S",TIUCNT) S $P(TEMP("S",TIUCNT),U)=$S(+TEMP("S",TIUCNT)=10:14,+TEMP("S",TIUCNT)=11:15,1:+TEMP("S",TIUCNT))
"RTN","TIUALFUN",66,0)
 K TIU D EN^VALM("TIU BROWSE FOR READ ONLY")
"RTN","TIUALFUN",67,0)
 S TIU("CNT")=TEMP("CNT"),TIU("P")=TEMP("P"),TIU("S")=TEMP("S")
"RTN","TIUALFUN",68,0)
 S TEMP=""
"RTN","TIUALFUN",69,0)
 F  S TEMP=$O(TEMP("C",TEMP)) Q:TEMP=""  S TIU("C",TEMP)=TEMP("C",TEMP)
"RTN","TIUALFUN",70,0)
 S TIU("D",1)=TEMP("D",1),TIU("D",2)=TEMP("D",2)
"RTN","TIUALFUN",71,0)
 F TIUCNT=1:1:TEMP("S") S TIU("S",TIUCNT)=TEMP("S",TIUCNT) S $P(TIU("S",TIUCNT),U)=$S(+TIU("S",TIUCNT)=10:14,+TIU("S",TIUCNT)=11:15,1:+TIU("S",TIUCNT))
"RTN","TIUALFUN",72,0)
 Q
"RTN","TIUALFUN",73,0)
COMBO ;
"RTN","TIUALFUN",74,0)
 I TIU("CNT")=0 W !,"No documents to select." H 3 Q
"RTN","TIUALFUN",75,0)
 S TIUTMP("CMSG")=1,TIU("MSG")="     Send COMBINATION Alerts for the following documents:"
"RTN","TIUALFUN",76,0)
 S TIUTMP("THIRD PARTY ALERTS")="",TIUTMP("NODEL")=""
"RTN","TIUALFUN",77,0)
 D USERS
"RTN","TIUALFUN",78,0)
 K TIUTMP("CMSG"),TIU("MSG")
"RTN","TIUALFUN",79,0)
 Q
"RTN","TIUALFUN",80,0)
RESEND ;
"RTN","TIUALFUN",81,0)
 I TIU("CNT")=0 W !,"No documents to select." H 3 Q
"RTN","TIUALFUN",82,0)
 N DIR,TIUCNT,TIUDA,TIUDIV1,TIUOD,TIUPRM0,TIUPRM1,TIUQUIT,X,Y
"RTN","TIUALFUN",83,0)
 ;
"RTN","TIUALFUN",84,0)
 I '$D(TIU("MSG")) S TIU("MSG")="     Resend Alerts for the following documents:"
"RTN","TIUALFUN",85,0)
 W @IOF,!,TIU("MSG"),!!
"RTN","TIUALFUN",86,0)
 S TIUCNT="",TIUCNT(1)=0,TIUCNT(2)=19
"RTN","TIUALFUN",87,0)
 F  S TIUCNT(1)=TIUCNT(1)+1,TIUCNT=$O(TIUC(TIUCNT)) W:TIUCNT=""&($G(Y)'=0) ! Q:TIUCNT=""  W $E(@VALMAR@(TIUCNT,0),1,80) D:TIUCNT(1)#TIUCNT(2)=0
"RTN","TIUALFUN",88,0)
 . S TIUCNT(2)=TIUCNT(2)+21
"RTN","TIUALFUN",89,0)
 . N DIR S DIR(0)="E" W ! D ^DIR W !! I Y=0 S TIUCNT="",TIUCNT=$O(TIUC(TIUCNT),-1)
"RTN","TIUALFUN",90,0)
 S DIR(0)="Y",DIR("A")="     Send these alerts as OVERDUE",DIR("B")="NO"
"RTN","TIUALFUN",91,0)
 I '$D(TIU("DELETE")) D ^DIR S TIUOD=+Y Q:TIUOD=U!($D(DIRUT))  W !
"RTN","TIUALFUN",92,0)
 S DIR(0)="Y",DIR("A")="     Is this correct",DIR("B")="YES"
"RTN","TIUALFUN",93,0)
 D ^DIR I +Y'=1 S TIUQUIT=1 Q
"RTN","TIUALFUN",94,0)
 I $G(TIUTMP("CMSG"))=1 F  S TIUCNT=$O(TIUC(TIUCNT)) Q:TIUCNT=""  D ALERTDEL^TIUALRT(TIUC(TIUCNT))
"RTN","TIUALFUN",95,0)
 I '$D(TIU("DELETE")) W !!,"     Sending Alerts..."
"RTN","TIUALFUN",96,0)
 I $D(TIU("DELETE")) W !!,"     Deleting Alerts..."
"RTN","TIUALFUN",97,0)
 S TIUCNT=""
"RTN","TIUALFUN",98,0)
 I '$D(TIU("DELETE")) D
"RTN","TIUALFUN",99,0)
 . F  S TIUCNT=$O(TIUC(TIUCNT)) Q:TIUCNT=""  W "." D SEND^TIUALRT(TIUC(TIUCNT),TIUOD)
"RTN","TIUALFUN",100,0)
 . K TIUTMP("THIRD PARTY ALERTS")
"RTN","TIUALFUN",101,0)
 . I $G(TIUTMP("CMSG"))=1 S TIUCNT="" F  S TIUCNT=$O(TIUC(TIUCNT)) Q:TIUCNT=""  W "." D SEND^TIUALRT(TIUC(TIUCNT),TIUOD)
"RTN","TIUALFUN",102,0)
 I $D(TIU("DELETE")) F  S TIUCNT=$O(TIUC(TIUCNT)) Q:TIUCNT=""  W "." D ALERTDEL^TIUALRT(TIUC(TIUCNT))
"RTN","TIUALFUN",103,0)
 W !!,"     Finished.",!
"RTN","TIUALFUN",104,0)
 K DIR S DIR("A")="     Enter RETURN to continue or '^' to exit",DIR(0)="E" D ^DIR
"RTN","TIUALFUN",105,0)
 K TIUTMP("NODEL")
"RTN","TIUALFUN",106,0)
 Q
"RTN","TIUALFUN",107,0)
SELECT(TIUACT) ;
"RTN","TIUALFUN",108,0)
 N TIUSEL,X,Y
"RTN","TIUALFUN",109,0)
 K TIUC
"RTN","TIUALFUN",110,0)
 D FULL^VALM1
"RTN","TIUALFUN",111,0)
 I TIU("CNT")=0 W !,"No documents to select." H 3 Q
"RTN","TIUALFUN",112,0)
 S TIUSEL=$P(XQORNOD(0),"=",2)
"RTN","TIUALFUN",113,0)
 I TIUSEL="" D  Q:Y=U
"RTN","TIUALFUN",114,0)
 . N DIR
"RTN","TIUALFUN",115,0)
 . S DIR("A")="Select Document(s): (1-"_VALMLST_") "
"RTN","TIUALFUN",116,0)
 . S DIR(0)="LAC^1:"_VALMLST
"RTN","TIUALFUN",117,0)
 . D ^DIR I $D(DIRUT)!(Y=U) S Y=U Q
"RTN","TIUALFUN",118,0)
 . S TIUSEL=Y(0)
"RTN","TIUALFUN",119,0)
 I $A($E(TIUSEL,$L(TIUSEL)))<48!($A($E(TIUSEL,$L(TIUSEL)))>57) S TIUSEL=$E(TIUSEL,1,$L(TIUSEL)-1)
"RTN","TIUALFUN",120,0)
 F X=1:1  Q:$P(TIUSEL,",",X)=""  D
"RTN","TIUALFUN",121,0)
 . N TIUCNT
"RTN","TIUALFUN",122,0)
 . I $P(TIUSEL,",",X)["-" F TIUCNT=+$P(TIUSEL,",",X):1:$P($P(TIUSEL,",",X),"-",2) S TIUC(TIUCNT)=$O(@VALMAR@("IDX",TIUCNT,""))
"RTN","TIUALFUN",123,0)
 . E  S TIUC($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUALFUN",124,0)
 D @TIUACT
"RTN","TIUALFUN",125,0)
 Q
"RTN","TIUALFUN",126,0)
THIRD ;
"RTN","TIUALFUN",127,0)
 I TIU("CNT")=0 W !,"No documents to select." H 3 Q
"RTN","TIUALFUN",128,0)
 S TIU("MSG")="     Send 3rd Party Alerts for the following documents:"
"RTN","TIUALFUN",129,0)
 S TIUTMP("THIRD PARTY ALERTS")="",TIUTMP("NODEL")=""
"RTN","TIUALFUN",130,0)
 D USERS
"RTN","TIUALFUN",131,0)
 K TIU("MSG")
"RTN","TIUALFUN",132,0)
 Q
"RTN","TIUALFUN",133,0)
USERS ;
"RTN","TIUALFUN",134,0)
 N TIUQUIT,TIUREM,TIUXQA
"RTN","TIUALFUN",135,0)
 K TIU("3RD"),TIU("CONTINUE")
"RTN","TIUALFUN",136,0)
 F  D  Q:$G(TIUQUIT)=1!($G(TIU("CONTINUE"))=1)
"RTN","TIUALFUN",137,0)
 . N DIC,DIR,POP,TIUCNT,X,Y
"RTN","TIUALFUN",138,0)
 . W @IOF,!
"RTN","TIUALFUN",139,0)
 . W "     Enter the name(s) of individuals to receive an alert for the selected",!
"RTN","TIUALFUN",140,0)
 . W "     document(s).",!!
"RTN","TIUALFUN",141,0)
 . W "     Kernel will not send alerts to Inactive users; they cannot be",!
"RTN","TIUALFUN",142,0)
 . W "     selected.",!!
"RTN","TIUALFUN",143,0)
 . W "     Enter RETURN or '^' to finish selections.",!
"RTN","TIUALFUN",144,0)
 . S TIUCNT=0,DIC="^VA(200,",DIC("S")="I '$P(^(0),U,7)"
"RTN","TIUALFUN",145,0)
 . S DIC(0)="AEMQ",DIC("A")="     Enter 3RD PARTY RECIPIENT(S): "
"RTN","TIUALFUN",146,0)
 . F  D ^DIC Q:Y=-1  D  Q:$G(TIUQUIT)=1  K TIUREM
"RTN","TIUALFUN",147,0)
 . . N TIUDA,TIUASK S TIUDA="" F  S TIUDA=$O(TIUC(TIUDA)) Q:TIUDA=""  I '$G(TIUASK),'$$CANDO(TIUC(TIUDA),+Y) D
"RTN","TIUALFUN",148,0)
 . . . S TIUASK=1
"RTN","TIUALFUN",149,0)
 . . . W !!?5,"Because ",$E($$GET1^DIQ(200,+Y,.01),1,15)," may not be able to SIGN/COSIGN some or all of the"
"RTN","TIUALFUN",150,0)
 . . . W !?5,"selected documents, they may be unable to resolve the resulting alerts.",!
"RTN","TIUALFUN",151,0)
 . . . N DIR,X,Y S DIR(0)="Y",DIR("A")="     Remove",DIR("B")="YES"
"RTN","TIUALFUN",152,0)
 . . . D ^DIR I Y=U!($D(DIRUT)) S TIUQUIT=1 Q
"RTN","TIUALFUN",153,0)
 . . . I +Y S TIUREM=1 W !
"RTN","TIUALFUN",154,0)
 . . S:'$G(TIUREM) TIUCNT=TIUCNT+1,TIU("3RD",+Y)="" S:TIUCNT=1 DIC("A")="                              and  "
"RTN","TIUALFUN",155,0)
 . Q:$G(TIUQUIT)=1
"RTN","TIUALFUN",156,0)
 . I TIUCNT=0 W !!,"     No selections made.",! S DIR("A")="     Enter RETURN to continue or '^' to exit",DIR(0)="E" D ^DIR S TIUQUIT=1 Q
"RTN","TIUALFUN",157,0)
 . W !!,$S(TIUCNT>1:"     Send 3rd Party Alerts to the following individuals: ",1:"     Send 3rd Party Alerts to the following individual: "),!!
"RTN","TIUALFUN",158,0)
 . S X="" F  S X=$O(TIU("3RD",X)) Q:X=""  S TIUXQA(X)="" W ?5,$$GET1^DIQ(200,X_",",.01),!
"RTN","TIUALFUN",159,0)
 . S DIR(0)="Y",DIR("A")="     Is this correct",DIR("B")="YES"
"RTN","TIUALFUN",160,0)
 . D ^DIR I +Y'=1 W !! K TIU("3RD"),TIUXQA S:Y=U TIUQUIT=1 Q
"RTN","TIUALFUN",161,0)
 . S TIU("CONTINUE")=1
"RTN","TIUALFUN",162,0)
 Q:$G(TIUQUIT)=1
"RTN","TIUALFUN",163,0)
 D RESEND
"RTN","TIUALFUN",164,0)
 Q
"RTN","TIUALFUN",165,0)
 ;
"RTN","TIUALFUN",166,0)
CANDO(TIUDA,PERSON) ;
"RTN","TIUALFUN",167,0)
 N TIUACT
"RTN","TIUALFUN",168,0)
 S TIUACT="SIGNATURE" I $$CANDO^TIULP(TIUDA,TIUACT,PERSON) Q 1
"RTN","TIUALFUN",169,0)
 S TIUACT="COSIGNATURE" I $$CANDO^TIULP(TIUDA,TIUACT,PERSON) Q 1
"RTN","TIUALFUN",170,0)
 Q 0
"RTN","TIUALFUN",171,0)
IDSIGNER ;
"RTN","TIUALFUN",172,0)
 N D,DIC,TIUCHNG,TIUDA,TIUDCSNR,TIUDIV1,TIUFPRIV,TIUPRM0,TIUPRM1,TIUSEL,X,Y
"RTN","TIUALFUN",173,0)
 D FULL^VALM1
"RTN","TIUALFUN",174,0)
 I TIU("CNT")=0 W !,"No documents to select." H 3 Q
"RTN","TIUALFUN",175,0)
 S TIUSEL=$P(XQORNOD(0),"=",2)
"RTN","TIUALFUN",176,0)
 I TIUSEL="" D  Q:TIUSEL=U!($D(DIRUT))
"RTN","TIUALFUN",177,0)
 . N DIR,X,Y
"RTN","TIUALFUN",178,0)
 . S DIR("A")="Select Document: (1-"_VALMLST_") "
"RTN","TIUALFUN",179,0)
 . S DIR(0)="NA^1:"_VALMLST
"RTN","TIUALFUN",180,0)
 . D ^DIR S TIUSEL=Y
"RTN","TIUALFUN",181,0)
 I $A($E(TIUSEL,$L(TIUSEL)))<48!($A($E(TIUSEL,$L(TIUSEL)))>57) S TIUSEL=$E(TIUSEL,1,$L(TIUSEL)-1)
"RTN","TIUALFUN",182,0)
 F X=1:1  Q:$P(TIUSEL,",",X)=""  S TIUC($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUALFUN",183,0)
 S TIUDA=TIUC(TIUSEL)
"RTN","TIUALFUN",184,0)
 D SIGNER^TIURA1
"RTN","TIUALFUN",185,0)
 D UPDATE^TIUALSET
"RTN","TIUALFUN",186,0)
 Q
"RTN","TIUALRT")
0^3^B46061417
"RTN","TIUALRT",1,0)
TIUALRT ; SLC/JER,AJB - Notify Author and Attending. ; Mar 17, 2003
"RTN","TIUALRT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**21,84,79,88,58,61,151,158**;Jun 20, 1997
"RTN","TIUALRT",3,0)
SEND(DA,OVERDUE) ; Generate "available for signature" alert
"RTN","TIUALRT",4,0)
 N TIU0,TIU12,TIU13,TIU14,TIU15,TIUESNR,TIUPNM,TIUECSNR,TIUSIG,TIUDPRM
"RTN","TIUALRT",5,0)
 N TIUCOSG,TIUEDT,TIUSSN,TIU,TIUTYP,XQA,XQAKILL,XQAMSG,XQAROU,XQAID
"RTN","TIUALRT",6,0)
 N XQAFLG,STATUS,SIGACT,ECSNRFLG
"RTN","TIUALRT",7,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUALRT",8,0)
 I '$D(TIUTMP("NODEL")) D ALERTDEL(DA)
"RTN","TIUALRT",9,0)
 S TIU0=$G(^TIU(8925,+DA,0)),TIU12=$G(^(12)),TIU13=$G(^(13))
"RTN","TIUALRT",10,0)
 S TIU14=$G(^TIU(8925,+DA,14)),TIU15=$G(^(15))
"RTN","TIUALRT",11,0)
 D DOCPRM^TIULC1(+TIU0,.TIUDPRM,DA)
"RTN","TIUALRT",12,0)
 ; Quit if notifications not enabled
"RTN","TIUALRT",13,0)
 I '$D(TIUDPRM(0)) Q
"RTN","TIUALRT",14,0)
 ; If document is an addendum, and the original is incomplete, quit
"RTN","TIUALRT",15,0)
 ; per NOIS DUR-0101-32087
"RTN","TIUALRT",16,0)
 ; I +$$ISADDNDM^TIULC1(DA),($P($G(^TIU(8925,+$P(TIU0,U,6),0)),U,5)<7) Q
"RTN","TIUALRT",17,0)
 I '+$P(TIUPRM1,U,7)!(+$P(TIU12,U)<+$P(TIUPRM1,U,7)) Q
"RTN","TIUALRT",18,0)
 ; If third party alert from TIUALFUN **158**
"RTN","TIUALRT",19,0)
 I $D(TIUTMP("THIRD PARTY ALERTS")) G THIRD
"RTN","TIUALRT",20,0)
 ; If document is completed, jump to additional signers
"RTN","TIUALRT",21,0)
 I (+$P(TIU0,U,5)'<7) G ADDSNR
"RTN","TIUALRT",22,0)
 I +$P($G(TIUDPRM(0)),U,2),'+$P(TIU13,U,4) Q  ; not released
"RTN","TIUALRT",23,0)
 ; If Verification required, and not verified, don't send
"RTN","TIUALRT",24,0)
 I +$$REQVER^TIULC(DA,+$P($G(TIUDPRM(0)),U,3)),'+$P(TIU13,U,5) Q
"RTN","TIUALRT",25,0)
 ; Set up for call to XQALERT
"RTN","TIUALRT",26,0)
 S TIUEDT=$$DATE^TIULS($P(TIU0,U,7))
"RTN","TIUALRT",27,0)
 S TIUESNR=$P(TIU12,U,4)
"RTN","TIUALRT",28,0)
 S TIUSIG=$P(TIU15,U)
"RTN","TIUALRT",29,0)
 S TIUECSNR=$P(TIU12,U,8),TIUCOSG=$P(TIU15,U,7)
"RTN","TIUALRT",30,0)
 ; If author has been identified, but not Expected Signer, make
"RTN","TIUALRT",31,0)
 ; author the expected signer
"RTN","TIUALRT",32,0)
 I +TIUESNR'>0,(+$P(TIU12,U,2)>0) D
"RTN","TIUALRT",33,0)
 . N DIE,DR
"RTN","TIUALRT",34,0)
 . S TIUESNR=$P(TIU12,U,2)
"RTN","TIUALRT",35,0)
 . S DIE=8925,DR="1204////^S X=TIUESNR" D ^DIE
"RTN","TIUALRT",36,0)
 ; If attending has been identified, but not Expected Cosigner, make
"RTN","TIUALRT",37,0)
 ; attending the expected cosigner
"RTN","TIUALRT",38,0)
 I +TIUECSNR'>0,(+$P(TIU12,U,9)>0) D
"RTN","TIUALRT",39,0)
 . N DIE,DR
"RTN","TIUALRT",40,0)
 . S TIUECSNR=$P(TIU12,U,9)
"RTN","TIUALRT",41,0)
 . S DIE=8925,DR="1208////^S X=TIUECSNR" D ^DIE
"RTN","TIUALRT",42,0)
 ; If first signature required and the expected signer is authorized
"RTN","TIUALRT",43,0)
 ; to sign this record, and the record is not yet signed
"RTN","TIUALRT",44,0)
 ; ** Set AUTHOR as recipient
"RTN","TIUALRT",45,0)
 I '+$G(TIUSIG),(+TIUESNR>0),(+$P(TIUDPRM(0),U,4)>0) S XQA(TIUESNR)=""
"RTN","TIUALRT",46,0)
 ; If the record requires cosignature, and is not yet cosigned
"RTN","TIUALRT",47,0)
 ; ** Set Expected Cosigner as recipient
"RTN","TIUALRT",48,0)
 I TIUECSNR]"",(+$P(TIU0,U,5)<7),(+$G(TIUCOSG)'>0) D
"RTN","TIUALRT",49,0)
 . N TIUDA S TIUDA=DA
"RTN","TIUALRT",50,0)
 . ; For documents other than Discharge Summaries, defer alerting
"RTN","TIUALRT",51,0)
 . ; Expected Cosigner 'til AUTHOR has signed
"RTN","TIUALRT",52,0)
 . ; If current document is an addendum apply test to its parent
"RTN","TIUALRT",53,0)
 . I +$$ISADDNDM^TIULC1(DA) S TIUDA=$P(^TIU(8925,DA,0),U,6)
"RTN","TIUALRT",54,0)
 . ; If cosigner alerts are to be deferred until signature, quit
"RTN","TIUALRT",55,0)
 . I '+$P(TIUDPRM(0),U,20),'+$G(TIUSIG),+$P(TIUDPRM(0),U,4) Q  ; **84,112/151**
"RTN","TIUALRT",56,0)
 . S XQA(TIUECSNR)="",ECSNRFLG=1 ; **151**
"RTN","TIUALRT",57,0)
ADDSNR ; Send addendum alerts, check for additional signers
"RTN","TIUALRT",58,0)
 I +$$ISADDNDM^TIULC1(DA) D SENDADD(DA)
"RTN","TIUALRT",59,0)
 ; If additional signers have been designated, alert them too
"RTN","TIUALRT",60,0)
 I +$O(^TIU(8925.7,"B",DA,0)),(+$P(TIU0,U,5)>5) D
"RTN","TIUALRT",61,0)
 . N TIUXTRA,TIUI D XTRASGNR^TIULG(.TIUXTRA,DA) Q:+$D(TIUXTRA)'>9
"RTN","TIUALRT",62,0)
 . S TIUI=0 F  S TIUI=$O(TIUXTRA(TIUI)) Q:+TIUI'>0  S XQA(TIUI)=""
"RTN","TIUALRT",63,0)
 Q:$D(XQA)'>9
"RTN","TIUALRT",64,0)
THIRD ; **158**
"RTN","TIUALRT",65,0)
 I $D(TIUTMP("THIRD PARTY ALERTS")) D
"RTN","TIUALRT",66,0)
 . N TIUX
"RTN","TIUALRT",67,0)
 . S TIUX="" F  S TIUX=$O(TIUXQA(TIUX)) Q:TIUX=""  S XQA(TIUX)=""
"RTN","TIUALRT",68,0)
 ; Get demographics for alert message
"RTN","TIUALRT",69,0)
 S TIUPNM=$E($P($G(^DPT(+$P(TIU0,U,2),0)),U),1,9)
"RTN","TIUALRT",70,0)
 S TIUTYP=$$PNAME^TIULC1(+$G(TIU0))
"RTN","TIUALRT",71,0)
 D PATVADPT^TIULV(.TIU,+$P(TIU0,U,2))
"RTN","TIUALRT",72,0)
 S TIUSSN=$E(TIUPNM,1)_$P($G(TIU("SSN")),"-",3)
"RTN","TIUALRT",73,0)
 S XQAID="TIU"_+DA,STATUS=$$UP^XLFSTR($$STATUS^TIULC(DA))
"RTN","TIUALRT",74,0)
 S SIGACT=$S(STATUS="UNSIGNED":"SIGNATURE",STATUS="UNCOSIGNED":"COSIGNATURE",1:"ADD'L SIGNATURE")
"RTN","TIUALRT",75,0)
 I $G(ECSNRFLG),$P(TIU0,U,5)=5 S STATUS="UNSIG/UNCOS'D" ; **151**
"RTN","TIUALRT",76,0)
 S XQAMSG=TIUPNM_" ("_TIUSSN_"): "_STATUS_" "_$S($P(TIU0,U,9)="P":"STAT ",1:"")_TIUTYP
"RTN","TIUALRT",77,0)
 I +$G(OVERDUE) S XQAMSG=XQAMSG_" OVERDUE for "_SIGACT_"." G ENDMSG
"RTN","TIUALRT",78,0)
 S XQAMSG=XQAMSG_" available for "_SIGACT_"."
"RTN","TIUALRT",79,0)
ENDMSG ;
"RTN","TIUALRT",80,0)
 S XQAROU="ACT^TIUALRT",XQADATA=+DA_U
"RTN","TIUALRT",81,0)
 D SETUP^XQALERT
"RTN","TIUALRT",82,0)
 Q
"RTN","TIUALRT",83,0)
ACT ; Act on alerts
"RTN","TIUALRT",84,0)
 N TIUQUIK,TIUDA,TIUPRM0,TIUPRM1,TIUPRM3,RSTOK S TIUQUIK=1 K XQAKILL
"RTN","TIUALRT",85,0)
 S TIUDA=$P(XQADATA,U)
"RTN","TIUALRT",86,0)
 I '$D(^TIU(8925,+TIUDA,0)) D ALERTDEL(TIUDA) Q
"RTN","TIUALRT",87,0)
 S RSTOK=$$DOCCHK^TIULRR(TIUDA)
"RTN","TIUALRT",88,0)
 I RSTOK'>0 D  Q
"RTN","TIUALRT",89,0)
 . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIUALRT",90,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIUALRT",91,0)
 I $P(^TIU(8925,+TIUDA,0),U,5)'<7,'+$$ISSIGNR(TIUDA,DUZ) S XQAKILL=1
"RTN","TIUALRT",92,0)
 D:'$D(TIUPRM0)!'$D(TIUPRM1) SETPARM^TIULE
"RTN","TIUALRT",93,0)
 D EN^VALM("TIU BROWSE FOR CLINICIAN")
"RTN","TIUALRT",94,0)
 Q
"RTN","TIUALRT",95,0)
SENDTRAN(DA) ; Generate "Send back to transcription" alert
"RTN","TIUALRT",96,0)
 N TIUEDT,TIU0,TIUPNM,TIUSSN,TIUTRAN,TIU,XQA,XQAMSG,TIUMSG
"RTN","TIUALRT",97,0)
 N TIUESNR,TIU12,TIU13,TIU14,TIU15,TIUTYP
"RTN","TIUALRT",98,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUALRT",99,0)
 D ALERTDEL(DA)
"RTN","TIUALRT",100,0)
 ; Don't send if notifications not enabled
"RTN","TIUALRT",101,0)
 I '+$P(TIUPRM1,U,7) Q
"RTN","TIUALRT",102,0)
 S TIU0=$G(^TIU(8925,+DA,0)),TIU12=$G(^(12)),TIU13=$G(^(13))
"RTN","TIUALRT",103,0)
 S TIU14=$G(^TIU(8925,+DA,14)),TIU15=$G(^(15))
"RTN","TIUALRT",104,0)
 S TIUPNM=$E($P($G(^DPT(+$P(TIU0,U,2),0)),U),1,9)
"RTN","TIUALRT",105,0)
 S TIUEDT=$$DATE^TIULS($P(TIU0,U,7))
"RTN","TIUALRT",106,0)
 S TIUTYP=$$PNAME^TIULC1(+$G(TIU0))
"RTN","TIUALRT",107,0)
 S TIUTRAN=$P(TIU13,U,2),TIUESNR=$P(12,U,2)
"RTN","TIUALRT",108,0)
 D PATVADPT^TIULV(.TIU,+$P(TIU0,U,2)) ;Used to get SSN. Date not important.
"RTN","TIUALRT",109,0)
 S TIUSSN=$E(TIUPNM,1)_$P($G(TIU("SSN")),"-",3)
"RTN","TIUALRT",110,0)
 I $D(^VA(200,+TIUTRAN,0)) S XQA(TIUTRAN)=""
"RTN","TIUALRT",111,0)
 Q:$D(XQA)'>9
"RTN","TIUALRT",112,0)
 S TIUMSG=$S(TIUTRAN=TIUESNR:" needs editing",1:" needs retranscription.")
"RTN","TIUALRT",113,0)
 S XQAID="TIU"_+DA
"RTN","TIUALRT",114,0)
 S XQAMSG=TIUPNM_" ("_TIUSSN_"): "_TIUTYP_TIUMSG
"RTN","TIUALRT",115,0)
 D SETUP^XQALERT
"RTN","TIUALRT",116,0)
 Q
"RTN","TIUALRT",117,0)
SENDADD(DA) ; Generates "Addendum added" alert
"RTN","TIUALRT",118,0)
 N TIU12,TIU13,TIU14,TIU15,TIU0,TIUPNM,TIUSSN,TIUTRAN,TIU,TIUTITLE,TIUDPRM
"RTN","TIUALRT",119,0)
 N XQA,XQAMSG,XQAFLG,XQADATA,XQAROU,TIUESNR,TIUDATE,TIUESNM,TIUO0,TIUO12,TIUO13
"RTN","TIUALRT",120,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUALRT",121,0)
 D ADDENDEL(DA)
"RTN","TIUALRT",122,0)
 ; Don't send if notifications not enabled
"RTN","TIUALRT",123,0)
 I '+$P(TIUPRM1,U,7) Q
"RTN","TIUALRT",124,0)
 S TIU0=$G(^TIU(8925,+DA,0))
"RTN","TIUALRT",125,0)
 ; Only send upon completion
"RTN","TIUALRT",126,0)
 Q:+$P(TIU0,U,5)'>6
"RTN","TIUALRT",127,0)
 D DOCPRM^TIULC1(+TIU0,.TIUDPRM,DA) Q:'+$P(TIUDPRM(0),U,17)
"RTN","TIUALRT",128,0)
 S TIU12=$G(^TIU(8925,+DA,12)),TIU13=$G(^(13)),TIU14=$G(^(14)),TIU15=$G(^(15))
"RTN","TIUALRT",129,0)
 S TIUO0=$G(^TIU(8925,$P(TIU0,U,6),0)),TIUO12=$G(^(12)),TIUO13=$G(^(13))
"RTN","TIUALRT",130,0)
 S TIUPNM=$E($$PTNAME^TIULC1(+$P(TIU0,U,2)),1,9)
"RTN","TIUALRT",131,0)
 S TIUESNM=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIU12,U,2)),"LAST,FI MI")
"RTN","TIUALRT",132,0)
 S TIUTITLE=$E($$PNAME^TIULC1(+TIUO0),1,20)
"RTN","TIUALRT",133,0)
 S TIUDATE=$S(+$P(TIUO13,U):$P(TIUO13,U),1:$G(DT))
"RTN","TIUALRT",134,0)
 S TIUDATE=$$DATE^TIULS(TIUDATE)
"RTN","TIUALRT",135,0)
 D PATVADPT^TIULV(.TIU,+$P(TIU0,U,2)) ;Used to get SSN. Date not important.
"RTN","TIUALRT",136,0)
 S TIUSSN=$E(TIUPNM,1)_$P($G(TIU("SSN")),"-",3)
"RTN","TIUALRT",137,0)
 S TIUTRAN=$P(TIU13,U,2)
"RTN","TIUALRT",138,0)
 ;Expected Cosigner and Author of original document
"RTN","TIUALRT",139,0)
 S TIUECSNR=$P($G(^TIU(8925,$P(TIU0,U,6),12)),U,8),TIUESNR=$P($G(^(12)),U,4)
"RTN","TIUALRT",140,0)
 ; Not entered by Expected Signer: SET Expected Signer as recipient
"RTN","TIUALRT",141,0)
 I TIUESNR'=TIUTRAN,$D(^VA(200,+TIUESNR,0)) S XQA(TIUESNR)=""
"RTN","TIUALRT",142,0)
 ; Not entered by Expected Cosigner: SET Expected Cosigner as recipient
"RTN","TIUALRT",143,0)
 I +TIUECSNR>0,(TIUECSNR'=TIUTRAN),$$FIND1^DIC(200,"","AQ",+TIUECSNR) S XQA(TIUECSNR)=""
"RTN","TIUALRT",144,0)
 ; I +TIUECSNR>0,(TIUECSNR'=TIUTRAN),$D(^VA(200,+TIUECSNR,0)) S XQA(TIUECSNR)="" **151**
"RTN","TIUALRT",145,0)
 Q:$D(XQA)'>9
"RTN","TIUALRT",146,0)
 S XQAID="TIUADD"_+DA,XQADATA=+DA_U,XQAROU="ACTADD^TIUALRT"
"RTN","TIUALRT",147,0)
 S XQAMSG=TIUPNM_" ("_TIUSSN_"): ADDENDUM to "_TIUTITLE_" of "_TIUDATE_" by "_TIUESNM
"RTN","TIUALRT",148,0)
 D SETUP^XQALERT
"RTN","TIUALRT",149,0)
 Q
"RTN","TIUALRT",150,0)
ACTADD ; Act on ADDENDUM alerts
"RTN","TIUALRT",151,0)
 N TIUQUIK,TIUDA,TIUPRM0,TIUPRM1,TIUPRM3 S TIUQUIK=1 K XQAKILL
"RTN","TIUALRT",152,0)
 S TIUDA=$P(XQADATA,U),XQAKILL=1
"RTN","TIUALRT",153,0)
 I '$D(^TIU(8925,+TIUDA,0)) D ADDENDEL(TIUDA) Q
"RTN","TIUALRT",154,0)
 W !!,"A NEW Addendum has been added to your document...",!
"RTN","TIUALRT",155,0)
 W:$L($P($G(XQX),U,3)) !,$P($G(XQX),U,3),!
"RTN","TIUALRT",156,0)
 I '+$$READ^TIUU("YAO","Do you wish to Browse the Addendum now? ","NO") Q
"RTN","TIUALRT",157,0)
 D:'$D(TIUPRM0)!'$D(TIUPRM1) SETPARM^TIULE
"RTN","TIUALRT",158,0)
 D EN^VALM("TIU BROWSE FOR CLINICIAN")
"RTN","TIUALRT",159,0)
 Q
"RTN","TIUALRT",160,0)
ALERTDEL(DA) ; Delete alerts associated with a given document
"RTN","TIUALRT",161,0)
 N XQA,XQAID,XQAKILL S XQAID="TIU"_DA
"RTN","TIUALRT",162,0)
 D DELETEA^XQALERT
"RTN","TIUALRT",163,0)
 Q
"RTN","TIUALRT",164,0)
ADDENDEL(DA) ; Delete alert associated with a Addendum added
"RTN","TIUALRT",165,0)
 N XQA,XQAID,XQAKILL S XQAID="TIUADD"_DA
"RTN","TIUALRT",166,0)
 D DELETEA^XQALERT
"RTN","TIUALRT",167,0)
 Q
"RTN","TIUALRT",168,0)
ISSIGNR(DA,USER) ; Is USER an additional signer of document DA?
"RTN","TIUALRT",169,0)
 N TIUY,TIUSDA,TIUSD0 S (TIUY,TIUSDA)=0
"RTN","TIUALRT",170,0)
 S TIUSDA=+$O(^TIU(8925.7,"AE",DA,USER,0)) G:'TIUSDA ISSIGNX
"RTN","TIUALRT",171,0)
 S TIUSD0=$G(^TIU(8925.7,TIUSDA,0)) G:'$L(TIUSD0) ISSIGNX
"RTN","TIUALRT",172,0)
 I +$P(TIUSD0,U,4)'>0 S TIUY=1
"RTN","TIUALRT",173,0)
ISSIGNX Q TIUY
"RTN","TIUALSET")
0^4^B21267317
"RTN","TIUALSET",1,0)
TIUALSET ;SLC/AJB - TIU Alerts ; Mar 17, 2003
"RTN","TIUALSET",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**158**;Jun 20, 1997
"RTN","TIUALSET",3,0)
 ;
"RTN","TIUALSET",4,0)
 Q
"RTN","TIUALSET",5,0)
DETDISP ; detailed display
"RTN","TIUALSET",6,0)
 N D0,DIROUT,RSTRCTD,TIUDA,TIUD,TIUDATA,TIUGDATA,TIUSEL,TIUI,TIUQUIT,Y
"RTN","TIUALSET",7,0)
 D FULL^VALM1
"RTN","TIUALSET",8,0)
 I TIU("CNT")=0 W !,"No documents to select." H 3 Q
"RTN","TIUALSET",9,0)
 S TIUSEL=$P(XQORNOD(0),"=",2)
"RTN","TIUALSET",10,0)
 I TIUSEL="" D  Q:TIUSEL=U!($D(DIRUT))
"RTN","TIUALSET",11,0)
 . N DIR,X,Y
"RTN","TIUALSET",12,0)
 . S DIR("A")="Select Document: (1-"_VALMLST_") "
"RTN","TIUALSET",13,0)
 . S DIR(0)="NA^1:"_VALMLST
"RTN","TIUALSET",14,0)
 . D ^DIR S TIUSEL=Y
"RTN","TIUALSET",15,0)
 I $A($E(TIUSEL,$L(TIUSEL)))<48!($A($E(TIUSEL,$L(TIUSEL)))>57) S TIUSEL=$E(TIUSEL,1,$L(TIUSEL)-1)
"RTN","TIUALSET",16,0)
 F X=1:1  Q:$P(TIUSEL,",",X)=""  S TIUC($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUALSET",17,0)
 S TIUDA=TIUC(TIUSEL)
"RTN","TIUALSET",18,0)
 D
"RTN","TIUALSET",19,0)
 . N TIUVIEW
"RTN","TIUALSET",20,0)
 . D CLEAR^VALM1
"RTN","TIUALSET",21,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUALSET",22,0)
 . I +TIUVIEW'>0 D  Q
"RTN","TIUALSET",23,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIUALSET",24,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIUALSET",25,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIUALSET",26,0)
 . I RSTRCTD D  Q
"RTN","TIUALSET",27,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIUALSET",28,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIUALSET",29,0)
 . D EN^TIUAUDIT
"RTN","TIUALSET",30,0)
 . I +$G(TIUQUIT) D FIXLSTNW^TIULM Q
"RTN","TIUALSET",31,0)
 K VALMY S VALMBCK="R"
"RTN","TIUALSET",32,0)
 Q
"RTN","TIUALSET",33,0)
UPDATE ; update LM display for edited documents
"RTN","TIUALSET",34,0)
 ;
"RTN","TIUALSET",35,0)
 N TIUAS,TIUDISP
"RTN","TIUALSET",36,0)
 S TIUAS="",TIUAS=$O(^TIU(8925.7,"AE",TIUDA,TIU("P"),TIUAS))
"RTN","TIUALSET",37,0)
 S TIUDISP=@VALMAR@(TIUSEL,0)
"RTN","TIUALSET",38,0)
 S TIUDISP("REFDT")=$$FMTDT^TIUAL1(+^TIU(8925,TIUDA,13))
"RTN","TIUALSET",39,0)
 S TIUDISP("S")=$$GET1^DIQ(8925,TIUDA,.05)
"RTN","TIUALSET",40,0)
 S TIUDISP("A/D")=$$GET1^DIQ(8925,TIUDA,1202)
"RTN","TIUALSET",41,0)
 S TIUDISP("EC")=$$GET1^DIQ(8925,TIUDA,1208)
"RTN","TIUALSET",42,0)
 S TIUDISP("ATT")=$$GET1^DIQ(8925,TIUDA,1209)
"RTN","TIUALSET",43,0)
 S TIUDISP("ADS")=$$GET1^DIQ(8925.7,TIUAS,.03)
"RTN","TIUALSET",44,0)
 S TIUDISP=$$SETSTR^VALM1(TIUDISP("REFDT"),TIUDISP,60,68)
"RTN","TIUALSET",45,0)
 S TIUDISP=$$SETSTR^VALM1($$LOW^XLFSTR(TIUDISP("S")),TIUDISP,70,80)
"RTN","TIUALSET",46,0)
 S TIUDISP=$$SETSTR^VALM1(TIUSEL,TIUDISP,81,86)
"RTN","TIUALSET",47,0)
 S TIUDISP=$$SETSTR^VALM1($E(TIUDISP("A/D"),1,17),TIUDISP,88,105)
"RTN","TIUALSET",48,0)
 S TIUDISP=$$SETSTR^VALM1($E($G(TIUDISP("EC")),1,17),TIUDISP,107,124)
"RTN","TIUALSET",49,0)
 S TIUDISP=$$SETSTR^VALM1($E($G(TIUDISP("ATT")),1,17),TIUDISP,126,143)
"RTN","TIUALSET",50,0)
 S TIUDISP=$$SETSTR^VALM1($E($G(TIUDISP("ADS")),1,15),TIUDISP,145,160)
"RTN","TIUALSET",51,0)
 D SET^VALM10(TIUSEL,TIUDISP,TIUDA)
"RTN","TIUALSET",52,0)
 D RE^VALM4
"RTN","TIUALSET",53,0)
 Q
"RTN","TIUALSET",54,0)
SETUP ; user required input for search parameters
"RTN","TIUALSET",55,0)
 N TIUCAT,TIUCNT,TIUPERS,TIUTMP,TIUSTAT
"RTN","TIUALSET",56,0)
 D   I TIUSTAT=-1 S TIU("QUIT")=1 Q
"RTN","TIUALSET",57,0)
 . S TIUSTAT=$$SELSTAT^TIUAL1(.TIUSTAT,"A","UNSIGNED","TIU STATUS MENU")
"RTN","TIUALSET",58,0)
 D   I TIUCAT=-1 S TIU("QUIT")=1 Q
"RTN","TIUALSET",59,0)
 . S TIUCAT=$$SELSTAT^TIUAL1(.TIUCAT,"A","AUTHOR","TIU ALERTS SEARCH MENU")
"RTN","TIUALSET",60,0)
 D   I TIUPERS=-1 S TIU("QUIT")=1 Q
"RTN","TIUALSET",61,0)
 . N DIC
"RTN","TIUALSET",62,0)
 . S DIC="^VA(200,",DIC(0)="AEMQ"
"RTN","TIUALSET",63,0)
 . S DIC("A")="Select NEW PERSON: "
"RTN","TIUALSET",64,0)
 . D ^DIC S TIUPERS=+Y
"RTN","TIUALSET",65,0)
 . I $$GET1^DIQ(200,+Y,7,"I")!$$GET1^DIQ(200,+Y,9.2,"I") D
"RTN","TIUALSET",66,0)
 . . W !
"RTN","TIUALSET",67,0)
 . . W:$$GET1^DIQ(200,+Y,7,"I") !,$$GET1^DIQ(200,+Y,.01)," is INACTIVE (DIUSER'd)"
"RTN","TIUALSET",68,0)
 . . W:$$GET1^DIQ(200,+Y,9.2,"I") !,$$GET1^DIQ(200,+Y,.01)," has a termination date of ",$$GET1^DIQ(200,+Y,9.2)
"RTN","TIUALSET",69,0)
 . . W !
"RTN","TIUALSET",70,0)
 D   I '$G(TIUTMP("DT1"))!('$G(TIUTMP("DT2"))) S TIU("QUIT")=1 Q   ; select date range
"RTN","TIUALSET",71,0)
 . F TIUCNT=1:1:2 D
"RTN","TIUALSET",72,0)
 . . N %DT S %DT="AET"
"RTN","TIUALSET",73,0)
 . . S %DT("A")=$S(TIUCNT=1:" Start Reference Date [Time]: ",TIUCNT=2:"Ending Reference Date [Time]: ")
"RTN","TIUALSET",74,0)
 . . S %DT("B")=$S(TIUCNT=1:"T-7",TIUCNT=2:$P($$HTE^XLFDT($H),"@"))
"RTN","TIUALSET",75,0)
 . . D ^%DT
"RTN","TIUALSET",76,0)
 . . I Y=-1 S TIUCNT=2 Q
"RTN","TIUALSET",77,0)
 . . I TIUCNT=1 S TIUTMP("DT1")=+Y
"RTN","TIUALSET",78,0)
 . . I TIUTMP("DT1")>+Y S TIUTMP("DT3")=TIUTMP("DT1"),TIUTMP("DT1")=+Y,Y=TIUTMP("DT3")
"RTN","TIUALSET",79,0)
 . . I TIUCNT=2,Y["." S TIUTMP("DT2")=+Y
"RTN","TIUALSET",80,0)
 . . E  I TIUCNT=2 S TIUTMP("DT2")=+Y_".24"
"RTN","TIUALSET",81,0)
 K TIU
"RTN","TIUALSET",82,0)
 F TIUCNT=1:1:TIUCAT D
"RTN","TIUALSET",83,0)
 . S TIUCAT=$S(+TIUCAT(TIUCNT)=1:"CA",+TIUCAT(TIUCNT)=2:"CA",+TIUCAT(TIUCNT)=3:"CS",+TIUCAT(TIUCNT)=4:"CS",+TIUCAT(TIUCNT)=5:"AE") S:'$D(TIU("C",TIUCAT)) TIU("C",TIUCAT)=""
"RTN","TIUALSET",84,0)
 . S TIU("C",TIUCAT)=TIU("C",TIUCAT)_U_$S(+TIUCAT(TIUCNT)=1:"Author",+TIUCAT(TIUCNT)=2:"Dictator",+TIUCAT(TIUCNT)=3:"Expected Cosigner",+TIUCAT(TIUCNT)=4:"Attending Physician",+TIUCAT(TIUCNT)=5:"Add'l Signer")
"RTN","TIUALSET",85,0)
 S TIU("P")=+TIUPERS
"RTN","TIUALSET",86,0)
 S TIU("S")=TIUSTAT
"RTN","TIUALSET",87,0)
 F TIUCNT=1:1:TIUSTAT S TIU("S",TIUCNT)=TIUSTAT(TIUCNT) S $P(TIU("S",TIUCNT),U)=$S(+TIU("S",TIUCNT)=10:14,+TIU("S",TIUCNT)=11:15,1:+TIU("S",TIUCNT))
"RTN","TIUALSET",88,0)
 S TIU("D",1)=TIUTMP("DT1")
"RTN","TIUALSET",89,0)
 S TIU("D",2)=TIUTMP("DT2")
"RTN","TIUALSET",90,0)
 Q
"VER")
8.0^22.0
**END**
**END**
