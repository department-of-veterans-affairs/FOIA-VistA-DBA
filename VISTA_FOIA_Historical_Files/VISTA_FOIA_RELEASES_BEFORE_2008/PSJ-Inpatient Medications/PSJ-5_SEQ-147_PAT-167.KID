Released PSJ*5*167 SEQ #147
Extracted from mail message
**KIDS**:PSJ*5.0*167^

**INSTALL NAME**
PSJ*5.0*167
"BLD",5704,0)
PSJ*5.0*167^INPATIENT MEDICATIONS^0^3060208^y
"BLD",5704,1,0)
^^12^12^3060208^
"BLD",5704,1,1,0)
 Pending complex orders cannot be verified when the complex order is also
"BLD",5704,1,2,0)
 an Inpatient Orders for Outpatients (IMO) order. This patch corrects this
"BLD",5704,1,3,0)
 issue by allowing the verification of complex IMO orders if the IMO
"BLD",5704,1,4,0)
 functionality is active and the clinic is a valid IMO clinic.
"BLD",5704,1,5,0)
 
"BLD",5704,1,6,0)
 Complex Inpatient orders may only be created if the Inpatient Orders for
"BLD",5704,1,7,0)
 Outpatients (IMO) functionality has been activated.  The same criteria
"BLD",5704,1,8,0)
 used to determine if a simple IMO order may be selected for finishing in
"BLD",5704,1,9,0)
 Inpatient Medications will be used for Complex Orders; for instance, if
"BLD",5704,1,10,0)
 the clinic associated with the order is not a valid IMO clinic, the order
"BLD",5704,1,11,0)
 may not be finished in Inpatient Medications.
"BLD",5704,1,12,0)
 HD115420
"BLD",5704,4,0)
^9.64PA^^
"BLD",5704,"ABPKG")
n
"BLD",5704,"KRN",0)
^9.67PA^8989.52^19
"BLD",5704,"KRN",.4,0)
.4
"BLD",5704,"KRN",.401,0)
.401
"BLD",5704,"KRN",.402,0)
.402
"BLD",5704,"KRN",.403,0)
.403
"BLD",5704,"KRN",.5,0)
.5
"BLD",5704,"KRN",.84,0)
.84
"BLD",5704,"KRN",3.6,0)
3.6
"BLD",5704,"KRN",3.8,0)
3.8
"BLD",5704,"KRN",9.2,0)
9.2
"BLD",5704,"KRN",9.8,0)
9.8
"BLD",5704,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5704,"KRN",9.8,"NM",1,0)
PSJOEA^^0^B30553608
"BLD",5704,"KRN",9.8,"NM","B","PSJOEA",1)

"BLD",5704,"KRN",19,0)
19
"BLD",5704,"KRN",19.1,0)
19.1
"BLD",5704,"KRN",101,0)
101
"BLD",5704,"KRN",409.61,0)
409.61
"BLD",5704,"KRN",771,0)
771
"BLD",5704,"KRN",870,0)
870
"BLD",5704,"KRN",8989.51,0)
8989.51
"BLD",5704,"KRN",8989.52,0)
8989.52
"BLD",5704,"KRN",8994,0)
8994
"BLD",5704,"KRN","B",.4,.4)

"BLD",5704,"KRN","B",.401,.401)

"BLD",5704,"KRN","B",.402,.402)

"BLD",5704,"KRN","B",.403,.403)

"BLD",5704,"KRN","B",.5,.5)

"BLD",5704,"KRN","B",.84,.84)

"BLD",5704,"KRN","B",3.6,3.6)

"BLD",5704,"KRN","B",3.8,3.8)

"BLD",5704,"KRN","B",9.2,9.2)

"BLD",5704,"KRN","B",9.8,9.8)

"BLD",5704,"KRN","B",19,19)

"BLD",5704,"KRN","B",19.1,19.1)

"BLD",5704,"KRN","B",101,101)

"BLD",5704,"KRN","B",409.61,409.61)

"BLD",5704,"KRN","B",771,771)

"BLD",5704,"KRN","B",870,870)

"BLD",5704,"KRN","B",8989.51,8989.51)

"BLD",5704,"KRN","B",8989.52,8989.52)

"BLD",5704,"KRN","B",8994,8994)

"BLD",5704,"QUES",0)
^9.62^^
"BLD",5704,"REQB",0)
^9.611^1^1
"BLD",5704,"REQB",1,0)
PSJ*5.0*133^2
"BLD",5704,"REQB","B","PSJ*5.0*133",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
167^3060208
"PKG",197,22,1,"PAH",1,1,0)
^^12^12^3060208
"PKG",197,22,1,"PAH",1,1,1,0)
 Pending complex orders cannot be verified when the complex order is also
"PKG",197,22,1,"PAH",1,1,2,0)
 an Inpatient Orders for Outpatients (IMO) order. This patch corrects this
"PKG",197,22,1,"PAH",1,1,3,0)
 issue by allowing the verification of complex IMO orders if the IMO
"PKG",197,22,1,"PAH",1,1,4,0)
 functionality is active and the clinic is a valid IMO clinic.
"PKG",197,22,1,"PAH",1,1,5,0)
 
"PKG",197,22,1,"PAH",1,1,6,0)
 Complex Inpatient orders may only be created if the Inpatient Orders for
"PKG",197,22,1,"PAH",1,1,7,0)
 Outpatients (IMO) functionality has been activated.  The same criteria
"PKG",197,22,1,"PAH",1,1,8,0)
 used to determine if a simple IMO order may be selected for finishing in
"PKG",197,22,1,"PAH",1,1,9,0)
 Inpatient Medications will be used for Complex Orders; for instance, if
"PKG",197,22,1,"PAH",1,1,10,0)
 the clinic associated with the order is not a valid IMO clinic, the order
"PKG",197,22,1,"PAH",1,1,11,0)
 may not be finished in Inpatient Medications.
"PKG",197,22,1,"PAH",1,1,12,0)
 HD115420
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJOEA")
0^1^B30553608
"RTN","PSJOEA",1,0)
PSJOEA ;BIR/MLM-INPATIENT ORDER ENTRY ;23 Jun 98 / 1:46 PM
"RTN","PSJOEA",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127,133,167**;16 DEC 97
"RTN","PSJOEA",3,0)
 ;
"RTN","PSJOEA",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSJOEA",5,0)
 ; Reference to EN^VALM is supported by DBIA #10118.
"RTN","PSJOEA",6,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSJOEA",7,0)
 ; Reference to ^DPT is supported by DBIA #10035.
"RTN","PSJOEA",8,0)
 ;
"RTN","PSJOEA",9,0)
LOCK(DFN,PSJORD) ; Check to see if the order is already locked
"RTN","PSJOEA",10,0)
 N Q S Q=0
"RTN","PSJOEA",11,0)
 I PSJORD=+PSJORD N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  S Q=$$LS^PSSLOCK(DFN,PSJO_"P") I 'Q Q
"RTN","PSJOEA",12,0)
 I Q Q 1
"RTN","PSJOEA",13,0)
 Q 0
"RTN","PSJOEA",14,0)
 ;
"RTN","PSJOEA",15,0)
SELECT ;
"RTN","PSJOEA",16,0)
 N PSJCLIN,O
"RTN","PSJOEA",17,0)
 Q:PSJORD=""!($G(Y)<0)  Q:('$$LOCK^PSJOEA(PSGP,PSJORD))
"RTN","PSJOEA",18,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",19,0)
 .S PSGORD="" S ON=PSJO_"P"
"RTN","PSJOEA",20,0)
 .D DISACTIO(PSGP,PSJO_"P",$G(PSJPNV)) S:$G(PSJO)["V" O=ON
"RTN","PSJOEA",21,0)
 I $D(^TMP("PSJCOM",$J)) D CHK^PSJOEA1
"RTN","PSJOEA",22,0)
 S:'$G(PSGP) PSGP=$G(DFN)
"RTN","PSJOEA",23,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",PSJORD,PSJO)) Q:'PSJO  D
"RTN","PSJOEA",24,0)
 .D UNL^PSSLOCK(PSGP,PSJO_"P") Q:$G(Y)<0
"RTN","PSJOEA",25,0)
 D DONE
"RTN","PSJOEA",26,0)
 Q
"RTN","PSJOEA",27,0)
 ;
"RTN","PSJOEA",28,0)
DISACTIO(DFN,PSJORD,PSJPNV)       ; Display UD order and allow actions.
"RTN","PSJOEA",29,0)
 ; DFN    - Patient IEN
"RTN","PSJOEA",30,0)
 ; PSJORD - Order #_location Code (P:53.1,V:55.01,U:55.06)
"RTN","PSJOEA",31,0)
 ; PSJPNV - Invoked from Pending/NV option; (gets different hidden menu)
"RTN","PSJOEA",32,0)
 N PSGP,PSJIVFLG,PSGSDX,PSGFDX,PSJXX1,ON55,PSJAPPT
"RTN","PSJOEA",33,0)
 Q:PSJORD'["P"
"RTN","PSJOEA",34,0)
 Q:$G(PSJCLIN)=-2
"RTN","PSJOEA",35,0)
 S PSGP=DFN D ENIV^PSJAC
"RTN","PSJOEA",36,0)
 D GETUD^PSJLMGUD(DFN,PSJORD)
"RTN","PSJOEA",37,0)
 S PSGOEAV=$P(PSJSYSP0,"^",9)&PSJSYSU
"RTN","PSJOEA",38,0)
 S:$G(PSJTUD) PSGPD=$G(PSJCOI),PSGPDN=$$OINAME^PSJLMUTL(+PSGPD)
"RTN","PSJOEA",39,0)
 K PSGOENG I '$D(PSGPRF) D  Q:$G(PSGOENG)
"RTN","PSJOEA",40,0)
 . I PSJORD["P" L +^PS(53.1,+PSJORD):1 E  S PSGOENG=1
"RTN","PSJOEA",41,0)
 . I $G(PSGOENG) W !,"This order is being edited by another terminal.",! S PSGOENG=1 K DIR S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSJOEA",42,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD)
"RTN","PSJOEA",43,0)
 I PSJORD["P" S PSJXX1=$G(^PS(53.1,+PSJORD,0)) I PSGP'=$P(PSJXX1,U,15)!(DFN'=$P(PSJXX1,U,15)) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",44,0)
 I PSJORD["P" D  S PSJXX1=$P($G(^PS(53.1,+PSJORD,0)),U,9) I $S($G(PSJIVFLG):1,$G(Y)<0:1,"PADE"[PSJXX1:1,1:0) Q  ;L -^PS(53.1,+PSJORD) Q
"RTN","PSJOEA",45,0)
 .I $P(PSJXX1,U,9)="N",($P(PSJXX1,U,4)'="U") D  Q
"RTN","PSJOEA",46,0)
 .. S P("PON")=PSJORD,PSIVFLG=1
"RTN","PSJOEA",47,0)
 .. D GT531^PSIVORFA(+PSGP,PSJORD),VF^PSIVORC2
"RTN","PSJOEA",48,0)
 .I $P(PSJXX1,U,9)="P" D  Q
"RTN","PSJOEA",49,0)
 ..S:$G(PSJTUD) $P(PSJXX1,U,4)="U"
"RTN","PSJOEA",50,0)
 ..N VAIP S PSJCLIN=$G(^PS(53.1,+PSJORD,"DSS")),PSJAPPT=$P(PSJCLIN,"^",2),PSJCLIN=$P(PSJCLIN,"^")
"RTN","PSJOEA",51,0)
 ..I $P(PSJXX1,U,4)="U",(+PSJPDD) D  Q:(PSJCLIN=-2)
"RTN","PSJOEA",52,0)
 ...I $$PATCH^XPDUTL("SD*5.3*285"),($$SDIMO^SDAMA203(PSJCLIN,DFN)>-1) Q
"RTN","PSJOEA",53,0)
 ...W !!,"Cannot process an Out-patient Unit Dose order for ",$P($G(^DPT(+PSGP,0)),U) D PAUSE^VALM1 S PSJIVFLG=1,PSJCLIN=-2
"RTN","PSJOEA",54,0)
 ..NEW PSGRSD,PSGRSDN,PSGRFD,PSGRFDN
"RTN","PSJOEA",55,0)
 ..D REQDT^PSJLIVMD(PSJORD)
"RTN","PSJOEA",56,0)
 ..I $P(PSJXX1,U,4)="U",($G(PSGSCH)="") W !!,"Invalid schedule, can't finish this order" D PAUSE^VALM1 Q
"RTN","PSJOEA",57,0)
 ..I $P(PSJXX1,U,4)="U" N PSJLM S PSJLM=1,PSGORD=PSJORD D START^PSGOEF,ENSFE^PSGOEE0(PSGP,PSGORD),@$S($G(PSJTUD):"FINISH^PSGOEF",1:"EN^VALM(""PSJ LM PENDING EDIT"")") Q
"RTN","PSJOEA",58,0)
 ..I $P(PSJXX1,U,4)'="U",PSGP=$P(PSJXX1,U,15),DFN=$P(PSJXX1,U,15) S PSJLYN=PSJORD D EN^PSJLIFN S PSJIVFLG=1 K PSJLYN,PSJMAI
"RTN","PSJOEA",59,0)
 I $G(PSIVFLG) K PSIVFLG Q
"RTN","PSJOEA",60,0)
 S PSGACT=$$ENACTION^PSGOE1(PSGP,PSJORD),PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSJORD),ENSFE^PSGOEE0(PSGP,PSJORD),EN^VALM("PSJ LM UD ACTION")
"RTN","PSJOEA",61,0)
 ;I PSJORD["P" L -^PS(53.1,+PSJORD)
"RTN","PSJOEA",62,0)
 ;I PSJORD["U" L -^PS(55,PSGP,5,+PSJORD)
"RTN","PSJOEA",63,0)
 ;Send SN to CPRS if autoverify OFF and Order Set Entry and no 21st piece
"RTN","PSJOEA",64,0)
 I $D(PSGOES),'PSGOEAV,$D(PSGORD),PSGORD["P",$P($G(^PS(53.1,+PSGORD,0)),"^",21)']"" D ORSET^PSGOETO1
"RTN","PSJOEA",65,0)
 ;D UNL^PSSLOCK(PSGP,PSJORD)
"RTN","PSJOEA",66,0)
 Q
"RTN","PSJOEA",67,0)
 ;
"RTN","PSJOEA",68,0)
ACTLOG(PSGORDP,DFN,PSGORD)  ;Store 53.1 activity log in local array to be moved to 55
"RTN","PSJOEA",69,0)
 ;PSGORDP: IEN from 53.1
"RTN","PSJOEA",70,0)
 ;PSGORD : IEN from 55
"RTN","PSJOEA",71,0)
 NEW PSGX,PSGXDA,PSGAL531,Q,QQ
"RTN","PSJOEA",72,0)
 F PSGX=0:0 S PSGX=$O(^PS(53.1,+PSGORDP,"A",PSGX)) Q:'PSGX  D
"RTN","PSJOEA",73,0)
 . S PSGAL531=$G(^PS(53.1,+PSGORDP,"A",PSGX,0))
"RTN","PSJOEA",74,0)
 . S QQ=$G(^PS(55,DFN,5,+PSGORD,9,0)) S:QQ="" QQ="^55,09D" F Q=$P(QQ,U,3)+1:1 I '$D(^(Q)) S $P(QQ,U,3,4)=Q_U_Q,^(0)=QQ,PSGXDA=Q Q
"RTN","PSJOEA",75,0)
 . S ^PS(55,DFN,5,+PSGORD,9,PSGXDA,0)=PSGAL531
"RTN","PSJOEA",76,0)
 Q
"RTN","PSJOEA",77,0)
 ;
"RTN","PSJOEA",78,0)
UD ;
"RTN","PSJOEA",79,0)
 N DA,DR,DIE,PSJCMPDA D ENGNA^PSGOETO S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=DA_"U",$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=DA,$P(^(0),"^",18)=DA S PSJCMPDA=DA
"RTN","PSJOEA",80,0)
 M ^PS(55,PSGP,5,DA)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S PSJNOO=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,3) D EN1^PSJHL2(PSGP,"SN",+PSJCMPDA_"U")
"RTN","PSJOEA",81,0)
 N PSGPDRG,PSGST,PSGNESD,PSGNEFD,ND2
"RTN","PSJOEA",82,0)
 S PSGPDRG=$P($G(^PS(55,PSGP,5,PSJCMPDA,.2)),"^"),PSGST=$P($G(^PS(55,PSGP,5,PSJCMPDA,0)),"^",7)
"RTN","PSJOEA",83,0)
 S ND2=$G(^PS(55,PSGP,5,PSJCMPDA,2)),PSGNESD=$P(ND2,"^",2),PSGNEFD=$P(ND2,"^",4) D CRA^PSGOETO
"RTN","PSJOEA",84,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO) K PSJPREX
"RTN","PSJOEA",85,0)
 I $G(PSJCMPDA) D CMPLX2^PSJCOM1(PSGP,PSJORD,+PSJCMPDA_"U") I $G(PSGPXN) S PSJPREX=1
"RTN","PSJOEA",86,0)
 Q
"RTN","PSJOEA",87,0)
IV ; 
"RTN","PSJOEA",88,0)
 K ON55 I $P($G(^PS(53.1,+PSJO,0)),"^",24)="R",$P($G(^PS(53.1,+PSJO,0)),"^",25) S ON55=$P(^PS(53.1,+PSJO,0),"^",25)
"RTN","PSJOEA",89,0)
 I '$G(ON55) D NEW55^PSIVORFB
"RTN","PSJOEA",90,0)
 S $P(^TMP("PSJCOM",$J,PSJO,0),"^",26)=ON55,$P(^TMP("PSJCOM2",$J,PSJO,0),"^")=+ON55
"RTN","PSJOEA",91,0)
 S $P(^TMP("PSJCOM2",$J,PSJO,2),U,5)=PSJO_"P",$P(^TMP("PSJCOM",$J,PSJO,0),U,26)=ON55
"RTN","PSJOEA",92,0)
 M ^PS(55,DFN,"IV",+ON55)=^TMP("PSJCOM2",$J,+PSJO) M ^PS(53.1,+PSJO)=^TMP("PSJCOM",$J,+PSJO) D EN1^PSJHL2(PSGP,"OD",+PSJO_"P") S P("NAT")=$P(^TMP("PSJCOM2",$J,+PSJO,.2),U,5) D EN1^PSJHL2(PSGP,"SN",ON55)
"RTN","PSJOEA",93,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK K DA,DIK
"RTN","PSJOEA",94,0)
 K ^PS(53.1,"ACX",PSJORD,PSJO)
"RTN","PSJOEA",95,0)
 Q
"RTN","PSJOEA",96,0)
 ;
"RTN","PSJOEA",97,0)
DONE ; Clean up
"RTN","PSJOEA",98,0)
 K PSGPD,PSGPDN,PSGSCH,PSIVACT,PSJNOO
"RTN","PSJOEA",99,0)
 Q
"VER")
8.0^22.0
"BLD",5704,6)
^147
**END**
**END**
