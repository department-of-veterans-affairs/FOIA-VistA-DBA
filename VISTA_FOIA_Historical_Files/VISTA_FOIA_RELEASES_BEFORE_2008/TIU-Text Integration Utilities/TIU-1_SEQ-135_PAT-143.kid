Released TIU*1*143 SEQ #135
Extracted from mail message
**KIDS**:TIU*1.0*143^

**INSTALL NAME**
TIU*1.0*143
"BLD",3947,0)
TIU*1.0*143^TEXT INTEGRATION UTILITIES^0^3021219^y
"BLD",3947,1,0)
^^2^2^3021219^^^^
"BLD",3947,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",3947,1,2,0)
under TIU*1*143.
"BLD",3947,4,0)
^9.64PA^^
"BLD",3947,"ABPKG")
n
"BLD",3947,"KRN",0)
^9.67PA^8989.52^19
"BLD",3947,"KRN",.4,0)
.4
"BLD",3947,"KRN",.401,0)
.401
"BLD",3947,"KRN",.402,0)
.402
"BLD",3947,"KRN",.403,0)
.403
"BLD",3947,"KRN",.5,0)
.5
"BLD",3947,"KRN",.84,0)
.84
"BLD",3947,"KRN",3.6,0)
3.6
"BLD",3947,"KRN",3.8,0)
3.8
"BLD",3947,"KRN",9.2,0)
9.2
"BLD",3947,"KRN",9.8,0)
9.8
"BLD",3947,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",3947,"KRN",9.8,"NM",1,0)
TIULA2^^0^B53053546
"BLD",3947,"KRN",9.8,"NM",2,0)
TIUROR^^0^B59196673
"BLD",3947,"KRN",9.8,"NM",3,0)
TIUSRVLL^^0^B50585908
"BLD",3947,"KRN",9.8,"NM","B","TIULA2",1)

"BLD",3947,"KRN",9.8,"NM","B","TIUROR",2)

"BLD",3947,"KRN",9.8,"NM","B","TIUSRVLL",3)

"BLD",3947,"KRN",19,0)
19
"BLD",3947,"KRN",19.1,0)
19.1
"BLD",3947,"KRN",101,0)
101
"BLD",3947,"KRN",409.61,0)
409.61
"BLD",3947,"KRN",771,0)
771
"BLD",3947,"KRN",870,0)
870
"BLD",3947,"KRN",8989.51,0)
8989.51
"BLD",3947,"KRN",8989.52,0)
8989.52
"BLD",3947,"KRN",8994,0)
8994
"BLD",3947,"KRN","B",.4,.4)

"BLD",3947,"KRN","B",.401,.401)

"BLD",3947,"KRN","B",.402,.402)

"BLD",3947,"KRN","B",.403,.403)

"BLD",3947,"KRN","B",.5,.5)

"BLD",3947,"KRN","B",.84,.84)

"BLD",3947,"KRN","B",3.6,3.6)

"BLD",3947,"KRN","B",3.8,3.8)

"BLD",3947,"KRN","B",9.2,9.2)

"BLD",3947,"KRN","B",9.8,9.8)

"BLD",3947,"KRN","B",19,19)

"BLD",3947,"KRN","B",19.1,19.1)

"BLD",3947,"KRN","B",101,101)

"BLD",3947,"KRN","B",409.61,409.61)

"BLD",3947,"KRN","B",771,771)

"BLD",3947,"KRN","B",870,870)

"BLD",3947,"KRN","B",8989.51,8989.51)

"BLD",3947,"KRN","B",8989.52,8989.52)

"BLD",3947,"KRN","B",8994,8994)

"BLD",3947,"QUES",0)
^9.62^^
"BLD",3947,"REQB",0)
^9.611^7^4
"BLD",3947,"REQB",4,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",3947,"REQB",5,0)
TIU*1.0*116^2
"BLD",3947,"REQB",6,0)
TIU*1.0*121^2
"BLD",3947,"REQB",7,0)
TIU*1.0*123^2
"BLD",3947,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",4)

"BLD",3947,"REQB","B","TIU*1.0*116",5)

"BLD",3947,"REQB","B","TIU*1.0*121",6)

"BLD",3947,"REQB","B","TIU*1.0*123",7)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
143^3021219
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3021219
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1*143.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIULA2")
0^1^B53053546
"RTN","TIULA2",1,0)
TIULA2 ; SLC/JER - More interactive functions ;6/13/01
"RTN","TIULA2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,50,86,93,61,100,116,143**;Jun 20, 1997
"RTN","TIULA2",3,0)
ASKTYP(TIUCLASS,DFLT,SCREEN,PROMPT) ; Call ^DIC to select single type
"RTN","TIULA2",4,0)
 N DIC,X,Y,TIUFPRIV,ITMCNT S TIUFPRIV=1
"RTN","TIULA2",5,0)
 S DIC=8925.1,TIUCLASS=$G(TIUCLASS,38),ITMCNT=$$ITMCNT(TIUCLASS)
"RTN","TIULA2",6,0)
 I +ITMCNT=1 D  G ASKTYPX
"RTN","TIULA2",7,0)
 . I $P($G(^TIU(8925.1,+TIUCLASS,0)),U,4)="CL" D  Q
"RTN","TIULA2",8,0)
 . . S TIUCLASS=+$G(^TIU(8925.1,+TIUCLASS,10,+$P(ITMCNT,U,2),0))
"RTN","TIULA2",9,0)
 . . S Y=$$ASKTYP(+TIUCLASS,DFLT,SCREEN,$G(PROMPT))
"RTN","TIULA2",10,0)
 . S DIC(0)="NX",X=+$G(^TIU(8925.1,+TIUCLASS,10,+$P(ITMCNT,U,2),0))
"RTN","TIULA2",11,0)
 . D ^DIC S Y=Y_U_"SINGLE ITEM"
"RTN","TIULA2",12,0)
 S DIC(0)="AEMQZ"
"RTN","TIULA2",13,0)
 S DIC("A")=$S($G(PROMPT)]"":$G(PROMPT),1:"Select TITLE: ")
"RTN","TIULA2",14,0)
 I $G(DFLT)="LAST" S DFLT=$P($$PERSDOC^TIULE(DUZ,+$G(TIUCLASS,38)),U,2)
"RTN","TIULA2",15,0)
 I +$G(DFLT),+$D(TIUCLASS),(+$$ISA^TIULX(+$G(DFLT),+$G(TIUCLASS))'>0) S DFLT=""
"RTN","TIULA2",16,0)
 I $G(DFLT)]"" S DIC("B")=$G(DFLT)
"RTN","TIULA2",17,0)
 I $G(SCREEN)]"" S DIC("S")=SCREEN
"RTN","TIULA2",18,0)
 D ^DIC K DIC("S")
"RTN","TIULA2",19,0)
ASKTYPX Q Y
"RTN","TIULA2",20,0)
ITMCNT(CLASS) ; Count the number of members of a class or document class
"RTN","TIULA2",21,0)
 N TIUI,TIUCNT,TIUY S (TIUI,TIUCNT,TIUY)=0
"RTN","TIULA2",22,0)
 F  S TIUI=$O(^TIU(8925.1,+CLASS,10,TIUI)) Q:+TIUI'>0  D 
"RTN","TIULA2",23,0)
 . I +$$CANPICK^TIULP(+$G(^TIU(8925.1,+CLASS,10,TIUI,0))) D
"RTN","TIULA2",24,0)
 . . S TIUCNT=TIUCNT+1
"RTN","TIULA2",25,0)
 . . S TIUY=TIUCNT_U_TIUI
"RTN","TIULA2",26,0)
 Q TIUY
"RTN","TIULA2",27,0)
DOCPICK(TIUCLASS,DFLT,ADDSCRN) ; Ask for document, given a class or document class
"RTN","TIULA2",28,0)
 N SCREEN,PROMPT S PROMPT=$S(TIUCLASS=3:"TITLE: ",1:"")
"RTN","TIULA2",29,0)
 S SCREEN="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",+$$ISA^TIULX(+Y,TIUCLASS),+$$CANPICK^TIULP(+Y)"_$S($G(ADDSCRN)]"":",",1:"")_$G(ADDSCRN)
"RTN","TIULA2",30,0)
 Q $$ASKTYP(+TIUCLASS,$G(DFLT),SCREEN,PROMPT)
"RTN","TIULA2",31,0)
DOCSPICK(TIUY,TIUCLASS,PARM,DFLT,PROMPT,ADDSCRN) ; Ask for TITLE(S)
"RTN","TIULA2",32,0)
 ; with pick-list
"RTN","TIULA2",33,0)
 N SCREEN,Y,ATTCHID
"RTN","TIULA2",34,0)
 S DFLT=$S($G(DFLT)=0:"",$G(DFLT)]"":$G(DFLT),1:"LAST")
"RTN","TIULA2",35,0)
 S PARM=$S($G(PARM)]"":PARM,1:"A")
"RTN","TIULA2",36,0)
 ; D DOCLIST^TIULA1(TIUCLASS,.TIUY,PARM,DFLT) I +TIUY>0 Q
"RTN","TIULA2",37,0)
 ; ADD CALL TO PERSONAL DOCUMENT LISTER HERE
"RTN","TIULA2",38,0)
 S ATTCHID=0 I $G(ADDSCRN)["CANLINK^TIULP" S ATTCHID=1
"RTN","TIULA2",39,0)
 I PARM="1A" D TITLPICK^TIULA4(.TIUY,TIUCLASS,ATTCHID) I +$G(TIUY)>0 Q
"RTN","TIULA2",40,0)
 S PROMPT=$S($G(PROMPT)]"":$G(PROMPT),TIUCLASS=3:"TITLE: ",1:"")
"RTN","TIULA2",41,0)
 S SCREEN="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",($P(^(0),U)'[""ADDENDUM""),+$$ISA^TIULX(+Y,TIUCLASS)"_$S($G(ADDSCRN)]"":",",1:"")_$G(ADDSCRN)
"RTN","TIULA2",42,0)
 I $G(TIUY("NODFLT")) S DFLT="" ; User selected "Other title"
"RTN","TIULA2",43,0)
 S TIUY=$$ASKTYP(+TIUCLASS,$G(DFLT),SCREEN,PROMPT)
"RTN","TIULA2",44,0)
 I +TIUY>0 S TIUY(1)=1_U_TIUY,TIUY=1
"RTN","TIULA2",45,0)
 Q
"RTN","TIULA2",46,0)
SELPAT(TIURTN,TIUTYP,DFN,TIUASK) ; Select a patient's document
"RTN","TIULA2",47,0)
 N TIUI,TIUQRY,TIUREC,TIUEDT,TIULDT,TIUPRMT,TIUA,TIUZ,TIUTOT,TIUSTOP
"RTN","TIULA2",48,0)
 N TIULAST,TIULIST,TIUJ,TIUY,TIUPNOUN,TIUSMPL,TIUTMP,TIUEDFLT,TIUCONT
"RTN","TIULA2",49,0)
 K ^TMP("TIULIST",$J),^TMP("TIULIDX",$J)
"RTN","TIULA2",50,0)
 K ^TMP("TIUYLIST",$J) ; TIU*1.0*143
"RTN","TIULA2",51,0)
 S TIUTYP=$G(TIUTYP,38)
"RTN","TIULA2",52,0)
 S TIUPNOUN=$S(TIUTYP=3:"notes",TIUTYP=244:"summaries",1:"documents")
"RTN","TIULA2",53,0)
 I '+$G(DFN) S DFN=+$$PATIENT^TIULA Q:+DFN'>0
"RTN","TIULA2",54,0)
 I +$O(^TIU(8925,"APTCL",+DFN,+TIUTYP,0))'>0 D  Q
"RTN","TIULA2",55,0)
 . W !!,"No ",TIUPNOUN," on file for ",$P(^DPT(+DFN,0),U)
"RTN","TIULA2",56,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIULA2",57,0)
 S TIUSMPL=$$SAMPLE(DFN,TIUTYP)
"RTN","TIULA2",58,0)
 I +TIUSMPL'>0 D  Q
"RTN","TIULA2",59,0)
 . W !!,"No ",TIUPNOUN," available for ",$P(^DPT(+DFN,0),U),!
"RTN","TIULA2",60,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIULA2",61,0)
 S TIUTOT=+$P(TIUSMPL,U)
"RTN","TIULA2",62,0)
 S TIUEDT=+$P(TIUSMPL,U,2)_U_$$DATE^TIULS(+$P(TIUSMPL,U,2),"MM/DD/CCYY")
"RTN","TIULA2",63,0)
 S TIULDT=+$P(TIUSMPL,U,3)_U_$$DATE^TIULS(+$P(TIUSMPL,U,3),"MM/DD/CCYY")
"RTN","TIULA2",64,0)
 W !!,"Available ",TIUPNOUN,":  ",$P(TIUEDT,U,2)
"RTN","TIULA2",65,0)
 W " thru ",$P(TIULDT,U,2),"  (",TIUTOT,")"
"RTN","TIULA2",66,0)
 I +$G(TIUASK)>0 D  Q:+$G(TIUCONT)'>0
"RTN","TIULA2",67,0)
 . N TIUPRMT S TIUPRMT="Do you wish to see any of these notes"
"RTN","TIULA2",68,0)
 . S TIUCONT=+$$READ^TIUU("YO",TIUPRMT,"NO")
"RTN","TIULA2",69,0)
 I +TIUTOT=1,+$P(TIUSMPL,U,4) S TIURTN=1,TIURTN(1)=+$P(TIUSMPL,U,4) Q
"RTN","TIULA2",70,0)
 W !!,"Please specify a date range from which to select ",TIUPNOUN_":"
"RTN","TIULA2",71,0)
 S TIUPRMT="List "_TIUPNOUN_" Beginning: "
"RTN","TIULA2",72,0)
 S TIUEDFLT=$P(TIUEDT,U)
"RTN","TIULA2",73,0)
 I +TIUEDFLT<+$P(TIUEDT,U) S TIUEDFLT=$P(TIUEDT,U,2)
"RTN","TIULA2",74,0)
 I TIUEDFLT'["/" S TIUEDFLT=$$DATE^TIULS(TIUEDFLT,"MM/DD/CCYY")
"RTN","TIULA2",75,0)
 S TIUA=+$$READ^TIUU("DA^"_+$P(TIUEDT,".")_":"_+TIULDT_":E",TIUPRMT,TIUEDFLT)
"RTN","TIULA2",76,0)
 I +$D(DIRUT)!(TIUA'>0) Q
"RTN","TIULA2",77,0)
 S TIUPRMT=$J("Thru: ",$L(TIUPRMT))
"RTN","TIULA2",78,0)
 S TIUZ=+$$READ^TIUU("DA^"_+$P(TIUEDT,".")_":"_+TIULDT_":E",TIUPRMT,$P(TIULDT,U,2))_".2401" W !
"RTN","TIULA2",79,0)
 I +$D(DIRUT)!(TIUA'>0) Q
"RTN","TIULA2",80,0)
 I +TIUA>TIUZ S TIUTMP=TIUA,TIUA=TIUZ,TIUZ=TIUTMP
"RTN","TIULA2",81,0)
 ; ZDEBUG ON B 1
"RTN","TIULA2",82,0)
 D LIST^TIUSRVLL(.TIUY,TIUTYP,DFN,TIUA,TIUZ)
"RTN","TIULA2",83,0)
 I $D(^TMP("TIUYLIST",$J))>9 D  ; I $D(TIUY)>9 - modified TIU*1.0*143
"RTN","TIULA2",84,0)
 . ; S TIUI=0 F  S TIUI=$O(TIUY(TIUI)) Q:+TIUI'>0!(+$G(TIUSTOP)>0)  D ; - modified TIU*1.0*143
"RTN","TIULA2",85,0)
 . S TIUI=0 F  S TIUI=$O(^TMP("TIUYLIST",$J,TIUI)) Q:+TIUI'>0!(+$G(TIUSTOP)>0)  D
"RTN","TIULA2",86,0)
 . . N TIUD0,TIUD13,TIUD12,TIUD17,TIUDOC,PREFIX
"RTN","TIULA2",87,0)
 . . ; S TIUD0=$G(^TIU(8925,+TIUY(TIUI),0)),TIUD12=$G(^(12)) ; - modified TIU*1.0*143
"RTN","TIULA2",88,0)
 . . S TIUD0=$G(^TIU(8925,+^TMP("TIUYLIST",$J,TIUI),0)),TIUD12=$G(^(12))
"RTN","TIULA2",89,0)
 . . ; S TIUD13=$G(^TIU(8925,+TIUY(TIUI),13)),TIUD17=$G(^(17)),TIULAST=TIUI ; - modified TIU*1.0*143
"RTN","TIULA2",90,0)
 . . S TIUD13=$G(^TIU(8925,+^TMP("TIUYLIST",$J,TIUI),13)),TIUD17=$G(^(17)),TIULAST=TIUI
"RTN","TIULA2",91,0)
 . . S TIUDOC=$E($$PNAME^TIULC1(+TIUD0),1,36)
"RTN","TIULA2",92,0)
 . . I TIUDOC="Addendum" S TIUDOC=TIUDOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIULA2",93,0)
 . . ; S PREFIX=$$PREFIX(+TIUY(TIUI),1),TIUDOC=PREFIX_TIUDOC ; - modified TIU*1.0*143
"RTN","TIULA2",94,0)
 . . S PREFIX=$$PREFIX(+^TMP("TIUYLIST",$J,TIUI),1),TIUDOC=PREFIX_TIUDOC
"RTN","TIULA2",95,0)
 . . I +$P(TIUD0,U,5)=15 S TIUDOC=TIUDOC_" (RETRACTED)"
"RTN","TIULA2",96,0)
 . . W !,TIUI,?4,$$DATE^TIULS(+TIUD13,"MM/DD/CCYY HR:MIN")
"RTN","TIULA2",97,0)
 . . W ?22,TIUDOC
"RTN","TIULA2",98,0)
 . . W ?60,$E($$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI"),1,19)
"RTN","TIULA2",99,0)
 . . W !?$S($P(TIUD0,U,13)="H":24,1:22),$S($P(TIUD0,U,13)="H":"Adm: ",1:"Visit: "),$$DATE^TIULS($P(TIUD0,U,7),"MM/DD/CCYY")
"RTN","TIULA2",100,0)
 . . I $P(TIUD0,U,13)="H" W ?41,"Dis: ",$$DATE^TIULS($P(TIUD0,U,8),"MM/DD/CCYY")
"RTN","TIULA2",101,0)
 . . I $L(TIUD17) W !,"SUBJECT: ",$E(TIUD17,1,70)
"RTN","TIULA2",102,0)
 . . I '(TIUI#5),(TIUI<+$P(TIUY,U)) D CHOOSE(.TIUSTOP,"   '^' TO STOP: ",1,TIUI,1)
"RTN","TIULA2",103,0)
 . ; I +TIUY=1 S TIURTN(1)=+TIUY(1) D  Q  ; - modified TIU*1.0*143
"RTN","TIULA2",104,0)
 . I +TIUY=1 S TIURTN(1)=+^TMP("TIUYLIST",$J,1) D  Q
"RTN","TIULA2",105,0)
 . . W !!,"One ",$S(TIUTYP=3:"note",TIUTYP=244:"summary",1:"document")
"RTN","TIULA2",106,0)
 . . W " found within date range..." H 1
"RTN","TIULA2",107,0)
 . I +$G(TIUSTOP)>0,(+$G(TIUSTOP)'=9999999) M TIULIST=TIUSTOP
"RTN","TIULA2",108,0)
 . E  D CHOOSE(.TIULIST,"Choose one or more "_TIUPNOUN_":  (1-"_+$G(TIULAST)_"): ",1,+$G(TIULAST))
"RTN","TIULA2",109,0)
 . N TIUK
"RTN","TIULA2",110,0)
 . S TIUK="",TIURTN=0
"RTN","TIULA2",111,0)
 . F  S TIUK=$O(TIULIST(TIUK)) Q:TIUK=""  D
"RTN","TIULA2",112,0)
 . . F TIUI=1:1:$L(TIULIST(TIUK),",") D
"RTN","TIULA2",113,0)
 . . . S TIUJ=$P(TIULIST,",",TIUI)
"RTN","TIULA2",114,0)
 . . . ; I +TIUJ>0,+$G(^TIU(8925,+$G(TIUY(+TIUJ)),0)) S TIURTN(TIUI)=+$G(TIUY(+TIUJ)),TIURTN=TIURTN+1 ; - modified TIU*1.0*143
"RTN","TIULA2",115,0)
 . . . I +TIUJ>0,+$G(^TIU(8925,+$G(^TMP("TIUYLIST",$J,+TIUJ)),0)) S TIURTN(TIUI)=+$G(^TMP("TIUYLIST",$J,+TIUJ)),TIURTN=TIURTN+1
"RTN","TIULA2",116,0)
 K ^TMP("TIUYLIST",$J) ; TIU*1.0*143
"RTN","TIULA2",117,0)
 Q
"RTN","TIULA2",118,0)
 ;
"RTN","TIULA2",119,0)
PREFIX(DA,IDKID) ; Return addendum, urgency, ID indicators.
"RTN","TIULA2",120,0)
 ; I $G(IDKID)=1, include '>' if note is ID kid.
"RTN","TIULA2",121,0)
 N PREFIX,IDKIDFLG
"RTN","TIULA2",122,0)
 S PREFIX=""
"RTN","TIULA2",123,0)
 S IDKIDFLG=1 ; check ID kids too for addenda
"RTN","TIULA2",124,0)
 I $$HASIDKID^TIUGBR(DA) S PREFIX="<"_PREFIX
"RTN","TIULA2",125,0)
 I $G(IDKID),$$HASIDDAD^TIUGBR(DA) S PREFIX=">"_PREFIX
"RTN","TIULA2",126,0)
 I $$HASADDEN^TIULC1(DA,IDKIDFLG) S PREFIX="+"_PREFIX
"RTN","TIULA2",127,0)
 I +$$URGENCY^TIURM(DA)=1 S PREFIX="*"_PREFIX
"RTN","TIULA2",128,0)
 I $L(PREFIX) S PREFIX=PREFIX_" "
"RTN","TIULA2",129,0)
 Q PREFIX
"RTN","TIULA2",130,0)
 ;
"RTN","TIULA2",131,0)
SAMPLE(DFN,CLASS) ; Quick sample for range and count
"RTN","TIULA2",132,0)
 N EARLY,LATE,TOTAL,TIUI,TIUJ,TIUL,TIUY,TIULDA
"RTN","TIULA2",133,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULA2",134,0)
 S (TIUI,TIUL,TIULDA,LATE,EARLY,TOTAL)=0
"RTN","TIULA2",135,0)
 F  S TIUI=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI)) Q:+TIUI'>0  D
"RTN","TIULA2",136,0)
 . S TIUJ=0
"RTN","TIULA2",137,0)
 . F  S TIUJ=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI,TIUJ)) Q:+TIUJ'>0  D
"RTN","TIULA2",138,0)
 . . I ($P(TIUPRM0,U,6)="S"),(+$$CANDO^TIULP(TIUJ,"VIEW")'>0) Q
"RTN","TIULA2",139,0)
 . . I +$G(^TIU(8925,+TIUJ,0))=81!'$D(^TIU(8925,+TIUJ,0)) Q
"RTN","TIULA2",140,0)
 . . S:'LATE LATE=9999999-TIUI
"RTN","TIULA2",141,0)
 . . S TIUL=TIUI,TOTAL=TOTAL+1,TIULDA=TIUJ
"RTN","TIULA2",142,0)
 S:+TIUL EARLY=9999999-TIUL
"RTN","TIULA2",143,0)
 S TIUY=TOTAL_U_EARLY_U_LATE
"RTN","TIULA2",144,0)
 S:TOTAL=1 TIUY=TIUY_U_TIULDA
"RTN","TIULA2",145,0)
 Q TIUY
"RTN","TIULA2",146,0)
CHOOSE(Y,PROMPT,LO,HI,PAUSE) ; Call reader for pause or list selection
"RTN","TIULA2",147,0)
 N DIR,DIRUT,DUOUT,DTOUT,X
"RTN","TIULA2",148,0)
 S DIR(0)="LOA^"_LO_":"_HI
"RTN","TIULA2",149,0)
 S DIR("A")=PROMPT
"RTN","TIULA2",150,0)
 D ^DIR
"RTN","TIULA2",151,0)
 I +$G(PAUSE),(Y="^")!$D(DUOUT)!$D(DIROUT)!$D(DTOUT) S Y=9999999
"RTN","TIULA2",152,0)
 ; B 1
"RTN","TIULA2",153,0)
 Q
"RTN","TIULA2",154,0)
AUTHOR(TERMOK) ; Get author
"RTN","TIULA2",155,0)
 N TIUY,TIURTYP,TIUPRMT,TIUSCRN,DFLT S TERMOK=+$G(TERMOK)
"RTN","TIULA2",156,0)
 S:+$$ISA^USRLM(DUZ,"PROVIDER")!+$$ISA^USRLM(DUZ,"STUDENT") DFLT=$$PERSNAME^TIULC1(DUZ)
"RTN","TIULA2",157,0)
 S TIURTYP="P^200:AEMQZ",TIUPRMT="Select AUTHOR"
"RTN","TIULA2",158,0)
 S TIUSCRN="I $S(+TERMOK:1,1:'+$$ISTERM^USRLM(+Y))"
"RTN","TIULA2",159,0)
 S TIUY=$$READ^TIUU(TIURTYP,TIUPRMT,$G(DFLT),"",TIUSCRN)
"RTN","TIULA2",160,0)
 Q TIUY
"RTN","TIUROR")
0^2^B59196673
"RTN","TIUROR",1,0)
TIUROR ;SLC/JER - New PATIENT Review screen ; 9/5/01
"RTN","TIUROR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**10,86,88,100,123,143**;Jun 20, 1997
"RTN","TIUROR",3,0)
 ; Split rtn into TIUROR & TIUROR1 11/27/00
"RTN","TIUROR",4,0)
EN ; -- main entry point for TIU OE/RR REVIEW PN
"RTN","TIUROR",5,0)
 D EN^VALM("TIU OE/RR REVIEW PN")
"RTN","TIUROR",6,0)
 Q
"RTN","TIUROR",7,0)
 ;
"RTN","TIUROR",8,0)
HDR ; -- header code
"RTN","TIUROR",9,0)
 N TIUCTXT,TIUPNM,TIUSSN,TIULOC,TIUDOB,TIUHDR,TIUCWAD,TIUDCNT,VADM,VA
"RTN","TIUROR",10,0)
 N TIUDFN I +$D(@VALMAR@(0))'>0 S VALMQUIT=1 Q
"RTN","TIUROR",11,0)
 S TIUDFN=+$G(@VALMAR@("DFN"))
"RTN","TIUROR",12,0)
 S TIUCWAD=$$CWAD^GMRPNOR1(TIUDFN) S:TIUCWAD]"" TIUCWAD="<"_TIUCWAD_">"
"RTN","TIUROR",13,0)
 S TIUDCNT=$J($S($G(@VALMAR@("CTXT"))="INIT":"Last ",1:"")_+@VALMAR@(0)_" note(s)",16)
"RTN","TIUROR",14,0)
 S TIUCTXT=$$UP^XLFSTR($$PNAME^TIULC1(@VALMAR@("CLASS")))
"RTN","TIUROR",15,0)
 S TIUCTXT=$$TITLE^TIUU(TIUCTXT)
"RTN","TIUROR",16,0)
 S TIUHDR=$$SETSTR^VALM1(TIUCWAD,$G(TIUHDR),1,20)
"RTN","TIUROR",17,0)
 S TIUHDR=$$SETSTR^VALM1(TIUCTXT,$G(TIUHDR),27,28)
"RTN","TIUROR",18,0)
 S TIUHDR=$$SETSTR^VALM1(TIUDCNT,$G(TIUHDR),64,16)
"RTN","TIUROR",19,0)
 S VALMHDR(1)=TIUHDR,TIUHDR=""
"RTN","TIUROR",20,0)
 S TIUPNM=$$NAME^TIULO(TIUDFN),TIUSSN=$$SSN^TIULO(TIUDFN)
"RTN","TIUROR",21,0)
 S TIUDOB=$$DOB^TIULO(TIUDFN)_" ("_$$AGE^TIULO(TIUDFN)_")"
"RTN","TIUROR",22,0)
 S TIULOC=$G(^DPT(+TIUDFN,.1))
"RTN","TIUROR",23,0)
 S:TIULOC]"" TIULOC=TIULOC_"/"_$G(^DPT(+TIUDFN,.101))
"RTN","TIUROR",24,0)
 S TIUHDR=$$SETSTR^VALM1(TIUPNM,$G(TIUHDR),1,20)
"RTN","TIUROR",25,0)
 S TIUHDR=$$SETSTR^VALM1(TIUSSN,$G(TIUHDR),22,11)
"RTN","TIUROR",26,0)
 S TIUHDR=$$SETSTR^VALM1(TIULOC,$G(TIUHDR),35,20)
"RTN","TIUROR",27,0)
 S TIUHDR=$$SETSTR^VALM1(TIUDOB,$G(TIUHDR),64,16)
"RTN","TIUROR",28,0)
 S VALMHDR(2)=TIUHDR
"RTN","TIUROR",29,0)
 Q
"RTN","TIUROR",30,0)
 ;
"RTN","TIUROR",31,0)
INIT(CLASS,CONTEXT,DFN,TIUOCC) ; -- init variables and list array
"RTN","TIUROR",32,0)
 N TIUR,TIUI,TIUY,TIUPICK,TIUQUIT,TIUCCTXT,TIUDUZ,TIUERLY,TIULATE
"RTN","TIUROR",33,0)
 N TIUPREF,TIUOCTXT,TIURCTXT,TIUSEQ,TIUDPRM
"RTN","TIUROR",34,0)
 N DUOUT,DTOUT,DIROUT ;1/8/01
"RTN","TIUROR",35,0)
 I $G(@VALMAR@("SEQ"))]"" S TIUSEQ=$G(@VALMAR@("SEQ"))
"RTN","TIUROR",36,0)
 I +$G(@VALMAR@("CTXT")) S TIURCTXT=$G(@VALMAR@("CTXT"))
"RTN","TIUROR",37,0)
 K @VALMAR,VALMCNT,^TMP("TIURIDX",$J)
"RTN","TIUROR",38,0)
 K ^TMP("TIUYARRAY",$J) ; TIU*1.0*143
"RTN","TIUROR",39,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUROR",40,0)
 S TIUSEQ=$G(TIUSEQ,$S($P(TIUPREF,U,4)="A":"A",1:"D"))
"RTN","TIUROR",41,0)
 S TIUPICK=+$O(^ORD(101,"B","TIU ACTION SELECT LIST ELEMENT",0))
"RTN","TIUROR",42,0)
 S DFN=$S(+$G(DFN):+$G(DFN),+$G(ORVP):+$G(ORVP),1:+$$PATIENT^TIULA)
"RTN","TIUROR",43,0)
 I $S($D(DUOUT):1,$D(DTOUT):1,$D(DIROUT):1,+$G(DFN)'>0:1,1:0) S VALMQUIT=1 Q
"RTN","TIUROR",44,0)
 I +$G(CONTEXT)'=9999,'+$G(TIUOCC) S TIUOCC=$S(+$P(TIUPREF,U,10):+$P(TIUPREF,U,10),1:100)
"RTN","TIUROR",45,0)
 S ^TMP("TIUR",$J,"RTN")="TIUROR"
"RTN","TIUROR",46,0)
 I '$O(^TIU(8925,"ACLPT",CLASS,DFN,0)),'$O(^TIU(8925,"ACLAU",CLASS,DUZ,DFN,0)),'$O(^TIU(8925,"ACLEC",CLASS,DUZ,DFN,0)) D  Q:$G(CONTEXT)'=9999
"RTN","TIUROR",47,0)
 . N TIUST
"RTN","TIUROR",48,0)
 . S TIUST=$S(CONTEXT=2:"UNSIGNED ",CONTEXT=3:"UNCOSIGNED ",1:"SIGNED ")
"RTN","TIUROR",49,0)
 . S VALMCNT=2,^TMP("TIUR",$J,0)=0
"RTN","TIUROR",50,0)
 . S ^TMP("TIUR",$J,1,0)=""
"RTN","TIUROR",51,0)
 . S ^TMP("TIUR",$J,2,0)="No "_TIUST_$$UP^XLFSTR($$PNAME^TIULC1(CLASS))_" Available for "_$$PTNAME^TIULC1(DFN)
"RTN","TIUROR",52,0)
 . S TIUOCTXT=CONTEXT
"RTN","TIUROR",53,0)
 . I CONTEXT=4 S TIUOCTXT=TIUOCTXT_U_TIUDUZ
"RTN","TIUROR",54,0)
 . I CONTEXT=5 S TIUOCTXT=TIUOCTXT_U_+TIUERLY_U_+TIULATE
"RTN","TIUROR",55,0)
 . S ^TMP("TIUR",$J,"SEQ")=$G(TIUSEQ)
"RTN","TIUROR",56,0)
 . S ^TMP("TIUR",$J,"CLASS")=CLASS,^("DFN")=DFN,^("CTXT")=TIUOCTXT D HDR
"RTN","TIUROR",57,0)
 I $G(CONTEXT)=9999 S TIUCCTXT=1,TIUOCC=9999999
"RTN","TIUROR",58,0)
 ; -- Set vars needed for RBLD if user ^s:
"RTN","TIUROR",59,0)
 S ^TMP("TIUR",$J,"CLASS")=CLASS,^("DFN")=DFN,^("OCC")=TIUOCC,^("CTXT")=+$G(TIURCTXT)
"RTN","TIUROR",60,0)
 S CONTEXT=$S($G(CONTEXT)=9999:$$ASKCTXT^TIUROR1,+$G(CONTEXT):+$G(CONTEXT),1:1)
"RTN","TIUROR",61,0)
 ; -- 1=Signed 2=Unsigned 3=Uncosigned 4=Signed/Author 5=Signed/Date --
"RTN","TIUROR",62,0)
 I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) D RBLD Q
"RTN","TIUROR",63,0)
 I $S(CONTEXT=1:1,CONTEXT=2:1,CONTEXT=3:1,1:0) S TIUERLY="",TIULATE="",TIUDUZ=DUZ
"RTN","TIUROR",64,0)
 I CONTEXT=4 D  Q:+$G(TIUQUIT)>0
"RTN","TIUROR",65,0)
 . S TIUERLY="",TIULATE=""
"RTN","TIUROR",66,0)
 . S TIUDUZ=$S(+$G(TIURCTXT)'=4:+$$AUTHOR^TIULA2(1),+$P(TIURCTXT,U,2)'>0:+$$AUTHOR^TIULA2(1),+$G(TIUCCTXT):+$$AUTHOR^TIULA2(1),1:+$P(TIURCTXT,U,2))
"RTN","TIUROR",67,0)
 . I $S($D(DUOUT):1,$D(DTOUT):1,$D(DIROUT):1,+$G(TIUDUZ)'>0:1,1:0) S TIUQUIT=1 D RBLD Q  ; changed DIRUT to DTOUT. 10/20/00
"RTN","TIUROR",68,0)
 . S TIUSEQ=$S(+$G(TIUCCTXT):$P($$ASKSEQ^TIULA3(TIUSEQ),U),$G(TIUSEQ)']"":$P($$ASKSEQ^TIULA3(TIUSEQ),U),1:$G(TIUSEQ))
"RTN","TIUROR",69,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 D RBLD
"RTN","TIUROR",70,0)
 I CONTEXT=5 D  Q:+$G(TIUQUIT)>0
"RTN","TIUROR",71,0)
 . S TIUDUZ=+$G(DUZ)
"RTN","TIUROR",72,0)
 . S TIUERLY=$S(+$G(TIURCTXT)'=5:$$EDATE^TIULA("",7,""),+$P(TIURCTXT,U,2)'>0:$$EDATE^TIULA("",7,""),+$G(TIUCCTXT):$$EDATE^TIULA("",7,""),1:+$P(TIURCTXT,U,2))
"RTN","TIUROR",73,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 D RBLD Q
"RTN","TIUROR",74,0)
 . S TIUERLY=$P(TIUERLY,U)
"RTN","TIUROR",75,0)
 . S TIULATE=$S(+$G(TIURCTXT)'=5:$$LDATE^TIULA("",7,""),+$P(TIURCTXT,U,3)'>0:$$LDATE^TIULA("",7,""),+$G(TIUCCTXT):$$LDATE^TIULA("",7,""),1:+$P(TIURCTXT,U,3))
"RTN","TIUROR",76,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 D RBLD Q
"RTN","TIUROR",77,0)
 . S TIULATE=$P(TIULATE,U)
"RTN","TIUROR",78,0)
 . I TIUERLY>TIULATE D SWAP^TIUR(.TIUERLY,.TIULATE)
"RTN","TIUROR",79,0)
 . I $L(TIULATE,".")=1 D EXPRANGE^TIUR(.TIUERLY,.TIULATE)
"RTN","TIUROR",80,0)
 . S TIUSEQ=$S(+$G(TIUCCTXT):$P($$ASKSEQ^TIULA3(TIUSEQ),U),$G(TIUSEQ)']"":$P($$ASKSEQ^TIULA3(TIUSEQ),U),1:$G(TIUSEQ))
"RTN","TIUROR",81,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S TIUQUIT=1 D RBLD
"RTN","TIUROR",82,0)
 I '$G(TIURBLD) W !,"Searching for the progress notes"
"RTN","TIUROR",83,0)
 N TIUEXPKD
"RTN","TIUROR",84,0)
 D CONTEXT^TIUSRVLL(.TIUY,CLASS,CONTEXT,DFN,TIUERLY,TIULATE,TIUDUZ,TIUOCC,TIUSEQ,.TIUEXPKD) W "."
"RTN","TIUROR",85,0)
 ; I $D(TIUY)'>9 D  Q  ; original code
"RTN","TIUROR",86,0)
 I $D(^TMP("TIUYARRAY",$J))'>9 D  Q  ; TIU*1.0*143
"RTN","TIUROR",87,0)
 . N TIUST
"RTN","TIUROR",88,0)
 . S TIUST=$S(CONTEXT=2:"UNSIGNED ",CONTEXT=3:"UNCOSIGNED ",1:"SIGNED ")
"RTN","TIUROR",89,0)
 . S VALMCNT=2,^TMP("TIUR",$J,0)=0
"RTN","TIUROR",90,0)
 . S ^TMP("TIUR",$J,1,0)=""
"RTN","TIUROR",91,0)
 . S ^TMP("TIUR",$J,2,0)="No "_TIUST_$$UP^XLFSTR($$PNAME^TIULC1(CLASS))_" Available for "_$$PTNAME^TIULC1(DFN)
"RTN","TIUROR",92,0)
 . S ^TMP("TIUR",$J,"CLASS")=CLASS,^("DFN")=DFN
"RTN","TIUROR",93,0)
 . S TIUOCTXT=CONTEXT
"RTN","TIUROR",94,0)
 . I CONTEXT=4 S TIUOCTXT=TIUOCTXT_U_TIUDUZ
"RTN","TIUROR",95,0)
 . I CONTEXT=5 S TIUOCTXT=TIUOCTXT_U_+TIUERLY_U_+TIULATE
"RTN","TIUROR",96,0)
 . S ^TMP("TIUR",$J,"SEQ")=$G(TIUSEQ)
"RTN","TIUROR",97,0)
 . S ^TMP("TIUR",$J,"CTXT")=$S('+$G(TIUCCTXT):"INIT",1:TIUOCTXT) D HDR
"RTN","TIUROR",98,0)
 S TIUI=""
"RTN","TIUROR",99,0)
 ; F  S TIUI=$O(TIUY(TIUI)) Q:TIUI=""  D  ; original code
"RTN","TIUROR",100,0)
 F  S TIUI=$O(^TMP("TIUYARRAY",$J,TIUI)) Q:TIUI=""  D  ; TIU*1.0*143
"RTN","TIUROR",101,0)
 . N AUT,RDT,STAT,TITL,TIUD0,TIUD12,TIUD13,PREFIX
"RTN","TIUROR",102,0)
 . N TIUGDATA
"RTN","TIUROR",103,0)
 . S TIUD0=$G(^TIU(8925,+^TMP("TIUYARRAY",$J,TIUI),0)),TIUD12=$G(^(12)),TIUD13=$G(^(13)) ; **
"RTN","TIUROR",104,0)
 . ; S TIUD0=$G(^TIU(8925,+TIUY(TIUI),0)),TIUD12=$G(^(12)),TIUD13=$G(^(13)) ; original
"RTN","TIUROR",105,0)
 . S VALMCNT=+$G(VALMCNT)+1 W:(VALMCNT#100'>0) "."
"RTN","TIUROR",106,0)
 . S TITL=$$PNAME^TIULC1(+TIUD0)
"RTN","TIUROR",107,0)
 . I TITL="Addendum" S TITL=TITL_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,+$P(TIUD0,U,6),0)))
"RTN","TIUROR",108,0)
 . ; -- Mark ID note '<' and/or has addendum '+',
"RTN","TIUROR",109,0)
 . S PREFIX=$$PREFIX^TIULA2(+^TMP("TIUYARRAY",$J,TIUI),0) ; TIU*1.0*143
"RTN","TIUROR",110,0)
 . ; S PREFIX=$$PREFIX^TIULA2(+TIUY(TIUI),0) ; original
"RTN","TIUROR",111,0)
 . S TITL=PREFIX_TITL
"RTN","TIUROR",112,0)
 . S AUT=$$NAME^TIULS($$PERSNAME^TIULC1(+$P(TIUD12,U,2)),"LAST,FI")
"RTN","TIUROR",113,0)
 . S RDT=$$DATE^TIULS(+TIUD13,"MM/DD/YY HR:MIN")
"RTN","TIUROR",114,0)
 . S STAT=$$LOW^XLFSTR($P($G(^TIU(8925.6,+$P(TIUD0,U,5),0)),U))
"RTN","TIUROR",115,0)
 . S TIUR=$$SETFLD^VALM1(VALMCNT,$G(TIUR),"NUMBER")
"RTN","TIUROR",116,0)
 . S TIUR=$$SETFLD^VALM1(TITL,$G(TIUR),"TITLE")
"RTN","TIUROR",117,0)
 . S TIUR=$$SETFLD^VALM1(AUT,$G(TIUR),"AUTHOR")
"RTN","TIUROR",118,0)
 . S TIUR=$$SETFLD^VALM1(RDT,$G(TIUR),"REF DATE")
"RTN","TIUROR",119,0)
 . S TIUR=$$SETFLD^VALM1(STAT,$G(TIUR),"STATUS")
"RTN","TIUROR",120,0)
 . S ^TMP("TIUR",$J,VALMCNT,0)=TIUR
"RTN","TIUROR",121,0)
 . S ^TMP("TIUR",$J,0)=VALMCNT
"RTN","TIUROR",122,0)
 . S ^TMP("TIURIDX",$J,VALMCNT)=VALMCNT_U_+^TMP("TIUYARRAY",$J,TIUI)_U_PREFIX ; TIU*1.0*143
"RTN","TIUROR",123,0)
 . ; S ^TMP("TIURIDX",$J,VALMCNT)=VALMCNT_U_+TIUY(TIUI)_U_PREFIX ; original
"RTN","TIUROR",124,0)
 . S ^TMP("TIUR",$J,"IEN",+^TMP("TIUYARRAY",$J,TIUI),VALMCNT)="" ; TIU*1.0*143
"RTN","TIUROR",125,0)
 . ; S ^TMP("TIUR",$J,"IEN",+TIUY(TIUI),VALMCNT)="" ;original
"RTN","TIUROR",126,0)
 . S ^TMP("TIUR",$J,"IDX",VALMCNT,VALMCNT)=""
"RTN","TIUROR",127,0)
 . ;    TIUGDATA = 0 or DA^haskid^IDparent^prmsort:
"RTN","TIUROR",128,0)
 . S TIUGDATA=$$IDDATA^TIURECL1(+^TMP("TIUYARRAY",$J,TIUI),TIUD0) ; TIU*1.0*143
"RTN","TIUROR",129,0)
 . ; S TIUGDATA=$$IDDATA^TIURECL1(+TIUY(TIUI),TIUD0) ; original
"RTN","TIUROR",130,0)
 . I $G(TIUGDATA) S ^TMP("TIUR",$J,"IDDATA",+^TMP("TIUYARRAY",$J,TIUI))=TIUGDATA ; TIU*1.0*143
"RTN","TIUROR",131,0)
 . ; I $G(TIUGDATA) S ^TMP("TIUR",$J,"IDDATA",+TIUY(TIUI))=TIUGDATA ; original
"RTN","TIUROR",132,0)
 S ^TMP("TIUR",$J,"#")=TIUPICK_"^1:"_+VALMCNT
"RTN","TIUROR",133,0)
 S ^TMP("TIUR",$J,"CLASS")=CLASS
"RTN","TIUROR",134,0)
 S ^TMP("TIUR",$J,"DFN")=DFN
"RTN","TIUROR",135,0)
 S ^TMP("TIUR",$J,"OCC")=+$G(TIUOCC)
"RTN","TIUROR",136,0)
 S TIUOCTXT=CONTEXT
"RTN","TIUROR",137,0)
 I CONTEXT=4 S TIUOCTXT=TIUOCTXT_U_TIUDUZ
"RTN","TIUROR",138,0)
 I CONTEXT=5 S TIUOCTXT=TIUOCTXT_U_+TIUERLY_U_+TIULATE
"RTN","TIUROR",139,0)
 S ^TMP("TIUR",$J,"SEQ")=$G(TIUSEQ)
"RTN","TIUROR",140,0)
 S ^TMP("TIUR",$J,"CTXT")=$S('+$G(TIUCCTXT)&(VALMCNT'<TIUOCC):"INIT",1:TIUOCTXT)
"RTN","TIUROR",141,0)
 I CONTEXT=1,(+$G(TIUOCC)=9999999) D SAVE^TIUROR1
"RTN","TIUROR",142,0)
 I +$G(TIUCCTXT),$D(^TMP("TIUR",$J,0)) D HDR
"RTN","TIUROR",143,0)
 ; If first build (not rebuild), expand parents to show kids that
"RTN","TIUROR",144,0)
 ;meet criteria:
"RTN","TIUROR",145,0)
 I '$G(TIURBLD),$D(TIUEXPKD) D
"RTN","TIUROR",146,0)
 . D EXPANDKD^TIUR2(.TIUEXPKD,"",CONTEXT)
"RTN","TIUROR",147,0)
 ; K ^TMP("TIUYARRAY",$J) ; TIU*1.0*143
"RTN","TIUROR",148,0)
 Q
"RTN","TIUROR",149,0)
 ;
"RTN","TIUROR",150,0)
EXIT ; -- exit code
"RTN","TIUROR",151,0)
 D CLEAN^VALM10
"RTN","TIUROR",152,0)
 K DFN,VALMY,VALMCNT,VALMKEY,^TMP("TIURSAVE",$J)
"RTN","TIUROR",153,0)
 K ^TMP("TIURIDX",$J)
"RTN","TIUROR",154,0)
 K TIUGLINK ;**100**
"RTN","TIUROR",155,0)
 Q
"RTN","TIUROR",156,0)
 ;
"RTN","TIUROR",157,0)
RBLD ; -- rebuild list after actions
"RTN","TIUROR",158,0)
 N TIUEXP,TIURBLD
"RTN","TIUROR",159,0)
 S TIURBLD=1
"RTN","TIUROR",160,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D  G RBLDX
"RTN","TIUROR",161,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUROR",162,0)
 . D INIT(+$G(^TMP("TIUR",$J,"CLASS")),+$G(^("CTXT")),+$G(^("DFN")),+$G(^("OCC")))
"RTN","TIUROR",163,0)
 . D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUROR",164,0)
 . D BREATHE^TIUROR1(1)
"RTN","TIUROR",165,0)
 D INIT(+$G(^TMP("TIUR",$J,"CLASS")),+$G(^("CTXT")),+$G(^("DFN")),+$G(^("OCC")))
"RTN","TIUROR",166,0)
 ;D HDR S VALMBCK="R",VALMBG=1,VALMCNT=+$G(^TMP("TIUR",$J,0))
"RTN","TIUROR",167,0)
 D HDR S VALMBCK="R",VALMCNT=+$G(^TMP("TIUR",$J,0))
"RTN","TIUROR",168,0)
RBLDX I $G(VALMBG)>$G(VALMCNT) S VALMBG=$G(VALMCNT)
"RTN","TIUROR",169,0)
 Q
"RTN","TIUSRVLL")
0^3^B50585908
"RTN","TIUSRVLL",1,0)
TIUSRVLL ; SLC/JER - Server functions for LOCAL lists ;7/16/01
"RTN","TIUSRVLL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,100,121,143**;Jun 20, 1997
"RTN","TIUSRVLL",3,0)
LIST(TIUY,CLASS,DFN,EARLY,LATE) ; Build List user can select from to browse
"RTN","TIUSRVLL",4,0)
 N TIUCNT,TIUDT,TIUI,TIUJ,TIUK,TIUP,TIUQ,TIUREC,TIUPRM0,TIUPRM1
"RTN","TIUSRVLL",5,0)
 N TIUPRM3,TIUT,TIUTP,XREF,TIUS,TIUCONT,TIUSTAT,TIUTYPE
"RTN","TIUSRVLL",6,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUSRVLL",7,0)
 S EARLY=9999999-+$G(EARLY),TIUCNT=0
"RTN","TIUSRVLL",8,0)
 S (TIUI,LATE)=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUSRVLL",9,0)
 F  S TIUI=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI)) Q:+TIUI'>0!(+TIUI>EARLY)  D GATHER(.TIUY,DFN,CLASS,TIUI)
"RTN","TIUSRVLL",10,0)
 Q
"RTN","TIUSRVLL",11,0)
GATHER(TIUY,DFN,CLASS,TIUI) ; Find/sort records for the list to browse
"RTN","TIUSRVLL",12,0)
 N TIUDA
"RTN","TIUSRVLL",13,0)
 S TIUDA=0
"RTN","TIUSRVLL",14,0)
 F  S TIUDA=$O(^TIU(8925,"APTCL",DFN,CLASS,TIUI,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIUSRVLL",15,0)
 . I ($P(TIUPRM0,U,6)="S"),(+$$CANDO^TIULP(TIUDA,"VIEW")'>0) Q
"RTN","TIUSRVLL",16,0)
 . I +$G(^TIU(8925,+TIUDA,0))'>0 K ^TIU(8925,"APTCL",DFN,CLASS,TIUI,TIUDA) Q
"RTN","TIUSRVLL",17,0)
 . I +$G(^TIU(8925,+TIUDA,0))=81,(+$P($G(^(0)),U,5)>5) Q
"RTN","TIUSRVLL",18,0)
 . S TIUCNT=+$G(TIUCNT)+1
"RTN","TIUSRVLL",19,0)
 . S ^TMP("TIUYLIST",$J,TIUCNT)=TIUDA,TIUY=TIUCNT ; TIU*1.0*143
"RTN","TIUSRVLL",20,0)
 . ; S TIUY(TIUCNT)=TIUDA,TIUY=TIUCNT ; pre-143 code
"RTN","TIUSRVLL",21,0)
 Q
"RTN","TIUSRVLL",22,0)
 ;
"RTN","TIUSRVLL",23,0)
CONTEXT(TIUY,CLASS,CONTEXT,DFN,EARLY,LATE,PERSON,OCCLIM,SEQUENCE,TIUEXPKD) ; main
"RTN","TIUSRVLL",24,0)
 ; --- Call with:  TIUY     - Return array, pass by reference
"RTN","TIUSRVLL",25,0)
 ;                 CLASS    - Pointer to TIU DOCUMENT DEFINITION #8925.1
"RTN","TIUSRVLL",26,0)
 ;                 CONTEXT  - 1=All Signed (by PT),
"RTN","TIUSRVLL",27,0)
 ;                          - 2="Unsigned (by PT&(AUTHOR!TANSCRIBER))
"RTN","TIUSRVLL",28,0)
 ;                          - 3="Uncosigned (by PT&EXPECTED COSIGNER
"RTN","TIUSRVLL",29,0)
 ;                          - 4="Signed notes (by PT&selected author)
"RTN","TIUSRVLL",30,0)
 ;                          - 5="Signed notes (by PT&date range)
"RTN","TIUSRVLL",31,0)
 ;                 DFN      - Pointer to Patient (#2)
"RTN","TIUSRVLL",32,0)
 ;                [EARLY]   - FM date/time to begin search
"RTN","TIUSRVLL",33,0)
 ;                [LATE]    - FM date/time to end search
"RTN","TIUSRVLL",34,0)
 ;                [PERSON]  - Pointer to file 200 (DUZ if not passed)
"RTN","TIUSRVLL",35,0)
 ;                [OCCLIM]  - Occurrence Limit (optional)
"RTN","TIUSRVLL",36,0)
 ;               [SEQUENCE] - "A"=ascending (Regular date/time) (dflt)
"RTN","TIUSRVLL",37,0)
 ;                          - "D"=descending (Reverse date/time)
"RTN","TIUSRVLL",38,0)
 ;               [TIUEXPKD] - Return array, pass by ref.
"RTN","TIUSRVLL",39,0)
 ;                            TIUEXPKD(IFN)="", where we will expand IFN
"RTN","TIUSRVLL",40,0)
 ;                            so ID kids/adda that meet criteria are
"RTN","TIUSRVLL",41,0)
 ;                            displayed under it.
"RTN","TIUSRVLL",42,0)
 K TIUY S TIUY=0
"RTN","TIUSRVLL",43,0)
 I $G(CONTEXT)'>0 Q
"RTN","TIUSRVLL",44,0)
 I $G(CLASS)'>0 Q
"RTN","TIUSRVLL",45,0)
 S:+$G(EARLY)'>0 EARLY=0
"RTN","TIUSRVLL",46,0)
 S:+$G(LATE)'>0 LATE=5000000
"RTN","TIUSRVLL",47,0)
 S:+$G(PERSON)'>0 PERSON=DUZ
"RTN","TIUSRVLL",48,0)
 S:$G(SEQUENCE)']"" SEQUENCE="D"
"RTN","TIUSRVLL",49,0)
 S:+$G(OCCLIM)'>0 OCCLIM=9999999
"RTN","TIUSRVLL",50,0)
 S DFN=+$G(DFN)
"RTN","TIUSRVLL",51,0)
 S EARLY=9999999-EARLY,LATE=9999999-LATE ; CHANGE TO REVERSE DATES
"RTN","TIUSRVLL",52,0)
 ; --------------------
"RTN","TIUSRVLL",53,0)
 I CONTEXT=1!(CONTEXT=5) D  Q
"RTN","TIUSRVLL",54,0)
 . D ACLPT(.TIUY,CLASS,DFN,LATE,EARLY,OCCLIM,SEQUENCE)
"RTN","TIUSRVLL",55,0)
 ; --------------------
"RTN","TIUSRVLL",56,0)
 I CONTEXT=2 D  Q
"RTN","TIUSRVLL",57,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",58,0)
 . . D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",59,0)
 . F DFN=0:0 S DFN=$O(^TIU(8925,"ACLAU",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLAU(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",60,0)
 ; --------------------
"RTN","TIUSRVLL",61,0)
 I CONTEXT=3 D  Q
"RTN","TIUSRVLL",62,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",63,0)
 . . D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",64,0)
 . F DFN=0:0 S DFN=$O(^TIU(8925,"ACLEC",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLEC(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",65,0)
 ; --------------------
"RTN","TIUSRVLL",66,0)
 I CONTEXT=4 D  Q
"RTN","TIUSRVLL",67,0)
 . I DFN>0 D  Q
"RTN","TIUSRVLL",68,0)
 . . D ACLSB(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",69,0)
 . F DFN=0:0 S DFN=$O(^TIU(8925,"ACLSB",CLASS,PERSON,DFN)) Q:DFN'>0  D ACLSB(.TIUY,CLASS,PERSON,DFN,LATE,EARLY,SEQUENCE,.TIUEXPKD)
"RTN","TIUSRVLL",70,0)
 Q
"RTN","TIUSRVLL",71,0)
 ;
"RTN","TIUSRVLL",72,0)
ACLPT(ARRAY,CLASS,DFN,TIME1,TIME2,OCCLIM,SEQUENCE) ; Signed,
"RTN","TIUSRVLL",73,0)
 ;by patient, [& date].
"RTN","TIUSRVLL",74,0)
 N DATTIM,DA,ROOT,TIUORDER
"RTN","TIUSRVLL",75,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",76,0)
 S ROOT=$NA(^TIU(8925,"ACLPT",CLASS,DFN))
"RTN","TIUSRVLL",77,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",78,0)
 ; Since date/time is inverted, set subscripts forward for descending:
"RTN","TIUSRVLL",79,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",80,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:$S(+DATTIM'>0:1,+DATTIM>TIME2:1,+$G(^TMP("TIUREPLACE",$J))'<OCCLIM:1,1:0)  D
"RTN","TIUSRVLL",81,0)
 . F DA=0:0 S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",82,0)
 . . I +$G(^TIU(8925,+DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",83,0)
 . . I +^TIU(8925,+DA,0)=81 Q
"RTN","TIUSRVLL",84,0)
 . . ; -- Set records into ^TMP("TIUREPLACE",$J),
"RTN","TIUSRVLL",85,0)
 . . ;    replacing kids w parents:
"RTN","TIUSRVLL",86,0)
 . . D REPLACE(DA,DATTIM)
"RTN","TIUSRVLL",87,0)
 ; B 1
"RTN","TIUSRVLL",88,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",89,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",90,0)
 Q
"RTN","TIUSRVLL",91,0)
 ;
"RTN","TIUSRVLL",92,0)
SETARRY(ARRAY,TIUORDER) ; Set ARRAY(SUB)=DA, which is passed
"RTN","TIUSRVLL",93,0)
 ;back to CONTEXT.  ARRAY holds the right records, in the right order
"RTN","TIUSRVLL",94,0)
 ;for the List Template list.
"RTN","TIUSRVLL",95,0)
 ; TIUORDER=1 or -1: Set ARRAY subscripts forward 1,2 etc., or
"RTN","TIUSRVLL",96,0)
 ;backward -1,-2, etc.
"RTN","TIUSRVLL",97,0)
 ; Requires ^TMP("TIUREPLACE",$J),
"RTN","TIUSRVLL",98,0)
 ;with ID kids or adda replaced by parents.
"RTN","TIUSRVLL",99,0)
 ; B 1
"RTN","TIUSRVLL",100,0)
 N DATTIM,TIUDA,SUB
"RTN","TIUSRVLL",101,0)
 S DATTIM=0
"RTN","TIUSRVLL",102,0)
 S SUB=0
"RTN","TIUSRVLL",103,0)
 F  S DATTIM=$O(^TMP("TIUREPLACE",$J,DATTIM)) Q:'DATTIM  D
"RTN","TIUSRVLL",104,0)
 . S TIUDA=0
"RTN","TIUSRVLL",105,0)
 . F  S TIUDA=$O(^TMP("TIUREPLACE",$J,DATTIM,TIUDA)) Q:'TIUDA  D
"RTN","TIUSRVLL",106,0)
 . . S SUB=SUB+TIUORDER
"RTN","TIUSRVLL",107,0)
 . . S ^TMP("TIUYARRAY",$J,SUB)=TIUDA ; TIU*1.0*143
"RTN","TIUSRVLL",108,0)
 . . ; S ARRAY(SUB)=TIUDA ; original code
"RTN","TIUSRVLL",109,0)
 Q
"RTN","TIUSRVLL",110,0)
 ;
"RTN","TIUSRVLL",111,0)
REPLACE(TIUDA,DATTIM,EXPAND,FORGETAD) ; Populate ^TMP("TIUREPLACE",$J) with
"RTN","TIUSRVLL",112,0)
 ;records that meet criteria, replacing ID kids or addenda with
"RTN","TIUSRVLL",113,0)
 ;their parents.
"RTN","TIUSRVLL",114,0)
 ; Requires TIUDA, DATTIM;
"RTN","TIUSRVLL",115,0)
 ; opt flag FORGETAD - if 1, don't add note to the expand list
"RTN","TIUSRVLL",116,0)
 ;merely because of an addendum.  Used in search by title.
"RTN","TIUSRVLL",117,0)
 ; Passes back array EXPAND.
"RTN","TIUSRVLL",118,0)
 ; Sort by ref date/time
"RTN","TIUSRVLL",119,0)
 N IDPRNT,ADDMPRNT,ADDMGPNT,PDATTIM,GPDATTIM
"RTN","TIUSRVLL",120,0)
 S IDPRNT=+$G(^TIU(8925,TIUDA,21)) ; ID parent
"RTN","TIUSRVLL",121,0)
 I '$D(^TIU(8925,IDPRNT,0)) S IDPRNT=0
"RTN","TIUSRVLL",122,0)
 I IDPRNT S PDATTIM=+^TIU(8925,IDPRNT,13),PDATTIM=9999999-PDATTIM
"RTN","TIUSRVLL",123,0)
 S ADDMPRNT=+$P(^TIU(8925,TIUDA,0),U,6) ; assume TIUDA is not component
"RTN","TIUSRVLL",124,0)
 I '$D(^TIU(8925,ADDMPRNT,0)) S ADDMPRNT=0
"RTN","TIUSRVLL",125,0)
 I ADDMPRNT S PDATTIM=+^TIU(8925,ADDMPRNT,13),PDATTIM=9999999-PDATTIM
"RTN","TIUSRVLL",126,0)
 ; -- If TIUDA is not an ID kid, not addm, just put it
"RTN","TIUSRVLL",127,0)
 ;    in array and quit: --
"RTN","TIUSRVLL",128,0)
 S EXPAND=+$G(EXPAND)
"RTN","TIUSRVLL",129,0)
 I 'IDPRNT,'ADDMPRNT D  Q
"RTN","TIUSRVLL",130,0)
 . Q:$D(^TMP("TIUREPLACE",$J,DATTIM,TIUDA))
"RTN","TIUSRVLL",131,0)
 . S ^TMP("TIUREPLACE",$J,DATTIM,TIUDA)=""
"RTN","TIUSRVLL",132,0)
 . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUSRVLL",133,0)
 ; -- If TIUDA is an ID kid, put its parent in array:
"RTN","TIUSRVLL",134,0)
 I IDPRNT D  Q
"RTN","TIUSRVLL",135,0)
 . I '$D(EXPAND(IDPRNT)) S EXPAND(IDPRNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",136,0)
 . Q:$D(^TMP("TIUREPLACE",$J,PDATTIM,IDPRNT))
"RTN","TIUSRVLL",137,0)
 . S ^TMP("TIUREPLACE",$J,PDATTIM,IDPRNT)=""
"RTN","TIUSRVLL",138,0)
 . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUSRVLL",139,0)
 ; -- If TIUDA is an addendum, put its parent/gprnt in array:
"RTN","TIUSRVLL",140,0)
 I ADDMPRNT D  Q
"RTN","TIUSRVLL",141,0)
 . I '$G(FORGETAD),'$D(EXPAND(ADDMPRNT)) S EXPAND(ADDMPRNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",142,0)
 . S ADDMGPNT=+$G(^TIU(8925,ADDMPRNT,21))
"RTN","TIUSRVLL",143,0)
 . I '$D(^TIU(8925,ADDMGPNT,0)) S ADDMGPNT=0
"RTN","TIUSRVLL",144,0)
 . I ADDMGPNT D  I 1
"RTN","TIUSRVLL",145,0)
 . . S GPDATTIM=+^TIU(8925,ADDMGPNT,13),GPDATTIM=9999999-GPDATTIM
"RTN","TIUSRVLL",146,0)
 . . I '$D(EXPAND(ADDMGPNT)) S EXPAND(ADDMGPNT)="",EXPAND=EXPAND+1
"RTN","TIUSRVLL",147,0)
 . . Q:$D(^TMP("TIUREPLACE",$J,GPDATTIM,ADDMGPNT))
"RTN","TIUSRVLL",148,0)
 . . S ^TMP("TIUREPLACE",$J,GPDATTIM,ADDMGPNT)=""
"RTN","TIUSRVLL",149,0)
 . . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUSRVLL",150,0)
 . E  D
"RTN","TIUSRVLL",151,0)
 . . Q:$D(^TMP("TIUREPLACE",$J,PDATTIM,ADDMPRNT))
"RTN","TIUSRVLL",152,0)
 . . S ^TMP("TIUREPLACE",$J,PDATTIM,ADDMPRNT)=""
"RTN","TIUSRVLL",153,0)
 . . S ^TMP("TIUREPLACE",$J)=$G(^TMP("TIUREPLACE",$J))+1
"RTN","TIUSRVLL",154,0)
 Q
"RTN","TIUSRVLL",155,0)
ACLAU(ARRAY,CLASS,AUTHOR,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Unsigned
"RTN","TIUSRVLL",156,0)
 N DATTIM,DA,ROOT,TIUORDER
"RTN","TIUSRVLL",157,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",158,0)
 S ROOT=$NA(^TIU(8925,"ACLAU",CLASS,AUTHOR,DFN))
"RTN","TIUSRVLL",159,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",160,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",161,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",162,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",163,0)
 . . I +$P($G(^TIU(8925,DA,0)),U,5)>6 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",164,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA) Q
"RTN","TIUSRVLL",165,0)
 . . ; Don't include ID kids or parents in top level of list;
"RTN","TIUSRVLL",166,0)
 . . ; Do expand kids
"RTN","TIUSRVLL",167,0)
 . . D REPLACE(DA,DATTIM,.TIUEXPKD)
"RTN","TIUSRVLL",168,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",169,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",170,0)
 Q
"RTN","TIUSRVLL",171,0)
ACLEC(ARRAY,CLASS,EXCOSIGN,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Uncosigned
"RTN","TIUSRVLL",172,0)
 N DATTIM,DA,ROOT,TIUORDER
"RTN","TIUSRVLL",173,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",174,0)
 S ROOT=$NA(^TIU(8925,"ACLEC",CLASS,EXCOSIGN,DFN))
"RTN","TIUSRVLL",175,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",176,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",177,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",178,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",179,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA)
"RTN","TIUSRVLL",180,0)
 . . D REPLACE(DA,DATTIM,.TIUEXPKD)
"RTN","TIUSRVLL",181,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",182,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",183,0)
 Q
"RTN","TIUSRVLL",184,0)
ACLSB(ARRAY,CLASS,SIGNEDBY,DFN,TIME1,TIME2,SEQUENCE,TIUEXPKD) ; Signed, by author
"RTN","TIUSRVLL",185,0)
 N DATTIM,DA,ROOT,TIUORDER
"RTN","TIUSRVLL",186,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",187,0)
 S ROOT=$NA(^TIU(8925,"ACLSB",CLASS,SIGNEDBY,DFN))
"RTN","TIUSRVLL",188,0)
 S DATTIM=TIME1-.0000001
"RTN","TIUSRVLL",189,0)
 S TIUORDER=$S(SEQUENCE="D":1,1:-1)
"RTN","TIUSRVLL",190,0)
 F  S DATTIM=$O(@ROOT@(DATTIM)) Q:DATTIM'>0!(DATTIM>TIME2)  D
"RTN","TIUSRVLL",191,0)
 . S DA=0 F  S DA=$O(@ROOT@(DATTIM,DA)) Q:DA'>0  D
"RTN","TIUSRVLL",192,0)
 . . I +$G(^TIU(8925,DA,0))'>0 K @ROOT@(DATTIM,DA)
"RTN","TIUSRVLL",193,0)
 . . D REPLACE(DA,DATTIM,.TIUEXPKD)
"RTN","TIUSRVLL",194,0)
 D SETARRY(.ARRAY,TIUORDER)
"RTN","TIUSRVLL",195,0)
 K ^TMP("TIUREPLACE",$J)
"RTN","TIUSRVLL",196,0)
 Q
"VER")
8.0^22.0
**END**
**END**
