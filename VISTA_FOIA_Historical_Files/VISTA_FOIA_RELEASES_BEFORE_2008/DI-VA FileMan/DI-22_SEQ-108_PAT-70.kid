Released DI*22*70 SEQ #108
Extracted from mail message
**KIDS**:DI*22.0*70^

**INSTALL NAME**
DI*22.0*70
"BLD",178,0)
DI*22.0*70^VA FILEMAN^0^3021120^y
"BLD",178,1,0)
^^2^2^3010904^
"BLD",178,1,1,0)
See patch DI*22*70 in the National Patch Module on FORUM for complete
"BLD",178,1,2,0)
information on this patch.
"BLD",178,4,0)
^9.64PA^^
"BLD",178,"KRN",0)
^9.67PA^19^15
"BLD",178,"KRN",.4,0)
.4
"BLD",178,"KRN",.401,0)
.401
"BLD",178,"KRN",.402,0)
.402
"BLD",178,"KRN",.403,0)
.403
"BLD",178,"KRN",.5,0)
.5
"BLD",178,"KRN",.84,0)
.84
"BLD",178,"KRN",3.6,0)
3.6
"BLD",178,"KRN",3.8,0)
3.8
"BLD",178,"KRN",9.2,0)
9.2
"BLD",178,"KRN",9.8,0)
9.8
"BLD",178,"KRN",9.8,"NM",0)
^9.68A^6^5
"BLD",178,"KRN",9.8,"NM",1,0)
DICF1^^0^B22309773
"BLD",178,"KRN",9.8,"NM",2,0)
DIC3^^0^B31344317
"BLD",178,"KRN",9.8,"NM",3,0)
DIC4^^0^B15533015
"BLD",178,"KRN",9.8,"NM",4,0)
DIC5^^0^B8130256
"BLD",178,"KRN",9.8,"NM",6,0)
DIC1^^0^B32817715
"BLD",178,"KRN",9.8,"NM","B","DIC1",6)

"BLD",178,"KRN",9.8,"NM","B","DIC3",2)

"BLD",178,"KRN",9.8,"NM","B","DIC4",3)

"BLD",178,"KRN",9.8,"NM","B","DIC5",4)

"BLD",178,"KRN",9.8,"NM","B","DICF1",1)

"BLD",178,"KRN",19,0)
19
"BLD",178,"KRN",19.1,0)
19.1
"BLD",178,"KRN",101,0)
101
"BLD",178,"KRN",409.61,0)
409.61
"BLD",178,"KRN",8994,0)
8994
"BLD",178,"KRN","B",.4,.4)

"BLD",178,"KRN","B",.401,.401)

"BLD",178,"KRN","B",.402,.402)

"BLD",178,"KRN","B",.403,.403)

"BLD",178,"KRN","B",.5,.5)

"BLD",178,"KRN","B",.84,.84)

"BLD",178,"KRN","B",3.6,3.6)

"BLD",178,"KRN","B",3.8,3.8)

"BLD",178,"KRN","B",9.2,9.2)

"BLD",178,"KRN","B",9.8,9.8)

"BLD",178,"KRN","B",19,19)

"BLD",178,"KRN","B",19.1,19.1)

"BLD",178,"KRN","B",101,101)

"BLD",178,"KRN","B",409.61,409.61)

"BLD",178,"KRN","B",8994,8994)

"BLD",178,"PRE")
DIENVWRN
"BLD",178,"QUES",0)
^9.62^^
"BLD",178,"REQB",0)
^9.611^5^4
"BLD",178,"REQB",1,0)
DI*22.0*51^2
"BLD",178,"REQB",3,0)
DI*22.0*86^2
"BLD",178,"REQB",4,0)
DI*22.0*20^2
"BLD",178,"REQB",5,0)
DI*22.0*31^2
"BLD",178,"REQB","B","DI*22.0*20",4)

"BLD",178,"REQB","B","DI*22.0*31",5)

"BLD",178,"REQB","B","DI*22.0*51",1)

"BLD",178,"REQB","B","DI*22.0*86",3)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2990330^3020307^12
"PKG",5,22,1,"PAH",1,0)
70^3021120
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3021120
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*70 in the National Patch Module on FORUM for complete
"PKG",5,22,1,"PAH",1,1,2,0)
information on this patch.
"PRE")
DIENVWRN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","DIC1")
0^6^B32817715
"RTN","DIC1",1,0)
DIC1 ;SFISC/GFT/TKW-READ X, SHOW CHOICES ;8:33 AM  24 Sep 2002
"RTN","DIC1",2,0)
 ;;22.0;VA FileMan;**1,4,17,20,31,48,78,86,70**;Mar 30, 1999
"RTN","DIC1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIC1",4,0)
 K DUOUT,DTOUT N DD,DIY,DISUB,DIPRMT
"RTN","DIC1",5,0)
 D GETFA(.DIC,.DO)
"RTN","DIC1",6,0)
 N DIPRMT D GETPRMT^DIC11(.DIC,.DO,.DINDEX,.DIPRMT)
"RTN","DIC1",7,0)
B I $D(DIC("B")) D
"RTN","DIC1",8,0)
 . N B S B(1)=$G(DIC("B")) M B=DIC("B")
"RTN","DIC1",9,0)
 . N DIGBL,DINONULL S DIGBL=DIC_""""_DINDEX_"""",DINONULL=1
"RTN","DIC1",10,0)
 . F DISUB=1:1:DINDEX("#") D  S:B]"" DIY(DISUB)=B
"RTN","DIC1",11,0)
 . . S B=$G(B(DISUB)) I B="" S DINONULL=0 Q
"RTN","DIC1",12,0)
 . . S X="" S:DINONULL X=$O(@(DIGBL_",B)"))
"RTN","DIC1",13,0)
 . . S B=$S($D(^(B)):B,$F(X,B)-1=$L(B):X,$D(@(DIC_"B,0)")):$P(^(0),U),1:B)
"RTN","DIC1",14,0)
 . . N B1 S B1=B I "VPD"[DINDEX(DISUB,"TYPE") D
"RTN","DIC1",15,0)
 . . . I B D  Q:$D(DIY(DISUB,"EXT"))
"RTN","DIC1",16,0)
 . . . . N TYPE S TYPE=DINDEX(DISUB,"TYPE")
"RTN","DIC1",17,0)
 . . . . I TYPE="D" Q:B'?7N.1".".N
"RTN","DIC1",18,0)
 . . . . I TYPE="P" Q:B'?.N.1".".N
"RTN","DIC1",19,0)
 . . . . I TYPE="V" Q:B'?1.N.1".".N1";".E
"RTN","DIC1",20,0)
 . . . . S DIY(DISUB,"EXT")=$$EXT^DIC2(DINDEX(DISUB,"FILE"),DINDEX(DISUB,"FIELD"),B)
"RTN","DIC1",21,0)
 . . . . S:TYPE="P" B=DIY(DISUB,"EXT") Q
"RTN","DIC1",22,0)
 . . . D CHK^DIE(DINDEX(DISUB,"FILE"),DINDEX(DISUB,"FIELD"),"",B,.B1,"DIERROR") S:$G(DIERROR) B1=B
"RTN","DIC1",23,0)
 . . . K DIERROR,DIERR Q
"RTN","DIC1",24,0)
 . . S:DINONULL DIGBL=DIGBL_","_$S(+$P(B1,"E")=B1:B1,1:""""_B1_"""")
"RTN","DIC1",25,0)
 . . Q
"RTN","DIC1",26,0)
 . Q
"RTN","DIC1",27,0)
PROMPT ; Prompt user for lookup values
"RTN","DIC1",28,0)
 D PROMPT^DIC11
"RTN","DIC1",29,0)
 Q
"RTN","DIC1",30,0)
 ;
"RTN","DIC1",31,0)
 ;
"RTN","DIC1",32,0)
GETFA(DIC,DO) ; Get file attributes
"RTN","DIC1",33,0)
 ; DIC is open global reference, output same as documented in DO^DIC1.
"RTN","DIC1",34,0)
 D DO Q
"RTN","DIC1",35,0)
 ;
"RTN","DIC1",36,0)
DO ; GET FILE ATTR
"RTN","DIC1",37,0)
 Q:$D(DO)  I $D(@(DIC_"0)")) S DO=^(0)
"RTN","DIC1",38,0)
 E  S DO="0^-1" I $D(DIC("P")) S DO=U_DIC("P"),^(0)=DO
"RTN","DIC1",39,0)
DO2 S DO(2)=$P(DO,U,2) I DO?1"^".E S DO=$O(^DD(+DO(2),0,"NM",0))_DO
"RTN","DIC1",40,0)
 I DO(2)["s",$D(^DD(+DO(2),0,"SCR")) S DO("SCR")=^("SCR")
"RTN","DIC1",41,0)
 Q:$D(DIC("W"))  Q:DO(2)'["I"  Q:'$D(^DD(+DO(2),0,"ID"))
"RTN","DIC1",42,0)
 S DIC("W")=""
"RTN","DIC1",43,0)
P ; Add code to DIC("W") to display identifiers on pointed-to files
"RTN","DIC1",44,0)
 I DO(2)["P" D WOV,PTRID^DIC5(.DO,.DIC) Q
"RTN","DIC1",45,0)
 N % S %=0
"RTN","DIC1",46,0)
 ;
"RTN","DIC1",47,0)
W F  S %=$O(^DD(+DO(2),0,"ID",%)) D:%]""  Q:%=""
"RTN","DIC1",48,0)
 . N X S X=^DD(+DO(2),0,"ID",%) Q:X="W """""
"RTN","DIC1",49,0)
 . I $L(DIC("W"))+$L(X)>224 D WOV S %="" Q
"RTN","DIC1",50,0)
 . I DIC("W")="" S DIC("W")="N C,DINAME"
"RTN","DIC1",51,0)
 . S DIC("W")=DIC("W")_" W ""  "" "_X
"RTN","DIC1",52,0)
 . Q
"RTN","DIC1",53,0)
 Q
"RTN","DIC1",54,0)
 ;
"RTN","DIC1",55,0)
WOV S DIC("W")="N DIFILEI,DIEN,DIGBL S DIFILEI=+DO(2),DIEN=Y,DIGBL=DIC D WOV^DICQ1"
"RTN","DIC1",56,0)
 Q
"RTN","DIC1",57,0)
 ;
"RTN","DIC1",58,0)
RENUM ;
"RTN","DIC1",59,0)
 D GETFA(.DIC,.DO)
"RTN","DIC1",60,0)
 I '$D(DF),X?.NP,^DD(+DO(2),.01,0)["DINUM",$D(@(DIC_"X)")) D  Q:Y>0
"RTN","DIC1",61,0)
 . S Y=X D S^DIC3 I $T N DZ D ADDKEY^DIC3,GOT^DIC2 Q
"RTN","DIC1",62,0)
 . S Y=-1 Q
"RTN","DIC1",63,0)
 D F^DIC Q
"RTN","DIC1",64,0)
 ;
"RTN","DIC1",65,0)
DT S DST=DST_$$FMTE^DILIBF(%,"7S")
"RTN","DIC1",66,0)
 I '$D(DDS) W DST S DST=""
"RTN","DIC1",67,0)
 Q
"RTN","DIC1",68,0)
 ;
"RTN","DIC1",69,0)
Y ; Display a list of entries
"RTN","DIC1",70,0)
 N DD,DDD,DDC,DDH,DIOUT S DIY="",DIOUT=0,DD=DS("DD")
"RTN","DIC1",71,0)
 I DD=0,DIC(0)["T",DIC(0)["E" D DSPH^DIC0
"RTN","DIC1",72,0)
 F  S DD=$O(DS(DD)) Q:'DD  D  Q:DIOUT
"RTN","DIC1",73,0)
 . S DDH=DD-1,DIYX=0,DS("DD")=DD
"RTN","DIC1",74,0)
 . I DIC(0)["E" W:'$D(DDS) !?5,DD,?9 D
"RTN","DIC1",75,0)
 . . N Y S Y=+DS(DD)
"RTN","DIC1",76,0)
 . . D E Q
"RTN","DIC1",77,0)
 . I DIC(0)["Y" Q:DD<DS  D
"RTN","DIC1",78,0)
 . . F Y=DS:-1 Q:'DS(Y)  S Y(+DS(Y))=""
"RTN","DIC1",79,0)
 . . Q
"RTN","DIC1",80,0)
 . I DIC(0)'["E"!(DIC(0)["Y") S DS(0)="1^",DIOUT=1,DIY="" Q
"RTN","DIC1",81,0)
 . I DS>DD Q:DD#5
"RTN","DIC1",82,0)
 . S DIOUT=1
"RTN","DIC1",83,0)
 . I $D(DDS) S DDD=2,DDC=5 D LIST^DDSU K DDD,DDC
"RTN","DIC1",84,0)
 . I '$D(DDS) D
"RTN","DIC1",85,0)
 . . I DS>DD W !,"Press <RETURN> to see more, '^' to exit this list, OR"
"RTN","DIC1",86,0)
 . . W !,"CHOOSE "_$O(DS(0))_"-"_DD R ": ",DIY:$S($D(DTIME):DTIME,1:300) S:'$T DTOUT=1 Q
"RTN","DIC1",87,0)
 . I $G(DTOUT) W $C(7) S X="" Q
"RTN","DIC1",88,0)
 . I DIY[U!($G(DUOUT)) S DUOUT=1,X=U D  Q
"RTN","DIC1",89,0)
 . . I DIY?1"^^".E,DIC(0)["T" S DIROUT=1 Q
"RTN","DIC1",90,0)
 . . I DIY?1"^".E,DIC(0)["E",DIC(0)'["T" S DIROUT=1 Q
"RTN","DIC1",91,0)
 . Q
"RTN","DIC1",92,0)
 I DIY?1.N.1".".N D  I DIY,DIY'>DD,$G(DS(DIY)) S Y=+DS(DIY) D GOT S DS(0)=1_"^"_+Y Q
"RTN","DIC1",93,0)
 . S:($L($P(DIY,"."))>25!($L($P(DIY,".",2))>25)) DIY="-1" Q
"RTN","DIC1",94,0)
 I $L(DIY)>25 S DIY=-1
"RTN","DIC1",95,0)
 N I S I=$S($G(DUOUT):"1^U",$G(DTOUT):"1^T",DIY?1."?":"1^?",DIY:1,1:"")
"RTN","DIC1",96,0)
 I 'I,DIY]"",+$P(DIY,"E")'=DIY,'$G(DICR),DINDEX("#")=1 S I="2^"_DIY
"RTN","DIC1",97,0)
 Q:'I
"RTN","DIC1",98,0)
 S DS(0)=I,Y=-1
"RTN","DIC1",99,0)
 I DIY?1."?" D
"RTN","DIC1",100,0)
 . I (DIC(0)_$G(DICR(1,0)))'["A",$D(DICRS) Q
"RTN","DIC1",101,0)
 . N X,Y,DS D DSPHLP^DICQ(.DIC,.DIFILEI,.DINDEX,"?",1)
"RTN","DIC1",102,0)
 K DIY,DIYX Q
"RTN","DIC1",103,0)
 ;
"RTN","DIC1",104,0)
E S DST="" D
"RTN","DIC1",105,0)
 . Q:DIC(0)["U"
"RTN","DIC1",106,0)
 . I $O(DS(DD,0)) S DST=$$BLDDSP(.DS,DD) Q
"RTN","DIC1",107,0)
 . S %=$S($G(DILONGX):DICR(DICR,"ORG"),$G(DINDEX("IXTYPE"))'="S":$P(X,U),1:"")
"RTN","DIC1",108,0)
 . S %=%_$P(DS(DD),U,2,9)_$S($G(DIYX(DD)):DIY(DD),1:"")
"RTN","DIC1",109,0)
 . I ($G(DITRANX)!($G(DICRS))),$G(DINDEX(1,"TRANOUT"))]"",%]"" D  Q
"RTN","DIC1",110,0)
 . . N X S X=% X DINDEX(1,"TRANOUT") S DST=$G(X) Q
"RTN","DIC1",111,0)
 . I +$P(%,"E")=%,$D(DIDA) D DT Q
"RTN","DIC1",112,0)
 . I $G(DICRS),$G(DINDEX("IXTYPE"))="R" D
"RTN","DIC1",113,0)
 . . N F1,F2 S F1=$G(DINDEX(1,"FILE")),F2=$G(DINDEX(1,"FIELD"))
"RTN","DIC1",114,0)
 . . I F1,F2 S %=$$EXT^DIC2(F1,F2,%,"h")
"RTN","DIC1",115,0)
 . . Q
"RTN","DIC1",116,0)
 . S DST=% Q
"RTN","DIC1",117,0)
 I DIC(0)["s" S DIC(0)=$TR(DIC(0),"s")
"RTN","DIC1",118,0)
 I $D(DS(DD,"K")) S %=$G(DIX) M DIX=DS(DD) S DIX=%
"RTN","DIC1",119,0)
 S DIY=$S($G(DIYX(DD)):"",1:DIY(DD)) D WO^DIC2 Q
"RTN","DIC1",120,0)
 ;
"RTN","DIC1",121,0)
BLDDSP(DS,DD,DINDXFL,DIYX,DIY,DICRS) ; Build display of index values
"RTN","DIC1",122,0)
 N X,I S X=""
"RTN","DIC1",123,0)
 F I=0:0 S I=$O(DS(DD,I)) Q:'I  D
"RTN","DIC1",124,0)
 . I $L(X)+$L(DS(DD,I))>240 Q
"RTN","DIC1",125,0)
 . I I=1,$G(DINDXFL) S X=$P(DS(1),U,2,99)_$S($G(DIYX(1)):$G(DIY(1)),1:"") Q
"RTN","DIC1",126,0)
 . I I=1,$G(DICRS) Q
"RTN","DIC1",127,0)
 . S X=X_$P("  ^",U,I>1)_DS(DD,I) Q
"RTN","DIC1",128,0)
 Q X
"RTN","DIC1",129,0)
 ;
"RTN","DIC1",130,0)
GOT ; Set data for single entry selected by user.
"RTN","DIC1",131,0)
 N I,J,K
"RTN","DIC1",132,0)
 I DIY(DIY)="" S DIY(DIY)=$P($G(@(DIC_"Y,0)")),U)
"RTN","DIC1",133,0)
 S:$D(DDS) DST=X_$P(DS(DIY),U,2,9)_$S($G(DIYX(DIY)):$G(DIY(DIY)),1:"")
"RTN","DIC1",134,0)
 S K=$O(DIVPSEL("A"),-1) I K]"" S DIVPSEL(K)=Y
"RTN","DIC1",135,0)
 I $G(DIFINDR) D  Q
"RTN","DIC1",136,0)
 . S:$D(DDS) DS(0,"DST")=DST
"RTN","DIC1",137,0)
 . S DS(0,"Y")=+DS(DIY),DS(0,"X")=X_$P(DS(DIY),"^",2),DS(0,"DIYX")=$G(DIYX(DIY)),DS(0,"DIY")=DIY(DIY)
"RTN","DIC1",138,0)
 . M DS(0,1)=DS(DIY)
"RTN","DIC1",139,0)
 . Q
"RTN","DIC1",140,0)
 I $G(DIYX(DIY)) K DIYX S DIY(DIY)=$P($G(@(DIC_"Y,0)")),U)
"RTN","DIC1",141,0)
 D C^DIC2 Q
"RTN","DIC1",142,0)
 ;
"RTN","DIC1",143,0)
OK ;
"RTN","DIC1",144,0)
 S %=1 I $G(DS)=1 S DST="         ...OK" D Y^DICN W:'$D(DDS) !
"RTN","DIC1",145,0)
 I %>0 Q:%=1  D  S X=$G(DIX),Y=-1 Q  ;%=1=Yes, %=2=No ;22*70
"RTN","DIC1",146,0)
 . I $G(DICR) S DICR(DICR,31.2)=+Y ;Preserve IEN for future reference
"RTN","DIC1",147,0)
 . I +$G(DS) K DS S (DS,DS(0),DS("DD"))=0 ;ReInit Display array
"RTN","DIC1",148,0)
 . Q
"RTN","DIC1",149,0)
 I %=0 W !?4,$$EZBLD^DIALOG(8040),! G OK ;User asked for Help
"RTN","DIC1",150,0)
 I %=-1,$D(DTOUT) S DIROUT=1 ;User TIMED Out; DTOUT set in DICN
"RTN","DIC1",151,0)
 I %=-1,'$D(DTOUT) S (DUOUT,DIROUT)=1 ;User single up-arrowed out
"RTN","DIC1",152,0)
BAD S Y=-1
"RTN","DIC1",153,0)
 I $G(%Y)?1"^^".E S (DIROUT,DUOUT)=1
"RTN","DIC1",154,0)
 S DS(0)=$S($G(DTOUT):"1^T",$G(DUOUT):"1^U",$G(%)=-1:"1^U",1:"1^") Q
"RTN","DIC1",155,0)
MIX ;
"RTN","DIC1",156,0)
 N DID S DID=D_"^-1",DID(1)=2
"RTN","DIC1",157,0)
 N D S D=$P(DID,U)
"RTN","DIC1",158,0)
 G IX^DIC
"RTN","DIC1",159,0)
 ;
"RTN","DIC1",160,0)
 ;#8042  Select |filename|:
"RTN","DIC1",161,0)
 ;#8040   Answer with 'Yes' or 'No'
"RTN","DIC3")
0^2^B31344317
"RTN","DIC3",1,0)
DIC3 ;SFISC/XAK,TKW,SEA/TOAD-VA FileMan: Lookup, Part 1 (called from DIC) ;7:29 AM  23 Sep 2002
"RTN","DIC3",2,0)
 ;;22.0;VA FileMan;**1,16,4,17,20,28,40,86,70**;Mar 30, 1999
"RTN","DIC3",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIC3",4,0)
 ;
"RTN","DIC3",5,0)
SEARCH ; Begin search through x-refs.
"RTN","DIC3",6,0)
 I DIC(0)["T",'$G(DICR) N:'$D(DICR(1)) DICR S DICR=0 D:DIC(0)["O"
"RTN","DIC3",7,0)
 . I DIC(0)'["X" S DIC(0)=DIC(0)_"X" Q
"RTN","DIC3",8,0)
 . S DIC(0)=$TR(DIC(0),"X") Q
"RTN","DIC3",9,0)
 I X?1"`".NP D ^DICM Q
"RTN","DIC3",10,0)
 I $L(X)>100,'$G(DILONGX) D ^DICM Q
"RTN","DIC3",11,0)
 N DIOK,DIEXACTN K % I $G(DISKIPIX)=D K DISKIPIX G M
"RTN","DIC3",12,0)
EXACT ; Find all exact matches to the lookup values
"RTN","DIC3",13,0)
 S DISAVDS=DS,DIEXACTN=0
"RTN","DIC3",14,0)
 I $G(DILONGX) G:$L(DICR(DICR,"ORG"))'>DINDEX(1,"LENGTH") M D
"RTN","DIC3",15,0)
 . S (X,X(1),DIVAL,DIVAL(1))=$E(DICR(DICR,"ORG"),1,DINDEX(1,"LENGTH")) Q
"RTN","DIC3",16,0)
 I DINDEX("#")>1,($G(DIALLVAL)!($G(DICR))),(DIC(0)["X"!(DIC(0)["O")) D EXACT^DIC4,SET^DIC4
"RTN","DIC3",17,0)
 I DINDEX("#")'>1 S Y=0,DIX=X F  D MOREX Q:Y=-1!(DS(0))
"RTN","DIC3",18,0)
 I DS(0) Q:DIC(0)'["T"  Q:$P(DS(0),U,2)'="U"!($G(DIROUT))  S DS(0)=0
"RTN","DIC3",19,0)
 I DIC(0)["T",DIC(0)["E",$G(DUOUT) D  ;22*70
"RTN","DIC3",20,0)
 . ; Set up variables for next index lookup
"RTN","DIC3",21,0)
 . K DS,DUOUT
"RTN","DIC3",22,0)
 . S (DS,DS(0),DS("DD"))=0
"RTN","DIC3",23,0)
 . S X=DIVAL(1)
"RTN","DIC3",24,0)
 . Q
"RTN","DIC3",25,0)
 I DISAVDS=0,DS=1,DIC(0)["O"!(DIC(0)'["E"),DIC(0)'["T" D  Q:Y>0!($D(DIROUT))  ;Good IEN returned or user bailed out
"RTN","DIC3",26,0)
 . I DINDEX("#")'>1,DIEXACTN>1,DINDEX'="B" S Y=-1 Q
"RTN","DIC3",27,0)
 . S Y=+DS(1),DS("DD")=1
"RTN","DIC3",28,0)
 . I DINDEX("#")'>1,DIEXACTN'>1 S DIY=1 D C^DIC2 Q
"RTN","DIC3",29,0)
 . D G^DIC2 Q
"RTN","DIC3",30,0)
 ;
"RTN","DIC3",31,0)
PARTIAL ; Find all partial matches to the lookup values
"RTN","DIC3",32,0)
 I DIC(0)'["X",DINDEX("#")>1 D PARTIAL^DIC4,SET^DIC4
"RTN","DIC3",33,0)
 I DIC(0)'["X",DINDEX("#")'>1 F  D  Q:$G(DIX)=""!(DS(0))
"RTN","DIC3",34,0)
 . N DITYP S DITYP=$G(DINDEX(1,"TYPE"))
"RTN","DIC3",35,0)
 . D
"RTN","DIC3",36,0)
 . . I DIC(0)["E",(DITYP["F"!(DITYP["S")) Q:DIC(0)["n"
"RTN","DIC3",37,0)
 . . I $TR(X,"-.")?.N,DO(2)'["D",'$D(DIDA) S DIX=$O(@(DIC_"D,DIX_"" "")"),-1)
"RTN","DIC3",38,0)
 . . Q
"RTN","DIC3",39,0)
 . S DIX=$O(@(DIC_"D,DIX)"))
"RTN","DIC3",40,0)
 . Q:DIX=""
"RTN","DIC3",41,0)
 . I $P(DIX,X)'="" D  Q:DIX=""
"RTN","DIC3",42,0)
 . . I +$P(X,"E")'=X!(DIC(0)'["E") S DIX="" Q
"RTN","DIC3",43,0)
 . . I DIC(0)'["n"!(DITYP'["F"&(DITYP'["S")) S DIX="" Q
"RTN","DIC3",44,0)
 . . D FINDMORE^DICLIX0(1,.DIX,X,.DINDEX)
"RTN","DIC3",45,0)
 . . S:$P(DIX,X)'="" DIX="" Q
"RTN","DIC3",46,0)
 . S Y=0 F  D MOREX Q:Y=-1!(DS(0))
"RTN","DIC3",47,0)
 . Q
"RTN","DIC3",48,0)
 I DS(0) Q:DIC(0)'["T"  Q:$P(DS(0),U,2)'="U"!($G(DIROUT))  S DS(0)=0
"RTN","DIC3",49,0)
 I DIC(0)["T",DIC(0)["E",$G(DUOUT) D  ;22*70
"RTN","DIC3",50,0)
 . ; Set up variables for next index lookup
"RTN","DIC3",51,0)
 . K DS,DUOUT
"RTN","DIC3",52,0)
 . S (DS,DS(0),DS("DD"))=0
"RTN","DIC3",53,0)
 . S X=DIVAL(1)
"RTN","DIC3",54,0)
 . Q
"RTN","DIC3",55,0)
 ;
"RTN","DIC3",56,0)
M ; Find the next index.  At end, display the rest
"RTN","DIC3",57,0)
 I DIC(0)["T" D KEEPON^DIC5 I DS(0) Q:$P(DS(0),U,2)'="U"!($G(DIROUT))
"RTN","DIC3",58,0)
 I DIC(0)["M" S DIOK=0 F  D  Q:DIOK
"RTN","DIC3",59,0)
 . N Y S Y=DINDEX("START") K DINDEX S DINDEX("WAY")=1,DINDEX("START")=Y,DINDEX("#")=1
"RTN","DIC3",60,0)
 . S (D,DINDEX)=$S($D(DID):$P(DID,U,DID(1)),1:$O(@(DIC_"D)")))
"RTN","DIC3",61,0)
 . S:$D(DID) DID(1)=DID(1)+1
"RTN","DIC3",62,0)
 . I D=""!(D=-1) S D="",DIOK=1 Q
"RTN","DIC3",63,0)
 . I $D(@(DIC_"D)"))-10 Q
"RTN","DIC3",64,0)
 . ; Check Index, build index info
"RTN","DIC3",65,0)
 . D IXCHK^DIC4(.DIFILEI,.DINDEX,.DIOK,.DIALLVAL,.DIVAL,$G(DID)) Q
"RTN","DIC3",66,0)
 I DIC(0)["M",D]"" G EXACT
"RTN","DIC3",67,0)
 D:DIC(0)["M" D^DIC0
"RTN","DIC3",68,0)
 I DS=1 S DS("DD")=1 D G^DIC2 Q
"RTN","DIC3",69,0)
 I DS D Y^DIC1 Q:DS(0)  I DINDEX("#")'>1 D:DO(2)["O"&(DO(2)'["A") L^DICM Q
"RTN","DIC3",70,0)
 I $G(DILONGX) S X=$E(DICR(DICR,"ORG"),1,30)
"RTN","DIC3",71,0)
 I DIC(0)["T",'$G(DICR),DIC(0)["O",DIC(0)["X" G SEARCH
"RTN","DIC3",72,0)
 I DINDEX("#")>1,'$G(DICR) D:DIC(0)["L"  D:Y=-1 BAD^DIC1 Q
"RTN","DIC3",73,0)
 . S Y=-1 I $G(DICR)="" N DICR S DICR=0
"RTN","DIC3",74,0)
 . I $A(X)=34,X?.E1"""" D N^DICM Q
"RTN","DIC3",75,0)
 . K DD D L^DICM Q
"RTN","DIC3",76,0)
 D ^DICM Q
"RTN","DIC3",77,0)
 ;
"RTN","DIC3",78,0)
 ;
"RTN","DIC3",79,0)
MOREX ; Find more exact matches to lookup value DIX
"RTN","DIC3",80,0)
 S Y=$O(@(DIC_"D,DIX,Y)")) I 'Y S Y=-1 Q
"RTN","DIC3",81,0)
 I $D(DIEXACTN)#2 S DIEXACTN=DIEXACTN+1
"RTN","DIC3",82,0)
 D MN Q:'$T  D K  Q:$G(DS(0))
"RTN","DIC3",83,0)
 I DS>1,DIC(0)'["E",DIC(0)'["Y" K DS S DS=0,DS(0)=1,Y=-1
"RTN","DIC3",84,0)
 Q
"RTN","DIC3",85,0)
 ;
"RTN","DIC3",86,0)
MN N DZ S DZ=$S((DIC(0)["D"&(DINDEX="B")):1,$G(DINDEX("#"))>1:0,$G(@(DIC_"D,DIX,Y)")):1,1:0) S DIYX=0
"RTN","DIC3",87,0)
 D:'$D(DO) GETFA^DIC1(.DIC,.DO)
"RTN","DIC3",88,0)
 I D="B",'DZ,'($D(@(DIC_"D,DIX,Y)"))#2) D
"RTN","DIC3",89,0)
 . N I S I=Y F  S DZ=$G(^(I)),I=$O(^(I,0)) Q:I=""
"RTN","DIC3",90,0)
 . Q
"RTN","DIC3",91,0)
 S DIY="" I '$D(@(DIC_"Y,0)")) X "I 0" Q
"RTN","DIC3",92,0)
 I D="B",'DZ,'$D(DO("SCR")),$L(DIX)<30,'$D(DIC("S")),'$D(@(DIC_"Y,-9)")),'$G(DINDEX("OLDSUB")) D ADDKEY I 1 Q
"RTN","DIC3",93,0)
 D S I  D
"RTN","DIC3",94,0)
 . I DINDEX("FLISTD")["^.01^",DINDEX("#")=1,'DZ,$P(DIY,DIX)="",'$G(DINDEX("OLDSUB")) D  Q
"RTN","DIC3",95,0)
 . . N I S I=$S($G(DILONGX):DICR(DICR,"ORG"),1:DIX)
"RTN","DIC3",96,0)
 . . S DIY=$P(DIY,I,2,9),DIYX=1 D ADDKEY Q
"RTN","DIC3",97,0)
 . Q:DIC(0)["Y"
"RTN","DIC3",98,0)
 . I ($G(DINDEX("#"))>1)!($G(DINDEX("OLDSUB"))) D  Q
"RTN","DIC3",99,0)
 . . D ADDIX^DIC4(.DIFILEI,Y,.DINDEX,.DIX,.DISCREEN)
"RTN","DIC3",100,0)
 . . D ADDKEY Q
"RTN","DIC3",101,0)
 . D ADDKEY
"RTN","DIC3",102,0)
 . I DINDEX("FLISTD")["^.01^",'DZ S DIY=""
"RTN","DIC3",103,0)
 . Q
"RTN","DIC3",104,0)
 Q
"RTN","DIC3",105,0)
 ;
"RTN","DIC3",106,0)
S D:'$D(DO) GETFA^DIC1(.DIC,.DO)
"RTN","DIC3",107,0)
 I $D(@(DIC_"Y,0)")),'$D(^(-9)) S DIY=$P(^(0),U)
"RTN","DIC3",108,0)
 E  S DIY="" Q
"RTN","DIC3",109,0)
 I '$D(DIC("S")),'$D(DO("SCR")) Q
"RTN","DIC3",110,0)
 I $G(DINDEX("#"))>1!($G(DINDEX("OLDSUB"))) Q
"RTN","DIC3",111,0)
 I $G(DILONGX) N DI0NODE,DIVAL D
"RTN","DIC3",112,0)
 . N % S %=DINDEX(1,"GET")
"RTN","DIC3",113,0)
 . I %="DIVAL=DINDEX(DISUB)" S DIVAL=X Q
"RTN","DIC3",114,0)
 . I %["DI0NODE" S DI0NODE=@(DIC_"Y,0)")
"RTN","DIC3",115,0)
 . N DIFILE S DIFILE=DIFILEI,DIFILE(DIFILE)=DIFILEI(DIFILEI)
"RTN","DIC3",116,0)
 . N DIEN S DIEN=Y_DIENS
"RTN","DIC3",117,0)
 . S @% Q
"RTN","DIC3",118,0)
 N DIAC,DIFILE,DISAVEX,DISAVEY,DISAVED
"RTN","DIC3",119,0)
 M DISAVEX=X,DISAVEY=Y S DISAVED=D I $D(@(DIC_"Y,0)"))
"RTN","DIC3",120,0)
 I 1 X:$D(DIC("S")) DIC("S") K DIAC,DIFILE D:$D(DIC("S")) SX Q:'$T
"RTN","DIC3",121,0)
 I $D(DO("SCR")),$D(@(DIC_"Y,0)")) X DO("SCR") D SX Q:'$T
"RTN","DIC3",122,0)
 I 1 Q
"RTN","DIC3",123,0)
 ;
"RTN","DIC3",124,0)
SX M X=DISAVEX,Y=DISAVEY S D=DISAVED Q
"RTN","DIC3",125,0)
 ;
"RTN","DIC3",126,0)
ADDKEY ; Put KEY values into output array for display
"RTN","DIC3",127,0)
 S DIX("F")="" I DIC(0)'["U" S DIX("F")=$G(DINDEX("FLISTD"))
"RTN","DIC3",128,0)
 Q:'$D(DIFILEI(DIFILEI,"KEY"))  Q:DIC(0)["S"
"RTN","DIC3",129,0)
 N DIKX,DII,DIFLD,DIERR,I
"RTN","DIC3",130,0)
 M DIKX=DIFILEI(DIFILEI,"KEY",DIFILEI) Q:'$D(DIKX)
"RTN","DIC3",131,0)
 K DIX("K")
"RTN","DIC3",132,0)
 F I=0:0 S I=$O(DIKX(I)) Q:'I  F DIFLD=0:0 S DIFLD=$O(DIKX(I,DIFLD)) Q:'DIFLD  D
"RTN","DIC3",133,0)
 . I DIFLD=.01,$G(DZ)=0 S DIY=""
"RTN","DIC3",134,0)
 . S DIX("K",I,DIFLD)=$$GET1^DIQ(DIFILEI,Y_DIFILEI(DIFILEI,"KEY","IEN"),DIFLD,"","","DIERR") Q
"RTN","DIC3",135,0)
 Q
"RTN","DIC3",136,0)
 ;
"RTN","DIC3",137,0)
K ; Put an IEN into the DS array for display
"RTN","DIC3",138,0)
 N DZ,I S DZ=$O(DS(0)) F I=DZ:1:DS I +$G(DS(I))=Y,DIC(0)'["C" S I=-1 Q
"RTN","DIC3",139,0)
 I I'=-1,DIC(0)["T" D
"RTN","DIC3",140,0)
 . Q:'$D(^TMP($J,"DICSEEN",DIFILEI))
"RTN","DIC3",141,0)
 . I $D(^TMP($J,"DICSEEN",DIFILEI,Y)) S I=-1 Q
"RTN","DIC3",142,0)
 . S ^TMP($J,"DICSEEN",DIFILEI,Y)="" Q
"RTN","DIC3",143,0)
 I I=-1 S I=DIX K DIX S DIX=I,I=-1 Q
"RTN","DIC3",144,0)
 I DS-DZ>100 D
"RTN","DIC3",145,0)
 . N D1,D2 S D2=DZ+19 F D1=DZ:1:D2 K DS(D1),DIY(D1),DIYX(D1)
"RTN","DIC3",146,0)
 . Q
"RTN","DIC3",147,0)
 S DS=DS+1 D
"RTN","DIC3",148,0)
 . S I=DS M DS(DS)=DIX S DS=I,I=DIX K DIX S DIX=I
"RTN","DIC3",149,0)
 . S DS(DS)=Y_"^"_$P(DIX,X,2,99) Q
"RTN","DIC3",150,0)
 S DIY(DS)=DIY S:DIY]""&$G(DIYX) DIYX(DS)=1
"RTN","DIC3",151,0)
 I DS#5-1!(DS=1)!(DIC(0)["Y") Q
"RTN","DIC3",152,0)
 D Y^DIC1 Q
"RTN","DIC3",153,0)
 ;
"RTN","DIC3",154,0)
 ;
"RTN","DIC4")
0^3^B15533015
"RTN","DIC4",1,0)
DIC4 ;SFISC/TKW-VA FileMan Lookup utilities ;5:59 AM  20 Sep 2002
"RTN","DIC4",2,0)
 ;;22.0;VA FileMan;**4,20,70**;Mar 30, 1999
"RTN","DIC4",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIC4",4,0)
EXACT ; Find next exact match on a compound index
"RTN","DIC4",5,0)
 N DIFLAGS,DIFIELDS,DIWRITE,DIIENS,DIFORCE,DIERR,DISCR,DIQUIET,DIIX
"RTN","DIC4",6,0)
 S DIFLAGS="lX" D GETPAR N DINDEX
"RTN","DIC4",7,0)
 D FIND^DICF(.DIFILEI,DIIENS,DIFIELDS,DIFLAGS,.DIVAL,"*",.DIFORCE,.DISCR,$G(DIC("W")),"DS","DIERR",.DIIX,.DIC,.DIY,.DIYX)
"RTN","DIC4",8,0)
 D:$G(DIERR) PROCERR Q
"RTN","DIC4",9,0)
 ;
"RTN","DIC4",10,0)
PARTIAL ; Find next partial match on a compound index
"RTN","DIC4",11,0)
 N DIFLAGS,DIFIELDS,DIWRITE,DIIENS,DIFORCE,DIERR,DISCR,DIQUIET,DIIX
"RTN","DIC4",12,0)
 S DIFLAGS="l" D GETPAR K DIIX("DONE") N DINDEX
"RTN","DIC4",13,0)
 I DIFLAGS'["Q",$G(DS("INT"))]"","VP"[DIIX(1,"TYPE") N I M I=DIVAL N DIVAL D
"RTN","DIC4",14,0)
 . S (I,I(1),DIIX(1),DIIX(1,"FROM"),DIIX(1,"PART"))=DS("INT")
"RTN","DIC4",15,0)
 . S DIIX(1,"TYPE")="F" M DIVAL=I K I Q
"RTN","DIC4",16,0)
 D FIND^DICF(.DIFILEI,DIIENS,DIFIELDS,DIFLAGS,.DIVAL,"*",.DIFORCE,.DISCR,$G(DIC("W")),"DS","DIERR",.DIIX,.DIC,.DIY,.DIYX)
"RTN","DIC4",17,0)
 D:$G(DIERR) PROCERR Q
"RTN","DIC4",18,0)
 ;
"RTN","DIC4",19,0)
SET I $P(DS(0),U,2) D SETY Q
"RTN","DIC4",20,0)
 S Y=-1 Q:'DS(0)  D SETOUT Q
"RTN","DIC4",21,0)
 ;
"RTN","DIC4",22,0)
SETOUT ; Set variables if user up-arrowed or timed out.
"RTN","DIC4",23,0)
 S Y=-1 N I S I=$P(DS(0),U,2)
"RTN","DIC4",24,0)
 I I="U",DIC(0)'["A" S DUOUT=1
"RTN","DIC4",25,0)
 S:I="T" DTOUT=1 Q
"RTN","DIC4",26,0)
 ;
"RTN","DIC4",27,0)
SETY ; If entry was selected by user, set output variables.
"RTN","DIC4",28,0)
 S Y=DS(0,"Y")
"RTN","DIC4",29,0)
 S:$D(DDS) DST=DS(0,"DST")
"RTN","DIC4",30,0)
 S (X,X(1))=DS(0,"X"),DIYX=DS(0,"DIYX"),DIY=DS(0,"DIY")
"RTN","DIC4",31,0)
 N % S:$G(DIX)]"" %=DIX M DIX=DS(0,1) K DS(0),DIX("F") S:$D(%) DIX=%
"RTN","DIC4",32,0)
 D GOT^DIC2 I Y<0 S DS(0)="1^" Q
"RTN","DIC4",33,0)
 S DS(0)="1^"_+Y Q
"RTN","DIC4",34,0)
 ;
"RTN","DIC4",35,0)
GETPAR ; Set parameters for Finder call
"RTN","DIC4",36,0)
 D:DIFLAGS'["Q"
"RTN","DIC4",37,0)
 . N I S I=0 I $A(X)=34,X?.E1"""" S I=1
"RTN","DIC4",38,0)
 . I I!(DIC(0)["U")!(DIC(0)["M")!($G(DICR)) S DIFLAGS=DIFLAGS_"Q"
"RTN","DIC4",39,0)
 . Q
"RTN","DIC4",40,0)
 S DIIENS=$S(DIC(0)["p":",",1:DIENS)
"RTN","DIC4",41,0)
 I DIC(0)'["E" S DIQUIET=1
"RTN","DIC4",42,0)
 S (DIFORCE,DIFORCE(1))=1,DIFORCE(0)=DINDEX
"RTN","DIC4",43,0)
 I $D(DIC("PTRIX")) M DIFORCE("PTRIX")=DIC("PTRIX")
"RTN","DIC4",44,0)
 D:$G(DIC("S"))]""
"RTN","DIC4",45,0)
 . M DISCR("S")=DIC("S")
"RTN","DIC4",46,0)
 . S I="S" F  S I=$O(DIC(I)) Q:$E(I)'="S"  S DISCR(I)=DIC(I)
"RTN","DIC4",47,0)
 . Q
"RTN","DIC4",48,0)
 I $D(DIC("V"))]"" M DISCR("V")=DIC("V")
"RTN","DIC4",49,0)
 S DIFIELDS="@" M DIIX=DINDEX Q
"RTN","DIC4",50,0)
 ;
"RTN","DIC4",51,0)
ADDIX(DIFILEI,Y,DINDEX,DIX,DISCREEN) ; Put index values into DIX variable for display
"RTN","DIC4",52,0)
 N DISUB,DIVAL,DI0NODE,DIFILE S DI0NODE=$G(@DIFILEI(DIFILEI)@(Y,0)),DIX(1)="" M DIFILE=DIFILEI
"RTN","DIC4",53,0)
 I $G(DINDEX("OLDSUB")) N DIO,DIN S DIN=0 F DIO=1:1:DINDEX("OLDSUB") D
"RTN","DIC4",54,0)
 . S DIVAL=""
"RTN","DIC4",55,0)
 . I $G(DISCREEN("X",DIO,"GET"))]"" D
"RTN","DIC4",56,0)
 . . X DISCREEN("X",DIO,"GET") Q
"RTN","DIC4",57,0)
 . E  S DIN=$O(DINDEX(DIN)) I DIN,DIN'>DINDEX("#") S DISUB=DIN D GETVAL
"RTN","DIC4",58,0)
 . S:DIVAL]"" DIX(DIO)=DIVAL Q
"RTN","DIC4",59,0)
 Q:$G(DINDEX("OLDSUB"))
"RTN","DIC4",60,0)
 F DISUB=1:1:DINDEX("#") D GETVAL S:DIVAL]"" DIX(DISUB)=DIVAL
"RTN","DIC4",61,0)
 Q
"RTN","DIC4",62,0)
GETVAL ; Return index value in DIVAL
"RTN","DIC4",63,0)
 I $G(DINDEX(DISUB,"TRANOUT"))]"" D  Q
"RTN","DIC4",64,0)
 . S DIVAL=DINDEX(DISUB) Q:DIVAL=""  N X S X=DIVAL
"RTN","DIC4",65,0)
 . X DINDEX(DISUB,"TRANOUT") S:X]"" DIVAL=X Q
"RTN","DIC4",66,0)
 S @DINDEX(DISUB,"GET") Q:DIVAL=""
"RTN","DIC4",67,0)
 I "VPSD"[DINDEX(DISUB,"TYPE")!(DISUB=1&($G(DS("INT"))]"")) D
"RTN","DIC4",68,0)
 . I DISUB>1,"VP"[DINDEX(DISUB,"TYPE") Q
"RTN","DIC4",69,0)
 . S DIVAL=$$EXT^DIC2(DINDEX(DISUB,"FILE"),DINDEX(DISUB,"FIELD"),DIVAL) Q
"RTN","DIC4",70,0)
 Q
"RTN","DIC4",71,0)
 ;
"RTN","DIC4",72,0)
IXCHK(DIFILEI,DINDEX,DIOK,DIALLVAL,DIVAL,DID) ; Build INDEX info, make sure indexed field not a pointer.
"RTN","DIC4",73,0)
 S DIOK=0 N DIVALX S DIVALX=$G(DIVAL(1))
"RTN","DIC4",74,0)
 N DIXIEN S DIXIEN=+$O(^DD("IX","BB",DIFILEI,DINDEX,""))
"RTN","DIC4",75,0)
 I DIXIEN,$G(DID)="",$P($G(^DD("IX",DIXIEN,0)),U,14)'["L" Q
"RTN","DIC4",76,0)
 I 'DIXIEN!('$O(^DD("IX",DIXIEN,11.1,"AC",1))) D  Q
"RTN","DIC4",77,0)
 . N DIFLAGS S DIFLAGS="hql" S:$G(DILONGX)!(DIC(0)["T") DIFLAGS="4l"
"RTN","DIC4",78,0)
 . I +$P(DIVALX,"E")=DIVALX,DIC(0)["E" S DIFLAGS="4l"
"RTN","DIC4",79,0)
 . D INDEX^DICUIX(.DIFILEI,DIFLAGS,.DINDEX)
"RTN","DIC4",80,0)
 . I +$P(DIVALX,"E")=DIVALX,$G(DINDEX(1,"TYPE"))="P" D  Q  ;22*70
"RTN","DIC4",81,0)
 . . I DIC(0)["T",DIC(0)["E" S (DIOK,DIOK("T"))=1 ;22*70
"RTN","DIC4",82,0)
 . S DIOK=1 Q
"RTN","DIC4",83,0)
 D INDEX^DICUIX(.DIFILEI,"4l",.DINDEX,"",.DIVAL)
"RTN","DIC4",84,0)
 S (DIALLVAL,DIOK)=1
"RTN","DIC4",85,0)
 N I F I=1:1:DINDEX("#") S:$G(DINDEX(I,"PART"))="" DIALLVAL=0
"RTN","DIC4",86,0)
 Q
"RTN","DIC4",87,0)
 ;
"RTN","DIC4",88,0)
PROCERR ; Display errors generated from call to Finder.
"RTN","DIC4",89,0)
 I DIC(0)'["E" K DIERR Q
"RTN","DIC4",90,0)
 W $C(7) W:'$D(DDS) !
"RTN","DIC4",91,0)
 N A1,DDH,I,J S DDH=0
"RTN","DIC4",92,0)
 F I=1:1:+DIERR F J=0:0 S J=$O(DIERR("DIERR",I,"TEXT",J)) Q:'J  D
"RTN","DIC4",93,0)
 . I '$D(DDS) W DIERR("DIERR",I,"TEXT",J),! Q
"RTN","DIC4",94,0)
 . S DDH=DDH+1,DDH(DDH)=DIERR("DIERR",I,"TEXT",J) Q
"RTN","DIC4",95,0)
 K DIERR I '$D(DDS) W !! Q
"RTN","DIC4",96,0)
 S A1="T" D LIST^DDSU Q
"RTN","DIC4",97,0)
 ;
"RTN","DIC5")
0^4^B8130256
"RTN","DIC5",1,0)
DIC5 ;SFISC/XAK,TKW,SEA/TOAD-VA FileMan: Lookup, Part 1 (utilities) ;1:56 PM  19 Sep 2002
"RTN","DIC5",2,0)
 ;;22.0;VA FileMan;**4,20,31,70**;Mar 30, 1999
"RTN","DIC5",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIC5",4,0)
NODE75 ; Do after executing 7.5 node on DD, called from ^DIC
"RTN","DIC5",5,0)
 I $D(X)#2 S (DIVAL,DIVAL(1))=X Q
"RTN","DIC5",6,0)
 S Y=-1 Q:DIC(0)'["Q"!(DIC(0)'["E")
"RTN","DIC5",7,0)
 W $C(7) Q:$D(DDS)
"RTN","DIC5",8,0)
 W !,$$EZBLD^DIALOG(120,$$EZBLD^DIALOG(8090)) Q
"RTN","DIC5",9,0)
 ;
"RTN","DIC5",10,0)
BYIEN1 ; Lookup record by IEN when user enters `n for a number 'n', called from ^DIC
"RTN","DIC5",11,0)
 S Y=$E(X,2,30) I Y="" S Y=-1 Q
"RTN","DIC5",12,0)
 N % S %=DINDEX("START") N DINDEX S DINDEX="",DINDEX("#")=1,DINDEX("START")=%
"RTN","DIC5",13,0)
 D S^DIC3 I '$T S Y=-1 Q
"RTN","DIC5",14,0)
 N DD,DS,DZ S DS=1,DD=Y,DIX=X D ADDKEY^DIC3,GOT^DIC2
"RTN","DIC5",15,0)
 Q
"RTN","DIC5",16,0)
 ;
"RTN","DIC5",17,0)
BYIEN2 ; Lookup record by IEN when user enters a numeric lookup value, called from ^DIC
"RTN","DIC5",18,0)
 Q:DO(2)<0!($D(DF))
"RTN","DIC5",19,0)
 N T S T=DINDEX(1,"TYPE")
"RTN","DIC5",20,0)
 I $D(@(DIC_"X,0)")) D  Q:Y>0
"RTN","DIC5",21,0)
 . N DD S DD=$D(^DD(DIFILEI,.001))
"RTN","DIC5",22,0)
 . I 'DD Q:T["N"  I '$O(@(DIC_"""A["")")),$O(^("A["))]"" Q
"RTN","DIC5",23,0)
 . N % S %=DINDEX("START") N DINDEX S DINDEX="",DINDEX("#")=1,DINDEX("START")=%
"RTN","DIC5",24,0)
 . S Y=X D S^DIC3 I '$T S Y=-1 Q
"RTN","DIC5",25,0)
 . N DZ,DS,DIX S DS=1,DIX=X D ADDKEY^DIC3,GOT^DIC2 Q
"RTN","DIC5",26,0)
 I T["P"!(T["V"),DIC(0)'["U" S DISKIPIX=D
"RTN","DIC5",27,0)
 Q
"RTN","DIC5",28,0)
 ;
"RTN","DIC5",29,0)
SPACEBAR ; Lookup last record selected by this user when user enters space bar return.  Called from ^DIC
"RTN","DIC5",30,0)
 N % S %=DINDEX("START") N DINDEX S DINDEX="",DINDEX("#")=1,DINDEX("START")=%
"RTN","DIC5",31,0)
 D S^DIC3 I '$T S Y=-1 Q
"RTN","DIC5",32,0)
 N DZ,DS,DIX S DS=1,DIX=X D ADDKEY^DIC3,GOT^DIC2 Q
"RTN","DIC5",33,0)
 ;
"RTN","DIC5",34,0)
KEEPON ; If DIC(0)["T", display entries found so far, then check for internal value if index is date, set, pointer, VP.  Called from ^DIC3.
"RTN","DIC5",35,0)
 I DS D  Q:Y>0!($G(DTOUT))!($G(DIROUT))
"RTN","DIC5",36,0)
 . N I M I=X N X M X=I S I=D N D S D=I K I
"RTN","DIC5",37,0)
 . I DS=1 D
"RTN","DIC5",38,0)
 . . S DS("DD")=1 D G^DIC2 Q
"RTN","DIC5",39,0)
 . E  I $G(DS("DD"))'=DS D Y^DIC1 I '$D(DIROUT),$D(DUOUT) K DUOUT ;22*70
"RTN","DIC5",40,0)
 . K DD,DS,DIX,DIYX S (DD,DS,DS("DD"))=0
"RTN","DIC5",41,0)
 . S:DIC(0)["E" DS(0,"HDRDSP",DIFILEI)=1
"RTN","DIC5",42,0)
 . S DS(0)=$S(Y>0:"1^"_+Y,$G(DTOUT):"1^T",$G(DIROUT):"1^U",1:0)
"RTN","DIC5",43,0)
 . Q
"RTN","DIC5",44,0)
 Q:DIC(0)["U"  I DINDEX=DINDEX("START"),$G(DINDEX("#"))>1 Q
"RTN","DIC5",45,0)
 N I M I=X N X M X=I S I=D N D S D=I K I
"RTN","DIC5",46,0)
 D 1^DICM
"RTN","DIC5",47,0)
 K DD,DS,DIX,DIYX S (DD,DS,DS("DD"))=0
"RTN","DIC5",48,0)
 S DS(0)=$S(Y>0:"1^"_+Y,$G(DTOUT):"1^T",$G(DIROUT):"1^U",1:0)
"RTN","DIC5",49,0)
 Q
"RTN","DIC5",50,0)
 ;
"RTN","DIC5",51,0)
PTRID(DO,DIC) ; Build code in DIC("W") to display Identifiers on pointed-to files
"RTN","DIC5",52,0)
 N DIFILEI,DIGBL,DIOGBL S DIFILEI=+DO(2),DIOGBL=DIC
"RTN","DIC5",53,0)
 F  S DIFILEI=+$P($P($G(^DD(DIFILEI,.01,0)),U,2),"P",2) Q:'DIFILEI  S DIGBL=$G(^DIC(DIFILEI,0,"GL")) Q:DIGBL=""  D Q
"RTN","DIC5",54,0)
 Q
"RTN","DIC5",55,0)
Q ; Build Identifier code for a single pointed-to file
"RTN","DIC5",56,0)
 N DIGBL1 S DIGBL1=DIGBL
"RTN","DIC5",57,0)
 I DIGBL[$C(34) S DIGBL1=$$CONVQQ^DILIBF(DIGBL)
"RTN","DIC5",58,0)
 N N,O,% S N=$O(DIC("W",999999),-1)
"RTN","DIC5",59,0)
 S O=$S(N:DIC("W",N),1:DIC("W"))
"RTN","DIC5",60,0)
 N % S %="I '$G(DICR) S DIEN=+"_DIOGBL_"DIEN,0) I $D("_DIGBL_"DIEN,0)) S DIFILEI="_DIFILEI_",DIGBL="""_DIGBL1_""" D WOV^DICQ1"
"RTN","DIC5",61,0)
 S DIOGBL=DIGBL
"RTN","DIC5",62,0)
 I ($L(O)+$L(%))<230 D  Q
"RTN","DIC5",63,0)
 . I 'N S DIC("W")=DIC("W")_" "_% Q
"RTN","DIC5",64,0)
 . S DIC("W",N)=DIC("W",N)_" "_% Q
"RTN","DIC5",65,0)
 S N=N+1,DIC("W",N)=%
"RTN","DIC5",66,0)
 I N=1 S DIC("W")=DIC("W")_" X DIC(""W"",1)" Q
"RTN","DIC5",67,0)
 S DIC("W",N-1)=DIC("W",N-1)_" X DIC(""W"","_N_")"
"RTN","DIC5",68,0)
 Q
"RTN","DIC5",69,0)
 ;
"RTN","DICF1")
0^1^B22309773
"RTN","DICF1",1,0)
DICF1 ;SEA/TOAD,SF/TKW-VA FileMan: Finder, Part 2 (Transform) ;7:15 AM  4 Sep 2001
"RTN","DICF1",2,0)
 ;;22.0;VA FileMan;**15,51,70**;Mar 30, 1999
"RTN","DICF1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DICF1",4,0)
 ;
"RTN","DICF1",5,0)
XFORM(DIFLAGS,DIVALUE,DISCREEN,DINDEX) ;
"RTN","DICF1",6,0)
 ; FIND--produce array of values and screens by transforming input
"RTN","DICF1",7,0)
 ; subroutine, DIVALUE, DINDEX, & DISCREEN passed by reference
"RTN","DICF1",8,0)
 N DISUB F DISUB=1:1:DINDEX("#") D VALUES
"RTN","DICF1",9,0)
 Q
"RTN","DICF1",10,0)
VALUES ; Set original lookup value into array.
"RTN","DICF1",11,0)
 I $D(DIVALUE(DISUB,0,1)) S DIVALUE(DISUB)=DIVALUE(DISUB,0,1)
"RTN","DICF1",12,0)
 N I F I="PART","FROM","TO" I $D(DIVALUE(DISUB,0,1,I)) D
"RTN","DICF1",13,0)
 . S DINDEX(DISUB,I)=DIVALUE(DISUB,0,1,I) Q
"RTN","DICF1",14,0)
 D
"RTN","DICF1",15,0)
 . S I=-1 F  S I=$O(DIVALUE(DISUB,I)) Q:I=""  K DIVALUE(DISUB,I)
"RTN","DICF1",16,0)
 . S I=-1 F  S I=$O(DISCREEN(DISUB,I)) Q:I=""  K DISCREEN(DISUB,I)
"RTN","DICF1",17,0)
 . Q
"RTN","DICF1",18,0)
 S DIVALUE(DISUB,1)=DIVALUE(DISUB)
"RTN","DICF1",19,0)
 Q:DIVALUE(DISUB)=""
"RTN","DICF1",20,0)
 I DIFLAGS["Q" D LONG Q
"RTN","DICF1",21,0)
LOWER ;
"RTN","DICF1",22,0)
 I DIVALUE(DISUB)?.E1L.E,DIFLAGS'["X" D
"RTN","DICF1",23,0)
 . S DIVALUE(DISUB,2)=$$OUT^DIALOGU(DIVALUE(DISUB),"UC")
"RTN","DICF1",24,0)
 . Q
"RTN","DICF1",25,0)
 ;
"RTN","DICF1",26,0)
CHK ; Quit if data type not free-text, pointer or vp, or if lookup value is numeric or a date.
"RTN","DICF1",27,0)
 I "PVF"'[$G(DINDEX(DISUB,"TYPE"))!(DIVALUE(DISUB)?.NP) Q
"RTN","DICF1",28,0)
 N Y D  Q:Y>0
"RTN","DICF1",29,0)
 . N X S X=DIVALUE(DISUB) N %DT,DIFLAGS,DIVALUE,DISCREEN,DINDEX,DISUB
"RTN","DICF1",30,0)
 . S %DT="T" D ^%DT Q
"RTN","DICF1",31,0)
COMMA I DIVALUE(DISUB)[",",DIFLAGS'["X" D
"RTN","DICF1",32,0)
 . N DISTEMP,DIPIECE1 S DISTEMP="",DIPIECE1=$P(DIVALUE(DISUB),",")
"RTN","DICF1",33,0)
 . Q:$L(DIPIECE1)>DINDEX(DISUB,"LENGTH")
"RTN","DICF1",34,0)
 . Q:'$L(DIPIECE1)  ;SO
"RTN","DICF1",35,0)
21 . I DIFLAGS["C" D
"RTN","DICF1",36,0)
 . . N DIPART1 S DIPART1=" I %?.E1P1"""
"RTN","DICF1",37,0)
 . . N DIPART2 S DIPART2=""".E!(D'=""B""&(%?1"""
"RTN","DICF1",38,0)
 . . N DIPART3 S DIPART3=""".E))"
"RTN","DICF1",39,0)
 . . N DIOUT S DIOUT=0
"RTN","DICF1",40,0)
 . . N DIPIECE,DIVPIECE F DIPIECE=2:1 D  I DIOUT Q
"RTN","DICF1",41,0)
 . . . S DIVPIECE=$P(DIVALUE(DISUB),",",DIPIECE)
"RTN","DICF1",42,0)
 . . . I DIVPIECE["""" Q
"RTN","DICF1",43,0)
 . . . I $E(DIVPIECE)=" " S DIVPIECE=$E(DIVPIECE,2,$L(DIVPIECE))
"RTN","DICF1",44,0)
 . . . I DIVPIECE="" S DIOUT=1 Q
"RTN","DICF1",45,0)
 . . . I $L(DIVPIECE)*2+$L(DISTEMP)+33+14+34>255 S DIOUT=1 Q
"RTN","DICF1",46,0)
 . . . S DISTEMP=DISTEMP_DIPART1_DIVPIECE_DIPART2_DIVPIECE_DIPART3
"RTN","DICF1",47,0)
 . . . Q:DISTEMP=""
"RTN","DICF1",48,0)
 . . . S DISTEMP="S %=DIVAL"_DISTEMP Q
"RTN","DICF1",49,0)
 . . I DISTEMP="" Q
"RTN","DICF1",50,0)
22 . I DIFLAGS'["C" N DIPIECE2,DIPC2 D
"RTN","DICF1",51,0)
 . . S (DIPC2,DIPIECE2)=$P(DIVALUE(DISUB),",",2)
"RTN","DICF1",52,0)
 . . I DIPIECE2["""" S DIPC2=$$CONVQQ^DILIBF(DIPIECE2)
"RTN","DICF1",53,0)
 . . S DISTEMP="S %=$P(DIVAL,"","",2) I $E(%,1,"_$L(DIPIECE2)_")="""_DIPC2_""""
"RTN","DICF1",54,0)
 . . Q
"RTN","DICF1",55,0)
23 . S DIVALUE(DISUB,3)=DIPIECE1
"RTN","DICF1",56,0)
 . S DISCREEN(DISUB,3)=DISTEMP
"RTN","DICF1",57,0)
 . I DIFLAGS'["C" S DIVALUE(DISUB,3,"c")=DIPIECE2
"RTN","DICF1",58,0)
24 . I DIVALUE(DISUB)'?.E1L.E Q
"RTN","DICF1",59,0)
 . S DIVALUE(DISUB,4)=$$OUT^DIALOGU(DIPIECE1,"UC")
"RTN","DICF1",60,0)
 . S DISCREEN(DISUB,4)=$$OUT^DIALOGU(DISTEMP,"UC")
"RTN","DICF1",61,0)
 . I DIFLAGS'["C" S DIVALUE(DISUB,4,"c")=$$OUT^DIALOGU(DIPIECE2,"UC")
"RTN","DICF1",62,0)
 ;
"RTN","DICF1",63,0)
LONG I $L(DIVALUE(DISUB))'>DINDEX(DISUB,"LENGTH") Q
"RTN","DICF1",64,0)
 N J,X,DISLONG,DISPART,DISXACT,DIREF
"RTN","DICF1",65,0)
 F I=0:0 S I=$O(DIVALUE(DISUB,I)) Q:'I  D
"RTN","DICF1",66,0)
 . N L,M S L=DINDEX(DISUB,"LENGTH")
"RTN","DICF1",67,0)
 . Q:$L(DIVALUE(DISUB,I))'>L
"RTN","DICF1",68,0)
 . S X=DIVALUE(DISUB,I) K DIVALUE(DISUB,I) S DIVALUE(DISUB,0,I)=X
"RTN","DICF1",69,0)
 . I $G(DISCREEN(DISUB,I))]"" S X=DISCREEN(DISUB,I) K DISCREEN(DISUB,I) S DISCREEN(DISUB,0,I)=X
"RTN","DICF1",70,0)
 . S DIVALUE(DISUB,I)=$E(DIVALUE(DISUB,0,I),1,L)
"RTN","DICF1",71,0)
 . I I=1 D
"RTN","DICF1",72,0)
 . . S (DIVALUE(DISUB),DINDEX(DISUB))=DIVALUE(DISUB,I)
"RTN","DICF1",73,0)
 . . F J="PART","FROM","TO" S M=$L($G(DINDEX(DISUB,J))) D:M>L
"RTN","DICF1",74,0)
 . . . S DIVALUE(DISUB,0,I,J)=DINDEX(DISUB,J)
"RTN","DICF1",75,0)
 . . . S DINDEX(DISUB,J)=$E(DINDEX(DISUB,J),1,L) Q
"RTN","DICF1",76,0)
 . . Q
"RTN","DICF1",77,0)
 . S DISLONG=""
"RTN","DICF1",78,0)
 . I $D(DISCREEN(DISUB,0,I)) S DISLONG=" X DISCREEN("_DISUB_",0,"_I_")"
"RTN","DICF1",79,0)
 . S DIREF="DINDEX("_DISUB_",0,"_I_")"
"RTN","DICF1",80,0)
 . S DISPART="I $P(DIVAL,$G("_DIREF_"))="""""_DISLONG ;DI*22*70
"RTN","DICF1",81,0)
 . S DISXACT="I $P(DIVAL,U)="_DIREF_DISLONG
"RTN","DICF1",82,0)
L10 . I DIFLAGS["X" S DISCREEN(DISUB,I)=DISXACT Q
"RTN","DICF1",83,0)
 . I DIFLAGS'["O" S DISCREEN(DISUB,I)=DISPART Q
"RTN","DICF1",84,0)
 . S DISCREEN(DISUB,I)=DISXACT
"RTN","DICF1",85,0)
 . S DISCREEN(DISUB,I,2)=DISPART
"RTN","DICF1",86,0)
 . Q
"RTN","DICF1",87,0)
 Q
"RTN","DICF1",88,0)
 ;
"RTN","DICF1",89,0)
SPECIAL(DIFILE,DIEN,DIFIEN,DIFLAGS,DIVALUE,DINDEX,DISCREEN,DIDENT,DIOUT,DILIST) ;
"RTN","DICF1",90,0)
 ; Process space-bar return, 'IEN or DIVALUE equal to an IEN.
"RTN","DICF1",91,0)
 S DIOUT=0
"RTN","DICF1",92,0)
11 I DIVALUE=" " D  S DIOUT=1 Q
"RTN","DICF1",93,0)
 . N DIROOT S DIROOT=$$ROOT^DIQGU(DIFILE,DIFIEN,"Q")
"RTN","DICF1",94,0)
 . N DINODE S DINODE=$G(^DISV(DUZ,$E(DIROOT,1,28)))
"RTN","DICF1",95,0)
 . N DINODEL S DINODEL=$L(DINODE,",")
"RTN","DICF1",96,0)
 . I $P(DINODE,",",1,DINODEL-1)'=$E(DIROOT,29,9999) Q
"RTN","DICF1",97,0)
 . S DIEN=$P(DINODE,",",DINODEL)
"RTN","DICF1",98,0)
 . I 'DIEN S DIEN="" Q
"RTN","DICF1",99,0)
 . D ENTRY Q
"RTN","DICF1",100,0)
12 I DIVALUE?1"`".NP D  Q:DIOUT=1
"RTN","DICF1",101,0)
 . S DIEN=$E(DIVALUE,2,$L(DIVALUE)) Q:+DIEN'=DIEN
"RTN","DICF1",102,0)
 . D ENTRY S DIOUT=1 Q
"RTN","DICF1",103,0)
13 I $S(DIVALUE?1.N:1,DIVALUE'?.NP:0,1:+DIVALUE=DIVALUE) D
"RTN","DICF1",104,0)
 . N DI001 S DI001=$D(^DD(DIFILE,.001))
"RTN","DICF1",105,0)
 . N DI01FLAG S DI01FLAG=$P($G(^DD(DIFILE,.01,0)),U,2)
"RTN","DICF1",106,0)
 . I $D(@DIFILE(DIFILE)@(DIVALUE)) D
"RTN","DICF1",107,0)
 . . I DIFLAGS'["A",'DI001,DI01FLAG["N"!($O(@DIFILE(DIFILE)@("A["))'="") Q
"RTN","DICF1",108,0)
 . . S DIEN=DIVALUE
"RTN","DICF1",109,0)
 . . D ENTRY
"RTN","DICF1",110,0)
 . . I $G(DINDEX("DONE"))!($G(DIERR)) S DIEN="",DIOUT=1
"RTN","DICF1",111,0)
 Q
"RTN","DICF1",112,0)
 ;
"RTN","DICF1",113,0)
ENTRY ; Execute screens, and if entry passes, do ACCEPT to add it to output.
"RTN","DICF1",114,0)
 N DI0NODE S DI0NODE=$G(@DIFILE(DIFILE)@(DIEN,0))
"RTN","DICF1",115,0)
 Q:$$SCREEN^DICL2(.DIFILE,.DIEN,DIFLAGS,DIFIEN,.DISCREEN,.DINDEX,DI0NODE)
"RTN","DICF1",116,0)
 D ACCEPT^DICL2(.DIFILE,.DIEN,.DIFLAGS,DIFIEN,.DINDEX,.DIDENT,.DILIST,DI0NODE)
"RTN","DICF1",117,0)
 Q
"RTN","DIENVWRN")
0^^B3680036
"RTN","DIENVWRN",1,0)
DIENVWRN ;IRMFO-SF/FM STAFF-ENVIRONMENT CHECK ROUTINE ;6:50 AM  24 Mar 2000
"RTN","DIENVWRN",2,0)
 ;;22.0;VA FileMan;;Mar 30, 1999
"RTN","DIENVWRN",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIENVWRN",4,0)
 ;
"RTN","DIENVWRN",5,0)
 ; Check XPDENV 0 = Loading; 1 = Installing
"RTN","DIENVWRN",6,0)
 I 'XPDENV Q  ; Loading Distribution - No Check
"RTN","DIENVWRN",7,0)
 ;
"RTN","DIENVWRN",8,0)
INSCHK ; Do Checks During Install Only
"RTN","DIENVWRN",9,0)
 W $C(7)
"RTN","DIENVWRN",10,0)
 D MES^XPDUTL("** Although Queuing is allowed - it is HIGHLY recommended that ALL Users and")
"RTN","DIENVWRN",11,0)
 D MES^XPDUTL("VISTA Background jobs be STOPPED before installation of this patch.  Failure")
"RTN","DIENVWRN",12,0)
 D MES^XPDUTL("to do so may result in 'source routine edited' error(s). Edits will be")
"RTN","DIENVWRN",13,0)
 D MES^XPDUTL("lost and record(s) may be left in an inconsistent state, for example,")
"RTN","DIENVWRN",14,0)
 D MES^XPDUTL("not all Cross-Referencing completed; which in turn may cause FUTURE")
"RTN","DIENVWRN",15,0)
 D MES^XPDUTL("VistA/FileMan Hard Errors or corrupted Data. **")
"RTN","DIENVWRN",16,0)
 ;
"RTN","DIENVWRN",17,0)
TMCHK ; Check to see if TaskMan is still running
"RTN","DIENVWRN",18,0)
 S X=$$TM^%ZTLOAD
"RTN","DIENVWRN",19,0)
 I X,'$D(^%ZTSCH("WAIT")) D
"RTN","DIENVWRN",20,0)
 . W $C(7)
"RTN","DIENVWRN",21,0)
 . D BMES^XPDUTL("* Warning TaskMan Has NOT Been Stopped or Placed in a WAIT State!")
"RTN","DIENVWRN",22,0)
 ;
"RTN","DIENVWRN",23,0)
LINH ; Check to see if Logons are Inhibited
"RTN","DIENVWRN",24,0)
 D GETENV^%ZOSV  ; $P(Y,"^",2) = Installing Volume
"RTN","DIENVWRN",25,0)
 S X=+$G(^%ZIS(14.5,"LOGON",$P(Y,"^",2)))
"RTN","DIENVWRN",26,0)
 I 'X D
"RTN","DIENVWRN",27,0)
 . W $C(7)
"RTN","DIENVWRN",28,0)
 . D BMES^XPDUTL("* Warning Logons are NOT Inhibited!")
"RTN","DIENVWRN",29,0)
 Q
"VER")
8.0^22.0
**END**
**END**
