Released PRC*5.1*95 SEQ #90
Extracted from mail message
**KIDS**:PRC*5.1*95^

**INSTALL NAME**
PRC*5.1*95
"BLD",4941,0)
PRC*5.1*95^IFCAP^0^3060929^y
"BLD",4941,1,0)
^^1^1^3060113^
"BLD",4941,1,1,0)
CLEANUP IFCAP ARCHIVE/PURGE PROCESS
"BLD",4941,4,0)
^9.64PA^^
"BLD",4941,6)
12^
"BLD",4941,"INI")
START^PRCIN45
"BLD",4941,"INID")
^y^y
"BLD",4941,"INIT")
START^PRCINAR
"BLD",4941,"KRN",0)
^9.67PA^8989.52^19
"BLD",4941,"KRN",.4,0)
.4
"BLD",4941,"KRN",.401,0)
.401
"BLD",4941,"KRN",.402,0)
.402
"BLD",4941,"KRN",.403,0)
.403
"BLD",4941,"KRN",.5,0)
.5
"BLD",4941,"KRN",.84,0)
.84
"BLD",4941,"KRN",3.6,0)
3.6
"BLD",4941,"KRN",3.8,0)
3.8
"BLD",4941,"KRN",9.2,0)
9.2
"BLD",4941,"KRN",9.8,0)
9.8
"BLD",4941,"KRN",9.8,"NM",0)
^9.68A^16^12
"BLD",4941,"KRN",9.8,"NM",1,0)
PRCGPM^^0^B4567484
"BLD",4941,"KRN",9.8,"NM",2,0)
PRCGPM1^^0^B7468104
"BLD",4941,"KRN",9.8,"NM",3,0)
PRCG238P^^0^B21136365
"BLD",4941,"KRN",9.8,"NM",4,0)
PRCGPPC1^^0^B2351004
"BLD",4941,"KRN",9.8,"NM",9,0)
PRCSP122^^0^B10606515
"BLD",4941,"KRN",9.8,"NM",10,0)
PRCIN45^^0^B4217688
"BLD",4941,"KRN",9.8,"NM",11,0)
PRCINAR^^0^B10282916
"BLD",4941,"KRN",9.8,"NM",12,0)
PRCG237P^^0^B2295253
"BLD",4941,"KRN",9.8,"NM",13,0)
PRCG239P^^0^B952278
"BLD",4941,"KRN",9.8,"NM",14,0)
PRCG239Q^^0^B13467421
"BLD",4941,"KRN",9.8,"NM",15,0)
PRCG237Q^^0^B17692851
"BLD",4941,"KRN",9.8,"NM",16,0)
PRCCL406^^0^B953739
"BLD",4941,"KRN",9.8,"NM","B","PRCCL406",16)

"BLD",4941,"KRN",9.8,"NM","B","PRCG237P",12)

"BLD",4941,"KRN",9.8,"NM","B","PRCG237Q",15)

"BLD",4941,"KRN",9.8,"NM","B","PRCG238P",3)

"BLD",4941,"KRN",9.8,"NM","B","PRCG239P",13)

"BLD",4941,"KRN",9.8,"NM","B","PRCG239Q",14)

"BLD",4941,"KRN",9.8,"NM","B","PRCGPM",1)

"BLD",4941,"KRN",9.8,"NM","B","PRCGPM1",2)

"BLD",4941,"KRN",9.8,"NM","B","PRCGPPC1",4)

"BLD",4941,"KRN",9.8,"NM","B","PRCIN45",10)

"BLD",4941,"KRN",9.8,"NM","B","PRCINAR",11)

"BLD",4941,"KRN",9.8,"NM","B","PRCSP122",9)

"BLD",4941,"KRN",19,0)
19
"BLD",4941,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",4941,"KRN",19,"NM",1,0)
PRCG LOAD 417 PURGMASTER^^0
"BLD",4941,"KRN",19,"NM","B","PRCG LOAD 417 PURGMASTER",1)

"BLD",4941,"KRN",19.1,0)
19.1
"BLD",4941,"KRN",101,0)
101
"BLD",4941,"KRN",409.61,0)
409.61
"BLD",4941,"KRN",771,0)
771
"BLD",4941,"KRN",870,0)
870
"BLD",4941,"KRN",8989.51,0)
8989.51
"BLD",4941,"KRN",8989.52,0)
8989.52
"BLD",4941,"KRN",8994,0)
8994
"BLD",4941,"KRN","B",.4,.4)

"BLD",4941,"KRN","B",.401,.401)

"BLD",4941,"KRN","B",.402,.402)

"BLD",4941,"KRN","B",.403,.403)

"BLD",4941,"KRN","B",.5,.5)

"BLD",4941,"KRN","B",.84,.84)

"BLD",4941,"KRN","B",3.6,3.6)

"BLD",4941,"KRN","B",3.8,3.8)

"BLD",4941,"KRN","B",9.2,9.2)

"BLD",4941,"KRN","B",9.8,9.8)

"BLD",4941,"KRN","B",19,19)

"BLD",4941,"KRN","B",19.1,19.1)

"BLD",4941,"KRN","B",101,101)

"BLD",4941,"KRN","B",409.61,409.61)

"BLD",4941,"KRN","B",771,771)

"BLD",4941,"KRN","B",870,870)

"BLD",4941,"KRN","B",8989.51,8989.51)

"BLD",4941,"KRN","B",8989.52,8989.52)

"BLD",4941,"KRN","B",8994,8994)

"BLD",4941,"QUES",0)
^9.62^^
"BLD",4941,"REQB",0)
^9.611^^
"INI")
START^PRCIN45
"INIT")
START^PRCINAR
"KRN",19,12175,-1)
0^1
"KRN",19,12175,0)
PRCG LOAD 417 PURGMASTER^Load IFCAP File 417 Data into PurgeMaster^^R^^^^^^^^IFCAP
"KRN",19,12175,1,0)
^^4^4^3060619^
"KRN",19,12175,1,1,0)
This option selects records in file 417, through a specified fiscal year
"KRN",19,12175,1,2,0)
entered by the user, and creates entries for them in the IFCAP PurgeMaster
"KRN",19,12175,1,3,0)
File (443.1) for purging.  FMS reconcilliation data that meets the date 
"KRN",19,12175,1,4,0)
requirements the user entered in file 417 are then purged by PurgeMaster.
"KRN",19,12175,25)
PRCG239Q
"KRN",19,12175,"U")
LOAD IFCAP FILE 417 DATA INTO 
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
95^3060929^123456803
"PKG",455,22,1,"PAH",1,1,0)
^^1^1^3060929
"PKG",455,22,1,"PAH",1,1,1,0)
CLEANUP IFCAP ARCHIVE/PURGE PROCESS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","PRCCL406")
0^16^B953739^n/a
"RTN","PRCCL406",1,0)
PRCCL406 ;BP-OIFO/SWS-IFCAP ARCHIVE/PURGE UTILITY ROUTINE ;12/07/2005  12:16
"RTN","PRCCL406",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCCL406",3,0)
 Q
"RTN","PRCCL406",4,0)
START S IPIEN=0,NREC=0,TREC=0
"RTN","PRCCL406",5,0)
 F  S IPIEN=$O(^PRCH(440.6,"PO",IPIEN)) Q:IPIEN'>0  D
"RTN","PRCCL406",6,0)
 .S IEN=0
"RTN","PRCCL406",7,0)
 .I '$D(^PRC(442,IPIEN)) D
"RTN","PRCCL406",8,0)
 ..S TREC=TREC+1
"RTN","PRCCL406",9,0)
 ..S IEN=0
"RTN","PRCCL406",10,0)
 ..F  S IEN=$O(^PRCH(440.6,"PO",IPIEN,IEN)) Q:'IEN  D KILL4406
"RTN","PRCCL406",11,0)
 ..Q
"RTN","PRCCL406",12,0)
 .Q
"RTN","PRCCL406",13,0)
 D CLEAN
"RTN","PRCCL406",14,0)
 Q
"RTN","PRCCL406",15,0)
KILL4406 ;set temp files then kill invalid 440.6 records
"RTN","PRCCL406",16,0)
 N DA
"RTN","PRCCL406",17,0)
 S NREC=NREC+1
"RTN","PRCCL406",18,0)
 S ^XTMP("IFCAP-PURGE-440-6",IPIEN,IEN)=^PRCH(440.6,IEN,0)
"RTN","PRCCL406",19,0)
 S ^XTMP("IFCAP-PURGE-440-6-REF",IPIEN,IEN)="PO^"_IPIEN_"^"_IEN
"RTN","PRCCL406",20,0)
 S DA=IEN
"RTN","PRCCL406",21,0)
 S DIK="^PRCH(440.6," D ^DIK
"RTN","PRCCL406",22,0)
 K DIK,DA
"RTN","PRCCL406",23,0)
 Q
"RTN","PRCCL406",24,0)
CLEAN K IEN,IPIEN,TREC,NREC
"RTN","PRCCL406",25,0)
 Q
"RTN","PRCG237P")
0^12^B2295253^B1594280
"RTN","PRCG237P",1,0)
PRCG237P ;WISC/BGJ - IFCAP 442 FILE CLEANUP (PURGE); 11/5/99 12:22pm ;9/20/00  12:56
"RTN","PRCG237P",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCG237P",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCG237P",4,0)
 ;This routine is installed by patch PRC*5*237.
"RTN","PRCG237P",5,0)
 ;The purpose of this routine is to clean up Accounts Receivable entries
"RTN","PRCG237P",6,0)
 ;in file 442 that were not purged by running the Archive/Purge
"RTN","PRCG237P",7,0)
 ;functionality.  It will also purge entries in file 442 that do not
"RTN","PRCG237P",8,0)
 ;have a date in the P.O. DATE field (DATE P.O. ASSIGNED field is used
"RTN","PRCG237P",9,0)
 ;for comparison).  Routine PRCG237Q is a routine installed by patch
"RTN","PRCG237P",10,0)
 ;237 that queues entries into PurgeMaster for purging.  Those entries
"RTN","PRCG237P",11,0)
 ;are then purged by this routine as PurgeMaster cycles through file
"RTN","PRCG237P",12,0)
 ;443.1 (PurgeMaster Worklist).
"RTN","PRCG237P",13,0)
 ;
"RTN","PRCG237P",14,0)
442(X) ;
"RTN","PRCG237P",15,0)
 N DA,KDA,BEGDA,ENDA,PODATE,DTPOASN,SITE,DATE,ZERONODE,MOP
"RTN","PRCG237P",16,0)
 D UNLOAD
"RTN","PRCG237P",17,0)
 F  S DA=$O(^PRC(442,DA)) Q:'DA!(DA>ENDA)  D
"RTN","PRCG237P",18,0)
 . S ZERONODE=$G(^PRC(442,DA,0))
"RTN","PRCG237P",19,0)
 . I $P(ZERONODE,"-")'=SITE Q
"RTN","PRCG237P",20,0)
 . S PODATE=$P($G(^PRC(442,DA,1)),"^",15)
"RTN","PRCG237P",21,0)
 . I PODATE>DATE Q
"RTN","PRCG237P",22,0)
 . I +PODATE=0 D  Q
"RTN","PRCG237P",23,0)
 . . S DTPOASN=$P($P($G(^PRC(442,DA,12)),"^",5),".")
"RTN","PRCG237P",24,0)
 . . I DTPOASN>DATE Q
"RTN","PRCG237P",25,0)
 . . S KDA=DA D KILL442(KDA)
"RTN","PRCG237P",26,0)
 . S MOP=$P(ZERONODE,"^",2)
"RTN","PRCG237P",27,0)
 . I 'MOP Q
"RTN","PRCG237P",28,0)
 . S MOP=$P($G(^PRCD(442.5,MOP,0)),"^",2)
"RTN","PRCG237P",29,0)
 . I MOP="AR" S KDA=DA D KILL442(KDA)
"RTN","PRCG237P",30,0)
 Q
"RTN","PRCG237P",31,0)
UNLOAD ;
"RTN","PRCG237P",32,0)
 S BEGDA=$P(X,"-",1),ENDA=+$P(X,"-",2),SITE=$P(X,";",2)
"RTN","PRCG237P",33,0)
 S DATE=$P(X,";",3)
"RTN","PRCG237P",34,0)
 S DA=BEGDA-.1
"RTN","PRCG237P",35,0)
 Q
"RTN","PRCG237P",36,0)
KILL442(DA) ;
"RTN","PRCG237P",37,0)
 Q:'$D(^PRC(442,DA,0))
"RTN","PRCG237P",38,0)
 S DIK="^PRC(442," D ^DIK
"RTN","PRCG237P",39,0)
 K DIK
"RTN","PRCG237P",40,0)
 D KLL4406
"RTN","PRCG237P",41,0)
 Q
"RTN","PRCG237P",42,0)
KLL4406 ;find/kill invalid records in file 440.6
"RTN","PRCG237P",43,0)
 N IPIEN,HLDDA
"RTN","PRCG237P",44,0)
 S IPIEN=0,HLDDA=0
"RTN","PRCG237P",45,0)
 F  S IPIEN=$O(^PRCH(440.6,"PO",DA,IPIEN)) Q:IPIEN'>0  D
"RTN","PRCG237P",46,0)
 .S HLDDA=DA,DA=IPIEN
"RTN","PRCG237P",47,0)
 .S DIK="^PRCH(440.6," D ^DIK
"RTN","PRCG237P",48,0)
 .K DIK
"RTN","PRCG237P",49,0)
 .S DA=HLDDA
"RTN","PRCG237P",50,0)
 K IPIEN,HLDDA
"RTN","PRCG237P",51,0)
 Q
"RTN","PRCG237Q")
0^15^B17692851^B15041434
"RTN","PRCG237Q",1,0)
PRCG237Q ;WISC/BGJ - IFCAP 442 FILE CLEANUP (QUEUE); 11/8/99 2:07pm ;9/20/00  13:00
"RTN","PRCG237Q",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCG237Q",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCG237Q",4,0)
 ;This routine is installed by patch PRC*5*237.
"RTN","PRCG237Q",5,0)
 ;This routine creates entries in file 443.1 for background processing
"RTN","PRCG237Q",6,0)
 ;by PurgeMaster.  Entries are created for file 442.  Routine PRCG237P
"RTN","PRCG237Q",7,0)
 ;will be utilized by PurgeMaster to actually purge the entries in file
"RTN","PRCG237Q",8,0)
 ;442.
"RTN","PRCG237Q",9,0)
 ;
"RTN","PRCG237Q",10,0)
 W @IOF,!
"RTN","PRCG237Q",11,0)
 D MSG
"RTN","PRCG237Q",12,0)
 S %A="Are you ready to continue",%A(0)="!",%=1
"RTN","PRCG237Q",13,0)
 D ^PRCFYN Q:%'=1
"RTN","PRCG237Q",14,0)
 S PRCF("X")="AS" D ^PRCFSITE G OUT:'%
"RTN","PRCG237Q",15,0)
 D NOW^%DTC K %H,%,%I
"RTN","PRCG237Q",16,0)
 S CFY=$E(X,1,3)+1700,CFY=$S(+$E(X,4,5)>9:CFY+1,1:CFY)
"RTN","PRCG237Q",17,0)
 S PFY=CFY-1700-1_"0930"
"RTN","PRCG237Q",18,0)
 S X="Date/Fiscal Year thru which AR and other documents in file 442 will be purged."
"RTN","PRCG237Q",19,0)
 D DATE
"RTN","PRCG237Q",20,0)
 I +OUT G OUT
"RTN","PRCG237Q",21,0)
 I $E(Y,4,7)="0000" S Y=$E(Y,1,3)_"0930"
"RTN","PRCG237Q",22,0)
 S PRC("DATE")=Y
"RTN","PRCG237Q",23,0)
 K OUT
"RTN","PRCG237Q",24,0)
DQ ;
"RTN","PRCG237Q",25,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRCG237Q",26,0)
 F I=1:1 S X=$T(LOAD+I) Q:$P(X,";",3)=""  D
"RTN","PRCG237Q",27,0)
 . S FILE(I)=$P(X,";",3),GLO(I)=$P(X,";",4),REF(I)=$P(X,";",5),ADDVAR(I)=$P(X,";",6)
"RTN","PRCG237Q",28,0)
 S N=0,TREC=0
"RTN","PRCG237Q",29,0)
 F  S N=$O(GLO(N)) Q:'N  D
"RTN","PRCG237Q",30,0)
 . S X="S REC(N)=$P("_GLO(N)_"0),U,4)" X X S TREC=TREC+REC(N)
"RTN","PRCG237Q",31,0)
 S OGET=TREC\1000+1
"RTN","PRCG237Q",32,0)
 S MESSAGE="CREATING PURGEMASTER ENTRIES FOR FILE CLEANUP"
"RTN","PRCG237Q",33,0)
 D BEGIN^PRCGU
"RTN","PRCG237Q",34,0)
 S LEVEL=0
"RTN","PRCG237Q",35,0)
 F  S LEVEL=$O(GLO(LEVEL)) Q:LEVEL=""  D
"RTN","PRCG237Q",36,0)
 . S GLO=GLO(LEVEL),REF=REF(LEVEL),ADDVAR=""
"RTN","PRCG237Q",37,0)
 . S:ADDVAR(LEVEL)]"" @("ADDVAR="_ADDVAR(LEVEL))
"RTN","PRCG237Q",38,0)
 . S NEXT=0
"RTN","PRCG237Q",39,0)
 . F  D  S XCOUNT=XCOUNT+COUNT D PERCENT^PRCGU Q:'NEXT
"RTN","PRCG237Q",40,0)
 . . S COUNT=0
"RTN","PRCG237Q",41,0)
 . . F  D  Q:'NEXT!(COUNT>LREC)
"RTN","PRCG237Q",42,0)
 . . . S GET=($S((LREC-COUNT)>OGET:OGET,1:(LREC-COUNT)+2))-1
"RTN","PRCG237Q",43,0)
 . . . I GET<1 S GET=1
"RTN","PRCG237Q",44,0)
 . . . D GET
"RTN","PRCG237Q",45,0)
 . . . Q:'NEXT
"RTN","PRCG237Q",46,0)
 . . . S COUNT=COUNT+ICOUNT
"RTN","PRCG237Q",47,0)
 . . . S Z="",ROUTINE=REF_"^PRCG237P",VARIABLE=BEGDA_"-"_ENDA_";"_PRC("SITE")
"RTN","PRCG237Q",48,0)
 . . . I ADDVAR]"" S VARIABLE=VARIABLE_";"_ADDVAR
"RTN","PRCG237Q",49,0)
 . . . D ADD^PRCGPM1(ROUTINE,VARIABLE,.Z)
"RTN","PRCG237Q",50,0)
 D CLN4406
"RTN","PRCG237Q",51,0)
 D END^PRCGU
"RTN","PRCG237Q",52,0)
 ;
"RTN","PRCG237Q",53,0)
OUT ;
"RTN","PRCG237Q",54,0)
 K A,ADDVAR,ATERM,BEGDA,BTIME,CFY,COUNT,CURSOR,DX,DY,ENDA,FILE,GET,GLO,HOURS,ICOUNT,LEVEL,LINE,LREC,MIN,NEXT,OGET,OUT,PERCENT,PFY,REC,REF,ROUTINE,RTIME,SEC,TIME,TREC,TTIME,VARIABLE,X,XCOUNT,XPOS,Y,Z,PRC
"RTN","PRCG237Q",55,0)
 D KILL^%ZISS
"RTN","PRCG237Q",56,0)
 Q
"RTN","PRCG237Q",57,0)
GET ;
"RTN","PRCG237Q",58,0)
 S (BEGDA,ENDA)=NEXT+1,ICOUNT=1
"RTN","PRCG237Q",59,0)
 S @("NEXT=$O("_GLO_"NEXT))")
"RTN","PRCG237Q",60,0)
 I 'NEXT S NEXT="" Q
"RTN","PRCG237Q",61,0)
 S BEGDA=NEXT,(NEXT,ENDA)=NEXT+GET,ICOUNT=ENDA-BEGDA+1
"RTN","PRCG237Q",62,0)
 Q
"RTN","PRCG237Q",63,0)
MSG ;
"RTN","PRCG237Q",64,0)
 S X="This will schedule records in file 442 for review in the "
"RTN","PRCG237Q",65,0)
 S X=X_"background by PurgeMaster (file 443.1 will be populated).  "
"RTN","PRCG237Q",66,0)
 S X=X_"Accounts Receivable documents in file 442 will be purged by "
"RTN","PRCG237Q",67,0)
 S X=X_"PurgeMaster based on the date that you will enter.  Any "
"RTN","PRCG237Q",68,0)
 S X=X_"document in file 442 without a P.O. DATE will also be purged "
"RTN","PRCG237Q",69,0)
 S X=X_"based on the date you enter and the date in the DATE P.O. "
"RTN","PRCG237Q",70,0)
 S X=X_"ASSIGNED field in file 442."
"RTN","PRCG237Q",71,0)
 D MSG^PRCFQ W !
"RTN","PRCG237Q",72,0)
 S X="The date you are about to enter MUST be confirmed with A&MM "
"RTN","PRCG237Q",73,0)
 S X=X_"or Fiscal staff.  FAILURE TO DO SO MAY RESULT IN DATA "
"RTN","PRCG237Q",74,0)
 S X=X_"CORRUPTION." D MSG^PRCFQ W $C(7),$C(7),$C(7)
"RTN","PRCG237Q",75,0)
 Q
"RTN","PRCG237Q",76,0)
DATE ;Select fiscal year
"RTN","PRCG237Q",77,0)
 S DIR(0)="DA^:"_PFY_":EA"
"RTN","PRCG237Q",78,0)
 S DIR("A")="Select DATE/FISCAL YEAR: "
"RTN","PRCG237Q",79,0)
 S DIR("A",1)=X
"RTN","PRCG237Q",80,0)
 S DIR("?")="You may only select for purging those documents which are not in the current Fiscal Year."
"RTN","PRCG237Q",81,0)
 D ^DIR
"RTN","PRCG237Q",82,0)
 S OUT=$G(DTOUT)_$G(DUOUT)_$G(DIRUT)_$G(DIROUT)
"RTN","PRCG237Q",83,0)
 K DTOUT,DUOUT,DIRUT,DIROUT,DIR
"RTN","PRCG237Q",84,0)
 Q
"RTN","PRCG237Q",85,0)
CLN4406 ;add line to delete
"RTN","PRCG237Q",86,0)
 S MYHLD=0,MYCOUNT=0,THISCNT=0
"RTN","PRCG237Q",87,0)
 F  S MYHLD=$O(^PRC(443.1,MYHLD)) Q:'MYHLD  S MYCOUNT=MYHLD
"RTN","PRCG237Q",88,0)
 S LAST=MYCOUNT+1
"RTN","PRCG237Q",89,0)
 S X="START^PRCCL406"
"RTN","PRCG237Q",90,0)
 S THISCNT=$P(^PRC(443.1,0),U,4)
"RTN","PRCG237Q",91,0)
 S Y=""
"RTN","PRCG237Q",92,0)
 S:X'["^" X="^"_X
"RTN","PRCG237Q",93,0)
 I '$D(^PRC(443.1,LAST)) S ^PRC(443.1,LAST,0)=LAST_"^"_X_"^"_Y,$P(^PRC(443.1,0),"^",3,4)=(LAST_"^"_(THISCNT+1))
"RTN","PRCG237Q",94,0)
 K MYHLD,MYCOUNT,THISCNT
"RTN","PRCG237Q",95,0)
 Q
"RTN","PRCG237Q",96,0)
LOAD ;
"RTN","PRCG237Q",97,0)
 ;;442;^PRC(442,;442;PRC("DATE")
"RTN","PRCG237Q",98,0)
 ;;;
"RTN","PRCG238P")
0^3^B21136365^B15439562
"RTN","PRCG238P",1,0)
PRCG238P ;WISC/BGJ-IFCAP 410 FILE CLEANUP (PURGE) ;11/5/99
"RTN","PRCG238P",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCG238P",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCG238P",4,0)
 ;This routine is installed by patch PRC*5*238.
"RTN","PRCG238P",5,0)
 ;The purpose of this routine is to cleanup entries in files 410, 410.1
"RTN","PRCG238P",6,0)
 ;and 443 that are leftover after running the Archive/Purge
"RTN","PRCG238P",7,0)
 ;functionality.  Routine PRCG238Q is a routine installed by patch 238
"RTN","PRCG238P",8,0)
 ;that queues entries into PurgeMaster for purging.  Those entries
"RTN","PRCG238P",9,0)
 ;are then purged by this routine as PurgeMaster cycles through file
"RTN","PRCG238P",10,0)
 ;443.1 (PurgeMaster Worklist).
"RTN","PRCG238P",11,0)
 ;
"RTN","PRCG238P",12,0)
410(X) ;
"RTN","PRCG238P",13,0)
 N DA,KDA,OK,X1,FORMTYPE,TRANTYPE,REQDATE,REQFY,PRCHDA,PONUM,REQID,TEMPID,BEGDA,ENDA,SITE,PERMDATE,TEMPDATE
"RTN","PRCG238P",14,0)
 D UNLOAD
"RTN","PRCG238P",15,0)
 F  S DA=$O(^PRCS(410,DA)) Q:'DA!(DA>ENDA)  D
"RTN","PRCG238P",16,0)
 . S OK=1
"RTN","PRCG238P",17,0)
 . ;Kill 410 record when no zeroth node
"RTN","PRCG238P",18,0)
 . S X=$G(^PRCS(410,DA,0)) I X="" S X="SYSPURG1",^(0)=X,^PRCS(410,"B","SYSPURG1",DA)="" S KDA=DA D KILL443(KDA),KILL410(KDA) Q
"RTN","PRCG238P",19,0)
 . S X1=$G(^PRCS(410,DA,1)),FORMTYPE=$P(X,"^",4),TRANTYPE=$P(X,"^",2),REQDATE=$P(X1,"^"),REQID=$P(X,"^"),TEMPID=$P(X,"^",3)
"RTN","PRCG238P",20,0)
 . I $P(REQID,"-")'=SITE Q
"RTN","PRCG238P",21,0)
 . S PRCHDA=$P($G(^PRCS(410,DA,10)),"^",3),PONUM=$E($P($G(^PRCS(410,DA,4)),"^",5),1,6) S:PONUM]"" PONUM=SITE_"-"_PONUM
"RTN","PRCG238P",22,0)
 . ;Ceiling transactions
"RTN","PRCG238P",23,0)
 . I TRANTYPE="C" D CEILING Q:'OK  S KDA=DA D KILL443(KDA),KILL410(KDA) Q
"RTN","PRCG238P",24,0)
 . ;Kill temp request when request date <= date specified for temps
"RTN","PRCG238P",25,0)
 . I REQID=TEMPID,(REQDATE'>TEMPDATE) S KDA=DA D KILL443(KDA),KILL410(KDA) Q
"RTN","PRCG238P",26,0)
 . Q:'+REQID
"RTN","PRCG238P",27,0)
 . ;Do not delete when date of request > date specified for permanent requests
"RTN","PRCG238P",28,0)
 . I REQDATE>PERMDATE Q
"RTN","PRCG238P",29,0)
 . ;If no date of request, use the fiscal year from the txn #
"RTN","PRCG238P",30,0)
 . I '+REQDATE S REQFY=$P(REQID,"-",2),REQFY=$S(REQFY<70:3,1:2)_REQFY I REQFY>$E(PERMDATE,1,3) Q
"RTN","PRCG238P",31,0)
 . ;If no reference to purchase order or if PO referenced does not exist - kill record
"RTN","PRCG238P",32,0)
 . I PRCHDA]""!(PONUM]"") D  Q
"RTN","PRCG238P",33,0)
 . . I PRCHDA]"",$D(^PRC(442,PRCHDA,0)) D CHKDT(REQDATE,PRCHDA) Q:'OK
"RTN","PRCG238P",34,0)
 . . I PONUM]"" S X=$O(^PRC(442,"B",PONUM,0)) I +X,$D(^PRC(442,+X,0)) D CHKDT(REQDATE,+X) Q:'OK
"RTN","PRCG238P",35,0)
 . . S KDA=DA D KILL443(KDA),KILL410(KDA)
"RTN","PRCG238P",36,0)
 . I PRCHDA="",PONUM="" S KDA=DA D KILL443(KDA),KILL410(KDA)
"RTN","PRCG238P",37,0)
 Q
"RTN","PRCG238P",38,0)
443(X) ;
"RTN","PRCG238P",39,0)
 N DA,BEGDA,ENDA,SITE
"RTN","PRCG238P",40,0)
 D UNLOAD
"RTN","PRCG238P",41,0)
 F  S DA=$O(^PRC(443,DA)) Q:'DA!(DA>ENDA)  D
"RTN","PRCG238P",42,0)
 . I '$D(^PRCS(410,DA,0)) S KDA=DA D KILL443(KDA)
"RTN","PRCG238P",43,0)
 Q
"RTN","PRCG238P",44,0)
4101(X) ;
"RTN","PRCG238P",45,0)
 N DA,BEGDA,ENDA,SITE,PERMDATE,X0,LDA
"RTN","PRCG238P",46,0)
 D UNLOAD
"RTN","PRCG238P",47,0)
 F  S DA=$O(^PRCS(410.1,DA)) Q:'DA!(DA>ENDA)  D
"RTN","PRCG238P",48,0)
 . S X0=$G(^PRCS(410.1,DA,0)) Q:X0=""
"RTN","PRCG238P",49,0)
 . Q:SITE'=$P(X0,"-")
"RTN","PRCG238P",50,0)
 . S LDA=$P(X0,"^",3)
"RTN","PRCG238P",51,0)
 . Q:LDA>PERMDATE
"RTN","PRCG238P",52,0)
 . S DIK="^PRCS(410.1," D ^DIK
"RTN","PRCG238P",53,0)
 . K DIK
"RTN","PRCG238P",54,0)
 Q
"RTN","PRCG238P",55,0)
UNLOAD ;
"RTN","PRCG238P",56,0)
 S BEGDA=$P(X,"-",1),ENDA=+$P(X,"-",2),SITE=$P(X,";",2)
"RTN","PRCG238P",57,0)
 S X=$P(X,";",3)
"RTN","PRCG238P",58,0)
 I X]"" S TEMPDATE=$P(X,"-",1),PERMDATE=$P(X,"-",2)
"RTN","PRCG238P",59,0)
 S DA=BEGDA-.1
"RTN","PRCG238P",60,0)
 Q
"RTN","PRCG238P",61,0)
CHKDT(RDATE,PODA) ;
"RTN","PRCG238P",62,0)
 N PODATE
"RTN","PRCG238P",63,0)
 ;Use DATE PO ASSIGNED field if defined, else use PO DATE
"RTN","PRCG238P",64,0)
 S PODATE=$P($P($G(^PRC(442,PODA,12)),"^",5),".")
"RTN","PRCG238P",65,0)
 I +PODATE=0 S PODATE=$P($G(^PRC(442,PODA,1)),"^",15) Q:'+PODATE
"RTN","PRCG238P",66,0)
 I '+RDATE D  Q
"RTN","PRCG238P",67,0)
 . I REQFY<$E(PODATE,1,3) Q
"RTN","PRCG238P",68,0)
 . S OK=0
"RTN","PRCG238P",69,0)
 I $E(RDATE,1,3)<$E(PODATE,1,3) Q
"RTN","PRCG238P",70,0)
 S OK=0
"RTN","PRCG238P",71,0)
 Q
"RTN","PRCG238P",72,0)
CEILING ;
"RTN","PRCG238P",73,0)
 N ALLOCDT,REQFY
"RTN","PRCG238P",74,0)
 S ALLOCDT=$P($G(^PRCS(410,DA,6)),"^",2)
"RTN","PRCG238P",75,0)
 I +ALLOCDT'=0,ALLOCDT>PERMDATE S OK=0 Q
"RTN","PRCG238P",76,0)
 S REQFY=$P(REQID,"-",2),REQFY=$S(REQFY<70:3,1:2)_REQFY
"RTN","PRCG238P",77,0)
 I REQFY>$E(PERMDATE,1,3) S OK=0 Q
"RTN","PRCG238P",78,0)
 I PRCHDA]""!(PONUM]"") D
"RTN","PRCG238P",79,0)
 . I PRCHDA]"",$D(^PRC(442,PRCHDA,0)) D CHKDT(ALLOCDT,PRCHDA) Q:'OK
"RTN","PRCG238P",80,0)
 . I PONUM]"" S X=$O(^PRC(442,"B",PONUM,0)) I +X,$D(^PRC(442,+X,0)) D CHKDT(ALLOCDT,+X)
"RTN","PRCG238P",81,0)
 Q
"RTN","PRCG238P",82,0)
KILL410(DA) ;
"RTN","PRCG238P",83,0)
 Q:'$D(^PRCS(410,DA,0))
"RTN","PRCG238P",84,0)
 S DIK="^PRCS(410," D ^DIK
"RTN","PRCG238P",85,0)
 K DIK
"RTN","PRCG238P",86,0)
 D KILL4101
"RTN","PRCG238P",87,0)
 Q
"RTN","PRCG238P",88,0)
KILL443(DA) ;
"RTN","PRCG238P",89,0)
 Q:'$D(^PRC(443,DA,0))
"RTN","PRCG238P",90,0)
 S DIK="^PRC(443," D ^DIK
"RTN","PRCG238P",91,0)
 K DIK
"RTN","PRCG238P",92,0)
 Q
"RTN","PRCG238P",93,0)
KILL4101 ;
"RTN","PRCG238P",94,0)
 Q:$G(REQID)=""
"RTN","PRCG238P",95,0)
 N DA,ID1,ID2,ID3,ID,LDA
"RTN","PRCG238P",96,0)
 S ID1=$P(REQID,"-")_"-"_$P(REQID,"-",2)_"-"_$P(REQID,"-",4)
"RTN","PRCG238P",97,0)
 S ID2=$G(PONUM)
"RTN","PRCG238P",98,0)
 S ID3=REQID
"RTN","PRCG238P",99,0)
 F ID=ID1,ID2,ID3 I ID'="",$D(^PRCS(410.1,"B",ID)) D
"RTN","PRCG238P",100,0)
 . S DA=$O(^PRCS(410.1,"B",ID,0))
"RTN","PRCG238P",101,0)
 . Q:DA=""
"RTN","PRCG238P",102,0)
 . Q:'$D(^PRCS(410.1,DA,0))
"RTN","PRCG238P",103,0)
 . S LDA=$P(^PRCS(410.1,DA,0),"^",3)
"RTN","PRCG238P",104,0)
 . Q:LDA>PERMDATE
"RTN","PRCG238P",105,0)
 . S DIK="^PRCS(410.1," D ^DIK
"RTN","PRCG238P",106,0)
 . K DIK
"RTN","PRCG238P",107,0)
 Q
"RTN","PRCG238P",108,0)
FIND445 ;find invalid records in file 445
"RTN","PRCG238P",109,0)
 S IPIEN=0
"RTN","PRCG238P",110,0)
 F  S IPIEN=$O(^PRCP(445,IPIEN)) Q:IPIEN'>0  D
"RTN","PRCG238P",111,0)
 .S IEN=0
"RTN","PRCG238P",112,0)
 .F  S IEN=$O(^PRCP(445,IPIEN,1,IEN)) Q:IEN'>0  D
"RTN","PRCG238P",113,0)
 ..Q:'$D(^PRCP(445,IPIEN,1,IEN,7))
"RTN","PRCG238P",114,0)
 ..S TTLI=$P(^PRCP(445,IPIEN,1,IEN,7,0),U,4)
"RTN","PRCG238P",115,0)
 ..S ITIEN=0
"RTN","PRCG238P",116,0)
 ..F  S ITIEN=$O(^PRCP(445,IPIEN,1,IEN,7,ITIEN)) Q:ITIEN'>0  D
"RTN","PRCG238P",117,0)
 ...I '$D(^PRCS(410,ITIEN)) D KILL445
"RTN","PRCG238P",118,0)
 ..S $P(^PRCP(445,IPIEN,1,IEN,7,0),U,4)=TTLI
"RTN","PRCG238P",119,0)
 ..;-leave this with zero amount don't delete? - I TTLI=0 S ^PRCP(445,IPIEN,1,IEN,7) Q
"RTN","PRCG238P",120,0)
 ..Q
"RTN","PRCG238P",121,0)
 .Q
"RTN","PRCG238P",122,0)
 K IPIEN,IEN,ITIEN,TTLI
"RTN","PRCG238P",123,0)
 Q
"RTN","PRCG238P",124,0)
KILL445 ;clear the invalid records
"RTN","PRCG238P",125,0)
 Q:'$D(^PRCP(445,IPIEN,1,IEN,7,ITIEN,0))
"RTN","PRCG238P",126,0)
 S HLDDA=DA,DA(2)=IPIEN,DA(1)=IEN,DA=ITIEN
"RTN","PRCG238P",127,0)
 S DIK="^PRCP(445,"_DA(2)_",1,"_DA(1)_",7,"
"RTN","PRCG238P",128,0)
 D ^DIK
"RTN","PRCG238P",129,0)
 K DIK
"RTN","PRCG238P",130,0)
 S TTLI=TTLI-1
"RTN","PRCG238P",131,0)
 S DA=HLDDA
"RTN","PRCG238P",132,0)
 Q
"RTN","PRCG239P")
0^13^B952278^n/a
"RTN","PRCG239P",1,0)
PRCG239P ;WISC/BGJ - IFCAP 442 FILE CLEANUP (PURGE); 11/5/99 12:22pm ;9/20/00  12:56
"RTN","PRCG239P",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCG239P",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCG239P",4,0)
 ;This routine is installed by patch PRC*5.1*95.
"RTN","PRCG239P",5,0)
 ;The purpose of this routine is to clean up FMS reconcilliation data
"RTN","PRCG239P",6,0)
 ;in file 417 that were not purged by running the Archive/Purge
"RTN","PRCG239P",7,0)
 ;functionality.  Routine PRCG239Q is a routine installed by patch
"RTN","PRCG239P",8,0)
 ;95 that queues entries into PurgeMaster for purging.  Those entries
"RTN","PRCG239P",9,0)
 ;are then purged by this routine as PurgeMaster cycles through file
"RTN","PRCG239P",10,0)
 ;443.1 (PurgeMaster Worklist).
"RTN","PRCG239P",11,0)
 ;
"RTN","PRCG239P",12,0)
417(X) ;
"RTN","PRCG239P",13,0)
 N DA,KDA,BEGDA,ENDA,PODATE,DTPOASN,SITE,DATE,ZERONODE,MOP
"RTN","PRCG239P",14,0)
 D UNLOAD
"RTN","PRCG239P",15,0)
 F  S DA=$O(^PRCS(417,DA)) Q:'DA!(DA>ENDA)  D
"RTN","PRCG239P",16,0)
 . S ZERONODE=$G(^PRCS(417,DA,0)) Q:ZERONODE=""
"RTN","PRCG239P",17,0)
 . S PODATE=$P($G(^PRCS(417,DA,0)),"^",22)
"RTN","PRCG239P",18,0)
 . I PODATE>DATE Q
"RTN","PRCG239P",19,0)
 . S KDA=DA D KILL417(KDA)
"RTN","PRCG239P",20,0)
 Q
"RTN","PRCG239P",21,0)
UNLOAD ;
"RTN","PRCG239P",22,0)
 S BEGDA=$P(X,"-",1),ENDA=+$P(X,"-",2),SITE=$P(X,";",2)
"RTN","PRCG239P",23,0)
 S DATE=$P(X,";",3)
"RTN","PRCG239P",24,0)
 S DA=BEGDA-.1
"RTN","PRCG239P",25,0)
 Q
"RTN","PRCG239P",26,0)
KILL417(DA) ;
"RTN","PRCG239P",27,0)
 Q:'$D(^PRCS(417,DA,0))
"RTN","PRCG239P",28,0)
 S DIK="^PRCS(417," D ^DIK
"RTN","PRCG239P",29,0)
 K DIK
"RTN","PRCG239P",30,0)
 Q
"RTN","PRCG239Q")
0^14^B13467421^n/a
"RTN","PRCG239Q",1,0)
PRCG239Q ;WISC/BGJ-IFCAP 410 FILE CLEANUP (QUEUE) ;11/8/99
"RTN","PRCG239Q",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCG239Q",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCG239Q",4,0)
 ;This routine is installed by patch PRC*5.1*95.
"RTN","PRCG239Q",5,0)
 ;This routine creates entries in file 443.1 for background processing
"RTN","PRCG239Q",6,0)
 ;by PurgeMaster.  Entries are created for file 417.
"RTN","PRCG239Q",7,0)
 ;Routine PRCG239P will be utilized by PurgeMaster to actually purge the
"RTN","PRCG239Q",8,0)
 ;entries in this file.
"RTN","PRCG239Q",9,0)
 ;
"RTN","PRCG239Q",10,0)
 W @IOF,!
"RTN","PRCG239Q",11,0)
 D MSG
"RTN","PRCG239Q",12,0)
 S %A="Are you ready to continue",%A(0)="!",%=1
"RTN","PRCG239Q",13,0)
 D ^PRCFYN Q:%'=1
"RTN","PRCG239Q",14,0)
 S PRCF("X")="AS" D ^PRCFSITE G OUT:'%
"RTN","PRCG239Q",15,0)
 D NOW^%DTC K %H,%,%I
"RTN","PRCG239Q",16,0)
 S CFY=$E(X,1,3)+1700,CFY=$S(+$E(X,4,5)>9:CFY+1,1:CFY)
"RTN","PRCG239Q",17,0)
 S PFY=CFY-1700-1_"0930"
"RTN","PRCG239Q",18,0)
 S X="Date/Fiscal Year thru which FMS reconilliation data in file 417 will be purged."
"RTN","PRCG239Q",19,0)
 D DATE
"RTN","PRCG239Q",20,0)
 I +OUT G OUT
"RTN","PRCG239Q",21,0)
 I $E(Y,4,7)="0000" S Y=$E(Y,1,3)_"0930"
"RTN","PRCG239Q",22,0)
 S PRC("DATE")=Y
"RTN","PRCG239Q",23,0)
 K OUT
"RTN","PRCG239Q",24,0)
DQ ;
"RTN","PRCG239Q",25,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRCG239Q",26,0)
 F I=1:1 S X=$T(LOAD+I) Q:$P(X,";",3)=""  D
"RTN","PRCG239Q",27,0)
 . S FILE(I)=$P(X,";",3),GLO(I)=$P(X,";",4),REF(I)=$P(X,";",5),ADDVAR(I)=$P(X,";",6)
"RTN","PRCG239Q",28,0)
 S N=0,TREC=0
"RTN","PRCG239Q",29,0)
 F  S N=$O(GLO(N)) Q:'N  D
"RTN","PRCG239Q",30,0)
 . S X="S REC(N)=$P("_GLO(N)_"0),U,4)" X X S TREC=TREC+REC(N)
"RTN","PRCG239Q",31,0)
 S OGET=TREC\1000+1
"RTN","PRCG239Q",32,0)
 S MESSAGE="CREATING PURGEMASTER ENTRIES FOR FILE CLEANUP"
"RTN","PRCG239Q",33,0)
 D BEGIN^PRCGU
"RTN","PRCG239Q",34,0)
 S LEVEL=0
"RTN","PRCG239Q",35,0)
 F  S LEVEL=$O(GLO(LEVEL)) Q:LEVEL=""  D
"RTN","PRCG239Q",36,0)
 . S GLO=GLO(LEVEL),REF=REF(LEVEL),ADDVAR=""
"RTN","PRCG239Q",37,0)
 . S:ADDVAR(LEVEL)]"" @("ADDVAR="_ADDVAR(LEVEL))
"RTN","PRCG239Q",38,0)
 . S NEXT=0
"RTN","PRCG239Q",39,0)
 . F  D  S XCOUNT=XCOUNT+COUNT D PERCENT^PRCGU Q:'NEXT
"RTN","PRCG239Q",40,0)
 . . S COUNT=0
"RTN","PRCG239Q",41,0)
 . . F  D  Q:'NEXT!(COUNT>LREC)
"RTN","PRCG239Q",42,0)
 . . . S GET=($S((LREC-COUNT)>OGET:OGET,1:(LREC-COUNT)+2))-1
"RTN","PRCG239Q",43,0)
 . . . I GET<1 S GET=1
"RTN","PRCG239Q",44,0)
 . . . D GET
"RTN","PRCG239Q",45,0)
 . . . Q:'NEXT
"RTN","PRCG239Q",46,0)
 . . . S COUNT=COUNT+ICOUNT
"RTN","PRCG239Q",47,0)
 . . . S Z="",ROUTINE=REF_"^PRCG239P",VARIABLE=BEGDA_"-"_ENDA_";"_PRC("SITE")
"RTN","PRCG239Q",48,0)
 . . . I ADDVAR]"" S VARIABLE=VARIABLE_";"_ADDVAR
"RTN","PRCG239Q",49,0)
 . . . D ADD^PRCGPM1(ROUTINE,VARIABLE,.Z)
"RTN","PRCG239Q",50,0)
 D END^PRCGU
"RTN","PRCG239Q",51,0)
 ;
"RTN","PRCG239Q",52,0)
OUT ;
"RTN","PRCG239Q",53,0)
 K A,ADDVAR,ATERM,BEGDA,BTIME,CFY,COUNT,CURSOR,DX,DY,ENDA,FILE,GET,GLO,HOURS,ICOUNT,LEVEL,LINE,LREC,MIN,NEXT,OGET,OUT,PERCENT,PFY,REC,REF,ROUTINE,RTIME,SEC,TIME,TREC,TTIME,VARIABLE,X,XCOUNT,XPOS,Y,Z,PRC
"RTN","PRCG239Q",54,0)
 D KILL^%ZISS
"RTN","PRCG239Q",55,0)
 Q
"RTN","PRCG239Q",56,0)
GET ;
"RTN","PRCG239Q",57,0)
 S (BEGDA,ENDA)=NEXT+1,ICOUNT=1
"RTN","PRCG239Q",58,0)
 S @("NEXT=$O("_GLO_"NEXT))")
"RTN","PRCG239Q",59,0)
 I 'NEXT S NEXT="" Q
"RTN","PRCG239Q",60,0)
 S BEGDA=NEXT,(NEXT,ENDA)=NEXT+GET,ICOUNT=ENDA-BEGDA+1
"RTN","PRCG239Q",61,0)
 Q
"RTN","PRCG239Q",62,0)
MSG ;
"RTN","PRCG239Q",63,0)
 S X="This will schedule records in file 417 for review in the "
"RTN","PRCG239Q",64,0)
 S X=X_"background by PurgeMaster (file 443.1 will be populated).  "
"RTN","PRCG239Q",65,0)
 S X=X_"FMS reconcilliation data in file 417 will be purged by "
"RTN","PRCG239Q",66,0)
 S X=X_"PurgeMaster based on the date that you will enter."
"RTN","PRCG239Q",67,0)
 D MSG^PRCFQ W !
"RTN","PRCG239Q",68,0)
 S X="The date you are about to enter MUST be confirmed with A&MM "
"RTN","PRCG239Q",69,0)
 S X=X_"or Fiscal staff.  FAILURE TO DO SO MAY RESULT IN DATA "
"RTN","PRCG239Q",70,0)
 S X=X_"CORRUPTION." D MSG^PRCFQ W $C(7),$C(7),$C(7)
"RTN","PRCG239Q",71,0)
 Q
"RTN","PRCG239Q",72,0)
DATE ;Select fiscal year
"RTN","PRCG239Q",73,0)
 S DIR(0)="DA^:"_PFY_":EA"
"RTN","PRCG239Q",74,0)
 S DIR("A")="Select DATE/FISCAL YEAR: "
"RTN","PRCG239Q",75,0)
 S DIR("A",1)=X
"RTN","PRCG239Q",76,0)
 S DIR("?")="You may only select for purging those documents which are not in the current Fiscal Year."
"RTN","PRCG239Q",77,0)
 D ^DIR
"RTN","PRCG239Q",78,0)
 S OUT=$G(DTOUT)_$G(DUOUT)_$G(DIRUT)_$G(DIROUT)
"RTN","PRCG239Q",79,0)
 K DTOUT,DUOUT,DIRUT,DIROUT,DIR
"RTN","PRCG239Q",80,0)
 Q
"RTN","PRCG239Q",81,0)
LOAD ;
"RTN","PRCG239Q",82,0)
 ;;417;^PRCS(417,;417;PRC("DATE")
"RTN","PRCG239Q",83,0)
 ;;;
"RTN","PRCGPM")
0^1^B4567484^B4482674
"RTN","PRCGPM",1,0)
PRCGPM ;WIRMFO@ALTOONA/CTB/WIRMFO/PLT - IFCAP PURGEMASTER PROCESS ;12/10/97  9:17 AM
"RTN","PRCGPM",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCGPM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCGPM",4,0)
 ;THIS ROUTINE SHOULD BE TASKED TO RUN DAILY AT WHATEVER TIME
"RTN","PRCGPM",5,0)
 ;THE IRM STAFF FEELS IS APPROPRIATE.  IT SHOULD BE RESCHEDULED
"RTN","PRCGPM",6,0)
 ;TO RUN DAILY.  ITS JOB IS TO SPAWN THE APPROPRIATE NUMBER OF
"RTN","PRCGPM",7,0)
 ;'KILLER' JOBS (^PRCGPMK) AS SPECIFIED IN FILE 443.2.
"RTN","PRCGPM",8,0)
 ;
"RTN","PRCGPM",9,0)
 ;IF LEFTOVER INPROCESS JOBS REMAIN IN FILE 443.3, AND THEY ARE OVER
"RTN","PRCGPM",10,0)
 ;   1 DAY OLD, THEY WILL BE ADDED TO FILE 443.1 HERE
"RTN","PRCGPM",11,0)
 I $O(^PRC(443.3,0)) DO
"RTN","PRCGPM",12,0)
 . NEW DA,TODAY,NODE,NODE1,ROU,VARIABLE,MSG
"RTN","PRCGPM",13,0)
 . S TODAY=+$H,DA=0
"RTN","PRCGPM",14,0)
 . F  S DA=$O(^PRC(443.3,DA)) Q:'DA  DO
"RTN","PRCGPM",15,0)
 . . S NODE=$G(^PRC(443.3,DA,0)) I NODE="" D REMIP^PRCGPM1(DA) QUIT
"RTN","PRCGPM",16,0)
 . . S NODE1=$G(^PRC(443.3,DA,1)) I NODE1="" D REMIP^PRCGPM1(DA) QUIT
"RTN","PRCGPM",17,0)
 . . S ROU=$P(NODE,"^",2,3),VARIABLE=$P(NODE,"^",4) I ROU="" D REMIP^PRCGPM1(DA) QUIT
"RTN","PRCGPM",18,0)
 . . S DATE=+NODE1 Q:TODAY'>DATE
"RTN","PRCGPM",19,0)
 . . D ADD^PRCGPM1(ROU,VARIABLE,.MSG)
"RTN","PRCGPM",20,0)
 . . I MSG D REMIP^PRCGPM1(DA)
"RTN","PRCGPM",21,0)
 . . QUIT
"RTN","PRCGPM",22,0)
 . QUIT
"RTN","PRCGPM",23,0)
 D CLN445^PRCGPM1
"RTN","PRCGPM",24,0)
 ;IT WILL ONLY SPAWN 'SUB-MANAGER' JOBS IF THERE ARE ENTRIES IN
"RTN","PRCGPM",25,0)
 ;FILE 443.1
"RTN","PRCGPM",26,0)
 S PARAM=^PRC(443.2,1,0),$P(PARAM,"^",7)=$H
"RTN","PRCGPM",27,0)
 S STOP=$P(PARAM,"^",3),SAT=$P(PARAM,"^",4),SUN=$P(PARAM,"^",5),HOL=$P(PARAM,"^",6),START=$P(PARAM,"^",7)
"RTN","PRCGPM",28,0)
 S X=DT_"."_STOP D H^%DTC S STOP=%T
"RTN","PRCGPM",29,0)
 I STOP<$P(START,",",2) S STOP=($P(START,",",1)+1)_","_STOP
"RTN","PRCGPM",30,0)
 E  S STOP=$P(START,",",1)_","_STOP
"RTN","PRCGPM",31,0)
 S %H=STOP D YMD^%DTC
"RTN","PRCGPM",32,0)
 D DOW^%DTC
"RTN","PRCGPM",33,0)
 I ((SAT&(Y=6))!(SUN&(Y=7))!(HOL&($D(^HOLIDAY(X))))) S $P(STOP,",",2)=$P(START,",",2),STOP=($P(STOP,",")+1)_","_$P(STOP,",",2)
"RTN","PRCGPM",34,0)
 S NEXTVOL=0 F  S NEXTVOL=$O(^PRC(443.2,1,1,NEXTVOL)) Q:'NEXTVOL  D
"RTN","PRCGPM",35,0)
 . N X,CPU S X=$G(^PRC(443.2,1,1,NEXTVOL,0)) Q:X=""
"RTN","PRCGPM",36,0)
 . S CPU=$P(X,"^"),NUMJOB=$P(X,"^",2)
"RTN","PRCGPM",37,0)
 . F ZII=1:1:NUMJOB D
"RTN","PRCGPM",38,0)
 . . S ZTCPU=CPU,ZTRTN="PRCGPMK",ZTDESC="IFCAP PurgeMaster Process",ZTIO="",ZTDTH=$H
"RTN","PRCGPM",39,0)
 . . S ZTSAVE("STOP")="",ZTKIL=$H+2_",0"
"RTN","PRCGPM",40,0)
 . . D ^%ZTLOAD W:'$D(ZTQUEUED) !,ZTSK
"RTN","PRCGPM",41,0)
 . . QUIT
"RTN","PRCGPM",42,0)
 . QUIT
"RTN","PRCGPM",43,0)
 Q
"RTN","PRCGPM1")
0^2^B7468104^B5446508
"RTN","PRCGPM1",1,0)
PRCGPM1 ;WIRMFO@ALTOONA/CTB/WIRMFO/PLT/BGJ - IFCAP PURGEMASTER PROCESS PRCGPM CONT. ;12/10/97  9:53 AM
"RTN","PRCGPM1",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCGPM1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCGPM1",4,0)
 ;This routine contains misc functions/tools to be used by the
"RTN","PRCGPM1",5,0)
 ;purge package
"RTN","PRCGPM1",6,0)
ADD(X,Y,Z) ;PARAMETER CALL TO ADD NEW ENTRY TO PURGE MASTER FILE
"RTN","PRCGPM1",7,0)
 ;RETURNS Z=0 (ZERO) IF UNSUCCESSFUL, Z=1 (ONE) IF SUCCESSFUL
"RTN","PRCGPM1",8,0)
 ;ARGUEMENT LIST = RECORD NUMBER (DA)^ENTRY POINT^ROUTINE NAME^VARIABLE STRING
"RTN","PRCGPM1",9,0)
 ;X= ENTRY POINT^ROUTINE NAME
"RTN","PRCGPM1",10,0)
 ;Y= VARIABLE STRING
"RTN","PRCGPM1",11,0)
 NEW NODE,LAST,TOTAL,DONE
"RTN","PRCGPM1",12,0)
 I X="" S Z=0 QUIT
"RTN","PRCGPM1",13,0)
 L +^PRC(443.1,0):10 I '$T S Z=0 QUIT
"RTN","PRCGPM1",14,0)
 S NODE=^PRC(443.1,0),LAST=$P(NODE,"^",3),TOTAL=$P(NODE,"^",4)
"RTN","PRCGPM1",15,0)
 F  D  Q:$D(DONE)
"RTN","PRCGPM1",16,0)
 . S LAST=LAST+1
"RTN","PRCGPM1",17,0)
 . S:X'["^" X="^"_X
"RTN","PRCGPM1",18,0)
 . I '$D(^PRC(443.1,LAST)) S ^PRC(443.1,LAST,0)=LAST_"^"_X_"^"_Y,$P(^PRC(443.1,0),"^",3,4)=(LAST_"^"_(TOTAL+1)),DONE=1
"RTN","PRCGPM1",19,0)
 . QUIT
"RTN","PRCGPM1",20,0)
 L -^PRC(443.1,0)
"RTN","PRCGPM1",21,0)
 S Z=1 QUIT
"RTN","PRCGPM1",22,0)
REMOVE(DA) ;REMOVE ENTRY FROM FILE 443.1
"RTN","PRCGPM1",23,0)
 ;PARAMATER CALL TO REMOVE RECORD 'DA' FROM FILE
"RTN","PRCGPM1",24,0)
 NEW NODE,LAST,TOTAL
"RTN","PRCGPM1",25,0)
 I +DA=0!(DA'=+DA) QUIT
"RTN","PRCGPM1",26,0)
 I '$D(^PRC(443.1,DA)) QUIT
"RTN","PRCGPM1",27,0)
 FOR  L +^PRC(443.1,0):1 I  Q
"RTN","PRCGPM1",28,0)
 S NODE=^PRC(443.1,0),LAST=$P(NODE,"^",3),TOTAL=$P(NODE,"^",4)
"RTN","PRCGPM1",29,0)
 K ^PRC(443.1,DA) S TOTAL=TOTAL-1
"RTN","PRCGPM1",30,0)
 I DA'<LAST F  S LAST=LAST-1 Q:($D(^PRC(443.1,LAST))!(LAST=0))
"RTN","PRCGPM1",31,0)
 S $P(^PRC(443.1,0),"^",3,4)=LAST_"^"_TOTAL
"RTN","PRCGPM1",32,0)
 L -^PRC(443.1,0)
"RTN","PRCGPM1",33,0)
 QUIT
"RTN","PRCGPM1",34,0)
ADDIP(X,Y,Z) ;PARAMETER CALL TO ADD NEW ENTRY TO INPROCESS FILE
"RTN","PRCGPM1",35,0)
 ;RETURNS Z=0 (ZERO) IF UNSUCCESSFUL, Z=DA NUMBER IF SUCCESSFUL
"RTN","PRCGPM1",36,0)
 ;ARGUEMENT LIST = RECORD NUM (DA)^ENTRY POINT^ROUTINE NAME^VARIABLE STRING
"RTN","PRCGPM1",37,0)
 ;X= ENTRY POINT^ROUTINE NAME
"RTN","PRCGPM1",38,0)
 ;Y= VARIABLE STRING
"RTN","PRCGPM1",39,0)
 NEW NODE,LAST,TOTAL,DONE
"RTN","PRCGPM1",40,0)
 I (X="") S Z=0 QUIT
"RTN","PRCGPM1",41,0)
 F  L +^PRC(443.3,0):1 I  Q
"RTN","PRCGPM1",42,0)
 S NODE=^PRC(443.3,0),LAST=$P(NODE,"^",3),TOTAL=$P(NODE,"^",4)
"RTN","PRCGPM1",43,0)
 F  D  Q:$D(DONE)
"RTN","PRCGPM1",44,0)
 . S LAST=LAST+1
"RTN","PRCGPM1",45,0)
 . S:X'["^" X="^"_X
"RTN","PRCGPM1",46,0)
 . I '$D(^PRC(443.3,LAST)) S ^PRC(443.3,LAST,0)=LAST_"^"_X_"^"_Y,^(1)=$H,$P(^PRC(443.3,0),"^",3,4)=(LAST_"^"_(TOTAL+1)),DONE=LAST
"RTN","PRCGPM1",47,0)
 . QUIT
"RTN","PRCGPM1",48,0)
 L -^PRC(443.3,0)
"RTN","PRCGPM1",49,0)
 S Z=DONE QUIT
"RTN","PRCGPM1",50,0)
REMIP(DA) ;PARAMETER CALL TO REMOVE RECORD 'DA' FROM FILE 443.3
"RTN","PRCGPM1",51,0)
 NEW NODE,LAST,TOTAL
"RTN","PRCGPM1",52,0)
 I +DA=0!(DA'=+DA) QUIT
"RTN","PRCGPM1",53,0)
 I '$D(^PRC(443.3,DA)) QUIT
"RTN","PRCGPM1",54,0)
 FOR  L +^PRC(443.3,0):1 I  Q
"RTN","PRCGPM1",55,0)
 S NODE=^PRC(443.3,0),LAST=$P(NODE,"^",3),TOTAL=$P(NODE,"^",4)
"RTN","PRCGPM1",56,0)
 K ^PRC(443.3,DA) S TOTAL=TOTAL-1
"RTN","PRCGPM1",57,0)
 I DA'<LAST F  S LAST=LAST-1 Q:($D(^PRC(443.3,LAST))!(LAST=0))
"RTN","PRCGPM1",58,0)
 S $P(^PRC(443.3,0),"^",3,4)=LAST_"^"_TOTAL
"RTN","PRCGPM1",59,0)
 I $O(^PRC(443.3,0))="" S $P(^PRC(443.0),"^",3,4)="^"
"RTN","PRCGPM1",60,0)
 L -^PRC(443.3,0)
"RTN","PRCGPM1",61,0)
 QUIT
"RTN","PRCGPM1",62,0)
CLN445 ;add line to delete
"RTN","PRCGPM1",63,0)
 S MYHLD=0,MYCOUNT=0,THISCNT=0
"RTN","PRCGPM1",64,0)
 F  S MYHLD=$O(^PRC(443.1,MYHLD)) Q:'MYHLD  S MYCOUNT=MYHLD
"RTN","PRCGPM1",65,0)
 S LAST=MYCOUNT+1
"RTN","PRCGPM1",66,0)
 S X="FIND445^PRCG238P"
"RTN","PRCGPM1",67,0)
 S THISCNT=$P(^PRC(443.1,0),U,4)
"RTN","PRCGPM1",68,0)
 S Y=""
"RTN","PRCGPM1",69,0)
 S:X'["^" X="^"_X
"RTN","PRCGPM1",70,0)
 I '$D(^PRC(443.1,LAST)) S ^PRC(443.1,LAST,0)=LAST_"^"_X_"^"_Y,$P(^PRC(443.1,0),"^",3,4)=(LAST_"^"_(THISCNT+1))
"RTN","PRCGPM1",71,0)
 K MYHLD,MYCOUNT,THISCNT
"RTN","PRCGPM1",72,0)
 Q
"RTN","PRCGPPC1")
0^4^B2351004^B2334557
"RTN","PRCGPPC1",1,0)
PRCGPPC1 ;WIRMFO@ALTOONA/CTB/WIRMFO/RHD - ARCHIVING & PURGING ENTRY POINTS ;12/10/97  10:55 AM
"RTN","PRCGPPC1",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCGPPC1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCGPPC1",4,0)
 ;MUST BE CALLED FROM SPECIFIC ENTRY POINT
"RTN","PRCGPPC1",5,0)
P4429(PO) ;given the external PO number, delete all entries in 442.9
"RTN","PRCGPPC1",6,0)
 ;PO1 - full external PO number with a period and partial number
"RTN","PRCGPPC1",7,0)
 ;DA  - record number for 442.9
"RTN","PRCGPPC1",8,0)
 QUIT:PO=""
"RTN","PRCGPPC1",9,0)
 N DIK,DA,PO1
"RTN","PRCGPPC1",10,0)
 S PO1=PO_"."
"RTN","PRCGPPC1",11,0)
 S DIK="^PRC(442.9,"
"RTN","PRCGPPC1",12,0)
 F  S PO1=$O(^PRC(442.9,"B",PO1)) Q:PO1=""!($P(PO1,".")'=PO)  D
"RTN","PRCGPPC1",13,0)
 . F  S DA=$O(^PRC(442.9,"B",PO1,0)) Q:'DA  D ^DIK
"RTN","PRCGPPC1",14,0)
 . QUIT
"RTN","PRCGPPC1",15,0)
 QUIT
"RTN","PRCGPPC1",16,0)
P441(PRCHDA) ;given the internal PO number, delete its entries in file 441
"RTN","PRCGPPC1",17,0)
 ;this gets the FCP and repetitive item number(s) for the PO, and
"RTN","PRCGPPC1",18,0)
 ;deletes the PO from the item(s) in 441
"RTN","PRCGPPC1",19,0)
 Q:'PRCHDA!('$D(^PRC(442,PRCHDA,0)))
"RTN","PRCGPPC1",20,0)
 N PRCHFCP,PRCHITEM,X,DIK,DA
"RTN","PRCGPPC1",21,0)
 S X=^PRC(442,PRCHDA,0),PRCHFCP=+$P(X,"^",1)_$P($P(X,"^",3)," ",1)
"RTN","PRCGPPC1",22,0)
 Q:PRCHFCP=""
"RTN","PRCGPPC1",23,0)
 S PRCHITEM=""
"RTN","PRCGPPC1",24,0)
 F  S PRCHITEM=$O(^PRC(442,PRCHDA,2,"AE",PRCHITEM)) Q:'PRCHITEM  D
"RTN","PRCGPPC1",25,0)
 .S DA=PRCHDA,DA(1)=PRCHFCP,DA(2)=PRCHITEM,DIK="^PRC(441,"_DA(2)_",4,"_DA(1)_",1,"
"RTN","PRCGPPC1",26,0)
 .D ^DIK
"RTN","PRCGPPC1",27,0)
 Q
"RTN","PRCGPPC1",28,0)
DL424(PRC442) N PRC424,DA,DIK
"RTN","PRCGPPC1",29,0)
 S PRC424=0 F  S PRC424=$O(^PRC(424,"C",PRC442,PRC424)) Q:PRC424'?1.N  D
"RTN","PRCGPPC1",30,0)
 .D DL424D1 S DIK="^PRC(424,",DA=PRC424 D ^DIK
"RTN","PRCGPPC1",31,0)
 .QUIT
"RTN","PRCGPPC1",32,0)
 Q
"RTN","PRCGPPC1",33,0)
DL424D1 ;
"RTN","PRCGPPC1",34,0)
 N PRC424D1,DA,DIK
"RTN","PRCGPPC1",35,0)
 S PRC424D1=0
"RTN","PRCGPPC1",36,0)
 F  S PRC424D1=$O(^PRC(424.1,"C",PRC424,PRC424D1)) Q:PRC424D1'?1.N  D
"RTN","PRCGPPC1",37,0)
 .S DA=PRC424D1,DIK="^PRC(424.1," D ^DIK
"RTN","PRCGPPC1",38,0)
 .Q
"RTN","PRCGPPC1",39,0)
 Q
"RTN","PRCIN45")
0^10^B4217688^n/a
"RTN","PRCIN45",1,0)
PRCIN45 ;BP-OIFO/SWS-IFCAP UTILITY TO CLEAN UP BAD LINKS IN FILE 445 TO 410 ;12/07/2005  12:16
"RTN","PRCIN45",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCIN45",3,0)
 Q
"RTN","PRCIN45",4,0)
START S IPIEN=0,NREC=0,TREC=0
"RTN","PRCIN45",5,0)
 S ^XTMP("IFCAP-PURGE-445",0)=$$FMADD^XLFDT(DT,7)_"^"_DT_"^RECORDS PURGED FROM FILE 445 BY PRC*5.1*95"
"RTN","PRCIN45",6,0)
 S ^XTMP("IFCAP-PURGE-445-REF",0)=$$FMADD^XLFDT(DT,7)_"^"_DT_"^B CROSS REFERENCES PURGED FROM FILE 445 BY PRC*5.1*95"
"RTN","PRCIN45",7,0)
 F  S IPIEN=$O(^PRCP(445,IPIEN)) Q:IPIEN'>0  D
"RTN","PRCIN45",8,0)
 .S IEN=0
"RTN","PRCIN45",9,0)
 .F  S IEN=$O(^PRCP(445,IPIEN,1,IEN)) Q:IEN'>0  D
"RTN","PRCIN45",10,0)
 ..S TREC=TREC+1
"RTN","PRCIN45",11,0)
 ..Q:'$D(^PRCP(445,IPIEN,1,IEN,7))
"RTN","PRCIN45",12,0)
 ..S TTLI=$P(^PRCP(445,IPIEN,1,IEN,7,0),U,4)
"RTN","PRCIN45",13,0)
 ..S ITIEN=0
"RTN","PRCIN45",14,0)
 ..F  S ITIEN=$O(^PRCP(445,IPIEN,1,IEN,7,ITIEN)) Q:ITIEN'>0  D
"RTN","PRCIN45",15,0)
 ...I '$D(^PRCS(410,ITIEN)) D KILL445
"RTN","PRCIN45",16,0)
 ..S $P(^PRCP(445,IPIEN,1,IEN,7,0),U,4)=TTLI
"RTN","PRCIN45",17,0)
 ..;-leave this with zero amount don't delete? - I TTLI=0 S ^PRCP(445,IPIEN,1,IEN,7) Q
"RTN","PRCIN45",18,0)
 ..Q
"RTN","PRCIN45",19,0)
 .Q
"RTN","PRCIN45",20,0)
 D WTOTAL,CLEAN
"RTN","PRCIN45",21,0)
 Q
"RTN","PRCIN45",22,0)
WTOTAL ;
"RTN","PRCIN45",23,0)
 D BMES^XPDUTL(NREC_" RECORDS DELETED FROM FILE 445")
"RTN","PRCIN45",24,0)
 D BMES^XPDUTL("BACKUP RECORDS STORED IN THE FOLLOWING LOCATIONS FOR 7 DAYS:")
"RTN","PRCIN45",25,0)
 D BMES^XPDUTL("^XTMP(""IFCAP-PURGE-445"")")
"RTN","PRCIN45",26,0)
 D BMES^XPDUTL("^XTMP(""IFCAP-PURGE-445-REF"")")
"RTN","PRCIN45",27,0)
 Q
"RTN","PRCIN45",28,0)
KILL445 ;set temp files then kill invalid 445 records
"RTN","PRCIN45",29,0)
 S NREC=NREC+1
"RTN","PRCIN45",30,0)
 S ^XTMP("IFCAP-PURGE-445",IPIEN,1,IEN,7,ITIEN,0)=^PRCP(445,IPIEN,1,IEN,7,ITIEN,0)
"RTN","PRCIN45",31,0)
 S ^XTMP("IFCAP-PURGE-445-REF",IPIEN,1,IEN,7,"B",ITIEN,ITIEN)="B^"_ITIEN_"^"_ITIEN
"RTN","PRCIN45",32,0)
 Q:'$D(^PRCP(445,IPIEN,1,IEN,7,ITIEN,0))
"RTN","PRCIN45",33,0)
 S DA(2)=IPIEN,DA(1)=IEN,DA=ITIEN
"RTN","PRCIN45",34,0)
 S DIK="^PRCP(445,"_DA(2)_",1,"_DA(1)_",7,"
"RTN","PRCIN45",35,0)
 D ^DIK
"RTN","PRCIN45",36,0)
 K DIK
"RTN","PRCIN45",37,0)
 S TTLI=TTLI-1
"RTN","PRCIN45",38,0)
 Q
"RTN","PRCIN45",39,0)
CLEAN K TTLI,IEN,IPIEN,ITIEN,TREC,NREC
"RTN","PRCIN45",40,0)
 Q
"RTN","PRCIN45",41,0)
 ;
"RTN","PRCINAR")
0^11^B10282916^n/a
"RTN","PRCINAR",1,0)
PRCINAR ;BP-OIFO/SWS-IFCAP ARCHIVE/PURGE FIX ;12/07/2005  12:16
"RTN","PRCINAR",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCINAR",3,0)
 Q
"RTN","PRCINAR",4,0)
START S (MYREC,MYPTR,SUBREC,NREC)=0
"RTN","PRCINAR",5,0)
 S ^XTMP("IFCAP-PURGE-424-1",0)=$$FMADD^XLFDT(DT,7)_"^"_DT_"^RECORDS PURGED FROM FILE 424.1 BY PRC*5.1*95"
"RTN","PRCINAR",6,0)
 S ^XTMP("IFCAP-PURGE-424-1-REF",0)=$$FMADD^XLFDT(DT,7)_"^"_DT_"^C CROSS REFERENCES PURGED FROM FILE 424.1 BY PRC*5.1*95"
"RTN","PRCINAR",7,0)
 F  S MYPTR=$O(^PRC(424.1,"C",MYPTR)) Q:'MYPTR  D
"RTN","PRCINAR",8,0)
 . I '$D(^PRC(424,MYPTR))  D
"RTN","PRCINAR",9,0)
 . . S SUBREC=0
"RTN","PRCINAR",10,0)
 . . F  S SUBREC=$O(^PRC(424.1,"C",MYPTR,SUBREC))  Q:'SUBREC  D
"RTN","PRCINAR",11,0)
 . . . S ^XTMP("IFCAP-PURGE-424-1",SUBREC)=^PRC(424.1,SUBREC,0)
"RTN","PRCINAR",12,0)
 . . . S ^XTMP("IFCAP-PURGE-424-1-REF",SUBREC)="C^"_MYPTR_"^"_SUBREC
"RTN","PRCINAR",13,0)
 . . . S DA=SUBREC,DIK="^PRC(424.1," D ^DIK
"RTN","PRCINAR",14,0)
 . . . K DIK
"RTN","PRCINAR",15,0)
 . . . S NREC=NREC+1
"RTN","PRCINAR",16,0)
 D WTOTAL,CLEAN
"RTN","PRCINAR",17,0)
 D START2
"RTN","PRCINAR",18,0)
 D FINDREC
"RTN","PRCINAR",19,0)
 Q
"RTN","PRCINAR",20,0)
WTOTAL ;
"RTN","PRCINAR",21,0)
 D BMES^XPDUTL(NREC_" RECORDS DELETED FROM FILE 424.1")
"RTN","PRCINAR",22,0)
 D BMES^XPDUTL("BACKUP RECORDS STORED IN THE FOLLOWING LOCATIONS FOR 7 DAYS:")
"RTN","PRCINAR",23,0)
 D BMES^XPDUTL("^XTMP(""IFCAP-PURGE-424-1"")")
"RTN","PRCINAR",24,0)
 D BMES^XPDUTL("^XTMP(""IFCAP-PURGE-424-1-REF"")")
"RTN","PRCINAR",25,0)
 Q
"RTN","PRCINAR",26,0)
 ;
"RTN","PRCINAR",27,0)
CLEAN K MYREC,MYPTR,SUBREC,NREC
"RTN","PRCINAR",28,0)
 Q
"RTN","PRCINAR",29,0)
 ;
"RTN","PRCINAR",30,0)
START2 S IPIEN=0,NREC=0,TREC=0
"RTN","PRCINAR",31,0)
 S ^XTMP("IFCAP-PURGE-440-6",0)=$$FMADD^XLFDT(DT,7)_"^"_DT_"^RECORDS PURGED FROM FILE 440.6 BY PRC*5.1*95"
"RTN","PRCINAR",32,0)
 S ^XTMP("IFCAP-PURGE-440-6-REF",0)=$$FMADD^XLFDT(DT,7)_"^"_DT_"^B CROSS REFERENCES PURGED FROM FILE 440.6 BY PRC*5.1*95"
"RTN","PRCINAR",33,0)
 F  S IPIEN=$O(^PRCH(440.6,"PO",IPIEN)) Q:IPIEN'>0  D
"RTN","PRCINAR",34,0)
 .S IEN=0
"RTN","PRCINAR",35,0)
 .I '$D(^PRC(442,IPIEN)) D
"RTN","PRCINAR",36,0)
 ..S TREC=TREC+1
"RTN","PRCINAR",37,0)
 ..S IEN=0
"RTN","PRCINAR",38,0)
 ..F  S IEN=$O(^PRCH(440.6,"PO",IPIEN,IEN)) Q:'IEN  D KILL4406
"RTN","PRCINAR",39,0)
 ..Q
"RTN","PRCINAR",40,0)
 .Q
"RTN","PRCINAR",41,0)
 D WTOTAL2,CLEAN2
"RTN","PRCINAR",42,0)
 Q
"RTN","PRCINAR",43,0)
WTOTAL2 ;
"RTN","PRCINAR",44,0)
 D BMES^XPDUTL(NREC_" RECORDS DELETED FROM FILE 440.6")
"RTN","PRCINAR",45,0)
 D BMES^XPDUTL("BACKUP RECORDS STORED IN THE FOLLOWING LOCATIONS FOR 7 DAYS:")
"RTN","PRCINAR",46,0)
 D BMES^XPDUTL("^XTMP(""IFCAP-PURGE-440-6"")")
"RTN","PRCINAR",47,0)
 D BMES^XPDUTL("^XTMP(""IFCAP-PURGE-440-6-REF"")")
"RTN","PRCINAR",48,0)
 Q
"RTN","PRCINAR",49,0)
KILL4406 ;set temp files then kill invalid 440.6 records
"RTN","PRCINAR",50,0)
 N DA
"RTN","PRCINAR",51,0)
 S NREC=NREC+1
"RTN","PRCINAR",52,0)
 S ^XTMP("IFCAP-PURGE-440-6",IPIEN,IEN)=^PRCH(440.6,IEN,0)
"RTN","PRCINAR",53,0)
 S ^XTMP("IFCAP-PURGE-440-6-REF",IPIEN,IEN)="PO^"_IPIEN_"^"_IEN
"RTN","PRCINAR",54,0)
 S DA=IEN
"RTN","PRCINAR",55,0)
 S DIK="^PRCH(440.6," D ^DIK
"RTN","PRCINAR",56,0)
 K DIK,DA
"RTN","PRCINAR",57,0)
 Q
"RTN","PRCINAR",58,0)
CLEAN2 K IEN,IPIEN,TREC,NREC
"RTN","PRCINAR",59,0)
 Q
"RTN","PRCINAR",60,0)
 ;
"RTN","PRCINAR",61,0)
FINDREC N DIC,Y,NREC,MREC,DIE,X
"RTN","PRCINAR",62,0)
 D BMES^XPDUTL("Adding new option to PRCG ARCHIVE/PURGE MENU option.")
"RTN","PRCINAR",63,0)
 S DIC="^DIC(19,",X="PRCG LOAD 417 PURGMASTER"
"RTN","PRCINAR",64,0)
 D ^DIC
"RTN","PRCINAR",65,0)
 I Y'=-1  S NREC=+Y
"RTN","PRCINAR",66,0)
FINDMNU S (DIC,Y)=""
"RTN","PRCINAR",67,0)
 S DIC="^DIC(19,",X="PRCG ARCHIVE/PURGE MASTER MENU"
"RTN","PRCINAR",68,0)
 D ^DIC
"RTN","PRCINAR",69,0)
 I Y'=-1  S MREC=+Y
"RTN","PRCINAR",70,0)
UPDMNU S (DIC,Y)=""
"RTN","PRCINAR",71,0)
 S (BFLAG,NTHIS)=0
"RTN","PRCINAR",72,0)
 F  S NTHIS=$O(^DIC(19,MREC,10,NTHIS))  Q:'NTHIS!(BFLAG=1)  D
"RTN","PRCINAR",73,0)
 . S MYIEN=$G(^DIC(19,MREC,10,NTHIS,0))
"RTN","PRCINAR",74,0)
 . I MYIEN=NREC  S BFLAG=1
"RTN","PRCINAR",75,0)
 I BFLAG=0  D
"RTN","PRCINAR",76,0)
 . S DIC="^DIC(19,"_MREC_",10,",DIC(0)="",DIC("P")="19.01IP"
"RTN","PRCINAR",77,0)
 . S X=NREC
"RTN","PRCINAR",78,0)
 . S DA(1)=MREC
"RTN","PRCINAR",79,0)
 . D FILE^DICN
"RTN","PRCINAR",80,0)
CLNREC K BFLAG,NTHIS,MREC,NREC
"RTN","PRCINAR",81,0)
 Q
"RTN","PRCSP122")
0^9^B10606515^B10132798
"RTN","PRCSP122",1,0)
PRCSP122 ;WISC/SAW-CONTROL POINT ACTIVITY 2237 PRINTOUT CON'T ;4/21/93  08:53
"RTN","PRCSP122",2,0)
V ;;5.1;IFCAP;**95**;Oct 20, 2000
"RTN","PRCSP122",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSP122",4,0)
 I '$D(^PRCS(410,DA,"RM",0)) G DEL
"RTN","PRCSP122",5,0)
 I $D(^PRCS(410,DA,"RM",0)) W ! S P(1)=0,DIWL=6,DIWR=96,DIWF="" K ^UTILITY($J,"W") S X="SPECIAL REMARKS:" D DIWP^PRCUTL($G(DA)) F J=1:1 S P(1)=$O(^PRCS(410,DA,"RM",P(1))) Q:P(1)=""  S X=^(P(1),0) D DIWP^PRCUTL($G(DA))
"RTN","PRCSP122",6,0)
 S Z=^UTILITY($J,"W",DIWL) F K=1:1:Z D:$Y>62 NEWP^PRCSP121 W !,^UTILITY($J,"W",DIWL,K,0)
"RTN","PRCSP122",7,0)
DEL I $D(^PRCS(410,DA,9)),$P(^(9),U)'="" W !,"DELIVER TO: ",$P(^(9),U)
"RTN","PRCSP122",8,0)
 W !,L,!,"FOB",?24,"|TERMS",?48,"|DELIVERY DATE",?63,"|QUOTE DATE",?77,"|BY(Initials)",!,?24,"|",?48,"|",?63,"|",?77,"|"
"RTN","PRCSP122",9,0)
 W !,$E(L,1,24),"|",$E(L,1,23),"|",$E(L,1,14),"|",$E(L,1,13),"|",$E(L,1,12)
"RTN","PRCSP122",10,0)
 I $Y>58 D NEWP^PRCSP121
"RTN","PRCSP122",11,0)
 W !,"JUSTIFICATION OF NEED OR TURN-IN (If recurring need, indicate 30-day estimate. If turn-in,",!,"do not use this form if circumstances require use of VA Form 90-1217, Report of Survey)"
"RTN","PRCSP122",12,0)
 I '$D(^PRCS(410,DA,8,0)) G SIG
"RTN","PRCSP122",13,0)
 S (MYTEMP,BFLAG)=0
"RTN","PRCSP122",14,0)
 F I=1:1 S MYTEMP=$O(^PRCS(410,DA,8,MYTEMP)) Q:MYTEMP=""  S BFLAG=1
"RTN","PRCSP122",15,0)
 I BFLAG=0  G SIG
"RTN","PRCSP122",16,0)
 S DIWL=6,DIWR=96,DIWF="" K ^UTILITY($J,"W") S X1=0 F I=1:1 S X1=$O(^PRCS(410,DA,8,X1)) Q:X1=""  S X=^(X1,0) D DIWP^PRCUTL($G(DA))
"RTN","PRCSP122",17,0)
 S Z=^UTILITY($J,"W",DIWL) F K=1:1:Z D:$Y>62 NEWP^PRCSP121 W !,^UTILITY($J,"W",DIWL,K,0)
"RTN","PRCSP122",18,0)
SIG ;PRINT SIGNATURE BLOCKS
"RTN","PRCSP122",19,0)
 I $Y>58 D NEWP^PRCSP121
"RTN","PRCSP122",20,0)
 W !,L
"RTN","PRCSP122",21,0)
 W !,"Originator of Request: " S XNAME=$P($G(^PRCS(410,DA,14)),"^") I XNAME'="" W $P($G(^VA(200,XNAME,0)),"^")
"RTN","PRCSP122",22,0)
 W !,"Signature of Initiator",?39,"|Signature of Approving Official |Date"
"RTN","PRCSP122",23,0)
 I '$D(^PRCS(410,DA,7)) W !,?39,"|",?72,"|",!,?39,"|",?72,"|" G SIG1
"RTN","PRCSP122",24,0)
 K P1 W !,?39,"|" S:$P(^PRCS(410,DA,7),U,3)'="" (P,P1)=$P(^(7),U,3) I $D(P1) W "/ES/",$$DECODE^PRCSC1(DA)
"RTN","PRCSP122",25,0)
 N PRSHLE S PRSHLE=^DD(410,40,0) W ?72,"|",! I $P(^PRCS(410,DA,7),U)'="" S (P,P2)=$P(^(7),U) I $P(PRSHLE,"^",2)[200,$D(^VA(200,P,20)),$P(^(20),U,2)]"" W $E($P(^(20),U,2),1,31)
"RTN","PRCSP122",26,0)
 I $D(P2),$P(^DD(410,40,0),"^",2)[200,$D(^VA(200,+P2,.13)),$L($P(^(.13),U,2))'>4 W " (",$P(^(.13),U,2),")"
"RTN","PRCSP122",27,0)
 K P2 W ?39,"|" I $D(P1),$P(^DD(410,42,0),"^",2)[200,$D(^VA(200,P1,20)),$P(^(20),U,2)]"" W $E($P(^(20),U,2),1,33)
"RTN","PRCSP122",28,0)
 W ?72,"|",! W:$P(^PRCS(410,DA,7),U,2)'="" $P(^(7),U,2) W ?39,"|" W:$P(^(7),U,4)'="" $P(^(7),U,4) W ?72,"|" S Y=$S($P(^(7),U,7):$P(^(7),U,7),1:$P(^(7),U,5)) I Y D DD^%DT W Y
"RTN","PRCSP122",29,0)
SIG1 W !,$E(L,1,39)
"RTN","PRCSP122",30,0)
 W "|",$E(L,1,32)
"RTN","PRCSP122",31,0)
 W "|",$E(L,1,17) Q:PRNTALL=0  I $Y>41 D NEWP^PRCSP121
"RTN","PRCSP122",32,0)
 Q
"VER")
8.0^22.0
"BLD",4941,6)
^90
**END**
**END**
