Released USR*1*18 SEQ #17
Extracted from mail message
**KIDS**:USR*1.0*18^

**INSTALL NAME**
USR*1.0*18
"BLD",2809,0)
USR*1.0*18^AUTHORIZATION/SUBSCRIPTION^0^3010228^y
"BLD",2809,1,0)
^^2^2^3010228^^^^
"BLD",2809,1,1,0)
A description of this build can be found on the NATIONAL PATCH MODULE under 
"BLD",2809,1,2,0)
USR*1.0*18.
"BLD",2809,4,0)
^9.64PA^^
"BLD",2809,"INID")
^
"BLD",2809,"INIT")

"BLD",2809,"KRN",0)
^9.67PA^19^17
"BLD",2809,"KRN",.4,0)
.4
"BLD",2809,"KRN",.401,0)
.401
"BLD",2809,"KRN",.402,0)
.402
"BLD",2809,"KRN",.403,0)
.403
"BLD",2809,"KRN",.5,0)
.5
"BLD",2809,"KRN",.84,0)
.84
"BLD",2809,"KRN",3.6,0)
3.6
"BLD",2809,"KRN",3.8,0)
3.8
"BLD",2809,"KRN",9.2,0)
9.2
"BLD",2809,"KRN",9.8,0)
9.8
"BLD",2809,"KRN",9.8,"NM",0)
^9.68A^3^1
"BLD",2809,"KRN",9.8,"NM",3,0)
USRECCL^^0^B29525466
"BLD",2809,"KRN",9.8,"NM","B","USRECCL",3)

"BLD",2809,"KRN",19,0)
19
"BLD",2809,"KRN",19,"NM",0)
^9.68A^^
"BLD",2809,"KRN",19.1,0)
19.1
"BLD",2809,"KRN",101,0)
101
"BLD",2809,"KRN",101,"NM",0)
^9.68A^^0
"BLD",2809,"KRN",409.61,0)
409.61
"BLD",2809,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",2809,"KRN",771,0)
771
"BLD",2809,"KRN",870,0)
870
"BLD",2809,"KRN",8994,0)
8994
"BLD",2809,"KRN","B",.4,.4)

"BLD",2809,"KRN","B",.401,.401)

"BLD",2809,"KRN","B",.402,.402)

"BLD",2809,"KRN","B",.403,.403)

"BLD",2809,"KRN","B",.5,.5)

"BLD",2809,"KRN","B",.84,.84)

"BLD",2809,"KRN","B",3.6,3.6)

"BLD",2809,"KRN","B",3.8,3.8)

"BLD",2809,"KRN","B",9.2,9.2)

"BLD",2809,"KRN","B",9.8,9.8)

"BLD",2809,"KRN","B",19,19)

"BLD",2809,"KRN","B",19.1,19.1)

"BLD",2809,"KRN","B",101,101)

"BLD",2809,"KRN","B",409.61,409.61)

"BLD",2809,"KRN","B",771,771)

"BLD",2809,"KRN","B",870,870)

"BLD",2809,"KRN","B",8994,8994)

"BLD",2809,"QUES",0)
^9.62^^
"BLD",2809,"REQB",0)
^9.611^2^2
"BLD",2809,"REQB",1,0)
USR*1.0*7^2
"BLD",2809,"REQB",2,0)
USR*1.0*17^2
"BLD",2809,"REQB","B","USR*1.0*17",2)

"BLD",2809,"REQB","B","USR*1.0*7",1)

"MBREQ")
0
"PKG",194,-1)
1^1
"PKG",194,0)
AUTHORIZATION/SUBSCRIPTION^USR^User Authorization
"PKG",194,20,0)
^9.402P^^
"PKG",194,22,0)
^9.49I^1^1
"PKG",194,22,1,0)
1.0^2970620
"PKG",194,22,1,"PAH",1,0)
18^3010228
"PKG",194,22,1,"PAH",1,1,0)
^^2^2^3010228
"PKG",194,22,1,"PAH",1,1,1,0)
A description of this build can be found on the NATIONAL PATCH MODULE under 
"PKG",194,22,1,"PAH",1,1,2,0)
USR*1.0*18.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","USRECCL")
0^3^B29525466
"RTN","USRECCL",1,0)
USRECCL ; SLC/PKR,MA - Routines for expanding/collapsing class views ;2/21/01  14:53
"RTN","USRECCL",2,0)
 ;;1.0;AUTHORIZATION/SUBSCRIPTION;**7,18**;Jun 20, 1997
"RTN","USRECCL",3,0)
 ; Patch USR*1*18 additional quit to contract logic in tag EC.
"RTN","USRECCL",4,0)
 ; This routine invokes IA #872
"RTN","USRECCL",5,0)
 ;======================================================================
"RTN","USRECCL",6,0)
COPYCL(LIST,LSTART,START,END) ;Copy elements of ^TMP("USRCLASS",$J) starting
"RTN","USRECCL",7,0)
 ;at START going to END.
"RTN","USRECCL",8,0)
 N IND,TEXT
"RTN","USRECCL",9,0)
 F IND=START:1:END D
"RTN","USRECCL",10,0)
 . S LSTART=LSTART+1
"RTN","USRECCL",11,0)
 . S TEXT=^TMP("USRCLASS",$J,IND,0)
"RTN","USRECCL",12,0)
 . S TEXT=$$SETFLD^VALM1(LSTART,TEXT,"NUMBER")
"RTN","USRECCL",13,0)
 . S LIST(LSTART)=TEXT_U_$P($G(^TMP("USRCLASSIDX",$J,IND)),U,2)
"RTN","USRECCL",14,0)
 Q LSTART
"RTN","USRECCL",15,0)
 ;
"RTN","USRECCL",16,0)
 ;======================================================================
"RTN","USRECCL",17,0)
EC(VALMY) ;Expand or contract the list of classes in VALMY.
"RTN","USRECCL",18,0)
 ;Make sure the request is valid.
"RTN","USRECCL",19,0)
 I '$$VEXREQ(.VALMY) Q
"RTN","USRECCL",20,0)
 N ACTION,DIROUT,LISTNUM,REBUILD,START,TSTART,TEXT,TMPLIST
"RTN","USRECCL",21,0)
 N USRDATA,USRI,USRIEN,USRPICK
"RTN","USRECCL",22,0)
 S REBUILD=0
"RTN","USRECCL",23,0)
 S START=1
"RTN","USRECCL",24,0)
 S TSTART=0
"RTN","USRECCL",25,0)
 S USRI=""
"RTN","USRECCL",26,0)
 F  S USRI=$O(VALMY(USRI)) Q:+USRI'>0  D  Q:$D(DIROUT)
"RTN","USRECCL",27,0)
 . S USRDATA=^TMP("USRCLASSIDX",$J,USRI)
"RTN","USRECCL",28,0)
 . S LISTNUM=$P(USRDATA,U,1)
"RTN","USRECCL",29,0)
 . S USRIEN=$P(USRDATA,U,2)
"RTN","USRECCL",30,0)
 . S TEXT=$G(^TMP("USRCLASS",$J,LISTNUM,0))
"RTN","USRECCL",31,0)
 . S ACTION=$S(TEXT["+":"+",TEXT["-":"-",1:"")
"RTN","USRECCL",32,0)
 . I ACTION="" Q
"RTN","USRECCL",33,0)
 .;If ACTION="+" then expand the class, if ACTION="-" shrink the class.
"RTN","USRECCL",34,0)
 . I ACTION="+" D
"RTN","USRECCL",35,0)
 .. S REBUILD=1
"RTN","USRECCL",36,0)
 .. S TSTART=$$COPYCL(.TMPLIST,TSTART,START,LISTNUM-1)
"RTN","USRECCL",37,0)
 .. S START=LISTNUM+1
"RTN","USRECCL",38,0)
 .. S TSTART=TSTART+1
"RTN","USRECCL",39,0)
 .. S TMPLIST(TSTART)=$$SETFLD^VALM1(TSTART,TEXT,"NUMBER")
"RTN","USRECCL",40,0)
 .. S TMPLIST(TSTART)=$TR(TMPLIST(TSTART),"+","-")
"RTN","USRECCL",41,0)
 .. S TMPLIST(TSTART)=TMPLIST(TSTART)_U_USRIEN
"RTN","USRECCL",42,0)
 .. S TSTART=$$INSSUB(.TMPLIST,TSTART,USRIEN)
"RTN","USRECCL",43,0)
 .;
"RTN","USRECCL",44,0)
 . I ACTION="-" D
"RTN","USRECCL",45,0)
 .. N TEMP,CONTRACT
"RTN","USRECCL",46,0)
 .. S REBUILD=1
"RTN","USRECCL",47,0)
 .. S TSTART=$$COPYCL(.TMPLIST,TSTART,START,LISTNUM-1)
"RTN","USRECCL",48,0)
 .. S TSTART=TSTART+1
"RTN","USRECCL",49,0)
 .. S TMPLIST(TSTART)=$$SETFLD^VALM1(TSTART,TEXT,"NUMBER")
"RTN","USRECCL",50,0)
 .. S LEVEL=$L(TEXT,"|")
"RTN","USRECCL",51,0)
 .. S TMPLIST(TSTART)=$TR(TMPLIST(TSTART),"-","+")_U_USRIEN
"RTN","USRECCL",52,0)
 .. S START=USRI+1
"RTN","USRECCL",53,0)
 .. S CONTRACT=1
"RTN","USRECCL",54,0)
 .. ; Patch 18 added the second quit.
"RTN","USRECCL",55,0)
 .. F  Q:'CONTRACT  Q:'$D(^TMP("USRCLASS",$J,START,0))  D
"RTN","USRECCL",56,0)
 ... S TEMP=^TMP("USRCLASS",$J,START,0)
"RTN","USRECCL",57,0)
 ...;Contract if at a or higher level than the main line
"RTN","USRECCL",58,0)
 ... I TEMP["|",$L(TEMP,"|")>LEVEL S START=START+1
"RTN","USRECCL",59,0)
 ... E  S CONTRACT=0
"RTN","USRECCL",60,0)
 .;
"RTN","USRECCL",61,0)
 .;Restore the original video attributes.
"RTN","USRECCL",62,0)
 . D RESTORE^VALM10(USRI)
"RTN","USRECCL",63,0)
 ;No more classes to expand or contract, add the rest of the list.
"RTN","USRECCL",64,0)
 I 'REBUILD Q
"RTN","USRECCL",65,0)
 S LISTNUM=$P(^TMP("USRCLASS",$J,0),U,1)
"RTN","USRECCL",66,0)
 S TSTART=$$COPYCL(.TMPLIST,TSTART,START,LISTNUM)
"RTN","USRECCL",67,0)
 ;Rebuild the ^TMP arrays.
"RTN","USRECCL",68,0)
 K ^TMP("USRCLASS",$J),^TMP("USRCLASSIDX",$J),^TMP("USRCLASS",$J,"PICK")
"RTN","USRECCL",69,0)
 S VALMCNT=0
"RTN","USRECCL",70,0)
 S START=0
"RTN","USRECCL",71,0)
 F  S START=$O(TMPLIST(START)) Q:START=""  D
"RTN","USRECCL",72,0)
 . S VALMCNT=VALMCNT+1
"RTN","USRECCL",73,0)
 . S TEXT=$P(TMPLIST(START),U,1)
"RTN","USRECCL",74,0)
 . S USRIEN=$P(TMPLIST(START),U,2)
"RTN","USRECCL",75,0)
 . S ^TMP("USRCLASS",$J,START,0)=TEXT
"RTN","USRECCL",76,0)
 . S ^TMP("USRCLASS",$J,"IDX",START,START)=""
"RTN","USRECCL",77,0)
 . S ^TMP("USRCLASSIDX",$J,START)=START_U_USRIEN
"RTN","USRECCL",78,0)
 . ;S ^TMP("USRCLASS",$J,"PICK",START,START)=""
"RTN","USRECCL",79,0)
 S ^TMP("USRCLASS",$J,0)=VALMCNT
"RTN","USRECCL",80,0)
 S USRPICK=+$O(^ORD(101,"B","USR ACTION SELECT LIST ELEMENT",0))
"RTN","USRECCL",81,0)
 S ^TMP("USRCLASS",$J,"#")=USRPICK_U_"1:"_+$G(VALMCNT)
"RTN","USRECCL",82,0)
 Q
"RTN","USRECCL",83,0)
 ;
"RTN","USRECCL",84,0)
 ;======================================================================
"RTN","USRECCL",85,0)
INSSUB(LIST,TSTART,USRIEN) ;Insert the subclasses into the list.
"RTN","USRECCL",86,0)
 N ACTIVE,CLN,CLNS,DATA,IND,IEN,LEVEL,MSG,TEXT
"RTN","USRECCL",87,0)
 ;Determine the level of the subclass and create the appropriate
"RTN","USRECCL",88,0)
 ;diagram.
"RTN","USRECCL",89,0)
 S LEVEL=$L(LIST(TSTART),"|")
"RTN","USRECCL",90,0)
 I LEVEL=1 S CLNS=" "
"RTN","USRECCL",91,0)
 E  S CLNS=""
"RTN","USRECCL",92,0)
 F IND=2:1:LEVEL S CLNS=CLNS_" | "
"RTN","USRECCL",93,0)
 I LEVEL>1 S CLNS=CLNS_" |_"
"RTN","USRECCL",94,0)
 E  S CLNS=CLNS_"|_"
"RTN","USRECCL",95,0)
 S IND=0
"RTN","USRECCL",96,0)
 F  S IND=$O(^USR(8930,USRIEN,1,IND)) Q:+IND=0  D
"RTN","USRECCL",97,0)
 . S IEN=^USR(8930,USRIEN,1,IND,0)
"RTN","USRECCL",98,0)
 . S DATA=$G(^USR(8930,IEN,0))
"RTN","USRECCL",99,0)
 . S TSTART=TSTART+1
"RTN","USRECCL",100,0)
 . S TEXT=$$SETFLD^VALM1(TSTART,"","NUMBER")
"RTN","USRECCL",101,0)
 . S CLN=CLNS
"RTN","USRECCL",102,0)
 . I $D(^USR(8930,IEN,1,0))&$D(^USR(8930,IEN,1,"B")) S CLN=CLN_"+"
"RTN","USRECCL",103,0)
 . E  S CLN=CLN_" "
"RTN","USRECCL",104,0)
 . S CLN=CLN_$P(DATA,U,4)
"RTN","USRECCL",105,0)
 . S TEXT=$$SETFLD^VALM1(CLN,TEXT,"CLASS NAME")
"RTN","USRECCL",106,0)
 . S TEXT=$$SETFLD^VALM1($P(DATA,U,2),TEXT,"ABBREVIATION")
"RTN","USRECCL",107,0)
 . S ACTIVE=$$EXTERNAL^DILFD(8930,.03,"",$P(DATA,U,3),"MSG")
"RTN","USRECCL",108,0)
 . S TEXT=$$SETFLD^VALM1(ACTIVE,TEXT,"ACTIVE")
"RTN","USRECCL",109,0)
 .;NEED USRCLASSIDX INFO
"RTN","USRECCL",110,0)
 . S LIST(TSTART)=TEXT_U_IEN
"RTN","USRECCL",111,0)
 Q TSTART
"RTN","USRECCL",112,0)
 ;
"RTN","USRECCL",113,0)
 ;======================================================================
"RTN","USRECCL",114,0)
ISSUB(CLASS1,CLASS2,LEVEL) ;Return true if CLASS2 is sub to CLASS1.
"RTN","USRECCL",115,0)
 N IND,ISSUB
"RTN","USRECCL",116,0)
 I LEVEL(CLASS1)'<LEVEL(CLASS2) Q 0
"RTN","USRECCL",117,0)
 ;Check sublevel links between class1 and class2
"RTN","USRECCL",118,0)
 S ISSUB=1
"RTN","USRECCL",119,0)
 F IND=(CLASS1+1):1:(CLASS2-1) D
"RTN","USRECCL",120,0)
 . I LEVEL(IND)=1 D  Q
"RTN","USRECCL",121,0)
 .. S ISSUB=0
"RTN","USRECCL",122,0)
 Q ISSUB
"RTN","USRECCL",123,0)
 ;
"RTN","USRECCL",124,0)
 ;======================================================================
"RTN","USRECCL",125,0)
VEXREQ(VALMY) ;Check for valid expand/contract requests.
"RTN","USRECCL",126,0)
 N END,START
"RTN","USRECCL",127,0)
 S START=$O(VALMY(""))
"RTN","USRECCL",128,0)
 S END=$O(VALMY(""),-1)
"RTN","USRECCL",129,0)
 I START=END Q 1
"RTN","USRECCL",130,0)
 ;
"RTN","USRECCL",131,0)
 N ACTION,ACTIND,ACTJND,CIND,CN,IND,JND,LEVEL,MSG,TEXT,VALID
"RTN","USRECCL",132,0)
 ;Build the level list.
"RTN","USRECCL",133,0)
 F IND=START:1:END D
"RTN","USRECCL",134,0)
 . S LEVEL(IND)=$L(^TMP("USRCLASS",$J,IND,0),"|")
"RTN","USRECCL",135,0)
 S VALID=1
"RTN","USRECCL",136,0)
 S IND=""
"RTN","USRECCL",137,0)
 F  S IND=$O(VALMY(IND)) Q:IND=""  D
"RTN","USRECCL",138,0)
 . S TEXT(IND)=$G(^TMP("USRCLASS",$J,IND,0))
"RTN","USRECCL",139,0)
 . S ACTIND=$S(TEXT(IND)["+":"+ ",TEXT(IND)["-":"-",1:"")
"RTN","USRECCL",140,0)
 . I ACTIND="" Q
"RTN","USRECCL",141,0)
 . S ACTION(IND)=$S(TEXT(IND)["+":"expand ",TEXT(IND)["-":"collapse ",1:"")
"RTN","USRECCL",142,0)
 . S JND=IND
"RTN","USRECCL",143,0)
 . F  S JND=$O(VALMY(JND)) Q:JND=""  D
"RTN","USRECCL",144,0)
 .. S TEXT(JND)=$G(^TMP("USRCLASS",$J,JND,0))
"RTN","USRECCL",145,0)
 .. S ACTJND=$S(TEXT(JND)["+":"+",TEXT(JND)["-":"-",1:"")
"RTN","USRECCL",146,0)
 .. I ACTJND="" Q
"RTN","USRECCL",147,0)
 .. S ACTION(JND)=$S(TEXT(JND)["+":"expand ",TEXT(JND)["-":"collapse ",1:"")
"RTN","USRECCL",148,0)
 .. I $$ISSUB(IND,JND,.LEVEL) D
"RTN","USRECCL",149,0)
 ... I ACTION(IND)'=ACTION(JND) D  Q
"RTN","USRECCL",150,0)
 .... S CIND(IND)=$P(^TMP("USRCLASSIDX",$J,IND),U,2)
"RTN","USRECCL",151,0)
 .... S CN(IND)=$P(^USR(8930,CIND(IND),0),U,1)
"RTN","USRECCL",152,0)
 .... S CIND(JND)=$P(^TMP("USRCLASSIDX",$J,JND),U,2)
"RTN","USRECCL",153,0)
 .... S CN(JND)=$P(^USR(8930,CIND(JND),0),U,1)
"RTN","USRECCL",154,0)
 .... S MSG="You cannot "_ACTION(IND)_CN(IND)_" and "_ACTION(JND)_CN(JND)
"RTN","USRECCL",155,0)
 .... D MSG^VALM10(MSG)
"RTN","USRECCL",156,0)
 .... H 4
"RTN","USRECCL",157,0)
 .... S VALID=0
"RTN","USRECCL",158,0)
 Q VALID
"RTN","USRECCL",159,0)
 ;
"VER")
8.0^22.0
**END**
**END**
