Released PSB*3*20 SEQ #15
Extracted from mail message
**KIDS**:PSB*3.0*20^

**INSTALL NAME**
PSB*3.0*20
"BLD",6305,0)
PSB*3.0*20^BAR CODE MED ADMIN^0^3051130^y
"BLD",6305,1,0)
^^4^4^3051130^
"BLD",6305,1,1,0)
Correction for two  Issues:
"BLD",6305,1,2,0)
 
"BLD",6305,1,3,0)
REMEDY 91869
"BLD",6305,1,4,0)
REMEDY 99958
"BLD",6305,4,0)
^9.64PA^^
"BLD",6305,"ABPKG")
n
"BLD",6305,"KRN",0)
^9.67PA^8989.52^19
"BLD",6305,"KRN",.4,0)
.4
"BLD",6305,"KRN",.401,0)
.401
"BLD",6305,"KRN",.402,0)
.402
"BLD",6305,"KRN",.403,0)
.403
"BLD",6305,"KRN",.5,0)
.5
"BLD",6305,"KRN",.84,0)
.84
"BLD",6305,"KRN",3.6,0)
3.6
"BLD",6305,"KRN",3.8,0)
3.8
"BLD",6305,"KRN",9.2,0)
9.2
"BLD",6305,"KRN",9.8,0)
9.8
"BLD",6305,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6305,"KRN",9.8,"NM",1,0)
PSBMLLKU^^0^62544624
"BLD",6305,"KRN",9.8,"NM",2,0)
PSBOMH2^^0^28071612
"BLD",6305,"KRN",9.8,"NM","B","PSBMLLKU",1)

"BLD",6305,"KRN",9.8,"NM","B","PSBOMH2",2)

"BLD",6305,"KRN",19,0)
19
"BLD",6305,"KRN",19.1,0)
19.1
"BLD",6305,"KRN",101,0)
101
"BLD",6305,"KRN",409.61,0)
409.61
"BLD",6305,"KRN",771,0)
771
"BLD",6305,"KRN",870,0)
870
"BLD",6305,"KRN",8989.51,0)
8989.51
"BLD",6305,"KRN",8989.52,0)
8989.52
"BLD",6305,"KRN",8994,0)
8994
"BLD",6305,"KRN","B",.4,.4)

"BLD",6305,"KRN","B",.401,.401)

"BLD",6305,"KRN","B",.402,.402)

"BLD",6305,"KRN","B",.403,.403)

"BLD",6305,"KRN","B",.5,.5)

"BLD",6305,"KRN","B",.84,.84)

"BLD",6305,"KRN","B",3.6,3.6)

"BLD",6305,"KRN","B",3.8,3.8)

"BLD",6305,"KRN","B",9.2,9.2)

"BLD",6305,"KRN","B",9.8,9.8)

"BLD",6305,"KRN","B",19,19)

"BLD",6305,"KRN","B",19.1,19.1)

"BLD",6305,"KRN","B",101,101)

"BLD",6305,"KRN","B",409.61,409.61)

"BLD",6305,"KRN","B",771,771)

"BLD",6305,"KRN","B",870,870)

"BLD",6305,"KRN","B",8989.51,8989.51)

"BLD",6305,"KRN","B",8989.52,8989.52)

"BLD",6305,"KRN","B",8994,8994)

"BLD",6305,"QUES",0)
^9.62^^
"BLD",6305,"REQB",0)
^9.611^4^4
"BLD",6305,"REQB",1,0)
PSB*3.0*3^2
"BLD",6305,"REQB",2,0)
PSB*3.0*6^2
"BLD",6305,"REQB",3,0)
PSB*3.0*9^2
"BLD",6305,"REQB",4,0)
PSB*3.0*11^2
"BLD",6305,"REQB","B","PSB*3.0*11",4)

"BLD",6305,"REQB","B","PSB*3.0*3",1)

"BLD",6305,"REQB","B","PSB*3.0*6",2)

"BLD",6305,"REQB","B","PSB*3.0*9",3)

"MBREQ")
0
"PKG",537,-1)
1^1
"PKG",537,0)
BAR CODE MED ADMIN^PSB^BAR CODE MEDICATION ADMINISTRATION
"PKG",537,20,0)
^9.402P^^
"PKG",537,22,0)
^9.49I^1^1
"PKG",537,22,1,0)
3.0^3040224^3040504^22979
"PKG",537,22,1,"PAH",1,0)
20^3051130
"PKG",537,22,1,"PAH",1,1,0)
^^4^4^3051130
"PKG",537,22,1,"PAH",1,1,1,0)
Correction for two  Issues:
"PKG",537,22,1,"PAH",1,1,2,0)
 
"PKG",537,22,1,"PAH",1,1,3,0)
REMEDY 91869
"PKG",537,22,1,"PAH",1,1,4,0)
REMEDY 99958
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSBMLLKU")
0^1^B62544624
"RTN","PSBMLLKU",1,0)
PSBMLLKU ;BIRMINGHAM/TEJ-BCMA RPC LOOKUP UTLILITIES ;Mar 2004
"RTN","PSBMLLKU",2,0)
 ;;3.0;BAR CODE MED ADMIN;**3,9,11,20**;Mar 2004
"RTN","PSBMLLKU",3,0)
 ;
"RTN","PSBMLLKU",4,0)
 ; Reference/IA
"RTN","PSBMLLKU",5,0)
 ; EN^PSJBCMA1/2829
"RTN","PSBMLLKU",6,0)
 ; $$DOB^DPTLK1/3266
"RTN","PSBMLLKU",7,0)
 ; $$SSN^DPTLK1/3267
"RTN","PSBMLLKU",8,0)
 ; ^DPT/10035
"RTN","PSBMLLKU",9,0)
 ; ^XUSEC/10076
"RTN","PSBMLLKU",10,0)
 ; File 52.6/436
"RTN","PSBMLLKU",11,0)
 ; File 52.7/437
"RTN","PSBMLLKU",12,0)
 ; File 50/221
"RTN","PSBMLLKU",13,0)
 ;
"RTN","PSBMLLKU",14,0)
 ;
"RTN","PSBMLLKU",15,0)
RPC(RESULTS,PSBREC) ; Remote Procedure Call Entry Point.
"RTN","PSBMLLKU",16,0)
 ;
"RTN","PSBMLLKU",17,0)
 S RESULTS="" D @(PSBREC(0)_"(.RESULTS,.PSBREC)") Q
"RTN","PSBMLLKU",18,0)
 Q
"RTN","PSBMLLKU",19,0)
 ;
"RTN","PSBMLLKU",20,0)
ADMLKUP(RESULTS,PSBREC) ;
"RTN","PSBMLLKU",21,0)
 ;  Lookup ADMinistrations per DFN and search DATE
"RTN","PSBMLLKU",22,0)
 ;   input - PSBREC(1)  DFN
"RTN","PSBMLLKU",23,0)
 ;           PSBREC(2)  Search DATE
"RTN","PSBMLLKU",24,0)
 ;
"RTN","PSBMLLKU",25,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",26,0)
 ;          (Administrations returned will be dated  = to Search Date
"RTN","PSBMLLKU",27,0)
 ;
"RTN","PSBMLLKU",28,0)
 ;
"RTN","PSBMLLKU",29,0)
 K RESULTS
"RTN","PSBMLLKU",30,0)
 S DFN=PSBREC(1),PSBSRCH=$G(PSBREC(2)) I $G(PSBSRCH)']"" D NOW^%DTC S PSBSRCH=$P(%,".")
"RTN","PSBMLLKU",31,0)
 S PSBDT=PSBSRCH,PSBCNT=0 S:PSBSRCH'["." PSBSRCH=PSBSRCH+.9
"RTN","PSBMLLKU",32,0)
 S RESULTS(0)=1,RESULTS(1)="-1^No Meds Found!"
"RTN","PSBMLLKU",33,0)
 F  S PSBSRCH=$O(^PSB(53.79,"AADT",DFN,PSBSRCH),-1) Q:'PSBSRCH!(PSBSRCH<PSBDT)  D
"RTN","PSBMLLKU",34,0)
 .S PSBIEN=""
"RTN","PSBMLLKU",35,0)
 .F  S PSBIEN=$O(^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN),-1) Q:'PSBIEN  D:'$D(^PSB(53.79,PSBIEN)) KILLAADT  Q:'$D(^PSB(53.79,PSBIEN))  D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",36,0)
 ..S PSBXORDN=$$GET1^DIQ(53.79,PSBIEN_",",.11) Q:'$D(^PSB(53.79,"AORDX",DFN,PSBXORDN,PSBSRCH))
"RTN","PSBMLLKU",37,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.06,"I")>PSBSRCH)
"RTN","PSBMLLKU",38,0)
 ..Q:($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")="N")!($$GET1^DIQ(53.79,PSBIEN_",",.09,"I")']"")
"RTN","PSBMLLKU",39,0)
 ..S PSBCNT=PSBCNT+1,RESULTS(PSBCNT)=PSBIEN
"RTN","PSBMLLKU",40,0)
 ..S $P(RESULTS(PSBCNT),U,2)=PSBSRCH
"RTN","PSBMLLKU",41,0)
 ..S $P(RESULTS(PSBCNT),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",42,0)
 ..S:$$GET1^DIQ(53.79,PSBIEN_",",.26) $P(RESULTS(PSBCNT),U,4)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",43,0)
 ..S $P(RESULTS(PSBCNT),U,5)=$$GET1^DIQ(53.79,PSBIEN_",",.09)
"RTN","PSBMLLKU",44,0)
 ..D  ; Get order information
"RTN","PSBMLLKU",45,0)
 ...K ^TMP("PSJ1",$J) D EN^PSJBCMA1(DFN,PSBXORDN,1)
"RTN","PSBMLLKU",46,0)
 ...S $P(RESULTS(PSBCNT),U,3)=$P(^TMP("PSJ1",$J,2),U,2)  ;OItem_" "_Dosage Form
"RTN","PSBMLLKU",47,0)
 ...S $P(RESULTS(PSBCNT),U,6)=$P(^TMP("PSJ1",$J,4),U)    ;Sched Type
"RTN","PSBMLLKU",48,0)
 ...K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",49,0)
 ..S $P(RESULTS(PSBCNT),U,7)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",50,0)
 ..S $P(RESULTS(PSBCNT),U,8)=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:INITIAL")
"RTN","PSBMLLKU",51,0)
 ..S:$D(^PSB(53.79,PSBIEN,.2)) $P(RESULTS(PSBCNT),U,9)=$P(^PSB(53.79,PSBIEN,.2),U),$P(RESULTS(PSBCNT),U,10)=$P(^PSB(53.79,PSBIEN,.2),U,2)
"RTN","PSBMLLKU",52,0)
 S:+$G(RESULTS(1))>0 $P(RESULTS(0),U)=PSBCNT
"RTN","PSBMLLKU",53,0)
 Q
"RTN","PSBMLLKU",54,0)
 ;
"RTN","PSBMLLKU",55,0)
CHKKEY(PSBIENX) ;
"RTN","PSBMLLKU",56,0)
 I '(($D(^XUSEC("PSB MANAGER",DUZ)))!($$GET1^DIQ(53.79,+PSBIENX,.07,"I")=DUZ)) Q 0
"RTN","PSBMLLKU",57,0)
 Q 1
"RTN","PSBMLLKU",58,0)
 ;
"RTN","PSBMLLKU",59,0)
PTLKUP(RESULTS,PSBREC) ; Patient lookup handled separately for security
"RTN","PSBMLLKU",60,0)
 ;   input - PSBREC (array)  User entered patient lookup data
"RTN","PSBMLLKU",61,0)
 ;
"RTN","PSBMLLKU",62,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",63,0)
 ;          (Person(s) in PATIENT File (#2) meeting search criteria)
"RTN","PSBMLLKU",64,0)
 ;
"RTN","PSBMLLKU",65,0)
 ;
"RTN","PSBMLLKU",66,0)
 K RESULTS
"RTN","PSBMLLKU",67,0)
 S PSBDATA=$E(PSBREC(1),1,30)
"RTN","PSBMLLKU",68,0)
 N PSBINDX
"RTN","PSBMLLKU",69,0)
 S PSBINDX=$S(PSBDATA?9N.1P:"SSN",PSBDATA?4N.1P:"BS5^BS",1:"")
"RTN","PSBMLLKU",70,0)
 D FIND^DIC(2,"","@;.01;.02;.03;.09","MP",PSBDATA,200,PSBINDX)
"RTN","PSBMLLKU",71,0)
 I $P($G(^TMP("DILIST",$J,0)),U,3) D  Q
"RTN","PSBMLLKU",72,0)
 .S RESULTS(0)=1,RESULTS(1)="-1^Too many patients found matching '"_PSBDATA_"'. Please be more specific."
"RTN","PSBMLLKU",73,0)
 I $D(^TMP("DILIST",$J,0)) D
"RTN","PSBMLLKU",74,0)
 .F PSBXX=0:0 S PSBXX=$O(^TMP("DILIST",$J,PSBXX)) Q:'PSBXX  D
"RTN","PSBMLLKU",75,0)
 ..S RESULTS(PSBXX)=$$PTREC(+^TMP("DILIST",$J,PSBXX,0))
"RTN","PSBMLLKU",76,0)
 I '$D(RESULTS) S RESULTS(0)=1,RESULTS(1)="-1^No patients matching '"_PSBDATA_"'"
"RTN","PSBMLLKU",77,0)
 E  S RESULTS(0)=+$O(RESULTS(""),-1)
"RTN","PSBMLLKU",78,0)
 Q
"RTN","PSBMLLKU",79,0)
 ;
"RTN","PSBMLLKU",80,0)
PTREC(DFN) ;
"RTN","PSBMLLKU",81,0)
 ; Extrinsic to return a Pt Rec  in standard list format
"RTN","PSBMLLKU",82,0)
 N PSBXX
"RTN","PSBMLLKU",83,0)
 S PSBXX=$G(^DPT(DFN,0))
"RTN","PSBMLLKU",84,0)
 S PSBXX=DFN_U_$P(PSBXX,U,1)_U_$P(PSBXX,U,2)_U_$P(PSBXX,U,3)_U_$P(PSBXX,U,9)
"RTN","PSBMLLKU",85,0)
 S $P(PSBXX,U,6)=$$GET1^DIQ(2,DFN_",",.1)
"RTN","PSBMLLKU",86,0)
 S $P(PSBXX,U,7)=$$GET1^DIQ(2,DFN_",",.101)
"RTN","PSBMLLKU",87,0)
 S $P(PSBXX,U,10)=$$DOB^DPTLK1(DFN)
"RTN","PSBMLLKU",88,0)
 S $P(PSBXX,U,11)=$$SSN^DPTLK1(DFN)
"RTN","PSBMLLKU",89,0)
 Q PSBXX
"RTN","PSBMLLKU",90,0)
 ;
"RTN","PSBMLLKU",91,0)
SELECTAD(RESULTS,PSBREC) ; Select Administration
"RTN","PSBMLLKU",92,0)
 ;
"RTN","PSBMLLKU",93,0)
 ;  Process the SELECTed ADministration
"RTN","PSBMLLKU",94,0)
 ;   input - PSBREC(1) = PSB Med Log File (#53.79) IEN
"RTN","PSBMLLKU",95,0)
 ;
"RTN","PSBMLLKU",96,0)
 ;
"RTN","PSBMLLKU",97,0)
 ;   outpt - RESULTS (array)
"RTN","PSBMLLKU",98,0)
 ;          (Administration data that can be subsequently updated via GUI MED LOG EDIT)
"RTN","PSBMLLKU",99,0)
 ;
"RTN","PSBMLLKU",100,0)
 ;
"RTN","PSBMLLKU",101,0)
 K RESULTS,PSBXIV,PSBPTCHX
"RTN","PSBMLLKU",102,0)
 N PSBIEN,PSBCNT,PSBX S PSBIEN=PSBREC(1),PSBCNT=2
"RTN","PSBMLLKU",103,0)
 ; Construct form data    Patient^SSN^Med^BagID^AdminStat^AdminD/T^InjctSt^PRNReas^PRNEff^DisDrg^UntsGiven^Unt^
"RTN","PSBMLLKU",104,0)
 S RESULTS(0)=0
"RTN","PSBMLLKU",105,0)
 D:$$CHKKEY(PSBIEN)
"RTN","PSBMLLKU",106,0)
 .L +^PSB(53.79,PSBIEN):1
"RTN","PSBMLLKU",107,0)
 .E  S PSBCNT=1,RESULTS(1)="-1^ This administration is being modified by another process at this moment." Q
"RTN","PSBMLLKU",108,0)
 .S $P(RESULTS(1),U)=PSBIEN
"RTN","PSBMLLKU",109,0)
 .S $P(RESULTS(1),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.01,"I")
"RTN","PSBMLLKU",110,0)
 .S $P(RESULTS(1),U,3)=$$GET1^DIQ(53.79,PSBIEN_",",.01)
"RTN","PSBMLLKU",111,0)
 .S $P(RESULTS(1),U,4)=$$GET1^DIQ(2,$P(RESULTS(1),U,2)_",",.09)
"RTN","PSBMLLKU",112,0)
 .S $P(RESULTS(1),U,5)=$$GET1^DIQ(53.79,PSBIEN_",",.08,"I")_"~"_$$GET1^DIQ(53.79,PSBIEN_",",.08)
"RTN","PSBMLLKU",113,0)
 .S $P(RESULTS(1),U,6)=$$GET1^DIQ(53.79,PSBIEN_",",.26)
"RTN","PSBMLLKU",114,0)
 .S $P(RESULTS(1),U,7)=$$GET1^DIQ(53.79,PSBIEN_",",.09,"I")
"RTN","PSBMLLKU",115,0)
 .;
"RTN","PSBMLLKU",116,0)
 .D:($P(RESULTS(1),U,7)'="N")&($P(RESULTS(1),U,7)]"") SELSTTUS(.RESULTS)  ; Amend RESULTS(1) data...
"RTN","PSBMLLKU",117,0)
 .S Y=$E($$GET1^DIQ(53.79,PSBIEN_",",.06,"I"),1,12) D DD^%DT
"RTN","PSBMLLKU",118,0)
 .S $P(RESULTS(1),U,8)=Y
"RTN","PSBMLLKU",119,0)
 .S $P(RESULTS(1),U,9)=$$GET1^DIQ(53.79,PSBIEN_",",.06,"I")
"RTN","PSBMLLKU",120,0)
 .S $P(RESULTS(1),U,10)=$$GET1^DIQ(53.79,PSBIEN_",",.16)
"RTN","PSBMLLKU",121,0)
 .S $P(RESULTS(1),U,16)=0
"RTN","PSBMLLKU",122,0)
 .S $P(RESULTS(2),U)=$$GET1^DIQ(53.79,PSBIEN_",",.21),$P(RESULTS(2),U,2)=$$GET1^DIQ(53.79,PSBIEN_",",.22)
"RTN","PSBMLLKU",123,0)
 .; Determine if there are any active IVs/Patchs per order
"RTN","PSBMLLKU",124,0)
 .D:$G(PSBPTCHX)
"RTN","PSBMLLKU",125,0)
 ..S PSBX="",PSBX="^PSB(53.79,""APATCH"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",126,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",127,0)
 ...S PSBXX=$QS(PSBX,5),PSBXXX=$S(($P(^PSB(53.79,PSBXX,0),U,9)="G")&(PSBXX'=PSBIEN):1,1:0)
"RTN","PSBMLLKU",128,0)
 ...I PSBXXX&($P(^PSB(53.79,PSBXX,.1),U)=$P(RESULTS(1),U,15)) S $P(RESULTS(1),U,16)=1
"RTN","PSBMLLKU",129,0)
 .D:$G(PSBXIV)
"RTN","PSBMLLKU",130,0)
 ..S PSBX="",PSBX="^PSB(53.79,""AUID"","_$P(RESULTS(1),U,2)_")"
"RTN","PSBMLLKU",131,0)
 ..F  S PSBX=$Q(@PSBX) Q:PSBX=""  Q:$QS(PSBX,3)'=$P(RESULTS(1),U,2)  Q:$QS(PSBX,4)>$P(RESULTS(1),U,15)  D  Q:$P(RESULTS(1),U,16)
"RTN","PSBMLLKU",132,0)
 ...Q:$QS(PSBX,4)'=$P(RESULTS(1),U,15)
"RTN","PSBMLLKU",133,0)
 ...S PSBXX=$QS(PSBX,6) S:(PSBXX'=PSBIEN) $P(RESULTS(1),U,16)=$S($P(^PSB(53.79,PSBXX,0),U,9)="I":1,$P(^PSB(53.79,PSBXX,0),U,9)="S":1,1:0)
"RTN","PSBMLLKU",134,0)
 .;
"RTN","PSBMLLKU",135,0)
 .; LOOP - Place DD in RESULTS
"RTN","PSBMLLKU",136,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.5,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",137,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",138,0)
 ..S RESULTS(PSBCNT)="DD^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_"^"_$$GET1^DIQ(50,$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",139,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.5,PSBX,0),U,4)
"RTN","PSBMLLKU",140,0)
 ..S:$P(RESULTS(PSBCNT),U,4)?1"."1.N $P(RESULTS(PSBCNT),U,4)=0_+$P(RESULTS(PSBCNT),U,4)
"RTN","PSBMLLKU",141,0)
 ..S:$P(RESULTS(PSBCNT),U,5)?1"."1.N $P(RESULTS(PSBCNT),U,5)=0_+$P(RESULTS(PSBCNT),U,5)
"RTN","PSBMLLKU",142,0)
 .; LOOP - Place ADD in RESULTS
"RTN","PSBMLLKU",143,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.6,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",144,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",145,0)
 ..S RESULTS(PSBCNT)="ADD^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_"^"_$$GET1^DIQ(52.6,$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",146,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.6,PSBX,0),U,4)
"RTN","PSBMLLKU",147,0)
 .; LOOP - Place SOL in RESULTS
"RTN","PSBMLLKU",148,0)
 .S PSBX=0 F  S PSBX=$O(^PSB(53.79,PSBIEN,.7,PSBX)) Q:'(+PSBX)  D
"RTN","PSBMLLKU",149,0)
 ..S PSBCNT=PSBCNT+1
"RTN","PSBMLLKU",150,0)
 ..S RESULTS(PSBCNT)="SOL^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_"^"_$$GET1^DIQ(52.7,$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U)_",",.01)
"RTN","PSBMLLKU",151,0)
 ..S $P(RESULTS(PSBCNT),U,4)=$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,2)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,3)_"^"_$P(^PSB(53.79,PSBIEN,.7,PSBX,0),U,4)
"RTN","PSBMLLKU",152,0)
 .L -^PSB(53.79,PSBIEN)
"RTN","PSBMLLKU",153,0)
 S:PSBCNT>0 RESULTS(0)=PSBCNT
"RTN","PSBMLLKU",154,0)
 Q
"RTN","PSBMLLKU",155,0)
 ;
"RTN","PSBMLLKU",156,0)
SELSTTUS(RESULTS) ;
"RTN","PSBMLLKU",157,0)
 ; Provide the SELectable STaTUS
"RTN","PSBMLLKU",158,0)
 ;
"RTN","PSBMLLKU",159,0)
 ; Get TAB, ScheduleType, Current Status, provide Selectable Staus(s) in ^8
"RTN","PSBMLLKU",160,0)
 N PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBMROUT,PSBXTAB
"RTN","PSBMLLKU",161,0)
 K ^TMP("PSJ1",$J) D EN^PSJBCMA1($$GET1^DIQ(53.79,PSBIEN_",",.01,"I"),$$GET1^DIQ(53.79,PSBIEN_",",.11),1)
"RTN","PSBMLLKU",162,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",163,0)
 .S PSBORTYP=$TR($P(^TMP("PSJ1",$J,0),U,3),"1234567890"),PSBIVTYP=$P(^TMP("PSJ1",$J,0),U,6)
"RTN","PSBMLLKU",164,0)
 .S PSBINTSY=$P(^TMP("PSJ1",$J,0),U,7),PSBCHMTY=$P(^TMP("PSJ1",$J,0),U,8),PSBMROUT=$P(^TMP("PSJ1",$J,1),U,4)
"RTN","PSBMLLKU",165,0)
 .S:$$IVPTAB^PSBVDLU3(PSBORTYP,PSBIVTYP,PSBINTSY,PSBCHMTY,PSBMROUT) PSBXTAB="PB"
"RTN","PSBMLLKU",166,0)
 .D:'$D(PSBXTAB)
"RTN","PSBMLLKU",167,0)
 ..I PSBORTYP="U" S PSBXTAB="UD"
"RTN","PSBMLLKU",168,0)
 ..I PSBORTYP="V" S PSBXTAB="IV"
"RTN","PSBMLLKU",169,0)
 ; Set Results(1) and other flags...
"RTN","PSBMLLKU",170,0)
 I ^TMP("PSJ1",$J,0)>0 D
"RTN","PSBMLLKU",171,0)
 .S $P(RESULTS(1),U,13)=$P(^TMP("PSJ1",$J,4),U)
"RTN","PSBMLLKU",172,0)
 .S $P(RESULTS(1),U,14)=$P(^TMP("PSJ1",$J,1),U,10)
"RTN","PSBMLLKU",173,0)
 .S $P(RESULTS(1),U,15)=$P(^TMP("PSJ1",$J,0),U,3)
"RTN","PSBMLLKU",174,0)
 .I (PSBXTAB="UD"),($P(^TMP("PSJ1",$J,2),U,6)="PATCH") S PSBPTCHX=1
"RTN","PSBMLLKU",175,0)
 .I PSBXTAB="IV" S PSBXIV=1
"RTN","PSBMLLKU",176,0)
 .S:$G(PSBXTAB)]"" $P(RESULTS(1),U,11)=$G(PSBXTAB)
"RTN","PSBMLLKU",177,0)
 K ^TMP("PSJ1",$J)
"RTN","PSBMLLKU",178,0)
 Q
"RTN","PSBMLLKU",179,0)
 ;
"RTN","PSBMLLKU",180,0)
KILLAADT ;
"RTN","PSBMLLKU",181,0)
 ;   Here because there is an errorant index entry via version 1.0/2.0
"RTN","PSBMLLKU",182,0)
 ;   Cleansing!
"RTN","PSBMLLKU",183,0)
 ;
"RTN","PSBMLLKU",184,0)
 K ^PSB(53.79,"AADT",DFN,PSBSRCH,PSBIEN)
"RTN","PSBMLLKU",185,0)
 Q
"RTN","PSBMLLKU",186,0)
 ;
"RTN","PSBOMH2")
0^2^B28071612
"RTN","PSBOMH2",1,0)
PSBOMH2 ;BIRMINGHAM/EFC-MAH ;Mar 2004
"RTN","PSBOMH2",2,0)
 ;;3.0;BAR CODE MED ADMIN;**6,20**;Mar 2004
"RTN","PSBOMH2",3,0)
 ;
"RTN","PSBOMH2",4,0)
 ; Reference/IA
"RTN","PSBOMH2",5,0)
 ; EN^PSJBCMA/2828
"RTN","PSBOMH2",6,0)
 ;
"RTN","PSBOMH2",7,0)
EN ;
"RTN","PSBOMH2",8,0)
 ; Okay, let's print this puppy
"RTN","PSBOMH2",9,0)
 S PSBWEEK=0
"RTN","PSBOMH2",10,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",11,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT","C"))
"RTN","PSBOMH2",12,0)
 ..D CONT
"RTN","PSBOMH2",13,0)
 ;
"RTN","PSBOMH2",14,0)
 ; Now the PRN/One Time/On-Call Sheets
"RTN","PSBOMH2",15,0)
 S PSBWEEK=0
"RTN","PSBOMH2",16,0)
 F  S PSBWEEK=$O(^TMP("PSB",$J,PSBWEEK)) Q:'PSBWEEK  D
"RTN","PSBOMH2",17,0)
 .D:$D(^TMP("PSB",$J,PSBWEEK,"SORT","P"))
"RTN","PSBOMH2",18,0)
 ..D PRN
"RTN","PSBOMH2",19,0)
 ;
"RTN","PSBOMH2",20,0)
 D LEGEND
"RTN","PSBOMH2",21,0)
 Q
"RTN","PSBOMH2",22,0)
CONT ;
"RTN","PSBOMH2",23,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",24,0)
 W $$HDR()
"RTN","PSBOMH2",25,0)
 S PSBDRUG=""
"RTN","PSBOMH2",26,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT","C",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",27,0)
 .S PSBORD=""
"RTN","PSBOMH2",28,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT","C",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",29,0)
 ..;S X="",PSBNAF=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,X)) Q:X=""  I ^TMP("PSB",$J,PSBWEEK,PSBORD,X,0)'=0 S PSBNAF=1  ; check for data
"RTN","PSBOMH2",30,0)
 ..;D CLEAN^PSBVT,PSJ1^PSBVT(DFN,PSBORD)
"RTN","PSBOMH2",31,0)
 ..;S X=PSBOST D H^%DTC S PSBOSTH=%H
"RTN","PSBOMH2",32,0)
 ..;S X=PSBOSP D H^%DTC S PSBOSPH=%H
"RTN","PSBOMH2",33,0)
 ..;I PSBNAF=0 Q
"RTN","PSBOMH2",34,0)
 ..;I PSBNAF=0,$G(PSBAR(PSBOSTH))'=PSBWEEK,$G(PSBAR(PSBOSPH))'=PSBWEEK Q  ; no data for this week and neither start or stop date is this week
"RTN","PSBOMH2",35,0)
 ..S PSBCNT=8
"RTN","PSBOMH2",36,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",37,0)
 ..S:$O(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",""),-1)>PSBCNT PSBCNT=$O(^(""),-1)
"RTN","PSBOMH2",38,0)
 ..;W:$Y>(IOSL-PSBCNT-4) $$HDR()
"RTN","PSBOMH2",39,0)
 ..;W:$Y>(IOSL-8) $$HDR()
"RTN","PSBOMH2",40,0)
 ..F PSBLINE=1:1:PSBCNT D
"RTN","PSBOMH2",41,0)
 ...I $Y>(IOSL-10) N I D
"RTN","PSBOMH2",42,0)
 ....W !?(IOM-35\2),"*** CONTINUED ON NEXT PAGE ***"
"RTN","PSBOMH2",43,0)
 ....W $$HDR()
"RTN","PSBOMH2",44,0)
 ....W !?(IOM-35\2),"*** CONTINUED FROM PREVIOUS PAGE ***"
"RTN","PSBOMH2",45,0)
 ....F I=1:1:6 W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",I))
"RTN","PSBOMH2",46,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",47,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,"ORDERS",PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",48,0)
 ...S PSBDAY=0,PSBCOL=0
"RTN","PSBOMH2",49,0)
 ...F  S PSBDAY=$O(^TMP("PSB",$J,PSBWEEK,"HDR",PSBDAY)) Q:'PSBDAY  D
"RTN","PSBOMH2",50,0)
 ....W ?(40+(PSBCOL*13)),"| "
"RTN","PSBOMH2",51,0)
 ....S Y=$G(^TMP("PSB",$J,PSBWEEK,PSBORD,PSBDAY,PSBLINE))
"RTN","PSBOMH2",52,0)
 ....W $P(Y,U,3)
"RTN","PSBOMH2",53,0)
 ....W $E($P($P(Y,U,1)_"0000",".",2),1,4)," "
"RTN","PSBOMH2",54,0)
 ....W $P(Y,U,2)
"RTN","PSBOMH2",55,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)),(PSBLINE=PSBCNT) W "HOLD"  ;output hold status
"RTN","PSBOMH2",56,0)
 ....I '$D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY))&'$D(^TMP("PSB",$J,"ORDERS",PSBORD,"HOLD",PSBDAY)) D
"RTN","PSBOMH2",57,0)
 .....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"NTDUE",PSBDAY)),(PSBLINE=PSBCNT) W "***"  ;write *** when day no due
"RTN","PSBOMH2",58,0)
 ....I $D(^TMP("PSB",$J,"ORDERS",PSBORD,"DISC",PSBDAY)),(PSBLINE=PSBCNT) W "***"   ;output discontinued status
"RTN","PSBOMH2",59,0)
 ....S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",60,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",61,0)
 Q
"RTN","PSBOMH2",62,0)
 ;
"RTN","PSBOMH2",63,0)
PRN ;
"RTN","PSBOMH2",64,0)
 S PSBHDR(1)="Continuing/PRN/Stat/One Time Medication/Treatment Record (VAF 10-2970 B, C, D)"
"RTN","PSBOMH2",65,0)
 W $$HDR(1)
"RTN","PSBOMH2",66,0)
 S PSBDRUG=""
"RTN","PSBOMH2",67,0)
 F  S PSBDRUG=$O(^TMP("PSB",$J,PSBWEEK,"SORT","P",PSBDRUG)) Q:PSBDRUG=""  D
"RTN","PSBOMH2",68,0)
 .S PSBORD=""
"RTN","PSBOMH2",69,0)
 .F  S PSBORD=$O(^TMP("PSB",$J,PSBWEEK,"SORT","P",PSBDRUG,PSBORD)) Q:'PSBORD  D
"RTN","PSBOMH2",70,0)
 ..S PSBCNT=$O(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",""),-1)
"RTN","PSBOMH2",71,0)
 ..D:PSBCNT<$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",72,0)
 ...S PSBCNT=$O(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",""),-1)
"RTN","PSBOMH2",73,0)
 ..S:PSBCNT<8 PSBCNT=8  ; Minimum space for order
"RTN","PSBOMH2",74,0)
 ..W:$Y>(IOSL-PSBCNT-4) $$HDR(1)
"RTN","PSBOMH2",75,0)
 ..F PSBLINE=1:1:PSBCNT D
"RTN","PSBOMH2",76,0)
 ...W !,$G(^TMP("PSB",$J,"ORDERS",PSBORD,"INST",PSBLINE))
"RTN","PSBOMH2",77,0)
 ...W ?32,"| ",$G(^TMP("PSB",$J,PSBWEEK,PSBORD,"AT",PSBLINE))
"RTN","PSBOMH2",78,0)
 ..W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",79,0)
 Q
"RTN","PSBOMH2",80,0)
 ;
"RTN","PSBOMH2",81,0)
LEGEND  ;
"RTN","PSBOMH2",82,0)
 ;print the initials - name legend as an extra page  ;
"RTN","PSBOMH2",83,0)
 ;I '$D(^TMP("PSB",$J,"LEGEND")) K ^TMP("PSJ",$J),^TMP("PSB",$J) Q  ;
"RTN","PSBOMH2",84,0)
 D PT^PSBOHDR(DFN,.PSBHDR)  ;
"RTN","PSBOMH2",85,0)
 W !!,"Initial - Name Legend",!  ;
"RTN","PSBOMH2",86,0)
 I $D(^TMP("PSB",$J,"LEGEND"))  D
"RTN","PSBOMH2",87,0)
 .S X=$Q(^TMP("PSB",$J,"LEGEND",""))
"RTN","PSBOMH2",88,0)
 .F  W $S($QS(X,4)[99:"",1:$QS(X,4)),?10,$QS(X,5),! S X=$Q(@X) Q:$QS(X,3)'="LEGEND"  ;
"RTN","PSBOMH2",89,0)
 W !!,"Status Codes",!,"C - Completed",!,"G - Given",!,"H - Held",!,"I - Infusing",!,"M - Missing Dose Requested",!,"R - Refused",!,"RM - Removed",!,"S - Stopped",!,"*** - Medication Not Due",!  ;
"RTN","PSBOMH2",90,0)
 K ^TMP("PSJ",$J),^TMP("PSB",$J)
"RTN","PSBOMH2",91,0)
 Q
"RTN","PSBOMH2",92,0)
 ;
"RTN","PSBOMH2",93,0)
HDR(PRN)   ;
"RTN","PSBOMH2",94,0)
 ; PRN = TRUE IF DISPLAYING PRN MED (OPTIONAL)
"RTN","PSBOMH2",95,0)
 D PT^PSBOHDR(DFN,.PSBHDR)
"RTN","PSBOMH2",96,0)
 W !,"Start Date",?20,"Stop Date",?32,"| ",$S('$G(PRN):"Admin",1:"Action Status")
"RTN","PSBOMH2",97,0)
 I '$G(PRN) F X=0:1:6 W ?(40+(X*13)),"|"
"RTN","PSBOMH2",98,0)
 W !,"and Time",?20,"and Time",?32,"| ",$S('$G(PRN):"Times",1:"Action Date/Times")
"RTN","PSBOMH2",99,0)
 D:'$G(PRN)
"RTN","PSBOMH2",100,0)
 .S PSBCOL=0,X=0 F  S X=$O(^TMP("PSB",$J,PSBWEEK,"HDR",X)) Q:'X  D
"RTN","PSBOMH2",101,0)
 ..W ?(40+(PSBCOL*13)),"| ",$E(X,4,5),"/",$E(X,6,7),"/",(1700+$E(X,1,3))
"RTN","PSBOMH2",102,0)
 ..S PSBCOL=PSBCOL+1
"RTN","PSBOMH2",103,0)
 D:$G(PRN)
"RTN","PSBOMH2",104,0)
 .W ?76,"PRN Reason"
"RTN","PSBOMH2",105,0)
 W !,$TR($J("",IOM)," ","-")
"RTN","PSBOMH2",106,0)
 Q ""
"RTN","PSBOMH2",107,0)
 ;
"RTN","PSBOMH2",108,0)
PSBCK1(PSBCHK) ;                   
"RTN","PSBOMH2",109,0)
 I PSBCHK="A" D
"RTN","PSBOMH2",110,0)
 .S TEST=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",111,0)
 .D PSBOUT^PSBOMH1(TEST,PSBINIT)
"RTN","PSBOMH2",112,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_"G"_U_PSBIEN
"RTN","PSBOMH2",113,0)
 I PSBCHK="B" D
"RTN","PSBOMH2",114,0)
 .S TESTB=$P(^PSB(53.79,PSBIEN,0),U,6)
"RTN","PSBOMH2",115,0)
 .D PSBOUT^PSBOMH1(TESTB,PSBINIT)
"RTN","PSBOMH2",116,0)
 .S X=$P(^PSB(53.79,PSBIEN,0),U,6)_U_PSBINIT_U_$P(^(0),U,9)_U_PSBIEN
"RTN","PSBOMH2",117,0)
 S PSBCHK=""
"RTN","PSBOMH2",118,0)
 Q
"RTN","PSBOMH2",119,0)
 ;
"RTN","PSBOMH2",120,0)
PSBENT(PSBTIS) ;
"RTN","PSBOMH2",121,0)
 S PSBNAME="",PSBNAME=$$GET1^DIQ(53.79,PSBIEN_",","ACTION BY:NAME")
"RTN","PSBOMH2",122,0)
 S ^TMP("PSB",$J,"LEGEND",PSBTIS,PSBNAME)=""
"RTN","PSBOMH2",123,0)
 Q
"RTN","PSBOMH2",124,0)
 ;
"VER")
8.0^22.0
"BLD",6305,6)
^15
**END**
**END**
