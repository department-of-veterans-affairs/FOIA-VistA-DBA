Released RA*5*75 SEQ #69
Extracted from mail message
**KIDS**:RA*5.0*75^

**INSTALL NAME**
RA*5.0*75
"BLD",6203,0)
RA*5.0*75^RADIOLOGY/NUCLEAR MEDICINE^0^3070404^y
"BLD",6203,1,0)
^^3^3^3060705^^
"BLD",6203,1,1,0)
Patch seventy-five for the Radiology/Nuclear Medicine 5.0 software.  
"BLD",6203,1,2,0)
Please review the Description and Installation Instructions for RA*5.0*75
"BLD",6203,1,3,0)
before installing this patch.
"BLD",6203,4,0)
^9.64PA^75.1^1
"BLD",6203,4,75.1,0)
75.1
"BLD",6203,4,75.1,2,0)
^9.641^75.1^1
"BLD",6203,4,75.1,2,75.1,0)
RAD/NUC MED ORDERS  (File-top level)
"BLD",6203,4,75.1,2,75.1,1,0)
^9.6411^1.1^1
"BLD",6203,4,75.1,2,75.1,1,1.1,0)
REASON FOR STUDY
"BLD",6203,4,75.1,222)
y^n^p^^^^n^^n
"BLD",6203,4,75.1,224)

"BLD",6203,4,"APDD",75.1,75.1)

"BLD",6203,4,"APDD",75.1,75.1,1.1)

"BLD",6203,4,"B",75.1,75.1)

"BLD",6203,6.3)
4
"BLD",6203,"INI")

"BLD",6203,"INIT")
EN^RA75PST
"BLD",6203,"KRN",0)
^9.67PA^8989.52^19
"BLD",6203,"KRN",.4,0)
.4
"BLD",6203,"KRN",.401,0)
.401
"BLD",6203,"KRN",.402,0)
.402
"BLD",6203,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",6203,"KRN",.402,"NM",1,0)
RA ORDER EXAM    FILE #75.1^75.1^0
"BLD",6203,"KRN",.402,"NM",2,0)
RA QUICK EXAM ORDER    FILE #75.1^75.1^0
"BLD",6203,"KRN",.402,"NM","B","RA ORDER EXAM    FILE #75.1",1)

"BLD",6203,"KRN",.402,"NM","B","RA QUICK EXAM ORDER    FILE #75.1",2)

"BLD",6203,"KRN",.403,0)
.403
"BLD",6203,"KRN",.5,0)
.5
"BLD",6203,"KRN",.84,0)
.84
"BLD",6203,"KRN",3.6,0)
3.6
"BLD",6203,"KRN",3.6,"NM",0)
^9.68A^2^2
"BLD",6203,"KRN",3.6,"NM",1,0)
RAD/NUC MED REQUEST CANCELLED^^0
"BLD",6203,"KRN",3.6,"NM",2,0)
RAD/NUC MED REQUEST HELD^^0
"BLD",6203,"KRN",3.6,"NM","B","RAD/NUC MED REQUEST CANCELLED",1)

"BLD",6203,"KRN",3.6,"NM","B","RAD/NUC MED REQUEST HELD",2)

"BLD",6203,"KRN",3.8,0)
3.8
"BLD",6203,"KRN",9.2,0)
9.2
"BLD",6203,"KRN",9.8,0)
9.8
"BLD",6203,"KRN",9.8,"NM",0)
^9.68A^24^22
"BLD",6203,"KRN",9.8,"NM",1,0)
RAORD1^^0^B48840656
"BLD",6203,"KRN",9.8,"NM",2,0)
RAORDU1^^0^B32546485
"BLD",6203,"KRN",9.8,"NM",3,0)
RAUTL5^^0^B39178869
"BLD",6203,"KRN",9.8,"NM",5,0)
RA75PST^^0^B5639049
"BLD",6203,"KRN",9.8,"NM",6,0)
RAORD5^^0^B27804066
"BLD",6203,"KRN",9.8,"NM",7,0)
RAORD6^^0^B47839640
"BLD",6203,"KRN",9.8,"NM",8,0)
RAORD2^^0^B44295727
"BLD",6203,"KRN",9.8,"NM",9,0)
RAORD3^^0^B24685743
"BLD",6203,"KRN",9.8,"NM",10,0)
RARTR3^^0^B24116267
"BLD",6203,"KRN",9.8,"NM",11,0)
RART3^^0^B23818641
"BLD",6203,"KRN",9.8,"NM",12,0)
RAO7RON1^^0^B28343551
"BLD",6203,"KRN",9.8,"NM",13,0)
RAO7RO1^^0^B7990676
"BLD",6203,"KRN",9.8,"NM",14,0)
RAO7NEW^^0^B43134846
"BLD",6203,"KRN",9.8,"NM",15,0)
RABUL^^0^B5625174
"BLD",6203,"KRN",9.8,"NM",16,0)
RAHLR^^0^B47516973
"BLD",6203,"KRN",9.8,"NM",17,0)
RAO7PC1^^0^B26248522
"BLD",6203,"KRN",9.8,"NM",18,0)
RAO7PC2^^0^B44787869
"BLD",6203,"KRN",9.8,"NM",19,0)
RAUTL12^^0^B13921156
"BLD",6203,"KRN",9.8,"NM",20,0)
RARTR^^0^B56338116
"BLD",6203,"KRN",9.8,"NM",22,0)
RAO7VLD^^0^B2388912
"BLD",6203,"KRN",9.8,"NM",23,0)
RAO7RO^^0^B38944723
"BLD",6203,"KRN",9.8,"NM",24,0)
RAO7RON^^0^B14011011
"BLD",6203,"KRN",9.8,"NM","B","RA75PST",5)

"BLD",6203,"KRN",9.8,"NM","B","RABUL",15)

"BLD",6203,"KRN",9.8,"NM","B","RAHLR",16)

"BLD",6203,"KRN",9.8,"NM","B","RAO7NEW",14)

"BLD",6203,"KRN",9.8,"NM","B","RAO7PC1",17)

"BLD",6203,"KRN",9.8,"NM","B","RAO7PC2",18)

"BLD",6203,"KRN",9.8,"NM","B","RAO7RO",23)

"BLD",6203,"KRN",9.8,"NM","B","RAO7RO1",13)

"BLD",6203,"KRN",9.8,"NM","B","RAO7RON",24)

"BLD",6203,"KRN",9.8,"NM","B","RAO7RON1",12)

"BLD",6203,"KRN",9.8,"NM","B","RAO7VLD",22)

"BLD",6203,"KRN",9.8,"NM","B","RAORD1",1)

"BLD",6203,"KRN",9.8,"NM","B","RAORD2",8)

"BLD",6203,"KRN",9.8,"NM","B","RAORD3",9)

"BLD",6203,"KRN",9.8,"NM","B","RAORD5",6)

"BLD",6203,"KRN",9.8,"NM","B","RAORD6",7)

"BLD",6203,"KRN",9.8,"NM","B","RAORDU1",2)

"BLD",6203,"KRN",9.8,"NM","B","RART3",11)

"BLD",6203,"KRN",9.8,"NM","B","RARTR",20)

"BLD",6203,"KRN",9.8,"NM","B","RARTR3",10)

"BLD",6203,"KRN",9.8,"NM","B","RAUTL12",19)

"BLD",6203,"KRN",9.8,"NM","B","RAUTL5",3)

"BLD",6203,"KRN",19,0)
19
"BLD",6203,"KRN",19,"NM",0)
^9.68A^^
"BLD",6203,"KRN",19.1,0)
19.1
"BLD",6203,"KRN",101,0)
101
"BLD",6203,"KRN",409.61,0)
409.61
"BLD",6203,"KRN",771,0)
771
"BLD",6203,"KRN",870,0)
870
"BLD",6203,"KRN",8989.51,0)
8989.51
"BLD",6203,"KRN",8989.52,0)
8989.52
"BLD",6203,"KRN",8994,0)
8994
"BLD",6203,"KRN","B",.4,.4)

"BLD",6203,"KRN","B",.401,.401)

"BLD",6203,"KRN","B",.402,.402)

"BLD",6203,"KRN","B",.403,.403)

"BLD",6203,"KRN","B",.5,.5)

"BLD",6203,"KRN","B",.84,.84)

"BLD",6203,"KRN","B",3.6,3.6)

"BLD",6203,"KRN","B",3.8,3.8)

"BLD",6203,"KRN","B",9.2,9.2)

"BLD",6203,"KRN","B",9.8,9.8)

"BLD",6203,"KRN","B",19,19)

"BLD",6203,"KRN","B",19.1,19.1)

"BLD",6203,"KRN","B",101,101)

"BLD",6203,"KRN","B",409.61,409.61)

"BLD",6203,"KRN","B",771,771)

"BLD",6203,"KRN","B",870,870)

"BLD",6203,"KRN","B",8989.51,8989.51)

"BLD",6203,"KRN","B",8989.52,8989.52)

"BLD",6203,"KRN","B",8994,8994)

"BLD",6203,"PRE")

"BLD",6203,"QUES",0)
^9.62^^
"BLD",6203,"REQB",0)
^9.611^8^8
"BLD",6203,"REQB",1,0)
RA*5.0*31^2
"BLD",6203,"REQB",2,0)
RA*5.0*35^2
"BLD",6203,"REQB",3,0)
RA*5.0*36^2
"BLD",6203,"REQB",4,0)
RA*5.0*41^2
"BLD",6203,"REQB",5,0)
RA*5.0*51^2
"BLD",6203,"REQB",6,0)
RA*5.0*55^2
"BLD",6203,"REQB",7,0)
RA*5.0*69^2
"BLD",6203,"REQB",8,0)
RA*5.0*82^2
"BLD",6203,"REQB","B","RA*5.0*31",1)

"BLD",6203,"REQB","B","RA*5.0*35",2)

"BLD",6203,"REQB","B","RA*5.0*36",3)

"BLD",6203,"REQB","B","RA*5.0*41",4)

"BLD",6203,"REQB","B","RA*5.0*51",5)

"BLD",6203,"REQB","B","RA*5.0*55",6)

"BLD",6203,"REQB","B","RA*5.0*69",7)

"BLD",6203,"REQB","B","RA*5.0*82",8)

"FIA",75.1)
RAD/NUC MED ORDERS
"FIA",75.1,0)
^RAO(75.1,
"FIA",75.1,0,0)
75.1PI
"FIA",75.1,0,1)
y^n^p^^^^n^^n
"FIA",75.1,0,10)

"FIA",75.1,0,11)

"FIA",75.1,0,"RLRO")

"FIA",75.1,0,"VR")
5.0^RA
"FIA",75.1,75.1)
1
"FIA",75.1,75.1,1.1)

"INIT")
EN^RA75PST
"KRN",.402,244,-1)
0^1
"KRN",.402,244,0)
RA ORDER EXAM^3061018.1012^^75.1^^^3070402
"KRN",.402,244,"%D",0)
^.4021^1^1^3070206^^^
"KRN",.402,244,"%D",1,0)
This template is used to request an imaging exam.
"KRN",.402,244,"DIAB",1,1,75.1125,0)
ALL
"KRN",.402,244,"DIAB",2,0,75.1,0)
2//^S X=$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),U),1:"");REQ
"KRN",.402,244,"DIAB",2,0,75.1,13)
12//^S X="TODAY";T
"KRN",.402,244,"DIAB",3,0,75.1,2)
8;REQ
"KRN",.402,244,"DIAB",3,0,75.1,18)
24//^S X="NO";T
"KRN",.402,244,"DIAB",4,0,75.1,10)
9.5//^S X=$S($D(RARSH):RARSH,1:"");REQ
"KRN",.402,244,"DIAB",7,0,75.1,10)
9//^S X=$S($D(RASHA):RASHA,1:"");REQ
"KRN",.402,244,"DIAB",7,0,75.1,19)
20;"SUBMIT REQUEST TO";REQ
"KRN",.402,244,"DIAB",9,0,75.1,16)
21;REQ
"KRN",.402,244,"DR",1,75.1)
I '$D(RACAT)!('$D(RADFN))!('$D(RADIV))!('$D(RALIFN))!('$D(RAPIFN)) W !?3,$C(7),"Variables RACAT,RADFN,RADIV,RALIFN and RAPIFN must be defined!" S Y="@999";2R~//^S X=$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),U),1:"");S RAPRI=X;
"KRN",.402,244,"DR",1,75.1,1)
S RAIMAG=$$ITYPE^RASITE(+RAPRI);S Y=$S('$D(^RA(79,+RADIV,.1)):"@2",$P(^(.1),"^",7)="Y"&($P(^RAMIS(71,RAPRI,0),"^",6)="B"):"@1",1:"@2");@1;W !?3,$C(7),"A 'detailed' procedure or a 'series' of procedures is required!" S Y="";@2;
"KRN",.402,244,"DR",1,75.1,2)
I $O(^RAMIS(71,RAPRI,3,0)) D EN2^RAPRI;I $P(^RAMIS(71,RAPRI,0),"^",11)'="y" S Y="@3";8R~;@3;I '$D(RAMOD) S Y="@7";S RAI="";@5;S RAI=$O(RAMOD(0)) I 'RAI S Y="@7";S RAMODPRO=+$O(^RAMIS(71.2,"B",$G(RAMOD(RAI)),0));
"KRN",.402,244,"DR",1,75.1,3)
S:'$D(^RAMIS(71.2,"AB",+$$ITYPE^RASITE(RAPRI),RAMODPRO)) Y="@8";125///^S X=RAMOD(RAI);@8;K RAMOD(RAI) S Y="@5";@7;125;@9;3////^S X=$P(RAIMAG,U);S RACOMENT="reason for study (RAREAST) is required with patch 75" K RACOMENT;
"KRN",.402,244,"DR",1,75.1,4)
1.1//^S X=RAREAST;S RACOMENT="Clinical History is not longer required with patch 75." K RACOMENT;I $D(^RA(79,+RADIV,"HIS")) W !!?3,$C(7),^("HIS"),!;
"KRN",.402,244,"DR",1,75.1,5)
I $O(^TMP($J,"RAWP",0)) S ^RAO(75.1,DA,"H",0)=^(0) F RAI=1:1 Q:'$D(^TMP($J,"RAWP",RAI,0))  S ^RAO(75.1,DA,"H",RAI,0)=^(0);@10;400;I $D(DIRUT) S Y="@999";S:+$O(^RAO(75.1,DA,"H",0))=0 Y="@15";
"KRN",.402,244,"DR",1,75.1,6)
S RAWPFLAG=$$VALWP^RAUTL5("^RAO(75.1,"_DA_",""H"",");I 'RAWPFLAG W !!?3,$C(7),"Text must be at least two (2) alphanumeric characters in length.",! S Y="@10";
"KRN",.402,244,"DR",1,75.1,7)
I $P($G(^RAO(75.1,DA,"H",0)),U,3)>350 W ?3,$C(7),"Clinical History cannot exceed 350 lines!" S Y="@10";I $O(^RAO(75.1,DA,"H",0)) D UPDT^RAUTL3("^RAO(75.1,"_DA_",""H"",");@15;14////^S X=RAPIFN;@20;4//^S X=RACAT;
"KRN",.402,244,"DR",1,75.1,8)
S RAX=$E(X,1),Y=$S(RAX="R":"@30","CS"[RAX:"@40",RAX="I"&($D(RAWARD))!("EO"[RAX&('$D(RAWARD))):"@50",1:"@25");@25;I $D(RAWARD) W !?3,$C(7),"Please choose 'I' for INPATIENT, 'R' RESEARCH, 'C' CONTRACT,",!?3,"'S' SHARING!";
"KRN",.402,244,"DR",1,75.1,9)
I '$D(RAWARD) W !?3,$C(7),"Please choose 'O' for OUTPATIENT, 'E' EMPLOYEE, 'R' RESEARCH,",!?3,"'C' CONTRACT, 'S' SHARING!";D CS^RAORD1A I $D(RALIFN("OUT")) S Y="@26";I '$D(RALIFN("NO")) S Y="@50";K RALIFN("NO");@26;4///@;
"KRN",.402,244,"DR",1,75.1,10)
K RALIFN("OUT");S Y="@20";@30;9.5R~//^S X=$S($D(RARSH):RARSH,1:"");S Y="@50";@40;9R~//^S X=$S($D(RASHA):RASHA,1:"");@50;
"KRN",.402,244,"DR",1,75.1,11)
I RAX="I",($P($G(^SC(+RALIFN,0)),U,3)'="W"),($P($G(^SC(+RALIFN,0)),U,3)'="OR") S RAWHEN=$P($G(^RAO(75.1,DA,0)),U,21),RAWHEN=$S(RAWHEN]"":$P(RAWHEN,".",1),1:DT) D REQLOC1^RAORD1A;
"KRN",.402,244,"DR",1,75.1,12)
I RAX="O",($P($G(^SC(+RALIFN,0)),U,3)'="C"),($P($G(^SC(+RALIFN,0)),U,3)'="OR") D REQLOC1^RAORD1A;I $D(RALIFN("OUT")) K RALIFN("OUT") S Y="@999";22////^S X=RALIFN;@100;
"KRN",.402,244,"DR",1,75.1,13)
W !,"IS PATIENT SCHEDULED FOR PRE-OP" S %=2 D YN^DICN S:%<0 Y="@999" S:%=2 Y="@120" I '% W !!,"Enter 'YES' if patient is scheduled for pre-op, or 'NO' if not.",! S Y="@100";12T~//^S X="TODAY";S:$D(RAEXMUL) RAPREOP1=X;@120;
"KRN",.402,244,"DR",1,75.1,14)
I RASEX="M" S Y="@130";
"KRN",.402,244,"DR",1,75.1,15)
I RASEX'="F" W !,"THE SEX OF THIS PATIENT IS NOT AVAILABLE. IS PATIENT FEMALE" S %=2 D YN^DICN S:%<0 Y="@999" S:%=2 Y="@130" I '% W !!,"Enter 'YES' if patient is female, or 'NO' if patient is male.",! S Y="@120";S RASEX="F";
"KRN",.402,244,"DR",1,75.1,16)
13//^S X=$S($D(RAPREG):$$EXTERNAL^DILFD(75.1,13,"",RAPREG),1:"");S RAPREG=X;@130;I '$D(RAVSTFLG)!('$D(RAVLEDTI)) S Y="@135";17///^S X=9999999.9999-RAVLEDTI;@135;@140;S:$D(RAWHEN)#2 Y="@145";21R~;S Y="@150";@145;21//^S X=RAWHEN;
"KRN",.402,244,"DR",1,75.1,17)
@150;S:$D(RAEXMUL)#2 RAWHEN=$$FMTE^XLFDT(X,1);5////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);18///^S X="NOW";S Y=$S('$D(^RA(79,+RADIV,.1)):"@160",$P(^(.1),"^",19)="y":"@155",1:"@160");@155;75///^S X="""NOW""";@160;
"KRN",.402,244,"DR",1,75.1,18)
19//^S X=$S($D(RAMT):$P(RAMT,"^",2),1:"AMBULATORY");S:$D(RAEXMUL) RAMT=X;24T~//^S X="NO";S:$D(RAEXMUL) RAIP=X;6//^S X="ROUTINE";S:$D(RAEXMUL) RARU=X;S:$$ORVR^RAORDU()<3 Y="@163";26//^S X="SERVICE CORRECTION";@163;W !;
"KRN",.402,244,"DR",1,75.1,19)
S RAREQLOC=$$ILOC^RAUTL18(RAPRI);I 'RAREQLOC S Y="@165";20////^S X=RAREQLOC;S Y="@170";@165;I '$D(RALOCFLG) S Y="@175";20R~SUBMIT REQUEST TO~;@170;S:$D(RAEXMUL) RAILOC=X;@175;S (RAFIN,RAFIN1)="";@999;
"KRN",.402,244,"DR",1,75.1,20)
K RAI,RAPRI,RAMOD,RAIMAG,RAWPFLAG,RAREQLOC,RAMODPRO;
"KRN",.402,244,"DR",2,75.1125)
.01
"KRN",.402,244,"DR",2,75.12)
2////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);3////^S X=DUZ;
"KRN",.402,244,"ROU")
^RACTOE
"KRN",.402,244,"ROUOLD")
RACTOE
"KRN",.402,1005,-1)
0^2
"KRN",.402,1005,0)
RA QUICK EXAM ORDER^3061018.1347^^75.1^^^3070402
"KRN",.402,1005,"%D",0)
^^2^2^2940607^
"KRN",.402,1005,"%D",1,0)
This template is used in conjunction with OE/RR for ordering imaging
"KRN",.402,1005,"%D",2,0)
exams.
"KRN",.402,1005,"DIAB",1,1,75.1125,0)
ALL
"KRN",.402,1005,"DIAB",2,0,75.1,6)
20;"SUBMIT REQUEST TO";REQ
"KRN",.402,1005,"DIAB",3,0,75.1,1)
8;REQ
"KRN",.402,1005,"DIAB",4,0,75.1,4)
21;REQ
"KRN",.402,1005,"DR",1,75.1)
I '$D(RAPRI) S Y="@10";2////^S X=RAPRI;S RAIMAG=$$ITYPE^RASITE(+RAPRI);S Y="@20";@10;D ^RAPRI;S:'$D(RAPRI) Y="@99";S:$E(RAPRI)="^"!('RAPRI) Y="@99";2////^S X=RAPRI;S RAIMAG=$$ITYPE^RASITE(+RAPRI);@20;
"KRN",.402,1005,"DR",1,75.1,1)
I $O(^RAMIS(71,RAPRI,3,0)) D EN2^RAPRI;I $S('$D(^RAMIS(71,RAPRI,0)):1,1:$P(^(0),"^",11)'="y") S Y="@23";8R~;@23;I '$D(RAMOD) S Y="@35";S RAI="";@25;S RAI=$O(RAMOD(0)) I 'RAI S Y="@35";
"KRN",.402,1005,"DR",1,75.1,2)
S RAMODPRO=+$O(^RAMIS(71.2,"B",$G(RAMOD(RAI)),0));S:'$D(^RAMIS(71.2,"AB",+$$ITYPE^RASITE(RAPRI),RAMODPRO)) Y="@30";125///^S X=RAMOD(RAI);@30;K RAMOD(RAI) S Y="@25";@35;I '$D(RACAT) S RACAT="I";4////^S X=$E(RACAT);
"KRN",.402,1005,"DR",1,75.1,3)
I '$D(RAPREOP1) S Y="@40";12///^S X=RAPREOP1;@40;I '$D(RAPREG) S Y="@50";13///^S X=RAPREG;@50;S RACOMENT="reason for study is required, clinical history is not with the release of 75" K RACOMENT;1.1////^S X=RAREAST;
"KRN",.402,1005,"DR",1,75.1,4)
I $O(^TMP($J,"RAWP",0)) S ^RAO(75.1,DA,"H",0)=^(0) F RAI=1:1 Q:'$D(^TMP($J,"RAWP",RAI,0))  S ^RAO(75.1,DA,"H",RAI,0)=^(0);I $O(^RAO(75.1,DA,"H",0)) D UPDT^RAUTL3("^RAO(75.1,"_DA_",""H"",");S:$D(RAWHEN)#2 Y="@550";21R~;
"KRN",.402,1005,"DR",1,75.1,5)
S RAWHEN=$$FMTE^XLFDT(X,1);S Y="@560";@550;21///^S X=RAWHEN;@560;I $S('$D(RAILOC):1,'RAILOC:1,1:0) S Y="@60";20////^S X=RAILOC;S Y="@70";@60;S RAREQLOC=$$ILOC^RAUTL18(RAPRI);I 'RAREQLOC S Y="@62";20////^S X=RAREQLOC;S Y="@67";@62;
"KRN",.402,1005,"DR",1,75.1,6)
I '$D(RALOCFLG) S Y="@70";20R~SUBMIT REQUEST TO~;@67;S:$D(RAEXMUL) RAILOC=X;@70;3////^S X=$P(RAIMAG,U);14////^S X=RAPIFN;S RAX=$P(^RAO(75.1,DA,0),U,4);
"KRN",.402,1005,"DR",1,75.1,7)
I RAX="I",$P($G(^SC(+RALIFN,0)),U,3)'="W",($P($G(^SC(+RALIFN,0)),U,3)'="OR") D REQLOC1^RAORD1A;I RAX="O",$P($G(^SC(+RALIFN,0)),U,3)'="C",($P($G(^SC(+RALIFN,0)),U,3)'="OR") D REQLOC1^RAORD1A;
"KRN",.402,1005,"DR",1,75.1,8)
I $D(RALIFN("OUT")) K RALIFN("OUT") S Y="@99";22////^S X=RALIFN;5////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);18///^S X="NOW";75///^S X="""NOW""";I '$D(RAMT) S RAMT="a";19////^S X=$P(RAMT,"^");I '$D(RAIP) S RAIP="n";
"KRN",.402,1005,"DR",1,75.1,9)
24////^S X=RAIP;I '$D(RARU) S RARU=9;6////^S X=RARU;S:$$ORVR^RAORDU()<3 Y="@80";26////s;@80;S RAFIN=1;@99;K RAI,RAPRI,RAMOD,RAIMAG,RAREQLOC,RAMODPRO;
"KRN",.402,1005,"DR",2,75.1125)
.01
"KRN",.402,1005,"DR",2,75.12)
2////^S X=$S($D(RAPKG):5,$$ORVR^RAORDU()=2.5:11,1:5);3////^S X=DUZ;
"KRN",.402,1005,"ROU")
^RACTQE
"KRN",.402,1005,"ROUOLD")
RACTQE
"KRN",3.6,60,-1)
0^1
"KRN",3.6,60,0)
RAD/NUC MED REQUEST CANCELLED^Imaging Request Cancelled (|2|)
"KRN",3.6,60,1,0)
^^10^10^3061024^
"KRN",3.6,60,1,1,0)
The request for exam with the following identification was cancelled:
"KRN",3.6,60,1,2,0)
          1) Patient              : |1|
"KRN",3.6,60,1,3,0)
          2) Patient SSN          : |2|
"KRN",3.6,60,1,4,0)
          3) Procedure            : |3|
"KRN",3.6,60,1,5,0)
          4) Reason for Study     : |4|
"KRN",3.6,60,1,6,0)
          5) Date Desired         : |5|
"KRN",3.6,60,1,7,0)
          6) Requesting Physician : |6|
"KRN",3.6,60,1,8,0)
          7) Requesting Location  : |7|
"KRN",3.6,60,1,9,0)
          8) Reason               : |8|
"KRN",3.6,60,1,10,0)
          9) User                 : |9|
"KRN",3.6,60,3,0)
^3.63^2^2^3061024^^^^
"KRN",3.6,60,3,1,0)
This bulletin is used to notify the 'RA REQUEST CANCELLED' mail group that
"KRN",3.6,60,3,2,0)
a radiology request has been cancelled.
"KRN",3.6,60,4,0)
^3.64A^9^9
"KRN",3.6,60,4,1,0)
1
"KRN",3.6,60,4,1,1,0)
^^1^1^2940203^
"KRN",3.6,60,4,1,1,1,0)
Patient whose request was cancelled.
"KRN",3.6,60,4,2,0)
2
"KRN",3.6,60,4,2,1,0)
^^1^1^2940203^
"KRN",3.6,60,4,2,1,1,0)
Patient SSN of the patient whose request was cancelled.
"KRN",3.6,60,4,3,0)
3
"KRN",3.6,60,4,3,1,0)
^^1^1^2940203^
"KRN",3.6,60,4,3,1,1,0)
The name of the radiology procedure requested.
"KRN",3.6,60,4,4,0)
4
"KRN",3.6,60,4,4,1,0)
^^1^1^3061024^
"KRN",3.6,60,4,4,1,1,0)
The reason the study was initiated.
"KRN",3.6,60,4,5,0)
5
"KRN",3.6,60,4,5,1,0)
^^1^1^3061024^
"KRN",3.6,60,4,5,1,1,0)
The date the radiology order was desired.
"KRN",3.6,60,4,6,0)
6
"KRN",3.6,60,4,6,1,0)
^^1^1^3061024^
"KRN",3.6,60,4,6,1,1,0)
The physician who ordered the request.
"KRN",3.6,60,4,7,0)
7
"KRN",3.6,60,4,7,1,0)
^^1^1^3061024^
"KRN",3.6,60,4,7,1,1,0)
The requesting location of the procedure.
"KRN",3.6,60,4,8,0)
8
"KRN",3.6,60,4,8,1,0)
^^1^1^3061024^
"KRN",3.6,60,4,8,1,1,0)
The reason the request was cancelled.
"KRN",3.6,60,4,9,0)
9
"KRN",3.6,60,4,9,1,0)
^3.65^1^1^3061024^^^
"KRN",3.6,60,4,9,1,1,0)
The user that cancelled the request.
"KRN",3.6,105,-1)
0^2
"KRN",3.6,105,0)
RAD/NUC MED REQUEST HELD^Imaging Request Held (|2|)
"KRN",3.6,105,1,0)
^^10^10^3061024^
"KRN",3.6,105,1,1,0)
The request for exam with the following identification was held:
"KRN",3.6,105,1,2,0)
          1) Patient              : |1|
"KRN",3.6,105,1,3,0)
          2) Patient SSN          : |2|
"KRN",3.6,105,1,4,0)
          3) Procedure            : |3|
"KRN",3.6,105,1,5,0)
          4) Reason for Study     : |4|
"KRN",3.6,105,1,6,0)
          5) Date Desired         : |5|
"KRN",3.6,105,1,7,0)
          6) Requesting Physician : |6|
"KRN",3.6,105,1,8,0)
          7) Requesting Location  : |7|
"KRN",3.6,105,1,9,0)
          8) Reason               : |8|
"KRN",3.6,105,1,10,0)
          9) User                 : |9|
"KRN",3.6,105,3,0)
^3.63^2^2^3061024^^^^
"KRN",3.6,105,3,1,0)
This bulletin is used to notify the 'RA REQUEST HELD' mail group that a
"KRN",3.6,105,3,2,0)
radiology request has been held. 
"KRN",3.6,105,4,0)
^3.64A^9^9
"KRN",3.6,105,4,1,0)
1
"KRN",3.6,105,4,1,1,0)
^3.65^1^1^3061024^^
"KRN",3.6,105,4,1,1,1,0)
Patient whose request was held.
"KRN",3.6,105,4,2,0)
2
"KRN",3.6,105,4,2,1,0)
^3.65^1^1^3061024^^
"KRN",3.6,105,4,2,1,1,0)
Patient SSN of the patient whose request was held.
"KRN",3.6,105,4,3,0)
3
"KRN",3.6,105,4,3,1,0)
^3.65^1^1^3061024^^^
"KRN",3.6,105,4,3,1,1,0)
The name of the radiology procedure requested.
"KRN",3.6,105,4,4,0)
4
"KRN",3.6,105,4,4,1,0)
^^1^1^3061024^
"KRN",3.6,105,4,4,1,1,0)
The reason the study was initiated.
"KRN",3.6,105,4,5,0)
5
"KRN",3.6,105,4,5,1,0)
^^1^1^3061024^
"KRN",3.6,105,4,5,1,1,0)
The date the radiology order was desired.
"KRN",3.6,105,4,6,0)
6
"KRN",3.6,105,4,6,1,0)
^^1^1^3061024^
"KRN",3.6,105,4,6,1,1,0)
The physician who ordered the request.
"KRN",3.6,105,4,7,0)
7
"KRN",3.6,105,4,7,1,0)
^^1^1^3061024^
"KRN",3.6,105,4,7,1,1,0)
The requesting location of the procedure.
"KRN",3.6,105,4,8,0)
8
"KRN",3.6,105,4,8,1,0)
^^1^1^3061024^
"KRN",3.6,105,4,8,1,1,0)
The reason the request was held.
"KRN",3.6,105,4,9,0)
9
"KRN",3.6,105,4,9,1,0)
^3.65^1^1^3061024^^
"KRN",3.6,105,4,9,1,1,0)
The user who held the request.
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",18,-1)
1^1
"PKG",18,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",18,20,0)
^9.402P^^
"PKG",18,22,0)
^9.49I^1^1
"PKG",18,22,1,0)
5.0^3051109^2980407^50
"PKG",18,22,1,"PAH",1,0)
75^3070404^1866
"PKG",18,22,1,"PAH",1,1,0)
^^3^3^3070404
"PKG",18,22,1,"PAH",1,1,1,0)
Patch seventy-five for the Radiology/Nuclear Medicine 5.0 software.  
"PKG",18,22,1,"PAH",1,1,2,0)
Please review the Description and Installation Instructions for RA*5.0*75
"PKG",18,22,1,"PAH",1,1,3,0)
before installing this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
22
"RTN","RA75PST")
0^5^B5639049^n/a
"RTN","RA75PST",1,0)
RA75PST ;Hines OI/GJC - Post-init Driver, patch 75 ;01/05/06  06:32
"RTN","RA75PST",2,0)
VERSION ;;5.0;Radiology/Nuclear Medicine;**75**;Mar 16, 1998;Build 4
"RTN","RA75PST",3,0)
 ;
"RTN","RA75PST",4,0)
 Q
"RTN","RA75PST",5,0)
 ;
"RTN","RA75PST",6,0)
EN ; entry point for the post-install logic
"RTN","RA75PST",7,0)
 ; make sure the [RA ORDER EXAM] (RACTOE*) & [RA QUICK EXAM ORDER] (RACTQE*) 
"RTN","RA75PST",8,0)
 ; input templates are re-compiled so user workflow is not interrupted.
"RTN","RA75PST",9,0)
 ;
"RTN","RA75PST",10,0)
 ; Integration Agreements utilized in this software
"RTN","RA75PST",11,0)
 ; 
"RTN","RA75PST",12,0)
 ; tag     routine  number   usage      custodian
"RTN","RA75PST",13,0)
 ; --------------------------------------------------
"RTN","RA75PST",14,0)
 ; EN      DIEZ     10002    supported  VA FileMan
"RTN","RA75PST",15,0)
 ; BMES    XPDUTL   10141    supported  KERNEL
"RTN","RA75PST",16,0)
 ; FIND    DIC      2051     supported  VA FileMan
"RTN","RA75PST",17,0)
 ; ROUSIZE DILF     2649     supported  VA FileMan
"RTN","RA75PST",18,0)
 ;
"RTN","RA75PST",19,0)
 ;   RADMAX=maximum routine size (bytes) for this system
"RTN","RA75PST",20,0)
 ;  RACTNAM=compiled input template name (fixed to input template)
"RTN","RA75PST",21,0)
 ; RAINPERR=error flag - default value is zero (no error condition)
"RTN","RA75PST",22,0)
 ;          a value of one if: the input template lookup failed or
"RTN","RA75PST",23,0)
 ;          expected compiled input template name is not associated
"RTN","RA75PST",24,0)
 ;          with the proper input template
"RTN","RA75PST",25,0)
 ; RAINP751=local array where input template specific data is stored
"RTN","RA75PST",26,0)
 ; RAINPNME=input template name
"RTN","RA75PST",27,0)
 ;
"RTN","RA75PST",28,0)
 N X,Y,DMAX K RACTNAM,RADMAX,RAINPERR,RAINPNME S RADMAX=$$ROUSIZE^DILF
"RTN","RA75PST",29,0)
 F RAINPNME="RA ORDER EXAM","RA QUICK EXAM ORDER" D
"RTN","RA75PST",30,0)
 .K RAINP751 S RAINPERR=0
"RTN","RA75PST",31,0)
 .;
"RTN","RA75PST",32,0)
 .;input template RA ORDER EXAM compiles routines in the namespace: RACTOE*
"RTN","RA75PST",33,0)
 .;input template RA QUICK EXAM ORDER compiles routines in the namespace: RACTQE*
"RTN","RA75PST",34,0)
 .;
"RTN","RA75PST",35,0)
 .S RACTNAM=$S(RAINPNME="RA ORDER EXAM":"RACTOE",1:"RACTQE")
"RTN","RA75PST",36,0)
 .;
"RTN","RA75PST",37,0)
 .D FIND^DIC(.402,"","","O",RAINPNME,"","","","","RAINP751","")
"RTN","RA75PST",38,0)
 .;
"RTN","RA75PST",39,0)
 .;If the input template record is missing quit but check the other input template.
"RTN","RA75PST",40,0)
 .;
"RTN","RA75PST",41,0)
 .I $G(RAINP751("DILIST",2,1))'>0 S RAINPERR=$$ERROR(RAINPNME) Q
"RTN","RA75PST",42,0)
 .;
"RTN","RA75PST",43,0)
 .;compile the input templates...
"RTN","RA75PST",44,0)
 .;
"RTN","RA75PST",45,0)
 .K DMAX,X,Y
"RTN","RA75PST",46,0)
 .;DMAX: maximum routine size
"RTN","RA75PST",47,0)
 .;   X: the name of the routine for the compiled input template; i.e. RACTOE
"RTN","RA75PST",48,0)
 .;   Y: the IEN of the input template to be compiled
"RTN","RA75PST",49,0)
 .S DMAX=RADMAX,X=RACTNAM,Y=$G(RAINP751("DILIST",2,1))
"RTN","RA75PST",50,0)
 .D EN^DIEZ
"RTN","RA75PST",51,0)
 .Q
"RTN","RA75PST",52,0)
XIT K RACTNAM,RADMAX,RAINP751,RAINPERR,RAINPNME
"RTN","RA75PST",53,0)
 Q
"RTN","RA75PST",54,0)
 ;
"RTN","RA75PST",55,0)
ERROR(N) ;This function set the error flag & records the error
"RTN","RA75PST",56,0)
 K RATXT S RATXT(1)="'"_N_"' was not found in the INPUT TEMPLATE (#.402) file."
"RTN","RA75PST",57,0)
 S RATXT(2)=" " D BMES^XPDUTL(.RATXT) K RATXT
"RTN","RA75PST",58,0)
 Q 1
"RTN","RA75PST",59,0)
 ;
"RTN","RABUL")
0^15^B5625174^B4837424
"RTN","RABUL",1,0)
RABUL ;HISC/FPT,GJC AISC/DMK-Generate 'RAD/NUC MED REQUEST CANCELLED' or 'RAD/NUC MED REQUEST HELD' Bulletin ;9/9/94  09:53
"RTN","RABUL",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,15,75**;Mar 16, 1998;Build 4
"RTN","RABUL",3,0)
 ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
"RTN","RABUL",4,0)
 ; The variables DA and RAOSTS must be defined.
"RTN","RABUL",5,0)
 ; The variable DA must be greater than 0, and RAOSTS must
"RTN","RABUL",6,0)
 ; equal 1 (cancelled) or 3 (held) for the RAD/NUC MED REQUEST CANCELLED
"RTN","RABUL",7,0)
 ; or the  RAD/NUC MED REQUEST HELD bulletin to execute.
"RTN","RABUL",8,0)
 ; Called from: ^DD(75.1,5,0) fifth piece
"RTN","RABUL",9,0)
 ; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
"RTN","RABUL",10,0)
 ;                     ***** Variable List *****
"RTN","RABUL",11,0)
 ; 'RADFN' -> IEN of the patient in the PATIENT file (2)
"RTN","RABUL",12,0)
 ; 'RAFN1' -> internal format of a FM date/time data element
"RTN","RABUL",13,0)
 ; 'RAFN2' -> FM data definition for RAFN1, used in XTERNAL^RAUTL5
"RTN","RABUL",14,0)
 ; 'Z'     -> Zero node of the RADIOLOGY/NUCLEAR MEDICINE ORDERS
"RTN","RABUL",15,0)
 ;            file (75.1)
"RTN","RABUL",16,0)
 ; Format: Data to be fired;local var name;XMB array representation
"RTN","RABUL",17,0)
 ; Patient ; RANAME ; XMB(1)      <---> Req. Physician ; RARPHY ; XMB(5)
"RTN","RABUL",18,0)
 ; Patient SSN ; RASSN ; XMB(2)   <---> Req. Location ; RARLOC ; XMB(6)
"RTN","RABUL",19,0)
 ; Procedure ; RAPNAM ; XMB(3)    <---> Reason ; RARCR ; XMB(7)
"RTN","RABUL",20,0)
 ; Date Desired ; RADTDS ; XMB(4) <---> Current User ; RAUSER ; XMB(8)
"RTN","RABUL",21,0)
 ;
"RTN","RABUL",22,0)
EN(RAX) ; Pass in the request status (RAX)
"RTN","RABUL",23,0)
 ; also called during request status edit.
"RTN","RABUL",24,0)
 Q:+$G(DA)'>0
"RTN","RABUL",25,0)
 Q:+$G(RAOSTS)'=1&(+$G(RAOSTS)'=3)
"RTN","RABUL",26,0)
 N RADFN,RADTDS,RAFN1,RAFN2,RASSN,RAUSER,RAXMB,Z
"RTN","RABUL",27,0)
 S RAXMB="RAD/NUC MED REQUEST",Z=$G(^RAO(75.1,DA,0))
"RTN","RABUL",28,0)
 S (RADFN,RANAME)=+$P(Z,U)
"RTN","RABUL",29,0)
 S RANAME=$S($D(^DPT(RANAME,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",30,0)
 S RASSN=$$SSN^RAUTL(),RAPNAM=+$P(Z,U,2)
"RTN","RABUL",31,0)
 S RAPNAM=$S($D(^RAMIS(71,RAPNAM,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",32,0)
 S RARLOC=+$P(Z,U,22)
"RTN","RABUL",33,0)
 S RARLOC=$S($D(^SC(RARLOC,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",34,0)
 S RAFN1=$P(Z,U,21),RAFN2=$P($G(^DD(75.1,21,0)),U,2)
"RTN","RABUL",35,0)
 S RADTDS=$$XTERNAL^RAUTL5(RAFN1,RAFN2)
"RTN","RABUL",36,0)
 S:RADTDS']"" RADTDS="Unknown" S RARPHY=+$P(Z,U,14)
"RTN","RABUL",37,0)
 S RARPHY=$S($D(^VA(200,RARPHY,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",38,0)
 S RARCR=+$P(Z,U,10)
"RTN","RABUL",39,0)
 S RARCR=$S($D(^RA(75.2,RARCR,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",40,0)
 S:RARCR="Unknown" RARCR=$S($P(Z,U,27)]"":$P(Z,U,27),1:"Unknown")
"RTN","RABUL",41,0)
 S RAUSER=$S($D(^VA(200,DUZ,0)):$P(^(0),U),1:"Unknown")
"RTN","RABUL",42,0)
 ; --- P75 define the REASON FOR STUDY ---
"RTN","RABUL",43,0)
 S RASTYREA=$P($G(^RAO(75.1,DA,.1)),U)
"RTN","RABUL",44,0)
 S:RASTYREA="" RASTYREA="Unknown" ;req'd if missing error
"RTN","RABUL",45,0)
 ;
"RTN","RABUL",46,0)
 S XMB(1)=RANAME,XMB(2)=RASSN,XMB(3)=RAPNAM,XMB(4)=RASTYREA,XMB(5)=RADTDS
"RTN","RABUL",47,0)
 S XMB(6)=RARPHY,XMB(7)=RARLOC,XMB(8)=RARCR,XMB(9)=RAUSER
"RTN","RABUL",48,0)
 S XMB=RAXMB_$S(RAX=1:" CANCELLED",1:" HELD")
"RTN","RABUL",49,0)
 D ^XMB:$D(^XMB(3.6,"B",XMB))
"RTN","RABUL",50,0)
 K RANAME,RAPNAM,RARLOC,RARPHY,RARCR,RASTYREA,XMB,XMB0,XMC0,XMDT,XMM,XMMG
"RTN","RABUL",51,0)
 Q
"RTN","RABUL",52,0)
OE3(DA) ; Trigger the Rad/Nuc Med Request Cancelled bulletin when
"RTN","RABUL",53,0)
 ; the order is discontinued through CPRS (frontdoor).
"RTN","RABUL",54,0)
 ; Input: DA-ien of the Rad/Nuc Med order record
"RTN","RABUL",55,0)
 S RAOSTS=$P($G(^RAO(75.1,DA,0)),"^",5)
"RTN","RABUL",56,0)
 I RAOSTS'=1 K RAOSTS Q  ; status must be discontinued
"RTN","RABUL",57,0)
 D EN(RAOSTS) K RAOSTS
"RTN","RABUL",58,0)
 Q
"RTN","RAHLR")
0^16^B47516973^B49413163
"RTN","RAHLR",1,0)
RAHLR ;HISC/CAH/BNT - Generate Common Order (ORM) Message ;11/10/99  10:42
"RTN","RAHLR",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,12,10,25,71,82,75**;Mar 16, 1998;Build 4
"RTN","RAHLR",3,0)
 ;Generates msg whenever a case is registered or cancelled or examined
"RTN","RAHLR",4,0)
 ;              registered        cancelled        examined
"RTN","RAHLR",5,0)
 ; Order control : NW                CA               XO
"RTN","RAHLR",6,0)
 ; Order status  : IP                CA               CM
"RTN","RAHLR",7,0)
 ;02/14/2006 BAY/KAM RA*5*71 Add ability to update exam data to V/R
"RTN","RAHLR",8,0)
 S:$D(HLNDAP) ZTSAVE("HLNDAP")="" S:$D(HLDAP) ZTSAVE("HLDAP")="" S:$D(RAEXMDUN) ZTSAVE("RAEXMDUN")=""
"RTN","RAHLR",9,0)
 S:$D(RAEXEDT) ZTSAVE("RAEXEDT")=""
"RTN","RAHLR",10,0)
 S ZTSAVE("RADFN")="",ZTSAVE("RADTI")="",ZTSAVE("RACNI")="",ZTIO="",ZTDTH=$H,ZTDESC="Rad/Nuc Med Compiling HL7 Common Order",ZTRTN="EN^RAHLR" D ^%ZTLOAD
"RTN","RAHLR",11,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE Q
"RTN","RAHLR",12,0)
EN ; Called from the RA REG & RA CANCEL & RA EXAMINED protocols
"RTN","RAHLR",13,0)
 ; Input Variables:
"RTN","RAHLR",14,0)
 ;   RADFN=file 2 IEN (DFN)
"RTN","RAHLR",15,0)
 ;   RADTI=file 70 Exam subrec IEN (reverse date/time of exam)
"RTN","RAHLR",16,0)
 ;   RACNI=file 70 Case subrecord IEN
"RTN","RAHLR",17,0)
 ;   RAEID=ien of the event driver protocol (defined in RAHLRPC)
"RTN","RAHLR",18,0)
 ; Output Variables:
"RTN","RAHLR",19,0)
 ;   HLA("HLS") array containing HL7 msg
"RTN","RAHLR",20,0)
 ;
"RTN","RAHLR",21,0)
 N EID,HL,INT,HLQ,HLFS,HLECH,HLA,HLCS,HLSCS,HLREP,HLECH
"RTN","RAHLR",22,0)
 N DFN,DIWF,DIWL,DIWR,GMRAL,PI,RACANC,RACN0,RACPT,RACPTNDE,RADTE,RAI,RAN,RAOBR4,RAPRCNDE,RAPROC,RAPROCIT,RAPRV,RAX0,VA,VADM,VAERR,X,X0,Y,X1,OBR36
"RTN","RAHLR",23,0)
 ;
"RTN","RAHLR",24,0)
 D INIT ; initialize some HL7 variables
"RTN","RAHLR",25,0)
 ;RAEXMDUN passed from EXM^RAHLRPC if conditions are met
"RTN","RAHLR",26,0)
 Q:+$G(HL)=15  ;no known client(item) linked to the event driver protocol
"RTN","RAHLR",27,0)
 Q:$O(HL(""))=""  ;disabled server appl, or no server appl
"RTN","RAHLR",28,0)
 S RACN0=$S($D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)):^(0),1:"") Q:RACN0']""
"RTN","RAHLR",29,0)
 ;Generate Message Text
"RTN","RAHLR",30,0)
 S RAPROC=+$P(RACN0,U,2) I 'RAPROC Q  ;If case entered via 'Enter Last Past Visit before DHCP option, and procedure 'OTHER' is inactive, RAPROC will be null and will cause bomb-out unless we quit here
"RTN","RAHLR",31,0)
 S RAPROCIT=+$P($G(^RAMIS(71,RAPROC,0)),U,12),RAPROCIT=$P(^RA(79.2,RAPROCIT,0),U,1)
"RTN","RAHLR",32,0)
 S (RADTE,OBR36)=9999999.9999-RADTI,RADTE=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_+RACN0,RACANC=$S($D(^RA(72,"AA",RAPROCIT,0,+$P(RACN0,"^",3))):1,1:0)
"RTN","RAHLR",33,0)
 S RAPRCNDE=$G(^RAMIS(71,+RAPROC,0)),RACPT=+$P(RAPRCNDE,U,9),RACPTNDE=$$NAMCODE^RACPTMSC(RACPT,DT)
"RTN","RAHLR",34,0)
 ;RA*5*82 RAEXEDT= Override the EXM conditions if Case edited
"RTN","RAHLR",35,0)
 I $G(RAEXMDUN)=1,'$G(RAEXEDT),$P(RACN0,U,30)'="" Q  ;last chance to stop exm'd msg if it's already been sent
"RTN","RAHLR",36,0)
 ;Compile 'PID' Segment
"RTN","RAHLR",37,0)
 K VA,VADM,VAERR,RAVADM S DFN=RADFN D DEM^VADPT I VADM(1)']"" S HLP("ERRTEXT")="Invalid Patient Identifier" G EXIT
"RTN","RAHLR",38,0)
 S RAVADM(3)=$S($E(+VADM(3),6,7)="00":"",1:+VADM(3)) ; NOTE: Check
"RTN","RAHLR",39,0)
 ; for an inexact date of birth.  If inexact, pass null for DOB in
"RTN","RAHLR",40,0)
 ; the 'PID' segment.  Some COTS systems can't handle inexact DOB's.
"RTN","RAHLR",41,0)
 I HL("VER")']"2.2" D
"RTN","RAHLR",42,0)
 .S HLA("HLS",1)="PID"_HLFS_HLFS_$G(VA("PID"))_HLFS_$$M11^HLFNC(RADFN)_HLFS_HLFS_$$HLNAME^HLFNC(VADM(1))_HLFS_HLFS_$$HLDATE^HLFNC(RAVADM(3))_HLFS_$S(VADM(5)]"":$S("MF"[$P(VADM(5),"^"):$P(VADM(5),"^"),1:"O"),1:"U")
"RTN","RAHLR",43,0)
 .S:$P(VADM(2),"^")]"" $P(HLA("HLS",1),HLFS,20)=$P(VADM(2),"^")
"RTN","RAHLR",44,0)
 I HL("VER")]"2.2" S HLA("HLS",1)=$$EN^VAFHLPID(DFN,"2,3,5,7,8,19,20")
"RTN","RAHLR",45,0)
 K RAVADM
"RTN","RAHLR",46,0)
 ;Compile 'ORC' Segment
"RTN","RAHLR",47,0)
 S X0="" ;if exam-set or print-set, store parent name if order exists
"RTN","RAHLR",48,0)
 I $P(RACN0,U,25) S X0=$P(RACN0,U,11),X0=$P($G(^RAO(75.1,+X0,0)),U,2),X0=$P($G(^RAMIS(71,+X0,0)),U),X0=$S(X0="":"ORIGINAL ORDER PURGED",1:X0),X0=$S($P(RACN0,U,25)=1:"EXAM",1:"PRINT")_"SET: "_X0
"RTN","RAHLR",49,0)
 ; BNT - Added ORC4 Placer Group Number for Printset identification.
"RTN","RAHLR",50,0)
 ; ORC4 is a combination of SSN with the order inverted date/time.
"RTN","RAHLR",51,0)
 S RAORC4="" I $P($G(RACN0),U,25)=2 D
"RTN","RAHLR",52,0)
 . S:$P(VADM(2),"^")]"" RAORC4=$P(VADM(2),"^")
"RTN","RAHLR",53,0)
 . S RAORC4=$G(RAORC4)_RADTI
"RTN","RAHLR",54,0)
 S HLA("HLS",2)="ORC"_HLFS_$S(RACANC:"CA",$G(RAEXMDUN)=1:"XO",1:"NW")_HLFS_HLFS_HLFS_RAORC4_HLFS_$S(RACANC:"CA",$G(RAEXMDUN)=1:"CM",1:"IP")_HLFS_HLFS_HLFS_X0_HLFS_HLDT1
"RTN","RAHLR",55,0)
 K RAORC4
"RTN","RAHLR",56,0)
 ;Compile 'OBR' Segment
"RTN","RAHLR",57,0)
 S RAOBR4=$P(RACPTNDE,U)_$E(HLECH)_$P(RACPTNDE,U,2)_$E(HLECH)_"C4"_$E(HLECH)_+RAPROC_$E(HLECH)_$P(RAPRCNDE,U)_$E(HLECH)_"99RAP"
"RTN","RAHLR",58,0)
 ; Replace above with following when Imaging can cope with ESC chars
"RTN","RAHLR",59,0)
 ; S RAOBR4=$P(RACPTNDE,U)_$E(HLECH)_$$ESCAPE^RAHLRU($P(RACPTNDE,U,2))_$E(HLECH)_"C4"_$E(HLECH)_+RAPROC_$E(HLECH)_$$ESCAPE^RAHLRU($P(RAPRCNDE,U))_$E(HLECH)_"99RAP"
"RTN","RAHLR",60,0)
 I $P(RACPTNDE,U)']"" S $P(RAOBR4,$E(HLECH),1,3)=$P(RAOBR4,$E(HLECH),4,5)_$E(HLECH)_"LOCAL"
"RTN","RAHLR",61,0)
 S HLA("HLS",3)="OBR"_HLFS_HLFS_RADTE_HLFS_RADTI_"-"_RACNI_$E(HLECH)_RADTE_$E(HLECH)_"L"_HLFS_RAOBR4_HLFS_HLFS_HLFS_HLDT1
"RTN","RAHLR",62,0)
 S HLA("HLS",3)=HLA("HLS",3)_HLFS_HLQ_HLFS_HLQ_HLFS_HLFS_HLFS_HLFS_HLFS_HLQ_HLFS_HLFS
"RTN","RAHLR",63,0)
 S RAPRV=$$GET1^DIQ(200,+$P(RACN0,"^",14),.01)
"RTN","RAHLR",64,0)
 S HLA("HLS",3)=HLA("HLS",3)_$S(RAPRV]"":+$P(RACN0,"^",14)_$E(HLECH)_$$HLNAME^HLFNC(RAPRV),1:"")
"RTN","RAHLR",65,0)
 ;
"RTN","RAHLR",66,0)
 N RACN00,RA20 S RACN00=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAHLR",67,0)
 ;Seg's fld 20 = pce 21 --> ien file #79.1~name of img loc~stn #~stn name
"RTN","RAHLR",68,0)
 S RA20=+$G(^RA(79.1,+$P(RACN00,U,4),0))
"RTN","RAHLR",69,0)
 S $P(HLA("HLS",3),HLFS,21)=$P(RACN00,U,4)_$E(HLECH)_$P($G(^SC(RA20,0)),U)_$E(HLECH)_$P(RACN00,U,3)_$E(HLECH)_$P($G(^DIC(4,+$P(RACN00,U,3),0)),U)
"RTN","RAHLR",70,0)
 S $P(HLA("HLS",3),HLFS,21)=$P(HLA("HLS",3),HLFS,21)
"RTN","RAHLR",71,0)
 ; Replace above with following when Imaging can cope with ESC chars
"RTN","RAHLR",72,0)
 ; S $P(HLA("HLS",3),HLFS,21)=$$ESCAPE^RAHLRU($P(HLA("HLS",3),HLFS,21))
"RTN","RAHLR",73,0)
 ;Seg's fld 21 = pce 22 --> abbrv I-type~Img type name
"RTN","RAHLR",74,0)
 S RA20=$G(^RA(79.2,+$P(RACN00,U,2),0))
"RTN","RAHLR",75,0)
 S $P(HLA("HLS",3),HLFS,22)=$P(RA20,U,3)_$E(HLECH)_$P(RA20,U)
"RTN","RAHLR",76,0)
 S $P(HLA("HLS",3),HLFS,22)=$P(HLA("HLS",3),HLFS,22)
"RTN","RAHLR",77,0)
 ; Replace above with following when Imaging can cope with ESC chars
"RTN","RAHLR",78,0)
 ; S $P(HLA("HLS",3),HLFS,22)=$$ESCAPE^RAHLRU($P(HLA("HLS",3),HLFS,22))
"RTN","RAHLR",79,0)
 ;
"RTN","RAHLR",80,0)
 S $P(HLA("HLS",3),HLFS,23)=HLDT1,$P(HLA("HLS",3),HLFS,19)=$S($D(^DIC(42,+$P(RACN0,"^",6),0)):$P(^(0),"^"),$D(^SC(+$P(RACN0,"^",8),0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAHLR",81,0)
 ;
"RTN","RAHLR",82,0)
 ; OBR-31.2 = Reason for Study P75
"RTN","RAHLR",83,0)
 S $P(HLA("HLS",3),HLFS,32)=$E(HLECH)_$$ESCAPE^RAHLRU($P($G(^RAO(75.1,+$P(RACN0,"^",11),.1)),U))
"RTN","RAHLR",84,0)
 ;
"RTN","RAHLR",85,0)
 ; OBR-36 = Exam Date/Time
"RTN","RAHLR",86,0)
 S $P(HLA("HLS",3),HLFS,37)=$$FMTHL7^XLFDT(OBR36)
"RTN","RAHLR",87,0)
 ;
"RTN","RAHLR",88,0)
 I 'RACANC S X=$P($G(^RAO(75.1,+$P(RACN0,"^",11),0)),"^",6),$P(HLA("HLS",3),HLFS,28)=$E(HLECH)_$E(HLECH)_$E(HLECH)_$E(HLECH)_$E(HLECH)_$TR(X,"129","SAR")
"RTN","RAHLR",89,0)
 ; if long str, break so 2nd str begins with separator to avoid abend
"RTN","RAHLR",90,0)
 I $L(HLA("HLS",3))>245 N RAPART,RA1 S RA1=HLA("HLS",3) F RAPART=5:1:15 S RAPART(1)=$P(RA1,HLFS,1,RAPART),RAPART(2)=$P(RA1,HLFS,RAPART+1,99) Q:$L(RAPART(1))<245&($L(RAPART(2))<245)&($P(RAPART(2),HLFS)="")
"RTN","RAHLR",91,0)
 I $D(RAPART) K:RAPART=15 RAPART ;if RAPART reaches 15, then something's wrong so kill RAPART to allow abend due "string too long"
"RTN","RAHLR",92,0)
 I $D(RAPART) S HLA("HLS",3)=$P(RAPART(1),HLFS)_HLFS,HLA("HLS",3,1)=$P(RAPART(1),HLFS,2,99)_HLFS,HLA("HLS",3,2)=RAPART(2) K RAPART,RA1
"RTN","RAHLR",93,0)
OBXPRC ;Compile 'OBX' Segment for Procedure
"RTN","RAHLR",94,0)
 S RAN=4 D OBXPRC^RAHLRU
"RTN","RAHLR",95,0)
OBXMOD ;Compile 'OBX' Segment for two types of Modifiers
"RTN","RAHLR",96,0)
 S RAN=5 D OBXMOD^RAHLRU
"RTN","RAHLR",97,0)
OBXHIST ;Compile 'OBX' Segment for Clinical History
"RTN","RAHLR",98,0)
 I '$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",0)) S RAN=RAN+1,HLA("HLS",RAN)="OBX"_HLFS_HLFS_"TX"_HLFS_"H"_$E(HLECH)_"HISTORY"_$E(HLECH)_"L"_HLFS_HLFS_"None Entered" D OBX11^RAHLRU G ALLER
"RTN","RAHLR",99,0)
 K ^UTILITY($J,"W") S DIWF="",DIWR=80,DIWL=1 F RAI=0:0 S RAI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",RAI)) Q:'RAI  I $D(^(RAI,0)) S X=^(0) D ^DIWP
"RTN","RAHLR",100,0)
 F RAI=0:0 S RAI=$O(^UTILITY($J,"W",DIWL,RAI)) Q:'RAI  I $D(^(RAI,0)) S RAN=RAN+1,HLA("HLS",RAN)="OBX"_HLFS_HLFS_"TX"_HLFS_"H"_$E(HLECH)_"HISTORY"_$E(HLECH)_"L"_HLFS_HLFS_^(0) D OBX11^RAHLRU
"RTN","RAHLR",101,0)
ALLER ;Compile 'OBX' Segment for Allergies
"RTN","RAHLR",102,0)
 S DFN=RADFN D ALLERGY^RADEM S X="" I $D(GMRAL) S RAI=0 F  S RAI=$O(PI(RAI)) Q:RAI'>0  S X0=PI(RAI) I X0]"" Q:($L(X)+$L(X0))>200  S X=X_X0_", "
"RTN","RAHLR",103,0)
 I $L(X) S RAN=RAN+1,HLA("HLS",RAN)="OBX"_HLFS_HLFS_"TX"_HLFS_"A"_$E(HLECH)_"ALLERGIES"_$E(HLECH)_"L"_HLFS_HLFS_X D OBX11^RAHLRU
"RTN","RAHLR",104,0)
OBXTCM ;Compile 'OBX' Segment for Tech Comment
"RTN","RAHLR",105,0)
 D OBXTCM^RAHLRU
"RTN","RAHLR",106,0)
EXIT ; set HL7 message type & return to protocol
"RTN","RAHLR",107,0)
 K ^UTILITY($J,"W")
"RTN","RAHLR",108,0)
 S HL("MTN")="ORM"
"RTN","RAHLR",109,0)
 N HLEID,HLARYTYP,HLFORMAT,HLMTIEN,HLP
"RTN","RAHLR",110,0)
 S HLEID=EID,HLARYTYP="LM",HLFORMAT=1,HLMTIEN="",HLP("PRIORITY")="I"
"RTN","RAHLR",111,0)
 D GENERATE^HLMA(HLEID,HLARYTYP,HLFORMAT,.HLRESLT,HLMTIEN,.HLP)
"RTN","RAHLR",112,0)
 Q
"RTN","RAHLR",113,0)
Q ;Entry Point to Process an ORR Message (Just a Quit Since No Processing is Required)
"RTN","RAHLR",114,0)
 Q
"RTN","RAHLR",115,0)
INIT ; initialize HL7 variables
"RTN","RAHLR",116,0)
 D NOW^%DTC S HLDT=%,HLDT1=$$HLDATE^HLFNC(%)
"RTN","RAHLR",117,0)
 Q:'$G(RAEID)  S EID=RAEID
"RTN","RAHLR",118,0)
 S HL="HLS(""HLS"")",INT=1
"RTN","RAHLR",119,0)
 D INIT^HLFNC2(EID,.HL,INT)
"RTN","RAHLR",120,0)
 Q:'$D(HL("Q"))  ;no server application defined
"RTN","RAHLR",121,0)
 S HLQ=HL("Q"),HLFS=HL("FS")
"RTN","RAHLR",122,0)
 S HLECH=HL("ECH")
"RTN","RAHLR",123,0)
 S HLFS=HL("FS")
"RTN","RAHLR",124,0)
 S HLCS=$E(HL("ECH"))
"RTN","RAHLR",125,0)
 S HLSCS=$E(HL("ECH"),4)
"RTN","RAHLR",126,0)
 S HLREP=$E(HL("ECH"),2)
"RTN","RAHLR",127,0)
 Q
"RTN","RAO7NEW")
0^14^B43134846^B34874778
"RTN","RAO7NEW",1,0)
RAO7NEW ;HISC/FPT - Create entry in OE/RR Order file (100) ;11/16/98  15:10
"RTN","RAO7NEW",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,10,18,41,75**;Mar 16, 1998 ;Build 4
"RTN","RAO7NEW",3,0)
 ;
"RTN","RAO7NEW",4,0)
 ; This routine invokes IA #1300-A, #2083, #10082
"RTN","RAO7NEW",5,0)
 ;last modification for P18 by SS July 5,2000
"RTN","RAO7NEW",6,0)
EN1(RAOIFN) ; 'RAOIFN' is the ien in file 75.1  
"RTN","RAO7NEW",7,0)
 ; In RA*5.0*18 this call is used when procedure CHANGED during registration, adding to visit and editing 
"RTN","RAO7NEW",8,0)
 ; New vars & define the following variables: RAECH, RAECH array & RAHLFS
"RTN","RAO7NEW",9,0)
 N A,B,DFN,RA,RA0,RACNT,RACPT,RADFN,RAECH,RAHL7DT,RAHLFS,RALOC,RANATURE
"RTN","RAO7NEW",10,0)
 N RAPRIOR,RAPROC,RAR,RARMBED,RATAB,RAVAR,RAWARD,RAXIT
"RTN","RAO7NEW",11,0)
 N RAORORDN,RAD70SB,RAORDCTR ;P18, OR Order No, "DT" of #70, Orderctrl,subscr of 70
"RTN","RAO7NEW",12,0)
 N RABWDX,RABWDX1 ; Billing Awareness Project.
"RTN","RAO7NEW",13,0)
 S RAORORDN="",RAD70SB=0,RAORDCTR="SN" ;P18, these sets mean that it's request mode (not the case, when procedure changed during registering or editing) 
"RTN","RAO7NEW",14,0)
 I $D(RAREGMOD) S RAORORDN=$P(^RAO(75.1,RAOIFN,0),"^",7)_"^OR",RAORDCTR="XX" ;P18,if register mode (see RAREG2 for EN1^RAO7XX)
"RTN","RAO7NEW",15,0)
 S RATAB=1 D EN1^RAO7UTL
"RTN","RAO7NEW",16,0)
 S RA0=$G(^RAO(75.1,RAOIFN,0)) Q:RA0']""
"RTN","RAO7NEW",17,0)
SS2 I RAORDCTR="XX" D UPDTRA0^RAO7XX ;P18, update RA0 with #70 inf, sets RAD70SB, that provide D2^D3 of #70
"RTN","RAO7NEW",18,0)
 S RADFN=+RA0,RAR=$G(^RAO(75.1,RAOIFN,"R"))
"RTN","RAO7NEW",19,0)
SS3 I RAORDCTR="XX",RAD70SB'=0 S RAR=$G(^RADPT(+RA0,"DT",$P(RAD70SB,"^",1),"P",$P(RAD70SB,"^",2),"R")) ;P18
"RTN","RAO7NEW",20,0)
 ;
"RTN","RAO7NEW",21,0)
 ;*Billing Awarenes Project:
"RTN","RAO7NEW",22,0)
 ;   Retrieve Ordering ICD Dx data to Send to CPRS.
"RTN","RAO7NEW",23,0)
 D SENDCPRS^RABWORD1(RAOIFN)
"RTN","RAO7NEW",24,0)
 ;*
"RTN","RAO7NEW",25,0)
 S RAVAR="RATMP(",RAVARBLE="RATMP"
"RTN","RAO7NEW",26,0)
 ; msh
"RTN","RAO7NEW",27,0)
 S @(RAVAR_RATAB_")")=$$MSH^RAO7UTL("ORM^O01") ;P18
"RTN","RAO7NEW",28,0)
 ; pid
"RTN","RAO7NEW",29,0)
 S RATAB=RATAB+1,@(RAVAR_RATAB_")")=$$PID^RAO7UTL(RA0)
"RTN","RAO7NEW",30,0)
 ; pv1
"RTN","RAO7NEW",31,0)
 S RATAB=RATAB+1,@(RAVAR_RATAB_")")=$$PV1^RAO7UTL(RA0)
"RTN","RAO7NEW",32,0)
 K RA("PV1"),VAIP,RABWVSIT
"RTN","RAO7NEW",33,0)
 ; orc
"RTN","RAO7NEW",34,0)
 S RAHL7DT=$$HLDATE^HLFNC($P(RA0,U,21),"TS"),RAPRIOR=$P(RA0,U,6)
"RTN","RAO7NEW",35,0)
 S RAPRIOR=$S(RAPRIOR=1:"S",RAPRIOR=2:"A",RAPRIOR=9:"R",1:"")
"RTN","RAO7NEW",36,0)
 S RA("ORC",7)="^^^"_RAHL7DT_"^^"_RAPRIOR
"RTN","RAO7NEW",37,0)
 S RA("ORC",10)=$P(RA0,U,15),RA("ORC",12)=$P(RA0,U,14)
"RTN","RAO7NEW",38,0)
 S RA("ORC",11)=$P(RA0,U,8) ;approving radiologist
"RTN","RAO7NEW",39,0)
 S RA("ORC",15)=$$HLDATE^HLFNC($P(RA0,"^",16),"TS")
"RTN","RAO7NEW",40,0)
 S RANATURE="" I $L($P(RA0,"^",26)) S RANATURE=$$UP^XLFSTR($P(RA0,"^",26))_RAECH(1)_$$EXTERNAL^DILFD(75.1,26,"",$P(RA0,"^",26))
"RTN","RAO7NEW",41,0)
 F I=1,2 I '$L($P(RANATURE,"^",I)) S RANATURE="S"_RAECH(1)_"SERVICE CORRECTION"
"RTN","RAO7NEW",42,0)
 K I S RA("ORC",16)=RANATURE_RAECH(1)_"99ORN"_RAECH(1)_RAECH(1)_RAECH(1)
"RTN","RAO7NEW",43,0)
 S RATAB=RATAB+1
"RTN","RAO7NEW",44,0)
 ;P18, next line was modified
"RTN","RAO7NEW",45,0)
SS4 S @(RAVAR_RATAB_")")="ORC"_RAHLFS_RAORDCTR_RAHLFS_RAORORDN_RAHLFS_RAOIFN_RAECH(1)_"RA"_$$STR^RAO7UTL(4)_RA("ORC",7)_$$STR^RAO7UTL(3)_RA("ORC",10)_RAHLFS_RA("ORC",11)_RAHLFS_RA("ORC",12)_$$STR^RAO7UTL(3)_RA("ORC",15)_RAHLFS_RA("ORC",16)
"RTN","RAO7NEW",46,0)
 K RA("ORC")
"RTN","RAO7NEW",47,0)
 ; obr
"RTN","RAO7NEW",48,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RA0,U,2),0)),RAPROC(9)=+$P(RAPROC(0),U,9)
"RTN","RAO7NEW",49,0)
 S RACPT(0)=$$NAMCODE^RACPTMSC(RAPROC(9),DT)
"RTN","RAO7NEW",50,0)
 S RA("OBR",4)=$P(RACPT(0),U)_U_$P(RACPT(0),U,2)_U_"CPT4"_U_+$P(RA0,U,2)_U_$P(RAPROC(0),U)_"^99RAP"
"RTN","RAO7NEW",51,0)
 S RA("OBR",12)=""
"RTN","RAO7NEW",52,0)
 S:$P(RA0,U,24)]""&("Yy"[$P(RA0,U,24)) RA("OBR",12)="isolation"
"RTN","RAO7NEW",53,0)
 S RA("OBR",18)=""
"RTN","RAO7NEW",54,0)
SS5 I RAORDCTR="XX",RAD70SB'=0 D MODIF70^RAO7XX($P(RAD70SB,"^",1),$P(RAD70SB,"^",2))  G CONTIN ;P18 by SS
"RTN","RAO7NEW",55,0)
 I $O(^RAO(75.1,RAOIFN,"M",0)) D
"RTN","RAO7NEW",56,0)
 . S (A,RAXIT)=0
"RTN","RAO7NEW",57,0)
 . F  S A=$O(^RAO(75.1,RAOIFN,"M",A)) Q:A'>0  D  Q:RAXIT
"RTN","RAO7NEW",58,0)
 .. S B(0)=$G(^RAO(75.1,RAOIFN,"M",A,0))
"RTN","RAO7NEW",59,0)
 .. S B(1)=$P($G(^RAMIS(71.2,+B(0),0)),U)
"RTN","RAO7NEW",60,0)
 .. I $L(RA("OBR",18))+$L(B(1))>60 S RAXIT=1 Q
"RTN","RAO7NEW",61,0)
 .. S RA("OBR",18)=$G(RA("OBR",18))_B(1)_RAECH(2)
"RTN","RAO7NEW",62,0)
 .. Q
"RTN","RAO7NEW",63,0)
 . S RA("OBR",18)=$P(RA("OBR",18),RAECH(2),1,$L(RA("OBR",18),RAECH(2))-1)
"RTN","RAO7NEW",64,0)
 . Q
"RTN","RAO7NEW",65,0)
CONTIN S RALOC(0)=$G(^RA(79.1,+$P(RA0,U,20),0))
"RTN","RAO7NEW",66,0)
 S RA("OBR",19)=+$P(RA0,U,20)_U_$P($G(^SC(+RALOC(0),0)),U)
"RTN","RAO7NEW",67,0)
 S:+RA("OBR",19)'>0 RA("OBR",19)=""
"RTN","RAO7NEW",68,0)
 S RA("OBR",30)=$S($P(RA0,U,19)="":"","Aa"[$P(RA0,U,19):"WALK","Pp"[$P(RA0,U,19):"PORT","Ss"[$P(RA0,U,19):"CART","Ww"[$P(RA0,U,19):"WHLC",1:"")
"RTN","RAO7NEW",69,0)
 ;----- P75 REASON FOR STUDY OBR-31.2 -----
"RTN","RAO7NEW",70,0)
 S (RAREASDY,RA("OBR",31))=RAECH(1)_$P($G(^RAO(75.1,RAOIFN,.1)),U)
"RTN","RAO7NEW",71,0)
 S RA("OBRZ")="OBR"_$$STR^RAO7UTL(4)_RA("OBR",4)_$$STR^RAO7UTL(8)_RA("OBR",12)_$$STR^RAO7UTL(6)
"RTN","RAO7NEW",72,0)
 S RA("OBRZ")=RA("OBRZ")_RA("OBR",18)_RAHLFS_RA("OBR",19)_$$STR^RAO7UTL(11)_RA("OBR",30)_RAHLFS_RA("OBR",31)
"RTN","RAO7NEW",73,0)
 S RATAB=RATAB+1,@(RAVAR_RATAB_")")=RA("OBRZ")
"RTN","RAO7NEW",74,0)
 K RA("OBR"),RA("OBRZ")
"RTN","RAO7NEW",75,0)
 ; nte
"RTN","RAO7NEW",76,0)
SS1 I RAORDCTR="XX",RAD70SB'=0 D  ;P18 nte segment
"RTN","RAO7NEW",77,0)
 . N RA18Z S RA18Z=$$GETTCOM^RAUTL11(+RA0,$P(RAD70SB,"^",1),$P(RAD70SB,"^",2))
"RTN","RAO7NEW",78,0)
 . I RA18Z="" K RA18Z Q
"RTN","RAO7NEW",79,0)
 . S RATAB=RATAB+1,@(RAVAR_RATAB_")")="NTE"_RAHLFS_"16"_RAHLFS_"L"_RAHLFS_$E(RA18Z,1,245)
"RTN","RAO7NEW",80,0)
 . K RA18Z Q
"RTN","RAO7NEW",81,0)
 ; obx
"RTN","RAO7NEW",82,0)
 ;P18 next line was modified - Clinical History capture
"RTN","RAO7NEW",83,0)
 ;----- P75 modifications -----
"RTN","RAO7NEW",84,0)
 I '$$PATCH^XPDUTL("OR*3.0*243") D  ;Reason for Study captured & passed as Clinical History
"RTN","RAO7NEW",85,0)
 . S RACNT=1,RATAB=RATAB+1 ;set Set ID (RACNT) value at one (denotes Reason for Study)
"RTN","RAO7NEW",86,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TX"_RAHLFS_"2000.02^Clinical History^AS4"_RAHLFS_"1"_RAHLFS_"REASON FOR STUDY: "_RAREASDY
"RTN","RAO7NEW",87,0)
 . S RACNT=RACNT+1,RATAB=RATAB+1,$P(RABREAK,"-",($L("REASON FOR STUDY: "_RAREASDY)+1))=""
"RTN","RAO7NEW",88,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TX"_RAHLFS_"2000.02^Clinical History^AS4"_RAHLFS_"1"_RAHLFS_RABREAK
"RTN","RAO7NEW",89,0)
 . K RABREAK
"RTN","RAO7NEW",90,0)
 . Q
"RTN","RAO7NEW",91,0)
 E  S RACNT=0 ;OR*3.0*243 is installed, Reason for Study captured in OBR-31.2
"RTN","RAO7NEW",92,0)
 ;capture only clinical history data. Set ID starts at zero
"RTN","RAO7NEW",93,0)
SS6 S A=0 F  S A=$S(RAORDCTR="XX"&(RAD70SB'=0):$O(^RADPT(+RA0,"DT",$P(RAD70SB,"^",1),"P",$P(RAD70SB,"^",2),"H",A)),1:$O(^RAO(75.1,RAOIFN,"H",A))) Q:A'>0  D
"RTN","RAO7NEW",94,0)
SS7 . S RACNT=RACNT+1,RATAB=RATAB+1
"RTN","RAO7NEW",95,0)
 . ;P18 next line was modified
"RTN","RAO7NEW",96,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TX"_RAHLFS_"2000.02^Clinical History^AS4"_RAHLFS_"1"_RAHLFS_$S(RAORDCTR="XX"&(RAD70SB'=0):$G(^RADPT(+RA0,"DT",$P(RAD70SB,"^",1),"P",$P(RAD70SB,"^",2),"H",A,0)),1:$G(^RAO(75.1,RAOIFN,"H",A,0)))
"RTN","RAO7NEW",97,0)
 . Q
"RTN","RAO7NEW",98,0)
 S DFN=RADFN D DEM^VADPT
"RTN","RAO7NEW",99,0)
 I $P(VADM(5),U)]"",("Ff"[$P(VADM(5),U)) D
"RTN","RAO7NEW",100,0)
 . S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",101,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TX"_RAHLFS_"2000.33^Pregnant^AS4"_$$STR^RAO7UTL(2)_$S($P(RA0,U,13)="":"","Yy"[$P(RA0,U,13):"Y","Nn"[$P(RA0,U,13):"N",1:"U")
"RTN","RAO7NEW",102,0)
 . Q
"RTN","RAO7NEW",103,0)
 I +$P(RA0,U,9) D
"RTN","RAO7NEW",104,0)
 . S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",105,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"CE"_RAHLFS_"34^Contract Sharing/Source^99DD"_$$STR^RAO7UTL(2)_$P(RA0,U,9)_RAECH(1)_$P($G(^DIC(34,+$P(RA0,U,9),0)),U)
"RTN","RAO7NEW",106,0)
 . Q
"RTN","RAO7NEW",107,0)
 I RAR]"" D
"RTN","RAO7NEW",108,0)
 . S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",109,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TX"_RAHLFS_"^Research Source^"_$$STR^RAO7UTL(2)_RAR
"RTN","RAO7NEW",110,0)
 . Q
"RTN","RAO7NEW",111,0)
 I +$P(RA0,U,12) D
"RTN","RAO7NEW",112,0)
 . S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",113,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TS"_RAHLFS_"^Pre Op Scheduled Date/Time^"_$$STR^RAO7UTL(2)_$$HLDATE^HLFNC($P(RA0,U,12),"TS")
"RTN","RAO7NEW",114,0)
 . Q
"RTN","RAO7NEW",115,0)
 ; DG1 Segment
"RTN","RAO7NEW",116,0)
 ;*Billing Awareness Project:
"RTN","RAO7NEW",117,0)
 ;   Send Ordering ICD Dx data to CPRS: DG1 and related ZCL segments.
"RTN","RAO7NEW",118,0)
 I $D(RABWDX1) D
"RTN","RAO7NEW",119,0)
 . N RA1 S RA1=""
"RTN","RAO7NEW",120,0)
 . F  S RA1=$O(RABWDX1(RA1)) Q:RA1=""  D
"RTN","RAO7NEW",121,0)
 .. S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",122,0)
 .. S @(RAVAR_RATAB_")")=RABWDX1(RA1)
"RTN","RAO7NEW",123,0)
 . Q
"RTN","RAO7NEW",124,0)
 ;*
"RTN","RAO7NEW",125,0)
 K RAREASDY,VA,VADM,VAERR D MSG^RAO7UTL("RA EVSEND OR",.@RAVARBLE)
"RTN","RAO7NEW",126,0)
 Q
"RTN","RAO7PC1")
0^17^B26248522^B25997110
"RTN","RAO7PC1",1,0)
RAO7PC1 ;HISC/GJC,SS-Procedure Call utilities. ;12/9/02  08:41
"RTN","RAO7PC1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,16,18,26,36,45,75**;Mar 16, 1998;Build 4
"RTN","RAO7PC1",3,0)
 ;
"RTN","RAO7PC1",4,0)
EN1(RADFN,RABDT,RAEDT,RAEXN,RACINC) ;
"RTN","RAO7PC1",5,0)
 ;
"RTN","RAO7PC1",6,0)
 ; DBIA#2043 - Return list of exams within date range
"RTN","RAO7PC1",7,0)
 ;
"RTN","RAO7PC1",8,0)
 ; ** See routines RAO7PC1A and RAO7PC2 for additional comments **
"RTN","RAO7PC1",9,0)
 ; ** and output node descriptions                              **
"RTN","RAO7PC1",10,0)
 ;
"RTN","RAO7PC1",11,0)
 ; Input: RADFN-> Patient IEN        RABDT-> beginning date
"RTN","RAO7PC1",12,0)
 ;        RAEDT-> ending date        RAEXN-> max # of exams
"RTN","RAO7PC1",13,0)
 ;        RACINC-> include cancelled exams? (1 if yes, default no)
"RTN","RAO7PC1",14,0)
 ;
"RTN","RAO7PC1",15,0)
 ; Output:
"RTN","RAO7PC1",16,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID)=Procedure name^Case number^
"RTN","RAO7PC1",17,0)
 ;       Report status^Abnormal alert flag^Report ien^
"RTN","RAO7PC1",18,0)
 ;       Exam status order #~Exam status name^
"RTN","RAO7PC1",19,0)
 ;       Imaging location name^Imaging type abbr~
"RTN","RAO7PC1",20,0)
 ;       Imaging type name^abnormal results flag^CPT Code
"RTN","RAO7PC1",21,0)
 ;       ^CPRS Order ien^Images exist flag
"RTN","RAO7PC1",22,0)
 ;
"RTN","RAO7PC1",23,0)
 ;if there are one or more CPT modifiers:
"RTN","RAO7PC1",24,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CMOD",n)=CPT Mod^CPT Mod Name
"RTN","RAO7PC1",25,0)
 ;                                         n+1)=CPT Mod^CPT Mod Name
"RTN","RAO7PC1",26,0)
 ;
"RTN","RAO7PC1",27,0)
 ;if CPRS asks to display parent procs, and case is descendent of parent:
"RTN","RAO7PC1",28,0)
 ; ^TMP($J,"RAE1",Patient IEN,Exam ID,"CPRS")=memb of set^parent prc name
"RTN","RAO7PC1",29,0)
 ;
"RTN","RAO7PC1",30,0)
 ; Note: It is possible for the ^TMP global data returned to contain
"RTN","RAO7PC1",31,0)
 ;       'No Report' and a Report file ien for the same exam.  This is
"RTN","RAO7PC1",32,0)
 ;       because Imaging can create a report stub in the Report file,
"RTN","RAO7PC1",33,0)
 ;       but no report interpretation exists and no status is assigned
"RTN","RAO7PC1",34,0)
 ;       to the report record.
"RTN","RAO7PC1",35,0)
 ;
"RTN","RAO7PC1",36,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1",37,0)
 ; Abnormal alert flag:  Y or blank
"RTN","RAO7PC1",38,0)
 ; Abnormal results flag:  Y or blank, may be turned on even if
"RTN","RAO7PC1",39,0)
 ;     abnormal alert flag is not
"RTN","RAO7PC1",40,0)
 ;
"RTN","RAO7PC1",41,0)
 Q:'RADFN!('RABDT)!('RAEDT)
"RTN","RAO7PC1",42,0)
 N RAEXNP S RAEXNP=RAEXN ;save original value of RAEXN
"RTN","RAO7PC1",43,0)
 ; if last char RAEXNP has "P", then count max no. by parent and 
"RTN","RAO7PC1",44,0)
 ; single, not by individual cases
"RTN","RAO7PC1",45,0)
 S RACINC=+$G(RACINC)
"RTN","RAO7PC1",46,0)
 Q:RABDT>RAEDT  ; quit if ending date before beginning date
"RTN","RAO7PC1",47,0)
 K ^TMP($J,"RAE1") S RAEXN=+$G(RAEXN)
"RTN","RAO7PC1",48,0)
 S:$P(RABDT,".",2) RABDT=RABDT\1 S:$P(RAEDT,".",2) RAEDT=RAEDT\1
"RTN","RAO7PC1",49,0)
 N RABNOR,RACNST,RACNT,RACPT,RACSE,RADIAG,RAIBDT,RAIEDT,RAILOC,RAITY
"RTN","RAO7PC1",50,0)
 N RANO,RAPRC,RAREX,RARPT,RARPTST
"RTN","RAO7PC1",51,0)
 N RAXAM,RAXID,RAXIT,RAXSTAT,RABNORMR,RASHOCAN
"RTN","RAO7PC1",52,0)
 S RACNST=9999999.9999
"RTN","RAO7PC1",53,0)
 S RAIBDT=RACNST-(RAEDT+.9999),RAIEDT=RACNST-(RABDT-.0001)
"RTN","RAO7PC1",54,0)
 S (RACNT,RAXIT)=0
"RTN","RAO7PC1",55,0)
 F  S RAIBDT=$O(^RADPT(RADFN,"DT",RAIBDT)) Q:RAIBDT'>0!(RAIBDT>RAIEDT)  D  Q:RAXIT
"RTN","RAO7PC1",56,0)
 . D SETDATA^RAO7PC1A ; obtain exam data, set ^TMP($J,"RAE1",Patient IEN,Exam ID)
"RTN","RAO7PC1",57,0)
 . Q
"RTN","RAO7PC1",58,0)
 Q
"RTN","RAO7PC1",59,0)
EN2(RADFN) ;
"RTN","RAO7PC1",60,0)
 ;
"RTN","RAO7PC1",61,0)
 ; DBIA#2012 - Return last 7 days of non-cancelled exams
"RTN","RAO7PC1",62,0)
 ;
"RTN","RAO7PC1",63,0)
 ; Input: RADFN-> Patient IEN
"RTN","RAO7PC1",64,0)
 ;
"RTN","RAO7PC1",65,0)
 ; Output:
"RTN","RAO7PC1",66,0)
 ; ^TMP($J,"RAE7",Patient IEN,Exam ID)=procedure name^case number^
"RTN","RAO7PC1",67,0)
 ;       report status^imaging location IEN^imaging location name^
"RTN","RAO7PC1",68,0)
 ;       contrast medium or media used
"RTN","RAO7PC1",69,0)
 ;       Note: Single characters in parenthesis indicate contrast
"RTN","RAO7PC1",70,0)
 ;       involvement: (I)=Iodinated ionic; (N)=Iodinated non-ionic;
"RTN","RAO7PC1",71,0)
 ;        (L)=Gadolinium; (C)=Oral Cholecystographic; (G)=Gastrografin;
"RTN","RAO7PC1",72,0)
 ;        (B)=Barium; (M)=unspecified contrast media
"RTN","RAO7PC1",73,0)
 ;
"RTN","RAO7PC1",74,0)
 ; Exam ID: exam date/time (inverse) concatenated with the case IEN
"RTN","RAO7PC1",75,0)
 ;
"RTN","RAO7PC1",76,0)
 Q:'RADFN  D EN2^RAO7PC1A Q
"RTN","RAO7PC1",77,0)
 ;
"RTN","RAO7PC1",78,0)
EN3(X) ; DBIA#2265 - Return narrative text for exam(s)
"RTN","RAO7PC1",79,0)
 ; Input:
"RTN","RAO7PC1",80,0)
 ; X-> Exam id in one of two forms:
"RTN","RAO7PC1",81,0)
 ;   1) Pat. DFN^inv. exam date^Case IEN
"RTN","RAO7PC1",82,0)
 ;      Retrieves a single report for a single exam
"RTN","RAO7PC1",83,0)
 ;   2) Pat. DFN^inv. exam date^
"RTN","RAO7PC1",84,0)
 ;      Retrieves all reports for a set of exams ordered on one order
"RTN","RAO7PC1",85,0)
 ;
"RTN","RAO7PC1",86,0)
 ; Note:  Input delimiter can be any of the following: ^~\&;-
"RTN","RAO7PC1",87,0)
 ;        a delimiter may be a single space i.e, " "
"RTN","RAO7PC1",88,0)
 ;
"RTN","RAO7PC1",89,0)
 ; Output:
"RTN","RAO7PC1",90,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name)=report status^
"RTN","RAO7PC1",91,0)
 ; abnormal alert flag^CPRS Order ien^amended report?
"RTN","RAO7PC1",92,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"CM",n)=contrast
"RTN","RAO7PC1",93,0)
 ; media used during exam (internal)^contrast media used during exam
"RTN","RAO7PC1",94,0)
 ; (external)
"RTN","RAO7PC1",95,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"D",n)=diagnostic
"RTN","RAO7PC1",96,0)
 ; code (n=1, this is the primary code)
"RTN","RAO7PC1",97,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"H",n)=clin history
"RTN","RAO7PC1",98,0)
 ; (a line of text)
"RTN","RAO7PC1",99,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"I",n)=impression
"RTN","RAO7PC1",100,0)
 ; (a line of text)
"RTN","RAO7PC1",101,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"M",n)=modifier
"RTN","RAO7PC1",102,0)
 ; (external format)
"RTN","RAO7PC1",103,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"P")=primary
"RTN","RAO7PC1",104,0)
 ; interpreting staff IEN^primary interpreting resident IEN^date
"RTN","RAO7PC1",105,0)
 ; report entered
"RTN","RAO7PC1",106,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"R",n)=report
"RTN","RAO7PC1",107,0)
 ; (a line of text)
"RTN","RAO7PC1",108,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"RFS")=REASON
"RTN","RAO7PC1",109,0)
 ; FOR STUDY; the reason the study was conducted (a line of text)
"RTN","RAO7PC1",110,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"V",n)=verifier IEN
"RTN","RAO7PC1",111,0)
 ; ^signature block name
"RTN","RAO7PC1",112,0)
 ; ^TMP($J,"RAE2",Patient IEN,case IEN,procedure name,"TCOM",1)=techno-
"RTN","RAO7PC1",113,0)
 ; logist comment (a line of text)
"RTN","RAO7PC1",114,0)
 ; ^TMP($J,"RAE2",Patient IEN,"PRINT_SET")=null (IFF this is a printset)
"RTN","RAO7PC1",115,0)
 ; ^TMP($J,"RAE2",Patient IEN,"ORD")=name of ordered procedure for
"RTN","RAO7PC1",116,0)
 ;  examsets and printsets
"RTN","RAO7PC1",117,0)
 ; ^TMP($J,"RAE2",Patient IEN,"ORD",case IEN)=name of ordered procedure
"RTN","RAO7PC1",118,0)
 ;  for that case; not part of an examset or printset
"RTN","RAO7PC1",119,0)
 ;
"RTN","RAO7PC1",120,0)
 K RAU,^TMP($J,"RAE2") S RAU=$$DEL(X)
"RTN","RAO7PC1",121,0)
 I RAU="" K RAU Q
"RTN","RAO7PC1",122,0)
 Q:'$P(X,RAU)!('$P(X,RAU,2))  ; Quit if no Pat. DFN -or- no inv. exam DT
"RTN","RAO7PC1",123,0)
 N RACIEN,RADFN,RAINVXDT,RAPSET,Y S RAPSET=0
"RTN","RAO7PC1",124,0)
 S RADFN=$P(X,RAU),RAINVXDT=$P(X,RAU,2),RACIEN=+$P(X,RAU,3)
"RTN","RAO7PC1",125,0)
 K RAU Q:'($D(^RADPT(RADFN,"DT",RAINVXDT,0))#2)
"RTN","RAO7PC1",126,0)
SS I RACIEN D CASE^RAO7PC2(RACIEN) D SVTCOM^RAUTL11(RADFN,RAINVXDT,RACIEN) Q  ;P18 mod by SS
"RTN","RAO7PC1",127,0)
 S Y=0
"RTN","RAO7PC1",128,0)
 F  S Y=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y)) Q:Y'>0  D
"RTN","RAO7PC1",129,0)
 . D CASE^RAO7PC2(Y)
"RTN","RAO7PC1",130,0)
 . D SVTCOM^RAUTL11(RADFN,RAINVXDT,Y) ;P18 save TCOM in ^TMP
"RTN","RAO7PC1",131,0)
 . S RAPSET=0 ;P18 modified 
"RTN","RAO7PC1",132,0)
 . Q
"RTN","RAO7PC1",133,0)
 Q
"RTN","RAO7PC1",134,0)
 ;
"RTN","RAO7PC1",135,0)
EN30(RAOIFN) ; DBIA#2266 - Return narrative text for exam(s). To be used
"RTN","RAO7PC1",136,0)
 ; with the EN3 entry point above.
"RTN","RAO7PC1",137,0)
 ; Input: RAOIFN -> the ien of Rad/Nuc Med Order
"RTN","RAO7PC1",138,0)
 Q:'RAOIFN  ; order passed in as 0 or null
"RTN","RAO7PC1",139,0)
 Q:'$D(^RAO(75.1,RAOIFN,0))  ; no such order
"RTN","RAO7PC1",140,0)
 Q:'$D(^RADPT("AO",RAOIFN))  ; no exam associated with this order
"RTN","RAO7PC1",141,0)
 N RADFN,RADTI,RACNI,RAXSET
"RTN","RAO7PC1",142,0)
 S RADFN=+$O(^RADPT("AO",RAOIFN,0)) Q:'RADFN
"RTN","RAO7PC1",143,0)
 S RADTI=+$O(^RADPT("AO",RAOIFN,RADFN,0)) Q:'RADTI
"RTN","RAO7PC1",144,0)
 S RAXSET=+$P($G(^RADPT(RADFN,"DT",RADTI,0)),"^",5) ; set if RAXSET=1
"RTN","RAO7PC1",145,0)
 I RAXSET D EN3(RADFN_"^"_RADTI_"^") Q  ; exam set, hit EN3 code
"RTN","RAO7PC1",146,0)
 ; the following code is executed for non-exam set examinations
"RTN","RAO7PC1",147,0)
 S RACNI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI,0)) Q:'RACNI
"RTN","RAO7PC1",148,0)
 D EN3(RADFN_"^"_RADTI_"^"_RACNI)
"RTN","RAO7PC1",149,0)
 Q
"RTN","RAO7PC1",150,0)
EN4(RABBRV,RAARY) ; Return Imaging Locations
"RTN","RAO7PC1",151,0)
 ; Input: RABBRV-> Abbreviation for I-Type    RAARY-> data storage array
"RTN","RAO7PC1",152,0)
 ;
"RTN","RAO7PC1",153,0)
 ; Output:
"RTN","RAO7PC1",154,0)
 ; array name(location IEN)=File 79.1 IEN^File 44 name^division IEN
"RTN","RAO7PC1",155,0)
 ; ^division name
"RTN","RAO7PC1",156,0)
 ;
"RTN","RAO7PC1",157,0)
 Q:RABBRV']""  ; quit no I-Type abbreviation
"RTN","RAO7PC1",158,0)
 Q:RAARY']""  ;  quit no data storage array
"RTN","RAO7PC1",159,0)
 N RADIV,RAITY,RALOC,RAX
"RTN","RAO7PC1",160,0)
 S RAITY=+$O(^RA(79.2,"C",RABBRV,0)) Q:'RAITY
"RTN","RAO7PC1",161,0)
 S RAX=0 F  S RAX=$O(^RA(79.1,"BIMG",RAITY,RAX)) Q:RAX'>0  D
"RTN","RAO7PC1",162,0)
 . S RADIV(79)=$G(^RA(79.1,RAX,"DIV"))
"RTN","RAO7PC1",163,0)
 . S RALOC(0)=$G(^RA(79.1,RAX,0))
"RTN","RAO7PC1",164,0)
 . Q:$P(RALOC(0),"^",19)]""  ;inactive DT present, can't be a future DT
"RTN","RAO7PC1",165,0)
 . S RALOC=$P($G(^SC(+RALOC(0),0)),U)
"RTN","RAO7PC1",166,0)
 . S RALOC=$S(RALOC]"":RALOC,1:"Unknown")
"RTN","RAO7PC1",167,0)
 . S RADIV=+$P($G(^RA(79,+RADIV(79),0)),U),RADIV(4)=$G(^DIC(4,RADIV,0))
"RTN","RAO7PC1",168,0)
 . S RADIV=$S($P(RADIV(4),U)]"":$P(RADIV(4),U),1:"Unknown")
"RTN","RAO7PC1",169,0)
 . S @(RAARY_"("_RAX_")")=RAX_U_RALOC_U_+RADIV(79)_U_RADIV
"RTN","RAO7PC1",170,0)
 . Q
"RTN","RAO7PC1",171,0)
 Q
"RTN","RAO7PC1",172,0)
CASE(RAOIFN,RARRAY) ; Return the case numbers and the total number of
"RTN","RAO7PC1",173,0)
 ; case numbers associated with a particular order.
"RTN","RAO7PC1",174,0)
 ; Input: RAOIFN-order ien (75.1)
"RTN","RAO7PC1",175,0)
 ;        RARRAY-data storage (local array)
"RTN","RAO7PC1",176,0)
 ; Return: RATTL-n^x where n is the number of cases in the array
"RTN","RAO7PC1",177,0)
 ;               x=PRINTSET if a single report covers many cases.
"RTN","RAO7PC1",178,0)
 ;               -1 if error (invalid order ien)
"RTN","RAO7PC1",179,0)
 ;               -2 no registered case to date -OR- case(s) cancelled
"RTN","RAO7PC1",180,0)
 ;               If -1 or -2, second piece of RATTL gives the reason
"RTN","RAO7PC1",181,0)
 ;         RARRAY-local data array, array_name(case #)
"RTN","RAO7PC1",182,0)
 N RATTL S RATTL="" D CASE^RAO7PC1A
"RTN","RAO7PC1",183,0)
 Q RATTL
"RTN","RAO7PC1",184,0)
DEL(X) ; Determine the delimiter used to seperate the data
"RTN","RAO7PC1",185,0)
 ; Input: 'X'-> data seperated by a delimiter (first & second pieces
"RTN","RAO7PC1",186,0)
 ; will follow null)
"RTN","RAO7PC1",187,0)
 N Y,Z
"RTN","RAO7PC1",188,0)
 F Y="^","~","\","&",";","-"," " S Z=$F(X,Y) I +Z Q
"RTN","RAO7PC1",189,0)
 Q $S(+Z>0:Y,1:"") ; pass back the delimiter used, or null if not found
"RTN","RAO7PC2")
0^18^B44787869^B43565991
"RTN","RAO7PC2",1,0)
RAO7PC2 ;HISC/GJC-Part two for Return Narrative (EN3^RAO7PC1);1/17/95 ;9/13/01  10:39
"RTN","RAO7PC2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,11,14,16,22,27,45,75**;Mar 16, 1998;Build 4
"RTN","RAO7PC2",3,0)
CASE(Y) ; Retrieve exam data for specified inverse exam date range.
"RTN","RAO7PC2",4,0)
 ; 'Y'-> Exam node IEN
"RTN","RAO7PC2",5,0)
 N RABNOR,RACNT,RAEXAM,RAI,RAIMPRES,RAINCLUD,RAOPRC,RAORD,RAPDIAG
"RTN","RAO7PC2",6,0)
 N RAPIST,RAPIRE,RAPROC,RARDE,RADTI,RACNI,RADUPHX,RAREASDY
"RTN","RAO7PC2",7,0)
 N RARPT,RARPTST,RARPTXT,RASBN,RASDIAG,RAVER,RAERRFLG,Z,Z1,Z2
"RTN","RAO7PC2",8,0)
 S RACNT=1
"RTN","RAO7PC2",9,0)
 S RAEXAM(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,0)) Q:RAEXAM(0)']""
"RTN","RAO7PC2",10,0)
 S:$P(RAEXAM(0),"^",25)=2 RAPSET=1
"RTN","RAO7PC2",11,0)
 S:RAPSET=1 ^TMP($J,"RAE2",RADFN,"PRINT_SET")="" ; xam set with same rpt
"RTN","RAO7PC2",12,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RAEXAM(0),"^",2),0))
"RTN","RAO7PC2",13,0)
 S RAPROC=$S($P(RAPROC(0),"^")]"":$P(RAPROC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",14,0)
 S RAORD(0)=$G(^RAO(75.1,+$P(RAEXAM(0),"^",11),0))
"RTN","RAO7PC2",15,0)
 S RAORD(7)=$P(RAORD(0),"^",7) ; CPRS order ien
"RTN","RAO7PC2",16,0)
 S RAREASDY=$P($G(^RAO(75.1,+$P(RAEXAM(0),"^",11),.1)),"^") ;REASON FOR STUDY
"RTN","RAO7PC2",17,0)
 S RAOPRC(0)=$G(^RAMIS(71,+$P(RAORD(0),"^",2),0))
"RTN","RAO7PC2",18,0)
 S RAOPRC=$S($P(RAOPRC(0),"^")]"":$P(RAOPRC(0),"^"),1:"Unknown")
"RTN","RAO7PC2",19,0)
 S RAPDIAG(0)=$G(^RA(78.3,+$P(RAEXAM(0),"^",13),0))
"RTN","RAO7PC2",20,0)
 S RAPDIAG=$P(RAPDIAG(0),"^"),RARPT=+$P(RAEXAM(0),"^",17)
"RTN","RAO7PC2",21,0)
 S RARPT(0)=$G(^RARPT(RARPT,0)),RARPTST=$P(RARPT(0),"^",5)
"RTN","RAO7PC2",22,0)
 S RARPTST=$S(RARPTST="V":"Verified",RARPTST="R":"Released/Not verified",RARPTST="D":"Draft",RARPTST="PD":"Problem Draft",1:"No Report")
"RTN","RAO7PC2",23,0)
 ; set the following flag variable: RAINCLUD
"RTN","RAO7PC2",24,0)
 ; RAINCLUD=$S(RPT STATUS=verif'd or released/unverif'd:1,1:0)
"RTN","RAO7PC2",25,0)
 S RAINCLUD=$S("RV"[$E(RARPTST):1,1:0)
"RTN","RAO7PC2",26,0)
 I $E(RARPTST)="V",(RAPSET'<0) D
"RTN","RAO7PC2",27,0)
 . S RAVER=$P(RARPT(0),"^",9),RASBN=$P($G(^VA(200,+RAVER,20)),"^",2)
"RTN","RAO7PC2",28,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"V")=RAVER_"^"_RASBN
"RTN","RAO7PC2",29,0)
 . Q
"RTN","RAO7PC2",30,0)
 S RABNOR=$$UP^XLFSTR($P(RAPDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",31,0)
 I RAPDIAG]"",(RAINCLUD),(RAPSET'<0) D  ; if diag & verif'd or released/unverif'd & first pass if part of xam set (many xams - one rpt)
"RTN","RAO7PC2",32,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RAPDIAG
"RTN","RAO7PC2",33,0)
 . Q
"RTN","RAO7PC2",34,0)
 S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"RFS")=RAREASDY ;REASON FOR STUDY
"RTN","RAO7PC2",35,0)
 ; 1st, get clnhist from file70. 2nd, get addl clnhist form file74
"RTN","RAO7PC2",36,0)
 ; 1st:
"RTN","RAO7PC2",37,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",0)) D
"RTN","RAO7PC2",38,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",39,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z)) Q:Z'>0  D
"RTN","RAO7PC2",40,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",41,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"H",RAI)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"H",Z,0))
"RTN","RAO7PC2",42,0)
 .. Q
"RTN","RAO7PC2",43,0)
 . Q
"RTN","RAO7PC2",44,0)
 ;2nd:
"RTN","RAO7PC2",45,0)
 S RADTI=RAINVXDT,RACNI=Y D CHKDUPHX^RART1 ;chk if file74 clnhist is dupl
"RTN","RAO7PC2",46,0)
 I 'RADUPHX,$O(^RARPT(RARPT,"H",0)) S Z="H" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",47,0)
 ;
"RTN","RAO7PC2",48,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",0)) D  ; save modifiers
"RTN","RAO7PC2",49,0)
 . N RAI S (RAI,Z)=0
"RTN","RAO7PC2",50,0)
 . F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z)) Q:Z'>0  D
"RTN","RAO7PC2",51,0)
 .. S RAI=RAI+1
"RTN","RAO7PC2",52,0)
 .. S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"M",RAI)=$P($G(^RAMIS(71.2,+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"M",Z,0)),0)),"^")
"RTN","RAO7PC2",53,0)
 .. Q
"RTN","RAO7PC2",54,0)
 . Q
"RTN","RAO7PC2",55,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",0)),(RAPSET'<0) D
"RTN","RAO7PC2",56,0)
 . S Z=0 F  S Z=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z)) Q:Z'>0  D
"RTN","RAO7PC2",57,0)
 .. S RASDIAG=+$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"DX",Z,0))
"RTN","RAO7PC2",58,0)
 .. S RASDIAG(0)=$G(^RA(78.3,RASDIAG,0)),RASDIAG(1)=$P(RASDIAG(0),"^")
"RTN","RAO7PC2",59,0)
 .. I RASDIAG(1)]"",(RAINCLUD) D
"RTN","RAO7PC2",60,0)
 ... S RACNT=RACNT+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,"D",RACNT)=RASDIAG(1)
"RTN","RAO7PC2",61,0)
 ... I RABNOR'="Y" D
"RTN","RAO7PC2",62,0)
 .... S RABNOR=$$UP^XLFSTR($P(RASDIAG(0),"^",4)) S:RABNOR'="Y" RABNOR=""
"RTN","RAO7PC2",63,0)
 .... Q
"RTN","RAO7PC2",64,0)
 ... Q
"RTN","RAO7PC2",65,0)
 .. Q
"RTN","RAO7PC2",66,0)
 . Q
"RTN","RAO7PC2",67,0)
 I RAINCLUD,(RAPSET'<0) D
"RTN","RAO7PC2",68,0)
 . I +$O(^RARPT(RARPT,"I",0)) S Z="I" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",69,0)
 . I +$O(^RARPT(RARPT,"R",0)) S Z="R" D RPTXT(RARPT,Z)
"RTN","RAO7PC2",70,0)
 . Q
"RTN","RAO7PC2",71,0)
 I $P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD")=RAOPRC
"RTN","RAO7PC2",72,0)
 I '$P(RAEXAM(0),"^",25) S ^TMP($J,"RAE2",RADFN,"ORD",Y)=RAOPRC
"RTN","RAO7PC2",73,0)
 ;
"RTN","RAO7PC2",74,0)
 ; Check to see if amended report
"RTN","RAO7PC2",75,0)
 I RAPSET'<0,+$O(^RARPT(RARPT,"ERR",0)) S RAERRFLG="A"
"RTN","RAO7PC2",76,0)
 ;
"RTN","RAO7PC2",77,0)
 S:RAPSET'<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=RARPTST_"^"_$G(RABNOR)_"^"_$G(RAORD(7))_"^"_$G(RAERRFLG)
"RTN","RAO7PC2",78,0)
 S:RAPSET<0 ^TMP($J,"RAE2",RADFN,Y,RAPROC)=""
"RTN","RAO7PC2",79,0)
 S:RAPSET=1 RAPSET=-1
"RTN","RAO7PC2",80,0)
 ;
"RTN","RAO7PC2",81,0)
 I RARPTST'="No Report" D
"RTN","RAO7PC2",82,0)
 .; Add Prim Int Staff, Prim Int Resident & Reported Date
"RTN","RAO7PC2",83,0)
 .S RAPIST=$P(RAEXAM(0),"^",15)
"RTN","RAO7PC2",84,0)
 .S RAPIRE=$P(RAEXAM(0),"^",12)
"RTN","RAO7PC2",85,0)
 .S RARDE=$P(RARPT(0),"^",8)
"RTN","RAO7PC2",86,0)
 .S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"P")=RAPIST_"^"_RAPIRE_"^"_RARDE
"RTN","RAO7PC2",87,0)
 ;If contrast media was involved in the exam pass that information.
"RTN","RAO7PC2",88,0)
 I +$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",0)) S (RACNT,RAI)=0 D
"RTN","RAO7PC2",89,0)
 .F  S RAI=$O(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI)) Q:'RAI  D
"RTN","RAO7PC2",90,0)
 ..S RACNT=RACNT+1
"RTN","RAO7PC2",91,0)
 ..S RAI(0)=$G(^RADPT(RADFN,"DT",RAINVXDT,"P",Y,"CM",RAI,0))
"RTN","RAO7PC2",92,0)
 ..S ^TMP($J,"RAE2",RADFN,Y,RAPROC,"CM",RACNT)=$P(RAI(0),U)_"^"_$$EXTERNAL^DILFD(70.3225,.01,"",$P(RAI(0),U))
"RTN","RAO7PC2",93,0)
 ..Q
"RTN","RAO7PC2",94,0)
 Q
"RTN","RAO7PC2",95,0)
 ;
"RTN","RAO7PC2",96,0)
RPTXT(RARPT,Z) ; Retrieve report text & store in ^TMP
"RTN","RAO7PC2",97,0)
 ; 'RARPT' -> Report IEN
"RTN","RAO7PC2",98,0)
 ; 'Z'     -> "I":Impression Text <> "R":Report Text
"RTN","RAO7PC2",99,0)
 S (Z1,Z2)=0
"RTN","RAO7PC2",100,0)
 ;file 74's "H" nodes are now additional clinical history
"RTN","RAO7PC2",101,0)
 I Z="H" S Z2=$O(^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,""),-1) I $O(^RARPT(RARPT,Z,Z1)) S Z2=Z2+1,^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)="Additional Clinical History:"
"RTN","RAO7PC2",102,0)
 F  S Z1=$O(^RARPT(RARPT,Z,Z1)) Q:Z1'>0  D
"RTN","RAO7PC2",103,0)
 . S Z1(0)=$G(^RARPT(RARPT,Z,Z1,0)),Z2=Z2+1
"RTN","RAO7PC2",104,0)
 . S ^TMP($J,"RAE2",RADFN,Y,RAPROC,Z,Z2)=Z1(0)
"RTN","RAO7PC2",105,0)
 . Q
"RTN","RAO7PC2",106,0)
 Q
"RTN","RAO7PC2",107,0)
 ;
"RTN","RAO7PC2",108,0)
CLIN(DFN,PROCLIST) ;Radiology and Clinical Reminders API
"RTN","RAO7PC2",109,0)
 ;
"RTN","RAO7PC2",110,0)
 ; Created by Cameron Taylor March 1999
"RTN","RAO7PC2",111,0)
 ; 
"RTN","RAO7PC2",112,0)
 ; This API recieves a patient and a list of procedures. For each 
"RTN","RAO7PC2",113,0)
 ; Procedure, the details of the last 'complete' procedure and/or the
"RTN","RAO7PC2",114,0)
 ; last 'cancelled' & 'in progress' procedure details and returns them 
"RTN","RAO7PC2",115,0)
 ; in ^TMP($J,"RADPROC"
"RTN","RAO7PC2",116,0)
 N XX,PROC,DATE,STATUS,PROVIDER,EXAM,X,Y,EXAMIEN,RADPTIEN,ORDER,SUCCESS
"RTN","RAO7PC2",117,0)
 ; 
"RTN","RAO7PC2",118,0)
 S DFN=$G(DFN)  ; Patient Name
"RTN","RAO7PC2",119,0)
 S PROCLIST=$G(PROCLIST)  ; List of Procedures (separated by '^')
"RTN","RAO7PC2",120,0)
 K ^TMP($J,"RADPROC")
"RTN","RAO7PC2",121,0)
 ;
"RTN","RAO7PC2",122,0)
 S RADPTIEN=$O(^RADPT("B",DFN,""))
"RTN","RAO7PC2",123,0)
 I (RADPTIEN="")!(RADPTIEN=0) D  Q
"RTN","RAO7PC2",124,0)
 .S ^TMP($J,"RADPROC")="Invalid/Unknown Radiology Patient"
"RTN","RAO7PC2",125,0)
 ;
"RTN","RAO7PC2",126,0)
 F XX=1:1 S PROC=$P(PROCLIST,U,XX) Q:PROC=""  D
"RTN","RAO7PC2",127,0)
 .S SUCCESS=0  ; Quit searching if SUCCESS=3 (comp, canc & in prog)
"RTN","RAO7PC2",128,0)
 .S DATE=0 F  S DATE=$O(^RADPT(RADPTIEN,"DT",DATE)) Q:DATE'?7N1".".N!(SUCCESS=3)  D
"RTN","RAO7PC2",129,0)
 ..S EXAMIEN=0 F  S EXAMIEN=$O(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN)) Q:'EXAMIEN!(SUCCESS=3)  D
"RTN","RAO7PC2",130,0)
 ...S EXAM=$G(^RADPT(RADPTIEN,"DT",DATE,"P",EXAMIEN,0))
"RTN","RAO7PC2",131,0)
 ...Q:$P(EXAM,U,2)'=PROC
"RTN","RAO7PC2",132,0)
 ...;
"RTN","RAO7PC2",133,0)
 ...; Continue, get STATUS and ORDER 
"RTN","RAO7PC2",134,0)
 ...; (0 is cancelled, 1-8 in progress & 9 is COMPLETE)
"RTN","RAO7PC2",135,0)
 ...; (ignore if null)
"RTN","RAO7PC2",136,0)
 ...;
"RTN","RAO7PC2",137,0)
 ...S STATUS=$P(EXAM,U,3)
"RTN","RAO7PC2",138,0)
 ...I STATUS'="" D
"RTN","RAO7PC2",139,0)
 ....S ORDER=$P(^RA(72,STATUS,0),U,3)
"RTN","RAO7PC2",140,0)
 ....S STATUS=$P(^RA(72,STATUS,0),U) ; description
"RTN","RAO7PC2",141,0)
 ...; 
"RTN","RAO7PC2",142,0)
 ...; Only one of each type (ORDER)
"RTN","RAO7PC2",143,0)
 ...;
"RTN","RAO7PC2",144,0)
 ...Q:ORDER=""
"RTN","RAO7PC2",145,0)
 ...I ORDER=0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"CANCELLED"))  S ORDER="CANCELLED"
"RTN","RAO7PC2",146,0)
 ...I ORDER=9 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"COMPLETE"))  S ORDER="COMPLETE"
"RTN","RAO7PC2",147,0)
 ...I ORDER<9,ORDER>0 Q:$D(^TMP($J,"RADPROC",RADPTIEN,PROC,"IN PROGRESS"))  S ORDER="IN PROGRESS"
"RTN","RAO7PC2",148,0)
 ...;
"RTN","RAO7PC2",149,0)
 ...; Now for the PROVIDER. Check PRIMARY INTERPRETING STAFF 
"RTN","RAO7PC2",150,0)
 ...; if none, then default to PRIMARY INTERPRETING RESIDENT.
"RTN","RAO7PC2",151,0)
 ...;
"RTN","RAO7PC2",152,0)
 ...S PROVIDER=$P(EXAM,U,15)
"RTN","RAO7PC2",153,0)
 ...S:PROVIDER="" PROVIDER=$P(EXAM,U,12)
"RTN","RAO7PC2",154,0)
 ...S:PROVIDER'="" PROVIDER=$P($G(^VA(200,PROVIDER,0)),U,1) ; description
"RTN","RAO7PC2",155,0)
 ...;
"RTN","RAO7PC2",156,0)
 ...; Create return info. on ^TMP (1st manipulate DATE)
"RTN","RAO7PC2",157,0)
 ...;
"RTN","RAO7PC2",158,0)
 ...S Y=9999999.9999-DATE
"RTN","RAO7PC2",159,0)
 ...S ^TMP($J,"RADPROC",RADPTIEN,PROC,ORDER)=Y_U_STATUS_U_PROVIDER
"RTN","RAO7PC2",160,0)
 ...S SUCCESS=SUCCESS+1
"RTN","RAO7PC2",161,0)
 .;
"RTN","RAO7PC2",162,0)
 .; Finished searching Patient file. Any Procedures with no activity?
"RTN","RAO7PC2",163,0)
 .;
"RTN","RAO7PC2",164,0)
 .I '$D(^TMP($J,"RADPROC",RADPTIEN,PROC)) S ^TMP($J,"RADPROC",RADPTIEN,PROC,"NONE")=""
"RTN","RAO7PC2",165,0)
 Q
"RTN","RAO7PC2",166,0)
 ;
"RTN","RAO7RO")
0^23^B38944723^B37491814
"RTN","RAO7RO",1,0)
RAO7RO ;HISC/GJC,FPT-Request message from OE/RR. ;9/11/98  11:56
"RTN","RAO7RO",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**1,2,13,15,75**;Mar 16, 1998;Build 4
"RTN","RAO7RO",3,0)
 ;
"RTN","RAO7RO",4,0)
 ;------------------------- Variable List -------------------------------
"RTN","RAO7RO",5,0)
 ; RAFLG=flag indicates ORC reached     RAHLFS="|"
"RTN","RAO7RO",6,0)
 ; RAMSG=HL7 message passed in          RAORD=ORC-1 (Order control)
"RTN","RAO7RO",7,0)
 ; RAPLCHLD=Tracks place holder values for adding entries to sub-files
"RTN","RAO7RO",8,0)
 ;          in the Rad/Nuc Med Orders file.
"RTN","RAO7RO",9,0)
 ; RASEG=specific HL7 node              X=subscript of HL7 node
"RTN","RAO7RO",10,0)
 ; ----------------------------------------------------------------------
"RTN","RAO7RO",11,0)
 ;
"RTN","RAO7RO",12,0)
EN1(RAMSG) ; Pass in the message from OE/RR.  Decipher information.
"RTN","RAO7RO",13,0)
 ; new variables for RAO7RO processing
"RTN","RAO7RO",14,0)
 N A,AAH,ARR,CHAR,CNT,DFN,ERR,FLG,GMTSTYP,I,J,L,LEN,MSG,RA,RA0
"RTN","RAO7RO",15,0)
 N RA7003,RA71,RA713,RA783,RAA,RAB,RAC,RACLIN,RACMCODE,RACMNOR
"RTN","RAO7RO",16,0)
 N RACNT,RACOST,RACPT,RACPTIEN,RAD0,RADATA,RADBS,RADC,RADFN,RADUZ
"RTN","RAO7RO",17,0)
 N RAECH,RAEMSG,RAERR,RAFDA,RAFLG,RAFNAME,RAFNUM,RAHDR,RAHLFS
"RTN","RAO7RO",18,0)
 N RAIEN71,RAIL,RAIMGAB,RAIMGTYI,RAINCR,RAION,RAIT,RALDT,RALINEX,RALOC
"RTN","RAO7RO",19,0)
 N RAMFE,RAMODIEN,RAMSH3,RAMULT,RANEW,RANOW,RANSTAT,RAOBR18,RAOBR19
"RTN","RAO7RO",20,0)
 N RAOBR30,RAOBR4,RAOBX2,RAOBX3,RAOBX5,RAOIFN,RAORC1,RAORC10,RAORC11
"RTN","RAO7RO",21,0)
 N RAORC12,RAORC15,RAORC16,RAORC2,RAORC3,RAORC7,RAORC7D,RAORC7P
"RTN","RAO7RO",22,0)
 N RAORD,RAPGE,RAPLCHLD,RAPREG,RAPHYAP,RAPID3,RAPID5,RAPRCTY
"RTN","RAO7RO",23,0)
 N RAPV119,RAPV12,RAPV13,RAREA,RARMBED,RASEG,RASTATUS,RASUB
"RTN","RAO7RO",24,0)
 N RATSTMP,RAVAR,RAWARD,RAWP,RAX,RAXIT,RAXT71,RAY,RAZ,T1,T2,T3
"RTN","RAO7RO",25,0)
 N VAIP,X,Y,Y1,Y2,Y3,Y4,Y5,Z,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","RAO7RO",26,0)
 S X=^%ZOSF("ERRTN"),@^%ZOSF("TRAP")
"RTN","RAO7RO",27,0)
 S (RAFLG,X)=0,RAPLCHLD=1
"RTN","RAO7RO",28,0)
 D EN1^RAO7UTL ; setup field seperator data (see var list)
"RTN","RAO7RO",29,0)
 S RALDT=$$NOW^XLFDT() ; setup 'Last Activity Date/Time'
"RTN","RAO7RO",30,0)
 F  S X=$O(RAMSG(X)) Q:X'>0  D  Q:RAFLG
"RTN","RAO7RO",31,0)
 . S RASEG=$G(RAMSG(X)) Q:$P(RASEG,RAHLFS)'="ORC"  ; quit if not ORC
"RTN","RAO7RO",32,0)
 . S RAORD=$P(RASEG,RAHLFS,2),RAFLG=1
"RTN","RAO7RO",33,0)
 . Q
"RTN","RAO7RO",34,0)
 I RAORD'="NW"&(RAORD'="DC")&(RAORD'="NA")&(RAORD'="DE")&(RAORD'="Z@") D BRKOUT^RAO7UTL1,REJ^RAO7OKS("OC","Missing/Invalid Order Control") Q
"RTN","RAO7RO",35,0)
 I RAORD="NW" D EN1^RAO7RON(.RAMSG) D
"RTN","RAO7RO",36,0)
 .I $G(RAERR) D  Q
"RTN","RAO7RO",37,0)
 ..S RAERR1="" I RAERR=35 I $G(RANOW) S RAERR1="Now="_RANOW
"RTN","RAO7RO",38,0)
 ..I RAERR=35 S RAERR1=RAERR1_" Req Entered Dt="_$G(RAORC15)
"RTN","RAO7RO",39,0)
 ..S RAERR=$$EN1^RAO7RO1(RAERR)_" "_$G(RAERR1) K RAERR1
"RTN","RAO7RO",40,0)
 ..D REJ^RAO7OKS("OC",RAERR) Q
"RTN","RAO7RO",41,0)
 .;if CLINICAL HISTORY was passed from CPRS and it failed the CLINICAL HISTORY data
"RTN","RAO7RO",42,0)
 .;requirements, reject the message
"RTN","RAO7RO",43,0)
 .I $P(RACLIN,U)=1,$P(RACLIN,U,2)'=1 S RAERR=$$EN1^RAO7RO1(15) D REJ^RAO7OKS("OC",RAERR) Q
"RTN","RAO7RO",44,0)
 .K ERR
"RTN","RAO7RO",45,0)
 .; Update 'REQUEST STATUS TIMES' multiple if parameter dictates!
"RTN","RAO7RO",46,0)
 .I "Yy"[RADIV(.119) D
"RTN","RAO7RO",47,0)
 ..; make sure that the activity log place holders differ from the
"RTN","RAO7RO",48,0)
 ..; modifiers place holders
"RTN","RAO7RO",49,0)
 ..S RAPLCHLD=RAPLCHLD+1
"RTN","RAO7RO",50,0)
 ..S RANEW(75.12,"+"_RAPLCHLD_",+1,",.01)=RALDT
"RTN","RAO7RO",51,0)
 ..S RANEW(75.12,"+"_RAPLCHLD_",+1,",2)=5
"RTN","RAO7RO",52,0)
 ..S RANEW(75.12,"+"_RAPLCHLD_",+1,",3)=+RAORC10
"RTN","RAO7RO",53,0)
 ..Q
"RTN","RAO7RO",54,0)
 .D UPDATE^DIE("","RANEW","RAORC3","ERR") S RAORC3=+$G(RAORC3(1))
"RTN","RAO7RO",55,0)
 .S RAORC3=$G(RAORC3)_"^RA"
"RTN","RAO7RO",56,0)
 .I $D(ERR) S RAERR=$$EN1^RAO7RO1(21) D REJ^RAO7OKS("OC",RAERR) Q
"RTN","RAO7RO",57,0)
 .D WP^DIE(75.1,+RAORC3_",",400,"K","^TMP(""RAWP"",$J)","ERR")
"RTN","RAO7RO",58,0)
 .D ACC^RAO7OKS("OK","","","","")
"RTN","RAO7RO",59,0)
 .; Prt request on im'g loc req prtr; if no im'g loc on the HL7 msg
"RTN","RAO7RO",60,0)
 .; check for prtr on first entry in Im'g Loc file; if no prtr on
"RTN","RAO7RO",61,0)
 .; first entry, don't print request
"RTN","RAO7RO",62,0)
 . S RAO751=$G(^RAO(75.1,+RAORC3,0))
"RTN","RAO7RO",63,0)
 . D:$P(RAO751,"^",6)=1!($P(RAO751,"^",6)=2) OENO^RAUTL19(+RAORC3)
"RTN","RAO7RO",64,0)
 . K RAO751 ; fire off 'stat' or 'urgent' alert if order qualifies
"RTN","RAO7RO",65,0)
 . ; print the request
"RTN","RAO7RO",66,0)
 . I +RAOBR19(3)>0 S RAION=$P($G(^RA(79.1,+RAOBR19(3),0)),U,16)
"RTN","RAO7RO",67,0)
 . ;I +RAOBR19(3)=0 S RAION=$P($G(^RA(79.1,+$O(^RA(79.1,0)),0)),U,16)
"RTN","RAO7RO",68,0)
 . I +RAOBR19(3)=0 D  S:RAION="" RAION=$P($G(^RA(79.1,+$O(^RA(79.1,0)),0)),U,16)
"RTN","RAO7RO",69,0)
 .. S (RALOC,RAION)=""
"RTN","RAO7RO",70,0)
 .. ; Get Imaging Type of Procedure..
"RTN","RAO7RO",71,0)
 .. S RAIMGTYI=$P(^RAMIS(71,RAOBR4(4),0),U,12) Q:RAIMGTYI=""
"RTN","RAO7RO",72,0)
 .. F  S RALOC=$O(^RA(79.1,"BIMG",RAIMGTYI,RALOC)) Q:RALOC=""  D  Q:RAION]""
"RTN","RAO7RO",73,0)
 ... ; Find Imaging Location within Imaging Type with Request device..
"RTN","RAO7RO",74,0)
 ... Q:$P(^RA(79.1,RALOC,0),U,16)=""
"RTN","RAO7RO",75,0)
 ... Q:^RA(79.1,RALOC,"DIV")'=+$$KSP^XUPARAM("INST")
"RTN","RAO7RO",76,0)
 ... S RAION=$P(^RA(79.1,RALOC,0),U,16)
"RTN","RAO7RO",77,0)
 . I RAION]"" D
"RTN","RAO7RO",78,0)
 .. D PSETUP Q:RAION']""
"RTN","RAO7RO",79,0)
 .. S ZTDTH=$H,ZTRTN="PRHS^RAO7RO",ZTIO=RAION
"RTN","RAO7RO",80,0)
 .. S ZTDESC="Rad/Nuc Med Request print - frontdoor (CPRS)"
"RTN","RAO7RO",81,0)
 .. D ^%ZTLOAD,HOME^%ZIS
"RTN","RAO7RO",82,0)
 .. K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","RAO7RO",83,0)
 .. Q
"RTN","RAO7RO",84,0)
 . Q
"RTN","RAO7RO",85,0)
 ;
"RTN","RAO7RO",86,0)
 I RAORD="Z@" N RAPUROK D EN2^RAO7PURG(.RAMSG) D  ; RAPUROK set in
"RTN","RAO7RO",87,0)
 . ; EN2^RAO7PURG.  If RAPUROK=1 send ok msg, else send reject msg
"RTN","RAO7RO",88,0)
 . I $G(RAERR) D REJ^RAO7OKS("ZU","") Q
"RTN","RAO7RO",89,0)
 . D:'RAPUROK REJ^RAO7OKS("ZU","")
"RTN","RAO7RO",90,0)
 . D:RAPUROK ACC^RAO7OKS("ZR","","","","")
"RTN","RAO7RO",91,0)
 . Q
"RTN","RAO7RO",92,0)
 I RAORD="DC" D EN1^RAO7RCH(.RAMSG) D
"RTN","RAO7RO",93,0)
 .I $G(RAERR) S RAERR=$$EN1^RAO7RO1(RAERR) D REJ^RAO7OKS("UD",RAERR) Q
"RTN","RAO7RO",94,0)
 .K ERR D FILE^DIE("K","RANEW","ERR")
"RTN","RAO7RO",95,0)
 .I $D(ERR) S RAERR=$$EN1^RAO7RO1(37) D REJ^RAO7OKS("UD",RAERR) Q
"RTN","RAO7RO",96,0)
 .D OE3^RABUL(+RAORC3) ; rad/nuc med request cancelled bulletin
"RTN","RAO7RO",97,0)
 .I "Yy"[RADIV(.119) D  Q:$G(RAERR)
"RTN","RAO7RO",98,0)
 ..N ERR
"RTN","RAO7RO",99,0)
 ..S ERR=$$EN5^RAO7VLD(+RAORC3,1,+RAORC10,"")
"RTN","RAO7RO",100,0)
 ..I +$G(ERR) S RAERR=$$EN1^RAO7RO1(30) D REJ^RAO7OKS("UD",RAERR) Q
"RTN","RAO7RO",101,0)
 ..Q
"RTN","RAO7RO",102,0)
 .D ACC^RAO7OKS("DR","","","","")
"RTN","RAO7RO",103,0)
 .; print out the cancelled request
"RTN","RAO7RO",104,0)
 .S RAIMJLOC=+$P($G(^RAO(75.1,+RAORC3,0)),"^",20)
"RTN","RAO7RO",105,0)
 .I RAIMJLOC>0 S RAION=$P($G(^RA(79.1,RAIMJLOC,0)),U,24)
"RTN","RAO7RO",106,0)
 .I RAIMJLOC=0 S RAION=$P($G(^RA(79.1,+$O(^RA(79.1,0)),0)),U,24)
"RTN","RAO7RO",107,0)
 .I RAION]"" D
"RTN","RAO7RO",108,0)
 ..D PSETUP Q:RAION']""
"RTN","RAO7RO",109,0)
 ..S RACRHD="" ; set the cancelled request flag
"RTN","RAO7RO",110,0)
 ..S ZTDESC="Rad/Nuc Med Cancelled Request print - frontdoor (CPRS)"
"RTN","RAO7RO",111,0)
 ..S ZTIO=RAION,ZTDTH=$H,ZTRTN="PRHS^RAO7RO",ZTSAVE("RACRHD")=""
"RTN","RAO7RO",112,0)
 ..D ^%ZTLOAD,HOME^%ZIS
"RTN","RAO7RO",113,0)
 ..K RACRHD,RAIMJLOC,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","RAO7RO",114,0)
 ..Q
"RTN","RAO7RO",115,0)
 .Q
"RTN","RAO7RO",116,0)
 ;
"RTN","RAO7RO",117,0)
 ;For an order control of: 'NA', we error if one of these three
"RTN","RAO7RO",118,0)
 ;conditions are true:
"RTN","RAO7RO",119,0)
 ;1) if the ien of the Rad/Nuc Med Order is not valid
"RTN","RAO7RO",120,0)
 ;2) patient file pointer (PID3) evaluates to a different
"RTN","RAO7RO",121,0)
 ;   patient name than the PID5 value
"RTN","RAO7RO",122,0)
 ;3) cannot file oerr order ien into file 75.1
"RTN","RAO7RO",123,0)
 ;
"RTN","RAO7RO",124,0)
 I RAORD="NA" D EN1^RAO7OKR(.RAMSG) I $G(RAERR) D
"RTN","RAO7RO",125,0)
 . N RATXT S RATXT="Error for order control: 'NA'"
"RTN","RAO7RO",126,0)
 . S:RAERR'?1N.N RAERR="error not found in our error table"
"RTN","RAO7RO",127,0)
 . S:RAERR?1N.N RAERR=$$EN1^RAO7RO1(RAERR)
"RTN","RAO7RO",128,0)
 . S:$D(XQY0)#2 RAVAR("XQY0")="" S RAVAR("RAERR")=""
"RTN","RAO7RO",129,0)
 . D ERR^RAO7UTL(RATXT,.RAMSG,.RAVAR)
"RTN","RAO7RO",130,0)
 . Q
"RTN","RAO7RO",131,0)
 ;if order control of 'DE', CPRS files data into their OE/RR Errors file
"RTN","RAO7RO",132,0)
 ;I RAORD="DE"
"RTN","RAO7RO",133,0)
 ;purge DBS specific variables before exiting
"RTN","RAO7RO",134,0)
 ;
"RTN","RAO7RO",135,0)
PURGE ; kill & quit
"RTN","RAO7RO",136,0)
 D CLEAN^DILF
"RTN","RAO7RO",137,0)
 K ^TMP("RAWP",$J)
"RTN","RAO7RO",138,0)
 Q
"RTN","RAO7RO",139,0)
PRHS ; print request and/or health summary
"RTN","RAO7RO",140,0)
 U IO D ^RAORD5 ; print the request
"RTN","RAO7RO",141,0)
 S:'$D(RACRHD) GMTSTYP=$P($G(^RAMIS(71,+$G(RAOBR4(4)),0)),U,13)
"RTN","RAO7RO",142,0)
 I +$G(GMTSTYP) D  ; don't print Health Summary with cancelled requests
"RTN","RAO7RO",143,0)
 . W:$Y @IOF D ENX^GMTSDVR(RADFN,GMTSTYP)
"RTN","RAO7RO",144,0)
 . Q
"RTN","RAO7RO",145,0)
 W ! D CLOSE^RAUTL
"RTN","RAO7RO",146,0)
 Q
"RTN","RAO7RO",147,0)
PSETUP ; Define the variables needed to print cancelled and non-cancelled
"RTN","RAO7RO",148,0)
 ; requests from the frontdoor (CPRS).
"RTN","RAO7RO",149,0)
 I RAION'?1N.N S RAION=$O(^%ZIS(1,"B",RAION,0)) Q:RAION']""
"RTN","RAO7RO",150,0)
 S RAION=$P($G(^%ZIS(1,RAION,0)),"^") Q:RAION']""
"RTN","RAO7RO",151,0)
 S RAOIFN=+RAORC3,RAPAGE=0,RAX="",RADFN=RAPID3
"RTN","RAO7RO",152,0)
 N RAFOERR S RAFOERR="" ; flag to indicate entry from frontdoor (CPRS)
"RTN","RAO7RO",153,0)
 F RAI="RADFN","RAOIFN","RAX","RAPGE","RAOBR4(","RAFOERR" S ZTSAVE(RAI)=""
"RTN","RAO7RO",154,0)
 S:$D(RAIL) ZTSAVE("RAIL")=""
"RTN","RAO7RO",155,0)
 Q
"RTN","RAO7RO1")
0^13^B7990676^B7615493
"RTN","RAO7RO1",1,0)
RAO7RO1 ;HISC/FPT-RAD/NM Error Messages ;8/28/97  14:16
"RTN","RAO7RO1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**2,75**;Mar 16, 1998;Build 4
"RTN","RAO7RO1",3,0)
 ;
"RTN","RAO7RO1",4,0)
EN1(RAERR) ; errors encountered with OE v3.0 back & frontdoor transmission
"RTN","RAO7RO1",5,0)
 S RAEMSG=$P($T(MSG+RAERR),";",4)
"RTN","RAO7RO1",6,0)
 I RAEMSG]"" Q RAEMSG
"RTN","RAO7RO1",7,0)
 Q "Error # "_RAERR_" does not exist"
"RTN","RAO7RO1",8,0)
 ;
"RTN","RAO7RO1",9,0)
MSG ; error messages
"RTN","RAO7RO1",10,0)
 ;;1;Missing/Invalid Order Control
"RTN","RAO7RO1",11,0)
 ;;2;Missing/Invalid Patient ID
"RTN","RAO7RO1",12,0)
 ;;3;Missing/Invalid Patient Location
"RTN","RAO7RO1",13,0)
 ;;4;Missing/Invalid User DUZ
"RTN","RAO7RO1",14,0)
 ;;5;Missing/Invalid REQUEST URGENCY
"RTN","RAO7RO1",15,0)
 ;;6;Missing/Invalid REQUESTING PHYSICIAN
"RTN","RAO7RO1",16,0)
 ;;7;Entered Date/Time is in the Future
"RTN","RAO7RO1",17,0)
 ;;8;Invalid Procedure, Inactive, no Imaging Type or no Procedure Type
"RTN","RAO7RO1",18,0)
 ;;9;Patient Class disagrees with Patient Location
"RTN","RAO7RO1",19,0)
 ;;10;Invalid ISOLATION PROCEDURES
"RTN","RAO7RO1",20,0)
 ;;11;Invalid MODIFIER(s)
"RTN","RAO7RO1",21,0)
 ;;12;Missing/Invalid IMAGING LOCATION or not the same as procedure's
"RTN","RAO7RO1",22,0)
 ;;13;Missing/Invalid MODE OF TRANSPORT
"RTN","RAO7RO1",23,0)
 ;;14;Missing/Invalid PREGNANT value
"RTN","RAO7RO1",24,0)
 ;;15;Missing/Invalid CLINICAL HISTORY FOR EXAM
"RTN","RAO7RO1",25,0)
 ;;16;Missing/Invalid Placer Number
"RTN","RAO7RO1",26,0)
 ;;17;Missing/Invalid OBX Value Type
"RTN","RAO7RO1",27,0)
 ;;18;Missing/Invalid CONTRACT/SHARING SOURCE
"RTN","RAO7RO1",28,0)
 ;;19;Missing/Invalid RESEARCH SOURCE
"RTN","RAO7RO1",29,0)
 ;;20;Missing/Invalid PRE-OP SCHEDULED DATE/TIME
"RTN","RAO7RO1",30,0)
 ;;21;Error Filing New Entry
"RTN","RAO7RO1",31,0)
 ;;22;Missing/Invalid Filler Number
"RTN","RAO7RO1",32,0)
 ;;23;Missing/Invalid Cancel or Hold Reason
"RTN","RAO7RO1",33,0)
 ;;24;
"RTN","RAO7RO1",34,0)
 ;;25;Current status will not permit request to be put in DISCONTINUED status
"RTN","RAO7RO1",35,0)
 ;;26;Error filing Placer Number
"RTN","RAO7RO1",36,0)
 ;;27;Missing/Invalid CATEGORY OF EXAM
"RTN","RAO7RO1",37,0)
 ;;28;Invalid REQUEST DATE (TIME optional)
"RTN","RAO7RO1",38,0)
 ;;29;CATEGORY OF EXAM cannot be Research AND Contract/Sharing
"RTN","RAO7RO1",39,0)
 ;;30;Error Filing New Entry in Request Status Times multiple
"RTN","RAO7RO1",40,0)
 ;;31;Imaging Type mismatch between the Procedure and Imaging Location
"RTN","RAO7RO1",41,0)
 ;;32;Parent procedure does not have descendents
"RTN","RAO7RO1",42,0)
 ;;33;Imaging Type mismatch between the Procedure and MODIFIER(s)
"RTN","RAO7RO1",43,0)
 ;;34;Invalid MODFIERS(s) for a series procedure
"RTN","RAO7RO1",44,0)
 ;;35;FileMan rejected date/time
"RTN","RAO7RO1",45,0)
 ;;36;Invalid Approving Rad/Nuc Med physician
"RTN","RAO7RO1",46,0)
 ;;37;Rad/Nuc Med order not placed in a DISCONTINUED status
"RTN","RAO7RO1",47,0)
 ;;38;Missing REASON FOR STUDY value
"RTN","RAO7RO1",48,0)
 ;;39;Invalid REASON FOR STUDY value
"RTN","RAO7RON")
0^24^B14011011^B14133845
"RTN","RAO7RON",1,0)
RAO7RON ;HISC/GJC- Request message from OE/RR. (frontdoor) ;2/2/98  12:34
"RTN","RAO7RON",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41,75**;Mar 16, 1998;Build 4
"RTN","RAO7RON",3,0)
 ;
"RTN","RAO7RON",4,0)
 ;------------------------- Variable List -------------------------------
"RTN","RAO7RON",5,0)
 ; RADATA=HL7 data minus seg. hdr    RAHDR=Segment header
"RTN","RAO7RON",6,0)
 ; RAHLFS="|"                        RAMSG=HL7 message passed in
"RTN","RAO7RON",7,0)
 ; RAOBR12=danger code               RAOBR18=modifier
"RTN","RAO7RON",8,0)
 ; RAOBR19=hosp. loc. pntr (44)      RAOBR30=trans. mode
"RTN","RAO7RON",9,0)
 ; RAOBR4=univ. trans. mode          RAOBX2=format of observ. value
"RTN","RAO7RON",10,0)
 ; RAOBX3=observ. ID                 RAOBX5=observ. value
"RTN","RAO7RON",11,0)
 ; RAORC1=order control              RAORC10=entered by (200)
"RTN","RAO7RON",12,0)
 ; RAORC11=approving rad/nm phys (for some procedures only)
"RTN","RAO7RON",13,0)
 ; RAORC12=ordering provider (200)   RAORC15=order effective D/T
"RTN","RAO7RON",14,0)
 ; RAORC16=order control reason      RAORC2=placer order #_"^OR"
"RTN","RAO7RON",15,0)
 ; RAORC3=filler order #_"^RA"       RAORC7=start dt/freq. of service
"RTN","RAO7RON",16,0)
 ; RAPID3=patient ID                 RAPID5=patient name (2)
"RTN","RAO7RON",17,0)
 ; RAPV119=visit #                   RAPV12=patient class
"RTN","RAO7RON",18,0)
 ; RAPV13=patient location (44)      RASEG=message seg. including header
"RTN","RAO7RON",19,0)
 ; ----------------------------------------------------------------------
"RTN","RAO7RON",20,0)
EN1(RAMSG) ; Pass in the message from RAO7RO.  Decipher information.
"RTN","RAO7RON",21,0)
 D BRKOUT^RAO7UTL1
"RTN","RAO7RON",22,0)
 ; defines RAORC2, RAORC3, RAPID3, RAPID5, RAMSH3 & RADIV(.119)
"RTN","RAO7RON",23,0)
 S (RAERR,RAWP,RALINEX)=0,RACLIN="^" K ^TMP("RAWP",$J)
"RTN","RAO7RON",24,0)
 F  S RALINEX=$O(RAMSG(RALINEX)) Q:RALINEX'>0  D  Q:RAERR
"RTN","RAO7RON",25,0)
 . S RASEG=$G(RAMSG(RALINEX)) Q:$P(RASEG,RAHLFS)="MSH"  ; quit if MSH segment
"RTN","RAO7RON",26,0)
 . S RAHDR=$P(RASEG,RAHLFS),RADATA=$P(RASEG,RAHLFS,2,999)
"RTN","RAO7RON",27,0)
 . D @$S(RAHDR="PID":"PID",RAHDR="PV1":"PV1",RAHDR="ORC":"ORC",RAHDR="OBR":"OBR^RAO7RON1",RAHDR="OBX":"OBX^RAO7RON1",RAHDR="DG1":"GETCPRS^RABWORD1",RAHDR="ZCL":"GETCPRS^RABWORD1",1:"ERR")
"RTN","RAO7RON",28,0)
 . Q
"RTN","RAO7RON",29,0)
 S RANEW(75.1,"+1,",18)=RALDT
"RTN","RAO7RON",30,0)
 Q
"RTN","RAO7RON",31,0)
PID ; breakdown the 'PID' segment
"RTN","RAO7RON",32,0)
 S RAERR=$$EN2^RAO7VLD(2,RAPID3,RAPID5) S:RAERR RAERR=2
"RTN","RAO7RON",33,0)
 I 'RAERR S RANEW(75.1,"+1,",.01)=RAPID3
"RTN","RAO7RON",34,0)
 Q
"RTN","RAO7RON",35,0)
PV1 ; breakdown the 'PV1' segment
"RTN","RAO7RON",36,0)
 S RAPV12=$P(RADATA,RAHLFS,2)
"RTN","RAO7RON",37,0)
 S RAERR=$$EN1^RAO7VLD(75.1,4,"E",RAPV12,"RASULT","") S:RAERR RAERR=27 Q:RAERR
"RTN","RAO7RON",38,0)
 S RANEW(75.1,"+1,",4)=RAPV12
"RTN","RAO7RON",39,0)
 S RAPV13=$P(RADATA,RAHLFS,3)
"RTN","RAO7RON",40,0)
 S RAERR=$$EN3^RAO7VLD(44,+RAPV13) S:RAERR RAERR=3 Q:RAERR
"RTN","RAO7RON",41,0)
 S RANEW(75.1,"+1,",22)=+RAPV13
"RTN","RAO7RON",42,0)
 I RAPV12="I",$P(^SC($P(RAPV13,U,1),0),U,3)'="W" S RAERR=9 Q:RAERR
"RTN","RAO7RON",43,0)
 I RAPV12="O",$P(^SC($P(RAPV13,U,1),0),U,3)="W" S RAERR=9 Q:RAERR
"RTN","RAO7RON",44,0)
 S RAPV119=$P(RADATA,RAHLFS,19)
"RTN","RAO7RON",45,0)
 Q
"RTN","RAO7RON",46,0)
ORC ; breakdown the 'ORC' segment
"RTN","RAO7RON",47,0)
 ; RAORC7D is: timestamp HL7 format
"RTN","RAO7RON",48,0)
 ; RAORC7P is: priority/urgency
"RTN","RAO7RON",49,0)
 S:+RAORC2'>0 RAERR=16 Q:RAERR
"RTN","RAO7RON",50,0)
 S RANEW(75.1,"+1,",7)=+RAORC2
"RTN","RAO7RON",51,0)
 S RANEW(75.1,"+1,",5)=5
"RTN","RAO7RON",52,0)
 S RAORC7=$P(RADATA,RAHLFS,7)
"RTN","RAO7RON",53,0)
 S RAORC7D=$P(RAORC7,RAECH(1),4)
"RTN","RAO7RON",54,0)
 S RAORC7D=$$FMDATE^HLFNC(RAORC7D)
"RTN","RAO7RON",55,0)
 S RAERR=$$EN1^RAO7VLD(75.1,21,"E",RAORC7D,"RASULT","") S:RAERR RAERR=28 Q:RAERR
"RTN","RAO7RON",56,0)
 S RANEW(75.1,"+1,",21)=RAORC7D
"RTN","RAO7RON",57,0)
 S X=$P(RAORC7,RAECH(1),6)
"RTN","RAO7RON",58,0)
 S RAORC7P=$S(X="S":1,X="A":2,X="R":9,1:"") I +RAORC7P'>0 S RAERR=5 Q
"RTN","RAO7RON",59,0)
 S RANEW(75.1,"+1,",6)=RAORC7P
"RTN","RAO7RON",60,0)
 S RAORC10=$P(RADATA,RAHLFS,10)
"RTN","RAO7RON",61,0)
 S RAERR=$$EN3^RAO7VLD(200,RAORC10) S:RAERR RAERR=4 Q:RAERR
"RTN","RAO7RON",62,0)
 S RANEW(75.1,"+1,",15)=RAORC10
"RTN","RAO7RON",63,0)
 S RAORC11=$P(RADATA,RAHLFS,11) ;approving rad/nm phys for some proc's
"RTN","RAO7RON",64,0)
 I $G(RAORC11) S RAERR=$$EN3^RAO7VLD(200,RAORC11) S:RAERR RAERR=36 Q:RAERR
"RTN","RAO7RON",65,0)
 I $G(RAORC11) S RANEW(75.1,"+1,",8)=RAORC11
"RTN","RAO7RON",66,0)
 S RAORC12=$P(RADATA,RAHLFS,12)
"RTN","RAO7RON",67,0)
 S RAERR=$$EN3^RAO7VLD(200,RAORC12) S:RAERR RAERR=6 Q:RAERR
"RTN","RAO7RON",68,0)
 S RANEW(75.1,"+1,",14)=RAORC12
"RTN","RAO7RON",69,0)
 S RAORC15=$P(RADATA,RAHLFS,15)
"RTN","RAO7RON",70,0)
 S RAORC15=$$FMDATE^HLFNC(RAORC15)
"RTN","RAO7RON",71,0)
 ;The order entered dt/time validity ck results are ignored because we
"RTN","RAO7RON",72,0)
 ;have never been able to determine why FileMan erroneously rejects
"RTN","RAO7RON",73,0)
 ;some date/times in a Silent FM call.  We now assume this date is OK.
"RTN","RAO7RON",74,0)
 S RAERR=$$EN1^RAO7VLD(75.1,16,"E",RAORC15,"RASULT","") S:RAERR RAERR=35
"RTN","RAO7RON",75,0)
 ;Q:RAERR
"RTN","RAO7RON",76,0)
 I RAERR D  S RAERR=0
"RTN","RAO7RON",77,0)
 . N I,RAX,RAVARS,RAERRDT
"RTN","RAO7RON",78,0)
 . S RAX=$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","RAO7RON",79,0)
 . S RAERRDT=$$NOW^XLFDT()
"RTN","RAO7RON",80,0)
 . F I="RAX","RAORC15","RAERRDT","RAERR" S RAVARS(I)=""
"RTN","RAO7RON",81,0)
 . S:$D(X) RAVARS("X")="" S:$D(%DT) RAVARS("%DT")=""
"RTN","RAO7RON",82,0)
 . S:$D(%DT(0)) RAVARS("%DT(0)")=""
"RTN","RAO7RON",83,0)
 . ;S RAVARS("RAX")="",RAVARS("RAORC15")="",RAVARS("RAERRDT")="",RAVARS("RAERR")=""
"RTN","RAO7RON",84,0)
 . D EN^ORERR("RAD MYSTERY ERROR",.RAMSG,.RAVARS)
"RTN","RAO7RON",85,0)
 . Q
"RTN","RAO7RON",86,0)
 S RANOW=$$NOW^XLFDT() I RANOW<RAORC15 S RAERR=7 Q
"RTN","RAO7RON",87,0)
 S RANEW(75.1,"+1,",16)=RAORC15
"RTN","RAO7RON",88,0)
 Q
"RTN","RAO7RON",89,0)
ERR ; error control - file 'soft' errors with CPRS
"RTN","RAO7RON",90,0)
 N RAVAR S RAVAR("XQY0")=""
"RTN","RAO7RON",91,0)
 D ERR^RAO7UTL("HL7 message with unknown segment header",.RAMSG,.RAVAR)
"RTN","RAO7RON",92,0)
 Q
"RTN","RAO7RON1")
0^12^B28343551^B16218705
"RTN","RAO7RON1",1,0)
RAO7RON1 ;HISC/GJC,FPT-Request message from OE/RR. (frontdoor) ; 7/26/05 2:08pm
"RTN","RAO7RON1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**69,75**;Mar 16, 1998;Build 4
"RTN","RAO7RON1",3,0)
 ;
"RTN","RAO7RON1",4,0)
 ;------------------------- Variable List -------------------------------
"RTN","RAO7RON1",5,0)
 ; RADATA=HL7 data minus seg. hdr    RAHDR=Segment header
"RTN","RAO7RON1",6,0)
 ; RAHLFS="|"                        RAMSG=HL7 message passed in
"RTN","RAO7RON1",7,0)
 ; RAOBR12=danger code               RAOBR18=modifier
"RTN","RAO7RON1",8,0)
 ; RAOBR19=Img. Loc. pntr (79.1)     RAOBR30=trans. mode
"RTN","RAO7RON1",9,0)
 ; RAOBR31=Reason for Study          RAOBX2=format of observ. value
"RTN","RAO7RON1",10,0)
 ; RAOBR4=univ. trans. mode          RAOBX5=observ. value
"RTN","RAO7RON1",11,0)
 ; RAOBX3=observ. ID                 RAORC10=entered by (200
"RTN","RAO7RON1",12,0)
 ; RAORC1=order control              RAORC15=order effective D/T
"RTN","RAO7RON1",13,0)
 ; RAORC12=ordering provider (200)   RAORC2=placer order #_"^OR"
"RTN","RAO7RON1",14,0)
 ; RAORC16=order control reason      RAORC7=start dt/freq. of service
"RTN","RAO7RON1",15,0)
 ; RAORC3=filler order #_"^RA"       RAPID5=patient name (2)
"RTN","RAO7RON1",16,0)
 ; RAPID3=patient ID                 RAPV12=patient class
"RTN","RAO7RON1",17,0)
 ; RAPV119=visit #                   RASEG=message seg. including header
"RTN","RAO7RON1",18,0)
 ; RAPV13=patient location (44)
"RTN","RAO7RON1",19,0)
 ; ----------------------------------------------------------------------
"RTN","RAO7RON1",20,0)
 ;
"RTN","RAO7RON1",21,0)
OBR ; breakdown the 'OBR' segment
"RTN","RAO7RON1",22,0)
 S RAOBR4=$P(RADATA,RAHLFS,4)
"RTN","RAO7RON1",23,0)
 F I=1:1:$L(RAOBR4,RAECH(1)) S RAOBR4(I)=$P(RAOBR4,RAECH(1),I)
"RTN","RAO7RON1",24,0)
 I RAOBR4(1)'="" S RACPTIEN=+$O(^ICPT("B",RAOBR4(1),0)) S:'RACPTIEN RAERR=8 Q:RAERR  ;RA*5*69
"RTN","RAO7RON1",25,0)
 S RAERR=$$EN2^RAO7VLD(71,+RAOBR4(4),RAOBR4(5)) S:RAERR RAERR=8 Q:RAERR
"RTN","RAO7RON1",26,0)
 I $$UP^XLFSTR($P($G(^RAMIS(71,+RAOBR4(4),0)),"^",6))="P" D  Q:RAERR
"RTN","RAO7RON1",27,0)
 . S RAERR=$$EN6^RAO7VLD(+RAOBR4(4)) S:RAERR RAERR=32
"RTN","RAO7RON1",28,0)
 . Q
"RTN","RAO7RON1",29,0)
 I RAOBR4(1)'="" S:'$D(^RAMIS(71,"D",RACPTIEN,+RAOBR4(4))) RAERR=8 Q:RAERR  ;RA*5*69
"RTN","RAO7RON1",30,0)
 S RAOBR4(4,"I-TYPE")=+$P($G(^RAMIS(71,+RAOBR4(4),0)),"^",12)
"RTN","RAO7RON1",31,0)
 S RANEW(75.1,"+1,",2)=RAOBR4(4)
"RTN","RAO7RON1",32,0)
 S RAIT=$P(^RAMIS(71,+RAOBR4(4),0),U,12)
"RTN","RAO7RON1",33,0)
 S RAERR=$$EN3^RAO7VLD(79.2,RAIT) Q:RAERR
"RTN","RAO7RON1",34,0)
 S RANEW(75.1,"+1,",3)=RAIT
"RTN","RAO7RON1",35,0)
 S RAOBR12=$P(RADATA,RAHLFS,12)
"RTN","RAO7RON1",36,0)
 S RAOBR12=$S($E(RAOBR12)="":"n","yYiI"[$E(RAOBR12):"y",1:"n")
"RTN","RAO7RON1",37,0)
 S RAERR=$$EN1^RAO7VLD(75.1,24,"E",RAOBR12,"RASULT","") S:RAERR RAERR=10 Q:RAERR
"RTN","RAO7RON1",38,0)
 S RANEW(75.1,"+1,",24)=RAOBR12
"RTN","RAO7RON1",39,0)
 S RAOBR18=$P(RADATA,RAHLFS,18)
"RTN","RAO7RON1",40,0)
 N RASERIES,RAIMAG
"RTN","RAO7RON1",41,0)
 F I=1:1:$L(RAOBR18,RAECH(2)) S:$L($P(RAOBR18,RAECH(2),I))>0 RAOBR18(I)=$P(RAOBR18,RAECH(2),I)
"RTN","RAO7RON1",42,0)
 S I=0 F  S I=$O(RAOBR18(I)) Q:I'>0  D  Q:RAERR
"RTN","RAO7RON1",43,0)
 . S RAMODIEN=+$O(^RAMIS(71.2,"B",RAOBR18(I),0))
"RTN","RAO7RON1",44,0)
 . S:'RAMODIEN RAERR=11 Q:RAERR
"RTN","RAO7RON1",45,0)
 . S RAIMAG=$P($G(^RAMIS(71,+RAOBR4(4),0)),U,12) ; type of imaging
"RTN","RAO7RON1",46,0)
 . S:'$D(^RAMIS(71.2,"AB",RAIMAG,RAMODIEN)) RAERR=33 Q:RAERR
"RTN","RAO7RON1",47,0)
 . S RASERIES=$S($P($G(^RAMIS(71,+RAOBR4(4),0)),"^",6)="S":1,1:0)
"RTN","RAO7RON1",48,0)
 . S:RASERIES&($P($G(^RAMIS(71.2,RAMODIEN,0)),U,2)]"") RAERR=34 Q:RAERR
"RTN","RAO7RON1",49,0)
 . S RAPLCHLD=RAPLCHLD+1
"RTN","RAO7RON1",50,0)
 . S RANEW(75.1125,"+"_RAPLCHLD_",+1,",.01)=RAMODIEN
"RTN","RAO7RON1",51,0)
 . Q
"RTN","RAO7RON1",52,0)
 S RAOBR19=$P(RADATA,RAHLFS,19),RAOBR19(1)=$P(RAOBR19,U,1)
"RTN","RAO7RON1",53,0)
 S RAOBR19(2)=$P(RAOBR19,U,2),RAOBR19(3)=+RAOBR19(1)
"RTN","RAO7RON1",54,0)
 I RAOBR19(3) D  Q:RAERR
"RTN","RAO7RON1",55,0)
 . S RAOBR19(3,"I-TYPE")=+$P($G(^RA(79.1,+RAOBR19(3),0)),"^",6)
"RTN","RAO7RON1",56,0)
 . I RAOBR4(4,"I-TYPE")'=RAOBR19(3,"I-TYPE") S RAERR=31
"RTN","RAO7RON1",57,0)
 . Q
"RTN","RAO7RON1",58,0)
 S RANEW(75.1,"+1,",20)=$S(RAOBR19(3)>0:RAOBR19(3),1:"")
"RTN","RAO7RON1",59,0)
 S X=$P(RADATA,RAHLFS,30)
"RTN","RAO7RON1",60,0)
 S RAOBR30=$S(X="CART":"s",X="PORT":"p",X="WALK":"a",X="WHLC":"w",1:"")
"RTN","RAO7RON1",61,0)
 I RAOBR30']"" S RAERR=13
"RTN","RAO7RON1",62,0)
 S:'RAERR RAERR=$$EN1^RAO7VLD(75.1,19,"E",RAOBR30,"RASULT","")
"RTN","RAO7RON1",63,0)
 S:RAERR RAERR=13 Q:RAERR
"RTN","RAO7RON1",64,0)
 S RANEW(75.1,"+1,",19)=RAOBR30
"RTN","RAO7RON1",65,0)
 ;--- Reason for Study P75 ---
"RTN","RAO7RON1",66,0)
 ;CPRS will not pass 'Reason for Study' data until OR*3.0*243
"RTN","RAO7RON1",67,0)
 ;(GUI CPRS V27) is released. Define a default Reason for Study 
"RTN","RAO7RON1",68,0)
 I '$$PATCH^XPDUTL("OR*3.0*243") S RAOBR31="See Clinical History:"
"RTN","RAO7RON1",69,0)
 E  D  Q:RAERR  ;CPRS V27 is installed
"RTN","RAO7RON1",70,0)
 .S RAOBR31=$P($P(RADATA,RAHLFS,31),RAECH(1),2)
"RTN","RAO7RON1",71,0)
 .S:RAOBR31="" RAERR=38 Q:RAERR
"RTN","RAO7RON1",72,0)
 .S RAERR=$$EN1^RAO7VLD(75.1,1.1,"E",RAOBR31,"RASULT","")
"RTN","RAO7RON1",73,0)
 .S:RAERR RAERR=39
"RTN","RAO7RON1",74,0)
 .Q
"RTN","RAO7RON1",75,0)
 S:'RAERR RANEW(75.1,"+1,",1.1)=RAOBR31
"RTN","RAO7RON1",76,0)
 K RAOBR31
"RTN","RAO7RON1",77,0)
 Q
"RTN","RAO7RON1",78,0)
OBX ; breakdown the 'OBX' segment
"RTN","RAO7RON1",79,0)
 S RAOBX2=$P(RADATA,RAHLFS,2)
"RTN","RAO7RON1",80,0)
 S RAERR=$S(RAOBX2="TX":0,RAOBX2="CE":0,RAOBX2="TS":0,1:1) Q:RAERR=17
"RTN","RAO7RON1",81,0)
 S RAOBX3=$P(RADATA,RAHLFS,3)
"RTN","RAO7RON1",82,0)
 S RAOBX5=$P(RADATA,RAHLFS,5)
"RTN","RAO7RON1",83,0)
 F I=1:1:$L(RAOBX3,RAECH(1)) S RAOBX3(I)=$P(RAOBX3,RAECH(1),I)
"RTN","RAO7RON1",84,0)
 S X=RAOBX3(2) D UPPER^RAUTL4 S RAOBX3(2)=Y
"RTN","RAO7RON1",85,0)
 ;
"RTN","RAO7RON1",86,0)
 ;P75 check to see if CLINICAL HISTORY data is passed. If data is passed, and not yet
"RTN","RAO7RON1",87,0)
 ;determined if valid continue to check for validity until:
"RTN","RAO7RON1",88,0)
 ;1-valid data is found
"RTN","RAO7RON1",89,0)
 ;2-no data left to validate
"RTN","RAO7RON1",90,0)
 I RAOBX3(1)=2000.02 D
"RTN","RAO7RON1",91,0)
 .;check if a null value is sent for CLINICAL HISTORY which is
"RTN","RAO7RON1",92,0)
 .;possible if the CPRS user does not enter a CLINICAL HISTORY
"RTN","RAO7RON1",93,0)
 .I RAOBX5="",$P(RACLIN,U)'=1 Q
"RTN","RAO7RON1",94,0)
 .;now if data was sent (RAOBX5'="") set the data received from CPRS flag
"RTN","RAO7RON1",95,0)
 .S $P(RACLIN,U)=1
"RTN","RAO7RON1",96,0)
 .;now that we know the CPRS user intended to send CLINICAL HISTORY data
"RTN","RAO7RON1",97,0)
 .;radiology has to validate the format of that data. $$EN4^RAO7VLD(str)
"RTN","RAO7RON1",98,0)
 .;returns 1 if the data passed in was valid, else 0. Once we establish
"RTN","RAO7RON1",99,0)
 .;that valid data has been sent, all subsequent data is accepted, valid
"RTN","RAO7RON1",100,0)
 .;or not.
"RTN","RAO7RON1",101,0)
 .S:$$EN4^RAO7VLD(RAOBX5) $P(RACLIN,U,2)=1
"RTN","RAO7RON1",102,0)
 .;now, if the current character string or any other character string
"RTN","RAO7RON1",103,0)
 .;of data representing the CLINICAL HISTORY has been accepted as valid
"RTN","RAO7RON1",104,0)
 .;($P(RACLIN,U,2)=1) save the character string
"RTN","RAO7RON1",105,0)
 .I $P(RACLIN,U,2)=1 S RAWP=RAWP+1,^TMP("RAWP",$J,RAWP)=RAOBX5
"RTN","RAO7RON1",106,0)
 ;
"RTN","RAO7RON1",107,0)
 I RAOBX3(1)=2000.33 D  Q:RAERR
"RTN","RAO7RON1",108,0)
 .S RAERR=$$EN1^RAO7VLD(75.1,13,"E",RAOBX5,"RASULT","") S:RAERR RAERR=14 Q:RAERR
"RTN","RAO7RON1",109,0)
 .S RAPREG=$E(RAOBX5),RAPREG=$S(RAPREG="N"!(RAPREG="n"):"n",RAPREG="Y"!(RAPREG="y"):"y",1:"u")
"RTN","RAO7RON1",110,0)
 .S RANEW(75.1,"+1,",13)=RAPREG
"RTN","RAO7RON1",111,0)
 I RAOBX3(1)=34!(RAOBX2="CE") D  Q:RAERR
"RTN","RAO7RON1",112,0)
 .S RAERR=$$EN2^RAO7VLD(34,$P(RAOBX5,RAECH(1)),$P(RAOBX5,RAECH(1),2)) Q:RAERR
"RTN","RAO7RON1",113,0)
 .S RANEW(75.1,"+1,",9)=+RAOBX5
"RTN","RAO7RON1",114,0)
 I RAOBX3(2)["RESEARCH" D  S:RAERR RAERR=18 Q:RAERR
"RTN","RAO7RON1",115,0)
 .S RAERR=$$EN1^RAO7VLD(75.1,9.5,"E",RAOBX5,"RASULT","") S:RAERR RAERR=19 Q:RAERR
"RTN","RAO7RON1",116,0)
 .S RANEW(75.1,"+1,",9.5)=RAOBX5
"RTN","RAO7RON1",117,0)
 I RAOBX3(2)["PRE-OP" D  Q:RAERR
"RTN","RAO7RON1",118,0)
 .S RAOBX5=$$FMDATE^HLFNC(RAOBX5)
"RTN","RAO7RON1",119,0)
 .S RAERR=$$EN1^RAO7VLD(75.1,12,"E",RAOBX5,"RASULT","") S:RAERR RAERR=20 Q:RAERR
"RTN","RAO7RON1",120,0)
 .S RANEW(75.1,"+1,",12)=RAOBX5
"RTN","RAO7RON1",121,0)
 I $D(RANEW(75.1,"+1,",9))&($D(RANEW(75.1,"+1,",9.5))) S RAERR=29
"RTN","RAO7RON1",122,0)
 Q
"RTN","RAO7VLD")
0^22^B2388912^B2349255
"RTN","RAO7VLD",1,0)
RAO7VLD ;HISC/GJC-Validate OE/RR data to Rad (frontdoor) ;1/6/98  13:02
"RTN","RAO7VLD",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**75**;Mar 16, 1998;Build 4
"RTN","RAO7VLD",3,0)
 ;
"RTN","RAO7VLD",4,0)
EN1(RAA,RAB,RAC,RAX,RAY,RAZ) ; Pass in parameters to validate data
"RTN","RAO7VLD",5,0)
 ; Returns '0' if data is valid, '1' if data is invalid
"RTN","RAO7VLD",6,0)
 ; This call is not used on pointer type data fields.
"RTN","RAO7VLD",7,0)
 ;                ***** variable list *****
"RTN","RAO7VLD",8,0)
 ; RAA=file #                RAB=field #
"RTN","RAO7VLD",9,0)
 ; RAC=flag parameters       RAX=value being checked
"RTN","RAO7VLD",10,0)
 ; RAY=result of call array  RAZ=Error Array (not used)
"RTN","RAO7VLD",11,0)
 ;***********************************************************************
"RTN","RAO7VLD",12,0)
 K %DT(0) D CHK^DIE(RAA,RAB,RAC,RAX,.RAY)
"RTN","RAO7VLD",13,0)
 Q $S(RAY["^":1,1:0)
"RTN","RAO7VLD",14,0)
 ;
"RTN","RAO7VLD",15,0)
EN2(T1,T2,T3) ;
"RTN","RAO7VLD",16,0)
 ; Pass in parameters to validate pointer type data.
"RTN","RAO7VLD",17,0)
 ; This call is only used on pointer type data fields.
"RTN","RAO7VLD",18,0)
 ;                ***** variable list *****
"RTN","RAO7VLD",19,0)
 ; T1=file #       T2=IEN (if app)      T3=.01 fields value
"RTN","RAO7VLD",20,0)
 ; X=0 if proper match, 1 if no match   Y=global node (assumed to be '0')
"RTN","RAO7VLD",21,0)
 ;***********************************************************************
"RTN","RAO7VLD",22,0)
 N X,Y,Z S X=0
"RTN","RAO7VLD",23,0)
 F Z=$G(T1),$G(T2),$G(T3) S:Z']"" X=1 Q:X
"RTN","RAO7VLD",24,0)
 Q:X X ; all parameters must be defined
"RTN","RAO7VLD",25,0)
 S Y=$G(@(^DIC(T1,0,"GL")_T2_",0)"))
"RTN","RAO7VLD",26,0)
 Q $S($P(Y,"^")=T3:0,1:1)
"RTN","RAO7VLD",27,0)
EN3(X,Y) ; does entry exist in a file
"RTN","RAO7VLD",28,0)
 ; X-> file #        'Y'-> ien
"RTN","RAO7VLD",29,0)
 ; 0 if entry exists, 1 if entry does not exist
"RTN","RAO7VLD",30,0)
 Q $S($D(@(^DIC(+X,0,"GL")_+Y_",0)"))#2:0,1:1)
"RTN","RAO7VLD",31,0)
 ;
"RTN","RAO7VLD",32,0)
EN4(X) ;P75 Check CPRS entered CLINICAL HISTORY text for validity.
"RTN","RAO7VLD",33,0)
 ;This function returns: 1 if the string is valid else 0.
"RTN","RAO7VLD",34,0)
 ;Please note that once the data is valid, (a minimum of two
"RTN","RAO7VLD",35,0)
 ;alphanumeric characters on a character string) subsequent data
"RTN","RAO7VLD",36,0)
 ;strings may not be valid but are still stored. 
"RTN","RAO7VLD",37,0)
 N CHAR,CNT,FLG,I,LEN S (CNT,FLG)=0,LEN=$L(X)
"RTN","RAO7VLD",38,0)
 F I=1:1:LEN D  Q:FLG
"RTN","RAO7VLD",39,0)
 .S CHAR=$E(X,I)
"RTN","RAO7VLD",40,0)
 .S:CHAR?1AN CNT=CNT+1
"RTN","RAO7VLD",41,0)
 .I CHAR'?1AN,(CNT) S CNT=0
"RTN","RAO7VLD",42,0)
 .S:CNT=2 FLG=1
"RTN","RAO7VLD",43,0)
 .Q
"RTN","RAO7VLD",44,0)
 Q FLG
"RTN","RAO7VLD",45,0)
 ;
"RTN","RAO7VLD",46,0)
EN5(RAD0,RANSTAT,RADUZ,RAREA) ; update the 'REQUEST STATUS TIMES' multiple
"RTN","RAO7VLD",47,0)
 ; in the Rad/Nuc Med Orders file.  All parameters must be in the
"RTN","RAO7VLD",48,0)
 ; internal format.
"RTN","RAO7VLD",49,0)
 ; RAD0=top level ien                 RANSTAT=new status
"RTN","RAO7VLD",50,0)
 ; RADUZ=user ien                     RAREA=reason for status change
"RTN","RAO7VLD",51,0)
 ; Pass back '1' if error, '0' if no error.
"RTN","RAO7VLD",52,0)
 N ARR
"RTN","RAO7VLD",53,0)
 S ARR(7,75.12,"+1,"_RAD0_",",".01")=RALDT
"RTN","RAO7VLD",54,0)
 S ARR(7,75.12,"+1,"_RAD0_",",2)=RANSTAT
"RTN","RAO7VLD",55,0)
 S ARR(7,75.12,"+1,"_RAD0_",",3)=RADUZ
"RTN","RAO7VLD",56,0)
 S ARR(7,75.12,"+1,"_RAD0_",",4)=RAREA
"RTN","RAO7VLD",57,0)
 D UPDATE^DIE("","ARR(7)")
"RTN","RAO7VLD",58,0)
 Q +$G(DIERR)
"RTN","RAO7VLD",59,0)
EN6(X) ; Check if parent procedure has descendents
"RTN","RAO7VLD",60,0)
 ; Passes back: 0 if descendents else 1
"RTN","RAO7VLD",61,0)
 ; X is the ien of the procedure (71)
"RTN","RAO7VLD",62,0)
 Q $S(+$O(^RAMIS(71,X,4,0)):0,1:1)
"RTN","RAORD1")
0^1^B48840656^B47171265
"RTN","RAORD1",1,0)
RAORD1 ;HISC/CAH - AISC/RMO-Request An Exam ; 01/21/05 11:25am
"RTN","RAORD1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,45,41,75**;Mar 16, 1998;Build 4
"RTN","RAORD1",3,0)
 ;*Billing Awareness Project:
"RTN","RAORD1",4,0)
 ; RABWDX Array: ICD Diagnosis^SC^AO^IR^EC^MST^HNC
"RTN","RAORD1",5,0)
 ;  RABWDX is used in RABWORD* and RABWPCE*. 
"RTN","RAORD1",6,0)
 K RABWDX
"RTN","RAORD1",7,0)
 ;*
"RTN","RAORD1",8,0)
 S RAPKG="" N RAPTLKUP,RAGMTS,RACOPYOR
"RTN","RAORD1",9,0)
 G ADDORD:$D(RAVSTFLG)&($D(RALIFN))&($D(RAPIFN))
"RTN","RAORD1",10,0)
 I '$D(RAREGFLG),'$D(RAVSTFLG) N RAPTLOCK K RAWARD D  G:'RAPTLKUP Q
"RTN","RAORD1",11,0)
PAT .S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC
"RTN","RAORD1",12,0)
 .I Y<0 S RAPTLKUP=0 Q
"RTN","RAORD1",13,0)
 .I $$ORVR^RAORDU()'<3 D  G:'RAPTLOCK PAT
"RTN","RAORD1",14,0)
 ..S RAPTLOCK=$$LK^RAUTL19(+Y_";DPT(")
"RTN","RAORD1",15,0)
 ..Q
"RTN","RAORD1",16,0)
 .S (DFN,RADFN)=+Y,(VA200,RAPTLKUP)=1
"RTN","RAORD1",17,0)
 .W ! D IN5^VADPT S:VAIP(1) RAWARD=$P(VAIP(5),"^",2)
"RTN","RAORD1",18,0)
 .D ELIG^RABWORD2
"RTN","RAORD1",19,0)
 .Q
"RTN","RAORD1",20,0)
PL S DIC("A")="Patient Location: ",DIC("B")=$S($D(RAWARD):RAWARD,1:""),DIC="^SC(",DIC(0)="AEMQ",DIC("S")="I $$SCREEN^RAORD1A()"
"RTN","RAORD1",21,0)
 D ^DIC K DIC K:'$D(RAREGFLG) RAWARD G Q:Y<0 S RALIFN=+Y
"RTN","RAORD1",22,0)
 S DIC("A")="Person Requesting Order: "
"RTN","RAORD1",23,0)
 ;*Billing Awareness Project:
"RTN","RAORD1",24,0)
 S DIC("S")="I $$PROV^RABWORD()"
"RTN","RAORD1",25,0)
 ;Display Service Connected prompts if user is a Provider.
"RTN","RAORD1",26,0)
 S DIC="^VA(200,",DIC(0)="AEMQ",Y=DUZ S:$$PROV^RABWORD DIC("B")=$P(^VA(200,DUZ,0),"^",1)
"RTN","RAORD1",27,0)
 D ^DIC K DIC G Q:Y<0 S RAPIFN=+Y K DD,DO,VA200,VAERR,VAIP G ADDORD:$D(RAVSTFLG)
"RTN","RAORD1",28,0)
 ;
"RTN","RAORD1",29,0)
ENADD ;OE/RR Entry Point for the ACTION Option
"RTN","RAORD1",30,0)
 K ORSTOP,ORTO,ORCOST,ORPURG
"RTN","RAORD1",31,0)
 I '$D(RAPKG) G Q:'$D(ORVP)!('$D(ORL))!('$D(ORNP)) S (DFN,RADFN)=+ORVP,RALIFN=+ORL,RAPIFN=$S(+ORNP:+ORNP,$D(RAPIFN):RAPIFN,1:+ORNP),RAFOERR=""
"RTN","RAORD1",32,0)
 ; RAFOERR is used as a flag to track when a user enters this option
"RTN","RAORD1",33,0)
 ; from OE/RR (frontdoor).  If this variable exists when a request is
"RTN","RAORD1",34,0)
 ; being printed, exam information is omitted from the request.
"RTN","RAORD1",35,0)
 S RANME=^DPT(RADFN,0),RASEX=$P(RANME,"^",2),RANME=$P(RANME,"^") D EXAM^RADEM1:'$D(RAREGFLG)&($D(RAPKG)) I '$D(RAREGFLG) S VA200=1 D IN5^VADPT S:VAIP(1) RAWARD=$P(VAIP(5),"^",2)
"RTN","RAORD1",36,0)
 D SAVE ; save off original value of RAMDV!
"RTN","RAORD1",37,0)
 S RAL0=$S($D(^SC(RALIFN,0)):^(0),1:0)
"RTN","RAORD1",38,0)
 S RADIV=+$$SITE^VASITE(DT,+$P(RAL0,"^",15)) S:RADIV<0 RADIV=0
"RTN","RAORD1",39,0)
 S RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORD1",40,0)
 S RAMDV=$TR($G(^RA(79,+RADIV,.1)),"YyNn","1100")
"RTN","RAORD1",41,0)
 S RACAT=$S($D(RACAT):RACAT,$D(RAWARD):"INPATIENT",$P(RAL0,"^",2)="PERSONNEL HEALTH":"EMPLOYEE",'$D(^RADPT(RADFN,0)):"OUTPATIENT",$P(^(0),"^",4)]"":$P($P(^DD(70,.04,0),$P(^RADPT(RADFN,0),"^",4)_":",2),";"),1:"OUTPATIENT")
"RTN","RAORD1",42,0)
 I "IO"[$E(RACAT,1) D
"RTN","RAORD1",43,0)
 .S RASTRNG=$$MATCH^RAORD1A(RACAT,RALIFN)
"RTN","RAORD1",44,0)
 .;if necessary, change category of exam to match type of requesting
"RTN","RAORD1",45,0)
 .;location and display msg to user
"RTN","RAORD1",46,0)
 .S RACAT=$P(RASTRNG,"^"),RAWARD=$P(RASTRNG,"^",2)
"RTN","RAORD1",47,0)
 .Q
"RTN","RAORD1",48,0)
 K:$D(RAWARD)&($E(RACAT,1)="O") RAWARD
"RTN","RAORD1",49,0)
 K RASTRNG
"RTN","RAORD1",50,0)
 ; clear clin hist if:
"RTN","RAORD1",51,0)
 ;   rad backdoor, or
"RTN","RAORD1",52,0)
 ;   oe/rr's first order (quick or not)
"RTN","RAORD1",53,0)
 I $D(RAPKG) K ^TMP($J,"RAWP")
"RTN","RAORD1",54,0)
 I '$D(RAPKG),$G(XQORS)>1,$G(^TMP("XQORS",$J,XQORS-1,"ITM"))=1 K ^TMP($J,"RAWP")
"RTN","RAORD1",55,0)
 ;
"RTN","RAORD1",56,0)
ADDORD I $D(RADR1) D ALLERGY,CREATE1 G Q
"RTN","RAORD1",57,0)
 ; Set flag variable 'RASTOP' to track if procedure messages (if any)
"RTN","RAORD1",58,0)
 ; have been displayed.  Value altered in EN2+1^RAPRI & DISP+12^RAORDU1.
"RTN","RAORD1",59,0)
 D:'$D(VAEL) ELIG^VADPT
"RTN","RAORD1",60,0)
 I $D(^RAO(75.1,"B",RADFN)) D
"RTN","RAORD1",61,0)
 .I '$D(RAVSTFLG) D PREV^RABWORD2 Q
"RTN","RAORD1",62,0)
 .D ADDEXAM^RABWORD2
"RTN","RAORD1",63,0)
 D DISP^RAPRI G:RAIMGTYI'>0 Q
"RTN","RAORD1",64,0)
ADDORD1 W !,"Select Procedure",$S(RACNT:" (1-"_RACNT_") ",1:" "),"or enter '?' for help: "
"RTN","RAORD1",65,0)
 R RARX:DTIME
"RTN","RAORD1",66,0)
 S:'$T RARX="^" G Q:RARX=""!($E(RARX)="^")
"RTN","RAORD1",67,0)
 S:RARX=" " RARX=$S($D(RASX):RASX,1:RARX)
"RTN","RAORD1",68,0)
 I $E(RARX)="?"!(RARX=0)!(RARX=" ")!(RARX?.E1N1"-"1N.E)!(RARX?.E1".".E) D HELP^RAPRI G Q:Y'=1 D DISP1^RAPRI G ADDORD1
"RTN","RAORD1",69,0)
 S RAEXMUL=1 K RAHSMULT
"RTN","RAORD1",70,0)
 F RAJ=1:1 S X=$P(RARX,",",RAJ) Q:X=""  S RASTOP=0 W !!!,"Processing procedure: ",$S(+X&(+X'>RACNT):$P($G(RAPRC(X)),"^"),$E(X)'="`":X,1:"") D LOOKUP^RAPRI Q:$D(RAOUT)  S:RAPRI>0 RASX="`"_RAPRI D:RAPRI>0 ALLERGY,CREATE Q:$D(RAOUT)  K RAPRI
"RTN","RAORD1",71,0)
 I $D(RAREASK),'$D(RAOUT) K RAREASK D DISP1^RAPRI G ADDORD1
"RTN","RAORD1",72,0)
Q ; Kill, unlock if locked, and quit
"RTN","RAORD1",73,0)
 D KILL^RAORD
"RTN","RAORD1",74,0)
 D SAVE ; reset RAMDV to its original value!
"RTN","RAORD1",75,0)
 I $$ORVR^RAORDU()'<3,(+$G(RAPTLOCK)),(+$G(RADFN)) D
"RTN","RAORD1",76,0)
 . D ULK^RAUTL19(RADFN_";DPT(")
"RTN","RAORD1",77,0)
 K:'$D(RAREGFLG)&('$D(RAVSTFLG)) RACAT,RADFN,RANME,RAWARD
"RTN","RAORD1",78,0)
 I '$D(RAPKG) K RAMDIV,RAMDV,RAMLC
"RTN","RAORD1",79,0)
 I $D(RAPKG) K ORIFN,ORIT,ORL,ORNP,ORNS,ORPCL,ORPK,ORPV,ORPURG,ORSTS,ORTX,ORVP,RAPKG
"RTN","RAORD1",80,0)
 K RAHSMULT,RAPOP,RAIMAG,RAREAST,RAREQLOC
"RTN","RAORD1",81,0)
 K C,DI,DIG,DIH,DISYS,DIU,DIW,DIWF,DIWL,DIWR,DIWT,DN,I,ORCHART,POP,RAMDVZZ,RASCI,RASERIES
"RTN","RAORD1",82,0)
 Q
"RTN","RAORD1",83,0)
CREATE S RACT=0 D MODS Q:$D(RAOUT)
"RTN","RAORD1",84,0)
CREATE1 ;ask for the 'Date Desired' req'd P75
"RTN","RAORD1",85,0)
 S RAWHEN=$$DESDT^RAUTL12(RAPRI) S:RAWHEN=-1 RAOUT=1 Q:$D(RAOUT)#2
"RTN","RAORD1",86,0)
 S RAWHEN=$$FMTE^XLFDT(RAWHEN,1) ;convert to external format
"RTN","RAORD1",87,0)
 ; Ask pregnant if age is between 12 & 55.  Ask once for mult requests
"RTN","RAORD1",88,0)
 ; RASKPREG is the variable used to track if the pregnant prompt has
"RTN","RAORD1",89,0)
 ; been asked.  Ask only once for multiple requests.
"RTN","RAORD1",90,0)
 S:'$D(RASKPREG) RAPREG=$$PREG^RAORD1A(RADFN,$G(DT)),RASKPREG="" Q:$D(RAOUT)
"RTN","RAORD1",91,0)
 ;Reason for Study (req'd) & Clinical History (optional) asked in CH^RAUTL5 P75
"RTN","RAORD1",92,0)
 D CH^RAUTL5 Q:$D(RAOUT)  ;RAOUT: defined if Reason for Study is nonexistent
"RTN","RAORD1",93,0)
BAQUES ;*Billing Awareness Project
"RTN","RAORD1",94,0)
 ;   Ask Ordering ICD-9 Diagnosis and Related SC/EI/MST/HNC questions.
"RTN","RAORD1",95,0)
 N RADTM D NOW^%DTC S RADTM=%
"RTN","RAORD1",96,0)
 D ASK^RABWORD(RADFN,RADTM)
"RTN","RAORD1",97,0)
 I '$D(RADR1) D DISP^RAORDU1 Q:$D(RAOUT)  ; Display Order Responses.
"RTN","RAORD1",98,0)
 S X=RADFN,DIC="^RAO(75.1,",DIC(0)="L",DLAYGO=75.1
"RTN","RAORD1",99,0)
 D FILE^DICN K DIC Q:Y<0  S RAOIFN=+Y K DLAYGO
"RTN","RAORD1",100,0)
 I $D(RAREGFLG)!($D(RAVSTFLG)) S RANUM=$S('$D(RANUM):1,1:RANUM+1),RAORDS(RANUM)=RAOIFN
"RTN","RAORD1",101,0)
 I $D(^RA(79,+RADIV,.1)),$P(^(.1),"^",21)="y" S RALOCFLG=""
"RTN","RAORD1",102,0)
 W ! S DA=RAOIFN,DIE="^RAO(75.1,",DIE("NO^")="OUTOK"
"RTN","RAORD1",103,0)
 S DR=$S($D(RADR1):"[RA QUICK EXAM ORDER]",$D(RADR2):"[RA ORDER EXAM]",$D(RAEXMUL)&($D(RAFIN1)):"[RA QUICK EXAM ORDER]",1:"[RA ORDER EXAM]")
"RTN","RAORD1",104,0)
 ;*Billing Awareness Project
"RTN","RAORD1",105,0)
 ;   If Order questions are being Re-Asked then Re-Ask ICD-9 Dx questions
"RTN","RAORD1",106,0)
 I DR="[RA ORDER EXAM]" D ASK^RABWORD(RADFN,RADTM) W !!
"RTN","RAORD1",107,0)
 D ^DIE
"RTN","RAORD1",108,0)
 K DIE("NO^"),DE,DQ,DIE,DR,RADR1,RADR2
"RTN","RAORD1",109,0)
 I $D(RAFIN),$D(^RAO(75.1,RAOIFN,0)) S RAORD0=^(0) D FILEDX^RABWORD(RADFN,RAOIFN) Q:'$D(RAFIN)  D SETORD^RAORDU D OERR^RAORDU:'$D(RAPKG) D ^RAORDQ:$D(RAPKG) K RAORD0
"RTN","RAORD1",110,0)
 I '$D(RAFIN) W !?3,$C(7),"Request not complete. Must Delete..." S DA=RAOIFN,DIK="^RAO(75.1," D ^DIK W "...deletion complete!" I $D(RAREGFLG)!($D(RAVSTFLG)) K RAORDS(RANUM)
"RTN","RAORD1",111,0)
 I '$D(RAFIN),('$D(^RAO(75.1,RAOIFN,0))#2) Q  ; record deleted!
"RTN","RAORD1",112,0)
 K RAFIN
"RTN","RAORD1",113,0)
 ; check if the 'stat' or 'urgent' alert is to be sent.
"RTN","RAORD1",114,0)
 N RALOC,RAORD0
"RTN","RAORD1",115,0)
 S RAORD0=$G(^RAO(75.1,RAOIFN,0)),RALOC=+$P(RAORD0,"^",20)
"RTN","RAORD1",116,0)
 Q:'RALOC  ; if no 'SUBMIT TO' location, can't send stat/urgent alerts
"RTN","RAORD1",117,0)
 I $P(RAORD0,"^",6)=1!(($P(RAORD0,"^",6)=2)&($P(^RA(79.1,RALOC,0),"^",20)="Y")) D
"RTN","RAORD1",118,0)
 .; If 6th piece of RAORD0=1 *stat*, =2 *urgent*
"RTN","RAORD1",119,0)
 .Q:$$ORVR^RAORDU()<3
"RTN","RAORD1",120,0)
 .; needs OE/RR 3.0 or greater for stat/urgent alerts to fire
"RTN","RAORD1",121,0)
 .D OENO^RAUTL19(RAOIFN)
"RTN","RAORD1",122,0)
 .Q
"RTN","RAORD1",123,0)
 Q
"RTN","RAORD1",124,0)
 ;
"RTN","RAORD1",125,0)
MODS ;RAPRI= Procedure IEN, RAIMAG=Imaging Type for the procedure.
"RTN","RAORD1",126,0)
 ;Edited 4/19/94, Type of Imaging is now a multiple in file 71.2. CEW
"RTN","RAORD1",127,0)
 S RAIMAG=+$$ITYPE^RASITE(RAPRI),DIC(0)="AEQMZ",DIC="^RAMIS(71.2,",DIC("A")="Select "_$P($G(^DIC(71.2,0)),"^")_": "
"RTN","RAORD1",128,0)
 S DIC("S")="I +$D(^RAMIS(71.2,""AB"",RAIMAG,+Y)),$S('$G(RASERIES):1,$P(^RAMIS(71.2,+Y,0),U,2)="""":1,1:0),$$INIMOD^RAORD1A($P($G(^RAMIS(71.2,+Y,0)),""^""))"
"RTN","RAORD1",129,0)
 D ^DIC K DIC,RAIMAG S:$D(DTOUT)!($D(DUOUT)) RAOUT=1 Q:$D(RAOUT)!(X="^")!(X="")  I Y<1 W $C(7),"  ??" G MODS
"RTN","RAORD1",130,0)
 S RACT=RACT+1,RAMOD(RACT)=$P(Y,"^",2) G MODS
"RTN","RAORD1",131,0)
 Q
"RTN","RAORD1",132,0)
 ;
"RTN","RAORD1",133,0)
ALLERGY ; If patient has had a previous contrast media allergic reaction
"RTN","RAORD1",134,0)
 ; check procedure RAPRI for specific contrast media associations
"RTN","RAORD1",135,0)
 ; (new with RA*5*45)
"RTN","RAORD1",136,0)
 Q:'$$ORCHK^GMRAOR(RADFN,"CM")
"RTN","RAORD1",137,0)
 S RAPRI(0)=$G(^RAMIS(71,RAPRI,0))
"RTN","RAORD1",138,0)
 I $P(RAPRI(0),U,6)'="P" D  ;not a parent check lone procedure
"RTN","RAORD1",139,0)
 .D CONTRAST^RAUTL2(RAPRI)
"RTN","RAORD1",140,0)
 .Q
"RTN","RAORD1",141,0)
 E  S I=0 D  ;check descendent procedures for CM
"RTN","RAORD1",142,0)
 .F  S I=$O(^RAMIS(71,RAPRI,4,I)) Q:'I  D CONTRAST^RAUTL2(+$G(^(I,0)))
"RTN","RAORD1",143,0)
 .K I
"RTN","RAORD1",144,0)
 .Q
"RTN","RAORD1",145,0)
 K RAPRI(0)
"RTN","RAORD1",146,0)
 Q
"RTN","RAORD1",147,0)
SAVE ; Save original value of RAMDV before it is altered in the ENADD sub-
"RTN","RAORD1",148,0)
 ; routine.  This code will also reset RAMDV to the sign-on value.
"RTN","RAORD1",149,0)
 Q:'$D(RAPKG)  ; entered through OE/RR (RAMDV will not be set)
"RTN","RAORD1",150,0)
 Q:'$D(RAMDV)&('$D(RAMDVZZ))  ;entered through 'Request an Exam' option used stand-alone outside of Rad/NM pkg
"RTN","RAORD1",151,0)
 I '$D(RAMDVZZ) S RAMDVZZ=RAMDV
"RTN","RAORD1",152,0)
 E  S RAMDV=RAMDVZZ
"RTN","RAORD1",153,0)
 Q
"RTN","RAORD2")
0^8^B44295727^B43792586
"RTN","RAORD2",1,0)
RAORD2 ;HISC/CAH,FPT,GJC,DAD AISC/RMO-Detailed Request Display ;9/3/99  13:48
"RTN","RAORD2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,10,51,45,75**;Mar 16, 1998;Build 4
"RTN","RAORD2",3,0)
 K XQADATA
"RTN","RAORD2",4,0)
 D HOME^%ZIS K DIC S DIC="^DPT(",DIC(0)="AEMQ"
"RTN","RAORD2",5,0)
 W ! D ^DIC G Q:Y<0
"RTN","RAORD2",6,0)
 S RADFN=+Y,RANME=$S($D(^DPT(RADFN,0)):$P(^(0),"^"),1:"Unknown")
"RTN","RAORD2",7,0)
 S RAOFNS="Display",RAOVSTS="1;2;3;5;6;8" D LOCATN I $G(RAQUIT) D Q Q
"RTN","RAORD2",8,0)
 I RAONE]"" S ^TMP($J,"RA L-TYPE",$P(RAONE,"^"),$P(RAONE,"^",2))=""
"RTN","RAORD2",9,0)
 S ^TMP($J,"RA L-TYPE","Unknown")=""
"RTN","RAORD2",10,0)
 I '$D(^TMP($J,"RA L-TYPE")) D ERROR^RAUTL7A D Q QUIT
"RTN","RAORD2",11,0)
 S X=0 W !!,"Imaging Location(s) included:"
"RTN","RAORD2",12,0)
 F  S X=$O(^TMP($J,"RA L-TYPE",X)) Q:X']""  D
"RTN","RAORD2",13,0)
 . W:($X+$L(X)+2)'<IOM !?$L("Imaging Location(s) included:") W ?($X+3),X
"RTN","RAORD2",14,0)
 . Q
"RTN","RAORD2",15,0)
 W ! K DIR S DIR(0)="E" D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) D Q Q
"RTN","RAORD2",16,0)
 D ^RAORDS G Q:'$D(RAORDS)
"RTN","RAORD2",17,0)
OERR ; Entry Point for OE/RR Cancel/Hold Alert
"RTN","RAORD2",18,0)
 I $D(XQADATA) D
"RTN","RAORD2",19,0)
 . S RAORDS(1)=+XQADATA
"RTN","RAORD2",20,0)
 . I $P(XQADATA,",",2)'="" S RADFN=$P(XQADATA,",",2)
"RTN","RAORD2",21,0)
 S RAPKG="",RAOSTSYM="dc^c^h^^p^^^s",$P(RALNE,"-",79)="",RAX=""
"RTN","RAORD2",22,0)
 F RAOLP=1:1 S RAOIFN=$S($D(RAORDS(RAOLP)):RAORDS(RAOLP),1:0) Q:'RAOIFN!(RAX=U)  D DISORD
"RTN","RAORD2",23,0)
 ;
"RTN","RAORD2",24,0)
 K:RAX="^" XQAID,XQAKILL I $D(XQAID) S DFN=$P(XQAID,",",2) D DELETE^XQALERT
"RTN","RAORD2",25,0)
Q K %,DIC,I,OREND,RA,RACI,RACNI,RADFN,RADIV,RADIVPAR,RADPT0,RADTI,RALNE
"RTN","RAORD2",26,0)
 K RANME,RAOFNS,RAOIFN,RAOLP,RAORD0,RAORDS,RAOSTS,RAOSTSYM,RAOVSTS,RAPKG
"RTN","RAORD2",27,0)
 K RAONE,RAQUIT,RASSN,X,XQAID,XQALERT,Y,RAX,VA200,VAERR,VAIP
"RTN","RAORD2",28,0)
 K RAPARENT,RACMFLG
"RTN","RAORD2",29,0)
 K DFN,DIPGM,DISYS,DIW,DIWI,DIWT,DIWTC,DIWX,DN,RA6,RA7,POP,^TMP($J,"PRO-ORD")
"RTN","RAORD2",30,0)
 K ^TMP($J,"RA L-TYPE"),^TMP($J,"RAORDS"),^TMP($J,"RA DIFF PRC") Q
"RTN","RAORD2",31,0)
 ;
"RTN","RAORD2",32,0)
 ;
"RTN","RAORD2",33,0)
DISORD Q:'$D(^DPT(RADFN,0))  S RADPT0=^(0),RA("NME")=$P(RADPT0,"^"),RA("DOB")=$P(RADPT0,"^",3),RASSN=$$SSN^RAUTL Q:'$D(^RAO(75.1,RAOIFN,0))  S RAORD0=^(0)
"RTN","RAORD2",34,0)
 ;determine if ordered procedure has CM assoc.; return null if none
"RTN","RAORD2",35,0)
 S RAZPRC0=$G(^RAMIS(71,+$P(RAORD0,U,2),0))
"RTN","RAORD2",36,0)
 S RACMFLG("O")=$$CMEDIA^RAO7UTL(+$P(RAORD0,U,2),$P(RAZPRC0,U,6))
"RTN","RAORD2",37,0)
 K RAZPRC0
"RTN","RAORD2",38,0)
 I $D(^RADPT("AO",RAOIFN,RADFN)) D DPRC(RAOIFN,RADFN)
"RTN","RAORD2",39,0)
 S RA("PROC. NODE")=$G(^RAMIS(71,+$P(RAORD0,U,2),0))
"RTN","RAORD2",40,0)
 S RA("PRC")=$E($P(RA("PROC. NODE"),U),1,36)
"RTN","RAORD2",41,0)
 S RA("PRCTY")=$P(RA("PROC. NODE"),U,6)
"RTN","RAORD2",42,0)
 S RA("PRCTY")=$$XTERNAL^RAUTL5(RA("PRCTY"),$P($G(^DD(71,6,0)),U,2))
"RTN","RAORD2",43,0)
 S RA("PRCTY")=$E(RA("PRCTY"))_$$LOW^XLFSTR($E(RA("PRCTY"),2,99))
"RTN","RAORD2",44,0)
 S RA("CPT")=+$P(RA("PROC. NODE"),U,9)
"RTN","RAORD2",45,0)
 ; don't find CPT code if procedure has type = Parent
"RTN","RAORD2",46,0)
 S RA("CPT")=$S($E(RA("PRCTY"))="P":"",1:$P($$NAMCODE^RACPTMSC(RA("CPT"),DT),U))
"RTN","RAORD2",47,0)
 S RA("PRCIT")=+$P(RA("PROC. NODE"),U,12)
"RTN","RAORD2",48,0)
 S RA("PRCIT")=$P($G(^RA(79.2,RA("PRCIT"),0)),U,3)
"RTN","RAORD2",49,0)
 S RA("PROC INFO")="",$E(RA("PROC INFO"),1,36)=RA("PRC")
"RTN","RAORD2",50,0)
 S RA("CNCAT")="("_RA("PRCIT")_" "_RA("PRCTY")_" "_RA("CPT")_")"
"RTN","RAORD2",51,0)
 S $E(RA("PROC INFO"),38,60)=RA("CNCAT") K RA("CNCAT"),RA("PRCIT")
"RTN","RAORD2",52,0)
 K RA("PRCTY"),RA("CPT")
"RTN","RAORD2",53,0)
 S RA("STY_REA")=$P($G(^RAO(75.1,RAOIFN,.1)),U) ;P75
"RTN","RAORD2",54,0)
 K RA("MOD") F I=0:0 S I=$O(^RAO(75.1,RAOIFN,"M","B",I)) Q:'I  I $D(^RAMIS(71.2,+I,0)) S RA("MOD")=$S('$D(RA("MOD")):$P(^(0),"^"),1:RA("MOD")_", "_$P(^(0),"^"))
"RTN","RAORD2",55,0)
 S RA("OST")=$P($P(^DD(75.1,5,0),$P(RAORD0,"^",5)_":",2),";")_$S($P(RAOSTSYM,"^",$P(RAORD0,"^",5))="":"",1:" ("_$P(RAOSTSYM,"^",$P(RAORD0,"^",5))_")")
"RTN","RAORD2",56,0)
 S RA("PHY")=$S($D(^VA(200,+$P(RAORD0,"^",14),0)):$P(^(0),"^"),1:"")
"RTN","RAORD2",57,0)
 ; Requesting Physician phone/pager info
"RTN","RAORD2",58,0)
 D PHONE^RAORD5("R",+$P(RAORD0,"^",14))
"RTN","RAORD2",59,0)
 S RA("HLC")=$S($D(^SC(+$P(RAORD0,"^",22),0)):$P(^(0),"^"),1:"")
"RTN","RAORD2",60,0)
 S DFN=RADFN,VA200=1 D IN5^VADPT I VAIP(1) S RA("ROOM-BED")=$S(+VAIP(6):$P(VAIP(6),"^",2),1:"")
"RTN","RAORD2",61,0)
 K RA("ODT") S X=$P(RAORD0,"^",16) I X S:$P(X,".",2) X=$P(X,".")_"."_$$NOSECNDS^RAORD3($P(X,".",2)) S RA("ODT")=$$FMTE^XLFDT(X,"1P")
"RTN","RAORD2",62,0)
 S RA("USR")=$S($D(^VA(200,+$P(RAORD0,"^",15),0)):$P(^(0),"^"),1:"")
"RTN","RAORD2",63,0)
 D HDR ; display a header
"RTN","RAORD2",64,0)
 W !,"Requested :",?12,RA("PROC INFO")
"RTN","RAORD2",65,0)
 I $D(^TMP($J,"RA DIFF PRC")) D
"RTN","RAORD2",66,0)
 .N CRTN,I S CRTN=0,I="" W !,"Registered:"
"RTN","RAORD2",67,0)
 .F  S I=$O(^TMP($J,"RA DIFF PRC",I)) Q:I']""  D
"RTN","RAORD2",68,0)
 ..W:CRTN ! W ?12,I S CRTN=1
"RTN","RAORD2",69,0)
 .Q
"RTN","RAORD2",70,0)
 I $G(RACMFLG("O"))'="" W:$X ! W ?12,"** The requested procedure has contrast media assigned **"
"RTN","RAORD2",71,0)
 I $G(RACMFLG("R"))'="" W:$X ! W ?12,"** A registered procedure uses contrast media **"
"RTN","RAORD2",72,0)
 W:$D(RA("MOD")) !,"Procedure Modifiers:",?22,RA("MOD")
"RTN","RAORD2",73,0)
 W !!,"Current Status:",?22,$E(RA("OST"),1,24)
"RTN","RAORD2",74,0)
 W !,"Requester:",?22,$E(RA("PHY"),1,24)
"RTN","RAORD2",75,0)
 W !?1,"Tel/Page/Dig Page: ",RA("RPHOINFO")
"RTN","RAORD2",76,0)
 W !,"Patient Location:",?22,$E(RA("HLC"),1,20)
"RTN","RAORD2",77,0)
 W:$D(RA("ROOM-BED")) !,"Room-Bed:",?22,$E(RA("ROOM-BED"),1,20)
"RTN","RAORD2",78,0)
 W !,"Entered:",?22,$S($D(RA("ODT")):RA("ODT"),1:""),"  by ",$E(RA("USR"),1,20)
"RTN","RAORD2",79,0)
 ;
"RTN","RAORD2",80,0)
ENDIS ;OE/RR Entry Point for the PRINT ACTION Option
"RTN","RAORD2",81,0)
 I '$D(RAPKG) Q:'$D(ORPK)  S RAOIFN=+ORPK Q:'$D(^RAO(75.1,RAOIFN,0))  S RAORD0=^(0),RADFN=+$P(RAORD0,"^")
"RTN","RAORD2",82,0)
 S RA("TRAN")=$S($P(RAORD0,"^",19)']"":"",1:$P($P(^DD(75.1,19,0),$P(RAORD0,"^",19)_":",2),";"))
"RTN","RAORD2",83,0)
 K RA("ST") I $D(^RADPT("AO",RAOIFN,RADFN)) S RADTI=+$O(^(RADFN,0)),RACNI=+$O(^(RADTI,0)) I $D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) S RA(0)=^(0) I $D(^RA(72,+$P(RA(0),"^",3),0)) S RA("ST")=$P(^(0),"^")
"RTN","RAORD2",84,0)
 I '$D(RAPKG) D DPRC(RAOIFN,RADFN) K ^TMP($J,"RA DIFF PRC")
"RTN","RAORD2",85,0)
 S RADIV(0)=$G(^SC(+$P(RAORD0,"^",22),0))
"RTN","RAORD2",86,0)
 S RADIV=+$$SITE^VASITE(DT,+$P(RADIV(0),"^",15)) S:RADIV<0 RADIV=0
"RTN","RAORD2",87,0)
 S RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORD2",88,0)
 S RADIVPAR=$S($D(^RA(79,+RADIV,.1)):^(.1),1:"")
"RTN","RAORD2",89,0)
 K RA("RDT") S Y=$P(RAORD0,"^",21) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("RDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD2",90,0)
 K RA("PDT") S Y=$P(RAORD0,"^",12) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("PDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD2",91,0)
 K RA("VDT") S Y=$P(RAORD0,"^",17) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("VDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD2",92,0)
 K RA("SDT") S Y=$P(RAORD0,"^",23) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("SDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD2",93,0)
 S RA("ILC")=$S('$P(RAORD0,"^",20):"UNKNOWN",'$D(^RA(79.1,+$P(RAORD0,"^",20),0)):"UNKNOWN",$D(^SC(+^(0),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RAORD2",94,0)
 I $S('$D(XQORNOD(0)):0,$P(XQORNOD(0),"^",3)'="Results Display":0,1:1),$D(RA(0)) D ^RAORR3 Q
"RTN","RAORD2",95,0)
 D ^RAORD3 K RA,RACI,RACNI,RADIV,RADIVPAR,RADPT0,RADTI,RAORD0,RAOSTS,X,Y I '$D(RAPKG) K RADFN,RAOIFN
"RTN","RAORD2",96,0)
 Q
"RTN","RAORD2",97,0)
LOCATN ; Select or default to a Rad/Nuc Med location.
"RTN","RAORD2",98,0)
 S RAONE=$$LOC1() Q:RAONE]""
"RTN","RAORD2",99,0)
 S RADIC="^RA(79.1,",RADIC(0)="QEAMZ"
"RTN","RAORD2",100,0)
 S RADIC("A")="Select Rad/Nuc Med Location: "
"RTN","RAORD2",101,0)
 S RADIC("B")="All",RAUTIL="RA L-TYPE"
"RTN","RAORD2",102,0)
 W !! D EN1^RASELCT(.RADIC,RAUTIL) K DIC,RADIC,RAUTIL,X,Y
"RTN","RAORD2",103,0)
 Q
"RTN","RAORD2",104,0)
LOC1() ; Checking for only one Imaging Location
"RTN","RAORD2",105,0)
 ; Pass back null if more that one entry exists in 79.1 
"RTN","RAORD2",106,0)
 ; If one entry, pass back: external Hosp. Loc. file_"^"_IEN of file 79.1
"RTN","RAORD2",107,0)
 N X,Y S X=""
"RTN","RAORD2",108,0)
 I $P($G(^RA(79.1,0)),"^",4)=1 D
"RTN","RAORD2",109,0)
 . S Y=+$O(^RA(79.1,0)) Q:'Y
"RTN","RAORD2",110,0)
 . S Y(0)=$G(^RA(79.1,Y,0)),Y(1)=+$P(Y(0),"^")
"RTN","RAORD2",111,0)
 . S Y(44)=$P($G(^SC(Y(1),0)),"^"),X=Y(44)_"^"_Y
"RTN","RAORD2",112,0)
 . Q
"RTN","RAORD2",113,0)
 Q X
"RTN","RAORD2",114,0)
HDR ; Header for the 'Detailed Request Display' option.  Called from above
"RTN","RAORD2",115,0)
 ; (D HDR) and from RAORD3
"RTN","RAORD2",116,0)
 W @IOF,?22,"**** Detailed Display ****",!!,"Name: ",RA("NME"),"    (",RASSN,")" S Y=RA("DOB") D D^RAUTL W ?45,"Date of Birth: ",Y,!,RALNE
"RTN","RAORD2",117,0)
 Q
"RTN","RAORD2",118,0)
 ;
"RTN","RAORD2",119,0)
DPRC(RAOIFN,RADFN) ; If the ordered procedure has been registered check
"RTN","RAORD2",120,0)
 ;if this is an examset. If not an examset, find the status of the exam
"RTN","RAORD2",121,0)
 ;RA("ST"). Also, check if the ordered procedure has been changed at
"RTN","RAORD2",122,0)
 ;time of registration (DPROC^RAUTL15). If it has, store the data off
"RTN","RAORD2",123,0)
 ;in ^TMP($J,"RA DIFF PRC").
"RTN","RAORD2",124,0)
 ;
"RTN","RAORD2",125,0)
 ; NOTE: The only time we don't set ^TMP($J,"RA DIFF PRC") is when
"RTN","RAORD2",126,0)
 ; we are using the 'Detailed Request Display' option and the ordered
"RTN","RAORD2",127,0)
 ; procedure is the same as the registered procedure.  All other
"RTN","RAORD2",128,0)
 ; Request display options output the ordered procedure, the
"RTN","RAORD2",129,0)
 ; registered procedure and exam case number if the order
"RTN","RAORD2",130,0)
 ; is active.
"RTN","RAORD2",131,0)
 ;
"RTN","RAORD2",132,0)
 ;Set the variable RACMFLG("R") to "Y" if an exam, either a single or
"RTN","RAORD2",133,0)
 ;descendant, has used contrast media during the examination.
"RTN","RAORD2",134,0)
 ;
"RTN","RAORD2",135,0)
 N RA7003,RACNI,RADTI,RAFLG K RA("ST"),^TMP($J,"RA DIFF PRC")
"RTN","RAORD2",136,0)
 S (RADTI,RAFLG)=0
"RTN","RAORD2",137,0)
 F  S RADTI=+$O(^RADPT("AO",RAOIFN,RADFN,RADTI)) Q:RADTI'>0  D
"RTN","RAORD2",138,0)
 . S RACNI=0
"RTN","RAORD2",139,0)
 . F  S RACNI=$O(^RADPT("AO",RAOIFN,RADFN,RADTI,RACNI)) Q:RACNI'>0  D
"RTN","RAORD2",140,0)
 .. I $D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) D
"RTN","RAORD2",141,0)
 ... S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),RAFLG=RAFLG+1
"RTN","RAORD2",142,0)
 ... S:$G(RACMFLG("R"))="" RACMFLG("R")=$S($P(RA7003,U,10)="Y":"Y",1:"")
"RTN","RAORD2",143,0)
 ... S RA("ST")=$$GET1^DIQ(72,+$P(RA7003,"^",3)_",",.01)
"RTN","RAORD2",144,0)
 ... N RAPRC S RAPRC=$$DPROC^RAUTL15(RADFN,RADTI,RACNI,RAOIFN)
"RTN","RAORD2",145,0)
 ... S:RAPRC]"" ^TMP($J,"RA DIFF PRC",RAPRC)=""
"RTN","RAORD2",146,0)
 ... Q
"RTN","RAORD2",147,0)
 .. Q
"RTN","RAORD2",148,0)
 . Q
"RTN","RAORD2",149,0)
 K:RAFLG>1 RA("ST") ; >1 reg. xam for this order, RA("ST") not valid
"RTN","RAORD2",150,0)
 Q
"RTN","RAORD3")
0^9^B24685743^B24179273
"RTN","RAORD3",1,0)
RAORD3 ;HISC/CAH - AISC/RMO-Detailed Request Display Cont. ;01/20/05  11:55
"RTN","RAORD3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,15,21,27,45,41,75**;Mar 16, 1998;Build 4
"RTN","RAORD3",3,0)
 I $P(RADPT0,U,2)="F" D  ;display pregnancy status for females ptch 45
"RTN","RAORD3",4,0)
 .W !,"Pregnancy Status: ",?22,$S($P(RAORD0,"^",13)="y":"Patient is Pregnant",$P(RAORD0,"^",13)="n":"Patient not pregnant at time of order",1:"Unknown")
"RTN","RAORD3",5,0)
 .Q
"RTN","RAORD3",6,0)
 W:$P(RAORD0,"^",24)="y" !?12,"*** Universal Isolation Precautions ***" W:$D(RA("VDT")) !?8,$C(7),"** Note:  Request Associated with Visit on ",RA("VDT")," **"
"RTN","RAORD3",7,0)
 W:$D(RA("RDT"))&($D(RAPKG)) !,"Desired Date:",?22,RA("RDT") W:$D(RA("PDT")) !,"Pre-op Scheduled:",?22,RA("PDT") S RAOSTS=$P(RAORD0,"^",5) I RAOSTS=8,$D(RA("SDT")) W !,"Exam Scheduled:",?22,RA("SDT")
"RTN","RAORD3",8,0)
 I RAOSTS=1 D USERCAN
"RTN","RAORD3",9,0)
 W !,"Transport:",?22,RA("TRAN")
"RTN","RAORD3",10,0)
 I $L(RA("STY_REA")) D DIWP^RAUTL5(1,68,"Reason for Study: "_RA("STY_REA")) ;P75
"RTN","RAORD3",11,0)
 D ODX^RABWUTL(RAOIFN) ;display Ordering DX and Clin Inds, Billing Aware
"RTN","RAORD3",12,0)
 I $O(^RAO(75.1,RAOIFN,"H",0)) D  Q:$G(OREND)=1!($G(RAX)="^")
"RTN","RAORD3",13,0)
 . D CHIST(RAOIFN)
"RTN","RAORD3",14,0)
 . Q
"RTN","RAORD3",15,0)
 I RAOSTS=1!(RAOSTS=3) W !,"Reason ",$S(RAOSTS=1:"Cancelled",1:"Held"),":",?22,$S($D(^RA(75.2,+$P(RAORD0,"^",10),0)):$E($P(^(0),"^"),1,50),$P(RAORD0,"^",27)]"":$E($P(RAORD0,"^",27),1,50),1:"UNKNOWN") D TEXT:RAOSTS=3
"RTN","RAORD3",16,0)
 W:$D(RA("ST")) !,"Exam Status:",?22,RA("ST") W:$D(RA("ILC")) !,"Request Submitted to: ",RA("ILC")
"RTN","RAORD3",17,0)
 G A:$P(RAORD0,"^",11)'="y",A:'$D(RADTI)!('$D(RACNI))
"RTN","RAORD3",18,0)
 W !!?7,$C(7),"** Note:  Request has been changed by the Imaging Service **"
"RTN","RAORD3",19,0)
A I $D(^RAO(75.1,RAOIFN,"T")) D ASK:$E(IOST,1,2)="C-" I $D(DIRUT) S RAX="^" K DIRUT
"RTN","RAORD3",20,0)
 Q:Y'=1  I $D(RAPKG),RAX'="^" R !!,"Press return to continue or ""^"" to escape ",X:DTIME S RAX=$E(X)
"RTN","RAORD3",21,0)
 Q
"RTN","RAORD3",22,0)
 ;
"RTN","RAORD3",23,0)
ASK W ! S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to display request status tracking log",DIR("?")="Enter 'YES' if status tracking log should be displayed, or 'NO' if not." D ^DIR K DIR S:$D(DIRUT) OREND=1 Q:$D(DIRUT)!(Y=0)
"RTN","RAORD3",24,0)
 W !!?20,"*** Request Status Tracking Log ***",!,"Date/Time",?18,"Status",?31,"User",?44,"Reason",!,"-----------------",?18,"------------",?31,"-----------",?44,"------------------------------------"
"RTN","RAORD3",25,0)
 F RALNB=0:0 S RALNB=$O(^RAO(75.1,RAOIFN,"T",RALNB)) Q:'RALNB  I $D(^(RALNB,0)) S RATORD0=^(0) D PRTLOG
"RTN","RAORD3",26,0)
Q K RALNB,RATORD0,RATODT,RATOST,RATREA,RATUSR Q
"RTN","RAORD3",27,0)
 ;
"RTN","RAORD3",28,0)
PRTLOG S (X,RATODT)=$P(RATORD0,"^") I X S RATODT=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) I $P(X,".",2) D TIME^RAUTL1 S RATODT=RATODT_" "_X
"RTN","RAORD3",29,0)
 S RATOST=$P($P(^DD(75.12,2,0),$P(RATORD0,"^",2)_":",2),";"),RATUSR=$S($D(^VA(200,+$P(RATORD0,"^",3),0)):$P(^(0),"^"),1:"")
"RTN","RAORD3",30,0)
 S RATREA=$S($D(^RA(75.2,+$P(RATORD0,"^",4),0)):$P(^(0),"^"),1:"")
"RTN","RAORD3",31,0)
 W !,RATODT,?18,$E(RATOST,1,12),?31,$E(RATUSR,1,11),?44,$E(RATREA,1,35) I $E(RATREA,36,70)'="" W !,?44,$E(RATREA,36,70)
"RTN","RAORD3",32,0)
 Q
"RTN","RAORD3",33,0)
TEXT ; display Hold Description text
"RTN","RAORD3",34,0)
 Q:'$O(^RAO(75.1,RAOIFN,1,0))
"RTN","RAORD3",35,0)
 W !,"Hold Description:",!
"RTN","RAORD3",36,0)
 K ^UTILITY($J,"W"),^(1) S DIWL=22,DIWR=75,DIWF="W"
"RTN","RAORD3",37,0)
 F RARR=0:0 S RARR=$O(^RAO(75.1,RAOIFN,1,RARR)) Q:RARR'>0  S X=^(RARR,0) D ^DIWP
"RTN","RAORD3",38,0)
 D ^DIWW
"RTN","RAORD3",39,0)
 Q
"RTN","RAORD3",40,0)
CHIST(RAY) ; display Clinical History (if applicable)
"RTN","RAORD3",41,0)
 Q:RAY'?1N.N  Q:'$O(^RAO(75.1,RAY,"H",0))
"RTN","RAORD3",42,0)
 N DIWF,DIWL,DIWR,RABAN,RARR,RAXIT
"RTN","RAORD3",43,0)
 K ^UTILITY($J,"W") S DIWL=22,DIWR=75,DIWF="",RARR=0
"RTN","RAORD3",44,0)
 F  S RARR=$O(^RAO(75.1,RAY,"H",RARR)) Q:RARR'>0  D
"RTN","RAORD3",45,0)
 . ; store into ^UTILITY($J,"W")
"RTN","RAORD3",46,0)
 . S X=$G(^RAO(75.1,RAY,"H",RARR,0)) D ^DIWP
"RTN","RAORD3",47,0)
 . Q
"RTN","RAORD3",48,0)
 S (RARR,RAXIT)=0,RABAN="Clinical History: "
"RTN","RAORD3",49,0)
 I $Y>(IOSL-4) D
"RTN","RAORD3",50,0)
 . S RAXIT=$$EOS()
"RTN","RAORD3",51,0)
 . I 'RAXIT,('$D(RAPKG)) W @IOF
"RTN","RAORD3",52,0)
 . I 'RAXIT,($D(RAPKG)) D HDR^RAORD2
"RTN","RAORD3",53,0)
 . Q
"RTN","RAORD3",54,0)
 I RAXIT S:$D(RAPKG) RAX="^" K ^UTILITY($J,"W") Q
"RTN","RAORD3",55,0)
 W !,RABAN
"RTN","RAORD3",56,0)
 F  S RARR=$O(^UTILITY($J,"W",DIWL,RARR)) Q:RARR'>0  D  Q:RAXIT
"RTN","RAORD3",57,0)
 . S X=$G(^UTILITY($J,"W",DIWL,RARR,0)) W ?22,X,!
"RTN","RAORD3",58,0)
 . I $Y>(IOSL-4) D
"RTN","RAORD3",59,0)
 .. S RAXIT=$$EOS()
"RTN","RAORD3",60,0)
 .. I 'RAXIT,('$D(RAPKG)) W @IOF
"RTN","RAORD3",61,0)
 .. I 'RAXIT,($D(RAPKG)) D HDR^RAORD2 W !
"RTN","RAORD3",62,0)
 .. Q
"RTN","RAORD3",63,0)
 . Q
"RTN","RAORD3",64,0)
 S:RAXIT&($D(RAPKG)) RAX="^" K ^UTILITY($J,"W") ; kill global
"RTN","RAORD3",65,0)
 Q
"RTN","RAORD3",66,0)
EOS() ; End of screen check for both OE/RR & Rad/Nuc Med
"RTN","RAORD3",67,0)
 ; Var List: $D(RAPKG) entry through Rad/Nuc Med, else through OE/RR
"RTN","RAORD3",68,0)
 ; Passes back 'Y', Y=1 do not continue, Y=0 continue
"RTN","RAORD3",69,0)
 ; NOTE: Sets OREND if code entered through OE/RR.  This code may be
"RTN","RAORD3",70,0)
 ;       hit when the user accesses the 'Act On Existing Orders' through
"RTN","RAORD3",71,0)
 ;       OE/RR.  'Detailed Order Display' (8^RAORR) hits ENDIS^RAORD2
"RTN","RAORD3",72,0)
 ;       which mimics (hits same code) the Rad/Nuc Med 'Detailed Request
"RTN","RAORD3",73,0)
 ;       Display' option.  The old PGBRK^ORUHDR code set OREND to 0
"RTN","RAORD3",74,0)
 ;       initially, (even though it is set to 0 upon entering this
"RTN","RAORD3",75,0)
 ;       sub-routine) and re-set it to 1 if the user enters an '^' at
"RTN","RAORD3",76,0)
 ;       the "Enter RETURN to continue or '^' to exit:" prompt.
"RTN","RAORD3",77,0)
 S Y=$$EOS^RAUTL5() S:'$D(RAPKG) OREND=Y
"RTN","RAORD3",78,0)
 Q Y
"RTN","RAORD3",79,0)
USERCAN ;user who cancelled this request
"RTN","RAORD3",80,0)
 Q:$P($G(^RAO(75.1,RAOIFN,0)),U,5)'=1  ;only look at 'discontinued'
"RTN","RAORD3",81,0)
 N RA8,RA9 S RA8=0
"RTN","RAORD3",82,0)
 F  S RA8=$O(^RAO(75.1,RAOIFN,"T",RA8)) Q:'RA8  I $G(^(RA8,0))]"",$P(^(0),U,2)=1 S RA9=RA8 ; find latest ien of 'discontinued'
"RTN","RAORD3",83,0)
 S RA("ODT")="",RA("USR")=""
"RTN","RAORD3",84,0)
 I $G(RA9) D USERCAN1
"RTN","RAORD3",85,0)
 E  D USERCAN2
"RTN","RAORD3",86,0)
 W !,"Cancelled:",?22,RA("ODT") W:RA("USR")]"" "  by ",RA("USR")
"RTN","RAORD3",87,0)
 K RA("ODT"),RA("USR")
"RTN","RAORD3",88,0)
 Q
"RTN","RAORD3",89,0)
USERCAN1 ;use request track times to get when and who cancelled
"RTN","RAORD3",90,0)
 S X=$P(^RAO(75.1,RAOIFN,"T",RA9,0),U) D:X TRDT
"RTN","RAORD3",91,0)
 S RA("USR")=$P($G(^VA(200,+$P(^RAO(75.1,RAOIFN,"T",RA9,0),U,3),0)),U)
"RTN","RAORD3",92,0)
 Q
"RTN","RAORD3",93,0)
USERCAN2 ;use vars DUZ and RAORD0 to get "who" and "when" cancelled
"RTN","RAORD3",94,0)
 S X=$P($G(RAORD0),U,18) D:X TRDT
"RTN","RAORD3",95,0)
 ; don't use  duz  if within any one of 3 rad request options
"RTN","RAORD3",96,0)
 Q:$D(RASCREEN)  Q:$D(RAOPT("ORDERPRINTS"))  Q:$D(RAOPT("ORDERPRINTPAT"))
"RTN","RAORD3",97,0)
 S RA("USR")=$P($G(^VA(200,$G(DUZ),0)),U)
"RTN","RAORD3",98,0)
 Q
"RTN","RAORD3",99,0)
TRDT S:$P(X,".",2) X=$P(X,".")_"."_$$NOSECNDS($P(X,".",2))
"RTN","RAORD3",100,0)
 S RA("ODT")=$$FMTE^XLFDT(X,"1P")
"RTN","RAORD3",101,0)
 Q
"RTN","RAORD3",102,0)
NOSECNDS(X) ; If a timestamp is associated with a date, strip off seconds.
"RTN","RAORD3",103,0)
 ; Input : X-timestamp (153048)
"RTN","RAORD3",104,0)
 ; Output: (1530)
"RTN","RAORD3",105,0)
 Q $E(X,1,4)
"RTN","RAORD5")
0^6^B27804066^B27398038
"RTN","RAORD5",1,0)
RAORD5 ;HISC/CAH,FPT,GJC AISC/RMO-Print A Request ;8/4/97  14:47
"RTN","RAORD5",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,10,15,31,45,75**;Mar 16, 1998;Build 4
"RTN","RAORD5",3,0)
 ; Input:  RADFN= Internal Number to Rad/Nuc Med Patient File #70
"RTN","RAORD5",4,0)
 ;         RAOIFN= Internal Number to Rad/Nuc Med Orders File #75.1
"RTN","RAORD5",5,0)
 ;         RAX= Null (Used to check for an '^')
"RTN","RAORD5",6,0)
 ;         RAPGE= 0 (Used as a page counter)
"RTN","RAORD5",7,0)
 ;
"RTN","RAORD5",8,0)
 ; 1-p75 10/12/2006 GJC RA*5*75 Remedy 162508 Modify Patient AGE calc
"RTN","RAORD5",9,0)
 ; 2-p75 10/12/2006 GJC RA*5*75 set REASON FOR STUDY to a local variable
"RTN","RAORD5",10,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RAORD5",11,0)
 G Q:'$D(^DPT(RADFN,0)) S RADPT0=^(0) G Q:'$D(^RAO(75.1,RAOIFN,0)) S RAORD0=^(0)
"RTN","RAORD5",12,0)
 K ^UTILITY($J,"W"),^(1) S RAOSTSYM="dc^c^h^^p^^^s",$P(RALNE,"-",79)="",$P(RALNE1,"=",79)="",DIWL=5,DIWR=75,DIWF="WC75"
"RTN","RAORD5",13,0)
 S RA("NME")=$P(RADPT0,"^"),RA("SEX")=$P(RADPT0,"^",2),RA("DOB")=$P(RADPT0,"^",3),RASSN=$$SSN^RAUTL
"RTN","RAORD5",14,0)
 S RA("AGE")=($$FMDIFF^XLFDT($P(RAORD0,U,16),RA("DOB")))\365.25 ;1-p75 
"RTN","RAORD5",15,0)
 S RA("STY_REA")=$P($G(^RAO(75.1,RAOIFN,.1)),U) ;2-p75
"RTN","RAORD5",16,0)
 S RA("PRC NODE")=$G(^RAMIS(71,+$P(RAORD0,U,2),0))
"RTN","RAORD5",17,0)
 S RA("PRC")=$E($P(RA("PRC NODE"),U),1,36)
"RTN","RAORD5",18,0)
 S RA("PRC")=$S(RA("PRC")]"":RA("PRC"),1:"UNKNOWN")
"RTN","RAORD5",19,0)
 S RA("PRCTY")=$P(RA("PRC NODE"),U,6)
"RTN","RAORD5",20,0)
 S RA("PRCTY")=$$XTERNAL^RAUTL5(RA("PRCTY"),$P($G(^DD(71,6,0)),U,2))
"RTN","RAORD5",21,0)
 S RA("PRCTY")=$E(RA("PRCTY"))_$$LOW^XLFSTR($E(RA("PRCTY"),2,99))
"RTN","RAORD5",22,0)
 S RA("CPT")=+$P(RA("PRC NODE"),U,9)
"RTN","RAORD5",23,0)
 S RA("CPT")=$P($$NAMCODE^RACPTMSC(RA("CPT"),DT),U)
"RTN","RAORD5",24,0)
 S RA("PRCIT")=+$P(RA("PRC NODE"),U,12)
"RTN","RAORD5",25,0)
 S RA("PRCIT")=$P($G(^RA(79.2,RA("PRCIT"),0)),U,3)
"RTN","RAORD5",26,0)
 S RA("CNCAT")="("_RA("PRCIT")_" "_RA("PRCTY")_" "_RA("CPT")_")"
"RTN","RAORD5",27,0)
 S RA("PRC INFO")="",$E(RA("PRC INFO"),1,36)=RA("PRC")
"RTN","RAORD5",28,0)
 S $E(RA("PRC INFO"),38,60)=RA("CNCAT") K RA("CNCAT")
"RTN","RAORD5",29,0)
 S RA("PRC MSG")=$S(+$O(^RAMIS(71,+$P(RAORD0,"^",2),3,0))>0:1,1:0)
"RTN","RAORD5",30,0)
 S RA("OUG")=$P($P(^DD(75.1,6,0),$P(RAORD0,"^",6)_":",2),";")
"RTN","RAORD5",31,0)
 K RA("MOD") F I=0:0 S I=$O(^RAO(75.1,RAOIFN,"M","B",I)) Q:'I  I $D(^RAMIS(71.2,+I,0)) S RA("MOD")=$S('$D(RA("MOD")):$P(^(0),"^"),1:RA("MOD")_", "_$P(^(0),"^")) S:$P($G(^(0)),U,2)="p" RA("PORTABLE")=""
"RTN","RAORD5",32,0)
 S RA("OST")=$$GET1^DIQ(75.1,RAOIFN_",",5)_$S($P(RAOSTSYM,"^",$P(RAORD0,"^",5))="":"",1:" ("_$P(RAOSTSYM,"^",$P(RAORD0,"^",5))_")")
"RTN","RAORD5",33,0)
 S RA("PHY")=$S($D(^VA(200,+$P(RAORD0,"^",14),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RAORD5",34,0)
 ; Requesting Physician Phone info
"RTN","RAORD5",35,0)
 D:RA("PHY")'="UNKNOWN" PHONE("R",+$P(RAORD0,"^",14))
"RTN","RAORD5",36,0)
 ; Get current primary and attending physicians
"RTN","RAORD5",37,0)
 S DFN=RADFN,VA200=1 D IN5^VADPT K VA200 S:'$D(VAIP(18)) VAIP(18)=""
"RTN","RAORD5",38,0)
 I '+$G(VAIP(7)) D
"RTN","RAORD5",39,0)
 . ; If the Primary Physician is not found (based on inpatient episode)
"RTN","RAORD5",40,0)
 . ; find the current Primary Care Practitioner (See patch SD*5.3*30)
"RTN","RAORD5",41,0)
 . ; VAIP(7) is null at this point.  VAIP(7) will exit this DO block
"RTN","RAORD5",42,0)
 . ; set to the Primary Care Practitioner or null.
"RTN","RAORD5",43,0)
 . N X S X="SDUTL3" X ^%ZOSF("TEST")
"RTN","RAORD5",44,0)
 . S:$T VAIP(7)=$$OUTPTPR^SDUTL3(RADFN)
"RTN","RAORD5",45,0)
 . Q
"RTN","RAORD5",46,0)
 ; Get Current Primary and Attending Physician Phone info
"RTN","RAORD5",47,0)
 S RA("ATTEN")=$S($P(VAIP(18),"^",2)]"":$P(VAIP(18),"^",2),1:"UNKNOWN")
"RTN","RAORD5",48,0)
 D:RA("ATTEN")'="UNKNOWN" PHONE("A",+$G(VAIP(18)))
"RTN","RAORD5",49,0)
 S RA("PRIM")=$S($P(VAIP(7),"^",2)]"":$P(VAIP(7),"^",2),1:"UNKNOWN")
"RTN","RAORD5",50,0)
 D:RA("PRIM")'="UNKNOWN" PHONE("P",+$G(VAIP(7)))
"RTN","RAORD5",51,0)
 ; Requesting location, room-bed
"RTN","RAORD5",52,0)
 S RA("HLC")=$S($D(^SC(+$P(RAORD0,"^",22),0)):$P(^(0),"^"),1:"UNKNOWN"),RA("HPH")=$S($D(^SC(+$P(RAORD0,"^",22),99)):$P(^(99),"^"),1:"") I VAIP(1) S RA("ROOM-BED")=$S(+VAIP(6):$P(VAIP(6),"^",2),1:"")
"RTN","RAORD5",53,0)
 ; Get primary and attending phys as of order date and their phone, etc.
"RTN","RAORD5",54,0)
 K RA("ODT") S Y=$P(RAORD0,"^",16) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("ODT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",55,0)
 K VAIP S DFN=RADFN,VAIP("D")=+$P(RAORD0,"^",16),VA200=1 D:VAIP("D") IN5^VADPT K VA200
"RTN","RAORD5",56,0)
 S RA("OATTEN")=$S($P($G(VAIP(18)),"^",2)]"":$P(VAIP(18),"^",2),1:"UNKNOWN")
"RTN","RAORD5",57,0)
 D:RA("OATTEN")'="UNKNOWN" PHONE("OA",+$G(VAIP(18)))
"RTN","RAORD5",58,0)
 S RA("OPRIM")=$S($P($G(VAIP(7)),"^",2)]"":$P(VAIP(7),"^",2),1:"UNKNOWN")
"RTN","RAORD5",59,0)
 D:RA("OPRIM")'="UNKNOWN" PHONE("OP",+$G(VAIP(7)))
"RTN","RAORD5",60,0)
 ; Get other order info (orderer, transport mode, etc.)
"RTN","RAORD5",61,0)
 S RA("USR")=$S($D(^VA(200,+$P(RAORD0,"^",15),0)):$P(^(0),"^"),1:"UNKNOWN"),RA("TRAN")=$S($P(RAORD0,"^",19)']"":"UNKNOWN",1:$P($P(^DD(75.1,19,0),$P(RAORD0,"^",19)_":",2),";")) S:$P(RAORD0,"^",19)="p" RA("PORTABLE")=""
"RTN","RAORD5",62,0)
 K RA("ST"),^TMP($J,"RA DIFF PRC")
"RTN","RAORD5",63,0)
 ;determine if ordered procedure has CM assoc.; return null if none
"RTN","RAORD5",64,0)
 S RACMFLG("O")=$$CMEDIA^RAO7UTL(+$P(RAORD0,U,2),$P(RA("PRC NODE"),U,6))
"RTN","RAORD5",65,0)
 ; If appropriate, determine exam status and descendant exams
"RTN","RAORD5",66,0)
 I $D(^RADPT("AO",RAOIFN,RADFN)) D DPRC^RAORD2(RAOIFN,RADFN)
"RTN","RAORD5",67,0)
 S RADIV(0)=$G(^SC(+$P(RAORD0,"^",22),0))
"RTN","RAORD5",68,0)
 S RADIV=+$$SITE^VASITE(DT,+$P(RADIV(0),"^",15)) S:RADIV<0 RADIV=0
"RTN","RAORD5",69,0)
 S RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORD5",70,0)
 S RADIVPAR=$S($D(^RA(79,+RADIV,.1)):^(.1),1:"")
"RTN","RAORD5",71,0)
 K RA("RDT") S Y=$P(RAORD0,"^",21) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("RDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",72,0)
 K RA("PDT") S Y=$P(RAORD0,"^",12) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("PDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",73,0)
 K RA("VDT") S Y=$P(RAORD0,"^",17) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("VDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",74,0)
 K RA("SDT") S Y=$P(RAORD0,"^",23) I Y S:$P(Y,".",2) Y=$P(Y,".")_"."_$$NOSECNDS^RAORD3($P(Y,".",2)) S RA("SDT")=$$FMTE^XLFDT(Y,"1P")
"RTN","RAORD5",75,0)
 S RA("ILC")=$S('$P(RAORD0,"^",20):"UNKNOWN",'$D(^RA(79.1,+$P(RAORD0,"^",20),0)):"UNKNOWN",$D(^SC(+^(0),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","RAORD5",76,0)
 D ^RAORD6
"RTN","RAORD5",77,0)
 ;
"RTN","RAORD5",78,0)
Q K DIWF,DIWL,DIWR,I,RA,RABARC,RABARC0,RABARC1,RADIV,RADIVPAR,RADPT0,RALNE,RALNE1,RAORD0,RAOSTSYM,RATAB,RAV,RASSN,RAXX,VA200,VAERR,VAIP,X,X1,X2,X3,Y,ZZ
"RTN","RAORD5",79,0)
 K RACMFLG,RALOC,^TMP($J,"RA DIFF PRC")
"RTN","RAORD5",80,0)
 Q
"RTN","RAORD5",81,0)
PHONE(X,Y) ; Setup phone information for Resident Physicians, Attending
"RTN","RAORD5",82,0)
 ; Physicians, and Primary Physicians.
"RTN","RAORD5",83,0)
 ; 'X' -> $S('A':'Attending','OA':'Old Attending','OP':'Old Primary',
"RTN","RAORD5",84,0)
 ; ,'P':'Primary','R':'Resident')
"RTN","RAORD5",85,0)
 ; 'Y' -> ien for file 200
"RTN","RAORD5",86,0)
 ; RA(X_"PHON")=Phone node  <> RA(X_"OPHO")=Office phone
"RTN","RAORD5",87,0)
 ; RA(X_"VPGR")=Voice pager <> RA(X_"DPGR")=Digital pager
"RTN","RAORD5",88,0)
 ; RA(X_"PHOINFO")=office phone/voice pager/digital pager
"RTN","RAORD5",89,0)
 S RA(X_"PHON")=$G(^VA(200,+Y,.13))
"RTN","RAORD5",90,0)
 S RA(X_"OPHO")=$P(RA(X_"PHON"),U,2),RA(X_"VPGR")=$P(RA(X_"PHON"),U,7)
"RTN","RAORD5",91,0)
 S RA(X_"DPGR")=$P(RA(X_"PHON"),U,8)
"RTN","RAORD5",92,0)
 S RA(X_"PHOINFO")=RA(X_"OPHO")_" / "_RA(X_"VPGR")_" / "_RA(X_"DPGR")
"RTN","RAORD5",93,0)
 S:RA(X_"PHOINFO")=" /  / " RA(X_"PHOINFO")="Unknown"
"RTN","RAORD5",94,0)
 Q
"RTN","RAORD6")
0^7^B47839640^B44913351
"RTN","RAORD6",1,0)
RAORD6 ;HISC/CAH - AISC/RMO-Print A Request Cont. ;2/2/98  15:28
"RTN","RAORD6",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,10,15,18,27,45,41,75**;Mar 16, 1998;Build 4
"RTN","RAORD6",3,0)
 ; 3-p75 10/12/2006 GJC RA*5*75 print Reason for Study
"RTN","RAORD6",4,0)
 ; 4-p75 10/12/2006 KAM RA*5*75 display the request print date in the header
"RTN","RAORD6",5,0)
 ; 5-p75 10/12/2006 KAM RA*5*75 update header "Age" to "Age at req"
"RTN","RAORD6",6,0)
 D HD Q:RAX["^"
"RTN","RAORD6",7,0)
 I $P(RADPT0,U,2)="F" D  ;display pregnancy status for females ptch 45
"RTN","RAORD6",8,0)
 .W !,"Pregnancy Status: ",?22,$S($P(RAORD0,"^",13)="y":"Patient is Pregnant",$P(RAORD0,"^",13)="n":"Patient not pregnant at time of order",1:"Unknown")
"RTN","RAORD6",9,0)
 .Q
"RTN","RAORD6",10,0)
 W:$P(RAORD0,"^",24)="y" !!?12,"*** Universal Isolation Precautions ***"
"RTN","RAORD6",11,0)
 W:$D(RA("VDT")) !!?8,"** Note Request Associated with Visit on ",RA("VDT")," **"
"RTN","RAORD6",12,0)
 W !!,"Requested:",?18,RA("PRC INFO")
"RTN","RAORD6",13,0)
 I $D(^TMP($J,"RA DIFF PRC")),('$D(RAFOERR)),('$D(RAOPT("REG"))),('$D(RAOPT("ORDEREXAM"))),('$D(RAOPT("ADDEXAM"))) D  Q:RAX["^"
"RTN","RAORD6",14,0)
 . ; don't print registered procedure info (CPT, Proc Type, Imaging
"RTN","RAORD6",15,0)
 . ; Type) if entering through 'Request An Exam', 'Register Patient
"RTN","RAORD6",16,0)
 . ; for Exams' or 'Add Exams To Last Visit'.  Don't print if ordered
"RTN","RAORD6",17,0)
 . ; through ANY version of OE/RR.  If ordered through OE/RR, RAFOERR
"RTN","RAORD6",18,0)
 . ; will be defined. (Set in RAORD1 & RAO7RO)
"RTN","RAORD6",19,0)
 . N RAT,RA18NLIN S RAT="",RA18NLIN=0 W !,"Registered:"
"RTN","RAORD6",20,0)
 . F  S RAT=$O(^TMP($J,"RA DIFF PRC",RAT)) Q:RAT=""  D  Q:RAX["^"
"RTN","RAORD6",21,0)
 .. D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",22,0)
 .. W:RA18NLIN ! W ?12,RAT
"RTN","RAORD6",23,0)
 .. S RA18NLIN=1
"RTN","RAORD6",24,0)
 .. Q
"RTN","RAORD6",25,0)
 . Q
"RTN","RAORD6",26,0)
 I $G(RACMFLG("O"))'="" W !?12,"** The requested procedure has contrast media assigned **"
"RTN","RAORD6",27,0)
 I $G(RACMFLG("R"))'="" W !?12,"** A registered procedure uses contrast media **"
"RTN","RAORD6",28,0)
 W:$D(RA("MOD")) !,"Procedure Modifiers:",?22,RA("MOD")
"RTN","RAORD6",29,0)
 I RA("PRC MSG") D  Q:RAX["^"
"RTN","RAORD6",30,0)
 . N A,B,C,X S (A,C)=0 W !,"Procedure Message: ",!
"RTN","RAORD6",31,0)
 . F  S A=$O(^RAMIS(71,+$P(RAORD0,"^",2),3,A)) Q:A'>0!(RAX["^")  D
"RTN","RAORD6",32,0)
 .. S B=+$G(^RAMIS(71,+$P(RAORD0,"^",2),3,A,0))
"RTN","RAORD6",33,0)
 .. S X=$G(^RAMIS(71.4,B,0))
"RTN","RAORD6",34,0)
 .. W:'C ?3,"-" W:C !?3,"-"
"RTN","RAORD6",35,0)
 .. D OUTTEXT^RAUTL9(X,"",5,80,4,"","!")
"RTN","RAORD6",36,0)
 .. D HD:($Y+6)>IOSL S C=C+1
"RTN","RAORD6",37,0)
 .. Q
"RTN","RAORD6",38,0)
 . Q
"RTN","RAORD6",39,0)
 W !,"Request Status:",?22,$E(RA("OST"),1,24)
"RTN","RAORD6",40,0)
 I $P(RAORD0,"^",5)=1!($P(RAORD0,"^",5)=3) D  Q:RAX["^"
"RTN","RAORD6",41,0)
 . W !,"Reason ",$S($P(RAORD0,"^",5)=1:"Cancelled",1:"Held"),":"
"RTN","RAORD6",42,0)
 . W ?22,$S($D(^RA(75.2,+$P(RAORD0,"^",10),0)):$E($P(^(0),"^"),1,50),$P(RAORD0,"^",27)]"":$E($P(RAORD0,"^",27),1,50),1:"UNKNOWN")
"RTN","RAORD6",43,0)
 . D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",44,0)
 . I $D(^RAO(75.1,RAOIFN,1)) D  Q:RAX["^"
"RTN","RAORD6",45,0)
 .. N X,I,RAXX
"RTN","RAORD6",46,0)
 .. K ^UTILITY($J,"W")
"RTN","RAORD6",47,0)
 .. W !,"Hold Description:",!
"RTN","RAORD6",48,0)
 .. S I=0 F  S I=$O(^RAO(75.1,RAOIFN,1,I)) Q:'I  S (RAXX,X)=^(I,0) D HD:($Y+6)>IOSL Q:RAX["^"  S X=RAXX D ^DIWP
"RTN","RAORD6",49,0)
 .. Q:RAX["^"
"RTN","RAORD6",50,0)
 .. D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",51,0)
 .. D ^DIWW:$D(RAXX)
"RTN","RAORD6",52,0)
 .. D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",53,0)
 . I $P(RAORD0,"^",5)=1 D
"RTN","RAORD6",54,0)
 .. W !!,?(IOM-(IOM/2+15)),"*********************",!,?(IOM-(IOM/2+15)),"* C A N C E L L E D *",!,?(IOM-(IOM/2+15)),"*********************"
"RTN","RAORD6",55,0)
 W:$P(RAORD0,"^",5)=6&($D(RA("ST"))) !,"Exam Status:",?22,RA("ST")
"RTN","RAORD6",56,0)
 W:$P(RAORD0,"^",5)=8&($D(RA("SDT"))) !,"Exam Scheduled:",?22,RA("SDT")
"RTN","RAORD6",57,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",58,0)
 W !!,"Requester:",?22,$E(RA("PHY"),1,20)
"RTN","RAORD6",59,0)
 W:RA("PHY")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("RPHOINFO"))
"RTN","RAORD6",60,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",61,0)
 W !,"Attend Phy Current:",?22,$E(RA("ATTEN"),1,20)
"RTN","RAORD6",62,0)
 W:RA("ATTEN")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("APHOINFO"))
"RTN","RAORD6",63,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",64,0)
 W !,"Prim Phy Current:",?22,$E(RA("PRIM"),1,20)
"RTN","RAORD6",65,0)
 W:RA("PRIM")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("PPHOINFO"))
"RTN","RAORD6",66,0)
 K RAPASS1,RAPASS2
"RTN","RAORD6",67,0)
 S RAPASS1=RA("ATTEN"),RAPASS2=RA("OATTEN")
"RTN","RAORD6",68,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",69,0)
 I $$ID^RAORD6(RAPASS1,RAPASS2) D
"RTN","RAORD6",70,0)
 . W !,"Attend Phy At Order:",?22,$E(RA("OATTEN"),1,20)
"RTN","RAORD6",71,0)
 . W:RA("OATTEN")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("OAPHOINFO"))
"RTN","RAORD6",72,0)
 . Q
"RTN","RAORD6",73,0)
 S RAPASS1=RA("PRIM"),RAPASS2=RA("OPRIM")
"RTN","RAORD6",74,0)
 I $$ID^RAORD6(RAPASS1,RAPASS2) D
"RTN","RAORD6",75,0)
 . W !,"Prim Phy At Order:",?22,$E(RA("OPRIM"),1,20)
"RTN","RAORD6",76,0)
 . W:RA("OPRIM")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("OPPHOINFO"))
"RTN","RAORD6",77,0)
 . Q
"RTN","RAORD6",78,0)
 K RAPASS1,RAPASS2
"RTN","RAORD6",79,0)
 I +$P(RAORD0,"^",8) D
"RTN","RAORD6",80,0)
 . N RAPPRAD S RAPPRAD=+$P(RAORD0,"^",8)
"RTN","RAORD6",81,0)
 . S:$P($G(^VA(200,RAPPRAD,20)),"^",2)]"" RAPPRAD=$P(^(20),"^",2)
"RTN","RAORD6",82,0)
 . S:RAPPRAD=+RAPPRAD RAPPRAD=$P(^VA(200,RAPPRAD,0),"^")
"RTN","RAORD6",83,0)
 . W !,"Approved by: ",?22,RAPPRAD
"RTN","RAORD6",84,0)
 . Q
"RTN","RAORD6",85,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",86,0)
 W !,"Date/Time Ordered:",?22,$S($D(RA("ODT")):RA("ODT"),1:""),"  by ",$E(RA("USR"),1,20)
"RTN","RAORD6",87,0)
 W:$D(RA("RDT")) !,"Date Desired:",?22,RA("RDT")
"RTN","RAORD6",88,0)
 D:$P(RAORD0,"^",5)=1 USERCAN^RAORD3
"RTN","RAORD6",89,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",90,0)
 W:$D(RA("PDT")) !,"Pre-op Date/Time:",?22,RA("PDT"),!!?26,"**** P R E - O P ****",!
"RTN","RAORD6",91,0)
BAR ;Print bar-coded SSN on request form if term type has bar code setup
"RTN","RAORD6",92,0)
 I $G(RASSN)'?3N1"-"2N1"-".E G CONT
"RTN","RAORD6",93,0)
 S X3=$E(RASSN,1,3)_$E(RASSN,5,6)_$E(RASSN,8,11)
"RTN","RAORD6",94,0)
 D PSET^%ZISP I IOBARON]"",(IOBAROFF]"") W !?49,@IOBARON,X3,@IOBAROFF,!
"RTN","RAORD6",95,0)
 D PKILL^%ZISP
"RTN","RAORD6",96,0)
 ;
"RTN","RAORD6",97,0)
CONT D HD:($Y+6)>IOSL Q:RAX["^"  D ODX^RABWUTL(RAOIFN) ; * Billing Aware *
"RTN","RAORD6",98,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",99,0)
 I $L(RA("STY_REA")) D DIWP^RAUTL5(1,68,"Reason for Study: "_RA("STY_REA")) ;3-p75
"RTN","RAORD6",100,0)
 D HD:($Y+6)>IOSL Q:RAX["^"  K ^UTILITY($J,"W"),^(1) W !,"Clinical History:",! K RAXX F RAV=0:0 S RAV=$O(^RAO(75.1,RAOIFN,"H",RAV)) Q:'RAV  I $D(^(RAV,0)) S RAXX=^(0) D HD:($Y+6)>IOSL Q:RAX["^"  S X=RAXX D ^DIWP
"RTN","RAORD6",101,0)
 Q:RAX["^"  D HD:($Y+6)>IOSL Q:RAX["^"  D ^DIWW:$D(RAXX),HD:($Y+6)>IOSL Q:RAX["^"  D WORK ;always print bottom section of form 012601
"RTN","RAORD6",102,0)
 W ! S BOT=IOSL-($Y+4) S:($E(IOST,1,6)="P-BROW"&($D(DDBRZIS))) BOT=5 F BT=1:1:BOT W !
"RTN","RAORD6",103,0)
 K BOT,BT
"RTN","RAORD6",104,0)
 W !,"VA Form 519a-ADP"
"RTN","RAORD6",105,0)
 Q
"RTN","RAORD6",106,0)
 ;
"RTN","RAORD6",107,0)
WORK W !,RALNE,!,"Date Performed: ________________________",?46
"RTN","RAORD6",108,0)
 I $O(^RADPT("AO",RAOIFN,0))="" W "Case No.: ______________________"
"RTN","RAORD6",109,0)
 E  W "Case No.: ______see above_______"
"RTN","RAORD6",110,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",111,0)
 W !,"Technologist Initials: _________________"
"RTN","RAORD6",112,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",113,0)
 W !?46,"Number/Size Films: _____________",!,"Interpreting Phys. Initials: ___________",?65,"_____________",!?65,"_____________",!
"RTN","RAORD6",114,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",115,0)
 W !,"Comments:"
"RTN","RAORD6",116,0)
 ;
"RTN","RAORD6",117,0)
TC D EN30^RAO7PC1(RAOIFN),TC^RAORD61 Q:RAX["^"
"RTN","RAORD6",118,0)
 ;
"RTN","RAORD6",119,0)
DASHLN W ! F I=1:1:5 D HD:($Y+6)>IOSL Q:RAX["^"  W !,RALNE ;P18
"RTN","RAORD6",120,0)
 Q
"RTN","RAORD6",121,0)
 ;
"RTN","RAORD6",122,0)
HD S:'$D(RAPGE) RAPGE=0 D CRCHK Q:$G(RAX)["^"  S RATAB=$S($D(RA("ILC")):1,1:16)
"RTN","RAORD6",123,0)
 ;10/12/2006 KAM Remedy tk 162508 Changed next line added "Printed:"
"RTN","RAORD6",124,0)
 W:$Y @IOF W !?RATAB,">>"_$S($D(RACRHD):"Discontinued ",1:"")_"Rad/NM Consultation" W:$D(RA("ILC")) " for ",$E(RA("ILC"),1,17) W "<<Printed:" S X="NOW",%DT="T" D ^%DT K %DT D D^RAUTL W ?52,Y ;P18 4-P74
"RTN","RAORD6",125,0)
 S RAPGE=RAPGE+1 W ?71,"Page ",RAPGE ;P18
"RTN","RAORD6",126,0)
 W !,RALNE1,!,"Name         : ",RA("NME"),?46,"Urgency    : ",RA("OUG") W:$D(RA("PORTABLE")) "  *PORTABLE*"
"RTN","RAORD6",127,0)
 W !,"Pt ID Num    : ",RASSN,?46,"Transport  : ",RA("TRAN")
"RTN","RAORD6",128,0)
 S Y=RA("DOB") D D^RAUTL W !,"Date of Birth: ",Y,?46,"Patient Loc: ",$E(RA("HLC"),1,20)
"RTN","RAORD6",129,0)
 ;10/12/2006 KAM Remedy Ticket 162508 changed next line
"RTN","RAORD6",130,0)
 W !,"Age at req   : ",RA("AGE"),?46,"Phone Ext  : ",RA("HPH") ;5-P75
"RTN","RAORD6",131,0)
 W !,"Sex          : ",$S(RA("SEX")="M":"MALE",1:"FEMALE") W:$D(RA("ROOM-BED")) ?46,"Room-Bed   : ",RA("ROOM-BED") W !,RALNE1
"RTN","RAORD6",132,0)
 W:$P(RAORD0,U,5)=1 !,"***C A N C E L L E D***",?56,"***C A N C E L L E D***"
"RTN","RAORD6",133,0)
 Q
"RTN","RAORD6",134,0)
 ;
"RTN","RAORD6",135,0)
CRCHK I RAPGE,$E(IOST)="C" W !!,$C(7),"Press RETURN to continue or '^' to stop " R X:DTIME S RAX=X
"RTN","RAORD6",136,0)
 Q
"RTN","RAORD6",137,0)
ID(X,Y) ; Checks for the following condition:
"RTN","RAORD6",138,0)
 ; 1) Attending Phy. Current & Attending Phy. At Order are the same.
"RTN","RAORD6",139,0)
 ; 2) Primary Phy. Current & Primary Phy. At Order are the same.
"RTN","RAORD6",140,0)
 ; Input Variables:
"RTN","RAORD6",141,0)
 ; 'X'-> Attending/Primary Phy. Current
"RTN","RAORD6",142,0)
 ; 'Y'-> Attending/Primary Phy. At Order
"RTN","RAORD6",143,0)
 I X']""!(Y']"") Q 0
"RTN","RAORD6",144,0)
 I $$UP^XLFSTR(X)="UNKNOWN",($$UP^XLFSTR(Y)="UNKNOWN") Q 0
"RTN","RAORD6",145,0)
 N A,B,Z S A=+$O(^VA(200,"B",X,"")),B=+$O(^VA(200,"B",Y,""))
"RTN","RAORD6",146,0)
 I A>0,(B>0),(A=B) S Z=0
"RTN","RAORD6",147,0)
 E  S Z=1
"RTN","RAORD6",148,0)
 Q Z ; $S(Z=1:"different physician",Z=0:"same physician")
"RTN","RAORDU1")
0^2^B32546485^B30958799
"RTN","RAORDU1",1,0)
RAORDU1 ;HISC/CAH - AISC/SAW-Utility for Rad/NM Orders Module ;10/27/97  12:56
"RTN","RAORDU1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,41,75**;Mar 16, 1998;Build 4
"RTN","RAORDU1",3,0)
CP ;Create protocols for Rad/Nuc Med in OE/RR Protocol file (#100)
"RTN","RAORDU1",4,0)
 ;based upon entries in the Rad/Nuc Med Common Procedure file (#71.3)
"RTN","RAORDU1",5,0)
 ;
"RTN","RAORDU1",6,0)
 I $$ORVR^RAORDU()>2.5 W !!,"In order to use this option, your site must be running version 2.5 of the",!,"Order Entry/Results Reporting package." G Q
"RTN","RAORDU1",7,0)
 ;
"RTN","RAORDU1",8,0)
 ;Check/set package and default protocol values
"RTN","RAORDU1",9,0)
 S ORPKG=$O(^DIC(9.4,"C","RA",0)) I 'ORPKG W !,*7,"There is no entry for the Radiology/Nuclear Medicine package in your Package",!,"file (#9.4), unable to proceed.  Contact your site manager." G Q
"RTN","RAORDU1",10,0)
 S ORDEF=$O(^ORD(101,"B","RA OERR DEFAULT PROTOCOL",0)) I 'ORDEF W !,*7,"You do not have a default Radiology/Nuclear Medicine protocol in your",!,"Protocol file (#101), unable to continue.  Contact your site manager." G Q
"RTN","RAORDU1",11,0)
 S (I,RACNT,RAF1,X)=0 K ^TMP($J,"RAEX") W !!?10,"Create an OE/RR Protocol from a Radiology/Nuclear Medicine",!?10,"Common Procedure",!
"RTN","RAORDU1",12,0)
 F  S I=$O(^RAMIS(71.3,I)) Q:I'>0  I $D(^(I,0)) S Y=I_"^"_^(0) I $P(Y,"^",6)']"",$D(^RAMIS(71,+$P(Y,"^",2),0)) S RACNT=RACNT+1,^TMP($J,"RAEX",RACNT)=Y W !,RACNT,?6,$P(^RAMIS(71,+$P(Y,"^",2),0),"^") D:'(RACNT#15) ASK^RAUTL4 Q:X="^"!(X>0)
"RTN","RAORDU1",13,0)
 G Q:X="^" I 'RACNT W !,*7,"The Common Procedures file does not have any entries from which to choose." G Q
"RTN","RAORDU1",14,0)
 I RACNT=1 S RADUP(1)="" W !!,"There is only one Common Procedure to choose from." S DIR(0)="YA",DIR("A")="Okay to continue? " D ^DIR G Q:Y'=1,CP1
"RTN","RAORDU1",15,0)
 I X'>0,RACNT#15 D ASK^RAUTL4 G Q:'$D(RADUP)
"RTN","RAORDU1",16,0)
CP1 S RAI=0 F  S RAI=$O(RADUP(RAI)) Q:RAI'>0  S Y=^TMP($J,"RAEX",RAI),DA=+Y,Y=$P(Y,"^",2,99) W !!,"Processing the ",$P(^RAMIS(71,+Y,0),"^")," procedure.",! D CP2
"RTN","RAORDU1",17,0)
Q K %1,D,D0,DA,DIC,DIE,DIR,DR,I,J,K,ORDEF,OREA,ORFL,ORPKG,ORTXT,RACNT,RADUP,RAERR,RAF1,RAI,RAILOC,RAPAR,RASEL,X,Y,Z,^TMP($J,"RAEX")
"RTN","RAORDU1",18,0)
 K DI,DIG,DIH,DIU,DIV,DQ
"RTN","RAORDU1",19,0)
 Q
"RTN","RAORDU1",20,0)
CP2 S RAERR=0 S RAILOC=$P(Y,"^",8) I 'RAILOC S RAILOC=$O(^RA(79.1,0)) I RAILOC,$O(^(RAILOC)) K RAILOC W !,*7,"You must enter an 'Imaging Location' before this procedure can be processed",!,"as an orderable item in OE/RR." S RAERR=1
"RTN","RAORDU1",21,0)
 S ORTXT=$P(Y,"^",13) I ORTXT']"" W !,*7,"You must enter a 'Name of Ordeable Item' before this procedure can be processed",!,"as an orderable item in OE/RR." S RAERR=1
"RTN","RAORDU1",22,0)
 I RAERR K RAILOC,ORTXT Q
"RTN","RAORDU1",23,0)
 S ORFL=+Y_";RAMIS(71,",OREA="S RADR1=1,RAPRI="_+Y_",RAILOC="_RAILOC_$S($P(Y,"^",11):",RARU="_$P(Y,"^",11),1:"")
"RTN","RAORDU1",24,0)
 S Z="^^^^^RACAT^RAREQDT^^RAMT^RAIP" F X=6,9,10 S OREA=OREA_$S($P(Y,"^",X)]"":","_$P(Z,"^",X)_"="_""""_$P(Y,"^",X)_"""",1:"")
"RTN","RAORDU1",25,0)
 I $O(^RAMIS(71.3,DA,"M",0)) S K=0 F J=1:1 S K=$O(^RAMIS(71.3,DA,"M",K)) Q:K'>0  S X=$G(^(K,0)) I $D(^RAMIS(71.2,+X,0)) S X=$P(^(0),"^") I X]"" S OREA=OREA_",RAMOD("_J_")="_""""_X_""""
"RTN","RAORDU1",26,0)
 S OREA=OREA_" D ^RAORR"
"RTN","RAORDU1",27,0)
 I $G(^DIC(9.4,ORPKG,0))]"" N RA1 S RA1=$P(^(0),"^",2)_+ORFL_" "_ORTXT S:$O(^ORD(101,"B",RA1,0)) ORDA=$O(^(0)) ; define ORDA if filelink record exists in file #101
"RTN","RAORDU1",28,0)
 ;D EN3^ORUPREF2 W:$D(Y) !,*7,"Unable to create an orderable item in OE/RR."
"RTN","RAORDU1",29,0)
 Q  ;dead code OE 2.5 from CP down to here
"RTN","RAORDU1",30,0)
 ;
"RTN","RAORDU1",31,0)
DISP ;Display request with defaults
"RTN","RAORDU1",32,0)
 S:'$D(RAMOD)#2 RAMOD=""
"RTN","RAORDU1",33,0)
 S J="",$P(J,"-",80)="" W !!,J
"RTN","RAORDU1",34,0)
 I $D(RAMOD)>9 S RAMOD="" F I=1:1 Q:'$D(RAMOD(I))  S RAMOD=RAMOD_$S(I'=1:", ",1:"")_RAMOD(I) S RAI=0 S RAI=+$O(^RAMIS(71.2,"B",RAMOD(I),RAI)) I $P($G(^RAMIS(71.2,RAI,0)),U,2)="p" S RAACI="p"
"RTN","RAORDU1",35,0)
 W !?10,"Patient: ",RANME I RASEX'="M" S:'$D(RAPREG) RAPREG="" W ?58,"Pregnant: ",$S(RAPREG="y":"YES",RAPREG="u":"UNKNOWN",RAPREG="n":"NO",1:"")
"RTN","RAORDU1",36,0)
 W !?8,"Procedure: ",$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),"^"),1:"UNKNOWN"),!?2,"Proc. Modifiers: ",RAMOD
"RTN","RAORDU1",37,0)
 S:'$D(RAMT) RAMT=$S($G(RAACI)="p":"p",$E(RACAT)="I":"w",1:"a") S RAMT=RAMT_"^"_$P($P(^DD(75.1,19,0),RAMT_":",2),";") W !?9,"Category: ",RACAT,?49,"Mode of Transport: ",$P(RAMT,"^",2)
"RTN","RAORDU1",38,0)
 S:'$D(RAIP) RAIP="n" W !,"     Desired Date: ",RAWHEN,?46,"Isolation Procedures: ",$S(RAIP="y":"YES",1:"NO")
"RTN","RAORDU1",39,0)
 S:'$D(RARU) RARU=9 W !,"  Request Urgency: ",$S($D(RARU):$P($P(^DD(75.1,6,0),RARU_":",2),";"),1:"ROUTINE"),?46,"Scheduled for Pre-op: ",$S($D(RAPREOP1):"YES",1:"NO")
"RTN","RAORDU1",40,0)
 I $D(RAILOC) W !,"Submit Request To: ",$S($D(^RA(79.1,+RAILOC,0)):$S($D(^SC(+$P(^(0),"^"),0)):$P(^(0),"^"),1:"Unknown"),1:"Unknown")
"RTN","RAORDU1",41,0)
 W !," Request Location: ",$S($P($G(^SC(+RALIFN,0)),U)]"":$E($P($G(^SC(+RALIFN,0)),U),1,26),1:"Unkown") I $$ORVR^RAORDU()'<3 W ?46,"Nature of order:  SVC CORRECTION"
"RTN","RAORDU1",42,0)
 D DISREA(RAREAST) ;display the reason for study
"RTN","RAORDU1",43,0)
 ;*Billing Aware Project:
"RTN","RAORDU1",44,0)
 ;   Display New ICD-9 Dx and their related SC/EI/MST/HNC responses.
"RTN","RAORDU1",45,0)
 ;
"RTN","RAORDU1",46,0)
BADISP D:$P($G(RABWDX(1)),U,1)>0 BADISP^RABWORD1(.RABWDX)
"RTN","RAORDU1",47,0)
 ;*
"RTN","RAORDU1",48,0)
 K ^UTILITY($J,"W"),^(1) S DIWF="WN",DIWL=1,DIWR=79,I=0 W !!,"Clinical History:",! F  S I=$O(^TMP($J,"RAWP",I)) Q:I'>0  S X=^(I,0) D ^DIWP
"RTN","RAORDU1",49,0)
 D ^DIWW W !,J
"RTN","RAORDU1",50,0)
 S DIR(0)="Y",DIR("A")="Do you want to change any of the above",DIR("B")="NO" D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) RAOUT=1 Q:$D(RAOUT)  S:Y=0 RADR1=1 S:Y'=0 RADR2=1,RASTOP=0
"RTN","RAORDU1",51,0)
 ; RASTOP is used to track whether the procedure messages have printed.
"RTN","RAORDU1",52,0)
 ; If you answer 'yes' to "Do you want to edit this request", you
"RTN","RAORDU1",53,0)
 ; will see the procedure messages again (if they exist and if you
"RTN","RAORDU1",54,0)
 ; viewed them before.  Value altered in ADDORD+1^RAORD1 & EN2+1^RAPRI)
"RTN","RAORDU1",55,0)
 Q
"RTN","RAORDU1",56,0)
 ;
"RTN","RAORDU1",57,0)
DISREA(X) ;this function formats and displays the reason for study for this
"RTN","RAORDU1",58,0)
 ;order.
"RTN","RAORDU1",59,0)
 ;input: X - the reason for study (a string between three & sixty four
"RTN","RAORDU1",60,0)
 ;characters in length)
"RTN","RAORDU1",61,0)
 N %,DIW,DIWF,DIWI,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,I,LINES,Z
"RTN","RAORDU1",62,0)
 ;accumulate & format data; column width of sixty (DIWF's C60) characters
"RTN","RAORDU1",63,0)
 S DIWF="C60",DIWL=1 D ^DIWP
"RTN","RAORDU1",64,0)
 W !," Reason for Study: " S I=0,LINES=^UTILITY($J,"W",DIWL)
"RTN","RAORDU1",65,0)
 ;LINES: # of formatted lines in ^UTILITY
"RTN","RAORDU1",66,0)
 F  S I=$O(^UTILITY($J,"W",DIWL,I)) Q:'I  W ?19,$G(^(I,0)) W:I'=LINES !
"RTN","RAORDU1",67,0)
 K ^UTILITY($J,"W",DIWL)
"RTN","RAORDU1",68,0)
 Q
"RTN","RAORDU1",69,0)
 ;
"RTN","RART3")
0^11^B23818641^B21497929
"RTN","RART3",1,0)
RART3 ;HISC/GJC,SWM-Reporting Menu (Part 2) ;8/31/99  13:57
"RTN","RART3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,10,18,27,35,45,75**;Mar 16, 1998;Build 4
"RTN","RART3",3,0)
 ; continue from RART1
"RTN","RART3",4,0)
 ; last modif by SS for P18
"RTN","RART3",5,0)
QRPT ; Queue the report to run
"RTN","RART3",6,0)
 N X K IOP,%ZIS S %ZIS="Q",%ZIS("B")=""
"RTN","RART3",7,0)
 S %ZIS("S")="I $E($P($G(^%ZIS(2,+$P($G(^(""SUBTYPE"")),""^""),0)),""^""),1,2)=""P-"""
"RTN","RART3",8,0)
 W ! D ^%ZIS
"RTN","RART3",9,0)
 I POP D Q6^RART1 Q
"RTN","RART3",10,0)
 I $E(IOST,1,2)="P-",('$D(IO("Q"))) D
"RTN","RART3",11,0)
 . D PRT^RARTR
"RTN","RART3",12,0)
 . Q
"RTN","RART3",13,0)
 I $D(IO("Q")) D
"RTN","RART3",14,0)
 . K RANME,RAPRC,Y S U="^",DT=$S($G(DT)]"":DT,1:$$DT^XLFDT())
"RTN","RART3",15,0)
 . S ZTDESC="Rad/Nuc Med Abnormal Report Alert",ZTRTN="PRT^RARTR"
"RTN","RART3",16,0)
 . S:$D(RARTMES) ZTSAVE("RARTMES")=""
"RTN","RART3",17,0)
 . F I="DT","RARPT","U" S ZTSAVE(I)=""
"RTN","RART3",18,0)
 . D ^%ZTLOAD W:$D(ZTSK) "   Task # ",ZTSK
"RTN","RART3",19,0)
 . K IO("Q"),ZTDESC,ZTRTN,ZTSAVE
"RTN","RART3",20,0)
 . Q
"RTN","RART3",21,0)
 W ! D ^%ZISC,HOME^%ZIS
"RTN","RART3",22,0)
 D Q6^RART1,EXIT^RART
"RTN","RART3",23,0)
 Q
"RTN","RART3",24,0)
PHYS N RA2ND,R1,R2,RASTR
"RTN","RART3",25,0)
 S (R1,R2)=0 F  S R2=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SRR",R2)) Q:'R2  S:+$G(^(R2,0)) R1=R1+1,RA2ND("SRR",R1)=+^(0),RA2ND("SRR",R1)=$E($P($G(^VA(200,RA2ND("SRR",R1),0)),"^"),1,20)
"RTN","RART3",26,0)
 S (R1,R2)=0 F  S R2=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"SSR",R2)) Q:'R2  S:+$G(^(R2,0)) R1=R1+1,RA2ND("SSR",R1)=+^(0),RA2ND("SSR",R1)=$E($P($G(^VA(200,RA2ND("SSR",R1),0)),"^"),1,20)
"RTN","RART3",27,0)
 S R1=$E($P($G(^VA(200,+$P(R3,"^",15),0)),"^"),1,15)
"RTN","RART3",28,0)
 S RASTR="Staff Phys: "_R1 S:R1]"" RASTR=RASTR_" (P)"
"RTN","RART3",29,0)
PHYS1 I '$O(RA2ND("SSR",0)) W !,RASTR G PHYS2
"RTN","RART3",30,0)
 S R1=0
"RTN","RART3",31,0)
PHYS11 S R1=$O(RA2ND("SSR",R1)) G:R1="" PHYS19
"RTN","RART3",32,0)
 I $L(RASTR)+$L(RA2ND("SSR",R1))>79 W !,RASTR,";" S RASTR="   "
"RTN","RART3",33,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_RA2ND("SSR",R1) G PHYS11
"RTN","RART3",34,0)
PHYS19 W:RASTR]"" !,RASTR
"RTN","RART3",35,0)
PHYS2 S R1=$E($P($G(^VA(200,+$P(R3,"^",12),0)),"^"),1,15)
"RTN","RART3",36,0)
 S RASTR="Residents : "_R1 S:R1]"" RASTR=RASTR_" (P)"
"RTN","RART3",37,0)
 I '$O(RA2ND("SRR",0)) W !,RASTR Q
"RTN","RART3",38,0)
 S R1=0
"RTN","RART3",39,0)
PHYS21 S R1=$O(RA2ND("SRR",R1)) G:R1="" PHYS29
"RTN","RART3",40,0)
 I $L(RASTR)+$L(RA2ND("SRR",R1))>79 W !,RASTR,";" S RASTR="   "
"RTN","RART3",41,0)
 S:RASTR]"   " RASTR=RASTR_"; " S RASTR=RASTR_RA2ND("SRR",R1) G PHYS21
"RTN","RART3",42,0)
PHYS29 W:RASTR]"" !,RASTR
"RTN","RART3",43,0)
 Q
"RTN","RART3",44,0)
MODSET ; print modifiers of all cases of print set
"RTN","RART3",45,0)
 N RACDIS,RALDIS,RACNISAV,RAMEMARR,R1
"RTN","RART3",46,0)
 D EN2^RAUTL20(.RAMEMARR) Q:'$O(RAMEMARR(0))
"RTN","RART3",47,0)
 S RACNISAV=RACNI,RACNI=0
"RTN","RART3",48,0)
 D CDIS^RAPROD S (RAREZON,RACNI)=0
"RTN","RART3",49,0)
 ;for printsets print the REASON FOR STUDY along with the lead procedure
"RTN","RART3",50,0)
 ;(avoid duplicate printing of the same data)
"RTN","RART3",51,0)
 F  S RACNI=$O(RAMEMARR(RACNI)) Q:'RACNI  D  Q:$L($G(X))  I $G(RAXIT) S X="^" Q
"RTN","RART3",52,0)
 . S R1=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RART3",53,0)
 . D MODS^RAUTL2
"RTN","RART3",54,0)
 . ; If printing page at a time we need to check the length - RA*5*8
"RTN","RART3",55,0)
 . I $Y>(IOSL-6),'$D(RARTVERF) S RAP="" D WAIT^RART1 I X="^"!(X="P")!(X="T") Q
"RTN","RART3",56,0)
 . K X
"RTN","RART3",57,0)
 . D OUT1 S RAREZON=1
"RTN","RART3",58,0)
 . S:+$P(R1,"^",28) X=$$RDIO1^RARTUTL1(+$P(R1,"^",28))  Q:$L($G(X))
"RTN","RART3",59,0)
 . S:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) X=$$PHARM1^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RART3",60,0)
 . W:$O(RAMEMARR(RACNI)) !
"RTN","RART3",61,0)
 . Q
"RTN","RART3",62,0)
 S RACNI=RACNISAV
"RTN","RART3",63,0)
 W ! K RAREZON
"RTN","RART3",64,0)
 Q
"RTN","RART3",65,0)
OUT1 ; print Procedure name, CPT code, Procedure modifier, and CPT Modifiers
"RTN","RART3",66,0)
 ; $O(RAMEMARR(0)) may be defined, if previously called MODSET^RART3
"RTN","RART3",67,0)
 ; RALDIS flags long display wanted, comes from certain output options
"RTN","RART3",68,0)
 ; RACDIS(n) exists if case n is to be displayed
"RTN","RART3",69,0)
 ; RACDIS(n) not set for dupl proc+pmod+cptmod so don't display
"RTN","RART3",70,0)
 ; If printset, skip if not long format or case not marked for cond.displ
"RTN","RART3",71,0)
 I $O(RAMEMARR(0)),'$G(RALDIS),'$D(RACDIS(RACNI)) Q
"RTN","RART3",72,0)
 N I,J,RACRF S RACRF=1
"RTN","RART3",73,0)
 N RA18RET S RA18RET=0 ;P18
"RTN","RART3",74,0)
 S R1=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RART3",75,0)
 S RASTUDY=$P($G(^RAO(75.1,+$P(R1,U,11),.1)),U) ;Convey 'Reason for Study' P75
"RTN","RART3",76,0)
 ; Check if cancelled and not part of this report
"RTN","RART3",77,0)
 I $P(^RA(72,+$P(R1,"^",3),0),"^",3)=0,($P(R1,"^",17)="") Q
"RTN","RART3",78,0)
 I $P(^RA(72,+$P(R1,"^",3),0),"^",3)=0 D
"RTN","RART3",79,0)
 .W !,$S($G(RALDIS):"",'$D(RACDIS):"",$G(RACDIS(RACNI))=1:"",1:RACDIS(RACNI)_"x"),?4,$E($P($G(^RAMIS(71,+$P(R1,"^",2),0)),"^"),1,42)_" (cancelled)"
"RTN","RART3",80,0)
 E  W !,$S($G(RALDIS):"",'$D(RACDIS):"",$G(RACDIS(RACNI))=1:"",1:RACDIS(RACNI)_"x"),?4,$P($G(^RAMIS(71,+$P(R1,"^",2),0)),"^")
"RTN","RART3",81,0)
 D PRCCPT^RAPROD ;disp proc. abbr, proc type, & CPT
"RTN","RART3",82,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RART3",83,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RART3",84,0)
 I $L(RACMDATA) D
"RTN","RART3",85,0)
 .W !?5,"Contrast Media :"
"RTN","RART3",86,0)
 .F RAIZ=1:1 Q:$P(RACMDATA,", ",RAIZ)=""  D
"RTN","RART3",87,0)
 ..W ?22,$P(RACMDATA,", ",RAIZ) W:$P(RACMDATA,", ",RAIZ+1)'="" !
"RTN","RART3",88,0)
 ..I '$D(RARTVERF),$Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() S:RAXIT RA18RET=-1 Q:RAXIT  W @IOF W !
"RTN","RART3",89,0)
 ..Q
"RTN","RART3",90,0)
 .K RAIZ
"RTN","RART3",91,0)
 .QUIT
"RTN","RART3",92,0)
 K RACMDATA Q:RA18RET=-1  ;P18
"RTN","RART3",93,0)
 W:Y'="None" !?5,"Proc Modifiers : ",Y
"RTN","RART3",94,0)
 W:Y(1)'="None" !?5,"CPT Modifiers  :"
"RTN","RART3",95,0)
 I Y(1)'="None" S RACRF=0 D
"RTN","RART3",96,0)
 .F I=1:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) W ?22,$P(J,"^",2)," ",$P(J,"^",3) W:$P(Y(2),", ",I+1)]"" ! I '$D(RARTVERF),$Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() S:RAXIT RA18RET=-1 Q:RAXIT  W @IOF W !
"RTN","RART3",97,0)
 Q:RA18RET=-1
"RTN","RART3",98,0)
 I $L(RASTUDY),$G(RAREZON,0)=0 W:RACRF ! S RACRF=0 D DIWP^RAUTL5(5,68,"Reason for Study: "_RASTUDY) ;P75
"RTN","RART3",99,0)
 K RASTUDY
"RTN","RART3",100,0)
 ;RATECHCO is defined in OPTION FILE's  ENTRY/EXIT ACTION
"RTN","RART3",101,0)
 I $D(RATECHCO) W:RACRF ! S RA18RET=$$PUTTCOM^RAUTL11(RADFN,RADTI,RACNI,"     Tech.Comment   : ",22,70,7,0,0,2,0) S:RA18RET=-1 RAXIT=1 Q:RA18RET=-1  ;P18
"RTN","RART3",102,0)
 Q
"RTN","RARTR")
0^20^B56338116^B56272140
"RTN","RARTR",1,0)
RARTR ;HISC/CAH COLUMBIA/REB AISC/MJK,RMO-Queue/print Reports ;11/27/98  09:05
"RTN","RARTR",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,13,16,27,43,55,75**;Mar 16, 1998;Build 4
"RTN","RARTR",3,0)
PRT ; Begin print/build of e-mail message
"RTN","RARTR",4,0)
 ;
"RTN","RARTR",5,0)
 ; ** NOTE: If the layout of this output is changed  **
"RTN","RARTR",6,0)
 ; **       please check that routine RAO7PC3 is     **
"RTN","RARTR",7,0)
 ; **       not affected. It assumes fixed format of **
"RTN","RARTR",8,0)
 ; **       the following headings:                  **
"RTN","RARTR",9,0)
 ; **            Clinical History:                   **
"RTN","RARTR",10,0)
 ; **            Report:                             **
"RTN","RARTR",11,0)
 ; **            Impression:                         **
"RTN","RARTR",12,0)
 ; **            Primary Diagnostic Code:            **
"RTN","RARTR",13,0)
 ; **            Secondary Diagnostic Codes:         **
"RTN","RARTR",14,0)
 ; **            Primary Interpreting Staff:         **
"RTN","RARTR",15,0)
 ;
"RTN","RARTR",16,0)
 Q:'$D(^RARPT(+$G(RARPT),0))
"RTN","RARTR",17,0)
 ; Use and Set if running in the foreground and Writing to the device
"RTN","RARTR",18,0)
 I '$D(RAUTOE) D
"RTN","RARTR",19,0)
 . U IO
"RTN","RARTR",20,0)
 . S RAFFLF=IOF
"RTN","RARTR",21,0)
 . S RAORIOF=RAFFLF
"RTN","RARTR",22,0)
 ;
"RTN","RARTR",23,0)
 W:$Y>0&('$D(RAUTOE)) @RAFFLF   ; If RAUTOE defined build mail msg
"RTN","RARTR",24,0)
 S X=$G(^RARPT(+$G(RARPT),0))   ;  RAORIOF=RAFFLF
"RTN","RARTR",25,0)
 ;
"RTN","RARTR",26,0)
 ;S RAFFLF=$S('$D(ORACTION):RAFFLF,ORACTION'=8:RAFFLF,1:"!")
"RTN","RARTR",27,0)
 D INIT ; setup exam/report variables
"RTN","RARTR",28,0)
 I RAY0<0!(RAY1<0)!(RAY2<0)!(RAY3<0) K RAFFLF Q  ; data nodes missing
"RTN","RARTR",29,0)
 ;
"RTN","RARTR",30,0)
PRT1 I $D(RAUTOE) D
"RTN","RARTR",31,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=" "
"RTN","RARTR",32,0)
 . I $D(RADDEN) D
"RTN","RARTR",33,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Report Unverified by: "_$P($G(^VA(200,$S($G(RADUZ):RADUZ,1:DUZ),0)),"^")
"RTN","RARTR",34,0)
 .. Q
"RTN","RARTR",35,0)
 . Q
"RTN","RARTR",36,0)
 I +$O(^RARPT(RARPT,"ERR",0)) D
"RTN","RARTR",37,0)
 . S RAERRFLG="" ; set for future reference (display AMENRPT^RARTR text)
"RTN","RARTR",38,0)
 . W:'$D(RAUTOE) !!?10,$$AMENRPT^RARTR2(),!
"RTN","RARTR",39,0)
 . I $D(RAUTOE) D
"RTN","RARTR",40,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=" "
"RTN","RARTR",41,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="         "_$$AMENRPT^RARTR2()
"RTN","RARTR",42,0)
 .. Q
"RTN","RARTR",43,0)
 . Q
"RTN","RARTR",44,0)
 I $P(RAY3,"^",25)<2 D  G END:$D(RAOOUT)
"RTN","RARTR",45,0)
 . D MODS^RAUTL2,OUT1^RARTR3
"RTN","RARTR",46,0)
 . D:+$P(RAY3,"^",28) RDIO^RARTUTL(+$P(RAY3,"^",28))  Q:$D(RAOOUT)
"RTN","RARTR",47,0)
 . D:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) PHARM^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RARTR",48,0)
 . ;W:'$D(RAUTOE) !
"RTN","RARTR",49,0)
 . S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",50,0)
 . Q
"RTN","RARTR",51,0)
 I $P(RAY3,"^",25)>1 D
"RTN","RARTR",52,0)
 . D MEMS1^RARTR3
"RTN","RARTR",53,0)
 . W:'$D(RAUTOE) !
"RTN","RARTR",54,0)
 . S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",55,0)
 . Q
"RTN","RARTR",56,0)
 G END:$D(RAOOUT)
"RTN","RARTR",57,0)
 ; Check for duplicate history in file 70 and 74.
"RTN","RARTR",58,0)
 D CHKDUPHX^RART1  ; Sets RADUPHX to 1 for duplicate or 0 if different.
"RTN","RARTR",59,0)
 F RAP="H","AH","R","I" K ^UTILITY($J,"W"),^(1) D  G END:$D(RAOOUT)
"RTN","RARTR",60,0)
 . S RAP("P")=$S(RAP="H":"Clinical History:",RAP="AH":"Additional Clinical History:",RAP="R":"Report:",1:"Impression:")
"RTN","RARTR",61,0)
 . ; Don't continue if printing Additional Clinical History and it is a
"RTN","RARTR",62,0)
 . ; duplicate of Clinical History.
"RTN","RARTR",63,0)
 . Q:RAP="AH"&(RADUPHX>0)
"RTN","RARTR",64,0)
 . W:'$D(RAUTOE) !?RATAB,RAP("P")
"RTN","RARTR",65,0)
 . I $D(RAUTOE),($D(RADDEN)),(RAP="R") D
"RTN","RARTR",66,0)
 .. N RABAN1,RABAN2,RASPCE S $P(RASPCE," ",46)=""
"RTN","RARTR",67,0)
 .. S RABAN1="*** Uncorrected Version   ***"
"RTN","RARTR",68,0)
 .. S RABAN2="*** Refer to final report ***"
"RTN","RARTR",69,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",70,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RASPCE_RABAN1
"RTN","RARTR",71,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RASPCE_RABAN2
"RTN","RARTR",72,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",73,0)
 .. Q
"RTN","RARTR",74,0)
 . S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="    "_RAP("P")
"RTN","RARTR",75,0)
 . W:$D(RASTFL)&(RAP="R")&('$D(RAUTOE)) ?45,"Status: ",$$XTERNAL^RAUTL5(RAST,$P($G(^DD(74,5,0)),"^",2))
"RTN","RARTR",76,0)
 . I RAP="R",($D(RAUTOE)) D
"RTN","RARTR",77,0)
 .. S $P(RAP("S")," ",(46-$L(^TMP($J,"RA AUTOE",RAACNT))))=""
"RTN","RARTR",78,0)
 .. I '$D(RADDEN) S ^TMP($J,"RA AUTOE",RAACNT)=^(RAACNT)_RAP("S")_"Status: "_$$XTERNAL^RAUTL5(RAST,$P($G(^DD(74,5,0)),"^",2))
"RTN","RARTR",79,0)
 .. Q
"RTN","RARTR",80,0)
 . D:$D(RAUTOE) SET^RARTR2
"RTN","RARTR",81,0)
 . D:'$D(RAUTOE) WRITE^RARTR2 Q:$D(RAOOUT)
"RTN","RARTR",82,0)
 . K ^UTILITY($J,"W")
"RTN","RARTR",83,0)
 . Q
"RTN","RARTR",84,0)
 I $D(RADDEN),($G(^RARPT(RARPT,"PURGE"))) D
"RTN","RARTR",85,0)
 . ; when the report is unverified and purge data exists (rpt adden)
"RTN","RARTR",86,0)
 . N RAPRGE S RAPRGE=+$G(^RARPT(RARPT,"PURGE"))
"RTN","RARTR",87,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",88,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="Report Purged: "_$$FMTE^XLFDT(RAPRGE,"1P")
"RTN","RARTR",89,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",90,0)
 . Q
"RTN","RARTR",91,0)
 I $P($G(^RA(79.1,+$P(RAY2,U,4),0)),U,18)="Y" D PRTDX^RARTR1 G:$D(RAOOUT) END ;print dx codes
"RTN","RARTR",92,0)
 D EN1^RARTR0 G:$D(RAOOUT) END
"RTN","RARTR",93,0)
 I '$D(RAVERFND) D  G END:$D(RAOOUT)
"RTN","RARTR",94,0)
 . I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 Q:$D(RAOOUT)  D HD:($Y+RAFOOT+4)>IOSL
"RTN","RARTR",95,0)
 . N RADFTSBN,RADFTSBT S:$D(RADDEN) RAVERF=+$P(RA74B4,"^",9)
"RTN","RARTR",96,0)
 . S RADFTSBN=$E($P($G(^VA(200,RAVERF,20)),"^",2),1,25)
"RTN","RARTR",97,0)
 . S:RADFTSBN']"" RADFTSBN=$E($P($G(^VA(200,RAVERF,0)),"^"),1,25)
"RTN","RARTR",98,0)
 . S RADFTSBT=$E($P($G(^VA(200,RAVERF,20)),"^",3),1,30)
"RTN","RARTR",99,0)
 . I RADFTSBT']"" S RADFTSBT=$$TITLE^RARTR0(RAVERF)
"RTN","RARTR",100,0)
 . W:'$D(RAUTOE) !!,"VERIFIED BY:",!?2,$S(RADFTSBN]"":RADFTSBN,1:"")
"RTN","RARTR",101,0)
 . W:RADFTSBT]""&('$D(RAUTOE)) ", "_RADFTSBT
"RTN","RARTR",102,0)
 . I $D(RAUTOE) D
"RTN","RARTR",103,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="VERIFIED BY:"
"RTN","RARTR",104,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="  "_$S(RADFTSBN]"":RADFTSBN,1:"")_$S(RADFTSBT]"":", "_RADFTSBT,1:"")
"RTN","RARTR",105,0)
 .. S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",106,0)
 .. Q
"RTN","RARTR",107,0)
 . Q
"RTN","RARTR",108,0)
 K RASBPN,RASBT,RASECIEN,RASECOND,RASECSS
"RTN","RARTR",109,0)
 I '$D(RAUTOE) D:($Y+RAFOOT+4)>IOSL HANG^RARTR2 G END:$D(RAOOUT) D HD:($Y+RAFOOT+4)>IOSL
"RTN","RARTR",110,0)
 W:'$D(RAUTOE) !!,$S($D(^RABTCH(74.2,+RABTCH,0)):$P(^(0),"^"),1:""),"/" I +$G(^RARPT(RARPT,"T")),$D(^VA(200,+$P(^RARPT(RARPT,"T"),"^"),0)) W:'$D(RAUTOE) $P(^(0),"^",2)
"RTN","RARTR",111,0)
 S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$P($G(^RABTCH(74.2,+RABTCH,0)),"^")_"/"_$S(+$G(^RARPT(RARPT,"T"))&($D(^VA(200,+$P($G(^RARPT(RARPT,"T")),"^"),0))):$P(^(0),"^",2),1:"")
"RTN","RARTR",112,0)
 S:$D(RAUTOE) ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",113,0)
 D HANG^RARTR2 G END:$D(RAOOUT)
"RTN","RARTR",114,0)
 I RAST'="V" D:'$D(RAMDV) SETDIV^RARTR2 I $P(RAMDV,U,25) D WARNING^RARTR1
"RTN","RARTR",115,0)
 G PEND:RAST'="PD"
"RTN","RARTR",116,0)
 S $P(RASTRSK,"*",80)=""
"RTN","RARTR",117,0)
 I '$D(RAUTOE) D
"RTN","RARTR",118,0)
 . D HD:($Y+RAFOOT+9)>IOSL
"RTN","RARTR",119,0)
 . W !,$E(RASTRSK,1,22)," P R O B L E M   S T A T E M E N T ",$E(RASTRSK,1,22)
"RTN","RARTR",120,0)
 . W !!,$S($D(^RARPT(RARPT,"P")):^("P"),1:"None entered.") W !!,RASTRSK
"RTN","RARTR",121,0)
 . Q
"RTN","RARTR",122,0)
 E  D
"RTN","RARTR",123,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$E(RASTRSK,1,22)_" P R O B L E M   S T A T E M E N T "_$E(RASTRSK,1,22)
"RTN","RARTR",124,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$S($D(^RARPT(RARPT,"P")):^("P"),1:"None entered.")
"RTN","RARTR",125,0)
 . S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR",126,0)
 . Q
"RTN","RARTR",127,0)
PEND D FOOT^RARTR2,HANG^RARTR2 D:'$D(RAMIE)&('$D(RAUTOE)) Q^RAFLH1
"RTN","RARTR",128,0)
END K:$D(RAOOUT) XQAID,XQAKILL
"RTN","RARTR",129,0)
 K %I,%W,%Y1,C,DN,I,RADXCODE,RARTMES,RAVERF,RAVERFND,RAPVERF
"RTN","RARTR",130,0)
 K RAVERS,RAFOOT,RAY0,RAY1,RAY2,RAY3,RALOC,RAFMT,RAMOD,RASTFL,RALB,RALBR
"RTN","RARTR",131,0)
 K RALBRT,RALBS,RALBST,RAV,RAP,RATAB,RAXX,VAL,VAR,RADFN,RADTI,RACN,RADTE
"RTN","RARTR",132,0)
 K RARPT,RAHDFM,RAFTFM,RAV,RAIOF,RABTCH,RAOOUT,RAPIR,RAPIS,VAERR,Z
"RTN","RARTR",133,0)
 ; K RASTRSK S RAFFLF=RAORIOF K RAORIOF,RAFFLF,RAERRFLG
"RTN","RARTR",134,0)
 K RASTRSK,RAORIOF,RAFFLF,RAERRFLG
"RTN","RARTR",135,0)
 Q
"RTN","RARTR",136,0)
Q ; Queue the report
"RTN","RARTR",137,0)
 S ZTDTH=$H,ZTRTN="DQ^RARTR",ZTSAVE("RARPT")="" S:$D(RARTMES) ZTSAVE("RARTMES")=""
"RTN","RARTR",138,0)
 D ZIS^RAUTL Q:RAPOP
"RTN","RARTR",139,0)
 ;
"RTN","RARTR",140,0)
DQ S U="^",X="T",%DT="" D ^%DT K %DT S DT=Y G PRT
"RTN","RARTR",141,0)
 ;
"RTN","RARTR",142,0)
INIT ; initialize exam/report variables
"RTN","RARTR",143,0)
 ; main variables set:
"RTN","RARTR",144,0)
 ; RAY0: zero node data from the Patient File (2)
"RTN","RARTR",145,0)
 ; RAY1: zero node data from the Rad/Nuc Med Patient File (70)
"RTN","RARTR",146,0)
 ; RAY2: Registered Exams (70.02) zero node data
"RTN","RARTR",147,0)
 ; RAY3: Examinations     (70.03) zero node data
"RTN","RARTR",148,0)
 S (RAY0,RAY1,RAY2,RAY3)=-1 ; error condition, if no data nodes
"RTN","RARTR",149,0)
 S RADFN=+$P(X,"^",2),RADTE=+$P(X,"^",3),RADTI=(9999999.9999-RADTE)
"RTN","RARTR",150,0)
 S RACN=+$P(X,"^",4),RAST=$P(X,"^",5),RATAB=5
"RTN","RARTR",151,0)
 S:'$D(RABTCH) RABTCH=0 S (DIWL,DIWF)=0
"RTN","RARTR",152,0)
 Q:'$D(^RADPT(RADFN,0))  S RANUM=1,RAY1=^(0)
"RTN","RARTR",153,0)
 Q:'$D(^DPT(RADFN,0))  S RAY0=^(0)
"RTN","RARTR",154,0)
 Q:'$D(^RADPT(RADFN,"DT",RADTI,0))  S RAY2=^(0)
"RTN","RARTR",155,0)
 S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P","B",RACN,0))
"RTN","RARTR",156,0)
 S (RAY3,RALB)=$S($D(^RADPT(RADFN,"DT",RADTI,"P",+RACNI,0)):^(0),1:-1)
"RTN","RARTR",157,0)
 Q:RAY3<0  ; examinations data missing
"RTN","RARTR",158,0)
 ;
"RTN","RARTR",159,0)
 S (RAHDFM,RAFTFM)=1 S:$D(^RA(79.1,+$P(RAY2,"^",4),0)) RAHDFM=^(0),RAFTFM=+$P(RAHDFM,"^",13),DIWL=$P(RAHDFM,"^",14),DIWF=$P(RAHDFM,"^",15),RAHDFM=+$P(RAHDFM,"^",12) S RAFOOT=$S($D(^RA(78.2,RAFTFM,0)):+$P(^(0),"^",2),1:0)
"RTN","RARTR",160,0)
 S:'DIWL DIWL=5 S:'DIWF DIWF=70 S DIWF="WC"_(DIWF-DIWL)
"RTN","RARTR",161,0)
 G @$S($D(RAUTOE):"HEAD^RARTR0",1:"HD1")
"RTN","RARTR",162,0)
 Q
"RTN","RARTR",163,0)
 ;
"RTN","RARTR",164,0)
HD D FOOT^RARTR2:$E(IOST,1,2)'="C-"
"RTN","RARTR",165,0)
HD1 S RAFMT=RAHDFM I $D(RARTMES) W:$Y>0 @RAFFLF W !,?((80-$L(RARTMES))/2),RARTMES,! S RAIOF=RAFFLF,RAFFLF="!"
"RTN","RARTR",166,0)
 I '$D(RARTMES) W:$Y>0 @RAFFLF
"RTN","RARTR",167,0)
 D PRT^RAFLH S:$D(RARTMES) RAFFLF=RAIOF
"RTN","RARTR",168,0)
 W:$D(RAERRFLG) !!?10,$$AMENRPT^RARTR2(),!!
"RTN","RARTR",169,0)
 Q
"RTN","RARTR3")
0^10^B24116267^B17132620
"RTN","RARTR3",1,0)
RARTR3 ;HIRMFO/SWM-Queue/print Radiology Reports (utility) ;8/31/99  13:57
"RTN","RARTR3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,10,19,27,35,45,75**;Mar 16, 1998;Build 4
"RTN","RARTR3",3,0)
MEMS1 ;--- modifiers --- handle cases within print set
"RTN","RARTR3",4,0)
 N RACNISAV,RAY3SAV,RAMEMARR,RACDIS,RALDIS
"RTN","RARTR3",5,0)
 D EN2^RAUTL20(.RAMEMARR) Q:'$O(RAMEMARR(0))
"RTN","RARTR3",6,0)
 S RACNISAV=RACNI,RAY3SAV=RAY3,RACNI=0
"RTN","RARTR3",7,0)
 D CDIS^RAPROD S (RAREZON,RACNI)=0
"RTN","RARTR3",8,0)
 ;for printsets print the REASON FOR STUDY along with the lead procedure
"RTN","RARTR3",9,0)
 ;(avoid duplicate printing of the same data)
"RTN","RARTR3",10,0)
 F  S RACNI=$O(RAMEMARR(RACNI)) Q:'RACNI  D  S:$G(RAXIT) RAOOUT=1  Q:$D(RAOOUT)
"RTN","RARTR3",11,0)
 . S RAY3=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RARTR3",12,0)
 . ;Check if cancelled & not part of printset
"RTN","RARTR3",13,0)
 . I $P(^RA(72,+$P(RAY3,"^",3),0),"^",3)=0,($P(RAY3,"^",17)="") Q
"RTN","RARTR3",14,0)
 . D MODS^RAUTL2
"RTN","RARTR3",15,0)
 . ; If printing page at a time we need to check the length - RA*5*8
"RTN","RARTR3",16,0)
 . I '$D(RAUTOE),$Y>(IOSL-6),IOST["C-" S RAP="" D WAIT^RART1 I X="^"!(X="P")!(X="T") S RAOOUT=1 Q
"RTN","RARTR3",17,0)
 . D OUT1 Q:$G(RAXIT)  S RAREZON=1
"RTN","RARTR3",18,0)
 . D:+$P(RAY3,"^",28) RDIO^RARTUTL(+$P(RAY3,"^",28)) Q:$D(RAOOUT)
"RTN","RARTR3",19,0)
 . D:+$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"RX",0)) PHARM^RARTUTL(RACNI_","_RADTI_","_RADFN_",")
"RTN","RARTR3",20,0)
 . Q
"RTN","RARTR3",21,0)
 S RACNI=RACNISAV,RAY3=RAY3SAV K RAREZON
"RTN","RARTR3",22,0)
 Q
"RTN","RARTR3",23,0)
OUT1 ;
"RTN","RARTR3",24,0)
 ; $O(RAMEMARR(0)) may be defined, if previously called MEMS1^RARTR3
"RTN","RARTR3",25,0)
 ; RALDIS flags long display wanted, comes from certain output options
"RTN","RARTR3",26,0)
 ; RACDIS(n) exists if case n is to be displayed
"RTN","RARTR3",27,0)
 ; RACDIS(n) not set for dupl proc+pmod+cptmod so don't display
"RTN","RARTR3",28,0)
 I $O(RAMEMARR(0)),'$G(RALDIS),'$D(RACDIS(RACNI)) Q
"RTN","RARTR3",29,0)
 S RASTUDY=$P($G(^RAO(75.1,+$P(RAY3,U,11),.1)),U) ;Convey 'Reason for Study' P75
"RTN","RARTR3",30,0)
 I $D(RAUTOE) G MAIL1
"RTN","RARTR3",31,0)
 W !,$$XAM()
"RTN","RARTR3",32,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTR3",33,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTR3",34,0)
 I $L(RACMDATA) D
"RTN","RARTR3",35,0)
 .W !?5,"Contrast Media :"
"RTN","RARTR3",36,0)
 .F RAIZ=1:1 Q:$P(RACMDATA,", ",RAIZ)=""  D
"RTN","RARTR3",37,0)
 ..W ?22,$P(RACMDATA,", ",RAIZ)
"RTN","RARTR3",38,0)
 ..W:$P(RACMDATA,", ",RAIZ+1)'="" !
"RTN","RARTR3",39,0)
 ..I $Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RARTR3",40,0)
 ..Q
"RTN","RARTR3",41,0)
 .K RAIZ
"RTN","RARTR3",42,0)
 .QUIT
"RTN","RARTR3",43,0)
 K RACMDATA Q:$G(RAXIT)
"RTN","RARTR3",44,0)
 W:Y'="None" !?RATAB,"Proc Modifiers : ",Y
"RTN","RARTR3",45,0)
 N I,J
"RTN","RARTR3",46,0)
 W:Y(1)'="None" !?RATAB,"CPT Modifiers  : "
"RTN","RARTR3",47,0)
 I Y(1)'="None" F I=1:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) W ?22,$P(J,"^",2)," ",$P(J,"^",3) W:$P(Y(2),", ",I+1)]"" ! I $Y>(IOSL-5) S RAXIT=$$EOS^RAUTL5() Q:RAXIT  W @IOF W !
"RTN","RARTR3",48,0)
 I $L(RASTUDY),$G(RAREZON,0)=0 W ! D DIWP^RAUTL5(RATAB,68,"Reason for Study: "_RASTUDY) ;P75
"RTN","RARTR3",49,0)
 K RASTUDY
"RTN","RARTR3",50,0)
 Q
"RTN","RARTR3",51,0)
 ;
"RTN","RARTR3",52,0)
MAIL1 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=""
"RTN","RARTR3",53,0)
 S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=$$XAM()
"RTN","RARTR3",54,0)
 ;check for contrast media; display if CM data exists (patch 45)
"RTN","RARTR3",55,0)
 S RACMDATA=$$CMEDIA^RAUTL8(RADFN,RADTI,RACNI)
"RTN","RARTR3",56,0)
 I $L(RACMDATA) D
"RTN","RARTR3",57,0)
 .S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="     Contrast Media : "_$P(RACMDATA,", ")
"RTN","RARTR3",58,0)
 .F RAIZ=2:1 Q:$P(RACMDATA,", ",RAIZ)=""  S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="                      "_$P(RACMDATA,", ",RAIZ)
"RTN","RARTR3",59,0)
 .K RAIZ
"RTN","RARTR3",60,0)
 .Q
"RTN","RARTR3",61,0)
 K RACMDATA
"RTN","RARTR3",62,0)
 S:Y'="None" ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="     Proc Modifiers : "_Y
"RTN","RARTR3",63,0)
 I Y(1)'="None" D
"RTN","RARTR3",64,0)
 .S J=$P(Y(2),", ",1),J=$$BASICMOD^RACPTMSC(J,DT) S:+J<0 $P(J,"^",2,3)="None^"
"RTN","RARTR3",65,0)
 .S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="     CPT Modifiers  : "_$S(J]"":$P(J,"^",2)_" "_$P(J,"^",3),1:"")
"RTN","RARTR3",66,0)
 .F I=2:1 Q:$P(Y(2),", ",I)']""  S J=$P(Y(2),", ",I),J=$$BASICMOD^RACPTMSC(J,DT) S ^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))="                      "_$P(J,"^",2)_" "_$P(J,"^",3)
"RTN","RARTR3",67,0)
 .Q
"RTN","RARTR3",68,0)
 I $L(RASTUDY),$G(RAREZON,0)=0 D  S RAREZON=1
"RTN","RARTR3",69,0)
 .N RAY S RASTUDY="Reason for Study: "_RASTUDY
"RTN","RARTR3",70,0)
 .I $L(RASTUDY)'>68 S $P(RAY," ",6)="",^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RAY_RASTUDY Q
"RTN","RARTR3",71,0)
 .I $L(RASTUDY)>68 D
"RTN","RARTR3",72,0)
 ..K ^UTILITY($J,"W") N %,DIW,DIWF,DIWL,DIWR,DIWT,DIWTC,DIWX,DN,RAI,RAX,X,X1,Z
"RTN","RARTR3",73,0)
 ..S DIWF="",DIWL=1,DIWR=65,X=RASTUDY D ^DIWP
"RTN","RARTR3",74,0)
 ..S RAI=0 F  S RAI=$O(^UTILITY($J,"W",DIWL,RAI)) Q:'RAI  D
"RTN","RARTR3",75,0)
 ...S RAX=$G(^UTILITY($J,"W",DIWL,RAI,0))
"RTN","RARTR3",76,0)
 ...I RAI=1 S $P(RAY," ",6)="",^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RAY_RAX
"RTN","RARTR3",77,0)
 ...I RAI'=1 S $P(RAY," ",24)="",^TMP($J,"RA AUTOE",$$INCR^RAUTL4(RAACNT))=RAY_RAX
"RTN","RARTR3",78,0)
 ...Q
"RTN","RARTR3",79,0)
 ..Q
"RTN","RARTR3",80,0)
 .K ^UTILITY($J,"W")
"RTN","RARTR3",81,0)
 .Q
"RTN","RARTR3",82,0)
 K RASTUDY
"RTN","RARTR3",83,0)
 Q
"RTN","RARTR3",84,0)
 ;
"RTN","RARTR3",85,0)
XAM() ; Return exam data information.  Case number, exam status & procedure
"RTN","RARTR3",86,0)
 ; name build into one string.  Assumes RAY3 is the 0 node for exam data
"RTN","RARTR3",87,0)
 Q:$G(RAY3)="" "" ; no exam information present.
"RTN","RARTR3",88,0)
 N RAPROC,RAXAMSTR S RAXAMSTR=""
"RTN","RARTR3",89,0)
 I $G(RALDIS)!('$O(RAMEMARR(0)))!($O(RAMEMARR(0))&($G(RACDIS(RACNI))=1)) D
"RTN","RARTR3",90,0)
 . S $E(RAXAMSTR,1,5)="(Case"
"RTN","RARTR3",91,0)
 . S $E(RAXAMSTR,7,(7+$L(+RAY3)))=+RAY3
"RTN","RARTR3",92,0)
 . S $E(RAXAMSTR,$L(RAXAMSTR)+2,79)=$S($D(^RA(72,+$P(RAY3,"^",3),0)):$E($P(^(0),"^"),1,8)_")",1:"Unknown)")
"RTN","RARTR3",93,0)
 . Q
"RTN","RARTR3",94,0)
 E  S:$G(RACDIS(RACNI)) $E(RAXAMSTR,1)="(",$E(RAXAMSTR,9,14)=RACDIS(RACNI)_"x",$E(RAXAMSTR,20)=")"
"RTN","RARTR3",95,0)
 S RAPROC=$G(^RAMIS(71,+$P(RAY3,"^",2),0))
"RTN","RARTR3",96,0)
 S $E(RAXAMSTR,22,54)=$S($P(RAPROC,"^")]"":$E($P(RAPROC,"^"),1,33),1:"Unknown")
"RTN","RARTR3",97,0)
 N RADISPLY
"RTN","RARTR3",98,0)
 S RADISPLY=$G(^RAMIS(71,+$P($G(^RADPT(+RADFN,"DT",+RADTI,"P",+RACNI,0)),U,2),0)) ; set $ZR to 71 for prccpt^radd1, not call raprod since store result
"RTN","RARTR3",99,0)
 S RADISPLY=$$PRCCPT^RADD1()
"RTN","RARTR3",100,0)
 S $E(RAXAMSTR,55,79)=RADISPLY
"RTN","RARTR3",101,0)
 Q RAXAMSTR
"RTN","RAUTL12")
0^19^B13921156^B13350139
"RTN","RAUTL12",1,0)
RAUTL12 ;HISC/CAH,FPT,GJC-Utility Routine ;12/23/97  09:25
"RTN","RAUTL12",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**75**;Mar 16, 1998;Build 4
"RTN","RAUTL12",3,0)
 ;
"RTN","RAUTL12",4,0)
IMGTY(X,Y,Z) ; Determines the Imaging Type
"RTN","RAUTL12",5,0)
 ; 'X' ->  either 'e', 'l', or 'p'
"RTN","RAUTL12",6,0)
 ;         'e' means we determine the Imaging Type from the 'Registered
"RTN","RAUTL12",7,0)
 ;         Exams' multiple in Rad/Nuc Med Patient file (70)
"RTN","RAUTL12",8,0)
 ;         'l' means that we determine the Imaging Type from data in the
"RTN","RAUTL12",9,0)
 ;         Imaging Locations file (79.1)
"RTN","RAUTL12",10,0)
 ;         'p' means that we determine the Imaging Type from data in the
"RTN","RAUTL12",11,0)
 ;         Rad/Nuc Med Procedures file (71)
"RTN","RAUTL12",12,0)
 ;
"RTN","RAUTL12",13,0)
 ; 'Y' ->  The value of D0 in the above files.
"RTN","RAUTL12",14,0)
 ;
"RTN","RAUTL12",15,0)
 ; 'Z' ->  The value of D1 in the Rad/Nuc Med Patient file (70).
"RTN","RAUTL12",16,0)
 ; [ This routine passes back the Imaging Type in the external format ]
"RTN","RAUTL12",17,0)
 N A,B,RAXYZ
"RTN","RAUTL12",18,0)
 I X="e" D
"RTN","RAUTL12",19,0)
 . S A=$G(^RADPT(+$G(Y),"DT",+$G(Z),0)),B=+$P(A,U,2)
"RTN","RAUTL12",20,0)
 . S RAXYZ=$P($G(^RA(79.2,B,0)),U)
"RTN","RAUTL12",21,0)
 . Q
"RTN","RAUTL12",22,0)
 I X="l" D
"RTN","RAUTL12",23,0)
 . S A=$G(^RA(79.1,+$G(Y),0)),B=+$P(A,U,6)
"RTN","RAUTL12",24,0)
 . S RAXYZ=$P($G(^RA(79.2,B,0)),U)
"RTN","RAUTL12",25,0)
 . Q
"RTN","RAUTL12",26,0)
 I X="p" D
"RTN","RAUTL12",27,0)
 . S A=$G(^RAMIS(71,+$G(Y),0)),B=+$P(A,U,12)
"RTN","RAUTL12",28,0)
 . S RAXYZ=$P($G(^RA(79.2,B,0)),U)
"RTN","RAUTL12",29,0)
 . Q
"RTN","RAUTL12",30,0)
 Q RAXYZ
"RTN","RAUTL12",31,0)
 ;
"RTN","RAUTL12",32,0)
LOCK(X,Y) ; Lock the data global
"RTN","RAUTL12",33,0)
 ; 'X' is the global root
"RTN","RAUTL12",34,0)
 ; 'Y' is the record number
"RTN","RAUTL12",35,0)
 N RALCKFLG,XY
"RTN","RAUTL12",36,0)
 S RADUZ=+$G(DUZ),RALCKFLG=0,XY=X_Y
"RTN","RAUTL12",37,0)
 L +@(XY_")"):5
"RTN","RAUTL12",38,0)
 I '$T S RALCKFLG=1 D
"RTN","RAUTL12",39,0)
 . W !?5,"This record is being edited by another user."
"RTN","RAUTL12",40,0)
 . W !?5,"Try again later!",$C(7)
"RTN","RAUTL12",41,0)
 . Q
"RTN","RAUTL12",42,0)
 E  D
"RTN","RAUTL12",43,0)
 . S ^TMP("RAD LOCKS",$J,RADUZ,X,Y)=""
"RTN","RAUTL12",44,0)
 . Q
"RTN","RAUTL12",45,0)
 Q RALCKFLG
"RTN","RAUTL12",46,0)
 ;
"RTN","RAUTL12",47,0)
UNLOCK(X,Y) ; Unlock the data global
"RTN","RAUTL12",48,0)
 N XY S RADUZ=+$G(DUZ),XY=X_Y L -@(XY_")")
"RTN","RAUTL12",49,0)
 K ^TMP("RAD LOCKS",$J,RADUZ,X,Y)
"RTN","RAUTL12",50,0)
 Q
"RTN","RAUTL12",51,0)
EXTRA(RAQI) ;Input is RAQI (Modifier)
"RTN","RAUTL12",52,0)
 ;Output is AMIS Credit Indicator: RABILAT = BILATERAL,
"RTN","RAUTL12",53,0)
 ;RAPORT = PORTABLE, and RAOR = OPERATING ROOM.
"RTN","RAUTL12",54,0)
 S RAQI=$P($G(^RAMIS(71.2,RAQI,0)),U,2) S:RAQI="b" RABILAT="" S:RAQI="p" RAPORT="" S:RAQI="o" RAOR=""
"RTN","RAUTL12",55,0)
 Q
"RTN","RAUTL12",56,0)
  ;
"RTN","RAUTL12",57,0)
DESDT(RAPRI) ; Obtain 'Date Desired (NOT appt date)' by DIR call.
"RTN","RAUTL12",58,0)
 ; Input: IEN of procedure
"RTN","RAUTL12",59,0)
 ; The 'Date Desired' is passed back in internal format.
"RTN","RAUTL12",60,0)
 ; 75.1 -> Rad Orders File    Fld 21 -> Date desired
"RTN","RAUTL12",61,0)
 N DIR,DIROUT,DIRUT,DUOUT,DTOUT,X,Y
"RTN","RAUTL12",62,0)
 I '$D(RAPKG),($D(ORVP)),($D(ORL)),($D(ORNP)) D PROCMSG^RAUTL5(RAPRI)
"RTN","RAUTL12",63,0)
 F  D  Q:Y'=""
"RTN","RAUTL12",64,0)
 .S DIR("?",1)="The 'Date Desired' field contains the date for which the rad/nuc med exam"
"RTN","RAUTL12",65,0)
 .S DIR("?",2)="is requested. 'Date Desired' is required and should not be interpreted as"
"RTN","RAUTL12",66,0)
 .S DIR("?")="an appointment date."
"RTN","RAUTL12",67,0)
 .S DIR(0)="75.1,21" D ^DIR
"RTN","RAUTL12",68,0)
 .S:$D(DTOUT)#2!($D(DUOUT)#2) Y=-1
"RTN","RAUTL12",69,0)
 .Q
"RTN","RAUTL12",70,0)
 Q Y
"RTN","RAUTL12",71,0)
 ;
"RTN","RAUTL12",72,0)
PTLOC() ; Current patient location.  Used for entry: 'CURRENT PATIENT
"RTN","RAUTL12",73,0)
 ; LOCATION' in the Label Print Fields file. (78.7)
"RTN","RAUTL12",74,0)
 ; 'X' is the patient's DFN.  DFN must be a positive integer.
"RTN","RAUTL12",75,0)
 N %,%H,%I,A,B,C,DFN,VAERR,VAIN,X,Y,Y1,Y2,Y3,Y4,Y5
"RTN","RAUTL12",76,0)
 S Y=$$NOW^XLFDT(),Y1=$P(Y,"."),Y2=$E($P(Y,".",2),1,4)
"RTN","RAUTL12",77,0)
 S Y3=$E(Y1,4,5)_"-"_$E(Y1,6,7)_"-"_(1700+$E(Y1,1,3))
"RTN","RAUTL12",78,0)
 S Y4=$E(Y2,1,2)_":"_$E(Y2,3,4)
"RTN","RAUTL12",79,0)
 S Y5=Y3_"@"_Y4,DFN=+$P($G(^RADPT(+$G(RADFN),0)),"^")
"RTN","RAUTL12",80,0)
 Q:'+$G(DFN) "OP Unknown/"_Y5
"RTN","RAUTL12",81,0)
 D INP^VADPT ; If currently an inpatient, grab the ward.
"RTN","RAUTL12",82,0)
 I $P($G(VAIN(4)),"^",2)]"" D  Q Y
"RTN","RAUTL12",83,0)
 . S Y=$E($P($G(VAIN(4)),"^",2),1,15)_"/"_Y5
"RTN","RAUTL12",84,0)
 . Q
"RTN","RAUTL12",85,0)
 ; If not currently an inpatient, check if last recorded patient location
"RTN","RAUTL12",86,0)
 ; is a ward.  If it is a ward or operating room, pass back 'OP Unknown'.
"RTN","RAUTL12",87,0)
 ; We do not have the benefit of PIMS updating our Rad/Nuc Med files.
"RTN","RAUTL12",88,0)
 S X=+$P($G(^RADPT(+$G(RADFN),"DT",+$G(RADTI),"P",+$G(RACNI),0)),"^",11)
"RTN","RAUTL12",89,0)
 S A=+$P($G(^RAO(75.1,X,0)),"^",22),B=$G(^SC(A,0)),C=$P(B,"^",3)
"RTN","RAUTL12",90,0)
 Q:B']""!("WOR"[C) "OP Unknown/"_Y5
"RTN","RAUTL12",91,0)
 Q $P(B,"^")_" (Req'g Loc)"
"RTN","RAUTL12",92,0)
 ;
"RTN","RAUTL12",93,0)
IMG() ; Select one/many/all imaging types.  This code will be used for ALL
"RTN","RAUTL12",94,0)
 ; the options under the Procedure File Listings option as exported by
"RTN","RAUTL12",95,0)
 ; Rad/Nuc Med version 5.  I-Types are not screened.
"RTN","RAUTL12",96,0)
 ; Passes back '1' if I-Type(s) are selected, '0' if nothing selected.
"RTN","RAUTL12",97,0)
 N RADIC,RAQUIT,RAUTIL,X,Y
"RTN","RAUTL12",98,0)
 S RADIC="^RA(79.2,",RADIC(0)="QEAMZ"
"RTN","RAUTL12",99,0)
 S RADIC("A")="Select Imaging Type: ",RADIC("B")="All"
"RTN","RAUTL12",100,0)
 S RAUTIL="RA I-TYPE" W !! D EN1^RASELCT(.RADIC,RAUTIL)
"RTN","RAUTL12",101,0)
 Q $S($D(^TMP($J,"RA I-TYPE"))\10:1,1:0)
"RTN","RAUTL12",102,0)
 ;
"RTN","RAUTL12",103,0)
LOC(RAX) ; Select one/many/all imaging locations.  L-Types are not
"RTN","RAUTL12",104,0)
 ; screened.  Passes back '1' if L-Type(s) are selected, '0' if nothing
"RTN","RAUTL12",105,0)
 ; selected.  Used for the option: 'Location Parameter List' (4^RASYS)
"RTN","RAUTL12",106,0)
 N RADIC,RAQUIT,RAUTIL,X,Y
"RTN","RAUTL12",107,0)
 S RADIC="^RA(79.1,",RADIC(0)="QEFAMZ"
"RTN","RAUTL12",108,0)
 S RADIC("A")="Select Imaging Location: ",RADIC("B")="All"
"RTN","RAUTL12",109,0)
 S:'RAX RADIC("S")="N RADT S RADT=$P(^(0),""^"",19) I $S('RADT:1,RADT>DT:1,1:0)"
"RTN","RAUTL12",110,0)
 S RAUTIL="RA L-TYPE" W !! D EN1^RASELCT(.RADIC,RAUTIL)
"RTN","RAUTL12",111,0)
 Q $S($D(^TMP($J,"RA L-TYPE"))\10:1,1:0)
"RTN","RAUTL5")
0^3^B39178869^B25572659
"RTN","RAUTL5",1,0)
RAUTL5 ;HISC/CAH,FPT,GJC-Utility Routine ;3/12/98  13:27
"RTN","RAUTL5",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**8,26,75**;Mar 16, 1998;Build 4
"RTN","RAUTL5",3,0)
CH ; Populate the 'CLINICAL HISTORY' field (#400); file 75.1 (^RAO(75.1))
"RTN","RAUTL5",4,0)
 ; Called from 'CREATE1^RAORD1'.
"RTN","RAUTL5",5,0)
 ;
"RTN","RAUTL5",6,0)
 ;Ask for 'Reason for Study' (required)
"RTN","RAUTL5",7,0)
 ;Note: RAOUT & RAREAST will be needed later in the ordering process
"RTN","RAUTL5",8,0)
 D STYREA(.RAOUT,.RAREAST) I $D(RAOUT) D XIT QUIT
"RTN","RAUTL5",9,0)
 K ^TMP($J,"RAWP") ;must always start with a clean slate...
"RTN","RAUTL5",10,0)
 ;
"RTN","RAUTL5",11,0)
CH1 ;ask/re-ask 'CLINICAL HISTORY'
"RTN","RAUTL5",12,0)
 I $D(RAVSTFLG),$D(RAVLEDTI),$D(RAVLECNI),$D(^RADPT(RADFN,"DT",RAVLEDTI,"P",RAVLECNI,"H")) S:$D(^("H",0)) ^TMP($J,"RAWP",0)=^(0) F RAI=1:1 Q:'$D(^RADPT(RADFN,"DT",RAVLEDTI,"P",RAVLECNI,"H",RAI,0))  S ^TMP($J,"RAWP",RAI,0)=^(0)
"RTN","RAUTL5",13,0)
 ;Display the Rad/Nuc Med division specific clin. history message (in any)
"RTN","RAUTL5",14,0)
 I $L($G(^RA(79,+RADIV,"HIS"))) W !!?3,$C(7),^("HIS"),! K DIR S DIR(0)="E" D ^DIR
"RTN","RAUTL5",15,0)
 I $D(DIRUT) D XIT Q
"RTN","RAUTL5",16,0)
 N RAYN S DIC="^TMP("_$J_",""RAWP"",",DWPK=1,DIWESUB="Clinical History"
"RTN","RAUTL5",17,0)
 W !,"CLINICAL HISTORY FOR EXAM" D EN^DIWE K DIC,DIWESUB,DWPK
"RTN","RAUTL5",18,0)
 I '$O(^TMP($J,"RAWP",0)) D XIT QUIT
"RTN","RAUTL5",19,0)
 K DIC S DIC="^TMP("_$J_",""RAWP"",",DWPK=1
"RTN","RAUTL5",20,0)
 S RAWPFLG=$$VALWP("^TMP("_$J_",""RAWP"","),RAYN=0
"RTN","RAUTL5",21,0)
 I 'RAWPFLG D  D:RAYN'=1 PURGECH Q:RAYN'=1  G CH1
"RTN","RAUTL5",22,0)
 .W !!,$C(7),"Text must be at least two (2) alphanumeric characters in length.",!
"RTN","RAUTL5",23,0)
 .N X,Y K DIR,DIROUT,DIRUT,DTOUT,DUOUT S DIR(0)="Y",DIR("B")="Yes"
"RTN","RAUTL5",24,0)
 .S DIR("A")="Do you want to enter a proper clinical history for this request"
"RTN","RAUTL5",25,0)
 .S DIR("?",1)="The clinical history must at a minimum consist of two alphanumeric characters."
"RTN","RAUTL5",26,0)
 .S DIR("?",2)="Enter 'Y' to enter a proper clinical history, or 'N' to bypass entering"
"RTN","RAUTL5",27,0)
 .S DIR("?")="the clinical history for this request." D ^DIR
"RTN","RAUTL5",28,0)
 .S:+Y RAYN=1 ;the user will to try to enter a CH
"RTN","RAUTL5",29,0)
 .S:$D(DIRUT)#2 RAYN=-1 ;timeout or caret entered, exit w/o a CH
"RTN","RAUTL5",30,0)
 .;else the user enters 'No' and does not want to enter a CH
"RTN","RAUTL5",31,0)
 .K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAUTL5",32,0)
 .Q
"RTN","RAUTL5",33,0)
 I RAYN<1 D XIT Q
"RTN","RAUTL5",34,0)
WPLEN ;Is clin hist too long to go into a local array for OE/RR HL7 msg?
"RTN","RAUTL5",35,0)
 N RACNT,RAX S (RACNT,RAX)=0
"RTN","RAUTL5",36,0)
 F  S RAX=$O(^TMP($J,"RAWP",RAX)) S RACNT=RACNT+1 Q:RAX'>0
"RTN","RAUTL5",37,0)
 I RACNT>350 S RAYN=0 D  D:RAYN'=1 PURGECH Q:RAYN'=1  G CH1
"RTN","RAUTL5",38,0)
 .W !!,$C(7),"The clinical history cannot exceed 350 lines in length."
"RTN","RAUTL5",39,0)
 .N X,Y K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAUTL5",40,0)
 .S DIR(0)="Y",DIR("B")="Yes"
"RTN","RAUTL5",41,0)
 .S DIR("A")="Do you want to enter a proper clinical history for this request"
"RTN","RAUTL5",42,0)
 .S DIR("?",1)="The clinical history cannot exceed 350 lines in length and must"
"RTN","RAUTL5",43,0)
 .S DIR("?",2)=" at a minimum consist of two alphanumeric characters."
"RTN","RAUTL5",44,0)
 .S DIR("?",3)="Enter 'Y' to enter a proper clinical history, or 'N' to bypass"
"RTN","RAUTL5",45,0)
 .S DIR("?")="entering the clinical history for this request." D ^DIR
"RTN","RAUTL5",46,0)
 .S:+Y RAYN=1 ;the user will to try to enter a CH
"RTN","RAUTL5",47,0)
 .S:$D(DIRUT)#2 RAYN=-1 ;timeout or caret entered, exit w/o a CH
"RTN","RAUTL5",48,0)
 .;else the user enters 'No' and does not want to enter a CH
"RTN","RAUTL5",49,0)
 .K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAUTL5",50,0)
 .Q
"RTN","RAUTL5",51,0)
XIT ;kill variable(s), exit CH subroutine
"RTN","RAUTL5",52,0)
 K RAWPFLG
"RTN","RAUTL5",53,0)
 Q
"RTN","RAUTL5",54,0)
 ;
"RTN","RAUTL5",55,0)
VALWP(RAROOT) ; Validate word processing field.
"RTN","RAUTL5",56,0)
 ; Pass back '1' if data is valid, '0' if not valid.
"RTN","RAUTL5",57,0)
 ; at least 2 alphanumeric char's required
"RTN","RAUTL5",58,0)
 Q:'$O(@(RAROOT_"0)")) 0
"RTN","RAUTL5",59,0)
 N CHAR,CNT,WL,WPFLG,X,Y,Z
"RTN","RAUTL5",60,0)
 S (WPFLG,X)=0
"RTN","RAUTL5",61,0)
 F  S X=$O(@(RAROOT_X_")")) Q:X'>0  D  Q:WPFLG
"RTN","RAUTL5",62,0)
 . S (CNT,WL)=0
"RTN","RAUTL5",63,0)
 . S Y=$G(@(RAROOT_X_",0)")) Q:Y']""
"RTN","RAUTL5",64,0)
 . S WL=$L(Y)
"RTN","RAUTL5",65,0)
 . F Z=1:1:WL D  Q:WPFLG
"RTN","RAUTL5",66,0)
 .. S CHAR=$E(Y,Z) S:CHAR?1AN CNT=CNT+1
"RTN","RAUTL5",67,0)
 .. S:CHAR'?1AN&(CNT>0) CNT=0 S:CNT=2 WPFLG=1
"RTN","RAUTL5",68,0)
 .. Q
"RTN","RAUTL5",69,0)
 . Q
"RTN","RAUTL5",70,0)
 Q WPFLG
"RTN","RAUTL5",71,0)
RDQ(D0) ; Used by input transform on ^DD(74.31,2
"RTN","RAUTL5",72,0)
 ; Checks for unprinted reports associated with REPORT
"RTN","RAUTL5",73,0)
 ; DISTRIBUTION QUEUE of internal entry number of D0.
"RTN","RAUTL5",74,0)
 N %,%Y,FOUND,RA744
"RTN","RAUTL5",75,0)
 S (FOUND,RA744)=0
"RTN","RAUTL5",76,0)
 F  S RA744=$O(^RABTCH(74.4,"C",D0,RA744)) Q:RA744'>0!FOUND  D
"RTN","RAUTL5",77,0)
 . S FOUND=($P($G(^RABTCH(74.4,RA744,0)),"^",4)'>0)
"RTN","RAUTL5",78,0)
 . Q
"RTN","RAUTL5",79,0)
 Q:'FOUND
"RTN","RAUTL5",80,0)
 W !!,"*** UNPRINTED REPORTS IN THE QUEUE ! ***"
"RTN","RAUTL5",81,0)
 W !,"If this queue is inactivated before printing, these reports will be",!,"removed from the queue."
"RTN","RAUTL5",82,0)
 F  D  Q:%
"RTN","RAUTL5",83,0)
 . W !!,"Are you sure you want to remove these reports"
"RTN","RAUTL5",84,0)
 . S %=2 D YN^DICN
"RTN","RAUTL5",85,0)
 . I '% W !!?5,"Please answer Y(es) or N(o)."
"RTN","RAUTL5",86,0)
 . Q
"RTN","RAUTL5",87,0)
 I %'=1 W !,"Inactivation date deleted" K X
"RTN","RAUTL5",88,0)
 Q
"RTN","RAUTL5",89,0)
ATND(RADFN,DATE) ;Returns the external form of the ATTENDING PHYSICIAN
"RTN","RAUTL5",90,0)
 ;for patient RADFN (IEN file #2) on date DATE (FM format)
"RTN","RAUTL5",91,0)
 N DPT,VA200,VAIP,X
"RTN","RAUTL5",92,0)
 S DFN=RADFN,VAIP("D")=DATE,VA200=1
"RTN","RAUTL5",93,0)
 I DATE D IN5^VADPT
"RTN","RAUTL5",94,0)
 S X=$P($G(VAIP(18)),"^",2),X=$S(X]"":X,1:"UNKNOWN")
"RTN","RAUTL5",95,0)
 Q X
"RTN","RAUTL5",96,0)
PRIM(RADFN,DATE) ;Returns the external form of the PRIMARY PHYSICIAN
"RTN","RAUTL5",97,0)
 ;for patient RADFN (IEN file #2) on date DATE (FM format)
"RTN","RAUTL5",98,0)
 N DPT,VA200,VAIP,X
"RTN","RAUTL5",99,0)
 S DFN=RADFN,VAIP("D")=DATE,VA200=1
"RTN","RAUTL5",100,0)
 I DATE D IN5^VADPT
"RTN","RAUTL5",101,0)
 I '+$G(VAIP(7)) D
"RTN","RAUTL5",102,0)
 . ; If the Primary Physician is not found (based on inpatient episode)
"RTN","RAUTL5",103,0)
 . ; find the current PC Practitioner (See patch SD*5.3*30)
"RTN","RAUTL5",104,0)
 . ; VAIP(7) is null at this point.  VAIP(7) will exit this DO block
"RTN","RAUTL5",105,0)
 . ; set to the Primary Care Practitioner or null.
"RTN","RAUTL5",106,0)
 . N X S X="SDUTL3" X ^%ZOSF("TEST")
"RTN","RAUTL5",107,0)
 . S:$T VAIP(7)=$$OUTPTPR^SDUTL3(RADFN)
"RTN","RAUTL5",108,0)
 . Q
"RTN","RAUTL5",109,0)
 S X=$P($G(VAIP(7)),"^",2),X=$S(X]"":X,1:"UNKNOWN")
"RTN","RAUTL5",110,0)
 Q X
"RTN","RAUTL5",111,0)
EOS() ; 'End Of Screen' prompt for terminals only, check user response.
"RTN","RAUTL5",112,0)
 Q:$E(IOST,1,2)'="C-" 0
"RTN","RAUTL5",113,0)
 N RAY,X,X1,X2,X3,Y,Y0,Y1,Y2,Y3,Y4,Y5
"RTN","RAUTL5",114,0)
 ;Returns 1 if user enters anything other than a carriage return
"RTN","RAUTL5",115,0)
 K DIR S DIR(0)="E" D ^DIR K DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","RAUTL5",116,0)
 S RAY='+Y
"RTN","RAUTL5",117,0)
 Q RAY
"RTN","RAUTL5",118,0)
XTERNAL(Y,C) ; Change internal format to external format
"RTN","RAUTL5",119,0)
 ; 'Y' is the internal form of the data
"RTN","RAUTL5",120,0)
 ; 'C' defines the data type of the variable 'Y'
"RTN","RAUTL5",121,0)
 D:Y]"" Y^DIQ
"RTN","RAUTL5",122,0)
 Q Y
"RTN","RAUTL5",123,0)
PROCMSG(RAPRI) ; Print the appropriate procedure messages.  Called from
"RTN","RAUTL5",124,0)
 ; DESDT^RAUTL12.  This code works under the assumption that the
"RTN","RAUTL5",125,0)
 ; user has entered through OE/RR.
"RTN","RAUTL5",126,0)
 ;ATTENTION: this code must be parallet to code in EN2^RAPRI
"RTN","RAUTL5",127,0)
 Q:+$G(RASTOP)  ; Do not display if displayed in the past.
"RTN","RAUTL5",128,0)
 I $O(^RAMIS(71,RAPRI,3,0)) D  S RASTOP=1
"RTN","RAUTL5",129,0)
 . N I,RAX,X S I=0
"RTN","RAUTL5",130,0)
 . W !!?5,"NOTE: The following special requirements apply to this "
"RTN","RAUTL5",131,0)
 . W "procedure:",$C(7),!
"RTN","RAUTL5",132,0)
 . F  S I=+$O(^RAMIS(71,RAPRI,3,I)) Q:'I  D
"RTN","RAUTL5",133,0)
 .. S RAX=+$G(^RAMIS(71,RAPRI,3,I,0))
"RTN","RAUTL5",134,0)
 .. I $D(^RAMIS(71.4,+RAX,0)) D
"RTN","RAUTL5",135,0)
 ... I $Y>(IOSL-6) D READ^ORUTL W @IOF
"RTN","RAUTL5",136,0)
 ... S X=$G(^RAMIS(71.4,+RAX,0)) W !?3,X
"RTN","RAUTL5",137,0)
 ... Q
"RTN","RAUTL5",138,0)
 .. Q
"RTN","RAUTL5",139,0)
 . Q
"RTN","RAUTL5",140,0)
 I $O(^RAMIS(71,RAPRI,"EDU",0)),($$UP^XLFSTR($P($G(^RAMIS(71,RAPRI,0)),"^",17))="Y") D
"RTN","RAUTL5",141,0)
 . W:+$O(^RAMIS(71,+RAPRI,3,0))>0 !!
"RTN","RAUTL5",142,0)
 . N DIW,DIWF,DIWL,DIWR,RAX,X
"RTN","RAUTL5",143,0)
 . K ^UTILITY($J,"W") S DIWF="W",DIWL=1,DIWR=75,RAX=0
"RTN","RAUTL5",144,0)
 . F  S RAX=$O(^RAMIS(71,RAPRI,"EDU",RAX)) Q:RAX'>0  D
"RTN","RAUTL5",145,0)
 .. I $Y>(IOSL-4) D READ^ORUTL W @IOF
"RTN","RAUTL5",146,0)
 .. S X=$G(^RAMIS(71,RAPRI,"EDU",RAX,0)) D ^DIWP
"RTN","RAUTL5",147,0)
 .. Q
"RTN","RAUTL5",148,0)
 . I $Y>(IOSL-4) D READ^ORUTL W @IOF
"RTN","RAUTL5",149,0)
 . D ^DIWW
"RTN","RAUTL5",150,0)
 . W !
"RTN","RAUTL5",151,0)
 . Q
"RTN","RAUTL5",152,0)
 Q
"RTN","RAUTL5",153,0)
MIDNGHT(X) ; Check if the date passed in is midnight.  If it is, add one
"RTN","RAUTL5",154,0)
 ; minute to the date/time.  Fixes infinite loop problem in FM when
"RTN","RAUTL5",155,0)
 ; midnight.
"RTN","RAUTL5",156,0)
 ; Input: X-Current system date/time (derived from $$NOW^XLFDT)
"RTN","RAUTL5",157,0)
 S:X["." X=$E(X,1,($F(X,".")+3)) ; chop off seconds IF there's decimal
"RTN","RAUTL5",158,0)
 S:+$P(X,".",2)=24!(+$P(X,".",2)=0) X=$$FMADD^XLFDT(X,0,0,1,0) ; add a minute to midnight
"RTN","RAUTL5",159,0)
 Q X
"RTN","RAUTL5",160,0)
 ;
"RTN","RAUTL5",161,0)
STYREA(RAOUT,RAREAST) ;ask for the 'Reason for Study' P75 (required)
"RTN","RAUTL5",162,0)
 ;return: RAOUT-set if the user enters '^' or times out
"RTN","RAUTL5",163,0)
 ;      RAREAST-the reason entered by the user
"RTN","RAUTL5",164,0)
 N DA,DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y S DIR(0)="75.1,1.1" D ^DIR
"RTN","RAUTL5",165,0)
 S:$D(DIRUT)#2 RAOUT="" Q:$D(RAOUT)#2  S RAREAST=Y
"RTN","RAUTL5",166,0)
 Q
"RTN","RAUTL5",167,0)
 ;
"RTN","RAUTL5",168,0)
DIWP(DIWL,DIWR,X) ; work ^DIWP & ^DIWW FM call "WRITE" mode P75
"RTN","RAUTL5",169,0)
 ;input: DIWL=left margin
"RTN","RAUTL5",170,0)
 ;       DIWR=right margin
"RTN","RAUTL5",171,0)
 ;          X=text to be formatted
"RTN","RAUTL5",172,0)
 N %,DIW,DIWF,DIWT,DN,I,Z
"RTN","RAUTL5",173,0)
 K ^UTILITY($J,"W") S DIWF="W" D ^DIWP,^DIWW
"RTN","RAUTL5",174,0)
 K ^UTILITY($J,"W")
"RTN","RAUTL5",175,0)
 Q
"RTN","RAUTL5",176,0)
 ;
"RTN","RAUTL5",177,0)
PURGECH ;Delete the invalid 'CLINICAL HISTORY'; inform the user
"RTN","RAUTL5",178,0)
 ;of the deletion (user interactive roll & scroll interface).
"RTN","RAUTL5",179,0)
 W !,"Invalid CLINICAL HISTORY deleted..." K ^TMP($J,"RAWP")
"RTN","RAUTL5",180,0)
 Q
"RTN","RAUTL5",181,0)
 ;
"VER")
8.0^22.0
"^DD",75.1,75.1,1.1,0)
REASON FOR STUDY^RF^^.1;1^K:$L(X)>64!($L(X)<3) X
"^DD",75.1,75.1,1.1,3)
The reason for study must be 3-64 characters in length.
"^DD",75.1,75.1,1.1,21,0)
^^3^3^3060531^
"^DD",75.1,75.1,1.1,21,1,0)
The reason for the study is often a short patient history summarizing the 
"^DD",75.1,75.1,1.1,21,2,0)
condition of the patient and giving background information as to why the 
"^DD",75.1,75.1,1.1,21,3,0)
study has been initiated.
"^DD",75.1,75.1,1.1,23,0)
^^4^4^3060531^
"^DD",75.1,75.1,1.1,23,1,0)
The 'REASON FOR STUDY' field was added as a result of NSR: 20050606
"^DD",75.1,75.1,1.1,23,2,0)
'Standardize Vista RIS messaging interface to current IHE specs').
"^DD",75.1,75.1,1.1,23,3,0)
 
"^DD",75.1,75.1,1.1,23,4,0)
This field was exported in patch RA*5.0*75.
"^DD",75.1,75.1,1.1,"DT")
3050823
"BLD",6203,6)
^69
**END**
**END**
