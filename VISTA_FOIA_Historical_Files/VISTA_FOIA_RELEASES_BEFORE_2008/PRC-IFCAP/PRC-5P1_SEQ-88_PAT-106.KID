Released PRC*5.1*106 SEQ #88
Extracted from mail message
**KIDS**:PRC*5.1*106^

**INSTALL NAME**
PRC*5.1*106
"BLD",5016,0)
PRC*5.1*106^IFCAP^0^3060919^y
"BLD",5016,1,0)
^^8^8^3060816^
"BLD",5016,1,1,0)
This patch addresses three issues.  The first issue is  with the option
"BLD",5016,1,2,0)
PRCH CREATE PURCHASE CARD which creates a purchase card order from a
"BLD",5016,1,3,0)
Repetitive Item List (RIL). An undefined error occurs when one user
"BLD",5016,1,4,0)
deletes an RIL that is being used by another user.  The second issue is an
"BLD",5016,1,5,0)
<undefined> error when running the option Mandatory Sources 850
"BLD",5016,1,6,0)
Undelivered Orders when there are 0 records to report.  The third issue 
"BLD",5016,1,7,0)
is a <undefined> error when the user tries to quit the report display 
"BLD",5016,1,8,0)
with an '^' at the start of a new page.
"BLD",5016,4,0)
^9.64PA^^
"BLD",5016,"KRN",0)
^9.67PA^8989.52^19
"BLD",5016,"KRN",.4,0)
.4
"BLD",5016,"KRN",.401,0)
.401
"BLD",5016,"KRN",.402,0)
.402
"BLD",5016,"KRN",.403,0)
.403
"BLD",5016,"KRN",.5,0)
.5
"BLD",5016,"KRN",.84,0)
.84
"BLD",5016,"KRN",3.6,0)
3.6
"BLD",5016,"KRN",3.8,0)
3.8
"BLD",5016,"KRN",9.2,0)
9.2
"BLD",5016,"KRN",9.8,0)
9.8
"BLD",5016,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5016,"KRN",9.8,"NM",1,0)
PRCHRPT1^^0^B44428291
"BLD",5016,"KRN",9.8,"NM",2,0)
PRCH442A^^0^B65308307
"BLD",5016,"KRN",9.8,"NM",3,0)
PRCFUOMS^^0^B8391400
"BLD",5016,"KRN",9.8,"NM","B","PRCFUOMS",3)

"BLD",5016,"KRN",9.8,"NM","B","PRCH442A",2)

"BLD",5016,"KRN",9.8,"NM","B","PRCHRPT1",1)

"BLD",5016,"KRN",19,0)
19
"BLD",5016,"KRN",19.1,0)
19.1
"BLD",5016,"KRN",101,0)
101
"BLD",5016,"KRN",409.61,0)
409.61
"BLD",5016,"KRN",771,0)
771
"BLD",5016,"KRN",870,0)
870
"BLD",5016,"KRN",8989.51,0)
8989.51
"BLD",5016,"KRN",8989.52,0)
8989.52
"BLD",5016,"KRN",8994,0)
8994
"BLD",5016,"KRN","B",.4,.4)

"BLD",5016,"KRN","B",.401,.401)

"BLD",5016,"KRN","B",.402,.402)

"BLD",5016,"KRN","B",.403,.403)

"BLD",5016,"KRN","B",.5,.5)

"BLD",5016,"KRN","B",.84,.84)

"BLD",5016,"KRN","B",3.6,3.6)

"BLD",5016,"KRN","B",3.8,3.8)

"BLD",5016,"KRN","B",9.2,9.2)

"BLD",5016,"KRN","B",9.8,9.8)

"BLD",5016,"KRN","B",19,19)

"BLD",5016,"KRN","B",19.1,19.1)

"BLD",5016,"KRN","B",101,101)

"BLD",5016,"KRN","B",409.61,409.61)

"BLD",5016,"KRN","B",771,771)

"BLD",5016,"KRN","B",870,870)

"BLD",5016,"KRN","B",8989.51,8989.51)

"BLD",5016,"KRN","B",8989.52,8989.52)

"BLD",5016,"KRN","B",8994,8994)

"BLD",5016,"QUES",0)
^9.62^^
"BLD",5016,"REQB",0)
^9.611^2^2
"BLD",5016,"REQB",1,0)
PRC*5.1*81^2
"BLD",5016,"REQB",2,0)
PRC*5.1*70^2
"BLD",5016,"REQB","B","PRC*5.1*70",2)

"BLD",5016,"REQB","B","PRC*5.1*81",1)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
106^3060919
"PKG",455,22,1,"PAH",1,1,0)
^^8^8^3060919
"PKG",455,22,1,"PAH",1,1,1,0)
This patch addresses three issues.  The first issue is  with the option
"PKG",455,22,1,"PAH",1,1,2,0)
PRCH CREATE PURCHASE CARD which creates a purchase card order from a
"PKG",455,22,1,"PAH",1,1,3,0)
Repetitive Item List (RIL). An undefined error occurs when one user
"PKG",455,22,1,"PAH",1,1,4,0)
deletes an RIL that is being used by another user.  The second issue is an
"PKG",455,22,1,"PAH",1,1,5,0)
<undefined> error when running the option Mandatory Sources 850
"PKG",455,22,1,"PAH",1,1,6,0)
Undelivered Orders when there are 0 records to report.  The third issue 
"PKG",455,22,1,"PAH",1,1,7,0)
is a <undefined> error when the user tries to quit the report display 
"PKG",455,22,1,"PAH",1,1,8,0)
with an '^' at the start of a new page.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PRCFUOMS")
0^3^B8391400^B8946273
"RTN","PRCFUOMS",1,0)
PRCFUOMS ;WISC/PL-850 UNDELIVERED ORDERS FOR MANDATED SOURCE ; 8/22/96  1:38 PM
"RTN","PRCFUOMS",2,0)
V ;;5.1;IFCAP;**106**;Oct 20, 2000
"RTN","PRCFUOMS",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCFUOMS",4,0)
 S (PRCFAS,PRCFCS,PRCFOS,PRCFAT,PRCFCT,PRCFOT)=0,L=0
"RTN","PRCFUOMS",5,0)
 S DIC="^PRC(442,",DHD="850 UNDELIVERED ORDERS FOR MANDATED SOURCES"
"RTN","PRCFUOMS",6,0)
 S FLDS="[PRCFUOMS]",BY="[PRCFUOMS]",DIOEND="D B^PRCFUOMS"
"RTN","PRCFUOMS",7,0)
 S DIS(0)="I $D(^PRC(442,D0,0)),$O(^PRC(442,D0,22,0))>0 I $P(^PRC(442,D0,0),U,17)'=$P(^(0),U,16)"
"RTN","PRCFUOMS",8,0)
 S PRCFI=";30;31;33;37;38;40;41;45;48;49;"
"RTN","PRCFUOMS",9,0)
 S DIS(1)="I $G(^PRC(442,D0,7)),PRCFI'[("";""_$P($G(^PRC(442,D0,7)),""^"",2)_"";"") D C^PRCFUOMS I PRCFU>.01"
"RTN","PRCFUOMS",10,0)
 D EN1^DIP
"RTN","PRCFUOMS",11,0)
EXIT K PRCFS,PRCFS1,PRCFO,PRCFO1,PRCFC,PRCFA,PRCFA1,PRCFI,PRCFAS,PRCFCS,PRCFOS,PRCFAT,PRCFCT,PRCFOT,PRCFTOT,PRCFII,PRCFLAG,PRCFSS,PRCFU,PRCTDT,PRCFAP,ZBOC
"RTN","PRCFUOMS",12,0)
 Q
"RTN","PRCFUOMS",13,0)
B S PRCFB=1 D SUB W !!,?14,"TOTAL NUMBER RECORDS    ",PRCFCT,?58,"TOTALS  $",?71,$J(PRCFOT,12,2),?85,$J(PRCFAT,12,2),?100,$J(PRCFOT-PRCFAT,12,2)
"RTN","PRCFUOMS",14,0)
 K PRCFAP,PRCFCAP,PRCFB,PRCFAS,PRCFOS,PRCFUS,PRCFCS,PRCFAT,PRCFCT,PRCFOT Q
"RTN","PRCFUOMS",15,0)
SUB I 'PRCFCT W !!
"RTN","PRCFUOMS",16,0)
 S PRCFUS=PRCFOS-PRCFAS W ?71,"------------",?85,"------------",?100,"------------",!,?20,"NUMBER RECORDS    ",PRCFCS,?55,"SUBTOTALS  $",?71,$J(PRCFOS,12,2),?85,$J(PRCFAS,12,2),?100,$J(PRCFUS,12,2)
"RTN","PRCFUOMS",17,0)
 W:'$D(PRCFB) !!,?11,"APPROPRIATION: ",PRCFCAP S (PRCFCS,PRCFOS,PRCFAS)=0
"RTN","PRCFUOMS",18,0)
 Q
"RTN","PRCFUOMS",19,0)
C S (PRCFO,PRCFS,PRCFSS,PRCFA,PRCFA1,PRCFU)=0 N I
"RTN","PRCFUOMS",20,0)
 S PRCFMULT=100-$P($G(^PRC(442,D0,5,1,0)),U,1)/100
"RTN","PRCFUOMS",21,0)
 S PRCFSHIP=$P($G(^PRC(442,D0,0)),U,13)
"RTN","PRCFUOMS",22,0)
 S PRCFSBOC=+$P($G(^PRC(442,D0,23)),U,1)
"RTN","PRCFUOMS",23,0)
 K PRCFLAG F I=0:0 S I=$O(^PRC(442,D0,22,I)) Q:PRCFU>.01!(I'>0)  I $D(^PRC(442,D0,22,I,0)),+$P(^(0),U,1)'=0 S PRCFS=$P(^(0),U,1),PRCFO=$P(^(0),U,2) D
"RTN","PRCFUOMS",24,0)
 .  S (PRCFA1,PRCFJ)=0
"RTN","PRCFUOMS",25,0)
 .  F  S PRCFJ=$O(^PRC(442,D0,2,PRCFJ)) Q:PRCFJ'>0  I $D(^(PRCFJ,0)),$P(^PRC(442,D0,2,PRCFJ,0),U,4)'="" S PRCFSS=$P(^(0),U,4) I +PRCFS=+PRCFSS D
"RTN","PRCFUOMS",26,0)
 .  .  K PRCFTOT F PRCFII=0:0 S PRCFII=$O(^PRC(442,D0,2,PRCFJ,3,PRCFII)) Q:PRCFII'>0  I $D(^(PRCFII,0)),$P(^(0),U,3) S PRCFA=$P(^(0),U,3)-$P(^(0),U,5),PRCFA1=PRCFA1+PRCFA
"RTN","PRCFUOMS",27,0)
 .  S PRCFA1=PRCFA1*PRCFMULT,PRCFU=PRCFO-PRCFA1
"RTN","PRCFUOMS",28,0)
 .  I PRCFU>.01,PRCFA1,PRCFSBOC=PRCFS S PRCFU=PRCFU-PRCFSHIP
"RTN","PRCFUOMS",29,0)
 Q
"RTN","PRCH442A")
0^2^B65308307^B63170859
"RTN","PRCH442A",1,0)
PRCH442A ;WISC/KMB/CR/DXH/DGL-CREATE PURCHASE CARD ORDER FROM RIL ;4/13/00 1:32pm
"RTN","PRCH442A",2,0)
 ;;5.1;IFCAP;**8,35,26,57,81,106**;Oct 20, 2000
"RTN","PRCH442A",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCH442A",4,0)
 ;
"RTN","PRCH442A",5,0)
SETUP ; create 442 entry
"RTN","PRCH442A",6,0)
 D ENPO^PRCHUTL
"RTN","PRCH442A",7,0)
 ;
"RTN","PRCH442A",8,0)
 ; PRC*5.1*81 - If this is a DynaMed RIL, double dare users who try to exit before all items on the RIL are transferred to purchase card orders
"RTN","PRCH442A",9,0)
 I '$D(DA),'PRCVDYN S OUTRIL=1 W !,"Unable to create 442 entry. Try later." Q
"RTN","PRCH442A",10,0)
 I '$D(DA) D  G SETUP:Y=0 S OUTRIL=1 Q
"RTN","PRCH442A",11,0)
 . N DIR
"RTN","PRCH442A",12,0)
 . S DIR(0)="Y",DIR("B")="NO"
"RTN","PRCH442A",13,0)
 . S DIR("A",1)=" "
"RTN","PRCH442A",14,0)
 . S DIR("A",2)="NOTE: This RIL Contains DynaMed Orders!!!"
"RTN","PRCH442A",15,0)
 . S DIR("A",3)="-----------------------------------------"
"RTN","PRCH442A",16,0)
 . S DIR("A",4)="You must enter a valid PURCHASE ORDER NUMBER to continue.  If no valid"
"RTN","PRCH442A",17,0)
 . S DIR("A",5)="PURCHASE ORDER is entered, all items remaining on the RIL will be deleted."
"RTN","PRCH442A",18,0)
 . S DIR("A",6)=" "
"RTN","PRCH442A",19,0)
 . S DIR("A")="Do you want to exit and delete the RIL?"
"RTN","PRCH442A",20,0)
 . S DIR("?")="Enter 'NO' or <return> to go back to the PURCHASE ORDER prompt"
"RTN","PRCH442A",21,0)
 . D ^DIR Q:Y=0
"RTN","PRCH442A",22,0)
 . S DIR("A")="Are you sure that you want to cancel ALL DynaMed Orders on this RIL?"
"RTN","PRCH442A",23,0)
 . D ^DIR
"RTN","PRCH442A",24,0)
 ;
"RTN","PRCH442A",25,0)
 I '$G(^PRCS(410.3,XDA,0)) D  S OUTRIL=1 W !!,"Another user has deleted this RIL, Purchase Order will now be deleted.",!! Q
"RTN","PRCH442A",26,0)
 . S DIK="^PRC(442,",DA=DA
"RTN","PRCH442A",27,0)
 . D ^DIK
"RTN","PRCH442A",28,0)
 N PRCHCPD,CP1
"RTN","PRCH442A",29,0)
 S PDA=DA L +^PRC(442,PDA):15 Q:'$T
"RTN","PRCH442A",30,0)
 S DIE="^PRC(442,",DR=".5////1"_";"_"1.4////"_APP D ^DIE ;LIT-0400-70331
"RTN","PRCH442A",31,0)
 I $G(RLFLAG)'=1 S DR=".02///25"_";"_"48///P" D ^DIE
"RTN","PRCH442A",32,0)
 I $G(RLFLAG)=1 S DR=".02///1"_";"_"47///Y"_";"_"48///D" D ^DIE
"RTN","PRCH442A",33,0)
 S $P(^PRC(442,PDA,1),"^")=VENDOR,$P(^(0),"^",3)=FCP,$P(^(0),"^",5)=CCEN,$P(^(23),"^",7)=PRC("SST"),$P(^(23),"^",14)=VENDOR
"RTN","PRCH442A",34,0)
 S DIE="^PRC(442,",DR=".03///"_SPEC_";"_".1////"_TDATE D ^DIE
"RTN","PRCH442A",35,0)
 ;
"RTN","PRCH442A",36,0)
 ; PRC*5.1*81 
"RTN","PRCH442A",37,0)
 I PRCVDYN S DR="7///"_PRCVDATE_";"_"54///Y" D ^DIE ; save earliest Need By Date in RIL for vendor in PC order delivery date, force 'Requested Receipt?' to Yes
"RTN","PRCH442A",38,0)
 ;
"RTN","PRCH442A",39,0)
 ;BUT-0701-21784 & WAS-0498-22000
"RTN","PRCH442A",40,0)
 S CP1=$P($P(^PRCS(410.3,XDA,0),U),"-",4)
"RTN","PRCH442A",41,0)
 S ^PRC(442,"E",CP1,PDA)=""
"RTN","PRCH442A",42,0)
 ;
"RTN","PRCH442A",43,0)
 S $P(^PRC(442,PDA,1),"^",10)=DUZ,^PRC(442,"D",$E(VENDOR,1,30),PDA)=""
"RTN","PRCH442A",44,0)
 I NCOST'=0 F II=1:1:CNNT D SETIT
"RTN","PRCH442A",45,0)
 I NCOST'=0 S ^PRC(442,PDA,2,0)="^442.01IA^"_CNNT_"^"_CNNT
"RTN","PRCH442A",46,0)
 S EE($J,PDA)=""
"RTN","PRCH442A",47,0)
 ;
"RTN","PRCH442A",48,0)
 N NCST,NLP,NCNT,NQTY,NSUB
"RTN","PRCH442A",49,0)
LOOP S %=1 W !,"Edit request ",$P(^PRC(442,PDA,0),"^")
"RTN","PRCH442A",50,0)
 D YN^DICN G:%=0 LOOP G:%=2 LQ
"RTN","PRCH442A",51,0)
 S (PRCHPO,DA)=PDA,PRC("PER")=DUZ,X=1
"RTN","PRCH442A",52,0)
 D ^PRCHNPO,LOOPA
"RTN","PRCH442A",53,0)
 K PRC("PER"),X,PRCHPO
"RTN","PRCH442A",54,0)
LQ L -^PRC(442,PDA) Q
"RTN","PRCH442A",55,0)
 ;
"RTN","PRCH442A",56,0)
LOOPA Q:$G(^PRC(442,PDA,2,0))=""  S NCNT=$P($G(^PRC(442,PDA,2,0)),U,4) Q:NCNT=""  S NSUB=0 F NLP=1:1:NCNT D
"RTN","PRCH442A",57,0)
 .S NQTY=$P($G(^PRC(442,PDA,2,NLP,0)),U,2),NCST=$P($G(^PRC(442,PDA,2,NLP,0)),U,9),NSUB=NSUB+(NQTY*NCST)
"RTN","PRCH442A",58,0)
 S CNNT=NCNT,NCOST=NSUB Q
"RTN","PRCH442A",59,0)
 ;
"RTN","PRCH442A",60,0)
SETIT ;set item data on 442 record
"RTN","PRCH442A",61,0)
 S ^PRC(442,PDA,2,II,0)=AA(II)
"RTN","PRCH442A",62,0)
 I CNNT1'="" F J=1:1:CNNT1 S ^PRC(442,PDA,2,II,1,J,0)=$G(BB(II,J))
"RTN","PRCH442A",63,0)
 S ^PRC(442,PDA,2,II,2)=CC(II)
"RTN","PRCH442A",64,0)
 ;
"RTN","PRCH442A",65,0)
 ; PRC*5.1*81
"RTN","PRCH442A",66,0)
 I PRCVDYN D
"RTN","PRCH442A",67,0)
 . N PRCV S PRCV=0
"RTN","PRCH442A",68,0)
 . I $P(CC(II),"^",15)]"" S PRCV=$O(^PRCV(414.02,"B",$P(CC(II),"^",15),"")) ; get ien of DM DOC ID
"RTN","PRCH442A",69,0)
 . I +PRCV=0 D  Q  ; if not in audit file update ^TMP to alert user
"RTN","PRCH442A",70,0)
 . . S ^TMP($J,"PRCVHMSG",YDA,ITEM)=$P(CC(II),"^",15)_"^"_$P(^PRC(442,PDA,0),"^",1) Q  ; update msg to user to show DM, DOC ID & PO#
"RTN","PRCH442A",71,0)
 . S $P(^PRCV(414.02,PRCV,0),"^",11)=$P(^PRC(442,PDA,0),"^",1) ; SET PO Number into Audit file
"RTN","PRCH442A",72,0)
 ;
"RTN","PRCH442A",73,0)
 S ^PRC(442,PDA,2,II,1,0)="^^"_CNNT1_"^"_CNNT1_"^"_TDATE_"^"
"RTN","PRCH442A",74,0)
 S ^PRC(442,PDA,2,"B",II,II)="",^PRC(442,PDA,2,"C",II,II)=""
"RTN","PRCH442A",75,0)
 S ^PRC(442,PDA,2,"AE",ITEM,II)="" S:BOC'="" ^PRC(442,PDA,2,"AH",+BOC,II,II)="",^PRC(442,PDA,2,"D",+BOC,II)=""
"RTN","PRCH442A",76,0)
 I $G(PRCSIP) D
"RTN","PRCH442A",77,0)
 . N DIC,DIE,DA,DLAYGO
"RTN","PRCH442A",78,0)
 . S DIC="^PRC(442,"_PDA_",2,"_II_",5,",DA(1)=II,DA(2)=PDA,X=PRCSIP
"RTN","PRCH442A",79,0)
 . S DIC(0)="L",DIC("P")=$P(^DD(442.01,47,0),U,2),DLAYGO=442
"RTN","PRCH442A",80,0)
 . D FILE^DICN
"RTN","PRCH442A",81,0)
 K DIE
"RTN","PRCH442A",82,0)
 ;
"RTN","PRCH442A",83,0)
 ; PRC*5.1*81 - delete items from RIL as they are moved to a PC order
"RTN","PRCH442A",84,0)
 I PRCVDYN D
"RTN","PRCH442A",85,0)
 . N DA,DIK
"RTN","PRCH442A",86,0)
 . S DA=GG(II),DA(1)=YDA,DIK="^PRCS(410.3,"_DA(1)_",1,"
"RTN","PRCH442A",87,0)
 . D ^DIK
"RTN","PRCH442A",88,0)
 ;
"RTN","PRCH442A",89,0)
 S PRCHCPD=TDATE,PRCHCV=VENDOR,(DA(1),PRCHCPO)=PDA,PRCHCCP=CP1,(PRCHCI,PRCHCII,X)=$P(AA(II),"^",5),DA=II
"RTN","PRCH442A",90,0)
 I PRCHCI'="" D EN3^PRCHCRD S ^PRC(442,PDA,2,"AE",PRCHCII,II)=""
"RTN","PRCH442A",91,0)
 K PRCHCCP,PRCHCPO,PRCHCV,PRCHCI,PRCHCII
"RTN","PRCH442A",92,0)
 QUIT
"RTN","PRCH442A",93,0)
 ;
"RTN","PRCH442A",94,0)
INCOM1 S FLAG=0
"RTN","PRCH442A",95,0)
INCOM2 S:$G(FLAG)="" FLAG=1
"RTN","PRCH442A",96,0)
INCOM ;
"RTN","PRCH442A",97,0)
 K ^TMP($J)
"RTN","PRCH442A",98,0)
 N ZP,LABEL,PC1,PONUM,PODATE,STAT,PANAME,ADATE,Y,XXZ,EX,P,P1,P12,P2,P23,STR,TIMEDATE
"RTN","PRCH442A",99,0)
 S:$G(FLAG)="" LABEL="INCOM" S:$G(FLAG)=0 LABEL="INCOM1" S:$G(FLAG)=1 LABEL="INCOM2"
"RTN","PRCH442A",100,0)
 W @IOF
"RTN","PRCH442A",101,0)
 S PRCF("X")="S" D ^PRCFSITE Q:'$D(PRC("SITE"))  Q:$G(PRC("SITE"))="^"
"RTN","PRCH442A",102,0)
 W !,"Please select a device for printing this report."
"RTN","PRCH442A",103,0)
 S %ZIS("B")="",%ZIS="MQ" D ^%ZIS Q:POP
"RTN","PRCH442A",104,0)
 I $D(IO("Q")) S ZTSAVE("*")="",ZTRTN="DETAIL^PRCH442A" D ^%ZTLOAD,^%ZISC K FLAG Q
"RTN","PRCH442A",105,0)
 D DETAIL,^%ZISC K FLAG
"RTN","PRCH442A",106,0)
 Q
"RTN","PRCH442A",107,0)
 ;
"RTN","PRCH442A",108,0)
DETAIL ;
"RTN","PRCH442A",109,0)
 S X=DT D NOW^%DTC,YX^%DTC S TIMEDATE=Y,CNT=0
"RTN","PRCH442A",110,0)
 S ZP="" F  S ZP=$O(^PRC(442,"F",25,ZP)) Q:ZP=""  D
"RTN","PRCH442A",111,0)
 .Q:$P($G(^PRC(442,ZP,7)),"^")=45
"RTN","PRCH442A",112,0)
 .Q:$D(^PRC(442,ZP,11))
"RTN","PRCH442A",113,0)
 .Q:$P($G(^PRC(442,ZP,12)),"^",2)'=""
"RTN","PRCH442A",114,0)
 .S P1=$G(^PRC(442,ZP,0)),PONUM=$P(P1,"^")
"RTN","PRCH442A",115,0)
 .I $D(PRC("SITE")) Q:$P(P1,"-")'=PRC("SITE")
"RTN","PRCH442A",116,0)
 .S PC1=$P($G(^PRC(442,ZP,23)),"^",8) I PC1="" D DETAIL1
"RTN","PRCH442A",117,0)
 .Q:PC1=""
"RTN","PRCH442A",118,0)
 .I $G(FLAG)=0 Q:$P($G(^PRC(440.5,PC1,0)),"^",8)'=DUZ
"RTN","PRCH442A",119,0)
 .I $G(FLAG)=1 I $P($G(^PRC(440.5,PC1,0)),"^",10)'=DUZ,$P($G(^PRC(440.5,PC1,0)),"^",9)'=DUZ Q
"RTN","PRCH442A",120,0)
 .S P2=$G(^PRC(442,ZP,1)),PA=$P($G(^PRC(440.5,PC1,0)),"^",8) Q:PA=""
"RTN","PRCH442A",121,0)
 .S PANAME=$P($G(^VA(200,PA,0)),"^") Q:PANAME=""
"RTN","PRCH442A",122,0)
 .S Y=$P(P2,"^",15) D DD^%DT S PODATE=Y
"RTN","PRCH442A",123,0)
 .S STAT=$P($G(^PRC(442,ZP,7)),"^") S:STAT'="" STAT=$P($G(^PRCD(442.3,STAT,0)),"^")
"RTN","PRCH442A",124,0)
 .S Y=$P($G(^PRC(442,ZP,12)),"^",5) D DD^%DT S ADATE=Y
"RTN","PRCH442A",125,0)
 .S ^TMP($J,ZP)=PONUM_"^"_PODATE_"^"_STAT_"^"_PANAME_"^"_ADATE,CNT=$G(CNT)+1
"RTN","PRCH442A",126,0)
 D WRTE
"RTN","PRCH442A",127,0)
 W:$D(^TMP($J)) !!!,?10,"Total number of orders found: "_CNT
"RTN","PRCH442A",128,0)
 K ^TMP($J),CNT
"RTN","PRCH442A",129,0)
 Q
"RTN","PRCH442A",130,0)
 ;
"RTN","PRCH442A",131,0)
DETAIL1 ;Get tally for the PC user and exclude the Approving Official.
"RTN","PRCH442A",132,0)
 Q:$G(FLAG)=1
"RTN","PRCH442A",133,0)
 ;if the PC Coordinator is asking for the report, get the orders.
"RTN","PRCH442A",134,0)
 I $G(FLAG)="" D DETAIL2
"RTN","PRCH442A",135,0)
 Q:$P($G(^PRC(442,ZP,12)),"^",4)'=DUZ!($G(FLAG)'=0)
"RTN","PRCH442A",136,0)
 S PA=$P(^PRC(442,ZP,12),"^",4),PANAME=$P(^VA(200,PA,0),"^") Q:PANAME=""
"RTN","PRCH442A",137,0)
 S Y=$P(^PRC(442,ZP,12),"^",5) D DD^%DT S ADATE=Y,PODATE=$P(Y,"@",1)
"RTN","PRCH442A",138,0)
 S STAT=$P($G(^PRC(442,ZP,7)),"^") S:STAT'="" STAT=$P($G(^PRCD(442.3,STAT,0)),"^")
"RTN","PRCH442A",139,0)
 S ^TMP($J,ZP)=PONUM_"^"_PODATE_"^"_STAT_"^"_PANAME_"^"_ADATE,CNT=$G(CNT)+1
"RTN","PRCH442A",140,0)
 Q
"RTN","PRCH442A",141,0)
 ;
"RTN","PRCH442A",142,0)
DETAIL2 ;Get tally for the PC Coordinator.
"RTN","PRCH442A",143,0)
 S PA=$P(^PRC(442,ZP,12),"^",4),PANAME=$P(^VA(200,PA,0),"^") Q:PANAME=""
"RTN","PRCH442A",144,0)
 S Y=$P(^PRC(442,ZP,12),"^",5) D DD^%DT S ADATE=Y,PODATE=$P(Y,"@",1)
"RTN","PRCH442A",145,0)
 S STAT=$P($G(^PRC(442,ZP,7)),"^") S:STAT'="" STAT=$P($G(^PRCD(442.3,STAT,0)),"^")
"RTN","PRCH442A",146,0)
 S ^TMP($J,ZP)=PONUM_"^"_PODATE_"^"_STAT_"^"_PANAME_"^"_ADATE,CNT=$G(CNT)+1
"RTN","PRCH442A",147,0)
 Q
"RTN","PRCH442A",148,0)
 ;
"RTN","PRCH442A",149,0)
WRTE ;
"RTN","PRCH442A",150,0)
 U IO S (P,EX)=1
"RTN","PRCH442A",151,0)
 I '$D(^TMP($J)) D HDR W !!!!,?10,"*** NO RECORDS TO PRINT ***" Q
"RTN","PRCH442A",152,0)
 S ZP="" F  S ZP=$O(^TMP($J,ZP)) Q:ZP=""  Q:EX="^"  D
"RTN","PRCH442A",153,0)
 .D:P=1 HDR
"RTN","PRCH442A",154,0)
 .W !,$P(^TMP($J,ZP),"^"),?21,$P(^TMP($J,ZP),"^",2),?40,$P(^TMP($J,ZP),"^",3),!,?10,$P(^TMP($J,ZP),"^",4),?40,$P(^TMP($J,ZP),"^",5),!
"RTN","PRCH442A",155,0)
 .I (IOSL-$Y)<6 D HLD Q:EX="^"
"RTN","PRCH442A",156,0)
 QUIT
"RTN","PRCH442A",157,0)
 ;
"RTN","PRCH442A",158,0)
C2237 ;cancel 2237 from PC order
"RTN","PRCH442A",159,0)
 N I,N,T,X,ZX,PRCVIEN
"RTN","PRCH442A",160,0)
 Q:'$D(DA)  S YDA=DA,PRCVIEN=DA,XDA=$P($G(^PRC(442,DA,23)),"^",23) Q:XDA=""  L +^PRCS(410,XDA):15 Q:'$T
"RTN","PRCH442A",161,0)
 S PRC("CP")=$P($G(^PRC(442,YDA,0)),"^",3) Q:+PRC("CP")=""
"RTN","PRCH442A",162,0)
 S T=$P(^PRCS(410,XDA,0),"^"),$P(^(11),"^",3)="",$P(^(0),"^",2)="CA",$P(^(5),"^")=0,$P(^(6),"^")=0 K ^PRCS(410,"F",+T_"-"_+PRC("CP")_"-"_$P(T,"-",5),XDA),^PRCS(410,"F1",$P(T,"-",5)_"-"_+T_"-"_+PRC("CP"),XDA),^PRCS(410,"AQ",1,XDA)
"RTN","PRCH442A",163,0)
 K ZX I $D(^PRCS(410,XDA,4)) S ZX=^(4),X=$P(ZX,"^",8) F I=1,3,6,8 S $P(ZX,"^",I)=0
"RTN","PRCH442A",164,0)
 I $D(ZX) S ^PRCS(410,XDA,4)=ZX K ZX
"RTN","PRCH442A",165,0)
 I $D(^PRCS(410,XDA,12,0)) S N=0 F I=0:0 S N=$O(^PRCS(410,XDA,12,N)) Q:N'>0  S X=$P(^(N,0),"^",2) I X S DA(1)=XDA,DA=N D TRANK^PRCSEZZ S XDA=DA(1)
"RTN","PRCH442A",166,0)
 D ERS410^PRC0G(XDA_"^C")
"RTN","PRCH442A",167,0)
 L -^PRCS(410,XDA)
"RTN","PRCH442A",168,0)
 I $D(^PRC(443,XDA,0)) S DA=XDA,DIK="^PRC(443," D ^DIK K DIK
"RTN","PRCH442A",169,0)
 S DA=YDA
"RTN","PRCH442A",170,0)
 ; PRC*5.1*81 - if site runs DynaMed, may need to build update txn
"RTN","PRCH442A",171,0)
 I $$GET^XPAR("SYS","PRCV COTS INVENTORY",1,"Q")=1 D DEL^PRCV442A(PRCVIEN)
"RTN","PRCH442A",172,0)
 QUIT
"RTN","PRCH442A",173,0)
 ;
"RTN","PRCH442A",174,0)
RENUM ;  delete delivery order items from repetitive item list
"RTN","PRCH442A",175,0)
 Q:$G(^PRCS(410.3,YDA,0))=""
"RTN","PRCH442A",176,0)
 L +^PRCS(410.3,YDA):15 Q:'$T
"RTN","PRCH442A",177,0)
 S IJ="" F  S IJ=$O(^PRCS(410.3,YDA,1,IJ)) Q:IJ=""  D
"RTN","PRCH442A",178,0)
 .I $P($G(^PRCS(410.3,YDA,1,IJ,0)),"^",6)="O" S DA=IJ,DA(1)=YDA,DIK="^PRCS(410.3,"_DA(1)_",1," D ^DIK
"RTN","PRCH442A",179,0)
 L -^PRCS(410.3,YDA)
"RTN","PRCH442A",180,0)
 I $P($G(^PRCS(410.3,YDA,1,0)),"^",4)=0 W !,"This Repetitive Item List has no more items, and will be deleted." S DA=YDA,DIK="^PRCS(410.3," D ^DIK
"RTN","PRCH442A",181,0)
 K DIK QUIT
"RTN","PRCH442A",182,0)
 ;
"RTN","PRCH442A",183,0)
HDR W @IOF
"RTN","PRCH442A",184,0)
 W !,"INCOMPLETE PURCHASE CARD ORDERS REPORT",?45,TIMEDATE,?70,"PAGE ",P
"RTN","PRCH442A",185,0)
 W !,"PURCHASE CARD ORDER",?21,"PO DATE",?40,"SUPPLY STATUS",!,?10,"BUYER",?40,"DATE PO ASSIGNED"
"RTN","PRCH442A",186,0)
 W ! F I=1:1:8 W "----------"
"RTN","PRCH442A",187,0)
 S P=P+1
"RTN","PRCH442A",188,0)
 QUIT
"RTN","PRCH442A",189,0)
 ;
"RTN","PRCH442A",190,0)
HLD G HDR:$P(IOST,"-")="P" W !,"Press return to continue, '^' to exit: " R XXZ:DTIME S:XXZ="^" EX="^" S:'$T EX="^" D:EX'["^" HDR QUIT
"RTN","PRCHRPT1")
0^1^B44428291^B44321172
"RTN","PRCHRPT1",1,0)
PRCHRPT1 ;ID/RSD,SF-ISC/TKW-PRINT OPTIONS ; [1/13/99 1:27pm]
"RTN","PRCHRPT1",2,0)
V ;;5.1;IFCAP;**15,70,106**;Oct 20, 2000
"RTN","PRCHRPT1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHRPT1",4,0)
 ;
"RTN","PRCHRPT1",5,0)
EN ;DISPLAY ITEM HISTORY
"RTN","PRCHRPT1",6,0)
 S PRCF("X")="SP",AGN=1,LLCT=0,LNCT=0 D ^PRCFSITE
"RTN","PRCHRPT1",7,0)
EN0 Q:'$D(PRC("SITE"))  W !! S DIC="^PRC(441,",DIC(0)="QEAMNZ" D ^DIC G Q:Y<0 S D0=+Y I '$D(^(4,0)) W !,"History for this item does not yet exist.   Press <RETURN>" R X:DTIME G EN0
"RTN","PRCHRPT1",8,0)
 S PRCHQ="ITEM^PRCHRPT1",ITMY=Y(0) D RDTXS G:'$D(PRC("SITE")) Q D ^PRCHQUE K DIC,ZTSK,D0
"RTN","PRCHRPT1",9,0)
 G EN0
"RTN","PRCHRPT1",10,0)
 ;
"RTN","PRCHRPT1",11,0)
EN1 ;PRINT ITEM CATALOG
"RTN","PRCHRPT1",12,0)
 S PRCF("X")="SP" D ^PRCFSITE
"RTN","PRCHRPT1",13,0)
EN10 Q:'$D(PRC("SITE"))  K PRCHD S M="FUND CONTROL POINT",DIS(0)="I PRC(""SITE"")=$E($O(^PRC(441,D0,4,""B"",PRC(""SITE""))),1,3)" D RNG G Q:FR["^"!(TO["^") I FR["?"!(TO["?") D DSP^PRCHRPT2 G EN10
"RTN","PRCHRPT1",14,0)
 I FR S X=+FR D FX S FR=X
"RTN","PRCHRPT1",15,0)
 I TO S X=+TO D FX S TO=X
"RTN","PRCHRPT1",16,0)
 S FR=FR_",!",TO=TO_",z",DIC="^PRC(441,",FLDS="[PRCHITCAT]",BY="#@FCP,FCP,FCP,LONG NAME;"""",@$E(SHORT DESCRIPTION,1,50)" S L=0 D EN1^DIP
"RTN","PRCHRPT1",17,0)
 ;
"RTN","PRCHRPT1",18,0)
Q K FR,TO,FLDS,BY,DIC,I,J,K,L,PRC,PRCHFCP,D0,DA,M,DIS,ZTSK
"RTN","PRCHRPT1",19,0)
 K %,ABORT,DIR,FCPNO,FCPTCNT,FCPTPGS,FR1,FR2,FR3,FR4,ITMNO,ITMY,LCNT,LLIM,NXD,PRCHQ,PRCRI,PRCI,RTX,^TEMP("FCPCNT"),^TEMP("FCPDT"),^TEMP("FCPNAME"),^TEMP("FCPPGS"),TO1,TO2,TO3,TO4,TXCNT,TXFCP,TXIEN,TXR,TXS,TXSTN,X,Y
"RTN","PRCHRPT1",20,0)
 K AGN,C,DDH,SCTL,STN,ITMDESC,^TMP("PRCHRPT1",$J)
"RTN","PRCHRPT1",21,0)
 QUIT
"RTN","PRCHRPT1",22,0)
 ;
"RTN","PRCHRPT1",23,0)
FX I $D(^PRC(420,+PRC("SITE"),1,X,0)) S X=PRC("SITE")_$P($P(^(0),U,1)," ",1)
"RTN","PRCHRPT1",24,0)
 Q
"RTN","PRCHRPT1",25,0)
 ;
"RTN","PRCHRPT1",26,0)
ITEM S TXR=$G(^TMP("PRCHITMH",0)) S:'TXR TXR=10
"RTN","PRCHRPT1",27,0)
 S U="^" Q:'$D(^PRC(441,D0,0))  S W=$P(^(0),U,2),ASK=0,(W1,W(3),W(4))=0,W(2)="",PRC("SITE")=$S($D(PRC("SITE")):PRC("SITE"),1:0),W(1)=PRC("SITE")_0 K ^TMP("PRCHRPT1",$J)
"RTN","PRCHRPT1",28,0)
 F W(1)=W(1):0 Q:'$O(^PRC(441,D0,4,"B",W(1)))  S W(1)=$O(^PRC(441,D0,4,"B",W(1))) S PRCHFCP=$S($D(^PRC(420,PRC("SITE"),1,+$E(W(1),4,9),0)):$P(^(0),U,1),1:$E(W(1),4,9)) K ^TMP("PRCHRPT1",$J) D ITEM0 Q:ASK
"RTN","PRCHRPT1",29,0)
 K ASK,W,W1,DIC D:$D(ZTSK) KILL^%ZTLOAD K ZTSK
"RTN","PRCHRPT1",30,0)
 Q
"RTN","PRCHRPT1",31,0)
 ;
"RTN","PRCHRPT1",32,0)
ITEM0 I $D(^PRC(441,D0,4,W(1),1,"AC")) D
"RTN","PRCHRPT1",33,0)
 . S W(2)=""
"RTN","PRCHRPT1",34,0)
 . S W(3)=""
"RTN","PRCHRPT1",35,0)
 . S FLG=""
"RTN","PRCHRPT1",36,0)
 . S COUNT=""
"RTN","PRCHRPT1",37,0)
 . F  S W(3)=$O(^PRC(441,D0,4,W(1),1,"AC",W(3))) Q:W(3)'>0  Q:FLG=1  D
"RTN","PRCHRPT1",38,0)
 . . S W(4)=""
"RTN","PRCHRPT1",39,0)
 . . F  S W(4)=$O(^PRC(441,D0,4,W(1),1,"AC",W(3),W(4))) Q:W(4)'>0  D
"RTN","PRCHRPT1",40,0)
 . . . S ^TMP("PRCHRPT1",$J,(W(4)))=W(4)
"RTN","PRCHRPT1",41,0)
 . . . S COUNT=COUNT+1
"RTN","PRCHRPT1",42,0)
 . . . I COUNT=TXR S FLG=1 Q
"RTN","PRCHRPT1",43,0)
 . . . Q
"RTN","PRCHRPT1",44,0)
 . . Q
"RTN","PRCHRPT1",45,0)
 . Q
"RTN","PRCHRPT1",46,0)
 I '$D(^PRC(441,D0,4,W(1),1,"AC")) D  Q
"RTN","PRCHRPT1",47,0)
 . D HDR
"RTN","PRCHRPT1",48,0)
 . I $D(PRCHFCP) W !!,"FCP: "_PRCHFCP_" has no history for this item."
"RTN","PRCHRPT1",49,0)
 . Q
"RTN","PRCHRPT1",50,0)
NONE I $O(^TMP("PRCHRPT1",$J,0))="" W !,"A history for this item does not yet exist." D  Q
"RTN","PRCHRPT1",51,0)
 . I $G(ZTSK)'>0 W !,"Press RETURN to continue." R X:DTIME Q
"RTN","PRCHRPT1",52,0)
 I $G(LNCT)="" S LNCT=0
"RTN","PRCHRPT1",53,0)
 I LNCT=0 D HDR
"RTN","PRCHRPT1",54,0)
 I LNCT'=0,$E(IOST)="P" S LNCT=0  D HDR
"RTN","PRCHRPT1",55,0)
 I LNCT'=0,$E(IOST)'="P" D ASK Q:ASK  S LNCT=0 D HDR
"RTN","PRCHRPT1",56,0)
 ;
"RTN","PRCHRPT1",57,0)
SKPTXS S NX=0 I $G(LNCT)="" S LNCT=0
"RTN","PRCHRPT1",58,0)
 F K=1:1:TXR Q:'$O(^TMP("PRCHRPT1",$J,NX))  S NX=$O(^TMP("PRCHRPT1",$J,NX)),W(6)=^TMP("PRCHRPT1",$J,NX) Q:W(6)=""  S LNCT=LNCT+1,W(5)=0,W(5)=$O(^PRC(442,W(6),2,"AE",D0,W(5))) I W(5)'="" S W1=W1+1 D ITEM1 D CKLCT Q:ASK
"RTN","PRCHRPT1",59,0)
 I 'W1 K ^TMP("PRCHRPT1",$J) G NONE
"RTN","PRCHRPT1",60,0)
 Q
"RTN","PRCHRPT1",61,0)
 ;
"RTN","PRCHRPT1",62,0)
CKLCT I $E(IOST)'="P"&(LNCT=5) S LNCT=0 D ASK Q:ASK  D HDR:$O(^TMP("PRCHRPT1",$J,NX))
"RTN","PRCHRPT1",63,0)
 I $E(IOST)="P"&(LNCT=50) S LNCT=0 D ASK Q:ASK  D HDR:$O(^TMP("PRCHRPT1",$J,NX))
"RTN","PRCHRPT1",64,0)
 Q
"RTN","PRCHRPT1",65,0)
 ;
"RTN","PRCHRPT1",66,0)
ITEM1 W ! I $D(^PRC(442,W(6),1)),$P(^(1),U,15)'="" S Y=$P(^(1),U,15) D DD^%DT W Y
"RTN","PRCHRPT1",67,0)
 W ?15,$P(^PRC(442,W(6),0),U,1)
"RTN","PRCHRPT1",68,0)
 I $D(^PRC(442,W(6),2,W(5),2)) S W(7)=^(2) W ?26,$J($P(^(2),U,8),10)
"RTN","PRCHRPT1",69,0)
 I $D(^PRC(442,W(6),2,W(5),0)) S W(8)=^(0) W:+$P(W(8),U,3) ?38,$P($G(^PRCD(420.5,+$P(W(8),U,3),0)),U,1)
"RTN","PRCHRPT1",70,0)
 W:$D(W(8)) ?48,$J($P(W(8),U,9),9,2) W:$D(W(7)) ?59,$J($P(W(7),U,1),10,2) W:$D(W(8)) ?71,$J($P(W(8),U,2),8)
"RTN","PRCHRPT1",71,0)
 I $P($G(^PRC(442,W(6),1)),U,1)>0 S W(8)=$P(^(1),U,1),W(8)=$P($G(^PRC(440,W(8),0)),U,1) I W(8)'="" W !,"Vendor: ",W(8)
"RTN","PRCHRPT1",72,0)
 K W(7),W(8)
"RTN","PRCHRPT1",73,0)
 Q
"RTN","PRCHRPT1",74,0)
 ;
"RTN","PRCHRPT1",75,0)
ASK Q:$E(IOST)="P"  W !!,"Press RETURN to continue, '^' to Quit" R X:DTIME I X["^" S ASK=1
"RTN","PRCHRPT1",76,0)
 Q
"RTN","PRCHRPT1",77,0)
 ;
"RTN","PRCHRPT1",78,0)
RNG ; ALLOW ENTRY OF BEGINNING AND ENDING RANGE
"RTN","PRCHRPT1",79,0)
 S FR="",TO="z" W !!!,"START WITH "_M_": FIRST//" R FR:DTIME S:$T=0 FR="^" I (FR["?")!(FR["^")!(FR="") Q
"RTN","PRCHRPT1",80,0)
 I FR'="@",$D(PRCHD),PRCHD="DATE" K %DT S X=FR D ^%DT S FR=Y W:Y=-1 $C(7),!,"INVALID DATE" G:Y=-1 RNG D DD^%DT W "   ",Y
"RTN","PRCHRPT1",81,0)
 W !!,"GO TO "_M_": LAST//" R TO:DTIME S:$T=0 TO="^" Q:(TO["^")!(TO["?")  S:TO="" TO="z" Q:TO="z"
"RTN","PRCHRPT1",82,0)
 I $D(PRCHD),PRCHD="DATE" S X=TO D ^%DT S TO=Y W:Y=-1 $C(7),!,"INVALID DATE" G:Y=-1 RNG D DD^%DT W "   ",Y
"RTN","PRCHRPT1",83,0)
 I (+FR=FR)&(+TO=TO) I FR>TO W $C(7),!,"INVALID RANGE" G RNG
"RTN","PRCHRPT1",84,0)
 I FR'="@" I (+FR'=FR)!(+TO'=TO) I FR]TO W $C(7),!,"INVALID RANGE" G RNG
"RTN","PRCHRPT1",85,0)
 Q
"RTN","PRCHRPT1",86,0)
 ;
"RTN","PRCHRPT1",87,0)
PDT ; ROUTINE ALLOWING ENTRY OF A DATE FOR PRINTING, ETC. (DEFAULTS TO NOW)
"RTN","PRCHRPT1",88,0)
 W !!,"Enter date (and time, if not NOW) to "_M S %DT="AET",%DT("A")="DATE: NOW//" D ^%DT K %DT
"RTN","PRCHRPT1",89,0)
 S:X="" X="NOW",Y=$H S PRCHPDAT=Y Q:X="NOW"!(X["^")  G:Y=-1 PDT
"RTN","PRCHRPT1",90,0)
 I +$P(Y,".",2)'>0 W $C(7),!,"You must enter the time as well as the date to print the report" G PDT
"RTN","PRCHRPT1",91,0)
 S PRCHPDAT=Y
"RTN","PRCHRPT1",92,0)
 Q
"RTN","PRCHRPT1",93,0)
 ;
"RTN","PRCHRPT1",94,0)
SDEV ; SELECT DEVICE FOR QUEUED PRINTING
"RTN","PRCHRPT1",95,0)
 W ! K %ZIS,IOP S %ZIS="Q",IOP="Q",%ZIS("B")="" D ^%ZIS
"RTN","PRCHRPT1",96,0)
 S IOP=ION_";"_IOST_";"_IOM_";"_IOSL I IO=IO(0) D ^%ZIS U IO D @ZTRTN D ^%ZISC
"RTN","PRCHRPT1",97,0)
 Q
"RTN","PRCHRPT1",98,0)
HDR ;
"RTN","PRCHRPT1",99,0)
 ;
"RTN","PRCHRPT1",100,0)
 I $G(LNCT)>0&($E(IOST)'="P") D ASK G:ASK Q
"RTN","PRCHRPT1",101,0)
 W @IOF,!!,"Item Number: ",D0,?25,"Description: ",W,!?8,"FCP: ",PRCHFCP,!!,?26,"Quantity",!,?26,"Previously",?38,"Unit of",?71,"Quantity"
"RTN","PRCHRPT1",102,0)
 W !,"Date Ordered",?15,"PO Number",?26,"Received",?38,"Purchase",?48,"Unit Cost",?59,"Total Cost",?71,"Ordered",! F I=1:1:80 W "_"
"RTN","PRCHRPT1",103,0)
 Q
"RTN","PRCHRPT1",104,0)
RDTXS ; Prompt for # back TX's to list for an FCP(default=10,max=9999)
"RTN","PRCHRPT1",105,0)
 W !
"RTN","PRCHRPT1",106,0)
RDTXS1 K DIR
"RTN","PRCHRPT1",107,0)
 S DIR(0)="F^1:4"
"RTN","PRCHRPT1",108,0)
 S DIR("A")="Enter # BACK TRANSACTIONS to list, 'S' to sort or '^' to EXIT"
"RTN","PRCHRPT1",109,0)
 S DIR("B")=10
"RTN","PRCHRPT1",110,0)
 S DIR("?")="Enter 1-9999 or 'S' to sort by PO Date, FCP, etc."
"RTN","PRCHRPT1",111,0)
 S DIR("??")="^D WARN^PRCHRPT1"
"RTN","PRCHRPT1",112,0)
 D ^DIR
"RTN","PRCHRPT1",113,0)
 S TXS=X
"RTN","PRCHRPT1",114,0)
 I $D(DIRUT) S ABORT=1 G Q
"RTN","PRCHRPT1",115,0)
 I TXS?.N&((TXS<1)!(TXS>9999)) D QUESTION G RDTXS1
"RTN","PRCHRPT1",116,0)
 I TXS?.N S TXR=TXS,^TMP("PRCHITMH",0)=TXR*1,TXR=^TMP("PRCHITMH",0),RTX="A" Q
"RTN","PRCHRPT1",117,0)
 I TXS'="s"&(TXS'="S") W ! D QUESTION G RDTXS1
"RTN","PRCHRPT1",118,0)
 S ITMNO=$P(ITMY,U,1) G EN^PRCHRPTX
"RTN","PRCHRPT1",119,0)
 Q
"RTN","PRCHRPT1",120,0)
 ;
"RTN","PRCHRPT1",121,0)
QUESTION ;
"RTN","PRCHRPT1",122,0)
 W !!,"Enter 1-9999 or 'S' to sort by PO Date, FCP, etc."
"RTN","PRCHRPT1",123,0)
 Q
"RTN","PRCHRPT1",124,0)
 ;
"RTN","PRCHRPT1",125,0)
WARN ;
"RTN","PRCHRPT1",126,0)
 W @IOF,!?10,"List Transaction History for Specified Item",!!
"RTN","PRCHRPT1",127,0)
 W !,"You may obtain either a listing of a specified number of back transactions",!,"for the item or all transactions (by FCP) within a specified date range."
"RTN","PRCHRPT1",128,0)
 W !!,"Please be aware that the latter involves complex sorting and may",!,"take awhile to complete.  Therefore, it is suggested that it be queued to",!,"a printer to immediately free your workstation.",!
"RTN","PRCHRPT1",129,0)
 Q
"VER")
8.0^22.0
"BLD",5016,6)
^88
**END**
**END**
