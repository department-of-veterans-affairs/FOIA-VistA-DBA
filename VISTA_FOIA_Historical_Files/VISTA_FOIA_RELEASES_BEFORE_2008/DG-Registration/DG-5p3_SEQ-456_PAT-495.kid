Released DG*5.3*495 SEQ #456
Extracted from mail message
**KIDS**:DG*5.3*495^

**INSTALL NAME**
DG*5.3*495
"BLD",4465,0)
DG*5.3*495^REGISTRATION^0^3030708^y
"BLD",4465,1,0)
^^3^3^3030306^
"BLD",4465,1,1,0)
PATCH:    DG*5.3*495
"BLD",4465,1,2,0)
 
"BLD",4465,1,3,0)
SUBJECT:  FIX MT NO LONGER REQUIRED ISSUE
"BLD",4465,4,0)
^9.64PA^^0
"BLD",4465,"KRN",0)
^9.67PA^8989.52^19
"BLD",4465,"KRN",.4,0)
.4
"BLD",4465,"KRN",.401,0)
.401
"BLD",4465,"KRN",.402,0)
.402
"BLD",4465,"KRN",.403,0)
.403
"BLD",4465,"KRN",.5,0)
.5
"BLD",4465,"KRN",.84,0)
.84
"BLD",4465,"KRN",3.6,0)
3.6
"BLD",4465,"KRN",3.8,0)
3.8
"BLD",4465,"KRN",9.2,0)
9.2
"BLD",4465,"KRN",9.8,0)
9.8
"BLD",4465,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4465,"KRN",9.8,"NM",1,0)
DGMTCOR^^0^B27095680
"BLD",4465,"KRN",9.8,"NM",2,0)
DGMTR^^0^B51774740
"BLD",4465,"KRN",9.8,"NM","B","DGMTCOR",1)

"BLD",4465,"KRN",9.8,"NM","B","DGMTR",2)

"BLD",4465,"KRN",19,0)
19
"BLD",4465,"KRN",19.1,0)
19.1
"BLD",4465,"KRN",101,0)
101
"BLD",4465,"KRN",409.61,0)
409.61
"BLD",4465,"KRN",771,0)
771
"BLD",4465,"KRN",870,0)
870
"BLD",4465,"KRN",8989.51,0)
8989.51
"BLD",4465,"KRN",8989.52,0)
8989.52
"BLD",4465,"KRN",8994,0)
8994
"BLD",4465,"KRN","B",.4,.4)

"BLD",4465,"KRN","B",.401,.401)

"BLD",4465,"KRN","B",.402,.402)

"BLD",4465,"KRN","B",.403,.403)

"BLD",4465,"KRN","B",.5,.5)

"BLD",4465,"KRN","B",.84,.84)

"BLD",4465,"KRN","B",3.6,3.6)

"BLD",4465,"KRN","B",3.8,3.8)

"BLD",4465,"KRN","B",9.2,9.2)

"BLD",4465,"KRN","B",9.8,9.8)

"BLD",4465,"KRN","B",19,19)

"BLD",4465,"KRN","B",19.1,19.1)

"BLD",4465,"KRN","B",101,101)

"BLD",4465,"KRN","B",409.61,409.61)

"BLD",4465,"KRN","B",771,771)

"BLD",4465,"KRN","B",870,870)

"BLD",4465,"KRN","B",8989.51,8989.51)

"BLD",4465,"KRN","B",8989.52,8989.52)

"BLD",4465,"KRN","B",8994,8994)

"BLD",4465,"QUES",0)
^9.62^^
"BLD",4465,"REQB",0)
^9.611^1^1
"BLD",4465,"REQB",1,0)
DG*5.3*456^2
"BLD",4465,"REQB","B","DG*5.3*456",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
495^3030708
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3030708
"PKG",5,22,1,"PAH",1,1,1,0)
PATCH:    DG*5.3*495
"PKG",5,22,1,"PAH",1,1,2,0)
 
"PKG",5,22,1,"PAH",1,1,3,0)
SUBJECT:  FIX MT NO LONGER REQUIRED ISSUE
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DGMTCOR")
0^1^B27095680
"RTN","DGMTCOR",1,0)
DGMTCOR ;ALB/CAW,SCG - Check Copay Test Requirements ; 03/03/03 8:15am
"RTN","DGMTCOR",2,0)
 ;;5.3;Registration;**21,45,182,290,305,330,344,495**;Aug 13, 1993
"RTN","DGMTCOR",3,0)
 ;
"RTN","DGMTCOR",4,0)
 ;A patient may apply for a copay test under the following conditions:
"RTN","DGMTCOR",5,0)
 ;  - Applicant is a veteran
"RTN","DGMTCOR",6,0)
 ;  - Applicant's primary or other eligibility does NOT contain
"RTN","DGMTCOR",7,0)
 ;    - Service Connected 50% to 100% or
"RTN","DGMTCOR",8,0)
 ;    - Aid and Attendance or
"RTN","DGMTCOR",9,0)
 ;    - Housebound or
"RTN","DGMTCOR",10,0)
 ;    - VA Pension
"RTN","DGMTCOR",11,0)
 ;  - Primary Eligibility is NSC
"RTN","DGMTCOR",12,0)
 ;    - who has NOT been means tested
"RTN","DGMTCOR",13,0)
 ;    - who claims exposure to agent orange or ionizing radiation
"RTN","DGMTCOR",14,0)
 ;    - who is eligible for medicaid
"RTN","DGMTCOR",15,0)
 ;  - Applicants who have answered 'no' to Receiving A&A, HB, or Pension
"RTN","DGMTCOR",16,0)
 ;  - Applicants who have previously qualified and applied for a copay 
"RTN","DGMTCOR",17,0)
 ;      exemption, still qualify and have NOT been copay tested in the
"RTN","DGMTCOR",18,0)
 ;      past year
"RTN","DGMTCOR",19,0)
 ;  - Applicants who are not currently a DOM patient or inpatient
"RTN","DGMTCOR",20,0)
 ;      (they are temporarily exempt from copay testing) DG*5.3*290
"RTN","DGMTCOR",21,0)
 ;
"RTN","DGMTCOR",22,0)
 ; Input  -- DFN     Patient IEN
"RTN","DGMTCOR",23,0)
 ;           DGADDF  Means Test Add Flag (optional)
"RTN","DGMTCOR",24,0)
 ; Output -- DGMTCOR  Copay Test Flag
"RTN","DGMTCOR",25,0)
 ;                   (1 if eligible and 0 if not eligible)
"RTN","DGMTCOR",26,0)
 ;
"RTN","DGMTCOR",27,0)
 ;
"RTN","DGMTCOR",28,0)
EN ;
"RTN","DGMTCOR",29,0)
 Q:$G(VAFCA08)=1
"RTN","DGMTCOR",30,0)
 N DGMTI,DGMTYPT,DGMDOD
"RTN","DGMTCOR",31,0)
 D ON^DGMTCOU G:'Y ENQ
"RTN","DGMTCOR",32,0)
 S DGRGAUTO=1 ;possible change in cp status w/o call to cp event driver
"RTN","DGMTCOR",33,0)
 D CHK
"RTN","DGMTCOR",34,0)
 ;
"RTN","DGMTCOR",35,0)
 Q:($G(DGWRT)=8)!($G(DGWRT)=9)   ;brm;quit if inpatient or dom;DG*5.3*290
"RTN","DGMTCOR",36,0)
 S IVMZ10F=+$G(IVMZ10F)
"RTN","DGMTCOR",37,0)
 I 'DGMTCOR,'$G(DGADDF),'$G(DGMDOD),'IVMZ10F D NLA
"RTN","DGMTCOR",38,0)
 I DGMTCOR,'$G(DGADDF),'$G(DGMDOD) D INC
"RTN","DGMTCOR",39,0)
 I DGRGAUTO&'$G(DGADDF) D QREGAUTO ;if cp event driver not fired off & NOT a new means test
"RTN","DGMTCOR",40,0)
 ;
"RTN","DGMTCOR",41,0)
ENQ Q
"RTN","DGMTCOR",42,0)
 ;
"RTN","DGMTCOR",43,0)
CHK N STATUS,ELIG,ELIGIEN,DGNODE,DGMDOD,DGMTDT
"RTN","DGMTCOR",44,0)
 S DGMTCOR=1,DGMT="",DGMTYPT=2
"RTN","DGMTCOR",45,0)
 I $P($G(^DPT(DFN,"VET")),U,1)'="Y" S DGMTCOR=0,DGWRT=1 G CHKQ ;NON-VET
"RTN","DGMTCOR",46,0)
 ;Added with DG*5.3*344
"RTN","DGMTCOR",47,0)
 S DGMTI="",DGMTI=+$$LST^DGMTU(DFN)
"RTN","DGMTCOR",48,0)
 S:DGMTI DGMTDT=$P($G(^DGMT(408.31,DGMTI,0)),U)
"RTN","DGMTCOR",49,0)
 S DGMDOD=$P($G(^DPT(DFN,.35)),U)
"RTN","DGMTCOR",50,0)
 I 'DGMTI,$G(DGMDOD) S DGMTCOR=0 Q
"RTN","DGMTCOR",51,0)
 I DGMDOD,(DGMTCOR),(DGMTDT>(DGMDOD-1)) S DGMTCOR=0 G CHKQ
"RTN","DGMTCOR",52,0)
 ;
"RTN","DGMTCOR",53,0)
 S DGMTI=0 I '$P($G(^DPT(DFN,.36)),U) S DGMTCOR=0,DGWRT=2 G CHKQ
"RTN","DGMTCOR",54,0)
 I +$G(DGMDOD) S DGNOCOPF=1
"RTN","DGMTCOR",55,0)
 ;
"RTN","DGMTCOR",56,0)
 ;This doesn't work! The "AEL" x-ref not there when changing the primary
"RTN","DGMTCOR",57,0)
 ;eligibility! Problem with order that the cross-references are called
"RTN","DGMTCOR",58,0)
 ;in, DGMTR is called before the "AEL" x-ref is set!
"RTN","DGMTCOR",59,0)
 ;F  S DGMTI=$O(^DPT("AEL",DFN,DGMTI)) Q:'DGMTI  S DGMTE=$P($G(^DIC(8,DGMTI,0)),U,9) I "^1^2^4^15^"[("^"_DGMTE_"^") S DGMTCOR=0,DGWRT=3 G CHKQ
"RTN","DGMTCOR",60,0)
 ;
"RTN","DGMTCOR",61,0)
 ;
"RTN","DGMTCOR",62,0)
 S ELIG=$P($G(^DPT(DFN,.36)),"^") I ELIG S DGMTE=$P($G(^DIC(8,ELIG,0)),U,9) I "^1^2^4^15^"[("^"_DGMTE_"^") S DGMTCOR=0,DGWRT=3 G CHKQ
"RTN","DGMTCOR",63,0)
 S ELIGIEN=0 F  S ELIGIEN=$O(^DPT(DFN,"E",ELIGIEN)) Q:'ELIGIEN  S ELIG=$P($G(^DPT(DFN,"E",ELIGIEN,0)),"^") I ELIG  S DGMTE=$P($G(^DIC(8,ELIG,0)),U,9) I "^1^2^4^15^"[("^"_DGMTE_"^") S DGMTCOR=0,DGWRT=3 G CHKQ
"RTN","DGMTCOR",64,0)
 S DGNODE=$$LST^DGMTU(DFN),DGMTI=+DGNODE
"RTN","DGMTCOR",65,0)
 ;brm added next 3 lines for DG*5.3*290
"RTN","DGMTCOR",66,0)
 N DGDOM,DGDOM1,VAHOW,VAROOT,VAINDT,VAIP,VAERR,NOW
"RTN","DGMTCOR",67,0)
 D DOM^DGMTR I $G(DGDOM) S DGMTCOR=0,DGRGAUTO=0,DGWRT=8 Q        ;DOM
"RTN","DGMTCOR",68,0)
 D IN5^VADPT I $G(VAIP(1))'="" S DGMTCOR=0,DGRGAUTO=0,DGWRT=9 Q  ;INP
"RTN","DGMTCOR",69,0)
 I DGMTI,'$$OLD^DGMTU4($P(DGNODE,"^",2)) S STATUS=$P($G(^DGMT(408.31,+DGMTI,0)),U,3) I STATUS'="3" S DGMTCOR=0,DGWRT=4 G CHKQ
"RTN","DGMTCOR",70,0)
 S DGNODE=$G(^DPT(DFN,.362))
"RTN","DGMTCOR",71,0)
 I DGMTCOR,$P(DGNODE,U,12)["Y" S DGMTCOR=0,DGWRT=5 G CHKQ ;A&A
"RTN","DGMTCOR",72,0)
 I DGMTCOR,$P(DGNODE,U,13)["Y" S DGMTCOR=0,DGWRT=6 G CHKQ ;HB
"RTN","DGMTCOR",73,0)
 I DGMTCOR,$P(DGNODE,U,14)["Y" S DGMTCOR=0,DGWRT=7 G CHKQ ;PENSION
"RTN","DGMTCOR",74,0)
CHKQ Q
"RTN","DGMTCOR",75,0)
 ;
"RTN","DGMTCOR",76,0)
NLA ; Change Status to NO LONGER APPLICABLE - if appropriate
"RTN","DGMTCOR",77,0)
 ;
"RTN","DGMTCOR",78,0)
 N DGCS,DGMTI,DGMT0,DGINI,DGINR,DGVAL,DGFL,DGFLD,DGIEN,DGMTACT,TDATE
"RTN","DGMTCOR",79,0)
 S DGMTI=+$$LST^DGMTU(DFN,"",2) Q:'DGMTI!($P($G(^DGMT(408.31,DGMTI,0)),U,3)=10)
"RTN","DGMTCOR",80,0)
 S DGMT0=$G(^DGMT(408.31,DGMTI,0)) Q:'DGMT0
"RTN","DGMTCOR",81,0)
 S DGCS=$P(DGMT0,U,3)
"RTN","DGMTCOR",82,0)
 S TDATE=+DGMT0
"RTN","DGMTCOR",83,0)
 S DGMTACT="STA" D PRIOR^DGMTEVT
"RTN","DGMTCOR",84,0)
 ;
"RTN","DGMTCOR",85,0)
 D SAVESTAT^DGMTU4(DGMTI)
"RTN","DGMTCOR",86,0)
 ;
"RTN","DGMTCOR",87,0)
 S DGFL=408.31,DGIEN=DGMTI
"RTN","DGMTCOR",88,0)
 S DGFLD=.03 I DGCS]"" S DGVAL=DGCS D KILL^DGMTR
"RTN","DGMTCOR",89,0)
 S DGVAL=10,$P(^DGMT(408.31,DGMTI,0),"^",3)=DGVAL D SET^DGMTR
"RTN","DGMTCOR",90,0)
 S DGFLD=.17,DGVAL=DT,$P(^DGMT(408.31,DGMTI,0),"^",17)=DT D SET^DGMTR
"RTN","DGMTCOR",91,0)
 W:'$G(DGMTMSG)&'$D(ZTQUEUED) !,"COPAY TEST NO LONGER APPLICABLE"
"RTN","DGMTCOR",92,0)
 D GETINCOM^DGMTU4(DFN,TDATE)
"RTN","DGMTCOR",93,0)
 S DGMTYPT=2 D QUE^DGMTR
"RTN","DGMTCOR",94,0)
 S DGRGAUTO=0
"RTN","DGMTCOR",95,0)
NLAQ Q
"RTN","DGMTCOR",96,0)
 ;
"RTN","DGMTCOR",97,0)
INC ;Update copay status to 'INCOMPLETE' if applicable OR restore completed test
"RTN","DGMTCOR",98,0)
 N DGMTACT,DGMTI,DGFL,DGFLD,DGIEN,DGMTP,DGVAL,DGMT0,AUTOCOMP,ERROR
"RTN","DGMTCOR",99,0)
 S AUTOCOMP=0
"RTN","DGMTCOR",100,0)
 S DGMTI=+$$LST^DGMTU(DFN,"",2)
"RTN","DGMTCOR",101,0)
 D
"RTN","DGMTCOR",102,0)
 .Q:'DGMTI
"RTN","DGMTCOR",103,0)
 .I ($P($G(^DGMT(408.31,DGMTI,0)),U,3)'=10) S AUTOCOMP=1 Q
"RTN","DGMTCOR",104,0)
 .S DGMT0=$G(^DGMT(408.31,DGMTI,0)),DGCS=$P(DGMT0,U,3)
"RTN","DGMTCOR",105,0)
 .Q:'DGMT0
"RTN","DGMTCOR",106,0)
 .S DGMTACT="STA" D PRIOR^DGMTEVT
"RTN","DGMTCOR",107,0)
 .S AUTOCOMP=$$AUTOCOMP^DGMTR(DGMTI)
"RTN","DGMTCOR",108,0)
 .W:'AUTOCOMP&'$G(DGMTMSG)&'$D(ZTQUEUED) !,"COPAY EXEMPTION TEST UPDATED TO INCOMPLETE"
"RTN","DGMTCOR",109,0)
 .W:AUTOCOMP&'$G(DGMTMSG)&'$D(ZTQUEUED) !,"COPAY EXEMPTION TEST UPDATED TO ",$$GETNAME^DGMTH($P($G(^DGMT(408.31,DGMTI,0)),"^",3))
"RTN","DGMTCOR",110,0)
 .S DGMTYPT=2 D QUE^DGMTR
"RTN","DGMTCOR",111,0)
 .S DGRGAUTO=0
"RTN","DGMTCOR",112,0)
 ;
"RTN","DGMTCOR",113,0)
 I $G(IVMZ10)'="UPLOAD IN PROGRESS",$G(DGQSENT)'=1,'AUTOCOMP,'$$OPEN^IVMCQ2(DFN),'$$SENT^IVMCQ2(DFN) D QRYQUE2^IVMCQ2(DFN,$G(DUZ),0,$G(XQY)) S DGQSENT=1 I '$D(ZTQUEUED),'$G(DGMSGF) W !!,"Financial query queued to be sent to HEC..."
"RTN","DGMTCOR",114,0)
 ;
"RTN","DGMTCOR",115,0)
INCQ Q
"RTN","DGMTCOR",116,0)
 ;
"RTN","DGMTCOR",117,0)
QREGAUTO ;Queues off test done by IB recalculating CP status
"RTN","DGMTCOR",118,0)
 ;  Input: DFN
"RTN","DGMTCOR",119,0)
 ;  Action: Possible update of Copay Status
"RTN","DGMTCOR",120,0)
 ;
"RTN","DGMTCOR",121,0)
 Q:'$D(^IBA(354.1,"APIDT",DFN,1))  ;No action if no status on file
"RTN","DGMTCOR",122,0)
 S ZTDESC="CHECK PATIENT FILE CHANGES VS CP STATUS",ZTDTH=$H,ZTRTN="REGAUTO^IBARXEU5",ZTSAVE("DFN")="",ZTIO=""
"RTN","DGMTCOR",123,0)
 D ^%ZTLOAD
"RTN","DGMTCOR",124,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","DGMTCOR",125,0)
 Q
"RTN","DGMTR")
0^2^B51774740
"RTN","DGMTR",1,0)
DGMTR ;ALB/RMO,CAW,SCG,AEG,SCG,AEG,LBD - Check Means Test Requirements ; 03/03/03
"RTN","DGMTR",2,0)
 ;;5.3;Registration;**45,93,114,137,141,147,177,182,146,305,326,314,344,402,426,456,495**;Aug 13, 1993
"RTN","DGMTR",3,0)
 ;A patient requires a means test under the following conditions:
"RTN","DGMTR",4,0)
 ;  - Primary Eligibility is NSC OR patient is SC 0% non-compensable
"RTN","DGMTR",5,0)
 ;  - who is NOT receiving disability retirement from the military
"RTN","DGMTR",6,0)
 ;  - who is NOT eligible for medicaid
"RTN","DGMTR",7,0)
 ;  - who is NOT on a DOM ward
"RTN","DGMTR",8,0)
 ;  - who has NOT been means tested in the past year
"RTN","DGMTR",9,0)
 ;  - who is NOT a Purple Heart recipient
"RTN","DGMTR",10,0)
 ; Input  -- DFN     Patient IEN
"RTN","DGMTR",11,0)
 ;           DGADDF  Means Test Add Flag  (Optional- default none)
"RTN","DGMTR",12,0)
 ;                   (1 if using the 'Add a New Means Test' option)
"RTN","DGMTR",13,0)
 ;           DGMSGF  Means Test Msg Flag  (Optional- default none)
"RTN","DGMTR",14,0)
 ;                   (1 to suppress messages)
"RTN","DGMTR",15,0)
 ; Output -- DGREQF  Means Test Require Flag
"RTN","DGMTR",16,0)
 ;                   (1 if required and 0 if not required)
"RTN","DGMTR",17,0)
 ;           DGDOM1  DOM Patient Flag (defined and set to 1 if
"RTN","DGMTR",18,0)
 ;                               patient currently on a DOM ward)
"RTN","DGMTR",19,0)
 ;           DGNOCOPF = 1 to suppress copay test prompt 0 otherwise
"RTN","DGMTR",20,0)
 ;                      used in CP^DG10.  Killed there as well.
"RTN","DGMTR",21,0)
 ;           If NOT using the 'Add a New Means Test' option,
"RTN","DGMTR",22,0)
 ;           a REQUIRED date of test will be added for the
"RTN","DGMTR",23,0)
 ;           patient if it is required.
"RTN","DGMTR",24,0)
 ;           If a means test is required and the current
"RTN","DGMTR",25,0)
 ;           status is NO LONGER REQUIRED, the last date of
"RTN","DGMTR",26,0)
 ;           test and current means test status will be
"RTN","DGMTR",27,0)
 ;           updated to REQUIRED.
"RTN","DGMTR",28,0)
 ;           If a means test is no longer required the
"RTN","DGMTR",29,0)
 ;           last date of test and the current means test
"RTN","DGMTR",30,0)
 ;           status will also be updated to NO LONGER REQUIRED.
"RTN","DGMTR",31,0)
EN N DGCS,DGDOM,DGMT0,DGMTI,DGMTYPT,OLD,DGRGAUTO,DGQSENT,DGMTLTD,DGMDOD,DGMTDT
"RTN","DGMTR",32,0)
 ;DG*5.3*146 change to exit if during patient merge process
"RTN","DGMTR",33,0)
 Q:$G(VAFCA08)=1
"RTN","DGMTR",34,0)
 ;DGMTCOR is needed if uploading copay test
"RTN","DGMTR",35,0)
 I $G(RXPRIME)'="DGMTU4" N DGMTCOR
"RTN","DGMTR",36,0)
 S (DGQSENT,DGREQF)=0,(OLD,DGMTYPT)=1
"RTN","DGMTR",37,0)
 I $D(^DPT(DFN,.36)) S X=^(.36) D
"RTN","DGMTR",38,0)
 . I $P($G(^DIC(8,+X,0)),"^",9)=5!($$SC(DFN)) S DGREQF=1
"RTN","DGMTR",39,0)
 . I $P(X,"^",2),$P(X,"^",2)<3 S DGREQF=0
"RTN","DGMTR",40,0)
 S (DGMTI,DGMT0)="",DGMTI=+$$LST^DGMTU(DFN)
"RTN","DGMTR",41,0)
 S:DGMTI DGMT0=$G(^DGMT(408.31,DGMTI,0))
"RTN","DGMTR",42,0)
 ;Added with DG*5.3*344
"RTN","DGMTR",43,0)
 S:DGMTI DGMTDT=$P(DGMT0,U)
"RTN","DGMTR",44,0)
 S DGMDOD=$P($G(^DPT(DFN,.35)),U)
"RTN","DGMTR",45,0)
 I 'DGMTI,$G(DGMDOD) D EN^DGMTCOR S DGREQF=0 Q
"RTN","DGMTR",46,0)
 I DGREQF S:$G(^DPT(DFN,.38)) DGREQF=0
"RTN","DGMTR",47,0)
 I DGREQF D DOM S:$G(DGDOM) DGREQF=0
"RTN","DGMTR",48,0)
 S DGCS=$P(DGMT0,"^",3)
"RTN","DGMTR",49,0)
 S DGMTLTD=+DGMT0,DGNOCOPF=0
"RTN","DGMTR",50,0)
 I +$G(DGMDOD) S DGNOCOPF=1
"RTN","DGMTR",51,0)
 I DGCS S OLD=$$OLD^DGMTU4(+DGMT0)
"RTN","DGMTR",52,0)
 ;Purple Heart Recipient ;brm 10/02/00 added 1 line below
"RTN","DGMTR",53,0)
 I $P($G(^DPT(DFN,.53)),U)="Y" S DGREQF=0
"RTN","DGMTR",54,0)
 D
"RTN","DGMTR",55,0)
 .I DGREQF,DGCS=3,'OLD D REQ Q
"RTN","DGMTR",56,0)
 .I DGREQF,'$G(DGADDF),((DGCS=6)!(DGCS=2)),$P(DGMT0,U,11)=1,DGMTLTD>2991005 S DGREQF=0,DGNOCOPF=1 Q
"RTN","DGMTR",57,0)
 .; next line added 2/19/02 - DG*5.3*426
"RTN","DGMTR",58,0)
 .I DGREQF,'$G(DGADDF),$G(DGCS)=6,+$P(DGMT0,U,14),+$P(DGMT0,U,11) S DGREQF=0,DGNOCOPF=1 Q
"RTN","DGMTR",59,0)
 .I DGREQF,'$G(DGADDF),(('DGCS)!(OLD)),'$G(DGMDOD) D ADD Q
"RTN","DGMTR",60,0)
 .I 'DGREQF,DGCS,DGCS'=3,'$G(DGDOM),'$G(DGMDOD),'+$G(IVMZ10F) D NOL Q
"RTN","DGMTR",61,0)
 ;be sure to check whether or not patient is subject to RX copay!
"RTN","DGMTR",62,0)
 D EN^DGMTCOR
"RTN","DGMTR",63,0)
 Q
"RTN","DGMTR",64,0)
 ;Check if patient is in a DOM
"RTN","DGMTR",65,0)
 ;  call to DOM checks if patient currently on a DOM ward
"RTN","DGMTR",66,0)
 ;                                     (called from EN)
"RTN","DGMTR",67,0)
 ;  call to DOM1 checks if patient on a DOM ward for a specific date
"RTN","DGMTR",68,0)
 ;    before call to DOM1 - N VAINDT,VADMVT,DGDOM,DGDOM1
"RTN","DGMTR",69,0)
 ;                          S VAINDT=specific date
"RTN","DGMTR",70,0)
 ;                          S DFN=Patient IEN
"RTN","DGMTR",71,0)
 ;                 output - DGDOM & DGDOM1 (defined and set to 1 if
"RTN","DGMTR",72,0)
 ;                          patient on a DOM ward for specific date)
"RTN","DGMTR",73,0)
DOM N VAINDT,VADMVT
"RTN","DGMTR",74,0)
DOM1 D ADM^VADPT2
"RTN","DGMTR",75,0)
 I VADMVT,$P($G(^DG(43,1,0)),"^",21),$D(^DIC(42,+$P($G(^DGPM(VADMVT,0)),"^",6),0)),$P(^(0),"^",3)="D" S (DGDOM,DGDOM1)=1
"RTN","DGMTR",76,0)
 Q
"RTN","DGMTR",77,0)
SC(DFN) ;Check if patient is SC 0% non-compensable
"RTN","DGMTR",78,0)
 ; Input  -- DFN     Patient IEN
"RTN","DGMTR",79,0)
 ; Output -- 1=Yes and 0=No
"RTN","DGMTR",80,0)
 ;     No if:
"RTN","DGMTR",81,0)
 ;        No total annual VA check amount
"RTN","DGMTR",82,0)
 ;        POW STATUS INDICATOR is yes
"RTN","DGMTR",83,0)
 ;        Secondary Eligibility is one of the following:
"RTN","DGMTR",84,0)
 ;           A&A, NSC, VA PENSION
"RTN","DGMTR",85,0)
 ;           HOUSEBOUND, MEXICAN BORDER WAR, WWI, POW
"RTN","DGMTR",86,0)
 N DG,DGE,DGF,Y
"RTN","DGMTR",87,0)
 S Y=0
"RTN","DGMTR",88,0)
 ;Primary eligibility is SC LESS THAN 50%
"RTN","DGMTR",89,0)
 I $D(^DPT(DFN,.36)),$P($G(^DIC(8,+^(.36),0)),"^",9)=3 S Y=1
"RTN","DGMTR",90,0)
 G:'Y SCQ
"RTN","DGMTR",91,0)
 ;Service connected percentage is 0
"RTN","DGMTR",92,0)
 I $P($G(^DPT(DFN,.3)),"^",2)'=0 S Y=0 G SCQ
"RTN","DGMTR",93,0)
 ;No Total annual VA check amount
"RTN","DGMTR",94,0)
 I $P($G(^DPT(DFN,.362)),"^",20) S Y=0 G SCQ
"RTN","DGMTR",95,0)
 ;POW STATUS INDICATOR
"RTN","DGMTR",96,0)
 I $P($G(^DPT(DFN,.52)),"^",5)="Y" S Y=0 G SCQ
"RTN","DGMTR",97,0)
 ;Purple Heart Indicator
"RTN","DGMTR",98,0)
 I $P($G(^DPT(DFN,.53)),"^")="Y" S Y=0 G SCQ
"RTN","DGMTR",99,0)
 ;Secondary Eligibility
"RTN","DGMTR",100,0)
 F DG=2,4,15:1:18 S DGE(DG)=""
"RTN","DGMTR",101,0)
 S DG=0 F  S DG=$O(^DPT(DFN,"E","B",DG)) Q:'DG  D SELIG I DGF,$D(DGE(+DGF)) S Y=0 Q
"RTN","DGMTR",102,0)
SCQ Q +$G(Y)
"RTN","DGMTR",103,0)
ADD ;Add a required means test
"RTN","DGMTR",104,0)
 N DGMTA,DGMTACT,DGMTDT,DGMTI,DGMTP,ERROR
"RTN","DGMTR",105,0)
 W:'$G(DGMSGF) !,"MEANS TEST REQUIRED"
"RTN","DGMTR",106,0)
 S DGMTACT="ADD" D PRIOR^DGMTEVT
"RTN","DGMTR",107,0)
 S DGMTDT=DT D ADD^DGMTA
"RTN","DGMTR",108,0)
 I DGMTI>0 S DGMTYPT=1 D
"RTN","DGMTR",109,0)
 .N DATA S DATA(.03)=$$GETSTAT^DGMTH("R",1) I $$UPD^DGENDBS(408.31,DGMTI,.DATA)
"RTN","DGMTR",110,0)
 .D GETINCOM^DGMTU4(DFN,DT)
"RTN","DGMTR",111,0)
 .D QUE
"RTN","DGMTR",112,0)
 I $G(IVMZ10)'="UPLOAD IN PROGRESS",'$$OPEN^IVMCQ2(DFN),'$$SENT^IVMCQ2(DFN) D QRYQUE2^IVMCQ2(DFN,$G(DUZ),0,$G(XQY)) S DGQSENT=1 I '$D(ZTQUEUED),'$G(DGMSGF) W !!,"Financial query queued to be sent to HEC..."
"RTN","DGMTR",113,0)
 Q
"RTN","DGMTR",114,0)
REQ ;Update means test status to REQUIRED
"RTN","DGMTR",115,0)
 N DGMTA,AUTOCOMP,DGMTE,ERROR
"RTN","DGMTR",116,0)
 ;may have set prior MT for means test upload
"RTN","DGMTR",117,0)
 I $G(MTPRIME)'="DGMTU4" N DGMTP,DGMTACT S DGMTACT="STA" D PRIOR^DGMTEVT
"RTN","DGMTR",118,0)
 S AUTOCOMP=$$AUTOCOMP(DGMTI)
"RTN","DGMTR",119,0)
 ;if a test were auto-completed, don't want another being added inadvertently
"RTN","DGMTR",120,0)
 I AUTOCOMP,$G(DGADDF) S DGADDF=0
"RTN","DGMTR",121,0)
 I AUTOCOMP S DGCS=$P($G(^DGMT(408.31,DGMTI,0)),"^",3)
"RTN","DGMTR",122,0)
 I $G(IVMZ10)'="UPLOAD IN PROGRESS",'AUTOCOMP,'$$OPEN^IVMCQ2(DFN),'$$SENT^IVMCQ2(DFN) D QRYQUE2^IVMCQ2(DFN,$G(DUZ),0,$G(XQY)) S DGQSENT=1 I '$D(ZTQUEUED),'$G(DGMSGF) W !!,"Financial query queued to be sent to HEC..."
"RTN","DGMTR",123,0)
 I ('AUTOCOMP),('$G(DGMSGF)) W !,"MEANS TEST REQUIRED"
"RTN","DGMTR",124,0)
 I (AUTOCOMP),('$G(DGMSGF)) W !,"CURRENT MEANS TEST STATUS IS ",$$GETNAME^DGMTH(DGCS)
"RTN","DGMTR",125,0)
 S DGMTYPT=1
"RTN","DGMTR",126,0)
 D QUE
"RTN","DGMTR",127,0)
 Q
"RTN","DGMTR",128,0)
AUTOCOMP(DGMTI) ;
"RTN","DGMTR",129,0)
 ;Will either automatically complete the test (RX copay or means test) 
"RTN","DGMTR",130,0)
 ;based on the Test Determined Status, or will change the status to
"RTN","DGMTR",131,0)
 ;Required for means tests or Incomplete for Rx copay tests
"RTN","DGMTR",132,0)
 ;Input:
"RTN","DGMTR",133,0)
 ;  DGMTI - the ien of the test
"RTN","DGMTR",134,0)
 ;Output:
"RTN","DGMTR",135,0)
 ;  Function value - 1 if the test was completed, 0 otherwise
"RTN","DGMTR",136,0)
 N NODE0,NODE2,DATA,RET,LINKIEN,DGINR,DGINI,ERROR,CODE,TYPE,DFN,TDATE
"RTN","DGMTR",137,0)
 S RET=0
"RTN","DGMTR",138,0)
 Q:'$G(DGMTI) RET
"RTN","DGMTR",139,0)
 S NODE0=$G(^DGMT(408.31,DGMTI,0))
"RTN","DGMTR",140,0)
 Q:(NODE0="") RET
"RTN","DGMTR",141,0)
 S TYPE=$P(NODE0,"^",19)
"RTN","DGMTR",142,0)
 S DFN=$P(NODE0,"^",2)
"RTN","DGMTR",143,0)
 S TDATE=+NODE0
"RTN","DGMTR",144,0)
 S NODE2=$G(^DGMT(408.31,DGMTI,2))
"RTN","DGMTR",145,0)
 ;get test-determined status code
"RTN","DGMTR",146,0)
 S CODE=$$GETCODE^DGMTH($P(NODE2,"^",3))
"RTN","DGMTR",147,0)
 ;if means test
"RTN","DGMTR",148,0)
 I TYPE=1 D
"RTN","DGMTR",149,0)
 .S DATA(.03)=$$GETSTAT^DGMTH("R",1),DATA(.17)=""
"RTN","DGMTR",150,0)
 .I (CODE'=""),"ACGP"[CODE D
"RTN","DGMTR",151,0)
 ..S RET=1
"RTN","DGMTR",152,0)
 ..S DATA(.03)=$P(NODE2,"^",3)
"RTN","DGMTR",153,0)
 ..;determine status if there is a hardship
"RTN","DGMTR",154,0)
 ..I $P(NODE0,"^",20) D
"RTN","DGMTR",155,0)
 ...S DATA(.03)=$$GETSTAT^DGMTH($S(CODE="P":"P",CODE="C"&($P(NODE0,U,27)>$P(NODE0,U,12)):"G",1:"A"),1)
"RTN","DGMTR",156,0)
 ;RX copay test
"RTN","DGMTR",157,0)
 I TYPE=2 D
"RTN","DGMTR",158,0)
 .S DATA(.03)=$$GETSTAT^DGMTH("I",2),DATA(.17)=""
"RTN","DGMTR",159,0)
 .I (CODE'=""),"EM"[CODE D
"RTN","DGMTR",160,0)
 ..S RET=1
"RTN","DGMTR",161,0)
 ..S DATA(.03)=$P(NODE2,"^",3)
"RTN","DGMTR",162,0)
 I '$$UPD^DGENDBS(408.31,DGMTI,.DATA,.ERROR) W:'$G(DGMSGF) ERROR
"RTN","DGMTR",163,0)
 ;restore the pointers from the Income Relation file (408.22) to this
"RTN","DGMTR",164,0)
 ;test, using the linked test
"RTN","DGMTR",165,0)
 S LINKIEN=$P(NODE2,"^",6)
"RTN","DGMTR",166,0)
 I LINKIEN D
"RTN","DGMTR",167,0)
 .S DGINI=0 F  S DGINI=$O(^DGMT(408.22,"AMT",LINKIEN,DFN,DGINI)) Q:'DGINI  S DGINR=$O(^DGMT(408.22,"AMT",LINKIEN,DFN,DGINI,"")) I $P($G(^DGMT(408.22,+DGINR,"MT")),"^")]"" D
"RTN","DGMTR",168,0)
 ..K DATA
"RTN","DGMTR",169,0)
 ..S DATA(31)=DGMTI
"RTN","DGMTR",170,0)
 ..I $$UPD^DGENDBS(408.22,+DGINR,.DATA)
"RTN","DGMTR",171,0)
 D GETINCOM^DGMTU4(DFN,TDATE)
"RTN","DGMTR",172,0)
 Q RET
"RTN","DGMTR",173,0)
NOL ;Update means test status to NO LONGER REQUIRED
"RTN","DGMTR",174,0)
 N DGMTA,DGINI,DGINR,DGMTDT,DATA
"RTN","DGMTR",175,0)
 W:'$G(DGMSGF) !,"MEANS TEST NO LONGER REQUIRED"
"RTN","DGMTR",176,0)
 ;may have set prior MT for means test upload
"RTN","DGMTR",177,0)
 I $G(MTPRIME)'="DGMTU4" N DGMTP,DGMTACT S DGMTACT="STA" D PRIOR^DGMTEVT
"RTN","DGMTR",178,0)
 ;save the Test Determined Status
"RTN","DGMTR",179,0)
 D SAVESTAT^DGMTU4(DGMTI)
"RTN","DGMTR",180,0)
 S DATA(.03)=3,DATA(.17)=DT I $$UPD^DGENDBS(408.31,DGMTI,.DATA)
"RTN","DGMTR",181,0)
 D QUE
"RTN","DGMTR",182,0)
 ;create a Rx copay test based on MT if needed
"RTN","DGMTR",183,0)
 D COPYRX^DGMTR1(DFN,DGMTI)
"RTN","DGMTR",184,0)
NOLQ Q
"RTN","DGMTR",185,0)
SET ;Set Cross-reference
"RTN","DGMTR",186,0)
 N D0,DA,DIV,DGIX,X
"RTN","DGMTR",187,0)
 S DA=DGIEN,X=DGVAL,DGIX=0
"RTN","DGMTR",188,0)
 F  S DGIX=$O(^DD(DGFL,DGFLD,1,DGIX)) Q:'DGIX  X ^(DGIX,1) S X=DGVAL
"RTN","DGMTR",189,0)
 Q
"RTN","DGMTR",190,0)
KILL ;Kill Cross-reference
"RTN","DGMTR",191,0)
 N D0,DA,DIV,DGIX,X
"RTN","DGMTR",192,0)
 S DA=DGIEN,X=DGVAL,DGIX=0
"RTN","DGMTR",193,0)
 F  S DGIX=$O(^DD(DGFL,DGFLD,1,DGIX)) Q:'DGIX  X ^(DGIX,2) S X=DGVAL
"RTN","DGMTR",194,0)
 Q
"RTN","DGMTR",195,0)
QUE ;Queue means test event driver
"RTN","DGMTR",196,0)
 D AFTER^DGMTEVT
"RTN","DGMTR",197,0)
 S ZTDESC="MEANS TEST EVENT DRIVER",ZTDTH=$H,ZTRTN="EN^DGMTEVT"
"RTN","DGMTR",198,0)
 F I="DFN","DGMTACT","DGMTI","DGMTP","DGMTA","DGMTYPT" S ZTSAVE(I)=""
"RTN","DGMTR",199,0)
 S ZTSAVE("DGMTINF")=1
"RTN","DGMTR",200,0)
 I $D(IVMZ10) S ZTSAVE("IVMZ10")=""
"RTN","DGMTR",201,0)
 I $D(DGENUPLD) S ZTSAVE("DGENUPLD")=""
"RTN","DGMTR",202,0)
 S ZTIO="" D ^%ZTLOAD
"RTN","DGMTR",203,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","DGMTR",204,0)
 Q
"RTN","DGMTR",205,0)
SELIG ;Check if secondary eligibility code missing from ELIGIBILITY CODE
"RTN","DGMTR",206,0)
 ;file (#8) or entry in file #8 not pointing to MAS ELIGIBILITY
"RTN","DGMTR",207,0)
 ;CODE file (#8.1)
"RTN","DGMTR",208,0)
 N DGTXT
"RTN","DGMTR",209,0)
 S DGF=$G(^DIC(8,+DG,0)) I DGF="" D  Q
"RTN","DGMTR",210,0)
 .S DGTXT(4)="Entry with an IEN OF "_DG_" missing from"
"RTN","DGMTR",211,0)
 .S DGTXT(5)="the ELIGIBILITY CODE file (#8)"
"RTN","DGMTR",212,0)
 .D MAIL^DGMTR1
"RTN","DGMTR",213,0)
 .Q
"RTN","DGMTR",214,0)
 S DGF=$P(DGF,"^",9) I DGF=""!('$D(^DIC(8.1,+DGF,0))) D
"RTN","DGMTR",215,0)
 .S DGTXT(4)="ELIGIBILITY CODE file (#8) entry with an IEN OF "_DG_" doesn't"
"RTN","DGMTR",216,0)
 .S DGTXT(5)="have a valid pointer to the MAS ELIGIBILITY CODE file (#8.1)"
"RTN","DGMTR",217,0)
 .D MAIL^DGMTR1
"RTN","DGMTR",218,0)
 .S DGF=""
"RTN","DGMTR",219,0)
 .Q
"RTN","DGMTR",220,0)
 Q
"VER")
8.0^22
**END**
**END**
