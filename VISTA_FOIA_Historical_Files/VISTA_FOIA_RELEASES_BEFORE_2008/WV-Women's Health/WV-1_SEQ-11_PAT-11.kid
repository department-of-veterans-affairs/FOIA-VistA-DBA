Released WV*1*11 SEQ #11
Extracted from mail message
**KIDS**:WV*1.0*11^

**INSTALL NAME**
WV*1.0*11
"BLD",2555,0)
WV*1.0*11^WOMEN'S HEALTH^0^3000710^y
"BLD",2555,1,0)
^^2^2^3000522^^
"BLD",2555,1,1,0)
Please read the WV*1*11 patch description on FORUM for an explanation of
"BLD",2555,1,2,0)
what this patch does.
"BLD",2555,4,0)
^9.64PA^^
"BLD",2555,"ABNS",0)
^9.66A^^
"BLD",2555,"ABPKG")
n^n
"BLD",2555,"INIT")
WV11PST
"BLD",2555,"KRN",0)
^9.67PA^19^17
"BLD",2555,"KRN",.4,0)
.4
"BLD",2555,"KRN",.401,0)
.401
"BLD",2555,"KRN",.402,0)
.402
"BLD",2555,"KRN",.403,0)
.403
"BLD",2555,"KRN",.5,0)
.5
"BLD",2555,"KRN",.84,0)
.84
"BLD",2555,"KRN",3.6,0)
3.6
"BLD",2555,"KRN",3.8,0)
3.8
"BLD",2555,"KRN",9.2,0)
9.2
"BLD",2555,"KRN",9.8,0)
9.8
"BLD",2555,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",2555,"KRN",9.8,"NM",1,0)
WVMST^^0^B35403423
"BLD",2555,"KRN",9.8,"NM",2,0)
WVMST1^^0^B15635993
"BLD",2555,"KRN",9.8,"NM",3,0)
WVMSTL^^0^B13218714
"BLD",2555,"KRN",9.8,"NM",4,0)
WVMSTL1^^0^B6329542
"BLD",2555,"KRN",9.8,"NM",5,0)
WV11PST^^0^B17874387
"BLD",2555,"KRN",9.8,"NM","B","WV11PST",5)

"BLD",2555,"KRN",9.8,"NM","B","WVMST",1)

"BLD",2555,"KRN",9.8,"NM","B","WVMST1",2)

"BLD",2555,"KRN",9.8,"NM","B","WVMSTL",3)

"BLD",2555,"KRN",9.8,"NM","B","WVMSTL1",4)

"BLD",2555,"KRN",19,0)
19
"BLD",2555,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",2555,"KRN",19,"NM",1,0)
WV SEXUAL TRAUMA LIST^^0
"BLD",2555,"KRN",19,"NM",2,0)
WV ADD TO MST^^0
"BLD",2555,"KRN",19,"NM",3,0)
WV SEXUAL TRAUMA SUMMARY^^0
"BLD",2555,"KRN",19,"NM","B","WV ADD TO MST",2)

"BLD",2555,"KRN",19,"NM","B","WV SEXUAL TRAUMA LIST",1)

"BLD",2555,"KRN",19,"NM","B","WV SEXUAL TRAUMA SUMMARY",3)

"BLD",2555,"KRN",19.1,0)
19.1
"BLD",2555,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",2555,"KRN",101,0)
101
"BLD",2555,"KRN",409.61,0)
409.61
"BLD",2555,"KRN",771,0)
771
"BLD",2555,"KRN",870,0)
870
"BLD",2555,"KRN",8994,0)
8994
"BLD",2555,"KRN","B",.4,.4)

"BLD",2555,"KRN","B",.401,.401)

"BLD",2555,"KRN","B",.402,.402)

"BLD",2555,"KRN","B",.403,.403)

"BLD",2555,"KRN","B",.5,.5)

"BLD",2555,"KRN","B",.84,.84)

"BLD",2555,"KRN","B",3.6,3.6)

"BLD",2555,"KRN","B",3.8,3.8)

"BLD",2555,"KRN","B",9.2,9.2)

"BLD",2555,"KRN","B",9.8,9.8)

"BLD",2555,"KRN","B",19,19)

"BLD",2555,"KRN","B",19.1,19.1)

"BLD",2555,"KRN","B",101,101)

"BLD",2555,"KRN","B",409.61,409.61)

"BLD",2555,"KRN","B",771,771)

"BLD",2555,"KRN","B",870,870)

"BLD",2555,"KRN","B",8994,8994)

"BLD",2555,"QUES",0)
^9.62^^
"BLD",2555,"REQB",0)
^9.611^1^1
"BLD",2555,"REQB",1,0)
DG*5.3*195^2
"BLD",2555,"REQB","B","DG*5.3*195",1)

"INIT")
WV11PST
"KRN",19,10421,-1)
0^3
"KRN",19,10421,0)
WV SEXUAL TRAUMA SUMMARY^Sexual Trauma Summary Report (WH only)^^R^^^^^^^^WOMEN'S HEALTH
"KRN",19,10421,1,0)
^19.06^5^5^3000626^^
"KRN",19,10421,1,1,0)
This option provides the user with a short report of the number and 
"KRN",19,10421,1,2,0)
percentages of WH patients who have experienced Sexual Traumas.
"KRN",19,10421,1,3,0)
 
"KRN",19,10421,1,4,0)
Patients who are deceased or have a date entered into the DATE INACTIVE
"KRN",19,10421,1,5,0)
(#.24) field of the WV PATIENT (#790) file are not counted in this report.
"KRN",19,10421,25)
WVRPST
"KRN",19,10421,"U")
SEXUAL TRAUMA SUMMARY REPORT (
"KRN",19,11016,-1)
0^1
"KRN",19,11016,0)
WV SEXUAL TRAUMA LIST^List Sexual Trauma Data^^R^^^^^^^^WOMEN'S HEALTH
"KRN",19,11016,1,0)
^^8^8^3000517^
"KRN",19,11016,1,1,0)
This option displays a list of patients, their Sexual Trauma value from
"KRN",19,11016,1,2,0)
the WH package and the Military Sexual Trauma (MST) value from the MST
"KRN",19,11016,1,3,0)
module of the Registration package. The patient's name, SSN, case manager,
"KRN",19,11016,1,4,0)
age, veteran status and eligibility code are displayed, too.
"KRN",19,11016,1,5,0)
 
"KRN",19,11016,1,6,0)
The user may choose to see the patients for one case manager or all case
"KRN",19,11016,1,7,0)
managers. Patients who are deceased or have an Inactive Date (prior to
"KRN",19,11016,1,8,0)
today's date) will not appear on the listing.
"KRN",19,11016,25)
WVMSTL
"KRN",19,11016,"U")
LIST SEXUAL TRAUMA DATA
"KRN",19,11017,-1)
0^2
"KRN",19,11017,0)
WV ADD TO MST^Add Sexual Trauma Data to MST Module^^R^^^^^^^^WOMEN'S HEALTH
"KRN",19,11017,1,0)
^^29^29^3000710^
"KRN",19,11017,1,1,0)
This option adds WH Sexual Trauma data into the Military Sexual Trauma
"KRN",19,11017,1,2,0)
(MST) module of the Registration package. The MST module tracks data for
"KRN",19,11017,1,3,0)
veterans only. Data for non-veterans is not added to the MST module. WH
"KRN",19,11017,1,4,0)
patients whose Sexual Trauma value is 'Military', 'Civilian', 'Both' or
"KRN",19,11017,1,5,0)
'None' will have that value translated into a MST value and added to the
"KRN",19,11017,1,6,0)
MST module.
"KRN",19,11017,1,7,0)
  WH value      MST value
"KRN",19,11017,1,8,0)
  --------      ---------
"KRN",19,11017,1,9,0)
  Military      Yes
"KRN",19,11017,1,10,0)
  Civilian      No
"KRN",19,11017,1,11,0)
  Both          Yes
"KRN",19,11017,1,12,0)
  None          No
"KRN",19,11017,1,13,0)
 
"KRN",19,11017,1,14,0)
WH patients with no Sexual Trauma value are ignored.
"KRN",19,11017,1,15,0)
 
"KRN",19,11017,1,16,0)
NOTE: If a WH patient is already in the MST module with a value of 'Yes'
"KRN",19,11017,1,17,0)
then no additional MST entry is made. Also, if a WH patient is already in
"KRN",19,11017,1,18,0)
the MST module with a value of 'No' and the WH Sexual Trauma value is
"KRN",19,11017,1,19,0)
'None' or 'Civilian' then no additional MST entry is made.
"KRN",19,11017,1,20,0)
 
"KRN",19,11017,1,21,0)
The provider who determined the value must be stored in the MST module. If
"KRN",19,11017,1,22,0)
the case manager associated with the patient or the user running this
"KRN",19,11017,1,23,0)
option is a provider, then the case manager or the user is identified as
"KRN",19,11017,1,24,0)
the provider who did the screening. If neither is a provider, then that
"KRN",19,11017,1,25,0)
patient's data is not added to the MST module.
"KRN",19,11017,1,26,0)
 
"KRN",19,11017,1,27,0)
This option will display a list of WH patients whose data was added to the
"KRN",19,11017,1,28,0)
MST module. It will also display a list of WH patients whose data could
"KRN",19,11017,1,29,0)
not be added to the MST module.
"KRN",19,11017,25)
WVMST
"KRN",19,11017,"U")
ADD SEXUAL TRAUMA DATA TO MST 
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",364,-1)
1^1
"PKG",364,0)
WOMEN'S HEALTH^WV^Tracks health issues specific to female patients.
"PKG",364,20,0)
^9.402P^^
"PKG",364,22,0)
^9.49I^1^1
"PKG",364,22,1,0)
1.0^2980925^2980508^547
"PKG",364,22,1,"PAH",1,0)
11^3000710
"PKG",364,22,1,"PAH",1,1,0)
^^2^2^3000710
"PKG",364,22,1,"PAH",1,1,1,0)
Please read the WV*1*11 patch description on FORUM for an explanation of
"PKG",364,22,1,"PAH",1,1,2,0)
what this patch does.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","WV11PST")
0^5^B17874387
"RTN","WV11PST",1,0)
WV11PST ;HCIOFO/FT-Patch 11 Post-Installation Routine ;5/18/00  11:39
"RTN","WV11PST",2,0)
 ;;1.0;WOMEN'S HEALTH;**11**;Sep 30, 1998
"RTN","WV11PST",3,0)
 ;
"RTN","WV11PST",4,0)
 ; This routine uses the following IAs:
"RTN","WV11PST",5,0)
 ; #1157 - $$ADD^XPDMENU (supported)
"RTN","WV11PST",6,0)
 ;
"RTN","WV11PST",7,0)
 N WVADD
"RTN","WV11PST",8,0)
 D ADDOPT
"RTN","WV11PST",9,0)
 D QMAIL
"RTN","WV11PST",10,0)
 Q
"RTN","WV11PST",11,0)
ADDOPT ; Add/Update options on menus
"RTN","WV11PST",12,0)
 N WVFLAG,WVMENU,WVOPTION,WVORDER,WVSYN
"RTN","WV11PST",13,0)
 ; Add WV ADD TO MST option to WV MENU-FILE MAINTENANCE menu.
"RTN","WV11PST",14,0)
 S WVMENU="WV MENU-FILE MAINTENANCE"
"RTN","WV11PST",15,0)
 S WVOPTION="WV ADD TO MST",WVSYN="MST",WVORDER=13
"RTN","WV11PST",16,0)
 S WVFLAG=$$ADD^XPDMENU(WVMENU,WVOPTION,WVSYN,WVORDER)
"RTN","WV11PST",17,0)
 ; Enter DISPLAY ORDER for WV ADD/EDIT REFERRAL SOURCE option on
"RTN","WV11PST",18,0)
 ; WV MENU-FILE MAINTENANCE menu.
"RTN","WV11PST",19,0)
 S WVMENU="WV MENU-FILE MAINTENANCE"
"RTN","WV11PST",20,0)
 S WVOPTION="WV ADD/EDIT REFERRAL SOURCE",WVSYN="RS",WVORDER=12
"RTN","WV11PST",21,0)
 S WVFLAG=$$ADD^XPDMENU(WVMENU,WVOPTION,WVSYN,WVORDER)
"RTN","WV11PST",22,0)
 ; Enter DISPLAY ORDER for WV SEXUAL TRAUMA SUMMARY option on
"RTN","WV11PST",23,0)
 ; WV MENU-MANAGEMENT REPORTS menu.
"RTN","WV11PST",24,0)
 S WVMENU="WV MENU-MANAGEMENT REPORTS"
"RTN","WV11PST",25,0)
 S WVOPTION="WV SEXUAL TRAUMA SUMMARY",WVSYN="ST",WVORDER=6
"RTN","WV11PST",26,0)
 S WVFLAG=$$ADD^XPDMENU(WVMENU,WVOPTION,WVSYN,WVORDER)
"RTN","WV11PST",27,0)
 ; Add WV SEXUAL TRAUMA LIST to WV MENU-MANAGEMENT REPORTS menu.
"RTN","WV11PST",28,0)
 S WVMENU="WV MENU-MANAGEMENT REPORTS"
"RTN","WV11PST",29,0)
 S WVOPTION="WV SEXUAL TRAUMA LIST",WVSYN="LST",WVORDER=7
"RTN","WV11PST",30,0)
 S WVFLAG=$$ADD^XPDMENU(WVMENU,WVOPTION,WVSYN,WVORDER)
"RTN","WV11PST",31,0)
 ; Add DGMST ENTER NEW MST option to WV MENU-PATIENT MANAGEMENT menu.
"RTN","WV11PST",32,0)
 S WVMENU="WV MENU-PATIENT MANAGEMENT"
"RTN","WV11PST",33,0)
 S WVOPTION="DGMST ENTER NEW MST",WVSYN="MST",WVORDER=13
"RTN","WV11PST",34,0)
 S WVADD=$$ADD^XPDMENU(WVMENU,WVOPTION,WVSYN,WVORDER)
"RTN","WV11PST",35,0)
 Q
"RTN","WV11PST",36,0)
QMAIL ; Queue mail message
"RTN","WV11PST",37,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WV11PST",38,0)
 S ZTRTN="MAIL^WV11PST",ZTDESC="WV*1*11 INSTALLED"
"RTN","WV11PST",39,0)
 S ZTIO="",ZTDTH=$H,ZTSAVE("WVADD")=""
"RTN","WV11PST",40,0)
 D ^%ZTLOAD
"RTN","WV11PST",41,0)
 Q
"RTN","WV11PST",42,0)
MAIL ; Send message to default case managers to inform them of the changes
"RTN","WV11PST",43,0)
 N XMDUZ,XMSUB,XMTEXT,XMY,WVSITE,WVIEN,WVLINE,WVMSG
"RTN","WV11PST",44,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WV11PST",45,0)
 S (WVLINE,WVSITE)=0
"RTN","WV11PST",46,0)
 F  S WVSITE=$O(^WV(790.02,WVSITE)) Q:'WVSITE  D
"RTN","WV11PST",47,0)
 .S WVIEN=$P($G(^WV(790.02,WVSITE,0)),U,2) ;default case manager
"RTN","WV11PST",48,0)
 .Q:'WVIEN
"RTN","WV11PST",49,0)
 .S XMY(WVIEN)=""
"RTN","WV11PST",50,0)
 .Q
"RTN","WV11PST",51,0)
 ; Include patch installer if DG option not added to WH menu
"RTN","WV11PST",52,0)
 I $G(WVADD)=0 S XMY(DUZ)=""
"RTN","WV11PST",53,0)
 I '$O(XMY(0)) Q
"RTN","WV11PST",54,0)
SEND ; Create and send mail message
"RTN","WV11PST",55,0)
 S XMDUZ=.5 ;message sender
"RTN","WV11PST",56,0)
 S XMSUB="Women's Health patch #11 installed"
"RTN","WV11PST",57,0)
 S WVMSG(+$$LINE())="Patch #11 for the Women's Health (WH) package was installed. This patch"
"RTN","WV11PST",58,0)
 S WVMSG(+$$LINE())="makes the following changes:"
"RTN","WV11PST",59,0)
 S WVMSG(+$$LINE())=" "
"RTN","WV11PST",60,0)
 S WVMSG(+$$LINE())="1) Adds the 'MST Status Add/Edit' option to the Patient Management menu."
"RTN","WV11PST",61,0)
 S WVMSG(+$$LINE())="This is the same option used by the MST module of the Registration package."
"RTN","WV11PST",62,0)
 S WVMSG(+$$LINE())="This option allows the user to enter Military Sexual Trauma (MST) data"
"RTN","WV11PST",63,0)
 S WVMSG(+$$LINE())="directly into the MST module."
"RTN","WV11PST",64,0)
 S WVMSG(+$$LINE())=" "
"RTN","WV11PST",65,0)
 S WVMSG(+$$LINE())="2) Adds a new option, 'List Sexual Trauma Data', on the Management Reports"
"RTN","WV11PST",66,0)
 S WVMSG(+$$LINE())="menu. This option prints a list of WH patients, their WH Sexual Trauma"
"RTN","WV11PST",67,0)
 S WVMSG(+$$LINE())="value, and MST module value."
"RTN","WV11PST",68,0)
 S WVMSG(+$$LINE())=" "
"RTN","WV11PST",69,0)
 S WVMSG(+$$LINE())="3) Adds a new option, 'Add Sexual Trauma Data to MST Module' to the"
"RTN","WV11PST",70,0)
 S WVMSG(+$$LINE())="File Maintenance menu. This option will copy WH Sexual Trauma data into"
"RTN","WV11PST",71,0)
 S WVMSG(+$$LINE())="the MST module of the Registration package."
"RTN","WV11PST",72,0)
 I $G(WVADD)=0 D
"RTN","WV11PST",73,0)
 .S WVMSG(+$$LINE())=" "
"RTN","WV11PST",74,0)
 .S WVMSG(+$$LINE())="The 'MST Status Add/Edit' option could not be added to the Patient Management"
"RTN","WV11PST",75,0)
 .S WVMSG(+$$LINE())="menu. This mail message is being sent to the patch installer, too."
"RTN","WV11PST",76,0)
 .S WVMSG(+$$LINE())="Attention patch installer: Please contact National Vista Support and"
"RTN","WV11PST",77,0)
 .S WVMSG(+$$LINE())="report this problem. Thank you."
"RTN","WV11PST",78,0)
 .Q
"RTN","WV11PST",79,0)
 S XMTEXT="WVMSG("
"RTN","WV11PST",80,0)
 D ^XMD
"RTN","WV11PST",81,0)
 Q
"RTN","WV11PST",82,0)
LINE() ; Increment line counter by 1
"RTN","WV11PST",83,0)
 S WVLINE=+$G(WVLINE)+1
"RTN","WV11PST",84,0)
 Q WVLINE
"RTN","WV11PST",85,0)
 ;
"RTN","WVMST")
0^1^B35403423
"RTN","WVMST",1,0)
WVMST ;HCIOFO/FT-Transfer Sexual Trauma Data to DG MST Module ;7/10/00  14:11
"RTN","WVMST",2,0)
 ;;1.0;WOMEN'S HEALTH;**11**;Sep 30, 1998
"RTN","WVMST",3,0)
 ;
"RTN","WVMST",4,0)
 ; This routine uses the following IAs:
"RTN","WVMST",5,0)
 ; #1625 - $$GET^XUA4A72      (supported)
"RTN","WVMST",6,0)
 ; #2716 - $$GETSTAT^DGMSTAPI (supported)
"RTN","WVMST",7,0)
 ; #2716 - $$NEWSTAT^DGMSTAPI (supported)
"RTN","WVMST",8,0)
 ;
"RTN","WVMST",9,0)
BEGIN ;EP
"RTN","WVMST",10,0)
 S WVE="",(WVMGR,WVPOP)=0
"RTN","WVMST",11,0)
 D DESC G:WVPOP EXIT
"RTN","WVMST",12,0)
 D CMGR G:WVPOP EXIT
"RTN","WVMST",13,0)
 D DEVICE G:WVPOP EXIT
"RTN","WVMST",14,0)
 D START
"RTN","WVMST",15,0)
EXIT ; Exit and clean up
"RTN","WVMST",16,0)
 K ^TMP($J)
"RTN","WVMST",17,0)
 D ^%ZISC
"RTN","WVMST",18,0)
 K DIR,DIRUT,DIROUT,DTOUT,DUOUT
"RTN","WVMST",19,0)
 K WVCRT,WVDATE,WVDFN,WVDGMST,WVDUZ,WVE,WVFLAG,WVLINE,WVLINL,WVMGR,WVMGRN,WVMGRO
"RTN","WVMST",20,0)
 K WVNAME,WVNODE,WVPAGE,WVPOP,WVPROV,WVREASON,WVSORT,WVSSN,WVST,WVSV,WVTAB,WVTITLE
"RTN","WVMST",21,0)
 K WVTITLEN,WVTITLEY,WVUSER
"RTN","WVMST",22,0)
 K X,Y,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE
"RTN","WVMST",23,0)
 Q
"RTN","WVMST",24,0)
DESC ; Display description/warning
"RTN","WVMST",25,0)
 W:$Y>0 @IOF
"RTN","WVMST",26,0)
 W !,"This option adds WH Sexual Trauma data into the Military Sexual Trauma (MST)"
"RTN","WVMST",27,0)
 W !,"module of the Registration package. The MST module tracks data for veterans"
"RTN","WVMST",28,0)
 W !,"only. Data for non-veterans is not added to the MST module. WH patients"
"RTN","WVMST",29,0)
 W !,"whose Sexual Trauma value is 'Military', 'Civilian', 'Both' or 'None' will"
"RTN","WVMST",30,0)
 W !,"have that value translated into a MST value and added to the MST module."
"RTN","WVMST",31,0)
 W !,"  WH value      MST value"
"RTN","WVMST",32,0)
 W !,"  --------      ---------"
"RTN","WVMST",33,0)
 W !,"  Military      Yes"
"RTN","WVMST",34,0)
 W !,"  Civilian      No"
"RTN","WVMST",35,0)
 W !,"  Both          Yes"
"RTN","WVMST",36,0)
 W !,"  None          No"
"RTN","WVMST",37,0)
 W !!,"WH patients with no Sexual Trauma value are ignored."
"RTN","WVMST",38,0)
 W !!,"NOTE: If a WH patient is already in the MST module with a value of 'Yes'"
"RTN","WVMST",39,0)
 W !,"then no additional MST entry is made. Also, if a WH patient is already in"
"RTN","WVMST",40,0)
 W !,"the MST module with a value of 'No' and the WH Sexual Trauma value is 'None'"
"RTN","WVMST",41,0)
 W !,"or 'Civilian' then no additional MST entry is made."
"RTN","WVMST",42,0)
 D DIRZ^WVUTL3 Q:WVPOP  W @IOF
"RTN","WVMST",43,0)
 W !,"The provider who determined the value must be stored in the MST module."
"RTN","WVMST",44,0)
 W !,"If the case manager associated with the patient or the user running this"
"RTN","WVMST",45,0)
 W !,"option is a provider, then the case manager or the user is identified as the"
"RTN","WVMST",46,0)
 W !,"provider who did the screening. If neither is a provider, then that patient's"
"RTN","WVMST",47,0)
 W !,"data is not added to the MST module."
"RTN","WVMST",48,0)
 W !!,"This option will display a list of WH patients whose data was added to the"
"RTN","WVMST",49,0)
 W !,"MST module. It will also display a list of WH patients whose data could not"
"RTN","WVMST",50,0)
 W !,"be added to the MST module.",!
"RTN","WVMST",51,0)
 K DIR S DIR(0)="Y",DIR("A")="Want to Continue"
"RTN","WVMST",52,0)
 D ^DIR I $D(DIRUT)!(Y=0) S WVPOP=1
"RTN","WVMST",53,0)
 Q
"RTN","WVMST",54,0)
CMGR ;EP
"RTN","WVMST",55,0)
 ;---> SELECT ONE CASE MANAGER OR ALL.
"RTN","WVMST",56,0)
 W !!?3,"Transfer data for all patients for ONE particular Case Manager,"
"RTN","WVMST",57,0)
 W !?3,"or all patients for ALL Case Managers?"
"RTN","WVMST",58,0)
 N DIR,DIRUT,Y
"RTN","WVMST",59,0)
 S DIR("A")="   Select ONE or ALL: ",DIR("B")="ONE",WVMGR=""
"RTN","WVMST",60,0)
 S DIR(0)="SAM^o:ONE;a:ALL" D HELP1^WVMST
"RTN","WVMST",61,0)
 D ^DIR K DIR
"RTN","WVMST",62,0)
 I Y=-1!($D(DIRUT)) S WVPOP=1 Q
"RTN","WVMST",63,0)
 ;---> IF ALL CASE MANAGERS, S WVE=1 AND QUIT.
"RTN","WVMST",64,0)
 I Y="a" S WVE=1 Q
"RTN","WVMST",65,0)
 D DIC^WVFMAN(790.01,"QEMA",.Y,"   Select CASE MANAGER: ")
"RTN","WVMST",66,0)
 I Y<0 S WVPOP=1 Q
"RTN","WVMST",67,0)
 ;---> FOR ONE CASE MANAGER, SET WVE=0 AND WVMGR=^VA(200 DFN, QUIT.
"RTN","WVMST",68,0)
 S WVMGR=+Y,WVE=0
"RTN","WVMST",69,0)
 Q
"RTN","WVMST",70,0)
DEVICE ;EP
"RTN","WVMST",71,0)
 ;---> GET DEVICE AND POSSIBLY QUEUE TO TASKMAN.
"RTN","WVMST",72,0)
 S ZTRTN="DEQUEUE^WVMST"
"RTN","WVMST",73,0)
 F WVSV="E","MGR" D
"RTN","WVMST",74,0)
 .I $D(@("WV"_WVSV)) S ZTSAVE("WV"_WVSV)=""
"RTN","WVMST",75,0)
 D ZIS^WVUTL2(.WVPOP,1,"HOME")
"RTN","WVMST",76,0)
 Q
"RTN","WVMST",77,0)
START ; Start data transfer
"RTN","WVMST",78,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVMST",79,0)
 K ^TMP($J)
"RTN","WVMST",80,0)
 Q:$G(WVE)=""
"RTN","WVMST",81,0)
 S WVDFN=0
"RTN","WVMST",82,0)
 ; all case managers
"RTN","WVMST",83,0)
 I WVE=1 F  S WVDFN=$O(^WV(790,WVDFN)) Q:'WVDFN  D SET
"RTN","WVMST",84,0)
 ; one case manager
"RTN","WVMST",85,0)
 I WVE=0,WVMGR F  S WVDFN=$O(^WV(790,"C",WVMGR,WVDFN)) Q:'WVDFN  D SET
"RTN","WVMST",86,0)
 D PRINT^WVMST1
"RTN","WVMST",87,0)
 Q
"RTN","WVMST",88,0)
SET ; Set temp global
"RTN","WVMST",89,0)
 Q:$$VET^WVUTL1A(WVDFN)'="Yes"  ;veterans only
"RTN","WVMST",90,0)
 S WVNODE=$G(^WV(790,WVDFN,0)) Q:WVNODE=""
"RTN","WVMST",91,0)
 S WVMGR=$P(WVNODE,U,10) ;case manager ien
"RTN","WVMST",92,0)
 ; $$GETSTAT^DGMSTAPI supported API - IA #2716
"RTN","WVMST",93,0)
 S WVDGMST=$$GETSTAT^DGMSTAPI(WVDFN) ;get MST value from Registration
"RTN","WVMST",94,0)
 Q:+WVDGMST=-1  ;couldn't retrieve MST status
"RTN","WVMST",95,0)
 S WVDGMST=$P(WVDGMST,U,2)
"RTN","WVMST",96,0)
 Q:WVDGMST="Y"  ;MST already set to YES                                
"RTN","WVMST",97,0)
 S WVST=$P(WVNODE,U,27) ;WH sexual trauma value
"RTN","WVMST",98,0)
 Q:WVST=""  ;no value
"RTN","WVMST",99,0)
 I WVST="N",WVDGMST="N" Q  ;both are NO, don't update MST
"RTN","WVMST",100,0)
 I WVST="N",WVDGMST="C" Q  ;No & Civilian, don't update MST
"RTN","WVMST",101,0)
 S WVDGMST=$$CONVERT(WVST)
"RTN","WVMST",102,0)
 Q:WVDGMST=""  ;not an MST value                                        
"RTN","WVMST",103,0)
 S WVMGRN=$$PERSON^WVUTL1(WVMGR) ;case manager name
"RTN","WVMST",104,0)
 S WVPROV=$$PROVIDER(DUZ,WVMGR)
"RTN","WVMST",105,0)
 S WVNAME=$$NAME^WVUTL1(WVDFN) ;patient name
"RTN","WVMST",106,0)
 S WVSSN=$$SSN^WVUTL1(WVDFN) ;patient ssn
"RTN","WVMST",107,0)
 S WVST=$S(WVST="M":"Military",WVST="C":"Civilian",WVST="B":"Both",WVST="N":"None",1:"<no value>")
"RTN","WVMST",108,0)
 I WVPROV="" S ^TMP($J,"WVNO",WVMGRN,WVMGR,WVNAME,WVDFN)=WVST_U_U_U_WVSSN_U_"Determining Provider Unknown" Q
"RTN","WVMST",109,0)
 ; parameters(dfn,mst code,date/time,provider ien). A null d/t=NOW.
"RTN","WVMST",110,0)
 ; $$NEWSTAT^DGMSTAPI supported API - IA 2716
"RTN","WVMST",111,0)
 S WVFLAG=$$NEWSTAT^DGMSTAPI(WVDFN,WVDGMST,"",WVPROV)
"RTN","WVMST",112,0)
 ; +WVFLAG will be the ien of the MST entry, if successful
"RTN","WVMST",113,0)
 I +WVFLAG=-1 S ^TMP($J,"WVNO",WVMGRN,WVMGR,WVNAME,WVDFN)=WVST_U_U_U_WVSSN_U_$P(WVFLAG,U,2) Q
"RTN","WVMST",114,0)
 S WVDGMST=$S(WVDGMST="Y":"Yes",WVDGMST="N":"No",WVDGMST="D":"Declined",WVDGMST="U":"Undefined",1:"<no value>")
"RTN","WVMST",115,0)
 I WVPROV S WVPROV=$$PERSON^WVUTL1(WVPROV) ;get provider name
"RTN","WVMST",116,0)
 I +WVFLAG S ^TMP($J,"WVYES",WVMGRN,WVMGR,WVNAME,WVDFN)=WVST_U_WVDGMST_U_WVPROV_U_WVSSN
"RTN","WVMST",117,0)
 Q
"RTN","WVMST",118,0)
CONVERT(WVST) ; Convert WH code to MST code
"RTN","WVMST",119,0)
 ; Convert Military or Both to Yes.
"RTN","WVMST",120,0)
 ;    "    Civilian or None to No.
"RTN","WVMST",121,0)
 ; Ignore null.
"RTN","WVMST",122,0)
 Q $S(WVST="M":"Y",WVST="C":"N",WVST="B":"Y",WVST="N":"N",1:"")
"RTN","WVMST",123,0)
 ;
"RTN","WVMST",124,0)
PROVIDER(WVDUZ,WVMGR) ; Determine provider.
"RTN","WVMST",125,0)
 ; Try case manager first, then try user (i.e., DUZ). 
"RTN","WVMST",126,0)
 ; $$GET^XUA4A72 supported API - IA #1625
"RTN","WVMST",127,0)
 I WVMGR I +$$GET^XUA4A72(WVMGR)>0 Q WVMGR
"RTN","WVMST",128,0)
 I WVDUZ I +$$GET^XUA4A72(WVDUZ)>0 Q WVDUZ
"RTN","WVMST",129,0)
 Q ""
"RTN","WVMST",130,0)
 ;
"RTN","WVMST",131,0)
DEQUEUE ; WVE and WVMGR variables must be set.
"RTN","WVMST",132,0)
 D START,EXIT
"RTN","WVMST",133,0)
 Q
"RTN","WVMST",134,0)
HELP1 ;EP
"RTN","WVMST",135,0)
 ;;Answer "ONE" to list patients for ONE particular Case Manager.
"RTN","WVMST",136,0)
 ;;Answer "ALL" to list patients for ALL Case Managers.
"RTN","WVMST",137,0)
 S WVTAB=5,WVLINL="HELP1" D HELPTX
"RTN","WVMST",138,0)
 Q
"RTN","WVMST",139,0)
HELPTX ;EP
"RTN","WVMST",140,0)
 ;---> CREATES DIR ARRAY FOR DIR.  REQUIRED VARIABLES: WVTAB,WVLINL.
"RTN","WVMST",141,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVMST",142,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","WVMST",143,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","WVMST",144,0)
 Q
"RTN","WVMST1")
0^2^B15635993
"RTN","WVMST1",1,0)
WVMST1 ;HCIOFO/FT-Print Sexual Trauma Data Transfer to DG MST Module ;5/19/00  16:08
"RTN","WVMST1",2,0)
 ;;1.0;WOMEN'S HEALTH;**11**;Sep 30, 1998
"RTN","WVMST1",3,0)
 ;
"RTN","WVMST1",4,0)
PRINT ; Print list
"RTN","WVMST1",5,0)
 U IO
"RTN","WVMST1",6,0)
 S WVCRT=$S($E(IOST)="C":1,1:0)
"RTN","WVMST1",7,0)
 S WVLINE=$$REPEAT^XLFSTR("-",79),(WVPAGE,WVPOP)=0
"RTN","WVMST1",8,0)
 S WVDATE=$$FMTE^XLFDT($$NOW^XLFDT(),"2")
"RTN","WVMST1",9,0)
 S WVUSER=$$PERSON^WVUTL1(DUZ),WVSORT=$S(WVE=0:"ONE",1:"ALL")
"RTN","WVMST1",10,0)
 S WVTITLE="* Transfer WH Sexual Trauma Data to MST Module *"
"RTN","WVMST1",11,0)
 S WVTAB=$L(WVTITLE),WVTAB=(80-WVTAB)\2
"RTN","WVMST1",12,0)
 S WVTITLEY="Patient Data Added to MST Module"
"RTN","WVMST1",13,0)
 S WVTAB(1)=$L(WVTITLEY),WVTAB(1)=(80-WVTAB(1))\2
"RTN","WVMST1",14,0)
 S WVTITLEN="Patient Data Not Added to MST Module"
"RTN","WVMST1",15,0)
 S WVTAB(2)=$L(WVTITLEN),WVTAB(2)=(80-WVTAB(2))\2
"RTN","WVMST1",16,0)
 D HDRY
"RTN","WVMST1",17,0)
 I '$D(^TMP($J,"WVYES")) D NONEY
"RTN","WVMST1",18,0)
 I $D(^TMP($J,"WVYES")) D YES
"RTN","WVMST1",19,0)
 I WVCRT&('$D(IO("S"))) D:'WVPOP DIRZ^WVUTL3 W @IOF
"RTN","WVMST1",20,0)
 Q:WVPOP
"RTN","WVMST1",21,0)
 D HDRN
"RTN","WVMST1",22,0)
 I '$D(^TMP($J,"WVNO")) D NONEN
"RTN","WVMST1",23,0)
 I $D(^TMP($J,"WVNO")) D NO
"RTN","WVMST1",24,0)
 I WVCRT&('$D(IO("S"))) D:'WVPOP DIRZ^WVUTL3 W @IOF
"RTN","WVMST1",25,0)
 Q
"RTN","WVMST1",26,0)
HDRY ; header for entries added to MST
"RTN","WVMST1",27,0)
 W:$Y>0 @IOF
"RTN","WVMST1",28,0)
 S WVPAGE=WVPAGE+1
"RTN","WVMST1",29,0)
 W !,?WVTAB,WVTITLE
"RTN","WVMST1",30,0)
 W !,?WVTAB(1),WVTITLEY
"RTN","WVMST1",31,0)
 W !,"Report Run by: "_WVUSER,?50,"    Page: "_WVPAGE
"RTN","WVMST1",32,0)
 W !,"Case Mgr Sort: "_WVSORT,?50,"Run Date: "_WVDATE
"RTN","WVMST1",33,0)
 W !!,?54,"DETERMINING"
"RTN","WVMST1",34,0)
 W !,?2,"PATIENT",?34,"WH VALUE",?44,"MST VALUE",?54,"PROVIDER"
"RTN","WVMST1",35,0)
 W !,WVLINE
"RTN","WVMST1",36,0)
 Q
"RTN","WVMST1",37,0)
HDRN ; header for entries not added to MST
"RTN","WVMST1",38,0)
 W:$Y>0 @IOF
"RTN","WVMST1",39,0)
 S WVPAGE=WVPAGE+1
"RTN","WVMST1",40,0)
 W !,?WVTAB,WVTITLE
"RTN","WVMST1",41,0)
 W !,?WVTAB(2),WVTITLEN
"RTN","WVMST1",42,0)
 W !,"Report Run by: "_WVUSER,?50,"    Page: "_WVPAGE
"RTN","WVMST1",43,0)
 W !,"Case Mgr Sort: "_WVSORT,?50,"Run Date: "_WVDATE
"RTN","WVMST1",44,0)
 W !!,?2,"PATIENT",?34,"WH CODE",?44,"REASON DATA NOT ADDED"
"RTN","WVMST1",45,0)
 W !,WVLINE
"RTN","WVMST1",46,0)
 Q
"RTN","WVMST1",47,0)
NONEY ; no wh patient data was added to MST module
"RTN","WVMST1",48,0)
 W !,"<No Women's Health patient data was added to the MST module>"
"RTN","WVMST1",49,0)
 W !,"<of the Registration package.>",!
"RTN","WVMST1",50,0)
 Q
"RTN","WVMST1",51,0)
NONEN ; no unsuccessful attempts to add MST data
"RTN","WVMST1",52,0)
 W !,"<All Women's Health patient data that could be added to the MST>"
"RTN","WVMST1",53,0)
 W !,"<module was added successfully.>",!
"RTN","WVMST1",54,0)
 Q
"RTN","WVMST1",55,0)
YES ; List patient data successfully added to MST module
"RTN","WVMST1",56,0)
 S (WVMGRN,WVMGRO)=""
"RTN","WVMST1",57,0)
 F  S WVMGRN=$O(^TMP($J,"WVYES",WVMGRN)) Q:WVMGRN=""!(WVPOP)  S WVMGR=0 F  S WVMGR=$O(^TMP($J,"WVYES",WVMGRN,WVMGR)) Q:'WVMGR!(WVPOP)  D
"RTN","WVMST1",58,0)
 .I WVMGRN'=WVMGRO W !!,"CASE MGR: "_WVMGRN,! S WVMGRO=WVMGRN ;identify cm
"RTN","WVMST1",59,0)
 .S WVNAME=""
"RTN","WVMST1",60,0)
 .F  S WVNAME=$O(^TMP($J,"WVYES",WVMGRN,WVMGR,WVNAME)) Q:WVNAME=""!(WVPOP)  S WVDFN=0 F  S WVDFN=$O(^TMP($J,"WVYES",WVMGRN,WVMGR,WVNAME,WVDFN)) Q:'WVDFN!(WVPOP)  D
"RTN","WVMST1",61,0)
 ..I ($Y+4)>IOSL D:WVCRT DIRZ^WVUTL3 Q:WVPOP  D HDRY
"RTN","WVMST1",62,0)
 ..S WVNODE=^TMP($J,"WVYES",WVMGRN,WVMGR,WVNAME,WVDFN)
"RTN","WVMST1",63,0)
 ..S WVST=$P(WVNODE,U,1),WVDGMST=$P(WVNODE,U,2),WVPROV=$P(WVNODE,U,3)
"RTN","WVMST1",64,0)
 ..S WVSSN=$P(WVNODE,U,4)
"RTN","WVMST1",65,0)
 ..W !,?2,WVNAME,?34,WVST,?44,WVDGMST,?54,WVPROV,!,?2,"("_WVSSN_")"
"RTN","WVMST1",66,0)
 ..Q
"RTN","WVMST1",67,0)
 .Q
"RTN","WVMST1",68,0)
 Q
"RTN","WVMST1",69,0)
NO ; List patient data not added to MST module and reason it wasn't added
"RTN","WVMST1",70,0)
 S (WVMGRN,WVMGRO)=""
"RTN","WVMST1",71,0)
 F  S WVMGRN=$O(^TMP($J,"WVNO",WVMGRN)) Q:WVMGRN=""!(WVPOP)  S WVMGR=0 F  S WVMGR=$O(^TMP($J,"WVNO",WVMGRN,WVMGR)) Q:'WVMGR!(WVPOP)  D
"RTN","WVMST1",72,0)
 .I WVMGRN'=WVMGRO W !!,"CASE MGR: "_WVMGRN,! S WVMGRO=WVMGRN ;identify cm
"RTN","WVMST1",73,0)
 .S WVNAME=""
"RTN","WVMST1",74,0)
 .F  S WVNAME=$O(^TMP($J,"WVNO",WVMGRN,WVMGR,WVNAME)) Q:WVNAME=""!(WVPOP)  S WVDFN=0 F  S WVDFN=$O(^TMP($J,"WVNO",WVMGRN,WVMGR,WVNAME,WVDFN)) Q:'WVDFN!(WVPOP)  D
"RTN","WVMST1",75,0)
 ..I ($Y+4)>IOSL D:WVCRT DIRZ^WVUTL3 Q:WVPOP  D HDRN
"RTN","WVMST1",76,0)
 ..S WVNODE=^TMP($J,"WVNO",WVMGRN,WVMGR,WVNAME,WVDFN)
"RTN","WVMST1",77,0)
 ..S WVST=$P(WVNODE,U,1),WVSSN=$P(WVNODE,U,4),WVREASON=$P(WVNODE,U,5)
"RTN","WVMST1",78,0)
 ..W !,?2,WVNAME,?34,WVST,?44,WVREASON,!,?2,"("_WVSSN_")"
"RTN","WVMST1",79,0)
 ..Q
"RTN","WVMST1",80,0)
 .Q
"RTN","WVMST1",81,0)
 Q
"RTN","WVMSTL")
0^3^B13218714
"RTN","WVMSTL",1,0)
WVMSTL ;HCIOFO/FT-List WH Sexual Trauma Data ;6/8/00  09:19
"RTN","WVMSTL",2,0)
 ;;1.0;WOMEN'S HEALTH;**11**;Sep 30, 1998
"RTN","WVMSTL",3,0)
 ;
"RTN","WVMSTL",4,0)
 ; This routine uses the following IAs:
"RTN","WVMSTL",5,0)
 ; #2716 - $$GETSTAT^DGMSTAPI (supported)
"RTN","WVMSTL",6,0)
 ;
"RTN","WVMSTL",7,0)
BEGIN ;EP
"RTN","WVMSTL",8,0)
 S WVE="",(WVMGR,WVPOP)=0
"RTN","WVMSTL",9,0)
 D CMGR G:WVPOP EXIT
"RTN","WVMSTL",10,0)
 D DEVICE G:WVPOP EXIT
"RTN","WVMSTL",11,0)
 D START
"RTN","WVMSTL",12,0)
EXIT ; Exit and clean up
"RTN","WVMSTL",13,0)
 K ^TMP($J)
"RTN","WVMSTL",14,0)
 D ^%ZISC
"RTN","WVMSTL",15,0)
 K DIR,DIRUT,DIROUT,DTOUT,DUOUT
"RTN","WVMSTL",16,0)
 K WVCRT,WVDATE,WVDFN,WVDGMST,WVE,WVEC,WVLINE,WVLINL,WVMGR,WVMGRN,WVMGRO,WVNAME
"RTN","WVMSTL",17,0)
 K WVNODE,WVPAGE,WVPOP,WVPROV,WVSORT,WVSSN,WVST,WVSV,WVTAB,WVTITLE,WVUSER,WVVET
"RTN","WVMSTL",18,0)
 K X,Y,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE
"RTN","WVMSTL",19,0)
 Q
"RTN","WVMSTL",20,0)
CMGR ;EP
"RTN","WVMSTL",21,0)
 ;---> SELECT ONE CASE MANAGER OR ALL.
"RTN","WVMSTL",22,0)
 W !!?3,"Show data for all patients for ONE particular Case Manager,"
"RTN","WVMSTL",23,0)
 W !?3,"or all patients for ALL Case Managers?"
"RTN","WVMSTL",24,0)
 N DIR,DIRUT,Y
"RTN","WVMSTL",25,0)
 S DIR("A")="   Select ONE or ALL: ",DIR("B")="ONE",WVMGR=""
"RTN","WVMSTL",26,0)
 S DIR(0)="SAM^o:ONE;a:ALL" D HELP1^WVMST
"RTN","WVMSTL",27,0)
 D ^DIR K DIR
"RTN","WVMSTL",28,0)
 I Y=-1!($D(DIRUT)) S WVPOP=1 Q
"RTN","WVMSTL",29,0)
 ;---> IF ALL CASE MANAGERS, S WVE=1 AND QUIT.
"RTN","WVMSTL",30,0)
 I Y="a" S WVE=1 Q
"RTN","WVMSTL",31,0)
 D DIC^WVFMAN(790.01,"QEMA",.Y,"   Select CASE MANAGER: ")
"RTN","WVMSTL",32,0)
 I Y<0 S WVPOP=1 Q
"RTN","WVMSTL",33,0)
 ;---> FOR ONE CASE MANAGER, SET WVE=0 AND WVMGR=^VA(200 DFN, QUIT.
"RTN","WVMSTL",34,0)
 S WVMGR=+Y,WVE=0
"RTN","WVMSTL",35,0)
 Q
"RTN","WVMSTL",36,0)
DEVICE ;EP
"RTN","WVMSTL",37,0)
 ;---> GET DEVICE AND POSSIBLY QUEUE TO TASKMAN.
"RTN","WVMSTL",38,0)
 S ZTRTN="DEQUEUE^WVMSTL"
"RTN","WVMSTL",39,0)
 F WVSV="E","MGR" D
"RTN","WVMSTL",40,0)
 .I $D(@("WV"_WVSV)) S ZTSAVE("WV"_WVSV)=""
"RTN","WVMSTL",41,0)
 D ZIS^WVUTL2(.WVPOP,1,"HOME")
"RTN","WVMSTL",42,0)
 Q
"RTN","WVMSTL",43,0)
START ; Start data gathering
"RTN","WVMSTL",44,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVMSTL",45,0)
 K ^TMP($J)
"RTN","WVMSTL",46,0)
 Q:$G(WVE)=""
"RTN","WVMSTL",47,0)
 S WVDFN=0
"RTN","WVMSTL",48,0)
 ; all case managers
"RTN","WVMSTL",49,0)
 I WVE=1 F  S WVDFN=$O(^WV(790,WVDFN)) Q:'WVDFN  D SET
"RTN","WVMSTL",50,0)
 ; one case manager
"RTN","WVMSTL",51,0)
 I WVE=0,WVMGR F  S WVDFN=$O(^WV(790,"C",WVMGR,WVDFN)) Q:'WVDFN  D SET
"RTN","WVMSTL",52,0)
 D PRINT^WVMSTL1
"RTN","WVMSTL",53,0)
 Q
"RTN","WVMSTL",54,0)
SET ; Set temp global
"RTN","WVMSTL",55,0)
 Q:$$DECEASED^WVUTL1(WVDFN)  ;deceased
"RTN","WVMSTL",56,0)
 S WVNODE=$G(^WV(790,WVDFN,0)) Q:WVNODE=""
"RTN","WVMSTL",57,0)
 I $P(WVNODE,U,24)>0,$P(WVNODE,U,24)<DT Q  ;inactive date before today
"RTN","WVMSTL",58,0)
 S WVVET=$$VET^WVUTL1A(WVDFN) ;veterans status
"RTN","WVMSTL",59,0)
 S WVEC=$$ELIG^WVUTL9(WVDFN),WVEC=$P(WVEC,U,2) ;primary eligibility code
"RTN","WVMSTL",60,0)
 S WVPROV=$$PROVI^WVUTL1A(WVDFN) ;primary provider
"RTN","WVMSTL",61,0)
 S WVMGR=$P(WVNODE,U,10) ;case manager ien
"RTN","WVMSTL",62,0)
 S WVDGMST="<N/A - Not a Veteran>"
"RTN","WVMSTL",63,0)
 I $E(WVVET)="Y" D
"RTN","WVMSTL",64,0)
 .; $$GETSTAT^DGMSTAPI supported API - IA #2716
"RTN","WVMSTL",65,0)
 .S WVDGMST=$$GETSTAT^DGMSTAPI(WVDFN) ;get MST value from Registration
"RTN","WVMSTL",66,0)
 .S WVDGMST=$P(WVDGMST,U,6)
"RTN","WVMSTL",67,0)
 .S:WVDGMST="" WVDGMST="Unknown, not screened"
"RTN","WVMSTL",68,0)
 .Q
"RTN","WVMSTL",69,0)
 S WVST=$P(WVNODE,U,27) ;WH sexual trauma code
"RTN","WVMSTL",70,0)
 S WVMGRN=$$PERSON^WVUTL1(WVMGR) ;case manager name
"RTN","WVMSTL",71,0)
 S WVNAME=$$NAME^WVUTL1(WVDFN) ;patient name
"RTN","WVMSTL",72,0)
 S WVSSN=$$SSN^WVUTL1(WVDFN) ;patient ssn
"RTN","WVMSTL",73,0)
 S WVST=$$EXTERNAL^DILFD(790,.27,"",WVST) ;WH ST external value
"RTN","WVMSTL",74,0)
 S:WVST="" WVST="<no value>"
"RTN","WVMSTL",75,0)
 S ^TMP($J,"WVST",WVMGRN,WVMGR,WVNAME,WVDFN)=WVSSN_U_WVPROV_U_WVVET_U_WVEC_U_WVST_U_WVDGMST
"RTN","WVMSTL",76,0)
 Q
"RTN","WVMSTL",77,0)
DEQUEUE ; WVE and WVMGR variables must be set.
"RTN","WVMSTL",78,0)
 D START,EXIT
"RTN","WVMSTL",79,0)
 Q
"RTN","WVMSTL",80,0)
HELP1 ;EP
"RTN","WVMSTL",81,0)
 ;;Answer "ONE" to list patients for ONE particular Case Manager.
"RTN","WVMSTL",82,0)
 ;;Answer "ALL" to list patients for ALL Case Managers.
"RTN","WVMSTL",83,0)
 S WVTAB=5,WVLINL="HELP1" D HELPTX
"RTN","WVMSTL",84,0)
 Q
"RTN","WVMSTL",85,0)
HELPTX ;EP
"RTN","WVMSTL",86,0)
 ;---> CREATES DIR ARRAY FOR DIR.  REQUIRED VARIABLES: WVTAB,WVLINL.
"RTN","WVMSTL",87,0)
 N I,T,X S T=$$REPEAT^XLFSTR(" ",WVTAB)
"RTN","WVMSTL",88,0)
 F I=1:1 S X=$T(@WVLINL+I) Q:X'[";;"  S DIR("?",I)=T_$P(X,";;",2)
"RTN","WVMSTL",89,0)
 S DIR("?")=DIR("?",I-1) K DIR("?",I-1)
"RTN","WVMSTL",90,0)
 Q
"RTN","WVMSTL1")
0^4^B6329542
"RTN","WVMSTL1",1,0)
WVMSTL1 ;HCIOFO/FT-List Sexual Trauma Data (cont.) ;6/8/00  11:26
"RTN","WVMSTL1",2,0)
 ;;1.0;WOMEN'S HEALTH;**11**;Sep 30, 1998
"RTN","WVMSTL1",3,0)
 ;
"RTN","WVMSTL1",4,0)
PRINT ; Print list
"RTN","WVMSTL1",5,0)
 U IO
"RTN","WVMSTL1",6,0)
 S WVLINE=$$REPEAT^XLFSTR("-",79),(WVPAGE,WVPOP)=0
"RTN","WVMSTL1",7,0)
 S WVDATE=$$FMTE^XLFDT($$NOW^XLFDT(),"2")
"RTN","WVMSTL1",8,0)
 S WVUSER=$$PERSON^WVUTL1(DUZ),WVSORT=$S(WVE=0:"ONE",1:"ALL")
"RTN","WVMSTL1",9,0)
 S WVTITLE="* LIST SEXUAL TRAUMA DATA *"
"RTN","WVMSTL1",10,0)
 S WVCRT=$S($E(IOST)="C":1,1:0)
"RTN","WVMSTL1",11,0)
 S WVTAB=$L(WVTITLE),WVTAB=(80-WVTAB)\2
"RTN","WVMSTL1",12,0)
 I '$D(^TMP($J,"WVST")) D HDR,NODATA
"RTN","WVMSTL1",13,0)
 I $D(^TMP($J,"WVST")) D HDR,DATA
"RTN","WVMSTL1",14,0)
 I WVCRT&('$D(IO("S"))) D:'WVPOP DIRZ^WVUTL3 W @IOF
"RTN","WVMSTL1",15,0)
 Q
"RTN","WVMSTL1",16,0)
HDR ; Report header
"RTN","WVMSTL1",17,0)
 W:$Y>0 @IOF
"RTN","WVMSTL1",18,0)
 S WVPAGE=WVPAGE+1
"RTN","WVMSTL1",19,0)
 W !,?WVTAB,WVTITLE
"RTN","WVMSTL1",20,0)
 W !,"Report Run by: "_WVUSER,?50,"    Page: "_WVPAGE
"RTN","WVMSTL1",21,0)
 W !,"Case Mgr Sort: "_WVSORT,?50,"Run Date: "_WVDATE
"RTN","WVMSTL1",22,0)
 W !!,"SSN",?14,"PATIENT",?41,"WH & MST VALUES"
"RTN","WVMSTL1",23,0)
 W !,WVLINE
"RTN","WVMSTL1",24,0)
 Q
"RTN","WVMSTL1",25,0)
NODATA ; no wh patient data found
"RTN","WVMSTL1",26,0)
 W !,"<No patient data was found.>",!
"RTN","WVMSTL1",27,0)
 Q
"RTN","WVMSTL1",28,0)
DATA ; Loop through TMP global
"RTN","WVMSTL1",29,0)
 S (WVMGRN,WVMGRO)=""
"RTN","WVMSTL1",30,0)
 F  S WVMGRN=$O(^TMP($J,"WVST",WVMGRN)) Q:WVMGRN=""!(WVPOP)  S WVMGR=0 F  S WVMGR=$O(^TMP($J,"WVST",WVMGRN,WVMGR)) Q:'WVMGR!(WVPOP)  D
"RTN","WVMSTL1",31,0)
 .I WVMGRN'=WVMGRO D
"RTN","WVMSTL1",32,0)
 ..W:WVMGRO="" !! ;first cm
"RTN","WVMSTL1",33,0)
 ..W:WVMGRO]"" !!! ;subsequent cms
"RTN","WVMSTL1",34,0)
 ..W "CASE MGR: "_WVMGRN
"RTN","WVMSTL1",35,0)
 ..S WVMGRO=WVMGRN ;identify cm
"RTN","WVMSTL1",36,0)
 ..Q
"RTN","WVMSTL1",37,0)
 .S WVNAME=""
"RTN","WVMSTL1",38,0)
 .F  S WVNAME=$O(^TMP($J,"WVST",WVMGRN,WVMGR,WVNAME)) Q:WVNAME=""!(WVPOP)  S WVDFN=0 F  S WVDFN=$O(^TMP($J,"WVST",WVMGRN,WVMGR,WVNAME,WVDFN)) Q:'WVDFN!(WVPOP)  D
"RTN","WVMSTL1",39,0)
 ..I ($Y+6)>IOSL D:WVCRT DIRZ^WVUTL3 Q:WVPOP  D HDR
"RTN","WVMSTL1",40,0)
 ..S WVNODE=^TMP($J,"WVST",WVMGRN,WVMGR,WVNAME,WVDFN)
"RTN","WVMSTL1",41,0)
 ..S WVSSN=$P(WVNODE,U,1),WVPROV=$P(WVNODE,U,2),WVVET=$P(WVNODE,U,3)
"RTN","WVMSTL1",42,0)
 ..S WVEC=$P(WVNODE,U,4),WVST=$P(WVNODE,U,5),WVDGMST=$P(WVNODE,U,6)
"RTN","WVMSTL1",43,0)
 ..W !!,WVSSN,?14,WVNAME,?41," WH= "_WVST
"RTN","WVMSTL1",44,0)
 ..W !,"Pr. Provider => "_WVPROV,?41,"MST= "_WVDGMST
"RTN","WVMSTL1",45,0)
 ..W !,"Age: "_$$AGE^WVUTL9(WVDFN)_" / Veteran: "_WVVET_" / Eligibility: "_WVEC
"RTN","WVMSTL1",46,0)
 ..Q
"RTN","WVMSTL1",47,0)
 .Q
"RTN","WVMSTL1",48,0)
 Q
"VER")
8.0^22
**END**
**END**
