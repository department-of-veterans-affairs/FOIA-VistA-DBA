Released XM*7.1*32 SEQ #35
Extracted from mail message
**KIDS**:XM*7.1*32^

**INSTALL NAME**
XM*7.1*32
"BLD",12,0)
XM*7.1*32^MAILMAN^0^2961029^n
"BLD",12,1,0)
^^51^51^2961029^^
"BLD",12,1,1,0)
This MailMan patch is in response to a problem noted on FORUM.
"BLD",12,1,2,0)
 
"BLD",12,1,3,0)
A description of the problem:
"BLD",12,1,4,0)
Site A (from outside the VA) sends a message to Site B (in the VA).
"BLD",12,1,5,0)
User at Site B forwards the message to Site C (in the VA).
"BLD",12,1,6,0)
Site C has records in ^XMBX(4.501 (do not accept messages from domains
"BLD",12,1,7,0)
which match).
"BLD",12,1,8,0)
Site C rejects the message because the originating domain (Site A)
"BLD",12,1,9,0)
partial-matches the 'do not accept' record.
"BLD",12,1,10,0)
MailMan sends a message to Site A about the rejection.
"BLD",12,1,11,0)
MailMan keeps trying to forward the message from Site B to Site C
"BLD",12,1,12,0)
and keeps sending rejection messages to Site A, ad infinitum, ad nauseum.
"BLD",12,1,13,0)
MailMan does not notify the user at Site B who forwarded the message.
"BLD",12,1,14,0)
 
"BLD",12,1,15,0)
This patch does two things:
"BLD",12,1,16,0)
1. Sends the reject message to the user who forwarded the message.
"BLD",12,1,17,0)
2. Changes the status of the message so that MailMan does not attempt to
"BLD",12,1,18,0)
send it again.
"BLD",12,1,19,0)
===========================================================================
"BLD",12,1,20,0)
 
"BLD",12,1,21,0)
 This patch can be installed with users on the system.
"BLD",12,1,22,0)
===========================================================================
"BLD",12,1,23,0)
 
"BLD",12,1,24,0)
INSTALLATION:
"BLD",12,1,25,0)
  1.  This routine is usually mapped on systems that allow mapping,
"BLD",12,1,26,0)
      so you will need to disable mapping for the effected routine.
"BLD",12,1,27,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"BLD",12,1,28,0)
      option will load the KIDS package onto your system.
"BLD",12,1,29,0)
  3.  The patch has now been loaded into a Transport global on your
"BLD",12,1,30,0)
      system. You now need to use KIDS to install the Transport global.
"BLD",12,1,31,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"BLD",12,1,32,0)
      options:
"BLD",12,1,33,0)
         Verify Checksums in Transport Global
"BLD",12,1,34,0)
         Print Transport Global
"BLD",12,1,35,0)
         Compare Transport Global to Current System
"BLD",12,1,36,0)
         Backup a Transport Global
"BLD",12,1,37,0)
         Install Package(s)
"BLD",12,1,38,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",12,1,39,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",12,1,40,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"BLD",12,1,41,0)
============================================================================ 
"BLD",12,1,42,0)
  
"BLD",12,1,43,0)
 ROUTINES:
"BLD",12,1,44,0)
   The second line of the routine now looks like:
"BLD",12,1,45,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",12,1,46,0)
 
"BLD",12,1,47,0)
               Before          After
"BLD",12,1,48,0)
 Name          Checksum        Checksum        Patch List
"BLD",12,1,49,0)
 ----------------------------------------------------------
"BLD",12,1,50,0)
 XMSERR        2286812         3651687          32
"BLD",12,1,51,0)
============================================================================
"BLD",12,4,0)
^9.64PA^^
"BLD",12,"KRN",0)
^9.67PA^19^12
"BLD",12,"KRN",.4,0)
.4
"BLD",12,"KRN",.401,0)
.401
"BLD",12,"KRN",.402,0)
.402
"BLD",12,"KRN",.403,0)
.403
"BLD",12,"KRN",.5,0)
.5
"BLD",12,"KRN",.84,0)
.84
"BLD",12,"KRN",3.6,0)
3.6
"BLD",12,"KRN",3.8,0)
3.8
"BLD",12,"KRN",9.2,0)
9.2
"BLD",12,"KRN",9.8,0)
9.8
"BLD",12,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",12,"KRN",9.8,"NM",1,0)
XMSERR^^0^B5060408
"BLD",12,"KRN",9.8,"NM","B","XMSERR",1)

"BLD",12,"KRN",19,0)
19
"BLD",12,"KRN",19.1,0)
19.1
"BLD",12,"KRN","B",.4,.4)

"BLD",12,"KRN","B",.401,.401)

"BLD",12,"KRN","B",.402,.402)

"BLD",12,"KRN","B",.403,.403)

"BLD",12,"KRN","B",.5,.5)

"BLD",12,"KRN","B",.84,.84)

"BLD",12,"KRN","B",3.6,3.6)

"BLD",12,"KRN","B",3.8,3.8)

"BLD",12,"KRN","B",9.2,9.2)

"BLD",12,"KRN","B",9.8,9.8)

"BLD",12,"KRN","B",19,19)

"BLD",12,"KRN","B",19.1,19.1)

"BLD",12,"QUES",0)
^9.62^^
"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
32^2961029
"PKG",6,22,1,"PAH",1,1,0)
^^51^51^2961029
"PKG",6,22,1,"PAH",1,1,1,0)
This MailMan patch is in response to a problem noted on FORUM.
"PKG",6,22,1,"PAH",1,1,2,0)
 
"PKG",6,22,1,"PAH",1,1,3,0)
A description of the problem:
"PKG",6,22,1,"PAH",1,1,4,0)
Site A (from outside the VA) sends a message to Site B (in the VA).
"PKG",6,22,1,"PAH",1,1,5,0)
User at Site B forwards the message to Site C (in the VA).
"PKG",6,22,1,"PAH",1,1,6,0)
Site C has records in ^XMBX(4.501 (do not accept messages from domains
"PKG",6,22,1,"PAH",1,1,7,0)
which match).
"PKG",6,22,1,"PAH",1,1,8,0)
Site C rejects the message because the originating domain (Site A)
"PKG",6,22,1,"PAH",1,1,9,0)
partial-matches the 'do not accept' record.
"PKG",6,22,1,"PAH",1,1,10,0)
MailMan sends a message to Site A about the rejection.
"PKG",6,22,1,"PAH",1,1,11,0)
MailMan keeps trying to forward the message from Site B to Site C
"PKG",6,22,1,"PAH",1,1,12,0)
and keeps sending rejection messages to Site A, ad infinitum, ad nauseum.
"PKG",6,22,1,"PAH",1,1,13,0)
MailMan does not notify the user at Site B who forwarded the message.
"PKG",6,22,1,"PAH",1,1,14,0)
 
"PKG",6,22,1,"PAH",1,1,15,0)
This patch does two things:
"PKG",6,22,1,"PAH",1,1,16,0)
1. Sends the reject message to the user who forwarded the message.
"PKG",6,22,1,"PAH",1,1,17,0)
2. Changes the status of the message so that MailMan does not attempt to
"PKG",6,22,1,"PAH",1,1,18,0)
send it again.
"PKG",6,22,1,"PAH",1,1,19,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,20,0)
 
"PKG",6,22,1,"PAH",1,1,21,0)
 This patch can be installed with users on the system.
"PKG",6,22,1,"PAH",1,1,22,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,23,0)
 
"PKG",6,22,1,"PAH",1,1,24,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,25,0)
  1.  This routine is usually mapped on systems that allow mapping,
"PKG",6,22,1,"PAH",1,1,26,0)
      so you will need to disable mapping for the effected routine.
"PKG",6,22,1,"PAH",1,1,27,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"PKG",6,22,1,"PAH",1,1,28,0)
      option will load the KIDS package onto your system.
"PKG",6,22,1,"PAH",1,1,29,0)
  3.  The patch has now been loaded into a Transport global on your
"PKG",6,22,1,"PAH",1,1,30,0)
      system. You now need to use KIDS to install the Transport global.
"PKG",6,22,1,"PAH",1,1,31,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"PKG",6,22,1,"PAH",1,1,32,0)
      options:
"PKG",6,22,1,"PAH",1,1,33,0)
         Verify Checksums in Transport Global
"PKG",6,22,1,"PAH",1,1,34,0)
         Print Transport Global
"PKG",6,22,1,"PAH",1,1,35,0)
         Compare Transport Global to Current System
"PKG",6,22,1,"PAH",1,1,36,0)
         Backup a Transport Global
"PKG",6,22,1,"PAH",1,1,37,0)
         Install Package(s)
"PKG",6,22,1,"PAH",1,1,38,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",6,22,1,"PAH",1,1,39,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",6,22,1,"PAH",1,1,40,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"PKG",6,22,1,"PAH",1,1,41,0)
============================================================================ 
"PKG",6,22,1,"PAH",1,1,42,0)
  
"PKG",6,22,1,"PAH",1,1,43,0)
 ROUTINES:
"PKG",6,22,1,"PAH",1,1,44,0)
   The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,45,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,46,0)
 
"PKG",6,22,1,"PAH",1,1,47,0)
               Before          After
"PKG",6,22,1,"PAH",1,1,48,0)
 Name          Checksum        Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,49,0)
 ----------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,50,0)
 XMSERR        2286812         3651687          32
"PKG",6,22,1,"PAH",1,1,51,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XMSERR")
0^1^B5060408
"RTN","XMSERR",1,0)
XMSERR ;(WASH ISC)/THM/CAP- ERRORS... ;07/17/96  14:26
"RTN","XMSERR",2,0)
 ;;7.1;MailMan;**32**;Jun 02, 1994
"RTN","XMSERR",3,0)
HELONO S ERR=^XMB("NETNAME")_" not Recognized by "_$P(Y3,U),ER=1
"RTN","XMSERR",4,0)
 G ERR
"RTN","XMSERR",5,0)
MAILNO S ERR="Receiver will not accept Mail."
"RTN","XMSERR",6,0)
 Q:+$G(XMRG)'=502
"RTN","XMSERR",7,0)
 S XMB="XM_TRANSMISSION_ERROR",XMB(1)="message from you",XMB(2)=XMRG,XMB(3)="The message (Subj: "_$E($P(XMR,U),1,20)_$S($L($P(XMR,U))>20:"...",1:"")_" ["_XMZ_"]) was not transmitted" ;,XMY($P(XMR,U,2))=""
"RTN","XMSERR",8,0)
 N XMSRIEN,XMSRTO,XMSRTXT,XMSRI
"RTN","XMSERR",9,0)
 ; For every addressee for that site, send reject message to
"RTN","XMSERR",10,0)
 ; - user who forwarded to that addressee.
"RTN","XMSERR",11,0)
 ; - if no one forwarded, then to message originator.
"RTN","XMSERR",12,0)
 S (XMSRIEN,XMSRI)=0
"RTN","XMSERR",13,0)
 F  S XMSRIEN=$O(^XMB(3.9,XMZ,1,"AQUEUE",XMINST,XMSRIEN)) Q:XMSRIEN=""  D
"RTN","XMSERR",14,0)
 . S XMSRTO=$P($G(^XMB(3.9,XMZ,1,XMSRIEN,"F")),U,2)  ; Forwarded by
"RTN","XMSERR",15,0)
 . S:XMSRTO="" XMSRTO=XMFROM  ; XMFROM=the originator of the message
"RTN","XMSERR",16,0)
 . S XMY(XMSRTO)=""
"RTN","XMSERR",17,0)
 . S XMSRI=XMSRI+1
"RTN","XMSERR",18,0)
 . S XMSRTXT(XMSRI)=" to:  "_$P($G(^XMB(3.9,XMZ,1,XMSRIEN,0)),U,1)
"RTN","XMSERR",19,0)
 . K ^XMB(3.9,XMZ,1,"AQUEUE",XMINST,XMSRIEN)
"RTN","XMSERR",20,0)
 . S $P(^XMB(3.9,XMZ,1,XMSRIEN,0),U,5,7)=XMD_U_"Receive site reject originator"  ; XMD should be FM date/time
"RTN","XMSERR",21,0)
 S:$D(XMSRTXT) XMTEXT="XMSRTXT("
"RTN","XMSERR",22,0)
 D ^XMB S ER=1
"RTN","XMSERR",23,0)
 G ERR
"RTN","XMSERR",24,0)
LOCKNO S ERR="Lock on message not accepted by receiver."
"RTN","XMSERR",25,0)
 G ERR
"RTN","XMSERR",26,0)
DATANO S ERR="Receiver will not accept DATA."
"RTN","XMSERR",27,0)
 G ERR
"RTN","XMSERR",28,0)
VALBAD S XMSG="500 Invalid domain validation response"
"RTN","XMSERR",29,0)
 X XMSEN S XMB="XMVALBAD",XMB(1)=$P(Y3,U)
"RTN","XMSERR",30,0)
 D ^XMB S ER=1
"RTN","XMSERR",31,0)
 Q
"RTN","XMSERR",32,0)
ERR S XMTRAN="Error: "_ERR S:'$D(XMB(4)) XMB(4)=XMTRAN D TRAN^XMC1 S ER=1 Q
"VER")
8.0^21.0
**END**
**END**
