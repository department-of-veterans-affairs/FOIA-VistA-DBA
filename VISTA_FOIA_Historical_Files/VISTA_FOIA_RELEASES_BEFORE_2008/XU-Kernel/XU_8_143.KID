KIDS Distribution saved on Mar 28, 2000@14:06:28
Patches XU*8.0*143, KMPR*1.0*2
**KIDS**:XU*8.0*143^KMPR*1.0*2^

**INSTALL NAME**
XU*8.0*143
"BLD",1252,0)
XU*8.0*143^KERNEL^0^3000328^y
"BLD",1252,1,0)
^^1^1^3000328^
"BLD",1252,1,1,0)
RUM for OpenM/Cache.
"BLD",1252,4,0)
^9.64PA^^
"BLD",1252,"INIT")

"BLD",1252,"KRN",0)
^9.67PA^19^18
"BLD",1252,"KRN",.4,0)
.4
"BLD",1252,"KRN",.401,0)
.401
"BLD",1252,"KRN",.402,0)
.402
"BLD",1252,"KRN",.403,0)
.403
"BLD",1252,"KRN",.5,0)
.5
"BLD",1252,"KRN",.84,0)
.84
"BLD",1252,"KRN",3.6,0)
3.6
"BLD",1252,"KRN",3.8,0)
3.8
"BLD",1252,"KRN",9.2,0)
9.2
"BLD",1252,"KRN",9.8,0)
9.8
"BLD",1252,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",1252,"KRN",9.8,"NM",1,0)
ZOSVKRM^^0^B356890
"BLD",1252,"KRN",9.8,"NM",2,0)
ZOSVKRO^^0^B15510038
"BLD",1252,"KRN",9.8,"NM",3,0)
ZOSVKRV^^0^B23577094
"BLD",1252,"KRN",9.8,"NM","B","ZOSVKRM",1)

"BLD",1252,"KRN",9.8,"NM","B","ZOSVKRO",2)

"BLD",1252,"KRN",9.8,"NM","B","ZOSVKRV",3)

"BLD",1252,"KRN",19,0)
19
"BLD",1252,"KRN",19.1,0)
19.1
"BLD",1252,"KRN",101,0)
101
"BLD",1252,"KRN",409.61,0)
409.61
"BLD",1252,"KRN",771,0)
771
"BLD",1252,"KRN",869.2,0)
869.2
"BLD",1252,"KRN",870,0)
870
"BLD",1252,"KRN",8994,0)
8994
"BLD",1252,"KRN","B",.4,.4)

"BLD",1252,"KRN","B",.401,.401)

"BLD",1252,"KRN","B",.402,.402)

"BLD",1252,"KRN","B",.403,.403)

"BLD",1252,"KRN","B",.5,.5)

"BLD",1252,"KRN","B",.84,.84)

"BLD",1252,"KRN","B",3.6,3.6)

"BLD",1252,"KRN","B",3.8,3.8)

"BLD",1252,"KRN","B",9.2,9.2)

"BLD",1252,"KRN","B",9.8,9.8)

"BLD",1252,"KRN","B",19,19)

"BLD",1252,"KRN","B",19.1,19.1)

"BLD",1252,"KRN","B",101,101)

"BLD",1252,"KRN","B",409.61,409.61)

"BLD",1252,"KRN","B",771,771)

"BLD",1252,"KRN","B",869.2,869.2)

"BLD",1252,"KRN","B",870,870)

"BLD",1252,"KRN","B",8994,8994)

"BLD",1252,"PRET")

"BLD",1252,"QUES",0)
^9.62^^
"BLD",1252,"REQB",0)
^9.611^1^1
"BLD",1252,"REQB",1,0)
XU*8.0*122^1
"BLD",1252,"REQB","B","XU*8.0*122",1)

"MBREQ")
0
"PKG",175,-1)
1^1
"PKG",175,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^XUDOCV7 NEW FEATURES
"PKG",175,22,0)
^9.49I^1^1
"PKG",175,22,1,0)
8.0^2950703^2951020^101378
"PKG",175,22,1,"PAH",1,0)
143^3000328^103137
"PKG",175,22,1,"PAH",1,1,0)
^^1^1^3000328
"PKG",175,22,1,"PAH",1,1,1,0)
RUM for OpenM/Cache.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ZOSVKRM")
0^1^B356890
"RTN","ZOSVKRM",1,0)
%ZOSVKR ;SF/KAK - Collect RUM Statistics for MSM ;3/10/00  07:43
"RTN","ZOSVKRM",2,0)
 ;;8.0;KERNEL;**90,94,107,122,143**;Jul 21, 1998
"RTN","ZOSVKRM",3,0)
 ;
"RTN","ZOSVKRM",4,0)
RO(OPT) ; Record option resource usage in ^XTMP("KMPR","JOB"
"RTN","ZOSVKRM",5,0)
 ;
"RTN","ZOSVKRM",6,0)
 N KMPRTYP S KMPRTYP=0  ; option
"RTN","ZOSVKRM",7,0)
 G EN
"RTN","ZOSVKRM",8,0)
 ;
"RTN","ZOSVKRM",9,0)
RP(PRTCL) ; Record protocol resource usage in ^XTMP("KMPR","JOB"
"RTN","ZOSVKRM",10,0)
 ;
"RTN","ZOSVKRM",11,0)
 ; Variable PRTCL = option_name^protocol_name
"RTN","ZOSVKRM",12,0)
 S OPT=$P(PRTCL,"^"),PRTCL=$P(PRTCL,"^",2) Q:PRTCL=""
"RTN","ZOSVKRM",13,0)
 N KMPRTYP S KMPRTYP=1  ; protocol
"RTN","ZOSVKRM",14,0)
 Q
"RTN","ZOSVKRM",15,0)
 ;
"RTN","ZOSVKRM",16,0)
RU(KMPROPT,KMPRTYP,KMPRSTAT) ;-- record resource usage in ^XTMP("KMPR","JOB"
"RTN","ZOSVKRM",17,0)
 Q
"RTN","ZOSVKRM",18,0)
 ;
"RTN","ZOSVKRM",19,0)
EN ;
"RTN","ZOSVKRM",20,0)
 Q
"RTN","ZOSVKRO")
0^2^B15510038
"RTN","ZOSVKRO",1,0)
%ZOSVKR ;SF/KAK - Collect RUM Statistics for OpenM/Cache;8/20/99  08:43  ;3/27/00  11:24
"RTN","ZOSVKRO",2,0)
 ;;8.0;KERNEL;**90,94,107,122,143**;Jul 21, 1998
"RTN","ZOSVKRO",3,0)
 ;
"RTN","ZOSVKRO",4,0)
RO(OPT) ; Record option resource usage in ^XTMP("KMPR","JOB"
"RTN","ZOSVKRO",5,0)
 ;
"RTN","ZOSVKRO",6,0)
 N KMPRTYP S KMPRTYP=0  ; option
"RTN","ZOSVKRO",7,0)
 G EN
"RTN","ZOSVKRO",8,0)
 ;
"RTN","ZOSVKRO",9,0)
RP(PRTCL)       ; Record protocol resource usage in ^XTMP("KMPR","JOB"
"RTN","ZOSVKRO",10,0)
 ;
"RTN","ZOSVKRO",11,0)
 ; Variable PRTCL = option_name^protocol_name
"RTN","ZOSVKRO",12,0)
 N OPT,KMPRTYP
"RTN","ZOSVKRO",13,0)
 S OPT=$P(PRTCL,"^"),PRTCL=$P(PRTCL,"^",2) Q:PRTCL=""
"RTN","ZOSVKRO",14,0)
 ; protocol
"RTN","ZOSVKRO",15,0)
 S KMPRTYP=1
"RTN","ZOSVKRO",16,0)
 G EN
"RTN","ZOSVKRO",17,0)
 ;
"RTN","ZOSVKRO",18,0)
RU(KMPROPT,KMPRTYP,KMPRSTAT)    ;-- record resource usage in ^XTMP("KMPR","JOB"
"RTN","ZOSVKRO",19,0)
 ;---------------------------------------------------------------------
"RTN","ZOSVKRO",20,0)
 ; KMPROPT... Option name (may be option, protocol, rpc, etc.).
"RTN","ZOSVKRO",21,0)
 ; KMPRTYP... Type of option:
"RTN","ZOSVKRO",22,0)
 ;              0 - Option.
"RTN","ZOSVKRO",23,0)
 ;              1 - Protocol.
"RTN","ZOSVKRO",24,0)
 ;              2 - RPC (Remote Procedure Call).
"RTN","ZOSVKRO",25,0)
 ;              3 - HL7.
"RTN","ZOSVKRO",26,0)
 ; KMPRSTAT.. Status (for future use). 1 - start
"RTN","ZOSVKRO",27,0)
 ;                                     2 - stop
"RTN","ZOSVKRO",28,0)
 ;---------------------------------------------------------------------
"RTN","ZOSVKRO",29,0)
 ;
"RTN","ZOSVKRO",30,0)
 Q:$G(KMPROPT)=""
"RTN","ZOSVKRO",31,0)
 S KMPRTYP=+$G(KMPRTYP)
"RTN","ZOSVKRO",32,0)
 S KMPRSTAT=$G(KMPRSTAT)
"RTN","ZOSVKRO",33,0)
 ;
"RTN","ZOSVKRO",34,0)
 N OPT,PRTCL
"RTN","ZOSVKRO",35,0)
 ;
"RTN","ZOSVKRO",36,0)
 ; OPT = option name.
"RTN","ZOSVKRO",37,0)
 ; PRTCL = protocol name (optional).
"RTN","ZOSVKRO",38,0)
 S OPT=$P(KMPROPT,"^"),PRTCL=$P(KMPROPT,"^",2)
"RTN","ZOSVKRO",39,0)
 ;
"RTN","ZOSVKRO",40,0)
EN ;
"RTN","ZOSVKRO",41,0)
 ; C........ comma (,)
"RTN","ZOSVKRO",42,0)
 ; CURRENT.. current stats
"RTN","ZOSVKRO",43,0)
 ; DATE..... date in fileman format
"RTN","ZOSVKRO",44,0)
 ; DIFF..... difference (CURRENT minus PREV)
"RTN","ZOSVKRO",45,0)
 ; DOW...... day of week
"RTN","ZOSVKRO",46,0)
 ; HDATE.... date/time in $h format
"RTN","ZOSVKRO",47,0)
 ; NODE..... current node
"RTN","ZOSVKRO",48,0)
 ; PRIMETM.. prime time or non-prime time
"RTN","ZOSVKRO",49,0)
 ; PREV..... previous stats
"RTN","ZOSVKRO",50,0)
 ;
"RTN","ZOSVKRO",51,0)
 N C,CURRENT,CURRHR,DATE,DIFF,DOW,HDATE,I,NODE,PREV,PREVHR
"RTN","ZOSVKRO",52,0)
 N PRIMETM,TIME,Y
"RTN","ZOSVKRO",53,0)
 ; quit if not in "PROD" uci.
"RTN","ZOSVKRO",54,0)
 S Y="" X $G(^%ZOSF("UCI")) Q:Y'[$G(^%ZOSF("PROD"))
"RTN","ZOSVKRO",55,0)
 D GETENV^%ZOSV S NODE=$P(Y,"^",3)
"RTN","ZOSVKRO",56,0)
 S C=",",U="^"
"RTN","ZOSVKRO",57,0)
 I KMPRTYP I OPT="" S:$P($G(^XTMP("KMPR","JOB",NODE,$J)),U,10)["$LOGIN$" OPT="$LOGIN$"
"RTN","ZOSVKRO",58,0)
 I OPT="" Q:'+$G(^XUTL("XQ",$J,"T"))  S OPT=$P($G(^XUTL("XQ",$J,^XUTL("XQ",$J,"T"))),U,2) Q:OPT=""
"RTN","ZOSVKRO",59,0)
 ;
"RTN","ZOSVKRO",60,0)
 ; CURRENT = current stats for this $job.
"RTN","ZOSVKRO",61,0)
 ; cpu^dio^bio^pg_fault^cmd^glo^$H_date^$H_sec^ascii_time
"RTN","ZOSVKRO",62,0)
 S CURRENT=$$STATS Q:CURRENT=""
"RTN","ZOSVKRO",63,0)
 ; concatenate ^OPTion^option_type
"RTN","ZOSVKRO",64,0)
 S CURRENT=CURRENT_U_$S(KMPRTYP=2:"`"_OPT,KMPRTYP=3:"&"_OPT,1:OPT)_"***"_$G(PRTCL)_U_$G(XQT)
"RTN","ZOSVKRO",65,0)
 ; if option and login or taskman
"RTN","ZOSVKRO",66,0)
 I 'KMPRTYP I OPT="$LOGIN$"!(OPT="$STRT ZTMS$") S ^XTMP("KMPR","JOB",NODE,$J)=CURRENT Q
"RTN","ZOSVKRO",67,0)
 ; if logout or stopping task or programmer mode
"RTN","ZOSVKRO",68,0)
 I OPT="$LOGOUT$"!(OPT="$STOP ZTMS$")!(OPT="XUPROGMODE") K ^XTMP("KMPR","JOB",NODE,$J)
"RTN","ZOSVKRO",69,0)
 ;
"RTN","ZOSVKRO",70,0)
 ; PREV = previous stats for this $job.
"RTN","ZOSVKRO",71,0)
 S PREV=$G(^XTMP("KMPR","JOB",NODE,$J)) S ^($J)=CURRENT
"RTN","ZOSVKRO",72,0)
 Q:PREV=""
"RTN","ZOSVKRO",73,0)
 ;
"RTN","ZOSVKRO",74,0)
 ; check for negative numbers for m commands and glo references
"RTN","ZOSVKRO",75,0)
 F I=5,6 D 
"RTN","ZOSVKRO",76,0)
 .S:$P(CURRENT,U,I)<0 $P(CURRENT,U,I)=$P(CURRENT,U,I)+(2**32)
"RTN","ZOSVKRO",77,0)
 .S:$P(PREV,U,I)<0 $P(PREV,U,I)=$P(PREV,U,I)+(2**32)
"RTN","ZOSVKRO",78,0)
 ;
"RTN","ZOSVKRO",79,0)
 S $P(CURRENT,U,7)=$P(CURRENT,U,7)-$P(PREV,U,7)*86400+$P(CURRENT,U,8)
"RTN","ZOSVKRO",80,0)
 S HDATE=$P(PREV,U,7),$P(PREV,U,7)=$P(PREV,U,8)
"RTN","ZOSVKRO",81,0)
 ; quit if not $h
"RTN","ZOSVKRO",82,0)
 Q:'HDATE
"RTN","ZOSVKRO",83,0)
 ;
"RTN","ZOSVKRO",84,0)
 ; DIFF = CURRENT - PREV (current stats minus previous stats)
"RTN","ZOSVKRO",85,0)
 ; cpu^dio^bio^pg_fault^cmd^glo^elapsed_sec^option_type
"RTN","ZOSVKRO",86,0)
 F I=1:1:7 S $P(DIFF,U,I)=$P(CURRENT,U,I)-$P(PREV,U,I)
"RTN","ZOSVKRO",87,0)
 ; option name        time
"RTN","ZOSVKRO",88,0)
 S OPT=$P(PREV,U,10),TIME=$P($P(PREV,U,8),".")
"RTN","ZOSVKRO",89,0)
 ; date in fm format.
"RTN","ZOSVKRO",90,0)
 S DATE=$$HTFM^XLFDT(HDATE),DATE=$P(DATE,".")
"RTN","ZOSVKRO",91,0)
 ; day of week.
"RTN","ZOSVKRO",92,0)
 S DOW=$$DOW^XLFDT(DATE,1)
"RTN","ZOSVKRO",93,0)
 ; PRIMETM =  0: non-prime time
"RTN","ZOSVKRO",94,0)
 ;            1: prime time
"RTN","ZOSVKRO",95,0)
 S PRIMETM=0
"RTN","ZOSVKRO",96,0)
 ; prime time if not saturday or sunday or holiday
"RTN","ZOSVKRO",97,0)
 ;            if after 8am and before 5pm.
"RTN","ZOSVKRO",98,0)
 I DOW>0&(DOW<6)&('$G(^HOLIDAY(DATE,0))) I TIME>28799&(TIME<61201) S PRIMETM=1
"RTN","ZOSVKRO",99,0)
 ; daily stats by $j.
"RTN","ZOSVKRO",100,0)
 F I=1:1:7 S $P(^XTMP("KMPR","DLY",NODE,HDATE,OPT,$J,PRIMETM),U,I)=$P($G(^XTMP("KMPR","DLY",NODE,HDATE,OPT,$J,PRIMETM)),U,I)+$P(DIFF,U,I)
"RTN","ZOSVKRO",101,0)
 ; 8th piece is count.
"RTN","ZOSVKRO",102,0)
 S $P(^XTMP("KMPR","DLY",NODE,HDATE,OPT,$J,PRIMETM),U,8)=$P(^XTMP("KMPR","DLY",NODE,HDATE,OPT,$J,PRIMETM),U,8)+1
"RTN","ZOSVKRO",103,0)
 ;
"RTN","ZOSVKRO",104,0)
 ; keep track of hours with activity - this will be used to determine
"RTN","ZOSVKRO",105,0)
 ; actual hours of activity when moving data to file 8971.1
"RTN","ZOSVKRO",106,0)
 S DATE=$$HTFM^XLFDT(HDATE_","_TIME)
"RTN","ZOSVKRO",107,0)
 ;S TIME=+$E($P(DATE,".",2),1,2),DATE=$P(DATE,".")
"RTN","ZOSVKRO",108,0)
 ; hour for 'previous' dat.
"RTN","ZOSVKRO",109,0)
 S PREVHR=+$E($P(DATE,".",2),1,2),DATE=$P(DATE,".")
"RTN","ZOSVKRO",110,0)
 ; current hour.
"RTN","ZOSVKRO",111,0)
 S CURRHR=+$E($P($$HTFM^XLFDT($H),".",2),1,2)
"RTN","ZOSVKRO",112,0)
 ; record all hours this option ran.
"RTN","ZOSVKRO",113,0)
 F TIME=PREVHR:1:CURRHR D 
"RTN","ZOSVKRO",114,0)
 .; because of zero hour add 1 to time - will offset each hour by 1
"RTN","ZOSVKRO",115,0)
 .S:DATE $P(^XTMP("KMPR","HOURS",DATE,NODE),U,(TIME+1))=1
"RTN","ZOSVKRO",116,0)
 ;
"RTN","ZOSVKRO",117,0)
 Q
"RTN","ZOSVKRO",118,0)
 ;
"RTN","ZOSVKRO",119,0)
STATS() ;-- extrinsic - return current stats for this $job
"RTN","ZOSVKRO",120,0)
 ;
"RTN","ZOSVKRO",121,0)
 N V
"RTN","ZOSVKRO",122,0)
 S V=$V(-1,$J)
"RTN","ZOSVKRO",123,0)
 ; current stats for this $job.
"RTN","ZOSVKRO",124,0)
 ; cpu^dio^bio^pg_fault^cmd^glo^$H_date^$H_sec^time in thousands
"RTN","ZOSVKRO",125,0)
 Q "^^^^"_$P($P(V,"^",7),",")_"^"_$P($P(V,"^",7),",",2)_"^"_+$H_"^"_$P($H,",",2)_"^"_$ZTIMESTAMP
"RTN","ZOSVKRV")
0^3^B23577094
"RTN","ZOSVKRV",1,0)
%ZOSVKR ;SF/KAK/RAK - Collect RUM Statistics for VAX-DSM;8/20/99  08:44 ;3/10/00  07:42
"RTN","ZOSVKRV",2,0)
 ;;8.0;KERNEL;**90,94,107,122,143**;Jul 21, 1998
"RTN","ZOSVKRV",3,0)
 ;
"RTN","ZOSVKRV",4,0)
RO(OPT) ; Record option resource usage in ^XTMP("KMPR","JOB"
"RTN","ZOSVKRV",5,0)
 ;
"RTN","ZOSVKRV",6,0)
 N KMPRTYP S KMPRTYP=0  ; option
"RTN","ZOSVKRV",7,0)
 G EN
"RTN","ZOSVKRV",8,0)
 ;
"RTN","ZOSVKRV",9,0)
RP(PRTCL) ; Record protocol resource usage in ^XTMP("KMPR","JOB"
"RTN","ZOSVKRV",10,0)
 ;
"RTN","ZOSVKRV",11,0)
 ; Variable PRTCL = option_name^protocol_name
"RTN","ZOSVKRV",12,0)
 N OPT
"RTN","ZOSVKRV",13,0)
 S OPT=$P(PRTCL,"^"),PRTCL=$P(PRTCL,"^",2) Q:PRTCL=""
"RTN","ZOSVKRV",14,0)
 N KMPRTYP S KMPRTYP=1  ; protocol
"RTN","ZOSVKRV",15,0)
 G EN
"RTN","ZOSVKRV",16,0)
 ;
"RTN","ZOSVKRV",17,0)
RU(KMPROPT,KMPRTYP,KMPRSTAT) ;-- set resource usage into ^XTMP("KMPR","JOB"
"RTN","ZOSVKRV",18,0)
 ;-----------------------------------------------------------------------
"RTN","ZOSVKRV",19,0)
 ; KMPROPT... Option name (may be option, protocol, rpc, etc.).
"RTN","ZOSVKRV",20,0)
 ; KMPRTYP... Type of option:
"RTN","ZOSVKRV",21,0)
 ;              0 - Option.
"RTN","ZOSVKRV",22,0)
 ;              1 - Protocol.
"RTN","ZOSVKRV",23,0)
 ;              2 - RPC (Remote Procedure Call).
"RTN","ZOSVKRV",24,0)
 ;              3 - HL7.
"RTN","ZOSVKRV",25,0)
 ; KMPRSTAT.. Status (for future use). 1 - start
"RTN","ZOSVKRV",26,0)
 ;                                     2 - stop
"RTN","ZOSVKRV",27,0)
 ;-----------------------------------------------------------------------
"RTN","ZOSVKRV",28,0)
 ;
"RTN","ZOSVKRV",29,0)
 Q:$G(KMPROPT)=""
"RTN","ZOSVKRV",30,0)
 S KMPRTYP=+$G(KMPRTYP)
"RTN","ZOSVKRV",31,0)
 S KMPRSTAT=$G(KMPRSTAT)
"RTN","ZOSVKRV",32,0)
 ;
"RTN","ZOSVKRV",33,0)
 N OPT,PRTCL
"RTN","ZOSVKRV",34,0)
 ; 
"RTN","ZOSVKRV",35,0)
 ; OPT = option name.
"RTN","ZOSVKRV",36,0)
 ; PRTCL = protocol name (optional).
"RTN","ZOSVKRV",37,0)
 S OPT=$P(KMPROPT,"^"),PRTCL=$P(KMPROPT,"^",2)
"RTN","ZOSVKRV",38,0)
 ;
"RTN","ZOSVKRV",39,0)
EN ;
"RTN","ZOSVKRV",40,0)
 ; C........ comma (,)
"RTN","ZOSVKRV",41,0)
 ; CURRENT.. current stats
"RTN","ZOSVKRV",42,0)
 ; DATE..... date in fileman format
"RTN","ZOSVKRV",43,0)
 ; DIFF..... difference (CURRENT minus PREV)
"RTN","ZOSVKRV",44,0)
 ; DOW...... day of week
"RTN","ZOSVKRV",45,0)
 ; HDATE.... date/time in $h format
"RTN","ZOSVKRV",46,0)
 ; NODE..... current node
"RTN","ZOSVKRV",47,0)
 ; PRIMETM.. prime time or non-prime time
"RTN","ZOSVKRV",48,0)
 ; PREV..... previous stats
"RTN","ZOSVKRV",49,0)
 ;
"RTN","ZOSVKRV",50,0)
 N ARRAY,C,CURRENT,CURRHR,DATE,DIFF,DOW,HDATE,I,NODE,PREV,PREVHR
"RTN","ZOSVKRV",51,0)
 N PRIMETM,TIME,Y
"RTN","ZOSVKRV",52,0)
 ; quit if not in "PROD" uci.
"RTN","ZOSVKRV",53,0)
 S Y="" X $G(^%ZOSF("UCI")) Q:Y'[$G(^%ZOSF("PROD"))
"RTN","ZOSVKRV",54,0)
 S C=",",NODE=$P($ZC(%GETSYI),C,4),U="^"
"RTN","ZOSVKRV",55,0)
 I KMPRTYP I OPT="" S:$P($G(^XTMP("KMPR","JOB",NODE,$J)),U,10)["$LOGIN$" OPT="$LOGIN$"
"RTN","ZOSVKRV",56,0)
 I OPT="" Q:'+$G(^XUTL("XQ",$J,"T"))  S OPT=$P($G(^XUTL("XQ",$J,^XUTL("XQ",$J,"T"))),U,2) Q:OPT=""
"RTN","ZOSVKRV",57,0)
 ;
"RTN","ZOSVKRV",58,0)
 ; CURRENT = current stats for this $job.
"RTN","ZOSVKRV",59,0)
 ; cpu^dio^bio^pg_fault^cmd^glo^$H_date^$H_sec^ascii_time
"RTN","ZOSVKRV",60,0)
 S CURRENT=$$STATS Q:CURRENT=""
"RTN","ZOSVKRV",61,0)
 ; concatenate ^OPTion^option_type
"RTN","ZOSVKRV",62,0)
 S CURRENT=CURRENT_U_$S(KMPRTYP=2:"`"_OPT,KMPRTYP=3:"&"_OPT,1:OPT)_"***"_$G(PRTCL)_U_$G(XQT)
"RTN","ZOSVKRV",63,0)
 ; if option and login or taskman.
"RTN","ZOSVKRV",64,0)
 I 'KMPRTYP I OPT="$LOGIN$"!(OPT="$STRT ZTMS$") S ^XTMP("KMPR","JOB",NODE,$J)=CURRENT Q
"RTN","ZOSVKRV",65,0)
 ;
"RTN","ZOSVKRV",66,0)
 ; PREV = previous stats for this $job.
"RTN","ZOSVKRV",67,0)
 S PREV=$G(^XTMP("KMPR","JOB",NODE,$J)) S ^($J)=CURRENT
"RTN","ZOSVKRV",68,0)
 I OPT="$LOGOUT$"!(OPT="$STOP ZTMS$")!(OPT="XUPROGMODE") K ^XTMP("KMPR","JOB",NODE,$J)
"RTN","ZOSVKRV",69,0)
 Q:PREV=""
"RTN","ZOSVKRV",70,0)
 ; check for negative numbers for m commands and glo references
"RTN","ZOSVKRV",71,0)
 F I=5,6 D 
"RTN","ZOSVKRV",72,0)
 .S:$P(CURRENT,U,I)<0 $P(CURRENT,U,I)=$P(CURRENT,U,I)+(2**32)
"RTN","ZOSVKRV",73,0)
 .S:$P(PREV,U,I)<0 $P(PREV,U,I)=$P(PREV,U,I)+(2**32)
"RTN","ZOSVKRV",74,0)
 ;
"RTN","ZOSVKRV",75,0)
 S $P(CURRENT,U,7)=$P(CURRENT,U,7)-$P(PREV,U,7)*86400+$P(CURRENT,U,8)
"RTN","ZOSVKRV",76,0)
 S HDATE=$P(PREV,U,7),$P(PREV,U,7)=$P(PREV,U,8)
"RTN","ZOSVKRV",77,0)
 ; quit if not $h
"RTN","ZOSVKRV",78,0)
 Q:'HDATE
"RTN","ZOSVKRV",79,0)
 ;
"RTN","ZOSVKRV",80,0)
 ; DIFF = CURRENT - PREV (current stats minus previous stats)
"RTN","ZOSVKRV",81,0)
 ; cpu^dio^bio^pg_fault^cmd^glo^elapsed_sec^option_type
"RTN","ZOSVKRV",82,0)
 F I=1:1:7 S $P(DIFF,U,I)=$P(CURRENT,U,I)-$P(PREV,U,I)
"RTN","ZOSVKRV",83,0)
 ; option name        time
"RTN","ZOSVKRV",84,0)
 S OPT=$P(PREV,U,10),TIME=$P($P(PREV,U,8),".")
"RTN","ZOSVKRV",85,0)
 ; date in fm format.
"RTN","ZOSVKRV",86,0)
 S DATE=$$HTFM^XLFDT(HDATE),DATE=$P(DATE,".")
"RTN","ZOSVKRV",87,0)
 ; day of week.
"RTN","ZOSVKRV",88,0)
 S DOW=$$DOW^XLFDT(DATE,1)
"RTN","ZOSVKRV",89,0)
 ; PRIMETM =  0: non-prime time
"RTN","ZOSVKRV",90,0)
 ;            1: prime time
"RTN","ZOSVKRV",91,0)
 S PRIMETM=0
"RTN","ZOSVKRV",92,0)
 ; prime time if not saturday or sunday or holiday
"RTN","ZOSVKRV",93,0)
 ;            if after 8am and before 5pm.
"RTN","ZOSVKRV",94,0)
 I DOW>0&(DOW<6)&('$G(^HOLIDAY(DATE,0))) I TIME>28799&(TIME<61201) S PRIMETM=1
"RTN","ZOSVKRV",95,0)
 ; global location for data storage.
"RTN","ZOSVKRV",96,0)
 S ARRAY=$NA(^XTMP("KMPR","DLY",NODE,HDATE,OPT,$J,PRIMETM))
"RTN","ZOSVKRV",97,0)
 ; daily stats by $j.
"RTN","ZOSVKRV",98,0)
 F I=1:1:7 S $P(@ARRAY,U,I)=$P($G(@ARRAY),U,I)+$P(DIFF,U,I)
"RTN","ZOSVKRV",99,0)
 ; 8th piece is count.
"RTN","ZOSVKRV",100,0)
 S $P(@ARRAY,U,8)=$P(@ARRAY,U,8)+1
"RTN","ZOSVKRV",101,0)
 ; keep track of hours with activity - this will be used to determine
"RTN","ZOSVKRV",102,0)
 ; actual hours of activity when moving data to file 8971.1
"RTN","ZOSVKRV",103,0)
 S DATE=$$HTFM^XLFDT(HDATE_","_TIME)
"RTN","ZOSVKRV",104,0)
 ;S TIME=+$E($P(DATE,".",2),1,2),DATE=$P(DATE,".")
"RTN","ZOSVKRV",105,0)
 ; hour for 'previous' dat.
"RTN","ZOSVKRV",106,0)
 S PREVHR=+$E($P(DATE,".",2),1,2),DATE=$P(DATE,".")
"RTN","ZOSVKRV",107,0)
 ; current hour.
"RTN","ZOSVKRV",108,0)
 S CURRHR=+$E($P($$HTFM^XLFDT($H),".",2),1,2)
"RTN","ZOSVKRV",109,0)
 ; record all hours this option ran.
"RTN","ZOSVKRV",110,0)
 F TIME=PREVHR:1:CURRHR D 
"RTN","ZOSVKRV",111,0)
 .; because of zero hour add 1 to time.  this will offset each hour by 1.
"RTN","ZOSVKRV",112,0)
 .S:DATE $P(^XTMP("KMPR","HOURS",DATE,NODE),U,(TIME+1))=1
"RTN","ZOSVKRV",113,0)
 ;
"RTN","ZOSVKRV",114,0)
 Q
"RTN","ZOSVKRV",115,0)
 ;
"RTN","ZOSVKRV",116,0)
STATS() ;-- extrinsic - return current stats for this $job
"RTN","ZOSVKRV",117,0)
 N C,H,KMPRCMD,KMPRGLO,ZH
"RTN","ZOSVKRV",118,0)
 S C="," ;,ZH=$ZH,H=$P(ZH,C,3)
"RTN","ZOSVKRV",119,0)
 D JT
"RTN","ZOSVKRV",120,0)
 Q:KMPRCMD="" ""
"RTN","ZOSVKRV",121,0)
 S ZH=$ZH,H=$P(ZH,C,3),H=$E(H,13,23),H=$P($H,C)_C_($P(H,":")*3600+($P(H,":",2)*60)+$P(H,":",3))
"RTN","ZOSVKRV",122,0)
 ;
"RTN","ZOSVKRV",123,0)
 ; current stats for this $job.
"RTN","ZOSVKRV",124,0)
 ; cpu^dio^bio^pg_fault^cmd^glo^$H_date^$H_sec^ascii_time
"RTN","ZOSVKRV",125,0)
 Q $P(ZH,C)_U_$P(ZH,C,7)_U_$P(ZH,C,8)_U_$P(ZH,C,4)_U_KMPRCMD_U_KMPRGLO_U_$P(H,C)_U_$P(H,C,2)_U_$P(ZH,C,3)
"RTN","ZOSVKRV",126,0)
 ;
"RTN","ZOSVKRV",127,0)
JT ; Calculate the Job Table (%KMPRJT) for this job
"RTN","ZOSVKRV",128,0)
 ; %KMPRJT should be made a system wide variable
"RTN","ZOSVKRV",129,0)
 ;
"RTN","ZOSVKRV",130,0)
 N %GLSBASE,%JOB,%JOBSIZ,%JOBTAB,%MAXPROC,%PID,%SMSTART,%TYPE,KMPROUT,X
"RTN","ZOSVKRV",131,0)
 ;
"RTN","ZOSVKRV",132,0)
 ; Return the current number of commands and global references
"RTN","ZOSVKRV",133,0)
 ; KMPRCMD and KMPRGLO equal to null if NOT successful
"RTN","ZOSVKRV",134,0)
 S (KMPRCMD,KMPRGLO)="",KMPROUT=0,U="^"
"RTN","ZOSVKRV",135,0)
 ;
"RTN","ZOSVKRV",136,0)
 ; Check for correct Job Table (%KMPRJT) for this job
"RTN","ZOSVKRV",137,0)
 I $D(%KMPRJT) I $V(%KMPRJT+20)=$J S %TYPE="DSM" D USER G EXIT
"RTN","ZOSVKRV",138,0)
 S %SMSTART=$V($ZK(GLS$SMSTART)) G:'%SMSTART EXIT
"RTN","ZOSVKRV",139,0)
 S %GLSBASE=$V($V(0)+44)
"RTN","ZOSVKRV",140,0)
 S %JOBTAB=%SMSTART+$V(%SMSTART+$V(%GLSBASE+124)),%JOBSIZ=$V(%GLSBASE+128)
"RTN","ZOSVKRV",141,0)
 S %MAXPROC=$V($V(%GLSBASE+84)+%SMSTART)
"RTN","ZOSVKRV",142,0)
 ;
"RTN","ZOSVKRV",143,0)
 ; Go through Job Table looking for this process
"RTN","ZOSVKRV",144,0)
 F %JOB=1:1:%MAXPROC Q:KMPROUT  S %KMPRJT=%JOB*%JOBSIZ+%JOBTAB D
"RTN","ZOSVKRV",145,0)
 .I $V(%KMPRJT+20) S %PID=$V(%KMPRJT+20),%TYPE="DSM" I %PID=$J D USER S KMPROUT=1
"RTN","ZOSVKRV",146,0)
 ;
"RTN","ZOSVKRV",147,0)
EXIT ;
"RTN","ZOSVKRV",148,0)
 S X=^%ZOSF("ERRTN"),@^%ZOSF("TRAP")
"RTN","ZOSVKRV",149,0)
 Q
"RTN","ZOSVKRV",150,0)
 ;
"RTN","ZOSVKRV",151,0)
USER ;
"RTN","ZOSVKRV",152,0)
 ; Watch for NONEXPR process
"RTN","ZOSVKRV",153,0)
 S X="UERR^%ZOSVKR",@^%ZOSF("TRAP")
"RTN","ZOSVKRV",154,0)
 ;
"RTN","ZOSVKRV",155,0)
 ; Process improperly exited DSM
"RTN","ZOSVKRV",156,0)
 I %TYPE="DSM",$V(%KMPRJT+$ZK(JOB_B_FLAGS),-1,1)\$ZK(JOB_M_EXITED)#2 G IMPROP
"RTN","ZOSVKRV",157,0)
 ;
"RTN","ZOSVKRV",158,0)
 ; Get commands and global references from job table
"RTN","ZOSVKRV",159,0)
 S KMPRCMD=$V(%KMPRJT),KMPRGLO=$V(%KMPRJT+12)
"RTN","ZOSVKRV",160,0)
 Q
"RTN","ZOSVKRV",161,0)
UERR ;
"RTN","ZOSVKRV",162,0)
 ; Ignore NONEXPR (improperly exited DSM process) and SUSPENDED process
"RTN","ZOSVKRV",163,0)
 I $ZE["NONEXPR"!($ZE["SUSPENDED") Q
"RTN","ZOSVKRV",164,0)
 ZQ
"RTN","ZOSVKRV",165,0)
IMPROP ;
"RTN","ZOSVKRV",166,0)
 ; Ignore improperly exited DSM process
"RTN","ZOSVKRV",167,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
KMPR*1.0*2
"BLD",1251,0)
KMPR*1.0*2^CAPACITY MANAGEMENT - RUM^0^3000328^y
"BLD",1251,1,0)
^^1^1^3000328^
"BLD",1251,1,1,0)
Enable RUM for OpenM/Cache.
"BLD",1251,4,0)
^9.64PA^^
"BLD",1251,"INIT")

"BLD",1251,"KRN",0)
^9.67PA^19^18
"BLD",1251,"KRN",.4,0)
.4
"BLD",1251,"KRN",.401,0)
.401
"BLD",1251,"KRN",.402,0)
.402
"BLD",1251,"KRN",.403,0)
.403
"BLD",1251,"KRN",.5,0)
.5
"BLD",1251,"KRN",.84,0)
.84
"BLD",1251,"KRN",3.6,0)
3.6
"BLD",1251,"KRN",3.8,0)
3.8
"BLD",1251,"KRN",9.2,0)
9.2
"BLD",1251,"KRN",9.8,0)
9.8
"BLD",1251,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",1251,"KRN",9.8,"NM",1,0)
KMPRPOST^^0^B361401
"BLD",1251,"KRN",9.8,"NM",2,0)
KMPRSS^^0^B12342366
"BLD",1251,"KRN",9.8,"NM",3,0)
KMPRUTL^^0^B18257077
"BLD",1251,"KRN",9.8,"NM",4,0)
KMPRUTL1^^0^B12571358
"BLD",1251,"KRN",9.8,"NM","B","KMPRPOST",1)

"BLD",1251,"KRN",9.8,"NM","B","KMPRSS",2)

"BLD",1251,"KRN",9.8,"NM","B","KMPRUTL",3)

"BLD",1251,"KRN",9.8,"NM","B","KMPRUTL1",4)

"BLD",1251,"KRN",19,0)
19
"BLD",1251,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",1251,"KRN",19,"NM",1,0)
KMPR RUM MANAGER MENU^^3
"BLD",1251,"KRN",19,"NM","B","KMPR RUM MANAGER MENU",1)

"BLD",1251,"KRN",19.1,0)
19.1
"BLD",1251,"KRN",101,0)
101
"BLD",1251,"KRN",409.61,0)
409.61
"BLD",1251,"KRN",771,0)
771
"BLD",1251,"KRN",869.2,0)
869.2
"BLD",1251,"KRN",870,0)
870
"BLD",1251,"KRN",8994,0)
8994
"BLD",1251,"KRN","B",.4,.4)

"BLD",1251,"KRN","B",.401,.401)

"BLD",1251,"KRN","B",.402,.402)

"BLD",1251,"KRN","B",.403,.403)

"BLD",1251,"KRN","B",.5,.5)

"BLD",1251,"KRN","B",.84,.84)

"BLD",1251,"KRN","B",3.6,3.6)

"BLD",1251,"KRN","B",3.8,3.8)

"BLD",1251,"KRN","B",9.2,9.2)

"BLD",1251,"KRN","B",9.8,9.8)

"BLD",1251,"KRN","B",19,19)

"BLD",1251,"KRN","B",19.1,19.1)

"BLD",1251,"KRN","B",101,101)

"BLD",1251,"KRN","B",409.61,409.61)

"BLD",1251,"KRN","B",771,771)

"BLD",1251,"KRN","B",869.2,869.2)

"BLD",1251,"KRN","B",870,870)

"BLD",1251,"KRN","B",8994,8994)

"BLD",1251,"PRET")

"BLD",1251,"QUES",0)
^9.62^^
"BLD",1251,"REQB",0)
^9.611^2^2
"BLD",1251,"REQB",1,0)
XU*8.0*122^1
"BLD",1251,"REQB",2,0)
KMPR*1.0*1^1
"BLD",1251,"REQB","B","KMPR*1.0*1",2)

"BLD",1251,"REQB","B","XU*8.0*122",1)

"KRN",19,14865,-1)
3^1
"KRN",19,14865,0)
KMPR RUM MANAGER MENU^RUM Manager Menu^^M^^^^^^^^CAPACITY MANAGEMENT - RUM^^1
"KRN",19,14865,1,0)
^^2^2^2981124^^^^
"KRN",19,14865,1,1,0)
This menu will help the site to manage the Resource Usage Monitor (RUM)
"KRN",19,14865,1,2,0)
component of Capacity Management monitoring tools.
"KRN",19,14865,10,0)
^19.01IP^7^7
"KRN",19,14865,20)
N IORVOFF,IORVON,Z D ZIS^KMPRUTL W @IOF,!,?25,IORVON,"* Resource Usage Monitor "_$P($$VERSION^KMPRUTL,U)_" *",IORVOFF,!! D ENVCHECK^KMPRUTL1(.Z,1) W:+Z=100 !!?(80-$L(Z)\2),$C(7),IORVON," *** ",$P(Z,U,2)," *** ",IORVOFF
"KRN",19,14865,99)
58115,47800
"KRN",19,14865,99.1)
57691,66026
"KRN",19,14865,"U")
RUM MANAGER MENU
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",561,-1)
1^1
"PKG",561,0)
CAPACITY MANAGEMENT - RUM^KMPR^Capacity Management - Resource Usage Monitor
"PKG",561,20,0)
^9.402P^^
"PKG",561,22,0)
^9.49I^1^1
"PKG",561,22,1,0)
1.0^2981209^3000211^102426
"PKG",561,22,1,"PAH",1,0)
2^3000328^103137
"PKG",561,22,1,"PAH",1,1,0)
^^1^1^3000328
"PKG",561,22,1,"PAH",1,1,1,0)
Enable RUM for OpenM/Cache.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","KMPRPOST")
0^1^B361401
"RTN","KMPRPOST",1,0)
KMPRPOST ;SF/RAK - RUM Post Install Routine ;3/27/00  10:56
"RTN","KMPRPOST",2,0)
 ;;1.0;CAPACITY MANAGEMENT - RUM;**1,2**;Dec 09, 1998
"RTN","KMPRPOST",3,0)
 ;;
"RTN","KMPRPOST",4,0)
 ;
"RTN","KMPRPOST",5,0)
 ; This post install routine is for RUM patch KMPR*1.0*2
"RTN","KMPRPOST",6,0)
 ;
"RTN","KMPRPOST",7,0)
EN ;-- entry point.
"RTN","KMPRPOST",8,0)
 ;
"RTN","KMPRPOST",9,0)
 N IEN
"RTN","KMPRPOST",10,0)
 ; get ien for backgroung job.
"RTN","KMPRPOST",11,0)
 S IEN=$O(^DIC(19,"B","KMPR BACKGROUND DRIVER",0)) Q:'IEN
"RTN","KMPRPOST",12,0)
 ; get ien for background driver from 'option scheduling' file.
"RTN","KMPRPOST",13,0)
 S IEN=$O(^DIC(19.2,"B",+IEN,0))
"RTN","KMPRPOST",14,0)
 ; if scheduled then no further action necessary
"RTN","KMPRPOST",15,0)
 Q:IEN
"RTN","KMPRPOST",16,0)
 ; if OptenM/Cache then schedule background driver
"RTN","KMPRPOST",17,0)
 D:$P($G(^%ZOSF("OS")),"^")["OpenM" QUEBKG^KMPRUTL1
"RTN","KMPRPOST",18,0)
 ;
"RTN","KMPRPOST",19,0)
 Q
"RTN","KMPRSS")
0^2^B12342366
"RTN","KMPRSS",1,0)
KMPRSS ;SFISC/KAK/RAK - Resource Usage Monitor Status ;3/28/00  08:55
"RTN","KMPRSS",2,0)
 ;;1.0;CAPACITY MANAGEMENT - RUM;**1,2**;Dec 09, 1998
"RTN","KMPRSS",3,0)
 ;
"RTN","KMPRSS",4,0)
STAT ; Status of Resource Usage Monitor collection
"RTN","KMPRSS",5,0)
 N CHECK,KMPRX,X,Y
"RTN","KMPRSS",6,0)
 ; check environment
"RTN","KMPRSS",7,0)
 D ENVCHECK^KMPRUTL1(.CHECK,1)
"RTN","KMPRSS",8,0)
 ; if RUM turned on but background job not queued ask user if they want
"RTN","KMPRSS",9,0)
 ; to queue it at this time.
"RTN","KMPRSS",10,0)
 D:(+CHECK)=200 ENVCHECK^KMPRUTL1(.CHECK)
"RTN","KMPRSS",11,0)
 W @IOF,!!,?25,"Resource Usage Monitor Status"
"RTN","KMPRSS",12,0)
 S X="Version "_$P($$VERSION^KMPRUTL,U)
"RTN","KMPRSS",13,0)
 W !,?(80-$L(X)\2),X,!
"RTN","KMPRSS",14,0)
 ; patches
"RTN","KMPRSS",15,0)
 S X=$P($$VERSION^KMPRUTL,U,2)
"RTN","KMPRSS",16,0)
 W:X]"" ?(80-$L(X)\2),X,!
"RTN","KMPRSS",17,0)
 W !,?5,"The Resource Usage Monitor is currently "
"RTN","KMPRSS",18,0)
 I +$G(^%ZTSCH("LOGRSRC")) W "running."
"RTN","KMPRSS",19,0)
 E  W "stopped."
"RTN","KMPRSS",20,0)
 W !
"RTN","KMPRSS",21,0)
 I '$D(^DIC(19,"B","KMPR BACKGROUND DRIVER")) D 
"RTN","KMPRSS",22,0)
 .W !," The 'RUM Background Driver' option [KMPR BACKGROUND DRIVER] is missing !",*7,!
"RTN","KMPRSS",23,0)
 E  D
"RTN","KMPRSS",24,0)
 .S KMPRX=$O(^DIC(19,"B","KMPR BACKGROUND DRIVER",0))
"RTN","KMPRSS",25,0)
 .S KMPRX=+$O(^DIC(19.2,"B",KMPRX,0))
"RTN","KMPRSS",26,0)
 .I 'KMPRX W !?5,"The 'RUM Background Driver' [KMPR BACKGROUND DRIVER] is not scheduled",!?5,"to run!",! Q
"RTN","KMPRSS",27,0)
 .S KMPRX=$G(^DIC(19.2,KMPRX,0))
"RTN","KMPRSS",28,0)
 .S $P(KMPRX,U,2)=$$FMTE^XLFDT($P(KMPRX,U,2))
"RTN","KMPRSS",29,0)
 .W !,?5,"The 'RUM Background Driver' [KMPR BACKGROUND DRIVER]"
"RTN","KMPRSS",30,0)
 .W !?5,"is QUEUED TO RUN AT ",$P(KMPRX,U,2)
"RTN","KMPRSS",31,0)
 .W !,?5,"with a RESCHEDULING FREQUENCY of '",$P(KMPRX,U,6),"'."
"RTN","KMPRSS",32,0)
 W !!,?5,"The temporary collection global (i.e., 'XTMP(""KMPR"")') is",$S('$D(^XTMP("KMPR")):" not",1:"")," present",!,?5,"on your system.",!
"RTN","KMPRSS",33,0)
 W !!,"Press <RETURN> to continue: " R X:DTIME
"RTN","KMPRSS",34,0)
 ;
"RTN","KMPRSS",35,0)
 Q
"RTN","KMPRSS",36,0)
 ;
"RTN","KMPRSS",37,0)
START ; Start Resource Usage Monitor collection
"RTN","KMPRSS",38,0)
 N CHECK
"RTN","KMPRSS",39,0)
 ; check environment
"RTN","KMPRSS",40,0)
 D ENVCHECK^KMPRUTL1(.CHECK,1)
"RTN","KMPRSS",41,0)
 ; if RUM does not support this operating system then quit.
"RTN","KMPRSS",42,0)
 I (+CHECK)=100 W !! D ENVOUTPT^KMPRUTL1(CHECK,1,1) H 1 Q
"RTN","KMPRSS",43,0)
 I +$G(^%ZTSCH("LOGRSRC")) W !!,?10,"The Resource Usage Monitor is already running.",! H 1 Q
"RTN","KMPRSS",44,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="YES"
"RTN","KMPRSS",45,0)
 S DIR("?")="Answer YES to start collecting Resource Usage Monitor data"
"RTN","KMPRSS",46,0)
 S DIR("A")="Do you want to start Resource Usage Monitor collection"
"RTN","KMPRSS",47,0)
 D ^DIR G:$D(DTOUT)!$D(DUOUT) END
"RTN","KMPRSS",48,0)
 I Y D
"RTN","KMPRSS",49,0)
 .S DIE=8989.3,DA=1,DR="300///YES" D ^DIE
"RTN","KMPRSS",50,0)
 .W !!,?10,"Resource Usage Monitor collection is started.",!
"RTN","KMPRSS",51,0)
 .D ENVCHECK^KMPRUTL1(.CHECK,1)
"RTN","KMPRSS",52,0)
 .; if background driver not scheduled to run then start it up
"RTN","KMPRSS",53,0)
 .D:(+CHECK=200) QUEBKG^KMPRUTL1
"RTN","KMPRSS",54,0)
 E  W !!,?10,"Resource Usage Monitor collection is NOT started.",!
"RTN","KMPRSS",55,0)
 H 1 G END
"RTN","KMPRSS",56,0)
 ;
"RTN","KMPRSS",57,0)
STOP ; Stop Resource Usage Monitor collection
"RTN","KMPRSS",58,0)
 I '+$G(^%ZTSCH("LOGRSRC")) W !!,?10,"The Resource Usage Monitor is already stopped.",! H 1 Q
"RTN","KMPRSS",59,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="YES"
"RTN","KMPRSS",60,0)
 S DIR("?")="Answer YES to stop collecting Resource Usage Monitor data"
"RTN","KMPRSS",61,0)
 S DIR("A")="Do you want to stop Resource Usage Monitor collection"
"RTN","KMPRSS",62,0)
 D ^DIR G:$D(DTOUT)!$D(DUOUT) END
"RTN","KMPRSS",63,0)
 I Y D
"RTN","KMPRSS",64,0)
 .S DIE=8989.3,DA=1,DR="300///NO" D ^DIE
"RTN","KMPRSS",65,0)
 .W !!,?10,"Resource Usage Monitor collection is stopped.",!
"RTN","KMPRSS",66,0)
 E  W !!,?10,"Resource Usage Monitor collection is NOT stopped.",!
"RTN","KMPRSS",67,0)
 H 1
"RTN","KMPRSS",68,0)
 ;
"RTN","KMPRSS",69,0)
END ;
"RTN","KMPRSS",70,0)
 K DA,DIE,DIR,DR,DTOUT,DUOUT,X,Y
"RTN","KMPRSS",71,0)
 Q
"RTN","KMPRUTL")
0^3^B18257077
"RTN","KMPRUTL",1,0)
KMPRUTL ;SFISC/KAK/RAK - Resource Usage Monitor Utilities ;2/29/00  10:29
"RTN","KMPRUTL",2,0)
 ;;1.0;CAPACITY MANAGEMENT - RUM;**1,2**;Dec 09, 1998
"RTN","KMPRUTL",3,0)
 ;
"RTN","KMPRUTL",4,0)
CONTINUE(KMPRMSSG,KMPRY) ;-- press return to continue
"RTN","KMPRUTL",5,0)
 ;---------------------------------------------------------------------
"RTN","KMPRUTL",6,0)
 ; KMPRMSSG. (optional) Message to display to user (if not defined then
"RTN","KMPRUTL",7,0)
 ;           default message by ^DIR is used).
"RTN","KMPRUTL",8,0)
 ; KMPRY.... Return value: 0 - do not continue.
"RTN","KMPRUTL",9,0)
 ;                         1 - continue.
"RTN","KMPRUTL",10,0)
 ;           Access by reference.
"RTN","KMPRUTL",11,0)
 ;---------------------------------------------------------------------
"RTN","KMPRUTL",12,0)
 ;
"RTN","KMPRUTL",13,0)
 S KMPRMSSG=$G(KMPRMSSG),KMPRY=0
"RTN","KMPRUTL",14,0)
 ;
"RTN","KMPRUTL",15,0)
 ; if not terminal continue without displaying message.
"RTN","KMPRUTL",16,0)
 I $E(IOST,1,2)'="C-" S KMPRY=1 Q
"RTN","KMPRUTL",17,0)
 ;
"RTN","KMPRUTL",18,0)
 N DIR,X,Y
"RTN","KMPRUTL",19,0)
 S DIR(0)="EO"
"RTN","KMPRUTL",20,0)
 S:KMPRMSSG]"" DIR("A")=KMPRMSSG
"RTN","KMPRUTL",21,0)
 D ^DIR
"RTN","KMPRUTL",22,0)
 S KMPRY=+$G(Y)
"RTN","KMPRUTL",23,0)
 ;
"RTN","KMPRUTL",24,0)
 Q
"RTN","KMPRUTL",25,0)
 ;
"RTN","KMPRUTL",26,0)
GRPHMSG ;-- graph message.
"RTN","KMPRUTL",27,0)
 N TXT
"RTN","KMPRUTL",28,0)
 S TXT(1)="This option displays data in a graphical format.  Please make"
"RTN","KMPRUTL",29,0)
 S TXT(2)="note that this output is intended for comparison/trends only,"
"RTN","KMPRUTL",30,0)
 S TXT(3)="and should not be used for detailed analysis."
"RTN","KMPRUTL",31,0)
 S TXT(1,"F")="!?9",TXT(2,"F")="!?9",TXT(3,"F")="!?9"
"RTN","KMPRUTL",32,0)
 D EN^DDIOL(.TXT)
"RTN","KMPRUTL",33,0)
 Q
"RTN","KMPRUTL",34,0)
 ;
"RTN","KMPRUTL",35,0)
HDR ; entry point to print header
"RTN","KMPRUTL",36,0)
 ; Input variables:
"RTN","KMPRUTL",37,0)
 ;   KMPRPG = page number
"RTN","KMPRUTL",38,0)
 ;   KMPRTL = title to print on header
"RTN","KMPRUTL",39,0)
 ;   KMPRRP = reporting period date
"RTN","KMPRUTL",40,0)
 ;          = print today's date (if NOT defined)
"RTN","KMPRUTL",41,0)
 D PRESS Q:KMPROUT
"RTN","KMPRUTL",42,0)
 W:'($E(IOST,1,2)'="C-"&'KMPRPG) @IOF I ($E(IOST,1,2)="P-"&$D(IO("S"))&'KMPRPG) S (DX,DY)=0 X ^%ZOSF("XY")
"RTN","KMPRUTL",43,0)
 I IOT="HFS"!($E(IOST,1,2)="P-") S (IORVOFF,IORVON)=""
"RTN","KMPRUTL",44,0)
 S KMPRPG=KMPRPG+1 W !,?((IOM/2)-(($L(KMPRTL)+4)/2)),IORVON,"* ",KMPRTL," *",IORVOFF
"RTN","KMPRUTL",45,0)
 I $D(KMPRRP) W !,?((IOM/2)-(($L(A1RP)+18)/2)),"Reporting Period: ",KMPRRP
"RTN","KMPRUTL",46,0)
 E  S Y=DT D DD^%DT W !,?((IOM/2)-(($L(Y)+12)/2)),"Printed on: ",Y
"RTN","KMPRUTL",47,0)
 W:$E(IOST,1,2)'="C-" ?(IOM-9),"Page ",$J(KMPRPG,3) W !!
"RTN","KMPRUTL",48,0)
 Q
"RTN","KMPRUTL",49,0)
 ;
"RTN","KMPRUTL",50,0)
ID(KMPRIEN) ;-- display - called from ^DD(8971.1,0,"ID","W")
"RTN","KMPRUTL",51,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL",52,0)
 ; KMPRIEN... Ien for file #8971.1 (RESOURCE USAGE MONITOR).
"RTN","KMPRUTL",53,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL",54,0)
 Q:'$G(KMPRIEN)
"RTN","KMPRUTL",55,0)
 Q:'$D(^KMPR(8971.1,+KMPRIEN,0))
"RTN","KMPRUTL",56,0)
 N DATA,TXT
"RTN","KMPRUTL",57,0)
 S DATA=$G(^KMPR(8971.1,+KMPRIEN,0))
"RTN","KMPRUTL",58,0)
 ; sent to cm national database.
"RTN","KMPRUTL",59,0)
 S TXT(1)=$S($P(DATA,U,2):"sent",1:"not sent")
"RTN","KMPRUTL",60,0)
 S TXT(1)=TXT(1)_$J(" ",10-$L(TXT(1)))
"RTN","KMPRUTL",61,0)
 ; node.
"RTN","KMPRUTL",62,0)
 S TXT(1)=TXT(1)_$P(DATA,U,3)
"RTN","KMPRUTL",63,0)
 S TXT(1)=TXT(1)_$J(" ",22-$L(TXT(1)))
"RTN","KMPRUTL",64,0)
 ; option.
"RTN","KMPRUTL",65,0)
 I $P(DATA,U,4)]"" S TXT(1)=TXT(1)_"option: "_$P(DATA,U,4)
"RTN","KMPRUTL",66,0)
 ; rpc.
"RTN","KMPRUTL",67,0)
 E  I $P(DATA,U,7)]"" S TXT(1)=TXT(1)_"   rpc: "_$P(DATA,U,7)
"RTN","KMPRUTL",68,0)
 S TXT(1,"F")="?16"
"RTN","KMPRUTL",69,0)
 ; if protocol
"RTN","KMPRUTL",70,0)
 I $P(DATA,U,5)'="" D 
"RTN","KMPRUTL",71,0)
 .S TXT(2)="protocol: "_$E($P(DATA,U,5),1,40) ;_" (protocol)"
"RTN","KMPRUTL",72,0)
 .S TXT(2,"F")="!?"_$S($G(DDSDIW):36,1:45)
"RTN","KMPRUTL",73,0)
 ; display TXT() array.
"RTN","KMPRUTL",74,0)
 D EN^DDIOL(.TXT)
"RTN","KMPRUTL",75,0)
 Q
"RTN","KMPRUTL",76,0)
 ;
"RTN","KMPRUTL",77,0)
PRESS ;
"RTN","KMPRUTL",78,0)
 I KMPRPG,$E(IOST,1,2)="C-" W !,"Press RETURN to continue or '^' to exit: " R X:DTIME S:X="^"!('$T) KMPROUT=1
"RTN","KMPRUTL",79,0)
 Q
"RTN","KMPRUTL",80,0)
 ;
"RTN","KMPRUTL",81,0)
NODEARRY(KMPRARRY) ;-- put nodes into array.
"RTN","KMPRUTL",82,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL",83,0)
 ; KMPRARRY.. Array to contain nodes in format:
"RTN","KMPRUTL",84,0)
 ;            KMPRARRY(NODENAME)=""
"RTN","KMPRUTL",85,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL",86,0)
 ;
"RTN","KMPRUTL",87,0)
 K @KMPRARRY
"RTN","KMPRUTL",88,0)
 ;
"RTN","KMPRUTL",89,0)
 N NODE S NODE=""
"RTN","KMPRUTL",90,0)
 F  S NODE=$O(^KMPR(8971.1,"ANODE",NODE)) Q:NODE=""  S @KMPRARRY@(NODE)=""
"RTN","KMPRUTL",91,0)
 Q
"RTN","KMPRUTL",92,0)
 ;
"RTN","KMPRUTL",93,0)
RUMDATES(KMPRDATE) ;-- get RUM date ranges from file 8971.1
"RTN","KMPRUTL",94,0)
 ;---------------------------------------------------------------------
"RTN","KMPRUTL",95,0)
 ; KMPRDATE... Return value (access by reference) in format:
"RTN","KMPRUTL",96,0)
 ;             StartDate^EndDate^ExtStartDate^ExtEndDate
"RTN","KMPRUTL",97,0)
 ;             2981101^2981104^Nov 1, 1998^Nov 4, 1998
"RTN","KMPRUTL",98,0)
 ;---------------------------------------------------------------------
"RTN","KMPRUTL",99,0)
 ;
"RTN","KMPRUTL",100,0)
 S KMPRDATE=""
"RTN","KMPRUTL",101,0)
 N END,START
"RTN","KMPRUTL",102,0)
 ; determine start date from file 8971.1
"RTN","KMPRUTL",103,0)
 S START=$O(^KMPR(8971.1,"B",0))
"RTN","KMPRUTL",104,0)
 ; determine end date from file 8971.1
"RTN","KMPRUTL",105,0)
 S END=$O(^KMPR(8971.1,"B","A"),-1)
"RTN","KMPRUTL",106,0)
 D DATERNG^KMPUTL1(.KMPRDATE,START,END)
"RTN","KMPRUTL",107,0)
 ;
"RTN","KMPRUTL",108,0)
 Q
"RTN","KMPRUTL",109,0)
 ;
"RTN","KMPRUTL",110,0)
VERSION() ;-- extrinsic - return current version.
"RTN","KMPRUTL",111,0)
 Q $P($T(+2^KMPRUTL),";",3)_"^"_$P($T(+2^KMPRUTL),";",5)
"RTN","KMPRUTL",112,0)
 ;
"RTN","KMPRUTL",113,0)
ZIS ; entry point to define IORVOFF and IORVON variables
"RTN","KMPRUTL",114,0)
 D HOME^%ZIS S X="IORVOFF;IORVON" D ENDR^%ZISS
"RTN","KMPRUTL",115,0)
 S:IOT="HFS" (IORVOFF,IORVON)=""
"RTN","KMPRUTL",116,0)
 Q
"RTN","KMPRUTL",117,0)
 ;
"RTN","KMPRUTL",118,0)
 ;
"RTN","KMPRUTL",119,0)
ELEARRY(KMPRARRY) ;-- set elements data into KMPRARRY.
"RTN","KMPRUTL",120,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL",121,0)
 ; KMPRARRY... Array to contain elements data.
"RTN","KMPRUTL",122,0)
 ;             Format: ElementName^DataPiece
"RTN","KMPRUTL",123,0)
 ;                     KMPRARRY(1)=CPU Time^1
"RTN","KMPRUTL",124,0)
 ;                     KMPRARRY(2)=Elapsed Time^7
"RTN","KMPRUTL",125,0)
 ;                     KMPRARRY(...)=...
"RTN","KMPRUTL",126,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL",127,0)
 ;
"RTN","KMPRUTL",128,0)
 Q:$G(KMPRARRY)=""
"RTN","KMPRUTL",129,0)
 ;
"RTN","KMPRUTL",130,0)
 N DATA,I
"RTN","KMPRUTL",131,0)
 F I=1:1 Q:$P($T(ELEMENTS+I),";",3)=""  D 
"RTN","KMPRUTL",132,0)
 .S DATA=$T(ELEMENTS+I)
"RTN","KMPRUTL",133,0)
 .S @KMPRARRY@(I)=$P(DATA,";",3)_"^"_$P(DATA,";",4)
"RTN","KMPRUTL",134,0)
 Q
"RTN","KMPRUTL",135,0)
 ;
"RTN","KMPRUTL",136,0)
ELEMENT(KMPUVAR) ;-- select RUM data element.
"RTN","KMPRUTL",137,0)
 ; Output Variable:
"RTN","KMPRUTL",138,0)
 ;   KMPUVAR    = Number of Data Piece
"RTN","KMPRUTL",139,0)
 ;              = '^' if DTOUT or DUOUT
"RTN","KMPRUTL",140,0)
 ;   KMPUVAR(0) = Set of Code's Verbiage
"RTN","KMPRUTL",141,0)
 ;
"RTN","KMPRUTL",142,0)
 N DIR,DTOUT,DUOUT,I,X,Y
"RTN","KMPRUTL",143,0)
 S KMPUVAR=""
"RTN","KMPRUTL",144,0)
 S DIR(0)="SXO^"
"RTN","KMPRUTL",145,0)
 F I=1:1 Q:$P($T(ELEMENTS+I),";",3)=""  D 
"RTN","KMPRUTL",146,0)
 .S DIR(0)=DIR(0)_I_":"_$P($T(ELEMENTS+I),";",3)_";"
"RTN","KMPRUTL",147,0)
 S DIR("A")="Enter Key Data Element for Searching RUM Data"
"RTN","KMPRUTL",148,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!(Y="") S KMPUVAR="^",KMPUVAR(0)="" Q
"RTN","KMPRUTL",149,0)
 S KMPUVAR=$TR(Y,"12345678^","17562348^"),KMPUVAR(0)=Y(0)
"RTN","KMPRUTL",150,0)
 Q
"RTN","KMPRUTL",151,0)
 ;
"RTN","KMPRUTL",152,0)
ELEMENTS ;-- ;;Element Name;data piece in file 8971.1
"RTN","KMPRUTL",153,0)
 ;;CPU Time;1
"RTN","KMPRUTL",154,0)
 ;;Elapsed Time;7
"RTN","KMPRUTL",155,0)
 ;;M Commands;5
"RTN","KMPRUTL",156,0)
 ;;GLO References;6
"RTN","KMPRUTL",157,0)
 ;;DIO References;2
"RTN","KMPRUTL",158,0)
 ;;BIO References;3
"RTN","KMPRUTL",159,0)
 ;;Page Faults;4
"RTN","KMPRUTL",160,0)
 ;;Occurrences;8
"RTN","KMPRUTL1")
0^4^B12571358
"RTN","KMPRUTL1",1,0)
KMPRUTL1 ;SFISC/KAK/RAK - Resource Usage Monitor Utility ; 03 Mar 2000  1:45 PM
"RTN","KMPRUTL1",2,0)
 ;;1.0;CAPACITY MANAGEMENT - RUM;**1,2**;Dec 09, 1998
"RTN","KMPRUTL1",3,0)
 ;
"RTN","KMPRUTL1",4,0)
ENVCHECK(KMPRENV,KMPRQIET) ;-- environment check.
"RTN","KMPRUTL1",5,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL1",6,0)
 ; KMPRENV... Result of environment check in format:
"RTN","KMPRUTL1",7,0)
 ;            KMPRENV=Number^Text
"RTN","KMPRUTL1",8,0)
 ;            1-99: system status (not an error condition).
"RTN","KMPRUTL1",9,0)
 ;                 0 - RUM turned on and background job queued
"RTN","KMPRUTL1",10,0)
 ;                 1 - RUM is not turned on
"RTN","KMPRUTL1",11,0)
 ;                 2 - 'KMPR BACKGROUND' job has been queued to run
"RTN","KMPRUTL1",12,0)
 ;
"RTN","KMPRUTL1",13,0)
 ;            100>: error condition.
"RTN","KMPRUTL1",14,0)
 ;               100 - RUM not available for 'OS' at this time
"RTN","KMPRUTL1",15,0)
 ;               200 - RUM is on but the option 'KMPR BACKGROUND DRIVER'
"RTN","KMPRUTL1",16,0)
 ;                     is not scheduled to run."
"RTN","KMPRUTL1",17,0)
 ;               201 - The RUM background driver option [KMPR BACKGROUND
"RTN","KMPRUTL1",18,0)
 ;                     DRIVER] is missing
"RTN","KMPRUTL1",19,0)
 ;
"RTN","KMPRUTL1",20,0)
 ; KMPRQIET.. Output message: 0 - output message (not quiet).
"RTN","KMPRUTL1",21,0)
 ;                            1 - do not output message (quiet).
"RTN","KMPRUTL1",22,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL1",23,0)
 ;
"RTN","KMPRUTL1",24,0)
 K KMPRENV
"RTN","KMPRUTL1",25,0)
 S KMPRENV="0^RUM turned on and background job queued"
"RTN","KMPRUTL1",26,0)
 S KMPRQIET=+$G(KMPRQIET)
"RTN","KMPRUTL1",27,0)
 ;
"RTN","KMPRUTL1",28,0)
 N IEN,IEN1,TEXT
"RTN","KMPRUTL1",29,0)
 ;
"RTN","KMPRUTL1",30,0)
 ; check for operating system availability.
"RTN","KMPRUTL1",31,0)
 S TEXT=$P($G(^%ZOSF("OS")),U)
"RTN","KMPRUTL1",32,0)
 I TEXT'["DSM"&(TEXT'["OpenM") D  Q
"RTN","KMPRUTL1",33,0)
 .S KMPRENV="100^RUM not available for '"_TEXT_"' at this time"
"RTN","KMPRUTL1",34,0)
 .D:'KMPRQIET ENVOUTPT(KMPRENV,1,1)
"RTN","KMPRUTL1",35,0)
 ;
"RTN","KMPRUTL1",36,0)
 ; if rum not started quit.
"RTN","KMPRUTL1",37,0)
 I '$G(^%ZTSCH("LOGRSRC")) D  Q
"RTN","KMPRUTL1",38,0)
 .S KMPRENV="1^RUM is not turned on"
"RTN","KMPRUTL1",39,0)
 .D:'KMPRQIET ENVOUTPT(KMPRENV,1,1)
"RTN","KMPRUTL1",40,0)
 ;
"RTN","KMPRUTL1",41,0)
 S TEXT="KMPR BACKGROUND DRIVER"
"RTN","KMPRUTL1",42,0)
 S IEN=$O(^DIC(19,"B",TEXT,0))
"RTN","KMPRUTL1",43,0)
 I 'IEN D  Q
"RTN","KMPRUTL1",44,0)
 .S KMPRENV="201^The RUM background driver option [KMPR BACKGROUND DRIVER] is missing"
"RTN","KMPRUTL1",45,0)
 .D:'KMPRQIET ENVOUTPT(KMPRENV,1,1)
"RTN","KMPRUTL1",46,0)
 ;
"RTN","KMPRUTL1",47,0)
 S IEN1=$O(^DIC(19.2,"B",IEN,0))
"RTN","KMPRUTL1",48,0)
 I 'IEN1!($P($G(^DIC(19.2,+IEN1,1)),U)']"") D 
"RTN","KMPRUTL1",49,0)
 .S KMPRENV="200^RUM is on but the option '"_TEXT_"' is not scheduled to run"
"RTN","KMPRUTL1",50,0)
 ;
"RTN","KMPRUTL1",51,0)
 Q:KMPRQIET
"RTN","KMPRUTL1",52,0)
 D ENVOUTPT(KMPRENV,1,1) I +KMPRENV<100 Q
"RTN","KMPRUTL1",53,0)
 ;
"RTN","KMPRUTL1",54,0)
 K DIR S DIR(0)="YO",DIR("B")="YES"
"RTN","KMPRUTL1",55,0)
 S DIR("A")="Do you want me to queue this option to run every night at 1 a.m."
"RTN","KMPRUTL1",56,0)
 W ! D ^DIR Q:'Y
"RTN","KMPRUTL1",57,0)
 ;
"RTN","KMPRUTL1",58,0)
 D QUEBKG
"RTN","KMPRUTL1",59,0)
 ;
"RTN","KMPRUTL1",60,0)
 W !
"RTN","KMPRUTL1",61,0)
 S KMPRENV="0^RUM turned on and background job queued"
"RTN","KMPRUTL1",62,0)
 ;
"RTN","KMPRUTL1",63,0)
 Q
"RTN","KMPRUTL1",64,0)
 ;
"RTN","KMPRUTL1",65,0)
ENVOUTPT(KMPRENV,KMPRHILT,KMPRCNTR) ;-- environment check output.
"RTN","KMPRUTL1",66,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL1",67,0)
 ; KMPRENV... Environment output (see ENVCHECK).
"RTN","KMPRUTL1",68,0)
 ; KMPRHILT.. Highlight text: 0 - do not highlight.
"RTN","KMPRUTL1",69,0)
 ;                            1 - highlight text.
"RTN","KMPRUTL1",70,0)
 ; KMPRCNTR.. Center text:    0 - do not center text.
"RTN","KMPRUTL1",71,0)
 ;                            1 - center text.
"RTN","KMPRUTL1",72,0)
 ;-----------------------------------------------------------------------
"RTN","KMPRUTL1",73,0)
 ;
"RTN","KMPRUTL1",74,0)
 S KMPRENV=$G(KMPRENV),KMPRHILT=+$G(KMPRHILT),KMPRCNTR=+$G(KMPRCNTR)
"RTN","KMPRUTL1",75,0)
 Q:KMPRENV=""
"RTN","KMPRUTL1",76,0)
 ;
"RTN","KMPRUTL1",77,0)
 N INDENT,IORVOFF,IORVON,TEXT
"RTN","KMPRUTL1",78,0)
 S X="IORVOFF;IORVON" D ENDR^%ZISS
"RTN","KMPRUTL1",79,0)
 S KMPRENV=$P(KMPRENV,U,2)
"RTN","KMPRUTL1",80,0)
 S:KMPRHILT KMPRENV=IORVON_" "_KMPRENV_" "_IORVOFF
"RTN","KMPRUTL1",81,0)
 S TEXT(1)=KMPRENV
"RTN","KMPRUTL1",82,0)
 I KMPRCNTR S INDENT=80-$L(TEXT(1))\2,TEXT(1,"F")="!?"_INDENT
"RTN","KMPRUTL1",83,0)
 D EN^DDIOL(.TEXT)
"RTN","KMPRUTL1",84,0)
 ;
"RTN","KMPRUTL1",85,0)
 Q
"RTN","KMPRUTL1",86,0)
 ;
"RTN","KMPRUTL1",87,0)
PKG(PACKAGE) ; Select Package(s)
"RTN","KMPRUTL1",88,0)
 ; Output Variable:
"RTN","KMPRUTL1",89,0)
 ;   PACKAGE = Contains array of package names
"RTN","KMPRUTL1",90,0)
 ;           = PACKAGE("^") if DTOUT or DUOUT
"RTN","KMPRUTL1",91,0)
 ;
"RTN","KMPRUTL1",92,0)
 N DIR,DTOUT,DUOUT,Y
"RTN","KMPRUTL1",93,0)
 S DIR(0)="FO^1:999:0"
"RTN","KMPRUTL1",94,0)
 F  D  Q:$D(DTOUT)!$D(DUOUT)!(Y="")
"RTN","KMPRUTL1",95,0)
 .S DIR("A")="Select Package Namespace" D ^DIR I Y'="" S PACKAGE(Y)=""
"RTN","KMPRUTL1",96,0)
 .I Y=" " W !,*7,"Please enter a valid package namespace.",!
"RTN","KMPRUTL1",97,0)
 S:$D(DTOUT)!$D(DUOUT)!('$D(PACKAGE)) PACKAGE("^")=""
"RTN","KMPRUTL1",98,0)
 W !
"RTN","KMPRUTL1",99,0)
 Q
"RTN","KMPRUTL1",100,0)
 ;
"RTN","KMPRUTL1",101,0)
QUEBKG ;-- queue background job KMPR BACKGROUND DRIVER
"RTN","KMPRUTL1",102,0)
 N DA,DIK,FDA,ERROR,IEN,IEN1,IENZ,TEXT,X,Y,Z
"RTN","KMPRUTL1",103,0)
 S:'$G(DT) DT=$$DT^XLFDT
"RTN","KMPRUTL1",104,0)
 S TEXT="KMPR BACKGROUND DRIVER"
"RTN","KMPRUTL1",105,0)
 S IEN=$O(^DIC(19,"B",TEXT,0)) Q:'IEN
"RTN","KMPRUTL1",106,0)
 S IEN1=$O(^DIC(19.2,"B",IEN,0))
"RTN","KMPRUTL1",107,0)
 ; if already in file 19.2 then kill.
"RTN","KMPRUTL1",108,0)
 I IEN1 S DIK="^DIC(19.2,",DA=IEN1 D ^DIK
"RTN","KMPRUTL1",109,0)
 ; schedule for tomorrow@1am.
"RTN","KMPRUTL1",110,0)
 S FDA($J,19.2,"+1,",.01)=IEN
"RTN","KMPRUTL1",111,0)
 ; queued to run at what time - set to tomorrow@1am
"RTN","KMPRUTL1",112,0)
 S FDA($J,19.2,"+1,",2)=$$FMADD^XLFDT(DT,1)_".01"
"RTN","KMPRUTL1",113,0)
 ; rescheduling frequency.
"RTN","KMPRUTL1",114,0)
 S FDA($J,19.2,"+1,",6)="1D"
"RTN","KMPRUTL1",115,0)
 D UPDATE^DIE("","FDA($J)",.IENZ,"ERROR")
"RTN","KMPRUTL1",116,0)
 I $D(ERROR) D MSG^DIALOG("W","",60,10,"ERROR")
"RTN","KMPRUTL1",117,0)
 Q
"VER")
8.0^22.0
**END**
**END**
