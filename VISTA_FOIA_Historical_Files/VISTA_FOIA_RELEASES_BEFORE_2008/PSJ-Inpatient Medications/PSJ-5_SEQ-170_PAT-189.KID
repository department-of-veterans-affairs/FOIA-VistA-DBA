Released PSJ*5*189 SEQ #170
Extracted from mail message
**KIDS**:PSJ*5.0*189^

**INSTALL NAME**
PSJ*5.0*189
"BLD",7225,0)
PSJ*5.0*189^INPATIENT MEDICATIONS^0^3070525^y
"BLD",7225,1,0)
^^6^6^3070525^
"BLD",7225,1,1,0)
 
"BLD",7225,1,2,0)
This patch will correct an error which can occur for any IV Drug order
"BLD",7225,1,3,0)
type which uses an Administration Schedule but the Administration Schedule
"BLD",7225,1,4,0)
used does not have a Package Prefix = 'PSJ'.  The error occurs when a user
"BLD",7225,1,5,0)
attempts to view the Long profile of the order in PSJ OE [Inpatient Order
"BLD",7225,1,6,0)
Entry].
"BLD",7225,4,0)
^9.64PA^^
"BLD",7225,6)
1^
"BLD",7225,6.3)
4
"BLD",7225,"KRN",0)
^9.67PA^8989.52^19
"BLD",7225,"KRN",.4,0)
.4
"BLD",7225,"KRN",.401,0)
.401
"BLD",7225,"KRN",.402,0)
.402
"BLD",7225,"KRN",.403,0)
.403
"BLD",7225,"KRN",.5,0)
.5
"BLD",7225,"KRN",.84,0)
.84
"BLD",7225,"KRN",3.6,0)
3.6
"BLD",7225,"KRN",3.8,0)
3.8
"BLD",7225,"KRN",9.2,0)
9.2
"BLD",7225,"KRN",9.8,0)
9.8
"BLD",7225,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7225,"KRN",9.8,"NM",1,0)
PSJORP2^^0^B18899712
"BLD",7225,"KRN",9.8,"NM","B","PSJORP2",1)

"BLD",7225,"KRN",19,0)
19
"BLD",7225,"KRN",19.1,0)
19.1
"BLD",7225,"KRN",101,0)
101
"BLD",7225,"KRN",409.61,0)
409.61
"BLD",7225,"KRN",771,0)
771
"BLD",7225,"KRN",870,0)
870
"BLD",7225,"KRN",8989.51,0)
8989.51
"BLD",7225,"KRN",8989.52,0)
8989.52
"BLD",7225,"KRN",8994,0)
8994
"BLD",7225,"KRN","B",.4,.4)

"BLD",7225,"KRN","B",.401,.401)

"BLD",7225,"KRN","B",.402,.402)

"BLD",7225,"KRN","B",.403,.403)

"BLD",7225,"KRN","B",.5,.5)

"BLD",7225,"KRN","B",.84,.84)

"BLD",7225,"KRN","B",3.6,3.6)

"BLD",7225,"KRN","B",3.8,3.8)

"BLD",7225,"KRN","B",9.2,9.2)

"BLD",7225,"KRN","B",9.8,9.8)

"BLD",7225,"KRN","B",19,19)

"BLD",7225,"KRN","B",19.1,19.1)

"BLD",7225,"KRN","B",101,101)

"BLD",7225,"KRN","B",409.61,409.61)

"BLD",7225,"KRN","B",771,771)

"BLD",7225,"KRN","B",870,870)

"BLD",7225,"KRN","B",8989.51,8989.51)

"BLD",7225,"KRN","B",8989.52,8989.52)

"BLD",7225,"KRN","B",8994,8994)

"BLD",7225,"QUES",0)
^9.62^^
"BLD",7225,"REQB",0)
^9.611^1^1
"BLD",7225,"REQB",1,0)
PSJ*5.0*133^1
"BLD",7225,"REQB","B","PSJ*5.0*133",1)

"MBREQ")
0
"PKG",203,-1)
1^1
"PKG",203,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",203,20,0)
^9.402P^^
"PKG",203,22,0)
^9.49I^1^1
"PKG",203,22,1,0)
5.0^2971215^2980417^1271
"PKG",203,22,1,"PAH",1,0)
189^3070525^33234
"PKG",203,22,1,"PAH",1,1,0)
^^6^6^3070525
"PKG",203,22,1,"PAH",1,1,1,0)
 
"PKG",203,22,1,"PAH",1,1,2,0)
This patch will correct an error which can occur for any IV Drug order
"PKG",203,22,1,"PAH",1,1,3,0)
type which uses an Administration Schedule but the Administration Schedule
"PKG",203,22,1,"PAH",1,1,4,0)
used does not have a Package Prefix = 'PSJ'.  The error occurs when a user
"PKG",203,22,1,"PAH",1,1,5,0)
attempts to view the Long profile of the order in PSJ OE [Inpatient Order
"PKG",203,22,1,"PAH",1,1,6,0)
Entry].
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJORP2")
0^1^B18899712^B19054632
"RTN","PSJORP2",1,0)
PSJORP2 ;BIR/JCH-CALCULATE FIRST DOSE FOR OE/RR 3.0 ;27 Feb 03 / 9:40 AM
"RTN","PSJORP2",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**80,110,111,133,189**;16 DEC 97;Build 4
"RTN","PSJORP2",3,0)
 ;
"RTN","PSJORP2",4,0)
 Q
"RTN","PSJORP2",5,0)
ENQ(PSGP,INFO) ; start
"RTN","PSJORP2",6,0)
 ; INFO (piece 1) = START DATE/TIME
"RTN","PSJORP2",7,0)
 ; INFO (piece 2) = STOP DATE/TIME
"RTN","PSJORP2",8,0)
 ; INFO (piece 3) = SCHEDULE
"RTN","PSJORP2",9,0)
 ; INFO (piece 4) = SCHEDULE TYPE
"RTN","PSJORP2",10,0)
 ; INFO (piece 5) = ORDERABLE ITEM
"RTN","PSJORP2",11,0)
 ; INFO (piece 6) = ADMIN TIMES
"RTN","PSJORP2",12,0)
 ;
"RTN","PSJORP2",13,0)
 N PSGNESD,PSGSD,PSGNEFD,PSGFD,PSGSCH,PSGST,PST,PSGS0XT,PSGS0Y,PSGED,SCHFREQ,FIRST,PSGDF,PSGS
"RTN","PSJORP2",14,0)
 S (PSGSD,PSGNESD)=$P(INFO,U),(PSGFD,PSGNEFD)=$P(INFO,U,2),PSGSCH=$P(INFO,U,3),(PSGST,PST)=$P(INFO,U,4),PSGS0Y=$P(INFO,U,6)
"RTN","PSJORP2",15,0)
 S PSGST=$S(PSGST="O":"O",1:"C"),PSGS0XT="",FIRST=""
"RTN","PSJORP2",16,0)
 Q:'PSGSD "" S X=PSGSCH D ADMIN^PSJORPOE
"RTN","PSJORP2",17,0)
 I ($P(INFO,"^",6)]""),($G(PSGS0Y)'=$P(INFO,"^",6)) S PSGS0Y=$P(INFO,"^",6)
"RTN","PSJORP2",18,0)
 I $G(PSJLSTAT),'$G(PSGS0XT),'$$DOW^PSIVUTL(PSGSCH) D
"RTN","PSJORP2",19,0)
 .N D,DA,X,PSGAT,PSGOES,PSGST,PSJNSS,PSJPWD,TEST,VALMBCK,PSGS0Y,PSGDT S X=$P(INFO,"^",3) I X]"" S PSGOES=1 D EN^PSGORS0
"RTN","PSJORP2",20,0)
 I '$G(PSJLSTAT) S X2=$S(PSGS0XT>1440:(PSGS0XT\1440)+1,1:7),X1=PSGSD D C^%DTC S (PSGFD,PSGNEFD)=X
"RTN","PSJORP2",21,0)
 I 'PSGS0Y S:PSGSCH["@" PSGS0Y=$P(PSGSCH,"@",2) I 'PSGS0Y S PSGS0Y=$P(PSGSD,".",2) I $G(PSGST)'="O",($E(PSGS0Y,1,2)<23),($P($G(PSJSYSW0),"^",5)=1) D
"RTN","PSJORP2",22,0)
 . I $L($P(PSGSD,".",2))<3 S DCAL=$P(PSGSD,".",2) Q
"RTN","PSJORP2",23,0)
 . N DCAL S DCAL=$E($$FMADD^XLFDT(PSGSD,0,1,0,0),9,10) S:DCAL PSGS0Y=DCAL
"RTN","PSJORP2",24,0)
 S PSGS=$S(PSGST="C":1,PSGST="P":2,PSGST="O":4,1:"")
"RTN","PSJORP2",25,0)
 S X2=PSGNESD,X1=PSGNEFD D ^%DTC S PSGDF=X+30
"RTN","PSJORP2",26,0)
 K PSGD S X=$P(PSGSD,"."),PSGDW="" F Q=0:1:PSGDF-1 S X1=$P(PSGSD,"."),X2=Q D:Q C^%DTC S PSGD(X)=$E(X,4,5)_"/"_$E(X,6,7),HX=X D DW^%DTC S $P(PSGD(HX),U,2)=X
"RTN","PSJORP2",27,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSJORP2",28,0)
 S PST=PSGST,PSGED=PSGSD D OS(PSGP,PSGST)
"RTN","PSJORP2",29,0)
 I $D(PSGD)<10 Q ""
"RTN","PSJORP2",30,0)
 D PRT(X) I $G(PSJLSTAT) S:$G(LAST)>PSGFD LAST=PSGFD Q +$G(LAST)
"RTN","PSJORP2",31,0)
 I $G(FIRST)<PSGSD S FIRST=PSGSD
"RTN","PSJORP2",32,0)
 I $P(PSGSD,".")=$P(FIRST,"."),($P($G(^PS(59.6,+$G(PSJPWD),0)),"^",5)=2),'$G(PSGS0Y) S FIRST=PSGSD
"RTN","PSJORP2",33,0)
 K PSGD,TS,PSGGD,X,S,Q,QQ,QST
"RTN","PSJORP2",34,0)
 Q FIRST
"RTN","PSJORP2",35,0)
 ;
"RTN","PSJORP2",36,0)
OS(PSGP,PSGST) ; order record set
"RTN","PSJORP2",37,0)
 S SD=PSGNESD I $S($P(SD,".")>PSGNEFD:1,PSGS=1:PSGSCH["PRN",1:0) Q
"RTN","PSJORP2",38,0)
 S FD=PSGNEFD,T=PSGS0XT
"RTN","PSJORP2",39,0)
 S QST=$S(PST="C"!(PST="O"):PST,PST="OC":"OA",PST="P":"OP",PSGSCH["PRN":"OR",1:"CR")
"RTN","PSJORP2",40,0)
 S QQ="" I QST["C" D DTS(PSGSCH) S SD=$P(SD,"."),QQ="" F X=0:0 S X=$O(PSGD(X)) Q:'X  D
"RTN","PSJORP2",41,0)
 . S QQ=QQ_$S(X<SD:"",X>FD:"",'S:$P(PSGD(X),U),$D(S(X)):$P(PSGD(X),U),1:"")
"RTN","PSJORP2",42,0)
 I PSGS0XT="D",PSGS0Y="" S PSGS0Y=$P(PSGNESD,".",2)
"RTN","PSJORP2",43,0)
 S X=$S(QST["C"!(QST="O"):PSGS0Y,1:"")_U_QQ
"RTN","PSJORP2",44,0)
 Q
"RTN","PSJORP2",45,0)
 ;
"RTN","PSJORP2",46,0)
DTS(SCHEDULE) ;
"RTN","PSJORP2",47,0)
 K S S S=0 I SCHEDULE["@"!(PSGST="D") S WD=$S(SCHEDULE["@":$P(SCHEDULE,"@"),1:SCHEDULE) D
"RTN","PSJORP2",48,0)
 . F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q  F QQ=1:1:$L(WD,"-") I $P($P(PSGD(Q),U,2),$P(WD,"-",QQ))="" S S(Q)="",S=S+1 Q
"RTN","PSJORP2",49,0)
 Q:SCHEDULE["@"!(T="D")  Q:T'>1440  S WD=$P(PSGSD,".") I '(T#1440) S (SD,X)=$P(SD,"."),PSGT=T\1440 D
"RTN","PSJORP2",50,0)
 . F QQ=0:1 S X1=SD,X2=QQ*PSGT D:X2 C^%DTC I X'<WD S S=S+1 Q:X>PSGFD  Q:X>FD  S S(X)=""
"RTN","PSJORP2",51,0)
 K PSGT Q:'(T#1440)  S PSGT=T,X1=PSGSD,(ST,X2)=SD I PSGSD>SD D ^%DTC I X>1 S ST=$$EN^PSGCT(SD,X-1*1440\T*T)
"RTN","PSJORP2",52,0)
 S (PSGS,X)=ST F PSGX=0:1 S AM=PSGT*PSGX,ST=PSGS S:AM X=$$EN^PSGCT(ST,AM) S X=$P(X,".") I X'<WD Q:X>PSGFD  Q:X>FD  I '$D(S(X)) S S=S+1,S(X)=""
"RTN","PSJORP2",53,0)
 K AM,ST,PSGS,PSGT,PSGX Q
"RTN","PSJORP2",54,0)
 ;
"RTN","PSJORP2",55,0)
PRT(PSGTS) ; order info
"RTN","PSJORP2",56,0)
 S PSGGD=$P(PSGTS,"^",2),PSGTS=$P(PSGTS,"^") S PSJPSTO=PST
"RTN","PSJORP2",57,0)
 D TS(PSGTS) D FIRST D:$G(PSJLSTAT) LAST
"RTN","PSJORP2",58,0)
 S PSGOC=$G(PSGOC)+1
"RTN","PSJORP2",59,0)
 Q
"RTN","PSJORP2",60,0)
 ;
"RTN","PSJORP2",61,0)
FIRST ; find expected first dose
"RTN","PSJORP2",62,0)
 N QTS,ADMIN S FIRST=""
"RTN","PSJORP2",63,0)
 I PST["CZ" NEW PSGLFFD,PSGGD S P(9)="",PSGLFFD="9999999",PSGGD="" Q
"RTN","PSJORP2",64,0)
 I TS=1,'PSGTS Q
"RTN","PSJORP2",65,0)
 F Q=0:0 S Q=$O(PSGD(Q)) Q:'Q!$G(FIRST)  S ADMIN=0 F  S ADMIN=$O(TS(ADMIN)) Q:'ADMIN!$G(FIRST)  D
"RTN","PSJORP2",66,0)
 . S QTS=Q_"."_TS(ADMIN)
"RTN","PSJORP2",67,0)
 . S FIRST=$S(QTS<PSGSD:"",QTS'<PSGFD:"",PSGGD="":"",PSGGD[$P(PSGD(Q),"^"):QTS,1:"")
"RTN","PSJORP2",68,0)
 Q
"RTN","PSJORP2",69,0)
 ;
"RTN","PSJORP2",70,0)
LAST ; find expected last dose
"RTN","PSJORP2",71,0)
 N QTS,ADMIN S LAST=""
"RTN","PSJORP2",72,0)
 I PST["CZ" NEW PSGLFFD,PSGGD S P(9)="",PSGLFFD="9999999",PSGGD="" Q
"RTN","PSJORP2",73,0)
 I TS=1,'PSGTS Q
"RTN","PSJORP2",74,0)
 S Q=99999999 F  S Q=$O(PSGD(Q),-1) Q:'Q!$G(LAST)  S ADMIN="" F  S ADMIN=$O(TS(ADMIN),-1) Q:'ADMIN!$G(LAST)  D
"RTN","PSJORP2",75,0)
 . S QTS=Q_"."_TS(ADMIN)
"RTN","PSJORP2",76,0)
 . S LAST=$S(QTS>PSGFD:"",QTS'>PSGSD:"",PSGGD="":"",PSGGD[$P(PSGD(Q),"^"):QTS,1:"")
"RTN","PSJORP2",77,0)
 Q
"RTN","PSJORP2",78,0)
 ;
"RTN","PSJORP2",79,0)
TS(X) ;
"RTN","PSJORP2",80,0)
 K TS S TS=$L(X,"-") F Q=1:1:TS S TS(Q)=$P(X,"-",Q)
"RTN","PSJORP2",81,0)
 Q
"RTN","PSJORP2",82,0)
 ;
"RTN","PSJORP2",83,0)
LASTAT(PSGP,INFO) ;
"RTN","PSJORP2",84,0)
 N LSTDT,PSJLSTAT S LASTAT=0,PSJLSTAT=1 S LASTAT=$$ENQ(PSGP,INFO)
"RTN","PSJORP2",85,0)
 I (LASTAT>$P(INFO,"^",2)!'LASTAT) S LASTAT=$P(INFO,"^",2)
"RTN","PSJORP2",86,0)
 K PSGD,TS,PSGGD,X,S,Q,QQ,QST
"RTN","PSJORP2",87,0)
 Q LASTAT
"VER")
8.0^22.0
"BLD",7225,6)
^170
**END**
**END**
