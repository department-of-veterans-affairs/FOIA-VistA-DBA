Released PSA*3*56 SEQ #40
Extracted from mail message
**KIDS**:PSA*3.0*56^

**INSTALL NAME**
PSA*3.0*56
"BLD",6458,0)
PSA*3.0*56^DRUG ACCOUNTABILITY^0^3060424^y
"BLD",6458,1,0)
^^51^51^3060317^
"BLD",6458,1,1,0)
This patch addresses the following problem:
"BLD",6458,1,2,0)
 
"BLD",6458,1,3,0)
1. HD68257: Drug SYNONYM field (#9) duplicates are being created in the 
"BLD",6458,1,4,0)
DRUG file (#50). The process of verifying an invoice that is adding a new 
"BLD",6458,1,5,0)
drug synonym to the DRUG file (#50) was found to be adding duplicates in 
"BLD",6458,1,6,0)
the same invoice and between invoices that were processed at the same 
"BLD",6458,1,7,0)
time. The verification process now insures duplicates are not being 
"BLD",6458,1,8,0)
created.
"BLD",6458,1,9,0)
 
"BLD",6458,1,10,0)
2. HD128777: Pharmacy locations, in the DRUG ACCOUNTABILITY STATS file 
"BLD",6458,1,11,0)
#58.8, may have their associated entries in the drug file updated by zero 
"BLD",6458,1,12,0)
quantity invoice items if the location is not marked for tracking 
"BLD",6458,1,13,0)
inventory or re-order levels.
"BLD",6458,1,14,0)
 
"BLD",6458,1,15,0)
NOTE: A post init will review the Drug file (#50) and remove all but the 
"BLD",6458,1,16,0)
first of identical synonym duplicates from under a drug. A "PSA*3*56 
"BLD",6458,1,17,0)
Delete Duplicate Drug Synonyms report" mailman message will be sent to 
"BLD",6458,1,18,0)
the person who performs the installation identifying what drug-synonyms 
"BLD",6458,1,19,0)
had identical synonyms deleted. It will also indicate if there were none 
"BLD",6458,1,20,0)
found to be removed.
"BLD",6458,1,21,0)
 
"BLD",6458,1,22,0)
EXAMPLE 1)      Duplicate synonyms found and were deleted.
"BLD",6458,1,23,0)
Subj: PSA*3*56 Delete Duplicate Drug Synonyms report  [#2019687] 
"BLD",6458,1,24,0)
03/17/06@17:11
"BLD",6458,1,25,0)
11 lines
"BLD",6458,1,26,0)
From: PSA*3*56 POST INIT  In 'IN' basket.   Page 1
"BLD",6458,1,27,0)
--------------------------------------------------------------------------
"BLD",6458,1,28,0)
PSA*3*56 DELETE DUPLICATE SYNONYMS REPORT
"BLD",6458,1,29,0)
The following Drug-Synonyms have had identical synonyms removed from the 
"BLD",6458,1,30,0)
drug.
"BLD",6458,1,31,0)
Drug Name                       DRG#,SYN#   NDC            VSN
"BLD",6458,1,32,0)
ACETAMINOPHEN, CODEINE 60MG TAB 3994,7      00406-0484-10  2792513
"BLD",6458,1,33,0)
OU: CS        PPOU: $9.60                   DUOU: 1000     PPDU: $.01
"BLD",6458,1,34,0)
ACETAMINOPHEN, CODEINE 60MG TAB 3994,11     00406-0484-10  2792513
"BLD",6458,1,35,0)
OU: BT        PPOU: $9.60                   DUOU: 1000     PPDU: $.01
"BLD",6458,1,36,0)
ACETAMINOPHEN, CODEINE 60MG TAB 3998,7      00406-0484-10  2792513
"BLD",6458,1,37,0)
OU: CS        PPOU: $9.60                   DUOU: 1000     PPDU: $.01
"BLD",6458,1,38,0)
ACETAMINOPHEN, CODEINE 60MG TAB 3998,11     00406-0484-10  2792513
"BLD",6458,1,39,0)
OU: BT        PPOU: $9.60                   DUOU: 1000     PPDU: $.01
"BLD",6458,1,40,0)
 
"BLD",6458,1,41,0)
EXAMPLE 2) No duplicate synonyms found and none were deleted.
"BLD",6458,1,42,0)
Subj: PSA*3*56 Delete Duplicate Drug Synonyms report  [#2019688] 
"BLD",6458,1,43,0)
03/17/06@17:15
"BLD",6458,1,44,0)
3 lines
"BLD",6458,1,45,0)
From: PSA*3*56 POST INIT  In 'IN' basket.   Page 1
"BLD",6458,1,46,0)
--------------------------------------------------------------------------
"BLD",6458,1,47,0)
PSA*3*56 DELETE DUPLICATE SYNONYMS REPORT
"BLD",6458,1,48,0)
 
"BLD",6458,1,49,0)
There were no duplicate drug-synonyms found. No synonyms were removed.
"BLD",6458,1,50,0)
 
"BLD",6458,1,51,0)
Enter message action (in IN basket): Ignore//
"BLD",6458,4,0)
^9.64PA^^
"BLD",6458,"INID")
^n
"BLD",6458,"INIT")
EN^PSAP56
"BLD",6458,"KRN",0)
^9.67PA^8989.52^19
"BLD",6458,"KRN",.4,0)
.4
"BLD",6458,"KRN",.401,0)
.401
"BLD",6458,"KRN",.402,0)
.402
"BLD",6458,"KRN",.403,0)
.403
"BLD",6458,"KRN",.5,0)
.5
"BLD",6458,"KRN",.84,0)
.84
"BLD",6458,"KRN",3.6,0)
3.6
"BLD",6458,"KRN",3.8,0)
3.8
"BLD",6458,"KRN",9.2,0)
9.2
"BLD",6458,"KRN",9.8,0)
9.8
"BLD",6458,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6458,"KRN",9.8,"NM",1,0)
PSAVER7^^0^B21998515
"BLD",6458,"KRN",9.8,"NM",2,0)
PSAP56^^0^B16614525
"BLD",6458,"KRN",9.8,"NM","B","PSAP56",2)

"BLD",6458,"KRN",9.8,"NM","B","PSAVER7",1)

"BLD",6458,"KRN",19,0)
19
"BLD",6458,"KRN",19.1,0)
19.1
"BLD",6458,"KRN",101,0)
101
"BLD",6458,"KRN",409.61,0)
409.61
"BLD",6458,"KRN",771,0)
771
"BLD",6458,"KRN",870,0)
870
"BLD",6458,"KRN",8989.51,0)
8989.51
"BLD",6458,"KRN",8989.52,0)
8989.52
"BLD",6458,"KRN",8994,0)
8994
"BLD",6458,"KRN","B",.4,.4)

"BLD",6458,"KRN","B",.401,.401)

"BLD",6458,"KRN","B",.402,.402)

"BLD",6458,"KRN","B",.403,.403)

"BLD",6458,"KRN","B",.5,.5)

"BLD",6458,"KRN","B",.84,.84)

"BLD",6458,"KRN","B",3.6,3.6)

"BLD",6458,"KRN","B",3.8,3.8)

"BLD",6458,"KRN","B",9.2,9.2)

"BLD",6458,"KRN","B",9.8,9.8)

"BLD",6458,"KRN","B",19,19)

"BLD",6458,"KRN","B",19.1,19.1)

"BLD",6458,"KRN","B",101,101)

"BLD",6458,"KRN","B",409.61,409.61)

"BLD",6458,"KRN","B",771,771)

"BLD",6458,"KRN","B",870,870)

"BLD",6458,"KRN","B",8989.51,8989.51)

"BLD",6458,"KRN","B",8989.52,8989.52)

"BLD",6458,"KRN","B",8994,8994)

"BLD",6458,"QUES",0)
^9.62^^
"BLD",6458,"REQB",0)
^9.611^1^1
"BLD",6458,"REQB",1,0)
PSA*3.0*42^1
"BLD",6458,"REQB","B","PSA*3.0*42",1)

"INIT")
EN^PSAP56
"MBREQ")
0
"PKG",487,-1)
1^1
"PKG",487,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability Inventory and Tracking module.
"PKG",487,20,0)
^9.402P^^
"PKG",487,22,0)
^9.49I^1^1
"PKG",487,22,1,0)
3.0^2971024^2981028^66481
"PKG",487,22,1,"PAH",1,0)
56^3060424^100104
"PKG",487,22,1,"PAH",1,1,0)
^^51^51^3060424
"PKG",487,22,1,"PAH",1,1,1,0)
This patch addresses the following problem:
"PKG",487,22,1,"PAH",1,1,2,0)
 
"PKG",487,22,1,"PAH",1,1,3,0)
1. HD68257: Drug SYNONYM field (#9) duplicates are being created in the 
"PKG",487,22,1,"PAH",1,1,4,0)
DRUG file (#50). The process of verifying an invoice that is adding a new 
"PKG",487,22,1,"PAH",1,1,5,0)
drug synonym to the DRUG file (#50) was found to be adding duplicates in 
"PKG",487,22,1,"PAH",1,1,6,0)
the same invoice and between invoices that were processed at the same 
"PKG",487,22,1,"PAH",1,1,7,0)
time. The verification process now insures duplicates are not being 
"PKG",487,22,1,"PAH",1,1,8,0)
created.
"PKG",487,22,1,"PAH",1,1,9,0)
 
"PKG",487,22,1,"PAH",1,1,10,0)
2. HD128777: Pharmacy locations, in the DRUG ACCOUNTABILITY STATS file 
"PKG",487,22,1,"PAH",1,1,11,0)
#58.8, may have their associated entries in the drug file updated by zero 
"PKG",487,22,1,"PAH",1,1,12,0)
quantity invoice items if the location is not marked for tracking 
"PKG",487,22,1,"PAH",1,1,13,0)
inventory or re-order levels.
"PKG",487,22,1,"PAH",1,1,14,0)
 
"PKG",487,22,1,"PAH",1,1,15,0)
NOTE: A post init will review the Drug file (#50) and remove all but the 
"PKG",487,22,1,"PAH",1,1,16,0)
first of identical synonym duplicates from under a drug. A "PSA*3*56 
"PKG",487,22,1,"PAH",1,1,17,0)
Delete Duplicate Drug Synonyms report" mailman message will be sent to 
"PKG",487,22,1,"PAH",1,1,18,0)
the person who performs the installation identifying what drug-synonyms 
"PKG",487,22,1,"PAH",1,1,19,0)
had identical synonyms deleted. It will also indicate if there were none 
"PKG",487,22,1,"PAH",1,1,20,0)
found to be removed.
"PKG",487,22,1,"PAH",1,1,21,0)
 
"PKG",487,22,1,"PAH",1,1,22,0)
EXAMPLE 1)      Duplicate synonyms found and were deleted.
"PKG",487,22,1,"PAH",1,1,23,0)
Subj: PSA*3*56 Delete Duplicate Drug Synonyms report  [#2019687] 
"PKG",487,22,1,"PAH",1,1,24,0)
03/17/06@17:11
"PKG",487,22,1,"PAH",1,1,25,0)
11 lines
"PKG",487,22,1,"PAH",1,1,26,0)
From: PSA*3*56 POST INIT  In 'IN' basket.   Page 1
"PKG",487,22,1,"PAH",1,1,27,0)
--------------------------------------------------------------------------
"PKG",487,22,1,"PAH",1,1,28,0)
PSA*3*56 DELETE DUPLICATE SYNONYMS REPORT
"PKG",487,22,1,"PAH",1,1,29,0)
The following Drug-Synonyms have had identical synonyms removed from the 
"PKG",487,22,1,"PAH",1,1,30,0)
drug.
"PKG",487,22,1,"PAH",1,1,31,0)
Drug Name                       DRG#,SYN#   NDC            VSN
"PKG",487,22,1,"PAH",1,1,32,0)
ACETAMINOPHEN, CODEINE 60MG TAB 3994,7      00406-0484-10  2792513
"PKG",487,22,1,"PAH",1,1,33,0)
OU: CS        PPOU: $9.60                   DUOU: 1000     PPDU: $.01
"PKG",487,22,1,"PAH",1,1,34,0)
ACETAMINOPHEN, CODEINE 60MG TAB 3994,11     00406-0484-10  2792513
"PKG",487,22,1,"PAH",1,1,35,0)
OU: BT        PPOU: $9.60                   DUOU: 1000     PPDU: $.01
"PKG",487,22,1,"PAH",1,1,36,0)
ACETAMINOPHEN, CODEINE 60MG TAB 3998,7      00406-0484-10  2792513
"PKG",487,22,1,"PAH",1,1,37,0)
OU: CS        PPOU: $9.60                   DUOU: 1000     PPDU: $.01
"PKG",487,22,1,"PAH",1,1,38,0)
ACETAMINOPHEN, CODEINE 60MG TAB 3998,11     00406-0484-10  2792513
"PKG",487,22,1,"PAH",1,1,39,0)
OU: BT        PPOU: $9.60                   DUOU: 1000     PPDU: $.01
"PKG",487,22,1,"PAH",1,1,40,0)
 
"PKG",487,22,1,"PAH",1,1,41,0)
EXAMPLE 2) No duplicate synonyms found and none were deleted.
"PKG",487,22,1,"PAH",1,1,42,0)
Subj: PSA*3*56 Delete Duplicate Drug Synonyms report  [#2019688] 
"PKG",487,22,1,"PAH",1,1,43,0)
03/17/06@17:15
"PKG",487,22,1,"PAH",1,1,44,0)
3 lines
"PKG",487,22,1,"PAH",1,1,45,0)
From: PSA*3*56 POST INIT  In 'IN' basket.   Page 1
"PKG",487,22,1,"PAH",1,1,46,0)
--------------------------------------------------------------------------
"PKG",487,22,1,"PAH",1,1,47,0)
PSA*3*56 DELETE DUPLICATE SYNONYMS REPORT
"PKG",487,22,1,"PAH",1,1,48,0)
 
"PKG",487,22,1,"PAH",1,1,49,0)
There were no duplicate drug-synonyms found. No synonyms were removed.
"PKG",487,22,1,"PAH",1,1,50,0)
 
"PKG",487,22,1,"PAH",1,1,51,0)
Enter message action (in IN basket): Ignore//
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSAP56")
0^2^B16614525
"RTN","PSAP56",1,0)
PSAP56 ;VMP/PDW-DUPLICATE REMOVAL ;93/17/2006
"RTN","PSAP56",2,0)
 ;;3.0;DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**56**; 10/24/97
"RTN","PSAP56",3,0)
 ;;References to ^PSDRUG( are covered by DBIA #2095
"RTN","PSAP56",4,0)
EN ;
"RTN","PSAP56",5,0)
 D EXIT
"RTN","PSAP56",6,0)
 S VSN=0 F  S VSN=$O(^PSDRUG("AVSN",VSN)) Q:VSN'>0  D VSN
"RTN","PSAP56",7,0)
 D MAILMSG,EXIT
"RTN","PSAP56",8,0)
 Q
"RTN","PSAP56",9,0)
VSN ;
"RTN","PSAP56",10,0)
 S DRDA=0,RXCNT=0 F  S DRDA=$O(^PSDRUG("AVSN",VSN,DRDA)) Q:DRDA'>0  D DRDA
"RTN","PSAP56",11,0)
 Q
"RTN","PSAP56",12,0)
DRDA ;process drug:VSN
"RTN","PSAP56",13,0)
 ;SYN0(counter)=node, SYNIEN(counter)=SYDA
"RTN","PSAP56",14,0)
 K SYN0,SYNIEN,SYNDUP,SYNDC,SYCNT
"RTN","PSAP56",15,0)
 S SYDA=0 F  S SYDA=$O(^PSDRUG("AVSN",VSN,DRDA,SYDA)) Q:SYDA'>0  D
"RTN","PSAP56",16,0)
 . ; if more DRUG VSN decendents process the DRUG
"RTN","PSAP56",17,0)
 .I +$O(^PSDRUG("AVSN",VSN,DRDA,SYDA)) D MORE
"RTN","PSAP56",18,0)
 Q
"RTN","PSAP56",19,0)
MORE ;
"RTN","PSAP56",20,0)
 K SYN0,SYNIEN,SYNDUP,SYNDC,SYCNT
"RTN","PSAP56",21,0)
 S SYNIEN=0 F  S SYNIEN=$O(^PSDRUG("AVSN",VSN,DRDA,SYNIEN)) Q:SYNIEN'>0  D
"RTN","PSAP56",22,0)
 .S SYCNT=$G(SYCNT)+1,SYN0(SYCNT)=^PSDRUG(DRDA,1,SYNIEN,0),SYNIEN(SYCNT)=SYNIEN
"RTN","PSAP56",23,0)
 .S SYDA=SYNIEN ; reset upper loop to end of VSNs
"RTN","PSAP56",24,0)
 ;
"RTN","PSAP56",25,0)
DUPS ;compare synonyms of the identical VSN/drug found
"RTN","PSAP56",26,0)
 K SYNDUP
"RTN","PSAP56",27,0)
 ;pairs of divisions may have set the same drug with different DUOU, dups then on sereval DUOU
"RTN","PSAP56",28,0)
 ;FIND EXACT MATCHES, store pairs in SYNDUP(N1,N2)="", and DELETE ALL BUT FIRST
"RTN","PSAP56",29,0)
 F N1=1:1:SYCNT-1 F N2=N1+1:1:SYCNT I SYN0(N1)=SYN0(N2) S SYNDUP(N1,N2)=""
"RTN","PSAP56",30,0)
 I '$D(SYNDUP) Q
"RTN","PSAP56",31,0)
 D DELETE
"RTN","PSAP56",32,0)
 D LOGDUP
"RTN","PSAP56",33,0)
 Q
"RTN","PSAP56",34,0)
DELETE ;
"RTN","PSAP56",35,0)
 Q:'$D(SYNDUP)
"RTN","PSAP56",36,0)
 S N1=0 F  S N1=$O(SYNDUP(N1)) Q:N1'>0  D
"RTN","PSAP56",37,0)
 . S N2=0 F  S N2=$O(SYNDUP(N1,N2)) Q:N2'>0  D
"RTN","PSAP56",38,0)
 . . K DIK S DA(1)=DRDA,DA=SYNIEN(N2),DIK="^PSDRUG("_DA(1)_",1," D ^DIK
"RTN","PSAP56",39,0)
 . . K SYNDC(N2) ;if dup N2 is removed its NDC match to others needs to be removed
"RTN","PSAP56",40,0)
 . . K SYNDUP(N2) ; if N2 has dups they will also have been picked up under N1 already
"RTN","PSAP56",41,0)
 Q
"RTN","PSAP56",42,0)
LOGDUP ;
"RTN","PSAP56",43,0)
 S DRGNM=$P(^PSDRUG(DRDA,0),U,1)
"RTN","PSAP56",44,0)
 S SYDAL=0 F  S SYDAL=$O(SYNDUP(SYDAL)) Q:SYDAL'>0  S ^TMP($J,"PSADUP",DRGNM,DRDA,SYNIEN(SYDAL))=0
"RTN","PSAP56",45,0)
 Q
"RTN","PSAP56",46,0)
 ;SYN0(SYCNT)=^PSDRUG(DRDA,1,SYDA,0)
"RTN","PSAP56",47,0)
 ;SYNIEN(SYCNT)=SYDA
"RTN","PSAP56",48,0)
 ;S SYNDUP(N1,N2)=""
"RTN","PSAP56",49,0)
 ;S SYNDC(N1,N2)=""
"RTN","PSAP56",50,0)
MAILMSG ; generate mail message of duplicates deleted.
"RTN","PSAP56",51,0)
 K ^TMP($J,"PSAMM")
"RTN","PSAP56",52,0)
 N DIFROM
"RTN","PSAP56",53,0)
 I $D(^TMP($J,"PSADUP")) I 1
"RTN","PSAP56",54,0)
 E  G NOMSG
"RTN","PSAP56",55,0)
 S X="PSA*3*56 DELETE DUPLICATE SYNONYMS REPORT" D MMLN
"RTN","PSAP56",56,0)
 S X="The following Drug-Synonyms have had identical synonyms removed from the drug." D MMLN
"RTN","PSAP56",57,0)
 S X="" D TXT("Drug Name",1),TXT("DRG#,SYN#",43),TXT("NDC",53),TXT("VSN",68),MMLN
"RTN","PSAP56",58,0)
 S DRGNM="" F  S DRGNM=$O(^TMP($J,"PSADUP",DRGNM)) Q:DRGNM=""  D DRIEN
"RTN","PSAP56",59,0)
 S XMSUB="PSA*3*56 Delete Duplicate Drug Synonyms report"
"RTN","PSAP56",60,0)
 S XMTEXT="^TMP($J,""PSAMM"",",XMDUZ="PSA*3*56 Post Init"
"RTN","PSAP56",61,0)
 S XMY(DUZ)=""
"RTN","PSAP56",62,0)
 D ^XMD
"RTN","PSAP56",63,0)
 Q
"RTN","PSAP56",64,0)
DRIEN ;work the specific drug
"RTN","PSAP56",65,0)
 S DRDA=0 F  S DRDA=$O(^TMP($J,"PSADUP",DRGNM,DRDA)) Q:DRDA'>0  D SYNDR
"RTN","PSAP56",66,0)
 Q
"RTN","PSAP56",67,0)
SYNDR ; work synonyms under a drug
"RTN","PSAP56",68,0)
 S SYNDA=0 F  S SYNDA=$O(^TMP($J,"PSADUP",DRGNM,DRDA,SYNDA)) Q:SYNDA'>0  D SYN
"RTN","PSAP56",69,0)
 Q
"RTN","PSAP56",70,0)
SYN ;report the individual synonym that had duplicates deleted
"RTN","PSAP56",71,0)
 K SYNFLD
"RTN","PSAP56",72,0)
 ;2-NDC'2 400-VSN'4 401-OU'5 402-PPOU'6 403-DUOU'7 404-PPDU'8
"RTN","PSAP56",73,0)
 S SYN0=^PSDRUG(DRDA,1,SYNDA,0),X=SYN0,DA=SYNDA,DA(1)=DRDA,IENS=DA_","_DA(1)_","
"RTN","PSAP56",74,0)
 S NDC=$P(X,U,2),VSN=$P(X,U,4),PPOU="PPOU: $"_$P(X,U,6),DUOU="DUOU: "_$P(X,U,7),PPDU="PPDU: $"_$P(X,U,8)
"RTN","PSAP56",75,0)
 S OU="OU: "_$$GET1^DIQ(50.1,IENS,401),DA(1)=DRDA
"RTN","PSAP56",76,0)
 S X="" D TXT(DRGNM,1),TXT(DRDA_","_SYNDA,43),TXT(NDC,53),TXT(VSN,68) D MMLN
"RTN","PSAP56",77,0)
 S X="" D TXT(OU,1),TXT(PPOU,15),TXT(DUOU,45),TXT(PPDU,60) D MMLN
"RTN","PSAP56",78,0)
 Q
"RTN","PSAP56",79,0)
MMLN S MMLC=+$G(MMLC)+1 S ^TMP($J,"PSAMM",MMLC)=X Q
"RTN","PSAP56",80,0)
TXT(VAL,COL) S:'$D(X) X="" S X=$$SETSTR^VALM1(VAL,X,COL,$L(VAL)) Q
"RTN","PSAP56",81,0)
NOMSG ; report no duplicates found to remove.
"RTN","PSAP56",82,0)
 S X="PSA*3*56 DELETE DUPLICATE SYNONYMS REPORT" D MMLN
"RTN","PSAP56",83,0)
 S X=" " D MMLN
"RTN","PSAP56",84,0)
 S X="There were no duplicate drug-synonyms found. No synonyms removed." D MMLN
"RTN","PSAP56",85,0)
 S XMSUB="PSA*3*56 Delete Duplicate Drug Synonyms report"
"RTN","PSAP56",86,0)
 S XMTEXT="^TMP($J,""PSAMM"",",XMDUZ="PSA*3*56 Post Init"
"RTN","PSAP56",87,0)
 S XMY(DUZ)=""
"RTN","PSAP56",88,0)
 D ^XMD
"RTN","PSAP56",89,0)
EXIT ;
"RTN","PSAP56",90,0)
 K COL,DIK,DRDA,DRGNM,DUOU,IENS,MMLC,N1,N2,NDC,OU,PPDU,DDOU,RXCNT,SYCNT,SYDA,SYN0
"RTN","PSAP56",91,0)
 K SYNDA,SYNDC,SYNDUP,SYNFLD,SYNIEN,SYN0,^TMP($J),VAL,VSN,PPOU,SYDAL
"RTN","PSAP56",92,0)
 Q
"RTN","PSAVER7")
0^1^B21998515^B16426253
"RTN","PSAVER7",1,0)
PSAVER7 ;BIR/JMB-Verify Invoices - CONT'D ;7/23/97
"RTN","PSAVER7",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**12,21,42,56**; 10/24/97
"RTN","PSAVER7",3,0)
 ;Background Job
"RTN","PSAVER7",4,0)
 ;This routine increments pharmacy location and master vault balances
"RTN","PSAVER7",5,0)
 ;in 58.8 after invoices have been verified. This routine is called
"RTN","PSAVER7",6,0)
 ;by PSAVER6.
"RTN","PSAVER7",7,0)
 ;
"RTN","PSAVER7",8,0)
 ;References to ^PSDRUG( are covered by IA #2095
"RTN","PSAVER7",9,0)
TR ;File transaction data in 58.81
"RTN","PSAVER7",10,0)
 I $D(PSADUREC),'PSADUREC Q  ;*56 block '0' quantity edits
"RTN","PSAVER7",11,0)
 I $D(PSAQTY),'PSAQTY Q  ;*56 block '0' quantity edits
"RTN","PSAVER7",12,0)
 F  L +^PSD(58.81,0):0 I  Q
"RTN","PSAVER7",13,0)
FIND S PSAT=$P(^PSD(58.81,0),"^",3)+1 I $D(^PSD(58.81,PSAT)) S $P(^PSD(58.81,0),"^",3)=$P(^PSD(58.81,0),"^",3)+1 G FIND
"RTN","PSAVER7",14,0)
 S DIC="^PSD(58.81,",DIC(0)="L",DLAYGO=58.81,(DINUM,X)=PSAT D ^DIC K DIC,DINUM,DLAYGO L -^PSD(58.81,0)
"RTN","PSAVER7",15,0)
 S DIE="^PSD(58.81,",DA=PSAT,DR="1////1;2////^S X=PSALOC;3////^S X=PSADT;4////^S X=PSADRG;5////^S X=PSADUREC;6////^S X=PSAVDUZ;9////^S X=PSABAL;71////^S X=PSAINV;106////^S X=PSAORD"
"RTN","PSAVER7",16,0)
 I $G(PSACS) S DR=DR_";100////^S X=PSACS"
"RTN","PSAVER7",17,0)
 F  L +^PSD(58.81,DA,0):0 I  Q
"RTN","PSAVER7",18,0)
 D ^DIE L -^PSD(58.81,DA,0) K DIE
"RTN","PSAVER7",19,0)
 S:'$D(^PSD(58.8,PSALOC,1,PSADRG,4,0)) DIC("P")=$P(^DD(58.8001,19,0),"^",2)
"RTN","PSAVER7",20,0)
 S DA(2)=PSALOC,DA(1)=PSADRG,(X,DINUM)=PSAT,DIC="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",4,",DIC(0)="L",DLAYGO=58.8
"RTN","PSAVER7",21,0)
 F  L +^PSD(58.8,PSALOC,1,PSADRG,0):0 I  Q
"RTN","PSAVER7",22,0)
 D ^DIC L -^PSD(58.8,PSALOC,1,PSADRG,0) K DIC,DINUM,DLAYGO
"RTN","PSAVER7",23,0)
 ;
"RTN","PSAVER7",24,0)
50 S PSAODASH=$P($G(^PSDRUG(PSADRG,2)),"^",4)
"RTN","PSAVER7",25,0)
 S PSAONDC=$P(PSAODASH,"-")_$P(PSAODASH,"-",2)_$P(PSAODASH,"-",3)
"RTN","PSAVER7",26,0)
 ;(PSA*3*21) NDC & PRICING UPDATES (DAVE BLOCKER 10NOV99)
"RTN","PSAVER7",27,0)
 S PSADUOU=$S($G(PSADUOU)'>0:1,1:PSADUOU)
"RTN","PSAVER7",28,0)
 S PSADUREC=(PSAQTY*PSADUOU)
"RTN","PSAVER7",29,0)
 S DIE="^PSDRUG(",DA=PSADRG,DR="50////^S X="_(PSADUREC+$G(^PSDRUG(PSADRG,660.1)))
"RTN","PSAVER7",30,0)
 F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAVER7",31,0)
 D ^DIE L -^PSDRUG(DA,0) K DIE,DA,DR
"RTN","PSAVER7",32,0)
 ;This section replaces most of the routine
"RTN","PSAVER7",33,0)
 ;PSAOU = order unit from invoice
"RTN","PSAVER7",34,0)
 ;PSAPOU & PSANPOU = Price of Order Unit from invoice
"RTN","PSAVER7",35,0)
 ;PSADUOU=Dispense Units per OU form invoice data
"RTN","PSAVER7",36,0)
 ;PSANPDU= Price of Dispense Units per Order Unit
"RTN","PSAVER7",37,0)
 ;
"RTN","PSAVER7",38,0)
 ;Drug file Information
"RTN","PSAVER7",39,0)
 K DRUG
"RTN","PSAVER7",40,0)
 S PSANODE=$G(^PSDRUG(PSADRG,660))
"RTN","PSAVER7",41,0)
 F X=2,3,5,6 S DRUG(X)=$P($G(PSANODE),"^",X)
"RTN","PSAVER7",42,0)
 ;
"RTN","PSAVER7",43,0)
 S PSANPDU=$J(($G(PSAPOU)/$G(PSADUOU)),0,3) ;Price of Order Unit divide by Disp. Units per Order Unit
"RTN","PSAVER7",44,0)
 ;PSA*3*42 |>  (let changes happen and file, put changes into mail message)
"RTN","PSAVER7",45,0)
 S DIE="^PSDRUG(",DA=PSADRG,DR="12////^S X=PSAOU;15////^S X=PSADUOU;Q;13////^S X=PSAPOU" ;*42;*56
"RTN","PSAVER7",46,0)
 F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAVER7",47,0)
 D ^DIE K DIE,DA,DR
"RTN","PSAVER7",48,0)
 ; <| PSA*42
"RTN","PSAVER7",49,0)
PTCH21 ;PSA*3*21 (Vendor's VSN changing to 8 digits, check also)
"RTN","PSAVER7",50,0)
 ;If NDC or VSN changes should it create to synonym entry ?
"RTN","PSAVER7",51,0)
 I $G(^PSDRUG(PSADRG,1,PSASUB,0))="" G NDC
"RTN","PSAVER7",52,0)
 I $G(^PSDRUG(PSADRG,1,PSASUB,0)) S PSAEDTT=0,DATA=^PSDRUG(PSADRG,1,PSASUB,0) D
"RTN","PSAVER7",53,0)
 .I PSAVSN'=$P(DATA,"^",4) S PSAEDTT=1 ;VSN
"RTN","PSAVER7",54,0)
 .I PSAPOU'=$P(DATA,"^",6) S PSAEDTT=1 ;Price per order unit
"RTN","PSAVER7",55,0)
 .I PSADUOU'=$P(DATA,"^",7) S PSAEDTT=1 ;Dispense Units per Order Unit
"RTN","PSAVER7",56,0)
 .I PSANPDU'=$P(DATA,"^",8) S PSAEDTT=1 ;New Price per dispense unit
"RTN","PSAVER7",57,0)
 .I $G(PSAEDTT)>0 D
"RTN","PSAVER7",58,0)
 ..S DA=PSASUB,DA(1)=PSADRG,DIE="^PSDRUG("_DA(1)_",1,"
"RTN","PSAVER7",59,0)
 ..S DR="2////^S X=PSADASH"_$S(PSACS:";1////C",1:";1////D")_";400////^S X=PSAVSN;401////^S X=PSAOU"_$S(+PSAPOU:";402////^S X=PSAPOU",1:"")_";403////^S X=PSADUOU"_";404///^S X=PSANPDU"_";405///^S X=PSAVEND"
"RTN","PSAVER7",60,0)
 ..D ^DIE K DIE,DR,DA
"RTN","PSAVER7",61,0)
NDC ;NDC UPDATE
"RTN","PSAVER7",62,0)
 I PSANDC'="",PSANDC'=PSAONDC D  ;*42
"RTN","PSAVER7",63,0)
 .S DIE="^PSDRUG(",DA=PSADRG,DR="31////^S X=PSADASH"
"RTN","PSAVER7",64,0)
 .F  L +^PSDRUG(DA,0):0 I  Q
"RTN","PSAVER7",65,0)
 .D ^DIE L -^PSDRUG(DA,0) K DIE,DA,DR
"RTN","PSAVER7",66,0)
SYNONYM ;Adds/edits the SYNONYM multiple in DRUG file
"RTN","PSAVER7",67,0)
 Q:PSANDC=""  K DA,DR S DA(1)=PSADRG
"RTN","PSAVER7",68,0)
 ;
"RTN","PSAVER7",69,0)
 S PSANPDU=$J(($G(PSAPOU)/$G(PSADUOU)),0,3) ;Price of Order Unit divide by Disp. Units per Order Unit
"RTN","PSAVER7",70,0)
 S:'$D(^PSDRUG(PSADRG,1,0)) DIC("P")="50.1A"
"RTN","PSAVER7",71,0)
 ; *56 Search for earliest best match of synonyms, start at bottom go up
"RTN","PSAVER7",72,0)
 ; if VSN use it, if several VSNs use the first, IF VSN match NDCs must match also.
"RTN","PSAVER7",73,0)
 ; if no VSN, make a new synonym
"RTN","PSAVER7",74,0)
 ; no "B" synonym index exists
"RTN","PSAVER7",75,0)
T0 N PSYNDA,PSYN0,PSTNDC,PSTVSN,PSMNDC,PSMBTH S (PSMNDC,PSMBTH)=0
"RTN","PSAVER7",76,0)
 S PSYNDA="" F  S PSYNDA=$O(^PSDRUG(PSADRG,1,PSYNDA),-1) Q:PSYNDA'>0  D
"RTN","PSAVER7",77,0)
 . S PSYN0=^PSDRUG(PSADRG,1,PSYNDA,0),PSTNDC=$P(PSYN0,U),PSTVSN=$P(PSYN0,U,4) ;zero node, test values of NDC VSN
"RTN","PSAVER7",78,0)
 . I PSTNDC'=PSANDC Q
"RTN","PSAVER7",79,0)
 . I PSTVSN=PSAVSN S PSMBTH=PSYNDA Q  ;both VSN & NDC matches
"RTN","PSAVER7",80,0)
T1 S PSASUB=$S(PSMBTH:PSMBTH,1:0) ;PSAMBTH Match both vsn,ndc
"RTN","PSAVER7",81,0)
 ;end *56
"RTN","PSAVER7",82,0)
 I 'PSASUB!(PSASUB&('$D(^PSDRUG(PSADRG,1,PSASUB,0)))) D
"RTN","PSAVER7",83,0)
 .S DIC="^PSDRUG("_DA(1)_",1,",DIC(0)="Z",X=PSANDC,DLAYGO=50
"RTN","PSAVER7",84,0)
 .F  L +^PSDRUG(PSADRG,0):0 I  Q
"RTN","PSAVER7",85,0)
 .D FILE^DICN L -^PSDRUG(PSADRG,0) K DIC,DLAYGO S PSASUB=+Y
"RTN","PSAVER7",86,0)
 .K DIC,DA,DR,DIE
"RTN","PSAVER7",87,0)
 I PSASUB,$D(^PSDRUG(PSADRG,1,PSASUB,0)) S DA=PSASUB
"RTN","PSAVER7",88,0)
 S DA(1)=PSADRG,DIE="^PSDRUG("_DA(1)_",1,"
"RTN","PSAVER7",89,0)
 S DR="2////^S X=PSADASH"_$S($G(PSACS)>0:";1////C",1:";1////D")_";400////^S X=PSAVSN;401////^S X=PSAOU"_$S(+PSAPOU:";402////^S X=PSAPOU",1:"")_";403////^S X=PSADUOU"_";404///^S X=PSANPDU;405///^S X=PSAVEND"
"RTN","PSAVER7",90,0)
 F  L +^PSDRUG(PSADRG,0):0 I  Q
"RTN","PSAVER7",91,0)
 D ^DIE L -^PSDRUG(PSADRG,0)
"RTN","PSAVER7",92,0)
 K DIE,DR,X1,X2,DATA
"RTN","PSAVER7",93,0)
 Q
"VER")
8.0^22.0
"BLD",6458,6)
^40
**END**
**END**
