Released OR*3*249 SEQ #235
Extracted from mail message
**KIDS**:OR*3.0*249^

**INSTALL NAME**
OR*3.0*249
"BLD",6748,0)
OR*3.0*249^ORDER ENTRY/RESULTS REPORTING^0^3060406^y
"BLD",6748,1,0)
^^2^2^3060406^
"BLD",6748,1,1,0)
THIS PATCH ADDRESSES A PROBLEM WITH THE PROBLEM LIST LEX SEARCH AND ADDS 
"BLD",6748,1,2,0)
THE WORD DRUG TO THE ORDER CHECK  DUPLICATE DRUG CHECK WARNING.
"BLD",6748,4,0)
^9.64PA^^
"BLD",6748,"KRN",0)
^9.67PA^8989.52^19
"BLD",6748,"KRN",.4,0)
.4
"BLD",6748,"KRN",.401,0)
.401
"BLD",6748,"KRN",.402,0)
.402
"BLD",6748,"KRN",.403,0)
.403
"BLD",6748,"KRN",.5,0)
.5
"BLD",6748,"KRN",.84,0)
.84
"BLD",6748,"KRN",3.6,0)
3.6
"BLD",6748,"KRN",3.8,0)
3.8
"BLD",6748,"KRN",9.2,0)
9.2
"BLD",6748,"KRN",9.8,0)
9.8
"BLD",6748,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6748,"KRN",9.8,"NM",1,0)
ORQQPL1^^0^63041936
"BLD",6748,"KRN",9.8,"NM",2,0)
ORKCHK4^^0^26885813
"BLD",6748,"KRN",9.8,"NM",3,0)
ORKCHK6^^0^27434561
"BLD",6748,"KRN",9.8,"NM","B","ORKCHK4",2)
 
"BLD",6748,"KRN",9.8,"NM","B","ORKCHK6",3)
 
"BLD",6748,"KRN",9.8,"NM","B","ORQQPL1",1)
 
"BLD",6748,"KRN",19,0)
19
"BLD",6748,"KRN",19,"NM",0)
^9.68A^^
"BLD",6748,"KRN",19.1,0)
19.1
"BLD",6748,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6748,"KRN",101,0)
101
"BLD",6748,"KRN",409.61,0)
409.61
"BLD",6748,"KRN",771,0)
771
"BLD",6748,"KRN",870,0)
870
"BLD",6748,"KRN",8989.51,0)
8989.51
"BLD",6748,"KRN",8989.52,0)
8989.52
"BLD",6748,"KRN",8994,0)
8994
"BLD",6748,"KRN","B",.4,.4)
 
"BLD",6748,"KRN","B",.401,.401)
 
"BLD",6748,"KRN","B",.402,.402)
 
"BLD",6748,"KRN","B",.403,.403)
 
"BLD",6748,"KRN","B",.5,.5)
 
"BLD",6748,"KRN","B",.84,.84)
 
"BLD",6748,"KRN","B",3.6,3.6)
 
"BLD",6748,"KRN","B",3.8,3.8)
 
"BLD",6748,"KRN","B",9.2,9.2)
 
"BLD",6748,"KRN","B",9.8,9.8)
 
"BLD",6748,"KRN","B",19,19)
 
"BLD",6748,"KRN","B",19.1,19.1)
 
"BLD",6748,"KRN","B",101,101)
 
"BLD",6748,"KRN","B",409.61,409.61)
 
"BLD",6748,"KRN","B",771,771)
 
"BLD",6748,"KRN","B",870,870)
 
"BLD",6748,"KRN","B",8989.51,8989.51)
 
"BLD",6748,"KRN","B",8989.52,8989.52)
 
"BLD",6748,"KRN","B",8994,8994)
 
"BLD",6748,"QUES",0)
^9.62^^
"BLD",6748,"REQB",0)
^9.611^2^2
"BLD",6748,"REQB",1,0)
OR*3.0*206^2
"BLD",6748,"REQB",2,0)
OR*3.0*190^2
"BLD",6748,"REQB","B","OR*3.0*190",2)
 
"BLD",6748,"REQB","B","OR*3.0*206",1)
 
"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2971217^2980417^1271
"PKG",167,22,1,"PAH",1,0)
249^3060406
"PKG",167,22,1,"PAH",1,1,0)
^^2^2^3060406
"PKG",167,22,1,"PAH",1,1,1,0)
THIS PATCH ADDRESSES A PROBLEM WITH THE PROBLEM LIST LEX SEARCH AND ADDS 
"PKG",167,22,1,"PAH",1,1,2,0)
THE WOR DRUG TO THE ORDER CHECK  DUPLICATE DRUG CHECK WARNING.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ORKCHK4")
0^2^B26885813^B26734530
"RTN","ORKCHK4",1,0)
ORKCHK4 ; slc/CLA - Support routine called by ORKCHK to do SELECT mode order checks ;3/6/97  9:35
"RTN","ORKCHK4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,74,87,94,123,162,190,249**;Dec 17, 1997
"RTN","ORKCHK4",3,0)
 Q
"RTN","ORKCHK4",4,0)
 ;
"RTN","ORKCHK4",5,0)
EN(ORKS,ORKDFN,ORKA,ORENT,ORKTMODE) ;perform order checking for orderable item selection
"RTN","ORKCHK4",6,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE",1,"I")="D"
"RTN","ORKCHK4",7,0)
 ;
"RTN","ORKCHK4",8,0)
 N OI,ORKDG,HL7,ODT,ORNUM,HL7NPTR,HL7NTXT,HL7NCOD,HL7LPTR,HL7LTXT,HL7LCOD
"RTN","ORKCHK4",9,0)
 N ORKMSG,ORKT,ORKTXT
"RTN","ORKCHK4",10,0)
 ;
"RTN","ORKCHK4",11,0)
 S OI=$P(ORKA,"|"),ORKDG=$P(ORKA,"|",2)
"RTN","ORKCHK4",12,0)
 S HL7=$P(ORKA,"|",3),ODT=$P(ORKA,"|",4),ORNUM=$P(ORKA,"|",5)
"RTN","ORKCHK4",13,0)
 S HL7NPTR=$P(HL7,U),HL7NTXT=$P(HL7,U,2),HL7NCOD=$P(HL7,U,3)
"RTN","ORKCHK4",14,0)
 S HL7LPTR=$P(HL7,U,4),HL7LTXT=$P(HL7,U,5),HL7LCOD=$P(HL7,U,6)
"RTN","ORKCHK4",15,0)
 ;
"RTN","ORKCHK4",16,0)
 I $E(ORKDG,1,2)="PS" D PHARM
"RTN","ORKCHK4",17,0)
 I $E(ORKDG,1,2)'="PS" D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SELECT")
"RTN","ORKCHK4",18,0)
 Q
"RTN","ORKCHK4",19,0)
 ;
"RTN","ORKCHK4",20,0)
PHARM ;process pharmacy order checks:
"RTN","ORKCHK4",21,0)
 N ORPSPKG,ORPSA,ORKDD
"RTN","ORKCHK4",22,0)
 N ORCRITN,ORCRITF,ORCRITD,ORSIGN,ORSIGF,ORSIGD,ORDUPN,ORDUPF,ORDUPD,ORDUPCN,ORDUPCF,ORDUPCD
"RTN","ORKCHK4",23,0)
 ;
"RTN","ORKCHK4",24,0)
 D PARAMS("CRITICAL DRUG INTERACTION",.ORCRITN,.ORCRITF,.ORCRITD)
"RTN","ORKCHK4",25,0)
 D PARAMS("SIGNIFICANT DRUG INTERACTION",.ORSIGN,.ORSIGF,.ORSIGD)
"RTN","ORKCHK4",26,0)
 D PARAMS("DUPLICATE DRUG ORDER",.ORDUPN,.ORDUPF,.ORDUPD)
"RTN","ORKCHK4",27,0)
 D PARAMS("DUPLICATE DRUG CLASS ORDER",.ORDUPCN,.ORDUPCF,.ORDUPCD)
"RTN","ORKCHK4",28,0)
 ;
"RTN","ORKCHK4",29,0)
 ;dispense drug selected:
"RTN","ORKCHK4",30,0)
 I $L($G(HL7LPTR)),($G(HL7LCOD)="99PSD") D
"RTN","ORKCHK4",31,0)
 .D RXOCS
"RTN","ORKCHK4",32,0)
 .D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SELECT")
"RTN","ORKCHK4",33,0)
 ;
"RTN","ORKCHK4",34,0)
 ;dispense drug NOT selected, split OI into dispense drugs:
"RTN","ORKCHK4",35,0)
 I '$L($G(HL7LPTR)) D
"RTN","ORKCHK4",36,0)
 .S ORPSPKG=$E(ORKDG,3)
"RTN","ORKCHK4",37,0)
 .I ORPSPKG="H" S ORPSPKG="X"  ;change to "X" if "H"erbal/non-VA med
"RTN","ORKCHK4",38,0)
 .I "IOX"[ORPSPKG D OI2DD(.ORPSA,OI,ORPSPKG)
"RTN","ORKCHK4",39,0)
 .S ORKDD=0 F  S ORKDD=$O(ORPSA(ORKDD)) Q:'ORKDD  D
"RTN","ORKCHK4",40,0)
 ..S HL7LTXT=ORPSA(ORKDD)
"RTN","ORKCHK4",41,0)
 ..S HL7NPTR=$P(ORKDD,";",2)
"RTN","ORKCHK4",42,0)
 ..S HL7LPTR=+ORKDD
"RTN","ORKCHK4",43,0)
 ..S HL7LCOD="99PSD",HL7NCOD="99NDF"
"RTN","ORKCHK4",44,0)
 ..S $P(HL7,U)=HL7NPTR,$P(HL7,U,3)=HL7NCOD
"RTN","ORKCHK4",45,0)
 ..S $P(HL7,U,4)=HL7LPTR,$P(HL7,U,5)=HL7LTXT,$P(HL7,U,6)=HL7LCOD
"RTN","ORKCHK4",46,0)
 ..S $P(ORKA,"|",3)=HL7  ;set these for MLM OCX call
"RTN","ORKCHK4",47,0)
 ..D RXOCS
"RTN","ORKCHK4",48,0)
 ..D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SELECT")
"RTN","ORKCHK4",49,0)
 Q
"RTN","ORKCHK4",50,0)
 ;
"RTN","ORKCHK4",51,0)
RXOCS ;drug-drug interaction, duplicate drug order, duplicate drug class
"RTN","ORKCHK4",52,0)
 Q:ORCRITF_ORSIGF_ORDUPF_ORDUPCF'["E"  ;quit if none are "E"nabled
"RTN","ORKCHK4",53,0)
 N ORKRX,ORPSNUM
"RTN","ORKCHK4",54,0)
 D CHECK^ORKPS(.ORKRX,ORKDFN,HL7LPTR,OI,ORKDG)
"RTN","ORKCHK4",55,0)
 N CHK,XX S CHK=0,XX=""
"RTN","ORKCHK4",56,0)
 F  S CHK=$O(ORKRX(CHK)) Q:'CHK  D
"RTN","ORKCHK4",57,0)
 .S XX=ORKRX(CHK)
"RTN","ORKCHK4",58,0)
 .;
"RTN","ORKCHK4",59,0)
 .;critical drug interaction:
"RTN","ORKCHK4",60,0)
 .I $P(XX,U)="DI",$P(XX,U,5)="CRITICAL" D  ;,(ORKTMODE'="ALL") D
"RTN","ORKCHK4",61,0)
 ..Q:ORCRITF="D"
"RTN","ORKCHK4",62,0)
 ..S ORPSNUM=$P(XX,U,8)  ;get the associated order number
"RTN","ORKCHK4",63,0)
 ..I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK4",64,0)
 ..E  S ORKTXT=$P(XX,U,3)
"RTN","ORKCHK4",65,0)
 ..S ORKMSG=$P(XX,U,5)_" drug-drug interaction: "_$P(XX,U,6)_" & "_$P(XX,U,7)
"RTN","ORKCHK4",66,0)
 ..S ORKS("ORK",ORCRITD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORCRITN_U_ORCRITD_U_ORKMSG_" ("_ORKTXT_")"_U_$G(ORPSNUM)
"RTN","ORKCHK4",67,0)
 .;
"RTN","ORKCHK4",68,0)
 .;significant drug interaction:
"RTN","ORKCHK4",69,0)
 .I $P(XX,U)="DI",$P(XX,U,5)="SIGNIFICANT" D  ;,(ORKTMODE'="ALL") D
"RTN","ORKCHK4",70,0)
 ..Q:ORSIGF="D"
"RTN","ORKCHK4",71,0)
 ..S ORPSNUM=$P(XX,U,8)  ;get the associated order number
"RTN","ORKCHK4",72,0)
 ..I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK4",73,0)
 ..E  S ORKTXT=$P(XX,U,3)
"RTN","ORKCHK4",74,0)
 ..S ORKMSG=$P(XX,U,5)_" drug-drug interaction: "_$P(XX,U,6)_" & "_$P(XX,U,7)
"RTN","ORKCHK4",75,0)
 ..S ORKS("ORK",ORSIGD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORSIGN_U_ORSIGD_U_ORKMSG_" ("_ORKTXT_")"_U_$G(ORPSNUM)
"RTN","ORKCHK4",76,0)
 .;
"RTN","ORKCHK4",77,0)
 .;duplicate drug:
"RTN","ORKCHK4",78,0)
 .I $P(XX,U)="DD" D  ;,(ORKTMODE'="ALL") D
"RTN","ORKCHK4",79,0)
 ..Q:ORDUPF="D"
"RTN","ORKCHK4",80,0)
 ..S ORPSNUM=$P(XX,U,4)  ;get the associated order number
"RTN","ORKCHK4",81,0)
 ..I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK4",82,0)
 ..E  S ORKTXT=$P(XX,U,3)
"RTN","ORKCHK4",83,0)
 ..S ORKMSG="Duplicate drug order: "_ORKTXT
"RTN","ORKCHK4",84,0)
 ..S ORKS("ORK",ORDUPD_","_$G(ORNUM)_","_ORPSNUM_",Duplicate drug order: "_$P(XX,U,3))=ORNUM_U_ORDUPN_U_ORDUPD_U_ORKMSG_U_$G(ORPSNUM)
"RTN","ORKCHK4",85,0)
 .;
"RTN","ORKCHK4",86,0)
 .;duplicate class:
"RTN","ORKCHK4",87,0)
 .I $P(XX,U)="DC" D  ;,(ORKTMODE'="ALL") D
"RTN","ORKCHK4",88,0)
 ..Q:ORDUPCF="D"
"RTN","ORKCHK4",89,0)
 ..S ORPSNUM=$P(XX,U,6)  ;get the associated order number
"RTN","ORKCHK4",90,0)
 ..I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK4",91,0)
 ..E  S ORKTXT=$P(XX,U,5)
"RTN","ORKCHK4",92,0)
 ..S ORKMSG="Duplicate drug class order: "_$P(XX,U,3)
"RTN","ORKCHK4",93,0)
 ..S ORKS("ORK",ORDUPCD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORDUPCN_U_ORDUPCD_U_ORKMSG_" ("_ORKTXT_")"_U_$G(ORPSNUM)
"RTN","ORKCHK4",94,0)
 Q
"RTN","ORKCHK4",95,0)
 ;
"RTN","ORKCHK4",96,0)
OI2DD(ORPSA,OROI,ORPSPKG)       ;rtn dispense drugs for a PS OI
"RTN","ORKCHK4",97,0)
 N PSOI
"RTN","ORKCHK4",98,0)
 Q:'$D(^ORD(101.43,OROI,0))
"RTN","ORKCHK4",99,0)
 S PSOI=$P($P(^ORD(101.43,OROI,0),U,2),";")
"RTN","ORKCHK4",100,0)
 Q:+$G(PSOI)<1
"RTN","ORKCHK4",101,0)
 D DRG^PSSUTIL1(.ORPSA,PSOI,ORPSPKG)
"RTN","ORKCHK4",102,0)
 Q
"RTN","ORKCHK4",103,0)
 ;
"RTN","ORKCHK4",104,0)
PARAMS(ORKNAME,ORKNUM,ORKFLAG,ORKDNGR) ; get parameter values for an order chk
"RTN","ORKCHK4",105,0)
 S ORKNUM=0,ORKNUM=$O(^ORD(100.8,"B",ORKNAME,ORKNUM))
"RTN","ORKCHK4",106,0)
 S ORKFLAG=$$GET^XPAR(ORENT,"ORK PROCESSING FLAG",ORKNUM,"I")
"RTN","ORKCHK4",107,0)
 S ORKDNGR=$$GET^XPAR("DIV^SYS^PKG","ORK CLINICAL DANGER LEVEL",ORKNUM,"I")
"RTN","ORKCHK4",108,0)
 Q
"RTN","ORKCHK6")
0^3^B27434561^B27280482
"RTN","ORKCHK6",1,0)
ORKCHK6 ; slc/CLA - Support routine called by ORKCHK to do SESSION mode order checks ;3/6/97  9:35
"RTN","ORKCHK6",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,32,74,87,94,123,162,190,249**;Dec 17, 1997
"RTN","ORKCHK6",3,0)
 Q
"RTN","ORKCHK6",4,0)
 ;
"RTN","ORKCHK6",5,0)
EN(ORKS,ORKDFN,ORKA,ORENT,ORKTMODE) ;perform order checking for entire ordering session
"RTN","ORKCHK6",6,0)
 Q:$$GET^XPAR("DIV^SYS^PKG","ORK SYSTEM ENABLE/DISABLE",1,"I")="D"
"RTN","ORKCHK6",7,0)
 ;
"RTN","ORKCHK6",8,0)
 N OI,ORKDG,HL7,ODT,ORNUM,HL7NPTR,HL7NTXT,HL7NCOD,HL7LPTR,HL7LTXT,HL7LCOD
"RTN","ORKCHK6",9,0)
 N ORKMSG,ORKDGI,ORKT,ORKTXT,ORKPDATA
"RTN","ORKCHK6",10,0)
 ;
"RTN","ORKCHK6",11,0)
 S OI=$P(ORKA,"|"),ORKDG=$P(ORKA,"|",2),HL7=$P(ORKA,"|",3)
"RTN","ORKCHK6",12,0)
 S ODT=$P(ORKA,"|",4),ORNUM=$P(ORKA,"|",5),ORKPDATA=$P(ORKA,"|",6)
"RTN","ORKCHK6",13,0)
 S HL7NPTR=$P(HL7,U),HL7NTXT=$P(HL7,U,2),HL7NCOD=$P(HL7,U,3)
"RTN","ORKCHK6",14,0)
 S HL7LPTR=$P(HL7,U,4),HL7LTXT=$P(HL7,U,5),HL7LCOD=$P(HL7,U,6)
"RTN","ORKCHK6",15,0)
 ;
"RTN","ORKCHK6",16,0)
 S:ORKDG="PSJ" ORKDG="PSI"
"RTN","ORKCHK6",17,0)
 I $E(ORKDG,1,2)="PS" D PHARM
"RTN","ORKCHK6",18,0)
 I $E(ORKDG,1,2)'="PS" D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SESSION")
"RTN","ORKCHK6",19,0)
 Q
"RTN","ORKCHK6",20,0)
 ;
"RTN","ORKCHK6",21,0)
PHARM ;process pharmacy order checks:
"RTN","ORKCHK6",22,0)
 N ORPSPKG,ORPSA,ORKDD
"RTN","ORKCHK6",23,0)
 N ORCRITN,ORCRITF,ORCRITD,ORSIGN,ORSIGF,ORSIGD,ORDUPN,ORDUPF,ORDUPD,ORDUPC,ORDUPCF,ORDUPCD
"RTN","ORKCHK6",24,0)
 ;
"RTN","ORKCHK6",25,0)
 D PARAMS("CRITICAL DRUG INTERACTION",.ORCRITN,.ORCRITF,.ORCRITD)
"RTN","ORKCHK6",26,0)
 D PARAMS("SIGNIFICANT DRUG INTERACTION",.ORSIGN,.ORSIGF,.ORSIGD)
"RTN","ORKCHK6",27,0)
 D PARAMS("DUPLICATE DRUG ORDER",.ORDUPN,.ORDUPF,.ORDUPD)
"RTN","ORKCHK6",28,0)
 D PARAMS("DUPLICATE DRUG CLASS ORDER",.ORDUPCN,.ORDUPCF,.ORDUPCD)
"RTN","ORKCHK6",29,0)
 ;
"RTN","ORKCHK6",30,0)
 ;dispense drug selected:
"RTN","ORKCHK6",31,0)
 I $L($G(HL7LPTR)),($G(HL7LCOD)="99PSD") D
"RTN","ORKCHK6",32,0)
 .D RXOCS
"RTN","ORKCHK6",33,0)
 .D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SESSION")
"RTN","ORKCHK6",34,0)
 ;
"RTN","ORKCHK6",35,0)
 ;dispense drug NOT selected, split OI into dispense drugs:
"RTN","ORKCHK6",36,0)
 I '$L($G(HL7LPTR)) D
"RTN","ORKCHK6",37,0)
 .S ORPSPKG=$E(ORKDG,3)
"RTN","ORKCHK6",38,0)
 .I ORPSPKG="H" S ORPSPKG="X"  ;change to "X" if "H"erbal/non-VA med
"RTN","ORKCHK6",39,0)
 .I "IOX"[ORPSPKG D OI2DD(.ORPSA,OI,ORPSPKG)
"RTN","ORKCHK6",40,0)
 .S ORKDD=0 F  S ORKDD=$O(ORPSA(ORKDD)) Q:'ORKDD  D
"RTN","ORKCHK6",41,0)
 ..S HL7LTXT=ORPSA(ORKDD)
"RTN","ORKCHK6",42,0)
 ..S HL7NPTR=$P(ORKDD,";",2)
"RTN","ORKCHK6",43,0)
 ..S HL7LPTR=+ORKDD
"RTN","ORKCHK6",44,0)
 ..S HL7LCOD="99PSD",HL7NCOD="99NDF"
"RTN","ORKCHK6",45,0)
 ..S $P(HL7,U)=HL7NPTR,$P(HL7,U,3)=HL7NCOD
"RTN","ORKCHK6",46,0)
 ..S $P(HL7,U,4)=HL7LPTR,$P(HL7,U,5)=HL7LTXT,$P(HL7,U,6)=HL7LCOD
"RTN","ORKCHK6",47,0)
 ..S $P(ORKA,"|",3)=HL7  ;set these for MLM OCX call
"RTN","ORKCHK6",48,0)
 ..D RXOCS
"RTN","ORKCHK6",49,0)
 ..D MLM^ORKCHK2(.ORKS,ORKDFN,ORKA,ORENT,"SESSION")
"RTN","ORKCHK6",50,0)
 Q
"RTN","ORKCHK6",51,0)
 ;
"RTN","ORKCHK6",52,0)
RXOCS ;drug-drug interaction, duplicate drug order, duplicate drug class
"RTN","ORKCHK6",53,0)
 Q:ORCRITF_ORSIGF_ORDUPF_ORDUPCF'["E"  ;quit if none are "E"nabled
"RTN","ORKCHK6",54,0)
 N ORKRX,ORPSNUM
"RTN","ORKCHK6",55,0)
 I $L($G(HL7LPTR)),($G(HL7LCOD)="99PSD") D
"RTN","ORKCHK6",56,0)
 .D CHKSESS^ORKPS(.ORKRX,ORKDFN,HL7LPTR,OI,ORKPDATA,ORKDG)
"RTN","ORKCHK6",57,0)
 .N CHK,XX S CHK=0,XX=""
"RTN","ORKCHK6",58,0)
 .F  S CHK=$O(ORKRX(CHK)) Q:'CHK  D
"RTN","ORKCHK6",59,0)
 ..S XX=ORKRX(CHK)
"RTN","ORKCHK6",60,0)
 ..;
"RTN","ORKCHK6",61,0)
 ..;critical drug interaction:
"RTN","ORKCHK6",62,0)
 ..I $P(XX,U)="DI",$P(XX,U,5)="CRITICAL" D
"RTN","ORKCHK6",63,0)
 ...Q:ORCRITF="D"
"RTN","ORKCHK6",64,0)
 ...S ORPSNUM=$P(XX,U,8)  ;get the associated order number
"RTN","ORKCHK6",65,0)
 ...I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK6",66,0)
 ...E  S ORKTXT=$P(XX,U,3)
"RTN","ORKCHK6",67,0)
 ...S ORKMSG=$P(XX,U,5)_" drug-drug interaction: "_$P(XX,U,6)_" & "_$P(XX,U,7)
"RTN","ORKCHK6",68,0)
 ...S ORKS("ORK",ORCRITD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORCRITN_U_ORCRITD_U_ORKMSG_" ("_ORKTXT_")"_U_$G(ORPSNUM)
"RTN","ORKCHK6",69,0)
 ..;
"RTN","ORKCHK6",70,0)
 ..;significant drug interaction:
"RTN","ORKCHK6",71,0)
 ..I $P(XX,U)="DI",$P(XX,U,5)="SIGNIFICANT" D
"RTN","ORKCHK6",72,0)
 ...Q:ORSIGF="D"
"RTN","ORKCHK6",73,0)
 ...S ORPSNUM=$P(XX,U,8)  ;get the associated order number
"RTN","ORKCHK6",74,0)
 ...I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK6",75,0)
 ...E  S ORKTXT=$P(XX,U,3)
"RTN","ORKCHK6",76,0)
 ...S ORKMSG=$P(XX,U,5)_" drug-drug interaction: "_$P(XX,U,6)_" & "_$P(XX,U,7)
"RTN","ORKCHK6",77,0)
 ...S ORKS("ORK",ORSIGD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORSIGN_U_ORSIGD_U_ORKMSG_" ("_ORKTXT_")"_U_$G(ORPSNUM)
"RTN","ORKCHK6",78,0)
 ..;
"RTN","ORKCHK6",79,0)
 ..;duplicate drug:
"RTN","ORKCHK6",80,0)
 ..I $P(XX,U)="DD" D
"RTN","ORKCHK6",81,0)
 ...Q:ORDUPF="D"
"RTN","ORKCHK6",82,0)
 ...S ORPSNUM=$P(XX,U,4)  ;get the associated order number
"RTN","ORKCHK6",83,0)
 ...I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK6",84,0)
 ...E  S ORKTXT=$P(XX,U,3)
"RTN","ORKCHK6",85,0)
 ...S ORKMSG="Duplicate drug order: "_ORKTXT
"RTN","ORKCHK6",86,0)
 ...S ORKS("ORK",ORDUPD_","_$G(ORNUM)_","_ORPSNUM_",Duplicate drug order: "_$P(XX,U,3))=ORNUM_U_ORDUPN_U_ORDUPD_U_ORKMSG_U_$G(ORPSNUM)
"RTN","ORKCHK6",87,0)
 ..;
"RTN","ORKCHK6",88,0)
 ..;duplicate class:
"RTN","ORKCHK6",89,0)
 ..I $P(XX,U)="DC" D
"RTN","ORKCHK6",90,0)
 ...Q:ORDUPCF="D"
"RTN","ORKCHK6",91,0)
 ...S ORPSNUM=$P(XX,U,6)  ;get the associated order number
"RTN","ORKCHK6",92,0)
 ...I $L(ORPSNUM),$G(^OR(100,+ORPSNUM,0)) S ORKT=$$FULLTEXT^ORQOR1(+ORPSNUM),ORKTXT=$P(ORKT,U)_" ["_$P(ORKT,U,2)_"]"
"RTN","ORKCHK6",93,0)
 ...E  S ORKTXT=$P(XX,U,5)
"RTN","ORKCHK6",94,0)
 ...S ORKMSG="Duplicate drug class order: "_$P(XX,U,3)
"RTN","ORKCHK6",95,0)
 ...S ORKS("ORK",ORDUPCD_","_$G(ORNUM)_","_ORPSNUM_","_$E(ORKMSG,1,225))=ORNUM_U_ORDUPCN_U_ORDUPCD_U_ORKMSG_" ("_ORKTXT_")"_U_$G(ORPSNUM)
"RTN","ORKCHK6",96,0)
 Q
"RTN","ORKCHK6",97,0)
 ;
"RTN","ORKCHK6",98,0)
OI2DD(ORPSA,OROI,ORPSPKG)       ;rtn dispense drugs for a PS OI
"RTN","ORKCHK6",99,0)
 N PSOI
"RTN","ORKCHK6",100,0)
 Q:'$D(^ORD(101.43,OROI,0))
"RTN","ORKCHK6",101,0)
 S PSOI=$P($P(^ORD(101.43,OROI,0),U,2),";")
"RTN","ORKCHK6",102,0)
 Q:+$G(PSOI)<1
"RTN","ORKCHK6",103,0)
 D DRG^PSSUTIL1(.ORPSA,PSOI,ORPSPKG)
"RTN","ORKCHK6",104,0)
 Q
"RTN","ORKCHK6",105,0)
 ;
"RTN","ORKCHK6",106,0)
PARAMS(ORKNAME,ORKNUM,ORKFLAG,ORKDNGR) ; get parameter values for an order chk
"RTN","ORKCHK6",107,0)
 S ORKNUM=0,ORKNUM=$O(^ORD(100.8,"B",ORKNAME,ORKNUM))
"RTN","ORKCHK6",108,0)
 S ORKFLAG=$$GET^XPAR(ORENT,"ORK PROCESSING FLAG",ORKNUM,"I")
"RTN","ORKCHK6",109,0)
 S ORKDNGR=$$GET^XPAR("DIV^SYS^PKG","ORK CLINICAL DANGER LEVEL",ORKNUM,"I")
"RTN","ORKCHK6",110,0)
 Q
"RTN","ORQQPL1")
0^1^B63041936^B67342448
"RTN","ORQQPL1",1,0)
ORQQPL1 ; ALB/PDR/REV - PROBLEM LIST FOR CPRS GUI ;03/12/02
"RTN","ORQQPL1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,148,173,203,206,249**;Dec 17, 1997
"RTN","ORQQPL1",3,0)
 ;
"RTN","ORQQPL1",4,0)
 ;------------------------- GET PROBLEM FROM LEXICON -------------------
"RTN","ORQQPL1",5,0)
 ;
"RTN","ORQQPL1",6,0)
LEXSRCH(LIST,FROM,N,VIEW,ORDATE) ; Get candidate Problems from LEX file
"RTN","ORQQPL1",7,0)
 N LEX,VAL,VAL1,COD,CIEN,SYS,MAX,NAME
"RTN","ORQQPL1",8,0)
 S:'+$G(ORDATE) ORDATE=DT
"RTN","ORQQPL1",9,0)
 S:'$G(N) N=100
"RTN","ORQQPL1",10,0)
 S:'$L($G(VIEW)) VIEW="PL1"
"RTN","ORQQPL1",11,0)
 D CONFIG^LEXSET("GMPL",VIEW,ORDATE)
"RTN","ORQQPL1",12,0)
 D LOOK^LEXA(FROM,"GMPL",N,"",ORDATE)
"RTN","ORQQPL1",13,0)
 S S=0
"RTN","ORQQPL1",14,0)
 F  S S=$O(LEX("LIST",S)) Q:S<1  D
"RTN","ORQQPL1",15,0)
 . S VAL1=LEX("LIST",S)
"RTN","ORQQPL1",16,0)
 . S COD="",CIEN="",SYS="",NAME=""
"RTN","ORQQPL1",17,0)
 . I $L(VAL1,"CPT-4 ")>1 D
"RTN","ORQQPL1",18,0)
 .. ;S SYS="CPT-4 "
"RTN","ORQQPL1",19,0)
 .. ;S COD=$P($P(VAL1,SYS,2),")")
"RTN","ORQQPL1",20,0)
 .. ;S:COD["/" COD=$P(COD,"/",1)
"RTN","ORQQPL1",21,0)
 .. ;. S CIEN=$$CODEN^ICPTCOD(COD)
"RTN","ORQQPL1",22,0)
 .. S SYS="ICD-9-CM "
"RTN","ORQQPL1",23,0)
 .. S COD="799.9"
"RTN","ORQQPL1",24,0)
 .. S CIEN=""
"RTN","ORQQPL1",25,0)
 .. S NAME=$P(VAL1," (CPT-4")
"RTN","ORQQPL1",26,0)
 . I $L(VAL1,"DSM-IV ")>1 D
"RTN","ORQQPL1",27,0)
 .. S SYS="DSM-IV "
"RTN","ORQQPL1",28,0)
 .. S COD=$P($P(VAL1,SYS,2),")")
"RTN","ORQQPL1",29,0)
 .. S:COD["/" COD=$P(COD,"/",1)
"RTN","ORQQPL1",30,0)
 .. S CIEN=$$CODEN^ICDCODE($$ICDONE^LEXU($P(VAL1,U,1),ORDATE),80)
"RTN","ORQQPL1",31,0)
 .. S NAME=$P(VAL1," (DSM-IV")
"RTN","ORQQPL1",32,0)
 .. ;
"RTN","ORQQPL1",33,0)
 . I $L(VAL1,"(TITLE 38 ")>1 D
"RTN","ORQQPL1",34,0)
 .. S SYS="TITLE 38 "
"RTN","ORQQPL1",35,0)
 .. S COD=$P($P(VAL1,SYS,2),")")
"RTN","ORQQPL1",36,0)
 .. S:COD["/" COD=$P(COD,"/",1)
"RTN","ORQQPL1",37,0)
 .. S CIEN=$$CODEN^ICDCODE($$ICDONE^LEXU($P(VAL1,U,1),ORDATE),80)
"RTN","ORQQPL1",38,0)
 .. S NAME=$P(VAL1,"(TITLE 38 ")
"RTN","ORQQPL1",39,0)
 .. ;
"RTN","ORQQPL1",40,0)
 . I $L(VAL1,"ICD-9-CM ")>1 D
"RTN","ORQQPL1",41,0)
 .. S SYS="ICD-9-CM "
"RTN","ORQQPL1",42,0)
 .. S COD=$P($P(VAL1,SYS,2),")")
"RTN","ORQQPL1",43,0)
 .. S:COD["/" COD=$P(COD,"/",1)
"RTN","ORQQPL1",44,0)
 .. S CIEN=+$$CODEN^ICDCODE(COD,80)
"RTN","ORQQPL1",45,0)
 .. S NAME=$P(VAL1," (ICD-9-CM")
"RTN","ORQQPL1",46,0)
 . I $L(NAME)=0 S NAME=$P($P(VAL1," (")," *")
"RTN","ORQQPL1",47,0)
 . ;
"RTN","ORQQPL1",48,0)
 . ; jeh Clean left over codes
"RTN","ORQQPL1",49,0)
 . S NAME=$P(NAME," (CPT-4")
"RTN","ORQQPL1",50,0)
 . S NAME=$P(NAME," (DSM-IV")
"RTN","ORQQPL1",51,0)
 . S NAME=$P(NAME,"(TITLE 38 ")
"RTN","ORQQPL1",52,0)
 . S NAME=$P(NAME," (ICD-9-CM")
"RTN","ORQQPL1",53,0)
 . ;
"RTN","ORQQPL1",54,0)
 . S VAL=NAME_U_COD_U_CIEN_U_SYS ; ien^.01^icd^icdifn^system
"RTN","ORQQPL1",55,0)
 . S LIST(S)=VAL
"RTN","ORQQPL1",56,0)
 . S MAX=S
"RTN","ORQQPL1",57,0)
 I $G(MAX)'="" S LIST(MAX+1)=$G(LEX("MAT"))
"RTN","ORQQPL1",58,0)
 Q
"RTN","ORQQPL1",59,0)
 ;
"RTN","ORQQPL1",60,0)
ICDREC(COD) ; 
"RTN","ORQQPL1",61,0)
 N CODIEN
"RTN","ORQQPL1",62,0)
 I COD="" Q ""
"RTN","ORQQPL1",63,0)
 S COD=$P($P(COD,U),"/")
"RTN","ORQQPL1",64,0)
 S CODIEN=+$O(^ICD9("AB",COD_" ",0))
"RTN","ORQQPL1",65,0)
 S:CODIEN'>0 CODIEN=+$O(^ICD9("AB",COD_"0 ",0))
"RTN","ORQQPL1",66,0)
 Q CODIEN
"RTN","ORQQPL1",67,0)
 ;Q $O(^ICD9("BA",COD,""))
"RTN","ORQQPL1",68,0)
 ;
"RTN","ORQQPL1",69,0)
CPTREC(COD) ; 
"RTN","ORQQPL1",70,0)
 I COD="" Q ""
"RTN","ORQQPL1",71,0)
 Q $O(^ICPT("BA",COD,""))
"RTN","ORQQPL1",72,0)
 ;
"RTN","ORQQPL1",73,0)
EDLOAD(RETURN,DA,GMPROV,GMPVAMC) ; LOAD  EDIT ARRAYS
"RTN","ORQQPL1",74,0)
 ; DA=problem IFN
"RTN","ORQQPL1",75,0)
 N I,GMPFLD,GMPORIG,GMPL
"RTN","ORQQPL1",76,0)
 D GETFLDS^GMPLEDT3(DA)
"RTN","ORQQPL1",77,0)
 S I=0
"RTN","ORQQPL1",78,0)
 D LOADFLDS(.RETURN,"GMPFLD","NEW",.I)
"RTN","ORQQPL1",79,0)
 D LOADFLDS(.RETURN,"GMPORIG","ORG",.I)
"RTN","ORQQPL1",80,0)
 K GMPFLD,GMPORIG,GMPL  ; should not have to do this
"RTN","ORQQPL1",81,0)
 Q
"RTN","ORQQPL1",82,0)
 ;
"RTN","ORQQPL1",83,0)
LOADFLDS(RETURN,NAM,TYP,I) ; LOAD FIELDS FOR TYPE OF ARRAY
"RTN","ORQQPL1",84,0)
 N S,V,CVP,PN,PID
"RTN","ORQQPL1",85,0)
 S S="",V=$C(254)
"RTN","ORQQPL1",86,0)
 F  S S=$O(@NAM@(S)) Q:S=10  D
"RTN","ORQQPL1",87,0)
 . S RETURN(I)=TYP_V_S_V_@NAM@(S)
"RTN","ORQQPL1",88,0)
 . S I=I+1
"RTN","ORQQPL1",89,0)
 S S=""
"RTN","ORQQPL1",90,0)
 F  S S=$O(@NAM@(10,S)) Q:S=""  D
"RTN","ORQQPL1",91,0)
 . S CVP=@NAM@(10,S)
"RTN","ORQQPL1",92,0)
 . S PN="" ; provider name
"RTN","ORQQPL1",93,0)
 . S PID=$P(CVP,U,6) ; provider id
"RTN","ORQQPL1",94,0)
 . I PID'=""  S PN=$$GET1^DIQ(200,PID,.01) ; get provider name
"RTN","ORQQPL1",95,0)
 . S RETURN(I)=TYP_V_"10,"_S_V_CVP_U_PN
"RTN","ORQQPL1",96,0)
 . S I=I+1
"RTN","ORQQPL1",97,0)
 Q
"RTN","ORQQPL1",98,0)
 ;
"RTN","ORQQPL1",99,0)
EDSAVE(RETURN,GMPIFN,GMPROV,GMPVAMC,UT,EDARRAY) ; SAVE EDITED RES
"RTN","ORQQPL1",100,0)
 ; RETURN - boolean, 1 success, 0 failure
"RTN","ORQQPL1",101,0)
 ; EDARRAY - array used for indirect sets of GMPORIG() and GMPFLDS()
"RTN","ORQQPL1",102,0)
 ;
"RTN","ORQQPL1",103,0)
 N GMPFLD,GMPORIG,S,GMPLUSER
"RTN","ORQQPL1",104,0)
 S RETURN=1 ; initialize for success
"RTN","ORQQPL1",105,0)
 I UT S GMPLUSER=1
"RTN","ORQQPL1",106,0)
 ;
"RTN","ORQQPL1",107,0)
 ;S GMPLUSER=1
"RTN","ORQQPL1",108,0)
 S S=""
"RTN","ORQQPL1",109,0)
 F  S S=$O(EDARRAY(S)) Q:S=""  D
"RTN","ORQQPL1",110,0)
 . S @EDARRAY(S)
"RTN","ORQQPL1",111,0)
 I $D(GMPFLD(10,"NEW"))>9 D  I 'RETURN Q  ; Bail Out if no lock
"RTN","ORQQPL1",112,0)
 . L +^AUPNPROB(GMPIFN,11):10  ; given bogus nature of this lock, should be able to get
"RTN","ORQQPL1",113,0)
 . I '$T S RETURN=0
"RTN","ORQQPL1",114,0)
 ;
"RTN","ORQQPL1",115,0)
 D EN^GMPLSAVE  ; save the data
"RTN","ORQQPL1",116,0)
 K GMPFLD,GMPORIG
"RTN","ORQQPL1",117,0)
 ;
"RTN","ORQQPL1",118,0)
 L -^AUPNPROB(GMPIFN,11)  ; free this instance of lock (in case it was set)
"RTN","ORQQPL1",119,0)
 S RETURN=1
"RTN","ORQQPL1",120,0)
 Q
"RTN","ORQQPL1",121,0)
 ;
"RTN","ORQQPL1",122,0)
UPDATE(ORRETURN,UPDARRAY) ; UPDATE A PROBLEM RECORD
"RTN","ORQQPL1",123,0)
 ; Does essentially same job as EDSAVE above, however does not handle edits to comments
"RTN","ORQQPL1",124,0)
 ; or addition of multiple comments. 
"RTN","ORQQPL1",125,0)
 ; Use initially just for status updates.
"RTN","ORQQPL1",126,0)
 ;
"RTN","ORQQPL1",127,0)
 N S,GMPL,GMPORIG ; last 2 vars created in nested call
"RTN","ORQQPL1",128,0)
 S S=""
"RTN","ORQQPL1",129,0)
 F  S S=$O(UPDARRAY(S)) Q:S=""  D
"RTN","ORQQPL1",130,0)
 . S @UPDARRAY(S)
"RTN","ORQQPL1",131,0)
 D UPDATE^GMPLUTL(.ORARRAY,.ORRETURN)
"RTN","ORQQPL1",132,0)
 K ORARRAY
"RTN","ORQQPL1",133,0)
 ; broker wont pick up root node RETURN
"RTN","ORQQPL1",134,0)
 S ORRETURN(1)=ORRETURN(0) ; error text
"RTN","ORQQPL1",135,0)
 S ORRETURN(0)=ORRETURN ; gmpdfn
"RTN","ORQQPL1",136,0)
 I ORRETURN(0)=""  S ORRETURN=1 ; insurance ? need
"RTN","ORQQPL1",137,0)
 Q
"RTN","ORQQPL1",138,0)
 ;
"RTN","ORQQPL1",139,0)
ADDSAVE(RETURN,GMPDFN,GMPROV,GMPVAMC,ADDARRAY) ; SAVE NEW RECORD
"RTN","ORQQPL1",140,0)
 ; RETURN - Problem IFN if success, 0 otherwise
"RTN","ORQQPL1",141,0)
 ; ADDARRAY - array used for indirect sets of  GMPFLDS()
"RTN","ORQQPL1",142,0)
 ;
"RTN","ORQQPL1",143,0)
 N DA,GMPFLD,GMPORIG,S
"RTN","ORQQPL1",144,0)
 S RETURN=0 ;
"RTN","ORQQPL1",145,0)
 L +^AUPNPROB(0):10
"RTN","ORQQPL1",146,0)
 Q:'$T  ; bail out if no lock
"RTN","ORQQPL1",147,0)
 ;
"RTN","ORQQPL1",148,0)
 S S=""
"RTN","ORQQPL1",149,0)
 F  S S=$O(ADDARRAY(S)) Q:S=""  D
"RTN","ORQQPL1",150,0)
 . S @ADDARRAY(S)
"RTN","ORQQPL1",151,0)
 ;
"RTN","ORQQPL1",152,0)
 D NEW^GMPLSAVE
"RTN","ORQQPL1",153,0)
 ;
"RTN","ORQQPL1",154,0)
 S RETURN=DA
"RTN","ORQQPL1",155,0)
 ;
"RTN","ORQQPL1",156,0)
 L -^AUPNPROB(0)
"RTN","ORQQPL1",157,0)
 S RETURN=1
"RTN","ORQQPL1",158,0)
 Q
"RTN","ORQQPL1",159,0)
 ;
"RTN","ORQQPL1",160,0)
INITUSER(RETURN,ORDUZ) ; INITIALIZE FOR NEW USER
"RTN","ORQQPL1",161,0)
 ; taken from INIT^GMPLMGR
"RTN","ORQQPL1",162,0)
 ; leave GMPLUSER on symbol table - is evaluated in EDITSAVE
"RTN","ORQQPL1",163,0)
 ; 
"RTN","ORQQPL1",164,0)
 N X,PV,CTXT,GMPLPROV
"RTN","ORQQPL1",165,0)
 S GMPLUSER=$$CLINUSER(DUZ)
"RTN","ORQQPL1",166,0)
 S CTXT=$$GET^XPAR("ALL","ORCH CONTEXT PROBLEMS",1)
"RTN","ORQQPL1",167,0)
 S X=$G(^GMPL(125.99,1,0)) ; IN1+6^GMPLMGR
"RTN","ORQQPL1",168,0)
 S RETURN(0)=GMPLUSER ;  problem list user, or other user
"RTN","ORQQPL1",169,0)
 S RETURN(1)=$$VIEW^GMPLX1(DUZ) ; GMPLVIEW("VIEW") - users default view
"RTN","ORQQPL1",170,0)
 S RETURN(2)=+$P(X,U,2) ; verify transcribed problems
"RTN","ORQQPL1",171,0)
 S RETURN(3)=+$P(X,U,3) ; prompt for chart copy
"RTN","ORQQPL1",172,0)
 S RETURN(4)=+$P(X,U,4) ; use lexicon
"RTN","ORQQPL1",173,0)
 S RETURN(5)=$S($P(X,U,5)="R":1,1:0) ; chron or reverse chron listing
"RTN","ORQQPL1",174,0)
 S RETURN(6)=$S($P($G(CTXT),";",3)'="":$P($G(CTXT),";",3),1:"A")
"RTN","ORQQPL1",175,0)
 S GMPLPROV=$P($G(CTXT),";",5)
"RTN","ORQQPL1",176,0)
 I +GMPLPROV>0,$D(^VA(200,GMPLPROV)) D
"RTN","ORQQPL1",177,0)
 . S RETURN(7)=GMPLPROV_U_$P(^VA(200,GMPLPROV,0),U)
"RTN","ORQQPL1",178,0)
 E  S RETURN(7)="0^All"
"RTN","ORQQPL1",179,0)
 S RETURN(8)=$$SERVICE^GMPLX1(DUZ) ; user's service/section
"RTN","ORQQPL1",180,0)
 ; Guessing from what I see in the data that $$VIEW^GMPLX1 actually returns a composite
"RTN","ORQQPL1",181,0)
 ; of default view (in/out patient)/(c1/c2... if out patient i.e. GMPLVIEW("CLIN")) or
"RTN","ORQQPL1",182,0)
 ;                                                      /(s1/s2... if in patient i.e. GMPLVIEW("SERV"))
"RTN","ORQQPL1",183,0)
 ; Going with this assumption for now:
"RTN","ORQQPL1",184,0)
 I $L(RETURN(1),"/")>1 D
"RTN","ORQQPL1",185,0)
 . S PV=RETURN(1)
"RTN","ORQQPL1",186,0)
 . S RETURN(1)=$P(PV,"/")
"RTN","ORQQPL1",187,0)
 . I RETURN(1)="C" S GMPLVIEW("CLIN")=$P(PV,"/",2,99)
"RTN","ORQQPL1",188,0)
 . I RETURN(1)="S" S GMPLVIEW("SERV")=$P(PV,"/",2,99)
"RTN","ORQQPL1",189,0)
 S RETURN(9)=$G(GMPLVIEW("SERV")) ; ??? Where from - see tech doc
"RTN","ORQQPL1",190,0)
 S RETURN(10)=$G(GMPLVIEW("CLIN")) ; ??? Where from - see tech doc
"RTN","ORQQPL1",191,0)
 S RETURN(11)=""
"RTN","ORQQPL1",192,0)
 S RETURN(12)=+$P($G(CTXT),";",4)    ; should comments display?
"RTN","ORQQPL1",193,0)
 K GMPLVIEW
"RTN","ORQQPL1",194,0)
 Q
"RTN","ORQQPL1",195,0)
 ;
"RTN","ORQQPL1",196,0)
CLINUSER(ORDUZ) ;is this a clinical user?
"RTN","ORQQPL1",197,0)
 N ORUSER
"RTN","ORQQPL1",198,0)
 S ORUSER=0
"RTN","ORQQPL1",199,0)
 I $D(^XUSEC("ORES",ORDUZ)) S ORUSER=1
"RTN","ORQQPL1",200,0)
 I $D(^XUSEC("ORELSE",ORDUZ)) S ORUSER=1
"RTN","ORQQPL1",201,0)
 I $D(^XUSEC("PROVIDER",ORDUZ)) S ORUSER=1
"RTN","ORQQPL1",202,0)
 Q ORUSER
"RTN","ORQQPL1",203,0)
 ;
"RTN","ORQQPL1",204,0)
INITPT(RETURN,DFN) ; GET PATIENT PARAMETERS
"RTN","ORQQPL1",205,0)
 Q:+$G(DFN)=0
"RTN","ORQQPL1",206,0)
 N GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST
"RTN","ORQQPL1",207,0)
 ;
"RTN","ORQQPL1",208,0)
 S RETURN(0)=DUZ(2) ; facility #
"RTN","ORQQPL1",209,0)
 D DEM^VADPT ; get death indicator
"RTN","ORQQPL1",210,0)
 S RETURN(1)=$G(VADM(6)) ; death indicator
"RTN","ORQQPL1",211,0)
 D VADPT^GMPLX1(DFN) ; get eligibilities
"RTN","ORQQPL1",212,0)
 S RETURN(2)=$P(GMPSC,U) ; service connected
"RTN","ORQQPL1",213,0)
 S RETURN(3)=$G(GMPAGTOR) ; agent orange exposure
"RTN","ORQQPL1",214,0)
 S RETURN(4)=$G(GMPION) ; ionizing radiation exposure
"RTN","ORQQPL1",215,0)
 S RETURN(5)=$G(GMPGULF) ; gulf war exposure
"RTN","ORQQPL1",216,0)
 S RETURN(6)=VA("BID") ; need this to reconstitute GMPDFN on return
"RTN","ORQQPL1",217,0)
 S RETURN(7)=$G(GMPHNC) ; head/neck cancer
"RTN","ORQQPL1",218,0)
 S RETURN(8)=$G(GMPMST) ; MST
"RTN","ORQQPL1",219,0)
 Q
"RTN","ORQQPL1",220,0)
 ;
"RTN","ORQQPL1",221,0)
PROVSRCH(LST,FLAG,N,FROM,PART) ; Get candidate Rroviders from person file
"RTN","ORQQPL1",222,0)
 N LV,NS,RV,IEN
"RTN","ORQQPL1",223,0)
 S RV=$NAME(LV("DILIST","ID"))
"RTN","ORQQPL1",224,0)
 IF +$G(N)=0 S N=50
"RTN","ORQQPL1",225,0)
 S FLAG=$G(FLAG),N=$G(N),FROM=$G(FROM),PART=$G(PART)
"RTN","ORQQPL1",226,0)
 D LIST^DIC(200,"",".01;1",FLAG,N,FROM,PART,"","","","LV")
"RTN","ORQQPL1",227,0)
 S NS=""
"RTN","ORQQPL1",228,0)
 F  S NS=$O(LV("DILIST",1,NS)) Q:NS=""  D
"RTN","ORQQPL1",229,0)
 . S IEN=""
"RTN","ORQQPL1",230,0)
 . S IEN=$O(^VA(200,"B",@RV@(NS,.01),IEN)) ; compliments of PROV^ORQPTQ
"RTN","ORQQPL1",231,0)
 . S LST(NS)=IEN_U_@RV@(NS,.01)  ; initials_U_@RV@(NS,1)
"RTN","ORQQPL1",232,0)
 Q
"RTN","ORQQPL1",233,0)
 ;
"RTN","ORQQPL1",234,0)
CLINSRCH(Y,X) ; Get LIST OF CLINICS
"RTN","ORQQPL1",235,0)
 ; Note: This comes from CLIN^ORQPTQ2, where it was commented out in place of 
"RTN","ORQQPL1",236,0)
 ; a call to ^XPAR. I would have just used CLIN^ORQPTQ2, but it didn't work - at
"RTN","ORQQPL1",237,0)
 ; least on SLC OEX directory.
"RTN","ORQQPL1",238,0)
 ; X has no purpose other than to satisfy apparent rpc and tcallv requirement for args
"RTN","ORQQPL1",239,0)
 N I,NAME,IEN
"RTN","ORQQPL1",240,0)
 S I=1,IEN=0,NAME=""
"RTN","ORQQPL1",241,0)
 ;access to SC global granted under DBIA #518:
"RTN","ORQQPL1",242,0)
 F  S NAME=$O(^SC("B",NAME)) Q:NAME=""  S IEN=$O(^(NAME,0)) D
"RTN","ORQQPL1",243,0)
 . I $P(^SC(IEN,0),"^",3)="C" S Y(I)=IEN_"^"_NAME,I=I+1
"RTN","ORQQPL1",244,0)
 Q
"RTN","ORQQPL1",245,0)
 ;
"RTN","ORQQPL1",246,0)
SRVCSRCH(Y,FROM,DIR,ALL) ; GET LIST OF SERVICES
"RTN","ORQQPL1",247,0)
 N I,IEN,CNT S I=0,CNT=44
"RTN","ORQQPL1",248,0)
 F  Q:I=CNT  S FROM=$O(^DIC(49,"B",FROM),DIR) Q:FROM=""  D
"RTN","ORQQPL1",249,0)
 . S IEN=$O(^DIC(49,"B",FROM,0)) I '$G(ALL),$P(^DIC(49,IEN,0),U,9)'="C" Q
"RTN","ORQQPL1",250,0)
 . S I=I+1,Y(I)=IEN_"^"_FROM
"RTN","ORQQPL1",251,0)
 Q
"RTN","ORQQPL1",252,0)
 ;
"RTN","ORQQPL1",253,0)
DUP(Y,DFN,TERM,TEXT) ;Check for duplicate problem
"RTN","ORQQPL1",254,0)
 S Y=$$DUPL^GMPLX(DFN,TERM,TEXT) Q:+Y=0
"RTN","ORQQPL1",255,0)
 I $P(^AUPNPROB(Y,1),U,2)="H" S Y=0 Q
"RTN","ORQQPL1",256,0)
 S Y=Y_U_$P(^AUPNPROB(Y,0),U,12)
"RTN","ORQQPL1",257,0)
 Q
"VER")
8.0^22.0
"BLD",6748,6)
^235
**END**
**END**
