Released XM*7.1*62 SEQ #56
Extracted from mail message
**KIDS**:XM*7.1*62^

**INSTALL NAME**
XM*7.1*62
"BLD",41,0)
XM*7.1*62^MAILMAN^0^2980420^y
"BLD",41,1,0)
^^37^37^2980420^^^^
"BLD",41,1,1,0)
MailMan patch XM*7.1*59 addresses NOIS CMH-0398-N2220.
"BLD",41,1,2,0)

"BLD",41,1,3,0)
Messages intended to be sent to or via a certain domain may unintentionally
"BLD",41,1,4,0)
be sent via another domain.  This patch fixes this problem.
"BLD",41,1,5,0)

"BLD",41,1,6,0)
===========================================================================
"BLD",41,1,7,0)
This patch should be installed after-hours, when user activity is at a
"BLD",41,1,8,0)
minimum.  You should put the XMUSER option out of order. The filers should
"BLD",41,1,9,0)
be shut down.
"BLD",41,1,10,0)
===========================================================================
"BLD",41,1,11,0)

"BLD",41,1,12,0)
INSTALLATION:
"BLD",41,1,13,0)
1.  DSM Sites: If any of these routines is mapped, disable mapping for the 
"BLD",41,1,14,0)
    affected routine(s).  
"BLD",41,1,15,0)
2.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.  This loads 
"BLD",41,1,16,0)
    the patch into a Transport Global on your system.  
"BLD",41,1,17,0)
3.  On the KIDS:Installation menu, use the following options to install the 
"BLD",41,1,18,0)
    Transport Global: 
"BLD",41,1,19,0)
       Verify Checksums in Transport Global 
"BLD",41,1,20,0)
       Print Transport Global 
"BLD",41,1,21,0)
       Compare Transport Global to Current System 
"BLD",41,1,22,0)
       Backup a Transport Global 
"BLD",41,1,23,0)
       Install Package(s) 
"BLD",41,1,24,0)
4.  DSM Sites: After patch has installed, rebuild your map set.  
"BLD",41,1,25,0)

"BLD",41,1,26,0)
============================================================================ 
"BLD",41,1,27,0)
  
"BLD",41,1,28,0)
ROUTINES:
"BLD",41,1,29,0)
The second line of the routine now looks like:
"BLD",41,1,30,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",41,1,31,0)
 
"BLD",41,1,32,0)
              Before          After
"BLD",41,1,33,0)
Name          Checksum        Checksum        Patch List
"BLD",41,1,34,0)
-------------------------------------------------------------
"BLD",41,1,35,0)
XMR0B          9580242         9564128        4,6,13,34,42,62
"BLD",41,1,36,0)
* Checksums produced by CHECK^XTSUMBLD
"BLD",41,1,37,0)
============================================================================
"BLD",41,4,0)
^9.64PA^^0
"BLD",41,"INI")

"BLD",41,"INIT")

"BLD",41,"KRN",0)
^9.67PA^19^12
"BLD",41,"KRN",.4,0)
.4
"BLD",41,"KRN",.401,0)
.401
"BLD",41,"KRN",.402,0)
.402
"BLD",41,"KRN",.403,0)
.403
"BLD",41,"KRN",.5,0)
.5
"BLD",41,"KRN",.84,0)
.84
"BLD",41,"KRN",3.6,0)
3.6
"BLD",41,"KRN",3.8,0)
3.8
"BLD",41,"KRN",9.2,0)
9.2
"BLD",41,"KRN",9.8,0)
9.8
"BLD",41,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",41,"KRN",9.8,"NM",1,0)
XMR0B^^0^B22489203
"BLD",41,"KRN",9.8,"NM","B","XMR0B",1)

"BLD",41,"KRN",19,0)
19
"BLD",41,"KRN",19,"NM",0)
^9.68A^^0
"BLD",41,"KRN",19.1,0)
19.1
"BLD",41,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",41,"KRN","B",.4,.4)

"BLD",41,"KRN","B",.401,.401)

"BLD",41,"KRN","B",.402,.402)

"BLD",41,"KRN","B",.403,.403)

"BLD",41,"KRN","B",.5,.5)

"BLD",41,"KRN","B",.84,.84)

"BLD",41,"KRN","B",3.6,3.6)

"BLD",41,"KRN","B",3.8,3.8)

"BLD",41,"KRN","B",9.2,9.2)

"BLD",41,"KRN","B",9.8,9.8)

"BLD",41,"KRN","B",19,19)

"BLD",41,"KRN","B",19.1,19.1)

"BLD",41,"QUES",0)
^9.62^^
"BLD",41,"REQB",0)
^9.611^^
"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
62^2980420
"PKG",6,22,1,"PAH",1,1,0)
^^37^37^2980420
"PKG",6,22,1,"PAH",1,1,1,0)
MailMan patch XM*7.1*59 addresses NOIS CMH-0398-N2220.
"PKG",6,22,1,"PAH",1,1,2,0)

"PKG",6,22,1,"PAH",1,1,3,0)
Messages intended to be sent to or via a certain domain may unintentionally
"PKG",6,22,1,"PAH",1,1,4,0)
be sent via another domain.  This patch fixes this problem.
"PKG",6,22,1,"PAH",1,1,5,0)

"PKG",6,22,1,"PAH",1,1,6,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,7,0)
This patch should be installed after-hours, when user activity is at a
"PKG",6,22,1,"PAH",1,1,8,0)
minimum.  You should put the XMUSER option out of order. The filers should
"PKG",6,22,1,"PAH",1,1,9,0)
be shut down.
"PKG",6,22,1,"PAH",1,1,10,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,11,0)

"PKG",6,22,1,"PAH",1,1,12,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,13,0)
1.  DSM Sites: If any of these routines is mapped, disable mapping for the 
"PKG",6,22,1,"PAH",1,1,14,0)
    affected routine(s).  
"PKG",6,22,1,"PAH",1,1,15,0)
2.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.  This loads 
"PKG",6,22,1,"PAH",1,1,16,0)
    the patch into a Transport Global on your system.  
"PKG",6,22,1,"PAH",1,1,17,0)
3.  On the KIDS:Installation menu, use the following options to install the 
"PKG",6,22,1,"PAH",1,1,18,0)
    Transport Global: 
"PKG",6,22,1,"PAH",1,1,19,0)
       Verify Checksums in Transport Global 
"PKG",6,22,1,"PAH",1,1,20,0)
       Print Transport Global 
"PKG",6,22,1,"PAH",1,1,21,0)
       Compare Transport Global to Current System 
"PKG",6,22,1,"PAH",1,1,22,0)
       Backup a Transport Global 
"PKG",6,22,1,"PAH",1,1,23,0)
       Install Package(s) 
"PKG",6,22,1,"PAH",1,1,24,0)
4.  DSM Sites: After patch has installed, rebuild your map set.  
"PKG",6,22,1,"PAH",1,1,25,0)

"PKG",6,22,1,"PAH",1,1,26,0)
============================================================================ 
"PKG",6,22,1,"PAH",1,1,27,0)
  
"PKG",6,22,1,"PAH",1,1,28,0)
ROUTINES:
"PKG",6,22,1,"PAH",1,1,29,0)
The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,30,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,31,0)
 
"PKG",6,22,1,"PAH",1,1,32,0)
              Before          After
"PKG",6,22,1,"PAH",1,1,33,0)
Name          Checksum        Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,34,0)
-------------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,35,0)
XMR0B          9580242         9564128        4,6,13,34,42,62
"PKG",6,22,1,"PAH",1,1,36,0)
* Checksums produced by CHECK^XTSUMBLD
"PKG",6,22,1,"PAH",1,1,37,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XMR0B")
0^1^B22489203
"RTN","XMR0B",1,0)
XMR0B ;(WASH ISC)/THM/CAP-SMTP (HELO/MAIL) [ARPANET RFC 821] ;04/20/98  13:32
"RTN","XMR0B",2,0)
VER ;;7.1;MailMan;**4,6,13,34,42,62**;Jun 02, 1994
"RTN","XMR0B",3,0)
HELO ;;HELLO COMMAND
"RTN","XMR0B",4,0)
 S XMRVAL=0
"RTN","XMR0B",5,0)
 I XMP="" S XMSG="501 Missing domain specification" X XMSEN Q
"RTN","XMR0B",6,0)
 I '$D(^XMB("NETNAME")) S XMSG="550 Unchristened local domain" X XMSEN Q
"RTN","XMR0B",7,0)
 D R1^XMR S X=$P(XMP,"<") I $E(X,$L(X))="." S XMSG="Invalid Domain Name" X XMSEN Q
"RTN","XMR0B",8,0)
 S XMHELO("XMP")=X,Y=$$DOMAIN(X)
"RTN","XMR0B",9,0)
 ;S Y=$$DOMAIN(X),XMHELO("XMP")=$P(Y,U,2)
"RTN","XMR0B",10,0)
 S XMINST=+Y S:'$G(XMRDOM) XMRDOM=XMINST
"RTN","XMR0B",11,0)
 ;Lock Domain
"RTN","XMR0B",12,0)
 L +^DIC(4.2,+Y,0):0 E  S XMSG="550 Domain file locked, try later" X XMSEN Q
"RTN","XMR0B",13,0)
 I '$D(^XMBS(4.2999,+Y,0)) D STAT^XMC1(+Y)
"RTN","XMR0B",14,0)
 ;XMBT=1 for batch processing, XMRVAL=validation number
"RTN","XMR0B",15,0)
 G H:XMBT S XMRVAL=$P($P(XMP,"<",2),">")
"RTN","XMR0B",16,0)
 S Y(0)=^DIC(4.2,+Y,0)
"RTN","XMR0B",17,0)
 ;check val. num
"RTN","XMR0B",18,0)
 D  I '$D(XMRVAL) G HQ
"RTN","XMR0B",19,0)
 . Q:XMRVAL=$P(Y(0),U,15)
"RTN","XMR0B",20,0)
 . I XMRVAL=$P(Y(0),U,18) S $P(Y(0),U,15)=$P(Y(0),U,18) Q
"RTN","XMR0B",21,0)
 . S XMB="XMVALBAD",XMB(1)=$P(XMP,"<") D ^XMB
"RTN","XMR0B",22,0)
 . S XMSG="550 Bad validation number" X XMSEN
"RTN","XMR0B",23,0)
 . K XMRVAL Q
"RTN","XMR0B",24,0)
 S XMSG="250 OK "_^XMB("NETNAME")
"RTN","XMR0B",25,0)
 ;generate new validation number
"RTN","XMR0B",26,0)
 I XMRVAL D
"RTN","XMR0B",27,0)
 . S XMRVAL=($R(8000000)+1000000)
"RTN","XMR0B",28,0)
 . ;set val. num in return message, set new Val. num field
"RTN","XMR0B",29,0)
 . S XMSG=XMSG_" <"_XMRVAL_">",$P(Y(0),U,18)=XMRVAL
"RTN","XMR0B",30,0)
 . S ^DIC(4.2,+Y,0)=Y(0)
"RTN","XMR0B",31,0)
 S XMSG=XMSG_" ["_$P($T(VER),";",3)_",DUP,SER,FTP]"
"RTN","XMR0B",32,0)
H S XMSITE=$P(Y,U,2),XMSTATE="^MAIL^",XMCONT=XMCONT_"TURN^MESS^"
"RTN","XMR0B",33,0)
 X XMSEN
"RTN","XMR0B",34,0)
 Q:$G(XMRVAL)
"RTN","XMR0B",35,0)
HQ L -^DIC(4.2,XMINST,0) Q
"RTN","XMR0B",36,0)
 ;
"RTN","XMR0B",37,0)
DOMAIN(X) ;Domain name of sender acceptable ?
"RTN","XMR0B",38,0)
 N DIC,ER,X9,XMA21A,XMP,XMR0B,XMSEN
"RTN","XMR0B",39,0)
 S DIC=4.2,DIC(0)="FM",XMR0B=X D I2^XMA21A
"RTN","XMR0B",40,0)
 I Y>0 Q Y
"RTN","XMR0B",41,0)
 N % S (%,X)=XMR0B X ^%ZOSF("UPPERCASE") S XMR0B=Y
"RTN","XMR0B",42,0)
 F  S Y=$O(^DIC(4.2,"C",XMR0B,0)) D  Q:Y>0!'$L(XMR0B)
"RTN","XMR0B",43,0)
 . I Y>0 Q
"RTN","XMR0B",44,0)
 . S XMR0B=$P(XMR0B,".",2,$L(XMR0B,"."))
"RTN","XMR0B",45,0)
 . Q
"RTN","XMR0B",46,0)
 I Y>0 Q $$DQ(Y)
"RTN","XMR0B",47,0)
 Q $$DN(%)
"RTN","XMR0B",48,0)
DQ(Y) Q Y_"^"_$P(^DIC(4.2,+Y,0),U)
"RTN","XMR0B",49,0)
DN(X) ;Add new Domain
"RTN","XMR0B",50,0)
 N DA,DD,DO,XMR0B
"RTN","XMR0B",51,0)
 X ^%ZOSF("UPPERCASE") S (XMR0B,X)=$P(Y,".",$L(Y,".")),XMR0B("X")=Y
"RTN","XMR0B",52,0)
 S DIC="^DIC(4.2,",DIC("DR")="1///C"_$S(^XMB("NETNAME")="FORUM.VA.GOV":"",1:";2///FORUM.VA.GOV") D FILE^DICN
"RTN","XMR0B",53,0)
 K DA,DD,DO
"RTN","XMR0B",54,0)
 S ^DIC(4.2,+Y,1,0)="^4.21^1^1"
"RTN","XMR0B",55,0)
 S ^DIC(4.2,+Y,1,1,0)="AUTO^^^OTHER",^(1,0)="^^1^1^"_DT,^(1,0)="X Q"
"RTN","XMR0B",56,0)
 S ^DIC(4.2,+Y,1,"NOTES",0)="^^1^1^"_DT,^(1,0)="Auto-Created-XMR0B"
"RTN","XMR0B",57,0)
 N XMDUZ,XMSUB
"RTN","XMR0B",58,0)
 S XMDUZ=.5,XMSUB="New Domain created - "_$P(Y,U,2),XMTEXT="A("
"RTN","XMR0B",59,0)
 S A(1)="An incoming transmission from this previously undefined"
"RTN","XMR0B",60,0)
 S A(2)="domain ("_XMR0B("X")_") caused this new domain"
"RTN","XMR0B",61,0)
 S A(3)="("_$P(Y,U,2)_") to be created"
"RTN","XMR0B",62,0)
 S A(4)="",A(5)="to limit the number of entries that are created."
"RTN","XMR0B",63,0)
 S A(5)="The Internet Suffix is used for this purpose."
"RTN","XMR0B",64,0)
 S A(6)="Statistics are then collected for that level of activity."
"RTN","XMR0B",65,0)
 S XMY("G.POSTMASTER")="" D ^XMD
"RTN","XMR0B",66,0)
 I '$O(^DIC(4.2996,"B",X,0)) S XMR0B("Y")=Y,DIC="^DIC(4.2996,",DIC("DR")="1///AUTOMATIC-XMR0B" D FILE^DICN S Y=XMR0B("Y")
"RTN","XMR0B",67,0)
 Q $P(Y,U,1,2)
"RTN","XMR0B",68,0)
 ;
"RTN","XMR0B",69,0)
VAL ;check validation number
"RTN","XMR0B",70,0)
 ;if new val. num. exist, then set val. num. to it and set to null
"RTN","XMR0B",71,0)
 N % K XMRVAL
"RTN","XMR0B",72,0)
 S %=$G(^DIC(4.2,XMINST,0))
"RTN","XMR0B",73,0)
 I $P(%,U,18) S $P(%,U,15)=$P(%,U,18),$P(%,U,18)="",^DIC(4.2,+XMINST,0)=%
"RTN","XMR0B",74,0)
 D HQ
"RTN","XMR0B",75,0)
 Q
"RTN","XMR0B",76,0)
MAIL ;;START
"RTN","XMR0B",77,0)
 S XMP=$P(XMP,":",2,999) I XMP="" S XMSG="501 Invalid reverse-path specification" X XMSEN Q
"RTN","XMR0B",78,0)
 I $$REJ(XMP) S XMSG="502 No message receipt authorization." X XMSEN Q
"RTN","XMR0B",79,0)
 K XMY,XMY0,^TMP("XMY",$J),^TMP("XMY0",$J),XMA21G D G2^XMA2 S XMZHOLD=XMDUZ,XMDUZ=.5,XMKM=.95
"RTN","XMR0B",80,0)
 I '$D(^XMB(3.7,.5,2,.95,0)) S ^(0)="ARRIVING",^XMB(3.7,.5,2,"B","ARRIVING",.95)=""
"RTN","XMR0B",81,0)
 D S2^XMA1B
"RTN","XMR0B",82,0)
 S XMDUZ=XMZHOLD,XMBCK=XMP,XMSG="250 OK Message-ID:"_XMZ_"@"_^XMB("NETNAME"),XMSTATE="^LOCK^RCPT^DATA",XMLOCK="" X XMSEN Q:ER
"RTN","XMR0B",83,0)
 S X="N",%DT="T" D ^%DT S ^XMB(3.9,XMZ,0)="^^"_Y,X=Y,Y=$E(X,6,7)_" "_$P("Jan^Feb^Mar^Apr^May^Jun^Jul^Aug^Sep^Oct^Nov^Dec",U,$E(X,4,5))_" "_$E(X,2,3) S:X\1'=X %=$P(X,".",2)_"0000",Y=Y_" "_$E(%,1,2)_":"_$E(%,3,4)
"RTN","XMR0B",84,0)
 S XMD=Y I $G(XMCHAN)="" S XMCHAN="Turn Around"
"RTN","XMR0B",85,0)
 S X=XMCHAN,X=$S(X'?.N:X,$D(^DIC(3.4,X,0)):$P(^(0),U),1:"")
"RTN","XMR0B",86,0)
 ;DON'T CHANGE ORDER OF .001 & .002 LINES !
"RTN","XMR0B",87,0)
 S ^XMB(3.9,XMZ,2,.001,0)="Received: "_$S($L($G(XMSITE("XMP"))):"from "_XMSITE("XMP")_" by "_^XMB("NETNAME")_", MailMan "_$P($T(VER),";",3)_"/"_X,1:"BATCH")_" ; "_XMD_" "_^XMB("TIMEZONE")
"RTN","XMR0B",88,0)
 Q
"RTN","XMR0B",89,0)
REJ(X) ;Check Senders rejected list
"RTN","XMR0B",90,0)
 I '$O(^XMBX(4.501,0)) G Q0
"RTN","XMR0B",91,0)
 N A,B,C,D,Y S C=^%ZOSF("UPPERCASE") X C S D=Y,A=""
"RTN","XMR0B",92,0)
 F  S A=$O(^XMBX(4.501,"B",A)) G Q0:A="" S X=A X C I D[Y S B=$O(^(A,0)) I B,'$P($G(^XMBX(4.501,B,0)),U,2) Q
"RTN","XMR0B",93,0)
 Q 1
"RTN","XMR0B",94,0)
Q0 Q 0
"VER")
8.0^21.0
**END**
**END**
