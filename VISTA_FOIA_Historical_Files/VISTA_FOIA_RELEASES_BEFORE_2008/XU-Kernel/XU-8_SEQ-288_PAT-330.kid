Released XU*8*330 SEQ #288
Extracted from mail message
**KIDS**:XU*8.0*330^

**INSTALL NAME**
XU*8.0*330
"BLD",794,0)
XU*8.0*330^KERNEL^0^3040420^y
"BLD",794,1,0)
^^2^2^3031202^
"BLD",794,1,1,0)
See patch XU*8*330 in the National Patch Module on FORUM for complete
"BLD",794,1,2,0)
information on this patch.
"BLD",794,4,0)
^9.64PA^200^1
"BLD",794,4,200,0)
200
"BLD",794,4,200,2,0)
^9.641^200.0351^1
"BLD",794,4,200,2,200.0351,0)
PERSONAL DIAGNOSES LIST  (sub-file)
"BLD",794,4,200,2,200.0351,1,0)
^9.6411^^
"BLD",794,4,200,222)
y^n^p^^^^n^^n
"BLD",794,4,200,224)

"BLD",794,4,"APDD",200,200.0351)

"BLD",794,4,"B",200,200)

"BLD",794,"INI")

"BLD",794,"INID")
^y^
"BLD",794,"INIT")
XU8P330X
"BLD",794,"KRN",0)
^9.67PA^8989.52^19
"BLD",794,"KRN",.4,0)
.4
"BLD",794,"KRN",.401,0)
.401
"BLD",794,"KRN",.402,0)
.402
"BLD",794,"KRN",.403,0)
.403
"BLD",794,"KRN",.5,0)
.5
"BLD",794,"KRN",.84,0)
.84
"BLD",794,"KRN",3.6,0)
3.6
"BLD",794,"KRN",3.8,0)
3.8
"BLD",794,"KRN",9.2,0)
9.2
"BLD",794,"KRN",9.8,0)
9.8
"BLD",794,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",794,"KRN",9.8,"NM",1,0)
XUSER^^0^B7309579
"BLD",794,"KRN",9.8,"NM","B","XUSER",1)

"BLD",794,"KRN",19,0)
19
"BLD",794,"KRN",19.1,0)
19.1
"BLD",794,"KRN",101,0)
101
"BLD",794,"KRN",409.61,0)
409.61
"BLD",794,"KRN",771,0)
771
"BLD",794,"KRN",870,0)
870
"BLD",794,"KRN",8989.51,0)
8989.51
"BLD",794,"KRN",8989.52,0)
8989.52
"BLD",794,"KRN",8994,0)
8994
"BLD",794,"KRN","B",.4,.4)

"BLD",794,"KRN","B",.401,.401)

"BLD",794,"KRN","B",.402,.402)

"BLD",794,"KRN","B",.403,.403)

"BLD",794,"KRN","B",.5,.5)

"BLD",794,"KRN","B",.84,.84)

"BLD",794,"KRN","B",3.6,3.6)

"BLD",794,"KRN","B",3.8,3.8)

"BLD",794,"KRN","B",9.2,9.2)

"BLD",794,"KRN","B",9.8,9.8)

"BLD",794,"KRN","B",19,19)

"BLD",794,"KRN","B",19.1,19.1)

"BLD",794,"KRN","B",101,101)

"BLD",794,"KRN","B",409.61,409.61)

"BLD",794,"KRN","B",771,771)

"BLD",794,"KRN","B",870,870)

"BLD",794,"KRN","B",8989.51,8989.51)

"BLD",794,"KRN","B",8989.52,8989.52)

"BLD",794,"KRN","B",8994,8994)

"BLD",794,"QUES",0)
^9.62^^
"BLD",794,"REQB",0)
^9.611^1^1
"BLD",794,"REQB",1,0)
XU*8.0*288^2
"BLD",794,"REQB","B","XU*8.0*288",1)

"FIA",200)
NEW PERSON
"FIA",200,0)
^VA(200,
"FIA",200,0,0)
200I
"FIA",200,0,1)
y^n^p^^^^n^^n
"FIA",200,0,10)

"FIA",200,0,11)

"FIA",200,0,"RLRO")

"FIA",200,0,"VR")
8.0^XU
"FIA",200,200)
1
"FIA",200,200,351)

"FIA",200,200.0351)
0
"INIT")
XU8P330X
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
330^3040420
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3040420
"PKG",3,22,1,"PAH",1,1,1,0)
See patch XU*8*330 in the National Patch Module on FORUM for complete
"PKG",3,22,1,"PAH",1,1,2,0)
information on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XU8P330X")
0^^B3279252
"RTN","XU8P330X",1,0)
XU8P330X ;OIFO-O/SO-CREATE NEW-STYLE XREF ;12:29 PM  16 Jan 2004
"RTN","XU8P330X",2,0)
 ;;8.0;KERNEL;**330**;Jul 10, 1995
"RTN","XU8P330X",3,0)
 ;
"RTN","XU8P330X",4,0)
 N XU8PXR,XU8PRES,XU8POUT
"RTN","XU8P330X",5,0)
 S XU8PXR("FILE")=200
"RTN","XU8P330X",6,0)
 S XU8PXR("NAME")="AUSER"
"RTN","XU8P330X",7,0)
 S XU8PXR("TYPE")="MU"
"RTN","XU8P330X",8,0)
 S XU8PXR("USE")="S"
"RTN","XU8P330X",9,0)
 S XU8PXR("EXECUTION")="R"
"RTN","XU8P330X",10,0)
 S XU8PXR("ACTIVITY")="IR"
"RTN","XU8P330X",11,0)
 S XU8PXR("SHORT DESCR")="Build cross reference of active users"
"RTN","XU8P330X",12,0)
 S XU8PXR("DESCR",1)="This is a cross reference of CPRS Active USERs (AUSER) and is set if:"
"RTN","XU8P330X",13,0)
 S XU8PXR("DESCR",2)=" a. the IEN is not less than 1"
"RTN","XU8P330X",14,0)
 S XU8PXR("DESCR",3)=" and"
"RTN","XU8P330X",15,0)
 S XU8PXR("DESCR",4)=" b. the Kernel API $$PROVIDER^XUSER(ien) is True; IA#: 2343"
"RTN","XU8P330X",16,0)
 S XU8PXR("DESCR",5)=" "
"RTN","XU8P330X",17,0)
 S XU8PXR("DESCR",6)=" The cross reference is in the format:"
"RTN","XU8P330X",18,0)
 S XU8PXR("DESCR",7)=" ^VA(200,""AUSER"",<NAME(#.01) value>,IEN)="""""
"RTN","XU8P330X",19,0)
 S XU8PXR("SET")="I DA'<1,$$PROVIDER^XUSER(DA),X(1)]"""" S ^VA(200,""AUSER"",X(1),DA)="""""
"RTN","XU8P330X",20,0)
 S XU8PXR("KILL")="I ((DA'<1&X1(1)'=X2(1))!(DA'<1&X2(2)="""")) K ^VA(200,""AUSER"",X1(1),DA)"
"RTN","XU8P330X",21,0)
 S XU8PXR("WHOLE KILL")="K ^VA(200,""AUSER"")"
"RTN","XU8P330X",22,0)
 S XU8PXR("SET CONDITION")="Q"
"RTN","XU8P330X",23,0)
 S XU8PXR("KILL CONDITION")="Q"
"RTN","XU8P330X",24,0)
 S XU8PXR("VAL",1)=.01
"RTN","XU8P330X",25,0)
 S XU8PXR("VAL",1,"COLLATION")="F"
"RTN","XU8P330X",26,0)
 S XU8PXR("VAL",2)=2
"RTN","XU8P330X",27,0)
 S XU8PXR("VAL",2,"COLLATION")="F"
"RTN","XU8P330X",28,0)
 D CREIXN^DDMOD(.XU8PXR,"SW",.XU8PRES,"XU8POUT")
"RTN","XU8P330X",29,0)
 Q
"RTN","XUSER")
0^1^B7309579
"RTN","XUSER",1,0)
XUSER ;SFISC/RWF - A common set of user functions ;5:57 AM  15 Dec 2003
"RTN","XUSER",2,0)
 ;;8.0;KERNEL;**75,97,99,150,226,267,288,330**;Jul 10, 1995
"RTN","XUSER",3,0)
 ;Covered under DBIA #2343
"RTN","XUSER",4,0)
 Q
"RTN","XUSER",5,0)
LOOKUP(XUF) ;Do a user lookup
"RTN","XUSER",6,0)
 ;Parameter, "Q" to NOT ask OK.
"RTN","XUSER",7,0)
 ;Parameter, "A" Don't select current users who have a termination
"RTN","XUSER",8,0)
 ;               date prior to today's date
"RTN","XUSER",9,0)
 N DIC,XUDA,DIR,Y
"RTN","XUSER",10,0)
LK1 S DIC="^VA(200,",DIC(0)="AEMQZ" D ^DIC S XUDA=Y G:Y'>0 LKX
"RTN","XUSER",11,0)
 S Y=$P(Y(0),"^",11) I Y>0,Y<DT W !?15,"This user was terminated on ",$$FMTE^XLFDT(Y) I $G(XUF)["A" S XUDA=-1 G LK1
"RTN","XUSER",12,0)
 G:$G(XUF)["Q" LKX
"RTN","XUSER",13,0)
 S DIR(0)="Y",DIR("A")=" Is "_$P(XUDA,U,2)_" the one you want",DIR("B")="YES" D ^DIR
"RTN","XUSER",14,0)
 I Y'=1 S XUDA=-1 G:'$D(DIRUT) LK1
"RTN","XUSER",15,0)
LKX Q XUDA
"RTN","XUSER",16,0)
 ;
"RTN","XUSER",17,0)
ACTIVE(XUDA) ;Get if a user is active.
"RTN","XUSER",18,0)
 N %,X1,X2
"RTN","XUSER",19,0)
 S X1=$G(^VA(200,+$G(XUDA),0)),X2=$S(X1="":"",1:0)
"RTN","XUSER",20,0)
 I $L($P(X1,U,3)) S X2="1^"_$S($L($P($G(^VA(200,XUDA,.1)),U,2)):"ACTIVE",1:"NEW")
"RTN","XUSER",21,0)
 S:$P(X1,U,7)=1 X2="0^DISUSER"
"RTN","XUSER",22,0)
 S:X2["ACTIVE" $P(X2,U,3)=$P($G(^VA(200,XUDA,1.1)),U) ;Return last sign-on
"RTN","XUSER",23,0)
 S %=$P(X1,U,11) I %>0,%'>DT S X2="0^TERMINATED^"_%
"RTN","XUSER",24,0)
 Q X2
"RTN","XUSER",25,0)
 ;
"RTN","XUSER",26,0)
PROVIDER(XUDA,XUF) ;See if user qualifies as a CPRS provider
"RTN","XUSER",27,0)
 ;XUDA = IEN of Record in New Person File
"RTN","XUSER",28,0)
 ;XUF = Flag to control processing
"RTN","XUSER",29,0)
 ;      0 or not passed, do not include Visitors
"RTN","XUSER",30,0)
 ;      1 include Visitors
"RTN","XUSER",31,0)
 N %,X1,X2
"RTN","XUSER",32,0)
 ;Test to see if XUDA Passed
"RTN","XUSER",33,0)
 I '$D(XUDA) Q ""
"RTN","XUSER",34,0)
 ;Test for valid IEN
"RTN","XUSER",35,0)
 S X1=$G(^VA(200,+$G(XUDA),0)),X2=$S(X1="":"",1:1) Q:X2="" ""
"RTN","XUSER",36,0)
 ;Test for Access Code
"RTN","XUSER",37,0)
 I $P(X1,U,3)]"" Q 1
"RTN","XUSER",38,0)
 ;Test for a Termination Date not in the Future
"RTN","XUSER",39,0)
 S %=$P(X1,U,11) I %>0,%'>DT Q "0^TERMINATED^"_%
"RTN","XUSER",40,0)
 ;Tests for Visitors
"RTN","XUSER",41,0)
 I +$G(XUF),$D(^VA(200,"BB","VISITOR",XUDA)) Q 1
"RTN","XUSER",42,0)
 I $D(^VA(200,"BB","VISITOR",XUDA)) Q "0^VISITOR"
"RTN","XUSER",43,0)
 ;Default
"RTN","XUSER",44,0)
 Q "0^NOT A PROVIDER"
"RTN","XUSER",45,0)
 ;
"RTN","XUSER",46,0)
DEA(FG,IEN) ;sr. ef. Return users DEA # or Facility DEA_"-"_user VA# or null
"RTN","XUSER",47,0)
 ;If FG is 1: DEA# or VA#
"RTN","XUSER",48,0)
 N DEA,VA,IN,N,N1,INN
"RTN","XUSER",49,0)
 S IEN=$G(IEN,DUZ),INN=+DUZ(2)
"RTN","XUSER",50,0)
 S N=$G(^VA(200,IEN,"PS")),N1=$G(^VA(200,IEN,"QAR"))
"RTN","XUSER",51,0)
 S DEA=$P(N,U,2),VA=$P(N,U,3)
"RTN","XUSER",52,0)
 I $L(DEA),$S('$L($P(N1,U,9)):1,1:$P(N1,U,9)>DT) Q DEA
"RTN","XUSER",53,0)
 I $G(FG) Q VA
"RTN","XUSER",54,0)
 S IN=$P($G(^DIC(4,INN,"DEA")),U) ;Check signed-in Inst.
"RTN","XUSER",55,0)
 I '$L(IN) D
"RTN","XUSER",56,0)
 . N XU1 D PARENT^XUAF4("XU1","`"_INN,"PARENT FACILITY")
"RTN","XUSER",57,0)
 . S INN=$O(XU1("P","")) I INN S IN=$P($G(^DIC(4,INN,"DEA")),U)
"RTN","XUSER",58,0)
 . Q
"RTN","XUSER",59,0)
 I $L(VA),$L(IN) Q IN_"-"_VA
"RTN","XUSER",60,0)
 Q ""
"RTN","XUSER",61,0)
 ;
"RTN","XUSER",62,0)
DIV4(XUROOT,XUDUZ) ;Return the Divisions that this user is assigned to.
"RTN","XUSER",63,0)
 ;Returns 0 - no institution for user, 1 - institution for user
"RTN","XUSER",64,0)
 ;XUROOT is passed by reference.
"RTN","XUSER",65,0)
 N %,%1 S:$G(XUDUZ)="" XUDUZ=DUZ S (%,%1)=0
"RTN","XUSER",66,0)
 F  S %=$O(^VA(200,XUDUZ,2,%)) Q:%'>0  S XUROOT(%)=$P($G(^(%,0)),U,2),%1=1
"RTN","XUSER",67,0)
 Q %1
"RTN","XUSER",68,0)
 ;
"RTN","XUSER",69,0)
NAME(IEN,FL) ;Return the full name from Name Components file
"RTN","XUSER",70,0)
 N NA S NA("FILE")=200,NA("FIELD")=.01,NA("IENS")=IEN
"RTN","XUSER",71,0)
 S FL=$G(FL,"G") ;Valid are Famly or Given
"RTN","XUSER",72,0)
 S:"FG"'[FL FL="G"
"RTN","XUSER",73,0)
 Q $$NAMEFMT^XLFNAME(.NA,FL,"CMDP")
"RTN","XUSER",74,0)
 ;
"RTN","XUSER",75,0)
HL7(IEN) ;Return a HL7 name from the components file
"RTN","XUSER",76,0)
 N NA S NA("FILE")=200,NA("FIELD")=.01,NA("IENS")=IEN
"RTN","XUSER",77,0)
 Q $$HLNAME^XLFNAME(.NA,"","~")
"RTN","XUSER",78,0)
 ;
"UP",200,200.0351,-1)
200^351
"UP",200,200.0351,0)
200.0351
"VER")
8.0^22.0
"^DD",200,200,351,0)
PERSONAL DIAGNOSES LIST^200.0351PA^^351;0
"^DD",200,200,351,21,0)
^^1^1^3040302^
"^DD",200,200,351,21,1,0)
This is the provider's personal list of preferred diagnoses codes.
"^DD",200,200.0351,0)
PERSONAL DIAGNOSES LIST SUB-FIELD^^2^3
"^DD",200,200.0351,0,"DT")
3040302
"^DD",200,200.0351,0,"IX","B",200.0351,.01)

"^DD",200,200.0351,0,"NM","PERSONAL DIAGNOSES LIST")

"^DD",200,200.0351,0,"UP")
200
"^DD",200,200.0351,.01,0)
DIAGNOSIS^P80'^ICD9(^0;1^Q
"^DD",200,200.0351,.01,1,0)
^.1
"^DD",200,200.0351,.01,1,1,0)
200.0351^B
"^DD",200,200.0351,.01,1,1,1)
S ^VA(200,DA(1),351,"B",$E(X,1,30),DA)=""
"^DD",200,200.0351,.01,1,1,2)
K ^VA(200,DA(1),351,"B",$E(X,1,30),DA)
"^DD",200,200.0351,.01,21,0)
^^1^1^3040302^
"^DD",200,200.0351,.01,21,1,0)
A diagnosis in the provider's preferred list.
"^DD",200,200.0351,.01,"DT")
3040302
"^DD",200,200.0351,1,0)
DIAGNOSIS DESCRIPTION^CJ250^^ ; ^X ^DD(200.0351,1,9.2) S D0=$P(Y(200.0351,1,1),U,1) S:'D0!'$D(^ICD9(+D0,0)) D0=-1 S Y(200.0351,1,101)=$S($D(^ICD9(D0,0)):^(0),1:"") S X=$P(Y(200.0351,1,101),U,3) S D0=Y(200.0351,1,80) S D1=Y(200.0351,1,81)
"^DD",200,200.0351,1,9.01)
80^3;200.0351^.01
"^DD",200,200.0351,1,9.1)
.01:3
"^DD",200,200.0351,1,9.2)
S Y(200.0351,1,81)=$G(D1),Y(200.0351,1,80)=$G(D0),Y(200.0351,1,1)=$S($D(^VA(200,D0,351,D1,0)):^(0),1:"")
"^DD",200,200.0351,1,21,0)
^^2^2^3040302^
"^DD",200,200.0351,1,21,1,0)
This is the diagnosis code's description as stored in the ICD Diagnosis 
"^DD",200,200.0351,1,21,2,0)
File, file # 80.
"^DD",200,200.0351,1,"DT")
3040302
"^DD",200,200.0351,2,0)
ACTIVE DIAGNOSIS INDICATOR^CJ10^^ ; ^X ^DD(200.0351,2,9.3) S Y(200.0351,2,101)=$S($D(^ICD9(D0,0)):^(0),1:"") S X=$P($P(Y(200.0351,2,102),$C(59)_$P(Y(200.0351,2,101),U,9)_":",2),$C(59)) S D0=Y(200.0351,2,80) S D1=Y(200.0351,2,81)
"^DD",200,200.0351,2,9.01)
80^100;200.0351^.01
"^DD",200,200.0351,2,9.1)
.01:INACTIVE FLAG
"^DD",200,200.0351,2,9.2)
S Y(200.0351,2,81)=$G(D1),Y(200.0351,2,80)=$G(D0),Y(200.0351,2,1)=$S($D(^VA(200,D0,351,D1,0)):^(0),1:"")
"^DD",200,200.0351,2,9.3)
X ^DD(200.0351,2,9.2) S D0=$P(Y(200.0351,2,1),U,1) S:'D0!'$D(^ICD9(+D0,0)) D0=-1 S Y(200.0351,2,102)=$C(59)_$P($G(^DD(80,100,0)),U,3)
"^DD",200,200.0351,2,21,0)
^^3^3^3040302^
"^DD",200,200.0351,2,21,1,0)
This is the inactive diagnosis indicator. It is the flag that indicates 
"^DD",200,200.0351,2,21,2,0)
if the diagnosis code has been made inactive. It is stored in the ICD 
"^DD",200,200.0351,2,21,3,0)
Diagnosis File, file # 80.
"^DD",200,200.0351,2,"DT")
3040302
**END**
**END**
