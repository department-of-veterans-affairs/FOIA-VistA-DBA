Released IBD*3*17 SEQ #18
Extracted from mail message
**KIDS**:IBD*3.0*17^

**INSTALL NAME**
IBD*3.0*17
"BLD",320,0)
IBD*3.0*17^AUTOMATED INFO COLLECTION SYS^0^^y
"BLD",320,1,0)
^^3^3^2980427^
"BLD",320,1,1,0)
AICS changes to accommodate the ACRP conversion changes for outpatient
"BLD",320,1,2,0)
encounter retrieval.  Refer to the national patch module for more detailed
"BLD",320,1,3,0)
information.
"BLD",320,4,0)
^9.64PA^^
"BLD",320,"ABNS",0)
^9.66A^^
"BLD",320,"ABPKG")
y^n
"BLD",320,"KRN",0)
^9.67PA^19^18
"BLD",320,"KRN",.4,0)
.4
"BLD",320,"KRN",.401,0)
.401
"BLD",320,"KRN",.402,0)
.402
"BLD",320,"KRN",.403,0)
.403
"BLD",320,"KRN",.5,0)
.5
"BLD",320,"KRN",.84,0)
.84
"BLD",320,"KRN",3.6,0)
3.6
"BLD",320,"KRN",3.8,0)
3.8
"BLD",320,"KRN",9.2,0)
9.2
"BLD",320,"KRN",9.8,0)
9.8
"BLD",320,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",320,"KRN",9.8,"NM",1)
^^^
"BLD",320,"KRN",9.8,"NM",1,0)
IBDFOSG3^^1
"BLD",320,"KRN",9.8,"NM",2)
^^^
"BLD",320,"KRN",9.8,"NM",2,0)
IBDFOSG4^^1
"BLD",320,"KRN",9.8,"NM",3,0)
IBDFRPC3^^0^B15015199
"BLD",320,"KRN",9.8,"NM","B","IBDFOSG3",1)

"BLD",320,"KRN",9.8,"NM","B","IBDFOSG4",2)

"BLD",320,"KRN",9.8,"NM","B","IBDFRPC3",3)

"BLD",320,"KRN",19,0)
19
"BLD",320,"KRN",19.1,0)
19.1
"BLD",320,"KRN",101,0)
101
"BLD",320,"KRN",409.61,0)
409.61
"BLD",320,"KRN",771,0)
771
"BLD",320,"KRN",869.2,0)
869.2
"BLD",320,"KRN",870,0)
870
"BLD",320,"KRN",8994,0)
8994
"BLD",320,"KRN","B",.4,.4)

"BLD",320,"KRN","B",.401,.401)

"BLD",320,"KRN","B",.402,.402)

"BLD",320,"KRN","B",.403,.403)

"BLD",320,"KRN","B",.5,.5)

"BLD",320,"KRN","B",.84,.84)

"BLD",320,"KRN","B",3.6,3.6)

"BLD",320,"KRN","B",3.8,3.8)

"BLD",320,"KRN","B",9.2,9.2)

"BLD",320,"KRN","B",9.8,9.8)

"BLD",320,"KRN","B",19,19)

"BLD",320,"KRN","B",19.1,19.1)

"BLD",320,"KRN","B",101,101)

"BLD",320,"KRN","B",409.61,409.61)

"BLD",320,"KRN","B",771,771)

"BLD",320,"KRN","B",869.2,869.2)

"BLD",320,"KRN","B",870,870)

"BLD",320,"KRN","B",8994,8994)

"BLD",320,"QUES",0)
^9.62^^
"BLD",320,"REQB",0)
^9.611^3^3
"BLD",320,"REQB",1,0)
IBD*3.0*3^2
"BLD",320,"REQB",2,0)
IBD*3.0*6^2
"BLD",320,"REQB",3,0)
IB*2.0*91^2
"BLD",320,"REQB","B","IB*2.0*91",3)

"BLD",320,"REQB","B","IBD*3.0*3",1)

"BLD",320,"REQB","B","IBD*3.0*6",2)

"OER",373,0)
373^IBD
"OER",373,1,0)
^100.9951PA^13^13
"OER",373,1,1,0)
635
"OER",373,1,1,1,0)
^100.99511PA^1^1
"OER",373,1,1,1,1,0)
1228
"OER",373,1,2,0)
634
"OER",373,1,2,1,0)
^100.99511PA^1^1
"OER",373,1,2,1,1,0)
1228
"OER",373,1,3,0)
639
"OER",373,1,3,1,0)
^100.99511PA^1^1
"OER",373,1,3,1,1,0)
1228
"OER",373,1,4,0)
640
"OER",373,1,4,1,0)
^100.99511PA^1^1
"OER",373,1,4,1,1,0)
1228
"OER",373,1,5,0)
636
"OER",373,1,5,1,0)
^100.99511PA^1^1
"OER",373,1,5,1,1,0)
1228
"OER",373,1,6,0)
644
"OER",373,1,6,1,0)
^100.99511PA^1^1
"OER",373,1,6,1,1,0)
1228
"OER",373,1,7,0)
659
"OER",373,1,7,1,0)
^100.99511PA^1^1
"OER",373,1,7,1,1,0)
1228
"OER",373,1,8,0)
660
"OER",373,1,8,1,0)
^100.99511PA^1^1
"OER",373,1,8,1,1,0)
1228
"OER",373,1,9,0)
637
"OER",373,1,9,1,0)
^100.99511PA^1^1
"OER",373,1,9,1,1,0)
1228
"OER",373,1,10,0)
638
"OER",373,1,10,1,0)
^100.99511PA^1^1
"OER",373,1,10,1,1,0)
1228
"OER",373,1,11,0)
642
"OER",373,1,11,1,0)
^100.99511PA^1^1
"OER",373,1,11,1,1,0)
1228
"OER",373,1,12,0)
663
"OER",373,1,12,1,0)
^100.99511PA^1^1
"OER",373,1,12,1,1,0)
1228
"OER",373,1,13,0)
1665
"OER",373,1,13,1,0)
^100.99511PA^2^2
"OER",373,1,13,1,1,0)
1707
"OER",373,1,13,1,2,0)
1110
"OER",373,5,0)
^100.9955^^0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"PKG",373,-1)
1^1
"PKG",373,0)
AUTOMATED INFO COLLECTION SYS^IBD^The utilities for generating a paper encounter form.
"PKG",373,22,0)
^9.49I^1^1
"PKG",373,22,1,0)
3.0^2970212^2970925^539
"PKG",373,22,1,"PAH",1,0)
17
"PKG",373,22,1,"PAH",1,1,0)
^^3^3^2980427
"PKG",373,22,1,"PAH",1,1,1,0)
AICS changes to accommodate the ACRP conversion changes for outpatient
"PKG",373,22,1,"PAH",1,1,2,0)
encounter retrieval.  Refer to the national patch module for more detailed
"PKG",373,22,1,"PAH",1,1,3,0)
information.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","IBDFOSG3")
1^1
"RTN","IBDFOSG4")
1^2
"RTN","IBDFRPC3")
0^3^B15015199
"RTN","IBDFRPC3",1,0)
IBDFRPC3 ;ALB/AAS - AICS Identify patient form form id ; 12-FEB-96
"RTN","IBDFRPC3",2,0)
 ;;3.0;AUTOMATED INFO COLLECTION SYS;**6,3,17**;APR 24, 1997
"RTN","IBDFRPC3",3,0)
 ;
"RTN","IBDFRPC3",4,0)
 ; -- used by AICS Data Entry System (routine IBDFDE)
"RTN","IBDFRPC3",5,0)
 ;    used by AICS Workstation software
"RTN","IBDFRPC3",6,0)
 ;
"RTN","IBDFRPC3",7,0)
IDPAT(RESULT,FORMID) ; -- Procedure
"RTN","IBDFRPC3",8,0)
 ; -- Broker call to identify patient, clinic, form, and appt. from
"RTN","IBDFRPC3",9,0)
 ;    Encounter form ID
"RTN","IBDFRPC3",10,0)
 ;    rpc := IBD EXPAND FORMID
"RTN","IBDFRPC3",11,0)
 ;
"RTN","IBDFRPC3",12,0)
 ; -- input  FORMID = pointer to form tracking (357.96)
"RTN","IBDFRPC3",13,0)
 ;                    if Formid := Formid_"LOOKUP" then no errors created
"RTN","IBDFRPC3",14,0)
 ;           Result = called by reference
"RTN","IBDFRPC3",15,0)
 ;
"RTN","IBDFRPC3",16,0)
 ; -- output  The format of the returned array is as follows
"RTN","IBDFRPC3",17,0)
 ;        result = $p1 :=  Patient Name^
"RTN","IBDFRPC3",18,0)
 ;                 $p2 :=  Patient IEN
"RTN","IBDFRPC3",19,0)
 ;                 $p3 :=  patient primary identifier (pid)
"RTN","IBDFRPC3",20,0)
 ;                 $p4 :=  form name
"RTN","IBDFRPC3",21,0)
 ;                 $p5 :=  form IEN (pointer to 357)
"RTN","IBDFRPC3",22,0)
 ;                 $p6 :=  Clinic Name 
"RTN","IBDFRPC3",23,0)
 ;                 $p7 :=  Clinic ien
"RTN","IBDFRPC3",24,0)
 ;                 $p8 :=  Clinic Physical Location
"RTN","IBDFRPC3",25,0)
 ;                 $p9 :=  Appt. date/time (fm format)
"RTN","IBDFRPC3",26,0)
 ;                 $P10:=  Appt. date/time (external format)
"RTN","IBDFRPC3",27,0)
 ;                 $P11:=  Appt Status internal
"RTN","IBDFRPC3",28,0)
 ;                 $P12:=  Appt Status external
"RTN","IBDFRPC3",29,0)
 ;                 $P13:=  form input status internal
"RTN","IBDFRPC3",30,0)
 ;                 $p14:=  form input status external
"RTN","IBDFRPC3",31,0)
 ;                 $p15:=  form definition ien (357.95)
"RTN","IBDFRPC3",32,0)
 ;                 $p16:=  default provider (for clinic) internal
"RTN","IBDFRPC3",33,0)
 ;                 $p17:=  default provider (for clinic) external
"RTN","IBDFRPC3",34,0)
 ;                 $P18:=  # Scannable pages on form
"RTN","IBDFRPC3",35,0)
 ;                 $p19:=  shortedge/long edge binding
"RTN","IBDFRPC3",36,0)
 ;                 $p20:=  check out date time
"RTN","IBDFRPC3",37,0)
 ;
"RTN","IBDFRPC3",38,0)
 N C,I,J,X,Y,NODE,PATNM,DFN,PID,CLIN,CLINNM,FORMNM,FORM,APPT,APPTNM,STATUS,STATNM,FRMDEF,PROVDEF,APPTSTI,APPTSTE,CLINPH,DUPLX,SCANPG,CO,LOOKUP
"RTN","IBDFRPC3",39,0)
 K RESULT
"RTN","IBDFRPC3",40,0)
 S FORMID("SOURCE")=1
"RTN","IBDFRPC3",41,0)
 S LOOKUP=0
"RTN","IBDFRPC3",42,0)
 ;
"RTN","IBDFRPC3",43,0)
 ; -- formid is for lookup only
"RTN","IBDFRPC3",44,0)
 I $E(FORMID,($L(FORMID)-5),$L(FORMID))="LOOKUP" S FORMID=+FORMID,LOOKUP=1
"RTN","IBDFRPC3",45,0)
 ;
"RTN","IBDFRPC3",46,0)
 ; -- scanner may send in leading spaces, strip it off
"RTN","IBDFRPC3",47,0)
 I +FORMID'=FORMID,$L(FORMID) S FORMID=+$P(FORMID," ",3)
"RTN","IBDFRPC3",48,0)
 S RESULT="Form ID not a valid value, null or zero^^^"
"RTN","IBDFRPC3",49,0)
 I '$G(FORMID) D:'$G(LOOKUP) LOGERR^IBDF18E2(3579604,.FORMID) G IDPATQ
"RTN","IBDFRPC3",50,0)
 ;
"RTN","IBDFRPC3",51,0)
 S RESULT="Form ID not found^^^"
"RTN","IBDFRPC3",52,0)
 S NODE=$G(^IBD(357.96,+FORMID,0))
"RTN","IBDFRPC3",53,0)
 I NODE="" D:'$G(LOOKUP) LOGERR^IBDF18E2(3579605,.FORMID) G IDPATQ
"RTN","IBDFRPC3",54,0)
 ;
"RTN","IBDFRPC3",55,0)
 S DFN=+$P(NODE,"^",2)
"RTN","IBDFRPC3",56,0)
 I 'DFN S RESULT="Patient Information is Missing^^^^" G IDPATQ
"RTN","IBDFRPC3",57,0)
 S PATNM=$P($G(^DPT(DFN,0)),"^"),PID=$P($G(^DPT(DFN,.36)),"^",3)
"RTN","IBDFRPC3",58,0)
 S APPT=+$P(NODE,"^",3)
"RTN","IBDFRPC3",59,0)
 S APPTSTI=$P($G(^DPT(DFN,"S",APPT,0)),"^",2)
"RTN","IBDFRPC3",60,0)
 S APPTNM=$$FMTE^XLFDT(APPT)
"RTN","IBDFRPC3",61,0)
 ;
"RTN","IBDFRPC3",62,0)
 S X=$$STATUS^SDAM1(DFN,APPT,+$G(^DPT(DFN,"S",APPT,0)),$G(^(0)))
"RTN","IBDFRPC3",63,0)
 S APPTSTE=$P(X,";",3),CO=$P(X,";",5)
"RTN","IBDFRPC3",64,0)
 I $G(^DPT(DFN,"S",APPT,0))="",CO="" D
"RTN","IBDFRPC3",65,0)
 .S CO=+$$SDV(DFN,APPT)
"RTN","IBDFRPC3",66,0)
 .I CO S APPTSTE="COMPLETE"
"RTN","IBDFRPC3",67,0)
 .I +$G(CO)<1 S APPTSTE="ACTION REQUIRED"
"RTN","IBDFRPC3",68,0)
 ;
"RTN","IBDFRPC3",69,0)
 S CLIN=+$P(NODE,"^",10)
"RTN","IBDFRPC3",70,0)
 S CLINNM=$P($G(^SC(CLIN,0)),"^"),CLINPH=$P($G(^SC(CLIN,0)),"^",11)
"RTN","IBDFRPC3",71,0)
 S PROVDEF=$$PRDEF(CLIN)
"RTN","IBDFRPC3",72,0)
 S FRMDEF=$P(NODE,"^",4)
"RTN","IBDFRPC3",73,0)
 S FORM=+$P($G(^IBD(357.95,+FRMDEF,0)),"^",21)
"RTN","IBDFRPC3",74,0)
 S FORMNM=$P($G(^IBE(357,FORM,0)),"^")
"RTN","IBDFRPC3",75,0)
 S DUPLX=$P($G(^IBE(357,FORM,0)),"^",2) ; Duplex/simplex
"RTN","IBDFRPC3",76,0)
 S (SCANPG,I)=0 F  S I=$O(^IBD(357.96,+FORMID,9,I)) Q:'I  S SCANPG=SCANPG+1
"RTN","IBDFRPC3",77,0)
 S STATUS=$P(NODE,"^",11)
"RTN","IBDFRPC3",78,0)
 S Y=STATUS,C=$P(^DD(357.96,.11,0),"^",2) D Y^DIQ S STATNM=Y
"RTN","IBDFRPC3",79,0)
 S RESULT=PATNM_"^"_DFN_"^"_PID_"^"_FORMNM_"^"_FORM_"^"_CLINNM_"^"_CLIN_"^"_CLINPH_"^"_APPT_"^"_APPTNM_"^"_APPTSTI_"^"_APPTSTE_"^"_STATUS_"^"_STATNM_"^"_FRMDEF_"^"_PROVDEF_"^"_$P($G(^VA(200,+PROVDEF,0)),"^")_"^"_SCANPG_"^"_DUPLX_"^"_CO
"RTN","IBDFRPC3",80,0)
 ;
"RTN","IBDFRPC3",81,0)
IDPATQ Q
"RTN","IBDFRPC3",82,0)
 ;
"RTN","IBDFRPC3",83,0)
PRDEF(CLIN) ;Provider Default for Clinic
"RTN","IBDFRPC3",84,0)
 ; Input  -- SDCL     Hospital Location file IEN
"RTN","IBDFRPC3",85,0)
 ; IF DEFINED: DFN - ptr to PATIENT File
"RTN","IBDFRPC3",86,0)
 ; Output -- Default
"RTN","IBDFRPC3",87,0)
 N Y,X
"RTN","IBDFRPC3",88,0)
 S Y=$P($G(^SC(+$G(CLIN),"PR",+$O(^SC("ADPR",CLIN,0)),0)),"^")
"RTN","IBDFRPC3",89,0)
 I $G(Y)="",$G(^SC(+$G(CLIN),"PC")),$D(DFN),$L($T(NMPCPR^SCAPMCU2)) S Y=+$$NMPCPR^SCAPMCU2(DFN,DT,1)
"RTN","IBDFRPC3",90,0)
 Q $G(Y)
"RTN","IBDFRPC3",91,0)
 ;
"RTN","IBDFRPC3",92,0)
SDV(DFN,APPT) ; -- try to find checkout date of stand alone encounter
"RTN","IBDFRPC3",93,0)
 N CO,IBOE,IBVAL,IBCBK
"RTN","IBDFRPC3",94,0)
 S CO="",IBOE=""
"RTN","IBDFRPC3",95,0)
 S IBVAL("DFN")=DFN,IBVAL("BDT")=APPT,IBVAL("EDT")=APPT+.000001
"RTN","IBDFRPC3",96,0)
 S IBCBK="I '$P(Y0,U,6),$P(Y0,U,8)=3 S IBOE=Y,CO=$P(Y0,U,7),SDSTOP=1"
"RTN","IBDFRPC3",97,0)
 D SCAN^IBSDU("PATIENT/DATE",.IBVAL,"",IBCBK,1)
"RTN","IBDFRPC3",98,0)
 Q CO_"^"_IBOE
"RTN","IBDFRPC3",99,0)
 ;
"VER")
8.0^21.0
**END**
**END**
