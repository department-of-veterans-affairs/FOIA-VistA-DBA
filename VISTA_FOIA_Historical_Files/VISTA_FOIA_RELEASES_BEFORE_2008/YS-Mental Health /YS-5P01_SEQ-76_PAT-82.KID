Released YS*5.01*82 SEQ #76
Extracted from mail message
**KIDS**:YS*5.01*82^

**INSTALL NAME**
YS*5.01*82
"BLD",7088,0)
YS*5.01*82^MENTAL HEALTH^0^3070126^y
"BLD",7088,1,0)
^^6^6^3070111^^^^
"BLD",7088,1,1,0)
This patch fixes the problem with undefined errors occurring when
"BLD",7088,1,2,0)
displaying incomplete Seclusion/Restraint (S/R) record
"BLD",7088,1,3,0)
Information via YSSR ENTRY and YSSR RELEASE options and removes 
"BLD",7088,1,4,0)
leftover nodes from a previous restructuring of file 604.
"BLD",7088,1,5,0)
It also corrects a problem whereby GAF scores are not always
"BLD",7088,1,6,0)
seen in the Encounter dialogue of CPRS.
"BLD",7088,4,0)
^9.64PA^^
"BLD",7088,6)
2^
"BLD",7088,6.3)
3
"BLD",7088,"ABPKG")
n
"BLD",7088,"INID")
n^n
"BLD",7088,"INIT")
POST^YS501P82
"BLD",7088,"KRN",0)
^9.67PA^8989.52^19
"BLD",7088,"KRN",.4,0)
.4
"BLD",7088,"KRN",.401,0)
.401
"BLD",7088,"KRN",.402,0)
.402
"BLD",7088,"KRN",.403,0)
.403
"BLD",7088,"KRN",.5,0)
.5
"BLD",7088,"KRN",.84,0)
.84
"BLD",7088,"KRN",3.6,0)
3.6
"BLD",7088,"KRN",3.8,0)
3.8
"BLD",7088,"KRN",9.2,0)
9.2
"BLD",7088,"KRN",9.8,0)
9.8
"BLD",7088,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",7088,"KRN",9.8,"NM",1,0)
YSSR^^0^B26878218
"BLD",7088,"KRN",9.8,"NM",2,0)
YSSR1^^0^B19626927
"BLD",7088,"KRN",9.8,"NM",3,0)
YS501P82^^0^B1110072
"BLD",7088,"KRN",9.8,"NM",4,0)
YSGAFAPI^^0^B2459639
"BLD",7088,"KRN",9.8,"NM","B","YS501P82",3)

"BLD",7088,"KRN",9.8,"NM","B","YSGAFAPI",4)

"BLD",7088,"KRN",9.8,"NM","B","YSSR",1)

"BLD",7088,"KRN",9.8,"NM","B","YSSR1",2)

"BLD",7088,"KRN",19,0)
19
"BLD",7088,"KRN",19.1,0)
19.1
"BLD",7088,"KRN",101,0)
101
"BLD",7088,"KRN",409.61,0)
409.61
"BLD",7088,"KRN",771,0)
771
"BLD",7088,"KRN",870,0)
870
"BLD",7088,"KRN",8989.51,0)
8989.51
"BLD",7088,"KRN",8989.52,0)
8989.52
"BLD",7088,"KRN",8994,0)
8994
"BLD",7088,"KRN","B",.4,.4)

"BLD",7088,"KRN","B",.401,.401)

"BLD",7088,"KRN","B",.402,.402)

"BLD",7088,"KRN","B",.403,.403)

"BLD",7088,"KRN","B",.5,.5)

"BLD",7088,"KRN","B",.84,.84)

"BLD",7088,"KRN","B",3.6,3.6)

"BLD",7088,"KRN","B",3.8,3.8)

"BLD",7088,"KRN","B",9.2,9.2)

"BLD",7088,"KRN","B",9.8,9.8)

"BLD",7088,"KRN","B",19,19)

"BLD",7088,"KRN","B",19.1,19.1)

"BLD",7088,"KRN","B",101,101)

"BLD",7088,"KRN","B",409.61,409.61)

"BLD",7088,"KRN","B",771,771)

"BLD",7088,"KRN","B",870,870)

"BLD",7088,"KRN","B",8989.51,8989.51)

"BLD",7088,"KRN","B",8989.52,8989.52)

"BLD",7088,"KRN","B",8994,8994)

"BLD",7088,"PRE")
YS501P82
"BLD",7088,"QUES",0)
^9.62^^
"BLD",7088,"REQB",0)
^9.611^1^1
"BLD",7088,"REQB",1,0)
YS*5.01*71^2
"BLD",7088,"REQB","B","YS*5.01*71",1)

"INIT")
POST^YS501P82
"MBREQ")
0
"PKG",159,-1)
1^1
"PKG",159,0)
MENTAL HEALTH^YS^Version 5.01 of Mental Health
"PKG",159,20,0)
^9.402P^^
"PKG",159,22,0)
^9.49I^1^1
"PKG",159,22,1,0)
5.01^2941230^2950325
"PKG",159,22,1,"PAH",1,0)
82^3070126^33274
"PKG",159,22,1,"PAH",1,1,0)
^^6^6^3070126
"PKG",159,22,1,"PAH",1,1,1,0)
This patch fixes the problem with undefined errors occurring when
"PKG",159,22,1,"PAH",1,1,2,0)
displaying incomplete Seclusion/Restraint (S/R) record
"PKG",159,22,1,"PAH",1,1,3,0)
Information via YSSR ENTRY and YSSR RELEASE options and removes 
"PKG",159,22,1,"PAH",1,1,4,0)
leftover nodes from a previous restructuring of file 604.
"PKG",159,22,1,"PAH",1,1,5,0)
It also corrects a problem whereby GAF scores are not always
"PKG",159,22,1,"PAH",1,1,6,0)
seen in the Encounter dialogue of CPRS.
"PRE")
YS501P82
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","YS501P82")
0^3^B1110072^n/a
"RTN","YS501P82",1,0)
YS501P82 ;BP/TMD,Pre-init Routine for YS*5.01*82 ; 2/18/04 9:29am
"RTN","YS501P82",2,0)
 ;;5.01;MENTAL HEALTH;**82**;Dec 30, 1994;Build 3
"RTN","YS501P82",3,0)
 ;
"RTN","YS501P82",4,0)
ENV ;Main entry point for Environment check point.
"RTN","YS501P82",5,0)
 ;
"RTN","YS501P82",6,0)
 S XPDABORT=""
"RTN","YS501P82",7,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","YS501P82",8,0)
 I XPDABORT="" K XPDABORT
"RTN","YS501P82",9,0)
 Q
"RTN","YS501P82",10,0)
 ;
"RTN","YS501P82",11,0)
POST ;Main entry point for Post-init items.
"RTN","YS501P82",12,0)
 ;
"RTN","YS501P82",13,0)
 ;Remove left over nodes from file restructuring
"RTN","YS501P82",14,0)
 I $D(^DD(604,18.1)) K ^DD(604,18.1)
"RTN","YS501P82",15,0)
 I $D(^DD(604,.53)) K ^DD(604,.53)
"RTN","YS501P82",16,0)
 Q
"RTN","YS501P82",17,0)
 ;
"RTN","YS501P82",18,0)
PROGCHK(XPDABORT) ;checks for necessary programmer variables
"RTN","YS501P82",19,0)
 ;
"RTN","YS501P82",20,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","YS501P82",21,0)
 .D BMES^XPDUTL("*****")
"RTN","YS501P82",22,0)
 .D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","YS501P82",23,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","YS501P82",24,0)
 .D MES^XPDUTL("*****")
"RTN","YS501P82",25,0)
 .S XPDABORT=2
"RTN","YS501P82",26,0)
 Q
"RTN","YSGAFAPI")
0^4^B2459639^B2405045
"RTN","YSGAFAPI",1,0)
YSGAFAPI ;ALB/ASF- GAF API ;2/7/02  15:57
"RTN","YSGAFAPI",2,0)
 ;;5.01;MENTAL HEALTH;**53,71,82**;Dec 30, 1994;Build 3
"RTN","YSGAFAPI",3,0)
GAFHX(YSDATA,YS) ;
"RTN","YSGAFAPI",4,0)
 N YSBEG,YSEND,YSLIMIT
"RTN","YSGAFAPI",5,0)
 K YSDATA
"RTN","YSGAFAPI",6,0)
 D PARSE(.YS)
"RTN","YSGAFAPI",7,0)
 I DFN'>0 S YSDATA(1)="[ERROR]",YSDATA(2)="No dfn" Q
"RTN","YSGAFAPI",8,0)
 S YSDATA(1)="[DATA]"
"RTN","YSGAFAPI",9,0)
 S N=1
"RTN","YSGAFAPI",10,0)
 D HXLP
"RTN","YSGAFAPI",11,0)
 Q
"RTN","YSGAFAPI",12,0)
PARSE(YS) ; -- array parsing
"RTN","YSGAFAPI",13,0)
 N X,Y,%DT
"RTN","YSGAFAPI",14,0)
 S DFN=$G(YS("DFN"),0)
"RTN","YSGAFAPI",15,0)
 S YSBEG=$G(YS("BEGIN"),"01/01/1970") S X=YSBEG D ^%DT S YSBEG=Y
"RTN","YSGAFAPI",16,0)
 S YSEND=$G(YS("END"),"01/01/2500") S X=YSEND D ^%DT S YSEND=Y
"RTN","YSGAFAPI",17,0)
 S YSLIMIT=$G(YS("LIMIT"),9999)
"RTN","YSGAFAPI",18,0)
 Q
"RTN","YSGAFAPI",19,0)
HXLP ;
"RTN","YSGAFAPI",20,0)
 N YSJJ,YSDD,X,Y,YSX,YSN
"RTN","YSGAFAPI",21,0)
 S YSDD=9999999-YSEND-.00001
"RTN","YSGAFAPI",22,0)
 F YSJJ=1:1:YSLIMIT S YSDD=$O(^YSD(627.8,"AX5",DFN,YSDD)) Q:YSDD'>0!(YSDD>(9999999-YSBEG))  D
"RTN","YSGAFAPI",23,0)
  . S YSN=0 F  S YSN=$O(^YSD(627.8,"AX5",DFN,YSDD,YSN)) Q:YSN'>0  D
"RTN","YSGAFAPI",24,0)
 .. S YSX=$P($G(^YSD(627.8,YSN,60)),U,3)
"RTN","YSGAFAPI",25,0)
 .. S Y=$P($G(^YSD(627.8,YSN,0)),U,3)
"RTN","YSGAFAPI",26,0)
 .. S YSX=Y_U_$$FMTE^XLFDT(Y,"5TZ")_"^GAF^GAF^"_YSX
"RTN","YSGAFAPI",27,0)
 .. S YSX=YSX_U_YSN_U_$$EXTERNAL^DILFD(627.8,.04,"",$P($G(^YSD(627.8,YSN,0)),U,4)) ;ASF 2/7/02
"RTN","YSGAFAPI",28,0)
 .. S YSX=YSX_U_$G(^YSD(627.8,YSN,80,1,0))
"RTN","YSGAFAPI",29,0)
 .. D SET(YSX)
"RTN","YSGAFAPI",30,0)
 Q
"RTN","YSGAFAPI",31,0)
SET(X) ;
"RTN","YSGAFAPI",32,0)
 S N=N+1
"RTN","YSGAFAPI",33,0)
 S YSDATA(N)=X
"RTN","YSGAFAPI",34,0)
 Q
"RTN","YSSR")
0^1^B26878218^B24842336
"RTN","YSSR",1,0)
YSSR ;SLC/AFE-SECLUSION/RESTRAINT - Lookup & Entry ; 1/27/04 2:35pm
"RTN","YSSR",2,0)
 ;;5.01;MENTAL HEALTH;**82**;Dec 30, 1994;Build 3
"RTN","YSSR",3,0)
 ;
"RTN","YSSR",4,0)
ENLST ; Called from MENU option YSSR ENTRY
"RTN","YSSR",5,0)
 ; Entry of basic S/R information
"RTN","YSSR",6,0)
 W @IOF,!?IOM-$L("SECLUSION/RESTRAINT INFORMATION")\2,"SECLUSION/RESTRAINT INFORMATION",! S MSG1="No patients listed in Seclusion/Restraint." D LKUP
"RTN","YSSR",7,0)
ENTER ;
"RTN","YSSR",8,0)
 D ^YSLRP I YSDFN'>0 G END
"RTN","YSSR",9,0)
 I $D(^YS(615.2,"AC",YSDFN)) W !!,"Patient shown in Seclusion/Restraint at this time.",! D WAIT^YSUTL G END
"RTN","YSSR",10,0)
 W ! S DIC="^YS(615.2,",DIC(0)="L",X="""N""",DLAYGO=615 D ^DIC G:Y<1 END S FN=+Y
"RTN","YSSR",11,0)
SQ ;
"RTN","YSSR",12,0)
 S %=0 F  Q:$G(%)  W !,"Was patient searched" S %=1 D 
"RTN","YSSR",13,0)
 .D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) I '% W !!,"If patient was not searched, a reason should be given for the omission.",!
"RTN","YSSR",14,0)
 I YSTOUT!YSUOUT!(%=-1) D DELETE G END
"RTN","YSSR",15,0)
 I %=1 S DA=FN,DIE=DIC,DR=".08////Y" L +^YS(615.2,DA) D ^DIE L -^YS(615.2,DA)
"RTN","YSSR",16,0)
 I %=2 S DA=FN,DIE=DIC,DR=".08////N;.09" L +^YS(615.2,DA) D ^DIE L -^YS(615.2,DA) S YSTOUT=$D(DTOUT) I YSTOUT D DELETE G END
"RTN","YSSR",17,0)
 D DXLKUP W ! S DIE="^YS(615.2,",DA=FN,DR=".02////"_YSDFN_";.03//NOW;.04:.07;25:27;4///^S X=""`""_DUZ;5:6;7//^S X=YSDX;10;15:20;30" L +^YS(615.2,DA) K Y D ^DIE L -^YS(615.2,DA)
"RTN","YSSR",18,0)
 S YSTOUT=$D(DTOUT),YSUOUT=$O(Y(""))]""
"RTN","YSSR",19,0)
 I YSTOUT!YSUOUT!('$O(^YS(615.2,DA,5,0)))!('$O(^YS(615.2,DA,6,0)))!($G(^YS(615.2,DA,7))']"")!('$O(^(10,0)))!('+$G(^YS(615.2,DA,25))) W !!?13,"INSUFFICIENT INFORMATION" D DELETE G END
"RTN","YSSR",20,0)
REVIEW ;
"RTN","YSSR",21,0)
 S %=0 F  Q:$G(%)  W !!,"Do you need to edit the above information" S %=1 D 
"RTN","YSSR",22,0)
 .D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) I '% W !!,"After the information is filed, you may no longer edit it.",!,"You may alter the information now.",!
"RTN","YSSR",23,0)
 I YSTOUT!YSUOUT D DELETE G END
"RTN","YSSR",24,0)
 I %=1 D EDIT
"RTN","YSSR",25,0)
FILE ;
"RTN","YSSR",26,0)
 S %=0 F  Q:$G(%)  W !!,"Save this information" S %=1 D 
"RTN","YSSR",27,0)
 .D YN^DICN S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT) I '% W !!,"NO, will delete this information from the record.",!,"YES, will file it under the patient's name."
"RTN","YSSR",28,0)
 I %=1 W !!?5,"INFORMATION NOTED.",! Q
"RTN","YSSR",29,0)
 D DELETE
"RTN","YSSR",30,0)
END ; Called by routines YSSR1, YSSR2
"RTN","YSSR",31,0)
 N YSDT,YSPDZ,YSTOUT,YSUOUT,XQT,YSDTM,YSLC,YSLCN,YSTM D KILL^XUSCLEAN
"RTN","YSSR",32,0)
 Q
"RTN","YSSR",33,0)
 ;
"RTN","YSSR",34,0)
EDIT ;
"RTN","YSSR",35,0)
 S DIE="^YS(615.2,",DA=FN,DR=".03:3;5:25:27;30" L +^YS(615.2,DA) D ^DIE L -^YS(615.2,DA) K DIE
"RTN","YSSR",36,0)
 Q
"RTN","YSSR",37,0)
 ;
"RTN","YSSR",38,0)
DELETE ; Called by routine YSSR2
"RTN","YSSR",39,0)
 S DIK="^YS(615.2,",DA=FN D ^DIK W !!?10,"< ENTRY FOR "_$P(YSNM,",",2)_" "_$P(YSNM,",")_" DELETED >",! Q
"RTN","YSSR",40,0)
 ;
"RTN","YSSR",41,0)
PTNAME ; Called by routine YSSR1
"RTN","YSSR",42,0)
 ; Patient look-up.
"RTN","YSSR",43,0)
 W ! D ^YSLRP I $G(X)["^" S YSQT=1 Q
"RTN","YSSR",44,0)
 I YSDFN<1 W !!,"Patient Name Required.",! S YSQT=1 Q
"RTN","YSSR",45,0)
 S YSN=$P(YSNM,",",2)_" "_$P(YSNM,",")
"RTN","YSSR",46,0)
 Q
"RTN","YSSR",47,0)
LKUP ; Called as ENTRY action from MENU option YSSR SEC/RES
"RTN","YSSR",48,0)
 ; Called by routine YSSR1
"RTN","YSSR",49,0)
 ; Lists patients in currently in S/R.  May pass YSQT.
"RTN","YSSR",50,0)
 S:'$D(MSG1) MSG1="No patients currently listed in seclusion/restraint." I '$O(^YS(615.2,"AC",0)) W !?IOM-$L(" ** "_MSG1_" ** ")\2," ** "_MSG1_" ** ",!! Q 
"RTN","YSSR",51,0)
 W !!,"The following patient(s) are currently listed as being in Seclusion/Restraint:  ",!
"RTN","YSSR",52,0)
 D HEADER S A=0 F  S A=$O(^YS(615.2,"AC",A)) Q:'A  S A1=0 F  S A1=$O(^YS(615.2,"AC",A,A1)) Q:'A1  D PNAMES
"RTN","YSSR",53,0)
 I $D(YS02) W !!," * Written order required.",!
"RTN","YSSR",54,0)
 I $D(YS04) W:'$D(YS02) !! W " # Record incomplete, please contact IRM.",!
"RTN","YSSR",55,0)
 I '$D(C1) W !?5," ** ",MSG1," ** " K C1 I $D(OPT) S YSQT=1
"RTN","YSSR",56,0)
 S %DT="T",X="N" D ^%DT
"RTN","YSSR",57,0)
 K YS02,YS04
"RTN","YSSR",58,0)
 Q
"RTN","YSSR",59,0)
PNAMES ; Called by routine YSSR1
"RTN","YSSR",60,0)
 K YS01,YS03 S DFN=A D DEM^VADPT,PID^VADPT S B=VADM(1),SSN=VA("BID") S C1=+1
"RTN","YSSR",61,0)
 S Y=$P($G(^YS(615.2,A1,0)),"^",3) D DD^%DT
"RTN","YSSR",62,0)
 D TTIME
"RTN","YSSR",63,0)
 S JRBY=$P($G(^YS(615.2,A1,25)),"^")
"RTN","YSSR",64,0)
 S JRBYN="" I JRBY S JRBYN=$P(^VA(200,JRBY,0),"^",1)
"RTN","YSSR",65,0)
 S Y=$P($G(^YS(615.2,A1,0)),"^",3) D DD^%DT
"RTN","YSSR",66,0)
 I $D(^YS(615.2,"AF",A)) S (YS01,YS02)="*"
"RTN","YSSR",67,0)
 I '$O(^YS(615.2,A1,5,0))!('$O(^YS(615.2,A1,6,0)))!($G(^YS(615.2,A1,7))']"")!('$O(^(10,0)))!('+$G(^YS(615.2,A1,25))) S (YS03,YS04)="#"
"RTN","YSSR",68,0)
 W !?0,$E(B,1,20),?22,SSN W:$D(YS01) ?28,YS01 I $D(YS03) W ?29,YS03
"RTN","YSSR",69,0)
 W ?31,Y,?52,$E(JRBYN,1,18) I $D(JRTT) W ?71,JRTT
"RTN","YSSR",70,0)
 K JRTT
"RTN","YSSR",71,0)
 K VADM,VA,DFN
"RTN","YSSR",72,0)
 Q
"RTN","YSSR",73,0)
DXLKUP ; Checks ^YSD(627.8 DIAGNOSTIC RESULTS for most recent diagnosis.
"RTN","YSSR",74,0)
 S YSDX="UNKNOWN" I '$D(^YSD(627.8,"AF",YSDFN)) Q
"RTN","YSSR",75,0)
 S K=0,K=$O(^YSD(627.8,"AF",YSDFN,K)),L="",L=$O(^YSD(627.8,"AF",YSDFN,K,L)) S M1=$P(L,";"),M2=$P(L,";",2) K K,L
"RTN","YSSR",76,0)
 I M2["ICD" S N1="^"_M2_M1_","_0_")",YSDX=$P(@N1,"^",1)_" "_$E($P(@N1,"^",3),1,60) Q
"RTN","YSSR",77,0)
 I M2["DIC" S N1="^"_M2_M1_","_0_")",N2=$P(@N1,"^",2),N3="^"_M2_M1_","_3_")",N4=$P(@N3,"^",1),YSDX=N2_" "_$E(N4,1,60)
"RTN","YSSR",78,0)
 K M1,M2,N1,N2,N3,N4
"RTN","YSSR",79,0)
 Q
"RTN","YSSR",80,0)
HEADER ; Write header
"RTN","YSSR",81,0)
 W !?31,"DATE & TIME",?72,"TOTAL",!
"RTN","YSSR",82,0)
 W ?0,"PATIENT",?23,"SSN",?31,"INITIATED",?52,"ORDERED BY",?72,"TIME",!
"RTN","YSSR",83,0)
 F I=1:1:IOM W "="
"RTN","YSSR",84,0)
 W !
"RTN","YSSR",85,0)
 Q
"RTN","YSSR",86,0)
TTIME ;calculate total time
"RTN","YSSR",87,0)
 I $D(^YS(615.2,A1,0)),$P(^(0),"^",3)'="" S R1=$P(^YS(615.2,A1,0),"^",3)
"RTN","YSSR",88,0)
 I $D(^(40)),$P(^(40),"^",3)'="" S R2=$P(^YS(615.2,A1,40),"^",3)
"RTN","YSSR",89,0)
 I '$D(^(40)) D NOW^%DTC W ! S R2=%
"RTN","YSSR",90,0)
 I $D(R1),$D(R2) S Y=R2 D DD^%DT S JROSR=$P(Y,"@",2),Y=R1 D DD^%DT S JRISR=$P(Y,"@",2)
"RTN","YSSR",91,0)
 I $D(R1),$D(R2) S JRVAR=$O(^DD("FUNC","B","MINUTES",0)),X=R1,X1=R2 X ^DD("FUNC",JRVAR,1) S R3=X,JRH=X\60,R4=JRH*60,JRMIN=R3-R4 S JRH=$S($L(JRH)=1:"  "_JRH,$L(JRH)=2:" "_JRH,1:JRH) S JRH=" "_JRH,JRTT=JRH_":"_JRMIN
"RTN","YSSR",92,0)
 K R1,R2,R3,R4,JROSR,JRISR,JRH,JRMIN,Y,X,%
"RTN","YSSR",93,0)
 Q
"RTN","YSSR1")
0^2^B19626927^B19043313
"RTN","YSSR1",1,0)
YSSR1 ;SLC/AFE-SECLUSION/RESTRAINT - Observation,Release & Review ; 1/27/04 11:17am
"RTN","YSSR1",2,0)
 ;;5.01;MENTAL HEALTH;**82**;Dec 30, 1994;Build 3
"RTN","YSSR1",3,0)
ENRLS ; Called from MENU option YSSR RELEASE
"RTN","YSSR1",4,0)
 ;
"RTN","YSSR1",5,0)
 ; Release of patient from S/R episode.
"RTN","YSSR1",6,0)
 W @IOF,!?IOM-$L("RELEASE FROM SECLUSION/RESTRAINT")\2,"RELEASE FROM SECLUSION/RESTRAINT",! S OPT=1,MSG1="No patients listed as requiring release."
"RTN","YSSR1",7,0)
 D LKUP^YSSR I '$D(A1) D END^YSSR Q 
"RTN","YSSR1",8,0)
 D ^YSLRP I YSDFN'>0 D END^YSSR Q
"RTN","YSSR1",9,0)
 S DIC="^YS(615.2,",DIC(0)="X",D="AC",X=YSDFN D IX^DIC S B=+Y I B<1 W $C(7),!!,"Patient not listed as in Seclusion/Restraint." D END^YSSR Q
"RTN","YSSR1",10,0)
 I $D(^YS(615.2,B,40)) S Y=+$P($G(^(40)),U,3) D DD^%DT W !!,$C(7),YSN," shown as released ",Y D END^YSSR Q
"RTN","YSSR1",11,0)
 W ! S DIE="^YS(615.2,",DA=B,DR="40:41;42//NOW" K Y L +^YS(615.2,DA) D ^DIE L -^YS(615.2,DA) S YSTOUT=$D(DTOUT),YSUOUT=$O(Y(""))]""
"RTN","YSSR1",12,0)
 I YSTOUT!YSUOUT K ^YS(615.2,B,40) W !!?10,"< RELEASE DELETED >" D END^YSSR Q
"RTN","YSSR1",13,0)
 S DR="43///^S X=""`""_DUZ;44///NOW;45" L +^YS(615.2,DA) D ^DIE L -^YS(615.2,DA) W !!?10,"PATIENT NOTED AS RELEASED."
"RTN","YSSR1",14,0)
 D END^YSSR
"RTN","YSSR1",15,0)
 Q
"RTN","YSSR1",16,0)
ENREV ; Called from MENU option YSSR REVIEW
"RTN","YSSR1",17,0)
 ; Review of S/R action.
"RTN","YSSR1",18,0)
 W @IOF,!?IOM-$L("REVIEW OF SECLUSION/RESTRAINT ASSESSMENT")\2,"REVIEW OF SECLUSION/RESTRAINT ASSESSMENT",!
"RTN","YSSR1",19,0)
REV ;
"RTN","YSSR1",20,0)
 I '$O(^YS(615.2,"AD",0)) W !!,"No review action required." D END^YSSR Q
"RTN","YSSR1",21,0)
 S RVN=0,QRVN=1 W !,"The following S/R actions have not been reviewed: ",! S B=0 F  S B=$O(^YS(615.2,"AD",B)) Q:'B  S B1=0 F  S B1=$O(^YS(615.2,"AD",B,B1)) Q:'B1  S RVN=RVN+1,RVP(RVN)=B1 D REVLST
"RTN","YSSR1",22,0)
ASK ;
"RTN","YSSR1",23,0)
 W !!,"Select action for review: ",QRVN,"// " R A1:DTIME S YSTOUT='$T,YSUOUT=A1["^" Q:YSTOUT!YSUOUT  S:A1="" A1=QRVN I A1'?.N S A1=0
"RTN","YSSR1",24,0)
 I A1<1!(A1>RVN) W !!,$C(7),"Not valid - re-enter." K A1 G ASK
"RTN","YSSR1",25,0)
 W @IOF S (DA,FN)=RVP(A1),DIC="^YS(615.2," D EN^DIQ W !,"**********"
"RTN","YSSR1",26,0)
 S DIE="^YS(615.2,",DA=FN,DR="50;51//A;52//NOW" L +^YS(615.2,DA) D ^DIE L -^YS(615.2,DA) S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT)
"RTN","YSSR1",27,0)
 I YSTOUT!YSUOUT!($O(Y(""))]"") K ^YS(615.2,FN,50),DA,DIE,DR W !!?10,"< REVIEW ACTION DELETED >" D END^YSSR Q
"RTN","YSSR1",28,0)
 S DR="53///^S X=""`""_DUZ;54///NOW;55" L +^YS(615.2,DA) D ^DIE W !!?10,"REVIEW ACTION NOTED." L -^YS(615.2,DA) K DA,DIE,DR
"RTN","YSSR1",29,0)
 I '$D(^YS(615.2,"AD")) W !,"No other review action required." D END^YSSR Q
"RTN","YSSR1",30,0)
 G REV
"RTN","YSSR1",31,0)
 ;
"RTN","YSSR1",32,0)
REVLST ;
"RTN","YSSR1",33,0)
 S RVNM=$P(^DPT(B,0),U),Y=$P(^YS(615.2,B1,0),U,3) D DD^%DT W !?3,RVN,?8,$P(RVNM,",",2)_" "_$P(RVNM,",",1),?40,Y
"RTN","YSSR1",34,0)
 Q
"RTN","YSSR1",35,0)
 ;
"RTN","YSSR1",36,0)
ENCK ; Called from MENU option YSSR 15-CHECK
"RTN","YSSR1",37,0)
 ; Observation of patient in S/R.
"RTN","YSSR1",38,0)
 S YSB=0 D LKUP^YSSR G:'$D(A1) END^YSSR
"RTN","YSSR1",39,0)
 D ^YSLRP I YSDFN'>0 D END^YSSR Q
"RTN","YSSR1",40,0)
 S YSB=$O(^YS(615.2,"AC",YSDFN,YSB)) Q:'YSB  I '$D(^YS(615.2,YSB,60)) S ^YS(615.2,YSB,60,0)="^615.3DA^^"
"RTN","YSSR1",41,0)
 S DIC="^YS(615.2,YSB,60,",DIC(0)="AMELQ",DLAYGO=615,DIC("B")="NOW",DA(1)=YSB D ^DIC K DIC("B") I Y<1 D END^YSSR Q
"RTN","YSSR1",42,0)
 S DIE=DIC,DA=+Y,DR="1;4" L +^YS(615.2,YSB) D ^DIE L -^YS(615.2,YSB) S YSTOUT=$D(DTOUT),YSUOUT=$D(DUOUT)
"RTN","YSSR1",43,0)
 I YSTOUT!YSUOUT!('$P($G(^YS(615.2,DA(1),60,DA,0)),U,2))!('$O(^YS(615.2,DA(1),60,DA,60,0))) S DIK=DIE D ^DIK W !!?10,"< OBSERVATION DELETED >" D END^YSSR Q
"RTN","YSSR1",44,0)
 S DR="2///^S X=""`""_DUZ;3///NOW" L +^YS(615.2,YSB) D ^DIE W !!?15,"OBSERVATION NOTED." L -^YS(615.2,YSB)
"RTN","YSSR1",45,0)
 D END^YSSR
"RTN","YSSR1",46,0)
 Q
"RTN","YSSR1",47,0)
ENWO ; Called from MENU option YSSR W-ORDER
"RTN","YSSR1",48,0)
 ; Entry/edit of Type of S/R Order
"RTN","YSSR1",49,0)
 W @IOF,!?IOM-$L("EDIT OF TYPE OF SECLUSION/RESTRAINT ORDER")\2,"EDIT OF TYPE OF SECLUSION/RESTRAINT ORDER",!
"RTN","YSSR1",50,0)
 W !,"SECLUSION/RESTRAINT EPISODES REQUIRING WRITTEN ORDERS:  ",!
"RTN","YSSR1",51,0)
 D HEADER^YSSR S A=0 F  S A=$O(^YS(615.2,"AF",A)) Q:'A  S A1=0 F  S A1=$O(^YS(615.2,"AF",A,A1)) Q:'A1  D PNAMES^YSSR S YSWN=1,YSA1=A1
"RTN","YSSR1",52,0)
 I '$D(YSWN) W !!,"No patients listed as requiring a written order.",! D END^YSSR Q
"RTN","YSSR1",53,0)
 I $D(YS02) W !!," * Written Order Required.",!
"RTN","YSSR1",54,0)
 I $D(YS04) W:'$D(YS02) !! W " # Record incomplete, please contact IRM.",!
"RTN","YSSR1",55,0)
 K YS02,YS04
"RTN","YSSR1",56,0)
 D ^YSLRP I YSDFN'>0 D END^YSSR Q
"RTN","YSSR1",57,0)
WOLKUP ;
"RTN","YSSR1",58,0)
 S YSA1=$O(^YS(615.2,"AF",YSDFN,0)) I 'YSA1 W !!,"Written order not required for this patient.",! D END^YSSR Q
"RTN","YSSR1",59,0)
 S DIE="^YS(615.2,",DA=YSA1,DR="25:27;28///NOW" L +^YS(615.2,YSA1) D ^DIE L -^YS(615.2,YSA1)
"RTN","YSSR1",60,0)
 I $P(^YS(615.2,YSA1,25),U,2)="w" K ^YS(615.2,"AF",YSDFN,YSA1)
"RTN","YSSR1",61,0)
 D END^YSSR Q
"VER")
8.0^22.0
"BLD",7088,6)
^76
**END**
**END**
