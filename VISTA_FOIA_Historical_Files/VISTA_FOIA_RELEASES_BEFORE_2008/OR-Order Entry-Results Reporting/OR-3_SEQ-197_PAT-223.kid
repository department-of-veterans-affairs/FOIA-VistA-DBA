Released OR*3*223 SEQ #197
Extracted from mail message
**KIDS**:OR*3.0*223^

**INSTALL NAME**
OR*3.0*223
"BLD",5356,0)
OR*3.0*223^ORDER ENTRY/RESULTS REPORTING^0^3040826^y
"BLD",5356,1,0)
^^1^1^3021029^^^^
"BLD",5356,1,1,0)
Refer to the patch description on the patch message.
"BLD",5356,4,0)
^9.64PA^^0
"BLD",5356,"ABNS",0)
^9.66A^^
"BLD",5356,"ABPKG")
n^y^G.LABTEST@ISC-SLC.VA.GOV
"BLD",5356,"INI")

"BLD",5356,"INIT")

"BLD",5356,"KRN",0)
^9.67PA^8989.52^20
"BLD",5356,"KRN",.4,0)
.4
"BLD",5356,"KRN",.401,0)
.401
"BLD",5356,"KRN",.402,0)
.402
"BLD",5356,"KRN",.403,0)
.403
"BLD",5356,"KRN",.5,0)
.5
"BLD",5356,"KRN",.84,0)
.84
"BLD",5356,"KRN",3.6,0)
3.6
"BLD",5356,"KRN",3.8,0)
3.8
"BLD",5356,"KRN",9.2,0)
9.2
"BLD",5356,"KRN",9.8,0)
9.8
"BLD",5356,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5356,"KRN",9.8,"NM",1,0)
ORCSAVE1^^0^B29494346
"BLD",5356,"KRN",9.8,"NM","B","ORCSAVE1",1)

"BLD",5356,"KRN",19,0)
19
"BLD",5356,"KRN",19,"NM",0)
^9.68A^^
"BLD",5356,"KRN",19.1,0)
19.1
"BLD",5356,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5356,"KRN",101,0)
101
"BLD",5356,"KRN",101,"NM",0)
^9.68A^^0
"BLD",5356,"KRN",409.61,0)
409.61
"BLD",5356,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",5356,"KRN",771,0)
771
"BLD",5356,"KRN",869.2,0)
869.2
"BLD",5356,"KRN",870,0)
870
"BLD",5356,"KRN",8989.51,0)
8989.51
"BLD",5356,"KRN",8989.52,0)
8989.52
"BLD",5356,"KRN",8994,0)
8994
"BLD",5356,"KRN","B",.4,.4)

"BLD",5356,"KRN","B",.401,.401)

"BLD",5356,"KRN","B",.402,.402)

"BLD",5356,"KRN","B",.403,.403)

"BLD",5356,"KRN","B",.5,.5)

"BLD",5356,"KRN","B",.84,.84)

"BLD",5356,"KRN","B",3.6,3.6)

"BLD",5356,"KRN","B",3.8,3.8)

"BLD",5356,"KRN","B",9.2,9.2)

"BLD",5356,"KRN","B",9.8,9.8)

"BLD",5356,"KRN","B",19,19)

"BLD",5356,"KRN","B",19.1,19.1)

"BLD",5356,"KRN","B",101,101)

"BLD",5356,"KRN","B",409.61,409.61)

"BLD",5356,"KRN","B",771,771)

"BLD",5356,"KRN","B",869.2,869.2)

"BLD",5356,"KRN","B",870,870)

"BLD",5356,"KRN","B",8989.51,8989.51)

"BLD",5356,"KRN","B",8989.52,8989.52)

"BLD",5356,"KRN","B",8994,8994)

"BLD",5356,"QUES",0)
^9.62^^
"BLD",5356,"REQB",0)
^9.611^1^1
"BLD",5356,"REQB",1,0)
OR*3.0*187^2
"BLD",5356,"REQB","B","OR*3.0*187",1)

"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
223^3040826
"PKG",110,22,1,"PAH",1,1,0)
^^1^1^3040826
"PKG",110,22,1,"PAH",1,1,1,0)
Refer to the patch description on the patch message.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORCSAVE1")
0^1^B29494346
"RTN","ORCSAVE1",1,0)
ORCSAVE1 ; SLC/MKB - Save Order Text ;7/13/04  15:41
"RTN","ORCSAVE1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**92,132,141,163,187,223**;Dec 17, 1997
"RTN","ORCSAVE1",3,0)
 ;
"RTN","ORCSAVE1",4,0)
 ; ^ORD(101.41,+ORDIALOG,10,ITM,2)=Seq#^Format^Omit^Lead Text^Trail Text
"RTN","ORCSAVE1",5,0)
 ; ^ORD(101.41,+ORDIALOG,10,"ATXT",Seq#,ITM)=""
"RTN","ORCSAVE1",6,0)
 ;
"RTN","ORCSAVE1",7,0)
ORDTEXT(ORDER) ; -- Build and save order text from ORDIALOG() into ORDER
"RTN","ORCSAVE1",8,0)
 N ORTX,I,IFN,ACT,ORSET
"RTN","ORCSAVE1",9,0)
 D ORTX(240) Q:'$G(ORTX)
"RTN","ORCSAVE1",10,0)
 S IFN=+ORDER,ACT=+$P(ORDER,";",2) S:ACT'>0 ACT=1
"RTN","ORCSAVE1",11,0)
 F I=1:1:ORTX S ^OR(100,IFN,8,ACT,.1,I,0)=ORTX(I)
"RTN","ORCSAVE1",12,0)
 S ^OR(100,IFN,8,ACT,.1,0)=U_U_ORTX_U_ORTX_U_DT_U
"RTN","ORCSAVE1",13,0)
 I $E($G(ORDEA))=2 D  ;PKI Drug Schedule - in future may allow 2-5
"RTN","ORCSAVE1",14,0)
 . S ORSET=0
"RTN","ORCSAVE1",15,0)
 . D DIGTEXT(IFN,ORDEA)
"RTN","ORCSAVE1",16,0)
 . F I=1:1:ORSET S ^OR(100,IFN,8,ACT,.2,I,0)=ORSET(I)
"RTN","ORCSAVE1",17,0)
 . I ORSET>0 S ^OR(100,IFN,8,ACT,.2,0)=U_U_ORSET_U_ORSET_U_DT_U
"RTN","ORCSAVE1",18,0)
 Q
"RTN","ORCSAVE1",19,0)
 ;
"RTN","ORCSAVE1",20,0)
ORTX(WIDTH) ; -- May enter here to return order text in ORTX()
"RTN","ORCSAVE1",21,0)
 N ORP,SEQ,ITEM,ORMAX
"RTN","ORCSAVE1",22,0)
 K ORTX S ORMAX=$S(+$G(WIDTH):WIDTH,1:240)
"RTN","ORCSAVE1",23,0)
 D EXT ; get external form of values
"RTN","ORCSAVE1",24,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"ATXT",SEQ)) Q:SEQ'>0  S ITEM=$O(^(SEQ,0)) D TEXT(ITEM)
"RTN","ORCSAVE1",25,0)
 Q
"RTN","ORCSAVE1",26,0)
 ;
"RTN","ORCSAVE1",27,0)
TEXT(DA) ; -- Includes text of item DA
"RTN","ORCSAVE1",28,0)
 Q:$P(^ORD(101.41,ORDIALOG,10,DA,0),U,11)  Q:'$O(ORP(DA,0))
"RTN","ORCSAVE1",29,0)
 N NEWLN,INST,TYPE,PTR,CHSEQ,CHILD,ORI,X,Y
"RTN","ORCSAVE1",30,0)
 S:'$G(ORTX) ORTX=1,ORTX(1)=""
"RTN","ORCSAVE1",31,0)
 S NEWLN=+$P(ORP(DA),U,4),INST=$O(ORP(DA,0)),Y=""
"RTN","ORCSAVE1",32,0)
 I NEWLN,$L(ORTX(ORTX)) S ORTX=ORTX+1,ORTX(ORTX)="",Y=" "
"RTN","ORCSAVE1",33,0)
 S X=$$GETXT($P(ORP(DA),U,2)) I $L(X) S X=Y_X,Y="" D TXT^ORCHTAB ;lead tx
"RTN","ORCSAVE1",34,0)
 S PTR=+ORP(DA),TYPE=$E(ORDIALOG(PTR,0))
"RTN","ORCSAVE1",35,0)
TXT1 I TYPE'="W" S X=Y_ORP(DA,INST),Y="" D TXT^ORCHTAB
"RTN","ORCSAVE1",36,0)
 I TYPE="W" S ORI=0 F  S ORI=$O(ORP(DA,INST,ORI)) Q:ORI'>0  D  S Y=""
"RTN","ORCSAVE1",37,0)
 . S Y=$S(Y=" ":" ",$P(ORP(DA),U,5):" ",1:"") ;new line, or as stored
"RTN","ORCSAVE1",38,0)
 . S X=Y_ORP(DA,INST,ORI,0),Y=""
"RTN","ORCSAVE1",39,0)
 . I $E(X)'=" " D TXT^ORCHTAB Q  ; wrap
"RTN","ORCSAVE1",40,0)
 . S:$L(ORTX(ORTX)) ORTX=ORTX+1,ORTX(ORTX)="" ; force new line
"RTN","ORCSAVE1",41,0)
 . I X?1." " S ORTX(ORTX)=" ",ORTX=ORTX+1,ORTX(ORTX)="" ; blank line
"RTN","ORCSAVE1",42,0)
 . E  D TXT^ORCHTAB
"RTN","ORCSAVE1",43,0)
 D:$D(^ORD(101.41,+ORDIALOG,10,"DAD",PTR)) CHILD(PTR)
"RTN","ORCSAVE1",44,0)
 S INST=$O(ORP(DA,INST)) ; multiple?
"RTN","ORCSAVE1",45,0)
 I INST S ORTX(ORTX)=ORTX(ORTX)_",",Y="" S:NEWLN ORTX=ORTX+1,ORTX(ORTX)="",Y=" " G TXT1
"RTN","ORCSAVE1",46,0)
 S X=$$GETXT($P(ORP(DA),U,3)) D:$L(X) TXT^ORCHTAB ; trailing text
"RTN","ORCSAVE1",47,0)
 Q
"RTN","ORCSAVE1",48,0)
 ;
"RTN","ORCSAVE1",49,0)
CHILD(PARENT) ; -- add child values
"RTN","ORCSAVE1",50,0)
 N CHSEQ,CHILD S CHSEQ=0
"RTN","ORCSAVE1",51,0)
 F  S CHSEQ=$O(^ORD(101.41,+ORDIALOG,10,"DAD",PARENT,CHSEQ)) Q:CHSEQ'>0  S CHILD=$O(^(CHSEQ,0)) D
"RTN","ORCSAVE1",52,0)
 . Q:'$L($G(ORP(CHILD,INST)))
"RTN","ORCSAVE1",53,0)
 . S X=$$GETXT($P(ORP(CHILD),U,2)) D:$L(X) TXT^ORCHTAB ; lead text
"RTN","ORCSAVE1",54,0)
 . S X=ORP(CHILD,INST) D TXT^ORCHTAB
"RTN","ORCSAVE1",55,0)
 . S X=$$GETXT($P(ORP(CHILD),U,3)) D:$L(X) TXT^ORCHTAB ; trail text
"RTN","ORCSAVE1",56,0)
 Q
"RTN","ORCSAVE1",57,0)
 ;
"RTN","ORCSAVE1",58,0)
GETXT(X) ; -- Returns text of X
"RTN","ORCSAVE1",59,0)
 I $E(X)="@" N VAR S VAR=$E(X,2,99),X=$G(@VAR) K @VAR ; variable w/text
"RTN","ORCSAVE1",60,0)
 Q X
"RTN","ORCSAVE1",61,0)
 ;
"RTN","ORCSAVE1",62,0)
EXT ; -- Build ORP(DA) array of external forms
"RTN","ORCSAVE1",63,0)
 N PROMPT,INST,DA,NODE,FORMAT,OMIT,X,Y,TYPE,PTR
"RTN","ORCSAVE1",64,0)
 S PROMPT=0 F  S PROMPT=$O(ORDIALOG(PROMPT)) Q:PROMPT'>0  D
"RTN","ORCSAVE1",65,0)
 . S DA=+$G(ORDIALOG(PROMPT)),TYPE=$E($G(ORDIALOG(PROMPT,0))) Q:'$L(TYPE)
"RTN","ORCSAVE1",66,0)
 . Q:'DA  S NODE=$G(^ORD(101.41,ORDIALOG,10,DA,2)),FORMAT=$P(NODE,U,2),OMIT=$P(NODE,U,3)
"RTN","ORCSAVE1",67,0)
 . S:$D(ORDIALOG(PROMPT,"FORMAT")) FORMAT=ORDIALOG(PROMPT,"FORMAT")
"RTN","ORCSAVE1",68,0)
 . I $E(FORMAT)="@" S PTR=+$E(FORMAT,2,99) Q:'PTR  ; Don't include
"RTN","ORCSAVE1",69,0)
 . S INST=0 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  D
"RTN","ORCSAVE1",70,0)
 . . Q:ORDIALOG(PROMPT,INST)=""
"RTN","ORCSAVE1",71,0)
 . . I $E(FORMAT)="@",$L($G(ORDIALOG(PTR,INST))) Q  ; use PTR instead
"RTN","ORCSAVE1",72,0)
 . . I $E(FORMAT)="*" S PTR=+$E(FORMAT,2,99) I '$L($G(ORDIALOG(PTR,INST))) Q  ; must have PTR too
"RTN","ORCSAVE1",73,0)
 . . I $E(FORMAT)="=" S PTR=+$E(FORMAT,2,99) I PTR,$L($G(ORDIALOG(PTR,INST))) S Y=$$EXT^ORCD(PTR,INST),X=$$EXT^ORCD(PROMPT,INST) I (X=Y)!(X[Y)!(Y[X) Q
"RTN","ORCSAVE1",74,0)
 . . I TYPE="W" M ORP(DA,INST)=@ORDIALOG(PROMPT,INST)
"RTN","ORCSAVE1",75,0)
 . . E  S X=$$EXT^ORCD(PROMPT,INST,FORMAT) Q:X=""  Q:OMIT[X  S ORP(DA,INST)=X
"RTN","ORCSAVE1",76,0)
 . . S ORP(DA)=PROMPT_U_$P(NODE,U,4,7) ; ptr^lead^trail^new line^wrap
"RTN","ORCSAVE1",77,0)
 Q
"RTN","ORCSAVE1",78,0)
DIGTEXT(ORDER,ORDEA,ORSIGNER)  ;Build text used to create Digital Signature
"RTN","ORCSAVE1",79,0)
 ;ORDER = ifn of order # (file 100)
"RTN","ORCSAVE1",80,0)
 ;ORDEA = Controlled substance schedule of drug (2-5)
"RTN","ORCSAVE1",81,0)
 ;ORSIGNER = DUZ of sigining physician
"RTN","ORCSAVE1",82,0)
 ;ORSET(1)=1)Date of Prescription (RX) -Date Ordered HL7 format 2)Full Patient Name 3)Patient SSN 4)DFN
"RTN","ORCSAVE1",83,0)
 ;ORSET(2)=5)Patient Street1 6)Patient Street2 7)Patient Street3 8)Patient City 9)Patient State 10)Patient Zip 11)???
"RTN","ORCSAVE1",84,0)
 ;ORSET(3)=12)Drug name (From Dispense Drug or Orderable Item) 13)Variable ptr for Drug (file 50 or 101.43) 14)Drug quantity prescribed 15)Schedule of medication 16)DEA Schedule
"RTN","ORCSAVE1",85,0)
 ;ORSET(4)=17)Direction for use
"RTN","ORCSAVE1",86,0)
 ;ORSET(5)=18)Practitioner's name 19)DUZ 20)Practitioner's (DEA) registration number
"RTN","ORCSAVE1",87,0)
 ;ORSET(6)=22)SiteName 23)SiteStreet1 24)SiteStreet2 25)SiteCity 26)SiteState 27)SiteZip
"RTN","ORCSAVE1",88,0)
 ;ORSET(7)=28)$H
"RTN","ORCSAVE1",89,0)
 N I,DFN,OR80,ORPNM,ORSSN,ORXDT,VAERR,VAPA,X0,X1,X4,X5,X6,X8,X9,X10,X11,X12,X13,X14,SIG
"RTN","ORCSAVE1",90,0)
 S OR80=$G(^OR(100,ORDER,8,1,0))
"RTN","ORCSAVE1",91,0)
 Q:'$L(OR80)
"RTN","ORCSAVE1",92,0)
 S:'$G(ORSIGNER) ORSIGNER=$P(OR80,"^",3)
"RTN","ORCSAVE1",93,0)
 Q:'ORSIGNER
"RTN","ORCSAVE1",94,0)
 S $P(^OR(100,ORDER,8,1,2),"^",4,5)=ORDEA_"^"_1 ;Flag to signing process to get digital signature
"RTN","ORCSAVE1",95,0)
 S ORXDT=$P(OR80,"^"),X1=$$FMTHL7^XLFDT(ORXDT),X4="",X14="",X10=""
"RTN","ORCSAVE1",96,0)
 I '$D(ORVP) S ORVP=$P(^OR(100,ORDER,0),"^",2)
"RTN","ORCSAVE1",97,0)
 S DFN=+ORVP
"RTN","ORCSAVE1",98,0)
 D ADD^VADPT
"RTN","ORCSAVE1",99,0)
 S ORPNM=^DPT(+ORVP,0),ORSSN=$P(ORPNM,"^",9),ORPNM=$P(ORPNM,"^")
"RTN","ORCSAVE1",100,0)
 F I=1:1:6 S X4=X4_$S($L($G(VAPA(I))):$S((I=5):$P(VAPA(I),"^",2),1:VAPA(I)),1:"")_"^"
"RTN","ORCSAVE1",101,0)
 S X11=$$GET1^DIQ(200,ORSIGNER,.01,"E") Q:'$L(X11)
"RTN","ORCSAVE1",102,0)
 S X12=$$DEA^XUSER(,ORSIGNER)
"RTN","ORCSAVE1",103,0)
 S X0=$$GET1^DIQ(4,+$G(DUZ(2)),.01,"E")
"RTN","ORCSAVE1",104,0)
 I $L(X0) S X14=X0_"^"_$$GET1^DIQ(4,DUZ(2),1.01,"E")_"^"_$$GET1^DIQ(4,DUZ(2),1.02,"E")_"^"_$$GET1^DIQ(4,DUZ(2),1.03,"E")_"^"_$$GET1^DIQ(4,DUZ(2),.02,"E")_"^"_$$GET1^DIQ(4,DUZ(2),1.04,"E")
"RTN","ORCSAVE1",105,0)
 S X5=$$VALUE^ORX8(ORDER,"DRUG",,"E"),X6=$$VALUE^ORX8(ORDER,"DRUG")_";50"
"RTN","ORCSAVE1",106,0)
 I '$L(X5) S X5=$$VALUE^ORX8(ORDER,"ORDERABLE",,"E"),X6=$$VALUE^ORX8(ORDER,"ORDERABLE")_";101.43"
"RTN","ORCSAVE1",107,0)
 S X8=$$VALUE^ORX8(ORDER,"QTY",,"E"),X9=$$VALUE^ORX8(ORDER,"SCHEDULE",,"E")
"RTN","ORCSAVE1",108,0)
 S SIG=+$O(^OR(100,ORDER,4.5,"ID","SIG",0)) I SIG,$L($G(^OR(100,ORDER,4.5,SIG,2,1,0))) S X10=^(0)
"RTN","ORCSAVE1",109,0)
 S ORSET(1)=X1_"^"_ORPNM_"^"_ORSSN_"^"_+ORVP_"^"
"RTN","ORCSAVE1",110,0)
 S ORSET(2)=X4_"^"
"RTN","ORCSAVE1",111,0)
 S ORSET(3)=X5_"^"_X6_"^"_X8_"^"_X9_"^"_ORDEA_"^"
"RTN","ORCSAVE1",112,0)
 S ORSET(4)=X10_"^"
"RTN","ORCSAVE1",113,0)
 S ORSET(5)=X11_"^"_ORSIGNER_"^"_X12_"^"
"RTN","ORCSAVE1",114,0)
 S ORSET(6)=X14
"RTN","ORCSAVE1",115,0)
 S ORSET(7)=$H
"RTN","ORCSAVE1",116,0)
 S ORSET=7
"RTN","ORCSAVE1",117,0)
 Q
"VER")
8.0^22.0
**END**
**END**
