$TXT Created by SMITH,ROBERT at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 05/03/07 at 09:33
=============================================================================
Run Date: MAY 23, 2007                     Designation: PSD*3*59
Package : PSD - CONTROLLED SUBSTANCES         Priority: Mandatory
Version : 3        SEQ #52                      Status: Released
                  Compliance Date: JUN 23, 2007
=============================================================================


Subject: PSDS VARIABLE NOT CLEARED AND PSD ORDERS NOT LOCKED 

Category: 
  - Routine

Description:
============

 This patch will correct two problems.
      
 The first problem is that there are some Controlled Substance (PSD)
 variables lingering after exiting the application which results in the
 wrong selection of the master or satellite vault.
  
 The second problem is that two users are able to process the same
 controlled substance request at the same time.
  
 ASSOCIATED PATCHES:
 ===================
 None
  
 ASSOCIATED NOIS/REMEDY:
 ======================
  
 1) HD0000000101826
    Finished Balance Adjustment Report for San Jose then changed
    the site to MPD but SJ VAULT displayed.
  
 2) HD0000000068483
    ANN-1204-40172  DISPENSING REPORT TOTAL INCORRECT
    Duplicates:
    HD0000000068349
    STX-1004-71233  2 USERS PROCESSING SAME ORDER
   
 ASSOCIATED NSRs:
 ================
 N/A
  
 PARTICIPATING TEST SITES
 ========================
 Ann Arbor, MI
 Amarillo, TX
 S. Texas HCS 
  
  
 NOIS/REMEDY OVERVIEW:
 =====================
  
 1) HD0000000101826
    Finished Balance Adjustment Report for San Jose then changed
    the site to MPD but SJ VAULT displayed.
  
 2) HD0000000068483
    ANN-1204-40172  DISPENSING REPORT TOTAL INCORRECT
  
 Problem:
 --------
 1) The problem occurs when the user enters the Controlled Substances
    Menu [PSD MENU]. When the inpatient site selected has only one master
    vault, the package wide variables PSDS and PSDSN are set.   The user
    exits this menu returning to the previous menu, but PSDS and PSDSN
    are still set to the last value.
  
 2) When using the option Fill/Dispense CS Orders from Worksheet
    [PSD WORKSHEET DISPENSING] more than one user is allowed to process
    a request within the Controlled Substance application.
  
 Resolution:
 -----------
 1) To correct this problem, PSDSET will be modified to include PSDS,
    PSDSN, PSDCHO in the initial kill statement.
  
 2) A check will be added to PSDDWK routine to ensure that no other user
    is currently processing a controlled substance request.  This check
    will apply to both worksheets and individual requests.
  
 Technical:
 ----------
 1) PSDSET routine is called whenever PSDSITE variable is not present.
    To ensure that the correct master or satellite vault is selected,
    the PSDS and PSDN variables will be killed at the beginning of the 
    PSDSET routine.
  
 2) To prevent multiple users from selecting the same controlled
    substance request from Fill/Dispense CS Orders from Worksheet
    option [PSD WORKSHEET DISPENSING] an incremental lock will be
    placed on the order being processed.  The Global ^XTMP("PSDLCK"
    request# will be used to identify who is currently processing the 
    order when the user tries to process it using the request number.
    When the user is finished processing the order the lock is decremented
    and the ^XTMP("PSDLCK" request# global entry is removed.
  
  
 INSTALLATION INSTRUCTIONS
 =========================
 This patch can be installed at any time.  Users do not need to be off
 the system. Installation will take less than 1 minute.
  
  1.  Choose the PackMan message containing this patch and invoke the
      INSTALL/CHECK MESSAGE PackMan option.
  
  2.  Start up the Kernel Installation and Distribution System Menu
      [XPD MAIN]:
  
           Edits and Distribution ...
           Utilities ...
           Installation ...
  
     Select Kernel Installation & Distribution System Option: INStallation
           Load a Distribution
           Print Transport Global
           Compare Transport Global to Current System
           Verify Checksums in Transport Global
           Install Package(s)
           Restart Install of Package(s)
           Unload a Distribution
           Backup a Transport Global
  
  3.  From this menu, you may elect to use the following options
      (when prompted for the INSTALL NAME, enter PSD*3.0*59):
  
      a.  Backup a Transport Global - This option will create a backup
          message of any routines exported with this patch. It will not
          backup any other changes such as DD's or templates.
      b.  Compare Transport Global to Current System - This option will
          allow you to view all changes that will be made when this patch
          is installed.  It compares all components of this patch
          (routines, DD's, templates, etc.).
      c.  Verify Checksums in Transport Global - This option will allow
          you to ensure the integrity of the routines that are in the
          transport global.
  
  4.  Use the Install Package(s) option and select the package PSD*3.0*59.
  
    a.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
        YES//', answer NO.
    b.  When prompted 'Want to DISABLE Scheduled Options, Menu Options,
        and Protocols? YES//', answer NO.
  
  
 ROUTINE SUMMARY:
 ================
 The following is a list of the routine(s) included in this patch.  The
 second line of each of these routine(s) will look like:
  
           ;;3.0; CONTROLLED SUBSTANCES ;**[Patch List]**;13 Feb 97
  
  
                             CHECK^XTSUMBLD results
 Routine name      Before Patch          After Patch         Patch List
 ============      ============          ===========         ==========
 PSDDWK                14582819             15635838             59
 PSDSET                 5861527              5899312             59

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: PSDDWK
    Before: B22797507  After: B25989170  **59**
Routine Name: PSDSET
    Before:  B7164276  After:  B7218792  **59**

=============================================================================
User Information:
Entered By  : SMITH,ROBERT J                Date Entered  : OCT 04, 2005
Completed By: TSAIMEUCHONG,BRENDA           Date Completed: MAY 22, 2007
Released By : VECE,VIRGINIA                 Date Released : MAY 23, 2007
=============================================================================


Packman Mail Message:
=====================

$END TXT
