EMERGENCY Released OR*3*158 SEQ #149
Extracted from mail message
**KIDS**:OR*3.0*158^

**INSTALL NAME**
OR*3.0*158
"BLD",3982,0)
OR*3.0*158^ORDER ENTRY/RESULTS REPORTING^0^3021125^y
"BLD",3982,4,0)
^9.64PA^^
"BLD",3982,"INIT")
POST^ORY158
"BLD",3982,"KRN",0)
^9.67PA^8989.52^19
"BLD",3982,"KRN",.4,0)
.4
"BLD",3982,"KRN",.401,0)
.401
"BLD",3982,"KRN",.402,0)
.402
"BLD",3982,"KRN",.403,0)
.403
"BLD",3982,"KRN",.5,0)
.5
"BLD",3982,"KRN",.84,0)
.84
"BLD",3982,"KRN",3.6,0)
3.6
"BLD",3982,"KRN",3.8,0)
3.8
"BLD",3982,"KRN",9.2,0)
9.2
"BLD",3982,"KRN",9.8,0)
9.8
"BLD",3982,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",3982,"KRN",9.8,"NM",1,0)
ORCDPS3^^0^B35273949
"BLD",3982,"KRN",9.8,"NM",2,0)
ORCSEND1^^0^B69176847
"BLD",3982,"KRN",9.8,"NM",3,0)
ORMPS1^^0^B58206611
"BLD",3982,"KRN",9.8,"NM",4,0)
ORX2^^0^B8983250
"BLD",3982,"KRN",9.8,"NM",5,0)
ORCDPSIV^^0^B14037687
"BLD",3982,"KRN",9.8,"NM",6,0)
ORWDXM2^^0^B60322989
"BLD",3982,"KRN",9.8,"NM",7,0)
ORY158^^0^B19822316
"BLD",3982,"KRN",9.8,"NM","B","ORCDPS3",1)

"BLD",3982,"KRN",9.8,"NM","B","ORCDPSIV",5)

"BLD",3982,"KRN",9.8,"NM","B","ORCSEND1",2)

"BLD",3982,"KRN",9.8,"NM","B","ORMPS1",3)

"BLD",3982,"KRN",9.8,"NM","B","ORWDXM2",6)

"BLD",3982,"KRN",9.8,"NM","B","ORX2",4)

"BLD",3982,"KRN",9.8,"NM","B","ORY158",7)

"BLD",3982,"KRN",19,0)
19
"BLD",3982,"KRN",19.1,0)
19.1
"BLD",3982,"KRN",101,0)
101
"BLD",3982,"KRN",409.61,0)
409.61
"BLD",3982,"KRN",771,0)
771
"BLD",3982,"KRN",870,0)
870
"BLD",3982,"KRN",8989.51,0)
8989.51
"BLD",3982,"KRN",8989.52,0)
8989.52
"BLD",3982,"KRN",8994,0)
8994
"BLD",3982,"KRN","B",.4,.4)

"BLD",3982,"KRN","B",.401,.401)

"BLD",3982,"KRN","B",.402,.402)

"BLD",3982,"KRN","B",.403,.403)

"BLD",3982,"KRN","B",.5,.5)

"BLD",3982,"KRN","B",.84,.84)

"BLD",3982,"KRN","B",3.6,3.6)

"BLD",3982,"KRN","B",3.8,3.8)

"BLD",3982,"KRN","B",9.2,9.2)

"BLD",3982,"KRN","B",9.8,9.8)

"BLD",3982,"KRN","B",19,19)

"BLD",3982,"KRN","B",19.1,19.1)

"BLD",3982,"KRN","B",101,101)

"BLD",3982,"KRN","B",409.61,409.61)

"BLD",3982,"KRN","B",771,771)

"BLD",3982,"KRN","B",870,870)

"BLD",3982,"KRN","B",8989.51,8989.51)

"BLD",3982,"KRN","B",8989.52,8989.52)

"BLD",3982,"KRN","B",8994,8994)

"BLD",3982,"QUES",0)
^9.62^^
"BLD",3982,"REQB",0)
^9.611^5^4
"BLD",3982,"REQB",2,0)
OR*3.0*152^2
"BLD",3982,"REQB",3,0)
OR*3.0*132^2
"BLD",3982,"REQB",4,0)
OR*3.0*134^2
"BLD",3982,"REQB",5,0)
OR*3.0*138^2
"BLD",3982,"REQB","B","OR*3.0*132",3)

"BLD",3982,"REQB","B","OR*3.0*134",4)

"BLD",3982,"REQB","B","OR*3.0*138",5)

"BLD",3982,"REQB","B","OR*3.0*152",2)

"INIT")
POST^ORY158
"MBREQ")
0
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
158^3021125
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","ORCDPS3")
0^1^B35273949
"RTN","ORCDPS3",1,0)
ORCDPS3 ;SLC/MKB-Pharmacy dialog utilities ;11/25/02  09:47
"RTN","ORCDPS3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**94,116,134,158**;Dec 17, 1997
"RTN","ORCDPS3",3,0)
 ;
"RTN","ORCDPS3",4,0)
START ; -- Start Date entry action
"RTN","ORCDPS3",5,0)
 S $P(ORDIALOG(PROMPT,0),":",3)=$S($G(ORCAT)="I":"ETRX",1:"EX")
"RTN","ORCDPS3",6,0)
 I $G(ORCAT)'="I" K ORSD K:$G(ORENEW)!$G(OREWRITE)!$D(OREDIT) ORDIALOG(PROMPT,INST) ;Inpt only
"RTN","ORCDPS3",7,0)
 Q
"RTN","ORCDPS3",8,0)
 ;
"RTN","ORCDPS3",9,0)
ADMIN ; -- Return default admin time for order in ORSD
"RTN","ORCDPS3",10,0)
 ;    Called from EXDOSE^ORCDPS2
"RTN","ORCDPS3",11,0)
 Q:$D(ORSD)  Q:$G(ORCAT)'="I"  ;inpt only
"RTN","ORCDPS3",12,0)
 N PSOI,PSIFN,SCH,CNJ,ORI,ORX
"RTN","ORCDPS3",13,0)
 S PSOI=+$P($G(^ORD(101.43,+$G(OROI),0)),U,2)
"RTN","ORCDPS3",14,0)
 S PSIFN=$S($G(ORENEW):$G(^OR(100,+$G(ORIFN),4)),1:"")
"RTN","ORCDPS3",15,0)
 S SCH=$$PTR^ORCD("OR GTX SCHEDULE"),CNJ=$$PTR^ORCD("OR GTX AND/THEN"),ORX=""
"RTN","ORCDPS3",16,0)
 S ORI=0 F  S ORI=$O(ORDIALOG(PROMPT,ORI)) Q:ORI<1  S ORX=ORX_$S($L(ORX):U,1:"")_$G(ORDIALOG(CNJ,ORI))_";"_$G(ORDIALOG(SCH,ORI))
"RTN","ORCDPS3",17,0)
 S ORSD=$$FIRST(+ORVP,+$G(ORWARD),PSOI,ORX,PSIFN)
"RTN","ORCDPS3",18,0)
 S:$P(ORSD,U)="NEXT" ORSD="NEXTA^"_$P(ORSD,U,2,99)
"RTN","ORCDPS3",19,0)
 Q
"RTN","ORCDPS3",20,0)
 ;
"RTN","ORCDPS3",21,0)
FIRST(DFN,WARD,OI,DATA,ORDER)   ; -- Return expected first admin time of order
"RTN","ORCDPS3",22,0)
 N ORCNT,ORI,J,ORZ,Y,SCH,ORX I '$G(DFN)!'$G(OI) Q ""
"RTN","ORCDPS3",23,0)
 S ORCNT=0 F ORI=1:1:$L(DATA,"^") S ORZ=$P(DATA,U,ORI) D  Q:$E(ORZ)="T"
"RTN","ORCDPS3",24,0)
 . S SCH=$P(ORZ,";",2) Q:'$L(SCH)  S ORCNT=ORCNT+1
"RTN","ORCDPS3",25,0)
 . S ORX(ORCNT)=$$STARTSTP^PSJORPOE(DFN,SCH,OI,WARD,$G(ORDER))
"RTN","ORCDPS3",26,0)
 S Y=9999999,J=0
"RTN","ORCDPS3",27,0)
 F ORI=1:1:ORCNT S ORZ=$P(ORX(ORI),U,4) I ORZ<Y S Y=ORZ,J=ORI ;earliest
"RTN","ORCDPS3",28,0)
 S Y=$S(J:ORX(J),1:"")
"RTN","ORCDPS3",29,0)
 Q Y
"RTN","ORCDPS3",30,0)
 ;
"RTN","ORCDPS3",31,0)
NOW ; -- First dose now?
"RTN","ORCDPS3",32,0)
 N X,Y,DIR,SCH
"RTN","ORCDPS3",33,0)
 I $G(ORCAT)="O"!'$D(ORSD)!$L($G(OREVENT))!$G(ORENEW) K ORDIALOG(PROMPT,INST) Q
"RTN","ORCDPS3",34,0)
 ; ask on Copy? Change?
"RTN","ORCDPS3",35,0)
 S X=$$PTR^ORCD("OR GTX SCHEDULE"),Y=+$O(ORDIALOG(X,0))
"RTN","ORCDPS3",36,0)
 S SCH=$G(ORDIALOG(X,Y)),Y=+$O(^PS(51.1,"APPSJ",SCH,0)) ;1st one
"RTN","ORCDPS3",37,0)
 I $P($G(^PS(51.1,Y,0)),U,5)="O" K ORDIALOG(PROMPT,INST) Q
"RTN","ORCDPS3",38,0)
 ; other conditions?
"RTN","ORCDPS3",39,0)
 S DIR(0)="YA",DIR("A")="Give First Dose NOW? "
"RTN","ORCDPS3",40,0)
 S DIR("B")=$S($G(ORDIALOG(PROMPT,INST)):"YES",1:"NO")
"RTN","ORCDPS3",41,0)
 I ORINPT,$P(ORSD,U,4) S DIR("A",1)="Next scheduled administration time: "_$$FMTE^XLFDT($P(ORSD,U,4))
"RTN","ORCDPS3",42,0)
 S DIR("?")="Enter YES if you want a dose given now in addition to the regular administration times for this schedule and ward."
"RTN","ORCDPS3",43,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) ORQUIT=1
"RTN","ORCDPS3",44,0)
 I $G(ORQUIT)!(Y'>0) K ORDIALOG(PROMPT,INST) Q
"RTN","ORCDPS3",45,0)
 S ORDIALOG(PROMPT,INST)=1 I $G(ORCOMPLX) D
"RTN","ORCDPS3",46,0)
 . W $C(7),!,"  >> First Dose NOW is in addition to those already entered.    <<"
"RTN","ORCDPS3",47,0)
 . W !,"  >> Please adjust the duration of the first one, if necessary. <<"
"RTN","ORCDPS3",48,0)
 Q
"RTN","ORCDPS3",49,0)
 ;
"RTN","ORCDPS3",50,0)
DEFSTRT ; -- Returns default start date/time in Y
"RTN","ORCDPS3",51,0)
 ;    Expects PROMPT,INST,ORDIALOG,ORSD to be defined
"RTN","ORCDPS3",52,0)
 ;
"RTN","ORCDPS3",53,0)
 Q:$G(ORCAT)="O"  Q:$G(ORTYPE)="Z"  ;skip if outpt or editor
"RTN","ORCDPS3",54,0)
 N LAST,STRT,DUR,D1,D2,OFF,F1,F2,UNT,Y1,Y2,I,J K Y
"RTN","ORCDPS3",55,0)
 S LAST=+$O(ORDIALOG(+$$PTR^ORCD("OR GTX INSTRUCTIONS"),INST),-1)
"RTN","ORCDPS3",56,0)
 S STRT=$G(ORDIALOG(PROMPT,LAST))
"RTN","ORCDPS3",57,0)
 I LAST'>0!'$L(STRT) S:$L($P($G(ORSD),U)) Y=$P(ORSD,U) Q  ;first inst
"RTN","ORCDPS3",58,0)
 S DUR=$G(ORDIALOG(+$$PTR^ORCD("OR GTX DURATION"),LAST))
"RTN","ORCDPS3",59,0)
 I +DUR'>0 S Y=STRT Q  ;no duration = same start
"RTN","ORCDPS3",60,0)
 S DUR=$$FMDUR(DUR) I STRT D  Q  ;FM date/time, so just add
"RTN","ORCDPS3",61,0)
 . N X,%DT S %DT="TX",X=STRT_"+"_DUR D ^%DT
"RTN","ORCDPS3",62,0)
 . I Y'>0 S Y=STRT ;error
"RTN","ORCDPS3",63,0)
 S D1=+DUR,D2=$P(DUR,D1,2) S:(STRT="NEXTA")!(STRT="CLOSEST") STRT="NOW"
"RTN","ORCDPS3",64,0)
 S OFF=$P(STRT,"+",2) I '$L(OFF) S Y=STRT_"+"_DUR Q  ;no prev offset
"RTN","ORCDPS3",65,0)
 S F1=+OFF,F2=$P(OFF,F1,2),UNT=F2,Y=STRT
"RTN","ORCDPS3",66,0)
 I D2=F2 S Y=$P(STRT,"+")_"+"_(D1+F1)_UNT Q  ;same units
"RTN","ORCDPS3",67,0)
 F I="S","'","H","D","W","M" I (F2=I)!(D2=I) S UNT=I D  Q
"RTN","ORCDPS3",68,0)
 . S:D2=UNT Y1=D1,X1=F1,X2=F2 ; Y1=# in UNT
"RTN","ORCDPS3",69,0)
 . S:F2=UNT Y1=F1,X1=D1,X2=D2 ; X1=# in other units X2
"RTN","ORCDPS3",70,0)
 . F J=1:1 S Z=$T(CONV+J) Q:Z["ZZZZ"  I $P(Z,";",3,4)=(X2_";"_UNT) S Y2=+$P(Z,";",5) Q
"RTN","ORCDPS3",71,0)
 . S Y=$P(STRT,"+")_"+"_(Y1+$S(Y2:Y2*X1,1:0))_UNT
"RTN","ORCDPS3",72,0)
 Q
"RTN","ORCDPS3",73,0)
 ;
"RTN","ORCDPS3",74,0)
FMDUR(X)        ; -- convert '# DAYS' to #D
"RTN","ORCDPS3",75,0)
 N X1,X2,Y I +X'>0 Q ""
"RTN","ORCDPS3",76,0)
 S X1=+X,X2=$P(X," ",2) S:'$L(X2) X2="DAYS"
"RTN","ORCDPS3",77,0)
 S Y=X1_$S("MINUTES"[X2:"'",1:$E(X2))
"RTN","ORCDPS3",78,0)
 Q Y
"RTN","ORCDPS3",79,0)
 ;
"RTN","ORCDPS3",80,0)
CONV ;;unit;unit;factor
"RTN","ORCDPS3",81,0)
 ;;';S;60
"RTN","ORCDPS3",82,0)
 ;;H;';60
"RTN","ORCDPS3",83,0)
 ;;H;S;3600
"RTN","ORCDPS3",84,0)
 ;;D;H;24
"RTN","ORCDPS3",85,0)
 ;;D;';1440
"RTN","ORCDPS3",86,0)
 ;;D;S;86400
"RTN","ORCDPS3",87,0)
 ;;W;D;7
"RTN","ORCDPS3",88,0)
 ;;W;H;168
"RTN","ORCDPS3",89,0)
 ;;W;';10080
"RTN","ORCDPS3",90,0)
 ;;W;S;604800
"RTN","ORCDPS3",91,0)
 ;;M;W;4
"RTN","ORCDPS3",92,0)
 ;;M;D;30
"RTN","ORCDPS3",93,0)
 ;;M;H;720
"RTN","ORCDPS3",94,0)
 ;;M;';43200
"RTN","ORCDPS3",95,0)
 ;;M;S;2592000
"RTN","ORCDPS3",96,0)
 ;;ZZZZ
"RTN","ORCDPS3",97,0)
 ;
"RTN","ORCDPS3",98,0)
ASKDUR()        ; -- Returns 1 or 0, if Duration prompt should be asked
"RTN","ORCDPS3",99,0)
 N X,Y I '$G(ORCOMPLX) K ORDIALOG(PROMPT,INST) Q 0
"RTN","ORCDPS3",100,0)
 S Y=1 G:'$L($G(ORSCH)) ADQ ;no schedule
"RTN","ORCDPS3",101,0)
 S X=+$O(^PS(51.1,"APPSJ",ORSCH,0)) G:X'>0 ADQ
"RTN","ORCDPS3",102,0)
 S:$P($G(^PS(51.1,X,0)),U,5)="O" Y=0
"RTN","ORCDPS3",103,0)
ADQ Q Y
"RTN","ORCDPS3",104,0)
 ;
"RTN","ORCDPS3",105,0)
CKDUR(X) ; -- Returns validated form of duration X, or null if invalid
"RTN","ORCDPS3",106,0)
 N X1,X2,Y,Z S Y=""
"RTN","ORCDPS3",107,0)
 S X1=+$G(X),X2=$P($G(X),X1,2) I X1'>0 Q ""
"RTN","ORCDPS3",108,0)
 S X2=$$UP^XLFSTR(X2),X2=$$STRIP^XLFSTR(X2," ") S:'$L(X2) X2="DAYS"
"RTN","ORCDPS3",109,0)
 F Z="MONTHS^&MONTHS&MONS","WEEKS^&WEEKS&WKS","DAYS^&DAYS&DYS","HOURS^&HOURS&HRS","MINUTES^&MINUTES&MINS'","SECONDS^&SECONDS&SECS" I $P(Z,U,2)[("&"_X2) S Y=$P(Z,U) Q
"RTN","ORCDPS3",110,0)
 S:$L(Y) Y=X1_" "_$S(X1=1:$E(Y,1,$L(Y)-1),1:Y) ;strip trailing 's'
"RTN","ORCDPS3",111,0)
 Q Y
"RTN","ORCDPS3",112,0)
 ;
"RTN","ORCDPS3",113,0)
DUR ; -- Process duration [from P-S Action]
"RTN","ORCDPS3",114,0)
 N X S X=$G(ORDIALOG(PROMPT,ORI)),X=$$CKDUR(X)
"RTN","ORCDPS3",115,0)
 I '$L(X) K DONE W $C(7),!,ORDIALOG(PROMPT,"?"),! Q
"RTN","ORCDPS3",116,0)
 S ORDIALOG(PROMPT,ORI)=X D:$G(ORESET)'=X CHANGED^ORCDPS1("QUANTITY")
"RTN","ORCDPS3",117,0)
 Q
"RTN","ORCDPS3",118,0)
 ;
"RTN","ORCDPS3",119,0)
TEST(START,DURTN)       ; -- test DEFSTRT
"RTN","ORCDPS3",120,0)
 N INST,ORSD,ORDIALOG,PROMPT
"RTN","ORCDPS3",121,0)
 S ORDIALOG(136,1)="",INST=2,ORSD="NOW",PROMPT=6
"RTN","ORCDPS3",122,0)
 S:$L($G(START)) ORDIALOG(6,1)=START S:$G(DURTN) ORDIALOG(153,1)=DURTN
"RTN","ORCDPS3",123,0)
 D DEFSTRT W !,Y
"RTN","ORCDPS3",124,0)
 Q
"RTN","ORCDPS3",125,0)
 ;
"RTN","ORCDPS3",126,0)
SC ; -- Dialog validation, to ask SC questions
"RTN","ORCDPS3",127,0)
 ;    Expects ORIFN, ORDA, and ORDER
"RTN","ORCDPS3",128,0)
 ;
"RTN","ORCDPS3",129,0)
 Q:'$L($T(SCNEW^PSOCP))  Q:'$G(ORIFN)  Q:'$G(ORDA)
"RTN","ORCDPS3",130,0)
 Q:$P($G(^OR(100,ORIFN,0)),U,12)'="O"  Q:$P($G(^(8,ORDA,0)),U,2)'="NW"  Q:$P($G(^(0)),U,15)=""
"RTN","ORCDPS3",131,0)
 ;
"RTN","ORCDPS3",132,0)
 N OR3,ORDRUG,PSIFN,ORX,I,J,DIE,DR,DA,X,Y,DTOUT,ORIGVIEW,DFN
"RTN","ORCDPS3",133,0)
 S OR3=$G(^OR(100,ORIFN,3)),X=$P(OR3,U,11) I X>2 Q  ;new, edit, or renew
"RTN","ORCDPS3",134,0)
 I X S Y=$P(OR3,U,5),PSIFN=$G(^OR(100,Y,4)) ;get PS# if edit/renewal
"RTN","ORCDPS3",135,0)
 S ORDRUG=$$VALUE^ORCSAVE2(ORIFN,"DRUG")
"RTN","ORCDPS3",136,0)
 D SCNEW^PSOCP(.ORX,+ORVP,ORDRUG,$G(PSIFN)) Q:'$D(ORX)
"RTN","ORCDPS3",137,0)
 S DIE="^OR(100,",DA=ORIFN,DR="",J=0
"RTN","ORCDPS3",138,0)
 F I="SC","MST","AO","IR","EC","HNC" S J=J+1 S:$D(ORX(I)) X=ORX(I),DR=DR_";5"_J_"R"_$S($L(X):"//"_$S(X:"YES",1:"NO"),1:"")
"RTN","ORCDPS3",139,0)
 S:$E(DR)=";" DR=$E(DR,2,999) Q:'$L(DR)  S ORIGVIEW=1
"RTN","ORCDPS3",140,0)
 I $D(ORX("SC")) S DFN=+ORVP D DIS^DGRPDB ;show current SC data
"RTN","ORCDPS3",141,0)
 W !!,"Is "_$$ORDITEM^ORCACT(ORDER)_" for treatment related to:"
"RTN","ORCDPS3",142,0)
 D ^DIE S:$D(DTOUT)!$D(Y) ORQUIT=1
"RTN","ORCDPS3",143,0)
 Q
"RTN","ORCDPSIV")
0^5^B14037687
"RTN","ORCDPSIV",1,0)
ORCDPSIV ;SLC/MKB-Pharmacy IV dialog utilities ;11/25/02  09:47
"RTN","ORCDPSIV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,38,48,158**;Dec 17, 1997
"RTN","ORCDPSIV",3,0)
PROVIDER ; -- Check provider, if authorized to write med orders
"RTN","ORCDPSIV",4,0)
 I $D(^XUSEC("OREMAS",DUZ)),'$$GET^XPAR("ALL","OR OREMAS MED ORDERS") W $C(7),!!,"OREMAS key holders may not enter medication orders." S ORQUIT=1 Q
"RTN","ORCDPSIV",5,0)
 N PS,NAME S PS=$G(^VA(200,+$G(ORNP),"PS")),NAME=$P($G(^(20)),U,2)
"RTN","ORCDPSIV",6,0)
 I '$L(NAME) S NAME=$P(^VA(200,+$G(ORNP),0),U)
"RTN","ORCDPSIV",7,0)
 I '$P(PS,U) W $C(7),!!,NAME_" is not authorized to write medication orders!" S ORQUIT=1
"RTN","ORCDPSIV",8,0)
 I $P(PS,U,4),$$NOW^XLFDT>$P(PS,U,4) W $C(7),!!,NAME_" is no longer authorized to write medication orders!" S ORQUIT=1
"RTN","ORCDPSIV",9,0)
 I $G(ORQUIT) W !,"You must select another provider to continue.",! S PS=$$MEDPROV I PS S ORXNP=ORNP,ORNP=PS K ORQUIT
"RTN","ORCDPSIV",10,0)
 Q
"RTN","ORCDPSIV",11,0)
 ;
"RTN","ORCDPSIV",12,0)
MEDPROV() ; -- Return ordering med provider
"RTN","ORCDPSIV",13,0)
 N X,Y,D,DIC
"RTN","ORCDPSIV",14,0)
 S DIC=200,DIC(0)="AEQ",DIC("A")="Select PROVIDER: ",D="AK.PROVIDER"
"RTN","ORCDPSIV",15,0)
 S DIC("S")="I $P($G(^(""PS"")),U),'$P(^(""PS""),U,4)!($P(^(""PS""),U,4)>$$NOW^XLFDT)"
"RTN","ORCDPSIV",16,0)
 D IX^DIC S:Y>0 Y=+Y I Y'>0 S Y="^"
"RTN","ORCDPSIV",17,0)
 Q Y
"RTN","ORCDPSIV",18,0)
 ;
"RTN","ORCDPSIV",19,0)
CHANGED(TYPE) ; -- Kill dependent values when OI changes
"RTN","ORCDPSIV",20,0)
 N PROMPTS,NAME,PTR,P,I
"RTN","ORCDPSIV",21,0)
 Q:'$L($G(TYPE))  S PROMPTS=""
"RTN","ORCDPSIV",22,0)
 S:TYPE="B" PROMPTS="VOLUME"
"RTN","ORCDPSIV",23,0)
 S:TYPE="A" PROMPTS="STRENGTH PSIV^UNITS"
"RTN","ORCDPSIV",24,0)
 F P=1:1:$L(PROMPTS,U) S NAME=$P(PROMPTS,U,P) D
"RTN","ORCDPSIV",25,0)
 . S PTR=$O(^ORD(101.41,"AB","OR GTX "_NAME,0)) Q:'PTR
"RTN","ORCDPSIV",26,0)
 . S I=0 F  S I=$O(ORDIALOG(PTR,I)) Q:I'>0  K ORDIALOG(PTR,I)
"RTN","ORCDPSIV",27,0)
 . K ORDIALOG(PTR,"LIST")
"RTN","ORCDPSIV",28,0)
 Q
"RTN","ORCDPSIV",29,0)
 ;
"RTN","ORCDPSIV",30,0)
INACTIVE(TYPE) ; -- Check OI inactive date
"RTN","ORCDPSIV",31,0)
 N OI,X,I,PSOI,DEA S:$G(TYPE)'="A" TYPE="S"
"RTN","ORCDPSIV",32,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:OI'>0
"RTN","ORCDPSIV",33,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D  Q  ;inactive
"RTN","ORCDPSIV",34,0)
 . S X=$S(TYPE="A":"additive",1:"solution"),ORQUIT=1
"RTN","ORCDPSIV",35,0)
 . W $C(7),!,"This "_X_" may not be ordered anymore.  Please select another."
"RTN","ORCDPSIV",36,0)
 S I=$S(TYPE="A":4,1:3) I '$P($G(^ORD(101.43,OI,"PS")),U,I) D  Q
"RTN","ORCDPSIV",37,0)
 . S X=$S(TYPE="A":"an additive",1:"a solution"),ORQUIT=1
"RTN","ORCDPSIV",38,0)
 . W $C(7),!,"This item may not be ordered as "_X_"."
"RTN","ORCDPSIV",39,0)
 Q:'$$INPT^ORCD  Q:'$L($T(IVDEA^PSSUTIL1))  ;DBIA #3784
"RTN","ORCDPSIV",40,0)
 S PSOI=+$P($G(^ORD(101.43,OI,0)),U,2)
"RTN","ORCDPSIV",41,0)
 S DEA=$$IVDEA^PSSUTIL1(PSOI,TYPE) I DEA>0 D  Q:$G(ORQUIT)
"RTN","ORCDPSIV",42,0)
 . I $G(ORNP),'$L($P($G(^VA(200,+ORNP,"PS")),U,2)),'$L($P($G(^("PS")),U,3)) W $C(7),!,$P($G(^(0)),U)_" must have a DEA# or VA# to order this drug!" S ORQUIT=1 Q
"RTN","ORCDPSIV",43,0)
 . I DEA=1 W $C(7),!,"This order will require a wet signature!"
"RTN","ORCDPSIV",44,0)
 Q
"RTN","ORCDPSIV",45,0)
 ;
"RTN","ORCDPSIV",46,0)
VOLUME ; -- get allowable volumes for solution
"RTN","ORCDPSIV",47,0)
 N PSOI,ORY,CNT,I K ORDIALOG(PROMPT,"LIST")
"RTN","ORCDPSIV",48,0)
 S PSOI=+$P($G(^ORD(101.43,+$$VAL^ORCD("SOLUTION",INST),0)),U,2)_"B"
"RTN","ORCDPSIV",49,0)
 D ENVOL^PSJORUT2(PSOI,.ORY) Q:'ORY
"RTN","ORCDPSIV",50,0)
 S (I,CNT)=0 F  S I=$O(ORY(I)) Q:I'>0  S CNT=CNT+1,ORDIALOG(PROMPT,"LIST",+ORY(I))=+ORY(I)
"RTN","ORCDPSIV",51,0)
 S ORDIALOG(PROMPT,"LIST")=CNT_"^1"
"RTN","ORCDPSIV",52,0)
 Q
"RTN","ORCDPSIV",53,0)
 ;
"RTN","ORCDPSIV",54,0)
UNITS ; -- get allowable units for current additive
"RTN","ORCDPSIV",55,0)
 N PSOI,ORY,I,UNITS
"RTN","ORCDPSIV",56,0)
 S PSOI=+$P(^ORD(101.43,+ORDIALOG($$PTR^ORCD("OR GTX ADDITIVE"),INST),0),U,2)_"A"
"RTN","ORCDPSIV",57,0)
 D ENVOL^PSJORUT2(PSOI,.ORY)
"RTN","ORCDPSIV",58,0)
 S I=$O(ORY(0)) Q:'I  S UNITS=$P($G(ORY(I)),U,2)
"RTN","ORCDPSIV",59,0)
 S ORDIALOG($$PTR^ORCD("OR GTX UNITS"),INST)=UNITS
"RTN","ORCDPSIV",60,0)
 W !," (Units for this additive are "_UNITS_")"
"RTN","ORCDPSIV",61,0)
 Q
"RTN","ORCDPSIV",62,0)
 ;
"RTN","ORCDPSIV",63,0)
PREMIX() ; -- Returns 1 or 0, if IV base is a premix solution
"RTN","ORCDPSIV",64,0)
 N BASE,PS,I,Y
"RTN","ORCDPSIV",65,0)
 S BASE=$$PTR^ORCD("OR GTX ORDERABLE ITEM"),Y=0
"RTN","ORCDPSIV",66,0)
 S I=0 F  S I=$O(ORDIALOG(BASE,I)) Q:I'>0  D  Q:Y
"RTN","ORCDPSIV",67,0)
 . S PS=$G(^ORD(101.43,+$G(ORDIALOG(BASE,I)),"PS"))
"RTN","ORCDPSIV",68,0)
 . I $P(PS,U,3)&($P(PS,U,4)) S Y=1
"RTN","ORCDPSIV",69,0)
 Q Y
"RTN","ORCDPSIV",70,0)
 ;
"RTN","ORCDPSIV",71,0)
VALIDAYS(X) ; -- Validate IV duration
"RTN","ORCDPSIV",72,0)
 N UNITS,X1,X2,Y,I
"RTN","ORCDPSIV",73,0)
 I X'?1.N." "1.A Q 0 ; invalid format
"RTN","ORCDPSIV",74,0)
 S UNITS="^MIN^HOURS^DAYS^M^H^D^",(X1,X2)=""
"RTN","ORCDPSIV",75,0)
 F I=1:1:$L(X) S Y=$E(X,I) S:Y?1N X1=X1_Y S:Y?1A X2=X2_$$UP^XLFSTR(Y)
"RTN","ORCDPSIV",76,0)
 I 'X1 Q 0
"RTN","ORCDPSIV",77,0)
 I UNITS'[(U_X2_U) Q 0
"RTN","ORCDPSIV",78,0)
 Q 1
"RTN","ORCSEND1")
0^2^B69176847
"RTN","ORCSEND1",1,0)
ORCSEND1 ;SLC/MKB-Release cont ;11/25/02  09:48
"RTN","ORCSEND1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,29,45,61,79,94,116,138,158**;Dec 17, 1997
"RTN","ORCSEND1",3,0)
PKGSTUFF(PKG) ; -- Package-specific release code
"RTN","ORCSEND1",4,0)
 S PKG=$$GET1^DIQ(9.4,+PKG_",",1) Q:'$L(PKG)
"RTN","ORCSEND1",5,0)
 D:$L($T(@PKG)) @PKG
"RTN","ORCSEND1",6,0)
 Q
"RTN","ORCSEND1",7,0)
 ;
"RTN","ORCSEND1",8,0)
LR ; -- Spawn child orders if continuous schedule or multiple tests
"RTN","ORCSEND1",9,0)
 N ORSTRT,ORPARENT,OR0,ORNP,ORDIALOG,ORL,ORX,ORTIME,ORPITEM,ORPSAMP,ORPSPEC,ORPURG,ORPCOMM,ORPTYPE,ORPCOLL,ORS1,ORS2,P,ORCHLD,ORDG,ORLAST,ORDUZ,ORLOG,ORCOLLCT,STS
"RTN","ORCSEND1",10,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORIFN,0)),ORL=$P(OR0,U,10)
"RTN","ORCSEND1",11,0)
 D SCHEDULE(ORIFN,"LR",.ORSTRT) I ORSTRT'>1,$$TESTS(+ORIFN)'>1 D  Q
"RTN","ORCSEND1",12,0)
 . N START S START=$O(ORSTRT(0)) Q:START=$P($G(^OR(100,+ORIFN,0)),U,8)
"RTN","ORCSEND1",13,0)
 . D DATES^ORCSAVE2(+ORIFN,START) ;update start date from schedule
"RTN","ORCSEND1",14,0)
 S ORNP=+$P(OR0,U,4),ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7),ORDG=+$P(OR0,U,11)
"RTN","ORCSEND1",15,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORIFN),GETIMES^ORCDLR1
"RTN","ORCSEND1",16,0)
 K ORDIALOG($$PTR^ORCD("OR GTX ADMIN SCHEDULE"),1),ORDIALOG($$PTR^ORCD("OR GTX DURATION"),1)
"RTN","ORCSEND1",17,0)
 S ORPITEM=$$PTR^ORCD("OR GTX ORDERABLE ITEM")
"RTN","ORCSEND1",18,0)
 S ORPSAMP=$$PTR^ORCD("OR GTX COLLECTION SAMPLE")
"RTN","ORCSEND1",19,0)
 S ORPSPEC=$$PTR^ORCD("OR GTX SPECIMEN")
"RTN","ORCSEND1",20,0)
 S ORPURG=$$PTR^ORCD("OR GTX LAB URGENCY")
"RTN","ORCSEND1",21,0)
 S ORPCOMM=$$PTR^ORCD("OR GTX WORD PROCESSING 1")
"RTN","ORCSEND1",22,0)
 S ORPTYPE=$$PTR^ORCD("OR GTX COLLECTION TYPE")
"RTN","ORCSEND1",23,0)
 S ORPCOLL=$$PTR^ORCD("OR GTX START DATE/TIME")
"RTN","ORCSEND1",24,0)
LR1 S ORS1=0 F  S ORS1=$O(ORX(ORS1)) Q:ORS1'>0  D
"RTN","ORCSEND1",25,0)
 . F P=ORPITEM,ORPSAMP,ORPSPEC,ORPURG,ORPCOMM,ORPTYPE S ORDIALOG(P,1)=$G(ORX(ORS1,P)) ; set values to next instance
"RTN","ORCSEND1",26,0)
 . S ORCOLLCT=$G(ORDIALOG(ORPTYPE,1))
"RTN","ORCSEND1",27,0)
 . S ORS2=0 F  S ORS2=$O(ORSTRT(ORS2)) Q:ORS2'>0  D
"RTN","ORCSEND1",28,0)
 .. S ORDIALOG(ORPCOLL,1)=ORS2 ;,ORDUZ=DUZ,ORLOG=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND1",29,0)
 .. I ORCOLLCT="LC" S ORDIALOG(ORPTYPE,1)=$S($$LABCOLL^ORCDLR1(ORS2):"LC",1:"WC")
"RTN","ORCSEND1",30,0)
 .. I ORCOLLCT="I" S ORDIALOG(ORPTYPE,1)=$S($$IMMCOLL^ORCDLR1(ORS2):"I",1:"WC")
"RTN","ORCSEND1",31,0)
 .. D CHILD()
"RTN","ORCSEND1",32,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND1",33,0)
 S ORIFN=ORPARENT,ORQUIT=1,STS=$P(^OR(100,ORIFN,3),U,3)
"RTN","ORCSEND1",34,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND1",35,0)
 D RELEASE^ORCSAVE2(ORPARENT,1,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND1",36,0)
 Q
"RTN","ORCSEND1",37,0)
 ;
"RTN","ORCSEND1",38,0)
TESTS(IFN) ; -- Returns number of tests in order IFN
"RTN","ORCSEND1",39,0)
 N I,CNT S (I,CNT)=0
"RTN","ORCSEND1",40,0)
 F  S I=$O(^OR(100,IFN,.1,I)) Q:I'>0  S:$G(^(I,0)) CNT=CNT+1
"RTN","ORCSEND1",41,0)
 Q CNT
"RTN","ORCSEND1",42,0)
 ;
"RTN","ORCSEND1",43,0)
SCHEDULE(IFN,PKG,ORY,STRT) ; -- Returns list of start time(s) from schedule
"RTN","ORCSEND1",44,0)
 N I,X,PSJSD,PSJFD,PSJW,PSJNE,PSJPP,PSJX,PSJAT,PSJM,PSJTS,PSJY,PSJAX,PSJSCH,PSJOSD,PSJOFD,PSJC,ORDUR
"RTN","ORCSEND1",45,0)
 S PSJSD=$S(+$G(STRT):STRT,1:$P($G(^OR(100,+IFN,0)),U,8)) I 'PSJSD S ORY=-1 Q
"RTN","ORCSEND1",46,0)
 S ORY=1,ORY(PSJSD)="" ; 1st occurrance
"RTN","ORCSEND1",47,0)
 S I=$O(^OR(100,+IFN,4.5,"ID","SCHEDULE",0)) Q:'I  Q:'$L($G(PKG))
"RTN","ORCSEND1",48,0)
 S X=$G(^OR(100,+IFN,4.5,I,1)),PSJX=$S(X:$$GET1^DIQ(51.1,+X_",",.01),1:X)
"RTN","ORCSEND1",49,0)
 S PSJW=+$G(ORL),PSJNE="",PSJPP=PKG D ENSV^PSJEEU Q:'$L($G(PSJX))
"RTN","ORCSEND1",50,0)
 I $G(PSJTS)'="C",$G(PSJTS)'="D" Q  ;not continuous or day-of-week
"RTN","ORCSEND1",51,0)
 S PSJSCH=PSJX,I=$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) Q:'I
"RTN","ORCSEND1",52,0)
 S ORDUR=$G(^OR(100,+IFN,4.5,+I,1))
"RTN","ORCSEND1",53,0)
 S:ORDUR PSJFD=$$FMADD^XLFDT(PSJSD,+ORDUR,,-1)
"RTN","ORCSEND1",54,0)
 I 'ORDUR S X=+$E(ORDUR,2,9) D
"RTN","ORCSEND1",55,0)
 . I PSJM S PSJFD=$$FMADD^XLFDT(PSJSD,,,(PSJM*X)-1) ;X_#times
"RTN","ORCSEND1",56,0)
 . E  D  ; no freq in minutes --> day of week
"RTN","ORCSEND1",57,0)
 .. N DAYS,LOCMX,SCHMX
"RTN","ORCSEND1",58,0)
 .. S LOCMX=$$GET^XPAR("ALL^LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORCSEND1",59,0)
 .. S SCHMX=$P(^PS(51.1,PSJY,0),U,7)
"RTN","ORCSEND1",60,0)
 .. S DAYS=$S('SCHMX:LOCMX,LOCMX<SCHMX:LOCMX,1:SCHMX)
"RTN","ORCSEND1",61,0)
 .. S PSJFD=$$FMADD^XLFDT(PSJSD,DAYS,,-1) ; get the most possible
"RTN","ORCSEND1",62,0)
 D ENSPU^PSJEEU K ORY
"RTN","ORCSEND1",63,0)
 I ORDUR M ORY=PSJC Q
"RTN","ORCSEND1",64,0)
 S ORY=$S(PSJC<$E(ORDUR,2,9):PSJC,1:$E(ORDUR,2,9))
"RTN","ORCSEND1",65,0)
 N NXT
"RTN","ORCSEND1",66,0)
 S NXT=0 F I=1:1:ORY S NXT=$O(PSJC(NXT)) Q:'NXT  S ORY(NXT)=PSJC(NXT)
"RTN","ORCSEND1",67,0)
 Q
"RTN","ORCSEND1",68,0)
 ;
"RTN","ORCSEND1",69,0)
GETORDER(IFN) ; -- Set ORX(Inst,Ptr)=Value
"RTN","ORCSEND1",70,0)
 N I,X,Y,PTR,INST,TYPE
"RTN","ORCSEND1",71,0)
 S I=0 F  S I=$O(^OR(100,IFN,4.5,I)) Q:I'>0  S X=$G(^(I,0)),Y=$G(^(1)) D
"RTN","ORCSEND1",72,0)
 . S PTR=+$P(X,U,2),INST=+$P(X,U,3),TYPE=$P($G(^ORD(101.41,PTR,1)),U)
"RTN","ORCSEND1",73,0)
 . I TYPE'="W" S ORX(INST,PTR)=Y Q
"RTN","ORCSEND1",74,0)
 . S ORX(INST,PTR)="^OR(100,"_IFN_",4.5,"_I_",2)"
"RTN","ORCSEND1",75,0)
 Q
"RTN","ORCSEND1",76,0)
 ;
"RTN","ORCSEND1",77,0)
PTR(X) ; -- Returns ptr value of prompt X in Order Dialog file
"RTN","ORCSEND1",78,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_X,1,63),0))
"RTN","ORCSEND1",79,0)
 ;
"RTN","ORCSEND1",80,0)
CHILD(STRT)   ; -- Create child order, send to package
"RTN","ORCSEND1",81,0)
 K ORIFN D EN^ORCSAVE Q:'$G(ORIFN)  D STARTDT^ORCSAVE2(ORIFN)
"RTN","ORCSEND1",82,0)
 I $G(STRT) D DATES^ORCSAVE2(ORIFN,STRT)
"RTN","ORCSEND1",83,0)
 S ORCHLD=+$G(ORCHLD)+1,^OR(100,ORPARENT,2,ORIFN,0)=ORIFN,ORLAST=ORIFN
"RTN","ORCSEND1",84,0)
 S $P(^OR(100,ORIFN,3),U,9)=ORPARENT
"RTN","ORCSEND1",85,0)
 I $G(PKG)="LR" S $P(^OR(100,ORIFN,8,1,0),U,4)="" K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;signature tracked on parent order only, for Labs
"RTN","ORCSEND1",86,0)
 I $G(PKG)?1"PS".E D
"RTN","ORCSEND1",87,0)
 . N X0 S X0=$G(^OR(100,ORPARENT,8,1,0))
"RTN","ORCSEND1",88,0)
 . I $P(X0,U,4)'=2 D SIGN^ORCSAVE2(ORIFN,+$P(X0,U,5),ORNOW,$P(X0,U,4),1)
"RTN","ORCSEND1",89,0)
 . I $D(^OR(100,ORPARENT,9)) M ^OR(100,ORIFN,9)=^OR(100,ORPARENT,9)
"RTN","ORCSEND1",90,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND1",91,0)
 Q
"RTN","ORCSEND1",92,0)
 ;
"RTN","ORCSEND1",93,0)
PS ; -- spawn child orders if multiple doses
"RTN","ORCSEND1",94,0)
PSJ ;     (for Inpt orders only)
"RTN","ORCSEND1",95,0)
PSS ;
"RTN","ORCSEND1",96,0)
 N ORPARENT,OR0,ORNP,ORDIALOG,ORDUZ,ORLOG,ORL,ORDG,ORCAT,ORX,ORP,ORI,STS
"RTN","ORCSEND1",97,0)
 N ORDOSE,ORT,ORSCH,ORDUR,ORSTRT,ORFRST,ORCONJ,ORID,ORDD,ORSTR,ORDGNM
"RTN","ORCSEND1",98,0)
 N ORSTART,ORCHLD,ORLAST,ORSIG,OROI,ID,OR3,ORIG,CODE,ORPKG
"RTN","ORCSEND1",99,0)
 S ORPARENT=+ORIFN,OR0=$G(^OR(100,ORPARENT,0)) Q:$P(OR0,U,12)'="I"
"RTN","ORCSEND1",100,0)
 S ORNP=+$P(OR0,U,4),ORDIALOG=+$P(OR0,U,5),ORDUZ=+$P(OR0,U,6),ORLOG=$P(OR0,U,7)
"RTN","ORCSEND1",101,0)
 S ORL=$P(OR0,U,10),ORDG=+$P(OR0,U,11),ORPKG=+$P(OR0,U,14),ORCAT="I"
"RTN","ORCSEND1",102,0)
 D GETDLG1^ORCD(ORDIALOG),GETORDER(ORPARENT)
"RTN","ORCSEND1",103,0)
 S ORDOSE=$$PTR("INSTRUCTIONS"),ORT=$$PTR("ROUTE")
"RTN","ORCSEND1",104,0)
 S ORSCH=$$PTR("SCHEDULE"),ORDUR=$$PTR("DURATION")
"RTN","ORCSEND1",105,0)
 S ORCONJ=$$PTR("AND/THEN") D STRT S ORSTART=$G(ORSTRT("BEG"))
"RTN","ORCSEND1",106,0)
 D DATES^ORCSAVE2(ORPARENT,ORSTART) Q:$$DOSES(ORPARENT)'>1
"RTN","ORCSEND1",107,0)
 S ORFRST=$$PTR("NOW"),ORSIG=$$PTR("SIG")
"RTN","ORCSEND1",108,0)
 S ORID=$$PTR("DOSE"),ORDD=$$PTR("DISPENSE DRUG")
"RTN","ORCSEND1",109,0)
 S ORSTR=$$PTR("STRENGTH"),ORDGNM=$$PTR("DRUG NAME")
"RTN","ORCSEND1",110,0)
PS1 F ORP="ORDERABLE ITEM","URGENCY","WORD PROCESSING 1" D
"RTN","ORCSEND1",111,0)
 . N PTR S PTR=$$PTR(ORP) Q:PTR'>0  Q:'$D(ORX(1,PTR))
"RTN","ORCSEND1",112,0)
 . S ORDIALOG(PTR,1)=ORX(1,PTR) S:$E(ORP)="O" OROI=ORX(1,PTR)
"RTN","ORCSEND1",113,0)
 S ORI=$$FRSTDOSE I $G(ORX(1,ORFRST)) D
"RTN","ORCSEND1",114,0)
 . F ORP=ORDOSE,ORT,ORID S:$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)=ORX(ORI,ORP)
"RTN","ORCSEND1",115,0)
 . S ID=$G(ORX(ORI,ORID)) S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND1",116,0)
 . S ORDIALOG(ORSCH,1)="NOW",ORSTART=$$NOW^XLFDT
"RTN","ORCSEND1",117,0)
 . D SIG,CHILD(ORSTART)
"RTN","ORCSEND1",118,0)
 F  D  S ORI=$O(ORX(ORI)) Q:ORI'>0
"RTN","ORCSEND1",119,0)
 . F ORP=ORDOSE,ORT,ORSCH,ORDUR,ORID S:$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)=ORX(ORI,ORP) K:'$D(ORX(ORI,ORP)) ORDIALOG(ORP,1)
"RTN","ORCSEND1",120,0)
 . K ORDIALOG(ORDD,1) S ID=$G(ORX(ORI,ORID))
"RTN","ORCSEND1",121,0)
 . S:$P(ID,"&",6) ORDIALOG(ORDD,1)=$P(ID,"&",6)
"RTN","ORCSEND1",122,0)
 . S ORSTART=$G(ORSTRT(ORI))
"RTN","ORCSEND1",123,0)
 . D SIG,CHILD(ORSTART)
"RTN","ORCSEND1",124,0)
 S:$G(ORCHLD) ^OR(100,ORPARENT,2,0)="^100.002PA^"_ORLAST_U_ORCHLD
"RTN","ORCSEND1",125,0)
 S ORIFN=ORPARENT,ORQUIT=1,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND1",126,0)
 I (STS=1)!(STS=13)!(STS=11) S ORERR="1^Unable to release orders"
"RTN","ORCSEND1",127,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORNOW,DUZ,$G(NATURE)) K ^TMP("ORWORD",$J)
"RTN","ORCSEND1",128,0)
 S $P(^OR(100,ORIFN,3),U,8)=1 ;veil parent order - set stop date/time?
"RTN","ORCSEND1",129,0)
 Q:(STS=1)!(STS=13)!(STS=11)  ;unsuccessful
"RTN","ORCSEND1",130,0)
PS2 ; -- ck if parent is unsigned or edit
"RTN","ORCSEND1",131,0)
 I $P($G(^OR(100,ORIFN,8,1,0)),U,4)=2 S $P(^(0),U,4)="" K ^OR(100,"AS",ORVP,9999999-ORLOG,ORIFN,1) ;clear ES
"RTN","ORCSEND1",132,0)
 Q:$P(OR3,U,11)'=1  S ORIG=$P(OR3,U,5) Q:ORIG'>0
"RTN","ORCSEND1",133,0)
 S CODE=$S($P($G(^OR(100,ORIG,3)),U,3)=5:"CA",1:"DC")
"RTN","ORCSEND1",134,0)
 D MSG^ORMBLD(ORIG,CODE) I "^1^13^"[(U_$P($G(^OR(100,ORIG,3)),U,3)_U) D
"RTN","ORCSEND1",135,0)
 . N NATR S NATR=+$O(^ORD(100.02,"C","C",0))
"RTN","ORCSEND1",136,0)
 . S $P(^OR(100,ORIG,3),U,3)=12,$P(^(3),U,7)=0,^(6)=NATR_U_DUZ_U_ORNOW
"RTN","ORCSEND1",137,0)
 . D CANCEL^ORCSEND(ORIG) ;ck for unrel actions
"RTN","ORCSEND1",138,0)
 Q
"RTN","ORCSEND1",139,0)
 ;
"RTN","ORCSEND1",140,0)
DOSES(IFN) ; -- count number of doses in order
"RTN","ORCSEND1",141,0)
 N I,CNT S CNT=0
"RTN","ORCSEND1",142,0)
 S I=0 F  S I=$O(^OR(100,+$G(IFN),4.5,"ID","INSTR",I)) Q:I'>0  I $L($G(^OR(100,+$G(IFN),4.5,I,1))) S CNT=CNT+1
"RTN","ORCSEND1",143,0)
 S I=+$O(^OR(100,+$G(IFN),4.5,"ID","NOW",0)) I I,$G(^OR(100,+$G(IFN),4.5,I,1)) S CNT=CNT+1
"RTN","ORCSEND1",144,0)
 Q CNT
"RTN","ORCSEND1",145,0)
 ;
"RTN","ORCSEND1",146,0)
FRSTDOSE()      ; -- Return instance of first dose
"RTN","ORCSEND1",147,0)
 N I,Y S I=0,Y=1
"RTN","ORCSEND1",148,0)
 F  S I=$O(ORX(I)) Q:I'>0  I $D(ORX(I,ORDOSE)) S Y=I Q
"RTN","ORCSEND1",149,0)
 Q Y
"RTN","ORCSEND1",150,0)
 ;
"RTN","ORCSEND1",151,0)
SIG ; -- Build text of instructions
"RTN","ORCSEND1",152,0)
 N ORDRUG,ID,DOSE,ORI,ORX K ^TMP("ORWORD",$J,ORSIG,1)
"RTN","ORCSEND1",153,0)
 S ORDRUG=$G(ORDIALOG(ORDD,1)),ID=$G(ORDIALOG(ORID,1))
"RTN","ORCSEND1",154,0)
 S DOSE=$G(ORDIALOG(ORDOSE,1)),ORI=1
"RTN","ORCSEND1",155,0)
 S ORX=$$DOSE^ORCDPS2_$$RTE^ORCDPS2_$$SCH^ORCDPS2_$$DUR^ORCDPS2
"RTN","ORCSEND1",156,0)
 S ^TMP("ORWORD",$J,ORSIG,1,0)="^^1^1^"_DT_U,^(1,0)=ORX
"RTN","ORCSEND1",157,0)
 S ORDIALOG(ORSIG,1)=$NA(^TMP("ORWORD",$J,ORSIG,1))
"RTN","ORCSEND1",158,0)
 S ORDIALOG(ORDOSE,"FORMAT")="@"
"RTN","ORCSEND1",159,0)
 K ORDIALOG(ORSTR,1),ORDIALOG(ORDGNM,1)
"RTN","ORCSEND1",160,0)
 I ORDRUG,'ID D  ;set strength or drug name
"RTN","ORCSEND1",161,0)
 . N STR,ITM S STR=$P(ID,"&",7)_$P(ID,"&",8)
"RTN","ORCSEND1",162,0)
 . I STR'>0 S ORDIALOG(ORDGNM,1)=$$GET1^DIQ(50,+ORDRUG_",",.01) Q
"RTN","ORCSEND1",163,0)
 . S ITM=$P($G(^ORD(101.43,+$G(OROI),0)),U)
"RTN","ORCSEND1",164,0)
 . S:ITM'[STR ORDIALOG(ORSTR,1)=STR
"RTN","ORCSEND1",165,0)
 Q
"RTN","ORCSEND1",166,0)
 ;
"RTN","ORCSEND1",167,0)
STRT ; -- Build ORSTRT(inst)=date.time array of start times by dose
"RTN","ORCSEND1",168,0)
 N OI,PSOI,XD,XH,XM,XS,ORWD,ORI,SCH,ORSD,X,ORD K ORSTRT
"RTN","ORCSEND1",169,0)
 S OI=$G(ORX(1,$$PTR^ORCD("OR GTX ORDERABLE ITEM")))
"RTN","ORCSEND1",170,0)
 S PSOI=+$P($G(^ORD(101.43,+OI,0)),U,2),(XD,XH,XM,XS)=0
"RTN","ORCSEND1",171,0)
 S ORWD=+$G(^SC(+$G(ORL),42)) ;ward
"RTN","ORCSEND1",172,0)
 S ORI=0 F  S ORI=$O(ORX(ORI)) Q:ORI<1  D
"RTN","ORCSEND1",173,0)
 . S SCH=$G(ORX(ORI,ORSCH)),ORSD="" S:'$L(SCH) X=$$NOW^XLFDT
"RTN","ORCSEND1",174,0)
 . S:$L(SCH) ORSD=$$STARTSTP^PSJORPOE(+ORVP,SCH,PSOI,ORWD),X=$P(ORSD,U,4)
"RTN","ORCSEND1",175,0)
 . S ORSTRT(ORI)=$$FMADD^XLFDT(X,XD,XH,XM,XS) ;START+OFFSET
"RTN","ORCSEND1",176,0)
 . ; -- update OFFSET for next THEN dose
"RTN","ORCSEND1",177,0)
 . D DUR(ORI) I $G(ORX(ORI,ORCONJ))="T" D
"RTN","ORCSEND1",178,0)
 .. I $G(ORD("XD"))<1,$G(ORD("XH"))<1,$G(ORD("XM"))<1,$G(ORD("XS"))<1 S ORD("XD")=+$P(ORSD,U,3) ;default duration
"RTN","ORCSEND1",179,0)
 .. N I,Y F I="XD","XH","XM","XS" S Y=@I,@I=Y+$G(ORD(I))
"RTN","ORCSEND1",180,0)
 .. K ORD
"RTN","ORCSEND1",181,0)
 ; -- find beginning date.time for parent
"RTN","ORCSEND1",182,0)
 S ORI=0,X=9999999 F  S ORI=$O(ORSTRT(ORI)) Q:ORI<1  I ORSTRT(ORI)<X S X=ORSTRT(ORI)
"RTN","ORCSEND1",183,0)
 S ORSTRT("BEG")=X
"RTN","ORCSEND1",184,0)
 Q
"RTN","ORCSEND1",185,0)
 ;
"RTN","ORCSEND1",186,0)
DUR(I) ; -- Accumulate duration in ORD("Xt") for offsetting next THEN dose
"RTN","ORCSEND1",187,0)
 N X,Y S X=$$FMDUR^ORCDPS3($G(ORX(I,ORDUR)))
"RTN","ORCSEND1",188,0)
 I X["S",+X>$G(ORD("XS")) S ORD("XS")=+X
"RTN","ORCSEND1",189,0)
 I X["'",+X>$G(ORD("XM")) S ORD("XM")=+X
"RTN","ORCSEND1",190,0)
 I X["H",+X>$G(ORD("XH")) S ORD("XH")=+X
"RTN","ORCSEND1",191,0)
 S Y=$S(X["D":+X,X["W":+X*7,X["M":+X*30,1:0)
"RTN","ORCSEND1",192,0)
 I Y,Y>$G(ORD("XD")) S ORD("XD")=Y
"RTN","ORCSEND1",193,0)
 Q
"RTN","ORMPS1")
0^3^B58206611
"RTN","ORMPS1",1,0)
ORMPS1 ;SLC/MKB - Process Pharmacy ORM msgs cont ;11/25/02  09:48
"RTN","ORMPS1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**86,92,94,116,134,152,158**;Dec 17, 1997
"RTN","ORMPS1",3,0)
UDOSE ; -- new Unit Dose order
"RTN","ORMPS1",4,0)
 N QT,DRUG,INSTR,DOSE,RTE,SCH,OI,URG,WP,DUR,STR,DRGNM,X,PSOI,PSDD,S0,ID,LDOSE,XC,NTE,S0,RXR
"RTN","ORMPS1",5,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJ OR PAT OE",0))
"RTN","ORMPS1",6,0)
 S ORDG=+$O(^ORD(100.98,"B","UNIT DOSE MEDICATIONS",0))
"RTN","ORMPS1",7,0)
 S ORPKG=+$$PKG("PSJ")
"RTN","ORMPS1",8,0)
 D GETDLG1^ORCD(ORDIALOG) S QT=$G(ORQT(1))
"RTN","ORMPS1",9,0)
 S DRUG=$$PTR("DISPENSE DRUG"),INSTR=$$PTR("INSTRUCTIONS")
"RTN","ORMPS1",10,0)
 S DOSE=$$PTR("DOSE"),RTE=$$PTR("ROUTE"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",11,0)
 S OI=$$PTR("ORDERABLE ITEM"),URG=$$PTR("URGENCY")
"RTN","ORMPS1",12,0)
 S WP=$$PTR("WORD PROCESSING 1"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",13,0)
 S STR=$$PTR("STRENGTH"),DRGNM=$$PTR("DRUG NAME")
"RTN","ORMPS1",14,0)
 ;
"RTN","ORMPS1",15,0)
UD1 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",16,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",17,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",18,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",19,0)
 S ID=$P(QT,U),LDOSE=$P(QT,U,8) I 'ID,S0 D
"RTN","ORMPS1",20,0)
 . N UNT,PTRN S UNT=$P(S0,"&",2),PTRN="1.N1"""_UNT_""""
"RTN","ORMPS1",21,0)
 . I LDOSE?@PTRN S $P(ID,"&",1,2)=+LDOSE_"&"_UNT Q  ;pre-POE orders
"RTN","ORMPS1",22,0)
 . S:$P(PSOI,U,2)'[S0 ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",23,0)
 I 'ID,'S0 S ORDIALOG(DRGNM,1)=$P(PSDD,U,2)
"RTN","ORMPS1",24,0)
 S:$L(ID) ORDIALOG(DOSE,1)=$P(ID,"&",1,4)_"&"_LDOSE_"&"_+PSDD_"&"_S0
"RTN","ORMPS1",25,0)
 I LDOSE="" D  I LDOSE="" S ORERR="Unable to determine instructions" Q
"RTN","ORMPS1",26,0)
 . I $G(RXC)'>0 D  Q  ;look for units/dose
"RTN","ORMPS1",27,0)
 .. S LDOSE=$P(ID,"&",3),X=$P(ID,"&",4) I 'LDOSE S LDOSE="" Q
"RTN","ORMPS1",28,0)
 .. S:'$L(X) X=$P($$FIND^ORM(+RXE,7),U,5) S:$L(X) LDOSE=LDOSE_" "_X
"RTN","ORMPS1",29,0)
 .. S ORDIALOG(DRGNM,1)=$P(PSDD,U,2) ;force use of DD
"RTN","ORMPS1",30,0)
 . F  D  Q:LDOSE'=""  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",31,0)
 .. S XC=@ORMSG@(RXC) Q:+$P($P(XC,"|",3),U,4)'=+PSOI
"RTN","ORMPS1",32,0)
 .. S LDOSE=$P(XC,"|",4)_$P($P(XC,"|",5),U,5) ;strength_units
"RTN","ORMPS1",33,0)
 S ORDIALOG(INSTR,1)=LDOSE
"RTN","ORMPS1",34,0)
UD2 S NTE=$$NTE(21) I NTE D
"RTN","ORMPS1",35,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",36,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",37,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",38,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",39,0)
 S RXR=$$RXR^ORMPS I 'RXR S ORERR="Missing or invalid RXR segment" Q
"RTN","ORMPS1",40,0)
 S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4),ORDIALOG(URG,1)=ORURG
"RTN","ORMPS1",41,0)
 S ORDIALOG(SCH,1)=$P(QT,U,2),X=$P(QT,U,3)
"RTN","ORMPS1",42,0)
 I $L(X) D  ;set only if previous order had duration
"RTN","ORMPS1",43,0)
 . N IFN S IFN=$S($G(ORIFN):+ORIFN,$P(ZRX,"|",2):+$P(ZRX,"|",2),1:0)
"RTN","ORMPS1",44,0)
 . S:$O(^OR(100,+IFN,4.5,"ID","DAYS",0)) ORDIALOG(DUR,1)=$$DURATION(X)
"RTN","ORMPS1",45,0)
 D DOSETEXT^ORCDPS2 ;reset Instructions text, SIG
"RTN","ORMPS1",46,0)
 Q
"RTN","ORMPS1",47,0)
 ;
"RTN","ORMPS1",48,0)
OUT ; -- new Outpt order
"RTN","ORMPS1",49,0)
 N OI,SIG,INSTR,DOSE,RTE,SCH,DUR,SC,STR,DRUG,PI,CONJ,PSOI,PSDD,S0,X,I,RXR,J,NTE,ZSC,CNT,PC
"RTN","ORMPS1",50,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSO OERR",0))
"RTN","ORMPS1",51,0)
 S ORDG=+$O(^ORD(100.98,"B","OUTPATIENT MEDICATIONS",0))
"RTN","ORMPS1",52,0)
 S ORPKG=+$$PKG("PSO") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",53,0)
 S OI=$$PTR("ORDERABLE ITEM"),SIG=$$PTR("SIG")
"RTN","ORMPS1",54,0)
 S INSTR=$$PTR("INSTRUCTIONS"),DOSE=$$PTR("DOSE")
"RTN","ORMPS1",55,0)
 S SCH=$$PTR("SCHEDULE"),DUR=$$PTR("DURATION")
"RTN","ORMPS1",56,0)
 S RTE=$$PTR("ROUTE"),SC=$$PTR("SERVICE CONNECTED")
"RTN","ORMPS1",57,0)
 S STR=$$PTR("STRENGTH"),DRUG=$$PTR("DISPENSE DRUG")
"RTN","ORMPS1",58,0)
 S PI=$$PTR("PATIENT INSTRUCTIONS"),CONJ=$$PTR("AND/THEN")
"RTN","ORMPS1",59,0)
 S PC=$$PTR("WORD PROCESSING 1")
"RTN","ORMPS1",60,0)
 ;
"RTN","ORMPS1",61,0)
 S:RXO X=$P(RXO,"|",2),ORDIALOG(OI,1)=$$ORDITEM^ORM(X),PSOI=$P(X,U,4,5)
"RTN","ORMPS1",62,0)
 I '$G(ORDIALOG(OI,1)) S ORERR="Missing or invalid orderable item" Q
"RTN","ORMPS1",63,0)
 S PSDD=$P($$FIND^ORM(+RXE,3),U,4,5),ORDIALOG(DRUG,1)=+PSDD
"RTN","ORMPS1",64,0)
 S S0=$$FIND^ORM(+RXE,26)_"&"_$P($$FIND^ORM(+RXE,27),U,5)
"RTN","ORMPS1",65,0)
 I S0,$P(PSOI,U,2)'[S0 S ORDIALOG(STR,1)=$TR(S0,"&")
"RTN","ORMPS1",66,0)
 I 'S0,'$G(ORQT(1)) S ORDIALOG($$PTR("DRUG NAME"),1)=$P(PSDD,U,2)
"RTN","ORMPS1",67,0)
OUT1 S ORDIALOG($$PTR("QUANTITY"),1)=$$FIND^ORM(+RXE,11)
"RTN","ORMPS1",68,0)
 S ORDIALOG($$PTR("REFILLS"),1)=$$FIND^ORM(+RXE,13)
"RTN","ORMPS1",69,0)
 S X=$$FIND^ORM(+RXE,23) S:$E(X)="D" X=+$E(X,2,99)
"RTN","ORMPS1",70,0)
 S:X ORDIALOG($$PTR("DAYS SUPPLY"),1)=X
"RTN","ORMPS1",71,0)
 I ZRX S X=$P(ZRX,"|",5) S:$L(X) ORDIALOG($$PTR("ROUTING"),1)=X
"RTN","ORMPS1",72,0)
 S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG F I=1:1:ORQT D
"RTN","ORMPS1",73,0)
 . S ORDIALOG(INSTR,I)=$P(ORQT(I),U,8),X=$P(ORQT(I),U)
"RTN","ORMPS1",74,0)
 . S:$L(X) ORDIALOG(DOSE,I)=$P(X,"&",1,4)_"&"_$P(ORQT(I),U,8)_"&"_+PSDD_"&"_S0
"RTN","ORMPS1",75,0)
 . S X=$P(ORQT(I),U,2) S:$L(X) ORDIALOG(SCH,I)=X
"RTN","ORMPS1",76,0)
 . S X=$P(ORQT(I),U,3) S:$L(X) ORDIALOG(DUR,I)=$$DURATION(X)
"RTN","ORMPS1",77,0)
 . S X=$P(ORQT(I),U,9) S:$L(X) ORDIALOG(CONJ,I)=$S(X="S":"T",1:X)
"RTN","ORMPS1",78,0)
 S RXR=$$RXR^ORMPS I RXR S ORDIALOG(RTE,1)=$P($P(RXR,"|",2),U,4) D
"RTN","ORMPS1",79,0)
 . S I=1,J=+RXR ;look for multiple RXR's
"RTN","ORMPS1",80,0)
 . F  S J=$O(@ORMSG@(J)) Q:J'>0  S RXR=@ORMSG@(J) Q:$E(RXR,1,3)'="RXR"  S I=I+1,ORDIALOG(RTE,I)=$P($P(RXR,"|",2),U,4)
"RTN","ORMPS1",81,0)
OUT2 S NTE=$$NTE(6) I NTE D  ;Prov Comm
"RTN","ORMPS1",82,0)
 . S CNT=1,^TMP("ORWORD",$J,PC,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",83,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PC,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",84,0)
 . S ^TMP("ORWORD",$J,PC,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",85,0)
 . S ORDIALOG(PC,1)="^TMP(""ORWORD"",$J,"_PC_",1)"
"RTN","ORMPS1",86,0)
 S NTE=$$NTE(7) I NTE D  ;Pat Instr
"RTN","ORMPS1",87,0)
 . S CNT=1,^TMP("ORWORD",$J,PI,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",88,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,PI,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",89,0)
 . S ^TMP("ORWORD",$J,PI,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",90,0)
 . S ORDIALOG(PI,1)="^TMP(""ORWORD"",$J,"_PI_",1)"
"RTN","ORMPS1",91,0)
 S NTE=$$NTE(21) I NTE D  ;Sig
"RTN","ORMPS1",92,0)
 . S CNT=1,^TMP("ORWORD",$J,SIG,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",93,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,SIG,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",94,0)
 . S ^TMP("ORWORD",$J,SIG,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",95,0)
 . S ORDIALOG(SIG,1)="^TMP(""ORWORD"",$J,"_SIG_",1)"
"RTN","ORMPS1",96,0)
 . S ORDIALOG(PI,"FORMAT")="@" ;PI already included in Sig
"RTN","ORMPS1",97,0)
OUT3 I '$G(ORQT(1))!('NTE) D DOSETEXT^ORCDPS2 ;reset Instructions text, Sig
"RTN","ORMPS1",98,0)
 S ZSC=$$ZSC,X=$P(ZSC,"|",2) I X?2.3U S ORDIALOG(SC,1)=$S(X="SC":1,1:0)
"RTN","ORMPS1",99,0)
 Q
"RTN","ORMPS1",100,0)
 ;
"RTN","ORMPS1",101,0)
IV ; -- new IV order
"RTN","ORMPS1",102,0)
 N IVTYP S IVTYP=$P(ZRX,"|",7) I IVTYP="",$$NUMADDS'>1 G UDOSE
"RTN","ORMPS1",103,0)
 N SOLN,VOL,ADDS,STR,UNITS,RATE,URG,X,X1,X2,I,J,TYPE,OI,WP,NTE,SCH
"RTN","ORMPS1",104,0)
 S ORDIALOG=+$O(^ORD(101.41,"AB","PSJI OR PAT FLUID OE",0))
"RTN","ORMPS1",105,0)
 S ORDG=+$O(^ORD(100.98,"B",$S($P(ZRX,"|",7)="TPN":"TPN",1:"IV RX"),0))
"RTN","ORMPS1",106,0)
 S ORPKG=+$$PKG("PSIV") D GETDLG1^ORCD(ORDIALOG)
"RTN","ORMPS1",107,0)
 S SOLN=$$PTR("ORDERABLE ITEM"),VOL=$$PTR("VOLUME"),SCH=$$PTR("SCHEDULE")
"RTN","ORMPS1",108,0)
 S RATE=$$PTR("INFUSION RATE") S:ORURG ORDIALOG($$PTR("URGENCY"),1)=ORURG
"RTN","ORMPS1",109,0)
 S WP=$$PTR("WORD PROCESSING 1"),ADDS=$$PTR("ADDITIVE")
"RTN","ORMPS1",110,0)
 S STR=$$PTR("STRENGTH PSIV"),UNITS=$$PTR("UNITS")
"RTN","ORMPS1",111,0)
IV1 S NTE=$$NTE(21) I NTE D
"RTN","ORMPS1",112,0)
 . N CNT,I S CNT=1,^TMP("ORWORD",$J,WP,1,CNT,0)=$P(@ORMSG@(NTE),"|",4)
"RTN","ORMPS1",113,0)
 . I $O(@ORMSG@(NTE,0)) S I=0 F  S I=$O(@ORMSG@(NTE,I)) Q:I'>0  S CNT=CNT+1,^TMP("ORWORD",$J,WP,1,CNT,0)=@ORMSG@(NTE,I)
"RTN","ORMPS1",114,0)
 . S ^TMP("ORWORD",$J,WP,1,0)="^^"_CNT_U_CNT_U_DT_U
"RTN","ORMPS1",115,0)
 . S ORDIALOG(WP,1)="^TMP(""ORWORD"",$J,"_WP_",1)"
"RTN","ORMPS1",116,0)
 S X=$P($$FIND^ORM(+RXE,25),U,5)
"RTN","ORMPS1",117,0)
 S ORDIALOG(RATE,1)=$$FIND^ORM(+RXE,24)_$S($L(X):" "_X,1:""),(I,J)=0
"RTN","ORMPS1",118,0)
 F  D  S RXC=$O(@ORMSG@(RXC)) Q:'RXC  Q:$E(@ORMSG@(RXC),1,3)'="RXC"
"RTN","ORMPS1",119,0)
 . S X=@ORMSG@(RXC),TYPE=$P(X,"|",2),OI=$$ORDITEM^ORM($P(X,"|",3)) Q:'OI
"RTN","ORMPS1",120,0)
 . S X1=$P(X,"|",4),X2=$P($P(X,"|",5),U,5)
"RTN","ORMPS1",121,0)
 . I $E(TYPE)="B" S J=J+1,ORDIALOG(SOLN,J)=OI,ORDIALOG(VOL,J)=X1 Q
"RTN","ORMPS1",122,0)
 . S I=I+1,ORDIALOG(ADDS,I)=OI,ORDIALOG(STR,I)=X1,ORDIALOG(UNITS,I)=X2
"RTN","ORMPS1",123,0)
 I IVTYP="" S X=$P($G(ORQT(1)),U,2) S:$L(X) ORDIALOG(SCH,1)=X
"RTN","ORMPS1",124,0)
 Q
"RTN","ORMPS1",125,0)
 ;
"RTN","ORMPS1",126,0)
NTE(ID) ; -- Return subscript of NTE segment for RXE-<ID>
"RTN","ORMPS1",127,0)
 N I,SEG,Y S Y="",I=+RXE S:'$G(ID) ID=21
"RTN","ORMPS1",128,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=@ORMSG@(I) Q:$E(SEG,1,3)="ORC"  I $P(SEG,"|",1,2)=("NTE|"_ID) S Y=I Q
"RTN","ORMPS1",129,0)
 Q Y
"RTN","ORMPS1",130,0)
 ;
"RTN","ORMPS1",131,0)
ZSC() ; -- Return subscript of ZSC segment
"RTN","ORMPS1",132,0)
 N I,SEG,Y S Y="",I=+RXE
"RTN","ORMPS1",133,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZSC" S Y=I_U_@ORMSG@(I) Q
"RTN","ORMPS1",134,0)
 Q Y
"RTN","ORMPS1",135,0)
 ;
"RTN","ORMPS1",136,0)
NUMADDS() ; -- count number of additives to determine type
"RTN","ORMPS1",137,0)
 N CNT,I,X S CNT=0,I=+RXE
"RTN","ORMPS1",138,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S X=@ORMSG@(I) Q:$P(X,"|")="ORC"  I $E(X,1,6)="RXC|A|" S CNT=CNT+1
"RTN","ORMPS1",139,0)
 Q CNT
"RTN","ORMPS1",140,0)
 ;
"RTN","ORMPS1",141,0)
PKG(NMSP) ; -- Return Package file ptr for NMSP
"RTN","ORMPS1",142,0)
 N I S I=0
"RTN","ORMPS1",143,0)
 F  S I=+$O(^DIC(9.4,"C",NMSP,I)) Q:I<1  Q:'$O(^(I,0))  ;no Addl Prefs
"RTN","ORMPS1",144,0)
 Q I
"RTN","ORMPS1",145,0)
 ;
"RTN","ORMPS1",146,0)
PTR(NAME) ; -- Returns ien of prompt NAME in Order Dialog file #101.41
"RTN","ORMPS1",147,0)
 Q +$O(^ORD(101.41,"AB",$E("OR GTX "_NAME,1,63),0))
"RTN","ORMPS1",148,0)
 ;
"RTN","ORMPS1",149,0)
DURATION(X) ; -- Returns "# units" from U# format
"RTN","ORMPS1",150,0)
 N Y,Y1,Y2 I X'?.1U1.N Q ""
"RTN","ORMPS1",151,0)
 S Y1=$E(X),Y2=+$E(X,2,$L(X)) I X=+X S Y1="D",Y2=+X
"RTN","ORMPS1",152,0)
 S Y=Y2_" "_$S(Y1="L":"MONTH",Y1="W":"WEEK",Y1="H":"HOUR",Y1="M":"MINUTE",Y1="S":"SECOND",1:"DAY")_$S(Y2>1:"S",1:"")
"RTN","ORMPS1",153,0)
 Q Y
"RTN","ORMPS1",154,0)
 ;
"RTN","ORMPS1",155,0)
QT ; -- Unpiece the Q/T field from RXE
"RTN","ORMPS1",156,0)
 I 'RXE S ORQT(1)=ORQT,ORQT=1 Q  ; nothing to reset
"RTN","ORMPS1",157,0)
 N X,Y,I,J,P,SEG,DONE K ORQT
"RTN","ORMPS1",158,0)
 S SEG=$G(@ORMSG@(+RXE)),X=$P(SEG,"|",2),(I,J,P,DONE)=0
"RTN","ORMPS1",159,0)
 F  D  Q:DONE
"RTN","ORMPS1",160,0)
 . S P=P+1,Y=$P(X,"~",P) I Y="" S DONE=1 Q
"RTN","ORMPS1",161,0)
 . I P<$L(X,"~") S I=I+1,ORQT(I)=Y Q
"RTN","ORMPS1",162,0)
 . I $L(SEG,"|")>2 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",163,0)
 . S J=+$O(@ORMSG@(+RXE,J)) I J'>0 S I=I+1,ORQT(I)=Y,DONE=1 Q
"RTN","ORMPS1",164,0)
 . S SEG=$G(@ORMSG@(+RXE,J)),X=$P(SEG,"|"),P=1,I=I+1,ORQT(I)=Y_$P(X,"~")
"RTN","ORMPS1",165,0)
 S ORQT=I Q:'ORQT  ; else reset ORSTRT, ORSTOP, ORURG
"RTN","ORMPS1",166,0)
 S ORSTRT=$P(ORQT(1),U,4),ORSTOP=$P(ORQT(ORQT),U,5),ORURG=$P(ORQT(1),U,6)
"RTN","ORMPS1",167,0)
 S:ORSTRT ORSTRT=$$FMDATE^ORM(ORSTRT) S:ORSTOP ORSTOP=$$FMDATE^ORM(ORSTOP) S:$L(ORURG) ORURG=$$URGENCY^ORM(ORURG)
"RTN","ORMPS1",168,0)
 Q
"RTN","ORWDXM2")
0^6^B60322989
"RTN","ORWDXM2",1,0)
ORWDXM2 ; SLC/KCM - Quick Orders ;11/25/02  09:49
"RTN","ORWDXM2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,116,132,158**;Dec 17, 1997
"RTN","ORWDXM2",3,0)
 ;
"RTN","ORWDXM2",4,0)
CLRRCL(OK)      ; clear ORECALL
"RTN","ORWDXM2",5,0)
 S OK=1
"RTN","ORWDXM2",6,0)
 K ^TMP("ORECALL",$J),^TMP("ORWDXMQ",$J)
"RTN","ORWDXM2",7,0)
 Q
"RTN","ORWDXM2",8,0)
VERTXT ; set verify text for order
"RTN","ORWDXM2",9,0)
 N SEQ,DA,X,PROMPT,MULT,CHILD,INST,TITLE,ILST,SPACES
"RTN","ORWDXM2",10,0)
 S ILST=0,$P(SPACES," ",31)=""
"RTN","ORWDXM2",11,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ)) Q:SEQ'>0  D
"RTN","ORWDXM2",12,0)
 . S DA=0 F  S DA=$O(^ORD(101.41,+ORDIALOG,10,"B",SEQ,DA)) Q:'DA  D
"RTN","ORWDXM2",13,0)
 . . S X0=$G(^ORD(101.41,+ORDIALOG,10,DA,0))
"RTN","ORWDXM2",14,0)
 . . Q:$P(X0,U,9)["*"  ; hidden prompt
"RTN","ORWDXM2",15,0)
 . . S PROMPT=$P(X0,U,2),MULT=$P(X0,U,7),CHILD=$P(X0,U,11) Q:CHILD
"RTN","ORWDXM2",16,0)
 . . Q:'PROMPT  S INST=$O(ORDIALOG(PROMPT,0)) Q:'INST  ; no values
"RTN","ORWDXM2",17,0)
 . . S TITLE=$S($L($G(ORDIALOG(PROMPT,"TTL"))):ORDIALOG(PROMPT,"TTL"),1:ORDIALOG(PROMPT,"A"))
"RTN","ORWDXM2",18,0)
 . . I $E(ORDIALOG(PROMPT,0))="W" D
"RTN","ORWDXM2",19,0)
 . . . N IWP,WP,CNT
"RTN","ORWDXM2",20,0)
 . . . S IWP=0,CNT=0
"RTN","ORWDXM2",21,0)
 . . . F  S IWP=$O(^TMP("ORWORD",$J,PROMPT,INST,IWP)) Q:'IWP  D
"RTN","ORWDXM2",22,0)
 . . . . S CNT=CNT+1,WP(CNT)=^TMP("ORWORD",$J,PROMPT,INST,IWP,0)
"RTN","ORWDXM2",23,0)
 . . . I CNT=1,($L(WP(1))'>40) S ILST=ILST+1,LST(ILST)=$J(TITLE,30)_WP(1)
"RTN","ORWDXM2",24,0)
 . . . I CNT>1 D 
"RTN","ORWDXM2",25,0)
 . . . . S ILST=ILST+1,LST(ILST)=TITLE,IWP=0
"RTN","ORWDXM2",26,0)
 . . . . F  S IWP=$O(WP(IWP)) Q:'IWP  S ILST=ILST+1,LST(ILST)=WP(IWP)
"RTN","ORWDXM2",27,0)
 . . E  D
"RTN","ORWDXM2",28,0)
 . . . S ILST=ILST+1,LST(ILST)=$J(TITLE,30)
"RTN","ORWDXM2",29,0)
 . . . S LST(ILST)=LST(ILST)_$$ITEM^ORCDLG(PROMPT,INST)
"RTN","ORWDXM2",30,0)
 . . Q:'MULT  Q:'$O(ORDIALOG(PROMPT,INST))  ; done
"RTN","ORWDXM2",31,0)
 . . F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:INST'>0  S ILST=ILST+1,LST(ILST)=SPACES_$$ITEM^ORCDLG(PROMPT,INST)
"RTN","ORWDXM2",32,0)
 Q
"RTN","ORWDXM2",33,0)
RA ; setup environment for radiology
"RTN","ORWDXM2",34,0)
 ; -- get imaging types based on display group of quick order and
"RTN","ORWDXM2",35,0)
 ;    setup list of imaging locations based on imaging type
"RTN","ORWDXM2",36,0)
 N ORY,ITYPE,IFN,CNT,ORIMLOC,PROMPT
"RTN","ORWDXM2",37,0)
 S ORDIV=$$DIV^ORCDRA1,ITYPE=$P($G(^ORD(100.98,+ORDG,0)),U,3)
"RTN","ORWDXM2",38,0)
 S ORIMTYPE=$O(^RA(79.2,"C",ITYPE,0))
"RTN","ORWDXM2",39,0)
 D EN4^RAO7PC1(ITYPE,"ORY")
"RTN","ORWDXM2",40,0)
 S (IFN,CNT)=0 F  S IFN=$O(ORY(IFN)) Q:IFN'>0  D
"RTN","ORWDXM2",41,0)
 . S CNT=CNT+1,ORIMLOC(CNT)=ORY(IFN),ORIMLOC("B",$P(ORY(IFN),U,2))=IFN
"RTN","ORWDXM2",42,0)
 I '$$GET^XPAR("ALL","RA SUBMIT PROMPT",1,"Q"),CNT>1 K ORIMLOC
"RTN","ORWDXM2",43,0)
 E  S ORIMLOC=CNT_"^1"
"RTN","ORWDXM2",44,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX IMAGING LOCATION",0))
"RTN","ORWDXM2",45,0)
 I $G(ORIMLOC) M ORDIALOG(PROMPT,"LIST")=ORIMLOC
"RTN","ORWDXM2",46,0)
 Q
"RTN","ORWDXM2",47,0)
LR ; setup environment for lab
"RTN","ORWDXM2",48,0)
 ; -- setup ORTIME, ORIMTIME & ORTEST arrays
"RTN","ORWDXM2",49,0)
 ;    setup ORMAX, ORDG, & ORCOLLCT variables
"RTN","ORWDXM2",50,0)
 N PROMPT,INST,EDITONLY
"RTN","ORWDXM2",51,0)
 D GETIMES^ORCDLR1  ; sets up ORTIME and ORIMTIME arrays
"RTN","ORWDXM2",52,0)
 S ORMAX=$$GET^XPAR("ALL^LOC.`"_+ORL,"LR MAX DAYS CONTINUOUS",1,"Q")
"RTN","ORWDXM2",53,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0)),INST=1
"RTN","ORWDXM2",54,0)
 D LRTEST           ; sets up ORTEST array and ORDG
"RTN","ORWDXM2",55,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX COLLECTION TYPE",0))
"RTN","ORWDXM2",56,0)
 I $D(ORDIALOG(PROMPT,1)) S ORCOLLCT=ORDIALOG(PROMPT,1) I 1
"RTN","ORWDXM2",57,0)
 E  S EDITONLY=0,ORCOLLCT=$$COLLTYPE^ORCDLR1
"RTN","ORWDXM2",58,0)
 I ORCOLLCT="I" D
"RTN","ORWDXM2",59,0)
 . S PROMPT=$O(^ORD(101.41,"AB","OR GTX START DATE/TIME",0))
"RTN","ORWDXM2",60,0)
 . D LRICTMOK
"RTN","ORWDXM2",61,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ADMIN SCHEDULE",0))
"RTN","ORWDXM2",62,0)
 I $D(ORDIALOG(PROMPT,1)) S ORSCH=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",63,0)
 Q
"RTN","ORWDXM2",64,0)
LRTEST ; -- Setup ORTEST() array of ordering parameters (copied from ORCDLR)
"RTN","ORWDXM2",65,0)
 N OI,TST,DG
"RTN","ORWDXM2",66,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:'OI
"RTN","ORWDXM2",67,0)
 I '$D(ORTEST) S TST=+$P($G(^ORD(101.43,OI,0)),U,2) D TEST^LR7OR3(TST,.ORTEST) S ORTEST=TST
"RTN","ORWDXM2",68,0)
 S DG=$P($G(^ORD(101.43,+OI,"LR")),U,6) S:'$L(DG) DG="LAB"
"RTN","ORWDXM2",69,0)
 S DG=$O(^ORD(100.98,"B",DG,0)) S:DG ORDG=DG
"RTN","ORWDXM2",70,0)
 Q
"RTN","ORWDXM2",71,0)
LRRQCM()        ; return true if lab test has required comments
"RTN","ORWDXM2",72,0)
 I $O(^TMP("ORWORD",$J,PROMPT,INST,0)) Q 1 ; edit via WP
"RTN","ORWDXM2",73,0)
 N LRTEST,LRSAMP,LRSPEC,LRTSTN,LRTCOM,LRCCOM,DA,CNT,I,REQDCOMM,OI,TST
"RTN","ORWDXM2",74,0)
 S LRSAMP=$$VAL^ORCD("COLLECTION SAMPLE"),LRSPEC=$$VAL^ORCD("SPECIMEN")
"RTN","ORWDXM2",75,0)
 S OI=+$G(ORDIALOG(PROMPT,INST)) Q:'OI 0
"RTN","ORWDXM2",76,0)
 I '$D(ORTEST) S TST=+$P($G(^ORD(101.43,OI,0)),U,2) D TEST^LR7OR3(TST,.ORTEST) S ORTEST=TST
"RTN","ORWDXM2",77,0)
 S LRTSTN=1,LRTEST(1)=+ORTEST,DA=$O(^LAB(60,LRTEST(1),3,"B",+LRSAMP,0))
"RTN","ORWDXM2",78,0)
 S REQDCOMM=$P($G(^LAB(60,LRTEST(1),3,+DA,0)),U,6)
"RTN","ORWDXM2",79,0)
 S:'REQDCOMM REQDCOMM=+$P($G(^LAB(60,LRTEST(1),0)),U,19)
"RTN","ORWDXM2",80,0)
 Q REQDCOMM
"RTN","ORWDXM2",81,0)
LRASMP()       ; return true to ask collection sample (from ASKSAMP^ORCDLR)
"RTN","ORWDXM2",82,0)
 N DEFSAMP,SAMP0
"RTN","ORWDXM2",83,0)
 S DEFSAMP=$G(ORDIALOG(PROMPT,INST)),SAMP0=$G(^LAB(62,+DEFSAMP,0))
"RTN","ORWDXM2",84,0)
 I (ORCOLLCT="LC")!(ORCOLLCT="I"),$G(ORTEST("Lab CollSamp")) Q 0
"RTN","ORWDXM2",85,0)
 I $G(ORTEST("Unique CollSamp")),DEFSAMP Q 0 ; unique -> don't ask
"RTN","ORWDXM2",86,0)
 I 'DEFSAMP!('FIRST) Q 1 ; no default or edit -> ask
"RTN","ORWDXM2",87,0)
 I $G(ORDIALOG(PROMPT,"LIST"))="1^1" Q 0 ; only one choice
"RTN","ORWDXM2",88,0)
 Q 1
"RTN","ORWDXM2",89,0)
LRICTMOK        ;
"RTN","ORWDXM2",90,0)
 Q:'$D(ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",91,0)
 N ORY
"RTN","ORWDXM2",92,0)
 D VALDT^ORWU(.ORY,ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",93,0)
 I +$$VALID^LR7OV4(DUZ(2),ORY)=0 S ORDIALOG(PROMPT,1)=""
"RTN","ORWDXM2",94,0)
 Q
"RTN","ORWDXM2",95,0)
DO ; setup environment for diet order
"RTN","ORWDXM2",96,0)
 ; partially copied from EN^ORCDFH
"RTN","ORWDXM2",97,0)
 I ORCAT'="I" D  Q
"RTN","ORWDXM2",98,0)
 . S ORQUIT=1
"RTN","ORWDXM2",99,0)
 . S LST(0)="8^0"
"RTN","ORWDXM2",100,0)
 . S LST(.5)="Diet orders allowed for inpatients only."
"RTN","ORWDXM2",101,0)
 D EN^FHWOR8(+ORVP,.ORPARAM)          ; set FH ordering parameters
"RTN","ORWDXM2",102,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T" ; for now
"RTN","ORWDXM2",103,0)
 N PROMPT,OI                          ; set NPO flag if NPO diet
"RTN","ORWDXM2",104,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",105,0)
 S OI=+$G(ORDIALOG(PROMPT,1))
"RTN","ORWDXM2",106,0)
 S ORNPO=($P($G(^ORD(101.43,OI,0)),U)="NPO")
"RTN","ORWDXM2",107,0)
 Q
"RTN","ORWDXM2",108,0)
EL ; setup environment for early/late tray
"RTN","ORWDXM2",109,0)
 D EN^FHWOR8(+ORVP,.ORPARAM)          ; set FH ordering parameters
"RTN","ORWDXM2",110,0)
 S:'$L($G(ORPARAM(3))) ORPARAM(3)="T" ; for now
"RTN","ORWDXM2",111,0)
 D EN2^ORCDFH                         ; setup ORTIME array
"RTN","ORWDXM2",112,0)
 N PROMPT                             ; set ORMEAL,ORTRAY
"RTN","ORWDXM2",113,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX MEAL",0))
"RTN","ORWDXM2",114,0)
 I $D(ORDIALOG(PROMPT,1)) S ORMEAL=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",115,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",116,0)
 I $D(ORDIALOG(PROMPT,1)) S ORTRAY=ORDIALOG(PROMPT,1)
"RTN","ORWDXM2",117,0)
 Q
"RTN","ORWDXM2",118,0)
UD ; setup environment for unit dose med
"RTN","ORWDXM2",119,0)
 I $G(ORWP94) G PS^ORWDPS3  ; if patch 94 installed
"RTN","ORWDXM2",120,0)
 ;
"RTN","ORWDXM2",121,0)
 D AUTHMED Q:$G(ORQUIT)  ; checks authorized to write meds
"RTN","ORWDXM2",122,0)
 N PROMPT,OI
"RTN","ORWDXM2",123,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",124,0)
 I $D(ORDIALOG(PROMPT,1)) S OI=ORDIALOG(PROMPT,1) D MEDACTV(1) Q:$G(ORQUIT)
"RTN","ORWDXM2",125,0)
 D INSTR^ORCDPS(OI)      ; sets up instructions, routes, etc.
"RTN","ORWDXM2",126,0)
 D CHOICES^ORCDPS("U")   ; gets list of dispense drugs       
"RTN","ORWDXM2",127,0)
 Q
"RTN","ORWDXM2",128,0)
IV ; setup environment for IV fluid
"RTN","ORWDXM2",129,0)
 D AUTHMED Q:$G(ORQUIT)  ; checks authorized to write meds
"RTN","ORWDXM2",130,0)
 ; sets up list of volumes if only one solution
"RTN","ORWDXM2",131,0)
 ; otherwise, let the dialog go interactive
"RTN","ORWDXM2",132,0)
 N PROMPT,INST,CNT,OI
"RTN","ORWDXM2",133,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",134,0)
 S (CNT,INST)=0
"RTN","ORWDXM2",135,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D  Q:$G(ORQUIT)
"RTN","ORWDXM2",136,0)
 . S CNT=CNT+1
"RTN","ORWDXM2",137,0)
 . S OI=ORDIALOG(PROMPT,INST) D MEDACTV(3) ; check active solutions
"RTN","ORWDXM2",138,0)
 I CNT=1 S INST=1 D VOLUME^ORCDPSIV
"RTN","ORWDXM2",139,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ADDITIVE",0))
"RTN","ORWDXM2",140,0)
 S INST=0
"RTN","ORWDXM2",141,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  D  Q:$G(ORQUIT)
"RTN","ORWDXM2",142,0)
 . S OI=ORDIALOG(PROMPT,INST) D MEDACTV(4) ; check active additives
"RTN","ORWDXM2",143,0)
 Q
"RTN","ORWDXM2",144,0)
OP ; setup environment for outpatient pharmacy
"RTN","ORWDXM2",145,0)
 I $G(ORWP94) G PS^ORWDPS3  ; if patch 94 installed
"RTN","ORWDXM2",146,0)
 ;
"RTN","ORWDXM2",147,0)
 D AUTHMED Q:$G(ORQUIT)       ; checks authorized to write meds
"RTN","ORWDXM2",148,0)
 N PROMPT,INST,CNT,OI
"RTN","ORWDXM2",149,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX ORDERABLE ITEM",0))
"RTN","ORWDXM2",150,0)
 I $D(ORDIALOG(PROMPT,1)) S OI=ORDIALOG(PROMPT,1) D MEDACTV(2) Q:$G(ORQUIT)
"RTN","ORWDXM2",151,0)
 D INSTR^ORCDPS(OI)           ; sets up instructions, routes, etc.
"RTN","ORWDXM2",152,0)
 D CHOICES^ORCDPS("O")        ; gets list of dispense drugs      
"RTN","ORWDXM2",153,0)
 ; get defaults for drug, refills if only one dispense drug
"RTN","ORWDXM2",154,0)
 S PROMPT=$O(^ORD(101.41,"AB","OR GTX DISPENSE DRUG",0))
"RTN","ORWDXM2",155,0)
 S (CNT,INST)=0
"RTN","ORWDXM2",156,0)
 F  S INST=$O(ORDIALOG(PROMPT,INST)) Q:'INST  S CNT=CNT+1
"RTN","ORWDXM2",157,0)
 I CNT=1 D
"RTN","ORWDXM2",158,0)
 . S ORDRUG=+$G(ORDIALOG(PROMPT,1)),ORCOMPLX=0
"RTN","ORWDXM2",159,0)
 . S OREFILLS=$P($G(ORDIALOG(PROMPT,"LIST","D",ORDRUG)),U,3)
"RTN","ORWDXM2",160,0)
 . S:'$L(OREFILLS) OREFILLS=11
"RTN","ORWDXM2",161,0)
 E  S ORCOMPLX=1,OREFILLS=11  ; force interactive on complex order
"RTN","ORWDXM2",162,0)
 S ORCOPAY=1                  ; ask SC if can't determine copay
"RTN","ORWDXM2",163,0)
 I $G(ORDRUG),$L($T(ASKSC^ORCDPS)) S ORCOPAY=$$ASKSC^ORCDPS
"RTN","ORWDXM2",164,0)
 Q
"RTN","ORWDXM2",165,0)
AUTHMED ; sets ORQUIT if not authorized to write meds
"RTN","ORWDXM2",166,0)
 N NOAUTH,NAME
"RTN","ORWDXM2",167,0)
 D AUTH^ORWDPS32(.NOAUTH,ORNP)
"RTN","ORWDXM2",168,0)
 I +NOAUTH D
"RTN","ORWDXM2",169,0)
 . S ORQUIT=1
"RTN","ORWDXM2",170,0)
 . S LST(0)="8^0"
"RTN","ORWDXM2",171,0)
 . S NAME=$P($G(^VA(200,+ORNP,20)),U,2)
"RTN","ORWDXM2",172,0)
 . I '$L(NAME) S NAME=$P($G(^VA(200,+ORNP,0)),U,1)
"RTN","ORWDXM2",173,0)
 . S LST(.5)=NAME_" is not authorized to write med orders."
"RTN","ORWDXM2",174,0)
 Q
"RTN","ORWDXM2",175,0)
MEDACTV(USAGE) ; sets ORQUIT if the orderable item is not active for a med
"RTN","ORWDXM2",176,0)
 Q:'$G(OI)  S USAGE=+$G(USAGE)
"RTN","ORWDXM2",177,0)
 I $G(^ORD(101.43,OI,.1)),^(.1)'>$$NOW^XLFDT D  Q
"RTN","ORWDXM2",178,0)
 . S ORQUIT=1,LST(0)="8^0"
"RTN","ORWDXM2",179,0)
 . S LST(.5)=$P($G(^ORD(101.43,OI,0)),U)_" has been inactivated and may not be ordered anymore."
"RTN","ORWDXM2",180,0)
 I USAGE,'$P($G(^ORD(101.43,OI,"PS")),U,USAGE) D  Q
"RTN","ORWDXM2",181,0)
 . S ORQUIT=1,LST(0)="8^0"
"RTN","ORWDXM2",182,0)
 . S LST(.5)=$P($G(^ORD(101.43,OI,0)),U)_" may not be ordered as an "_$S(USAGE=1:"inpatient medication",USAGE=2:"outpatient medication",USAGE=3:"IV solution",1:"IV additive")_" anymore."
"RTN","ORWDXM2",183,0)
 Q
"RTN","ORWDXM2",184,0)
SCHEDULD() ; Is patient scheduled for PREOP (Imaging)
"RTN","ORWDXM2",185,0)
 I $G(ORDIALOG(PROMPT,1)) Q 1 ; don't ask - already have date
"RTN","ORWDXM2",186,0)
 E  Q 0
"RTN","ORWDXM2",187,0)
 Q
"RTN","ORX2")
0^4^B8983250
"RTN","ORX2",1,0)
ORX2 ; slc/dcm - OE/RR Patient lock entry points ;11/25/02  09:51
"RTN","ORX2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**16,48,158**;Dec 17, 1997
"RTN","ORX2",3,0)
PT1 ;;Entry point to unlock patient when done adding orders - NO LONGER USED
"RTN","ORX2",4,0)
 ;;Required variable ORVP.
"RTN","ORX2",5,0)
 Q:'$D(ORVP)  Q:'$L(ORVP)  Q:ORVP'["DPT("
"RTN","ORX2",6,0)
 D UNLOCK(+ORVP) K ORPTLK,ORELK
"RTN","ORX2",7,0)
 Q
"RTN","ORX2",8,0)
LK ;;Entry point for locking patient when updating orders
"RTN","ORX2",9,0)
 ;;Entry: X=VP to Patient "DFN;DPT("  Exit: Y=1 if lock succeeds
"RTN","ORX2",10,0)
 Q:'$D(X)  Q:'$L(X)  Q:X'["DPT("  Q:'$D(@("^"_$P(X,";",2)_+X_",0)"))
"RTN","ORX2",11,0)
 S Y=$$LOCK(+X) Q:Y
"RTN","ORX2",12,0)
 W !!,$C(7),$P(Y,U,2) D READ
"RTN","ORX2",13,0)
 S Y=0 K X
"RTN","ORX2",14,0)
 Q
"RTN","ORX2",15,0)
ULK ;;Entry point to unlock patient
"RTN","ORX2",16,0)
 ;;Required variable X=VP to patient.
"RTN","ORX2",17,0)
 Q:'$D(X)  Q:'$L(X)  Q:X'["DPT("  Q:'$D(@("^"_$P(X,";",2)_+X_",0)"))
"RTN","ORX2",18,0)
 D UNLOCK(+X)
"RTN","ORX2",19,0)
 Q
"RTN","ORX2",20,0)
 ;
"RTN","ORX2",21,0)
LOCK(DFN) ; -- Lock patient chart (silent)
"RTN","ORX2",22,0)
 ; Returns 1 if successful, or 0^Message if could not get lock
"RTN","ORX2",23,0)
 ;
"RTN","ORX2",24,0)
 Q:'$G(DFN) "0^Invalid patient" N Y,ORLK,NOW,NOW1
"RTN","ORX2",25,0)
 S ORLK=$G(^XTMP("ORPTLK-"_DFN,1)) Q:ORLK=(DUZ_U_$J) 1 ;locked
"RTN","ORX2",26,0)
 L +^XTMP("ORPTLK-"_DFN):1 I '$T S Y="0^"_$S(+ORLK:$P($G(^VA(200,+ORLK,0)),U),1:"Another person")_" is editing orders for this patient." Q Y
"RTN","ORX2",27,0)
 S NOW=$$NOW^XLFDT,NOW1=$$FMADD^XLFDT(NOW,1)
"RTN","ORX2",28,0)
 S ^XTMP("ORPTLK-"_DFN,0)=NOW1_U_NOW_"^CPRS Chart Lock",^(1)=DUZ_U_$J
"RTN","ORX2",29,0)
 Q 1
"RTN","ORX2",30,0)
 ;
"RTN","ORX2",31,0)
UNLOCK(DFN) ; -- Unlock patient chart (silent)
"RTN","ORX2",32,0)
 L -^XTMP("ORPTLK-"_DFN)
"RTN","ORX2",33,0)
 I $G(^XTMP("ORPTLK-"_DFN,1))=(DUZ_U_$J) K ^XTMP("ORPTLK-"_DFN)
"RTN","ORX2",34,0)
 Q
"RTN","ORX2",35,0)
 ;
"RTN","ORX2",36,0)
INC(IFN) ;Increment zero node on file 100.2
"RTN","ORX2",37,0)
 N X,X3,X4
"RTN","ORX2",38,0)
 Q:'$G(IFN) 1 Q:$D(^OR(100.2,IFN)) 1
"RTN","ORX2",39,0)
 L +^OR(100.2,0):5 I '$T Q 0
"RTN","ORX2",40,0)
 S:'$D(^OR(100.2,0)) ^(0)="OE/RR PATIENT^100.2P" S X=^(0)
"RTN","ORX2",41,0)
 S X4=+$P(X,U,4)+1,X3=$S(IFN>$P(X,U,3):IFN,1:$P(X,U,3))
"RTN","ORX2",42,0)
 S $P(^OR(100.2,0),U,3,4)=X3_U_X4
"RTN","ORX2",43,0)
 L -^OR(100.2,0)
"RTN","ORX2",44,0)
 Q 1
"RTN","ORX2",45,0)
 ;
"RTN","ORX2",46,0)
LOCK1(ORDER) ; -- Lock ORDER in file #100
"RTN","ORX2",47,0)
 ; Returns 1 if successful or 0^Message if could not get lock
"RTN","ORX2",48,0)
 ;
"RTN","ORX2",49,0)
 N X,Y,NOW,NOW1 I '$G(ORDER) Q "0^Invalid order number"
"RTN","ORX2",50,0)
 L +^OR(100,+ORDER):1 I '$T S X=+$G(^XTMP("ORLK-"_+ORDER,1)),Y="0^"_$S(X:$P($G(^VA(200,X,0)),U),1:"Another person")_" is working on this order." Q Y
"RTN","ORX2",51,0)
 S Y=+$P($G(^OR(100,+ORDER,3)),U,6) I Y,$P($G(^OR(100,Y,3)),U,3)=11 D  Q Y
"RTN","ORX2",52,0)
 . S X=$S($P(^OR(100,Y,3),U,11)=2:"renewal",1:"edit")
"RTN","ORX2",53,0)
 . S Y="0^An unreleased "_X_" exists for this order." L -^OR(100,+ORDER)
"RTN","ORX2",54,0)
 S NOW=$$NOW^XLFDT,NOW1=$$FMADD^XLFDT(NOW,1)
"RTN","ORX2",55,0)
 S ^XTMP("ORLK-"_+ORDER,0)=NOW1_U_NOW_"^CPRS Order Lock",^(1)=DUZ_U_$J
"RTN","ORX2",56,0)
 Q 1
"RTN","ORX2",57,0)
 ;
"RTN","ORX2",58,0)
UNLK1(ORDER) ; -- Unlock ORDER in file #100
"RTN","ORX2",59,0)
 L -^OR(100,+$G(ORDER)) K ^XTMP("ORLK-"_+ORDER)
"RTN","ORX2",60,0)
 Q
"RTN","ORX2",61,0)
 ;
"RTN","ORX2",62,0)
READ ; -- instead of READ^ORUTL
"RTN","ORX2",63,0)
 N X,Y,DIR
"RTN","ORX2",64,0)
 S DIR(0)="EA",DIR("A")="     Press return to continue  "
"RTN","ORX2",65,0)
 D ^DIR
"RTN","ORX2",66,0)
 Q
"RTN","ORY158")
0^7^B19822316
"RTN","ORY158",1,0)
ORY158 ;SLC/DAN ;11/14/02  08:36
"RTN","ORY158",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**158**;Dec 17, 1997
"RTN","ORY158",3,0)
 ;DBIA 2058 allows read of B xref in DIC(9.4
"RTN","ORY158",4,0)
 ;DBIA 2197 allows reading of install file
"RTN","ORY158",5,0)
 ;
"RTN","ORY158",6,0)
POST ;Find child entries with a provider of 0 and update it to the correct provider
"RTN","ORY158",7,0)
 ;
"RTN","ORY158",8,0)
 N ORMSG,ZTSK,ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSAVE
"RTN","ORY158",9,0)
 S ORMSG(1)="This patch contains a post-init which will run in the background and fix"
"RTN","ORY158",10,0)
 S ORMSG(2)="any known database errors.  It will then send a mail message to the"
"RTN","ORY158",11,0)
 S ORMSG(3)="initiator indicating what was changed."
"RTN","ORY158",12,0)
 D BMES^XPDUTL(.ORMSG)
"RTN","ORY158",13,0)
 S ZTRTN="DQ^ORY158",ZTDESC="Patch OR*3*158 database clean up",ZTIO="",ZTSAVE("DUZ")="",ZTDTH=$H
"RTN","ORY158",14,0)
 D ^%ZTLOAD
"RTN","ORY158",15,0)
 I $G(ZTSK) D BMES^XPDUTL("Post-init queued to background as task number "_ZTSK_".")
"RTN","ORY158",16,0)
 Q
"RTN","ORY158",17,0)
 ;
"RTN","ORY158",18,0)
DQ ;Enter here for queued task
"RTN","ORY158",19,0)
 N ERR,CNT
"RTN","ORY158",20,0)
 K ^TMP("ORFIX",$J)
"RTN","ORY158",21,0)
 D UPDATE,MAIL
"RTN","ORY158",22,0)
 K ^TMP("ORFIX",$J)
"RTN","ORY158",23,0)
 Q
"RTN","ORY158",24,0)
 ;
"RTN","ORY158",25,0)
UPDATE ;
"RTN","ORY158",26,0)
 N DATE,IEN,PARENT,PROV,PKG,PKGNUM
"RTN","ORY158",27,0)
 S DATE=$$INSTDT("ORDER ENTRY/RESULTS REPORTING 3.0")
"RTN","ORY158",28,0)
 S DATE=$S(DATE:$$FMADD^XLFDT(DATE,-1,23,59),1:2960630.24) ;If install date not found revert back to 1st possible install date
"RTN","ORY158",29,0)
 S IEN=$$GETIEN(DATE)-1 ;Get first order number for date, subtract one so the first order is reviewed
"RTN","ORY158",30,0)
 I IEN=-1 S ERR="No orders in date range" Q  ;No orders to review
"RTN","ORY158",31,0)
 S CNT=0
"RTN","ORY158",32,0)
 F  S IEN=$O(^OR(100,IEN)) Q:'+IEN  D
"RTN","ORY158",33,0)
 .Q:+$P(^OR(100,IEN,0),U,4)'=0  ;Quit if order is ok (provider '= 0)
"RTN","ORY158",34,0)
 .S PKGNUM=$P(^OR(100,IEN,0),U,14)
"RTN","ORY158",35,0)
 .S PKG=$E($$NMSP^ORCD(PKGNUM),1,2) ;Get first two characters of Package
"RTN","ORY158",36,0)
 .I PKG="LR"&($P(^OR(100,IEN,0),U,2)'["DPT") Q  ;Stop if lab and not from patient file
"RTN","ORY158",37,0)
 .I PKG="LR"!(PKG="PS") D  Q  ;If package lab or pharmacy then check
"RTN","ORY158",38,0)
 ..S PROV=$$CHKPAR
"RTN","ORY158",39,0)
 ..I PROV D
"RTN","ORY158",40,0)
 ...S ^TMP("ORFIX",$J,PKGNUM,IEN)=" - FIXED"
"RTN","ORY158",41,0)
 ...S $P(^OR(100,IEN,0),U,4)=PROV
"RTN","ORY158",42,0)
 ...S CNT=CNT+1
"RTN","ORY158",43,0)
 ...D CHKACT ;Check actions to be sure they have provider entered
"RTN","ORY158",44,0)
 Q
"RTN","ORY158",45,0)
 ;
"RTN","ORY158",46,0)
CHKPAR() ;Check to see if there is a parent order and if so, return provider
"RTN","ORY158",47,0)
 S PARENT=$P(^OR(100,IEN,3),U,9)
"RTN","ORY158",48,0)
 I '+PARENT Q 0  ;No parent order found
"RTN","ORY158",49,0)
 S PROV=$P(^OR(100,PARENT,0),U,4)
"RTN","ORY158",50,0)
 I '+PROV Q 0  ;No provider found in parent order
"RTN","ORY158",51,0)
 Q PROV
"RTN","ORY158",52,0)
 ;
"RTN","ORY158",53,0)
CHKACT ;Check actions for missing provider as well
"RTN","ORY158",54,0)
 N I
"RTN","ORY158",55,0)
 S I=0 F  S I=$O(^OR(100,IEN,8,I)) Q:'+I  D
"RTN","ORY158",56,0)
 .I $P(^OR(100,IEN,8,I,0),U,3)=0 S $P(^(0),U,3)=PROV
"RTN","ORY158",57,0)
 Q
"RTN","ORY158",58,0)
GETIEN(STDT) ;Find first IEN associated with given start date
"RTN","ORY158",59,0)
 N DONE,IEN
"RTN","ORY158",60,0)
 S (DONE,IEN)=0
"RTN","ORY158",61,0)
 F  S STDT=$O(^OR(100,"AF",STDT)) Q:'+STDT!(DONE)  D
"RTN","ORY158",62,0)
 .S IEN=0 F  S IEN=$O(^OR(100,"AF",STDT,IEN)) Q:'+IEN  I $O(^(IEN,0))=1 S DONE=1 Q  ;Find first ORDER that is a new order
"RTN","ORY158",63,0)
 Q IEN
"RTN","ORY158",64,0)
 ;
"RTN","ORY158",65,0)
MAIL ;Send results of cleanup in a mail message to initiator
"RTN","ORY158",66,0)
 N I,XMSUB,XMTEXT,XMDUZ,XMY,PKG,ORD
"RTN","ORY158",67,0)
 S XMSUB="Patch OR*3*158 Clean up completed"
"RTN","ORY158",68,0)
 S XMDUZ="Patch OR*3*158 Post-Init"
"RTN","ORY158",69,0)
 S XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","ORY158",70,0)
 S XMTEXT="^TMP(""ORTXT"",$J,"
"RTN","ORY158",71,0)
 K ^TMP("ORTXT",$J)
"RTN","ORY158",72,0)
 S I=1
"RTN","ORY158",73,0)
 S ^TMP("ORTXT",$J,I)="The database clean-up for patch OR*3*158 has completed.",I=I+1
"RTN","ORY158",74,0)
 S ^TMP("ORTXT",$J,I)="Below is a listing of what was changed and any possible error messages.",I=I+1
"RTN","ORY158",75,0)
 S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY158",76,0)
 S ^TMP("ORTXT",$J,I)=CNT_" orders had their provider field updated.",I=I+1
"RTN","ORY158",77,0)
 S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY158",78,0)
 I $D(ERR) D
"RTN","ORY158",79,0)
 .S ^TMP("ORTXT",$J,I)="An error occurred that stopped the post-init.  It was:",I=I+1
"RTN","ORY158",80,0)
 .S ^TMP("ORTXT",$J,I)=ERR,I=I+1
"RTN","ORY158",81,0)
 .S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY158",82,0)
 I '$D(ERR),'CNT S ^TMP("ORTXT",$J,I)="No changes were made to your database.",I=I+1
"RTN","ORY158",83,0)
 S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY158",84,0)
 S PKG=0 F  S PKG=$O(^TMP("ORFIX",$J,PKG)) Q:PKG=""  D
"RTN","ORY158",85,0)
 .S ^TMP("ORTXT",$J,I)=$P(^DIC(9.4,PKG,0),U),I=I+1
"RTN","ORY158",86,0)
 .S ORD=0 F  S ORD=$O(^TMP("ORFIX",$J,PKG,ORD)) Q:ORD=""  D
"RTN","ORY158",87,0)
 ..S ^TMP("ORTXT",$J,I)="   ORDER #: "_ORD_" "_^TMP("ORFIX",$J,PKG,ORD),I=I+1
"RTN","ORY158",88,0)
 .S ^TMP("ORTXT",$J,I)="",I=I+1
"RTN","ORY158",89,0)
 D ^XMD ;send results
"RTN","ORY158",90,0)
 K ^TMP("ORTXT",$J)
"RTN","ORY158",91,0)
 Q
"RTN","ORY158",92,0)
 ;
"RTN","ORY158",93,0)
INSTDT(PATCH) ;Returns installation date patch first installed at site
"RTN","ORY158",94,0)
 N IEN
"RTN","ORY158",95,0)
 S IEN=$O(^XPD(9.7,"B",PATCH,0)) Q:'+IEN 0 ;Get IEN of first installation
"RTN","ORY158",96,0)
 Q $P($P($G(^XPD(9.7,IEN,1)),U),".")  ;Get date of first install
"VER")
8.0^22.0
**END**
**END**
