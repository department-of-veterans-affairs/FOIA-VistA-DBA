Released QAN*2*32 SEQ #32
Extracted from mail message
**KIDS**:QAN*2.0*32^

**INSTALL NAME**
QAN*2.0*32
"BLD",7192,0)
QAN*2.0*32^INCIDENT REPORTING^0^3070424^y
"BLD",7192,1,0)
^^1^1^3070412^
"BLD",7192,1,1,0)
Patient ID fix
"BLD",7192,4,0)
^9.64PA^^
"BLD",7192,6.3)
3
"BLD",7192,"ABPKG")
n
"BLD",7192,"KRN",0)
^9.67PA^8989.52^19
"BLD",7192,"KRN",.4,0)
.4
"BLD",7192,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7192,"KRN",.401,0)
.401
"BLD",7192,"KRN",.402,0)
.402
"BLD",7192,"KRN",.403,0)
.403
"BLD",7192,"KRN",.5,0)
.5
"BLD",7192,"KRN",.84,0)
.84
"BLD",7192,"KRN",3.6,0)
3.6
"BLD",7192,"KRN",3.8,0)
3.8
"BLD",7192,"KRN",9.2,0)
9.2
"BLD",7192,"KRN",9.8,0)
9.8
"BLD",7192,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",7192,"KRN",9.8,"NM",1,0)
QANCDNT^^0^B69169477
"BLD",7192,"KRN",9.8,"NM",2,0)
QANEDIT^^0^B48416347
"BLD",7192,"KRN",9.8,"NM",3,0)
QANQUCK^^0^B18124111
"BLD",7192,"KRN",9.8,"NM",4,0)
QANUTL^^0^B9972935
"BLD",7192,"KRN",9.8,"NM",5,0)
QANUTL1^^0^B31108266
"BLD",7192,"KRN",9.8,"NM","B","QANCDNT",1)

"BLD",7192,"KRN",9.8,"NM","B","QANEDIT",2)

"BLD",7192,"KRN",9.8,"NM","B","QANQUCK",3)

"BLD",7192,"KRN",9.8,"NM","B","QANUTL",4)

"BLD",7192,"KRN",9.8,"NM","B","QANUTL1",5)

"BLD",7192,"KRN",19,0)
19
"BLD",7192,"KRN",19,"NM",0)
^9.68A^^
"BLD",7192,"KRN",19.1,0)
19.1
"BLD",7192,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7192,"KRN",101,0)
101
"BLD",7192,"KRN",409.61,0)
409.61
"BLD",7192,"KRN",771,0)
771
"BLD",7192,"KRN",870,0)
870
"BLD",7192,"KRN",8989.51,0)
8989.51
"BLD",7192,"KRN",8989.52,0)
8989.52
"BLD",7192,"KRN",8994,0)
8994
"BLD",7192,"KRN","B",.4,.4)

"BLD",7192,"KRN","B",.401,.401)

"BLD",7192,"KRN","B",.402,.402)

"BLD",7192,"KRN","B",.403,.403)

"BLD",7192,"KRN","B",.5,.5)

"BLD",7192,"KRN","B",.84,.84)

"BLD",7192,"KRN","B",3.6,3.6)

"BLD",7192,"KRN","B",3.8,3.8)

"BLD",7192,"KRN","B",9.2,9.2)

"BLD",7192,"KRN","B",9.8,9.8)

"BLD",7192,"KRN","B",19,19)

"BLD",7192,"KRN","B",19.1,19.1)

"BLD",7192,"KRN","B",101,101)

"BLD",7192,"KRN","B",409.61,409.61)

"BLD",7192,"KRN","B",771,771)

"BLD",7192,"KRN","B",870,870)

"BLD",7192,"KRN","B",8989.51,8989.51)

"BLD",7192,"KRN","B",8989.52,8989.52)

"BLD",7192,"KRN","B",8994,8994)

"BLD",7192,"QUES",0)
^9.62^^
"BLD",7192,"REQB",0)
^9.611^3^1
"BLD",7192,"REQB",3,0)
QAN*2.0*30^1
"BLD",7192,"REQB","B","QAN*2.0*30",3)

"MBREQ")
0
"PKG",371,-1)
1^1
"PKG",371,0)
INCIDENT REPORTING^QAN^This package is designed to track a hospital incident.
"PKG",371,20,0)
^9.402P^^
"PKG",371,22,0)
^9.49I^1^1
"PKG",371,22,1,0)
2.0^2921015^2950914
"PKG",371,22,1,"PAH",1,0)
32^3070424
"PKG",371,22,1,"PAH",1,1,0)
^^1^1^3070424
"PKG",371,22,1,"PAH",1,1,1,0)
Patient ID fix
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","QANCDNT")
0^1^B69169477^B67281426
"RTN","QANCDNT",1,0)
QANCDNT ;HISC/GJC-Initial sighting of an incident ; 10/29/03 10:39am
"RTN","QANCDNT",2,0)
 ;;2.0;Incident Reporting;**1,9,14,27,26,28,29,30,32**;08/07/1992;Build 3
"RTN","QANCDNT",3,0)
 ;
"RTN","QANCDNT",4,0)
 ;
"RTN","QANCDNT",5,0)
 N QANQFLG
"RTN","QANCDNT",6,0)
 D NEWREC ;I $G(QANLOCK)=1 L -^QA(742.4) S QANLOCK=0 Q
"RTN","QANCDNT",7,0)
 D DIV
"RTN","QANCDNT",8,0)
 I $G(QANQFLG)=1 D DEL Q
"RTN","QANCDNT",9,0)
 D DIE
"RTN","QANCDNT",10,0)
 Q
"RTN","QANCDNT",11,0)
NEWREC ;create new record number
"RTN","QANCDNT",12,0)
 ;record number will be in the format XXX.YYnnnn where XXX is the
"RTN","QANCDNT",13,0)
 ;three digit station number, YY is the 2 digit year and nnnn is
"RTN","QANCDNT",14,0)
 ;the sequence number (and is also the IEN of file 742.4)
"RTN","QANCDNT",15,0)
 N EE,QANCNT,QANLIST,QANNO,QANQFLG
"RTN","QANCDNT",16,0)
 K QANLOCK
"RTN","QANCDNT",17,0)
 S (QANFLAG,QANXIT,QANOUT)=0,QANST=$S($D(^QA(740,1,0))#2:$P(^(0),"^"),1:""),QANST1=$S($D(^DIC(4,QANST,99))#2:$P(^(99),"^"),1:QANST)
"RTN","QANCDNT",18,0)
 S QANDUZ=$S($D(DUZ):DUZ,1:""),QANTTL=$P(^VA(200,QANDUZ,0),U,9)
"RTN","QANCDNT",19,0)
 ;set QANDT variable as "." concatonated with 2 digit year so that
"RTN","QANCDNT",20,0)
 ;years 2000-2009 don't have leading zeroes.
"RTN","QANCDNT",21,0)
 S QANDT=$S($D(DT):$E(DT,2,3),1:""),QANDT="."_QANDT
"RTN","QANCDNT",22,0)
 S QANINCR=+$P($G(^QA(742.4,0)),U,3)+1 ;Grab the new IEN
"RTN","QANCDNT",23,0)
 F  Q:$D(^QA(742.4,QANINCR,0))=0  S QANINCR=QANINCR+1
"RTN","QANCDNT",24,0)
 S QANCODE(0)=QANDT_QANINCR
"RTN","QANCDNT",25,0)
 I $L(QANINCR)<4 S QANCODE(0)=QANDT_$E("000",1,(4-$L(QANINCR)))_QANINCR
"RTN","QANCDNT",26,0)
 S QANCODE(1)=QANST1_QANCODE(0)
"RTN","QANCDNT",27,0)
 S QANCHK=$O(^QA(742.4,"B",QANCODE(1),0)) I +QANCHK,$D(^(QANCHK))#2 D  Q
"RTN","QANCDNT",28,0)
 . W !!,$C(7),"CASE NUMBER VIOLATION, CONTACT YOUR QA COORDINATOR!!"
"RTN","QANCDNT",29,0)
 . S QANXIT=1
"RTN","QANCDNT",30,0)
 . K QANST,QANST1,QANDT,QANCODE,QANINCR,QANFLAG,QANOUT,QANDUZ,QANCHK,QANTTL
"RTN","QANCDNT",31,0)
 I $G(QANXIT)=1 Q
"RTN","QANCDNT",32,0)
 K DIC,DD,DO,DLAYGO,DINUM S (DIC,DIE)="^QA(742.4,",DIC(0)="L",X=QANCODE(1)
"RTN","QANCDNT",33,0)
 D FILE^DICN
"RTN","QANCDNT",34,0)
 K DIC,DD,DO,DLAYGO,DINUM
"RTN","QANCDNT",35,0)
 L +^QA(742.4,+Y):3 I '$T W !!,"Another user is editing this incident." S QANLOCK=1 Q
"RTN","QANCDNT",36,0)
 S QANBFLG=1 ;set brief flag so that if this subroutine was called
"RTN","QANCDNT",37,0)
 ;from full incident edit you do not re-lock the record when you
"RTN","QANCDNT",38,0)
 ;get back to full incident edit.
"RTN","QANCDNT",39,0)
 Q:+Y<1  S QANIEN=+Y
"RTN","QANCDNT",40,0)
 S QANHOME=$G(^QA(742.4,QANIEN,0)),$P(QANHOME,U,5)=QANDUZ,$P(QANHOME,U,6)=QANTTL,$P(QANHOME,U,15)=1,$P(QANHOME,U,8)=1
"RTN","QANCDNT",41,0)
 K DA,DIK S DIK="^QA(742.4,",DA=QANIEN,^QA(742.4,QANIEN,0)=QANHOME D IX1^DIK K DA,DIK
"RTN","QANCDNT",42,0)
 Q
"RTN","QANCDNT",43,0)
DIV ;check to see if station is multi-divisional for Incid Reporting.  If
"RTN","QANCDNT",44,0)
 ;so, and there are hosp locations in file 740 (node "QAN2") then
"RTN","QANCDNT",45,0)
 ;prompt user for Division.
"RTN","QANCDNT",46,0)
 I $P($G(^QA(740,1,"QAN")),U,5)=1 S TEMPY=$G(Y) D  S Y=$G(TEMPY)
"RTN","QANCDNT",47,0)
 . W !!,"DIVISION: "
"RTN","QANCDNT",48,0)
 . S QANCNT=0 S QANLIST="S EE=0 F  S EE=$O(^QA(740,1,""QAN2"",EE)) Q:EE'>0  W !?5,EE,?10,$P(^DIC(4,$P(^QA(740,1,""QAN2"",EE,0),U),0),U) S QANCNT=QANCNT+1"
"RTN","QANCDNT",49,0)
LIST . S QANCNT=0 X QANLIST
"RTN","QANCDNT",50,0)
 . I $G(QANCNT)<1 W !?5,"There are no divisions entered in your QA Site Parameter File (#704).",!?5,"Ask your IRM support person to edit this file.  If your site"
"RTN","QANCDNT",51,0)
 . I $G(QANCNT)<1 W !?5,"is entered in file #740 as a MULTI-DIVISIONAL INCID REP FACILITY you need",!?5,"entries in the IR HOSPITAL DIVISION multiple."
"RTN","QANCDNT",52,0)
 . S DIR(0)="NA"
"RTN","QANCDNT",53,0)
 . S DIR("A")="Enter the number of your choice: "
"RTN","QANCDNT",54,0)
 . S DIR("?")="Choose the number of your division."
"RTN","QANCDNT",55,0)
 . S DIR("??")="^S X=QANCNT X QANLIST"
"RTN","QANCDNT",56,0)
 . D ^DIR
"RTN","QANCDNT",57,0)
 . I $G(Y)']""!($G(Y)="^") D
"RTN","QANCDNT",58,0)
 . . W !!?5,"You must enter a Division.",!
"RTN","QANCDNT",59,0)
 . . D ^DIR
"RTN","QANCDNT",60,0)
 . . I $G(Y)']""!($G(Y)="^") S QANQFLG=1 Q
"RTN","QANCDNT",61,0)
 . I $G(QANQFLG)=1 Q
"RTN","QANCDNT",62,0)
 . I '$G(^QA(740,1,"QAN2",+Y,0)) W !,"Enter the number of your choice." S QANCNT=0 G LIST
"RTN","QANCDNT",63,0)
 . S QANNO=+Y
"RTN","QANCDNT",64,0)
 . S DIE="^QA(742.4,",DR="52///^S X=$P(^DIC(4,+^QA(740,1,""QAN2"",QANNO,0),0),U)"
"RTN","QANCDNT",65,0)
 . S DA=QANIEN
"RTN","QANCDNT",66,0)
 . D ^DIE I $D(Y)>0 S QANCNT=0 G LIST
"RTN","QANCDNT",67,0)
 Q
"RTN","QANCDNT",68,0)
DIE S DIE="^QA(742.4,",DA=QANIEN,DR="[QAN ENTER TIME]"
"RTN","QANCDNT",69,0)
 D ^DIE K DIE,DR I $D(Y) D DEL Q:QANXIT
"RTN","QANCDNT",70,0)
 S QANST=$P(^QA(742.4,QANIEN,0),U,2) I "12"[$P(^QA(742.1,QANST,0),U,2) S $P(^QA(742.4,QANIEN,0),U,9)=DT,QAQADICT=742.4,QAQAFLD=".1",X=DT D ENSET^QAQAXREF
"RTN","QANCDNT",71,0)
 K ^UTILITY($J,"QAN PAT") F  D PAT Q:QANXIT!(QANOUT)  ;get the patient
"RTN","QANCDNT",72,0)
 Q:QANXIT
"RTN","QANCDNT",73,0)
SC1 ;
"RTN","QANCDNT",74,0)
 K Y S DIE="^QA(742.4,",DA=QANIEN,DR=".05;@1;.08;S X=X" D ^DIE K DIE,DR I $D(Y) Q:QANXIT
"RTN","QANCDNT",75,0)
 K QAUDIT S QAUDIT("FILE")="742.4^50",QAUDIT("DA")=QANIEN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open an incident record" D ^QAQAUDIT
"RTN","QANCDNT",76,0)
 S DIE="^QA(742.4,",DR=".09///"_1,DA=QANIEN D ^DIE ; Set 'Local Case' flag to open.
"RTN","QANCDNT",77,0)
 I $G(QANFFLG)<1 D DISP
"RTN","QANCDNT",78,0)
 I $G(QANFFLG)<0 L -^QA(742.4,QANIEN) ;if this subroutine has not
"RTN","QANCDNT",79,0)
 ;been called from the full incident edit, then unlock incident report.
"RTN","QANCDNT",80,0)
 ;D ^QANBRIF ;transmit message to local mail group
"RTN","QANCDNT",81,0)
 Q
"RTN","QANCDNT",82,0)
DEL ;Delete incident.
"RTN","QANCDNT",83,0)
 K DIK S DIK="^QA(742.4,",DA=QANIEN W !!,$C(7),"Insufficient data entered for an incident, deleting!!" D ^DIK K DA,DIK S QANXIT=1
"RTN","QANCDNT",84,0)
 Q
"RTN","QANCDNT",85,0)
PAT ;Patient data.
"RTN","QANCDNT",86,0)
 K DIC S DIC="^DPT(",DIC(0)="QEAMNZ",DIC("A")="Select Patient: ",DIC("W")="W "" "",$P(^(0),U,9)",D="B^BS5"
"RTN","QANCDNT",87,0)
 D MIX^DIC1 K DIC S:+Y<1&($G(QANFLAG)) QANOUT=1
"RTN","QANCDNT",88,0)
 D:+Y<1&('$G(QANFLAG)) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANCDNT",89,0)
 F  D  Q:"-12"[%
"RTN","QANCDNT",90,0)
 . W !?5,$G(Y(0,0))_" OK?"
"RTN","QANCDNT",91,0)
 . S %=1 D YN^DICN Q:"-12"[%
"RTN","QANCDNT",92,0)
 . W " Confirm that this is the correct patient."
"RTN","QANCDNT",93,0)
 D:%=-1&('$G(QANFLAG)) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANCDNT",94,0)
 I %=-1,($G(QANFLAG)) S QANXIT=1 Q
"RTN","QANCDNT",95,0)
 I %=2 W " ??" G PAT
"RTN","QANCDNT",96,0)
 D PRIOR I QANXIT D  Q
"RTN","QANCDNT",97,0)
 . I '$G(QANFLAG) K DA,DIK S DA=QANIEN,DIK="^QA(742.4," D ^DIK K DA,DIK
"RTN","QANCDNT",98,0)
 I $D(^UTILITY($J,"QAN PAT",+Y)) W !!,$C(7),$P(^DPT(+Y,0),U)_" has been previously entered for this incident." K Y G PAT
"RTN","QANCDNT",99,0)
 I $D(^DPT(+Y,.35)),$P(^DPT(+Y,.35),U)]"",($P(^DPT(+Y,.35),U)<$P(^QA(742.4,QANIEN,0),U,3)) W !!,$C(7),"The date of death for patient: "_$P(^DPT(+Y,0),U)_" precedes the incident date." K Y G PAT
"RTN","QANCDNT",100,0)
 I $G(QANXIT)!($G(QANOUT)) D DEL Q
"RTN","QANCDNT",101,0)
 S QANPIEN=+Y,QANZERO=Y(0),QANAME=Y(0,0),QANSSN=$P(QANZERO,U,9),^UTILITY($J,"QAN PAT",+Y)=""
"RTN","QANCDNT",102,0)
 S QANDOB=$P(^DPT(QANPIEN,0),U,3)
"RTN","QANCDNT",103,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANCDNT",104,0)
 S QANPSDO(0)=Y(0),QANPSDO(0,0)=Y(0,0)
"RTN","QANCDNT",105,0)
 S QANPID=$$QANPID(.Y)
"RTN","QANCDNT",106,0)
 D ADMDT^QANUTL1
"RTN","QANCDNT",107,0)
 K DIC,DD,DO,DINUM,DLAYGO S DLAYGO=742,DIC="^QA(742,",DIC(0)="L",X=QANPIEN D FILE^DICN K DIC,DD,DO,DINUM,DLAYGO
"RTN","QANCDNT",108,0)
 I +Y=-1,('$G(QANFLAG)) D DEL Q
"RTN","QANCDNT",109,0)
 I +Y=-1,($G(QANFLAG)) S QANXIT=1 Q  ;Something is wrong, exit.
"RTN","QANCDNT",110,0)
 S QANDFN=+Y
"RTN","QANCDNT",111,0)
 L +^QA(742,QANDFN):10 I '$T W !!,"Another user is editing this patient incident." Q
"RTN","QANCDNT",112,0)
 S $P(^QA(742,QANDFN,0),U,2,6)=QANPID_U_QANIEN_U_QANADMDT_U_QANINPAT_U_QANWARD
"RTN","QANCDNT",113,0)
 S $P(^QA(742,QANDFN,0),U,7)=QANTRSP,$P(^QA(742,QANDFN,0),U,12)=1
"RTN","QANCDNT",114,0)
 S DIK="^QA(742,",DA=QANDFN D IX1^DIK K DA,DIK
"RTN","QANCDNT",115,0)
 L -^QA(742,QANDFN)
"RTN","QANCDNT",116,0)
 S QANFLAG=1 ;D:'$D(QANF) BULL^QANUTL3
"RTN","QANCDNT",117,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open a patient record" D ^QAQAUDIT
"RTN","QANCDNT",118,0)
 Q
"RTN","QANCDNT",119,0)
PRIOR ;
"RTN","QANCDNT",120,0)
 S QANTST(1)=$G(^QA(742.4,QANIEN,0))
"RTN","QANCDNT",121,0)
 S QANTST("INC")=$P(QANTST(1),U,2),QANTST("DATE")=$P(QANTST(1),U,3)
"RTN","QANCDNT",122,0)
 F QAN99=0:0 S QAN99=$O(^QA(742,"AA",+Y,QAN99)) Q:QAN99'>0!(QANXIT)  S QANPRS=+$O(^QA(742,"AA",+Y,QAN99,"")) I QANPRS>0,($P(^QA(742,QANPRS,0),U,12)'<0) S QANTST(2)=$G(^QA(742.4,QAN99,0)) D PRIOR1
"RTN","QANCDNT",123,0)
 K QAN99,QANPRS,QANTST
"RTN","QANCDNT",124,0)
 Q
"RTN","QANCDNT",125,0)
PRIOR1 ;
"RTN","QANCDNT",126,0)
 I (QANTST("INC")=$P(QANTST(2),U,2)),(QANTST("DATE")=$P(QANTST(2),U,3)) D
"RTN","QANCDNT",127,0)
 . W !!,$C(7),"Patient "_$P(^DPT(+Y,0),U)_" has a duplicate incident on record."
"RTN","QANCDNT",128,0)
 . W:'$G(QANFLAG) !,"Deleting the incident."
"RTN","QANCDNT",129,0)
 . S:'$G(QANFLAG) QANXIT=1
"RTN","QANCDNT",130,0)
 . W:$G(QANFLAG) !,"Please select new patient or press 'RETURN'!"
"RTN","QANCDNT",131,0)
 ; . W:$G(QANFLAG) !,"Exiting!"
"RTN","QANCDNT",132,0)
 ; . S QANXIT=1
"RTN","QANCDNT",133,0)
 Q
"RTN","QANCDNT",134,0)
DISP ;display to user what has been entered and ask if it is okay
"RTN","QANCDNT",135,0)
 N QANCC,QANEE
"RTN","QANCDNT",136,0)
 W @IOF
"RTN","QANCDNT",137,0)
 S QAN74240=^QA(742.4,QANIEN,0)
"RTN","QANCDNT",138,0)
 W !!!,"Incident Report: "_$P(QAN74240,U)
"RTN","QANCDNT",139,0)
 S Y=$P(QAN74240,U,3) D DD^%DT
"RTN","QANCDNT",140,0)
 W ?35,"Date of Incident: "_Y
"RTN","QANCDNT",141,0)
 W !,"Patient: "
"RTN","QANCDNT",142,0)
 S QANCC=0 F  S QANCC=$O(^QA(742,"BCS",QANIEN,QANCC)) Q:QANCC'>0  D
"RTN","QANCDNT",143,0)
 . W ?10,$P(^DPT($P(^QA(742,QANCC,0),U),0),U),!
"RTN","QANCDNT",144,0)
 W !,"Incident Type: "
"RTN","QANCDNT",145,0)
 I $P(QAN74240,U,2)]"" W $P(^QA(742.1,$P(QAN74240,U,2),0),U)
"RTN","QANCDNT",146,0)
 W !,"Incident Location: "
"RTN","QANCDNT",147,0)
 I $P(QAN74240,U,4)]"" W $P(^QA(742.5,$P(QAN74240,U,4),0),U)
"RTN","QANCDNT",148,0)
 W !,"Was the Incident Witnessed?: "_$S($P(QAN74240,U,7)=1:"Yes",$P(QAN74240,U,7)=0:"No",1:"")
"RTN","QANCDNT",149,0)
 W !,"Incident Description: "
"RTN","QANCDNT",150,0)
 S QANEE=0 F  S QANEE=$O(^QA(742.4,QANIEN,1,QANEE)) Q:QANEE'>0  D
"RTN","QANCDNT",151,0)
 . W !?3,^QA(742.4,QANIEN,1,QANEE,0)
"RTN","QANCDNT",152,0)
 W !!
"RTN","QANCDNT",153,0)
 S DIR("A")="Is this information correct?"
"RTN","QANCDNT",154,0)
 S DIR("B")="Yes"
"RTN","QANCDNT",155,0)
 S DIR("?")="Enter 'Yes' or 'No'."
"RTN","QANCDNT",156,0)
 S DIR(0)="YAO"
"RTN","QANCDNT",157,0)
 S DIR("?",1)="Enter 'Yes' if the information displayed is correct."
"RTN","QANCDNT",158,0)
 S DIR("?",2)="Enter 'No' if you need to edit this information."
"RTN","QANCDNT",159,0)
 D ^DIR
"RTN","QANCDNT",160,0)
GOEDIT ;
"RTN","QANCDNT",161,0)
 ;if info is not right, use code from QANEDIT to edit just the fields
"RTN","QANCDNT",162,0)
 ;in a brief incident.  There must be at least one patient/report.
"RTN","QANCDNT",163,0)
 I Y=0 S QANOUT=0 D
"RTN","QANCDNT",164,0)
 . D DIE^QANEDIT
"RTN","QANCDNT",165,0)
 . I $O(^QA(742,"BCS",QANIEN,0))']"" D
"RTN","QANCDNT",166,0)
 . . W !!,"No patients on this Incident Report - deleting Report."
"RTN","QANCDNT",167,0)
 . . S DIK="^QA(742.4,",DA=QANIEN D ^DIK K DIK
"RTN","QANCDNT",168,0)
 . . ;also need to remove entry from QA Audit file (#740.5)
"RTN","QANCDNT",169,0)
 . . ;get most recent entry for 742 and 742.4 and if matches
"RTN","QANCDNT",170,0)
 . . ;this entry, delete
"RTN","QANCDNT",171,0)
 . . F QANFILE=742,742.4 D DIKAUDIT^QANEDIT(QANFILE) K QANFILE
"RTN","QANCDNT",172,0)
 I $G(^QA(742.4,QANIEN,0))]"" D
"RTN","QANCDNT",173,0)
 . D ^QANBRIF ;transmit message to local mail group
"RTN","QANCDNT",174,0)
 . S QANCC=0
"RTN","QANCDNT",175,0)
 . F  S QANCC=$O(^QA(742,"BCS",QANIEN,QANCC)) Q:QANCC'>0  D
"RTN","QANCDNT",176,0)
 . . S QANPTNUM=$P(^QA(742,QANCC,0),U)
"RTN","QANCDNT",177,0)
 . . S QANODE=^DPT(QANPTNUM,0)
"RTN","QANCDNT",178,0)
 . . S QANAME=$P(QANODE,U)
"RTN","QANCDNT",179,0)
 . . S QANSSN=$P(QANODE,U,9)
"RTN","QANCDNT",180,0)
 . . D:'$D(QANF) BULL^QANUTL3
"RTN","QANCDNT",181,0)
QANPID(Y) ;Function to set up Patient ID.
"RTN","QANCDNT",182,0)
 N QANF,QANM,QANL
"RTN","QANCDNT",183,0)
 S QANL=$P(Y(0,0),",")
"RTN","QANCDNT",184,0)
 I QANL[" " D
"RTN","QANCDNT",185,0)
 .S QANF=$E($P(Y(0,0),",",2))
"RTN","QANCDNT",186,0)
 .S QANM=$E($P(Y(0,0)," ",3))
"RTN","QANCDNT",187,0)
 .S QANPID=$G(QANF)_$G(QANM)_$E(QANL)_$E(QANSSN,6,9)
"RTN","QANCDNT",188,0)
 I QANL'[" " D
"RTN","QANCDNT",189,0)
 .S QANF=$E($P(Y(0,0),",",2))
"RTN","QANCDNT",190,0)
 .S QANM=$E($P(Y(0,0)," ",2))
"RTN","QANCDNT",191,0)
 .S QANPID=$G(QANF)_$G(QANM)_$E(QANL)_$E(QANSSN,6,9)
"RTN","QANCDNT",192,0)
 Q QANPID
"RTN","QANCDNT",193,0)
 Q
"RTN","QANEDIT")
0^2^B48416347^B48890391
"RTN","QANEDIT",1,0)
QANEDIT ;WCIOFO/ERC-Edit a Brief Incident ;4/22/99
"RTN","QANEDIT",2,0)
 ;;2.0;Incident Reporting;**27,26,32**;08/07/1992;Build 3
"RTN","QANEDIT",3,0)
 ;
"RTN","QANEDIT",4,0)
START ;
"RTN","QANEDIT",5,0)
 W @IOF
"RTN","QANEDIT",6,0)
 N QANBFLG,QANIEN,QANNOPAT
"RTN","QANEDIT",7,0)
 F  W !!,"Do you want to edit one of your open Incident Reports" S %=1 D YN^DICN Q:"-112"[%  W !!,"Enter (Y)es, (N)o or ""^"" to exit"
"RTN","QANEDIT",8,0)
 I %=1 D EDIT
"RTN","QANEDIT",9,0)
 K QANXIT
"RTN","QANEDIT",10,0)
 Q
"RTN","QANEDIT",11,0)
EDIT ;
"RTN","QANEDIT",12,0)
 K ^TMP("QAN EDIT")
"RTN","QANEDIT",13,0)
 S QANCNT=1
"RTN","QANEDIT",14,0)
 S QANDUZ=DUZ
"RTN","QANEDIT",15,0)
 S QANEE=0
"RTN","QANEDIT",16,0)
 F  S QANEE=$O(^QA(742.4,"ACS",1,QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",17,0)
 . I QANDUZ=$P(^QA(742.4,QANEE,0),U,5) S ^TMP("QAN EDIT",$J,QANCNT,QANEE)="",QANCNT=QANCNT+1
"RTN","QANEDIT",18,0)
 W @IOF
"RTN","QANEDIT",19,0)
 I '$D(^TMP("QAN EDIT")) D  Q
"RTN","QANEDIT",20,0)
 . W !!,"**** You have no open Incident Reports to edit.  Exiting.",!!
"RTN","QANEDIT",21,0)
 W !!,"Here are your open Incident Reports."
"RTN","QANEDIT",22,0)
 S QANEE=0
"RTN","QANEDIT",23,0)
 S QANTOT=0
"RTN","QANEDIT",24,0)
 F  S QANEE=$O(^TMP("QAN EDIT",$J,QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",25,0)
 . S QANIEN=$O(^TMP("QAN EDIT",$J,QANEE,0)) Q:QANIEN'>0
"RTN","QANEDIT",26,0)
 . S QAN0=^QA(742.4,QANIEN,0)
"RTN","QANEDIT",27,0)
 . S QANCC=0,QANCNT=1
"RTN","QANEDIT",28,0)
 . S QANTOT=QANTOT+1 ;gets number of IRs for selecting record to edit
"RTN","QANEDIT",29,0)
 . F  S QANCC=$O(^QA(742,"BCS",QANIEN,QANCC)) Q:QANCC'>0  D
"RTN","QANEDIT",30,0)
 . . S QANNAME=$P(^DPT($P(^QA(742,QANCC,0),U),0),U)
"RTN","QANEDIT",31,0)
 . . S Y=$P(QAN0,U,3) D DD^%DT S QANDATE=Y
"RTN","QANEDIT",32,0)
 . . S QANINC=$P(^QA(742.1,$P(QAN0,U,2),0),U)
"RTN","QANEDIT",33,0)
 . . I $Y>(IOSL-6) K DIR S DIR(0)="E" D ^DIR K DIR W @IOF
"RTN","QANEDIT",34,0)
 . . I QANCNT=1 W !,QANEE,?4,QANDATE,?25,$E(QANINC,1,25),?51,QANNAME
"RTN","QANEDIT",35,0)
 . . I QANCNT>1 W !?51,QANNAME
"RTN","QANEDIT",36,0)
 . . S QANCNT=QANCNT+1
"RTN","QANEDIT",37,0)
DIR ;
"RTN","QANEDIT",38,0)
 I $G(QANTOT)=1 S QANIEN=$O(^TMP("QAN EDIT",$J,1,0)) G DIE
"RTN","QANEDIT",39,0)
 K DIR
"RTN","QANEDIT",40,0)
 S DIR(0)="NOA"
"RTN","QANEDIT",41,0)
 S DIR("A")="Select a number from 1 to "_QANTOT_": "
"RTN","QANEDIT",42,0)
 D ^DIR K DIR Q:$D(DIRUT)!(+Y<1)
"RTN","QANEDIT",43,0)
 I +Y>QANTOT W !,"Number selected must be from 1 to "_QANTOT_", try again." G DIR
"RTN","QANEDIT",44,0)
 S QANIEN=$O(^TMP("QAN EDIT",$J,+Y,0))
"RTN","QANEDIT",45,0)
 I $G(QANIEN)]"",($D(^QA(742.4,QANIEN,0))) D
"RTN","QANEDIT",46,0)
 . L +^QA(742.4,QANIEN):5 I '$T W !!,"Another user is editing this record." Q
"RTN","QANEDIT",47,0)
 . S QANEDFLG=1
"RTN","QANEDIT",48,0)
 . D DIE
"RTN","QANEDIT",49,0)
 . I $O(^QA(742,"BCS",QANIEN,0))']"" D
"RTN","QANEDIT",50,0)
 . . ;if no patients entered, delete the incident
"RTN","QANEDIT",51,0)
 . . W !!,"No patients on this Incident Report - deleting Report."
"RTN","QANEDIT",52,0)
 . . S DIK="^QA(742.4,",DA=QANIEN D ^DIK K DIK
"RTN","QANEDIT",53,0)
 . D EXIT
"RTN","QANEDIT",54,0)
 Q
"RTN","QANEDIT",55,0)
DIE ;
"RTN","QANEDIT",56,0)
 W !!
"RTN","QANEDIT",57,0)
 N QANCNT,QANEE
"RTN","QANEDIT",58,0)
 S QANEFLG=0
"RTN","QANEDIT",59,0)
 S QANEE=0
"RTN","QANEDIT",60,0)
 S QANCNT=1
"RTN","QANEDIT",61,0)
 F  S QANEE=$O(^QA(742,"BCS",QANIEN,QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",62,0)
 . S QANPAT(QANCNT)=QANEE
"RTN","QANEDIT",63,0)
 . S QANCNT=QANCNT+1
"RTN","QANEDIT",64,0)
 K DIE S DIE="^QA(742.4,",DA=QANIEN,DR=".02;.03;.04"
"RTN","QANEDIT",65,0)
 D ^DIE K DIE
"RTN","QANEDIT",66,0)
 L -^QA(742.4,QANIEN)
"RTN","QANEDIT",67,0)
PAT ;edit patient(s) on report
"RTN","QANEDIT",68,0)
 ;if no patients entered go directly to PTADD
"RTN","QANEDIT",69,0)
 I $O(^QA(742,"BCS",QANIEN,0))']"" G PTADD
"RTN","QANEDIT",70,0)
 K QANPNAM,QANPNUM
"RTN","QANEDIT",71,0)
 W !,"Patient(s) on this Incident Report."
"RTN","QANEDIT",72,0)
 S QANEE=0
"RTN","QANEDIT",73,0)
 S QANCNT=1
"RTN","QANEDIT",74,0)
 F  S QANEE=$O(QANPAT(QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",75,0)
 . S QANPNUM(QANEE)=$P(^QA(742,QANPAT(QANEE),0),U)
"RTN","QANEDIT",76,0)
 . S QANPNAM(QANEE)=$P(^DPT(QANPNUM(QANEE),0),U)
"RTN","QANEDIT",77,0)
 . W !?5,QANCNT,"  ",QANPNAM(QANEE)
"RTN","QANEDIT",78,0)
 . S QANCNT=QANCNT+1
"RTN","QANEDIT",79,0)
 S DIR("A")="Is this correct"
"RTN","QANEDIT",80,0)
 S DIR("B")="YES"
"RTN","QANEDIT",81,0)
 S DIR(0)="Y"
"RTN","QANEDIT",82,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","QANEDIT",83,0)
 I Y<1 D
"RTN","QANEDIT",84,0)
 . S DIR(0)="Y",DIR("A")="Would you like to add a patient"
"RTN","QANEDIT",85,0)
 . S DIR("B")="YES"
"RTN","QANEDIT",86,0)
 . K DIRUT
"RTN","QANEDIT",87,0)
 . D ^DIR K DIR Q:$D(DIRUT)
"RTN","QANEDIT",88,0)
 . I Y=1 D PTADD S (QANEFLG,QANEDFLG)=1 Q
"RTN","QANEDIT",89,0)
 . ;deleting patients from record only allowed if editing a new record
"RTN","QANEDIT",90,0)
 . I $G(QANBFLG)'=1 Q
"RTN","QANEDIT",91,0)
 . K DIR S DIR(0)="Y",DIR("A")="Would you like to delete a patient"
"RTN","QANEDIT",92,0)
 . S DIR("B")="NO"
"RTN","QANEDIT",93,0)
 . K DIRUT
"RTN","QANEDIT",94,0)
 . D ^DIR K DIR Q:$D(DIRUT)
"RTN","QANEDIT",95,0)
 . I Y=1 D PTDEL S (QANEFLG,QANEDFLG)=1
"RTN","QANEDIT",96,0)
 ;if the user has deleted all patients and has not re-entered one,
"RTN","QANEDIT",97,0)
 ;exit the subroutine (a message will be displayed & the record deleted)
"RTN","QANEDIT",98,0)
 I $G(QANNOPAT)=1 K QANNOPAT Q
"RTN","QANEDIT",99,0)
 I $G(QANEFLG)=1 S QANEFLG=0 G PAT
"RTN","QANEDIT",100,0)
 ;if no patients on report skip description and witnessed and quit
"RTN","QANEDIT",101,0)
 I $O(^QA(742,"BCS",QANIEN,0))']"" Q
"RTN","QANEDIT",102,0)
 K DIE S DIE="^QA(742.4,",DR=".05;.08"
"RTN","QANEDIT",103,0)
 D ^DIE K DIE
"RTN","QANEDIT",104,0)
 Q
"RTN","QANEDIT",105,0)
PTADD ;
"RTN","QANEDIT",106,0)
 K DIC S DIC="^DPT(",DIC(0)="QEAMNZ",DIC("A")="Select Patient: ",DIC("W")="W "" "",$P(^(0),U,9)",D="B^BS5"
"RTN","QANEDIT",107,0)
 D MIX^DIC1 K DIC
"RTN","QANEDIT",108,0)
 I +Y<1 S QANXIT=1 Q
"RTN","QANEDIT",109,0)
 F  D  Q:"-12"[%
"RTN","QANEDIT",110,0)
 . W !?5,$G(Y(0,0))_" OK"
"RTN","QANEDIT",111,0)
 . S %=1 D YN^DICN Q:"-12"[%
"RTN","QANEDIT",112,0)
 . W " Confirm that this is the correct patient."
"RTN","QANEDIT",113,0)
 I %=-1 S QANXIT=1 Q
"RTN","QANEDIT",114,0)
 I %=2 W " ??" G PTADD
"RTN","QANEDIT",115,0)
 S QANEE=0
"RTN","QANEDIT",116,0)
 F  S QANEE=$O(QANPNUM(QANEE)) Q:QANEE'>0  D
"RTN","QANEDIT",117,0)
 . I +Y=QANPNUM(QANEE) W !!,$C(7),$P(^DPT(+Y,0),U)_" has been previously entered for this incident." K Y S QANXFLG=1 Q
"RTN","QANEDIT",118,0)
 I $G(QANXFLG)=1 S QANXFLG=0 G PTADD
"RTN","QANEDIT",119,0)
 I $D(^DPT(+Y,.35)),$P(^DPT(+Y,.35),U)]"",($P(^DPT(+Y,.35),U)<$P(^QA(742.4,QANIEN,0),U,3)) W !!,$C(7),"The date of death for patient: "_$P(^DPT(+Y,0),U)_" precedes the incident date." K Y G PTADD
"RTN","QANEDIT",120,0)
 S QANPIEN=+Y,QANZERO=Y(0),QANAME=Y(0,0),QANSSN=$P(QANZERO,U,9),^UTILITY($J,"QAN PAT",+Y)=""
"RTN","QANEDIT",121,0)
 S QANDOB=$P(^DPT(QANPIEN,0),U,3)
"RTN","QANEDIT",122,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANEDIT",123,0)
 S QANPSDO(0)=Y(0),QANPSDO(0,0)=Y(0,0)
"RTN","QANEDIT",124,0)
 S QANPID=$$QANPID^QANCDNT(.Y)
"RTN","QANEDIT",125,0)
 D ADMDT^QANUTL1
"RTN","QANEDIT",126,0)
 K DIC,DD,DO,DINUM,DLAYGO S DLAYGO=742,DIC="^QA(742,",DIC(0)="L",X=QANPIEN D FILE^DICN K DIC,DD,DO,DINUM,DLAYGO
"RTN","QANEDIT",127,0)
 I +Y=-1,($G(QANFLAG)) S QANXIT=1 Q
"RTN","QANEDIT",128,0)
 S QANDFN=+Y
"RTN","QANEDIT",129,0)
 S $P(^QA(742,QANDFN,0),U,2,6)=QANPID_U_QANIEN_U_QANADMDT_U_QANINPAT_U_QANWARD
"RTN","QANEDIT",130,0)
 S $P(^QA(742,QANDFN,0),U,7)=QANTRSP,$P(^QA(742,QANDFN,0),U,12)=1
"RTN","QANEDIT",131,0)
 S DIK="^QA(742,",DA=QANDFN D IX1^DIK K DA,DIK
"RTN","QANEDIT",132,0)
 S QANNUM=$O(QANPAT(" "),-1)+1
"RTN","QANEDIT",133,0)
 S QANPAT(QANNUM)=QANDFN
"RTN","QANEDIT",134,0)
 S QANPNUM(QANNUM)=QANPIEN
"RTN","QANEDIT",135,0)
 S QANPNAM(QANNUM)=QANAME
"RTN","QANEDIT",136,0)
 S QANFLAG=1 D:'$D(QANF) BULL^QANUTL3
"RTN","QANEDIT",137,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="e",QAUDIT("COMMENT")="Edit a brief patient record" D ^QAQAUDIT
"RTN","QANEDIT",138,0)
 Q
"RTN","QANEDIT",139,0)
PTDEL ;
"RTN","QANEDIT",140,0)
 S QANCC=0
"RTN","QANEDIT",141,0)
 F  S QANCC=$O(QANPNUM(QANCC)) Q:QANCC'>0  D
"RTN","QANEDIT",142,0)
 . S QANNUM=QANCC
"RTN","QANEDIT",143,0)
 . W !?5,QANCC_"   "_QANPNAM(QANCC)
"RTN","QANEDIT",144,0)
 I '$G(QANNUM) S QANXIT=1 Q
"RTN","QANEDIT",145,0)
 S DIR(0)="NOA"
"RTN","QANEDIT",146,0)
 S DIR("A")="Delete which patient number: "
"RTN","QANEDIT",147,0)
 D ^DIR K DIR Q:$D(DIRUT)
"RTN","QANEDIT",148,0)
 I $G(QANPNAM(+Y))']"" W !!?5,"Choice must be one of the displayed numbers." G PTDEL
"RTN","QANEDIT",149,0)
 I Y>QANNUM W !!?5,"Answer must be a number less than ",QANNUM+1 G PTDEL
"RTN","QANEDIT",150,0)
 I Y<1 S QANXIT=1 Q
"RTN","QANEDIT",151,0)
 S QANTEMP=+Y
"RTN","QANEDIT",152,0)
 S QANDFN=QANPAT(+Y)
"RTN","QANEDIT",153,0)
 S QANAME=QANPNAM(+Y)
"RTN","QANEDIT",154,0)
 S DIK="^QA(742,",DA=QANPAT(+Y) D ^DIK
"RTN","QANEDIT",155,0)
 ;D BULL^QANUTL3
"RTN","QANEDIT",156,0)
 ;K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="d",QAUDIT("COMMENT")="Delete a brief patient record" D ^QAQAUDIT
"RTN","QANEDIT",157,0)
 K QANPAT(QANTEMP),QANPNUM(QANTEMP),QANPNAM(QANTEMP)
"RTN","QANEDIT",158,0)
 ;if there are no patients on the report set a flag and go back to PTADD
"RTN","QANEDIT",159,0)
 I $O(^QA(742,"BCS",QANIEN,0))']"" W !!,"You must have at least one patient on an incident report." S QANNOPAT=1 G PTADD
"RTN","QANEDIT",160,0)
 G PTDEL
"RTN","QANEDIT",161,0)
 Q
"RTN","QANEDIT",162,0)
EXIT ;
"RTN","QANEDIT",163,0)
 K QAN0,QANADMDT,QANCC,QANCNT,QANDATE,QANDFN,QANDOB,QANEE
"RTN","QANEDIT",164,0)
 K QANEDFLG,QANELFG,QANFLAG,QANIEN,QANINC,QANAME,QANNAME,QANNOPAT
"RTN","QANEDIT",165,0)
 K QANNUM,QANPAT,QANPID,QANPIEN,QANPNAM,QANPNUM,QANPSDO,QANTEMP
"RTN","QANEDIT",166,0)
 K QANTOT,QANTRSP,QANXFLG,QANXIT,QANY,QANZERO
"RTN","QANEDIT",167,0)
 Q
"RTN","QANEDIT",168,0)
DIKAUDIT(QANFIL) ;
"RTN","QANEDIT",169,0)
 ;deletes the entries for this Incident Report from
"RTN","QANEDIT",170,0)
 ;the QA Audit file.  Input is the QA file (742 for the patient,
"RTN","QANEDIT",171,0)
 ;742.4 for the incident).
"RTN","QANEDIT",172,0)
 ;
"RTN","QANEDIT",173,0)
 S QANID=$S(QANFIL=742:QANDFN,1:QANIEN)
"RTN","QANEDIT",174,0)
 S QANEE=$O(^QA(740.5,"B",QANFIL," "),-1)+1
"RTN","QANEDIT",175,0)
 F  S QANEE=$O(^QA(740.5,"B",QANFIL,QANEE),-1) Q:QANEE'>0  I $P(^QA(740.5,QANEE,0),U,2)=QANID S QANAUD=QANID Q
"RTN","QANEDIT",176,0)
 I $G(QANAUD)]"" D
"RTN","QANEDIT",177,0)
 . S DIK="^QA(740.5,",DA=QANEE
"RTN","QANEDIT",178,0)
 . D ^DIK K DIK
"RTN","QANEDIT",179,0)
 . K QANID,QANAUD,QANEE
"RTN","QANEDIT",180,0)
 Q
"RTN","QANQUCK")
0^3^B18124111^B18402141
"RTN","QANQUCK",1,0)
QANQUCK ;HISC/GJC-Initial sighting of an Incident for a QA person ; 10/29/03 10:34am
"RTN","QANQUCK",2,0)
 ;;2.0;Incident Reporting;**1,9,14,27,26,28,29,32**;08/07/1992;Build 3
"RTN","QANQUCK",3,0)
 ;
"RTN","QANQUCK",4,0)
 K QANLOCK
"RTN","QANQUCK",5,0)
 D NEWREC^QANCDNT
"RTN","QANQUCK",6,0)
 D DIV^QANCDNT
"RTN","QANQUCK",7,0)
 I $G(QANQFLG)=1 Q
"RTN","QANQUCK",8,0)
 S QANDEATH=$O(^QA(742.1,"BUPPER","DEATH",0)),QANSUI=$O(^QA(742.1,"BUPPER","SUICIDE",0)),QANHOMCD=$O(^QA(742.1,"BUPPER","HOMICIDE",0))
"RTN","QANQUCK",9,0)
 S QANPTAB=$O(^QA(742.1,"BUPPER","PATIENT ABUSE",0))
"RTN","QANQUCK",10,0)
 S DIE="^QA(742.4,",DA=QANIEN,DR="[QAN QUICK EDIT]" D ^DIE K DIE,DR I $D(Y) D DEL D:QANXIT KILL Q
"RTN","QANQUCK",11,0)
 S QANLTTR=$P(^QA(742.4,QANIEN,0),U,2)
"RTN","QANQUCK",12,0)
 S QANST=$P(^QA(742.4,QANIEN,0),U,2) I "12"[$P(^QA(742.1,QANST,0),U,2) S $P(^QA(742.4,QANIEN,0),U,9)=DT,QAQADICT=742.4,QAQAFLD=".1",X=DT D ENSET^QAQAXREF
"RTN","QANQUCK",13,0)
 K QAUDIT S QAUDIT("FILE")="742.4^50",QAUDIT("DA")=QANIEN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open an incident record" D ^QAQAUDIT
"RTN","QANQUCK",14,0)
 S DIE="^QA(742.4,",DR=".09///"_3,DA=QANIEN D ^DIE ; Set 'Local Case' flag to brief.
"RTN","QANQUCK",15,0)
 ;Get the patient.
"RTN","QANQUCK",16,0)
 K ^UTILITY($J,"QAN PAT") F  D PAT Q:QANXIT!(QANOUT)
"RTN","QANQUCK",17,0)
 L -^QA(742.4,QANIEN) ;unlock record - it was locked in NEWREC^QANCDNT
"RTN","QANQUCK",18,0)
KILL K D0,DA,QANADMDT,QANAGE,QANAME,QANCHK,QANCODE,QANDFN,QANDOB,QANDT,QANDUZ
"RTN","QANQUCK",19,0)
 K QANFLAG,QANHOMCD,QANHOME,QANIEN,QANINCR,QANINPAT,QANLTTR,QANOUT
"RTN","QANQUCK",20,0)
 K QANPTAB,QANPID,QANPIEN,QANPSDO,QANSSN,QANSUI,QANDEATH,QANST,QANST1
"RTN","QANQUCK",21,0)
 K QANTRSP,QANTTL,QANWARD,QANXIT,QANZERO,QAQADICT,QAQAFLD,QUES,VAERR,X
"RTN","QANQUCK",22,0)
 K QANPRS,X1,X2,Y,QANCODE,QANBFLG
"RTN","QANQUCK",23,0)
 Q
"RTN","QANQUCK",24,0)
DEL ;
"RTN","QANQUCK",25,0)
 K DIK S DIK="^QA(742.4,",DA=QANIEN W !!,$C(7),"Insufficient data entered for an incident, deleting!!" D ^DIK K DA,DIK S QANXIT=1
"RTN","QANQUCK",26,0)
 Q
"RTN","QANQUCK",27,0)
PAT ;Patient data.
"RTN","QANQUCK",28,0)
 K DIC S DIC="^DPT(",DIC(0)="QEAMNZ",DIC("A")="Select Patient: ",DIC("W")="W "" "",$P(^(0),U,9)",D="B^BS5"
"RTN","QANQUCK",29,0)
 D MIX^DIC1 K DIC S:+Y<1&(QANFLAG) QANOUT=1
"RTN","QANQUCK",30,0)
 D:+Y<1&('QANFLAG) DEL^QANCDNT Q:QANXIT!(QANOUT)
"RTN","QANQUCK",31,0)
 F  D  Q:"-12"[%
"RTN","QANQUCK",32,0)
 . W !?5,$G(Y(0,0))_" OK?"
"RTN","QANQUCK",33,0)
 . S %=1 D YN^DICN Q:"-12"[%
"RTN","QANQUCK",34,0)
 . W " Confirm that this is the correct patient."
"RTN","QANQUCK",35,0)
 D:%=-1&('QANFLAG) DEL^QANQUCK Q:QANXIT!(QANOUT)
"RTN","QANQUCK",36,0)
 I %=-1,(QANFLAG) S QANXIT=1 Q
"RTN","QANQUCK",37,0)
 I %=2 W " ??" G PAT
"RTN","QANQUCK",38,0)
 D PRIOR^QANCDNT I QANXIT D  Q
"RTN","QANQUCK",39,0)
 . I 'QANFLAG K DA,DIK S DA=QANIEN,DIK="^QA(742.4," D ^DIK K DA,DIK
"RTN","QANQUCK",40,0)
 I $D(^UTILITY($J,"QAN PAT",+Y)) W !!,$C(7),$P(^DPT(+Y,0),U)_" has been previously entered for this incident." K Y G PAT
"RTN","QANQUCK",41,0)
 I $D(^DPT(+Y,.35)),$P(^DPT(+Y,.35),U)]"",($P(^DPT(+Y,.35),U)<$P(^QA(742.4,QANIEN,0),U,3)) W !!,$C(7),"The date of death for patient: "_$P(^DPT(+Y,0),U)_" precedes the incident date." K Y G PAT
"RTN","QANQUCK",42,0)
 S QANPIEN=+Y,QANZERO=Y(0),QANAME=Y(0,0),QANSSN=$P(QANZERO,U,9),^UTILITY($J,"QAN PAT",+Y)=""
"RTN","QANQUCK",43,0)
 S QANDOB=$P(^DPT(QANPIEN,0),U,3)
"RTN","QANQUCK",44,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANQUCK",45,0)
 S QANPSDO(0)=Y(0),QANPSDO(0,0)=Y(0,0)
"RTN","QANQUCK",46,0)
 S QANPID=$$QANPID^QANCDNT(.Y)
"RTN","QANQUCK",47,0)
 D ADMDT^QANUTL1
"RTN","QANQUCK",48,0)
 ;L +^QA(742):10 I '$T W !!,"Another user is editing this file." Q
"RTN","QANQUCK",49,0)
 K DIC,DD,DO,DINUM,DLAYGO S DLAYGO=742,DIC="^QA(742,",DIC(0)="L",X=QANPIEN D FILE^DICN K DIC,DD,DO,DINUM,DLAYGO
"RTN","QANQUCK",50,0)
 I +Y=-1,('QANFLAG) D DEL Q
"RTN","QANQUCK",51,0)
 I +Y=-1,(QANFLAG) S QANXIT=1 Q  ;Something is wrong, exit.
"RTN","QANQUCK",52,0)
 S QANDFN=+Y
"RTN","QANQUCK",53,0)
 ;L -^QA(742)
"RTN","QANQUCK",54,0)
 L +^QA(742,QANDFN):10 I '$T W !!,"Another user is editing this patient incident." Q
"RTN","QANQUCK",55,0)
 S $P(^QA(742,QANDFN,0),U,2,6)=QANPID_U_QANIEN_U_QANADMDT_U_QANINPAT_U_QANWARD
"RTN","QANQUCK",56,0)
 S $P(^QA(742,QANDFN,0),U,7)=QANTRSP,$P(^QA(742,QANDFN,0),U,12)=1
"RTN","QANQUCK",57,0)
 S DIK="^QA(742,",DA=QANDFN D IX1^DIK K DA,DIK
"RTN","QANQUCK",58,0)
 I (QANSUI=QANLTTR)!(QANDEATH=QANLTTR)!(QANHOMCD=QANLTTR) K DA,DIE,DR S DIE="^QA(742,",DA=QANDFN,DR=".1///^S X=3" D ^DIE K DA,DIE,DR
"RTN","QANQUCK",59,0)
 I (QANSUI'=QANLTTR),(QANDEATH'=QANLTTR),(QANHOMCD'=QANLTTR) K DA,DIE,DR S DIE="^QA(742,",DR=".1",DA=QANDFN D ^DIE K DA,DIE,DR
"RTN","QANQUCK",60,0)
 L -^QA(742,QANDFN)
"RTN","QANQUCK",61,0)
 S QANFLAG=1
"RTN","QANQUCK",62,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="o",QAUDIT("COMMENT")="Open a patient record" D ^QAQAUDIT
"RTN","QANQUCK",63,0)
 Q
"RTN","QANUTL")
0^4^B9972935^B10154225
"RTN","QANUTL",1,0)
QANUTL ;;HISC/GJC-Utilities for Incident Reporting ;10/6/92
"RTN","QANUTL",2,0)
 ;;2.0;Incident Reporting;**1,3,32**;08/07/1992;Build 3
"RTN","QANUTL",3,0)
EN0 ;Sets up and builds the patients ID.
"RTN","QANUTL",4,0)
 S QANDFN(0)=X,QANZERO(3)=^DPT(QANDFN(0),0),QANAME=$P(QANZERO(3),U),QANSSN=$P(QANZERO(3),U,9)
"RTN","QANUTL",5,0)
 S QANPID=$$QANPID^QANCDNT(QANAME)
"RTN","QANUTL",6,0)
 K QANDFN(0),QANZERO(3),QANAME,QANSSN
"RTN","QANUTL",7,0)
 Q
"RTN","QANUTL",8,0)
EN1 ;Used for DIC("W") used in QANMAIL and QANVAL.
"RTN","QANUTL",9,0)
 I QANTYPE=1 S QANTEMP=Y,Y=$P(^QA(742.4,+Y,0),U,3) X ^DD("DD") W " "_Y_" " S Y=QANTEMP W $P(^QA(742.1,$P(^QA(742.4,+Y,0),U,2),0),U) K QANTEMP Q
"RTN","QANUTL",10,0)
 I QANTYPE=2 W " "_$P(^QA(742.1,$P(^QA(742.4,+Y,0),U,2),0),U) Q
"RTN","QANUTL",11,0)
 I QANTYPE=4 S QANTEMP=Y,Y=$P(^QA(742.4,+QANTEMP,0),U,3) X ^DD("DD") W " "_Y S Y=QANTEMP K QANTEMP
"RTN","QANUTL",12,0)
 Q
"RTN","QANUTL",13,0)
EN10 ;Medication Errors (Other).
"RTN","QANUTL",14,0)
 K DIE,DR S DIE="^QA(742,",DR=".14",DA=QANDFN D ^DIE K DA,DR,DIE
"RTN","QANUTL",15,0)
 Q
"RTN","QANUTL",16,0)
HOMCIDE ;Patient Abuse changed to Homicide.
"RTN","QANUTL",17,0)
 W !!,*7,"Incident: Patient Abuse   Severity Level: Death (3)"
"RTN","QANUTL",18,0)
 W !,"Changed to Incident: Homicide   Severity Level: Death (3)",!!,*7
"RTN","QANUTL",19,0)
 K DA,DIE,DR
"RTN","QANUTL",20,0)
 S DA=QANIEN,DIE="^QA(742.4,",DR=".02///"_$O(^QA(742.1,"BUPPER","HOMICIDE",0)) D ^DIE
"RTN","QANUTL",21,0)
 K DA,DIE,DR
"RTN","QANUTL",22,0)
 S:$G(QANIRIN)]"" QANIRIN=+$O(^QA(742.1,"BUPPER","HOMICIDE",0))
"RTN","QANUTL",23,0)
 Q
"RTN","QANUTL",24,0)
SUIATMP ;Suicide Attempt changed to Suicide.
"RTN","QANUTL",25,0)
 W !!,*7,"Incident: Suicide Attempt   Severity Level: Death (3)"
"RTN","QANUTL",26,0)
 W !,"Changed to Incident: Suicide   Severity Level: Death (3)",!!,*7
"RTN","QANUTL",27,0)
 K DA,DIE,DR
"RTN","QANUTL",28,0)
 S DA=QANIEN,DIE="^QA(742.4,",DR=".02///"_$O(^QA(742.1,"BUPPER","SUICIDE",0)) D ^DIE
"RTN","QANUTL",29,0)
 K DA,DIE,DR
"RTN","QANUTL",30,0)
 S:$G(QANIRIN)]"" QANIRIN=+$O(^QA(742.1,"BUPPER","SUICIDE",0))
"RTN","QANUTL",31,0)
 Q
"RTN","QANUTL",32,0)
ABUSE ;Abuse Message
"RTN","QANUTL",33,0)
 I +$P(QANGLB1,U,10)=0 X MSSG1,MSSG2
"RTN","QANUTL",34,0)
 E  X MSSG0,MSSG1,MSSG2
"RTN","QANUTL",35,0)
 Q
"RTN","QANUTL",36,0)
DEATH ;Special broadcasts for 'Death' cases.
"RTN","QANUTL",37,0)
 S DTHQAN("DEATH CONJ PROC")=$O(^QA(742.14,"BUPPER","CONJUNCTION WITH A PROCEDURE",0))
"RTN","QANUTL",38,0)
 S DTHQAN("DURING ANES.")=$O(^QA(742.14,"BUPPER","DURING INDUCTION OF ANES.",0))
"RTN","QANUTL",39,0)
 S DTHQAN("DIAG/TREAT")=$O(^QA(742.14,"BUPPER","FAILURE TO DIAGNOSE OR TREAT",0))
"RTN","QANUTL",40,0)
 S DTHQAN("MED CNTR GRNDS")=$O(^QA(742.14,"BUPPER","ON MEDICAL CENTER GROUNDS",0))
"RTN","QANUTL",41,0)
 S DTHQAN("OR")=$O(^QA(742.14,"BUPPER","OPERATING ROOM",0))
"RTN","QANUTL",42,0)
 S DTHQAN("RR")=$O(^QA(742.14,"BUPPER","RECOVERY ROOM",0))
"RTN","QANUTL",43,0)
 S DTHQAN("EQUIPT")=$O(^QA(742.14,"BUPPER","EQUIPMENT MALFUNCTION",0))
"RTN","QANUTL",44,0)
 S DTHQAN("48 HOURS")=$O(^QA(742.14,"BUPPER","WITHIN 48 HOURS OF SURGERY",0))
"RTN","QANUTL",45,0)
 S DTHQAN("CASES M.E.")=$O(^QA(742.14,"BUPPER","CASES ACCEPTED BY M.E.",0))
"RTN","QANUTL",46,0)
 I +$P(QANGLB2,U,14)=DTHQAN("CASES M.E.") X MSSG0,MSSG1
"RTN","QANUTL",47,0)
 I +$P(QANGLB2,U,14)=DTHQAN("DEATH CONJ PROC") X MSSG1
"RTN","QANUTL",48,0)
 I +$P(QANGLB2,U,14)=DTHQAN("DURING ANES.") X MSSG1
"RTN","QANUTL",49,0)
 I +$P(QANGLB2,U,14)=DTHQAN("DIAG/TREAT") X MSSG1,MSSG2
"RTN","QANUTL",50,0)
 I +$P(QANGLB2,U,14)=DTHQAN("MED CNTR GRNDS") X MSSG1
"RTN","QANUTL",51,0)
 I +$P(QANGLB2,U,14)=DTHQAN("OR") X MSSG1
"RTN","QANUTL",52,0)
 I +$P(QANGLB2,U,14)=DTHQAN("RR") X MSSG1
"RTN","QANUTL",53,0)
 I +$P(QANGLB2,U,14)=DTHQAN("EQUIPT") X MSSG0,MSSG1,MSSG2
"RTN","QANUTL",54,0)
 I +$P(QANGLB2,U,14)=DTHQAN("48 HOURS") X MSSG1
"RTN","QANUTL",55,0)
 K DTHQAN
"RTN","QANUTL",56,0)
 Q
"RTN","QANUTL1")
0^5^B31108266^B31569439
"RTN","QANUTL1",1,0)
QANUTL1 ;HISC/GJC-UTILITIES FOR INCIDENT REPORTING (PATIENT DATA) ;7/12/93  09:07
"RTN","QANUTL1",2,0)
 ;;2.0;Incident Reporting;**20,27,32**;08/07/1992;Build 3
"RTN","QANUTL1",3,0)
 ;
"RTN","QANUTL1",4,0)
DICW ;Sets up output for patient lookup.
"RTN","QANUTL1",5,0)
 S QANY=$P(^QA(742,+Y,0),U),QANYY=+$P(^QA(742,+Y,0),U,3)
"RTN","QANUTL1",6,0)
 S QANSSN=$S($P(^DPT(QANY,0),U,9)]"":$P(^DPT(QANY,0),U,9),1:"")
"RTN","QANUTL1",7,0)
 N Y S Y=$P(^QA(742.4,QANYY,0),U,3) X ^DD("DD")
"RTN","QANUTL1",8,0)
 W " "_QANSSN_" "_Y_" "_$P(^QA(742.1,$P(^QA(742.4,QANYY,0),U,2),0),U)
"RTN","QANUTL1",9,0)
 K QANY,QANYY
"RTN","QANUTL1",10,0)
 Q
"RTN","QANUTL1",11,0)
HDH ;
"RTN","QANUTL1",12,0)
 S QANPAGE=QANPAGE+1 W @IOF,!?62,"Date: ",QANDT,!,?62,"Page: ",QANPAGE,!,?(IOM-$L(QANHEAD)\2),QANHEAD
"RTN","QANUTL1",13,0)
 W:QANHEAD(0)]"" !,?(IOM-$L(QANHEAD(0))\2),QANHEAD(0)
"RTN","QANUTL1",14,0)
 W:QANLINE]"" !,QANLINE,!
"RTN","QANUTL1",15,0)
 Q
"RTN","QANUTL1",16,0)
HDH1 ;
"RTN","QANUTL1",17,0)
 K DIR S DIR(0)="E" D ^DIR K DIR S:+Y=0 QANEOP="^"
"RTN","QANUTL1",18,0)
 Q:QANEOP["^"  D HDH
"RTN","QANUTL1",19,0)
 Q
"RTN","QANUTL1",20,0)
PAT0 ;displays the patient(s) on IR, if any.
"RTN","QANUTL1",21,0)
 S QANEE=0 N QANPTFLG
"RTN","QANUTL1",22,0)
 K QANPTS
"RTN","QANUTL1",23,0)
 F  S QANEE=$O(^QA(742,"BCS",QANIEN,QANEE)) Q:QANEE'>0  D
"RTN","QANUTL1",24,0)
 . S QANPTFLG=1
"RTN","QANUTL1",25,0)
 . S QANPTS(QANEE)=$P(^QA(742,QANEE,0),U)
"RTN","QANUTL1",26,0)
 Q:'$G(QANPTFLG)
"RTN","QANUTL1",27,0)
 W !!,"Patient(s) on this Incident Report."
"RTN","QANUTL1",28,0)
 S QANCC=0
"RTN","QANUTL1",29,0)
 F  S QANCC=$O(QANPTS(QANCC)) Q:QANCC'>0  D
"RTN","QANUTL1",30,0)
 . W !?5,$P(^DPT(QANPTS(QANCC),0),U)
"RTN","QANUTL1",31,0)
PAT ;Choose your patient.
"RTN","QANUTL1",32,0)
 K DIC S DIC="^QA(742,",DIC(0)="QEAMZ",DIC("A")="Select Patient: "
"RTN","QANUTL1",33,0)
 S DIC("S1")="I ""13""[+$P(^QA(742.4,+$P(^QA(742,+Y,0),U,3),0),U,8)"
"RTN","QANUTL1",34,0)
 S DIC("S2")="&($D(^QA(742,""BPRS"",1,+Y)))"
"RTN","QANUTL1",35,0)
 S DIC("S3")="I $P(^QA(742,+Y,0),U,3)=QANIEN"
"RTN","QANUTL1",36,0)
 S DIC("S")=$S(QANTYPE=3:DIC("S1")_DIC("S2"),1:DIC("S3")_DIC("S2"))
"RTN","QANUTL1",37,0)
PAT1 ;entry point from EDIT1^QANDCNT
"RTN","QANUTL1",38,0)
 S DIC("W")="D DICW^QANUTL1",D="B^BS5" D MIX^DIC1
"RTN","QANUTL1",39,0)
 I $G(X)']"" W !!,$C(7),"You must enter patient's name to continue editing." G PAT1
"RTN","QANUTL1",40,0)
 K DIC
"RTN","QANUTL1",41,0)
 I +Y=-1 S QANXIT=1 W !!,$C(7),"Patient not selected, exiting!!" Q
"RTN","QANUTL1",42,0)
 S QANDFN=+Y,QANIEN=$P(Y(0),U,3),QAHOLD=$P(Y(0),U),QAHDNM=Y(0,0)
"RTN","QANUTL1",43,0)
 S QAHDSSN=$P(^DPT(+QAHOLD,0),U,9)
"RTN","QANUTL1",44,0)
 D EDTNME Q:QANXIT
"RTN","QANUTL1",45,0)
 S QANAME=$P(^DPT(QANPAT,0),U),QANDOB=$P(^DPT(QANPAT,0),U,3),QAN(0)=0 F QAN=0:0 S QAN=$O(^QA(742,"B",QANPAT,QAN)) Q:QAN'>0!(QAN(0)'<2)  S:$D(^QA(742,"B",QANPAT,QAN)) QAN(0)=QAN(0)+1
"RTN","QANUTL1",46,0)
 I QANDOB]"" S X=DT,X1=X,X2=QANDOB,X="" D:X2 ^%DTC S X=X\365.25,QANAGE=X
"RTN","QANUTL1",47,0)
 I QAN(0)'<2 D RPT0
"RTN","QANUTL1",48,0)
 Q
"RTN","QANUTL1",49,0)
RPT0 W $C(7) F  W !!,"Patient has additional incidents on file.",!,"Do you wish to look at these incidents" S %=2 D YN^DICN Q:"-112"[%  W !,$C(7),"Enter (Y)es, or (N)o, or ""^"" to quit."
"RTN","QANUTL1",50,0)
 S:%=-1 QANXIT=1
"RTN","QANUTL1",51,0)
 I %=-1!(%=2) Q
"RTN","QANUTL1",52,0)
 S QANPT(0)=$S($D(^DPT(QANPAT,0))#2:^(0),1:""),QANDT=DT,QANPAGE=0,Y=QANDT X ^DD("DD") S QANDT=Y,QANHEAD="Patient's Incident History.",QANHEAD(0)="",$P(QANLINE,"~",81)="",QANEOP="" D HDH
"RTN","QANUTL1",53,0)
 F QAN=0:0 S QAN=$O(^QA(742,"B",QANPAT,QAN)) Q:QAN'>0  D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W ! S QANPT0(0)=$S($D(^QA(742,QAN,0))#2:^(0),1:"") I QANPT0(0)]"" D RPT1
"RTN","QANUTL1",54,0)
 F  W !!,"Do you wish to continue with the edit portion" S %=1 D YN^DICN Q:"-112"[%  W !,"Enter ""Y"" for yes, ""N"" for no."
"RTN","QANUTL1",55,0)
 I %<0!(%=2) S QANXIT=1
"RTN","QANUTL1",56,0)
 Q
"RTN","QANUTL1",57,0)
RPT1 S QANCS=$P(QANPT0(0),U,3),QANCS(0)=$S($D(^QA(742.4,QANCS,0))#2:^(0),1:"") Q:QANCS(0)']""
"RTN","QANUTL1",58,0)
 S QANIC=$P(QANCS(0),U,2),QANSTAT=+$P(QANCS(0),U,8)
"RTN","QANUTL1",59,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Patient: ",$P(QANPT(0),U),?45,"Patient ID: ",$P(QANPT0(0),U,2)
"RTN","QANUTL1",60,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Case Number: ",$P(QANCS(0),U),?45,"Incident: ",$S(QANIC]"":$P(^QA(742.1,QANIC,0),U),1:"<NONE>")
"RTN","QANUTL1",61,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Date of the Incident: " S Y=$P(QANCS(0),U,3) X ^DD("DD") W Y,?45,"Incident Status: ",$S(QANSTAT=0:"Closed",QANSTAT=1:"Open",QANSTAT=3:"Open",1:"Deleted")
"RTN","QANUTL1",62,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Incident Location: " W:$P(QANCS(0),U,4)]"" $P(^QA(742.5,$P(QANCS(0),U,4),0),U)
"RTN","QANUTL1",63,0)
 D:$Y>(IOSL-4) HDH1 Q:QANEOP["^"  W !,"Severity Level: " S Y=$P(QANPT0(0),U,10),C=$P(^DD(742,.1,0),U,2) I Y]"" D Y^DIQ W Y
"RTN","QANUTL1",64,0)
 Q
"RTN","QANUTL1",65,0)
ADMDT ;Grab the patient's admission date.
"RTN","QANUTL1",66,0)
 S QANWARD="" ;SETTING THE DEFAULT TO 'NULL'
"RTN","QANUTL1",67,0)
 S DFN=QANPIEN D INP^VADPT S QANADMDT=$S(VAIN(7)]"":+VAIN(7),1:"")
"RTN","QANUTL1",68,0)
 S QANTRSP=$S(VAIN(3)]"":+VAIN(3),1:"")
"RTN","QANUTL1",69,0)
 S QANINPAT=$S($D(^DPT(QANPIEN,.1)):1,1:0)
"RTN","QANUTL1",70,0)
 D:QANINPAT WARD
"RTN","QANUTL1",71,0)
 K DFN,VAIN
"RTN","QANUTL1",72,0)
 Q
"RTN","QANUTL1",73,0)
EDTNME ;Edit the patients name.
"RTN","QANUTL1",74,0)
 K DIE,DR
"RTN","QANUTL1",75,0)
 S DIE="^QA(742,",DA=+Y,DR=".01  Patient" D ^DIE
"RTN","QANUTL1",76,0)
 S:$D(Y) QANXIT=1
"RTN","QANUTL1",77,0)
 S (QANPAT,QANPIEN)=+X
"RTN","QANUTL1",78,0)
 Q:QANXIT!(+X=QAHOLD)  ;Exit on abnormal exit OR same patient
"RTN","QANUTL1",79,0)
 S QA2=$G(^DPT(+X,0)),QANSSN=$P(QA2,U,9),QA1=$P(QA2,U),QANDOB=$P(QA2,U,3)
"RTN","QANUTL1",80,0)
 S QANPID=$$QANPID^QANCDNT(QA1)
"RTN","QANUTL1",81,0)
 D ADMDT ;Grab ward, t spec, admit date, and patient type for new patient
"RTN","QANUTL1",82,0)
 S QANADMDT=$S(QANADMDT]"":QANADMDT,1:"@"),QANTRSP=$S(QANTRSP]"":QANTRSP,1:"@"),QANINPAT=$S(QANINPAT]"":QANINPAT,1:"@"),QANWARD=$S(QANWARD]"":QANWARD,1:"@"),QANPID=$S(QANPID]"":QANPID,1:"")
"RTN","QANUTL1",83,0)
 S DIE="^QA(742,",DA=QANDFN
"RTN","QANUTL1",84,0)
 F DR=".02///"_QANPID,".04///"_QANADMDT,".05///"_QANINPAT,".06///"_QANWARD,".07///"_QANTRSP D ^DIE
"RTN","QANUTL1",85,0)
 K QAUDIT S QAUDIT("FILE")="742^50",QAUDIT("DA")=QANDFN,QAUDIT("ACTION")="e",QAUDIT("COMMENT")="Editing a patient name for an incident record." D ^QAQAUDIT
"RTN","QANUTL1",86,0)
 I +$P(^QA(742.4,QANIEN,0),U,18) D ^QANPEDT ;Update patient name on NQADB
"RTN","QANUTL1",87,0)
 K QAUDIT,QA1,QANSSN,QANADMDT,QANPID,QANINPAT,QANWARD,QANTRSP,QA2,QAHOLD
"RTN","QANUTL1",88,0)
 K QAHDNM,QAHDSSN
"RTN","QANUTL1",89,0)
 Q
"RTN","QANUTL1",90,0)
WARD ;
"RTN","QANUTL1",91,0)
 S QANWARD=$S(VAIN(4)]"":+VAIN(4),1:"") Q:QANWARD=""
"RTN","QANUTL1",92,0)
 I '$D(^DIC(42,QANWARD,0)) S QANWARD="" Q
"RTN","QANUTL1",93,0)
 S QANWARD=$S($D(^DIC(42,QANWARD,44)):+$P(^(44),U),1:"") Q:QANWARD=""
"RTN","QANUTL1",94,0)
 I '$D(^SC(QANWARD,0)) S QANWARD=""
"RTN","QANUTL1",95,0)
 Q
"VER")
8.0^22.0
"BLD",7192,6)
^32
**END**
**END**
