Released PSN*4*78 SEQ #74
Extracted from mail message
**KIDS**:PSN*4.0*78^

**INSTALL NAME**
PSN*4.0*78
"BLD",1868,0)
PSN*4.0*78^NATIONAL DRUG FILE^0^3031211^y
"BLD",1868,1,0)
^^7^7^3031211^^
"BLD",1868,1,1,0)
 
"BLD",1868,1,2,0)
Under certain conditions, if a National Drug File (NDF) data update patch
"BLD",1868,1,3,0)
deleted an ingredient from an entry in the VA PRODUCT file (#50.68),
"BLD",1868,1,4,0)
cross-references in the DRUG INTERACTION file (#56) for other
"BLD",1868,1,5,0)
ingredients in that product were inappropriately deleted.  Patch
"BLD",1868,1,6,0)
PSN*4*77 corrected existing problems.  This patch will prevent further
"BLD",1868,1,7,0)
occurrences.
"BLD",1868,4,0)
^9.64PA^^
"BLD",1868,"ABPKG")
n
"BLD",1868,"KRN",0)
^9.67PA^8989.52^20
"BLD",1868,"KRN",.4,0)
.4
"BLD",1868,"KRN",.401,0)
.401
"BLD",1868,"KRN",.402,0)
.402
"BLD",1868,"KRN",.403,0)
.403
"BLD",1868,"KRN",.5,0)
.5
"BLD",1868,"KRN",.84,0)
.84
"BLD",1868,"KRN",3.6,0)
3.6
"BLD",1868,"KRN",3.8,0)
3.8
"BLD",1868,"KRN",9.2,0)
9.2
"BLD",1868,"KRN",9.8,0)
9.8
"BLD",1868,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1868,"KRN",9.8,"NM",1,0)
PSNXREF^^0^B26757944
"BLD",1868,"KRN",9.8,"NM","B","PSNXREF",1)

"BLD",1868,"KRN",19,0)
19
"BLD",1868,"KRN",19.1,0)
19.1
"BLD",1868,"KRN",101,0)
101
"BLD",1868,"KRN",409.61,0)
409.61
"BLD",1868,"KRN",771,0)
771
"BLD",1868,"KRN",870,0)
870
"BLD",1868,"KRN",8989.51,0)
8989.51
"BLD",1868,"KRN",8989.52,0)
8989.52
"BLD",1868,"KRN",8994,0)
8994
"BLD",1868,"KRN",8994.2,0)
8994.2
"BLD",1868,"KRN","B",.4,.4)

"BLD",1868,"KRN","B",.401,.401)

"BLD",1868,"KRN","B",.402,.402)

"BLD",1868,"KRN","B",.403,.403)

"BLD",1868,"KRN","B",.5,.5)

"BLD",1868,"KRN","B",.84,.84)

"BLD",1868,"KRN","B",3.6,3.6)

"BLD",1868,"KRN","B",3.8,3.8)

"BLD",1868,"KRN","B",9.2,9.2)

"BLD",1868,"KRN","B",9.8,9.8)

"BLD",1868,"KRN","B",19,19)

"BLD",1868,"KRN","B",19.1,19.1)

"BLD",1868,"KRN","B",101,101)

"BLD",1868,"KRN","B",409.61,409.61)

"BLD",1868,"KRN","B",771,771)

"BLD",1868,"KRN","B",870,870)

"BLD",1868,"KRN","B",8989.51,8989.51)

"BLD",1868,"KRN","B",8989.52,8989.52)

"BLD",1868,"KRN","B",8994,8994)

"BLD",1868,"KRN","B",8994.2,8994.2)

"BLD",1868,"PRET")

"BLD",1868,"QUES",0)
^9.62^^
"BLD",1868,"REQB",0)
^9.611^1^1
"BLD",1868,"REQB",1,0)
PSN*4.0*54^2
"BLD",1868,"REQB","B","PSN*4.0*54",1)

"MBREQ")
0
"PKG",131,-1)
1^1
"PKG",131,0)
NATIONAL DRUG FILE^PSN^This is the National Drug File Package V 3.0
"PKG",131,20,0)
^9.402P^^
"PKG",131,22,0)
^9.49I^1^1
"PKG",131,22,1,0)
4.0^2981030^2981207^17
"PKG",131,22,1,"PAH",1,0)
78^3031211
"PKG",131,22,1,"PAH",1,1,0)
^^7^7^3031211
"PKG",131,22,1,"PAH",1,1,1,0)
 
"PKG",131,22,1,"PAH",1,1,2,0)
Under certain conditions, if a National Drug File (NDF) data update patch
"PKG",131,22,1,"PAH",1,1,3,0)
deleted an ingredient from an entry in the VA PRODUCT file (#50.68),
"PKG",131,22,1,"PAH",1,1,4,0)
cross-references in the DRUG INTERACTION file (#56) for other
"PKG",131,22,1,"PAH",1,1,5,0)
ingredients in that product were inappropriately deleted.  Patch
"PKG",131,22,1,"PAH",1,1,6,0)
PSN*4*77 corrected existing problems.  This patch will prevent further
"PKG",131,22,1,"PAH",1,1,7,0)
occurrences.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSNXREF")
0^1^B26757944
"RTN","PSNXREF",1,0)
PSNXREF ;BIR/DMA-Cross references ;04 Dec 98 / 10:44 AM
"RTN","PSNXREF",2,0)
 ;;4.0; NATIONAL DRUG FILE;**3,54,78**; 30 Oct 98
"RTN","PSNXREF",3,0)
 ;
"RTN","PSNXREF",4,0)
ING ;From active ingredients in VA product file - set drug ingredient multiple
"RTN","PSNXREF",5,0)
 N PSNDATA,PSNARG
"RTN","PSNXREF",6,0)
 S PSNDATA=$P(^PSNDF(50.68,DA(1),0),"^",2)_"A"_DA(1) Q:'$P(PSNDATA,"A")
"RTN","PSNXREF",7,0)
 I '$D(^PS(50.416,DA,1,"B",PSNDATA)) S PSNARG=$O(^PS(50.416,DA,1," "),-1)+1,^(PSNARG,0)=PSNDATA,^PS(50.416,DA,1,"B",PSNDATA,PSNARG)=""
"RTN","PSNXREF",8,0)
 S PSNARG=$P(^PS(50.416,DA,0),"^",2),PSNARG=$S(PSNARG:PSNARG,1:DA),^PS(50.416,"APD",PSNDATA,PSNARG)=""
"RTN","PSNXREF",9,0)
 ;
"RTN","PSNXREF",10,0)
INGINT ;now the interactions - get primary - check Xref in 56 - loop thru
"RTN","PSNXREF",11,0)
 ;APS in 50.416
"RTN","PSNXREF",12,0)
 N J,PSNAR,PSN0,PSN1,PSN2,PSN3,PSNC,PSNDA,PSNINT,PSND1
"RTN","PSNXREF",13,0)
 S J=$P(^PS(50.416,DA,0),"^",2),PSNDA=$S(J:J,1:DA)
"RTN","PSNXREF",14,0)
 K PSN2 S PSN2=0,PSNC=0 F  S PSN2=$O(^PS(56,"AE",PSNDA,PSN2)) Q:'PSN2  K PSNAR S PSNAR(PSN2)="",PSNINT=0 F  S PSNINT=$O(^PS(56,"AE",PSNDA,PSN2,PSNINT)) Q:'PSNINT  D
"RTN","PSNXREF",15,0)
 .S PSN0=0 F  S PSN0=$O(^PS(50.416,"APS",PSN2,PSN0)) Q:'PSN0  S PSNAR(PSN0)=""
"RTN","PSNXREF",16,0)
 .S PSN0=0 F  S PSN0=$O(PSNAR(PSN0)),PSN1=0 Q:'PSN0  F  S PSN1=$O(^PS(50.416,PSN0,1,PSN1)) Q:'PSN1  S PSND1=$P(^(PSN1,0),"^"),^PS(56,"APD",PSNDATA,PSND1,PSNINT)="",^PS(56,"APD",PSND1,PSNDATA,PSNINT)="",PSNC=PSNC+2
"RTN","PSNXREF",17,0)
 .I PSNC S $P(^(0),"^",6)=$P(^PS(56,PSNINT,0),"^",6)+PSNC
"RTN","PSNXREF",18,0)
 Q
"RTN","PSNXREF",19,0)
 ;
"RTN","PSNXREF",20,0)
KING ;from active ingredient - kill drug identifier multiple
"RTN","PSNXREF",21,0)
 S PSNDATA=$P(^PSNDF(50.68,DA(1),0),"^",2)_"A"_DA(1)
"RTN","PSNXREF",22,0)
 S PSNARG=$O(^PS(50.416,DA,1,"B",PSNDATA,0)) I PSNARG K ^PS(50.416,DA,1,PSNARG),^PS(50.416,DA,1,"B",PSNDATA)
"RTN","PSNXREF",23,0)
 S PSNARG=$P(^PS(50.416,DA,0),"^",2),PSNARG=$S(PSNARG:PSNARG,1:DA) K ^PS(50.416,"APD",PSNDATA,PSNARG)
"RTN","PSNXREF",24,0)
 ;GET RID OF ALL INTERACTIONS FOR THIS COMBO
"RTN","PSNXREF",25,0)
 S PSNB="^PS(56,""APD"","""_PSNDATA_""")"
"RTN","PSNXREF",26,0)
 F  S PSNB=$Q(@PSNB) Q:$QS(PSNB,3)'=PSNDATA  S PSNC=^PS(56,$QS(PSNB,5),0) I $P(PSNC,"^",2)=PSNARG!($P(PSNC,"^",3)=PSNARG) D
"RTN","PSNXREF",27,0)
 .K @PSNB S PSND=$P(PSNB,",",1,2)_","_$P(PSNB,",",4)_","_$P(PSNB,",",3)_","_$P(PSNB,",",5) K @PSND
"RTN","PSNXREF",28,0)
 Q
"RTN","PSNXREF",29,0)
 ;
"RTN","PSNXREF",30,0)
INT ;INTERACTIONS
"RTN","PSNXREF",31,0)
 N PSN,PSN1,PSN2,PSN3,PSNA,PSNB,PSNC
"RTN","PSNXREF",32,0)
 S PSN1=$P(^PS(56,DA,0),"^",2),PSN2=$P(^(0),"^",3) Q:PSN1=""  Q:PSN2=""  S PSN1(PSN1)="",PSN2(PSN2)=""
"RTN","PSNXREF",33,0)
 S PSN=0 F  S PSN=$O(^PS(50.416,"APS",PSN1,PSN)) Q:'PSN  S PSN1(PSN)=""
"RTN","PSNXREF",34,0)
 S PSN=0 F  S PSN=$O(^PS(50.416,"APS",PSN2,PSN)) Q:'PSN  S PSN2(PSN)=""
"RTN","PSNXREF",35,0)
 S PSN1=0,PSN2=0,PSNC=0 F  S PSN1=$O(PSN1(PSN1)) Q:'PSN1  F  S PSN2=$O(PSN2(PSN2)) Q:'PSN2  D
"RTN","PSNXREF",36,0)
 .S PSN3=0,PSN4=0 F  S PSN3=$O(^PS(50.416,PSN1,1,PSN3)),PSN4=0 Q:'PSN3  S PSNA=^(PSN3,0) F  S PSN4=$O(^PS(50.416,PSN2,1,PSN4)) Q:'PSN4  S PSNB=^(PSN4,0) S ^PS(56,"APD",PSNA,PSNB,DA)="",^PS(56,"APD",PSNB,PSNA,DA)="",PSNC=PSNC+2
"RTN","PSNXREF",37,0)
 S $P(^PS(56,DA,0),"^",6)=PSNC
"RTN","PSNXREF",38,0)
 Q
"RTN","PSNXREF",39,0)
 ;
"RTN","PSNXREF",40,0)
KINT ;DELETE INTERACTIONS
"RTN","PSNXREF",41,0)
 N PSN,PSN1,PSN2,PSN3,PSN4,PSNA,PSNB
"RTN","PSNXREF",42,0)
 S PSN1=$P(^PS(56,DA,0),"^",2),PSN2=$P(^(0),"^",3),PSN1(PSN1)="",PSN2(PSN2)=""
"RTN","PSNXREF",43,0)
 S PSN=0 F  S PSN=$O(^PS(50.416,"APS",PSN1,PSN)) Q:'PSN  S PSN1(PSN)=""
"RTN","PSNXREF",44,0)
 S PSN=0 F  S PSN=$O(^PS(50.416,"APS",PSN2,PSN)) Q:'PSN  S PSN2(PSN)=""
"RTN","PSNXREF",45,0)
 S PSN1=0,PSN2=0 F  S PSN1=$O(PSN1(PSN1)) Q:'PSN1  F  S PSN2=$O(PSN2(PSN2)) Q:'PSN2  D
"RTN","PSNXREF",46,0)
 .S PSN3=0,PSN4=0 F  S PSN3=$O(^PS(50.416,PSN1,1,PSN3)) Q:'PSN3  S PSNA=^(PSN3,0) F  S PSN4=$O(^PS(50.416,PSN2,1,PSN4)) Q:'PSN4  S PSNB=^(PSN4,0) K ^PS(56,"APD",PSNA,PSNB,DA),^PS(56,"APD",PSNB,PSNA,DA)
"RTN","PSNXREF",47,0)
 Q
"RTN","PSNXREF",48,0)
 ;
"RTN","PSNXREF",49,0)
GENER ;INACTIVE PRODUCTS WHEN GENERIC IS INACTIVATED
"RTN","PSNXREF",50,0)
 N DA1,DA2 S DA1=0 F  S DA1=$O(^PSNDF(50.6,"APRO",DA,DA1)) Q:'DA1  S $P(^PSNDF(50.68,DA1,7),"^",3)=X S DA2=0 F  S DA2=$O(^PSNDF(50.68,"ANDC",DA1,DA2)) Q:'DA2  S $P(^PSNDF(50.67,DA2,0),"^",7)=X
"RTN","PSNXREF",51,0)
 Q
"RTN","PSNXREF",52,0)
 ;
"RTN","PSNXREF",53,0)
KGENER ;REACTIVATE PRODUCTS WHEN GENERIC IS MADE ACTIVE
"RTN","PSNXREF",54,0)
 N DA1,DA2 S DA1=0 F  S DA1=$O(^PSNDF(50.6,"APRO",DA,DA1)) Q:'DA1  S $P(^PSNDF(50.68,DA1,7),"^",3)="" S DA2=0 F  S DA2=$O(^PSNDF(50.68,"ANDC",DA1,DA2)) Q:'DA2  S $P(^PSNDF(50.67,DA2,0),"^",7)=""
"RTN","PSNXREF",55,0)
 Q
"RTN","PSNXREF",56,0)
 ;
"RTN","PSNXREF",57,0)
PROD ;INACTIVATE NDCS WHEN PRODUCTS ARE INACTIVE
"RTN","PSNXREF",58,0)
 N DA2 S DA2=0 F  S DA2=$O(^PSNDF(50.68,"ANDC",DA,DA2)) Q:'DA2  S $P(^PSNDF(50.67,DA2,0),"^",7)=X
"RTN","PSNXREF",59,0)
 Q
"RTN","PSNXREF",60,0)
 ;
"RTN","PSNXREF",61,0)
KPROD ;REACTIVATE NDCS WHEN PRODUCTS ARE MADE ACTIVE
"RTN","PSNXREF",62,0)
 N DA2 S DA2=0 F  S DA2=$O(^PSNDF(50.68,"ANDC",DA,DA2)) Q:'DA2  S $P(^PSNDF(50.67,DA,0),"^",7)=""
"RTN","PSNXREF",63,0)
 Q
"RTN","PSNXREF",64,0)
 ;
"RTN","PSNXREF",65,0)
ING2 ;from VA generic name in file 50.68
"RTN","PSNXREF",66,0)
 N PSNDATA,PSNK,PSNO,PSN1,PSN2,PSN3,PSNINT
"RTN","PSNXREF",67,0)
 S PSNDATA=X_"A"_DA,PSNK=0 F  S PSNK=$O(^PSNDF(50.68,DA,2,PSNK)) Q:'PSNK  S ENT=$O(^PS(50.416,PSNK,1," "),-1)+1,^(ENT,0)=PSNDATA,^PS(50.416,PSNK,1,"B",PSNDATA,ENT)="" D
"RTN","PSNXREF",68,0)
 .;
"RTN","PSNXREF",69,0)
 .;and the interactions
"RTN","PSNXREF",70,0)
 .S PSNO=^PS(50.416,PSNK,0),PSN1=$S($P(PSNO,"^",2):$P(PSNO,"^",2),1:PSNK) Q:'$D(^PS(56,"AE",PSN1))
"RTN","PSNXREF",71,0)
 .S PSN2=0 F  S PSN2=$O(^PS(56,"AE",PSN1,PSN2)) Q:'PSN2  S PSNINT=$O(^(PSN2,0)) D
"RTN","PSNXREF",72,0)
 ..S PSN0=0 F J=0:1 S PSN0=$O(^PS(50.416,"APS",PSN2,PSN0)) Q:'PSN0  S PSN3=0  F  S PSN3=$O(^PS(50.416,PSN0,1,PSN3)) Q:'PSN3  S PSND1=$P(^(PSN3,0),"^"),^PS(56,"APD",PSNDATA,PSND1,PSNINT)="",^PS(56,"APD",PSND1,PSNDATA,PSNINT)=""
"RTN","PSNXREF",73,0)
 ..S $P(^(0),"^",6)=$P(^PS(56,PSNINT,0),"^",6)+J
"RTN","PSNXREF",74,0)
 Q
"RTN","PSNXREF",75,0)
 ;
"RTN","PSNXREF",76,0)
KING2 ;from VA generic name in file 50.68
"RTN","PSNXREF",77,0)
 N PSNDATA,PSNARG,PSNJ,PSNK
"RTN","PSNXREF",78,0)
 S PSNDATA=X_"^"_DA,PSNK=0
"RTN","PSNXREF",79,0)
 F  S PSNK=$O(^PSNDF(50.68,2,PSNK)) Q:'PSNK  D
"RTN","PSNXREF",80,0)
 .S PSNJ=$O(^PS(50.416,PSNK,1,"B",PSNDATA,0)) I PSNJ K ^(PSNJ),^PS(50.416,PSNK,1,PSNJ)
"RTN","PSNXREF",81,0)
 .S PSNO="" F  S PSNO=$O(^PS(56,"APD",PSNDATA,PSNO)) Q:PSNO=""  K ^(PSNO),^PS(56,"APD",PSNO,PSNDATA)
"RTN","PSNXREF",82,0)
 Q
"RTN","PSNXREF",83,0)
 ;
"VER")
8.0^22.0
**END**
**END**
