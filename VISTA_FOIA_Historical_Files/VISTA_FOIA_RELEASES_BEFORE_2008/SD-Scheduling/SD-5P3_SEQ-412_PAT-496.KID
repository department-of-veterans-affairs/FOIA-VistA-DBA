Released SD*5.3*496 SEQ #412
Extracted from mail message
**KIDS**:SD*5.3*496^

**INSTALL NAME**
SD*5.3*496
"BLD",7084,0)
SD*5.3*496^SCHEDULING^0^3070423^y
"BLD",7084,1,0)
^^3^3^3070423^
"BLD",7084,1,1,0)
This patch addresses several issues related to Scheduling, including one
"BLD",7084,1,2,0)
related also to integrity of the REQUEST/CONSULTATION file (#123) 
"BLD",7084,1,3,0)
accessed from a scheduling routine.
"BLD",7084,4,0)
^9.64PA^409.3^1
"BLD",7084,4,409.3,0)
409.3
"BLD",7084,4,409.3,2,0)
^9.641^409.3^1
"BLD",7084,4,409.3,2,409.3,0)
SD WAIT LIST  (File-top level)
"BLD",7084,4,409.3,2,409.3,1,0)
^9.6411^7^1
"BLD",7084,4,409.3,2,409.3,1,7,0)
WL SERVICE/SPECIALTY
"BLD",7084,4,409.3,222)
y^n^p^^^^n^^n
"BLD",7084,4,409.3,224)

"BLD",7084,4,"APDD",409.3,409.3)

"BLD",7084,4,"APDD",409.3,409.3,7)

"BLD",7084,4,"B",409.3,409.3)

"BLD",7084,6)
3^
"BLD",7084,6.3)
11
"BLD",7084,"INIT")
POST^SD53P496
"BLD",7084,"KRN",0)
^9.67PA^8989.52^19
"BLD",7084,"KRN",.4,0)
.4
"BLD",7084,"KRN",.401,0)
.401
"BLD",7084,"KRN",.402,0)
.402
"BLD",7084,"KRN",.403,0)
.403
"BLD",7084,"KRN",.5,0)
.5
"BLD",7084,"KRN",.84,0)
.84
"BLD",7084,"KRN",3.6,0)
3.6
"BLD",7084,"KRN",3.8,0)
3.8
"BLD",7084,"KRN",9.2,0)
9.2
"BLD",7084,"KRN",9.8,0)
9.8
"BLD",7084,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7084,"KRN",9.8,"NM",1,0)
SDM4^^0^B35143578
"BLD",7084,"KRN",9.8,"NM",2,0)
SDAMOCP1^^0^B18032029
"BLD",7084,"KRN",9.8,"NM",3,0)
SDCNSLT^^0^B40644653
"BLD",7084,"KRN",9.8,"NM","B","SDAMOCP1",2)

"BLD",7084,"KRN",9.8,"NM","B","SDCNSLT",3)

"BLD",7084,"KRN",9.8,"NM","B","SDM4",1)

"BLD",7084,"KRN",19,0)
19
"BLD",7084,"KRN",19,"NM",0)
^9.68A^^
"BLD",7084,"KRN",19.1,0)
19.1
"BLD",7084,"KRN",101,0)
101
"BLD",7084,"KRN",409.61,0)
409.61
"BLD",7084,"KRN",771,0)
771
"BLD",7084,"KRN",870,0)
870
"BLD",7084,"KRN",8989.51,0)
8989.51
"BLD",7084,"KRN",8989.52,0)
8989.52
"BLD",7084,"KRN",8994,0)
8994
"BLD",7084,"KRN","B",.4,.4)

"BLD",7084,"KRN","B",.401,.401)

"BLD",7084,"KRN","B",.402,.402)

"BLD",7084,"KRN","B",.403,.403)

"BLD",7084,"KRN","B",.5,.5)

"BLD",7084,"KRN","B",.84,.84)

"BLD",7084,"KRN","B",3.6,3.6)

"BLD",7084,"KRN","B",3.8,3.8)

"BLD",7084,"KRN","B",9.2,9.2)

"BLD",7084,"KRN","B",9.8,9.8)

"BLD",7084,"KRN","B",19,19)

"BLD",7084,"KRN","B",19.1,19.1)

"BLD",7084,"KRN","B",101,101)

"BLD",7084,"KRN","B",409.61,409.61)

"BLD",7084,"KRN","B",771,771)

"BLD",7084,"KRN","B",870,870)

"BLD",7084,"KRN","B",8989.51,8989.51)

"BLD",7084,"KRN","B",8989.52,8989.52)

"BLD",7084,"KRN","B",8994,8994)

"BLD",7084,"QUES",0)
^9.62^^
"BLD",7084,"REQB",0)
^9.611^3^3
"BLD",7084,"REQB",1,0)
SD*5.3*478^2
"BLD",7084,"REQB",2,0)
SD*5.3*487^2
"BLD",7084,"REQB",3,0)
SD*5.3*417^2
"BLD",7084,"REQB","B","SD*5.3*417",3)

"BLD",7084,"REQB","B","SD*5.3*478",1)

"BLD",7084,"REQB","B","SD*5.3*487",2)

"FIA",409.3)
SD WAIT LIST
"FIA",409.3,0)
^SDWL(409.3,
"FIA",409.3,0,0)
409.3IP
"FIA",409.3,0,1)
y^n^p^^^^n^^n
"FIA",409.3,0,10)

"FIA",409.3,0,11)

"FIA",409.3,0,"RLRO")

"FIA",409.3,0,"VR")
5.3^SD
"FIA",409.3,409.3)
1
"FIA",409.3,409.3,7)

"INIT")
POST^SD53P496
"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
496^3070423^100892
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3070423
"PKG",16,22,1,"PAH",1,1,1,0)
This patch addresses several issues related to Scheduling, including one
"PKG",16,22,1,"PAH",1,1,2,0)
related also to integrity of the REQUEST/CONSULTATION file (#123) 
"PKG",16,22,1,"PAH",1,1,3,0)
accessed from a scheduling routine.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SD53P496")
0^^B3431434^n/a
"RTN","SD53P496",1,0)
SD53P496 ;ALB/ESW - SD*5.3*496 POST INIT; Oct 04, 2006 ; 10/23/06 5:40pm  ; 4/16/07 5:27pm
"RTN","SD53P496",2,0)
 ;;5.3;SCHEDULING;**496**;AUG 13, 1993;Build 11
"RTN","SD53P496",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","SD53P496",4,0)
 ;Clean ^GMR(123,"F"  cross-reference, used to search by patient to
"RTN","SD53P496",5,0)
 ;get REQUEST/CONSULTATION ien, through verification that each cross-
"RTN","SD53P496",6,0)
 ;reference entry has its corresponding REQUEST/CONSULTATION entry pointed to.
"RTN","SD53P496",7,0)
 Q
"RTN","SD53P496",8,0)
 ;
"RTN","SD53P496",9,0)
POST ;
"RTN","SD53P496",10,0)
 N SDA
"RTN","SD53P496",11,0)
 S SDA(1)="",SDA(2)="    SD*5.3*496 Post-Install .....",SDA(3)="" D ATADDQ
"RTN","SD53P496",12,0)
 S SDA(1)="  >> Verifying if )'^GMR(123,""F"",SDPT,SDIN)' have corresponding"
"RTN","SD53P496",13,0)
 S SDA(2)="     '0' entries in the REQUEST/CONSULTATION file (# 123), and remove them if not."
"RTN","SD53P496",14,0)
 N SDPT,SDIN,DA,SDREF,CNT S CNT=0
"RTN","SD53P496",15,0)
 S SDPT="" F  S SDPT=$O(^GMR(123,"F",SDPT)) Q:SDPT'>0  D
"RTN","SD53P496",16,0)
 .S SDIN="" F  S SDIN=$O(^GMR(123,"F",SDPT,SDIN)) Q:SDIN=""  D
"RTN","SD53P496",17,0)
 ..I $G(^GMR(123,SDIN,0))="" S CNT=CNT+1 D  S SDREF=^GMR(123,"F",SDPT,SDIN) K ^(SDIN),SDREF
"RTN","SD53P496",18,0)
 ...N SDA
"RTN","SD53P496",19,0)
 ...S SDA(1)="Entry "_SDIN_" - Patient DFN= "_SDPT_" does not have '0' node"
"RTN","SD53P496",20,0)
 ...S SDA(2)="      ""F"" - cross-reference deleted."
"RTN","SD53P496",21,0)
 ...D ATADDQ
"RTN","SD53P496",22,0)
 I 'CNT N SDA S SDA(1)=" No bad ""F"" cross-references identified"
"RTN","SD53P496",23,0)
 E  N SDA S SDA(1)="  "_CNT_" 'hanging' ""F"""_" cross-references identified"
"RTN","SD53P496",24,0)
 S SDA(2)="  SD*5.3*496 Post-Install finished."
"RTN","SD53P496",25,0)
 D ATADDQ
"RTN","SD53P496",26,0)
 Q
"RTN","SD53P496",27,0)
 ;
"RTN","SD53P496",28,0)
ATADDQ D MES^XPDUTL(.SDA) K SDA
"RTN","SD53P496",29,0)
 Q
"RTN","SDAMOCP1")
0^2^B18032029^B17836724
"RTN","SDAMOCP1",1,0)
SDAMOCP1 ;IOFO BAY PINES/TEH - Detail Print for Cancelled Statistics;4/15/92  ; Compiled January 25, 2007 12:00:46
"RTN","SDAMOCP1",2,0)
 ;;5.3;Scheduling;**487,496**;Aug 13, 1993;Build 11
"RTN","SDAMOCP1",3,0)
 ;
"RTN","SDAMOCP1",4,0)
HDR ;Report Header
"RTN","SDAMOCP1",5,0)
 ;
"RTN","SDAMOCP1",6,0)
 N SDSTOP
"RTN","SDAMOCP1",7,0)
 I SDPAGE>1,$E(IOST,1,2)="C-" D PAUSE^VALM1 I 'Y S SDSTOP=1 Q
"RTN","SDAMOCP1",8,0)
HDR1 W @IOF
"RTN","SDAMOCP1",9,0)
 W !,?50,"Cancelled Clinic Report - Detail"
"RTN","SDAMOCP1",10,0)
 W !,?50,"Date Range: ",$$FDATE^VALM1(SDBEG)_" to "_$$FDATE^VALM1(SDEND)
"RTN","SDAMOCP1",11,0)
 D NOW^%DTC
"RTN","SDAMOCP1",12,0)
 W !,?54,"Run Date: ",$E($$FDTTM^VALM1(%),1,14)
"RTN","SDAMOCP1",13,0)
 W !,?62,"Page: ",SDPAGE S SDPAGE=SDPAGE+1
"RTN","SDAMOCP1",14,0)
 W !,"Division"
"RTN","SDAMOCP1",15,0)
 W !,SDASH,!
"RTN","SDAMOCP1",16,0)
 W "Status",?8,"Patient",?30,"SSN",?39,"Appt Date",?61,"Clinic",?81,"Cancel Date",?106,"User",!
"RTN","SDAMOCP1",17,0)
 W SDASH
"RTN","SDAMOCP1",18,0)
 Q
"RTN","SDAMOCP1",19,0)
 ;
"RTN","SDAMOCP1",20,0)
BLD ;Build output from ^TMP global
"RTN","SDAMOCP1",21,0)
 ;
"RTN","SDAMOCP1",22,0)
 N SDTOT,SDTOTT,SDCL,SDDATE,SDUSER,SDCDT
"RTN","SDAMOCP1",23,0)
 D HDR
"RTN","SDAMOCP1",24,0)
 I IOST["P-" K DIRUT
"RTN","SDAMOCP1",25,0)
 S (SDSTOP,SDTOTT,SDFLG)=0,SDDV="" F  S SDDV=$O(^TMP("SDAMCD",$J,SDDV)) Q:SDDV=""!(SDSTOP)  D CHK D
"RTN","SDAMOCP1",26,0)
 .S SDDVNM=$P($G(^DG(40.8,SDDV,0)),U) W !,SDDVNM
"RTN","SDAMOCP1",27,0)
 .S SDCR="" F  S SDCR=$O(^TMP("SDAMCD",$J,SDDV,SDCR)) Q:SDCR=""!($D(DIRUT))  S SDTOT(SDCR)=0 D  W !!,"SUBTOTAL:",$J(SDTOT(SDCR),4),!
"RTN","SDAMOCP1",28,0)
 ..S SDCL="" F  S SDCL=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL)) Q:SDCL=""!($D(DIRUT))  D 
"RTN","SDAMOCP1",29,0)
 ...S SDDATE="" F  S SDDATE=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE)) Q:SDDATE=""!($D(DIRUT))  D
"RTN","SDAMOCP1",30,0)
 ....S SDDFN="" F  S SDDFN=$O(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE,SDDFN)) Q:SDDFN=""!($D(DIRUT))  D
"RTN","SDAMOCP1",31,0)
 .....S SDDATA=$G(^TMP("SDAMCD",$J,SDDV,SDCR,SDCL,SDDATE,SDDFN))
"RTN","SDAMOCP1",32,0)
 .....S Y=$P(SDDATA,";",2) D DD^%DT S SDAPDT=Y
"RTN","SDAMOCP1",33,0)
 .....D GETS^DIQ(2,SDDFN_",",".01;.09",,"SDRES","SDMES") S SDNM=$E($G(SDRES(2,SDDFN_",",.01)),1,20),SDSSN=$E($G(SDRES(2,SDDFN_",",.09)),6,9)
"RTN","SDAMOCP1",34,0)
 .....S Y=$P(SDDATA,U,14) D DD^%DT S SDCDT=Y S SDUSER=$P(SDDATA,U,12)
"RTN","SDAMOCP1",35,0)
 .....S SDUSERNM=$$GET1^DIQ(200,SDUSER_",",.01,,"SDRES","SDMES")
"RTN","SDAMOCP1",36,0)
 .....S SDCLNM=$$GET1^DIQ(44,SDCL_",",.01,,"SDRES","SDMES")
"RTN","SDAMOCP1",37,0)
 .....W !,SDCR,?8,$E(SDNM,1,22),?30,SDSSN,?39,SDAPDT,?61,$E(SDCLNM,1,18),?81,SDCDT,?106,$E(SDUSERNM,1,26)
"RTN","SDAMOCP1",38,0)
 .....K SDRES,SDMES ;SD/496
"RTN","SDAMOCP1",39,0)
 .....D CHK I $D(DIRUT) Q 
"RTN","SDAMOCP1",40,0)
 .....S SDTOT(SDCR)=$G(SDTOT(SDCR))+1,SDTOTT=SDTOTT+1
"RTN","SDAMOCP1",41,0)
 W !!,"TOTAL CANCELLATIONS:",$J(SDTOTT,14)
"RTN","SDAMOCP1",42,0)
 W !!,"End of Report!"
"RTN","SDAMOCP1",43,0)
 K SDUSERNM,SDSSN,SDAPDT,SDCLNM,SDRES,SDNM,SDCR,SDDDATE,SDDFN,SDDATA,SDDVNM,SDCLNM
"RTN","SDAMOCP1",44,0)
 I IOST["P-" S DIRUT=1
"RTN","SDAMOCP1",45,0)
BLDQ Q
"RTN","SDAMOCP1",46,0)
 ;
"RTN","SDAMOCP1",47,0)
MCTOT ;
"RTN","SDAMOCP1",48,0)
 N SDFLG,SDDV,SDNXT
"RTN","SDAMOCP1",49,0)
 S SDFLG=1,SDDV="" D HDR F  S SDDV=$O(^TMP("SDAMS",$J,SDDV)) Q:SDDV=""  D  Q:SDSTOP
"RTN","SDAMOCP1",50,0)
 .W !,$P($G(^DG(40.8,SDDV,0)),U)
"RTN","SDAMOCP1",51,0)
 .K SDTOT,SDCNT D TOTAL
"RTN","SDAMOCP1",52,0)
 .W ?124,$J(SDTOT,8)
"RTN","SDAMOCP1",53,0)
 .D CHK Q:SDSTOP
"RTN","SDAMOCP1",54,0)
 .S SDNXT=$O(^TMP("SDAMS",$J,SDDV)) W:SDNXT'="" !,SDASH
"RTN","SDAMOCP1",55,0)
 .K SDTOT,SDCNT
"RTN","SDAMOCP1",56,0)
 W !,SDTDASH,!,"TOTAL" F SDI=1:1:11 S SDCNT(SDI)=+$G(SDAT("SDAMS",$J,SDI)),SDTOT=$G(SDTOT)+$G(SDCNT(SDI))
"RTN","SDAMOCP1",57,0)
 D CNT
"RTN","SDAMOCP1",58,0)
 W ?124,$J(SDTOT,8) K SDTOT,SDCNT D CHK I SDSTOP G MCTOTQ
"RTN","SDAMOCP1",59,0)
 W !! D LEGEND
"RTN","SDAMOCP1",60,0)
MCTOTQ Q
"RTN","SDAMOCP1",61,0)
CNT ;Place no-show/no-show auto rebook & cancel/cancel auto-rebook together
"RTN","SDAMOCP1",62,0)
 S SDCNT(4)=+$G(SDCNT(4))+(+$G(SDCNT(6))),SDCNT(13)=+$G(SDCI(+SDCL,4))+(+$G(SDCI(+SDCL,6)))
"RTN","SDAMOCP1",63,0)
 S SDCNT(5)=+$G(SDCNT(5))+(+$G(SDCNT(7))),SDCNT(14)=+$G(SDCI(+SDCL,5))+(+$G(SDCI(+SDCL,7)))
"RTN","SDAMOCP1",64,0)
 F SDI=1,2,3,4,13,6,5,14,7,8 D
"RTN","SDAMOCP1",65,0)
 .W ?$$COL(SDI),$J($S($D(SDCNT(SDI)):SDCNT(SDI),1:0),$$LEN(SDI))
"RTN","SDAMOCP1",66,0)
 Q
"RTN","SDAMOCP1",67,0)
 ;
"RTN","SDAMOCP1",68,0)
CHK ;Check to pause on screen
"RTN","SDAMOCP1",69,0)
 N SDY
"RTN","SDAMOCP1",70,0)
 I $E(IOST,1,2)="C-",($Y+8)>IOSL D PAUSE^VALM1 S SDY=Y D:SDY HDR1 I 'SDY S SDSTOP=1 Q
"RTN","SDAMOCP1",71,0)
 I ($Y+8)>IOSL D HDR1
"RTN","SDAMOCP1",72,0)
 Q
"RTN","SDAMOCP1",73,0)
TOTAL ;Totals
"RTN","SDAMOCP1",74,0)
 F SDI=1:1:11 S SDCNT(SDI)=+$G(SDCL("SDAMS",$J,SDDV,SDI)),SDTOT=$G(SDTOT)+$G(SDCNT(SDI))
"RTN","SDAMOCP1",75,0)
 D CNT
"RTN","SDAMOCP1",76,0)
 K SDCNT
"RTN","SDAMOCP1",77,0)
 Q
"RTN","SDAMOCP1",78,0)
 ;
"RTN","SDAMOCP1",79,0)
LEGEND ;Legend on bottom of output
"RTN","SDAMOCP1",80,0)
 ;
"RTN","SDAMOCP1",81,0)
 W !,?5,"o CI=Checked In ; RB=Rebooked"
"RTN","SDAMOCP1",82,0)
 W !,?5,"o 'Cancelled' appointments only reflect appointments cancelled using 'Cancel Clinic Availability'."
"RTN","SDAMOCP1",83,0)
 W !,?5,"o 'Checked-In' does not include no-shows or cancelled appointments that have been checked in."
"RTN","SDAMOCP1",84,0)
 Q
"RTN","SDAMOCP1",85,0)
 ;
"RTN","SDAMOCP1",86,0)
COL(SDI) ;Column placement of appt. status
"RTN","SDAMOCP1",87,0)
 ;
"RTN","SDAMOCP1",88,0)
 ;input - SDI (appt. type)
"RTN","SDAMOCP1",89,0)
 ;output - column placement
"RTN","SDAMOCP1",90,0)
 Q $S(SDI=1:34,SDI=2:48,SDI=3:63,SDI=4:81,SDI=5:97,SDI=6:92,SDI=7:108,SDI=8:114,SDI=13:87,SDI=14:103)
"RTN","SDAMOCP1",91,0)
 ;
"RTN","SDAMOCP1",92,0)
LEN(SDI) ;Length of column
"RTN","SDAMOCP1",93,0)
 ;
"RTN","SDAMOCP1",94,0)
 ;input - SDI (appt. type)
"RTN","SDAMOCP1",95,0)
 ;output - length of column
"RTN","SDAMOCP1",96,0)
 Q $S(SDI=1:10,SDI=2:11,SDI=3:15,SDI=4:5,SDI=6:4,SDI=5:5,SDI=7:4,SDI=8:9,SDI=13:4,SDI=14:4)
"RTN","SDAMOCP1",97,0)
 ;
"RTN","SDCNSLT")
0^3^B40644653^B40454930
"RTN","SDCNSLT",1,0)
SDCNSLT ;ALB/HAG-LINK APPOINTMENTS TO CONSULTS; 4/12/05 3:44pm  ; Compiled February 5, 2007 14:09:59
"RTN","SDCNSLT",2,0)
 ;;5.3;Scheduling;**478,496**;Aug 13, 1993;Build 11
"RTN","SDCNSLT",3,0)
A ;===GET ACTIVE AND PENDING CONSULT
"RTN","SDCNSLT",4,0)
 N A,ND,CNT,CONS,CPRSTAT,DTENTR,DTIN,DTLMT,DTR,NOS,NOSHOW,SENDER,SERVICE,SRV,P8,PROC,PT,PTNM,STATUS
"RTN","SDCNSLT",5,0)
 K TMP S NOSHOW="no-show",CNT=0,$P(DSH,"-",IOM-1)="",PT=DFN,X1=DT,X2=-365 D C^%DTC S DTLMT=X
"RTN","SDCNSLT",6,0)
 S A=":" F  S A=$O(^GMR(123,"F",PT,A),-1) Q:'+A  S ND=$G(^GMR(123,A,0)) Q:ND=""  S PROC=$P($G(^GMR(123,A,1.11)),U),DTENTR=$P(ND,U) I DTENTR>DTLMT S CPRSTAT=$P(ND,U,12) D:CPRSTAT=5!(CPRSTAT=6)!(CPRSTAT=8)!(CPRSTAT=13)
"RTN","SDCNSLT",7,0)
 .I STPCOD'="" S SRV=$P(ND,U,5) Q:'+SRV  I $D(^GMR(123.5,"AB1",STPCOD,SRV)) S PTIEN=$P(ND,U,2) D
"RTN","SDCNSLT",8,0)
 ..I CPRSTAT=8 S SHOW=0 Q:$D(^SC("AWAS1",A))  S NOS=$O(^GMR(123,A,40,":"),-1) Q:'+NOS  S X2=$P($G(^GMR(123,A,40,NOS,0)),U),X1=DT D ^%DTC Q:X'=""&(X>180)  D SCHED(PTIEN,STPCOD,.SHOW) Q:'SHOW
"RTN","SDCNSLT",9,0)
 ..;CPRSTAT 13 is a cancel
"RTN","SDCNSLT",10,0)
 ..I CPRSTAT=13 S NOS=$O(^GMR(123,A,40,":"),-1) Q:'+NOS  S NOS=$O(^GMR(123,A,40,NOS),-1) Q:'+NOS  S X2=$P($G(^GMR(123,A,40,NOS,0)),U),X1=DT D ^%DTC Q:X'=""&(X>180)  S COMMENT=$G(^GMR(123,A,40,NOS,1,1,0)) Q:COMMENT'[NOSHOW
"RTN","SDCNSLT",11,0)
 ..S:+PTIEN PTNM=$P(^DPT(PTIEN,0),U) S SERVICE=$P(^GMR(123.5,SRV,0),U),STATUS=$P(^ORD(100.01,CPRSTAT,0),U),SENDER=$P(ND,U,14) S:+SENDER SENDER=$P(^VA(200,SENDER,0),U)
"RTN","SDCNSLT",12,0)
 ..S Y=DTENTR D DD^%DT S DTIN=Y,DTR=$E(DTENTR,4,5)_"/"_$E(DTENTR,6,7)_"/"_$E(DTENTR,2,3)_"@"_$P(Y,"@",2)
"RTN","SDCNSLT",13,0)
 ..S CNT=CNT+1,TMP(CNT)=PTIEN_U_SERVICE_U_SENDER_U_STATUS_U_DTR_U_A_U_DTIN_U_$P(ND,U,17)_U_PROC
"RTN","SDCNSLT",14,0)
 Q:'$D(TMP)
"RTN","SDCNSLT",15,0)
QST N DIR,DTOUT,DUOUT,CNSULT
"RTN","SDCNSLT",16,0)
 S DIR(0)="Y",DIR("A")="Will this appointment be for a CONSULT/PROCEDURE",DIR("B")="YES",DIR("?")="Answer 'Y'es if appointment is for a Consult or Procedure." W ! D ^DIR S CNSULT=Y
"RTN","SDCNSLT",17,0)
 I CNSULT[U!(CNSULT=0)!(CNSULT="") K TMP Q
"RTN","SDCNSLT",18,0)
HDR W !!,"Please select from the list of consult(s), press 0 for none.",!
"RTN","SDCNSLT",19,0)
 W !,PTNM,!!,"#  Service",?27,"Sending Provider",?45,"Request Date",?60,"Cons #",?68,"Reqst Type",!,DSH
"RTN","SDCNSLT",20,0)
 S A=0 F  S A=$O(TMP(A)) Q:'+A  S ND=TMP(A),P8=$P(ND,U,8) W !,A,". ",$S(P8="P":$E($P(ND,U,9),1,23),1:$E($P(ND,U,2),1,23)),?27,$E($P(ND,U,3),1,17),?45,$E($P(ND,U,5),1,14)," ",$P(ND,U,6) W ?68,$S(P8="P":"Procedure",P8="C":"Consult",1:"")
"RTN","SDCNSLT",21,0)
 W !
"RTN","SDCNSLT",22,0)
READ R !,"Select Consult: ",CONS:DTIME G:CONS="" A
"RTN","SDCNSLT",23,0)
 I CONS=0!(CONS[U) W " ... NONE." K TMP Q
"RTN","SDCNSLT",24,0)
 I "? "[CONS W !," Select consult by number on the left side." G READ
"RTN","SDCNSLT",25,0)
 I '$D(TMP(CONS)) W *7," ?? Select consult by number on the left side." G READ
"RTN","SDCNSLT",26,0)
 S CNSLTLNK=$P(TMP(CONS),U,6)
"RTN","SDCNSLT",27,0)
 Q
"RTN","SDCNSLT",28,0)
SCHED(PTIEN,STPCOD,SHOW) ;===CONSULT IS SCHEDULE NOW CHECK IF IT HAS APPOINTMENT BY STOP CODE.
"RTN","SDCNSLT",29,0)
 N APT,CLNC,B,S1,S2,S3,S4,STOP,STOPCOD,X,Y
"RTN","SDCNSLT",30,0)
 S %DT="ST",X="T-1" D ^%DT S APT=Y,S1=0,STOP=0 F  S APT=$O(^DPT(PTIEN,"S",APT)) Q:'+APT!(STOP)  S S1=1,CLNC=$P(^DPT(PTIEN,"S",APT,0),U) I CLNC'="" S STOPCOD=$P(^SC(CLNC,0),U,7) I STOPCOD'="" S S2=0 I STOPCOD=STPCOD S S2=1 D
"RTN","SDCNSLT",31,0)
 .S S3=0,S4=0,B=0 F  S B=$O(^SC(CLNC,"S",APT,1,B)) Q:'+B!(STOP)  S S3=1 D
"RTN","SDCNSLT",32,0)
 ..I ($P($G(^SC(CLNC,"S",APT,1,B,0)),U)=PTIEN) S S4=1,STOP=1,SHOW=0
"RTN","SDCNSLT",33,0)
 I S1=0 S SHOW=1 Q  ;show if no appointment in the patient side
"RTN","SDCNSLT",34,0)
 I S2=0 S SHOW=1 Q  ;show if stop code does not match
"RTN","SDCNSLT",35,0)
 I S3=0 S SHOW=1 Q  ;show if no appointment in the clinic
"RTN","SDCNSLT",36,0)
 I S4=0 S SHOW=1 Q  ;show if patient does not match in appointment
"RTN","SDCNSLT",37,0)
 Q
"RTN","SDCNSLT",38,0)
LINK(SC,SDY,SD,CNSLTLNK) ;===LINK APPOINTMENT TO CONSULT
"RTN","SDCNSLT",39,0)
 N DA,DIE,DR,TDA,X
"RTN","SDCNSLT",40,0)
 S TDA=SDY,DA(2)=SC,DA(1)=SD,DA=TDA,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,",DR="688////^S X=CNSLTLNK" D ^DIE
"RTN","SDCNSLT",41,0)
 Q
"RTN","SDCNSLT",42,0)
EDITCS(SD,TMPD,TMPYCLNC,CNSLTLNK) ;===MARK CONSULT AS SCHEDULED
"RTN","SDCNSLT",43,0)
 N CSCHDT,SNDPRV,TME,X,Y,COMMENT,ER
"RTN","SDCNSLT",44,0)
 S %DT="ST",X="NOW" D ^%DT S CSCHDT=Y
"RTN","SDCNSLT",45,0)
 S SNDPRV=$P($G(^GMR(123,CNSLTLNK,0)),U,14),Y=SD D DD^%DT S TME=$P($P(Y,"@",2),":",1,2)
"RTN","SDCNSLT",46,0)
 S COMMENT(1)=$P(TMPYCLNC,U,2)_" Consult Appt. on "_$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_TME
"RTN","SDCNSLT",47,0)
 S COMMENT(2)=TMPD
"RTN","SDCNSLT",48,0)
 D SCH^SDQQCN2(.ER,CNSLTLNK,SNDPRV,CSCHDT,0,,.COMMENT) K COMMENT
"RTN","SDCNSLT",49,0)
 Q
"RTN","SDCNSLT",50,0)
CANCEL ;===appt was cancelled then mark consult as edit/resubmit, add comment.
"RTN","SDCNSLT",51,0)
 N APPT,CONSULT,CPRSSTAT,ER,GM40,GMRND,SDPATNT,USER,SNDPRV,J
"RTN","SDCNSLT",52,0)
 ;Variables CNDIE, CNDA and CNINDX used in calling routine for Cancel letter printed comment in consult.
"RTN","SDCNSLT",53,0)
 S:$D(SCLNK) CONSULT=SCLNK
"RTN","SDCNSLT",54,0)
 S:'$D(SCLNK) CONSULT=$P($G(^SC(SDSC,"S",SDTTM,1,SDPL,"CONS")),U)
"RTN","SDCNSLT",55,0)
 Q:'+CONSULT
"RTN","SDCNSLT",56,0)
 S:$D(SCSNOD) SDPATNT=$P(SCSNOD,U)
"RTN","SDCNSLT",57,0)
 S:'$D(SCSNOD) SDPATNT=$P($G(^SC(SDSC,"S",SDTTM,1,SDPL,0)),U)
"RTN","SDCNSLT",58,0)
 S CPRSSTAT=$P($G(^GMR(123,CONSULT,0)),U,12) I CPRSSTAT'="" S CPRSSTAT=$P($G(^ORD(100.01,CPRSSTAT,0)),U) Q:CPRSSTAT'="SCHEDULED"
"RTN","SDCNSLT",59,0)
 S SNDPRV=$P($G(^GMR(123,CONSULT,0)),U,14)
"RTN","SDCNSLT",60,0)
 S USER=$P(^VA(200,DUZ,0),U),Y=SDTTM D DD^%DT S APPT=$E(SDTTM,4,5)_"/"_$E(SDTTM,6,7)_"/"_$E(SDTTM,2,3)_" @ "_$P(Y,"@",2)
"RTN","SDCNSLT",61,0)
 S COMMENT(1)=$P(^SC(SDSC,0),U)_" Appt. on "_APPT_" was cancelled"_$S($D(SDWH):$S(SDWH["P":" by the Patient.",SDWH["C":" by the Clinic.",1:"."),$D(SDADM):" for administrative purposes.",1:", whole clinic.")
"RTN","SDCNSLT",62,0)
 S CNINDX=2 S:$D(TMPD) COMMENT(2)="Remarks: "_TMPD,CNINDX=CNINDX+1 K TMPD
"RTN","SDCNSLT",63,0)
 N SDERR S SDERR=$$STATUS^GMRCGUIS(CONSULT,6,3,SNDPRV,"","",.COMMENT)
"RTN","SDCNSLT",64,0)
 S CNDIE="^GMR(123,"_CONSULT_",40,",CNDA=+$G(COMMENT(0))
"RTN","SDCNSLT",65,0)
 K COMMENT,DA
"RTN","SDCNSLT",66,0)
 S AUTO(SDSC,SDTTM,SDPATNT)=CONSULT
"RTN","SDCNSLT",67,0)
 S DA(2)=SDSC,DA(1)=SDTTM,DA=SDPL,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,",DR="688///@" D ^DIE
"RTN","SDCNSLT",68,0)
 K SCSNOD,SDADM,SCLNK
"RTN","SDCNSLT",69,0)
 Q
"RTN","SDCNSLT",70,0)
AUTOREB(SC,NDATE,LNK,CY) ;===AUTO REBOOK
"RTN","SDCNSLT",71,0)
 N DIC,DA,DIE,DR,Y,TME,SNDPRV,CSCHDT,COMMENT,ER
"RTN","SDCNSLT",72,0)
 S DA(2)=SC,DA(1)=NDATE,DA=CY,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,",DR="688////^S X=LNK" D ^DIE
"RTN","SDCNSLT",73,0)
 S Y=NDATE D DD^%DT S TME=$P(Y,"@",2)
"RTN","SDCNSLT",74,0)
 S COMMENT(1)=$P(^SC(SC,0),U)_" Consult Appt. on "_$E(NDATE,4,5)_"/"_$E(NDATE,6,7)_"/"_$E(NDATE,2,3)_" @ "_TME_" (Auto Rebooked)."
"RTN","SDCNSLT",75,0)
 S %DT="ST",X="NOW" D ^%DT S CSCHDT=Y
"RTN","SDCNSLT",76,0)
 S SNDPRV=$P($G(^GMR(123,LNK,0)),U,14)
"RTN","SDCNSLT",77,0)
 D SCH^SDQQCN2(.ER,LNK,SNDPRV,CSCHDT,0,,.COMMENT) K COMMENT
"RTN","SDCNSLT",78,0)
 Q
"RTN","SDCNSLT",79,0)
NOSHOW(SC,SDDTM,CNPAT,CNSTLNK,CN,AUTO,NSDIE,NSDA) ;
"RTN","SDCNSLT",80,0)
 ;Appt. was a NoShow, then mark Consult as Edit/Resubmit, add comment using silent call to notify user.
"RTN","SDCNSLT",81,0)
 ;Variables NSDIE and NSDA used in calling routine for NoShow letter printed comment in consult.
"RTN","SDCNSLT",82,0)
 N CSNOD,CPRSSTAT,NOSHOW,CSRQSRV,TPRNT,CSPRT,USER,Y,APPT,COMMENT,DA,DIC,DUZ2,DIC,DR,GM40,GMRND,ER,SNDPRV,J
"RTN","SDCNSLT",83,0)
 S CSNOD=$G(^GMR(123,CNSTLNK,0)),CPRSSTAT=$P(CSNOD,U,12),SNDPRV=$P(CSNOD,U,14),NOSHOW="no-show",AUTO(SC,SDDTM,CNPAT)=CNSTLNK
"RTN","SDCNSLT",84,0)
 I CPRSSTAT'="" S CPRSSTAT=$P($G(^ORD(100.01,CPRSSTAT,0)),U) Q:CPRSSTAT'="SCHEDULED"
"RTN","SDCNSLT",85,0)
 S CSRQSRV=$P(CSNOD,U,5) I CSRQSRV'="" S TPRNT=$P($G(^GMR(123.5,CSRQSRV,123)),U,9) I TPRNT'="" S:$P($G(^%ZIS(1,TPRNT,0)),U)'="" CSPRT=$P(^(0),U) ;reprint consult
"RTN","SDCNSLT",86,0)
 S USER=$P(^VA(200,DUZ,0),U),Y=SDDTM D DD^%DT S APPT=$E(SDDTM,4,5)_"/"_$E(SDDTM,6,7)_"/"_$E(SDDTM,2,3)_" @ "_$P(Y,"@",2)
"RTN","SDCNSLT",87,0)
 S COMMENT(1)=$P(^SC(SC,0),U)_" Appt. on "_APPT_" was a "_NOSHOW_"." ;no-show is a key word used by a search do not change
"RTN","SDCNSLT",88,0)
 N SDERR S SDERR=$$STATUS^GMRCGUIS(CNSTLNK,6,3,SNDPRV,"","",.COMMENT)
"RTN","SDCNSLT",89,0)
 S NSDIE="^GMR(123,"_CNSTLNK_",40,",NSDA=+$G(COMMENT(0))
"RTN","SDCNSLT",90,0)
 K COMMENT,DA
"RTN","SDCNSLT",91,0)
 S DA(2)=SC,DA(1)=SDDTM,DA=CN,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,",DR="688///@" D ^DIE
"RTN","SDCNSLT",92,0)
 I $D(CSPRT) D EN^GMRCP5(CNSTLNK,"C",CSPRT)
"RTN","SDCNSLT",93,0)
 K CNSTLNK Q
"RTN","SDM4")
0^1^B35143578^B34653337
"RTN","SDM4",1,0)
SDM4 ;ALB/BOK - MAKE APPOINTMENT ; 12 APR 1988 1100  ; Compiled April 9, 2007 14:26:51
"RTN","SDM4",2,0)
 ;;5.3;Scheduling;**263,273,327,394,417,496**;Aug 13, 1993;Build 11
"RTN","SDM4",3,0)
 ;
"RTN","SDM4",4,0)
 ;09/15/2002 $N FUNCTION REMOVED AND REPLACED WITH $O - IOFO - BAY PINES - TEH
"RTN","SDM4",5,0)
 ;
"RTN","SDM4",6,0)
 ;DBIA - 1476 For reference to PRIMARY ELIG. ^DPT(IEN,.372).
"RTN","SDM4",7,0)
 ;DBIA - 427  For reference to ^DIC(8).
"RTN","SDM4",8,0)
 ;
"RTN","SDM4",9,0)
 ;09/23/2005 Patch SD*5.3*417 Upper/Lower case useage.
"RTN","SDM4",10,0)
 ;04/09/2007 Patch SD*5.3*496 Accept entry in file 44 without STOP CODE
"RTN","SDM4",11,0)
 ;
"RTN","SDM4",12,0)
 ;
"RTN","SDM4",13,0)
TYPE ;
"RTN","SDM4",14,0)
 D SC
"RTN","SDM4",15,0)
RAT ;Display rated service connected disabilities patch SD*5.3*394
"RTN","SDM4",16,0)
 D 2^VADPT
"RTN","SDM4",17,0)
 W !!,"PATIENT'S SERVICE CONNECTION AND RATED DISABILITIES:"
"RTN","SDM4",18,0)
 IF $$GET1^DIQ(2,DFN_",",.301,"E")="YES"&($P(VAEL(3),"^",2)'="") D
"RTN","SDM4",19,0)
 .W !,"SC Percent: "_$P(VAEL(3),"^",2)_"%"
"RTN","SDM4",20,0)
 IF $$GET1^DIQ(2,DFN_",",.301,"E")="NO"&($P(VAEL(3),"^",2)="") D
"RTN","SDM4",21,0)
 .W !,"Service Connected: No"
"RTN","SDM4",22,0)
 ;Rated Disabilities
"RTN","SDM4",23,0)
 N SDSER,SDRAT,SDPER,SDREC,NN,NUM,ANS,SDELIG,SDATD,SDSCFLG S (ANS,NN,NUM)=0
"RTN","SDM4",24,0)
 F  S NN=$O(^DPT(DFN,.372,NN)) Q:'NN  D
"RTN","SDM4",25,0)
 .S SDREC=$G(^DPT(DFN,.372,NN,0)) IF SDREC'="" D
"RTN","SDM4",26,0)
 ..S SDRAT="" S NUM=$P($G(SDREC),"^",1) IF NUM>0 S SDRAT=$$GET1^DIQ(31,NUM_",",.01)
"RTN","SDM4",27,0)
 ..S SDSER="" S SDSER=$S($P(SDREC,"^",3)="1":"SC",1:"NSC")
"RTN","SDM4",28,0)
 ..W !,"    "_SDRAT_"  ("_SDSER_" - "_$P(SDREC,"^",2)_"%)"
"RTN","SDM4",29,0)
 ..Q
"RTN","SDM4",30,0)
 W !,"Primary Eligibility Code: "_$P(VAEL(1),"^",2)
"RTN","SDM4",31,0)
 IF $P($G(^DPT(DFN,.372,0)),"^",4)<1 W !,"No Service Connected Disabilities Listed"
"RTN","SDM4",32,0)
 W !
"RTN","SDM4",33,0)
 S SDELIG=$$GET1^DIQ(2,DFN_",",.301,"E"),SDSCFLG=0
"RTN","SDM4",34,0)
 IF SDELIG="" W !,"'SERVICE CONNECTED?' field is blank please update patient record." S SDSCFLG=1
"RTN","SDM4",35,0)
 IF $P(VAEL(1),U,2)="" W !,"'PRIMARY ELIGIBILITY CODE' field is blank please update patient record." S SDSCFLG=1
"RTN","SDM4",36,0)
 IF SDELIG="NO",($P(VAEL(3),U,2)>0)!($P(VAEL(1),U,2)="SC LESS THAN 50%")!($P(VAEL(1),U,2)="SERVICE CONNECTED 50% to 100%")!($P(VAEL(1),U,2)="") D
"RTN","SDM4",37,0)
 .W !,"The 'SC Percent','Service Connected' and 'Primary Eligibility Codes' are OUT OF SYNC, Please CORRECT the problem." S SDSCFLG=1
"RTN","SDM4",38,0)
 IF SDELIG="YES",($P(VAEL(3),"^",2)<50),($P(VAEL(1),"^",2)'="SC LESS THAN 50%") D
"RTN","SDM4",39,0)
 .W !,"The 'SC Percent','Service Connected' and 'Primary Eligibility Codes' are OUT OF SYNC, Please CORRECT the problem." S SDSCFLG=1
"RTN","SDM4",40,0)
 IF SDELIG="YES",($P(VAEL(3),"^",2)>49),($P(VAEL(1),"^",2)'="SERVICE CONNECTED 50% to 100%") D
"RTN","SDM4",41,0)
 .W !,"The 'SC Percent','Service Connected' and 'Primary Eligibility Codes' are OUT OF SYNC, Please CORRECT the problem." S SDSCFLG=1
"RTN","SDM4",42,0)
 W !
"RTN","SDM4",43,0)
 ;Ask about service connected appointment
"RTN","SDM4",44,0)
 N STOP,STOPN,SIEN S (ACT,IENACT)="" S STOP=$$GET1^DIQ(44,+SC_",",8,"I")
"RTN","SDM4",45,0)
 I +STOP>0 S STOPN=$$GET1^DIQ(40.7,+STOP_",",1),IENACT=$O(^SD(409.45,"B",STOPN,IENACT))
"RTN","SDM4",46,0)
 E  W "***NO STOP CODE ASSIGNED***" S SDATD="REGULAR" D APT Q
"RTN","SDM4",47,0)
 IF IENACT'="" S SDATD=99999999999,SDATD=$O(^SD(409.45,IENACT,"E",SDATD),-1) D
"RTN","SDM4",48,0)
 .IF SDATD>0 S ACT=$P(^SD(409.45,IENACT,"E",SDATD,0),"^",2)
"RTN","SDM4",49,0)
 IF ACT=1 S SDATD=$$GET1^DIQ(44,+SC_",",2507) GOTO APT
"RTN","SDM4",50,0)
 S SDATD="",SDATD=$$GET1^DIQ(44,+SC_",",2502) IF SDATD="YES" S SDATD=$$GET1^DIQ(44,+SC_",",2507) W "          ***NON-COUNT CLINIC***" GOTO APT
"RTN","SDM4",51,0)
 S SDATD="",SDATD=$$INP^SDAM2(DFN,DT) IF SDATD="I" S SDATD=$$GET1^DIQ(44,+SC_",",2507) W "          ***PATIENT IS CURRENTLY AN INPATIENT***" GOTO APT
"RTN","SDM4",52,0)
 ;STOP EXCEPTION CODES
"RTN","SDM4",53,0)
 S SDATD="",SDATD=$P(VAEL(1),"^",2)
"RTN","SDM4",54,0)
 IF SDATD'="SC LESS THAN 50%"&(SDATD'="SERVICE CONNECTED 50% to 100%") S SDATD="" S SDATD=$S($D(SDAPTYP):SDAPTYP,$D(^SC(+SC,"AT")):$S($D(^SD(409.1,+^("AT"),0)):$P(^(0),U),1:"REGULAR"),1:"REGULAR") D
"RTN","SDM4",55,0)
 .IF SDSCFLG&(SDATD="SERVICE CONNECTED") S SDATD="REGULAR"
"RTN","SDM4",56,0)
 IF SDATD="SC LESS THAN 50%"!(SDATD="SERVICE CONNECTED 50% to 100%") D
"RTN","SDM4",57,0)
 .D SBR K SDANS
"RTN","SDM4",58,0)
 .IF ANS="N" S SDATD=$S($D(SDAPTYP):SDAPTYP,$D(^SC(+SC,"AT")):$S($D(^SD(409.1,+^("AT"),0)):$P(^(0),U),1:"REGULAR"),1:"REGULAR")
"RTN","SDM4",59,0)
 .IF ANS="Y" D
"RTN","SDM4",60,0)
 ..S ANS="" S ANS=$$GET1^DIQ(44,+SC_",",2507) IF ANS="REGULAR"!(ANS="") D
"RTN","SDM4",61,0)
 ...S NN=$O(^SD(409.1,"B","SERVICE CONNECTED",NN)),SDATD=$$GET1^DIQ(409.1,NN_",",.01)
"RTN","SDM4",62,0)
 ..IF ANS'="REGULAR"&(ANS'="") S SDATD=ANS
"RTN","SDM4",63,0)
APT W !,"APPOINTMENT TYPE: "_SDATD_"//" R X:DTIME I X']"" S X=SDATD
"RTN","SDM4",64,0)
 I X["^" W !,"APPOINTMENT TYPE IS REQUIRED" G APT
"RTN","SDM4",65,0)
 I X="S" W !,"PLEASE ENTER MORE THAN ONE CHARACTER" G APT
"RTN","SDM4",66,0)
 I SDSCFLG D
"RTN","SDM4",67,0)
 .S DIC("S")="I $D(X),$E(X,1,2)'[""SE"""
"RTN","SDM4",68,0)
 .S DIC(0)="QEMNZ",DIC=409.1 D ^DIC I Y<0 Q
"RTN","SDM4",69,0)
 .S SDSCFLG=0
"RTN","SDM4",70,0)
 G APT:SDSCFLG
"RTN","SDM4",71,0)
 S SDEC=$S($D(^DIC(8,+VAEL(1),0)):$P(^(0),U,5),1:"")
"RTN","SDM4",72,0)
 S DIC("S")="I '$P(^(0),U,3),$S(SDEC[""Y"":1,1:$P(^(0),U,5)),$S('$P(^(0),U,6):1,$D(VAEL(1,+$P(^(0),U,6))):1,+VAEL(1)=$P(^(0),U,6):1,1:0)",DIC="^SD(409.1,",DIC(0)="EQMZ" D ^DIC K DIC
"RTN","SDM4",73,0)
 I X["^"!(Y'>0) W !,"Appointment type is required",!,"Patient must have the eligibility code EMPLOYEE, COLLATERAL or SHARING AGREEMENT",!,"to choose those types of appointments." G TYPE
"RTN","SDM4",74,0)
 S COLLAT=$S(+Y=1:1,+Y=7:7,1:0),SDAPTYP=+Y,SDDECOD=$P(^SD(409.1,+Y,0),U,6) I COLLAT W !!,"** Note - You are making a ",$P(^SD(409.1,+COLLAT,0),U)," appt.",!
"RTN","SDM4",75,0)
 Q:$D(SDAMBAE)
"RTN","SDM4",76,0)
 I COLLAT=7 S SDCOL=$P(^SD(409.1,SDAPTYP,0),U,6) I '$D(SDMLT)&'$D(SDD) D ^SDM0,END^SDM
"RTN","SDM4",77,0)
 Q
"RTN","SDM4",78,0)
ELIG S SDALLE="",SDEMP=$P(VAEL(1),U,2) W !,"THIS PATIENT HAS OTHER ENTITLED ELIGIBILITIES:" F SDOEL=0:0 S SDOEL=$O(VAEL(1,SDOEL)) Q:SDOEL=""  W !?5,$P(VAEL(1,SDOEL),U,2) S SDALLE=SDALLE_"^"_$P(VAEL(1,SDOEL),U,2)
"RTN","SDM4",79,0)
1 W !,"ENTER THE ELIGIBILITY FOR THIS APPOINTMENT: "_SDEMP_"// " R X:DTIME Q:"^"[X  S X=$$UPPER^VALM1(X) G ELIG:X["?",1:SDALLE'[("^"_X)
"RTN","SDM4",80,0)
 S SDEMP=X_$P($P(SDALLE,"^"_X,2),"^") W $P($P(SDALLE,"^"_X,2),"^")
"RTN","SDM4",81,0)
 F SDOEL=0:0 S SDOEL=$O(VAEL(1,SDOEL)) Q:SDOEL=""  I $P(VAEL(1,SDOEL),U,2)=SDEMP S SDEMP=SDOEL_"^"_SDEMP Q
"RTN","SDM4",82,0)
 Q
"RTN","SDM4",83,0)
SC ;SERVICE CONNECTED MESSAGE/IOFO - BAY PINES/TEH
"RTN","SDM4",84,0)
 I $D(^DPT(DFN,.3)) S SDAMSCN=+$P(^(.3),U,2) I SDAMSCN>49 D
"RTN","SDM4",85,0)
 .W !,?7,"********** THIS PATIENT IS 50% OR GREATER SERVICE-CONNECTED **********",!
"RTN","SDM4",86,0)
 ;I $D(SDWLLIST),SDWLLIST D ^SDWLR       ;Patch SD*5.3*327
"RTN","SDM4",87,0)
 Q
"RTN","SDM4",88,0)
SBR S (ANS,SDANS)=""
"RTN","SDM4",89,0)
 IF SDSCFLG S ANS="N" Q
"RTN","SDM4",90,0)
 IF $D(^DPT(DFN,.3)) S SDANS=$$GET1^DIQ(2,DFN_",",.302) IF SDANS>49 S ANS="Y" Q
"RTN","SDM4",91,0)
 S DIR("A")="IS THIS APPOINTMENT FOR A SERVICE CONNECTED CONDITION",DIR(0)="Y^A0" D ^DIR S ANS=$S(Y=1:"Y",1:"N")
"RTN","SDM4",92,0)
 I ANS'="Y"&(ANS'="N") W !,*7,"ENTER (Y or N) PLEASE!" G SBR
"RTN","SDM4",93,0)
 K DIR Q
"VER")
8.0^22.0
"^DD",409.3,409.3,7,0)
WL SERVICE/SPECIALTY^P409.31'^SDWL(409.31,^0;8^Q
"^DD",409.3,409.3,7,1,0)
^.1
"^DD",409.3,409.3,7,1,1,0)
409.3^SS^MUMPS
"^DD",409.3,409.3,7,1,1,1)
I $D(X) S ^SDWL(409.3,"SS",$P(^SDWL(409.3,DA,0),U,1),$P(^SDWL(409.31,X,0),U,1),DA)=""
"^DD",409.3,409.3,7,1,1,2)
I $D(^SDWL(409.31,X,0)) K ^SDWL(409.3,"SS",$P(^SDWL(409.3,DA,0),U,1),$P(^SDWL(409.31,X,0),U,1),DA)
"^DD",409.3,409.3,7,1,1,"DT")
3070205
"^DD",409.3,409.3,7,3)
Enter the Service/Specialty (DSS ID) allowed by this institution in the wait list parameters, that this patient is waiting for an appointment.
"^DD",409.3,409.3,7,21,0)
^.001^4^4^3070302^^^^
"^DD",409.3,409.3,7,21,1,0)
If the patient has been assigned to the Service/Specialty Wait List,
"^DD",409.3,409.3,7,21,2,0)
enter the DSS ID that represents the service/specialty
"^DD",409.3,409.3,7,21,3,0)
the patient is waiting for an appointment. This DSS ID must be active in
"^DD",409.3,409.3,7,21,4,0)
file 409.31.
"^DD",409.3,409.3,7,"AUDIT")
n
"^DD",409.3,409.3,7,"DT")
3070205
"BLD",7084,6)
^412
**END**
**END**
