Released PSS*1*101 SEQ #90
Extracted from mail message
**KIDS**:PSS*1.0*101^

**INSTALL NAME**
PSS*1.0*101
"BLD",5744,0)
PSS*1.0*101^PHARMACY DATA MANAGEMENT^0^3051020^y
"BLD",5744,1,0)
^9.61A^19^19^3051020^^^
"BLD",5744,1,1,0)
This patch contains Application Program Interfaces (APIs) that will be 
"BLD",5744,1,2,0)
used by calling applications that currently do direct global reads or 
"BLD",5744,1,3,0)
writes to the Pharmacy Data Management files.  Since the PHARMACY PATIENT 
"BLD",5744,1,4,0)
file (#55) and PHARMACY SYSTEM file (#59.7) are being replaced as part of 
"BLD",5744,1,5,0)
the Pharmacy Re-engineering project, any direct M-based global reads or 
"BLD",5744,1,6,0)
writes to these files must be replaced by calling the APIs provided in 
"BLD",5744,1,7,0)
this patch. When the new data source is in place, the calling 
"BLD",5744,1,8,0)
applications will not be required to make any changes, because these APIs 
"BLD",5744,1,9,0)
will be flexible enough to retrieve the requested data from the new data 
"BLD",5744,1,10,0)
source, when the time comes.
"BLD",5744,1,11,0)
 
"BLD",5744,1,12,0)
These are the files that are affected. If any application is making 
"BLD",5744,1,13,0)
direct global reads or writes to any of these files, they must be 
"BLD",5744,1,14,0)
replaced by using the APIs exported with this patch.
"BLD",5744,1,15,0)
 
"BLD",5744,1,16,0)
File Name:                        File Number:
"BLD",5744,1,17,0)
RX PATIENT STATUS                    53
"BLD",5744,1,18,0)
PHARMACY PATIENT                     55
"BLD",5744,1,19,0)
PHARMACY SYSTEM                      59.7
"BLD",5744,4,0)
^9.64PA^^
"BLD",5744,"KRN",0)
^9.67PA^8989.52^19
"BLD",5744,"KRN",.4,0)
.4
"BLD",5744,"KRN",.401,0)
.401
"BLD",5744,"KRN",.402,0)
.402
"BLD",5744,"KRN",.403,0)
.403
"BLD",5744,"KRN",.5,0)
.5
"BLD",5744,"KRN",.84,0)
.84
"BLD",5744,"KRN",3.6,0)
3.6
"BLD",5744,"KRN",3.8,0)
3.8
"BLD",5744,"KRN",9.2,0)
9.2
"BLD",5744,"KRN",9.8,0)
9.8
"BLD",5744,"KRN",9.8,"NM",0)
^9.68A^3^2
"BLD",5744,"KRN",9.8,"NM",1,0)
PSS55^^0^B67992607
"BLD",5744,"KRN",9.8,"NM",3,0)
PSS59P7^^0^B2286501
"BLD",5744,"KRN",9.8,"NM","B","PSS55",1)

"BLD",5744,"KRN",9.8,"NM","B","PSS59P7",3)

"BLD",5744,"KRN",19,0)
19
"BLD",5744,"KRN",19.1,0)
19.1
"BLD",5744,"KRN",101,0)
101
"BLD",5744,"KRN",409.61,0)
409.61
"BLD",5744,"KRN",771,0)
771
"BLD",5744,"KRN",870,0)
870
"BLD",5744,"KRN",8989.51,0)
8989.51
"BLD",5744,"KRN",8989.52,0)
8989.52
"BLD",5744,"KRN",8994,0)
8994
"BLD",5744,"KRN","B",.4,.4)

"BLD",5744,"KRN","B",.401,.401)

"BLD",5744,"KRN","B",.402,.402)

"BLD",5744,"KRN","B",.403,.403)

"BLD",5744,"KRN","B",.5,.5)

"BLD",5744,"KRN","B",.84,.84)

"BLD",5744,"KRN","B",3.6,3.6)

"BLD",5744,"KRN","B",3.8,3.8)

"BLD",5744,"KRN","B",9.2,9.2)

"BLD",5744,"KRN","B",9.8,9.8)

"BLD",5744,"KRN","B",19,19)

"BLD",5744,"KRN","B",19.1,19.1)

"BLD",5744,"KRN","B",101,101)

"BLD",5744,"KRN","B",409.61,409.61)

"BLD",5744,"KRN","B",771,771)

"BLD",5744,"KRN","B",870,870)

"BLD",5744,"KRN","B",8989.51,8989.51)

"BLD",5744,"KRN","B",8989.52,8989.52)

"BLD",5744,"KRN","B",8994,8994)

"MBREQ")
0
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
101^3051020
"PKG",517,22,1,"PAH",1,1,0)
^^19^19^3051020
"PKG",517,22,1,"PAH",1,1,1,0)
This patch contains Application Program Interfaces (APIs) that will be 
"PKG",517,22,1,"PAH",1,1,2,0)
used by calling applications that currently do direct global reads or 
"PKG",517,22,1,"PAH",1,1,3,0)
writes to the Pharmacy Data Management files.  Since the PHARMACY PATIENT 
"PKG",517,22,1,"PAH",1,1,4,0)
file (#55) and PHARMACY SYSTEM file (#59.7) are being replaced as part of 
"PKG",517,22,1,"PAH",1,1,5,0)
the Pharmacy Re-engineering project, any direct M-based global reads or 
"PKG",517,22,1,"PAH",1,1,6,0)
writes to these files must be replaced by calling the APIs provided in 
"PKG",517,22,1,"PAH",1,1,7,0)
this patch. When the new data source is in place, the calling 
"PKG",517,22,1,"PAH",1,1,8,0)
applications will not be required to make any changes, because these APIs 
"PKG",517,22,1,"PAH",1,1,9,0)
will be flexible enough to retrieve the requested data from the new data 
"PKG",517,22,1,"PAH",1,1,10,0)
source, when the time comes.
"PKG",517,22,1,"PAH",1,1,11,0)
 
"PKG",517,22,1,"PAH",1,1,12,0)
These are the files that are affected. If any application is making 
"PKG",517,22,1,"PAH",1,1,13,0)
direct global reads or writes to any of these files, they must be 
"PKG",517,22,1,"PAH",1,1,14,0)
replaced by using the APIs exported with this patch.
"PKG",517,22,1,"PAH",1,1,15,0)
 
"PKG",517,22,1,"PAH",1,1,16,0)
File Name:                        File Number:
"PKG",517,22,1,"PAH",1,1,17,0)
RX PATIENT STATUS                    53
"PKG",517,22,1,"PAH",1,1,18,0)
PHARMACY PATIENT                     55
"PKG",517,22,1,"PAH",1,1,19,0)
PHARMACY SYSTEM                      59.7
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSS55")
0^1^B67992607
"RTN","PSS55",1,0)
PSS55 ;BHM/DB - API FOR PHARMACY PATIENT FILE ; 15 JUN 05
"RTN","PSS55",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**101**;9/30/97
"RTN","PSS55",3,0)
PSS431(DFN,PO,PSDATE,PEDATE,LIST) ;
"RTN","PSS55",4,0)
  ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",5,0)
         ;PO: Order # [optional]
"RTN","PSS55",6,0)
         ;PSDATE: Start Date [optional]
"RTN","PSS55",7,0)
         ;PEDATE: End Date [optional]
"RTN","PSS55",8,0)
         ;If a start date is sent, an end date must also be sent
"RTN","PSS55",9,0)
         ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",10,0)
         N PSSPO,PSSIEN,DA,DR,DIC
"RTN","PSS55",11,0)
 I $G(LIST)="" Q
"RTN","PSS55",12,0)
 K ^TMP($J,LIST)
"RTN","PSS55",13,0)
 I $G(DFN)="" S ^TMP($J,LIST,0)=-1_"^"_"NO DATA FOUND" Q
"RTN","PSS55",14,0)
 S PSSIEN=$G(DFN),PSSPO=$G(PO) S ^TMP($J,LIST,0)=0
"RTN","PSS55",15,0)
 I $G(PSSPO)>0,$G(PSSIEN)>0 S DA=PSSIEN,(IEN,DA(55.06))=PSSPO G DIQ431
"RTN","PSS55",16,0)
 I $G(PSSPO)="",$G(PSDATE)'="",$G(PEDATE)'="" S PSDATE=$S('$P(PSDATE,".",2):PSDATE_.000001,1:PSDATE),PEDATE=$S('$P($G(PEDATE),".",2):PEDATE_.999999,1:$G(PEDATE)) N PSS56 G DT431
"RTN","PSS55",17,0)
 I $G(PSSPO)="" N PSSPO1 G LOOP431
"RTN","PSS55",18,0)
 Q
"RTN","PSS55",19,0)
LOOP431 S (PSSPO1,PSSPO)=0 F  S PSSPO1=$O(^PS(55,DFN,5,"B",PSSPO1)) Q:PSSPO1'>0  F  S PSSPO=$O(^PS(55,DFN,5,"B",PSSPO1,PSSPO)) Q:PSSPO'>0  S PO=PSSPO D DIQ431
"RTN","PSS55",20,0)
 Q
"RTN","PSS55",21,0)
DIQ431 ;
"RTN","PSS55",22,0)
 I '$D(^PS(55,DFN,5,PO,0)) Q
"RTN","PSS55",23,0)
 N PSS,CNT1,X
"RTN","PSS55",24,0)
 S PSSIEN=PO_","_DFN_"," K DIQ
"RTN","PSS55",25,0)
 D GETS^DIQ(55.06,PSSIEN,".01;.5;1;2*;3;4;5;6;7;11;12;27;27.1;28","IE","^TMP(""PSS5506"",$J)")
"RTN","PSS55",26,0)
 F X=.01,.5,1,3,4,5,6,7,11,12,27,27.1,28 S ^TMP($J,LIST,+PSSPO,X)=$G(^TMP("PSS5506",$J,55.06,PSSIEN,X,"I"))
"RTN","PSS55",27,0)
 F X=.5,1,3,4,5,6,7,27,27.1,28 S ^TMP($J,LIST,+PSSPO,X)=$S($G(^TMP("PSS5506",$J,55.06,PSSIEN,X,"E"))'="":^TMP($J,LIST,+PSSPO,X)_"^"_$G(^TMP("PSS5506",$J,55.06,PSSIEN,X,"E")),1:"")
"RTN","PSS55",28,0)
 S (PSS(1),CNT1)=0 F  S PSS(1)=$O(^TMP("PSS5506",$J,55.07,PSS(1))) Q:'PSS(1)  D
"RTN","PSS55",29,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.11)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.11,"I"))
"RTN","PSS55",30,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.12)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.12,"I"))
"RTN","PSS55",31,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.01)=$S($G(^TMP("PSS5506",$J,55.07,PSS(1),.01,"E"))'="":$G(^TMP("PSS5506",$J,55.07,PSS(1),.01,"I"))_"^"_$G(^TMP("PSS5506",$J,55.07,PSS(1),.01,"E")),1:"")
"RTN","PSS55",32,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.02)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.02,"I"))
"RTN","PSS55",33,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.03)=$S($G(^TMP("PSS5506",$J,55.07,PSS(1),.03,"E"))'="":$G(^TMP("PSS5506",$J,55.07,PSS(1),.03,"I"))_"^"_$G(^TMP("PSS5506",$J,55.07,PSS(1),.03,"E")),1:"")
"RTN","PSS55",34,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.04)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.04,"I"))
"RTN","PSS55",35,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.05)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.05,"I"))
"RTN","PSS55",36,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.06)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.06,"I"))
"RTN","PSS55",37,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.07)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.07,"I"))
"RTN","PSS55",38,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.08)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.08,"I"))
"RTN","PSS55",39,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.09)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.09,"I"))
"RTN","PSS55",40,0)
 .S ^TMP($J,LIST,+PSSPO,"DDRUG",+PSS(1),.1)=$G(^TMP("PSS5506",$J,55.07,PSS(1),.1,"I"))
"RTN","PSS55",41,0)
 .S CNT1=CNT1+1
"RTN","PSS55",42,0)
 K ^TMP("PSS5506",$J),PSS(1) S ^TMP($J,LIST,"B",+PSSPO)=""
"RTN","PSS55",43,0)
 S ^TMP($J,LIST,0)=^TMP($J,LIST,0)+1
"RTN","PSS55",44,0)
 S ^TMP($J,LIST,+PSSPO,"DDRUG",0)=$S(CNT1=0:"-1^NO DATA FOUND",1:CNT1)
"RTN","PSS55",45,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS55",46,0)
 Q
"RTN","PSS55",47,0)
DT431 F  S PSDATE=$O(^PS(55,DFN,5,"AUS",PSDATE)) Q:((+$G(PEDATE)>0)&(PSDATE>$G(PEDATE)))  Q:PSDATE'>0  D
"RTN","PSS55",48,0)
 .S PSS56=0 F  S PSS56=$O(^PS(55,DFN,5,"AUS",PSDATE,PSS56)) Q:PSS56'>0  S (PSSPO,PO)=PSS56 D DIQ431
"RTN","PSS55",49,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS55",50,0)
 Q
"RTN","PSS55",51,0)
PSS432(DFN,PO,LIST) ;SRS 3.2.43.2
"RTN","PSS55",52,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",53,0)
 ;PO: Order # [optional] If left blank, all active orders will be returned
"RTN","PSS55",54,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",55,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",56,0)
 I +$G(DFN)'>0 S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",57,0)
 S ^TMP($J,LIST,0)=0
"RTN","PSS55",58,0)
 I '$D(^PS(55,DFN,0)) S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",59,0)
 I $G(PO)'="" G AUS2
"RTN","PSS55",60,0)
 S PSSDT=0
"RTN","PSS55",61,0)
AUS ;Loop through stop date/time xref
"RTN","PSS55",62,0)
 F  S PSSDT=$O(^PS(55,DFN,5,"AUS",PSSDT)) Q:PSSDT'>0  S PSSIEN=0 D
"RTN","PSS55",63,0)
 .F  S PSSIEN=$O(^PS(55,DFN,5,"AUS",PSSDT,PSSIEN)) Q:PSSIEN'>0  D
"RTN","PSS55",64,0)
 ..S (IEN,DA(55.06))=PSSIEN,PSSDATA=$G(^PS(55,DFN,5,PSSIEN,0)) I $P(PSSDATA,"^",9)'="A" Q
"RTN","PSS55",65,0)
 ..S PO=PSSIEN D AUSDIQ
"RTN","PSS55",66,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS55",67,0)
 Q
"RTN","PSS55",68,0)
AUSDIQ K ^UTILITY("DIQ1",$J),DIQ S PSSPO=PO
"RTN","PSS55",69,0)
 S DA=DFN,DIC=55,DR=62,DR(55.06)=".01;.5;1;3;4;5;6;7;11;12;27;27.1;28",DIQ(0)="IE" D EN^DIQ1
"RTN","PSS55",70,0)
 F X=.01,.5,1,3,4,5,6,7,11,12,27,27.1,28 S ^TMP($J,LIST,+PSSPO,X)=$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"I"))
"RTN","PSS55",71,0)
 F X=.5,1,3,4,5,6,7,27,27.1,28 S ^TMP($J,LIST,+PSSPO,X)=$S($G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E"))'="":^TMP($J,LIST,PSSPO,X)_"^"_$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E")),1:"")
"RTN","PSS55",72,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PSS55",73,0)
 S ^TMP($J,LIST,"B",+PSSPO)="",^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",74,0)
 Q
"RTN","PSS55",75,0)
AUS2 ;one PO
"RTN","PSS55",76,0)
 S (PSSIEN,IEN,DA(55.06))=PO,PSSQ=1 D AUSDIQ
"RTN","PSS55",77,0)
 S ^TMP($J,LIST,0)=$S(^TMP($J,LIST,0)=0:"-1^NO DATA FOUND",1:^TMP($J,LIST,0))
"RTN","PSS55",78,0)
 I ^TMP($J,LIST,+PO,.01)="" K ^TMP($J,LIST) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",79,0)
AUSQ K PSSDT,PSSIEN,PSSDATA,PSSPO,PSSQ,DA,DR,DIC Q
"RTN","PSS55",80,0)
 ;
"RTN","PSS55",81,0)
PSS433(DFN,LIST) ;SRS 3.2.43.3 - Passed all tests 8/22
"RTN","PSS55",82,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",83,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",84,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",85,0)
 I $G(DFN)'>0 S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",86,0)
 I '$D(^PS(55,DFN)) G NODATA
"RTN","PSS55",87,0)
 S PSSIEN=0,^TMP($J,LIST,0)=0
"RTN","PSS55",88,0)
BGN433 S PSSIEN=$O(^PS(55,DFN,5,PSSIEN)) G Q433:PSSIEN'>0 S PSSPO=$P($G(^PS(55,DFN,5,PSSIEN,0)),"^")
"RTN","PSS55",89,0)
 S (IEN,DA(55.06))=PSSIEN,DIC=55,DA=DFN,DR=62,DR(55.06)=".5;9;25;26;34;41;42;70",DIQ(0)="IE" D EN^DIQ1
"RTN","PSS55",90,0)
 F X=.5,9,25,26,34,41,42,70 S ^TMP($J,LIST,+PSSIEN,X)=$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"I"))
"RTN","PSS55",91,0)
 F X=.5,9,25,34,70 S ^TMP($J,LIST,+PSSIEN,X)=$S($G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E"))'="":^TMP($J,LIST,+PSSIEN,X)_"^"_$G(^UTILITY("DIQ1",$J,55.06,IEN,X,"E")),1:"")
"RTN","PSS55",92,0)
 S ^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",93,0)
 S ^TMP($J,LIST,"B",+PSSIEN)=""
"RTN","PSS55",94,0)
 G BGN433
"RTN","PSS55",95,0)
Q433 K ^UTILITY("DIQ1",$J) Q
"RTN","PSS55",96,0)
PSS435(DFN,PO,LIST) ;SRS 3.2.43.5
"RTN","PSS55",97,0)
 ;DFN:  IEN of Patient [REQUIRED]
"RTN","PSS55",98,0)
 ;PO: Order # [optional] If left blank, all active orders will be returned. 
"RTN","PSS55",99,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",100,0)
 ;Active hyperal orders utilizing "AIT" cross reference
"RTN","PSS55",101,0)
 Q:$G(LIST)=""  K ^TMP($J,LIST)
"RTN","PSS55",102,0)
 I $G(DFN)'>0  S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",103,0)
 I '$D(^PS(55,DFN,"IV","AIT","H")) S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",104,0)
 S PSSDT=0,^TMP($J,LIST,0)=0
"RTN","PSS55",105,0)
AIT ;loop trough AIT xref
"RTN","PSS55",106,0)
 S PSSDT=$O(^PS(55,DFN,"IV","AIT","H",PSSDT)) G AITQ:PSSDT'>0 S PSSIEN=0
"RTN","PSS55",107,0)
AIT1 S PSSIEN=$O(^PS(55,DFN,"IV","AIT","H",PSSDT,PSSIEN)) G AIT:PSSIEN'>0
"RTN","PSS55",108,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSIEN,0)),PSSSTAT=$P($G(PSSDATA),"^",17) I PSSSTAT'="A",$G(PO)'>0 G AIT1
"RTN","PSS55",109,0)
 I +$G(PO)>0 G AIT1:PSSIEN'=PO
"RTN","PSS55",110,0)
 S PSSPO=$P(PSSDATA,"^",1),^TMP($J,LIST,"B",+PSSIEN)=""
"RTN","PSS55",111,0)
AITDIQ K ^UTILITY("DIQ1",$J) S DA=DFN,(IEN,DA(55.01))=PSSIEN,DIC=55,DR=100,DIQ(0)="IE",DR(55.01)=".01;.02;.03;.04;.06;.08;.09;.12;.17;.24;100;104;106;108;110;112;120;121" D EN^DIQ1
"RTN","PSS55",112,0)
 F X=.01,.02,.03,.04,.06,.08,.09,.12,.17,.24,100,104,106,108,110,112,120,121 S ^TMP($J,LIST,PSSPO,X)=$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"I"))
"RTN","PSS55",113,0)
 F X=.02,.03,.04,.06,100,106,108,112,120,121 S ^TMP($J,LIST,PSSPO,X)=$S($G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E"))'="":^TMP($J,LIST,PSSPO,X)_"^"_$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E")),1:"")
"RTN","PSS55",114,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PSS55",115,0)
 S ^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",116,0)
 G AIT1
"RTN","PSS55",117,0)
AITQ I $G(^TMP($J,LIST,0))=0 K ^TMP($J,LIST) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",118,0)
 Q
"RTN","PSS55",119,0)
 ;
"RTN","PSS55",120,0)
PSS436(DFN,ORDER,LIST) ;SRS 3.2.43.6
"RTN","PSS55",121,0)
 ;DFN: IEN of Patient [REQUIRED]
"RTN","PSS55",122,0)
 ;ORDER:  ORDER NUMBER [REQUIRED]
"RTN","PSS55",123,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS55",124,0)
 ;Active IV AD nodes
"RTN","PSS55",125,0)
 K PSSLOOP Q:$G(LIST)=""  K ^TMP($J,LIST) I $G(DFN)'>0  S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",126,0)
 I '$D(^PS(55,DFN)) S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"RTN","PSS55",127,0)
 K ^TMP($J,LIST) I $G(ORDER)="" S PSSLOOP=1 S ORDER=0 G LOOP436
"RTN","PSS55",128,0)
 I $G(ORDER)'="" S PSSPO=$O(^PS(55,DFN,"IV","B",ORDER,0)) G PSS436Q:$G(PSSPO)'>0 G DIQ436
"RTN","PSS55",129,0)
LOOP436 S ORDER=$O(^PS(55,DFN,"IV","B",ORDER)) G PSS436Q:ORDER'>0  S PSSPO=$O(^PS(55,DFN,"IV","B",ORDER,0))
"RTN","PSS55",130,0)
DIQ436 K DA,DR S DA=DFN,(IEN,DA(55.01))=PSSPO,DIC=55,DR=100
"RTN","PSS55",131,0)
 S DR(55.01)=".01;.02;.03;.04;.06;.08;.09;.12;.17;.24;100;104;106;108;110;112;120;121;147"
"RTN","PSS55",132,0)
 S DIQ(0)="IE" D EN^DIQ1 I '$D(^UTILITY("DIQ1",$J)) G NODATA
"RTN","PSS55",133,0)
 F X=.01,.02,.03,.04,.06,.08,.09,.12,.17,.24,100,104,106,108,110,112,120,121,147 S ^TMP($J,LIST,PSSPO,X)=$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"I"))
"RTN","PSS55",134,0)
 F X=.02,.03,.04,.06,100,106,108,112,120,121,147 S ^TMP($J,LIST,PSSPO,X)=$S($G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E"))'="":^TMP($J,LIST,PSSPO,X)_"^"_$G(^UTILITY("DIQ1",$J,55.01,IEN,X,"E")),1:"")
"RTN","PSS55",135,0)
 S ^TMP($J,LIST,"B",PSSPO)="",PSSADD=0,^TMP($J,LIST,0)=$G(^TMP($J,LIST,0))+1
"RTN","PSS55",136,0)
 S ^TMP($J,LIST,PSSPO,"ADD",0)=0
"RTN","PSS55",137,0)
PSSADD S PSSADD=$O(^PS(55,DFN,"IV",PSSPO,"AD",PSSADD)) I PSSADD'>0 S PSSSOL=0 S ^TMP($J,LIST,PSSPO,"SOL",0)=0 G PSSSOL
"RTN","PSS55",138,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSPO,"AD",PSSADD,0)),X1=$P(PSSDATA,"^"),X2=$P(PSSDATA,"^",2),X3=$P(PSSDATA,"^",3)
"RTN","PSS55",139,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSADD,.01)=X1_"^"_$P($G(^PS(52.6,X1,0)),"^")
"RTN","PSS55",140,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSADD,.02)=X2
"RTN","PSS55",141,0)
 S ^TMP($J,LIST,PSSPO,"ADD",PSSADD,.03)=X3
"RTN","PSS55",142,0)
 S ^TMP($J,LIST,PSSPO,"ADD",0)=$G(^TMP($J,LIST,PSSPO,"ADD",0))+1
"RTN","PSS55",143,0)
 G PSSADD
"RTN","PSS55",144,0)
PSSSOL I ^TMP($J,LIST,PSSPO,"ADD",0)'>0 S ^TMP($J,LIST,PSSPO,"ADD",0)="-1^NO DATA FOUND"
"RTN","PSS55",145,0)
 S PSSSOL=$O(^PS(55,DFN,"IV",PSSPO,"SOL",PSSSOL)) I PSSSOL'>0,$G(PSSLOOP)'=1 D  G PSS436Q
"RTN","PSS55",146,0)
 .I ^TMP($J,LIST,PSSPO,"SOL",0)=0 S ^TMP($J,LIST,PSSPO,"SOL",0)="-1^NO DATA FOUND"
"RTN","PSS55",147,0)
 I PSSSOL'>0 D  G LOOP436
"RTN","PSS55",148,0)
 .I ^TMP($J,LIST,PSSPO,"SOL",0)=0 S ^TMP($J,LIST,PSSPO,"SOL",0)="-1^NO DATA FOUND"
"RTN","PSS55",149,0)
 S PSSDATA=$G(^PS(55,DFN,"IV",PSSPO,"SOL",PSSSOL,0)),X1=$P(PSSDATA,"^"),X2=$P(PSSDATA,"^",2)
"RTN","PSS55",150,0)
 S ^TMP($J,LIST,PSSPO,"SOL",PSSSOL,.01)=X1_"^"_$P($G(^PS(52.7,X1,0)),"^")
"RTN","PSS55",151,0)
 S ^TMP($J,LIST,PSSPO,"SOL",PSSSOL,1)=X2
"RTN","PSS55",152,0)
 S ^TMP($J,LIST,PSSPO,"SOL",0)=$G(^TMP($J,LIST,PSSPO,"SOL",0))+1
"RTN","PSS55",153,0)
 G PSSSOL
"RTN","PSS55",154,0)
PSS436Q K ^UTILITY("DIQ1",$J),DIQ I '$D(^TMP($J,LIST,"B")) S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",155,0)
 Q
"RTN","PSS55",156,0)
NODATA S ^TMP($J,LIST,0)="-1^NO DATA FOUND"
"RTN","PSS55",157,0)
Q Q
"RTN","PSS59P7")
0^3^B2286501
"RTN","PSS59P7",1,0)
PSS59P7 ;BHM/DB - Pharmacy System File API ;1 JUL 05
"RTN","PSS59P7",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**101**;9/30/97
"RTN","PSS59P7",3,0)
PSS(PSSIEN,PSSTXT,LIST) ;SRS 3.2.78
"RTN","PSS59P7",4,0)
 ;PSSIEN - INTERNAL ENTRY NUMBER (optional)
"RTN","PSS59P7",5,0)
 ;PSSTXT - Free Text site name (optional)
"RTN","PSS59P7",6,0)
 ;LIST: Subscript name used in ^TMP global [REQUIRED]
"RTN","PSS59P7",7,0)
 I $G(PSSIEN)="",$G(PSSTXT)="" Q
"RTN","PSS59P7",8,0)
 I $G(LIST)="" Q
"RTN","PSS59P7",9,0)
 K ^TMP($J,LIST),DA,^UTILITY("DIQ1",$J),DIQ
"RTN","PSS59P7",10,0)
 I $G(PSSIEN)]"" S DA=PSSIEN I '$D(^PS(59.7,DA,0)) G RET0
"RTN","PSS59P7",11,0)
 I $G(PSSTXT)'="",$G(PSSIEN)'>0,'$D(^PS(59.7,"B",PSSTXT)) G RET0
"RTN","PSS59P7",12,0)
 I $G(PSSTXT)'="",$G(DA)'>0 S DA=$O(^PS(59.7,"B",PSSTXT,0))
"RTN","PSS59P7",13,0)
 K ^UTILITY("DIQ1",$J),DIC S DIC=59.7,DR=".01;40.1;49.99",DIQ(0)="IE" D EN^DIQ1
"RTN","PSS59P7",14,0)
 I '$D(^UTILITY("DIQ1",$J)) G RET0
"RTN","PSS59P7",15,0)
 S:$G(PSSTXT)="" PSSTXT=^UTILITY("DIQ1",$J,59.7,DA,.01,"E")
"RTN","PSS59P7",16,0)
 F X=40.1,49.99 S ^TMP($J,LIST,DA,X)=$G(^UTILITY("DIQ1",$J,59.7,DA,X,"I"))
"RTN","PSS59P7",17,0)
 S ^TMP($J,LIST,DA,40.1)=$S($G(^UTILITY("DIQ1",$J,59.7,DA,40.1,"E"))'="":^TMP($J,LIST,DA,40.1)_"^"_$G(^UTILITY("DIQ1",$J,59.7,DA,40.1,"E")),1:"")
"RTN","PSS59P7",18,0)
 S ^TMP($J,LIST,"B",PSSTXT,DA)=""
"RTN","PSS59P7",19,0)
 K PSSIEN,DA,X,PSSTXT,DR,DIC Q
"RTN","PSS59P7",20,0)
RET0 ;return no data
"RTN","PSS59P7",21,0)
 S ^TMP($J,LIST,0)="-1^NO DATA FOUND" Q
"VER")
8.0^22.0
"BLD",5744,6)
^90
**END**
**END**
