Released PSS*1*125 SEQ #112
Extracted from mail message
**KIDS**:PSS*1.0*125^

**INSTALL NAME**
PSS*1.0*125
"BLD",6317,0)
PSS*1.0*125^PHARMACY DATA MANAGEMENT^0^3070509^y
"BLD",6317,1,0)
^^13^13^3070509^
"BLD",6317,1,1,0)
With the deployment of Cache version 5, it was discovered that the short
"BLD",6317,1,2,0)
lock timeout values could generate a lock failure. Patch DI*22*147, which
"BLD",6317,1,3,0)
has already been released, provided a solution to resolve this issue and
"BLD",6317,1,4,0)
future lock issues.
"BLD",6317,1,5,0)
 
"BLD",6317,1,6,0)
This patch instituted a new default lock timeout of three seconds based on
"BLD",6317,1,7,0)
a global node setting of ^DD("DILOCKTM")=3.
"BLD",6317,1,8,0)
 
"BLD",6317,1,9,0)
In order to avoid the lock issue in Pharmacy Data Management, this patch
"BLD",6317,1,10,0)
modifies all routines that currently use a lock timeout value of less than
"BLD",6317,1,11,0)
3 seconds to check for the node ^DD("DILOCKTM") and to use the value
"BLD",6317,1,12,0)
defined there, otherwise the lock timeout value is set to a default value
"BLD",6317,1,13,0)
of 3 seconds.
"BLD",6317,4,0)
^9.64PA^^
"BLD",6317,6.3)
2
"BLD",6317,"KRN",0)
^9.67PA^8989.52^19
"BLD",6317,"KRN",.4,0)
.4
"BLD",6317,"KRN",.401,0)
.401
"BLD",6317,"KRN",.402,0)
.402
"BLD",6317,"KRN",.403,0)
.403
"BLD",6317,"KRN",.5,0)
.5
"BLD",6317,"KRN",.84,0)
.84
"BLD",6317,"KRN",3.6,0)
3.6
"BLD",6317,"KRN",3.8,0)
3.8
"BLD",6317,"KRN",9.2,0)
9.2
"BLD",6317,"KRN",9.8,0)
9.8
"BLD",6317,"KRN",9.8,"NM",0)
^9.68A^13^12
"BLD",6317,"KRN",9.8,"NM",1,0)
PSS0052^^0^B6401941
"BLD",6317,"KRN",9.8,"NM",2,0)
PSSADDIT^^0^B46212078
"BLD",6317,"KRN",9.8,"NM",4,0)
PSSDFEE^^0^B3042568
"BLD",6317,"KRN",9.8,"NM",5,0)
PSSDOSER^^0^B51987793
"BLD",6317,"KRN",9.8,"NM",6,0)
PSSHELP^^0^B2969588
"BLD",6317,"KRN",9.8,"NM",7,0)
PSSHL1^^0^B26832539
"BLD",6317,"KRN",9.8,"NM",8,0)
PSSLOCK^^0^B6837283
"BLD",6317,"KRN",9.8,"NM",9,0)
PSSPOIMN^^0^B62103637
"BLD",6317,"KRN",9.8,"NM",10,0)
PSSPOIMO^^0^B73680836
"BLD",6317,"KRN",9.8,"NM",11,0)
PSSSEE^^0^B2787240
"BLD",6317,"KRN",9.8,"NM",12,0)
PSSSOLIT^^0^B19718816
"BLD",6317,"KRN",9.8,"NM",13,0)
PSSVIDRG^^0^B28763212
"BLD",6317,"KRN",9.8,"NM","B","PSS0052",1)

"BLD",6317,"KRN",9.8,"NM","B","PSSADDIT",2)

"BLD",6317,"KRN",9.8,"NM","B","PSSDFEE",4)

"BLD",6317,"KRN",9.8,"NM","B","PSSDOSER",5)

"BLD",6317,"KRN",9.8,"NM","B","PSSHELP",6)

"BLD",6317,"KRN",9.8,"NM","B","PSSHL1",7)

"BLD",6317,"KRN",9.8,"NM","B","PSSLOCK",8)

"BLD",6317,"KRN",9.8,"NM","B","PSSPOIMN",9)

"BLD",6317,"KRN",9.8,"NM","B","PSSPOIMO",10)

"BLD",6317,"KRN",9.8,"NM","B","PSSSEE",11)

"BLD",6317,"KRN",9.8,"NM","B","PSSSOLIT",12)

"BLD",6317,"KRN",9.8,"NM","B","PSSVIDRG",13)

"BLD",6317,"KRN",19,0)
19
"BLD",6317,"KRN",19.1,0)
19.1
"BLD",6317,"KRN",101,0)
101
"BLD",6317,"KRN",409.61,0)
409.61
"BLD",6317,"KRN",771,0)
771
"BLD",6317,"KRN",870,0)
870
"BLD",6317,"KRN",8989.51,0)
8989.51
"BLD",6317,"KRN",8989.52,0)
8989.52
"BLD",6317,"KRN",8994,0)
8994
"BLD",6317,"KRN","B",.4,.4)

"BLD",6317,"KRN","B",.401,.401)

"BLD",6317,"KRN","B",.402,.402)

"BLD",6317,"KRN","B",.403,.403)

"BLD",6317,"KRN","B",.5,.5)

"BLD",6317,"KRN","B",.84,.84)

"BLD",6317,"KRN","B",3.6,3.6)

"BLD",6317,"KRN","B",3.8,3.8)

"BLD",6317,"KRN","B",9.2,9.2)

"BLD",6317,"KRN","B",9.8,9.8)

"BLD",6317,"KRN","B",19,19)

"BLD",6317,"KRN","B",19.1,19.1)

"BLD",6317,"KRN","B",101,101)

"BLD",6317,"KRN","B",409.61,409.61)

"BLD",6317,"KRN","B",771,771)

"BLD",6317,"KRN","B",870,870)

"BLD",6317,"KRN","B",8989.51,8989.51)

"BLD",6317,"KRN","B",8989.52,8989.52)

"BLD",6317,"KRN","B",8994,8994)

"BLD",6317,"QUES",0)
^9.62^^
"BLD",6317,"REQB",0)
^9.611^7^6
"BLD",6317,"REQB",1,0)
PSS*1.0*52^2
"BLD",6317,"REQB",3,0)
PSS*1.0*48^2
"BLD",6317,"REQB",4,0)
PSS*1.0*58^2
"BLD",6317,"REQB",5,0)
PSS*1.0*102^2
"BLD",6317,"REQB",6,0)
PSS*1.0*41^2
"BLD",6317,"REQB",7,0)
PSS*1.0*82^2
"BLD",6317,"REQB","B","PSS*1.0*102",5)

"BLD",6317,"REQB","B","PSS*1.0*41",6)

"BLD",6317,"REQB","B","PSS*1.0*48",3)

"BLD",6317,"REQB","B","PSS*1.0*52",1)

"BLD",6317,"REQB","B","PSS*1.0*58",4)

"BLD",6317,"REQB","B","PSS*1.0*82",7)

"MBREQ")
0
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
125^3070509
"PKG",517,22,1,"PAH",1,1,0)
^^13^13^3070509
"PKG",517,22,1,"PAH",1,1,1,0)
With the deployment of Cache version 5, it was discovered that the short
"PKG",517,22,1,"PAH",1,1,2,0)
lock timeout values could generate a lock failure. Patch DI*22*147, which
"PKG",517,22,1,"PAH",1,1,3,0)
has already been released, provided a solution to resolve this issue and
"PKG",517,22,1,"PAH",1,1,4,0)
future lock issues.
"PKG",517,22,1,"PAH",1,1,5,0)
 
"PKG",517,22,1,"PAH",1,1,6,0)
This patch instituted a new default lock timeout of three seconds based on
"PKG",517,22,1,"PAH",1,1,7,0)
a global node setting of ^DD("DILOCKTM")=3.
"PKG",517,22,1,"PAH",1,1,8,0)
 
"PKG",517,22,1,"PAH",1,1,9,0)
In order to avoid the lock issue in Pharmacy Data Management, this patch
"PKG",517,22,1,"PAH",1,1,10,0)
modifies all routines that currently use a lock timeout value of less than
"PKG",517,22,1,"PAH",1,1,11,0)
3 seconds to check for the node ^DD("DILOCKTM") and to use the value
"PKG",517,22,1,"PAH",1,1,12,0)
defined there, otherwise the lock timeout value is set to a default value
"PKG",517,22,1,"PAH",1,1,13,0)
of 3 seconds.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","PSS0052")
0^1^B6401941^B6306052
"RTN","PSS0052",1,0)
PSS0052 ;BIR/JLC-POPULATE FIRST SERVICE DATE ;01/14/2002
"RTN","PSS0052",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**52,125**;9/30/97;Build 2
"RTN","PSS0052",3,0)
 ;
"RTN","PSS0052",4,0)
 ;Reference to ^PSRX is supported by DBIA 3500.
"RTN","PSS0052",5,0)
 ;
"RTN","PSS0052",6,0)
 Q
"RTN","PSS0052",7,0)
EN I $G(DUZ)="" W !,"Your DUZ is not defined.  It must be defined to run this routine." Q
"RTN","PSS0052",8,0)
 K ZTSAVE,ZTSK S ZTRTN="ENQN^PSS0052",ZTDESC="Build FIRST PHARMACY SERVICE Info (PDM)",ZTIO="" D ^%ZTLOAD
"RTN","PSS0052",9,0)
 W !!,"The build of first pharmacy service info is",$S($D(ZTSK):"",1:" NOT")," queued",!
"RTN","PSS0052",10,0)
 I $D(ZTSK) D
"RTN","PSS0052",11,0)
 . W " (to start NOW).",!!,"YOU WILL RECEIVE A MAILMAN MESSAGE WHEN TASK #"_ZTSK_" HAS COMPLETED."
"RTN","PSS0052",12,0)
 Q
"RTN","PSS0052",13,0)
ENQN S DFN=0
"RTN","PSS0052",14,0)
 F  S DFN=$O(^PS(55,DFN)) Q:'DFN  K A D
"RTN","PSS0052",15,0)
 . L ^PS(55,DFN):$S($G(DILOCKTM)>0:DILOCKTM,1:3)
"RTN","PSS0052",16,0)
 . S PSJORD=0 F  S PSJORD=$O(^PS(55,DFN,5,PSJORD)) Q:'PSJORD  S LOG=$P($G(^PS(55,DFN,5,PSJORD,0)),"^",16) I LOG]"" S A(LOG)="" Q
"RTN","PSS0052",17,0)
 . S PSJORD=0 F  S PSJORD=$O(^PS(55,DFN,"IV",PSJORD)) Q:'PSJORD  S LOG=$P($G(^PS(55,DFN,"IV",PSJORD,2)),"^") I LOG]"" S A(LOG)="" Q
"RTN","PSS0052",18,0)
 . S ARC=$O(^PS(55,DFN,"ARC",0)) I ARC S A(ARC)=""
"RTN","PSS0052",19,0)
 . S X=$O(^PS(55,DFN,"P",0)) I X S RX=$G(^(X,0)) I RX]"" S LOG=$P($G(^PSRX(RX,2)),"^") I LOG]"" S A(LOG)=""
"RTN","PSS0052",20,0)
 . S LOG=$O(A("")) I LOG S A=$G(^PS(55,DFN,0)) I $P(A,"^",7)=""!($P(A,"^",7)>LOG) S $P(A,"^",7)=$P(LOG,"."),$P(A,"^",8)="H",^PS(55,DFN,0)=A
"RTN","PSS0052",21,0)
 . L
"RTN","PSS0052",22,0)
SENDMSG ;Send mail message when check is complete.
"RTN","PSS0052",23,0)
 K PSG,XMY S XMDUZ="MANAGEMENT,PHARMACY DATA",XMSUB="BUILD OF FIRST PHARMACY SERVICE INFO COMPLETE",XMTEXT="PSS(",XMY(DUZ)="",XMY("G.PSU PBM@"_$G(^XMB("NETNAME")))="" D NOW^%DTC S Y=% X ^DD("DD")
"RTN","PSS0052",24,0)
 S PSS(1,0)="  The build of first pharmacy service information",PSS(2,0)="completed as of "_Y_"."
"RTN","PSS0052",25,0)
 D ^XMD Q
"RTN","PSSADDIT")
0^2^B46212078^B45782321
"RTN","PSSADDIT",1,0)
PSSADDIT ;BIR/RTR/WRT-Manual match Additives to Orderable Items; 09/01/98 7:06
"RTN","PSSADDIT",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**15,32,41,125**;9/30/97;Build 2
"RTN","PSSADDIT",3,0)
 ;
"RTN","PSSADDIT",4,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSADDIT",5,0)
 ;
"RTN","PSSADDIT",6,0)
 S PSSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSSITE,80)),"^",2)<2 W !!?3,"Orderable Item Auto-Create has not been completed yet!",! K PSSITE,DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR Q
"RTN","PSSADDIT",7,0)
 K PSSITE W !!,"This option enables you to match IV Additives or IV Solutions to the Pharmacy",!,"Orderable Item File." D END
"RTN","PSSADDIT",8,0)
SEL K DIR S PSSSSS=0 S DIR(0)="S^A:ADDITIVES;S:SOLUTIONS",DIR("A")="Match Additives or Solutions" D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G END
"RTN","PSSADDIT",9,0)
 I Y="S" G ^PSSSOLIT
"RTN","PSSADDIT",10,0)
EN I $D(PSAIEN) L -^PS(52.6,PSAIEN)
"RTN","PSSADDIT",11,0)
 D:$G(PSDELFLG) REMAT^PSSSOLIT D:$G(PSMASTER) END Q:$G(PSSSSS)!($G(PSMASTER))  D END W ! K DIC,PSJOUT S DIC="^PS(52.6,",DIC(0)="QEAMZ",DIC("A")="Select IV ADDITIVE: " D ^DIC K DIC G:Y<0!($D(DTOUT))!($D(DUOUT)) END
"RTN","PSSADDIT",12,0)
MAS ;Entry point for Master Enter/Edit
"RTN","PSSADDIT",13,0)
 S PSAIEN=+Y,PSANAME=$P(Y,"^",2),PSDISP=+$P($G(^PS(52.6,PSAIEN,0)),"^",2),PSPOI=$P($G(^(0)),"^",11) L +^PS(52.6,PSAIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this additive." Q
"RTN","PSSADDIT",14,0)
 I 'PSDISP W $C(7),!!?5,"This IV Additive does not point to the Dispense Drug File (#50)",!?5,"it cannot be matched to an Orderable Item!",! G EN
"RTN","PSSADDIT",15,0)
ENTER I 'PSPOI G ADD
"RTN","PSSADDIT",16,0)
 S PSOINAME=$P($G(^PS(50.7,PSPOI,0)),"^"),PSOIDOSE=+$P($G(^(0)),"^",2) W !!,"IV ADDITIVE ->  ",PSANAME,!,"  is already matched to:",!,PSOINAME,"    ",$P($G(^PS(50.606,PSOIDOSE,0)),"^")
"RTN","PSSADDIT",17,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Do you want to re-match this IV Additive",DIR("B")="NO" D ^DIR K DIR I Y'=1 D SELIV^PSSSOLIT G @$S($G(PSSJI)&('$G(PSSIVOUT)):"ENA^PSSVIDRG",1:"EN")
"RTN","PSSADDIT",18,0)
 S PSDELADD=PSAIEN,PSDELOIT=PSPOI,PSDELFLG=1
"RTN","PSSADDIT",19,0)
 K DIE S DA=PSAIEN,DIE="^PS(52.6,",DR="15////"_"@" D ^DIE D EN^PSSPOIDT(PSPOI),EN2^PSSHL1(PSPOI,"MUP") K PSPOI,PSOINAME,PSOIDOSE G ADD
"RTN","PSSADDIT",20,0)
INACT W ! K DIE S PSBEFORE=$P(^PS(50.7,PSPOI,0),"^",4),PSAFTER=0,PSINORDE="" S DIE="^PS(50.7,",DR=".04;.05;.06;.07;.08",DA=PSPOI D ^DIE S PSAFTER=$P(^PS(50.7,PSPOI,0),"^",4) K DIE
"RTN","PSSADDIT",21,0)
 S:PSBEFORE&('PSAFTER) PSINORDE="D" S:PSAFTER PSINORDE="I"
"RTN","PSSADDIT",22,0)
 I PSINORDE'="" D REST^PSSPOIDT(PSPOI)
"RTN","PSSADDIT",23,0)
 K PSBEFORE,PSAFTER,PSINORDE
"RTN","PSSADDIT",24,0)
SYN W ! K DIC S:'$D(^PS(50.7,PSPOI,2,0)) ^PS(50.7,PSPOI,2,0)="^50.72^0^0" S DIC="^PS(50.7,"_PSPOI_",2,",DA(1)=PSPOI,DIC(0)="QEAMZL",DIC("A")="Select SYNONYM: ",DLAYGO=50.7 D ^DIC K DIC
"RTN","PSSADDIT",25,0)
 I Y<0!($D(DTOUT))!($D(DUOUT)) K:'$O(^PS(50.7,PSPOI,2,0)) ^PS(50.7,PSPOI,2,0) Q:$G(NEWFLAG)  D:'$G(PSSSSS) EN2^PSSHL1(PSPOI,"MUP") D END G EN
"RTN","PSSADDIT",26,0)
 W ! S DA=+Y,DIE="^PS(50.7,"_PSPOI_",2,",DA(1)=PSPOI,DR=.01 D ^DIE K DIE G SYN
"RTN","PSSADDIT",27,0)
 Q:$G(NEWFLAG)  D:'$G(PSSSSS) EN2^PSSHL1(PSPOI,"MUP")
"RTN","PSSADDIT",28,0)
 D END G EN
"RTN","PSSADDIT",29,0)
CHECK S (ZZFLAG,ZZXFLAG)=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",XXX,PSOIDOSE,VV)) Q:'VV  S:VV&($P($G(^PS(50.7,VV,0)),"^",3)) ZZFLAG=VV S:VV&($P($G(^(0)),"^",3))&($D(^PS(52.6,"AOI",VV))) ZZXFLAG=VV
"RTN","PSSADDIT",30,0)
 Q
"RTN","PSSADDIT",31,0)
END I $D(PSAIEN) L -^PS(52.6,PSAIEN)
"RTN","PSSADDIT",32,0)
 K PSDELADD,PSDELFLG,PSDELOIT,PSSSSS
"RTN","PSSADDIT",33,0)
 K DA,DIC,DR,DTOUT,LL,QQ,HOLDOI,INFLAG,NEWFLAG,PSAIEN,PSANAME,PSDISP,PSDOSNM,PSDOSPTR,PSND,PSND1,PSND3,PSONEW,PSNDOSE,PSNEWOI,PSOIDOSE,PSOINAME,PSPOI,SCOUNT,SS,SYN,SYN1,VV,PFLAG,PFLAGOI,WW,X,XXX,Y,ZZFLAG,PANS,ZZXFLAG,SYNNAM,VV,VVV,TT,SCLAST Q
"RTN","PSSADDIT",34,0)
ADD ;
"RTN","PSSADDIT",35,0)
 K PSDOSPTR S PSND=$G(^PSDRUG(PSDISP,"ND")),PSND1=$P(PSND,"^"),PSND3=$P(PSND,"^",3),DA=PSND1,K=PSND3
"RTN","PSSADDIT",36,0)
 I PSND1,PSND3 S X=$$PSJDF^PSNAPIS(DA,K) S PSDOSPTR=$P(X,"^")
"RTN","PSSADDIT",37,0)
 I $G(PSDOSPTR),$D(^PS(50.606,PSDOSPTR,0)) W !?3,"*** Dose Form from NDF:  ",$P($G(^PS(50.606,PSDOSPTR,0)),"^") G PASS
"RTN","PSSADDIT",38,0)
 W ! K DIC S DIC="^PS(50.606,",DIC(0)="QEAMZ",DIC("A")="Select Dose Form: " D ^DIC K DIC I Y<1!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSADDIT",39,0)
 S PSDOSPTR=+Y
"RTN","PSSADDIT",40,0)
PASS S PSDOSNM=$P($G(^PS(50.606,PSDOSPTR,0)),"^"),PSOIDOSE=PSDOSPTR S XXX=PSANAME D CHECK
"RTN","PSSADDIT",41,0)
 I $G(ZZFLAG),'$G(ZZXFLAG) W $C(7),!!,"There is already an Orderable Item named:",!?5,$P($G(^PS(50.7,ZZFLAG,0)),"^"),"   ",$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"),!
"RTN","PSSADDIT",42,0)
 I  K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Match to this Orderable Item" D ^DIR K DIR I Y["^"!($D(DTOUT)) G EN
"RTN","PSSADDIT",43,0)
 I $G(ZZFLAG),'$G(ZZXFLAG),$G(Y) W !!,"Matching: ",PSANAME,!,"   to",!,$P($G(^PS(50.7,+ZZFLAG,0)),"^")_"   "_PSDOSNM W ! K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK" D ^DIR S PANS=Y G:PANS=1 MAT^PSSSUTIL G:(PANS["^")!($D(DTOUT)) EN
"RTN","PSSADDIT",44,0)
 I $G(ZZXFLAG) W $C(7),!!?5,"You must create a new Orderable Item Name for this IV Additive, since a",!?5,"duplicate already exists with another IV Additive matched to it!",!
"RTN","PSSADDIT",45,0)
XDIR W !!,"Additive Name ->  ",$G(PSANAME),!,"Dose Form ->      ",$G(PSDOSNM),!
"RTN","PSSADDIT",46,0)
 S X=PSANAME D INPUT
"RTN","PSSADDIT",47,0)
 K DIR S DIR(0)="F^3:40",DIR("A")="Enter Orderable Item Name" I '$G(ZZXFLAG),'$G(INFLAG),$L(PSANAME)>2,$L(PSANAME)<41 S DIR("B")=PSANAME
"RTN","PSSADDIT",48,0)
 D ^DIR K DIR I Y["^"!(Y="")!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSADDIT",49,0)
 S HOLDOI=X
"RTN","PSSADDIT",50,0)
 D INPUT I INFLAG S X=PSANAME G XDIR
"RTN","PSSADDIT",51,0)
 S (PFLAG,PFLAGOI)=0 F QQ=0:0 S QQ=$O(^PS(50.7,"ADF",X,PSOIDOSE,QQ)) Q:'QQ!(PFLAG)  I QQ,$P($G(^PS(50.7,QQ,0)),"^",3)'="" S PFLAG=1,PFLAGOI=QQ
"RTN","PSSADDIT",52,0)
 I PFLAG,$D(^PS(52.6,"AOI",PFLAGOI)) W $C(7),!!,?2,"A duplicate Name and Dose Form entry already exists in the Orderable Item",!,?2,"File, with a corresponding matched IV Additive. You must select another name!" G XDIR
"RTN","PSSADDIT",53,0)
 I PFLAG,'$D(^PS(52.6,"AOI",PFLAGOI)) W !!,"Matching: ",PSANAME,!,"   to",!,$P($G(^PS(50.7,PFLAGOI,0)),"^")_"   "_$G(PSDOSNM) W ! K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK" D ^DIR K DIR G:Y["^"!($D(DTOUT)) EN G:Y=0 XDIR
"RTN","PSSADDIT",54,0)
 I PFLAG,'$D(^PS(52.6,"AOI",PFLAGOI)) S ZZFLAG=PFLAGOI G MAT^PSSSUTIL
"RTN","PSSADDIT",55,0)
NEW  ;create new entry in 50.7 and match to it
"RTN","PSSADDIT",56,0)
 W !!,"Matching: ",PSANAME,!,"  to",!,HOLDOI_"  "_$G(PSDOSNM)
"RTN","PSSADDIT",57,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Is this OK" D ^DIR K DIR W ! I Y'=1 S X=PSANAME G XDIR
"RTN","PSSADDIT",58,0)
 K DIC,DD,DO S DIC="^PS(50.7,",DIC(0)="L",X=HOLDOI,DIC("DR")=".02////"_PSOIDOSE_";.03////"_1 D FILE^DICN K DIC
"RTN","PSSADDIT",59,0)
 I Y<1 W !!?5,"UNABLE TO CREATE ENTRY, TRY AGAIN!",! G XDIR
"RTN","PSSADDIT",60,0)
 S PSNEWOI=+Y S SCOUNT=0 F SS=0:0 S SS=$O(^PS(52.6,PSAIEN,3,SS)) Q:'SS  S SCOUNT=SCOUNT+1,SYN(SCOUNT)=^(SS,0)
"RTN","PSSADDIT",61,0)
 K DIE S DIE="^PS(52.6,",DA=PSAIEN,DR="15////"_PSNEWOI D ^DIE K DIE
"RTN","PSSADDIT",62,0)
 I SCOUNT S ^PS(50.7,PSNEWOI,2,0)="^50.72^"_SCOUNT_"^"_SCOUNT F WW=0:0 S WW=$O(SYN(WW)) Q:'WW  S ^PS(50.7,PSNEWOI,2,WW,0)=SYN(WW)
"RTN","PSSADDIT",63,0)
 I SCOUNT F LL=0:0 S LL=$O(^PS(50.7,PSNEWOI,2,LL)) Q:'LL  S SYNNAM=$P(^(LL,0),"^"),^PS(50.7,PSNEWOI,2,"B",SYNNAM,LL)=""
"RTN","PSSADDIT",64,0)
 S NEWFLAG=1 S PSPOI=PSNEWOI D DIR^PSSPOIM3 I $G(PSSDIR) W !!?3,"Now editing Orderable Item:",!?3,$P(^PS(50.7,PSNEWOI,0),"^"),"   ",$P($G(^PS(50.606,+$P(^(0),"^",2),0)),"^") D INACT K NEWFLAG
"RTN","PSSADDIT",65,0)
 K NEWFLAG,PSSDIR
"RTN","PSSADDIT",66,0)
 D EN^PSSPOIDT(PSPOI) D:'$G(PSSSSS) EN2^PSSHL1(PSNEWOI,"MAD")
"RTN","PSSADDIT",67,0)
 G EN
"RTN","PSSADDIT",68,0)
INPUT S INFLAG=0 I X[""""!($A(X)=45)!('(X'?1P.E))!(X?2"z".E) W $C(7),!?5,"??",! S INFLAG=1
"RTN","PSSADDIT",69,0)
 Q
"RTN","PSSDFEE")
0^4^B3042568^B2931039
"RTN","PSSDFEE",1,0)
PSSDFEE ;BIR/ASJ-VARIOUS FILES ENTER EDIT ROUTINE ;01/21/00
"RTN","PSSDFEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**38,48,125**;9/30/97;Build 2
"RTN","PSSDFEE",3,0)
DF ;Dosage File Enter/Edit
"RTN","PSSDFEE",4,0)
 D ^PSSDEE2 N DIC,PSSDF
"RTN","PSSDFEE",5,0)
 F  W !! S DIC(0)="QEAMZ",DIC="^PS(50.606,",DIC("S")="I '$P(^(0),""^"",2)!($P(^(0),""^"",2)>DT)" D ^DIC S PSSREC=+Y Q:PSSREC<0  W !!,"NAME: ",Y(0,0) D EDT(DIC,PSSREC,"[PSS DOSAGE FORM]",50.606)
"RTN","PSSDFEE",6,0)
 W ! Q
"RTN","PSSDFEE",7,0)
MR ;Medication Routes File Enter/Edit
"RTN","PSSDFEE",8,0)
 D ^PSSDEE2 N DIC,PSSDF,DLAYGO
"RTN","PSSDFEE",9,0)
 F  W !! S DIC(0)="QEAMZIL",DIC="^PS(51.2,",DLAYGO=51.2 D ^DIC Q:Y<0  S PSSREC=+Y D EDT(DIC,PSSREC,"[PSS MEDICATION ROUTES]",51.2)
"RTN","PSSDFEE",10,0)
 W ! Q
"RTN","PSSDFEE",11,0)
CF ;Rx Consult File
"RTN","PSSDFEE",12,0)
 Q
"RTN","PSSDFEE",13,0)
 ; It was decided not to put this functionality in PSS*1*38
"RTN","PSSDFEE",14,0)
 D ^PSSDEE2 N DIC,PSSDF,DLAYGO
"RTN","PSSDFEE",15,0)
 F  W !! S DIC(0)="QEAMZIL",DIC="^PS(54,",DLAYGO=54 D ^DIC Q:Y<0  S PSSREC=+Y D EDT(DIC,PSSREC,"[PSS RX CONSULT]",54)
"RTN","PSSDFEE",16,0)
 W @IOF Q
"RTN","PSSDFEE",17,0)
 ;
"RTN","PSSDFEE",18,0)
EDT(DIE,DA,DR,PSFILE)    ;
"RTN","PSSDFEE",19,0)
 N PSREC S PSREC=DA
"RTN","PSSDFEE",20,0)
 L +^PS(PSFILE,PSREC):$S($G(DILOCKTM)>0:DILOCKTM,1:3)
"RTN","PSSDFEE",21,0)
 I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSDFEE",22,0)
 D ^DIE K DIE,DR,DA,Y
"RTN","PSSDFEE",23,0)
 L -^PS(PSFILE,PSREC)
"RTN","PSSDFEE",24,0)
 Q
"RTN","PSSDOSER")
0^5^B51987793^B51578394
"RTN","PSSDOSER",1,0)
PSSDOSER ;BIR/RTR-Dose edit option ;03/10/00
"RTN","PSSDOSER",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**34,38,50,57,47,68,82,125**;9/30/97;Build 2
"RTN","PSSDOSER",3,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSDOSER",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSDOSER",5,0)
 ;
"RTN","PSSDOSER",6,0)
 ;have an entry point for NDF to call when rematching
"RTN","PSSDOSER",7,0)
DOS ;Edit dosages
"RTN","PSSDOSER",8,0)
 D CHECK^PSSUTLPR I $G(PSSNOCON) K PSSNOCON D END Q
"RTN","PSSDOSER",9,0)
 D END
"RTN","PSSDOSER",10,0)
 W !! S DIC(0)="QEAMZ",DIC("A")="Select Drug: ",DIC="^PSDRUG(" D ^DIC K DIC I Y<1!($D(DTOUT))!($D(DUOUT)) D END W ! Q
"RTN","PSSDOSER",11,0)
 S PSSIEN=+Y,PSSNAME=$P($G(^PSDRUG(PSSIEN,0)),"^"),PSSIND=$P($G(^("I")),"^"),PSSNFID=$P($G(^(0)),"^",9)
"RTN","PSSDOSER",12,0)
 S PSSPKG=$P($G(^PSDRUG(PSSIEN,2)),"^",3)
"RTN","PSSDOSER",13,0)
 W !!,"This entry is marked for the following PHARMACY packages:"
"RTN","PSSDOSER",14,0)
 W:PSSPKG["O" !,"Outpatient" W:PSSPKG["U" !,"Unit Dose"
"RTN","PSSDOSER",15,0)
 W:PSSPKG["I" !,"IV" W:PSSPKG["W" !,"Ward Stock"
"RTN","PSSDOSER",16,0)
 W:PSSPKG["N" !,"Controlled Substances" W:PSSPKG["X" !,"Non-VA Med"
"RTN","PSSDOSER",17,0)
 I PSSPKG'["O",PSSPKG'["U",PSSPKG'["I",PSSPKG'["W",PSSPKG'["N",PSSPKG'["X" W !," (none)"
"RTN","PSSDOSER",18,0)
 K PSSPKG L +^PSDRUG(PSSIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !!,$C(7),"Another person is editing this drug.",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR G DOS
"RTN","PSSDOSER",19,0)
 W !!,PSSNAME_$S($G(PSSNFID):"    *N/F*",1:"") W ?52,"Inactive Date: "_$S($G(PSSIND):$E(PSSIND,4,5)_"/"_$E(PSSIND,6,7)_"/"_$E(PSSIND,2,3),1:"")
"RTN","PSSDOSER",20,0)
 S (PSSIZZ,PSSOZZ,PSSSKIPP)=0
"RTN","PSSDOSER",21,0)
RES ;
"RTN","PSSDOSER",22,0)
 D STUN
"RTN","PSSDOSER",23,0)
 I PSSST="",$O(^PSDRUG(PSSIEN,"DOS1",0)) K ^PSDRUG(PSSIEN,"DOS") K ^PSDRUG(PSSIEN,"DOS1")
"RTN","PSSDOSER",24,0)
 S PSSXYZ=0 D CHECK
"RTN","PSSDOSER",25,0)
 I $G(PSSST),$O(^PSDRUG(PSSIEN,"DOS1",0)) D STR G SKIP
"RTN","PSSDOSER",26,0)
 I PSSXYZ,'$O(^PSDRUG(PSSIEN,"DOS1",0)) D  D ^DIR K DIR I Y=1 S PSSSKIPP=1 D EN2^PSSUTIL(PSSIEN,1) G RES
"RTN","PSSDOSER",27,0)
 .K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Create Possible Dosages for this drug",DIR("?")=" "
"RTN","PSSDOSER",28,0)
 .S DIR("?",1)="This drug meets the criteria to have Possible Dosages, but it currently does",DIR("?",2)="not have any. If you answer 'YES', Possible Dosages will be created for this"
"RTN","PSSDOSER",29,0)
 .S DIR("?",3)="drug, based on the match to the National Drug File."
"RTN","PSSDOSER",30,0)
 .W !!!,"This drug can have Possible Dosages, but currently does not have any.",!
"RTN","PSSDOSER",31,0)
SKIP ;
"RTN","PSSDOSER",32,0)
 K PSSXYZ
"RTN","PSSDOSER",33,0)
 I '$O(^PSDRUG(PSSIEN,"DOS1",0)) G LOCX
"RTN","PSSDOSER",34,0)
DOSA S PSSST=$P($G(^PSDRUG(PSSIEN,"DOS")),"^")
"RTN","PSSDOSER",35,0)
 W !!,"Strength => "_$S($E($G(PSSST),1)=".":"0",1:"")_$G(PSSST)_"   Unit => "_$S($P($G(^PS(50.607,+$G(PSSUN),0)),"^")'["/":$P($G(^(0)),"^"),1:"") W !
"RTN","PSSDOSER",36,0)
 K DIC S DA(1)=PSSIEN,DIC="^PSDRUG("_PSSIEN_",""DOS1"",",DIC(0)="QEAMLZ",DLAYGO=50,DIC("A")="Select DISPENSE UNITS PER DOSE: " D  D ^DIC K DIC,DLAYGO I Y<1!($D(DTOUT))!($D(DUOUT)) G DOSLOC
"RTN","PSSDOSER",37,0)
 .S DIC("W")="W ""  ""_$S($E($P($G(^PSDRUG(PSSIEN,""DOS1"",+Y,0)),""^"",2),1)=""."":""0"",1:"""")_$P($G(^PSDRUG(PSSIEN,""DOS1"",+Y,0)),""^"",2)_""    ""_$P($G(^PSDRUG(PSSIEN,""DOS1"",+Y,0)),""^"",3)"
"RTN","PSSDOSER",38,0)
 S PSSDOSA=+Y,PSSOTH=$S($P($G(^PS(59.7,1,40.2)),"^"):1,1:0)
"RTN","PSSDOSER",39,0)
 W ! K DIE S DA(1)=PSSIEN,DA=PSSDOSA,DR=".01;S:'$G(PSSOTH) Y=""@1"";3;@1;2",DIE="^PSDRUG("_PSSIEN_",""DOS1""," D ^DIE K DIE D:'$D(Y)&('$D(DTOUT)) BCMA G:$D(Y)!($D(DTOUT)) DOSLOC
"RTN","PSSDOSER",40,0)
 G DOSA
"RTN","PSSDOSER",41,0)
DOSLOC ;
"RTN","PSSDOSER",42,0)
 S (PSSPCI,PSSPCO)=0
"RTN","PSSDOSER",43,0)
 F PSSPCZ=0:0 S PSSPCZ=$O(^PSDRUG(PSSIEN,"DOS1",PSSPCZ)) Q:'PSSPCZ  D
"RTN","PSSDOSER",44,0)
 .I $P($G(^PSDRUG(PSSIEN,"DOS1",PSSPCZ,0)),"^",2)'="" S:$P($G(^(0)),"^",3)["I" PSSPCI=1 S:$P($G(^(0)),"^",3)["O" PSSPCO=1
"RTN","PSSDOSER",45,0)
 I PSSPCI,PSSPCO W !! K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Enter/Edit Local Possible Dosages" D  D ^DIR K DIR I Y'=1 K PSSPCI,PSSPCO,PSSPCZ W ! D ULK G DOS
"RTN","PSSDOSER",46,0)
 .S DIR("?")=" ",DIR("?",1)="Possible Dosages exist for both Outpatient Pharmacy and Inpatient Medications.",DIR("?",2)="Local Possible Dosages can be added, but will not be displayed for selection"
"RTN","PSSDOSER",47,0)
 .S DIR("?",3)="as long as there are Possible Dosages.",DIR("?",4)=" ",DIR("?",5)="Enter 'Y' to Enter/Edit Local Possible Dosages."
"RTN","PSSDOSER",48,0)
 K PSSPCI,PSSPCO,PSSPCZ
"RTN","PSSDOSER",49,0)
LOCX ;
"RTN","PSSDOSER",50,0)
 I $G(PSSSKIPP) G LOC
"RTN","PSSDOSER",51,0)
 I $G(PSSIZZ),$G(PSSOZZ) G LOC
"RTN","PSSDOSER",52,0)
 K PSSONLYI,PSSONLYO
"RTN","PSSDOSER",53,0)
 I $G(PSSIZZ),'$G(PSSOZZ) S PSSONLYO=1
"RTN","PSSDOSER",54,0)
 I $G(PSSOZZ),'$G(PSSIZZ) S PSSONLYI=1
"RTN","PSSDOSER",55,0)
 S PSSTALK=1,PSSDIEN=PSSIEN D LOC^PSSUTIL K PSSONLYO,PSSONLYI,PSSTALK,PSSDIEN
"RTN","PSSDOSER",56,0)
 ;MAKE SURE THOSE ARE THE VARIABLES YOU NEED TO SET
"RTN","PSSDOSER",57,0)
LOC ; Edit local dose
"RTN","PSSDOSER",58,0)
 D STUN,NATND,PR
"RTN","PSSDOSER",59,0)
 W ! K DIC S DA(1)=PSSIEN,DIC="^PSDRUG("_PSSIEN_",""DOS2"",",DLAYGO=50,DIC(0)="QEAMLZ" D  D ^DIC K DIC,DLAYGO I Y<1!($D(DTOUT))!($D(DUOUT)) D ULK G DOS
"RTN","PSSDOSER",60,0)
 .S DIC("W")="W ""  ""_$P($G(^PSDRUG(PSSIEN,""DOS2"",+Y,0)),""^"",2)"
"RTN","PSSDOSER",61,0)
 S PSSDOSA=+Y,PSSOTH=$S($P($G(^PS(59.7,1,40.2)),"^"):1,1:0)
"RTN","PSSDOSER",62,0)
 W ! K DIE S DA(1)=PSSIEN,DA=PSSDOSA,DR=".01;S:'$G(PSSOTH) Y=""@1"";3;@1;1",DIE="^PSDRUG("_PSSIEN_",""DOS2""," D ^DIE K DIE,PSSOTH
"RTN","PSSDOSER",63,0)
 D:'$D(Y)&('$D(DTOUT)) BCMA1 I $D(Y)!($D(DTOUT)) D ULK G DOS
"RTN","PSSDOSER",64,0)
 G LOC
"RTN","PSSDOSER",65,0)
 Q
"RTN","PSSDOSER",66,0)
STR ;Edit strength
"RTN","PSSDOSER",67,0)
 N PSSIENS,PSS11
"RTN","PSSDOSER",68,0)
 W !!,"Strength from National Drug File match => "_$S($E($G(PSSNATST),1)=".":"0",1:"")_$G(PSSNATST)_"    "_$P($G(^PS(50.607,+$G(PSSUN),0)),"^")
"RTN","PSSDOSER",69,0)
 W !,"Strength currently in the Drug File    => "_$S($E($P($G(^PSDRUG(PSSIEN,"DOS")),"^"),1)=".":"0",1:"")_$P($G(^PSDRUG(PSSIEN,"DOS")),"^")_"    "_$S($P($G(^PS(50.607,+$G(PSSUN),0)),"^")'["/":$P($G(^(0)),"^"),1:"")
"RTN","PSSDOSER",70,0)
 W ! K DIR S DIR(0)="Y",DIR("?")="Changing the strength will update all possible dosages for this Drug",DIR("B")="N",DIR("A")="Edit Strength" D ^DIR K DIR I 'Y W ! Q
"RTN","PSSDOSER",71,0)
 W ! K DIE S DIE="^PSDRUG(",DA=PSSIEN,DR=901 D ^DIE K DIE W !
"RTN","PSSDOSER",72,0)
 I $P($G(^PSDRUG(PSSIEN,"DOS")),"^")="" K ^PSDRUG(PSSIEN,"DOS") K ^PSDRUG(PSSIEN,"DOS1") W !!,"Deleting Strength has deleted all Possible Dosages!",!
"RTN","PSSDOSER",73,0)
 Q
"RTN","PSSDOSER",74,0)
CHECK ;
"RTN","PSSDOSER",75,0)
 K PSSNAT,PSSNATND,PSSNATDF,PSSNATUN,PSSNATST,PSSIZZ,PSSOZZ
"RTN","PSSDOSER",76,0)
 S PSSNAT=+$P($G(^PSDRUG(PSSIEN,"ND")),"^",3),PSSNAT1=$P($G(^("ND")),"^") I 'PSSNAT!('PSSNAT1) Q
"RTN","PSSDOSER",77,0)
 S PSSNATND=$$DFSU^PSNAPIS(PSSNAT1,PSSNAT) S PSSNATDF=$P(PSSNATND,"^"),PSSNATST=$P(PSSNATND,"^",4),PSSNATUN=$P(PSSNATND,"^",5)
"RTN","PSSDOSER",78,0)
 ;I $G(PSSST) S PSSXYZ=1 Q
"RTN","PSSDOSER",79,0)
 Q:'PSSNATDF!('PSSNATUN)!($G(PSSNATST)="")
"RTN","PSSDOSER",80,0)
 Q:'$D(^PS(50.606,PSSNATDF,0))!('$D(^PS(50.607,PSSNATUN,0)))
"RTN","PSSDOSER",81,0)
 I PSSNATST'?.N&(PSSNATST'?.N1".".N) Q
"RTN","PSSDOSER",82,0)
 I $D(^PS(50.606,"ACONI",PSSNATDF,PSSNATUN)),$O(^PS(50.606,"ADUPI",PSSNATDF,0)) S (PSSXYZ,PSSIZZ)=1
"RTN","PSSDOSER",83,0)
 I $D(^PS(50.606,"ACONO",PSSNATDF,PSSNATUN)),$O(^PS(50.606,"ADUPO",PSSNATDF,0)) S (PSSXYZ,PSSOZZ)=1
"RTN","PSSDOSER",84,0)
 Q
"RTN","PSSDOSER",85,0)
END K PSSIZZ,PSSOZZ,PSSSKIPP,PSSNFID,PSSNAT,PSSNAT1,PSSNATND,PSSNATDF,PSSNATUN,PSSNOCON,PSSST,PSSUN,PSSIEN,PSSNAME,PSSIND,PSSDOSA,PSSXYZ,PSSNATST
"RTN","PSSDOSER",86,0)
 Q
"RTN","PSSDOSER",87,0)
ULK ;
"RTN","PSSDOSER",88,0)
 Q:'$G(PSSIEN)
"RTN","PSSDOSER",89,0)
 N XX,DNSNAM,DNSPORT,DVER,DMFU S XX=""
"RTN","PSSDOSER",90,0)
 I '$G(PSSHUIDG) D DRG^PSSHUIDG(PSSIEN) D
"RTN","PSSDOSER",91,0)
 .F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSDOSER",92,0)
 ..S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSDOSER",93,0)
 ..I DVER="2.4" S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007) I DNSNAM'=""&(DMFU="YES") D DRG^PSSDGUPD(PSSIEN,"",DNSNAM,DNSPORT)
"RTN","PSSDOSER",94,0)
 L -^PSDRUG(PSSIEN)
"RTN","PSSDOSER",95,0)
 Q
"RTN","PSSDOSER",96,0)
BCMA ;
"RTN","PSSDOSER",97,0)
 I $P($G(^PSDRUG(PSSIEN,2)),"^",3)'["I",$P($G(^(2)),"^",3)'["U" Q
"RTN","PSSDOSER",98,0)
 I $P($G(^PSDRUG(PSSIEN,"DOS1",PSSDOSA,0)),"^",3)'["I" Q
"RTN","PSSDOSER",99,0)
 K DIE S DA(1)=PSSIEN,DA=PSSDOSA,DR=3,DIE="^PSDRUG("_PSSIEN_",""DOS1""," D ^DIE K DIE
"RTN","PSSDOSER",100,0)
 Q
"RTN","PSSDOSER",101,0)
BCMA1 ;
"RTN","PSSDOSER",102,0)
 I $P($G(^PSDRUG(PSSIEN,2)),"^",3)'["I",$P($G(^(2)),"^",3)'["U" Q
"RTN","PSSDOSER",103,0)
 I $P($G(^PSDRUG(PSSIEN,"DOS2",PSSDOSA,0)),"^",2)'["I" Q
"RTN","PSSDOSER",104,0)
 K DIE S DA(1)=PSSIEN,DA=PSSDOSA,DR=2,DIE="^PSDRUG("_PSSIEN_",""DOS2""," D ^DIE K DIE
"RTN","PSSDOSER",105,0)
 Q
"RTN","PSSDOSER",106,0)
STUN S PSSST=$P($G(^PSDRUG(PSSIEN,"DOS")),"^"),PSSUN=$P($G(^("DOS")),"^",2)
"RTN","PSSDOSER",107,0)
 Q
"RTN","PSSDOSER",108,0)
NATND S PSSNAT=+$P($G(^PSDRUG(PSSIEN,"ND")),"^",3),PSSNAT1=$P($G(^("ND")),"^")
"RTN","PSSDOSER",109,0)
 S PSSNATND=$$DFSU^PSNAPIS(PSSNAT1,PSSNAT) S PSSNATDF=$P(PSSNATND,"^"),PSSNATST=$P(PSSNATND,"^",4),PSSNATUN=$P(PSSNATND,"^",5)
"RTN","PSSDOSER",110,0)
 Q
"RTN","PSSDOSER",111,0)
PR I PSSST'=""!(PSSNATST'=""),(PSSUN!(PSSNATUN)) D
"RTN","PSSDOSER",112,0)
 .W !!,"Strength: "_$S($E($S(PSSST'="":PSSST,1:PSSNATST),1)=".":"0",1:"")_$S(PSSST'="":PSSST,1:PSSNATST)
"RTN","PSSDOSER",113,0)
 .W ?30,"Unit: "_$P($G(^PS(50.607,+$S(PSSUN:PSSUN,1:PSSNATUN),0)),"^")
"RTN","PSSDOSER",114,0)
 E  W !!,"Strength: ",?30,"Unit: "
"RTN","PSSDOSER",115,0)
 Q
"RTN","PSSHELP")
0^6^B2969588^B3230088
"RTN","PSSHELP",1,0)
PSSHELP ;BIR/SAB-PDM UTILITY ROUTINE ; 09/02/97 8:37
"RTN","PSSHELP",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**125**;9/30/97;Build 2
"RTN","PSSHELP",3,0)
ADD ;add/edited local drug/drug interactions
"RTN","PSSHELP",4,0)
 W ! S DIC("A")="Select Drug Interaction: ",DIC(0)="AEMQL",(DIC,DIE)="^PS(56,",DIC("S")="I '$P(^(0),""^"",5)",DLAYGO=56
"RTN","PSSHELP",5,0)
 D ^DIC G:"^"[X QU G:Y<0 ADD S DA=+Y,DR="[PSS INTERACT]" L +^PS(56,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) W:'$T !,$C(7),"Already being edited." I $T D ^DIE L:$G(DA) -^PS(56,DA) K DA G ADD
"RTN","PSSHELP",6,0)
QU K X,DIC,DIE,DA
"RTN","PSSHELP",7,0)
 Q
"RTN","PSSHELP",8,0)
CRI ;change drug interaction severity to critical from significant
"RTN","PSSHELP",9,0)
 W ! S DIC("A")="Select Drug Interaction: ",DIC(0)="AEQM",(DIC,DIE)="^PS(56,",DIC("S")="I $P(^(0),""^"",4)=2"
"RTN","PSSHELP",10,0)
 D ^DIC G:"^"[X QU G:Y<0 CRI S DA=+Y,DR=3 L +^PS(56,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) W:'$T !,$C(7),"Already being edited." I $T D ^DIE L -^PS(56,DA) K DA G CRI
"RTN","PSSHELP",11,0)
 G QU
"RTN","PSSHELP",12,0)
 Q
"RTN","PSSHL1")
0^7^B26832539^B25861305
"RTN","PSSHL1",1,0)
PSSHL1 ;BIR/RLW/WRT-BUILD HL7 MESSAGE TO POPULATE ORDERABLE ITEM FILE ;09/08/97
"RTN","PSSHL1",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**38,68,125**;9/30/97;Build 2
"RTN","PSSHL1",3,0)
 ;External reference to ORD(101 supported by DBIA 872
"RTN","PSSHL1",4,0)
 ; PSJEC=event code from HL7 table 8.4.2.1
"RTN","PSSHL1",5,0)
 ; PSJSPIEN=ien to super-primary drug file (#50.7)
"RTN","PSSHL1",6,0)
 ; SPDNAME=.01 field (name) of super-primary drug
"RTN","PSSHL1",7,0)
 ; LIMIT=number of fields in HL7 segment being built
"RTN","PSSHL1",8,0)
 ;
"RTN","PSSHL1",9,0)
 W !!?3,"This routine should not be accessed through programmer mode!",!
"RTN","PSSHL1",10,0)
 Q
"RTN","PSSHL1",11,0)
EN1 ; start here for pre-install auto load
"RTN","PSSHL1",12,0)
 N MENU,MENUP,ITEM
"RTN","PSSHL1",13,0)
 D PRO Q:$G(XPDABORT)
"RTN","PSSHL1",14,0)
 S PSSMFU=+$O(^PS(59.7,0)) I $P(^PS(59.7,PSSMFU,80),"^",2)=4 K PSSMFU Q
"RTN","PSSHL1",15,0)
 N APPL,CODE,FIELD,LIMIT,MFE,PSJI,SEGMENT,SPDNAME,SYN,SYNONYM,USAGE,X
"RTN","PSSHL1",16,0)
 I '$D(^XTMP("PSO_V7 INSTALL",0)) S X1=DT,X2=+7 D C^%DTC S ^XTMP("PSO_V7 INSTALL",0)=DT_"^"_X_"^OUTPATIENT V7 KIDS INSTALL" L +^XTMP("PSO_V7 INSTALL",0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) G SKIP
"RTN","PSSHL1",17,0)
 F  Q:'$D(^XTMP("PSO_V7 INSTALL",0))  L +^XTMP("PSO_V7 INSTALL",0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) Q:$T
"RTN","PSSHL1",18,0)
 I '$D(^XTMP("PSO_V7 INSTALL",0)) S X1=DT,X2=+7 D C^%DTC S ^XTMP("PSO_V7 INSTALL",0)=DT_"^"_X_"^OUTPATIENT V7 KIDS INSTALL" L +^XTMP("PSO_V7 INSTALL",0):$S($G(DILOCKTM)>0:DILOCKTM,1:3)
"RTN","PSSHL1",19,0)
 I $P(^PS(59.7,PSSMFU,80),"^",2)=4 L -^XTMP("PSO_V7 INSTALL",0) K ^XTMP("PSO_V7 INSTALL",0) Q
"RTN","PSSHL1",20,0)
SKIP ;
"RTN","PSSHL1",21,0)
 S PSJEC="MAD",CODE="REP"
"RTN","PSSHL1",22,0)
 D INIT
"RTN","PSSHL1",23,0)
 D LOOP,MF^PSSHLU(PSJI)
"RTN","PSSHL1",24,0)
 S PSLSITE=+$O(^PS(59.7,0)) S $P(^PS(59.7,PSLSITE,80),"^",2)=4 K PSLSITE
"RTN","PSSHL1",25,0)
 L -^XTMP("PSO_V7 INSTALL",0) K ^XTMP("PSO_V7 INSTALL",0)
"RTN","PSSHL1",26,0)
 K ^TMP("HLS",$J,"PS"),PSJEC,PSJSPIEN,PSJCLEAR,PSSMFU Q
"RTN","PSSHL1",27,0)
 ;
"RTN","PSSHL1",28,0)
EN2(PSJSPIEN,PSJEC) ; start here for "manual" update
"RTN","PSSHL1",29,0)
 S PSLSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSLSITE,80)),"^",2)<4 K PSLSITE Q
"RTN","PSSHL1",30,0)
 ; passed in: internal entry # of super-primary drug, entry code
"RTN","PSSHL1",31,0)
 S:'$P($G(^PS(50.7,PSJSPIEN,0)),"^",4) PSJEC="MAC"
"RTN","PSSHL1",32,0)
 K PSLSITE N APPL,CODE,FIELD,PSJI,LIMIT,MFE,SEGMENT,SPDNAME,SYN,SYNONYM,USAGE,X,ZCOUNT,ZUSAGE
"RTN","PSSHL1",33,0)
 S CODE="UPD"
"RTN","PSSHL1",34,0)
 D INIT
"RTN","PSSHL1",35,0)
 D MFE(PSSIVID),MF^PSSHLU(PSJI)
"RTN","PSSHL1",36,0)
 K ^TMP("HLS",$J,"PS")
"RTN","PSSHL1",37,0)
 Q
"RTN","PSSHL1",38,0)
 ;
"RTN","PSSHL1",39,0)
 ;
"RTN","PSSHL1",40,0)
INIT ; initialize HL7 variables, set master file identification segment fields
"RTN","PSSHL1",41,0)
 S PSJI=0,LIMIT=6,HLMTN="MFN",PSSIVID=$$GTIVID()
"RTN","PSSHL1",42,0)
 D INIT^PSSHLU X PSJCLEAR
"RTN","PSSHL1",43,0)
 S FIELD(0)="MFI"
"RTN","PSSHL1",44,0)
 S FIELD(1)="50.7^PHARMACY ORDERABLE ITEM^99DD"
"RTN","PSSHL1",45,0)
 S FIELD(3)=CODE
"RTN","PSSHL1",46,0)
 S FIELD(6)="NE"
"RTN","PSSHL1",47,0)
 D SEGMENT^PSSHLU(LIMIT)
"RTN","PSSHL1",48,0)
 Q
"RTN","PSSHL1",49,0)
 ;
"RTN","PSSHL1",50,0)
LOOP ; loop through PHARMACY ORDERABLE ITEM file
"RTN","PSSHL1",51,0)
 ;F  L +^PS(59.7,PSSIVID,31) Q:$T  H 1
"RTN","PSSHL1",52,0)
 S PSJSPIEN=0 F  S PSJSPIEN=$O(^PS(50.7,PSJSPIEN)) Q:'PSJSPIEN  D MFE(PSSIVID)
"RTN","PSSHL1",53,0)
 ;L -^PS(59.7,PSSIVID,31)
"RTN","PSSHL1",54,0)
 Q
"RTN","PSSHL1",55,0)
 ;
"RTN","PSSHL1",56,0)
MFE(PSSIVID) ; set master file entry segment fields
"RTN","PSSHL1",57,0)
 ; Input: PSSIVID-IV Identifier
"RTN","PSSHL1",58,0)
 S LIMIT=4 X PSJCLEAR
"RTN","PSSHL1",59,0)
 S X=$G(^PS(50.7,PSJSPIEN,0))
"RTN","PSSHL1",60,0)
 S FIELD(0)="MFE"
"RTN","PSSHL1",61,0)
 S FIELD(1)=PSJEC
"RTN","PSSHL1",62,0)
 S FIELD(3)=$P($G(^PS(50.7,PSJSPIEN,0)),"^",4) I FIELD(3) S FIELD(3)=$$HLDATE^HLFNC(FIELD(3))
"RTN","PSSHL1",63,0)
 S FIELD(4)="^^^"_PSJSPIEN_"^"_$P(X,"^")_"~"_$P($G(^PS(50.606,$P(X,"^",2),0)),"^")_"~"_$S($P($G(^PS(50.7,PSJSPIEN,0)),"^",3):$G(PSSIVID),1:"")_"^99PSP"
"RTN","PSSHL1",64,0)
 D SEGMENT^PSSHLU(LIMIT)
"RTN","PSSHL1",65,0)
 D ZPS,ZSY
"RTN","PSSHL1",66,0)
 Q
"RTN","PSSHL1",67,0)
 ;
"RTN","PSSHL1",68,0)
ZPS ; get USAGE from dispense drug(s), set ZPS segment
"RTN","PSSHL1",69,0)
 S LIMIT=2 X PSJCLEAR
"RTN","PSSHL1",70,0)
 S FIELD(0)="ZPS"
"RTN","PSSHL1",71,0)
 S USAGE=$$USAGE^PSSHLU(PSJSPIEN)
"RTN","PSSHL1",72,0)
 Q:USAGE=""&('$P($G(^PS(50.7,PSJSPIEN,0)),"^",9))&('$P($G(^PS(50.7,PSJSPIEN,0)),"^",12))
"RTN","PSSHL1",73,0)
 F I="I","O","A","B","V" S:+$P(USAGE,I,2)>0 FIELD(1)=FIELD(1)_I
"RTN","PSSHL1",74,0)
 S:$P($G(^PS(50.7,PSJSPIEN,0)),"^",9) FIELD(1)=FIELD(1)_"S"
"RTN","PSSHL1",75,0)
 S:$P($G(^PS(50.7,PSJSPIEN,0)),"^",10) FIELD(1)=FIELD(1)_"N"
"RTN","PSSHL1",76,0)
 S:$P($G(^PS(50.7,PSJSPIEN,0)),"^",12) FIELD(2)=1
"RTN","PSSHL1",77,0)
 D SEGMENT^PSSHLU(LIMIT)
"RTN","PSSHL1",78,0)
 Q
"RTN","PSSHL1",79,0)
 ;
"RTN","PSSHL1",80,0)
ZSY ; get SYNONYMs
"RTN","PSSHL1",81,0)
 S LIMIT=2 X PSJCLEAR
"RTN","PSSHL1",82,0)
 S FIELD(0)="ZSY"
"RTN","PSSHL1",83,0)
 S SYNONYM="",(J,SYNIEN)=0 F  S SYNIEN=$O(^PS(50.7,PSJSPIEN,2,SYNIEN)) Q:'SYNIEN  S SYNONYM=$P($G(^(SYNIEN,0)),"^") Q:SYNONYM=""  D
"RTN","PSSHL1",84,0)
 .S FIELD(1)="1",FIELD(2)=SYNONYM D SEGMENT^PSSHLU(LIMIT)
"RTN","PSSHL1",85,0)
 Q
"RTN","PSSHL1",86,0)
PRO ;Check for protocols
"RTN","PSSHL1",87,0)
 S MENU="PS MFSEND OR",ITEM="OR ITEM RECEIVE",MENUP=$O(^ORD(101,"B",MENU,0))
"RTN","PSSHL1",88,0)
 S X=$O(^ORD(101,"B",ITEM,0)) I 'X W !!?5,"Sorry, you need the OR ITEM RECEIVE protocol to proceed,",!?5,"which is exported with Order Entry/Results Reporting V3!",! S XPDABORT=1 Q
"RTN","PSSHL1",89,0)
 Q:$D(^ORD(101,MENUP,10,"B",X))
"RTN","PSSHL1",90,0)
 I $D(^ORD(101,MENUP,10,0))[0 S ^ORD(101,MENUP,10,0)="^"_"101.01PA"
"RTN","PSSHL1",91,0)
 K DD,DA,DO,DIC S DIC="^ORD(101,"_MENUP_",10,",DIC(0)="L",DLAYGO=101.01,DA(1)=MENUP D FILE^DICN K DD,DO
"RTN","PSSHL1",92,0)
 K DIC I Y<0 W !!?5,"Sorry, unable to add OR ITEM RECEIVE protocol as an Item to the PS MFSEND",!,"protocol, cannot proceed!",! S XPDABORT=1
"RTN","PSSHL1",93,0)
 Q
"RTN","PSSHL1",94,0)
ENIVID ; Edit IV Identifier field to be displayed with IV Orderable Items.
"RTN","PSSHL1",95,0)
 Q
"RTN","PSSHL1",96,0)
 N DA,DIC,DIE,DRG,PSSOI,PSSIVID,PSSFIL,PSSDRG,X,Y
"RTN","PSSHL1",97,0)
 S DIC=59.7,DIC(0)="AEMQ" D ^DIC Q:Y<0
"RTN","PSSHL1",98,0)
 W !!!,"Changing the IV Identifier will update the name of ALL Orderable Items",!,"marked as an IV!",!!
"RTN","PSSHL1",99,0)
 S PSSIVID=$P($G(^PS(59.7,+Y,31)),U,2),DIE=59.7,(DA,PSSSITE)=+Y,DR=32 D ^DIE
"RTN","PSSHL1",100,0)
 Q:PSSIVID=$P($G(^PS(59.7,PSSSITE,31)),U,2)
"RTN","PSSHL1",101,0)
 W !!,"Updating Orderable Item names in OE/RR"
"RTN","PSSHL1",102,0)
 F PSSOI=0:0 S PSSOI=$O(^PS(50.7,"AIV",1,PSSOI)) Q:'PSSOI  D:$D(^PS(50.7,PSSOI)) EN2^PSSHL1(PSSOI,"MUP") W "."
"RTN","PSSHL1",103,0)
 ;F PSSFIL=52.6,52.7 F PSSOI=0:0 S PSSOI=$O(^PS(PSSFIL,"AOI",PSSOI)) Q:'PSSOI  D:$D(^PS(50.7,PSSOI)) EN2^PSSHL1(PSSOI,"MUP") W "."
"RTN","PSSHL1",104,0)
 Q
"RTN","PSSHL1",105,0)
 ;
"RTN","PSSHL1",106,0)
GTIVID() ; Return IV Identifier. If being edited, wait until edit is done.
"RTN","PSSHL1",107,0)
 N X,PX S (X,PX)=$O(^PS(59.7,0)) Q:'X
"RTN","PSSHL1",108,0)
 F  L +^PS(59.7,X,31):$S($G(DILOCKTM)>0:DILOCKTM,1:3) Q:$T  H 2
"RTN","PSSHL1",109,0)
 S X=$P($G(^PS(59.7,X,31)),U,2)
"RTN","PSSHL1",110,0)
 L -^PS(59.7,PX,31)
"RTN","PSSHL1",111,0)
 Q X
"RTN","PSSLOCK")
0^8^B6837283^B6560145
"RTN","PSSLOCK",1,0)
PSSLOCK ;BIR/RSB-Pharmacy patient lock ;09/15/97 13:30
"RTN","PSSLOCK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**26,58,125**;9/30/97;Build 2
"RTN","PSSLOCK",3,0)
 ;
"RTN","PSSLOCK",4,0)
 ; Reference to ^ORX2 supported by DBIA #867
"RTN","PSSLOCK",5,0)
 ; Reference to ^PS(53.1 supported by DBIA #2140
"RTN","PSSLOCK",6,0)
 ; Reference to ^PS(52.41 supported by DBIA #2844
"RTN","PSSLOCK",7,0)
 ; Reference to ^PSRX supported by DBIA #2845
"RTN","PSSLOCK",8,0)
 ; Reference to ^PS(55 supported by DBIA #2191
"RTN","PSSLOCK",9,0)
 ;
"RTN","PSSLOCK",10,0)
L(DFN,DIS) ; 
"RTN","PSSLOCK",11,0)
 I $G(PSONOLCK) Q 1
"RTN","PSSLOCK",12,0)
 N FLAG S ^XTMP("PSSLOCK",0)=$$PDATE
"RTN","PSSLOCK",13,0)
 I '$D(^XTMP("PSSLOCK",DFN)) D  Q FLAG
"RTN","PSSLOCK",14,0)
 . D NOW^%DTC S ^XTMP("PSSLOCK",DFN)=DUZ_"^"_%
"RTN","PSSLOCK",15,0)
 . L +^XTMP("PSSLOCK",DFN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) S FLAG=$S($T=1:$T,1:0)
"RTN","PSSLOCK",16,0)
 I $D(^XTMP("PSSLOCK",DFN)) Q $$R
"RTN","PSSLOCK",17,0)
UL(DFN) ; unlock
"RTN","PSSLOCK",18,0)
 I $G(PSONOLCK) Q
"RTN","PSSLOCK",19,0)
 L -^XTMP("PSSLOCK",DFN) K ^XTMP("PSSLOCK",DFN)
"RTN","PSSLOCK",20,0)
 Q
"RTN","PSSLOCK",21,0)
 ;
"RTN","PSSLOCK",22,0)
R() ; check lock on node
"RTN","PSSLOCK",23,0)
 ;if user has same patient already locked, Q 1, will only lock once
"RTN","PSSLOCK",24,0)
 I $P($G(^XTMP("PSSLOCK",DFN)),"^")=DUZ Q 1
"RTN","PSSLOCK",25,0)
 L +^XTMP("PSSLOCK",DFN):$S($G(DILOCKTM)>0:DILOCKTM,1:3)
"RTN","PSSLOCK",26,0)
 I $T=1 D NOW^%DTC S ^XTMP("PSSLOCK",DFN)=DUZ_"^"_% Q 1
"RTN","PSSLOCK",27,0)
 I $T=0 W:DIS=1 !,$$WHO(DFN) S Y=$P($G(^XTMP("PSSLOCK",DFN)),"^",2) X ^DD("DD") Q $S(DIS=0:0_"^"_$P($G(^VA(200,+$P($G(^XTMP("PSSLOCK",DFN)),"^"),0)),"^")_"^"_Y,1:0)
"RTN","PSSLOCK",28,0)
 ;
"RTN","PSSLOCK",29,0)
PDATE() ;
"RTN","PSSLOCK",30,0)
 N X1,X2 S X1=DT,X2=+14 D C^%DTC
"RTN","PSSLOCK",31,0)
 Q X_"^"_DT_"^Pharmacy patient locks"
"RTN","PSSLOCK",32,0)
 ;
"RTN","PSSLOCK",33,0)
WHO(DFN) ;
"RTN","PSSLOCK",34,0)
 S Y=$P($G(^XTMP("PSSLOCK",DFN)),"^",2) X ^DD("DD")
"RTN","PSSLOCK",35,0)
 Q $P($G(^VA(200,+$P($G(^XTMP("PSSLOCK",DFN)),"^"),0)),"^")_" is editing orders for this patient ("_Y_")"
"RTN","PSSLOCK",36,0)
 ;
"RTN","PSSLOCK",37,0)
 ;
"RTN","PSSLOCK",38,0)
LS(DFN,X) ;
"RTN","PSSLOCK",39,0)
 ;LOCK CPRS ORDER
"RTN","PSSLOCK",40,0)
 ;DFN is patient #, X is PSJORD OR PSGORD
"RTN","PSSLOCK",41,0)
 N OR100 S OR100=$$ORD(DFN,X) I OR100=0 Q 1
"RTN","PSSLOCK",42,0)
 N L S L=$$LOCK1^ORX2(OR100)
"RTN","PSSLOCK",43,0)
 I L Q 1
"RTN","PSSLOCK",44,0)
 I 'L W !,$P(L,"^",2),$C(7) D PAUSE^VALM1 Q 0
"RTN","PSSLOCK",45,0)
 Q 0
"RTN","PSSLOCK",46,0)
 ;
"RTN","PSSLOCK",47,0)
UNL(DFN,X) ;
"RTN","PSSLOCK",48,0)
 ; unlocks order in file 100
"RTN","PSSLOCK",49,0)
 ; DFN is patient #, X is PSJORD OR PSGORD
"RTN","PSSLOCK",50,0)
 D UNLK1^ORX2($$ORD(DFN,X))
"RTN","PSSLOCK",51,0)
 Q
"RTN","PSSLOCK",52,0)
 ;
"RTN","PSSLOCK",53,0)
ORD(DFN,X) ;
"RTN","PSSLOCK",54,0)
 ; return order number in file 100 from entry in 53.1 or 55.
"RTN","PSSLOCK",55,0)
 ; DFN is patient #, X is PSJORD OR PSGORD
"RTN","PSSLOCK",56,0)
 N ORD100
"RTN","PSSLOCK",57,0)
 S ORD100=$S(X["N"!(X["P"):"^PS(53.1,"_+X_",0)",X["V":"^PS(55,"_DFN_",""IV"","_+X_",0)",1:"^PS(55,"_DFN_",5,"_+X_",0)",1:"NA")
"RTN","PSSLOCK",58,0)
 Q +$P(@ORD100,"^",21)
"RTN","PSSLOCK",59,0)
 ;
"RTN","PSSLOCK",60,0)
PSOL(X) ;
"RTN","PSSLOCK",61,0)
 S PSOMSG=1
"RTN","PSSLOCK",62,0)
 I X["S" D  Q
"RTN","PSSLOCK",63,0)
 .S X=+$P($G(^PS(52.41,+$G(X),0)),"^") I X S PSOMSG=$$LOCK1^ORX2(X)
"RTN","PSSLOCK",64,0)
 S X=+$P($G(^PSRX(+$G(X),"OR1")),"^",2) I X S PSOMSG=$$LOCK1^ORX2(X)
"RTN","PSSLOCK",65,0)
 Q
"RTN","PSSLOCK",66,0)
PSOUL(X) ;
"RTN","PSSLOCK",67,0)
 I X["S" D  Q
"RTN","PSSLOCK",68,0)
 .S X=+$P($G(^PS(52.41,+$G(X),0)),"^") I X D UNLK1^ORX2(X)
"RTN","PSSLOCK",69,0)
 S X=+$P($G(^PSRX(+$G(X),"OR1")),"^",2) I X D UNLK1^ORX2(X)
"RTN","PSSLOCK",70,0)
 Q
"RTN","PSSPOIMN")
0^9^B62103637^B61699020
"RTN","PSSPOIMN",1,0)
PSSPOIMN ;BIR/RTR/WRT-Orderable Item manual create ;09/01/98
"RTN","PSSPOIMN",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**15,32,34,38,51,57,82,125**;9/30/97;Build 2
"RTN","PSSPOIMN",3,0)
 ;
"RTN","PSSPOIMN",4,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSPOIMN",5,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSPOIMN",6,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSPOIMN",7,0)
 ;
"RTN","PSSPOIMN",8,0)
 S PSSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSSITE,80)),"^",2)<2 W !!?3,"Orderable Item Auto-Create has not been completed yet!",! K PSSITE,DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR Q
"RTN","PSSPOIMN",9,0)
 K PSSITE D MESS^PSSPOIM1
"RTN","PSSPOIMN",10,0)
BEG I $D(PSIEN) L -^PSDRUG(PSIEN)
"RTN","PSSPOIMN",11,0)
 K PSSCROSS,DOSEFV,DOSEFORM,POINT,SPHOLD,NEWSP,PSVAR1,PSITEM,PSTOP,PSMASTER,DIC("S")
"RTN","PSSPOIMN",12,0)
 S PSOUT=0 W !! K DIC S DIC(0)="QEAM",DIC="^PSDRUG(",DIC("A")="Select DISPENSE DRUG: "
"RTN","PSSPOIMN",13,0)
 ;DIC("S")="I $P($G(^PSDRUG(+Y,2)),""^"",3)[""I""!($P($G(^(2)),""^"",3)[""O"")!($P($G(^(2)),""^"",3)[""U"")"
"RTN","PSSPOIMN",14,0)
 D ^DIC G:$D(DTOUT)!($D(DUOUT))!(Y<1) END K DIC("S") S PSIEN=+Y,PSNAME=$P(^PSDRUG(PSIEN,0),"^") L +^PSDRUG(PSIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSPOIMN",15,0)
MAS I $G(PSMASTER) S PSOUT=0 N DOSEFV,DOSEFORM,POINT,SPHOLD,NEWSP,PSVAR1,PSITEM,PSTOP
"RTN","PSSPOIMN",16,0)
 S NODE=$G(^PSDRUG(PSIEN,"ND")),DOSEPTR=0,DA=$P(NODE,"^"),X=$$VAGN^PSNAPIS(DA),VAGEN=X I +$P(NODE,"^"),+$P(NODE,"^",3),VAGEN'=0 S K=$P(NODE,"^",3),X=$$PSJDF^PSNAPIS(DA,K),DOSEFV=X I DOSEFV'=0 D
"RTN","PSSPOIMN",17,0)
 .S DOSEPTR=$P(X,"^"),DOSEFORM=$P(X,"^",2)
"RTN","PSSPOIMN",18,0)
 D TMP
"RTN","PSSPOIMN",19,0)
 I +$P($G(^PSDRUG(PSIEN,2)),"^") S (POINT,PSITEM)=$P(^(2),"^") W !!,PSNAME," is already matched to",!!,?5,$P($G(^PS(50.7,POINT,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"),!
"RTN","PSSPOIMN",20,0)
 ;Warn user the Orderable Item is inactive. Display date and option to use.
"RTN","PSSPOIMN",21,0)
 I $G(POINT) N PSSIAD D
"RTN","PSSPOIMN",22,0)
 .S PSSIAD=$P($G(^PS(50.7,POINT,0)),"^",4) I $G(PSSIAD) S Y=PSSIAD D DD^%DT W !,"This Orderable Item has an Inactive Date.  *** "_Y,!,"To modify the Orderable Item, use the 'Edit Orderable Item' option."
"RTN","PSSPOIMN",23,0)
 I $G(POINT) D  W ! K DIR S DIR("B")="NO",DIR(0)="Y",DIR("A")="Do you want to match to a different Orderable Item" D ^DIR K DIR D:Y=1 MORE,SET,REM D SETX G:$G(PSMASTER) END G BEG
"RTN","PSSPOIMN",24,0)
 .K PSSDXLF
"RTN","PSSPOIMN",25,0)
 D MCH
"RTN","PSSPOIMN",26,0)
 G:'$G(PSMASTER) BEG
"RTN","PSSPOIMN",27,0)
END I $D(PSIEN) I '$G(PSSHUIDG) D DRG^PSSHUIDG(PSIEN) D  L -^PSDRUG(PSIEN)
"RTN","PSSPOIMN",28,0)
 .N XX,DVER,DNSNAM,DNSPORT,DMFU S XX=""
"RTN","PSSPOIMN",29,0)
 .F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSPOIMN",30,0)
 ..S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSPOIMN",31,0)
 ..I DVER="2.4" S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007) I DNSNAM'=""&(DMFU="YES") D DRG^PSSDGUPD(PSIEN,"",DNSNAM,DNSPORT)
"RTN","PSSPOIMN",32,0)
 G END^PSSPOIM1
"RTN","PSSPOIMN",33,0)
REM D TMP
"RTN","PSSPOIMN",34,0)
 I $O(^TMP($J,"PSSOO",0)) H 1 D OTHER^PSSPOIM1,DISP
"RTN","PSSPOIMN",35,0)
 Q:$G(PSOUT)  I $O(^TMP($J,"PSSOO",0)),$G(MATCH) S PSSP=MATCH D ^PSSPOIM1 Q:(PSOUT)!(PSNO)  S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_MATCH  D ^DIE K DIE S PSITEM=MATCH D COM Q
"RTN","PSSPOIMN",36,0)
 G MCHA
"RTN","PSSPOIMN",37,0)
TMP K ^TMP($J,"PSSOO") S PSCNT=0 I +$P(NODE,"^"),+$P(NODE,"^",3) F ZZ=0:0 S ZZ=$O(^PSDRUG("AND",+NODE,ZZ)) Q:'ZZ  I +$P($G(^PSDRUG(ZZ,2)),"^"),$P(^PSDRUG(ZZ,2),"^")'=$G(POINT),$D(^PS(50.7,$P(^PSDRUG(ZZ,2),"^"),0)) S OTH=$G(^PSDRUG(ZZ,"ND")) D
"RTN","PSSPOIMN",38,0)
 .I +$P(OTH,"^"),+$P(OTH,"^",3),DOSEFV'=0 S DA=$P(OTH,"^"),K=$P(OTH,"^",3),X=$$PSJDF^PSNAPIS(DA,K),DOSA=X I DOSA'=0,DOSEFV=DOSA D
"RTN","PSSPOIMN",39,0)
 ..S NOFLAG=0,TMPTR=$P(^PSDRUG(ZZ,2),"^") F FFF=0:0 S FFF=$O(^TMP($J,"PSSOO",FFF)) Q:'FFF  I $P(^TMP($J,"PSSOO",FFF),"^")=TMPTR S NOFLAG=1
"RTN","PSSPOIMN",40,0)
 ..I 'NOFLAG S PSCNT=PSCNT+1 S ^TMP($J,"PSSOO",PSCNT)=$P(^PSDRUG(ZZ,2),"^")_"^"_ZZ
"RTN","PSSPOIMN",41,0)
 Q
"RTN","PSSPOIMN",42,0)
DISP S MATCH=0 F TT=0:0 S TT=$O(^TMP($J,"PSSOO",TT)) Q:'TT  S SPT=$P(^TMP($J,"PSSOO",TT),"^") W !,TT,"  ",$P($G(^PS(50.7,SPT,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^") I $Y+5>IOSL D  Q:Y=0  I Y="" S PSOUT=1 Q
"RTN","PSSPOIMN",43,0)
 .W ! K DIR S DIR(0)="E" D ^DIR I Y W @IOF W !,?3,"Dispense Drug -> ",PSNAME,!
"RTN","PSSPOIMN",44,0)
DISPO Q:$G(PSOUT)  W ! K DIR S DIR(0)="N",DIR("A")="Choose number of Orderable Item to match, or '^' to enter a new one" D ^DIR K DIR I Y=""!($D(DTOUT)) S PSOUT=1 Q
"RTN","PSSPOIMN",45,0)
 Q:Y["^"  I '$D(^TMP($J,"PSSOO",+Y)) W !!,?5,"INVALID NUMBER" G DISPO
"RTN","PSSPOIMN",46,0)
 S MATCH=$P(^TMP($J,"PSSOO",+Y),"^") Q
"RTN","PSSPOIMN",47,0)
 S PSOUT=1 Q
"RTN","PSSPOIMN",48,0)
MCH I $O(^TMP($J,"PSSOO",0)) H 1 D OTHER^PSSPOIM1,DISP
"RTN","PSSPOIMN",49,0)
 Q:$G(PSOUT)  I $O(^TMP($J,"PSSOO",0)),$G(MATCH) S PSSP=MATCH D ^PSSPOIM1 Q:(PSOUT)!(PSNO)  K DIE S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_MATCH D ^DIE S PSITEM=MATCH D COM Q
"RTN","PSSPOIMN",50,0)
MCHA W ! I $G(DOSEFORM)'="" W !?3,"Dosage Form -> ",DOSEFORM,!! K DIR S DIR(0)="Y",DIR("B")="NO",DIR("A")="Match to another Orderable Item with same Dosage Form" D ^DIR G:Y=1 LOOK I Y["^"!(Y="")!($D(DTOUT)) Q
"RTN","PSSPOIMN",51,0)
 I $G(DOSEFORM)="" K DIC S DIC="^PS(50.606,",DIC(0)="QEAMZ",DIC("A")="Choose Dosage Form: " D ^DIC Q:$D(DTOUT)!($D(DUOUT))!(Y<1)  S DOSEPTR=+Y W !!?3,"Dose Form -> ",$G(Y(0,0))
"RTN","PSSPOIMN",52,0)
 I $G(DOSEFORM)="" K DIR W ! S DIR(0)="Y",DIR("B")="NO",DIR("A")="Match to another Orderable Item with same Dosage Form" D ^DIR
"RTN","PSSPOIMN",53,0)
 I $G(DOSEFORM)="" Q:$D(DTOUT)!($D(DUOUT))!(Y<0)  S DOSEFORM=$P(^PS(50.606,DOSEPTR,0),"^") G:Y>0 LOOK
"RTN","PSSPOIMN",54,0)
MCHAN W !! I $L(VAGEN)>40 W !,"VA Generic Name -> ",VAGEN,!
"RTN","PSSPOIMN",55,0)
 W !,?3,"Dosage Form   -> ",DOSEFORM,!,?3,"Dispense Drug -> ",PSNAME,!!
"RTN","PSSPOIMN",56,0)
 K DIR S DIR(0)="F^3:40",DIR("A")="Orderable Item Name" S:$L(VAGEN)>2&($L(VAGEN)<41) DIR("B")=VAGEN
"RTN","PSSPOIMN",57,0)
 D ^DIR Q:$D(DUOUT)!($D(DTOUT))!(Y["^")!(Y="")
"RTN","PSSPOIMN",58,0)
 I X[""""!($A(X)=45)!('(X'?1P.E))!(X?2"z".E) W $C(7),!!?5,"??" G MCHAN
"RTN","PSSPOIMN",59,0)
 S (X,SPHOLD)=Y,(STOP,PSNO)=0 F COMM=0:0 S COMM=$O(^PS(50.7,"ADF",SPHOLD,DOSEPTR,COMM)) Q:'COMM!(STOP)!($G(PSOUT))  I COMM,$P($G(^PS(50.7,COMM,0)),"^",3)="" D
"RTN","PSSPOIMN",60,0)
 .S PSSP=COMM D ^PSSPOIM1 S:PSNO STOP=1 Q:PSOUT!(STOP)  K DIE S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_COMM D ^DIE S PSITEM=COMM D COM S STOP=1 Q
"RTN","PSSPOIMN",61,0)
 Q:PSOUT
"RTN","PSSPOIMN",62,0)
 I STOP,$G(PSNO) G MCHAN
"RTN","PSSPOIMN",63,0)
 Q:STOP
"RTN","PSSPOIMN",64,0)
 S PSMAN=1
"RTN","PSSPOIMN",65,0)
 D ^PSSPOIM1
"RTN","PSSPOIMN",66,0)
 G:PSNO MCHAN Q:PSOUT  K DIC S DIC="^PS(50.7,",DIC(0)="L",X=SPHOLD,DIC("DR")=".02////"_DOSEPTR K DD,DO D FILE^DICN K DD,DO D:Y<1  G:(Y<1) MCHAN S NEWSP=+Y,DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_NEWSP D ^DIE S PSVAR1=1,PSITEM=NEWSP D COM Q
"RTN","PSSPOIMN",67,0)
 .W $C(7),!?5,"Invalid entry!",!! Q
"RTN","PSSPOIMN",68,0)
 Q
"RTN","PSSPOIMN",69,0)
LOOK W !!!?3,"Enter ?? for Pharmacy Orderable Item List!",!
"RTN","PSSPOIMN",70,0)
 K DIC S DIC="^PS(50.7,",DIC(0)="QEAM",DIC("S")="I $P($G(^(0)),""^"",2)=DOSEPTR,$P($G(^(0)),""^"",3)=""""" D ^DIC I Y>0 S (NEWSP,PSSP)=+Y D ^PSSPOIM1 G:PSNO LOOK Q:PSOUT  S DIE="^PSDRUG(",DA=PSIEN,DR="2.1////"_NEWSP D ^DIE S PSITEM=NEWSP D COM Q
"RTN","PSSPOIMN",71,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="Create a new Orderable Item to match" D ^DIR I Y=1 G MCHAN
"RTN","PSSPOIMN",72,0)
 Q
"RTN","PSSPOIMN",73,0)
COM W !,"Match Complete!",! D EN^PSSPOIM1(PSITEM) Q
"RTN","PSSPOIMN",74,0)
 ;
"RTN","PSSPOIMN",75,0)
SET ;
"RTN","PSSPOIMN",76,0)
 S PSSDXLF=1,PSSDXL=+$P($G(^PS(50.7,+$G(POINT),0)),"^",2)
"RTN","PSSPOIMN",77,0)
 Q
"RTN","PSSPOIMN",78,0)
SETX ;
"RTN","PSSPOIMN",79,0)
 I $G(PSSDXLF),$G(PSSDXL),$G(PSITEM),$G(PSSDXL)'=+$P($G(^PS(50.7,+$G(PSITEM),0)),"^",2) K ^PSDRUG(PSIEN,"DOS2") I $G(PSIEN) D EN2^PSSUTIL(PSIEN,1)
"RTN","PSSPOIMN",80,0)
 K PSSDXL,PSSDXLF
"RTN","PSSPOIMN",81,0)
 Q
"RTN","PSSPOIMN",82,0)
MORE ;Show Additives and Solutions
"RTN","PSSPOIMN",83,0)
 Q:'$G(PSIEN)
"RTN","PSSPOIMN",84,0)
 N PSSMORA,PSSMORS,PSSMZ,PSSMZOUT,PSSMODT
"RTN","PSSPOIMN",85,0)
 S (PSSMORA,PSSMORS,PSSMZOUT)=0
"RTN","PSSPOIMN",86,0)
 I $O(^PS(52.6,"AC",PSIEN,0)) S PSSMORA=1
"RTN","PSSPOIMN",87,0)
 I $O(^PS(52.7,"AC",PSIEN,0)) S PSSMORS=1
"RTN","PSSPOIMN",88,0)
 I 'PSSMORA,'PSSMORS Q
"RTN","PSSPOIMN",89,0)
 W !!!,"There are "_$S('$G(PSSMORS):"IV Additives",'$G(PSSMORA):"IV Solutions",1:"IV Additives and IV Solutions")_" tied to this Dispense Drug."
"RTN","PSSPOIMN",90,0)
 W !,"By rematching the Dispense Drug to a new Pharmacy Orderable Item, all of these",!,$S('$G(PSSMORS):"IV Additives",'$G(PSSMORA):"IV Solutions",1:"IV Additives and IV Solutions")_" will also be rematched to the new Orderable Item.",!
"RTN","PSSPOIMN",91,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to see "_$S('$G(PSSMORS):"IV Additive",'$G(PSSMORA):"IV Solution",1:"IV Additive/Solution")_" list" D ^DIR I Y'=1 W ! Q
"RTN","PSSPOIMN",92,0)
 W @IOF
"RTN","PSSPOIMN",93,0)
 W !,$S('$G(PSSMORA):"IV Solutions",'$G(PSSMORS):"IV Additives",1:"IV Additives/Solutions"),!,"------------" I $G(PSSMORS),$G(PSSMORA) W "----------"
"RTN","PSSPOIMN",94,0)
 I $G(PSSMORA) D  G:$G(PSSMZOUT) MOREZ
"RTN","PSSPOIMN",95,0)
 .F PSSMZ=0:0 S PSSMZ=$O(^PS(52.6,"AC",PSIEN,PSSMZ)) Q:'PSSMZ!($G(PSSMZOUT))  D
"RTN","PSSPOIMN",96,0)
 ..D:($Y+5)>IOSL MOREH Q:$G(PSSMZOUT)
"RTN","PSSPOIMN",97,0)
 ..W !,$P($G(^PS(52.6,PSSMZ,0)),"^"),?42,"(A)"
"RTN","PSSPOIMN",98,0)
 ..S PSSMODT=$P($G(^PS(52.6,PSSMZ,"I")),"^") I PSSMODT D MODT
"RTN","PSSPOIMN",99,0)
 ;I $G(PSSMORA),$G(PSSMORS) W !
"RTN","PSSPOIMN",100,0)
 I $G(PSSMORS) D
"RTN","PSSPOIMN",101,0)
 .F PSSMZ=0:0 S PSSMZ=$O(^PS(52.7,"AC",PSIEN,PSSMZ)) Q:'PSSMZ!($G(PSSMZOUT))  D
"RTN","PSSPOIMN",102,0)
 ..D:($Y+5)>IOSL MOREH Q:$G(PSSMZOUT)
"RTN","PSSPOIMN",103,0)
 ..W !,$P($G(^PS(52.7,PSSMZ,0)),"^"),?31,$P($G(^(0)),"^",3),?42,"(S)"
"RTN","PSSPOIMN",104,0)
 ..S PSSMODT=$P($G(^PS(52.7,PSSMZ,"I")),"^") I PSSMODT D MODT
"RTN","PSSPOIMN",105,0)
MOREZ ;
"RTN","PSSPOIMN",106,0)
 I '$G(PSSMZOUT) W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR
"RTN","PSSPOIMN",107,0)
 Q
"RTN","PSSPOIMN",108,0)
 ;
"RTN","PSSPOIMN",109,0)
MOREH ;
"RTN","PSSPOIMN",110,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S PSSMZOUT=1 Q
"RTN","PSSPOIMN",111,0)
 W @IOF
"RTN","PSSPOIMN",112,0)
 Q
"RTN","PSSPOIMN",113,0)
MODT ;
"RTN","PSSPOIMN",114,0)
 S Y=$G(PSSMODT) I $G(Y) D DD^%DT W ?50,$G(Y) K Y
"RTN","PSSPOIMN",115,0)
 Q
"RTN","PSSPOIMO")
0^10^B73680836^B73322011
"RTN","PSSPOIMO",1,0)
PSSPOIMO ;BIR/RTR/WRT-Edit Orderable Item Name and Inactive date ;7/20/04 1:45pm
"RTN","PSSPOIMO",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**29,32,38,47,68,102,125**;9/30/97;Build 2
"RTN","PSSPOIMO",3,0)
 S PSSITE=+$O(^PS(59.7,0)) I +$P($G(^PS(59.7,PSSITE,80)),"^",2)<2 W !!?3,"Orderable Item Auto-Create has not been completed yet!",! K PSSITE K DIR S DIR("A")="Press RETURN to continue",DIR(0)="E" D ^DIR K DIR Q
"RTN","PSSPOIMO",4,0)
 K PSSITE W !!,"This option enables you to edit Orderable Item names, Formulary status,",!,"drug text, Inactive Dates, and Synonyms."
"RTN","PSSPOIMO",5,0)
EN I $D(PSOIEN) L -^PS(50.7,PSOIEN)
"RTN","PSSPOIMO",6,0)
 K PSSCROSS
"RTN","PSSPOIMO",7,0)
 K DIC ; S PY=$P($G(^PS(59.7,1,31)),"^",2)
"RTN","PSSPOIMO",8,0)
 S PSS1="W ""  ""_$P(^PS(50.606,$P(^PS(50.7,+Y,0),""^"",2),0),""^"")_""  ""_$S($P($G(^PS(50.7,+Y,0)),""^"",4):$E($P(^(0),""^"",4),4,5)_""-""_$E($P(^(0),""^"",4),6,7)_""-""_$E($P(^(0),""^"",4),2,3),1:"""")"
"RTN","PSSPOIMO",9,0)
 S PSS2=" S NF=$P($G(^PS(50.7,+Y,0)),""^"",12) I NF S NF=""   N/F"" W NF"
"RTN","PSSPOIMO",10,0)
 S DIC("W")=PSS1_PSS2,DIC("S")="I '$P($G(^PS(50.7,+Y,0)),""^"",3)"
"RTN","PSSPOIMO",11,0)
 ;PSO*7*102;ONLY SEARCH B AND C X-REFS
"RTN","PSSPOIMO",12,0)
 S $P(PLINE,"-",79)="" W !! K PSOUT S DIC="^PS(50.7,",DIC(0)="QEAMZ",D="B^C" D MIX^DIC1 K DIC,PY,D G:Y<0!($D(DTOUT))!($D(DUOUT)) END
"RTN","PSSPOIMO",13,0)
 S PSOIEN=+Y,PSOINAME=$P(Y,"^",2),PSDOSE=+$P(^PS(50.7,PSOIEN,0),"^",2) L +^PS(50.7,PSOIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSPOIMO",14,0)
 W !!!,?5,"Orderable Item -> ",PSOINAME,!?5,"Dosage Form    -> ",$P($G(^PS(50.606,PSDOSE,0)),"^"),!
"RTN","PSSPOIMO",15,0)
 ;I $P($G(^PS(50.7,PSOIEN,0)),"^",3) W !?3,"*** This Orderable Item is flagged for IV use! ***",!
"RTN","PSSPOIMO",16,0)
 ;G:$P($G(^PS(50.7,PSOIEN,0)),"^",3) ADDIT
"RTN","PSSPOIMO",17,0)
 K DIR S DIR("?")=" ",DIR("?",1)="Enter 'Yes' to see all of the Dispense Drugs, IV Additives, and IV Solutions",DIR("?",2)="that are matched to this Orderable Item. IV Additives will be identified with"
"RTN","PSSPOIMO",18,0)
  S DIR("?",3)="an (A), and IV Solutions with an (S)."
"RTN","PSSPOIMO",19,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="List all Drugs/Additives/Solutions tied to this Orderable Item" D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSPOIMO",20,0)
 I Y D DISP
"RTN","PSSPOIMO",21,0)
EDIT K DIR W ! S DIR(0)="Y",DIR("A")="Are you sure you want to edit this Orderable Item",DIR("B")="NO",DIR("?")="Answer YES to edit the fields associated with this Orderable Item." D ^DIR K DIR I 'Y!($D(DTOUT))!($D(DUOUT)) G EN
"RTN","PSSPOIMO",22,0)
 W !!?3,"Now editing Orderable Item:",!?3,PSOINAME,"   ",$P($G(^PS(50.606,PSDOSE,0)),"^")
"RTN","PSSPOIMO",23,0)
DIR K DIR S DIR(0)="F^3:40",DIR("B")=PSOINAME,DIR("A")="Orderable Item Name" D ^DIR
"RTN","PSSPOIMO",24,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) G EN
"RTN","PSSPOIMO",25,0)
 I X[""""!($A(X)=45)!('(X'?1P.E))!(X?2"z".E) W $C(7),!!?5,"??" G DIR
"RTN","PSSPOIMO",26,0)
 I X'=PSOINAME S ZZFLAG=0 D @$S('$P($G(^PS(50.7,PSOIEN,0)),"^",3):"CHECK",1:"ZCHECK") I ZZFLAG G DIR
"RTN","PSSPOIMO",27,0)
 S PSONEW=X,DIE="^PS(50.7,",DA=PSOIEN,DR=".01////"_X D ^DIE I PSONEW'=PSOINAME W !!,"Name changed from  ",PSOINAME,!?15,"to  ",PSONEW
"RTN","PSSPOIMO",28,0)
 ;I $P($G(^PS(59.7,1,20.4)),"^",16)=1,$P(^PS(50.7,PSOIEN,0),"^",3)=1,$P(^PS(50.7,PSOIEN,0),"^",11)="" D UDMSG K DIE S DIE="^PS(50.7,",DR="3",DA=PSOIEN D ^DIE
"RTN","PSSPOIMO",29,0)
 ;I $P($G(^PS(59.7,1,20.4)),"^",16)=1,$P(^PS(50.7,PSOIEN,0),"^",3)'=1,$P(^PS(50.7,PSOIEN,0),"^",10)="" D IVMSG K DIE S DIE="^PS(50.7,",DR="4",DA=PSOIEN D ^DIE
"RTN","PSSPOIMO",30,0)
 S PSSDTENT=0 W ! K DIE N MFLG S PSBEFORE=$P(^PS(50.7,PSOIEN,0),"^",4),PSAFTER=0,PSINORDE="" D
"RTN","PSSPOIMO",31,0)
 .;If reactivate OI, prompt to reactivate DD's only if there are any, then always give message saying OI now Active. If Inactivate, prompt to inactivate any active DD's if there are any, and give message
"RTN","PSSPOIMO",32,0)
 .;but if OI is reactivated, and there are no actitives matched to it, and user does not want to activate the drugs, then inactivate the OI again, and give a clear message explaining this.
"RTN","PSSPOIMO",33,0)
 .W !,"This Orderable Item is "_$S($P($G(^PS(50.7,PSOIEN,0)),"^",12):"Non-Formulary.",1:"Formulary."),!
"RTN","PSSPOIMO",34,0)
 .I $P($G(^PS(50.7,PSOIEN,0)),"^",10) W !,"This Orderable Item is marked as a Non-VA Med.",!
"RTN","PSSPOIMO",35,0)
 .S DIE="^PS(50.7,",DA=PSOIEN,DR=6 S PSCREATE=1 D ^DIE K DIE,PSCREATE I $D(DTOUT)!($D(Y)) Q
"RTN","PSSPOIMO",36,0)
 .;PSS*1*102;ADD DRUG TEXT AS SYNONYM IS REQUESTED BY USER
"RTN","PSSPOIMO",37,0)
 .D ADDSYN^PSSPOIMP
"RTN","PSSPOIMO",38,0)
 .K DIR S DIR(0)="DO",DIR("A")="INACTIVE DATE" D  D ^DIR K DIR I $G(Y)["^"!($D(DTOUT))!($G(DUOUT)) Q
"RTN","PSSPOIMO",39,0)
 ..I $G(PSBEFORE) S Y=PSBEFORE D DD^%DT S DIR("B")=$G(Y)
"RTN","PSSPOIMO",40,0)
 .I $G(PSBEFORE),'$G(Y) W ?40,"Inactive Date deleted!"
"RTN","PSSPOIMO",41,0)
 .S PSSDTENT=$G(Y) I $G(Y) D DD^%DT W ?40,$G(Y)
"RTN","PSSPOIMO",42,0)
 .S PSSOTH=$S($P($G(^PS(59.7,1,40.2)),"^"):1,1:0)
"RTN","PSSPOIMO",43,0)
 .S DIE="^PS(50.7,",DA=PSOIEN,DR=".05;.06;.07;.08;7;S:'$G(PSSOTH) Y=""@1"";7.1;@1"
"RTN","PSSPOIMO",44,0)
 .S PSCREATE=1 D ^DIE K DIE,PSCREATE,PSSOTH
"RTN","PSSPOIMO",45,0)
 .S $P(^PS(50.7,PSOIEN,0),"^",4)=PSSDTENT,PSAFTER=PSSDTENT
"RTN","PSSPOIMO",46,0)
 S:PSBEFORE&('$P(^PS(50.7,PSOIEN,0),"^",4)) PSINORDE="D" S:$P(^PS(50.7,PSOIEN,0),"^",4) PSINORDE="I"
"RTN","PSSPOIMO",47,0)
 I PSINORDE'="" D CHECK^PSSPOID2(PSOIEN) D
"RTN","PSSPOIMO",48,0)
 .I PSINORDE="D" D  Q
"RTN","PSSPOIMO",49,0)
 ..I $O(PSSDACTI(0))!($O(PSSSACTI(0)))!($O(PSSAACTI(0))) D
"RTN","PSSPOIMO",50,0)
 ...W !!,"There are inactive "_$S($O(PSSDACTI(0)):"drugs, ",1:"")_$S($O(PSSAACTI(0)):"additives, ",1:"")_$S($O(PSSSACTI(0)):"solutions,",1:""),!,"matched to this Pharmacy Orderable Item."
"RTN","PSSPOIMO",51,0)
 .I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D
"RTN","PSSPOIMO",52,0)
 ..W !!,"There are active "_$S($O(PSSDACT(0)):"drugs, ",1:"")_$S($O(PSSAACT(0)):"additives, ",1:"")_$S($O(PSSSACT(0)):"solutions,",1:""),!,"matched to this Pharmacy Orderable Item."
"RTN","PSSPOIMO",53,0)
 I $G(PSINORDE)="D" I $O(PSSDACTI(0))!($O(PSSSACTI(0)))!($O(PSSAACTI(0))) D REST^PSSPOIDT(PSOIEN)
"RTN","PSSPOIMO",54,0)
 I $G(PSINORDE)="I" I $O(PSSDACT(0))!($O(PSSSACT(0)))!($O(PSSAACT(0))) D REST^PSSPOIDT(PSOIEN)
"RTN","PSSPOIMO",55,0)
 S DIK="^PS(50.7,",DA=PSOIEN,DIK(1)=.04 D EN^DIK K DIK
"RTN","PSSPOIMO",56,0)
 K PSBEFORE,PSAFTER,PSINORDE,PSSDTENT,PSSDACT,PSSDACTI,PSSSACT,PSSSACTI,PSSAACT,PSSAACTI
"RTN","PSSPOIMO",57,0)
SYN W ! K DIC S:'$D(^PS(50.7,PSOIEN,2,0)) ^PS(50.7,PSOIEN,2,0)="^50.72^0^0" S DIC="^PS(50.7,"_PSOIEN_",2,",DA(1)=PSOIEN,DIC(0)="QEAMZL",DIC("A")="Select SYNONYM: ",DLAYGO=50.72 D ^DIC K DIC
"RTN","PSSPOIMO",58,0)
 I Y<0!($D(DUOUT))!($D(DTOUT)) K:'$O(^PS(50.7,PSOIEN,2,0)) ^PS(50.7,PSOIEN,2,0) D EN^PSSPOIDT(PSOIEN),EN2^PSSHL1(PSOIEN,"MUP") G EN
"RTN","PSSPOIMO",59,0)
 W ! S DA=+Y,DIE="^PS(50.7,"_PSOIEN_",2,",DA(1)=PSOIEN,DR=.01 D ^DIE K DIE G SYN
"RTN","PSSPOIMO",60,0)
 D EN^PSSPOIDT(PSOIEN),EN2^PSSHL1(PSOIEN,"MUP")
"RTN","PSSPOIMO",61,0)
 G EN
"RTN","PSSPOIMO",62,0)
END K ZZFLAG,DIC,DIR,DIE,DTOUT,DUOUT,FLAG,PSOINAME,PSOUT,PSDOSE,PSONEW,UPFLAG,VV,ZZ,AA,BB,Y,AAA,SSS,PSOARR,PSOARRAD,PLINE I $D(PSOIEN) L -^PS(50.7,PSOIEN) K PSOIEN
"RTN","PSSPOIMO",63,0)
 Q
"RTN","PSSPOIMO",64,0)
DISP N PSSLFLAG,PSSLDATE S FLAG=1 D HEAD F ZZ=0:0 S ZZ=$O(^PSDRUG("ASP",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  S FLAG=0 D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ W !,$P($G(^PSDRUG(ZZ,0)),"^") W:$P($G(^PSDRUG(ZZ,0)),"^",9) "   N/F" D DTE
"RTN","PSSPOIMO",65,0)
 Q:$G(PSOUT)
"RTN","PSSPOIMO",66,0)
 S (FLAG,PSSLFLAG)=0
"RTN","PSSPOIMO",67,0)
 F ZZ=0:0 S ZZ=$O(^PS(52.6,"AOI",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ D
"RTN","PSSPOIMO",68,0)
 .S PSSLFLAG=1
"RTN","PSSPOIMO",69,0)
 .W !,$P($G(^PS(52.6,ZZ,0)),"^"),?42,"(A)"
"RTN","PSSPOIMO",70,0)
 .S PSSLDATE=$P($G(^PS(52.6,ZZ,"I")),"^") I PSSLDATE D DTEX
"RTN","PSSPOIMO",71,0)
 Q:$G(PSOUT)
"RTN","PSSPOIMO",72,0)
 ;I $G(PSSLFLAG) W !
"RTN","PSSPOIMO",73,0)
 F ZZ=0:0 S ZZ=$O(^PS(52.7,"AOI",PSOIEN,ZZ)) Q:'ZZ!($G(PSOUT))  D:($Y+5)>IOSL HEAD Q:$G(PSOUT)  I ZZ D
"RTN","PSSPOIMO",74,0)
 .W !,$P($G(^PS(52.7,ZZ,0)),"^"),?31,$P($G(^(0)),"^",3),?42,"(S)"
"RTN","PSSPOIMO",75,0)
 .S PSSLDATE=$P($G(^PS(52.7,ZZ,"I")),"^") I PSSLDATE D DTEX
"RTN","PSSPOIMO",76,0)
 Q
"RTN","PSSPOIMO",77,0)
HEAD I 'FLAG W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSSPOIMO",78,0)
 W @IOF W !,?6,"Orderable Item ->  ",PSOINAME,!?6,"Dosage Form    ->  ",$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOIEN,0)),"^",2),0)),"^"),!!,"Dispense Drugs:"_$S('FLAG:" (continued)",1:""),!,"---------------"
"RTN","PSSPOIMO",79,0)
 Q
"RTN","PSSPOIMO",80,0)
ADDIT ;If orderable item is flagged for IV
"RTN","PSSPOIMO",81,0)
 S AA=$O(^PS(52.6,"AOI",PSOIEN,0))
"RTN","PSSPOIMO",82,0)
 S BB=$O(^PS(52.7,"AOI",PSOIEN,0))
"RTN","PSSPOIMO",83,0)
 I 'AA,'BB W $C(7),!,"This Orderable Item is flagged for IV use, but currently there are no IV",!,"Additives or IV Solutions matched to this Orderable Item!" G EDIT
"RTN","PSSPOIMO",84,0)
 G SOL
"RTN","PSSPOIMO",85,0)
CHECK ;
"RTN","PSSPOIMO",86,0)
 S ZZFLAG=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",X,PSDOSE,VV)) Q:'VV  I VV,'$P($G(^PS(50.7,VV,0)),"^",3) S ZZFLAG=1
"RTN","PSSPOIMO",87,0)
 I ZZFLAG W $C(7),!!?5,"There is already an Orderable Item with this same name and Dosage Form",!?5,"that is not flagged as 'IV'. Use the 'DISPENSE DRUG/ORDERABLE ITEM",!?5,"MAINTENANCE' option if you want to re-match to this Orderable Item!",!
"RTN","PSSPOIMO",88,0)
 Q
"RTN","PSSPOIMO",89,0)
ZCHECK ;
"RTN","PSSPOIMO",90,0)
 S ZZFLAG=0 F VV=0:0 S VV=$O(^PS(50.7,"ADF",X,PSDOSE,VV)) Q:'VV  I VV,$P($G(^PS(50.7,VV,0)),"^",3) S ZZFLAG=1
"RTN","PSSPOIMO",91,0)
 I ZZFLAG W $C(7),!!?5,"There is already an Orderable Item with the same name and Dosage Form,",!?5,"that is flagged for 'IV' use.",!
"RTN","PSSPOIMO",92,0)
 Q
"RTN","PSSPOIMO",93,0)
SOL ;
"RTN","PSSPOIMO",94,0)
 K DIR S DIR(0)="Y",DIR("B")="YES",DIR("A")="List all Additives and Solutions tied to this Orderable Item" D ^DIR K DIR G:Y["^"!($D(DTOUT)) EN G:Y=0 EDIT
"RTN","PSSPOIMO",95,0)
 H 1 K PSOARR,PSOARRAD S AAA=$O(^PS(52.6,"AOI",PSOIEN,0)) I AAA,$D(^PS(52.6,AAA,0)) S PSOARRAD=AAA
"RTN","PSSPOIMO",96,0)
 F SSS=0:0 S SSS=$O(^PS(52.7,"AOI",PSOIEN,SSS)) Q:'SSS  S:$D(^PS(52.7,SSS,0)) PSOARR(SSS)=""
"RTN","PSSPOIMO",97,0)
 S FLAG=1,UPFLAG=0 D SHEAD F ZZ=0:0 S ZZ=$O(PSOARR(ZZ)) Q:'ZZ!($G(PSOUT))!($G(UPFLAG))  S FLAG=0 D:($Y+7)>IOSL SHEAD Q:$G(PSOUT)!($G(UPFLAG))  I ZZ W !,$P($G(^PS(52.7,ZZ,0)),"^"),"   ",$P($G(^(0)),"^",3)
"RTN","PSSPOIMO",98,0)
 G:$G(PSOUT) EN
"RTN","PSSPOIMO",99,0)
 G EDIT
"RTN","PSSPOIMO",100,0)
SHEAD I 'FLAG W ! K DIR S DIR(0)="E",DIR("A")="Press RETURN to continue" D ^DIR K DIR I 'Y S:Y="" PSOUT=1 S:Y=0 UPFLAG=1 Q
"RTN","PSSPOIMO",101,0)
 W @IOF W !?6,"Orderable Item ->  ",PSOINAME,?68,"(IV)",!?6,"Dosage Form    ->  ",$P($G(^PS(50.606,+$P($G(^PS(50.7,PSOIEN,0)),"^",2),0)),"^"),!,PLINE I FLAG,'$G(PSOARRAD) W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",102,0)
 I 'FLAG W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",103,0)
 I FLAG,$G(PSOARRAD) W !,$P($G(^PS(52.6,PSOARRAD,0)),"^"),"    ","(IV Additive)",! I $D(PSOARR) W !?5,"IV Solutions:",!
"RTN","PSSPOIMO",104,0)
 Q
"RTN","PSSPOIMO",105,0)
DTE I $D(^PSDRUG(ZZ,"I")) S Y=$P(^PSDRUG(ZZ,"I"),"^") D DD^%DT W ?50,Y K Y
"RTN","PSSPOIMO",106,0)
 Q
"RTN","PSSPOIMO",107,0)
DTEX S Y=$G(PSSLDATE) D DD^%DT W ?50,$G(Y) K Y
"RTN","PSSPOIMO",108,0)
 Q
"RTN","PSSPOIMO",109,0)
IVMSG ; display a message if the CORRESPONDING IV field is entered
"RTN","PSSPOIMO",110,0)
 ;
"RTN","PSSPOIMO",111,0)
 S PSSIVMSG=$P(^PS(50.7,PSOIEN,0),"^",11) I PSSIVMSG="" Q
"RTN","PSSPOIMO",112,0)
 S PSSIVFRM=$P(^PS(50.7,PSSIVMSG,0),"^",2) I PSSIVFRM S PSSIVFRM=$P(^PS(50.606,PSSIVFRM,0),"^")
"RTN","PSSPOIMO",113,0)
 S PSSIVMSG=$P(^PS(50.7,PSSIVMSG,0),"^")_" "_PSSIVFRM
"RTN","PSSPOIMO",114,0)
 W !!,"The Corresponding IV Item is currently identified as: "_PSSIVMSG,!
"RTN","PSSPOIMO",115,0)
 K PSSIVFRM,PSSIVMSG
"RTN","PSSPOIMO",116,0)
 Q
"RTN","PSSPOIMO",117,0)
UDMSG ; display a message if the CORRESPONDING UD field is entered
"RTN","PSSPOIMO",118,0)
 ;
"RTN","PSSPOIMO",119,0)
 S PSSUDMSG=$P(^PS(50.7,PSOIEN,0),"^",10) I PSSUDMSG="" Q
"RTN","PSSPOIMO",120,0)
 S PSSUDFRM=$P(^PS(50.7,PSSUDMSG,0),"^",2) I PSSUDFRM S PSSUDFRM=$P(^PS(50.606,PSSUDFRM,0),"^")
"RTN","PSSPOIMO",121,0)
 S PSSUDMSG=$P(^PS(50.7,PSSUDMSG,0),"^")_" "_PSSUDFRM
"RTN","PSSPOIMO",122,0)
 W !!,"The Corresponding UD Item is currently identified as: "_PSSUDMSG,!
"RTN","PSSPOIMO",123,0)
 K PSSUDMSG,PSSUDFRM
"RTN","PSSPOIMO",124,0)
 Q
"RTN","PSSSEE")
0^11^B2787240^B2533355
"RTN","PSSSEE",1,0)
PSSSEE ;BIR/ASJ-SYNONYM DRUG ENTER/EDIT ROUTINE ; 01/21/00 13:30
"RTN","PSSSEE",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**37,57,70,77,82,125**;09/30/97;Build 2
"RTN","PSSSEE",3,0)
 ;Reference to ^PS(59 supported by DBIA #1976
"RTN","PSSSEE",4,0)
 ;
"RTN","PSSSEE",5,0)
 N PSDRUG,PSSFLAG,XX,DVER,DMFU,DNSNAM,DNSPORT S XX=""
"RTN","PSSSEE",6,0)
BEGIN S PSSFLAG=0 D ^PSSDEE2 F PSSXX=1:1 K DA D ASK Q:PSSFLAG
"RTN","PSSSEE",7,0)
DONE D ^PSSDEE2 K PSSFLAG W @IOF Q
"RTN","PSSSEE",8,0)
ASK W ! S DIC="^PSDRUG(",DIC(0)="QEAMN" D ^DIC K DIC I Y<0 S PSSFLAG=1 Q
"RTN","PSSSEE",9,0)
 S DA=+Y,DISPDRG=DA L +^PSDRUG(DISPDRG):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSSEE",10,0)
 D COMMON I '$G(PSSHUIDG) D DRG^PSSHUIDG(DISPDRG) D  L -^PSDRUG(DISPDRG)
"RTN","PSSSEE",11,0)
 . F XX=0:0 S XX=$O(^PS(59,XX)) Q:'XX  D
"RTN","PSSSEE",12,0)
 ..S DVER=$$GET1^DIQ(59,XX_",",105,"I"),DMFU=$$GET1^DIQ(59,XX_",",105.2)
"RTN","PSSSEE",13,0)
 ..I DVER="2.4" S DNSNAM=$$GET1^DIQ(59,XX_",",2006),DNSPORT=$$GET1^DIQ(59,XX_",",2007) I DNSNAM'=""&(DMFU="YES") D DRG^PSSDGUPD(DISPDRG,"",DNSNAM,DNSPORT)
"RTN","PSSSEE",14,0)
 Q
"RTN","PSSSEE",15,0)
COMMON S DIE="^PSDRUG(",DR="[PSS SYNONYM]" D ^DIE K DIE,DR,DA,Y
"RTN","PSSSEE",16,0)
 Q
"RTN","PSSSOLIT")
0^12^B19718816^B19253143
"RTN","PSSSOLIT",1,0)
PSSSOLIT ;BIR/RTR/WRT-Manual match Solutions to Orderable Items; 09/02/97 8:54
"RTN","PSSSOLIT",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**32,41,125**;9/30/97;Build 2
"RTN","PSSSOLIT",3,0)
 ;
"RTN","PSSSOLIT",4,0)
EN I $D(PSSIEN) L -^PS(52.7,PSSIEN)
"RTN","PSSSOLIT",5,0)
 D:$G(PSDELSLG) REMSS D:$G(PSMASTER) END Q:$G(PSSSSS)!($G(PSMASTER))  D END W ! S (PSSOUT,CHANGE,CHKFLAG)=0 K DIC S DIC="^PS(52.7,",DIC(0)="QEAMZ",DIC("A")="Select IV SOLUTION: " D ^DIC K DIC G:Y<0!($D(DTOUT))!($D(DUOUT)) END
"RTN","PSSSOLIT",6,0)
MAS ;Entry point for Master Drug Enter/Edit
"RTN","PSSSOLIT",7,0)
 S PSSIEN=+Y,PSSNAME=$P(Y,"^",2),PSDISP=+$P($G(^PS(52.7,+Y,0)),"^",2),(PSSOI,PSOLDOI)=+$P($G(^(0)),"^",11),PSSVOL=$P($G(^(0)),"^",3) L +^PS(52.7,PSSIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T W !,$C(7),"Another person is editing this one." Q
"RTN","PSSSOLIT",8,0)
 I 'PSDISP W $C(7),!!?5,"This IV Solution does not point to the Dispense Drug File (#50)",!?5,"it cannot be matched to an Orderable Item!",! G EN
"RTN","PSSSOLIT",9,0)
ENTER I 'PSSOI G ^PSSSOLI1
"RTN","PSSSOLIT",10,0)
 S PSOINAME=$P($G(^PS(50.7,PSSOI,0)),"^"),PSOIDOSE=+$P($G(^(0)),"^",2) W !!,"IV Solution ->  ",PSSNAME,"    ",PSSVOL,!,"  is already matched to:",!,PSOINAME,"    ",$P($G(^PS(50.606,PSOIDOSE,0)),"^")
"RTN","PSSSOLIT",11,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Do you want to re-match this IV Solution",DIR("B")="NO" D ^DIR K DIR I Y'=1 D SELIV G @$S($G(PSSJI)&('$G(PSSIVOUT)):"ENS^PSSVIDRG",1:"EN")
"RTN","PSSSOLIT",12,0)
 S PSDELSLG=1,PSDELSOL=PSSIEN,PSDELOIS=PSSOI
"RTN","PSSSOLIT",13,0)
 K DIE S DA=PSSIEN,DIE="^PS(52.7,",DR="9////"_"@" D ^DIE K DIE D EN^PSSPOIDT(PSSOI),EN2^PSSHL1(PSSOI,"MUP") K PSOINAME,PSOIDOSE,PSSOI G ^PSSSOLI1
"RTN","PSSSOLIT",14,0)
INACT W ! K DIE S PSBEFORE=$P(^PS(50.7,PSSOI,0),"^",4),PSAFTER=0,PSINORDE="" S DIE="^PS(50.7,",DR=".04;.05;.06;.07;.08",DA=PSSOI D ^DIE S PSAFTER=$P(^PS(50.7,PSSOI,0),"^",4) K DIE
"RTN","PSSSOLIT",15,0)
 S:PSBEFORE&('PSAFTER) PSINORDE="D" S:PSAFTER PSINORDE="I"
"RTN","PSSSOLIT",16,0)
 I PSINORDE'="" D REST^PSSPOIDT(PSSOI)
"RTN","PSSSOLIT",17,0)
 K PSBEFORE,PSAFTER,PSINORDE
"RTN","PSSSOLIT",18,0)
SYN W ! K DIC S:'$D(^PS(50.7,PSSOI,2,0)) ^PS(50.7,PSSOI,2,0)="^50.72^0^0" S DIC="^PS(50.7,"_PSSOI_",2,",DA(1)=PSSOI,DIC(0)="QEAMLZ",DIC("A")="Select SYNONYM: ",DLAYGO=50.7 D ^DIC K DIC
"RTN","PSSSOLIT",19,0)
 I Y<0!($D(DTOUT))!($D(DUOUT)) K:'$O(^PS(50.7,PSSOI,2,0)) ^PS(50.7,PSSOI,2,0) Q:$G(NEWFLAG)  D EN^PSSPOIDT(PSSOI) D:'$G(PSSSSS) EN2^PSSHL1(PSSOI,"MUP") G EN
"RTN","PSSSOLIT",20,0)
 W ! S DA=+Y,DIE="^PS(50.7,"_PSSOI_",2,",DA(1)=PSSOI,DR=.01 D ^DIE K DIE G SYN
"RTN","PSSSOLIT",21,0)
 Q:$G(NEWFLAG)  D EN^PSSPOIDT(PSSOI) D:'$G(PSSSSS) EN2^PSSHL1(PSSOI,"MUP")
"RTN","PSSSOLIT",22,0)
 G EN
"RTN","PSSSOLIT",23,0)
END I $D(PSSIEN) L -^PS(52.7,PSSIEN)
"RTN","PSSSOLIT",24,0)
 K DA,DIC,DIR,PSSIEN,PSSNAME,PSDISP,PSSOI,PSDOSNM,CHANGE,CHKFLAG,DA,DR,DIR,DIE,INFLAG,HOLDOI,INPUT,J,JJ,HOLDNAME,NEWFLAG,PSDOSPTR,PSND,PSND1,PSND3,PSNDOSE,PSOIDOSE,PSOINAME,PSOLDOI,PSONEW,PSOTHER,PSSOUT,PSSVOL,ZZ,ZZZZFLAG,ZZPOI,ZZFLAG
"RTN","PSSSOLIT",25,0)
 K SS,QQ,WW,PSNEWOI,PPFLAG,VV,VVV,TT,SCLAST,SYN,SYN1,SCOUNT,PSANS,ZZFLAG,ZZXFLAG,PSPOI,SYNNAM,PSDELSOL,PSDELSLG,PSDELOIS,PSSSSS Q
"RTN","PSSSOLIT",26,0)
 Q
"RTN","PSSSOLIT",27,0)
REMAT ;Rematch Additive to Orderable Item
"RTN","PSSSOLIT",28,0)
 I '$G(PSDELADD)!('$G(PSDELOIT)) G QREMAT
"RTN","PSSSOLIT",29,0)
 I $P($G(^PS(52.6,PSDELADD,0)),"^",11) G QREMAT
"RTN","PSSSOLIT",30,0)
 I $P($G(^PS(50.7,+PSDELOIT,0)),"^",3),'$O(^PS(52.6,"AOI",+PSDELOIT,0)) D
"RTN","PSSSOLIT",31,0)
 .K DIE S DIE="^PS(52.6,",DA=PSDELADD,DR="15////"_PSDELOIT D ^DIE K DIE D EN^PSSPOIDT(PSDELOIT),EN2^PSSHL1(PSDELOIT,"MUP")
"RTN","PSSSOLIT",32,0)
QREMAT K PSDELADD,PSDELFLG,PSDELOIT Q
"RTN","PSSSOLIT",33,0)
 ;
"RTN","PSSSOLIT",34,0)
REMSS ;Rematch solution to Orderable Item
"RTN","PSSSOLIT",35,0)
 I '$G(PSDELSOL)!('$G(PSDELOIS)) G QRESOL
"RTN","PSSSOLIT",36,0)
 I $P($G(^PS(52.7,PSDELSOL,0)),"^",11) G QRESOL
"RTN","PSSSOLIT",37,0)
 I $P($G(^PS(50.7,+PSDELOIS,0)),"^",3) D
"RTN","PSSSOLIT",38,0)
 .K DIE S DIE="^PS(52.7,",DA=PSDELSOL,DR="9////"_PSDELOIS D ^DIE K DIE D EN^PSSPOIDT(PSDELOIS),EN2^PSSHL1(PSDELOIS,"MUP")
"RTN","PSSSOLIT",39,0)
QRESOL K PSDELSOL,PSDELOIS,PSDELSLG Q
"RTN","PSSSOLIT",40,0)
 ;
"RTN","PSSSOLIT",41,0)
SELIV ;Ask user to select another IV Additive or Solution.
"RTN","PSSSOLIT",42,0)
 K PSSIVOUT
"RTN","PSSSOLIT",43,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Would you like to enter another IV Additive or Solution",DIR("B")="NO" D ^DIR K DIR I Y'=1 S PSSIVOUT=1
"RTN","PSSSOLIT",44,0)
 Q
"RTN","PSSVIDRG")
0^13^B28763212^B28213537
"RTN","PSSVIDRG",1,0)
PSSVIDRG ;BIR/PR,WRT-ADD OR EDIT IV DRUGS ; 04/17/98 9:13
"RTN","PSSVIDRG",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**2,10,32,38,125**;9/30/97;Build 2
"RTN","PSSVIDRG",3,0)
 ;
"RTN","PSSVIDRG",4,0)
 ;Reference to ENIVKV^PSGSETU is supported by DBIA # 2153.
"RTN","PSSVIDRG",5,0)
 ;Reference to ^PSIV is supported by DBIA # 2155.
"RTN","PSSVIDRG",6,0)
 ;Reference to ^PSIVHLP1 is supported by DBIA # 2156.
"RTN","PSSVIDRG",7,0)
 ;Reference to ^PSIVXU is supported by DBIA # 2157.
"RTN","PSSVIDRG",8,0)
 ;
"RTN","PSSVIDRG",9,0)
ENS ;Enter here to enter/edit solutions
"RTN","PSSVIDRG",10,0)
 S DRUGEDIT=1,FI=52.7 L +^PS(FI):$S($G(DILOCKTM)>0:DILOCKTM,1:3) E  W $C(7),!!,"Someone else is entering drugs ... try later !",!! G K
"RTN","PSSVIDRG",11,0)
ENS1 ;
"RTN","PSSVIDRG",12,0)
 N DA,DIC,DLAYGO S DIC=FI,DIC(0)="AEQML",DLAYGO=52.7 D ^DIC I Y<0 G K1
"RTN","PSSVIDRG",13,0)
 S PSSASK="SOLUTIONS",DRUG=+Y,DIE=DIC,(DA,ENTRY)=+Y,DR=".01:.02" D ^DIE,EECK S DIE="^PS(52.7,",DA=ENTRY,DR="1;D GETD^PSSVIDRG;2:8;10:15;17:99999" D ^DIE,MFS^PSSDEE
"RTN","PSSVIDRG",14,0)
 Q
"RTN","PSSVIDRG",15,0)
 ;
"RTN","PSSVIDRG",16,0)
ENA ;Enter here to enter/edit additives.
"RTN","PSSVIDRG",17,0)
 S DRUGEDIT=1,FI=52.6 L +^PS(FI):$S($G(DILOCKTM)>0:DILOCKTM,1:3) E  W $C(7),!!,"Someone else is entering drugs ... try later !",!! G K
"RTN","PSSVIDRG",18,0)
ENA1 ;
"RTN","PSSVIDRG",19,0)
 N DA,DIC,DIE,DLAYGO S DIC=FI,DIC(0)="AEQL",DLAYGO=52.6 D ^DIC I Y<0 G K1
"RTN","PSSVIDRG",20,0)
 S PSSASK="ADDITIVES",DRUG=+Y,DIE=DIC,(DA,ENTRY)=+Y,DR=".01" D EECK S DIE="^PS(52.6,",DA=ENTRY,DR="[PSSIV ADD]" D ^DIE,MFA^PSSDEE
"RTN","PSSVIDRG",21,0)
 Q
"RTN","PSSVIDRG",22,0)
ENC ;Enter here to enter/edit IV Categories
"RTN","PSSVIDRG",23,0)
 ;S X="PSIVXU" X ^%ZOSF("TEST") I  D ^PSIVXU Q:$D(XQUIT)  K DA,DIC,DIE,DR,DLAYGO S DIC="^PS(50.2,",DIC(0)="AEQL",DLAYGO=50.2 D ^DIC G:Y<0 K S DIE=DIC,DR=".01;1",DA=+Y D ^DIE G K
"RTN","PSSVIDRG",24,0)
 Q
"RTN","PSSVIDRG",25,0)
 ;
"RTN","PSSVIDRG",26,0)
K1 ;
"RTN","PSSVIDRG",27,0)
 L -^PS(FI)
"RTN","PSSVIDRG",28,0)
K S X="PSGSETU" X ^%ZOSF("TEST") I  D ENIVKV^PSGSETU
"RTN","PSSVIDRG",29,0)
KDRG K B,DA,DG,DIC,DIE,DIJ,DIX,DIY,DIYS,DLAYGO,DO,DRUG,DRUGEDIT,FI,I,J,P,PSIV,PSIVAT,PSSIVDRG,PSIVSC,XT,Z
"RTN","PSSVIDRG",30,0)
 Q
"RTN","PSSVIDRG",31,0)
 ;
"RTN","PSSVIDRG",32,0)
GETD ;See if generic drug is inactive in file 50.
"RTN","PSSVIDRG",33,0)
 I $D(^PSDRUG(X,"I")),^("I"),(DT+1>+^("I")) W $C(7),$C(7),!!,"This drug is inactive and will not be selectable during IV order entry.",! S ^PS(FI,DRUG,"I")=^PSDRUG(X,"I")
"RTN","PSSVIDRG",34,0)
 Q
"RTN","PSSVIDRG",35,0)
ENTDRG ;This module is no longer utilized by the Inpatient Medications application.
"RTN","PSSVIDRG",36,0)
 ;Will print word-processing field in IV add. file (52.6) and
"RTN","PSSVIDRG",37,0)
 ;IV sol. file (52.7).
"RTN","PSSVIDRG",38,0)
 ;
"RTN","PSSVIDRG",39,0)
 Q
"RTN","PSSVIDRG",40,0)
 ;S X="PSIV" X ^%ZOSF("TEST") I  D ^PSIV Q:$D(XQUIT)
"RTN","PSSVIDRG",41,0)
 S X="PSIV" X ^%ZOSF("TEST") I  D ^PSIVHLP1 Q:$D(XQUIT)
"RTN","PSSVIDRG",42,0)
 N P W !!,"Are you inquiring on" S X="... an IV ADDITIVE or IV SOLUTION (A/S): ^ADDITIVE^^ADDITIVE,SOLUTION" D ENQ^PSIV S X=$E(X) Q:"^"[X  I X["?" S HELP="DRGINQ" D ^PSIVHLP1 G ENTDRG
"RTN","PSSVIDRG",43,0)
 S FI=$S(X["A":52.6,1:52.7) N D0,D1,DA,DI,DIE,DP,DR,DQ
"RTN","PSSVIDRG",44,0)
DRG F Y=0:0 W ! X ^DD(55.11,.01,12.1) K DA,DIC S DIC="^PS("_FI_",",DIC(0)="QEAM" D ^DIC G:Y<0 KDRG S PSSIVDRG=+Y D WPH,WP
"RTN","PSSVIDRG",45,0)
 G KDRG
"RTN","PSSVIDRG",46,0)
WPH ;
"RTN","PSSVIDRG",47,0)
 W:$Y @IOF W ! F Y=1:1:79 W "-"
"RTN","PSSVIDRG",48,0)
 W !,"Drug information on: ",$P(^PS(FI,PSSIVDRG,0),"^")
"RTN","PSSVIDRG",49,0)
 W !?7,"Last updated: " W:'$D(^PS(FI,PSSIVDRG,4,0)) "N/A" I $D(^(0)) S Y=$P(^(0),"^",5) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2)
"RTN","PSSVIDRG",50,0)
 W ! Q
"RTN","PSSVIDRG",51,0)
WP W ! I '$D(^PS(FI,PSSIVDRG,4,0)) W !,"*** No information on file. ***"
"RTN","PSSVIDRG",52,0)
 F Z=0:0 S Z=$O(^PS(FI,PSSIVDRG,4,Z)) Q:'Z  W !,^(Z,0) I $Y+5>IOSL W $C(7),!!,"Press return key: " R I:DTIME Q:'$T!(I["^")  D WPH
"RTN","PSSVIDRG",53,0)
 W ! F Y=1:1:79 W "-"
"RTN","PSSVIDRG",54,0)
 Q
"RTN","PSSVIDRG",55,0)
ENT ;
"RTN","PSSVIDRG",56,0)
 ;Will print out information on IV DRUGS
"RTN","PSSVIDRG",57,0)
 Q
"RTN","PSSVIDRG",58,0)
 ;S X="PSIV" X ^%ZOSF("TEST") I  D ^PSIV Q:$D(XQUIT)
"RTN","PSSVIDRG",59,0)
        S X="PSIV" X ^%ZOSF("TEST") I  D ^PSIVHLP1 Q:$D(XQUIT)
"RTN","PSSVIDRG",60,0)
 ;
"RTN","PSSVIDRG",61,0)
BEG W !!,"Are you printing drug information from ..." S X="the IV ADDITIVE file or IV SOLUTION file ? ^ADDITIVE^^ADDITIVE,SOLUTION" D ENQ^PSIV G:"^"[X K I X["?" S HELP="DRGINQ" D ^PSIVHLP1 G BEG
"RTN","PSSVIDRG",62,0)
 S L=0,DIC="^PS("_$S(X["A":52.6,1:52.7)_"," D EN1^DIP D ^%ZISC G K
"RTN","PSSVIDRG",63,0)
ELECTRO ;Edit Electrolyte file
"RTN","PSSVIDRG",64,0)
 S X="PSIVXU" X ^%ZOSF("TEST") I  D ^PSIVXU Q:$D(XQUIT)  K DA,DIC S DIC="^PS(50.4,",DIC(0)="AEQLM",DLAYGO=50.4 D ^DIC G:Y<0 K
"RTN","PSSVIDRG",65,0)
 S DIE=DIC,DR="[PSSJIDE]",DA=+Y D ^DIE G ELECTRO
"RTN","PSSVIDRG",66,0)
 Q
"RTN","PSSVIDRG",67,0)
EECK I $D(PSSZ) S:PSSASK="ADDITIVES" FILE=^PS(52.6,ENTRY,0) S:PSSASK="SOLUTIONS" FILE=^PS(52.7,ENTRY,0) S PSSIEN=$P(FILE,"^",2) D:PSSIEN']"" PASSIN I PSSIEN'=DISPDRG D ECK,EECK1
"RTN","PSSVIDRG",68,0)
 Q
"RTN","PSSVIDRG",69,0)
EECK1 W !,"This Additive or Solution is tied to ",$P(^PSDRUG(PSSIEN,0),"^",1),".",!,"You are editing dispense drug ",$P(^PSDRUG(DISPDRG,0),"^",1),".",!
"RTN","PSSVIDRG",70,0)
 Q
"RTN","PSSVIDRG",71,0)
ECK W !,"You are editing a Additive or Solution which is tied to a different",!,"dispense drug from the one you are currently editing."
"RTN","PSSVIDRG",72,0)
 Q
"RTN","PSSVIDRG",73,0)
SOI I $D(^PS(59.7,1,80)),$P(^PS(59.7,1,80),"^",2)>1 W !!,"You are NOW in the ORDERABLE ITEM matching for Solutions." S Y=ENTRY_"^"_$P(^PS(52.7,ENTRY,0),"^",1),PSMASTER=1 D MAS^PSSSOLIT K PSMASTER
"RTN","PSSVIDRG",74,0)
 Q
"RTN","PSSVIDRG",75,0)
ADDOI I $D(^PS(59.7,1,80)),$P(^PS(59.7,1,80),"^",2)>1 W !!,"You are NOW in the ORDERABLE ITEM matching for Additives." S Y=ENTRY_"^"_$P(^PS(52.6,ENTRY,0),"^",1),PSMASTER=1 D MAS^PSSADDIT K PSMASTER
"RTN","PSSVIDRG",76,0)
 Q
"RTN","PSSVIDRG",77,0)
PASSIN S:PSSASK="ADDITIVES" ROOT="^PS(52.6," S:PSSASK="SOLUTIONS" ROOT="^PS(52.7," S DIE=ROOT,DA=ENTRY,DR="1////"_DISPDRG D ^DIE D RFILE S X=DISPDRG
"RTN","PSSVIDRG",78,0)
 Q
"RTN","PSSVIDRG",79,0)
RFILE S:PSSASK="ADDITIVES" FILE=^PS(52.6,ENTRY,0) S:PSSASK="SOLUTIONS" FILE=^PS(52.7,ENTRY,0) S PSSIEN=$P(FILE,"^",2)
"RTN","PSSVIDRG",80,0)
 Q
"RTN","PSSVIDRG",81,0)
MASTER F PSSOR=0:0 S PSSOR=$O(^PS(50.7,PSSOR)) Q:'PSSOR  D EN2^PSSHL1(PSSOR,"MUP")
"RTN","PSSVIDRG",82,0)
 Q
"VER")
8.0^22.0
"BLD",6317,6)
^112
**END**
**END**
