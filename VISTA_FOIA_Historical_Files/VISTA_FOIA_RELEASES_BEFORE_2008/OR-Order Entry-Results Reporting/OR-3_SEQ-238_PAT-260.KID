Released OR*3*260 SEQ #238
Extracted from mail message
**KIDS**:OR*3.0*260^

**INSTALL NAME**
OR*3.0*260
"BLD",17843,0)
OR*3.0*260^ORDER ENTRY/RESULTS REPORTING^0^3061127^y
"BLD",17843,1,0)
^^1^1^3060813^^^^
"BLD",17843,1,1,0)
CPRS Miscelaneous fixes.
"BLD",17843,4,0)
^9.64PA^^
"BLD",17843,6.3)
26
"BLD",17843,"ABPKG")
n
"BLD",17843,"INID")
^n
"BLD",17843,"INIT")
POST^ORY260
"BLD",17843,"KRN",0)
^9.67PA^8989.52^19
"BLD",17843,"KRN",.4,0)
.4
"BLD",17843,"KRN",.4,"NM",0)
^9.68A^^
"BLD",17843,"KRN",.401,0)
.401
"BLD",17843,"KRN",.402,0)
.402
"BLD",17843,"KRN",.403,0)
.403
"BLD",17843,"KRN",.5,0)
.5
"BLD",17843,"KRN",.84,0)
.84
"BLD",17843,"KRN",3.6,0)
3.6
"BLD",17843,"KRN",3.8,0)
3.8
"BLD",17843,"KRN",9.2,0)
9.2
"BLD",17843,"KRN",9.8,0)
9.8
"BLD",17843,"KRN",9.8,"NM",0)
^9.68A^18^18
"BLD",17843,"KRN",9.8,"NM",1,0)
ORWGAPIA^^0^B86031507
"BLD",17843,"KRN",9.8,"NM",2,0)
ORWDAL33^^0^B2071002
"BLD",17843,"KRN",9.8,"NM",3,0)
ORQRY01^^0^B8896457
"BLD",17843,"KRN",9.8,"NM",4,0)
OR3CONV^^0^B58054933
"BLD",17843,"KRN",9.8,"NM",5,0)
ORPRS06^^0^B11029541
"BLD",17843,"KRN",9.8,"NM",6,0)
ORWGAPIU^^0^B48983345
"BLD",17843,"KRN",9.8,"NM",7,0)
ORPXRM^^0^B12504214
"BLD",17843,"KRN",9.8,"NM",8,0)
ORWD1^^0^B27963897
"BLD",17843,"KRN",9.8,"NM",9,0)
ORWCV^^0^B73087696
"BLD",17843,"KRN",9.8,"NM",10,0)
ORWGAPIT^^0^B58427487
"BLD",17843,"KRN",9.8,"NM",11,0)
ORWGAPIP^^0^B44949534
"BLD",17843,"KRN",9.8,"NM",12,0)
ORY260^^0^B23654256
"BLD",17843,"KRN",9.8,"NM",13,0)
ORWGAPIX^^0^B26817522
"BLD",17843,"KRN",9.8,"NM",14,0)
ORWGAPIR^^0^B42620788
"BLD",17843,"KRN",9.8,"NM",15,0)
ORWGAPI4^^0^B86012135
"BLD",17843,"KRN",9.8,"NM",16,0)
ORQQVI^^0^B40454772
"BLD",17843,"KRN",9.8,"NM",17,0)
ORPR01^^0^B19254955
"BLD",17843,"KRN",9.8,"NM",18,0)
ORPR02^^0^B43219777
"BLD",17843,"KRN",9.8,"NM","B","OR3CONV",4)

"BLD",17843,"KRN",9.8,"NM","B","ORPR01",17)

"BLD",17843,"KRN",9.8,"NM","B","ORPR02",18)

"BLD",17843,"KRN",9.8,"NM","B","ORPRS06",5)

"BLD",17843,"KRN",9.8,"NM","B","ORPXRM",7)

"BLD",17843,"KRN",9.8,"NM","B","ORQQVI",16)

"BLD",17843,"KRN",9.8,"NM","B","ORQRY01",3)

"BLD",17843,"KRN",9.8,"NM","B","ORWCV",9)

"BLD",17843,"KRN",9.8,"NM","B","ORWD1",8)

"BLD",17843,"KRN",9.8,"NM","B","ORWDAL33",2)

"BLD",17843,"KRN",9.8,"NM","B","ORWGAPI4",15)

"BLD",17843,"KRN",9.8,"NM","B","ORWGAPIA",1)

"BLD",17843,"KRN",9.8,"NM","B","ORWGAPIP",11)

"BLD",17843,"KRN",9.8,"NM","B","ORWGAPIR",14)

"BLD",17843,"KRN",9.8,"NM","B","ORWGAPIT",10)

"BLD",17843,"KRN",9.8,"NM","B","ORWGAPIU",6)

"BLD",17843,"KRN",9.8,"NM","B","ORWGAPIX",13)

"BLD",17843,"KRN",9.8,"NM","B","ORY260",12)

"BLD",17843,"KRN",19,0)
19
"BLD",17843,"KRN",19,"NM",0)
^9.68A^^
"BLD",17843,"KRN",19.1,0)
19.1
"BLD",17843,"KRN",101,0)
101
"BLD",17843,"KRN",409.61,0)
409.61
"BLD",17843,"KRN",771,0)
771
"BLD",17843,"KRN",870,0)
870
"BLD",17843,"KRN",8989.51,0)
8989.51
"BLD",17843,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",17843,"KRN",8989.51,"NM",1,0)
ORWG GRAPH PUBLIC EDITOR CLASS^^0
"BLD",17843,"KRN",8989.51,"NM","B","ORWG GRAPH PUBLIC EDITOR CLASS",1)

"BLD",17843,"KRN",8989.52,0)
8989.52
"BLD",17843,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",17843,"KRN",8994,0)
8994
"BLD",17843,"KRN","B",.4,.4)

"BLD",17843,"KRN","B",.401,.401)

"BLD",17843,"KRN","B",.402,.402)

"BLD",17843,"KRN","B",.403,.403)

"BLD",17843,"KRN","B",.5,.5)

"BLD",17843,"KRN","B",.84,.84)

"BLD",17843,"KRN","B",3.6,3.6)

"BLD",17843,"KRN","B",3.8,3.8)

"BLD",17843,"KRN","B",9.2,9.2)

"BLD",17843,"KRN","B",9.8,9.8)

"BLD",17843,"KRN","B",19,19)

"BLD",17843,"KRN","B",19.1,19.1)

"BLD",17843,"KRN","B",101,101)

"BLD",17843,"KRN","B",409.61,409.61)

"BLD",17843,"KRN","B",771,771)

"BLD",17843,"KRN","B",870,870)

"BLD",17843,"KRN","B",8989.51,8989.51)

"BLD",17843,"KRN","B",8989.52,8989.52)

"BLD",17843,"KRN","B",8994,8994)

"BLD",17843,"QUES",0)
^9.62^^
"BLD",17843,"REQB",0)
^9.611^6^6
"BLD",17843,"REQB",1,0)
OR*3.0*250^2
"BLD",17843,"REQB",2,0)
OR*3.0*11^2
"BLD",17843,"REQB",3,0)
OR*3.0*215^2
"BLD",17843,"REQB",4,0)
OR*3.0*92^2
"BLD",17843,"REQB",5,0)
OR*3.0*157^2
"BLD",17843,"REQB",6,0)
OR*3.0*251^2
"BLD",17843,"REQB","B","OR*3.0*11",2)

"BLD",17843,"REQB","B","OR*3.0*157",5)

"BLD",17843,"REQB","B","OR*3.0*215",3)

"BLD",17843,"REQB","B","OR*3.0*250",1)

"BLD",17843,"REQB","B","OR*3.0*251",6)

"BLD",17843,"REQB","B","OR*3.0*92",4)

"INIT")
POST^ORY260
"KRN",8989.51,371,-1)
0^1
"KRN",8989.51,371,0)
ORWG GRAPH PUBLIC EDITOR CLASS^CPRS Graph Public Editor Classes^1^Sequence Number^User Class
"KRN",8989.51,371,1)
P^8930^Enter the User Class for public editing of graphs.
"KRN",8989.51,371,6)
N^^Enter a sequential number for identifying the user class.
"KRN",8989.51,371,20,0)
^8989.512^3^3^3061026^^^^
"KRN",8989.51,371,20,1,0)
This parameter contains a list of ASU user classes who's members are allowed 
"KRN",8989.51,371,20,2,0)
to edit public views and settings for graphs. Users that belong to the user
"KRN",8989.51,371,20,3,0)
class entered at the SYSTEM level have this authority.
"KRN",8989.51,371,30,0)
^8989.513I^4^1
"KRN",8989.51,371,30,4,0)
5^4.2
"MBREQ")
0
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",22,-1)
1^1
"PKG",22,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
3.0^2971217^2980204^64
"PKG",22,22,1,"PAH",1,0)
260^3061127^4547
"PKG",22,22,1,"PAH",1,1,0)
^^1^1^3061127
"PKG",22,22,1,"PAH",1,1,1,0)
CPRS Miscelaneous fixes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
18
"RTN","OR3CONV")
0^4^B58054933^B58054933
"RTN","OR3CONV",1,0)
OR3CONV ;SLC/MLI-OE/RR v3 conversion entry points ;8/11/06  13:31
"RTN","OR3CONV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**14,215,260**;Dec 17, 1997;Build 26
"RTN","OR3CONV",3,0)
 ;
"RTN","OR3CONV",4,0)
 ; This routine contains the entry points to convert orders from
"RTN","OR3CONV",5,0)
 ; all package (OE/RR, pharmacy, dietetics, etc.).
"RTN","OR3CONV",6,0)
 ;
"RTN","OR3CONV",7,0)
 ; Entry points exist for:
"RTN","OR3CONV",8,0)
 ; A. background conversion of orders (steps described in tag):  (BGJ)
"RTN","OR3CONV",9,0)
 ; B. on-the-fly conversion if record is accessed before background
"RTN","OR3CONV",10,0)
 ;    conversion gets to it.                                   (OTF)
"RTN","OR3CONV",11,0)
 ;
"RTN","OR3CONV",12,0)
 ; Only OTF is a supported call.  Remaining calls in routine are
"RTN","OR3CONV",13,0)
 ; only called from within this routine (no external calls made in).
"RTN","OR3CONV",14,0)
 ;
"RTN","OR3CONV",15,0)
 ; Supporting calls exist in OR3CONV1 as follows:
"RTN","OR3CONV",16,0)
 ; A. stop conversion process cleanly once in bgj              (STOP)
"RTN","OR3CONV",17,0)
 ; B. restarting background process if it did not complete.    (RESTART)
"RTN","OR3CONV",18,0)
 ; C. check status of conversion process                       (STATUS)
"RTN","OR3CONV",19,0)
 ;
"RTN","OR3CONV",20,0)
 Q
"RTN","OR3CONV",21,0)
 ;
"RTN","OR3CONV",22,0)
QUEUE ; queue background process to run.  DO NOT CALL MANUALLY!
"RTN","OR3CONV",23,0)
 ; called from OR3POST and RESTART^OR3CONV1
"RTN","OR3CONV",24,0)
 ;
"RTN","OR3CONV",25,0)
 ; check entry...disallow calling tag once conversion has begun
"RTN","OR3CONV",26,0)
 N X
"RTN","OR3CONV",27,0)
 S X=$G(^ORD(100.99,1,"CONV"))
"RTN","OR3CONV",28,0)
 I '$D(ZTSAVE("ORESTART")),$P(X,"^",1) W !!,"Conversion already done!" Q
"RTN","OR3CONV",29,0)
 I '$D(ZTSAVE("ORESTART")),($P(X,"^",10)]"") D  Q
"RTN","OR3CONV",30,0)
 . W !,"The conversion has already started."
"RTN","OR3CONV",31,0)
 . W !,"Please call RESTART^OR3CONV1 to restart the conversion!"
"RTN","OR3CONV",32,0)
 . Q
"RTN","OR3CONV",33,0)
 ;
"RTN","OR3CONV",34,0)
 ; if restart, ZTSAVE("ORESTART") set on entry - ask time to queue
"RTN","OR3CONV",35,0)
 S ZTIO="",ZTRTN="BGJ^OR3CONV"
"RTN","OR3CONV",36,0)
 I '$D(ZTSAVE("ORESTART")) S ZTDTH=$$NOW^XLFDT()
"RTN","OR3CONV",37,0)
 S ZTDESC="OE/RR v3 orders conversion...use STATUS^OR3CONV1 to track progress"
"RTN","OR3CONV",38,0)
 ;S:$D(ZTSAVE("ORESTART")) ORESTART=ZTSAVE("ORESTART") D BGJ^OR3CONV ; *****for testing only*****
"RTN","OR3CONV",39,0)
 D ^%ZTLOAD
"RTN","OR3CONV",40,0)
 I $G(ZTSK) D
"RTN","OR3CONV",41,0)
 . D BMES^XPDUTL("Orders conversion tasked - #"_ZTSK)
"RTN","OR3CONV",42,0)
 . D SET(10,ZTSK)
"RTN","OR3CONV",43,0)
 E  D
"RTN","OR3CONV",44,0)
 . D BMES^XPDUTL("***Problem encountered queuing conversion***")
"RTN","OR3CONV",45,0)
 . D MES^XPDUTL("   D QUEUE^OR3CONV to start manually.")
"RTN","OR3CONV",46,0)
 K ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","OR3CONV",47,0)
 Q
"RTN","OR3CONV",48,0)
 ;
"RTN","OR3CONV",49,0)
BGJ ; process via background job in order below
"RTN","OR3CONV",50,0)
 ; if restart, set ORPROCES = to step last on, call BGJ1
"RTN","OR3CONV",51,0)
 ;   0.  initialize list of patients to convert, then convert orders for:
"RTN","OR3CONV",52,0)
 ;   1.  current inpatients
"RTN","OR3CONV",53,0)
 ;   2.  patients with future scheduled admissions
"RTN","OR3CONV",54,0)
 ;   3.  patients on waiting list
"RTN","OR3CONV",55,0)
 ;   4.  patients with discharges in last 4 weeks
"RTN","OR3CONV",56,0)
 ;   5.  patients with appointments in last 4 weeks or next 4 weeks
"RTN","OR3CONV",57,0)
 ;   6.  everyone else (loop through DPT for remaining patients)
"RTN","OR3CONV",58,0)
 ;   7.  orders associated with entities not in the PATIENT file
"RTN","OR3CONV",59,0)
 ;
"RTN","OR3CONV",60,0)
 I '$D(ZTQUEUED) W !,"Use RESTART^OR3CONV1!!!" Q  ; prevent calling tag
"RTN","OR3CONV",61,0)
 ;
"RTN","OR3CONV",62,0)
 N ORPROCES,ORSTOP
"RTN","OR3CONV",63,0)
 S ORSTOP=0 D SET(11,0) ; reset stop conversion parameter to no
"RTN","OR3CONV",64,0)
 I $D(ORESTART) D
"RTN","OR3CONV",65,0)
 . S ORPROCES=+$P(^ORD(100.99,1,"CONV"),"^",8)
"RTN","OR3CONV",66,0)
 E  D
"RTN","OR3CONV",67,0)
 . S ORPROCES=0
"RTN","OR3CONV",68,0)
 . D SET(6,$$NOW^XLFDT())
"RTN","OR3CONV",69,0)
 F  Q:ORPROCES>7  D  Q:ORSTOP
"RTN","OR3CONV",70,0)
 . D SET(8,ORPROCES) ; update process currently on
"RTN","OR3CONV",71,0)
 . D @ORPROCES Q:ORSTOP
"RTN","OR3CONV",72,0)
 . S ORPROCES=ORPROCES+1
"RTN","OR3CONV",73,0)
 I ORSTOP D SET(10,"") ; delete out task job
"RTN","OR3CONV",74,0)
 Q
"RTN","OR3CONV",75,0)
 ;
"RTN","OR3CONV",76,0)
0 ; populate list of patients to convert
"RTN","OR3CONV",77,0)
 I '$D(ORESTART) D SET(1,0)
"RTN","OR3CONV",78,0)
 D PTCONV^OR3CONV1
"RTN","OR3CONV",79,0)
 Q
"RTN","OR3CONV",80,0)
 ;
"RTN","OR3CONV",81,0)
1 ; order conversion for inpatients
"RTN","OR3CONV",82,0)
 N DFN,ORWARD,X
"RTN","OR3CONV",83,0)
 S ORWARD=$S($D(ORESTART):ORESTART,1:"") K ORESTART
"RTN","OR3CONV",84,0)
 F  S ORWARD=$O(^DPT("CN",ORWARD)) Q:ORWARD']""!ORSTOP  D
"RTN","OR3CONV",85,0)
 . D SET(4,ORWARD)
"RTN","OR3CONV",86,0)
 . F DFN=0:0 S DFN=$O(^DPT("CN",ORWARD,DFN)) Q:'DFN!ORSTOP  D
"RTN","OR3CONV",87,0)
 . . D SET(5,DFN)
"RTN","OR3CONV",88,0)
 . . S X=$$CONVERT(DFN,1)
"RTN","OR3CONV",89,0)
 . D SET(9,ORWARD)
"RTN","OR3CONV",90,0)
 D SET(3,$$NOW^XLFDT())
"RTN","OR3CONV",91,0)
 Q
"RTN","OR3CONV",92,0)
 ;
"RTN","OR3CONV",93,0)
 ;
"RTN","OR3CONV",94,0)
2 ; patients with future scheduled admissions
"RTN","OR3CONV",95,0)
 N ORDATE,ORIEN,X
"RTN","OR3CONV",96,0)
 S ORDATE=$S($G(ORESTART):ORESTART,1:$$NOW^XLFDT()) K ORESTART
"RTN","OR3CONV",97,0)
 F  S ORDATE=$O(^DGS(41.1,"C",ORDATE)) Q:'ORDATE!ORSTOP  D
"RTN","OR3CONV",98,0)
 . F ORIEN=0:0 S ORIEN=$O(^DGS(41.1,"C",ORDATE,ORIEN)) Q:'ORIEN!ORSTOP  D
"RTN","OR3CONV",99,0)
 . . S X=$G(^DGS(41.1,ORIEN,0))
"RTN","OR3CONV",100,0)
 . . I X']"" Q
"RTN","OR3CONV",101,0)
 . . S X=$$CONVERT(+X,1)
"RTN","OR3CONV",102,0)
 . . D SET(9,ORDATE)
"RTN","OR3CONV",103,0)
 Q
"RTN","OR3CONV",104,0)
 ;
"RTN","OR3CONV",105,0)
 ;
"RTN","OR3CONV",106,0)
3 ; patients on waiting list
"RTN","OR3CONV",107,0)
 N DFN,ORIEN,ORIEN1,ORFLAG,X
"RTN","OR3CONV",108,0)
 S DFN=+$G(ORESTART) K ORESTART
"RTN","OR3CONV",109,0)
 F  S DFN=$O(^DGWAIT("C",DFN)) Q:'DFN!ORSTOP  D
"RTN","OR3CONV",110,0)
 . S ORFLAG=0
"RTN","OR3CONV",111,0)
 . F ORIEN=0:0 S ORIEN=$O(^DGWAIT("C",DFN,ORIEN)) Q:'ORIEN  D  Q:ORFLAG
"RTN","OR3CONV",112,0)
 . . F ORIEN1=0:0 S ORIEN1=$O(^DGWAIT("C",DFN,ORIEN,ORIEN1)) Q:'ORIEN1  D
"RTN","OR3CONV",113,0)
 . . . I $G(^DGWAIT(ORIEN,"P",ORIEN1,"ADM")) Q  ; no longer active
"RTN","OR3CONV",114,0)
 . . . S X=$$CONVERT(DFN,1),ORFLAG=1
"RTN","OR3CONV",115,0)
 . . . D SET(9,DFN)
"RTN","OR3CONV",116,0)
 Q
"RTN","OR3CONV",117,0)
 ;
"RTN","OR3CONV",118,0)
 ;
"RTN","OR3CONV",119,0)
4 ; patients with discharges in last 4 weeks
"RTN","OR3CONV",120,0)
 N DFN,ORDISCH,X
"RTN","OR3CONV",121,0)
 S ORDISCH=$S($G(ORESTART):ORESTART,1:$$FMADD^XLFDT(DT,-29)) K ORESTART
"RTN","OR3CONV",122,0)
 F  S ORDISCH=$O(^DGPM("AMV3",ORDISCH)) Q:'ORDISCH!(ORDISCH>DT)!ORSTOP  D
"RTN","OR3CONV",123,0)
 . F DFN=0:0 S DFN=$O(^DGPM("AMV3",ORDISCH,DFN)) Q:'DFN  D
"RTN","OR3CONV",124,0)
 . . S X=$$CONVERT(DFN,1)
"RTN","OR3CONV",125,0)
 . . D SET(9,ORDISCH)
"RTN","OR3CONV",126,0)
 Q
"RTN","OR3CONV",127,0)
 ;
"RTN","OR3CONV",128,0)
 ;
"RTN","OR3CONV",129,0)
5 ; patients with appointments past 4 weeks through next 4 weeks
"RTN","OR3CONV",130,0)
 ; this call is no longer used
"RTN","OR3CONV",131,0)
 N DFN,OREND,ORERR,ORI,ORLOC,ORSTART,X
"RTN","OR3CONV",132,0)
 S ORSTART=$$FMADD^XLFDT(DT,-29),OREND=$$FMADD^XLFDT(DT,+29)
"RTN","OR3CONV",133,0)
 S ORLOC=+$G(ORESTART) K ORESTART
"RTN","OR3CONV",134,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","OR3CONV",135,0)
 F  S ORLOC=$O(^SC(ORLOC)) Q:'ORLOC!ORSTOP  D
"RTN","OR3CONV",136,0)
 . D GETPLIST^SDAMA202(ORLOC,"4","",ORSTART,OREND)
"RTN","OR3CONV",137,0)
 . S ORERR=$$CLINERR^ORQRY01
"RTN","OR3CONV",138,0)
 . I $L(ORERR) W !,ORERR S ORSTOP=1 Q
"RTN","OR3CONV",139,0)
 . S ORI=0
"RTN","OR3CONV",140,0)
 . F  S ORI=$O(^TMP($J,"SDAMA202","GETPLIST",ORI)) Q:ORI<1  D
"RTN","OR3CONV",141,0)
 .. S DFN=+$G(^TMP($J,"SDAMA202","GETPLIST",ORI,4))
"RTN","OR3CONV",142,0)
 .. I DFN S X=$$CONVERT(DFN,1)
"RTN","OR3CONV",143,0)
 . D SET(9,ORLOC)
"RTN","OR3CONV",144,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","OR3CONV",145,0)
 Q
"RTN","OR3CONV",146,0)
 ;
"RTN","OR3CONV",147,0)
 ;
"RTN","OR3CONV",148,0)
6 ; rest of patients
"RTN","OR3CONV",149,0)
 N DFN,X
"RTN","OR3CONV",150,0)
 S DFN=+$G(ORESTART) K ORESTART
"RTN","OR3CONV",151,0)
 F  S DFN=$O(^ORD(100.99,1,"PTCONV",DFN)) Q:'DFN!ORSTOP  D
"RTN","OR3CONV",152,0)
 . S X=$$CONVERT(DFN,1)
"RTN","OR3CONV",153,0)
 . D SET(9,DFN)
"RTN","OR3CONV",154,0)
 Q
"RTN","OR3CONV",155,0)
 ;
"RTN","OR3CONV",156,0)
 ;
"RTN","OR3CONV",157,0)
7 ; orders not associated with DPT entries
"RTN","OR3CONV",158,0)
 N ORVP
"RTN","OR3CONV",159,0)
 S ORVP=$S($G(ORESTART):ORESTART,1:"") K ORESTART
"RTN","OR3CONV",160,0)
 F  S ORVP=$O(^OR(100,"AO",ORVP)) Q:ORVP=""!ORSTOP  D
"RTN","OR3CONV",161,0)
 . D ORDERS^OR3C100(ORVP)
"RTN","OR3CONV",162,0)
 . D EN^LR7OV2(ORVP,0)
"RTN","OR3CONV",163,0)
 I ORSTOP Q
"RTN","OR3CONV",164,0)
 D SET(7,$$NOW^XLFDT())
"RTN","OR3CONV",165,0)
 D CLEANUP^OR3CONV1
"RTN","OR3CONV",166,0)
 Q
"RTN","OR3CONV",167,0)
 ;
"RTN","OR3CONV",168,0)
 ;
"RTN","OR3CONV",169,0)
OTF(DFN,ORQUIET) ; on-the-fly conversion
"RTN","OR3CONV",170,0)
 ;
"RTN","OR3CONV",171,0)
 ; *** Supported entry point for package to call to see if orders  ***
"RTN","OR3CONV",172,0)
 ; *** for patient have been converted and convert if not done yet ***
"RTN","OR3CONV",173,0)
 ;
"RTN","OR3CONV",174,0)
 ; Input:   DFN as IEN of PATIENT file entry to convert orders for
"RTN","OR3CONV",175,0)
 ;          ORQUIET as 1 conversion should be silent
"RTN","OR3CONV",176,0)
 ;
"RTN","OR3CONV",177,0)
 ; Output:  -1^error message if problem encountered
"RTN","OR3CONV",178,0)
 ;          0 if patient already converted prior to call
"RTN","OR3CONV",179,0)
 ;          1 if patient was successfully converted as part of call
"RTN","OR3CONV",180,0)
 ;
"RTN","OR3CONV",181,0)
 S DFN=$G(DFN),ORQUIET=+$G(ORQUIET)
"RTN","OR3CONV",182,0)
 I $$ALLDONE() Q 0                 ; conversion already complete
"RTN","OR3CONV",183,0)
 I DFN'=+DFN!'$D(^DPT(+DFN,0)) Q "-1^Error in DFN passed to OTF^OR3CONV"
"RTN","OR3CONV",184,0)
 Q $$CONVERT(DFN,ORQUIET,1)        ; convert orders for patient
"RTN","OR3CONV",185,0)
 ;
"RTN","OR3CONV",186,0)
 ;
"RTN","OR3CONV",187,0)
CONVERT(DFN,ORQUIET,OROTF) ; convert orders by patient, set flag when done
"RTN","OR3CONV",188,0)
 ;
"RTN","OR3CONV",189,0)
 ; Input  - DFN as IEN of PATIENT file
"RTN","OR3CONV",190,0)
 ;          ORQUIET as 1 if conversion to be quiet
"RTN","OR3CONV",191,0)
 ;          OROTF as 1 if conversion called on-the-fly
"RTN","OR3CONV",192,0)
 ; Output - -1^error message if problem encountered
"RTN","OR3CONV",193,0)
 ;          1 if patient successfully converted
"RTN","OR3CONV",194,0)
 ;
"RTN","OR3CONV",195,0)
 ; new variables from bgj calls to ensure not reset during conv calls
"RTN","OR3CONV",196,0)
 N ORDATE,ORDATE,ORDISCH,OREND,ORIEN,ORIEN1,ORLOC,ORPROCES,ORSTART,ORWARD
"RTN","OR3CONV",197,0)
 ;
"RTN","OR3CONV",198,0)
 N ORERRMSG,ORPTLK,ORVP
"RTN","OR3CONV",199,0)
 S ORVP=DFN_";DPT("
"RTN","OR3CONV",200,0)
 S OROTF=+$G(OROTF)
"RTN","OR3CONV",201,0)
 I 'OROTF,$$STOP() D               ; field set to request stop of bgj
"RTN","OR3CONV",202,0)
 . S ORSTOP=1
"RTN","OR3CONV",203,0)
 . D SET(10,"")
"RTN","OR3CONV",204,0)
 I $$PTDONE(DFN) Q 0               ; patient already converted
"RTN","OR3CONV",205,0)
 S ORPTLK=$$LOCK^ORX2(DFN)
"RTN","OR3CONV",206,0)
 I 'ORPTLK D  Q ORERRMSG           ; record is locked
"RTN","OR3CONV",207,0)
 . I 'ORQUIET W !!,$P(ORPTLK,U,2) H 1
"RTN","OR3CONV",208,0)
 . S ORERRMSG="-1^"_$P(ORPTLK,U,2)
"RTN","OR3CONV",209,0)
 ;
"RTN","OR3CONV",210,0)
 I $$ORCONV(ORVP) D
"RTN","OR3CONV",211,0)
 . N DFN
"RTN","OR3CONV",212,0)
 . I 'ORQUIET D WRITE(+ORVP,"OE/RR")
"RTN","OR3CONV",213,0)
 . D ORDERS^OR3C100(ORVP)
"RTN","OR3CONV",214,0)
 I $$PSCONV(DFN) D
"RTN","OR3CONV",215,0)
 . I 'ORQUIET D WRITE(DFN,"pharmacy")
"RTN","OR3CONV",216,0)
 . D EN1^PSOHLUP(+DFN,'ORQUIET)
"RTN","OR3CONV",217,0)
 I $$LRCONV() D
"RTN","OR3CONV",218,0)
 . N DFN
"RTN","OR3CONV",219,0)
 . I 'ORQUIET D WRITE(+ORVP,"lab")
"RTN","OR3CONV",220,0)
 . D EN^LR7OV2(ORVP,'ORQUIET)
"RTN","OR3CONV",221,0)
 D UNLOCK^ORX2(+DFN)
"RTN","OR3CONV",222,0)
 D DONE(DFN)
"RTN","OR3CONV",223,0)
 Q 1
"RTN","OR3CONV",224,0)
 ;
"RTN","OR3CONV",225,0)
ORCONV(ORVP) ; return 1 if OR orders need to be converted, otherwise 0
"RTN","OR3CONV",226,0)
 I $O(^OR(100,"AO",ORVP,0)) Q 1
"RTN","OR3CONV",227,0)
 Q 0
"RTN","OR3CONV",228,0)
 ;
"RTN","OR3CONV",229,0)
PSCONV(DFN) ; return 1 to convert pharmacy orders for patient, otherwise 0
"RTN","OR3CONV",230,0)
 I $P($G(^PS(55,DFN,0)),U,6)'=2!'$P($G(^(5.1)),U,11) Q 1
"RTN","OR3CONV",231,0)
 Q 0
"RTN","OR3CONV",232,0)
 ;
"RTN","OR3CONV",233,0)
LRCONV() ; return 1 to convert
"RTN","OR3CONV",234,0)
 Q 1
"RTN","OR3CONV",235,0)
 ;
"RTN","OR3CONV",236,0)
WRITE(DFN,TYPE) ; write converting message
"RTN","OR3CONV",237,0)
 W !,"Converting ",TYPE," orders for ",$P($G(^DPT(DFN,0)),"^",1)
"RTN","OR3CONV",238,0)
 Q
"RTN","OR3CONV",239,0)
 ;
"RTN","OR3CONV",240,0)
ALLDONE() ; return 1 if conversion done, otherwise 0
"RTN","OR3CONV",241,0)
 Q $G(^ORD(100.99,1,"CONV"))
"RTN","OR3CONV",242,0)
 ;
"RTN","OR3CONV",243,0)
PTDONE(DFN) ; return 1 if patient already converted or PTCONV mult not done
"RTN","OR3CONV",244,0)
 I $D(^ORD(100.99,1,"PTCONV",DFN)) Q 0
"RTN","OR3CONV",245,0)
 I +$P($G(^ORD(100.99,1,"CONV")),"^",8)=0 Q 0
"RTN","OR3CONV",246,0)
 Q 1
"RTN","OR3CONV",247,0)
 ;
"RTN","OR3CONV",248,0)
STOP() ; check stop conversion flag
"RTN","OR3CONV",249,0)
 Q $P($G(^ORD(100.99,1,"CONV")),"^",11)
"RTN","OR3CONV",250,0)
 ;
"RTN","OR3CONV",251,0)
SET(PIECE,VALUE) ; update order parameter file field with value
"RTN","OR3CONV",252,0)
 N X
"RTN","OR3CONV",253,0)
 S X=$G(^ORD(100.99,1,"CONV"))
"RTN","OR3CONV",254,0)
 S $P(X,"^",PIECE)=VALUE
"RTN","OR3CONV",255,0)
 I PIECE=1 S $P(X,"^",2)=$$NOW^XLFDT()
"RTN","OR3CONV",256,0)
 I PIECE=3 S $P(X,"^",4,5)="^"
"RTN","OR3CONV",257,0)
 I PIECE=7 S $P(X,"^",1)=1,$P(X,"^",8,10)="^^"
"RTN","OR3CONV",258,0)
 I PIECE=8 S $P(X,"^",9)=""
"RTN","OR3CONV",259,0)
 S ^ORD(100.99,1,"CONV")=X
"RTN","OR3CONV",260,0)
 Q
"RTN","OR3CONV",261,0)
 ;
"RTN","OR3CONV",262,0)
DONE(DFN) ; remove entry from multiple
"RTN","OR3CONV",263,0)
 N COUNT,NODE,LAST,X
"RTN","OR3CONV",264,0)
 S X=$G(^ORD(100.99,1,"PTCONV",0)) Q:X']""  ; not done step 0
"RTN","OR3CONV",265,0)
 K ^ORD(100.99,1,"PTCONV",DFN),^ORD(100.99,1,"PTCONV","B",DFN)
"RTN","OR3CONV",266,0)
LOCK L +^ORD(100.99,1,"PTCONV",0):5 I '$T G LOCK
"RTN","OR3CONV",267,0)
 S COUNT=$P(X,"^",4)-1,LAST=$O(^ORD(100.99,1,"PTCONV","A"),-1)
"RTN","OR3CONV",268,0)
 S $P(^ORD(100.99,1,"PTCONV",0),"^",3,4)=LAST_"^"_$S(COUNT>0:COUNT,1:0)
"RTN","OR3CONV",269,0)
 L -^ORD(100.99,1,"PTCONV",0)
"RTN","OR3CONV",270,0)
 S $P(^("CONV"),"^",12)=$P(^ORD(100.99,1,"CONV"),"^",12)+1
"RTN","OR3CONV",271,0)
 Q
"RTN","ORPR01")
0^17^B19254955^B18351453
"RTN","ORPR01",1,0)
ORPR01 ; slc/dcm/rv - Some day my prints will come ;09/13/06  13:30
"RTN","ORPR01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**11,69,92,260**;Dec 17, 1997;Build 26
"RTN","ORPR01",3,0)
LBL ;Print Labels
"RTN","ORPR01",4,0)
 W !,"Print how many labels? 1// "
"RTN","ORPR01",5,0)
 R X:DTIME
"RTN","ORPR01",6,0)
 S:X="" X=1
"RTN","ORPR01",7,0)
 Q:X["^"
"RTN","ORPR01",8,0)
 I X'?1N.N!(X>10!(X<1)) W !,"Enter a number between 1 and 10" G LBL
"RTN","ORPR01",9,0)
 D P2("L",X)
"RTN","ORPR01",10,0)
 Q
"RTN","ORPR01",11,0)
LBL1(SNUM,ORTIMES) ;
"RTN","ORPR01",12,0)
 ;SNUM=1 to suppress form feed, passed to PRINT^ORPR00
"RTN","ORPR01",13,0)
 ;ORTIMES=# of copies
"RTN","ORPR01",14,0)
 N ORX,OR3,ORPK,ORTCNT,ORPKG
"RTN","ORPR01",15,0)
 D GET(ORIFN),R1(3,$G(ORTIMES))
"RTN","ORPR01",16,0)
 Q
"RTN","ORPR01",17,0)
CHT ;Print Chart copies
"RTN","ORPR01",18,0)
 I '$L(ORL) N OR4 S OR4="" D LOC^ORUTL I +$G(OREND) S OREND="" Q
"RTN","ORPR01",19,0)
 D P2("C")
"RTN","ORPR01",20,0)
 Q
"RTN","ORPR01",21,0)
WRK ;Print Work copies
"RTN","ORPR01",22,0)
 I '$L(ORL) N OR4 S OR4="" D LOC^ORUTL I +$G(OREND) S OREND="" Q
"RTN","ORPR01",23,0)
 D P2("W")
"RTN","ORPR01",24,0)
 Q
"RTN","ORPR01",25,0)
SRV ;Print Service copies
"RTN","ORPR01",26,0)
 D P2("S")
"RTN","ORPR01",27,0)
 Q
"RTN","ORPR01",28,0)
REQ ;Print Requisitions
"RTN","ORPR01",29,0)
 D P2("R")
"RTN","ORPR01",30,0)
 Q
"RTN","ORPR01",31,0)
REQ1(SNUM,ORSCREEN) ;
"RTN","ORPR01",32,0)
 ;SNUM=1 to suppress form feed, passed to PRINT^ORPR00
"RTN","ORPR01",33,0)
 N ORX,OR3,ORPK,ORTCNT,ORPKG
"RTN","ORPR01",34,0)
 D GET(ORIFN),R1(4,,$G(ORSCREEN))
"RTN","ORPR01",35,0)
 Q
"RTN","ORPR01",36,0)
R1(PIECE,ORTIMES,ORSCREEN) ;
"RTN","ORPR01",37,0)
 ;PIECE=4 for requisitions
"RTN","ORPR01",38,0)
 ;PIECE=3 for labels
"RTN","ORPR01",39,0)
 ;ORTIMES=# of copies
"RTN","ORPR01",40,0)
 ;ORSCREEN=Mumps screen to pass to PRINT^ORPR00
"RTN","ORPR01",41,0)
 N P,ORFMT,ORIGVIEW,ORDLG
"RTN","ORPR01",42,0)
 Q:'$G(PIECE)
"RTN","ORPR01",43,0)
 S P=$P(ORX,"^",14),ORDLG=+$P(ORX,"^",5)
"RTN","ORPR01",44,0)
 I 'P Q
"RTN","ORPR01",45,0)
 S ORIGVIEW=1,ORFMT=$$GET^XPAR("SYS",$S(PIECE=3:"ORPF WARD LABEL FORMAT",PIECE=4:"ORPF WARD REQUISITION FORMAT",1:""),P,"I")
"RTN","ORPR01",46,0)
 I PIECE=4,(P=$O(^DIC(9.4,"B","DIETETICS",0))),(ORDLG'=$O(^ORD(101.41,"B","FHW SPECIAL MEAL",0))) S ORFMT=0
"RTN","ORPR01",47,0)
 I ORFMT<1 W !?2,$C(7),"Cannot print",!?2,$S(PIECE=3:"Labels",PIECE=4:"Requisitions",1:"")_" not set up for orders in the "_$P(^DIC(9.4,P,0),"^")_" package." D READ^ORUTL Q
"RTN","ORPR01",48,0)
 D CPRINT(ORIFN,$G(ORTIMES),$G(ORSCREEN))
"RTN","ORPR01",49,0)
 Q
"RTN","ORPR01",50,0)
CPRINT(ORIFN,ORTIMES,ORSCREEN) ; Printit
"RTN","ORPR01",51,0)
 N X
"RTN","ORPR01",52,0)
 I +$G(ORFMT)'>0 Q
"RTN","ORPR01",53,0)
 I $G(ORTCNT) D
"RTN","ORPR01",54,0)
 . I $P($G(^ORD(100.23,ORFMT,0)),"^",4) S ORTCNT=ORTCNT\$P(^(0),"^",4)+1 Q
"RTN","ORPR01",55,0)
 . S ORTCNT=ORTCNT\75+1
"RTN","ORPR01",56,0)
 S X=($P(^ORD(100.23,ORFMT,0),"^",2)+$P($G(^OR(100,+ORIFN,2,0)),U,4))
"RTN","ORPR01",57,0)
 I '$G(ORFIRST1),($Y+X+$S($G(ORTCNT)>0:ORTCNT-1,1:0)>(ORIOSL-3)) D  Q:+$G(OREND)
"RTN","ORPR01",58,0)
 . I $G(ORFOOT) D FOOT(ORFOOT)
"RTN","ORPR01",59,0)
 . I $G(ORHEAD) D HEAD(ORHEAD)
"RTN","ORPR01",60,0)
 . I '$G(ORHEAD),'$G(ORFOOT) W @ORIOF
"RTN","ORPR01",61,0)
 D PRINT^ORPR00(ORFMT,$S($G(ORTIMES):ORTIMES,1:1),0,$G(SNUM),$G(ORSCREEN))
"RTN","ORPR01",62,0)
 Q
"RTN","ORPR01",63,0)
HEAD(FMT) ;
"RTN","ORPR01",64,0)
 Q:+$G(OREND)
"RTN","ORPR01",65,0)
 S IOF=ORIOF
"RTN","ORPR01",66,0)
 D PRINT^ORPR00(FMT,1)
"RTN","ORPR01",67,0)
 S IOF="!"
"RTN","ORPR01",68,0)
 Q
"RTN","ORPR01",69,0)
FOOT(FMT) ; Print Footer
"RTN","ORPR01",70,0)
 Q:+$G(OREND)
"RTN","ORPR01",71,0)
 S:IOF?1"!"."!" $P(IOF,"!",$S(ORIOSL>200:200,ORIOSL-$Y>1:ORIOSL-$Y,1:2))=""
"RTN","ORPR01",72,0)
 D PRINT^ORPR00(FMT,1)
"RTN","ORPR01",73,0)
 I $E(IOST)="C" D
"RTN","ORPR01",74,0)
 . N DIR
"RTN","ORPR01",75,0)
 . S DIR(0)="FO^1:1",DIR("A")="Press RETURN to continue or '^' to exit"
"RTN","ORPR01",76,0)
 . S DIR("?")="Enter '^' to quit present report or '^^' to quit to menu"
"RTN","ORPR01",77,0)
 . D ^DIR
"RTN","ORPR01",78,0)
 . I $S($D(DIROUT):1,$D(DUOUT):1,$D(DTOUT):1,1:0) S OREND=1
"RTN","ORPR01",79,0)
 S IOF=ORIOF
"RTN","ORPR01",80,0)
 Q
"RTN","ORPR01",81,0)
GET(ORIFN) ;Get stuff
"RTN","ORPR01",82,0)
 N I,ORTX,X
"RTN","ORPR01",83,0)
 S ORX=^OR(100,ORIFN,0),OR3=$G(^(3)),ORPK=$G(^(4)),ORPKG=$P(ORX,"^",14)
"RTN","ORPR01",84,0)
 S ORTCNT=0,I=0
"RTN","ORPR01",85,0)
 D TEXT^ORQ12(.ORTX,ORIFN) F  S I=$O(ORTX(I)) Q:I<1  S X=ORTX(I),ORTCNT=ORTCNT+$L(X)
"RTN","ORPR01",86,0)
 Q
"RTN","ORPR01",87,0)
P2(REPORT,ORTIMES) ;Sort 'n print
"RTN","ORPR01",88,0)
 ;REPORT=type of report (L=labels, R=requisitions, S=service copies,
"RTN","ORPR01",89,0)
 ;                       C=chart copies, W=work copies)
"RTN","ORPR01",90,0)
 ;ORTIMES=# of copies
"RTN","ORPR01",91,0)
 Q:'$L($G(REPORT))
"RTN","ORPR01",92,0)
 N NQUE
"RTN","ORPR01",93,0)
 S NQUE=$S(REPORT="S":1,1:""),REPORT=$S(REPORT="C":"1^^^^",REPORT="L":"^1^^^",REPORT="R":"^^1^^",REPORT="S":"^^^1^",REPORT="W":"^^^^1",1:"")
"RTN","ORPR01",94,0)
 Q:'$L(REPORT)
"RTN","ORPR01",95,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("jive") I 'ORNMBR S VALMBCK="" Q
"RTN","ORPR01",96,0)
 Q:'$O(^TMP("OR",$J,"CURRENT","IDX",0))
"RTN","ORPR01",97,0)
 N ORAL,ORIFN,ORSEQ,OACTION,ORIDX
"RTN","ORPR01",98,0)
 K ^TMP("OREPRINT",$J)
"RTN","ORPR01",99,0)
 D FULL^VALM1
"RTN","ORPR01",100,0)
 S VALMBCK="R"
"RTN","ORPR01",101,0)
 F ORIDX=1:1:($L(ORNMBR,",")-1) S ORSEQ=$P(ORNMBR,",",ORIDX) Q:+$G(OREND)  D
"RTN","ORPR01",102,0)
 . I +ORSEQ>0,$D(^TMP("OR",$J,"CURRENT","IDX",ORSEQ)) S ORIFN=+^TMP("OR",$J,"CURRENT","IDX",ORSEQ),OACTION=$P($P(^(ORSEQ),"^"),";",2),^TMP("OREPRINT",$J,ORIDX)=ORIFN_";"_OACTION
"RTN","ORPR01",103,0)
 I $O(^TMP("OREPRINT",$J,0)) D PRINT^ORPR02(ORVP,"^TMP(""OREPRINT"",$J)",,ORL,REPORT,"1^^^^1^1^1",NQUE,$G(ORTIMES))
"RTN","ORPR01",104,0)
 K ^TMP("OREPRINT",$J)
"RTN","ORPR01",105,0)
 Q
"RTN","ORPR02")
0^18^B43219777^B41253517
"RTN","ORPR02",1,0)
ORPR02 ; slc/dcm/rv - Dances with Prints ;09/13/06  13:30
"RTN","ORPR02",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**11,260**;Dec 17, 1997;Build 26
"RTN","ORPR02",3,0)
PRINT(ORVP,ARAY,SARAY,LOC,SELECT,ALTPRAM,NOQUE,ORTIMES) ;Decisions
"RTN","ORPR02",4,0)
 ;ORVP=DFN;DPT(
"RTN","ORPR02",5,0)
 ;ARAY=Name of global storing list of orders or just the local aray
"RTN","ORPR02",6,0)
 ;@ARAY@(#)=ORIFN;DA of action       - Array of orders to print
"RTN","ORPR02",7,0)
 ;SARAY(PKG,ORIFN)=Device ptr^# of copies  (used by Consults service copies)
"RTN","ORPR02",8,0)
 ;LOC=Location (ORL)
"RTN","ORPR02",9,0)
 ;SELECT=Set for desired reports (chart^label^req^service^work)
"RTN","ORPR02",10,0)
 ;ALTPRAM=Alternate for PARAM variable (overrides internal parameters):
"RTN","ORPR02",11,0)
 ;        PROMPT CC^CC DEVICE^L DEVICE^R DEVICE^PROMPT L^PROMPT R^PROMPT W^W DEVICE
"RTN","ORPR02",12,0)
 ;NOQUE=1 to force interactive device selection; used for service copies
"RTN","ORPR02",13,0)
 ;ORTIMES=# of copies
"RTN","ORPR02",14,0)
 N PARAM,IFN,ORPARAY,VAR
"RTN","ORPR02",15,0)
 S ORPARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",16,0)
 I '$G(ORVP) S ORVP=$$PAT(.ARAY) I '$G(ORVP) S VAR("ARAY")="" D EN^ORERR("PRINT~ORPR02 called with invalid ORVP",,.VAR) G END
"RTN","ORPR02",17,0)
 I '$L($G(LOC)) S LOC=$$LOC(.ARAY) I 'LOC S VAR("ARAY")="" D EN^ORERR("PRINT~ORPR02 called with invalid LOC",,.VAR) G END
"RTN","ORPR02",18,0)
 I $S('$O(@ORPARAY@(0)):1,+$G(LOC)'>0:1,1:0),'$D(SARAY) G END
"RTN","ORPR02",19,0)
 N ORAL,ORIFN
"RTN","ORPR02",20,0)
 K ^TMP("ORAL",$J)
"RTN","ORPR02",21,0)
 S PARAM=$S($L($G(ALTPRAM)):ALTPRAM,1:""),ORAL="^TMP(""ORAL"",$J)"
"RTN","ORPR02",22,0)
 D:'$L($G(ALTPRAM)) PARAM($G(LOC))
"RTN","ORPR02",23,0)
 D ARAY(.ARAY)
"RTN","ORPR02",24,0)
 I '$D(SELECT) D CHART(.ARAY,PARAM),LABEL(.ORAL,PARAM,$G(ORTIMES)),REQ(.ORAL,PARAM),SERV(.ORAL,PARAM,.SARAY,$G(NOQUE)),WORK(.ARAY,PARAM) G END
"RTN","ORPR02",25,0)
 I $D(SELECT) D CHART(.ARAY,PARAM):$P(SELECT,"^"),LABEL(.ORAL,PARAM,$G(ORTIMES)):$P(SELECT,"^",2),REQ(.ORAL,PARAM):$P(SELECT,"^",3),SERV(.ORAL,PARAM,.SARAY,$G(NOQUE)):$P(SELECT,"^",4),WORK(.ARAY,PARAM):$P(SELECT,"^",5)
"RTN","ORPR02",26,0)
 G END
"RTN","ORPR02",27,0)
CHART(ARAY,PARAM) ;Chart copies
"RTN","ORPR02",28,0)
 ;ARAY=Array of orders to print
"RTN","ORPR02",29,0)
 ;PARAM=Print parameters based on location
"RTN","ORPR02",30,0)
 S ARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",31,0)
 I $L($P(PARAM,"^"))!($L($P(PARAM,"^",2))) S X=$$DEVICE($P(PARAM,"^")_"^CHART COPY",$P(PARAM,"^",2),"C1^ORPR03")
"RTN","ORPR02",32,0)
 Q
"RTN","ORPR02",33,0)
WORK(ARAY,PARAM) ;Work Copy
"RTN","ORPR02",34,0)
 S ARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",35,0)
 I $L($P(PARAM,"^",7))!($L($P(PARAM,"^",8))) S X=$$DEVICE($P(PARAM,"^",7)_"^WORK COPY",$P(PARAM,"^",8),"W1^ORPR03")
"RTN","ORPR02",36,0)
 Q
"RTN","ORPR02",37,0)
LABEL(ARAY,PARAM,ORTIMES) ;Labels
"RTN","ORPR02",38,0)
 N ORPLF,ORTKG,ORPRMT
"RTN","ORPR02",39,0)
 S ARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",40,0)
 I $L($P(PARAM,"^",3))!$L($P(PARAM,"^",5)) D
"RTN","ORPR02",41,0)
 . S (ORPLF,ORTKG)=0
"RTN","ORPR02",42,0)
 . I $O(@ARAY@(0)) F  S ORTKG=$O(@ARAY@(ORTKG)) Q:ORTKG'>0!(ORPLF)  D
"RTN","ORPR02",43,0)
 .. S ORPLF=$S($$GET^XPAR("SYS","ORPF WARD LABEL FORMAT",ORTKG,"I"):1,1:0)
"RTN","ORPR02",44,0)
 . S ORPRMT=$S(ORPLF:$P(PARAM,"^",5),1:"*")_"^LABELS"
"RTN","ORPR02",45,0)
 . S X=$$DEVICE(ORPRMT,$P(PARAM,"^",3),"L1^ORPR03",$G(ORTIMES))
"RTN","ORPR02",46,0)
 Q
"RTN","ORPR02",47,0)
REQ(ARAY,PARAM) ;Requisitions
"RTN","ORPR02",48,0)
 N ORPLF,ORTKG,ORPRMT,ORIFN,ORDLG
"RTN","ORPR02",49,0)
 S ARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",50,0)
 I $L($P(PARAM,"^",4))!$L($P(PARAM,"^",6)) D
"RTN","ORPR02",51,0)
 . S (ORPLF,ORTKG)=0
"RTN","ORPR02",52,0)
 . I $O(@ARAY@(0)) F  S ORTKG=$O(@ARAY@(ORTKG)) Q:ORTKG'>0!(ORPLF)  D
"RTN","ORPR02",53,0)
 .. S ORPLF=$S($$GET^XPAR("SYS","ORPF WARD REQUISITION FORMAT",ORTKG,"I"):1,1:0)
"RTN","ORPR02",54,0)
 .. I ORTKG=$O(^DIC(9.4,"B","DIETETICS",0)) D
"RTN","ORPR02",55,0)
 ... S ORIFN=0 F  S ORIFN=$O(@ARAY@(ORTKG,ORIFN)) Q:'ORIFN  D
"RTN","ORPR02",56,0)
 .... S ORDLG=+$P(^OR(100,+ORIFN,0),U,5)
"RTN","ORPR02",57,0)
 .... I ORDLG'=$O(^ORD(101.41,"B","FHW SPECIAL MEAL",0)) S ORPLF=0
"RTN","ORPR02",58,0)
 . S ORPRMT=$S(ORPLF:$P(PARAM,"^",6),1:"*")_"^REQUISITIONS"
"RTN","ORPR02",59,0)
 . S X=$$DEVICE(ORPRMT,$P(PARAM,"^",4),"R1^ORPR03")
"RTN","ORPR02",60,0)
 Q
"RTN","ORPR02",61,0)
SERV(ARAY,PARAM,SARAY,NOQUE) ;Service copies
"RTN","ORPR02",62,0)
 N ZTRTN,ZTSAVE,ZTIO,ZTDTH,ZTSK,GLOB
"RTN","ORPR02",63,0)
 S ARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",64,0)
 S GLOB=$S($E(ARAY)="^":$E(ARAY,1,$L(ARAY)-1)_",",1:ARAY_"(")
"RTN","ORPR02",65,0)
 I $O(@ARAY@(0)) D
"RTN","ORPR02",66,0)
 . I $G(NOQUE)'=1 D  Q
"RTN","ORPR02",67,0)
 .. S ZTRTN="SVCOPY^ORPR03()",(ZTSAVE("CHART"),ZTSAVE("ORVP"),ZTSAVE("ARAY"),ZTSAVE(GLOB),ZTSAVE("PARAM"),ZTSAVE("SARAY("),ZTSAVE("ORPRES"),ZTSAVE("LOC"),ZTSAVE("LOC("),ZTIO)="",ZTDTH=$H
"RTN","ORPR02",68,0)
 .. S ZTDESC="Service copy root task" D ^%ZTLOAD
"RTN","ORPR02",69,0)
 . D SVCOPY^ORPR03(1)
"RTN","ORPR02",70,0)
 Q
"RTN","ORPR02",71,0)
END ;Leave
"RTN","ORPR02",72,0)
 D HOME^%ZIS
"RTN","ORPR02",73,0)
 Q
"RTN","ORPR02",74,0)
DEVICE(PRMT,DEF,ZTRTN,ORTIMES) ; Gets device for output
"RTN","ORPR02",75,0)
 ;PRMT=Prompt?^Report name
"RTN","ORPR02",76,0)
 ;DEF=Print device
"RTN","ORPR02",77,0)
 ;ZTRTN=Routine
"RTN","ORPR02",78,0)
 ;ORTIMES=# of copies
"RTN","ORPR02",79,0)
 N %ZIS,DIC,DIR,IOP,FORCEQUE,X,Y,ZTIO,ZTDESC,ZTDTH,OREND,GLOB,ORIOPTR,ORION
"RTN","ORPR02",80,0)
 I $P(PRMT,"^")="*" Q 1
"RTN","ORPR02",81,0)
 I $P(PRMT,"^")=0,'$G(DEF) Q 1
"RTN","ORPR02",82,0)
 I +PRMT S DIR("A")="Print "_$P(PRMT,"^",2)_" for the orders: ",DIR("B")="YES",DIR("?")="Answer YES to have "_$P(PRMT,"^",2)_" printed for the orders.",DIR(0)="YA" D ^DIR I 'Y Q 1
"RTN","ORPR02",83,0)
 I +$G(DEF)>0 D
"RTN","ORPR02",84,0)
 . N X,DIC
"RTN","ORPR02",85,0)
 . S X="`"_+DEF,DIC(0)="NX",DIC=3.5
"RTN","ORPR02",86,0)
 . D ^DIC
"RTN","ORPR02",87,0)
 . I Y<1 S %ZIS("A")=$P(PRMT,"^",2)_"Print DEVICE: " Q
"RTN","ORPR02",88,0)
 . S:+PRMT=1 %ZIS("B")=$P(Y,"^",2)
"RTN","ORPR02",89,0)
 . S ORION=$P(Y,"^",2)
"RTN","ORPR02",90,0)
 . S:+PRMT=0!(+PRMT=2) ORIOPTR="`"_+Y,%ZIS="QN"
"RTN","ORPR02",91,0)
 I $L($G(ARAY)) S GLOB=$S($E(ARAY)="^":$E(ARAY,1,$L(ARAY)-1)_",",1:ARAY_"("),ZTSAVE(GLOB)="",ZTSAVE("ARAY")=""
"RTN","ORPR02",92,0)
 S (ZTSAVE("ORTIMES"),ZTSAVE("ORTKG"),ZTSAVE("ORVP"),ZTSAVE("ORPRES"),ZTSAVE("ORSEQ"),ZTSAVE("ORCUM("),ZTSAVE("LOC"),ZTSAVE("LOC("),ZTSAVE("ORRACT"))="",ZTDESC=$P(PRMT,"^",2)
"RTN","ORPR02",93,0)
 S:+PRMT'=1 FORCEQUE=1,ZTDTH=$H
"RTN","ORPR02",94,0)
 D QUE^ORUTL1(ZTRTN,ZTDESC,.ZTSAVE,$G(ORIOPTR),$G(ZTDTH),.%ZIS,$G(FORCEQUE),1,$G(ORION))
"RTN","ORPR02",95,0)
 Q ""
"RTN","ORPR02",96,0)
PAT(ARAY) ;Get patient if not passed
"RTN","ORPR02",97,0)
 S ARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",98,0)
 Q:'$O(@ARAY@(0)) ""
"RTN","ORPR02",99,0)
 S X=$O(@ARAY@(0)),X=$P($G(^OR(100,+@ARAY@(X),0)),"^",2)
"RTN","ORPR02",100,0)
 Q X
"RTN","ORPR02",101,0)
LOC(ARAY) ;Get location if not passed
"RTN","ORPR02",102,0)
 S ARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",103,0)
 Q:'$O(@ARAY@(0)) ""
"RTN","ORPR02",104,0)
 S X=$O(@ARAY@(0)),X=$P($G(^OR(100,+@ARAY@(X),0)),"^",10)
"RTN","ORPR02",105,0)
 Q X
"RTN","ORPR02",106,0)
TEST ;Test call
"RTN","ORPR02",107,0)
 N DALE,OREND S OREND=0
"RTN","ORPR02",108,0)
 K ^TMP("ORPARAY",$J)
"RTN","ORPR02",109,0)
 F ORI=6752:0 S ORI=$O(^OR(100,ORI)) Q:ORI<1!(ORI>8000)  S ^TMP("ORPARAY",$J,ORI)=ORI_";1"
"RTN","ORPR02",110,0)
 W @IOF
"RTN","ORPR02",111,0)
 D PRINT("","^TMP(""ORPARAY"",$J)","","","1^1^1^1^1")
"RTN","ORPR02",112,0)
 ;D GUI("^TMP(""ORPARAY"",$J)",63,"C",,1)
"RTN","ORPR02",113,0)
 K ^TMP("ORPARAY",$J)
"RTN","ORPR02",114,0)
 Q
"RTN","ORPR02",115,0)
PARAM(LOC) ;Get Print parameters
"RTN","ORPR02",116,0)
 ;LOC=Ptr to location SC(42,LOC,
"RTN","ORPR02",117,0)
 ;Returns Parameters in PARAM
"RTN","ORPR02",118,0)
 ;PARAM=Prompt for CC^CC device^L Device^R Device^Prompt for L^Prompt for R^Prompt for W^WC device
"RTN","ORPR02",119,0)
 Q:'$G(LOC)
"RTN","ORPR02",120,0)
 F I="ORPF PROMPT FOR CHART COPY","ORPF CHART COPY PRINT DEVICE","ORPF LABEL PRINT DEVICE","ORPF REQUISITION PRINT DEVICE","ORPF PROMPT FOR LABELS","ORPF PROMPT FOR REQUISITIONS","ORPF PROMPT FOR WORK COPY","ORPF WORK COPY PRINT DEVICE" D
"RTN","ORPR02",121,0)
 . S PARAM=PARAM_$$GET^XPAR("ALL^"_+LOC_";SC(",I,1,"I")_"^"
"RTN","ORPR02",122,0)
 Q
"RTN","ORPR02",123,0)
ARAY(ARAY) ;Set aray up by package in ^TMP("ORAL",$J,package,orifn;action)
"RTN","ORPR02",124,0)
 S ARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY")
"RTN","ORPR02",125,0)
 N X,IFN S IFN=0
"RTN","ORPR02",126,0)
 F  S IFN=$O(@ARAY@(IFN)) Q:IFN<1  S X=$G(^OR(100,+@ARAY@(IFN),0)) K:$P(X,"^",2)'=ORVP @ARAY@(IFN) I +X,$P(X,"^",2)=ORVP,$P(X,"^",14) S ^TMP("ORAL",$J,$P(X,"^",14),@ARAY@(IFN))=""
"RTN","ORPR02",127,0)
 Q
"RTN","ORPR02",128,0)
GUI(ARAY,DEVICE,FMT,LOC,TASK,ORTIMES) ;Silence of the Prints
"RTN","ORPR02",129,0)
 ;ARAY=Name of global storing list of orders or just the local aray
"RTN","ORPR02",130,0)
 ;@ARAY@(#)=ORIFN;DA of action       - Array of orders to print
"RTN","ORPR02",131,0)
 ;DEVICE=printer (internal ptr value)
"RTN","ORPR02",132,0)
 ;FMT=C:Chart copy, L:Labels, R:Requisitions, S:Service copies W:Work copies
"RTN","ORPR02",133,0)
 ;LOC=Location (ORL)
"RTN","ORPR02",134,0)
 ;TASK=1 to not task, 0 or undefined to task (default)
"RTN","ORPR02",135,0)
 ;     this affects the closing of devices in ^ORPR03
"RTN","ORPR02",136,0)
 ;ORTIMES=# of copies
"RTN","ORPR02",137,0)
 N ORPARAY,VAR
"RTN","ORPR02",138,0)
 S ORPARAY=$S($L($G(ARAY))&('$G(ARAY)):ARAY,1:"ARAY"),ARAY=ORPARAY
"RTN","ORPR02",139,0)
 Q:'$O(@ORPARAY@(0))  Q:'$D(IO)  Q:'$D(FMT)  Q:FMT=""  Q:"CLRSW"'[FMT
"RTN","ORPR02",140,0)
 N ORAL,ORVP,X,ZTRTN
"RTN","ORPR02",141,0)
 K ^TMP("ORAL",$J)
"RTN","ORPR02",142,0)
 S ORVP=$$PAT(.ARAY),ORAL="^TMP(""ORAL"",$J)"
"RTN","ORPR02",143,0)
 I 'ORVP S VAR("ARAY")="" D EN^ORERR("GUI~ORPR02 called with invalid ORVP",,.VAR) Q
"RTN","ORPR02",144,0)
 I '$G(LOC) S LOC=$$LOC(.ARAY)
"RTN","ORPR02",145,0)
 D ARAY(.ARAY)
"RTN","ORPR02",146,0)
 I "WC"'[FMT K ARAY S ARAY=ORAL
"RTN","ORPR02",147,0)
 S X=0_"^"_$S(FMT="L":"Labels",FMT="R":"Requisitions",FMT="S":"Service Copies",FMT="C":"Chart Copies",FMT="W":"Work Copies",1:"")
"RTN","ORPR02",148,0)
 S ZTRTN=$S(FMT="S":"SVCOPY^ORPR03()",1:FMT_"1^ORPR03")
"RTN","ORPR02",149,0)
 S:FMT="S" TASK=1
"RTN","ORPR02",150,0)
 I $G(TASK) D @ZTRTN Q
"RTN","ORPR02",151,0)
 I '$G(TASK) S X=$$DEVICE(X,DEVICE,ZTRTN)
"RTN","ORPR02",152,0)
 Q
"RTN","ORPRS06")
0^5^B11029541^B11670142
"RTN","ORPRS06",1,0)
ORPRS06 ; slc/dcm - Driving Miss ChartCopy ;7/28/06  15:55
"RTN","ORPRS06",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**11,69,99,215,260**;Dec 17, 1997;Build 26
"RTN","ORPRS06",3,0)
 ;
"RTN","ORPRS06",4,0)
 ; DBIA 3869   GETPLIST^SDAMA202   ^TMP($J,"SDAMA202")
"RTN","ORPRS06",5,0)
 ;
"RTN","ORPRS06",6,0)
MAIN ; Control module
"RTN","ORPRS06",7,0)
 N %,%H,%I,%T,ORDT,ORNOW,OREARLY,ORLATE,ORHPRM,ORLOC,X,X1,X2
"RTN","ORPRS06",8,0)
 N ORSC,ORSSC,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK,ORPCCS,ORPCCP,ORCONTX
"RTN","ORPRS06",9,0)
 D NOW^%DTC
"RTN","ORPRS06",10,0)
 S ORDT=$P(%,"."),ORNOW=$P(%,".",2)
"RTN","ORPRS06",11,0)
 I $E(ORNOW,1,2)>14 S OREARLY=ORDT
"RTN","ORPRS06",12,0)
 E  S X1=ORDT,X2=-1 D C^%DTC S OREARLY=X
"RTN","ORPRS06",13,0)
 S X1=OREARLY,X2=1
"RTN","ORPRS06",14,0)
 D C^%DTC
"RTN","ORPRS06",15,0)
 S ORLATE=X,ORCONTX=21
"RTN","ORPRS06",16,0)
 D ENVAL^XPAR(.ORPCCS,"ORPF PRINT CHART COPY SUMMARY")
"RTN","ORPRS06",17,0)
 D ENVAL^XPAR(.ORPCCP,"ORPF CHART COPY PRINT DEVICE")
"RTN","ORPRS06",18,0)
 S ORSC="" F  S ORSC=$O(ORPCCS(ORSC)) Q:ORSC=""  I ORPCCS(ORSC,1),$G(ORPCCP(ORSC,1)) D
"RTN","ORPRS06",19,0)
 . S ORHPRM=ORPCCP(ORSC,1),ORSSC=+ORSC,ORLOC=$S(+$G(^SC(ORSSC,42)):$P($G(^DIC(42,+$G(^SC(ORSSC,42)),0)),U),1:$P($G(^SC(ORSSC,0)),U)_"^"_1)
"RTN","ORPRS06",20,0)
 . S ZTRTN=$S($L(ORLOC,U)=2:"CLINIC^ORPRS06",1:"WARD^ORPRS06"),ZTDTH=$H
"RTN","ORPRS06",21,0)
 . S ZTIO="`"_+ORHPRM,ZTSAVE("OR*")=""
"RTN","ORPRS06",22,0)
 . S ZTDESC="Chart copy of orders for "_ORLOC
"RTN","ORPRS06",23,0)
 . D ^%ZTLOAD
"RTN","ORPRS06",24,0)
 Q
"RTN","ORPRS06",25,0)
WARD ; Gets list of patients for a specified non-clinic ward
"RTN","ORPRS06",26,0)
 N DFN,ORDLRJ,X,Y
"RTN","ORPRS06",27,0)
 I $S('$L(ORLOC):1,'$O(^DPT("CN",ORLOC,0)):1,1:0) Q
"RTN","ORPRS06",28,0)
 S ORDLRJ=$J,DFN=0
"RTN","ORPRS06",29,0)
 F  S DFN=$O(^DPT("CN",ORLOC,DFN)) Q:'DFN  D PATIENT(DFN,OREARLY,ORLATE,ORHPRM,$G(ORCONTX),$G(ORSSC))
"RTN","ORPRS06",30,0)
 D ^%ZISC
"RTN","ORPRS06",31,0)
 I $D(ZTSK) D KILL^%ZTLOAD K ZTSK
"RTN","ORPRS06",32,0)
 Q
"RTN","ORPRS06",33,0)
CLINIC ; Sets up call for clinic patients
"RTN","ORPRS06",34,0)
 N ORAPT,ORERR,ORI
"RTN","ORPRS06",35,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","ORPRS06",36,0)
 D GETPLIST^SDAMA202(ORSSC,"1;4","",9999999-OREARLY,9999999-ORLATE)  ;DBIA 3869
"RTN","ORPRS06",37,0)
 S ORERR=$$CLINERR^ORQRY01
"RTN","ORPRS06",38,0)
 I $L(ORERR) D  Q
"RTN","ORPRS06",39,0)
 . N XMDUZ,XMSUB,XMTEXT,XMY K XMY,^TMP("OR SCHED DB ERROR",$J)
"RTN","ORPRS06",40,0)
 . S XMDUZ=.5
"RTN","ORPRS06",41,0)
 . S XMY(.5)=""
"RTN","ORPRS06",42,0)
 . S XMSUB=ORERR
"RTN","ORPRS06",43,0)
 . S XMTEXT="^TMP(""OR SCHED DB ERROR"",$J,0,"
"RTN","ORPRS06",44,0)
 . S ^TMP("OR SCHED DB ERROR",$J,0,1,0)=ORERR
"RTN","ORPRS06",45,0)
 . S ^TMP("OR SCHED DB ERROR",$J,0,2,0)=""
"RTN","ORPRS06",46,0)
 . D ^XMD
"RTN","ORPRS06",47,0)
 . K ^TMP("OR SCHED DB ERROR",$J)
"RTN","ORPRS06",48,0)
 S ORI=0
"RTN","ORPRS06",49,0)
 F  S ORI=$O(^TMP($J,"SDAMA202","GETPLIST",ORI)) Q:ORI<1  D
"RTN","ORPRS06",50,0)
 . S ORAPT=+$G(^TMP($J,"SDAMA202","GETPLIST",ORI,1))
"RTN","ORPRS06",51,0)
 . S DFN=+$G(^TMP($J,"SDAMA202","GETPLIST",ORI,4))
"RTN","ORPRS06",52,0)
 . I ORAPT,DFN D PATIENT(DFN,OREARLY,ORLATE,ORHPRM,$G(ORCONTX),$G(ORSSC))
"RTN","ORPRS06",53,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","ORPRS06",54,0)
 D ^%ZISC
"RTN","ORPRS06",55,0)
 I $D(ZTSK) D KILL^%ZTLOAD K ZTSK
"RTN","ORPRS06",56,0)
 Q
"RTN","ORPRS06",57,0)
PATIENT(DFN,EARLY,LATE,DEVICE,CONTEXT,LOC44) ; Gets orders by patient, date, context
"RTN","ORPRS06",58,0)
 ;DFN=ptr to file 2
"RTN","ORPRS06",59,0)
 ;EARLY=Starting date
"RTN","ORPRS06",60,0)
 ;LATE=Ending date
"RTN","ORPRS06",61,0)
 ;DEVICE=device to print on.
"RTN","ORPRS06",62,0)
 ;CONTEXT=context sent to ORQ1 (default=1)
"RTN","ORPRS06",63,0)
 ;LOC44=ptr to location, file 44
"RTN","ORPRS06",64,0)
 N ARRAY,ORVP
"RTN","ORPRS06",65,0)
 S ORVP=DFN_";DPT("
"RTN","ORPRS06",66,0)
 S:'$G(CONTEXT) CONTEXT=1
"RTN","ORPRS06",67,0)
 D EN^ORQ1(ORVP,1,CONTEXT,"",LATE,EARLY,0,1)
"RTN","ORPRS06",68,0)
 I $$GET^XPAR("ALL","ORPF CHART SUMMARY SORT",1,"I") D SORT^ORPRS02
"RTN","ORPRS06",69,0)
 I '$O(^TMP("ORR",$J,ORLIST,0)) G PATX
"RTN","ORPRS06",70,0)
 S ARRAY="^TMP(""ORR"",$J,ORLIST)",LOC44=$S($G(LOC44):LOC44_";SC(",1:"")
"RTN","ORPRS06",71,0)
 D GUI^ORPR02(.ARRAY,DEVICE,"C",LOC44,1)
"RTN","ORPRS06",72,0)
PATX ;
"RTN","ORPRS06",73,0)
 K ^TMP("ORR",$J,ORLIST)
"RTN","ORPRS06",74,0)
 Q
"RTN","ORPRS06",75,0)
WORK(DFN,EARLY,LATE,DEVICE) ;Gets orders for work copy
"RTN","ORPRS06",76,0)
 ;Same description as PATIENT()
"RTN","ORPRS06",77,0)
 N ARRAY,ORVP
"RTN","ORPRS06",78,0)
 S ORVP=DFN_";DPT("
"RTN","ORPRS06",79,0)
 D EN^ORQ1(ORVP,1,1,"",LATE,EARLY,0,1)
"RTN","ORPRS06",80,0)
 I $$GET^XPAR("ALL","ORPF WORK SUMMARY SORT",1,"I") D SORT^ORPRS02
"RTN","ORPRS06",81,0)
 I '$O(^TMP("ORR",$J,ORLIST,0)) G WRKX
"RTN","ORPRS06",82,0)
 S ARRAY="^TMP(""ORR"",$J,ORLIST)"
"RTN","ORPRS06",83,0)
 D GUI^ORPR02(.ARRAY,DEVICE,"W",,1)
"RTN","ORPRS06",84,0)
WRKX ;
"RTN","ORPRS06",85,0)
 K ^TMP("ORR",$J,ORLIST)
"RTN","ORPRS06",86,0)
 Q
"RTN","ORPXRM")
0^7^B12504214^B12483594
"RTN","ORPXRM",1,0)
ORPXRM ; SLC/PKR - Clinical Reminder index routines for file 100. ;8/13/06  14:19
"RTN","ORPXRM",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**157,260**;Dec 17, 1997;Build 26
"RTN","ORPXRM",3,0)
 ;DBIA 4113 supports PXRMSXRM entry points. 
"RTN","ORPXRM",4,0)
 ;DBIA 4114 supports setting and killing ^PXRMINDX
"RTN","ORPXRM",5,0)
 ;=========================================================
"RTN","ORPXRM",6,0)
INDEX ;Build the index for the ORDER file.
"RTN","ORPXRM",7,0)
 N D0,D0P,D1,DAS,DFN,END,ENTRIES,ETEXT,FERROR,GLOBAL,IND,NE,NDUP,NERROR
"RTN","ORPXRM",8,0)
 N OI,PROC,START,STRTDATE,STOP,TEMP,TENP,TEXT
"RTN","ORPXRM",9,0)
 ;Don't leave any old stuff around.
"RTN","ORPXRM",10,0)
 K ^PXRMINDX(100)
"RTN","ORPXRM",11,0)
 S GLOBAL=$$GET1^DID(100,"","","GLOBAL NAME")
"RTN","ORPXRM",12,0)
 S ENTRIES=$P(^OR(100,0),U,4)
"RTN","ORPXRM",13,0)
 S TENP=ENTRIES/10
"RTN","ORPXRM",14,0)
 S TENP=+$P(TENP,".",1)
"RTN","ORPXRM",15,0)
 I TENP<1 S TENP=1
"RTN","ORPXRM",16,0)
 D BMES^XPDUTL("Building index for ORDER file")
"RTN","ORPXRM",17,0)
 S TEXT="There are "_ENTRIES_" entries to process."
"RTN","ORPXRM",18,0)
 D MES^XPDUTL(TEXT)
"RTN","ORPXRM",19,0)
 S START=$H
"RTN","ORPXRM",20,0)
 S (D0,D0P,FERROR,IND,NDUP,NE,NERROR)=0
"RTN","ORPXRM",21,0)
 F  S D0=$O(^OR(100,D0)) Q:(+D0=0)!(FERROR)  D
"RTN","ORPXRM",22,0)
 . I D0'>D0P D  Q
"RTN","ORPXRM",23,0)
 .. S FERROR=1
"RTN","ORPXRM",24,0)
 .. S ETEXT=D0_" subscript is a bad, cannot continue!"
"RTN","ORPXRM",25,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","ORPXRM",26,0)
 . S D0P=D0
"RTN","ORPXRM",27,0)
 . S IND=IND+1
"RTN","ORPXRM",28,0)
 . I IND#TENP=0 D
"RTN","ORPXRM",29,0)
 .. S TEXT="Processing entry "_IND
"RTN","ORPXRM",30,0)
 .. D MES^XPDUTL(TEXT)
"RTN","ORPXRM",31,0)
 . I IND#10000=0 W "."
"RTN","ORPXRM",32,0)
 . S TEMP=$G(^OR(100,D0,0))
"RTN","ORPXRM",33,0)
 . I TEMP="" D  Q
"RTN","ORPXRM",34,0)
 .. S ETEXT=D0_" bad entry no 0 node"
"RTN","ORPXRM",35,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","ORPXRM",36,0)
 . S DFN=$P(TEMP,U,2)
"RTN","ORPXRM",37,0)
 . I DFN="" D  Q
"RTN","ORPXRM",38,0)
 .. S ETEXT=D0_" no DFN"
"RTN","ORPXRM",39,0)
 .. D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","ORPXRM",40,0)
 . I DFN'["DPT(" Q
"RTN","ORPXRM",41,0)
 . S DFN=$P(DFN,";",1)
"RTN","ORPXRM",42,0)
 . S STRTDATE=$P(TEMP,U,8)
"RTN","ORPXRM",43,0)
 .;If there is no start date get the release date for the new order.
"RTN","ORPXRM",44,0)
 . I STRTDATE="" S STRTDATE=$$RDATE(D0)
"RTN","ORPXRM",45,0)
 . I STRTDATE="" Q
"RTN","ORPXRM",46,0)
 . S STOP=$P(TEMP,U,9)
"RTN","ORPXRM",47,0)
 . S STOP=$S(STOP="":"U"_D0,1:STOP)
"RTN","ORPXRM",48,0)
 . S D1=0
"RTN","ORPXRM",49,0)
 . F  S D1=+$O(^OR(100,D0,.1,D1)) Q:D1=0  D
"RTN","ORPXRM",50,0)
 .. S OI=^OR(100,D0,.1,D1,0)
"RTN","ORPXRM",51,0)
 .. S DAS=D0_";.1;"_D1_";0"
"RTN","ORPXRM",52,0)
 .. I OI="" D  Q
"RTN","ORPXRM",53,0)
 ... S ETEXT=DAS_" no orderable item"
"RTN","ORPXRM",54,0)
 ... D ADDERROR^PXRMSXRM(GLOBAL,ETEXT,.NERROR)
"RTN","ORPXRM",55,0)
 .. I $D(^PXRMINDX(100,"IP",OI,DFN,STRTDATE,STOP,DAS)) S NDUP=NDUP+1
"RTN","ORPXRM",56,0)
 .. S ^PXRMINDX(100,"IP",OI,DFN,STRTDATE,STOP,DAS)=""
"RTN","ORPXRM",57,0)
 .. S ^PXRMINDX(100,"PI",DFN,OI,STRTDATE,STOP,DAS)=""
"RTN","ORPXRM",58,0)
 .. S NE=NE+1
"RTN","ORPXRM",59,0)
 S END=$H
"RTN","ORPXRM",60,0)
 S TEXT=NE_" ORDER results indexed."
"RTN","ORPXRM",61,0)
 W !,"There were "_NDUP_" duplicates."
"RTN","ORPXRM",62,0)
 D MES^XPDUTL(TEXT)
"RTN","ORPXRM",63,0)
 D DETIME^PXRMSXRM(START,END)
"RTN","ORPXRM",64,0)
 ;If there were errors send a message.
"RTN","ORPXRM",65,0)
 I NERROR>0 D ERRMSG^PXRMSXRM(NERROR,GLOBAL)
"RTN","ORPXRM",66,0)
 ;Send a MailMan message with the results.
"RTN","ORPXRM",67,0)
 D COMMSG^PXRMSXRM(GLOBAL,START,END,NE,NERROR)
"RTN","ORPXRM",68,0)
 S ^PXRMINDX(100,"GLOBAL NAME")=GLOBAL
"RTN","ORPXRM",69,0)
 S ^PXRMINDX(100,"BUILT BY")=DUZ
"RTN","ORPXRM",70,0)
 S ^PXRMINDX(100,"DATE BUILT")=$$NOW^XLFDT
"RTN","ORPXRM",71,0)
 Q
"RTN","ORPXRM",72,0)
 ;
"RTN","ORPXRM",73,0)
 ;=========================================================
"RTN","ORPXRM",74,0)
GETDATA(ORIFN,DATA) ;Return data, for a specified order file entry.
"RTN","ORPXRM",75,0)
 N ORUPCHUK
"RTN","ORPXRM",76,0)
 D EN^ORX8(ORIFN)
"RTN","ORPXRM",77,0)
 S ORUPCHUK("ORORDER")=$$OI^ORX8(ORIFN)
"RTN","ORPXRM",78,0)
 S ORUPCHUK("ORREL")=$$RDATE(ORIFN)
"RTN","ORPXRM",79,0)
 M DATA=ORUPCHUK
"RTN","ORPXRM",80,0)
 Q
"RTN","ORPXRM",81,0)
 ;
"RTN","ORPXRM",82,0)
 ;=========================================================
"RTN","ORPXRM",83,0)
KOR(X,DA) ;Kill index for Order file.
"RTN","ORPXRM",84,0)
 N DAS,DFN,STOP
"RTN","ORPXRM",85,0)
 I X(1)'["DPT" Q
"RTN","ORPXRM",86,0)
 I 'X(2)!'X(3) Q
"RTN","ORPXRM",87,0)
 S DFN=$P(X(1),";",1)
"RTN","ORPXRM",88,0)
 S DAS=DA(1)_";.1;"_DA_";0"
"RTN","ORPXRM",89,0)
 S STOP=$S(X(4)="":"U"_DA(1),1:X(4))
"RTN","ORPXRM",90,0)
 K ^PXRMINDX(100,"IP",X(2),DFN,X(3),STOP,DAS)
"RTN","ORPXRM",91,0)
 K ^PXRMINDX(100,"PI",DFN,X(2),X(3),STOP,DAS)
"RTN","ORPXRM",92,0)
 Q
"RTN","ORPXRM",93,0)
 ;=========================================================
"RTN","ORPXRM",94,0)
RDATE(ORIFN) ;Return the release date for the new order action.
"RTN","ORPXRM",95,0)
 N RDIEN
"RTN","ORPXRM",96,0)
 S RDIEN=$O(^OR(100,ORIFN,8,"C","NW",""))
"RTN","ORPXRM",97,0)
 I RDIEN="" Q ""
"RTN","ORPXRM",98,0)
 Q $P(^OR(100,ORIFN,8,RDIEN,0),U,16)
"RTN","ORPXRM",99,0)
 ;
"RTN","ORPXRM",100,0)
 ;=========================================================
"RTN","ORPXRM",101,0)
SOR(X,DA) ;Set index for Order file.
"RTN","ORPXRM",102,0)
 ;X(1)=OBJECT OF ORDER, X(2)=ORDERABLE ITEM, X(3)=START DATE
"RTN","ORPXRM",103,0)
 ;or release date, X(4)=STOP DATE
"RTN","ORPXRM",104,0)
 N DAS,DFN,STOP
"RTN","ORPXRM",105,0)
 I X(1)'["DPT" Q
"RTN","ORPXRM",106,0)
 I 'X(2)!'X(3) Q
"RTN","ORPXRM",107,0)
 S DFN=$P(X(1),";",1)
"RTN","ORPXRM",108,0)
 S DAS=DA(1)_";.1;"_DA_";0"
"RTN","ORPXRM",109,0)
 S STOP=$S(X(4)="":"U"_DA(1),1:+X(4))
"RTN","ORPXRM",110,0)
 S ^PXRMINDX(100,"IP",X(2),DFN,+X(3),STOP,DAS)=""
"RTN","ORPXRM",111,0)
 S ^PXRMINDX(100,"PI",DFN,X(2),+X(3),STOP,DAS)=""
"RTN","ORPXRM",112,0)
 Q
"RTN","ORPXRM",113,0)
 ;
"RTN","ORQQVI")
0^16^B40454772^B39275783
"RTN","ORQQVI",1,0)
ORQQVI ; slc/STAFF - Functions which return patient vital and I/O data ;10/26/06  11:44
"RTN","ORQQVI",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,198,215,250,260**;Dec 17, 1997;Build 26
"RTN","ORQQVI",3,0)
VITALS(ORY,DFN,ORSDT,OREDT) ; return patient's vital measurements taken between start date/time and end date/time
"RTN","ORQQVI",4,0)
 ;ORY: return variable, results are returned in the format:
"RTN","ORQQVI",5,0)
 ;     vital measurement ien^vital type^date/time taken^rate
"RTN","ORQQVI",6,0)
 ;DFN: patient identifier from Patient File [#2]
"RTN","ORQQVI",7,0)
 ;ORSDT: start date/time in Fileman format
"RTN","ORQQVI",8,0)
 ;OREDT: end date/time in Fileman format
"RTN","ORQQVI",9,0)
 K ^UTILITY($J,"GMRVD")
"RTN","ORQQVI",10,0)
 S GMRVSTR="BP;HT;WT;T;R;P;PN" ;dee 2/12/99 added PN
"RTN","ORQQVI",11,0)
 S GMRVSTR(0)=ORSDT_"^"_OREDT_"^"_"^"
"RTN","ORQQVI",12,0)
 D EN1^GMRVUT0
"RTN","ORQQVI",13,0)
 N ORT,ORD,ORI,I
"RTN","ORQQVI",14,0)
 S ORT="",ORD=0,ORI=0,I=0
"RTN","ORQQVI",15,0)
 F  S ORT=$O(^UTILITY($J,"GMRVD",ORT)) Q:ORT=""  D
"RTN","ORQQVI",16,0)
 .F  S ORD=$O(^UTILITY($J,"GMRVD",ORT,ORD)) Q:ORD<1  D
"RTN","ORQQVI",17,0)
 ..F  S ORI=$O(^UTILITY($J,"GMRVD",ORT,ORD,ORI)) Q:ORI<1  D
"RTN","ORQQVI",18,0)
 ...S I=I+1
"RTN","ORQQVI",19,0)
 ...S ORY(I)=ORI_"^"_ORT_"^"_$P(^UTILITY($J,"GMRVD",ORT,ORD,ORI),"^",8)_"^"_$P(^(ORI),"^")
"RTN","ORQQVI",20,0)
 I I=0 S ORY(1)="^No vitals found."
"RTN","ORQQVI",21,0)
 K GMRVSTR
"RTN","ORQQVI",22,0)
 Q
"RTN","ORQQVI",23,0)
 ;
"RTN","ORQQVI",24,0)
XFASTVIT(ORY,DFN,F1,F2) ; return patient's most recent vital measurements
"RTN","ORQQVI",25,0)
 ;ORY: return variable, results are returned in the format:
"RTN","ORQQVI",26,0)
 ;     vital measurement ien^vital type^rate^date/time taken
"RTN","ORQQVI",27,0)
 ;DFN: patient identifier from Patient File [#2]
"RTN","ORQQVI",28,0)
 ; F1 & F2 are ignored
"RTN","ORQQVI",29,0)
 ;
"RTN","ORQQVI",30,0)
 N CNT
"RTN","ORQQVI",31,0)
 S CNT=0
"RTN","ORQQVI",32,0)
 D VITAL("TEMPERATURE","T",DFN,.ORY,.CNT)
"RTN","ORQQVI",33,0)
 D VITAL("PULSE","P",DFN,.ORY,.CNT)
"RTN","ORQQVI",34,0)
 D VITAL("RESPIRATION","R",DFN,.ORY,.CNT)
"RTN","ORQQVI",35,0)
 D VITAL("BLOOD PRESSURE","BP",DFN,.ORY,.CNT)
"RTN","ORQQVI",36,0)
 D VITAL("HEIGHT","HT",DFN,.ORY,.CNT)
"RTN","ORQQVI",37,0)
 D VITAL("WEIGHT","WT",DFN,.ORY,.CNT)
"RTN","ORQQVI",38,0)
 D VITAL("PAIN","PN",DFN,ORY,.CNT) ;dee 2/11/99
"RTN","ORQQVI",39,0)
 Q
"RTN","ORQQVI",40,0)
 ;
"RTN","ORQQVI",41,0)
XVITAL(VITAL,ABBREV,DFN,ORY,CNT) ; get vital measurement
"RTN","ORQQVI",42,0)
 N DATA,IDT,IEN,OK,VTYPE
"RTN","ORQQVI",43,0)
 S VTYPE=$$FIND1^DIC(120.51,"","BX",VITAL,"","","ERR")
"RTN","ORQQVI",44,0)
 I 'VTYPE Q
"RTN","ORQQVI",45,0)
 S OK=0,IDT=0 F  S IDT=$O(^GMR(120.5,"AA",DFN,VTYPE,IDT)) Q:IDT<1  D  Q:OK
"RTN","ORQQVI",46,0)
 .S IEN=0 F  S IEN=$O(^GMR(120.5,"AA",DFN,VTYPE,IDT,IEN)) Q:IEN<1  D  Q:OK
"RTN","ORQQVI",47,0)
 ..I $P($G(^GMR(120.5,IEN,2)),U) Q  ; do not retrieve if entered in error
"RTN","ORQQVI",48,0)
 ..S DATA=$G(^GMR(120.5,IEN,0))
"RTN","ORQQVI",49,0)
 ..I 'DATA Q
"RTN","ORQQVI",50,0)
 ..S CNT=CNT+1,OK=1
"RTN","ORQQVI",51,0)
 ..S ORY(CNT)=IEN_U_ABBREV_U_$P(DATA,U,8)_U_$P(DATA,U)
"RTN","ORQQVI",52,0)
 Q
"RTN","ORQQVI",53,0)
 ;
"RTN","ORQQVI",54,0)
NOTEVIT(ORY,DFN,NOTEIEN) ;
"RTN","ORQQVI",55,0)
 N VSTR,NOTEDATE
"RTN","ORQQVI",56,0)
 D NOTEVSTR^ORWPCE(.VSTR,NOTEIEN)
"RTN","ORQQVI",57,0)
 Q:$P(VSTR,";",2)=""
"RTN","ORQQVI",58,0)
 D FASTVIT(.ORY,DFN,$P(VSTR,";",2))
"RTN","ORQQVI",59,0)
 Q
"RTN","ORQQVI",60,0)
 ;
"RTN","ORQQVI",61,0)
FASTVIT(ORY,DFN,F1,F2) ; return patient's most recent vital measurements
"RTN","ORQQVI",62,0)
 ; in date range
"RTN","ORQQVI",63,0)
 ;ORY: return variable, results are returned in the format:
"RTN","ORQQVI",64,0)
 ;     vital measurement ien^vital type^rate^date/time taken
"RTN","ORQQVI",65,0)
 ;DFN: patient identifier from Patient File [#2]
"RTN","ORQQVI",66,0)
 ; F1: starting date/time range
"RTN","ORQQVI",67,0)
 ; F2: ending date/time range
"RTN","ORQQVI",68,0)
 ;
"RTN","ORQQVI",69,0)
 N CNT,DT1,DT2
"RTN","ORQQVI",70,0)
 S CNT=0
"RTN","ORQQVI",71,0)
 I $G(F1)>0 D
"RTN","ORQQVI",72,0)
 . I $G(F2)="",F1["." S DT1=$P(F1,".",1)_"."_$E($P(F1,".",2),1,4)
"RTN","ORQQVI",73,0)
 . E  S DT1=F1
"RTN","ORQQVI",74,0)
 E  S DT1=1
"RTN","ORQQVI",75,0)
 S DT2=$S($G(F2)>0:F2,DT1>1:DT1,1:9999998)
"RTN","ORQQVI",76,0)
 ;
"RTN","ORQQVI",77,0)
 D VITAL("TEMPERATURE","T",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",78,0)
 D VITAL("PULSE","P",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",79,0)
 D VITAL("RESPIRATION","R",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",80,0)
 D VITAL("BLOOD PRESSURE","BP",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",81,0)
 D VITAL("HEIGHT","HT",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",82,0)
 D VITAL("WEIGHT","WT",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",83,0)
 D VITAL("PAIN","PN",DFN,.ORY,.CNT,DT1,DT2) ;dee 2/11/99
"RTN","ORQQVI",84,0)
 D VITAL("PULSE OXIMETRY","PO2",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",85,0)
 D VITAL("CENTRAL VENOUS PRESSURE","CVP",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",86,0)
 D VITAL("CIRCUMFERENCE/GIRTH","CG",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",87,0)
 D VITAL("BODY MASS INDEX","BMI",DFN,.ORY,.CNT,DT1,DT2)
"RTN","ORQQVI",88,0)
 Q
"RTN","ORQQVI",89,0)
 ;
"RTN","ORQQVI",90,0)
VITAL(VITAL,ABBREV,DFN,ORY,CNT,F1,F2) ;
"RTN","ORQQVI",91,0)
 ;get most recent vital measurement in date range
"RTN","ORQQVI",92,0)
 I ABBREV="BMI" D BMILAST^ORWGAPIX(DFN,.ORY,.CNT) Q
"RTN","ORQQVI",93,0)
 N DATA,IDT,ENDIDT,IEN,OK,VTYPE,MVAL,VALUE
"RTN","ORQQVI",94,0)
 S VTYPE=$$FIND1^DIC(120.51,"","BX",VITAL,"","","ERR")
"RTN","ORQQVI",95,0)
 I 'VTYPE Q
"RTN","ORQQVI",96,0)
 S OK=0
"RTN","ORQQVI",97,0)
 S IDT=9999999-(F2+$S(F2#1:.0000001,1:.7))
"RTN","ORQQVI",98,0)
 S ENDIDT=9999999-(F1-.0000001)
"RTN","ORQQVI",99,0)
 F  S IDT=$O(^GMR(120.5,"AA",DFN,VTYPE,IDT)) Q:IDT>ENDIDT!'IDT  D  Q:OK
"RTN","ORQQVI",100,0)
 .S IEN=0 F  S IEN=$O(^GMR(120.5,"AA",DFN,VTYPE,IDT,IEN)) Q:IEN<1  D  Q:OK
"RTN","ORQQVI",101,0)
 ..I $P($G(^GMR(120.5,IEN,2)),U) Q  ; do not retrieve if entered in error
"RTN","ORQQVI",102,0)
 ..S DATA=$G(^GMR(120.5,IEN,0))
"RTN","ORQQVI",103,0)
 ..I 'DATA Q
"RTN","ORQQVI",104,0)
 ..S CNT=CNT+1,OK=1,VALUE=$P(DATA,U,8)
"RTN","ORQQVI",105,0)
 ..; changed to display 'POX' rather than 'PO2' per CQ 10592
"RTN","ORQQVI",106,0)
 ..S ORY(CNT)=IEN_U_$S(ABBREV="PO2":"POX",1:ABBREV)_U_VALUE_U_$P(DATA,U)
"RTN","ORQQVI",107,0)
 ..I $P(ORY(CNT),"^",2)="T" D  ; Temperature.
"RTN","ORQQVI",108,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE_$S($E(VALUE):" F",1:"")
"RTN","ORQQVI",109,0)
 ...S MVAL=+VALUE
"RTN","ORQQVI",110,0)
 ...Q:'MVAL
"RTN","ORQQVI",111,0)
 ...S MVAL=MVAL-32
"RTN","ORQQVI",112,0)
 ...S MVAL=$J((MVAL*(5/9)),3,1)
"RTN","ORQQVI",113,0)
 ...S ORY(CNT)=ORY(CNT)_"^("_MVAL_" C)"
"RTN","ORQQVI",114,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",115,0)
 ..I $P(ORY(CNT),"^",2)="P" D  ; Pulse.
"RTN","ORQQVI",116,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE
"RTN","ORQQVI",117,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",118,0)
 ..I $P(ORY(CNT),"^",2)="R" D  ; Respiration.
"RTN","ORQQVI",119,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE
"RTN","ORQQVI",120,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",121,0)
 ..I $P(ORY(CNT),"^",2)="BP" D  ; Blood Pressure.
"RTN","ORQQVI",122,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE
"RTN","ORQQVI",123,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",124,0)
 ..I $P(ORY(CNT),"^",2)="HT" D  ; Height.
"RTN","ORQQVI",125,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE_$S($E(VALUE):" in",1:"")
"RTN","ORQQVI",126,0)
 ...S MVAL=+VALUE
"RTN","ORQQVI",127,0)
 ...Q:'MVAL
"RTN","ORQQVI",128,0)
 ...S MVAL=$J((MVAL*2.54),3,1)
"RTN","ORQQVI",129,0)
 ...S ORY(CNT)=ORY(CNT)_"^("_MVAL_" cm)"
"RTN","ORQQVI",130,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",131,0)
 ..I $P(ORY(CNT),"^",2)="WT" D  ; Weight.
"RTN","ORQQVI",132,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE_$S($E(VALUE):" lb",1:"")
"RTN","ORQQVI",133,0)
 ...S MVAL=+VALUE
"RTN","ORQQVI",134,0)
 ...Q:'MVAL
"RTN","ORQQVI",135,0)
 ...; changed 2.2 to 2.20462262 per CQ 10637
"RTN","ORQQVI",136,0)
 ...S MVAL=$J((MVAL/2.20462262),3,1)
"RTN","ORQQVI",137,0)
 ...S ORY(CNT)=ORY(CNT)_"^("_MVAL_" kg)"
"RTN","ORQQVI",138,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8($P(ORY(CNT),U,1))
"RTN","ORQQVI",139,0)
 ..I $P(ORY(CNT),"^",2)="PN" D   ; Pain
"RTN","ORQQVI",140,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_VALUE
"RTN","ORQQVI",141,0)
 ...S $P(ORY(CNT),U,7)="" ;pain doesn't have qualifiers
"RTN","ORQQVI",142,0)
 ..; looks for 'POX' rather than 'PO2' due to change for CQ 10592 above
"RTN","ORQQVI",143,0)
 ..I $P(ORY(CNT),"^",2)="POX" D  ; Pulse Oximetry.
"RTN","ORQQVI",144,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_$P(ORY(CNT),"^",3)
"RTN","ORQQVI",145,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8(+$P(ORY(CNT),U,1))
"RTN","ORQQVI",146,0)
 ...S $P(ORY(CNT),U,8)=$$SUPO2^GMVUTL8(+$P(ORY(CNT),U,1))
"RTN","ORQQVI",147,0)
 ..I $P(ORY(CNT),"^",2)="CVP" D  ; Central Venous Pressure.
"RTN","ORQQVI",148,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_$P(ORY(CNT),"^",3)
"RTN","ORQQVI",149,0)
 ...S MVAL=$P(ORY(CNT),"^",3)
"RTN","ORQQVI",150,0)
 ...I MVAL'=+MVAL,+MVAL=0 S ORY(CNT)=ORY(CNT)_"^",$P(ORY(CNT),U,7)="" Q
"RTN","ORQQVI",151,0)
 ...S MVAL=$J((MVAL/1.36),3,1)
"RTN","ORQQVI",152,0)
 ...S ORY(CNT)=ORY(CNT)_" cmH20^("_MVAL_" mmHg)"
"RTN","ORQQVI",153,0)
 ...S $P(ORY(CNT),U,7)="" ;cvp doesn't have qualifiers
"RTN","ORQQVI",154,0)
 ..I $P(ORY(CNT),"^",2)="CG" D  ; Circumference Girth.
"RTN","ORQQVI",155,0)
 ...S ORY(CNT)=ORY(CNT)_"^"_$P(ORY(CNT),"^",3)
"RTN","ORQQVI",156,0)
 ...S MVAL=$P(ORY(CNT),"^",3)
"RTN","ORQQVI",157,0)
 ...I MVAL'=+MVAL,+MVAL=0 S ORY(CNT)=ORY(CNT)_"^",$P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8(+$P(ORY(CNT),U,1)) Q
"RTN","ORQQVI",158,0)
 ...S MVAL=$J((MVAL*2.54),3,1)
"RTN","ORQQVI",159,0)
 ...S ORY(CNT)=ORY(CNT)_" in^("_MVAL_" cm)"
"RTN","ORQQVI",160,0)
 ...S $P(ORY(CNT),U,7)=$$QUALIFRS^GMVUTL8(+$P(ORY(CNT),U,1))
"RTN","ORQQVI",161,0)
 Q
"RTN","ORQRY01")
0^3^B8896457^B8406536
"RTN","ORQRY01",1,0)
ORQRY01 ;SLC/JDL - Order query utility ;11/20/06  09:01
"RTN","ORQRY01",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**153,174,215,260**;Dec 17, 1997;Build 26
"RTN","ORQRY01",3,0)
 ;
"RTN","ORQRY01",4,0)
 ; DBIA 3869   GETPLIST^SDAMA202   ^TMP($J,"SDAMA202")
"RTN","ORQRY01",5,0)
 ;
"RTN","ORQRY01",6,0)
DOCDT(DOCS) ;Date range for TIU
"RTN","ORQRY01",7,0)
 N XDT,SDATE,EDATE
"RTN","ORQRY01",8,0)
 S XDT=$O(DOCS("Reference",""))
"RTN","ORQRY01",9,0)
 Q:'$L(XDT)
"RTN","ORQRY01",10,0)
 S SDATE=$P(XDT,":"),EDATE=$P(XDT,":",2)
"RTN","ORQRY01",11,0)
 S:SDATE=-1 SDATE=0
"RTN","ORQRY01",12,0)
 I EDATE=-1 S EDATE=9999999+EDATE
"RTN","ORQRY01",13,0)
 E  S EDATE=EDATE+1
"RTN","ORQRY01",14,0)
 K DOCS("Reference",XDT)
"RTN","ORQRY01",15,0)
 S DOCS("Reference",SDATE_":"_EDATE)=""
"RTN","ORQRY01",16,0)
 Q
"RTN","ORQRY01",17,0)
CLINPTS(ORY,CLIN,ORBDATE,OREDATE) ; RETURN LIST OF PTS W/CLINIC APPT W/IN DT RNG
"RTN","ORQRY01",18,0)
 ;Copied from CLINPTS^ORQPTQ2 without maximum limitation
"RTN","ORQRY01",19,0)
 S ORY="^TMP(""ORCLINPT"",$J)"
"RTN","ORQRY01",20,0)
 K @ORY
"RTN","ORQRY01",21,0)
 I +$G(CLIN)<1 S @ORY@(1)="^No clinic identified" Q 
"RTN","ORQRY01",22,0)
 I $$ACTLOC^ORWU(CLIN)'=1 S @ORY@(1)="^Clinic is inactive or Occasion Of Service" Q
"RTN","ORQRY01",23,0)
 N DFN,NAME,I,J,X,ORERR,ORJ,ORSRV,ORNOWDT,CHKX,CHKIN,ORC,CLNAM
"RTN","ORQRY01",24,0)
 S ORNOWDT=$$NOW^XLFDT
"RTN","ORQRY01",25,0)
 S ORSRV=$$GET1^DIQ(200,DUZ,29,"I") I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQRY01",26,0)
 S DFN=0,I=1
"RTN","ORQRY01",27,0)
 I ORBDATE="" S ORBDATE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT CLINIC START DATE",1,"E"))
"RTN","ORQRY01",28,0)
 I OREDATE="" S OREDATE=$$UP^XLFSTR($$GET^XPAR("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORLP DEFAULT CLINIC STOP DATE",1,"E"))
"RTN","ORQRY01",29,0)
 ;CONVERT ORBDATE AND OREDATE INTO FILEMAN DATE/TIME
"RTN","ORQRY01",30,0)
 D DT^DILF("T",ORBDATE,.ORBDATE,"","")
"RTN","ORQRY01",31,0)
 D DT^DILF("T",OREDATE,.OREDATE,"","")
"RTN","ORQRY01",32,0)
 I (ORBDATE=-1)!(OREDATE=-1) S @ORY@(1)="^Error in date range." Q 
"RTN","ORQRY01",33,0)
 S OREDATE=$P(OREDATE,".")_.5  ;ADD 1/2 DAY TO END DATE
"RTN","ORQRY01",34,0)
 ; DBIA 3869
"RTN","ORQRY01",35,0)
 N ORI,ORCSTAT
"RTN","ORQRY01",36,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","ORQRY01",37,0)
 D GETPLIST^SDAMA202(+CLIN,"1;3;4","",ORBDATE,OREDATE)  ;DBIA 3869
"RTN","ORQRY01",38,0)
 S ORERR=$$CLINERR
"RTN","ORQRY01",39,0)
 I $L(ORERR) S @ORY@(1)=U_ORERR Q
"RTN","ORQRY01",40,0)
 S ORI=0
"RTN","ORQRY01",41,0)
 F  S ORI=$O(^TMP($J,"SDAMA202","GETPLIST",ORI)) Q:ORI<1  D  ;DBIA 3869
"RTN","ORQRY01",42,0)
 . S ORCSTAT=+$G(^TMP($J,"SDAMA202","GETPLIST",ORI,3))
"RTN","ORQRY01",43,0)
 . I ORCSTAT'="NT" Q:ORCSTAT="C"  Q:ORCSTAT="N"
"RTN","ORQRY01",44,0)
 . S ORJ=+$G(^TMP($J,"SDAMA202","GETPLIST",ORI,1))
"RTN","ORQRY01",45,0)
 . S DFN=+$G(^TMP($J,"SDAMA202","GETPLIST",ORI,4))
"RTN","ORQRY01",46,0)
 . I ORJ,DFN S @ORY@(I)=DFN_"^"_$P(^DPT(DFN,0),"^")_"^"_+CLIN_"^"_ORJ,I=I+1
"RTN","ORQRY01",47,0)
 K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","ORQRY01",48,0)
 S:'$D(@ORY) @ORY@(1)="^No appointments."
"RTN","ORQRY01",49,0)
 Q
"RTN","ORQRY01",50,0)
 ;
"RTN","ORQRY01",51,0)
SDA(ERR,ERRMSG) ; common call to scheduling to return new variables for errors - out of scope
"RTN","ORQRY01",52,0)
 D SDA^VADPT
"RTN","ORQRY01",53,0)
 S ERR=VAERR
"RTN","ORQRY01",54,0)
 I ERR=1 S ERRMSG="^Error encountered^Error encountered" Q
"RTN","ORQRY01",55,0)
 I ERR=2 S ERRMSG="^Database is unavailable^Database is unavailable" Q
"RTN","ORQRY01",56,0)
 S ERRMSG=""
"RTN","ORQRY01",57,0)
 Q
"RTN","ORQRY01",58,0)
 ;
"RTN","ORQRY01",59,0)
CLINERR() ; $$ -> error msg or ""
"RTN","ORQRY01",60,0)
 N ERR,MSG
"RTN","ORQRY01",61,0)
 S MSG=""
"RTN","ORQRY01",62,0)
 S ERR=+$O(^TMP($J,"SDAMA202","GETPLIST","ERROR",""))
"RTN","ORQRY01",63,0)
 I ERR D
"RTN","ORQRY01",64,0)
 . S MSG="Server Error #"_ERR_": "
"RTN","ORQRY01",65,0)
 . S MSG=MSG_$G(^TMP($J,"SDAMA202","GETPLIST","ERROR",ERR))
"RTN","ORQRY01",66,0)
 . K ^TMP($J,"SDAMA202","GETPLIST")
"RTN","ORQRY01",67,0)
 Q MSG
"RTN","ORWCV")
0^9^B73087696^B71237743
"RTN","ORWCV",1,0)
ORWCV ; SLC/KCM - Background Cover Sheet Load; ;11/2/06  15:07
"RTN","ORWCV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,132,209,214,195,215,260**;Dec 17, 1997;Build 26
"RTN","ORWCV",3,0)
 ;
"RTN","ORWCV",4,0)
 ; DBIA 4011    Access ^XWB(8994)
"RTN","ORWCV",5,0)
 ; DBIA 4313    Direct R/W permission to capacity mgmt global ^KMPTMP("KMPDT")
"RTN","ORWCV",6,0)
 ; DBIA 10061   Reference to ^UTILITY
"RTN","ORWCV",7,0)
 ; 
"RTN","ORWCV",8,0)
START(VAL,DFN,IP,HWND,LOC,NODO,NEWREM) ; start cover sheet build in background
"RTN","ORWCV",9,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,SECT,BACK,X,I,ORLIST,STR,FILE,NODE,ORHTIME,ORX
"RTN","ORWCV",10,0)
 ; Capacity planning timing code uses ORHTIME
"RTN","ORWCV",11,0)
 S ORHTIME=$H
"RTN","ORWCV",12,0)
 S LOC=$G(LOC),NODO=";"_$G(NODO),NEWREM=+$G(NEWREM)
"RTN","ORWCV",13,0)
 D GETLST^XPAR(.ORX,"SYS^PKG","ORWOR COVER RETRIEVAL NEW","Q")
"RTN","ORWCV",14,0)
 S I=0 F  S I=$O(ORX(I)) Q:'I  I $D(^ORD(101.24,+ORX(I),0)) S SECT(+$P(^(0),"^",2))=$P(ORX(I),"^",2)
"RTN","ORWCV",15,0)
 D GETLST^XPAR(.ORLIST,"ALL","ORWCV1 COVERSHEET LIST")
"RTN","ORWCV",16,0)
 S (VAL,BACK,STR,FILE)=""
"RTN","ORWCV",17,0)
 F  S I=$O(ORLIST(I)) Q:'I  I $D(^ORD(101.24,$P(ORLIST(I),"^",2),0))  S X0=^(0) D
"RTN","ORWCV",18,0)
 . Q:$P(X0,"^",8)'="C"
"RTN","ORWCV",19,0)
 . S X=$P(X0,"^",2)
"RTN","ORWCV",20,0)
 . I NODO[(";"_X_";") Q                                  ; if in NODO, dont do section
"RTN","ORWCV",21,0)
 . S STR=STR_X_";"
"RTN","ORWCV",22,0)
 . I '$G(SECT(X)) S VAL=VAL_X_";"                        ; load section in foreground
"RTN","ORWCV",23,0)
 . E  S BACK=BACK_X_";",FILE=FILE_$P(ORLIST(I),"^",2)_";"  ; load section in background
"RTN","ORWCV",24,0)
 Q:BACK=""
"RTN","ORWCV",25,0)
 S ZTIO="ORW THREAD RESOURCE",ZTRTN="BUILD^ORWCV",ZTDTH=$H
"RTN","ORWCV",26,0)
 S (ZTSAVE("DFN"),ZTSAVE("IP"),ZTSAVE("HWND"),ZTSAVE("NEWREM"),ZTSAVE("LOC"),ZTSAVE("BACK"),ZTSAVE("FILE"))=""
"RTN","ORWCV",27,0)
 S ZTDESC="CPRS GUI Background Data Retrieval"
"RTN","ORWCV",28,0)
 D ^%ZTLOAD I '$D(ZTSK) S VAL=STR Q
"RTN","ORWCV",29,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN
"RTN","ORWCV",30,0)
 K ^XTMP(NODE)
"RTN","ORWCV",31,0)
 S ^XTMP(NODE,0)=$$FMADD^XLFDT(DT,1)_U_DT_U_"Background CPRS "_ZTSK
"RTN","ORWCV",32,0)
 ; Start capacity planning timing clock - will be stopped in POLL code
"RTN","ORWCV",33,0)
 I +$G(^KMPTMP("KMPD-CPRS")) S ^KMPTMP("KMPDT","ORWCV",NODE)=$G(ORHTIME)_"^^"_$G(DUZ)_"^"_$G(IO("CLNM"))
"RTN","ORWCV",34,0)
 Q
"RTN","ORWCV",35,0)
BUILD ; called in background by task manager, expects DFN, JobID
"RTN","ORWCV",36,0)
 N NODE,IFLE,ORFNUM,ID,ENT,RTN,INODE,PARAM1,PARAM2,DETAIL,X0,X2
"RTN","ORWCV",37,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN
"RTN","ORWCV",38,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWCV",39,0)
 I $G(^XTMP(NODE,"STOP")) K ^XTMP(NODE) Q  ; client no longer polling
"RTN","ORWCV",40,0)
 I '$D(^XTMP(NODE,0)) Q                    ; XTMP node has been purged
"RTN","ORWCV",41,0)
 L +^XTMP(NODE)
"RTN","ORWCV",42,0)
 S ^XTMP(NODE,"DFN")=DFN
"RTN","ORWCV",43,0)
 ;N $ETRAP,$ESTACK
"RTN","ORWCV",44,0)
 ;S $ETRAP="D ERR^ORWCV Q"
"RTN","ORWCV",45,0)
 I $L($G(FILE),";")>0 F IFLE=1:1:$L(FILE,";") S ORFNUM=$P(FILE,";",IFLE)  Q:'$D(^ORD(101.24,+ORFNUM,0))  S X0=^(0),X2=$G(^(2)) D
"RTN","ORWCV",46,0)
 . S ID=$P(X0,"^",2),ENT=$P(X0,"^",6),RTN=$P(X0,"^",5),PARAM1=$P(X2,"^"),PARAM2=$P(X2,"^",2),INODE=$P(X2,"^",5),DETAIL=""
"RTN","ORWCV",47,0)
 . I $P(X0,"^",18) S DETAIL=$P($G(^ORD(101.24,+$P(X0,"^",18),0)),"^",13),DETAIL=$P($G(^XWB(8994,+DETAIL,0)),"^")  ;DBIA 4011
"RTN","ORWCV",48,0)
 . I '$L(INODE) Q
"RTN","ORWCV",49,0)
 . I '$L(ENT) S LST(IFLE)="0^ERROR: Missing ENTRY POINT field in file 101.24 for "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",50,0)
 . I '$L(RTN) S LST(IFLE)="0^ERROR: Missing ROUTINE field in file 101.24 for "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",51,0)
 . I '$L($T(@(ENT_"^"_RTN))) S LST(IFLE)="0^ERROR: "_ENT_"~"_RTN_" does not exist. See file 101.24 entry: "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",52,0)
 . I ID=50 D:$L($T(STRT3^AWCMCPR1)) STRT3^AWCMCPR1 D  D:$L($T(END^AWCMCPR1)) END^AWCMCPR1 Q  ;Special case for reminders
"RTN","ORWCV",53,0)
 .. I $G(NEWREM) D APPL^ORQQPXRM(.LST,DFN,LOC) I 1
"RTN","ORWCV",54,0)
 .. E  D @(ENT_"^"_RTN_"(.LST,DFN)")
"RTN","ORWCV",55,0)
 .. D LST2XTMP(INODE)
"RTN","ORWCV",56,0)
 . I $L(PARAM1),$L(PARAM2) D @(ENT_"^"_RTN_"(.LST,DFN,PARAM1,PARAM2)"),LST2XTMP(INODE) Q
"RTN","ORWCV",57,0)
 . I $L(PARAM1) D @(ENT_"^"_RTN_"(.LST,DFN,PARAM1)"),LST2XTMP(INODE) Q
"RTN","ORWCV",58,0)
 . D @(ENT_"^"_RTN_"(.LST,DFN)"),LST2XTMP(INODE)
"RTN","ORWCV",59,0)
 S ^XTMP(NODE,"DONE")=1
"RTN","ORWCV",60,0)
 I $G(^XTMP(NODE,"STOP")) K ^XTMP(NODE)
"RTN","ORWCV",61,0)
 L -^XTMP(NODE)
"RTN","ORWCV",62,0)
 Q
"RTN","ORWCV",63,0)
ERR ;Error trap
"RTN","ORWCV",64,0)
 S $ETRAP="D UNWIND^ORWCV Q"
"RTN","ORWCV",65,0)
 I $D(NODE) D
"RTN","ORWCV",66,0)
 . I $D(INODE) S LST(0)="",LST(1)="0^ERROR DURING COVER SHEET BUILD:"_$ZERROR D LST2XTMP(INODE)
"RTN","ORWCV",67,0)
 . S ^XTMP(NODE,"DONE")=1
"RTN","ORWCV",68,0)
 . L -^XTMP(NODE)
"RTN","ORWCV",69,0)
 D @^%ZOSF("ERRTN") ;file error
"RTN","ORWCV",70,0)
 S $ECODE=",UOR70 error during Cover Sheet build,"
"RTN","ORWCV",71,0)
 Q
"RTN","ORWCV",72,0)
UNWIND ;Unwind Error stack
"RTN","ORWCV",73,0)
 Q:$ESTACK>1  ;pop the stack
"RTN","ORWCV",74,0)
 ;add additional code here, if needed
"RTN","ORWCV",75,0)
 Q
"RTN","ORWCV",76,0)
LST2XTMP(ID) ; put the list in ^XTMP(NODE,ID)
"RTN","ORWCV",77,0)
 I $G(^XTMP(NODE,"STOP")) Q
"RTN","ORWCV",78,0)
 N I
"RTN","ORWCV",79,0)
 I $L($G(DETAIL)) S I=0 F  S I=$O(LST(I)) Q:'I  S $P(LST(I),"^",12)=DETAIL
"RTN","ORWCV",80,0)
 K ^XTMP(NODE,ID) M ^XTMP(NODE,ID)=LST S ^XTMP(NODE,ID)=1 K LST
"RTN","ORWCV",81,0)
 Q
"RTN","ORWCV",82,0)
POLL(LST,DFN,IP,HWND) ; poll for completed cover sheet parts
"RTN","ORWCV",83,0)
 N I,ILST,ID,NODE,DONE
"RTN","ORWCV",84,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN,ILST=0,DONE=0
"RTN","ORWCV",85,0)
 I '$D(^XTMP(NODE,"DFN")) Q
"RTN","ORWCV",86,0)
 I ^XTMP(NODE,"DFN")'=DFN S LST(1)="~DONE=1" Q
"RTN","ORWCV",87,0)
 I $G(^XTMP(NODE,"DONE")) S ILST=ILST+1,LST(ILST)="~DONE=1",DONE=1
"RTN","ORWCV",88,0)
 F ID="PROB","CWAD","MEDS","RMND","LABS","VITL","VSIT" D
"RTN","ORWCV",89,0)
 . I '$G(^XTMP(NODE,ID)) Q
"RTN","ORWCV",90,0)
 . S ILST=ILST+1,LST(ILST)="~"_ID
"RTN","ORWCV",91,0)
 . S I=0 F  S I=$O(^XTMP(NODE,ID,I)) Q:'I  S ILST=ILST+1,LST(ILST)="i"_^(I)
"RTN","ORWCV",92,0)
 . K ^XTMP(NODE,ID)
"RTN","ORWCV",93,0)
 ; Stop capacity planning timing clock - was started in START code
"RTN","ORWCV",94,0)
 I DONE K ^XTMP(NODE) I +$G(^KMPTMP("KMPD-CPRS")) S $P(^KMPTMP("KMPDT","ORWCV",NODE),"^",2)=$H
"RTN","ORWCV",95,0)
 Q
"RTN","ORWCV",96,0)
STOP(OK,DFN,IP,HWND) ; stop cover sheet data retrieval
"RTN","ORWCV",97,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN,ILST=0,DONE=0
"RTN","ORWCV",98,0)
 S ^XTMP(NODE,"STOP")=1,OK=1
"RTN","ORWCV",99,0)
 L +^XTMP(NODE)
"RTN","ORWCV",100,0)
 I $G(^XTMP(NODE,"DONE")) K ^XTMP(NODE)
"RTN","ORWCV",101,0)
 L -^XTMP(NODE)
"RTN","ORWCV",102,0)
 Q
"RTN","ORWCV",103,0)
CLEAN ; clean up ^XTMP nodes
"RTN","ORWCV",104,0)
 S X="ORWCV"
"RTN","ORWCV",105,0)
 F  S X=$O(^XTMP(X)) Q:$E(X,1,5)'="ORWCV"  W !,X K ^XTMP(X)
"RTN","ORWCV",106,0)
 Q
"RTN","ORWCV",107,0)
LAB(LST,DFN) ; return labs for patient
"RTN","ORWCV",108,0)
 D:$L($T(STRT2^AWCMCPR1)) STRT2^AWCMCPR1
"RTN","ORWCV",109,0)
 D LIST^ORQOR1(.LST,DFN,"LAB",4,"T-"_$$RNGLAB(DFN),"T","AW",1)
"RTN","ORWCV",110,0)
 D:$L($T(END^AWCMCPR1)) END^AWCMCPR1
"RTN","ORWCV",111,0)
 Q
"RTN","ORWCV",112,0)
 ;
"RTN","ORWCV",113,0)
VST1(ORVISIT,DFN,BEG,END,SKIP) ;
"RTN","ORWCV",114,0)
 N ERR,ERRMSG
"RTN","ORWCV",115,0)
 S ERR=0 ; kludge to return errors
"RTN","ORWCV",116,0)
 D VST(.ORVISIT,DFN,.BEG,.END,$G(SKIP),.ERR,.ERRMSG)
"RTN","ORWCV",117,0)
 I ERR K ORVISIT S ORVISIT(1)=ERRMSG
"RTN","ORWCV",118,0)
 Q
"RTN","ORWCV",119,0)
 ;
"RTN","ORWCV",120,0)
TEST ;D VST(.ZZZ,76,2950101,3050401,777,1,1)
"RTN","ORWCV",121,0)
 Q
"RTN","ORWCV",122,0)
VST(ORVISIT,DFN,BEG,END,SKIP,ERR,ERRMSG) ; return appts/admissions for patient
"RTN","ORWCV",123,0)
 N CHECKERR,VAERR,VASD,BDT,COUNT,DTM,EDT,LOC,NOW,ORQUERY,ORLST,STI,STS,TODAY,I,J,K,XI,XE,X
"RTN","ORWCV",124,0)
 S CHECKERR=($G(ERR)=0) ; kludge to check for errors
"RTN","ORWCV",125,0)
 S NOW=$$NOW^XLFDT(),TODAY=$P(NOW,".",1)
"RTN","ORWCV",126,0)
 I '$G(BEG) S BEG=$$X2FM($$RNGVBEG)
"RTN","ORWCV",127,0)
 I '$G(END) S END=$$X2FM($$RNGVEND)+0.2359
"RTN","ORWCV",128,0)
 S COUNT=0
"RTN","ORWCV",129,0)
 K ^TMP("ORVSTLIST",$J)
"RTN","ORWCV",130,0)
 S VAERR=0
"RTN","ORWCV",131,0)
 I END>NOW D   Q:VAERR  ; get future encounters, past cancels/no-shows from VADPT
"RTN","ORWCV",132,0)
 . S VASD("F")=BEG
"RTN","ORWCV",133,0)
 . S VASD("T")=END
"RTN","ORWCV",134,0)
 . S VASD("W")="123456789"
"RTN","ORWCV",135,0)
 . D SDA^ORQRY01(.ERR,.ERRMSG)
"RTN","ORWCV",136,0)
 . I CHECKERR,ERR K ^UTILITY("VASD",$J) S ORVISIT(1)=ERRMSG Q  ;IA 10061
"RTN","ORWCV",137,0)
 . S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  D
"RTN","ORWCV",138,0)
 . . S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","ORWCV",139,0)
 . . S DTM=$P(XI,U),IEN=$P(XI,U,2),STI=$P(XI,U,3)
"RTN","ORWCV",140,0)
 . . S LOC=$P(XE,U,2),STS=$P(XE,U,3)
"RTN","ORWCV",141,0)
 . . I DTM<TODAY,(STI=""!(STI["I")!(STI="NT")) Q  ; no prior kept appts
"RTN","ORWCV",142,0)
 . . S ^TMP("ORVSTLIST",$J,DTM,"A",1)="A;"_DTM_";"_IEN_U_DTM_U_LOC_U_STS
"RTN","ORWCV",143,0)
 . K ^UTILITY("VASD",$J)
"RTN","ORWCV",144,0)
 I BEG'>NOW D  ;past encounters from ACRP Toolkit - set in CALLBACK
"RTN","ORWCV",145,0)
 . S BDT=BEG
"RTN","ORWCV",146,0)
 . S EDT=$S(END<NOW:END,1:NOW)
"RTN","ORWCV",147,0)
 . D OPEN^SDQ(.ORQUERY)
"RTN","ORWCV",148,0)
 . I '$$ERRCHK^SDQUT() D INDEX^SDQ(.ORQUERY,"PATIENT/DATE","SET")
"RTN","ORWCV",149,0)
 . I '$$ERRCHK^SDQUT() D PAT^SDQ(.ORQUERY,DFN,"SET")
"RTN","ORWCV",150,0)
 . I '$$ERRCHK^SDQUT() D DATE^SDQ(.ORQUERY,BDT,EDT,"SET")
"RTN","ORWCV",151,0)
 . I '$$ERRCHK^SDQUT() D
"RTN","ORWCV",152,0)
 . . S ORLST=$NA(^TMP("ORVSTLIST",$J))
"RTN","ORWCV",153,0)
 . . D SCANCB^SDQ(.ORQUERY,"D CALLBACK^ORWCV(Y,Y0,.ORLST,.ORSTOP)","SET")
"RTN","ORWCV",154,0)
 . I '$$ERRCHK^SDQUT() D ACTIVE^SDQ(.ORQUERY,"TRUE","SET")
"RTN","ORWCV",155,0)
 . I '$$ERRCHK^SDQUT() D SCAN^SDQ(.ORQUERY,"FORWARD")
"RTN","ORWCV",156,0)
 . D CLOSE^SDQ(.ORQUERY)
"RTN","ORWCV",157,0)
 ;
"RTN","ORWCV",158,0)
 I '$G(SKIP) D
"RTN","ORWCV",159,0)
 . N TIM,MOV,X0,Y,MTIM,XTYP,XLOC,HLOC,EARLY,DONE                ; admits
"RTN","ORWCV",160,0)
 . S EARLY=$$X2FM($$RNGVBEG),DONE=0
"RTN","ORWCV",161,0)
 . S TIM="" F  S TIM=$O(^DGPM("ATID1",DFN,TIM)) Q:TIM'>0  D  Q:DONE
"RTN","ORWCV",162,0)
 . . S MOV=0  F  S MOV=$O(^DGPM("ATID1",DFN,TIM,MOV)) Q:MOV'>0  D  Q:DONE
"RTN","ORWCV",163,0)
 . . . S X0=^DGPM(MOV,0),MTIM=$P(X0,U)
"RTN","ORWCV",164,0)
 . . . I MTIM<EARLY S DONE=1 Q
"RTN","ORWCV",165,0)
 . . . S XTYP=$P($G(^DG(405.1,+$P(X0,U,4),0)),U,1)
"RTN","ORWCV",166,0)
 . . . S XLOC=$P($G(^DIC(42,+$P(X0,U,6),0)),U,1),HLOC=+$G(^(44))
"RTN","ORWCV",167,0)
 . . . S ^TMP("ORVSTLIST",$J,MTIM,"I",1)="I;"_MTIM_";"_HLOC_U_MTIM_U_"Inpatient Stay"_U_XLOC_U_XTYP
"RTN","ORWCV",168,0)
 ;
"RTN","ORWCV",169,0)
 S COUNT=0
"RTN","ORWCV",170,0)
 S I=0 F  S I=$O(^TMP("ORVSTLIST",$J,I)) Q:'I  D
"RTN","ORWCV",171,0)
 . S J="" F  S J=$O(^TMP("ORVSTLIST",$J,I,J)) Q:J=""  D
"RTN","ORWCV",172,0)
 . . S K=0 F  S K=$O(^TMP("ORVSTLIST",$J,I,J,K)) Q:'K  D
"RTN","ORWCV",173,0)
 . . . S COUNT=COUNT+1
"RTN","ORWCV",174,0)
 . . . S ORVISIT(COUNT)=^TMP("ORVSTLIST",$J,I,J,K)
"RTN","ORWCV",175,0)
 K ^TMP("ORVSTLIST",$J)
"RTN","ORWCV",176,0)
 Q
"RTN","ORWCV",177,0)
CALLBACK(IEN,NODE0,ARRAY,STOP) ; called back from ACRP Toolkit for encounters
"RTN","ORWCV",178,0)
 ;
"RTN","ORWCV",179,0)
 ; IEN and NODE0 relate to Outpatient Encounter File
"RTN","ORWCV",180,0)
 ; set STOP to 1 if need to quit
"RTN","ORWCV",181,0)
 ;
"RTN","ORWCV",182,0)
 N COUNT,DTM,LOC,OOS,TYPE,XSTAT,XLOC
"RTN","ORWCV",183,0)
 S DTM=+NODE0,COUNT=1
"RTN","ORWCV",184,0)
 S LOC=$P(NODE0,"^",4)
"RTN","ORWCV",185,0)
 S XLOC=$P($G(^SC(+LOC,0)),U),OOS=$G(^("OOS"))
"RTN","ORWCV",186,0)
 I OOS Q              ; ignore OOS locations
"RTN","ORWCV",187,0)
 I $P(NODE0,"^",6) Q  ; not parent encounter
"RTN","ORWCV",188,0)
 S XSTAT=$P($G(^SD(409.63,+$P(NODE0,"^",12),0)),"^")
"RTN","ORWCV",189,0)
 S TYPE=$S($P(NODE0,"^",8)=1:"A",1:"V")
"RTN","ORWCV",190,0)
 I TYPE="V",$D(@ARRAY@(DTM,"V")) S COUNT=$O(@ARRAY@(DTM,"V","A"),-1)+1 ; same d/t
"RTN","ORWCV",191,0)
 S @ARRAY@(DTM,TYPE,COUNT)=TYPE_";"_DTM_";"_LOC_U_DTM_U_XLOC_U_XSTAT
"RTN","ORWCV",192,0)
 Q
"RTN","ORWCV",193,0)
DTLVST(RPT,DFN,IEN,APPTINFO) ; return progress notes / discharge summary
"RTN","ORWCV",194,0)
 N VISIT
"RTN","ORWCV",195,0)
 I $P(APPTINFO,";")="A" D  Q
"RTN","ORWCV",196,0)
 . S VISIT=$$APPT2VST^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",197,0)
 . I VISIT=0 S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",198,0)
 . D DETNOTE^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",199,0)
 I $P(APPTINFO,";")="V" D  Q
"RTN","ORWCV",200,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",201,0)
 . D DETNOTE^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",202,0)
 I $P(APPTINFO,";")="I" D  Q
"RTN","ORWCV",203,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",204,0)
 . D DETSUM^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",205,0)
 . K ^TMP("PXKENC",$J)
"RTN","ORWCV",206,0)
 Q
"RTN","ORWCV",207,0)
X2FM(X) ; return FM date given relative date
"RTN","ORWCV",208,0)
 N %DT S %DT="TS" D ^%DT
"RTN","ORWCV",209,0)
 Q Y
"RTN","ORWCV",210,0)
RNGLAB(DFN) ; return days back for patient
"RTN","ORWCV",211,0)
 N INPT,PAR
"RTN","ORWCV",212,0)
 S INPT=0 I $L($G(^DPT(DFN,.1))) S INPT=1
"RTN","ORWCV",213,0)
 S PAR="ORQQLR DATE RANGE "_$S(INPT:"INPT",1:"OUTPT")
"RTN","ORWCV",214,0)
 Q $$GET^XPAR("ALL",PAR,1,"I")
"RTN","ORWCV",215,0)
 ;
"RTN","ORWCV",216,0)
RNGVBEG() ; return start date for encounters
"RTN","ORWCV",217,0)
 Q $$GET^XPAR("ALL","ORQQCSDR CS RANGE START",1,"I")
"RTN","ORWCV",218,0)
 ;
"RTN","ORWCV",219,0)
RNGVEND() ; return stop date for encounters
"RTN","ORWCV",220,0)
 Q $$GET^XPAR("ALL","ORQQCSDR CS RANGE STOP",1,"I")
"RTN","ORWCV",221,0)
 ;
"RTN","ORWCV",222,0)
RANGES(REC,DFN) ; return ranges given a patient
"RTN","ORWCV",223,0)
 N REC
"RTN","ORWCV",224,0)
 S REC=$$RNGLAB(DFN)_U_$$RNGVBEG_U_$$RNGVEND
"RTN","ORWCV",225,0)
 Q
"RTN","ORWD1")
0^8^B27963897^B27971902
"RTN","ORWD1",1,0)
ORWD1 ; SLC/KCM/REV - GUI Prints; 28-JAN-1999 12:51 ;7/31/06  11:34
"RTN","ORWD1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,140,215,260**;Dec 17, 1997;Build 26
"RTN","ORWD1",3,0)
PRINTS(PRTLST,HLOC,ORWDEV) ; Do the auto-prints after signing orders
"RTN","ORWD1",4,0)
 ; PRTLST(n)=ORIFN;ACT^Chart^Label^Requisition^Service^Work
"RTN","ORWD1",5,0)
 Q:$G(A7RNDBI)  ; per NDBI, to suppress prints during integration
"RTN","ORWD1",6,0)
 N ADEVICE,TMPLST S HLOC=+HLOC_";SC("
"RTN","ORWD1",7,0)
  ; if there is a print device for chart copies, print chart copies
"RTN","ORWD1",8,0)
 D MKLST(2) I $D(TMPLST)>1 D  ; Print Chart Copies
"RTN","ORWD1",9,0)
 . S ADEVICE=+$P($G(ORWDEV),U,1)
"RTN","ORWD1",10,0)
 . I 'ADEVICE S ADEVICE=$$GET^XPAR(HLOC,"ORPF CHART COPY PRINT DEVICE",1,"I")
"RTN","ORWD1",11,0)
 . I ADEVICE D GUI^ORPR02(.TMPLST,ADEVICE,"C",HLOC)
"RTN","ORWD1",12,0)
 D MKLST(3) I $D(TMPLST)>1 D  ; Print Labels
"RTN","ORWD1",13,0)
 . S ADEVICE=+$P($G(ORWDEV),U,2)
"RTN","ORWD1",14,0)
 . I 'ADEVICE S ADEVICE=$$GET^XPAR(HLOC,"ORPF LABEL PRINT DEVICE",1,"I")
"RTN","ORWD1",15,0)
 . I ADEVICE D GUI^ORPR02(.TMPLST,ADEVICE,"L",HLOC)
"RTN","ORWD1",16,0)
 D MKLST(4) I $D(TMPLST)>1 D  ; Print Requisitions
"RTN","ORWD1",17,0)
 . S ADEVICE=+$P($G(ORWDEV),U,3)
"RTN","ORWD1",18,0)
 . I 'ADEVICE S ADEVICE=$$GET^XPAR(HLOC,"ORPF REQUISITION PRINT DEVICE",1,"I")
"RTN","ORWD1",19,0)
 . I ADEVICE D GUI^ORPR02(.TMPLST,ADEVICE,"R",HLOC)
"RTN","ORWD1",20,0)
 D MKLST(5) I $D(TMPLST)>1 D  ; Print Service Copies
"RTN","ORWD1",21,0)
 . D GUI^ORPR02(.TMPLST,"","S",HLOC)
"RTN","ORWD1",22,0)
 D MKLST(6) I $D(TMPLST)>1 D  ; Print Work Copies
"RTN","ORWD1",23,0)
 . S ADEVICE=+$P($G(ORWDEV),U,4)
"RTN","ORWD1",24,0)
 . I 'ADEVICE S ADEVICE=$$GET^XPAR(HLOC,"ORPF WORK COPY PRINT DEVICE",1,"I")
"RTN","ORWD1",25,0)
 . I ADEVICE D GUI^ORPR02(.TMPLST,ADEVICE,"W",HLOC)
"RTN","ORWD1",26,0)
 Q
"RTN","ORWD1",27,0)
MKLST(APIECE) ; Make a list to pass to GUI^ORPR02, called only from PRINTS
"RTN","ORWD1",28,0)
 ; expect PRTLST to be defined, creates new TMPLST
"RTN","ORWD1",29,0)
 N I,J,ORIFN,ACT,NOA,PKG,DLG  K TMPLST
"RTN","ORWD1",30,0)
 S I="",J=0 F  S I=$O(PRTLST(I)) Q:I'>0  D
"RTN","ORWD1",31,0)
 . I ($L(PRTLST(I),U)>1),'$P(PRTLST(I),"^",APIECE) Q
"RTN","ORWD1",32,0)
 . S ORIFN=+PRTLST(I),ACT=+$P(PRTLST(I),";",2)
"RTN","ORWD1",33,0)
 . S NOA=+$P($G(^OR(100,ORIFN,8,ACT,0)),U,12)
"RTN","ORWD1",34,0)
 . I APIECE=2,'$P($G(^ORD(100.02,NOA,1)),U,2) Q  ; no chart copies
"RTN","ORWD1",35,0)
 . I APIECE=6,'$P($G(^ORD(100.02,NOA,1)),U,5) Q  ; no work copies
"RTN","ORWD1",36,0)
 . S PKG=+$P($G(^OR(100,+ORIFN,0)),U,14),DLG=+$P($G(^OR(100,+ORIFN,0)),U,5)
"RTN","ORWD1",37,0)
 . I APIECE=4,PKG=$O(^DIC(9.4,"B","DIETETICS",0)),DLG'=$O(^ORD(101.41,"B","FHW SPECIAL MEAL",0)) Q  ;no requisitions
"RTN","ORWD1",38,0)
 . S J=J+1,TMPLST(J)=$P(PRTLST(I),U)
"RTN","ORWD1",39,0)
 Q
"RTN","ORWD1",40,0)
PARAM(Y,LOC) ;Returns in 'Y' the print parameters
"RTN","ORWD1",41,0)
 ;Y=Prompt for CC^Prompt for L ^Prompt for R ^Prompt for W ^CC device ^L Device ^R Device ^WC device
"RTN","ORWD1",42,0)
 ;Device Params returned in internal;external format, the rest are internal
"RTN","ORWD1",43,0)
 ;CC=Chart Copy
"RTN","ORWD1",44,0)
 ;L=Label
"RTN","ORWD1",45,0)
 ;R=Requisitions
"RTN","ORWD1",46,0)
 ;WC=Work Copy
"RTN","ORWD1",47,0)
 ;'Prompt for' values (internal):
"RTN","ORWD1",48,0)
 ;0 for no prompts- chart copy is automatically generated.
"RTN","ORWD1",49,0)
 ;1 to prompt for chart copy and ask which printer should be used.
"RTN","ORWD1",50,0)
 ;2 to prompt for chart copy and automatically print to the
"RTN","ORWD1",51,0)
 ;  printer defined in the CHART COPY PRINT DEVICE field.
"RTN","ORWD1",52,0)
 ;* don't print.
"RTN","ORWD1",53,0)
 ;LOC=Ptr to location ^SC(LOC,
"RTN","ORWD1",54,0)
 Q:'$G(LOC)
"RTN","ORWD1",55,0)
 S Y=$$BLDIT(LOC)
"RTN","ORWD1",56,0)
 Q
"RTN","ORWD1",57,0)
BLDIT(LOC) ;Get Print parameters
"RTN","ORWD1",58,0)
 Q:'$G(LOC) ""
"RTN","ORWD1",59,0)
 N PARAM,I
"RTN","ORWD1",60,0)
 S PARAM=""
"RTN","ORWD1",61,0)
 F I="ORPF PROMPT FOR CHART COPY","ORPF PROMPT FOR LABELS","ORPF PROMPT FOR REQUISITIONS","ORPF PROMPT FOR WORK COPY" D
"RTN","ORWD1",62,0)
 . S PARAM=PARAM_$$XPAR(I,LOC,"Q")_"^"
"RTN","ORWD1",63,0)
 S PARAM=PARAM_$$XPAR("ORPF CHART COPY PRINT DEVICE",LOC)_"^"
"RTN","ORWD1",64,0)
 S PARAM=PARAM_$$XPAR("ORPF LABEL PRINT DEVICE",LOC)_"^"
"RTN","ORWD1",65,0)
 S PARAM=PARAM_$$XPAR("ORPF REQUISITION PRINT DEVICE",LOC)_"^"
"RTN","ORWD1",66,0)
 S PARAM=PARAM_$$XPAR("ORPF WORK COPY PRINT DEVICE",LOC)_"^"
"RTN","ORWD1",67,0)
 Q PARAM
"RTN","ORWD1",68,0)
COMLOC(LOC,ORDERS)      ; Return common location for orders in list, if any
"RTN","ORWD1",69,0)
 N I
"RTN","ORWD1",70,0)
 S LOC=0,I=0
"RTN","ORWD1",71,0)
 ; get the location for the first order that was signed or released
"RTN","ORWD1",72,0)
 F  S I=$O(ORDERS(I)) Q:'I  D  Q:LOC
"RTN","ORWD1",73,0)
 . I $P(ORDERS(I),U,2)'["R",($P(ORDERS(I),U,2)'["S") Q
"RTN","ORWD1",74,0)
 . S LOC=+$P($G(^OR(100,+ORDERS(I),0)),U,10)
"RTN","ORWD1",75,0)
 ; compare the location to the following orders
"RTN","ORWD1",76,0)
 I LOC F  S I=$O(ORDERS(I)) Q:'I  D  Q:'LOC
"RTN","ORWD1",77,0)
 . I $P(ORDERS(I),U,2)'["R",($P(ORDERS(I),U,2)'["S") Q
"RTN","ORWD1",78,0)
 . I (+$P($G(^OR(100,+ORDERS(I),0)),U,10)'=LOC) S LOC=0
"RTN","ORWD1",79,0)
 Q
"RTN","ORWD1",80,0)
SIG4ONE(REQ,ANORDER)    ; Return 1 if order requires a signature
"RTN","ORWD1",81,0)
 S REQ=0
"RTN","ORWD1",82,0)
 I +$P($G(^OR(100,+ANORDER,0)),U,16) S REQ=1
"RTN","ORWD1",83,0)
 Q
"RTN","ORWD1",84,0)
SIG4ANY(REQ,ORDERS)     ; Return 1 if any order requires a signature
"RTN","ORWD1",85,0)
 N I
"RTN","ORWD1",86,0)
 S I=0,REQ=0
"RTN","ORWD1",87,0)
 F  S I=$O(ORDERS(I)) Q:'I  D  Q:REQ
"RTN","ORWD1",88,0)
 . I +$P($G(^OR(100,+ORDERS(I),0)),U,16) S REQ=1
"RTN","ORWD1",89,0)
 Q
"RTN","ORWD1",90,0)
XPAR(NAME,LOC,FMT) ;Get parameter values
"RTN","ORWD1",91,0)
 Q:'$L(NAME) ""
"RTN","ORWD1",92,0)
 S:'$D(FMT) FMT="B"
"RTN","ORWD1",93,0)
 Q $TR($$GET^XPAR("ALL^"_+LOC_";SC(",NAME,1,FMT),"^",";")
"RTN","ORWD1",94,0)
 ;
"RTN","ORWD1",95,0)
PRINTGUI(ORESULT,HLOC,ORWDEV,PRTLST) ; File|Print orders from GUI
"RTN","ORWD1",96,0)
 ;ORRACT is set here to identify this as a manual reprint
"RTN","ORWD1",97,0)
 N ADEVICE,ORRACT,ORPLST,I,PKG,DLG
"RTN","ORWD1",98,0)
 N BBPKG S BBPKG=+$O(^DIC(9.4,"B","VBECS",0))
"RTN","ORWD1",99,0)
 S PRTLST="",I=0
"RTN","ORWD1",100,0)
 K ORPLST M ORPLST=PRTLST
"RTN","ORWD1",101,0)
 S ORRACT=1,ADEVICE=$P(ORWDEV,U,1),ORESULT=1
"RTN","ORWD1",102,0)
 I +ADEVICE D GUI^ORPR02(.ORPLST,ADEVICE,"C",HLOC)
"RTN","ORWD1",103,0)
 S ADEVICE=$P(ORWDEV,U,2)
"RTN","ORWD1",104,0)
 K ORPLST M ORPLST=PRTLST
"RTN","ORWD1",105,0)
 D INSRTBB^ORWD2(.ORPLST) ; insert BB child Lab orders into ORPLST for printing labels
"RTN","ORWD1",106,0)
 I +ADEVICE D GUI^ORPR02(.ORPLST,ADEVICE,"L",HLOC)
"RTN","ORWD1",107,0)
 ;
"RTN","ORWD1",108,0)
 S ADEVICE=$P(ORWDEV,U,3)
"RTN","ORWD1",109,0)
 K ORPLST M ORPLST=PRTLST
"RTN","ORWD1",110,0)
 ;no FH order requisitions except special meals
"RTN","ORWD1",111,0)
 F  S I=$O(ORPLST(I)) Q:'I  D
"RTN","ORWD1",112,0)
 . S PKG=+$P($G(^OR(100,+ORPLST(I),0)),U,14),DLG=+$P($G(^OR(100,+ORPLST(I),0)),U,5)
"RTN","ORWD1",113,0)
 . I PKG=$O(^DIC(9.4,"B","DIETETICS",0)),DLG'=$O(^ORD(101.41,"B","FHW SPECIAL MEAL",0)) K ORPLST(I)
"RTN","ORWD1",114,0)
 D INSRTBB^ORWD2(.ORPLST) ; insert BB child Lab orders into ORPLST for printing requisitions
"RTN","ORWD1",115,0)
 I +ADEVICE,$D(ORPLST) D GUI^ORPR02(.ORPLST,ADEVICE,"R",HLOC)
"RTN","ORWD1",116,0)
 ;
"RTN","ORWD1",117,0)
 S ADEVICE=$P(ORWDEV,U,4)
"RTN","ORWD1",118,0)
 K ORPLST M ORPLST=PRTLST
"RTN","ORWD1",119,0)
 I +ADEVICE D GUI^ORPR02(.ORPLST,ADEVICE,"W",HLOC)
"RTN","ORWD1",120,0)
 ; D GUI^ORPR02(.ORPLST,"","S",HLOC) no svc copies from File|Print
"RTN","ORWD1",121,0)
 Q
"RTN","ORWD1",122,0)
RVPRINT(OK,HLOC,ORWDEV,PRTLST)  ; print orders from review/sign actions
"RTN","ORWD1",123,0)
 D PRINTS(.PRTLST,HLOC,ORWDEV) S OK=1
"RTN","ORWD1",124,0)
 Q
"RTN","ORWD1",125,0)
SVONLY(OK,HLOC,PRTLST)  ; print service copies only
"RTN","ORWD1",126,0)
 Q:$G(A7RNDBI)  ; per NDBI, to suppress prints during integration
"RTN","ORWD1",127,0)
 N TMPLST,I,J
"RTN","ORWD1",128,0)
 S HLOC=+HLOC_";SC(",OK=1
"RTN","ORWD1",129,0)
 S I="",J=0 F  S I=$O(PRTLST(I)) Q:I'>0  D
"RTN","ORWD1",130,0)
 . I ($L(PRTLST(I),U)>1),'$P(PRTLST(I),U,5) Q
"RTN","ORWD1",131,0)
 . S J=J+1,TMPLST(J)=$P(PRTLST(I),U)
"RTN","ORWD1",132,0)
 I $D(TMPLST)>1 D GUI^ORPR02(.TMPLST,"","S",HLOC)
"RTN","ORWD1",133,0)
 Q
"RTN","ORWDAL33")
0^2^B2071002^B1116079
"RTN","ORWDAL33",1,0)
ORWDAL33 ;SLC/DAN - Allergy calls to support windows ;7/27/06  11:03
"RTN","ORWDAL33",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260**;Dec 17, 1997;Build 26
"RTN","ORWDAL33",3,0)
 ;
"RTN","ORWDAL33",4,0)
CLINUSER(ORY)   ;can user mark allergy as entered in error
"RTN","ORWDAL33",5,0)
 N DIC,X,PRM,Y,ORLST,ORX,PLIST,VALUE
"RTN","ORWDAL33",6,0)
 S DIC=8989.51,DIC(0)="MX",X="OR ALLERGY ENTERED IN ERROR" D ^DIC
"RTN","ORWDAL33",7,0)
 I Y=-1 S ORY=0 Q  ;Parameter not found so quit
"RTN","ORWDAL33",8,0)
 S PRM=+Y
"RTN","ORWDAL33",9,0)
 ;Check USER level
"RTN","ORWDAL33",10,0)
 S ORY=$$GET^XPAR("USR",PRM) I ORY'="" Q
"RTN","ORWDAL33",11,0)
 ;Check USER CLASS
"RTN","ORWDAL33",12,0)
 D ENVAL^XPAR(.ORLST,PRM)
"RTN","ORWDAL33",13,0)
 I ORLST>0 D
"RTN","ORWDAL33",14,0)
 . S ORX="" F  S ORX=$O(ORLST(ORX)) Q:ORX=""  D
"RTN","ORWDAL33",15,0)
 . . Q:ORX'["USR(8930"
"RTN","ORWDAL33",16,0)
 . . I $$ISA^USRLM(DUZ,+ORX) S VALUE(+ORX)=ORLST(ORX,1)
"RTN","ORWDAL33",17,0)
 . S ORX=0 F  S ORX=$O(VALUE(ORX)) Q:'+ORX  D REMOVE(ORX)
"RTN","ORWDAL33",18,0)
 . S ORX=0 F  S ORX=$O(VALUE(ORX)) Q:'+ORX  S VALUE=$G(VALUE)!(VALUE(ORX))
"RTN","ORWDAL33",19,0)
 S ORY=$G(VALUE)
"RTN","ORWDAL33",20,0)
 I ORY'="" Q
"RTN","ORWDAL33",21,0)
 ;Check division and system
"RTN","ORWDAL33",22,0)
 S ORY=$$GET^XPAR("DIV^SYS",PRM) I ORY'="" Q
"RTN","ORWDAL33",23,0)
 S ORY=0 Q
"RTN","ORWDAL33",24,0)
 ;
"RTN","ORWDAL33",25,0)
REMOVE(SUB) ;Remove values at higher level classes
"RTN","ORWDAL33",26,0)
 N IEN
"RTN","ORWDAL33",27,0)
 S IEN=0 F  S IEN=$O(^USR(8930,"AD",SUB,IEN)) Q:'+IEN  D
"RTN","ORWDAL33",28,0)
 .I $D(^USR(8930,"AD",IEN)) D REMOVE(IEN) ;Recursive call
"RTN","ORWDAL33",29,0)
 .K VALUE(IEN)
"RTN","ORWDAL33",30,0)
 Q
"RTN","ORWGAPI4")
0^15^B86012135^B84779852
"RTN","ORWGAPI4",1,0)
ORWGAPI4 ; SLC/STAFF - Graph Data ;8/21/06  07:52
"RTN","ORWGAPI4",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260**;Dec 17, 1997;Build 26
"RTN","ORWGAPI4",3,0)
 ;
"RTN","ORWGAPI4",4,0)
ADMIT(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",5,0)
 N DATE,DATE2,DISCH,LINE,LST,NUM,RESULT,VALUE K LST
"RTN","ORWGAPI4",6,0)
 S ITEM=$G(ITEM,"ADMIT")
"RTN","ORWGAPI4",7,0)
 D ADMITLST^ORWPT(.LST,DFN)
"RTN","ORWGAPI4",8,0)
 S NUM=0
"RTN","ORWGAPI4",9,0)
 F  S NUM=$O(LST(NUM)) Q:NUM<1  D
"RTN","ORWGAPI4",10,0)
 . S LINE=LST(NUM)
"RTN","ORWGAPI4",11,0)
 . S DATE=$P(LINE,U)
"RTN","ORWGAPI4",12,0)
 . I DATE>START Q
"RTN","ORWGAPI4",13,0)
 . S DISCH=$P(LINE,U,5)
"RTN","ORWGAPI4",14,0)
 . S DATE2=$$DISCH^ORWGAPIA(DISCH)
"RTN","ORWGAPI4",15,0)
 . I DATE2="" D
"RTN","ORWGAPI4",16,0)
 .. S DATE2=$$FMADD^ORWGAPIX(DATE,$$LOS^ORWGAPIA(DISCH)+1)
"RTN","ORWGAPI4",17,0)
 .. I DATE2=-1 S DATE2=$$FMADD^ORWGAPIX(DT,1) ; just make it today + 1
"RTN","ORWGAPI4",18,0)
 .. S DATE2=DATE2\1
"RTN","ORWGAPI4",19,0)
 . S VALUE=$P(LINE,U,3)_"  "_$P(LINE,U,4)_U_$P(LINE,U,5,6)
"RTN","ORWGAPI4",20,0)
 . S CNT=CNT+1
"RTN","ORWGAPI4",21,0)
 . S RESULT=405_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",22,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",23,0)
 Q
"RTN","ORWGAPI4",24,0)
 ;
"RTN","ORWGAPI4",25,0)
EDU(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",26,0)
 N DATE,DATE2,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI4",27,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",28,0)
 F  S DATE=$O(^PXRMINDX(9000010.16,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",29,0)
 . I DATE>START Q
"RTN","ORWGAPI4",30,0)
 . S NODE=""
"RTN","ORWGAPI4",31,0)
 . F  S NODE=$O(^PXRMINDX(9000010.16,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",32,0)
 .. D EDU^ORWGAPIA(NODE,.VALUE)
"RTN","ORWGAPI4",33,0)
 .. S VALUE=VALUE("VALUE"),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.16,.06)
"RTN","ORWGAPI4",34,0)
 .. S RESULT=9000010.16_U_ITEM_U_DATE_"^^" ;_VALUE
"RTN","ORWGAPI4",35,0)
 .. S RESULT=9000010.16_U_ITEM_U_DATE_U_DATE2_U ;_VALUE
"RTN","ORWGAPI4",36,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",37,0)
 Q
"RTN","ORWGAPI4",38,0)
 ;
"RTN","ORWGAPI4",39,0)
EXAM(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",40,0)
 N DATE,DATE2,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI4",41,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",42,0)
 F  S DATE=$O(^PXRMINDX(9000010.13,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",43,0)
 . I DATE>START Q
"RTN","ORWGAPI4",44,0)
 . S NODE=""
"RTN","ORWGAPI4",45,0)
 . F  S NODE=$O(^PXRMINDX(9000010.13,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",46,0)
 .. D EXAM^ORWGAPIA(NODE,.VALUE)
"RTN","ORWGAPI4",47,0)
 .. S VALUE=$G(VALUE("VALUE")),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.13,.04)
"RTN","ORWGAPI4",48,0)
 .. S RESULT=9000010.13_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",49,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",50,0)
 Q
"RTN","ORWGAPI4",51,0)
 ;
"RTN","ORWGAPI4",52,0)
HF(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",53,0)
 N DATE,DATE2,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI4",54,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",55,0)
 F  S DATE=$O(^PXRMINDX(9000010.23,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",56,0)
 . I DATE>START Q
"RTN","ORWGAPI4",57,0)
 . S NODE=""
"RTN","ORWGAPI4",58,0)
 . F  S NODE=$O(^PXRMINDX(9000010.23,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",59,0)
 .. D HF^ORWGAPIA(NODE,.VALUE)
"RTN","ORWGAPI4",60,0)
 .. S VALUE=VALUE("VALUE"),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.23,.04)
"RTN","ORWGAPI4",61,0)
 .. S RESULT=9000010.23_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",62,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",63,0)
 Q
"RTN","ORWGAPI4",64,0)
 ;
"RTN","ORWGAPI4",65,0)
IMM(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",66,0)
 N DATE,DATE2,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI4",67,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",68,0)
 F  S DATE=$O(^PXRMINDX(9000010.11,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",69,0)
 . I DATE>START Q
"RTN","ORWGAPI4",70,0)
 . S NODE=""
"RTN","ORWGAPI4",71,0)
 . F  S NODE=$O(^PXRMINDX(9000010.11,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",72,0)
 .. D IMM^ORWGAPIA(NODE,.VALUE)
"RTN","ORWGAPI4",73,0)
 .. S VALUE=$G(VALUE("VALUE")),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.11,.04)
"RTN","ORWGAPI4",74,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI4",75,0)
 .. S RESULT=9000010.11_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",76,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",77,0)
 Q
"RTN","ORWGAPI4",78,0)
 ;
"RTN","ORWGAPI4",79,0)
MH(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",80,0)
 N DATE,DATE2,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI4",81,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",82,0)
 F  S DATE=$O(^PXRMINDX(601.2,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",83,0)
 . I DATE>START Q
"RTN","ORWGAPI4",84,0)
 . S NODE=""
"RTN","ORWGAPI4",85,0)
 . F  S NODE=$O(^PXRMINDX(601.2,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",86,0)
 .. D MH^ORWGAPIA(.VALUE,NODE) S VALUE=$P($G(VALUE(2)),U,2,3)
"RTN","ORWGAPI4",87,0)
 .. S RESULT=601.2_U_ITEM_U_DATE_U_DATE2_U ;_VALUE
"RTN","ORWGAPI4",88,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",89,0)
 Q
"RTN","ORWGAPI4",90,0)
 ;
"RTN","ORWGAPI4",91,0)
OP(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",92,0)
 N DATE,DATE2,NODE,NUM,RESULT,VALUE K VALUE
"RTN","ORWGAPI4",93,0)
 S DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",94,0)
 S NUM=""
"RTN","ORWGAPI4",95,0)
 F  S NUM=$O(^PXRMINDX(45,"ICD0","PNI",DFN,NUM)) Q:NUM=""  D
"RTN","ORWGAPI4",96,0)
 . S DATE=""
"RTN","ORWGAPI4",97,0)
 . F  S DATE=$O(^PXRMINDX(45,"ICD0","PNI",DFN,NUM,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",98,0)
 .. I DATE>START Q
"RTN","ORWGAPI4",99,0)
 .. S NODE=""
"RTN","ORWGAPI4",100,0)
 .. F  S NODE=$O(^PXRMINDX(45,"ICD0","PNI",DFN,NUM,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",101,0)
 ... D PTF^ORWGAPIA(NODE,.VALUE) S VALUE=$G(VALUE("DISCHARGE STATUS"))
"RTN","ORWGAPI4",102,0)
 ... S RESULT=45_"OP"_U_ITEM_U_DATE_U_DATE2_U ;_VALUE
"RTN","ORWGAPI4",103,0)
 ... D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",104,0)
 Q
"RTN","ORWGAPI4",105,0)
 ;
"RTN","ORWGAPI4",106,0)
POV(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",107,0)
 N DATE,DATE2,NODE,RESULT,TYPE,VALUE K VALUE
"RTN","ORWGAPI4",108,0)
 S DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",109,0)
 S TYPE=""
"RTN","ORWGAPI4",110,0)
 F  S TYPE=$O(^PXRMINDX(9000010.07,"PPI",DFN,TYPE)) Q:TYPE=""  D
"RTN","ORWGAPI4",111,0)
 . S DATE=""
"RTN","ORWGAPI4",112,0)
 . F  S DATE=$O(^PXRMINDX(9000010.07,"PPI",DFN,TYPE,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",113,0)
 .. I DATE>START Q
"RTN","ORWGAPI4",114,0)
 .. S NODE=""
"RTN","ORWGAPI4",115,0)
 .. F  S NODE=$O(^PXRMINDX(9000010.07,"PPI",DFN,TYPE,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",116,0)
 ... D POV^ORWGAPIA(NODE,.VALUE)
"RTN","ORWGAPI4",117,0)
 ... S VALUE=VALUE("CLINICAL TERM"),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.07,.15)
"RTN","ORWGAPI4",118,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI4",119,0)
 ... S RESULT=9000010.07_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",120,0)
 ... D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",121,0)
 Q
"RTN","ORWGAPI4",122,0)
 ;
"RTN","ORWGAPI4",123,0)
PROB(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",124,0)
 N DATE,DATE2,DTONSET,DTRESOLV,ICD9,NODE,PRIORITY,PROB,PROBDX,PSTATUS,RESULT,STATUS,VALUE
"RTN","ORWGAPI4",125,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI4",126,0)
 S DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",127,0)
 S STATUS=""
"RTN","ORWGAPI4",128,0)
 F  S STATUS=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS)) Q:STATUS=""  D
"RTN","ORWGAPI4",129,0)
 . S PRIORITY=""
"RTN","ORWGAPI4",130,0)
 . F  S PRIORITY=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY)) Q:PRIORITY=""  D
"RTN","ORWGAPI4",131,0)
 .. S DATE=""
"RTN","ORWGAPI4",132,0)
 .. F  S DATE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",133,0)
 ... I DATE>START Q
"RTN","ORWGAPI4",134,0)
 ... S NODE=""
"RTN","ORWGAPI4",135,0)
 ... F  S NODE=$O(^PXRMINDX(9000011,"PSPI",DFN,STATUS,PRIORITY,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",136,0)
 .... S ^TMP("ORWGRPC TEMP",$J,ITEM,DATE,NODE)=""
"RTN","ORWGAPI4",137,0)
 S ICD9=""
"RTN","ORWGAPI4",138,0)
 F  S ICD9=$O(^TMP("ORWGRPC TEMP",$J,ICD9)) Q:ICD9=""  D
"RTN","ORWGAPI4",139,0)
 . S DATE=""
"RTN","ORWGAPI4",140,0)
 . F  S DATE=$O(^TMP("ORWGRPC TEMP",$J,ICD9,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",141,0)
 .. S NODE=""
"RTN","ORWGAPI4",142,0)
 .. F  S NODE=$O(^TMP("ORWGRPC TEMP",$J,ICD9,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",143,0)
 ... D PROB^ORWGAPIA(.PROB,.PSTATUS,.PROBDX,.DTONSET,.DTRESOLV,NODE)
"RTN","ORWGAPI4",144,0)
 ... S RESULT=9000011_U_ITEM_U_DTONSET_U_DATE2_U_$$EXT^ORWGAPIX(PSTATUS,9000011,.12)
"RTN","ORWGAPI4",145,0)
 ... D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",146,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPI4",147,0)
 Q
"RTN","ORWGAPI4",148,0)
 ;
"RTN","ORWGAPI4",149,0)
PROBX(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",150,0)
 D PROBX4^ORWGAPID(.DATA,ITEM,START,DFN,.CNT,.TMP)
"RTN","ORWGAPI4",151,0)
 Q
"RTN","ORWGAPI4",152,0)
 ;
"RTN","ORWGAPI4",153,0)
PROC(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",154,0)
 N DATE,DATE2,NODE,RESULT,TYPE,VALUE K VALUE
"RTN","ORWGAPI4",155,0)
 S DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",156,0)
 S TYPE=""
"RTN","ORWGAPI4",157,0)
 F  S TYPE=$O(^PXRMINDX(9000010.18,"PPI",DFN,TYPE)) Q:TYPE=""  D
"RTN","ORWGAPI4",158,0)
 . S DATE=""
"RTN","ORWGAPI4",159,0)
 . F  S DATE=$O(^PXRMINDX(9000010.18,"PPI",DFN,TYPE,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",160,0)
 .. I DATE>START Q
"RTN","ORWGAPI4",161,0)
 .. S NODE=""
"RTN","ORWGAPI4",162,0)
 .. F  S NODE=$O(^PXRMINDX(9000010.18,"PPI",DFN,TYPE,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",163,0)
 ... D CPT^ORWGAPIA(NODE,.VALUE)
"RTN","ORWGAPI4",164,0)
 ... S VALUE=VALUE("PRINCIPAL PROCEDURE"),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.18,.07)
"RTN","ORWGAPI4",165,0)
 ... S RESULT=9000010.18_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",166,0)
 ... D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",167,0)
 Q
"RTN","ORWGAPI4",168,0)
 ;
"RTN","ORWGAPI4",169,0)
SKIN(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",170,0)
 N DATE,DATE2,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI4",171,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",172,0)
 F  S DATE=$O(^PXRMINDX(9000010.12,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",173,0)
 . I DATE>START Q
"RTN","ORWGAPI4",174,0)
 . S NODE=""
"RTN","ORWGAPI4",175,0)
 . F  S NODE=$O(^PXRMINDX(9000010.12,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",176,0)
 .. D SKIN^ORWGAPIA(NODE,.VALUE)
"RTN","ORWGAPI4",177,0)
 .. S VALUE=$G(VALUE("VALUE")),VALUE=VALUE_U_$$EVALUE^ORWGAPIU(VALUE,9000010.12,.04)
"RTN","ORWGAPI4",178,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI4",179,0)
 .. S RESULT=9000010.12_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",180,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",181,0)
 Q
"RTN","ORWGAPI4",182,0)
 ;
"RTN","ORWGAPI4",183,0)
SURG(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",184,0)
 N CASE,DATE,DATE2,NUM,PROC,RESULT,RESULTS,SURG,SURGPROC,VALUE K SURG,SURGPROC
"RTN","ORWGAPI4",185,0)
 S DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",186,0)
 D SURG^ORWGAPIA(.SURG,DFN)
"RTN","ORWGAPI4",187,0)
 K SURG(0),SURG(1)
"RTN","ORWGAPI4",188,0)
 S ITEM=$$UP^ORWGAPIX(ITEM)
"RTN","ORWGAPI4",189,0)
 S NUM=0
"RTN","ORWGAPI4",190,0)
 S CASE=0
"RTN","ORWGAPI4",191,0)
 F  S CASE=$O(SURG(CASE)) Q:CASE<1  D
"RTN","ORWGAPI4",192,0)
 . S RESULTS=SURG(CASE)
"RTN","ORWGAPI4",193,0)
 . S PROC=$P(RESULTS,U,3)
"RTN","ORWGAPI4",194,0)
 . I '$L(PROC) Q
"RTN","ORWGAPI4",195,0)
 . S PROC=$$UP^ORWGAPIX(PROC)
"RTN","ORWGAPI4",196,0)
 . I PROC'=ITEM Q
"RTN","ORWGAPI4",197,0)
 . S NUM=NUM+1
"RTN","ORWGAPI4",198,0)
 . S SURGPROC(PROC,NUM)=RESULTS
"RTN","ORWGAPI4",199,0)
 K SURG
"RTN","ORWGAPI4",200,0)
 S PROC=""
"RTN","ORWGAPI4",201,0)
 F  S PROC=$O(SURGPROC(PROC)) Q:PROC=""  D
"RTN","ORWGAPI4",202,0)
 . S NUM=0
"RTN","ORWGAPI4",203,0)
 . F  S NUM=$O(SURGPROC(PROC,NUM)) Q:NUM<1  D
"RTN","ORWGAPI4",204,0)
 .. S RESULTS=SURGPROC(PROC,NUM)
"RTN","ORWGAPI4",205,0)
 .. S DATE=$P(RESULTS,U,5)
"RTN","ORWGAPI4",206,0)
 .. I DATE>START Q
"RTN","ORWGAPI4",207,0)
 .. S VALUE=""
"RTN","ORWGAPI4",208,0)
 .. S RESULT=130_U_PROC_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",209,0)
 .. S CNT=CNT+1
"RTN","ORWGAPI4",210,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",211,0)
 Q
"RTN","ORWGAPI4",212,0)
 ;
"RTN","ORWGAPI4",213,0)
TREAT(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",214,0)
 N DATE,DATE2,NODE,RESULT,VALUE
"RTN","ORWGAPI4",215,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",216,0)
 S NODE=""
"RTN","ORWGAPI4",217,0)
 F  S NODE=$O(^AUPNVTRT("C",DFN,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",218,0)
 . I '$D(^AUPNVTRT("B",ITEM,NODE)) Q
"RTN","ORWGAPI4",219,0)
 . S DATE=+$G(^AUPNVSIT(+$P($G(^AUPNVTRT(NODE,0)),U,3),0)) I 'DATE Q
"RTN","ORWGAPI4",220,0)
 . I DATE>START Q
"RTN","ORWGAPI4",221,0)
 . S VALUE=+$P($G(^AUPNVTRT(NODE,0)),U,4)
"RTN","ORWGAPI4",222,0)
 . S CNT=CNT+1
"RTN","ORWGAPI4",223,0)
 . S RESULT=9000010.15_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",224,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",225,0)
 Q
"RTN","ORWGAPI4",226,0)
 ;
"RTN","ORWGAPI4",227,0)
VISIT(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",228,0)
 N DATE,DATE2,NODE,NUM,RESULT,VALUE
"RTN","ORWGAPI4",229,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",230,0)
 F  S DATE=$O(^AUPNVSIT("AET",DFN,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",231,0)
 . I DATE>START Q
"RTN","ORWGAPI4",232,0)
 . S NODE=""
"RTN","ORWGAPI4",233,0)
 . F  S NODE=$O(^AUPNVSIT("AET",DFN,DATE,ITEM,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",234,0)
 .. S NUM=0
"RTN","ORWGAPI4",235,0)
 .. F  S NUM=$O(^AUPNVSIT("AET",DFN,DATE,ITEM,NODE,NUM)) Q:NUM=""  D
"RTN","ORWGAPI4",236,0)
 ... S DATE2=+$P($G(^AUPNVSIT(NUM,0)),U,18)
"RTN","ORWGAPI4",237,0)
 ... I 'DATE2 S DATE2=DATE+.01
"RTN","ORWGAPI4",238,0)
 ... I +$E($P(DATE2,".",2),1,2)>24 S DATE2=(DATE\1)+.2359
"RTN","ORWGAPI4",239,0)
 ... S VALUE=""
"RTN","ORWGAPI4",240,0)
 ... S CNT=CNT+1
"RTN","ORWGAPI4",241,0)
 ... S RESULT=9000010_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",242,0)
 ... D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",243,0)
 Q
"RTN","ORWGAPI4",244,0)
 ;
"RTN","ORWGAPI4",245,0)
VITAL(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPI4",246,0)
 I ITEM=99999 D BMIDATA^ORWGAPIX(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPI4",247,0)
 N DATE,DATE2,NODE,RESULT,VALUE K VALUE
"RTN","ORWGAPI4",248,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPI4",249,0)
 F  S DATE=$O(^PXRMINDX(120.5,"PI",DFN,ITEM,DATE)) Q:DATE=""  D
"RTN","ORWGAPI4",250,0)
 . I DATE>START Q
"RTN","ORWGAPI4",251,0)
 . S NODE=""
"RTN","ORWGAPI4",252,0)
 . F  S NODE=$O(^PXRMINDX(120.5,"PI",DFN,ITEM,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPI4",253,0)
 .. D VITAL^ORWGAPIA(.VALUE,NODE) S VALUE=$P($G(VALUE(7)),U)
"RTN","ORWGAPI4",254,0)
 .. I $P($G(VALUE(3)),U,2)="PAIN",VALUE=99 S VALUE="(99)"
"RTN","ORWGAPI4",255,0)
 .. S RESULT=120.5_U_ITEM_U_DATE_U_DATE2_U_VALUE
"RTN","ORWGAPI4",256,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPI4",257,0)
 Q
"RTN","ORWGAPI4",258,0)
 ;
"RTN","ORWGAPIA")
0^1^B86031507^B82316738
"RTN","ORWGAPIA",1,0)
ORWGAPIA ; SLC/STAFF - Graph Application Calls ;11/1/06  12:49
"RTN","ORWGAPIA",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,251,260**;Dec 17, 1997;Build 26
"RTN","ORWGAPIA",3,0)
 ;
"RTN","ORWGAPIA",4,0)
AA(IEN) ; $$(ien) -> external display of accession area
"RTN","ORWGAPIA",5,0)
 Q $P($G(^LRO(68,IEN,0)),U)
"RTN","ORWGAPIA",6,0)
AALAB(TEST) ; $$(lab test) -> accession ien^acc name^acc abbrev
"RTN","ORWGAPIA",7,0)
 N AA,DIV
"RTN","ORWGAPIA",8,0)
 S TEST=+$G(TEST)
"RTN","ORWGAPIA",9,0)
 S DIV=+$G(DUZ(2))
"RTN","ORWGAPIA",10,0)
 S AA=+$P($G(^LAB(60,+TEST,8,DIV,0)),U,2)
"RTN","ORWGAPIA",11,0)
 I AA Q AA_U_$$ACCLAB(AA)
"RTN","ORWGAPIA",12,0)
 S AA=+$P($G(^LAB(60,+TEST,8,+$O(^LAB(60,+TEST,8,0)),0)),U,2)
"RTN","ORWGAPIA",13,0)
 I AA Q AA_U_$$ACCLAB(AA)
"RTN","ORWGAPIA",14,0)
 Q ""
"RTN","ORWGAPIA",15,0)
ACC(DATA) ; API - get accession areas   - from ORWGAPI
"RTN","ORWGAPIA",16,0)
 N CNT,IEN,TMP,RESULT,ZERO
"RTN","ORWGAPIA",17,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIA",18,0)
 S CNT=0
"RTN","ORWGAPIA",19,0)
 S IEN=0
"RTN","ORWGAPIA",20,0)
 F  S IEN=$O(^LRO(68,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",21,0)
 . S ZERO=$G(^LRO(68,IEN,0)) I '$L(ZERO) Q
"RTN","ORWGAPIA",22,0)
 . S RESULT="68^"_IEN_U_$P(ZERO,U)_U_$P(ZERO,U,11)
"RTN","ORWGAPIA",23,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIA",24,0)
 Q
"RTN","ORWGAPIA",25,0)
ACCLAB(AA) ; $$(accession ien) -> acc name^acc abbrev
"RTN","ORWGAPIA",26,0)
 N ZERO
"RTN","ORWGAPIA",27,0)
 S ZERO=$G(^LRO(68,AA,0)) I '$L(ZERO) Q ""
"RTN","ORWGAPIA",28,0)
 Q "lab - "_$P(ZERO,U)_U_$P(ZERO,U,11)
"RTN","ORWGAPIA",29,0)
ADDDRUG(NUM1) ; $$(additive) -> drug in 50 else ""
"RTN","ORWGAPIA",30,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",31,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIA",32,0)
 D ZERO^PSS52P6(IEN,,,"RX")
"RTN","ORWGAPIA",33,0)
 S RESULT=$P($G(^TMP($J,"RX",IEN,1)),U)
"RTN","ORWGAPIA",34,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",35,0)
 Q RESULT
"RTN","ORWGAPIA",36,0)
ALLG(IEN) ; $$(ien) -> external display of allergies
"RTN","ORWGAPIA",37,0)
 I IEN Q $P($G(^GMRD(120.83,IEN,0)),U) ; this is for rxn, allergy is free text
"RTN","ORWGAPIA",38,0)
 Q IEN
"RTN","ORWGAPIA",39,0)
CPT(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",40,0)
 D VCPT^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",41,0)
 Q
"RTN","ORWGAPIA",42,0)
DC(IEN) ; $$(ien) -> external display of drug class
"RTN","ORWGAPIA",43,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",44,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIA",45,0)
 D IEN^PSN50P65(IEN,,"RX")
"RTN","ORWGAPIA",46,0)
 S RESULT=$G(^TMP($J,"RX",IEN,1))
"RTN","ORWGAPIA",47,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",48,0)
 Q RESULT
"RTN","ORWGAPIA",49,0)
DISCH(IEN) ; $$(pt movement ien) -> discharge date
"RTN","ORWGAPIA",50,0)
 Q $P($G(^DGPM(+$P($G(^DGPM(+$G(IEN),0)),U,17),0)),U)
"RTN","ORWGAPIA",51,0)
DOCCLASS(DOCTYPE) ; $$(doc type) -> ien of tiu doc class
"RTN","ORWGAPIA",52,0)
 N CONSULTS
"RTN","ORWGAPIA",53,0)
 S DOCTYPE=$E(DOCTYPE,1)
"RTN","ORWGAPIA",54,0)
 I DOCTYPE="P" Q 3
"RTN","ORWGAPIA",55,0)
 I DOCTYPE="D" Q 244
"RTN","ORWGAPIA",56,0)
 I DOCTYPE="C" D CNSLCLAS^TIUSRVD(.CONSULTS) Q CONSULTS
"RTN","ORWGAPIA",57,0)
 Q 0
"RTN","ORWGAPIA",58,0)
DRGCLASS(DRUG) ; $$(drug) -> drug class^classification
"RTN","ORWGAPIA",59,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",60,0)
 I '$G(DRUG) Q ""
"RTN","ORWGAPIA",61,0)
 D DATA^PSS50(DRUG,,,,,"RX")
"RTN","ORWGAPIA",62,0)
 S RESULT=+$G(^TMP($J,"RX",DRUG,25))
"RTN","ORWGAPIA",63,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",64,0)
 Q RESULT_U_"drug - "_$$DC(RESULT)
"RTN","ORWGAPIA",65,0)
DRUG(NUM) ; $$(bcma entry) -> drug in 50 else ""
"RTN","ORWGAPIA",66,0)
 N DONE,DRUG,NUM1
"RTN","ORWGAPIA",67,0)
 S DONE=0,NUM=+$G(NUM)
"RTN","ORWGAPIA",68,0)
 S NUM1=0
"RTN","ORWGAPIA",69,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.5,"B",NUM1)) Q:NUM1<1  S DONE=1 Q
"RTN","ORWGAPIA",70,0)
 I DONE Q NUM1
"RTN","ORWGAPIA",71,0)
 S DRUG=0
"RTN","ORWGAPIA",72,0)
 S NUM1=0
"RTN","ORWGAPIA",73,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.6,"B",NUM1)) Q:NUM1<1  D  I DONE Q
"RTN","ORWGAPIA",74,0)
 . S DRUG=$$ADDDRUG(NUM1)
"RTN","ORWGAPIA",75,0)
 . I DRUG S DONE=1
"RTN","ORWGAPIA",76,0)
 I DONE Q DRUG
"RTN","ORWGAPIA",77,0)
 S DRUG=0
"RTN","ORWGAPIA",78,0)
 S NUM1=0
"RTN","ORWGAPIA",79,0)
 F  S NUM1=$O(^PSB(53.79,NUM,.7,"B",NUM1)) Q:NUM1<1  D  I DONE Q
"RTN","ORWGAPIA",80,0)
 . S DRUG=$$SOLDRUG(NUM1)
"RTN","ORWGAPIA",81,0)
 . I DRUG S DONE=1
"RTN","ORWGAPIA",82,0)
 I DONE Q DRUG
"RTN","ORWGAPIA",83,0)
 Q ""
"RTN","ORWGAPIA",84,0)
DRUGC(VALUES) ; API - get drug classes   - from ORWGAPI
"RTN","ORWGAPIA",85,0)
 N CLASS,IEN,NUM,ROOT K VALUES
"RTN","ORWGAPIA",86,0)
 S NUM=0
"RTN","ORWGAPIA",87,0)
 S ROOT=$$ROOT^PSN50P65(1)
"RTN","ORWGAPIA",88,0)
 S CLASS=""
"RTN","ORWGAPIA",89,0)
 F  S CLASS=$O(@ROOT@(CLASS)) Q:CLASS=""  D
"RTN","ORWGAPIA",90,0)
 . S IEN=0
"RTN","ORWGAPIA",91,0)
 . F  S IEN=$O(@ROOT@(CLASS,IEN)) Q:IEN=""  D
"RTN","ORWGAPIA",92,0)
 .. S NUM=NUM+1
"RTN","ORWGAPIA",93,0)
 .. S VALUES(NUM)="50.605^"_IEN_U_CLASS
"RTN","ORWGAPIA",94,0)
 M ^TMP("ORWGRPC",$J)=VALUES K VALUES
"RTN","ORWGAPIA",95,0)
 Q
"RTN","ORWGAPIA",96,0)
EDU(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",97,0)
 D VPEDU^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",98,0)
 Q
"RTN","ORWGAPIA",99,0)
EXAM(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",100,0)
 D VXAM^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",101,0)
 Q
"RTN","ORWGAPIA",102,0)
GETTIU(ORDATA,IEN) ; from ORWGAPID
"RTN","ORWGAPIA",103,0)
 D TGET^TIUSRVR1(.ORDATA,IEN)
"RTN","ORWGAPIA",104,0)
 Q
"RTN","ORWGAPIA",105,0)
HF(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",106,0)
 D VHF^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",107,0)
 Q
"RTN","ORWGAPIA",108,0)
ICD0(IEN) ; $$(ien) -> external display of IDC0
"RTN","ORWGAPIA",109,0)
 Q $P($G(^ICD0(IEN,0)),U)_" "_$P($G(^ICD0(IEN,0)),U,4)
"RTN","ORWGAPIA",110,0)
ICD9(IEN) ; $$(ien) -> external display of IDC9
"RTN","ORWGAPIA",111,0)
 Q $P($G(^ICD9(IEN,0)),U)_" "_$P($G(^ICD9(IEN,0)),U,3)
"RTN","ORWGAPIA",112,0)
ICPT(IEN,CSD) ; $$(ien) -> external display of CPT
"RTN","ORWGAPIA",113,0)
 N X S X=$$CPT^ICPTCOD($G(IEN),$G(CSD))
"RTN","ORWGAPIA",114,0)
 Q $P(X,U,2)_" "_$E($P(X,U,3),1,30)
"RTN","ORWGAPIA",115,0)
IMM(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",116,0)
 D VIMM^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",117,0)
 Q
"RTN","ORWGAPIA",118,0)
INSIG(NODE) ; $$(node) -> sig
"RTN","ORWGAPIA",119,0)
 N DFN,DNUM,IEN,LNUM,SIG,SUB ; replace this code in v27 with INSIG^ORWGAPIX
"RTN","ORWGAPIA",120,0)
 S DFN=+$G(NODE)
"RTN","ORWGAPIA",121,0)
 S SUB=$P($G(NODE),";",2)
"RTN","ORWGAPIA",122,0)
 S IEN=+$P($G(NODE),";",3)
"RTN","ORWGAPIA",123,0)
 S SIG=""
"RTN","ORWGAPIA",124,0)
 I SUB=5 D
"RTN","ORWGAPIA",125,0)
 . S LNUM=$G(^PS(55,DFN,5,IEN,0))
"RTN","ORWGAPIA",126,0)
 . S DNUM=$G(^PS(55,DFN,5,IEN,.2))
"RTN","ORWGAPIA",127,0)
 . I $L(DNUM),$L(LNUM) D
"RTN","ORWGAPIA",128,0)
 .. S SIG="  Give: "_$$EXT^ORWGAPIX($P(LNUM,U,3),55.06,3)
"RTN","ORWGAPIA",129,0)
 .. S SIG=SIG_" "_$$EXT^ORWGAPIX($P(LNUM,U,7),55.06,7)
"RTN","ORWGAPIA",130,0)
 I SUB="IV" D
"RTN","ORWGAPIA",131,0)
 . S LNUM=$G(^PS(55,DFN,"IV",IEN,0))
"RTN","ORWGAPIA",132,0)
 . S DNUM=$G(^PS(55,DFN,"IV",IEN,.2))
"RTN","ORWGAPIA",133,0)
 . I $L(DNUM),$L(LNUM) D
"RTN","ORWGAPIA",134,0)
 .. S SIG="  Give: "_$P(DNUM,U,2)
"RTN","ORWGAPIA",135,0)
 .. S SIG=SIG_" "_$$EXT^ORWGAPIX($P(LNUM,U,2),55.01,.02)_" "_$P(LNUM,U,9)
"RTN","ORWGAPIA",136,0)
 Q SIG
"RTN","ORWGAPIA",137,0)
ISA(USER,CLASS,ORERR) ; $$(user,user class,err) -> 1 if user in class, else 0
"RTN","ORWGAPIA",138,0)
 Q $$ISA^USRLM(USER,CLASS,.ORERR)
"RTN","ORWGAPIA",139,0)
LAB(ORVALUE,NODE,ITEM) ; from ORWGAPI3
"RTN","ORWGAPIA",140,0)
 D LRPXRM^LRPXAPI(.ORVALUE,NODE,ITEM,"VSC")
"RTN","ORWGAPIA",141,0)
 Q
"RTN","ORWGAPIA",142,0)
LABNAME(Y) ; $$(item ien) -> item name
"RTN","ORWGAPIA",143,0)
 I $P(Y,";")="A",$P(Y,";",2)="S" Q $P(Y,".",2,99)
"RTN","ORWGAPIA",144,0)
 Q $$ITEMNM^LRPXAPIU(Y)
"RTN","ORWGAPIA",145,0)
LABSUM(ORDATA,DFN,DATE1,DATE2,ORSUB) ; from ORWGAPID
"RTN","ORWGAPIA",146,0)
 D EN^LR7OSUM(.ORDATA,DFN,DATE1,DATE2,,80,.ORSUB)
"RTN","ORWGAPIA",147,0)
 Q
"RTN","ORWGAPIA",148,0)
LOS(DGPMIFN) ; $$(pt movement ien) -> length of stay
"RTN","ORWGAPIA",149,0)
 N X D ^DGPMLOS
"RTN","ORWGAPIA",150,0)
 Q +$P($G(X),U,5)
"RTN","ORWGAPIA",151,0)
LRDFN(DFN) ; $$(dfn) -> lrdfn
"RTN","ORWGAPIA",152,0)
 Q $$LRDFN^LRPXAPIU(DFN)
"RTN","ORWGAPIA",153,0)
LRIDT(LRDT) ;  $$(date) -> inverse date
"RTN","ORWGAPIA",154,0)
 Q $$LRIDT^LRPXAPIU(LRDT)
"RTN","ORWGAPIA",155,0)
MEDICINE(ARRAY,DFN) ;
"RTN","ORWGAPIA",156,0)
 N DATE,FILE,IEN,NAME,NUM,REF,VALUES,XREF
"RTN","ORWGAPIA",157,0)
 K ARRAY,^TMP("MCAR",$J),^TMP("OR",$J,"MCAR")
"RTN","ORWGAPIA",158,0)
 D FILE^ORWGAPIU(690,.REF,.XREF)
"RTN","ORWGAPIA",159,0)
 I '$L(REF) Q
"RTN","ORWGAPIA",160,0)
 I $E(REF,$L(REF))="," S REF=$E(REF,1,$L(REF)-1)_")"
"RTN","ORWGAPIA",161,0)
 I $E(REF,$L(REF))="(" S REF=$P(REF,"(")
"RTN","ORWGAPIA",162,0)
 D EN^MCARPS2(DFN)
"RTN","ORWGAPIA",163,0)
 S NUM=0
"RTN","ORWGAPIA",164,0)
 F  S NUM=$O(^TMP("OR",$J,"MCAR","OT",NUM)) Q:NUM<1  D
"RTN","ORWGAPIA",165,0)
 . S VALUES=^TMP("OR",$J,"MCAR","OT",NUM)
"RTN","ORWGAPIA",166,0)
 . S DATE=$$DATETFM^ORWGAPIU($P(VALUES,U,6))
"RTN","ORWGAPIA",167,0)
 . S NAME=$P(VALUES,U) I '$L(NAME) Q
"RTN","ORWGAPIA",168,0)
 . S IEN=+$O(@REF@(XREF,NAME,""))
"RTN","ORWGAPIA",169,0)
 . I DATE,IEN S ARRAY(IEN,DATE)=NAME
"RTN","ORWGAPIA",170,0)
 K ^TMP("MCAR",$J),^TMP("OR",$J,"MCAR")
"RTN","ORWGAPIA",171,0)
 Q
"RTN","ORWGAPIA",172,0)
MEDVAL(VAL) ;
"RTN","ORWGAPIA",173,0)
 N IEN,NAME,NAMES,REF,SEQ,XREF K NAMES,VAL
"RTN","ORWGAPIA",174,0)
 D FILE^ORWGAPIU(690,.REF,.XREF)
"RTN","ORWGAPIA",175,0)
 I '$L(REF) Q
"RTN","ORWGAPIA",176,0)
 I $E(REF,$L(REF))="," S REF=$E(REF,1,$L(REF)-1)_")"
"RTN","ORWGAPIA",177,0)
 I $E(REF,$L(REF))="(" S REF=$P(REF,"(")
"RTN","ORWGAPIA",178,0)
 S NAME=""
"RTN","ORWGAPIA",179,0)
 F  S NAME=$O(@REF@(XREF,NAME)) Q:NAME=""  D
"RTN","ORWGAPIA",180,0)
 . S IEN=0
"RTN","ORWGAPIA",181,0)
 . F  S IEN=$O(@REF@(XREF,NAME,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",182,0)
 .. S NAMES(IEN)=NAME
"RTN","ORWGAPIA",183,0)
 S SEQ=0
"RTN","ORWGAPIA",184,0)
 S IEN=0
"RTN","ORWGAPIA",185,0)
 F  S IEN=$O(NAMES(IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",186,0)
 . S SEQ=SEQ+1
"RTN","ORWGAPIA",187,0)
 . S VAL(SEQ)=690_U_IEN_U_NAMES(IEN)
"RTN","ORWGAPIA",188,0)
 Q
"RTN","ORWGAPIA",189,0)
MH(ORVALUE,NODE) ; from ORWGAPI4
"RTN","ORWGAPIA",190,0)
 D ENDAS^YTAPI10(.ORVALUE,NODE)
"RTN","ORWGAPIA",191,0)
 Q
"RTN","ORWGAPIA",192,0)
NVASIG(NODE) ;  $$(node) -> sig on non-va drug
"RTN","ORWGAPIA",193,0)
 N RESULTS,SIG K RESULTS
"RTN","ORWGAPIA",194,0)
 I '$L(NODE) Q ""
"RTN","ORWGAPIA",195,0)
 D RXNVA(NODE,.RESULTS)
"RTN","ORWGAPIA",196,0)
 S SIG=RESULTS("DOSAGE")
"RTN","ORWGAPIA",197,0)
 S SIG=SIG_" "_RESULTS("MEDICATION ROUTE")
"RTN","ORWGAPIA",198,0)
 S SIG=SIG_" "_RESULTS("SCHEDULE")
"RTN","ORWGAPIA",199,0)
 Q SIG
"RTN","ORWGAPIA",200,0)
OITEM(DATA) ; API - get order display groups   -  from ORWGAPI
"RTN","ORWGAPIA",201,0)
 N CNT,IEN,RESULT,TMP,ZERO
"RTN","ORWGAPIA",202,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIA",203,0)
 S CNT=0
"RTN","ORWGAPIA",204,0)
 S IEN=0
"RTN","ORWGAPIA",205,0)
 F  S IEN=$O(^ORD(100.98,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",206,0)
 . S ZERO=$G(^ORD(100.98,IEN,0)) I '$L(ZERO) Q
"RTN","ORWGAPIA",207,0)
 . S RESULT="100.98^"_IEN_U_$P(ZERO,U)_U_$P(ZERO,U,3)
"RTN","ORWGAPIA",208,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIA",209,0)
 Q
"RTN","ORWGAPIA",210,0)
POINAME(IEN) ; $$(poi entry) - > name and dosage form else ""
"RTN","ORWGAPIA",211,0)
 N NAME,RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",212,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIA",213,0)
 D ZERO^PSS50P7(IEN,,,"RX")
"RTN","ORWGAPIA",214,0)
 S NAME=$P($G(^TMP($J,"RX",IEN,.01)),U)
"RTN","ORWGAPIA",215,0)
 S NAME=NAME_" "_$P($G(^TMP($J,"BOB",IEN,.02)),U,2)
"RTN","ORWGAPIA",216,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",217,0)
 I NAME'=" " Q NAME
"RTN","ORWGAPIA",218,0)
 Q ""
"RTN","ORWGAPIA",219,0)
POV(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",220,0)
 D VPOV^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",221,0)
 Q
"RTN","ORWGAPIA",222,0)
PROB(GMPLLEX,GMPLSTAT,GMPLICD,GMPLODAT,GMPLXDAT,NODE) ; from ORWGAPI4
"RTN","ORWGAPIA",223,0)
 N GMPLPNAM,GMPLDLM,GMPLTXT,GMPLCOND,GMPLPRV,GMPLPRIO
"RTN","ORWGAPIA",224,0)
 D CALL2^GMPLUTL3(NODE)
"RTN","ORWGAPIA",225,0)
 Q
"RTN","ORWGAPIA",226,0)
PTF(NODE,ORVALUE) ; from ORWGAPI3, ORWGAPI4
"RTN","ORWGAPIA",227,0)
 D PTF^DGPTPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",228,0)
 Q
"RTN","ORWGAPIA",229,0)
RAD(NODE,ORVALUE) ; from ORWGAPI3
"RTN","ORWGAPIA",230,0)
 D EN1^RAPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",231,0)
 Q
"RTN","ORWGAPIA",232,0)
RXIN(NODE,ORVALUE) ; from ORWGAPI3
"RTN","ORWGAPIA",233,0)
 D OEL^PSJPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIA",234,0)
 Q
"RTN","ORWGAPIA",235,0)
RXNVA(NODE,ORVALUE,XSTART,XSTOP) ; from ORWGAPI1, ORWGAPI3, ORWGAPID
"RTN","ORWGAPIA",236,0)
 S XSTART=1,XSTOP=1
"RTN","ORWGAPIA",237,0)
 D NVA^PSOPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIA",238,0)
 I '$G(ORVALUE("START DATE")) D
"RTN","ORWGAPIA",239,0)
 . S ORVALUE("START DATE")=$G(ORVALUE("DOCUMENTED DATE"))
"RTN","ORWGAPIA",240,0)
 . S XSTART=0
"RTN","ORWGAPIA",241,0)
 I '$G(ORVALUE("DISCONTINUED DATE")) D
"RTN","ORWGAPIA",242,0)
 . S XSTOP=0
"RTN","ORWGAPIA",243,0)
 Q
"RTN","ORWGAPIA",244,0)
RXOUT(NODE,ORVALUE) ; from ORWGAPI3
"RTN","ORWGAPIA",245,0)
 D PSRX^PSOPXRM1(NODE,.ORVALUE)
"RTN","ORWGAPIA",246,0)
 Q
"RTN","ORWGAPIA",247,0)
SIG(DFN,RXIEN) ; $$(dfn,prescription ien) -> sig
"RTN","ORWGAPIA",248,0)
 N LNUM,SIG K ^TMP($J,"RX")
"RTN","ORWGAPIA",249,0)
 S RXIEN=+$G(RXIEN)
"RTN","ORWGAPIA",250,0)
 D RX^PSO52API(DFN,"RX",RXIEN,,"M",,)
"RTN","ORWGAPIA",251,0)
 S SIG=""
"RTN","ORWGAPIA",252,0)
 S LNUM=0
"RTN","ORWGAPIA",253,0)
 F  S LNUM=$O(^TMP($J,"RX",DFN,RXIEN,"M",LNUM)) Q:LNUM<1  D
"RTN","ORWGAPIA",254,0)
 . S SIG=SIG_$G(^TMP($J,"RX",DFN,RXIEN,"M",LNUM,0))_" "
"RTN","ORWGAPIA",255,0)
 I $L(SIG) S SIG="  Sig: "_$$LOW^ORWGAPIX(SIG)
"RTN","ORWGAPIA",256,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",257,0)
 Q SIG
"RTN","ORWGAPIA",258,0)
SKIN(NODE,ORVALUE) ; from ORWGAPI4
"RTN","ORWGAPIA",259,0)
 D VSKIN^PXPXRM(NODE,.ORVALUE)
"RTN","ORWGAPIA",260,0)
 Q
"RTN","ORWGAPIA",261,0)
SOLDRUG(NUM1) ; $$(iv solution) -> drug in 50 else ""
"RTN","ORWGAPIA",262,0)
 N RESULT K ^TMP($J,"RX")
"RTN","ORWGAPIA",263,0)
 I '$G(IEN) Q ""
"RTN","ORWGAPIA",264,0)
 D ZERO^PSS52P7(IEN,,,"RX")
"RTN","ORWGAPIA",265,0)
 S RESULT=$P($G(^TMP($J,"RX",IEN,1)),U)
"RTN","ORWGAPIA",266,0)
 K ^TMP($J,"RX")
"RTN","ORWGAPIA",267,0)
 Q RESULT
"RTN","ORWGAPIA",268,0)
SURG(ORSURG,DFN) ; from ORWGAPI2, ORWGAPI4
"RTN","ORWGAPIA",269,0)
 D GET^SROGTSR(.ORSURG,DFN)
"RTN","ORWGAPIA",270,0)
 Q
"RTN","ORWGAPIA",271,0)
TAX(IEN) ; $$(ien) -> external display of reminder taxonomy
"RTN","ORWGAPIA",272,0)
 Q $P($G(^PXD(811.2,+$G(IEN),0)),U)
"RTN","ORWGAPIA",273,0)
TITLE(DOCTYPE) ; $$(document type) -> parent ien^parent^parent abbrev
"RTN","ORWGAPIA",274,0)
 N IEN,RESULTS K RESULTS
"RTN","ORWGAPIA",275,0)
 S DOCTYPE=+$G(^TIU(8925,+$G(DOCTYPE),0))
"RTN","ORWGAPIA",276,0)
 S IEN=+$$DOCCLASS^TIULC1(DOCTYPE) I 'IEN Q ""
"RTN","ORWGAPIA",277,0)
 D GETDATA^ORWGAPIX(.RESULTS,8925.1,".01;.02",IEN)
"RTN","ORWGAPIA",278,0)
 I '$L($G(RESULTS(.01))) Q ""
"RTN","ORWGAPIA",279,0)
 Q IEN_U_"note - "_RESULTS(.01)_U_$G(RESULTS(.02))
"RTN","ORWGAPIA",280,0)
TIU(ORVALUE,DOCIEN,ONE,DFN,OLDEST,NEWEST) ; from ORWGAPI1, ORWGAPI3
"RTN","ORWGAPIA",281,0)
 D CONTEXT^TIUSRVLO(.ORVALUE,DOCIEN,ONE,DFN,$G(OLDEST),$G(NEWEST))
"RTN","ORWGAPIA",282,0)
 Q
"RTN","ORWGAPIA",283,0)
TIUTITLE(DATA) ; API - get tiu document titles   - from ORWGAPI
"RTN","ORWGAPIA",284,0)
 N CNT,IEN,RESULT,RESULTS,TMP
"RTN","ORWGAPIA",285,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIA",286,0)
 S CNT=0
"RTN","ORWGAPIA",287,0)
 S IEN=0
"RTN","ORWGAPIA",288,0)
 F  S IEN=$O(^TIU(8925.1,IEN)) Q:IEN<1  D
"RTN","ORWGAPIA",289,0)
 . I $P($G(^TIU(8925.1,IEN,0)),U,4)'="DOC" Q
"RTN","ORWGAPIA",290,0)
 . K RESULTS
"RTN","ORWGAPIA",291,0)
 . D GETDATA^ORWGAPIX(.RESULTS,8925.1,".01;.02",IEN)
"RTN","ORWGAPIA",292,0)
 . I '$L($G(RESULTS(.01))) Q
"RTN","ORWGAPIA",293,0)
 . S RESULT="8925.1^"_IEN_U_RESULTS(.01)_U_$G(RESULTS(.02))
"RTN","ORWGAPIA",294,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIA",295,0)
 Q
"RTN","ORWGAPIA",296,0)
VITAL(ORVALUE,NODE) ; from ORWGAPI4
"RTN","ORWGAPIA",297,0)
 D EN^GMVPXRM(.ORVALUE,NODE)
"RTN","ORWGAPIA",298,0)
 Q
"RTN","ORWGAPIA",299,0)
 ; $$(dfn) -> 1 if patient has data else 0
"RTN","ORWGAPIA",300,0)
ADMITX(DFN) ;
"RTN","ORWGAPIA",301,0)
 Q $O(^DGPM("C",+$G(DFN),0))>0
"RTN","ORWGAPIA",302,0)
ALLERGYX(DFN) ;
"RTN","ORWGAPIA",303,0)
 Q $O(^GMR(120.8,"B",+$G(DFN),0))>0
"RTN","ORWGAPIA",304,0)
BCMAX(DFN) ;
"RTN","ORWGAPIA",305,0)
 Q $O(^PSB(53.79,"B",+$G(DFN),0))>0
"RTN","ORWGAPIA",306,0)
NOTEX(DFN) ;
"RTN","ORWGAPIA",307,0)
 Q $O(^TIU(8925,"C",+$G(DFN),0))>0
"RTN","ORWGAPIA",308,0)
NVAX(DFN) ;
"RTN","ORWGAPIA",309,0)
 Q $L($O(^PXRMINDX("55NVA","PI",+$G(DFN),"")))>0
"RTN","ORWGAPIA",310,0)
SURGX(DFN) ;
"RTN","ORWGAPIA",311,0)
 Q $O(^SRF("B",+$G(DFN),0))>0
"RTN","ORWGAPIA",312,0)
TREATX(DFN) ;
"RTN","ORWGAPIA",313,0)
 Q $L($O(^AUPNVTRT("AA",+$G(DFN),"")))>0
"RTN","ORWGAPIA",314,0)
VISITX(DFN) ;
"RTN","ORWGAPIA",315,0)
 Q $O(^AUPNVSIT("AET",+$G(DFN),0))>0
"RTN","ORWGAPIP")
0^11^B44949534^B44221334
"RTN","ORWGAPIP",1,0)
ORWGAPIP ; SLC/STAFF - Graph Parameters ;11/20/06  08:59
"RTN","ORWGAPIP",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260**;Dec 17, 1997;Build 26
"RTN","ORWGAPIP",3,0)
 ;
"RTN","ORWGAPIP",4,0)
DATES(DAT,REPORTID) ; from ORWGAPI
"RTN","ORWGAPIP",5,0)
 N BEGIN,END,INFO,NEXT,PARAM1,PARAM2,RPT,START,STOP
"RTN","ORWGAPIP",6,0)
 S RPT=+$O(^ORD(101.24,"AC",+$G(REPORTID),0))
"RTN","ORWGAPIP",7,0)
 I 'RPT Q  ; RPT=1150 is exported graph report
"RTN","ORWGAPIP",8,0)
 S PARAM1=$P($G(^ORD(101.24,RPT,2)),U)
"RTN","ORWGAPIP",9,0)
 S PARAM2=$P($G(^ORD(101.24,RPT,2)),U,2)
"RTN","ORWGAPIP",10,0)
 S INFO=$$XGET^ORWGAPIX("ALL","ORWRP TIME/OCC LIMITS INDV",RPT,"I")
"RTN","ORWGAPIP",11,0)
 S BEGIN=$P(INFO,";"),START=$$DATE^ORWGAPIX(BEGIN)
"RTN","ORWGAPIP",12,0)
 S END=$P(INFO,";",2),STOP=$$DATE^ORWGAPIX(END)
"RTN","ORWGAPIP",13,0)
 I START<1 Q
"RTN","ORWGAPIP",14,0)
 I STOP<1 Q
"RTN","ORWGAPIP",15,0)
 S NEXT=1+$O(DAT(""),-1)
"RTN","ORWGAPIP",16,0)
 S DAT(NEXT)=U_BEGIN_" to "_END_"^^^"_INFO_U_START_U_STOP_U_PARAM1_U_PARAM2
"RTN","ORWGAPIP",17,0)
 Q
"RTN","ORWGAPIP",18,0)
 ;
"RTN","ORWGAPIP",19,0)
DELVIEWS(DATA,NAME,PUBLIC) ; from ORWGAPI
"RTN","ORWGAPIP",20,0)
 N ERR,TMP
"RTN","ORWGAPIP",21,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIP",22,0)
 S ERR=0
"RTN","ORWGAPIP",23,0)
 I '$L(NAME) S ERR=1
"RTN","ORWGAPIP",24,0)
 I 'ERR D
"RTN","ORWGAPIP",25,0)
 . S NAME=$$UP^ORWGAPIX(NAME)
"RTN","ORWGAPIP",26,0)
 . I PUBLIC D XDEL^ORWGAPIX("SYS","ORWG GRAPH VIEW",NAME,.ERR)
"RTN","ORWGAPIP",27,0)
 . I 'PUBLIC  D XDEL^ORWGAPIX("USR","ORWG GRAPH VIEW",NAME,.ERR)
"RTN","ORWGAPIP",28,0)
 I TMP S ^TMP(DATA,$J)=ERR,^TMP(DATA,$J,1)=ERR
"RTN","ORWGAPIP",29,0)
 I 'TMP S DATA=ERR,DATA(1)=ERR
"RTN","ORWGAPIP",30,0)
 Q
"RTN","ORWGAPIP",31,0)
 ;
"RTN","ORWGAPIP",32,0)
GETPREF(DATA) ; from ORWGAPI
"RTN","ORWGAPIP",33,0)
 N CNT,NUM,PROF,RESULT,TMP,VAL K PROF
"RTN","ORWGAPIP",34,0)
 I '$O(^PXRMINDX(63,"PI","")) Q  ; graphing is not used if no indexes
"RTN","ORWGAPIP",35,0)
 S VAL=$$XGET^ORWGAPIX("PKG","ORWG GRAPH SETTING",1,"I")
"RTN","ORWGAPIP",36,0)
 I '$L(VAL) Q  ; graphing not used if no pkg param on settings
"RTN","ORWGAPIP",37,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIP",38,0)
 S VAL=$$XGET^ORWGAPIX("DIV^SYS^PKG","ORWG GRAPH SETTING",1,"I")
"RTN","ORWGAPIP",39,0)
 S PROF(1)=VAL
"RTN","ORWGAPIP",40,0)
 S VAL=$$XGET^ORWGAPIX("ALL","ORWG GRAPH SETTING",1,"I")
"RTN","ORWGAPIP",41,0)
 S PROF(0)=VAL
"RTN","ORWGAPIP",42,0)
 S CNT=0
"RTN","ORWGAPIP",43,0)
 S NUM=""
"RTN","ORWGAPIP",44,0)
 F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",45,0)
 . S RESULT=$G(PROF(NUM))
"RTN","ORWGAPIP",46,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",47,0)
 Q
"RTN","ORWGAPIP",48,0)
 ;
"RTN","ORWGAPIP",49,0)
GETSIZE(DATA) ; from ORWGAPI
"RTN","ORWGAPIP",50,0)
 N CNT,NUM,PROF,RESULT,TMP K PROF
"RTN","ORWGAPIP",51,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIP",52,0)
 D XGETLST^ORWGAPIX(.PROF,"USR","ORWG GRAPH SIZING")
"RTN","ORWGAPIP",53,0)
 S CNT=0
"RTN","ORWGAPIP",54,0)
 S NUM=""
"RTN","ORWGAPIP",55,0)
 F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",56,0)
 . S RESULT=$G(PROF(NUM))
"RTN","ORWGAPIP",57,0)
 . D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",58,0)
 Q
"RTN","ORWGAPIP",59,0)
 ;
"RTN","ORWGAPIP",60,0)
GETVIEWS(DATA,ALL,PUBLIC,EXT) ; from ORWGAPI
"RTN","ORWGAPIP",61,0)
 N CNT,FIRST,NUM,PIECE,PROF,RESULT,RESULT1,SECOND,TMP,VALUE K PROF
"RTN","ORWGAPIP",62,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIP",63,0)
 I PUBLIC D
"RTN","ORWGAPIP",64,0)
 . I ALL=1 D XGETLST^ORWGAPIX(.PROF,"SYS","ORWG GRAPH VIEW") ; get list of public views
"RTN","ORWGAPIP",65,0)
 . I ALL'=1 D XGETWP^ORWGAPIX(.PROF,"SYS","ORWG GRAPH VIEW",ALL) ; get a public view definition
"RTN","ORWGAPIP",66,0)
 I 'PUBLIC D
"RTN","ORWGAPIP",67,0)
 . I ALL=1 D XGETLST^ORWGAPIX(.PROF,"USR","ORWG GRAPH VIEW") ; get list of personal views
"RTN","ORWGAPIP",68,0)
 . I ALL'=1 D XGETWP^ORWGAPIX(.PROF,"USR","ORWG GRAPH VIEW",ALL) ; get a personal view definition
"RTN","ORWGAPIP",69,0)
 S CNT=0
"RTN","ORWGAPIP",70,0)
 I 'EXT D  Q
"RTN","ORWGAPIP",71,0)
 . S NUM=""
"RTN","ORWGAPIP",72,0)
 . F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",73,0)
 .. I ALL=1 S RESULT=$P($G(PROF(NUM)),U)
"RTN","ORWGAPIP",74,0)
 .. I ALL'=1 S RESULT=$G(PROF(NUM,0))
"RTN","ORWGAPIP",75,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIP",76,0)
 S NUM=""
"RTN","ORWGAPIP",77,0)
 F  S NUM=$O(PROF(NUM)) Q:NUM=""  D
"RTN","ORWGAPIP",78,0)
 . S RESULT=$G(PROF(NUM,0))
"RTN","ORWGAPIP",79,0)
 . S PIECE=0
"RTN","ORWGAPIP",80,0)
 . F  S PIECE=PIECE+1 S VALUE=$P(RESULT,"|",PIECE) D:$L(VALUE)  Q:'$L($P(RESULT,"|",PIECE+1,999))
"RTN","ORWGAPIP",81,0)
 .. S FIRST=$P(VALUE,"~"),SECOND=$P(VALUE,"~",2)
"RTN","ORWGAPIP",82,0)
 .. I FIRST=0 S CNT=CNT+1,RESULT1="0^"_SECOND_U_$$FILENAME^ORWGAPIT(SECOND)_" <any>"
"RTN","ORWGAPIP",83,0)
 .. I FIRST'=0 S CNT=CNT+1,RESULT1=FIRST_U_SECOND_U_$$EVALUE^ORWGAPIU(SECOND,FIRST)
"RTN","ORWGAPIP",84,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT1,TMP,.CNT)
"RTN","ORWGAPIP",85,0)
 Q
"RTN","ORWGAPIP",86,0)
 ;
"RTN","ORWGAPIP",87,0)
INISET ; from ORWGAPIU initial setup of package parameters
"RTN","ORWGAPIP",88,0)
 N ERR,RPTNUM
"RTN","ORWGAPIP",89,0)
 S RPTNUM=1150
"RTN","ORWGAPIP",90,0)
 D SETPREF(.ERR,"63;53.79;55;55NVA;52;70;120.5|BCEFGHIK|1|4|90||100||",9) ; default public settings
"RTN","ORWGAPIP",91,0)
 I '$D(^ORD(101.24,RPTNUM,0)) D  ; make sure report has been added
"RTN","ORWGAPIP",92,0)
 . L +^ORD(101.24,0):20 I '$T Q
"RTN","ORWGAPIP",93,0)
 . S $P(^ORD(101.24,0),U,3)=RPTNUM,$P(^(0),U,4)=$P(^(0),U,4)+1
"RTN","ORWGAPIP",94,0)
 . S ^ORD(101.24,RPTNUM,0)="ORWG GRAPHING^OR_GRAPHS^^2^^^1^R^^^^G^^T"
"RTN","ORWGAPIP",95,0)
 . S ^ORD(101.24,RPTNUM,2)="^^Graphing (local only)^Graphing"
"RTN","ORWGAPIP",96,0)
 . L -^ORD(101.24,0)
"RTN","ORWGAPIP",97,0)
 . D INDEX^ORWGAPIX("^ORD(101.24,",RPTNUM)
"RTN","ORWGAPIP",98,0)
 D XEN^ORWGAPIX("PKG","ORWRP REPORT LIST",12,RPTNUM)
"RTN","ORWGAPIP",99,0)
 D XVIEWS ; *****
"RTN","ORWGAPIP",100,0)
 Q
"RTN","ORWGAPIP",101,0)
 ;
"RTN","ORWGAPIP",102,0)
PUBLIC(USER) ; from ORWGAPI
"RTN","ORWGAPIP",103,0)
 N ERR,IDX,ORSRV,USRCLASS,VAL K USRCLASS
"RTN","ORWGAPIP",104,0)
 S VAL=0
"RTN","ORWGAPIP",105,0)
 I '$G(USER) Q VAL
"RTN","ORWGAPIP",106,0)
 S ORSRV=$$GET1^DIQ(200,DUZ,29,"I")
"RTN","ORWGAPIP",107,0)
 D XGETLST1^ORWGAPIX(.USRCLASS,"SYS","ORWG GRAPH PUBLIC EDITOR CLASS","Q",.ERR)
"RTN","ORWGAPIP",108,0)
 I ERR Q VAL
"RTN","ORWGAPIP",109,0)
 S IDX=0
"RTN","ORWGAPIP",110,0)
 F  S IDX=$O(USRCLASS(IDX)) Q:'IDX  D  Q:VAL
"RTN","ORWGAPIP",111,0)
 . I $$ISA^ORWGAPIA(USER,$P(USRCLASS(IDX),U,2),.ERR) S VAL=1
"RTN","ORWGAPIP",112,0)
 Q VAL
"RTN","ORWGAPIP",113,0)
 ;
"RTN","ORWGAPIP",114,0)
RPTPARAM(IEN) ; from ORWGAPI
"RTN","ORWGAPIP",115,0)
 N NODE,VAL
"RTN","ORWGAPIP",116,0)
 S VAL=""
"RTN","ORWGAPIP",117,0)
 S NODE=$$UP^XLFSTR($P($G(^ORD(101.24,+$G(IEN),2)),U,1,2))
"RTN","ORWGAPIP",118,0)
 I $L(NODE)<2 Q VAL
"RTN","ORWGAPIP",119,0)
 Q NODE
"RTN","ORWGAPIP",120,0)
 ;
"RTN","ORWGAPIP",121,0)
SETPREF(DATA,VAL,PUBLIC) ; from ORWGAPI
"RTN","ORWGAPIP",122,0)
 N ERR,TMP
"RTN","ORWGAPIP",123,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIP",124,0)
 S ERR=0
"RTN","ORWGAPIP",125,0)
 I '$L(VAL) S ERR=1
"RTN","ORWGAPIP",126,0)
 I 'ERR D
"RTN","ORWGAPIP",127,0)
 . S VAL=$$UP^ORWGAPIX(VAL)
"RTN","ORWGAPIP",128,0)
 . I PUBLIC=9 D XEN^ORWGAPIX("PKG","ORWG GRAPH SETTING",1,VAL,.ERR) ; only on postinit
"RTN","ORWGAPIP",129,0)
 . I PUBLIC D XEN^ORWGAPIX("SYS","ORWG GRAPH SETTING",1,VAL,.ERR)
"RTN","ORWGAPIP",130,0)
 . I 'PUBLIC D XEN^ORWGAPIX("USR","ORWG GRAPH SETTING",1,VAL,.ERR)
"RTN","ORWGAPIP",131,0)
 I TMP S ^TMP(DATA,$J)=ERR,^TMP(DATA,$J,1)=ERR
"RTN","ORWGAPIP",132,0)
 I 'TMP S DATA=ERR,DATA(1)=ERR
"RTN","ORWGAPIP",133,0)
 Q
"RTN","ORWGAPIP",134,0)
 ;
"RTN","ORWGAPIP",135,0)
SETSIZE(DATA,VAL) ; from ORWGAPI
"RTN","ORWGAPIP",136,0)
 N ERR,NAME,NUM,VALUE,VALUES,TMP
"RTN","ORWGAPIP",137,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIP",138,0)
 S ERR=0
"RTN","ORWGAPIP",139,0)
 I '$L($O(VAL(0))) S ERR=1
"RTN","ORWGAPIP",140,0)
 I 'ERR D
"RTN","ORWGAPIP",141,0)
 . S NUM=0
"RTN","ORWGAPIP",142,0)
 . F  S NUM=$O(VAL(NUM)) Q:NUM<1  D  Q:ERR
"RTN","ORWGAPIP",143,0)
 .. S VALUES=VAL(NUM)
"RTN","ORWGAPIP",144,0)
 .. S VALUES=$$UP^ORWGAPIX(VALUES)
"RTN","ORWGAPIP",145,0)
 .. S NAME=$P(VALUES,U)
"RTN","ORWGAPIP",146,0)
 .. S VALUE=$P(VALUES,U,2)
"RTN","ORWGAPIP",147,0)
 .. D XEN^ORWGAPIX("USR","ORWG GRAPH SIZING",NAME,VALUE,.ERR)
"RTN","ORWGAPIP",148,0)
 I TMP S ^TMP(DATA,$J)=ERR,^TMP(DATA,$J,1)=ERR
"RTN","ORWGAPIP",149,0)
 I 'TMP S DATA=ERR,DATA(1)=ERR
"RTN","ORWGAPIP",150,0)
 Q
"RTN","ORWGAPIP",151,0)
 ;
"RTN","ORWGAPIP",152,0)
SETVIEWS(DATA,NAME,PUBLIC,VAL) ; from ORWGAPI
"RTN","ORWGAPIP",153,0)
 N ERR,TMP
"RTN","ORWGAPIP",154,0)
 D RETURN^ORWGAPIU(.TMP,.DATA)
"RTN","ORWGAPIP",155,0)
 S ERR=0
"RTN","ORWGAPIP",156,0)
 I '$L(NAME) S ERR=1
"RTN","ORWGAPIP",157,0)
 I '$L($O(VAL(""))) S ERR=1
"RTN","ORWGAPIP",158,0)
 I 'ERR D
"RTN","ORWGAPIP",159,0)
 . S NAME=$$UP^ORWGAPIX(NAME)
"RTN","ORWGAPIP",160,0)
 . S VAL=NAME
"RTN","ORWGAPIP",161,0)
 . I PUBLIC D XEN^ORWGAPIX("SYS","ORWG GRAPH VIEW",NAME,.VAL,.ERR)
"RTN","ORWGAPIP",162,0)
 . I 'PUBLIC  D XEN^ORWGAPIX("USR","ORWG GRAPH VIEW",NAME,.VAL,.ERR)
"RTN","ORWGAPIP",163,0)
 I TMP S ^TMP(DATA,$J)=ERR,^TMP(DATA,$J,1)=ERR
"RTN","ORWGAPIP",164,0)
 I 'TMP S DATA=ERR,DATA(1)=ERR
"RTN","ORWGAPIP",165,0)
 Q
"RTN","ORWGAPIP",166,0)
 ;
"RTN","ORWGAPIP",167,0)
XVIEWS ; conversion on v26t41 *****
"RTN","ORWGAPIP",168,0)
 N CNT,DATA,ERR,NAME,NUM,NUM1,SYSNAME,VIEWS,VIEWDEF,VIEWDIV
"RTN","ORWGAPIP",169,0)
 K DATA,SYSNAME,VIEWS,VIEWDEF,VIEWDIV
"RTN","ORWGAPIP",170,0)
 D XGETLST^ORWGAPIX(.VIEWS,"SYS","ORWG GRAPH VIEW")
"RTN","ORWGAPIP",171,0)
 S NUM=0
"RTN","ORWGAPIP",172,0)
 F  S NUM=$O(VIEWS(NUM)) Q:NUM<1  D
"RTN","ORWGAPIP",173,0)
 . S NAME=$P(VIEWS(NUM),U)
"RTN","ORWGAPIP",174,0)
 . I NAME="" Q
"RTN","ORWGAPIP",175,0)
 . S SYSNAME(NAME)=""
"RTN","ORWGAPIP",176,0)
 K VIEWS
"RTN","ORWGAPIP",177,0)
 D XGETLST^ORWGAPIX(.VIEWS,"DIV","ORWG GRAPH VIEW")
"RTN","ORWGAPIP",178,0)
 S NUM=0
"RTN","ORWGAPIP",179,0)
 F  S NUM=$O(VIEWS(NUM)) Q:NUM<1  D
"RTN","ORWGAPIP",180,0)
 . S NAME=$P(VIEWS(NUM),U)
"RTN","ORWGAPIP",181,0)
 . I NAME="" Q
"RTN","ORWGAPIP",182,0)
 . I '$D(SYSNAME(NAME)) D
"RTN","ORWGAPIP",183,0)
 .. K VIEWDEF,VIEWDIV
"RTN","ORWGAPIP",184,0)
 .. D XGETWP^ORWGAPIX(.VIEWDIV,"DIV","ORWG GRAPH VIEW",NAME)
"RTN","ORWGAPIP",185,0)
 .. S CNT=0
"RTN","ORWGAPIP",186,0)
 .. S NUM1=""
"RTN","ORWGAPIP",187,0)
 .. F  S NUM1=$O(VIEWDIV(NUM1)) Q:NUM1=""  D
"RTN","ORWGAPIP",188,0)
 ... S CNT=CNT+1
"RTN","ORWGAPIP",189,0)
 ... S VIEWDEF(CNT)=$G(VIEWDIV(NUM1,0))
"RTN","ORWGAPIP",190,0)
 .. D SETVIEWS^ORWGAPIP(.DATA,NAME,1,.VIEWDEF)
"RTN","ORWGAPIP",191,0)
 . D XDEL^ORWGAPIX("DIV","ORWG GRAPH VIEW",NAME,.ERR)
"RTN","ORWGAPIP",192,0)
 Q
"RTN","ORWGAPIP",193,0)
 ;
"RTN","ORWGAPIR")
0^14^B42620788^B42089877
"RTN","ORWGAPIR",1,0)
ORWGAPIR ; SLC/STAFF - Graph API Router ;8/21/06  07:52
"RTN","ORWGAPIR",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260**;Dec 17, 1997;Build 26
"RTN","ORWGAPIR",3,0)
 ;
"RTN","ORWGAPIR",4,0)
DATA(DATA,ITEM,FILE,START,DFN,CNT,TMP) ; from ORWGAPI
"RTN","ORWGAPIR",5,0)
 S DFN=+$G(DFN) I 'DFN Q
"RTN","ORWGAPIR",6,0)
 S FILE=$G(FILE) I '$L(FILE) Q
"RTN","ORWGAPIR",7,0)
 S ITEM=$G(ITEM) I '$L(ITEM) Q
"RTN","ORWGAPIR",8,0)
 I FILE=52 D OUTRX^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",9,0)
 I FILE=53.79 D BCMA^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",10,0)
 I FILE=55 D INRX^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",11,0)
 I FILE="55NVAE" D NVAE^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",12,0)
 I FILE="55NVA" D NVA^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",13,0)
 I FILE=63 D LAB^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",14,0)
 I FILE="63AP" D LAB^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",15,0)
 I FILE="63BB" D BBDATA^ORWGAPIB(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",16,0)
 I FILE="63MI" D LAB^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",17,0)
 I FILE=70 D RAD^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",18,0)
 I FILE=100 D ORDER^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",19,0)
 I FILE=120.5 D VITAL^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",20,0)
 I FILE=120.8 D ADVERSE^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",21,0)
 I FILE=601.2 D MH^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",22,0)
 I FILE=9000010.07 D POV^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",23,0)
 I FILE=9000010.11 D IMM^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",24,0)
 I FILE=9000010.12 D SKIN^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",25,0)
 I FILE=9000010.13 D EXAM^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",26,0)
 I FILE=9000010.16 D EDU^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",27,0)
 I FILE=9000010.18 D PROC^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",28,0)
 I FILE=9000010.23 D HF^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",29,0)
 I FILE=9000011 D PROB^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",30,0)
 I FILE=9999911 D PROBX^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",31,0)
 I FILE="45OP" D OP^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",32,0)
 I FILE="45DX" D DX^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",33,0)
 I FILE=9000010 D VISIT^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",34,0)
 I FILE=405 D ADMIT^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",35,0)
 I FILE=130 D SURG^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",36,0)
 I FILE=8925 D NOTE^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",37,0)
 I FILE=9000010.15 D TREAT^ORWGAPI4(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",38,0)
 I FILE=690 D MED^ORWGAPI3(.DATA,ITEM,START,DFN,.CNT,TMP) Q
"RTN","ORWGAPIR",39,0)
 Q
"RTN","ORWGAPIR",40,0)
 ;
"RTN","ORWGAPIR",41,0)
ITEMS(ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,CNT,TMP) ; from ORWGAPI
"RTN","ORWGAPIR",42,0)
 S FMT=$G(FMT,3),OLDEST=+$G(OLDEST),NEWEST=+$G(NEWEST),CNT=+$G(CNT)
"RTN","ORWGAPIR",43,0)
 I (TYPE=70)!(TYPE=100)!(TYPE=120.5)!(TYPE=601.2) D STD(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",44,0)
 I (TYPE=9000010.11)!(TYPE=9000010.12)!(TYPE=9000010.13) D STD(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",45,0)
 I (TYPE=9000010.15)!(TYPE=9000010.16)!(TYPE=9000010.23) D STD(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",46,0)
 I (TYPE=9000010.07)!(TYPE=9000010.18) D STD1(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",47,0)
 I (TYPE=52)!(TYPE=55) D STD2(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",48,0)
 I TYPE=63 D LAB^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",49,0)
 I TYPE=9000010 D VISITS^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",50,0)
 I TYPE=9000010.15 D TREAT^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",51,0)
 I TYPE=9000011 D PL^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",52,0)
 I TYPE=9999911 D PLX^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",53,0)
 I TYPE=405 D ADMITS^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",54,0)
 I TYPE=50.605 D DC^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",55,0)
 I TYPE=68 D AA^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",56,0)
 I TYPE=8925.1 D TITLE^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",57,0)
 I TYPE=53.79 D BCMA^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",58,0)
 I TYPE=120.8 D ADVERSE^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",59,0)
 I TYPE=130 D SURGERY^ORWGAPI2(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",60,0)
 I TYPE=8925 D NOTES^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",61,0)
 I TYPE=690 D MED^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",62,0)
 S TYPE=$$UP^ORWGAPIX(TYPE)
"RTN","ORWGAPIR",63,0)
 I $E(TYPE,1,2)=45 D REG^ORWGAPI2(.ITEMS,DFN,TYPE,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",64,0)
 I TYPE="55NVAE" D NVAE^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",65,0)
 I TYPE="55NVA" D NVA^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",66,0)
 I TYPE="63AP" D AP^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",67,0)
 I TYPE="63BB" D BBITEM^ORWGAPIB(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",68,0)
 I TYPE="63MI" D MI^ORWGAPI1(.ITEMS,DFN,FMT,OLDEST,NEWEST,.CNT,TMP) Q
"RTN","ORWGAPIR",69,0)
 Q
"RTN","ORWGAPIR",70,0)
 ;
"RTN","ORWGAPIR",71,0)
STD(ITEMS,DFN,FILE,FMT,OLDEST,NEWEST,CNT,TMP) ;
"RTN","ORWGAPIR",72,0)
 N DATE,ITEM,OK,RESULT
"RTN","ORWGAPIR",73,0)
 S ITEM=""
"RTN","ORWGAPIR",74,0)
 F  S ITEM=$O(^PXRMINDX(FILE,"PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIR",75,0)
 . S OK=0
"RTN","ORWGAPIR",76,0)
 . I FMT=6 D
"RTN","ORWGAPIR",77,0)
 .. S DATE=OLDEST
"RTN","ORWGAPIR",78,0)
 .. F  S DATE=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPIR",79,0)
 ... S CNT=CNT+1
"RTN","ORWGAPIR",80,0)
 ... S OK=1
"RTN","ORWGAPIR",81,0)
 ... S RESULT=FILE_U_ITEM
"RTN","ORWGAPIR",82,0)
 . I FMT=3 D
"RTN","ORWGAPIR",83,0)
 .. S DATE=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,""),-1)
"RTN","ORWGAPIR",84,0)
 .. I 'DATE Q
"RTN","ORWGAPIR",85,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",86,0)
 .. S OK=1
"RTN","ORWGAPIR",87,0)
 .. S RESULT=FILE_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)_"^^"_DATE
"RTN","ORWGAPIR",88,0)
 .. I FILE=100 S RESULT=RESULT_U_$$OGROUP^ORWGAPIU(ITEM)
"RTN","ORWGAPIR",89,0)
 . I FMT=0 D
"RTN","ORWGAPIR",90,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",91,0)
 .. S OK=1
"RTN","ORWGAPIR",92,0)
 .. S RESULT=FILE_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)
"RTN","ORWGAPIR",93,0)
 . I OK D SETUP^ORWGAPIU(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIR",94,0)
 I FILE=120.5 D BMIITEMS^ORWGAPIX(.ITEMS,.CNT,TMP) Q
"RTN","ORWGAPIR",95,0)
 Q
"RTN","ORWGAPIR",96,0)
 ;
"RTN","ORWGAPIR",97,0)
STD1(ITEMS,DFN,FILE,FMT,OLDEST,NEWEST,CNT,TMP) ;
"RTN","ORWGAPIR",98,0)
 N DATE,ITEM,OK,RESULT,TYPE
"RTN","ORWGAPIR",99,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPIR",100,0)
 S TYPE=""
"RTN","ORWGAPIR",101,0)
 F  S TYPE=$O(^PXRMINDX(FILE,"PPI",DFN,TYPE)) Q:TYPE=""  D
"RTN","ORWGAPIR",102,0)
 . S ITEM=""
"RTN","ORWGAPIR",103,0)
 . F  S ITEM=$O(^PXRMINDX(FILE,"PPI",DFN,TYPE,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIR",104,0)
 .. S OK=0
"RTN","ORWGAPIR",105,0)
 .. I FMT=6 D
"RTN","ORWGAPIR",106,0)
 ... S DATE=OLDEST
"RTN","ORWGAPIR",107,0)
 ... F  S DATE=$O(^PXRMINDX(FILE,"PPI",DFN,TYPE,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPIR",108,0)
 .... S CNT=CNT+1
"RTN","ORWGAPIR",109,0)
 .... S OK=1
"RTN","ORWGAPIR",110,0)
 .... S RESULT=FILE_U_ITEM
"RTN","ORWGAPIR",111,0)
 .. I FMT=3 D
"RTN","ORWGAPIR",112,0)
 ... S DATE=$O(^PXRMINDX(FILE,"PPI",DFN,TYPE,ITEM,""),-1)
"RTN","ORWGAPIR",113,0)
 ... I DATE S ^TMP("ORWGRPC TEMP",$J,ITEM,DATE)=""
"RTN","ORWGAPIR",114,0)
 .. I FMT=0 D
"RTN","ORWGAPIR",115,0)
 ... S CNT=CNT+1
"RTN","ORWGAPIR",116,0)
 ... S OK=1
"RTN","ORWGAPIR",117,0)
 ... S RESULT=FILE_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)
"RTN","ORWGAPIR",118,0)
 .. I OK D SETUP^ORWGAPIU(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIR",119,0)
 I FMT=3 D
"RTN","ORWGAPIR",120,0)
 . S ITEM=""
"RTN","ORWGAPIR",121,0)
 . F  S ITEM=$O(^TMP("ORWGRPC TEMP",$J,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIR",122,0)
 .. S DATE=$O(^TMP("ORWGRPC TEMP",$J,ITEM,""),-1)
"RTN","ORWGAPIR",123,0)
 .. I 'DATE Q
"RTN","ORWGAPIR",124,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",125,0)
 .. S RESULT=FILE_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)_"^^"_DATE
"RTN","ORWGAPIR",126,0)
 .. D SETUP^ORWGAPIU(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIR",127,0)
 K ^TMP("ORWGRPC TEMP",$J)
"RTN","ORWGAPIR",128,0)
 Q
"RTN","ORWGAPIR",129,0)
 ;
"RTN","ORWGAPIR",130,0)
STD2(ITEMS,DFN,FILE,FMT,OLDEST,NEWEST,CNT,TMP) ;
"RTN","ORWGAPIR",131,0)
 N DATE,DATE2,ITEM,OK,RESULT
"RTN","ORWGAPIR",132,0)
 S ITEM=""
"RTN","ORWGAPIR",133,0)
 F  S ITEM=$O(^PXRMINDX(FILE,"PI",DFN,ITEM)) Q:ITEM=""  D
"RTN","ORWGAPIR",134,0)
 . S OK=0
"RTN","ORWGAPIR",135,0)
 . I FMT=6 D
"RTN","ORWGAPIR",136,0)
 .. S DATE=0
"RTN","ORWGAPIR",137,0)
 .. F  S DATE=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,DATE)) Q:DATE=""  Q:DATE>NEWEST  D  Q:OK
"RTN","ORWGAPIR",138,0)
 ... S DATE2=""
"RTN","ORWGAPIR",139,0)
 ... F  S DATE2=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,DATE,DATE2)) Q:DATE2=""  D
"RTN","ORWGAPIR",140,0)
 .... I DATE2<OLDEST Q
"RTN","ORWGAPIR",141,0)
 .... S CNT=CNT+1
"RTN","ORWGAPIR",142,0)
 .... S OK=1
"RTN","ORWGAPIR",143,0)
 .... S RESULT=FILE_U_ITEM
"RTN","ORWGAPIR",144,0)
 . I FMT=3 D
"RTN","ORWGAPIR",145,0)
 .. S DATE=$O(^PXRMINDX(FILE,"PI",DFN,ITEM,""),-1)
"RTN","ORWGAPIR",146,0)
 .. I 'DATE Q
"RTN","ORWGAPIR",147,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",148,0)
 .. S OK=1
"RTN","ORWGAPIR",149,0)
 .. S RESULT=FILE_U_ITEM_"^^"_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)_"^^"_DATE
"RTN","ORWGAPIR",150,0)
 .. S RESULT=RESULT_U_$$DRGCLASS^ORWGAPIA(ITEM)
"RTN","ORWGAPIR",151,0)
 . I FMT=0 D
"RTN","ORWGAPIR",152,0)
 .. S CNT=CNT+1
"RTN","ORWGAPIR",153,0)
 .. S OK=1
"RTN","ORWGAPIR",154,0)
 .. S RESULT=FILE_U_ITEM_U_$$EVALUE^ORWGAPIU(ITEM,FILE,.01)
"RTN","ORWGAPIR",155,0)
 .. S RESULT=RESULT_U_$$DRGCLASS^ORWGAPIA(ITEM)
"RTN","ORWGAPIR",156,0)
 . I OK D SETUP^ORWGAPIU(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIR",157,0)
 Q
"RTN","ORWGAPIR",158,0)
 ;
"RTN","ORWGAPIT")
0^10^B58427487^B58271745
"RTN","ORWGAPIT",1,0)
ORWGAPIT ; SLC/STAFF - Graph Item Types ;11/20/06  08:58
"RTN","ORWGAPIT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260**;Dec 17, 1997;Build 26
"RTN","ORWGAPIT",3,0)
 ;
"RTN","ORWGAPIT",4,0)
COMPTYPE(FILE) ; $$(file) -> hs component abbrv   - from ORWGAPID
"RTN","ORWGAPIT",5,0)
 N COMP,COMPNAME,COMPS,NUM,OK K COMPS
"RTN","ORWGAPIT",6,0)
 S COMPNAME=$$COMPNAME(FILE)_"]"
"RTN","ORWGAPIT",7,0)
 D COMP^ORWRP2(.COMPS)
"RTN","ORWGAPIT",8,0)
 S COMP=""
"RTN","ORWGAPIT",9,0)
 S OK=0
"RTN","ORWGAPIT",10,0)
 S NUM=0
"RTN","ORWGAPIT",11,0)
 D
"RTN","ORWGAPIT",12,0)
 . F  S NUM=$O(COMPS(NUM)) Q:NUM<1  D  I OK Q
"RTN","ORWGAPIT",13,0)
 .. S COMP=COMPS(NUM)
"RTN","ORWGAPIT",14,0)
 .. I COMP[COMPNAME,COMPNAME=$P($P(COMP,U,2),"[",2) S OK=1
"RTN","ORWGAPIT",15,0)
 Q COMP
"RTN","ORWGAPIT",16,0)
 ;
"RTN","ORWGAPIT",17,0)
COMPNAME(FILE) ; $$(file) -> hs component abbrv
"RTN","ORWGAPIT",18,0)
 I FILE=63 Q "CH"
"RTN","ORWGAPIT",19,0)
 I FILE=120.5 Q "VSD"
"RTN","ORWGAPIT",20,0)
 I FILE=120.8 Q "ADR"
"RTN","ORWGAPIT",21,0)
 I FILE=52 Q "RXOP"
"RTN","ORWGAPIT",22,0)
 I FILE=55 Q "RXUD"
"RTN","ORWGAPIT",23,0)
 I FILE=70 Q "II"
"RTN","ORWGAPIT",24,0)
 I FILE=9000010.11 Q "IM"
"RTN","ORWGAPIT",25,0)
 I FILE=9000010.12 Q "ST"
"RTN","ORWGAPIT",26,0)
 I FILE=9000010.13 Q "EXAM"
"RTN","ORWGAPIT",27,0)
 I FILE=9000010.18 Q "CPT"
"RTN","ORWGAPIT",28,0)
 I FILE=9000011 Q "PLL"
"RTN","ORWGAPIT",29,0)
 I FILE=9999911 Q "PLL"
"RTN","ORWGAPIT",30,0)
 I FILE=9000010.23 Q "HF"
"RTN","ORWGAPIT",31,0)
 I FILE=9000010.07 Q "OD"
"RTN","ORWGAPIT",32,0)
 I FILE=9000010.16 Q "ED"
"RTN","ORWGAPIT",33,0)
 I FILE=601.2 Q "MHPE"
"RTN","ORWGAPIT",34,0)
 I FILE=100 Q "ORC"
"RTN","ORWGAPIT",35,0)
 I FILE="45OP" Q "PRC"
"RTN","ORWGAPIT",36,0)
 I FILE="45DX" Q "DD"
"RTN","ORWGAPIT",37,0)
 I FILE="63AP" Q "SP"
"RTN","ORWGAPIT",38,0)
 I FILE="63BB" Q "BT"
"RTN","ORWGAPIT",39,0)
 I FILE="63MI" Q "MIC"
"RTN","ORWGAPIT",40,0)
 I FILE=9000010 Q "CVP"
"RTN","ORWGAPIT",41,0)
 I FILE=405 Q "ADC"
"RTN","ORWGAPIT",42,0)
 I FILE="55NVAE" Q "RXNV"
"RTN","ORWGAPIT",43,0)
 I FILE="55NVA" Q "RXNV"
"RTN","ORWGAPIT",44,0)
 I FILE=53.79 Q "BCMA"
"RTN","ORWGAPIT",45,0)
 I FILE=130 Q "SR"
"RTN","ORWGAPIT",46,0)
 I FILE=8925 Q "CNB"
"RTN","ORWGAPIT",47,0)
 I FILE=9000010.15 Q "TP"
"RTN","ORWGAPIT",48,0)
 I FILE=690 Q "MEDF"
"RTN","ORWGAPIT",49,0)
 Q ""
"RTN","ORWGAPIT",50,0)
 ;
"RTN","ORWGAPIT",51,0)
FILENAME(FILE) ; $$(file) -> filename   - from ORWGAPIP
"RTN","ORWGAPIT",52,0)
 I FILE=63 Q "LAB TESTS"
"RTN","ORWGAPIT",53,0)
 I FILE=120.5 Q "VITALS"
"RTN","ORWGAPIT",54,0)
 I FILE=120.8 Q "ALLERGIES"
"RTN","ORWGAPIT",55,0)
 I FILE=52 Q "MEDICATION,OUTPATIENT"
"RTN","ORWGAPIT",56,0)
 I FILE=55 Q "MEDICATION,INPATIENT"
"RTN","ORWGAPIT",57,0)
 I FILE=70 Q "RADIOLOGY EXAMS"
"RTN","ORWGAPIT",58,0)
 I FILE=9000010.11 Q "IMMUNIZATIONS"
"RTN","ORWGAPIT",59,0)
 I FILE=9000010.12 Q "SKIN TESTS"
"RTN","ORWGAPIT",60,0)
 I FILE=9000010.13 Q "EXAMS"
"RTN","ORWGAPIT",61,0)
 I FILE=9000010.18 Q "PROCEDURES"
"RTN","ORWGAPIT",62,0)
 I FILE=9000011 Q "PROBLEMS"
"RTN","ORWGAPIT",63,0)
 I FILE=9999911 Q "PROBLEMS-DURATION" ;**************
"RTN","ORWGAPIT",64,0)
 I FILE=9000010.23 Q "HEALTH FACTORS"
"RTN","ORWGAPIT",65,0)
 I FILE=9000010.07 Q "PURPOSE OF VISIT"
"RTN","ORWGAPIT",66,0)
 I FILE=9000010.16 Q "PATIENT EDUCATION"
"RTN","ORWGAPIT",67,0)
 I FILE=601.2 Q "MENTAL HEALTH"
"RTN","ORWGAPIT",68,0)
 I FILE=100 Q "ORDERS"
"RTN","ORWGAPIT",69,0)
 I FILE="45OP" Q "REGISTRATION OP/PROC"
"RTN","ORWGAPIT",70,0)
 I FILE="45DX" Q "REGISTRATION DX"
"RTN","ORWGAPIT",71,0)
 I FILE="63AP" Q "ANATOMIC PATHOLOGY"
"RTN","ORWGAPIT",72,0)
 I FILE="63BB" Q "BLOOD PRODUCTS"
"RTN","ORWGAPIT",73,0)
 I FILE="63MI" Q "MICROBIOLOGY"
"RTN","ORWGAPIT",74,0)
 I FILE=9000010 Q "VISITS"
"RTN","ORWGAPIT",75,0)
 I FILE=405 Q "ADMISSIONS"
"RTN","ORWGAPIT",76,0)
 I FILE="55NVAE" Q "MEDICATION,NON-VA-EVENT" ;*****
"RTN","ORWGAPIT",77,0)
 I FILE="55NVA" Q "MEDICATION,NON-VA"
"RTN","ORWGAPIT",78,0)
 I FILE=53.79 Q "MEDICATION,BCMA"
"RTN","ORWGAPIT",79,0)
 I FILE=50.605 Q "DRUG CLASS"
"RTN","ORWGAPIT",80,0)
 I FILE=68 Q "LAB ACC AREA"
"RTN","ORWGAPIT",81,0)
 I FILE=8925.1 Q "NOTE TITLE"
"RTN","ORWGAPIT",82,0)
 I FILE=100.98 Q "ORDER DISPLAY GROUP"
"RTN","ORWGAPIT",83,0)
 I FILE=811.2 Q "REMINDER TAXONOMY"
"RTN","ORWGAPIT",84,0)
 I FILE=130 Q "SURGERY"
"RTN","ORWGAPIT",85,0)
 I FILE=8925 Q "NOTES"
"RTN","ORWGAPIT",86,0)
 I FILE=9000010.15 Q "TREATMENTS"
"RTN","ORWGAPIT",87,0)
 I FILE=690 Q "MEDICINE"
"RTN","ORWGAPIT",88,0)
 Q ""
"RTN","ORWGAPIT",89,0)
 ;
"RTN","ORWGAPIT",90,0)
FILECHK(FILES) ;
"RTN","ORWGAPIT",91,0)
 ; get parameter string of excluded files
"RTN","ORWGAPIT",92,0)
 N CHECK,NUM,ORSRV,VAL
"RTN","ORWGAPIT",93,0)
 S ORSRV=$$GET1^DIQ(200,DUZ,29,"I")
"RTN","ORWGAPIT",94,0)
 S CHECK=$$XGET^ORWGAPIX("USR^SRV.`"_+$G(ORSRV)_"^DIV^SYS^PKG","ORWG GRAPH EXCLUDE DATA TYPE",1,"I")
"RTN","ORWGAPIT",95,0)
 S CHECK=CHECK_";"
"RTN","ORWGAPIT",96,0)
 S NUM=0
"RTN","ORWGAPIT",97,0)
 F  S NUM=$O(FILES(NUM)) Q:NUM<1  D
"RTN","ORWGAPIT",98,0)
 . S VAL=FILES(NUM)
"RTN","ORWGAPIT",99,0)
 . S VAL=$P(VAL,U)_";"
"RTN","ORWGAPIT",100,0)
 . I CHECK[VAL K FILES(NUM)
"RTN","ORWGAPIT",101,0)
 Q
"RTN","ORWGAPIT",102,0)
 ;
"RTN","ORWGAPIT",103,0)
GETFILES(FILES) ;
"RTN","ORWGAPIT",104,0)
 ; file #^file name^graph type^lookup file^lookup global^lookup index
"RTN","ORWGAPIT",105,0)
 ; commenting out a line setting FILES will inactivate that type
"RTN","ORWGAPIT",106,0)
 S FILES(1)="63^LAB TESTS^1^60^LAB(60,^B^^CH^"
"RTN","ORWGAPIT",107,0)
 S FILES(2)="120.5^VITALS^1^120.51^GMRD(120.51,^B^^VSD^"
"RTN","ORWGAPIT",108,0)
 S FILES(3)="52^MEDICATION,OUTPATIENT^3^50^PSDRUG(^B^^RXOP^"
"RTN","ORWGAPIT",109,0)
 S FILES(4)="55^MEDICATION,INPATIENT^3^50^PSDRUG(^B^^RXUD^"
"RTN","ORWGAPIT",110,0)
 S FILES(5)="70^RADIOLOGY EXAMS^2^71^RAMIS(71,^B^rad^II^"
"RTN","ORWGAPIT",111,0)
 S FILES(6)="9000010.11^IMMUNIZATIONS^2^9999999.14^AUTTIMM(^B^imm^IM^"
"RTN","ORWGAPIT",112,0)
 S FILES(7)="9000010.12^SKIN TESTS^2^9999999.28^AUTTSK(^B^skin^ST^"
"RTN","ORWGAPIT",113,0)
 S FILES(8)="9000010.13^EXAMS^2^9999999.15,^AUTTEXAM(^B^exam^EXAM^"
"RTN","ORWGAPIT",114,0)
 S FILES(9)="9000010.18^PROCEDURES^2^81^ICPT(^C^proc^CPT^"
"RTN","ORWGAPIT",115,0)
 S FILES(10)="9000011^PROBLEMS^2^80^ICD9(^B^prob^PLL^" ;***
"RTN","ORWGAPIT",116,0)
 S FILES(11)="9000010.23^HEALTH FACTORS^2^9999999.64^AUTTHF(,^B^hf^HF^"
"RTN","ORWGAPIT",117,0)
 S FILES(12)="9000010.07^PURPOSE OF VISIT^2^80^ICD9(^B^pov^OD^"
"RTN","ORWGAPIT",118,0)
 S FILES(13)="9000010.16^PATIENT EDUCATION^2^9999999.09^AUTTEDT(^B^edu^ED^"
"RTN","ORWGAPIT",119,0)
 S FILES(14)="601.2^MENTAL HEALTH^2^601^YTT(601,^B^mh^MHPE^"
"RTN","ORWGAPIT",120,0)
 S FILES(15)="100^ORDERS^2^101.43^ORD(101.43,^B^order^ORC^"
"RTN","ORWGAPIT",121,0)
 S FILES(16)="45OP^REGISTRATION OP/PROC^2^*^^^op^PRC^"
"RTN","ORWGAPIT",122,0)
 S FILES(17)="45DX^REGISTRATION DX^2^*^^^dx^DD^"
"RTN","ORWGAPIT",123,0)
 S FILES(18)="63AP^ANATOMIC PATHOLOGY^2^*^^^ap^SP^"
"RTN","ORWGAPIT",124,0)
 S FILES(19)="63MI^MICROBIOLOGY^2^*^^^micro^MIC^"
"RTN","ORWGAPIT",125,0)
 S FILES(20)="9000010^VISITS^3^44^SC(^B^^CVP^"
"RTN","ORWGAPIT",126,0)
 S FILES(21)="405^ADMISSIONS^3^*^^^^ADC^"
"RTN","ORWGAPIT",127,0)
 ;S FILES(22)="55NVAE^MEDICATION,NON-VA-EVENT^2^50.7^PS(50.7,^B^^RXNV^"
"RTN","ORWGAPIT",128,0)
 S FILES(23)="53.79^MEDICATION,BCMA^2^50.7^PS(50.7,^B^^BCMA^"
"RTN","ORWGAPIT",129,0)
 S FILES(24)="130^SURGERY^2^81^ICPT(^C^surg^SR^"
"RTN","ORWGAPIT",130,0)
 S FILES(25)="8925^NOTES^2^*^^^note^CNB^"
"RTN","ORWGAPIT",131,0)
 ;S FILES(26)="9000010.15^TREATMENTS^2^9999999.17,^AUTTTRT(^B^treat^TP^"
"RTN","ORWGAPIT",132,0)
 S FILES(27)="120.8^ALLERGIES^2^*^^^allg^ADR^"
"RTN","ORWGAPIT",133,0)
 S FILES(28)="63BB^BLOOD BANK^2^66^LAB(66,^B^bb^BT^"
"RTN","ORWGAPIT",134,0)
 ;S FILES(29)="9999911^PROBLEMS-DURATION^3^80^ICD9(^B^prob^PLL^" ;***
"RTN","ORWGAPIT",135,0)
 S FILES(30)="55NVA^MEDICATION,NON-VA^3^50.7^PS(50.7,^B^^RXNV^"
"RTN","ORWGAPIT",136,0)
 S FILES(31)="690^MEDICINE^2^*^^^med^MEDF^"
"RTN","ORWGAPIT",137,0)
 S FILES(2000)="811.2^Reminder Taxonomy"
"RTN","ORWGAPIT",138,0)
 S FILES(3000)="50.605^Drug Class"
"RTN","ORWGAPIT",139,0)
 Q
"RTN","ORWGAPIT",140,0)
 ;
"RTN","ORWGAPIT",141,0)
TYPES(TYPES,DFN,SUB,TMP) ; from ORWGAPI
"RTN","ORWGAPIT",142,0)
 N CNT,FILES,ITEM,MEDARRAY,NUM,OK,SEQ K FILES,MEDARRAY
"RTN","ORWGAPIT",143,0)
 S TMP=$G(TMP)
"RTN","ORWGAPIT",144,0)
 D GETFILES(.FILES)
"RTN","ORWGAPIT",145,0)
 D FILECHK(.FILES)
"RTN","ORWGAPIT",146,0)
 I SUB D
"RTN","ORWGAPIT",147,0)
 . I $D(FILES(18)) D
"RTN","ORWGAPIT",148,0)
 .. S FILES(1801)="63AP;O^AP: Organ"
"RTN","ORWGAPIT",149,0)
 .. S FILES(1802)="63AP;T^AP: Test"
"RTN","ORWGAPIT",150,0)
 .. S FILES(1803)="63AP;D^AP: Disease"
"RTN","ORWGAPIT",151,0)
 .. S FILES(1804)="63AP;I^AP: ICD9"
"RTN","ORWGAPIT",152,0)
 .. S FILES(1805)="63AP;E^AP: Etiology"
"RTN","ORWGAPIT",153,0)
 .. S FILES(1806)="63AP;F^AP: Function"
"RTN","ORWGAPIT",154,0)
 .. S FILES(1807)="63AP;P^AP: Procedure"
"RTN","ORWGAPIT",155,0)
 .. S FILES(1808)="63AP;M^AP: Morphology"
"RTN","ORWGAPIT",156,0)
 .. S FILES(1809)="63AP;S^AP: Specimen"
"RTN","ORWGAPIT",157,0)
 . I $D(FILES(19)) D
"RTN","ORWGAPIT",158,0)
 .. S FILES(1901)="63MI;A^Microbiology: Antibiotic"
"RTN","ORWGAPIT",159,0)
 .. S FILES(1902)="63MI;T^Microbiology: Test"
"RTN","ORWGAPIT",160,0)
 .. S FILES(1903)="63MI;S^Microbiology: Specimen"
"RTN","ORWGAPIT",161,0)
 .. S FILES(1904)="63MI;O^Microbiology: Organism"
"RTN","ORWGAPIT",162,0)
 .. ;S FILES(1905)="63MI;M^Microbiology: TB Drug"
"RTN","ORWGAPIT",163,0)
 I 'SUB D
"RTN","ORWGAPIT",164,0)
 . K FILES(2000)
"RTN","ORWGAPIT",165,0)
 . K FILES(3000)
"RTN","ORWGAPIT",166,0)
 I DFN D
"RTN","ORWGAPIT",167,0)
 . I '$L($O(^PXRMINDX(63,"PI",DFN,""))) K FILES(1)
"RTN","ORWGAPIT",168,0)
 . I '$L($O(^PXRMINDX(120.5,"PI",DFN,""))) K FILES(2)
"RTN","ORWGAPIT",169,0)
 . I '$L($O(^PXRMINDX(52,"PI",DFN,""))) K FILES(3)
"RTN","ORWGAPIT",170,0)
 . I '$L($O(^PXRMINDX(55,"PI",DFN,""))) K FILES(4)
"RTN","ORWGAPIT",171,0)
 . I '$L($O(^PXRMINDX(70,"PI",DFN,""))) K FILES(5)
"RTN","ORWGAPIT",172,0)
 . I '$L($O(^PXRMINDX(9000010.11,"PI",DFN,""))) K FILES(6)
"RTN","ORWGAPIT",173,0)
 . I '$L($O(^PXRMINDX(9000010.12,"PI",DFN,""))) K FILES(7)
"RTN","ORWGAPIT",174,0)
 . I '$L($O(^PXRMINDX(9000010.13,"PI",DFN,""))) K FILES(8)
"RTN","ORWGAPIT",175,0)
 . I '$L($O(^PXRMINDX(9000010.18,"PPI",DFN,""))) K FILES(9)
"RTN","ORWGAPIT",176,0)
 . I '$L($O(^PXRMINDX(9000011,"PSPI",DFN,""))) K FILES(10),FILES(29)
"RTN","ORWGAPIT",177,0)
 . I '$L($O(^PXRMINDX(9000010.23,"PI",DFN,""))) K FILES(11)
"RTN","ORWGAPIT",178,0)
 . I '$L($O(^PXRMINDX(9000010.07,"PPI",DFN,""))) K FILES(12)
"RTN","ORWGAPIT",179,0)
 . I '$L($O(^PXRMINDX(9000010.16,"PI",DFN,""))) K FILES(13)
"RTN","ORWGAPIT",180,0)
 . I '$L($O(^PXRMINDX(601.2,"PI",DFN,""))) K FILES(14)
"RTN","ORWGAPIT",181,0)
 . I '$L($O(^PXRMINDX(100,"PI",DFN,""))) K FILES(15)
"RTN","ORWGAPIT",182,0)
 . I '$L($O(^PXRMINDX(45,"ICD0","PNI",DFN,0))) K FILES(16)
"RTN","ORWGAPIT",183,0)
 . I '$L($O(^PXRMINDX(45,"ICD9","PNI",DFN,0))) K FILES(17)
"RTN","ORWGAPIT",184,0)
 . I $E($O(^PXRMINDX(63,"PI",DFN,"A")))'="A" K FILES(18) D
"RTN","ORWGAPIT",185,0)
 .. F NUM=1:1:9 K FILES(180+NUM)
"RTN","ORWGAPIT",186,0)
 . I $E($O(^PXRMINDX(63,"PI",DFN,"M")))'="M" K FILES(19) D
"RTN","ORWGAPIT",187,0)
 .. F NUM=1:1:5 K FILES(190+NUM)
"RTN","ORWGAPIT",188,0)
 . I '$$VISITX^ORWGAPIA(DFN) K FILES(20)
"RTN","ORWGAPIT",189,0)
 . I '$$ADMITX^ORWGAPIA(DFN) K FILES(21)
"RTN","ORWGAPIT",190,0)
 . I '$$NVAX^ORWGAPIA(DFN) K FILES(22),FILES(30)
"RTN","ORWGAPIT",191,0)
 . I '$$BCMAX^ORWGAPIA(DFN) K FILES(23)
"RTN","ORWGAPIT",192,0)
 . I '$$SURGX^ORWGAPIA(DFN) K FILES(24)
"RTN","ORWGAPIT",193,0)
 . I '$$NOTEX^ORWGAPIA(DFN) K FILES(25)
"RTN","ORWGAPIT",194,0)
 . I '$$TREATX^ORWGAPIA(DFN) K FILES(26)
"RTN","ORWGAPIT",195,0)
 . I '$$ALLERGYX^ORWGAPIA(DFN) K FILES(27)
"RTN","ORWGAPIT",196,0)
 . I '$$BBX^ORWGAPIB(DFN) K FILES(28)
"RTN","ORWGAPIT",197,0)
 . S OK=0
"RTN","ORWGAPIT",198,0)
 . D MEDICINE^ORWGAPIA(.MEDARRAY,DFN)
"RTN","ORWGAPIT",199,0)
 . I $O(MEDARRAY(0)) S OK=1
"RTN","ORWGAPIT",200,0)
 . I 'OK K FILES(31)
"RTN","ORWGAPIT",201,0)
 S CNT=0,SEQ=0
"RTN","ORWGAPIT",202,0)
 F  S SEQ=$O(FILES(SEQ)) Q:SEQ<1  D
"RTN","ORWGAPIT",203,0)
 . S CNT=CNT+1
"RTN","ORWGAPIT",204,0)
 . I TMP S ^TMP(TYPES,$J,CNT)=FILES(SEQ)
"RTN","ORWGAPIT",205,0)
 . I 'TMP S TYPES(CNT)=FILES(SEQ)
"RTN","ORWGAPIT",206,0)
 Q
"RTN","ORWGAPIT",207,0)
 ;
"RTN","ORWGAPIU")
0^6^B48983345^B45244899
"RTN","ORWGAPIU",1,0)
ORWGAPIU ; SLC/STAFF - Graph API Utilities ;8/19/06  15:20
"RTN","ORWGAPIU",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260**;Dec 17, 1997;Build 26
"RTN","ORWGAPIU",3,0)
 ;
"RTN","ORWGAPIU",4,0)
EVALUE(VAL,FILE,FIELD) ; $$(internal value,file,field) -> external value or ""
"RTN","ORWGAPIU",5,0)
 ; from ORWGAPI1, ORWGAPI2, ORWGAPI3, ORWGAPI4, ORWGAPIP, ORWGAPIR
"RTN","ORWGAPIU",6,0)
 I VAL="" Q ""
"RTN","ORWGAPIU",7,0)
 S FIELD=$G(FIELD,.01)
"RTN","ORWGAPIU",8,0)
 I $E(FILE,1,2)=63 Q $$LABNAME^ORWGAPIA(VAL)
"RTN","ORWGAPIU",9,0)
 I FILE="63AP;I" Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",10,0)
 I FILE="45DX" Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",11,0)
 I FILE="45OP" Q $$ICD0^ORWGAPIA(VAL)
"RTN","ORWGAPIU",12,0)
 I FILE="45;ICD9" Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",13,0)
 I FILE="45;ICD0" Q $$ICD0^ORWGAPIA(VAL)
"RTN","ORWGAPIU",14,0)
 I FIELD=.01,'$L(VAL) Q ""
"RTN","ORWGAPIU",15,0)
 I FILE=9000010.07 Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",16,0)
 I FILE=9000010.18 Q $$ICPT^ORWGAPIA(VAL)
"RTN","ORWGAPIU",17,0)
 I FILE=9000011 Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",18,0)
 I FILE=9999911 Q $$ICD9^ORWGAPIA(VAL)
"RTN","ORWGAPIU",19,0)
 I FILE=130 Q $$ICPT^ORWGAPIA(VAL)
"RTN","ORWGAPIU",20,0)
 I FILE=120.8 Q $$ALLG^ORWGAPIA(VAL)
"RTN","ORWGAPIU",21,0)
 I FILE=50.605 Q $$DC^ORWGAPIA(VAL)
"RTN","ORWGAPIU",22,0)
 I FILE=68 Q $$AA^ORWGAPIA(VAL)
"RTN","ORWGAPIU",23,0)
 I FILE=811.2 Q $$TAX^ORWGAPIA(VAL)
"RTN","ORWGAPIU",24,0)
 D
"RTN","ORWGAPIU",25,0)
 . I FILE=52 S FIELD=6 Q
"RTN","ORWGAPIU",26,0)
 . I FILE=53.79 S FIELD=.08 Q
"RTN","ORWGAPIU",27,0)
 . I FILE=55 S FILE=55.07 Q
"RTN","ORWGAPIU",28,0)
 . I FILE="55NVAE" S FILE=55.05 Q
"RTN","ORWGAPIU",29,0)
 . I FILE="55NVA" S FILE=55.05 Q
"RTN","ORWGAPIU",30,0)
 . I FILE=70 S FILE=70.03,FIELD=2 Q
"RTN","ORWGAPIU",31,0)
 . I FILE=100 S FILE=100.001 Q
"RTN","ORWGAPIU",32,0)
 . I FILE=120.5 S FIELD=.03 Q
"RTN","ORWGAPIU",33,0)
 . I FILE=601.2 S FILE=601.21 Q
"RTN","ORWGAPIU",34,0)
 Q $$EXT^ORWGAPIX(VAL,FILE,FIELD)
"RTN","ORWGAPIU",35,0)
 ;
"RTN","ORWGAPIU",36,0)
FILE(FILE,REF,XREF,SCREEN) ; from ORWGAPI
"RTN","ORWGAPIU",37,0)
 S REF="",SCREEN="I 1",XREF="B"
"RTN","ORWGAPIU",38,0)
 I FILE="" Q
"RTN","ORWGAPIU",39,0)
 D
"RTN","ORWGAPIU",40,0)
 . I FILE="45DX" S REF=$$GBLREF(80),XREF="AB" Q
"RTN","ORWGAPIU",41,0)
 . I FILE="45OP" S REF=$$GBLREF(80.1),XREF="AB" Q
"RTN","ORWGAPIU",42,0)
 . I FILE=50.605 S REF=$$GBLREF(50.605),XREF="C" Q
"RTN","ORWGAPIU",43,0)
 . I FILE=52 S REF=$$GBLREF(50) Q
"RTN","ORWGAPIU",44,0)
 . I FILE=53.79 S REF=$$GBLREF(50.7),SCREEN="I $P(ZERO,U,10)'=1" Q
"RTN","ORWGAPIU",45,0)
 . I FILE=55 S REF=$$GBLREF(50) Q
"RTN","ORWGAPIU",46,0)
 . I FILE="55NVAE" S REF=$$GBLREF(50.7),SCREEN="I $P(ZERO,U,10)=1" Q
"RTN","ORWGAPIU",47,0)
 . I FILE="55NVA" S REF=$$GBLREF(50.7),SCREEN="I $P(ZERO,U,10)=1" Q
"RTN","ORWGAPIU",48,0)
 . I FILE=63 S REF=$$GBLREF(60),SCREEN="I $L($P(ZERO,U,5)),""BO""[$P(ZERO,U,3),$P(ZERO,U,4)=""CH""" Q
"RTN","ORWGAPIU",49,0)
 . I FILE="63AP" S REF=$$GBLREF(60),SCREEN="I 0" Q
"RTN","ORWGAPIU",50,0)
 . I FILE="63AP;D" S REF=$$GBLREF(61.4) Q
"RTN","ORWGAPIU",51,0)
 . I FILE="63AP;E" S REF=$$GBLREF(61.2) Q
"RTN","ORWGAPIU",52,0)
 . I FILE="63AP;F" S REF=$$GBLREF(61.3) Q
"RTN","ORWGAPIU",53,0)
 . I FILE="63AP;I" S REF=$$GBLREF(80),XREF="AB" Q
"RTN","ORWGAPIU",54,0)
 . I FILE="63AP;M" S REF=$$GBLREF(61.1) Q
"RTN","ORWGAPIU",55,0)
 . I FILE="63AP;O" S REF=$$GBLREF(61) Q
"RTN","ORWGAPIU",56,0)
 . I FILE="63AP;P" S REF=$$GBLREF(61.5) Q
"RTN","ORWGAPIU",57,0)
 . I FILE="63AP;T" S REF=$$GBLREF(60),SCREEN="I ""BO""[$P(ZERO,U,3),(($P(ZERO,U,4)=""CY"")!($P(ZERO,U,4)=""SP"")!($P(ZERO,U,4)=""EM"")!($P(ZERO,U,4)=""AU""))" Q
"RTN","ORWGAPIU",58,0)
 . I FILE="63BB" S REF=$$GBLREF(66),SCREEN="I $P(ZERO,U,15)=1" Q
"RTN","ORWGAPIU",59,0)
 . I FILE="63MI" S REF=$$GBLREF(60),SCREEN="I 0" Q
"RTN","ORWGAPIU",60,0)
 . I FILE="63MI;A" S REF=$$GBLREF(62.06) Q
"RTN","ORWGAPIU",61,0)
 . I FILE="63MI;M" S REF=$$GBLREF(60) Q  ; mycobacteria not currently used
"RTN","ORWGAPIU",62,0)
 . I FILE="63MI;O" S REF=$$GBLREF(61.2),SCREEN="I $L($P(ZERO,U,5)),""BFPMV""[$P(ZERO,U,5)" Q
"RTN","ORWGAPIU",63,0)
 . I FILE="63MI;S" S REF=$$GBLREF(61) Q
"RTN","ORWGAPIU",64,0)
 . I FILE="63MI;T" S REF=$$GBLREF(60),SCREEN="I ""BO""[$P(ZERO,U,3),$P(ZERO,U,4)=""MI""" Q
"RTN","ORWGAPIU",65,0)
 . I FILE=70 S REF=$$GBLREF(71) Q
"RTN","ORWGAPIU",66,0)
 . I FILE=100 S REF=$$GBLREF(101.43) Q
"RTN","ORWGAPIU",67,0)
 . I FILE=120.5 S REF=$$GBLREF(120.51),SCREEN="I ""BP^P^T^R^P^HT^WT^CVP^CG^PO2^PN""[$P(ZERO,U,2)" Q
"RTN","ORWGAPIU",68,0)
 . ;I FILE=120.8 S REF=$$GBLREF(120.83) Q
"RTN","ORWGAPIU",69,0)
 . I FILE=130 S REF=$$GBLREF(81),SCREEN="I '$P(ZERO,U,4)" Q
"RTN","ORWGAPIU",70,0)
 . I FILE=405 S REF=$$GBLREF(44),SCREEN="I 0" Q
"RTN","ORWGAPIU",71,0)
 . I FILE=601.2 S REF=$$GBLREF(601) Q
"RTN","ORWGAPIU",72,0)
 . I FILE=690 S REF=$$GBLREF(697.2),XREF="BA" Q
"RTN","ORWGAPIU",73,0)
 . I FILE=811.2 S REF=$$GBLREF(811.2),SCREEN="I $P(ZERO,U,6)'=1" Q
"RTN","ORWGAPIU",74,0)
 . I FILE=8925 S REF=$$GBLREF(8925.1),SCREEN="I $P(ZERO,U,4)=""DOC""" Q
"RTN","ORWGAPIU",75,0)
 . I FILE=9000010 S REF=$$GBLREF(44) Q
"RTN","ORWGAPIU",76,0)
 . I FILE=9000010.07 S REF=$$GBLREF(80),XREF="AB" Q
"RTN","ORWGAPIU",77,0)
 . I FILE=9000010.11 S REF=$$GBLREF(9999999.14),SCREEN="I $P(ZERO,U,7)'=1" Q
"RTN","ORWGAPIU",78,0)
 . I FILE=9000010.12 S REF=$$GBLREF(9999999.28),SCREEN="I $P(ZERO,U,3)'=1" Q
"RTN","ORWGAPIU",79,0)
 . I FILE=9000010.13 S REF=$$GBLREF(9999999.15),SCREEN="I $P(ZERO,U,4)'=1" Q
"RTN","ORWGAPIU",80,0)
 . I FILE=9000010.15 S REF=$$GBLREF(9999999.17),SCREEN="I $P(ZERO,U,4)'=1" Q
"RTN","ORWGAPIU",81,0)
 . I FILE=9000010.16 S REF=$$GBLREF(9999999.09),SCREEN="I $P(ZERO,U,3)'=1" Q
"RTN","ORWGAPIU",82,0)
 . I FILE=9000010.18 S REF=$$GBLREF(81),SCREEN="I '$P(ZERO,U,4)" Q
"RTN","ORWGAPIU",83,0)
 . I FILE=9000010.23 S REF=$$GBLREF(9999999.64),SCREEN="I $P(ZERO,U,10)=""F"",$P(ZERO,U,11)'=1" Q
"RTN","ORWGAPIU",84,0)
 . I FILE=9000011 S REF=$$GBLREF(80),XREF="AB",SCREEN="I $E(ZERO)'=""E"",'$L($P(ZERO,U,9))" Q
"RTN","ORWGAPIU",85,0)
 . I FILE=9999911 S REF=$$GBLREF(80),XREF="AB",SCREEN="I $E(ZERO)'=""E"",'$L($P(ZERO,U,9))" Q
"RTN","ORWGAPIU",86,0)
 I $E(REF)'="^" S REF=""
"RTN","ORWGAPIU",87,0)
 S REF=REF  ;_""""_XREF_""")"
"RTN","ORWGAPIU",88,0)
 Q
"RTN","ORWGAPIU",89,0)
 ;
"RTN","ORWGAPIU",90,0)
GBLREF(FN) ; $$(file#) -> global reference
"RTN","ORWGAPIU",91,0)
 Q $$GBLREF^ORWGAPIX($G(FN))
"RTN","ORWGAPIU",92,0)
 ;
"RTN","ORWGAPIU",93,0)
GENERIC(VAL,FROM,DIR,FILE,REF,XREF,SCREEN) ; Return a set of entries from xref in REF
"RTN","ORWGAPIU",94,0)
 ; from ORWGAPI
"RTN","ORWGAPIU",95,0)
 ; .VAL=returned list, FROM=text to $O from, DIR=$O direction,
"RTN","ORWGAPIU",96,0)
 N CNT,IEN,NAME,NEXTNAME,NUM,OK,ROOT,ZERO S NUM=0,CNT=44 K VAL
"RTN","ORWGAPIU",97,0)
 I FILE=405 Q
"RTN","ORWGAPIU",98,0)
 S ROOT=""
"RTN","ORWGAPIU",99,0)
 S FROM=$$UP^ORWGAPIX(FROM)
"RTN","ORWGAPIU",100,0)
 I $E(REF,$L(REF))="," S ROOT=$E(REF,1,$L(REF)-1)_")"
"RTN","ORWGAPIU",101,0)
 I $E(REF,$L(REF))="(" S ROOT=$P(REF,"(")
"RTN","ORWGAPIU",102,0)
 I '$L(ROOT) Q
"RTN","ORWGAPIU",103,0)
 S REF=REF_""""_XREF_""")"
"RTN","ORWGAPIU",104,0)
 F  Q:NUM'<CNT  S FROM=$O(@REF@(FROM),DIR) Q:FROM=""  D
"RTN","ORWGAPIU",105,0)
 . S IEN="" F  S IEN=$O(@REF@(FROM,IEN),DIR) Q:'IEN  D
"RTN","ORWGAPIU",106,0)
 .. I FILE=100,$O(@REF@(FROM,IEN,""))>0 Q
"RTN","ORWGAPIU",107,0)
 .. S ZERO=$G(@ROOT@(IEN,0)) I '$L(ZERO) Q
"RTN","ORWGAPIU",108,0)
 .. X SCREEN I '$T Q
"RTN","ORWGAPIU",109,0)
 .. S NUM=NUM+1
"RTN","ORWGAPIU",110,0)
 .. I FILE="45DX"!(FILE=9000010.07)!(FILE=9000011)!(FILE="63AP;I") D  Q
"RTN","ORWGAPIU",111,0)
 ... S VAL(NUM)=FILE_U_IEN_U_$$ICD9^ORWGAPIA(IEN) Q
"RTN","ORWGAPIU",112,0)
 .. I FILE="45OP" S VAL(NUM)=FILE_U_IEN_U_$$ICD0^ORWGAPIA(IEN) Q
"RTN","ORWGAPIU",113,0)
 .. I FILE="55NVAE"!(FILE=53.79) S VAL(NUM)=FILE_U_IEN_U_$$POINAME^ORWGAPIA(IEN) Q
"RTN","ORWGAPIU",114,0)
 .. I FILE="55NVA" S VAL(NUM)=FILE_U_IEN_U_$$POINAME^ORWGAPIA(IEN) Q
"RTN","ORWGAPIU",115,0)
 .. I FILE=9000010.18 S VAL(NUM)=FILE_U_IEN_U_$$ICPT^ORWGAPIA(IEN) Q
"RTN","ORWGAPIU",116,0)
 .. I FILE=130 S VAL(NUM)=FILE_U_IEN_U_$$ICPT^ORWGAPIA(IEN) Q
"RTN","ORWGAPIU",117,0)
 .. S VAL(NUM)=FILE_U_IEN_U_FROM
"RTN","ORWGAPIU",118,0)
 I FILE=120.5 D
"RTN","ORWGAPIU",119,0)
 . S (NUM,OK)=0
"RTN","ORWGAPIU",120,0)
 . F  S NUM=$O(VAL(NUM)) Q:NUM<1  D  Q:OK
"RTN","ORWGAPIU",121,0)
 .. S NAME=$P(VAL(NUM),U,3)
"RTN","ORWGAPIU",122,0)
 .. S NEXTNAME=$P($G(VAL(NUM+1)),U,3)
"RTN","ORWGAPIU",123,0)
 .. I "BODY MASS INDEX"]NAME,NEXTNAME]"BODY MASS INDEX" D
"RTN","ORWGAPIU",124,0)
 ... S OK=1
"RTN","ORWGAPIU",125,0)
 ... S VAL(NUM+.5)="120.5^99999^BODY MASS INDEX"
"RTN","ORWGAPIU",126,0)
 Q
"RTN","ORWGAPIU",127,0)
 ;
"RTN","ORWGAPIU",128,0)
INISET ; postinit, set initial public graph setting  - from ORY215
"RTN","ORWGAPIU",129,0)
 D INISET^ORWGAPIP
"RTN","ORWGAPIU",130,0)
 Q
"RTN","ORWGAPIU",131,0)
 ;
"RTN","ORWGAPIU",132,0)
ITEMPRFX(ITEM) ; $$(item) -> item prefix   - from ORWGAPI1
"RTN","ORWGAPIU",133,0)
 N ABBREV,PREFIX
"RTN","ORWGAPIU",134,0)
 S PREFIX=""
"RTN","ORWGAPIU",135,0)
 S ABBREV=$P(ITEM,";",2)
"RTN","ORWGAPIU",136,0)
 I $E(ITEM)="A" D  Q PREFIX
"RTN","ORWGAPIU",137,0)
 . I ABBREV="T" S PREFIX="TEST" Q
"RTN","ORWGAPIU",138,0)
 . I ABBREV="S" S PREFIX="SPECIMEN" Q
"RTN","ORWGAPIU",139,0)
 . I ABBREV="O" S PREFIX="ORGAN" Q
"RTN","ORWGAPIU",140,0)
 . I ABBREV="M" S PREFIX="MORPHOLOGY" Q
"RTN","ORWGAPIU",141,0)
 . I ABBREV="E" S PREFIX="ETIOLOGY" Q
"RTN","ORWGAPIU",142,0)
 . I ABBREV="D" S PREFIX="DISEASE" Q
"RTN","ORWGAPIU",143,0)
 . I ABBREV="P" S PREFIX="PROCEDURE" Q
"RTN","ORWGAPIU",144,0)
 . I ABBREV="F" S PREFIX="FUNCTION" Q
"RTN","ORWGAPIU",145,0)
 . I ABBREV="I" S PREFIX="ICD9" Q
"RTN","ORWGAPIU",146,0)
 I $E(ITEM)="B" Q "BLOOD COMPONENT"
"RTN","ORWGAPIU",147,0)
 I $E(ITEM)="M" D  Q PREFIX
"RTN","ORWGAPIU",148,0)
 . I ABBREV="T" S PREFIX="TEST" Q
"RTN","ORWGAPIU",149,0)
 . I ABBREV="S" S PREFIX="SPECIMEN" Q
"RTN","ORWGAPIU",150,0)
 . I ABBREV="O" S PREFIX="ORGANISM" Q
"RTN","ORWGAPIU",151,0)
 . I ABBREV="A" S PREFIX="ANTIBIOTIC" Q
"RTN","ORWGAPIU",152,0)
 . I ABBREV="M" S PREFIX="TB ANTIBIOTIC" Q
"RTN","ORWGAPIU",153,0)
 Q PREFIX
"RTN","ORWGAPIU",154,0)
 ;
"RTN","ORWGAPIU",155,0)
OGROUP(OITEM) ; $$(orderable item) -> ien display group^display group   - from ORWGAPIR
"RTN","ORWGAPIU",156,0)
 N IEN
"RTN","ORWGAPIU",157,0)
 S IEN=+$P($G(^ORD(101.43,+$G(OITEM),0)),U,5)
"RTN","ORWGAPIU",158,0)
 Q IEN_U_"order - "_$P($G(^ORD(100.98,IEN,0)),U)
"RTN","ORWGAPIU",159,0)
 ;
"RTN","ORWGAPIU",160,0)
RETURN(TMP,ITEMS) ; return TMP (0 use local, 1 use ^TMP(ITEMS,$J, where ITEMS is a namespaced string)
"RTN","ORWGAPIU",161,0)
 ; from ORWGAPI, ORWGAPIP, ORWGAPIX
"RTN","ORWGAPIU",162,0)
 N NMSP
"RTN","ORWGAPIU",163,0)
 S NMSP=$G(ITEMS) K ITEMS S ITEMS=""
"RTN","ORWGAPIU",164,0)
 S TMP=NMSP?1U1UN1.14UNP
"RTN","ORWGAPIU",165,0)
 I TMP S ITEMS=NMSP
"RTN","ORWGAPIU",166,0)
 Q
"RTN","ORWGAPIU",167,0)
 ;
"RTN","ORWGAPIU",168,0)
SETUP(DATA,RESULT,TMP,CNT) ; from ORWGAPI1, ORWGAPI2, ORWGAPI3, ORWGAPI4, ORWGAPIP, ORWGAPIR, ORWGAPIX
"RTN","ORWGAPIU",169,0)
 S CNT=CNT+1
"RTN","ORWGAPIU",170,0)
 I TMP S ^TMP(DATA,$J,CNT)=RESULT
"RTN","ORWGAPIU",171,0)
 I 'TMP S DATA(CNT)=RESULT
"RTN","ORWGAPIU",172,0)
 Q
"RTN","ORWGAPIU",173,0)
 ;
"RTN","ORWGAPIU",174,0)
DATETFM(DATETIME) ; $$(external date/time) -> fm date/time else 0
"RTN","ORWGAPIU",175,0)
 N DATE,DAY,FMDT,HOUR,MIN,SEC,TIME,YEAR
"RTN","ORWGAPIU",176,0)
 S DATE=$P(DATETIME,"@"),TIME=$P(DATETIME,"@",2)
"RTN","ORWGAPIU",177,0)
 S YEAR=$P(DATE,",",2) I $L(YEAR)'=4 Q 0
"RTN","ORWGAPIU",178,0)
 S YEAR=YEAR-1700 I YEAR<270 Q 0
"RTN","ORWGAPIU",179,0)
 S MONTH=$P(DATE," ")
"RTN","ORWGAPIU",180,0)
 S MONTH=$$MTN(MONTH) I MONTH<1 Q 0
"RTN","ORWGAPIU",181,0)
 I MONTH<10 S MONTH="0"_MONTH
"RTN","ORWGAPIU",182,0)
 S DAY=$P(DATE," ",2),DAY=$P(DAY,",")
"RTN","ORWGAPIU",183,0)
 I DAY<1 Q 0
"RTN","ORWGAPIU",184,0)
 I DAY<10 S DAY="0"_DAY
"RTN","ORWGAPIU",185,0)
 S HOUR=$P(TIME,":")
"RTN","ORWGAPIU",186,0)
 S MIN=$P(TIME,":",2)
"RTN","ORWGAPIU",187,0)
 S SEC=$P(TIME,":",3)
"RTN","ORWGAPIU",188,0)
 S TIME=HOUR_MIN_SEC
"RTN","ORWGAPIU",189,0)
 S FMDT=YEAR_MONTH_DAY
"RTN","ORWGAPIU",190,0)
 I '$L(TIME) Q FMDT
"RTN","ORWGAPIU",191,0)
 Q FMDT_"."_TIME
"RTN","ORWGAPIU",192,0)
 ;
"RTN","ORWGAPIU",193,0)
MTN(MONTH) ; $$(external month) -> month number
"RTN","ORWGAPIU",194,0)
 N MONTHS,NUM
"RTN","ORWGAPIU",195,0)
 I $L(MONTH)'=3 Q 0
"RTN","ORWGAPIU",196,0)
 S MONTHS="JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC"
"RTN","ORWGAPIU",197,0)
 F NUM=1:1:13 I $P(MONTHS,U,NUM)=MONTH Q
"RTN","ORWGAPIU",198,0)
 I NUM=13 Q 0
"RTN","ORWGAPIU",199,0)
 Q NUM
"RTN","ORWGAPIX")
0^13^B26817522^B7674537
"RTN","ORWGAPIX",1,0)
ORWGAPIX ; SLC/STAFF - Graph External Calls ;9/29/06  11:49
"RTN","ORWGAPIX",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**215,260**;Dec 17, 1997;Build 26
"RTN","ORWGAPIX",3,0)
 ;
"RTN","ORWGAPIX",4,0)
DATE(X) ; $$(date/time) -> date/time
"RTN","ORWGAPIX",5,0)
 N Y D ^%DT
"RTN","ORWGAPIX",6,0)
 Q Y
"RTN","ORWGAPIX",7,0)
ENDIQ1(RESULTS,DIC,DR,DA,DIQ) ; use file # for DIC
"RTN","ORWGAPIX",8,0)
 N NUMDIC K RESULTS,^UTILITY("DIQ1",$J)
"RTN","ORWGAPIX",9,0)
 Q:'$G(DIC)  Q:'$L(DR)  Q:'$G(DA)
"RTN","ORWGAPIX",10,0)
 S NUMDIC=DIC
"RTN","ORWGAPIX",11,0)
 D EN^DIQ1
"RTN","ORWGAPIX",12,0)
 M RESULTS=^UTILITY("DIQ1",$J,NUMDIC,DA)
"RTN","ORWGAPIX",13,0)
 K ^UTILITY("DIQ1",$J)
"RTN","ORWGAPIX",14,0)
 Q
"RTN","ORWGAPIX",15,0)
EXT(Y,FILE,FIELD) ; $$(value,file,field) -> external value
"RTN","ORWGAPIX",16,0)
 N C S C=$P($G(^DD(FILE,FIELD,0)),U,2) D Y^DIQ
"RTN","ORWGAPIX",17,0)
 Q Y
"RTN","ORWGAPIX",18,0)
EXTERNAL(FILE,FIELD,FLAG,VAL) ; $$(file,field,flag,internal value) -> external value
"RTN","ORWGAPIX",19,0)
 Q $$EXTERNAL^DILFD(FILE,FIELD,FLAG,VAL)
"RTN","ORWGAPIX",20,0)
EXTNAME(IEN,FN) ; $$(ien,file#) -> external form of pointer
"RTN","ORWGAPIX",21,0)
 N REF
"RTN","ORWGAPIX",22,0)
 S REF=$G(^DIC(FN,0,"GL"))
"RTN","ORWGAPIX",23,0)
 I $L(REF),+IEN Q $P($G(@(REF_IEN_",0)")),U)
"RTN","ORWGAPIX",24,0)
 Q ""
"RTN","ORWGAPIX",25,0)
FILENM(FILENUM) ; $$(file#) -> file name
"RTN","ORWGAPIX",26,0)
 N DIC,DO,NAME K DIC,DO
"RTN","ORWGAPIX",27,0)
 S FILENUM=$$GBLREF(+$G(FILENUM))
"RTN","ORWGAPIX",28,0)
 I '$L($G(FILENUM)) Q ""
"RTN","ORWGAPIX",29,0)
 S DIC=FILENUM
"RTN","ORWGAPIX",30,0)
 D DO^DIC1
"RTN","ORWGAPIX",31,0)
 S NAME=$P(DO,U)
"RTN","ORWGAPIX",32,0)
 Q NAME
"RTN","ORWGAPIX",33,0)
GETDATA(RESULTS,DIC,DR,DA,DIQ) ; use file # for DIC
"RTN","ORWGAPIX",34,0)
 N NUMDIC K RESULTS,^UTILITY("DIQ1",$J)
"RTN","ORWGAPIX",35,0)
 Q:'$G(DIC)  Q:'$L(DR)  Q:'$G(DA)
"RTN","ORWGAPIX",36,0)
 S NUMDIC=DIC
"RTN","ORWGAPIX",37,0)
 D EN^DIQ1
"RTN","ORWGAPIX",38,0)
 M RESULTS=^UTILITY("DIQ1",$J,NUMDIC,DA)
"RTN","ORWGAPIX",39,0)
 K ^UTILITY("DIQ1",$J)
"RTN","ORWGAPIX",40,0)
 Q
"RTN","ORWGAPIX",41,0)
GBLREF(FILENUM) ; $$(file#) -> global reference
"RTN","ORWGAPIX",42,0)
 I '$G(FILENUM) Q ""
"RTN","ORWGAPIX",43,0)
 Q $$ROOT^DILFD(+FILENUM)
"RTN","ORWGAPIX",44,0)
INDEX(DIK,DA) ; index entry in file   -  from ORWGAPIP
"RTN","ORWGAPIX",45,0)
 D IX1^DIK
"RTN","ORWGAPIX",46,0)
 Q
"RTN","ORWGAPIX",47,0)
XDEL(ENTITY,PARAM,NAME,ORERR) ; from ORWGAPIP
"RTN","ORWGAPIX",48,0)
 D DEL^XPAR(ENTITY,PARAM,NAME,.ORERR)
"RTN","ORWGAPIX",49,0)
 Q
"RTN","ORWGAPIX",50,0)
XEN(ENTITY,PARAM,NAME,ORVAL,ORERR) ; from ORWGAPIP
"RTN","ORWGAPIX",51,0)
 D EN^XPAR(ENTITY,PARAM,NAME,.ORVAL,.ORERR)
"RTN","ORWGAPIX",52,0)
 Q
"RTN","ORWGAPIX",53,0)
XENVAL(ORVALUES,PARAM) ;
"RTN","ORWGAPIX",54,0)
 D ENVAL^XPAR(.ORVALUES,PARAM)
"RTN","ORWGAPIX",55,0)
 Q
"RTN","ORWGAPIX",56,0)
XGET(ENTITY,PARAM,INST,FORMAT) ; $$(...) -> parameter values
"RTN","ORWGAPIX",57,0)
 Q $$GET^XPAR(ENTITY,PARAM,INST,FORMAT)
"RTN","ORWGAPIX",58,0)
XGETLST(ORLIST,ENTITY,PARAM) ; from ORWGAPIP
"RTN","ORWGAPIX",59,0)
 D GETLST^XPAR(.ORLIST,ENTITY,PARAM)
"RTN","ORWGAPIX",60,0)
 Q
"RTN","ORWGAPIX",61,0)
XGETLST1(ORLIST,ENTITY,PARAM,FORMAT,ORERR) ; from ORWGAPIP
"RTN","ORWGAPIX",62,0)
 D GETLST^XPAR(.ORLIST,ENTITY,PARAM,FORMAT,.ORERR)
"RTN","ORWGAPIX",63,0)
 Q
"RTN","ORWGAPIX",64,0)
XGETWP(ORWP,ENTITY,PARAM,ALL) ; from ORWGAPIP
"RTN","ORWGAPIX",65,0)
 D GETWP^XPAR(.ORWP,ENTITY,PARAM,ALL)
"RTN","ORWGAPIX",66,0)
 Q
"RTN","ORWGAPIX",67,0)
 ; kernel functions
"RTN","ORWGAPIX",68,0)
FMADD(X,D,H,M,S) ;
"RTN","ORWGAPIX",69,0)
 Q $$FMADD^XLFDT(X,$G(D),$G(H),$G(M),$G(S))
"RTN","ORWGAPIX",70,0)
NOW() ;
"RTN","ORWGAPIX",71,0)
 Q $$NOW^XLFDT
"RTN","ORWGAPIX",72,0)
LOW(X) ;
"RTN","ORWGAPIX",73,0)
 Q $$LOW^XLFSTR(X)
"RTN","ORWGAPIX",74,0)
REPLACE(STRING,ORARRAY) ;
"RTN","ORWGAPIX",75,0)
 Q $$REPLACE^XLFSTR(STRING,.ORARRAY)
"RTN","ORWGAPIX",76,0)
TRIM(X,F,V) ;
"RTN","ORWGAPIX",77,0)
 Q $$TRIM^XLFSTR(X,$G(F,"LR"),$G(V," "))
"RTN","ORWGAPIX",78,0)
UP(X) ;
"RTN","ORWGAPIX",79,0)
 Q $$UP^XLFSTR(X)
"RTN","ORWGAPIX",80,0)
INSIG(NODE) ; $$(node) -> sig ; replace INSIG^ORWGAPIA with this code in v27
"RTN","ORWGAPIX",81,0)
 N SIG,SUB,VALUES K VALUES
"RTN","ORWGAPIX",82,0)
 S SUB=$P($G(NODE),";",2)
"RTN","ORWGAPIX",83,0)
 D RXIN^ORWGAPIA(NODE,.VALUES)
"RTN","ORWGAPIX",84,0)
 S SIG=""
"RTN","ORWGAPIX",85,0)
 I SUB=5 D
"RTN","ORWGAPIX",86,0)
 . S SIG="  Give: "_$G(VALUES("MR"))
"RTN","ORWGAPIX",87,0)
 . S SIG=SIG_" "_$P($G(VALUES("SCH",1,0)),U)
"RTN","ORWGAPIX",88,0)
 . S SIG=SIG_" "_$P($G(VALUES("SCH",1,0)),U,2)
"RTN","ORWGAPIX",89,0)
 I SUB="IV" D
"RTN","ORWGAPIX",90,0)
 . S SIG="  Give: "_$G(VALUES("DO"))
"RTN","ORWGAPIX",91,0)
 . S SIG=SIG_" "_$$EXT^ORWGAPIX($G(VALUES("START")),55.01,.02)
"RTN","ORWGAPIX",92,0)
 . S SIG=SIG_" "_$G(VALUES("SCH",1,0))
"RTN","ORWGAPIX",93,0)
 Q SIG
"RTN","ORWGAPIX",94,0)
 ;
"RTN","ORWGAPIX",95,0)
BMIITEMS(ITEMS,CNT,TMP) ; from ORWGAPIR
"RTN","ORWGAPIX",96,0)
 N BMI,NUM,REPLACE K REPLACE
"RTN","ORWGAPIX",97,0)
 S REPLACE("WEIGHT")="BODY MASS INDEX"
"RTN","ORWGAPIX",98,0)
 S BMI=""
"RTN","ORWGAPIX",99,0)
 S NUM=0
"RTN","ORWGAPIX",100,0)
 I 'TMP D
"RTN","ORWGAPIX",101,0)
 . F  S NUM=$O(ITEMS(NUM)) Q:NUM<1  D
"RTN","ORWGAPIX",102,0)
 .. I $P(ITEMS(NUM),U,2)=8 S $P(BMI,U)=1
"RTN","ORWGAPIX",103,0)
 .. I $P(ITEMS(NUM),U,2)=9 S $P(BMI,U,2)=ITEMS(NUM)
"RTN","ORWGAPIX",104,0)
 I TMP D
"RTN","ORWGAPIX",105,0)
 . F  S NUM=$O(^TMP(ITEMS,$J,NUM)) Q:NUM<1  D
"RTN","ORWGAPIX",106,0)
 .. I $P(^TMP(ITEMS,$J,NUM),U,2)=8 S $P(BMI,U)=1
"RTN","ORWGAPIX",107,0)
 .. I $P(^TMP(ITEMS,$J,NUM),U,2)=9 S $P(BMI,U,2)=^TMP(ITEMS,$J,NUM)
"RTN","ORWGAPIX",108,0)
 I BMI,$L(BMI)>3 D
"RTN","ORWGAPIX",109,0)
 . S CNT=CNT+1
"RTN","ORWGAPIX",110,0)
 . S RESULT=$P(BMI,U,2,99)
"RTN","ORWGAPIX",111,0)
 . S RESULT=$$REPLACE^ORWGAPIX(RESULT,.REPLACE)
"RTN","ORWGAPIX",112,0)
 . S $P(RESULT,U,2)=99999
"RTN","ORWGAPIX",113,0)
 . D SETUP^ORWGAPIU(.ITEMS,RESULT,TMP,.CNT)
"RTN","ORWGAPIX",114,0)
 Q
"RTN","ORWGAPIX",115,0)
 ;
"RTN","ORWGAPIX",116,0)
BMIDATA(DATA,ITEM,START,DFN,CNT,TMP) ; from ORWGAPI4
"RTN","ORWGAPIX",117,0)
 N DATE,DATE2,NODE,RESULT,VALUE,W K VALUE
"RTN","ORWGAPIX",118,0)
 S DATE="",DATE2="",CNT=$G(CNT)
"RTN","ORWGAPIX",119,0)
 F  S DATE=$O(^PXRMINDX(120.5,"PI",DFN,9,DATE)) Q:DATE=""  D
"RTN","ORWGAPIX",120,0)
 . I DATE>START Q
"RTN","ORWGAPIX",121,0)
 . S NODE=""
"RTN","ORWGAPIX",122,0)
 . F  S NODE=$O(^PXRMINDX(120.5,"PI",DFN,9,DATE,NODE)) Q:NODE=""  D
"RTN","ORWGAPIX",123,0)
 .. D VITAL^ORWGAPIA(.VALUE,NODE) S WT=$P($G(VALUE(7)),U) I 'WT Q
"RTN","ORWGAPIX",124,0)
 .. S BMI=$$BMI(DFN,WT,DATE) I 'BMI Q
"RTN","ORWGAPIX",125,0)
 .. S RESULT=120.5_U_ITEM_U_DATE_U_DATE2_U_BMI
"RTN","ORWGAPIX",126,0)
 .. D SETUP^ORWGAPIU(.DATA,RESULT,TMP,.CNT)
"RTN","ORWGAPIX",127,0)
 Q
"RTN","ORWGAPIX",128,0)
 ;
"RTN","ORWGAPIX",129,0)
BMI(DFN,WT,DATE) ; $$(dfn,wt,date) -> bmi, else ""
"RTN","ORWGAPIX",130,0)
 N HDATE,HT,NEXT,NODE,PREV
"RTN","ORWGAPIX",131,0)
 I '$O(^PXRMINDX(120.5,"PI",DFN,8,0)) Q ""
"RTN","ORWGAPIX",132,0)
 S NODE=$O(^PXRMINDX(120.5,"PI",DFN,8,DATE,""))
"RTN","ORWGAPIX",133,0)
 I '$L(NODE) D
"RTN","ORWGAPIX",134,0)
 . S NEXT=+$O(^PXRMINDX(120.5,"PI",DFN,8,DATE))
"RTN","ORWGAPIX",135,0)
 . S PREV=+$O(^PXRMINDX(120.5,"PI",DFN,8,DATE),-1)
"RTN","ORWGAPIX",136,0)
 . S NODE=$O(^PXRMINDX(120.5,"PI",DFN,8,$$CLOSEST(DATE,NEXT,PREV),""))
"RTN","ORWGAPIX",137,0)
 I '$L(NODE) Q ""
"RTN","ORWGAPIX",138,0)
 D VITAL^ORWGAPIA(.VALUE,NODE) S HT=$P($G(VALUE(7)),U) I 'HT Q ""
"RTN","ORWGAPIX",139,0)
 Q $$CALCBMI(HT,WT)
"RTN","ORWGAPIX",140,0)
 ;
"RTN","ORWGAPIX",141,0)
CALCBMI(HT,WT) ; $$(ht,wt) -> bmi  uses (inches,lbs)
"RTN","ORWGAPIX",142,0)
 S WT=WT/2.2 ;+$$WEIGHT^XLFMSMT(WT,"LB","KG")
"RTN","ORWGAPIX",143,0)
 S HT=HT*2.54/100 ;+$$LENGTH^XLFMSMT(HT,"IN","M")
"RTN","ORWGAPIX",144,0)
 Q $J(WT/(HT*HT),0,2)
"RTN","ORWGAPIX",145,0)
 ;
"RTN","ORWGAPIX",146,0)
CLOSEST(DATE,NEXT,PREV) ;
"RTN","ORWGAPIX",147,0)
 I $$FMDIFF^XLFDT(DATE,NEXT,2)>$$FMDIFF^XLFDT(DATE,PREV,2) Q PREV
"RTN","ORWGAPIX",148,0)
 Q NEXT
"RTN","ORWGAPIX",149,0)
 ;
"RTN","ORWGAPIX",150,0)
BMILAST(DFN,ARRAY,CNT) ;
"RTN","ORWGAPIX",151,0)
 N BMI,DATE,NUM,WT
"RTN","ORWGAPIX",152,0)
 S (DATE,NUM,WT)=0
"RTN","ORWGAPIX",153,0)
 F  S NUM=$O(ARRAY(NUM)) Q:NUM<1  D  Q:WT
"RTN","ORWGAPIX",154,0)
 . I $P(ARRAY(NUM),U,2)'="WT" Q
"RTN","ORWGAPIX",155,0)
 . S WT=+$P(ARRAY(NUM),U,3)
"RTN","ORWGAPIX",156,0)
 . S DATE=$P(ARRAY(NUM),U,4)
"RTN","ORWGAPIX",157,0)
 I 'WT Q
"RTN","ORWGAPIX",158,0)
 I 'DATE Q
"RTN","ORWGAPIX",159,0)
 S BMI=$$BMI(DFN,WT,DATE)
"RTN","ORWGAPIX",160,0)
 I 'BMI Q
"RTN","ORWGAPIX",161,0)
 S CNT=CNT+1
"RTN","ORWGAPIX",162,0)
 S ARRAY(CNT)="-1^BMI^"_BMI_U_DATE_U_BMI_"^^"
"RTN","ORWGAPIX",163,0)
 Q
"RTN","ORY260")
0^12^B23654256^n/a
"RTN","ORY260",1,0)
ORY260 ; SLC/STAFF - Patch OR*3.0*260 post init ;8/21/06  13:13
"RTN","ORY260",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**260**;Dec 17, 1997;Build 26
"RTN","ORY260",3,0)
POST ; post-init to patch OR*3.0*260
"RTN","ORY260",4,0)
 ; fix any string formatted date/times in CR index
"RTN","ORY260",5,0)
 ; remove Treatment type from graphing
"RTN","ORY260",6,0)
 N DA,DIR,ORMSG,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE K DIR,ORMSG
"RTN","ORY260",7,0)
 S ORMSG(1)="A task is being queued in the background to identify"
"RTN","ORY260",8,0)
 S ORMSG(2)="any Start or Start dates where times have trailing zeros."
"RTN","ORY260",9,0)
 S ORMSG(3)=""
"RTN","ORY260",10,0)
 S ORMSG(4)="These indexes will be reset with the correct canonic"
"RTN","ORY260",11,0)
 S ORMSG(5)="values by this background job. A mail message will be"
"RTN","ORY260",12,0)
 S ORMSG(6)="sent to the initiator of this patch at completion."
"RTN","ORY260",13,0)
 S ORMSG(7)=""
"RTN","ORY260",14,0)
 S ORMSG(8)=""
"RTN","ORY260",15,0)
 S ZTRTN="DQ^ORY260",ZTIO=""
"RTN","ORY260",16,0)
 S ZTDESC="Clean up - Patch 260",ZTDTH=$H,ZTSAVE("DUZ")=""
"RTN","ORY260",17,0)
 D ^%ZTLOAD
"RTN","ORY260",18,0)
 S ORMSG(9)="The task number is "_$G(ZTSK)
"RTN","ORY260",19,0)
 D MES^XPDUTL(.ORMSG) I '$D(ZTQUEUED) D
"RTN","ORY260",20,0)
 . N DIR,Y
"RTN","ORY260",21,0)
 . S DIR(0)="E",DIR("A")="Press return - installation is complete."
"RTN","ORY260",22,0)
 . D ^DIR
"RTN","ORY260",23,0)
 Q
"RTN","ORY260",24,0)
 ;
"RTN","ORY260",25,0)
DQ ; dequeued
"RTN","ORY260",26,0)
 N BEGIN,CNT,DFN,ITEM,NODE,OK,START,STOP K ^TMP("ORPXRM",$J),^TMP("ORTXT",$J)
"RTN","ORY260",27,0)
 S BEGIN=$$NOW^XLFDT
"RTN","ORY260",28,0)
 S CNT=0
"RTN","ORY260",29,0)
 S DFN=0
"RTN","ORY260",30,0)
 F  S DFN=$O(^PXRMINDX(100,"PI",DFN)) Q:DFN<1  D
"RTN","ORY260",31,0)
 . S ITEM=0
"RTN","ORY260",32,0)
 . F  S ITEM=$O(^PXRMINDX(100,"PI",DFN,ITEM)) Q:ITEM<1  D
"RTN","ORY260",33,0)
 .. S START=""
"RTN","ORY260",34,0)
 .. F  S START=$O(^PXRMINDX(100,"PI",DFN,ITEM,START)) Q:START=""  D
"RTN","ORY260",35,0)
 ... S STOP=""
"RTN","ORY260",36,0)
 ... F  S STOP=$O(^PXRMINDX(100,"PI",DFN,ITEM,START,STOP)) Q:STOP=""  D
"RTN","ORY260",37,0)
 .... S OK=1
"RTN","ORY260",38,0)
 .... I START'=+START S OK=0
"RTN","ORY260",39,0)
 .... I OK,$E(STOP)'="U",STOP'=+STOP S OK=0
"RTN","ORY260",40,0)
 .... I OK Q
"RTN","ORY260",41,0)
 .... S NODE=""
"RTN","ORY260",42,0)
 .... F  S NODE=$O(^PXRMINDX(100,"PI",DFN,ITEM,START,STOP,NODE)) Q:NODE=""  D
"RTN","ORY260",43,0)
 ..... S ^TMP("ORPXRM",$J,NODE)=DFN_U_ITEM_U_START_U_STOP
"RTN","ORY260",44,0)
 ..... S CNT=CNT+1
"RTN","ORY260",45,0)
 ..... ;W !,NODE,?20,$P($G(^OR(100,+NODE,0)),U,8),?35,$P($G(^OR(100,+NODE,0)),U,9),?55,START
"RTN","ORY260",46,0)
 S ^TMP("ORTXT",$J,4)="-- "_CNT_" nodes to check --" ; overwrite on finish
"RTN","ORY260",47,0)
 S ^TMP("ORTXT",$J,5)=" "
"RTN","ORY260",48,0)
 S CNT=5
"RTN","ORY260",49,0)
 S NODE=""
"RTN","ORY260",50,0)
 F  S NODE=$O(^TMP("ORPXRM",$J,NODE)) Q:NODE=""  D
"RTN","ORY260",51,0)
 . D FIX(NODE,.CNT)
"RTN","ORY260",52,0)
 S ^TMP("ORTXT",$J,4)="-- "_(CNT-5)_" changes made --"
"RTN","ORY260",53,0)
 K ^TMP("ORPXRM",$J)
"RTN","ORY260",54,0)
 D TREMOVE("ORWG GRAPH VIEW") ; removes treatment type from graphing
"RTN","ORY260",55,0)
 D MAIL(BEGIN)
"RTN","ORY260",56,0)
 K ^TMP("ORTXT",$J)
"RTN","ORY260",57,0)
 Q
"RTN","ORY260",58,0)
 ;
"RTN","ORY260",59,0)
FIX(NODE,CNT) ;
"RTN","ORY260",60,0)
 N DA,DATE1,DATE2,DFN,DIE,DR,ITEM,LINE,START,STOP,VALUES,ZERO
"RTN","ORY260",61,0)
 S VALUES=$G(^TMP("ORPXRM",$J,NODE))
"RTN","ORY260",62,0)
 S DFN=$P(VALUES,U)
"RTN","ORY260",63,0)
 S ITEM=$P(VALUES,U,2)
"RTN","ORY260",64,0)
 S DATE1=$P(VALUES,U,3)
"RTN","ORY260",65,0)
 S DATE2=$P(VALUES,U,4)
"RTN","ORY260",66,0)
 K ^PXRMINDX(100,"PI",DFN,ITEM,DATE1,DATE2,NODE)
"RTN","ORY260",67,0)
 K ^PXRMINDX(100,"IP",ITEM,DFN,DATE1,DATE2,NODE)
"RTN","ORY260",68,0)
 S DIE="^OR(100,"
"RTN","ORY260",69,0)
 S DA=+NODE
"RTN","ORY260",70,0)
 S ZERO=$G(^OR(100,DA,0))
"RTN","ORY260",71,0)
 S START=+$P(ZERO,U,8) I START=0 S START="@"
"RTN","ORY260",72,0)
 S STOP=+$P(ZERO,U,9) I STOP=0 S STOP="@"
"RTN","ORY260",73,0)
 S DR=""
"RTN","ORY260",74,0)
 I START'=DATE1 S DR="21///"_START
"RTN","ORY260",75,0)
 I START="@",$P(ZERO,U,8)="" S DR=""
"RTN","ORY260",76,0)
 I STOP'=DATE2 D
"RTN","ORY260",77,0)
 . I STOP="@",$E(DATE2)="U" Q
"RTN","ORY260",78,0)
 . I $L(DR) S DR=DR_";22///"_STOP Q
"RTN","ORY260",79,0)
 . S DR="22///"_STOP Q
"RTN","ORY260",80,0)
 I '$L(DR) Q
"RTN","ORY260",81,0)
 S LINE="Node: "_NODE
"RTN","ORY260",82,0)
 I DR["21///" S LINE=LINE_"; Start: "_DATE1_" -> "_START
"RTN","ORY260",83,0)
 I DR["22///" S LINE=LINE_"; Stop: "_DATE2_" -> "_STOP
"RTN","ORY260",84,0)
 D ^DIE
"RTN","ORY260",85,0)
 S CNT=CNT+1
"RTN","ORY260",86,0)
 S ^TMP("ORTXT",$J,CNT)=LINE
"RTN","ORY260",87,0)
 Q
"RTN","ORY260",88,0)
 ;
"RTN","ORY260",89,0)
TREMOVE(PARAM) ;
"RTN","ORY260",90,0)
 N ENTITY,INST,LINES,OK,VALUES K LINES,VALUES
"RTN","ORY260",91,0)
 D XENVAL^ORWGAPIX(.VALUES,PARAM)
"RTN","ORY260",92,0)
 I '$L($O(VALUES(""))) Q
"RTN","ORY260",93,0)
 S ENTITY=""
"RTN","ORY260",94,0)
 F  S ENTITY=$O(VALUES(ENTITY)) Q:ENTITY=""  D
"RTN","ORY260",95,0)
 . S INST=""
"RTN","ORY260",96,0)
 . F  S INST=$O(VALUES(ENTITY,INST)) Q:INST=""  D
"RTN","ORY260",97,0)
 .. D XGETWP^ORWGAPIX(.LINES,ENTITY,PARAM,INST)
"RTN","ORY260",98,0)
 .. D FIXLINES(.LINES,.OK)
"RTN","ORY260",99,0)
 .. I 'OK D FIXIT(.LINES,ENTITY,PARAM,INST)
"RTN","ORY260",100,0)
 Q
"RTN","ORY260",101,0)
 ;
"RTN","ORY260",102,0)
FIXLINES(LINES,OK) ;
"RTN","ORY260",103,0)
 N I,LINE,NLINE,NLINES,NNUM,NUM,PART K NLINES
"RTN","ORY260",104,0)
 S OK=1,NNUM=0
"RTN","ORY260",105,0)
 S NUM=0
"RTN","ORY260",106,0)
 F  S NUM=$O(LINES(NUM)) Q:NUM<1  D
"RTN","ORY260",107,0)
 . S LINE=$G(LINES(NUM,0))
"RTN","ORY260",108,0)
 . I '$L(LINE) Q
"RTN","ORY260",109,0)
 . S NLINE=LINE
"RTN","ORY260",110,0)
 . I LINE["~9000010.15" D
"RTN","ORY260",111,0)
 .. S NLINE="",OK=0
"RTN","ORY260",112,0)
 .. F I=1:1:999 S PART=$P(LINE,"|",I) Q:PART=""  D
"RTN","ORY260",113,0)
 ... I PART["~9000010.15" Q
"RTN","ORY260",114,0)
 ... S NLINE=NLINE_PART_"|"
"RTN","ORY260",115,0)
 . I NLINE="" Q
"RTN","ORY260",116,0)
 . S NNUM=NNUM+1
"RTN","ORY260",117,0)
 . S NLINES(NNUM,0)=NLINE
"RTN","ORY260",118,0)
 I OK Q
"RTN","ORY260",119,0)
 K LINES
"RTN","ORY260",120,0)
 M LINES=NLINES
"RTN","ORY260",121,0)
 Q
"RTN","ORY260",122,0)
 ;
"RTN","ORY260",123,0)
FIXIT(LINES,ENTITY,PARAM,INST) ;
"RTN","ORY260",124,0)
 D XDEL^ORWGAPIX(ENTITY,PARAM,INST)
"RTN","ORY260",125,0)
 I $L($O(LINES(""))) D XEN^ORWGAPIX(ENTITY,PARAM,INST,.LINES)
"RTN","ORY260",126,0)
 Q
"RTN","ORY260",127,0)
 ;
"RTN","ORY260",128,0)
MAIL(BEGIN) ; -- Send completion message to user who initiated cleanup
"RTN","ORY260",129,0)
 N TIMES,XMSUB,XMTEXT,XMDUN,XMDUZ,XMY,XMZ K XMY
"RTN","ORY260",130,0)
 S XMDUZ="PATCH OR*3.0*260 CLEAN-UP",XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","ORY260",131,0)
 S TIMES="Started: "_$$FMTE^XLFDT(BEGIN)_"; Completed: "_$$FMTE^XLFDT($$NOW^XLFDT)_"."
"RTN","ORY260",132,0)
 S ^TMP("ORTXT",$J,1)="Clean up for patch OR*3.0*260"
"RTN","ORY260",133,0)
 S ^TMP("ORTXT",$J,2)=TIMES
"RTN","ORY260",134,0)
 S ^TMP("ORTXT",$J,3)="Order Node Date Cleanup:"
"RTN","ORY260",135,0)
 S XMTEXT="^TMP(""ORTXT"","_$J_","
"RTN","ORY260",136,0)
 S XMSUB="PATCH OR*3.0*260 Clean Up COMPLETED"
"RTN","ORY260",137,0)
 D ^XMD
"RTN","ORY260",138,0)
 Q
"VER")
8.0^22.0
"BLD",17843,6)
^238
**END**
**END**
