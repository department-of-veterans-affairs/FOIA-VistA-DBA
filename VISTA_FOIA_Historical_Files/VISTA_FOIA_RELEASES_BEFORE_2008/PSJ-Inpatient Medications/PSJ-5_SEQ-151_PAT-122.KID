Released PSJ*5*122 SEQ #151
Extracted from mail message
**KIDS**:PSJ*5.0*122^

**INSTALL NAME**
PSJ*5.0*122
"BLD",5682,0)
PSJ*5.0*122^INPATIENT MEDICATIONS^0^3060327^y
"BLD",5682,1,0)
^^5^5^3060327^
"BLD",5682,1,1,0)
Several sites reported a problem with the sort for the Inpatient Profile 
"BLD",5682,1,2,0)
option [PSJ PR]. The sort by patient and room-bed was no longer 
"BLD",5682,1,3,0)
functioning. This patch corrects this problem. HD68431, HD68690, HD68981, 
"BLD",5682,1,4,0)
HD89922, HD94618, HD94785, HD95473, HD96140, HD96553, HD97042, HD98398, 
"BLD",5682,1,5,0)
HD106136, HD131842
"BLD",5682,4,0)
^9.64PA^^
"BLD",5682,"ABPKG")
n
"BLD",5682,"KRN",0)
^9.67PA^8989.52^19
"BLD",5682,"KRN",.4,0)
.4
"BLD",5682,"KRN",.401,0)
.401
"BLD",5682,"KRN",.402,0)
.402
"BLD",5682,"KRN",.403,0)
.403
"BLD",5682,"KRN",.5,0)
.5
"BLD",5682,"KRN",.84,0)
.84
"BLD",5682,"KRN",3.6,0)
3.6
"BLD",5682,"KRN",3.8,0)
3.8
"BLD",5682,"KRN",9.2,0)
9.2
"BLD",5682,"KRN",9.8,0)
9.8
"BLD",5682,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5682,"KRN",9.8,"NM",1,0)
PSJPR^^0^B40706105
"BLD",5682,"KRN",9.8,"NM","B","PSJPR",1)

"BLD",5682,"KRN",19,0)
19
"BLD",5682,"KRN",19.1,0)
19.1
"BLD",5682,"KRN",101,0)
101
"BLD",5682,"KRN",409.61,0)
409.61
"BLD",5682,"KRN",771,0)
771
"BLD",5682,"KRN",870,0)
870
"BLD",5682,"KRN",8989.51,0)
8989.51
"BLD",5682,"KRN",8989.52,0)
8989.52
"BLD",5682,"KRN",8994,0)
8994
"BLD",5682,"KRN","B",.4,.4)

"BLD",5682,"KRN","B",.401,.401)

"BLD",5682,"KRN","B",.402,.402)

"BLD",5682,"KRN","B",.403,.403)

"BLD",5682,"KRN","B",.5,.5)

"BLD",5682,"KRN","B",.84,.84)

"BLD",5682,"KRN","B",3.6,3.6)

"BLD",5682,"KRN","B",3.8,3.8)

"BLD",5682,"KRN","B",9.2,9.2)

"BLD",5682,"KRN","B",9.8,9.8)

"BLD",5682,"KRN","B",19,19)

"BLD",5682,"KRN","B",19.1,19.1)

"BLD",5682,"KRN","B",101,101)

"BLD",5682,"KRN","B",409.61,409.61)

"BLD",5682,"KRN","B",771,771)

"BLD",5682,"KRN","B",870,870)

"BLD",5682,"KRN","B",8989.51,8989.51)

"BLD",5682,"KRN","B",8989.52,8989.52)

"BLD",5682,"KRN","B",8994,8994)

"BLD",5682,"QUES",0)
^9.62^^
"BLD",5682,"REQB",0)
^9.611^1^1
"BLD",5682,"REQB",1,0)
PSJ*5.0*111^2
"BLD",5682,"REQB","B","PSJ*5.0*111",1)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
122^3060327
"PKG",197,22,1,"PAH",1,1,0)
^^5^5^3060327
"PKG",197,22,1,"PAH",1,1,1,0)
Several sites reported a problem with the sort for the Inpatient Profile 
"PKG",197,22,1,"PAH",1,1,2,0)
option [PSJ PR]. The sort by patient and room-bed was no longer 
"PKG",197,22,1,"PAH",1,1,3,0)
functioning. This patch corrects this problem. HD68431, HD68690, HD68981, 
"PKG",197,22,1,"PAH",1,1,4,0)
HD89922, HD94618, HD94785, HD95473, HD96140, HD96553, HD97042, HD98398, 
"PKG",197,22,1,"PAH",1,1,5,0)
HD106136, HD131842
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSJPR")
0^1^B40706105^B40003412
"RTN","PSJPR",1,0)
PSJPR ;BIR/CML3-INPATIENT MEDICATIONS PROFILE ;25 SEP 97 / 7:43 AM
"RTN","PSJPR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**31,111,122**;16 DEC 97
"RTN","PSJPR",3,0)
 ;
"RTN","PSJPR",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191
"RTN","PSJPR",5,0)
 ;
"RTN","PSJPR",6,0)
 N PFLG,PSJNEW,PSGPTMP,PPAGE,QFLG S PSJNEW=1
"RTN","PSJPR",7,0)
 N PSGLI,PSGWD,PSJAT,PSJPNRB,PSJPWDO,PSJSTOP,PSJTEAM
"RTN","PSJPR",8,0)
 ;
"RTN","PSJPR",9,0)
EN ;
"RTN","PSJPR",10,0)
 G:$D(XQUIT) DONE
"RTN","PSJPR",11,0)
 D @$S('$D(PSJEXTP):"^PSIVXU",1:"ENCV^PSGSETU")
"RTN","PSJPR",12,0)
 G:$D(XQUIT) DONE S PSGPTMP=0,PPAGE=1 K PSJSEL D @$S($D(PSJEXTP):"P^PSJPDIR",1:"GWP^PSJPDIR") G:$G(PSJSTOP)=1 DONE S:$D(PSJEXTP) PSJSEL("SELECT")="P"
"RTN","PSJPR",13,0)
 I $G(PSJSEL("WG"))="^OTHER",PSJSEL("SELECT")="G",PSJSTOP=2 S PSJSEL("SELECT")="C",PSJSEL("RBP")="P"
"RTN","PSJPR",14,0)
 D ENL^PSJO3 G:"^N"[PSJOL EN D GO
"RTN","PSJPR",15,0)
 ;
"RTN","PSJPR",16,0)
DONE ;
"RTN","PSJPR",17,0)
 K ^TMP("PSJON",$J),^TMP("PSJ",$J)
"RTN","PSJPR",18,0)
 D ENIVKV^PSGSETU K AND,AT,C,CA,DDH,DFN,DN,DOB,DRGI,DRGN,DRGT,FIL,FQC,HDR,I1,J,JJ,MF,NF,O,OD,ON,ON55,P,P1,PDRG,PG,PPN,PRI,PRIV,PSGLMT,PSGOE,PSGONC,PSGONR,PSGONV,PSGORD,PSGSS,PSGSSH,PSGON,PSGPR,PSGPRP
"RTN","PSJPR",19,0)
 K PSIVAC,PSIVCT,PSIVREA,PSIVSCR,PSIVUP,PSIVX
"RTN","PSJPR",20,0)
 K PSJACNWP,PSJACOK,PSJDEV,PSJDBL,PSJION,PSJOL,PSJON,PSJOS,PSJP,PSJSEL,PSJSS,PSJSSH,PSJPRW,PSJPRWN,PSJPRWG,PSJPRWGN
"RTN","PSJPR",21,0)
 K PSJOPC,PSJORD,PSJQ,PSJIVOF,PSJOCNT,PSJPR,PSJPRA,PSJPRF,PSJPRP,PSJON,PSJS1,PSJS2,PSJS3,PSJS4,PSJPR,PX,HDT,PSGODT,RF,SD,SLS,SSN,TF,UD,WD,WDP,WT,PSJORIFN,RB,RCT,SUB,XQUIT,ZTOUT
"RTN","PSJPR",22,0)
 ;* 
"RTN","PSJPR",23,0)
 ;* K PSGLI,PSGWD,PSJAT,PSJPNRB,PSJPWDO,PSJSTOP,PSJTEAM
"RTN","PSJPR",24,0)
 Q
"RTN","PSJPR",25,0)
 ;
"RTN","PSJPR",26,0)
GO ;
"RTN","PSJPR",27,0)
 S PSJPRP="P",PSJPRA="" G:PSJSEL("SELECT")'="P" DEV
"RTN","PSJPR",28,0)
 N DIR S DIR(0)="SAO^P:PROFILE;E:EXPANDED VIEWS;B:BOTH",DIR("A")="Show PROFILE only, EXPANDED VIEWS only, or BOTH: ",DIR("B")="PROFILE",DIR("?")="^D PH^PSJPR" W ! D ^DIR G:"^"[Y EN S PSJPRP=Y
"RTN","PSJPR",29,0)
 I "EB"[PSJPRP F  R !!,"Show SHORT, LONG, or NO activity log?  NO// ",AT:DTIME D ALC^PSGVW0 I Q S PSJPRA=AT Q
"RTN","PSJPR",30,0)
 G:PSJPRA="^" EN
"RTN","PSJPR",31,0)
DEV ;
"RTN","PSJPR",32,0)
 S PSJOS=$P(PSJSYSP0,"^",11)
"RTN","PSJPR",33,0)
 K ZTSAVE S PSGTIR="ENQ^PSJPR",ZTDESC="INPATIENT PATIENT PROFILE" F X="DFN","PSJSEL(","PSJOL","PSJOS","PSJPRA","PSJPRP","PSGPTMP","PPAGE","PSJEXTP","PSJHDATE" S ZTSAVE(X)=""
"RTN","PSJPR",34,0)
 D ENDEV^PSGTI Q:POP  D:'$D(IO("Q")) ENQ G EN
"RTN","PSJPR",35,0)
 Q
"RTN","PSJPR",36,0)
 ;
"RTN","PSJPR",37,0)
ENQ ;
"RTN","PSJPR",38,0)
 S Y="PSJPR" F X="W","WG" S:$D(PSJSEL(X)) @(Y_X)=+PSJSEL(X),@(Y_X_"N")=$P(PSJSEL(X),U,2)
"RTN","PSJPR",39,0)
 S PSJACNWP=1 K ^TMP("PSJAT",$J) S PSJPR=IO'=IO(0)!($E(IOST)'="C"),PSGPRP=PSJPRP
"RTN","PSJPR",40,0)
 I PSJSEL("SELECT")="P" S PPN="" F  S PPN=$O(PSJSEL("P",PPN)) Q:PPN=""  D  Q:$G(X)?1"^"."^"
"RTN","PSJPR",41,0)
 .F DFN=0:0 S (PSGP,DFN)=$O(PSJSEL("P",PPN,DFN)) Q:'DFN  D ENBOTH^PSJAC,PP Q:$G(X)?1"^"."^"
"RTN","PSJPR",42,0)
 D:PSJSEL("SELECT")'="P" @("P"_PSJSEL("SELECT")) I PSJPR W:$Y @IOF D ^%ZISC,DONE
"RTN","PSJPR",43,0)
 Q
"RTN","PSJPR",44,0)
PC ;
"RTN","PSJPR",45,0)
 K ^TMP("PSJPR",$J,"OUTPAT")
"RTN","PSJPR",46,0)
 S (STDTE,CLINIC,JDFN)=0
"RTN","PSJPR",47,0)
 F  S STDTE=$O(^PS(55,"AIVC",STDTE)) Q:STDTE=""  F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:CLINIC=""  D
"RTN","PSJPR",48,0)
 . F  S JDFN=$O(^PS(55,"AIVC",STDTE,CLINIC,JDFN)) Q:JDFN=""  I '$D(^TMP("PSJPR",$J,"OUTPAT",JDFN)) S DFN=JDFN K ^TMP("PSJAT",$J) D PAT,PAT1,PJ
"RTN","PSJPR",49,0)
 S (STDTE,CLINIC,JDFN)=0
"RTN","PSJPR",50,0)
 F  S STDTE=$O(^PS(55,"AUDC",STDTE)) Q:STDTE=""  F  S CLINIC=$O(^PS(55,"AIVC",STDTE,CLINIC)) Q:CLINIC=""  D
"RTN","PSJPR",51,0)
 . F  S JDFN=$O(^PS(55,"AUDC",STDTE,CLINIC,JDFN)) Q:JDFN=""  I '$D(^TMP("PSJPR",$J,"OUTPAT",JDFN)) S DFN=JDFN K ^TMP("PSJAT",$J) D PAT,PAT1,PJ
"RTN","PSJPR",52,0)
 Q
"RTN","PSJPR",53,0)
 ;
"RTN","PSJPR",54,0)
PJ ;
"RTN","PSJPR",55,0)
 S ^TMP("PSJPR",$J,"OUTPAT",JDFN)=""
"RTN","PSJPR",56,0)
 ;
"RTN","PSJPR",57,0)
PG ;
"RTN","PSJPR",58,0)
 F PSJPRW=0:0 S PSJPRW=$O(^PS(57.5,"AC",PSJPRWG,PSJPRW)) Q:'PSJPRW  S PSJPRWN=$P($G(^DIC(42,+PSJPRW,0)),"^") I PSJPRWN]"" D PW Q:$G(X)="^"
"RTN","PSJPR",59,0)
 Q
"RTN","PSJPR",60,0)
 ;
"RTN","PSJPR",61,0)
PW ;
"RTN","PSJPR",62,0)
 K ^TMP("PSJAT",$J) F DFN=0:0 S (DFN,PSGP)=$O(^DPT("CN",PSJPRWN,DFN)) Q:'DFN  D PAT
"RTN","PSJPR",63,0)
 D PAT1
"RTN","PSJPR",64,0)
 ;
"RTN","PSJPR",65,0)
 Q
"RTN","PSJPR",66,0)
 ;
"RTN","PSJPR",67,0)
PAT ;
"RTN","PSJPR",68,0)
 S RB=$P($G(^DPT(DFN,.101)),U),PPN=$P($G(^(0)),U),X=$S(PSJSEL("RBP")="R":RB,1:PPN),AT=""
"RTN","PSJPR",69,0)
 I $D(PSJSEL("TM")) S:RB]"" AT=$O(^PS(57.7,"AWRT",PSJPRW,RB,0)) Q:$S($D(PSJSEL("TM","ALL")):0,AT="":1,1:'$D(PSJSEL("TM",AT)))
"RTN","PSJPR",70,0)
 F Y="AT","RB","X" S:@Y="" @Y="ZZ"
"RTN","PSJPR",71,0)
 S ^TMP("PSJAT",$J,AT,X,DFN)=""
"RTN","PSJPR",72,0)
 Q
"RTN","PSJPR",73,0)
 ;
"RTN","PSJPR",74,0)
PAT1 ;
"RTN","PSJPR",75,0)
 K PSJDBL S PSJAT="" F  S PSJAT=$O(^TMP("PSJAT",$J,PSJAT)) Q:PSJAT=""!$G(PSJDBL)  D
"RTN","PSJPR",76,0)
 .S PSJPNRB="" F  S PSJPNRB=$O(^TMP("PSJAT",$J,PSJAT,PSJPNRB)) Q:PSJPNRB=""  S (DFN,PSGP)=+$O(^TMP("PSJAT",$J,PSJAT,PSJPNRB,0)) D ENBOTH^PSJAC,PP I $G(X)["^" S:X="^^" PSJDBL=1 Q
"RTN","PSJPR",77,0)
 Q
"RTN","PSJPR",78,0)
 ;
"RTN","PSJPR",79,0)
PP ;
"RTN","PSJPR",80,0)
 I PSJPRP'="E" D ^PSJO I PSJPRP="P",'PSJPR D:'PSJON READ^PSJUTL Q:$G(X)?1"^"."^"  I PSJON S PSJPRF=1 D ENVW^PSJOE0 K PSGPRF Q
"RTN","PSJPR",81,0)
 Q:PSJPRP="P"  I PSJPRP="E" U IO S PSJON=0,PSJDEV=PSJPR D @$S($D(PSJEXTP):"EN^PSJH1,ENGET^PSJO3",1:"EN^PSJO1(3),ENGET^PSJO3")
"RTN","PSJPR",82,0)
 I 'PSJPR,PSJSEL("SELECT")'="P",'$D(^TMP("PSG",$J)) D READ^PSJUTL Q
"RTN","PSJPR",83,0)
 I PSJPRP'="E",'PSJPR D PP3 Q:$D(DUOUT)!$D(DTOUT)
"RTN","PSJPR",84,0)
 S (PSJS1,PSJS2,PSJS3,PSJS4,X)=""
"RTN","PSJPR",85,0)
 F PSJQ=0:0 S PSJS1=$O(^TMP("PSJ",$J,PSJS1)) Q:PSJS1=""  F PSJQ=0:0 S PSJS2=$O(^TMP("PSJ",$J,PSJS1,PSJS2)) Q:PSJS2=""  F PSJQ=0:0 S PSJS3=$O(^TMP("PSJ",$J,PSJS1,PSJS2,PSJS3)) Q:PSJS3=""  D PP1
"RTN","PSJPR",86,0)
 D:X'["^"&PSJPR BOT^PSJO3 K ^TMP("PSJ",$J) Q
"RTN","PSJPR",87,0)
 ;
"RTN","PSJPR",88,0)
PP1 ;
"RTN","PSJPR",89,0)
 F PSJQ=0:0 S PSJS4=$O(^TMP("PSJ",$J,PSJS1,PSJS2,PSJS3,PSJS4)) Q:PSJS4=""  D PP2
"RTN","PSJPR",90,0)
 Q
"RTN","PSJPR",91,0)
 ;
"RTN","PSJPR",92,0)
PP2 ; Display selected order.
"RTN","PSJPR",93,0)
 N PSJPRF,PSJLM S PSJORD=PSJS4 I $S(PSJORD["V":1,PSJORD["P":$P($G(^PS(53.1,+PSJORD,0)),U,4)="F",1:0) D  Q
"RTN","PSJPR",94,0)
 .S PSJPRF=1 D ENINP^PSIVOPT(PSGP,PSJORD),PP3 Q:$D(DUOUT)!$D(DTOUT)  I PSJPRA'="N" I PSJORD'["P" D ENLOG^PSIVVW1,PP3 Q
"RTN","PSJPR",95,0)
 S PSGORD=PSJORD D EN2^PSGVW,PP3 Q:$D(DUOUT)!$D(DTOUT)  I PSJPRA'="N",((PSJS1["A")!(PSJS1["O")) S AT=PSJPRA D ENA^PSGVW0 D PP3
"RTN","PSJPR",96,0)
 Q
"RTN","PSJPR",97,0)
PP3 S X="" I 'PSJPR K DIR S DIR(0)="E" D ^DIR S:$D(DUOUT)!$D(DTOUT) X="^" I X["^" S (PSJS1,PSJS2,PSJS3,PSJS4)="~"
"RTN","PSJPR",98,0)
 Q
"RTN","PSJPR",99,0)
 ;
"RTN","PSJPR",100,0)
PH ;
"RTN","PSJPR",101,0)
 W !!?2,"Enter a 'P' to print ONLY the PROFILE of orders for this patient.  Enter an",!,"'E' to print ONLY the EXPANDED VIEW of the orders for this patient.  Enter a",!,"'B' to have BOTH the profile (first) and the expanded views print."
"RTN","PSJPR",102,0)
 W "  Enter an '^'to exit." Q
"RTN","PSJPR",103,0)
 ;
"RTN","PSJPR",104,0)
ENOR(PSGP) ;S (PSGP,DFN)=+ORVP,PSGP(0)=^DPT(PSGP,0)
"RTN","PSJPR",105,0)
 S DFN=+PSGP,PSGP(0)=^DPT(PSGP,0)
"RTN","PSJPR",106,0)
ENLM N PSJNEW,PSGPTMP,PPAGE S PSJNEW=1
"RTN","PSJPR",107,0)
 S PSGPTMP=0,PPAGE=1
"RTN","PSJPR",108,0)
 D ENCV^PSGSETU
"RTN","PSJPR",109,0)
 D ENBOTH^PSJAC D:$D(PSJEXTP) CNV^PSJP D ENL^PSJO3 I "^N"'[PSJOL S PSJSEL("SELECT")="P",PSJSEL("P",PSGP(0),PSGP)="",(PSJPRW,PSJPRWG)=0,(PSJPRWN,PSJPRWGN)="",XQUIT="YES" D GO
"RTN","PSJPR",110,0)
 ;* S PSJNKF=1 D READ^PSJUTL G DONE
"RTN","PSJPR",111,0)
 S PSJNKF=1 G DONE
"VER")
8.0^22.0
"BLD",5682,6)
^151
**END**
**END**
