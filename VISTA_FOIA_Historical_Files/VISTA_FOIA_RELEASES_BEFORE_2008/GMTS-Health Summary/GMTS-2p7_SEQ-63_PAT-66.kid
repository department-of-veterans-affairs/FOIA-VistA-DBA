Released GMTS*2.7*66 SEQ #63
Extracted from mail message
**KIDS**:GMTS*2.7*66^

**INSTALL NAME**
GMTS*2.7*66
"BLD",4676,0)
GMTS*2.7*66^HEALTH SUMMARY^0^3030821^y
"BLD",4676,4,0)
^9.64PA^^
"BLD",4676,"INIT")

"BLD",4676,"KRN",0)
^9.67PA^8989.52^19
"BLD",4676,"KRN",.4,0)
.4
"BLD",4676,"KRN",.401,0)
.401
"BLD",4676,"KRN",.402,0)
.402
"BLD",4676,"KRN",.403,0)
.403
"BLD",4676,"KRN",.5,0)
.5
"BLD",4676,"KRN",.84,0)
.84
"BLD",4676,"KRN",3.6,0)
3.6
"BLD",4676,"KRN",3.8,0)
3.8
"BLD",4676,"KRN",9.2,0)
9.2
"BLD",4676,"KRN",9.8,0)
9.8
"BLD",4676,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4676,"KRN",9.8,"NM",1,0)
GMTSXAL^^0^B53349140
"BLD",4676,"KRN",9.8,"NM",2,0)
GMTSXAB^^0^B13076076
"BLD",4676,"KRN",9.8,"NM","B","GMTSXAB",2)

"BLD",4676,"KRN",9.8,"NM","B","GMTSXAL",1)

"BLD",4676,"KRN",19,0)
19
"BLD",4676,"KRN",19.1,0)
19.1
"BLD",4676,"KRN",101,0)
101
"BLD",4676,"KRN",409.61,0)
409.61
"BLD",4676,"KRN",771,0)
771
"BLD",4676,"KRN",870,0)
870
"BLD",4676,"KRN",8989.51,0)
8989.51
"BLD",4676,"KRN",8989.52,0)
8989.52
"BLD",4676,"KRN",8994,0)
8994
"BLD",4676,"KRN","B",.4,.4)

"BLD",4676,"KRN","B",.401,.401)

"BLD",4676,"KRN","B",.402,.402)

"BLD",4676,"KRN","B",.403,.403)

"BLD",4676,"KRN","B",.5,.5)

"BLD",4676,"KRN","B",.84,.84)

"BLD",4676,"KRN","B",3.6,3.6)

"BLD",4676,"KRN","B",3.8,3.8)

"BLD",4676,"KRN","B",9.2,9.2)

"BLD",4676,"KRN","B",9.8,9.8)

"BLD",4676,"KRN","B",19,19)

"BLD",4676,"KRN","B",19.1,19.1)

"BLD",4676,"KRN","B",101,101)

"BLD",4676,"KRN","B",409.61,409.61)

"BLD",4676,"KRN","B",771,771)

"BLD",4676,"KRN","B",870,870)

"BLD",4676,"KRN","B",8989.51,8989.51)

"BLD",4676,"KRN","B",8989.52,8989.52)

"BLD",4676,"KRN","B",8994,8994)

"BLD",4676,"QUES",0)
^9.62^^
"BLD",4676,"REQB",0)
^9.611^1^1
"BLD",4676,"REQB",1,0)
GMTS*2.7*58^2
"BLD",4676,"REQB","B","GMTS*2.7*58",1)

"MBREQ")
0
"PKG",126,-1)
1^1
"PKG",126,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",126,20,0)
^9.402P^^
"PKG",126,22,0)
^9.49I^1^1
"PKG",126,22,1,0)
2.7^2951020^2960611
"PKG",126,22,1,"PAH",1,0)
66^3030821
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMTSXAB")
0^2^B13076076
"RTN","GMTSXAB",1,0)
GMTSXAB ; SLC/KER - List Parameters/Build List            ; 01/06/2003
"RTN","GMTSXAB",2,0)
 ;;2.7;Health Summary;**47,49,58,66**;Oct 20, 1995
"RTN","GMTSXAB",3,0)
 Q
"RTN","GMTSXAB",4,0)
 ;                                 
"RTN","GMTSXAB",5,0)
 ; External References
"RTN","GMTSXAB",6,0)
 ;                                 
"RTN","GMTSXAB",7,0)
 ;   None
"RTN","GMTSXAB",8,0)
 ;                                    
"RTN","GMTSXAB",9,0)
 ; This routine expects:
"RTN","GMTSXAB",10,0)
 ;                                 
"RTN","GMTSXAB",11,0)
 ;   GMTSCPL    Compile Method   1 = Append  0 = Overwrite
"RTN","GMTSXAB",12,0)
 ;   GMTSPRE    Precedence       i.e., USR;SYS;NAT
"RTN","GMTSXAB",13,0)
 ;   ^TMP($J,"GMTSTYP",   List             Input Array
"RTN","GMTSXAB",14,0)
 ;   ROOT(     List             Output Array
"RTN","GMTSXAB",15,0)
 ;                            
"RTN","GMTSXAB",16,0)
BUILD ; Build list of User/System Parameters and National Types
"RTN","GMTSXAB",17,0)
 N GMTSC,GMTSOK,GMTSI,GMTSID,GMTSE,GMTSEI,GMTSV,GMTSVI,GMTSVN,GMTSAT,GMTSOVR
"RTN","GMTSXAB",18,0)
 S GMTSOVR=$S(+($G(GMTSCPL))'>0:1,1:0),GMTSOK=0
"RTN","GMTSXAB",19,0)
 S GMTSC=+($O(@ROOT@(" "),-1))
"RTN","GMTSXAB",20,0)
 F GMTSEI=1:1 Q:$P($G(GMTSPRE),";",GMTSEI)=""  S GMTSE=$P($G(GMTSPRE),";",GMTSEI) D
"RTN","GMTSXAB",21,0)
 . Q:'$L(GMTSE)  I GMTSE="NAT" D NAT Q
"RTN","GMTSXAB",22,0)
 . Q:+GMTSOK>0  S GMTSID="" D ADH,ENT
"RTN","GMTSXAB",23,0)
 Q
"RTN","GMTSXAB",24,0)
NAT ;   Add National Health Summary Types to the List
"RTN","GMTSXAB",25,0)
 Q:+($G(GMTSCPL))>1  N GMTSC,GMTSI,GMTSID,GMTSVI,GMTSVN,GMTSV
"RTN","GMTSXAB",26,0)
 S GMTSI=0,GMTSID=""
"RTN","GMTSXAB",27,0)
 S GMTSC=+($O(@ROOT@(" "),-1))
"RTN","GMTSXAB",28,0)
 F  S GMTSID=$O(^TMP($J,"GMTSTYP","NAT","B",GMTSID)) Q:GMTSID=""  D
"RTN","GMTSXAB",29,0)
 . S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSTYP","NAT","B",GMTSID,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",30,0)
 . . S GMTSV=$$VAL($G(^TMP($J,"GMTSTYP","NAT",GMTSI)))
"RTN","GMTSXAB",31,0)
 . . Q:'$L(GMTSV)  Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",32,0)
 . . Q:$D(@ROOT@("B",GMTSV))
"RTN","GMTSXAB",33,0)
 . . S GMTSC=GMTSC+1
"RTN","GMTSXAB",34,0)
 . . S @ROOT@(GMTSC)=GMTSV,@ROOT@("B",GMTSV,GMTSC)=""
"RTN","GMTSXAB",35,0)
 . . S @ROOT@("C",GMTSC)="NAT"
"RTN","GMTSXAB",36,0)
 K ^TMP($J,"GMTSTYP","NAT")
"RTN","GMTSXAB",37,0)
 Q
"RTN","GMTSXAB",38,0)
ADH ;   Add Adhoc Health Summary Types to the List
"RTN","GMTSXAB",39,0)
 N GMTSC S GMTSC=+($O(@ROOT@(" "),-1)) F GMTSAT="ADH","RAD" S GMTSI=0 D
"RTN","GMTSXAB",40,0)
 . F  S GMTSI=$O(^TMP($J,"GMTSTYP",GMTSE,GMTSAT,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",41,0)
 . . S GMTSV=$$VAL($G(^TMP($J,"GMTSTYP",GMTSE,GMTSAT,GMTSI))) Q:'$L(GMTSV)
"RTN","GMTSXAB",42,0)
 . . Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",43,0)
 . . Q:$D(@ROOT@("B",GMTSV))  S GMTSC=GMTSC+1,@ROOT@(GMTSC)=GMTSV,@ROOT@("B",GMTSV,GMTSC)="",@ROOT@("C",GMTSC)=$G(GMTSE)
"RTN","GMTSXAB",44,0)
 Q
"RTN","GMTSXAB",45,0)
ENT ;   Add Entity Parameters (System/User) to the List
"RTN","GMTSXAB",46,0)
 N GMTSC S GMTSC=+($O(@ROOT@(" "),-1)) F  S GMTSID=$O(^TMP($J,"GMTSTYP",GMTSE,"B",GMTSID)) Q:GMTSID=""  D
"RTN","GMTSXAB",47,0)
 . Q:'$L(GMTSID)  S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSTYP",GMTSE,"B",GMTSID,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",48,0)
 . . S GMTSV=$$VAL($G(^TMP($J,"GMTSTYP",GMTSE,GMTSI))) Q:'$L(GMTSV)  Q:+GMTSV=0
"RTN","GMTSXAB",49,0)
 . . Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))  K:$D(@ROOT@("B",GMTSV)) ^TMP($J,"GMTSTYP",GMTSE,GMTSI)
"RTN","GMTSXAB",50,0)
 S GMTSI=0 F  S GMTSI=$O(^TMP($J,"GMTSTYP",GMTSE,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAB",51,0)
 . S GMTSV=$$VAL($G(^TMP($J,"GMTSTYP",GMTSE,GMTSI))) Q:'$L(GMTSV)
"RTN","GMTSXAB",52,0)
 . Q:+GMTSV=0  Q:'$L($$TRIM^GMTSXA($P(GMTSV,"^",2)," "))
"RTN","GMTSXAB",53,0)
 . Q:$D(@ROOT@("B",GMTSV))
"RTN","GMTSXAB",54,0)
 . S GMTSC=GMTSC+1,@ROOT@(GMTSC)=GMTSV,@ROOT@("B",GMTSV,GMTSC)="",@ROOT@("C",GMTSC)=$G(GMTSE)
"RTN","GMTSXAB",55,0)
 . S:+($G(GMTSOVR))>0 GMTSOK=1
"RTN","GMTSXAB",56,0)
 S:+($G(GMTSOVR))>0&($D(@ROOT@("B"))) GMTSOK=1
"RTN","GMTSXAB",57,0)
 K ^TMP($J,"GMTSTYP",GMTSE)
"RTN","GMTSXAB",58,0)
 Q
"RTN","GMTSXAB",59,0)
VAL(GMTSV) ; Value
"RTN","GMTSXAB",60,0)
 S GMTSV=$G(GMTSV) N GMTST,GMTSI,GMTSVA,GMTSN,GMTSAD,GMTSNM S GMTSI=+GMTSV Q:+GMTSI=0 GMTSV
"RTN","GMTSXAB",61,0)
 S GMTST=$G(^GMT(142,+GMTSI,"T")),GMTSNM=$P($G(^GMT(142,+GMTSI,0)),"^",1)
"RTN","GMTSXAB",62,0)
 S GMTSVA=+($G(^GMT(142,+GMTSI,"VA"))) I +GMTSVA>0,$L(GMTSNM) S GMTSV=+GMTSI_"^"_GMTSNM Q GMTSV
"RTN","GMTSXAB",63,0)
 S GMTSN=$P(GMTSV,"^",2) S:$L(GMTST) GMTSN=GMTST
"RTN","GMTSXAB",64,0)
 S GMTSV=+GMTSI_"^"_GMTSN,GMTSAD=$P($G(^GMT(142,+GMTSI,0)),"^",1)
"RTN","GMTSXAB",65,0)
 S:GMTSAD="GMTS HS ADHOC OPTION" GMTSV=+GMTSI_"^"_GMTSAD
"RTN","GMTSXAB",66,0)
 Q GMTSV
"RTN","GMTSXAB",67,0)
UP(X) Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","GMTSXAL")
0^1^B53349140
"RTN","GMTSXAL",1,0)
GMTSXAL ; SLC/KER - List Parameters/Get List              ; 02/27/2002
"RTN","GMTSXAL",2,0)
 ;;2.7;Health Summary;**47,49,66**;Oct 20, 1995
"RTN","GMTSXAL",3,0)
 Q
"RTN","GMTSXAL",4,0)
 ;                          
"RTN","GMTSXAL",5,0)
 ; External References in GMTSXAL
"RTN","GMTSXAL",6,0)
 ;   DBIA  2992  ^XTV(8989.5,
"RTN","GMTSXAL",7,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSXAL",8,0)
 ;   DBIA  2263  GETLST^XPAR
"RTN","GMTSXAL",9,0)
 ;                
"RTN","GMTSXAL",10,0)
GETLIST(GMTSL,GMTSUSR,GBL,ERR) ; Get Health Summary Type Parameter List
"RTN","GMTSXAL",11,0)
 N GMTSCP,GMTSCPL,GMTSPRE,GMTSDEF,ROOT
"RTN","GMTSXAL",12,0)
 I '$G(GBL) K GMTSL S ROOT=$NA(GMTSL)
"RTN","GMTSXAL",13,0)
 I $G(GBL) D  Q:$G(ERR)
"RTN","GMTSXAL",14,0)
 . I $E($G(GMTSL),1)'="^" S ERR="19^"_$$EZBLD^DIALOG(19) Q
"RTN","GMTSXAL",15,0)
 . S ROOT=GMTSL
"RTN","GMTSXAL",16,0)
 S @ROOT=0
"RTN","GMTSXAL",17,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:+GMTSUSR'>0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",18,0)
 S GMTSCPL=$$CPL(GMTSUSR),GMTSPRE=$$PRE(GMTSUSR)
"RTN","GMTSXAL",19,0)
 D GETLST(.ROOT,GMTSUSR,GMTSCPL,GMTSPRE)
"RTN","GMTSXAL",20,0)
 I $D(GMTSIDX) D
"RTN","GMTSXAL",21,0)
 . S @ROOT@("AC","PRE")=GMTSPRE,@ROOT@("AC","CPL")=GMTSCPL_"^"_$S(+($G(GMTSCPL))'>0:"Overwrite",1:"Append")
"RTN","GMTSXAL",22,0)
 . N GMTSI,GMTST,GMTSTO,GMTSTC,GMTSTCT,GMTSV,GMTSC
"RTN","GMTSXAL",23,0)
 . S GMTSTO="",(GMTSC,GMTSTC,GMTSTCT,GMTSI)=0
"RTN","GMTSXAL",24,0)
 . F  S GMTSI=$O(@ROOT@(GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAL",25,0)
 . . S GMTSV=$G(@ROOT@(GMTSI)),GMTST=$G(@ROOT@("C",GMTSI)) Q:'$L(GMTST)
"RTN","GMTSXAL",26,0)
 . . S GMTSC=GMTSC+1,@ROOT@("A",GMTST,0)=GMTSC,@ROOT@("A",GMTST,GMTSC)=GMTSV
"RTN","GMTSXAL",27,0)
 . . S:GMTST'=GMTSTO GMTSTC=GMTSTC+1,GMTSTCT=0
"RTN","GMTSXAL",28,0)
 . . S GMTSTCT=GMTSTCT+1
"RTN","GMTSXAL",29,0)
 . . S @ROOT@("AB",0)=GMTSTC,@ROOT@("AB",+GMTSTC,0)=GMTSTCT,@ROOT@("AB",+GMTSTC,GMTSTCT)=GMTST_"^"_GMTSV,GMTSTO=GMTST
"RTN","GMTSXAL",30,0)
 . K @ROOT@("B"),@ROOT@("C") S GMTST="" F  S GMTST=$O(@ROOT@("A",GMTST)) Q:GMTST=""  D
"RTN","GMTSXAL",31,0)
 . . S GMTSI=0 F  S GMTSI=$O(@ROOT@("A",GMTST,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSXAL",32,0)
 . . . S GMTSC=+($G(@ROOT@("A",GMTST,GMTSI)))
"RTN","GMTSXAL",33,0)
 . . . S GMTSV=$P($G(@ROOT@("A",GMTST,GMTSI)),"^",2)
"RTN","GMTSXAL",34,0)
 . . . S:+GMTSC>0 @ROOT@("B",+GMTSC,GMTSI)=""
"RTN","GMTSXAL",35,0)
 . . . S:$L(GMTSV)>0 @ROOT@("BA",GMTSV,GMTSI)=""
"RTN","GMTSXAL",36,0)
 Q
"RTN","GMTSXAL",37,0)
 ;                      
"RTN","GMTSXAL",38,0)
GETILIST(GMTSL,GMTSUSR) ; Get Indexed Health Summary Types Parameter List
"RTN","GMTSXAL",39,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",40,0)
 N GMTSIDX S GMTSIDX=1 D GETLIST(.GMTSL,GMTSUSR)
"RTN","GMTSXAL",41,0)
 Q
"RTN","GMTSXAL",42,0)
 ;                            
"RTN","GMTSXAL",43,0)
GETLST(ROOT,GMTSUSR,GMTSCPL,GMTSPRE) ; Get List
"RTN","GMTSXAL",44,0)
 ;                            
"RTN","GMTSXAL",45,0)
 ; Health Summary Version of call in GETHS^ORWRP:
"RTN","GMTSXAL",46,0)
 ;                         
"RTN","GMTSXAL",47,0)
 ;   D GETLST^XPAR(.ORHSPARM,"ALL",
"RTN","GMTSXAL",48,0)
 ;                   "ORWRP HEALTH SUMMARY TYPE LIST","N")
"RTN","GMTSXAL",49,0)
 ;                            
"RTN","GMTSXAL",50,0)
 ; Merges Health Summary Parameters for display in the
"RTN","GMTSXAL",51,0)
 ; Health Summary Types on the Reports Tab.  National
"RTN","GMTSXAL",52,0)
 ; Health Summary Types (remote data views) are grouped 
"RTN","GMTSXAL",53,0)
 ; together and added to the list separately.  For a 
"RTN","GMTSXAL",54,0)
 ; National Health Summary Type to be included on the list,
"RTN","GMTSXAL",55,0)
 ; it must first be defined in the parameters file.
"RTN","GMTSXAL",56,0)
 ; The merge of parameters is accomplished by either 
"RTN","GMTSXAL",57,0)
 ; appending or over-writing the parameters to the list.
"RTN","GMTSXAL",58,0)
 ;                            
"RTN","GMTSXAL",59,0)
 ; Input Variables
"RTN","GMTSXAL",60,0)
 ;                    
"RTN","GMTSXAL",61,0)
 ;   GMTSL    Local Array of Health Summary Parameters 
"RTN","GMTSXAL",62,0)
 ;                            
"RTN","GMTSXAL",63,0)
 ;   GMTSCPL  Compile Method
"RTN","GMTSXAL",64,0)
 ;                            
"RTN","GMTSXAL",65,0)
 ;     GMTSCPL=1   <DEFAULT>  Append Parameters to List
"RTN","GMTSXAL",66,0)
 ;     GMTSCPL=0   Overwrite Parameters (by entity)
"RTN","GMTSXAL",67,0)
 ;                            
"RTN","GMTSXAL",68,0)
 ;   GMTSPRE  Precedence of Entities
"RTN","GMTSXAL",69,0)
 ;                            
"RTN","GMTSXAL",70,0)
 ;     Having defined how the list is to be created using
"RTN","GMTSXAL",71,0)
 ;     GMTSCPL (Append or Overwrite), this variable 
"RTN","GMTSXAL",72,0)
 ;     defines the order that each entity will be 
"RTN","GMTSXAL",73,0)
 ;     referenced (first, second, etc.)
"RTN","GMTSXAL",74,0)
 ;                            
"RTN","GMTSXAL",75,0)
 ;       FORMAT   Series of 3 Characters, Uppercase taken
"RTN","GMTSXAL",76,0)
 ;                from the PARAMETER ENTITY file delimited
"RTN","GMTSXAL",77,0)
 ;                by semi-colons
"RTN","GMTSXAL",78,0)
 ;                            
"RTN","GMTSXAL",79,0)
 ;                Default value:  $$DEF^GMTSXAW
"RTN","GMTSXAL",80,0)
 ;                            
"RTN","GMTSXAL",81,0)
LST ; Create List
"RTN","GMTSXAL",82,0)
 ;
"RTN","GMTSXAL",83,0)
 N DIC,DTOUT,DUOUT,GMTSE,GMTSENT,GMTSER,GMTSI,GMTSLI,GMTSLL,GMTSLN
"RTN","GMTSXAL",84,0)
 N GMTSPAR,GMTSYS,GMTSAD,GMTSAR,GMTST,GMTSV,GMTSVAL,GMTSII
"RTN","GMTSXAL",85,0)
 N GMTSUP,GMTSEI,GMTSIV,GMTSEV,GMTSN,GMTSCHK,X,Y
"RTN","GMTSXAL",86,0)
 K ^TMP($J,"GMTSLL"),^TMP($J,"GMTSLN"),^TMP($J,"GMTSTYP")
"RTN","GMTSXAL",87,0)
 S GMTSUSR=+($G(GMTSUSR)) Q:GMTSUSR=0  Q:'$L($$UNM^GMTSXAW3(GMTSUSR))
"RTN","GMTSXAL",88,0)
 S GMTSCPL=$G(GMTSCPL),GMTSPRE=$G(GMTSPRE)
"RTN","GMTSXAL",89,0)
 S:'$L(GMTSCPL) GMTSCPL=0 S:'$L(GMTSPRE) GMTSPRE=$$DEF^GMTSXAW
"RTN","GMTSXAL",90,0)
 S (GMTSPAR,X)="ORWRP HEALTH SUMMARY TYPE LIST"
"RTN","GMTSXAL",91,0)
 S GMTSAD="GMTS HS ADHOC OPTION",GMTSAR="GMTS HS REMOTE ADHOC OPTION"
"RTN","GMTSXAL",92,0)
 S GMTSYS=$$SYSV^GMTSXAW3,GMTSUP=$$UVP^GMTSXAW3(+GMTSUSR),GMTSPAR=+($$PDI^GMTSXAW3(GMTSPAR)) Q:GMTSPAR'>0  S GMTSENT="",U="^"
"RTN","GMTSXAL",93,0)
 D CHK^GMTSXAW(.GMTSCHK,GMTSUSR,"GMTS")
"RTN","GMTSXAL",94,0)
 F  S GMTSENT=$O(^XTV(8989.5,"AC",GMTSPAR,GMTSENT)) Q:GMTSENT=""  D BYE
"RTN","GMTSXAL",95,0)
 K @ROOT D BUILD^GMTSXAB
"RTN","GMTSXAL",96,0)
 K:'$D(GMTSIDX) @ROOT@("B"),@ROOT@("C") S (GMTSI,GMTSN)=0
"RTN","GMTSXAL",97,0)
 F  S GMTSI=$O(@ROOT@(GMTSI)) Q:+GMTSI=0  S GMTSN=GMTSN+1
"RTN","GMTSXAL",98,0)
 S:+GMTSN>0 GMTSL=GMTSN
"RTN","GMTSXAL",99,0)
 K ^TMP($J,"GMTSLL"),^TMP($J,"GMTSLN"),^TMP($J,"GMTSTYP")
"RTN","GMTSXAL",100,0)
 Q 
"RTN","GMTSXAL",101,0)
BYE ;   By Entity
"RTN","GMTSXAL",102,0)
 Q:'$L(GMTSENT)  Q:GMTSENT'[";"  Q:+GMTSENT=0  Q:'$L($P(GMTSENT,";",2))  Q:'$D(GMTSCHK("CHK",GMTSENT))
"RTN","GMTSXAL",103,0)
 S GMTSVAL=$P($G(@(U_$P(GMTSENT,";",2)_+($P(GMTSENT,";",1))_",0)")),U,1)
"RTN","GMTSXAL",104,0)
 Q:'$L(GMTSVAL)  K GMTSL,GMTSER Q:'$L($G(GMTSPAR))  Q:'$L($G(GMTSENT))
"RTN","GMTSXAL",105,0)
 D GETLST^XPAR(.GMTSL,GMTSENT,GMTSPAR,"B",.GMTSER) Q:+($G(GMTSER))>0
"RTN","GMTSXAL",106,0)
 S GMTSLI=0 F  S GMTSLI=$O(GMTSL(GMTSLI)) Q:+GMTSLI=0  D BYP
"RTN","GMTSXAL",107,0)
 Q
"RTN","GMTSXAL",108,0)
BYP ;   By Parameter
"RTN","GMTSXAL",109,0)
 S GMTST=$$ABR^GMTSXAW3(GMTSENT) N GMTSII,GMTSEI,GMTSIV,GMTSEV,GMTSIEN,GMTSVAL,GMTSND,GMTSNM,GMTSHT
"RTN","GMTSXAL",110,0)
 S GMTSII=$P($G(GMTSL(GMTSLI,"N")),"^",1) Q:'$L(GMTSII)
"RTN","GMTSXAL",111,0)
 S GMTSEI=$P($G(GMTSL(GMTSLI,"N")),"^",2) Q:'$L(GMTSEI)
"RTN","GMTSXAL",112,0)
 S GMTSIV=$P($G(GMTSL(GMTSLI,"V")),"^",1) Q:'$L(GMTSIV)
"RTN","GMTSXAL",113,0)
 S GMTSEV=$P($G(GMTSL(GMTSLI,"V")),"^",2) Q:'$L(GMTSEV)
"RTN","GMTSXAL",114,0)
 S GMTST=$S(GMTSPRE["NAT"&(+($G(^GMT(142,+GMTSIV,"VA")))>0):"NAT",1:$G(GMTST))
"RTN","GMTSXAL",115,0)
 S GMTSND=$S(GMTSPRE["NAT"&(+($G(^GMT(142,+GMTSIV,"VA")))>0):"^TMP($J,""GMTSLN"")",1:"^TMP($J,""GMTSLL"")")
"RTN","GMTSXAL",116,0)
 D SAV
"RTN","GMTSXAL",117,0)
 Q
"RTN","GMTSXAL",118,0)
SAV ;   Save Parameters
"RTN","GMTSXAL",119,0)
 N GMTSI Q:'$L($G(GMTSL(GMTSLI,"V")))  S GMTSVAL=GMTSL(GMTSLI,"V"),GMTSHT=+GMTSVAL,GMTSNM=$P(GMTSVAL,"^",2)
"RTN","GMTSXAL",120,0)
 S GMTSI=(+($O(@GMTSND@(" "),-1)+1))
"RTN","GMTSXAL",121,0)
 I GMTSNM=GMTSAD!(GMTSNM=GMTSAR) D SAVD Q
"RTN","GMTSXAL",122,0)
 S @GMTSND@(GMTSI,"N")=$G(GMTSL(GMTSLI,"N"))
"RTN","GMTSXAL",123,0)
 S @GMTSND@(GMTSI,"V")=$G(GMTSVAL)
"RTN","GMTSXAL",124,0)
 S @GMTSND@(GMTSI,"E")=$G(GMTSENT)
"RTN","GMTSXAL",125,0)
 S ^TMP($J,"GMTSTYP",GMTST,GMTSI)=$G(GMTSVAL)
"RTN","GMTSXAL",126,0)
 S:$L(GMTSNM) ^TMP($J,"GMTSTYP",GMTST,"B",GMTSNM,GMTSI)=""
"RTN","GMTSXAL",127,0)
 S:GMTSHT>0 ^TMP($J,"GMTSTYP",GMTST,"C",GMTSHT,GMTSI)=""
"RTN","GMTSXAL",128,0)
 Q
"RTN","GMTSXAL",129,0)
SAVD ;   Save Adhoc and Remote Adhoc Parameters
"RTN","GMTSXAL",130,0)
 N GMTSAT,GMTSC,GMTSI S GMTSND=$G(GMTSND) Q:'$L(GMTSND)  Q:GMTSND="^TMP($J,""GMTSLN"")"
"RTN","GMTSXAL",131,0)
 I GMTSNM=GMTSAD S GMTSI=(+($O(@GMTSND@("ADH"," "),-1)+1)),GMTSAT="ADH"
"RTN","GMTSXAL",132,0)
 I GMTSNM=GMTSAR S GMTSI=(+($O(@GMTSND@("RAD"," "),-1)+1)),GMTSAT="RAD"
"RTN","GMTSXAL",133,0)
 Q:'$L($G(GMTST))  Q:'$L($G(GMTSAT))  Q:'$L($G(GMTSNM))  Q:'$L($G(GMTSVAL))  Q:'$L($G(GMTSHT))  Q:$D(^TMP($J,"GMTSTYP",GMTST,GMTSAT,"B",GMTSNM))
"RTN","GMTSXAL",134,0)
 S @GMTSND@("GMTSAT",GMTSI,"N")=$G(GMTSL(GMTSLI,"N"))
"RTN","GMTSXAL",135,0)
 S @GMTSND@("GMTSAT",GMTSI,"V")=$G(GMTSL(GMTSLI,"V"))
"RTN","GMTSXAL",136,0)
 S @GMTSND@("GMTSAT",GMTSI,"E")=$G(GMTSENT)
"RTN","GMTSXAL",137,0)
 S @GMTSND@("GMTSAT","B",GMTSVAL,GMTSI)=""
"RTN","GMTSXAL",138,0)
 S @GMTSND@("GMTSAT","C",GMTSEI_"^"_GMTSVAL,GMTSI)=""
"RTN","GMTSXAL",139,0)
 S GMTSC=+($O(@GMTSND@("GMTST",GMTSAT," "),-1))+1
"RTN","GMTSXAL",140,0)
 S ^TMP($J,"GMTSTYP",GMTST,GMTSAT,GMTSC)=$G(GMTSVAL)
"RTN","GMTSXAL",141,0)
 S:$L(GMTSNM) ^TMP($J,"GMTSTYP",GMTST,GMTSAT,"B",GMTSNM,GMTSC)=""
"RTN","GMTSXAL",142,0)
 S:GMTSHT>0 ^TMP($J,"GMTSTYP",GMTST,GMTSAT,"C",GMTSHT,GMTSC)=""
"RTN","GMTSXAL",143,0)
 Q
"RTN","GMTSXAL",144,0)
 ;                            
"RTN","GMTSXAL",145,0)
 ; Miscellaneous
"RTN","GMTSXAL",146,0)
NUM(X) ;   Number of Types for User X
"RTN","GMTSXAL",147,0)
 N GMTSUSR,GMTSL,GMTSI,GMTSN S GMTSUSR=+($G(X)),(GMTSI,GMTSN)=0 Q:GMTSUSR=0 0 Q:'$L($$UNM^GMTSXAW3(GMTSUSR)) 0
"RTN","GMTSXAL",148,0)
 D GETLIST(.GMTSL,GMTSUSR) Q:+($G(GMTSL))>0 +($G(GMTSL))
"RTN","GMTSXAL",149,0)
 F  S GMTSI=$O(GMTSL(GMTSI)) Q:+GMTSI=0  S GMTSN=GMTSN+1
"RTN","GMTSXAL",150,0)
 S X=GMTSN Q X
"RTN","GMTSXAL",151,0)
DEF(X) ; Defaults    <compile> ^ <precedence> 
"RTN","GMTSXAL",152,0)
 N DIERR,GMTSUSR,GMTSSIC,GMTSSIP,GMTSSCPL,GMTSPRE
"RTN","GMTSXAL",153,0)
 S GMTSSIC=1,GMTSSIP=$$DEF^GMTSXAW
"RTN","GMTSXAL",154,0)
 S GMTSUSR=+($G(X)),X=""
"RTN","GMTSXAL",155,0)
 Q:+GMTSUSR=0 (GMTSSIC_"^"_GMTSSIP)
"RTN","GMTSXAL",156,0)
 Q:'$L($$UNM^GMTSXAW3(+GMTSUSR)) (GMTSSIC_"^"_GMTSSIP)
"RTN","GMTSXAL",157,0)
 S GMTSCPL=$$GET1^DIQ(142.98,(GMTSUSR_","),10,"I")
"RTN","GMTSXAL",158,0)
 S:GMTSCPL="" GMTSCPL=GMTSSIC
"RTN","GMTSXAL",159,0)
 S GMTSPRE=$$GET1^DIQ(142.98,(GMTSUSR_","),11)
"RTN","GMTSXAL",160,0)
 S:GMTSPRE="" GMTSPRE=GMTSSIP
"RTN","GMTSXAL",161,0)
 S X=GMTSCPL_"^"_GMTSPRE
"RTN","GMTSXAL",162,0)
 Q X
"RTN","GMTSXAL",163,0)
CPL(X) ;   Compile Method
"RTN","GMTSXAL",164,0)
 N DIERR,GMTSITE,GMTSUSR,GMTSCPL S GMTSUSR=+($G(X))
"RTN","GMTSXAL",165,0)
 S GMTSITE=$P($G(^GMT(142.98,"ASITE")),"^",1)
"RTN","GMTSXAL",166,0)
 S GMTSITE=$S($L(GMTSITE):+GMTSITE,1:1) I GMTSUSR=.5 S X=GMTSITE Q X
"RTN","GMTSXAL",167,0)
 S GMTSCPL=$$GET1^DIQ(142.98,(GMTSUSR_","),10,"I")
"RTN","GMTSXAL",168,0)
 S:'$L(GMTSCPL) GMTSCPL=GMTSITE
"RTN","GMTSXAL",169,0)
 S X=GMTSCPL
"RTN","GMTSXAL",170,0)
 Q X
"RTN","GMTSXAL",171,0)
PRE(X) ;   Precedence
"RTN","GMTSXAL",172,0)
 N GMTSUSR,GMTSPRE,GMTSDEF,GMTSC,GMTSI,GMTSA,GMTS S GMTSUSR=+($G(X))
"RTN","GMTSXAL",173,0)
 S (GMTSDEF,X)=$$DEF^GMTSXAW Q:+GMTSUSR=0 X  S GMTSPRE=$$GET1^DIQ(142.98,(GMTSUSR_","),11),GMTSC="^"_$TR($$DEF^GMTSXAW,";","^")_"^"
"RTN","GMTSXAL",174,0)
 S GMTS="" F GMTSI=1:1 Q:GMTSI>$L(GMTSPRE,";")  D
"RTN","GMTSXAL",175,0)
 . S GMTSA=$P($G(GMTSPRE),";",GMTSI) Q:$L(GMTSA)'=3  Q:GMTSA'="NAT"&(GMTSC'[("^"_GMTSA_"^"))  Q:GMTS[(";"_GMTSA)  S GMTS=GMTS_";"_GMTSA
"RTN","GMTSXAL",176,0)
 S GMTSPRE=$$TRIM^GMTSXA(GMTS,";") S:'$L(GMTSPRE) GMTSPRE=GMTSDEF
"RTN","GMTSXAL",177,0)
 S X=GMTSPRE
"RTN","GMTSXAL",178,0)
 Q X
"VER")
8.0^22.0
**END**
**END**
