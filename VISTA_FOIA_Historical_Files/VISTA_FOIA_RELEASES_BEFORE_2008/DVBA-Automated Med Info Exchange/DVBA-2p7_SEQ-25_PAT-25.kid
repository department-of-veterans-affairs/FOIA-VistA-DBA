Released DVBA*2.7*25 SEQ #25
Extracted from mail message
**KIDS**:DVBA*2.7*25^

**INSTALL NAME**
DVBA*2.7*25
"BLD",2043,0)
DVBA*2.7*25^AUTOMATED MED INFO EXCHANGE^0^2990916^y
"BLD",2043,1,0)
^^1^1^2990916^
"BLD",2043,1,1,0)
Correct undefined error for variable "DA"
"BLD",2043,4,0)
^9.64PA^^
"BLD",2043,"KRN",0)
^9.67PA^19^18
"BLD",2043,"KRN",.4,0)
.4
"BLD",2043,"KRN",.401,0)
.401
"BLD",2043,"KRN",.402,0)
.402
"BLD",2043,"KRN",.403,0)
.403
"BLD",2043,"KRN",.5,0)
.5
"BLD",2043,"KRN",.84,0)
.84
"BLD",2043,"KRN",3.6,0)
3.6
"BLD",2043,"KRN",3.8,0)
3.8
"BLD",2043,"KRN",9.2,0)
9.2
"BLD",2043,"KRN",9.8,0)
9.8
"BLD",2043,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",2043,"KRN",9.8,"NM",1,0)
DVBAREG2^^0^B32252001
"BLD",2043,"KRN",9.8,"NM","B","DVBAREG2",1)

"BLD",2043,"KRN",19,0)
19
"BLD",2043,"KRN",19.1,0)
19.1
"BLD",2043,"KRN",101,0)
101
"BLD",2043,"KRN",409.61,0)
409.61
"BLD",2043,"KRN",771,0)
771
"BLD",2043,"KRN",869.2,0)
869.2
"BLD",2043,"KRN",870,0)
870
"BLD",2043,"KRN",8994,0)
8994
"BLD",2043,"KRN","B",.4,.4)

"BLD",2043,"KRN","B",.401,.401)

"BLD",2043,"KRN","B",.402,.402)

"BLD",2043,"KRN","B",.403,.403)

"BLD",2043,"KRN","B",.5,.5)

"BLD",2043,"KRN","B",.84,.84)

"BLD",2043,"KRN","B",3.6,3.6)

"BLD",2043,"KRN","B",3.8,3.8)

"BLD",2043,"KRN","B",9.2,9.2)

"BLD",2043,"KRN","B",9.8,9.8)

"BLD",2043,"KRN","B",19,19)

"BLD",2043,"KRN","B",19.1,19.1)

"BLD",2043,"KRN","B",101,101)

"BLD",2043,"KRN","B",409.61,409.61)

"BLD",2043,"KRN","B",771,771)

"BLD",2043,"KRN","B",869.2,869.2)

"BLD",2043,"KRN","B",870,870)

"BLD",2043,"KRN","B",8994,8994)

"BLD",2043,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",173,-1)
1^1
"PKG",173,0)
AUTOMATED MED INFO EXCHANGE^DVBA^The entire AMIE package 7131/2507.
"PKG",173,22,0)
^9.49I^1^1
"PKG",173,22,1,0)
2.7^2950410^2950427
"PKG",173,22,1,"PAH",1,0)
25^2990916
"PKG",173,22,1,"PAH",1,1,0)
^^1^1^2990916
"PKG",173,22,1,"PAH",1,1,1,0)
Correct undefined error for variable "DA"
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DVBAREG2")
0^1^B32252001
"RTN","DVBAREG2",1,0)
DVBAREG2 ;ALB/JLU;second half of the 7131 input;3/2/99
"RTN","DVBAREG2",2,0)
 ;;2.7;AMIE;**3,5,14,17,20,25**;Apr 10, 1995
"RTN","DVBAREG2",3,0)
 ;
"RTN","DVBAREG2",4,0)
CONT ;asks selection from list
"RTN","DVBAREG2",5,0)
 S DIR(0)="NAO^1:"_X1_":0"
"RTN","DVBAREG2",6,0)
 S DIR("A")="Select 1-"_X1_"   or '^' to Exit or Return to continue "
"RTN","DVBAREG2",7,0)
 D ^DIR
"RTN","DVBAREG2",8,0)
 K DIR
"RTN","DVBAREG2",9,0)
 I $D(DTOUT)!$D(DUOUT) S DVBASTOP=1 Q
"RTN","DVBAREG2",10,0)
 I Y]"" S DVBANS=Y
"RTN","DVBAREG2",11,0)
 E  K DVBANS
"RTN","DVBAREG2",12,0)
 Q
"RTN","DVBAREG2",13,0)
 ;
"RTN","DVBAREG2",14,0)
SINGLE ;when select single entry point
"RTN","DVBAREG2",15,0)
 S XTYPE=""
"RTN","DVBAREG2",16,0)
 S X1=$O(^TMP("DVBA",$J,0))
"RTN","DVBAREG2",17,0)
 I X1="" S DVBASTOP=1 Q
"RTN","DVBAREG2",18,0)
 S XTYPE=$O(^TMP("DVBA",$J,X1,XTYPE))
"RTN","DVBAREG2",19,0)
 I XTYPE="" S DVBASTOP=1 Q
"RTN","DVBAREG2",20,0)
 S DIR("A",1)=""
"RTN","DVBAREG2",21,0)
 S DIR("A",2)=$P(^TMP("DVBA",$J,X1,XTYPE),U)
"RTN","DVBAREG2",22,0)
 S DIR("A")="Is this the correct information? "
"RTN","DVBAREG2",23,0)
 S DIR("B")="NO"
"RTN","DVBAREG2",24,0)
 S DIR(0)="YA"
"RTN","DVBAREG2",25,0)
 D ^DIR
"RTN","DVBAREG2",26,0)
 K DIR
"RTN","DVBAREG2",27,0)
 I $D(DUOUT)!($D(DTOUT)) S DVBASTOP=1 Q
"RTN","DVBAREG2",28,0)
 I Y S DVBANS=X1,DVBTYPE=XTYPE,DVBDOC=$S(DVBTYPE["ADMISSION":"A",1:"L")
"RTN","DVBAREG2",29,0)
 E  K DVBANS
"RTN","DVBAREG2",30,0)
 Q
"RTN","DVBAREG2",31,0)
 ;
"RTN","DVBAREG2",32,0)
DTRNG(DFN) ;gets date range from user
"RTN","DVBAREG2",33,0)
 S DIR("A",1)="Display Admission or Activity information"
"RTN","DVBAREG2",34,0)
 S DIR("A")="for "_$P(DFN,U,2)_"  by"
"RTN","DVBAREG2",35,0)
 S DIR("?")="Date Range will allow the user to select the specific dates."
"RTN","DVBAREG2",36,0)
 S DIR("?",1)="All Dates will show the user all possible information."
"RTN","DVBAREG2",37,0)
 S DIR(0)="SM^D:Date Range;A:All Dates"
"RTN","DVBAREG2",38,0)
 D ^DIR
"RTN","DVBAREG2",39,0)
 K DIR
"RTN","DVBAREG2",40,0)
 I $D(DTOUT)!($D(DUOUT)) S DVBAQUIT=1 Q
"RTN","DVBAREG2",41,0)
 I X="" S DVBASTOP=1 Q
"RTN","DVBAREG2",42,0)
 S DVBBDT=0,DVBEDT=0
"RTN","DVBAREG2",43,0)
 S VAR(1,0)="0,0,0,1,0^"
"RTN","DVBAREG2",44,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",45,0)
 K VAR
"RTN","DVBAREG2",46,0)
 I Y="D" DO
"RTN","DVBAREG2",47,0)
 .D DATE^DVBCUTL4(.DVBBDT,.DVBEDT)
"RTN","DVBAREG2",48,0)
 .S Y="D"
"RTN","DVBAREG2",49,0)
 .I DVBBDT>0,'+$P(DVBBDT,".",2) S DVBBDT=DVBBDT-.0000001
"RTN","DVBAREG2",50,0)
 .I DVBEDT>0,'+$P(DVBEDT,".",2) S DVBEDT=DVBEDT+.9999999
"RTN","DVBAREG2",51,0)
 .I DVBBDT=0,DVBEDT=0 S DVBAQUIT=1
"RTN","DVBAREG2",52,0)
 .I DVBBDT=-1,DVBEDT=-1 S DVBASTOP=1
"RTN","DVBAREG2",53,0)
 .Q
"RTN","DVBAREG2",54,0)
 Q
"RTN","DVBAREG2",55,0)
 ;
"RTN","DVBAREG2",56,0)
CLEAN ;cleans up variables
"RTN","DVBAREG2",57,0)
 K DA,ADM,ADMDT,ADMNUM,DFN,DIC,A,DR,PNAM,SSN,TRN,Z,DINUM,DTAR,C,J,K,L,C,D,DIE,ONFILE,%,OLDDA,%Y,DIK,ZI,X,Y,AROWOUT,DVBAEDT,DVBAENTR,DVBASTOP,DVBREQDT,DVBANS,DVBTYPE
"RTN","DVBAREG2",58,0)
 K ^TMP("DVBA",$J),^UTILITY("DIQ1",$J)
"RTN","DVBAREG2",59,0)
 Q
"RTN","DVBAREG2",60,0)
 ;
"RTN","DVBAREG2",61,0)
PAGE ;pages/dispays end of page/screen
"RTN","DVBAREG2",62,0)
 S VAR(1,0)="0,0,0,0,1^"
"RTN","DVBAREG2",63,0)
 S VAR(2,0)="0,0,"_(IOM-$L(HD)\2)_":0,0,0^"_HD
"RTN","DVBAREG2",64,0)
 S VAR(3,0)="0,0,"_(IOM-$L(HNAME)\2)_":0,1:2,0^"_HNAME
"RTN","DVBAREG2",65,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",66,0)
 K VAR
"RTN","DVBAREG2",67,0)
 Q
"RTN","DVBAREG2",68,0)
 ;
"RTN","DVBAREG2",69,0)
SELECT ;checks doc type, request status and calls deletion, if necessary
"RTN","DVBAREG2",70,0)
 N ZI
"RTN","DVBAREG2",71,0)
 K DVBAENTR
"RTN","DVBAREG2",72,0)
 S DVBREQDT=9999999.9999999-DVBANS
"RTN","DVBAREG2",73,0)
 I DVBTYPE["ADMISSION" DO
"RTN","DVBAREG2",74,0)
 .S ADMNUM=$P(^TMP("DVBA",$J,DVBANS,DVBTYPE),U,2)
"RTN","DVBAREG2",75,0)
 D COMPSEL
"RTN","DVBAREG2",76,0)
 Q
"RTN","DVBAREG2",77,0)
 ;
"RTN","DVBAREG2",78,0)
COMPSEL ;** Compare selected 7131 to existing
"RTN","DVBAREG2",79,0)
 N DVBATMPT
"RTN","DVBAREG2",80,0)
 I DVBTYPE["ADMISSION" S DVBATMPT="A"
"RTN","DVBAREG2",81,0)
 I DVBTYPE'["ADMISSION" S DVBATMPT="L"
"RTN","DVBAREG2",82,0)
 F ZI=0:0 S ZI=$O(^DVB(396,"B",+DFN,ZI)) Q:ZI=""  I $D(^DVB(396,"G",+$E(DVBREQDT,1,14),ZI))&(DVBATMPT=$P(^DVB(396,ZI,2),"^",10)) S DVBAENTR=ZI Q
"RTN","DVBAREG2",83,0)
 I $D(DVBAENTR) DO
"RTN","DVBAREG2",84,0)
 .D ALERT(ZI)
"RTN","DVBAREG2",85,0)
 .D ASK
"RTN","DVBAREG2",86,0)
 .Q:$D(DVBAQUIT)!($D(DVBASTOP))
"RTN","DVBAREG2",87,0)
 .I '$$LOCK^DVBAUTL6(DVBAENTR) S DVBASTOP=1 Q
"RTN","DVBAREG2",88,0)
 .S STAT=$P(^DVB(396,DVBAENTR,1),U,12)
"RTN","DVBAREG2",89,0)
 .S ONFILE=0
"RTN","DVBAREG2",90,0)
 .I STAT'="" D ALERT1
"RTN","DVBAREG2",91,0)
 .Q:$D(DVBAQUIT)!($D(DVBASTOP))
"RTN","DVBAREG2",92,0)
 .I ONFILE=1 S DVBASTOP=1 Q
"RTN","DVBAREG2",93,0)
 .Q
"RTN","DVBAREG2",94,0)
 I '$D(DVBAENTR) DO
"RTN","DVBAREG2",95,0)
 .D DICW^DVBAUTIL
"RTN","DVBAREG2",96,0)
 .D ASK1
"RTN","DVBAREG2",97,0)
 .I $D(DVBASTOP)!($D(DVBAQUIT)) Q
"RTN","DVBAREG2",98,0)
 .D STUFF
"RTN","DVBAREG2",99,0)
 .Q
"RTN","DVBAREG2",100,0)
 I '$D(DVBAENTR) S DVBASTOP=1
"RTN","DVBAREG2",101,0)
 Q
"RTN","DVBAREG2",102,0)
 ;
"RTN","DVBAREG2",103,0)
ALERT(Y) ;displays when a potential hit in the 7131 file.
"RTN","DVBAREG2",104,0)
 S VAR(1,0)="1,0,0,2,0^There is a 7131 already on file for "_$$FMTE^XLFDT(DVBREQDT,"5DZ")
"RTN","DVBAREG2",105,0)
 S STAT=$P(^DVB(396,+Y,1),U,12)
"RTN","DVBAREG2",106,0)
 S VAR(2,0)="0,0,0,1:1,0^Status is "_$S(STAT'="":"FINALIZED",1:"OPEN")
"RTN","DVBAREG2",107,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",108,0)
 K VAR
"RTN","DVBAREG2",109,0)
 Q
"RTN","DVBAREG2",110,0)
ALERT1 ;
"RTN","DVBAREG2",111,0)
 I STAT'="" DO
"RTN","DVBAREG2",112,0)
 .S VAR(1,0)="0,0,0,1,0^"
"RTN","DVBAREG2",113,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",114,0)
 .K VAR
"RTN","DVBAREG2",115,0)
 .S DIR("A")="Do you want to delete the existing 7131 for this date: "
"RTN","DVBAREG2",116,0)
 .S DIR(0)="YAO"
"RTN","DVBAREG2",117,0)
 .S DIR("B")="NO"
"RTN","DVBAREG2",118,0)
 .S DIR("?")="Answer YES or No.  You may not have two 7131s for the same admission date."
"RTN","DVBAREG2",119,0)
 .D ^DIR
"RTN","DVBAREG2",120,0)
 .K DIR
"RTN","DVBAREG2",121,0)
 .I $D(DTOUT)!($D(DUOUT))!(Y="") S DVBAQUIT=1 Q
"RTN","DVBAREG2",122,0)
 .I 'Y S DVBASTOP=1 Q
"RTN","DVBAREG2",123,0)
 .I Y DO
"RTN","DVBAREG2",124,0)
 ..S DA=+DVBAENTR
"RTN","DVBAREG2",125,0)
 ..D REOPEN^DVBAUTL2
"RTN","DVBAREG2",126,0)
 ..K DA
"RTN","DVBAREG2",127,0)
 ..Q
"RTN","DVBAREG2",128,0)
 .Q
"RTN","DVBAREG2",129,0)
 Q
"RTN","DVBAREG2",130,0)
 ;
"RTN","DVBAREG2",131,0)
ASK1 ;ask user if wish to add new 7131
"RTN","DVBAREG2",132,0)
 S DVBAASIH=$P(DVBREQDT,".",2) ;*ASIH admit? (P4,v2.7)
"RTN","DVBAREG2",133,0)
 D:$L(DVBAASIH)>6 ASIHALRT^DVBAUTL8 ;**Warn ASIH admit
"RTN","DVBAREG2",134,0)
 S VAR(1,0)="1,0,0,1,0^"
"RTN","DVBAREG2",135,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",136,0)
 K VAR
"RTN","DVBAREG2",137,0)
 S DIR("A",1)="Do you want to add a NEW 7131"
"RTN","DVBAREG2",138,0)
 S DIR("A")="for "_$P(PNAM,",",2,99)_" "_$P(PNAM,",",1,1)_" :"
"RTN","DVBAREG2",139,0)
 S DIR(0)="YAO"
"RTN","DVBAREG2",140,0)
 S DIR("B")="NO"
"RTN","DVBAREG2",141,0)
 S DIR("?")="'YES' to enter a new 7131. 'NO' to search for an existing one."
"RTN","DVBAREG2",142,0)
 D ^DIR
"RTN","DVBAREG2",143,0)
 K DIR,DVBAASIH
"RTN","DVBAREG2",144,0)
 I $D(DUOUT)!($D(DTOUT)) S DVBAQUIT=1 Q
"RTN","DVBAREG2",145,0)
 S:Y=1 DVBREQDT=+$E(DVBREQDT,1,14)
"RTN","DVBAREG2",146,0)
 I Y=0 S DVBASTOP=1 Q
"RTN","DVBAREG2",147,0)
 Q
"RTN","DVBAREG2",148,0)
 ;
"RTN","DVBAREG2",149,0)
ASK ;ask the user if wish to edit existing 7131
"RTN","DVBAREG2",150,0)
 S VAR(1,0)="1,0,0,1,0^"
"RTN","DVBAREG2",151,0)
 D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",152,0)
 K VAR
"RTN","DVBAREG2",153,0)
 S DIR("A")="Are you sure you want to edit this 7131 request: "
"RTN","DVBAREG2",154,0)
 S DIR("B")="NO"
"RTN","DVBAREG2",155,0)
 S DIR("?")="'YES' to edit the 7131 request."
"RTN","DVBAREG2",156,0)
 S DIR(0)="YAO"
"RTN","DVBAREG2",157,0)
 D ^DIR
"RTN","DVBAREG2",158,0)
 K DIR
"RTN","DVBAREG2",159,0)
 I $D(DUOUT)!($D(DTOUT)) S DVBAQUIT=1 Q
"RTN","DVBAREG2",160,0)
 I Y=0 S DVBASTOP=1 Q
"RTN","DVBAREG2",161,0)
 I Y=1 S DVBAEDT=1
"RTN","DVBAREG2",162,0)
 Q
"RTN","DVBAREG2",163,0)
 ;
"RTN","DVBAREG2",164,0)
STUFF ;enters 7131 into 7131 form file
"RTN","DVBAREG2",165,0)
 K DA,DIC("S"),DD,DO
"RTN","DVBAREG2",166,0)
 S DLAYGO=396,DIC(0)="QLM",DIC="^DVB(396,",X=+DFN
"RTN","DVBAREG2",167,0)
 D FILE^DICN
"RTN","DVBAREG2",168,0)
 I 'Y DO  S DVBASTOP=1 Q
"RTN","DVBAREG2",169,0)
 .S VAR(1,0)="1,0,0,2,0^Unable to add this new record!"
"RTN","DVBAREG2",170,0)
 .D WR^DVBAUTL4("VAR")
"RTN","DVBAREG2",171,0)
 .K VAR
"RTN","DVBAREG2",172,0)
 .Q
"RTN","DVBAREG2",173,0)
 I '$$LOCK^DVBAUTL6(Y) S DVBASTOP=1 Q
"RTN","DVBAREG2",174,0)
 S (DA,DVBAENTR)=+Y
"RTN","DVBAREG2",175,0)
 S DR="1////"_CNUM_";2////"_SSN_";3////"_DVBREQDT_";23////"_DT_";24////"_DT_";27////"_LOC_";28////"_OPER_";30////"_$S($D(ADMNUM):"A",1:"L")
"RTN","DVBAREG2",176,0)
 S DIE=DIC
"RTN","DVBAREG2",177,0)
 D ^DIE
"RTN","DVBAREG2",178,0)
 K DA,DLAYGO,DIC,DIE
"RTN","DVBAREG2",179,0)
 Q
"RTN","DVBAREG2",180,0)
 ;
"VER")
8.0^21.0
**END**
**END**
