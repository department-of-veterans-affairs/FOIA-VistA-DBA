Released RT*2*34 SEQ #32
Extracted from mail message
**KIDS**:RT*2.0*34^

**INSTALL NAME**
RT*2.0*34
"BLD",4442,0)
RT*2.0*34^RECORD TRACKING^0^3030107^y
"BLD",4442,1,0)
^^3^3^3030102^
"BLD",4442,1,1,0)
This build changes two routines to improve and correct the 
"BLD",4442,1,2,0)
'Generate Record Retirement Pull Lists' option.  
"BLD",4442,1,3,0)
See patch description for more details. 
"BLD",4442,4,0)
^9.64PA^^
"BLD",4442,"KRN",0)
^9.67PA^8989.52^19
"BLD",4442,"KRN",.4,0)
.4
"BLD",4442,"KRN",.401,0)
.401
"BLD",4442,"KRN",.402,0)
.402
"BLD",4442,"KRN",.403,0)
.403
"BLD",4442,"KRN",.5,0)
.5
"BLD",4442,"KRN",.84,0)
.84
"BLD",4442,"KRN",3.6,0)
3.6
"BLD",4442,"KRN",3.8,0)
3.8
"BLD",4442,"KRN",9.2,0)
9.2
"BLD",4442,"KRN",9.8,0)
9.8
"BLD",4442,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4442,"KRN",9.8,"NM",1,0)
RTSM8^^0^B25469637
"BLD",4442,"KRN",9.8,"NM",2,0)
RTSM1^^0^B28095202
"BLD",4442,"KRN",9.8,"NM","B","RTSM1",2)

"BLD",4442,"KRN",9.8,"NM","B","RTSM8",1)

"BLD",4442,"KRN",19,0)
19
"BLD",4442,"KRN",19.1,0)
19.1
"BLD",4442,"KRN",101,0)
101
"BLD",4442,"KRN",409.61,0)
409.61
"BLD",4442,"KRN",771,0)
771
"BLD",4442,"KRN",870,0)
870
"BLD",4442,"KRN",8989.51,0)
8989.51
"BLD",4442,"KRN",8989.52,0)
8989.52
"BLD",4442,"KRN",8994,0)
8994
"BLD",4442,"KRN","B",.4,.4)

"BLD",4442,"KRN","B",.401,.401)

"BLD",4442,"KRN","B",.402,.402)

"BLD",4442,"KRN","B",.403,.403)

"BLD",4442,"KRN","B",.5,.5)

"BLD",4442,"KRN","B",.84,.84)

"BLD",4442,"KRN","B",3.6,3.6)

"BLD",4442,"KRN","B",3.8,3.8)

"BLD",4442,"KRN","B",9.2,9.2)

"BLD",4442,"KRN","B",9.8,9.8)

"BLD",4442,"KRN","B",19,19)

"BLD",4442,"KRN","B",19.1,19.1)

"BLD",4442,"KRN","B",101,101)

"BLD",4442,"KRN","B",409.61,409.61)

"BLD",4442,"KRN","B",771,771)

"BLD",4442,"KRN","B",870,870)

"BLD",4442,"KRN","B",8989.51,8989.51)

"BLD",4442,"KRN","B",8989.52,8989.52)

"BLD",4442,"KRN","B",8994,8994)

"BLD",4442,"QUES",0)
^9.62^^
"BLD",4442,"REQB",0)
^9.611^1^1
"BLD",4442,"REQB",1,0)
RT*2.0*30^1
"BLD",4442,"REQB","B","RT*2.0*30",1)

"MBREQ")
0
"PKG",72,-1)
1^1
"PKG",72,0)
RECORD TRACKING^RT^Medical Records and Film Jacket Tracking
"PKG",72,20,0)
^9.402P^^
"PKG",72,22,0)
^9.49I^1^1
"PKG",72,22,1,0)
2.0^2911022
"PKG",72,22,1,"PAH",1,0)
34^3030107
"PKG",72,22,1,"PAH",1,1,0)
^^3^3^3030107
"PKG",72,22,1,"PAH",1,1,1,0)
This build changes two routines to improve and correct the 
"PKG",72,22,1,"PAH",1,1,2,0)
'Generate Record Retirement Pull Lists' option.  
"PKG",72,22,1,"PAH",1,1,3,0)
See patch description for more details. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RTSM1")
0^2^B28095202
"RTN","RTSM1",1,0)
RTSM1 ;TROY ISC/MJK,PKE-Record File Initialization Utility ; 5/21/87  4:06 PM ; 1/7/03 11:51am
"RTN","RTSM1",2,0)
 ;;2.0;Record Tracking;**4,14,34**;10/22/91
"RTN","RTSM1",3,0)
RTTY ;
"RTN","RTSM1",4,0)
 F RTHOLD=0:0 S RTHOLD=+$O(RTHOLD(RTHOLD)) Q:'RTHOLD  S RTTY=RTHOLD(RTHOLD) S RT=+$O(^RT("AT",+RTTY,RTE,0)) D CREATE:'RT,LBL:RTION]""
"RTN","RTSM1",5,0)
 S RTCNTP=RTCNTP+1 I '(RTCNTP#50) H $S(RTION="":0,1:$S($D(^DIC(195.4,1,"COOL")):^("COOL"),1:0))*60 I '(RTCNTP#100) W !,RTCNTP," patients processed. " D NOW^%DTC S Y=$E(%,1,12) D DT^DIQ
"RTN","RTSM1",6,0)
 K RT,RTTY Q
"RTN","RTSM1",7,0)
 ;
"RTN","RTSM1",8,0)
CREATE ;
"RTN","RTSM1",9,0)
 D CREATE^RTDPA1 S:RT RTCNTR=RTCNTR+1 Q
"RTN","RTSM1",10,0)
 ;
"RTN","RTSM1",11,0)
LBL ;
"RTN","RTSM1",12,0)
 H 8 S RTFMT=+$P(RTTY,"^",5) I $D(^DIC(194.4,RTFMT,0)) S IOP=RTION D ^%ZIS K IOP S RTNUM=1,RTIFN=RT U IO D PRT^RTL1 S RTCNTL=RTCNTL+1 Q
"RTN","RTSM1",13,0)
 ;
"RTN","RTSM1",14,0)
LOAD ;Entry load record from DPT
"RTN","RTSM1",15,0)
 ;MUST:
"RTN","RTSM1",16,0)
 ; RTAPL
"RTN","RTSM1",17,0)
 ; RTMES
"RTN","RTSM1",18,0)
 ; RTLOAD
"RTN","RTSM1",19,0)
 ; RTDIV
"RTN","RTSM1",20,0)
 ; RADPT
"RTN","RTSM1",21,0)
 ;
"RTN","RTSM1",22,0)
 ;optional:
"RTN","RTSM1",23,0)
 ; RTION  -  'name' of printer to labels on (null for no labels)
"RTN","RTSM1",24,0)
 ; RTERM  -  list of terminal digits or 'NAME'
"RTN","RTSM1",25,0)
 ;
"RTN","RTSM1",26,0)
 D SEL^RTSM2 G Q:'$D(RTHOLD) S RTVAR="RADPT^RTDIV^RTMES1^RTLOAD^RTHOLD^RTAPL"_$S($D(RTION):"^RTION",1:"")_$S($D(RTERM):"^RTERM",1:"")_$S($D(RTSTART):"^RTSTART",1:""),RTPGM="START^RTSM1" D ZIS^RTUTL G Q:POP
"RTN","RTSM1",27,0)
START K ^TMP($J),RTSHOW,RTADM S (RTCNTR,RTCNTP,RTCNTL)=0,RTBKGRD="" D HOLD S:'$D(RTION) RTION=""
"RTN","RTSM1",28,0)
 I $D(RTERM),RTERM'="NAME" F I=1:1 Q:$P(RTERM,"^",I)=""  S RTERM($P(RTERM,"^",I))=""
"RTN","RTSM1",29,0)
 W @IOF,!,RTMES1,!!?5,"START TIME: " D NOW^%DTC S Y=$E(%,1,12) D DT^DIQ W !!,"Log",!,"---" D @RTLOAD
"RTN","RTSM1",30,0)
 W !,"[TOTAL PATIENTS PROCESSED       : ",RTCNTP,"]"
"RTN","RTSM1",31,0)
 W !,"[TOTAL NUMBER OF RECORDS CREATED: ",RTCNTR,"]"
"RTN","RTSM1",32,0)
 W !,"[TOTAL RECORD LABELS CREATED    : ",RTCNTL,"]"
"RTN","RTSM1",33,0)
 W !!?5,"STOP TIME: " D NOW^%DTC S Y=$E(%,1,12) D DT^DIQ W !
"RTN","RTSM1",34,0)
 I RTION]"" S IOP=RTION D ^%ZIS K IOP U IO W !
"RTN","RTSM1",35,0)
Q K ^TMP($J),RTERM,RADPT,RTHOLD,RTION,RTMES1,RTLOAD,RTN,RTHOLD,RTBKGRD,RTCNTP,RTCNTL,RTCNTR,RTTY D CLOSE^RTUTL
"RTN","RTSM1",36,0)
 K DA,D0,DIC,DIE,DR,I,I1,RTE,RTPGM,RTVAR,RTBC,RTJ,RTPGM,RTXX,X1,Y Q
"RTN","RTSM1",37,0)
HOLD F I1=1:1 Q:'$P(RTHOLD,"^",I1)  S Y=$P(RTHOLD,"^",I1) D TYPE1^RTUTL S:$D(RTTY) RTHOLD(Y)=RTTY
"RTN","RTSM1",38,0)
 K I1,RTTY Q
"RTN","RTSM1",39,0)
 ;
"RTN","RTSM1",40,0)
 ;
"RTN","RTSM1",41,0)
SORT D NOW^%DTC S $P(^RTV(194.3,1,0),"^",2,3)=%_"^"
"RTN","RTSM1",42,0)
 S (DFN,LDFN)=$S($D(^RTV(194.3,1,1,0)):+$P(^(0),"^",3),1:0)
"RTN","RTSM1",43,0)
 ;just set it the first time
"RTN","RTSM1",44,0)
 I 'DFN D ONETIM^RTSM4,QS Q
"RTN","RTSM1",45,0)
 ;check for new records
"RTN","RTSM1",46,0)
 F  S DFN=$O(^DPT(DFN)) Q:'DFN  DO
"RTN","RTSM1",47,0)
 .S LDFN=DFN
"RTN","RTSM1",48,0)
 .I '$D(^RTV(194.3,1,1,DFN,0)) D FILE W:'$D(ZTQUEUED) "." Q
"RTN","RTSM1",49,0)
 ;verify/update old records
"RTN","RTSM1",50,0)
 S (RTCT,TD)=0 F  S TD=$O(^RTV(194.3,1,1,"AC",TD)) Q:TD=""  DO
"RTN","RTSM1",51,0)
 .S DFN=0 F  S DFN=$O(^RTV(194.3,1,1,"AC",TD,DFN)) Q:'DFN  DO
"RTN","RTSM1",52,0)
 . .I '$D(^DPT(DFN,0)) K ^RTV(194.3,1,1,"AC",TD,DFN) S DA(1)=1,DA=DFN,DIK="^RTV(194.3,1,1," D ^DIK K DE,DQ Q
"RTN","RTSM1",53,0)
 . .S SSN=$P(^DPT(DFN,0),"^",9),RTCT=RTCT+1
"RTN","RTSM1",54,0)
 . .I '$D(ZTQUEUED),DFN#1000=0 W ","
"RTN","RTSM1",55,0)
 . .I TD'=($E(SSN,8,9)_$E(SSN,6,7)_$E(SSN,1,5)) DO
"RTN","RTSM1",56,0)
 . . .;get rid of old xref and entry
"RTN","RTSM1",57,0)
 . . .K ^RTV(194.3,1,1,"AC",TD,DFN)
"RTN","RTSM1",58,0)
 . . .S DA(1)=1,DA=DFN,DIK="^RTV(194.3,1,1," D ^DIK K DE,DQ
"RTN","RTSM1",59,0)
 . . .;update new one
"RTN","RTSM1",60,0)
 . . .D FILE Q
"RTN","RTSM1",61,0)
QS ;update for next time
"RTN","RTSM1",62,0)
 D NOW^%DTC S $P(^RTV(194.3,1,0),"^",3)=%
"RTN","RTSM1",63,0)
 S $P(^RTV(194.3,1,1,0),"^",3,4)=LDFN_"^"_RTCT
"RTN","RTSM1",64,0)
 K RTCT,LDFN,TD,DFN,SSN,DA,DIC,DIK,DR Q
"RTN","RTSM1",65,0)
 ;
"RTN","RTSM1",66,0)
FILE I '$D(^RTV(194.3,1,1,0)) S ^(0)="^194.31PA^0^0"
"RTN","RTSM1",67,0)
 S DIC="^RTV(194.3,1,1,",DIC(0)="L",DIC("DR")="1///`"_DFN
"RTN","RTSM1",68,0)
 K DD,DO S (X,DINUM)=DFN D FILE^DICN Q
"RTN","RTSM1",69,0)
 ;
"RTN","RTSM1",70,0)
12 ;;Create Terminal Digit Sort Global
"RTN","RTSM1",71,0)
 W !!,"RECORD TRACKING SORT GLOBAL Compilation" S Y=""
"RTN","RTSM1",72,0)
 I $D(^RTV(194.3,1,0)),$P(^(0),"^",2),$P(^(0),"^",3) DO
"RTN","RTSM1",73,0)
 .W !!,*7,"The SORT global already exists.",!?11,"Compilation started: "
"RTN","RTSM1",74,0)
 .S Y1=$P(^(0),"^",2,3),Y=$P(Y1,"^") D DT^DIQ ;naked rtv(194.3,1,0)
"RTN","RTSM1",75,0)
 .I $S('$D(^RTV(194.3,1,1,0)):1,'$P(^(0),"^",3):1,1:0) Q
"RTN","RTSM1",76,0)
 .W !?8,"Last patient processed: ",$P(^(0),"^",3) ;nakd rtv(194.3,1,1,0
"RTN","RTSM1",77,0)
 .W !?8,"  Compilation finished: "
"RTN","RTSM1",78,0)
 .S Y=$P(Y1,"^",2) D DT^DIQ
"RTN","RTSM1",79,0)
 .K Y
"RTN","RTSM1",80,0)
 S RTRD(1)="Yes^queue job",RTRD(2)="No^not queue job",RTRD(0)="S",RTRD("B")=2,RTRD("A")="Do you wish to queue a job that will "_$S('$D(Y):"Update-",1:"")_"compile this global? " D SET^RTRD K RTRD G Q12:$E(X)'="Y"
"RTN","RTSM1",81,0)
 S RTVAR="",(ION,IOM,IOST)="",RTPGM="SORT^RTSM1" D Q^RTUTL K RTVAR,RTPGM S IOP="" D ^%ZIS
"RTN","RTSM1",82,0)
 ;
"RTN","RTSM1",83,0)
Q12 K IOP,X1,Y,RTVAR,RTPGM,X,X1,Y1 Q
"RTN","RTSM1",84,0)
 ;
"RTN","RTSM1",85,0)
13 ;;Delete Terminal Digit Sort Global
"RTN","RTSM1",86,0)
 W !,"It is not usually necessary to delete this global, just compile it"
"RTN","RTSM1",87,0)
 S RTRD(0)="S",RTRD(1)="Yes^delete global",RTRD(2)="No^keep global",RTRD("A")="Are you sure you want to delete the RT SORT GLOBAL entries? ",RTRD("B")=2 D SET^RTRD K RTRD
"RTN","RTSM1",88,0)
 I $E(X)="Y" DO
"RTN","RTSM1",89,0)
 .K ^RTV(194.3,1,1)
"RTN","RTSM1",90,0)
 .;reset nodes
"RTN","RTSM1",91,0)
 .S ^RTV(194.3,1,0)="TERMINAL DIGITS^^"
"RTN","RTSM1",92,0)
 .S ^RTV(194.3,1,1,0)="^194.31PA^^"
"RTN","RTSM1",93,0)
 .W !?3,"...deleted"
"RTN","RTSM1",94,0)
 K Y,X,X1 Q
"RTN","RTSM1",95,0)
 ;
"RTN","RTSM1",96,0)
 ;set logic 194.3 ac xref
"RTN","RTSM1",97,0)
S1943 I $D(^DPT(X,0)) S SSN=$P(^(0),"^",9),DOB=$P(^(0),"^",3) I SSN,DOB DO
"RTN","RTSM1",98,0)
 .S DVBDIS=$O(^DPT(X,"DIS",0)) I 'DVBDIS
"RTN","RTSM1",99,0)
 .E  S DVBDIS=$S('$D(^(DVBDIS,0)):"",1:$P(^(0),"^",4)) ;nakd dpt(x,dis,0)
"RTN","RTSM1",100,0)
 .S ^RTV(194.3,1,1,"AC",$E(SSN,8,9)_$E(SSN,6,7)_$E(SSN,1,5),X)=DVBDIS
"RTN","RTSM1",101,0)
 K SSN,DOB,DVBDIS Q
"RTN","RTSM1",102,0)
 ;
"RTN","RTSM1",103,0)
 ;kill logic 194.3 ac xref
"RTN","RTSM1",104,0)
K1943 I $D(^DPT(X,0)) S SSN=$P(^(0),"^",9),DOB=$P(^(0),"^",3) I SSN,DOB DO
"RTN","RTSM1",105,0)
 .K ^RTV(194.3,1,1,"AC",$E(SSN,8,9)_$E(SSN,6,7)_$E(SSN,1,5),X)
"RTN","RTSM1",106,0)
 K SSN,DOB Q
"RTN","RTSM8")
0^1^B25469637
"RTN","RTSM8",1,0)
RTSM8 ;isc-albany/pke-check records for retirement ; 10/1/90 ; 1/7/03 11:51am
"RTN","RTSM8",2,0)
 ;;2.0;Record Tracking;**4,14,30,34**;10/22/91
"RTN","RTSM8",3,0)
 D ASK^RTSM81 I '$D(RTERM) D Q10 Q
"RTN","RTSM8",4,0)
 I RTERM="NO" D GO,Q10 Q
"RTN","RTSM8",5,0)
 ; file 194.3 only needed if user chooses to do a terminal digit scan
"RTN","RTSM8",6,0)
 I $D(^RTV(194.3,1,0)),($E($P(^(0),"^",3),1,3))'=($E(DT,1,3)) DO  Q
"RTN","RTSM8",7,0)
 .W !!,*7,"The RECORD TRACKING SORT GLOBAL file(#194.3) "
"RTN","RTSM8",8,0)
 .I '$P(^(0),"^",2),'$P(^(0),"^",3) W "needs to be compiled"
"RTN","RTSM8",9,0)
 .;naked ref rtv(194.3,1,0)
"RTN","RTSM8",10,0)
 .E  I $E($P(^(0),U,2),1,7)=$E(DT,1,7),'$P(^(0),"^",3) W "is currently being compiled" D Q10 Q
"RTN","RTSM8",11,0)
 .E  W "needs additional compiling"
"RTN","RTSM8",12,0)
 .D CHKQ^RTSM4,Q10
"RTN","RTSM8",13,0)
 ;
"RTN","RTSM8",14,0)
 K DIR W !
"RTN","RTSM8",15,0)
 ;S DIR("A")="Select a Terminal Digit or range",DIR("B")="1"
"RTN","RTSM8",16,0)
 S DIR("A",1)="Select a Terminal Digit or range.  Although a maximum"
"RTN","RTSM8",17,0)
 S DIR("A")="of 50 is allowed, we recommend a maximum of 10"
"RTN","RTSM8",18,0)
 S DIR("B")="1"
"RTN","RTSM8",19,0)
 S DIR("?")="Enter a single terminal digit or a range, maximum 50, "
"RTN","RTSM8",20,0)
 S DIR("??")="^D H1^RTSM81"
"RTN","RTSM8",21,0)
 S DASH="-",COM=""",""",DAS="""-"""
"RTN","RTSM8",22,0)
 S IF="K:X["_COM_" X I $D(X),X["_DAS_",$P(X,DASH,2)-$P(X,DASH,1)>49 K X"
"RTN","RTSM8",23,0)
 S DIR(0)="L^0:99"
"RTN","RTSM8",24,0)
 S DIR(0)=DIR(0)_"^"_IF
"RTN","RTSM8",25,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) D Q10 Q
"RTN","RTSM8",26,0)
 F I=1:1 Q:'$L($P(Y,",",I))  I $L($P(Y,",",I))=1 S $P(Y,",",I)="0"_$P(Y,",",I)
"RTN","RTSM8",27,0)
 S RTERM=Y K X,Y
"RTN","RTSM8",28,0)
GO W !!
"RTN","RTSM8",29,0)
 S RTDESC="Record Retirement Pull List(s) ["_$P($P(RTAPL,"^"),";",2)_"]",RTVAR="RTDESC^RTERM^RTAPL^RTFR",RTPGM="START^RTSM8" S IOP="HOME" D ^%ZIS K IOP D ZIS^RTUTL
"RTN","RTSM8",30,0)
 I POP D Q10 Q
"RTN","RTSM8",31,0)
 W !!
"RTN","RTSM8",32,0)
START S (RTAA,RTA)=+RTAPL,RTB=+RTFR,RTLAST=$P(^RT(0),"^",3)
"RTN","RTSM8",33,0)
 ;check if mas or rad
"RTN","RTSM8",34,0)
 S RTDPT=1 I RTA'=+^DIC(195.4,1,"MAS"),RTA'=+^("RAD") S RTDPT=0
"RTN","RTSM8",35,0)
 D FLAG^RTSM81
"RTN","RTSM8",36,0)
 S (RTCOUNT,RTHIT)=0 S CR=$C(13,10),MOD=100 I $E(IOST,1,2)="C-" S CR=$C(13),MOD=10
"RTN","RTSM8",37,0)
 K RTR I RTERM="NO" S RTDPT=0 F RTR=0:0 S RTR=$O(^RT(RTR)) Q:'RTR  I $D(^(RTR,0)) S RTEE=$P(^(0),"^") D RCHECK
"RTN","RTSM8",38,0)
 I $D(RTR) D Q10 Q
"RTN","RTSM8",39,0)
 ;F RTRM0=1:1 S RTRM=$P(RTERM,",",RTRM0) Q:RTRM=""  S RTTD=$S($D(RTSTART):RTSTART,1:RTRM_"0000000") K RTSTART F RTRM1=0:0 S RTTD=$O(^UTILITY("RTDPTSORT",RTTD)) Q:$E(RTTD,1,2)'=RTRM!(RTTD="")  S DFN=+$O(^(RTTD,0)) I DFN D TDCHECK
"RTN","RTSM8",40,0)
 ;
"RTN","RTSM8",41,0)
 F RTRM0=1:1 S RTRM=$P(RTERM,",",RTRM0) Q:RTRM=""  DO
"RTN","RTSM8",42,0)
 .S RTTD=$S($D(RTSTART):RTSTART,1:RTRM_"0000000") K RTSTART
"RTN","RTSM8",43,0)
 .S RTRM1=0
"RTN","RTSM8",44,0)
 .FOR  S RTTD=$O(^RTV(194.3,1,1,"AC",RTTD)) Q:$E(RTTD,1,2)'=RTRM!(RTTD="")  DO
"RTN","RTSM8",45,0)
 . .S DFN=0
"RTN","RTSM8",46,0)
 . .F  S DFN=$O(^RTV(194.3,1,1,"AC",RTTD,DFN)) Q:'DFN  D TDCHECK
"RTN","RTSM8",47,0)
 ;
"RTN","RTSM8",48,0)
 K RTRM0,RTRM1,RTNME,RTNME0,RTRM,RTTD,DFN,RTFLAG,RTWND D Q10 Q
"RTN","RTSM8",49,0)
 ;
"RTN","RTSM8",50,0)
TDCHECK S RTEE=DFN_";DPT(" K RTPHIST
"RTN","RTSM8",51,0)
RCHECK I $D(^RT("AA",RTAA,RTEE)) F RTT=0:0 S RTT=$O(^RT("AA",RTAA,RTEE,RTT)) Q:'RTT  D REC
"RTN","RTSM8",52,0)
 Q
"RTN","RTSM8",53,0)
REC I 'RTCOUNT D HDR^RTSM81
"RTN","RTSM8",54,0)
 I RTCOUNT#MOD=0 W CR_$J(RTCOUNT,10)_" Records Checked  ",$J(RTHIT,6)," Inactive Records   ",$S(RTERM'="NO":$J(RTRM,5)_"  tdigits",1:$J(RTR,8)_"  rec #")
"RTN","RTSM8",55,0)
 S RTCOUNT=RTCOUNT+1
"RTN","RTSM8",56,0)
 I RTDPT,$D(RTPHIST(1)) Q
"RTN","RTSM8",57,0)
 I $D(^RT("AR","t",RTT)) Q
"RTN","RTSM8",58,0)
 I $D(^RT("AR","r",RTT)) Q
"RTN","RTSM8",59,0)
 Q:'$D(^RT(RTT,0))  Q:'$D(^("CL"))  S RT0=^(0),RTCL=^("CL")
"RTN","RTSM8",60,0)
 Q:$P(RT0,"^",4)'=+RTAPL
"RTN","RTSM8",61,0)
 ; type of record, date/time charged, ok to retire
"RTN","RTSM8",62,0)
 S RTI=$P(RT0,"^",3) I $S('$D(RTFLAG(RTI)):1,'RTFLAG(RTI):1,1:0) Q
"RTN","RTSM8",63,0)
 S RTDT=$P(RTCL,"^",6)
"RTN","RTSM8",64,0)
 ;naked ref to ^rt(rtt,i) tag rec+6
"RTN","RTSM8",65,0)
 I $D(^("I")),^("I") Q
"RTN","RTSM8",66,0)
 ;
"RTN","RTSM8",67,0)
 I RTDPT,'$D(RTPHIST) D DPTCHK S RTPHIST($T)="" I $T Q
"RTN","RTSM8",68,0)
 ;
"RTN","RTSM8",69,0)
 ;only if not mas,rad
"RTN","RTSM8",70,0)
 I 'RTDPT,RTDT,RTDT'<RTFLAG(RTI) Q
"RTN","RTSM8",71,0)
 ;
"RTN","RTSM8",72,0)
 ;creat list by current location, home location, unknown
"RTN","RTSM8",73,0)
 S RTP=$P(RTCL,"^",5) I 'RTP S RTP=$P(RT0,"^",6) I 'RTP S (Y,RTP)="LOCATION UNKNOWN" IF 1
"RTN","RTSM8",74,0)
 E  S Y=RTP D BOR^RTB I Y="UNKNOWN" S Y="LOCATION"_Y
"RTN","RTSM8",75,0)
 S Y="RR "_Y
"RTN","RTSM8",76,0)
 ;
"RTN","RTSM8",77,0)
 ;
"RTN","RTSM8",78,0)
 K RTP
"RTN","RTSM8",79,0)
 S RTHIT=RTHIT+1
"RTN","RTSM8",80,0)
 S RTB=+RTFR,RT=RTT
"RTN","RTSM8",81,0)
 ;have RTTM, Y
"RTN","RTSM8",82,0)
 S RTE=RTEE
"RTN","RTSM8",83,0)
 S RTPLTY=3,(RTQDT,X)=RTTM,RTPN=$P(Y,"^")_" ["_$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)_"]"
"RTN","RTSM8",84,0)
 ;
"RTN","RTSM8",85,0)
PUL S X=RTB,A=+RTAA K RTA,RTSD,RTDIV D INST1^RTUTL G Q10:'$D(RTINST) S RTDIV=RTINST
"RTN","RTSM8",86,0)
 D RTSD
"RTN","RTSM8",87,0)
 K RTBKGRD Q
"RTN","RTSM8",88,0)
 ;
"RTN","RTSM8",89,0)
RTSD K RTPAR S RTB=$P(^RTV(195.9,RTB,0),"^"),RTA=+RTAA D CHK K RTA,RTQ D PULL^RTQ2,CHK1 I '$D(RTPAR),$D(RTQ) S RTPAR=RTQ
"RTN","RTSM8",90,0)
 Q
"RTN","RTSM8",91,0)
CHK S Y=+$O(^RTV(195.9,"ABOR",RTB,RTA,0)) D SET^RTDPA3:'Y S RTB=Y Q
"RTN","RTSM8",92,0)
 ;
"RTN","RTSM8",93,0)
CHK1 ;
"RTN","RTSM8",94,0)
 ; RT*1*34 - this shortcut uses "AC" xref instead of "C"
"RTN","RTSM8",95,0)
 S R=0
"RTN","RTSM8",96,0)
 I $D(^RTV(190.1,"AC",RT,RTTM)) F R=0:0 S R=$O(^RTV(190.1,"AC",RT,RTTM,R)) Q:'R  I $D(^RTV(190.1,"ABOR",RTB,R)),$D(^RTV(190.1,R,0)) S Q0=^(0) I $P(Q0,U)=RT,$P(Q0,U,4)=RTTM,$P(Q0,U,5)=RTB,$P(Q0,U,10)=RTPULL Q
"RTN","RTSM8",97,0)
 I 'R D SET^RTQ
"RTN","RTSM8",98,0)
 ;F R=0:0 S R=$O(^RTV(190.1,"C",RTTM,R)) Q:'R  D INFO I $D(^RTV(190.1,"ABOR",RTB,R)),$D(^RTV(190.1,R,0)) S Q0=^(0) I $P(Q0,"^")=RT,$P(Q0,"^",4)=RTTM,$P(Q0,"^",5)=RTB,$P(Q0,"^",10)=RTPULL Q
"RTN","RTSM8",99,0)
 ;I 'R D SET^RTQ
"RTN","RTSM8",100,0)
 Q
"RTN","RTSM8",101,0)
INFO ;I R#100=0,'$D(ZTSK) W "."
"RTN","RTSM8",102,0)
 Q
"RTN","RTSM8",103,0)
Q10 K RTLSTM,RADPT,RTLOAD,RTMES1,RTERM,DIC,DIE,DR,DA,DAS,DASH,IF,DIR,COM,J,Z
"RTN","RTSM8",104,0)
 K RTCOUNT,RTHIT,RTLAST,R,RT0,RTAA,RTINST,RTPGM,RTVAR,CR,MOD,RTPHIST
"RTN","RTSM8",105,0)
 K Q0,RTDPT,RT,RTB,RTCL,RTDT,RTE,RTEE,RTERM,RTERM0,RTI,RTLOAD,RTPAR,RTPLTY,RTPN,RTPULL,RTQ,RTQDT,RTRM,RTRM0,RTT,RTTD,RTTM,RTTMM,RTWND,RTXX D CLOSE^RTUTL
"RTN","RTSM8",106,0)
 Q
"RTN","RTSM8",107,0)
DPTCHK ;returns $t=1 if dhcp activity
"RTN","RTSM8",108,0)
 S RTPHIST=1
"RTN","RTSM8",109,0)
FILED I $D(^DPT(DFN,0)),$P(^(0),"^",16)>RTFLAG(RTI) Q
"RTN","RTSM8",110,0)
 ;
"RTN","RTSM8",111,0)
INPAT I $D(^DPT(DFN,.1)),$P(^(.1),"^")]"" Q
"RTN","RTSM8",112,0)
 ;
"RTN","RTSM8",113,0)
SC I $O(^DPT(DFN,"S",RTFLAG(RTI))) Q
"RTN","RTSM8",114,0)
 ;
"RTN","RTSM8",115,0)
SDV ;
"RTN","RTSM8",116,0)
 N RTZERR I $$EXAE^SDOE(DFN,RTFLAG(RTI)\1+1,9999999,,"RTZERR") Q  ;Standalone encounter exists
"RTN","RTSM8",117,0)
 ;
"RTN","RTSM8",118,0)
DIS I $O(^DPT(DFN,"DIS",0)),$O(^(0))<(9999999-RTFLAG(RTI)) Q
"RTN","RTSM8",119,0)
 ;
"RTN","RTSM8",120,0)
MOV I $O(^DGPM("APID",DFN,0)),$O(^(0))<(9999999-RTFLAG(RTI)) Q
"RTN","RTSM8",121,0)
 ;
"RTN","RTSM8",122,0)
 S RTPHIST=0
"RTN","RTSM8",123,0)
 Q
"VER")
8.0^22
**END**
**END**
