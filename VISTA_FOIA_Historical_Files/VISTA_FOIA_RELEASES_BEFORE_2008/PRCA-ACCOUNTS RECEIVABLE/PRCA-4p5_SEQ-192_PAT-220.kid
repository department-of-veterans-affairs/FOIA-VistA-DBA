EMERGENCY Released PRCA*4.5*220 SEQ #192
Extracted from mail message
**KIDS**:PRCA*4.5*220^

**INSTALL NAME**
PRCA*4.5*220
"BLD",5632,0)
PRCA*4.5*220^ACCOUNTS RECEIVABLE^0^3040916^y
"BLD",5632,1,0)
^^3^3^3040817^^^^
"BLD",5632,1,1,0)
This patch implements new point accounts 528705-528709 and 528710
"BLD",5632,1,2,0)
It also changes point accounts 5287.1 to 528701,  5287.3 to 528704 and
"BLD",5632,1,3,0)
5287.4 to 528704.
"BLD",5632,4,0)
^9.64PA^347.4^2
"BLD",5632,4,347.4,0)
347.4
"BLD",5632,4,347.4,222)
y^n^f^^n^^y^o^n
"BLD",5632,4,347.4,224)

"BLD",5632,4,430,0)
430
"BLD",5632,4,430,2,0)
^9.641^430^1
"BLD",5632,4,430,2,430,0)
ACCOUNTS RECEIVABLE  (File-top level)
"BLD",5632,4,430,2,430,1,0)
^9.6411^2^1
"BLD",5632,4,430,2,430,1,2,0)
CATEGORY
"BLD",5632,4,430,222)
y^n^p^^^^n^^n
"BLD",5632,4,430,224)

"BLD",5632,4,"APDD",430,430)

"BLD",5632,4,"APDD",430,430,2)

"BLD",5632,4,"B",347.4,347.4)

"BLD",5632,4,"B",430,430)

"BLD",5632,"ABPKG")
n
"BLD",5632,"INIT")
RCY220PT
"BLD",5632,"KRN",0)
^9.67PA^8989.52^19
"BLD",5632,"KRN",.4,0)
.4
"BLD",5632,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5632,"KRN",.401,0)
.401
"BLD",5632,"KRN",.401,"NM",0)
^9.68A^^
"BLD",5632,"KRN",.402,0)
.402
"BLD",5632,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",5632,"KRN",.402,"NM",1,0)
PRCA BILL 1114    FILE #430^430^0
"BLD",5632,"KRN",.402,"NM","B","PRCA BILL 1114    FILE #430",1)

"BLD",5632,"KRN",.403,0)
.403
"BLD",5632,"KRN",.403,"NM",0)
^9.68A^^
"BLD",5632,"KRN",.5,0)
.5
"BLD",5632,"KRN",.5,"NM",0)
^9.68A^^
"BLD",5632,"KRN",.84,0)
.84
"BLD",5632,"KRN",.84,"NM",0)
^9.68A^^
"BLD",5632,"KRN",3.6,0)
3.6
"BLD",5632,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",5632,"KRN",3.8,0)
3.8
"BLD",5632,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",5632,"KRN",9.2,0)
9.2
"BLD",5632,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",5632,"KRN",9.8,0)
9.8
"BLD",5632,"KRN",9.8,"NM",0)
^9.68A^29^28
"BLD",5632,"KRN",9.8,"NM",1,0)
PRCAACC^^0^B8809868
"BLD",5632,"KRN",9.8,"NM",2,0)
PRCAFBD^^0^B14761899
"BLD",5632,"KRN",9.8,"NM",3,0)
PRCAFBDM^^0^B5442375
"BLD",5632,"KRN",9.8,"NM",4,0)
RCFMOBR1^^0^B20315878
"BLD",5632,"KRN",9.8,"NM",5,0)
RCNRIG^^0^B10660569
"BLD",5632,"KRN",9.8,"NM",6,0)
RCRJRBD^^0^B43337431
"BLD",5632,"KRN",9.8,"NM",7,0)
RCRJRBDR^^0^B60833292
"BLD",5632,"KRN",9.8,"NM",8,0)
RCDPE215^^0^B81963105
"BLD",5632,"KRN",9.8,"NM",9,0)
RCXFMSUF^^0^B31971051
"BLD",5632,"KRN",9.8,"NM",10,0)
PRCABIL1^^0^B25254789
"BLD",5632,"KRN",9.8,"NM",11,0)
PRCAFUT^^0^B30486823
"BLD",5632,"KRN",9.8,"NM",12,0)
RCXFMSUV^^0^B13868854
"BLD",5632,"KRN",9.8,"NM",13,0)
RCRJRCOC^^0^B45922458
"BLD",5632,"KRN",9.8,"NM",14,0)
RCRJRDEP^^0^B57461822
"BLD",5632,"KRN",9.8,"NM",15,0)
RCXFMSUR^^0^B46524145
"BLD",5632,"KRN",9.8,"NM",16,0)
RCRJROIG^^0^B25548246
"BLD",5632,"KRN",9.8,"NM",17,0)
RCXFMSC1^^0^B18818760
"BLD",5632,"KRN",9.8,"NM",18,0)
RCXFMSSV^^0^B50204707
"BLD",5632,"KRN",9.8,"NM",19,0)
RCXFMSWR^^0^B16957228
"BLD",5632,"KRN",9.8,"NM",20,0)
PRCARFD1^^0^B32136965
"BLD",5632,"KRN",9.8,"NM",21,0)
RCDPEM0^^0^B51750344
"BLD",5632,"KRN",9.8,"NM",22,0)
RCDPR215^^0^B37063304
"BLD",5632,"KRN",9.8,"NM",23,0)
RCXFMSCR^^0^B30302110
"BLD",5632,"KRN",9.8,"NM",25,0)
PRCABJV^^0^B29300227
"BLD",5632,"KRN",9.8,"NM",26,0)
RCDPRPLM^^0^B82221734
"BLD",5632,"KRN",9.8,"NM",27,0)
RCXFMST1^^0^B39141139
"BLD",5632,"KRN",9.8,"NM",28,0)
RCY220PT^^0^B9597719
"BLD",5632,"KRN",9.8,"NM",29,0)
RCRJRCOR^^0^B61213229
"BLD",5632,"KRN",9.8,"NM","B","PRCAACC",1)

"BLD",5632,"KRN",9.8,"NM","B","PRCABIL1",10)

"BLD",5632,"KRN",9.8,"NM","B","PRCABJV",25)

"BLD",5632,"KRN",9.8,"NM","B","PRCAFBD",2)

"BLD",5632,"KRN",9.8,"NM","B","PRCAFBDM",3)

"BLD",5632,"KRN",9.8,"NM","B","PRCAFUT",11)

"BLD",5632,"KRN",9.8,"NM","B","PRCARFD1",20)

"BLD",5632,"KRN",9.8,"NM","B","RCDPE215",8)

"BLD",5632,"KRN",9.8,"NM","B","RCDPEM0",21)

"BLD",5632,"KRN",9.8,"NM","B","RCDPR215",22)

"BLD",5632,"KRN",9.8,"NM","B","RCDPRPLM",26)

"BLD",5632,"KRN",9.8,"NM","B","RCFMOBR1",4)

"BLD",5632,"KRN",9.8,"NM","B","RCNRIG",5)

"BLD",5632,"KRN",9.8,"NM","B","RCRJRBD",6)

"BLD",5632,"KRN",9.8,"NM","B","RCRJRBDR",7)

"BLD",5632,"KRN",9.8,"NM","B","RCRJRCOC",13)

"BLD",5632,"KRN",9.8,"NM","B","RCRJRCOR",29)

"BLD",5632,"KRN",9.8,"NM","B","RCRJRDEP",14)

"BLD",5632,"KRN",9.8,"NM","B","RCRJROIG",16)

"BLD",5632,"KRN",9.8,"NM","B","RCXFMSC1",17)

"BLD",5632,"KRN",9.8,"NM","B","RCXFMSCR",23)

"BLD",5632,"KRN",9.8,"NM","B","RCXFMSSV",18)

"BLD",5632,"KRN",9.8,"NM","B","RCXFMST1",27)

"BLD",5632,"KRN",9.8,"NM","B","RCXFMSUF",9)

"BLD",5632,"KRN",9.8,"NM","B","RCXFMSUR",15)

"BLD",5632,"KRN",9.8,"NM","B","RCXFMSUV",12)

"BLD",5632,"KRN",9.8,"NM","B","RCXFMSWR",19)

"BLD",5632,"KRN",9.8,"NM","B","RCY220PT",28)

"BLD",5632,"KRN",19,0)
19
"BLD",5632,"KRN",19,"NM",0)
^9.68A^^
"BLD",5632,"KRN",19.1,0)
19.1
"BLD",5632,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5632,"KRN",101,0)
101
"BLD",5632,"KRN",101,"NM",0)
^9.68A^^
"BLD",5632,"KRN",409.61,0)
409.61
"BLD",5632,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",5632,"KRN",771,0)
771
"BLD",5632,"KRN",771,"NM",0)
^9.68A^^
"BLD",5632,"KRN",870,0)
870
"BLD",5632,"KRN",870,"NM",0)
^9.68A^^
"BLD",5632,"KRN",8989.51,0)
8989.51
"BLD",5632,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",5632,"KRN",8989.52,0)
8989.52
"BLD",5632,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",5632,"KRN",8994,0)
8994
"BLD",5632,"KRN",8994,"NM",0)
^9.68A^^
"BLD",5632,"KRN","B",.4,.4)

"BLD",5632,"KRN","B",.401,.401)

"BLD",5632,"KRN","B",.402,.402)

"BLD",5632,"KRN","B",.403,.403)

"BLD",5632,"KRN","B",.5,.5)

"BLD",5632,"KRN","B",.84,.84)

"BLD",5632,"KRN","B",3.6,3.6)

"BLD",5632,"KRN","B",3.8,3.8)

"BLD",5632,"KRN","B",9.2,9.2)

"BLD",5632,"KRN","B",9.8,9.8)

"BLD",5632,"KRN","B",19,19)

"BLD",5632,"KRN","B",19.1,19.1)

"BLD",5632,"KRN","B",101,101)

"BLD",5632,"KRN","B",409.61,409.61)

"BLD",5632,"KRN","B",771,771)

"BLD",5632,"KRN","B",870,870)

"BLD",5632,"KRN","B",8989.51,8989.51)

"BLD",5632,"KRN","B",8989.52,8989.52)

"BLD",5632,"KRN","B",8994,8994)

"BLD",5632,"QUES",0)
^9.62^^
"BLD",5632,"REQB",0)
^9.611^16^11
"BLD",5632,"REQB",2,0)
PRCA*4.5*203^1
"BLD",5632,"REQB",3,0)
PRCA*4.5*147^1
"BLD",5632,"REQB",5,0)
PRCA*4.5*194^1
"BLD",5632,"REQB",6,0)
PRCA*4.5*205^1
"BLD",5632,"REQB",9,0)
PRCA*4.5*211^1
"BLD",5632,"REQB",10,0)
PRCA*4.5*191^1
"BLD",5632,"REQB",12,0)
PRCA*4.5*207^1
"BLD",5632,"REQB",13,0)
PRCA*4.5*215^1
"BLD",5632,"REQB",14,0)
PRCA*4.5*173^1
"BLD",5632,"REQB",15,0)
PRCA*4.5*192^1
"BLD",5632,"REQB",16,0)
PRCA*4.5*208^1
"BLD",5632,"REQB","B","PRCA*4.5*147",3)

"BLD",5632,"REQB","B","PRCA*4.5*173",14)

"BLD",5632,"REQB","B","PRCA*4.5*191",10)

"BLD",5632,"REQB","B","PRCA*4.5*192",15)

"BLD",5632,"REQB","B","PRCA*4.5*194",5)

"BLD",5632,"REQB","B","PRCA*4.5*203",2)

"BLD",5632,"REQB","B","PRCA*4.5*205",6)

"BLD",5632,"REQB","B","PRCA*4.5*207",12)

"BLD",5632,"REQB","B","PRCA*4.5*208",16)

"BLD",5632,"REQB","B","PRCA*4.5*211",9)

"BLD",5632,"REQB","B","PRCA*4.5*215",13)

"DATA",347.4,1,0)
01^1^01^01^^3^18
"DATA",347.4,1,1)
REFUND RECEIVABLE
"DATA",347.4,2,0)
02^1^05^02^^3^75
"DATA",347.4,2,1)
REIMBURSEMENT RECEIVABLE
"DATA",347.4,4,0)
20^1^20^20^^1^65
"DATA",347.4,4,1)
SALARY OVERPAYMENTS
"DATA",347.4,5,0)
24^1^05^02^^^75
"DATA",347.4,5,1)
INELEIGABLE HEALTH
"DATA",347.4,6,0)
50^1^05^23^^3^33
"DATA",347.4,6,1)
TORT FEASOR
"DATA",347.4,7,0)
09^1^23^04^^3^33
"DATA",347.4,7,1)
GENERAL FUND RECEIVABLE
"DATA",347.4,8,0)
10^0^60^01^10^3^60
"DATA",347.4,8,1)
COMPENSATED WORK THERAPY
"DATA",347.4,9,0)
25^1^17^02^^3^24
"DATA",347.4,9,1)
PATIENT FUNDS
"FIA",347.4)
AR/FMS DOCUMENTS
"FIA",347.4,0)
^PRCA(347.4,
"FIA",347.4,0,0)
347.4I
"FIA",347.4,0,1)
y^n^f^^n^^y^o^n
"FIA",347.4,0,10)

"FIA",347.4,0,11)

"FIA",347.4,0,"RLRO")

"FIA",347.4,0,"VR")
4.5^PRCA
"FIA",347.4,347.4)
0
"FIA",430)
ACCOUNTS RECEIVABLE
"FIA",430,0)
^PRCA(430,
"FIA",430,0,0)
430I
"FIA",430,0,1)
y^n^p^^^^n^^n
"FIA",430,0,10)

"FIA",430,0,11)

"FIA",430,0,"RLRO")

"FIA",430,0,"VR")
4.5^PRCA
"FIA",430,430)
1
"FIA",430,430,2)

"INIT")
RCY220PT
"KRN",.402,392,-1)
0^1
"KRN",.402,392,0)
PRCA BILL 1114^3040803.1037^^430^^^3040914
"KRN",.402,392,"%D",0)
^^2^2^2931014^^^
"KRN",.402,392,"%D",1,0)
This template inputs information for the 1114 bill form.
"KRN",.402,392,"%D",2,0)
OPTION: PRCA BIL ENTER
"KRN",.402,392,"DIAB",2,0,430,1)
9;"DEBTOR (PAYER)"
"KRN",.402,392,"DR",1,430)
S PRCAMT=0;I $D(RCAMEND) S Y=104;2;Q;I X>39,X<45,DT<$$ADDPTEDT^PRCAACC() W !,"This bill category not active until 9/28/04" S Y=2;I X>39,X<45 S Y="@100";250;I X'="" S Y="@100";203;@100;10//^S X=DT;104;107;
"KRN",.402,392,"DR",1,430,1)
S DIC("V")="I "",200,440,""[("",""_+$P(^(0),U)_"","")";9DEBTOR (PAYER)~;I $D(RCAMEND) S Y="@99";106;Q;D EN4^PRCABIL;S DIE("NO^")="BACK";1//^S X=$$FY^RCFN01(DT);K DIE("NO^");@99;
"KRN",.402,392,"DR",2,430.01)
.01;Q;7//^S X=PRCAMT;Q;
"KRN",.402,392,"DR",2,430.02)
.01;2;3;4;5;6;
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5^^2950320
"PKG",142,22,1,"PAH",1,0)
220^3040916
"PKG",142,22,1,"PAH",1,1,0)
^^3^3^3040916
"PKG",142,22,1,"PAH",1,1,1,0)
This patch implements new point accounts 528705-528709 and 528710
"PKG",142,22,1,"PAH",1,1,2,0)
It also changes point accounts 5287.1 to 528701,  5287.3 to 528704 and
"PKG",142,22,1,"PAH",1,1,3,0)
5287.4 to 528704.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
28
"RTN","PRCAACC")
0^1^B8809868
"RTN","PRCAACC",1,0)
PRCAACC ;WASH-ISC@ALTOONA,PA/CMS-AR ACCRUAL TOTALS ;2/6/95  11:17 AM
"RTN","PRCAACC",2,0)
 ;;4.5;Accounts Receivable;**60,74,90,101,157,203,220**;Mar 20, 1995
"RTN","PRCAACC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAACC",4,0)
 NEW PRCAQUE,PRCADEV,PRCA,ZTSK
"RTN","PRCAACC",5,0)
 S PRCA("MESS")="Do you wish to queue this report" D QUE^PRCAQUE G:'$D(PRCAQUE) Q
"RTN","PRCAACC",6,0)
 I $D(IO("Q")) S ZTRTN="DQ^PRCAACC",ZTDESC="AR Accrual Totals" D ^%ZTLOAD G Q
"RTN","PRCAACC",7,0)
DQ ;
"RTN","PRCAACC",8,0)
 U IO
"RTN","PRCAACC",9,0)
 NEW BILLN,COM,TOT,STAT,X,Y
"RTN","PRCAACC",10,0)
 S BILLN=0
"RTN","PRCAACC",11,0)
 D COM G:$O(COM(""))="" RPT
"RTN","PRCAACC",12,0)
 F STAT=42,16 F  S BILLN=$O(^PRCA(430,"AC",STAT,BILLN)) Q:'BILLN  I $$ACCK(BILLN) D
"RTN","PRCAACC",13,0)
 .S X=(","_$P(^PRCA(430,BILLN,0),"^",2)_",")
"RTN","PRCAACC",14,0)
 .S TOT(X)=$G(TOT(X))+$G(^PRCA(430,BILLN,7))
"RTN","PRCAACC",15,0)
 .QUIT
"RTN","PRCAACC",16,0)
RPT D NOW^%DTC W @IOF,!!,?23,"Accrual Totals Report",!?20,"As of: " S Y=% X ^DD("DD") W Y,!
"RTN","PRCAACC",17,0)
 S X="",$P(X,"=",80)="" W X
"RTN","PRCAACC",18,0)
 W:$O(COM(""))="" !!,"WARNING: Accruals are *NOT* set-up correctly.",!,"No RX accrual common numbering series are set-up in AR Bill Number File!",!!
"RTN","PRCAACC",19,0)
 S TOT=$G(TOT(",22,"))+$G(TOT(",23,")) I TOT W !!!,"RX CO-PAYMENT  Accrual Amount: $",$FN(TOT,",",2)
"RTN","PRCAACC",20,0)
 I $G(TOT(",18,"))>0 W !!!,"C (MEANS TEST)  Accrual Amount: $",$FN(TOT(",18,"),",",2)
"RTN","PRCAACC",21,0)
 W !!!!,"Includes Common Numbering Series:",! S COM="" F  S COM=$O(COM(COM)) Q:COM=""  W !,COM,?20,COM(COM)
"RTN","PRCAACC",22,0)
Q D ^%ZISC S IOP=IO(0) D ^%ZIS K IOP,IO("Q") Q
"RTN","PRCAACC",23,0)
ACCK(BN) ;Check BILLN to see if Accrual
"RTN","PRCAACC",24,0)
 N ACC,ACTDATE,CAT,FUND,DB
"RTN","PRCAACC",25,0)
 S CAT=+$P(^PRCA(430,BN,0),"^",2)
"RTN","PRCAACC",26,0)
 ;  field 12, ACCRUED ? where 0=no 1=yes, 2=could be either
"RTN","PRCAACC",27,0)
 S ACC=+$P($G(^PRCA(430.2,CAT,0)),"^",9)
"RTN","PRCAACC",28,0)
 ;  it could be either accrued or non-accrued
"RTN","PRCAACC",29,0)
 I ACC=2 D
"RTN","PRCAACC",30,0)
 .   S FUND=$P($G(^PRCA(430,BN,11)),"^",17)
"RTN","PRCAACC",31,0)
 .   S ACC=$S(FUND=5014:1,FUND=2431:1,1:0)
"RTN","PRCAACC",32,0)
 .   I $E(FUND,1,4)=5287 S ACC=$$PTACCT(FUND)
"RTN","PRCAACC",33,0)
 .   ;  special case with Workman's Comp
"RTN","PRCAACC",34,0)
 .   I ACC=0,CAT=6,FUND="" D
"RTN","PRCAACC",35,0)
 .   .   S DB=$P($G(^RCD(340,+$P($G(^PRCA(430,BN,0)),U,9),0)),U)
"RTN","PRCAACC",36,0)
 .   .   I DB[";DPT"!($P($G(^PRCA(430,BN,0)),U,7)'="") S ACC=1
"RTN","PRCAACC",37,0)
 ;
"RTN","PRCAACC",38,0)
 ;  public law states that bills in the category ineligible (1),
"RTN","PRCAACC",39,0)
 ;  emerg/human (2), torts (10), or medicare (21) which are older 
"RTN","PRCAACC",40,0)
 ;  than oct 1, 1992 should be treated as non-accrued.
"RTN","PRCAACC",41,0)
 I CAT=1!(CAT=2)!(CAT=10)!(CAT=21) D
"RTN","PRCAACC",42,0)
 .   S ACTDATE=$P($G(^PRCA(430,BN,6)),"^",21) I 'ACTDATE S ACTDATE=DT
"RTN","PRCAACC",43,0)
 .   I ACTDATE<2921001 S ACC=0
"RTN","PRCAACC",44,0)
 .   ;
"RTN","PRCAACC",45,0)
 .   ;  patch157 changes ineligibles.  an ineligible created before
"RTN","PRCAACC",46,0)
 .   ;  oct 1, 1992 or after sep 30, 2000 will be non-accrued.
"RTN","PRCAACC",47,0)
 .   ;  otherwise it will be accrued.
"RTN","PRCAACC",48,0)
 .   I CAT=1,ACTDATE>3000930 S ACC=0
"RTN","PRCAACC",49,0)
 ;
"RTN","PRCAACC",50,0)
 Q ACC
"RTN","PRCAACC",51,0)
COM ;Find Accrual common numbering series
"RTN","PRCAACC",52,0)
 S COM=0
"RTN","PRCAACC",53,0)
 F  S COM=$O(^PRCA(430.4,COM)) Q:'COM  I $P(^PRCA(430.4,COM,0),"^",6) S COM($P(^PRCA(430.4,COM,0),"^"))=$P($G(^DIC(49,$P(^(0),"^",5),0)),"^",1)
"RTN","PRCAACC",54,0)
 Q
"RTN","PRCAACC",55,0)
PTACCT(FUND) ;Determines whether Point Accounts are accrued
"RTN","PRCAACC",56,0)
 ;returns 1 for accrued funds 528701,528702,528703,528709
"RTN","PRCAACC",57,0)
 ;returns 0 for any other fund
"RTN","PRCAACC",58,0)
 I FUND'[5287 Q 0
"RTN","PRCAACC",59,0)
 S X=$E(FUND,5,6),X=$S(X="09":1,X<"05":1,1:0)
"RTN","PRCAACC",60,0)
 Q X
"RTN","PRCAACC",61,0)
ADDPTEDT() ;Effective date of additional point accounts 
"RTN","PRCAACC",62,0)
 ;       (528705 - 528708 and 528710)
"RTN","PRCAACC",63,0)
 ;Effective date of switch from 4032 to 528709
"RTN","PRCAACC",64,0)
 Q 3040928
"RTN","PRCABIL1")
0^10^B25254789
"RTN","PRCABIL1",1,0)
PRCABIL1 ;SF-ISC/RSD-ENTER BILL INFO ;10/16/96  7:04 PM
"RTN","PRCABIL1",2,0)
V ;;4.5;Accounts Receivable;**57,64,109,147,220**;Mar 20, 1995
"RTN","PRCABIL1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCABIL1",4,0)
EN1 ;ENTER NEW BILL
"RTN","PRCABIL1",5,0)
 D ST Q:'%  N CP
"RTN","PRCABIL1",6,0)
EN10 D EN^PRCABIL2 G Q:'$D(PRCABN) S $P(^PRCA(430,PRCABN,0),"^",8)=$O(^PRCA(430.3,"AC",201,0)) D EN G EN10
"RTN","PRCABIL1",7,0)
EN2 ;EDIT BILL
"RTN","PRCABIL1",8,0)
EN20 D SVC^PRCABIL Q:'$D(PRCAP("S"))  S DIC("S")="S Z0=$S($D(^PRCA(430.3,+$P(^(0),U,8),0)):$P(^(0),U,3),1:0) I Z0>199,Z0<210,'$P($G(^PRCA(430,Y,3)),U,3),+$P($G(^(100)),U,2)="_PRCAP("S")
"RTN","PRCABIL1",9,0)
 D BILLN^PRCAUTL G Q:'$D(PRCABN) D EN G EN20
"RTN","PRCABIL1",10,0)
EN4 ;CANCEL BILL
"RTN","PRCABIL1",11,0)
EN40 D SVC^PRCABIL Q:'$D(PRCAP("S"))  S DIC("S")="S Z0=$S($D(^PRCA(430.3,+$P(^(0),U,8),0)):$P(^(0),U,3),1:0) I Z0>199,Z0<210,$D(^PRCA(430,Y,100)),+$P(^(100),U,2)="_PRCAP("S")
"RTN","PRCABIL1",12,0)
 D BILLN^PRCAUTL G Q:'$D(PRCABN)
"RTN","PRCABIL1",13,0)
YN S %=2 W !,"  Sure you want to cancel this Bill" D YN^DICN
"RTN","PRCABIL1",14,0)
 I %=0 W !,*7,"Answer 'Yes' or 'No' " G YN
"RTN","PRCABIL1",15,0)
 I %'=1 D Q G EN40
"RTN","PRCABIL1",16,0)
 S $P(^PRCA(430,PRCABN,0),"^",14)=DT,$P(^(0),"^",17)=DUZ,$P(^(9),"^",6)=$P(^(0),"^",8),PRCA("STATUS")=$O(^PRCA(430.3,"AC",210,0)) D UPSTATS^PRCAUT2 K PRCA("STATUS") D Q G EN40
"RTN","PRCABIL1",17,0)
EN K PRCADFM S DA=PRCABN D LCK G Q:'$D(DA)
"RTN","PRCABIL1",18,0)
 S DIE="^PRCA(430,"
"RTN","PRCABIL1",19,0)
 I $D(RCAMEND) S X=+^PRCA(430,DA,100) I X?1N,X<4,X>0 G FORM
"RTN","PRCABIL1",20,0)
 S DR="100" D ^DIE G:X'?1N Q
"RTN","PRCABIL1",21,0)
FORM N PRCACAT,PRCAFUND
"RTN","PRCABIL1",22,0)
 S DR="[PRCA BILL "_$P("1081^1080^1114","^",X)_"]",PRCABT=X D ^DIE
"RTN","PRCABIL1",23,0)
 S:$D(DUZ) $P(^PRCA(430,PRCABN,9),U,8)=DUZ
"RTN","PRCABIL1",24,0)
 S PRCACAT=$P(^PRCA(430,PRCABN,0),U,2)
"RTN","PRCABIL1",25,0)
 I PRCACAT>39,PRCACAT<45 D
"RTN","PRCABIL1",26,0)
    .S X=PRCACAT,PRCAFUND=$S(X=40:"05",X=41:"06",X=42:"07",X=43:"08",1:"10"),PRCAFUND=5287_PRCAFUND
"RTN","PRCABIL1",27,0)
    .S DR="259////"_"09;203////^S X=PRCAFUND"
"RTN","PRCABIL1",28,0)
    .;I PRCAFUND'=528707 S DR=DR_";258////1"
"RTN","PRCABIL1",29,0)
    .D ^DIE
"RTN","PRCABIL1",30,0)
    .Q
"RTN","PRCABIL1",31,0)
 I $P(^PRCA(430,PRCABN,0),U,9)=""!('$D(^(100))!('$D(^(101)))) D MESG W !,"Bill is incomplete and must be re-edited !",*7 G Q
"RTN","PRCABIL1",32,0)
 D EN4^PRCABIL S PRCAMT1=0,PRCAMTY=0,DIK="^PRCA(430,PRCABN,2,"
"RTN","PRCABIL1",33,0)
 F PRCAI=0:0 S PRCAI=$O(^PRCA(430,PRCABN,2,PRCAI)) Q:'PRCAI  I $D(^(PRCAI,0)) S X=^(0) I $P(X,"^",8)]"" S PRCAMT1=PRCAMT1+$P(X,"^",8),PRCAMTY=PRCAMTY+1
"RTN","PRCABIL1",34,0)
 I 'PRCAMT1 W !!,"Fiscal Year Amount was not entered !  Bill is incomplete",*7 G Q
"RTN","PRCABIL1",35,0)
 I PRCAMTY>1 W !!,"Multiple Fiscal Years are not allowed at this time !",!,"Bill is incomplete and must be re-edited.",*7 G Q
"RTN","PRCABIL1",36,0)
 ;S DIE=DIK,DA(1)=PRCABN,DA=+$O(^PRCA(430,PRCABN,2,0)),DR=".01;7" S:'DA ^PRCA(430,PRCABN,2,0)="^430.01" D ^DIE
"RTN","PRCABIL1",37,0)
 I PRCAMT1'=PRCAMT,PRCABT'=1 W !!,"Fiscal Year Amounts do not equal the total bill amount !",!,"Bill is incomplete and must be re-edited !",*7 G Q
"RTN","PRCABIL1",38,0)
 I PRCAMT1'=PRCAMT,PRCABT=1 D  ;
"RTN","PRCABIL1",39,0)
 . N DIE,DA,DR
"RTN","PRCABIL1",40,0)
 . S PRCAMT1=PRCAMT
"RTN","PRCABIL1",41,0)
 . S DIE="^PRCA(430,PRCABN,2,"
"RTN","PRCABIL1",42,0)
 . S DA(1)=PRCABN
"RTN","PRCABIL1",43,0)
 . S DA=+$O(^PRCA(430,PRCABN,2,0))
"RTN","PRCABIL1",44,0)
 . S DR="1///"_PRCAMT1
"RTN","PRCABIL1",45,0)
 . QUIT:'DA
"RTN","PRCABIL1",46,0)
 . ; 
"RTN","PRCABIL1",47,0)
 . DO ^DIE
"RTN","PRCABIL1",48,0)
 ;
"RTN","PRCABIL1",49,0)
 S Y=$P(^PRCA(430,PRCABN,0),"^",9),Y=Y_"^"_$P(^RCD(340,Y,0),"^",1)
"RTN","PRCABIL1",50,0)
 G:$P(Y,";",2)="DPT("!($P(Y,";",2)="DIC(36,") CONT
"RTN","PRCABIL1",51,0)
 S PRCANODE=.11 S:$P(Y,";",2)="DIC(4," PRCANODE=1 S PRCANODE="^"_$P(Y,";",2)_+$P(Y,"^",2)_","_PRCANODE_")",PRCANODE=$G(@PRCANODE)
"RTN","PRCABIL1",52,0)
 I $P(PRCANODE,"^",1)="" S DR=$P(Y,"^",2),%=1 W !," (No Street Address)  Edit Debtor Address: " D YN^DICN,EN1^RCAM(DR):%=1 K DIE,DR,DA
"RTN","PRCABIL1",53,0)
CONT S Y=^PRCA(430,PRCABN,0),$P(Y,"^",3)=PRCAMT,PRCA("STATUS")=$O(^PRCA(430.3,"AC",205,0)),^PRCA(430,PRCABN,0)=Y,$P(^PRCA(430,PRCABN,7),"^")=PRCAMT
"RTN","PRCABIL1",54,0)
 I '$D(RCAMEND) S DIE="^PRCA(430,",DA=PRCABN,DR="8////"_PRCA("STATUS")_"" D ^DIE K DIE,DR,DA
"RTN","PRCABIL1",55,0)
DISP S %=1,PRCADFM=1 W !,"   Display/Print Bill:"
"RTN","PRCABIL1",56,0)
 K IOP D YN^DICN
"RTN","PRCABIL1",57,0)
 I %=0 W !,*7,"Answer 'Yes' or 'No' " G DISP
"RTN","PRCABIL1",58,0)
 D ^PRCABD:%=1
"RTN","PRCABIL1",59,0)
Q L -^PRCA(430,+$G(PRCABN),0)
"RTN","PRCABIL1",60,0)
 K %,%Y,A,B,C,D0,DA,DIC,DIE,DIK,DR,I,PRCA,PRCABC,PRCABN,PRCABT,PRCADFM,PRCAI,PRCAKCT,PRCANM,PRCARN,PRCATIME,PRCAMT,PRCAMTY,PRCANM,PRCANODE,PRCAMT1,PRCAMT2,PRCAQ,PRCAP,PRCAT,PRCATY,PRCAX,X,Y,Z0,ZRTN,ZTSK Q
"RTN","PRCABIL1",61,0)
LCK L +^PRCA(430,DA,0):0 I  Q
"RTN","PRCABIL1",62,0)
 W !,"ANOTHER USER IS EDITING THIS ENTRY !" K DA Q
"RTN","PRCABIL1",63,0)
CP ;CONTROL POINT LOOK-UP
"RTN","PRCABIL1",64,0)
 N DIC,PRC,DIE,DA,DR,X,Y,PRCSIP,PRCSI
"RTN","PRCABIL1",65,0)
 S PRC("SITE")=$S($G(PRCA("SITE")):PRCA("SITE"),1:$$SITE^RCMSITE)
"RTN","PRCABIL1",66,0)
 ;S PRC("SITE")=$$SITE^RCMSITE
"RTN","PRCABIL1",67,0)
 S DIC("B")=$P($G(^PRCA(430,PRCABN,11)),U)
"RTN","PRCABIL1",68,0)
 D CP^PRCSUT I '$G(PRC("CP")) Q
"RTN","PRCABIL1",69,0)
 I PRC("CP")<0 Q
"RTN","PRCABIL1",70,0)
 S $P(^PRCA(430,PRCABN,11),U)=PRC("CP")
"RTN","PRCABIL1",71,0)
 Q
"RTN","PRCABIL1",72,0)
ST D CKSITE^PRCAUDT S %=$D(PRCA("CKSITE")) Q
"RTN","PRCABIL1",73,0)
ST1 D SVC^PRCABIL S %=$S($D(PRCAP("S")):1,1:0) Q:%
"RTN","PRCABIL1",74,0)
 K PRCAP Q
"RTN","PRCABIL1",75,0)
DIP D SVC^PRCABIL Q:'$D(PRCAP("S"))
"RTN","PRCABIL1",76,0)
 S FR=PRCAP("S")_",?,@",TO=PRCAP("S")_",?",L=0,DIC="^PRCA(430,",FLDS="[PRCA BILL LIST]",BY="@INTERNAL(SERVICE),BILL NO.,FORM TYPE" D EN1^DIP K BY,DHD,DIC,FLDS,FR,L,PRCAP,TO Q
"RTN","PRCABIL1",77,0)
MESG I $P(^PRCA(430,PRCABN,0),U,9)="" W !,?3,"Debtor (or Payer) data is missing."
"RTN","PRCABIL1",78,0)
 I '$D(^PRCA(430,PRCABN,100)) W !,?3,"Service (or Section) , Form type or Voucher number data is missing."
"RTN","PRCABIL1",79,0)
 I '$D(^PRCA(430,PRCABN,101)) W !,?3,"Date of Charge data does not exist."
"RTN","PRCABIL1",80,0)
 W ! Q
"RTN","PRCABJV")
0^25^B29300227
"RTN","PRCABJV",1,0)
PRCABJV ;WASH-ISC@ALTOONA,PA/TJK-FILE VERIFICATION FOR BACKGROUND JOB ;4/6/95  10:13 AM
"RTN","PRCABJV",2,0)
V ;;4.5;Accounts Receivable;**1,48,63,114,141,170,176,173,192,220**;Mar 20, 1995
"RTN","PRCABJV",3,0)
 ;;patch 192 changes all occurrences of CHAMPUS to TRICARE
"RTN","PRCABJV",4,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCABJV",5,0)
EN1(FILE,X1,X2,ERROR) ;
"RTN","PRCABJV",6,0)
 ;FILE IS THE FILE NUMBER
"RTN","PRCABJV",7,0)
 ;X1 AND X2 ARE 3 PART VARIABLES SEPARATED BY SEMI-COLONS WITH
"RTN","PRCABJV",8,0)
 ;THE FORMAT (X-REF INDEX;NODE;PIECE)
"RTN","PRCABJV",9,0)
 ;AN ERROR ARRAY IS SET IF VALIDATION FAILS
"RTN","PRCABJV",10,0)
 NEW LT,CNT,I,I1,I2,I3,REC,IND,ND,PC,DATA,J,LN,FILENT
"RTN","PRCABJV",11,0)
 S LT=$S(FILE[430.3:"TRANST",FILE[430.2:"CAT",1:"EVENT"),CNT=0
"RTN","PRCABJV",12,0)
 F I=1,2 S J=@("X"_I),IND(I)=$P(J,";"),ND(I)=$P(J,";",2),PC(I)=$P(J,";",3)
"RTN","PRCABJV",13,0)
 F I1=1:1 D  Q:(DATA(0)="EOF")!(ERROR)
"RTN","PRCABJV",14,0)
    .S LN=$T(@LT+I1) F I=3:1:6 S DATA(I-3)=$P(LN,";",I)
"RTN","PRCABJV",15,0)
    .Q:DATA(0)="EOF"
"RTN","PRCABJV",16,0)
    .G RC:FILE<430
"RTN","PRCABJV",17,0)
    .I '$D(^PRCA(FILE,"B",DATA(0))) S ERROR=1 Q
"RTN","PRCABJV",18,0)
    .S REC=$O(^PRCA(FILE,"B",DATA(0),0)) I 'REC S ERROR=1 Q
"RTN","PRCABJV",19,0)
    .I DATA(3)'=REC S ERROR=1 Q
"RTN","PRCABJV",20,0)
    .I $P(^PRCA(FILE,REC,0),U)'=DATA(0) S ERROR=1 Q
"RTN","PRCABJV",21,0)
    .G CNT:X1=""
"RTN","PRCABJV",22,0)
    .F I2=1,2 D  Q:ERROR  I I2=1,X2="" Q
"RTN","PRCABJV",23,0)
       ..I '$D(^PRCA(FILE,IND(I2),DATA(I2))) S ERROR=1 G Q2
"RTN","PRCABJV",24,0)
       ..;  do not check if category number is a zero
"RTN","PRCABJV",25,0)
       ..I I2=1,DATA(1)'=0,$O(^PRCA(FILE,IND(I2),DATA(I2),0))'=REC S ERROR=1 G Q2
"RTN","PRCABJV",26,0)
       ..I $P(^PRCA(FILE,REC,ND(I2)),U,PC(I2))'=DATA(I2) S ERROR=1
"RTN","PRCABJV",27,0)
Q2       ..Q
"RTN","PRCABJV",28,0)
CNT    .Q:ERROR
"RTN","PRCABJV",29,0)
    .S CNT=CNT+1
"RTN","PRCABJV",30,0)
Q1    .Q
"RTN","PRCABJV",31,0)
RC    .I '$D(^RC(FILE,"B",DATA(0))) S ERROR=1 Q
"RTN","PRCABJV",32,0)
    .S REC=$O(^RC(FILE,"B",DATA(0),0)) I 'REC S ERROR=1 Q
"RTN","PRCABJV",33,0)
    .I DATA(3)'=REC S ERROR=1 Q
"RTN","PRCABJV",34,0)
    .I $P(^RC(FILE,REC,0),U)'=DATA(0) S ERROR=1 Q
"RTN","PRCABJV",35,0)
    .G CNT:X1=""
"RTN","PRCABJV",36,0)
    .F I3=1,2 D  Q:ERROR  I I3=1,X2="" Q
"RTN","PRCABJV",37,0)
       ..I '$D(^RC(FILE,IND(I3),DATA(I3))) S ERROR=1 G Q3
"RTN","PRCABJV",38,0)
       ..I $O(^RC(FILE,IND(I3),DATA(I3),0))'=REC S ERROR=1 G Q3
"RTN","PRCABJV",39,0)
       ..I $P(^RC(FILE,REC,ND(I3)),U,PC(I3))'=DATA(I3) S ERROR=1
"RTN","PRCABJV",40,0)
Q3       ..Q
"RTN","PRCABJV",41,0)
    .G CNT
"RTN","PRCABJV",42,0)
 I FILE>429.99,$P(^PRCA(FILE,0),U,4)'=CNT S ERROR=1 G EXIT
"RTN","PRCABJV",43,0)
 G EXIT:FILE>429.99
"RTN","PRCABJV",44,0)
 I $P(^RC(FILE,0),U,4)'=CNT S ERROR=1
"RTN","PRCABJV",45,0)
EXIT Q:'ERROR
"RTN","PRCABJV",46,0)
 S FILENT=$S(FILE>429.99:$P(^PRCA(FILE,0),U,4),1:$P(^RC(FILE,0),U,4))
"RTN","PRCABJV",47,0)
 S ERROR(1)="An error has been detected in the "_$P(^DIC(FILE,0),U)_" File."
"RTN","PRCABJV",48,0)
 I DATA(0)="EOF" S ERROR(2)="There are too many entries in your file."
"RTN","PRCABJV",49,0)
 I DATA(0)'="EOF" S ERROR(2)="The "_DATA(0)_" Entry in your file is missing or corrupted."
"RTN","PRCABJV",50,0)
 Q
"RTN","PRCABJV",51,0)
TRANST ;
"RTN","PRCABJV",52,0)
 ;;ACTIVE;102;A;16
"RTN","PRCABJV",53,0)
 ;;ADD (AMEND);302;AD;37
"RTN","PRCABJV",54,0)
 ;;ADMIN.COST CHARGE;12;AC;12
"RTN","PRCABJV",55,0)
 ;;AMEND;303;AM;38
"RTN","PRCABJV",56,0)
 ;;AMENDED BILL;110;AB;33
"RTN","PRCABJV",57,0)
 ;;ARCHIVED;115;XX;49
"RTN","PRCABJV",58,0)
 ;;BILL INCOMPLETE;201;BI;27
"RTN","PRCABJV",59,0)
 ;;CANCELLATION;111;CN;39
"RTN","PRCABJV",60,0)
 ;;CANCELLED BILL;210;CB;26
"RTN","PRCABJV",61,0)
 ;;CASH COLLECTION BY RC/DOJ;7;CJ;7
"RTN","PRCABJV",62,0)
 ;;CHARGE SUSPENDED;19;CS;47
"RTN","PRCABJV",63,0)
 ;;COLLECTED/CLOSED;108;CC;22
"RTN","PRCABJV",64,0)
 ;;COMMENT;17;CM;45
"RTN","PRCABJV",65,0)
 ;;DEBIT VOUCHER (SF 5515);30;DV;30
"RTN","PRCABJV",66,0)
 ;;DECREASE ADJUSTMENT;21;DA;35
"RTN","PRCABJV",67,0)
 ;;DELETE (AMEND);301;DL;36
"RTN","PRCABJV",68,0)
 ;;EXEMPT INT/ADM. COST;14;E;14
"RTN","PRCABJV",69,0)
 ;;IN-ACTIVE;103;IA;17
"RTN","PRCABJV",70,0)
 ;;INCOMPLETE;101;IN;15
"RTN","PRCABJV",71,0)
 ;;INCREASE ADJUSTMENT;1;AJ;1
"RTN","PRCABJV",72,0)
 ;;INTEREST/ADM. CHARGE;13;IC;13
"RTN","PRCABJV",73,0)
 ;;MARSHAL/COURT COST;15;ML;24
"RTN","PRCABJV",74,0)
 ;;NEW BILL;104;N;18
"RTN","PRCABJV",75,0)
 ;;OLD BILL;106;OB;28
"RTN","PRCABJV",76,0)
 ;;OPEN;112;OP;42
"RTN","PRCABJV",77,0)
 ;;PAYMENT (IN FULL);20;PF;34
"RTN","PRCABJV",78,0)
 ;;PAYMENT (IN PART);2;PP;2
"RTN","PRCABJV",79,0)
 ;;PENDING APPROVAL;205;PA;20
"RTN","PRCABJV",80,0)
 ;;PENDING ARCHIVE;114;X;48
"RTN","PRCABJV",81,0)
 ;;PENDING CALM CODE;107;PC;21
"RTN","PRCABJV",82,0)
 ;;RE-ESTABLISH;250;RW;43
"RTN","PRCABJV",83,0)
 ;;REESTABLISH TO RC/DOJ;5;RR;5
"RTN","PRCABJV",84,0)
 ;;REFER TO RC;3;RC;3
"RTN","PRCABJV",85,0)
 ;;REFER TO DOJ;4;RJ;4
"RTN","PRCABJV",86,0)
 ;;REFUND REVIEW;113;PR;44
"RTN","PRCABJV",87,0)
 ;;REFUNDED;120;RF;41
"RTN","PRCABJV",88,0)
 ;;REPAYMENT PLAN;16;RP;25
"RTN","PRCABJV",89,0)
 ;;RETURNED BY RC/DOJ;6;RD;6
"RTN","PRCABJV",90,0)
 ;;RETURNED FOR AMENDMENT;230;RA;32
"RTN","PRCABJV",91,0)
 ;;RETURNED FROM AR (NEW);220;RT;31
"RTN","PRCABJV",92,0)
 ;;SUSPENDED;240;SP;40
"RTN","PRCABJV",93,0)
 ;;SUSPENSE;105;S;19
"RTN","PRCABJV",94,0)
 ;;TERM.BY COMPROMISE;9;TC;9
"RTN","PRCABJV",95,0)
 ;;TERM.BY RC/DOJ;29;TJ;29
"RTN","PRCABJV",96,0)
 ;;TERM.BY FIS.OFFICER;8;TO;8
"RTN","PRCABJV",97,0)
 ;;UNSUSPENDED;18;US;46
"RTN","PRCABJV",98,0)
 ;;WAIVED IN FULL;10;WF;10
"RTN","PRCABJV",99,0)
 ;;WAIVED IN PART;11;WP;11
"RTN","PRCABJV",100,0)
 ;;WRITE-OFF;109;WO;23
"RTN","PRCABJV",101,0)
 ;;EOF
"RTN","PRCABJV",102,0)
CAT ;patch 192 - ISC-0502-N2803 change Champus to Tricare
"RTN","PRCABJV",103,0)
 ;;ADULT DAY HEALTH CARE;40;AD;33
"RTN","PRCABJV",104,0)
 ;;C (MEANS TEST);24;C;18
"RTN","PRCABJV",105,0)
 ;;TRICARE;37;T1;30
"RTN","PRCABJV",106,0)
 ;;TRICARE PATIENT;38;T2;31
"RTN","PRCABJV",107,0)
 ;;TRICARE THIRD PARTY;39;T3;32
"RTN","PRCABJV",108,0)
 ;;CHAMPVA;36;CV;29
"RTN","PRCABJV",109,0)
 ;;CHAMPVA SUBSISTENCE;34;CS;27
"RTN","PRCABJV",110,0)
 ;;CHAMPVA THIRD PARTY;35;CT;28
"RTN","PRCABJV",111,0)
 ;;COMP & PEN PROCEEDS;8;CM;43
"RTN","PRCABJV",112,0)
 ;;CRIME OF PER.VIO.;27;CP;8
"RTN","PRCABJV",113,0)
 ;;CURRENT EMP.;14;CE;16
"RTN","PRCABJV",114,0)
 ;;CWT PROCEEDS;7;CW;42
"RTN","PRCABJV",115,0)
 ;;DOMICILIARY;41;DO;34
"RTN","PRCABJV",116,0)
 ;;EMERGENCY/HUMANITARIAN;25;H;2
"RTN","PRCABJV",117,0)
 ;;ENHANCED USE LEASE PROCEEDS;10;EP;44
"RTN","PRCABJV",118,0)
 ;;EX-EMPLOYEE;13;E;15
"RTN","PRCABJV",119,0)
 ;;FEDERAL AGENCIES-REFUND;15;F2;13
"RTN","PRCABJV",120,0)
 ;;FEDERAL AGENCIES-REIMB.;16;F1;14
"RTN","PRCABJV",121,0)
 ;;GERIATRIC EVAL-INSTITUTIONAL;44;GE;37
"RTN","PRCABJV",122,0)
 ;;GERIATRIC EVAL-NON-INSTITUTION;45;GN;38
"RTN","PRCABJV",123,0)
 ;;HOSPITAL CARE (NSC);1;HC;5
"RTN","PRCABJV",124,0)
 ;;HOSPITAL CARE PER DIEM;32;HP;25
"RTN","PRCABJV",125,0)
 ;;INELIGIBLE HOSP.;20;I;1
"RTN","PRCABJV",126,0)
 ;;INTERAGENCY;19;IA;20
"RTN","PRCABJV",127,0)
 ;;MEDICARE;28;MC;21
"RTN","PRCABJV",128,0)
 ;;MILITARY;17;M;12
"RTN","PRCABJV",129,0)
 ;;NO-FAULT AUTO ACC.;26;NA;7
"RTN","PRCABJV",130,0)
 ;;NURSING HOME CARE PER DIEM;31;NP;24
"RTN","PRCABJV",131,0)
 ;;NURSING HOME CARE(NSC);3;NC;3
"RTN","PRCABJV",132,0)
 ;;NURSING HOME CARE-LTC;46;NL;39
"RTN","PRCABJV",133,0)
 ;;NURSING HOME PROCEEDS;5;NH;40
"RTN","PRCABJV",134,0)
 ;;OUTPATIENT CARE(NSC);2;OC;4
"RTN","PRCABJV",135,0)
 ;;PARKING FEES;6;PF;41
"RTN","PRCABJV",136,0)
 ;;PREPAYMENT;33;PP;26
"RTN","PRCABJV",137,0)
 ;;REIMBURS.HEALTH INS.;21;RI;9
"RTN","PRCABJV",138,0)
 ;;RESPITE CARE-INSTITUTIONAL;42;RC;35
"RTN","PRCABJV",139,0)
 ;;RESPITE CARE-NON-INSTITUTIONAL;43;RN;36
"RTN","PRCABJV",140,0)
 ;;RX CO-PAYMENT/NSC VET;30;PN;23
"RTN","PRCABJV",141,0)
 ;;RX CO-PAYMENT/SC VET;29;PS;22
"RTN","PRCABJV",142,0)
 ;;SHARING AGREEMENTS;18;SA;19
"RTN","PRCABJV",143,0)
 ;;TORT FEASOR;22;TF;10
"RTN","PRCABJV",144,0)
 ;;VENDOR;11;V;17
"RTN","PRCABJV",145,0)
 ;;WORKMAN'S COMP.;23;WC;6
"RTN","PRCABJV",146,0)
 ;;EOF
"RTN","PRCABJV",147,0)
EVENT ;
"RTN","PRCABJV",148,0)
 ;;CASH PAYMENT;6;;6
"RTN","PRCABJV",149,0)
 ;;CHECK/MO PAYMENT;4;;4
"RTN","PRCABJV",150,0)
 ;;COMMENT;1;;1
"RTN","PRCABJV",151,0)
 ;;CREDIT CARD PAYMENT;7;;7
"RTN","PRCABJV",152,0)
 ;;DEPT OF JUSTICE PAYMENT;5;;5
"RTN","PRCABJV",153,0)
 ;;REGIONAL COUNSEL PAYMENT;3;;3
"RTN","PRCABJV",154,0)
 ;;FOLLOW-UP LETTER;10;;10
"RTN","PRCABJV",155,0)
 ;;IRS PAYMENT;11;;11
"RTN","PRCABJV",156,0)
 ;;PATIENT STATEMENT;2;;2
"RTN","PRCABJV",157,0)
 ;;TDA PAYMENT;8;;8
"RTN","PRCABJV",158,0)
 ;;UB PRINTED;9;;9
"RTN","PRCABJV",159,0)
 ;;LOCKBOX;12;;12
"RTN","PRCABJV",160,0)
 ;;TOP PAYMENT;13;;13
"RTN","PRCABJV",161,0)
 ;;EDI LOCKBOX;14;;14
"RTN","PRCABJV",162,0)
 ;;EOF
"RTN","PRCAFBD")
0^2^B14761899
"RTN","PRCAFBD",1,0)
PRCAFBD ;WASH-ISC@ALTOONA,PA/CLH-Build FMS Billing Document ;8/2/95  3:14 PM
"RTN","PRCAFBD",2,0)
V ;;4.5;Accounts Receivable;**16,48,86,90,119,165,204,203,173,220**;Mar 20, 1995
"RTN","PRCAFBD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAFBD",4,0)
EN(BILL,ERR) ;Process NEW BILL to FMS
"RTN","PRCAFBD",5,0)
 S ERR=-1
"RTN","PRCAFBD",6,0)
 Q:$D(RCONVERT)
"RTN","PRCAFBD",7,0)
 I '$D(^PRCA(430,BILL,11)) S ERR="1^ACCOUNTING INFORMATION MISSING.  CANNOT PROCESS BILL" Q
"RTN","PRCAFBD",8,0)
 ;
"RTN","PRCAFBD",9,0)
 ;  funds 5014 (old), 2431 (old), 528701,03,04,09 and 4032 should not create a BD
"RTN","PRCAFBD",10,0)
 S %=$P($G(^PRCA(430,BILL,11)),"^",17)
"RTN","PRCAFBD",11,0)
 I %=5014!(%=2431)!(%=4032) Q
"RTN","PRCAFBD",12,0)
 I %[5287 Q:$$PTACCT^PRCAACC(%)
"RTN","PRCAFBD",13,0)
 ;
"RTN","PRCAFBD",14,0)
 I '$D(PRCA("SITE")) S PRCA("SITE")=$S($G(BILL):$P($P($G(^PRCA(430,BILL,0)),"^"),"-"),1:$$SITE^RCMSITE)
"RTN","PRCAFBD",15,0)
 K ^TMP("PRCABD",$J)
"RTN","PRCAFBD",16,0)
 I $G(BILL)="" S ERR="1^Missing Bill Number"
"RTN","PRCAFBD",17,0)
 I $D(^PRCA(430,BILL,0)),$P(^(0),U,9)="" S ERR="1^No debtor for bill" Q
"RTN","PRCAFBD",18,0)
 N GECSFMS,REC,REC11,VENCODE,BFY,EFY,LINEFUND,%,%I,%H,X,VEN,CAT,CP,ADDR,AC,RJ,FMSNUM,FMSNUM1,VENDORID,ADD,DA,Y
"RTN","PRCAFBD",19,0)
 D NOW^%DTC
"RTN","PRCAFBD",20,0)
 I '$G(PRCA("AUTO_AUDIT")) W !,"Building FMS Billing Document. Please hold...",!
"RTN","PRCAFBD",21,0)
 S REC=$G(^PRCA(430,BILL,0)),REC11=$G(^PRCA(430,BILL,11)),FMSNUM=$P($P(REC,U),"-")_$P($P(REC,U),"-",2)
"RTN","PRCAFBD",22,0)
 ;gather vendor information
"RTN","PRCAFBD",23,0)
 S VENCODE=$$VENDORID^RCXFMSUV(BILL)
"RTN","PRCAFBD",24,0)
 I VENCODE="UNKNOWN" S ERR="1^Need FMS Vendor ID for BD Document" Q
"RTN","PRCAFBD",25,0)
 I VENCODE="LINK" S ERR="1^Debtor must be linked to vendor file" Q
"RTN","PRCAFBD",26,0)
 S ADD=$$SADD^RCFN01(5)
"RTN","PRCAFBD",27,0)
 I (VENCODE="PERSONOTH")!(VENCODE="XEMPL")!(VENCODE="CUREMPL")!($E(VENCODE,1,4)="CHMP")!($E(VENCODE,1,3)="TRI")!(VENCODE="INELIG") D
"RTN","PRCAFBD",28,0)
  . N I F I=1:1:6 S ADDR(I)=$P(ADD,U,I)
"RTN","PRCAFBD",29,0)
  . I ADDR(6)["-" S ADDR(7)=$P(ADDR(6),"-",2),ADDR(6)=$P(ADDR(6),"-")
"RTN","PRCAFBD",30,0)
  . Q
"RTN","PRCAFBD",31,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCAFBD",32,0)
 S ^TMP("PRCABD",$J,1)="BD2^"_$E(FMSDT,4,5)_U_$E(FMSDT,6,7)_U_$E(FMSDT,2,3)_"^^^^^^E^"_$E(VENCODE,1,9)_U_$E(VENCODE,10,11)_U_$J($P(REC,U,3),0,2)_"^^^^"_$E($G(ADDR(1)),1,30)_U_$E($G(ADDR(2)),1,30)_U_$E($G(ADDR(3)),1,30)
"RTN","PRCAFBD",33,0)
 S ^TMP("PRCABD",$J,1)=^TMP("PRCABD",$J,1)_U_$E($G(ADDR(4)),1,19)_U_$G(ADDR(5))_U_$G(ADDR(6))_U_$G(ADDR(7))_"^N^^^^^^W^~"
"RTN","PRCAFBD",34,0)
 S ^TMP("PRCABD",$J,2)="LIN^~"
"RTN","PRCAFBD",35,0)
 ;accouting information - stored on 11th node file 430
"RTN","PRCAFBD",36,0)
 S ^TMP("PRCABD",$J,3)="BDA^"_$$LINE^RCXFMSC1(BILL)_"^"_$P(REC11,U,15)_U_$P(REC11,U,16)_U_$P(REC11,U,17)_U_$P(REC11,U,8)_U_$P(REC11,U,11)_U_$P(REC11,U,20)_U_$P(REC11,U,6)_U_$P(REC11,U,7)_U_$P(REC11,U,21)_U_$P(REC11,U,5)
"RTN","PRCAFBD",37,0)
 S ^TMP("PRCABD",$J,3)=^TMP("PRCABD",$J,3)_U_$P(REC11,U,12)_U_$P(REC11,U,14)_"^^"_$J($P(REC,U,3),0,2)_"^I^AR_INTERFACE^^^^"
"RTN","PRCAFBD",38,0)
 S ^TMP("PRCABD",$J,3)=^TMP("PRCABD",$J,3)_$P(REC11,U,10)_"^^^^^^^^"_$P(REC11,U,2)_U_$P(REC11,U,3)_"^~"
"RTN","PRCAFBD",39,0)
 ;build control segment
"RTN","PRCAFBD",40,0)
 D CONTROL^GECSUFMS("A",PRCA("SITE"),FMSNUM,"BD",10,"","","Billing Document")
"RTN","PRCAFBD",41,0)
 S FMSNUM1=$P($G(GECSFMS("DOC")),U,3)_"-"_$P($G(GECSFMS("DOC")),U,4)
"RTN","PRCAFBD",42,0)
 ;build and send document to FTH
"RTN","PRCAFBD",43,0)
 S DA=0 F  S DA=$O(^TMP("PRCABD",$J,DA)) Q:'DA  D SETCS^GECSSTAA(GECSFMS("DA"),^(DA))
"RTN","PRCAFBD",44,0)
 D OPEN^RCFMDRV1(FMSNUM1,6,"B"_BILL,.ENT,.ERR,BILL) I ERR]"" D
"RTN","PRCAFBD",45,0)
 . S ERR=-1
"RTN","PRCAFBD",46,0)
 . N Z S Z="Unable to create an entry in AR Document file."
"RTN","PRCAFBD",47,0)
 . I '$G(PRCA("AUTO_AUDIT")) W !!,Z,! Q
"RTN","PRCAFBD",48,0)
 . D SETERR^PRCAUDT("BILL: "_$$BILL^PRCAUDT(BILL)),SETERR^PRCAUDT(Z)
"RTN","PRCAFBD",49,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCAFBD",50,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCAFBD",51,0)
 D SSTAT^RCFMFN02(FMSNUM1,1)
"RTN","PRCAFBD",52,0)
 I '$G(PRCA("AUTO_AUDIT")) D
"RTN","PRCAFBD",53,0)
 . S Y=FMSDT D DD^%DT
"RTN","PRCAFBD",54,0)
 . W !!,"FMS document, # ",GECSFMS("DA"),", built and queued for transmission on "_Y,!!
"RTN","PRCAFBD",55,0)
 Q
"RTN","PRCAFBD",56,0)
 ;
"RTN","PRCAFBDM")
0^3^B5442375
"RTN","PRCAFBDM",1,0)
PRCAFBDM ;WASH-ISC@ALTOONA,PA/CLH-Build MODIFIED FMS Billing Document ;9/16/94  12:11 PM
"RTN","PRCAFBDM",2,0)
 ;;4.5;Accounts Receivable;**60,90,204,203,220**;Mar 20, 1995
"RTN","PRCAFBDM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAFBDM",4,0)
EN(BILL,AMT,ADJTYP,PRCADJD,TN,ERR) ;Process NEW BILL to FMS
"RTN","PRCAFBDM",5,0)
 Q:$D(RCONVERT)
"RTN","PRCAFBDM",6,0)
 N GECSFMS,REC,FMSNUM
"RTN","PRCAFBDM",7,0)
 K ^TMP("PRCABD",$J)
"RTN","PRCAFBDM",8,0)
 I $G(BILL)="" S ERR="1^Missing Bill Number" Q
"RTN","PRCAFBDM",9,0)
 ;
"RTN","PRCAFBDM",10,0)
 ;  funds 5014 (old), 2431 (old), 528701,03,04,09 and 4032 should not create a BD
"RTN","PRCAFBDM",11,0)
 S %=$P($G(^PRCA(430,BILL,11)),"^",17)
"RTN","PRCAFBDM",12,0)
 I %=5014!(%=2431)!(%=4032) Q
"RTN","PRCAFBDM",13,0)
 I %[5287 Q:$$PTACCT^PRCAACC(%)
"RTN","PRCAFBDM",14,0)
 ;
"RTN","PRCAFBDM",15,0)
 I +PRCADJD<1 S PRCADJD=DT
"RTN","PRCAFBDM",16,0)
 I AMT<0 S AMT=-AMT
"RTN","PRCAFBDM",17,0)
 I '$D(^PRCA(430,BILL,0)) S ERR="1^Unable to locate bill" Q
"RTN","PRCAFBDM",18,0)
 S REC=$G(^PRCA(430,BILL,0)),FMSNUM=$P($P(REC,U),"-")_$P($P(REC,U),"-",2)
"RTN","PRCAFBDM",19,0)
 W !!,"Creating FMS Modified Billing Document..."
"RTN","PRCAFBDM",20,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCAFBDM",21,0)
 S ^TMP("PRCABD",$J,1)="BD2^"_$E(FMSDT,4,5)_U_$E(FMSDT,6,7)_U_$E(FMSDT,2,3)_"^^^^^^M^^^"_$J(AMT,0,2)_"^~"
"RTN","PRCAFBDM",22,0)
 S ^TMP("PRCABD",$J,2)="LIN^~"
"RTN","PRCAFBDM",23,0)
 S ^TMP("PRCABD",$J,3)="BDA^"_$$LINE^RCXFMSC1(BILL)_"^^^^^^^^^^^^^^"_$J(AMT,0,2)_"^"_$S(ADJTYP=35:"D",ADJTYP=1:"I",1:"")_"^AR_INTERFACE^~"
"RTN","PRCAFBDM",24,0)
 ;build control segment
"RTN","PRCAFBDM",25,0)
 D CONTROL^GECSUFMS("A",$P(REC,U,12),FMSNUM,"BD",10,"1","","Modified Billing Document")
"RTN","PRCAFBDM",26,0)
 S FMSNUM1=$P($G(GECSFMS("DOC")),U,3)_"-"_$P($G(GECSFMS("DOC")),U,4)_"-"_$P($G(GECSFMS("BAT")),U,3)
"RTN","PRCAFBDM",27,0)
 D OPEN^RCFMDRV1(FMSNUM1,7,"T"_TN,.ENT,.ERR,BILL,TN) I ERR]"" W !!,"Unable to create entry in AR Document File.",! S ERR=-1
"RTN","PRCAFBDM",28,0)
 ;build and send document to FTH
"RTN","PRCAFBDM",29,0)
 S DA=0 F  S DA=$O(^TMP("PRCABD",$J,DA)) Q:'DA  D SETCS^GECSSTAA(GECSFMS("DA"),^(DA))
"RTN","PRCAFBDM",30,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCAFBDM",31,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCAFBDM",32,0)
 D SSTAT^RCFMFN02("T"_TN,1)
"RTN","PRCAFBDM",33,0)
 W !,"Document #",GECSFMS("DA")," Created.",!
"RTN","PRCAFBDM",34,0)
 Q
"RTN","PRCAFBDM",35,0)
 ;
"RTN","PRCAFUT")
0^11^B30486823
"RTN","PRCAFUT",1,0)
PRCAFUT ;WASH-ISC@ALTOONA/CLH-FMS Utilities ;10/8/96  10:50 AM
"RTN","PRCAFUT",2,0)
V ;;4.5;Accounts Receivable;**5,39,64,92,104,169,188,194,220**;Mar 20, 1995
"RTN","PRCAFUT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAFUT",4,0)
CPLK(PRCABN) ;get control point from file 430 and set DR string to edit CP data
"RTN","PRCAFUT",5,0)
 N DR,X,Y,QUIT,FUND,FTBL,CAT,CATTYP,CATTYPE,CP,BBFY,EBFY,DIC,BGFY,CPTBL,CC,SCC,EXIT,FYERROR
"RTN","PRCAFUT",6,0)
 K PRCA("EXIT")
"RTN","PRCAFUT",7,0)
 S PRCA("SITE")=$S($G(PRCABN):$P($P($G(^PRCA(430,PRCABN,0)),"^"),"-"),1:$$SITE^RCMSITE)
"RTN","PRCAFUT",8,0)
 S CP=$P($G(^PRCA(430,PRCABN,11)),U)
"RTN","PRCAFUT",9,0)
 S CAT=+$P($G(^PRCA(430,PRCABN,0)),U,2),CATTYP=$P($G(^PRCA(430.2,CAT,0)),U,13)
"RTN","PRCAFUT",10,0)
 I CAT>39,CAT<45 D  G END
"RTN","PRCAFUT",11,0)
    .S TYPE="09" D CHKELEM
"RTN","PRCAFUT",12,0)
    .S DR="255;257///^S X=$G(PRCA(""SITE""))"
"RTN","PRCAFUT",13,0)
    .;I CAT'=42 S DR=DR_";258////1"
"RTN","PRCAFUT",14,0)
    .D DIE
"RTN","PRCAFUT",15,0)
    .Q
"RTN","PRCAFUT",16,0)
 D TYPE Q:$D(PRCA("EXIT"))
"RTN","PRCAFUT",17,0)
 I CATTYP=2 K PRCA("EXIT") D  G END
"RTN","PRCAFUT",18,0)
  . ;reibursement logic (if there is such a thing)
"RTN","PRCAFUT",19,0)
  . S DR="203" D DIE K DR I $D(Y) Q
"RTN","PRCAFUT",20,0)
  . I '$D(FUND) S FUND=$P($G(^PRCA(430,PRCABN,11)),U,17) D  I FUND=-1 S PRCA("EXIT")="" Q
"RTN","PRCAFUT",21,0)
  .. N X,Y,DIC
"RTN","PRCAFUT",22,0)
  .. S X=FUND,DIC="^PRCD(420.14,",DIC(0)="XMNZ",DIC("B")=FUND D ^DIC
"RTN","PRCAFUT",23,0)
  .. I +Y<0 D FUND^PRCAFBDU D  Q:FUND=-1
"RTN","PRCAFUT",24,0)
  ... S DIC="^PRCD(420.14,",DIC(0)="AEMNQZ",DIC("A")="FUND: ",DIC("B")=FUND
"RTN","PRCAFUT",25,0)
  ... D ^DIC
"RTN","PRCAFUT",26,0)
  ... S:+Y<0 FUND=-1 Q
"RTN","PRCAFUT",27,0)
  .. S FUND=Y
"RTN","PRCAFUT",28,0)
  .. S BBFY=$E($P(Y(0),U,3),3,4),EBFY=$E($P(Y(0),U,4),3,4)
"RTN","PRCAFUT",29,0)
  ..Q
"RTN","PRCAFUT",30,0)
  .S PRCABN(1)=$O(^PRCA(430,+PRCABN,2,0))
"RTN","PRCAFUT",31,0)
  .S PRCABN(2)=$G(^PRCA(430,+PRCABN,2,PRCABN(1),0))
"RTN","PRCAFUT",32,0)
  .S PRCABN(4)=+$G(PRCABN(2))
"RTN","PRCAFUT",33,0)
  .S X=BBFY D ^%DT S PRCABN(3)=$E(Y,1,3)
"RTN","PRCAFUT",34,0)
  .K ^PRCA(430,PRCABN,2,PRCABN(1),0)
"RTN","PRCAFUT",35,0)
  .K ^PRCA(430,PRCABN,2,"B",PRCABN(4),PRCABN(1))
"RTN","PRCAFUT",36,0)
  .S ^PRCA(430,PRCABN,2,PRCABN(3),0)=PRCABN(2)
"RTN","PRCAFUT",37,0)
  .S $P(^PRCA(430,PRCABN,2,PRCABN(3),0),"^")=BBFY
"RTN","PRCAFUT",38,0)
  .S ^PRCA(430,PRCABN,2,"B",BBFY,PRCABN(3))=""
"RTN","PRCAFUT",39,0)
  .D DOCREQ^PRC0C(+FUND,"REV","FTBL")
"RTN","PRCAFUT",40,0)
  . I '$D(FTBL) S PRCA("EXIT")=1 D  Q
"RTN","PRCAFUT",41,0)
  .. W !,*7,"FMS REQUIRED FIELDS missing.  Edit the IFCAP REQUIRED FIELDS table",!,"for FUND/FY combination."
"RTN","PRCAFUT",42,0)
  .. Q
"RTN","PRCAFUT",43,0)
  . S DR="259////^S X=CAT;257////^S X=$G(PRCA(""SITE""));201////^S X=BBFY;202////^S X=$S($G(EBFY)'=BBFY:EBFY,1:"""")"
"RTN","PRCAFUT",44,0)
  . D DR
"RTN","PRCAFUT",45,0)
  . Q
"RTN","PRCAFUT",46,0)
 ;Ask Beginning/end budget fiscal year
"RTN","PRCAFUT",47,0)
 D FY^PRCAFUT1
"RTN","PRCAFUT",48,0)
 I $D(FYERROR) S PRCA("EXIT")=1 Q
"RTN","PRCAFUT",49,0)
 ;S BGFY=$P(^PRCA(430,PRCABN,0),U,10),BGFY=$$FY^RCFN01(BGFY)
"RTN","PRCAFUT",50,0)
 S DR="250;I '$D(CPTBL) D CPTBL^PRCAFUT;259////^S X=CAT;204////^S X=$P(CPTBL,U);206////^S X=$P(CPTBL,U,3)"
"RTN","PRCAFUT",51,0)
 S DR=DR_";203////^S X=$P(CPTBL,U,5);201////^S X=$E($P(CPTBL,U,6),3,4)"
"RTN","PRCAFUT",52,0)
 S DR(1,430,1)="202////^S X=$S($P(CPTBL,U,7)'=$P(CPTBL,U,6):$E($P(CPTBL,U,7),3,4),1:"""")"
"RTN","PRCAFUT",53,0)
 S DR(1,430,2)="261////^S X=$P(CPTBL,U,10)"
"RTN","PRCAFUT",54,0)
 S DA=PRCABN D ^DIE K DR
"RTN","PRCAFUT",55,0)
 I $D(Y) S PRCA("EXIT")=1 Q
"RTN","PRCAFUT",56,0)
 K DR
"RTN","PRCAFUT",57,0)
 D FTBL Q:'$D(FTBL)
"RTN","PRCAFUT",58,0)
 S (X,PRCABN(1))=$E($P(CPTBL,U,6),3,4)
"RTN","PRCAFUT",59,0)
 D ^%DT S PRCABN(2)=$E(Y,1,3)
"RTN","PRCAFUT",60,0)
 S PRCABN(3)=$O(^PRCA(430,+PRCABN,2,0))
"RTN","PRCAFUT",61,0)
 S PRCABN(4)=$G(^PRCA(430,+PRCABN,2,PRCABN(3),0))
"RTN","PRCAFUT",62,0)
 S PRCABN(5)=$E(PRCABN(4),1,2)
"RTN","PRCAFUT",63,0)
 K ^PRCA(430,PRCABN,2,PRCABN(3),0)
"RTN","PRCAFUT",64,0)
 K ^PRCA(430,PRCABN,2,"B",PRCABN(5),PRCABN(3))
"RTN","PRCAFUT",65,0)
 S ^PRCA(430,PRCABN,2,PRCABN(2),0)=PRCABN(4)
"RTN","PRCAFUT",66,0)
 S $P(^PRCA(430,PRCABN,2,PRCABN(2),0),"^")=PRCABN(1)
"RTN","PRCAFUT",67,0)
 S ^PRCA(430,PRCABN,2,"B",PRCABN(1),PRCABN(2))=""
"RTN","PRCAFUT",68,0)
 S $P(^PRCA(430,PRCABN,2,0),"^",3)=PRCABN(2)
"RTN","PRCAFUT",69,0)
 Q
"RTN","PRCAFUT",70,0)
FTBL S FUND=$$FUND^PRC0C($P(CPTBL,U,5),$P(CPTBL,U,6))
"RTN","PRCAFUT",71,0)
 D DOCREQ^PRC0C(+FUND,"SPE","FTBL")
"RTN","PRCAFUT",72,0)
 I '$D(FTBL) W !!,*7,"UNABLE TO GET FMS-LINE FUND ACCOUNTING INFORMATION.  CHECK CONTROL POINT." H 5 S PRCA("EXIT")=1 Q
"RTN","PRCAFUT",73,0)
 S DR="257////^S X=$G(PRCA(""SITE""))"
"RTN","PRCAFUT",74,0)
DR I $$INTEG^RCFN01($G(PRCA("SITE"))) S DR=DR_";260"
"RTN","PRCAFUT",75,0)
 I $G(FTBL("AO"))="Y" S DR=DR_";204"
"RTN","PRCAFUT",76,0)
 I $G(FTBL("FCPRJ"))="Y" S DR=DR_";I '$D(CPTBL) D CPTBL^PRCAFUT;206////^S X=$P(CPTBL,U,3)"
"RTN","PRCAFUT",77,0)
 I $G(FTBL("CC"))="Y"            S DR=DR_";251;252////^S X=$G(SCC)"
"RTN","PRCAFUT",78,0)
 I $G(FTBL("BOC"))="Y"           S DR=DR_";253"
"RTN","PRCAFUT",79,0)
 I $G(FTBL("SBOC"))="Y"!(CAT=20) S DR=DR_";254"
"RTN","PRCAFUT",80,0)
 I $G(FTBL("JOB"))="Y"           S DR=DR_";261"
"RTN","PRCAFUT",81,0)
 I $G(FTBL("RC"))="Y"            S DR=DR_";263"
"RTN","PRCAFUT",82,0)
 I $G(FTBL("REV"))="Y"           S DR=DR_";255"
"RTN","PRCAFUT",83,0)
 I $G(FTBL("SREV"))="Y"          S DR=DR_";256"
"RTN","PRCAFUT",84,0)
 I $G(FTBL("OC"))="Y"            S DR=DR_";205"
"RTN","PRCAFUT",85,0)
 D DIE
"RTN","PRCAFUT",86,0)
 Q
"RTN","PRCAFUT",87,0)
DIE S DA=PRCABN,DIE="^PRCA(430," D ^DIE
"RTN","PRCAFUT",88,0)
END I $D(Y) S PRCA("EXIT")=1
"RTN","PRCAFUT",89,0)
 K DR Q
"RTN","PRCAFUT",90,0)
 ;
"RTN","PRCAFUT",91,0)
RECTYP(BN) ;Refund or reimbursement
"RTN","PRCAFUT",92,0)
 I '$D(BN),'$D(^PRCA(430,BN,0)) Q -1
"RTN","PRCAFUT",93,0)
 Q $P($G(^PRCA(430,BN,11)),U,10)
"RTN","PRCAFUT",94,0)
 ;
"RTN","PRCAFUT",95,0)
FUND ;get fund
"RTN","PRCAFUT",96,0)
 N DIC,Y
"RTN","PRCAFUT",97,0)
 S DIC="^PRCD(420.14,",DIC(0)="EMNQZ"
"RTN","PRCAFUT",98,0)
 D ^DIC
"RTN","PRCAFUT",99,0)
 I $D(DUOUT)!$D(DTOUT) S PRCA("EXIT")=1 Q
"RTN","PRCAFUT",100,0)
 Q:+Y<0
"RTN","PRCAFUT",101,0)
 S FUND=Y
"RTN","PRCAFUT",102,0)
 S BBFY=$E($P(Y(0),U,3),3,4),EBFY=$E($P(Y(0),U,4),3,4)
"RTN","PRCAFUT",103,0)
 Q
"RTN","PRCAFUT",104,0)
 ;
"RTN","PRCAFUT",105,0)
DISPLACC ;display account information
"RTN","PRCAFUT",106,0)
 Q:'$D(PRCABN)  NEW DIC,L,FR,TO,FLDS,IOP,X
"RTN","PRCAFUT",107,0)
 R !!,"Press <RETURN> to continue: ",X:60
"RTN","PRCAFUT",108,0)
 I X["^" S PRCA("EXIT")="" Q
"RTN","PRCAFUT",109,0)
 S IOP=IO(0),DIC="^PRCA(430,",FLDS="[PRCA DISP AUDIT2]",(FR,TO)=PRCABN,L=0,BY="@NUMBER" D EN1^DIP
"RTN","PRCAFUT",110,0)
 Q
"RTN","PRCAFUT",111,0)
 ;
"RTN","PRCAFUT",112,0)
CP ;lookup control point
"RTN","PRCAFUT",113,0)
 N DIC
"RTN","PRCAFUT",114,0)
 S DIC="^PRC(420,"_$S($D(PRCA("SITE")):PRCA("SITE"),1:$$SITE^RCMSITE)_",1,",DIC(0)="EMNQ",X=CP
"RTN","PRCAFUT",115,0)
 D ^DIC
"RTN","PRCAFUT",116,0)
 I +Y<0 K X,CP Q
"RTN","PRCAFUT",117,0)
 S CP=+Y
"RTN","PRCAFUT",118,0)
 Q
"RTN","PRCAFUT",119,0)
 ;
"RTN","PRCAFUT",120,0)
CC ;cost center
"RTN","PRCAFUT",121,0)
 G CC^PRCAFBDU
"RTN","PRCAFUT",122,0)
 ;
"RTN","PRCAFUT",123,0)
BOC ;budget object code
"RTN","PRCAFUT",124,0)
 G BOC^PRCAFBDU
"RTN","PRCAFUT",125,0)
 ;
"RTN","PRCAFUT",126,0)
TYPE ;ask if bill is a refund or reimbursement
"RTN","PRCAFUT",127,0)
 W !!,"Building FMS Accounting Elements...",!
"RTN","PRCAFUT",128,0)
 N DIR,Y,TYPE
"RTN","PRCAFUT",129,0)
 I +$G(CAT)=1 S CAT="02",CATTYPE=2 D CHKELEM Q
"RTN","PRCAFUT",130,0)
 I +$G(CAT)=10 S CAT=50,CATTYPE=2 D CHKELEM Q
"RTN","PRCAFUT",131,0)
 D BDTRANS^PRCAFBDU
"RTN","PRCAFUT",132,0)
 Q:$D(PRCA("EXIT"))
"RTN","PRCAFUT",133,0)
 S CATTYP=$S(TYPE="01":"1",TYPE="20":"1",1:"2")
"RTN","PRCAFUT",134,0)
 S CAT=TYPE ; I CAT>2 S CAT=$S(CAT=4:"20",1:"9")
"RTN","PRCAFUT",135,0)
 D CHKELEM
"RTN","PRCAFUT",136,0)
 Q
"RTN","PRCAFUT",137,0)
 ;
"RTN","PRCAFUT",138,0)
CHKELEM ;check for correct accounting line data
"RTN","PRCAFUT",139,0)
 N I
"RTN","PRCAFUT",140,0)
 Q:'$D(^PRCA(430,PRCABN,11))
"RTN","PRCAFUT",141,0)
 I $G(CATTYP)=1 D  Q
"RTN","PRCAFUT",142,0)
  . F I=6,7 S $P(^PRCA(430,PRCABN,11),U,I)=""
"RTN","PRCAFUT",143,0)
  . Q
"RTN","PRCAFUT",144,0)
 Q:$G(TYPE)=10
"RTN","PRCAFUT",145,0)
 F I=1:1:5,11:1:16,18:1:21 S $P(^PRCA(430,PRCABN,11),U,I)=""
"RTN","PRCAFUT",146,0)
 Q
"RTN","PRCAFUT",147,0)
CPTBL ;build CP table
"RTN","PRCAFUT",148,0)
 S:'$D(BGFY) BGFY=$$FY^RCFN01(DT)
"RTN","PRCAFUT",149,0)
 S BGFY(1)=$S(BGFY>50:19,1:20)
"RTN","PRCAFUT",150,0)
 S CPTBL=$$ACC^PRC0C($G(PRCA("SITE")),+CP_U_BGFY_U_BGFY(1)_BGFY)
"RTN","PRCAFUT",151,0)
 I '$D(CPTBL) S CPTBL=""
"RTN","PRCAFUT",152,0)
 Q
"RTN","PRCAFUT",153,0)
 ;
"RTN","PRCAFUT",154,0)
CPHLP ;executable help for cp prompt
"RTN","PRCAFUT",155,0)
 N DIC,X,Y
"RTN","PRCAFUT",156,0)
 S DIC="^PRC(420,"_$S($D(PRCA("SITE")):PRCA("SITE"),1:$$SITE^RCMSITE)_",1,",DIC(0)="EMQ",X="?" D ^DIC
"RTN","PRCAFUT",157,0)
 Q
"RTN","PRCAFUT",158,0)
 ;
"RTN","PRCAFUT",159,0)
FND(BILL) ;Get fund for a bill
"RTN","PRCAFUT",160,0)
 I '$D(^PRCA(430,BILL,0)) Q -1
"RTN","PRCAFUT",161,0)
 I $D(^PRCA(430,BILL,11)),$P(^(11),"^",17)'="" Q $P(^(11),"^",17)
"RTN","PRCAFUT",162,0)
 I $P(^PRCA(430,BILL,0),"^",18)'="" Q $E($P(^(0),"^",18),4,9)
"RTN","PRCAFUT",163,0)
 Q -1
"RTN","PRCAFUT",164,0)
 ;
"RTN","PRCARFD1")
0^20^B32136965
"RTN","PRCARFD1",1,0)
PRCARFD1 ;WASH-ISC@ALTOONA,PA/LDB-APPROVE REFUND AND GENERATE FMS DOC ;2/14/96  9:13 AM
"RTN","PRCARFD1",2,0)
 ;;4.5;Accounts Receivable;**21,36,90,104,141,190,204,203,207,220**;Mar 20, 1995
"RTN","PRCARFD1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCARFD1",4,0)
 ;
"RTN","PRCARFD1",5,0)
APPRV ;Enter Elec sig for CFO
"RTN","PRCARFD1",6,0)
 N ADD,DA,ENT,ERROR,PRCABN0,PRCANM,RA,TIME,X,Y
"RTN","PRCARFD1",7,0)
 F X=1:1:5 S RA=+$G(RA)+$P($G(^PRCA(430,PRCABN,7)),U,X)
"RTN","PRCARFD1",8,0)
 I +$G(RA)'=$P($G(^PRCA(430,PRCABN,7)),U,18) W !!,"REFUND AMOUNT OUT-OF-BALANCE!" Q
"RTN","PRCARFD1",9,0)
 S DA=+PRCABN D SIG^PRCASIG I $G(PRCANM)']"" W !!,"DID NOT APPROVE REFUND" Q
"RTN","PRCARFD1",10,0)
 L +^PRCA(430,PRCABN):1 Q:'$T  S $P(^PRCA(430,PRCABN,9),U,2)=PRCANM,$P(^(9),U,1)=DUZ,$P(^(9),U,3)=$G(DT) L -^PRCA(430,PRCABN) W !," <APPROVED BY CERTIFYING OFFICER>"
"RTN","PRCARFD1",11,0)
 I $G(^PRCA(430,PRCABN,7))'>0 W !!,*7,"This Accounts Receivable doesn't have an excess payment !" D CANC^PRCARFD(PRCABN) W !!,"Status Changed to 'CANCELLATION'",! Q
"RTN","PRCARFD1",12,0)
 W *7,!!,"No other transactions may be made to the bill now."
"RTN","PRCARFD1",13,0)
 ;
"RTN","PRCARFD1",14,0)
FMSDOC ;Create FMS overcollection payment voucher document
"RTN","PRCARFD1",15,0)
 ;
"RTN","PRCARFD1",16,0)
 N %,ADD,GECSFMS,DATE,DEBT,DY,MO,PRCA,PRCANM,STAT,YR,DOC
"RTN","PRCARFD1",17,0)
 I '$D(^PRCA(430,+$G(PRCABN),0)) W !,"THIS BILL NUMBER ENTRY IN FILE 430 IS CORRUPTED",!,"NO PROCESSING CAN CONTINUE - SEE IRM" Q
"RTN","PRCARFD1",18,0)
 S PRCABN0=$G(^PRCA(430,+PRCABN,0)),PRCANM=$P(PRCABN0,"^")
"RTN","PRCARFD1",19,0)
 S STAT=$$GSTAT^RCFMFN02(PRCANM)
"RTN","PRCARFD1",20,0)
 I STAT>0&(STAT<3) W !!,*7,"THIS DOCUMENT SEEMS TO HAVE ALREADY BEEN SENT TO FMS-",!,"IT CANNOT BE RESENT UNLESS FMS REJECTS IT." Q
"RTN","PRCARFD1",21,0)
FMS W !!,"Creating an FMS Overcollection Payment Voucher . . .",!
"RTN","PRCARFD1",22,0)
 S PRCA("STN")=$P($P(PRCABN0,U),"-")
"RTN","PRCARFD1",23,0)
 S DEBT=+$P(PRCABN0,U,9),DEBT=$P($G(^RCD(340,DEBT,0)),U)
"RTN","PRCARFD1",24,0)
 S PRCA("VNAME")=$$NAM^RCFN01(DEBT) I PRCA("VNAME")="" S ADD=0
"RTN","PRCARFD1",25,0)
 S PRCA("VNAME")=$P(PRCA("VNAME"),",",2)_" "_$P(PRCA("VNAME"),",")
"RTN","PRCARFD1",26,0)
 S PRCA("VCODE")=$$SSN^RCFN01(DEBT)
"RTN","PRCARFD1",27,0)
 S ADD=1
"RTN","PRCARFD1",28,0)
 S PRCA("ADD")=$$DADD^RCAMADD(DEBT,1)
"RTN","PRCARFD1",29,0)
 S PRCA("VADD1")=$P(PRCA("ADD"),U) I PRCA("VADD1")="" S ADD=0
"RTN","PRCARFD1",30,0)
 S PRCA("VADD2")=$P(PRCA("ADD"),U,2)
"RTN","PRCARFD1",31,0)
 S PRCA("VCITY")=$P(PRCA("ADD"),U,4) I PRCA("VCITY")="" S ADD=0
"RTN","PRCARFD1",32,0)
 S PRCA("VSTATE")=$P(PRCA("ADD"),U,5) I PRCA("VSTATE")="" S ADD=0
"RTN","PRCARFD1",33,0)
 S PRCA("VZIP")=$P(PRCA("ADD"),U,6) I PRCA("VZIP")="" S ADD=0
"RTN","PRCARFD1",34,0)
 S PRCA("LAMT")=$P($G(^PRCA(430,+PRCABN,7)),U,18)
"RTN","PRCARFD1",35,0)
 S PRCANM=$P($G(^PRCA(430,+PRCABN,0)),U)
"RTN","PRCARFD1",36,0)
 I 'ADD D  Q
"RTN","PRCARFD1",37,0)
 .W *7,!,"THIS PATIENT DOES NOT HAVE A VALID ADDRESS."
"RTN","PRCARFD1",38,0)
 .W !,"AN FMS DOCUMENT CANNOT BE CREATED WITHOUT A VALID ADDRESS."
"RTN","PRCARFD1",39,0)
 .Q
"RTN","PRCARFD1",40,0)
 I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !!,"   * * * * Transmission will be held until "_Y_" * * * *",!
"RTN","PRCARFD1",41,0)
 D NOW^%DTC S YR=$E(%,2,3),MO=$E(%,4,5),DY=$E(%,6,7)
"RTN","PRCARFD1",42,0)
 S Y=$P(%,".") X ^DD("DD") S DATE=$P(Y,",",2)_MO_DY
"RTN","PRCARFD1",43,0)
 S TIME=$P(%,".",2)
"RTN","PRCARFD1",44,0)
 S PRCA("FY")=$$FY^RCFN01($P(%,"."))
"RTN","PRCARFD1",45,0)
 S PRCA("LAMT")=$J(PRCA("LAMT"),0,2)
"RTN","PRCARFD1",46,0)
 D CONTROL^GECSUFMS("A",PRCA("STN"),PRCANM,"OP",10,0,"","")
"RTN","PRCARFD1",47,0)
 ;S FMSTRING("CTL")="CTL^FMS^"_PRCA("STN")^DOC^OP^10^^"_PRCA("STN")_PRCA("FY")_SEQ_U_YYYYMMDD_U_TIME_U_SEQ_U_PRCANM_"^ARS"_PRCA("STN")_U_VER
"RTN","PRCARFD1",48,0)
 I '$D(GECSFMS("DA")) W !,"AN ENTRY WAS NOT MADE IN THE STACKER FILE.",!,"PLEASE RE-SELECT THE BILL IN THE APPROVE OPTION." Q
"RTN","PRCARFD1",49,0)
 S DOC=$S($G(GECSFMS("DOC"))]"":$P(GECSFMS("DOC"),"^",3)_"-"_$P(GECSFMS("DOC"),"^",4),1:PRCANM)
"RTN","PRCARFD1",50,0)
 D OPEN^RCFMDRV1(DOC,5,"B"_PRCABN,.ENT,.ERROR,PRCABN)
"RTN","PRCARFD1",51,0)
 I ERROR]"" W !!,*7,"AN AR DOC REF CANNOT BE CREATED BECAUSE THE FOLLOWING ERROR HAS OCCURRED -",!?10,ERROR,!
"RTN","PRCARFD1",52,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCARFD1",53,0)
 S ^TMP($J,"PRCA",1)="PV2^"_$E(FMSDT,4,5)_U_$E(FMSDT,6,7)_U_$E(FMSDT,2,3)_"^^^^^E^01^^^^^^^^^^MISCVET^^"_PRCA("LAMT")_"^"
"RTN","PRCARFD1",54,0)
 S ^TMP($J,"PRCA",2)=PRCA("VNAME")_U_$E(PRCA("VADD1"),1,30)_U_$E(PRCA("VADD2"),1,30)_U_PRCA("VCITY")_U_PRCA("VSTATE")_U_PRCA("VZIP")_"^~"
"RTN","PRCARFD1",55,0)
 D
"RTN","PRCARFD1",56,0)
 . N PRCAPT
"RTN","PRCARFD1",57,0)
 . S PRCAPT=$S(DT<3030926:5287,$G(REFMS)&(DT<3031001):5287,DT'<3030926&(DT<$$ADDPTEDT^PRCAACC()):5287.3,1:528703)
"RTN","PRCARFD1",58,0)
 .S ^TMP($J,"PRCA",3)="LIN^~PVA^001^^^^^^^^^^^"_PRCA("FY")_"^^"_PRCAPT_"^"_PRCA("STN")_"^^^^^^^^^^^"_$$CALCRSC^RCXFMSUR(+PRCABN)_"^^^^^^"_PRCA("LAMT")_"^I^~"
"RTN","PRCARFD1",59,0)
 .;S ^TMP($J,"PRCA",3)="LIN^~PVA^001^^^^^^^^^^^"_PRCA("FY")_"^^"_$S(DT<3030926:5287,$G(REFMS)&(DT<3031001):5287,1:528703)_"^"_PRCA("STN")_"^^^^^^^^^^^"_$$CALCRSC^RCXFMSUR(+PRCABN)_"^^^^^^"_PRCA("LAMT")_"^I^~"
"RTN","PRCARFD1",60,0)
 S DA=0 F  S DA=$O(^TMP($J,"PRCA",DA)) Q:'DA  D
"RTN","PRCARFD1",61,0)
 .D SETCS^GECSSTAA(GECSFMS("DA"),^TMP($J,"PRCA",DA))
"RTN","PRCARFD1",62,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCARFD1",63,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCARFD1",64,0)
 D SSTAT^RCFMFN02("B"_+$G(PRCABN),1)
"RTN","PRCARFD1",65,0)
 Q:$P($G(^PRCA(430,+$G(PRCABN),0)),U,8)=$O(^PRCA(430.3,"AC",41,0))
"RTN","PRCARFD1",66,0)
 K ^TMP($J)
"RTN","PRCARFD1",67,0)
 ;Pass to FMS
"RTN","PRCARFD1",68,0)
 ;Call generic interface to setup document if completed flag proceed
"RTN","PRCARFD1",69,0)
 ;change date if resent to FMS
"RTN","PRCARFD1",70,0)
 ;
"RTN","PRCARFD1",71,0)
TREF ;Create REFUNDED transaction and set to REFUNDED status
"RTN","PRCARFD1",72,0)
 N DIE,DR,DA,PRCASVC,PRCAA2,PRCAEN,PRCAMT,X,Y,DIR,DEBTOR,CLYRRF
"RTN","PRCARFD1",73,0)
 S U="^"
"RTN","PRCARFD1",74,0)
 I $P($G(^PRCA(430,+PRCABN,0)),U,8)=$O(^PRCA(430.3,"AC",120,0)) Q
"RTN","PRCARFD1",75,0)
 D SETTR^PRCAUTL I '$G(PRCAEN) W !!,"COULD NOT SET UP A REFUND TRANSACTION!" Q
"RTN","PRCARFD1",76,0)
 W !!,"Creating a REFUNDED transaction for bill number: ",$P(^PRCA(430,PRCABN,0),"^")," . . .",!
"RTN","PRCARFD1",77,0)
 D PATTR^PRCAUTL S PRCA("ADJ")=$O(^PRCA(430.3,"AC",120,0)),PRCASV("BDT")=$G(DT),PRCASV("APR")=DUZ,PRCASV("FY")="^"_+$P($G(^PRCA(430,PRCABN,7)),U,18)
"RTN","PRCARFD1",78,0)
 S DIE="^PRCA(433,",DR="[PRCA FY ADJ2 BATCH]",DA=PRCAEN D ^DIE
"RTN","PRCARFD1",79,0)
 S PRCAMT=-$G(PRCAMT),PRCAA2=$P(^PRCA(433,PRCAEN,4,0),U,3)
"RTN","PRCARFD1",80,0)
 D UPFY^PRCADJ,TRANUP^PRCAUTL
"RTN","PRCARFD1",81,0)
 S $P(^PRCA(430,PRCABN,7),U,1)=$G(^PRCA(430,PRCABN,7))+PRCAMT,PRCA("STATUS")=$O(^PRCA(430.3,"AC",120,0)) D UPSTATS^PRCAUT2
"RTN","PRCARFD1",82,0)
 W !,"Bill is now in REFUNDED status.",!
"RTN","PRCARFD1",83,0)
 ;CHECK TO SEE IF TOP REFUND AND SET UP FIELDS TO SEND WITH NEXT
"RTN","PRCARFD1",84,0)
 ;TOP TRANSMISSION
"RTN","PRCARFD1",85,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Is this a TOP Refund",DIR("??")="Enter 'YES' only if this is a refund of a payment from TOP"
"RTN","PRCARFD1",86,0)
 D ^DIR Q:'Y
"RTN","PRCARFD1",87,0)
 S DEBTOR=$P(^PRCA(430,PRCABN,0),U,9) Q:'DEBTOR
"RTN","PRCARFD1",88,0)
 S TRACE=$P($G(^RCD(340,DEBTOR,6)),U,7)
"RTN","PRCARFD1",89,0)
 I $L(TRACE)'=10 W !,*7,"There is no valid trace number entered for this debtor",!,"Cannot process as TOP refund." Q
"RTN","PRCARFD1",90,0)
 S CLYRRF=$E(DT,1,3)+1700,DA=PRCABN
"RTN","PRCARFD1",91,0)
 S DIE="^PRCA(430,",DR="144//^S X=CLYRRF;142////1;143///^S X=TRACE"
"RTN","PRCARFD1",92,0)
 S DA=PRCABN,DIE("NO^")=1 D ^DIE
"RTN","PRCARFD1",93,0)
 W !,"TOP REFUND DOCUMENT WILL BE SENT WITH NEXT TOP TRANSMISSION"
"RTN","PRCARFD1",94,0)
 Q
"RTN","PRCARFD1",95,0)
 ;
"RTN","RCDPE215")
0^8^B81963105
"RTN","RCDPE215",1,0)
RCDPE215 ;ALB/TMK- SF215 EDI Lockbox Summary Report ;1 Jun 99
"RTN","RCDPE215",2,0)
 ;;4.5;Accounts Receivable;**114,173,220**;Mar 20, 1995
"RTN","RCDPE215",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPE215",4,0)
 Q
"RTN","RCDPE215",5,0)
 ;
"RTN","RCDPE215",6,0)
 ;
"RTN","RCDPE215",7,0)
SUMM215 ;  summary 215
"RTN","RCDPE215",8,0)
 D FULL^VALM1
"RTN","RCDPE215",9,0)
 S VALMBCK="R"
"RTN","RCDPE215",10,0)
 ;
"RTN","RCDPE215",11,0)
 N %,%ZIS,POP,RCDEPTDA,RCTYPE,DIC,X,Y,ZTSAVE,ZTDESC,ZTSK,ZTRTN
"RTN","RCDPE215",12,0)
 ;
"RTN","RCDPE215",13,0)
 S DIC(0)="AEMQ",DIC="^RCY(344.1,",DIC("A")="Select DEPOSIT: "
"RTN","RCDPE215",14,0)
 D ^DIC K DIC
"RTN","RCDPE215",15,0)
 I Y'>0 Q
"RTN","RCDPE215",16,0)
 S RCDEPTDA=+Y
"RTN","RCDPE215",17,0)
 S RCTYPE=$$GETTYPE^RCDPR215
"RTN","RCDPE215",18,0)
 I RCTYPE="" Q
"RTN","RCDPE215",19,0)
 ;
"RTN","RCDPE215",20,0)
 ; device
"RTN","RCDPE215",21,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP
"RTN","RCDPE215",22,0)
 I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK D ^%ZISC Q
"RTN","RCDPE215",23,0)
 .   S ZTDESC="Print Summary 215 Report",ZTRTN="DQ^RCDPE215"
"RTN","RCDPE215",24,0)
 .   S ZTSAVE("RCDEPTDA")="",ZTSAVE("RCTYPE")="",ZTSAVE("ZTREQ")="@"
"RTN","RCDPE215",25,0)
 W !!,"<*> please wait <*>"
"RTN","RCDPE215",26,0)
 D DQ
"RTN","RCDPE215",27,0)
 Q
"RTN","RCDPE215",28,0)
 ;
"RTN","RCDPE215",29,0)
DQ ;  queued report entrypoint
"RTN","RCDPE215",30,0)
 ;  RCDEPTDA = ien of the deposit to summarize
"RTN","RCDPE215",31,0)
 ;  RCTYPE="D"etail or "A"ccrual
"RTN","RCDPE215",32,0)
 N %I,AMOUNT,BILL,BILLDA,COMMENTS,COUNT,DA,DATA,DEPOSIT,FMSDOCNO,FUND,NOW,PAGE,PIECE,PRINTOTL,RCSTFLAG,RCYLINE,RECEIPT,SCREEN,TOTAL,TOTLAMT,UNAPPLY,X,Y,RCDETAIL,PCT,RECEIPDA,TOT,EDITOT,DETAIL,Z,EFTFUND
"RTN","RCDPE215",33,0)
 ;
"RTN","RCDPE215",34,0)
 ;  calculate report
"RTN","RCDPE215",35,0)
 K ^TMP($J,"RCFMSCR"),^TMP($J,"RCFMSCR_SUM"),^TMP($J,"RCDPR215"),^TMP($J,"RCDET")
"RTN","RCDPE215",36,0)
 S EFTFUND=$S(DT<$$ADDPTEDT^PRCAACC():"5287.4/8NZZ",1:"528704/8NZZ")
"RTN","RCDPE215",37,0)
 S DEPOSIT=$P($G(^RCY(344.1,RCDEPTDA,0)),U)
"RTN","RCDPE215",38,0)
 S RECEIPDA=0 F  S RECEIPDA=$O(^RCY(344,"AD",RCDEPTDA,RECEIPDA)) Q:'RECEIPDA  D
"RTN","RCDPE215",39,0)
 . D FMSLINES^RCXFMSC1(RECEIPDA)
"RTN","RCDPE215",40,0)
 . ; sort by Receipt #
"RTN","RCDPE215",41,0)
 . S ^TMP($J,"RCFMSCR_SUM",RECEIPDA)=""
"RTN","RCDPE215",42,0)
 . M ^TMP($J,"RCFMSCR_SUM",RECEIPDA)=^TMP($J,"RCFMSCR")
"RTN","RCDPE215",43,0)
 . K ^TMP($J,"RCFMSCR")
"RTN","RCDPE215",44,0)
 . I $$EDILB^RCDPEU(RECEIPDA)=1 D  ; EFT dep receipt
"RTN","RCDPE215",45,0)
 .. S TOT=0
"RTN","RCDPE215",46,0)
 .. S Z=0 F  S Z=$O(^RCY(344,RECEIPDA,1,Z)) Q:'Z  S TOT=TOT+$P($G(^(Z,0)),U,4)
"RTN","RCDPE215",47,0)
 .. S (^TMP($J,"RCFMSCR_SUM",RECEIPDA,EFTFUND),^TMP($J,"RCTOT","EDILBOX"))=TOT
"RTN","RCDPE215",48,0)
 ;
"RTN","RCDPE215",49,0)
 ;  summary rep for a deposit
"RTN","RCDPE215",50,0)
 S PAGE=0,RCYLINE="",$P(RCYLINE,"-",81)=""
"RTN","RCDPE215",51,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y
"RTN","RCDPE215",52,0)
 S SCREEN=0 I '$D(ZTQUEUED),IO=IO(0),$E(IOST)="C" S SCREEN=1
"RTN","RCDPE215",53,0)
 U IO
"RTN","RCDPE215",54,0)
 K ^TMP($J,"RCTOT")
"RTN","RCDPE215",55,0)
 S RCDETAIL=1,PCT=0,EDITOT=0
"RTN","RCDPE215",56,0)
 S RECEIPDA=0 F  S RECEIPDA=$O(^TMP($J,"RCFMSCR_SUM",RECEIPDA)) Q:'RECEIPDA  D
"RTN","RCDPE215",57,0)
 . S DATA=$G(^RCY(344,RECEIPDA,0))
"RTN","RCDPE215",58,0)
 . S RECEIPT=$P(DATA,"^")
"RTN","RCDPE215",59,0)
 . S FMSDOCNO=$P($G(^RCY(344.1,+$P(DATA,"^",6),2)),"^")
"RTN","RCDPE215",60,0)
 . D SET("<NP>",RECEIPT_"@"_FMSDOCNO_"@"_RECEIPDA,.PCT)
"RTN","RCDPE215",61,0)
 . ;
"RTN","RCDPE215",62,0)
 . S TOTAL=""  ;  stores printotal^inttotal^admintotal^marshtotal^cctotal
"RTN","RCDPE215",63,0)
 . ;
"RTN","RCDPE215",64,0)
 . S FUND="" F  S FUND=$O(^TMP($J,"RCFMSCR_SUM",RECEIPDA,FUND)) Q:'FUND  D
"RTN","RCDPE215",65,0)
 ..   D SET("!!?5","Appropriation: "_FUND,.PCT)
"RTN","RCDPE215",66,0)
 ..   I RCTYPE="D" D SET("!","",.PCT)
"RTN","RCDPE215",67,0)
 ..   ;
"RTN","RCDPE215",68,0)
 ..   S PRINTOTL=0
"RTN","RCDPE215",69,0)
 ..   S COUNT=0
"RTN","RCDPE215",70,0)
 ..   I FUND=EFTFUND S PRINTOTL=PRINTOTL+$G(^TMP($J,"RCFMSCR_SUM",RECEIPDA,FUND)),EDITOT=EDITOT+$G(^TMP($J,"RCFMSCR_SUM",RECEIPDA,FUND))
"RTN","RCDPE215",71,0)
 ..   S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCFMSCR_SUM",RECEIPDA,FUND,BILLDA)) Q:'BILLDA  D
"RTN","RCDPE215",72,0)
 ...   S COUNT=COUNT+1
"RTN","RCDPE215",73,0)
 ...   S BILL=$P($G(^PRCA(430,BILLDA,0)),"^")
"RTN","RCDPE215",74,0)
 ...   S DATA=^TMP($J,"RCFMSCR_SUM",RECEIPDA,FUND,BILLDA)
"RTN","RCDPE215",75,0)
 ...   S PRINTOTL=PRINTOTL+$P(DATA,"^")
"RTN","RCDPE215",76,0)
 ...   F PIECE=1:1:5 S $P(TOTAL,"^",PIECE)=$P(TOTAL,"^",PIECE)+$P(DATA,"^",PIECE),$P(^TMP($J,"RCTOT","TOTAL"),"^",PIECE)=$P($G(^TMP($J,"RCTOT","TOTAL")),"^",PIECE)+$P(DATA,"^",PIECE)
"RTN","RCDPE215",77,0)
 ...   ;  if accrued report,no detail
"RTN","RCDPE215",78,0)
 ...   I RCTYPE="A" Q
"RTN","RCDPE215",79,0)
 ...   ;
"RTN","RCDPE215",80,0)
 ...   D SET("!?5",COUNT_")",.PCT),SET("?10",BILL,.PCT),SET("?30",$J($P(DATA,"^"),10,2),.PCT),SET("?45","DEBTOR: "_$E($$DEBTOR^RCDPR215(BILLDA),1,25),.PCT)
"RTN","RCDPE215",81,0)
 ...   D SET("!?15","INT:"_$J($P(DATA,"^",2),10,2)_" ADMIN:"_$J($P(DATA,"^",3),10,2)_" MARS: "_$J($P(DATA,"^",4),10,2)_" CC: "_$J($P(DATA,"^",5),10,2),.PCT,1)
"RTN","RCDPE215",82,0)
 ..   ;
"RTN","RCDPE215",83,0)
 ..   I RCTYPE="D" D SET("!?30","----------",.PCT),SET("!?5","TOTAL for "_FUND,.PCT)
"RTN","RCDPE215",84,0)
 ..   D SET("?30",$J(PRINTOTL,10,2),.PCT)
"RTN","RCDPE215",85,0)
 ..   I FUND="0160a1" D SET("?45","0160a1 sub-totals Champva receipts",.PCT),SET("!?45","not sent to FMS on the CR document.",.PCT)
"RTN","RCDPE215",86,0)
 ..   S ^TMP($J,"RCTOT","PRINTOTL",FUND)=$G(^TMP($J,"RCTOT","PRINTOTL",FUND))+PRINTOTL
"RTN","RCDPE215",87,0)
 ..   I FUND=EFTFUND S $P(^TMP($J,"RCTOT","TOTAL"),U)=$P($G(^TMP($J,"RCTOT","TOTAL")),U)+PRINTOTL
"RTN","RCDPE215",88,0)
 . ;
"RTN","RCDPE215",89,0)
 . ;  show int, admin, etc receipt totals
"RTN","RCDPE215",90,0)
 . D SET("!","",.PCT)
"RTN","RCDPE215",91,0)
 . D SET("!?5","INTEREST : (APP: 1435)",.PCT),SET("?30",$J($P(TOTAL,"^",2),10,2),.PCT)
"RTN","RCDPE215",92,0)
 . D SET("!?5","ADMIN    : (APP: 3220)",.PCT),SET("?30",$J($P(TOTAL,"^",3),10,2),.PCT)
"RTN","RCDPE215",93,0)
 . D SET("!?5","MARSHALL : (APP: 0869)",.PCT),SET("?30",$J($P(TOTAL,"^",4),10,2),.PCT)
"RTN","RCDPE215",94,0)
 . D SET("!?5","COURTCOST: (APP: 0869)",.PCT),SET("?30",$J($P(TOTAL,"^",5),10,2),.PCT)
"RTN","RCDPE215",95,0)
 . D SET("!?30","----------",.PCT)
"RTN","RCDPE215",96,0)
 . D SET("!?30",$J($P(TOTAL,"^",2)+$P(TOTAL,"^",3)+$P(TOTAL,"^",4)+$P(TOTAL,"^",5),10,2),.PCT)
"RTN","RCDPE215",97,0)
 . ;
"RTN","RCDPE215",98,0)
 . I $G(^TMP($J,"RCFMSCR_SUM",RECEIPDA,EFTFUND)) S $P(TOTAL,U)=$P(TOTAL,U)+^TMP($J,"RCFMSCR_SUM",RECEIPDA,EFTFUND)
"RTN","RCDPE215",99,0)
 . D SUSP(RECEIPDA,RCTYPE,.TOTAL,.PCT)
"RTN","RCDPE215",100,0)
 . ;
"RTN","RCDPE215",101,0)
 . S TOTLAMT=0 F PIECE=1:1:5 S TOTLAMT=TOTLAMT+$P(TOTAL,"^",PIECE)
"RTN","RCDPE215",102,0)
 . D SET("!!","TOTALS: ",.PCT)
"RTN","RCDPE215",103,0)
 . D SET("!?5","TOTAL AMT POSTED FOR RECEIPT:",.PCT),SET("?30",$J(TOTLAMT,10,2),.PCT,1)
"RTN","RCDPE215",104,0)
 ;
"RTN","RCDPE215",105,0)
 D H
"RTN","RCDPE215",106,0)
 W !!,"**** GRAND TOTALS FOR DEPOSIT: "_$P($G(^RCY(344.1,+RCDEPTDA,0)),U)
"RTN","RCDPE215",107,0)
 S TOT=0
"RTN","RCDPE215",108,0)
 S FUND="" F  S FUND=$O(^TMP($J,"RCTOT","PRINTOTL",FUND)) Q:FUND=""  D
"RTN","RCDPE215",109,0)
 . W !!?5,"Appropriation: ",FUND,": ",?35,$J($G(^TMP($J,"RCTOT","PRINTOTL",FUND)),10,2)
"RTN","RCDPE215",110,0)
 . S TOT=TOT+$G(^TMP($J,"RCTOT","PRINTOTL",FUND))
"RTN","RCDPE215",111,0)
 W !,?35,"=============",!,"Total Appropriation: ",?35,$J(+TOT,10,2)
"RTN","RCDPE215",112,0)
 I FUND="0160a1" W ?47,"0160a1 sub-totals Champva receipts",!?47,"not sent to FMS on the CR doc."
"RTN","RCDPE215",113,0)
 ;
"RTN","RCDPE215",114,0)
 S TOTAL=$G(^TMP($J,"RCTOT","TOTAL"))
"RTN","RCDPE215",115,0)
 W !
"RTN","RCDPE215",116,0)
 W !?5,"INTEREST : (APP: 1435)",?35,$J($P(TOTAL,"^",2),10,2)
"RTN","RCDPE215",117,0)
 W !?5,"ADMIN    : (APP: 3220)",?35,$J($P(TOTAL,"^",3),10,2)
"RTN","RCDPE215",118,0)
 W !?5,"MARSHALL : (APP: 0869)",?35,$J($P(TOTAL,"^",4),10,2)
"RTN","RCDPE215",119,0)
 W !?5,"COURTCOST: (APP: 0869)",?35,$J($P(TOTAL,"^",5),10,2)
"RTN","RCDPE215",120,0)
 W !?35,"----------"
"RTN","RCDPE215",121,0)
 W !?35,$J($P(TOTAL,"^",2)+$P(TOTAL,"^",3)+$P(TOTAL,"^",4)+$P(TOTAL,"^",5),10,2)
"RTN","RCDPE215",122,0)
 I $G(^TMP($J,"RCTOT","SUSPENSE")) W !!?5,"Total Appropriation: 3875",?35,$J(^TMP($J,"RCTOT","SUSPENSE"),10,2)
"RTN","RCDPE215",123,0)
 ;
"RTN","RCDPE215",124,0)
 S TOTLAMT=0 F PIECE=1:1:5 S TOTLAMT=TOTLAMT+$P(TOTAL,"^",PIECE)
"RTN","RCDPE215",125,0)
 I $G(^TMP($J,"RCTOT","EDILBOX")) S TOTLAMT=TOTLAMT+^TMP($J,"RCTOT","EDILBOX")
"RTN","RCDPE215",126,0)
 W !!,"TOTALS: "
"RTN","RCDPE215",127,0)
 W !?5,"TOT AMT POSTED FOR DEPOSIT: ",?35,$J(+TOTLAMT,10,2)
"RTN","RCDPE215",128,0)
 I SCREEN D PAUSE G:$G(RCSTFLAG) Q
"RTN","RCDPE215",129,0)
 N Q,W,T,NS
"RTN","RCDPE215",130,0)
 S W=""
"RTN","RCDPE215",131,0)
 S PCT=0 F  S PCT=$O(^TMP($J,"RCDET",PCT)) Q:'PCT  D  G:$G(RCSTFLAG) Q
"RTN","RCDPE215",132,0)
 . S Q=$P($G(^TMP($J,"RCDET",PCT)),U),T=$P($G(^(PCT)),U,2),NS=$P($G(^(PCT)),U,3)
"RTN","RCDPE215",133,0)
 . I Q="<NP>" D  Q
"RTN","RCDPE215",134,0)
 .. I W'="" W @W S W="" D:SCREEN PAUSE Q:$G(RCSTFLAG)
"RTN","RCDPE215",135,0)
 .. S RECEIPT=$P(T,"@"),FMSDOCNO=$P(T,"@",2),RECEIPDA=$P(T,"@",3)
"RTN","RCDPE215",136,0)
 .. D H,H1(0)
"RTN","RCDPE215",137,0)
 . I $E(Q)="!" W:W'="" @W S W=""
"RTN","RCDPE215",138,0)
 . S W=W_$S(W="":"",1:",")_Q_$S(Q'="":",",1:"")_""""_T_""""
"RTN","RCDPE215",139,0)
 . I 'NS,$Y>(IOSL-6) D:SCREEN PAUSE I '$G(RCSTFLAG) D H,H1(1)
"RTN","RCDPE215",140,0)
 I W'="" W @W S W=""
"RTN","RCDPE215",141,0)
 I SCREEN W !,"Press RETURN to continue: " R X:DTIME
"RTN","RCDPE215",142,0)
 ;
"RTN","RCDPE215",143,0)
Q D ^%ZISC
"RTN","RCDPE215",144,0)
 K ^TMP($J,"RCFMSCR"),^TMP($J,"RCDPR215"),^TMP($J,"RCTOT"),^TMP($J,"RCFMSCR_SUM"),^TMP($J,"RCDET")
"RTN","RCDPE215",145,0)
 Q
"RTN","RCDPE215",146,0)
 ;
"RTN","RCDPE215",147,0)
 ;
"RTN","RCDPE215",148,0)
SUSP(RECEIPDA,RCTYPE,TOTAL,PCT) ;  unapplied amts for suspense
"RTN","RCDPE215",149,0)
 ; RCTYPE = see explanation at DQ above
"RTN","RCDPE215",150,0)
 ; Returns PCT,TOTAL if passed by reference
"RTN","RCDPE215",151,0)
 ;
"RTN","RCDPE215",152,0)
 N DA,AMOUNT,UNAPPLY,COUNT,PRINTOTL,COMMENTS
"RTN","RCDPE215",153,0)
 K ^TMP($J,"RCDPR215")
"RTN","RCDPE215",154,0)
 S DA=0 F  S DA=$O(^RCY(344,RECEIPDA,1,DA)) Q:'DA  D
"RTN","RCDPE215",155,0)
 .   S AMOUNT=$P($G(^RCY(344,RECEIPDA,1,DA,0)),"^",4) I 'AMOUNT Q
"RTN","RCDPE215",156,0)
 .   S UNAPPLY=$P($G(^RCY(344,RECEIPDA,1,DA,2)),"^",5) I UNAPPLY="" Q
"RTN","RCDPE215",157,0)
 .   ;  if amount has not been processed, show it in suspense
"RTN","RCDPE215",158,0)
 .   I '$P(^RCY(344,RECEIPDA,1,DA,0),"^",5) S ^TMP($J,"RCDPR215",DA)=UNAPPLY_"^"_AMOUNT_"^"_$P($G(^RCY(344,RECEIPDA,1,DA,1)),"^",2)
"RTN","RCDPE215",159,0)
 ;
"RTN","RCDPE215",160,0)
 I $O(^TMP($J,"RCDPR215",0)) D
"RTN","RCDPE215",161,0)
 .   D SET("!!?5","Appropriation: 3875",.PCT)
"RTN","RCDPE215",162,0)
 .   I RCTYPE="D" D SET("!","",.PCT)
"RTN","RCDPE215",163,0)
 .   ;
"RTN","RCDPE215",164,0)
 .   S COUNT=0,PRINTOTL=0
"RTN","RCDPE215",165,0)
 .   S DA=0 F  S DA=$O(^TMP($J,"RCDPR215",DA)) Q:'DA!($G(RCSTFLAG))  D
"RTN","RCDPE215",166,0)
 .   .   ;
"RTN","RCDPE215",167,0)
 .   .   S UNAPPLY=$P(^TMP($J,"RCDPR215",DA),"^"),AMOUNT=$P(^(DA),"^",2),COMMENTS=$P(^(DA),"^",3)
"RTN","RCDPE215",168,0)
 .   .   S PRINTOTL=PRINTOTL+AMOUNT
"RTN","RCDPE215",169,0)
 .   .   S $P(TOTAL,"^")=$P(TOTAL,"^")+AMOUNT
"RTN","RCDPE215",170,0)
 .   .   ;  no detail if accrued report
"RTN","RCDPE215",171,0)
 .   .   I RCTYPE="A" Q
"RTN","RCDPE215",172,0)
 .   .   ;
"RTN","RCDPE215",173,0)
 .   .   S COUNT=COUNT+1
"RTN","RCDPE215",174,0)
 .   .   D SET("!?5",COUNT_")",.PCT),SET("?10",UNAPPLY,.PCT),SET("?30",$J(AMOUNT,10,2),.PCT),SET("?45","COMMENTS: "_$E(COMMENTS,1,25),.PCT)
"RTN","RCDPE215",175,0)
 .   .   I $TR($E(COMMENTS,26,80)," ")'="" D SET("!?25",$E(COMMENTS,26,80),.PCT)
"RTN","RCDPE215",176,0)
 .   ;
"RTN","RCDPE215",177,0)
 .   S $P(^TMP($J,"RCTOT","TOTAL"),U)=($P($G(^TMP($J,"RCTOT","TOTAL")),U)+PRINTOTL)
"RTN","RCDPE215",178,0)
 .   I RCTYPE="D" D SET("!?30","----------",.PCT),SET("!?5","TOTAL for 3875",.PCT)
"RTN","RCDPE215",179,0)
 .   D SET("?30",$J(PRINTOTL,10,2),.PCT)
"RTN","RCDPE215",180,0)
 .   S ^TMP($J,"RCTOT","SUSPENSE")=$G(^TMP($J,"RCTOT","SUSPENSE"))+PRINTOTL
"RTN","RCDPE215",181,0)
 Q
"RTN","RCDPE215",182,0)
 ;
"RTN","RCDPE215",183,0)
 ;
"RTN","RCDPE215",184,0)
GETTYPE() ;  ask type of report to print
"RTN","RCDPE215",185,0)
 N DIR,X,Y
"RTN","RCDPE215",186,0)
 S DIR(0)="S^A:ACCRUED;D:DETAILED",DIR("A")="ACCRUED OR DETAILED REPORT",DIR("B")="ACCRUED",DIR("?")="A DETAILED Report will list out accrued bills separately"
"RTN","RCDPE215",187,0)
 S DIR("?",1)="An ACCRUED Report will list just the accrued total under each appropriation"
"RTN","RCDPE215",188,0)
 D ^DIR
"RTN","RCDPE215",189,0)
 I Y'="A",Y'="D" Q ""
"RTN","RCDPE215",190,0)
 Q Y
"RTN","RCDPE215",191,0)
 ;
"RTN","RCDPE215",192,0)
 ;
"RTN","RCDPE215",193,0)
H ;  Deposit hdr
"RTN","RCDPE215",194,0)
 N Z
"RTN","RCDPE215",195,0)
 S PAGE=PAGE+1 I PAGE'=1!(SCREEN) W @IOF
"RTN","RCDPE215",196,0)
 W $C(13),"Page ",PAGE,?(80-$L(NOW)),NOW
"RTN","RCDPE215",197,0)
 W !,$E($TR(RCYLINE,"-","*"),1,26)," 215 DEPOSIT SUMMARY REPORT ",$E($TR(RCYLINE,"-","*"),1,26)
"RTN","RCDPE215",198,0)
 W !!,"DEPOSIT #: ",DEPOSIT
"RTN","RCDPE215",199,0)
 W !,RCYLINE
"RTN","RCDPE215",200,0)
 Q
"RTN","RCDPE215",201,0)
 ;
"RTN","RCDPE215",202,0)
H1(CONT) ; Receipt Hdr
"RTN","RCDPE215",203,0)
 ; CONT = 1 if continuation from previous page
"RTN","RCDPE215",204,0)
 ;
"RTN","RCDPE215",205,0)
 N Z
"RTN","RCDPE215",206,0)
 W !!,"RECEIPT #: "_RECEIPT_$S($G(CONT):" (continued)",1:"")
"RTN","RCDPE215",207,0)
 I FMSDOCNO'="" W ?51,"FMS Document #: ",FMSDOCNO
"RTN","RCDPE215",208,0)
 S Z="",$P(Z,"-",$L(RECEIPT)+1)=""
"RTN","RCDPE215",209,0)
 W !,?11,Z
"RTN","RCDPE215",210,0)
 S Z=""
"RTN","RCDPE215",211,0)
 I $P($G(^RCY(344,RECEIPDA,0)),U,18) S Z=$E(" REFERENCE ERA #: "_$P($G(^RCY(344.4,+$P($G(^RCY(344,RECEIPDA,0)),U,18),0)),U)_" ("_$P($G(^RCY(344.4,+$P($G(^RCY(344,RECEIPDA,0)),U,18),0)),U,2)_")"_$J("",51),1,51)
"RTN","RCDPE215",212,0)
 I Z'="" W !,Z
"RTN","RCDPE215",213,0)
 W !
"RTN","RCDPE215",214,0)
 Q
"RTN","RCDPE215",215,0)
 ;
"RTN","RCDPE215",216,0)
 ;
"RTN","RCDPE215",217,0)
PAUSE ;
"RTN","RCDPE215",218,0)
 D PAUSE^RCDPR215
"RTN","RCDPE215",219,0)
 Q
"RTN","RCDPE215",220,0)
 ;
"RTN","RCDPE215",221,0)
SET(CTRL,TXT,PCT,NOSP) ; Sets print array for detail
"RTN","RCDPE215",222,0)
 ;PCT = count of lines
"RTN","RCDPE215",223,0)
 ;CTRL = Control characters
"RTN","RCDPE215",224,0)
 ;TXT = text to print
"RTN","RCDPE215",225,0)
 ;NOSP = 1 if line should always print with the previous line
"RTN","RCDPE215",226,0)
 S PCT=PCT+1,^TMP($J,"RCDET",PCT)=CTRL_U_TXT_U_+$G(NOSP)
"RTN","RCDPE215",227,0)
 Q
"RTN","RCDPE215",228,0)
 ;
"RTN","RCDPEM0")
0^21^B51750344
"RTN","RCDPEM0",1,0)
RCDPEM0 ;ALB/TMK - ERA MATCHING TO EFT (cont) ;05-NOV-02
"RTN","RCDPEM0",2,0)
 ;;4.5;Accounts Receivable;**173,208,220**;Mar 20, 1995
"RTN","RCDPEM0",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPEM0",4,0)
 Q
"RTN","RCDPEM0",5,0)
 ;
"RTN","RCDPEM0",6,0)
MATCH(RCZ,RCPROC) ; Match EFT to ERA
"RTN","RCDPEM0",7,0)
 ; RCZ = ien of file 344.31
"RTN","RCDPEM0",8,0)
 ; RCPROC = 1 if called from EFT-EOB automatch, 0 if from manual match
"RTN","RCDPEM0",9,0)
 N RCER,RCRZ,RCMATCH,RCER,RC0,RC3444,RC34431,DIE,DA,DR,X,Y,Z,Z0
"RTN","RCDPEM0",10,0)
 ; Find ERA to match to EFT by trace, date, amt
"RTN","RCDPEM0",11,0)
 S RC34431=$G(^RCY(344.31,RCZ,0)) Q:$P(RC34431,U,8)!$O(^RCY(344,"AEFT",RCZ,0))  ; Already matched
"RTN","RCDPEM0",12,0)
 S RCRZ=0 F  S RCRZ=$O(^RCY(344.4,"ATRID",$P(RC34431,U,4),$P(RC34431,U,3),RCRZ)) Q:'RCRZ  S RC3444=$G(^RCY(344.4,RCRZ,0)) I '$O(^RCY(344.31,"AERA",RCRZ,0)),'$P(RC3444,U,9) D  Q:$D(Z(1))
"RTN","RCDPEM0",13,0)
 . S Z($S(+$P(RC34431,U,7)=+$P(RC3444,U,5):1,1:-1),RCRZ)="" ;Total match?
"RTN","RCDPEM0",14,0)
 ;
"RTN","RCDPEM0",15,0)
 S RCMATCH=+$O(Z(""),-1),RCRZ=+$O(Z(RCMATCH,0))
"RTN","RCDPEM0",16,0)
 S $P(^TMP($J,"RCDPETOT",344.31,RCZ),U)=RCMATCH
"RTN","RCDPEM0",17,0)
 ;
"RTN","RCDPEM0",18,0)
 I 'RCMATCH D  Q  ; Match failure
"RTN","RCDPEM0",19,0)
 . S ^TMP($J,"RCTOT","NO_MATCH")=$G(^TMP($J,"RCTOT","NO_MATCH"))+1
"RTN","RCDPEM0",20,0)
 ;
"RTN","RCDPEM0",21,0)
 I RCMATCH<0 D
"RTN","RCDPEM0",22,0)
 . ; Bulletin for totals don't match warning
"RTN","RCDPEM0",23,0)
 . S ^TMP($J,"RCTOT","TOTMIS")=$G(^TMP($J,"RCTOT","TOTMIS"))+1
"RTN","RCDPEM0",24,0)
 . N XMSUBJ,XMBODY,XMB,XMINSTR,XMTYPE,XMFULL,XMTO,XMZ,XMERR,RCER,RCT,RCM,RCLESS
"RTN","RCDPEM0",25,0)
 . S RCT=0
"RTN","RCDPEM0",26,0)
 . D BLD^RCDPEM1("RCER",.RCT,344.31,RC34431)
"RTN","RCDPEM0",27,0)
 . S RCT=RCT+1,RCER(RCT)=""
"RTN","RCDPEM0",28,0)
 . K RCM S RCM=RCT
"RTN","RCDPEM0",29,0)
 . S RCLESS=($P(RC34431,U,7)<$P($G(^RCY(344.4,RCRZ,0)),U,5))
"RTN","RCDPEM0",30,0)
 . S RCT=RCT+1,RCER(RCT)="  TOTALS ON ERA AND EFT DON'T MATCH.",RCT=RCT+1,RCER(RCT)="  EFT TOTAL IS "_$S(RCLESS:"LESS",1:"GREATER")_" THAN ERA AMOUNT TOTAL"
"RTN","RCDPEM0",31,0)
 . I RCLESS D
"RTN","RCDPEM0",32,0)
 .. S RCT=RCT+1,RCER(RCT)="  DECREASE ADJUSTMENT IS NEEDED BEFORE THE ERA RECEIPT CAN BE PROCESSED."
"RTN","RCDPEM0",33,0)
 . I 'RCLESS D
"RTN","RCDPEM0",34,0)
 .. S RCT=RCT+1,RCER(RCT)="  A SUSPENSE LINE IS NEEDED ON THE RECEIPT TO ACCOUNT FOR THE DIFFERENCE."
"RTN","RCDPEM0",35,0)
 . S RCT=RCT+1,RCER(RCT)="  IF YOU USE THE ERA WORKLIST SCRATCH PAD, THIS WILL BE GENERATED FOR YOU."
"RTN","RCDPEM0",36,0)
 . ;
"RTN","RCDPEM0",37,0)
 . S RCT=RCT+1,RCER(RCT)="  EFT WAS MATCHED TO ERA ENTRY #: "_RCRZ_" ($"_$J(+$P($G(^RCY(344.4,RCRZ,0)),U,5),"",2)_")."
"RTN","RCDPEM0",38,0)
 . S XMTO("I:G.RCDPE PAYMENTS")=""
"RTN","RCDPEM0",39,0)
 . S XMBODY="RCER"
"RTN","RCDPEM0",40,0)
 . S XMSUBJ="EDI LBOX TOTALS MISMATCH ON EFT-ERA MATCH"
"RTN","RCDPEM0",41,0)
 . D
"RTN","RCDPEM0",42,0)
 .. N DUZ S DUZ=.5,DUZ(0)="@"
"RTN","RCDPEM0",43,0)
 .. D SENDMSG^XMXAPI(.5,XMSUBJ,XMBODY,.XMTO,,.XMZ)
"RTN","RCDPEM0",44,0)
 . ; Update log
"RTN","RCDPEM0",45,0)
 . F  S RCM=$O(RCER(RCM)) Q:'RCM  S RCT=RCT+1,RCM(RCT)=RCER(RCM)
"RTN","RCDPEM0",46,0)
 . D STORERR(344.31,RCZ,.RCM)
"RTN","RCDPEM0",47,0)
 ;
"RTN","RCDPEM0",48,0)
 I RCMATCH D
"RTN","RCDPEM0",49,0)
 . S DIE="^RCY(344.31,",DA=RCZ,DR=".08////"_RCMATCH_";.1////"_RCRZ D ^DIE
"RTN","RCDPEM0",50,0)
 . S DIE="^RCY(344.4,",DA=RCRZ,DR=".09////"_RCMATCH D ^DIE
"RTN","RCDPEM0",51,0)
 . S ^TMP($J,"RCTOT","MATCH")=$G(^TMP($J,"RCTOT","MATCH"))+1
"RTN","RCDPEM0",52,0)
 ;
"RTN","RCDPEM0",53,0)
 Q
"RTN","RCDPEM0",54,0)
 ;
"RTN","RCDPEM0",55,0)
ADDDEP(RCD,RCDDT,RCZ) ; Add deposit
"RTN","RCDPEM0",56,0)
 ; RCD = deposit #
"RTN","RCDPEM0",57,0)
 ; RCDDT = deposit date FM format
"RTN","RCDPEM0",58,0)
 ; RCZ = ien of entry in file 344.3
"RTN","RCDPEM0",59,0)
 ; Function returns IEN of new deposit entry
"RTN","RCDPEM0",60,0)
 ;
"RTN","RCDPEM0",61,0)
 N RCDEP,RC0,DIE,DR,DA,X,Y
"RTN","RCDPEM0",62,0)
 S RCDEP=+$$ADDDEPT^RCDPUDEP(RCD,RCDDT)
"RTN","RCDPEM0",63,0)
 I RCDEP D
"RTN","RCDPEM0",64,0)
 . D LOCKDEP^RCDPEM(RCDEP,1)
"RTN","RCDPEM0",65,0)
 . S RC0=$G(^RCY(344.3,RCZ,0))
"RTN","RCDPEM0",66,0)
 . S DIE="^RCY(344.1,",DA=RCDEP,DR=".04////"_+$P(RC0,U,8)_$S($P(RC0,U,4)'="":";.05////"_$P(RC0,U,4),1:"")  D ^DIE
"RTN","RCDPEM0",67,0)
 . S DIE="^RCY(344.3,",DR=".03////"_RCDEP,DA=RCZ D ^DIE
"RTN","RCDPEM0",68,0)
 . S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,5)=RCDEP
"RTN","RCDPEM0",69,0)
 Q RCDEP
"RTN","RCDPEM0",70,0)
 ;
"RTN","RCDPEM0",71,0)
ADDREC(RCDEP,RCZ) ; Add receipt, send CR to FUND 528704, Rev src cd 8NZZ
"RTN","RCDPEM0",72,0)
 ;   for total EFT amt
"RTN","RCDPEM0",73,0)
 ; RCDEP = ien of the deposit file entry
"RTN","RCDPEM0",74,0)
 ; RCZ = ien in file 344.3
"RTN","RCDPEM0",75,0)
 ; Function returns IEN of new receipt entry
"RTN","RCDPEM0",76,0)
 ;
"RTN","RCDPEM0",77,0)
 N RCER,RCTRANDA,RECTDA,RCQUIT,RCDPDATA,RCTOTCT,RC0,DIE,DA,DR,X,Y
"RTN","RCDPEM0",78,0)
 S RC0=$G(^RCY(344.3,RCZ,0))
"RTN","RCDPEM0",79,0)
 S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,3)=0
"RTN","RCDPEM0",80,0)
 ; Single receipt - multiple transactions for EFT payments
"RTN","RCDPEM0",81,0)
 S RECTDA=+$$ADDRECT^RCDPUREC($P(RC0,U,7),RCDEP,+$O(^RC(341.1,"AC",14,0)))
"RTN","RCDPEM0",82,0)
 ; Create detail lines for deposit amount, process whole receipt to send
"RTN","RCDPEM0",83,0)
 ;   CR document for deposit amount
"RTN","RCDPEM0",84,0)
 I RECTDA D
"RTN","RCDPEM0",85,0)
 . N STATUS,RC00,RCT
"RTN","RCDPEM0",86,0)
 . S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U)=RECTDA,^TMP($J,"RCTOT","EFT_RECPT")=$G(^TMP($J,"RCTOT","EFT_RECPT"))+1
"RTN","RCDPEM0",87,0)
 . L +^RCY(344,RECTDA)
"RTN","RCDPEM0",88,0)
 . ;  check to see if receipt has been processed (fms document)
"RTN","RCDPEM0",89,0)
 . D DIQ344^RCDPRPLM(RECTDA,"200;")
"RTN","RCDPEM0",90,0)
 . ;  code sheet already sent once, this is a retransmission, check it
"RTN","RCDPEM0",91,0)
 . I RCDPDATA(344,RECTDA,200,"E")'="" S RCQUIT=0 D  Q:RCQUIT
"RTN","RCDPEM0",92,0)
 .. S STATUS=$$STATUS^GECSSGET(RCDPDATA(344,RECTDA,200,"E"))
"RTN","RCDPEM0",93,0)
 .. ;  okay to continue if status is Error, Rejected, or not defined (-1)
"RTN","RCDPEM0",94,0)
 .. I $E(STATUS)="E"!($E(STATUS)="R")!(STATUS=-1) Q
"RTN","RCDPEM0",95,0)
 .. S RCER(1)=$$SETERR(2),RCER(2)="  Receipt already sent to FMS - No change"
"RTN","RCDPEM0",96,0)
 .. D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM0",97,0)
 .. S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM0",98,0)
 .. D STORERR(344.3,RCZ,.RCER)
"RTN","RCDPEM0",99,0)
 .. L -^RCY(344,RECTDA)
"RTN","RCDPEM0",100,0)
 .. L -^RCY(344.1,RCDEP)
"RTN","RCDPEM0",101,0)
 .. S RCQUIT=1 K RCER
"RTN","RCDPEM0",102,0)
 . ;  mark receipt as processed (closed) to prevent editing
"RTN","RCDPEM0",103,0)
 . D MARKPROC^RCDPUREC(RECTDA,"")
"RTN","RCDPEM0",104,0)
 . S DIE="^RCY(344,",DR=".04////"_+$O(^RC(341.1,"AC",14,0)),DA=RECTDA D ^DIE ; Add EDI Lockbox payment type
"RTN","RCDPEM0",105,0)
 . ;
"RTN","RCDPEM0",106,0)
 . ; Add receipt line for each payer's EFT
"RTN","RCDPEM0",107,0)
 . S RCT=0 F  S RCT=$O(^RCY(344.31,"B",RCZ,RCT)) Q:'RCT  D  Q:$O(RCER(0))
"RTN","RCDPEM0",108,0)
 .. S RC00=$G(^RCY(344.31,RCT,0)),DR=""
"RTN","RCDPEM0",109,0)
 .. S RCTRANDA=$S('$P(RC00,U,14):$$ADDTRAN^RCDPURET(RECTDA),1:$P(RC00,U,14)) ; detail line
"RTN","RCDPEM0",110,0)
 .. I 'RCTRANDA D  Q
"RTN","RCDPEM0",111,0)
 ... S RCER(1)=$$SETERR(2),RCER(2)="  The receipt for the EFT deposit was not created correctly",RCER(3)="  You may have to add the detail manually to send the FMS CR doc to revenue"
"RTN","RCDPEM0",112,0)
 ... S RCER(4)="  source code 8NZZ in fund "_$S(DT<$$ADDPTEDT^PRCAACC():"5287.4",1:"528704")_".  Receipt # is "_$P($G(^RCY(344,RECTDA,0)),U),RCER(5)="  Trace # being processed at time of error was: "_$P(RC00,U,4)_"."
"RTN","RCDPEM0",113,0)
 ... D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM0",114,0)
 ... S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM0",115,0)
 ... D STORERR(344.3,RCZ,.RCER)
"RTN","RCDPEM0",116,0)
 .. ;
"RTN","RCDPEM0",117,0)
 .. S DR=DR_";1.02////Auto added EDI Lockbox deposit;.06////"_$P(RC00,U,12)_";.04////"_$J(+$P(RC00,U,7),"",2)_";.14////"_RCTRANDA
"RTN","RCDPEM0",118,0)
 .. N N S N=+$O(^VA(200,"B","EDILOCKBOX,AUTOMATIC",0)) S:N=0 N=.5
"RTN","RCDPEM0",119,0)
 .. S DR=DR_";.12////"_N
"RTN","RCDPEM0",120,0)
 .. S DA(1)=RECTDA,DA=RCTRANDA,DIE="^RCY(344,"_DA(1)_",1,"
"RTN","RCDPEM0",121,0)
 .. S:$E(DR)=";" DR=$P(DR,";",2,999) D ^DIE
"RTN","RCDPEM0",122,0)
 .. S DR=".14////"_RCTRANDA_";.09////"_RECTDA,DIE="^RCY(344.31,",DA=RCT D ^DIE
"RTN","RCDPEM0",123,0)
 .. ;
"RTN","RCDPEM0",124,0)
 . ;Post to FUND 528704/RSC 8NZZ
"RTN","RCDPEM0",125,0)
 . D PROCESS^RCDPURE1(RECTDA,2)
"RTN","RCDPEM0",126,0)
 . ;Save details for status report
"RTN","RCDPEM0",127,0)
 . N Z,TOT
"RTN","RCDPEM0",128,0)
 . S (TOT,Z)=0 F  S Z=$O(^RCY(344,RECTDA,1,Z)) Q:'Z  S TOT=TOT+$P($G(^RCY(344,RECTDA,1,Z,0)),U,4)
"RTN","RCDPEM0",129,0)
 . S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,2)=TOT
"RTN","RCDPEM0",130,0)
 . ;
"RTN","RCDPEM0",131,0)
 . I $P($G(^RCY(344,RECTDA,2)),U)="" D  ; Receipt not processed fully
"RTN","RCDPEM0",132,0)
 .. N CT,Z
"RTN","RCDPEM0",133,0)
 .. S RCER(1)=$$SETERR(2),RCER(2)="  The receipt "_$P($G(^RCY(344,RECTDA,0)),U)_" for the EFT deposit was not processed fully" S:TOT RCER(3)="  You must manually process it to create the FMS CR doc to rev src code 8NZZ"
"RTN","RCDPEM0",134,0)
 .. S Z=0,CT=+$O(RCER(" "),-1) F  S Z=$O(^TMP($J,"RCDPEMSG",Z)) Q:'Z  S CT=CT+1,RCER(CT)=$G(^TMP($J,"RCDPEMSG",Z))
"RTN","RCDPEM0",135,0)
 .. D BULL^RCDPEM1(344.3,RC0,.RCER)
"RTN","RCDPEM0",136,0)
 .. S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,4)=+$G(^TMP($J,"RCXM",0))
"RTN","RCDPEM0",137,0)
 .. D STORERR(344.3,RCZ,.RCER)
"RTN","RCDPEM0",138,0)
 . ;
"RTN","RCDPEM0",139,0)
 . S DIE="^RCY(344.3,",DR=".11////^S X=DT;.12////"_$J(+TOT,"",2),DA=RCZ D ^DIE
"RTN","RCDPEM0",140,0)
 . S ^TMP($J,"RCTOT","SUSPAMT")=$G(^TMP($J,"RCTOT","SUSPAMT"))+TOT
"RTN","RCDPEM0",141,0)
 . S $P(^TMP($J,"RCDPETOT",344.3,RCZ),U,3)="1"
"RTN","RCDPEM0",142,0)
 ;
"RTN","RCDPEM0",143,0)
 I RECTDA L -^RCY(344,RECTDA)
"RTN","RCDPEM0",144,0)
 Q RECTDA
"RTN","RCDPEM0",145,0)
 ;
"RTN","RCDPEM0",146,0)
SETERR(RCPROC) ; Set up first line of error message to be stored
"RTN","RCDPEM0",147,0)
 ; RCPROC = 1 if called from EFT-EOB automatch, 0 if from manual match
"RTN","RCDPEM0",148,0)
 ;        =2 if called from EFT deposit creation
"RTN","RCDPEM0",149,0)
 N LINE1
"RTN","RCDPEM0",150,0)
 I RCPROC S LINE1=$$FMTE^XLFDT($$NOW^XLFDT(),2)_" - PROCESS TO "_$S(RCPROC=1:"CREATE RECEIPT FROM ERA",1:"SEND EFT DEPOSIT TO FMS")
"RTN","RCDPEM0",151,0)
 Q LINE1
"RTN","RCDPEM0",152,0)
 ;
"RTN","RCDPEM0",153,0)
STORERR(RCFILE,RCZ,RCER) ; Store error text in word processing field
"RTN","RCDPEM0",154,0)
 ; RCFILE = 344.3 or 344.31
"RTN","RCDPEM0",155,0)
 ; RCZ = ien of the entry in file RCFILE
"RTN","RCDPEM0",156,0)
 ; RCER = array containing the error text (passed by ref)
"RTN","RCDPEM0",157,0)
 D WP^DIE(RCFILE,RCZ_",",2,"A","RCER")
"RTN","RCDPEM0",158,0)
 Q
"RTN","RCDPEM0",159,0)
 ;
"RTN","RCDPR215")
0^22^B37063304
"RTN","RCDPR215",1,0)
RCDPR215 ;WISC/RFJ-receipt processing sf215 report ;1 Jun 99
"RTN","RCDPR215",2,0)
 ;;4.5;Accounts Receivable;**114,173,211,220**;Mar 20, 1995
"RTN","RCDPR215",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPR215",4,0)
 Q
"RTN","RCDPR215",5,0)
 ;
"RTN","RCDPR215",6,0)
 ;
"RTN","RCDPR215",7,0)
DQ ;  queued report starts here, input RECEIPDA
"RTN","RCDPR215",8,0)
 ;  RCTYPE="D"etail or "A"ccrual
"RTN","RCDPR215",9,0)
 N %I,AMOUNT,BILL,BILLDA,COMMENTS,COUNT,DA,DATA,DEPOSIT,DETAIL,FMSDOCNO,FUND,NOW,PAGE,PIECE,PRINTOTL,RCSTFLAG,RCYLINE,RECEIPT,SCREEN,TOTAL,TOTLAMT,UNAPPLY,X,Y,TOT,%,REPRODT,EFTFUND
"RTN","RCDPR215",10,0)
 ;
"RTN","RCDPR215",11,0)
 ;  calculate report
"RTN","RCDPR215",12,0)
 ;  input receipda (ien of receipt)
"RTN","RCDPR215",13,0)
 K ^TMP($J,"RCFMSCR"),^TMP($J,"RCDPR215")
"RTN","RCDPR215",14,0)
 S EFTFUND=$S(DT<$$ADDPTEDT^PRCAACC():"5287.4/8NZZ",1:"528704/8NZZ")
"RTN","RCDPR215",15,0)
 S REPRODT=$P($P($G(^RCY(344,RECEIPDA,0)),"^",8),".")
"RTN","RCDPR215",16,0)
 D FMSLINES^RCXFMSC1(RECEIPDA)
"RTN","RCDPR215",17,0)
 I $$EDILB^RCDPEU(RECEIPDA)=1 D  ; EFT deposit receipt
"RTN","RCDPR215",18,0)
 . S TOT=0
"RTN","RCDPR215",19,0)
 . S Z=0 F  S Z=$O(^RCY(344,RECEIPDA,1,Z)) Q:'Z  S TOT=TOT+$P($G(^(Z,0)),U,4)
"RTN","RCDPR215",20,0)
 . S ^TMP($J,"RCFMSCR",EFTFUND)=TOT
"RTN","RCDPR215",21,0)
 ;
"RTN","RCDPR215",22,0)
 ;  print report
"RTN","RCDPR215",23,0)
 S DATA=$G(^RCY(344,RECEIPDA,0))
"RTN","RCDPR215",24,0)
 S RECEIPT=$P(DATA,"^")
"RTN","RCDPR215",25,0)
 S DEPOSIT=$P($G(^RCY(344.1,+$P(DATA,"^",6),0)),"^")
"RTN","RCDPR215",26,0)
 S FMSDOCNO=$P($G(^RCY(344.1,+$P(DATA,"^",6),2)),"^")
"RTN","RCDPR215",27,0)
 ;
"RTN","RCDPR215",28,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y
"RTN","RCDPR215",29,0)
 S PAGE=0,RCYLINE="",$P(RCYLINE,"-",81)=""
"RTN","RCDPR215",30,0)
 S SCREEN=0 I '$D(ZTQUEUED),IO=IO(0),$E(IOST)="C" S SCREEN=1
"RTN","RCDPR215",31,0)
 U IO D H
"RTN","RCDPR215",32,0)
 ;
"RTN","RCDPR215",33,0)
 S TOTAL=""  ;  stores printotal^inttotal^admintotal^marshtotal^cctotal
"RTN","RCDPR215",34,0)
 S FUND="" F  S FUND=$O(^TMP($J,"RCFMSCR",FUND)) Q:'FUND!($G(RCSTFLAG))  D
"RTN","RCDPR215",35,0)
 .   I $Y>(IOSL-6) D:SCREEN PAUSE Q:$G(RCSTFLAG)  D H
"RTN","RCDPR215",36,0)
 .   W !!?5,"Appropriation: ",FUND
"RTN","RCDPR215",37,0)
 .   I RCTYPE="D" W !
"RTN","RCDPR215",38,0)
 .   ;
"RTN","RCDPR215",39,0)
 .   S PRINTOTL=0
"RTN","RCDPR215",40,0)
 .   S COUNT=0
"RTN","RCDPR215",41,0)
 .   I FUND=EFTFUND S PRINTOTL=PRINTOTL+$G(^TMP($J,"RCFMSCR",FUND))
"RTN","RCDPR215",42,0)
 .   S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCFMSCR",FUND,BILLDA)) Q:'BILLDA!($G(RCSTFLAG))  D
"RTN","RCDPR215",43,0)
 .   .   I $Y>(IOSL-5) D:SCREEN PAUSE Q:$G(RCSTFLAG)  D H
"RTN","RCDPR215",44,0)
 .   .   S COUNT=COUNT+1
"RTN","RCDPR215",45,0)
 .   .   S BILL=$P($G(^PRCA(430,BILLDA,0)),"^")
"RTN","RCDPR215",46,0)
 .   .   S DATA=^TMP($J,"RCFMSCR",FUND,BILLDA)
"RTN","RCDPR215",47,0)
 .   .   S PRINTOTL=PRINTOTL+$P(DATA,"^")
"RTN","RCDPR215",48,0)
 .   .   F PIECE=1:1:5 S $P(TOTAL,"^",PIECE)=$P(TOTAL,"^",PIECE)+$P(DATA,"^",PIECE)
"RTN","RCDPR215",49,0)
 .   .   ;  if accrued report, do not show detail
"RTN","RCDPR215",50,0)
 .   .   I RCTYPE="A" Q
"RTN","RCDPR215",51,0)
 .   .   ;
"RTN","RCDPR215",52,0)
 .   .   W !?5,COUNT,")",?10,BILL,?30,$J($P(DATA,"^"),10,2),?45,"DEBTOR: ",$E($$DEBTOR(BILLDA),1,25)
"RTN","RCDPR215",53,0)
 .   .   W !?15,"INT:",$J($P(DATA,"^",2),10,2)," ADMIN:",$J($P(DATA,"^",3),10,2)," MARS: ",$J($P(DATA,"^",4),10,2)," CC: ",$J($P(DATA,"^",5),10,2)
"RTN","RCDPR215",54,0)
 .   ;
"RTN","RCDPR215",55,0)
 .   I $G(RCSTFLAG) Q
"RTN","RCDPR215",56,0)
 .   I RCTYPE="D" W !?30,"----------",!?5,"TOTAL for ",FUND
"RTN","RCDPR215",57,0)
 .   W ?30,$J(PRINTOTL,10,2)
"RTN","RCDPR215",58,0)
 .   I FUND="0160a1" W ?45,"0160a1 sub-totals Champva receipts",!?45,"not sent to FMS on the CR document."
"RTN","RCDPR215",59,0)
 ;
"RTN","RCDPR215",60,0)
 I $G(RCSTFLAG) D Q Q
"RTN","RCDPR215",61,0)
 I $Y>(IOSL-6) D:SCREEN PAUSE I '$G(RCSTFLAG) D H
"RTN","RCDPR215",62,0)
 I $G(RCSTFLAG) D Q Q
"RTN","RCDPR215",63,0)
 ;
"RTN","RCDPR215",64,0)
 ;  show int, admin, etc totals
"RTN","RCDPR215",65,0)
 W !
"RTN","RCDPR215",66,0)
 W !?5,"INTEREST : (APP: 1435)",?30,$J($P(TOTAL,"^",2),10,2)
"RTN","RCDPR215",67,0)
 W !?5,"ADMIN    : (APP: 3220)",?30,$J($P(TOTAL,"^",3),10,2)
"RTN","RCDPR215",68,0)
 W !?5,"MARSHALL : (APP: 0869)",?30,$J($P(TOTAL,"^",4),10,2)
"RTN","RCDPR215",69,0)
 W !?5,"COURTCOST: (APP: 0869)",?30,$J($P(TOTAL,"^",5),10,2)
"RTN","RCDPR215",70,0)
 W !?30,"----------"
"RTN","RCDPR215",71,0)
 W !?30,$J($P(TOTAL,"^",2)+$P(TOTAL,"^",3)+$P(TOTAL,"^",4)+$P(TOTAL,"^",5),10,2)
"RTN","RCDPR215",72,0)
 ;
"RTN","RCDPR215",73,0)
 I $Y>(IOSL-8) D:SCREEN PAUSE I '$G(RCSTFLAG) D H
"RTN","RCDPR215",74,0)
 I $G(RCSTFLAG) D Q Q
"RTN","RCDPR215",75,0)
 ;
"RTN","RCDPR215",76,0)
 I $G(^TMP($J,"RCFMSCR",EFTFUND)) S $P(TOTAL,U)=$P(TOTAL,U)+^TMP($J,"RCFMSCR",EFTFUND)
"RTN","RCDPR215",77,0)
 ;  compile unapplied amounts that went to suspense
"RTN","RCDPR215",78,0)
 S DA=0 F  S DA=$O(^RCY(344,RECEIPDA,1,DA)) Q:'DA  D
"RTN","RCDPR215",79,0)
 .   S AMOUNT=$P($G(^RCY(344,RECEIPDA,1,DA,0)),"^",4) I 'AMOUNT Q
"RTN","RCDPR215",80,0)
 .   S UNAPPLY=$P($G(^RCY(344,RECEIPDA,1,DA,2)),"^",5) I UNAPPLY="" Q
"RTN","RCDPR215",81,0)
 .   ;  if amount has not been processed, show it in suspense
"RTN","RCDPR215",82,0)
 .   I '$P(^RCY(344,RECEIPDA,1,DA,0),"^",5) S ^TMP($J,"RCDPR215",DA)=UNAPPLY_"^"_AMOUNT_"^"_$P($G(^RCY(344,RECEIPDA,1,DA,1)),"^",2)
"RTN","RCDPR215",83,0)
 ;
"RTN","RCDPR215",84,0)
 ;  print unapplied amounts that went to suspense
"RTN","RCDPR215",85,0)
 I $O(^TMP($J,"RCDPR215",0)) D
"RTN","RCDPR215",86,0)
 .   W !!?5,"Appropriation: 3875"
"RTN","RCDPR215",87,0)
 .   I RCTYPE="D" W !
"RTN","RCDPR215",88,0)
 .   ;
"RTN","RCDPR215",89,0)
 .   S COUNT=0,PRINTOTL=0
"RTN","RCDPR215",90,0)
 .   S DA=0 F  S DA=$O(^TMP($J,"RCDPR215",DA)) Q:'DA!($G(RCSTFLAG))  D
"RTN","RCDPR215",91,0)
 .   .   I $Y>(IOSL-6) D:SCREEN PAUSE Q:$G(RCSTFLAG)  D H
"RTN","RCDPR215",92,0)
 .   .   ;
"RTN","RCDPR215",93,0)
 .   .   S UNAPPLY=$P(^TMP($J,"RCDPR215",DA),"^"),AMOUNT=$P(^(DA),"^",2),COMMENTS=$P(^(DA),"^",3)
"RTN","RCDPR215",94,0)
 .   .   S PRINTOTL=PRINTOTL+AMOUNT
"RTN","RCDPR215",95,0)
 .   .   S $P(TOTAL,"^")=$P(TOTAL,"^")+AMOUNT
"RTN","RCDPR215",96,0)
 .   .   ;  if accrued report, do not show detail
"RTN","RCDPR215",97,0)
 .   .   I RCTYPE="A" Q
"RTN","RCDPR215",98,0)
 .   .   ;
"RTN","RCDPR215",99,0)
 .   .   S COUNT=COUNT+1
"RTN","RCDPR215",100,0)
 .   .   W !?5,COUNT,")",?10,UNAPPLY,?30,$J(AMOUNT,10,2),?45,"COMMENTS: ",$E(COMMENTS,1,25)
"RTN","RCDPR215",101,0)
 .   .   I $TR($E(COMMENTS,26,80)," ")'="" W !?25,$E(COMMENTS,26,80)
"RTN","RCDPR215",102,0)
 .   ;
"RTN","RCDPR215",103,0)
 .   I $G(RCSTFLAG) Q
"RTN","RCDPR215",104,0)
 .   I RCTYPE="D" W !?30,"----------",!?5,"TOTAL for 3875"
"RTN","RCDPR215",105,0)
 .   W ?30,$J(PRINTOTL,10,2)
"RTN","RCDPR215",106,0)
 I $G(RCSTFLAG) D Q Q
"RTN","RCDPR215",107,0)
 ;
"RTN","RCDPR215",108,0)
 S TOTLAMT=0 F PIECE=1:1:5 S TOTLAMT=TOTLAMT+$P(TOTAL,"^",PIECE)
"RTN","RCDPR215",109,0)
 W !!,"TOTALS: "
"RTN","RCDPR215",110,0)
 W !?5,"TOTAL AMOUNT POSTED:",?30,$J(TOTLAMT,10,2)
"RTN","RCDPR215",111,0)
 ;
"RTN","RCDPR215",112,0)
 I SCREEN W !,"Press RETURN to continue: " R X:DTIME
"RTN","RCDPR215",113,0)
Q D ^%ZISC
"RTN","RCDPR215",114,0)
 K ^TMP($J,"RCFMSCR"),^TMP($J,"RCDPR215")
"RTN","RCDPR215",115,0)
 Q
"RTN","RCDPR215",116,0)
 ;
"RTN","RCDPR215",117,0)
 ;
"RTN","RCDPR215",118,0)
GETTYPE() ;  ask the type of report to print
"RTN","RCDPR215",119,0)
 N DIR,X,Y
"RTN","RCDPR215",120,0)
 S DIR(0)="S^A:ACCRUED;D:DETAILED",DIR("A")="ACCRUED OR DETAILED REPORT",DIR("B")="ACCRUED",DIR("?")="A DETAILED Report will list out accrued bills separately"
"RTN","RCDPR215",121,0)
 S DIR("?",1)="An ACCRUED Report will list just the accrued total under each appropriation"
"RTN","RCDPR215",122,0)
 D ^DIR
"RTN","RCDPR215",123,0)
 I Y'="A",Y'="D" Q ""
"RTN","RCDPR215",124,0)
 Q Y
"RTN","RCDPR215",125,0)
 ;
"RTN","RCDPR215",126,0)
 ;
"RTN","RCDPR215",127,0)
DEBTOR(DA) ;  returns the debtor name for ien of bill (da) in file 430
"RTN","RCDPR215",128,0)
 N D0,DEBTOR,DIC,DIQ,DR
"RTN","RCDPR215",129,0)
 S DIC="^PRCA(430,",DR=9,DIQ(0)="E",DIQ="DEBTOR"
"RTN","RCDPR215",130,0)
 D EN^DIQ1
"RTN","RCDPR215",131,0)
 Q $G(DEBTOR(430,DA,9,"E"))
"RTN","RCDPR215",132,0)
 ;
"RTN","RCDPR215",133,0)
 ;
"RTN","RCDPR215",134,0)
H ;  header
"RTN","RCDPR215",135,0)
 N Z
"RTN","RCDPR215",136,0)
 S PAGE=PAGE+1 I PAGE'=1!(SCREEN) W @IOF
"RTN","RCDPR215",137,0)
 W $C(13),"Page ",PAGE,?(80-$L(NOW)),NOW
"RTN","RCDPR215",138,0)
 W !,$E($TR(RCYLINE,"-","*"),1,34)," 215 REPORT ",$E($TR(RCYLINE,"-","*"),1,34)
"RTN","RCDPR215",139,0)
 W !!,"RECEIPT #: ",RECEIPT,?25,"for DEPOSIT #: ",DEPOSIT
"RTN","RCDPR215",140,0)
 I FMSDOCNO'="" W ?51,"FMS Document #: ",FMSDOCNO
"RTN","RCDPR215",141,0)
 S Z=""
"RTN","RCDPR215",142,0)
 I $P($G(^RCY(344,RECEIPDA,0)),U,18) S Z=$E(" REFERENCE ERA #: "_$P($G(^RCY(344.4,+$P($G(^RCY(344,RECEIPDA,0)),U,18),0)),U)_" ("_$P($G(^RCY(344.4,+$P($G(^RCY(344,RECEIPDA,0)),U,18),0)),U,2)_")"_$J("",51),1,51)
"RTN","RCDPR215",143,0)
 I Z'="" W !,Z
"RTN","RCDPR215",144,0)
 W !,RCYLINE
"RTN","RCDPR215",145,0)
 Q
"RTN","RCDPR215",146,0)
 ;
"RTN","RCDPR215",147,0)
 ;
"RTN","RCDPR215",148,0)
PAUSE ;  pause at end of page
"RTN","RCDPR215",149,0)
 N X U IO(0) W !,"Press RETURN to continue, '^' to exit:" R X:DTIME S:'$T X="^" S:X["^" RCSTFLAG=1 U IO
"RTN","RCDPR215",150,0)
 Q
"RTN","RCDPRPLM")
0^26^B82221734
"RTN","RCDPRPLM",1,0)
RCDPRPLM ;WISC/RFJ-receipt profile listmanager top routine ;1 Jun 99
"RTN","RCDPRPLM",2,0)
 ;;4.5;Accounts Receivable;**114,148,149,173,196,220**;Mar 20, 1995
"RTN","RCDPRPLM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPRPLM",4,0)
 ;
"RTN","RCDPRPLM",5,0)
 N RCDPFXIT
"RTN","RCDPRPLM",6,0)
 ;
"RTN","RCDPRPLM",7,0)
RECTPROF ;  entry point called by link payment to prevent newing
"RTN","RCDPRPLM",8,0)
 ; fast exit var RCDPFXIT
"RTN","RCDPRPLM",9,0)
 N RCRECTDA
"RTN","RCDPRPLM",10,0)
 ;
"RTN","RCDPRPLM",11,0)
 F  D  Q:'RCRECTDA
"RTN","RCDPRPLM",12,0)
 . W !! S RCRECTDA=$$SELRECT^RCDPUREC(1)  ;allow adding new receipt
"RTN","RCDPRPLM",13,0)
 . I RCRECTDA<1 S RCRECTDA=0 Q
"RTN","RCDPRPLM",14,0)
 . D EN^VALM("RCDP RECEIPT PROFILE")
"RTN","RCDPRPLM",15,0)
 . ; fast exit
"RTN","RCDPRPLM",16,0)
 . I $G(RCDPFXIT) S RCRECTDA=0
"RTN","RCDPRPLM",17,0)
 Q
"RTN","RCDPRPLM",18,0)
 ;
"RTN","RCDPRPLM",19,0)
 ;
"RTN","RCDPRPLM",20,0)
INIT ; init for list manager
"RTN","RCDPRPLM",21,0)
 N DATE,FMSDOC,GECSDA1,GECSDATA,RCCANCEL,RCDPDATA,RCDPFCAN,RCLINE,RCTOTAL,RCTRDA,SPACE,RCEFT,X,Z,Z0,RCZ,RCZ0,RCZ1,RCZ2,EFTFUND
"RTN","RCDPRPLM",22,0)
 K ^TMP("RCDPRPLM",$J),^TMP("VALM VIDEO",$J)
"RTN","RCDPRPLM",23,0)
 ;
"RTN","RCDPRPLM",24,0)
 ; fast exit
"RTN","RCDPRPLM",25,0)
 I $G(RCDPFXIT) S VALMQUIT=1 Q
"RTN","RCDPRPLM",26,0)
 ;
"RTN","RCDPRPLM",27,0)
 D DIQ344(RCRECTDA,".02:200")
"RTN","RCDPRPLM",28,0)
 ;
"RTN","RCDPRPLM",29,0)
 ; set listmanager line #
"RTN","RCDPRPLM",30,0)
 S RCLINE=0
"RTN","RCDPRPLM",31,0)
 ;
"RTN","RCDPRPLM",32,0)
 K ^TMP($J,"RCEFT")
"RTN","RCDPRPLM",33,0)
 S EFTFUND=$S(DT<$$ADDPTEDT^PRCAACC():"5287.4/8NZZ ",1:"528704/8NZZ ")
"RTN","RCDPRPLM",34,0)
 S RCEFT=+$O(^RCY(344.3,"ARDEP",+$P($G(^RCY(344,RCRECTDA,0)),U,6),0))
"RTN","RCDPRPLM",35,0)
 I RCEFT D
"RTN","RCDPRPLM",36,0)
 . S Z=0 F  S Z=$O(^RCY(344.31,"B",RCEFT,Z)) Q:'Z  S Z0=$G(^RCY(344.31,+Z,0)) I $P(Z0,U,14) S ^TMP($J,"RCEFT",$P(Z0,U,14))=Z_U_$E($P(Z0,U,2),1,12)
"RTN","RCDPRPLM",37,0)
 S RCTRDA=0 F  S RCTRDA=$O(^RCY(344,RCRECTDA,1,RCTRDA)) Q:'RCTRDA  D
"RTN","RCDPRPLM",38,0)
 . D DIQ34401(RCRECTDA,RCTRDA)
"RTN","RCDPRPLM",39,0)
 . S RCLINE=RCLINE+1 D SET("",RCLINE,1,80,.01)
"RTN","RCDPRPLM",40,0)
 . ;check for payment cancelled
"RTN","RCDPRPLM",41,0)
 . S RCCANCEL=0
"RTN","RCDPRPLM",42,0)
 . I $P($G(^RCY(344,RCRECTDA,1,RCTRDA,0)),"^",4)=0,$P($G(^(1)),"^")'="" D
"RTN","RCDPRPLM",43,0)
 . . S RCCANCEL=1,RCDPFCAN=1
"RTN","RCDPRPLM",44,0)
 . . D SET("**",RCLINE,5,6)
"RTN","RCDPRPLM",45,0)
 . ;account
"RTN","RCDPRPLM",46,0)
 . I $G(RCDPDATA(344.01,RCTRDA,.03,"E"))="" D
"RTN","RCDPRPLM",47,0)
 . . S RCDPDATA(344.01,RCTRDA,.03,"E")="[ "_$S(RCEFT:EFTFUND_$P($G(^TMP($J,"RCEFT",RCTRDA)),U,2),1:"suspense"_$$GETUNAPP^RCXFMSCR(RCRECTDA,RCTRDA,0))_" ]"
"RTN","RCDPRPLM",48,0)
 . D SET("",RCLINE,7,33,.03)
"RTN","RCDPRPLM",49,0)
 . ;date of payment
"RTN","RCDPRPLM",50,0)
 . I RCDPDATA(344.01,RCTRDA,.06,"I") D
"RTN","RCDPRPLM",51,0)
 . . D SET($E(RCDPDATA(344.01,RCTRDA,.06,"I"),4,5)_"/"_$E(RCDPDATA(344.01,RCTRDA,.06,"I"),6,7)_"/"_$E(RCDPDATA(344.01,RCTRDA,.06,"I"),2,3),RCLINE,35,42)
"RTN","RCDPRPLM",52,0)
 . ;entered by
"RTN","RCDPRPLM",53,0)
 . I RCDPDATA(344.01,RCTRDA,.12,"E")'="" D
"RTN","RCDPRPLM",54,0)
 . . S X=$E($P(RCDPDATA(344.01,RCTRDA,.12,"E"),",",2))_$E(RCDPDATA(344.01,RCTRDA,.12,"E"))
"RTN","RCDPRPLM",55,0)
 . . I RCDPDATA(344.01,RCTRDA,.12,"I")=.5 S X="ar"
"RTN","RCDPRPLM",56,0)
 . . D SET(X,RCLINE,45,46)
"RTN","RCDPRPLM",57,0)
 . I RCDPDATA(344.01,RCTRDA,.14,"E")'="" D
"RTN","RCDPRPLM",58,0)
 . . S X=$E($P(RCDPDATA(344.01,RCTRDA,.14,"E"),",",2))_$E(RCDPDATA(344.01,RCTRDA,.14,"E"))
"RTN","RCDPRPLM",59,0)
 . . D SET(X,RCLINE,54,55)
"RTN","RCDPRPLM",60,0)
 . D SET($J(RCDPDATA(344.01,RCTRDA,.04,"E"),8,2),RCLINE,62,70)
"RTN","RCDPRPLM",61,0)
 . D SET($J(RCDPDATA(344.01,RCTRDA,.05,"E"),8,2),RCLINE,72,80)
"RTN","RCDPRPLM",62,0)
 . ;
"RTN","RCDPRPLM",63,0)
 . ;if not processed, show if amount > bill
"RTN","RCDPRPLM",64,0)
 . S X=$$CHECKPAY^RCDPRPL3(RCRECTDA,RCTRDA) I X D
"RTN","RCDPRPLM",65,0)
 . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",66,0)
 . . D SET("  WARNING: Pending Payments ($ "_$J($P(X,"^",3),0,2)_") exceed amount billed ($ "_$J($P(X,"^",2),0,2)_")",RCLINE,1,80)
"RTN","RCDPRPLM",67,0)
 . ;
"RTN","RCDPRPLM",68,0)
 . ;show line 2 for check/credit payment
"RTN","RCDPRPLM",69,0)
 . I $G(^DISV(DUZ,"RCDPRPLM","SHOWCHECK")) D
"RTN","RCDPRPLM",70,0)
 . . ;receipt type of payment is check
"RTN","RCDPRPLM",71,0)
 . . I RCDPDATA(344,RCRECTDA,.04,"I")=4!(RCDPDATA(344,RCRECTDA,.04,"I")=12) D  Q
"RTN","RCDPRPLM",72,0)
 . . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",73,0)
 . . . D SET("      Check #",RCLINE,1,80,.07)
"RTN","RCDPRPLM",74,0)
 . . . I 'RCDPDATA(344.01,RCTRDA,.1,"I") S RCDPDATA(344.01,RCTRDA,.1,"I")="???????"
"RTN","RCDPRPLM",75,0)
 . . . D SET("Date: "_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),4,5)_"/"_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),6,7)_"/"_$E(RCDPDATA(344.01,RCTRDA,.1,"I"),2,3),RCLINE,32,80)
"RTN","RCDPRPLM",76,0)
 . . . D SET("Bank #",RCLINE,47,80,.08)
"RTN","RCDPRPLM",77,0)
 . . ;receipt type of payment is credit
"RTN","RCDPRPLM",78,0)
 . . I RCDPDATA(344,RCRECTDA,.04,"I")=7 D
"RTN","RCDPRPLM",79,0)
 . . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",80,0)
 . . . D SET("      Card #",RCLINE,1,80,.11)
"RTN","RCDPRPLM",81,0)
 . . . D SET("Confirmation #",RCLINE,35,80,.02)
"RTN","RCDPRPLM",82,0)
 . ;
"RTN","RCDPRPLM",83,0)
 . ;show line 3 for acct lookup, batch and seq #
"RTN","RCDPRPLM",84,0)
 . I $G(^DISV(DUZ,"RCDPRPLM","SHOWACCT")) D
"RTN","RCDPRPLM",85,0)
 . . I RCDPDATA(344.01,RCTRDA,.21,"E")="",RCDPDATA(344.01,RCTRDA,.22,"E")="",RCDPDATA(344.01,RCTRDA,.23,"E")="" Q
"RTN","RCDPRPLM",86,0)
 . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",87,0)
 . . D SET("      AcctLU",RCLINE,1,80,.21)
"RTN","RCDPRPLM",88,0)
 . . D SET("Batch/Sequence: "_RCDPDATA(344.01,RCTRDA,.22,"E")_"/"_RCDPDATA(344.01,RCTRDA,.23,"E"),RCLINE,37,80)
"RTN","RCDPRPLM",89,0)
 . ;
"RTN","RCDPRPLM",90,0)
 . ;show if posting error
"RTN","RCDPRPLM",91,0)
 . I $G(^DISV(DUZ,"RCDPRPLM","SHOWCOMMENTS")),RCDPDATA(344.01,RCTRDA,1.01,"E")'="" D
"RTN","RCDPRPLM",92,0)
 . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",93,0)
 . . S X="Posting Error"
"RTN","RCDPRPLM",94,0)
 . . I RCCANCEL S X="Cancel Data"
"RTN","RCDPRPLM",95,0)
 . . D SET("      "_X,RCLINE,1,80,1.01)
"RTN","RCDPRPLM",96,0)
 . ;
"RTN","RCDPRPLM",97,0)
 . ;show if comment
"RTN","RCDPRPLM",98,0)
 . I $G(^DISV(DUZ,"RCDPRPLM","SHOWCOMMENTS")),RCDPDATA(344.01,RCTRDA,1.02,"E")'="" D
"RTN","RCDPRPLM",99,0)
 . . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",100,0)
 . . D SET("      Comment",RCLINE,1,80,1.02)
"RTN","RCDPRPLM",101,0)
 . ;
"RTN","RCDPRPLM",102,0)
 . ;if EDI Lockbox pending adjustments, show it
"RTN","RCDPRPLM",103,0)
 . I $P($G(^RCY(344,RCRECTDA,0)),U,18),$G(RCDPDATA(344.01,RCTRDA,.27,"E")) D
"RTN","RCDPRPLM",104,0)
 . . S RCZ=$P(^RCY(344,RCRECTDA,0),U,18),RCZ0=RCDPDATA(344.01,RCTRDA,.27,"E")
"RTN","RCDPRPLM",105,0)
 . . S RCZ1=0 F  S RCZ1=$O(^RCY(344.49,RCZ,1,RCZ0,1,RCZ1)) Q:'RCZ1  S RCZ2=$G(^(RCZ1,0)) I $P(RCZ2,U,5)'="","12"[$P(RCZ2,U,5),'$P(RCZ2,U,8) D
"RTN","RCDPRPLM",106,0)
 . . . I $P(RCZ2,U,5)=1 S RCLINE=RCLINE+1 D SET("      Pending decrease adjustment for "_$J($P(RCZ2,U,3),"",2),RCLINE,1,80) Q
"RTN","RCDPRPLM",107,0)
 . . . I $G(^DISV(DUZ,"RCDPRPLM","SHOWCOMMENTS")),$P(RCZ2,U,5)=2 S RCLINE=RCLINE+1 D SET("      Comment: "_$P(RCZ2,U,9),RCLINE,1,80) Q
"RTN","RCDPRPLM",108,0)
 . ;
"RTN","RCDPRPLM",109,0)
 . ;calculate totals
"RTN","RCDPRPLM",110,0)
 . S RCTOTAL(1)=$G(RCTOTAL(1))+RCDPDATA(344.01,RCTRDA,.04,"E")
"RTN","RCDPRPLM",111,0)
 . S RCTOTAL(2)=$G(RCTOTAL(2))+RCDPDATA(344.01,RCTRDA,.05,"E")
"RTN","RCDPRPLM",112,0)
 . ;
"RTN","RCDPRPLM",113,0)
 . ;kill local variable to prevent store errors
"RTN","RCDPRPLM",114,0)
 . K RCDPDATA(344.01,RCTRDA)
"RTN","RCDPRPLM",115,0)
 ;
"RTN","RCDPRPLM",116,0)
 ; show totals
"RTN","RCDPRPLM",117,0)
 K ^TMP($J,"RCEFT")
"RTN","RCDPRPLM",118,0)
 S RCLINE=RCLINE+1 D SET("",RCLINE,1,80)
"RTN","RCDPRPLM",119,0)
 D SET("--------  --------",RCLINE,62,80)
"RTN","RCDPRPLM",120,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",121,0)
 D SET("      TOTAL DOLLARS FOR RECEIPT",RCLINE,1,80)
"RTN","RCDPRPLM",122,0)
 D SET($J($G(RCTOTAL(1)),8,2),RCLINE,62,70)
"RTN","RCDPRPLM",123,0)
 D SET($J($G(RCTOTAL(2)),8,2),RCLINE,72,80)
"RTN","RCDPRPLM",124,0)
 ; show cancelled
"RTN","RCDPRPLM",125,0)
 I $G(RCDPFCAN) D
"RTN","RCDPRPLM",126,0)
 . S RCLINE=RCLINE+1
"RTN","RCDPRPLM",127,0)
 . D SET("**indicates payment is CANCELLED",RCLINE,5,80)
"RTN","RCDPRPLM",128,0)
 ;
"RTN","RCDPRPLM",129,0)
 ; show history
"RTN","RCDPRPLM",130,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",131,0)
 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",132,0)
 ; start history on first line of a screen if it does not fit on
"RTN","RCDPRPLM",133,0)
 ; current screen
"RTN","RCDPRPLM",134,0)
 I (RCLINE#12)>8 F SPACE=(RCLINE#12):1:12 S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",135,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",136,0)
 D SET("Receipt History",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPRPLM",137,0)
 S DATE=RCDPDATA(344,RCRECTDA,.03,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",138,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",139,0)
 S SPACE="",$P(SPACE," ",80)=""
"RTN","RCDPRPLM",140,0)
 I RCDPDATA(344,RCRECTDA,.02,"I")=.5 S RCDPDATA(344,RCRECTDA,.02,"E")="accounts receivable"
"RTN","RCDPRPLM",141,0)
 D SET($E("   Opened By: "_RCDPDATA(344,RCRECTDA,.02,"E")_SPACE,1,39)_"Date/Time    Opened: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",142,0)
 S DATE=RCDPDATA(344,RCRECTDA,.12,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",143,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",144,0)
 I RCDPDATA(344,RCRECTDA,.11,"I")=.5 S RCDPDATA(344,RCRECTDA,.11,"E")="accounts receivable"
"RTN","RCDPRPLM",145,0)
 D SET($E("Last Edit By: "_RCDPDATA(344,RCRECTDA,.11,"E")_SPACE,1,39)_"Date/Time Last Edit: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",146,0)
 S DATE=RCDPDATA(344,RCRECTDA,.08,"E"),DATE=$P(DATE,"@")_"  "_$P($P(DATE,"@",2),":",1,2)
"RTN","RCDPRPLM",147,0)
 S RCLINE=RCLINE+1
"RTN","RCDPRPLM",148,0)
 I RCDPDATA(344,RCRECTDA,.07,"I")=.5 S RCDPDATA(344,RCRECTDA,.07,"E")="accounts receivable"
"RTN","RCDPRPLM",149,0)
 D SET($E("Processed By: "_RCDPDATA(344,RCRECTDA,.07,"E")_SPACE,1,39)_"Date/Time Processed: "_DATE,RCLINE,1,80)
"RTN","RCDPRPLM",150,0)
 ;
"RTN","RCDPRPLM",151,0)
 ;show fms code sheets if switch on
"RTN","RCDPRPLM",152,0)
 I $G(^DISV(DUZ,"RCDPRPLM","SHOWFMS")) D
"RTN","RCDPRPLM",153,0)
 . S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPLM",154,0)
 . S RCLINE=RCLINE+1 D SET(" ",RCLINE,1,80)
"RTN","RCDPRPLM",155,0)
 . S RCLINE=RCLINE+1 D SET("FMS Cash Receipt Document:",RCLINE,1,80,0,IOUON,IOUOFF)
"RTN","RCDPRPLM",156,0)
 . D SET($P(FMSDOC,"^")_$S($P(FMSDOC,"^",3):"(on deposit)",1:""),RCLINE,28,80)
"RTN","RCDPRPLM",157,0)
 . D SET("Status: "_$P(FMSDOC,"^",2),RCLINE,55,80)
"RTN","RCDPRPLM",158,0)
 . N DIQ2 D DATA^GECSSGET($P(FMSDOC,"^"),1)
"RTN","RCDPRPLM",159,0)
 . I '$G(GECSDATA) Q
"RTN","RCDPRPLM",160,0)
 . S GECSDA1=0 F  S GECSDA1=$O(GECSDATA(2100.1,GECSDATA,10,GECSDA1)) Q:'GECSDA1  D
"RTN","RCDPRPLM",161,0)
 . . S RCLINE=RCLINE+1 D SET(GECSDATA(2100.1,GECSDATA,10,GECSDA1),RCLINE,1,80)
"RTN","RCDPRPLM",162,0)
 ;
"RTN","RCDPRPLM",163,0)
 ; show EEOB detail if switch on
"RTN","RCDPRPLM",164,0)
 D SHEOB^RCDPRPL2
"RTN","RCDPRPLM",165,0)
 ;
"RTN","RCDPRPLM",166,0)
 ; set valmcnt to # of lines in list
"RTN","RCDPRPLM",167,0)
 S VALMCNT=RCLINE
"RTN","RCDPRPLM",168,0)
 D HDR
"RTN","RCDPRPLM",169,0)
 Q
"RTN","RCDPRPLM",170,0)
 ;
"RTN","RCDPRPLM",171,0)
 ;
"RTN","RCDPRPLM",172,0)
SET(STRING,LINE,COLBEG,COLEND,FIELD,ON,OFF) ;  set array
"RTN","RCDPRPLM",173,0)
 I $G(FIELD) S STRING=STRING_$S(STRING="":"",1:": ")_$G(RCDPDATA(344.01,RCTRDA,FIELD,"E"))
"RTN","RCDPRPLM",174,0)
 I STRING="",'$G(FIELD) D SET^VALM10(LINE,$J("",80)) Q
"RTN","RCDPRPLM",175,0)
 I '$D(@VALMAR@(LINE,0)) D SET^VALM10(LINE,$J("",80))
"RTN","RCDPRPLM",176,0)
 D SET^VALM10(LINE,$$SETSTR^VALM1(STRING,@VALMAR@(LINE,0),COLBEG,COLEND-COLBEG+1))
"RTN","RCDPRPLM",177,0)
 I $G(ON)]""!($G(OFF)]"") D CNTRL^VALM10(LINE,COLBEG,$L(STRING),ON,OFF)
"RTN","RCDPRPLM",178,0)
 Q
"RTN","RCDPRPLM",179,0)
 ;
"RTN","RCDPRPLM",180,0)
 ;
"RTN","RCDPRPLM",181,0)
DIQ344(DA,DR) ; retrieves data for flds in file 344
"RTN","RCDPRPLM",182,0)
 N %I,D0,DIC,DIQ,DIQ2,YY
"RTN","RCDPRPLM",183,0)
 K RCDPDATA(344,DA)
"RTN","RCDPRPLM",184,0)
 S DIQ(0)="IE",DIC="^RCY(344,",DIQ="RCDPDATA" D EN^DIQ1
"RTN","RCDPRPLM",185,0)
 Q
"RTN","RCDPRPLM",186,0)
 ;
"RTN","RCDPRPLM",187,0)
 ;
"RTN","RCDPRPLM",188,0)
DIQ34401(DA,SUBDA) ; retrieves data for flds in file 344
"RTN","RCDPRPLM",189,0)
 ; da = receipt da
"RTN","RCDPRPLM",190,0)
 N %I,D0,DIC,DIQ,DIQ2,DR
"RTN","RCDPRPLM",191,0)
 K RCDPDATA(344.01,SUBDA)
"RTN","RCDPRPLM",192,0)
 S DR=1,DR(344.01)=".01:1.02",DA(344.01)=SUBDA
"RTN","RCDPRPLM",193,0)
 S DIQ(0)="IE",DIC="^RCY(344,",DIQ="RCDPDATA" D EN^DIQ1
"RTN","RCDPRPLM",194,0)
 Q
"RTN","RCDPRPLM",195,0)
 ;
"RTN","RCDPRPLM",196,0)
 ;
"RTN","RCDPRPLM",197,0)
HDR ; header code for list manager display
"RTN","RCDPRPLM",198,0)
 N DATE,FMSDOC,RCDPDATA,SPACE,RCEFT,Z
"RTN","RCDPRPLM",199,0)
 D DIQ344(RCRECTDA,".01;.04;.06;.08;.14;.17;.18;")
"RTN","RCDPRPLM",200,0)
 S SPACE="",$P(SPACE," ",80)=""
"RTN","RCDPRPLM",201,0)
 S VALMHDR(1)=$E("   Receipt #: "_RCDPDATA(344,RCRECTDA,.01,"E")_SPACE,1,39)_"Type of Payment: "_RCDPDATA(344,RCRECTDA,.04,"E")
"RTN","RCDPRPLM",202,0)
 S Z=RCDPDATA(344,RCRECTDA,.06,"E"),RCEFT=+$O(^RCY(344.3,"ARDEP",+$P($G(^RCY(344,RCRECTDA,0)),U,6),0))
"RTN","RCDPRPLM",203,0)
 S VALMHDR(2)=$E($S('RCEFT&'RCDPDATA(344,RCRECTDA,.17,"I"):"   Deposit #: "_Z,RCEFT:" EFT Deposit: "_Z,1:"EFT Detail #: "_RCDPDATA(344,RCRECTDA,.17,"E"))_" "_$P($G(^RCY(344.31,+RCDPDATA(344,RCRECTDA,.17,"I"),0)),U,2)_SPACE,1,23)
"RTN","RCDPRPLM",204,0)
 S VALMHDR(2)=VALMHDR(2)_$E($S(RCDPDATA(344,RCRECTDA,.18,"E")'="":"   ERA #: "_RCDPDATA(344,RCRECTDA,.18,"E"),1:"")_SPACE,1,16)_" Receipt Status: "_RCDPDATA(344,RCRECTDA,.14,"E")
"RTN","RCDPRPLM",205,0)
 ;  get fms document and status
"RTN","RCDPRPLM",206,0)
 S FMSDOC=$$FMSSTAT^RCDPUREC(RCRECTDA)
"RTN","RCDPRPLM",207,0)
 S VALMHDR(3)=$E("FMS Document: "_$TR($P(FMSDOC,"^")," ")_$S($P(FMSDOC,"^",3):"(on deposit)",1:"")_SPACE,1,39)_" FMS Doc Status: "_$P(FMSDOC,"^",2)
"RTN","RCDPRPLM",208,0)
 ;
"RTN","RCDPRPLM",209,0)
 I RCDPDATA(344,RCRECTDA,.08,"I") S VALMSG="Receipt processed on "_RCDPDATA(344,RCRECTDA,.08,"E")
"RTN","RCDPRPLM",210,0)
 Q
"RTN","RCDPRPLM",211,0)
 ;
"RTN","RCDPRPLM",212,0)
 ;
"RTN","RCDPRPLM",213,0)
EXIT ; exit option/clean up
"RTN","RCDPRPLM",214,0)
 K ^TMP("RCDPRPLM",$J)
"RTN","RCDPRPLM",215,0)
 Q
"RTN","RCFMOBR1")
0^4^B20315878
"RTN","RCFMOBR1",1,0)
RCFMOBR1 ;WASH-ISC@ALTOONA,PA/RWT-BILL RECONCILIATIONS LIST ;7/10/97  11:17 AM
"RTN","RCFMOBR1",2,0)
 ;;4.5;Accounts Receivable;**53,73,90,203,220**;Mar 20, 1995
"RTN","RCFMOBR1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCFMOBR1",4,0)
 ;      OBR Data Structure used by this routine
"RTN","RCFMOBR1",5,0)
 ; ^TMP("OBR",$J,SITE,"NOT IN AR")=NextRec^TotalItems^TotalFMSAmt
"RTN","RCFMOBR1",6,0)
 ; ^TMP("OBR",$J,SITE,"NOT IN FMS")=NextRec^TotalItems^TotalARAmt
"RTN","RCFMOBR1",7,0)
 ; ^TMP("OBR",$J,SITE,"DISCREPANCY")=NextRec^TotalItems^TotalFMSAmt^TotalARAmt
"RTN","RCFMOBR1",8,0)
 ; ^TMP("OBR",$J,"BN",BILLNUMBER)=[423.6 rec] <-- x-ref of FMS Bills
"RTN","RCFMOBR1",9,0)
 ; ^TMP("OBR",$J,"REPORT","1")="LINE 1"
"RTN","RCFMOBR1",10,0)
 ; ^TMP("OBR",$J","REPORT,"2")="LINE 2"
"RTN","RCFMOBR1",11,0)
 ; Modules:
"RTN","RCFMOBR1",12,0)
 ;    PROCFMS  -  loop through FMS bills (^PRCF(423.6)) updating
"RTN","RCFMOBR1",13,0)
 ;                global ^TMP("OBR",$J,"BN") while also checking
"RTN","RCFMOBR1",14,0)
 ;                for invalid AR bills
"RTN","RCFMOBR1",15,0)
 ;    PROCAR   -  loop through all Active AR Bills comparing amounts
"RTN","RCFMOBR1",16,0)
 ;                and looking for Detail bills not found in FMS
"RTN","RCFMOBR1",17,0)
 ;    SAVE     -  Saves the errors to tmp global ^TMP("OBR",site)
"RTN","RCFMOBR1",18,0)
 ;
"RTN","RCFMOBR1",19,0)
 ;
"RTN","RCFMOBR1",20,0)
PROCFMS(A0) N NODE,FUND,RSC,SRSC,ND,BN,SN,A1
"RTN","RCFMOBR1",21,0)
 S A1=0 F  S A1=$O(^PRCF(423.6,A0,1,A1)) Q:+A1=0  S ND=^(A1,0) D
"RTN","RCFMOBR1",22,0)
   .I $P(ND,U)="OBR" D  Q
"RTN","RCFMOBR1",23,0)
      ..; LIN Segment with OBR identifies FMS data
"RTN","RCFMOBR1",24,0)
      ..S ND=^PRCF(423.6,A0,1,A1,0)
"RTN","RCFMOBR1",25,0)
      ..S SN=$P(ND,U,2),FUND=$S($P(ND,U,7)'="~":$P(ND,U,7),1:""),RSC=$S($P(ND,U,8)'="~":$P(ND,U,8),1:""),SRSC=$S($P(ND,U,9)'="~":$P(ND,U,9),1:"")
"RTN","RCFMOBR1",26,0)
      ..S BN=$P(ND,U,4) I $D(^TMP("OBR",$J,"BN",BN)) Q
"RTN","RCFMOBR1",27,0)
      ..S ^TMP("OBR",$J,"BN",BN)=A1,EM=""
"RTN","RCFMOBR1",28,0)
      ..S BN=$E($P(ND,U,4),1,3)_"-"_$E($P(ND,U,4),4,10)
"RTN","RCFMOBR1",29,0)
      ..S A2=$O(^PRCA(430,"B",BN,0))
"RTN","RCFMOBR1",30,0)
      ..I A2=""!('$D(^PRCA(430,+A2,0))) D  Q:A2=""
"RTN","RCFMOBR1",31,0)
          ...S AM1=+$P(ND,U,6)
"RTN","RCFMOBR1",32,0)
          ...S AM2=0,DB="UNKNOWN"
"RTN","RCFMOBR1",33,0)
          ...D SAVE(SN,BN,DB,AM1,AM2,"NOT IN AR")
"RTN","RCFMOBR1",34,0)
      ..S NODE=$G(^PRCA(430,+A2,11)) Q:NODE=""
"RTN","RCFMOBR1",35,0)
      ..I FUND'=$P(NODE,U,17) D SAVE(SN,BN,$P(NODE,U,17),FUND,0,"FUND MISMATCH")
"RTN","RCFMOBR1",36,0)
      ..I RSC'=$P(NODE,U,6) D SAVE(SN,BN,$P(NODE,U,6),RSC,0,"RSC MISMATCH")
"RTN","RCFMOBR1",37,0)
      ..I SRSC'=$P(NODE,U,7) D SAVE(SN,BN,$P(NODE,U,7),SRSC,0,"SUB RSC MISMATCH")
"RTN","RCFMOBR1",38,0)
 Q
"RTN","RCFMOBR1",39,0)
PROCAR(A0) ;
"RTN","RCFMOBR1",40,0)
 ; - Process all Active AR Bills
"RTN","RCFMOBR1",41,0)
 N A2,BN,AM1,AM2,AM3,DB,EM,ND,SN,FMSBN
"RTN","RCFMOBR1",42,0)
 S A2=0 F  S A2=$O(^PRCA(430,"AC",16,A2)) Q:+A2=0  D
"RTN","RCFMOBR1",43,0)
   .I $D(^PRCA(430,A2,0)),$P(^(0),U,18)'="01610A1",'$$ACCK^PRCAACC(A2) D
"RTN","RCFMOBR1",44,0)
     ..Q:$P(^PRCA(430,A2,0),"^",2)=29
"RTN","RCFMOBR1",45,0)
     ..I $P(^PRCA(430,A2,0),"^",2)=6,$E($P(^(0),"^",18),1,4)=5287,$$PTACCT^PRCAACC($P(^(0),U,18)) Q
"RTN","RCFMOBR1",46,0)
     ..I $P(^PRCA(430,A2,0),"^",2)=6,$P(^(0),"^",18)=5014 Q
"RTN","RCFMOBR1",47,0)
     ..S BN=$P(^PRCA(430,A2,0),U),SN=$P(BN,"-") D
"RTN","RCFMOBR1",48,0)
       ...S FMSBN=$P(BN,"-")_$P(BN,"-",2)
"RTN","RCFMOBR1",49,0)
       ...S AM2=$S($D(^PRCA(430,A2,7)):+^(7),1:0)
"RTN","RCFMOBR1",50,0)
       ...S DB=$E($$NAM^RCFN01(+$P(^PRCA(430,A2,0),U,9)),1,26)
"RTN","RCFMOBR1",51,0)
       ...I '$D(^TMP("OBR",$J,"BN",FMSBN)) D  Q
"RTN","RCFMOBR1",52,0)
         ....S AM1=0
"RTN","RCFMOBR1",53,0)
         ....D SAVE(SN,BN,DB,AM1,AM2,"NOT IN FMS")
"RTN","RCFMOBR1",54,0)
       ...I $D(^TMP("OBR",$J,"BN",FMSBN)) D
"RTN","RCFMOBR1",55,0)
         ....S ND=^PRCF(423.6,A0,1,^TMP("OBR",$J,"BN",FMSBN),0)
"RTN","RCFMOBR1",56,0)
         ....S AM1=+$P(ND,U,6)
"RTN","RCFMOBR1",57,0)
         ....I AM1'=AM2 D SAVE(SN,BN,DB,AM1,AM2,"DISCREPANCY")
"RTN","RCFMOBR1",58,0)
 Q
"RTN","RCFMOBR1",59,0)
SAVE(SN,BILL,DEBTOR,FMSAMT,ARAMT,ERR) N S0,S1,S2,S3,N,DIFF
"RTN","RCFMOBR1",60,0)
 S S0="",$P(S0," ",(19-$L(BILL)))=""
"RTN","RCFMOBR1",61,0)
 S S1="",$P(S1," ",(15-$L(BILL)))=""
"RTN","RCFMOBR1",62,0)
 S S2="",$P(S2," ",(30-$L(DEBTOR)))=""
"RTN","RCFMOBR1",63,0)
 I ERR="NOT IN AR" D  Q
"RTN","RCFMOBR1",64,0)
   .I '$D(^TMP("OBR",$J,SN,ERR)) S ^(ERR)="1^0^0"
"RTN","RCFMOBR1",65,0)
   .S N=^TMP("OBR",$J,SN,ERR)
"RTN","RCFMOBR1",66,0)
   .S ^TMP("OBR",$J,SN,ERR,+N)=BILL_S0_$J(FMSAMT,10,2)
"RTN","RCFMOBR1",67,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U)=+N+1
"RTN","RCFMOBR1",68,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,2)=$P(N,U,2)+1
"RTN","RCFMOBR1",69,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,3)=$P(N,U,3)+FMSAMT
"RTN","RCFMOBR1",70,0)
 I ERR="NOT IN FMS" D  Q
"RTN","RCFMOBR1",71,0)
   .I '$D(^TMP("OBR",$J,SN,ERR)) S ^(ERR)="1^0^0"
"RTN","RCFMOBR1",72,0)
   .S N=^TMP("OBR",$J,SN,ERR)
"RTN","RCFMOBR1",73,0)
   .S ^TMP("OBR",$J,SN,ERR,+N)=BILL_S1_DEBTOR_S2_$J(ARAMT,10,2)
"RTN","RCFMOBR1",74,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U)=+N+1
"RTN","RCFMOBR1",75,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,2)=$P(N,U,2)+1
"RTN","RCFMOBR1",76,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,3)=$P(N,U,3)+ARAMT
"RTN","RCFMOBR1",77,0)
 I ERR="DISCREPANCY" D  Q
"RTN","RCFMOBR1",78,0)
   .I '$D(^TMP("OBR",$J,SN,ERR)) S ^(ERR)="1^0^0^0"
"RTN","RCFMOBR1",79,0)
   .S N=^TMP("OBR",$J,SN,ERR)
"RTN","RCFMOBR1",80,0)
   .S DIFF=$S(FMSAMT>ARAMT:$J(FMSAMT-ARAMT,0,2),1:"+"_$J(ARAMT-FMSAMT,0,2))
"RTN","RCFMOBR1",81,0)
   .S S3="",$P(S3," ",11-$L(DIFF))="",DIFF=S3_DIFF
"RTN","RCFMOBR1",82,0)
   .S ^TMP("OBR",$J,SN,ERR,+N)=BILL_S1_DEBTOR_S2_$J(FMSAMT,10,2)_"  "_$J(ARAMT,10,2)_"   "_DIFF
"RTN","RCFMOBR1",83,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U)=+N+1
"RTN","RCFMOBR1",84,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,2)=$P(N,U,2)+1
"RTN","RCFMOBR1",85,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,3)=$P(N,U,3)+FMSAMT
"RTN","RCFMOBR1",86,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,4)=$P(N,U,4)+ARAMT
"RTN","RCFMOBR1",87,0)
 I ERR="FUND MISMATCH" D  Q
"RTN","RCFMOBR1",88,0)
   .I '$D(^TMP("OBR",$J,SN,ERR)) S ^(ERR)="1^0"
"RTN","RCFMOBR1",89,0)
   .S N=^TMP("OBR",$J,SN,ERR)
"RTN","RCFMOBR1",90,0)
   .S ^TMP("OBR",$J,SN,ERR,+N)=BILL_S2_DEBTOR_S2_FMSAMT
"RTN","RCFMOBR1",91,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U)=+N+1
"RTN","RCFMOBR1",92,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,2)=$P(N,U,2)+1
"RTN","RCFMOBR1",93,0)
 I ERR="RSC MISMATCH" D  Q
"RTN","RCFMOBR1",94,0)
   .I '$D(^TMP("OBR",$J,SN,ERR)) S ^(ERR)="1^0"
"RTN","RCFMOBR1",95,0)
   .S N=^TMP("OBR",$J,SN,ERR)
"RTN","RCFMOBR1",96,0)
   .S ^TMP("OBR",$J,SN,ERR,+N)=BILL_S2_DEBTOR_S2_FMSAMT
"RTN","RCFMOBR1",97,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U)=+N+1
"RTN","RCFMOBR1",98,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,2)=$P(N,U,2)+1
"RTN","RCFMOBR1",99,0)
 I ERR="SUB RSC MISMATCH" D  Q
"RTN","RCFMOBR1",100,0)
   .I '$D(^TMP("OBR",$J,SN,ERR)) S ^(ERR)="1^0"
"RTN","RCFMOBR1",101,0)
   .S N=^TMP("OBR",$J,SN,ERR)
"RTN","RCFMOBR1",102,0)
   .S ^TMP("OBR",$J,SN,ERR,+N)=BILL_S2_DEBTOR_S2_FMSAMT
"RTN","RCFMOBR1",103,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U)=+N+1
"RTN","RCFMOBR1",104,0)
   .S $P(^TMP("OBR",$J,SN,ERR),U,2)=$P(N,U,2)+1
"RTN","RCFMOBR1",105,0)
 Q
"RTN","RCNRIG")
0^5^B10660569
"RTN","RCNRIG",1,0)
RCNRIG ;Washington IRMFO@Altoona, Pa/TJK-IG REPORTS ;6/17/96  11:37 AM
"RTN","RCNRIG",2,0)
 ;;4.5;Accounts Receivable;**41,77,117,103,203,220**;Mar. 20, 1995
"RTN","RCNRIG",3,0)
 Q
"RTN","RCNRIG",4,0)
 ;
"RTN","RCNRIG",5,0)
 ;
"RTN","RCNRIG",6,0)
QUEUE ;  queue extract
"RTN","RCNRIG",7,0)
 W !,"QUEUE STATS PROGRAM"
"RTN","RCNRIG",8,0)
 S ZTIO="",ZTRTN="EN2^RCNRIG",ZTDESC="AR OIG Transaction Extract",ZTDTH=$H
"RTN","RCNRIG",9,0)
 D ^%ZTLOAD,^%ZISC
"RTN","RCNRIG",10,0)
 Q
"RTN","RCNRIG",11,0)
 ;
"RTN","RCNRIG",12,0)
 ;
"RTN","RCNRIG",13,0)
EN2 ;  called by routine rcrjr as part of the nightly process
"RTN","RCNRIG",14,0)
 ;  this will generate the OIG extract of transactions on the 15th
"RTN","RCNRIG",15,0)
 ;  day of each quarter
"RTN","RCNRIG",16,0)
 L +^XTMP("RCNRIG")
"RTN","RCNRIG",17,0)
 K ^XTMP("RCNRIG")
"RTN","RCNRIG",18,0)
 S ^XTMP("RCNRIG",0)=DT_"^"_DT_"^OIG Transaction Extract"
"RTN","RCNRIG",19,0)
 ;
"RTN","RCNRIG",20,0)
 N B0,CNT,TRANS,BILL,TD,STDT,EDT,T0,T1,TT,FYQ,AMT,FUND,RSC
"RTN","RCNRIG",21,0)
 D FYQ
"RTN","RCNRIG",22,0)
 S STDT=$S(FYQ=1:1001,FYQ=2:"0101",FYQ=3:"0401",FYQ=4:"0701")
"RTN","RCNRIG",23,0)
 S STDT=$S(FYQ=1:($E(DT,1,3)-1)_STDT,1:$E(DT,1,3)_STDT)
"RTN","RCNRIG",24,0)
 S EDT=$E(STDT,1,3)_$S(FYQ=1:1231.9999,FYQ=2:"0331.9999",FYQ=3:"0630.9999",1:"0930.9999")
"RTN","RCNRIG",25,0)
 S (CNT,TRANS)=0
"RTN","RCNRIG",26,0)
 F  S TRANS=$O(^PRCA(433,TRANS)) Q:TRANS'?1N.N  D
"RTN","RCNRIG",27,0)
    .S T1=$G(^PRCA(433,TRANS,1)),T0=$G(^(0))
"RTN","RCNRIG",28,0)
    .S TD=$P(T1,U,9) Q:$S(TD<STDT:1,TD>EDT:1,1:0)
"RTN","RCNRIG",29,0)
    .S BILL=$P(T0,U,2) S:'BILL B0="           ",FUND="      ",RSC="    "
"RTN","RCNRIG",30,0)
    .S:BILL B0=$P($G(^PRCA(430,BILL,0)),U),B0=$$LJ^XLFSTR(B0,11)
"RTN","RCNRIG",31,0)
    .S AMT=$P(T1,"^",5) S AMT=$$AMT(AMT)
"RTN","RCNRIG",32,0)
    .S TT=+$P(T1,"^",2) S:'TT TT="                      "
"RTN","RCNRIG",33,0)
    .S:TT TT=$G(^PRCA(430.3,TT,0)),TT=$E($P(TT,"^"),1,22),TT=$$LJ^XLFSTR(TT,22)
"RTN","RCNRIG",34,0)
    .D:BILL
"RTN","RCNRIG",35,0)
       ..S FUND=$$GETFUNDB^RCXFMSUF(BILL,1)
"RTN","RCNRIG",36,0)
       ..S FUND=$$ADJFUND^RCRJRCO(FUND)
"RTN","RCNRIG",37,0)
       ..S RSC=$$GETRSC
"RTN","RCNRIG",38,0)
       ..S FUND=$J(FUND,6),RSC=$J(RSC,4)
"RTN","RCNRIG",39,0)
    .S CNT=CNT+1
"RTN","RCNRIG",40,0)
    .S ^XTMP("RCNRIG",CNT)=$J(TRANS,8)_AMT_B0_TT_FUND_RSC_"$"
"RTN","RCNRIG",41,0)
    .Q
"RTN","RCNRIG",42,0)
 D BUILD("T",FYQ,CNT)
"RTN","RCNRIG",43,0)
 L -^XTMP("RCNRIG")
"RTN","RCNRIG",44,0)
 Q
"RTN","RCNRIG",45,0)
 ;
"RTN","RCNRIG",46,0)
 ;
"RTN","RCNRIG",47,0)
FYQ ;CALCULATE PREVIOUS FY QUARTER
"RTN","RCNRIG",48,0)
 S FYQ=$E(DT,4,5),FYQ=$S(FYQ<4:1,FYQ<7:2,FYQ<10:3,1:4)
"RTN","RCNRIG",49,0)
 Q
"RTN","RCNRIG",50,0)
 ;
"RTN","RCNRIG",51,0)
 ;
"RTN","RCNRIG",52,0)
NOW() N X,Y,%,%H
"RTN","RCNRIG",53,0)
 S %H=$H D YX^%DTC
"RTN","RCNRIG",54,0)
 Q Y
"RTN","RCNRIG",55,0)
 ;
"RTN","RCNRIG",56,0)
 ;
"RTN","RCNRIG",57,0)
BUILD(CODE,FYQ,CNT) ;BUILDS MESSAGE ARRAY
"RTN","RCNRIG",58,0)
 N %Z,XCNP,XMDUZ,XMSCR,XMZ
"RTN","RCNRIG",59,0)
 N MAX,CNTR,SEQ,REC,SITE
"RTN","RCNRIG",60,0)
 S SITE=$$SITE^RCMSITE()
"RTN","RCNRIG",61,0)
 S MAX=$S(CODE="B":350,1:500),(SEQ,CNTR)=0
"RTN","RCNRIG",62,0)
 F CNTR=1:1:CNT D
"RTN","RCNRIG",63,0)
    .D:CNTR#MAX=1
"RTN","RCNRIG",64,0)
       ..K ^XTMP("RCNRIG","BUILD") S SEQ=SEQ+1
"RTN","RCNRIG",65,0)
       ..S REC=0
"RTN","RCNRIG",66,0)
       ..Q
"RTN","RCNRIG",67,0)
    .S REC=REC+1,^XTMP("RCNRIG","BUILD",REC)=^XTMP("RCNRIG",CNTR)
"RTN","RCNRIG",68,0)
    .S:CNTR=CNT ^XTMP("RCNRIG","BUILD",REC+1)="END OF TRANSMISSION FOR SITE# "_SITE_":  TOTAL RECORDS: "_CNT
"RTN","RCNRIG",69,0)
    .I $S(CNTR=CNT:1,CNTR#MAX=0:1,1:0) D
"RTN","RCNRIG",70,0)
       ..N XMY,XMSUB
"RTN","RCNRIG",71,0)
       ..S XMY("XXX@Q-OIG.VA.GOV")="",XMDUZ="AR PACKAGE"
"RTN","RCNRIG",72,0)
       ..S XMSUB=SITE_"/"_$S(CODE="B":"BILL",1:"TRANSACTION")_"/"_FYQ_"/SEQ#: "_SEQ_"/"_$$NOW()
"RTN","RCNRIG",73,0)
       ..S XMTEXT="^XTMP(""RCNRIG"",""BUILD"","
"RTN","RCNRIG",74,0)
       ..D ^XMD
"RTN","RCNRIG",75,0)
       ..Q
"RTN","RCNRIG",76,0)
    .Q
"RTN","RCNRIG",77,0)
 Q
"RTN","RCNRIG",78,0)
 ;
"RTN","RCNRIG",79,0)
 ;
"RTN","RCNRIG",80,0)
AMT(X) ;CONVERTS AMOUNT TO RIGHT JUSTIFIED, 0 FILLED
"RTN","RCNRIG",81,0)
 S X=$J(X,0,2),X=$P(X,".")_$P(X,".",2)
"RTN","RCNRIG",82,0)
 S X=$E("000000000",1,9-$L(X))_X
"RTN","RCNRIG",83,0)
 Q X
"RTN","RCNRIG",84,0)
 ;
"RTN","RCNRIG",85,0)
 ;
"RTN","RCNRIG",86,0)
GETRSC() ;  return the rsc for a bill
"RTN","RCNRIG",87,0)
 I $E(FUND,1,4)'=5287,FUND'=4032 Q $P($G(^PRCA(430,BILL,11)),U,6)
"RTN","RCNRIG",88,0)
 I FUND[5287,'$$PTACCT^PRCAACC(FUND) Q $P($G(^PRCA(430,BILL,11)),U,6)
"RTN","RCNRIG",89,0)
 ;  check missing patient for reimbursable health insurance
"RTN","RCNRIG",90,0)
 I $P(^PRCA(430,BILL,0),"^",2)=9,'$P(^PRCA(430,BILL,0),"^",7) Q "    "
"RTN","RCNRIG",91,0)
 Q $$CALCRSC^RCXFMSUR(BILL)
"RTN","RCRJRBD")
0^6^B43337431
"RTN","RCRJRBD",1,0)
RCRJRBD ;WISC/RFJ,TJK-bad debt extractor and report ;1 Feb 98
"RTN","RCRJRBD",2,0)
 ;;4.5;Accounts Receivable;**101,139,170,193,203,215,220**;Mar 20, 1995
"RTN","RCRJRBD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRBD",4,0)
 Q
"RTN","RCRJRBD",5,0)
 ;
"RTN","RCRJRBD",6,0)
 ;
"RTN","RCRJRBD",7,0)
START(DATEEND) ;  run bad debt report
"RTN","RCRJRBD",8,0)
 ;  the DATEEND is the last day of the month being run
"RTN","RCRJRBD",9,0)
 ;  from the routine RCRJRCOL which is the data extractor.  The
"RTN","RCRJRBD",10,0)
 ;  current receivable dollars is stored in ^TMP($J,"RCRJRBD",SGL)
"RTN","RCRJRBD",11,0)
 ;  where SGL is the standard general ledger 1319, 1338, or 1339.
"RTN","RCRJRBD",12,0)
 ;
"RTN","RCRJRBD",13,0)
 N ACTDATE,ACTUALCA,ACTUALWO,BEGDATE,BILLDA,CATEGORY
"RTN","RCRJRBD",14,0)
 N COLLECT,CONTRACT,DR,ENDDATE,FUND,PAY,PAYMENT,PRIN,PRINCPAL
"RTN","RCRJRBD",15,0)
 N RCRJFMM,RCRJDATE,SGL,TRANDA,TRANDATE,TRANTYPE,VALUE,WRITEOFF
"RTN","RCRJRBD",16,0)
 N RCPRIN,RCTOMCCF,RCVALUE,RSC
"RTN","RCRJRBD",17,0)
 ;
"RTN","RCRJRBD",18,0)
 ;  lock the bad debt file for storing data, lock cannot fail
"RTN","RCRJRBD",19,0)
 ;  this lock can be used to monitor if the report is running
"RTN","RCRJRBD",20,0)
 L +^RC(348.1)
"RTN","RCRJRBD",21,0)
 ;
"RTN","RCRJRBD",22,0)
 ;  calculate the base percentages from past data
"RTN","RCRJRBD",23,0)
 ;  example:  DATEEND=2980331  => BEGDATE=2970300
"RTN","RCRJRBD",24,0)
 ;                             => ENDDATE=2980229
"RTN","RCRJRBD",25,0)
 ;   add one day to ending date to go to next month
"RTN","RCRJRBD",26,0)
 S BEGDATE=($E(DATEEND,1,3)-1)_$E(DATEEND,4,5)_"00"
"RTN","RCRJRBD",27,0)
 S ENDDATE=($$FMADD^XLFDT($E(DATEEND,1,5)_"00",-1))+1
"RTN","RCRJRBD",28,0)
 ;  loop bills activated between these dates
"RTN","RCRJRBD",29,0)
 S ACTDATE=BEGDATE
"RTN","RCRJRBD",30,0)
 F  S ACTDATE=$O(^PRCA(430,"ACTDT",ACTDATE)) Q:'ACTDATE!(ACTDATE>ENDDATE)  D
"RTN","RCRJRBD",31,0)
 . S BILLDA=0 F  S BILLDA=$O(^PRCA(430,"ACTDT",ACTDATE,BILLDA)) Q:'BILLDA  D
"RTN","RCRJRBD",32,0)
 . . S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",33,0)
 . . ;  do not look at prepayments
"RTN","RCRJRBD",34,0)
 . . I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",35,0)
 . . ;
"RTN","RCRJRBD",36,0)
 . . ;  only look at bills with a 0 principal balance
"RTN","RCRJRBD",37,0)
 . . I $P($G(^PRCA(430,BILLDA,7)),"^") Q
"RTN","RCRJRBD",38,0)
 . . ;
"RTN","RCRJRBD",39,0)
 . . ;  only report fund 528701,03,04, and 4032/528709 bills
"RTN","RCRJRBD",40,0)
 . . S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",41,0)
 . . I '$$PTACCT^PRCAACC(FUND),$E(FUND,1,4)'=4032 Q
"RTN","RCRJRBD",42,0)
 . . ;
"RTN","RCRJRBD",43,0)
 . . ;  derive standard general ledger (SGL) from category and fund
"RTN","RCRJRBD",44,0)
 . . S SGL=$$SGL(CATEGORY,FUND)
"RTN","RCRJRBD",45,0)
 . . ;
"RTN","RCRJRBD",46,0)
 . . ;  determine the original amount of the bill (add increase
"RTN","RCRJRBD",47,0)
 . . ;  adjustments below)
"RTN","RCRJRBD",48,0)
 . . S PRIN=$P($G(^PRCA(430,BILLDA,0)),"^",3)
"RTN","RCRJRBD",49,0)
 . . S PAY=0
"RTN","RCRJRBD",50,0)
 . . ;
"RTN","RCRJRBD",51,0)
 . . ;  get the $ transations for bills
"RTN","RCRJRBD",52,0)
 . . S TRANDA=0
"RTN","RCRJRBD",53,0)
 . . F  S TRANDA=$O(^PRCA(433,"C",BILLDA,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",54,0)
 . . . S TRANTYPE=$P($G(^PRCA(433,TRANDA,1)),"^",2)
"RTN","RCRJRBD",55,0)
 . . . I "^1^2^34^43^"'[("^"_TRANTYPE_"^") Q
"RTN","RCRJRBD",56,0)
 . . . S VALUE=$$TRANBAL^RCRJRCOT(TRANDA) I VALUE="" Q
"RTN","RCRJRBD",57,0)
 . . . ;  increase adjustments or re-establish
"RTN","RCRJRBD",58,0)
 . . . I TRANTYPE=1!(TRANTYPE=43) S PRIN=PRIN+$P(VALUE,"^") Q
"RTN","RCRJRBD",59,0)
 . . . ;  payments
"RTN","RCRJRBD",60,0)
 . . . I TRANTYPE=2!(TRANTYPE=34) S PAY=PAY+$P(VALUE,"^") Q
"RTN","RCRJRBD",61,0)
 . . ;
"RTN","RCRJRBD",62,0)
 . . ;  payment cannot be greater than principle
"RTN","RCRJRBD",63,0)
 . . I PAY>PRIN S PAY=PRIN
"RTN","RCRJRBD",64,0)
 . . ;
"RTN","RCRJRBD",65,0)
 . . ;  store the data
"RTN","RCRJRBD",66,0)
 . . S PRINCPAL(SGL)=$G(PRINCPAL(SGL))+PRIN
"RTN","RCRJRBD",67,0)
 . . S PAYMENT(SGL)=$G(PAYMENT(SGL))+PAY
"RTN","RCRJRBD",68,0)
 . . ;
"RTN","RCRJRBD",69,0)
 ;
"RTN","RCRJRBD",70,0)
 ;  calculate the writeoffs from 2/0/98
"RTN","RCRJRBD",71,0)
 ;  2/0/98 is when fms cleared out actual writeoffs and contract adj
"RTN","RCRJRBD",72,0)
 K ^XTMP("PRCABDET")
"RTN","RCRJRBD",73,0)
 S ^XTMP("PRCABDET",0)=$$FMADD^XLFDT(DT,10)_"^"_DT_"^BAD DEBT REPORT AUDIT"
"RTN","RCRJRBD",74,0)
 F TRANTYPE=8,9,10,11,35 D
"RTN","RCRJRBD",75,0)
 . S TRANDATE=2980200
"RTN","RCRJRBD",76,0)
 . ;  do not pick up transactions after the end date
"RTN","RCRJRBD",77,0)
 . F  S TRANDATE=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE)) Q:'TRANDATE!($P(TRANDATE,".")>DATEEND)  D
"RTN","RCRJRBD",78,0)
 . . S TRANDA=0 F  S TRANDA=$O(^PRCA(433,"AT",TRANTYPE,TRANDATE,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRBD",79,0)
 . . . ;  do not look at decrease adj which are not contract adj
"RTN","RCRJRBD",80,0)
 . . . I TRANTYPE=35,'$P($G(^PRCA(433,TRANDA,8)),"^",8) Q
"RTN","RCRJRBD",81,0)
 . . . ;
"RTN","RCRJRBD",82,0)
 . . . S BILLDA=$P($G(^PRCA(433,TRANDA,0)),"^",2)
"RTN","RCRJRBD",83,0)
 . . . I 'BILLDA Q
"RTN","RCRJRBD",84,0)
 . . . S CATEGORY=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCRJRBD",85,0)
 . . . ;  do not look at prepayments
"RTN","RCRJRBD",86,0)
 . . . I 'CATEGORY!(CATEGORY=26) Q
"RTN","RCRJRBD",87,0)
 . . . ;
"RTN","RCRJRBD",88,0)
 . . . ;  only report fund 528701,03,04 and 4032/528709 (ltc) bills
"RTN","RCRJRBD",89,0)
 . . . S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJRBD",90,0)
 . . . I '$$PTACCT^PRCAACC(FUND),$E(FUND,1,4)'=4032 Q
"RTN","RCRJRBD",91,0)
 . . . ;
"RTN","RCRJRBD",92,0)
 . . . ; derive standard general ledger (SGL) from category and fund
"RTN","RCRJRBD",93,0)
 . . . S SGL=$$SGL(CATEGORY,FUND)
"RTN","RCRJRBD",94,0)
 . . . ;
"RTN","RCRJRBD",95,0)
 . . . ;  get the principal transaction value
"RTN","RCRJRBD",96,0)
 . . . S RCVALUE=+$P($$TRANBAL^RCRJRCOT(TRANDA),"^")
"RTN","RCRJRBD",97,0)
 . . . ;  temp variable for value (used below)
"RTN","RCRJRBD",98,0)
 . . . S RCPRIN=RCVALUE
"RTN","RCRJRBD",99,0)
 . . . ;
"RTN","RCRJRBD",100,0)
 . . . ;  add actual writeoff amount for fiscal year
"RTN","RCRJRBD",101,0)
 . . . I TRANTYPE'=35 S ACTUALWO(SGL)=$G(ACTUALWO(SGL))+RCVALUE
"RTN","RCRJRBD",102,0)
 . . . ;  add actual contract adjustments for fiscal year
"RTN","RCRJRBD",103,0)
 . . . I TRANTYPE=35 S ACTUALCA(SGL)=$G(ACTUALCA(SGL))+RCVALUE
"RTN","RCRJRBD",104,0)
 . . . S RSC=$$CALCRSC^RCXFMSUR(BILLDA)
"RTN","RCRJRBD",105,0)
 . . . S ^XTMP("PRCABDET",BILLDA,CATEGORY,FUND,RSC,SGL,TRANDA,TRANDATE,TRANTYPE,RCPRIN,RCVALUE,0,0)=""
"RTN","RCRJRBD",106,0)
 ;
"RTN","RCRJRBD",107,0)
 ;  remove all the entries from the bad debt file
"RTN","RCRJRBD",108,0)
 D DELETALL
"RTN","RCRJRBD",109,0)
 ;
"RTN","RCRJRBD",110,0)
 ;  calculate percentages and store them
"RTN","RCRJRBD",111,0)
 F SGL=1319,1319.2,1338,1339 D
"RTN","RCRJRBD",112,0)
 . ;  collection %
"RTN","RCRJRBD",113,0)
 . S COLLECT=0 I $G(PRINCPAL(SGL)) S COLLECT=$J($G(PAYMENT(SGL))/PRINCPAL(SGL)*100,0,2)
"RTN","RCRJRBD",114,0)
 . S DR=".02////"_+COLLECT_";"
"RTN","RCRJRBD",115,0)
 . ;
"RTN","RCRJRBD",116,0)
 . ;  current month receivable (this is built in the routine
"RTN","RCRJRBD",117,0)
 . ;  RCRJRCO1 and is stored in ^TMP($J,"RCRJRBD",SGL))
"RTN","RCRJRBD",118,0)
 . S DR=DR_".07////"_+$G(^TMP($J,"RCRJRBD",SGL))_";"
"RTN","RCRJRBD",119,0)
 . ;
"RTN","RCRJRBD",120,0)
 . ;  calculate allowance estimate for 1319 and 1338
"RTN","RCRJRBD",121,0)
 . ;  .08 allowance estimate = (writeoff % * current receivables)
"RTN","RCRJRBD",122,0)
 . ;  .09 actual writeoffs fytd
"RTN","RCRJRBD",123,0)
 . I SGL=1319!(SGL=1319.2)!(SGL=1338) D
"RTN","RCRJRBD",124,0)
 . . S WRITEOFF=100-COLLECT
"RTN","RCRJRBD",125,0)
 . . S DR=DR_".03////"_WRITEOFF_";"
"RTN","RCRJRBD",126,0)
 . . S DR=DR_".08////"_$J((WRITEOFF/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",127,0)
 . . S DR=DR_".09////"_+$G(ACTUALWO(SGL))_";"
"RTN","RCRJRBD",128,0)
 . ;  calculate allowance estimate for 1339
"RTN","RCRJRBD",129,0)
 . ;  .08 allowance estimate = (contract % * current receivables)
"RTN","RCRJRBD",130,0)
 . ;  .09 actual contract adjustments fytd
"RTN","RCRJRBD",131,0)
 . I SGL=1339 D
"RTN","RCRJRBD",132,0)
 . . S CONTRACT=100-COLLECT
"RTN","RCRJRBD",133,0)
 . . S DR=DR_".04////"_CONTRACT_";"
"RTN","RCRJRBD",134,0)
 . . S DR=DR_".08////"_$J((CONTRACT/100)*$G(^TMP($J,"RCRJRBD",SGL)),0,2)_";"
"RTN","RCRJRBD",135,0)
 . . S DR=DR_".09////"_+$G(ACTUALCA(SGL))_";"
"RTN","RCRJRBD",136,0)
 . ;
"RTN","RCRJRBD",137,0)
 . ;  set changed locally flag to no
"RTN","RCRJRBD",138,0)
 . S DR=DR_".1////0;"
"RTN","RCRJRBD",139,0)
 . D STORE(SGL,DR)
"RTN","RCRJRBD",140,0)
 ;
"RTN","RCRJRBD",141,0)
 L -^RC(348.1)
"RTN","RCRJRBD",142,0)
 ;
"RTN","RCRJRBD",143,0)
 ;  put the report in a mail message (rcrjfmm=1)
"RTN","RCRJRBD",144,0)
 S RCRJFMM=1
"RTN","RCRJRBD",145,0)
 S RCRJDATE=DATEEND
"RTN","RCRJRBD",146,0)
 D DQ^RCRJRBDR
"RTN","RCRJRBD",147,0)
 Q
"RTN","RCRJRBD",148,0)
 ;
"RTN","RCRJRBD",149,0)
 ;
"RTN","RCRJRBD",150,0)
STORE(SGL,DR) ;  store data for Standard Ledger Account
"RTN","RCRJRBD",151,0)
 N D0,DA,DD,DI,DIC,DIE,DINUM,DO,DQ,X,Y
"RTN","RCRJRBD",152,0)
 S DIC="^RC(348.1,",DIC(0)="L",(X,DINUM)=SGL,DIC("DR")=DR
"RTN","RCRJRBD",153,0)
 D FILE^DICN
"RTN","RCRJRBD",154,0)
 Q
"RTN","RCRJRBD",155,0)
 ;
"RTN","RCRJRBD",156,0)
 ;
"RTN","RCRJRBD",157,0)
DELETALL ;  delete all the entries from the bad debt file
"RTN","RCRJRBD",158,0)
 N %,DA,DIC,DIK,X,Y
"RTN","RCRJRBD",159,0)
 S DIK="^RC(348.1,"
"RTN","RCRJRBD",160,0)
 S DA=0 F  S DA=$O(^RC(348.1,DA)) Q:'DA  D ^DIK
"RTN","RCRJRBD",161,0)
 Q
"RTN","RCRJRBD",162,0)
 ;
"RTN","RCRJRBD",163,0)
 ;
"RTN","RCRJRBD",164,0)
WD3() ;  return the third work day of the month
"RTN","RCRJRBD",165,0)
 N J,P,V,X
"RTN","RCRJRBD",166,0)
 S J=0 F P=$E(DT,1,5)_"01":1 S V=$$DOW^XLFDT(P,1) I V,V<6,'$D(^HOLIDAY("B",P)) S J=J+1 Q:J=3
"RTN","RCRJRBD",167,0)
 S X=+$E(P,6,7)
"RTN","RCRJRBD",168,0)
 Q X
"RTN","RCRJRBD",169,0)
 ;
"RTN","RCRJRBD",170,0)
 ;
"RTN","RCRJRBD",171,0)
PREVMONT(FORDATE) ; return the previous month's date
"RTN","RCRJRBD",172,0)
 N PREVDATE
"RTN","RCRJRBD",173,0)
 S PREVDATE=$E(FORDATE,1,5)-1
"RTN","RCRJRBD",174,0)
 I $E(PREVDATE,4,5)="00" S PREVDATE=($E(PREVDATE,1,3)-1)_12
"RTN","RCRJRBD",175,0)
 Q PREVDATE_"00"
"RTN","RCRJRBD",176,0)
 ;
"RTN","RCRJRBD",177,0)
 ; derive standard general ledger (SGL) from category and fund
"RTN","RCRJRBD",178,0)
SGL(CATEGORY,FUND) ;
"RTN","RCRJRBD",179,0)
 I $G(FUND)=528709 Q 1319.2 ;new long term care fund
"RTN","RCRJRBD",180,0)
 I $E($G(FUND),1,4)=4032 Q 1319.2 ; breakout long term care as a subset
"RTN","RCRJRBD",181,0)
 I CATEGORY=8 Q 1339   ; crime or per. vio.
"RTN","RCRJRBD",182,0)
 I CATEGORY=9 Q 1339   ; reimbursable health insurance
"RTN","RCRJRBD",183,0)
 I CATEGORY=10 Q 1338  ; tort feasor
"RTN","RCRJRBD",184,0)
 I CATEGORY=21 Q 1339  ; medicare
"RTN","RCRJRBD",185,0)
 Q 1319
"RTN","RCRJRBDR")
0^7^B60833292
"RTN","RCRJRBDR",1,0)
RCRJRBDR ;WISC/RFJ,TJK-bad debt report generator ;1 Feb 98
"RTN","RCRJRBDR",2,0)
 ;;4.5;Accounts Receivable;**101,139,170,191,203,215,220**;Mar 20, 1995
"RTN","RCRJRBDR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRBDR",4,0)
 Q
"RTN","RCRJRBDR",5,0)
 ;
"RTN","RCRJRBDR",6,0)
 ;
"RTN","RCRJRBDR",7,0)
PRINT ;  print report on printer, called from menu option
"RTN","RCRJRBDR",8,0)
 N RCRJDATE
"RTN","RCRJRBDR",9,0)
 W !!,"This option will print the Bad Debt Report.  This report is automatically"
"RTN","RCRJRBDR",10,0)
 W !,"generated on the day after the EOAM.  The estimated value can be locally"
"RTN","RCRJRBDR",11,0)
 W !,"changed on the first workday after the EOAM."
"RTN","RCRJRBDR",12,0)
 W !,"On the next to last workday of the month, the report is transmitted to FMS.",!
"RTN","RCRJRBDR",13,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","RCRJRBDR",14,0)
 I $D(IO("Q")) D  Q
"RTN","RCRJRBDR",15,0)
 . S ZTRTN="DQ^RCRJRBDR",ZTDESC="Bad Debt Report"
"RTN","RCRJRBDR",16,0)
 . D ^%ZTLOAD
"RTN","RCRJRBDR",17,0)
 ;
"RTN","RCRJRBDR",18,0)
 W !,"please wait"
"RTN","RCRJRBDR",19,0)
 D DQ
"RTN","RCRJRBDR",20,0)
 Q
"RTN","RCRJRBDR",21,0)
 ;
"RTN","RCRJRBDR",22,0)
 ;
"RTN","RCRJRBDR",23,0)
DQ ;  generate the report
"RTN","RCRJRBDR",24,0)
 ;  rcrjfmm = flag to put in mail message (if $g(rcrjfmm)) (optional)
"RTN","RCRJRBDR",25,0)
 ;  rcrjdate = date month and year for report (optional)
"RTN","RCRJRBDR",26,0)
 ;  rcrjfxsv = fms document id number if sent to fms (optional)
"RTN","RCRJRBDR",27,0)
 ;             (newed and set by rcxfmssv, label Q)
"RTN","RCRJRBDR",28,0)
 ;
"RTN","RCRJRBDR",29,0)
 N %,%I,CHANGED,DATA,DATA1319,DATA1338,DATA1339,DATALTC,DATEREPT,ENDDATE,X
"RTN","RCRJRBDR",30,0)
 N LINE,RCRJFLAG,SCREEN,SPACE,Y
"RTN","RCRJRBDR",31,0)
 ;
"RTN","RCRJRBDR",32,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRBDR",33,0)
 S SPACE="",$P(SPACE," ",81)=""
"RTN","RCRJRBDR",34,0)
 ;  the date of the report is for previous month if the DT is before the EOAM date of the current month,  it is for the current month if the date is after the EOAM cut-off date.
"RTN","RCRJRBDR",35,0)
 I $G(RCRJDATE) S RCRJDATE=$E($$LDATE^RCRJR(RCRJDATE),1,5)_"00"
"RTN","RCRJRBDR",36,0)
 I '$G(RCRJDATE) D
"RTN","RCRJRBDR",37,0)
 .I $E(DT,6,7)'>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$$PREVMONT^RCRJRBD(DT)
"RTN","RCRJRBDR",38,0)
 .I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$E($$LDATE^RCRJR(DT),1,5)_"00"
"RTN","RCRJRBDR",39,0)
 S Y=$E(RCRJDATE,1,5)_"00" D DD^%DT S DATEREPT=Y
"RTN","RCRJRBDR",40,0)
 S LINE=0
"RTN","RCRJRBDR",41,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",42,0)
 D SETLINE($E(SPACE,1,32)_"Bad Debt Report")
"RTN","RCRJRBDR",43,0)
 D SETLINE($E(SPACE,1,13)_"Allowance for Bad Debt and Contract Adjustment Report")
"RTN","RCRJRBDR",44,0)
 D SETLINE($E(SPACE,1,27)_"for the month of "_DATEREPT)
"RTN","RCRJRBDR",45,0)
 I $D(RCRJFXSV) D
"RTN","RCRJRBDR",46,0)
 . D SETLINE(" ")
"RTN","RCRJRBDR",47,0)
 . I $E(RCRJFXSV,1,2)="SV" D SETLINE($E(SPACE,1,13)_"***** Report sent to FMS, doc id: "_RCRJFXSV_" *****") Q
"RTN","RCRJRBDR",48,0)
 . ;  report errored out or did not get generated to fms
"RTN","RCRJRBDR",49,0)
 . D SETLINE($E(SPACE,1,10)_"***** NOTICE:  Report was NOT sent to FMS, the message is *****")
"RTN","RCRJRBDR",50,0)
 . D SETLINE($E(SPACE,1,10)_"***** "_RCRJFXSV_" *****")
"RTN","RCRJRBDR",51,0)
 ;
"RTN","RCRJRBDR",52,0)
 ;  show mccf
"RTN","RCRJRBDR",53,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",54,0)
 D SETLINE($E(SPACE,1,26)_"Medical Care Collection Fund")
"RTN","RCRJRBDR",55,0)
 I $E($G(RCRJDATE),2,5)'<"0410" D SETLINE($E(SPACE,1,26)_" Funds 528701, 528703, & 528704")
"RTN","RCRJRBDR",56,0)
 I $E($G(RCRJDATE),2,5)<"0410" D SETLINE($E(SPACE,1,26)_" Funds 5287.1, 5287.3, & 5287.4")
"RTN","RCRJRBDR",57,0)
 D SETLINE($E(SPACE,1,26)_"----------------------------")
"RTN","RCRJRBDR",58,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",59,0)
 D SETLINE("Calculated           "_$J("            ",18)_$J(" Third Party",18))
"RTN","RCRJRBDR",60,0)
 D SETLINE("Percentages          "_$J(" First Party",18)_$J("Contract Adj",18)_$J("Tort Feasors",18))
"RTN","RCRJRBDR",61,0)
 D SETLINE("For                  "_$J("    SGL 1319",18)_$J("    SGL 1339",18)_$J("    SGL 1338",18))
"RTN","RCRJRBDR",62,0)
 D SETLINE("---------------------"_$J("------------",18)_$J("------------",18)_$J("------------",18))
"RTN","RCRJRBDR",63,0)
 S DATA1319=$G(^RC(348.1,+$O(^RC(348.1,"B",1319,0)),0))
"RTN","RCRJRBDR",64,0)
 S DATA1338=$G(^RC(348.1,+$O(^RC(348.1,"B",1338,0)),0))
"RTN","RCRJRBDR",65,0)
 S DATA1339=$G(^RC(348.1,+$O(^RC(348.1,"B",1339,0)),0))
"RTN","RCRJRBDR",66,0)
 D SETLINE("Collection          %"_$J($P(DATA1319,"^",2),18,2)_$J($P(DATA1339,"^",2),18,2)_$J($P(DATA1338,"^",2),18,2))
"RTN","RCRJRBDR",67,0)
 D SETLINE("Write-Off           %"_$J($P(DATA1319,"^",3),18,2)_$J($P(DATA1339,"^",3),18,2)_$J($P(DATA1338,"^",3),18,2))
"RTN","RCRJRBDR",68,0)
 D SETLINE("Contract Adjustment %"_$J($P(DATA1319,"^",4),18,2)_$J($P(DATA1339,"^",4),18,2)_$J($P(DATA1338,"^",4),18,2))
"RTN","RCRJRBDR",69,0)
 D SETLINE("---------------------"_$J("------------",18)_$J("------------",18)_$J("------------",18))
"RTN","RCRJRBDR",70,0)
 D SETLINE("TOTAL               %"_$J(100,18,2)_$J(100,18,2)_$J(100,18,2))
"RTN","RCRJRBDR",71,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",72,0)
 ;
"RTN","RCRJRBDR",73,0)
 S DATALTC=$G(^RC(348.1,+$O(^RC(348.1,"B",1319.2,0)),0))
"RTN","RCRJRBDR",74,0)
 I $E($G(RCRJDATE),2,5)'<"0410" D SETLINE($E(SPACE,1,26)_"  Extended (LTC) Care Fund 528709")
"RTN","RCRJRBDR",75,0)
 I $E($G(RCRJDATE),2,5)<"0410" D SETLINE($E(SPACE,1,26)_"  Extended (LTC) Care Fund 4032")
"RTN","RCRJRBDR",76,0)
 D SETLINE($E(SPACE,1,26)_"---------------------------------")
"RTN","RCRJRBDR",77,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",78,0)
 I $E($G(RCRJDATE),2,5)'<"0410" D SETLINE("Calculated           "_$J("   Fund 528709",18))
"RTN","RCRJRBDR",79,0)
 I $E($G(RCRJDATE),2,5)<"0410" D SETLINE("Calculated           "_$J("   Fund 4032",18))
"RTN","RCRJRBDR",80,0)
 D SETLINE("Percentages          "_$J(" First Party",18))
"RTN","RCRJRBDR",81,0)
 D SETLINE("For                  "_$J("    SGL 1319",18))
"RTN","RCRJRBDR",82,0)
 D SETLINE("---------------------"_$J("------------",18))
"RTN","RCRJRBDR",83,0)
 D SETLINE("Collection          %"_$J($P(DATALTC,"^",2),18,2))
"RTN","RCRJRBDR",84,0)
 D SETLINE("Write-Off           %"_$J($P(DATALTC,"^",3),18,2))
"RTN","RCRJRBDR",85,0)
 D SETLINE("Contract Adjustment %"_$J($P(DATALTC,"^",4),18,2))
"RTN","RCRJRBDR",86,0)
 D SETLINE("---------------------"_$J("------------",18))
"RTN","RCRJRBDR",87,0)
 D SETLINE("TOTAL               %"_$J(100,18,2))
"RTN","RCRJRBDR",88,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",89,0)
 ;
"RTN","RCRJRBDR",90,0)
 ;  show totals
"RTN","RCRJRBDR",91,0)
 ;  1319 mccf allowance
"RTN","RCRJRBDR",92,0)
 D SETLINE("Allowance for Bad Debt - First Party (SGL 1319 MCCF):")
"RTN","RCRJRBDR",93,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",94,0)
 S CHANGED="  " I $P(DATA1319,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",95,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1319,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",96,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1319,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",97,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",98,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1319,"^",8)+$P(DATA1319,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",99,0)
 I $P(DATA1319,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",100,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",101,0)
 ;
"RTN","RCRJRBDR",102,0)
 ;  1319 ltc allowance
"RTN","RCRJRBDR",103,0)
 D SETLINE("Allowance for Bad Debt - First Party (SGL 1319 LTC 528709):")
"RTN","RCRJRBDR",104,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",105,0)
 S CHANGED="  " I $P(DATALTC,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",106,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATALTC,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",107,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATALTC,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",108,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",109,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATALTC,"^",8)+$P(DATALTC,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",110,0)
 I $P(DATALTC,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",111,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",112,0)
 ;
"RTN","RCRJRBDR",113,0)
 ;  1339 allowance
"RTN","RCRJRBDR",114,0)
 D SETLINE("Allowance for Contract Adj - Third Party (SGL 1339):")
"RTN","RCRJRBDR",115,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",116,0)
 S CHANGED="  " I $P(DATA1339,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",117,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1339,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",118,0)
 D SETLINE($E("Bad Debt Contract Adj (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1339,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",119,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",120,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1339,"^",8)+$P(DATA1339,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",121,0)
 I $P(DATA1339,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",122,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",123,0)
 ;
"RTN","RCRJRBDR",124,0)
 ;  1338 allowance
"RTN","RCRJRBDR",125,0)
 D SETLINE("Allowance for Bad Debt - Tort Feasors (SGL 1338):")
"RTN","RCRJRBDR",126,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",127,0)
 S CHANGED="  " I $P(DATA1338,"^",10) S CHANGED="**"
"RTN","RCRJRBDR",128,0)
 D SETLINE($E("Allowance Estimate for "_DATEREPT_SPACE,1,35)_":"_$J($P(DATA1338,"^",8),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",129,0)
 D SETLINE($E("Bad Debt Write-Off (Plus)  "_SPACE,1,35)_":"_$J($P(DATA1338,"^",9),16,2)_"    (Normally Debit Value )")
"RTN","RCRJRBDR",130,0)
 D SETLINE("----------------------------------------------------")
"RTN","RCRJRBDR",131,0)
 D SETLINE($E("Transmitted Amount to FMS for Month"_SPACE,1,35)_":"_$J($P(DATA1338,"^",8)+$P(DATA1338,"^",9),16,2)_" "_CHANGED_" (Normally Credit Value)")
"RTN","RCRJRBDR",132,0)
 I $P(DATA1338,"^",10) D SETLINE($E(SPACE,1,53)_"**  Changed Locally")
"RTN","RCRJRBDR",133,0)
 D SETLINE(" ")
"RTN","RCRJRBDR",134,0)
 D SETLINE("Report Footnotes:")
"RTN","RCRJRBDR",135,0)
 D SETLINE("-----------------")
"RTN","RCRJRBDR",136,0)
 ;
"RTN","RCRJRBDR",137,0)
 D ENDOFREP^RCRJRBDT
"RTN","RCRJRBDR",138,0)
 ;
"RTN","RCRJRBDR",139,0)
 ;  put report in mailman
"RTN","RCRJRBDR",140,0)
 I $G(RCRJFMM) D  D Q Q
"RTN","RCRJRBDR",141,0)
 . N XMY
"RTN","RCRJRBDR",142,0)
 . S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJRBDR",143,0)
 . S %=$$SENDMSG^RCRJRCOR("BAD DEBT REPORT",.XMY)
"RTN","RCRJRBDR",144,0)
 ;
"RTN","RCRJRBDR",145,0)
 ;  print report
"RTN","RCRJRBDR",146,0)
 S SCREEN=0 I '$D(ZTQUEUED),IO=IO(0),$E(IOST)="C" S SCREEN=1
"RTN","RCRJRBDR",147,0)
 U IO W @IOF
"RTN","RCRJRBDR",148,0)
 S LINE=1 F  S LINE=$O(^TMP($J,"RCRJRCORMM",LINE)) Q:'LINE!($G(RCRJFLAG))  D
"RTN","RCRJRBDR",149,0)
 . I $Y>(IOSL-5) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  W @IOF F %=2:1:5 W !,^TMP($J,"RCRJRCORMM",%)
"RTN","RCRJRBDR",150,0)
 . W !,^TMP($J,"RCRJRCORMM",LINE)
"RTN","RCRJRBDR",151,0)
 I '$G(RCRJFLAG),SCREEN R !!,"<end of report, press return to continue>",X:DTIME
"RTN","RCRJRBDR",152,0)
 D ^%ZISC
"RTN","RCRJRBDR",153,0)
 ;
"RTN","RCRJRBDR",154,0)
Q K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRBDR",155,0)
 Q
"RTN","RCRJRBDR",156,0)
 ;
"RTN","RCRJRBDR",157,0)
 ;
"RTN","RCRJRBDR",158,0)
SETLINE(DATA) ;  build the line for the report
"RTN","RCRJRBDR",159,0)
 S LINE=LINE+1,^TMP($J,"RCRJRCORMM",LINE)=DATA
"RTN","RCRJRBDR",160,0)
 Q
"RTN","RCRJRCOC")
0^13^B45922458
"RTN","RCRJRCOC",1,0)
RCRJRCOC ;WISC/RFJ/BGJ-count current receivables ;1 Aug 00
"RTN","RCRJRCOC",2,0)
 ;;4.5;Accounts Receivable;**156,170,182,203,220**;Mar 20, 1995
"RTN","RCRJRCOC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRCOC",4,0)
 Q
"RTN","RCRJRCOC",5,0)
 ;
"RTN","RCRJRCOC",6,0)
 ;
"RTN","RCRJRCOC",7,0)
CURRENT(RCBILLDA,RCVALUE) ;  count current bills balance
"RTN","RCRJRCOC",8,0)
 ;  rcvalue = prin ^ int ^ admin ^ mf ^ cc
"RTN","RCRJRCOC",9,0)
 ;
"RTN","RCRJRCOC",10,0)
 N %,RCFUND,RCRSC,RCTOHSIF,RCTOMCCF,SGL,TYPE
"RTN","RCRJRCOC",11,0)
 ;
"RTN","RCRJRCOC",12,0)
 ;  calculate the rsc for the bill.  the rsc is only used for
"RTN","RCRJRCOC",13,0)
 ;  mccf bills
"RTN","RCRJRCOC",14,0)
 S RCRSC=""
"RTN","RCRJRCOC",15,0)
 I $$ACCK^PRCAACC(RCBILLDA) S RCRSC=$$CALCRSC^RCXFMSUR(RCBILLDA)
"RTN","RCRJRCOC",16,0)
 ;
"RTN","RCRJRCOC",17,0)
 ;  calculate the amount that goes to mccf and hsif
"RTN","RCRJRCOC",18,0)
 D MCCFHSIF(RCBILLDA,RCVALUE,RCRSC,DATEEND+1)
"RTN","RCRJRCOC",19,0)
 ;
"RTN","RCRJRCOC",20,0)
 ;  store the data for the ndb, if a 0 is returned by the function,
"RTN","RCRJRCOC",21,0)
 ;  then the bill has already been counted as a current receivable,quit
"RTN","RCRJRCOC",22,0)
 I '$$NDBSTORE(RCBILLDA,RCVALUE,1) Q
"RTN","RCRJRCOC",23,0)
 ;
"RTN","RCRJRCOC",24,0)
 ;  store results for FMS SV document for accrued bills only
"RTN","RCRJRCOC",25,0)
 ;  do not include prepayments (26)
"RTN","RCRJRCOC",26,0)
 I $$ACCK^PRCAACC(RCBILLDA),$P($G(^PRCA(430,RCBILLDA,0)),"^",2)'=26 D
"RTN","RCRJRCOC",27,0)
 .   ;  get the bills fund
"RTN","RCRJRCOC",28,0)
 .   S RCFUND=$$GETFUNDB^RCXFMSUF(RCBILLDA)
"RTN","RCRJRCOC",29,0)
 .   S RCFUND=$$ADJFUND^RCRJRCO(RCFUND) ; may remove the line after 10/1/03
"RTN","RCRJRCOC",30,0)
 .   ;
"RTN","RCRJRCOC",31,0)
 .   ;  ----- this code is used to set up the SV code sheet -----
"RTN","RCRJRCOC",32,0)
 .   S TYPE=21
"RTN","RCRJRCOC",33,0)
 .   ;  special type for tort feasor
"RTN","RCRJRCOC",34,0)
 .   I $E(RCRSC,1,2)=86 S TYPE="2A"
"RTN","RCRJRCOC",35,0)
 .   ;  store dollars to mccf and hsif
"RTN","RCRJRCOC",36,0)
 .   I RCTOMCCF S ^TMP($J,"RCRJRCOLSV",TYPE,RCFUND,RCRSC)=$G(^TMP($J,"RCRJRCOLSV",TYPE,RCFUND,RCRSC))+RCTOMCCF
"RTN","RCRJRCOC",37,0)
 .   I RCTOHSIF S ^TMP($J,"RCRJRCOLSV",21,5358.1,$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z"))=$G(^TMP($J,"RCRJRCOLSV",21,5358.1,$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z")))+RCTOHSIF
"RTN","RCRJRCOC",38,0)
 .   ;
"RTN","RCRJRCOC",39,0)
 .   ;  ----- this code is used to build the user report (%=date active)
"RTN","RCRJRCOC",40,0)
 .   S %=+$P($P($G(^PRCA(430,RCBILLDA,6)),"^",21),".")
"RTN","RCRJRCOC",41,0)
 .   S ^TMP($J,"RCRJRCOLREPORT",%,RCBILLDA)=$P(RCVALUE,"^")_"^"_($P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5))_"^SV"_TYPE
"RTN","RCRJRCOC",42,0)
 .   ;
"RTN","RCRJRCOC",43,0)
 .   ;  ----- this code is used to build the OIG extract, piece 3 = GL acct
"RTN","RCRJRCOC",44,0)
 .   S ^TMP($J,"RCRJROIG",RCBILLDA)=$P(RCVALUE,"^")_"^"_($P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5))_"^"_$S(TYPE=21:1315,1:1333)
"RTN","RCRJRCOC",45,0)
 .   ;
"RTN","RCRJRCOC",46,0)
 .   ;  ----- this code is used to set up medicare supplemental SVs
"RTN","RCRJRCOC",47,0)
 .   S %=$G(^PRCA(430,RCBILLDA,13))
"RTN","RCRJRCOC",48,0)
 .   ;  medicare contract adjustment field 131
"RTN","RCRJRCOC",49,0)
 .   I $P(%,"^",1) S ^TMP($J,"RCRJRCOLSV",17,RCFUND,RCRSC)=$G(^TMP($J,"RCRJRCOLSV",17,RCFUND,RCRSC))+$P(%,"^",1)
"RTN","RCRJRCOC",50,0)
 .   ;  medicare unreimbursable medicare expense field 132
"RTN","RCRJRCOC",51,0)
 .   I $P(%,"^",2) S ^TMP($J,"RCRJRCOLSV",18,RCFUND,RCRSC)=$G(^TMP($J,"RCRJRCOLSV",18,RCFUND,RCRSC))+$P(%,"^",2)
"RTN","RCRJRCOC",52,0)
 .   ;
"RTN","RCRJRCOC",53,0)
 .   ;  ----- this code is used to set up the bad debt report -----
"RTN","RCRJRCOC",54,0)
 .   S SGL=1319
"RTN","RCRJRCOC",55,0)
 .   I $E(RCRSC,1,2)=85 S SGL=1339  ;  reimbursable health insurance
"RTN","RCRJRCOC",56,0)
 .   I $E(RCRSC,1,2)=86 S SGL=1338  ;  tort feasor
"RTN","RCRJRCOC",57,0)
 .   ;  store dollars to mccf and hsif.  both are sgl 1319 so 1319.1 is
"RTN","RCRJRCOC",58,0)
 .   ;  used to put hsif in a subset of 1319
"RTN","RCRJRCOC",59,0)
 .   I RCTOMCCF D
"RTN","RCRJRCOC",60,0)
 .   .   ;  long term care fund 4032(old), 528709 (new)
"RTN","RCRJRCOC",61,0)
 .   .   I (RCFUND=4032)!(RCFUND=528709) S ^TMP($J,"RCRJRBD",1319.2)=$G(^TMP($J,"RCRJRBD",1319.2))+RCTOMCCF Q
"RTN","RCRJRCOC",62,0)
 .   .   ;  fund 528701,528703,528704
"RTN","RCRJRCOC",63,0)
 .   .   S ^TMP($J,"RCRJRBD",SGL)=$G(^TMP($J,"RCRJRBD",SGL))+RCTOMCCF
"RTN","RCRJRCOC",64,0)
 .   I RCTOHSIF S ^TMP($J,"RCRJRBD",1319.1)=$G(^TMP($J,"RCRJRBD",1319.1))+RCTOHSIF
"RTN","RCRJRCOC",65,0)
 ;
"RTN","RCRJRCOC",66,0)
 ;  store the interest, admin, mf, cc on the SV code sheet
"RTN","RCRJRCOC",67,0)
 ;  interest (type P2; fund 1435; rsc 8047)
"RTN","RCRJRCOC",68,0)
 I $P(RCVALUE,"^",2) S ^TMP($J,"RCRJRCOLSV","P2",1435,8047)=$G(^TMP($J,"RCRJRCOLSV","P2",1435,8047))+$P(RCVALUE,"^",2)
"RTN","RCRJRCOC",69,0)
 ;  admin (type P2; fund 3220; rsc 8046)
"RTN","RCRJRCOC",70,0)
 I $P(RCVALUE,"^",3) S ^TMP($J,"RCRJRCOLSV","P2",3220,8046)=$G(^TMP($J,"RCRJRCOLSV","P2",3220,8046))+$P(RCVALUE,"^",3)
"RTN","RCRJRCOC",71,0)
 ;  mf + cc (type P2; fund 0869; rsc 8048)
"RTN","RCRJRCOC",72,0)
 S %=$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5)
"RTN","RCRJRCOC",73,0)
 I % S ^TMP($J,"RCRJRCOLSV","P2","0869",8048)=$G(^TMP($J,"RCRJRCOLSV","P2","0869",8048))+%
"RTN","RCRJRCOC",74,0)
 Q
"RTN","RCRJRCOC",75,0)
 ;
"RTN","RCRJRCOC",76,0)
 ;
"RTN","RCRJRCOC",77,0)
WRITEOFF(RCBILLDA,RCVALUE,RCRITER2) ;  count write offs
"RTN","RCRJRCOC",78,0)
 ;  rcvalue = prin ^ int ^ admin ^ mf ^ cc
"RTN","RCRJRCOC",79,0)
 ;  rcriter2 = write off criteria tracked in ndb
"RTN","RCRJRCOC",80,0)
 ;
"RTN","RCRJRCOC",81,0)
 N %,RCFUND,RCRSC,RCTOHSIF,RCTOMCCF,TYPE
"RTN","RCRJRCOC",82,0)
 ;
"RTN","RCRJRCOC",83,0)
 ;  calculate the rsc for the bill.  the rsc is only used for
"RTN","RCRJRCOC",84,0)
 ;  mccf bills
"RTN","RCRJRCOC",85,0)
 S RCRSC=""
"RTN","RCRJRCOC",86,0)
 I $$ACCK^PRCAACC(RCBILLDA) S RCRSC=$$CALCRSC^RCXFMSUR(RCBILLDA)
"RTN","RCRJRCOC",87,0)
 ;
"RTN","RCRJRCOC",88,0)
 ;  calculate the amount that goes to mccf and hsif
"RTN","RCRJRCOC",89,0)
 D MCCFHSIF(RCBILLDA,RCVALUE,RCRSC,DATEEND+1)
"RTN","RCRJRCOC",90,0)
 ;
"RTN","RCRJRCOC",91,0)
 ;  store the data for the ndb, if a 0 is returned by the function,
"RTN","RCRJRCOC",92,0)
 ;  then the bill has already been counted as a current receivable,quit
"RTN","RCRJRCOC",93,0)
 I '$$NDBSTORE(RCBILLDA,RCVALUE,RCRITER2) Q
"RTN","RCRJRCOC",94,0)
 ;
"RTN","RCRJRCOC",95,0)
 ;  store results for FMS WR document
"RTN","RCRJRCOC",96,0)
 ;  do not include prepayments (26)
"RTN","RCRJRCOC",97,0)
 I $$ACCK^PRCAACC(RCBILLDA),$P($G(^PRCA(430,RCBILLDA,0)),"^",2)'=26 D
"RTN","RCRJRCOC",98,0)
 .   ;  get the bills fund
"RTN","RCRJRCOC",99,0)
 .   S RCFUND=$$GETFUNDB^RCXFMSUF(RCBILLDA)
"RTN","RCRJRCOC",100,0)
 .   S RCFUND=$$ADJFUND^RCRJRCO(RCFUND) ; may remove the line after 10/1/03
"RTN","RCRJRCOC",101,0)
 .   ;
"RTN","RCRJRCOC",102,0)
 .   S TYPE="04"
"RTN","RCRJRCOC",103,0)
 .   ;  special type for tort feasor
"RTN","RCRJRCOC",104,0)
 .   I $E(RCRSC,1,2)=86 S TYPE=23
"RTN","RCRJRCOC",105,0)
 .   ;  for contract adjustments (criter2=20), the type is 06
"RTN","RCRJRCOC",106,0)
 .   I RCRITER2=20 S TYPE="06"
"RTN","RCRJRCOC",107,0)
 .   ;  store dollars to mccf and hsif
"RTN","RCRJRCOC",108,0)
 .   I RCTOMCCF S ^TMP($J,"RCRJRCOLWR",TYPE,RCFUND,RCRSC)=$G(^TMP($J,"RCRJRCOLWR",TYPE,RCFUND,RCRSC))+RCTOMCCF
"RTN","RCRJRCOC",109,0)
 .   I RCTOHSIF S ^TMP($J,"RCRJRCOLWR",TYPE,5358.1,$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z"))=$G(^TMP($J,"RCRJRCOLWR",TYPE,5358.1,$S(RCRSC="8BZZ":"8B1Z",1:"8C1Z")))+RCTOHSIF
"RTN","RCRJRCOC",110,0)
 ;
"RTN","RCRJRCOC",111,0)
 ;  store the interest, admin, mf, cc on the WR code sheet
"RTN","RCRJRCOC",112,0)
 ;  interest (type P4; fund 1435; rsc 8047)
"RTN","RCRJRCOC",113,0)
 I $P(RCVALUE,"^",2) S ^TMP($J,"RCRJRCOLWR","P4",1435,8047)=$G(^TMP($J,"RCRJRCOLWR","P4",1435,8047))+$P(RCVALUE,"^",2)
"RTN","RCRJRCOC",114,0)
 ;  admin (type P4; fund 3220; rsc 8046)
"RTN","RCRJRCOC",115,0)
 I $P(RCVALUE,"^",3) S ^TMP($J,"RCRJRCOLWR","P4",3220,8046)=$G(^TMP($J,"RCRJRCOLWR","P4",3220,8046))+$P(RCVALUE,"^",3)
"RTN","RCRJRCOC",116,0)
 ;  mf + cc (type P4; fund 0869; rsc 8048)
"RTN","RCRJRCOC",117,0)
 S %=$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5)
"RTN","RCRJRCOC",118,0)
 I % S ^TMP($J,"RCRJRCOLWR","P4","0869",8048)=$G(^TMP($J,"RCRJRCOLWR","P4","0869",8048))+%
"RTN","RCRJRCOC",119,0)
 Q
"RTN","RCRJRCOC",120,0)
 ;
"RTN","RCRJRCOC",121,0)
 ;
"RTN","RCRJRCOC",122,0)
NDBSTORE(RCBILLDA,RCVALUE,RCRITER2) ;  store the data for the NDB
"RTN","RCRJRCOC",123,0)
 ;  returns a 1 if the bill has not been counted
"RTN","RCRJRCOC",124,0)
 ;  returns a 0 if the bill has been counted
"RTN","RCRJRCOC",125,0)
 N %,CRITERIA
"RTN","RCRJRCOC",126,0)
 ;
"RTN","RCRJRCOC",127,0)
 ;  this line of code will prevent duplicate counts if a sites cross
"RTN","RCRJRCOC",128,0)
 ;  references in file 430 (actdt and asdt) are duplicated (incorrect)
"RTN","RCRJRCOC",129,0)
 I RCRITER2<13,$D(^TMP($J,"RCRJRCOL","COUNT",RCBILLDA,RCRITER2)) Q 0
"RTN","RCRJRCOC",130,0)
 ;
"RTN","RCRJRCOC",131,0)
 ;  get a bills criteria 1,3,4,5
"RTN","RCRJRCOC",132,0)
 S CRITERIA=$G(^TMP($J,"RCRJRCOL","CRITERIA",RCBILLDA))
"RTN","RCRJRCOC",133,0)
 I CRITERIA="" S CRITERIA=$$CRITERIA^RCRJRCOL(RCBILLDA),^TMP($J,"RCRJRCOL","CRITERIA",RCBILLDA)=CRITERIA
"RTN","RCRJRCOC",134,0)
 S $P(CRITERIA,"-",2)=RCRITER2
"RTN","RCRJRCOC",135,0)
 ;
"RTN","RCRJRCOC",136,0)
 ;  store results for ndb
"RTN","RCRJRCOC",137,0)
 S %=$G(@DATASTOR)
"RTN","RCRJRCOC",138,0)
 S $P(%,"^")=$P(%,"^")+1
"RTN","RCRJRCOC",139,0)
 S $P(%,"^",2)=$P(%,"^",2)+$P(RCVALUE,"^")
"RTN","RCRJRCOC",140,0)
 S $P(%,"^",3)=$P(%,"^",3)+$P(RCVALUE,"^",2)+$P(RCVALUE,"^",3)+$P(RCVALUE,"^",4)+$P(RCVALUE,"^",5)
"RTN","RCRJRCOC",141,0)
 S @DATASTOR=%
"RTN","RCRJRCOC",142,0)
 ;
"RTN","RCRJRCOC",143,0)
 ;  keep a count of current receivables counted
"RTN","RCRJRCOC",144,0)
 S ^TMP($J,"RCRJRCOL","COUNT",RCBILLDA,RCRITER2)=""
"RTN","RCRJRCOC",145,0)
 S ^TMP($J,"RCRJRCOL","CRIT2",RCRITER2,RCBILLDA)=""
"RTN","RCRJRCOC",146,0)
 Q 1
"RTN","RCRJRCOC",147,0)
 ;
"RTN","RCRJRCOC",148,0)
 ;
"RTN","RCRJRCOC",149,0)
MCCFHSIF(RCBILLDA,RCVALUE,RCRSC,ASOFDATE) ;  calculate the amount that goes
"RTN","RCRJRCOC",150,0)
 ;
"RTN","RCRJRCOC",151,0)
 ;  to mccf and hsif
"RTN","RCRJRCOC",152,0)
 ;
"RTN","RCRJRCOC",153,0)
 ;  returns RCTOMCCF and RCTOHSIF as the outstanding balance to mccf
"RTN","RCRJRCOC",154,0)
 ;  and the outstanding balance to hsif
"RTN","RCRJRCOC",155,0)
 N MCCFHSIF
"RTN","RCRJRCOC",156,0)
 ;
"RTN","RCRJRCOC",157,0)
 S RCTOMCCF=$P(RCVALUE,"^"),RCTOHSIF=0
"RTN","RCRJRCOC",158,0)
 ;
"RTN","RCRJRCOC",159,0)
 I $$NOHSIF^RCRJRCO() Q  ; disabled HSIF
"RTN","RCRJRCOC",160,0)
 ;
"RTN","RCRJRCOC",161,0)
 ; if revenue source code is not 8BZZ or 8CZZ then it all goes to mccf
"RTN","RCRJRCOC",162,0)
 I RCRSC="8BZZ"!(RCRSC="8CZZ") D
"RTN","RCRJRCOC",163,0)
 .   ;  get the amount for each fund mccf and hsif
"RTN","RCRJRCOC",164,0)
 .   ;  this call returns the total amount owed to mccf (piece 1),
"RTN","RCRJRCOC",165,0)
 .   ;  total amount owed to hsif (piece 2), total amount paid
"RTN","RCRJRCOC",166,0)
 .   ;  to mccf (piece 3), total amount paid to hsif (piece 4).
"RTN","RCRJRCOC",167,0)
 .   ;  for outstanding balance you must subtract the payment in
"RTN","RCRJRCOC",168,0)
 .   ;  pieces 3 and 4 which are returned as negative amounts.
"RTN","RCRJRCOC",169,0)
 .   S MCCFHSIF=$$BILLFUND^RCBMILLC(RCBILLDA,ASOFDATE)
"RTN","RCRJRCOC",170,0)
 .   S RCTOMCCF=$P(MCCFHSIF,"^",1)+$P(MCCFHSIF,"^",3)
"RTN","RCRJRCOC",171,0)
 .   S RCTOHSIF=$P(MCCFHSIF,"^",2)+$P(MCCFHSIF,"^",4)
"RTN","RCRJRCOC",172,0)
 Q
"RTN","RCRJRCOR")
0^29^B61213229
"RTN","RCRJRCOR",1,0)
RCRJRCOR ;WISC/RFJ-ar data collector summary report ;1 Mar 97
"RTN","RCRJRCOR",2,0)
 ;;4.5;Accounts Receivable;**68,96,139,103,156,170,174,191,220**;Mar 20, 1995
"RTN","RCRJRCOR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRCOR",4,0)
 Q
"RTN","RCRJRCOR",5,0)
 ;
"RTN","RCRJRCOR",6,0)
 ;
"RTN","RCRJRCOR",7,0)
SEND ;  send data to ndb and data to FMS
"RTN","RCRJRCOR",8,0)
 N %,AMOUNT,DATEMOYR,FUND,LINE,RSC,SPACE,TOTAL,TOTALFUN,TOTALTYP,TYPE,X,XMY,Y
"RTN","RCRJRCOR",9,0)
 ;
"RTN","RCRJRCOR",10,0)
 ;  ---------- send to ndb ----------
"RTN","RCRJRCOR",11,0)
 ;  data stored in tmp($j,rcrjrcolndb)
"RTN","RCRJRCOR",12,0)
 I '$G(RCRJFAR1) D NDB(PRCASITE,DATEBEG,DATEEND)
"RTN","RCRJRCOR",13,0)
 ;
"RTN","RCRJRCOR",14,0)
 ;
"RTN","RCRJRCOR",15,0)
 ;  ---------- send sv to fms ----------
"RTN","RCRJRCOR",16,0)
 ;  data stored in tmp($j,rcrjrcolsv)
"RTN","RCRJRCOR",17,0)
 ;  rcrjfsv is a flag set in the routine rcrjrco for retransmission
"RTN","RCRJRCOR",18,0)
 ;  to prevent accepted fms documents from being resent
"RTN","RCRJRCOR",19,0)
 I '$G(RCRJFSV) D STARTSV^RCXFMSSV(DATEEND)
"RTN","RCRJRCOR",20,0)
 ;
"RTN","RCRJRCOR",21,0)
 ;
"RTN","RCRJRCOR",22,0)
 ;  ---------- send wr to fms ----------
"RTN","RCRJRCOR",23,0)
 ;  data stored in tmp($j,rcrjrcolwr)
"RTN","RCRJRCOR",24,0)
 ;  rcrjfwr is a flag set in the routine rcrjrco for retransmission
"RTN","RCRJRCOR",25,0)
 ;  to prevent accepted fms documents from being resent
"RTN","RCRJRCOR",26,0)
 I '$G(RCRJFWR) D STARTWR^RCXFMSWR(DATEEND)
"RTN","RCRJRCOR",27,0)
 ;
"RTN","RCRJRCOR",28,0)
 ;  ---------- send tr to fms ----------
"RTN","RCRJRCOR",29,0)
 N RCTRANS
"RTN","RCRJRCOR",30,0)
 ;  this call returns rctrans array (see rcxfmstx for description)
"RTN","RCRJRCOR",31,0)
 ;  rcrjftr is a flag set in the routine rcrjrco for retransmission
"RTN","RCRJRCOR",32,0)
 ;  to prevent accepted fms documents from being resent
"RTN","RCRJRCOR",33,0)
 I '$G(RCRJFTR) D STARTTR^RCXFMSTX(DATEEND)
"RTN","RCRJRCOR",34,0)
 ;
"RTN","RCRJRCOR",35,0)
 ;  ---------- send oig extract ----------
"RTN","RCRJRCOR",36,0)
 ;  data stored in tmp(j,rcrjroig)
"RTN","RCRJRCOR",37,0)
 ;  get non-mccf bills for extract and user report
"RTN","RCRJRCOR",38,0)
 D NONMCCF^RCRJROIG(DATEEND)
"RTN","RCRJRCOR",39,0)
 ;  rcrjfoig is a flag set in the routine rcrjrco for retransmission
"RTN","RCRJRCOR",40,0)
 ;  to prevent the oig extract from being resent
"RTN","RCRJRCOR",41,0)
 I '$G(RCRJFOIG) D OIG^RCRJROIG(DATEEND)
"RTN","RCRJRCOR",42,0)
 ;
"RTN","RCRJRCOR",43,0)
 ;  generate a mailman message to the group showing the data
"RTN","RCRJRCOR",44,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",45,0)
 S Y=$E(DATEEND,1,5)_"00" D DD^%DT S DATEMOYR=Y
"RTN","RCRJRCOR",46,0)
 S LINE=0,SPACE="",$P(SPACE," ",80)=""
"RTN","RCRJRCOR",47,0)
 D SET("Data has been collected for the month "_DATEMOYR_".  The data has been")
"RTN","RCRJRCOR",48,0)
 D SET("transmitted to the following systems:")
"RTN","RCRJRCOR",49,0)
 D SET(" ")
"RTN","RCRJRCOR",50,0)
 ;
"RTN","RCRJRCOR",51,0)
 I '$G(RCRJFAR1) D
"RTN","RCRJRCOR",52,0)
 .   D SET("NATIONAL DATABASE DATA")
"RTN","RCRJRCOR",53,0)
 .   D SET("----------------------")
"RTN","RCRJRCOR",54,0)
 .   D SET("The data has been sent to the National Database.  For a detail list")
"RTN","RCRJRCOR",55,0)
 .   D SET("of the data sent, please review the Return Reports which are sent")
"RTN","RCRJRCOR",56,0)
 .   D SET("from the National Database.")
"RTN","RCRJRCOR",57,0)
 .   D SET(" ")
"RTN","RCRJRCOR",58,0)
 ;
"RTN","RCRJRCOR",59,0)
 I '$G(RCRJFSV) D
"RTN","RCRJRCOR",60,0)
 .   D SET("FMS, STANDARD VOUCHER (SV) DOCUMENT")
"RTN","RCRJRCOR",61,0)
 .   D SET("-----------------------------------")
"RTN","RCRJRCOR",62,0)
 .   D SET("The following data has been transmitted to FMS in the SV document:")
"RTN","RCRJRCOR",63,0)
 .   D SET("  Revenue Source Code                                        Type       Amount")
"RTN","RCRJRCOR",64,0)
 .   D SET("  -------------------                                        ----       ------")
"RTN","RCRJRCOR",65,0)
 .   S TOTAL=0
"RTN","RCRJRCOR",66,0)
 .   S TYPE="" F  S TYPE=$O(^TMP($J,"RCRJRCOLSV",TYPE)) Q:TYPE=""  D
"RTN","RCRJRCOR",67,0)
 .   .   S TOTALTYP=0
"RTN","RCRJRCOR",68,0)
 .   .   S FUND="" F  S FUND=$O(^TMP($J,"RCRJRCOLSV",TYPE,FUND)) Q:FUND=""  D
"RTN","RCRJRCOR",69,0)
 .   .   .   S TOTALFUN=0
"RTN","RCRJRCOR",70,0)
 .   .   .   S RSC="" F  S RSC=$O(^TMP($J,"RCRJRCOLSV",TYPE,FUND,RSC)) Q:RSC=""  S AMOUNT=^(RSC) D
"RTN","RCRJRCOR",71,0)
 .   .   .   .   D SET("  "_RSC_" "_$E($$GETDESC^RCXFMSPR(RSC)_SPACE,1,54)_"  "_TYPE_$J(AMOUNT,13,2))
"RTN","RCRJRCOR",72,0)
 .   .   .   .   S TOTALFUN=TOTALFUN+AMOUNT
"RTN","RCRJRCOR",73,0)
 .   .   .   .   S TOTALTYP=TOTALTYP+AMOUNT
"RTN","RCRJRCOR",74,0)
 .   .   .   .   S TOTAL=TOTAL+AMOUNT
"RTN","RCRJRCOR",75,0)
 .   .   .   ;
"RTN","RCRJRCOR",76,0)
 .   .   .   N RCFUND S RCFUND=$S($E(DATEEND,2,5)<"0410":$E(FUND,1,4)_"."_$E(FUND,6),1:$E(FUND,1,4)_"0"_$E(FUND,6))
"RTN","RCRJRCOR",77,0)
 .   .   .   I TYPE=21 D SET($E("            Sub-Total by Fund "_RCFUND_":"_SPACE,1,38)_$J(TOTALFUN,12,2))
"RTN","RCRJRCOR",78,0)
 .   .   ;
"RTN","RCRJRCOR",79,0)
 .   .   D SET("                                                                    ----------")
"RTN","RCRJRCOR",80,0)
 .   .   D SET("                                                    TOTAL TYPE "_TYPE_$J(TOTALTYP,13,2))
"RTN","RCRJRCOR",81,0)
 .   .   D SET(" ")
"RTN","RCRJRCOR",82,0)
 .   ;
"RTN","RCRJRCOR",83,0)
 .   D SET("                                                                    ----------")
"RTN","RCRJRCOR",84,0)
 .   D SET("                                                         TOTAL SV"_$J(TOTAL,13,2))
"RTN","RCRJRCOR",85,0)
 .   D SET(" ")
"RTN","RCRJRCOR",86,0)
 ;
"RTN","RCRJRCOR",87,0)
 I '$G(RCRJFWR) D
"RTN","RCRJRCOR",88,0)
 .   D SET("FMS, WRITEOFFS/CONTRACT ADJUSTMENTS (WR) DOCUMENT")
"RTN","RCRJRCOR",89,0)
 .   D SET("-------------------------------------------------")
"RTN","RCRJRCOR",90,0)
 .   D SET("The following data has been transmitted to FMS in the WR document:")
"RTN","RCRJRCOR",91,0)
 .   D SET("  Revenue Source Code                                        Type       Amount")
"RTN","RCRJRCOR",92,0)
 .   D SET("  -------------------                                        ----       ------")
"RTN","RCRJRCOR",93,0)
 .   S TOTAL=0
"RTN","RCRJRCOR",94,0)
 .   S TYPE="" F  S TYPE=$O(^TMP($J,"RCRJRCOLWR",TYPE)) Q:TYPE=""  D
"RTN","RCRJRCOR",95,0)
 .   .   S TOTALTYP=0
"RTN","RCRJRCOR",96,0)
 .   .   S FUND="" F  S FUND=$O(^TMP($J,"RCRJRCOLWR",TYPE,FUND)) Q:FUND=""  D
"RTN","RCRJRCOR",97,0)
 .   .   .   S TOTALFUN=0
"RTN","RCRJRCOR",98,0)
 .   .   .   S RSC="" F  S RSC=$O(^TMP($J,"RCRJRCOLWR",TYPE,FUND,RSC)) Q:RSC=""  S AMOUNT=^(RSC) D
"RTN","RCRJRCOR",99,0)
 .   .   .   .   D SET("  "_RSC_" "_$E($$GETDESC^RCXFMSPR(RSC)_SPACE,1,54)_"  "_TYPE_$J(AMOUNT,13,2))
"RTN","RCRJRCOR",100,0)
 .   .   .   .   S TOTALFUN=TOTALFUN+AMOUNT
"RTN","RCRJRCOR",101,0)
 .   .   .   .   S TOTALTYP=TOTALTYP+AMOUNT
"RTN","RCRJRCOR",102,0)
 .   .   .   .   S TOTAL=TOTAL+AMOUNT
"RTN","RCRJRCOR",103,0)
 .   .   .   ;
"RTN","RCRJRCOR",104,0)
 .   .   .   N RCFUND S RCFUND=$S($E(DATEEND,2,5)<"0410":$E(FUND,1,4)_"."_$E(FUND,6),1:$E(FUND,1,4)_"0"_$E(FUND,6))
"RTN","RCRJRCOR",105,0)
 .   .   .   I TYPE="04" D SET($E("            Sub-Total by Fund "_RCFUND_":"_SPACE,1,38)_$J(TOTALFUN,12,2))
"RTN","RCRJRCOR",106,0)
 .   .   ;
"RTN","RCRJRCOR",107,0)
 .   .   D SET("                                                                    ----------")
"RTN","RCRJRCOR",108,0)
 .   .   D SET("                                                    TOTAL TYPE "_TYPE_$J(TOTALTYP,13,2))
"RTN","RCRJRCOR",109,0)
 .   .   D SET(" ")
"RTN","RCRJRCOR",110,0)
 .   D SET("                                                                    ----------")
"RTN","RCRJRCOR",111,0)
 .   D SET("                                                         TOTAL WR"_$J(TOTAL,13,2))
"RTN","RCRJRCOR",112,0)
 .   D SET(" ")
"RTN","RCRJRCOR",113,0)
 ;
"RTN","RCRJRCOR",114,0)
 I '$G(RCRJFTR) D
"RTN","RCRJRCOR",115,0)
 .   D SET("FMS, TRANSFER FROM MCCF TO HSIF (TR) DOCUMENT")
"RTN","RCRJRCOR",116,0)
 .   D SET("-------------------------------------------------")
"RTN","RCRJRCOR",117,0)
 .   D SET("The following data has been transmitted to FMS in the TR document:")
"RTN","RCRJRCOR",118,0)
 .   D SET("  From Fund    From RSC       To Fund    To RSC                         Amount")
"RTN","RCRJRCOR",119,0)
 .   D SET("  ---------    --------       -------    ------                     ----------")
"RTN","RCRJRCOR",120,0)
 .   I $O(RCTRANS(""))="" D SET("  No Dollars to Transfer.") Q
"RTN","RCRJRCOR",121,0)
 .   ;
"RTN","RCRJRCOR",122,0)
 .   S FUND="" F  S FUND=$O(RCTRANS(FUND)) Q:FUND=""  D
"RTN","RCRJRCOR",123,0)
 .   .   S RSC="" F  S RSC=$O(RCTRANS(FUND,RSC)) Q:RSC=""  D
"RTN","RCRJRCOR",124,0)
 .   .   .   ;  rctrans(fromfund,fromrsc) = tofund ^ torsc ^ amount
"RTN","RCRJRCOR",125,0)
 .   .   .   S AMOUNT=RCTRANS(FUND,RSC)
"RTN","RCRJRCOR",126,0)
 .   .   .   D SET($J(FUND,11)_$J(RSC,12)_$J($P(AMOUNT,"^"),14)_$J($P(AMOUNT,"^",2),10)_$J($P(AMOUNT,"^",3),31,2))
"RTN","RCRJRCOR",127,0)
 ;
"RTN","RCRJRCOR",128,0)
 S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJRCOR",129,0)
 S %=$$SENDMSG("AR Data Collector for "_DATEMOYR_" Station "_PRCASITE,.XMY)
"RTN","RCRJRCOR",130,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",131,0)
 ;
"RTN","RCRJRCOR",132,0)
 ;  send users detail report
"RTN","RCRJRCOR",133,0)
 D USERREPT^RCRJRCOU(DATEMOYR)
"RTN","RCRJRCOR",134,0)
 Q
"RTN","RCRJRCOR",135,0)
 ;
"RTN","RCRJRCOR",136,0)
 ;
"RTN","RCRJRCOR",137,0)
NDB(PRCASITE,DATEBEG,DATEEND) ;  send data to the national database
"RTN","RCRJRCOR",138,0)
 N %,BATCNAME,COUNT,CRITERIA,DATA,LINE,XMY,X,Y
"RTN","RCRJRCOR",139,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",140,0)
 S LINE=2,DATA="D$ "
"RTN","RCRJRCOR",141,0)
 S CRITERIA="" F COUNT=1:1 S CRITERIA=$O(^TMP($J,"RCRJRCOLNDB",CRITERIA)) Q:CRITERIA=""  D
"RTN","RCRJRCOR",142,0)
 .   S DATA=DATA_":"_COUNT_"/"_CRITERIA_"/"_^TMP($J,"RCRJRCOLNDB",CRITERIA)
"RTN","RCRJRCOR",143,0)
 .   I $L(DATA)>200 D SET(DATA) S DATA="D$ "
"RTN","RCRJRCOR",144,0)
 I DATA'="D$ " D SET(DATA)
"RTN","RCRJRCOR",145,0)
 ;
"RTN","RCRJRCOR",146,0)
 ;  build the first two control lines in mail message
"RTN","RCRJRCOR",147,0)
 S Y=DATEBEG D DD^%DT
"RTN","RCRJRCOR",148,0)
 S BATCNAME="AR1-"_$E(Y,1,3)_$E(DATEBEG,6,7)_$TR($P(Y,",",2)," ")
"RTN","RCRJRCOR",149,0)
 S Y=DATEEND D DD^%DT
"RTN","RCRJRCOR",150,0)
 S BATCNAME=BATCNAME_"-"_$E(Y,1,3)_$E(DATEEND,6,7)_$TR($P(Y,",",2)," ")
"RTN","RCRJRCOR",151,0)
 S ^TMP($J,"RCRJRCORMM",1)="T$ "_PRCASITE_"$"_BATCNAME_"$$$$$*"
"RTN","RCRJRCOR",152,0)
 ;  get end time (in %)
"RTN","RCRJRCOR",153,0)
 D NOW^%DTC
"RTN","RCRJRCOR",154,0)
 S ^TMP($J,"RCRJRCORMM",2)="S$ "_STRTTIME_"^"_%_"$0$"_(COUNT-1)
"RTN","RCRJRCOR",155,0)
 ;
"RTN","RCRJRCOR",156,0)
 S XMY("S.PRQN DATA COLLECTION MONITOR@FO-ALBANY.MED.VA.GOV")=""
"RTN","RCRJRCOR",157,0)
 S %=$$SENDMSG("AR1 "_$E(DATEEND,4,5)_"/"_$E(DATEEND,2,3)_" NDB DATA FOR SITE "_PRCASITE,.XMY)
"RTN","RCRJRCOR",158,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",159,0)
 Q
"RTN","RCRJRCOR",160,0)
 ;
"RTN","RCRJRCOR",161,0)
 ;
"RTN","RCRJRCOR",162,0)
SUMMARY ;  print summary report in mailman bulletin
"RTN","RCRJRCOR",163,0)
 N %,BILLDA,CRITER2,CRITERIA,DATA0,DFN,LINE,STAT,TOTAL,VA,XMY
"RTN","RCRJRCOR",164,0)
 K ^TMP($J,"RCRJRCOR")   ; used to identify test patients
"RTN","RCRJRCOR",165,0)
 K ^TMP($J,"RCRJRCORMM") ; used to build mailman message
"RTN","RCRJRCOR",166,0)
 ;
"RTN","RCRJRCOR",167,0)
 ;  print any test patient bills which have not been closed
"RTN","RCRJRCOR",168,0)
 S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCRJRCOL","CRIT2",1,BILLDA)) Q:'BILLDA  I $D(^(BILLDA,1)) D
"RTN","RCRJRCOR",169,0)
 .   S DATA0=$G(^PRCA(430,BILLDA,0)),STAT=$P(DATA0,"^",8)
"RTN","RCRJRCOR",170,0)
 .   I STAT'=16,STAT='42 Q  ; bill not currently open
"RTN","RCRJRCOR",171,0)
 .   S DFN=+$P(DATA0,"^",7) I 'DFN Q
"RTN","RCRJRCOR",172,0)
 .   D PID^VADPT
"RTN","RCRJRCOR",173,0)
 .   I $E($TR($G(VA("PID")),"-"),1,5)="00000" S ^TMP($J,"RCRJRCOR","TEST",BILLDA)=""
"RTN","RCRJRCOR",174,0)
 ;
"RTN","RCRJRCOR",175,0)
 I '$D(^TMP($J,"RCRJRCOR","TEST")) Q
"RTN","RCRJRCOR",176,0)
 ;
"RTN","RCRJRCOR",177,0)
 ;  print data
"RTN","RCRJRCOR",178,0)
 S LINE=0
"RTN","RCRJRCOR",179,0)
 D SET(" ")
"RTN","RCRJRCOR",180,0)
 D SET("The following bills are active and linked to test patients:")
"RTN","RCRJRCOR",181,0)
 S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCRJRCOR","TEST",BILLDA)) Q:'BILLDA  D SET("  "_$P($G(^PRCA(430,BILLDA,0)),"^")_" (#",BILLDA_")")
"RTN","RCRJRCOR",182,0)
 ;
"RTN","RCRJRCOR",183,0)
 S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJRCOR",184,0)
 S %=$$SENDMSG("MCCR DATA COLLECTOR INFORMATION",.XMY)
"RTN","RCRJRCOR",185,0)
 K ^TMP($J,"RCRJRCOR")
"RTN","RCRJRCOR",186,0)
 K ^TMP($J,"RCRJRCORMM")
"RTN","RCRJRCOR",187,0)
 Q
"RTN","RCRJRCOR",188,0)
 ;
"RTN","RCRJRCOR",189,0)
 ;
"RTN","RCRJRCOR",190,0)
SET(DATA)          ;  store report
"RTN","RCRJRCOR",191,0)
 S LINE=LINE+1,^TMP($J,"RCRJRCORMM",LINE)=DATA
"RTN","RCRJRCOR",192,0)
 Q
"RTN","RCRJRCOR",193,0)
 ;
"RTN","RCRJRCOR",194,0)
 ;
"RTN","RCRJRCOR",195,0)
SENDMSG(XMSUB,XMY) ;  send message with subject and recipients
"RTN","RCRJRCOR",196,0)
 N %X,D0,D1,D2,DIC,DICR,DIW,X,XCNP,XMDISPI,XMDUN,XMDUZ,XMTEXT,XMZ,ZTPAR
"RTN","RCRJRCOR",197,0)
 S XMDUZ="AR PACKAGE",XMTEXT="^TMP($J,""RCRJRCORMM"","
"RTN","RCRJRCOR",198,0)
 D ^XMD
"RTN","RCRJRCOR",199,0)
 Q +$G(XMZ)
"RTN","RCRJRDEP")
0^14^B57461822
"RTN","RCRJRDEP",1,0)
RCRJRDEP ;WISC/RFJ-Deposit Reconciliation Report ;1 Mar 98
"RTN","RCRJRDEP",2,0)
 ;;4.5;Accounts Receivable;**101,114,203,220**;Mar 20, 1995
"RTN","RCRJRDEP",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJRDEP",4,0)
 ;
"RTN","RCRJRDEP",5,0)
 W !!,"This option will print the Deposit Reconciliation Report.  The report will"
"RTN","RCRJRDEP",6,0)
 W !,"display the data on the code sheets sent to FMS on the CR document.  Only"
"RTN","RCRJRDEP",7,0)
 W !,"deposits processed after patch PRCA*4.5*90 was installed can be displayed."
"RTN","RCRJRDEP",8,0)
 W !,"Select the starting and ending FMS Document Number without the station"
"RTN","RCRJRDEP",9,0)
 W !,"number, example: K8A0346."
"RTN","RCRJRDEP",10,0)
 ;
"RTN","RCRJRDEP",11,0)
 N DEFAULT,RCRJEND,RCRJFXIT,RCRJSTRT,RCRJSUMM,X
"RTN","RCRJRDEP",12,0)
 ;
"RTN","RCRJRDEP",13,0)
 F  D  Q:$G(RCRJFXIT)
"RTN","RCRJRDEP",14,0)
 . R !!,"START WITH CR DOCUMENT: FIRST// ",X:DTIME
"RTN","RCRJRDEP",15,0)
 . I X["^" S RCRJFXIT=2 Q
"RTN","RCRJRDEP",16,0)
 . I $L(X),$L(X)'=7 W !?5,"The CR DOCUMENT should be 7 characters in length (example: K8A0804)." Q
"RTN","RCRJRDEP",17,0)
 . S RCRJSTRT=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RCRJRDEP",18,0)
 . ;
"RTN","RCRJRDEP",19,0)
 . S DEFAULT=$S(RCRJSTRT="":" LAST",1:RCRJSTRT)
"RTN","RCRJRDEP",20,0)
 . W !,"  END WITH CR DOCUMENT: ",DEFAULT,"// " R X:DTIME
"RTN","RCRJRDEP",21,0)
 . I X["^" S RCRJFXIT=2 Q
"RTN","RCRJRDEP",22,0)
 . S RCRJEND=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RCRJRDEP",23,0)
 . I X="LAST" S (RCRJEND,X)="zzzzzzz"
"RTN","RCRJRDEP",24,0)
 . I $L(X),$L(X)'=7 W !?5,"The CR DOCUMENT should be 7 characters in length (example: K8A0804)." Q
"RTN","RCRJRDEP",25,0)
 . I X="" S RCRJEND=$S(DEFAULT=" LAST":"zzzzzzz",1:DEFAULT)
"RTN","RCRJRDEP",26,0)
 . I RCRJEND'=RCRJSTRT,RCRJEND']RCRJSTRT W !?5,"The END CR DOCUMENT should be after (in sequence) the start document." Q
"RTN","RCRJRDEP",27,0)
 . S RCRJFXIT=1
"RTN","RCRJRDEP",28,0)
 I RCRJFXIT=2 Q
"RTN","RCRJRDEP",29,0)
 ;
"RTN","RCRJRDEP",30,0)
 S RCRJSUMM=$$SUMMARY^RCRJRTRA I 'RCRJSUMM Q
"RTN","RCRJRDEP",31,0)
 ;
"RTN","RCRJRDEP",32,0)
 ;  select device
"RTN","RCRJRDEP",33,0)
 W ! S %ZIS="Q" D ^%ZIS Q:POP
"RTN","RCRJRDEP",34,0)
 I $D(IO("Q")) D  D ^%ZTLOAD K IO("Q"),ZTSK Q
"RTN","RCRJRDEP",35,0)
 . S ZTDESC="Deposit Reconciliation Report",ZTRTN="DQ^RCRJRDEP"
"RTN","RCRJRDEP",36,0)
 . S ZTSAVE("RCRJ*")="",ZTSAVE("ZTREQ")="@"
"RTN","RCRJRDEP",37,0)
 W !!,"<*> please wait <*>"
"RTN","RCRJRDEP",38,0)
 ;
"RTN","RCRJRDEP",39,0)
DQ ;  report (queue) starts here
"RTN","RCRJRDEP",40,0)
 N %,%H,%I,CHAMPVA,DA,DEPOSDA,DIQ2,DOCTOTAL,FMSDOCID,FUND,FUNDTOTL,GECSDATA,LINEDA,LINEDATA,NOW,PAGE,RCDATA,RCRJLAST,RCRJLINE,RCRJFLAG,RECEIPDA,RSC,RSCTOTL,SCREEN,SITE,TOTAL,X,Y
"RTN","RCRJRDEP",41,0)
 K ^TMP($J,"RCRJRDEP")
"RTN","RCRJRDEP",42,0)
 ;
"RTN","RCRJRDEP",43,0)
 ;  build list of fms documents
"RTN","RCRJRDEP",44,0)
 S SITE=$$SITE^RCMSITE
"RTN","RCRJRDEP",45,0)
 S RCRJLAST="CR-"_SITE_RCRJEND_" "
"RTN","RCRJRDEP",46,0)
 ;
"RTN","RCRJRDEP",47,0)
 ;  the fms document was previously stored in the deposit file 344.1
"RTN","RCRJRDEP",48,0)
 ;  this code can be removed later on
"RTN","RCRJRDEP",49,0)
 ;  this is the starting document, use 31 to start with select doc first
"RTN","RCRJRDEP",50,0)
 S FMSDOCID="CR-"_SITE_RCRJSTRT_$C(31)
"RTN","RCRJRDEP",51,0)
 F  S FMSDOCID=$O(^RCY(344.1,"ADOC",FMSDOCID)) Q:FMSDOCID=""!(FMSDOCID]RCRJLAST)  D
"RTN","RCRJRDEP",52,0)
 . S DEPOSDA=+$O(^RCY(344.1,"ADOC",FMSDOCID,0))
"RTN","RCRJRDEP",53,0)
 . ;  compute deposit (all receipts) total for comparison
"RTN","RCRJRDEP",54,0)
 . S TOTAL=0,CHAMPVA=0
"RTN","RCRJRDEP",55,0)
 . S RECEIPDA=0 F  S RECEIPDA=$O(^RCY(344,"AD",DEPOSDA,RECEIPDA)) Q:'RECEIPDA  D
"RTN","RCRJRDEP",56,0)
 . . S DA=0 F  S DA=$O(^RCY(344,RECEIPDA,1,DA)) Q:'DA  S TOTAL=TOTAL+$P(^(DA,0),"^",5)
"RTN","RCRJRDEP",57,0)
 . . S CHAMPVA=CHAMPVA+$$CHAMPVA(RECEIPDA)
"RTN","RCRJRDEP",58,0)
 . ;  tmp=deposit ^ depositda ^ depositdate ^ ^ ^ ^ deposittotal ^ champvatotal
"RTN","RCRJRDEP",59,0)
 . S ^TMP($J,"RCRJRDEP",FMSDOCID)=$P($G(^RCY(344.1,DEPOSDA,0)),"^")_"^"_DEPOSDA_"^"_$P($G(^RCY(344.1,DEPOSDA,0)),"^",9)_"^^^^"_TOTAL_"^"_CHAMPVA
"RTN","RCRJRDEP",60,0)
 ;
"RTN","RCRJRDEP",61,0)
 ;  the fms document is now stored in the receipt file 344
"RTN","RCRJRDEP",62,0)
 S FMSDOCID="CR-"_SITE_RCRJSTRT_$C(31)
"RTN","RCRJRDEP",63,0)
 F  S FMSDOCID=$O(^RCY(344,"ADOC",FMSDOCID)) Q:FMSDOCID=""!(FMSDOCID]RCRJLAST)  D
"RTN","RCRJRDEP",64,0)
 . S RECEIPDA=+$O(^RCY(344,"ADOC",FMSDOCID,0))
"RTN","RCRJRDEP",65,0)
 . ;  compute deposit (all receipts) total for comparison
"RTN","RCRJRDEP",66,0)
 . S TOTAL=0
"RTN","RCRJRDEP",67,0)
 . ;  use the payment amount to pick up suspense deposits
"RTN","RCRJRDEP",68,0)
 . S DA=0 F  S DA=$O(^RCY(344,RECEIPDA,1,DA)) Q:'DA  S TOTAL=TOTAL+$P(^(DA,0),"^",4)
"RTN","RCRJRDEP",69,0)
 . S CHAMPVA=$$CHAMPVA(RECEIPDA)
"RTN","RCRJRDEP",70,0)
 . S DEPOSDA=+$P($G(^RCY(344,RECEIPDA,0)),"^",6)
"RTN","RCRJRDEP",71,0)
 . ;  tmp=deposit ^ depositda ^ depositdate ^ receipt ^receiptda ^ receipt date ^ receipttotal ^ champvatotal
"RTN","RCRJRDEP",72,0)
 . S ^TMP($J,"RCRJRDEP",FMSDOCID)=$P($G(^RCY(344.1,DEPOSDA,0)),"^")_"^"_DEPOSDA_"^"_$P($G(^RCY(344.1,DEPOSDA,0)),"^",11)_"^"_$P($G(^RCY(344,RECEIPDA,0)),"^")_"^"_RECEIPDA_"^"_$P($G(^RCY(344,RECEIPDA,0)),"^",8)_"^"_TOTAL_"^"_CHAMPVA
"RTN","RCRJRDEP",73,0)
 ;
"RTN","RCRJRDEP",74,0)
 ;  print report
"RTN","RCRJRDEP",75,0)
 S SCREEN=0 I '$D(ZTQUEUED),IO=IO(0),$E(IOST)="C" S SCREEN=1
"RTN","RCRJRDEP",76,0)
 S RCRJLINE="",$P(RCRJLINE,"-",81)=""
"RTN","RCRJRDEP",77,0)
 D NOW^%DTC S Y=% D DD^%DT S NOW=Y,PAGE=1
"RTN","RCRJRDEP",78,0)
 U IO I $G(RCRJSUMM)'=1 D H
"RTN","RCRJRDEP",79,0)
 ;
"RTN","RCRJRDEP",80,0)
 S FMSDOCID="" F  S FMSDOCID=$O(^TMP($J,"RCRJRDEP",FMSDOCID)) Q:FMSDOCID=""!($G(RCRJFLAG))  D
"RTN","RCRJRDEP",81,0)
 . S RCDATA=^TMP($J,"RCRJRDEP",FMSDOCID)
"RTN","RCRJRDEP",82,0)
 . K GECSDATA
"RTN","RCRJRDEP",83,0)
 . D DATA^GECSSGET(FMSDOCID,1)
"RTN","RCRJRDEP",84,0)
 . I $G(RCRJSUMM)'=1 D  Q:$G(RCRJFLAG)
"RTN","RCRJRDEP",85,0)
 . . I $Y>(IOSL-7) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  D H
"RTN","RCRJRDEP",86,0)
 . . S Y=$P($P(RCDATA,"^",3),".") I Y D DD^%DT
"RTN","RCRJRDEP",87,0)
 . . W !,"FMS DOCUMENT: ",FMSDOCID,?34,"DEPOSIT TICKET: ",$P(RCDATA,"^"),?62,"DATE: ",Y
"RTN","RCRJRDEP",88,0)
 . . I $P(RCDATA,"^",4)'="" W !?41,"RECEIPT: ",$P(RCDATA,"^",4) S Y=$P($P(RCDATA,"^",6),".") I Y D DD^%DT W ?62,"DATE: ",Y
"RTN","RCRJRDEP",89,0)
 . . D H1
"RTN","RCRJRDEP",90,0)
 . S DOCTOTAL=0
"RTN","RCRJRDEP",91,0)
 . I $D(GECSDATA) S LINEDA=0 F  S LINEDA=$O(GECSDATA(2100.1,GECSDATA,10,LINEDA)) Q:'LINEDA!($G(RCRJFLAG))  D
"RTN","RCRJRDEP",92,0)
 . . S LINEDATA=GECSDATA(2100.1,GECSDATA,10,LINEDA)
"RTN","RCRJRDEP",93,0)
 . . I $E(LINEDATA,1,4)="CR2^" S DOCTOTAL=$P(LINEDATA,"^",15)
"RTN","RCRJRDEP",94,0)
 . . I $E(LINEDATA,1,9)'="LIN^~CRA^" Q
"RTN","RCRJRDEP",95,0)
 . . I $G(RCRJSUMM)'=1 D
"RTN","RCRJRDEP",96,0)
 . . . I $Y>(IOSL-4) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  D H,H1
"RTN","RCRJRDEP",97,0)
 . . . W !?1,$P(LINEDATA,"^",3),?6,$P(LINEDATA,"^",4),?11,$P(LINEDATA,"^",6),?19,$P(LINEDATA,"^",10)
"RTN","RCRJRDEP",98,0)
 . . . W ?30,$J($P(LINEDATA,"^",18),8),?40,$E($P(LINEDATA,"^",25),4,10),?50,$J($P(LINEDATA,"^",20),10,2),?64,$J($P(LINEDATA,"^",23),9)
"RTN","RCRJRDEP",99,0)
 . . ;  totals by fund
"RTN","RCRJRDEP",100,0)
 . . S FUND=$P(LINEDATA,"^",6)
"RTN","RCRJRDEP",101,0)
 . . I FUND="" S FUND="0160"
"RTN","RCRJRDEP",102,0)
 . . S FUNDTOTL(FUND)=$G(FUNDTOTL(FUND))+$P(LINEDATA,"^",20)
"RTN","RCRJRDEP",103,0)
 . . ;  totals by rsc for the accrued 5287 funds (01,03,04,09)
"RTN","RCRJRDEP",104,0)
 . . S RSC=$P(LINEDATA,"^",10)
"RTN","RCRJRDEP",105,0)
 . . I RSC'="",($$PTACCT^PRCAACC(FUND)!(FUND=4032)) S RSCTOTL(RSC)=$G(RSCTOTL(RSC))+$P(LINEDATA,"^",20)
"RTN","RCRJRDEP",106,0)
 . I $G(RCRJSUMM)=1 Q
"RTN","RCRJRDEP",107,0)
 . I $G(RCRJFLAG) Q
"RTN","RCRJRDEP",108,0)
 . I $Y>(IOSL-6) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  D H
"RTN","RCRJRDEP",109,0)
 . W !?23,"LINE TOTAL/DOCUMENT TOTAL: ",$J(DOCTOTAL,10,2)
"RTN","RCRJRDEP",110,0)
 . ;  compute receipt total for comparison
"RTN","RCRJRDEP",111,0)
 . S TOTAL=$P(RCDATA,"^",7)
"RTN","RCRJRDEP",112,0)
 . S CHAMPVA=$P(RCDATA,"^",8)
"RTN","RCRJRDEP",113,0)
 . I CHAMPVA W !?35,"CHAMPVA TOTAL: ",$J(CHAMPVA,10,2)
"RTN","RCRJRDEP",114,0)
 . W !?35,"DEPOSIT TOTAL: ",$J(TOTAL,10,2)
"RTN","RCRJRDEP",115,0)
 . I (DOCTOTAL+CHAMPVA)'=TOTAL W !," WARNING: TOTALS DO NOT MATCH, CHECK THE DEPOSIT: **********"
"RTN","RCRJRDEP",116,0)
 . W !
"RTN","RCRJRDEP",117,0)
 ;
"RTN","RCRJRDEP",118,0)
 I $G(RCRJFLAG) D Q Q
"RTN","RCRJRDEP",119,0)
 I $G(RCRJSUMM)'=1 D:SCREEN PAUSE^RCRJRTR1 I $G(RCRJFLAG) D Q Q
"RTN","RCRJRDEP",120,0)
 D H
"RTN","RCRJRDEP",121,0)
 ;  print totals by fund/rsc
"RTN","RCRJRDEP",122,0)
 W !!,"TOTAL DEPOSITS BY FUND:"
"RTN","RCRJRDEP",123,0)
 S FUND="" F  S FUND=$O(FUNDTOTL(FUND)) Q:FUND=""!($G(RCRJFLAG))  D
"RTN","RCRJRDEP",124,0)
 .  I $Y>(IOSL-4) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  D H W !!,"TOTAL DEPOSITS BY FUND:"
"RTN","RCRJRDEP",125,0)
 .  W !?5,"FUND: ",FUND,?20,$J(FUNDTOTL(FUND),10,2)
"RTN","RCRJRDEP",126,0)
 I $G(RCRJFLAG) D Q Q
"RTN","RCRJRDEP",127,0)
 I DT<$$ADDPTEDT^PRCAACC() W !!,"TOTAL DEPOSITS BY REVENUE SOURCE CODE FOR THE SERIES OF FUNDS 5287.1,5287.3,5287.4:"
"RTN","RCRJRDEP",128,0)
 I DT'<$$ADDPTEDT^PRCAACC() W !!,"TOTAL DEPOSITS BY REVENUE SOURCE CODE FOR THE SERIES OF FUNDS 528701,528703,528704:"
"RTN","RCRJRDEP",129,0)
 S RSC="" F  S RSC=$O(RSCTOTL(RSC)) Q:RSC=""  D  Q:$G(RCRJFLAG)
"RTN","RCRJRDEP",130,0)
 . I $Y>(IOSL-4) D:SCREEN PAUSE^RCRJRTR1 Q:$G(RCRJFLAG)  D H W !!,"TOTAL DEPOSITS BY REVENUE SOURCE CODE FOR THE SERIES OF ACCRUED 5287 FUNDS "_$S(DT<$$ADDPTEDT^PRCAACC():"(.1,.3,.4,.9):",1:"(01,03,04,09):")
"RTN","RCRJRDEP",131,0)
 . W !?5,"RSC: ",RSC,?17,$$GETDESC^RCXFMSPR(RSC),?70,$J(RSCTOTL(RSC),10,2)
"RTN","RCRJRDEP",132,0)
 I $G(RCRJFLAG) D Q Q
"RTN","RCRJRDEP",133,0)
 I SCREEN R !,"Press RETURN to continue:",X:DTIME
"RTN","RCRJRDEP",134,0)
 ;
"RTN","RCRJRDEP",135,0)
Q D ^%ZISC
"RTN","RCRJRDEP",136,0)
 K ^TMP($J,"RCRJRDEP")
"RTN","RCRJRDEP",137,0)
 Q
"RTN","RCRJRDEP",138,0)
 ;
"RTN","RCRJRDEP",139,0)
 ;
"RTN","RCRJRDEP",140,0)
H ;  report heading
"RTN","RCRJRDEP",141,0)
 I PAGE'=1!(SCREEN) W @IOF
"RTN","RCRJRDEP",142,0)
 S %=NOW_"  PAGE "_PAGE,PAGE=PAGE+1
"RTN","RCRJRDEP",143,0)
 W $C(13),"DEPOSIT RECONCILIATION REPORT",?(80-$L(%)),%
"RTN","RCRJRDEP",144,0)
 W !,"  START WITH DEPOSIT: ",$S(RCRJSTRT="":"**FIRST**",1:RCRJSTRT),"  END WITH DEPOSIT: ",$S(RCRJEND="zzzzzzz":"**LAST**",1:RCRJEND),?65,$J("TYPE: "_$S(RCRJSUMM=1:"SUMMARY",1:"DETAILED"),15)
"RTN","RCRJRDEP",145,0)
 W !,RCRJLINE
"RTN","RCRJRDEP",146,0)
 Q
"RTN","RCRJRDEP",147,0)
 ;
"RTN","RCRJRDEP",148,0)
 ;
"RTN","RCRJRDEP",149,0)
H1 ;  print line heading
"RTN","RCRJRDEP",150,0)
 W !,"LINE",?5,"BFY",?11,"FUND",?20,"RSC",?30,"PROVIDER",?43,"BILL",?54,"AMOUNT",?64,"TRAN TYPE"
"RTN","RCRJRDEP",151,0)
 Q
"RTN","RCRJRDEP",152,0)
 ;
"RTN","RCRJRDEP",153,0)
 ;
"RTN","RCRJRDEP",154,0)
CHAMPVA(RECEIPDA) ;  return dollars for champva
"RTN","RCRJRDEP",155,0)
 N %,CATEGORY,RECEIPT,TOTAL,TRAN3,TRANDA
"RTN","RCRJRDEP",156,0)
 S RECEIPT=$P($G(^RCY(344,RECEIPDA,0)),"^")
"RTN","RCRJRDEP",157,0)
 I RECEIPT="" Q 0
"RTN","RCRJRDEP",158,0)
 ;
"RTN","RCRJRDEP",159,0)
 S TOTAL=0
"RTN","RCRJRDEP",160,0)
 S TRANDA=0 F  S TRANDA=$O(^PRCA(433,"AF",RECEIPT,TRANDA)) Q:'TRANDA  D
"RTN","RCRJRDEP",161,0)
 . S CATEGORY=$P($G(^PRCA(430,+$P($G(^PRCA(433,TRANDA,0)),"^",2),0)),"^",2)
"RTN","RCRJRDEP",162,0)
 . I CATEGORY'=29 Q
"RTN","RCRJRDEP",163,0)
 . S TRAN3=$G(^PRCA(433,TRANDA,3))
"RTN","RCRJRDEP",164,0)
 . F %=1:1:5 S TOTAL=TOTAL+$P(TRAN3,"^",%)
"RTN","RCRJRDEP",165,0)
 Q TOTAL
"RTN","RCRJROIG")
0^16^B25548246
"RTN","RCRJROIG",1,0)
RCRJROIG ;WISC/RFJ-send data for oig extract ;1 Jul 99
"RTN","RCRJROIG",2,0)
 ;;4.5;Accounts Receivable;**103,174,203,205,220**;Mar 20, 1995
"RTN","RCRJROIG",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCRJROIG",4,0)
 Q
"RTN","RCRJROIG",5,0)
 ;
"RTN","RCRJROIG",6,0)
 ;
"RTN","RCRJROIG",7,0)
NONMCCF(DATEEND) ;  build the non-mccf bills for user report and submission to oig
"RTN","RCRJROIG",8,0)
 N BILLDA,DATE,DATA7,OTHER,PRINCPAL
"RTN","RCRJROIG",9,0)
 S BILLDA=0 F  S BILLDA=$O(^PRCA(430,BILLDA)) Q:'BILLDA  D
"RTN","RCRJROIG",10,0)
 .   ;  if already stored, then it is a current receivable
"RTN","RCRJROIG",11,0)
 .   I $D(^TMP($J,"RCRJROIG",BILLDA)) Q
"RTN","RCRJROIG",12,0)
 .   ;  calculate principal and other (int + admin) balance
"RTN","RCRJROIG",13,0)
 .   S DATA7=$G(^PRCA(430,BILLDA,7))
"RTN","RCRJROIG",14,0)
 .   S PRINCPAL=+$P(DATA7,"^")
"RTN","RCRJROIG",15,0)
 .   S OTHER=$P(DATA7,"^",2)+$P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5)
"RTN","RCRJROIG",16,0)
 .   ;  in some bills, the principal and other balance may cancel
"RTN","RCRJROIG",17,0)
 .   ;  each other.  for example principal .08 + interest -.08 = 0
"RTN","RCRJROIG",18,0)
 .   I (PRINCPAL+OTHER)'>0 Q
"RTN","RCRJROIG",19,0)
 .   ;  store the data for submission to oig
"RTN","RCRJROIG",20,0)
 .   S ^TMP($J,"RCRJROIG",BILLDA)=PRINCPAL_"^"_OTHER
"RTN","RCRJROIG",21,0)
 .   ;  store the data for the user report (only if bill activated)
"RTN","RCRJROIG",22,0)
 .   S DATE=+$P($P($G(^PRCA(430,BILLDA,6)),"^",21),".") I 'DATE Q
"RTN","RCRJROIG",23,0)
 .   S ^TMP($J,"RCRJRCOLREPORT",DATE,BILLDA)=PRINCPAL_"^"_OTHER
"RTN","RCRJROIG",24,0)
 Q
"RTN","RCRJROIG",25,0)
 ;
"RTN","RCRJROIG",26,0)
 ;
"RTN","RCRJROIG",27,0)
OIG(DATEEND) ;  send data to the OIG
"RTN","RCRJROIG",28,0)
 N BILLDA,COUNT,DATA,DATA0,FUND,FYQ,OIGDATA,SEQUENCE,SITE,TOTALAMT
"RTN","RCRJROIG",29,0)
 N TOTALCNT,TOTALMSG,X,X1
"RTN","RCRJROIG",30,0)
 ;
"RTN","RCRJROIG",31,0)
 ;  get previous fiscal year quarter for mail message header
"RTN","RCRJROIG",32,0)
 S FYQ=$E(DATEEND,4,5),FYQ=$S(FYQ<4:1,FYQ<7:2,FYQ<10:3,1:4)
"RTN","RCRJROIG",33,0)
 S SITE=$$SITE^RCMSITE()
"RTN","RCRJROIG",34,0)
 ;
"RTN","RCRJROIG",35,0)
 ;  calculate the number of messages to be sent
"RTN","RCRJROIG",36,0)
 S (X,X1)=0 F  S X=$O(^TMP($J,"RCRJROIG",X)) Q:'X  S X1=X1+1
"RTN","RCRJROIG",37,0)
 S TOTALMSG=X1\272 I X1#272 S TOTALMSG=TOTALMSG+1
"RTN","RCRJROIG",38,0)
        ;
"RTN","RCRJROIG",39,0)
 ;  build the extract for oig
"RTN","RCRJROIG",40,0)
 S COUNT=0     ;  used to count bills to be sent in a single mail msg
"RTN","RCRJROIG",41,0)
 S SEQUENCE=0  ;  used to count mail messages sent (in mail subject)
"RTN","RCRJROIG",42,0)
 S TOTALCNT=0  ;  used to count total bills sent all mail messages
"RTN","RCRJROIG",43,0)
 S TOTALAMT=0  ;  used to calculate total dollars all mail messages
"RTN","RCRJROIG",44,0)
 K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",45,0)
 S BILLDA=0 F  S BILLDA=$O(^TMP($J,"RCRJROIG",BILLDA)) Q:'BILLDA  D
"RTN","RCRJROIG",46,0)
 .   S DATA=^TMP($J,"RCRJROIG",BILLDA)
"RTN","RCRJROIG",47,0)
 .   S DATA0=^PRCA(430,BILLDA,0)
"RTN","RCRJROIG",48,0)
 .   ;  bill number, position 1-11
"RTN","RCRJROIG",49,0)
 .   S OIGDATA=$$LJ^XLFSTR($P(DATA0,"^"),11)
"RTN","RCRJROIG",50,0)
 .   ;  category, position 12-36
"RTN","RCRJROIG",51,0)
 .   S OIGDATA=OIGDATA_$$LJ^XLFSTR($E($P($G(^PRCA(430.2,+$P(DATA0,"^",2),0)),"^"),1,25),25)
"RTN","RCRJROIG",52,0)
 .   ;  status, position 37-56
"RTN","RCRJROIG",53,0)
 .   S OIGDATA=OIGDATA_$$LJ^XLFSTR($E($P($G(^PRCA(430.3,+$P(DATA0,"^",8),0)),"^"),1,20),20)
"RTN","RCRJROIG",54,0)
 .   ;  principal balance, position 57-65 (example 000000110 for 1.10)
"RTN","RCRJROIG",55,0)
 .   S OIGDATA=OIGDATA_$TR($J($P(DATA,"^"),10,2)," .","0")
"RTN","RCRJROIG",56,0)
 .   ;  date status last updated, position 66-76 (example APR 08,1999)
"RTN","RCRJROIG",57,0)
 .   S OIGDATA=OIGDATA_$$DATE($P(DATA0,"^",14))
"RTN","RCRJROIG",58,0)
 .   ;  fms fund, position 77-82
"RTN","RCRJROIG",59,0)
 .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCRJROIG",60,0)
 .   S FUND=$$ADJFUND^RCRJRCO(FUND) ; may delete this line after 10/1/03
"RTN","RCRJROIG",61,0)
 .   S OIGDATA=OIGDATA_$J(FUND,6)
"RTN","RCRJROIG",62,0)
 .   ;  revenue source code, position 83-86
"RTN","RCRJROIG",63,0)
 .   S OIGDATA=OIGDATA_$J($$GETRSC(BILLDA,FUND),4)
"RTN","RCRJROIG",64,0)
 .   ;  general ledger account number, position 87-90
"RTN","RCRJROIG",65,0)
 .   S OIGDATA=OIGDATA_$J($P(DATA,"^",3),4)
"RTN","RCRJROIG",66,0)
 .   ;  date bill entered, position 91-101 (example APR 08,1999)
"RTN","RCRJROIG",67,0)
 .   S OIGDATA=OIGDATA_$$DATE($P(DATA0,"^",10))
"RTN","RCRJROIG",68,0)
 .   ;  interest + admin balance, position 102-110
"RTN","RCRJROIG",69,0)
 .   S OIGDATA=OIGDATA_$TR($J($P(DATA,"^",2),10,2)," .","0")_"$"
"RTN","RCRJROIG",70,0)
 .   ;
"RTN","RCRJROIG",71,0)
 .   ;  total count and dollars for bills sent
"RTN","RCRJROIG",72,0)
 .   S TOTALCNT=TOTALCNT+1
"RTN","RCRJROIG",73,0)
 .   S TOTALAMT=TOTALAMT+$P(DATA,"^")
"RTN","RCRJROIG",74,0)
 .   ;
"RTN","RCRJROIG",75,0)
 .   ;  store data for transmission
"RTN","RCRJROIG",76,0)
 .   S COUNT=COUNT+1
"RTN","RCRJROIG",77,0)
 .   S ^TMP($J,"RCRJROIGMM",COUNT)=OIGDATA
"RTN","RCRJROIG",78,0)
 .   ;  only send message with 272 bills
"RTN","RCRJROIG",79,0)
 .   I COUNT'=272 Q
"RTN","RCRJROIG",80,0)
 .   ;  if there are no more bills, do not send message until the
"RTN","RCRJROIG",81,0)
 .   ;  totals are placed at the end
"RTN","RCRJROIG",82,0)
 .   I '$O(^TMP($J,"RCRJROIG",BILLDA)) Q
"RTN","RCRJROIG",83,0)
 .   ;
"RTN","RCRJROIG",84,0)
 .   ;  send current code sheets
"RTN","RCRJROIG",85,0)
 .   S SEQUENCE=SEQUENCE+1
"RTN","RCRJROIG",86,0)
 .   D MAILIT(SITE,FYQ,SEQUENCE)
"RTN","RCRJROIG",87,0)
 .   S COUNT=0
"RTN","RCRJROIG",88,0)
 .   K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",89,0)
 ;
"RTN","RCRJROIG",90,0)
 ;  mail last message with totals at the end
"RTN","RCRJROIG",91,0)
 S COUNT=COUNT+1
"RTN","RCRJROIG",92,0)
 S ^TMP($J,"RCRJROIGMM",COUNT)="END OF TRANSMISSION FOR SITE# "_SITE_":  TOTAL RECORDS: "_TOTALCNT_"  TOTAL AMOUNT: "_TOTALAMT
"RTN","RCRJROIG",93,0)
 S SEQUENCE=SEQUENCE+1
"RTN","RCRJROIG",94,0)
 D MAILIT(SITE,FYQ,SEQUENCE)
"RTN","RCRJROIG",95,0)
 ;
"RTN","RCRJROIG",96,0)
 K ^TMP($J,"RCRJROIGMM")
"RTN","RCRJROIG",97,0)
 K ^TMP($J,"RCRJROIG")
"RTN","RCRJROIG",98,0)
 Q
"RTN","RCRJROIG",99,0)
 ;
"RTN","RCRJROIG",100,0)
 ;
"RTN","RCRJROIG",101,0)
MAILIT(SITE,FYQ,SEQUENCE) ;  send code sheets to oig
"RTN","RCRJROIG",102,0)
 N %,%H,%Z,X,XCNP,XMDUZ,XMSCR,XMSUB,XMY,XMZ,Y
"RTN","RCRJROIG",103,0)
 ;
"RTN","RCRJROIG",104,0)
 ;  set a header record in each file to be transmitted
"RTN","RCRJROIG",105,0)
 S ^TMP($J,"RCRJROIGMM",.5)="OH$"_$$RJ^XLFSTR(SEQUENCE,5,0)_"$"_$$RJ^XLFSTR(TOTALMSG,5,0)_"$|"
"RTN","RCRJROIG",106,0)
 ;
"RTN","RCRJROIG",107,0)
 I TOTALCNT=0 S XMY("G.RC AR DATA COLLECTOR")=""
"RTN","RCRJROIG",108,0)
 S XMY("XXX@Q-OIG.VA.GOV")=""
"RTN","RCRJROIG",109,0)
 S XMDUZ="AR PACKAGE"
"RTN","RCRJROIG",110,0)
 S %H=$H D YX^%DTC
"RTN","RCRJROIG",111,0)
 S XMSUB=SITE_"/BILL/"_FYQ_"/SEQ#: "_SEQUENCE_"/"_Y
"RTN","RCRJROIG",112,0)
 S XMTEXT="^TMP($J,""RCRJROIGMM"","
"RTN","RCRJROIG",113,0)
 D ^XMD
"RTN","RCRJROIG",114,0)
 Q
"RTN","RCRJROIG",115,0)
 ;
"RTN","RCRJROIG",116,0)
 ;
"RTN","RCRJROIG",117,0)
DATE(DATE) ;  format date
"RTN","RCRJROIG",118,0)
 ;  example input=2990408, output=APR 08,1999
"RTN","RCRJROIG",119,0)
 I DATE D
"RTN","RCRJROIG",120,0)
 .   S Y=DATE D DD^%DT
"RTN","RCRJROIG",121,0)
 .   S DATE=$E(Y,1,3)_" "_$E(DATE,6,7)_","_(1700+$E(DATE,1,3))
"RTN","RCRJROIG",122,0)
 Q $$LJ^XLFSTR(DATE,11)
"RTN","RCRJROIG",123,0)
 ;
"RTN","RCRJROIG",124,0)
 ;
"RTN","RCRJROIG",125,0)
GETRSC(BILLDA,FUND) ;  return the rsc for a bill
"RTN","RCRJROIG",126,0)
 I '$$PTACCT^PRCAACC(FUND),FUND'=4032 Q $P($G(^PRCA(430,BILLDA,11)),"^",6)
"RTN","RCRJROIG",127,0)
 ;  check missing patient for reimbursable health insurance
"RTN","RCRJROIG",128,0)
 I $P(^PRCA(430,BILLDA,0),"^",2)=9,'$P(^PRCA(430,BILLDA,0),"^",7) Q "    "
"RTN","RCRJROIG",129,0)
 Q $$CALCRSC^RCXFMSUR(BILLDA)
"RTN","RCXFMSC1")
0^17^B18818760
"RTN","RCXFMSC1",1,0)
RCXFMSC1 ;WISC/RFJ-fms cash receipt (cr) build lines ;1 Oct 97
"RTN","RCXFMSC1",2,0)
 ;;4.5;Accounts Receivable;**90,96,106,113,135,98,173,220**;Mar 20, 1995
"RTN","RCXFMSC1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSC1",4,0)
 Q
"RTN","RCXFMSC1",5,0)
 ;
"RTN","RCXFMSC1",6,0)
 ;
"RTN","RCXFMSC1",7,0)
FMSLINES(RECEIPDA,RCTR) ;  receipda is the ien for the receipt in file 344
"RTN","RCXFMSC1",8,0)
 ;  return total(fund,revsrce,vendorid,fmstrantype) = dollar amount
"RTN","RCXFMSC1",9,0)
 ; RCTR = 1 if extracting for a TR document, null or 0 if for CR
"RTN","RCXFMSC1",10,0)
 ;
"RTN","RCXFMSC1",11,0)
 N %,ACCRUAL,AMOUNT,BILLDA,CATEGORY,FMSTYPE,FUND,RECEIPT,REVSRCE
"RTN","RCXFMSC1",12,0)
 N TRAN0,TRAN3,TRANDA,VENDORID,RECEFT,RCEDILB,Z
"RTN","RCXFMSC1",13,0)
 ;
"RTN","RCXFMSC1",14,0)
 S RCEDILB=$$EDILB^RCDPEU(RECEIPDA),RCTR=$G(RCTR)
"RTN","RCXFMSC1",15,0)
 S RECEFT=$S(RCEDILB=1:1,1:"") ; EFT deposit CR doc
"RTN","RCXFMSC1",16,0)
 S RECEIPT=$P($G(^RCY(344,RECEIPDA,0)),"^")
"RTN","RCXFMSC1",17,0)
 I RECEIPT="" Q
"RTN","RCXFMSC1",18,0)
 ;
"RTN","RCXFMSC1",19,0)
 S TRANDA=0 F  S TRANDA=$O(^PRCA(433,"AF",RECEIPT,TRANDA)) Q:'TRANDA  D
"RTN","RCXFMSC1",20,0)
 .   S TRAN0=$G(^PRCA(433,TRANDA,0)),TRAN3=$G(^PRCA(433,TRANDA,3))
"RTN","RCXFMSC1",21,0)
 .   S CATEGORY=$P($G(^PRCA(430,+$P(TRAN0,"^",2),0)),"^",2)
"RTN","RCXFMSC1",22,0)
 .   S BILLDA=+$P(TRAN0,"^",2)
"RTN","RCXFMSC1",23,0)
 .   ;
"RTN","RCXFMSC1",24,0)
 .   ;  do not send champva
"RTN","RCXFMSC1",25,0)
 .   I CATEGORY=29 S FUND="0160a1" D SETTMP Q
"RTN","RCXFMSC1",26,0)
 .   ;
"RTN","RCXFMSC1",27,0)
 .   S ACCRUAL=$$ACCK^PRCAACC(BILLDA)
"RTN","RCXFMSC1",28,0)
 .   ;
"RTN","RCXFMSC1",29,0)
 .   ;  if its not an accrual, send a detail document
"RTN","RCXFMSC1",30,0)
 .   I 'ACCRUAL D  Q
"RTN","RCXFMSC1",31,0)
 .   .   S FMSTYPE=$$GETTYPE(BILLDA,RCTR)
"RTN","RCXFMSC1",32,0)
 .   .   I FMSTYPE="" S FMSTYPE="XX" ; make it reject if missing
"RTN","RCXFMSC1",33,0)
 .   .   ;  send a detail document only if there is principal
"RTN","RCXFMSC1",34,0)
 .   .   I $P(TRAN3,"^") S DETAIL(FMSTYPE,BILLDA)=$G(DETAIL(FMSTYPE,BILLDA))+$P(TRAN3,"^")
"RTN","RCXFMSC1",35,0)
 .   .   ;  set tmp global which is used by the 215 report
"RTN","RCXFMSC1",36,0)
 .   .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,,RECEFT) D SETTMP
"RTN","RCXFMSC1",37,0)
 .   .   ;
"RTN","RCXFMSC1",38,0)
 .   .   ;  look for interest and admin charges
"RTN","RCXFMSC1",39,0)
 .   .   ;  use vendorid x for totals
"RTN","RCXFMSC1",40,0)
 .   .   S VENDORID="MISCN"
"RTN","RCXFMSC1",41,0)
 .   .   ;  get the revenue source code for the bill
"RTN","RCXFMSC1",42,0)
 .   .   S REVSRCE=$$CALCRSC^RCXFMSUR(BILLDA,RECEFT)
"RTN","RCXFMSC1",43,0)
 .   .   D INTADMIN
"RTN","RCXFMSC1",44,0)
 .   ;
"RTN","RCXFMSC1",45,0)
 .   ;  get the fund for the bill
"RTN","RCXFMSC1",46,0)
 .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,,RECEFT)
"RTN","RCXFMSC1",47,0)
 .   ;
"RTN","RCXFMSC1",48,0)
 .   ;  get the vendor id $p(2) for the bill
"RTN","RCXFMSC1",49,0)
 .   S VENDORID=$S(FUND=528709:"EXCFVALUE",FUND=4032:"EXCFVALUE",1:"MCCFVALUE")
"RTN","RCXFMSC1",50,0)
 .   ;
"RTN","RCXFMSC1",51,0)
 .   ;  get the revenue source code for the bill
"RTN","RCXFMSC1",52,0)
 .   S REVSRCE=$$CALCRSC^RCXFMSUR(BILLDA,RECEFT)
"RTN","RCXFMSC1",53,0)
 .   ;
"RTN","RCXFMSC1",54,0)
 .   ;  get the principle collected, $p(tran3,"^"), if prepayment
"RTN","RCXFMSC1",55,0)
 .   ;  set it to 1;5 with no interest, admin, etc.
"RTN","RCXFMSC1",56,0)
 .   I CATEGORY=26 S TRAN3=$P($G(^PRCA(433,TRANDA,1)),"^",5)
"RTN","RCXFMSC1",57,0)
 .   ;
"RTN","RCXFMSC1",58,0)
 .   ;  total principal
"RTN","RCXFMSC1",59,0)
 .   D TOTAL($P(TRAN3,"^"))
"RTN","RCXFMSC1",60,0)
 .   ;
"RTN","RCXFMSC1",61,0)
 .   ;  set tmp for detail
"RTN","RCXFMSC1",62,0)
 .   D SETTMP
"RTN","RCXFMSC1",63,0)
 .   ;
"RTN","RCXFMSC1",64,0)
 .   ;  check for interest collected
"RTN","RCXFMSC1",65,0)
 .   D INTADMIN
"RTN","RCXFMSC1",66,0)
 Q
"RTN","RCXFMSC1",67,0)
 ;
"RTN","RCXFMSC1",68,0)
 ;
"RTN","RCXFMSC1",69,0)
INTADMIN ;  check for interest and admin charges
"RTN","RCXFMSC1",70,0)
 S AMOUNT=$P(TRAN3,"^",2)
"RTN","RCXFMSC1",71,0)
 I AMOUNT S FUND=$$GETFUNDO^RCXFMSUF("I") D TOTAL(AMOUNT)
"RTN","RCXFMSC1",72,0)
 ;  check for admin collected
"RTN","RCXFMSC1",73,0)
 S AMOUNT=$P(TRAN3,"^",3)
"RTN","RCXFMSC1",74,0)
 I AMOUNT S FUND=$$GETFUNDO^RCXFMSUF("A") D TOTAL(AMOUNT)
"RTN","RCXFMSC1",75,0)
 ;  check for marshall fee collected
"RTN","RCXFMSC1",76,0)
 S AMOUNT=$P(TRAN3,"^",4)
"RTN","RCXFMSC1",77,0)
 I AMOUNT S FUND=$$GETFUNDO^RCXFMSUF("M") D TOTAL(AMOUNT)
"RTN","RCXFMSC1",78,0)
 ;  check for court cost collected
"RTN","RCXFMSC1",79,0)
 S AMOUNT=$P(TRAN3,"^",5)
"RTN","RCXFMSC1",80,0)
 I AMOUNT S FUND=$$GETFUNDO^RCXFMSUF("C") D TOTAL(AMOUNT)
"RTN","RCXFMSC1",81,0)
 Q
"RTN","RCXFMSC1",82,0)
 ;
"RTN","RCXFMSC1",83,0)
 ;
"RTN","RCXFMSC1",84,0)
TOTAL(AMOUNT) ;  accumulate totals for summary document
"RTN","RCXFMSC1",85,0)
 I 'AMOUNT Q
"RTN","RCXFMSC1",86,0)
 ;  check key elements and if null set to X's to reject
"RTN","RCXFMSC1",87,0)
 I FUND="" S FUND="XXXXXX"
"RTN","RCXFMSC1",88,0)
 I REVSRCE="" S REVSRCE="XXXX"
"RTN","RCXFMSC1",89,0)
 I VENDORID="" S VENDORID="XXXXX"
"RTN","RCXFMSC1",90,0)
 ;
"RTN","RCXFMSC1",91,0)
 S TOTAL(FUND,REVSRCE,VENDORID)=$G(TOTAL(FUND,REVSRCE,VENDORID))+AMOUNT
"RTN","RCXFMSC1",92,0)
 Q
"RTN","RCXFMSC1",93,0)
 ;
"RTN","RCXFMSC1",94,0)
 ;
"RTN","RCXFMSC1",95,0)
SETTMP ;  set the tmp global for detailed data by bill
"RTN","RCXFMSC1",96,0)
 ;  the tmp global is used by the 215 report (rcy215a)
"RTN","RCXFMSC1",97,0)
 I FUND="" S FUND="XXXXXX"
"RTN","RCXFMSC1",98,0)
 ;
"RTN","RCXFMSC1",99,0)
 S %=$G(^TMP($J,"RCFMSCR",FUND,BILLDA))
"RTN","RCXFMSC1",100,0)
 S $P(%,"^",1)=$P(%,"^",1)+$P(TRAN3,"^",1)  ; principal
"RTN","RCXFMSC1",101,0)
 S $P(%,"^",2)=$P(%,"^",2)+$P(TRAN3,"^",2)  ; interest
"RTN","RCXFMSC1",102,0)
 S $P(%,"^",3)=$P(%,"^",3)+$P(TRAN3,"^",3)  ; admin
"RTN","RCXFMSC1",103,0)
 S $P(%,"^",4)=$P(%,"^",4)+$P(TRAN3,"^",4)  ; marshal fee
"RTN","RCXFMSC1",104,0)
 S $P(%,"^",5)=$P(%,"^",5)+$P(TRAN3,"^",5)  ; court cost
"RTN","RCXFMSC1",105,0)
 S ^TMP($J,"RCFMSCR",FUND,BILLDA)=%
"RTN","RCXFMSC1",106,0)
 Q
"RTN","RCXFMSC1",107,0)
 ;
"RTN","RCXFMSC1",108,0)
 ;
"RTN","RCXFMSC1",109,0)
GETTYPE(BILLDA,RCTR) ;  return a bills fms transaction type (which goes on the CRA code
"RTN","RCXFMSC1",110,0)
 ;  sheet) from the field 259 refund/reimbursement in file 430.
"RTN","RCXFMSC1",111,0)
 ; If RCTR = 1, return TR code, otherwise return CR code
"RTN","RCXFMSC1",112,0)
 N REFUND
"RTN","RCXFMSC1",113,0)
 S RCTR=$S($G(RCTR):7,1:3) ; CR code is in piece 3 of data, TR is in pc 7
"RTN","RCXFMSC1",114,0)
 S REFUND=$$RECTYP^PRCAFUT(BILLDA)
"RTN","RCXFMSC1",115,0)
 I REFUND<0 S REFUND=""
"RTN","RCXFMSC1",116,0)
 I $L(REFUND)=1 S REFUND="0"_REFUND
"RTN","RCXFMSC1",117,0)
 ;  this call gets the transaction type from file 347.4
"RTN","RCXFMSC1",118,0)
 S REFUND=$$DTYPE^PRCAFBD1(REFUND)
"RTN","RCXFMSC1",119,0)
 I REFUND<0 S REFUND=""
"RTN","RCXFMSC1",120,0)
 Q $S($P(REFUND,"^",RCTR)'="":$P(REFUND,"^",RCTR),1:REFUND)
"RTN","RCXFMSC1",121,0)
 ;
"RTN","RCXFMSC1",122,0)
 ;
"RTN","RCXFMSC1",123,0)
LINE(BILLDA) ;
"RTN","RCXFMSC1",124,0)
 ;returns FMS line number
"RTN","RCXFMSC1",125,0)
 N X
"RTN","RCXFMSC1",126,0)
 S X=$P($G(^PRCA(430,BILLDA,11)),"^",4)
"RTN","RCXFMSC1",127,0)
 I X="" S X="001"
"RTN","RCXFMSC1",128,0)
 Q X
"RTN","RCXFMSCR")
0^23^B30302110
"RTN","RCXFMSCR",1,0)
RCXFMSCR ;WISC/RFJ-fms cash receipt (cr) code sheet generator ;1 Oct 97
"RTN","RCXFMSCR",2,0)
 ;;4.5;Accounts Receivable;**90,114,148,172,204,203,173,220**;Mar 20, 1995
"RTN","RCXFMSCR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSCR",4,0)
 Q
"RTN","RCXFMSCR",5,0)
 ;
"RTN","RCXFMSCR",6,0)
BUILDCR(RCRECTDA,RCGECSDA,RCEFT) ;  generate a cr/tr code sheet for a receipt
"RTN","RCXFMSCR",7,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMSCR",8,0)
 ;  rceft = 1 if processing CR for an EFT deposit (CR to rev src cd 8NZZ)
"RTN","RCXFMSCR",9,0)
 ;        = 2 if processing TR for the receipt detail relating to an EFT
"RTN","RCXFMSCR",10,0)
 ;              (TR from 528704/8NZZ to original fund/rsc)
"RTN","RCXFMSCR",11,0)
 ;
"RTN","RCXFMSCR",12,0)
 N AMOUNT,BILLDA,COUNT,CR2,DETAIL,DEPOSIT,DESCRIP,DOCTOTAL,FISCALYR,FMSTYPE,FUND,GECSFMS,LINE,RCDEPTDA,REVSRCE,TOTAL,TRANDA,TRANNUMB,UNAPPLY,UNAPPNUM,VENDORID,EFTDEP
"RTN","RCXFMSCR",13,0)
 ;
"RTN","RCXFMSCR",14,0)
 ;  build the lines for all payments on receipt
"RTN","RCXFMSCR",15,0)
 S RCEFT=+$G(RCEFT)
"RTN","RCXFMSCR",16,0)
 K ^TMP($J,"RCFMSCR")  ;  used for 215 report, not used here
"RTN","RCXFMSCR",17,0)
 D FMSLINES^RCXFMSC1(RCRECTDA)
"RTN","RCXFMSCR",18,0)
 K ^TMP($J,"RCFMSCR")
"RTN","RCXFMSCR",19,0)
 ;
"RTN","RCXFMSCR",20,0)
 ;  unapplied payments to accounts
"RTN","RCXFMSCR",21,0)
 S TRANDA=0 F  S TRANDA=$O(^RCY(344,RCRECTDA,1,TRANDA)) Q:'TRANDA  D
"RTN","RCXFMSCR",22,0)
 .   ;  dollars applied in AR
"RTN","RCXFMSCR",23,0)
 .   I $P(^RCY(344,RCRECTDA,1,TRANDA,0),"^",5) Q
"RTN","RCXFMSCR",24,0)
 .   ;  no dollars on transaction
"RTN","RCXFMSCR",25,0)
 .   S AMOUNT=$P(^RCY(344,RCRECTDA,1,TRANDA,0),"^",4) I 'AMOUNT Q
"RTN","RCXFMSCR",26,0)
 .   ;
"RTN","RCXFMSCR",27,0)
 .   I RCEFT=1 S TOTAL("5287"_$S(DT<3030926:"",DT'<3030926&(DT<$$ADDPTEDT^PRCAACC()):".4",1:"04"),"8NZZ","MCCFVALUE")=$G(TOTAL("5287"_$S(DT<3030926:"",1:"04"),"8NZZ","MCCFVALUE"))+AMOUNT Q
"RTN","RCXFMSCR",28,0)
 .   S UNAPPLY($$GETUNAPP(RCRECTDA,TRANDA,1))=AMOUNT
"RTN","RCXFMSCR",29,0)
 ;
"RTN","RCXFMSCR",30,0)
 ;  no code sheets to send
"RTN","RCXFMSCR",31,0)
 I '$D(DETAIL),'$D(TOTAL),'$D(UNAPPLY) Q "-1^No code sheets to send for this receipt"
"RTN","RCXFMSCR",32,0)
 ;
"RTN","RCXFMSCR",33,0)
 ;  get the next common number in the series = station "-" nextnumber
"RTN","RCXFMSCR",34,0)
 ;  use (field 200 in file 344) if document previously sent
"RTN","RCXFMSCR",35,0)
 S TRANNUMB=$P($P($G(^RCY(344,RCRECTDA,2)),"^"),"-",2)
"RTN","RCXFMSCR",36,0)
 I TRANNUMB="" S TRANNUMB=$$ENUM^RCMSNUM
"RTN","RCXFMSCR",37,0)
 I TRANNUMB<0 Q "0^Unable to lookup next transaction number"
"RTN","RCXFMSCR",38,0)
 ;  remove the dash (i,e, 460-K1A05HY)
"RTN","RCXFMSCR",39,0)
 S TRANNUMB=$TR(TRANNUMB,"-")
"RTN","RCXFMSCR",40,0)
 ;
"RTN","RCXFMSCR",41,0)
 S FISCALYR=$$FY^RCFN01(DT)
"RTN","RCXFMSCR",42,0)
 ;
"RTN","RCXFMSCR",43,0)
 S COUNT=0,DOCTOTAL=0
"RTN","RCXFMSCR",44,0)
 ;  build detail line
"RTN","RCXFMSCR",45,0)
 S FMSTYPE="" F  S FMSTYPE=$O(DETAIL(FMSTYPE)) Q:FMSTYPE=""  D
"RTN","RCXFMSCR",46,0)
 .   S BILLDA=0 F  S BILLDA=$O(DETAIL(FMSTYPE,BILLDA)) Q:'BILLDA  D
"RTN","RCXFMSCR",47,0)
 .   .   S AMOUNT=DETAIL(FMSTYPE,BILLDA),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSCR",48,0)
 .   .   S COUNT=COUNT+1
"RTN","RCXFMSCR",49,0)
 .   .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSCR",50,0)
 .   .   S $P(LINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSCR",51,0)
 .   .   S $P(LINE(COUNT),"^",21)="I"
"RTN","RCXFMSCR",52,0)
 .   .   S $P(LINE(COUNT),"^",23)=FMSTYPE
"RTN","RCXFMSCR",53,0)
 .   .   S $P(LINE(COUNT),"^",24)="BD"
"RTN","RCXFMSCR",54,0)
 .   .   S $P(LINE(COUNT),"^",25)=$TR($P(^PRCA(430,BILLDA,0),"^"),"-")
"RTN","RCXFMSCR",55,0)
 .   .   S $P(LINE(COUNT),"^",26)=$$LINE^RCXFMSC1(BILLDA)
"RTN","RCXFMSCR",56,0)
 .   .   S $P(LINE(COUNT),"^",27)="~"
"RTN","RCXFMSCR",57,0)
 ;
"RTN","RCXFMSCR",58,0)
 ;  build summary line
"RTN","RCXFMSCR",59,0)
 S FUND="" F  S FUND=$O(TOTAL(FUND)) Q:FUND=""  D
"RTN","RCXFMSCR",60,0)
 .   S REVSRCE="" F  S REVSRCE=$O(TOTAL(FUND,REVSRCE)) Q:REVSRCE=""  D
"RTN","RCXFMSCR",61,0)
 .   .   S VENDORID="" F  S VENDORID=$O(TOTAL(FUND,REVSRCE,VENDORID)) Q:VENDORID=""  D
"RTN","RCXFMSCR",62,0)
 .   .   .   S AMOUNT=TOTAL(FUND,REVSRCE,VENDORID),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSCR",63,0)
 .   .   .   S COUNT=COUNT+1
"RTN","RCXFMSCR",64,0)
 .   .   .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSCR",65,0)
 .   .   .   S $P(LINE(COUNT),"^",4)=$S(FUND=4032:"03",1:FISCALYR)
"RTN","RCXFMSCR",66,0)
 .   .   .   S $P(LINE(COUNT),"^",6)=FUND
"RTN","RCXFMSCR",67,0)
 .   .   .   S $P(LINE(COUNT),"^",7)=$E(TRANNUMB,1,3) ; station #
"RTN","RCXFMSCR",68,0)
 .   .   .   S $P(LINE(COUNT),"^",10)=REVSRCE
"RTN","RCXFMSCR",69,0)
 .   .   .   ;I FUND=4032 S $P(LINE(COUNT),"^",13)="24GX40100"
"RTN","RCXFMSCR",70,0)
 .   .   .   S $P(LINE(COUNT),"^",18)=VENDORID
"RTN","RCXFMSCR",71,0)
 .   .   .   S $P(LINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSCR",72,0)
 .   .   .   S $P(LINE(COUNT),"^",21)="I"
"RTN","RCXFMSCR",73,0)
 .   .   .   S $P(LINE(COUNT),"^",23)=23
"RTN","RCXFMSCR",74,0)
 .   .   .   S $P(LINE(COUNT),"^",24)="~"
"RTN","RCXFMSCR",75,0)
 ;
"RTN","RCXFMSCR",76,0)
 ;  build unapplied payment lines
"RTN","RCXFMSCR",77,0)
 S UNAPPNUM="" F  S UNAPPNUM=$O(UNAPPLY(UNAPPNUM)) Q:UNAPPNUM=""  D
"RTN","RCXFMSCR",78,0)
 .   S AMOUNT=UNAPPLY(UNAPPNUM),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSCR",79,0)
 .   S COUNT=COUNT+1
"RTN","RCXFMSCR",80,0)
 .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSCR",81,0)
 .   S $P(LINE(COUNT),"^",4)=FISCALYR
"RTN","RCXFMSCR",82,0)
 .   S $P(LINE(COUNT),"^",6)=3875
"RTN","RCXFMSCR",83,0)
 .   S $P(LINE(COUNT),"^",7)=$E(TRANNUMB,1,3) ; station #
"RTN","RCXFMSCR",84,0)
 .   S $P(LINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSCR",85,0)
 .   S $P(LINE(COUNT),"^",21)="I"
"RTN","RCXFMSCR",86,0)
 .   S $P(LINE(COUNT),"^",23)=17
"RTN","RCXFMSCR",87,0)
 .   S $P(LINE(COUNT),"^",24)="~CRB"
"RTN","RCXFMSCR",88,0)
 .   S $P(LINE(COUNT),"^",32)=UNAPPNUM
"RTN","RCXFMSCR",89,0)
 .   S $P(LINE(COUNT),"^",33)="~"
"RTN","RCXFMSCR",90,0)
 ;
"RTN","RCXFMSCR",91,0)
 ;  get data from file 344.1, the ar deposit file
"RTN","RCXFMSCR",92,0)
 S RCDEPTDA=$P(^RCY(344,RCRECTDA,0),"^",6),DEPOSIT=$G(^RCY(344.1,RCDEPTDA,0))
"RTN","RCXFMSCR",93,0)
 ;
"RTN","RCXFMSCR",94,0)
 ;  build cr2, $p(deposit,^,3)=deposit date
"RTN","RCXFMSCR",95,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","RCXFMSCR",96,0)
 S CR2="CR2^"_$E(FMSDT,2,3)_"^"_$E(FMSDT,4,5)_"^"_$E(FMSDT,6,7)_"^^^^^^E^^^"
"RTN","RCXFMSCR",97,0)
 S CR2=CR2_$P(DEPOSIT,"^")_"^^"_$J(DOCTOTAL,0,2)_"^^"
"RTN","RCXFMSCR",98,0)
 S CR2=CR2_$E($P(DEPOSIT,"^",3),2,3)_"^"_$E($P(DEPOSIT,"^",3),4,5)_"^"_$E($P(DEPOSIT,"^",3),6,7)_"^~"
"RTN","RCXFMSCR",99,0)
 ;
"RTN","RCXFMSCR",100,0)
 ;  put together document in gcs
"RTN","RCXFMSCR",101,0)
 N %DT,D,D0,DA,DI,DIC,DIE,DIQ2,DQ,DR
"RTN","RCXFMSCR",102,0)
 S DESCRIP="Receipt: "_$P(^RCY(344,RCRECTDA,0),"^")
"RTN","RCXFMSCR",103,0)
 I 'RCGECSDA D CONTROL^GECSUFMS("A",$E(TRANNUMB,1,3),TRANNUMB,"CR",10,0,"",DESCRIP)
"RTN","RCXFMSCR",104,0)
 I RCGECSDA D REBUILD^GECSUFM1(RCGECSDA,"A",10,"N","Rebuild "_DESCRIP) S GECSFMS("DA")=RCGECSDA
"RTN","RCXFMSCR",105,0)
 ;
"RTN","RCXFMSCR",106,0)
 ;  store document in gcs
"RTN","RCXFMSCR",107,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),CR2)
"RTN","RCXFMSCR",108,0)
 F COUNT=1:1 Q:'$D(LINE(COUNT))  D SETCS^GECSSTAA(GECSFMS("DA"),LINE(COUNT))
"RTN","RCXFMSCR",109,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMSCR",110,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMSCR",111,0)
 ;
"RTN","RCXFMSCR",112,0)
 ;  add/update entry in file 347 for unprocessed document report
"RTN","RCXFMSCR",113,0)
 N %DT,%X,D,DA347,D0,DI,DQ,DIC,ERROR,FMSDOCNO,X
"RTN","RCXFMSCR",114,0)
 S FMSDOCNO="CR-"_$P(GECSFMS("CTL"),"^",9)
"RTN","RCXFMSCR",115,0)
 S DA347=$O(^RC(347,"C",FMSDOCNO,0))
"RTN","RCXFMSCR",116,0)
 ;  if not in the file, addit   fmsdocid   cr   id
"RTN","RCXFMSCR",117,0)
 I 'DA347 D OPEN^RCFMDRV1(FMSDOCNO,3,"RC"_$P($G(^RCY(344,RCRECTDA,0)),"^"),.DA347,.ERROR)
"RTN","RCXFMSCR",118,0)
 I DA347 D SSTAT^RCFMFN02(FMSDOCNO,1)
"RTN","RCXFMSCR",119,0)
 ;
"RTN","RCXFMSCR",120,0)
 ;  return 1 for success ^ fms document transaction number
"RTN","RCXFMSCR",121,0)
 Q "1^"_FMSDOCNO
"RTN","RCXFMSCR",122,0)
 ;
"RTN","RCXFMSCR",123,0)
 ;
"RTN","RCXFMSCR",124,0)
GETUNAPP(RCRECTDA,RCTRANDA,RCSTORE) ;  get unapplied deposit number for receipt
"RTN","RCXFMSCR",125,0)
 ;  if $g(rcstore) store it with transaction
"RTN","RCXFMSCR",126,0)
 N UNAPPNUM
"RTN","RCXFMSCR",127,0)
 ;  if number is already assigned, use it
"RTN","RCXFMSCR",128,0)
 I $P($G(^RCY(344,RCRECTDA,1,RCTRANDA,2)),"^",5)'="" Q $P(^(2),"^",5)
"RTN","RCXFMSCR",129,0)
 ;
"RTN","RCXFMSCR",130,0)
 S UNAPPNUM=$P(^RCY(344,RCRECTDA,0),"^")
"RTN","RCXFMSCR",131,0)
 ;  if the receipt number is more than 9 characters, take the last 9
"RTN","RCXFMSCR",132,0)
 I $L(UNAPPNUM)>9 S UNAPPNUM=$E(UNAPPNUM,$L(UNAPPNUM)-8,$L(UNAPPNUM))
"RTN","RCXFMSCR",133,0)
 S UNAPPNUM=UNAPPNUM_$TR($J(RCTRANDA,4)," ",0)
"RTN","RCXFMSCR",134,0)
 ;
"RTN","RCXFMSCR",135,0)
 ;  store unapplied number
"RTN","RCXFMSCR",136,0)
 I $G(RCSTORE) D SETUNAPP^RCDPURET(RCRECTDA,RCTRANDA,UNAPPNUM)
"RTN","RCXFMSCR",137,0)
 ;
"RTN","RCXFMSCR",138,0)
 Q UNAPPNUM
"RTN","RCXFMSSV")
0^18^B50204707
"RTN","RCXFMSSV",1,0)
RCXFMSSV ;WISC/RFJ-fms standard voucher (sv) code sheet generator ;1 Nov 97
"RTN","RCXFMSSV",2,0)
 ;;4.5;Accounts Receivable;**96,101,135,139,98,156,170,191,203,220**;Mar 20, 1995
"RTN","RCXFMSSV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSSV",4,0)
 Q
"RTN","RCXFMSSV",5,0)
 ;
"RTN","RCXFMSSV",6,0)
 ;
"RTN","RCXFMSSV",7,0)
STARTSV(RCDATEND) ;  top entry point to generate a sv code sheet
"RTN","RCXFMSSV",8,0)
 ;
"RTN","RCXFMSSV",9,0)
 ;  rcdatend is the ending date of the period.
"RTN","RCXFMSSV",10,0)
 ;  This date is the 3rd work day from the end of the month.
"RTN","RCXFMSSV",11,0)
 ;  The utility $$LDATE^RCRJR is used to figure it out. It will
"RTN","RCXFMSSV",12,0)
 ;  change from month to month and figures in holidays also.
"RTN","RCXFMSSV",13,0)
 ;  For example,  if running the ARDC for the month of June 2003
"RTN","RCXFMSSV",14,0)
 ;  the EOAM will calculate out to be June 25, 2003.
"RTN","RCXFMSSV",15,0)
 ;  This is called by the background monthly data collector
"RTN","RCXFMSSV",16,0)
 ;
"RTN","RCXFMSSV",17,0)
 ;  data stored in tmp($j,rcrjrcolsv,type,fund,revsourcecode)
"RTN","RCXFMSSV",18,0)
 ;  this is called by the background monthly data collector
"RTN","RCXFMSSV",19,0)
 ;
"RTN","RCXFMSSV",20,0)
 N GECSDATA,RCTRANID,RESULT
"RTN","RCXFMSSV",21,0)
 ;  lookup fms document number to see if the monthly sv has been sent
"RTN","RCXFMSSV",22,0)
 ;  example rcdatend=3010531, lookup on 3010500
"RTN","RCXFMSSV",23,0)
 D KEYLOOK^GECSSGET("SV-"_$E(RCDATEND,1,5)_"00",1)
"RTN","RCXFMSSV",24,0)
 ;
"RTN","RCXFMSSV",25,0)
 ;  get the transacion id for the fms document
"RTN","RCXFMSSV",26,0)
 ;  if it is not sent, get the next number available
"RTN","RCXFMSSV",27,0)
 I $G(GECSDATA) S RCTRANID=$E($P(GECSDATA("2100.1",GECSDATA,".01","E"),"-",2),1,11)
"RTN","RCXFMSSV",28,0)
 I $G(RCTRANID)="" S RCTRANID=$$ENUM^RCMSNUM
"RTN","RCXFMSSV",29,0)
 I RCTRANID<0 Q  ;unable to retrieve the next number
"RTN","RCXFMSSV",30,0)
 ;  remove dash (example 460-K1A05HY)
"RTN","RCXFMSSV",31,0)
 S RCTRANID=$TR(RCTRANID,"-")
"RTN","RCXFMSSV",32,0)
 ;
"RTN","RCXFMSSV",33,0)
 ;  build and send the sv document to fms
"RTN","RCXFMSSV",34,0)
 S RESULT=$$BUILDSV(RCDATEND,+$G(GECSDATA),RCTRANID)
"RTN","RCXFMSSV",35,0)
 ;  error in building code sheet
"RTN","RCXFMSSV",36,0)
 I 'RESULT Q
"RTN","RCXFMSSV",37,0)
 ;
"RTN","RCXFMSSV",38,0)
 ;  add/update entry in file 347 for reports
"RTN","RCXFMSSV",39,0)
 N %DT,%X,D,D0,DA347,DI,DQ,DIC,ERROR
"RTN","RCXFMSSV",40,0)
 S DA347=$O(^RC(347,"C",$P(RESULT,"^",2),0))
"RTN","RCXFMSSV",41,0)
 ;  if not in the file, addit   fmsdocid   sv   id
"RTN","RCXFMSSV",42,0)
 I 'DA347 D OPEN^RCFMDRV1($P(RESULT,"^",2),4,"SV-"_$E(RCDATEND,1,5)_"00",.DA347,.ERROR)
"RTN","RCXFMSSV",43,0)
 I DA347 D SSTAT^RCFMFN02($P(RESULT,"^",2),1)
"RTN","RCXFMSSV",44,0)
 Q
"RTN","RCXFMSSV",45,0)
 ;
"RTN","RCXFMSSV",46,0)
 ;
"RTN","RCXFMSSV",47,0)
BUILDSV(RCDATEND,RCGECSDA,RCTRANID) ;  generate a wr code sheet for monthly data
"RTN","RCXFMSSV",48,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMSSV",49,0)
 ;  data stored in tmp($j,rcrjrcolsv)
"RTN","RCXFMSSV",50,0)
 ;
"RTN","RCXFMSSV",51,0)
 N AMOUNT,COUNT,DESCRIP,DOCTOTAL,FISCALYR,FMSLINE,FUND,FY,GECSFMS,MONTH,REVDATE,REVFY,REVMONTH,RSC,SV2,TYPE
"RTN","RCXFMSSV",52,0)
 ;
"RTN","RCXFMSSV",53,0)
 S FISCALYR=$$FY^RCFN01(RCDATEND)
"RTN","RCXFMSSV",54,0)
 ;
"RTN","RCXFMSSV",55,0)
 S COUNT=0,DOCTOTAL=0
"RTN","RCXFMSSV",56,0)
 S TYPE="" F  S TYPE=$O(^TMP($J,"RCRJRCOLSV",TYPE)) Q:TYPE=""  D
"RTN","RCXFMSSV",57,0)
 . S FUND="" F  S FUND=$O(^TMP($J,"RCRJRCOLSV",TYPE,FUND)) Q:FUND=""  D
"RTN","RCXFMSSV",58,0)
 . . S RSC="" F  S RSC=$O(^TMP($J,"RCRJRCOLSV",TYPE,FUND,RSC)) Q:RSC=""  D
"RTN","RCXFMSSV",59,0)
 . . . S AMOUNT=^TMP($J,"RCRJRCOLSV",TYPE,FUND,RSC),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSSV",60,0)
 . . . I AMOUNT=0 Q
"RTN","RCXFMSSV",61,0)
 . . . S COUNT=COUNT+1
"RTN","RCXFMSSV",62,0)
 . . . S FMSLINE(COUNT)="LIN^~SVA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSSV",63,0)
 . . . S $P(FMSLINE(COUNT),"^",4)=TYPE
"RTN","RCXFMSSV",64,0)
 . . . S $P(FMSLINE(COUNT),"^",5)=FISCALYR ;begin fy
"RTN","RCXFMSSV",65,0)
 . . . S $P(FMSLINE(COUNT),"^",7)=FUND
"RTN","RCXFMSSV",66,0)
 . . . S $P(FMSLINE(COUNT),"^",9)=$E(RCTRANID,1,3)  ;site number
"RTN","RCXFMSSV",67,0)
 . . . ;  for transaction types 23,27,2B the RSC is 0, send null
"RTN","RCXFMSSV",68,0)
 . . . S $P(FMSLINE(COUNT),"^",14)=$S(RSC=0:"",1:RSC)
"RTN","RCXFMSSV",69,0)
 . . . ;
"RTN","RCXFMSSV",70,0)
 . . . ;  vendor id
"RTN","RCXFMSSV",71,0)
 . . . S $P(FMSLINE(COUNT),"^",18)="MCCFVALUE"
"RTN","RCXFMSSV",72,0)
 . . . ;  for transaction type P2, send vendorid of PERSONOTH
"RTN","RCXFMSSV",73,0)
 . . . I TYPE="P2" S $P(FMSLINE(COUNT),"^",18)="PERSONOTH"
"RTN","RCXFMSSV",74,0)
 . . . ;  if it is hsif fund 5358.1, send vendorid of HSIFVALUE
"RTN","RCXFMSSV",75,0)
 . . . I FUND=5358.1 S $P(FMSLINE(COUNT),"^",18)="HSIFVALUE"
"RTN","RCXFMSSV",76,0)
 . . . ;  if it is ltc fund 4032 or 528709, send vendorid of EXCFVALUE
"RTN","RCXFMSSV",77,0)
 . . . I FUND=4032!(FUND=528709) D
"RTN","RCXFMSSV",78,0)
 . . . . S $P(FMSLINE(COUNT),"^",18)="EXCFVALUE"
"RTN","RCXFMSSV",79,0)
 . . . . S:FUND=4032 $P(FMSLINE(COUNT),"^",5)="03" ; FY
"RTN","RCXFMSSV",80,0)
 . . . ;
"RTN","RCXFMSSV",81,0)
 . . . S $P(FMSLINE(COUNT),"^",19)="~SVB"
"RTN","RCXFMSSV",82,0)
 . . . S $P(FMSLINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSSV",83,0)
 . . . S $P(FMSLINE(COUNT),"^",21)="I"
"RTN","RCXFMSSV",84,0)
 . . . ;  for transaction types 23,27,2B the RSC is 0, send G
"RTN","RCXFMSSV",85,0)
 . . . S $P(FMSLINE(COUNT),"^",23)=$S(RSC=0:"G",1:"R")
"RTN","RCXFMSSV",86,0)
 . . . S $P(FMSLINE(COUNT),"^",25)=$E(RCDATEND,2,3)
"RTN","RCXFMSSV",87,0)
 . . . S $P(FMSLINE(COUNT),"^",26)=$E(RCDATEND,4,5)
"RTN","RCXFMSSV",88,0)
 . . . S $P(FMSLINE(COUNT),"^",27)=$E(RCDATEND,6,7)
"RTN","RCXFMSSV",89,0)
 . . . S $P(FMSLINE(COUNT),"^",28)="~"
"RTN","RCXFMSSV",90,0)
 ;
"RTN","RCXFMSSV",91,0)
 ;  no code sheets to send
"RTN","RCXFMSSV",92,0)
 I COUNT=0 Q "0^No sv code sheets to send for this month"
"RTN","RCXFMSSV",93,0)
 ;
"RTN","RCXFMSSV",94,0)
 ;  calculate the accounting month and fy
"RTN","RCXFMSSV",95,0)
 S FY=$E(RCDATEND,2,3) I $E(RCDATEND,4,5)>9 S FY=FY+1 I FY=100 S FY="00"
"RTN","RCXFMSSV",96,0)
 I $L(FY)=1 S FY="0"_FY
"RTN","RCXFMSSV",97,0)
 S MONTH=$P("04^05^06^07^08^09^10^11^12^01^02^03","^",$E(RCDATEND,4,5))
"RTN","RCXFMSSV",98,0)
 ;  calculate the reversal month and fy (next month, add 1 day)
"RTN","RCXFMSSV",99,0)
 S REVDATE=$$FMADD^XLFDT(RCDATEND,7)
"RTN","RCXFMSSV",100,0)
 S REVFY=$E(REVDATE,2,3) I $E(REVDATE,4,5)>9 S REVFY=REVFY+1 I REVFY=100 S REVFY="00"
"RTN","RCXFMSSV",101,0)
 I $L(REVFY)=1 S REVFY="0"_REVFY
"RTN","RCXFMSSV",102,0)
 S REVMONTH=$P("04^05^06^07^08^09^10^11^12^01^02^03","^",$E(REVDATE,4,5))
"RTN","RCXFMSSV",103,0)
 ;
"RTN","RCXFMSSV",104,0)
 S SV2="SV2^"_$E(RCDATEND,2,3)_"^"_$E(RCDATEND,4,5)_"^"_$E(RCDATEND,6,7)
"RTN","RCXFMSSV",105,0)
 S $P(SV2,"^",5)=MONTH         ;accounting period month
"RTN","RCXFMSSV",106,0)
 S $P(SV2,"^",6)=FY            ;accounting period year
"RTN","RCXFMSSV",107,0)
 S $P(SV2,"^",7)="E"
"RTN","RCXFMSSV",108,0)
 S $P(SV2,"^",12)=REVFY        ;reversal period year
"RTN","RCXFMSSV",109,0)
 S $P(SV2,"^",13)=REVMONTH     ;reversal period month
"RTN","RCXFMSSV",110,0)
 S $P(SV2,"^",16)=$J(DOCTOTAL,0,2)_"^~"
"RTN","RCXFMSSV",111,0)
 ;
"RTN","RCXFMSSV",112,0)
 ;  put together document in gcs
"RTN","RCXFMSSV",113,0)
 N %DT,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCXFMSSV",114,0)
 S Y=$E(RCDATEND,1,5)_"00" D DD^%DT
"RTN","RCXFMSSV",115,0)
 S DESCRIP="Monthly Standard Voucher for "_Y
"RTN","RCXFMSSV",116,0)
 I 'RCGECSDA D CONTROL^GECSUFMS("A",$E(RCTRANID,1,3),RCTRANID,"SV",10,0,"",DESCRIP)
"RTN","RCXFMSSV",117,0)
 I RCGECSDA D REBUILD^GECSUFM1(RCGECSDA,"A",10,"","Rebuild "_DESCRIP) S GECSFMS("DA")=RCGECSDA
"RTN","RCXFMSSV",118,0)
 ;
"RTN","RCXFMSSV",119,0)
 ;  store document in gcs
"RTN","RCXFMSSV",120,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),SV2)
"RTN","RCXFMSSV",121,0)
 F COUNT=1:1 Q:'$D(FMSLINE(COUNT))  D SETCS^GECSSTAA(GECSFMS("DA"),FMSLINE(COUNT))
"RTN","RCXFMSSV",122,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMSSV",123,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMSSV",124,0)
 ;  set the key for lookup
"RTN","RCXFMSSV",125,0)
 D SETKEY^GECSSTAA(GECSFMS("DA"),"SV-"_$E(RCDATEND,1,5)_"00")
"RTN","RCXFMSSV",126,0)
 ;
"RTN","RCXFMSSV",127,0)
 ;  return 1 for success ^ fms document transaction number
"RTN","RCXFMSSV",128,0)
 Q "1^SV-"_$P(GECSFMS("CTL"),"^",9)
"RTN","RCXFMSSV",129,0)
 ;
"RTN","RCXFMSSV",130,0)
 ;
"RTN","RCXFMSSV",131,0)
BADDEBT ;  top entry point to generate a sv code sheet
"RTN","RCXFMSSV",132,0)
 ;  for the bad debt report, transaction types 23, 27 and 2B.
"RTN","RCXFMSSV",133,0)
 ;  The fms document number in file 347 is SV-$e(dateend,1,5)_"01"
"RTN","RCXFMSSV",134,0)
 ;
"RTN","RCXFMSSV",135,0)
 N DATA1319,DATA1338,DATA1339,DATA4032,DATAHSIF,GECSDATA,RCRJDATE,RESULT,RCRJFMM,RCRJFXSV,RCTRANID,X,RCNOHSIF,LTCFUND
"RTN","RCXFMSSV",136,0)
 ;
"RTN","RCXFMSSV",137,0)
 S RCNOHSIF=$$NOHSIF^RCRJRCO() ; disabled HSIF
"RTN","RCXFMSSV",138,0)
 ;
"RTN","RCXFMSSV",139,0)
 ;  lock cannot fail
"RTN","RCXFMSSV",140,0)
 L +^RC(348.1)
"RTN","RCXFMSSV",141,0)
 ;
"RTN","RCXFMSSV",142,0)
 ;  get the data from the bad debt allowance file 348.1
"RTN","RCXFMSSV",143,0)
 K ^TMP($J,"RCRJRCOLSV")
"RTN","RCXFMSSV",144,0)
 S DATA1319=$G(^RC(348.1,+$O(^RC(348.1,"B",1319,0)),0))
"RTN","RCXFMSSV",145,0)
 S DATA1338=$G(^RC(348.1,+$O(^RC(348.1,"B",1338,0)),0))
"RTN","RCXFMSSV",146,0)
 S DATA1339=$G(^RC(348.1,+$O(^RC(348.1,"B",1339,0)),0))
"RTN","RCXFMSSV",147,0)
 I 'RCNOHSIF S DATAHSIF=$G(^RC(348.1,+$O(^RC(348.1,"B",1319.1,0)),0))
"RTN","RCXFMSSV",148,0)
 S DATA4032=$G(^RC(348.1,+$O(^RC(348.1,"B",1319.2,0)),0))
"RTN","RCXFMSSV",149,0)
 ; the revenue source code here is a 0
"RTN","RCXFMSSV",150,0)
 S ^TMP($J,"RCRJRCOLSV","23",$$ADJFUND^RCRJRCO($S(DT<$$ADDPTEDT^PRCAACC():5287.3,1:528703)),0)=$P(DATA1319,"^",8)+$P(DATA1319,"^",9)
"RTN","RCXFMSSV",151,0)
 I 'RCNOHSIF S ^TMP($J,"RCRJRCOLSV","23",5358.1,0)=$P(DATAHSIF,"^",8)+$P(DATAHSIF,"^",9)
"RTN","RCXFMSSV",152,0)
 ;patch 220 replaces 4032 fund with 528709
"RTN","RCXFMSSV",153,0)
 S LTCFUND=$S(DT'<$$ADDPTEDT^PRCAACC():528709,1:4032)
"RTN","RCXFMSSV",154,0)
 S ^TMP($J,"RCRJRCOLSV","23",LTCFUND,0)=$P(DATA4032,"^",8)+$P(DATA4032,"^",9)
"RTN","RCXFMSSV",155,0)
 S ^TMP($J,"RCRJRCOLSV","2B",$$ADJFUND^RCRJRCO($S(DT<$$ADDPTEDT^PRCAACC():5287.4,1:528704)),0)=$P(DATA1338,"^",8)+$P(DATA1338,"^",9)
"RTN","RCXFMSSV",156,0)
 S ^TMP($J,"RCRJRCOLSV","27",$$ADJFUND^RCRJRCO($S(DT<$$ADDPTEDT^PRCAACC():5287.4,1:528704)),0)=$P(DATA1339,"^",8)+$P(DATA1339,"^",9)
"RTN","RCXFMSSV",157,0)
 ;
"RTN","RCXFMSSV",158,0)
 ;  the date is for previous month
"RTN","RCXFMSSV",159,0)
 ;S RCRJDATE=$$PREVMONT^RCRJRBD(DT)
"RTN","RCXFMSSV",160,0)
 I $E(DT,6,7)<$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$$PREVMONT^RCRJRBD(DT)
"RTN","RCXFMSSV",161,0)
 ;I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$E($$LDATE^RCRJR(DT),1,5)_"00"
"RTN","RCXFMSSV",162,0)
 I $E(DT,6,7)>$E($$LDATE^RCRJR(DT),6,7) S RCRJDATE=$$LDATE^RCRJR(DT)
"RTN","RCXFMSSV",163,0)
 ;  find the last day of the month for the end date
"RTN","RCXFMSSV",164,0)
 ;S RCRJDATE=$E(RCRJDATE,1,5)_$P("31^28^31^30^31^30^31^31^30^31^30^31","^",+$E(RCRJDATE,4,5))
"RTN","RCXFMSSV",165,0)
 ;I $E(RCRJDATE,6,7)=28,$E(RCRJDATE,2,3)#4=0 S RCRJDATE=$E(RCRJDATE,1,5)_"29"
"RTN","RCXFMSSV",166,0)
 ;
"RTN","RCXFMSSV",167,0)
 ;  lookup fms document number to see if the monthly sv has been sent
"RTN","RCXFMSSV",168,0)
 ;  example rcdatend=3010531, lookup on 3010501
"RTN","RCXFMSSV",169,0)
 D KEYLOOK^GECSSGET("SV-"_$E(RCRJDATE,1,5)_"01",1)
"RTN","RCXFMSSV",170,0)
 ;
"RTN","RCXFMSSV",171,0)
 ;  get the transacion id for the fms document
"RTN","RCXFMSSV",172,0)
 ;  if it is not sent, get the next number available
"RTN","RCXFMSSV",173,0)
 I $G(GECSDATA) S RCTRANID=$E($P(GECSDATA("2100.1",GECSDATA,".01","E"),"-",2),1,11)
"RTN","RCXFMSSV",174,0)
 I $G(RCTRANID)="" S RCTRANID=$$ENUM^RCMSNUM
"RTN","RCXFMSSV",175,0)
 I RCTRANID<0 Q  ;unable to retrieve the next number
"RTN","RCXFMSSV",176,0)
 ;  remove dash (example 460-K1A05HY)
"RTN","RCXFMSSV",177,0)
 S RCTRANID=$TR(RCTRANID,"-")
"RTN","RCXFMSSV",178,0)
 ;
"RTN","RCXFMSSV",179,0)
 ;  build and send the sv document to fms
"RTN","RCXFMSSV",180,0)
 S RESULT=$$BUILDSV(RCRJDATE,+$G(GECSDATA),RCTRANID)
"RTN","RCXFMSSV",181,0)
 K ^TMP($J,"RCRJRCOLSV")
"RTN","RCXFMSSV",182,0)
 ;  error in building code sheet
"RTN","RCXFMSSV",183,0)
 I 'RESULT D Q Q
"RTN","RCXFMSSV",184,0)
 ;
"RTN","RCXFMSSV",185,0)
 ;  add/update entry in file 347 for reports
"RTN","RCXFMSSV",186,0)
 N %DT,%X,D,D0,DA347,DI,DQ,DIC,ERROR
"RTN","RCXFMSSV",187,0)
 S DA347=$O(^RC(347,"D","SV-"_$E(RCRJDATE,1,5)_"01",0))
"RTN","RCXFMSSV",188,0)
 ;  if not in the file, addit   fmsdocid   sv   id
"RTN","RCXFMSSV",189,0)
 I 'DA347 D OPEN^RCFMDRV1($P(RESULT,"^",2),4,"SV-"_$E(RCRJDATE,1,5)_"01",.DA347,.ERROR)
"RTN","RCXFMSSV",190,0)
 I DA347 D SSTAT^RCFMFN02($P(RESULT,"^",2),1)
"RTN","RCXFMSSV",191,0)
 ;
"RTN","RCXFMSSV",192,0)
Q ;  jump here to finish
"RTN","RCXFMSSV",193,0)
 ;  generate bad debt report
"RTN","RCXFMSSV",194,0)
 S RCRJFXSV=$P(RESULT,"^",2),RCRJFMM=1 D DQ^RCRJRBDR
"RTN","RCXFMSSV",195,0)
 L -^RC(348.1)
"RTN","RCXFMSSV",196,0)
 Q
"RTN","RCXFMST1")
0^27^B39141139
"RTN","RCXFMST1",1,0)
RCXFMST1 ;ALB/TMK-EDI Lockbox fms transfer (tr) cd sht gen ;31 Mar 03
"RTN","RCXFMST1",2,0)
 ;;4.5;Accounts Receivable;**173,220**;Mar 20, 1995
"RTN","RCXFMST1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMST1",4,0)
 Q
"RTN","RCXFMST1",5,0)
 ;
"RTN","RCXFMST1",6,0)
 ;
"RTN","RCXFMST1",7,0)
GETTR(RCRECTDA,RCGECSDA) ;  extract transfer data for TR code sheet for
"RTN","RCXFMST1",8,0)
 ;  a receipt in rcrectda
"RTN","RCXFMST1",9,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMST1",10,0)
 ;
"RTN","RCXFMST1",11,0)
 N TRANDA,AMOUNT,DETAIL,UNAPPLY,TOTAL,RCTOTAL,FUND,REVSRCE,VENDORID,RCSEQ,RESULT,GECSDATA,RCTRANS,UNAPPNUM,TRANNUMB
"RTN","RCXFMST1",12,0)
 ;
"RTN","RCXFMST1",13,0)
 ;  extract all payments on receipt
"RTN","RCXFMST1",14,0)
 S RESULT=""
"RTN","RCXFMST1",15,0)
 K ^TMP($J,"RCFMSCR")  ;  used for 215 report, not used here
"RTN","RCXFMST1",16,0)
 D FMSLINES^RCXFMSC1(RCRECTDA,1)
"RTN","RCXFMST1",17,0)
 K ^TMP($J,"RCFMSCR")
"RTN","RCXFMST1",18,0)
 ;
"RTN","RCXFMST1",19,0)
 ;  unapplied payments to accounts
"RTN","RCXFMST1",20,0)
 S TRANDA=0 F  S TRANDA=$O(^RCY(344,RCRECTDA,1,TRANDA)) Q:'TRANDA  D
"RTN","RCXFMST1",21,0)
 .   ;  dollars applied in AR
"RTN","RCXFMST1",22,0)
 .   I $P(^RCY(344,RCRECTDA,1,TRANDA,0),U,5) Q
"RTN","RCXFMST1",23,0)
 .   ;  no dollars on transaction
"RTN","RCXFMST1",24,0)
 .   S AMOUNT=$P(^RCY(344,RCRECTDA,1,TRANDA,0),U,4) I 'AMOUNT Q
"RTN","RCXFMST1",25,0)
 .   ;
"RTN","RCXFMST1",26,0)
 .   S UNAPPLY($$GETUNAPP^RCXFMSCR(RCRECTDA,TRANDA,1))=AMOUNT
"RTN","RCXFMST1",27,0)
 ;
"RTN","RCXFMST1",28,0)
 ;  no code sheets to send
"RTN","RCXFMST1",29,0)
 I '$D(DETAIL),'$D(TOTAL),'$D(UNAPPLY) S RESULT="-1^No code sheets to send for this receipt" G QUIT
"RTN","RCXFMST1",30,0)
 ;
"RTN","RCXFMST1",31,0)
 ;  get the next common number in the series = station "-" nextnumber
"RTN","RCXFMST1",32,0)
 ;  use (field 200 in file 344) if document previously sent
"RTN","RCXFMST1",33,0)
 S TRANNUMB=$P($P($G(^RCY(344,RCRECTDA,2)),U),"-",2)
"RTN","RCXFMST1",34,0)
 I TRANNUMB="" S TRANNUMB=$$ENUM^RCMSNUM
"RTN","RCXFMST1",35,0)
 I TRANNUMB<0 S RESULT="0^Unable to lookup next transaction number" G QUIT
"RTN","RCXFMST1",36,0)
 ;  remove the dash (i,e, 460-K1A05HY)
"RTN","RCXFMST1",37,0)
 S TRANNUMB=$TR(TRANNUMB,"-")
"RTN","RCXFMST1",38,0)
 ;
"RTN","RCXFMST1",39,0)
 ;  extract transfer from/to array for applied payments
"RTN","RCXFMST1",40,0)
 S (RCTOTAL,RCSEQ)=0
"RTN","RCXFMST1",41,0)
 S FUND="" F  S FUND=$O(TOTAL(FUND)) Q:FUND=""  D
"RTN","RCXFMST1",42,0)
 .   S REVSRCE="" F  S REVSRCE=$O(TOTAL(FUND,REVSRCE)) Q:REVSRCE=""  D
"RTN","RCXFMST1",43,0)
 .   .   S VENDORID="" F  S VENDORID=$O(TOTAL(FUND,REVSRCE,VENDORID)) Q:VENDORID=""  D
"RTN","RCXFMST1",44,0)
 .   .   .   S RCSEQ=RCSEQ+1,RCTRANS($$TRFUND(),"8NZZ",RCSEQ)=FUND_U_REVSRCE_U_TOTAL(FUND,REVSRCE,VENDORID)_U_U_VENDORID
"RTN","RCXFMST1",45,0)
 ;
"RTN","RCXFMST1",46,0)
 ;  extract unapplied payments
"RTN","RCXFMST1",47,0)
 S UNAPPNUM="" F  S UNAPPNUM=$O(UNAPPLY(UNAPPNUM)) Q:UNAPPNUM=""  D
"RTN","RCXFMST1",48,0)
 .   S RCSEQ=RCSEQ+1,RCTRANS($$TRFUND(),"8NZZ",RCSEQ)=3875_U_U_UNAPPLY(UNAPPNUM)_U_UNAPPNUM
"RTN","RCXFMST1",49,0)
 ;
"RTN","RCXFMST1",50,0)
 ;  build the TR document
"RTN","RCXFMST1",51,0)
 S RESULT=$$BUILDTR(.RCTRANS,.DETAIL,+$G(GECSDATA),TRANNUMB,RCRECTDA)
"RTN","RCXFMST1",52,0)
 ;
"RTN","RCXFMST1",53,0)
QUIT Q RESULT
"RTN","RCXFMST1",54,0)
 ;
"RTN","RCXFMST1",55,0)
BUILDTR(RCTRANS,RCDETAIL,RCGECSDA,TRANNUMB,RCRECTDA) ;  generate a tr code
"RTN","RCXFMST1",56,0)
 ;  sheet for transferring dollars out of 528704/8NZZ
"RTN","RCXFMST1",57,0)
 ;
"RTN","RCXFMST1",58,0)
 ;  rctrans(fund,rsc,seq) = data array passed
"RTN","RCXFMST1",59,0)
 ;    fund=fund to transfer from (always 528704)
"RTN","RCXFMST1",60,0)
 ;    rsc = rsc to transfer from (always 8NZZ)
"RTN","RCXFMST1",61,0)
 ;    seq = sequence to make record unique for each 'transferred to' rsc
"RTN","RCXFMST1",62,0)
 ;    data = fund to transfer to (piece 1)
"RTN","RCXFMST1",63,0)
 ;           rsc  to transfer to (piece 2)
"RTN","RCXFMST1",64,0)
 ;           dollars to transfer (piece 3)
"RTN","RCXFMST1",65,0)
 ;           unapplied deposit # for suspense (fund to transfer to=3875)
"RTN","RCXFMST1",66,0)
 ;           vendor id (piece 5)
"RTN","RCXFMST1",67,0)
 ;
"RTN","RCXFMST1",68,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMST1",69,0)
 ;
"RTN","RCXFMST1",70,0)
 ;  trannumb is the document identifier
"RTN","RCXFMST1",71,0)
 ;
"RTN","RCXFMST1",72,0)
 ;  rcrectda is the ien of the receipt (file 344)
"RTN","RCXFMST1",73,0)
 ;
"RTN","RCXFMST1",74,0)
 ;  rcdetail array contains accrual data for BD transactions
"RTN","RCXFMST1",75,0)
 ;
"RTN","RCXFMST1",76,0)
 N COUNT,DATA,DESCRIP,FISCALYR,FUND,GECSFMS,LINE,REVSRCE,TR2,X,Y,RCSUSP,BILLDA,FMSTYPE,AMOUNT,RCSEQ
"RTN","RCXFMST1",77,0)
 ;
"RTN","RCXFMST1",78,0)
 S FISCALYR=$$FY^RCFN01(DT)
"RTN","RCXFMST1",79,0)
 ;
"RTN","RCXFMST1",80,0)
 ;  build detail lines
"RTN","RCXFMST1",81,0)
 S COUNT=0
"RTN","RCXFMST1",82,0)
 ;
"RTN","RCXFMST1",83,0)
 S FMSTYPE="" F  S FMSTYPE=$O(RCDETAIL(FMSTYPE)) Q:FMSTYPE=""  D
"RTN","RCXFMST1",84,0)
 .   S BILLDA=0 F  S BILLDA=$O(RCDETAIL(FMSTYPE,BILLDA)) Q:'BILLDA  D
"RTN","RCXFMST1",85,0)
 .    .   S AMOUNT=RCDETAIL(FMSTYPE,BILLDA)
"RTN","RCXFMST1",86,0)
 .    . ; Decrease from 528704/8NZZ
"RTN","RCXFMST1",87,0)
 .    .   S COUNT=COUNT+1
"RTN","RCXFMST1",88,0)
 .    .   S LINE(COUNT)=$$DEC(COUNT,FISCALYR,TRANNUMB,AMOUNT)
"RTN","RCXFMST1",89,0)
 .    . ; Send BD
"RTN","RCXFMST1",90,0)
 .    .   S COUNT=COUNT+1
"RTN","RCXFMST1",91,0)
 .    .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMST1",92,0)
 .    .   S $P(LINE(COUNT),U,20)=$J(AMOUNT,0,2)
"RTN","RCXFMST1",93,0)
 .    .   S $P(LINE(COUNT),U,21)="I"
"RTN","RCXFMST1",94,0)
 .    .   S $P(LINE(COUNT),U,23)=$S(FMSTYPE'=75:FMSTYPE,$$GETFUNDB^RCXFMSUF(BILLDA,1)["5287":33,1:75)
"RTN","RCXFMST1",95,0)
 .    .   S $P(LINE(COUNT),U,24)="BD"
"RTN","RCXFMST1",96,0)
 .    .   S $P(LINE(COUNT),U,25)=$TR($P(^PRCA(430,BILLDA,0),U),"-")
"RTN","RCXFMST1",97,0)
 .    .   S $P(LINE(COUNT),U,26)=$$LINE^RCXFMSC1(BILLDA)
"RTN","RCXFMST1",98,0)
 .    .   S $P(LINE(COUNT),U,27)="~"
"RTN","RCXFMST1",99,0)
 .    ;
"RTN","RCXFMST1",100,0)
 ;
"RTN","RCXFMST1",101,0)
 S FUND=$$TRFUND(),REVSRCE="8NZZ"
"RTN","RCXFMST1",102,0)
 S RCSEQ=0 F  S RCSEQ=$O(RCTRANS(FUND,REVSRCE,RCSEQ)) Q:'RCSEQ  D
"RTN","RCXFMST1",103,0)
 .   S DATA=RCTRANS(FUND,REVSRCE,RCSEQ)
"RTN","RCXFMST1",104,0)
 .   ;  if no value, quit
"RTN","RCXFMST1",105,0)
 .   I '$P(DATA,U,3) Q
"RTN","RCXFMST1",106,0)
 .   ;
"RTN","RCXFMST1",107,0)
 .   ;  create line to transfer from (decrease)
"RTN","RCXFMST1",108,0)
 .   S COUNT=COUNT+1
"RTN","RCXFMST1",109,0)
 .   S LINE(COUNT)=$$DEC(COUNT,FISCALYR,TRANNUMB,$P(DATA,U,3))
"RTN","RCXFMST1",110,0)
 .   ;
"RTN","RCXFMST1",111,0)
 .   ;  create line to transfer to (increase)
"RTN","RCXFMST1",112,0)
 .   S COUNT=COUNT+1
"RTN","RCXFMST1",113,0)
 .   S RCSUSP=($P(DATA,U)=3875)
"RTN","RCXFMST1",114,0)
 .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMST1",115,0)
 .   S $P(LINE(COUNT),U,4)=FISCALYR
"RTN","RCXFMST1",116,0)
 .   S $P(LINE(COUNT),U,6)=$P(DATA,U)
"RTN","RCXFMST1",117,0)
 .   S $P(LINE(COUNT),U,7)=$E(TRANNUMB,1,3) ; station #
"RTN","RCXFMST1",118,0)
 .   I 'RCSUSP S $P(LINE(COUNT),U,10)=$P(DATA,U,2)
"RTN","RCXFMST1",119,0)
 .   ;
"RTN","RCXFMST1",120,0)
 .   ;  vendor id
"RTN","RCXFMST1",121,0)
 .   I 'RCSUSP S $P(LINE(COUNT),U,18)=$P(DATA,U,5)
"RTN","RCXFMST1",122,0)
 .   ;
"RTN","RCXFMST1",123,0)
 .   S $P(LINE(COUNT),U,20)=$J($P(DATA,U,3),0,2)
"RTN","RCXFMST1",124,0)
 .   S $P(LINE(COUNT),U,21)="I"
"RTN","RCXFMST1",125,0)
 .   S $P(LINE(COUNT),U,23)=$S('RCSUSP:33,1:24)
"RTN","RCXFMST1",126,0)
 .   S $P(LINE(COUNT),U,24)=$S('RCSUSP:"~",1:"~CRB")
"RTN","RCXFMST1",127,0)
 .   I RCSUSP D
"RTN","RCXFMST1",128,0)
 .   .   S $P(LINE(COUNT),U,32)=$P(DATA,U,4)
"RTN","RCXFMST1",129,0)
 .   .   S $P(LINE(COUNT),U,33)="~"
"RTN","RCXFMST1",130,0)
 ;
"RTN","RCXFMST1",131,0)
 ;  build tr2
"RTN","RCXFMST1",132,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","RCXFMST1",133,0)
 S TR2="CR2^"_$E(FMSDT,2,3)_U_$E(FMSDT,4,5)_U_$E(FMSDT,6,7)_"^^^^^^E^^^"
"RTN","RCXFMST1",134,0)
 ;  deposit number which is equal to the gcs id
"RTN","RCXFMST1",135,0)
 ;  $j(0,0,2) is the document total which is zero
"RTN","RCXFMST1",136,0)
 S TR2=TR2_$P(TRANNUMB,U)_"^^"_$J(0,0,2)_"^^"
"RTN","RCXFMST1",137,0)
 ;  deposit/transfer date
"RTN","RCXFMST1",138,0)
 S TR2=TR2_$E(DT,2,3)_U_$E(DT,4,5)_U_$E(DT,6,7)_"^~"
"RTN","RCXFMST1",139,0)
 ;
"RTN","RCXFMST1",140,0)
 ;  put together document in gcs
"RTN","RCXFMST1",141,0)
 N D0,DA,DI,DIC,DIE,DIQ2,DQ,DR
"RTN","RCXFMST1",142,0)
 S DESCRIP="EDI Lockbox Detail Receipt: "_$P(^RCY(344,RCRECTDA,0),U)
"RTN","RCXFMST1",143,0)
 I 'RCGECSDA D CONTROL^GECSUFMS("A",$E(TRANNUMB,1,3),TRANNUMB,"TR",10,0,"",DESCRIP)
"RTN","RCXFMST1",144,0)
 I RCGECSDA D REBUILD^GECSUFM1(RCGECSDA,"A",10,"N","Rebuild "_DESCRIP) S GECSFMS("DA")=RCGECSDA
"RTN","RCXFMST1",145,0)
 ;
"RTN","RCXFMST1",146,0)
 ;  store document in gcs
"RTN","RCXFMST1",147,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),TR2)
"RTN","RCXFMST1",148,0)
 F COUNT=1:1 Q:'$D(LINE(COUNT))  D SETCS^GECSSTAA(GECSFMS("DA"),LINE(COUNT))
"RTN","RCXFMST1",149,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMST1",150,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMST1",151,0)
 ;
"RTN","RCXFMST1",152,0)
 ;  add/update entry in file 347 for unprocessed document report
"RTN","RCXFMST1",153,0)
 N %DT,%X,D,DA347,D0,DI,DQ,DIC,ERROR,FMSDOCNO,X
"RTN","RCXFMST1",154,0)
 S FMSDOCNO="TR-"_$P(GECSFMS("CTL"),U,9)
"RTN","RCXFMST1",155,0)
 S DA347=$O(^RC(347,"C",FMSDOCNO,0))
"RTN","RCXFMST1",156,0)
 ;  if not in the file, addit   fmsdocid   tr   id
"RTN","RCXFMST1",157,0)
 I 'DA347 D OPEN^RCFMDRV1(FMSDOCNO,9,"TR-"_$P($G(^RCY(344,RCRECTDA,0)),U),.DA347,.ERROR)
"RTN","RCXFMST1",158,0)
 I DA347 D SSTAT^RCFMFN02(FMSDOCNO,1)
"RTN","RCXFMST1",159,0)
 ;
"RTN","RCXFMST1",160,0)
 ;  return 1 for success ^ fms document id
"RTN","RCXFMST1",161,0)
 Q 1_"^TR-"_$P(GECSFMS("CTL"),U,9)
"RTN","RCXFMST1",162,0)
 ;
"RTN","RCXFMST1",163,0)
 ;
"RTN","RCXFMST1",164,0)
DEC(COUNT,FISCALYR,TRANNUMB,AMOUNT) ; Add decrease from 528704/8NZZ
"RTN","RCXFMST1",165,0)
 ; Returns LINE with decrease TR info
"RTN","RCXFMST1",166,0)
 ; FISCALYR/TRANNUMB from above
"RTN","RCXFMST1",167,0)
 ; COUNT = line counter
"RTN","RCXFMST1",168,0)
 ; AMOUNT = amount to be transferred
"RTN","RCXFMST1",169,0)
 ;
"RTN","RCXFMST1",170,0)
 S LINE="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMST1",171,0)
 S $P(LINE,U,4)=FISCALYR
"RTN","RCXFMST1",172,0)
 S $P(LINE,U,6)=$$TRFUND()
"RTN","RCXFMST1",173,0)
 S $P(LINE,U,7)=$E(TRANNUMB,1,3) ; station #
"RTN","RCXFMST1",174,0)
 S $P(LINE,U,10)="8NZZ"
"RTN","RCXFMST1",175,0)
 ;
"RTN","RCXFMST1",176,0)
 ;  vendor id
"RTN","RCXFMST1",177,0)
 S $P(LINE,U,18)="MCCFVALUE"
"RTN","RCXFMST1",178,0)
 S $P(LINE,U,20)=$J(AMOUNT,0,2)
"RTN","RCXFMST1",179,0)
 S $P(LINE,U,21)="D"
"RTN","RCXFMST1",180,0)
 S $P(LINE,U,23)=33
"RTN","RCXFMST1",181,0)
 S $P(LINE,U,24)="~"
"RTN","RCXFMST1",182,0)
 Q LINE
"RTN","RCXFMST1",183,0)
 ;
"RTN","RCXFMST1",184,0)
TRFUND() ; Determine if fund should be 5287 or 528704, based on date
"RTN","RCXFMST1",185,0)
 I DT<3030926 Q 5287
"RTN","RCXFMST1",186,0)
 I DT<$$ADDPTEDT^PRCAACC() Q 5287.4
"RTN","RCXFMST1",187,0)
 Q 528704
"RTN","RCXFMST1",188,0)
 ;
"RTN","RCXFMSUF")
0^9^B31971051
"RTN","RCXFMSUF",1,0)
RCXFMSUF ;WISC/RFJ-calculate fms fund code for a bill ;1 Oct 97
"RTN","RCXFMSUF",2,0)
 ;;4.5;Accounts Receivable;**90,101,135,157,160,165,170,203,207,173,211,192,220**;Mar 20, 1995
"RTN","RCXFMSUF",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSUF",4,0)
 Q
"RTN","RCXFMSUF",5,0)
 ;
"RTN","RCXFMSUF",6,0)
 ;
"RTN","RCXFMSUF",7,0)
GETFUNDO(TYPE) ;  return the fund for other type associated collections
"RTN","RCXFMSUF",8,0)
 ;  type can equal:
"RTN","RCXFMSUF",9,0)
 ;  I for interest         A for admin
"RTN","RCXFMSUF",10,0)
 ;  M for marshall fee     C for court cost
"RTN","RCXFMSUF",11,0)
 I TYPE="I" Q "1435"
"RTN","RCXFMSUF",12,0)
 I TYPE="A" Q "3220"
"RTN","RCXFMSUF",13,0)
 I TYPE="M" Q "0869"
"RTN","RCXFMSUF",14,0)
 I TYPE="C" Q "0869"
"RTN","RCXFMSUF",15,0)
 Q ""
"RTN","RCXFMSUF",16,0)
 ;
"RTN","RCXFMSUF",17,0)
 ;
"RTN","RCXFMSUF",18,0)
GETFUNDB(BILLDA,DONTSTOR,RCEFT) ;  return a bills fms fund code
"RTN","RCXFMSUF",19,0)
 ;  pass DONTSTOR equal 1 to prevent storing the fund code
"RTN","RCXFMSUF",20,0)
 ;  cannot rely on data in the fund field since it may reference the
"RTN","RCXFMSUF",21,0)
 ;  old funds S FUND=$P($G(^PRCA(430,BILLDA,11)),"^",17).  since there
"RTN","RCXFMSUF",22,0)
 ;  are reports which use 11;17, set it for a bill once its computed
"RTN","RCXFMSUF",23,0)
 ;  until all references to the fund are eliminated.
"RTN","RCXFMSUF",24,0)
 ;  rceft = 1 if processing an EFT deposit
"RTN","RCXFMSUF",25,0)
 ;
"RTN","RCXFMSUF",26,0)
 N ACTDATE,CATEGDA,FUND
"RTN","RCXFMSUF",27,0)
 ;
"RTN","RCXFMSUF",28,0)
 ;  calculate a bills fund
"RTN","RCXFMSUF",29,0)
 I $G(RCEFT)=1 S FUND="5287"_$S(DT<3030926:"",DT'<3030926&(DT<$$ADDPTEDT^PRCAACC()):".4",1:"04") Q FUND
"RTN","RCXFMSUF",30,0)
 S CATEGDA=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCXFMSUF",31,0)
 I CATEGDA>44 Q ""
"RTN","RCXFMSUF",32,0)
 ;
"RTN","RCXFMSUF",33,0)
 ;  piece 5 is new fund, remove spaces
"RTN","RCXFMSUF",34,0)
 S FUND=$P($TR($T(@CATEGDA)," "),";",5)
"RTN","RCXFMSUF",35,0)
 ;
"RTN","RCXFMSUF",36,0)
 ;  if category is vendor(17), ex-employee(15), current employee(16)
"RTN","RCXFMSUF",37,0)
 ;  federal agency refund(13), federal agency reimb(14), military(12)
"RTN","RCXFMSUF",38,0)
 ;  set the fund to what is stored in the file.  This was entered
"RTN","RCXFMSUF",39,0)
 ;  by the user during the audit process.  If fund is in the file
"RTN","RCXFMSUF",40,0)
 ;  already, do not need to store it again.
"RTN","RCXFMSUF",41,0)
 ;  if category is nursing home proceeds (40), parking fees (41),
"RTN","RCXFMSUF",42,0)
 ;  cwt proceeds (42), comp & pen proceeds (43), enhanced use lease
"RTN","RCXFMSUF",43,0)
 ;  proceeds (44), set the fund to what is stored in the file.
"RTN","RCXFMSUF",44,0)
 ;  This was generated by the software at the time of bill enter.
"RTN","RCXFMSUF",45,0)
 I CATEGDA=17!(CATEGDA=15)!(CATEGDA=16)!(CATEGDA=13)!(CATEGDA=14)!(CATEGDA=12)!(CATEGDA=40)!(CATEGDA=41)!(CATEGDA=42)!(CATEGDA=43)!(CATEGDA=44) D
"RTN","RCXFMSUF",46,0)
 .   I $P($G(^PRCA(430,BILLDA,11)),"^",17)'="" S FUND=$P(^(11),"^",17),DONTSTOR=1
"RTN","RCXFMSUF",47,0)
 ;
"RTN","RCXFMSUF",48,0)
 ;  public law states that bills in the category ineligible (1),
"RTN","RCXFMSUF",49,0)
 ;  emerg/human (2), torts (10), or medicare (21) which are older 
"RTN","RCXFMSUF",50,0)
 ;  than oct 1, 1992 should be reported under fund 3220.
"RTN","RCXFMSUF",51,0)
 I CATEGDA=1!(CATEGDA=2)!(CATEGDA=10)!(CATEGDA=21) D
"RTN","RCXFMSUF",52,0)
 .   S ACTDATE=$P($G(^PRCA(430,BILLDA,6)),"^",21)
"RTN","RCXFMSUF",53,0)
 .   I ACTDATE,ACTDATE<2921001 S FUND=3220 Q
"RTN","RCXFMSUF",54,0)
 .   ;
"RTN","RCXFMSUF",55,0)
 .   ;  patch157 changes ineligibles.  an ineligible activated before
"RTN","RCXFMSUF",56,0)
 .   ;  oct 1, 1992 or after sep 30, 2000 will be recorded in fund 0160A1.
"RTN","RCXFMSUF",57,0)
 .   ;  otherwise it will be recorded in fund 5287.3 if before 3040928
"RTN","RCXFMSUF",58,0)
 .   ; if 3040928 or after,  fund should be 528703
"RTN","RCXFMSUF",59,0)
 .   I CATEGDA=1,ACTDATE,ACTDATE<3001001 S FUND=$S(DT<$$ADDPTEDT^PRCAACC():"5287.3",1:528703)
"RTN","RCXFMSUF",60,0)
 ;
"RTN","RCXFMSUF",61,0)
 ;  set the fund for the bill
"RTN","RCXFMSUF",62,0)
 I $G(DONTSTOR)'=1 D STORE^RCXFMSUR(BILLDA,"",FUND)
"RTN","RCXFMSUF",63,0)
 ;
"RTN","RCXFMSUF",64,0)
 I FUND>528704,FUND<528709!(FUND=528710) Q FUND
"RTN","RCXFMSUF",65,0)
 I $G(REPRODT),REPRODT<3030926,$E(FUND,1,4)=5287 Q 5287
"RTN","RCXFMSUF",66,0)
 I $G(REPRODT),REPRODT<3031001,$E(FUND,1,4)=5287,$G(REFMS) Q 5287
"RTN","RCXFMSUF",67,0)
 I DT<3030926,$E(FUND,1,4)=5287 Q 5287 ; Effective date
"RTN","RCXFMSUF",68,0)
 I $G(REPRODT),REPRODT<$$ADDPTEDT^PRCAACC(),FUND=528709 Q 4032 ;Effective date-528709
"RTN","RCXFMSUF",69,0)
 I $G(REPRODT),REPRODT<3041001,FUND=528709,$G(REFMS) Q 4032 ;Resubmitted documents not held
"RTN","RCXFMSUF",70,0)
 I $G(DATEEND),$E(DATEEND,2,5)<"0410",FUND=528709 Q 4032
"RTN","RCXFMSUF",71,0)
 I DT<$$ADDPTEDT^PRCAACC(),FUND=528709 Q 4032
"RTN","RCXFMSUF",72,0)
 I $G(REPRODT),REPRODT<$$ADDPTEDT^PRCAACC(),FUND=528701 Q 5287.1 ;Effective date-528701
"RTN","RCXFMSUF",73,0)
 I $G(REPRODT),REPRODT<3041001,FUND=528701,$G(REFMS) Q 5287.1 ;Resubmitted documents not held
"RTN","RCXFMSUF",74,0)
 I $G(DATEEND),$E(DATEEND,2,5)<"0410",FUND=528701 Q 5287.1
"RTN","RCXFMSUF",75,0)
 I DT<$$ADDPTEDT^PRCAACC(),FUND=528701 Q 5287.1
"RTN","RCXFMSUF",76,0)
 I $G(REPRODT),REPRODT<$$ADDPTEDT^PRCAACC(),FUND=528703 Q 5287.3 ;Effective date-528703
"RTN","RCXFMSUF",77,0)
 I $G(REPRODT),REPRODT<3041001,FUND=528703,$G(REFMS) Q 5287.3 ;Resubmitted documents not held
"RTN","RCXFMSUF",78,0)
 I $G(DATEEND),$E(DATEEND,2,5)<"0410",FUND=528703 Q 5287.3
"RTN","RCXFMSUF",79,0)
 I DT<$$ADDPTEDT^PRCAACC(),FUND=528703 Q 5287.3
"RTN","RCXFMSUF",80,0)
 I $G(REPRODT),REPRODT<$$ADDPTEDT^PRCAACC(),FUND=528704 Q 5287.4 ;Effective date-528704
"RTN","RCXFMSUF",81,0)
 I $G(REPRODT),REPRODT<3041001,FUND=528704,$G(REFMS) Q 5287.4 ;Resubmitted documents not held
"RTN","RCXFMSUF",82,0)
 I $G(DATEEND),$E(DATEEND,2,5)<"0410",FUND=528704 Q 5287.4
"RTN","RCXFMSUF",83,0)
 I DT<$$ADDPTEDT^PRCAACC(),FUND=528704 Q 5287.4
"RTN","RCXFMSUF",84,0)
 Q FUND
"RTN","RCXFMSUF",85,0)
 ;
"RTN","RCXFMSUF",86,0)
 ;
"RTN","RCXFMSUF",87,0)
 ;  this is a listing of all categories and associated funds
"RTN","RCXFMSUF",88,0)
 ;  the label is from the internal entry number in the category
"RTN","RCXFMSUF",89,0)
 ;  file 430.2.  piece 3 is a description, piece 4 is the old fund,
"RTN","RCXFMSUF",90,0)
 ;  piece 5 is the new fund
"RTN","RCXFMSUF",91,0)
0 ;;no fund                       ;       ;    
"RTN","RCXFMSUF",92,0)
1 ;;INELIGIBLE HOSP.              ;3220   ;0160A1
"RTN","RCXFMSUF",93,0)
2 ;;EMERGENCY/HUMANITARIAN        ;0160A1 ;528703
"RTN","RCXFMSUF",94,0)
3 ;;NURSING HOME CARE(NSC)        ;2431   ;528703
"RTN","RCXFMSUF",95,0)
4 ;;OUTPATIENT CARE(NSC)          ;2431   ;528703
"RTN","RCXFMSUF",96,0)
5 ;;HOSPITAL CARE (NSC)           ;2431   ;528703
"RTN","RCXFMSUF",97,0)
6 ;;WORKMAN'S COMP.               ;5014   ;528704
"RTN","RCXFMSUF",98,0)
7 ;;NO-FAULT AUTO ACC.            ;5014   ;528704
"RTN","RCXFMSUF",99,0)
8 ;;CRIME OF PER.VIO.             ;5014   ;528704
"RTN","RCXFMSUF",100,0)
9 ;;REIMBURS.HEALTH INS.          ;5014   ;528704
"RTN","RCXFMSUF",101,0)
10 ;;TORT FEASOR                   ;0160A1 ;528704
"RTN","RCXFMSUF",102,0)
11 ;;no entry                      ;       ;
"RTN","RCXFMSUF",103,0)
12 ;;MILITARY                      ;0160A1 ;0160A1
"RTN","RCXFMSUF",104,0)
13 ;;FEDERAL AGENCIES-REFUND       ;0160A1 ;0160A1
"RTN","RCXFMSUF",105,0)
14 ;;FEDERAL AGENCIES-REIMB.       ;0160A1 ;0160A1
"RTN","RCXFMSUF",106,0)
15 ;;EX-EMPLOYEE                   ;0160A1 ;0160A1
"RTN","RCXFMSUF",107,0)
16 ;;CURRENT EMP.                  ;0160A1 ;0160A1
"RTN","RCXFMSUF",108,0)
17 ;;VENDOR                        ;0160A1 ;0160A1
"RTN","RCXFMSUF",109,0)
18 ;;C (MEANS TEST)                ;2431   ;528703
"RTN","RCXFMSUF",110,0)
19 ;;SHARING AGREEMENTS            ;0160A1 ;0160A1
"RTN","RCXFMSUF",111,0)
20 ;;INTERAGENCY                   ;0160A1 ;0160A1
"RTN","RCXFMSUF",112,0)
21 ;;MEDICARE                      ;5014   ;528704
"RTN","RCXFMSUF",113,0)
22 ;;RX CO-PAYMENT/SC VET          ;5014   ;528701
"RTN","RCXFMSUF",114,0)
23 ;;RX CO-PAYMENT/NSC VET         ;5014   ;528701
"RTN","RCXFMSUF",115,0)
24 ;;NURSING HOME CARE PER DIEM    ;2431   ;528703
"RTN","RCXFMSUF",116,0)
25 ;;HOSPITAL CARE PER DIEM        ;2431   ;528703
"RTN","RCXFMSUF",117,0)
26 ;;PREPAYMENT                    ;5014   ;528703
"RTN","RCXFMSUF",118,0)
27 ;;CHAMPVA SUBSISTENCE           ;3220   ;3220
"RTN","RCXFMSUF",119,0)
28 ;;CHAMPVA THIRD PARTY           ;3220   ;3220
"RTN","RCXFMSUF",120,0)
29 ;;CHAMPVA                       ;0160A1 ;0160A1
"RTN","RCXFMSUF",121,0)
30 ;;TRICARE                       ;0160A1 ;0160A1
"RTN","RCXFMSUF",122,0)
31 ;;TRICARE PATIENT               ;0160A1 ;0160A1
"RTN","RCXFMSUF",123,0)
32 ;;TRICARE THIRD PARTY           ;0160A1 ;0160A1
"RTN","RCXFMSUF",124,0)
33 ;;ADULT DAY HEALTH CARE         ;4032   ;528709
"RTN","RCXFMSUF",125,0)
34 ;;DOMICILIARY                   ;4032   ;528709
"RTN","RCXFMSUF",126,0)
35 ;;RESPITE CARE-INSTITUTIONAL    ;4032   ;528709
"RTN","RCXFMSUF",127,0)
36 ;;RESPITE CARE-NON-INSTITUTIONAL;4032   ;528709
"RTN","RCXFMSUF",128,0)
37 ;;GERIATRIC EVAL-INSTITUTIONAL  ;4032   ;528709
"RTN","RCXFMSUF",129,0)
38 ;;GERIATRIC EVAL-NON-INSTITUTION;4032   ;528709
"RTN","RCXFMSUF",130,0)
39 ;;NURSING HOME CARE-LTC         ;4032   ;528709
"RTN","RCXFMSUF",131,0)
40 ;;NURSING HOME PROCEEDS         ;       ;528705
"RTN","RCXFMSUF",132,0)
41 ;;PARKING FEES                  ;       ;528706
"RTN","RCXFMSUF",133,0)
42 ;;CWT PROCEEDS                  ;       ;528707
"RTN","RCXFMSUF",134,0)
43 ;;COMP & PEN PROCEEDS           ;       ;528708
"RTN","RCXFMSUF",135,0)
44 ;;ENHANCED USE LEASE PROCEEDS   ;5358.3 ;528710
"RTN","RCXFMSUR")
0^15^B46524145
"RTN","RCXFMSUR",1,0)
RCXFMSUR ;WISC/RFJ-revenue source codes ;1 Oct 97
"RTN","RCXFMSUR",2,0)
 ;;4.5;Accounts Receivable;**90,101,170,203,173,220**;Mar 20, 1995
"RTN","RCXFMSUR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSUR",4,0)
 Q
"RTN","RCXFMSUR",5,0)
 ;
"RTN","RCXFMSUR",6,0)
 ;
"RTN","RCXFMSUR",7,0)
CALCRSC(BILLDA,RCEFT) ;  calculate the revenue source code for a bill
"RTN","RCXFMSUR",8,0)
 ;  rceft = 1 if processing an EFT deposit
"RTN","RCXFMSUR",9,0)
 ;  returns the 4 column (character) rsc
"RTN","RCXFMSUR",10,0)
 N CATEGDA,COLUMN1,COLUMN2,COLUMN3,COLUMN4,RSC
"RTN","RCXFMSUR",11,0)
 ;  if rsc already calculated, return it
"RTN","RCXFMSUR",12,0)
 I $G(RCEFT)=1 S RSC="8NZZ" Q RSC
"RTN","RCXFMSUR",13,0)
 S RSC=$P($G(^PRCA(430,BILLDA,11)),"^",23)
"RTN","RCXFMSUR",14,0)
 I $L(RSC)=4,RSC'="ARRV" Q RSC
"RTN","RCXFMSUR",15,0)
 ;
"RTN","RCXFMSUR",16,0)
 ;  calculate it and store it
"RTN","RCXFMSUR",17,0)
 S CATEGDA=+$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCXFMSUR",18,0)
 ;
"RTN","RCXFMSUR",19,0)
 ;  if prepayment, send ARRV
"RTN","RCXFMSUR",20,0)
 I CATEGDA=26 D STORE(BILLDA,"ARRV") Q "ARRV"
"RTN","RCXFMSUR",21,0)
 ;
"RTN","RCXFMSUR",22,0)
 S COLUMN1=$$COLUMN1
"RTN","RCXFMSUR",23,0)
 S COLUMN2=$$COLUMN2
"RTN","RCXFMSUR",24,0)
 ;
"RTN","RCXFMSUR",25,0)
 ;  if column2 cannot be determined, return the rsc of ARRV
"RTN","RCXFMSUR",26,0)
 I COLUMN2="" D STORE(BILLDA,"ARRV") Q "ARRV"
"RTN","RCXFMSUR",27,0)
 ;
"RTN","RCXFMSUR",28,0)
 ;  if column2 is not a 5 for reimbursable health insurance,
"RTN","RCXFMSUR",29,0)
 ;  return ZZ in columns 3 and 4
"RTN","RCXFMSUR",30,0)
 I COLUMN2'=5 D STORE(BILLDA,COLUMN1_COLUMN2_"ZZ") Q COLUMN1_COLUMN2_"ZZ"
"RTN","RCXFMSUR",31,0)
 ;
"RTN","RCXFMSUR",32,0)
 ;  for reimbursable health insurance, compute columns 3 and 4
"RTN","RCXFMSUR",33,0)
 S COLUMN3=$$COLUMN3
"RTN","RCXFMSUR",34,0)
 S COLUMN4=$$COLUMN4
"RTN","RCXFMSUR",35,0)
 ;
"RTN","RCXFMSUR",36,0)
 D STORE(BILLDA,COLUMN1_COLUMN2_COLUMN3_COLUMN4)
"RTN","RCXFMSUR",37,0)
 Q COLUMN1_COLUMN2_COLUMN3_COLUMN4
"RTN","RCXFMSUR",38,0)
 ;
"RTN","RCXFMSUR",39,0)
 ;
"RTN","RCXFMSUR",40,0)
STORE(DA,RSC,FUND) ;  store the revenue source code  or fund in the file
"RTN","RCXFMSUR",41,0)
 I $G(^PRCA(430,DA,0))="" Q
"RTN","RCXFMSUR",42,0)
 N D,D0,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCXFMSUR",43,0)
 S DR=""
"RTN","RCXFMSUR",44,0)
 I $G(RSC)'="" S DR="255.1////"_RSC_";"
"RTN","RCXFMSUR",45,0)
 I $G(FUND)'="" S DR=DR_"203////"_FUND_";"
"RTN","RCXFMSUR",46,0)
 S (DIC,DIE)="^PRCA(430,"
"RTN","RCXFMSUR",47,0)
 D ^DIE
"RTN","RCXFMSUR",48,0)
 Q
"RTN","RCXFMSUR",49,0)
 ;
"RTN","RCXFMSUR",50,0)
 ;
"RTN","RCXFMSUR",51,0)
COLUMN1() ;  return column 1 number
"RTN","RCXFMSUR",52,0)
 Q 8
"RTN","RCXFMSUR",53,0)
 ;
"RTN","RCXFMSUR",54,0)
 ;
"RTN","RCXFMSUR",55,0)
COLUMN2() ;  return column 2 number
"RTN","RCXFMSUR",56,0)
 I CATEGDA=5 Q 1     ; hospital care (nsc)
"RTN","RCXFMSUR",57,0)
 I CATEGDA=4 Q 2     ; outpatient care (nsc)
"RTN","RCXFMSUR",58,0)
 I CATEGDA=3 Q 3     ; nursing home care (nsc)
"RTN","RCXFMSUR",59,0)
 I CATEGDA=1 Q 4     ; ineligible hospital
"RTN","RCXFMSUR",60,0)
 I CATEGDA=9 Q 5     ; reimbursable health insurance
"RTN","RCXFMSUR",61,0)
 I CATEGDA=10 Q 6    ; tort fesor
"RTN","RCXFMSUR",62,0)
 I CATEGDA=6 Q 7     ; workmans comp
"RTN","RCXFMSUR",63,0)
 I CATEGDA=18 Q 8    ; c (means test)
"RTN","RCXFMSUR",64,0)
 I CATEGDA=2 Q 9     ; emergency/humanitarian
"RTN","RCXFMSUR",65,0)
 I CATEGDA=7 Q "A"   ; no fault auto accident
"RTN","RCXFMSUR",66,0)
 I CATEGDA=22 Q "B"  ; rx copay/sc vet
"RTN","RCXFMSUR",67,0)
 I CATEGDA=23 Q "C"  ; rx copay/nsc vet
"RTN","RCXFMSUR",68,0)
 I CATEGDA=24 Q "D"  ; nursing home care per diem
"RTN","RCXFMSUR",69,0)
 I CATEGDA=25 Q "E"  ; hospital care per diem
"RTN","RCXFMSUR",70,0)
 I CATEGDA=21 Q "F"  ; medicare
"RTN","RCXFMSUR",71,0)
 I CATEGDA=33 Q "G"  ; adult day health care
"RTN","RCXFMSUR",72,0)
 I CATEGDA=34 Q "H"  ; domiciliary
"RTN","RCXFMSUR",73,0)
 I CATEGDA=35 Q "I"  ; respite care - institutional
"RTN","RCXFMSUR",74,0)
 I CATEGDA=36 Q "J"  ; respite care - non-institutional
"RTN","RCXFMSUR",75,0)
 I CATEGDA=37 Q "K"  ; geriatric evaluation - institutional
"RTN","RCXFMSUR",76,0)
 I CATEGDA=38 Q "L"  ; geriatric evaluation - non-institutional
"RTN","RCXFMSUR",77,0)
 I CATEGDA=39 Q "M"  ; nursing home care - ltc
"RTN","RCXFMSUR",78,0)
 Q ""
"RTN","RCXFMSUR",79,0)
 ;
"RTN","RCXFMSUR",80,0)
 ;
"RTN","RCXFMSUR",81,0)
COLUMN3() ;  return the column 3 number
"RTN","RCXFMSUR",82,0)
 N AGE,DECIMAL,DFN,IBCNDATA,TYPEAGE,TYPECARE,TYPEMEAN,TYPESERV,VA,VADM,VAERR
"RTN","RCXFMSUR",83,0)
 D DIQ399(BILLDA)
"RTN","RCXFMSUR",84,0)
 ;
"RTN","RCXFMSUR",85,0)
 D TYPECARE
"RTN","RCXFMSUR",86,0)
 ;
"RTN","RCXFMSUR",87,0)
 ;  compute service connected at time of care (1 digit binary)
"RTN","RCXFMSUR",88,0)
 ;  type of service connected is set as follows:
"RTN","RCXFMSUR",89,0)
 ;        0 = SC Vet                   1 = NSC Vet
"RTN","RCXFMSUR",90,0)
 S TYPESERV=1
"RTN","RCXFMSUR",91,0)
 ;  service connected at time of care (.18) = yes (1)
"RTN","RCXFMSUR",92,0)
 I $G(IBCNDATA(399,BILLDA,.18,"I"))=1 S TYPESERV=0
"RTN","RCXFMSUR",93,0)
 ;
"RTN","RCXFMSUR",94,0)
 S DFN=$P($G(^PRCA(430,BILLDA,0)),"^",7)
"RTN","RCXFMSUR",95,0)
 D DEM^VADPT
"RTN","RCXFMSUR",96,0)
 ;
"RTN","RCXFMSUR",97,0)
 ;  compute means test at time of care (1 digit binary)
"RTN","RCXFMSUR",98,0)
 ;  type of means test is set as follows:
"RTN","RCXFMSUR",99,0)
 ;        0 = Cat A                    1 = Cat C
"RTN","RCXFMSUR",100,0)
 S TYPEMEAN=0
"RTN","RCXFMSUR",101,0)
 I $$BIL^DGMTUB(DFN,$G(IBCNDATA(399,BILLDA,151,"I")))=1 S TYPEMEAN=1
"RTN","RCXFMSUR",102,0)
 ;
"RTN","RCXFMSUR",103,0)
 ;  compute patient age at time of care (1 digit binary)
"RTN","RCXFMSUR",104,0)
 ;  type of age is set as follows:
"RTN","RCXFMSUR",105,0)
 ;        0 = under 65                 1 = 65 and older
"RTN","RCXFMSUR",106,0)
 S AGE=$$FMDIFF^XLFDT($G(IBCNDATA(399,BILLDA,151,"I")),$P($G(VADM(3)),"^"))\365.25
"RTN","RCXFMSUR",107,0)
 S TYPEAGE=1
"RTN","RCXFMSUR",108,0)
 I AGE<65 S TYPEAGE=0
"RTN","RCXFMSUR",109,0)
 ;
"RTN","RCXFMSUR",110,0)
 ;  convert to decimal  typecare  typeserv  typemean  typeage
"RTN","RCXFMSUR",111,0)
 ;             binary=  1   1         1         1         1
"RTN","RCXFMSUR",112,0)
 ;            decimal= 16 + 8     +   4     +   2     +   1
"RTN","RCXFMSUR",113,0)
 S DECIMAL=$S(TYPECARE="11":24,TYPECARE="10":16,TYPECARE="01":8,1:0)
"RTN","RCXFMSUR",114,0)
 I TYPESERV S DECIMAL=DECIMAL+4
"RTN","RCXFMSUR",115,0)
 I TYPEMEAN S DECIMAL=DECIMAL+2
"RTN","RCXFMSUR",116,0)
 I TYPEAGE S DECIMAL=DECIMAL+1
"RTN","RCXFMSUR",117,0)
 I DECIMAL<10 Q DECIMAL
"RTN","RCXFMSUR",118,0)
 Q $C(65+DECIMAL-10)
"RTN","RCXFMSUR",119,0)
 ;
"RTN","RCXFMSUR",120,0)
 ;
"RTN","RCXFMSUR",121,0)
COLUMN4() ;  return the column 4 number (reserved for future expansion)
"RTN","RCXFMSUR",122,0)
 Q "Z"
"RTN","RCXFMSUR",123,0)
 ;
"RTN","RCXFMSUR",124,0)
 ;
"RTN","RCXFMSUR",125,0)
DIQ399(DA)  ;  get data from file 399
"RTN","RCXFMSUR",126,0)
 N D0,DIC,DIQ,DIQ2,DR
"RTN","RCXFMSUR",127,0)
 K IBCNDATA
"RTN","RCXFMSUR",128,0)
 S DIQ(0)="IE",DIC="^DGCR(399,",DIQ="IBCNDATA",DR=".04;.05;.18;151;" D EN^DIQ1
"RTN","RCXFMSUR",129,0)
 Q
"RTN","RCXFMSUR",130,0)
 ;
"RTN","RCXFMSUR",131,0)
 ;
"RTN","RCXFMSUR",132,0)
TYPECARE ;  compute type of care (2 digit binary)
"RTN","RCXFMSUR",133,0)
 ;  type of care is set as follows:
"RTN","RCXFMSUR",134,0)
 ;      00 = inpatient (hospital)    01 = outpatient
"RTN","RCXFMSUR",135,0)
 ;      10 = nursing home            11 = other
"RTN","RCXFMSUR",136,0)
 ;  default is other if it cannot be computed
"RTN","RCXFMSUR",137,0)
 S TYPECARE="11"
"RTN","RCXFMSUR",138,0)
 ;  bill classification (.05) = outpatient (3) or human.emerg(opt) (4)
"RTN","RCXFMSUR",139,0)
 I $G(IBCNDATA(399,BILLDA,.05,"I"))=3!($G(IBCNDATA(399,BILLDA,.05,"I"))=4) S TYPECARE="01" Q
"RTN","RCXFMSUR",140,0)
 ;  location of care (.04) = hospital inpt or outpt (1)
"RTN","RCXFMSUR",141,0)
 I $G(IBCNDATA(399,BILLDA,.04,"I"))=1 S TYPECARE="00" Q
"RTN","RCXFMSUR",142,0)
 ;  location of care (.04) = skilled nursing (nhcu) (2)
"RTN","RCXFMSUR",143,0)
 I $G(IBCNDATA(399,BILLDA,.04,"I"))=2 S TYPECARE="10"
"RTN","RCXFMSUR",144,0)
 Q
"RTN","RCXFMSUR",145,0)
 ;
"RTN","RCXFMSUR",146,0)
 ;
"RTN","RCXFMSUR",147,0)
ADDEDIT ;  enter/edit revenue source codes for fund 0160A1 bills.  These
"RTN","RCXFMSUR",148,0)
 ;  bills have the rsc entered by the user.  The user can select
"RTN","RCXFMSUR",149,0)
 ;  from rscs in file 347.3
"RTN","RCXFMSUR",150,0)
 W !!,"This option should be used with CAUTION.  This option will allow the"
"RTN","RCXFMSUR",151,0)
 W !,"user owning the PRCASVC supervisor security key, to add or edit the"
"RTN","RCXFMSUR",152,0)
 W !,"Revenue Source Codes selectable for non MCCF bills.  If an invalid"
"RTN","RCXFMSUR",153,0)
 W !,"Revenue Source Code is entered or changed, all code sheets sent to"
"RTN","RCXFMSUR",154,0)
 W !,"FMS referencing the invalid Revenue Source Code will reject.  Be"
"RTN","RCXFMSUR",155,0)
 W !,"cautious when entering new Revenue Source Codes or editing existing"
"RTN","RCXFMSUR",156,0)
 W !,"Revenue Source Codes.  New Revenue Source Codes should only be added"
"RTN","RCXFMSUR",157,0)
 W !,"after they have been added in FMS."
"RTN","RCXFMSUR",158,0)
 ;
"RTN","RCXFMSUR",159,0)
 I '$D(^XUSEC("PRCASVC",DUZ)) W !!,"You are not an owner of the PRCASVC security key." Q
"RTN","RCXFMSUR",160,0)
 ;
"RTN","RCXFMSUR",161,0)
 N %,%Y,C,D,D0,DA,DI,DIC,DIE,DLAYGO,DQ,DR,RCRJFLAG,X,Y
"RTN","RCXFMSUR",162,0)
 ;
"RTN","RCXFMSUR",163,0)
 F  D  Q:$G(RCRJFLAG)
"RTN","RCXFMSUR",164,0)
 .   S (DIC,DIE)="^RC(347.3,",DIC(0)="QEALM",DLAYGO=347.3
"RTN","RCXFMSUR",165,0)
 .   W ! D ^DIC
"RTN","RCXFMSUR",166,0)
 .   I Y<1 S RCRJFLAG=1 Q
"RTN","RCXFMSUR",167,0)
 .   S DIE="^RC(347.3,",DA=+Y,DR=".02;.03;"
"RTN","RCXFMSUR",168,0)
 .   D ^DIE
"RTN","RCXFMSUR",169,0)
 Q
"RTN","RCXFMSUR",170,0)
 ;
"RTN","RCXFMSUR",171,0)
 ;
"RTN","RCXFMSUR",172,0)
SHOW ;  show/calculate revenue source code for a selected bill
"RTN","RCXFMSUR",173,0)
 W !!,"This option will show the calculated Revenue Source Code for a selected"
"RTN","RCXFMSUR",174,0)
 W !,"bill.  The Revenue Source Code is only calculated for accrued bills in"
"RTN","RCXFMSUR",175,0)
 I DT'<$$ADDPTEDT^PRCAACC() W !,"funds 528701,528703,528704,528709/4032"
"RTN","RCXFMSUR",176,0)
 I DT<$$ADDPTEDT^PRCAACC() W !,"funds 5287.1,5287.3,5287.4,4032"
"RTN","RCXFMSUR",177,0)
 ;
"RTN","RCXFMSUR",178,0)
 N %,%Y,BILLDA,C,DIC,FUND,I,RCRJFLAG,RSC,X,Y
"RTN","RCXFMSUR",179,0)
 ;
"RTN","RCXFMSUR",180,0)
 F  D  Q:$G(RCRJFLAG)
"RTN","RCXFMSUR",181,0)
 .   S DIC="^PRCA(430,",DIC(0)="QEAM"
"RTN","RCXFMSUR",182,0)
 .   W ! D ^DIC
"RTN","RCXFMSUR",183,0)
 .   I Y<1 S RCRJFLAG=1 Q
"RTN","RCXFMSUR",184,0)
 .   S BILLDA=+Y
"RTN","RCXFMSUR",185,0)
 .   S FUND=$$GETFUNDB^RCXFMSUF(BILLDA,1)
"RTN","RCXFMSUR",186,0)
 .   W !!,"        Bill Number: ",$P($G(^PRCA(430,BILLDA,0)),"^")
"RTN","RCXFMSUR",187,0)
 .   W !,"               Fund: ",FUND
"RTN","RCXFMSUR",188,0)
 .   I '$$PTACCT^PRCAACC(FUND),FUND'=4032 D  Q
"RTN","RCXFMSUR",189,0)
 .   .   W !,"  The Revenue Source Code cannot be calculated for non-accrued bills."
"RTN","RCXFMSUR",190,0)
 .   .   W !,"  The Revenue Source Code for non-accrued bills are input by the user."
"RTN","RCXFMSUR",191,0)
 .   .   W !,"  The Revenue Source Code is currently entered as: "
"RTN","RCXFMSUR",192,0)
 .   .   S RSC=$P($G(^PRCA(430,BILLDA,11)),"^",6)
"RTN","RCXFMSUR",193,0)
 .   .   W $S(RSC="":"<not entered>",1:RSC)
"RTN","RCXFMSUR",194,0)
 .   ;
"RTN","RCXFMSUR",195,0)
 .   S RSC=$$CALCRSC(BILLDA)
"RTN","RCXFMSUR",196,0)
 .   W !,"Revenue Source Code: ",RSC
"RTN","RCXFMSUR",197,0)
 Q
"RTN","RCXFMSUV")
0^12^B13868854
"RTN","RCXFMSUV",1,0)
RCXFMSUV ;WISC/RFJ-fms vendor id ;9/17/98  11:42 AM
"RTN","RCXFMSUV",2,0)
 ;;4.5;Accounts Receivable;**90,119,98,165,192,220**;Mar 20, 1995
"RTN","RCXFMSUV",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSUV",4,0)
 Q
"RTN","RCXFMSUV",5,0)
 ;
"RTN","RCXFMSUV",6,0)
 ;
"RTN","RCXFMSUV",7,0)
VENDORID(BILLDA) ;  return the vendorid for a bill (used on a BD document)
"RTN","RCXFMSUV",8,0)
 ;  returns null if vendor id is not required
"RTN","RCXFMSUV",9,0)
 ;  returns UNKNOWN if vendor id is required but could not be determined
"RTN","RCXFMSUV",10,0)
 N ACCRUAL,CATEGORY,DEBTOR,RSC,VENDORID,VENDOR,DIR,VENFLAG
"RTN","RCXFMSUV",11,0)
 ;
"RTN","RCXFMSUV",12,0)
 ;  accrued bills get sent to mccf 5287 fund, no vendor id
"RTN","RCXFMSUV",13,0)
 S ACCRUAL=$$ACCK^PRCAACC(BILLDA)
"RTN","RCXFMSUV",14,0)
 I ACCRUAL Q ""
"RTN","RCXFMSUV",15,0)
 ;
"RTN","RCXFMSUV",16,0)
 ;  if not a category, cannot determine vendor id
"RTN","RCXFMSUV",17,0)
 S CATEGORY=$P($G(^PRCA(430,BILLDA,0)),"^",2)
"RTN","RCXFMSUV",18,0)
 I 'CATEGORY Q ""
"RTN","RCXFMSUV",19,0)
 ;
"RTN","RCXFMSUV",20,0)
 ;  if vendor(17) or military(12) or federal agencies refund(13)
"RTN","RCXFMSUV",21,0)
 ;  or federal agencies-reimb(14) or interagency(20)
"RTN","RCXFMSUV",22,0)
 ;  sharing agreements(19),nursing Home Proceeds (40)
"RTN","RCXFMSUV",23,0)
 ;  parking fees (41), cwt proceeds (42), comp & pen proceeds (43)
"RTN","RCXFMSUV",24,0)
 ;  Enhanced Use Lease Proceeds (44), then get vendor id
"RTN","RCXFMSUV",25,0)
 S VENFLAG=$S(CATEGORY=17:2,CATEGORY=12:1,CATEGORY=13:1,CATEGORY=14:1,CATEGORY=20:1,CATEGORY=19:1,CATEGORY=40:2,CATEGORY=41:2,CATEGORY=42:2,CATEGORY=43:2,CATEGORY=44:2,1:0)
"RTN","RCXFMSUV",26,0)
 I VENFLAG D  Q VENDORID
"RTN","RCXFMSUV",27,0)
    .S DEBTOR=+$P($G(^PRCA(430,BILLDA,0)),"^",9),VENDOR=$P($G(^RCD(340,DEBTOR,0)),U)
"RTN","RCXFMSUV",28,0)
    .I VENDOR="" S VENDORID="UNKNOWN" Q
"RTN","RCXFMSUV",29,0)
    .I VENFLAG=2,VENDOR["VA(" S VENDORID="PERSONOTH" D STORE(BILLDA,"PERSONOTH") Q
"RTN","RCXFMSUV",30,0)
    .I VENDOR["PRC(" D  Q
"RTN","RCXFMSUV",31,0)
       ..S VENDORID=$$VEN^PRCHUTL(+VENDOR)
"RTN","RCXFMSUV",32,0)
       ..I VENDORID'="" D STORE(BILLDA,VENDORID) Q
"RTN","RCXFMSUV",33,0)
       ..I VENFLAG=2 D  Q
"RTN","RCXFMSUV",34,0)
         ...S DIR(0)="Y",DIR("A")="Can this bill be offset by FMS "
"RTN","RCXFMSUV",35,0)
         ...S DIR("B")="YES" D ^DIR
"RTN","RCXFMSUV",36,0)
         ...S VENDORID=$S(Y=0:"PERSONOTH",1:"UNKNOWN")
"RTN","RCXFMSUV",37,0)
         ...D:VENDORID="PERSONOTH" STORE(BILLDA,"PERSONOTH")
"RTN","RCXFMSUV",38,0)
         ...Q
"RTN","RCXFMSUV",39,0)
       ..S VENDORID="UNKNOWN"
"RTN","RCXFMSUV",40,0)
       ..Q
"RTN","RCXFMSUV",41,0)
    .S VENDOR=$P(^RCD(340,+DEBTOR,0),U,6)
"RTN","RCXFMSUV",42,0)
    .I VENDOR'="" S VENDORID=$$VEN^PRCHUTL(VENDOR) D  Q
"RTN","RCXFMSUV",43,0)
       ..I VENDORID="" S VENDORID="UNKNOWN" Q
"RTN","RCXFMSUV",44,0)
       ..D STORE(BILLDA,VENDORID)
"RTN","RCXFMSUV",45,0)
       ..Q
"RTN","RCXFMSUV",46,0)
    .I '$D(^XUSEC("PRCA VENDOR",DUZ)) S VENDORID="LINK" Q
"RTN","RCXFMSUV",47,0)
    .W !!,"DEBTOR MUST BE LINKED TO VENDOR FILE"
"RTN","RCXFMSUV",48,0)
    .S VENDOR=$$VENSEL^PRCHUTL()
"RTN","RCXFMSUV",49,0)
    .I VENDOR<0 S VENDORID="LINK" Q
"RTN","RCXFMSUV",50,0)
    .S VENDORID=$$VEN^PRCHUTL(VENDOR)
"RTN","RCXFMSUV",51,0)
    .I VENDORID="" S VENDORID="UNKNOWN" Q
"RTN","RCXFMSUV",52,0)
    .D STORE(BILLDA,VENDORID),STOREL(+DEBTOR,VENDOR)
"RTN","RCXFMSUV",53,0)
    .Q
"RTN","RCXFMSUV",54,0)
 ;
"RTN","RCXFMSUV",55,0)
 ;  for ineligible send INELIG
"RTN","RCXFMSUV",56,0)
 I CATEGORY=1 D STORE(BILLDA,"INELIG") Q "INELIG"
"RTN","RCXFMSUV",57,0)
 ;  for ex-employee send XEMPL
"RTN","RCXFMSUV",58,0)
 I CATEGORY=15 D STORE(BILLDA,"XEMPL") Q "XEMPL"
"RTN","RCXFMSUV",59,0)
 ;  for current employee send CUREMPL
"RTN","RCXFMSUV",60,0)
 I CATEGORY=16 D STORE(BILLDA,"CUREMPL") Q "CUREMPL"
"RTN","RCXFMSUV",61,0)
 ;
"RTN","RCXFMSUV",62,0)
 ;  champva subsitence(27), champva third party(28)
"RTN","RCXFMSUV",63,0)
 I CATEGORY=27 D STORE(BILLDA,"CHMPVA1ST") Q "CHMPVA1ST"
"RTN","RCXFMSUV",64,0)
 I CATEGORY=28 D STORE(BILLDA,"CHMPVA3RD") Q "CHMPVA3RD"
"RTN","RCXFMSUV",65,0)
 ;  champva(29) does not get sent to FMS, code commented out
"RTN","RCXFMSUV",66,0)
 ;I CATEGORY=29 Q ""
"RTN","RCXFMSUV",67,0)
 ;
"RTN","RCXFMSUV",68,0)
 ;  tricare(30), tricare patient(31), tricare third party(32)
"RTN","RCXFMSUV",69,0)
 ;  test for tricare by looking at the revenue source code
"RTN","RCXFMSUV",70,0)
 S RSC=$P($G(^PRCA(430,BILLDA,11)),"^",6)
"RTN","RCXFMSUV",71,0)
 I RSC>8027,RSC<8031 D  D STORE(BILLDA,VENDORID) Q VENDORID
"RTN","RCXFMSUV",72,0)
    .S VENDORID=$S(RSC=8028:"TRIINPAT",RSC=8029:"TRIOUTPAT",1:"TRIOTH")
"RTN","RCXFMSUV",73,0)
    .Q
"RTN","RCXFMSUV",74,0)
 I CATEGORY>29,CATEGORY<33 D  D STORE(BILLDA,VENDORID) Q VENDORID
"RTN","RCXFMSUV",75,0)
    .S VENDORID=$S(CATEGORY=30:"TRICAROTH",CATEGORY=31:"TRICAROPT",1:"TRICARINP")
"RTN","RCXFMSUV",76,0)
    .Q
"RTN","RCXFMSUV",77,0)
 ;  vendor id not known, process should never reach this line of code
"RTN","RCXFMSUV",78,0)
 Q "UNKNOWN"
"RTN","RCXFMSUV",79,0)
 ;
"RTN","RCXFMSUV",80,0)
 ;
"RTN","RCXFMSUV",81,0)
LINKASK ;ENTRY POINT FOR MENU OPTION TO STORE LINK
"RTN","RCXFMSUV",82,0)
 N DIC,Y
"RTN","RCXFMSUV",83,0)
 S DIC=340,DIC(0)="AEQM",DIC("A")="Enter Debtor to be linked to Vendor File: ",DIC("S")="I $P(^RCD(340,+Y,0),U)'[""PRC(""" D ^DIC Q:Y<0  S DEBTOR=+Y
"RTN","RCXFMSUV",84,0)
LINK ;LINKS DEBTOR TO VENDOR FILE
"RTN","RCXFMSUV",85,0)
 S VENDOR=$$VENSEL^PRCHUTL() I VENDOR<0 S VENDOR="LINK" Q
"RTN","RCXFMSUV",86,0)
 D STOREL(DEBTOR,VENDOR) Q
"RTN","RCXFMSUV",87,0)
 ;
"RTN","RCXFMSUV",88,0)
 ;
"RTN","RCXFMSUV",89,0)
STOREL(DA,VENDOR) ;  store the link from the debtor file to the vendor file
"RTN","RCXFMSUV",90,0)
 N D,D0,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCXFMSUV",91,0)
 S DR=".06////"_VENDOR_";"
"RTN","RCXFMSUV",92,0)
 S (DIC,DIE)="^RCD(340,"
"RTN","RCXFMSUV",93,0)
 D ^DIE
"RTN","RCXFMSUV",94,0)
 Q
"RTN","RCXFMSUV",95,0)
 ;
"RTN","RCXFMSUV",96,0)
 ;
"RTN","RCXFMSUV",97,0)
STORE(DA,VENDORID) ;STORES THE VENDOR ID WITH THE BILL
"RTN","RCXFMSUV",98,0)
 I $G(^PRCA(430,DA,0))="" Q
"RTN","RCXFMSUV",99,0)
 N D0,DI,DIC,DIE,DQ,DR,X,Y,D
"RTN","RCXFMSUV",100,0)
 S DR="265////"_VENDORID_";"
"RTN","RCXFMSUV",101,0)
 S (DIC,DIE)="^PRCA(430,"
"RTN","RCXFMSUV",102,0)
 D ^DIE
"RTN","RCXFMSUV",103,0)
 Q
"RTN","RCXFMSWR")
0^19^B16957228
"RTN","RCXFMSWR",1,0)
RCXFMSWR ;WISC/RFJ-fms writeoff (wr) code sheet generator ;1 Nov 97
"RTN","RCXFMSWR",2,0)
 ;;4.5;Accounts Receivable;**96,135,98,156,170,191,220**;Mar 20, 1995
"RTN","RCXFMSWR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSWR",4,0)
 Q
"RTN","RCXFMSWR",5,0)
 ;
"RTN","RCXFMSWR",6,0)
 ;
"RTN","RCXFMSWR",7,0)
STARTWR(RCDATEND) ;  top entry point to generate a wr code sheet
"RTN","RCXFMSWR",8,0)
 ;
"RTN","RCXFMSWR",9,0)
 ;  rcdatend is the ending date of the period.
"RTN","RCXFMSWR",10,0)
 ;  This date is the 3rd work day from the end of the month.
"RTN","RCXFMSWR",11,0)
 ;  The utility $$LDATE^RCRJR is used to figure it out. It will
"RTN","RCXFMSWR",12,0)
 ;  change from month to month and figures in holidays also.
"RTN","RCXFMSWR",13,0)
 ;  For example,  if running the ARDC for the month of June 2003
"RTN","RCXFMSWR",14,0)
 ;  the EOAM will calculate out to be June 25, 2003.
"RTN","RCXFMSWR",15,0)
 ;  This is called by the background monthly data collector
"RTN","RCXFMSWR",16,0)
 ;
"RTN","RCXFMSWR",17,0)
 ;  data stored in tmp($j,rcrjrcolwr,type,revsourcecode)
"RTN","RCXFMSWR",18,0)
 ;  this is called by the background monthly data collector
"RTN","RCXFMSWR",19,0)
 ;
"RTN","RCXFMSWR",20,0)
 N GECSDATA,RCTRANID,RESULT
"RTN","RCXFMSWR",21,0)
 ;  lookup fms document number to see if the monthly sv has been sent
"RTN","RCXFMSWR",22,0)
 ;  example rcdatend=3010531, lookup on 3010500
"RTN","RCXFMSWR",23,0)
 D KEYLOOK^GECSSGET("WR-"_$E(RCDATEND,1,5)_"00",1)
"RTN","RCXFMSWR",24,0)
 ;
"RTN","RCXFMSWR",25,0)
 ;  get the transacion id for the fms document
"RTN","RCXFMSWR",26,0)
 ;  if it is not sent, get the next number available
"RTN","RCXFMSWR",27,0)
 I $G(GECSDATA) S RCTRANID=$E($P(GECSDATA("2100.1",GECSDATA,".01","E"),"-",2),1,11)
"RTN","RCXFMSWR",28,0)
 I $G(RCTRANID)="" S RCTRANID=$$ENUM^RCMSNUM
"RTN","RCXFMSWR",29,0)
 I RCTRANID<0 Q  ;unable to retrieve the next number
"RTN","RCXFMSWR",30,0)
 ;  remove dash (example 460-K1A05HY)
"RTN","RCXFMSWR",31,0)
 S RCTRANID=$TR(RCTRANID,"-")
"RTN","RCXFMSWR",32,0)
 ;
"RTN","RCXFMSWR",33,0)
 ;  build and send the sv document to fms
"RTN","RCXFMSWR",34,0)
 S RESULT=$$BUILDWR(RCDATEND,+$G(GECSDATA),RCTRANID)
"RTN","RCXFMSWR",35,0)
 ;  error in building code sheet
"RTN","RCXFMSWR",36,0)
 I 'RESULT Q
"RTN","RCXFMSWR",37,0)
 ;
"RTN","RCXFMSWR",38,0)
 ;  add/update entry in file 347 for reports
"RTN","RCXFMSWR",39,0)
 N %DT,%X,D,D0,DA347,DI,DQ,DIC,ERROR
"RTN","RCXFMSWR",40,0)
 S DA347=$O(^RC(347,"D","WR-"_$E(RCDATEND,1,5)_"00",0))
"RTN","RCXFMSWR",41,0)
 ;  if not in the file, addit   fmsdocid   wr   id
"RTN","RCXFMSWR",42,0)
 I 'DA347 D OPEN^RCFMDRV1($P(RESULT,"^",2),8,"WR-"_$E(RCDATEND,1,5)_"00",.DA347,.ERROR)
"RTN","RCXFMSWR",43,0)
 I DA347 D SSTAT^RCFMFN02($P(RESULT,"^",2),1)
"RTN","RCXFMSWR",44,0)
 Q
"RTN","RCXFMSWR",45,0)
 ;
"RTN","RCXFMSWR",46,0)
 ;
"RTN","RCXFMSWR",47,0)
BUILDWR(RCDATEND,RCGECSDA,RCTRANID) ;  generate a wr code sheet for monthly data
"RTN","RCXFMSWR",48,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMSWR",49,0)
 ;  data stored in tmp($j,rcrjrcolwr)
"RTN","RCXFMSWR",50,0)
 ;
"RTN","RCXFMSWR",51,0)
 N AMOUNT,COUNT,CR2,DESCRIP,DOCTOTAL,FISCALYR,FMSLINE,FUND,GECSFMS,RSC,TYPE
"RTN","RCXFMSWR",52,0)
 ;
"RTN","RCXFMSWR",53,0)
 S FISCALYR=$$FY^RCFN01(RCDATEND)
"RTN","RCXFMSWR",54,0)
 ;
"RTN","RCXFMSWR",55,0)
 S COUNT=0,DOCTOTAL=0
"RTN","RCXFMSWR",56,0)
 S TYPE="" F  S TYPE=$O(^TMP($J,"RCRJRCOLWR",TYPE)) Q:TYPE=""  D
"RTN","RCXFMSWR",57,0)
 .   S FUND="" F  S FUND=$O(^TMP($J,"RCRJRCOLWR",TYPE,FUND)) Q:FUND=""  D
"RTN","RCXFMSWR",58,0)
 .   .   S RSC="" F  S RSC=$O(^TMP($J,"RCRJRCOLWR",TYPE,FUND,RSC)) Q:RSC=""  D
"RTN","RCXFMSWR",59,0)
 .   .   .   S AMOUNT=^TMP($J,"RCRJRCOLWR",TYPE,FUND,RSC),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSWR",60,0)
 .   .   .   I AMOUNT=0 Q
"RTN","RCXFMSWR",61,0)
 .   .   .   S COUNT=COUNT+1
"RTN","RCXFMSWR",62,0)
 .   .   .   S FMSLINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSWR",63,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",4)=FISCALYR          ;begin fy
"RTN","RCXFMSWR",64,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",6)=FUND
"RTN","RCXFMSWR",65,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",7)=$E(RCTRANID,1,3)  ;site number
"RTN","RCXFMSWR",66,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",10)=RSC
"RTN","RCXFMSWR",67,0)
 .   .   .   ;
"RTN","RCXFMSWR",68,0)
 .   .   .   ;  vendor id
"RTN","RCXFMSWR",69,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",18)="MCCFVALUE"
"RTN","RCXFMSWR",70,0)
 .   .   .   I FUND=4032!(FUND=528709) S $P(FMSLINE(COUNT),"^",18)="EXCFVALUE"
"RTN","RCXFMSWR",71,0)
 .   .   .   ;  for transaction type P4, send vendorid of PERSONOTH
"RTN","RCXFMSWR",72,0)
 .   .   .   I TYPE="P4" S $P(FMSLINE(COUNT),"^",18)="PERSONOTH"
"RTN","RCXFMSWR",73,0)
 .   .   .   ;
"RTN","RCXFMSWR",74,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSWR",75,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",21)="I"
"RTN","RCXFMSWR",76,0)
 .   .   .   S $P(FMSLINE(COUNT),"^",23)=TYPE_"^~"
"RTN","RCXFMSWR",77,0)
 ;
"RTN","RCXFMSWR",78,0)
 ;  no code sheets to send
"RTN","RCXFMSWR",79,0)
 I COUNT=0 Q "0^No wr code sheets to send for this month"
"RTN","RCXFMSWR",80,0)
 ;
"RTN","RCXFMSWR",81,0)
 S CR2="CR2^"_$E(RCDATEND,2,3)_"^"_$E(RCDATEND,4,5)_"^"_$E(RCDATEND,6,7)
"RTN","RCXFMSWR",82,0)
 S $P(CR2,"^",10)="E"
"RTN","RCXFMSWR",83,0)
 S $P(CR2,"^",13)=999999999999
"RTN","RCXFMSWR",84,0)
 S $P(CR2,"^",15)=$J(DOCTOTAL,0,2)
"RTN","RCXFMSWR",85,0)
 S $P(CR2,"^",17)=$E(RCDATEND,2,3)
"RTN","RCXFMSWR",86,0)
 S $P(CR2,"^",18)=$E(RCDATEND,4,5)
"RTN","RCXFMSWR",87,0)
 S $P(CR2,"^",19)=$E(RCDATEND,6,7)_"^~"
"RTN","RCXFMSWR",88,0)
 ;
"RTN","RCXFMSWR",89,0)
 ;  put together document in gcs
"RTN","RCXFMSWR",90,0)
 N %DT,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCXFMSWR",91,0)
 S Y=$E(RCDATEND,1,5)_"00" D DD^%DT
"RTN","RCXFMSWR",92,0)
 S DESCRIP="Monthly Write Off for "_Y
"RTN","RCXFMSWR",93,0)
 I 'RCGECSDA D CONTROL^GECSUFMS("A",$E(RCTRANID,1,3),RCTRANID,"WR",10,0,"",DESCRIP)
"RTN","RCXFMSWR",94,0)
 I RCGECSDA D REBUILD^GECSUFM1(RCGECSDA,"A",10,"N","Rebuild "_DESCRIP) S GECSFMS("DA")=RCGECSDA
"RTN","RCXFMSWR",95,0)
 ;
"RTN","RCXFMSWR",96,0)
 ;  store document in gcs
"RTN","RCXFMSWR",97,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),CR2)
"RTN","RCXFMSWR",98,0)
 F COUNT=1:1 Q:'$D(FMSLINE(COUNT))  D SETCS^GECSSTAA(GECSFMS("DA"),FMSLINE(COUNT))
"RTN","RCXFMSWR",99,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMSWR",100,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMSWR",101,0)
 ;  set the key for lookup
"RTN","RCXFMSWR",102,0)
 D SETKEY^GECSSTAA(GECSFMS("DA"),"WR-"_$E(RCDATEND,1,5)_"00")
"RTN","RCXFMSWR",103,0)
 ;
"RTN","RCXFMSWR",104,0)
 ;  return 1 for success ^ fms document transaction number
"RTN","RCXFMSWR",105,0)
 Q "1^WR-"_$P(GECSFMS("CTL"),"^",9)
"RTN","RCY220PT")
0^28^B9597719
"RTN","RCY220PT",1,0)
RCY220PT ;ALB/ARH/MAF - POST INIT FILES 347.3 & 430.2 - POST INIT ; 5/1/97
"RTN","RCY220PT",2,0)
 ;;4.5;Accounts Receivable;**220**;Mar 20, 1995
"RTN","RCY220PT",3,0)
 ;
"RTN","RCY220PT",4,0)
 D EN,EN1
"RTN","RCY220PT",5,0)
 Q
"RTN","RCY220PT",6,0)
EN ; Add new Revenue Source Codes to file 347.3
"RTN","RCY220PT",7,0)
 D BMES^XPDUTL("Updating file 347.3 REVENUE SOURCE CODE with new codes...")
"RTN","RCY220PT",8,0)
 D MES^XPDUTL("   ")
"RTN","RCY220PT",9,0)
 N DLAYGO,DIC,DIE,DD,DO,DA,DR,X,Y,RCA,RCFL,RCI,RCLN,RCCNT,RCFN,RCINACT S RCCNT=0
"RTN","RCY220PT",10,0)
 ;
"RTN","RCY220PT",11,0)
 F RCI=1:1 S RCLN=$P($T(RSC+RCI),";;",2) Q:RCLN="END"  D
"RTN","RCY220PT",12,0)
 . ;
"RTN","RCY220PT",13,0)
 . I $D(^RC(347.3,"B",$P(RCLN,U,1))) S RCFL=0 D SET Q
"RTN","RCY220PT",14,0)
 . ;
"RTN","RCY220PT",15,0)
 . S RCCNT=RCCNT+1,RCINACT=" "
"RTN","RCY220PT",16,0)
 . S ^RC(347.3,$P(RCLN,U,1),0)=RCLN
"RTN","RCY220PT",17,0)
 . S ^RC(347.3,"B",$P(RCLN,U,1),$P(RCLN,U,1))=""
"RTN","RCY220PT",18,0)
 . S ^RC(347.3,"C",$E($P(RCLN,U,2),1,30),$P(RCLN,U,1))=""
"RTN","RCY220PT",19,0)
 . S RCFL=1 D SET
"RTN","RCY220PT",20,0)
 D BMES^XPDUTL("      *  "_RCCNT_" Revenue Source Codes #347.3 added")
"RTN","RCY220PT",21,0)
 D BSQ
"RTN","RCY220PT",22,0)
 Q
"RTN","RCY220PT",23,0)
EN1 ; Add new categories to the ACCOUNTS RECEIVABLE CATEGORY file 430.2
"RTN","RCY220PT",24,0)
 D BMES^XPDUTL("Updating file 430.2 ACCOUNTS RECEIVABLE CATEGORY with new categories...")
"RTN","RCY220PT",25,0)
 D MES^XPDUTL("   ")
"RTN","RCY220PT",26,0)
 N DLAYGO,DIC,DIE,DD,DO,DA,DR,X,Y,RCA,RCFL,RCI,RCLN,RCCNT,RCFN,RCINACT S RCCNT=0
"RTN","RCY220PT",27,0)
 ;
"RTN","RCY220PT",28,0)
 F RCI=1:1 S RCLN=$P($T(CAT+RCI),";;",2) Q:RCLN="END"  D
"RTN","RCY220PT",29,0)
 . ;
"RTN","RCY220PT",30,0)
 . I $D(^PRCA(430.2,"B",$P(RCLN,U,1))) S RCFL=0 D SET Q
"RTN","RCY220PT",31,0)
 . ;
"RTN","RCY220PT",32,0)
 . K DD,DO S DLAYGO=430.2,DIC="^PRCA(430.2,",DIC(0)="L",X=$P(RCLN,U,1) D FILE^DICN K DIC I Y<1 K X,Y Q
"RTN","RCY220PT",33,0)
 . S RCFN=+Y,RCCNT=RCCNT+1,RCINACT=" "
"RTN","RCY220PT",34,0)
 . ;
"RTN","RCY220PT",35,0)
 . S DR="1////"_$P(RCLN,U,2)_";2////"_$P(RCLN,U,3)_";3////"_$P(RCLN,U,4)_";5////"_$P(RCLN,U,6)_";6////"_$P(RCLN,U,7)_";7////"_$P(RCLN,U,8)_";12////"_$P(RCLN,U,9)_";9////"_$P(RCLN,U,10)_";10////"_$P(RCLN,U,11)
"RTN","RCY220PT",36,0)
 . S DR=DR_";11////"_$P(RCLN,U,12)_";13////"_$P(RCLN,U,13)
"RTN","RCY220PT",37,0)
 . S DIE="^PRCA(430.2,",DA=+RCFN D ^DIE K DIE,DA,DR,X,Y
"RTN","RCY220PT",38,0)
 . S RCFL=1 D SET
"RTN","RCY220PT",39,0)
 . Q
"RTN","RCY220PT",40,0)
 D BMES^XPDUTL("      *  "_RCCNT_" Accounts Receivable Category #430.2 added")
"RTN","RCY220PT",41,0)
 ;
"RTN","RCY220PT",42,0)
BSQ ;
"RTN","RCY220PT",43,0)
 ;S RCA(1)="      *  "_RCCNT_" Revenue Source Codes (#347.3)"
"RTN","RCY220PT",44,0)
 D BMES^XPDUTL(.RCA)
"RTN","RCY220PT",45,0)
 Q
"RTN","RCY220PT",46,0)
 ;
"RTN","RCY220PT",47,0)
 ;
"RTN","RCY220PT",48,0)
SET ; SET RCA() FOR DISPLAY 
"RTN","RCY220PT",49,0)
 S RCA(RCI)="  "_$P(RCLN,U,1)_"    "_$P(RCLN,U,2)_"    "_$S(RCFL=1:"*** Code Added ***",1:"*** Duplicate ***")
"RTN","RCY220PT",50,0)
 Q
"RTN","RCY220PT",51,0)
 ;
"RTN","RCY220PT",52,0)
 ;
"RTN","RCY220PT",53,0)
RSC ; Revenue Source Code (347.3)   CODE^CODE NAME^INACTIVE
"RTN","RCY220PT",54,0)
 ;;1010^Interest Revenue
"RTN","RCY220PT",55,0)
 ;;8038^Economic Act-All Other
"RTN","RCY220PT",56,0)
 ;;8083^Enhanced Use Lease
"RTN","RCY220PT",57,0)
 ;;9041^Spec Donations
"RTN","RCY220PT",58,0)
 ;;9042^Spec Donations
"RTN","RCY220PT",59,0)
 ;;9045^General Donations
"RTN","RCY220PT",60,0)
 ;;9046^General Donations
"RTN","RCY220PT",61,0)
 ;;9057^Rental
"RTN","RCY220PT",62,0)
 ;;END
"RTN","RCY220PT",63,0)
 Q
"RTN","RCY220PT",64,0)
CAT ;New Categories to be entered into file 430.2
"RTN","RCY220PT",65,0)
 ;;NURSING HOME PROCEEDS^NH^0^1228^^O^5^2^0^1^1^1^2
"RTN","RCY220PT",66,0)
 ;;PARKING FEES^PF^0^1228^^O^6^2^0^1^1^1^2
"RTN","RCY220PT",67,0)
 ;;CWT PROCEEDS^CW^0^1228^^O^7^2^0^1^1^1^2
"RTN","RCY220PT",68,0)
 ;;COMP & PEN PROCEEDS^CM^0^1228^^O^8^2^0^1^1^1^2
"RTN","RCY220PT",69,0)
 ;;ENHANCED USE LEASE PROCEEDS^EP^0^1228^^O^10^2^0^1^1^1^2
"RTN","RCY220PT",70,0)
 ;;END
"VER")
8.0^22
"^DD",347.4,347.4,0)
FIELD^^1.01^8
"^DD",347.4,347.4,0,"DDA")
N
"^DD",347.4,347.4,0,"DT")
3040709
"^DD",347.4,347.4,0,"ID",1.01)
W:$D(^(1)) "   ",$P(^(1),U,1)
"^DD",347.4,347.4,0,"IX","ACR",347.4,.03)

"^DD",347.4,347.4,0,"IX","AWR",347.4,.04)

"^DD",347.4,347.4,0,"IX","B",347.4,.01)

"^DD",347.4,347.4,0,"NM","AR/FMS DOCUMENTS")

"^DD",347.4,347.4,0,"VRPK")
PRCA
"^DD",347.4,347.4,.01,0)
TRANS TYPE^RF^^0;1^K:$L(X)>2!($L(X)<2)!'(X?2N) X
"^DD",347.4,347.4,.01,1,0)
^.1
"^DD",347.4,347.4,.01,1,1,0)
347.4^B
"^DD",347.4,347.4,.01,1,1,1)
S ^PRCA(347.4,"B",$E(X,1,30),DA)=""
"^DD",347.4,347.4,.01,1,1,2)
K ^PRCA(347.4,"B",$E(X,1,30),DA)
"^DD",347.4,347.4,.01,3)
Answer must be 2 characters in length.
"^DD",347.4,347.4,.01,21,0)
^^1^1^2941209^
"^DD",347.4,347.4,.01,21,1,0)
This field contains the trans code sent to FMS.
"^DD",347.4,347.4,.01,"DT")
2941209
"^DD",347.4,347.4,.02,0)
DOCUMENT TYPE^S^1:BILLING DOCUMENT (DETAIL);2:CASH RECEIPT (DEATIL);3:CASH RECEIPT (SUMMARY);4:OVER PAYMENT;5:WRITE OFF (DETAIL);6:WRITE OFF (SUMMARY);7:STANDARD VOUCHER (SUMMARY);0:INACTIVE DOCUMENT TYPE;^0;2^Q
"^DD",347.4,347.4,.02,21,0)
^.001^1^1^3040720^^
"^DD",347.4,347.4,.02,21,1,0)
This field is the document type associated with the trans type
"^DD",347.4,347.4,.02,23,0)
^^1^1^3040720^
"^DD",347.4,347.4,.02,23,1,0)
 
"^DD",347.4,347.4,.02,"DT")
3040709
"^DD",347.4,347.4,.03,0)
CR TYPE^F^^0;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>2!($L(X)<2)!'(X?2N) X
"^DD",347.4,347.4,.03,1,0)
^.1
"^DD",347.4,347.4,.03,1,1,0)
347.4^ACR
"^DD",347.4,347.4,.03,1,1,1)
S ^PRCA(347.4,"ACR",$E(X,1,30),DA)=""
"^DD",347.4,347.4,.03,1,1,2)
K ^PRCA(347.4,"ACR",$E(X,1,30),DA)
"^DD",347.4,347.4,.03,1,1,"%D",0)
^^1^1^2950110^
"^DD",347.4,347.4,.03,1,1,"%D",1,0)
This x-ref is used to look-up CR documents
"^DD",347.4,347.4,.03,1,1,"DT")
2950110
"^DD",347.4,347.4,.03,3)
Enter 2 digit CR trans code
"^DD",347.4,347.4,.03,21,0)
^^1^1^2941209^
"^DD",347.4,347.4,.03,21,1,0)
This field determines whic type of CR trans code is sent to FMS.
"^DD",347.4,347.4,.03,"DT")
2950110
"^DD",347.4,347.4,.04,0)
WR TYPE^F^^0;4^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>2!($L(X)<2)!'(X?2N) X
"^DD",347.4,347.4,.04,1,0)
^.1
"^DD",347.4,347.4,.04,1,1,0)
347.4^AWR
"^DD",347.4,347.4,.04,1,1,1)
S ^PRCA(347.4,"AWR",$E(X,1,30),DA)=""
"^DD",347.4,347.4,.04,1,1,2)
K ^PRCA(347.4,"AWR",$E(X,1,30),DA)
"^DD",347.4,347.4,.04,1,1,"%D",0)
^^1^1^2950110^
"^DD",347.4,347.4,.04,1,1,"%D",1,0)
This x-ref used to look up WR documents
"^DD",347.4,347.4,.04,1,1,"DT")
2950110
"^DD",347.4,347.4,.04,3)
Enter 2 digit write off tran type
"^DD",347.4,347.4,.04,21,0)
^^2^2^2941209^
"^DD",347.4,347.4,.04,21,1,0)
This field determines which type of trans code is sent to FMS for a WRITE
"^DD",347.4,347.4,.04,21,2,0)
OFF document.
"^DD",347.4,347.4,.04,"DT")
2950110
"^DD",347.4,347.4,.05,0)
BD TYPE^F^^0;5^K:$L(X)>2!($L(X)<2)!'(X?2N) X
"^DD",347.4,347.4,.05,3)
Answer must be 2 characters in length.
"^DD",347.4,347.4,.05,"DT")
2941209
"^DD",347.4,347.4,.06,0)
TYPE^S^1:EMPLOYEE/EX-EMPLOYEE;2:VENDOR;3:ALL;^0;6^Q
"^DD",347.4,347.4,.06,21,0)
^^2^2^2950412^
"^DD",347.4,347.4,.06,21,1,0)
This field is used as a screen to limit selection of document type based
"^DD",347.4,347.4,.06,21,2,0)
on category of bill.
"^DD",347.4,347.4,.06,"DT")
2950412
"^DD",347.4,347.4,.07,0)
TR TYPE^F^^0;7^K:$L(X)>2!($L(X)<2)!'(X?2N) X
"^DD",347.4,347.4,.07,3)
Answer must be 2 characters in length.
"^DD",347.4,347.4,.07,21,0)
^^1^1^3030911^
"^DD",347.4,347.4,.07,21,1,0)
The 2 digit FMS Code to be sent for TR documents.
"^DD",347.4,347.4,.07,"DT")
3030911
"^DD",347.4,347.4,1.01,0)
DESCRIPTION^F^^1;1^K:$L(X)>30!($L(X)<3) X
"^DD",347.4,347.4,1.01,3)
Answer must be 3-30 characters in length.
"^DD",347.4,347.4,1.01,21,0)
^^1^1^2941209^
"^DD",347.4,347.4,1.01,21,1,0)
This field describes the use of the trans code.
"^DD",347.4,347.4,1.01,"DT")
2941209
"^DD",430,430,2,0)
CATEGORY^R*P430.2'X^PRCA(430.2,^0;2^S DIC("S")="I $P(^(0),U,7)'=33,$P(^(0),U,7)"_$S($D(PRCABT):$P(">14&($P(^(0),U,7)<17):=17:>4&($P(^(0),U,7)<15)",":",PRCABT),1:">4") D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",430,430,2,.1)

"^DD",430,430,2,1,0)
^.1^^0
"^DD",430,430,2,3)
Enter the category for this bill.
"^DD",430,430,2,12)
TYPE OF BILL
"^DD",430,430,2,12.1)
S DIC("S")="I $P(^(0),U,7)'=33,$P(^(0),U,7)"_$S($D(PRCABT):$P(">14&($P(^(0),U,7)<17):=17:>4&($P(^(0),U,7)<15)",":",PRCABT),1:">4")
"^DD",430,430,2,21,0)
^.001^2^2^3040804^^^^
"^DD",430,430,2,21,1,0)
This is the bill's Category - a pointer to the Category File
"^DD",430,430,2,21,2,0)
(Means Test, Vendor, Employee, Tort, etc.).
"^DD",430,430,2,23,0)
^.001^1^1^3040804^^
"^DD",430,430,2,23,1,0)
 
"^DD",430,430,2,"DT")
3040708
"^DIC",347.4,347.4,0)
AR/FMS DOCUMENTS^347.4I
"^DIC",347.4,347.4,0,"GL")
^PRCA(347.4,
"^DIC",347.4,347.4,"%D",0)
^^7^7^2941209^
"^DIC",347.4,347.4,"%D",1,0)
This file contains the Transaction codes sent to FMS and the trans code
"^DIC",347.4,347.4,"%D",2,0)
for related document.  IE.  BD 01 is sent to FMS, any other document that
"^DIC",347.4,347.4,"%D",3,0)
references the BD 01 must contain a related tran code.
"^DIC",347.4,347.4,"%D",4,0)

"^DIC",347.4,347.4,"%D",5,0)
BD 01 requires CR 05 and WR 01.
"^DIC",347.4,347.4,"%D",6,0)

"^DIC",347.4,347.4,"%D",7,0)
Per VHA Directive 10-93-142, this file definition should not be modified.
"^DIC",347.4,"B","AR/FMS DOCUMENTS",347.4)

**END**
**END**
