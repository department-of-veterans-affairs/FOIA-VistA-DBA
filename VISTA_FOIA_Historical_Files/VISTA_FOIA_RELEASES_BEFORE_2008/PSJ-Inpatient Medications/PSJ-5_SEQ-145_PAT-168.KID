Released PSJ*5*168 SEQ #145
Extracted from mail message
**KIDS**:PSJ*5.0*168^

**INSTALL NAME**
PSJ*5.0*168
"BLD",5622,0)
PSJ*5.0*168^INPATIENT MEDICATIONS^0^3051205^y
"BLD",5622,1,0)
^^30^30^3051205^
"BLD",5622,1,1,0)
 1. When a pick list contains one or more orders for which there is 
"BLD",5622,1,2,0)
 an inconsistency between the number of dispense drugs associated with 
"BLD",5622,1,3,0)
 the order and the number of dispense drug index entries associated with 
"BLD",5622,1,4,0)
 the order, a MailMan message is generated incorrectly stating that a 
"BLD",5622,1,5,0)
 problem exists with a DRUG file (#50) entry. A message generated in 
"BLD",5622,1,6,0)
 this way may be identified by the display of numbers separated by
"BLD",5622,1,7,0)
 commas, rather than the name of the drug.
"BLD",5622,1,8,0)
 
"BLD",5622,1,9,0)
 Example:
"BLD",5622,1,10,0)
     The following items from your DRUG file were found to have NO DATA in
"BLD",5622,1,11,0)
     their PRICE PER DISPENSE UNIT field:
"BLD",5622,1,12,0)
          1234567,123,1
"BLD",5622,1,13,0)
 
"BLD",5622,1,14,0)
       Any PICK LIST with any of these items will NOT be completely FILED
"BLD",5622,1,15,0)
     AWAY until the PRICE PER DISPENSE UNIT field has been entered into 
"BLD",5622,1,16,0)
     for these items.
"BLD",5622,1,17,0)
       Even if there is no cost for these items, a zero (0) must be 
"BLD",5622,1,18,0)
     entered into the PRICE PER DISPENSE UNIT field so the package knows
"BLD",5622,1,19,0)
     it is not an error or an omission.  UNTIL THIS IS DONE, NO COST
"BLD",5622,1,20,0)
     REPORT WILL BE ACCURATE, AND ANY PICK LIST WITH THESE ITEMS CANNOT BE
"BLD",5622,1,21,0)
     PURGED.
"BLD",5622,1,22,0)
 
"BLD",5622,1,23,0)
 With this patch, this MailMan message will not be generated due to an
"BLD",5622,1,24,0)
 extraneous or 'orphan' dispense drug index entry associated with an
"BLD",5622,1,25,0)
 order. HD0000000068561. 
"BLD",5622,1,26,0)
 
"BLD",5622,1,27,0)
 2. To assist in preventing problems with dispense drugs of active 
"BLD",5622,1,28,0)
 orders, the ability to delete dispense drugs from a pending renewal will 
"BLD",5622,1,29,0)
 be removed. Functionality will be added to allow dispense drugs to be 
"BLD",5622,1,30,0)
 inactivated for pending renewal orders. HD0000000068561. 
"BLD",5622,4,0)
^9.64PA^53.45^1
"BLD",5622,4,53.45,0)
53.45
"BLD",5622,4,53.45,2,0)
^9.641^53.4502^1
"BLD",5622,4,53.45,2,53.4502,0)
DISPENSE DRUG  (sub-file)
"BLD",5622,4,53.45,2,53.4502,1,0)
^9.6411^.01^1
"BLD",5622,4,53.45,2,53.4502,1,.01,0)
DISPENSE DRUG
"BLD",5622,4,53.45,222)
y^n^p^^^^n^^n
"BLD",5622,4,53.45,224)

"BLD",5622,4,"APDD",53.45,53.4502)

"BLD",5622,4,"APDD",53.45,53.4502,.01)

"BLD",5622,4,"B",53.45,53.45)

"BLD",5622,6)
1^
"BLD",5622,"KRN",0)
^9.67PA^8989.52^19
"BLD",5622,"KRN",.4,0)
.4
"BLD",5622,"KRN",.401,0)
.401
"BLD",5622,"KRN",.402,0)
.402
"BLD",5622,"KRN",.403,0)
.403
"BLD",5622,"KRN",.5,0)
.5
"BLD",5622,"KRN",.84,0)
.84
"BLD",5622,"KRN",3.6,0)
3.6
"BLD",5622,"KRN",3.8,0)
3.8
"BLD",5622,"KRN",9.2,0)
9.2
"BLD",5622,"KRN",9.8,0)
9.8
"BLD",5622,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5622,"KRN",9.8,"NM",1,0)
PSGOE82^^0^B20573084
"BLD",5622,"KRN",9.8,"NM",2,0)
PSGPLF^^0^B21087523
"BLD",5622,"KRN",9.8,"NM","B","PSGOE82",1)

"BLD",5622,"KRN",9.8,"NM","B","PSGPLF",2)

"BLD",5622,"KRN",19,0)
19
"BLD",5622,"KRN",19.1,0)
19.1
"BLD",5622,"KRN",101,0)
101
"BLD",5622,"KRN",409.61,0)
409.61
"BLD",5622,"KRN",771,0)
771
"BLD",5622,"KRN",870,0)
870
"BLD",5622,"KRN",8989.51,0)
8989.51
"BLD",5622,"KRN",8989.52,0)
8989.52
"BLD",5622,"KRN",8994,0)
8994
"BLD",5622,"KRN","B",.4,.4)

"BLD",5622,"KRN","B",.401,.401)

"BLD",5622,"KRN","B",.402,.402)

"BLD",5622,"KRN","B",.403,.403)

"BLD",5622,"KRN","B",.5,.5)

"BLD",5622,"KRN","B",.84,.84)

"BLD",5622,"KRN","B",3.6,3.6)

"BLD",5622,"KRN","B",3.8,3.8)

"BLD",5622,"KRN","B",9.2,9.2)

"BLD",5622,"KRN","B",9.8,9.8)

"BLD",5622,"KRN","B",19,19)

"BLD",5622,"KRN","B",19.1,19.1)

"BLD",5622,"KRN","B",101,101)

"BLD",5622,"KRN","B",409.61,409.61)

"BLD",5622,"KRN","B",771,771)

"BLD",5622,"KRN","B",870,870)

"BLD",5622,"KRN","B",8989.51,8989.51)

"BLD",5622,"KRN","B",8989.52,8989.52)

"BLD",5622,"KRN","B",8994,8994)

"BLD",5622,"QUES",0)
^9.62^^
"BLD",5622,"REQB",0)
^9.611^2^2
"BLD",5622,"REQB",1,0)
PSJ*5.0*127^2
"BLD",5622,"REQB",2,0)
PSJ*5.0*130^2
"BLD",5622,"REQB","B","PSJ*5.0*127",1)

"BLD",5622,"REQB","B","PSJ*5.0*130",2)

"FIA",53.45)
INPATIENT USER PARAMETERS
"FIA",53.45,0)
^PS(53.45,
"FIA",53.45,0,0)
53.45P
"FIA",53.45,0,1)
y^n^p^^^^n^^n
"FIA",53.45,0,10)

"FIA",53.45,0,11)

"FIA",53.45,0,"RLRO")

"FIA",53.45,0,"VR")
5.0^PSJ
"FIA",53.45,53.45)
1
"FIA",53.45,53.45,2)

"FIA",53.45,53.4502)
1
"FIA",53.45,53.4502,.01)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
168^3051205^10000000009
"PKG",197,22,1,"PAH",1,1,0)
^^30^30^3051205
"PKG",197,22,1,"PAH",1,1,1,0)
 1. When a pick list contains one or more orders for which there is 
"PKG",197,22,1,"PAH",1,1,2,0)
 an inconsistency between the number of dispense drugs associated with 
"PKG",197,22,1,"PAH",1,1,3,0)
 the order and the number of dispense drug index entries associated with 
"PKG",197,22,1,"PAH",1,1,4,0)
 the order, a MailMan message is generated incorrectly stating that a 
"PKG",197,22,1,"PAH",1,1,5,0)
 problem exists with a DRUG file (#50) entry. A message generated in 
"PKG",197,22,1,"PAH",1,1,6,0)
 this way may be identified by the display of numbers separated by
"PKG",197,22,1,"PAH",1,1,7,0)
 commas, rather than the name of the drug.
"PKG",197,22,1,"PAH",1,1,8,0)
 
"PKG",197,22,1,"PAH",1,1,9,0)
 Example:
"PKG",197,22,1,"PAH",1,1,10,0)
     The following items from your DRUG file were found to have NO DATA in
"PKG",197,22,1,"PAH",1,1,11,0)
     their PRICE PER DISPENSE UNIT field:
"PKG",197,22,1,"PAH",1,1,12,0)
          1234567,123,1
"PKG",197,22,1,"PAH",1,1,13,0)
 
"PKG",197,22,1,"PAH",1,1,14,0)
       Any PICK LIST with any of these items will NOT be completely FILED
"PKG",197,22,1,"PAH",1,1,15,0)
     AWAY until the PRICE PER DISPENSE UNIT field has been entered into 
"PKG",197,22,1,"PAH",1,1,16,0)
     for these items.
"PKG",197,22,1,"PAH",1,1,17,0)
       Even if there is no cost for these items, a zero (0) must be 
"PKG",197,22,1,"PAH",1,1,18,0)
     entered into the PRICE PER DISPENSE UNIT field so the package knows
"PKG",197,22,1,"PAH",1,1,19,0)
     it is not an error or an omission.  UNTIL THIS IS DONE, NO COST
"PKG",197,22,1,"PAH",1,1,20,0)
     REPORT WILL BE ACCURATE, AND ANY PICK LIST WITH THESE ITEMS CANNOT BE
"PKG",197,22,1,"PAH",1,1,21,0)
     PURGED.
"PKG",197,22,1,"PAH",1,1,22,0)
 
"PKG",197,22,1,"PAH",1,1,23,0)
 With this patch, this MailMan message will not be generated due to an
"PKG",197,22,1,"PAH",1,1,24,0)
 extraneous or 'orphan' dispense drug index entry associated with an
"PKG",197,22,1,"PAH",1,1,25,0)
 order. HD0000000068561. 
"PKG",197,22,1,"PAH",1,1,26,0)
 
"PKG",197,22,1,"PAH",1,1,27,0)
 2. To assist in preventing problems with dispense drugs of active 
"PKG",197,22,1,"PAH",1,1,28,0)
 orders, the ability to delete dispense drugs from a pending renewal will 
"PKG",197,22,1,"PAH",1,1,29,0)
 be removed. Functionality will be added to allow dispense drugs to be 
"PKG",197,22,1,"PAH",1,1,30,0)
 inactivated for pending renewal orders. HD0000000068561. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","PSGOE82")
0^1^B20573084
"RTN","PSGOE82",1,0)
PSGOE82 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;27 Jan 98 / 9:32 AM
"RTN","PSGOE82",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**2,35,50,67,58,81,127,168**;16 DEC 97
"RTN","PSGOE82",3,0)
 ;
"RTN","PSGOE82",4,0)
 ; Reference to ^DD(53.1 is supported by DBIA #2256.
"RTN","PSGOE82",5,0)
 ; Reference to ^VA(200 is supported by DBIA #10060.
"RTN","PSGOE82",6,0)
 ; Reference to ^DIE is supported by DBIA #10018.
"RTN","PSGOE82",7,0)
 ; Reference to ^DIC is supported by DBIA #10006.
"RTN","PSGOE82",8,0)
 ; Reference to ^DICN is supported by DBIA #10009.
"RTN","PSGOE82",9,0)
 ;
"RTN","PSGOE82",10,0)
1 ; provider
"RTN","PSGOE82",11,0)
 S MSG=0,PSGF2=1 S:PSGOEEF(PSGF2) BACK="1^PSGOE82"
"RTN","PSGOE82",12,0)
A1 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE82",13,0)
 . W !?5,"This order has been renewed. Provider may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE82",14,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",15,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(53.1,1) G A1
"RTN","PSGOE82",16,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W:0 "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) G DONE
"RTN","PSGOE82",17,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,1)
"RTN","PSGOE82",18,0)
 I $E(X)="^" D ENFF G:Y>0 @Y G A1
"RTN","PSGOE82",19,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="I $D(^(""PS"")),^(""PS""),$S('$P(^(""PS""),""^"",4):1,1:$P(^(""PS""),""^"",4)>DT)" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOE82",20,0)
 S PSGPR=+Y,PSGPRN=Y(0,0) G DONE
"RTN","PSGOE82",21,0)
 ;
"RTN","PSGOE82",22,0)
5 ; self med
"RTN","PSGOE82",23,0)
 S MSG=0,PSGF2=5 S:PSGOEEF(PSGF2) BACK="5^PSGOE82" K PSGOEEF(6) S:PSGSM PSGOEEF(6)=1
"RTN","PSGOE82",24,0)
A5 W !,"SELF MED: " W $P("NO^YES","^",PSGSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",25,0)
 ;I "01"[X,$L(X)<2 S:PSGSM=""&(X]"") PSGSM=X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",26,0)
 I "01"[X,$L(X)<2 S:X]"" PSGSM=+X W:PSGSM]"" "  (",$P("NO^YES","^",PSGSM+1),")" G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",27,0)
 I X="@" W $C(7),"  (Required)" G A5
"RTN","PSGOE82",28,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A5
"RTN","PSGOE82",29,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",30,0)
 D YN I  S PSGSM=$E(X)="Y" K PSGOEEF(6) G:'PSGSM DONE S PSGOEEF(6)=1 G 6
"RTN","PSGOE82",31,0)
 W $C(7) D ENHLP^PSGOEM(53.1,5) G A5
"RTN","PSGOE82",32,0)
 ;
"RTN","PSGOE82",33,0)
6 ; hospital supplied self med
"RTN","PSGOE82",34,0)
 S MSG=0,PSGF2=6 S:PSGOEEF(PSGF2) BACK="6^PSGOE82"
"RTN","PSGOE82",35,0)
A6 W !,"HOSPITAL SUPPLIED SELF MED: " W:PSGHSM]"" $P("NO^YES","^",PSGHSM+1),"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE82",36,0)
 I "01"[X,$L(X)=1 S:X]"" PSGHSM=+X W "  (",$P("NO^YES","^",PSGHSM+1),")" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",37,0)
 I X="@" W $C(7),"  (Required)" G A6
"RTN","PSGOE82",38,0)
 I X?1"^".E D ENFF G:Y>0 @Y G A6
"RTN","PSGOE82",39,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",40,0)
 D YN I  S PSGHSM=$E(X)="Y" S MSG=0,PSGF2=5 G DONE
"RTN","PSGOE82",41,0)
 W $C(7) D ENHLP^PSGOEM(53.1,6) G A6
"RTN","PSGOE82",42,0)
 ;
"RTN","PSGOE82",43,0)
2 ; dispense drug multiple
"RTN","PSGOE82",44,0)
 S MSG=0,PSGF2=2,BACK="2^PSGOE82" K PSGOEEND
"RTN","PSGOE82",45,0)
 N PSGX,PSGXX F PSGXX=0:0 S PSGX=PSGXX,PSGXX=$O(^PS(53.45,PSJSYSP,2,PSGXX)) Q:'PSGXX
"RTN","PSGOE82",46,0)
 N PSJPNDRN I $G(PSGORD) I $E(PSGORD,$L(PSGORD))="P",$P($G(^PS(53.1,+PSGORD,0)),"^",24)="R" S PSJPNDRN=1 D
"RTN","PSGOE82",47,0)
 .S $P(PSJPNDRN,"^",2)="Dispense drugs for renewal orders cannot be deleted, but can be given an INACTIVE DATE.  "
"RTN","PSGOE82",48,0)
 N DA,DIC,DIE,DR,DIR S DIE="^PS(53.45,",DA=PSJSYSP,DR=2,DR(2,53.4502)=".01;.02"_$S($G(PSJPNDRN):";.03",1:"") D ^DIE
"RTN","PSGOE82",49,0)
 I '$O(^PS(53.45,PSJSYSP,2,0)) W $C(7),!!,"WARNING: This order must have at least one dispense drug before pharmacy can",!?9,"verify it!",! S MSG=1
"RTN","PSGOE82",50,0)
 D DDOC(PSGX)
"RTN","PSGOE82",51,0)
 NEW PSJDOSE
"RTN","PSGOE82",52,0)
 D DOSECHK^PSJDOSE
"RTN","PSGOE82",53,0)
 I +$G(PSJDSFLG) D DSPWARN^PSJDOSE S PSGOEEF(109)=1
"RTN","PSGOE82",54,0)
 G DONE
"RTN","PSGOE82",55,0)
 ;
"RTN","PSGOE82",56,0)
40 ; comments
"RTN","PSGOE82",57,0)
 S MSG=0,PSGF2=40,BACK="40^PSGOE82",DA=PSJSYSP,DR=1,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",58,0)
 ;
"RTN","PSGOE82",59,0)
66 ; provider comments
"RTN","PSGOE82",60,0)
 ;S MSG=0,PSGF2=66,BACK="66^PSGOE82",DA=PSJSYSP,DR=4,DIE="^PS(53.45," D ^DIE W ! G DONE
"RTN","PSGOE82",61,0)
 ;
"RTN","PSGOE82",62,0)
DONE ;
"RTN","PSGOE82",63,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE82",64,0)
 K F,F0,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE82",65,0)
 ;
"RTN","PSGOE82",66,0)
ENFF ; up-arrow to another field
"RTN","PSGOE82",67,0)
 S Y=-1 I '$D(PSGOEEF)!(X?1"^"1.9N) W $C(7),"  ??" Q
"RTN","PSGOE82",68,0)
 S X=$E(X,2,99) I X=+X S Y=$S($D(PSGOEEF(X)):X,1:-1) W "  " W:Y>0 $$CODES2^PSIVUTL(53.1,X) W:Y'>0 $C(7),"??" Q
"RTN","PSGOE82",69,0)
 K DIC S DIC="^DD(53.1,",DIC(0)="QEM",DIC("S")="I $D(PSGOEEF(+Y))" D ^DIC K DIC S Y=+Y S:Y>0 Y=$P($T(@("F"_Y)),";",3) Q
"RTN","PSGOE82",70,0)
 ;
"RTN","PSGOE82",71,0)
DEL ; delete entry
"RTN","PSGOE82",72,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE82",73,0)
 Q
"RTN","PSGOE82",74,0)
 ;
"RTN","PSGOE82",75,0)
YN ; yes/no as a set of codes
"RTN","PSGOE82",76,0)
 I X'?.U F Y=1:1:$L(X) I $E(X,Y)?1L S X=$E(X,1,Y-1)_$C($A(X,Y)-32)_$E(X,Y+1,$L(X))
"RTN","PSGOE82",77,0)
 F Y="NO","YES" I $P(Y,X)="" W $P(Y,X,2) Q
"RTN","PSGOE82",78,0)
 Q
"RTN","PSGOE82",79,0)
DDOC(PSGX) ; Order check on additional dispens drug for allergy and adv. reactions.
"RTN","PSGOE82",80,0)
 N PSGY,PSGND1,PSGND3 S PSGY=0 F  S PSGX=$O(^PS(53.45,PSJSYSP,2,PSGX)) Q:'PSGX  S PSGY=$P($G(^PS(53.45,PSJSYSP,2,PSGX,0)),"^") Q:PSGY=""  D
"RTN","PSGOE82",81,0)
 . N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJDD,PSGORQF,PSJPDRG S PSJDD=PSGY
"RTN","PSGOE82",82,0)
 . S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSGOE82",83,0)
 . D IVSOL^PSGSICHK
"RTN","PSGOE82",84,0)
 . I ($D(PSGORQF)) D
"RTN","PSGOE82",85,0)
 .. K ^PS(53.45,PSJSYSP,2,PSGX),^PS(53.45,PSJSYSP,2,"B",PSGY)
"RTN","PSGOE82",86,0)
 Q
"RTN","PSGOE82",87,0)
 ;
"RTN","PSGOE82",88,0)
F101 ;;101^PSGOE8
"RTN","PSGOE82",89,0)
F109 ;;109^PSGOE8
"RTN","PSGOE82",90,0)
F3 ;;3^PSGOE8
"RTN","PSGOE82",91,0)
F7 ;;7^PSGOE8
"RTN","PSGOE82",92,0)
PSGF26 ;;26^PSGOE8
"RTN","PSGOE82",93,0)
F39 ;;39^PSGOE81
"RTN","PSGOE82",94,0)
F8 ;;8^PSGOE81
"RTN","PSGOE82",95,0)
F10 ;;10^PSGOE81
"RTN","PSGOE82",96,0)
PSGF25 ;;25^PSGOE81
"RTN","PSGOE82",97,0)
F1 ;;1^PSGOE82
"RTN","PSGOE82",98,0)
F5 ;;5^PSGOE82
"RTN","PSGOE82",99,0)
PSGF2 ;;2^PSGOE82
"RTN","PSGPLF")
0^2^B21087523
"RTN","PSGPLF",1,0)
PSGPLF ;BIR/CML3-FILES AWAY PICK LIST DATA (BACKGROUND JOB) ;29 SEP 97 / 12:40 PM
"RTN","PSGPLF",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**84,130,168**;16 DEC 97
"RTN","PSGPLF",3,0)
 ;
"RTN","PSGPLF",4,0)
 ; Reference to ^PS(55 is supported by DBIA# 2191.
"RTN","PSGPLF",5,0)
 ; Reference to ^PSDRUG is supported by DBIA# 2192.
"RTN","PSGPLF",6,0)
 ; Reference to ^ECXUD1 is supported by DBIA# 172.
"RTN","PSGPLF",7,0)
 ; Reference to ^DIC(42 is supported by DBIA# 1377.
"RTN","PSGPLF",8,0)
 ; Reference to ^DIC(42 is supported by DBIA# 10039.
"RTN","PSGPLF",9,0)
 ;
"RTN","PSGPLF",10,0)
FILE ; add data to cost file and order
"RTN","PSGPLF",11,0)
 S PSGX=$P(PLR,"^",2),PSGY=$P(PLR,"^",3) S:PSGX?7N1"DI" PSGX=0 S PSGX=+PSGX S:PSGY="" $P(PLR,"^",3)=PSGX,PSGY=PSGX
"RTN","PSGPLF",12,0)
 S COST="",(D3,DO)=$P(PLR,"^") I $G(D3) Q:'$D(^PS(55,PN,5,O,1,D3,0))
"RTN","PSGPLF",13,0)
 I D3=+D3 S D3=$P($G(^PS(55,PN,5,O,1,D3,0)),"^") I D3=+D3 S COST=$P($G(^PSDRUG(D3,660)),"^",6)
"RTN","PSGPLF",14,0)
 E  S D3="999Z"
"RTN","PSGPLF",15,0)
 I COST="" S PSGPLFF=0 S:D3="999Z" D3=PN_","_O_","_DO S:'$D(^TMP("PSGNCF",$J,"B",D3)) ^(D3)="" Q
"RTN","PSGPLF",16,0)
 S PS=PSGY<0*2 S:PS PSGY=-PSGY S COST=COST*PSGY G:'PSGY&'COST OS
"RTN","PSGPLF",17,0)
 F  L +^PS(57.6,D0,1,D1,1,D2,1,D3,0):1 I  Q
"RTN","PSGPLF",18,0)
 I $D(^PS(57.6,D0,1,D1,1,D2,1,D3,0)) S ND=^(0),PSGZ=1
"RTN","PSGPLF",19,0)
 E  S ND=D3,PSGZ=0
"RTN","PSGPLF",20,0)
 S $P(ND,"^",2+PS)=$P(ND,"^",2+PS)+PSGY,$P(ND,"^",3+PS)=$P(ND,"^",3+PS)+COST,^PS(57.6,D0,1,D1,1,D2,1,D3,0)=ND L -^PS(57.6,D0,1,D1,1,D2,1,D3,0)
"RTN","PSGPLF",21,0)
 G:PSGZ OS
"RTN","PSGPLF",22,0)
 F  L +^PS(57.6,D0,1,D1,1,D2,1,0):1 I  S ND=$G(^PS(57.6,D0,1,D1,1,D2,1,0)) S:ND="" ND="^57.63P^" S $P(ND,"^",3)=D3,$P(ND,"^",4)=$P(ND,"^",4)+1 S ^(0)=ND L -^PS(57.6,D0,1,D1,1,D2,1,0) Q
"RTN","PSGPLF",23,0)
 I '$D(^PS(57.6,D0,1,D1,1,D2,0)) F  L +^PS(57.6,D0,1,D1,1,0):1 I  S ND=$G(^PS(57.6,D0,1,D1,1,0)) S:ND="" ND="^57.62P" S $P(ND,"^",3)=D2,$P(ND,"^",4)=$P(ND,"^",4)+1 S ^(0)=ND L -^PS(57.6,D0,1,D1,1,0) Q
"RTN","PSGPLF",24,0)
 ;
"RTN","PSGPLF",25,0)
OS ;
"RTN","PSGPLF",26,0)
 I PSGX!PSGY F  L +^PS(55,PN,5,O,1,DO,0):1 I  S PSGZ=$G(^PS(55,PN,5,O,1,DO,0)),$P(PSGZ,"^",5)=$P(PSGZ,"^",5)+PSGX,$P(PSGZ,"^",PS>0+6)=$P(PSGZ,"^",PS>0+6)+PSGY,^(0)=PSGZ L -^PS(55,PN,5,O,1,DO,0) Q
"RTN","PSGPLF",27,0)
 N PSGSTRT S PSGSTRT=$P($G(^PS(55,PN,5,O,2)),"^",2)
"RTN","PSGPLF",28,0)
 I PSGY,D0=+D0,D1=+D1,D2=+D2,D3=+D3 S:PS PSGY=-PSGY,COST=-COST D ENPLF^PSGAMSA(PN,O,D3,PSGY,COST,1,D1,D2,D0) S X="ECXUD1" X ^%ZOSF("TEST") I  S ECUD=PN_"^"_D0_"^"_D3_"^"_PSGY_"^"_D1_"^"_D2_";200^"_COST_"^"_PSGSTRT_"^"_$G(O) D ^ECXUD1
"RTN","PSGPLF",29,0)
 S $P(PLR,"^",4)=1,^PS(53.5,G,1,PN,1,$P(PD,"^",2),1,$P(DD,"^",2),0)=PLR
"RTN","PSGPLF",30,0)
 Q
"RTN","PSGPLF",31,0)
 ;
"RTN","PSGPLF",32,0)
GD1 ; get next (second) level (ward) in 57.6
"RTN","PSGPLF",33,0)
 S WH=WD,D1=$O(^DIC(42,"B",WD,0)) S:'D1 D1="999Z" Q:$D(^PS(57.6,D0,1,D1))
"RTN","PSGPLF",34,0)
 F  L +^PS(57.6,D0,1,0):1 I  S ND=$G(^PS(57.6,D0,1,0)) S:ND="" ND="^57.61PA" S $P(ND,"^",3)=D1 S:'$D(^(D1)) $P(ND,"^",4)=$P(ND,"^",4)+1 S ^(0)=ND,^(D1,0)=D1 L -^PS(57.6,D0,1,0) Q
"RTN","PSGPLF",35,0)
 Q
"RTN","PSGPLF",36,0)
 ;
"RTN","PSGPLF",37,0)
EN ; action starts here
"RTN","PSGPLF",38,0)
 N G,T,W,R,P,S,PD,DD,DDRG D NOW^%DTC S PSGDT=%,G=0 K C,^TMP("PSGNCF",$J)
"RTN","PSGPLF",39,0)
 F  S G=$O(^PS(53.5,"AF",G)) Q:'G  S PSGPLTND=$G(^PS(53.5,G,0)) K:PSGPLTND="" ^PS(53.5,"AF",G) I PSGPLTND]"" I $$LOCK^PSGPLUTL(G,"PSGPL") D  D UNLOCK^PSGPLUTL(G,"PSGPL")
"RTN","PSGPLF",40,0)
 .S WSF=$P(PSGPLTND,"^",7),D0=$S($P(PSGPLTND,"^",3):$P($P(PSGPLTND,"^",3),"."),1:DT)
"RTN","PSGPLF",41,0)
 .I '$D(^PS(57.6,D0)) F  L +^PS(57.6,0):1 I  S ND=$G(^(0)) S:ND="" ND="UNIT DOSE PICK LIST STATS^57.6D" S $P(ND,"^",3)=D0,$P(ND,"^",4)=$P(ND,"^",4)+1,^(0)=ND,^(D0,0)=D0 L -^PS(57.6,0) Q
"RTN","PSGPLF",42,0)
 .S T="",PSGPLFF=1
"RTN","PSGPLF",43,0)
 .F  S T=$O(^PS(53.5,"AC",G,T)) Q:T=""  S (WH,W)="" F  S (W,WD)=$O(^PS(53.5,"AC",G,T,W)) Q:W=""  S R="" D:'WSF GD1 F  S R=$O(^PS(53.5,"AC",G,T,W,R)) Q:R=""  S P="" F  S P=$O(^PS(53.5,"AC",G,T,W,R,P)) Q:P=""  D
"RTN","PSGPLF",44,0)
 ..S PN=$P(P,"^",2),(DD,PD)="",S="A" S:WSF WD=$P(^PS(53.5,G,1,PN,0),"^",3) D:WD'=WH&WSF GD1
"RTN","PSGPLF",45,0)
 ..F  S S=$O(^PS(53.5,"AC",G,T,W,R,P,S)) Q:("Z"[S)!(S="NO ORDERS")  F  S PD=$O(^PS(53.5,"AC",G,T,W,R,P,S,PD)) Q:PD=""  S O=+$P($G(^PS(53.5,G,1,PN,1,$P(PD,"^",2),0)),"^"),D2=$P($G(^PS(55,PN,5,O,0)),"^",2) S:'D2 D2="999Z" D
"RTN","PSGPLF",46,0)
 ...F  S DD=$O(^PS(53.5,"AC",G,T,W,R,P,S,PD,DD)) Q:(DD="")!(DD="NO DISPENSE DRUG")  S PLR=$G(^PS(53.5,G,1,PN,1,$P(PD,"^",2),1,$P(DD,"^",2),0)) Q:PLR=""  D:'$P(PLR,"^",4) FILE
"RTN","PSGPLF",47,0)
 .I PSGPLFF S $P(^PS(53.5,G,0),"^",5)=2,^PS(53.5,"AO",+$P(PSGPLTND,"^",2),$P(PSGPLTND,"^",3),G)="" K ^PS(53.5,"AF",G)
"RTN","PSGPLF",48,0)
 ;
"RTN","PSGPLF",49,0)
 I $D(^TMP("PSGNCF",$J,"B")) D ^PSGPLFM
"RTN","PSGPLF",50,0)
 ;
"RTN","PSGPLF",51,0)
DONE ;
"RTN","PSGPLF",52,0)
 K %,AM,C,COST,D0,D1,D2,D3,DO,ECUD,ND,O,PIN,PLR,PN,PS,PSGPLFF,PSGPLTND,Q,WD,WH,WSF,PSGX,PSGY,PSGZ Q
"UP",53.45,53.4502,-1)
53.45^2
"UP",53.45,53.4502,0)
53.4502
"VER")
8.0^22.0
"^DD",53.45,53.45,2,0)
DISPENSE DRUG^53.4502P^^2;0
"^DD",53.45,53.45,2,20,0)
^.3LA^1^1
"^DD",53.45,53.45,2,20,1,0)
PSJ
"^DD",53.45,53.45,2,21,0)
^.001^2^2^3051201^^^^
"^DD",53.45,53.45,2,21,1,0)
  This is the medication(s) that will actually be dispensed by the pharmacy
"^DD",53.45,53.45,2,21,2,0)
for the Unit Dose order.
"^DD",53.45,53.45,2,23,0)
^.001^2^2^3051201^^^^
"^DD",53.45,53.45,2,23,1,0)
  Used by the Inpatient Medications package as temporary storage when
"^DD",53.45,53.45,2,23,2,0)
processing orders.  This should not be directly accessed by the user.
"^DD",53.45,53.45,2,"DT")
2971209
"^DD",53.45,53.4502,0)
DISPENSE DRUG SUB-FIELD^^.03^3
"^DD",53.45,53.4502,0,"NM","DISPENSE DRUG")

"^DD",53.45,53.4502,.01,0)
DISPENSE DRUG^M*P50'X^PSDRUG(^0;1^S DIC("S")="I $P($G(^(2)),U,3)[""U"",$S('$G(PSGPDRG):1,1:PSGPDRG=+$G(^(2))) I (($G(^PSDRUG(+$G(Y),""I""))>(DT-1))!'$G(^PSDRUG(+$G(Y),""I"")))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",53.45,53.4502,.01,1,0)
^.1
"^DD",53.45,53.4502,.01,1,1,0)
53.4502^B
"^DD",53.45,53.4502,.01,1,1,1)
S ^PS(53.45,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",53.45,53.4502,.01,1,1,2)
K ^PS(53.45,DA(1),2,"B",$E(X,1,30),DA)
"^DD",53.45,53.4502,.01,4)
I $G(PSGPDRG) S X(1)=$G(PSGPDRGN) S:X(1)="" X(1)=PSGPDRG S X(1)="Only dispense drugs tied to the Orderable Item "_X(1)_" are selectable." D EN^DDIOL(" ") F X(2)=1:1:$L(X(1)," ") S X(3)=$P(X(1)," ",X(2)) D:$L(X(3))+$X>78 EN^DDIOL(" "_X(3))
"^DD",53.45,53.4502,.01,7.5)
S DIC("S")="I 1"
"^DD",53.45,53.4502,.01,12)
Only dispense drugs marked for Unit Dose use.
"^DD",53.45,53.4502,.01,12.1)
S DIC("S")="I $P($G(^(2)),U,3)[""U"",$S('$G(PSGPDRG):1,1:PSGPDRG=+$G(^(2)))"
"^DD",53.45,53.4502,.01,20,0)
^.3LA^1^1
"^DD",53.45,53.4502,.01,20,1,0)
PSJ
"^DD",53.45,53.4502,.01,"DEL",1,0)
D:$G(PSGOEEND) EN^DDIOL("Dispense Drugs for active orders cannot be deleted, but can be given an INACTIVE DATE.") I $G(PSJPNDRN)&$G(^PS(53.1,+$G(ON),1,+$G(DA),0)) D EN^DDIOL($P(PSJPNDRN,"^",2))
"^DD",53.45,53.4502,.01,"DT")
2970402
"^DD",53.45,53.4502,.01,"LAYGO",1,0)
S X(1)=$D(^PS(53.45,DA,2,"B",+X)) D:X(1) EN^DDIOL("This dispense drug has already been entered for this order.") I 'X(1)
"BLD",5622,6)
^145
**END**
**END**
