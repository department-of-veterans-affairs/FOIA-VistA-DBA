Released DG*5.3*685 SEQ #596
Extracted from mail message
**KIDS**:DG*5.3*685^

**INSTALL NAME**
DG*5.3*685
"BLD",6453,0)
DG*5.3*685^REGISTRATION^0^3051104^y
"BLD",6453,1,0)
^^1^1^3051104^
"BLD",6453,1,1,0)
Prevents error in MPI's Patient Data Review and cleans up file #391.98.
"BLD",6453,4,0)
^9.64PA^^
"BLD",6453,"INIT")
DG685PST
"BLD",6453,"KRN",0)
^9.67PA^8989.52^19
"BLD",6453,"KRN",.4,0)
.4
"BLD",6453,"KRN",.401,0)
.401
"BLD",6453,"KRN",.402,0)
.402
"BLD",6453,"KRN",.403,0)
.403
"BLD",6453,"KRN",.5,0)
.5
"BLD",6453,"KRN",.84,0)
.84
"BLD",6453,"KRN",3.6,0)
3.6
"BLD",6453,"KRN",3.8,0)
3.8
"BLD",6453,"KRN",9.2,0)
9.2
"BLD",6453,"KRN",9.8,0)
9.8
"BLD",6453,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6453,"KRN",9.8,"NM",1,0)
VAFCEHU1^^0^B53757953
"BLD",6453,"KRN",9.8,"NM","B","VAFCEHU1",1)

"BLD",6453,"KRN",19,0)
19
"BLD",6453,"KRN",19.1,0)
19.1
"BLD",6453,"KRN",101,0)
101
"BLD",6453,"KRN",409.61,0)
409.61
"BLD",6453,"KRN",771,0)
771
"BLD",6453,"KRN",870,0)
870
"BLD",6453,"KRN",8989.51,0)
8989.51
"BLD",6453,"KRN",8989.52,0)
8989.52
"BLD",6453,"KRN",8994,0)
8994
"BLD",6453,"KRN","B",.4,.4)

"BLD",6453,"KRN","B",.401,.401)

"BLD",6453,"KRN","B",.402,.402)

"BLD",6453,"KRN","B",.403,.403)

"BLD",6453,"KRN","B",.5,.5)

"BLD",6453,"KRN","B",.84,.84)

"BLD",6453,"KRN","B",3.6,3.6)

"BLD",6453,"KRN","B",3.8,3.8)

"BLD",6453,"KRN","B",9.2,9.2)

"BLD",6453,"KRN","B",9.8,9.8)

"BLD",6453,"KRN","B",19,19)

"BLD",6453,"KRN","B",19.1,19.1)

"BLD",6453,"KRN","B",101,101)

"BLD",6453,"KRN","B",409.61,409.61)

"BLD",6453,"KRN","B",771,771)

"BLD",6453,"KRN","B",870,870)

"BLD",6453,"KRN","B",8989.51,8989.51)

"BLD",6453,"KRN","B",8989.52,8989.52)

"BLD",6453,"KRN","B",8994,8994)

"BLD",6453,"QUES",0)
^9.62^^
"BLD",6453,"REQB",0)
^9.611^1^1
"BLD",6453,"REQB",1,0)
DG*5.3*477^1
"BLD",6453,"REQB","B","DG*5.3*477",1)

"INIT")
DG685PST
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
685^3051104
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3051104
"PKG",5,22,1,"PAH",1,1,1,0)
Prevents error in MPI's Patient Data Review and cleans up file #391.98.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DG685PST")
0^^B410389
"RTN","DG685PST",1,0)
DG685PST ;BAY/ALS;cleanup Patient Date Review exceptions ; 11/15/05
"RTN","DG685PST",2,0)
 ;;5.3;Registration;**685**;Aug 13,1993
"RTN","DG685PST",3,0)
 ;
"RTN","DG685PST",4,0)
 ; This is a post-install routine for DG*5.3*685
"RTN","DG685PST",5,0)
 ; The purpose is to cleanup Patient Data Review exceptions.
"RTN","DG685PST",6,0)
 ; When an entry exists in the PATIENT DATA EXCEPTION (391.98) file
"RTN","DG685PST",7,0)
 ; and the corresponding data is missing from the PATIENT DATA
"RTN","DG685PST",8,0)
 ; ELEMENT (391.99) file the exception will be retired. 
"RTN","DG685PST",9,0)
 ;
"RTN","DG685PST",10,0)
EN ; 
"RTN","DG685PST",11,0)
 N DGPDR,IEN
"RTN","DG685PST",12,0)
 S IEN=0
"RTN","DG685PST",13,0)
 F  S IEN=$O(^DGCN(391.98,IEN)) Q:'IEN  D
"RTN","DG685PST",14,0)
 . I '$O(^DGCN(391.99,"B",IEN,0)) D
"RTN","DG685PST",15,0)
 .. I $P($G(^DGCN(391.98,IEN,0)),"^",4)'=6 S DGPDR=$$EDIT^VAFCEHU1(IEN,"RD")
"RTN","DG685PST",16,0)
 Q
"RTN","VAFCEHU1")
0^1^B53757953
"RTN","VAFCEHU1",1,0)
VAFCEHU1 ;ALB/JLU,PTD-FILE UTILITIES FOR 391.98 ;11/21/02  12:24
"RTN","VAFCEHU1",2,0)
 ;;5.3;Registration;**149,255,307,477,685**;Aug 13, 1993
"RTN","VAFCEHU1",3,0)
 ;
"RTN","VAFCEHU1",4,0)
ADD(VAFCA,VAFCB) ;Main entry point to add an entry to 391.98
"RTN","VAFCEHU1",5,0)
 ;INPUTS    VAFCA - This parameter contains a piece string of 4 elements
"RTN","VAFCEHU1",6,0)
 ;Date Received^Event date^From whom^patient IEN
"RTN","VAFCEHU1",7,0)
 ;  Date Received - This is the date/time that the exception was received
"RTN","VAFCEHU1",8,0)
 ;at the facility.  Must be in FM format
"RTN","VAFCEHU1",9,0)
 ;  Event date - This is the date/time when the event occurred that caused
"RTN","VAFCEHU1",10,0)
 ;this information to be sent.  Must be in FM format
"RTN","VAFCEHU1",11,0)
 ;  From whom - This is who sent the information.  This should be in a
"RTN","VAFCEHU1",12,0)
 ;free text format.  There is a potential that exception could be coming
"RTN","VAFCEHU1",13,0)
 ;from sources other than what is listed in the institution file.
"RTN","VAFCEHU1",14,0)
 ;FORMAT of WHOM
"RTN","VAFCEHU1",15,0)
 ;  prior to RG*1*8: institution name(sender name)
"RTN","VAFCEHU1",16,0)
 ;     after RG*1*8: sending facility: station # -or- station #~domain
"RTN","VAFCEHU1",17,0)
 ;
"RTN","VAFCEHU1",18,0)
 ;  Patient IEN - The patient file internal entry number.
"RTN","VAFCEHU1",19,0)
 ;
"RTN","VAFCEHU1",20,0)
 ;         VAFCB - is an array storage structure. It can be either global
"RTN","VAFCEHU1",21,0)
 ;or local.  The array should be in the following format.
"RTN","VAFCEHU1",22,0)
 ;Ex.   A(file #,field #)=value
"RTN","VAFCEHU1",23,0)
 ;      A(file #, field #)=value
"RTN","VAFCEHU1",24,0)
 ;
"RTN","VAFCEHU1",25,0)
 ;In the case of multiples us the following structure:
"RTN","VAFCEHU1",26,0)
 ;Ex.   A(file #,field #,Subfile #, subfield #)=value
"RTN","VAFCEHU1",27,0)
 ;***NOTE*** THE SOFTWARE LOGIC TO HANDLE THIS MULTIPLE CASE HAS NOT
"RTN","VAFCEHU1",28,0)
 ;BEEN WRITTEN YET.
"RTN","VAFCEHU1",29,0)
 ;
"RTN","VAFCEHU1",30,0)
 ;**NOTE**
"RTN","VAFCEHU1",31,0)
 ;When setting info in the passage array please follow this format for
"RTN","VAFCEHU1",32,0)
 ;these exceptions.
"RTN","VAFCEHU1",33,0)
 ;-Unspecified or blank data should have no array element or an array
"RTN","VAFCEHU1",34,0)
 ;element set to the mumps null.
"RTN","VAFCEHU1",35,0)
 ;-If data from a sender can not be resolved then set
"RTN","VAFCEHU1",36,0)
 ; $P(array element,U,2)=1
"RTN","VAFCEHU1",37,0)
 ;-If you wish to delete what is in the receiving facilities field set
"RTN","VAFCEHU1",38,0)
 ;the array element to "@". EX. s X(1)="""@"""
"RTN","VAFCEHU1",39,0)
 ;
"RTN","VAFCEHU1",40,0)
 ;OUTPUTS
"RTN","VAFCEHU1",41,0)
 ; 0^error message - in the case of a failure
"RTN","VAFCEHU1",42,0)
 ; 1 - in the case that the entry is added
"RTN","VAFCEHU1",43,0)
 ;
"RTN","VAFCEHU1",44,0)
 N REC,EVT,WHO,PAT,RESLT,STATUS,LATEST
"RTN","VAFCEHU1",45,0)
 K ERR
"RTN","VAFCEHU1",46,0)
 S LATEST=""
"RTN","VAFCEHU1",47,0)
 I '$D(VAFCA) S ERR="0^Missing date/from parameter" G ADDQ
"RTN","VAFCEHU1",48,0)
 I '$D(VAFCB) S ERR="0^Missing array structure" G ADDQ
"RTN","VAFCEHU1",49,0)
 S REC=$P(VAFCA,U,1)
"RTN","VAFCEHU1",50,0)
 I REC']"" S ERR="0^Missing date of receipt" G ADDQ
"RTN","VAFCEHU1",51,0)
 S EVT=$P(VAFCA,U,2)
"RTN","VAFCEHU1",52,0)
 I EVT']"" S ERR="0^Missing date of event" G ADDQ
"RTN","VAFCEHU1",53,0)
 S WHO=$$WHO^VAFCEHU4($P(VAFCA,"^",3))
"RTN","VAFCEHU1",54,0)
 I WHO']"" S ERR="0^Missing who sent the information" G ADDQ
"RTN","VAFCEHU1",55,0)
 S PAT=$P(VAFCA,U,4)
"RTN","VAFCEHU1",56,0)
 I PAT']"" S ERR="0^Missing patient pointer" G ADDQ
"RTN","VAFCEHU1",57,0)
 I '$D(^DPT(PAT,0)) S ERR="0^Patient not defined" G ADDQ
"RTN","VAFCEHU1",58,0)
 I '$O(@VAFCB@("")) S ERR="0^Missing array storage structure" G ADDQ
"RTN","VAFCEHU1",59,0)
 ;There can be more than one patient update for a given day
"RTN","VAFCEHU1",60,0)
 ;resulting from different fields being edited.
"RTN","VAFCEHU1",61,0)
 ;I $D(^DGCN(391.98,"AKY",PAT,WHO,EVT)) S ERR="0^Entry already exists." G ADDQ
"RTN","VAFCEHU1",62,0)
 ;
"RTN","VAFCEHU1",63,0)
 ;update select edited fields and check for any differences
"RTN","VAFCEHU1",64,0)
 D EN^VAFCEHU3 I '$G(VAFCQ) S ERR="0^No exception needed" K VAFCQ G ADDQ
"RTN","VAFCEHU1",65,0)
 K VAFCQ
"RTN","VAFCEHU1",66,0)
 ;check for other entries for this date
"RTN","VAFCEHU1",67,0)
 S LATEST=$$CHKDATE(EVT,WHO,PAT)
"RTN","VAFCEHU1",68,0)
 ;if other entries than retire them based upon the event date
"RTN","VAFCEHU1",69,0)
 S STATUS=$S(LATEST:"ACTION REQUIRED",1:"RETIRED DATA")
"RTN","VAFCEHU1",70,0)
 ;
"RTN","VAFCEHU1",71,0)
 S (RESLT,RESLT(1))=$$EXCPTN(REC,EVT,WHO,PAT,STATUS)
"RTN","VAFCEHU1",72,0)
 I RESLT=-1 S ERR="0^Adding entry failed" G ADDQ
"RTN","VAFCEHU1",73,0)
 S RESLT=$$DATA(+RESLT,VAFCB)
"RTN","VAFCEHU1",74,0)
 I 'RESLT S ERR="0^Adding element failed"
"RTN","VAFCEHU1",75,0)
 ;
"RTN","VAFCEHU1",76,0)
ADDQ ;
"RTN","VAFCEHU1",77,0)
 I LATEST,'$D(ERR) D RETIRE(EVT,WHO,PAT)
"RTN","VAFCEHU1",78,0)
 Q $S($D(ERR):ERR,1:1)
"RTN","VAFCEHU1",79,0)
 ;
"RTN","VAFCEHU1",80,0)
CHKDATE(EVT,WHO,PAT) ;
"RTN","VAFCEHU1",81,0)
 N AFTER
"RTN","VAFCEHU1",82,0)
 S AFTER=$O(^DGCN(391.98,"AKY",PAT,WHO,EVT)) ;there is another date after
"RTN","VAFCEHU1",83,0)
 Q $S(AFTER:0,1:1)
"RTN","VAFCEHU1",84,0)
 ;
"RTN","VAFCEHU1",85,0)
RETIRE(EVT,WHO,PAT) ; Retire all previous entries from same site
"RTN","VAFCEHU1",86,0)
 N LP,ACTION,EDIT S LP=0
"RTN","VAFCEHU1",87,0)
 ;ien of action required
"RTN","VAFCEHU1",88,0)
 S ACTION=$O(^DGCN(391.984,"B","ACTION REQUIRED",0))
"RTN","VAFCEHU1",89,0)
 Q:'ACTION
"RTN","VAFCEHU1",90,0)
 ;looping to get all action required for "from" site
"RTN","VAFCEHU1",91,0)
 F  S LP=$O(^DGCN(391.98,"AKY",PAT,WHO,LP)) Q:'LP  D
"RTN","VAFCEHU1",92,0)
 .N ENTRY,DATA,XX,ELIEN,NODE
"RTN","VAFCEHU1",93,0)
 .S ENTRY=0
"RTN","VAFCEHU1",94,0)
 .F  S ENTRY=$O(^DGCN(391.98,"AKY",PAT,WHO,LP,ENTRY)) Q:'ENTRY!(ENTRY=+RESLT(1))  D
"RTN","VAFCEHU1",95,0)
 ..S DATA=$G(^DGCN(391.98,ENTRY,0))
"RTN","VAFCEHU1",96,0)
 ..;sets the status to retired
"RTN","VAFCEHU1",97,0)
 ..I DATA,$P(DATA,U,4)=ACTION D  S XX=$$EDIT(ENTRY,"RETIRED DATA")
"RTN","VAFCEHU1",98,0)
 ...;build array of EDITED elements from all entries being retired
"RTN","VAFCEHU1",99,0)
 ...S ELIEN=0
"RTN","VAFCEHU1",100,0)
 ...F  S ELIEN=$O(^DGCN(391.99,"B",ENTRY,ELIEN)) Q:'ELIEN  S NODE=$G(^DGCN(391.99,ELIEN,0)) I NODE,$P(NODE,U,5)=1 S EDIT($P(NODE,U,2),$P(NODE,U,3))=""
"RTN","VAFCEHU1",101,0)
 ..Q
"RTN","VAFCEHU1",102,0)
 ;mark EDITED fields in remaining entry
"RTN","VAFCEHU1",103,0)
 Q:'$O(EDIT(0))
"RTN","VAFCEHU1",104,0)
 N ELIEN,NODE,P2,P3 S ELIEN=0,DIE="^DGCN(391.99,",DR=".05///1"
"RTN","VAFCEHU1",105,0)
 F  S ELIEN=$O(^DGCN(391.99,"B",(+RESLT(1)),ELIEN)) Q:'ELIEN  D
"RTN","VAFCEHU1",106,0)
 .S NODE=$G(^DGCN(391.99,ELIEN,0)),(P2,P3)="" I NODE S P2=$P(NODE,U,2),P3=$P(NODE,U,3) I $D(EDIT(P2,P3)) D
"RTN","VAFCEHU1",107,0)
 ..L +^DGCN(391.99,ELIEN):60 ;**255
"RTN","VAFCEHU1",108,0)
 ..S DA=ELIEN D ^DIE
"RTN","VAFCEHU1",109,0)
 ..L -^DGCN(391.99,ELIEN) ;**255
"RTN","VAFCEHU1",110,0)
 K DA,DIE,DR,EDIT
"RTN","VAFCEHU1",111,0)
 Q
"RTN","VAFCEHU1",112,0)
 ;
"RTN","VAFCEHU1",113,0)
EXCPTN(REC,EVT,WHO,PAT,VAFCA) ;
"RTN","VAFCEHU1",114,0)
 N Y
"RTN","VAFCEHU1",115,0)
 K DIC,DA,DD,DO
"RTN","VAFCEHU1",116,0)
 S DGSENFLG="" ;**255
"RTN","VAFCEHU1",117,0)
 S DLAYGO=391.98
"RTN","VAFCEHU1",118,0)
 S DIC="^DGCN(391.98,"
"RTN","VAFCEHU1",119,0)
 S DIC(0)="LI"
"RTN","VAFCEHU1",120,0)
 S X=PAT
"RTN","VAFCEHU1",121,0)
 S DIC("DR")=".02///"_REC_";.03///"_EVT_";.04///"_VAFCA_";50///"_WHO
"RTN","VAFCEHU1",122,0)
 D FILE^DICN
"RTN","VAFCEHU1",123,0)
 K DIC,DLAYGO,X,DGSENFLG ;**255
"RTN","VAFCEHU1",124,0)
 Q Y
"RTN","VAFCEHU1",125,0)
 ;
"RTN","VAFCEHU1",126,0)
DATA(VAFCA,VAFCB) ;
"RTN","VAFCEHU1",127,0)
 N ADDED,LP,LP1,VAR
"RTN","VAFCEHU1",128,0)
 F LP=0:0 S LP=$O(@VAFCB@(LP)) Q:'LP  DO
"RTN","VAFCEHU1",129,0)
 .F LP1=0:0 S LP1=$O(@VAFCB@(LP,LP1)) Q:'LP1  DO
"RTN","VAFCEHU1",130,0)
 ..K DIC,DA,DD,DO,VAFCE
"RTN","VAFCEHU1",131,0)
 ..S DLAYGO=391.99
"RTN","VAFCEHU1",132,0)
 ..S DIC="^DGCN(391.99,"
"RTN","VAFCEHU1",133,0)
 ..S DIC(0)="LI" ;**477 added 'I' to suppress incoming filer from generating bulletins
"RTN","VAFCEHU1",134,0)
 ..S X=VAFCA
"RTN","VAFCEHU1",135,0)
 ..S VAR=@VAFCB@(LP,LP1)
"RTN","VAFCEHU1",136,0)
 ..I (@VAFCB@(2,"FLD")[LP1_";"),(VAR]"") S VAFCE=1
"RTN","VAFCEHU1",137,0)
 ..S DIC("DR")=".02///"_LP_";.03///"_LP1_";.05///"_$G(VAFCE)_";.06///"_$P(VAR,U,2)_";50////^S X=$P(VAR,U)"
"RTN","VAFCEHU1",138,0)
 ..D FILE^DICN
"RTN","VAFCEHU1",139,0)
 ..I Y>0 S ADDED=1
"RTN","VAFCEHU1",140,0)
 ..Q
"RTN","VAFCEHU1",141,0)
 .Q
"RTN","VAFCEHU1",142,0)
 Q $S($D(ADDED):1,1:0)
"RTN","VAFCEHU1",143,0)
 ;
"RTN","VAFCEHU1",144,0)
CHK(A) ;
"RTN","VAFCEHU1",145,0)
 ;INPUT - A This parameter contains a piece string of 3 elements
"RTN","VAFCEHU1",146,0)
 ;      patient dfn^event date/time^from whom
"RTN","VAFCEHU1",147,0)
 ;These are the key element to finding the entry in the patient data 
"RTN","VAFCEHU1",148,0)
 ;exception file.
"RTN","VAFCEHU1",149,0)
 ;
"RTN","VAFCEHU1",150,0)
 ;Patient DFN is the internal entry number of the patient in the patient
"RTN","VAFCEHU1",151,0)
 ;file.
"RTN","VAFCEHU1",152,0)
 ;
"RTN","VAFCEHU1",153,0)
 ;event date/time is the date/time the event took place at the facility
"RTN","VAFCEHU1",154,0)
 ;that sent the data.  This date must be in FM format.
"RTN","VAFCEHU1",155,0)
 ;
"RTN","VAFCEHU1",156,0)
 ;from whom is who sent this information to this medical center.
"RTN","VAFCEHU1",157,0)
 ;
"RTN","VAFCEHU1",158,0)
 ;OUTPUT
"RTN","VAFCEHU1",159,0)
 ; ZERO(0) if nothing found
"RTN","VAFCEHU1",160,0)
 ; ZERO(0)^error description if an error found
"RTN","VAFCEHU1",161,0)
 ; IEN of the entry in the patient data exception file if found
"RTN","VAFCEHU1",162,0)
 ;
"RTN","VAFCEHU1",163,0)
 N FOUND,PAT,EVT,WHO
"RTN","VAFCEHU1",164,0)
 S FOUND=0
"RTN","VAFCEHU1",165,0)
 I '$D(A) S FOUND="0^Input parameter missing." G CHKQ
"RTN","VAFCEHU1",166,0)
 S PAT=$P(A,U,1)
"RTN","VAFCEHU1",167,0)
 I PAT']"" S FOUND="0^No patient DFN defined." G CHKQ
"RTN","VAFCEHU1",168,0)
 I '$D(^DPT(PAT,0)) S FOUND="0^No patient with this DFN." G CHKQ
"RTN","VAFCEHU1",169,0)
 S EVT=$P(A,U,2)
"RTN","VAFCEHU1",170,0)
 I EVT']"" S FOUND="0^Date of event not defined." G CHKQ
"RTN","VAFCEHU1",171,0)
 S WHO=$$WHO^VAFCEHU4($P(A,U,3))
"RTN","VAFCEHU1",172,0)
 I WHO']"" S FOUND="0^Who sent the information is not defined." G CHKQ
"RTN","VAFCEHU1",173,0)
 ;
"RTN","VAFCEHU1",174,0)
 I $D(^DGCN(391.98,"AKY",PAT,WHO,EVT)) DO
"RTN","VAFCEHU1",175,0)
 .S FOUND=$O(^(EVT,"")) ;naked on the ^dgcn aky cross ref.
"RTN","VAFCEHU1",176,0)
 .I '$D(^DGCN(391.98,FOUND,0)) S FOUND=0
"RTN","VAFCEHU1",177,0)
 .Q
"RTN","VAFCEHU1",178,0)
 ;
"RTN","VAFCEHU1",179,0)
CHKQ Q FOUND
"RTN","VAFCEHU1",180,0)
 ;
"RTN","VAFCEHU1",181,0)
DELEXCPT(IEN) ;
"RTN","VAFCEHU1",182,0)
 ;This entry point deletes the entire exception from the file 391.98 
"RTN","VAFCEHU1",183,0)
 ;and 391.99
"RTN","VAFCEHU1",184,0)
 ;INPUTS
"RTN","VAFCEHU1",185,0)
 ;IEN is the IEN of the entry in 391.98 it can be obtained from the call
"RTN","VAFCEHU1",186,0)
 ; to the CHK line tag.
"RTN","VAFCEHU1",187,0)
 ;
"RTN","VAFCEHU1",188,0)
 ;OUTPUT
"RTN","VAFCEHU1",189,0)
 ;ZERO(0) - if a problem or no deletion
"RTN","VAFCEHU1",190,0)
 ;ONE(1) - if deletion occurred
"RTN","VAFCEHU1",191,0)
 ;
"RTN","VAFCEHU1",192,0)
 I '$D(IEN) S ERR="0^Input parameter missing." G DELQ
"RTN","VAFCEHU1",193,0)
 I IEN']"" S ERR="0^Input parameter undefined." G DELQ
"RTN","VAFCEHU1",194,0)
 I '$D(^DGCN(391.98,IEN,0)) S ERR="0^Exception data missing." G DELQ
"RTN","VAFCEHU1",195,0)
 D DELDATA(IEN,.ERR)
"RTN","VAFCEHU1",196,0)
 ;
"RTN","VAFCEHU1",197,0)
 S DIK="^DGCN(391.98,"
"RTN","VAFCEHU1",198,0)
 S DA=IEN
"RTN","VAFCEHU1",199,0)
 D ^DIK
"RTN","VAFCEHU1",200,0)
 K DIK,DA
"RTN","VAFCEHU1",201,0)
 S ERR=1
"RTN","VAFCEHU1",202,0)
 ;
"RTN","VAFCEHU1",203,0)
DELQ Q ERR
"RTN","VAFCEHU1",204,0)
 ;
"RTN","VAFCEHU1",205,0)
DELDATA(IEN,ERR) ;
"RTN","VAFCEHU1",206,0)
 N LP
"RTN","VAFCEHU1",207,0)
 F LP=0:0 S LP=$O(^DGCN(391.99,"B",IEN,LP)) Q:'LP  DO
"RTN","VAFCEHU1",208,0)
 .I '$D(^DGCN(391.99,LP,0)) Q
"RTN","VAFCEHU1",209,0)
 .S DIK="^DGCN(391.99,"
"RTN","VAFCEHU1",210,0)
 .S DA=LP
"RTN","VAFCEHU1",211,0)
 .D ^DIK
"RTN","VAFCEHU1",212,0)
 .K DA,DIK
"RTN","VAFCEHU1",213,0)
 .S ERR=1
"RTN","VAFCEHU1",214,0)
 .Q
"RTN","VAFCEHU1",215,0)
 Q
"RTN","VAFCEHU1",216,0)
 ;
"RTN","VAFCEHU1",217,0)
EDIT(IEN,STAT) ;
"RTN","VAFCEHU1",218,0)
 ;This entry point allows the editing of the status of an exception.
"RTN","VAFCEHU1",219,0)
 ;INPUT
"RTN","VAFCEHU1",220,0)
 ;IEN - the ien for an entry from 391.98
"RTN","VAFCEHU1",221,0)
 ;STAT - the new status.
"RTN","VAFCEHU1",222,0)
 ;
"RTN","VAFCEHU1",223,0)
 ;OUTPUTS
"RTN","VAFCEHU1",224,0)
 ;ZERO(0)^ description if an error
"RTN","VAFCEHU1",225,0)
 ;1 if changed
"RTN","VAFCEHU1",226,0)
 N ERR
"RTN","VAFCEHU1",227,0)
 ;
"RTN","VAFCEHU1",228,0)
 I '$D(IEN) S ERR="0^IEN not defined." G EDITQ
"RTN","VAFCEHU1",229,0)
 I IEN']"" S ERR="0^IEN is null." G EDITQ
"RTN","VAFCEHU1",230,0)
 I '$D(STAT) S ERR="0^Status is not defined." G EDITQ
"RTN","VAFCEHU1",231,0)
 I STAT']"" S ERR="0^Status is null." G EDITQ
"RTN","VAFCEHU1",232,0)
 I '$D(^DGCN(391.98,IEN,0)) S ERR="0^No entry for the IEN." G EDITQ
"RTN","VAFCEHU1",233,0)
 ;
"RTN","VAFCEHU1",234,0)
 N DIE,DA,DR
"RTN","VAFCEHU1",235,0)
 S DIE="^DGCN(391.98,"
"RTN","VAFCEHU1",236,0)
 S DA=IEN
"RTN","VAFCEHU1",237,0)
 S DR=".04///"_STAT
"RTN","VAFCEHU1",238,0)
 D ^DIE
"RTN","VAFCEHU1",239,0)
 S ERR=1
"RTN","VAFCEHU1",240,0)
 ;
"RTN","VAFCEHU1",241,0)
EDITQ Q ERR
"RTN","VAFCEHU1",242,0)
 ;
"RTN","VAFCEHU1",243,0)
LOCK(IEN) ;this function call will check the status of the exception and
"RTN","VAFCEHU1",244,0)
 ;set it to being reviewed if it is able.  Exceptions that are being 
"RTN","VAFCEHU1",245,0)
 ;reviewed, data rejected, merge complete or retired data can not be
"RTN","VAFCEHU1",246,0)
 ;set to being reviewed and thus accessed.
"RTN","VAFCEHU1",247,0)
 ;
"RTN","VAFCEHU1",248,0)
 ;INPUT - IEN the ien of the exception
"RTN","VAFCEHU1",249,0)
 ;
"RTN","VAFCEHU1",250,0)
 ;OUTPUT - 1 if the exception was able to be locked/ status turned to
"RTN","VAFCEHU1",251,0)
 ;           being reviewed.
"RTN","VAFCEHU1",252,0)
 ;         0^description if the exception was not able to be "locked"
"RTN","VAFCEHU1",253,0)
 ;
"RTN","VAFCEHU1",254,0)
 N ERR,STAT,DATA
"RTN","VAFCEHU1",255,0)
 I '$D(IEN) S ERR="0^No input." G LCKQ
"RTN","VAFCEHU1",256,0)
 I IEN']"" S ERR="0^Null input." G LCKQ
"RTN","VAFCEHU1",257,0)
 L +^DGCN(391.98,IEN):0 I '$T S ERR="0^Exception is currently locked." G LCKQ ;**255
"RTN","VAFCEHU1",258,0)
 S DATA=$G(^DGCN(391.98,IEN,0))
"RTN","VAFCEHU1",259,0)
 I DATA="" S ERR="0^Exception not found." G LCKQ
"RTN","VAFCEHU1",260,0)
 S STAT=$P(DATA,U,4)
"RTN","VAFCEHU1",261,0)
 I STAT']"" S ERR="0^Status not defined." G LCKQ
"RTN","VAFCEHU1",262,0)
 S STAT=$G(^DGCN(391.984,STAT,0))
"RTN","VAFCEHU1",263,0)
 I STAT="" S ERR="0^Status not found." G LCKQ
"RTN","VAFCEHU1",264,0)
 I $P(STAT,U,2)'="AR",($P(STAT,U,2)'="DE") S ERR="0^"_$P(STAT,U,1) G LCKQ
"RTN","VAFCEHU1",265,0)
 I $$EDIT(IEN,"BR") S ERR="1^OK"
"RTN","VAFCEHU1",266,0)
 E  S ERR="0^Could not change status."
"RTN","VAFCEHU1",267,0)
 ;
"RTN","VAFCEHU1",268,0)
LCKQ Q ERR
"VER")
8.0^22.0
"BLD",6453,6)
^596
**END**
**END**
