Released OOPS*2*6 SEQ #5
Extracted from mail message
**KIDS**:OOPS*2.0*6^

**INSTALL NAME**
OOPS*2.0*6
"BLD",5049,0)
OOPS*2.0*6^ASISTS^0^3040729^y
"BLD",5049,1,0)
^^1^1^3040728^^^^
"BLD",5049,1,1,0)
Bug fix for the Log of Needlestick Incidents Option.
"BLD",5049,4,0)
^9.64PA^^0
"BLD",5049,"INI")

"BLD",5049,"INID")
^n^
"BLD",5049,"INIT")

"BLD",5049,"KRN",0)
^9.67PA^8989.52^19
"BLD",5049,"KRN",.4,0)
.4
"BLD",5049,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5049,"KRN",.401,0)
.401
"BLD",5049,"KRN",.402,0)
.402
"BLD",5049,"KRN",.403,0)
.403
"BLD",5049,"KRN",.403,"NM",0)
^9.68A^^
"BLD",5049,"KRN",.5,0)
.5
"BLD",5049,"KRN",.84,0)
.84
"BLD",5049,"KRN",.84,"NM",0)
^9.68A^^
"BLD",5049,"KRN",3.6,0)
3.6
"BLD",5049,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",5049,"KRN",3.8,0)
3.8
"BLD",5049,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",5049,"KRN",9.2,0)
9.2
"BLD",5049,"KRN",9.8,0)
9.8
"BLD",5049,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5049,"KRN",9.8,"NM",1,0)
OOPSGUIF^^0^B22360092
"BLD",5049,"KRN",9.8,"NM",2,0)
OOPSGUI9^^0^B49450336
"BLD",5049,"KRN",9.8,"NM","B","OOPSGUI9",2)

"BLD",5049,"KRN",9.8,"NM","B","OOPSGUIF",1)

"BLD",5049,"KRN",19,0)
19
"BLD",5049,"KRN",19,"NM",0)
^9.68A^^0
"BLD",5049,"KRN",19.1,0)
19.1
"BLD",5049,"KRN",101,0)
101
"BLD",5049,"KRN",409.61,0)
409.61
"BLD",5049,"KRN",771,0)
771
"BLD",5049,"KRN",870,0)
870
"BLD",5049,"KRN",8989.51,0)
8989.51
"BLD",5049,"KRN",8989.52,0)
8989.52
"BLD",5049,"KRN",8994,0)
8994
"BLD",5049,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",5049,"KRN","B",.4,.4)

"BLD",5049,"KRN","B",.401,.401)

"BLD",5049,"KRN","B",.402,.402)

"BLD",5049,"KRN","B",.403,.403)

"BLD",5049,"KRN","B",.5,.5)

"BLD",5049,"KRN","B",.84,.84)

"BLD",5049,"KRN","B",3.6,3.6)

"BLD",5049,"KRN","B",3.8,3.8)

"BLD",5049,"KRN","B",9.2,9.2)

"BLD",5049,"KRN","B",9.8,9.8)

"BLD",5049,"KRN","B",19,19)

"BLD",5049,"KRN","B",19.1,19.1)

"BLD",5049,"KRN","B",101,101)

"BLD",5049,"KRN","B",409.61,409.61)

"BLD",5049,"KRN","B",771,771)

"BLD",5049,"KRN","B",870,870)

"BLD",5049,"KRN","B",8989.51,8989.51)

"BLD",5049,"KRN","B",8989.52,8989.52)

"BLD",5049,"KRN","B",8994,8994)

"BLD",5049,"PRE")

"BLD",5049,"PRET")

"BLD",5049,"QUES",0)
^9.62^^
"BLD",5049,"REQB",0)
^9.611^1^1
"BLD",5049,"REQB",1,0)
OOPS*2.0*4^1
"BLD",5049,"REQB","B","OOPS*2.0*4",1)

"MBREQ")
0
"PKG",419,-1)
1^1
"PKG",419,0)
ASISTS^OOPS^Automated Safety Incident Surveillance Tracking System
"PKG",419,20,0)
^9.402P^^
"PKG",419,22,0)
^9.49I^1^1
"PKG",419,22,1,0)
2.0^3020709^3030424^66481
"PKG",419,22,1,"PAH",1,0)
6^3040729^2440
"PKG",419,22,1,"PAH",1,1,0)
^^1^1^3040729
"PKG",419,22,1,"PAH",1,1,1,0)
Bug fix for the Log of Needlestick Incidents Option.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","OOPSGUI9")
0^2^B49450336
"RTN","OOPSGUI9",1,0)
OOPSGUI9 ;WIOFO/LLH-RPC routines ;10/24/01
"RTN","OOPSGUI9",2,0)
 ;;2.0;ASISTS;**6**;Jun 03, 2002
"RTN","OOPSGUI9",3,0)
 ;;
"RTN","OOPSGUI9",4,0)
VALIDATE(IEN,FORM,CALLER,VALID) ;
"RTN","OOPSGUI9",5,0)
 ; Input: IEN    = Internal Entry Number of entry in file 2260
"RTN","OOPSGUI9",6,0)
 ;        FORM   = 2162,CA1, or CA2
"RTN","OOPSGUI9",7,0)
 ;        CALLER = "E" employee
"RTN","OOPSGUI9",8,0)
 ;               = "S" supervisor
"RTN","OOPSGUI9",9,0)
 ;               = "O" safety officer
"RTN","OOPSGUI9",10,0)
 ;               = "W" worker's comp personnel
"RTN","OOPSGUI9",11,0)
 ;        WCEMP  = from menu if 1 - need to execute emp validation
"RTN","OOPSGUI9",12,0)
 ;        VALID  = RESERVED FOR OUTPUT DATA
"RTN","OOPSGUI9",13,0)
 ; Output:VALID  = 1 ALL REQUIRED DATA FOR FORM IS COMPLETE
"RTN","OOPSGUI9",14,0)
 ;               = 0 DATA IS MISSING
"RTN","OOPSGUI9",15,0)
 N LIST,FLD,CN,CNT,CHK
"RTN","OOPSGUI9",16,0)
 S (FLD,LIST)=""
"RTN","OOPSGUI9",17,0)
 S VALID=1,CHK=0
"RTN","OOPSGUI9",18,0)
 S CN=2   ; start CN in RESULTS array after index 1
"RTN","OOPSGUI9",19,0)
 ; removed code in line below that would also do set if the variable
"RTN","OOPSGUI9",20,0)
 ; WCEMP set.  WCEMP was an indicator that WC was completing CA1 for
"RTN","OOPSGUI9",21,0)
 ; employee.  May need to do something else.  10/24/01 llh
"RTN","OOPSGUI9",22,0)
 I CALLER="E" D EMP
"RTN","OOPSGUI9",23,0)
 I CALLER="S" D SUP
"RTN","OOPSGUI9",24,0)
 I CALLER="O" D SOF
"RTN","OOPSGUI9",25,0)
 I CALLER="W" D WCP
"RTN","OOPSGUI9",26,0)
 F CNT=1:1 S FLD=$P(LIST,",",CNT) Q:FLD=""  D
"RTN","OOPSGUI9",27,0)
 .N LOC,NODE,PCE,BADFLD,TEXT,WP
"RTN","OOPSGUI9",28,0)
 .S BADFLD=1,WP=0
"RTN","OOPSGUI9",29,0)
 .S LOC=$$GET1^DID(2260,FLD,"","GLOBAL SUBSCRIPT LOCATION")
"RTN","OOPSGUI9",30,0)
 .S NODE=$P(LOC,";")
"RTN","OOPSGUI9",31,0)
 .S PCE=$P(LOC,";",2)
"RTN","OOPSGUI9",32,0)
 .I PCE=0 D  ;Work processing field
"RTN","OOPSGUI9",33,0)
 ..I '$D(^OOPS(2260,IEN,NODE,1,0)) S (BADFLD,VALID)=0
"RTN","OOPSGUI9",34,0)
 ..S WP=1
"RTN","OOPSGUI9",35,0)
 ..Q
"RTN","OOPSGUI9",36,0)
 .I PCE'=0  I $P($G(^OOPS(2260,IEN,NODE)),U,PCE)="" S (BADFLD,VALID)=0
"RTN","OOPSGUI9",37,0)
 .I 'BADFLD D  ; Display error messaged about fields not filled.
"RTN","OOPSGUI9",38,0)
 ..I 'CHK S RESULTS(1)="The following fields must be completed before the  "_FORM_" can be signed." S CHK=1
"RTN","OOPSGUI9",39,0)
 ..I WP D  ;Is this a wp field and where to get title
"RTN","OOPSGUI9",40,0)
 ...N NODE
"RTN","OOPSGUI9",41,0)
 ...S NODE=2260_".0"_FLD
"RTN","OOPSGUI9",42,0)
 ...; patch 11 - fix bug on fld 40, node '= 2260.040, it's 2260.01
"RTN","OOPSGUI9",43,0)
 ...I FLD=40 S NODE="2260.01"
"RTN","OOPSGUI9",44,0)
 ...S TEXT=$$GET1^DID(NODE,".01","","LABEL")
"RTN","OOPSGUI9",45,0)
 ...Q
"RTN","OOPSGUI9",46,0)
 ..I 'WP S TEXT=$$GET1^DID(2260,FLD,"","LABEL")
"RTN","OOPSGUI9",47,0)
 ..S RESULTS(CN)=TEXT,CN=CN+1
"RTN","OOPSGUI9",48,0)
 ..Q
"RTN","OOPSGUI9",49,0)
 .Q
"RTN","OOPSGUI9",50,0)
 ; removed !($G(WCEMP)) which indicates validation coming from WC 
"RTN","OOPSGUI9",51,0)
 ; completing the employee portion of the CA1.  May need to figure
"RTN","OOPSGUI9",52,0)
 ; something else out. 10/24/01 llh
"RTN","OOPSGUI9",53,0)
 I FORM="CA1"&(CALLER="E") D   ; fld 110 check on Emp CA1 only
"RTN","OOPSGUI9",54,0)
 . I $$GET1^DIQ(2260,IEN,110,"I")<($$GET1^DIQ(2260,IEN,4,"I")\1) S VALID=0 D
"RTN","OOPSGUI9",55,0)
 .. S RESULTS(CN)=$$GET1^DID(2260,110,"","LABEL")_" must be on or after the "_$$GET1^DID(2260,4,"","LABEL"),CN=CN+1
"RTN","OOPSGUI9",56,0)
DTCHK ; Date error checking that may be missed w/input transform
"RTN","OOPSGUI9",57,0)
 ; patch 11 - Additional error checking has been added for CA2 field 214
"RTN","OOPSGUI9",58,0)
 ; removed $G(WCEMP) from line below. same concern as above 10/24/01 llh
"RTN","OOPSGUI9",59,0)
 I FORM=2162!(CALLER="O") Q
"RTN","OOPSGUI9",60,0)
 K CNT,FLD,LIST
"RTN","OOPSGUI9",61,0)
 N DATE,DATE1,DATE2,TITLE,EMPDOB
"RTN","OOPSGUI9",62,0)
 ; patch 11 - need to make sure 215 not before 214 on employee part
"RTN","OOPSGUI9",63,0)
 I CALLER="E",FORM="CA2" D  Q
"RTN","OOPSGUI9",64,0)
 . S DATE1=$$GET1^DIQ(2260,IEN,215,"I")
"RTN","OOPSGUI9",65,0)
 . S DATE2=$$GET1^DIQ(2260,IEN,214,"I")
"RTN","OOPSGUI9",66,0)
 . S EMPDOB=$$GET1^DIQ(2260,IEN,6,"I")
"RTN","OOPSGUI9",67,0)
 . I $$FMDIFF^XLFDT(DATE2,EMPDOB,2)<0 S VALID=0 D
"RTN","OOPSGUI9",68,0)
 .. S RESULTS(CN)=$$GET1^DID(2260,214,"","LABEL")_" must be on or after the "_$$GET1^DID(2260,6,"","LABEL"),CN=CN+1
"RTN","OOPSGUI9",69,0)
 . I $$FMDIFF^XLFDT(DATE1,DATE2,2)<0 S VALID=0 D
"RTN","OOPSGUI9",70,0)
 .. S RESULTS(CN)=$$GET1^DID(2260,215,"","LABEL")_" must be on or after the "_$$GET1^DID(2260,214,"","LABEL"),CN=CN+1
"RTN","OOPSGUI9",71,0)
 ; End of checks from Employee CA2
"RTN","OOPSGUI9",72,0)
 I FORM="CA1" D
"RTN","OOPSGUI9",73,0)
 . S LIST="142,161,175"
"RTN","OOPSGUI9",74,0)
 . S (DATE,DATE1)=$$GET1^DIQ(2260,IEN,4,"I")
"RTN","OOPSGUI9",75,0)
 . S TITLE=$$GET1^DID(2260,4,"","LABEL")
"RTN","OOPSGUI9",76,0)
 I FORM="CA2" D
"RTN","OOPSGUI9",77,0)
 . S LIST="215,250,252,253,255"
"RTN","OOPSGUI9",78,0)
 . S (DATE,DATE1)=$$GET1^DIQ(2260,IEN,214,"I")
"RTN","OOPSGUI9",79,0)
 . S TITLE=$$GET1^DID(2260,214,"","LABEL")
"RTN","OOPSGUI9",80,0)
 F CNT=1:1 S FLD=$P(LIST,",",CNT) Q:FLD=""  D
"RTN","OOPSGUI9",81,0)
 . S DATE2=$$GET1^DIQ(2260,IEN,FLD,"I") I FLD'=142 S DATE2=DATE2\1,DATE1=DATE\1
"RTN","OOPSGUI9",82,0)
 . I $G(DATE2),DATE2<DATE1 D  S VALID=0
"RTN","OOPSGUI9",83,0)
 .. S RESULTS(CN)=$$GET1^DID(2260,FLD,"","LABEL")_" must be on or after the "_TITLE,CN=CN+1
"RTN","OOPSGUI9",84,0)
 ; Need specific check on DATE/TIME STOPPED WORK
"RTN","OOPSGUI9",85,0)
 I FORM="CA1" D
"RTN","OOPSGUI9",86,0)
 . S LIST="143,144,145",DATE=$$GET1^DIQ(2260,IEN,142,"I")
"RTN","OOPSGUI9",87,0)
 . S TITLE=$$GET1^DID(2260,142,"","LABEL")
"RTN","OOPSGUI9",88,0)
 I FORM="CA2" D
"RTN","OOPSGUI9",89,0)
 . S LIST="254,256",DATE=$$GET1^DIQ(2260,IEN,253,"I")
"RTN","OOPSGUI9",90,0)
 . S TITLE=$$GET1^DID(2260,253,"","LABEL")
"RTN","OOPSGUI9",91,0)
 F CNT=1:1 S FLD=$P(LIST,",",CNT) Q:FLD=""  D
"RTN","OOPSGUI9",92,0)
 . S DATE2=$$GET1^DIQ(2260,IEN,FLD,"I"),DATE1=DATE D
"RTN","OOPSGUI9",93,0)
 .. I FLD=143!(FLD=144) S DATE1=DATE\1,DATE2=DATE2\1
"RTN","OOPSGUI9",94,0)
 .. I (DATE1>DATE2),$G(DATE2) D  S VALID=0
"RTN","OOPSGUI9",95,0)
 ... S RESULTS(CN)=$$GET1^DID(2260,FLD,"","LABEL")_" must be on or after the "_TITLE,CN=CN+1
"RTN","OOPSGUI9",96,0)
 .. I '$G(DATE1),$G(DATE2) D  S VALID=0
"RTN","OOPSGUI9",97,0)
 ... S RESULTS(CN)=TITLE_" cannot be blank if date in "_$$GET1^DID(2260,FLD,"","LABEL"),CN=CN+1
"RTN","OOPSGUI9",98,0)
 Q
"RTN","OOPSGUI9",99,0)
EMP ; Address fields are now all pulled from the 2162A node
"RTN","OOPSGUI9",100,0)
 ; added fields 126 & 181,183-185 to lists below - patch 8
"RTN","OOPSGUI9",101,0)
 I FORM="CA1" S LIST="8,9,10,11,12,108,109,110,111,112,113,114,126,181,183,184,185"
"RTN","OOPSGUI9",102,0)
 ; added field 213 -  ASISTS V2.0
"RTN","OOPSGUI9",103,0)
 I FORM="CA2" S LIST="8,9,10,11,12,126,208,209,213,214,215,216,217"
"RTN","OOPSGUI9",104,0)
 Q
"RTN","OOPSGUI9",105,0)
SUP ;
"RTN","OOPSGUI9",106,0)
 N F165
"RTN","OOPSGUI9",107,0)
 I FORM="2162" D F2162 Q
"RTN","OOPSGUI9",108,0)
 S LIST="30,"
"RTN","OOPSGUI9",109,0)
 I FORM="CA1" D
"RTN","OOPSGUI9",110,0)
 . S LIST=LIST_"4,60,130,131,132,133,134,138,139,140,146,148,150,"
"RTN","OOPSGUI9",111,0)
 . S LIST=LIST_"162,163,172,173,174,175,176,177,178,179,"
"RTN","OOPSGUI9",112,0)
 . S LIST=LIST_"180,181,183,184,185,"
"RTN","OOPSGUI9",113,0)
 . I $$GET1^DIQ(2260,IEN,150,"I")="Y" S LIST=LIST_"151,152,153,154,155,"
"RTN","OOPSGUI9",114,0)
 . ; V2.0 added required fields missed in patch 8
"RTN","OOPSGUI9",115,0)
 . I $$GET1^DIQ(2260,IEN,146)="No" S LIST=LIST_"147,"
"RTN","OOPSGUI9",116,0)
 . I $$GET1^DIQ(2260,IEN,148)="Yes" S LIST=LIST_"149,"
"RTN","OOPSGUI9",117,0)
 . I $$GET1^DIQ(2260,IEN,163)="No" S LIST=LIST_"164,"
"RTN","OOPSGUI9",118,0)
 . S F165=$G(^OOPS(2260,IEN,"CA1K",0))
"RTN","OOPSGUI9",119,0)
 . I $G(F165)'="",($P(F165,U,4)'=0) S LIST=LIST_"165,"
"RTN","OOPSGUI9",120,0)
 I FORM="CA2" D
"RTN","OOPSGUI9",121,0)
 . S LIST=LIST_"230,231,232,233,234,237,238,239,240,241,"
"RTN","OOPSGUI9",122,0)
 . S LIST=LIST_"242,243,244,251,252,255,258,60,268,269,"
"RTN","OOPSGUI9",123,0)
 . ; below for ASISTS V2.0, needed for roll and scroll also
"RTN","OOPSGUI9",124,0)
 . ; added next line, need to get 3rd party if 258 = y
"RTN","OOPSGUI9",125,0)
 . I $$GET1^DIQ(2260,IEN,258,"I")="Y" S LIST=LIST_"259,260,261,262,263,"
"RTN","OOPSGUI9",126,0)
 ; V2.0 if field 60="other" (3)  then 61 required for both CA1 & CA2
"RTN","OOPSGUI9",127,0)
 I $$GET1^DIQ(2260,IEN,60,"I")=3 S LIST=LIST_"61,"
"RTN","OOPSGUI9",128,0)
 ; need to check Physician information for both CA1 and CA2
"RTN","OOPSGUI9",129,0)
 D PHYCHK
"RTN","OOPSGUI9",130,0)
 Q
"RTN","OOPSGUI9",131,0)
PHYCHK ; checks physician fields for appropriate form.  If Phy Name not
"RTN","OOPSGUI9",132,0)
 ; blank address fields required.  If Phy Name blank and data in any
"RTN","OOPSGUI9",133,0)
 ; address field then all fields required.
"RTN","OOPSGUI9",134,0)
 N CTR,FLD,PHY,PLIST,NBLK
"RTN","OOPSGUI9",135,0)
 S NBLK="",PHY=$S(FORM="CA1":156,FORM="CA2":245,1:"")
"RTN","OOPSGUI9",136,0)
 I 'PHY Q
"RTN","OOPSGUI9",137,0)
 S PLIST=$S(PHY=156:"157,158,159,160,182",PHY=245:"246,247,248,249,270",1:"")
"RTN","OOPSGUI9",138,0)
 I PLIST="" Q
"RTN","OOPSGUI9",139,0)
 I PHY=156 D  Q
"RTN","OOPSGUI9",140,0)
 . I $$GET1^DIQ(2260,IEN,156)'="" D  Q
"RTN","OOPSGUI9",141,0)
 .. F CTR=1:1 S FLD=$P(PLIST,",",CTR) Q:FLD=""  I $$GET1^DIQ(2260,IEN,FLD)="" S LIST=LIST_FLD_","
"RTN","OOPSGUI9",142,0)
 . I $$GET1^DIQ(2260,IEN,156)="" D  Q
"RTN","OOPSGUI9",143,0)
 .. F CTR=1:1 S FLD=$P(PLIST,",",CTR) Q:FLD=""  I $$GET1^DIQ(2260,IEN,FLD)'="" S NBLK=NBLK_FLD_","
"RTN","OOPSGUI9",144,0)
 .. I $G(NBLK)'="" S LIST=LIST_"156," F CTR=1:1 S FLD=$P(PLIST,",",CTR) Q:FLD=""  I '$F(NBLK,FLD) S LIST=LIST_FLD_","
"RTN","OOPSGUI9",145,0)
 I PHY=245 D  Q
"RTN","OOPSGUI9",146,0)
 . I $$GET1^DIQ(2260,IEN,245)'="" D  Q
"RTN","OOPSGUI9",147,0)
 .. F CTR=1:1 S FLD=$P(PLIST,",",CTR) Q:FLD=""  I $$GET1^DIQ(2260,IEN,FLD)="" S LIST=LIST_FLD_","
"RTN","OOPSGUI9",148,0)
 . I $$GET1^DIQ(2260,IEN,245)="" D
"RTN","OOPSGUI9",149,0)
 .. F CTR=1:1 S FLD=$P(PLIST,",",CTR) Q:FLD=""  I $$GET1^DIQ(2260,IEN,FLD)'="" S NBLK=NBLK_FLD_","
"RTN","OOPSGUI9",150,0)
 .. I $G(NBLK)'="" S LIST=LIST_"245," F CTR=1:1 S FLD=$P(PLIST,",",CTR) Q:FLD=""  I '$F(NBLK,FLD) S LIST=LIST_FLD_","
"RTN","OOPSGUI9",151,0)
 Q
"RTN","OOPSGUI9",152,0)
SOF ; the call to F2162 here is overkill.  All these fields should
"RTN","OOPSGUI9",153,0)
 ; already be completed, but just in case...
"RTN","OOPSGUI9",154,0)
 I FORM="2162" D F2162 S LIST=LIST_",55,88,89"
"RTN","OOPSGUI9",155,0)
 I $$ISEMP^OOPSUTL4(IEN) D
"RTN","OOPSGUI9",156,0)
 .S LIST=LIST_",33"
"RTN","OOPSGUI9",157,0)
 .I $$GET1^DIQ(2260,IEN,33)="N" S LIST=LIST_",32"
"RTN","OOPSGUI9",158,0)
 Q
"RTN","OOPSGUI9",159,0)
WCP ; Get required fields for Workers Comp
"RTN","OOPSGUI9",160,0)
 I FORM="2162" D F2162 Q
"RTN","OOPSGUI9",161,0)
 S LIST="5,6,7,15,62,70,73,"
"RTN","OOPSGUI9",162,0)
 I FORM="CA1" D
"RTN","OOPSGUI9",163,0)
 . S LIST=LIST_"123,124,"
"RTN","OOPSGUI9",164,0)
 . ; flds 166 & 167 only required if personnel status = 1
"RTN","OOPSGUI9",165,0)
 . I $$GET1^DIQ(2260,IEN,2,"I")=1 S LIST=LIST_"166,167,"
"RTN","OOPSGUI9",166,0)
 I FORM="CA2" D
"RTN","OOPSGUI9",167,0)
 . S LIST=LIST_"226,227,"
"RTN","OOPSGUI9",168,0)
 D SUP
"RTN","OOPSGUI9",169,0)
 Q
"RTN","OOPSGUI9",170,0)
F2162 ; Set required fields for form 2162
"RTN","OOPSGUI9",171,0)
 N TYP,SAF,INCID
"RTN","OOPSGUI9",172,0)
 I FORM'="2162" Q
"RTN","OOPSGUI9",173,0)
 S LIST="26,27,28,29,30,31"
"RTN","OOPSGUI9",174,0)
 S TYP=$$GET1^DIQ(2260,IEN,"3:.01","E")
"RTN","OOPSGUI9",175,0)
 I "^Sharps Exposure^Hollow Bore Needlestick^Suture Needlestick^"[TYP D
"RTN","OOPSGUI9",176,0)
 . S LIST=LIST_",34,35,36,37,38,82"
"RTN","OOPSGUI9",177,0)
 I $$GET1^DIQ(2260,IEN,"38:2","I")="N" S LIST=LIST_",83"
"RTN","OOPSGUI9",178,0)
 I "^Exposure to Body Fluids/Splash^"[TYP D
"RTN","OOPSGUI9",179,0)
 . S LIST=LIST_",34,39,40,41"
"RTN","OOPSGUI9",180,0)
 S INCID=$$GET1^DIQ(2260,IEN,3,"I")
"RTN","OOPSGUI9",181,0)
 I (INCID<11)!(INCID>14) Q
"RTN","OOPSGUI9",182,0)
 I $$GET1^DIQ(2260,IEN,42.5,"I")="Y" S LIST=LIST_",42"
"RTN","OOPSGUI9",183,0)
 S SAF=$$GET1^DIQ(2260,IEN,43,"I")
"RTN","OOPSGUI9",184,0)
 S LIST=$S(SAF="Y":LIST_",84,87",SAF="N":LIST_",85",1:LIST)
"RTN","OOPSGUI9",185,0)
 S LIST=LIST_",47"
"RTN","OOPSGUI9",186,0)
 Q
"RTN","OOPSGUIF")
0^1^B22360092
"RTN","OOPSGUIF",1,0)
OOPSGUIF ;WIOFO/LLH-RPC routine for OSHA Log ;11/5/01
"RTN","OOPSGUIF",2,0)
 ;;2.0;ASISTS;**6**;Jun 03, 2002
"RTN","OOPSGUIF",3,0)
 ;
"RTN","OOPSGUIF",4,0)
OSHA(RESULTS,INPUT,CALL) ; get the data
"RTN","OOPSGUIF",5,0)
 ;   Input:  INPUT - contains 4 values, the START AND END DATE, 
"RTN","OOPSGUIF",6,0)
 ;                   STATION, and INCLUDE NAME ON REPORT.  The Date of
"RTN","OOPSGUIF",7,0)
 ;                   Occ (fld #4) is used to in/exclude claims from the
"RTN","OOPSGUIF",8,0)
 ;                   report.  If Include name = Y, then names are
"RTN","OOPSGUIF",9,0)
 ;                   printed, else they will not,and if Station='ALL'
"RTN","OOPSGUIF",10,0)
 ;                   then all claims are included, if not 'All', then
"RTN","OOPSGUIF",11,0)
 ;                   only 1 station is included.
"RTN","OOPSGUIF",12,0)
 ;            CALL - Contains the calling menu.  If caller = "U"nion
"RTN","OOPSGUIF",13,0)
 ;                   name is excluded from printing.
"RTN","OOPSGUIF",14,0)
 ; Output: RESULTS - the results array passes data back to the client.
"RTN","OOPSGUIF",15,0)
 N CN,DA,IEN,INCNA,OCC,OOPS,PERSON,SDATE,STDT,STA,ENDDT,EDATE,X,Y
"RTN","OOPSGUIF",16,0)
 N GONE,LOST,DOI,CAX,FILL
"RTN","OOPSGUIF",17,0)
 K ^TMP($J,"OSHA")
"RTN","OOPSGUIF",18,0)
 S CN=1,RESULTS(0)="Processing..."
"RTN","OOPSGUIF",19,0)
 S STDT=$P($G(INPUT),U),ENDDT=$P($G(INPUT),U,2)
"RTN","OOPSGUIF",20,0)
 S STA=$P($G(INPUT),U,3)
"RTN","OOPSGUIF",21,0)
 S INCNA=$P($G(INPUT),U,4)
"RTN","OOPSGUIF",22,0)
 I (STDT="")!(ENDDT="")!(STA="")!(INCNA="") D  Q
"RTN","OOPSGUIF",23,0)
 . S RESULTS(0)="Input parameters missing, cannot run report." Q
"RTN","OOPSGUIF",24,0)
 S (SDATE,EDATE)=""
"RTN","OOPSGUIF",25,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIF",26,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIF",27,0)
 ; SDATE made last time in day prior so start date correct
"RTN","OOPSGUIF",28,0)
 S SDATE=(SDATE-1)_".9999",EDATE=EDATE_".9999"
"RTN","OOPSGUIF",29,0)
 S LP="",IEN=""
"RTN","OOPSGUIF",30,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIF",31,0)
 . F  S IEN=$O(^OOPS(2260,"AD",LP,IEN)) Q:IEN'>0  D
"RTN","OOPSGUIF",32,0)
 .. I $$GET1^DIQ(2260,IEN,88,"I")'="Y" Q
"RTN","OOPSGUIF",33,0)
 .. I $$GET1^DIQ(2260,IEN,51,"I")>1 Q
"RTN","OOPSGUIF",34,0)
 .. S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9)
"RTN","OOPSGUIF",35,0)
 .. I $G(STA)'="A",(STATION'=STA) Q
"RTN","OOPSGUIF",36,0)
 .. K OOPS,ARR S DIC="^OOPS(2260,"
"RTN","OOPSGUIF",37,0)
 .. S DR=".01;1;3;4;15;30;33;52;63;86;89"
"RTN","OOPSGUIF",38,0)
 .. S DA=IEN,DIQ="OOPS",DIQ(0)="IE" D EN^DIQ1
"RTN","OOPSGUIF",39,0)
 .. S CAX=OOPS(2260,IEN,52,"I")
"RTN","OOPSGUIF",40,0)
 .. S DOI=OOPS(2260,IEN,4,"I"),DOI=$P($$FMTE^XLFDT(DOI,2),"@")
"RTN","OOPSGUIF",41,0)
 .. ; PER A. BIERENBAUM, GET OCC DESC 5/13/02
"RTN","OOPSGUIF",42,0)
 .. S OCC=$$OCCDESC(IEN)
"RTN","OOPSGUIF",43,0)
 .. ; S OCC=OOPS(2260,IEN,63,"E")_$E(OOPS(2260,IEN,15,"E"),1,4)
"RTN","OOPSGUIF",44,0)
 .. S GONE=OOPS(2260,IEN,89,"I"),GONE=$S(GONE="Y":"X",1:"")
"RTN","OOPSGUIF",45,0)
 .. S LOST=OOPS(2260,IEN,33,"I")
"RTN","OOPSGUIF",46,0)
 .. S LOST=$S(LOST="Y":"X^",LOST="N":"^X",1:"^X")
"RTN","OOPSGUIF",47,0)
 .. S PERSON=OOPS(2260,IEN,1,"E") I CALL="Union"!(INCNA="N") S PERSON=""
"RTN","OOPSGUIF",48,0)
 .. S ARR=OOPS(2260,IEN,.01,"E")_U_DOI_U
"RTN","OOPSGUIF",49,0)
 .. S ARR=ARR_PERSON_U_OCC_U_$E(OOPS(2260,IEN,86,"E"),1,35)_U
"RTN","OOPSGUIF",50,0)
 .. S ARR=ARR_OOPS(2260,IEN,3,"E")_U_OOPS(2260,IEN,30,"E")_U
"RTN","OOPSGUIF",51,0)
 .. S FILL="" I CAX=2 S FILL="^^^"
"RTN","OOPSGUIF",52,0)
 .. S ARR=ARR_FILL_GONE_U_LOST
"RTN","OOPSGUIF",53,0)
 .. S ^TMP($J,"OSHA",CN)=ARR,CN=CN+1
"RTN","OOPSGUIF",54,0)
 S RESULTS=$NA(^TMP($J,"OSHA"))
"RTN","OOPSGUIF",55,0)
 Q
"RTN","OOPSGUIF",56,0)
NSTICK(RESULTS,INPUT,CALL) ; NeedleStick Log get data logic
"RTN","OOPSGUIF",57,0)
 ;   Input:  INPUT - contains 4 values, the START DATE, END DATE, 
"RTN","OOPSGUIF",58,0)
 ;                   STATION, and INCLUDE NAME ON REPORT.  The Date of
"RTN","OOPSGUIF",59,0)
 ;                   Occurrence (field #4) will be used to include/
"RTN","OOPSGUIF",60,0)
 ;                   exclude claims from the report.  If the Include
"RTN","OOPSGUIF",61,0)
 ;                   name is = Y then the names will be printed, if no
"RTN","OOPSGUIF",62,0)
 ;                   they will not, and if the Station = 'ALL' then any
"RTN","OOPSGUIF",63,0)
 ;                   claim will be include, if not 'All', but the
"RTN","OOPSGUIF",64,0)
 ;                   station number then only 1 station is included.
"RTN","OOPSGUIF",65,0)
 ;            CALL - Contains the calling menu.  This will be used
"RTN","OOPSGUIF",66,0)
 ;                   to exclude the name from printing if the caller
"RTN","OOPSGUIF",67,0)
 ;                   is 'U'nion.
"RTN","OOPSGUIF",68,0)
 ; Output: RESULTS - the results array passes the data back to the
"RTN","OOPSGUIF",69,0)
 ;                   client.
"RTN","OOPSGUIF",70,0)
 N CN,DA,IEN,INCNA,OCC,PERSON,SDATE,STDT,STA,ENDDT,EDATE,X,Y
"RTN","OOPSGUIF",71,0)
 N LOST,DOI,OOPS,TYPE
"RTN","OOPSGUIF",72,0)
 K ^TMP($J,"NS")
"RTN","OOPSGUIF",73,0)
 S CN=1,RESULTS(0)="Processing..."
"RTN","OOPSGUIF",74,0)
 S STDT=$P($G(INPUT),U),ENDDT=$P($G(INPUT),U,2)
"RTN","OOPSGUIF",75,0)
 S STA=$P($G(INPUT),U,3)
"RTN","OOPSGUIF",76,0)
 S INCNA=$P($G(INPUT),U,4)
"RTN","OOPSGUIF",77,0)
 I (STDT="")!(ENDDT="")!(STA="")!(INCNA="") D  Q
"RTN","OOPSGUIF",78,0)
 . S RESULTS(0)="Input parameters missing, cannot run report." Q
"RTN","OOPSGUIF",79,0)
 S (SDATE,EDATE)=""
"RTN","OOPSGUIF",80,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIF",81,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIF",82,0)
 ; SDATE made last time in day prior so start date correct
"RTN","OOPSGUIF",83,0)
 S SDATE=(SDATE-1)_".9999",EDATE=EDATE_".9999"
"RTN","OOPSGUIF",84,0)
 S LP="",IEN=""
"RTN","OOPSGUIF",85,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIF",86,0)
 . F  S IEN=$O(^OOPS(2260,"AD",LP,IEN)) Q:IEN'>0  D
"RTN","OOPSGUIF",87,0)
 .. ; exclude deleted, replaced by amendment cases
"RTN","OOPSGUIF",88,0)
 .. I $$GET1^DIQ(2260,IEN,51,"I")>1 Q
"RTN","OOPSGUIF",89,0)
 .. S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9)
"RTN","OOPSGUIF",90,0)
 .. I $G(STA)'="A",(STATION'=STA) Q
"RTN","OOPSGUIF",91,0)
 .. ; if Type Incident not = Hollow Bore Needlestick, Sharps Exposure,
"RTN","OOPSGUIF",92,0)
 .. ; Exposure to Body Fluids/Splash, Suture Needlestick don't include
"RTN","OOPSGUIF",93,0)
 .. S TYPE=$$GET1^DIQ(2260,IEN,3,"I")
"RTN","OOPSGUIF",94,0)
 .. I TYPE<11!(TYPE>14) Q
"RTN","OOPSGUIF",95,0)
 .. ; now get the data and put in array.
"RTN","OOPSGUIF",96,0)
 .. K OOPS,ARR S DIC="^OOPS(2260,"
"RTN","OOPSGUIF",97,0)
 .. S DR=".01;1;3;4;15;14;29;30;33;37;38;51;52;82;86;108"
"RTN","OOPSGUIF",98,0)
 .. S DA=IEN,DIQ="OOPS",DIQ(0)="IE" D EN^DIQ1
"RTN","OOPSGUIF",99,0)
 .. S DOI=OOPS(2260,IEN,4,"E")
"RTN","OOPSGUIF",100,0)
 .. ; PER A. BIERENBAUM, USE OCC DESC 5/13/02
"RTN","OOPSGUIF",101,0)
 .. S OCC=$$OCCDESC(IEN)
"RTN","OOPSGUIF",102,0)
 .. ; S OCC=$E(OOPS(2260,IEN,15,"E"),1,4)
"RTN","OOPSGUIF",103,0)
 .. S LOST=OOPS(2260,IEN,33,"E")
"RTN","OOPSGUIF",104,0)
 .. S INJILL=OOPS(2260,IEN,52,"I")
"RTN","OOPSGUIF",105,0)
 .. S INJILL=$S(INJILL=1:"Injury",INJILL=2:"Illness",1:"")
"RTN","OOPSGUIF",106,0)
 .. S PERSON=OOPS(2260,IEN,1,"E") I CALL="Union"!(INCNA="N") S PERSON=""
"RTN","OOPSGUIF",107,0)
 .. S ARR=IEN_U_OOPS(2260,IEN,.01,"E")_U_DOI_U_PERSON_U_INJILL_U
"RTN","OOPSGUIF",108,0)
 .. S ARR=ARR_OOPS(2260,IEN,51,"E")_U_OCC_U_$E(OOPS(2260,DA,14,"E"),1,4)
"RTN","OOPSGUIF",109,0)
 .. S ARR=ARR_U_LOST_U_OOPS(2260,IEN,86,"E")_U
"RTN","OOPSGUIF",110,0)
 .. S ARR=ARR_OOPS(2260,IEN,3,"E")_U_OOPS(2260,IEN,108,"E")
"RTN","OOPSGUIF",111,0)
 .. S ARR=ARR_U_OOPS(2260,IEN,30,"E")_U_$E(OOPS(2260,IEN,29,"E"),1,45)_U
"RTN","OOPSGUIF",112,0)
 .. S ARR=ARR_$E(OOPS(2260,IEN,37,"E"),1,50)_U
"RTN","OOPSGUIF",113,0)
 .. S ARR=ARR_$E(OOPS(2260,IEN,38,"E"),1,50)_U_OOPS(2260,IEN,82,"E")
"RTN","OOPSGUIF",114,0)
 .. S ^TMP($J,"NS",CN)=ARR K ARR
"RTN","OOPSGUIF",115,0)
 .. S CN=CN+1
"RTN","OOPSGUIF",116,0)
 S RESULTS=$NA(^TMP($J,"NS"))
"RTN","OOPSGUIF",117,0)
 Q
"RTN","OOPSGUIF",118,0)
OCCDESC(IEN) ;Get Occupation Description
"RTN","OOPSGUIF",119,0)
 ;
"RTN","OOPSGUIF",120,0)
 ;  Input:  IEN - IEN of the ASISTS Case number to get the Occ Desc
"RTN","OOPSGUIF",121,0)
 ; Output:      - will be the Occupation description
"RTN","OOPSGUIF",122,0)
 ;
"RTN","OOPSGUIF",123,0)
 N INC,FLD
"RTN","OOPSGUIF",124,0)
 S INC=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUIF",125,0)
 S FLD=$S(INC=1:111,INC=2:208,1:"")
"RTN","OOPSGUIF",126,0)
 I 'FLD Q ""
"RTN","OOPSGUIF",127,0)
 Q $$GET1^DIQ(2260,IEN,FLD)
"VER")
8.0^22.0
**END**
**END**
