Released XU*8*124 SEQ #111
Extracted from mail message
**KIDS**:XU*8.0*124^

**INSTALL NAME**
XU*8.0*124
"BLD",178,0)
XU*8.0*124^KERNEL^0^2990805^y
"BLD",178,4,0)
^9.64PA^^
"BLD",178,"KRN",0)
^9.67PA^19^18
"BLD",178,"KRN",.4,0)
.4
"BLD",178,"KRN",.401,0)
.401
"BLD",178,"KRN",.402,0)
.402
"BLD",178,"KRN",.403,0)
.403
"BLD",178,"KRN",.5,0)
.5
"BLD",178,"KRN",.84,0)
.84
"BLD",178,"KRN",3.6,0)
3.6
"BLD",178,"KRN",3.8,0)
3.8
"BLD",178,"KRN",9.2,0)
9.2
"BLD",178,"KRN",9.8,0)
9.8
"BLD",178,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",178,"KRN",9.8,"NM",1,0)
XPDCOM^^0^B12356442
"BLD",178,"KRN",9.8,"NM",2,0)
XPDIJ^^0^B20572668
"BLD",178,"KRN",9.8,"NM",3,0)
XPDIK^^0^B39299249
"BLD",178,"KRN",9.8,"NM",4,0)
XPDTC^^0^B40664540
"BLD",178,"KRN",9.8,"NM","B","XPDCOM",1)

"BLD",178,"KRN",9.8,"NM","B","XPDIJ",2)

"BLD",178,"KRN",9.8,"NM","B","XPDIK",3)

"BLD",178,"KRN",9.8,"NM","B","XPDTC",4)

"BLD",178,"KRN",19,0)
19
"BLD",178,"KRN",19.1,0)
19.1
"BLD",178,"KRN",101,0)
101
"BLD",178,"KRN",409.61,0)
409.61
"BLD",178,"KRN",771,0)
771
"BLD",178,"KRN",869.2,0)
869.2
"BLD",178,"KRN",870,0)
870
"BLD",178,"KRN",8994,0)
8994
"BLD",178,"KRN","B",.4,.4)

"BLD",178,"KRN","B",.401,.401)

"BLD",178,"KRN","B",.402,.402)

"BLD",178,"KRN","B",.403,.403)

"BLD",178,"KRN","B",.5,.5)

"BLD",178,"KRN","B",.84,.84)

"BLD",178,"KRN","B",3.6,3.6)

"BLD",178,"KRN","B",3.8,3.8)

"BLD",178,"KRN","B",9.2,9.2)

"BLD",178,"KRN","B",9.8,9.8)

"BLD",178,"KRN","B",19,19)

"BLD",178,"KRN","B",19.1,19.1)

"BLD",178,"KRN","B",101,101)

"BLD",178,"KRN","B",409.61,409.61)

"BLD",178,"KRN","B",771,771)

"BLD",178,"KRN","B",869.2,869.2)

"BLD",178,"KRN","B",870,870)

"BLD",178,"KRN","B",8994,8994)

"BLD",178,"QUES",0)
^9.62^^
"BLD",178,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
124^2990805
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","XPDCOM")
0^1^B12356442
"RTN","XPDCOM",1,0)
XPDCOM ;SFISC/RSD - Compare Transport Global ;08/05/99  08:23
"RTN","XPDCOM",2,0)
 ;;8.0;KERNEL;**21,58,108,124**;Jul 10, 1995
"RTN","XPDCOM",3,0)
EN1 ;compare to current system
"RTN","XPDCOM",4,0)
 N DIC,DIR,DIRUT,POP,XPD,XPDA,XPDC,XPDNM,XPDT,XPDST,Y,Z,%ZIS
"RTN","XPDCOM",5,0)
 ;S DIC="^XPD(9.7,",DIC(0)="AEQMZ",DIC("S")="I '$P(^(0),U,9),$D(^XTMP(""XPDI"",Y))"
"RTN","XPDCOM",6,0)
 ;D ^DIC Q:Y<0  S XPDA=+Y,XPDNM=Y(0,0)
"RTN","XPDCOM",7,0)
 S XPDST=$$LOOK^XPDI1("I '$P(^(0),U,9),$D(^XTMP(""XPDI"",Y))",1) Q:XPDST'>0
"RTN","XPDCOM",8,0)
 S DIR(0)="S^1:Full Comparison;2:Second line of Routines only;3:Routines only",DIR("A")="Type of Compare",DIR("?")="Enter the type of comparison."
"RTN","XPDCOM",9,0)
 D ^DIR Q:$D(DTOUT)!$D(DUOUT)
"RTN","XPDCOM",10,0)
 ;S XPDC=Y,Y="COM^XPDCOM("_XPDA_")",Z="Transport Global Compare",XPD("XPDNM")="",XPD("XPDC")=""
"RTN","XPDCOM",11,0)
 S XPDC=Y,Y="JOB^XPDCOM",Z="Transport Global Compare",XPD("XPDNM")="",XPD("XPDC")="",XPD("XPDT(")=""
"RTN","XPDCOM",12,0)
 D EN^XUTMDEVQ(Y,Z,.XPD)
"RTN","XPDCOM",13,0)
 Q
"RTN","XPDCOM",14,0)
JOB ;Loop thru XPDT
"RTN","XPDCOM",15,0)
 N XPDIT
"RTN","XPDCOM",16,0)
 F XPDIT=0:0 S XPDIT=$O(XPDT(XPDIT)) Q:XPDIT'>0  D COM(+XPDT(XPDIT))
"RTN","XPDCOM",17,0)
 Q
"RTN","XPDCOM",18,0)
 ;
"RTN","XPDCOM",19,0)
COM(XPDA) ;XPDA=ien of package in ^XTMP("XPDI"
"RTN","XPDCOM",20,0)
 Q:'$D(^XTMP("XPDI",$G(XPDA)))
"RTN","XPDCOM",21,0)
 S:$D(XPDT("DA",XPDA)) XPDNM=$P(XPDT(+XPDT("DA",XPDA)),U,2)
"RTN","XPDCOM",22,0)
 D HDR,COMR(5),EN^XPDCOMG:XPDC=1
"RTN","XPDCOM",23,0)
 Q
"RTN","XPDCOM",24,0)
 ;compare routines
"RTN","XPDCOM",25,0)
COMR(NL) ;NL=number of lines to check ahead
"RTN","XPDCOM",26,0)
 N DL,XL,XPDI,X,XL,Y,YL
"RTN","XPDCOM",27,0)
 S:'$G(NL) NL=5 S XPDI=""
"RTN","XPDCOM",28,0)
 F  S XPDI=$O(^XTMP("XPDI",XPDA,"RTN",XPDI)) Q:XPDI=""  S X=$G(^(XPDI)) D
"RTN","XPDCOM",29,0)
 .I X W:X=1 !!,"DELETE Routine: ",XPDI,! Q
"RTN","XPDCOM",30,0)
 .S X=XPDI X ^%ZOSF("TEST") E  W !!,"ADD Routine: ",XPDI,! Q
"RTN","XPDCOM",31,0)
 .W !!," Routine: ",XPDI
"RTN","XPDCOM",32,0)
 .;check 2nd line only
"RTN","XPDCOM",33,0)
 .I XPDC=2 D  Q
"RTN","XPDCOM",34,0)
 ..S X=$G(^XTMP("XPDI",XPDA,"RTN",XPDI,2,0)),Y=$T(+2^@XPDI)
"RTN","XPDCOM",35,0)
 ..W !,"<TG> ",X,!,"<SYS>",Y Q:X=Y!(X'["**")
"RTN","XPDCOM",36,0)
 ..;check patch string
"RTN","XPDCOM",37,0)
 ..S X=$P(X,"**",2),XL=$L(X,","),Y=$P(Y,"**",2),YL=$L(Y,",")
"RTN","XPDCOM",38,0)
 ..Q:X=Y
"RTN","XPDCOM",39,0)
 ..;incoming has more patches than system, check for missing patches
"RTN","XPDCOM",40,0)
 ..I XL>YL W:$P(X,",",1,(XL-1))'=Y !,"*** WARNING, you are missing one or more Patches ***" Q
"RTN","XPDCOM",41,0)
 ..I YL>XL W !,"*** WARNING, your routine has more patches than the incoming routine ***" Q
"RTN","XPDCOM",42,0)
 .F %=1:1 Q:'$D(^XTMP("XPDI",XPDA,"RTN",XPDI,%))
"RTN","XPDCOM",43,0)
 .;XL=lines in routine in XTMP, DL=line in routine on disk
"RTN","XPDCOM",44,0)
 .S XL=%-1,DL=$$LD(XPDI)
"RTN","XPDCOM",45,0)
 .D COMP K ^TMP($J,XPDI)
"RTN","XPDCOM",46,0)
 Q
"RTN","XPDCOM",47,0)
COMP ;taken from XMPC routine
"RTN","XPDCOM",48,0)
 N D1,DI,I,J,K,X1,XI,Y1
"RTN","XPDCOM",49,0)
 S (XI,DI)=0
"RTN","XPDCOM",50,0)
 ;check each line in the incoming routine,X1, against the routine on disk,D1
"RTN","XPDCOM",51,0)
 F  S XI=XI+1,DI=DI+1 Q:XI>XL!(DI>DL)  D:^XTMP("XPDI",XPDA,"RTN",XPDI,XI,0)'=^TMP($J,XPDI,DI,0)
"RTN","XPDCOM",52,0)
 .S X1=^XTMP("XPDI",XPDA,"RTN",XPDI,XI,0),Y1=0
"RTN","XPDCOM",53,0)
 .;if lines are not the same, look ahead five lines in D1
"RTN","XPDCOM",54,0)
 .F I=DI:1:$S(DI+NL<DL:DI+NL,1:DL) S D1=^TMP($J,XPDI,I,0) D  Q:Y1
"RTN","XPDCOM",55,0)
 ..F K=1:5:26 Q:$L($E(D1,K,K+10))<7  I $F(X1,$E(D1,K,K+10))  D  Q
"RTN","XPDCOM",56,0)
 ...;print the lines upto the line that are the same
"RTN","XPDCOM",57,0)
 ...F J=DI:1:I-1 D WP(^TMP($J,XPDI,J,0),2)
"RTN","XPDCOM",58,0)
 ...;quit if the lines are equal
"RTN","XPDCOM",59,0)
 ...S DI=I,Y1=1 Q:D1=X1
"RTN","XPDCOM",60,0)
 ...;if lines are equal, print old and new
"RTN","XPDCOM",61,0)
 ...D WP(D1,3),WP(X1,4)
"RTN","XPDCOM",62,0)
 .Q:Y1  D WP(X1,1) S DI=DI-1
"RTN","XPDCOM",63,0)
 ;check remaining lines in routines
"RTN","XPDCOM",64,0)
 I XI>XL&(DI<(DL+1)) F I=DI:1:DL D WP(^TMP($J,XPDI,I,0),2)
"RTN","XPDCOM",65,0)
 I DI>DL&(XI<(XL+1)) F I=XI:1:XL D WP(^XTMP("XPDI",XPDA,"RTN",XPDI,I,0),1)
"RTN","XPDCOM",66,0)
 Q
"RTN","XPDCOM",67,0)
WP(X,Y) W !,"* "_$P("ADD^DEL^OLD^NEW",U,Y)_" *  ",X
"RTN","XPDCOM",68,0)
 Q
"RTN","XPDCOM",69,0)
 ;load system routine into TMP global
"RTN","XPDCOM",70,0)
LD(X) N %N,DIF,XCNP
"RTN","XPDCOM",71,0)
 K ^TMP($J,X)
"RTN","XPDCOM",72,0)
 S DIF="^TMP($J,X,",XCNP=0
"RTN","XPDCOM",73,0)
 X ^%ZOSF("LOAD")
"RTN","XPDCOM",74,0)
 Q %N-1
"RTN","XPDCOM",75,0)
 ;
"RTN","XPDCOM",76,0)
HDR S $P(XPDUL,"-",80)=""
"RTN","XPDCOM",77,0)
 W @IOF,"Compare ",XPDNM," to current site",!
"RTN","XPDCOM",78,0)
 I XPDC>1 W:XPDC=2 "2nd Line of " W "Routines Only",!
"RTN","XPDCOM",79,0)
 W XPDUL,!
"RTN","XPDCOM",80,0)
 Q
"RTN","XPDIJ")
0^2^B20572668
"RTN","XPDIJ",1,0)
XPDIJ ;SFISC/RSD - Install Job ;08/04/99  07:54
"RTN","XPDIJ",2,0)
 ;;8.0;KERNEL;**2,21,28,41,44,68,81,95,108,124**;Jul 10, 1995
"RTN","XPDIJ",3,0)
EN ;install all packages
"RTN","XPDIJ",4,0)
 ;XPDA=ien of first package
"RTN","XPDIJ",5,0)
 ;this is needed to restore XPDIJ1
"RTN","XPDIJ",6,0)
 D LNRF("XPDIJ1")
"RTN","XPDIJ",7,0)
 D LNRF("XPDIQ") ;Needed for patch 108
"RTN","XPDIJ",8,0)
 N IEN,XPDI,XPD0,XPDSET,XPDABORT,XPDMENU,XPDQUIT,XPDVOL,X,Y,ZTRTN,ZTDTH,ZTIO,ZTDESC,ZTSK
"RTN","XPDIJ",9,0)
 I $$NEWERR^%ZTER N $ETRAP,$ESTACK S $ETRAP="D ERR^XPDIJ"
"RTN","XPDIJ",10,0)
 E  S X="ERR^XPDIJ",@^%ZOSF("TRAP")
"RTN","XPDIJ",11,0)
 Q:'$D(^XPD(9.7,+$G(XPDA),0))  S XPD0=^(0)
"RTN","XPDIJ",12,0)
 D INIT^XPDID
"RTN","XPDIJ",13,0)
 ;See if need to Inhibit Logons
"RTN","XPDIJ",14,0)
 I $$ANSWER^XPDIQ("XPI1") D INHIBIT^XPDIJ1("Y")
"RTN","XPDIJ",15,0)
 ;disable options & protocols for setname, XPDSET=1/0^setname^out of order msg.
"RTN","XPDIJ",16,0)
 S Y=$P(XPD0,U,8),XPDSET=+Y_U_$E(Y,2,99)_U_$S($L(Y):$P($G(^XTMP("XQOO",$E(Y,2,99),0)),U),1:"")
"RTN","XPDIJ",17,0)
 ;hang the number of seconds given in 0;10
"RTN","XPDIJ",18,0)
 I XPDSET D OFF^XQOO1($P(XPDSET,U,2)) I $P(XPD0,U,10) H ($P(XPD0,U,10)*60)
"RTN","XPDIJ",19,0)
 S Y=0
"RTN","XPDIJ",20,0)
 ;XPDABORT can be set in pre or post install to abort install
"RTN","XPDIJ",21,0)
 F  S Y=$O(^XPD(9.7,"ASP",XPDA,Y)) Q:'Y  S %=$O(^(Y,0)) D:%  Q:$D(XPDABORT)
"RTN","XPDIJ",22,0)
 .N XPD,XPDA,XPDNM,XPDV,XPDV0,XPDVOL,XPDX,XPDY,Y
"RTN","XPDIJ",23,0)
 .;Now do the Install
"RTN","XPDIJ",24,0)
 .S XPDA=%,XPDNM=$P($G(^XPD(9.7,XPDA,0)),U) D IN^XPDIJ1 Q:$D(XPDABORT)
"RTN","XPDIJ",25,0)
 ;
"RTN","XPDIJ",26,0)
 ;Now do Master Build Post INIT.
"RTN","XPDIJ",27,0)
 I '$D(XPDABORT),$D(XPDT("MASTER")) D
"RTN","XPDIJ",28,0)
 .S XPDBLD=$O(^XTMP("XPDI",XPDA,"BLD",0))
"RTN","XPDIJ",29,0)
 .D POST^XPDIJ1
"RTN","XPDIJ",30,0)
 ;ZTREQ tells taskman to delete task
"RTN","XPDIJ",31,0)
 I $G(ZTSK) S ZTREQ="@" D
"RTN","XPDIJ",32,0)
 .;remove task # from Install File
"RTN","XPDIJ",33,0)
 .N XPD S XPD(9.7,XPDA_",",5)="@"
"RTN","XPDIJ",34,0)
 .D FILE^DIE("","XPD")
"RTN","XPDIJ",35,0)
 ;quit if install was aborted
"RTN","XPDIJ",36,0)
 I $D(XPDABORT) D EXIT^XPDID("Install Aborted!!"),^%ZISC Q
"RTN","XPDIJ",37,0)
 ;put option back in order
"RTN","XPDIJ",38,0)
 I $P(XPDSET,U,2)]"" D ON^XQOO1($P(XPDSET,U,2)) K ^XTMP("XQOO",$P(XPDSET,U,2))
"RTN","XPDIJ",39,0)
 ;check if menu rebuild is wanted (only if option has been added)
"RTN","XPDIJ",40,0)
 I $$ANSWER^XPDIQ("XPO1") D
"RTN","XPDIJ",41,0)
 .D BMES^XPDUTL(" Call MENU rebuild"),KIDS^XQ81
"RTN","XPDIJ",42,0)
 .;check if need to queue menu rebuild on other CPUs
"RTN","XPDIJ",43,0)
 .D:$O(^XPD(9.7,XPDA,"VOL",0))
"RTN","XPDIJ",44,0)
 ..N XPDU,XPDY,XPDV,XPDV0,ZTUCI,ZTCPU
"RTN","XPDIJ",45,0)
 ..X ^%ZOSF("UCI") S XPDU=$P(Y,","),XPDY=$P(Y,",",2),XPDV=0
"RTN","XPDIJ",46,0)
 ..;loop thru VOLUMES SET and don't do current volume set
"RTN","XPDIJ",47,0)
 ..F  S XPDV=$O(^XPD(9.7,XPDA,"VOL",XPDV)) Q:'XPDV  S XPDV0=$P(^(XPDV,0),U) D:XPDV0'=XPDY
"RTN","XPDIJ",48,0)
 ...S ZTUCI=XPDU,ZTDTH=$H,ZTIO="",ZTDESC="Install Menu Rebuild",ZTCPU=XPDV0,ZTRTN="KIDS^XQ81" D ^%ZTLOAD
"RTN","XPDIJ",49,0)
 ;
"RTN","XPDIJ",50,0)
 ;See if need to reset inhibit logons
"RTN","XPDIJ",51,0)
 I $$ANSWER^XPDIQ("XPI1") D INHIBIT^XPDIJ1("N")
"RTN","XPDIJ",52,0)
 ;
"RTN","XPDIJ",53,0)
 ;clean up globals
"RTN","XPDIJ",54,0)
 S Y=0
"RTN","XPDIJ",55,0)
 F  S Y=$O(^XPD(9.7,"ASP",XPDA,Y)) Q:'Y  S XPDI=$O(^(Y,0)) D:XPDI
"RTN","XPDIJ",56,0)
 . N %,Y,XPD,X
"RTN","XPDIJ",57,0)
 . ;See if need to delete Env,Pre,Post routines.
"RTN","XPDIJ",58,0)
 . S %=$O(^XTMP("XPDI",XPDI,"BLD",0)),XPD=$G(^XTMP("XPDI",XPDI,"BLD",%,"INID"))
"RTN","XPDIJ",59,0)
 . I '$$GET^XUPARAM("XPD NO_EPP_DELETE") F %=1:1:3 I $P(XPD,U,%)="y" D
"RTN","XPDIJ",60,0)
 . . S X=^XTMP("XPDI",XPDI,$P("PRE^INIT^INI",U,%)) S:X[U X=$P(X,U,2) X:X]"" ^%ZOSF("DEL")
"RTN","XPDIJ",61,0)
 . ;kill transport global
"RTN","XPDIJ",62,0)
 . K ^XTMP("XPDI",XPDI)
"RTN","XPDIJ",63,0)
 . ;update the status field
"RTN","XPDIJ",64,0)
 . S XPD(9.7,XPDI_",",.02)=3
"RTN","XPDIJ",65,0)
 . D FILE^DIE("","XPD")
"RTN","XPDIJ",66,0)
 D EXIT^XPDID("Install Completed"),^%ZISC
"RTN","XPDIJ",67,0)
 Q
"RTN","XPDIJ",68,0)
 ;
"RTN","XPDIJ",69,0)
SAVE(X) ;restore routine X
"RTN","XPDIJ",70,0)
 N %,DIE,XCM,XCN,XCS
"RTN","XPDIJ",71,0)
 S DIE="^XTMP(""XPDI"",XPDA,""RTN"",X,",XCN=0
"RTN","XPDIJ",72,0)
 X ^%ZOSF("SAVE")
"RTN","XPDIJ",73,0)
 Q
"RTN","XPDIJ",74,0)
RTN(XPDA) ;restore all routines for package XPDA
"RTN","XPDIJ",75,0)
 ;^XPD("XPDI",XPDA,"RTN",routine name)=0-install, 1-delete, 2-skip^checksum
"RTN","XPDIJ",76,0)
 Q:$G(XPDA)=""
"RTN","XPDIJ",77,0)
 N X,XPDI,XPDJ S XPDI=""
"RTN","XPDIJ",78,0)
 F  S XPDI=$O(^XTMP("XPDI",XPDA,"RTN",XPDI)) Q:XPDI=""  S XPDJ=^(XPDI) D
"RTN","XPDIJ",79,0)
 .;if we are doing VT graphic display, set counter
"RTN","XPDIJ",80,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+1 D:'(XPDIDCNT#XPDIDMOD) UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIJ",81,0)
 .I 'XPDJ D SAVE(XPDI) Q
"RTN","XPDIJ",82,0)
 .;set checksum to null, since routine wasn't loaded
"RTN","XPDIJ",83,0)
 .I $P(XPDJ,U,2) S $P(^XTMP("XPDI",XPDA,"BLD",XPDBLD,"KRN",9.8,"NM",$P(XPDJ,U,2),0),U,4)=""
"RTN","XPDIJ",84,0)
 .I $P(XPDJ,U)=1 S X=XPDI X ^%ZOSF("DEL")
"RTN","XPDIJ",85,0)
 ;if graphic display, update full count
"RTN","XPDIJ",86,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIJ",87,0)
 Q
"RTN","XPDIJ",88,0)
 ;
"RTN","XPDIJ",89,0)
VOLERR(V,F) ;volume set not updated,V=volume set, F=flag
"RTN","XPDIJ",90,0)
 N XQA,XQAMSG,XPDMES
"RTN","XPDIJ",91,0)
 S XPDMES(1)=" ",XPDMES(2)=" ** Job on VOLUME SET "_V_$S(F:" never started **",1:" has been idle for an hour.")
"RTN","XPDIJ",92,0)
 S XPDMES(3)=" ** "_V_" has NOT been updated! **"
"RTN","XPDIJ",93,0)
 S XQA(DUZ)="",XQAMSG="VOLUME SET "_V_" NOT updated for Install "_$E($P($G(^XPD(9.7,+$G(XPDA),0)),"^"),1,30)
"RTN","XPDIJ",94,0)
 D MES^XPDUTL(.XPDMES),SETUP^XQALERT
"RTN","XPDIJ",95,0)
 Q
"RTN","XPDIJ",96,0)
 ;come here on error, record error in Install file and cleanup var.
"RTN","XPDIJ",97,0)
ERR N XPDERROR,XQA,XQAMSG
"RTN","XPDIJ",98,0)
 S XPDERROR=$$EC^%ZOSV
"RTN","XPDIJ",99,0)
 ;record error, write message, reset terminal
"RTN","XPDIJ",100,0)
 D ^%ZTER,BMES^XPDUTL(XPDERROR),EXIT^XPDID()
"RTN","XPDIJ",101,0)
 S XQA(DUZ)="",XQAMSG="Install "_$E($P($G(^XPD(9.7,+$G(XPDA),0)),"^"),1,30)_" has encountered an Error."
"RTN","XPDIJ",102,0)
 D SETUP^XQALERT G UNWIND^%ZTER
"RTN","XPDIJ",103,0)
 ;
"RTN","XPDIJ",104,0)
LNRF(RN) ;Load needed routines first
"RTN","XPDIJ",105,0)
 I $D(^XTMP("XPDI",XPDA,"RTN",RN)) D
"RTN","XPDIJ",106,0)
 .N DIE,XCM,XCN,XCS,X
"RTN","XPDIJ",107,0)
 .S DIE="^XTMP(""XPDI"",XPDA,""RTN"",RN,",XCN=0,X=RN
"RTN","XPDIJ",108,0)
 .X ^%ZOSF("SAVE")
"RTN","XPDIJ",109,0)
 .S XCN=$$RTNUP^XPDUTL(RN,2)
"RTN","XPDIJ",110,0)
 Q
"RTN","XPDIK")
0^3^B39299249
"RTN","XPDIK",1,0)
XPDIK ;SFISC/RSD - Install Kernel Files & FM Files ;08/03/99  13:08
"RTN","XPDIK",2,0)
 ;;8.0;KERNEL;**15,58,108,124**;Jul 10, 1995
"RTN","XPDIK",3,0)
 Q
"RTN","XPDIK",4,0)
KRN ;
"RTN","XPDIK",5,0)
 ;XPDA=package ien in INSTALL FILE, XPDNM=package name, XPDCP= check points
"RTN","XPDIK",6,0)
 N DA,DIC,DIOVRD,EPOS,EPRE,FDEL,FPOS,FPRE,OLDA,ORD,X,XGCEDITR,XPDFIL,XPDFILNM,XPDFL,XPDNEW,XREF,Y,%
"RTN","XPDIK",7,0)
 ;DIOVRD is used to override write protection on a file
"RTN","XPDIK",8,0)
 ;XGCEDITR is check in file 8995, at 'SCR' node of DD
"RTN","XPDIK",9,0)
 S ORD=0,XPDCP="KRN",(DIOVRD,XGCEDITR)=1
"RTN","XPDIK",10,0)
 F  S ORD=$O(^XTMP("XPDI",XPDA,"ORD",ORD)) Q:'ORD  S XPDFIL=+$O(^(ORD,0)),XREF=$G(^(XPDFIL)),XPDFILNM=$G(^(XPDFIL,0)) D:XPDFIL
"RTN","XPDIK",11,0)
 .;sets up EPOS,EPRE,FDEL,FPOS,FPRE variables
"RTN","XPDIK",12,0)
 .F DA=1:1:5 S @$P("FPRE^EPRE^FPOS^EPOS^FDEL",U,DA)=$P(XREF,";",DA+5)
"RTN","XPDIK",13,0)
 .K DIC,^TMP($J,"XPDEL")
"RTN","XPDIK",14,0)
 .S DIC=$G(^DIC(XPDFIL,0,"GL")),XREF=+$P(XREF,";",3)
"RTN","XPDIK",15,0)
 .;check if file, XPDFIL, exist at this site
"RTN","XPDIK",16,0)
 .I $P($G(^DIC(XPDFIL,0)),U)'=XPDFILNM D BMES^XPDUTL(" File "_XPDFIL_" is not "_XPDFILNM_", nothing installed.") Q
"RTN","XPDIK",17,0)
 .;check if XPDFIL has already been installed
"RTN","XPDIK",18,0)
 .I $P(^XPD(9.7,XPDA,"KRN",XPDFIL,0),U,2) D BMES^XPDUTL(" "_XPDFILNM_" already installed.") Q
"RTN","XPDIK",19,0)
 .D BMES^XPDUTL(" Installing "_XPDFILNM),SETTOT^XPDID(XPDFIL)
"RTN","XPDIK",20,0)
 .;do File Pre-install action, continue if ok
"RTN","XPDIK",21,0)
 .;XPDFL= 0-send,1-delete,2-link,3-merge,4-attach,5-disable
"RTN","XPDIK",22,0)
 .;loops thru the entries for this file
"RTN","XPDIK",23,0)
 .I '$$ACT(FPRE) S OLDA=0 F  S OLDA=$O(^XTMP("XPDI",XPDA,"KRN",XPDFIL,OLDA)) Q:'OLDA  S XPDFL=+$G(^(OLDA,-1)),OLDA(0)=^(0) D
"RTN","XPDIK",24,0)
 ..;if we are doing VT graphic display, set counter
"RTN","XPDIK",25,0)
 ..I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+1 D:'(XPDIDCNT#XPDIDMOD) UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",26,0)
 ..;quit if disable or attach (4 or 5).  Attach will be processed under the parent menu.
"RTN","XPDIK",27,0)
 ..Q:XPDFL>3
"RTN","XPDIK",28,0)
 ..;if FM file, need to set screening logic
"RTN","XPDIK",29,0)
 ..I XPDFIL<.44 S %=$S(XPDFIL'=.403:4,1:8),DIC("S")="I $P(^(0),U,"_%_")="_$P(OLDA(0),U,%)
"RTN","XPDIK",30,0)
 ..;if deleting at site and a template, reset the lookup value and DIC("S")
"RTN","XPDIK",31,0)
 ..I XPDFL=1,XPDFIL<.44 S %=$P(OLDA(0),U),$P(OLDA(0),U)=$P(%,"    FILE #"),DIC("S")="I $P(^(0),U,"_$S(XPDFIL'=.403:4,1:8)_")="_+$P(%,"    FILE #",2)
"RTN","XPDIK",32,0)
 ..;XPDNEW=1 if entry is new, laygo
"RTN","XPDIK",33,0)
 ..S X=$P(OLDA(0),U),Y=$$DIC(XPDFIL,X,$G(DIC("S")),XPDFL) Q:'Y  S DA=+Y,XPDNEW=$P(Y,U,3)
"RTN","XPDIK",34,0)
 ..;if deleting then save and process after FPOS
"RTN","XPDIK",35,0)
 ..I XPDFL=1 S ^TMP($J,"XPDEL",DA)="" Q
"RTN","XPDIK",36,0)
 ..;do Entries Pre-install action
"RTN","XPDIK",37,0)
 ..Q:$$ACT(EPRE)
"RTN","XPDIK",38,0)
 ..;merges the data, if you want the data deleted before the merge, you must
"RTN","XPDIK",39,0)
 ..;do it in the Entry Pre-install node, EPRE.
"RTN","XPDIK",40,0)
 ..M @(DIC_DA_")")=^XTMP("XPDI",XPDA,"KRN",XPDFIL,OLDA)
"RTN","XPDIK",41,0)
 ..;kill the flag node from the live data node
"RTN","XPDIK",42,0)
 ..K @(DIC_DA_",-1)") Q:$$ACT(EPOS)
"RTN","XPDIK",43,0)
 ..;XREF is flag to x-ref file after each entry, it is set in file 9.6
"RTN","XPDIK",44,0)
 ..I XREF N DIK S DIK=DIC D IX1^DIK
"RTN","XPDIK",45,0)
 .;do File Post Install Action
"RTN","XPDIK",46,0)
 .S %=$$ACT(FPOS)
"RTN","XPDIK",47,0)
 .;process the deleting of entries, FDEL should allow the passing of all entries
"RTN","XPDIK",48,0)
 .;to delete in array ^TMP($J,"XPDEL",DA)=""
"RTN","XPDIK",49,0)
 .I $L(FDEL),$D(^TMP($J,"XPDEL")) S %="^TMP($J,""XPDEL"")" D @FDEL
"RTN","XPDIK",50,0)
 .;complete check point
"RTN","XPDIK",51,0)
 .S %=$$XPCOM(XPDFIL)
"RTN","XPDIK",52,0)
 .K ^TMP($J,"XPDEL")
"RTN","XPDIK",53,0)
 .I $D(XPDIDVT) D UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",54,0)
 Q
"RTN","XPDIK",55,0)
FIA ;
"RTN","XPDIK",56,0)
 ;XPFIL2=file is new^DD screen failed^data already exists^change file name^don't add data; 1=yes, 0=no
"RTN","XPDIK",57,0)
 N XPGR,XPFIL,XPFILO,XPFIL2,Z
"RTN","XPDIK",58,0)
 S XPFIL=0,XPGR=$NA(^XTMP("XPDI",XPDA))
"RTN","XPDIK",59,0)
 F  S XPFIL=$O(^XTMP("XPDI",XPDA,"FIA",XPFIL)) Q:'XPFIL  S XPFILO=^(XPFIL,0,1),XPFIL2=^(2) D
"RTN","XPDIK",60,0)
 .;if we are doing VT graphic display, set counter
"RTN","XPDIK",61,0)
 .I $D(XPDIDVT) S XPDIDCNT=XPDIDCNT+1 D:'(XPDIDCNT#XPDIDMOD) UPDATE^XPDID(XPDIDCNT)
"RTN","XPDIK",62,0)
 .;file is new, alway install DD
"RTN","XPDIK",63,0)
 .S:XPFIL2 $P(XPFILO,U)="y"
"RTN","XPDIK",64,0)
 .;DD failed screen
"RTN","XPDIK",65,0)
 .I $P(XPFIL2,U,2) D  Q
"RTN","XPDIK",66,0)
 ..N XPD
"RTN","XPDIK",67,0)
 ..S XPD(1)=" ",XPD(2)="Data Dictionary for File #"_XPFIL_" not installed, failed DD screen."
"RTN","XPDIK",68,0)
 ..D MES^XPDUTL(.XPD) S %=$$XPCOM(XPFIL)
"RTN","XPDIK",69,0)
 .;if udate DD question = no & file is not new update checkpoint
"RTN","XPDIK",70,0)
 .I $P(XPFILO,U)'="y"&'XPFIL2 S %=$$XPCOM(XPFIL)
"RTN","XPDIK",71,0)
 .;check if XPFIL has already been installed
"RTN","XPDIK",72,0)
 .Q:$P(^XPD(9.7,XPDA,4,XPFIL,0),U,2)
"RTN","XPDIK",73,0)
 .;update file name
"RTN","XPDIK",74,0)
 .I $P(XPFIL2,U,4) D
"RTN","XPDIK",75,0)
 ..N DIE,DR,DA
"RTN","XPDIK",76,0)
 ..S DR=".01////"_^XTMP("XPDI",XPDA,"FIA",XPFIL),DA=XPFIL,DIE=1
"RTN","XPDIK",77,0)
 ..D ^DIE
"RTN","XPDIK",78,0)
 .;move DD and check for errors
"RTN","XPDIK",79,0)
 .D DDIN^DIFROMS(XPFIL,"","",XPGR),DIERR("** ERROR IN DATA DICTIONARY FOR FILE # "_XPFIL_" **"):$D(DIERR)
"RTN","XPDIK",80,0)
 .S %=$$XPCOM(XPFIL)
"RTN","XPDIK",81,0)
 I $D(XPDIDVT) D UPDATE^XPDID(XPDIDTOT)
"RTN","XPDIK",82,0)
 Q
"RTN","XPDIK",83,0)
DAT ;
"RTN","XPDIK",84,0)
 N XPGR,XPFIL,XPFILO,XPFIL2,Z
"RTN","XPDIK",85,0)
 S XPFIL=0,XPGR=$NA(^XTMP("XPDI",XPDA))
"RTN","XPDIK",86,0)
 ;DO if they are sending data
"RTN","XPDIK",87,0)
 F  S XPFIL=$O(^XTMP("XPDI",XPDA,"FIA",XPFIL)) Q:'XPFIL  S XPFILO=^(XPFIL,0,1),XPFIL2=^(2) D:$P(XPFILO,U,7)="y"
"RTN","XPDIK",88,0)
 .;DD failed screen or answer no to adding data or 'Add if new' & data already exists or file doesn't exist
"RTN","XPDIK",89,0)
 .I $P(XPFIL2,U,2)!$P(XPFIL2,U,5)!($P(XPFILO,U,8)="a"&$P(XPFIL2,U,3))!'$D(^DIC(XPFIL,0)) S %=$$XPCOM(XPFIL,1) Q
"RTN","XPDIK",90,0)
 .;check if XPFIL has already been installed or no data to input
"RTN","XPDIK",91,0)
 .Q:$P(^XPD(9.7,XPDA,4,XPFIL,0),U,3)!('$D(^XTMP("XPDI",XPDA,"DATA",XPFIL)))
"RTN","XPDIK",92,0)
 .;bring in Data and check for error
"RTN","XPDIK",93,0)
 .D DATAIN^DIFROMS(XPFIL,"","",XPGR),DIERR("** ERROR IN DATA FOR FILE # "_XPFIL_" **"):$D(DIERR)
"RTN","XPDIK",94,0)
 .S %=$$XPCOM(XPFIL,1)
"RTN","XPDIK",95,0)
 D RP^DIFROMSR("","",XPGR),DIERR("** ERROR IN POINTER RESOLUTION OF DATA **"):$D(DIERR)
"RTN","XPDIK",96,0)
 Q
"RTN","XPDIK",97,0)
 ;record error
"RTN","XPDIK",98,0)
DIERR(XPDI) N XPD
"RTN","XPDIK",99,0)
 D MSG^DIALOG("AE",.XPD) Q:'$D(XPD)
"RTN","XPDIK",100,0)
 D BMES^XPDUTL(XPDI),MES^XPDUTL(.XPD)
"RTN","XPDIK",101,0)
 Q
"RTN","XPDIK",102,0)
 ;
"RTN","XPDIK",103,0)
 ;XPDF=file #,X=input,XPDS=screen logic, XPDACT=action
"RTN","XPDIK",104,0)
DIC(XPDF,XPDX,XPDS,XPDACT) ;
"RTN","XPDIK",105,0)
 N DIC,DIERR,XPD,XPDN
"RTN","XPDIK",106,0)
 S DIC=$G(^DIC(XPDF,0,"GL"))
"RTN","XPDIK",107,0)
 D FIND^DIC(XPDF,"","","XQf",XPDX,5,"",$G(XPDS),"","XPD")
"RTN","XPDIK",108,0)
 ;one or more matches, just return first one
"RTN","XPDIK",109,0)
 I $G(XPD(0)) D:XPD(0)>1  Q XPD(1)
"RTN","XPDIK",110,0)
 .N %
"RTN","XPDIK",111,0)
 .S %(1)=$P($G(^DIC(XPDF,0)),U)_"  "_XPDX_"  is Duplicated,",%(2)=" only ien #"_XPD(1)_" was updated."
"RTN","XPDIK",112,0)
 .D MES^XPDUTL(.%)
"RTN","XPDIK",113,0)
 ;no match and action=(delete,link, or attach), don't write message if deleting
"RTN","XPDIK",114,0)
 I $G(XPDACT),XPDACT'=3 D:XPDACT'=1 BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" Lookup failed, NO Action Taken.") Q 0
"RTN","XPDIK",115,0)
 ;add a new entry
"RTN","XPDIK",116,0)
 N DLAYGO,X,Y
"RTN","XPDIK",117,0)
 S X=XPDX,DIC(0)="LX",DLAYGO=XPDF D ^DIC
"RTN","XPDIK",118,0)
 I Y<0 D BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",119,0)
 Q Y
"RTN","XPDIK",120,0)
 ;code can't be used until UPDATE^DIE allows the creation of a record
"RTN","XPDIK",121,0)
 ;without required identifiers
"RTN","XPDIK",122,0)
 ;K XPD,DIERR
"RTN","XPDIK",123,0)
 ;S XPD(XPDF,"+1,",.01)=XPDX
"RTN","XPDIK",124,0)
 ;D UPDATE^DIE("","XPD","XPDN")
"RTN","XPDIK",125,0)
 ;couldn't add as new
"RTN","XPDIK",126,0)
 ;I $D(DIERR) D DIERR(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",127,0)
 ;I '$G(XPDN(1)) D BMES^XPDUTL(" "_$P($G(^DIC(XPDF,0)),U)_" "_XPDX_" **Couldn't Add to file**") Q 0
"RTN","XPDIK",128,0)
 ;Q XPDN(1)
"RTN","XPDIK",129,0)
 ;
"RTN","XPDIK",130,0)
ACT(%) ;execute action, returns 0 to continue, 1 to quit
"RTN","XPDIK",131,0)
 ;user can count on DIC,DA,XPDFIL,OLDA,XPDNM,XPDFL,X,Y being around
"RTN","XPDIK",132,0)
 ;XPDNEW is set only for Entry Pre-install action
"RTN","XPDIK",133,0)
 Q:%="" 0
"RTN","XPDIK",134,0)
 N %1,%2,%3 S %1=$G(DIC),%2=$G(DA),%3=$G(OLDA)
"RTN","XPDIK",135,0)
 N DA,DIC,DIOVRD,OLDA,EPOS,EPRE,FPOS,FPRE,ORD,XREF,XPDQUIT
"RTN","XPDIK",136,0)
 S DIC=%1,DA=%2,OLDA=%3
"RTN","XPDIK",137,0)
 S:%'["^" %="^"_%
"RTN","XPDIK",138,0)
 ;XPDQUIT=quit this level of processing
"RTN","XPDIK",139,0)
 D @% Q $D(XPDQUIT)
"RTN","XPDIK",140,0)
 Q
"RTN","XPDIK",141,0)
 ;
"RTN","XPDIK",142,0)
XPCOM(XPDF,XPDJ) ;complete checkpoint for file XPDF
"RTN","XPDIK",143,0)
 ;XPDJ=1 only for data of fm files, it set the field to edit = 2
"RTN","XPDIK",144,0)
 N XPD,%,Z
"RTN","XPDIK",145,0)
 S %=$$NOW^XLFDT,Z=$S(XPDCP="KRN":9.715,1:9.714),XPD(Z,XPDF_","_XPDA_",",$G(XPDJ)+1)=%
"RTN","XPDIK",146,0)
 ;if Build Components, save the ORDer number
"RTN","XPDIK",147,0)
 S:Z=9.715 XPD(Z,XPDF_","_XPDA_",",2)=ORD
"RTN","XPDIK",148,0)
 D FILE^DIE("","XPD")
"RTN","XPDIK",149,0)
 Q 1
"RTN","XPDIK",150,0)
 ;
"RTN","XPDIK",151,0)
XPCK(XPDI) ;setup check points for file type XPDI
"RTN","XPDIK",152,0)
 ;XPDI="KRN"-components, ="FIA"-files
"RTN","XPDIK",153,0)
 N %,XPD,XPDF,XPDJ,XPDK
"RTN","XPDIK",154,0)
 ;XPDK=sub DD
"RTN","XPDIK",155,0)
 S XPDK=$S(XPDI="KRN":9.715,1:9.714),XPDF=0
"RTN","XPDIK",156,0)
 F %=1:1 S XPDF=$O(^XTMP("XPDI",XPDA,XPDI,XPDF)) Q:'XPDF  S (XPDJ(%),XPD(XPDK,"+"_%_","_XPDA_",",.01))=XPDF
"RTN","XPDIK",157,0)
 D:$D(XPD)>9 UPDATE^DIE("","XPD","XPDJ")
"RTN","XPDIK",158,0)
 Q
"RTN","XPDTC")
0^4^B40664540
"RTN","XPDTC",1,0)
XPDTC ;SFISC/RSD - Transport calls ;08/05/99  08:35
"RTN","XPDTC",2,0)
 ;;8.0;KERNEL;**10,15,21,39,41,44,58,83,92,95,100,108,124**;Jul 10, 1995
"RTN","XPDTC",3,0)
 Q
"RTN","XPDTC",4,0)
 ;^XTMP("XPDT",XPDA,data type,file #,
"RTN","XPDTC",5,0)
 ;XPDA=ien of File 9.6, XPDNM=.01 field
"RTN","XPDTC",6,0)
DD ;build DD
"RTN","XPDTC",7,0)
 N FILE,FGR,FNAM,Z2,Z3,Z4
"RTN","XPDTC",8,0)
 S FILE=0,FGR="^XTMP(""XPDT"",XPDA)",FNAM=$NA(^XPD(9.6,XPDA,4,"APDD"))
"RTN","XPDTC",9,0)
 F  S FILE=$O(^XPD(9.6,XPDA,4,FILE)) Q:'FILE  D
"RTN","XPDTC",10,0)
 .S Z2=$G(^XPD(9.6,XPDA,4,FILE,222)),Z3=$G(^(223)),Z4=$G(^(224))
"RTN","XPDTC",11,0)
 .Q:'$$DATA^XPDV(FILE,Z2)
"RTN","XPDTC",12,0)
 .D FIA^DIFROMSU(FILE,"",FNAM,FGR,Z2,Z3,Z4,XPDVER),DIERR:$D(DIERR)
"RTN","XPDTC",13,0)
 Q:'$D(^XTMP("XPDT",XPDA,"FIA"))
"RTN","XPDTC",14,0)
 ;send DD and Data
"RTN","XPDTC",15,0)
 D DDOUT^DIFROMS("","","",FGR),DIERR:$D(DIERR),DATAOUT^DIFROMS("","","",FGR),DIERR:$D(DIERR)
"RTN","XPDTC",16,0)
 Q
"RTN","XPDTC",17,0)
 ;XPDERR is checked in XPDT and will abort transport
"RTN","XPDTC",18,0)
DIERR ;record error
"RTN","XPDTC",19,0)
 D MSG^DIALOG("EW",.XPD) S XPDERR=1
"RTN","XPDTC",20,0)
 Q
"RTN","XPDTC",21,0)
KRN ;build Kernel Files
"RTN","XPDTC",22,0)
 ;XPDFILE=file #, XPDOLDA=ien in Build file
"RTN","XPDTC",23,0)
 N %,%1,%2,DA,EACT,FACT,FGR,XPDFILE,XPDFL,XPDOLDA,XPDI
"RTN","XPDTC",24,0)
 F XPDFILE=1:1 S Y0=$P($T(FILES+XPDFILE^XPDE),";;",2,99) Q:Y0=""  S XPDI(+Y0)=Y0
"RTN","XPDTC",25,0)
 ;XPDI(XPDFILE)=file;order;x-ref;fact;eact;fpre;epre;fpos;epos;fdel
"RTN","XPDTC",26,0)
 S XPDFILE=0
"RTN","XPDTC",27,0)
 F  S XPDFILE=$O(^XPD(9.6,XPDA,"KRN",XPDFILE)) Q:'XPDFILE  S XPDI=$G(XPDI(XPDFILE)),FACT=$P(XPDI,";",4),EACT=$P(XPDI,";",5) D  Q:$D(XPDERR)  D:FACT]"" ACT(FACT)
"RTN","XPDTC",28,0)
 .;need to add code to check if File and data is already being sent in the File
"RTN","XPDTC",29,0)
 .;mult. If it is, don't bother sending it again.  DTL(XPDFILE)
"RTN","XPDTC",30,0)
 .S XPDOLDA=0,FGR=$$FILE^XPDV(XPDFILE) I FGR="" S XPDERR=1 Q
"RTN","XPDTC",31,0)
 .K ^TMP($J,"XPD")
"RTN","XPDTC",32,0)
 .F  S XPDOLDA=$O(^XPD(9.6,XPDA,"KRN",XPDFILE,"NM",XPDOLDA)) Q:'XPDOLDA  S Y0=$G(^(XPDOLDA,0)) D
"RTN","XPDTC",33,0)
 ..;XPDFL= 0-send,1-delete,2-link,3-merge,4-attach,5-disable
"RTN","XPDTC",34,0)
 ..S XPDFL=$P(Y0,U,3)
"RTN","XPDTC",35,0)
 ..;If deleting at site get an unused DA
"RTN","XPDTC",36,0)
 ..I XPDFL=1 S DA=$O(@FGR@(" "),-1)+1 F DA=DA:1 Q:'$D(^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA))
"RTN","XPDTC",37,0)
 ..;$P(Y0,U,2) is file # for this template, reset Y0 before getting DA
"RTN","XPDTC",38,0)
 ..E  S:$P(Y0,U,2) $P(Y0,U)=$P(Y0,"    FILE #") S DA=$$ENTRY^XPDV(Y0)
"RTN","XPDTC",39,0)
 ..I 'DA S XPDERR=1 Q
"RTN","XPDTC",40,0)
 ..;(-1)=action ^ ien in Build file
"RTN","XPDTC",41,0)
 ..S ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA,-1)=+XPDFL_"^"_XPDOLDA
"RTN","XPDTC",42,0)
 ..;action 2 - verify children, 4 - verify parent
"RTN","XPDTC",43,0)
 ..I XPDFL=2!(XPDFL=4),'$$MENU^XPDV(XPDFILE,DA,XPDFL) S XPDERR=1 Q
"RTN","XPDTC",44,0)
 ..;if action is 1,4 or 5 then only send .01 field and set checksum to ""
"RTN","XPDTC",45,0)
 ..I XPDFL=1!(XPDFL>3) S ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA,0)=$P(Y0,U),$P(^XPD(9.6,XPDA,"KRN",XPDFILE,"NM",XPDOLDA,0),U,4)="" Q
"RTN","XPDTC",46,0)
 ..M ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA)=@FGR@(DA)
"RTN","XPDTC",47,0)
 ..;execute entry build action
"RTN","XPDTC",48,0)
 ..D:EACT]"" ACT(EACT)
"RTN","XPDTC",49,0)
 .;quit if no entries were saved
"RTN","XPDTC",50,0)
 .Q:'$O(^XTMP("XPDT",XPDA,"KRN",XPDFILE,0))
"RTN","XPDTC",51,0)
 .;XPDI=XPDI(XPDFILE), build x-ref of order to install
"RTN","XPDTC",52,0)
 .S %=$P(^DIC(XPDFILE,0),U),^XTMP("XPDT",XPDA,"ORD",+$P(XPDI,";",2),XPDFILE)=XPDI,^(XPDFILE,0)=%
"RTN","XPDTC",53,0)
 .Q
"RTN","XPDTC",54,0)
 Q
"RTN","XPDTC",55,0)
QUES ;build from Install Questions multiple
"RTN","XPDTC",56,0)
 N I,J,X,%
"RTN","XPDTC",57,0)
 S X=""
"RTN","XPDTC",58,0)
 ;the "B" x-ref will give me the order of the questions
"RTN","XPDTC",59,0)
 F  S X=$O(^XPD(9.6,XPDA,"QUES","B",X)) Q:X=""  S I=$$QUES^XPDV(X) S:'I XPDERR=1 D:I
"RTN","XPDTC",60,0)
 .S J=0 F  S J=$O(^XPD(9.6,XPDA,"QUES",I,J)) Q:J=""  D
"RTN","XPDTC",61,0)
 ..;tranform J to DIR subscripts
"RTN","XPDTC",62,0)
 ..I $L(J)=1!(J="QQ") S ^XTMP("XPDT",XPDA,"QUES",X,$TR(J,"1ABQ","0AB?"))=^(J) Q  ;^(J) ref to ^XPD(9.6,XPDA,"QUES",I,J)
"RTN","XPDTC",63,0)
 ..;set the word processing fields into DIR("?",#) structure
"RTN","XPDTC",64,0)
 ..F %=1:1 Q:'$D(^XPD(9.6,XPDA,"QUES",I,J,%,0))  S ^XTMP("XPDT",XPDA,"QUES",X,$TR(J,"AQ10","A?"),%)=^(0)
"RTN","XPDTC",65,0)
 ;send the File questions
"RTN","XPDTC",66,0)
 F I=1:2 S X=$P($T(QUESTION+I),";;",2,99) Q:X=""  S Y=$P($T(QUESTION+I+1),";;",2) D
"RTN","XPDTC",67,0)
 .S ^XTMP("XPDT",XPDA,"QUES",$P(X,";"),0)=$P(X,";",2),^("A")=$P(X,";",3),^("B")=$P(X,";",4),^("??")=$P(X,";",5) S:Y]"" ^("M")=Y
"RTN","XPDTC",68,0)
 Q
"RTN","XPDTC",69,0)
INT ;build pre,post, & enviroment init routines
"RTN","XPDTC",70,0)
 N %,I,X
"RTN","XPDTC",71,0)
 F I="PRE","INI","INIT" I $G(^XPD(9.6,XPDA,I))]"" S X=^(I) D
"RTN","XPDTC",72,0)
 .S ^XTMP("XPDT",XPDA,I)=X,X=$P(X,U,$L(X,U)) Q:$D(^("RTN",X))
"RTN","XPDTC",73,0)
 .I '$$RTN^XPDV(X) W !,"Routine ",X," **NOT FOUND**" S XPDERR=1 Q
"RTN","XPDTC",74,0)
 .S %=$$LOAD^XPDTA(X,"0^")
"RTN","XPDTC",75,0)
 Q
"RTN","XPDTC",76,0)
BLD ;build Build file, Package file and Order Parameter file
"RTN","XPDTC",77,0)
 N %,DIC,X,XPD,XPDI,XPDV,Y
"RTN","XPDTC",78,0)
 ;Update the 'Date Distributed' field
"RTN","XPDTC",79,0)
 S XPD(9.6,XPDA_",",.02)=$$DT^XLFDT()
"RTN","XPDTC",80,0)
 D FILE^DIE("","XPD") K XPD
"RTN","XPDTC",81,0)
 ;save version of kernel and fm
"RTN","XPDTC",82,0)
 S ^XTMP("XPDT",XPDA,"VER")=$$VERSION^XPDUTL("XU")_U_$$VERSION^XPDUTL("VA FILEMAN")
"RTN","XPDTC",83,0)
 S ^XTMP("XPDT",XPDA,"MBREQ")=$P($G(XPDT(XPDT)),U,4)
"RTN","XPDTC",84,0)
 M ^XTMP("XPDT",XPDA,"BLD",XPDA)=^XPD(9.6,XPDA)
"RTN","XPDTC",85,0)
 ;check national package file pointer
"RTN","XPDTC",86,0)
 S XPDI=$P(^XPD(9.6,XPDA,0),U,2)
"RTN","XPDTC",87,0)
 I XPDI="" W !,"No Package File Link" Q
"RTN","XPDTC",88,0)
 S $P(^XTMP("XPDT",XPDA,"BLD",XPDA,0),U,2)=$$PT^XPDTA("^DIC(9.4)",XPDI)
"RTN","XPDTC",89,0)
 ;quit if no pointer to package file
"RTN","XPDTC",90,0)
 I '$D(^DIC(9.4,XPDI)) W !,"Package File Link is corrupted" S XPDERR=1 Q
"RTN","XPDTC",91,0)
 ;update version multiple in package file,XPD=version^date distributed
"RTN","XPDTC",92,0)
 S XPD=$$VER^XPDUTL(XPDNM)_U_$P(^XTMP("XPDT",XPDA,"BLD",XPDA,0),U,4)
"RTN","XPDTC",93,0)
 ;XPD(1)=root of description field
"RTN","XPDTC",94,0)
 S:$D(^XTMP("XPDT",XPDA,"BLD",XPDA,1)) XPD(1)=$NA(^(1))
"RTN","XPDTC",95,0)
 S ^XTMP("XPDT",XPDA,"PKG",XPDI,0)=^DIC(9.4,XPDI,0),^XTMP("XPDT",XPDA,"PKG",XPDI,22,0)="^"_$P(^DD(9.4,22,0),U,2)_"^1^1"
"RTN","XPDTC",96,0)
 ;add node 20 to XTMP for Patient Merge
"RTN","XPDTC",97,0)
 M ^XTMP("XPDT",XPDA,"PKG",XPDI,20)=^DIC(9.4,XPDI,20)
"RTN","XPDTC",98,0)
 ;XPDNM'["*" is a version release
"RTN","XPDTC",99,0)
 I XPDNM'["*" D
"RTN","XPDTC",100,0)
 .S XPDV=$$PKGVER^XPDIP(XPDI,.XPD)
"RTN","XPDTC",101,0)
 .;Merge is used to set single nodes and merge multiples
"RTN","XPDTC",102,0)
 .F %=1,5,7,20,"DEV","VERSION" M ^XTMP("XPDT",XPDA,"PKG",XPDI,%)=^DIC(9.4,XPDI,%)
"RTN","XPDTC",103,0)
 .;XPDV=ien of Version Multiple
"RTN","XPDTC",104,0)
 .I $D(^DIC(9.4,XPDI,22,XPDV))'>9 W !!,"**Version multiple in Package file wasn't updated**",!! S XPDERR=1 Q
"RTN","XPDTC",105,0)
 .M ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1)=^DIC(9.4,XPDI,22,XPDV)
"RTN","XPDTC",106,0)
 ;this is a patch, %=version number, $P(XPD,U)=patch number
"RTN","XPDTC",107,0)
 E  D
"RTN","XPDTC",108,0)
 .S %=$P(XPD,U),$P(XPD,U)=$P(XPDNM,"*",3),XPDV=$$PKGPAT^XPDIP(XPDI,%,.XPD)
"RTN","XPDTC",109,0)
 .S ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1,0)=^DIC(9.4,XPDI,22,+XPDV,0)
"RTN","XPDTC",110,0)
 .I $D(^DIC(9.4,XPDI,22,+XPDV,"PAH",+$P(XPDV,U,2)))'>9 W !!,"**Patch multiple in Package file wasn't updated**",!! S XPDERR=1 Q
"RTN","XPDTC",111,0)
 .M ^XTMP("XPDT",XPDA,"PKG",XPDI,22,1,"PAH",1)=^DIC(9.4,XPDI,22,+XPDV,"PAH",+$P(XPDV,U,2))
"RTN","XPDTC",112,0)
 ;M ^XTMP("XPDT",XPDA,"PKG",XPDI)=^DIC(9.4,XPDI)
"RTN","XPDTC",113,0)
 ;save the version ien^patch ien on -1 node
"RTN","XPDTC",114,0)
 S ^XTMP("XPDT",XPDA,"PKG",XPDI,-1)="1^1"
"RTN","XPDTC",115,0)
 ;resolve Primary Help Frame (0;4)
"RTN","XPDTC",116,0)
 S %=+$P(^DIC(9.4,XPDI,0),U,4) S:% $P(^XTMP("XPDT",XPDA,"PKG",XPDI,0),U,4)=$$PT^XPDTA("^DIC(9.2)",%)
"RTN","XPDTC",117,0)
 Q
"RTN","XPDTC",118,0)
 ;
"RTN","XPDTC",119,0)
ACT(%) ;execute action
"RTN","XPDTC",120,0)
 ;user can count on DA,XPDFILE,XPDFL,XPDNM,XPDOLDA being around
"RTN","XPDTC",121,0)
 ;DA=ien in ^XTMP("XPDT",XPDA,"KRN",XPDFILE,DA)
"RTN","XPDTC",122,0)
 ;XPDOLDA=ien in ^XPD(9.6,XPDA,"KRN",XPDIFLE,"NM",XPDOLDA)
"RTN","XPDTC",123,0)
 N EACT,FACT,FGR,K0,Y0
"RTN","XPDTC",124,0)
 S:%'["^" %="^"_%
"RTN","XPDTC",125,0)
 D @% Q
"RTN","XPDTC",126,0)
 ;
"RTN","XPDTC",127,0)
 ;the following are the default questions for the INSTALL QUESTIONS
"RTN","XPDTC",128,0)
 ;in file 9.6, the format is:
"RTN","XPDTC",129,0)
 ;;field .01;field 1;field 2;field 4;field 7
"RTN","XPDTC",130,0)
 ;;field 10
"RTN","XPDTC",131,0)
QUESTION ;package install questions
"RTN","XPDTC",132,0)
 ;;XPF1;Y;Shall I write over your |FLAG| File;YES;^D REP^XPDH
"RTN","XPDTC",133,0)
 ;;D XPF1^XPDIQ
"RTN","XPDTC",134,0)
 ;;XPF2;Y;Want my data |FLAG| yours;YES;^D DTA^XPDH
"RTN","XPDTC",135,0)
 ;;D XPF2^XPDIQ
"RTN","XPDTC",136,0)
 ;;XPI1;YO;Want KIDS to INHIBIT LOGONs during the install;YES;^D INHIBIT^XPDH
"RTN","XPDTC",137,0)
 ;;D XPI1^XPDIQ
"RTN","XPDTC",138,0)
 ;;XPM1;PO^VA(200,:EM;Enter the Coordinator for Mail Group '|FLAG|';;^D MG^XPDH
"RTN","XPDTC",139,0)
 ;;D XPM1^XPDIQ
"RTN","XPDTC",140,0)
 ;;XPO1;Y;Want KIDS to Rebuild Menu Trees Upon Completion of Install;YES;^D MENU^XPDH
"RTN","XPDTC",141,0)
 ;;D XPO1^XPDIQ
"RTN","XPDTC",142,0)
 ;;XPZ1;Y;Want to DISABLE Scheduled Options, Menu Options, and Protocols;YES;^D OPT^XPDH
"RTN","XPDTC",143,0)
 ;;D XPZ1^XPDIQ
"RTN","XPDTC",144,0)
 ;;XPZ2;Y;Want to MOVE routines to other CPUs;NO;^D RTN^XPDH
"RTN","XPDTC",145,0)
 ;;D XPZ2^XPDIQ
"VER")
8.0^21.0
**END**
**END**
