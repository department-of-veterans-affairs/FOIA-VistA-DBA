Released XU*8*209 SEQ #180
Extracted from mail message
**KIDS**:XU*8.0*209^

**INSTALL NAME**
XU*8.0*209
"BLD",1524,0)
XU*8.0*209^KERNEL^0^3010917^y
"BLD",1524,1,0)
^^3^3^3010720^^
"BLD",1524,1,1,0)
This patch enhances the Master File Server
"BLD",1524,1,2,0)
message handler and the IFR clean up code
"BLD",1524,1,3,0)
to compensate for HL7 package problems.
"BLD",1524,4,0)
^9.64PA^^
"BLD",1524,"ABNS",0)
^9.66A^1^1
"BLD",1524,"ABNS",1,0)
XU
"BLD",1524,"ABNS",1,1,0)
^9.661A^^
"BLD",1524,"ABNS","B","XU",1)
 
"BLD",1524,"ABPKG")
y^n^G.XUMF INSTITUTION@FORUM.VA.GOV
"BLD",1524,"KRN",0)
^9.67PA^19^17
"BLD",1524,"KRN",.4,0)
.4
"BLD",1524,"KRN",.401,0)
.401
"BLD",1524,"KRN",.402,0)
.402
"BLD",1524,"KRN",.403,0)
.403
"BLD",1524,"KRN",.5,0)
.5
"BLD",1524,"KRN",.84,0)
.84
"BLD",1524,"KRN",3.6,0)
3.6
"BLD",1524,"KRN",3.6,"NM",0)
^9.68A^2^2
"BLD",1524,"KRN",3.6,"NM",1,0)
XUMF ERROR^^0
"BLD",1524,"KRN",3.6,"NM",2,0)
XUMF INSTITUTION^^0
"BLD",1524,"KRN",3.6,"NM","B","XUMF ERROR",1)
 
"BLD",1524,"KRN",3.6,"NM","B","XUMF INSTITUTION",2)
 
"BLD",1524,"KRN",3.8,0)
3.8
"BLD",1524,"KRN",3.8,"NM",0)
^9.68A^2^2
"BLD",1524,"KRN",3.8,"NM",1,0)
XUMF INSTITUTION^^0
"BLD",1524,"KRN",3.8,"NM",2,0)
XUMF SERVER^^0
"BLD",1524,"KRN",3.8,"NM","B","XUMF INSTITUTION",1)
 
"BLD",1524,"KRN",3.8,"NM","B","XUMF SERVER",2)
 
"BLD",1524,"KRN",9.2,0)
9.2
"BLD",1524,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",1524,"KRN",9.8,0)
9.8
"BLD",1524,"KRN",9.8,"NM",0)
^9.68A^12^5
"BLD",1524,"KRN",9.8,"NM",1,0)
XUMFH^^0^B58840097
"BLD",1524,"KRN",9.8,"NM",2,0)
XUMF4^^0^B78125863
"BLD",1524,"KRN",9.8,"NM",4,0)
XUAF4^^0^B23598449
"BLD",1524,"KRN",9.8,"NM",11,0)
XUMFP4C^^0^B24241579
"BLD",1524,"KRN",9.8,"NM",12,0)
XUMF4A^^0^B54733421
"BLD",1524,"KRN",9.8,"NM","B","XUAF4",4)
 
"BLD",1524,"KRN",9.8,"NM","B","XUMF4",2)
 
"BLD",1524,"KRN",9.8,"NM","B","XUMF4A",12)
 
"BLD",1524,"KRN",9.8,"NM","B","XUMFH",1)
 
"BLD",1524,"KRN",9.8,"NM","B","XUMFP4C",11)
 
"BLD",1524,"KRN",19,0)
19
"BLD",1524,"KRN",19.1,0)
19.1
"BLD",1524,"KRN",101,0)
101
"BLD",1524,"KRN",409.61,0)
409.61
"BLD",1524,"KRN",771,0)
771
"BLD",1524,"KRN",870,0)
870
"BLD",1524,"KRN",8994,0)
8994
"BLD",1524,"KRN","B",.4,.4)
 
"BLD",1524,"KRN","B",.401,.401)
 
"BLD",1524,"KRN","B",.402,.402)
 
"BLD",1524,"KRN","B",.403,.403)
 
"BLD",1524,"KRN","B",.5,.5)
 
"BLD",1524,"KRN","B",.84,.84)
 
"BLD",1524,"KRN","B",3.6,3.6)
 
"BLD",1524,"KRN","B",3.8,3.8)
 
"BLD",1524,"KRN","B",9.2,9.2)
 
"BLD",1524,"KRN","B",9.8,9.8)
 
"BLD",1524,"KRN","B",19,19)
 
"BLD",1524,"KRN","B",19.1,19.1)
 
"BLD",1524,"KRN","B",101,101)
 
"BLD",1524,"KRN","B",409.61,409.61)
 
"BLD",1524,"KRN","B",771,771)
 
"BLD",1524,"KRN","B",870,870)
 
"BLD",1524,"KRN","B",8994,8994)
 
"BLD",1524,"QUES",0)
^9.62^^
"BLD",1524,"REQB",0)
^9.611^^0
"KRN",3.6,172,-1)
0^2
"KRN",3.6,172,0)
XUMF INSTITUTION^Master File Server - update notification - INSTITUTION file
"KRN",3.6,172,1,0)
^3.61A^29^29^3010907^^^^
"KRN",3.6,172,1,1,0)
The following Master File Notification (MFN) message was
"KRN",3.6,172,1,2,0)
received and processed by the Master File Server:
"KRN",3.6,172,1,3,0)
 
"KRN",3.6,172,1,4,0)
  HL7 Message ID:  |1|
"KRN",3.6,172,1,5,0)
  
"KRN",3.6,172,1,6,0)
The following INSTITUTION (#4) file entry has been |2|:
"KRN",3.6,172,1,7,0)
 
"KRN",3.6,172,1,8,0)
  IEN: |3|   STATION NUMBER: |4|
"KRN",3.6,172,1,9,0)
 
"KRN",3.6,172,1,10,0)
  UPDATED ENTRY
"KRN",3.6,172,1,11,0)
  -------------
"KRN",3.6,172,1,12,0)
  NAME: |5|
"KRN",3.6,172,1,13,0)
  OFFICIAL VA NAME: |6|
"KRN",3.6,172,1,14,0)
  FACILITY TYPE: |7|
"KRN",3.6,172,1,15,0)
  INACTIVE FACILITY FLAG: |11|
"KRN",3.6,172,1,16,0)
  STATE: |12|
"KRN",3.6,172,1,17,0)
  VISN: |13|
"KRN",3.6,172,1,18,0)
  PARENT FACILITY: |14|
"KRN",3.6,172,1,19,0)
 
"KRN",3.6,172,1,20,0)
  OLD VALUES
"KRN",3.6,172,1,21,0)
  ----------
"KRN",3.6,172,1,22,0)
  NAME: |8|
"KRN",3.6,172,1,23,0)
  OFFICIAL VA NAME: |9|
"KRN",3.6,172,1,24,0)
  FACILITY TYPE: |10|
"KRN",3.6,172,1,25,0)
  INACTIVE FACILITY FLAG: |15|
"KRN",3.6,172,1,26,0)
  STATE: |16|
"KRN",3.6,172,1,27,0)
  VISN: |17|
"KRN",3.6,172,1,28,0)
  PARENT FACILITY: |18|
"KRN",3.6,172,1,29,0)
 
"KRN",3.6,172,3,0)
^3.63^5^5^3010907^^^^
"KRN",3.6,172,3,1,0)
This bulletin notifies the XUMF INSTITUTION
"KRN",3.6,172,3,2,0)
mail group that an unsolicited update message
"KRN",3.6,172,3,3,0)
has been received and processed by the Master
"KRN",3.6,172,3,4,0)
File Server mechanism.  An INSTITUTION (#4)
"KRN",3.6,172,3,5,0)
file entry has been added/updated.
"KRN",3.6,172,4,0)
^3.64A^18^18
"KRN",3.6,172,4,1,0)
1
"KRN",3.6,172,4,1,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,172,4,1,1,1,0)
Message ID
"KRN",3.6,172,4,2,0)
2
"KRN",3.6,172,4,2,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,172,4,2,1,1,0)
Added or Updated
"KRN",3.6,172,4,3,0)
3
"KRN",3.6,172,4,3,1,0)
^3.65^1^1^3000802^^^
"KRN",3.6,172,4,3,1,1,0)
Internal Entry Number
"KRN",3.6,172,4,4,0)
4
"KRN",3.6,172,4,4,1,0)
^3.65^1^1^3000804^^^^
"KRN",3.6,172,4,4,1,1,0)
STATION NUMBER
"KRN",3.6,172,4,5,0)
5
"KRN",3.6,172,4,5,1,0)
^3.65^1^1^3000804^^^
"KRN",3.6,172,4,5,1,1,0)
NAME
"KRN",3.6,172,4,6,0)
6
"KRN",3.6,172,4,6,1,0)
^3.65^1^1^3000804^^^^
"KRN",3.6,172,4,6,1,1,0)
OFFICIAL VA NAME
"KRN",3.6,172,4,7,0)
7
"KRN",3.6,172,4,7,1,0)
^3.65^1^1^3000804^^^
"KRN",3.6,172,4,7,1,1,0)
FACILITY TYPE
"KRN",3.6,172,4,8,0)
8
"KRN",3.6,172,4,8,1,0)
^3.65^1^1^3010717^^^
"KRN",3.6,172,4,8,1,1,0)
OLD NAME
"KRN",3.6,172,4,9,0)
9
"KRN",3.6,172,4,9,1,0)
^3.65^1^1^3010619^^^^
"KRN",3.6,172,4,9,1,1,0)
OLD OFFICAL VA NAME
"KRN",3.6,172,4,10,0)
10
"KRN",3.6,172,4,10,1,0)
^3.65^1^1^3010619^^^^
"KRN",3.6,172,4,10,1,1,0)
OLD FACILITY TYPE
"KRN",3.6,172,4,11,0)
11
"KRN",3.6,172,4,11,1,0)
^^1^1^3010717^
"KRN",3.6,172,4,11,1,1,0)
INACTIVE FACILITY FLAG
"KRN",3.6,172,4,12,0)
12
"KRN",3.6,172,4,12,1,0)
^^1^1^3010717^
"KRN",3.6,172,4,12,1,1,0)
STATE
"KRN",3.6,172,4,13,0)
13
"KRN",3.6,172,4,13,1,0)
^^1^1^3010717^
"KRN",3.6,172,4,13,1,1,0)
VISN
"KRN",3.6,172,4,14,0)
14
"KRN",3.6,172,4,14,1,0)
^^1^1^3010717^
"KRN",3.6,172,4,14,1,1,0)
PARENT FACILITY
"KRN",3.6,172,4,15,0)
15
"KRN",3.6,172,4,15,1,0)
^^1^1^3010717^
"KRN",3.6,172,4,15,1,1,0)
OLD INACTIVE FACILITY FLAG
"KRN",3.6,172,4,16,0)
16
"KRN",3.6,172,4,16,1,0)
^^1^1^3010717^
"KRN",3.6,172,4,16,1,1,0)
OLD STATE
"KRN",3.6,172,4,17,0)
17
"KRN",3.6,172,4,17,1,0)
^^1^1^3010717^
"KRN",3.6,172,4,17,1,1,0)
OLD VISN
"KRN",3.6,172,4,18,0)
18
"KRN",3.6,172,4,18,1,0)
^^1^1^3010717^
"KRN",3.6,172,4,18,1,1,0)
OLD PARENT FACILITY
"KRN",3.6,173,-1)
0^1
"KRN",3.6,173,0)
XUMF ERROR^Master File Server - error message
"KRN",3.6,173,1,0)
^3.61A^18^18^3010809^^^^
"KRN",3.6,173,1,1,0)
The Master File Server has received a Message Acknowledgement (MSA) segment
"KRN",3.6,173,1,2,0)
with an Acknowledgement Code indicating an application error for the following
"KRN",3.6,173,1,3,0)
message:
"KRN",3.6,173,1,4,0)
 
"KRN",3.6,173,1,5,0)
  HL7 Message ID:  |1|
"KRN",3.6,173,1,6,0)
 
"KRN",3.6,173,1,7,0)
  Server message:
"KRN",3.6,173,1,8,0)
 
"KRN",3.6,173,1,9,0)
|2|
"KRN",3.6,173,1,10,0)
 
"KRN",3.6,173,1,11,0)
  HL7, FM, or other message:
"KRN",3.6,173,1,12,0)
 
"KRN",3.6,173,1,13,0)
|3|
"KRN",3.6,173,1,14,0)
 
"KRN",3.6,173,1,15,0)
|4|
"KRN",3.6,173,1,16,0)
 
"KRN",3.6,173,1,17,0)
This message must be investigated our the master file related to this message
"KRN",3.6,173,1,18,0)
will be out of sync with the national standard table.
"KRN",3.6,173,3,0)
^3.63^2^2^3010809^^^^
"KRN",3.6,173,3,1,0)
This bulletin is triggered upon receipt of a Master File Notification message
"KRN",3.6,173,3,2,0)
from the Master File Server.
"KRN",3.6,173,4,0)
^3.64A^4^4
"KRN",3.6,173,4,1,0)
1
"KRN",3.6,173,4,1,1,0)
^3.65^1^1^3010410^^^^
"KRN",3.6,173,4,1,1,1,0)
Message Control ID
"KRN",3.6,173,4,2,0)
2
"KRN",3.6,173,4,2,1,0)
^^1^1^3010717^
"KRN",3.6,173,4,2,1,1,0)
message from MFS
"KRN",3.6,173,4,3,0)
3
"KRN",3.6,173,4,3,1,0)
^^1^1^3010717^
"KRN",3.6,173,4,3,1,1,0)
message from HL7 application, FileMan, or other source
"KRN",3.6,173,4,4,0)
4
"KRN",3.6,173,4,4,1,0)
^^1^1^3010809^
"KRN",3.6,173,4,4,1,1,0)
FM error message
"KRN",3.8,138,-1)
0^2
"KRN",3.8,138,0)
XUMF SERVER^PU^^^^0^
"KRN",3.8,138,2,0)
^3.801^1^1^3000728^^^^
"KRN",3.8,138,2,1,0)
This mail group receives messages related to the Master File Server.
"KRN",3.8,138,3)
 
"KRN",3.8,138,6,0)
^3.812^^0
"KRN",3.8,150,-1)
0^1
"KRN",3.8,150,0)
XUMF INSTITUTION^PU^^^^^
"KRN",3.8,150,2,0)
^^2^2^3000802^
"KRN",3.8,150,2,1,0)
This mail group notifies members of update messages received from the Master
"KRN",3.8,150,2,2,0)
File Server related to the INSTITUTION (#4) file.
"KRN",3.8,150,3)
 
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1
"ORD",11,3.8,0)
MAIL GROUP
"PKG",113,-1)
1^1
"PKG",113,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^XUDOCV7 NEW FEATURES
"PKG",113,20,0)
^9.402P^^
"PKG",113,22,0)
^9.49I^1^1
"PKG",113,22,1,0)
8.0^2950703^2960322^648
"PKG",113,22,1,"PAH",1,0)
209^3010917
"PKG",113,22,1,"PAH",1,1,0)
^^3^3^3010917
"PKG",113,22,1,"PAH",1,1,1,0)
This patch enhances the Master File Server
"PKG",113,22,1,"PAH",1,1,2,0)
message handler and the IFR clean up code
"PKG",113,22,1,"PAH",1,1,3,0)
to compensate for HL7 package problems.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","XUAF4")
0^4^B23598449
"RTN","XUAF4",1,0)
XUAF4 ;ISC-SF/RWF/RAM - Instutition file access. ;04/01/99  08:07
"RTN","XUAF4",2,0)
 ;;8.0;KERNEL;**43,112,206,209**;Aug 19, 1996
"RTN","XUAF4",3,0)
 Q  ;No access from the top.
"RTN","XUAF4",4,0)
 ;
"RTN","XUAF4",5,0)
PARENT(ROOT,CHILD,ASSO) ;sr. Return array of IEN's of parents
"RTN","XUAF4",6,0)
 N %,%0
"RTN","XUAF4",7,0)
 S CHILD=$$LKUP(CHILD),ASSO=$$ASSO($G(ASSO)),%=0
"RTN","XUAF4",8,0)
 F  S %=$O(^DIC(4,CHILD,7,%)) Q:%'>0  S %0=+$P(^(%,0),U,2) D
"RTN","XUAF4",9,0)
 . Q:+%'=ASSO
"RTN","XUAF4",10,0)
 . S @ROOT@("P",+%0)=$$NS(+%0)
"RTN","XUAF4",11,0)
 Q
"RTN","XUAF4",12,0)
CHILDREN(ROOT,PAR,ASSO,XUAC) ;sr. Return the children
"RTN","XUAF4",13,0)
 N %,%1 S %=0,PAR=$$LKUP(PAR),ASSO=$$ASSO($G(ASSO)),XUAC=$G(XUAC)
"RTN","XUAF4",14,0)
 Q:ASSO'>0
"RTN","XUAF4",15,0)
 F  S %=$O(^DIC(4,"AC",ASSO,PAR,%)) Q:%'>0  D
"RTN","XUAF4",16,0)
 . I XUAC,$$STATUS(%)="I" Q
"RTN","XUAF4",17,0)
 . S @ROOT@("C",%)=$$NS(%)
"RTN","XUAF4",18,0)
 Q
"RTN","XUAF4",19,0)
SIBLING(ROOT,CHILD,ASSO) ;sr. Return the siblings
"RTN","XUAF4",20,0)
 N % S %=0,ASSO=$$ASSO($G(ASSO))
"RTN","XUAF4",21,0)
 D PARENT(ROOT,CHILD,ASSO)
"RTN","XUAF4",22,0)
 F  S %=$O(@ROOT@("P",%)) Q:%'>0  D CHILDREN($NA(@ROOT@("P",%)),"`"_%,ASSO)
"RTN","XUAF4",23,0)
 Q
"RTN","XUAF4",24,0)
NNT(%) ;ef.sr. Return Name, Station Number, ASSO
"RTN","XUAF4",25,0)
 I %'>0 Q ""
"RTN","XUAF4",26,0)
 Q $$NS(%)_"^"_$$WHAT(%,13)
"RTN","XUAF4",27,0)
 ;
"RTN","XUAF4",28,0)
LKUP(%) ;ef.sr. Resolve a value into IEN
"RTN","XUAF4",29,0)
 I $E(%)="`" S %=+$E(%,2,99) Q:$D(^DIC(4,%,0))#2 % Q 0
"RTN","XUAF4",30,0)
 ;Q $$FIND1^DIC(4,,"MX",%)
"RTN","XUAF4",31,0)
 Q $$FIND1^DIC(4,,"MX",%,,"I $P(^(0),U,11)'=""I""") ;To screen Inactive
"RTN","XUAF4",32,0)
 ;
"RTN","XUAF4",33,0)
STATUS(%) ;Get the status of a IEN
"RTN","XUAF4",34,0)
 Q $P(^DIC(4,%,0),U,11)
"RTN","XUAF4",35,0)
 ;
"RTN","XUAF4",36,0)
TYPE(%) ;Lookup a Faclity TYPE in file 4.1
"RTN","XUAF4",37,0)
 I %="" Q %
"RTN","XUAF4",38,0)
 I $D(^DIC(4.1,"B",%))>9 Q %
"RTN","XUAF4",39,0)
 S %=$$FIND1^DIC(4.1,,"MX",%)
"RTN","XUAF4",40,0)
 Q $P($G(^DIC(4.1,+%,0)),U)
"RTN","XUAF4",41,0)
 ;
"RTN","XUAF4",42,0)
ASSO(%) ;Lookup an Asso
"RTN","XUAF4",43,0)
 Q:+%=% % S:%="" %="VISN"
"RTN","XUAF4",44,0)
 S %=$$FIND1^DIC(4.05,,"MX",%)
"RTN","XUAF4",45,0)
 Q +%
"RTN","XUAF4",46,0)
 ;
"RTN","XUAF4",47,0)
NS(IEN) ;ef.sr. Return name and station #
"RTN","XUAF4",48,0)
 Q $P(^DIC(4,IEN,0),U,1)_U_$P($G(^DIC(4,+IEN,99)),U,1)
"RTN","XUAF4",49,0)
 ;
"RTN","XUAF4",50,0)
WHAT(IEN,FLD) ;ef.sr. Field to return
"RTN","XUAF4",51,0)
 Q $$GET1^DIQ(4,IEN_",",FLD,"")
"RTN","XUAF4",52,0)
 ;
"RTN","XUAF4",53,0)
CIRN(%1,%2) ;ef.sr. Is this a CIRN Enables inst.
"RTN","XUAF4",54,0)
 N % S %1=+$G(%1)
"RTN","XUAF4",55,0)
 Q:'$D(^DIC(4,%1,0)) -1
"RTN","XUAF4",56,0)
 I $G(%2)]"" N DIE,DR,DA S DA=%1,DR="990.1///"_%2,DIE="^DIC(4," D ^DIE
"RTN","XUAF4",57,0)
 Q $$WHAT(%1,990.1)
"RTN","XUAF4",58,0)
 ;
"RTN","XUAF4",59,0)
IEN(STA) ;return IEN for a station number
"RTN","XUAF4",60,0)
 S STA=$G(STA) Q:STA="" STA
"RTN","XUAF4",61,0)
 Q $O(^DIC(4,"D",STA,0))
"RTN","XUAF4",62,0)
 ;
"RTN","XUAF4",63,0)
STA(IEN) ;return station number for an IEN
"RTN","XUAF4",64,0)
 Q $P($G(^DIC(4,+IEN,99)),U)
"RTN","XUAF4",65,0)
 ;
"RTN","XUAF4",66,0)
TF(IEN) ;active treating facility? (1=YES,0=NO)
"RTN","XUAF4",67,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",68,0)
 D F4($$STA(IEN),.ARRAY,"AM")
"RTN","XUAF4",69,0)
 Q $S(ARRAY:1,1:0)
"RTN","XUAF4",70,0)
 ;
"RTN","XUAF4",71,0)
RT(IEN) ;realigned to
"RTN","XUAF4",72,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",73,0)
 D F4($$STA(IEN),.ARRAY)
"RTN","XUAF4",74,0)
 Q $G(ARRAY("REALIGNED TO"))
"RTN","XUAF4",75,0)
 ;
"RTN","XUAF4",76,0)
RF(IEN) ;realigned from
"RTN","XUAF4",77,0)
 N ARRAY Q:'$G(IEN) 0
"RTN","XUAF4",78,0)
 D F4($$STA(IEN),.ARRAY)
"RTN","XUAF4",79,0)
 Q $G(ARRAY("REALIGNED FROM"))
"RTN","XUAF4",80,0)
 ;
"RTN","XUAF4",81,0)
O99(IEN) ;returns pointer to new station number IEN
"RTN","XUAF4",82,0)
 Q:$O(^DIC(4,"AOLD99",+$G(IEN),""))="" ""
"RTN","XUAF4",83,0)
 Q $O(^DIC(4,"D",$O(^DIC(4,"AOLD99",+$G(IEN),"")),0))
"RTN","XUAF4",84,0)
 ;
"RTN","XUAF4",85,0)
LEGACY(STA) ; -- legacy station number (1=yes; 0=no)
"RTN","XUAF4",86,0)
 Q $S($$RT^XUAF4(+$$IEN^XUAF4(STA)):1,1:0)
"RTN","XUAF4",87,0)
 ;
"RTN","XUAF4",88,0)
PRNT(STA) ; -- parent facility
"RTN","XUAF4",89,0)
 N X S STA=$G(STA) Q:STA="" "0^no station number passed"
"RTN","XUAF4",90,0)
 D PARENT("X",STA,"PARENT FACILITY") S X=$O(X("P",0))
"RTN","XUAF4",91,0)
 Q:'X "0^no parent associated with input station number"
"RTN","XUAF4",92,0)
 Q X_U_$P($G(X("P",+X)),U,2)_U_$P($G(X("P",+X)),U)
"RTN","XUAF4",93,0)
 ;
"RTN","XUAF4",94,0)
F4(STA,ARRAY,FLAG,ONDT) ;File #4 multipurpose API
"RTN","XUAF4",95,0)
 ;
"RTN","XUAF4",96,0)
 ;INPUT
"RTN","XUAF4",97,0)
 ;       STA     Station number (required)
"RTN","XUAF4",98,0)
 ;
"RTN","XUAF4",99,0)
 ;    [.]ARRAY   $NAME reference for return values.  (required)
"RTN","XUAF4",100,0)
 ;
"RTN","XUAF4",101,0)
 ;       FLAG    A = Active entries only.  (optional)
"RTN","XUAF4",102,0)
 ;               M = Medical treating facilities only.
"RTN","XUAF4",103,0)
 ;
"RTN","XUAF4",104,0)
 ;       ONDT    Return name on this FM internal date.  (optional);
"RTN","XUAF4",105,0)
 ;
"RTN","XUAF4",106,0)
 ;OUTPUT
"RTN","XUAF4",107,0)
 ;       ARRAY                     IEN or '0^error message'
"RTN","XUAF4",108,0)
 ;       ARRAY("NAME")             name
"RTN","XUAF4",109,0)
 ;       ARRAY("VA NAME")          offical va name
"RTN","XUAF4",110,0)
 ;       ARRAY("STATION NUMBER")   station number
"RTN","XUAF4",111,0)
 ;       ARRAY("TYPE")             facilty type name
"RTN","XUAF4",112,0)
 ;       ARRAY("INACTIVE")         inactive date (0=not inactive)
"RTN","XUAF4",113,0)
 ;       note: if inactive date not available but entry inactive then 1
"RTN","XUAF4",114,0)
 ;
"RTN","XUAF4",115,0)
 ;       ARRAY("REALIGNED TO")     IEN^station number^date
"RTN","XUAF4",116,0)
 ;       ARRAY("REALIGNED FROM")   IEN^station number^date
"RTN","XUAF4",117,0)
 ;
"RTN","XUAF4",118,0)
 K ARRAY
"RTN","XUAF4",119,0)
 S STA=$G(STA),FLAG=$G(FLAG),ONDT=$G(ONDT)
"RTN","XUAF4",120,0)
 I STA="" S ARRAY="0^invalid input STA - required" Q
"RTN","XUAF4",121,0)
 ;
"RTN","XUAF4",122,0)
 N IEN,N99,TO,FM,I,RDT,NAME,VANAME,HDT
"RTN","XUAF4",123,0)
 ;
"RTN","XUAF4",124,0)
 S IEN=$$IEN(STA)
"RTN","XUAF4",125,0)
 I 'IEN S ARRAY="0^station number does not exist" Q
"RTN","XUAF4",126,0)
 S N99=$G(^DIC(4,+IEN,99))
"RTN","XUAF4",127,0)
 S ARRAY=$$SCRN() Q:'ARRAY
"RTN","XUAF4",128,0)
 ;
"RTN","XUAF4",129,0)
 S ARRAY("NAME")=$P(^DIC(4,IEN,0),U)
"RTN","XUAF4",130,0)
 S ARRAY("VA NAME")=$P(N99,U,3)
"RTN","XUAF4",131,0)
 S ARRAY("STATION NUMBER")=STA
"RTN","XUAF4",132,0)
 S ARRAY("TYPE")=$P($G(^DIC(4.1,+$G(^DIC(4,IEN,3)),0)),U)
"RTN","XUAF4",133,0)
 ;
"RTN","XUAF4",134,0)
 ;realignments
"RTN","XUAF4",135,0)
 S TO=$O(^DIC(4,"ARTO",IEN,0)) D:TO
"RTN","XUAF4",136,0)
 .S RDT=$O(^DIC(4,"ART",TO,IEN,0))
"RTN","XUAF4",137,0)
 .S ARRAY("REALIGNED TO")=TO_U_$$STA(TO)_U_RDT
"RTN","XUAF4",138,0)
 S FM=$O(^DIC(4,"ARFM",IEN,0)) D:FM
"RTN","XUAF4",139,0)
 .S ARRAY("REALIGNED FROM")=FM_U_$$STA(FM)_U_$O(^DIC(4,"ARF",FM,IEN,0))
"RTN","XUAF4",140,0)
 ;
"RTN","XUAF4",141,0)
 S I=$O(^DIC(4,"AI",IEN,0)),I=$S(I:I,$G(RDT):RDT,1:+$P(N99,U,4))
"RTN","XUAF4",142,0)
 S ARRAY("INACTIVE")=I
"RTN","XUAF4",143,0)
 ;
"RTN","XUAF4",144,0)
 Q:'ONDT
"RTN","XUAF4",145,0)
 ;
"RTN","XUAF4",146,0)
 ;get name for date
"RTN","XUAF4",147,0)
 S NAME=ARRAY("NAME")
"RTN","XUAF4",148,0)
 S VANAME=ARRAY("VA NAME")
"RTN","XUAF4",149,0)
 S HDT=DT
"RTN","XUAF4",150,0)
 F  S HDT=$O(^DIC(4,IEN,999,HDT),-1) Q:('HDT!(HDT<ONDT))  D
"RTN","XUAF4",151,0)
 .N X S X=$G(^DIC(4,IEN,999,HDT,0)) Q:X=""
"RTN","XUAF4",152,0)
 .S:$P(X,U,2)'="" NAME=$P(X,U,2)
"RTN","XUAF4",153,0)
 .S:$P(X,U,3)'="" VANAME=$P(X,U,3)
"RTN","XUAF4",154,0)
 S ARRAY("NAME")=NAME
"RTN","XUAF4",155,0)
 S ARRAY("VA NAME")=VANAME
"RTN","XUAF4",156,0)
 ;
"RTN","XUAF4",157,0)
 Q
"RTN","XUAF4",158,0)
 ;
"RTN","XUAF4",159,0)
IDT(IEN) ; inactive date
"RTN","XUAF4",160,0)
 N IDT,ND,XDT
"RTN","XUAF4",161,0)
 S IEN=$G(IEN) Q:'IEN IEN
"RTN","XUAF4",162,0)
 S XDT=9999999,IDT=""
"RTN","XUAF4",163,0)
 F  S XDT=$O(^DIC(4,+IEN,999,XDT),-1) Q:'XDT  D  Q:IDT
"RTN","XUAF4",164,0)
 .S ND=$G(^DIC(4,+IEN,999,XDT,0)) Q:ND="" ND
"RTN","XUAF4",165,0)
 .S IDT=$S($P(ND,U,5):XDT,$P(ND,U,7):XDT,1:IDT)
"RTN","XUAF4",166,0)
 Q IDT
"RTN","XUAF4",167,0)
 ;
"RTN","XUAF4",168,0)
SCRN() ;sreen IEN
"RTN","XUAF4",169,0)
 N X S X=$E(N99,1,3)
"RTN","XUAF4",170,0)
 I FLAG["A",$P(N99,U,4) Q "0^inactive facility"
"RTN","XUAF4",171,0)
 I FLAG["M",$S(X<400:1,X>759:1,X<700:0,X<750:1,1:0) Q "0^not a treating facility"
"RTN","XUAF4",172,0)
 Q IEN
"RTN","XUAF4",173,0)
 ;
"RTN","XUAF4",174,0)
SCREEN(FLAGS,SCREEN) ; -- set up SCREEN for LKUP
"RTN","XUAF4",175,0)
 ;
"RTN","XUAF4",176,0)
 ;INPUT
"RTN","XUAF4",177,0)
 ;       FLAG            Flag type of entry to return:
"RTN","XUAF4",178,0)
 ;
"RTN","XUAF4",179,0)
 ;                         "V" facility type of VAMC
"RTN","XUAF4",180,0)
 ;                         "M" facility type of M&ROC or VAMC
"RTN","XUAF4",181,0)
 ;                         "C" facility type of CBOC
"RTN","XUAF4",182,0)
 ;                         "A" active (not INACTIVE)
"RTN","XUAF4",183,0)
 ;                         "I" inactive (not active)
"RTN","XUAF4",184,0)
 ;                         "N" national (not local)
"RTN","XUAF4",185,0)
 ;                         "L" local (not national)
"RTN","XUAF4",186,0)
 ;                         "T" treating facility
"RTN","XUAF4",187,0)
 ;                         "L" legacy facility
"RTN","XUAF4",188,0)
 ;                         "P" primary facility
"RTN","XUAF4",189,0)
 ;
"RTN","XUAF4",190,0)
 ;OUTPUT
"RTN","XUAF4",191,0)
 ;       $$              '1' call successful or '0^error message'
"RTN","XUAF4",192,0)
 ;       SCREEN          see $$FIND1^DIC() in
"RTN","XUAF4",193,0)
 ;       INDEXES         FileMan documentation
"RTN","XUAF4",194,0)
 ;       FLAGS           for output values
"RTN","XUAF4",195,0)
 ;
"RTN","XUAF4",196,0)
 Q "0^coming soon"
"RTN","XUAF4",197,0)
 ;
"RTN","XUAF4",198,0)
INDEXES(FLAGS,INDEXES) ; -- set up INDEXES for LKUP
"RTN","XUAF4",199,0)
 ;
"RTN","XUAF4",200,0)
 Q "0^coming soon"
"RTN","XUAF4",201,0)
 ;
"RTN","XUMF4")
0^2^B78125863
"RTN","XUMF4",1,0)
XUMF4 ;CIOFO-SF/RAM - Institution File Clean Up; 06/28/00
"RTN","XUMF4",2,0)
 ;;8.0;KERNEL;**206,209**;Jul 10, 1995
"RTN","XUMF4",3,0)
 ;
"RTN","XUMF4",4,0)
 ;
"RTN","XUMF4",5,0)
EN ; -- entry point
"RTN","XUMF4",6,0)
 ;
"RTN","XUMF4",7,0)
 K ^TMP("XUMF ARRAY",$J)
"RTN","XUMF4",8,0)
 ;
"RTN","XUMF4",9,0)
 N PARAM,XUMFLAG,ERROR
"RTN","XUMF4",10,0)
 ;
"RTN","XUMF4",11,0)
 S ERROR=0,XUMFLAG=0
"RTN","XUMF4",12,0)
 ;
"RTN","XUMF4",13,0)
 ;next line -- temp solution to an HL7 direct connect issue
"RTN","XUMF4",14,0)
 S ERROR=$$LINK() I ERROR D ^%ZISC W !!,ERROR,!! Q
"RTN","XUMF4",15,0)
 ;
"RTN","XUMF4",16,0)
 L +^TMP("XUMF ARRAY",$J):0 D:'$T
"RTN","XUMF4",17,0)
 .S ERROR="1^another process is using the Master File Server"
"RTN","XUMF4",18,0)
 ;
"RTN","XUMF4",19,0)
 I ERROR D EXIT1 Q
"RTN","XUMF4",20,0)
 ;
"RTN","XUMF4",21,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D
"RTN","XUMF4",22,0)
 .W !!,"...connecting with master file server..."
"RTN","XUMF4",23,0)
 .D MFS0
"RTN","XUMF4",24,0)
 ;
"RTN","XUMF4",25,0)
 I ERROR D EXIT1 Q
"RTN","XUMF4",26,0)
 ;
"RTN","XUMF4",27,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D  D EXIT1 Q
"RTN","XUMF4",28,0)
 .S ERROR="Connection to master file server failed!"
"RTN","XUMF4",29,0)
 ;
"RTN","XUMF4",30,0)
 D FTCLEAN^XUMF4A I ERROR D EXIT1 Q
"RTN","XUMF4",31,0)
 ;
"RTN","XUMF4",32,0)
 ;next line -- temp solution to an HL7 direct connect issue
"RTN","XUMF4",33,0)
 S ERROR=$$LINK() I ERROR D ^%ZISC,EXIT1 Q
"RTN","XUMF4",34,0)
 ;
"RTN","XUMF4",35,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J)
"RTN","XUMF4",36,0)
 ;
"RTN","XUMF4",37,0)
 W !!,"...connecting with master file server..."
"RTN","XUMF4",38,0)
 D MFS1
"RTN","XUMF4",39,0)
 ;
"RTN","XUMF4",40,0)
 I ERROR D EXIT1 Q
"RTN","XUMF4",41,0)
 ;
"RTN","XUMF4",42,0)
 I '$D(^TMP("XUMF ARRAY",$J)) D  Q
"RTN","XUMF4",43,0)
 .S ERROR="Connection to master file server failed!"
"RTN","XUMF4",44,0)
 .D EXIT1
"RTN","XUMF4",45,0)
 ;
"RTN","XUMF4",46,0)
 D EN^VALM("XUMF NAME")
"RTN","XUMF4",47,0)
 ;
"RTN","XUMF4",48,0)
 D EXIT1
"RTN","XUMF4",49,0)
 ;
"RTN","XUMF4",50,0)
 Q
"RTN","XUMF4",51,0)
 ;
"RTN","XUMF4",52,0)
RDSN ; - resolve duplicate station number
"RTN","XUMF4",53,0)
 ;
"RTN","XUMF4",54,0)
 I '$O(@VALMAR@("INDEX",0)) D  Q
"RTN","XUMF4",55,0)
 .W !!,"No duplicates to select from!",!
"RTN","XUMF4",56,0)
 .S VALMBCK="R" H 2
"RTN","XUMF4",57,0)
 ;
"RTN","XUMF4",58,0)
 N ENTRY,VALMY,DA,DR,DIE,STA,MERGED,FROM
"RTN","XUMF4",59,0)
 ;
"RTN","XUMF4",60,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","XUMF4",61,0)
 ;
"RTN","XUMF4",62,0)
 S DA=@VALMAR@("INDEX",+$O(VALMY(0)))
"RTN","XUMF4",63,0)
 S DR="99///@",DIE=4
"RTN","XUMF4",64,0)
 I DA D
"RTN","XUMF4",65,0)
 .I $O(^HLCS(870,"C",DA,0)) D  Q
"RTN","XUMF4",66,0)
 ..W !!?20,"Pointed to by HL7 Logical Link"
"RTN","XUMF4",67,0)
 ..W !?22,"*select other entry*",!!
"RTN","XUMF4",68,0)
 .D ^DIE
"RTN","XUMF4",69,0)
 ;
"RTN","XUMF4",70,0)
 D @($E($P(VALMAR,"XUMF ",2),1,4)_"^XUMF4")
"RTN","XUMF4",71,0)
 S VALMBCK="R"
"RTN","XUMF4",72,0)
 ;
"RTN","XUMF4",73,0)
 Q
"RTN","XUMF4",74,0)
 ;
"RTN","XUMF4",75,0)
 ;
"RTN","XUMF4",76,0)
DSTA ; -- duplicate station #s
"RTN","XUMF4",77,0)
 ;
"RTN","XUMF4",78,0)
 K ^TMP("XUMF DSTA",$J),^TMP("XUMF TMP",$J)
"RTN","XUMF4",79,0)
 ;
"RTN","XUMF4",80,0)
 I 'XUMFLAG D LOCAL
"RTN","XUMF4",81,0)
 ;
"RTN","XUMF4",82,0)
 S STA="",IEN=0
"RTN","XUMF4",83,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",84,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",85,0)
 ..Q:'$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",86,0)
 ..S ^TMP("XUMF TMP",$J,STA,IEN)=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",87,0)
 ;
"RTN","XUMF4",88,0)
 S STA="",(VALMCNT,IEN)=0
"RTN","XUMF4",89,0)
 F  S STA=$O(^TMP("XUMF TMP",$J,STA)) Q:STA=""  D
"RTN","XUMF4",90,0)
 .Q:'$O(^TMP("XUMF TMP",$J,STA,+$O(^TMP("XUMF TMP",$J,STA,0))))
"RTN","XUMF4",91,0)
 .F  S IEN=$O(^TMP("XUMF TMP",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4",92,0)
 ..S VALMCNT=VALMCNT+1
"RTN","XUMF4",93,0)
 ..S VAR="",NAME=$P(^TMP("XUMF TMP",$J,STA,IEN),U)
"RTN","XUMF4",94,0)
 ..S VAR=$$SETFLD^VALM1(VALMCNT,VAR,"ENTRY NUMBER")
"RTN","XUMF4",95,0)
 ..S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",96,0)
 ..S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",97,0)
 ..S VAR=$$SETFLD^VALM1(IEN,VAR,"IEN")
"RTN","XUMF4",98,0)
 ..D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",99,0)
 ..S @VALMAR@("INDEX",VALMCNT)=IEN
"RTN","XUMF4",100,0)
 ;
"RTN","XUMF4",101,0)
 D:'VALMCNT
"RTN","XUMF4",102,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***No duplicates***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",103,0)
 .S VALMCNT=1
"RTN","XUMF4",104,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",105,0)
 ;
"RTN","XUMF4",106,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4",107,0)
 ;
"RTN","XUMF4",108,0)
 Q
"RTN","XUMF4",109,0)
 ;
"RTN","XUMF4",110,0)
LOCAL ; -- auto-delete local/duplicate station numbers
"RTN","XUMF4",111,0)
 ;
"RTN","XUMF4",112,0)
 W !!,"This action will auto-delete local/duplicate station numbers."
"RTN","XUMF4",113,0)
 N Y S DIR(0)="Y",DIR("B")="YES" W !
"RTN","XUMF4",114,0)
 S DIR("A")="Do you wish to proceed"
"RTN","XUMF4",115,0)
 D ^DIR K DIR I 'Y Q
"RTN","XUMF4",116,0)
 ;
"RTN","XUMF4",117,0)
 S XUMFLAG=1
"RTN","XUMF4",118,0)
 D DXRF
"RTN","XUMF4",119,0)
 ;
"RTN","XUMF4",120,0)
 N IEN,STA,STANUM,VAR,NAME,FLAG,CNT
"RTN","XUMF4",121,0)
 ;
"RTN","XUMF4",122,0)
 S STA="",(IEN,CNT)=0
"RTN","XUMF4",123,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",124,0)
 .Q:'$O(^DIC(4,"D",STA,+$O(^DIC(4,"D",STA,0))))
"RTN","XUMF4",125,0)
 .S FLAG=0
"RTN","XUMF4",126,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",127,0)
 ..S:$O(^HLCS(870,"C",IEN,0)) FLAG=1
"RTN","XUMF4",128,0)
 .Q:'FLAG
"RTN","XUMF4",129,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",130,0)
 ..Q:$O(^HLCS(870,"C",IEN,0))
"RTN","XUMF4",131,0)
 ..W !?5,"deleting duplicate station number ",STA," from IEN: ",IEN
"RTN","XUMF4",132,0)
 ..H 1
"RTN","XUMF4",133,0)
 ..S DR="99///@",DIE=4,DA=IEN,CNT=CNT+1
"RTN","XUMF4",134,0)
 ..N IEN,STA,FLAG D ^DIE
"RTN","XUMF4",135,0)
 I CNT D EOP S CNT=0
"RTN","XUMF4",136,0)
 ;
"RTN","XUMF4",137,0)
 S STA="",IEN=0
"RTN","XUMF4",138,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",139,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",140,0)
 .Q:'$D(^TMP("XUMF ARRAY",$J))
"RTN","XUMF4",141,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4",142,0)
 ..S DR="99///@",DIE=4,DA=IEN,CNT=CNT+1
"RTN","XUMF4",143,0)
 ..W !?5,"deleting local station number ",STA," from IEN: ",IEN
"RTN","XUMF4",144,0)
 ..H 1
"RTN","XUMF4",145,0)
 ..N IEN,STA D ^DIE
"RTN","XUMF4",146,0)
 I CNT D EOP S CNT=0
"RTN","XUMF4",147,0)
 ;
"RTN","XUMF4",148,0)
 Q
"RTN","XUMF4",149,0)
 ;
"RTN","XUMF4",150,0)
 ;
"RTN","XUMF4",151,0)
DXRF ; -- re-index "D" cross-reference
"RTN","XUMF4",152,0)
 ;
"RTN","XUMF4",153,0)
 N DIK
"RTN","XUMF4",154,0)
 ;
"RTN","XUMF4",155,0)
 K ^DIC(4,"D")
"RTN","XUMF4",156,0)
 ;
"RTN","XUMF4",157,0)
 S DIK="^DIC(4,",DIK(1)="99^D" D ENALL^DIK
"RTN","XUMF4",158,0)
 ;
"RTN","XUMF4",159,0)
 Q
"RTN","XUMF4",160,0)
 ;
"RTN","XUMF4",161,0)
 ;
"RTN","XUMF4",162,0)
LLCL ; -- local data
"RTN","XUMF4",163,0)
 ;
"RTN","XUMF4",164,0)
 K ^TMP("XUMF LLCL",$J)
"RTN","XUMF4",165,0)
 ;
"RTN","XUMF4",166,0)
 N STA,IEN,STANUM,VAR,NAME,FTYP
"RTN","XUMF4",167,0)
 ;
"RTN","XUMF4",168,0)
 S STA="",VALMCNT=0
"RTN","XUMF4",169,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",170,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4",171,0)
 .S FTYP=$P($G(^DIC(4.1,+$G(^DIC(4,+IEN,3)),0)),U)
"RTN","XUMF4",172,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4",173,0)
 .S VALMCNT=VALMCNT+1
"RTN","XUMF4",174,0)
 .S VAR="",NAME=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",175,0)
 .S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",176,0)
 .S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",177,0)
 .S VAR=$$SETFLD^VALM1(IEN,VAR,"IEN")
"RTN","XUMF4",178,0)
 .S VAR=$$SETFLD^VALM1(FTYP,VAR,"FACILITY TYPE")
"RTN","XUMF4",179,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",180,0)
 .S @VALMAR@("INDEX",VALMCNT)=IEN
"RTN","XUMF4",181,0)
 ;
"RTN","XUMF4",182,0)
 D:'VALMCNT
"RTN","XUMF4",183,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",184,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",185,0)
 ;
"RTN","XUMF4",186,0)
 Q
"RTN","XUMF4",187,0)
 ;
"RTN","XUMF4",188,0)
 ;
"RTN","XUMF4",189,0)
NATL ; -- national data to merge
"RTN","XUMF4",190,0)
 ;
"RTN","XUMF4",191,0)
 K ^TMP("XUMF NATL",$J)
"RTN","XUMF4",192,0)
 ;
"RTN","XUMF4",193,0)
 N STA,VAR,NAME,TYPE,STATE
"RTN","XUMF4",194,0)
 ;
"RTN","XUMF4",195,0)
 S STA="",VALMCNT=0
"RTN","XUMF4",196,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4",197,0)
 .Q:$D(^DIC(4,"D",STA))
"RTN","XUMF4",198,0)
 .S VALMCNT=VALMCNT+1
"RTN","XUMF4",199,0)
 .S VAR="",NAME=$P(^TMP("XUMF ARRAY",$J,STA),U,2)
"RTN","XUMF4",200,0)
 .S TYPE=$P($P(^TMP("XUMF ARRAY",$J,STA),U,5),"~")
"RTN","XUMF4",201,0)
 .S STATE=$P(^TMP("XUMF ARRAY",$J,STA),U,8)
"RTN","XUMF4",202,0)
 .S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",203,0)
 .S VAR=$$SETFLD^VALM1(NAME,VAR,"NATIONAL NAME")
"RTN","XUMF4",204,0)
 .S VAR=$$SETFLD^VALM1(STATE,VAR,"STATE")
"RTN","XUMF4",205,0)
 .S VAR=$$SETFLD^VALM1(TYPE,VAR,"TYPE")
"RTN","XUMF4",206,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",207,0)
 ;
"RTN","XUMF4",208,0)
 D:'VALMCNT
"RTN","XUMF4",209,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"NATIONAL NAME")
"RTN","XUMF4",210,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",211,0)
 ;
"RTN","XUMF4",212,0)
 Q
"RTN","XUMF4",213,0)
 ;
"RTN","XUMF4",214,0)
 ;
"RTN","XUMF4",215,0)
NAME ; -- compare INSTITUTION name vs national name
"RTN","XUMF4",216,0)
 ;
"RTN","XUMF4",217,0)
 K ^TMP("XUMF NAME",$J),^TMP("XUMF TABLE",$J)
"RTN","XUMF4",218,0)
 ;
"RTN","XUMF4",219,0)
 N STA,IEN,NAME,GOLD,NAME,VAR,ARRAY
"RTN","XUMF4",220,0)
 ;
"RTN","XUMF4",221,0)
 D DXRF
"RTN","XUMF4",222,0)
 ;
"RTN","XUMF4",223,0)
 S STA="",(IEN,VALMCNT)=0
"RTN","XUMF4",224,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4",225,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4",226,0)
 .S GOLD=$P($G(^TMP("XUMF ARRAY",$J,STA)),U,2)
"RTN","XUMF4",227,0)
 .S NAME=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4",228,0)
 .S ^TMP("XUMF TABLE",$J,STA,IEN)=NAME_U_GOLD
"RTN","XUMF4",229,0)
 ;
"RTN","XUMF4",230,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4",231,0)
 .Q:$D(^TMP("XUMF TABLE",$J,STA))
"RTN","XUMF4",232,0)
 .S NAME=$P(^TMP("XUMF ARRAY",$J,STA),U,2)
"RTN","XUMF4",233,0)
 .S ^TMP("XUMF TABLE",$J,STA,9999)="^"_NAME
"RTN","XUMF4",234,0)
 ;
"RTN","XUMF4",235,0)
 S (IEN,VALMCNT)=0
"RTN","XUMF4",236,0)
 F  S STA=$O(^TMP("XUMF TABLE",$J,STA)) Q:STA=""  D
"RTN","XUMF4",237,0)
 .F  S IEN=$O(^TMP("XUMF TABLE",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4",238,0)
 ..S GOLD=$P(^TMP("XUMF TABLE",$J,STA,IEN),U,2)
"RTN","XUMF4",239,0)
 ..S NAME=$P(^TMP("XUMF TABLE",$J,STA,IEN),U)
"RTN","XUMF4",240,0)
 ..S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4",241,0)
 ..S VAR=$$SETFLD^VALM1(STA,VAR,"STATION NUMBER")
"RTN","XUMF4",242,0)
 ..S VAR=$$SETFLD^VALM1(NAME,VAR,"INSTITUTION NAME")
"RTN","XUMF4",243,0)
 ..S VAR=$$SETFLD^VALM1(GOLD,VAR,"GOLD NAME")
"RTN","XUMF4",244,0)
 ..D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4",245,0)
 ;
"RTN","XUMF4",246,0)
 D:'VALMCNT
"RTN","XUMF4",247,0)
 .S VAR="",VAR=$$SETFLD^VALM1("***None found***",VAR,"INSTITUTION NAME")
"RTN","XUMF4",248,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4",249,0)
 ;
"RTN","XUMF4",250,0)
 K ^TMP("XUMF TABLE",$J)
"RTN","XUMF4",251,0)
 ;
"RTN","XUMF4",252,0)
 Q
"RTN","XUMF4",253,0)
 ;
"RTN","XUMF4",254,0)
 ;
"RTN","XUMF4",255,0)
MFS0 ; -- get national facility type file from Master File Server
"RTN","XUMF4",256,0)
 ;
"RTN","XUMF4",257,0)
 D FACTYP^XUMF4A
"RTN","XUMF4",258,0)
 D STATE^XUMF4A
"RTN","XUMF4",259,0)
 ;
"RTN","XUMF4",260,0)
 S PARAM("LLNK")="XUMF MFR^XUMF FORUM"
"RTN","XUMF4",261,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF4",262,0)
 ;
"RTN","XUMF4",263,0)
 W !!,"...getting FACILITY TYPE file..."
"RTN","XUMF4",264,0)
 D MAIN^XUMFP(4.1,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",265,0)
 D MAIN^XUMFI(4.1,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",266,0)
 D MAIN^XUMFH
"RTN","XUMF4",267,0)
 ;
"RTN","XUMF4",268,0)
 Q
"RTN","XUMF4",269,0)
 ;
"RTN","XUMF4",270,0)
MFS1 ; -- get national facility type file from Master File Server
"RTN","XUMF4",271,0)
 ;
"RTN","XUMF4",272,0)
 S PARAM("LLNK")="XUMF MFR^XUMF FORUM"
"RTN","XUMF4",273,0)
 S PARAM("PROTOCOL")=$O(^ORD(101,"B","XUMF MFQ",0))
"RTN","XUMF4",274,0)
 ;
"RTN","XUMF4",275,0)
 W !!,"...getting INSTITUTION file..."
"RTN","XUMF4",276,0)
 W !,"...please wait...(approx. 5 minutes)..."
"RTN","XUMF4",277,0)
 D MAIN^XUMFP(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",278,0)
 D MAIN^XUMFI(4,"ALL",7,.PARAM,.ERROR) Q:ERROR
"RTN","XUMF4",279,0)
 D MAIN^XUMFH
"RTN","XUMF4",280,0)
 ;
"RTN","XUMF4",281,0)
 Q
"RTN","XUMF4",282,0)
 ;
"RTN","XUMF4",283,0)
EXIT ; -- cleanup and quit
"RTN","XUMF4",284,0)
 ;
"RTN","XUMF4",285,0)
 K:$D(VALMAR) @VALMAR
"RTN","XUMF4",286,0)
 ;
"RTN","XUMF4",287,0)
 Q
"RTN","XUMF4",288,0)
 ;
"RTN","XUMF4",289,0)
EXIT1 ;
"RTN","XUMF4",290,0)
 ;
"RTN","XUMF4",291,0)
 K ^TMP("XUMF ARRAY",$J),^TMP("XUMF MFS",$J)
"RTN","XUMF4",292,0)
 K ^TMP("DIERR",$J)
"RTN","XUMF4",293,0)
 ;
"RTN","XUMF4",294,0)
 L -^TMP("XUMF ARRAY",$J)
"RTN","XUMF4",295,0)
 ;
"RTN","XUMF4",296,0)
 I ERROR D
"RTN","XUMF4",297,0)
 .D ERRB^XUMFH("IFR clean up",ERROR,"XUMF INSTITUTION",.ERR)
"RTN","XUMF4",298,0)
 .W !!,ERROR,!,$G(ERR),!
"RTN","XUMF4",299,0)
 ;
"RTN","XUMF4",300,0)
 Q
"RTN","XUMF4",301,0)
 ;
"RTN","XUMF4",302,0)
EOP ; -- End-of-Page
"RTN","XUMF4",303,0)
 ;
"RTN","XUMF4",304,0)
 S DIR(0)="E"
"RTN","XUMF4",305,0)
 D ^DIR,CLEAR^VALM1
"RTN","XUMF4",306,0)
 S VALMBCK="R"
"RTN","XUMF4",307,0)
 ;
"RTN","XUMF4",308,0)
 Q
"RTN","XUMF4",309,0)
 ;
"RTN","XUMF4",310,0)
LINK() ;temp solution to an HL7 direct connect issue
"RTN","XUMF4",311,0)
 N FORUM,MSG
"RTN","XUMF4",312,0)
 S FORUM=$O(^HLCS(870,"B","XUMF FORUM",0))
"RTN","XUMF4",313,0)
 I 'FORUM D  Q "1^"_$G(MSG)
"RTN","XUMF4",314,0)
 .S MSG="Error -- no logical link to FORUM defined -- contact NVS"
"RTN","XUMF4",315,0)
 S MSG=$O(^HLMA("AC","O",FORUM,0)) Q:'MSG 0
"RTN","XUMF4",316,0)
 S MSG="Error -- unprocessed message to FORUM in queue -- contact NVS"
"RTN","XUMF4",317,0)
 Q "1^"_$G(MSG)
"RTN","XUMF4",318,0)
 ;
"RTN","XUMF4A")
0^12^B54733421
"RTN","XUMF4A",1,0)
XUMF4A ;CIOFO-SF/RAM - Institution File Clean Up; 06/28/99
"RTN","XUMF4A",2,0)
 ;;8.0;KERNEL;**206,209**;Jul 10, 1995
"RTN","XUMF4A",3,0)
 ;
"RTN","XUMF4A",4,0)
 ;
"RTN","XUMF4A",5,0)
EN ; -- entry point
"RTN","XUMF4A",6,0)
 ;
"RTN","XUMF4A",7,0)
 I $$CDSN D  Q
"RTN","XUMF4A",8,0)
 .D MSG^VALM10("Duplicates sta #s exist! -- NOTHING UPDATED!!!")
"RTN","XUMF4A",9,0)
 .H 5
"RTN","XUMF4A",10,0)
 .S VALMBCK="R"
"RTN","XUMF4A",11,0)
 ;
"RTN","XUMF4A",12,0)
 W "...working",!
"RTN","XUMF4A",13,0)
 D DSN,CSN,GOLD,ASSC,HIST
"RTN","XUMF4A",14,0)
 ;
"RTN","XUMF4A",15,0)
 K ^TMP("XUMF NAME",$J)
"RTN","XUMF4A",16,0)
 D NAME^XUMF4
"RTN","XUMF4A",17,0)
 S VALMBG=1
"RTN","XUMF4A",18,0)
 S VALMBCK="R"
"RTN","XUMF4A",19,0)
 ;
"RTN","XUMF4A",20,0)
 Q
"RTN","XUMF4A",21,0)
 ;
"RTN","XUMF4A",22,0)
DSN ; -- clean out local station numbers
"RTN","XUMF4A",23,0)
 ;
"RTN","XUMF4A",24,0)
 N IEN,DIE,DR,DA,XUMF,DIK
"RTN","XUMF4A",25,0)
 ;
"RTN","XUMF4A",26,0)
 S XUMF=7
"RTN","XUMF4A",27,0)
 ;
"RTN","XUMF4A",28,0)
 S IEN=0
"RTN","XUMF4A",29,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF4A",30,0)
 .S STA=$P($G(^DIC(4,+IEN,99)),U) Q:STA=""
"RTN","XUMF4A",31,0)
 .Q:$D(^TMP("XUMF ARRAY",$J,STA))
"RTN","XUMF4A",32,0)
 .S DR="99///@",DIE=4,DA=IEN
"RTN","XUMF4A",33,0)
 .D
"RTN","XUMF4A",34,0)
 ..N IEN D ^DIE
"RTN","XUMF4A",35,0)
 ;
"RTN","XUMF4A",36,0)
 S STA="",IEN=0
"RTN","XUMF4A",37,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4A",38,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",39,0)
 ..Q:$P($G(^DIC(4,+IEN,99)),U)=STA
"RTN","XUMF4A",40,0)
 ..K ^DIC(4,"D",STA,IEN)
"RTN","XUMF4A",41,0)
 ;
"RTN","XUMF4A",42,0)
 S DIK="^DIC(4,",DIK(1)="99^D" D ENALL^DIK
"RTN","XUMF4A",43,0)
 ;
"RTN","XUMF4A",44,0)
 Q
"RTN","XUMF4A",45,0)
 ;
"RTN","XUMF4A",46,0)
CSN ; -- check/update status
"RTN","XUMF4A",47,0)
 ;
"RTN","XUMF4A",48,0)
 N IEN,DIE,DR,DA,XUMF,STATUS,STA
"RTN","XUMF4A",49,0)
 ;
"RTN","XUMF4A",50,0)
 S XUMF=7
"RTN","XUMF4A",51,0)
 ;
"RTN","XUMF4A",52,0)
 S IEN=0
"RTN","XUMF4A",53,0)
 F  S IEN=$O(^DIC(4,IEN)) Q:'IEN  D
"RTN","XUMF4A",54,0)
 .S STA=$P($G(^DIC(4,+IEN,99)),U)
"RTN","XUMF4A",55,0)
 .I STA S DR="11///N",DIE=4,DA=IEN D  Q
"RTN","XUMF4A",56,0)
 ..N IEN D ^DIE
"RTN","XUMF4A",57,0)
 .S STATUS=$P(^DIC(4,IEN,0),U,11)
"RTN","XUMF4A",58,0)
 .I STATUS="I" S DR="101///I",DIE=4,DA=IEN D
"RTN","XUMF4A",59,0)
 ..N IEN D ^DIE
"RTN","XUMF4A",60,0)
 .S DR="11///L",DIE=4,DA=IEN D
"RTN","XUMF4A",61,0)
 ..N IEN D ^DIE
"RTN","XUMF4A",62,0)
 ;
"RTN","XUMF4A",63,0)
 Q
"RTN","XUMF4A",64,0)
 ;
"RTN","XUMF4A",65,0)
GOLD ; -- add missing national data from standard table
"RTN","XUMF4A",66,0)
 ;
"RTN","XUMF4A",67,0)
 N STA,NAME,FDA,ERROR,IEN,IENS,X,FLAG,CNT
"RTN","XUMF4A",68,0)
 N OLDNAME,OLDVANM,STATE,FACTYP,XUMF
"RTN","XUMF4A",69,0)
 ;
"RTN","XUMF4A",70,0)
 S XUMF=7
"RTN","XUMF4A",71,0)
 ;
"RTN","XUMF4A",72,0)
 S STA="",CNT=0
"RTN","XUMF4A",73,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",74,0)
 .S X=^TMP("XUMF ARRAY",$J,STA)
"RTN","XUMF4A",75,0)
 .S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4A",76,0)
 .S OLDNAME=$P($G(^DIC(4,+IEN,0)),U,1)
"RTN","XUMF4A",77,0)
 .S OLDVANM=$P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUMF4A",78,0)
 .S IENS=$S(IEN:IEN_",",1:"+1,")
"RTN","XUMF4A",79,0)
 .S NAME=$P(X,U,2)
"RTN","XUMF4A",80,0)
 .S FACTYP=$P(X,U,5)
"RTN","XUMF4A",81,0)
 .S VANAME=$P(X,U,6)
"RTN","XUMF4A",82,0)
 .S FLAG=$P(X,U,7)
"RTN","XUMF4A",83,0)
 .S STATE=$P(X,U,8)
"RTN","XUMF4A",84,0)
 .K FDA
"RTN","XUMF4A",85,0)
 .S FDA(4,IENS,.01)=NAME
"RTN","XUMF4A",86,0)
 .S FDA(4,IENS,.02)=STATE
"RTN","XUMF4A",87,0)
 .S FDA(4,IENS,99)=STA
"RTN","XUMF4A",88,0)
 .S FDA(4,IENS,11)="NATIONAL"
"RTN","XUMF4A",89,0)
 .S FDA(4,IENS,13)=$P(FACTYP,"~")
"RTN","XUMF4A",90,0)
 .S FDA(4,IENS,100)=VANAME
"RTN","XUMF4A",91,0)
 .S FDA(4,IENS,101)=FLAG
"RTN","XUMF4A",92,0)
 .D
"RTN","XUMF4A",93,0)
 ..N IEN,STA,NAME,VANAME,OLDNAME,OLDVANM
"RTN","XUMF4A",94,0)
 ..D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF4A",95,0)
 .I 'IEN S IEN=$O(^DIC(4,"D",STA,0))
"RTN","XUMF4A",96,0)
 .Q:'IEN
"RTN","XUMF4A",97,0)
 .I OLDNAME="" Q
"RTN","XUMF4A",98,0)
 .I OLDNAME=NAME,VANAME=OLDVANM Q
"RTN","XUMF4A",99,0)
 .S IENS="?+"_DT_","_IEN_","
"RTN","XUMF4A",100,0)
 .K FDA
"RTN","XUMF4A",101,0)
 .S FDA(4.999,IENS,.01)=DT
"RTN","XUMF4A",102,0)
 .S:NAME'=OLDNAME FDA(4.999,IENS,.02)=OLDNAME
"RTN","XUMF4A",103,0)
 .S:VANAME'=OLDVANM FDA(4.999,IENS,.03)=OLDVANM
"RTN","XUMF4A",104,0)
 .D
"RTN","XUMF4A",105,0)
 ..N STA
"RTN","XUMF4A",106,0)
 ..D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF4A",107,0)
 ..S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",108,0)
 ;
"RTN","XUMF4A",109,0)
 Q
"RTN","XUMF4A",110,0)
 ;
"RTN","XUMF4A",111,0)
ASSC ; -- populate associations (parent facility and VISN)
"RTN","XUMF4A",112,0)
 ;
"RTN","XUMF4A",113,0)
 N IEN,STA,VISN,PARENT,FDA,XUMF,CNT
"RTN","XUMF4A",114,0)
 ;
"RTN","XUMF4A",115,0)
 S XUMF=7
"RTN","XUMF4A",116,0)
 ;
"RTN","XUMF4A",117,0)
 S STA="",CNT=0
"RTN","XUMF4A",118,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",119,0)
 .S IEN=$O(^DIC(4,"D",STA,0)) Q:'IEN
"RTN","XUMF4A",120,0)
 .S VISN=$P(^TMP("XUMF ARRAY",$J,STA),U,9)
"RTN","XUMF4A",121,0)
 .I VISN'="" D
"RTN","XUMF4A",122,0)
 ..K FDA
"RTN","XUMF4A",123,0)
 ..S IENS="?+1,"_IEN_","
"RTN","XUMF4A",124,0)
 ..S FDA(4.014,IENS,.01)="VISN"
"RTN","XUMF4A",125,0)
 ..S FDA(4.014,IENS,1)=$P(VISN,"~")
"RTN","XUMF4A",126,0)
 ..D
"RTN","XUMF4A",127,0)
 ...N IEN,STA
"RTN","XUMF4A",128,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",129,0)
 .S PARENT=$P(^TMP("XUMF ARRAY",$J,STA),U,10)
"RTN","XUMF4A",130,0)
 .I PARENT'="" D
"RTN","XUMF4A",131,0)
 ..K FDA
"RTN","XUMF4A",132,0)
 ..S IENS="?+2,"_IEN_","
"RTN","XUMF4A",133,0)
 ..S FDA(4.014,IENS,.01)="PARENT FACILITY"
"RTN","XUMF4A",134,0)
 ..S FDA(4.014,IENS,1)=PARENT
"RTN","XUMF4A",135,0)
 ..D
"RTN","XUMF4A",136,0)
 ...N IEN,STA
"RTN","XUMF4A",137,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",138,0)
 ...S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",139,0)
 ;
"RTN","XUMF4A",140,0)
 Q
"RTN","XUMF4A",141,0)
 ;
"RTN","XUMF4A",142,0)
HIST ; -- history
"RTN","XUMF4A",143,0)
 ;
"RTN","XUMF4A",144,0)
 N IEN,STA,EFFDT,FDA,XUMF,CNT
"RTN","XUMF4A",145,0)
 ;
"RTN","XUMF4A",146,0)
 S XUMF=7
"RTN","XUMF4A",147,0)
 ;
"RTN","XUMF4A",148,0)
 S STA="",CNT=0
"RTN","XUMF4A",149,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",150,0)
 .S IEN=$O(^DIC(4,"D",STA,0)) Q:'IEN
"RTN","XUMF4A",151,0)
 .S EFFDT=$P(^TMP("XUMF ARRAY",$J,STA),U,11)
"RTN","XUMF4A",152,0)
 .S EFFDT=$$FMDATE^HLFNC(+EFFDT)
"RTN","XUMF4A",153,0)
 .I EFFDT D
"RTN","XUMF4A",154,0)
 ..S IENS="?+"_EFFDT_","_IEN_","
"RTN","XUMF4A",155,0)
 ..K FDA
"RTN","XUMF4A",156,0)
 ..S FDA(4.999,IENS,.01)=EFFDT
"RTN","XUMF4A",157,0)
 ..S FDA(4.999,IENS,.06)=$P(^TMP("XUMF ARRAY",$J,STA),U,12)
"RTN","XUMF4A",158,0)
 ..D
"RTN","XUMF4A",159,0)
 ...N IEN,STA
"RTN","XUMF4A",160,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",161,0)
 .S EFFDT=$P(^TMP("XUMF ARRAY",$J,STA),U,13)
"RTN","XUMF4A",162,0)
 .S EFFDT=$$FMDATE^HLFNC(+EFFDT)
"RTN","XUMF4A",163,0)
 .I EFFDT D
"RTN","XUMF4A",164,0)
 ..S IENS="?+"_EFFDT_","_IEN_","
"RTN","XUMF4A",165,0)
 ..K FDA
"RTN","XUMF4A",166,0)
 ..S FDA(4.999,IENS,.01)=EFFDT
"RTN","XUMF4A",167,0)
 ..S FDA(4.999,IENS,.05)=$P(^TMP("XUMF ARRAY",$J,STA),U,14)
"RTN","XUMF4A",168,0)
 ..D
"RTN","XUMF4A",169,0)
 ...N IEN,STA
"RTN","XUMF4A",170,0)
 ...D UPDATE^DIE("E","FDA")
"RTN","XUMF4A",171,0)
 ...S CNT=CNT+1 I '(CNT#10) W "."
"RTN","XUMF4A",172,0)
 ;
"RTN","XUMF4A",173,0)
 Q
"RTN","XUMF4A",174,0)
 ;
"RTN","XUMF4A",175,0)
CDSN() ; -- check for duplicate sta # (true=duplicates, false=none)
"RTN","XUMF4A",176,0)
 ;
"RTN","XUMF4A",177,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4A",178,0)
 ;
"RTN","XUMF4A",179,0)
 N IEN,STA,CNT
"RTN","XUMF4A",180,0)
 ;
"RTN","XUMF4A",181,0)
 S STA="",IEN=0
"RTN","XUMF4A",182,0)
 F  S STA=$O(^DIC(4,"D",STA)) Q:STA=""  D
"RTN","XUMF4A",183,0)
 .F  S IEN=$O(^DIC(4,"D",STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",184,0)
 ..S ^TMP("XUMF TMP",$J,STA,IEN)=$P(^DIC(4,IEN,0),U)
"RTN","XUMF4A",185,0)
 ;
"RTN","XUMF4A",186,0)
 S STA="",(CNT,IEN)=0
"RTN","XUMF4A",187,0)
 F  S STA=$O(^TMP("XUMF TMP",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",188,0)
 .Q:'$O(^TMP("XUMF TMP",$J,STA,+$O(^TMP("XUMF TMP",$J,STA,0))))
"RTN","XUMF4A",189,0)
 .F  S IEN=$O(^TMP("XUMF TMP",$J,STA,IEN)) Q:'IEN  D
"RTN","XUMF4A",190,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",191,0)
 ;
"RTN","XUMF4A",192,0)
 K ^TMP("XUMF TMP",$J)
"RTN","XUMF4A",193,0)
 ;
"RTN","XUMF4A",194,0)
 Q CNT
"RTN","XUMF4A",195,0)
 ;
"RTN","XUMF4A",196,0)
CMVD() ; -- check for missing national data
"RTN","XUMF4A",197,0)
 ;
"RTN","XUMF4A",198,0)
 N STA,CNT
"RTN","XUMF4A",199,0)
 ;
"RTN","XUMF4A",200,0)
 S CNT=0
"RTN","XUMF4A",201,0)
 ;
"RTN","XUMF4A",202,0)
 S STA=""
"RTN","XUMF4A",203,0)
 F  S STA=$O(^TMP("XUMF ARRAY",$J,STA)) Q:STA=""  D
"RTN","XUMF4A",204,0)
 .Q:$D(^DIC(4,"D",STA))
"RTN","XUMF4A",205,0)
 .S CNT=CNT+1
"RTN","XUMF4A",206,0)
 ;
"RTN","XUMF4A",207,0)
 Q CNT
"RTN","XUMF4A",208,0)
 ;
"RTN","XUMF4A",209,0)
CHCK ; -- check if clean up is complete
"RTN","XUMF4A",210,0)
 ;
"RTN","XUMF4A",211,0)
 N VAR,FLD
"RTN","XUMF4A",212,0)
 ;
"RTN","XUMF4A",213,0)
 K ^TMP("XUMF CHCK",$J)
"RTN","XUMF4A",214,0)
 ;
"RTN","XUMF4A",215,0)
 S VALMCNT=0
"RTN","XUMF4A",216,0)
 ;
"RTN","XUMF4A",217,0)
 I $$CDSN D
"RTN","XUMF4A",218,0)
 .S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4A",219,0)
 .S FLD="Local/Duplicate station #s exist -- use DSTA"
"RTN","XUMF4A",220,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",221,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4A",222,0)
 ;
"RTN","XUMF4A",223,0)
 I $$CMVD D
"RTN","XUMF4A",224,0)
 .S VALMCNT=VALMCNT+1,VAR=""
"RTN","XUMF4A",225,0)
 .S FLD="INSTITUTION file not updated with NATIONAL data -- use AUTO"
"RTN","XUMF4A",226,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",227,0)
 .D SET^VALM10(VALMCNT,VAR,VALMCNT)
"RTN","XUMF4A",228,0)
 ;
"RTN","XUMF4A",229,0)
 D:'VALMCNT
"RTN","XUMF4A",230,0)
 .S VAR="",FLD="CONGRATULATIONS!!!  Update complete!"
"RTN","XUMF4A",231,0)
 .S VAR=$$SETFLD^VALM1(FLD,VAR,"MSG")
"RTN","XUMF4A",232,0)
 .D SET^VALM10(1,VAR,1)
"RTN","XUMF4A",233,0)
 ;
"RTN","XUMF4A",234,0)
 Q
"RTN","XUMF4A",235,0)
 ;
"RTN","XUMF4A",236,0)
FACTYP ;resolve duplicate facility types
"RTN","XUMF4A",237,0)
 ;
"RTN","XUMF4A",238,0)
 N FT,CNT,IEN,DA,DIE,DR
"RTN","XUMF4A",239,0)
 ;
"RTN","XUMF4A",240,0)
 S FT="",(CNT,IEN)=0
"RTN","XUMF4A",241,0)
 F  S FT=$O(^DIC(4.1,"B",FT)) Q:FT=""  D
"RTN","XUMF4A",242,0)
 .F  S IEN=$O(^DIC(4.1,"B",FT,IEN)) Q:'IEN  D
"RTN","XUMF4A",243,0)
 ..Q:$E(FT,1,2)="ZZ"
"RTN","XUMF4A",244,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",245,0)
 ..Q:CNT<2
"RTN","XUMF4A",246,0)
 ..S DA=IEN,DIE=4.1
"RTN","XUMF4A",247,0)
 ..S DR=".01///ZZ"_$P($G(^DIC(4.1,+IEN,0)),U)
"RTN","XUMF4A",248,0)
 ..D ^DIE
"RTN","XUMF4A",249,0)
 .S CNT=0
"RTN","XUMF4A",250,0)
 ;
"RTN","XUMF4A",251,0)
 Q
"RTN","XUMF4A",252,0)
 ;
"RTN","XUMF4A",253,0)
STATE ;resolve duplicate states
"RTN","XUMF4A",254,0)
 ;
"RTN","XUMF4A",255,0)
 N STATE,CNT,IEN,DA,DIE,DR
"RTN","XUMF4A",256,0)
 ;
"RTN","XUMF4A",257,0)
 ;name
"RTN","XUMF4A",258,0)
 S STATE="",(CNT,IEN)=0
"RTN","XUMF4A",259,0)
 F  S STATE=$O(^DIC(5,"B",STATE)) Q:STATE=""  D
"RTN","XUMF4A",260,0)
 .F  S IEN=$O(^DIC(5,"B",STATE,IEN)) Q:'IEN  D
"RTN","XUMF4A",261,0)
 ..Q:$E(STATE,1,2)="ZZ"
"RTN","XUMF4A",262,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",263,0)
 ..Q:CNT<2
"RTN","XUMF4A",264,0)
 ..S DA=IEN,DIE=5
"RTN","XUMF4A",265,0)
 ..S DR=".01///ZZ"_$P($G(^DIC(5,+IEN,0)),U)
"RTN","XUMF4A",266,0)
 ..D ^DIE
"RTN","XUMF4A",267,0)
 .S CNT=0
"RTN","XUMF4A",268,0)
 ;
"RTN","XUMF4A",269,0)
 ;abbreviation
"RTN","XUMF4A",270,0)
 S STATE="",(CNT,IEN)=0
"RTN","XUMF4A",271,0)
 F  S STATE=$O(^DIC(5,"C",STATE)) Q:STATE=""  Q:STATE  D
"RTN","XUMF4A",272,0)
 .F  S IEN=$O(^DIC(5,"C",STATE,IEN)) Q:'IEN  D
"RTN","XUMF4A",273,0)
 ..Q:$E(STATE,1,2)="ZZ"
"RTN","XUMF4A",274,0)
 ..S CNT=CNT+1
"RTN","XUMF4A",275,0)
 ..Q:CNT<2
"RTN","XUMF4A",276,0)
 ..S DA=IEN,DIE=5
"RTN","XUMF4A",277,0)
 ..S DR="1///ZZ"_$P($G(^DIC(5,+IEN,0)),U,2)
"RTN","XUMF4A",278,0)
 ..D ^DIE
"RTN","XUMF4A",279,0)
 .S CNT=0
"RTN","XUMF4A",280,0)
 ;
"RTN","XUMF4A",281,0)
 Q
"RTN","XUMF4A",282,0)
 ;
"RTN","XUMF4A",283,0)
FTCLEAN ; -- add missing facility types
"RTN","XUMF4A",284,0)
 ;
"RTN","XUMF4A",285,0)
 N NAME,FULL,FDA
"RTN","XUMF4A",286,0)
 ;
"RTN","XUMF4A",287,0)
 S NAME=""
"RTN","XUMF4A",288,0)
 F  S NAME=$O(^TMP("XUMF ARRAY",$J,NAME)) Q:NAME=""  D
"RTN","XUMF4A",289,0)
 .Q:$D(^DIC(4.1,"B",NAME))
"RTN","XUMF4A",290,0)
 .S FULL=$P(^TMP("XUMF ARRAY",$J,NAME),U,3)
"RTN","XUMF4A",291,0)
 .D
"RTN","XUMF4A",292,0)
 ..K FDA
"RTN","XUMF4A",293,0)
 ..S FDA(4.1,"+1,",.01)=NAME
"RTN","XUMF4A",294,0)
 ..S FDA(4.1,"+1,",1)=FULL
"RTN","XUMF4A",295,0)
 ..N NAME
"RTN","XUMF4A",296,0)
 ..D UPDATE^DIE("E","FDA",,"ERR")
"RTN","XUMF4A",297,0)
 ;
"RTN","XUMF4A",298,0)
 Q
"RTN","XUMF4A",299,0)
 ;
"RTN","XUMFH")
0^1^B58840097
"RTN","XUMFH",1,0)
XUMFH ;CIOFO-SF/RAM - Master File HL7 Msg Handler; 06/28/00
"RTN","XUMFH",2,0)
 ;;8.0;KERNEL;**206,209**;Jul 10, 1995
"RTN","XUMFH",3,0)
 ;
"RTN","XUMFH",4,0)
 ; This routine handles Master File HL7 messages.
"RTN","XUMFH",5,0)
 ;
"RTN","XUMFH",6,0)
MAIN ; -- entry point
"RTN","XUMFH",7,0)
 ;
"RTN","XUMFH",8,0)
 N CNT,ERR,I,X,HLFS,HLCS,ERROR,HLRESLTA,IFN,IEN,MTPE,TYPE,ARRAY
"RTN","XUMFH",9,0)
 N CNODE,HDT,KEY,MID,REASON,VALUE,XREF,ALL,GROUP,PARAM,ROOT,SEG,QRD
"RTN","XUMFH",10,0)
 N QID,WHAT,WHO
"RTN","XUMFH",11,0)
 ;
"RTN","XUMFH",12,0)
 D INIT,PROCESS,REPLY,EXIT
"RTN","XUMFH",13,0)
 ;
"RTN","XUMFH",14,0)
 Q
"RTN","XUMFH",15,0)
 ;
"RTN","XUMFH",16,0)
INIT ; -- initialize
"RTN","XUMFH",17,0)
 ;
"RTN","XUMFH",18,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J)
"RTN","XUMFH",19,0)
 K ^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",20,0)
 ;
"RTN","XUMFH",21,0)
 S (ERROR,CNT,TYPE,ARRAY)=0
"RTN","XUMFH",22,0)
 S HLFS=HL("FS"),HLCS=$E(HL("ECH"))
"RTN","XUMFH",23,0)
 ;
"RTN","XUMFH",24,0)
 Q
"RTN","XUMFH",25,0)
 ;
"RTN","XUMFH",26,0)
PROCESS ; -- pull message text
"RTN","XUMFH",27,0)
 ;
"RTN","XUMFH",28,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","XUMFH",29,0)
 .Q:$P(HLNODE,HLFS)=""
"RTN","XUMFH",30,0)
 .D @($P(HLNODE,HLFS))
"RTN","XUMFH",31,0)
 ;
"RTN","XUMFH",32,0)
 Q
"RTN","XUMFH",33,0)
 ;
"RTN","XUMFH",34,0)
MSH ; -- MSH segment
"RTN","XUMFH",35,0)
 ;
"RTN","XUMFH",36,0)
 Q
"RTN","XUMFH",37,0)
 ;
"RTN","XUMFH",38,0)
MSA ; -- MSA segment
"RTN","XUMFH",39,0)
 ;
"RTN","XUMFH",40,0)
 N CODE
"RTN","XUMFH",41,0)
 ;
"RTN","XUMFH",42,0)
 S CODE=$P(HLNODE,HLFS,2)
"RTN","XUMFH",43,0)
 ;
"RTN","XUMFH",44,0)
 I CODE="AE"!(CODE="AR") D
"RTN","XUMFH",45,0)
 .S ERROR="1^MSA segement error/reject message"
"RTN","XUMFH",46,0)
 .D ERRB("MFS handler "_ERROR,$P(HLNODE,HLFS,4),,.ERR)
"RTN","XUMFH",47,0)
 .S ERROR=ERROR_U_$P(HLNODE,HLFS,4)_U_$G(ERR)
"RTN","XUMFH",48,0)
 ;
"RTN","XUMFH",49,0)
 Q
"RTN","XUMFH",50,0)
 ;
"RTN","XUMFH",51,0)
QRD ; -- QRD segment
"RTN","XUMFH",52,0)
 ;
"RTN","XUMFH",53,0)
 Q:ERROR
"RTN","XUMFH",54,0)
 ;
"RTN","XUMFH",55,0)
 S QRD="QRD,QDT,QFC,QP,QID,DRT,DRDT,QLR,WHO,WHAT,WDDC,WDCVQ,QRL"
"RTN","XUMFH",56,0)
 ;
"RTN","XUMFH",57,0)
 F I=2:1:13 S PARAM($P(QRD,",",I))=$P(HLNODE,HLFS,I)
"RTN","XUMFH",58,0)
 S QID=$P(HLNODE,HLFS,5)
"RTN","XUMFH",59,0)
 S WHO=$P(HLNODE,HLFS,9)
"RTN","XUMFH",60,0)
 I WHO="" D  Q
"RTN","XUMFH",61,0)
 .S ERROR="1^QRD segment has null missing WHO parameter"
"RTN","XUMFH",62,0)
 .D ERRB("MFR handler",ERROR,,.ERR)
"RTN","XUMFH",63,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",64,0)
 S WHAT=$P(HLNODE,HLFS,10)
"RTN","XUMFH",65,0)
 I WHAT="" D  Q
"RTN","XUMFH",66,0)
 .S ERROR="1^QRD segment has null missing WHAT parameter"
"RTN","XUMFH",67,0)
 .D ERRB("MFR handler",ERROR,,.ERR)
"RTN","XUMFH",68,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",69,0)
 ;
"RTN","XUMFH",70,0)
 S ARRAY=$S(QID["ARRAY":1,1:0)
"RTN","XUMFH",71,0)
 S ALL=$S(WHO["ALL":1,1:0)
"RTN","XUMFH",72,0)
 S GROUP=$S(ALL:1,(WHO["IEN"):1,1:0)
"RTN","XUMFH",73,0)
 ;
"RTN","XUMFH",74,0)
 S:ARRAY TYPE=$S(GROUP:7,1:3)
"RTN","XUMFH",75,0)
 S:'ARRAY TYPE=$S(GROUP:5,1:1)
"RTN","XUMFH",76,0)
 S:HL("MTN")="MFR" TYPE=TYPE+10
"RTN","XUMFH",77,0)
 ;
"RTN","XUMFH",78,0)
 S IFN=+WHAT
"RTN","XUMFH",79,0)
 S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",80,0)
 S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",81,0)
 S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",82,0)
 ;
"RTN","XUMFH",83,0)
 K:ARRAY ^TMP("XUMF ARRAY",$J)
"RTN","XUMFH",84,0)
 ;
"RTN","XUMFH",85,0)
 Q
"RTN","XUMFH",86,0)
 ;
"RTN","XUMFH",87,0)
MFI ; -- MFI segment
"RTN","XUMFH",88,0)
 ;
"RTN","XUMFH",89,0)
 Q:ERROR
"RTN","XUMFH",90,0)
 Q:$G(IFN)
"RTN","XUMFH",91,0)
 ;
"RTN","XUMFH",92,0)
 I $P(HLNODE,HLFS,2)="" D  Q
"RTN","XUMFH",93,0)
 .S ERROR="1^MFI segment missing Master File Identifier"
"RTN","XUMFH",94,0)
 .D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",95,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",96,0)
 S IFN=$$MFI^XUMFP($P(HLNODE,HLFS,2))
"RTN","XUMFH",97,0)
 I 'IFN D  Q
"RTN","XUMFH",98,0)
 .S ERROR="1^IFN in MFI could not be resolved"
"RTN","XUMFH",99,0)
 .D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",100,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",101,0)
 ;
"RTN","XUMFH",102,0)
 Q
"RTN","XUMFH",103,0)
 ;
"RTN","XUMFH",104,0)
MFE ; -- MFE segment
"RTN","XUMFH",105,0)
 ;
"RTN","XUMFH",106,0)
 Q:ERROR
"RTN","XUMFH",107,0)
 Q:$G(IEN)
"RTN","XUMFH",108,0)
 ;
"RTN","XUMFH",109,0)
 S KEY=$P(HLNODE,HLFS,5) Q:ARRAY
"RTN","XUMFH",110,0)
 S XREF=$P(KEY,HLCS,3)
"RTN","XUMFH",111,0)
 S:KEY IEN=$$FIND1^DIC(IFN,,"BX",$P(KEY,HLCS),XREF,,"ERR")
"RTN","XUMFH",112,0)
 S IEN=$S(IEN:IEN,KEY["ALL":"ALL",$G(ERR)'="":"ERROR",1:"NEW")
"RTN","XUMFH",113,0)
 I IEN="ERROR" D  Q
"RTN","XUMFH",114,0)
 .S ERROR="1^MFE segment couldn't resolve IEN"
"RTN","XUMFH",115,0)
 .D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",116,0)
 .K ERR
"RTN","XUMFH",117,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",118,0)
 ;
"RTN","XUMFH",119,0)
 Q
"RTN","XUMFH",120,0)
 ;
"RTN","XUMFH",121,0)
ZIN ; -- VHA Institution segment
"RTN","XUMFH",122,0)
ZFT ; -- VHA Facility Type
"RTN","XUMFH",123,0)
ZZZ ; -- get [Z...] segment(s)
"RTN","XUMFH",124,0)
 ;
"RTN","XUMFH",125,0)
 Q:ERROR
"RTN","XUMFH",126,0)
 ;
"RTN","XUMFH",127,0)
 I $G(ARRAY) D ARRAY Q
"RTN","XUMFH",128,0)
 ;
"RTN","XUMFH",129,0)
 N FDA,IENS,FIELD,ERR,PRE,POST,XUMF,MULT,FDA1
"RTN","XUMFH",130,0)
 ;
"RTN","XUMFH",131,0)
 S PRE=$G(^TMP("XUMF MFS",$J,"PARAM","PRE"))
"RTN","XUMFH",132,0)
 D:PRE'="" @(PRE)
"RTN","XUMFH",133,0)
 ;
"RTN","XUMFH",134,0)
 S XUMF=7
"RTN","XUMFH",135,0)
 ;
"RTN","XUMFH",136,0)
 S SEG=$P(HLNODE,HLFS),CNODE=$O(HLNODE(""),-1),CN=0
"RTN","XUMFH",137,0)
 S IENS=$S(IEN:IEN,1:"+1")_","
"RTN","XUMFH",138,0)
 S SEQ=0
"RTN","XUMFH",139,0)
 F  S SEQ=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ)) Q:'SEQ  D
"RTN","XUMFH",140,0)
 .S FIELD=$O(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,0))
"RTN","XUMFH",141,0)
 .I FIELD=".01" D
"RTN","XUMFH",142,0)
 ..N FDA,IEN1
"RTN","XUMFH",143,0)
 ..S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",144,0)
 ..S VALUE=$S('CNODE:$P(HLNODE,HLFS,SEQ+1),1:$$VALUE(.HLNODE,.CN,SEQ))
"RTN","XUMFH",145,0)
 ..S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",146,0)
 ..S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",147,0)
 ..D UPDATE^DIE("E","FDA","IEN1","ERR")
"RTN","XUMFH",148,0)
 ..I $D(ERR) D
"RTN","XUMFH",149,0)
 ...S ERROR="1^update DIE call error message in ZZZ"
"RTN","XUMFH",150,0)
 ...D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",151,0)
 ...K ERR
"RTN","XUMFH",152,0)
 ..I $D(IEN1) S IENS=IEN1(1)_","
"RTN","XUMFH",153,0)
 .I 'FIELD D SUBFILE Q
"RTN","XUMFH",154,0)
 .S TYP=$G(^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,FIELD))
"RTN","XUMFH",155,0)
 .S VALUE=$S('CNODE:$P(HLNODE,HLFS,SEQ+1),1:$$VALUE(.HLNODE,.CN,SEQ))
"RTN","XUMFH",156,0)
 .S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",157,0)
 .S FDA(IFN,IENS,FIELD)=VALUE
"RTN","XUMFH",158,0)
 ;
"RTN","XUMFH",159,0)
 M FDA=FDA1
"RTN","XUMFH",160,0)
 ;
"RTN","XUMFH",161,0)
 D FILE^DIE("E","FDA","ERR")
"RTN","XUMFH",162,0)
 I $D(ERR) D
"RTN","XUMFH",163,0)
 .S ERROR="1^file DIE call error message in ZZZ"
"RTN","XUMFH",164,0)
 .D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",165,0)
 .K ERR
"RTN","XUMFH",166,0)
 ;
"RTN","XUMFH",167,0)
 S POST=$G(^TMP("XUMF MFS",$J,"PARAM","POST"))
"RTN","XUMFH",168,0)
 D:POST'="" @(POST)
"RTN","XUMFH",169,0)
 ;
"RTN","XUMFH",170,0)
 Q
"RTN","XUMFH",171,0)
 ;
"RTN","XUMFH",172,0)
SUBFILE ; -- process subfile record
"RTN","XUMFH",173,0)
 ;
"RTN","XUMFH",174,0)
 N IFN,IENS1,KEY1,FIELD,TYP,MKEY,ERR
"RTN","XUMFH",175,0)
 ;
"RTN","XUMFH",176,0)
 S IFN=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FILE")
"RTN","XUMFH",177,0)
 S FIELD=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"FIELD")
"RTN","XUMFH",178,0)
 S TYP=^TMP("XUMF MFS",$J,"PARAM","SEG",SEG,"SEQ",SEQ,"DTYP")
"RTN","XUMFH",179,0)
 S VALUE=$S('CNODE:$P(HLNODE,HLFS,SEQ+1),1:$$VALUE(.HLNODE,.CN,SEQ))
"RTN","XUMFH",180,0)
 S VALUE=$$DTYP^XUMFP(VALUE,TYP,HLCS,0)
"RTN","XUMFH",181,0)
 ;
"RTN","XUMFH",182,0)
 S MULT=$G(^TMP("XUMF MFS",$J,"PARAM","MULT","ZIN",SEQ))
"RTN","XUMFH",183,0)
 S MKEY=$G(^TMP("XUMF MFS",$J,"PARAM","MKEY","ZIN",SEQ))
"RTN","XUMFH",184,0)
 I MULT=SEQ Q:VALUE=""  D
"RTN","XUMFH",185,0)
 .N FDA,IEN
"RTN","XUMFH",186,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=VALUE
"RTN","XUMFH",187,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",188,0)
 .I $D(ERR) D
"RTN","XUMFH",189,0)
 ..S ERROR="1^update DIE call error message in SUBFILE"
"RTN","XUMFH",190,0)
 ..D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",191,0)
 ..K ERR
"RTN","XUMFH",192,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",193,0)
 I 'MULT D
"RTN","XUMFH",194,0)
 .N FDA,IEN
"RTN","XUMFH",195,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=MKEY
"RTN","XUMFH",196,0)
 .D UPDATE^DIE("E","FDA","IEN","ERR")
"RTN","XUMFH",197,0)
 ..S ERROR="1^update DIE call error message in SUBFILE"
"RTN","XUMFH",198,0)
 ..D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",199,0)
 ..K ERR
"RTN","XUMFH",200,0)
 .S IENS1=IEN(1)_","_IENS,MULT(SEQ)=IENS1
"RTN","XUMFH",201,0)
 .S FDA1(IFN,IENS1,.01)=MKEY
"RTN","XUMFH",202,0)
 I MULT,MULT'=SEQ S IENS1=$G(MULT(+MULT)) Q:IENS1=""
"RTN","XUMFH",203,0)
 S FDA1(IFN,IENS1,FIELD)=VALUE
"RTN","XUMFH",204,0)
 ;
"RTN","XUMFH",205,0)
 Q
"RTN","XUMFH",206,0)
 ;
"RTN","XUMFH",207,0)
VALUE(HLNODE,CN,SEQ) ; -- handle HL7 continuation nodes
"RTN","XUMFH",208,0)
 ;
"RTN","XUMFH",209,0)
 N X,NODE,NODE1
"RTN","XUMFH",210,0)
 ;
"RTN","XUMFH",211,0)
 S NODE=$S('CN:HLNODE,1:HLNODE(CN))
"RTN","XUMFH",212,0)
 S X=$P(NODE,HLFS,SEQ+1,999)
"RTN","XUMFH",213,0)
 I X["HLFS" Q $P(NODE,HLFS,SEQ+1)
"RTN","XUMFH",214,0)
 S CN=$O(HLNODE(CN)),NODE1=$P(HLNODE,HLFS)
"RTN","XUMFH",215,0)
 Q NODE_NODE1
"RTN","XUMFH",216,0)
 ;
"RTN","XUMFH",217,0)
ARRAY ; -- query data stored in array (not filed)
"RTN","XUMFH",218,0)
 ;
"RTN","XUMFH",219,0)
 I $G(KEY)="" D  Q
"RTN","XUMFH",220,0)
 .S ERROR="Null KEY found in the following segment: "_$E(HLNODE,1,100)
"RTN","XUMFH",221,0)
 .D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",222,0)
 .S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",223,0)
 ;
"RTN","XUMFH",224,0)
 M ^TMP("XUMF ARRAY",$J,$P(KEY,HLCS))=HLNODE
"RTN","XUMFH",225,0)
 ;
"RTN","XUMFH",226,0)
 Q
"RTN","XUMFH",227,0)
 ;
"RTN","XUMFH",228,0)
REPLY ; -- master file response
"RTN","XUMFH",229,0)
 ;
"RTN","XUMFH",230,0)
 Q:HL("MTN")="MFR"
"RTN","XUMFH",231,0)
 Q:HL("MTN")="MFK"
"RTN","XUMFH",232,0)
 ;
"RTN","XUMFH",233,0)
 S:(TYPE<10) TYPE=(TYPE+10)
"RTN","XUMFH",234,0)
 ;
"RTN","XUMFH",235,0)
 I HL("MTN")="MFQ" D
"RTN","XUMFH",236,0)
 .S IFN=+$G(WHAT) I 'IFN D  Q
"RTN","XUMFH",237,0)
 ..S ERROR="1^REPLY MFQ couldn't resolve IFN"
"RTN","XUMFH",238,0)
 ..D ERRB("MFS handler",ERROR,,.ERR)
"RTN","XUMFH",239,0)
 ..S ERROR=ERROR_U_$G(ERR)
"RTN","XUMFH",240,0)
 .S XREF=$P(WHO,HLCS,9),ROOT=$$ROOT^DILFD(IFN,,1)
"RTN","XUMFH",241,0)
 .S IEN=$O(@ROOT@(XREF,$P(WHO,HLCS),0))
"RTN","XUMFH",242,0)
 .S IEN=$S(IEN:IEN,1:$P(WHO,HLCS))
"RTN","XUMFH",243,0)
 ;
"RTN","XUMFH",244,0)
 S IFN=$G(IFN),IEN=$G(IEN)
"RTN","XUMFH",245,0)
 ;
"RTN","XUMFH",246,0)
 D MAIN^XUMFP(IFN,IEN,TYPE,.PARAM,.ERROR) Q:ERROR
"RTN","XUMFH",247,0)
 D MAIN^XUMFI(IFN,IEN,TYPE,.PARAM,.ERROR)
"RTN","XUMFH",248,0)
 ;
"RTN","XUMFH",249,0)
 Q
"RTN","XUMFH",250,0)
 ;
"RTN","XUMFH",251,0)
EXIT ; -- cleanup, and quit
"RTN","XUMFH",252,0)
 ;
"RTN","XUMFH",253,0)
 K ^TMP("DILIST",$J),^TMP("DIERR",$J),^TMP("HLS",$J),^TMP("HLA",$J)
"RTN","XUMFH",254,0)
 ;
"RTN","XUMFH",255,0)
 Q
"RTN","XUMFH",256,0)
 ;
"RTN","XUMFH",257,0)
ERRB(MSG0,MSG1,XMY,ERR) ; -- error bulletin
"RTN","XUMFH",258,0)
 ;
"RTN","XUMFH",259,0)
 S ERR=$G(ERR)
"RTN","XUMFH",260,0)
 F I=1:1:+$G(ERR) D
"RTN","XUMFH",261,0)
 .S XMB="XUMF ERROR",XMY("G.XUMF ERROR")=""
"RTN","XUMFH",262,0)
 .S XMB(1)=$G(HL("MID")),XMB(2)=$G(MSG0)
"RTN","XUMFH",263,0)
 .S XMB(3)=$G(MSG1),XMB(4)=$G(ERR("DIERR","E",I,"TEXT",1))
"RTN","XUMFH",264,0)
 .D
"RTN","XUMFH",265,0)
 ..N I
"RTN","XUMFH",266,0)
 ..D ^XMB
"RTN","XUMFH",267,0)
 ;
"RTN","XUMFH",268,0)
 Q
"RTN","XUMFH",269,0)
 ;
"RTN","XUMFP4C")
0^11^B24241579
"RTN","XUMFP4C",1,0)
XUMFP4C ;CIOFO-SF/RAM - Master File C/S Params INSTITUTION ; 06/28/00
"RTN","XUMFP4C",2,0)
 ;;8.0;KERNEL;**206,209**;Jul 10, 1995
"RTN","XUMFP4C",3,0)
 ;
"RTN","XUMFP4C",4,0)
 ; this routine is a called by XUMFP4 and is a continuation of that
"RTN","XUMFP4C",5,0)
 ; routine
"RTN","XUMFP4C",6,0)
 ;
"RTN","XUMFP4C",7,0)
QRD ; -- query definition segment
"RTN","XUMFP4C",8,0)
 ;
"RTN","XUMFP4C",9,0)
 ;Query Date/Time
"RTN","XUMFP4C",10,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QDT")) D
"RTN","XUMFP4C",11,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QDT")=$$HLDATE^HLFNC($$NOW^XLFDT)
"RTN","XUMFP4C",12,0)
 ;
"RTN","XUMFP4C",13,0)
 ;Query Format Code
"RTN","XUMFP4C",14,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QFC")) D
"RTN","XUMFP4C",15,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QFC")="R"
"RTN","XUMFP4C",16,0)
 ;
"RTN","XUMFP4C",17,0)
 ;Query Priority
"RTN","XUMFP4C",18,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QP")) D
"RTN","XUMFP4C",19,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QP")="I"
"RTN","XUMFP4C",20,0)
 ;
"RTN","XUMFP4C",21,0)
 ;Query ID
"RTN","XUMFP4C",22,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QID")) D
"RTN","XUMFP4C",23,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QID")="Z04 "_$S(ARRAY:"ARRAY",1:"FILE")
"RTN","XUMFP4C",24,0)
 ;
"RTN","XUMFP4C",25,0)
 ;Deferred Response Type (optional)
"RTN","XUMFP4C",26,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRT")) D
"RTN","XUMFP4C",27,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRT")=""
"RTN","XUMFP4C",28,0)
 ;
"RTN","XUMFP4C",29,0)
 ;Deferred Response Date/Time (optional)
"RTN","XUMFP4C",30,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","DRDT")) D
"RTN","XUMFP4C",31,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","DRDT")=""
"RTN","XUMFP4C",32,0)
 ;
"RTN","XUMFP4C",33,0)
 ;Quantity Limited Request
"RTN","XUMFP4C",34,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QLR")) D
"RTN","XUMFP4C",35,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QLR")="RD"_HLCS_999
"RTN","XUMFP4C",36,0)
 ;
"RTN","XUMFP4C",37,0)
 ;Who Subject Filter - sta#, D x-ref, assigning facility
"RTN","XUMFP4C",38,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHO")) D
"RTN","XUMFP4C",39,0)
 .N X S X=$S(ALL:"ALL",IEN:$P($G(^DIC(4,+IEN,99)),U),1:"IEN ARRAY")
"RTN","XUMFP4C",40,0)
 .S $P(X,HLCS,9,10)="D"_HLCS_"045A4"
"RTN","XUMFP4C",41,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHO")=X
"RTN","XUMFP4C",42,0)
 ;
"RTN","XUMFP4C",43,0)
 ;What Subject Filter
"RTN","XUMFP4C",44,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WHAT")) D
"RTN","XUMFP4C",45,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WHAT")="4"_HLCS_"IFN"_HLCS_"VA FM"
"RTN","XUMFP4C",46,0)
 ;
"RTN","XUMFP4C",47,0)
 ;What Department Data Code
"RTN","XUMFP4C",48,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDDC")) D
"RTN","XUMFP4C",49,0)
 .N X S X="INFRASTRUCTURE"_HLCS_"INFORMATION INFRASTRUCTURE"
"RTN","XUMFP4C",50,0)
 .S X=X_HLCS_"VA TS"
"RTN","XUMFP4C",51,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDDC")=X
"RTN","XUMFP4C",52,0)
 ;
"RTN","XUMFP4C",53,0)
 ;What Data Code Value Qual (optional)
"RTN","XUMFP4C",54,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","WDCVQ")) D
"RTN","XUMFP4C",55,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","WDCVQ")=""
"RTN","XUMFP4C",56,0)
 ;
"RTN","XUMFP4C",57,0)
 ;Query Results Level (optional)
"RTN","XUMFP4C",58,0)
 I '$D(^TMP("XUMF MFS",$J,"PARAM","QRL")) D
"RTN","XUMFP4C",59,0)
 .S ^TMP("XUMF MFS",$J,"PARAM","QRL")=""
"RTN","XUMFP4C",60,0)
 ;
"RTN","XUMFP4C",61,0)
 Q
"RTN","XUMFP4C",62,0)
 ;
"RTN","XUMFP4C",63,0)
PRE ; -- pre-update record
"RTN","XUMFP4C",64,0)
 ;
"RTN","XUMFP4C",65,0)
 S XUMF0=$G(^DIC(4,+IEN,0))
"RTN","XUMFP4C",66,0)
 S XUMF3=$G(^DIC(4,+IEN,3))
"RTN","XUMFP4C",67,0)
 S XUMF99=$G(^DIC(4,+IEN,99))
"RTN","XUMFP4C",68,0)
 S XUMFPRNT=$P($G(^DIC(4,+$P($G(^DIC(4,IEN,7,2,0)),U,2),99)),U)
"RTN","XUMFP4C",69,0)
 S XUMFVISN=$P($G(^DIC(4,+$P($G(^DIC(4,IEN,7,1,0)),U,2),99)),U)
"RTN","XUMFP4C",70,0)
 S XUMFSTTE=$P($G(^DIC(5,+$P(XUMF0,U,2),0)),U,2)
"RTN","XUMFP4C",71,0)
 ;
"RTN","XUMFP4C",72,0)
 Q
"RTN","XUMFP4C",73,0)
 ;
"RTN","XUMFP4C",74,0)
POST ; -- post-update record
"RTN","XUMFP4C",75,0)
 ;
"RTN","XUMFP4C",76,0)
 N NAME,VANAME,FACTYP,ONAM,OVANAM,OFACTYP,XMB,IENS,FDA,STANUM
"RTN","XUMFP4C",77,0)
 N STATE,FLAG,OFLAG
"RTN","XUMFP4C",78,0)
 ;
"RTN","XUMFP4C",79,0)
 S ONAM=$P(XUMF0,U)
"RTN","XUMFP4C",80,0)
 S OFACTYP=$P($G(^DIC(4.1,+XUMF3,0)),U)
"RTN","XUMFP4C",81,0)
 S OVANAM=$P(XUMF99,U,3)
"RTN","XUMFP4C",82,0)
 S OFLAG=$S(+$P(XUMF99,U,4):"INACTIVE",1:"")
"RTN","XUMFP4C",83,0)
 ;
"RTN","XUMFP4C",84,0)
 S NAME=$P($G(^DIC(4,+IEN,0)),U)
"RTN","XUMFP4C",85,0)
 S FACTYP=$P($G(^DIC(4.1,+$G(^DIC(4,+IEN,3)),0)),U)
"RTN","XUMFP4C",86,0)
 S VANAME=$P($G(^DIC(4,+IEN,99)),U,3)
"RTN","XUMFP4C",87,0)
 S STANUM=$P($G(^DIC(4,+IEN,99)),U)
"RTN","XUMFP4C",88,0)
 S FLAG=$S(+$P($G(^DIC(4,+IEN,99)),U,4):"INACTIVE",1:"")
"RTN","XUMFP4C",89,0)
 S PRNT=$P($G(^DIC(4,+$P($G(^DIC(4,+IEN,7,2,0)),U,2),99)),U)
"RTN","XUMFP4C",90,0)
 S VISN=$P($G(^DIC(4,+$P($G(^DIC(4,+IEN,7,1,0)),U,2),99)),U)
"RTN","XUMFP4C",91,0)
 S STATE=$P($G(^DIC(5,+$P($G(^DIC(4,+IEN,0)),U,2),0)),U,2)
"RTN","XUMFP4C",92,0)
 ;
"RTN","XUMFP4C",93,0)
 I ONAM'=NAME,OVANAM'=VANAME D
"RTN","XUMFP4C",94,0)
 .S IENS="?+"_DT_","_IEN_","
"RTN","XUMFP4C",95,0)
 .K FDA
"RTN","XUMFP4C",96,0)
 .S FDA(4.999,IENS,.01)=DT
"RTN","XUMFP4C",97,0)
 .S:NAME'=ONAM FDA(4.999,IENS,.02)=ONAM
"RTN","XUMFP4C",98,0)
 .S:VANAME'=OVANAM FDA(4.999,IENS,.03)=OVANAM
"RTN","XUMFP4C",99,0)
 .D UPDATE^DIE("E","FDA")
"RTN","XUMFP4C",100,0)
 ;
"RTN","XUMFP4C",101,0)
 ; -- notification bulletin
"RTN","XUMFP4C",102,0)
 S XMB="XUMF INSTITUTION"
"RTN","XUMFP4C",103,0)
 S XMB(1)=HL("MID"),XMB(2)=$S(ONAM="":"Added",1:"Updated")
"RTN","XUMFP4C",104,0)
 S XMB(3)=IEN,XMB(4)=STANUM
"RTN","XUMFP4C",105,0)
 ;updated/current values
"RTN","XUMFP4C",106,0)
 S XMB(5)=NAME,XMB(6)=VANAME,XMB(7)=FACTYP
"RTN","XUMFP4C",107,0)
 S XMB(11)=FLAG,XMB(12)=STATE,XMB(13)=VISN,XMB(14)=PRNT
"RTN","XUMFP4C",108,0)
 ;old values
"RTN","XUMFP4C",109,0)
 S XMB(8)=ONAM,XMB(9)=OVANAM,XMB(10)=OFACTYP,XMB(15)=OFLAG
"RTN","XUMFP4C",110,0)
 S XMB(16)=XUMFSTTE,XMB(17)=XUMFVISN,XMB(18)=XUMFPRNT
"RTN","XUMFP4C",111,0)
 D ^XMB
"RTN","XUMFP4C",112,0)
 ;
"RTN","XUMFP4C",113,0)
 K XUMF0,XUMF3,XUMF99,XUMFSTTE,XUMFVISN,XUMFPRNT
"RTN","XUMFP4C",114,0)
 ;
"RTN","XUMFP4C",115,0)
 Q
"RTN","XUMFP4C",116,0)
 ;
"RTN","XUMFP4C",117,0)
GROUP ; -- query group
"RTN","XUMFP4C",118,0)
 ;
"RTN","XUMFP4C",119,0)
 S IEN=0
"RTN","XUMFP4C",120,0)
 F  S IEN=$O(^TMP("XUMF MFS",$J,"PARAM","IENS",IEN)) Q:'IEN  D
"RTN","XUMFP4C",121,0)
 .S PKV=$P(^DIC(4,IEN,99),U)_HLCS_"STATION NUMBER"_HLCS_"D"
"RTN","XUMFP4C",122,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"PKV")=PKV
"RTN","XUMFP4C",123,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",8)="1,"_IEN_","
"RTN","XUMFP4C",124,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"1,"_IEN_",")="VISN"
"RTN","XUMFP4C",125,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",9)="2,"_IEN_","
"RTN","XUMFP4C",126,0)
 .S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.014,"2,"_IEN_",")="PARENT FACILITY"
"RTN","XUMFP4C",127,0)
 .S RF=$$RF^XUAF4(IEN) D:RF
"RTN","XUMFP4C",128,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",10)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",129,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",11)=$P(RF,U,3)_","_IEN_","
"RTN","XUMFP4C",130,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RF,U,3)_","_IEN_",")=$P(RF,U,3)
"RTN","XUMFP4C",131,0)
 .S RT=$$RT^XUAF4(IEN) D:RT
"RTN","XUMFP4C",132,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",12)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",133,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"IENS","ZIN",13)=$P(RT,U,3)_","_IEN_","
"RTN","XUMFP4C",134,0)
 ..S ^TMP("XUMF MFS",$J,"PARAM",IEN,"KEY","ZIN",4.999,$P(RT,U,3)_","_IEN_",")=$P(RT,U,3)
"RTN","XUMFP4C",135,0)
 ;
"RTN","XUMFP4C",136,0)
 Q
"RTN","XUMFP4C",137,0)
 ;
"VER")
8.0^22.0
**END**
**END**
