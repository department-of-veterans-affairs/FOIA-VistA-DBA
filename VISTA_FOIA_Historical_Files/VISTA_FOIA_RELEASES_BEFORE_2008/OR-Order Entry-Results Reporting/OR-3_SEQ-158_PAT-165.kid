Released OR*3*165 SEQ #158
Extracted from mail message
**KIDS**:OR*3.0*165^

**INSTALL NAME**
OR*3.0*165
"BLD",4051,0)
OR*3.0*165^ORDER ENTRY/RESULTS REPORTING^0^3030124^y
"BLD",4051,4,0)
^9.64PA^100.5^2
"BLD",4051,4,100.5,0)
100.5
"BLD",4051,4,100.5,2,0)
^9.641^100.511^2
"BLD",4051,4,100.5,2,100.51,0)
INCLUDED TREATING SPECIALTIES  (sub-file)
"BLD",4051,4,100.5,2,100.51,1,0)
^9.6411^^
"BLD",4051,4,100.5,2,100.511,0)
INCLUDED LOCATIONS  (sub-file)
"BLD",4051,4,100.5,2,100.511,1,0)
^9.6411^^
"BLD",4051,4,100.5,222)
y^n^p^^^^n^^n
"BLD",4051,4,100.5,224)

"BLD",4051,4,101.41,0)
101.41
"BLD",4051,4,101.41,222)
n^n^f^^y^^y^r^n
"BLD",4051,4,101.41,224)
I Y=202
"BLD",4051,4,"APDD",100.5,100.51)

"BLD",4051,4,"APDD",100.5,100.511)

"BLD",4051,4,"B",100.5,100.5)

"BLD",4051,4,"B",101.41,101.41)

"BLD",4051,"INIT")
ORY165
"BLD",4051,"KRN",0)
^9.67PA^8989.52^19
"BLD",4051,"KRN",.4,0)
.4
"BLD",4051,"KRN",.401,0)
.401
"BLD",4051,"KRN",.402,0)
.402
"BLD",4051,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",4051,"KRN",.402,"NM",1,0)
OREV EVENT    FILE #100.5^100.5^0
"BLD",4051,"KRN",.402,"NM",2,0)
OREV AUTO DC    FILE #100.6^100.6^0
"BLD",4051,"KRN",.402,"NM","B","OREV AUTO DC    FILE #100.6",2)

"BLD",4051,"KRN",.402,"NM","B","OREV EVENT    FILE #100.5",1)

"BLD",4051,"KRN",.403,0)
.403
"BLD",4051,"KRN",.5,0)
.5
"BLD",4051,"KRN",.84,0)
.84
"BLD",4051,"KRN",3.6,0)
3.6
"BLD",4051,"KRN",3.8,0)
3.8
"BLD",4051,"KRN",9.2,0)
9.2
"BLD",4051,"KRN",9.8,0)
9.8
"BLD",4051,"KRN",9.8,"NM",0)
^9.68A^12^12
"BLD",4051,"KRN",9.8,"NM",1,0)
ORY165^^0^B1704656
"BLD",4051,"KRN",9.8,"NM",2,0)
ORMEVNT1^^0^B59958123
"BLD",4051,"KRN",9.8,"NM",3,0)
ORQ13^^0^B8155120
"BLD",4051,"KRN",9.8,"NM",4,0)
ORCSEND^^0^B55651632
"BLD",4051,"KRN",9.8,"NM",5,0)
ORMPS^^0^B67437073
"BLD",4051,"KRN",9.8,"NM",6,0)
ORMEVNT^^0^B67587064
"BLD",4051,"KRN",9.8,"NM",7,0)
ORCACT0^^0^B43977857
"BLD",4051,"KRN",9.8,"NM",8,0)
ORY165A^^0^B8971955
"BLD",4051,"KRN",9.8,"NM",9,0)
OREV3^^0^B89473632
"BLD",4051,"KRN",9.8,"NM",10,0)
OREV1^^0^B80337093
"BLD",4051,"KRN",9.8,"NM",11,0)
ORYDLG^^0^B8247584
"BLD",4051,"KRN",9.8,"NM",12,0)
OREVNTX1^^0^B75930903
"BLD",4051,"KRN",9.8,"NM","B","ORCACT0",7)

"BLD",4051,"KRN",9.8,"NM","B","ORCSEND",4)

"BLD",4051,"KRN",9.8,"NM","B","OREV1",10)

"BLD",4051,"KRN",9.8,"NM","B","OREV3",9)

"BLD",4051,"KRN",9.8,"NM","B","OREVNTX1",12)

"BLD",4051,"KRN",9.8,"NM","B","ORMEVNT",6)

"BLD",4051,"KRN",9.8,"NM","B","ORMEVNT1",2)

"BLD",4051,"KRN",9.8,"NM","B","ORMPS",5)

"BLD",4051,"KRN",9.8,"NM","B","ORQ13",3)

"BLD",4051,"KRN",9.8,"NM","B","ORY165",1)

"BLD",4051,"KRN",9.8,"NM","B","ORY165A",8)

"BLD",4051,"KRN",9.8,"NM","B","ORYDLG",11)

"BLD",4051,"KRN",19,0)
19
"BLD",4051,"KRN",19.1,0)
19.1
"BLD",4051,"KRN",101,0)
101
"BLD",4051,"KRN",409.61,0)
409.61
"BLD",4051,"KRN",771,0)
771
"BLD",4051,"KRN",870,0)
870
"BLD",4051,"KRN",8989.51,0)
8989.51
"BLD",4051,"KRN",8989.52,0)
8989.52
"BLD",4051,"KRN",8994,0)
8994
"BLD",4051,"KRN","B",.4,.4)

"BLD",4051,"KRN","B",.401,.401)

"BLD",4051,"KRN","B",.402,.402)

"BLD",4051,"KRN","B",.403,.403)

"BLD",4051,"KRN","B",.5,.5)

"BLD",4051,"KRN","B",.84,.84)

"BLD",4051,"KRN","B",3.6,3.6)

"BLD",4051,"KRN","B",3.8,3.8)

"BLD",4051,"KRN","B",9.2,9.2)

"BLD",4051,"KRN","B",9.8,9.8)

"BLD",4051,"KRN","B",19,19)

"BLD",4051,"KRN","B",19.1,19.1)

"BLD",4051,"KRN","B",101,101)

"BLD",4051,"KRN","B",409.61,409.61)

"BLD",4051,"KRN","B",771,771)

"BLD",4051,"KRN","B",870,870)

"BLD",4051,"KRN","B",8989.51,8989.51)

"BLD",4051,"KRN","B",8989.52,8989.52)

"BLD",4051,"KRN","B",8994,8994)

"BLD",4051,"QUES",0)
^9.62^^
"BLD",4051,"REQB",0)
^9.611^2^2
"BLD",4051,"REQB",1,0)
OR*3.0*141^2
"BLD",4051,"REQB",2,0)
XU*8.0*179^2
"BLD",4051,"REQB","B","OR*3.0*141",1)

"BLD",4051,"REQB","B","XU*8.0*179",2)

"DATA",101.41,202,0)
OR GXMOVE EVENT^Move Patient^^D^28^2^110
"DATA",101.41,202,2,0)
^101.411^2^2^3020926^^^^
"DATA",101.41,202,2,1,0)
This allows a patient movement to be requested as a generic order (does
"DATA",101.41,202,2,2,0)
not interact directly with the MAS package).
"DATA",101.41,202,4)
K OREVNT,OREVNTYP
"DATA",101.41,202,10,0)
^101.412IA^6^6
"DATA",101.41,202,10,1,0)
1^203^^^^1^^^^C
"DATA",101.41,202,10,1,1)
Enter the movement you wish to order for this patient.
"DATA",101.41,202,10,1,2)
1^8~8
"DATA",101.41,202,10,1,3)
N X S X=$S($G(OREVT):0,1:1) I X ;uneditable if defined
"DATA",101.41,202,10,1,7)
S:$G(OREVT) Y=+OREVT
"DATA",101.41,202,10,1,10)
N X S X=$G(ORDIALOG(PROMPT,INST)) S:X OREVNT=+X,OREVNTYP=$P($G(^ORD(100.5,+X,0)),U,2)
"DATA",101.41,202,10,2,0)
3^1058^^Expected Location: ^^^^^C
"DATA",101.41,202,10,2,1)
Enter the location this patient is expected to be moved to.
"DATA",101.41,202,10,2,2)
3^^^Location:  ^^1
"DATA",101.41,202,10,2,4)
I $$ACTLOC^ORWU(Y)
"DATA",101.41,202,10,2,7)
S Y=+$P($G(^ORD(100.5,+$G(OREVNT),0)),U,9) K:Y<1 Y
"DATA",101.41,202,10,3,0)
4^17^^Attending: ^^1^^^C^AK.PROVIDER
"DATA",101.41,202,10,3,1)
Enter the attending provider for this patient.
"DATA",101.41,202,10,3,2)
4^^^Attending: ^^1
"DATA",101.41,202,10,3,3)
I "AT"[$G(OREVNTYP)
"DATA",101.41,202,10,4,0)
6^19^^Instructions: ^^^^^C
"DATA",101.41,202,10,4,1)
Enter any special instructions for this order, up to 240 characters.
"DATA",101.41,202,10,4,2)
6^^^^^1
"DATA",101.41,202,10,5,0)
5^181^^Primary: ^^^^^C^AK.PROVIDER
"DATA",101.41,202,10,5,1)
Enter the primary provider for this patient.
"DATA",101.41,202,10,5,2)
5^^^Primary:   ^^1
"DATA",101.41,202,10,5,3)
I "AT"[$G(OREVNTYP)
"DATA",101.41,202,10,6,0)
2^16^^^^^^^C
"DATA",101.41,202,10,6,1)
Enter the treating specialty this patient is to be assigned to.
"DATA",101.41,202,10,6,2)
2^^^Specialty: ^^1
"DATA",101.41,202,10,6,3)
I "AT"[$G(OREVNTYP)
"DATA",101.41,202,10,6,4)
I $$ACTIVE^DGACT(45.7,Y)
"DATA",101.41,202,10,6,6)
D XHELP^ORCDADT(PROMPT)
"DATA",101.41,202,10,6,7)
I $G(OREVNT) S Y=$$DEFTS^ORCDADT(OREVNT) K:Y<1 Y
"DATA",101.41,202,10,6,9)
D ENTS^ORCDADT(OREVNT)
"DATA",101.41,202,99)
59184,58087
"FIA",100.5)
OE/RR RELEASE EVENTS
"FIA",100.5,0)
^ORD(100.5,
"FIA",100.5,0,0)
100.5I
"FIA",100.5,0,1)
y^n^p^^^^n^^n
"FIA",100.5,0,10)

"FIA",100.5,0,11)

"FIA",100.5,0,"RLRO")

"FIA",100.5,0,"VR")
3.0^OR
"FIA",100.5,100.5)
1
"FIA",100.5,100.5,10)

"FIA",100.5,100.5,11)

"FIA",100.5,100.51)
0
"FIA",100.5,100.511)
0
"FIA",101.41)
ORDER DIALOG
"FIA",101.41,0)
^ORD(101.41,
"FIA",101.41,0,0)
101.41I
"FIA",101.41,0,1)
n^n^f^^y^^y^r^n
"FIA",101.41,0,10)

"FIA",101.41,0,11)
I Y=202
"FIA",101.41,0,"RLRO")

"FIA",101.41,0,"VR")
3.0^OR
"FIA",101.41,101.41)
0
"FIA",101.41,101.411)
0
"FIA",101.41,101.412)
0
"FIA",101.41,101.41218)
0
"FIA",101.41,101.415)
0
"FIA",101.41,101.416)
0
"FIA",101.41,101.4162)
0
"FRV1",101.41,"202,0",5)
M.A.S.
"FRV1",101.41,"202,0",5,"F")
;ORD(100.98,
"FRV1",101.41,"202,0",7)
ORDER ENTRY/RESULTS REPORTING
"FRV1",101.41,"202,0",7,"F")
;DIC(9.4,
"FRV1",101.41,"202,10,1,0",2)
OR GTX EVENT
"FRV1",101.41,"202,10,1,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"202,10,2,0",2)
OR GTX LOCATION
"FRV1",101.41,"202,10,2,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"202,10,3,0",2)
OR GTX PROVIDER
"FRV1",101.41,"202,10,3,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"202,10,4,0",2)
OR GTX FREE TEXT 1
"FRV1",101.41,"202,10,4,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"202,10,5,0",2)
OR GTX PROVIDER 1
"FRV1",101.41,"202,10,5,0",2,"F")
;ORD(101.41,
"FRV1",101.41,"202,10,6,0",2)
OR GTX TREATING SPECIALTY
"FRV1",101.41,"202,10,6,0",2,"F")
;ORD(101.41,
"INIT")
ORY165
"KRN",.402,1412,-1)
0^1
"KRN",.402,1412,0)
OREV EVENT^3030114.1216^@^100.5^^@^3030123
"KRN",.402,1412,"DIAB",1,0,100.5,3)
3;"MANUAL RELEASE WITHIN DIVISION"
"KRN",.402,1412,"DIAB",3,0,100.5,2)
3;"ADMIT TO DIVISION"
"KRN",.402,1412,"DIAB",6,0,100.5,2)
3;"DISCHARGE FROM DIVISION"
"KRN",.402,1412,"DIAB",9,0,100.5,2)
3;"TRANSFER TO/WITHIN DIVISION"
"KRN",.402,1412,"DIAB",12,0,100.5,2)
3;"SURGERY WITHIN DIVISION"
"KRN",.402,1412,"DR",1,100.5)
I $G(^ORD(100.5,DA,1))&($G(NEW)) W !,"You will not be allowed to ^ out until the required fields are entered.",! S DIE("NO^")="NO EXIT, NO JUMP";I '$G(DIE("NO^"))="" S DIE("NO^")="OUTOK";.01;8;
"KRN",.402,1412,"DR",1,100.5,1)
I '$G(^ORD(100.5,DA,1)) W !!,"The TYPE OF EVENT and DIVISION fields can only be edited",!,"when the entry is inactive.",! S Y="@6";2;S ETYPE=$P($G(^ORD(100.5,DA,0)),U,2);
"KRN",.402,1412,"DR",1,100.5,2)
S Y=$S(ETYPE="A":"@1",ETYPE="D":"@2",ETYPE="T":"@3",ETYPE="O":"@4",1:"@5");@1;3ADMIT TO DIVISION~;S Y="@6";@2;3DISCHARGE FROM DIVISION~;S Y="@6";@3;3TRANSFER TO/WITHIN DIVISION~;S Y="@6";@4;3SURGERY WITHIN DIVISION~;S Y="@6";@5;
"KRN",.402,1412,"DR",1,100.5,3)
3MANUAL RELEASE WITHIN DIVISION~;@6;I "^A^T^D^"'[("^"_$P($G(^ORD(100.5,DA,0)),U,2)_"^") S Y="@7";7;@7;S ATS=0;I "^A^T^"'[("^"_$P($G(^ORD(100.5,DA,0)),U,2)_"^") S Y="@9";
"KRN",.402,1412,"DR",1,100.5,4)
I "^1^2^3^"[("^"_$P($G(^ORD(100.5,DA,0)),U,7)_"^") D DELMUL^OREV1(100.5,DA,"""LOC"""),DELMUL^OREV1(100.5,DA,"""TS""") S Y="@9";I "^22^23^24^"[("^"_$P($G(^ORD(100.5,DA,0)),U,7)_"^") D DELMUL^OREV1(100.5,DA,"""LOC""") S ATS=1;10;
"KRN",.402,1412,"DR",1,100.5,5)
I $G(ATS) S Y="@8";11;@8;I $G(ORTYPE)'="" S REQD=$$HASREQD^OREV1() I 'REQD S DIE("NO^")="NO EXIT, NO JUMP" W !!,"Locations or treating specialties must be entered for this event type.",! S Y="@7";
"KRN",.402,1412,"DR",1,100.5,6)
I $G(REQD)=2 W !!,"*Warning: You have defined locations and treating specialties for this event.",!,"As such, both must be true for orders to be released.  Be sure this is what you want.";@9;
"KRN",.402,1412,"DR",1,100.5,7)
I $G(NEW) W !!,"You have now entered the required fields and may ^ to exit.",!;S DIE("NO^")="OUTOK";.1;4;5;6;9;13;D EDITPAR^XPAREDIT("ORWDX WRITE ORDERS EVENT LIST");
"KRN",.402,1412,"DR",2,100.51)
S DIE("NO^")="NO EXIT, NO JUMP";.01;1;
"KRN",.402,1412,"DR",2,100.511)
S DIE("NO^")="NO EXIT, NO JUMP";.01;
"KRN",.402,1413,-1)
0^2
"KRN",.402,1413,0)
OREV AUTO DC^3030114.1219^@^100.6^^@^3030121
"KRN",.402,1413,"DIAB",1,0,100.6,2)
3;"ADMIT TO DIVISION"
"KRN",.402,1413,"DIAB",4,0,100.6,2)
3;"DISCHARGE FROM DIVISION"
"KRN",.402,1413,"DIAB",7,0,100.6,2)
3;"TRANSFER TO/WITHIN DIVISION"
"KRN",.402,1413,"DIAB",10,0,100.6,2)
3;"SURGERY WITHIN DIVISION"
"KRN",.402,1413,"DIAB",13,0,100.6,2)
3;"T.S. CHANGE WITHIN DIVISION"
"KRN",.402,1413,"DR",1,100.6)
I $G(^ORD(100.6,DA,1))&($G(NEW)) W !,"You will not be allowed to ^ out until the required fields are entered.",! S DIE("NO^")="NO EXIT, NO JUMP";S:$G(DIE("NO^"))="" DIE("NO^")="OUTOK";.01;5;S ETYPE=$P($G(^ORD(100.6,DA,0)),U,2);
"KRN",.402,1413,"DR",1,100.6,1)
I '$G(^ORD(100.6,DA,1)) W !!,"The TYPE OF EVENT, MAS MOVEMENT TYPE, and DIVISION fields can only be",!,"edited when the entry is inactive.",! S Y="@8";2;S Y=$S(ETYPE="A":"@1",ETYPE="D":"@2",ETYPE="T":"@3",ETYPE="O":"@4",1:"@5");@1;
"KRN",.402,1413,"DR",1,100.6,2)
3ADMIT TO DIVISION~;S Y="@6";@2;3DISCHARGE FROM DIVISION~;S Y="@6";@3;3TRANSFER TO/WITHIN DIVISION~;S Y="@6";@4;3SURGERY WITHIN DIVISION~;S Y="@6";@5;3T.S. CHANGE WITHIN DIVISION~;@6;I ETYPE="O" S Y="@8";@7;30;
"KRN",.402,1413,"DR",1,100.6,3)
S REQD=$$HASREQD^OREV1() I REQD=0!(REQD=2) S DIE("NO^")="NO EXIT, NO JUMP";I REQD=0 W !!,"MAS MOVEMENT TYPE is required for this type of event.",! S Y="@7";
"KRN",.402,1413,"DR",1,100.6,4)
I REQD=2 W !!,"Interward Transfer may not be used with any other type of transfer.",!,"Either delete it or delete the additional entries",! S Y="@7";@8;I $G(NEW) W !!,"You have now entered the required fields and may ^ to exit.",!;
"KRN",.402,1413,"DR",1,100.6,5)
S DIE("NO^")="OUTOK";I "^D^T^"'[("^"_ETYPE_"^")!('$$ASKOBS^OREV1) S Y="@9";6;@9;4;I ETYPE'="S" S Y="@10";40;@10;I ETYPE'="T"!(ETYPE="T"&('$$IWT^OREV2(DA))) S Y="@13";50;60;@13;70;100;80;
"KRN",.402,1413,"DR",2,100.62)
.01;S DIE("NO^")="NO EXIT, NO JUMP";1;I X=1 S Y="@11";2;@11;3;I X=1 S Y="@12";4;@12;S DIEFIRE="L";S DIE("NO^")="OUTOK";D FROMTO^OREV4("L",DA(1),DA);
"KRN",.402,1413,"DR",2,100.63)
S DIE("NO^")="NO EXIT, NO JUMP";.01;
"KRN",.402,1413,"DR",2,100.64)
.01:1;D FROMTO^OREV4("S",DA(1),DA);
"KRN",.402,1413,"DR",2,100.65)
.01;
"KRN",.402,1413,"DR",2,100.66)
.01;
"KRN",.402,1413,"DR",2,100.67)
.01;
"KRN",.402,1413,"DR",2,100.68)
.01;
"KRN",.402,1413,"DR",3,100.641)
.01
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PGL",101.41,0,5,5)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"PGL",101.41,0,7,7)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"PGL",101.412,0,2,2)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"PGL",101.412,0,11,1)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"PGL",101.415,0,2,2)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"PGL",101.416,0,2,.02)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
165^3030124^1326
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","ORCACT0")
0^7^B43977857
"RTN","ORCACT0",1,0)
ORCACT0 ;SLC/MKB-Validate order action ;9/16/02  12:57
"RTN","ORCACT0",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,72,86,92,94,141,165**;Dec 17, 1997
"RTN","ORCACT0",3,0)
VALID(IFN,ACTION,ERROR,NATR) ; -- Determines if action is valid for order IFN
"RTN","ORCACT0",4,0)
 N OR0,OR3,ORA0,AIFN,PKG,DG,ORDSTS,ACTSTS,VER,X,Y,MEDPARM K ERROR
"RTN","ORCACT0",5,0)
 S OR0=$G(^OR(100,+IFN,0)),OR3=$G(^(3)),PKG=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORCACT0",6,0)
 S MEDPARM=$S($G(NATR)="A":2,PKG'="PS":2,'$D(^XUSEC("OREMAS",DUZ)):2,1:$$GET^XPAR("ALL","OR OREMAS MED ORDERS"))
"RTN","ORCACT0",7,0)
 S AIFN=$P(IFN,";",2) S:'AIFN AIFN=+$P(OR3,U,7)
"RTN","ORCACT0",8,0)
 S ORA0=$G(^OR(100,+IFN,8,AIFN,0)),ACTSTS=$P(ORA0,U,15)
"RTN","ORCACT0",9,0)
 S ORDSTS=$P(OR3,U,3),VER=$S($P(OR0,U,5)["101.41":3,1:2)
"RTN","ORCACT0",10,0)
 S DG=$P($G(^ORD(100.98,+$P(OR0,U,11),0)),U,3)
"RTN","ORCACT0",11,0)
CM I ACTION="CM" G VQ ; ward comments - no restrictions
"RTN","ORCACT0",12,0)
FL I ACTION="FL" D  G VQ ; flag
"RTN","ORCACT0",13,0)
 . I +$G(^OR(100,+IFN,8,AIFN,3)) S ERROR="This order is already flagged!" Q
"RTN","ORCACT0",14,0)
UF I ACTION="UF" D  G VQ ; unflag
"RTN","ORCACT0",15,0)
 . I '+$G(^OR(100,+IFN,8,AIFN,3)) S ERROR="This order is not flagged!" Q
"RTN","ORCACT0",16,0)
DC1 I ACTION="DC",ACTSTS D  G VQ ; discontinue/cancel unrel or canc order
"RTN","ORCACT0",17,0)
 . I (ACTSTS=11)!(ACTSTS=10) D  Q  ; unreleased
"RTN","ORCACT0",18,0)
 .. I 'MEDPARM S ERROR="You are not authorized to cancel med orders!" Q
"RTN","ORCACT0",19,0)
 .. I $G(NATR)="A" S X=$O(^ORE(100.2,"AO",+IFN,0)) I X,'$G(^ORE(100.2,X,1)) S ERROR="Future event orders may not be auto-discontinued!" Q
"RTN","ORCACT0",20,0)
 . I ACTSTS=12 S ERROR="This order has been dc'd due to edit!" Q
"RTN","ORCACT0",21,0)
 . I ACTSTS=13 S ERROR="This order has been cancelled!" Q
"RTN","ORCACT0",22,0)
ES I (ACTION="ES")!(ACTION="OC")!(ACTION="RS")!(ACTION="DS") D ES^ORCACT01 G VQ ; sign
"RTN","ORCACT0",23,0)
VR I ACTION="VR" D  G VQ ; verify
"RTN","ORCACT0",24,0)
 . I $G(ORVER)="N",$P(ORA0,U,9) S ERROR="This order has been verified!" Q
"RTN","ORCACT0",25,0)
 . I $G(ORVER)="C",$P(ORA0,U,11) S ERROR="This order has been verified!" Q
"RTN","ORCACT0",26,0)
 . I $G(ORVER)="R",$P(ORA0,U,19) S ERROR="This order has been reviewed!" Q
"RTN","ORCACT0",27,0)
 . I (ACTSTS=11)!(ACTSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT0",28,0)
 . I AIFN=1,ORDSTS=5,PKG="PS" S X=$$DISABLED I X S ERROR=$P(X,U,2) Q
"RTN","ORCACT0",29,0)
DIS S X=$$DISABLED I X S ERROR=$P(X,U,2) G VQ
"RTN","ORCACT0",30,0)
MN I ACTION="MN" D  G VQ ; manually release (delayed)
"RTN","ORCACT0",31,0)
 . I ACTSTS'=10,ACTSTS'=11 S ERROR="This order has already been released!" Q
"RTN","ORCACT0",32,0)
 . I $P(OR0,U,12)="I",'$G(^DPT(+ORVP,.105)) S ERROR="This patient is not currently admitted!"
"RTN","ORCACT0",33,0)
GMRA I PKG="GMRA" S ERROR="This action is not allowed on an allergy/adverse reaction!" G VQ ; no actions allowed on Allergies
"RTN","ORCACT0",34,0)
MEDS I PKG="PS",'MEDPARM S ERROR="You are not authorized to enter med orders!" G VQ
"RTN","ORCACT0",35,0)
RW I ACTION="RW" D RW^ORCACT01 G VQ ; rewrite/copy
"RTN","ORCACT0",36,0)
XFR I ACTION="XFR" D XFR^ORCACT01 G VQ ; transfer to in/outpt
"RTN","ORCACT0",37,0)
RN I ACTION="RN" D RN^ORCACT01 G VQ ; renew
"RTN","ORCACT0",38,0)
TRM I $$DONE G VQ ; ORDSTS=1,2,7,12,13
"RTN","ORCACT0",39,0)
EV I ACTION="EV" D  G VQ ; change delay event
"RTN","ORCACT0",40,0)
 . I ORDSTS'=10,ORDSTS'=11 S ERROR="This order has been released!" Q
"RTN","ORCACT0",41,0)
 . I $$EVTORDER^OREVNTX(IFN) S ERROR="The release event for this order may not be changed!" Q
"RTN","ORCACT0",42,0)
 . S X=$P(ORA0,U,4) I X'=2,X'=3 S ERROR="Signed orders may not be delayed to another event!" Q
"RTN","ORCACT0",43,0)
DC2 I ACTION="DC",ACTSTS="" D  G VQ ; DC released order
"RTN","ORCACT0",44,0)
 . I $G(NATR)="A" D  Q:$D(ERROR)
"RTN","ORCACT0",45,0)
 .. S X=$O(^ORE(100.2,"AO",+IFN,0)) I X S:'$G(^ORE(100.2,X,1)) ERROR="Future event orders may not be auto-discontinued!" Q
"RTN","ORCACT0",46,0)
 .. I $G(DGPMT)=1,$P($G(^SC(+$P(OR0,U,10),0)),U,3)'="C" S ERROR="Only outpatient orders may be auto-discontinued!" Q
"RTN","ORCACT0",47,0)
 .. I $G(DGPMT)'=1,$P($G(^SC(+$P(OR0,U,10),0)),U,3)="C" S ERROR="Only inpatient orders may be auto-discontinued!" Q
"RTN","ORCACT0",48,0)
 . I PKG="RA",ORDSTS=6 S ERROR="Active Radiology orders cannot be discontinued!" Q
"RTN","ORCACT0",49,0)
 . I PKG="LR" D  Q
"RTN","ORCACT0",50,0)
 .. I $$COLLECTD S ERROR="Lab orders that have been collected may not be discontinued!" Q
"RTN","ORCACT0",51,0)
 .. I $G(NATR)="A","^12^38^"'[(U_$P($G(DGPMA),U,18)_U),$$VALUE^ORX8(+IFN,"COLLECT")="SP",$P(OR0,U,8)'<DT S ERROR="Future Send Patient orders may not be auto-discontinued!" Q
"RTN","ORCACT0",52,0)
 . I PKG="GMRC",ORDSTS=9 S ERROR="Consults orders with partial results cannot be discontinued!" Q
"RTN","ORCACT0",53,0)
 . I DG="DO",$G(DGPMT)'=3,ORDSTS=6,'$$NPO(+IFN) S ERROR="Active Diets cannot be discontinued; please order a new diet!" Q
"RTN","ORCACT0",54,0)
RL I ACTION="RL" D  G VQ  ; release hold
"RTN","ORCACT0",55,0)
 . I ORDSTS'=3 S ERROR="Orders not on hold cannot be released!" Q
"RTN","ORCACT0",56,0)
 . I ACTSTS S ERROR=$$ACTION($P(ORA0,U,2))_" orders cannot be released from hold!" Q
"RTN","ORCACT0",57,0)
 . N NATR,ACT S ACT=$S($P(ORA0,U,2)="HD":AIFN,1:+$P(OR3,U,7))
"RTN","ORCACT0",58,0)
 . S NATR=+$P($G(^OR(100,+IFN,8,ACT,0)),U,12),ACT=$P($G(^(0)),U,2)
"RTN","ORCACT0",59,0)
 . I PKG="RA"!(ACT'="HD")!($P($G(^ORD(100.02,NATR,0)),U,2)="S") S ERROR="Orders held by a service must be released from hold through the service!" Q
"RTN","ORCACT0",60,0)
AIFN S X=$P(ORA0,U,2) I AIFN>1,ACTSTS S ERROR="This action is not allowed on a "_$$ACTION(X)_" order!" G VQ
"RTN","ORCACT0",61,0)
RF I ACTION="RF" D  G VQ
"RTN","ORCACT0",62,0)
 . I DG'="O RX" S ERROR="Only Outpatient Med orders may be refilled!" Q
"RTN","ORCACT0",63,0)
 . I ORDSTS=5 S ERROR="Pending orders may not be refilled!" Q
"RTN","ORCACT0",64,0)
 . N X,PSIFN S PSIFN=$G(^OR(100,+IFN,4))
"RTN","ORCACT0",65,0)
 . S X=$$REFILL^PSOREF(PSIFN) I X'>0 S ERROR=$P(X,U,2) Q
"RTN","ORCACT0",66,0)
CP I ACTION="CP" D  G VQ ; complete
"RTN","ORCACT0",67,0)
 . I PKG'="OR" S ERROR="Only generic text orders may be completed through this option!" Q
"RTN","ORCACT0",68,0)
 . I ORDSTS=11!(ORDSTS=10) S ERROR="This order has not been released!" Q
"RTN","ORCACT0",69,0)
AL I ACTION="AL" D  G VQ
"RTN","ORCACT0",70,0)
 . I PKG'="LR",PKG'="RA",PKG'="GMRC" S ERROR="This order does not generate results!" Q
"RTN","ORCACT0",71,0)
 . I $P(OR3,U,10) S ERROR="This order is already flagged to alert the provider when resulted!" Q
"RTN","ORCACT0",72,0)
XX I ACTION="XX" D XX^ORCACT01 G VQ ; edit/change
"RTN","ORCACT0",73,0)
HD I ACTION="HD" D  G VQ ; hold
"RTN","ORCACT0",74,0)
 . I PKG="FH" S ERROR="Diet orders cannot be held!" Q
"RTN","ORCACT0",75,0)
 . I PKG="LR" S ERROR="Lab orders cannot be held!" Q
"RTN","ORCACT0",76,0)
 . I PKG="RA" S ERROR="Radiology orders cannot be held!" Q
"RTN","ORCACT0",77,0)
 . I PKG="GMRC" S ERROR="Consult orders cannot be held!" Q
"RTN","ORCACT0",78,0)
 . I ORDSTS=3 S ERROR="This order is already on hold!" Q
"RTN","ORCACT0",79,0)
 . I ORDSTS'=6,PKG="PS" S ERROR="Only active Pharmacy orders may be held!" Q
"RTN","ORCACT0",80,0)
 . I (ORDSTS=11)!(ORDSTS=10) S ERROR="This order has not been released to the service." Q
"RTN","ORCACT0",81,0)
VQ S Y=$S($D(ERROR):0,1:1)
"RTN","ORCACT0",82,0)
 Q Y
"RTN","ORCACT0",83,0)
 ;
"RTN","ORCACT0",84,0)
ACTION(X) ; -- Return text of action X
"RTN","ORCACT0",85,0)
 N Y S Y=$S(X="NW":"New",X="DC":"Discontinue",X="HD":"Hold",X="RL":"Release Hold",X="RN":"Renew",1:X)
"RTN","ORCACT0",86,0)
 Q Y
"RTN","ORCACT0",87,0)
 ;
"RTN","ORCACT0",88,0)
NPO(ORIFN) ; -- Returns 1 or 0, if order ORIFN is for NPO
"RTN","ORCACT0",89,0)
 N X,Y S X=$$VALUE^ORX8(+ORIFN,"ORDERABLE",1,"E")
"RTN","ORCACT0",90,0)
 S Y=$S($E(X,1,3)="NPO":1,1:0)
"RTN","ORCACT0",91,0)
 Q Y
"RTN","ORCACT0",92,0)
 ;
"RTN","ORCACT0",93,0)
COLLECTD() ; -- Lab order collected/active (incl all children)?
"RTN","ORCACT0",94,0)
 I (ORDSTS=11)!(ORDSTS=10) Q 0 ; unreleased
"RTN","ORCACT0",95,0)
 I '$O(^OR(100,+IFN,2,0)) Q (ORDSTS'=5)
"RTN","ORCACT0",96,0)
 ;I ORDSTS'=6 Q 1 ; Parent -> active instead of pending
"RTN","ORCACT0",97,0)
 N Y,Z S Y=1,Z=0
"RTN","ORCACT0",98,0)
 F  S Z=$O(^OR(100,+IFN,2,Z)) Q:Z'>0  I $P($G(^OR(100,Z,3)),U,3)=5 S Y=0 Q
"RTN","ORCACT0",99,0)
 Q Y
"RTN","ORCACT0",100,0)
 ;
"RTN","ORCACT0",101,0)
DONE() ; -- sets ERROR if terminal status
"RTN","ORCACT0",102,0)
 I ORDSTS=1 S ERROR="This order has been discontinued!" Q 1
"RTN","ORCACT0",103,0)
 I ORDSTS=2 S ERROR="This order has been completed!" Q 1
"RTN","ORCACT0",104,0)
 I ORDSTS=7 S ERROR="This order has expired!" Q 1
"RTN","ORCACT0",105,0)
 I ORDSTS=12 S ERROR="This order has been changed!" Q 1
"RTN","ORCACT0",106,0)
 I ORDSTS=13 S ERROR="This order has been cancelled!" Q 1
"RTN","ORCACT0",107,0)
 I ORDSTS=14 S ERROR="This order has lapsed!" Q 1
"RTN","ORCACT0",108,0)
 I ORDSTS=15 S ERROR="This order has been renewed!" Q 1
"RTN","ORCACT0",109,0)
 Q 0
"RTN","ORCACT0",110,0)
 ;
"RTN","ORCACT0",111,0)
DISABLED() ; -- Order dialog [or protocol] disabled?
"RTN","ORCACT0",112,0)
 N X,DLG S DLG=$P(OR0,U,5),X=0 I +DLG'>0 Q X
"RTN","ORCACT0",113,0)
 I VER'<3,DLG?1.N1";ORD(101.41," S X=$$MSG^ORXD(+DLG) Q X
"RTN","ORCACT0",114,0)
 S DLG=$S(PKG="RA":"RA OERR EXAM",PKG="GMRC":"GMRCOR CONSULT",1:"")
"RTN","ORCACT0",115,0)
 I $L(DLG) S DLG=+$O(^ORD(101.41,"AB",DLG,0)),X=$$MSG^ORXD(DLG)
"RTN","ORCACT0",116,0)
 Q X
"RTN","ORCSEND")
0^4^B55651632
"RTN","ORCSEND",1,0)
ORCSEND ;SLC/MKB-Release orders ; 08 May 2002  2:12 PM
"RTN","ORCSEND",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,27,45,79,92,141,165**;Dec 17, 1997
"RTN","ORCSEND",3,0)
 ;
"RTN","ORCSEND",4,0)
EN(ORIFN,ACTION,SIGSTS,RELSTS,NATURE,REASON,ORERR) ; -- Release [actions on] orders
"RTN","ORCSEND",5,0)
 N ORDA,ORNOW,SIGNREQD,SIGNED,SIGNER
"RTN","ORCSEND",6,0)
 S SIGNREQD=+$P($G(^OR(100,+ORIFN,0)),U,16),ORERR=""
"RTN","ORCSEND",7,0)
 S SIGNED=$S(SIGSTS=2:0,1:1),SIGNER=$S(SIGSTS=1:DUZ,SIGSTS=7:DUZ,1:"")
"RTN","ORCSEND",8,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN,ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORCSEND",9,0)
 S:"ES"[$G(ACTION) ACTION=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2)
"RTN","ORCSEND",10,0)
 I SIGNREQD,ORDA,"^NW^RW^XX^RN^DC^HD^RL^"[(U_ACTION_U) D  ; sign/alert
"RTN","ORCSEND",11,0)
 . I 'SIGNED D NOTIF^ORCSIGN Q
"RTN","ORCSEND",12,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",13,0)
 . D:SIGSTS=4 CHART^ORCSIGN ; not used anymore
"RTN","ORCSEND",14,0)
 I '$L(ACTION) S ORERR="1^Invalid order action" Q
"RTN","ORCSEND",15,0)
 I $$READY(ORIFN,ORDA) D:$L($T(@ACTION)) @ACTION I 'ORERR,ACTION="NW" D
"RTN","ORCSEND",16,0)
 . N OREVT S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17) Q:OREVT<1
"RTN","ORCSEND",17,0)
 . I '$$EVTORDER^OREVNTX(ORIFN) D SAVE^ORMEVNT1(ORIFN,OREVT,2,"ES")
"RTN","ORCSEND",18,0)
 Q
"RTN","ORCSEND",19,0)
 ;
"RTN","ORCSEND",20,0)
EN1(ORDER,ORERR) ; -- Delayed Release [from RELEASE^ORMEVNT]
"RTN","ORCSEND",21,0)
 ;
"RTN","ORCSEND",22,0)
 Q:$P($G(^OR(100,+ORDER,3)),U,3)'=10
"RTN","ORCSEND",23,0)
 N ORPKG,ORA0,ORNOW,ORIFN,ORDA,ORNP,ORNATR,ORQUIT,ORDUZ,SIGSTS,RELSTS
"RTN","ORCSEND",24,0)
 S ORPKG=$P($G(^OR(100,+ORDER,0)),U,14),ORA0=$G(^(8,1,0))
"RTN","ORCSEND",25,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORIFN=+ORDER,ORDA=1,ORNP=$P(ORA0,U,3)
"RTN","ORCSEND",26,0)
 S SIGSTS=$P(ORA0,U,4),ORNATR=$P($G(^ORD(100.02,+$P(ORA0,U,12),0)),U,2)
"RTN","ORCSEND",27,0)
 S RELSTS=$S(SIGSTS'=2:1,"^V^P^"[(U_ORNATR_U):1,1:0) I RELSTS D
"RTN","ORCSEND",28,0)
 . D STARTDT^ORCSAVE2(ORIFN),PKGSTUFF^ORCSEND1(ORPKG) Q:$G(ORQUIT)
"RTN","ORCSEND",29,0)
 . S ORDUZ=$S(SIGSTS=0:$P(ORA0,U,7),SIGSTS=1:$P(ORA0,U,5),SIGSTS=2:$P(ORA0,U,17),SIGSTS=3:$P(ORA0,U,13),1:DUZ)
"RTN","ORCSEND",30,0)
 . D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,ORDUZ),NEW^ORMBLD(ORIFN)
"RTN","ORCSEND",31,0)
 . I "^10^13^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U) S ORERR=1 ;error
"RTN","ORCSEND",32,0)
 I 'RELSTS!$G(ORERR),$P($G(^OR(100,ORIFN,3)),U,3)=10 D STATUS^ORCSAVE2(ORIFN,11) S $P(^OR(100,ORIFN,8,1,0),U,15)=11
"RTN","ORCSEND",33,0)
 Q
"RTN","ORCSEND",34,0)
 ;
"RTN","ORCSEND",35,0)
EN2(ORIFN,SIGSTS,NATURE,ORERR)  ; -- Manual Release [from OREVNT1,SENDED^ORWDX]
"RTN","ORCSEND",36,0)
 N ORDA,ORNOW,OREVT,ORA0,ORNP,SIGNREQD,SIGNED,RELSTS
"RTN","ORCSEND",37,0)
 S ORDA=+$P(ORIFN,";",2),ORIFN=+ORIFN S:ORDA<1 ORDA=1
"RTN","ORCSEND",38,0)
 S OREVT=+$P($G(^OR(100,ORIFN,0)),U,17),ORA0=$G(^(8,ORDA,0))
"RTN","ORCSEND",39,0)
 S ORNP=$P(ORA0,U,3),SIGNREQD=($P(ORA0,U,4)'=3),(SIGNED,RELSTS)=1
"RTN","ORCSEND",40,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORERR="" I $P(ORA0,U,4)=2 D  ;needs ES
"RTN","ORCSEND",41,0)
 . N SIGNER S SIGNER=$S(SIGSTS=1:DUZ,1:"")
"RTN","ORCSEND",42,0)
 . I SIGSTS=2 D NOTIF^ORCSIGN S SIGNED=0 Q  ;still unsigned
"RTN","ORCSEND",43,0)
 . D:SIGSTS'="" SIGN^ORCSAVE2(ORIFN,SIGNER,ORNOW,SIGSTS,ORDA)
"RTN","ORCSEND",44,0)
 D NW I 'ORERR D SAVE^ORMEVNT1(+ORIFN,OREVT,2,"MN")
"RTN","ORCSEND",45,0)
 Q
"RTN","ORCSEND",46,0)
 ;
"RTN","ORCSEND",47,0)
NW ; -- New order ORIFN
"RTN","ORCSEND",48,0)
RW ; -- Rewritten order ORIFN
"RTN","ORCSEND",49,0)
XX ; -- Changed order ORIFN
"RTN","ORCSEND",50,0)
RN ; -- Renewed order ORIFN
"RTN","ORCSEND",51,0)
 N ORQUIT,STS,TYPE,OR0,OR3,CODE,ORIG,ORSAVE
"RTN","ORCSEND",52,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG,OREBUILD=1 Q
"RTN","ORCSEND",53,0)
 S:'ORDA ORDA=1 S ORSAVE=ORIFN
"RTN","ORCSEND",54,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)) D STARTDT^ORCSAVE2(ORIFN)
"RTN","ORCSEND",55,0)
 S TYPE=$P(OR3,U,11),ORIG=+$P(OR3,U,5),CODE="NW"
"RTN","ORCSEND",56,0)
 I TYPE=1,ORIG,$D(^OR(100,ORIG,4)) S CODE="XO",^OR(100,ORIG,6)=$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",57,0)
 D PKGSTUFF^ORCSEND1(+$P(OR0,U,14)) Q:$G(ORQUIT)
"RTN","ORCSEND",58,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",59,0)
 D NEW^ORMBLD(ORIFN,CODE) S ORIFN=ORSAVE,STS=$P($G(^OR(100,ORIFN,3)),U,3)
"RTN","ORCSEND",60,0)
 I (STS=1)!(STS=13) S ORERR="1^"_$$WHY(ORIFN,1) D:'SIGNED&SIGNREQD NOSIG K:ORIG ^OR(100,ORIG,6)
"RTN","ORCSEND",61,0)
 I STS=11 S ORERR="1^ERROR"
"RTN","ORCSEND",62,0)
 Q
"RTN","ORCSEND",63,0)
 ;
"RTN","ORCSEND",64,0)
DC ; -- DC order ORIFN
"RTN","ORCSEND",65,0)
 N PKG,CODE,ORCHLD,ORCHDA,STS,ORIDA,ORSAVE,OR3
"RTN","ORCSEND",66,0)
 I '$G(REASON),$G(NATURE)="D" S REASON=+$O(^ORD(100.03,"C","ORDUP",0))
"RTN","ORCSEND",67,0)
 S:$G(REASON) ^OR(100,ORIFN,6)=$S($G(NATURE):NATURE,$L($G(NATURE)):$O(^ORD(100.02,"C",NATURE,0)),1:"")_"^^^"_+REASON_U_$P(^ORD(100.03,+REASON,0),U)
"RTN","ORCSEND",68,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",69,0)
 S $P(^OR(100,ORIFN,6),U,2,3)=$S($G(DGPMT):"",1:DUZ)_U_ORNOW,ORSAVE=ORIFN S:'$G(REASON) REASON=$P(^(6),U,4)
"RTN","ORCSEND",70,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),PKG=$P($G(^(0)),U,14),PKG=$$NMSP^ORCD(PKG),CODE=$S(PKG="LR":"CA",(PKG="PS")&(STS=5):"CA",(PKG="FH")&(STS=8):"CA",1:"DC")
"RTN","ORCSEND",71,0)
 D:ORDA RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",72,0)
DC1 I $O(^OR(100,ORIFN,2,0)) D  G DC2 ; DC children
"RTN","ORCSEND",73,0)
 . S ORCHLD=0 F  S ORCHLD=$O(^OR(100,ORIFN,2,ORCHLD)) Q:ORCHLD'>0  I $$VALID^ORCACT0(ORCHLD,"DC") D  Q:$G(ORERR)
"RTN","ORCSEND",74,0)
 . . S ORCHDA=$S(ORDA:$$ACTION^ORCSAVE("DC",ORCHLD,ORNP),1:0)
"RTN","ORCSEND",75,0)
 . . D:ORCHDA SIGN^ORCSAVE2(ORCHLD,,,"",ORCHDA) ;Sig on Parent only
"RTN","ORCSEND",76,0)
 . . D MSG^ORMBLD((ORCHLD_";"_ORCHDA),CODE,$G(REASON))
"RTN","ORCSEND",77,0)
 . . I "^1^13^"'[(U_$P(^OR(100,ORCHLD,3),U,3)_U) S ORERR="1^"_$$WHY(ORCHLD,ORCHDA)
"RTN","ORCSEND",78,0)
 . ;D:'$G(ORERR) STATUS^ORCSAVE2(ORIFN,1)
"RTN","ORCSEND",79,0)
 . S:$G(ORERR) ^OR(100,ORIFN,8,ORDA,1)=$P(ORERR,U,2)
"RTN","ORCSEND",80,0)
 D MSG^ORMBLD((ORIFN_";"_ORDA),CODE,$G(REASON))
"RTN","ORCSEND",81,0)
DC2 S ORIFN=ORSAVE,OR3=$G(^OR(100,ORIFN,3)),STS=$P(OR3,U,3)
"RTN","ORCSEND",82,0)
 I STS'=1,STS'=13,STS'=2 D  Q
"RTN","ORCSEND",83,0)
 . S ORERR="1^"_$S(ORDA:$$WHY(ORIFN,ORDA),1:"Unable to discontinue")
"RTN","ORCSEND",84,0)
 . I ORDA,'SIGNED&SIGNREQD D NOSIG ; sig no longer reqd
"RTN","ORCSEND",85,0)
 . K ^OR(100,ORIFN,6)
"RTN","ORCSEND",86,0)
 S $P(^OR(100,ORIFN,3),U,7)=$S(ORDA:ORDA,'$$ACTV^ORX1($G(NATURE)):0,1:$P(OR3,U,7))
"RTN","ORCSEND",87,0)
 D CANCEL(ORIFN),SETALL^ORDD100(ORIFN)
"RTN","ORCSEND",88,0)
 I $P(OR3,U,11)=2 D  ; dc a renewal
"RTN","ORCSEND",89,0)
 . N ORIG,ORIG3,NATR S ORIG=$P(OR3,U,5),ORIG3=$G(^OR(100,ORIG,3)) Q:'ORIG
"RTN","ORCSEND",90,0)
 . I CODE="CA" S $P(^OR(100,ORIG,3),U,6)="" Q  ;pend - remove fwd ptr
"RTN","ORCSEND",91,0)
 . Q:"^1^7^12^13^"[(U_$P(ORIG3,U,3)_U)  S NATR=$O(^ORD(100.02,"C","A",0))
"RTN","ORCSEND",92,0)
 . S ^OR(100,ORIG,6)=NATR_U_DUZ_U_ORNOW_"^^Renewal cancelled"
"RTN","ORCSEND",93,0)
 . D MSG^ORMBLD(ORIG,"DC") I "^1^13^"'[$P(^OR(100,ORIG,3),U,3) K ^(6) Q
"RTN","ORCSEND",94,0)
 . S:'$$ACTV^ORX1(NATR) $P(^OR(100,ORIG,3),U,7)=0
"RTN","ORCSEND",95,0)
 Q
"RTN","ORCSEND",96,0)
 ;
"RTN","ORCSEND",97,0)
CANCEL(IFN) ; -- Cancel any outstanding actions for order IFN 
"RTN","ORCSEND",98,0)
 N I S I=0
"RTN","ORCSEND",99,0)
 F  S I=$O(^OR(100,IFN,8,I)) Q:I'>0  I $P(^(I,0),U,15)=11 S $P(^(0),U,15)=13 D:$P(^(0),U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,I) ; cancelled, sig not reqd now
"RTN","ORCSEND",100,0)
 Q
"RTN","ORCSEND",101,0)
 ;
"RTN","ORCSEND",102,0)
HD ; -- Hold order ORIFN
"RTN","ORCSEND",103,0)
 N STS,ORSAVE I 'ORDA S ORERR="1^Unable to hold" Q
"RTN","ORCSEND",104,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",105,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",106,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"HD") S ORIFN=ORSAVE
"RTN","ORCSEND",107,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3) I STS=3 S $P(^(3),U,7)=ORDA D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",108,0)
 I STS'=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",109,0)
 Q
"RTN","ORCSEND",110,0)
 ;
"RTN","ORCSEND",111,0)
RL ; -- Release hold on order ORIFN
"RTN","ORCSEND",112,0)
 N STS,ORSAVE,ORHD I 'ORDA S ORERR="1^Unable to release hold" Q
"RTN","ORCSEND",113,0)
 I SIGNREQD,'SIGNED,'RELSTS S ORERR=$$NEEDSIG Q
"RTN","ORCSEND",114,0)
 D RELEASE^ORCSAVE2(ORIFN,ORDA,ORNOW,DUZ,$G(NATURE))
"RTN","ORCSEND",115,0)
 S ORSAVE=ORIFN D MSG^ORMBLD((ORIFN_";"_ORDA),"RL") S ORIFN=ORSAVE
"RTN","ORCSEND",116,0)
 S STS=$P($G(^OR(100,ORIFN,3)),U,3),ORHD=+$P($G(^(3)),U,7)
"RTN","ORCSEND",117,0)
 I STS'=3 S $P(^OR(100,ORIFN,3),U,7)=ORDA,$P(^(8,ORHD,2),U,1,2)=ORNOW_U_DUZ D SET^ORDD100(ORIFN,ORDA)
"RTN","ORCSEND",118,0)
 I STS=3 S ORERR="1^"_$$WHY(ORIFN,ORDA) D:'SIGNED&SIGNREQD NOSIG
"RTN","ORCSEND",119,0)
 Q
"RTN","ORCSEND",120,0)
 ;
"RTN","ORCSEND",121,0)
FL ; -- Flag order ORIFN
"RTN","ORCSEND",122,0)
 Q
"RTN","ORCSEND",123,0)
 ;
"RTN","ORCSEND",124,0)
UF ; -- Unflag order ORIFN
"RTN","ORCSEND",125,0)
 Q
"RTN","ORCSEND",126,0)
 ;
"RTN","ORCSEND",127,0)
CM ; -- Add Ward comments to order ORIFN
"RTN","ORCSEND",128,0)
 Q
"RTN","ORCSEND",129,0)
 ;
"RTN","ORCSEND",130,0)
VR ; -- Verify order ORIFN
"RTN","ORCSEND",131,0)
 I 'ORDA!(SIGSTS=2) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",132,0)
 I "^N^C^R^"'[(U_$G(ORVER)_U) S ORERR="1^Unable to verify" Q
"RTN","ORCSEND",133,0)
 D VERIFY^ORCSAVE2(ORIFN,ORDA,ORVER,DUZ,ORNOW)
"RTN","ORCSEND",134,0)
 ; -- send HL7 msg to Pharmacy if Nurse-Verified, [Sts=pending]
"RTN","ORCSEND",135,0)
 Q:ORVER'="N"  N ORSTS,ORPKG,ORX
"RTN","ORCSEND",136,0)
 S ORX=$P($G(^OR(100,ORIFN,8,ORDA,0)),U,2) Q:ORX'="NW"&(ORX'="XX")
"RTN","ORCSEND",137,0)
 S ORPKG=+$P($G(^OR(100,ORIFN,0)),U,14),ORSTS=$P($G(^(3)),U,3)
"RTN","ORCSEND",138,0)
 ;I ORSTS=5!$L($T(ZV^ORMPS)),$$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",139,0)
 I $$NMSP^ORCD(ORPKG)="PS" D VER^ORMBLDPS(ORIFN)
"RTN","ORCSEND",140,0)
 Q
"RTN","ORCSEND",141,0)
 ;
"RTN","ORCSEND",142,0)
NEEDSIG() ; -- Msg
"RTN","ORCSEND",143,0)
 Q "1^This order requires a signature."
"RTN","ORCSEND",144,0)
 ;
"RTN","ORCSEND",145,0)
WHY(IFN,DA) ; -- Return reason request was rejected
"RTN","ORCSEND",146,0)
 N X S X=$G(^OR(100,IFN,8,DA,1))
"RTN","ORCSEND",147,0)
 S:'$L(X) X="Unable to "_$S(ACTION="HD":"hold",ACTION="RL":"release hold",ACTION="DC":"discontinue",ACTION="XX":"change",ACTION="RN":"renew",1:"release")
"RTN","ORCSEND",148,0)
 Q X
"RTN","ORCSEND",149,0)
 ;
"RTN","ORCSEND",150,0)
NOSIG ; -- Mark order as Sig not Req'd due to cancel/reject
"RTN","ORCSEND",151,0)
 D SIGN^ORCSAVE2(ORIFN,"","",5,ORDA) S SIGNREQD=0
"RTN","ORCSEND",152,0)
 Q
"RTN","ORCSEND",153,0)
 ;
"RTN","ORCSEND",154,0)
READY(IFN,ACT) ; -- Ready to release?
"RTN","ORCSEND",155,0)
 N X,Y,OR0,OR3,ORA
"RTN","ORCSEND",156,0)
 I ACTION="VR" S Y=1 G RQ ; no action to release
"RTN","ORCSEND",157,0)
 I 'ACT,ACTION="DC" S Y=1 G RQ ; cancel a duplicate
"RTN","ORCSEND",158,0)
 S Y=0,OR0=$G(^OR(100,IFN,0)),OR3=$G(^(3)),ORA=$G(^(8,ACT,0))
"RTN","ORCSEND",159,0)
 I $P(ORA,U,15)=11 S Y=1 G RQ ; unreleased
"RTN","ORCSEND",160,0)
 I $P(ORA,U,15)=10 D  G RQ ; delayed
"RTN","ORCSEND",161,0)
 . I $G(^DPT(+ORVP,.105)),$$GET1^DIQ(9.4,+$P(OR0,U,14)_",",1)="PSO" S Y=1 Q
"RTN","ORCSEND",162,0)
 . Q:'RELSTS  N ORIG S ORIG=+$P(OR3,U,5)
"RTN","ORCSEND",163,0)
 . I 'SIGNED,$L($G(NATURE)) S $P(ORA,U,17)=DUZ,$P(ORA,U,12)=$S(NATURE:NATURE,1:+$O(^ORD(100.02,"C",NATURE,0))),^OR(100,IFN,8,ACT,0)=ORA
"RTN","ORCSEND",164,0)
 . Q:$P(OR3,U,11)'=1!('ORIG)  ;dc original if signed edit
"RTN","ORCSEND",165,0)
 . D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORCSEND",166,0)
 . S ^OR(100,ORIG,6)=+$O(^ORD(100.02,"C","C",0))_U_DUZ_U_ORNOW
"RTN","ORCSEND",167,0)
 . S $P(^OR(100,ORIG,3),U,7)=0,$P(^(8,1,0),U,15)=12 D:$P($G(^(0)),U,4)=2 SIGN^ORCSAVE2(ORIG,,,5,1)
"RTN","ORCSEND",168,0)
 I $P(OR3,U,3)=11,$P(ORA,U,2)="NW" S Y=1 ; Action Sts = "" (old)
"RTN","ORCSEND",169,0)
RQ Q Y
"RTN","OREV1")
0^10^B80337093
"RTN","OREV1",1,0)
OREV1 ;SLC/DAN Event delayed orders set up continued ;1/14/03  11:54
"RTN","OREV1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**142,141,165**;Dec 17, 1997
"RTN","OREV1",3,0)
 ;DBIA reference section
"RTN","OREV1",4,0)
 ;2686 - ^XTV(8989.5 and ^XTV(8989.51
"RTN","OREV1",5,0)
 ;519  - ^DIC(45.7
"RTN","OREV1",6,0)
 ;2263  - XPAR
"RTN","OREV1",7,0)
 ;10039- ^DIC(42
"RTN","OREV1",8,0)
 ;10009- DICN
"RTN","OREV1",9,0)
 ;10018- DIE
"RTN","OREV1",10,0)
 ;10026- DIR
"RTN","OREV1",11,0)
 ;10116- VALM1
"RTN","OREV1",12,0)
 ;10103- XLFDT
"RTN","OREV1",13,0)
SCR ;Sets DIC("S") for MAS MOVEMENT TYPE field of either file
"RTN","OREV1",14,0)
 N FILE
"RTN","OREV1",15,0)
 S FILE="^ORD("_$O(DR(1,0))_","
"RTN","OREV1",16,0)
 S DIC("S")="S TMP=$P("_FILE_"DA,0),U,2),TTP=$E($P(^DG(405.3,$P(^DG(405.2,Y,0),U,2),0),U)) I $S(TMP=TTP:1,1:0)"_$S('$G(@(FILE_DA_",1)")):"&('$$INUSEDC^OREV1())",1:"")
"RTN","OREV1",17,0)
 Q
"RTN","OREV1",18,0)
 ;
"RTN","OREV1",19,0)
ACT ;Inactivate or reactivate an event or auto dc rule
"RTN","OREV1",20,0)
 N ORJ,Y,ORTMP,DA,DIC,ORGLOB
"RTN","OREV1",21,0)
 S VALMBCK="R" D FULL^VALM1
"RTN","OREV1",22,0)
 S ORGLOB="^ORD(100."_$S(ORTYPE="E":"5,",1:"6,")
"RTN","OREV1",23,0)
 I $G(ORNMBR)="" S ORNMBR=$$ORDERS("activate/inactivate")
"RTN","OREV1",24,0)
 F ORJ=1:1:$L(ORNMBR,",")-1 S ORTMP=$P(ORNMBR,",",ORJ),DA=$O(^TMP("OREDO",$J,"IDX",ORTMP,0)) D FLIP(DA)
"RTN","OREV1",25,0)
 Q
"RTN","OREV1",26,0)
 ;
"RTN","OREV1",27,0)
FLIP(DA) ;Check status and flip if necessary
"RTN","OREV1",28,0)
 N STAT,DIR,DIE,DR,Y,NAME,CDT,MULT,IEN,SUB,USED,EVNTYPE
"RTN","OREV1",29,0)
 S NAME=$P(@(ORGLOB_DA_",0)"),U),EVNTYPE=$P(^(0),U,2)
"RTN","OREV1",30,0)
 S CDT=$$NOW^XLFDT
"RTN","OREV1",31,0)
 S STAT=$S($G(@(ORGLOB_DA_",1)")):^(1),1:0) ;Status is date/time if already inactivated
"RTN","OREV1",32,0)
 W !!,NAME," is currently ",$S(STAT:"IN",1:"")_"ACTIVE."
"RTN","OREV1",33,0)
 I ORTYPE="E",$$RELEVNTS(DA),'STAT W !!,"There are delayed orders awaiting release that are associated with this event.",!,"This event, even if inactivated, will still be applied to these delayed orders.",!!
"RTN","OREV1",34,0)
 I ORTYPE="A",'STAT W !!,"Inactivating auto-dc rules takes effect immediately.",!
"RTN","OREV1",35,0)
 I STAT,$G(EVNTYPE)="O",$$ACTSURG^OREV4(ORTYPE,DA) D  Q
"RTN","OREV1",36,0)
 .W !,NAME,!,"can not be activated because you already have an active surgery rule for this",!,"division.  Only one active surgery rule per division is allowed.",!
"RTN","OREV1",37,0)
 .S DIR(0)="E",DIR("A")="Press enter to continue" D ^DIR K DIR
"RTN","OREV1",38,0)
 I STAT,ORTYPE="E",$P($G(^ORD(100.5,DA,0)),U,12),$G(^ORD(100.5,$P(^(0),U,12),1)) D  Q  ;If inactive child event and parent is inactive don't activate child
"RTN","OREV1",39,0)
 .W !,NAME,!,"can not be activated until its parent event is active.",!
"RTN","OREV1",40,0)
 .S DIR(0)="E",DIR("A")="Press enter to continue" D ^DIR K DIR
"RTN","OREV1",41,0)
 I STAT,ORTYPE="E",'$$CANACT(DA,.USED) D  Q
"RTN","OREV1",42,0)
 .W !,NAME,!,"can not be activated because the following locations",!,"and/or treating specialties are currently in use by other entries.",!
"RTN","OREV1",43,0)
 .F MULT="LOC","TS" W:$D(USED(MULT)) !,$S(MULT="LOC":"LOCATIONS:",1:"TREATING SPECIALTIES:"),! D
"RTN","OREV1",44,0)
 ..S IEN=0 F  S IEN=$O(USED(MULT,IEN)) Q:'+IEN  D
"RTN","OREV1",45,0)
 ...S SUB=0 F  S SUB=$O(USED(MULT,IEN,SUB)) Q:'+SUB  D
"RTN","OREV1",46,0)
 ....W !,$S(MULT="LOC":$P($G(^DIC(42,SUB,0)),"^"),1:$P($G(^DIC(45.7,SUB,0)),"^"))," is in use by ",$P($G(@(ORGLOB_IEN_",0)")),"^"),!
"RTN","OREV1",47,0)
 .W !,"For active entries, LOCATIONS and TREATING SPECIALTIES",!,"must be unique within division and event type."
"RTN","OREV1",48,0)
 .S DIR(0)="E",DIR("A")="Press enter to continue" D ^DIR K DIR
"RTN","OREV1",49,0)
 I STAT I ORTYPE="A" I '$$CANACT(DA,.USED) D  Q
"RTN","OREV1",50,0)
 .W !,NAME,!,"can not be activated because the following MAS movements",!,"are currently in use by other entries.",!
"RTN","OREV1",51,0)
 .S IEN=0 F  S IEN=$O(USED(IEN)) Q:'+IEN  D
"RTN","OREV1",52,0)
 ..S SUB=0 F  S SUB=$O(USED(IEN,SUB)) Q:'+SUB  D
"RTN","OREV1",53,0)
 ...W !,$P($G(^DG(405.2,IEN,0)),U)," is in use by ",$P($G(^ORD(100.6,SUB,0)),U)
"RTN","OREV1",54,0)
 .W !,"For active entries, MAS movements within DIVISION must be unique."
"RTN","OREV1",55,0)
 .S DIR(0)="E",DIR("A")="Press return to continue" D ^DIR K DIR
"RTN","OREV1",56,0)
 ;
"RTN","OREV1",57,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Are you sure you want to "_$S(STAT:"",1:"IN")_"ACTIVATE this entry" D ^DIR
"RTN","OREV1",58,0)
 I Y'=1 W !,"Nothing changed!" Q
"RTN","OREV1",59,0)
 S DIE=ORGLOB,DR="1///"_$S(STAT:"@",1:CDT) D ^DIE W !,NAME," is now "_$S(STAT:"",1:"IN")_"ACTIVATED!"
"RTN","OREV1",60,0)
 I 'STAT S DA(1)=DA,DA=$O(@(ORGLOB_DA(1)_",2,"_"""ACT"""_",0)")),DIE=ORGLOB_DA(1)_",2,",DR="1///"_CDT D ^DIE D:ORTYPE="E" UPDTCHLD^OREV3(DA(1),CDT) Q
"RTN","OREV1",61,0)
 D SET(DA,CDT)
"RTN","OREV1",62,0)
 Q
"RTN","OREV1",63,0)
 ;
"RTN","OREV1",64,0)
SET(MIEN,X) ;add new multiple to activation history
"RTN","OREV1",65,0)
 N DIC,DA
"RTN","OREV1",66,0)
 S DA(1)=MIEN
"RTN","OREV1",67,0)
 S DIC=ORGLOB_DA(1)_",2,",DIC(0)="L"
"RTN","OREV1",68,0)
 D FILE^DICN
"RTN","OREV1",69,0)
 Q
"RTN","OREV1",70,0)
 ;
"RTN","OREV1",71,0)
INUSE(MULT) ;determine if location or treating specialty is already in use
"RTN","OREV1",72,0)
 N ACTIVE,USED,NAME,TYPE,DIV,FMIEN
"RTN","OREV1",73,0)
 S USED=0,NAME="",FMIEN=$G(DA(1),DA)
"RTN","OREV1",74,0)
 S TYPE=$P($G(^ORD(100.5,FMIEN,0)),"^",2) ;movement type of entry being checked
"RTN","OREV1",75,0)
 S DIV=$P($G(^ORD(100.5,FMIEN,0)),"^",3) ;division of entry being checked
"RTN","OREV1",76,0)
 F  S NAME=$O(^ORD(100.5,"C",NAME)) Q:NAME=""!(USED)  D
"RTN","OREV1",77,0)
 .S ACTIVE=0 F  S ACTIVE=$O(^ORD(100.5,"C",NAME,ACTIVE)) Q:'+ACTIVE!USED  D
"RTN","OREV1",78,0)
 ..Q:DIV'=$P($G(^ORD(100.5,ACTIVE,0)),"^",3)  ;stop processing if not same division
"RTN","OREV1",79,0)
 ..Q:TYPE'=$P($G(^ORD(100.5,ACTIVE,0)),"^",2)  ;stop processing if not the same type
"RTN","OREV1",80,0)
 ..S USED=$D(^ORD(100.5,ACTIVE,MULT,"B",Y)) I USED S WHO=ACTIVE
"RTN","OREV1",81,0)
 Q USED
"RTN","OREV1",82,0)
 ;
"RTN","OREV1",83,0)
CANACT(DA,USED) ;Function returns whether or not an entry can be activated.
"RTN","OREV1",84,0)
 ;For EVENTS, locations and specialties must be unique within division
"RTN","OREV1",85,0)
 ;and EVENT TYPE.  For AUTO DC, movement types must be unique within
"RTN","OREV1",86,0)
 ;division.
"RTN","OREV1",87,0)
 N MULT,SUB,Y,CANACT,WHO
"RTN","OREV1",88,0)
 S CANACT=1
"RTN","OREV1",89,0)
 I ORTYPE="E" F MULT="LOC","TS" D
"RTN","OREV1",90,0)
 .S SUB=0 F  S SUB=$O(^ORD(100.5,DA,MULT,SUB)) Q:'+SUB  D
"RTN","OREV1",91,0)
 ..S Y=$G(^(SUB,0)) I Y I $$INUSE(MULT) S CANACT=0,USED(MULT,WHO,Y)=""
"RTN","OREV1",92,0)
 ;
"RTN","OREV1",93,0)
 I ORTYPE="A" D
"RTN","OREV1",94,0)
 .S SUB=0 F  S SUB=$O(^ORD(100.6,DA,3,SUB)) Q:'+SUB  D
"RTN","OREV1",95,0)
 ..S Y=+$G(^(SUB,0)) I Y I $$INUSEDC() S CANACT=0,USED(Y,WHO)=""
"RTN","OREV1",96,0)
 Q CANACT
"RTN","OREV1",97,0)
 ;
"RTN","OREV1",98,0)
INUSEDC() ;Checks AUTO-DC rules for unique movement types
"RTN","OREV1",99,0)
 N DIV,USED
"RTN","OREV1",100,0)
 S USED=0
"RTN","OREV1",101,0)
 S DIV=+$P($G(^ORD(100.6,DA,0)),U,3)
"RTN","OREV1",102,0)
 I DIV I $D(^ORD(100.6,"AC",DIV,Y)) S WHO=$O(^(Y,0)),USED=1
"RTN","OREV1",103,0)
 Q USED
"RTN","OREV1",104,0)
 ;
"RTN","OREV1",105,0)
HASREQD() ;Function returns whether entry has required entries or not
"RTN","OREV1",106,0)
 N REQD
"RTN","OREV1",107,0)
 S REQD=0
"RTN","OREV1",108,0)
 I ORTYPE="E" D
"RTN","OREV1",109,0)
 .I "^22^23^24^"[("^"_$P($G(^ORD(100.5,DA,0)),U,7)_"^") S REQD=1 Q  ;From pass (transfer) doesn't require treating specialty
"RTN","OREV1",110,0)
 .I $O(^ORD(100.5,DA,"LOC",0))>0!($O(^ORD(100.5,DA,"TS",0))>0) S REQD=1 ;Has locations or treating specialties
"RTN","OREV1",111,0)
 .I $O(^ORD(100.5,DA,"LOC",0))>0&($O(^ORD(100.5,DA,"TS",0))>0) S REQD=2 ;Warn user that both must be true if both defined.
"RTN","OREV1",112,0)
 I ORTYPE="A" D
"RTN","OREV1",113,0)
 .I $P($G(^ORD(100.6,DA,0)),U,2)="O" S REQD=1 ;If type is operating room then movements not required
"RTN","OREV1",114,0)
 .I $P($G(^ORD(100.6,DA,0)),U,2)'="O"&($O(^ORD(100.6,DA,3,0))>0) S REQD=1 ;movement type exists
"RTN","OREV1",115,0)
 .I $P($G(^ORD(100.6,DA,0)),U,2)="T",$D(^ORD(100.6,DA,3,"B",4)),$P($G(^ORD(100.6,DA,3,0)),U,4)>1 S REQD=2 ;If transfer type and interward transfer type not by itself
"RTN","OREV1",116,0)
 Q REQD
"RTN","OREV1",117,0)
 ;
"RTN","OREV1",118,0)
CHKTYP(IEN) ;Check type of event and delete fields that are no longer needed based on the event type
"RTN","OREV1",119,0)
 N J,DR,DIE,DA,DIC,TYPE
"RTN","OREV1",120,0)
 I ORTYPE="E" D  Q
"RTN","OREV1",121,0)
 .S TYPE=$P(^ORD(100.5,IEN,0),U,2)
"RTN","OREV1",122,0)
 .I TYPE'="A"&(TYPE'="T") D DELMUL(100.5,IEN,"""LOC"""),DELMUL(100.5,IEN,"""TS""") ;if not admit or transfer delete locations and treating specialties
"RTN","OREV1",123,0)
 .S DA=IEN,DIE=100.5,DR="7///@" D ^DIE ;Delete MAS MOVEMENT when type changes as movement types are associated with event type
"RTN","OREV1",124,0)
 ;If not event type must be auto-dc
"RTN","OREV1",125,0)
 S TYPE=$P(^ORD(100.6,IEN,0),U,2)
"RTN","OREV1",126,0)
 I TYPE'="D" S DA=IEN,DIE=100.6,DR="6///@" D ^DIE ;Delete 'except from observation" if not discharge type
"RTN","OREV1",127,0)
 D DELMUL(100.6,IEN,3) ;delete MAS MOVEMENT
"RTN","OREV1",128,0)
 I TYPE'="S" D DELMUL(100.6,IEN,4) ;If not specialty type delete excluded treating specialties
"RTN","OREV1",129,0)
 I TYPE'="T" D DELMUL(100.6,IEN,5),DELMUL(100.6,IEN,6) ;If not transfer type delete included locations and included divisions
"RTN","OREV1",130,0)
 Q
"RTN","OREV1",131,0)
 ;
"RTN","OREV1",132,0)
ORDERS(ACTION) ; -- Return order numbers to act on, if action chosen first
"RTN","OREV1",133,0)
 N X,Y,DIR,MAX
"RTN","OREV1",134,0)
 S MAX=$G(VALMCNT) Q:MAX'>0 ""
"RTN","OREV1",135,0)
 I ACTION="edit" W !!,"Enter item number to edit or press enter to create a new entry"
"RTN","OREV1",136,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select item(s): "
"RTN","OREV1",137,0)
 S DIR("?")="Enter the items you wish to "_ACTION_", as a range or list of numbers."_$S(ACTION="edit":" Press enter to create a NEW entry",1:"")
"RTN","OREV1",138,0)
 D ^DIR S:$D(DTOUT) Y="^"
"RTN","OREV1",139,0)
 I $D(Y(1)) W !,">>>Too many entries selected, try using smaller ranges" H 2 S Y="^"
"RTN","OREV1",140,0)
 Q Y
"RTN","OREV1",141,0)
 ;
"RTN","OREV1",142,0)
 ;
"RTN","OREV1",143,0)
CANDEL(FILE) ;Determines if event or rule can be deleted
"RTN","OREV1",144,0)
 N DEL,EVENT,LIST,I,J
"RTN","OREV1",145,0)
 S DEL=1
"RTN","OREV1",146,0)
 S EVENT=$O(^XTV(8989.51,"B","ORWDX WRITE ORDERS EVENT LIST",0))
"RTN","OREV1",147,0)
 S LIST=$O(^XTV(8989.51,"B","OREVNT COMMON LIST",0))
"RTN","OREV1",148,0)
 I FILE=100.5 D
"RTN","OREV1",149,0)
 .I $O(^ORE(100.2,"E",DA,0)) W !,"< Can't delete this event because file 100.2 is pointing to it >  " S DEL=0 Q
"RTN","OREV1",150,0)
 .I $D(^ORD(100.5,"DAD",DA)) W !,"< Can't delete parent events that have children >  " S DEL=0 Q
"RTN","OREV1",151,0)
 .S FND=0
"RTN","OREV1",152,0)
 .K LST D ENVAL^XPAR(.LST,LIST)
"RTN","OREV1",153,0)
 .S I="" F  S I=$O(LST(I)) Q:I=""!(FND)  D
"RTN","OREV1",154,0)
 ..S J="" F  S J=$O(LST(I,J)) Q:J=""!(FND)  I LST(I,J)=DA S FND=1
"RTN","OREV1",155,0)
 .I 'FND K LST D ENVAL^XPAR(.LST,EVENT) D
"RTN","OREV1",156,0)
 ..S I="" F  S I=$O(LST(I)) Q:I=""!(FND)  D
"RTN","OREV1",157,0)
 ...S J="" F  S J=$O(LST(I,J)) Q:J=""!(FND)  I DA=J S FND=1
"RTN","OREV1",158,0)
 .I FND W !,"< Can't delete event because parameters are pointing to it >  " S DEL=0
"RTN","OREV1",159,0)
 ;
"RTN","OREV1",160,0)
 I FILE=100.6 D
"RTN","OREV1",161,0)
 .I $O(^ORE(100.2,"DC",DA,0)) S DEL=0 W !,"< Can't delete this rule because file 100.2 is pointing to it >  " Q
"RTN","OREV1",162,0)
 ;
"RTN","OREV1",163,0)
 Q 'DEL  ;Reverse value of DEL so that $T is set correctly for fileman to determine if entry can be deleted.  Code is in ^DD(file#,.01,"DEL",.01,0)
"RTN","OREV1",164,0)
 ;
"RTN","OREV1",165,0)
ASKOBS() ;Function to determine if 'except from observation' field should be asked.
"RTN","OREV1",166,0)
 N ANS
"RTN","OREV1",167,0)
 S ANS=1
"RTN","OREV1",168,0)
 I ETYPE="D" I $D(^ORD(100.6,DA,3,"B",12))!($D(^ORD(100.6,DA,3,"B",38))) S ANS=0 ;Don't ask if MAS MOVEMENT TYPE is 12 (death) or 38 (death with autopsy)
"RTN","OREV1",169,0)
 I ETYPE="T" I '$D(^ORD(100.6,DA,3,"B",14)) S ANS=0 ;If MAS MOVEMENT TYPE doesn't contain FROM ASIH (VAH) when type is transfer then don't ask
"RTN","OREV1",170,0)
 Q ANS
"RTN","OREV1",171,0)
 ;
"RTN","OREV1",172,0)
DELMUL(FILE,IEN,LOC) ;Delete multiple entries for entry IEN in file FILE stored at location LOC
"RTN","OREV1",173,0)
 N I,DR,DIE,DA,DIC,GLOB,Y,DQ,DP,DL,DM,DI,DK
"RTN","OREV1",174,0)
 S GLOB="^ORD("_FILE_","_IEN_","
"RTN","OREV1",175,0)
 S I=0 F  S I=$O(@(GLOB_LOC_","_I_")")) Q:'+I  S DA(1)=IEN,DA=I,DR=".01///@",DIE="^ORD("_FILE_",DA(1),"_LOC_"," D ^DIE
"RTN","OREV1",176,0)
 Q
"RTN","OREV1",177,0)
 ;
"RTN","OREV1",178,0)
RELEVNTS(DA) ;Check to see if release event is currently being pointed to
"RTN","OREV1",179,0)
 N DFN,EVENT
"RTN","OREV1",180,0)
 S (DFN,EVENT)=0
"RTN","OREV1",181,0)
 F  S DFN=$O(^ORE(100.2,"AE",DFN)) Q:'+DFN  I $D(^ORE(100.2,"AE",DFN,DA)) S EVENT=1 Q
"RTN","OREV1",182,0)
 Q EVENT
"RTN","OREV3")
0^9^B89473632
"RTN","OREV3",1,0)
OREV3 ;SLC/DAN Event delayed orders set up continued ;12/23/02  13:28
"RTN","OREV3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165**;Dec 17, 1997
"RTN","OREV3",3,0)
 ;DBIA reference section
"RTN","OREV3",4,0)
 ;10116 - VALM1
"RTN","OREV3",5,0)
 ;2324  - USRLM
"RTN","OREV3",6,0)
 ;10009 - DICN
"RTN","OREV3",7,0)
 ;2056  - DIQ
"RTN","OREV3",8,0)
 ;2336  - XPAREDIT
"RTN","OREV3",9,0)
 ;2263  - XPAR
"RTN","OREV3",10,0)
 ;10006 - DIC
"RTN","OREV3",11,0)
 ;10026 - DIR
"RTN","OREV3",12,0)
 ;10018 - DIE
"RTN","OREV3",13,0)
 ;10103 - XLFDT
"RTN","OREV3",14,0)
 ;
"RTN","OREV3",15,0)
ACE ;Add child events to existing events
"RTN","OREV3",16,0)
 N DIC,ORJ,ORTMP,DA,Y,ORGLOB,ADD
"RTN","OREV3",17,0)
 D FULL^VALM1 ;get full screen
"RTN","OREV3",18,0)
 S VALMBCK="R"
"RTN","OREV3",19,0)
 S (DIC,ORGLOB)="^ORD(100.5,"
"RTN","OREV3",20,0)
 I $G(ORNMBR)="" S ORNMBR=$$ORDERS^OREV1("add child events to") Q:ORNMBR="^"  ;If action selected before items, get items
"RTN","OREV3",21,0)
 I $G(ORNMBR)="" D  Q
"RTN","OREV3",22,0)
 .S DIC(0)="AEMQ",DIC("S")="I '+$P($G(^(0)),U,12)" ;Screen children from being parents
"RTN","OREV3",23,0)
 .D ^DIC Q:Y=-1  S DA=+Y
"RTN","OREV3",24,0)
 .Q:'$$PARENTOK^OREV4
"RTN","OREV3",25,0)
 .L +@(ORGLOB_DA_")"):1 I '$T W !!,"This entry is being edited by another user." H 3 Q
"RTN","OREV3",26,0)
 .W !!,"Adding children to parent ",$P(^ORD(100.5,DA,0),U)
"RTN","OREV3",27,0)
 .D ADDCHLD(DA,.ADD) ;Add child to selected event
"RTN","OREV3",28,0)
 .I $G(ADD) D AUDIT^OREV(DA,"E"),CHKPRM^OREV4 ;If child event added update audit history and check parameters
"RTN","OREV3",29,0)
 .L -@(ORGLOB_DA_")")
"RTN","OREV3",30,0)
 F ORJ=1:1:$L(ORNMBR,",")-1 S ORTMP=$P(ORNMBR,",",ORJ),DA=$O(^TMP("OREDO",$J,"IDX",ORTMP,0)) D
"RTN","OREV3",31,0)
 .I $P($G(^ORD(100.5,DA,0)),U,12) W !!,"You may not add child events to events that are already children.",!,$P($G(^ORD(100.5,DA,0)),U)," - SKIPPED!",! H 3 Q
"RTN","OREV3",32,0)
 .Q:'$$PARENTOK^OREV4
"RTN","OREV3",33,0)
 .L +@(ORGLOB_DA_")"):1 I '$T W !!,"This entry is being edited by another user." H 3 Q  ;Lock global
"RTN","OREV3",34,0)
 .W !!,"Adding children to parent ",$P(^ORD(100.5,DA,0),U)
"RTN","OREV3",35,0)
 .D ADDCHLD(DA,.ADD) ;Add child to selected event
"RTN","OREV3",36,0)
 .I $G(ADD) D AUDIT^OREV(DA,"E"),CHKPRM^OREV4 ;If child event added update audit history and check paramters
"RTN","OREV3",37,0)
 .L -@(ORGLOB_DA_")") ;Unlock global
"RTN","OREV3",38,0)
 Q
"RTN","OREV3",39,0)
 ;
"RTN","OREV3",40,0)
ADDCHLD(ENTRY,ADD) ;Add child(ren) to event
"RTN","OREV3",41,0)
 ;ENTRY - Internal entry number of event that will be the parent
"RTN","OREV3",42,0)
 ;ADD - Will be set to 1 if a child is successfully added
"RTN","OREV3",43,0)
 ;
"RTN","OREV3",44,0)
 N DIR,Y,DIC,DIE,DA,DR,DIRUT,X,NEW
"RTN","OREV3",45,0)
 F  D  Q:$G(DIRUT)
"RTN","OREV3",46,0)
 .W !
"RTN","OREV3",47,0)
 .S DIR(0)="FAO^3:50"
"RTN","OREV3",48,0)
 .S DIR("A")="OE/RR CHILD RELEASE EVENT NAME: "
"RTN","OREV3",49,0)
 .S DIR("?")="Enter the name of the child event you wish to create.  It must be free text between 3 and 50 characters and be unique."
"RTN","OREV3",50,0)
 .D ^DIR
"RTN","OREV3",51,0)
 .Q:$G(DIRUT)
"RTN","OREV3",52,0)
 .I $D(^ORD(100.5,"B",Y)) W !,"There is already an entry with this name.  Please select a different name." Q
"RTN","OREV3",53,0)
 .S DIC="^ORD(100.5,",DIC(0)="",X=Y D FILE^DICN ;Add child to file
"RTN","OREV3",54,0)
 .Q:Y=-1
"RTN","OREV3",55,0)
 .S DIE=DIC
"RTN","OREV3",56,0)
 .S DR="[OREV CHILD EVENT"
"RTN","OREV3",57,0)
 .S DA=+Y
"RTN","OREV3",58,0)
 .S NEW=1
"RTN","OREV3",59,0)
 .D ^DIE
"RTN","OREV3",60,0)
 .Q:'$G(DA)  ;Child event deleted, stop processing
"RTN","OREV3",61,0)
 .D AUDIT^OREV(DA,"N") ;Update audit history for child
"RTN","OREV3",62,0)
 .S DR="1///"_$$NOW^XLFDT_";14///`"_ENTRY D ^DIE ;Add parent pointer to child entry
"RTN","OREV3",63,0)
 .S ADD=1 ;Indicate that child was added
"RTN","OREV3",64,0)
 .W !!,"Enter next child name or press enter to stop adding children."
"RTN","OREV3",65,0)
 Q
"RTN","OREV3",66,0)
 ;
"RTN","OREV3",67,0)
UPDTCHLD(PARENT,CDT) ;Update children to inactive when parent is inactivated
"RTN","OREV3",68,0)
 N DA,DIE,CHILD,DR,DONE
"RTN","OREV3",69,0)
 S DONE=0
"RTN","OREV3",70,0)
 S CHILD="" F  S CHILD=$O(^ORD(100.5,"DAD",PARENT,CHILD)) Q:'+CHILD  D
"RTN","OREV3",71,0)
 .I 'DONE W !!,"Updating children..." S DONE=1
"RTN","OREV3",72,0)
 .Q:$G(^ORD(100.5,CHILD,1))  ;Child is already inactive
"RTN","OREV3",73,0)
 .S DA=CHILD
"RTN","OREV3",74,0)
 .S DIE="^ORD(100.5,"
"RTN","OREV3",75,0)
 .S DR="1///"_CDT
"RTN","OREV3",76,0)
 .D ^DIE ;Sets inactivated date/time for child
"RTN","OREV3",77,0)
 .;
"RTN","OREV3",78,0)
 .S DA(1)=DA
"RTN","OREV3",79,0)
 .S DA=$O(^ORD(100.5,DA(1),2,"ACT",0))
"RTN","OREV3",80,0)
 .S DIE="^ORD(100.5,DA(1),2,"
"RTN","OREV3",81,0)
 .S DR="1///"_CDT
"RTN","OREV3",82,0)
 .D ^DIE ;Update inactivated date/time of activation multiple for child
"RTN","OREV3",83,0)
 Q
"RTN","OREV3",84,0)
 ;
"RTN","OREV3",85,0)
PARAM ;Allow user to edit event delayed order parameters
"RTN","OREV3",86,0)
 N DIR,Y
"RTN","OREV3",87,0)
 S VALMBCK="R" D FULL^VALM1
"RTN","OREV3",88,0)
 F  D  Q:'Y
"RTN","OREV3",89,0)
 .S DIR(0)="SO^1:Write orders list by event;2:Default release event;3:Common release event list;4:Manual release controlled by;5:Set manual release parameter;6:Exclude display groups from copy"
"RTN","OREV3",90,0)
 .S DIR("A")="Select parameter to edit"
"RTN","OREV3",91,0)
 .D ^DIR Q:'Y
"RTN","OREV3",92,0)
 .I Y=2!(Y=3) D:Y=2 SETDFLT() D:Y=3 EVENTLST Q
"RTN","OREV3",93,0)
 .D EDITPAR^XPAREDIT($S(Y=1:"ORWDX WRITE ORDERS EVENT LIST",Y=4:"OREVNT MANUAL RELEASE CONTROL",Y=5:"OREVNT MANUAL RELEASE",1:"OREVNT EXCLUDE DGRP"))
"RTN","OREV3",94,0)
 Q
"RTN","OREV3",95,0)
 ;
"RTN","OREV3",96,0)
CANREL() ;Function to determine if delayed order can be manually released
"RTN","OREV3",97,0)
 N ORMAN,CAN
"RTN","OREV3",98,0)
 S ORMAN=$$GET^XPAR("ALL","OREVNT MANUAL RELEASE CONTROL")
"RTN","OREV3",99,0)
 S:ORMAN="" ORMAN="K" ;If no value found, default to checking for keys
"RTN","OREV3",100,0)
 I ORMAN="K",'$$KEY Q 0
"RTN","OREV3",101,0)
 I ORMAN="P",'$$MANPARAM Q 0
"RTN","OREV3",102,0)
 I ORMAN="B" D  Q:$G(CAN)=0 0
"RTN","OREV3",103,0)
 .I $$KEY,$$MANPARAM=0 S CAN=0 Q
"RTN","OREV3",104,0)
 .I '$$KEY,'$$MANPARAM S CAN=0
"RTN","OREV3",105,0)
 Q 1
"RTN","OREV3",106,0)
 ;
"RTN","OREV3",107,0)
KEY() ;Check for ORES or ORELSE keys
"RTN","OREV3",108,0)
 I '$D(^XUSEC("ORES",DUZ))&('$D(^XUSEC("ORELSE",DUZ))) Q 0
"RTN","OREV3",109,0)
 Q 1
"RTN","OREV3",110,0)
 ;
"RTN","OREV3",111,0)
MANPARAM() ;Check setting of OREVNT MANUAL RELEASE parameter
"RTN","OREV3",112,0)
 N LST,I,FND,PRM,X,Y,DIC,EXP,STR,VAL,FNDNO
"RTN","OREV3",113,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT MANUAL RELEASE" D ^DIC
"RTN","OREV3",114,0)
 I Y=-1 Q 0  ;Parameter not found so quit
"RTN","OREV3",115,0)
 S PRM=+Y
"RTN","OREV3",116,0)
 ;Check USER level
"RTN","OREV3",117,0)
 S VAL=$$GET^XPAR("USR",PRM) I VAL'="" Q VAL
"RTN","OREV3",118,0)
 ;Check USER CLASS
"RTN","OREV3",119,0)
 D WHATIS^USRLM(DUZ,"LST")
"RTN","OREV3",120,0)
 I $O(LST(0))'="" D  I FND'="" Q FND
"RTN","OREV3",121,0)
 .S FND=""
"RTN","OREV3",122,0)
 .S I=0 F  S I=$O(LST(I)) Q:I=""!(FND)  S EXP=+$P(LST(I),U,5),STR=+$P(LST(I),U,4) I 'EXP!(EXP'<DT) I 'STR!(STR'>DT) S FND=$G(^XTV(8989.5,"AC",PRM,$P(LST(I),U)_";USR(8930,",1)) I FND=0 S FNDNO=1
"RTN","OREV3",123,0)
 .I 'FND,$G(FNDNO) S FND=0
"RTN","OREV3",124,0)
 ;Check OE/RR Teams
"RTN","OREV3",125,0)
 K LST,FNDNO
"RTN","OREV3",126,0)
 D TEAMPR^ORQPTQ1(.LST,DUZ)
"RTN","OREV3",127,0)
 I +$G(LST(1)) D  I FND'="" Q FND
"RTN","OREV3",128,0)
 .S FND=""
"RTN","OREV3",129,0)
 .S I=0 F  S I=$O(LST(I)) Q:I=""!(FND)  S FND=$G(^XTV(8989.5,"AC",PRM,$P(LST(I),U)_";OR(100.21,",1)) S:FND=0 FNDNO=1
"RTN","OREV3",130,0)
 .I 'FND,$G(FNDNO) S FND=0
"RTN","OREV3",131,0)
 ;Check location
"RTN","OREV3",132,0)
 I +$G(LOC) S VAL=$$GET^XPAR("LOC.`"_+$G(LOC),PRM) I VAL'="" Q VAL
"RTN","OREV3",133,0)
 ;Check Service
"RTN","OREV3",134,0)
 S VAL=$G(^XTV(8989.5,"AC",PRM,+$$GET1^DIQ(200,DUZ,29,"I")_";DIC(49,",1)) I VAL'="" Q VAL
"RTN","OREV3",135,0)
 ;Check Division and System
"RTN","OREV3",136,0)
 S VAL=$$GET^XPAR("DIV^SYS",PRM) I VAL'="" Q VAL
"RTN","OREV3",137,0)
 Q ""
"RTN","OREV3",138,0)
 ;
"RTN","OREV3",139,0)
DEFHELP ;Provide detailed help for setting default treating specialty
"RTN","OREV3",140,0)
 N DEF,DEFTS,DEFTSNM
"RTN","OREV3",141,0)
 I $D(^ORD(100.5,DA(1),"TS","DEF")) D  Q
"RTN","OREV3",142,0)
 .S DEF=$O(^ORD(100.5,DA(1),"TS","DEF",1,0))
"RTN","OREV3",143,0)
 .I DEF=DA Q  ;Default is current entry
"RTN","OREV3",144,0)
 .S DEFTS=$P(^ORD(100.5,DA(1),"TS",DEF,0),U)
"RTN","OREV3",145,0)
 .S DEFTSNM=$$GET1^DIQ(45.7,DEFTS_",",.01)
"RTN","OREV3",146,0)
 .W !?5,"You may not set this treating specialty as the default because"
"RTN","OREV3",147,0)
 .W !?5,DEFTSNM," is already set as the default."
"RTN","OREV3",148,0)
 .W !?5,"If you would like to change the default you must first delete the",!?5,"default designation from the above mentioned treating specialty.",!
"RTN","OREV3",149,0)
 ;
"RTN","OREV3",150,0)
 W !?5,"Currently there is no default treating specialty set for this event.",!
"RTN","OREV3",151,0)
 Q
"RTN","OREV3",152,0)
 ;
"RTN","OREV3",153,0)
EVENTLST ;Allow user to edit OREVNT COMMON LIST parameter and set a default for that list
"RTN","OREV3",154,0)
 N DIC,X,Y,PRM,ORENT
"RTN","OREV3",155,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT COMMON LIST" D ^DIC
"RTN","OREV3",156,0)
 Q:Y=-1  ;Parameter doesn't exist
"RTN","OREV3",157,0)
 S PRM=Y
"RTN","OREV3",158,0)
 D GETENT^XPAREDIT(.ORENT,PRM)
"RTN","OREV3",159,0)
 Q:ORENT=""  ;Nothing selected
"RTN","OREV3",160,0)
 D EDIT^XPAREDIT(ORENT,PRM) ;edit selected entity
"RTN","OREV3",161,0)
 Q:$G(DUOUT)!($G(DTOUT))  ;User ^ or timed out
"RTN","OREV3",162,0)
 I '$D(^XTV(8989.5,"AC",+PRM,ORENT)) Q  ;No value stored for entity don't ask for default
"RTN","OREV3",163,0)
 D SETDFLT(ORENT,PRM)
"RTN","OREV3",164,0)
 Q
"RTN","OREV3",165,0)
 ;
"RTN","OREV3",166,0)
SETDFLT(ORENT,PRM) ;Set default for given list
"RTN","OREV3",167,0)
 N DIC,Y,X,PRMD,DEF,I,J,DIR,FND,ORLST
"RTN","OREV3",168,0)
 I $G(PRM)="" S DIC=8989.51,DIC(0)="MX",X="OREVNT COMMON LIST" D ^DIC Q:Y=-1  S PRM=Y
"RTN","OREV3",169,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT DEFAULT" D ^DIC
"RTN","OREV3",170,0)
 Q:Y=-1  ;Parameter doesn't exist
"RTN","OREV3",171,0)
 S PRMD=Y
"RTN","OREV3",172,0)
 I $G(ORENT)="" D GETENT^XPAREDIT(.ORENT,PRMD) Q:ORENT=""  ;Nothing selected
"RTN","OREV3",173,0)
 D GETLST^XPAR(.ORLST,ORENT,+PRM)
"RTN","OREV3",174,0)
 I ORLST=0 W !!,"No common list is defined for this entity and therefore a default",!,"may not be set.  Create a common list first.",! Q
"RTN","OREV3",175,0)
 S DEF=$$GET^XPAR(ORENT,+PRMD,,"B") F I=1:1:ORLST I $P(ORLST(I),U,2)=+DEF S FND=1
"RTN","OREV3",176,0)
 I '$G(FND) S DEF="" D EN^XPAR(ORENT,+PRMD,,"@") ;Delete default if no longer in list
"RTN","OREV3",177,0)
 W !!,$S(DEF'="":"Current DEFAULT is "_$P(DEF,U,2)_$S($G(^ORD(100.5,+DEF,1)):" (*INACTIVE*)",1:""),1:"No DEFAULT has been set yet.")
"RTN","OREV3",178,0)
 W ! F J=1:1:ORLST W !,J,") ",$P(^ORD(100.5,$P(ORLST(J),U,2),0),U),$S($G(^(1)):" (*INACTIVE*)",1:"")
"RTN","OREV3",179,0)
 I DEF'="" S ORLST=ORLST+1 W !!,ORLST,") DELETE CURRENT DEFAULT"
"RTN","OREV3",180,0)
 W ! S DIR(0)="NO^1:"_ORLST,DIR("A")="Select default release event"_$S(DEF'="":" or delete current event",1:"") D ^DIR
"RTN","OREV3",181,0)
 I 'Y Q  ;No selection made
"RTN","OREV3",182,0)
 I Y=ORLST&(DEF'="") D EN^XPAR(ORENT,+PRMD,,"@") W !,"Default deleted" Q
"RTN","OREV3",183,0)
 I $G(^ORD(100.5,$P(ORLST(Y),U,2),1)) W !,"You cannot set an inactive event as the default." Q  ;No inactive defaults can be set
"RTN","OREV3",184,0)
 ;write updated parameter
"RTN","OREV3",185,0)
 D EN^XPAR(ORENT,+PRMD,,"`"_$P(ORLST(Y),"^",2))
"RTN","OREV3",186,0)
 Q
"RTN","OREV3",187,0)
 ;
"RTN","OREV3",188,0)
GETLST(LST) ;Return common list and default event
"RTN","OREV3",189,0)
 N I,FND,PRM,X,Y,DIC,TLST,ORCLST,ENT,EXP,STR
"RTN","OREV3",190,0)
 S DIC=8989.51,DIC(0)="MX",X="OREVNT COMMON LIST" D ^DIC
"RTN","OREV3",191,0)
 I Y=-1 Q  ;Parameter not found so quit
"RTN","OREV3",192,0)
 S PRM=+Y
"RTN","OREV3",193,0)
 D ENVAL^XPAR(.ORCLST,PRM) Q:ORCLST=0  ;Nothing defined at any level
"RTN","OREV3",194,0)
 ;Check USER level
"RTN","OREV3",195,0)
 S ENT=DUZ_";VA(200," I $D(ORCLST(ENT)) D RETLST Q
"RTN","OREV3",196,0)
 ;Check USER CLASS
"RTN","OREV3",197,0)
 D WHATIS^USRLM(DUZ,"TLST")
"RTN","OREV3",198,0)
 I $O(TLST(0))'="" D  I FND Q
"RTN","OREV3",199,0)
 .S FND=0
"RTN","OREV3",200,0)
 .S I=0 F  S I=$O(TLST(I)) Q:I=""!(FND)  S ENT=$P(TLST(I),U)_";USR(8930," S EXP=+$P(TLST(I),U,5),STR=+$P(TLST(I),U,4) I 'EXP!(EXP'<DT) I 'STR!(STR'>DT) I $D(ORCLST(ENT)) D RETLST S FND=1
"RTN","OREV3",201,0)
 ;Check OE/RR Teams
"RTN","OREV3",202,0)
 K TLST
"RTN","OREV3",203,0)
 D TEAMPR^ORQPTQ1(.TLST,DUZ)
"RTN","OREV3",204,0)
 I +$G(TLST(1)) D  I FND Q
"RTN","OREV3",205,0)
 .S FND=0
"RTN","OREV3",206,0)
 .S I=0 F  S I=$O(TLST(I)) Q:I=""!(FND)  S ENT=$P(TLST(I),U)_"OR(100.21," I $D(ORCLST(ENT)) D RETLST S FND=1
"RTN","OREV3",207,0)
 ;Check location
"RTN","OREV3",208,0)
 I +$G(LOC) S ENT=+LOC_";SC(" I $D(ORCLST(ENT)) D RETLST Q
"RTN","OREV3",209,0)
 ;Check Service
"RTN","OREV3",210,0)
 S ENT=$$GET1^DIQ(200,DUZ,29,"I")_";DIC(49,"
"RTN","OREV3",211,0)
 I $D(ORCLST(ENT)) D RETLST Q
"RTN","OREV3",212,0)
 ;Check Division 
"RTN","OREV3",213,0)
 S ENT=DUZ(2)_";DIC(4," I $D(ORCLST(ENT)) D RETLST Q
"RTN","OREV3",214,0)
 Q
"RTN","OREV3",215,0)
 ;
"RTN","OREV3",216,0)
RETLST ;Sets up list for entity
"RTN","OREV3",217,0)
 N DEF,Y,DIC,I,CNT,X
"RTN","OREV3",218,0)
 S DIC=8989.51,DIC(0)="MQ",X="OREVNT DEFAULT" D ^DIC
"RTN","OREV3",219,0)
 Q:'Y  ;Stop if parameter doesn't exist
"RTN","OREV3",220,0)
 S CNT=1
"RTN","OREV3",221,0)
 S DEF=$$GET^XPAR(ENT,+Y,,"B")
"RTN","OREV3",222,0)
 S I=0 F  S I=$O(ORCLST(ENT,I)) Q:'+I  I '$G(^ORD(100.5,ORCLST(ENT,I),1))&('$D(^ORD(100.5,"DAD",ORCLST(ENT,I)))) S LST(CNT)=ORCLST(ENT,I) S:ORCLST(ENT,I)=+DEF $P(LST(CNT),U,2)=1 S CNT=CNT+1
"RTN","OREV3",223,0)
 Q
"RTN","OREVNTX1")
0^12^B75930903
"RTN","OREVNTX1",1,0)
OREVNTX1 ; SLC/JLI - Event delayed orders RPC's ;1/24/03  13:49
"RTN","OREVNTX1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165**;Dec 17, 1997
"RTN","OREVNTX1",3,0)
 ;
"RTN","OREVNTX1",4,0)
PUTEVNT(ORY,DFN,EVT,ORIFN) ; Save new patient delayed events to file 100.2
"RTN","OREVNTX1",5,0)
 ;DFN:   PATIENT DFN
"RTN","OREVNTX1",6,0)
 ;EVT:   POINTER TO 100.5
"RTN","OREVNTX1",7,0)
 ;ORIFN: ORDER'S IFN
"RTN","OREVNTX1",8,0)
 S ORY=$$NEW^OREVNT(DFN,EVT,ORIFN)
"RTN","OREVNTX1",9,0)
 Q
"RTN","OREVNTX1",10,0)
 ;
"RTN","OREVNTX1",11,0)
GTEVT(ORY,PTEVT) ; Return Event infomation based on PTEVT ptr #100.2
"RTN","OREVNTX1",12,0)
 ;EVTID     ptr #100.5
"RTN","OREVNTX1",13,0)
 ;EVTTYPE   "A;T;D"
"RTN","OREVNTX1",14,0)
 ;EVTNAME   #100.5
"RTN","OREVNTX1",15,0)
 Q:'+PTEVT
"RTN","OREVNTX1",16,0)
 N EVTID,EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",17,0)
 S (EVTTYPE,EVTNAME,EVTDISP,PRTEVT)=""
"RTN","OREVNTX1",18,0)
 S EVTDLG=0
"RTN","OREVNTX1",19,0)
 I '$P(^ORE(100.2,+$G(PTEVT),0),U,2) Q
"RTN","OREVNTX1",20,0)
 S EVTID=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",21,0)
 S PRTEVT=$P(^ORD(100.5,EVTID,0),U,12)
"RTN","OREVNTX1",22,0)
 I PRTEVT S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",23,0)
 E  S EVTTYPE=$P(^ORD(100.5,EVTID,0),U,2)
"RTN","OREVNTX1",24,0)
 I $D(^ORD(100.5,EVTID,0)) D
"RTN","OREVNTX1",25,0)
 . S EVTNAME=$P(^ORD(100.5,EVTID,0),U,1)
"RTN","OREVNTX1",26,0)
 . S EVTDISP=$P(^ORD(100.5,EVTID,0),U,8)
"RTN","OREVNTX1",27,0)
 . S EVTDLG=$P(^ORD(100.5,EVTID,0),U,4)
"RTN","OREVNTX1",28,0)
 S ORY=EVTTYPE_U_EVTID_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",29,0)
 Q
"RTN","OREVNTX1",30,0)
GTEVT1(ORY,EVT) ; Return Event information based on EVT ptr #100.5
"RTN","OREVNTX1",31,0)
 ;EVT    ptr #100.5
"RTN","OREVNTX1",32,0)
 Q:'+EVT
"RTN","OREVNTX1",33,0)
 N EVTTYPE,EVTNAME,EVTDISP,EVTDLG,PRTEVT
"RTN","OREVNTX1",34,0)
 S (EVTDLG,PRTEVT)=0
"RTN","OREVNTX1",35,0)
 S PRTEVT=$P(^ORD(100.5,+EVT,0),U,12)
"RTN","OREVNTX1",36,0)
 I PRTEVT>0 S EVTTYPE=$P(^ORD(100.5,PRTEVT,0),U,2)
"RTN","OREVNTX1",37,0)
 E  S EVTTYPE=$P(^ORD(100.5,+EVT,0),U,2)
"RTN","OREVNTX1",38,0)
 S EVTNAME=$P($G(^ORD(100.5,+EVT,0)),U,1)
"RTN","OREVNTX1",39,0)
 S EVTDISP=$P($G(^ORD(100.5,+EVT,0)),U,8)
"RTN","OREVNTX1",40,0)
 S EVTDLG=$P($G(^ORD(100.5,+EVT,0)),U,4)
"RTN","OREVNTX1",41,0)
 S ORY=EVTTYPE_U_EVT_U_EVTNAME_U_EVTDISP_U_EVTDLG
"RTN","OREVNTX1",42,0)
 Q
"RTN","OREVNTX1",43,0)
 ;
"RTN","OREVNTX1",44,0)
EVT(ORY,PTEVT) ; Return Event ptr #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",45,0)
 Q:'+PTEVT
"RTN","OREVNTX1",46,0)
 S ORY=$$EVT^OREVNTX(PTEVT)
"RTN","OREVNTX1",47,0)
 Q
"RTN","OREVNTX1",48,0)
 ; 
"RTN","OREVNTX1",49,0)
EXISTS(ORY,DFN,EVT) ;Returns PtEvtID ptr #100.2 if patient already has delayed orders
"RTN","OREVNTX1",50,0)
 ;                for event EVT, else 0
"RTN","OREVNTX1",51,0)
 ;DFN: Patient DFN
"RTN","OREVNTX1",52,0)
 ;EVT: Ptr to #100.5
"RTN","OREVNTX1",53,0)
 I '+EVT S ORY=0 Q
"RTN","OREVNTX1",54,0)
 N PTEVT S (PTEVT,ORY)=0
"RTN","OREVNTX1",55,0)
 S PTEVT=$O(^ORE(100.2,"AE",+DFN,+EVT,PTEVT))
"RTN","OREVNTX1",56,0)
 I PTEVT>0 S ORY=PTEVT
"RTN","OREVNTX1",57,0)
 Q
"RTN","OREVNTX1",58,0)
 ;
"RTN","OREVNTX1",59,0)
TYPEXT(ORY,DFN,EVT) ; does EVT has delayed orders?
"RTN","OREVNTX1",60,0)
 ; 1 if Patient DFN has delayed orders for EVT
"RTN","OREVNTX1",61,0)
 ; 2 if Parent/Sibling event has delayed orders
"RTN","OREVNTX1",62,0)
 ; 0 if No delayed orders for EVT
"RTN","OREVNTX1",63,0)
 Q:'+EVT
"RTN","OREVNTX1",64,0)
 S ORY=$$EXISTS^OREVNTX(DFN,EVT)
"RTN","OREVNTX1",65,0)
 Q
"RTN","OREVNTX1",66,0)
 ;
"RTN","OREVNTX1",67,0)
MATCH(ORY,DFN,EVT) ;If Pt's current data match selected event
"RTN","OREVNTX1",68,0)
 ;DFN: patient DFN
"RTN","OREVNTX1",69,0)
 ;EVT: ptr to #100.5
"RTN","OREVNTX1",70,0)
 S ORY=0
"RTN","OREVNTX1",71,0)
 Q:('+DFN)!('+EVT)
"RTN","OREVNTX1",72,0)
 S ORY=$$MATCH^OREVNT(DFN,EVT)
"RTN","OREVNTX1",73,0)
 N TS,TSNM
"RTN","OREVNTX1",74,0)
 S TS=$S($G(ORTS):+ORTS,1:+$G(^DPT(DFN,.103)))
"RTN","OREVNTX1",75,0)
 S TSNM=$P($G(^DIC(45.7,TS,0)),U)
"RTN","OREVNTX1",76,0)
 S:ORY ORY=ORY_U_TSNM
"RTN","OREVNTX1",77,0)
 Q
"RTN","OREVNTX1",78,0)
 ;
"RTN","OREVNTX1",79,0)
NAME(ORY,PTEVT) ; Return Event name from #100.5, given PTEVT ptr #100.2
"RTN","OREVNTX1",80,0)
 I PTEVT'>0 S ORY="" Q
"RTN","OREVNTX1",81,0)
 S ORY=$$NAME^OREVNTX(PTEVT)
"RTN","OREVNTX1",82,0)
 Q
"RTN","OREVNTX1",83,0)
 ;
"RTN","OREVNTX1",84,0)
DIV(ORY,PTEVT) ; Return division for PTEVT ptr #100.2
"RTN","OREVNTX1",85,0)
 Q:'+PTEVT
"RTN","OREVNTX1",86,0)
 S ORY=$$DIV^OREVNTX(PTEVT)
"RTN","OREVNTX1",87,0)
 Q
"RTN","OREVNTX1",88,0)
 ;
"RTN","OREVNTX1",89,0)
DIV1(ORY,EVT) ; Return division for EVT ptr #100.5
"RTN","OREVNTX1",90,0)
 Q:'+EVT
"RTN","OREVNTX1",91,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,3) S:ORY<1 ORY=+$G(DUZ(2))
"RTN","OREVNTX1",92,0)
 Q
"RTN","OREVNTX1",93,0)
 ;
"RTN","OREVNTX1",94,0)
LOC(ORY,PTEVT) ; Return default hospital location ^SC( for PTEVT ptr #100.2
"RTN","OREVNTX1",95,0)
 Q:'+PTEVT
"RTN","OREVNTX1",96,0)
 S ORY=$$LOC^OREVNTX(PTEVT)
"RTN","OREVNTX1",97,0)
 S ORY=+ORY
"RTN","OREVNTX1",98,0)
 Q
"RTN","OREVNTX1",99,0)
 ;
"RTN","OREVNTX1",100,0)
LOC1(ORY,EVT) ; Return default hospital location ^SC( for EVT ptr #100.5
"RTN","OREVNTX1",101,0)
 Q:'+EVT
"RTN","OREVNTX1",102,0)
 S ORY=+$P($G(^ORD(100.5,+EVT,0)),U,9) S:ORY<1 ORY=+$G(ORL)
"RTN","OREVNTX1",103,0)
 Q
"RTN","OREVNTX1",104,0)
 ;
"RTN","OREVNTX1",105,0)
CHGEVT(ORY,NEWEVT,ORIDS) ; Change order's event
"RTN","OREVNTX1",106,0)
 N ORI
"RTN","OREVNTX1",107,0)
 S ORI=0
"RTN","OREVNTX1",108,0)
 F  S ORI=$O(ORIDS(ORI)) Q:'+ORI  D
"RTN","OREVNTX1",109,0)
 . D CHGEVT^OREVNTX(+$G(ORIDS(ORI)),NEWEVT)
"RTN","OREVNTX1",110,0)
 Q
"RTN","OREVNTX1",111,0)
 ;
"RTN","OREVNTX1",112,0)
EMPTY(ORY,PTEVT) ; Return 1 if PTEVT doesn't have any orders
"RTN","OREVNTX1",113,0)
 Q:'+PTEVT
"RTN","OREVNTX1",114,0)
 S ORY=$$EMPTY^OREVNTX(PTEVT)
"RTN","OREVNTX1",115,0)
 Q
"RTN","OREVNTX1",116,0)
 ;
"RTN","OREVNTX1",117,0)
DELPTEVT(ORY,PTEVT) ; Delete Patient Event in #100.2
"RTN","OREVNTX1",118,0)
 Q:'+PTEVT
"RTN","OREVNTX1",119,0)
 D CANCEL^OREVNTX(PTEVT)
"RTN","OREVNTX1",120,0)
 ;D DONE^OREVNTX(PTEVT),ACTLOG^OREVNTX(PTEVT,"CA")
"RTN","OREVNTX1",121,0)
 ;N ORD S ORD=+$P($G(^ORE(100.2,PTEVT,0)),U,4)
"RTN","OREVNTX1",122,0)
 ;D:'$$DCD^ORCACT2(ORD) CLRDLY^ORCACT2(ORD) ;cancel event order
"RTN","OREVNTX1",123,0)
 Q
"RTN","OREVNTX1",124,0)
 ;
"RTN","OREVNTX1",125,0)
UPDTOR(ORY,PTIFN,ORIFN,PTEVT) ; If delayed order was DCed, then update the EVENT and "AEVNT"
"RTN","OREVNTX1",126,0)
 ;                                       cross reference fields to empty
"RTN","OREVNTX1",127,0)
 Q  ;Don't ever need to do this!
"RTN","OREVNTX1",128,0)
CURSPE(ORY,PTIFN) ; Return current treating specialty
"RTN","OREVNTX1",129,0)
 Q:'PTIFN
"RTN","OREVNTX1",130,0)
 N SPCID
"RTN","OREVNTX1",131,0)
 I $D(^DPT(PTIFN,.103)) D
"RTN","OREVNTX1",132,0)
 . S SPCID=$G(^DPT(PTIFN,.103))
"RTN","OREVNTX1",133,0)
 . S:SPCID ORY=$P($G(^DIC(45.7,SPCID,0)),U)_U_SPCID
"RTN","OREVNTX1",134,0)
 Q
"RTN","OREVNTX1",135,0)
DFLTEVT(ORY,PVIFN) ; Return default release event based on provider IFN
"RTN","OREVNTX1",136,0)
 N CMEVTLST,IDX
"RTN","OREVNTX1",137,0)
 S CMEVTLST="",IDX=0
"RTN","OREVNTX1",138,0)
 D GETLST^OREV3(.CMEVTLST)
"RTN","OREVNTX1",139,0)
 F  S IDX=$O(CMEVTLST(IDX)) Q:'IDX  D
"RTN","OREVNTX1",140,0)
 . I $P($G(CMEVTLST(IDX)),U,2) S ORY=$P($G(CMEVTLST(IDX)),U) Q
"RTN","OREVNTX1",141,0)
 Q
"RTN","OREVNTX1",142,0)
CMEVTS(ORY,PVIFN) ;Return common event list
"RTN","OREVNTX1",143,0)
 N IDX,X0,X
"RTN","OREVNTX1",144,0)
 S IDX=0
"RTN","OREVNTX1",145,0)
 S ORY=""
"RTN","OREVNTX1",146,0)
 D GETLST^OREV3(.ORY)
"RTN","OREVNTX1",147,0)
 F  S IDX=$O(ORY(IDX)) Q:'IDX  D
"RTN","OREVNTX1",148,0)
 . S X0=""
"RTN","OREVNTX1",149,0)
 . S:$L($G(^ORD(100.5,+ORY(IDX),0))) X0=$G(^(0))
"RTN","OREVNTX1",150,0)
 . I '$L($P(X0,U,2)) D
"RTN","OREVNTX1",151,0)
 .. S X=$P(X0,U,12) S:X $P(X0,U,2)=$P($G(^ORD(100.5,+X,0)),U,2)
"RTN","OREVNTX1",152,0)
 . S:$L(X0) ORY(IDX)=+ORY(IDX)_U_X0
"RTN","OREVNTX1",153,0)
 Q
"RTN","OREVNTX1",154,0)
 ;
"RTN","OREVNTX1",155,0)
DELDFLT(ORY,PVIFN) ; Delete default release event
"RTN","OREVNTX1",156,0)
 Q:'PVIFN
"RTN","OREVNTX1",157,0)
 N ORERR
"RTN","OREVNTX1",158,0)
 S ORERR=""
"RTN","OREVNTX1",159,0)
 D DEL^XPAR(PVIFN_";VA(200,","OREVNT DEFAULT",1,.ORERR)
"RTN","OREVNTX1",160,0)
 Q
"RTN","OREVNTX1",161,0)
WRLSTED(LST,LOC,EVTID) ; Return list of dialogs for writing event delayed orders
"RTN","OREVNTX1",162,0)
 ; .Y(n): DlgName^ListBox Text
"RTN","OREVNTX1",163,0)
WRLST1 N ANENT
"RTN","OREVNTX1",164,0)
 S LOC=+$G(LOC)_";SC(" I 'LOC S LOC=""
"RTN","OREVNTX1",165,0)
 S ANENT="ALL^USR.`"_DUZ_"^"_LOC_$S($G(^VA(200,DUZ,5)):"^SRV.`"_+$G(^(5)),1:"")
"RTN","OREVNTX1",166,0)
 N MNU,SEQ,IEN,ITM,TXT,FID,DGRP,X,TYP
"RTN","OREVNTX1",167,0)
 S MNU=$$GET^XPAR(ANENT,"ORWDX WRITE ORDERS EVENT LIST",EVTID,"I") Q:'MNU
"RTN","OREVNTX1",168,0)
 S SEQ=0 F  S SEQ=$O(^ORD(101.41,MNU,10,"B",SEQ)) Q:'SEQ  D
"RTN","OREVNTX1",169,0)
 . S IEN=0 F  S IEN=$O(^ORD(101.41,MNU,10,"B",SEQ,IEN)) Q:'IEN  D
"RTN","OREVNTX1",170,0)
 . . S X=$G(^ORD(101.41,MNU,10,IEN,0)),ITM=+$P(X,U,2),TXT=$P(X,U,4)
"RTN","OREVNTX1",171,0)
 . . S X=$G(^ORD(101.41,ITM,5)),FID=+$P(X,U,5)
"RTN","OREVNTX1",172,0)
 . . S X=$G(^ORD(101.41,ITM,0)),TYP=$P(X,U,4),DGRP=+$P(X,U,5)
"RTN","OREVNTX1",173,0)
 . . S:'$L(TXT) TXT=$P(X,U,2)
"RTN","OREVNTX1",174,0)
 . . I TYP="M" S:'FID FID=1001
"RTN","OREVNTX1",175,0)
 . . S LST(SEQ)=ITM_";"_FID_";"_DGRP_";"_TYP_U_TXT
"RTN","OREVNTX1",176,0)
 Q
"RTN","OREVNTX1",177,0)
 ;
"RTN","OREVNTX1",178,0)
GETDLG(LST,DLGID) ; Return dialog infomation based on the DLGID
"RTN","OREVNTX1",179,0)
 N DIEN,DFID,DTXT,DTYP,DGRP,X0,X5
"RTN","OREVNTX1",180,0)
 S DLGID=+DLGID
"RTN","OREVNTX1",181,0)
 Q:'DLGID
"RTN","OREVNTX1",182,0)
 S X0=^ORD(101.41,DLGID,0),X5=$G(^(5))
"RTN","OREVNTX1",183,0)
 S DGRP=+$P(X0,U,5),DFID=+$P(X5,U,5),DTXT=$P(X5,U,4),DTYP=$P(X0,U,4)
"RTN","OREVNTX1",184,0)
    S:'$L(DTXT) DTXT=$P(X0,U,2)
"RTN","OREVNTX1",185,0)
 I $P(X0,U,4)="M" S:'DFID DFID=1001
"RTN","OREVNTX1",186,0)
 S LST=DLGID_";"_DFID_";"_DGRP_";"_DTYP_U_DTXT
"RTN","OREVNTX1",187,0)
 Q
"RTN","OREVNTX1",188,0)
DONE(LST,PTEVT) ; Terminate PTEvt
"RTN","OREVNTX1",189,0)
 Q:'PTEVT
"RTN","OREVNTX1",190,0)
 D DONE^OREVNTX(PTEVT)
"RTN","OREVNTX1",191,0)
 D ACTLOG^OREVNTX(PTEVT,"MN")
"RTN","OREVNTX1",192,0)
 Q
"RTN","OREVNTX1",193,0)
SETDFLT(ORY,EVT) ;Set personal default event
"RTN","OREVNTX1",194,0)
 N ERR,VAL S ERR=""
"RTN","OREVNTX1",195,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",196,0)
 S VAL=$P(^ORD(100.5,EVT,0),U)
"RTN","OREVNTX1",197,0)
 W !,"DUZ="_DUZ_" VAL="_VAL
"RTN","OREVNTX1",198,0)
 D EN^XPAR(DUZ_";VA(200,","OREVNT DEFAULT",1,VAL,ERR)
"RTN","OREVNTX1",199,0)
 S ORY=ERR
"RTN","OREVNTX1",200,0)
 Q
"RTN","OREVNTX1",201,0)
CPACT(ORY,EVT) ; Return True/False to display active orders for copy
"RTN","OREVNTX1",202,0)
 ; EVT ptr to #100.5
"RTN","OREVNTX1",203,0)
 Q:'EVT
"RTN","OREVNTX1",204,0)
 S ORY=0
"RTN","OREVNTX1",205,0)
 Q:'$D(^ORD(100.5,EVT,0))
"RTN","OREVNTX1",206,0)
 S ORY=$P(^ORD(100.5,EVT,0),U,11)
"RTN","OREVNTX1",207,0)
 S:$P($G(^(0)),U,2)="D" ORY=0
"RTN","OREVNTX1",208,0)
 Q
"RTN","OREVNTX1",209,0)
PRMPTID(ORY,PRTNM) ;Return event prompt IEN for OR GTX EVENT
"RTN","OREVNTX1",210,0)
 S:$D(^ORD(101.41,"B","OR GTX EVENT")) ORY=$O(^("OR GTX EVENT",0))
"RTN","OREVNTX1",211,0)
 Q
"RTN","OREVNTX1",212,0)
ISDCOD(ORY,ORIFN) ;True: the order need to be filtered out
"RTN","OREVNTX1",213,0)
 N PAS,X3,X0,ORGRPLST,THEGRP,IDX,ODGRP
"RTN","OREVNTX1",214,0)
 S (ORY,IDX)=0
"RTN","OREVNTX1",215,0)
 Q:'$D(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",216,0)
 S X0=$G(^OR(100,+ORIFN,0))
"RTN","OREVNTX1",217,0)
 S ODGRP=$P(X0,U,11)
"RTN","OREVNTX1",218,0)
 D GETLST^XPAR(.ORGRPLST,"ALL","OREVNT EXCLUDE DGRP")
"RTN","OREVNTX1",219,0)
 F  S IDX=$O(ORGRPLST(IDX)) Q:'IDX!ORY  D
"RTN","OREVNTX1",220,0)
 . S THEGRP=$P($G(ORGRPLST(IDX)),U,2)
"RTN","OREVNTX1",221,0)
 . I $$GRPCHK(THEGRP,ODGRP) S ORY=1
"RTN","OREVNTX1",222,0)
 I ORY Q
"RTN","OREVNTX1",223,0)
 S PAS=";1;"
"RTN","OREVNTX1",224,0)
 S:$D(^OR(100,+ORIFN,3)) X3=^OR(100,+ORIFN,3)
"RTN","OREVNTX1",225,0)
 S:(PAS'[(";"_$P(X3,U,3)_";")) ORY=0
"RTN","OREVNTX1",226,0)
 Q
"RTN","OREVNTX1",227,0)
DEFLTS(ORY,EVTID) ;Return default specialty for EVTID(#100.5)
"RTN","OREVNTX1",228,0)
 Q:'+EVTID
"RTN","OREVNTX1",229,0)
 N PRTEVT
"RTN","OREVNTX1",230,0)
 S PRTEVT=0
"RTN","OREVNTX1",231,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",232,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",233,0)
 S ORY=$$DEFTS^ORCDADT(EVTID)
"RTN","OREVNTX1",234,0)
 Q
"RTN","OREVNTX1",235,0)
 ;
"RTN","OREVNTX1",236,0)
MULTS(ORY,EVTID) ;Return specialty list for the EVTID(#100.5)
"RTN","OREVNTX1",237,0)
 Q:'+EVTID
"RTN","OREVNTX1",238,0)
 N I,CNT,X,Y S (I,CNT)=0
"RTN","OREVNTX1",239,0)
 N PRTEVT
"RTN","OREVNTX1",240,0)
 S PRTEVT=0
"RTN","OREVNTX1",241,0)
 S PRTEVT=$P(^ORD(100.5,+EVTID,0),U,12)
"RTN","OREVNTX1",242,0)
 I PRTEVT>0 S EVTID=PRTEVT
"RTN","OREVNTX1",243,0)
 F  S I=$O(^ORD(100.5,+$G(EVTID),"TS",I)) Q:I<1  S X=+$G(^(I,0)) D
"RTN","OREVNTX1",244,0)
 . S Y=$$GET1^DIQ(45.7,X_",",.01)
"RTN","OREVNTX1",245,0)
 . S CNT=CNT+1,ORY(CNT)=X_U_Y
"RTN","OREVNTX1",246,0)
 Q
"RTN","OREVNTX1",247,0)
 ;
"RTN","OREVNTX1",248,0)
PRTIDS(ORY,IDS) ;Return some prompt ids from #101.41
"RTN","OREVNTX1",249,0)
 ; treating specialty Id^attending provider id
"RTN","OREVNTX1",250,0)
 N IDX,ORTS,ORATT
"RTN","OREVNTX1",251,0)
 S (ORY,ORTS,ORATT)=""
"RTN","OREVNTX1",252,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX TREATING SPECIALTY",0))
"RTN","OREVNTX1",253,0)
 S:$D(^ORD(101.41,IDX,1)) ORTS=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",254,0)
 S IDX=$O(^ORD(101.41,"B","OR GTX PROVIDER",0))
"RTN","OREVNTX1",255,0)
 S:$D(^ORD(101.41,IDX,1)) ORATT=$P($G(^ORD(101.41,IDX,1)),U,2,3)
"RTN","OREVNTX1",256,0)
 S ORY=ORTS_"~"_ORATT
"RTN","OREVNTX1",257,0)
 Q
"RTN","OREVNTX1",258,0)
 ;
"RTN","OREVNTX1",259,0)
DFLTDLG(ORY,EVTID) ;Return event default dialog IEN
"RTN","OREVNTX1",260,0)
 S ORY=0
"RTN","OREVNTX1",261,0)
 Q:'$D(^ORD(100.5,+EVTID,0))
"RTN","OREVNTX1",262,0)
 S ORY=$P(^ORD(100.5,+EVTID,0),U,4)
"RTN","OREVNTX1",263,0)
 Q
"RTN","OREVNTX1",264,0)
AUTHMREL(ORY,USER) ;1: user can manual release delayed orders 0: can't
"RTN","OREVNTX1",265,0)
 S ORY=$$CANREL^OREV3
"RTN","OREVNTX1",266,0)
 Q
"RTN","OREVNTX1",267,0)
HAVEPRT(ORY,PTEVT) ;return parent patient event from #100.2
"RTN","OREVNTX1",268,0)
 Q:'+PTEVT
"RTN","OREVNTX1",269,0)
 S ORY=""
"RTN","OREVNTX1",270,0)
 S:$L($G(^ORE(100.2,PTEVT,1))) ORY=$P(^(1),U,5)
"RTN","OREVNTX1",271,0)
 Q
"RTN","OREVNTX1",272,0)
GRPCHK(DG,AGRP) ;If an order's group belong to DG group
"RTN","OREVNTX1",273,0)
 N RST
"RTN","OREVNTX1",274,0)
 S RST=0
"RTN","OREVNTX1",275,0)
 N ORGRP
"RTN","OREVNTX1",276,0)
 D GRP^ORQ1(DG)
"RTN","OREVNTX1",277,0)
 S RST=$S($D(ORGRP(AGRP)):1,1:0)
"RTN","OREVNTX1",278,0)
 Q RST
"RTN","OREVNTX1",279,0)
ODPTEVID(ORY,ORID) ;Return PtEvtID based on the ORID
"RTN","OREVNTX1",280,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",281,0)
 S ORY=$P($G(^OR(100,+ORID,0)),U,17)
"RTN","OREVNTX1",282,0)
 Q
"RTN","OREVNTX1",283,0)
COMP(ORY,PTEVT) ;Return 1 or 0 if PTEVT completed or not
"RTN","OREVNTX1",284,0)
 Q:'+PTEVT
"RTN","OREVNTX1",285,0)
 S ORY=$$COMP^OREVNTX(+PTEVT)
"RTN","OREVNTX1",286,0)
 Q
"RTN","OREVNTX1",287,0)
ISHDORD(ORY,ORID) ;Return 1 if it's on-hold med order
"RTN","OREVNTX1",288,0)
 Q:'+ORID
"RTN","OREVNTX1",289,0)
 Q:'$D(^OR(100,+ORID,0))
"RTN","OREVNTX1",290,0)
 N STS,HDSTS,ODGP,INPT,OUPT,MEDS,IVMD
"RTN","OREVNTX1",291,0)
 S HDSTS=$O(^ORD(100.01,"B","HOLD",0))
"RTN","OREVNTX1",292,0)
 S STS=$P($G(^OR(100,+ORID,3)),U,3)
"RTN","OREVNTX1",293,0)
 S INPT=$O(^ORD(100.98,"B","UD RX",0))
"RTN","OREVNTX1",294,0)
 S OUPT=$O(^ORD(100.98,"B","O RX",0))
"RTN","OREVNTX1",295,0)
 S MEDS=$O(^ORD(100.98,"B","RX",0))
"RTN","OREVNTX1",296,0)
 S IVMD=$O(^ORD(100.98,"B","IV RX",0))
"RTN","OREVNTX1",297,0)
 S ODGP=$P(^OR(100,+ORID,0),U,11)
"RTN","OREVNTX1",298,0)
 I (U_INPT_U_OUPT_U_MEDS_U_IVMD_U[U_ODGP_U),(HDSTS=STS) S ORY=1
"RTN","OREVNTX1",299,0)
 Q
"RTN","OREVNTX1",300,0)
ISPASS(ORY,PTEVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",301,0)
 S ORY=$$EVT^OREVNTX(PTEVTID)
"RTN","OREVNTX1",302,0)
 S ORY=$P($G(^ORD(100.5,+ORY,0)),U,7)
"RTN","OREVNTX1",303,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",304,0)
 E  S ORY=0
"RTN","OREVNTX1",305,0)
 Q
"RTN","OREVNTX1",306,0)
ISPASS1(ORY,EVTID,EVTTYPE) ;Return 1 if it's a pass event
"RTN","OREVNTX1",307,0)
 S ORY=$P($G(^ORD(100.5,+EVTID,0)),U,7)
"RTN","OREVNTX1",308,0)
 I EVTTYPE="T",ORY,ORY<4 S ORY=1
"RTN","OREVNTX1",309,0)
 E  S ORY=0
"RTN","OREVNTX1",310,0)
 Q
"RTN","OREVNTX1",311,0)
DLGIEN(ORY,DLGNAME) ;Retrun Order Dialog IEN based on name
"RTN","OREVNTX1",312,0)
 Q:'$D(^ORD(101.41,"B",DLGNAME))
"RTN","OREVNTX1",313,0)
 S ORY=$O(^ORD(101.41,"B",DLGNAME,0))
"RTN","OREVNTX1",314,0)
 Q
"RTN","ORMEVNT")
0^6^B67587064
"RTN","ORMEVNT",1,0)
ORMEVNT ;SLC/MKB-Trigger HL7 msg off MAS events ; 22 Aug 2002 11:44 AM
"RTN","ORMEVNT",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**24,45,70,79,141,165**;Dec 17, 1997
"RTN","ORMEVNT",3,0)
 ;
"RTN","ORMEVNT",4,0)
EN1 ; -- tasked entry point
"RTN","ORMEVNT",5,0)
 Q:'$G(DFN)  Q:$D(DGPMPC)  Q:DGPMT=4!(DGPMT=5)  ;skip lodger mvts
"RTN","ORMEVNT",6,0)
 N ZTDESC,ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTSK,I
"RTN","ORMEVNT",7,0)
 S ZTDESC="Auto-DC and/or Release orders on MAS movement",ZTIO=""
"RTN","ORMEVNT",8,0)
 S ZTRTN="EN^ORMEVNT",ZTDTH=$H,ZTSAVE("^UTILITY(""DGPM"",$J,")=""
"RTN","ORMEVNT",9,0)
 F I="DFN","DGPMDA","DGPMA","DGPMP","DGPMT" S ZTSAVE(I)=""
"RTN","ORMEVNT",10,0)
 D ^%ZTLOAD ;D EN^ORYDGPM
"RTN","ORMEVNT",11,0)
 Q
"RTN","ORMEVNT",12,0)
 ;
"RTN","ORMEVNT",13,0)
EN ; -- main entry point
"RTN","ORMEVNT",14,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","ORMEVNT",15,0)
 Q:'$G(DFN)  Q:$D(DGPMPC)  Q:DGPMT=4!(DGPMT=5)
"RTN","ORMEVNT",16,0)
 N XQORQUIT,XQORPOP,DTOUT,DUOUT,DIRUT,DIROUT ;protect protocol context
"RTN","ORMEVNT",17,0)
 N VAIP,DONE,ORVP,ORWARD,ORTS,ORL,ORDIV,ORLAST,X,Y,I,ORCURRNT,OREVENT,ORDCRULE,ORACT,ORPRINT
"RTN","ORMEVNT",18,0)
 S VAIP("E")=DGPMDA D IN5^VADPT M ORVP=VAIP I '$G(DGPMA) D  Q  ;deleted
"RTN","ORMEVNT",19,0)
 . N LAST,OREVT S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",20,0)
 . S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0))
"RTN","ORMEVNT",21,0)
 . D ACTLOG^OREVNTX(OREVT,"DL")
"RTN","ORMEVNT",22,0)
A ;
"RTN","ORMEVNT",23,0)
 S ORVP=+DFN_";DPT(",ORTS=+$G(^DPT(DFN,.103)),ORWARD=$G(^(.1))
"RTN","ORMEVNT",24,0)
 S ORWARD=$S($L(ORWARD):+$O(^DIC(42,"B",ORWARD,0)),1:0)
"RTN","ORMEVNT",25,0)
 S ORL=$S(ORWARD:+$G(^DIC(42,ORWARD,44))_";SC(",1:""),ORDIV=$$DIV(+ORL)
"RTN","ORMEVNT",26,0)
 S ORLAST("TS")=$$PREVTS,X=+VAIP(15,4) F I="WD","LOC","DIV" S ORLAST(I)=""
"RTN","ORMEVNT",27,0)
 S:X ORLAST("WD")=X,Y=+$G(^DIC(42,X,44)),ORLAST("LOC")=Y_";SC(",ORLAST("DIV")=$$DIV(Y)
"RTN","ORMEVNT",28,0)
 S ORCURRNT=$$CURRENT,OREVENT=$$PATEVT,ORACT=$S($G(DGPMP):"ED",1:"NW")
"RTN","ORMEVNT",29,0)
 I $G(DGPMP),$D(^ORE(100.2,"ADT",DGPMDA)) D  Q:$G(DONE)  ;edited
"RTN","ORMEVNT",30,0)
 . N LAST,OREVT,DA,X,I S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1) Q:LAST<1
"RTN","ORMEVNT",31,0)
 . S OREVT=+$O(^ORE(100.2,"ADT",DGPMDA,LAST,0)),DA=+$O(^(OREVT,0))
"RTN","ORMEVNT",32,0)
 . S X=$G(^ORE(100.2,OREVT,10,DA,0)) ;last activity on movement
"RTN","ORMEVNT",33,0)
 . I $P(X,U,5)=+$G(VAIP(4)),$P(X,U,6)=+$G(VAIP(8)),$P(X,U,7)=+$G(VAIP(5)) S DONE=1 Q  ;no change
"RTN","ORMEVNT",34,0)
 . I 'OREVENT D ACTLOG^OREVNTX(OREVT,"ED",$$TYPE(DGPMT),1) S DONE=1
"RTN","ORMEVNT",35,0)
B ;
"RTN","ORMEVNT",36,0)
 I '$G(DGPMP),ORCURRNT D  ;new mvt - autoDC
"RTN","ORMEVNT",37,0)
 . I $D(^ORE(100.2,"ADT",DGPMDA)) D  Q:$G(DONE)  ;ReEntered
"RTN","ORMEVNT",38,0)
 .. N LAST,OREVT S DONE=0
"RTN","ORMEVNT",39,0)
 .. S LAST=+$O(^ORE(100.2,"ADT",DGPMDA,""),-1),OREVT=+$O(^(LAST,0))
"RTN","ORMEVNT",40,0)
 .. Q:+ORVP'=+$G(^ORE(100.2,OREVT,0))  ;diff pat -> diff mvt
"RTN","ORMEVNT",41,0)
 .. S ORACT="RE",DONE=1 Q:OREVENT  ;log on new event instead
"RTN","ORMEVNT",42,0)
 .. D ACTLOG^OREVNTX(OREVT,ORACT,$$TYPE(DGPMT),1)
"RTN","ORMEVNT",43,0)
 . I DGPMT=3 D COMP("ALG") ;keep until GMRA*4*15 gets out
"RTN","ORMEVNT",44,0)
 . S ORDCRULE=$$DCEVT D:ORDCRULE AUTODC^ORMEVNT1(ORDCRULE,$P(DGPMA,U))
"RTN","ORMEVNT",45,0)
 . I DGPMT=1,$G(^XTMP("ORDCOBS-"_+ORVP,0)) D REINST
"RTN","ORMEVNT",46,0)
C ;
"RTN","ORMEVNT",47,0)
 I OREVENT D  ;release delayed orders, complete event
"RTN","ORMEVNT",48,0)
 . D RELEASE^ORMEVNT1(OREVENT),DONE^OREVNTX(OREVENT,$P(DGPMA,U),DGPMDA)
"RTN","ORMEVNT",49,0)
 . I '$G(VAIP(1)) M VAIP=ORVP ;reset for ACTLOG use
"RTN","ORMEVNT",50,0)
 . D ACTLOG^OREVNTX(OREVENT,ORACT,$$TYPE(DGPMT),1)
"RTN","ORMEVNT",51,0)
 . I DGPMT=1,'$P($G(^ORE(100.2,+OREVENT,0)),U,3) S $P(^(0),U,3)=DGPMDA
"RTN","ORMEVNT",52,0)
 I $O(ORPRINT(0)),$G(ORL) D PRINTS^ORWD1(.ORPRINT,+ORL)
"RTN","ORMEVNT",53,0)
 I DGPMT=3,ORCURRNT,'$G(DGPMP) D DISCH ;lapse remaining events
"RTN","ORMEVNT",54,0)
 I '$G(DFN),$G(ORVP) S DFN=+ORVP ;just in case
"RTN","ORMEVNT",55,0)
 Q
"RTN","ORMEVNT",56,0)
 ;
"RTN","ORMEVNT",57,0)
CURRENT() ; -- Returns 1 or 0, if DGPMDA is the latest movement
"RTN","ORMEVNT",58,0)
 N Y,LAST,LASTYPE,LASTDT S Y=0
"RTN","ORMEVNT",59,0)
 S LAST=+VAIP(14),LASTDT=+VAIP(14,1),LASTYPE=+VAIP(14,2)
"RTN","ORMEVNT",60,0)
 ; VAIP(14) = last physical movement for the admission
"RTN","ORMEVNT",61,0)
 I DGPMT=6 D  G CQ
"RTN","ORMEVNT",62,0)
 . N CA,IDT I LAST,LASTDT>+VAIP(3) Q  ;last physical mvt
"RTN","ORMEVNT",63,0)
 . S CA=+VAIP(13),IDT=9999999.9999999-VAIP(3)
"RTN","ORMEVNT",64,0)
 . I '$O(^DGPM("ATS",DFN,CA,IDT),-1) S Y=1 Q  ;last TS mvt
"RTN","ORMEVNT",65,0)
 I DGPMT=3 D  ;get last mvt overall
"RTN","ORMEVNT",66,0)
 . N VAIP,Y S VAIP("D")="LAST" D IN5^VADPT
"RTN","ORMEVNT",67,0)
 . S LAST=+VAIP(14),LASTYPE=+VAIP(14,2) ;reset
"RTN","ORMEVNT",68,0)
 I LAST=DGPMDA S Y=1 G CQ ;primary mvt
"RTN","ORMEVNT",69,0)
 I $D(^UTILITY("DGPM",$J,LASTYPE,LAST)) S Y=1 ;secondary mvt
"RTN","ORMEVNT",70,0)
CQ Q Y
"RTN","ORMEVNT",71,0)
 ;
"RTN","ORMEVNT",72,0)
PREVTS() ; -- Returns previous treating specialty
"RTN","ORMEVNT",73,0)
 N TS,TSP,CA,ID,LAST,Y
"RTN","ORMEVNT",74,0)
 S TS=+$O(^UTILITY("DGPM",$J,6,0)),TSP=$G(^(TS,"P"))
"RTN","ORMEVNT",75,0)
 I $G(TSP) S Y=+$P(TSP,U,9) G PRVQ ;edited TS mvt
"RTN","ORMEVNT",76,0)
 ; look for TS mvt since last phys mvt
"RTN","ORMEVNT",77,0)
 S CA=$P(DGPMA,U,14),ID=9999999.9999999-DGPMA
"RTN","ORMEVNT",78,0)
 S LAST=+$O(^DGPM("ATS",DFN,CA,ID)),Y=$S(LAST:+$O(^(LAST,0)),1:+VAIP(15,6))
"RTN","ORMEVNT",79,0)
PRVQ Q Y
"RTN","ORMEVNT",80,0)
 ;
"RTN","ORMEVNT",81,0)
TYPE(X) ; -- Return type of event from MAS code
"RTN","ORMEVNT",82,0)
 N Y S Y=$S(X=1:"A",X=2:"T",X=3:"D",X=6:"S",1:"")
"RTN","ORMEVNT",83,0)
 Q Y
"RTN","ORMEVNT",84,0)
 ;
"RTN","ORMEVNT",85,0)
DIV(LOC) ; -- Return Institution file #4 ptr for LOC
"RTN","ORMEVNT",86,0)
 N X0,Y S X0=$G(^SC(+LOC,0))
"RTN","ORMEVNT",87,0)
 S Y=$S($P(X0,U,4):$P(X0,U,4),$P(X0,U,15):$$SITE^VASITE(DT,$P(X0,U,15)),1:+$G(DUZ(2)))
"RTN","ORMEVNT",88,0)
 Q Y
"RTN","ORMEVNT",89,0)
 ;
"RTN","ORMEVNT",90,0)
PATEVT() ; -- Find match to new data in Patient Event file
"RTN","ORMEVNT",91,0)
 N TYPE,MVTYPE,EVT,IFN,X0,Y S Y="" G:'$G(ORCURRNT) PTQ
"RTN","ORMEVNT",92,0)
 S TYPE=$S(DGPMT=1:"A",DGPMT=3:"D",DGPMT=2!(DGPMT=6):"T",1:""),EVT=0
"RTN","ORMEVNT",93,0)
 S MVTYPE=$P(DGPMA,U,18),TYPE(1)="",MVTYPE(1)=""
"RTN","ORMEVNT",94,0)
 I DGPMT=2,MVTYPE=13 S TYPE(1)="A",MVTYPE(1)=40 ;To ASIH
"RTN","ORMEVNT",95,0)
 I DGPMT=3,MVTYPE=41 S TYPE(1)="T",MVTYPE(1)=14 ;From ASIH
"RTN","ORMEVNT",96,0)
 I DGPMT'=3,$$GET1^DIQ(45.7,+$G(ORTS)_",","SPECIALTY:SERVICE")="NHCU" S TYPE(1)=$S(TYPE="A":"T",1:"A") ;DBIA #1154
"RTN","ORMEVNT",97,0)
 F  S EVT=+$O(^ORE(100.2,"AE",DFN,EVT)) Q:EVT<1  S IFN=+$O(^(EVT,0)) D  Q:Y
"RTN","ORMEVNT",98,0)
 . Q:$$LAPSED^OREVNTX(+IFN)  Q:$P($G(^ORE(100.2,IFN,1)),U,5)
"RTN","ORMEVNT",99,0)
 . S X0=$G(^ORD(100.5,EVT,0)) Q:$P(X0,U,3)'=ORDIV
"RTN","ORMEVNT",100,0)
 . I $P(X0,U,2)'=TYPE,$P(X0,U,2)'=TYPE(1) Q  ;Xaction type
"RTN","ORMEVNT",101,0)
 . I $P(X0,U,7),$P(X0,U,7)'=MVTYPE,$P(X0,U,7)'=MVTYPE(1) Q  ;Mvt type
"RTN","ORMEVNT",102,0)
 . I $O(^ORD(100.5,EVT,"TS",0)) Q:'$D(^("B",ORTS))  Q:ORTS=ORLAST("TS")&(ORDIV=ORLAST("DIV"))
"RTN","ORMEVNT",103,0)
 . I $O(^ORD(100.5,EVT,"LOC",0)) Q:'$D(^("B",ORWARD))  Q:ORWARD=ORLAST("WD")
"RTN","ORMEVNT",104,0)
 . S Y=+IFN ;ok
"RTN","ORMEVNT",105,0)
PTQ Q Y
"RTN","ORMEVNT",106,0)
 ;
"RTN","ORMEVNT",107,0)
DCEVT() ; -- Find match to event in AutoDC Rules file for [new] ORDIV,ORTS,ORL
"RTN","ORMEVNT",108,0)
 N MVTYPE,DIV,XFER,ORY,EXC,OBS
"RTN","ORMEVNT",109,0)
 S OBS=$S(DGPMT=3:$$MVT^DGPMOBS(DGPMDA),1:0) ;observation mvt
"RTN","ORMEVNT",110,0)
 S MVTYPE=+$P(DGPMA,U,18) S:MVTYPE=41 MVTYPE=14 ;ASIH
"RTN","ORMEVNT",111,0)
 S XFER=$S(DGPMT=2:1,DGPMT=6:1,MVTYPE'=14:0,OBS:0,1:1) ;transfer
"RTN","ORMEVNT",112,0)
 I XFER,ORLAST("TS")'=ORTS,$D(^ORD(100.6,"AC",ORDIV,20)) S MVTYPE=20 ;TS
"RTN","ORMEVNT",113,0)
 S DIV=ORDIV I DGPMT=3,MVTYPE'=14 S DIV=ORLAST("DIV") ;discharge
"RTN","ORMEVNT",114,0)
 S ORY=+$O(^ORD(100.6,"AC",ORDIV,MVTYPE,0)) G:ORY<1 DCQ
"RTN","ORMEVNT",115,0)
 I MVTYPE=20,$D(^ORD(100.6,ORY,4,ORLAST("TS"),1,ORTS))!(ORTS=ORLAST("TS")) S ORY=0 G DCQ
"RTN","ORMEVNT",116,0)
 I MVTYPE=4 D  G DCQ ;ck Div and Loc multiples
"RTN","ORMEVNT",117,0)
 . I ORLAST("DIV")'=ORDIV S:'$D(^ORD(100.6,ORY,6,ORLAST("DIV"))) ORY=0 Q
"RTN","ORMEVNT",118,0)
 . N OLD,INCL S INCL=0 ;ck incl loc's
"RTN","ORMEVNT",119,0)
 . F OLD=+ORLAST("LOC"),"ALL" I $D(^ORD(100.6,ORY,5,"ADC",OLD,+ORL))!$D(^("ALL")) S INCL=1 Q
"RTN","ORMEVNT",120,0)
 . S:'INCL ORY=0
"RTN","ORMEVNT",121,0)
 I DGPMT=3,OBS D  ;readmitting from observation?
"RTN","ORMEVNT",122,0)
 . S EXC=+$P($G(^ORD(100.6,ORY,0)),U,6) S:EXC=2 ORY=0 ;ignore rule
"RTN","ORMEVNT",123,0)
 . I EXC=1,'$D(ZTQUEUED),$$READMIT S ORY=0
"RTN","ORMEVNT",124,0)
 . K:ORY ^XTMP("ORDCOBS-"_+ORVP) ;have rule -> dc, don't reinstate meds
"RTN","ORMEVNT",125,0)
DCQ Q ORY
"RTN","ORMEVNT",126,0)
 ;
"RTN","ORMEVNT",127,0)
READMIT() ; -- Return 1 or 0, if patient is being readmitted
"RTN","ORMEVNT",128,0)
 N X,Y,DIR
"RTN","ORMEVNT",129,0)
 S DIR(0)="YA",DIR("A")="Will the patient be re-admitted immediately? "
"RTN","ORMEVNT",130,0)
 S DIR("?")="Enter YES if the patient is to be admitted to the hospital immediately following this discharge from observation."
"RTN","ORMEVNT",131,0)
 D ^DIR S:$D(DTOUT)!$D(DUOUT) Y="^"
"RTN","ORMEVNT",132,0)
 Q Y
"RTN","ORMEVNT",133,0)
 ;
"RTN","ORMEVNT",134,0)
COMP(ORDG) ; -- Complete orders on event [Keep until GMRA*4*15]
"RTN","ORMEVNT",135,0)
 N ORI,ORLIST,ORIFN,OREDT
"RTN","ORMEVNT",136,0)
 I 'ORDG S:ORDG?1.U ORDG=+$O(^ORD(100.98,"B",ORDG,0)) Q:ORDG'>0
"RTN","ORMEVNT",137,0)
 D EN^ORQ1(ORVP,ORDG,2) S ORI=0,OREDT=$P(DGPMA,U)
"RTN","ORMEVNT",138,0)
 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI'>0  S ORIFN=^(ORI) D STATUS^ORCSAVE2(+ORIFN,2) S:$G(OREDT) $P(^OR(100,+ORIFN,3),U)=OREDT,$P(^(6),U,6)=OREDT
"RTN","ORMEVNT",139,0)
 Q
"RTN","ORMEVNT",140,0)
 ;
"RTN","ORMEVNT",141,0)
LOC(NODE) ; -- Returns [new] patient location from NODE
"RTN","ORMEVNT",142,0)
 N X,Y S X=$P($G(NODE),U,6)
"RTN","ORMEVNT",143,0)
 I X'>0 S X=$P($G(^DPT(+ORVP,.1)),U) S:$L(X) X=$O(^DIC(42,"B",X,0))
"RTN","ORMEVNT",144,0)
 S Y=+$G(^DIC(42,+X,44))_";SC("
"RTN","ORMEVNT",145,0)
 Q Y
"RTN","ORMEVNT",146,0)
 ;
"RTN","ORMEVNT",147,0)
DISCH ; -- Lapse/cancel outstanding events on discharge
"RTN","ORMEVNT",148,0)
 N X,ADM,EVT,ORP,X0,IFN,STS,X8,ORNOW S ORNOW=+$E($$NOW^XLFDT,1,12)
"RTN","ORMEVNT",149,0)
 S X=$P(DGPMA,U,18),ADM=$S(X=12!(X=38):"",1:+$G(VAIP(13))),EVT=0
"RTN","ORMEVNT",150,0)
 F  S EVT=+$O(^ORE(100.2,"AE",+ORVP,EVT)) Q:EVT<1  S ORP=+$O(^(EVT,0)) D
"RTN","ORMEVNT",151,0)
 . I $G(^ORE(100.2,ORP,1)) K ^ORE(100.2,"AE",+ORVP,EVT,ORP) Q
"RTN","ORMEVNT",152,0)
 . Q:$$LAPSED^OREVNTX(ORP)  I $$EMPTY^OREVNTX(ORP) D CANCEL^OREVNTX(ORP) Q
"RTN","ORMEVNT",153,0)
 . I ADM,$P($G(^ORE(100.2,ORP,0)),U,3)'=ADM Q  ;ck adm if not death
"RTN","ORMEVNT",154,0)
 . ;D LP1^OREVNTX(ORP) ;lapse orders/event
"RTN","ORMEVNT",155,0)
 . S X0=$G(^ORE(100.2,ORP,0))
"RTN","ORMEVNT",156,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",ORVP,ORP,IFN)) Q:IFN<1  D
"RTN","ORMEVNT",157,0)
 .. S STS=$P($G(^OR(100,IFN,3)),U,3) I (STS=10)!(IFN=+$P(X0,U,4)) D
"RTN","ORMEVNT",158,0)
 ... D STATUS^ORCSAVE2(IFN,13) S X8=$G(^OR(100,IFN,8,1,0))
"RTN","ORMEVNT",159,0)
 ... S:$P(X8,U,15) $P(^OR(100,IFN,8,1,0),U,15)=13
"RTN","ORMEVNT",160,0)
 ... D:$P(X8,U,4)=2 SIGN^ORCSAVE2(IFN,"","",5,1)
"RTN","ORMEVNT",161,0)
 ... S ^OR(100,IFN,6)=+$O(^ORD(100.02,"C","A",0))_U_U_ORNOW_U_+$O(^ORD(100.03,"C","ORDIS",0))_U_U_U_U_$G(OREVENT)
"RTN","ORMEVNT",162,0)
 . D DONE^OREVNTX(ORP),ACTLOG^OREVNTX(ORP,"CA")
"RTN","ORMEVNT",163,0)
 Q
"RTN","ORMEVNT",164,0)
 ;
"RTN","ORMEVNT",165,0)
XTMP ; -- Save ORIFN to possibly reinstate on admission
"RTN","ORMEVNT",166,0)
 ;    Also uses ORVP, DGPMDA
"RTN","ORMEVNT",167,0)
 Q:'$G(DGPMDA)  Q:'$G(ORIFN)  Q:'$G(ORVP)
"RTN","ORMEVNT",168,0)
 N ORNOW S ORNOW=+$$NOW^XLFDT
"RTN","ORMEVNT",169,0)
 I $G(^XTMP("ORDCOBS-"_+ORVP,0)),+^(0)<ORNOW K ^XTMP("ORDCOBS-"_+ORVP)
"RTN","ORMEVNT",170,0)
 I '$G(^XTMP("ORDCOBS-"_+ORVP,0)) D
"RTN","ORMEVNT",171,0)
 . N ORNOW1H S ORNOW1H=$$FMADD^XLFDT(ORNOW,,1)
"RTN","ORMEVNT",172,0)
 . S ^XTMP("ORDCOBS-"_+ORVP,0)=ORNOW1H_U_ORNOW_"^InptMeds AutoDC'd on Discharge from Observation"
"RTN","ORMEVNT",173,0)
 S ^XTMP("ORDCOBS-"_+ORVP,+ORIFN)=$G(^OR(100,+ORIFN,4))
"RTN","ORMEVNT",174,0)
 S ^XTMP("ORDCOBS-"_+ORVP,"DISCHARGE")=DGPMDA
"RTN","ORMEVNT",175,0)
 Q
"RTN","ORMEVNT",176,0)
 ;
"RTN","ORMEVNT",177,0)
REINST ; -- Reinstate meds from observation
"RTN","ORMEVNT",178,0)
 I '$L($T(ENR^PSJOERI)) K ^XTMP("ORDCOBS-"_+ORVP) Q
"RTN","ORMEVNT",179,0)
 N ORIDT,ORLASTDC,X0,ORIFN,PSIFN
"RTN","ORMEVNT",180,0)
 S ORIDT=+$O(^DGPM("ATID3",+ORVP,0)) Q:ORIDT<1  S ORLASTDC=+$O(^(ORIDT,0))
"RTN","ORMEVNT",181,0)
 Q:$G(^XTMP("ORDCOBS-"_+ORVP,"DISCHARGE"))'=ORLASTDC  S X0=$G(^(0))
"RTN","ORMEVNT",182,0)
 Q:+X0<1  ;I $P(X0,U)<$$NOW^XLFDT K ^XTMP("ORDCOBS-"_+ORVP) Q  ;too long
"RTN","ORMEVNT",183,0)
 S ORIFN=0 F  S ORIFN=+$O(^XTMP("ORDCOBS-"_+ORVP,ORIFN))  Q:ORIFN<1  S PSIFN=$G(^(ORIFN)) D:PSIFN ENR^PSJOERI(+ORVP,PSIFN,+ORWARD)
"RTN","ORMEVNT",184,0)
 K ^XTMP("ORDCOBS-"_+ORVP)
"RTN","ORMEVNT",185,0)
 Q
"RTN","ORMEVNT",186,0)
 ;
"RTN","ORMEVNT",187,0)
 ; -- Moved code:
"RTN","ORMEVNT",188,0)
EXP(ORDER,ORSTOP) G EXP^ORMEVNT1
"RTN","ORMEVNT",189,0)
ACTIVE(ORDER,ORSTRT) G ACT^ORMEVNT1
"RTN","ORMEVNT",190,0)
PURGE(ORDER) G PUR^ORMEVNT1
"RTN","ORMEVNT1")
0^2^B59958123
"RTN","ORMEVNT1",1,0)
ORMEVNT1 ;SLC/MKB-Trigger HL7 msg off OR events,ORMTIME ;1/21/03  13:21
"RTN","ORMEVNT1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165**;Dec 17, 1997
"RTN","ORMEVNT1",3,0)
 ;
"RTN","ORMEVNT1",4,0)
OR2(ORSRDA) ;Queue EDO process to background, return control to surgery
"RTN","ORMEVNT1",5,0)
 ;
"RTN","ORMEVNT1",6,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSK,ZTSAVE
"RTN","ORMEVNT1",7,0)
 S ZTRTN="OR2Q^ORMEVNT1",ZTDTH=$H,ZTDESC="Surgery triggered EDO processing",ZTIO="",ZTSAVE("ORSRDA")="" D ^%ZTLOAD
"RTN","ORMEVNT1",8,0)
 Q
"RTN","ORMEVNT1",9,0)
 ;
"RTN","ORMEVNT1",10,0)
OR2Q ; -- Kill logic, from Surgery package [DBIA #3558]
"RTN","ORMEVNT1",11,0)
 ;    ^SRF reads allowed by DBIA #3559
"RTN","ORMEVNT1",12,0)
 N X,Y,DA,OREVT,ORSRF,ORACT
"RTN","ORMEVNT1",13,0)
 S OREVT=+$O(^ORE(100.2,"ASR",+$G(ORSRDA),0)) Q:OREVT<1
"RTN","ORMEVNT1",14,0)
 S ORSRF=$G(^SRF(+ORSRDA,.2)),ORACT=$S($L($P(ORSRF,U,12)):"ED",1:"DL")
"RTN","ORMEVNT1",15,0)
 D ACTLOG^OREVNTX(OREVT,ORACT)
"RTN","ORMEVNT1",16,0)
 Q
"RTN","ORMEVNT1",17,0)
 ;
"RTN","ORMEVNT1",18,0)
OR1(ORSRDA,ORSRX) ;Queue EDO process to background, return control to surgery
"RTN","ORMEVNT1",19,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSK,ZTSAVE
"RTN","ORMEVNT1",20,0)
 S ZTRTN="OR1Q^ORMEVNT1",ZTDTH=$H,ZTDESC="Surgery triggered EDO processing",ZTIO="",ZTSAVE("ORSRDA")="",ZTSAVE("ORSRX")="" D ^%ZTLOAD
"RTN","ORMEVNT1",21,0)
 Q
"RTN","ORMEVNT1",22,0)
 ;
"RTN","ORMEVNT1",23,0)
OR1Q ; -- Set logic, from Surgery package [DBIA #3558]
"RTN","ORMEVNT1",24,0)
 ;    ^SRF reads allowed by DBIA #3559
"RTN","ORMEVNT1",25,0)
 N X S X=ORSRX
"RTN","ORMEVNT1",26,0)
 I $G(^SRF(+$G(ORSRDA),"CON")),$D(^ORE(100.2,"ASR",+^("CON"))) Q  ;concurrent
"RTN","ORMEVNT1",27,0)
 Q:$D(^ORE(100.2,"ASR",+$G(ORSRDA)))  Q:'$$CURRENT  ;edit
"RTN","ORMEVNT1",28,0)
 ;
"RTN","ORMEVNT1",29,0)
 N ORSR0,DFN,VAIP,VAERR,X,Y,DA,ORVP,ORL,ORDIV,ORTS,OREVENT,ORDCRULE,ORPRINT
"RTN","ORMEVNT1",30,0)
 S ORSR0=$G(^SRF(+$G(ORSRDA),0)),DFN=+$P(ORSR0,U)
"RTN","ORMEVNT1",31,0)
 D IN5^VADPT Q:'$G(VAIP(13))  ;not admitted
"RTN","ORMEVNT1",32,0)
 S ORL=$P($G(^SRS(+$P(ORSR0,U,2),0)),U)_";SC(",ORDIV=$$DIV(+ORL) ;DBIA #3362
"RTN","ORMEVNT1",33,0)
 S ORTS=+$G(VAIP(8)) ; need surg spec too?  DBIA #991
"RTN","ORMEVNT1",34,0)
 S ORVP=DFN_";DPT(",OREVENT=$$PATEVT,ORDCRULE=$$DCEVT
"RTN","ORMEVNT1",35,0)
 D:ORDCRULE AUTODC(ORDCRULE,ORSRX) I OREVENT D
"RTN","ORMEVNT1",36,0)
 . D RELEASE(OREVENT),DONE^OREVNTX(OREVENT,ORSRX,,ORSRDA)
"RTN","ORMEVNT1",37,0)
 . D ACTLOG^OREVNTX(OREVENT,"NW","O")
"RTN","ORMEVNT1",38,0)
 I $O(ORPRINT(0)),$G(ORL) D PRINTS^ORWD1(.ORPRINT,+ORL)
"RTN","ORMEVNT1",39,0)
 Q
"RTN","ORMEVNT1",40,0)
 ;
"RTN","ORMEVNT1",41,0)
DIV(LOC) ; -- Return Institution file #4 ptr for LOC
"RTN","ORMEVNT1",42,0)
 N X0,Y S X0=$G(^SC(+LOC,0))
"RTN","ORMEVNT1",43,0)
 S Y=$S($P(X0,U,4):$P(X0,U,4),$P(X0,U,15):$$SITE^VASITE(DT,$P(X0,U,15)),1:+$G(DUZ(2)))
"RTN","ORMEVNT1",44,0)
 Q Y
"RTN","ORMEVNT1",45,0)
 ;
"RTN","ORMEVNT1",46,0)
CURRENT() ; -- Is posted mvt the latest one?
"RTN","ORMEVNT1",47,0)
 N Y S Y=$S((DT-X)<1:1,1:0)
"RTN","ORMEVNT1",48,0)
 Q Y
"RTN","ORMEVNT1",49,0)
 ;
"RTN","ORMEVNT1",50,0)
PATEVT() ; -- Find match to new data in Patient Event file
"RTN","ORMEVNT1",51,0)
 N EVT,IFN,X0,Y S EVT=0,Y=""
"RTN","ORMEVNT1",52,0)
 F  S EVT=+$O(^ORE(100.2,"AE",+ORVP,EVT)) Q:EVT<1  S IFN=$O(^(EVT,0)) D  Q:Y
"RTN","ORMEVNT1",53,0)
 . Q:$$LAPSED^OREVNTX(+IFN)  ;don't release orders
"RTN","ORMEVNT1",54,0)
 . S X0=$G(^ORD(100.5,EVT,0))
"RTN","ORMEVNT1",55,0)
 . I $P(X0,U,2)="O",$P(X0,U,3)=ORDIV S Y=+IFN Q
"RTN","ORMEVNT1",56,0)
 Q Y
"RTN","ORMEVNT1",57,0)
 ;
"RTN","ORMEVNT1",58,0)
DCEVT() ; -- Find match to event in AutoDC Rules file for [new] ORDIV
"RTN","ORMEVNT1",59,0)
 N Y I '$G(^DPT(+ORVP,.105)) Q 0 ;no auto-dc's if not admitted
"RTN","ORMEVNT1",60,0)
 S Y=+$O(^ORD(100.6,"AE",ORDIV,"O",0))
"RTN","ORMEVNT1",61,0)
 Q Y
"RTN","ORMEVNT1",62,0)
 ;
"RTN","ORMEVNT1",63,0)
AUTODC(ORDC,ORDT) ; -- DC orders based on rule ORDC [also from ORMEVNT]
"RTN","ORMEVNT1",64,0)
 ;    Expects VAIP array with current admission data
"RTN","ORMEVNT1",65,0)
 N ORADM,ORNOW,ORN,X,OREASON,ORNATR,ORCREATE,ORPRNT,ORSIG,ORDG,ORI,ORPKG,ORLIST,ORIFN,OR0,ORDER,ORERR
"RTN","ORMEVNT1",66,0)
 S OREASON=+$P($G(^ORD(100.6,ORDC,0)),U,4) I OREASON<1 D
"RTN","ORMEVNT1",67,0)
 . S OREASON=$S('$G(DGPMT):"OROR",DGPMT=1:"ORADMIT",DGPMT=2:"ORTRANS",DGPMT=3:"ORDIS",1:"ORSPEC")
"RTN","ORMEVNT1",68,0)
 . S OREASON=+$O(^ORD(100.03,"C",OREASON,0))
"RTN","ORMEVNT1",69,0)
 S ORNATR=+$P($G(^ORD(100.03,+$G(OREASON),0)),U,7)
"RTN","ORMEVNT1",70,0)
 S:ORNATR'>0 ORNATR=+$O(^ORD(100.02,"C","A",0))
"RTN","ORMEVNT1",71,0)
 S X=$G(^ORD(100.02,ORNATR,1)),ORCREATE=+$P(X,U),ORPRNT=+$P(X,U,2)
"RTN","ORMEVNT1",72,0)
 S ORSIG=$S('ORCREATE:"",1:$P(X,U,4)),ORDG=$O(^ORD(100.98,"B","ALL",0))
"RTN","ORMEVNT1",73,0)
 S ORI=0 F  S ORI=$O(^ORD(100.6,ORDC,7,"B",ORI)) Q:ORI<1  S ORPKG(ORI)=1
"RTN","ORMEVNT1",74,0)
 S ORADM=+$G(VAIP(13,1)),ORNOW=$$NOW^XLFDT,ORN="A",ORI=6
"RTN","ORMEVNT1",75,0)
 I $G(DGPMT)=1 S ORI=2,ORADM="",ORN="A"
"RTN","ORMEVNT1",76,0)
 I $G(DGPMT)=3,"^12^38^"[(U_$P(DGPMA,U,18)_U) S ORI=2,ORADM="",ORN=""
"RTN","ORMEVNT1",77,0)
 D EN^ORQ1(ORVP,ORDG,ORI,,ORADM,ORNOW),ADMORD S ORI=0
"RTN","ORMEVNT1",78,0)
DC1 F  S ORI=$O(^TMP("ORR",$J,ORLIST,ORI)) Q:ORI'>0  S ORIFN=^(ORI) D
"RTN","ORMEVNT1",79,0)
 . ;Q:$P(ORIFN,";",2)>1  ; or DC/Delete actions ??
"RTN","ORMEVNT1",80,0)
 . Q:"^1^2^7^11^12^13^"[(U_$P(^OR(100,+ORIFN,3),U,3)_U)  S OR0=$G(^(0))
"RTN","ORMEVNT1",81,0)
 . Q:'$G(ORPKG($P(OR0,U,14)))  Q:$D(^ORD(100.6,ORDC,10,"B",+$P(OR0,U,11)))
"RTN","ORMEVNT1",82,0)
 . S X=+$$VALUE^ORX8(+ORIFN,"ORDERABLE") Q:$D(^ORD(100.6,ORDC,8,"B",X))
"RTN","ORMEVNT1",83,0)
 . Q:'$$VALID^ORCACT0(ORIFN,"DC",,ORN)  ;ok to auto-dc order?
"RTN","ORMEVNT1",84,0)
 . I '$G(OREVENT) S OREVENT=+$$NEW^OREVNT(+ORVP) ;no delayed orders
"RTN","ORMEVNT1",85,0)
 . S ORDER=+ORIFN_$S(ORCREATE:";"_$$ACTION^ORCSAVE("DC",+ORIFN,$G(ORNP),,$G(ORDT)),1:"")
"RTN","ORMEVNT1",86,0)
 . D EN^ORCSEND(ORDER,"DC",ORSIG,1,ORNATR,$G(OREASON),.ORERR) Q:$G(ORERR)
"RTN","ORMEVNT1",87,0)
 . S $P(^OR(100,+ORIFN,6),U,8)=OREVENT D SAVE(ORIFN,OREVENT,3)
"RTN","ORMEVNT1",88,0)
 . S:ORPRNT ORPRINT=$G(ORPRINT)+1,ORPRINT(ORPRINT)=ORDER_"^1"
"RTN","ORMEVNT1",89,0)
DC2 I $G(OREVENT) D
"RTN","ORMEVNT1",90,0)
 . S $P(^ORE(100.2,OREVENT,1),U,3)=ORDC,^ORE(100.2,"DC",ORDC,OREVENT)=""
"RTN","ORMEVNT1",91,0)
 . I $G(DGPMDA),$D(^XTMP("ORDC-"_DGPMDA)) D XTMP ;save order#'s
"RTN","ORMEVNT1",92,0)
 K ^TMP("ORR",$J,ORLIST),^XTMP("ORDC-"_$G(DGPMDA))
"RTN","ORMEVNT1",93,0)
 Q
"RTN","ORMEVNT1",94,0)
 ;
"RTN","ORMEVNT1",95,0)
RELEASE(OREVT) ; -- release orders for OREVT [also from ORMEVNT]
"RTN","ORMEVNT1",96,0)
 ;    Returns ORPRINT(#)=order^prints for orders released
"RTN","ORMEVNT1",97,0)
 Q:'$G(OREVT)  N ORPARM,ORLR,ORX,ORI,ORV,ORIFN,ORERR,OR0,OR3,ORLAB
"RTN","ORMEVNT1",98,0)
 S ORPARM="" I $G(ORL) F ORI="CHART COPY","LABELS","REQUISITIONS","SERVICE","WORK COPY" S ORX=$S(ORI="SERVICE":0,1:$$GET^XPAR("ALL^"_ORL,"ORPF PROMPT FOR "_ORI,1,"I")),ORPARM=ORPARM_U_$S(ORX="*":0,1:1)
"RTN","ORMEVNT1",99,0)
 S ORLR=+$O(^DIC(9.4,"C","LR",0)),ORX=OREVT,ORI=0
"RTN","ORMEVNT1",100,0)
 F  S ORI=+$O(^ORE(100.2,"DAD",OREVT,ORI)) Q:ORI<1  S ORX=ORX_U_ORI
"RTN","ORMEVNT1",101,0)
 F ORV=1:1:$L(ORX,U) S OREVT=$P(ORX,U,ORV) D  ;event[+children]
"RTN","ORMEVNT1",102,0)
 . F  S ORI=$O(^OR(100,"AEVNT",ORVP,OREVT,ORI)) Q:ORI'>0  D
"RTN","ORMEVNT1",103,0)
 .. S ORIFN=ORI,OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3))
"RTN","ORMEVNT1",104,0)
 .. I ORIFN=+$P($G(^ORE(100.2,OREVT,0)),U,4) D  Q  ;event order
"RTN","ORMEVNT1",105,0)
 ... Q:$$TYPE^OREVNTX(OREVT)="D"  Q:$P(OR3,U,3)=11
"RTN","ORMEVNT1",106,0)
 ... S ORPRINT=+$G(ORPRINT)+1,ORPRINT(ORPRINT)=ORIFN_";1"_ORPARM
"RTN","ORMEVNT1",107,0)
 .. Q:$P(OR3,U,3)'=10  ;released or cancelled
"RTN","ORMEVNT1",108,0)
 .. S:$G(ORL) $P(^OR(100,ORIFN,0),U,10)=ORL ;set location
"RTN","ORMEVNT1",109,0)
 .. S:$G(ORTS) $P(^OR(100,ORIFN,0),U,13)=ORTS ;set specialty
"RTN","ORMEVNT1",110,0)
 .. I $P(OR0,U,14)=ORLR,'$G(ORLAB) D BHS^ORMBLD(ORVP) S ORLAB=1
"RTN","ORMEVNT1",111,0)
 .. K ORERR D EN1^ORCSEND(ORIFN,.ORERR) Q:$G(ORERR)
"RTN","ORMEVNT1",112,0)
 .. Q:"^10^11^"[(U_$P($G(^OR(100,ORIFN,3)),U,3)_U)  D SAVE(ORIFN,OREVT,2)
"RTN","ORMEVNT1",113,0)
 .. S ORPRINT=+$G(ORPRINT)+1,ORPRINT(ORPRINT)=ORIFN_";1"_ORPARM
"RTN","ORMEVNT1",114,0)
 D BTS^ORMBLD(ORVP):$G(ORLAB) ;send batch hdr/tlr segments for labs
"RTN","ORMEVNT1",115,0)
 Q
"RTN","ORMEVNT1",116,0)
 ;
"RTN","ORMEVNT1",117,0)
ADMORD ; -- Add admission order to list
"RTN","ORMEVNT1",118,0)
 ;    Uses VAIP(13),ORADM from AUTODC
"RTN","ORMEVNT1",119,0)
 ;Q:$G(DGPMT)'=3
"RTN","ORMEVNT1",120,0)
 I $G(DGPMT)=3 Q:"^12^38^"[(U_$P(DGPMA,U,18)_U)  ;already included
"RTN","ORMEVNT1",121,0)
 N LAST,ADMEVT,IFN
"RTN","ORMEVNT1",122,0)
 S LAST=+$O(^ORE(100.2,"ADT",+$G(VAIP(13)),""),-1),ADMEVT=+$O(^(LAST,0))
"RTN","ORMEVNT1",123,0)
 S IFN=+$P($G(^ORE(100.2,ADMEVT,0)),U,4) Q:IFN<1
"RTN","ORMEVNT1",124,0)
 I $P($G(^OR(100,IFN,8,1,0)),U,16)<ORADM D  ;add to auto-dc list
"RTN","ORMEVNT1",125,0)
 . N ORI S ORI=+$O(^TMP("ORR",$J,ORLIST,"A"),-1),ORI=ORI+1
"RTN","ORMEVNT1",126,0)
 . S ^TMP("ORR",$J,ORLIST,ORI)=IFN
"RTN","ORMEVNT1",127,0)
 Q
"RTN","ORMEVNT1",128,0)
 ;
"RTN","ORMEVNT1",129,0)
XTMP ; -- Save auto-dc'd by package order numbers
"RTN","ORMEVNT1",130,0)
 N ORDC,ORIFN,X Q:'$G(OREVENT)
"RTN","ORMEVNT1",131,0)
 S ORDC="ORDC-"_$G(DGPMDA),ORIFN=0
"RTN","ORMEVNT1",132,0)
 F  S ORIFN=+$O(^XTMP(ORDC,ORIFN)) Q:ORIFN<1  S X=$G(^(ORIFN)) D
"RTN","ORMEVNT1",133,0)
 . D SAVE(ORIFN,OREVENT,3,X)
"RTN","ORMEVNT1",134,0)
 . S $P(^OR(100,+ORIFN,6),U,8)=OREVENT
"RTN","ORMEVNT1",135,0)
 Q
"RTN","ORMEVNT1",136,0)
 ;
"RTN","ORMEVNT1",137,0)
SAVE(IFN,EVT,NODE,PKG) ; -- Save order# IFN with EVT at NODE
"RTN","ORMEVNT1",138,0)
 ;    NODE=2: Released orders, NODE=3: Auto-DC'd orders
"RTN","ORMEVNT1",139,0)
 Q:'$G(IFN)!'$G(EVT)!'$G(NODE)  ;missing data
"RTN","ORMEVNT1",140,0)
 Q:$D(^ORE(100.2,EVT,NODE,+IFN,0))  ;already saved
"RTN","ORMEVNT1",141,0)
 N I,HDR,TOTAL
"RTN","ORMEVNT1",142,0)
 F I=1:1:10 L +^ORE(100.2,EVT,NODE,0):1 Q:$T  H 2
"RTN","ORMEVNT1",143,0)
 Q:'$T  S HDR=$G(^ORE(100.2,EVT,NODE,0))
"RTN","ORMEVNT1",144,0)
 I '$L(HDR) S:NODE=2 HDR="^100.26PA^^" S:NODE=3 HDR="^100.27PA^^"
"RTN","ORMEVNT1",145,0)
 Q:'$L(HDR)  S TOTAL=+$P(HDR,U,4),$P(HDR,U,3,4)=+IFN_U_(TOTAL+1)
"RTN","ORMEVNT1",146,0)
 S ^ORE(100.2,EVT,NODE,0)=HDR L -^ORE(100.2,EVT,NODE,0)
"RTN","ORMEVNT1",147,0)
 S ^ORE(100.2,EVT,NODE,+IFN,0)=+IFN_$S($D(PKG):U_PKG,1:"")
"RTN","ORMEVNT1",148,0)
 Q
"RTN","ORMEVNT1",149,0)
 ;
"RTN","ORMEVNT1",150,0)
EXP ; -- expire an order from ORMTIME
"RTN","ORMEVNT1",151,0)
 ;    from EXP^ORMEVNT(ORDER,ORSTOP)
"RTN","ORMEVNT1",152,0)
 G:'$D(^OR(100,+ORDER,0)) EXPQ
"RTN","ORMEVNT1",153,0)
 N OR0,ORNMSP,ORSTS
"RTN","ORMEVNT1",154,0)
 S OR0=$G(^OR(100,+ORDER,0)),ORSTS=$P($G(^(3)),U,3)
"RTN","ORMEVNT1",155,0)
 I "^1^2^7^12^13^14^"[(U_ORSTS_U) G EXPQ ; already expired or done
"RTN","ORMEVNT1",156,0)
 I $O(^OR(100,+ORDER,2,0)) G EXPQ ; parent
"RTN","ORMEVNT1",157,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORMEVNT1",158,0)
 D:ORNMSP="PS"!(ORNMSP="FH") MSG^ORMBLD(+ORDER,"SS")
"RTN","ORMEVNT1",159,0)
 I ORNMSP="OR"!(ORNMSP="FH"),"^1^7^"'[(U_ORSTS_U) D STATUS^ORCSAVE2(+ORDER,7) ;ck FH order status after SS update
"RTN","ORMEVNT1",160,0)
EXPQ K ^OR(100,"AE",ORSTOP,ORDER)
"RTN","ORMEVNT1",161,0)
 Q
"RTN","ORMEVNT1",162,0)
 ;
"RTN","ORMEVNT1",163,0)
ACT ; -- activate an order from ORMTIME
"RTN","ORMEVNT1",164,0)
 ;    from ACTIVE^ORMEVNT(ORDER,ORSTRT)
"RTN","ORMEVNT1",165,0)
 G:'$D(^OR(100,+ORDER,0)) ACTQ
"RTN","ORMEVNT1",166,0)
 N OR0,ORNMSP,ORSTS
"RTN","ORMEVNT1",167,0)
 S OR0=$G(^OR(100,+ORDER,0)),ORSTS=$P($G(^(3)),U,3)
"RTN","ORMEVNT1",168,0)
 I "^1^2^6^7^12^13^14^"[(U_ORSTS_U) G ACTQ ; already active or done
"RTN","ORMEVNT1",169,0)
 I $O(^OR(100,+ORDER,2,0)) G ACTQ ; parent
"RTN","ORMEVNT1",170,0)
 S ORNMSP=$$NMSP^ORCD($P(OR0,U,14))
"RTN","ORMEVNT1",171,0)
 D:ORNMSP="PS"!(ORNMSP="FH") MSG^ORMBLD(+ORDER,"SS")
"RTN","ORMEVNT1",172,0)
 I ORNMSP="OR"!(ORNMSP="FH"),ORSTS=8 D STATUS^ORCSAVE2(+ORDER,6) ;ck FH
"RTN","ORMEVNT1",173,0)
ACTQ K ^OR(100,"AD",ORSTRT,ORDER)
"RTN","ORMEVNT1",174,0)
 Q
"RTN","ORMEVNT1",175,0)
 ;
"RTN","ORMEVNT1",176,0)
PUR ; -- purge an order
"RTN","ORMEVNT1",177,0)
 ;    from PURGE^ORMEVNT(ORDER)
"RTN","ORMEVNT1",178,0)
 N ORSTS,ORPK,ORNMSP,ORCHLD Q:'$D(^OR(100,ORDER))
"RTN","ORMEVNT1",179,0)
 S ORSTS=$P($G(^OR(100,ORDER,3)),U,3),ORPK=$G(^(4)),ORNMSP=$P($G(^(0)),U,14),ORNMSP=$$NMSP^ORCD(ORNMSP)
"RTN","ORMEVNT1",180,0)
 I '$L(ORPK)!(ORSTS=11)!(ORNMSP="OR")!(ORNMSP="LR"&('ORPK)) D DELETE^ORCSAVE2(ORDER) Q
"RTN","ORMEVNT1",181,0)
 I '$D(^OR(100,ORDER,2)) D MSG^ORMBLD(ORDER,"Z@") Q
"RTN","ORMEVNT1",182,0)
 S ORCHLD=0 F  S ORCHLD=$O(^OR(100,ORDER,2,ORCHLD)) Q:ORCHLD'>0  D MSG^ORMBLD(ORCHLD,"Z@")
"RTN","ORMEVNT1",183,0)
 I '$O(^OR(100,ORDER,2,0)) D DELETE^ORCSAVE2(ORDER) ; delete parent
"RTN","ORMEVNT1",184,0)
 Q
"RTN","ORMPS")
0^5^B67437073
"RTN","ORMPS",1,0)
ORMPS ; SLC/MKB - Process Pharmacy ORM msgs ;3/8/02  13:05
"RTN","ORMPS",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**3,54,62,86,92,94,116,138,152,141,165**;Dec 17, 1997
"RTN","ORMPS",3,0)
EN ; -- entry point for PS messages
"RTN","ORMPS",4,0)
 I '$L($T(@ORDCNTRL)) Q  ;S ORERR="Invalid order control code" Q
"RTN","ORMPS",5,0)
 I ORDCNTRL'="SN",ORDCNTRL'="ZC",ORDCNTRL'="ZP",'ORIFN!('$D(^OR(100,+ORIFN,0))) S ORERR="Invalid OE/RR order number" Q
"RTN","ORMPS",6,0)
 N ORSTS,RXE,ZRX,ORWHO,ORNOW
"RTN","ORMPS",7,0)
 S ORSTS=$$STATUS(ORDSTS),RXE=$$RXE,ZRX=$$ZRX D QT^ORMPS1 ;QT in RXE
"RTN","ORMPS",8,0)
 S ORNOW=+$E($$NOW^XLFDT,1,12),ORWHO=+$P(ZRX,"|",6) S:'ORWHO ORWHO=DUZ
"RTN","ORMPS",9,0)
 S:ORLOG ORLOG=+$E(ORLOG,1,12) ;no seconds
"RTN","ORMPS",10,0)
 S:'$L(ORNATR) ORNATR=$P(ZRX,"|",3) S:OREASON["^" OREASON=$P(OREASON,U,5)
"RTN","ORMPS",11,0)
 I ORNATR="D",'$L(OREASON) S OREASON="DUPLICATE"
"RTN","ORMPS",12,0)
 D @ORDCNTRL
"RTN","ORMPS",13,0)
 Q
"RTN","ORMPS",14,0)
 ;
"RTN","ORMPS",15,0)
ZV ; -- Verified
"RTN","ORMPS",16,0)
 N ORDA,ORUSR S ORDA=+$P(ORIFN,";",2) S:'ORDA ORDA=1
"RTN","ORMPS",17,0)
 Q:$P($G(^OR(100,+ORIFN,8,ORDA,0)),U,8)  ;already verified
"RTN","ORMPS",18,0)
 S ORUSR=+$P(ORC,"|",12) Q:'ORUSR
"RTN","ORMPS",19,0)
 D VERIFY^ORCSAVE2(+ORIFN,ORDA,"N",ORUSR,ORLOG)
"RTN","ORMPS",20,0)
 Q
"RTN","ORMPS",21,0)
 ;
"RTN","ORMPS",22,0)
ZP ; -- Purged
"RTN","ORMPS",23,0)
 Q:'ORIFN  Q:'$D(^OR(100,+ORIFN,0))
"RTN","ORMPS",24,0)
 K ^OR(100,+ORIFN,4) I "^3^5^6^15^"[(U_$P($G(^(3)),U,3)_U) D STATUS^ORCSAVE2(+ORIFN,14) ;Remove pkg reference, sts=lapsed if still active
"RTN","ORMPS",25,0)
 Q
"RTN","ORMPS",26,0)
 ;
"RTN","ORMPS",27,0)
ZR ; -- Purged as requested [ack]
"RTN","ORMPS",28,0)
 D DELETE^ORCSAVE2(+ORIFN)
"RTN","ORMPS",29,0)
 Q
"RTN","ORMPS",30,0)
 ;
"RTN","ORMPS",31,0)
ZU ; -- Unable to purge [ack]
"RTN","ORMPS",32,0)
 S $P(^OR(100,+ORIFN,3),U)=$$NOW^XLFDT ;update Last Activity
"RTN","ORMPS",33,0)
 Q
"RTN","ORMPS",34,0)
 ;
"RTN","ORMPS",35,0)
XR ; -- Changed as requested [ack]
"RTN","ORMPS",36,0)
 N ORIG S ORIG=$P(^OR(100,+ORIFN,3),U,5) I ORIG,$P(^OR(100,ORIG,3),U,3)'=12 D STATUS^ORCSAVE2(ORIG,12)
"RTN","ORMPS",37,0)
OK ; -- Order accepted, PS order # assigned [ack]
"RTN","ORMPS",38,0)
 S ^OR(100,+ORIFN,4)=PKGIFN ;PS identifier
"RTN","ORMPS",39,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",40,0)
 Q
"RTN","ORMPS",41,0)
 ;
"RTN","ORMPS",42,0)
ZC ; -- Convert existing 2.5 orders to 3.0 format
"RTN","ORMPS",43,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT
"RTN","ORMPS",44,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",45,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",46,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",47,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J)
"RTN","ORMPS",48,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1")
"RTN","ORMPS",49,0)
ZC1 ; continue ... save responses, post reply
"RTN","ORMPS",50,0)
 Q:$D(ORERR)  I 'ORIFN!('$D(^OR(100,+ORIFN,0))) D  Q  ;create
"RTN","ORMPS",51,0)
 . K ORIFN D SN1 Q:'$G(ORIFN)  S ORDCNTRL="SN"
"RTN","ORMPS",52,0)
 . I ORSTOP,ORSTOP<ORNOW S $P(^OR(100,ORIFN,3),U)=ORSTOP
"RTN","ORMPS",53,0)
 S ORIFN=+ORIFN D RESPONSE^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",54,0)
 S ^OR(100,ORIFN,4)=PKGIFN,$P(^(0),U,5)=+ORDIALOG_";ORD(101.41,"
"RTN","ORMPS",55,0)
 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP),STATUS^ORCSAVE2(ORIFN,ORSTS):ORSTS
"RTN","ORMPS",56,0)
 Q
"RTN","ORMPS",57,0)
 ;
"RTN","ORMPS",58,0)
SN ; -- New backdoor order, return OE# via NA msg
"RTN","ORMPS",59,0)
 I $$FINISHED^ORMPS2 D RO^ORMPS2 Q  ;change action instead
"RTN","ORMPS",60,0)
 N RXO,RXC,ORDIALOG,ORDG,ORPKG,ORP,ORSIG,ORIG,TYPE,EVNT,ZSC
"RTN","ORMPS",61,0)
 I '$D(^VA(200,ORDUZ,0)) S ORERR="Missing or invalid entering person" Q
"RTN","ORMPS",62,0)
 I '$D(^VA(200,ORNP,0)) S ORERR="Missing or invalid ordering provider" Q
"RTN","ORMPS",63,0)
 ; I '$G(ORL) S ORERR="Missing or invalid patient location" Q
"RTN","ORMPS",64,0)
 I 'RXE S ORERR="Missing or invalid RXE segment" Q
"RTN","ORMPS",65,0)
 S RXO=$$RXO,RXC=$$RXC K ^TMP("ORWORD",$J),ORIFN
"RTN","ORMPS",66,0)
 D @($S(RXC:"IV",$G(ORCAT)="I":"UDOSE",1:"OUT")_"^ORMPS1") Q:$D(ORERR)
"RTN","ORMPS",67,0)
SN1 ; continue ... save order, post messsage
"RTN","ORMPS",68,0)
 D EN^ORCSAVE K ^TMP("ORWORD",$J)
"RTN","ORMPS",69,0)
 I '$G(ORIFN) S ORERR="Cannot create new order" Q
"RTN","ORMPS",70,0)
 S ORIG=+$P(ZRX,"|",2),TYPE=$P(ZRX,"|",4) I ORIG D  ;set fwd/bwd ptrs
"RTN","ORMPS",71,0)
 . S TYPE=$S(TYPE="R":2,1:1)
"RTN","ORMPS",72,0)
 . S $P(^OR(100,ORIFN,3),U,5)=ORIG,$P(^(3),U,11)=TYPE
"RTN","ORMPS",73,0)
 . I $D(^OR(100,ORIG,0)) S $P(^(3),U,6)=ORIFN,EVNT=$P(^(0),U,17) I $L(EVNT),TYPE=1 S $P(^OR(100,ORIFN,0),U,17)=EVNT
"RTN","ORMPS",74,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",75,0)
SN2 D DATES^ORCSAVE2(ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",76,0)
 D:ORSTS STATUS^ORCSAVE2(ORIFN,ORSTS)
"RTN","ORMPS",77,0)
 D RELEASE^ORCSAVE2(ORIFN,1,ORLOG,ORDUZ,ORNATR)
"RTN","ORMPS",78,0)
 ; if unsigned edit, leave ORIFN unsigned & mark ORIG as Sig Not Req'd
"RTN","ORMPS",79,0)
 S ORSIG=$S('ORIG:1,TYPE'=1:1,$P($G(^OR(100,ORIG,8,1,0)),U,4)'=2:1,1:0)
"RTN","ORMPS",80,0)
 D SIGSTS^ORCSAVE2(ORIFN,1):ORSIG,SIGN^ORCSAVE2(ORIG,,,5,1):'ORSIG
"RTN","ORMPS",81,0)
 I ORDCNTRL="SN" D  ;print
"RTN","ORMPS",82,0)
 . S:ORNATR="" $P(^OR(100,ORIFN,8,1,0),U,12)="" ;CHCS/OP orders
"RTN","ORMPS",83,0)
 . S ORP(1)=ORIFN_";1"_$S(ORNATR="":"^^^^1",$G(ORL):"^1",1:"")
"RTN","ORMPS",84,0)
 . I ORP(1)["^" D PRINTS^ORWD1(.ORP,+$G(ORL))
"RTN","ORMPS",85,0)
 S ^OR(100,ORIFN,4)=PKGIFN
"RTN","ORMPS",86,0)
 Q
"RTN","ORMPS",87,0)
 ;
"RTN","ORMPS",88,0)
XX ; -- Changed (new order not necessary)
"RTN","ORMPS",89,0)
 Q:$P($G(^OR(100,+ORIFN,3)),U,3)=5  ;pending - update when finished
"RTN","ORMPS",90,0)
 I '$$CHANGED^ORMPS2 D SC Q  ;ck sts/dates only
"RTN","ORMPS",91,0)
RO ; -- Replacement order (finished)
"RTN","ORMPS",92,0)
 S:ORNATR="" ORNATR="S" D RO^ORMPS2
"RTN","ORMPS",93,0)
 Q
"RTN","ORMPS",94,0)
 ;
"RTN","ORMPS",95,0)
SC ; -- Status changed (verified, expired, suspended, renewed, reinstate)
"RTN","ORMPS",96,0)
 N OR0,OR3,ZSC,DONE S OR0=$G(^OR(100,+ORIFN,0)),OR3=$G(^(3))
"RTN","ORMPS",97,0)
 I $P(OR3,U,3)=5,ORSTS=6 D  Q:$G(DONE)
"RTN","ORMPS",98,0)
 . I $$CHANGED^ORMPS2 S ORNATR="S" D RO^ORMPS2 S DONE=1 Q
"RTN","ORMPS",99,0)
 . I $P(ZRX,"|",7)="TPN",+$P(OR0,U,11)'=$O(^ORD(100.98,"B","TPN",0)) D
"RTN","ORMPS",100,0)
 .. N DA,DR,DIE,ORDG S ORDG=+$O(^ORD(100.98,"B","TPN",0))
"RTN","ORMPS",101,0)
 .. S DA=+ORIFN,DR="23////"_ORDG,DIE="^OR(100," D ^DIE
"RTN","ORMPS",102,0)
 D DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",103,0)
 D:ORSTS STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",104,0)
 I ORSTS=$P(OR3,U,3),ORSTOP'=$P(OR0,U,9) D SETALL^ORDD100(+ORIFN) ;AC xrf
"RTN","ORMPS",105,0)
 S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",106,0)
 I "^1^13^"[(U_$P(OR3,U,3)_U),"^3^5^6^15^"[(U_ORSTS_U) D  ;reinstated
"RTN","ORMPS",107,0)
 . I $P($G(^OR(100,+ORIFN,8,+$P(OR3,U,7),0)),U,2)="DC" S ^(2)=ORNOW_U_ORWHO ; When^Who reinstated order
"RTN","ORMPS",108,0)
 . S I="?" F  S I=$O(^OR(100,+ORIFN,8,I),-1) Q:'+I  I $P(^(I,0),U,15)="" S $P(^OR(100,+ORIFN,3),U,7)=I Q  ;138 Finds current action
"RTN","ORMPS",109,0)
 . K ^OR(100,+ORIFN,6) D SETALL^ORDD100(+ORIFN)
"RTN","ORMPS",110,0)
 I $G(ORCAT)="O" S ZSC=$$ZSC^ORMPS1 I ZSC,$P(ZSC,"|",2)'?2.3U S ^OR(100,+ORIFN,5)=$TR($P(ZSC,"|",2,7),"|","^") ;1 or 0 instead of [N]SC
"RTN","ORMPS",111,0)
 Q
"RTN","ORMPS",112,0)
 ;
"RTN","ORMPS",113,0)
STATUS(X) ; -- Returns order status from HL7 code
"RTN","ORMPS",114,0)
 N Y S Y=$S(X="IP":5,X="CM":6,X="DC":1,X="ZE":7,X="HD":3,X="ZX":11,X="RP":12,X="ZZ":15,X="ZS":6,X="ZU":6,1:"")
"RTN","ORMPS",115,0)
 Q Y
"RTN","ORMPS",116,0)
 ;
"RTN","ORMPS",117,0)
DE ; -- Data Errors in SS msg
"RTN","ORMPS",118,0)
 Q
"RTN","ORMPS",119,0)
 ;
"RTN","ORMPS",120,0)
UA ; -- Unable to accept [ack]
"RTN","ORMPS",121,0)
UX ; -- Unable to change [ack]
"RTN","ORMPS",122,0)
 S:'$L(ORNATR) ORNATR="X" ;Rejected
"RTN","ORMPS",123,0)
 S ^OR(100,+ORIFN,6)=$O(^ORD(100.02,"C",ORNATR,0))_U_U_ORNOW_U_U_OREASON
"RTN","ORMPS",124,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr if pending renewal
"RTN","ORMPS",125,0)
 D STATUS^ORCSAVE2(+ORIFN,13)
"RTN","ORMPS",126,0)
UC ; -- Unable to cancel [ack]
"RTN","ORMPS",127,0)
UD ; -- Unable to discontinue [ack]
"RTN","ORMPS",128,0)
UH ; -- Unable to hold [ack]
"RTN","ORMPS",129,0)
UR ; -- Unable to release hold [ack]
"RTN","ORMPS",130,0)
 N ORDA S ORDA=+$P(ORIFN,";",2) I ORDA D
"RTN","ORMPS",131,0)
 . S $P(^OR(100,+ORIFN,8,ORDA,0),U,15)=13 ;request rejected
"RTN","ORMPS",132,0)
 . S:$L(OREASON) ^OR(100,+ORIFN,8,ORDA,1)=OREASON
"RTN","ORMPS",133,0)
 Q
"RTN","ORMPS",134,0)
 ;
"RTN","ORMPS",135,0)
OC ; -- Cancelled (prior to pharmacist's verification)
"RTN","ORMPS",136,0)
 G:ORTYPE="ORR" UA S:ORNATR="A" ORWHO=""
"RTN","ORMPS",137,0)
 S:'ORSTS ORSTS=13 S:ORSTS=12 ORNATR="S"
"RTN","ORMPS",138,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",139,0)
 I $P($G(^OR(100,+ORIFN,3)),U,11)=2 N ORIG S ORIG=$P(^(3),U,5) S:ORIG $P(^OR(100,ORIG,3),U,6)="" ;remove fwd ptr when pending renewal cancelled
"RTN","ORMPS",140,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",141,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",142,0)
 Q
"RTN","ORMPS",143,0)
 ;
"RTN","ORMPS",144,0)
CR ; -- Cancelled [ack]
"RTN","ORMPS",145,0)
 D STATUS^ORCSAVE2(+ORIFN,13) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",146,0)
 Q
"RTN","ORMPS",147,0)
 ;
"RTN","ORMPS",148,0)
OD ; -- Discontinued (cancelled after pharmacist's verification)
"RTN","ORMPS",149,0)
 S:'ORSTS ORSTS=1 S:ORSTS=12 ORNATR="C"
"RTN","ORMPS",150,0)
 I ORNATR="A" S ORWHO="" I $G(DGPMT)=3,$$MVT^DGPMOBS(DGPMDA) D XTMP^ORMEVNT ;save order#
"RTN","ORMPS",151,0)
 S ^OR(100,+ORIFN,6)=$S($L(ORNATR):$O(^ORD(100.02,"C",ORNATR,0)),1:"")_U_ORWHO_U_ORNOW_U_U_OREASON
"RTN","ORMPS",152,0)
 S ^OR(100,+ORIFN,4)=PKGIFN S:ORSTOP>ORNOW ORSTOP=ORNOW
"RTN","ORMPS",153,0)
 D UPDATE(ORSTS,"DC")
"RTN","ORMPS",154,0)
 Q
"RTN","ORMPS",155,0)
 ;
"RTN","ORMPS",156,0)
DR ; -- Discontinued [ack]
"RTN","ORMPS",157,0)
 D STATUS^ORCSAVE2(+ORIFN,1) S ^OR(100,+ORIFN,4)=PKGIFN
"RTN","ORMPS",158,0)
 Q
"RTN","ORMPS",159,0)
 ;
"RTN","ORMPS",160,0)
OH ; -- Held
"RTN","ORMPS",161,0)
 S:'ORSTS ORSTS=3 D UPDATE(ORSTS,"HD")
"RTN","ORMPS",162,0)
 Q
"RTN","ORMPS",163,0)
 ;
"RTN","ORMPS",164,0)
HR ; -- Held [ack]
"RTN","ORMPS",165,0)
 D STATUS^ORCSAVE2(+ORIFN,3)
"RTN","ORMPS",166,0)
 Q
"RTN","ORMPS",167,0)
 ;
"RTN","ORMPS",168,0)
RL ; -- Released hold
"RTN","ORMPS",169,0)
OE ; -- Released hold
"RTN","ORMPS",170,0)
 N ORDA S ORDA=+$P(^OR(100,+ORIFN,3),U,7)
"RTN","ORMPS",171,0)
 I $P($G(^OR(100,+ORIFN,8,ORDA,0)),U,2)="HD" S $P(^(2),U,1,2)=ORNOW_U_ORWHO
"RTN","ORMPS",172,0)
 S:'$G(ORSTS) ORSTS=6 D UPDATE(ORSTS,"RL")
"RTN","ORMPS",173,0)
 Q
"RTN","ORMPS",174,0)
 ;
"RTN","ORMPS",175,0)
OR ; -- Released / [ack]
"RTN","ORMPS",176,0)
 S:'ORSTS ORSTS=6 D STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",177,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",178,0)
 Q
"RTN","ORMPS",179,0)
 ;
"RTN","ORMPS",180,0)
UPDATE(ORSTS,ORACT) ; -- continue processing
"RTN","ORMPS",181,0)
 N ORX,ORDA,ORP D:$G(ORSTS) STATUS^ORCSAVE2(+ORIFN,ORSTS)
"RTN","ORMPS",182,0)
 D:ORSTRT!ORSTOP DATES^ORCSAVE2(+ORIFN,ORSTRT,ORSTOP)
"RTN","ORMPS",183,0)
 S ORX=$$CREATE^ORX1(ORNATR) D:ORX
"RTN","ORMPS",184,0)
 . S ORDA=$$ACTION^ORCSAVE(ORACT,+ORIFN,ORNP,OREASON,ORNOW,ORWHO)
"RTN","ORMPS",185,0)
 . I ORDA'>0 S ORERR="Cannot create new order action" Q
"RTN","ORMPS",186,0)
 . D RELEASE^ORCSAVE2(+ORIFN,ORDA,ORNOW,ORWHO,ORNATR)
"RTN","ORMPS",187,0)
 . D SIGSTS^ORCSAVE2(+ORIFN,ORDA)
"RTN","ORMPS",188,0)
 . I $G(ORL) S ORP(1)=+ORIFN_";"_ORDA_"^1" D PRINTS^ORWD1(.ORP,+ORL)
"RTN","ORMPS",189,0)
 . S $P(^OR(100,+ORIFN,3),U,7)=ORDA
"RTN","ORMPS",190,0)
 I 'ORX,ORACT="DC",'$$ACTV^ORX1(ORNATR) S $P(^OR(100,+ORIFN,3),U,7)=0
"RTN","ORMPS",191,0)
 D:$G(ORACT)="DC" CANCEL^ORCSEND(+ORIFN)
"RTN","ORMPS",192,0)
 Q
"RTN","ORMPS",193,0)
 ;
"RTN","ORMPS",194,0)
RXO() ; -- Return subscript of RXO segment
"RTN","ORMPS",195,0)
 N I,X S X="",I=$O(@ORMSG@(+ORC))
"RTN","ORMPS",196,0)
 I I,$E(@ORMSG@(I),1,3)="RXO" S X=I_U_@ORMSG@(I)
"RTN","ORMPS",197,0)
 Q X
"RTN","ORMPS",198,0)
 ;
"RTN","ORMPS",199,0)
RXE() ; -- Return subscript of RXE segment
"RTN","ORMPS",200,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",201,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXE" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",202,0)
 Q X
"RTN","ORMPS",203,0)
 ;
"RTN","ORMPS",204,0)
RXR() ; -- Return subscript of RXR segment
"RTN","ORMPS",205,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",206,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXR" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",207,0)
 Q X
"RTN","ORMPS",208,0)
 ;
"RTN","ORMPS",209,0)
RXC() ; -- Return subscript of [first] RXC segment
"RTN","ORMPS",210,0)
 N X,I,SEG S X="",I=+RXE
"RTN","ORMPS",211,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="RXC" S X=I Q
"RTN","ORMPS",212,0)
 Q X
"RTN","ORMPS",213,0)
 ;
"RTN","ORMPS",214,0)
ZRX() ; -- Return subscript of ZRX segment
"RTN","ORMPS",215,0)
 N X,I,SEG S X="",I=+ORC
"RTN","ORMPS",216,0)
 F  S I=$O(@ORMSG@(I)) Q:I'>0  S SEG=$E(@ORMSG@(I),1,3) Q:SEG="ORC"  I SEG="ZRX" S X=I_U_@ORMSG@(I) Q
"RTN","ORMPS",217,0)
 Q X
"RTN","ORQ13")
0^3^B8155120
"RTN","ORQ13",1,0)
ORQ13 ;slc/dcm-Get patient orders in context ; 08 May 2002  2:12 PM
"RTN","ORQ13",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165**;Dec 17, 1997
"RTN","ORQ13",3,0)
 ;
"RTN","ORQ13",4,0)
EN ; -- Event Delayed: 24=All Delayed orders, or
"RTN","ORQ13",5,0)
 ;     15=Admission, 16=Discharge, 17=Transfer, 25=OR, 26=Manual
"RTN","ORQ13",6,0)
 ;     or EVENT=ptr to Patient Event in #100.2
"RTN","ORQ13",7,0)
 D UNDO I $G(EVENT) D EN1 Q
"RTN","ORQ13",8,0)
 N TYPE,EVT,EVENT,IFN,X0,TM,STS
"RTN","ORQ13",9,0)
 S TYPE=$S(FLG=15:"A",FLG=16:"D",FLG=17:"T",FLG=25:"O",FLG=26:"M",1:"ADTOM")
"RTN","ORQ13",10,0)
 S EVT=0 F  S EVT=+$O(^ORE(100.2,"AE",+PAT,EVT)) Q:EVT<1  S EVENT=+$O(^(EVT,0)) D
"RTN","ORQ13",11,0)
 . Q:TYPE'[$P($G(^ORD(100.5,EVT,0)),U,2)  ;Q:$$LAPSED^OREVNTX(EVENT)
"RTN","ORQ13",12,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,EVENT,IFN)) Q:IFN<1  D ADD(IFN)
"RTN","ORQ13",13,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ13",14,0)
 Q
"RTN","ORQ13",15,0)
 ;
"RTN","ORQ13",16,0)
EN1 ; -- Delayed for EVENT [and related Pt Events]
"RTN","ORQ13",17,0)
 N DAD,CHLD S DAD=+$P($G(^ORE(100.2,EVENT,1)),U,5) ;EVENT=child
"RTN","ORQ13",18,0)
 I DAD<1,$O(^ORE(100.2,"DAD",EVENT,0)) S DAD=EVENT ;EVENT=parent
"RTN","ORQ13",19,0)
 D:DAD<1 EVNT(EVENT) I DAD D
"RTN","ORQ13",20,0)
 . D EVNT(DAD) S CHLD=0
"RTN","ORQ13",21,0)
 . F  S CHLD=+$O(^ORE(100.2,"DAD",DAD,CHLD)) Q:CHLD<1  D EVNT(CHLD)
"RTN","ORQ13",22,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ13",23,0)
 Q
"RTN","ORQ13",24,0)
 ;
"RTN","ORQ13",25,0)
EVNT(EVENT) ; -- Orders tied to EVENT in #100.2
"RTN","ORQ13",26,0)
 N DONE,IFN,I,X,ORDER
"RTN","ORQ13",27,0)
 S DONE=$G(^ORE(100.2,EVENT,1)) D:DONE  ;get released, dc'd orders
"RTN","ORQ13",28,0)
 . S I=+$O(^ORE(100.2,EVENT,10,"B"),-1),X=$P($G(^(I,0)),U,2) Q:X="LP"!(X="CA")  ;skip if lapsed or cancelled
"RTN","ORQ13",29,0)
 . S ORDER=+$P($G(^ORE(100.2,EVENT,0)),U,4) D:ORDER ADD(ORDER,"RL")
"RTN","ORQ13",30,0)
 . S IFN=0 F  S IFN=$O(^ORE(100.2,EVENT,2,IFN)) Q:IFN<1  D ADD(IFN,"RL")
"RTN","ORQ13",31,0)
 . S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,EVENT,IFN)) Q:IFN<1  I IFN'=ORDER,'$D(^ORE(100.2,EVENT,2,IFN)) D ADD(IFN,"RL")
"RTN","ORQ13",32,0)
 . S IFN=0 F  S IFN=$O(^ORE(100.2,EVENT,3,IFN)) Q:IFN<1  D ADD(IFN,"DC")
"RTN","ORQ13",33,0)
 I 'DONE S IFN=0 F  S IFN=$O(^OR(100,"AEVNT",PAT,EVENT,IFN)) Q:IFN<1  D ADD(IFN)
"RTN","ORQ13",34,0)
 Q
"RTN","ORQ13",35,0)
 ;
"RTN","ORQ13",36,0)
ADD(IFN,TYPE)        ; -- add EVENT order to list?
"RTN","ORQ13",37,0)
 N X0,X3,DA,X8,TM,CURR
"RTN","ORQ13",38,0)
 S X0=$G(^OR(100,IFN,0)),X3=$G(^(3)) Q:'$D(ORGRP(+$P(X0,U,11)))
"RTN","ORQ13",39,0)
 Q:$P(X3,U,8)  I $P(X3,U,9),'$P($G(^OR(100,$P(X3,U,9),3)),U,8) Q
"RTN","ORQ13",40,0)
 I $P(X3,U,3)=12,$P($G(^OR(100,+$P(X3,U,6),0)),U,17)=EVENT Q  ;changed
"RTN","ORQ13",41,0)
 S CURR=$P(X3,U,7) S:CURR<1 CURR=+$O(^OR(100,IFN,8,"?"),-1) ;current/last
"RTN","ORQ13",42,0)
 S DA=0 F  S DA=+$O(^OR(100,IFN,8,DA)) Q:DA<1  S X8=$G(^(DA,0)) D
"RTN","ORQ13",43,0)
 . S TM=$P(X8,U) Q:TM<SDATE  Q:TM>EDATE
"RTN","ORQ13",44,0)
 . I DA'=CURR,$P(X8,U,15)'=11 Q  ;current or unrel action
"RTN","ORQ13",45,0)
 . I DETAIL<2!'$L($G(TYPE)) D GET^ORQ12(IFN,ORLIST,DETAIL,DA) Q
"RTN","ORQ13",46,0)
 . S ORLST=ORLST+1,^TMP("ORGOTIT",$J,IFN,DA)=""
"RTN","ORQ13",47,0)
 . S ^TMP("ORR",$J,ORLIST,EVENT,TYPE,ORLST)=IFN_";"_DA
"RTN","ORQ13",48,0)
 Q
"RTN","ORQ13",49,0)
 ;
"RTN","ORQ13",50,0)
UNDO ; -- un-invert dates from ORQ1
"RTN","ORQ13",51,0)
 N X S X=EDATE,EDATE=SDATE,SDATE=X
"RTN","ORQ13",52,0)
 S SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ13",53,0)
 Q
"RTN","ORQ13",54,0)
 ;
"RTN","ORQ13",55,0)
QUIT ; -- stop
"RTN","ORQ13",56,0)
 Q
"RTN","ORY165")
0^1^B1704656
"RTN","ORY165",1,0)
ORY165 ; Export Package Level Parameters ;1/15/03  13:50
"RTN","ORY165",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**165**;Dec 17, 1997
"RTN","ORY165",3,0)
 ;
"RTN","ORY165",4,0)
MAIN ; main (initial) parameter transport routine
"RTN","ORY165",5,0)
 S ORI("OR GXMOVE EVENT")="" D EN^ORYDLG("165 Dialog",.ORI) K ORI
"RTN","ORY165",6,0)
 D ^ORY165A
"RTN","ORY165",7,0)
 K ^TMP($J,"XPARRSTR")
"RTN","ORY165",8,0)
 N ENT,IDX,ROOT,REF,VAL,I
"RTN","ORY165",9,0)
 S ROOT=$NAME(^TMP($J,"XPARRSTR")),ROOT=$E(ROOT,1,$L(ROOT)-1)_","
"RTN","ORY165",10,0)
 D LOAD
"RTN","ORY165",11,0)
XX2 S IDX=0,ENT="PKG."_"ORDER ENTRY/RESULTS REPORTING"
"RTN","ORY165",12,0)
 F  S IDX=$O(^TMP($J,"XPARRSTR",IDX)) Q:'IDX  D
"RTN","ORY165",13,0)
 . N PAR,INST,VAL,ERR
"RTN","ORY165",14,0)
 . S PAR=$P(^TMP($J,"XPARRSTR",IDX,"KEY"),U),INST=$P(^("KEY"),U,2)
"RTN","ORY165",15,0)
 . M VAL=^TMP($J,"XPARRSTR",IDX,"VAL")
"RTN","ORY165",16,0)
 . D EN^XPAR(ENT,PAR,INST,.VAL,.ERR)
"RTN","ORY165",17,0)
 K ^TMP($J,"XPARRSTR")
"RTN","ORY165",18,0)
 Q
"RTN","ORY165",19,0)
LOAD ; load data into ^TMP (expects ROOT to be defined)
"RTN","ORY165",20,0)
 S I=1 F  S REF=$T(DATA+I) Q:REF=""  S VAL=$T(DATA+I+1) D
"RTN","ORY165",21,0)
 . S I=I+2,REF=$P(REF,";",3,999),VAL=$P(VAL,";",3,999)
"RTN","ORY165",22,0)
 . S @(ROOT_REF)=VAL
"RTN","ORY165",23,0)
 Q
"RTN","ORY165",24,0)
DATA ; parameter data
"RTN","ORY165",25,0)
 ;;12333,"KEY")
"RTN","ORY165",26,0)
 ;;ORB PROVIDER RECIPIENTS^ORDERER-FLAGGED RESULTS
"RTN","ORY165",27,0)
 ;;12333,"VAL")
"RTN","ORY165",28,0)
 ;;@
"RTN","ORY165A")
0^8^B8971955
"RTN","ORY165A",1,0)
ORY165A ;SLC/DAN Clean up non-canonic dates ;12/19/02  12:01
"RTN","ORY165A",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**165**Dec 17, 1997
"RTN","ORY165A",3,0)
 ;DBIA Section
"RTN","ORY165A",4,0)
 ;10018 - DIE Call
"RTN","ORY165A",5,0)
 ;10063 - %ZTLOAD Call
"RTN","ORY165A",6,0)
 ;10141 - XPDUTL Call
"RTN","ORY165A",7,0)
 ;10070 - XMD Call
"RTN","ORY165A",8,0)
 ;This routine will find all order date/time entries that
"RTN","ORY165A",9,0)
 ;are non-canonical and enter them in canonic form.
"RTN","ORY165A",10,0)
 N ORI,DA,ORMSG
"RTN","ORY165A",11,0)
 S ORMSG(1)="A task is being queued in the background to identify"
"RTN","ORY165A",12,0)
 S ORMSG(2)="any orders whose START DATE/TIME or STOP DATE/TIME field is a non-canonic"
"RTN","ORY165A",13,0)
 S ORMSG(3)="number (having trailing zeros)."
"RTN","ORY165A",14,0)
 S ORMSG(4)=""
"RTN","ORY165A",15,0)
 S ORMSG(5)="These entries will be set to the correct canonic form"
"RTN","ORY165A",16,0)
 S ORMSG(6)="by the background job and a mail message will be sent"
"RTN","ORY165A",17,0)
 S ORMSG(7)="to the initiator of this patch at completion."
"RTN","ORY165A",18,0)
 S ORMSG(8)=""
"RTN","ORY165A",19,0)
 S ZTRTN="DQ^ORY165A",ZTIO="",ZTDESC="DATE/TIME ORDER field clean up - Patch 165",ZTDTH=$H,ZTSAVE("DUZ")="" D ^%ZTLOAD
"RTN","ORY165A",20,0)
 S ORMSG(9)="The task number is "_$G(ZTSK)
"RTN","ORY165A",21,0)
 D MES^XPDUTL(.ORMSG) I '$D(ZTQUEUED) N DIR,Y S DIR(0)="E",DIR("A")="Press return to continue installation" D ^DIR
"RTN","ORY165A",22,0)
 Q
"RTN","ORY165A",23,0)
DQ ;Start processing here
"RTN","ORY165A",24,0)
 N ORSR,ORVP,ORDG,ORI,DA
"RTN","ORY165A",25,0)
 F ORSR="AD","AE" S ORI="00" F  S ORI=$O(^OR(100,ORSR,ORI)) Q:ORI=""  I ORI'=+ORI D  ;if date/time is non-canonic then fix
"RTN","ORY165A",26,0)
 .S DA="" F  S DA=$O(^OR(100,ORSR,ORI,DA)) Q:DA=""  D:ORSR="AD" SK^ORDD100 D:ORSR="AE" EK^ORDD100A D UPDATE
"RTN","ORY165A",27,0)
 .Q
"RTN","ORY165A",28,0)
 ;Now check the AW xref, which has a different format
"RTN","ORY165A",29,0)
 S ORSR="AW"
"RTN","ORY165A",30,0)
 S ORVP="" F  S ORVP=$O(^OR(100,ORSR,ORVP)) Q:ORVP=""  S ORDG=0 F  S ORDG=$O(^OR(100,ORSR,ORVP,ORDG)) Q:'+ORDG  D
"RTN","ORY165A",31,0)
 .S ORI="00" F  S ORI=$O(^OR(100,ORSR,ORVP,ORDG,ORI)) Q:'+ORI  I ORI'=+ORI S DA=0 F  S DA=$O(^OR(100,ORSR,ORVP,ORDG,ORI,DA)) Q:'+DA  D WK^ORDD100,UPDATE
"RTN","ORY165A",32,0)
 .Q
"RTN","ORY165A",33,0)
 D MAIL ;send email notifying initiator that clean up is finished
"RTN","ORY165A",34,0)
 Q
"RTN","ORY165A",35,0)
UPDATE ;change date/time to canonic form and call DIE to reset cross references
"RTN","ORY165A",36,0)
 N DIE,DR
"RTN","ORY165A",37,0)
 S DIE="^OR(100,",DR=$S(ORSR="AD"!(ORSR="AW"):21,1:22)_"///"_+ORI
"RTN","ORY165A",38,0)
 D ^DIE
"RTN","ORY165A",39,0)
 D:ORSR="AW" WS^ORDD100 D:ORSR="AD" SS^ORDD100 D:ORSR="AE" ES^ORDD100A
"RTN","ORY165A",40,0)
 Q
"RTN","ORY165A",41,0)
MAIL ; -- Send completion message to user who initiated conversion
"RTN","ORY165A",42,0)
 N XMSUB,XMTEXT,XMDUZ,XMY,XMZ,XMMG,ORTXT
"RTN","ORY165A",43,0)
 S XMDUZ="PATCH OR*3*165 CLEAN-UP",XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","ORY165A",44,0)
 S ORTXT(1)="The START DATE/TIME and STOP DATE/TIME field clean up for patch OR*3*165"
"RTN","ORY165A",45,0)
 S ORTXT(2)="completed at "_$$FMTE^XLFDT($$NOW^XLFDT)_"."
"RTN","ORY165A",46,0)
 S XMTEXT="ORTXT(",XMSUB="PATCH OR*3*165 Clean Up COMPLETED"
"RTN","ORY165A",47,0)
 D ^XMD
"RTN","ORY165A",48,0)
 Q
"RTN","ORYDLG")
0^11^B8247584
"RTN","ORYDLG",1,0)
ORYDLG ;SLC/MKB -- Postinit bulletin for order dialogs ;1/15/03  15:45
"RTN","ORYDLG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**141,165**;Dec 17, 1997
"RTN","ORYDLG",3,0)
 ;
"RTN","ORYDLG",4,0)
EN(PATCH,ORDLG,USERS) ; -- look for local copies of ORDLG(NAME) by package,
"RTN","ORYDLG",5,0)
 ;    send list in bulletin to DUZ, POSTMASTER, USERS(DUZ) when done
"RTN","ORYDLG",6,0)
 ;
"RTN","ORYDLG",7,0)
 Q:$O(ORDLG(""))=""  ;none
"RTN","ORYDLG",8,0)
 N ORZ,ORI,X,NM,I,OR0,PKG,DG,ORPKG,ORNATL,DLG,CNT
"RTN","ORYDLG",9,0)
 S ORZ(1)="The following nationally exported order dialogs have been modified by"
"RTN","ORYDLG",10,0)
 S X="this patch:   ",ORI=1,NM="" F  S NM=$O(ORDLG(NM)) Q:NM=""  D
"RTN","ORYDLG",11,0)
 . S ORI=ORI+1,ORZ(ORI)=X_NM,X="              "
"RTN","ORYDLG",12,0)
 . S I=+$O(^ORD(101.41,"AB",NM,0)),OR0=$G(^ORD(101.41,I,0))
"RTN","ORYDLG",13,0)
 . S PKG=+$P(OR0,U,7),DG=+$P(OR0,U,5) S:PKG ORPKG(PKG,DG)=""
"RTN","ORYDLG",14,0)
 S I=0 F I=1:1 S X=$T(NATL+I) Q:X["ZZZZZ"  S ORNATL($P(X,";",3))=""
"RTN","ORYDLG",15,0)
 S ORI=ORI+1,ORZ(ORI)="Please review and compare the following locally created order dialogs"
"RTN","ORYDLG",16,0)
 S ORI=ORI+1,ORZ(ORI)="that may be copies, for any necessary changes:",CNT=0
"RTN","ORYDLG",17,0)
 S PKG=0 F  S PKG=$O(ORPKG(PKG)) Q:PKG<1  S DLG=0 D
"RTN","ORYDLG",18,0)
 . F  S DLG=+$O(^ORD(101.41,"APKG",PKG,DLG)) Q:DLG<1  D
"RTN","ORYDLG",19,0)
 .. S OR0=$G(^ORD(101.41,DLG,0))  Q:$P(OR0,U,4)'="D"
"RTN","ORYDLG",20,0)
 .. Q:'$D(ORPKG(PKG,+$P(OR0,U,5)))  ;included DispGrp
"RTN","ORYDLG",21,0)
 .. Q:$D(ORNATL($P(OR0,U)))  S CNT=CNT+1
"RTN","ORYDLG",22,0)
 .. S ORI=ORI+1,ORZ(ORI)=$J(DLG,7)_"  "_$P(OR0,U)
"RTN","ORYDLG",23,0)
EN1 I CNT>0 D  ;local copies found -> send bulletin
"RTN","ORYDLG",24,0)
 . N XMDUZ,XMY,I,XMSUB,XMTEXT,DIFROM
"RTN","ORYDLG",25,0)
 . S XMDUZ="PATCH OR*3*"_$G(PATCH)_" POSTINIT",XMY(.5)=""
"RTN","ORYDLG",26,0)
 . S:$G(DUZ) XMY(DUZ)="" S I=0 F  S I=$O(USERS(I)) Q:I<1  S XMY(I)=""
"RTN","ORYDLG",27,0)
 . S XMSUB=XMDUZ_" COMPLETED",XMTEXT="ORZ(" D ^XMD
"RTN","ORYDLG",28,0)
 . D BMES^XPDUTL("Some national order dialogs have been modified in this patch;")
"RTN","ORYDLG",29,0)
 . D MES^XPDUTL("a bulletin has been sent to the installer listing local copies that")
"RTN","ORYDLG",30,0)
 . D MES^XPDUTL("may need to be reviewed and updated.")
"RTN","ORYDLG",31,0)
 Q
"RTN","ORYDLG",32,0)
 ;
"RTN","ORYDLG",33,0)
NATL ;;Nationally exported dialogs
"RTN","ORYDLG",34,0)
 ;;FHW1
"RTN","ORYDLG",35,0)
 ;;FHW2
"RTN","ORYDLG",36,0)
 ;;FHW3
"RTN","ORYDLG",37,0)
 ;;FHW7
"RTN","ORYDLG",38,0)
 ;;FHW8
"RTN","ORYDLG",39,0)
 ;;GMRAOR ALLERGY ENTER/EDIT
"RTN","ORYDLG",40,0)
 ;;GMRCOR CONSULT
"RTN","ORYDLG",41,0)
 ;;GMRCOR REQUEST
"RTN","ORYDLG",42,0)
 ;;GMRVOR
"RTN","ORYDLG",43,0)
 ;;LR OTHER LAB TESTS
"RTN","ORYDLG",44,0)
 ;;OR GWCOND CONDITION
"RTN","ORYDLG",45,0)
 ;;OR GWDIAG DIAGNOSIS
"RTN","ORYDLG",46,0)
 ;;OR GWINST DNR
"RTN","ORYDLG",47,0)
 ;;OR GXACTV OTHER ACTIVITY ORDER
"RTN","ORYDLG",48,0)
 ;;OR GXMISC GENERAL
"RTN","ORYDLG",49,0)
 ;;OR GXMOVE ADMIT PATIENT
"RTN","ORYDLG",50,0)
 ;;OR GXMOVE DISCHARGE
"RTN","ORYDLG",51,0)
 ;;OR GXMOVE EVENT
"RTN","ORYDLG",52,0)
 ;;OR GXMOVE TRANSFER
"RTN","ORYDLG",53,0)
 ;;OR GXMOVE TREATING SPECIALTY
"RTN","ORYDLG",54,0)
 ;;OR GXPARM CALL HO ON
"RTN","ORYDLG",55,0)
 ;;OR GXSKIN DRESSING CHANGE
"RTN","ORYDLG",56,0)
 ;;OR GXTEXT TEXT ONLY ORDER
"RTN","ORYDLG",57,0)
 ;;OR GXTEXT WORD PROCESSING ORDER
"RTN","ORYDLG",58,0)
 ;;ORWD GENERIC ACTIVITY
"RTN","ORYDLG",59,0)
 ;;ORWD GENERIC DIET
"RTN","ORYDLG",60,0)
 ;;ORWD GENERIC NURSING
"RTN","ORYDLG",61,0)
 ;;ORWD GENERIC VITALS
"RTN","ORYDLG",62,0)
 ;;PS MEDS
"RTN","ORYDLG",63,0)
 ;;PSJ OR PAT OE
"RTN","ORYDLG",64,0)
 ;;PSJI OR PAT FLUID OE
"RTN","ORYDLG",65,0)
 ;;PSO OERR
"RTN","ORYDLG",66,0)
 ;;PSO SUPPLY
"RTN","ORYDLG",67,0)
 ;;RA OERR EXAM
"RTN","ORYDLG",68,0)
 ;;ZZZZZ
"UP",100.5,100.51,-1)
100.5^TS
"UP",100.5,100.51,0)
100.51
"UP",100.5,100.511,-1)
100.5^LOC
"UP",100.5,100.511,0)
100.511
"VER")
8.0^22.0
"^DD",100.5,100.5,10,0)
INCLUDED TREATING SPECIALTIES^100.51P^^TS;0
"^DD",100.5,100.5,10,21,0)
^.001^3^3^3030108^^^
"^DD",100.5,100.5,10,21,1,0)
These are treating specialties that can satisfy this event; if the
"^DD",100.5,100.5,10,21,2,0)
patient's new specialty matches one in this list then orders delayed
"^DD",100.5,100.5,10,21,3,0)
for this event may be released.
"^DD",100.5,100.5,11,0)
INCLUDED LOCATIONS^100.511P^^LOC;0
"^DD",100.5,100.5,11,21,0)
^.001^3^3^3020708^^^^
"^DD",100.5,100.5,11,21,1,0)
These are ward locations that can satisfy this event; if the patient's new
"^DD",100.5,100.5,11,21,2,0)
location matches one in this list then orders delayed for this event may
"^DD",100.5,100.5,11,21,3,0)
be released.
"^DD",100.5,100.51,0)
INCLUDED TREATING SPECIALTIES SUB-FIELD^^1^2
"^DD",100.5,100.51,0,"DT")
3030114
"^DD",100.5,100.51,0,"IX","B",100.51,.01)

"^DD",100.5,100.51,0,"IX","DEF",100.51,1)

"^DD",100.5,100.51,0,"NM","INCLUDED TREATING SPECIALTIES")

"^DD",100.5,100.51,0,"UP")
100.5
"^DD",100.5,100.51,.01,0)
INCLUDED TREATING SPECIALTIES^M*P45.7'^DIC(45.7,^0;1^S DIC("S")="I $G(^ORD(100.5,$G(DA(1),DA),1))!('$G(^ORD(100.5,$G(DA(1),DA),1))&'$$INUSE^OREV1(""TS""))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",100.5,100.51,.01,1,0)
^.1
"^DD",100.5,100.51,.01,1,1,0)
100.51^B
"^DD",100.5,100.51,.01,1,1,1)
S ^ORD(100.5,DA(1),"TS","B",$E(X,1,30),DA)=""
"^DD",100.5,100.51,.01,1,1,2)
K ^ORD(100.5,DA(1),"TS","B",$E(X,1,30),DA)
"^DD",100.5,100.51,.01,3)
Enter a treating specialty that will satisfy this event, when the patient is transferred to it.  If locations are also defined then both must be true for orders to be released.
"^DD",100.5,100.51,.01,12)
If entry is active only treating specialties that are not in use may be selected.
"^DD",100.5,100.51,.01,12.1)
S DIC("S")="I $G(^ORD(100.5,$G(DA(1),DA),1))!('$G(^ORD(100.5,$G(DA(1),DA),1))&'$$INUSE^OREV1(""TS""))"
"^DD",100.5,100.51,.01,21,0)
^^7^7^3020708^
"^DD",100.5,100.51,.01,21,1,0)
This is a treating specialty that can satisfy this event; if defined,
"^DD",100.5,100.51,.01,21,2,0)
then the patient's new specialty must match one in this list for any
"^DD",100.5,100.51,.01,21,3,0)
delayed orders to be released.  A specialty may only be included in one
"^DD",100.5,100.51,.01,21,4,0)
active delay event at a time.
"^DD",100.5,100.51,.01,21,5,0)
 
"^DD",100.5,100.51,.01,21,6,0)
If locations are also defined for this event then both the treating
"^DD",100.5,100.51,.01,21,7,0)
specialty and the location must match for orders to be released.
"^DD",100.5,100.51,.01,"DT")
3030114
"^DD",100.5,100.51,1,0)
DEFAULT^*S^1:YES;^0;2^Q
"^DD",100.5,100.51,1,1,0)
^.1
"^DD",100.5,100.51,1,1,1,0)
100.51^DEF
"^DD",100.5,100.51,1,1,1,1)
S ^ORD(100.5,DA(1),"TS","DEF",$E(X,1,30),DA)=""
"^DD",100.5,100.51,1,1,1,2)
K ^ORD(100.5,DA(1),"TS","DEF",$E(X,1,30),DA)
"^DD",100.5,100.51,1,1,1,"%D",0)
^^1^1^3020911^
"^DD",100.5,100.51,1,1,1,"%D",1,0)
This field identifies which treating specialty should be the "default"
"^DD",100.5,100.51,1,1,1,"DT")
3020911
"^DD",100.5,100.51,1,3)
If you set a default treating specialty then this value will be stuffed in at the treating specialty prompt when using the OR GXMOVE EVENT dialog.
"^DD",100.5,100.51,1,4)
D DEFHELP^OREV3
"^DD",100.5,100.51,1,12)
Only one default treating specialty may be defined for each release event.
"^DD",100.5,100.51,1,12.1)
S DIC("S")="I '$D(^ORD(100.5,DA(1),""TS"",""DEF""))"
"^DD",100.5,100.51,1,"DT")
3020911
"^DD",100.5,100.511,0)
INCLUDED LOCATIONS SUB-FIELD^^.01^1
"^DD",100.5,100.511,0,"DT")
3030114
"^DD",100.5,100.511,0,"IX","B",100.511,.01)

"^DD",100.5,100.511,0,"NM","INCLUDED LOCATIONS")

"^DD",100.5,100.511,0,"UP")
100.5
"^DD",100.5,100.511,.01,0)
INCLUDED LOCATIONS^M*P42'^DIC(42,^0;1^S DIC("S")="I $G(^ORD(100.5,$G(DA(1),DA),1))!('$G(^ORD(100.5,$G(DA(1),DA),1))&'$$INUSE^OREV1(""LOC""))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",100.5,100.511,.01,1,0)
^.1
"^DD",100.5,100.511,.01,1,1,0)
100.511^B
"^DD",100.5,100.511,.01,1,1,1)
S ^ORD(100.5,DA(1),"LOC","B",$E(X,1,30),DA)=""
"^DD",100.5,100.511,.01,1,1,2)
K ^ORD(100.5,DA(1),"LOC","B",$E(X,1,30),DA)
"^DD",100.5,100.511,.01,3)
Enter a location that will satisfy this event, when the patient is transferred to it.  If treating specialties are also defined then both must be true for orders to release.
"^DD",100.5,100.511,.01,12)
If this entry is active you may only pick locations that aren't currently in use.
"^DD",100.5,100.511,.01,12.1)
S DIC("S")="I $G(^ORD(100.5,$G(DA(1),DA),1))!('$G(^ORD(100.5,$G(DA(1),DA),1))&'$$INUSE^OREV1(""LOC""))"
"^DD",100.5,100.511,.01,21,0)
^.001^8^8^3030114^^
"^DD",100.5,100.511,.01,21,1,0)
This is a ward location that can satisfy this event; if defined, then
"^DD",100.5,100.511,.01,21,2,0)
the patient's new location must match one in this list for any delayed
"^DD",100.5,100.511,.01,21,3,0)
orders to be released.  A location may only be included in one active
"^DD",100.5,100.511,.01,21,4,0)
delay event at a time.
"^DD",100.5,100.511,.01,21,5,0)
 
"^DD",100.5,100.511,.01,21,6,0)
If this event also has treating specialties defined then both the
"^DD",100.5,100.511,.01,21,7,0)
location and the treating specialty must match for orders to be
"^DD",100.5,100.511,.01,21,8,0)
released.
"^DD",100.5,100.511,.01,"DT")
3030114
"^DD",101.41,101.41,0)
FIELD^^99^30
"^DD",101.41,101.41,0,"DDA")
N
"^DD",101.41,101.41,0,"DT")
2990225
"^DD",101.41,101.41,0,"IX","AB",101.41,.01)

"^DD",101.41,101.41,0,"IX","AD",101.412,2)

"^DD",101.41,101.41,0,"IX","AM",101.41,99)

"^DD",101.41,101.41,0,"IX","AM2",101.41,2)

"^DD",101.41,101.41,0,"IX","AM51",101.41,51)

"^DD",101.41,101.41,0,"IX","AM52",101.41,52)

"^DD",101.41,101.41,0,"IX","AMM",101.412,.01)

"^DD",101.41,101.41,0,"IX","AMM2",101.412,2)

"^DD",101.41,101.41,0,"IX","AMM3",101.412,3)

"^DD",101.41,101.41,0,"IX","AMM4",101.412,4)

"^DD",101.41,101.41,0,"IX","AMM5",101.412,5)

"^DD",101.41,101.41,0,"IX","APKG",101.41,7)

"^DD",101.41,101.41,0,"IX","B",101.41,.01)

"^DD",101.41,101.41,0,"IX","C",101.41,2)

"^DD",101.41,101.41,0,"NM","ORDER DIALOG")

"^DD",101.41,101.41,0,"PT",100,2)

"^DD",101.41,101.41,0,"PT",100,7)

"^DD",101.41,101.41,0,"PT",100.045,.02)

"^DD",101.41,101.41,0,"PT",100.5,4)

"^DD",101.41,101.41,0,"PT",100.5,5)

"^DD",101.41,101.41,0,"PT",100.98,4)

"^DD",101.41,101.41,0,"PT",101.412,1)

"^DD",101.41,101.41,0,"PT",101.412,2)

"^DD",101.41,101.41,0,"PT",101.415,2)

"^DD",101.41,101.41,0,"PT",101.416,.02)

"^DD",101.41,101.41,0,"PT",101.441,.01)

"^DD",101.41,101.41,0,"PT",801.41,15)

"^DD",101.41,101.41,0,"PT",801.41,18)

"^DD",101.41,101.41,0,"PT",801.4118,.01)

"^DD",101.41,101.41,0,"VRPK")
ORDER ENTRY/RESULTS REPORTING
"^DD",101.41,101.41,.01,0)
NAME^RF^^0;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>63!($L(X)<3)!'(X'?1P.E) X
"^DD",101.41,101.41,.01,1,0)
^.1
"^DD",101.41,101.41,.01,1,1,0)
101.41^B
"^DD",101.41,101.41,.01,1,1,1)
S ^ORD(101.41,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.41,.01,1,1,2)
K ^ORD(101.41,"B",$E(X,1,30),DA)
"^DD",101.41,101.41,.01,1,2,0)
101.41^AB
"^DD",101.41,101.41,.01,1,2,1)
S ^ORD(101.41,"AB",$E(X,1,63),DA)=""
"^DD",101.41,101.41,.01,1,2,2)
K ^ORD(101.41,"AB",$E(X,1,63),DA)
"^DD",101.41,101.41,.01,1,2,"%D",0)
^^1^1^2971020^
"^DD",101.41,101.41,.01,1,2,"%D",1,0)
This is a regular index on the full 63 characters of the Name field.
"^DD",101.41,101.41,.01,1,2,"DT")
2971020
"^DD",101.41,101.41,.01,3)
Answer must be 3-63 characters in length.
"^DD",101.41,101.41,.01,21,0)
^.001^3^3^3020110^^^^
"^DD",101.41,101.41,.01,21,1,0)
This is the name of the dialog; entries that were converted from the
"^DD",101.41,101.41,.01,21,2,0)
Protocol file will retain the same name.  Namespacing is not required,
"^DD",101.41,101.41,.01,21,3,0)
but still encouraged.
"^DD",101.41,101.41,.01,"DT")
2971020
"^DD",101.41,101.41,2,0)
DISPLAY TEXT^FX^^0;2^K:$L(X)>80!($L(X)<3)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.41,2,1,0)
^.1
"^DD",101.41,101.41,2,1,1,0)
101.41^C
"^DD",101.41,101.41,2,1,1,1)
S ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)=""
"^DD",101.41,101.41,2,1,1,2)
K ^ORD(101.41,"C",$$UP^XLFSTR($E(X,1,63)),DA)
"^DD",101.41,101.41,2,1,1,"DT")
2950112
"^DD",101.41,101.41,2,1,2,0)
101.41^AM2^MUMPS
"^DD",101.41,101.41,2,1,2,1)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,2)
D REDOM^ORDD41
"^DD",101.41,101.41,2,1,2,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,2,1,2,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.41,2,1,2,"DT")
2990210
"^DD",101.41,101.41,2,3)
Answer must be 3-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=). 
"^DD",101.41,101.41,2,21,0)
^.001^1^1^3010913^^^^
"^DD",101.41,101.41,2,21,1,0)
The text of this dialog's name as it appears on a menu or subheader.
"^DD",101.41,101.41,2,"DT")
3000823
"^DD",101.41,101.41,3,0)
DISABLE^F^^0;3^K:$L(X)>40!($L(X)<1) X
"^DD",101.41,101.41,3,3)
Enter a message here to disable this dialog, 1-40 characters in length.
"^DD",101.41,101.41,3,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,3,21,1,0)
This field disables use of this dialog when it contains text.  The text
"^DD",101.41,101.41,3,21,2,0)
should be a short message explaining why use of this dialog has been
"^DD",101.41,101.41,3,21,3,0)
disabled, as it will be displayed if this dialog is selected.
"^DD",101.41,101.41,3,"DT")
2950112
"^DD",101.41,101.41,4,0)
TYPE^RS^P:prompt;D:dialog;Q:quick order;O:order set;M:menu;A:action;^0;4^Q
"^DD",101.41,101.41,4,3)
Specify a type for this dialog.
"^DD",101.41,101.41,4,21,0)
^^5^5^2950716^^^^
"^DD",101.41,101.41,4,21,1,0)
This field defines the type of order dialog to be processed.  Control
"^DD",101.41,101.41,4,21,2,0)
will be passed to the OE/RR Dialog Processor for dialog items; menu types
"^DD",101.41,101.41,4,21,3,0)
are used for displaying and selecting dialog items.  Action types will only
"^DD",101.41,101.41,4,21,4,0)
execute the entry and exit actions, ignoring any items that may exist; these
"^DD",101.41,101.41,4,21,5,0)
dialogs should not create entries in the Orders file.
"^DD",101.41,101.41,4,"DT")
2950716
"^DD",101.41,101.41,5,0)
DISPLAY GROUP^P100.98'^ORD(100.98,^0;5^Q
"^DD",101.41,101.41,5,3)
Enter the display group containing orderable items defined by this dialog.
"^DD",101.41,101.41,5,21,0)
^^3^3^2950112^
"^DD",101.41,101.41,5,21,1,0)
This field determines what display group this dialog has been defined for.
"^DD",101.41,101.41,5,21,2,0)
It will define which orderable items are selectable with this dialog,
"^DD",101.41,101.41,5,21,3,0)
as well as what service to send the order to when it is complete.
"^DD",101.41,101.41,5,"DT")
2950112
"^DD",101.41,101.41,6,0)
SIGNATURE REQUIRED^S^0:NONE;1:ORELSE;2:ORES;^0;6^Q
"^DD",101.41,101.41,6,3)
Enter the OR key required to sign orders created by this dialog
"^DD",101.41,101.41,6,21,0)
^^6^6^2970318^^
"^DD",101.41,101.41,6,21,1,0)
This field indicates what signature will be required for orders created by
"^DD",101.41,101.41,6,21,2,0)
this dialog, to be considered complete and ready to release to the service
"^DD",101.41,101.41,6,21,3,0)
for action.  If this flag is set to NO and the dialog contains a prompt
"^DD",101.41,101.41,6,21,4,0)
for item(s) from the Orderable Item file, the order created may still
"^DD",101.41,101.41,6,21,5,0)
require a signature if any of the items ordered are individually flagged
"^DD",101.41,101.41,6,21,6,0)
as requiring a signature.
"^DD",101.41,101.41,6,"DT")
2970318
"^DD",101.41,101.41,7,0)
PACKAGE^P9.4'^DIC(9.4,^0;7^Q
"^DD",101.41,101.41,7,1,0)
^.1
"^DD",101.41,101.41,7,1,1,0)
101.41^APKG
"^DD",101.41,101.41,7,1,1,1)
S ^ORD(101.41,"APKG",$E(X,1,30),DA)=""
"^DD",101.41,101.41,7,1,1,2)
K ^ORD(101.41,"APKG",$E(X,1,30),DA)
"^DD",101.41,101.41,7,1,1,"DT")
2970325
"^DD",101.41,101.41,7,3)
Enter the VISTA package that is to receive orders created by this dialog.
"^DD",101.41,101.41,7,21,0)
^^3^3^2950208^
"^DD",101.41,101.41,7,21,1,0)
This is the VISTA package that is intended to receive orders created by
"^DD",101.41,101.41,7,21,2,0)
this dialog; this is required for creating the HL7 messages to pass the
"^DD",101.41,101.41,7,21,3,0)
order.
"^DD",101.41,101.41,7,"DT")
2970325
"^DD",101.41,101.41,8,0)
VERIFY ORDER^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.41,8,3)
Enter YES to have orders created by this dialog presented to the user before saving, with the opportunity to edit.
"^DD",101.41,101.41,8,21,0)
^^3^3^2950623^
"^DD",101.41,101.41,8,21,1,0)
This field is a flag, which determines if the order created by this dialog
"^DD",101.41,101.41,8,21,2,0)
will be presented to the user for verification before saving in the Orders
"^DD",101.41,101.41,8,21,3,0)
file; for most quick orders, this flag should be set to 0 (no).
"^DD",101.41,101.41,8,"DT")
2950623
"^DD",101.41,101.41,9,0)
ASK FOR ANOTHER ORDER^S^0:NO;1:YES;2:YES-DON'T ASK;^0;9^Q
"^DD",101.41,101.41,9,3)
Enter YES to have the user asked to enter another order from this dialog before exiting.
"^DD",101.41,101.41,9,21,0)
^^6^6^2970616^^^
"^DD",101.41,101.41,9,21,1,0)
This field allows the user to add another order from this dialog, when the
"^DD",101.41,101.41,9,21,2,0)
initial order is accepted and placed; if set to YES, the user will be
"^DD",101.41,101.41,9,21,3,0)
asked "Add another <dialog display text> order?" to allow for either
"^DD",101.41,101.41,9,21,4,0)
exiting the processor or adding an additional order of the same type.
"^DD",101.41,101.41,9,21,5,0)
This field can also be set to YES-DON'T ASK to force the processor to
"^DD",101.41,101.41,9,21,6,0)
automatically drop into prompting for another order without asking first.
"^DD",101.41,101.41,9,"DT")
2970616
"^DD",101.41,101.41,10,0)
ITEMS^101.412IA^^10;0
"^DD",101.41,101.41,10,21,0)
^.001^5^5^3000822^^^^
"^DD",101.41,101.41,10,21,1,0)
This field contains the components for dialogs:
"^DD",101.41,101.41,10,21,2,0)
     Dialogs      -> prompts
"^DD",101.41,101.41,10,21,3,0)
     Quick orders -> prompts (completed)
"^DD",101.41,101.41,10,21,4,0)
     Order sets   -> dialogs or quick orders
"^DD",101.41,101.41,10,21,5,0)
     Menus        -> dialogs, quick orders, or order sets
"^DD",101.41,101.41,11,0)
DATA TYPE^S^D:date/time;R:free text date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;^1;1^Q
"^DD",101.41,101.41,11,3)
Enter the type of data to be collected at this prompt.
"^DD",101.41,101.41,11,21,0)
^^2^2^2950823^^
"^DD",101.41,101.41,11,21,1,0)
This is the type of data being prompted for; this field is used to define
"^DD",101.41,101.41,11,21,2,0)
a call to the reader (^DIR) in most cases.
"^DD",101.41,101.41,11,23,0)
^^1^1^2950823^^
"^DD",101.41,101.41,11,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,11,"DT")
2950407
"^DD",101.41,101.41,12,0)
DOMAIN^F^^1;2^K:$L(X)>235!($L(X)<1) X
"^DD",101.41,101.41,12,3)
Answer must be 1-235 characters in length.
"^DD",101.41,101.41,12,21,0)
^^3^3^2990225^^^^
"^DD",101.41,101.41,12,21,1,0)
This is a parameter that may be used to further specify the data type.
"^DD",101.41,101.41,12,21,2,0)
The string stored here should be appropriate for the second ^-piece of
"^DD",101.41,101.41,12,21,3,0)
DIR(0) when used with the data type field.
"^DD",101.41,101.41,12,23,0)
^^1^1^2990225^^^^
"^DD",101.41,101.41,12,23,1,0)
Used with Prompt-type only.
"^DD",101.41,101.41,12,"DT")
2990225
"^DD",101.41,101.41,13,0)
ID^F^^1;3^K:$L(X)>10!($L(X)<2) X
"^DD",101.41,101.41,13,3)
Answer must be 2-10 characters in length.
"^DD",101.41,101.41,13,21,0)
^.001^20^20^3010727^^
"^DD",101.41,101.41,13,21,1,0)
This field may contain a single word identifier which will be
"^DD",101.41,101.41,13,21,2,0)
stored with the user response in the Orders file #100, where it
"^DD",101.41,101.41,13,21,3,0)
will be indexed for quick reference to certain values in the
"^DD",101.41,101.41,13,21,4,0)
order dialog.  The following are some examples of values
"^DD",101.41,101.41,13,21,5,0)
currently in use:
"^DD",101.41,101.41,13,21,6,0)
 
"^DD",101.41,101.41,13,21,7,0)
   START      -> Start date/time
"^DD",101.41,101.41,13,21,8,0)
   STOP       -> Stop date/time
"^DD",101.41,101.41,13,21,9,0)
   SCHEDULE   -> Administration Schedule
"^DD",101.41,101.41,13,21,10,0)
   ORDERABLE  -> Orderable Item
"^DD",101.41,101.41,13,21,11,0)
   DRUG       -> Dispense Drug
"^DD",101.41,101.41,13,21,12,0)
   CANCEL     -> Cancel Future Orders flag
"^DD",101.41,101.41,13,21,13,0)
   COMMENT    -> Word processing comments
"^DD",101.41,101.41,13,21,14,0)
 
"^DD",101.41,101.41,13,21,15,0)
These values must be unique among entries within an order dialog
"^DD",101.41,101.41,13,21,16,0)
but do not need to be unique across the entire file.  Be sure to
"^DD",101.41,101.41,13,21,17,0)
check the IDs assigned to generic text entries to make sure that
"^DD",101.41,101.41,13,21,18,0)
all IDs are unique.  In order to avoid potential problems it's
"^DD",101.41,101.41,13,21,19,0)
recommended that you use unique IDs for any local entries that you
"^DD",101.41,101.41,13,21,20,0)
create.
"^DD",101.41,101.41,13,"DT")
2960215
"^DD",101.41,101.41,17,0)
VALIDATION^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,17,9)
@
"^DD",101.41,101.41,17,21,0)
^^3^3^2960912^
"^DD",101.41,101.41,17,21,1,0)
This is MUMPS code that will be executed at the time of releasing an
"^DD",101.41,101.41,17,21,2,0)
order created with this dialog; dialog responses may be checked again
"^DD",101.41,101.41,17,21,3,0)
here before releasing the order to the service.
"^DD",101.41,101.41,17,"DT")
2960912
"^DD",101.41,101.41,19,0)
ADDITIONAL TEXT^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,19,9)
@
"^DD",101.41,101.41,19,21,0)
^^3^3^2960405^^
"^DD",101.41,101.41,19,21,1,0)
This is MUMPS code that will be executed when order ORIFN created by this
"^DD",101.41,101.41,19,21,2,0)
dialog is about to be displayed; any string that should be appended to the
"^DD",101.41,101.41,19,21,3,0)
order text should be returned in Y.
"^DD",101.41,101.41,19,"DT")
2960405
"^DD",101.41,101.41,20,0)
DESCRIPTION^101.411^^2;0
"^DD",101.41,101.41,20,21,0)
^^1^1^2990726^^
"^DD",101.41,101.41,20,21,1,0)
This is a description of the dialog and its uses.
"^DD",101.41,101.41,21,0)
RESPONSES^101.416^^6;0
"^DD",101.41,101.41,21,21,0)
^^2^2^2971219^
"^DD",101.41,101.41,21,21,1,0)
This multiple contains any responses to prompts that have been pre-answered
"^DD",101.41,101.41,21,21,2,0)
to create a quick order.
"^DD",101.41,101.41,30,0)
ENTRY ACTION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,30,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,30,9)
@
"^DD",101.41,101.41,30,21,0)
^^4^4^2950425^
"^DD",101.41,101.41,30,21,1,0)
This is MUMPS code that will be executed at the top of a dialog, prior to
"^DD",101.41,101.41,30,21,2,0)
the execution of any prompts; it may perform functions such as listing
"^DD",101.41,101.41,30,21,3,0)
the recent Radiology exams before ordering a new one, or alerting the
"^DD",101.41,101.41,30,21,4,0)
user to an existing diet order before making a change.
"^DD",101.41,101.41,30,"DT")
2950425
"^DD",101.41,101.41,31,0)
QUICK SETUP^K^^3.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,31,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,31,9)
@
"^DD",101.41,101.41,31,21,0)
^^3^3^2970113^
"^DD",101.41,101.41,31,21,1,0)
This is MUMPS code that will be executed in the place of the Entry Action
"^DD",101.41,101.41,31,21,2,0)
when creating quick orders for this dialog; variables may be set here
"^DD",101.41,101.41,31,21,3,0)
instead to bypass the usual dependence on specific patient values.
"^DD",101.41,101.41,31,"DT")
2970113
"^DD",101.41,101.41,40,0)
EXIT ACTION^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.41,40,3)
This is Standard MUMPS code.
"^DD",101.41,101.41,40,9)
@
"^DD",101.41,101.41,40,21,0)
^^2^2^2950622^
"^DD",101.41,101.41,40,21,1,0)
This is MUMPS code that will be executed upon completion of processing the
"^DD",101.41,101.41,40,21,2,0)
dialog; it is currently used only with dialog-type entries.
"^DD",101.41,101.41,40,"DT")
2950622
"^DD",101.41,101.41,50,0)
CONTROLS^101.415A^^50;0
"^DD",101.41,101.41,51,0)
COLUMN WIDTH^NJ3,0^^5;1^K:+X'=X!(X>240)!(X<20)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,51,1,0)
^.1
"^DD",101.41,101.41,51,1,1,0)
101.41^AM51^MUMPS
"^DD",101.41,101.41,51,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,51,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,51,1,1,"%D",1,0)
Update TIMESTAMP whenever COLUMN WIDTH is changed.
"^DD",101.41,101.41,51,1,1,"DT")
2990210
"^DD",101.41,101.41,51,3)
Type a Number between 20 and 240, 0 Decimal Digits
"^DD",101.41,101.41,51,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,51,21,1,0)
This is the width, in characters, for each column in a menu.  For example,
"^DD",101.41,101.41,51,21,2,0)
to have 3 columns on an 80 character device, enter a width of 26.
"^DD",101.41,101.41,51,"DT")
2990210
"^DD",101.41,101.41,52,0)
MNEMONIC WIDTH^NJ1,0^^5;2^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,52,1,0)
^.1
"^DD",101.41,101.41,52,1,1,0)
101.41^AM52^MUMPS
"^DD",101.41,101.41,52,1,1,1)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,2)
D REDO^ORDD41
"^DD",101.41,101.41,52,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.41,52,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC WIDTH is changed.
"^DD",101.41,101.41,52,1,1,"DT")
2990210
"^DD",101.41,101.41,52,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",101.41,101.41,52,21,0)
^^2^2^2950623^
"^DD",101.41,101.41,52,21,1,0)
This field allows the width of item mnemonics to be varied; the default
"^DD",101.41,101.41,52,21,2,0)
value is 5.
"^DD",101.41,101.41,52,"DT")
2990210
"^DD",101.41,101.41,53,0)
PATH SWITCH^S^1:YES;0:NO;^5;3^Q
"^DD",101.41,101.41,53,3)
Enter YES if this menu should be redisplayed when traversing back up the menu tree.
"^DD",101.41,101.41,53,21,0)
^^5^5^2950623^
"^DD",101.41,101.41,53,21,1,0)
This switch allows the user, when traversing back UP the tree of menus and
"^DD",101.41,101.41,53,21,2,0)
items, to select a new path back down the tree.  In other words, the menu
"^DD",101.41,101.41,53,21,3,0)
is redisplayed when returning to that menu's level in the tree and
"^DD",101.41,101.41,53,21,4,0)
processing back down the tree is possible from that point.  If nothing is
"^DD",101.41,101.41,53,21,5,0)
selected from the menu, the path continues back up the tree.
"^DD",101.41,101.41,53,"DT")
2950623
"^DD",101.41,101.41,54,0)
LISTBOX TEXT^F^^5;4^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.41,54,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.41,54,"DT")
2960524
"^DD",101.41,101.41,55,0)
WINDOW FORM ID^NJ4,0^^5;5^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.41,55,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",101.41,101.41,55,21,0)
^.001^23^23^3010727^^
"^DD",101.41,101.41,55,21,1,0)
This field tells the GUI DELPHI code which form to use to process the
"^DD",101.41,101.41,55,21,2,0)
order dialog.  Each number represents a unique form.  Following are some
"^DD",101.41,101.41,55,21,3,0)
of the more common codes and their corresponding form in DELPHI.
"^DD",101.41,101.41,55,21,4,0)
 
"^DD",101.41,101.41,55,21,5,0)
    Form Name     Windows Form ID
"^DD",101.41,101.41,55,21,6,0)
    ---------     ---------------
"^DD",101.41,101.41,55,21,7,0)
  OD_ACTIVITY           100
"^DD",101.41,101.41,55,21,8,0)
  OD_ALLERGY            105
"^DD",101.41,101.41,55,21,9,0)
  OD_CONSULT            110
"^DD",101.41,101.41,55,21,10,0)
  OD_PROCEDURE          112
"^DD",101.41,101.41,55,21,11,0)
  OD_DIET_TXT           115
"^DD",101.41,101.41,55,21,12,0)
  OD_DIET               117
"^DD",101.41,101.41,55,21,13,0)
  OD_LAB                120
"^DD",101.41,101.41,55,21,14,0)
  OD_MEDINPT            130
"^DD",101.41,101.41,55,21,15,0)
  OD_MEDS               135
"^DD",101.41,101.41,55,21,16,0)
  OD_MEDOUTPT           140
"^DD",101.41,101.41,55,21,17,0)
  OD_NURSING            150
"^DD",101.41,101.41,55,21,18,0)
  OD_MISC               151
"^DD",101.41,101.41,55,21,19,0)
  OD_GENERIC            152
"^DD",101.41,101.41,55,21,20,0)
  OD_IMAGING            160
"^DD",101.41,101.41,55,21,21,0)
  OD_VITALS             171 
"^DD",101.41,101.41,55,21,22,0)
  OD_MEDIV              180
"^DD",101.41,101.41,55,21,23,0)
  OD_TEXTONLY           999
"^DD",101.41,101.41,55,"DT")
2960804
"^DD",101.41,101.41,56,0)
CREATE PARENT ORDER^S^1:YES;0:NO;^5;6^Q
"^DD",101.41,101.41,56,3)
Enter YES if a parent order should be created for this order set
"^DD",101.41,101.41,56,21,0)
^^6^6^2970227^
"^DD",101.41,101.41,56,21,1,0)
This flag indicates whether a parent order should be created to group
"^DD",101.41,101.41,56,21,2,0)
together all the orders created by this order set; this flag is only
"^DD",101.41,101.41,56,21,3,0)
valid with SET type order dialogs.  If this value is YES, a parent
"^DD",101.41,101.41,56,21,4,0)
order will be created, and only the parent will be presented on the
"^DD",101.41,101.41,56,21,5,0)
orders list for display and action; NO will prevent a parent from being
"^DD",101.41,101.41,56,21,6,0)
created and all orders will be created and displayed independently.
"^DD",101.41,101.41,56,"DT")
2970227
"^DD",101.41,101.41,57,0)
DISPLAY SUBHEADER^S^1:YES;0:NO;^5;7^Q
"^DD",101.41,101.41,57,3)
Enter YES if a subheader should be displayed as each order in this set is processed
"^DD",101.41,101.41,57,21,0)
^^3^3^2970227^
"^DD",101.41,101.41,57,21,1,0)
This flag indicates whether a subheader is to be displayed for each order
"^DD",101.41,101.41,57,21,2,0)
in this set as it is processed and placed; this flag is only valid with
"^DD",101.41,101.41,57,21,3,0)
SET type order dialogs.
"^DD",101.41,101.41,57,"DT")
2970227
"^DD",101.41,101.41,58,0)
AUTO-ACCEPT QUICK ORDER^S^1:YES;^5;8^Q
"^DD",101.41,101.41,58,3)
Enter 'Yes' if the order should be placed without displaying the dialog window.
"^DD",101.41,101.41,58,21,0)
^^2^2^2980902^
"^DD",101.41,101.41,58,21,1,0)
This can be set to yes for a quick order so that it can be placed simply
"^DD",101.41,101.41,58,21,2,0)
by clicking on it in the GUI (no ordering dialog is displayed).
"^DD",101.41,101.41,58,"DT")
2980902
"^DD",101.41,101.41,99,0)
TIMESTAMP^F^^99;1^K:$L(X)>15!($L(X)<1) X
"^DD",101.41,101.41,99,1,0)
^.1
"^DD",101.41,101.41,99,1,1,0)
101.41^AM^MUMPS
"^DD",101.41,101.41,99,1,1,1)
D SET^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,2)
D KILL^ORDD41(DA)
"^DD",101.41,101.41,99,1,1,"%D",0)
^^2^2^2990210^
"^DD",101.41,101.41,99,1,1,"%D",1,0)
Recompiles order dialog menus in ^XUTL("XQORM",<dialog#>_";ORD(101.41,")
"^DD",101.41,101.41,99,1,1,"%D",2,0)
whenever fields necessary to displaying the menu are changed.
"^DD",101.41,101.41,99,1,1,"DT")
2990210
"^DD",101.41,101.41,99,3)
Answer must be 1-15 characters in length.
"^DD",101.41,101.41,99,21,0)
^^2^2^2980501^
"^DD",101.41,101.41,99,21,1,0)
For menus, this contains the $H time the menu was last compiled for use
"^DD",101.41,101.41,99,21,2,0)
with the Unwinder utility (^XQOR).
"^DD",101.41,101.41,99,"DT")
2990210
"^DD",101.41,101.411,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",101.41,101.411,0,"DT")
2950407
"^DD",101.41,101.411,0,"NM","DESCRIPTION")

"^DD",101.41,101.411,0,"UP")
101.41
"^DD",101.41,101.411,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",101.41,101.411,.01,3)
Enter a description of this dialog.
"^DD",101.41,101.411,.01,21,0)
^^1^1^2950425^^
"^DD",101.41,101.411,.01,21,1,0)
This field contains a description of the content and use of this dialog.
"^DD",101.41,101.411,.01,"DT")
2950407
"^DD",101.41,101.412,0)
ITEMS SUB-FIELD^^117^37
"^DD",101.41,101.412,0,"DT")
2971117
"^DD",101.41,101.412,0,"ID","WRITE")
N OR0,ORNM S OR0=^(0) I $P(OR0,U,2) S ORNM=$P($G(^ORD(101.41,+$P(OR0,U,2),0)),U) D:$L(ORNM) EN^DDIOL(ORNM,,"?10")
"^DD",101.41,101.412,0,"IX","ATXT",101.412,21)

"^DD",101.41,101.412,0,"IX","B",101.412,.01)

"^DD",101.41,101.412,0,"IX","D",101.412,2)

"^DD",101.41,101.412,0,"IX","DAD",101.412,1)

"^DD",101.41,101.412,0,"IX","DAD1",101.412,.01)

"^DD",101.41,101.412,0,"NM","ITEMS")

"^DD",101.41,101.412,0,"UP")
101.41
"^DD",101.41,101.412,.01,0)
SEQUENCE^MNJ5,1^^0;1^K:+X'=X!(X>999.9)!(X<.1)!(X?.E1"."2N.N) X
"^DD",101.41,101.412,.01,1,0)
^.1
"^DD",101.41,101.412,.01,1,1,0)
101.412^B
"^DD",101.41,101.412,.01,1,1,1)
S ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.412,.01,1,1,2)
K ^ORD(101.41,DA(1),10,"B",$E(X,1,30),DA)
"^DD",101.41,101.412,.01,1,2,0)
101.412^DAD1^MUMPS
"^DD",101.41,101.412,.01,1,2,1)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) S:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)=""
"^DD",101.41,101.412,.01,1,2,2)
N ORP S ORP=$P(^ORD(101.41,DA(1),10,DA,0),U,11) K:ORP ^ORD(101.41,DA(1),10,"DAD",ORP,X,DA)
"^DD",101.41,101.412,.01,1,2,"%D",0)
^^1^1^2950511^
"^DD",101.41,101.412,.01,1,2,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,.01,1,2,"DT")
2950511
"^DD",101.41,101.412,.01,1,3,0)
101.41^AMM^MUMPS
"^DD",101.41,101.412,.01,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,.01,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,.01,1,3,"%D",1,0)
Update TIMESTAMP whenever SEQUENCE is changed.
"^DD",101.41,101.412,.01,1,3,"DT")
2990210
"^DD",101.41,101.412,.01,3)
Type a Number between .1 and 999.9, 1 Decimal Digit
"^DD",101.41,101.412,.01,21,0)
^^2^2^2971117^^^^
"^DD",101.41,101.412,.01,21,1,0)
This field specifies the order in which this item will be displayed or
"^DD",101.41,101.412,.01,21,2,0)
processed.
"^DD",101.41,101.412,.01,"DT")
2990210
"^DD",101.41,101.412,.1,0)
INPUT TRANSFORM^K^^.1;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,.1,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,.1,9)
@
"^DD",101.41,101.412,.1,21,0)
^^2^2^2950816^
"^DD",101.41,101.412,.1,21,1,0)
This is code that will be used as the third piece of DIR(0) when asking
"^DD",101.41,101.412,.1,21,2,0)
this prompt.
"^DD",101.41,101.412,.1,"DT")
2950816
"^DD",101.41,101.412,1,0)
PARENT^P101.41'^ORD(101.41,^0;11^Q
"^DD",101.41,101.412,1,1,0)
^.1
"^DD",101.41,101.412,1,1,1,0)
101.412^DAD^MUMPS
"^DD",101.41,101.412,1,1,1,1)
S ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)=""
"^DD",101.41,101.412,1,1,1,2)
K ^ORD(101.41,DA(1),10,"DAD",X,$P(^ORD(101.41,DA(1),10,DA,0),U),DA)
"^DD",101.41,101.412,1,1,1,"%D",0)
^^1^1^2950511^^
"^DD",101.41,101.412,1,1,1,"%D",1,0)
Allows retrieval of 'child' prompts in sequence by parent.
"^DD",101.41,101.412,1,1,1,"DT")
2950511
"^DD",101.41,101.412,1,3)
If this prompt is subordinate to another in this dialog, enter the parent prompt here
"^DD",101.41,101.412,1,21,0)
^^4^4^2950511^
"^DD",101.41,101.412,1,21,1,0)
This field controls the behavior of this prompt.  If a parent is defined
"^DD",101.41,101.412,1,21,2,0)
here, this prompt will be asked from within the parent's dialog; when it
"^DD",101.41,101.412,1,21,3,0)
is invoked independently based on its position sequence number, the child
"^DD",101.41,101.412,1,21,4,0)
prompt will be ignored.
"^DD",101.41,101.412,1,"DT")
2950511
"^DD",101.41,101.412,2,0)
ITEM^P101.41'X^ORD(101.41,^0;2^D TREE^ORDD41
"^DD",101.41,101.412,2,1,0)
^.1
"^DD",101.41,101.412,2,1,1,0)
101.41^AD
"^DD",101.41,101.412,2,1,1,1)
S ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)=""
"^DD",101.41,101.412,2,1,1,2)
K ^ORD(101.41,"AD",$E(X,1,30),DA(1),DA)
"^DD",101.41,101.412,2,1,1,"DT")
2950123
"^DD",101.41,101.412,2,1,2,0)
101.412^D
"^DD",101.41,101.412,2,1,2,1)
S ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.412,2,1,2,2)
K ^ORD(101.41,DA(1),10,"D",$E(X,1,30),DA)
"^DD",101.41,101.412,2,1,2,"DT")
2950411
"^DD",101.41,101.412,2,1,3,0)
101.41^AMM2^MUMPS
"^DD",101.41,101.412,2,1,3,1)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,2)
D REDOX^ORDD41
"^DD",101.41,101.412,2,1,3,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,2,1,3,"%D",1,0)
Update TIMESTAMP whenever ITEM is changed.
"^DD",101.41,101.412,2,1,3,"DT")
2990210
"^DD",101.41,101.412,2,3)
Enter an order dialog; a dialog that is an ancestor may not also be a sub-item.
"^DD",101.41,101.412,2,21,0)
^^3^3^2950123^
"^DD",101.41,101.412,2,21,1,0)
This field points to an order dialog which is subordinate to this dialog.
"^DD",101.41,101.412,2,21,2,0)
NOTE:  The parent dialog menu or one of its ancestors may not be entered
"^DD",101.41,101.412,2,21,3,0)
as an item.
"^DD",101.41,101.412,2,"DT")
2990217
"^DD",101.41,101.412,3,0)
MNEMONIC^FX^^0;3^K:$L(X)>4!($L(X)<1)!(+X=X&($L(X,".")>1))!($$CHKMNE^ORUTL(X)) X
"^DD",101.41,101.412,3,1,0)
^.1
"^DD",101.41,101.412,3,1,1,0)
101.41^AMM3^MUMPS
"^DD",101.41,101.412,3,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,3,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,3,1,1,"%D",1,0)
Update TIMESTAMP whenever MNEMONIC is changed.
"^DD",101.41,101.412,3,1,1,"DT")
2990210
"^DD",101.41,101.412,3,3)
Enter a mnemonic to be used when this dialog is displayed for selection, 1-4 characters in length with no decimal places if numeric. Standard list manager mnemonics may not be used.
"^DD",101.41,101.412,3,21,0)
^.001^2^2^3010727^^^^
"^DD",101.41,101.412,3,21,1,0)
This is a short abbreviation for this item dialog to be used when this
"^DD",101.41,101.412,3,21,2,0)
dialog is displayed for selection.
"^DD",101.41,101.412,3,"DT")
3000822
"^DD",101.41,101.412,4,0)
DISPLAY TEXT^FX^^0;4^K:$L(X)>80!($L(X)<1)!($$CHKNAM^ORUTL(X)) X
"^DD",101.41,101.412,4,1,0)
^.1
"^DD",101.41,101.412,4,1,1,0)
101.41^AMM4^MUMPS
"^DD",101.41,101.412,4,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,4,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,4,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY TEXT is changed.
"^DD",101.41,101.412,4,1,1,"DT")
2990210
"^DD",101.41,101.412,4,3)
Answer must be 1-80 characters in length and cannot contain a semicolon (;), a comma (,), an up-arrow (^), a dash (-), or an equal sign (=).
"^DD",101.41,101.412,4,21,0)
^.001^2^2^3010419^^^^
"^DD",101.41,101.412,4,21,1,0)
This field allows the text that normally appears for this item to be
"^DD",101.41,101.412,4,21,2,0)
replaced with alternate text for use in this dialog or menu.
"^DD",101.41,101.412,4,"DT")
3000823
"^DD",101.41,101.412,5,0)
DISPLAY ONLY?^S^0:NO;1:YES;2:YES-HEADER;^0;5^Q
"^DD",101.41,101.412,5,1,0)
^.1
"^DD",101.41,101.412,5,1,1,0)
101.41^AMM5^MUMPS
"^DD",101.41,101.412,5,1,1,1)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,2)
D REDOX^ORDD41
"^DD",101.41,101.412,5,1,1,"%D",0)
^^1^1^2990210^
"^DD",101.41,101.412,5,1,1,"%D",1,0)
Update TIMESTAMP whenever DISPLAY ONLY? is changed.
"^DD",101.41,101.412,5,1,1,"DT")
2990210
"^DD",101.41,101.412,5,3)
Enter YES if this item is text for display only and not a selectable item.
"^DD",101.41,101.412,5,21,0)
^^3^3^2970409^^^^
"^DD",101.41,101.412,5,21,1,0)
This field identifies an item as being free text for display purposes
"^DD",101.41,101.412,5,21,2,0)
only.  The text in the Display Text field will be displayed, but it
"^DD",101.41,101.412,5,21,3,0)
is not selectable; if designated as a header, the text will be underlined.
"^DD",101.41,101.412,5,"DT")
2990210
"^DD",101.41,101.412,6,0)
REQUIRED^S^1:YES;0:NO;^0;6^Q
"^DD",101.41,101.412,6,3)
Enter YES if a response to this prompt is mandatory.
"^DD",101.41,101.412,6,21,0)
^^1^1^2950407^
"^DD",101.41,101.412,6,21,1,0)
This field indicates that the user must enter a response to this prompt.
"^DD",101.41,101.412,6,"DT")
2950407
"^DD",101.41,101.412,7,0)
MULTIPLE VALUED^S^1:YES;0:NO;^0;7^Q
"^DD",101.41,101.412,7,3)
Enter YES if this prompt is to be asked multiple times.
"^DD",101.41,101.412,7,21,0)
^^3^3^2950407^
"^DD",101.41,101.412,7,21,1,0)
This field determines if this prompt will be allowed to have multiple
"^DD",101.41,101.412,7,21,2,0)
values, or be prompted for only once; if this prompt is a sub-dialog,
"^DD",101.41,101.412,7,21,3,0)
the entire dialog will be asked once or many times, as a group.
"^DD",101.41,101.412,7,"DT")
2950407
"^DD",101.41,101.412,7.1,0)
MAX NUMBER OF MULTIPLES^NJ2,0^^0;12^K:+X'=X!(X>99)!(X<2)!(X?.E1"."1N.N) X
"^DD",101.41,101.412,7.1,3)
Type a Number between 2 and 99, 0 Decimal Digits
"^DD",101.41,101.412,7.1,21,0)
^^4^4^2950815^
"^DD",101.41,101.412,7.1,21,1,0)
This is the maximum number of values that may be entered for this prompt,
"^DD",101.41,101.412,7.1,21,2,0)
if it is flagged as being multiple-valued.  For example, a diet order may
"^DD",101.41,101.412,7.1,21,3,0)
have up to 5 diet modifications entered, where 5 is the maximum allowed
"^DD",101.41,101.412,7.1,21,4,0)
that would be entered here.
"^DD",101.41,101.412,7.1,"DT")
2950815
"^DD",101.41,101.412,7.2,0)
TITLE^F^^0;13^K:$L(X)>30!($L(X)<3) X
"^DD",101.41,101.412,7.2,3)
Answer must be 3-30 characters in length.
"^DD",101.41,101.412,7.2,21,0)
^^8^8^2970430^^
"^DD",101.41,101.412,7.2,21,1,0)
This is text that will be used in place of the prompt when the order is
"^DD",101.41,101.412,7.2,21,2,0)
displayed for place, edit, or cancel, or at the top of a multiple-valued
"^DD",101.41,101.412,7.2,21,3,0)
prompt.  The Display Text for the prompt will be used together with the
"^DD",101.41,101.412,7.2,21,4,0)
instance number to prompt for user input; for example if Title="Lab Tests:"
"^DD",101.41,101.412,7.2,21,5,0)
and Display Text="Test:" the user would see
"^DD",101.41,101.412,7.2,21,6,0)
  Lab Tests:
"^DD",101.41,101.412,7.2,21,7,0)
  1. Test:
"^DD",101.41,101.412,7.2,21,8,0)
  2. Test:
"^DD",101.41,101.412,7.2,"DT")
2950815
"^DD",101.41,101.412,7.3,0)
PROMPT^F^^0;14^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,7.3,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,7.3,21,0)
^^3^3^2970618^
"^DD",101.41,101.412,7.3,21,1,0)
This field contains text that will be appended to the beginning of the
"^DD",101.41,101.412,7.3,21,2,0)
display text when prompting for additional values; if this field is
"^DD",101.41,101.412,7.3,21,3,0)
empty, then "Another " will be used.
"^DD",101.41,101.412,7.3,"DT")
2970618
"^DD",101.41,101.412,8,0)
ASK ON EDIT ONLY^S^1:YES;0:NO;^0;8^Q
"^DD",101.41,101.412,8,3)
Enter YES if this prompt should not be asked initially when creating this order, only if the user chooses to edit the order.
"^DD",101.41,101.412,8,21,0)
^.001^4^4^3000621^^^^
"^DD",101.41,101.412,8,21,1,0)
This field determines the behavior of the dialog driver for this prompt;
"^DD",101.41,101.412,8,21,2,0)
if no value or the defined default is usually correct for this prompt,
"^DD",101.41,101.412,8,21,3,0)
enter YES here to have this prompt skipped on the first pass through this
"^DD",101.41,101.412,8,21,4,0)
dialog when creating an order.
"^DD",101.41,101.412,8,"DT")
2950407
"^DD",101.41,101.412,9,0)
ASK ON ACTION^F^^0;9^K:$L(X)>3!($L(X)<1) X
"^DD",101.41,101.412,9,3)
Answer must be 1-3 characters in length.
"^DD",101.41,101.412,9,21,0)
^.001^6^6^3000621^^^^
"^DD",101.41,101.412,9,21,1,0)
This field determines the behavior of the dialog driver for this prompt
"^DD",101.41,101.412,9,21,2,0)
when taking a particular action on an order created by this dialog.  If
"^DD",101.41,101.412,9,21,3,0)
this string contains "R", this prompt will be asked when renewing an order;
"^DD",101.41,101.412,9,21,4,0)
if this string contains "C", this prompt will be asked when changing an
"^DD",101.41,101.412,9,21,5,0)
order; if this string contains "W", this prompt will be asked when
"^DD",101.41,101.412,9,21,6,0)
rewriting an order.
"^DD",101.41,101.412,9,"DT")
2970708
"^DD",101.41,101.412,10,0)
INDEX^F^^0;10^K:$L(X)>25!($L(X)<1) X
"^DD",101.41,101.412,10,3)
Answer must be 1-25 characters in length.
"^DD",101.41,101.412,10,21,0)
^^3^3^2950713^^^
"^DD",101.41,101.412,10,21,1,0)
For pointer-type prompts, this is the index to use when searching the file;
"^DD",101.41,101.412,10,21,2,0)
it must be in the form of a regular cross-reference.  To search on multiple
"^DD",101.41,101.412,10,21,3,0)
indices, enter a string of index names separated by semi-colons, i.e. "B;C".
"^DD",101.41,101.412,10,"DT")
2950713
"^DD",101.41,101.412,11,0)
HELP MESSAGE^F^^1;1^K:$L(X)>160!($L(X)<1) X
"^DD",101.41,101.412,11,3)
Answer must be 1-160 characters in length.
"^DD",101.41,101.412,11,21,0)
^^2^2^2970609^^
"^DD",101.41,101.412,11,21,1,0)
This field contains the help message to be presented when the user enters
"^DD",101.41,101.412,11,21,2,0)
a question mark at this prompt.
"^DD",101.41,101.412,11,"DT")
2970609
"^DD",101.41,101.412,12,0)
SPECIAL LOOKUP ROUTINE^F^^1;2^K:$L(X)>20!($L(X)<3) X
"^DD",101.41,101.412,12,3)
Enter the routine to use instead of DIC to do this lookup, as [TAG;]ROUTINE
"^DD",101.41,101.412,12,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,12,21,1,0)
This field contains a routine to execute that will replace the standard
"^DD",101.41,101.412,12,21,2,0)
DIC lookup for this prompt; it must be entered here as LINETAG;ROUTINE
"^DD",101.41,101.412,12,21,3,0)
using a ; instead of ^ and where LINETAG is optional.
"^DD",101.41,101.412,12,"DT")
2970609
"^DD",101.41,101.412,13,0)
ASK ON CONDITION^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,13,3)
This is MUMPS code that sets $T to determine if this prompt should be asked, or given a default value and bypassed.
"^DD",101.41,101.412,13,9)
@
"^DD",101.41,101.412,13,21,0)
^^5^5^2950407^
"^DD",101.41,101.412,13,21,1,0)
This is MUMPS code that sets $T to determine if this prompt should be asked
"^DD",101.41,101.412,13,21,2,0)
or simply given a default value and presented to the user for acceptance
"^DD",101.41,101.412,13,21,3,0)
or editing.  For example, the prompt "Pregnant: " may have code here to
"^DD",101.41,101.412,13,21,4,0)
check the sex of the current patient, i.e. I ORSEX="F" will allow it to be
"^DD",101.41,101.412,13,21,5,0)
asked only for female patients.
"^DD",101.41,101.412,13,"DT")
2950407
"^DD",101.41,101.412,14,0)
SCREEN^K^^4;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,14,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,14,9)
@
"^DD",101.41,101.412,14,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,14,21,1,0)
For pointer-type prompts, this field may contain MUMPS code that will be
"^DD",101.41,101.412,14,21,2,0)
set into DIC("S") to screen the possible choices in the pointed-to file.
"^DD",101.41,101.412,14,"DT")
2950407
"^DD",101.41,101.412,15,0)
POST-SELECTION ACTION^K^^5;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,15,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,15,9)
@
"^DD",101.41,101.412,15,21,0)
^^3^3^2970923^^^^
"^DD",101.41,101.412,15,21,1,0)
This is code that will be executed after a response is entered to this
"^DD",101.41,101.412,15,21,2,0)
prompt; if this prompt should be re-asked, kill the variable DONE.
"^DD",101.41,101.412,15,21,3,0)
If execution of the ordering dialog should be stopped, set ORQUIT=1.
"^DD",101.41,101.412,15,"DT")
2970923
"^DD",101.41,101.412,16,0)
XECUTABLE HELP^K^^6;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,16,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,16,9)
@
"^DD",101.41,101.412,16,21,0)
^^2^2^2950407^
"^DD",101.41,101.412,16,21,1,0)
This is code that is to be executed when the user enters two or more
"^DD",101.41,101.412,16,21,2,0)
question marks at this prompt.
"^DD",101.41,101.412,16,"DT")
2950407
"^DD",101.41,101.412,17,0)
DEFAULT^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,17,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,17,9)
@
"^DD",101.41,101.412,17,21,0)
^^2^2^2971219^^^^
"^DD",101.41,101.412,17,21,1,0)
This is code that is to be executed to determine the appropriate default
"^DD",101.41,101.412,17,21,2,0)
value for this prompt, setting Y=internal form of this value.
"^DD",101.41,101.412,17,"DT")
2950519
"^DD",101.41,101.412,18,0)
DEFAULT WORD-PROCESSING TEXT^101.41218^^8;0
"^DD",101.41,101.412,18,21,0)
^^1^1^2971219^
"^DD",101.41,101.412,18,21,1,0)
This is default text to be stuffed into this word-processing prompt.
"^DD",101.41,101.412,19,0)
ENTRY ACTION^K^^9;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,19,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,19,9)
@
"^DD",101.41,101.412,19,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,19,21,1,0)
This is code that will be executed at the beginning of the processing of
"^DD",101.41,101.412,19,21,2,0)
this prompt, before the Default and Ask on Condition fields are executed;
"^DD",101.41,101.412,19,21,3,0)
any special setup required for this field should be done here.
"^DD",101.41,101.412,19,"DT")
2970609
"^DD",101.41,101.412,20,0)
EXIT ACTION^K^^10;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,20,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,20,9)
@
"^DD",101.41,101.412,20,21,0)
^^3^3^2970609^
"^DD",101.41,101.412,20,21,1,0)
This is code that will be executed at the very end of the processing of
"^DD",101.41,101.412,20,21,2,0)
this prompt, after prompting and the Validation field is executed;
"^DD",101.41,101.412,20,21,3,0)
any special cleanup should be done here.
"^DD",101.41,101.412,20,"DT")
2970609
"^DD",101.41,101.412,21,0)
ORDER TEXT SEQUENCE^NJ5,2^^2;1^K:+X'=X!(X>99.99)!(X<1)!(X?.E1"."3N.N) X
"^DD",101.41,101.412,21,1,0)
^.1
"^DD",101.41,101.412,21,1,1,0)
101.412^ATXT
"^DD",101.41,101.412,21,1,1,1)
S ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)=""
"^DD",101.41,101.412,21,1,1,2)
K ^ORD(101.41,DA(1),10,"ATXT",$E(X,1,30),DA)
"^DD",101.41,101.412,21,1,1,"%D",0)
^^1^1^2960226^
"^DD",101.41,101.412,21,1,1,"%D",1,0)
Used to build order text.
"^DD",101.41,101.412,21,1,1,"DT")
2960226
"^DD",101.41,101.412,21,3)
Enter the order in which this value should be added to the order text, as a number between 1 and 99.99; leave this field blank to prevent this value from being included
"^DD",101.41,101.412,21,21,0)
^^3^3^2970607^^^
"^DD",101.41,101.412,21,21,1,0)
This field indicates the order in which values will be concatenated
"^DD",101.41,101.412,21,21,2,0)
together to build the order text; this may differ from the prompting
"^DD",101.41,101.412,21,21,3,0)
order defined in the .01 Sequence field.
"^DD",101.41,101.412,21,"DT")
2960226
"^DD",101.41,101.412,22,0)
FORMAT^F^^2;2^K:$L(X)>10!($L(X)<1) X
"^DD",101.41,101.412,22,3)
Answer must be 1-10 characters in length.
"^DD",101.41,101.412,22,21,0)
^^15^15^2971207^^^^
"^DD",101.41,101.412,22,21,1,0)
This is a string of characters that will define any exceptions to how
"^DD",101.41,101.412,22,21,2,0)
the external form of this value is generated.  Possible values include:
"^DD",101.41,101.412,22,21,3,0)
  Pointer         -> <field #>~<piece in RPC list of field #>, default =.01
"^DD",101.41,101.412,22,21,4,0)
  Set of Codes    -> 1~<piece in RPC list of code> to use code for name
"^DD",101.41,101.412,22,21,5,0)
  Date/Time       -> Format string to pass $$FMTE^XLFDT (default = 2)
"^DD",101.41,101.412,22,21,6,0)
  
"^DD",101.41,101.412,22,21,7,0)
  Suppress value  -> @
"^DD",101.41,101.412,22,21,8,0)
  Replace value   -> @<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,9,0)
                      whose value, when present, supersedes this value
"^DD",101.41,101.412,22,21,10,0)
  Required value  -> *<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,11,0)
                      whose value is required to be present to include
"^DD",101.41,101.412,22,21,12,0)
                      this value
"^DD",101.41,101.412,22,21,13,0)
  Ignore if same  -> =<ptr> where ptr is the Dialog IEN of the prompt
"^DD",101.41,101.412,22,21,14,0)
                      whose value, if the external form is the same,
"^DD",101.41,101.412,22,21,15,0)
                      supersedes this value
"^DD",101.41,101.412,22,"DT")
2960226
"^DD",101.41,101.412,23,0)
OMIT TEXT^F^^2;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,23,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,23,21,0)
^^3^3^2970829^^^^
"^DD",101.41,101.412,23,21,1,0)
This is the external form of a value that is not to be included when building
"^DD",101.41,101.412,23,21,2,0)
the order text.  E.g. to include the urgency in the order text unless it
"^DD",101.41,101.412,23,21,3,0)
is routine, enter "ROUTINE" here.
"^DD",101.41,101.412,23,"DT")
2970829
"^DD",101.41,101.412,24,0)
LEADING TEXT^F^^2;4^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,24,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,24,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,24,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,24,21,2,0)
immediately in front of this value, e.g. "Instructions:".  If this text
"^DD",101.41,101.412,24,21,3,0)
is contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,24,"DT")
2970724
"^DD",101.41,101.412,25,0)
TRAILING TEXT^F^^2;5^K:$L(X)>80!($L(X)<1) X
"^DD",101.41,101.412,25,3)
Answer must be 1-80 characters in length.
"^DD",101.41,101.412,25,21,0)
^^3^3^2970724^^^^
"^DD",101.41,101.412,25,21,1,0)
This field contains text that will be appended to the order text
"^DD",101.41,101.412,25,21,2,0)
immediately following this value, e.g. "refills".  If this text is
"^DD",101.41,101.412,25,21,3,0)
contained in a variable, enter @NAME where NAME is the variable name.
"^DD",101.41,101.412,25,"DT")
2970724
"^DD",101.41,101.412,26,0)
START NEW LINE^S^1:YES;0:NO;^2;6^Q
"^DD",101.41,101.412,26,3)
Enter YES if this value should begin on a new line in the order text.
"^DD",101.41,101.412,26,21,0)
0^^2^2^2970911^
"^DD",101.41,101.412,26,21,1,0)
This field determines if this value is concatenated onto the current line
"^DD",101.41,101.412,26,21,2,0)
when building the order text, or if a new line is started with this value.
"^DD",101.41,101.412,26,"DT")
2970911
"^DD",101.41,101.412,27,0)
WORD-WRAP^S^1:DON'T WRAP;0:WRAP;^2;7^Q
"^DD",101.41,101.412,27,3)
Enter 'Don't Wrap' to have the text be added line-by-line as it is stored; the default formatting is 'Wrap'.
"^DD",101.41,101.412,27,21,0)
^^3^3^2970926^^^
"^DD",101.41,101.412,27,21,1,0)
This field determines if this text should be wrapped when added to the
"^DD",101.41,101.412,27,21,2,0)
order text, or appended line by line as stored in the file; this is only
"^DD",101.41,101.412,27,21,3,0)
used for word-processing type prompts.
"^DD",101.41,101.412,27,"DT")
2970926
"^DD",101.41,101.412,101,0)
WINDOWS CONTROL^F^^W;1^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,101,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,101,21,0)
^^2^2^2990726^^
"^DD",101.41,101.412,101,21,1,0)
Stores the type of Windows control necessary to get the data for this
"^DD",101.41,101.412,101,21,2,0)
prompt.
"^DD",101.41,101.412,101,"DT")
2960517
"^DD",101.41,101.412,102,0)
API NAME^F^^W;2^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,102,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,102,21,0)
^.001^3^3^3000621^^
"^DD",101.41,101.412,102,21,1,0)
This is the API that should be called when the control is used.  How the API
"^DD",101.41,101.412,102,21,2,0)
is used varies with the control.  Examples are: filling list boxes, getting
"^DD",101.41,101.412,102,21,3,0)
boilerplate text, etc.
"^DD",101.41,101.412,102,"DT")
2951002
"^DD",101.41,101.412,103,0)
API PARAMETER #1^F^^W;3^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.412,103,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.412,103,21,0)
^^1^1^2950715^
"^DD",101.41,101.412,103,21,1,0)
A parameter that is used by the API call may be stored here.
"^DD",101.41,101.412,103,"DT")
2950715
"^DD",101.41,101.412,113,0)
WINDOWS CONDITION^K^^W3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,113,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,113,9)
@
"^DD",101.41,101.412,113,21,0)
^^3^3^2990726^^
"^DD",101.41,101.412,113,21,1,0)
This is silent code that is executed when building the dialog for windows.
"^DD",101.41,101.412,113,21,2,0)
It identifies which prompts should be included in the dialog.  The condition
"^DD",101.41,101.412,113,21,3,0)
should leave $T false if the prompt should not be asked.
"^DD",101.41,101.412,113,"DT")
2950715
"^DD",101.41,101.412,117,0)
WINDOWS DEFAULT^K^^W7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",101.41,101.412,117,3)
This is Standard MUMPS code.
"^DD",101.41,101.412,117,9)
@
"^DD",101.41,101.412,117,21,0)
^^2^2^2990726^^
"^DD",101.41,101.412,117,21,1,0)
This code should silently set the default value of a prompt when it is 
"^DD",101.41,101.412,117,21,2,0)
selected.
"^DD",101.41,101.412,117,"DT")
2950715
"^DD",101.41,101.41218,0)
DEFAULT WORD-PROCESSING TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.41218,0,"DT")
2950407
"^DD",101.41,101.41218,0,"NM","DEFAULT WORD-PROCESSING TEXT")

"^DD",101.41,101.41218,0,"UP")
101.412
"^DD",101.41,101.41218,.01,0)
DEFAULT WORD-PROCESSING TEXT^W^^0;1^Q
"^DD",101.41,101.41218,.01,3)
Enter the default response for a word-processing type prompt.
"^DD",101.41,101.41218,.01,21,0)
^^2^2^2950407^
"^DD",101.41,101.41218,.01,21,1,0)
This field contains the text to be presented as the default for this prompt,
"^DD",101.41,101.41218,.01,21,2,0)
for word-processing type prompts.
"^DD",101.41,101.41218,.01,"DT")
2950407
"^DD",101.41,101.415,0)
CONTROLS SUB-FIELD^^14^14
"^DD",101.41,101.415,0,"DT")
2960202
"^DD",101.41,101.415,0,"IX","AC",101.415,3)

"^DD",101.41,101.415,0,"IX","B",101.415,.01)

"^DD",101.41,101.415,0,"NM","CONTROLS")

"^DD",101.41,101.415,0,"UP")
101.41
"^DD",101.41,101.415,.01,0)
LOGICAL NAME^MF^^0;1^K:$L(X)>8!($L(X)<1)!'(X?1.8U) X
"^DD",101.41,101.415,.01,1,0)
^.1
"^DD",101.41,101.415,.01,1,1,0)
101.415^B
"^DD",101.41,101.415,.01,1,1,1)
S ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)=""
"^DD",101.41,101.415,.01,1,1,2)
K ^ORD(101.41,DA(1),50,"B",$E(X,1,30),DA)
"^DD",101.41,101.415,.01,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,.01,21,0)
^^1^1^2960202^
"^DD",101.41,101.415,.01,21,1,0)
This is the name by which controls can refer to each other.
"^DD",101.41,101.415,.01,"DT")
2960202
"^DD",101.41,101.415,2,0)
ITEM^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.415,2,"DT")
2960202
"^DD",101.41,101.415,3,0)
CREATE SEQUENCE^NJ2,0^^0;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,3,1,0)
^.1
"^DD",101.41,101.415,3,1,1,0)
101.415^AC
"^DD",101.41,101.415,3,1,1,1)
S ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)=""
"^DD",101.41,101.415,3,1,1,2)
K ^ORD(101.41,DA(1),50,"AC",$E(X,1,30),DA)
"^DD",101.41,101.415,3,1,1,"%D",0)
^^2^2^2960202^
"^DD",101.41,101.415,3,1,1,"%D",1,0)
The 'AC' cross-reference puts in window controls in order by creation 
"^DD",101.41,101.415,3,1,1,"%D",2,0)
sequence.
"^DD",101.41,101.415,3,1,1,"DT")
2960202
"^DD",101.41,101.415,3,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",101.41,101.415,3,"DT")
2960202
"^DD",101.41,101.415,4,0)
CONTROL TYPE^S^0:Label;1:Button;2:Edit;3:Memo;4:ListBox;5:SimpleCombo;6:DropDownList;7:LongCombo;^0;4^Q
"^DD",101.41,101.415,4,"DT")
2960202
"^DD",101.41,101.415,5,0)
LABEL^F^^0;5^K:$L(X)>30!($L(X)<1) X
"^DD",101.41,101.415,5,3)
Answer must be 1-30 characters in length.
"^DD",101.41,101.415,5,"DT")
2960202
"^DD",101.41,101.415,6,0)
BESIDE^F^^0;6^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,6,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,6,"DT")
2960202
"^DD",101.41,101.415,7,0)
BELOW^F^^0;7^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,7,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,7,"DT")
2960202
"^DD",101.41,101.415,8,0)
WIDTH^NJ6,4^^0;8^K:+X'=X!(X>1)!(X<0)!(X?.E1"."5N.N) X
"^DD",101.41,101.415,8,3)
Type a Number between 0 and 1, 4 Decimal Digits
"^DD",101.41,101.415,8,"DT")
2960202
"^DD",101.41,101.415,9,0)
LEFT CONTROL^F^^0;9^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,9,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,9,"DT")
2960202
"^DD",101.41,101.415,10,0)
RIGHT CONTROL^F^^0;10^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,10,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,10,"DT")
2960202
"^DD",101.41,101.415,11,0)
HEIGHT^NJ2,0^^0;11^K:+X'=X!(X>15)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,11,3)
Type a Number between 1 and 15, 0 Decimal Digits
"^DD",101.41,101.415,11,"DT")
2960202
"^DD",101.41,101.415,12,0)
UPPER CONTROL^F^^0;12^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,12,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,12,"DT")
2960202
"^DD",101.41,101.415,13,0)
LOWER CONTROL^F^^0;13^K:$L(X)>8!($L(X)<1) X
"^DD",101.41,101.415,13,3)
Answer must be 1-8 characters in length.
"^DD",101.41,101.415,13,"DT")
2960202
"^DD",101.41,101.415,14,0)
TAB SEQUENCE^NJ2,0^^0;14^K:+X'=X!(X>89)!(X<0)!(X?.E1"."1N.N) X
"^DD",101.41,101.415,14,3)
Type a Number between 0 and 89, 0 Decimal Digits
"^DD",101.41,101.415,14,"DT")
2960202
"^DD",101.41,101.416,0)
RESPONSES SUB-FIELD^^2^5
"^DD",101.41,101.416,0,"DT")
2960717
"^DD",101.41,101.416,0,"IX","D",101.416,.02)

"^DD",101.41,101.416,0,"NM","RESPONSES")

"^DD",101.41,101.416,0,"UP")
101.41
"^DD",101.41,101.416,.01,0)
ITEM ENTRY^MNJ7,0^^0;1^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.01,1,0)
^.1^^0
"^DD",101.41,101.416,.01,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.01,21,0)
^^2^2^2971219^^^
"^DD",101.41,101.416,.01,21,1,0)
This is the internal entry number of the prompt in the Item multiple
"^DD",101.41,101.416,.01,21,2,0)
by which this response was obtained.
"^DD",101.41,101.416,.01,"DT")
2961118
"^DD",101.41,101.416,.02,0)
DIALOG^P101.41'^ORD(101.41,^0;2^Q
"^DD",101.41,101.416,.02,1,0)
^.1
"^DD",101.41,101.416,.02,1,1,0)
101.416^D
"^DD",101.41,101.416,.02,1,1,1)
S ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)=""
"^DD",101.41,101.416,.02,1,1,2)
K ^ORD(101.41,DA(1),6,"D",$E(X,1,30),DA)
"^DD",101.41,101.416,.02,1,1,"DT")
2961118
"^DD",101.41,101.416,.02,3)
Select the dialog prompt from which this response was generated.
"^DD",101.41,101.416,.02,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.02,21,1,0)
This is a pointer to the dialog prompt, which is in the Order Dialog file
"^DD",101.41,101.416,.02,21,2,0)
as type prompt.
"^DD",101.41,101.416,.02,"DT")
2961118
"^DD",101.41,101.416,.03,0)
INSTANCE^NJ7,0^^0;3^K:+X'=X!(X>9999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",101.41,101.416,.03,3)
Type a Number between 1 and 9999999, 0 Decimal Digits
"^DD",101.41,101.416,.03,21,0)
^^2^2^2960717^
"^DD",101.41,101.416,.03,21,1,0)
In the case of multiple answers for the same item, this identifies the
"^DD",101.41,101.416,.03,21,2,0)
individual instance.
"^DD",101.41,101.416,.03,"DT")
2960717
"^DD",101.41,101.416,1,0)
VALUE^FO^^1;1^K:$L(X)>245!($L(X)<1) X
"^DD",101.41,101.416,1,2)
S Y(0)=Y S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,2.1)
S Y=$$OUTPUT^ORCMEDT5(Y)
"^DD",101.41,101.416,1,3)
Answer must be 1-245 characters in length.
"^DD",101.41,101.416,1,21,0)
^^2^2^2971219^^
"^DD",101.41,101.416,1,21,1,0)
This contains the actual response, unless the value is a word processing
"^DD",101.41,101.416,1,21,2,0)
type.
"^DD",101.41,101.416,1,"DT")
2980717
"^DD",101.41,101.416,2,0)
TEXT^101.4162^^2;0
"^DD",101.41,101.416,2,21,0)
^^1^1^2971219^
"^DD",101.41,101.416,2,21,1,0)
This contains the actual response, for word-processing type prompts.
"^DD",101.41,101.416,2,"DT")
2960717
"^DD",101.41,101.4162,0)
TEXT SUB-FIELD^^.01^1
"^DD",101.41,101.4162,0,"DT")
2960717
"^DD",101.41,101.4162,0,"NM","TEXT")

"^DD",101.41,101.4162,0,"UP")
101.416
"^DD",101.41,101.4162,.01,0)
TEXT^WL^^0;1^Q
"^DD",101.41,101.4162,.01,21,0)
^^1^1^2960717^^
"^DD",101.41,101.4162,.01,21,1,0)
This contains responses to items that are a word processing type.
"^DD",101.41,101.4162,.01,"DT")
2960717
"^DIC",101.41,101.41,0)
ORDER DIALOG^101.41
"^DIC",101.41,101.41,0,"GL")
^ORD(101.41,
"^DIC",101.41,101.41,"%",0)
^1.005^^0
"^DIC",101.41,101.41,"%D",0)
^^2^2^2960819^^
"^DIC",101.41,101.41,"%D",1,0)
This file contains the information needed to define how to prompt for each
"^DIC",101.41,101.41,"%D",2,0)
order, what values are acceptable, etc.
"^DIC",101.41,"B","ORDER DIALOG",101.41)

**END**
**END**
