EMERGENCY Released XU*8*278 SEQ #236
Extracted from mail message
**KIDS**:XU*8.0*278^

**INSTALL NAME**
XU*8.0*278
"BLD",645,0)
XU*8.0*278^KERNEL^0^3030303^y
"BLD",645,1,0)
^^2^2^3030108^
"BLD",645,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",645,1,2,0)
XU*8*278   Cache/NT %ZIS4 fix.
"BLD",645,4,0)
^9.64PA^^
"BLD",645,"KRN",0)
^9.67PA^8989.52^19
"BLD",645,"KRN",.4,0)
.4
"BLD",645,"KRN",.401,0)
.401
"BLD",645,"KRN",.402,0)
.402
"BLD",645,"KRN",.403,0)
.403
"BLD",645,"KRN",.5,0)
.5
"BLD",645,"KRN",.84,0)
.84
"BLD",645,"KRN",3.6,0)
3.6
"BLD",645,"KRN",3.8,0)
3.8
"BLD",645,"KRN",9.2,0)
9.2
"BLD",645,"KRN",9.8,0)
9.8
"BLD",645,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",645,"KRN",9.8,"NM",1,0)
ZIS4ONT^^0^B25105785
"BLD",645,"KRN",9.8,"NM","B","ZIS4ONT",1)

"BLD",645,"KRN",19,0)
19
"BLD",645,"KRN",19.1,0)
19.1
"BLD",645,"KRN",101,0)
101
"BLD",645,"KRN",409.61,0)
409.61
"BLD",645,"KRN",771,0)
771
"BLD",645,"KRN",870,0)
870
"BLD",645,"KRN",8989.51,0)
8989.51
"BLD",645,"KRN",8989.52,0)
8989.52
"BLD",645,"KRN",8994,0)
8994
"BLD",645,"KRN","B",.4,.4)

"BLD",645,"KRN","B",.401,.401)

"BLD",645,"KRN","B",.402,.402)

"BLD",645,"KRN","B",.403,.403)

"BLD",645,"KRN","B",.5,.5)

"BLD",645,"KRN","B",.84,.84)

"BLD",645,"KRN","B",3.6,3.6)

"BLD",645,"KRN","B",3.8,3.8)

"BLD",645,"KRN","B",9.2,9.2)

"BLD",645,"KRN","B",9.8,9.8)

"BLD",645,"KRN","B",19,19)

"BLD",645,"KRN","B",19.1,19.1)

"BLD",645,"KRN","B",101,101)

"BLD",645,"KRN","B",409.61,409.61)

"BLD",645,"KRN","B",771,771)

"BLD",645,"KRN","B",870,870)

"BLD",645,"KRN","B",8989.51,8989.51)

"BLD",645,"KRN","B",8989.52,8989.52)

"BLD",645,"KRN","B",8994,8994)

"BLD",645,"QUES",0)
^9.62^^
"BLD",645,"REQB",0)
^9.611^1^1
"BLD",645,"REQB",1,0)
XU*8.0*191^2
"BLD",645,"REQB","B","XU*8.0*191",1)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
278^3030303
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3030303
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
XU*8*278   Cache/NT %ZIS4 fix.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ZIS4ONT")
0^1^B25105785
"RTN","ZIS4ONT",1,0)
%ZIS4 ;SFISC/RWF,AC - DEVICE HANDLER SPOOL SPECIFIC CODE (OpenM/WNT) ;03/03/2003  10:03
"RTN","ZIS4ONT",2,0)
 ;;8.0;KERNEL;**34,59,69,191,278**;Jul 10, 1995
"RTN","ZIS4ONT",3,0)
 ;
"RTN","ZIS4ONT",4,0)
OPEN G OPN2:$D(IO(1,IO))
"RTN","ZIS4ONT",5,0)
 S POP=0 D OP1 G NOPEN:'$D(IO(1,IO))
"RTN","ZIS4ONT",6,0)
OPN2 I $D(%ZISHP),'$D(IOP) W !,*7," Routing to device "_$P(^%ZIS(1,%E,0),"^",1)_$S($D(^(1)):" "_$P(^(1),"^",1)_" ",1:"")
"RTN","ZIS4ONT",7,0)
 Q
"RTN","ZIS4ONT",8,0)
NOPEN I %IS'["D",$D(%ZISHP)!(%ZISHG]"") S POP=1 Q
"RTN","ZIS4ONT",9,0)
 I '$D(IOP) W *7,"  [BUSY]" W "  ...  RETRY" S %=2,U="^" D YN^%ZIS1 G OPEN:%=1
"RTN","ZIS4ONT",10,0)
 K:%E'=%H ^XUTL("ZISPARAM",IO)
"RTN","ZIS4ONT",11,0)
 S POP=1 Q
"RTN","ZIS4ONT",12,0)
 Q
"RTN","ZIS4ONT",13,0)
OP1 N X S X="OPNERR^%ZIS4",@^%ZOSF("TRAP")
"RTN","ZIS4ONT",14,0)
 L:$D(%ZISLOCK) +@%ZISLOCK:60
"RTN","ZIS4ONT",15,0)
 O IO::%ZISTO S:$T IO(1,IO)="" S:'$T POP=1 L:$D(%ZISLOCK) -@%ZISLOCK
"RTN","ZIS4ONT",16,0)
 Q
"RTN","ZIS4ONT",17,0)
OPNERR S POP=1,IO("LASTERR")=$G(IO("ERROR")),IO("ERROR")=$ZE,$EC="" Q
"RTN","ZIS4ONT",18,0)
 ;
"RTN","ZIS4ONT",19,0)
O N X D:%IS["L" ZIO
"RTN","ZIS4ONT",20,0)
 I $D(IO("S")),$D(^%ZIS(2,IO("S"),10)),^(10)]"" U IO(0) D X10^ZISX ;Open Printer port
"RTN","ZIS4ONT",21,0)
OPAR I $D(IOP),%ZTYPE="HFS",$D(%IS("HFSIO")),$D(%IS("IOPAR")),%IS("HFSIO")]"" S IO=%IS("HFSIO"),%ZISOPAR=%IS("IOPAR")
"RTN","ZIS4ONT",22,0)
 S %A=$S(%ZISOPAR]"":%ZISOPAR,%ZTYPE'["TRM":"",%ZISIOST?1"C".E:"("_+%Z91_":""C"")",%ZISIOST?1"PK".E:"("_+%Z91_":""P"")",1:+%Z91)
"RTN","ZIS4ONT",23,0)
 S %A=%A_$S(%A["):":"",%ZTYPE["OTH"&($P(%ZTIME,"^",3)="n"):"",1:":"_%ZISTO),%A=""""_IO_""""_$E(":",%A]"")_%A
"RTN","ZIS4ONT",24,0)
 D O1 I POP W:'$D(IOP) !,?5,*7,"[Device is BUSY]" Q
"RTN","ZIS4ONT",25,0)
 ;I %ZTYPE="HFS" U IO S X=IO,IO=IO_";"_$P($ZIO,";",2),IO(1,IO)="" K IO(1,X)
"RTN","ZIS4ONT",26,0)
 U IO S $X=0,$Y=0
"RTN","ZIS4ONT",27,0)
 I %ZISUPAR]"" S %A1=""""_IO_""":"_%ZISUPAR U @%A1
"RTN","ZIS4ONT",28,0)
 ;U:%IS'[0 IO(0)
"RTN","ZIS4ONT",29,0)
 G OXECUTE^%ZIS6
"RTN","ZIS4ONT",30,0)
 ;
"RTN","ZIS4ONT",31,0)
O1 N X S X="OPNERR^%ZIS4",@^%ZOSF("TRAP")
"RTN","ZIS4ONT",32,0)
 L:$D(%ZISLOCK) +@%ZISLOCK:60
"RTN","ZIS4ONT",33,0)
 O @%A S:'$T&(%A?.E1":".N) POP=1 S:'POP IO(1,IO)=""
"RTN","ZIS4ONT",34,0)
 L:$D(%ZISLOCK) -@%ZISLOCK
"RTN","ZIS4ONT",35,0)
 S IO("ERROR")=""
"RTN","ZIS4ONT",36,0)
 Q
"RTN","ZIS4ONT",37,0)
 ;Version 3 used ip/port, Version 4 has ip:port|xx
"RTN","ZIS4ONT",38,0)
ZIO N %,%1 S %=$ZIO,%1=$$VERSION^%ZOSV
"RTN","ZIS4ONT",39,0)
 S IO("ZIO")=$S(%1<4:$I,1:$ZIO),%1=$S(%["/":"/",1:":")
"RTN","ZIS4ONT",40,0)
 ;Drop prefix
"RTN","ZIS4ONT",41,0)
 S:%["|TNT|" %=$E(%,6,999) S:%["|TNA|" %=$E(%,6,999)
"RTN","ZIS4ONT",42,0)
 ;Get IP name or number
"RTN","ZIS4ONT",43,0)
 I '$D(IO("IP")) D
"RTN","ZIS4ONT",44,0)
 . S:$P(%,%1)["." IO("IP")=$P(%,%1)
"RTN","ZIS4ONT",45,0)
 Q
"RTN","ZIS4ONT",46,0)
 ;
"RTN","ZIS4ONT",47,0)
SPOOL ;%ZDA=pointer to ^XMB(3.51, %ZFN=spool file num.
"RTN","ZIS4ONT",48,0)
 N %ZOS S %ZOS=$$OS^%ZOSV
"RTN","ZIS4ONT",49,0)
 I '$D(^XMB(3.51,0)) W:'$D(IOP) !?5,"The spooler files are not setup in this account." G N
"RTN","ZIS4ONT",50,0)
 I $D(ZISDA) W:'$D(IOP) !?5,*7,"You may not Spool the printing of a Spool document" G N
"RTN","ZIS4ONT",51,0)
 I $D(DUZ)[0 W:'$D(IOP) !,"Must be a valid user." G N
"RTN","ZIS4ONT",52,0)
R S %ZY=-1 D NEWDOC^ZISPL1:$D(DUZ)=11 G N:%ZY'>0 S %ZDA=+%ZY,%ZFN=$P(%ZY(0),U,2),IO("DOC")=$P(%ZY(0),U,1) G OK:$D(IO("Q"))
"RTN","ZIS4ONT",53,0)
 G:'%ZISB OK I '$P(%ZY,"^",3),%ZFN]"" D SPL3 G N:%ZFN<0,DOC
"RTN","ZIS4ONT",54,0)
 I %ZOS="NT" D  G:%ZFN>255 N
"RTN","ZIS4ONT",55,0)
 . F %ZFN=1:1:260 I '$D(^XMB(3.51,"C",%ZFN))!$D(^(%ZFN,%ZDA)) Q:%ZFN<256  W:'$D(IOP) *7,"  DELETE SOME OTHER DOCUMENT!" G N
"RTN","ZIS4ONT",56,0)
 . Q:%ZFN>255  D SPL2 S $P(^XMB(3.51,%ZDA,0),U,2)=%ZFN,^XMB(3.51,"C",%ZFN,%ZDA)=""
"RTN","ZIS4ONT",57,0)
 I %ZOS="VMS" D  G:%ZFN']"" N
"RTN","ZIS4ONT",58,0)
 . S %ZFN=IO_"SPOOL_no_"_%ZDA_".TMP" D SPL2 Q:%ZFN']"" N S $P(^XMB(3.51,%ZDA,0),U,2)=%ZFN,^XMB(3.51,"C",%ZFN,%ZDA)="",IO=%ZFN
"RTN","ZIS4ONT",59,0)
DOC S IO("SPOOL")=%ZDA,^XUTL("XQ",$J,"SPOOL")=%ZDA
"RTN","ZIS4ONT",60,0)
 I $D(^%ZIS(1,%ZISIOS,1)),$P(^(1),"^",8),$O(^("SPL",0)) S ^XUTL("XQ",$J,"ADSPL")=%ZISIOS,ZISPLAD=%ZISIOS
"RTN","ZIS4ONT",61,0)
OK K %ZDA,%ZFN Q
"RTN","ZIS4ONT",62,0)
N K %ZDA,%ZFN,IO("DOC") S POP=1 Q
"RTN","ZIS4ONT",63,0)
 ;
"RTN","ZIS4ONT",64,0)
SPL2 I %ZOS="NT" O IO:(%ZFN:0) S IO(1,IO)="",^SPOOL(0,IO("DOC"),%ZFN)="",^SPOOL(%ZFN,0)=IO("DOC")_"{"_$H Q
"RTN","ZIS4ONT",65,0)
 O %ZFN:("WNS") G:$ZA<0 SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4ONT",66,0)
 ;
"RTN","ZIS4ONT",67,0)
SPL3 I %ZOS="NT" G SPL4:'$D(^SPOOL(%ZFN,2147483647)) O IO:(%ZFN:$P(^(2147483647),"{",3)):1 S:'$T ZISPLQ=1 K ^(2147483647) S IO(1,IO)="" Q
"RTN","ZIS4ONT",68,0)
 N $ETRAP S $ETRAP="S $EC="""" G SPL4^%ZIS4"
"RTN","ZIS4ONT",69,0)
 O %ZFN:"RV":1 S:'$T ZISPLQ=1 G:$ZA<0!('$T) SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4ONT",70,0)
 ;
"RTN","ZIS4ONT",71,0)
SPL4 W:'$D(IOP) !,"Spool file already open" S %ZFN=-1 Q
"RTN","ZIS4ONT",72,0)
 ;
"RTN","ZIS4ONT",73,0)
CLOSE N %ZOS,%Z1,%ZCR,%2,%3,%Y,ZTSK,%ZFN S %ZOS=$$OS^%ZOSV
"RTN","ZIS4ONT",74,0)
 I %ZOS="NT",IO=2,$D(IO(1,IO)) K IO(1,IO) C IO
"RTN","ZIS4ONT",75,0)
 I %ZOS="VMS",IO]"",$D(IO(1,IO)) U IO S %ZFN=$ZIO C IO K IO(1,IO)
"RTN","ZIS4ONT",76,0)
 ;See that ZTSK is set so we will move to the global now.
"RTN","ZIS4ONT",77,0)
 S ZTSK=1 D FILE^ZISPL1 I %ZDA'>0 K ZISPLAD Q
"RTN","ZIS4ONT",78,0)
 G:%ZOS="VMS" CLVMS
"RTN","ZIS4ONT",79,0)
 S %ZFN=$P(%ZS,"^",2),%ZCR=$C(13),%Y="",%=0,%3=$P(^SPOOL(%ZFN,2147483647),"{",3)
"RTN","ZIS4ONT",80,0)
 S %Z1=+$G(^XTV(8989.3,1,"SPL"))
"RTN","ZIS4ONT",81,0)
 F %2=1:1:%3 Q:'$D(^SPOOL(%ZFN,%2))  S %X=^SPOOL(%ZFN,%2) D
"RTN","ZIS4ONT",82,0)
 . I %Z1<% D LIMIT S %2=%3 Q
"RTN","ZIS4ONT",83,0)
 . I %X[$C(13,12) D:$L($P(%X,$C(13))) ADD($P(%X,$C(13))) D ADD("|TOP|") Q
"RTN","ZIS4ONT",84,0)
 . D ADD($P(%X,$C(13),1))
"RTN","ZIS4ONT",85,0)
 K ^SPOOL(%ZFN),^SPOOL(0,$P(%ZS,U,1)),%Y,%X,%1,%2,%3 D CLOSE^ZISPL1
"RTN","ZIS4ONT",86,0)
 Q
"RTN","ZIS4ONT",87,0)
ADD(L) S %=%+1,^XMBS(3.519,XS,2,%,0)=L Q
"RTN","ZIS4ONT",88,0)
LIMIT D ADD("*** INCOMPLETE REPORT  -- SPOOL DOCUMENT LINE LIMIT EXCEEDED ***") S $P(^XMB(3.51,%ZDA,0),"^",11)=1
"RTN","ZIS4ONT",89,0)
 Q
"RTN","ZIS4ONT",90,0)
CLVMS ;Close for Cache VMS
"RTN","ZIS4ONT",91,0)
 N $ES,$ET S $ET="D:$EC'[""ENDOF"" ^%ZTER,UNDWIND^%ZTER S $EC="""" D SPLEX,UNWIND^%ZTER"
"RTN","ZIS4ONT",92,0)
 ;%ZFN Could be set at the top
"RTN","ZIS4ONT",93,0)
 S %ZFN=$S($G(%ZFN)]"":%ZFN,1:$P(%ZS,"^",2)) D SPL3 Q:%ZFN']""  U %ZFN S %ZCR=$C(13),%Y=""
"RTN","ZIS4ONT",94,0)
 S %Z1=+$G(^XTV(8989.3,1,"SPL")),%=0
"RTN","ZIS4ONT",95,0)
 F  R %X#255:5 Q:$ZA<0  D  G:%Z1<% SPLEX
"RTN","ZIS4ONT",96,0)
 . I %Z1<% D LIMIT Q
"RTN","ZIS4ONT",97,0)
 . I %X[$C(12) D ADD("|TOP|") Q
"RTN","ZIS4ONT",98,0)
 . D ADD(%X)
"RTN","ZIS4ONT",99,0)
 . Q
"RTN","ZIS4ONT",100,0)
SPLEX C %ZFN:"D" K:%ZFN]"" IO(1,%ZFN) D CLOSE^ZISPL1 K %Y,%X,%1,%ZFN Q
"RTN","ZIS4ONT",101,0)
 ;
"RTN","ZIS4ONT",102,0)
 ;
"RTN","ZIS4ONT",103,0)
HFS G HFS^%ZISF
"RTN","ZIS4ONT",104,0)
REWMT(IO2,IOPAR) ;Rewind Magtape
"RTN","ZIS4ONT",105,0)
 N $ETRAP S $ET="G REWERR^%ZIS4"
"RTN","ZIS4ONT",106,0)
 U IO2 W *5
"RTN","ZIS4ONT",107,0)
 Q 1
"RTN","ZIS4ONT",108,0)
REWSDP(IO2,IOPAR) ;Rewind SDP
"RTN","ZIS4ONT",109,0)
 G REW1
"RTN","ZIS4ONT",110,0)
REWHFS(IO2,IOPAR) ;Rewind Host File.
"RTN","ZIS4ONT",111,0)
REW1 ;ZIS set % to the current $I so need to update % if = IO
"RTN","ZIS4ONT",112,0)
 N NIO,OP,$ETRAP
"RTN","ZIS4ONT",113,0)
 S $ET="G REWERR^%ZIS4"
"RTN","ZIS4ONT",114,0)
 C IO2 ;You do a rewind to read the file.
"RTN","ZIS4ONT",115,0)
 S OP=$S($ZV["VMS":"RV",1:"RS")
"RTN","ZIS4ONT",116,0)
 O IO2:(OP):1 S IO(1,IO2)=""
"RTN","ZIS4ONT",117,0)
 Q 1
"RTN","ZIS4ONT",118,0)
REWERR ;Error encountered
"RTN","ZIS4ONT",119,0)
 S IO("ERROR")=$EC,$ECODE=""
"RTN","ZIS4ONT",120,0)
 Q 0
"VER")
8.0^22.0
**END**
**END**
