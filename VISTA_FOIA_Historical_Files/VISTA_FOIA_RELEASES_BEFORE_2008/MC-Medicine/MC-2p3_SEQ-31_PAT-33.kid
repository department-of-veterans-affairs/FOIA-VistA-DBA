Released MC*2.3*33 SEQ #31
Extracted from mail message
**KIDS**:MC*2.3*33^

**INSTALL NAME**
MC*2.3*33
"BLD",3124,0)
MC*2.3*33^MEDICINE^0^3010608^y
"BLD",3124,1,0)
^^2^2^3010423^
"BLD",3124,1,1,0)
See patch Description MC*2.3*33 for a detailed description of this KIDS
"BLD",3124,1,2,0)
Build.
"BLD",3124,4,0)
^9.64PA^^
"BLD",3124,"ABPKG")
n
"BLD",3124,"KRN",0)
^9.67PA^19^17
"BLD",3124,"KRN",.4,0)
.4
"BLD",3124,"KRN",.4,"NM",0)
^9.68A^3^3
"BLD",3124,"KRN",.4,"NM",1,0)
MCARHEMB    FILE #694^694^0
"BLD",3124,"KRN",.4,"NM",2,0)
MCNONENDOPARAC    FILE #699^699^0
"BLD",3124,"KRN",.4,"NM",3,0)
MCARHEMBRPR    FILE #694^694^0
"BLD",3124,"KRN",.4,"NM","B","MCARHEMB    FILE #694",1)

"BLD",3124,"KRN",.4,"NM","B","MCARHEMBRPR    FILE #694",3)

"BLD",3124,"KRN",.4,"NM","B","MCNONENDOPARAC    FILE #699",2)

"BLD",3124,"KRN",.401,0)
.401
"BLD",3124,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",3124,"KRN",.402,0)
.402
"BLD",3124,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",3124,"KRN",.403,0)
.403
"BLD",3124,"KRN",.5,0)
.5
"BLD",3124,"KRN",.84,0)
.84
"BLD",3124,"KRN",3.6,0)
3.6
"BLD",3124,"KRN",3.8,0)
3.8
"BLD",3124,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",3124,"KRN",9.2,0)
9.2
"BLD",3124,"KRN",9.8,0)
9.8
"BLD",3124,"KRN",9.8,"NM",0)
^9.68A^187^4
"BLD",3124,"KRN",9.8,"NM",184,0)
MCARPS2^^0^B15965513
"BLD",3124,"KRN",9.8,"NM",185,0)
MCARUTL5^^0^B4131279
"BLD",3124,"KRN",9.8,"NM",186,0)
MCARP^^0^B32464303
"BLD",3124,"KRN",9.8,"NM",187,0)
MCARHP^^0^B18270053
"BLD",3124,"KRN",9.8,"NM","B","MCARHP",187)

"BLD",3124,"KRN",9.8,"NM","B","MCARP",186)

"BLD",3124,"KRN",9.8,"NM","B","MCARPS2",184)

"BLD",3124,"KRN",9.8,"NM","B","MCARUTL5",185)

"BLD",3124,"KRN",19,0)
19
"BLD",3124,"KRN",19,"NM",0)
^9.68A^^0
"BLD",3124,"KRN",19.1,0)
19.1
"BLD",3124,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",3124,"KRN",101,0)
101
"BLD",3124,"KRN",101,"NM",0)
^9.68A^^0
"BLD",3124,"KRN",409.61,0)
409.61
"BLD",3124,"KRN",771,0)
771
"BLD",3124,"KRN",771,"NM",0)
^9.68A^^0
"BLD",3124,"KRN",870,0)
870
"BLD",3124,"KRN",870,"NM",0)
^9.68A^^0
"BLD",3124,"KRN",8994,0)
8994
"BLD",3124,"KRN","B",.4,.4)

"BLD",3124,"KRN","B",.401,.401)

"BLD",3124,"KRN","B",.402,.402)

"BLD",3124,"KRN","B",.403,.403)

"BLD",3124,"KRN","B",.5,.5)

"BLD",3124,"KRN","B",.84,.84)

"BLD",3124,"KRN","B",3.6,3.6)

"BLD",3124,"KRN","B",3.8,3.8)

"BLD",3124,"KRN","B",9.2,9.2)

"BLD",3124,"KRN","B",9.8,9.8)

"BLD",3124,"KRN","B",19,19)

"BLD",3124,"KRN","B",19.1,19.1)

"BLD",3124,"KRN","B",101,101)

"BLD",3124,"KRN","B",409.61,409.61)

"BLD",3124,"KRN","B",771,771)

"BLD",3124,"KRN","B",870,870)

"BLD",3124,"KRN","B",8994,8994)

"BLD",3124,"QUES",0)
^9.62^^
"BLD",3124,"REQB",0)
^9.611^2^2
"BLD",3124,"REQB",1,0)
MC*2.3*15^2
"BLD",3124,"REQB",2,0)
MC*2.3*27^2
"BLD",3124,"REQB","B","MC*2.3*15",1)

"BLD",3124,"REQB","B","MC*2.3*27",2)

"KRN",.4,1729,-1)
0^1
"KRN",.4,1729,0)
MCARHEMB^3010418.1156^^694^^^3010418
"KRN",.4,1729,"DXS",1,9.2)
S DIP(1)=$S($D(^MCAR(694,D0,0)):^(0),1:"") S X=$S('$D(^MCAR(697.2,+$P(DIP(1),U,3),0)):"",1:$P(^(0),U,1))="BMA",DIP(2)=X S X="BONE MARROW ASPIRATE",DIP(3)=X
"KRN",.4,1729,"DXS",1,9.3)
X DXS(1,9.2) S X=$S('$D(^MCAR(697.2,+$P(DIP(1),U,3),0)):"",1:$P(^(0),U,1))="BMB",DIP(4)=X S X="BONE MARROW BIOPSY",DIP(5)=X
"KRN",.4,1729,"DXS",1,9.4)
X DXS(1,9.3) S X=$S('$D(^MCAR(697.2,+$P(DIP(1),U,3),0)):"",1:$P(^(0),U,1))="HEM",DIP(6)=X S X="HEMATOLOGY",DIP(7)=X S X=1,DIP(8)=X S X=""
"KRN",.4,1729,"DXS",2,9.2)
S DIP(1)=$S($D(^MCAR(694,D0,0)):^(0),1:"") S X=$S('$D(^MCAR(697,+$P(DIP(1),U,5),0)):"",1:$P(^(0),U,1))'="",DIP(2)=X S X=","_$S('$D(^MCAR(697,+$P(DIP(1),U,5),0)):"",1:$P(^(0),U,1))
"KRN",.4,1729,"DXS",3,9)
I $D(^MCAR(694,MCARGDA,10,1,0))!($S('$D(^MCAR(694,MCARGDA,1)):0,$P(^(1),U,2)'="":1,1:0)) W !!,?4,"PROVISIONAL DIAGNOSIS(ES):"
"KRN",.4,1729,"F",1)
"WARD/CLINIC: ";C5~3;C18;X~"PROCEDURE:  ";C5~
"KRN",.4,1729,"F",2)
X DXS(1,9.4) S X=$S(DIP(2):DIP(3),DIP(4):DIP(5),DIP(6):DIP(7),DIP(8):X) W X K DIP;X;Z;"$S(#2="BMA":"BONE MARROW ASPIRATE",#2="BMB":"BONE MARROW BIOPSY",#2="HEM":"HEMATOLOGY",1:"")"~
"KRN",.4,1729,"F",3)
X DXS(2,9.2) S DIP(3)=X S X=1,DIP(4)=X S X="",X=$S(DIP(2):DIP(3),DIP(4):X) W X K DIP;X;Z;"$S(#2.5'="":","_ANATOMIC SITE,1:"")"~"PERFORMED BY:";C5;S~
"KRN",.4,1729,"F",4)
50;C19;X~"DATE PERFORMED:";C50~
"KRN",.4,1729,"F",5)
S DIP(1)=$S($D(^MCAR(694,D0,0)):^(0),1:"") S X=$P(DIP(1),U,8) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;C66;X;Z;"NUMDATE(DATE PERFORMED)"~
"KRN",.4,1729,"F",6)
"APPROVED BY:";C5~51;C19;X~"DATE APPROVED:";C50~
"KRN",.4,1729,"F",7)
S DIP(1)=$S($D(^MCAR(694,D0,1)):^(1),1:"") S X=$P(DIP(1),U,10) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;X;C66;Z;"NUMDATE(APPROVAL DATE)"~
"KRN",.4,1729,"F",8)
"DATE OF ORIGINAL CONSULT:";C40~
"KRN",.4,1729,"F",9)
S DIP(1)=$S($D(^MCAR(694,D0,0)):^(0),1:"") S X=$P(DIP(1),U,7) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;C66;X;Z;"NUMDATE(ORIGINAL CONSULT DATE)"~
"KRN",.4,1729,"F",10)
"INDICATION(S) FOR PERFORMANCE: ";C5;S~57,.01;C10~58,.01;C7;W70~
"KRN",.4,1729,"F",11)
X DXS(3,9);Z;"I $D(^MCAR(694,MCARGDA,10,1,0))!($S('$D(^MCAR(694,MCARGDA,1)):0,$P(^(1),U,2)'="":1,1:0)) W !!,?4,"PROVISIONAL DIAGNOSIS(ES):""~
"KRN",.4,1729,"F",12)
38,.01;C10;W70~6.5;C7;W70~" ";C1;S~
"KRN",.4,1729,"F",13)
D BMB^MCARHP:$P(^MCAR(697.2,$P(^MCAR(694,D0,0),U,3),0),U)="BMB";Z;"D BMB^MCARHP:$P(^MCAR(697.2,$P(^MCAR(694,D0,0),U,3),0),U)="BMB""~
"KRN",.4,1729,"F",14)
"PERIPHERAL BLOOD SMEAR:";C5;X~56;C30;X;W70~
"KRN",.4,1729,"H")
@
"KRN",.4,1729,"IOM")
80
"KRN",.4,1729,"LAST")

"KRN",.4,1729,"ROU")
^MCAROHB
"KRN",.4,1729,"ROUOLD")
MCAROHB
"KRN",.4,1729,"SUB")
1
"KRN",.4,1773,-1)
0^3
"KRN",.4,1773,0)
MCARHEMBRPR^3010418.1204^^694^^^3010418
"KRN",.4,1773,"DXS",1,9.2)
S DIP(1)=$S($D(^MCAR(694,D0,0)):^(0),1:"") S X=$S('$D(^MCAR(697.2,+$P(DIP(1),U,3),0)):"",1:$P(^(0),U,1))="BMA",DIP(2)=X S X="BONE MARROW ASPIRATE",DIP(3)=X
"KRN",.4,1773,"DXS",1,9.3)
X DXS(1,9.2) S X=$S('$D(^MCAR(697.2,+$P(DIP(1),U,3),0)):"",1:$P(^(0),U,1))="BMB",DIP(4)=X S X="BONE MARROW BIOPSY",DIP(5)=X
"KRN",.4,1773,"DXS",1,9.4)
X DXS(1,9.3) S X=$S('$D(^MCAR(697.2,+$P(DIP(1),U,3),0)):"",1:$P(^(0),U,1))="HEM",DIP(6)=X S X="HEMATOLOGY",DIP(7)=X S X=1,DIP(8)=X S X=""
"KRN",.4,1773,"DXS",2,9)
S DIP(2)=$C(59)_$P($G(^DD(694,9.5,0)),U,3),DIP(1)=$S($D(^MCAR(694,D0,1)):^(1),1:"") S X="IRON STORES: "_$P($P(DIP(2),$C(59)_$P(DIP(1),U,6)_":",2),$C(59),1)
"KRN",.4,1773,"DXS",3,9)
S DIP(2)=$C(59)_$P($G(^DD(694,10,0)),U,3),DIP(1)=$S($D(^MCAR(694,D0,1)):^(1),1:"") S X="MEGAKARYOCYTES: "_$P($P(DIP(2),$C(59)_$P(DIP(1),U,5)_":",2),$C(59),1)
"KRN",.4,1773,"DXS",4,"D")
DECREASED
"KRN",.4,1773,"DXS",4,"I")
INCREASED
"KRN",.4,1773,"DXS",4,"N")
NORMAL
"KRN",.4,1773,"DXS",5,"A")
Abnormal
"KRN",.4,1773,"DXS",5,"N")
Normal
"KRN",.4,1773,"DXS",5,"ND")
Non-Diagnostic
"KRN",.4,1773,"DXS",5,"T")
Technically unsatisfactory
"KRN",.4,1773,"F",1)
"PROCEDURE: ";C5;S~
"KRN",.4,1773,"F",2)
X DXS(1,9.4) S X=$S(DIP(2):DIP(3),DIP(4):DIP(5),DIP(6):DIP(7),DIP(8):X) W X K DIP;X;Z;"$S(#2="BMA":"BONE MARROW ASPIRATE",#2="BMB":"BONE MARROW BIOPSY",#2="HEM":"HEMATOLOGY",1:"")"~
"KRN",.4,1773,"F",3)
"INDICATION(S) FOR PERFORMANCE: ";C5;S~57,.01;C10~"PROVISIONAL DIAGNOSIS(ES):";C5;S~38,.01;C10;W70~6.5;C7;W70~"CELLULARITY: ";C5;S~8;X~
"KRN",.4,1773,"F",4)
X DXS(2,9) W X K DIP;C5;Z;""IRON STORES: "_IRON STORES"~X DXS(3,9) W X K DIP;C5;Z;""MEGAKARYOCYTES: "_MEGAKARYOCYTES"~"FINAL DIAGNOSIS(ES): ";C5;S~
"KRN",.4,1773,"F",5)
35,.01;C10;W70~41,.01;C7;W70~"SUMMARY: ";C5;S~1.5;X~"PROCEDURE SUMMARY: ";C5;S~600;X;W70;C10~S MCFILE=694 D DISP^MCMAG;Z;"S MCFILE=694 D DISP^MCMAG"~
"KRN",.4,1773,"F",6)
K MCFILE;Z;"K MCFILE"~
"KRN",.4,1773,"H")
@
"KRN",.4,1773,"IOM")
80
"KRN",.4,1773,"LAST")

"KRN",.4,1773,"ROU")
^MCOBHEM
"KRN",.4,1773,"ROUOLD")
MCOBHEM
"KRN",.4,1773,"SUB")
1
"KRN",.4,2171,-1)
0^2
"KRN",.4,2171,0)
MCNONENDOPARAC^3010525.1446^^699^^^3010525
"KRN",.4,2171,"DXS",1,1)
ELECTIVE
"KRN",.4,2171,"DXS",1,2)
URGENT
"KRN",.4,2171,"DXS",1,3)
EMERGENCY
"KRN",.4,2171,"DXS",2,"IM")
INTRAMUSCULAR
"KRN",.4,2171,"DXS",2,"IV")
INTRAVENOUS
"KRN",.4,2171,"DXS",2,"O")
ORAL
"KRN",.4,2171,"DXS",2,"PV")
PARAVARICEAL
"KRN",.4,2171,"DXS",2,"SM")
SUBMUCOSAL
"KRN",.4,2171,"DXS",2,"SQ")
SUBCUTANEOUS
"KRN",.4,2171,"DXS",2,"T")
TOPICAL
"KRN",.4,2171,"DXS",2,"V")
INTRAVARICEAL
"KRN",.4,2171,"DXS",3,1)
WASH
"KRN",.4,2171,"DXS",3,2)
IMMERSION
"KRN",.4,2171,"DXS",3,3)
GAS
"KRN",.4,2171,"DXS",3,4)
UNKNOWN
"KRN",.4,2171,"DXS",3,5)
OTHER
"KRN",.4,2171,"DXS",4,"A")
ABNORMAL
"KRN",.4,2171,"DXS",4,"I")
INCOMPLETE EXAMINATION
"KRN",.4,2171,"DXS",4,"N")
NORMAL
"KRN",.4,2171,"DXS",5,1)
REQUIRED NO THERAPY
"KRN",.4,2171,"DXS",5,2)
REQUIRED TRANSFUSION
"KRN",.4,2171,"DXS",5,3)
REQUIRED MEDICAL THERAPY
"KRN",.4,2171,"DXS",5,4)
REQUIRED ENDOSCOPIC THERAPY
"KRN",.4,2171,"DXS",5,5)
REQUIRED SURGICAL THERAPY
"KRN",.4,2171,"DXS",5,6)
RESULTED IN DEATH
"KRN",.4,2171,"F",1)
"PRIMARY PROVIDER: ";C5~701;X~"FELLOW: ";C5~200;X~"2ND FELLOW: ";C40~201;X~"PREFORMED AT: ";C5~8;X~"PREFORMED BY: ";C40~6;X~"WARD/CLINIC: ";C5~9;X~
"KRN",.4,2171,"F",2)
"PROCEDURE: ";C5;S~-697.2,^MCAR(697.2,^^S I(0,0)=D0 S DIP(1)=$S($D(^MCAR(699,D0,0)):^(0),1:"") S X=$P(DIP(1),U,12),X=X S D(0)=+X;Z;"1:"~-697.2,7;X~
"KRN",.4,2171,"F",3)
"PROCEDURE SUMMARY: ";C5~600;X~"PROCEDURE START TIME: ";C5;S~10;X~"PROCEDURE STOP TIME: ";C40~11;X~"URGENCY: ";C5;S~12;X~"PROTOCOL: ";C5;S~2.8;X~
"KRN",.4,2171,"F",4)
"EGD SIMPLE PRI. EXAM: ";C5;S~2.85;X~"LAB OR XRAY: ";C5;S~2.86;X~"OCCULT BLOOD: ";C5;S~2.87;X~"SPECIMEN COLLECTION: ";C5;S~2.88;X~
"KRN",.4,2171,"F",5)
"PRESCRIPTION GIVEN: ";C5;S~40," ";C10~40,.01;X~40,"DOSAGE: ";C50~40,1;X~"INSTRUCTION: ";C5;S~203,.01~"INSTRUMENT: ";C5;S~4,.01;X~"MEDICATIONS: ";C5;S~
"KRN",.4,2171,"F",6)
5," ";C10~5,.01;X~5,"DOSE ROUTE: ";C30~5,1;X~5,"TOTAL DOSE: ";C60~5,2;X~"POST-PROCEDURE INST. CLEANING: ";C5;S~29;X~"SIGNS AND SYMPTOMS: ";C5;S~
"KRN",.4,2171,"F",7)
2.2,.01;C26;X~"SUMMARY: ";C5;S~202;X~"RESULTS: ";C5;S~28,.01;C15;X~"FOLLOWUP DEVICE/THERAPY: ";C5;S~2.6,.01;C31;X~"SURVEILLANCE: ";C5;S~2.7,.01;C21;X~
"KRN",.4,2171,"F",8)
"INDICATION COMMENTS: ";C5;S~3;X~"INDICATED THERAPY: ";C5;S~2.1,.01;C25;X~"DISEASE FOLLOWUP: ";C5;S~2.5,.01;C24;X~"COMPLICATION: ";C5;S~30," ";C10~
"KRN",.4,2171,"F",9)
30,.01;X~30,"COMP. RESULTS: ";C50~30,1;X~"DIAGNOSIS: ";C5;S~37.1,.01~S MCFILE=699 D DISP^MCMAG;Z;"S MCFILE=699 D DISP^MCMAG"~K MCFILE;Z;"K MCFILE"~
"KRN",.4,2171,"H")
@
"KRN",.4,2171,"IOM")
75
"KRN",.4,2171,"LAST")
1
"KRN",.4,2171,"ROU")
^MCPARC
"KRN",.4,2171,"ROUOLD")
MCPARC
"KRN",.4,2171,"SUB")
1
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",31,-1)
1^1
"PKG",31,0)
MEDICINE^MC^MEDICINE PACKAGE INCLUDES ALL AREAS OF MEDICINE
"PKG",31,20,0)
^9.402P^^
"PKG",31,22,0)
^9.49I^1^1
"PKG",31,22,1,0)
2.3^2960913^2980615^4558
"PKG",31,22,1,"PAH",1,0)
33^3010608
"PKG",31,22,1,"PAH",1,1,0)
^^2^2^3010608
"PKG",31,22,1,"PAH",1,1,1,0)
See patch Description MC*2.3*33 for a detailed description of this KIDS
"PKG",31,22,1,"PAH",1,1,2,0)
Build.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","MCARHP")
0^187^B18270053
"RTN","MCARHP",1,0)
MCARHP ;WISC/SAE,TJK,WAA-PRINT HEMATOLOGY REPORTS ;9/18/98  10:18
"RTN","MCARHP",2,0)
 ;;2.3;Medicine;**15,16,19,33**;09/13/1996
"RTN","MCARHP",3,0)
LOOK ;
"RTN","MCARHP",4,0)
 I +($G(MCARGDA))>0 G EN1 ; MC*2.3*33
"RTN","MCARHP",5,0)
 D MCPPROC^MCARP
"RTN","MCARHP",6,0)
 S DIC="^MCAR(694,",(MCFILE,MCFILE1)=+$P(DIC,"(",2),DIC(0)="AEZMQ"
"RTN","MCARHP",7,0)
 S:MCESON DIC("S")=$$PREVIEW^MCESSCR(MCFILE)
"RTN","MCARHP",8,0)
 D ^DIC G EXIT:Y<0 S (MCARGDA,D0)=+Y
"RTN","MCARHP",9,0)
 W !!
"RTN","MCARHP",10,0)
EN1 ;ENTRY POINT FROM SUMMARY OF PATIENT PROCEDURES ROUTINE
"RTN","MCARHP",11,0)
 S MCARZ="HEMATOLOGY REPORT"
"RTN","MCARHP",12,0)
 D:$G(MCESON) STATUS^MCESPRT(MCFILE,MCARGDA)
"RTN","MCARHP",13,0)
 I $D(ORHFS) U IO G HEM ;dcm/slc added for CPRS
"RTN","MCARHP",14,0)
DEVQUE ; Device control and queuing control
"RTN","MCARHP",15,0)
 K IO("Q") S %ZIS="MQ" D ^%ZIS G EXIT:POP
"RTN","MCARHP",16,0)
 I $D(IO("Q")) S ZTRTN="HEM^MCARHP",(ZTSAVE("MC*"),ZTSAVE("DIC"))="",ZTDESC="Hematology Report" D ^%ZTLOAD K ZTSK G EXIT
"RTN","MCARHP",17,0)
 U IO
"RTN","MCARHP",18,0)
HEM ; Print Report and entry point for queued report
"RTN","MCARHP",19,0)
INIT ; Initialize variables
"RTN","MCARHP",20,0)
 K DXS,DIOT(2),^UTILITY($J),MCOUT
"RTN","MCARHP",21,0)
 S PG=0,D0=MCARGDA,DFN=$P(^MCAR(694,D0,0),U,2),MCARGDT=$P(^(0),U),MCARZ="HEMATOLOGY REPORT" S:MCESON MCARZ=MCARZ_" - "_MCSTAT
"RTN","MCARHP",22,0)
 S X=MCARGDT D DTIME^MCARP S MCARGDT2=X D NOW^%DTC S X=% D DTIME^MCARP S MCARDTM=X
"RTN","MCARHP",23,0)
 ; ------------------------
"RTN","MCARHP",24,0)
 ; SSN = Enternal Format of the patients SSN with the first letter
"RTN","MCARHP",25,0)
 ; of the last name tacked on the end
"RTN","MCARHP",26,0)
 ; ------------------------
"RTN","MCARHP",27,0)
 D DEM^VADPT S MCARGNM=VADM(1),SSN=VA("PID"),X=$P(VADM(3),"^",2),MCARDOB=$S(X'="":X,1:"") D KVAR^VADPT
"RTN","MCARHP",28,0)
 D INP^VADPT S MCARWARD=$S(VAIN(4)'="":$P(VAIN(4),U,2),1:"NOT INPATIENT"),MCARRB=VAIN(5) D KVAR^VADPT
"RTN","MCARHP",29,0)
 S ^UTILITY($J,1)="S MCY="""" I $Y>(IOSL-3) R:$E(IOST,1,2)=""C-"" !!,""Press return to continue, '^' to escape: "",MCY:DTIME S:'$T MCY=U S:MCY=U DN=0,MCOUT=1 D:DN HEAD^MCARP K MCY"
"RTN","MCARHP",30,0)
HEMP ; Bone Marrow basic print (MCAROHB), and Differential (MCAROHD)
"RTN","MCARHP",31,0)
 S MCFILET=MCFILE
"RTN","MCARHP",32,0)
 D HEAD^MCARP D:MCBS ^MCOBHEM D:'MCBS ^MCAROHB K DXS G EXIT:$D(MCOUT)
"RTN","MCARHP",33,0)
 I $D(^MCAR(694,D0,4)),'MCBS D ^MCAROHD K DXS G EXIT:$D(MCOUT)
"RTN","MCARHP",34,0)
 D:'MCBS ^MCAROHF G EXIT:$D(MCOUT)
"RTN","MCARHP",35,0)
 S MCFILE=MCFILET
"RTN","MCARHP",36,0)
 D FOOTER^MCESPRT(MCFILE,MCARGDA)
"RTN","MCARHP",37,0)
 R:$E(IOST,1,2)="C-" !!,"Press return to continue ",X:DTIME
"RTN","MCARHP",38,0)
 G EXIT
"RTN","MCARHP",39,0)
BMB ; Print fields specific to BMB
"RTN","MCARHP",40,0)
 G BMB2:'$D(^MCAR(694,D0,6)),BMB2:$P(^MCAR(694,D0,6),U,3)=""
"RTN","MCARHP",41,0)
 S NP=$P(^MCAR(694,D0,6),U,3),FX=$P(^(6),U,2)
"RTN","MCARHP",42,0)
 S FX=$S(FX="M":"Methanol",FX="E":"Ethanol",1:"Formalin")
"RTN","MCARHP",43,0)
 I $Y>(IOSL-3),$E(IOST,1,2)="C-" R !!,"Press return to continue, '^' to escape: ",X:DTIME S:'$T X=U G:X=U BMBQ D HEAD^MCARP
"RTN","MCARHP",44,0)
 W ?4,"GROSS DESCRIPTION:  The specimen consisted of "_NP_" piece(s), measuring",!,?23
"RTN","MCARHP",45,0)
 F AZ=1:1:NP S LP=$P(^MCAR(694,D0,6),U,AZ+3) W:LP'="" $S(AZ'=1:" mm, ",1:" "),LP
"RTN","MCARHP",46,0)
 W " mm, submitted in "_FX_"."
"RTN","MCARHP",47,0)
 W !!
"RTN","MCARHP",48,0)
 I $Y>(IOSL-3),($E(IOST,1,2)="C-") R !!,"Press return to continue, '^' to escape: ",X:DTIME S:'$T X=U G:X=U BMBQ D HEAD^MCARP
"RTN","MCARHP",49,0)
BMB2 G BMB21:'$D(^MCAR(694,D0,9)) S X=^(9)
"RTN","MCARHP",50,0)
 I $P(X,U,1)="Y" W ?6,"This specimen is submitted for decalcification in EDTA."
"RTN","MCARHP",51,0)
 I $P(X,U,2)="Y" W !,?6,"Part of the specimen is fixed and submitted for processing in plastic."
"RTN","MCARHP",52,0)
BMB21 K X G BMBQ:$P(^MCAR(694,D0,0),U,6)="" W !!,?4,"BIOPSY COMMENTS:" K ^UTILITY($J,"W")
"RTN","MCARHP",53,0)
 S DIWL=23,DIWR=IOM,DIWF="WC56",X=$P(^MCAR(694,D0,0),U,6) Q:$P(^(0),U,6)=""
"RTN","MCARHP",54,0)
 D ^DIWP,^DIWW W !
"RTN","MCARHP",55,0)
 K X I $Y>(IOSL-3),($E(IOST,1,2)="C-") R !!,"Press return to continue, '^' to escape: ",X:DTIME S:'$T X=U G:X=U BMBQ D HEAD^MCARP
"RTN","MCARHP",56,0)
BMBQ I $D(X),X=U S MCOUT=1
"RTN","MCARHP",57,0)
 Q
"RTN","MCARHP",58,0)
UNRELP ;ENTRY POINT FOR SUPERVISOR TO PRINT UNRELEASED REPORT
"RTN","MCARHP",59,0)
 S MCAREL="" G LOOK
"RTN","MCARHP",60,0)
REL S DIC="^MCAR(694,",DIC(0)="AEMZQ" D ^DIC G EXIT:Y<0
"RTN","MCARHP",61,0)
 S $P(^MCAR(694,+Y,0),U,9)="Y"
"RTN","MCARHP",62,0)
 W !,*7,"Report Released for Printing." R !,"* END * Press return to continue: ",X:DTIME
"RTN","MCARHP",63,0)
EXIT S:$D(ZTQUEUED) ZTREQ="@" K ZTSK
"RTN","MCARHP",64,0)
 K %Y,LPDT,X,Y,DIC,IOP,MCARPPS,IJ,PT,D1,NE,NP,FX,AZ,PG,Z,L,FLDS,MCAREL,MCOUT,VA
"RTN","MCARHP",65,0)
 K ^UTILITY($J),IO("Q"),MCARGDA,MCARGDT,SSN K MCARGNM,MCARGRTN,X,DFN,SSN
"RTN","MCARHP",66,0)
 K MCARGNUM,MCARGNAM,MCARZ,DN,D0,MCARCODE,DIOEND,DIOBEG,DI,DICS,DICSS,MCARWARD,MCARDTM,MCARDOB,MCARRB,MCARGDT,MCOUNT,MCFOOTER
"RTN","MCARHP",67,0)
 K DJ,BY,A,DIEDT,DIQ,DIPZ,DIL,DXS,DALL,DSC,DCL,DPP,DPQ,DQI,DU,DY
"RTN","MCARHP",68,0)
 K S,LP,DC,DL,DV,DE,DA,DK,Y,R,C,D,I,J,Q,M,P,N,D1,DIW,DIWL,DIWR,DIWF,DIWT
"RTN","MCARHP",69,0)
 D ^%ZISC Q
"RTN","MCARP")
0^186^B32464303
"RTN","MCARP",1,0)
MCARP ;WISC/TJK,WAA-PRINT ROUTINES ;12/15/97  14:54
"RTN","MCARP",2,0)
 ;;2.3;Medicine;**6,14,15,18,27,33**;09/13/1996
"RTN","MCARP",3,0)
 ;Please reference the following IA's
"RTN","MCARP",4,0)
 ; 2432,1576,10035
"RTN","MCARP",5,0)
 ;
"RTN","MCARP",6,0)
CATH ;
"RTN","MCARP",7,0)
 S DIC="^MCAR(691.1,",MCARZ="CATHETERIZATION REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"CATHB",1:"CATH1") G LOOK
"RTN","MCARP",8,0)
ECHO S DIC="^MCAR(691,",MCARZ="ECHO REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ECHOB",1:"ECHO1") G LOOK
"RTN","MCARP",9,0)
ECG S DIC="^MCAR(691.5,",MCARZ="ECG REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ECGB",1:"ECG1") G LOOK
"RTN","MCARP",10,0)
EP S DIC="^MCAR(691.8,",MCARZ="EP REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"EPB",1:"EP1") G LOOK
"RTN","MCARP",11,0)
HOLTER S DIC="^MCAR(691.6,",MCARZ="HOLTER REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"HOLTERB",1:"HOLTER1") G LOOK
"RTN","MCARP",12,0)
RHFULL S DIC="^MCAR(701,",MCARZ="RHEUMATOLOGY REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"RHB",1:"RHFULL1") G LOOK
"RTN","MCARP",13,0)
ETT S DIC="^MCAR(691.7,",MCARZ="ETT REPORT",MCARGRTN=$S('$$XTRCT(XQY0):"ETTB",1:"ETT1")
"RTN","MCARP",14,0)
LOOK ;
"RTN","MCARP",15,0)
 D MCPPROC
"RTN","MCARP",16,0)
 I '$D(MCARPPS) D LOOK2,^DIC G:Y<0 EXIT S (MCARGDA,DA)=+Y
"RTN","MCARP",17,0)
 I $G(MCESON),$D(^MCAR(MCFILE,MCARGDA,"ES")) D STATUS^MCESPRT(MCFILE,MCARGDA)
"RTN","MCARP",18,0)
 I $D(ORHFS) U IO G PRINT ;dcm/slc added for CPRS
"RTN","MCARP",19,0)
DEVQUE ; Device Control and Queuing Control
"RTN","MCARP",20,0)
 K IO("Q") S %ZIS="MQ" D ^%ZIS I POP S MCOUT="" G EXIT
"RTN","MCARP",21,0)
 I $D(IO("Q")) S (ZTSAVE("DIC"),ZTSAVE("MC*"))="",ZTRTN="PRINT^MCARP",ZTDESC=MCARZ D ^%ZTLOAD K ZTSK G EXIT
"RTN","MCARP",22,0)
 U IO
"RTN","MCARP",23,0)
PRINT ; Print Report
"RTN","MCARP",24,0)
 I DIC="^MCAR(699," D  ;MC*2.3*33
"RTN","MCARP",25,0)
 .N MCHLD,MCHLD2 ;MC*2.3*33
"RTN","MCARP",26,0)
 .S MCHLD=$$GET1^DIQ(699,MCARGDA,1,"I") ;MC*2.3*33
"RTN","MCARP",27,0)
 .S MCHLD2=$$GET1^DIQ(697.2,MCARGNUM,1,"I") ;MC*2.3*33
"RTN","MCARP",28,0)
 .I MCHLD'=MCHLD2 S MCARGRTN="PARAC" ;MC*2.3*33
"RTN","MCARP",29,0)
 .Q  ;MC*2.3*33
"RTN","MCARP",30,0)
 K DXS,DIOT(2),^UTILITY($J),MCOUT S (D0,DA)=MCARGDA,PG=0
"RTN","MCARP",31,0)
 S DFN=$P(^MCAR(+$P(DIC,"(",2),MCARGDA,0),U,2),MCARGDT=$P(^(0),U,1) S:DIC[699 MCARGNUM=$P(^(0),U,$S(DIC[699.5:6,1:12))
"RTN","MCARP",32,0)
RHPRT ;
"RTN","MCARP",33,0)
 D INIT^MCARP1(MCARZ,MCARGDT,MCFILE)
"RTN","MCARP",34,0)
 S ^UTILITY($J,1)="S MCY="""" I $Y>IOSL-3 R:$E(IOST,1,2)=""C-"" !!,""Press return to continue, '^' to escape: "",MCY:DTIME S:'$T MCY=U S:MCY=U DN=0,MCOUT=1 D:DN HEAD^MCARP K MCY"
"RTN","MCARP",35,0)
 D HEAD,CALLTEM
"RTN","MCARP",36,0)
 I '$D(MCOUT) D:$G(MCESON) FOOTER^MCESPRT(MCFILE,MCARGDA)
"RTN","MCARP",37,0)
 S:$D(ZTQUEUED) ZTREQ="@" K ZTSK
"RTN","MCARP",38,0)
 G EXIT
"RTN","MCARP",39,0)
CALLTEM ;
"RTN","MCARP",40,0)
 N MCFILE D @MCARGRTN Q
"RTN","MCARP",41,0)
EXIT ;
"RTN","MCARP",42,0)
 D EXIT^MCARP1 Q
"RTN","MCARP",43,0)
LOOK2 ;
"RTN","MCARP",44,0)
 S DIC(0)="AEMQ",DIC("A")="Enter patient name or the date & time: "
"RTN","MCARP",45,0)
 I MCESON S DIC("S")=$$PREVIEW^MCESSCR(MCFILE)
"RTN","MCARP",46,0)
 Q
"RTN","MCARP",47,0)
CATH1 D ^MCAROC1 K DXS Q:$D(MCOUT)  D ^MCAROC2 K DXS Q:$D(MCOUT)  D ^MCAROC3 K DXS Q:$D(MCOUT)  D ^MCAROC4 Q
"RTN","MCARP",48,0)
CATHB D ^MCOBC1 Q
"RTN","MCARP",49,0)
ECHO1 D ^MCRPEC K DXS Q:$D(MCOUT)  Q
"RTN","MCARP",50,0)
ECHOB D ^MCOBK Q
"RTN","MCARP",51,0)
ECG1 D ^MCAROK Q
"RTN","MCARP",52,0)
ECGB D ^MCOBE1 Q
"RTN","MCARP",53,0)
EPB D ^MCOBEP Q
"RTN","MCARP",54,0)
EP1 D ^MCAROEP G EPEND:$D(MCOUT)
"RTN","MCARP",55,0)
 G VT:'$D(^MCAR(691.9,"C",MCARGDA))
"RTN","MCARP",56,0)
 S MCY=""
"RTN","MCARP",57,0)
 I $Y>IOSL-3 R:$E(IOST,1,2)="C-" !!,"Press return to continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:$E(MCY)=U MCOUT=1 G:$G(MCOUT)=1 EPEND
"RTN","MCARP",58,0)
 F D0=0:0 S D0=$O(^MCAR(691.9,"C",MCARGDA,D0)) Q:D0=""  K DXS D HEAD,^MCAROAT G EPEND:$D(MCOUT)
"RTN","MCARP",59,0)
VT Q:'$D(^MCAR(692,"C",MCARGDA))
"RTN","MCARP",60,0)
 I $Y>IOSL-3 R:$E(IOST,1,2)="C-" !!,"Press return to continue, '^' to escape: ",MCY:DTIME S:'$T MCY=U S:$E(MCY)=U MCOUT=1 G:$G(MCOUT)=1 EPEND
"RTN","MCARP",61,0)
 F D0=0:0 S D0=$O(^MCAR(692,"C",MCARGDA,D0)) Q:D0=""  K DXS D HEAD,^MCAROV Q:$D(MCOUT)
"RTN","MCARP",62,0)
EPEND Q
"RTN","MCARP",63,0)
ETT1 D ^MCAROT Q
"RTN","MCARP",64,0)
ETTB D ^MCOBT Q
"RTN","MCARP",65,0)
HOLTER1 D ^MCAROH1 K DXS Q:$D(MCOUT)  D ^MCAROH2 Q
"RTN","MCARP",66,0)
HOLTERB D ^MCOBH1 Q
"RTN","MCARP",67,0)
GENERIC D ^MCAROGE Q
"RTN","MCARP",68,0)
GENERICB D ^MCOBGEN Q
"RTN","MCARP",69,0)
GI I $D(^DIC(120.8)) D ^MCAROGM I 1 ;    new allergy info
"RTN","MCARP",70,0)
 E  D ^MCAROG
"RTN","MCARP",71,0)
 K DXS
"RTN","MCARP",72,0)
 D:'$D(MCOUT) ^MCAROGA
"RTN","MCARP",73,0)
 Q
"RTN","MCARP",74,0)
PARAC D ^MCPARC Q  ; MC*2.3*33
"RTN","MCARP",75,0)
GIB D ^MCOBGA Q
"RTN","MCARP",76,0)
PULM D ^MCAROP K DXS Q:$D(MCOUT)  D ^MCAROPE Q
"RTN","MCARP",77,0)
PULMB D ^MCOBPE Q
"RTN","MCARP",78,0)
NONENDO D ^MCAROGN Q
"RTN","MCARP",79,0)
NONENDOB D ^MCOBGN Q
"RTN","MCARP",80,0)
CONSULT D ^MCAROGC Q
"RTN","MCARP",81,0)
CONSULTB D ^MCOBGC Q
"RTN","MCARP",82,0)
GENIMP D ^MCAROPG Q
"RTN","MCARP",83,0)
GENIMPB D ^MCOBPG Q
"RTN","MCARP",84,0)
ALEAD D ^MCAROPA Q
"RTN","MCARP",85,0)
ALEADB D ^MCOBPA Q
"RTN","MCARP",86,0)
VLEAD D ^MCAROPV Q
"RTN","MCARP",87,0)
VLEADB D ^MCOBPV Q
"RTN","MCARP",88,0)
SURV D ^MCAROPS Q
"RTN","MCARP",89,0)
SURVB D ^MCOBPS Q
"RTN","MCARP",90,0)
RHFULL1 ;
"RTN","MCARP",91,0)
 I +$G(MCRH)=0 D RHFULL2 Q
"RTN","MCARP",92,0)
 S MCFILE=701,V=MCRH,MCRHR="^MCAROR"_$S(V=1:"A",V=2:"B",V=3:"N",V=4:"L",V=6:"Q",V=7:"H",V=8:"P",V=9:"D",1:"RHFULL2^MCARP") D @MCRHR K DXS Q:$D(MCOUT)  D:V=8 ^MCARORE K DXS Q:$D(MCOUT)  D:MCRH=1 DISP^MCMAG Q
"RTN","MCARP",93,0)
RHFULL2 ;
"RTN","MCARP",94,0)
 F RH="A","B","N","L","Q","H","P","E","D" Q:$D(MCOUT)  D
"RTN","MCARP",95,0)
 .S MCFILE=701,MCRHR="^MCAROR"_RH D @MCRHR K DXS Q:$D(MCOUT)
"RTN","MCARP",96,0)
 .I RH="A" D DISP^MCMAG K DXS
"RTN","MCARP",97,0)
 Q
"RTN","MCARP",98,0)
RHB D ^MCOBRH K DXS Q:$D(MCOUT)  D ^MCOBRHA Q
"RTN","MCARP",99,0)
DTIME S MCT=$P(X,".",2),X=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")_" "_$S(MCT:$E(MCT,1,2)_$E("00",0,2-$L($E(MCT,1,2)))_":"_$E(MCT,3,4)_$E("00",0,2-$L($E(MCT,3,4))),1:"")
"RTN","MCARP",100,0)
 K MCT Q
"RTN","MCARP",101,0)
HEAD ;
"RTN","MCARP",102,0)
 S HOSP=$P($G(^DPT(DFN,.1)),U)
"RTN","MCARP",103,0)
 S:HOSP'="" HOSP=$$FIND1^DIC(44,,"X",HOSP)
"RTN","MCARP",104,0)
 S:HOSP'<1 HOSP=$$GET1^DIQ(44,HOSP,3.5,"I")
"RTN","MCARP",105,0)
 S:HOSP'="" HOSP=$P($G(^DG(40.8,HOSP,0)),U)
"RTN","MCARP",106,0)
 S PG=PG+1 W:PG>1 @IOF I '+$G(MCFLG) D
"RTN","MCARP",107,0)
 .  W !!,"Pg. "_PG,?30,HOSP,?79-$L(MCARDTM),MCARDTM
"RTN","MCARP",108,0)
 .  I (PG>1),($E(IOST,1,2)="C-") W ! Q
"RTN","MCARP",109,0)
 .  I MCARZ'["NON-" D
"RTN","MCARP",110,0)
 .  .  I $G(MCARGRTN)="PARAC" S MCARZ="NON-"_MCARZ
"RTN","MCARP",111,0)
 .  .  Q
"RTN","MCARP",112,0)
 .  W !,$$HEDSTAR("CONFIDENTIAL "_MCARZ,77) ; MC*2.3*33
"RTN","MCARP",113,0)
 .  W !,MCARGNM_"    "_SSN_"   " W ?39-($L(MCARWARD_" "_MCARRB)\2),MCARWARD_" "_MCARRB,?79-$L(" DOB: "_MCARDOB)," DOB: "_MCARDOB
"RTN","MCARP",114,0)
 .  Q
"RTN","MCARP",115,0)
 I +$G(MCFLG) W !,$$HEDSTAR(MCARZ,77)
"RTN","MCARP",116,0)
 W !,?39-($L("PROCEDURE DATE/TIME: "_MCARGDT2)\2),"PROCEDURE DATE/TIME: ",MCARGDT2
"RTN","MCARP",117,0)
 N FFF S $P(FFF,"- ",40)="- " W !,FFF,!
"RTN","MCARP",118,0)
 Q
"RTN","MCARP",119,0)
HEDSTAR(X,X1) ;    surround text string X with asterisks to length X1
"RTN","MCARP",120,0)
 N Y1
"RTN","MCARP",121,0)
 S (TY,Y1)="",$P(Y1," ",X1-$L(X)\2-1)=" ",TY=Y1_" "_X_" "
"RTN","MCARP",122,0)
 F I=$L(TY):1:X1 S TY=TY_" "
"RTN","MCARP",123,0)
 Q TY
"RTN","MCARP",124,0)
MCPPROC ; Get require variables
"RTN","MCARP",125,0)
 D MCPPROC^MCARP1 Q
"RTN","MCARP",126,0)
XTRCT(FULL) ;Extrinsic Function use to determine Full reporting or brief
"RTN","MCARP",127,0)
 Q $S($E($P(FULL,U),3)="B":0,1:1)
"RTN","MCARP",128,0)
MCPROP(MCPROP) ; Medicine Procedure file entry validator
"RTN","MCARP",129,0)
 N TEMP,PREFIX,CNT
"RTN","MCARP",130,0)
 S PREFIX=$S($E(MCPROP,3,4)="ES":7,1:4),TEMP=""
"RTN","MCARP",131,0)
 F CNT=PREFIX+2:1:$L(MCPROP) I $D(^MCAR(697.2,"B",$E(MCPROP,PREFIX+1,CNT))) S TEMP=$E(MCPROP,PREFIX+1,CNT) Q
"RTN","MCARP",132,0)
 Q TEMP
"RTN","MCARPS2")
0^184^B15965513
"RTN","MCARPS2",1,0)
MCARPS2 ;SLC/dcm,WAA Summary of patient procedures for CPRS ;12/15/97  14:49
"RTN","MCARPS2",2,0)
 ;;2.3;Medicine;**15,33**;09/13/1996
"RTN","MCARPS2",3,0)
 ;Modified from MCARPS1 for CPRS
"RTN","MCARPS2",4,0)
 ; Please Reference DBIA # 3397
"RTN","MCARPS2",5,0)
EN(DFN) ;Get procedures for a patient
"RTN","MCARPS2",6,0)
 S WH=""
"RTN","MCARPS2",7,0)
 K ^TMP("OR",$J,"MCAR") S S4="" F M=1:1 S S4=$O(^MCAR(690,"AC",DFN,S4)) Q:S4=""  D LOCFIL
"RTN","MCARPS2",8,0)
 D PR0
"RTN","MCARPS2",9,0)
 Q
"RTN","MCARPS2",10,0)
LOCFIL G LOCFIL1:$D(S5) S S5="" F K=1:1 S S5=$O(^MCAR(690,"AC",DFN,S4,S5)) Q:S5=""  D LOCFIL1
"RTN","MCARPS2",11,0)
 K S5 Q
"RTN","MCARPS2",12,0)
LOCFIL1 S S6="" F L=1:1 S S6=$O(^MCAR(690,"AC",DFN,S4,S5,S6)) Q:S6=""  D CONT
"RTN","MCARPS2",13,0)
 Q
"RTN","MCARPS2",14,0)
CONT ;CONT+1 modified on 2-7-94,S MCFILE..2) added to conform w/alpha site
"RTN","MCARPS2",15,0)
 I $D(^MCAR(+$P(S5,"(",2),S6,2005)) S MCFILE=+$P(S5,"(",2) D SUM^MCMAG
"RTN","MCARPS2",16,0)
 I S5="MCAR(702.7" Q
"RTN","MCARPS2",17,0)
 I S5="MCAR(699" S (LL,LL1)=$P($G(^MCAR(699,S6,0)),U,12) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","MCARPS2",18,0)
 ;I S5="MCAR(699.5" S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1  ;MC*2.3*8
"RTN","MCARPS2",19,0)
 I S5="MCAR(699.5",'$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS2",20,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS2",21,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U) D CONT1
"RTN","MCARPS2",22,0)
 I S5="MCAR(699.5",$D(PE) D  Q  ;MC*2.3*8
"RTN","MCARPS2",23,0)
 .S LL6=$P($G(^MCAR(699.5,S6,0)),U,6),LL8=$P($G(^MCAR(699.5,S6,0)),U,8)
"RTN","MCARPS2",24,0)
 .S (LL,LL1)=$P($G(^MCAR(699.5,S6,0)),U,6) Q:'LL  S LL=$P($G(^MCAR(697.2,LL,0)),U)
"RTN","MCARPS2",25,0)
 .N LLX,LLY
"RTN","MCARPS2",26,0)
 .S LLX=$O(^MCAR(697.2,"B",PE,0)) Q:'LLX  S LLY=$P($G(^MCAR(697.2,LLX,1)),U)
"RTN","MCARPS2",27,0)
 .I LLY="S",LLX=LL6 D CONT1
"RTN","MCARPS2",28,0)
 .I LLY="P",LLX=LL8 D CONT1
"RTN","MCARPS2",29,0)
 I S5[694 S (LL,LL1)=$P($G(^MCAR(694,S6,0)),U,3) Q:'LL  S LL=$P(^MCAR(697.2,LL,0),U) G CONT1:'$D(PE) Q:PE'=LL  G CONT1
"RTN","MCARPS2",30,0)
 ;MFD 2/5/93 I S5[700,$P($G(^MCAR(700,S6,2)),U)'="Y" Q  ;    exclude unreleased PFT
"RTN","MCARPS2",31,0)
 S (LL,LL1)=$O(^MCAR(697.2,"C",S5,0)),LL=$P(^MCAR(697.2,LL,0),U,1)
"RTN","MCARPS2",32,0)
CONT1 ;
"RTN","MCARPS2",33,0)
 S REC=$O(^MCAR(697.2,"B",LL,0)) S:REC="" REC=0
"RTN","MCARPS2",34,0)
 S MCARCODE=""
"RTN","MCARPS2",35,0)
 S MCESON=$P($G(^MCAR(697.2,REC,0)),U,14),MCESKEY=$P($G(^MCAR(697.2,REC,0)),U,15),MCSUP=+$P($G(^MCAR(697.2,REC,0)),U,16)
"RTN","MCARPS2",36,0)
 S (MCARSUM,MCARPSUM)="",MCARFILE=U_S5_","_S6_",.2)" S:$D(@MCARFILE) MCARSUM=$P(@MCARFILE,U,1),MCARPSUM=$P(@MCARFILE,U,2)
"RTN","MCARPS2",37,0)
 K MCARFILE S S1=$S(WH="P":LL,1:S4),S2=$S(WH="P":S4,1:LL)
"RTN","MCARPS2",38,0)
 S MCFILE=+$P(S5,"(",2)
"RTN","MCARPS2",39,0)
 I MCESON,($G(MCESKEY)'=""),('$$SCRSUMPT^MCESSCR(MCESKEY,S6,MCSUP)) K MCARSUM,MCARPSUM,MCFILE,REC,MCSUP Q
"RTN","MCARPS2",40,0)
 I '$$VALID^MCARUTL5(S5,S6,DFN) Q  ; MC*2.3*33
"RTN","MCARPS2",41,0)
 I $P($G(@(U_S5_","_S6_",""ES"")")),U,7)="S" G EXIT  ;MC*2.3*8
"RTN","MCARPS2",42,0)
 S S2=S2_U_S6  ;MC*2.3*8
"RTN","MCARPS2",43,0)
 S ^TMP("OR",$J,"MCAR",S1,S2)=MCARSUM_U_S6_U_$P(^MCAR(697.2,LL1,0),U,5,7)
"RTN","MCARPS2",44,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^CONSULTS" ; MC*2.3*33
"RTN","MCARPS2",45,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^NONENDO" ; MC*2.3*33
"RTN","MCARPS2",46,0)
 ;I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^GI" ; MC*2.3*33
"RTN","MCARPS2",47,0)
 I $P(^MCAR(697.2,LL1,0),U,2)'=S5 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,3,5)="EN1^MCARGP^PARAC" ; MC*2.3*33
"RTN","MCARPS2",48,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,10)=MCARPSUM
"RTN","MCARPS2",49,0)
 S $P(^TMP("OR",$J,"MCAR",S1,S2),U,11)=LL
"RTN","MCARPS2",50,0)
 I S5="MCAR(699.5" D  ;MC*2.3*8
"RTN","MCARPS2",51,0)
 .I LL8="" S LL8=" "
"RTN","MCARPS2",52,0)
 .S $P(^TMP("OR",$J,"MCAR",S1,S2),U,12)=$E(($E($P($G(^MCAR(697.2,LL6,0)),U,8),1,13)_"/"_$P($G(^MCAR(697.2,LL8,0)),U)),1,31) K LL6,LL8
"RTN","MCARPS2",53,0)
EXIT K MCARSUM,MCARPSUM,REC,MCSUP,MCESON Q
"RTN","MCARPS2",54,0)
PR0 S I="",L=0
"RTN","MCARPS2",55,0)
 F  S I=$O(^TMP("OR",$J,"MCAR",I)) Q:I=""  I I'="OT" D
"RTN","MCARPS2",56,0)
 . S J="" F  S J=$O(^TMP("OR",$J,"MCAR",I,J)) Q:J=""  S PR=^(J) D
"RTN","MCARPS2",57,0)
 .. Q:$P(PR,U,3,5)="^^"  ; MC*2.3*33
"RTN","MCARPS2",58,0)
 .. S MCARDT=$S(WH="P":$P(J,U),1:I),MCARPROC=$S(WH="P":I,1:$P(J,U))
"RTN","MCARPS2",59,0)
 .. S MCARPROC=$O(^MCAR(697.2,"B",MCARPROC,0)),MCARPROC=$P(^MCAR(697.2,MCARPROC,0),U,8)
"RTN","MCARPS2",60,0)
 .. I $P(PR,U,12)'="" S MCARPROC=$P(PR,U,12)
"RTN","MCARPS2",61,0)
 .. S DA=$P(PR,U,2),K=$P(PR,U),M=$P(PR,U,10)
"RTN","MCARPS2",62,0)
 .. S K=$S(K="N"!(K="L"):"NORMAL",K="A":"ABNORMAL",K="B":"BORDERLINE",K="T":"TECHNICALLY UNSATISFACTORY",K="ND":"NON-DIAGNOSTIC",K="MI":"MILDLY ABNORMAL",K="MO":"MODERATELY ABNORMAL",K="S":"SEVERELY ABNORMAL",1:"")
"RTN","MCARPS2",63,0)
 .. S Y=9999999.9999-MCARDT X ^DD("DD")
"RTN","MCARPS2",64,0)
 .. S L=L+1 S ^TMP("OR",$J,"MCAR","OT",L)=MCARPROC_U_DA_U_$P(PR,U,3,5)_U_J S $P(^(L),U,6)=Y,$P(^(L),U,7)=K,$P(^(L),U,10)=M,$P(^(L),U,11)=$S(WH="P":I_U_$P(J,U,2),1:J)
"RTN","MCARPS2",65,0)
 Q
"RTN","MCARUTL5")
0^185^B4131279
"RTN","MCARUTL5",1,0)
MCARUTL5 ;HOIFO/WAA-UTILITY FOR VALIDATING ENTRY ;04/13/01  12:00
"RTN","MCARUTL5",2,0)
 ;;2.3;Medicine;**33**;09/13/1996
"RTN","MCARUTL5",3,0)
 ; 
"RTN","MCARUTL5",4,0)
 ; VALID Validation function
"RTN","MCARUTL5",5,0)
 ; 
"RTN","MCARUTL5",6,0)
 ; MC*2.3*33 this is a new module to validate the entry
"RTN","MCARUTL5",7,0)
 ; is for the stated patient and matched the one on the "AC"
"RTN","MCARUTL5",8,0)
 ; The subroutine will work out the "AC" from the procedure.
"RTN","MCARUTL5",9,0)
 ; This will ensure that "AC" that the main program is using
"RTN","MCARUTL5",10,0)
 ; and the "AC" that I am building are one and the same.
"RTN","MCARUTL5",11,0)
 ; if they don't match I will not validate it.
"RTN","MCARUTL5",12,0)
 ;
"RTN","MCARUTL5",13,0)
 ;Input:
"RTN","MCARUTL5",14,0)
 ; ROOT = The root Global Reference for the entry.
"RTN","MCARUTL5",15,0)
 ; IEN = The Internal entry number for the procedure being checked
"RTN","MCARUTL5",16,0)
 ; DFN = The Patient DFN with in the Medicine Patient file.
"RTN","MCARUTL5",17,0)
 ;
"RTN","MCARUTL5",18,0)
 ;Outout:
"RTN","MCARUTL5",19,0)
 ; VALID = 1 or 0
"RTN","MCARUTL5",20,0)
 ;         1 = The entry is a procedure for the indicated Patient
"RTN","MCARUTL5",21,0)
 ;         0 = The entry is not a procedure for the indicated Patient
"RTN","MCARUTL5",22,0)
 ;
"RTN","MCARUTL5",23,0)
VALID(ROOT,IEN,DFN) ; Main entry point for this function
"RTN","MCARUTL5",24,0)
 N VALID,LINE,FN
"RTN","MCARUTL5",25,0)
 S VALID=0 ; Init VALID to 0
"RTN","MCARUTL5",26,0)
 S FN=$P(ROOT,"(",2) ; parce out the internal entry number
"RTN","MCARUTL5",27,0)
 S LINE=$G(^MCAR(FN,IEN,0)) ; validate that the entry exists
"RTN","MCARUTL5",28,0)
 I LINE'="" D
"RTN","MCARUTL5",29,0)
 . N IEN697,PL,PRODFN,PRODT
"RTN","MCARUTL5",30,0)
 . S IEN697=$O(^MCAR(697.2,"C",ROOT,0)) Q:IEN697<1  ; get the procedure info
"RTN","MCARUTL5",31,0)
 . S PL=$P(^MCAR(697.2,IEN697,0),U,12) Q:PL=""  ; get the location if the pat DFN within the procedure
"RTN","MCARUTL5",32,0)
 . S PRODFN=$$GET1^DIQ(FN,IEN,PL,"I") Q:PRODFN<1  ; get the pat DFN
"RTN","MCARUTL5",33,0)
 . Q:PRODFN'=DFN  ; compare the pat DFN from the procedure with the passed DFN
"RTN","MCARUTL5",34,0)
 . S PRODT=9999999.9999-$P(LINE,U) ; get the Procedure date and invert it
"RTN","MCARUTL5",35,0)
 . I '$D(^MCAR(690,"AC",PRODFN,PRODT,ROOT,IEN)) Q  ; check to see if the entry is in the a valid entry within 690 "AC" Xref
"RTN","MCARUTL5",36,0)
 . S VALID=1 ; Valid entry
"RTN","MCARUTL5",37,0)
 . Q
"RTN","MCARUTL5",38,0)
 Q VALID
"VER")
8.0^22
**END**
**END**
