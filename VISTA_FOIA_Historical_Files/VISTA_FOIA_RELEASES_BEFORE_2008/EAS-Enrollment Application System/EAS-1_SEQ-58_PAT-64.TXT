$TXT Created by MULLER,RICHARD at MNTVLL.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 09/29/05 at 09:54
=============================================================================
Run Date: OCT 31, 2005                     Designation: EAS*1*64
Package : EAS - ENROLLMENT APPLICATION SYSTEM Priority: Mandatory
Version : 1        SEQ #58                      Status: Released
                  Compliance Date: DEC 01, 2005
=============================================================================

Associated patches: (v)EAS*1*46    <<= must be installed BEFORE `EAS*1*64'

Subject: FIX EAS MT APPT EXPIRATION RPT

Category: 
  - Routine

Description:
============

 The Means Test Expiration by Appointment Date report (EASMTRP3) currently
 lists some patients who do not require a Means Test.  This is because the
 rules for determining if a patient requires a Means Test are periodically
 updated.  In order to correct the situation without having to recode the
 report every time the rules change, the report now calls a central
 routine to determine if a Means Test is required.  The central routine
 (DGMTR) is the definitive routine that stores the rules and will be
 updated whenever the rules change.
  
 NOTE:  The report generated by the Means Test Expiration by Appt Date 
 [EAS MT APPT EXPIRATION RPT] option should not include veterans who do 
 not require a Means Test. The code modifications to EASMTRP3 were made 
 to filter out all records that did not require a Means Test.
  
 This patch addresses the following New Service Request (NSR):
 ------------------------------------------
 There is no NSR associated with this patch.
   
   
 This patch addresses the following NOIS/Remedy ticket(s):
 ---------------------------------------------------
 There are no NOIS/Remedy tickets associated with this patch. 
   
   
 Test Sites:
 -----------
 Boston (Large)
 West LA (Integrated)
 Madison (Medium)
  
     
 ================INSTALLATION INSTRUCTIONS =================
      
 If installed during the normal workday, it is recommended that the 
 following menu option (File #19) be disabled to prevent possible 
 conflicts while running the KIDS Install.  Other VISTA users will not 
 be affected.
  
     [EAS MT APPT EXPIRATION RPT]    Means Test Expiration by Appt Date
  
  
 This patch can be loaded with users on the system.  
     
 Install Time - 1 minute
     
   1.   LOAD TRANSPORT GLOBAL
        ---------------------
        Choose the PackMan message containing this patch and invoke the
        INSTALL/CHECK MESSAGE PackMan option.
                                                     
   2.   COMPONENTS SENT WITH PATCH
        ------------------------
        The following is a list of the routines included in this patch.
        The second line of each of these routines now looks like:
      
        ;;1.0;ENROLLMENT APPLICATION SYSTEM;**[Patch List]**; MAR 15,2001
     
                                CHECK^XTSUMBLD results
 Routine name      Before Patch          After Patch         Patch List
 ============      ============          ===========         ==========
 EASMTRP3               5257514              5827226         3,15,46,64
    
  Total number of routines - 1
                                                                
   3.   START UP KIDS
        -------------
        Start up the Kernel Installation and Distribution System Menu
        [XPD MAIN]:
      
             Edits and Distribution ...
             Utilities ...
             Installation ...
      
   Select Kernel Installation & Distribution System Option: INStallation
                                                              ---
             Load a Distribution
             Print Transport Global
             Compare Transport Global to Current System
             Verify Checksums in Transport Global
             Install Package(s)
             Restart Install of Package(s)
             Unload a Distribution
             Backup a Transport Global
      
    Select Installation Option:
      
   4.   Select Installation Option:
        --------------------------
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter EAS*1.0*64):
      
       a.  Backup a Transport Global - This option will create a backup
           message of any routines exported with this patch. It will not
           backup any other changes such as DD's or templates.
       b.  Compare Transport Global to Current System - This option will
           allow you to view all changes that will be made when this patch
           is installed.  It compares all components of this patch
           (routines, DD's, templates, etc.).
       c.  Verify Checksums in Transport Global - This option will allow
           you to ensure the integrity of the routines that are in the
           transport global.
      
   5.   Select Installation Option: Install Package(s)
                                       ----------------
        **This is the step to start the installation of this KIDS patch:
     
       a.  Choose the Install Package(s) option to start the patch
           install.
       b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
           YES//' answer NO (unless otherwise indicated).
       c.  When prompted 'Want to DISABLE Scheduled Options, Menu
           Options, and Protocols? YES//' answer YES (unless otherwise
           indicated).
       d.  When prompted 'Enter options you wish to mark as 'Out 
           Of Order':' Enter the following option:
  
           [EAS MT APPT EXPIRATION RPT]    Means Test Expiration by Appt 
                                           Date
  
       e.  When prompted 'Enter protocols you wish to mark as 'Out Of 
           Order':' press <Enter>.

Routine Information:
====================
The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: EASMTRP3
    Before: B16786399  After: B18497499  **3,15,46,64**
 Description of Changes:
  The variables DGADDF, DGMSGF, and DGREQF are NEWed.  The first two,
  DGADDF and DGMSGF, are set to 1 to suppress the adding of means
  tests and printing of messages, and the routine DGMTR is called at tag
  line EN to determine if a means test is required.  If a test is required,
  the value of DGREQF will be set to 1 by DGMTR.  Otherwise, it will be a
  zero.  If a test is not required, the appointment will be skipped over
  and will not print.
    
  Routine compare of "before" and "after" EASMTRP3:
   
  BEFORE:
  EN  ;  Main entry point for appointment list by MT anniversary date
    N EASSC,PAGE,ACNT,RCNT,DGARRAY,I,CLARR,SDCNT
    K ^TMP("EASAP",$J)
    S PAGE=1,^TMP("EASAP",$J,"APDT")=EASDT
   
  AFTER:
  EN  ;  Main entry point for appointment list by MT anniversary date
    N EASSC,PAGE,ACNT,RCNT,DGARRAY,I,CLARR,SDCNT,DGADDF,DGMSGF,DGREQF
    K ^TMP("EASAP",$J)
    S PAGE=1,^TMP("EASAP",$J,"APDT")=EASDT
   
  BEFORE:
    ...Q:"^N^P^"[(U_$P(LASTMT,U,4)_U)
    ...; Quit if Cat C, agreed to pay deduct. and MT was after 10/5/1999
   
   
  AFTER:  
    ...Q:"^N^P^"[(U_$P(LASTMT,U,4)_U)
    ...; Quit if means test is not required by DGMTR (EAS*1.0*64)
    ...I $P(LASTMT,U,4)'="R" S (DGADDF,DGMSGF)=1 D EN^DGMTR I '$G(DGREQF) Q
    ...; Quit if Cat C, agreed to pay deduct. and MT was after 10/5/1999
   
  BEFORE:
    ...; If appt dt is later than anniversary dt, add veteran to list.
    ...S EASANV=$P(LASTMT,U,2)
    ...I EASDT'<EASANV S ^TMP("EASAP",$J,"CLN",EASSC,DFN,EASAPT)=""
    Q
    ;
   
  AFTER:  
    ...; If appt dt is later than anniversary dt, add veteran to list.
    ...S EASANV=$P(LASTMT,U,2)
    ...S:$P(LASTMT,U,4)'="R" EASANV=$$FMADD^XLFDT(EASANV,365)
    ...I EASDT'<EASANV S ^TMP("EASAP",$J,"CLN",EASSC,DFN,EASAPT)=""
    Q
    ;
   
  BEFORE:
    F  S EACLN=$O(^TMP("EASAP",$J,"CLN",EACLN)) Q:'EACLN  D  Q:$G(EASABRT)
    . S PAGE=1 S EASABRT=$$HDR(EACLN) Q:$G(EASABRT)
    . S DFN=0
    . F  S DFN=$O(^TMP("EASAP",$J,"CLN",EACLN,DFN)) Q:'DFN  D  Q:$G(EASABRT)
    . . S ANVDT=$P($$LST^DGMTU(DFN),U,2)
    . . I ANVDT>0 S ANVDT=$$FMADD^XLFDT(ANVDT,365)
    . . W !?3,$$GET1^DIQ(2,DFN,.01)
    . . D PID^VADPT6
   
  AFTER:
    F  S EACLN=$O(^TMP("EASAP",$J,"CLN",EACLN)) Q:'EACLN  D  Q:$G(EASABRT)
    . S PAGE=1 S EASABRT=$$HDR(EACLN) Q:$G(EASABRT)
    . S DFN=0
    . F  S DFN=$O(^TMP("EASAP",$J,"CLN",EACLN,DFN)) Q:'DFN  D  Q:$G(EASABRT)
    . . S LASTMT=$$LST^DGMTU(DFN),ANVDT=$P(LASTMT,U,2)
    . . I $P(LASTMT,U,4)'="R",ANVDT>0 S ANVDT=$$FMADD^XLFDT(ANVDT,365)
    . . W !?3,$$GET1^DIQ(2,DFN,.01)
    . . D PID^VADPT6


=============================================================================
User Information:
Entered By  : MULLER,RICHARD                Date Entered  : MAY 23, 2005
Completed By: RUDINGER,NANCY L.             Date Completed: OCT 31, 2005
Released By : HEUER,CINDY                   Date Released : OCT 31, 2005
=============================================================================


Packman Mail Message:
=====================

$END TXT
