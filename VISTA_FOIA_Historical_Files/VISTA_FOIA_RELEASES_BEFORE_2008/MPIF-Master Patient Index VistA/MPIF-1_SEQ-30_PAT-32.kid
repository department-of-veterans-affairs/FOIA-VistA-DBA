Released MPIF*1*32 SEQ #30
Extracted from mail message
**KIDS**:MPIF*1.0*32^

**INSTALL NAME**
MPIF*1.0*32
"BLD",1830,0)
MPIF*1.0*32^MASTER PATIENT INDEX VISTA^0^3031029^y
"BLD",1830,1,0)
^^3^3^3031029^
"BLD",1830,1,1,0)
CMOR SCREEN FIX
"BLD",1830,1,2,0)
Refer to patch MPIF*1.0*32 in the FORUM Patch Module for a complete
"BLD",1830,1,3,0)
description.
"BLD",1830,4,0)
^9.64PA^^
"BLD",1830,"ABNS",0)
^9.66A^^
"BLD",1830,"ABPKG")
n^^
"BLD",1830,"KRN",0)
^9.67PA^8989.52^19
"BLD",1830,"KRN",.4,0)
.4
"BLD",1830,"KRN",.401,0)
.401
"BLD",1830,"KRN",.402,0)
.402
"BLD",1830,"KRN",.403,0)
.403
"BLD",1830,"KRN",.5,0)
.5
"BLD",1830,"KRN",.84,0)
.84
"BLD",1830,"KRN",3.6,0)
3.6
"BLD",1830,"KRN",3.8,0)
3.8
"BLD",1830,"KRN",9.2,0)
9.2
"BLD",1830,"KRN",9.8,0)
9.8
"BLD",1830,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1830,"KRN",9.8,"NM",1,0)
MPIFCMRP^^0^B24508130
"BLD",1830,"KRN",9.8,"NM","B","MPIFCMRP",1)

"BLD",1830,"KRN",19,0)
19
"BLD",1830,"KRN",19.1,0)
19.1
"BLD",1830,"KRN",101,0)
101
"BLD",1830,"KRN",409.61,0)
409.61
"BLD",1830,"KRN",771,0)
771
"BLD",1830,"KRN",870,0)
870
"BLD",1830,"KRN",8989.51,0)
8989.51
"BLD",1830,"KRN",8989.52,0)
8989.52
"BLD",1830,"KRN",8994,0)
8994
"BLD",1830,"KRN","B",.4,.4)

"BLD",1830,"KRN","B",.401,.401)

"BLD",1830,"KRN","B",.402,.402)

"BLD",1830,"KRN","B",.403,.403)

"BLD",1830,"KRN","B",.5,.5)

"BLD",1830,"KRN","B",.84,.84)

"BLD",1830,"KRN","B",3.6,3.6)

"BLD",1830,"KRN","B",3.8,3.8)

"BLD",1830,"KRN","B",9.2,9.2)

"BLD",1830,"KRN","B",9.8,9.8)

"BLD",1830,"KRN","B",19,19)

"BLD",1830,"KRN","B",19.1,19.1)

"BLD",1830,"KRN","B",101,101)

"BLD",1830,"KRN","B",409.61,409.61)

"BLD",1830,"KRN","B",771,771)

"BLD",1830,"KRN","B",870,870)

"BLD",1830,"KRN","B",8989.51,8989.51)

"BLD",1830,"KRN","B",8989.52,8989.52)

"BLD",1830,"KRN","B",8994,8994)

"BLD",1830,"QUES",0)
^9.62^^
"BLD",1830,"REQB",0)
^9.611^1^1
"BLD",1830,"REQB",1,0)
MPIF*1.0*30^1
"BLD",1830,"REQB","B","MPIF*1.0*30",1)

"MBREQ")
0
"PKG",282,-1)
1^1
"PKG",282,0)
MASTER PATIENT INDEX VISTA^MPIF^Master Patient Index VistA side
"PKG",282,20,0)
^9.402P^^
"PKG",282,22,0)
^9.49I^1^1
"PKG",282,22,1,0)
1.0^2990428
"PKG",282,22,1,"PAH",1,0)
32^3031029
"PKG",282,22,1,"PAH",1,1,0)
^^3^3^3031029
"PKG",282,22,1,"PAH",1,1,1,0)
CMOR SCREEN FIX
"PKG",282,22,1,"PAH",1,1,2,0)
Refer to patch MPIF*1.0*32 in the FORUM Patch Module for a complete
"PKG",282,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","MPIFCMRP")
0^1^B24508130
"RTN","MPIFCMRP",1,0)
MPIFCMRP ;BPCIO/CMC-PUSHING CMOR TO ANOTHER SITE ;NOV 15, 2000
"RTN","MPIFCMRP",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**11,21,30,32**;30 Apr 99
"RTN","MPIFCMRP",3,0)
 ;
"RTN","MPIFCMRP",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFCMRP",5,0)
 ;
"RTN","MPIFCMRP",6,0)
 ; ^DGCN(391.91   IA #2751
"RTN","MPIFCMRP",7,0)
 ;
"RTN","MPIFCMRP",8,0)
 ;Entry point for option: PUSH CMOR REQUEST - create a new request
"RTN","MPIFCMRP",9,0)
 ; to change CMOR when your site is the CMOR.
"RTN","MPIFCMRP",10,0)
 ; No input or output variables.
"RTN","MPIFCMRP",11,0)
 ;
"RTN","MPIFCMRP",12,0)
 ;Only if the site is the CMOR can this option be used
"RTN","MPIFCMRP",13,0)
 ; note: code here is very similar to MPIFEDIT
"RTN","MPIFCMRP",14,0)
NEW ;
"RTN","MPIFCMRP",15,0)
 N DIC,X,Y,DTOUT,DUOUT,PAT
"RTN","MPIFCMRP",16,0)
 S DIC="^DPT(",DIC(0)="QEAMZ",DIC("A")="Select PATIENT: "
"RTN","MPIFCMRP",17,0)
 D ^DIC
"RTN","MPIFCMRP",18,0)
 Q:$D(DTOUT)!$D(DUOUT)!(Y=-1)
"RTN","MPIFCMRP",19,0)
 S PAT=+Y
"RTN","MPIFCMRP",20,0)
 D LM(PAT)
"RTN","MPIFCMRP",21,0)
 Q
"RTN","MPIFCMRP",22,0)
LM(PAT) ; list manager entry point to push a change of CMOR with PAT set to the DFN
"RTN","MPIFCMRP",23,0)
 I +$$GETICN^MPIF001(PAT)<0 W !,"Patient doesn't have ICN, try again" G NEW
"RTN","MPIFCMRP",24,0)
 I $E($$GETICN^MPIF001(PAT),1,3)=$P($$SITE^VASITE(),"^",3) W !,"Patient has a Local ICN, try again" G NEW
"RTN","MPIFCMRP",25,0)
 I $$GETVCCI^MPIF001(PAT)<0 W !,"Patient doesn't have a CMOR, try again" G NEW
"RTN","MPIFCMRP",26,0)
 I $$GETVCCI^MPIF001(PAT)'=$P($$SITE^VASITE(),"^",3) W !,"You are NOT the CMOR, to request to be the CMOR, use option: Create a New CMOR Change Request" G NEW
"RTN","MPIFCMRP",27,0)
 N TMP,TCNT
"RTN","MPIFCMRP",28,0)
 S TMP=$O(^DGCN(391.91,"APAT",PAT,"")) I $O(^DGCN(391.91,"APAT",PAT,TMP))="" W !,"Patient isn't SHARED - CAN'T change CMOR" Q
"RTN","MPIFCMRP",29,0)
 ;Pt is shared, but are they shared with another VAMC?
"RTN","MPIFCMRP",30,0)
 S TMP="",TCNT=0 F  S TMP=$O(^DGCN(391.91,"APAT",PAT,TMP)) Q:TMP=""  D
"RTN","MPIFCMRP",31,0)
 .;I $$GET1^DIQ(4,TMP_",",13)'="VAMC" Q
"RTN","MPIFCMRP",32,0)
 .N TP S TP=$$GET1^DIQ(4,TMP_",",13)
"RTN","MPIFCMRP",33,0)
 .Q:TP'="VAMC"&(TP'="OC")&(TP'="M&ROC")&(TP'="RO-OC")
"RTN","MPIFCMRP",34,0)
 .; ^ only valid types of TFs that can be a CMOR 
"RTN","MPIFCMRP",35,0)
 .S TCNT=TCNT+1
"RTN","MPIFCMRP",36,0)
 I TCNT<2 W !,"Patient isn't SHARED with another VAMC - CAN'T change CMOR" Q
"RTN","MPIFCMRP",37,0)
 ; CHECK IF ALREADY OPEN/PENDING REQUEST
"RTN","MPIFCMRP",38,0)
 N ENT,STOP,MPIFNM,REQNM
"RTN","MPIFCMRP",39,0)
 S ENT=0,STOP=0 F  S ENT=$O(^MPIF(984.9,"C",PAT,ENT)) Q:ENT=""!(STOP)  D
"RTN","MPIFCMRP",40,0)
 .I $P($G(^MPIF(984.9,ENT,0)),"^",6)<4 S STOP=1
"RTN","MPIFCMRP",41,0)
 I STOP W !!,"Already have request for this patient" G NEW
"RTN","MPIFCMRP",42,0)
 N N0,PHONE,DA,DIE,DR,DIR,ERROR,DIK,Y,DIRUT,REQ,TDA,PERS
"RTN","MPIFCMRP",43,0)
 S DA=$$ADD^MPIFNEW(),TDA=DA,PHONE=""
"RTN","MPIFCMRP",44,0)
 S DIE="^MPIF(984.9,",DR=".04///`"_PAT D ^DIE
"RTN","MPIFCMRP",45,0)
 S REQ=$P($G(^MPIF(984.9,DA,0)),"^")
"RTN","MPIFCMRP",46,0)
 W !,"REQUEST NUMBER:",REQ
"RTN","MPIFCMRP",47,0)
EDIT I $D(DUZ) D
"RTN","MPIFCMRP",48,0)
 .S PHONE=$P($G(^MPIF(984.9,+$O(^MPIF(984.9,"AD",DUZ,""),-1),0)),"^",5)
"RTN","MPIFCMRP",49,0)
 .N DA,DIC,DIQ S DIQ="MPIFNM",DR=".01;.132",DIQ(0)="E",DIC="^VA(200,",DA=DUZ
"RTN","MPIFCMRP",50,0)
 .D EN^DIQ1
"RTN","MPIFCMRP",51,0)
 .S REQNM=MPIFNM(200,DUZ,.01,"E")
"RTN","MPIFCMRP",52,0)
 I '$D(DUZ) S (PHONE,REQNM)=""
"RTN","MPIFCMRP",53,0)
 ;
"RTN","MPIFCMRP",54,0)
REASON S DIR("A")="Reason for Request",DIR("?")="Answer must be 3-60 characters in length.",DIR(0)="F^3:60" D ^DIR
"RTN","MPIFCMRP",55,0)
 I Y="" W !,"Answer must be 3-60 characters in length." G REASON
"RTN","MPIFCMRP",56,0)
 I X="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFCMRP",57,0)
 S DIE="^MPIF(984.9,",DR="1.02///"_X D ^DIE
"RTN","MPIFCMRP",58,0)
REQNM S DIR("A")="Requestor's Name",DIR("B")=REQNM,DIR("?")="Answer must be a valid user",DIR(0)="P^200:EQZ" D ^DIR K DIR("B")
"RTN","MPIFCMRP",59,0)
 I Y="" W !,"Must pick valid user" G REQNM
"RTN","MPIFCMRP",60,0)
 I X="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFCMRP",61,0)
 S PERS=+Y
"RTN","MPIFCMRP",62,0)
 S DIE="^MPIF(984.9,",DR=".02///`"_+Y D ^DIE
"RTN","MPIFCMRP",63,0)
PHONE S DIR("A")="Requestor's Phone",DIR("B")=PHONE,DIR("?")="Answer must be 4-20 charaters in length.",DIR(0)="F" D ^DIR K DIR("B")
"RTN","MPIFCMRP",64,0)
 I Y="" W !,"Answer must be 4-20 charaters in length."  G PHONE
"RTN","MPIFCMRP",65,0)
 I X="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFCMRP",66,0)
 S DIE="^MPIF(984.9,",DR=".05///"_X D ^DIE
"RTN","MPIFCMRP",67,0)
 ;
"RTN","MPIFCMRP",68,0)
CMOR S DIC("A")="Select Site to Be CMOR: ",DIC="^DIC(4,",DIC(0)="QEAM"
"RTN","MPIFCMRP",69,0)
 S DIC("S")="I $D(^DGCN(391.91,""APAT"",PAT,Y)) I +$$SITE^VASITE'=+Y N TYPE S TYPE=$$GET1^DIQ(4,+Y_"","",13) I TYPE=""VAMC""!(TYPE=""RO-OC"")!(TYPE=""OC"")!(TYPE=""M&ROC"")"
"RTN","MPIFCMRP",70,0)
 D ^DIC
"RTN","MPIFCMRP",71,0)
 I X="^" S DIK="^MPIF(984.9," D ^DIK W "... Request deleted" Q
"RTN","MPIFCMRP",72,0)
 N TSITE S TSITE=+Y
"RTN","MPIFCMRP",73,0)
 S DIE="^MPIF(984.9,",DR=".07///`"_TSITE_";1.03///3;.09///`"_TSITE D ^DIE
"RTN","MPIFCMRP",74,0)
 ;update site, type of action and cmor after approval
"RTN","MPIFCMRP",75,0)
 ;
"RTN","MPIFCMRP",76,0)
 I $$CHK^MPIFEDIT(DA) W !,"This request is missing required data." G EDIT
"RTN","MPIFCMRP",77,0)
 ;
"RTN","MPIFCMRP",78,0)
APP S DIR("A")="Select Request Action (SEND/EDIT/DELETE)? ",DIR("B")="SEND",DIR(0)="SAO^SEND:SEND;EDIT:EDIT;DELETE:DELETE"
"RTN","MPIFCMRP",79,0)
 D ^DIR K DIR
"RTN","MPIFCMRP",80,0)
 S DA=TDA
"RTN","MPIFCMRP",81,0)
 I $E(Y)="D"!$D(DIRUT) D  Q
"RTN","MPIFCMRP",82,0)
 .S DIK="^MPIF(984.9," D ^DIK W "... Request deleted"
"RTN","MPIFCMRP",83,0)
 .Q
"RTN","MPIFCMRP",84,0)
 I $E(Y)="E" G REASON
"RTN","MPIFCMRP",85,0)
 S DR=".08////^S X=2;.06////^S X=2",DIE="^MPIF(984.9," D ^DIE W !,"... Request will be sent"
"RTN","MPIFCMRP",86,0)
 ; removed event queue due to delivery issues - this msg must be sent first followed by the actual change cmor msg.
"RTN","MPIFCMRP",87,0)
 N ERR,MPIFHL7 S ERR="ERRS",MPIFHL7=""
"RTN","MPIFCMRP",88,0)
 D EN^MPIFREQ("CMOR CHANGE REQUEST",DA,.ERR,MPIFHL7)
"RTN","MPIFCMRP",89,0)
 ;
"RTN","MPIFCMRP",90,0)
 ;NOW CHANGE CMOR AND SEND CHANGE CMOR MESSAGE
"RTN","MPIFCMRP",91,0)
 N TEXT,DIR,DR,CMOR,TMP,ERROR
"RTN","MPIFCMRP",92,0)
 S TEXT="Auto change - pushed CMOR",ERROR=0
"RTN","MPIFCMRP",93,0)
 S DIE="^MPIF(984.9,",DA=TDA,DR=".06///^S X=4;3.01///^S X=TEXT"
"RTN","MPIFCMRP",94,0)
 D ^DIE
"RTN","MPIFCMRP",95,0)
 S CMOR=$P($G(^MPIF(984.9,TDA,0)),"^",7)
"RTN","MPIFCMRP",96,0)
 I CMOR="" D  Q
"RTN","MPIFCMRP",97,0)
 .W !,"New CMOR Not Defined, edit request"
"RTN","MPIFCMRP",98,0)
 .S ^DIE="^MPIF(984.9,",DA=TDA,DR=".06///^S X=1" D ^DIE
"RTN","MPIFCMRP",99,0)
 S TMP=$$CHANGE^MPIF001(PAT,CMOR)
"RTN","MPIFCMRP",100,0)
 I +TMP<0 S ^DIE="^MPIF(984.9,",DA=TDA,DR=".06///^S X=1" D ^DIE Q
"RTN","MPIFCMRP",101,0)
 D BROAD^MPIFCMOR(DA,.ERROR)
"RTN","MPIFCMRP",102,0)
 Q
"VER")
8.0^22.0
**END**
**END**
