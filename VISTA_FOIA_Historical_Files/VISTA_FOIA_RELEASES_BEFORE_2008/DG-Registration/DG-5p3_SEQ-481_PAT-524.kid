Released DG*5.3*524 SEQ #481
Extracted from mail message
**KIDS**:DG*5.3*524^

**INSTALL NAME**
DG*5.3*524
"BLD",4773,0)
DG*5.3*524^REGISTRATION^0^3031001^y
"BLD",4773,1,0)
^^3^3^3030814^
"BLD",4773,1,1,0)
Problems in registration system caused by filter for inpatient roster, 
"BLD",4773,1,2,0)
unclear description in period of service field, use of pseudo SSN s in 
"BLD",4773,1,3,0)
claim number and error entering more than 3 surgeries in a day.
"BLD",4773,4,0)
^9.64PA^^0
"BLD",4773,"INI")

"BLD",4773,"INID")
n^n^
"BLD",4773,"INIT")
POST^DG53P524
"BLD",4773,"KRN",0)
^9.67PA^8989.52^19
"BLD",4773,"KRN",.4,0)
.4
"BLD",4773,"KRN",.401,0)
.401
"BLD",4773,"KRN",.402,0)
.402
"BLD",4773,"KRN",.403,0)
.403
"BLD",4773,"KRN",.5,0)
.5
"BLD",4773,"KRN",.84,0)
.84
"BLD",4773,"KRN",3.6,0)
3.6
"BLD",4773,"KRN",3.8,0)
3.8
"BLD",4773,"KRN",9.2,0)
9.2
"BLD",4773,"KRN",9.8,0)
9.8
"BLD",4773,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4773,"KRN",9.8,"NM",1,0)
DGPTFTR0^^0^B15326585
"BLD",4773,"KRN",9.8,"NM",2,0)
DGPTR0^^0^B22182596
"BLD",4773,"KRN",9.8,"NM",3,0)
DGOINPT^^0^B13750853
"BLD",4773,"KRN",9.8,"NM","B","DGOINPT",3)

"BLD",4773,"KRN",9.8,"NM","B","DGPTFTR0",1)

"BLD",4773,"KRN",9.8,"NM","B","DGPTR0",2)

"BLD",4773,"KRN",19,0)
19
"BLD",4773,"KRN",19.1,0)
19.1
"BLD",4773,"KRN",101,0)
101
"BLD",4773,"KRN",409.61,0)
409.61
"BLD",4773,"KRN",771,0)
771
"BLD",4773,"KRN",870,0)
870
"BLD",4773,"KRN",8989.51,0)
8989.51
"BLD",4773,"KRN",8989.52,0)
8989.52
"BLD",4773,"KRN",8994,0)
8994
"BLD",4773,"KRN","B",.4,.4)

"BLD",4773,"KRN","B",.401,.401)

"BLD",4773,"KRN","B",.402,.402)

"BLD",4773,"KRN","B",.403,.403)

"BLD",4773,"KRN","B",.5,.5)

"BLD",4773,"KRN","B",.84,.84)

"BLD",4773,"KRN","B",3.6,3.6)

"BLD",4773,"KRN","B",3.8,3.8)

"BLD",4773,"KRN","B",9.2,9.2)

"BLD",4773,"KRN","B",9.8,9.8)

"BLD",4773,"KRN","B",19,19)

"BLD",4773,"KRN","B",19.1,19.1)

"BLD",4773,"KRN","B",101,101)

"BLD",4773,"KRN","B",409.61,409.61)

"BLD",4773,"KRN","B",771,771)

"BLD",4773,"KRN","B",870,870)

"BLD",4773,"KRN","B",8989.51,8989.51)

"BLD",4773,"KRN","B",8989.52,8989.52)

"BLD",4773,"KRN","B",8994,8994)

"BLD",4773,"PRE")
DG53P524
"BLD",4773,"QUES",0)
^9.62^^
"BLD",4773,"REQB",0)
^9.611^4^2
"BLD",4773,"REQB",3,0)
DG*5.3*477^1
"BLD",4773,"REQB",4,0)
DG*5.3*510^1
"BLD",4773,"REQB","B","DG*5.3*477",3)

"BLD",4773,"REQB","B","DG*5.3*510",4)

"INIT")
POST^DG53P524
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
524^3031001
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3031001
"PKG",5,22,1,"PAH",1,1,1,0)
Problems in registration system caused by filter for inpatient roster, 
"PKG",5,22,1,"PAH",1,1,2,0)
unclear description in period of service field, use of pseudo SSN s in 
"PKG",5,22,1,"PAH",1,1,3,0)
claim number and error entering more than 3 surgeries in a day.
"PRE")
DG53P524
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DG53P524")
0^^B18605856
"RTN","DG53P524",1,0)
DG53P524 ;ALB/TMD - Patch DG*5.3*524 Install Utility Routine ; 7/17/03 8:48am
"RTN","DG53P524",2,0)
 ;;5.3;Registration;**524**;AUG 13, 1993
"RTN","DG53P524",3,0)
 ;
"RTN","DG53P524",4,0)
 ;
"RTN","DG53P524",5,0)
ENV ;Main entry point for Environment check point.
"RTN","DG53P524",6,0)
 ;
"RTN","DG53P524",7,0)
 S XPDABORT=""
"RTN","DG53P524",8,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","DG53P524",9,0)
 I XPDABORT="" K XPDABORT
"RTN","DG53P524",10,0)
 Q
"RTN","DG53P524",11,0)
 ;
"RTN","DG53P524",12,0)
 ;
"RTN","DG53P524",13,0)
PRE ;Main entry point for Pre-init items.
"RTN","DG53P524",14,0)
 Q
"RTN","DG53P524",15,0)
 ;
"RTN","DG53P524",16,0)
 ;
"RTN","DG53P524",17,0)
POST ;Main entry point for Post-init items.
"RTN","DG53P524",18,0)
 ;
"RTN","DG53P524",19,0)
 D POST1
"RTN","DG53P524",20,0)
 D POST2
"RTN","DG53P524",21,0)
 D POST3
"RTN","DG53P524",22,0)
 Q
"RTN","DG53P524",23,0)
 ;
"RTN","DG53P524",24,0)
 ;
"RTN","DG53P524",25,0)
PROGCHK(XPDABORT) ;checks for necessary programmer variables
"RTN","DG53P524",26,0)
 ;
"RTN","DG53P524",27,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","DG53P524",28,0)
 .D BMES^XPDUTL("*****")
"RTN","DG53P524",29,0)
 .D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","DG53P524",30,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","DG53P524",31,0)
 .D MES^XPDUTL("*****")
"RTN","DG53P524",32,0)
 .S XPDABORT=2
"RTN","DG53P524",33,0)
 Q
"RTN","DG53P524",34,0)
 ;
"RTN","DG53P524",35,0)
 ;
"RTN","DG53P524",36,0)
POST1 ;Change Brief Description (#20) for SPANISH AMERICAN (number 3) in PERIOD OF SERVICE file (#21).
"RTN","DG53P524",37,0)
 ;
"RTN","DG53P524",38,0)
 N DGBDESC   ;Brief Description
"RTN","DG53P524",39,0)
 N DGPOS     ;Period of Service
"RTN","DG53P524",40,0)
 N DGPOSIEN  ;Period of Service IEN in file #21
"RTN","DG53P524",41,0)
 N DGFDA     ;FDA for DBS call
"RTN","DG53P524",42,0)
 N DGERR     ;Error array for DBS call
"RTN","DG53P524",43,0)
 ;
"RTN","DG53P524",44,0)
 S DGPOS="SPANISH AMERICAN"
"RTN","DG53P524",45,0)
 S DGBDESC="(4/21/1898-7/4/1902)"
"RTN","DG53P524",46,0)
 D BMES^XPDUTL("** Updating PERIOD OF SERVICE file (#21) with new BRIEF DESCRIPTION field (#20) value for "_DGPOS_".")
"RTN","DG53P524",47,0)
 S DGPOSIEN=$$FIND1^DIC(21,"","MX",DGPOS,"","","DGERR") D
"RTN","DG53P524",48,0)
 .I 'DGPOSIEN!$D(DGERR) Q
"RTN","DG53P524",49,0)
 .S DGFDA(21,DGPOSIEN_",",20)=DGBDESC
"RTN","DG53P524",50,0)
 .D FILE^DIE("ET","DGFDA","DGERR")
"RTN","DG53P524",51,0)
 I $G(DGERR)'="" D BMES^XPDUTL("** Update of "_DGPOS_" Period of Service was NOT successful.") Q
"RTN","DG53P524",52,0)
 D BMES^XPDUTL("** BRIEF DESCRIPTION for "_DGPOS_" Period of Service changed to "_DGBDESC_".")
"RTN","DG53P524",53,0)
 ;
"RTN","DG53P524",54,0)
 Q
"RTN","DG53P524",55,0)
 ;
"RTN","DG53P524",56,0)
POST2 ; Change Input Transform for Claim Number field (#.313) in Patient file (#2) to disallow length>10 (pseudo SSNs)
"RTN","DG53P524",57,0)
 ;
"RTN","DG53P524",58,0)
 N DGCODE  ; Changed input transform
"RTN","DG53P524",59,0)
 N DGINTP  ; Input template name
"RTN","DG53P524",60,0)
 N DGERR   ; Error flag
"RTN","DG53P524",61,0)
 N DMAX    ; Maximum Routine Size
"RTN","DG53P524",62,0)
 N DGFIRST ; First four pieces of DD node containing input transform
"RTN","DG53P524",63,0)
 N X,Y
"RTN","DG53P524",64,0)
 ;
"RTN","DG53P524",65,0)
 I '$D(^DD(2,.313,0)) D BMES^XPDUTL("** Unable to locate DD node to update input transform for CLAIM NUMBER field (#.313) of the PATIENT file (#2)") Q
"RTN","DG53P524",66,0)
 S DGFIRST=$P(^DD(2,.313,0),U,1,4)
"RTN","DG53P524",67,0)
 S DGCODE="S DFN=DA D EV^DGLOCK I $D(X) S L=$S($D(^DPT(DA,0)):$P(^(0),U,9),1:X) W:X?1""SS"".E ""  "",L S:X?1""SS"".E X=L"
"RTN","DG53P524",68,0)
 S DGCODE=DGCODE_" K:$L(X)>9 X Q:'$D(X)  I X'=L K:$L(X)>8!($L(X)<7)!'(X?.N) X"
"RTN","DG53P524",69,0)
 S ^DD(2,.313,0)=DGFIRST_"^"_DGCODE
"RTN","DG53P524",70,0)
 D BMES^XPDUTL("** Input transform of the CLAIM NUMBER field (#.313) of the PATIENT file (#2) changed to:")
"RTN","DG53P524",71,0)
 D BMES^XPDUTL(DGCODE)
"RTN","DG53P524",72,0)
 ; Recompile Input Templates
"RTN","DG53P524",73,0)
 F DGINTP="DG LOAD EDIT SCREEN 7","DVBHINQ UPDATE" S Y=$O(^DIE("B",DGINTP,0)) S DGERR=0 D  I DGERR D BMES^XPDUTL("** "_DGINTP_" input template could not be updated")
"RTN","DG53P524",74,0)
 .I 'Y S DGERR=1 Q
"RTN","DG53P524",75,0)
 .S X=$P($G(^DIE(Y,"ROU")),U,2) I X="" S DGERR=1 Q
"RTN","DG53P524",76,0)
 .S DMAX=$$ROUSIZE^DILF D EN^DIEZ
"RTN","DG53P524",77,0)
 Q
"RTN","DG53P524",78,0)
POST3 ;
"RTN","DG53P524",79,0)
 ;N DGHELP  ;New help prompt text
"RTN","DG53P524",80,0)
 ;
"RTN","DG53P524",81,0)
 I '$D(^DD(2,.313,3)) D BMES^XPDUTL("** Unable to locate DD node to update Help Prompt for CLAIM NUMBER field (#.313) of the PATIENT file (#2)") Q
"RTN","DG53P524",82,0)
 S DGHELP="Enter this patient's claim number as 7-8 numerics or enter SS if the claim number is the same as his/her SSN.  Pseudo SSNs are not allowed."
"RTN","DG53P524",83,0)
 S ^DD(2,.313,3)=DGHELP
"RTN","DG53P524",84,0)
 D BMES^XPDUTL("** Help Prompt text for the CLAIM NUMBER field (#.313) of the PATIENT file (#2) changed to: ")
"RTN","DG53P524",85,0)
 D BMES^XPDUTL(DGHELP)
"RTN","DG53P524",86,0)
 Q
"RTN","DG53P524",87,0)
 ;
"RTN","DGOINPT")
0^3^B13750853
"RTN","DGOINPT",1,0)
DGOINPT ;RWA/SLC,XAK/ALBANY;ALB/MLI;ALB/REW - WARD ROSTER ; 6/11/03 12:26pm
"RTN","DGOINPT",2,0)
 ;;5.3;Registration;**524**;Aug 13, 1993
"RTN","DGOINPT",3,0)
 ;;MAS VERSION 5.1;
"RTN","DGOINPT",4,0)
 ;
"RTN","DGOINPT",5,0)
 ; DGHOW = PRIMARY SORT METHOD (W=WARD P=PROVIDER)
"RTN","DGOINPT",6,0)
 ; DGPVAR= PROVIDER TYPE (P,A, OR E)
"RTN","DGOINPT",7,0)
 ; VAUTW = WARD ARRAY
"RTN","DGOINPT",8,0)
 ; DGSUBS= SECONDARY SORT METHOD (R=ROOM-BED N=NAME)
"RTN","DGOINPT",9,0)
 ; DGDS  = DOUBLE SPACE: (1=YES 0=NO
"RTN","DGOINPT",10,0)
 ; DGCYPS= # OF COPIES TO PRINT
"RTN","DGOINPT",11,0)
 ; VAUTD = DIVISION VARIABLE/ARRAY
"RTN","DGOINPT",12,0)
 ;
"RTN","DGOINPT",13,0)
 D QUIT^DGOINPT1,LO^DGUTL
"RTN","DGOINPT",14,0)
 D SETUP
"RTN","DGOINPT",15,0)
 D QUIT^DGOINPT1
"RTN","DGOINPT",16,0)
 Q
"RTN","DGOINPT",17,0)
SETUP ;
"RTN","DGOINPT",18,0)
 R !!,"Sort this report by (W)ard or (P)rovider?  WARD// ",X:DTIME I '$T!(X["^") Q
"RTN","DGOINPT",19,0)
 I X="" S X="W" W X
"RTN","DGOINPT",20,0)
 S Z="^WARD^PROVIDER" D IN^DGHELP
"RTN","DGOINPT",21,0)
 I %=-1 W !!?3,"Enter W to sort this report of inpatients by WARD",!?6,"or P to sort the report by PROVIDER." G SETUP
"RTN","DGOINPT",22,0)
 S DGHOW=X
"RTN","DGOINPT",23,0)
WARD I (DGHOW="W") D ASK2^SDDIV Q:Y<0  S VAUTNI=1 D WARD^VAUTOMA Q:Y<0  G NMRM
"RTN","DGOINPT",24,0)
 Q:(DGHOW'="P")
"RTN","DGOINPT",25,0)
PROV W !,"Which provider? ",!!
"RTN","DGOINPT",26,0)
 R "(P)rimary Care, (A)ttending, or (E)ITHER? EITHER// ",X:DTIME I '$T!(X["^") Q
"RTN","DGOINPT",27,0)
 I X="" S X="E" W X
"RTN","DGOINPT",28,0)
 S Z="^PRIMARY CARE^ATTENDING^EITHER" D IN^DGHELP
"RTN","DGOINPT",29,0)
 I %=-1 W !!?3,"Enter P to sort this report of inpatients by PRIMARY CARE PHYSICIAN",!?9,"A to sort the report by ATTENDING PHYSICIAN, or",!?9,"E to print the report where the provider was EITHER",!?12,"Attending or Primary Care" G PROV
"RTN","DGOINPT",30,0)
 S DGPVAR=X,VAUTNI=3
"RTN","DGOINPT",31,0)
 S DIC="^VA(200,",VAUTSTR="provider",VAUTVB="VAUTW" D FIRST^VAUTOMA
"RTN","DGOINPT",32,0)
 Q:Y<0
"RTN","DGOINPT",33,0)
NMRM ;
"RTN","DGOINPT",34,0)
 R !!,"Sub-sort by (N)ame of Patient or (R)oom  NAME// ",X:DTIME I '$T!(X["^") Q
"RTN","DGOINPT",35,0)
 I X="" S X="N" W X
"RTN","DGOINPT",36,0)
 S Z="^NAME^ROOM" D IN^DGHELP
"RTN","DGOINPT",37,0)
 I %=-1 W !!,"SECONDARY SORT ORDER:",!!?3,"Enter N to sort this report of inpatients by NAME",!?6,"or R to sort the report by ROOM NUMBER.",!!?6,"Note: ROOM NUMBER = First set of numbers that appear in ROOM-BED" G NMRM
"RTN","DGOINPT",38,0)
 S DGSUBS=X
"RTN","DGOINPT",39,0)
DSP W !,"WOULD YOU LIKE THE INPATIENT ROSTER DOUBLE SPACED" S %=2 D YN^DICN Q:%<0  S DGDS='(%-1) I '% W !?4,"Enter 'Y'es to double space this report, 'N'o to single space" G DSP
"RTN","DGOINPT",40,0)
CPYS R !,"HOW MANY COPIES OF THE INPATIENT ROSTER WOULD YOU LIKE? 1//",X:DTIME Q:X="^"!'$T  S:X="" X=1 I $S(X<1:1,X>10:1,1:0) W !,"Enter a number from 1 to 10 indicating the number of copies you want printed." G CPYS
"RTN","DGOINPT",41,0)
 W !!,*7,!!,"THIS REPORT REQUIRES 132 COLUMN OUTPUT"
"RTN","DGOINPT",42,0)
 S DGCPYS=X,DGPGM="ROSTER^DGOINPT1",DGVAR="VAUTD#^VAUTW#^DGPVAR^DGHOW^DGCPYS^DGDS^DGSUBS" D ZIS^DGUTQ Q:POP
"RTN","DGOINPT",43,0)
 D ROSTER^DGOINPT1
"RTN","DGOINPT",44,0)
 Q
"RTN","DGPTFTR0")
0^1^B15326585
"RTN","DGPTFTR0",1,0)
DGPTFTR0 ;ALB/JDS/ADL - PTF TRANSMISSION ; 10/1/03 6:52pm
"RTN","DGPTFTR0",2,0)
 ;;5.3;Registration;**247,510,524**;Aug 13, 1993
"RTN","DGPTFTR0",3,0)
 ;;ADL;Update for CSV Project;;Mar 26, 2003
"RTN","DGPTFTR0",4,0)
 S DGSSN=$P(DG10,U,9),DGHEAD=$S($E(DGSSN,10)="P":"P",1:" ")_$E(DGSSN,1,9)_" ",DGADM=$P(DG0,U,2)\1,DGHEAD=DGHEAD_$E(DGADM,4,5)_$E(DGADM,6,7)_$E(DGADM,2,3)
"RTN","DGPTFTR0",5,0)
 S Y=DGHEAD,L=3,X=DG0,Z=3 D ENTER S Y=Y_$E($P(X,U,5)_"   ",1,3)
"RTN","DGPTFTR0",6,0)
 S DGHEAD=Y,Y="    "_Y D HEAD^DGPTFTR1
"RTN","DGPTFTR0",7,0)
101 S Y=$S(T1:"C",1:"N")_"101"_DGHEAD,DGNAM=$P(DG10,U,1) D DGNAM S Y=Y_$E($P(DGNAM,",",1)_"           ",1,12)_$J($E($P(DGNAM,",",2),1),1)_$J($E($P($P(DGNAM,",",2)," ",2),1),1)
"RTN","DGPTFTR0",8,0)
 S Y=Y_$S($D(^DIC(45.1,+$P(DG101,U,1),0)):$J($P(^(0),U,1),2),1:"  ")
"RTN","DGPTFTR0",9,0)
 S L=3,X=DG101,Z=5 D ENTER S Y=Y_$E($P(X,U,6)_"   ",1,3)
"RTN","DGPTFTR0",10,0)
 S Y=Y_$S("A0"[$P(DG0,U,5):" ",1:$J($P(DG101,U,3),1))
"RTN","DGPTFTR0",11,0)
 ;POW Location
"RTN","DGPTFTR0",12,0)
 S Y=Y_$S($P(DG52,U,5)="N":1,$P(DG52,U,5)'="Y":3,$P(DG52,U,6)>0&($P(DG52,U,6)<7):3+$P(DG52,U,6),$P(DG52,U,6)>6&($P(DG52,U,6)<9):$C($P(DG52,U,6)+58),1:" ")
"RTN","DGPTFTR0",13,0)
 S Y=Y_$S($D(^DIC(11,+$P(DG10,U,5),0)):$E(^(0),1),1:" ")_$J($P(DG10,U,2),1)
"RTN","DGPTFTR0",14,0)
 S DGDOB=$P(DG10,U,3)\1,Y=Y_$E(DGDOB,4,5)_$E(DGDOB,6,7)_(1700+$E(DGDOB,1,3))
"RTN","DGPTFTR0",15,0)
 S C=$S($D(^DIC(45.82,+$P(DG101,U,4),0)):$P(^(0),U,1),1:" "),(G,E)=" " S:C=6 DGAO=$P(DG321,U,2),G=$S($P(DG321,U,1)'="Y":1,DGAO="N":2,DGAO="Y":3,1:4)
"RTN","DGPTFTR0",16,0)
 S:C="Z"!(C>1&(C<8)) DGNT=$P(DG321,U,12),E=$S($P(DG321,U,3)'="Y":1,DGNT="N":2,DGNT="T":3,DGNT="B":4,1:" ")
"RTN","DGPTFTR0",17,0)
 S Y=Y_C_G_E K C,G,E
"RTN","DGPTFTR0",18,0)
 ; state code
"RTN","DGPTFTR0",19,0)
 S X=$S($D(^DIC(5,+$P(DG11,U,5),0)):^(0),1:""),L=2,Z=3 D ENTER0
"RTN","DGPTFTR0",20,0)
 ; county code
"RTN","DGPTFTR0",21,0)
 S X=$S($D(^DIC(5,+$P(DG11,U,5),1,+$P(DG11,U,7),0)):^(0),1:""),L=3,Z=3 D ENTER0
"RTN","DGPTFTR0",22,0)
 ; zip code
"RTN","DGPTFTR0",23,0)
 S X=DG11,Z=6,L=5 D ENTER
"RTN","DGPTFTR0",24,0)
 ; means test
"RTN","DGPTFTR0",25,0)
 S Y=Y_$E($P(DG0,U,10),1,2)
"RTN","DGPTFTR0",26,0)
 F K=$L(Y):1:79 S Y=Y_" "
"RTN","DGPTFTR0",27,0)
 D SAVE
"RTN","DGPTFTR0",28,0)
P401 G 401:'$D(^DGPT(J,"401P"))!(T1) S DG41=^("401P"),Y=$S(T1:"C",1:"N")_"401"_DGHEAD_"P"_"           "
"RTN","DGPTFTR0",29,0)
 S DG41=$S($D(^DGPT(J,"401P")):^("401P"),1:"")
"RTN","DGPTFTR0",30,0)
 S L=1 F K=1:1:5 S:'$P(DG41,U,K) DG41=$P(DG41,U,1,K-1)_U_$P(DG41,U,K+1,99),K=K-1 S L=L+1 Q:L=5
"RTN","DGPTFTR0",31,0)
 F I=1:1:5 S DGPTTMP=$$ICDOP^ICDCODE(+$P(DG41,U,I),$$GETDATE^ICDGTDRG(PTF)) S Y=Y_$S(+DGPTTMP>0&($P(DGPTTMP,U,10)):$J($P($P(DGPTTMP,U,2),".",1),2)_$E($P($P(DGPTTMP,U,2),".",2)_"   ",1,3),1:"     ")_"  "
"RTN","DGPTFTR0",32,0)
 I $E(Y,40)'=" " S Y=Y_"      " D SAVE
"RTN","DGPTFTR0",33,0)
401 G 501:'$D(^DGPT(J,"S")) K ^UTILITY($J,"S") S I=0
"RTN","DGPTFTR0",34,0)
SUR S I=$O(^DGPT(J,"S",I)) G 501:I'>0 S DGSUR=^(I,0) G SUR:'DGSUR
"RTN","DGPTFTR0",35,0)
 G SUR:DGSUR<T1!(DGSUR>T2) S DGSUD=+^(0)\1,^UTILITY($J,"S",DGSUD)=$S($D(^UTILITY($J,"S",DGSUD)):^(DGSUD),1:0)+1,F=$S(DGSUD<2871000:0,1:1)
"RTN","DGPTFTR0",36,0)
 I ^UTILITY($J,"S",DGSUD)>$S(F:3,1:2) D  I Y'=1 S DGERR=1 Q
"RTN","DGPTFTR0",37,0)
 .W !!,"**There are more than ",$S(F:"three",1:"two")," surgeries on the same date**"
"RTN","DGPTFTR0",38,0)
 .S DIR(0)="Y",DIR("B")="YES",DIR("A")="OK to continue?" D ^DIR K DIR
"RTN","DGPTFTR0",39,0)
 S Y=$S(T1:"C",1:"N")_"40"_^(DGSUD)_DGHEAD_$E(DGSUD,4,5)_$E(DGSUD,6,7)_$E(DGSUD,2,3)_$S($D(^DIC(45.3,+$P(DGSUR,U,3),0)):$P(^(0),U,1),1:"  ")
"RTN","DGPTFTR0",40,0)
 S L=1,X=DGSUR F Z=4:1:7 D ENTER
"RTN","DGPTFTR0",41,0)
 S L=1 F K=8:1:12 S:'$P(DGSUR,U,K) DGSUR=$P(DGSUR,U,1,K-1)_U_$P(DGSUR,U,K+1,99),K=K-1 S L=L+1 Q:L=5
"RTN","DGPTFTR0",42,0)
 F K=8:1:12 S DGPTTMP=$$ICDOP^ICDCODE(+$P(DGSUR,U,I),$$GETDATE^ICDGTDRG(PTF)) S Y=Y_$S(+DGPTTMP>0&($P(DGPTTMP,U,10)):$J($P($P(DGPTTMP,U,2),".",1),2)_$E($P($P(DGPTTMP,U,2),".",2)_"   ",1,3),1:"     ")_"  "
"RTN","DGPTFTR0",43,0)
 S Y=Y_"      " D SAVE G SUR
"RTN","DGPTFTR0",44,0)
501 G 501^DGPTFTR2
"RTN","DGPTFTR0",45,0)
 Q
"RTN","DGPTFTR0",46,0)
ENTER S Y=Y_$J($P(X,U,Z),L)
"RTN","DGPTFTR0",47,0)
 Q
"RTN","DGPTFTR0",48,0)
ENTER0 S Y=Y_$S($P(X,U,Z)]"":$E("00000",$L($P(X,U,Z))+1,L)_$P(X,U,Z),1:$J($P(X,U,Z),L))
"RTN","DGPTFTR0",49,0)
 Q
"RTN","DGPTFTR0",50,0)
SAVE D START^DGPTFTR1 S:'DGERR ^UTILITY($J,DGCNT,0)=Y,DGCNT=DGCNT+1
"RTN","DGPTFTR0",51,0)
Q Q
"RTN","DGPTFTR0",52,0)
DGNAM S X=DGNAM I X?.E.P F I=1:1:$L(X) S Z=$E(X,I) Q:Z=","  S:Z?.P&(Z]"") X=$E(X,1,I-1)_$E(X,I+1,$L(X)),I=I-1 Q:X'?.E.P
"RTN","DGPTFTR0",53,0)
 I X?.E.L D UP^DGHELP
"RTN","DGPTFTR0",54,0)
 S DGNAM=X
"RTN","DGPTR0")
0^2^B22182596
"RTN","DGPTR0",1,0)
DGPTR0 ;MJK/JS/ADL - PTF TRANSMISSION ; 10/1/03 6:44pm
"RTN","DGPTR0",2,0)
 ;;5.3;Registration;**114,247,338,342,510,524**;Aug 13, 1993
"RTN","DGPTR0",3,0)
 ;;ADL;Update for CSV Project;;Mar 27, 2003
"RTN","DGPTR0",4,0)
 ; -- setup control data
"RTN","DGPTR0",5,0)
 ; ssn
"RTN","DGPTR0",6,0)
 S X=$P(DG10,U,9),Y=$S($E(X,10)="P":"P",1:" ")_$E(X_"         ",1,9)
"RTN","DGPTR0",7,0)
 ; -- adm d/t
"RTN","DGPTR0",8,0)
 S X=$P($P(DG0,U,2),"."),Y=Y_$E(X,4,5)_$E(X,6,7)_$E(X,2,3)_$E($P($P(DG0,U,2),".",2)_"0000",1,4)
"RTN","DGPTR0",9,0)
 ; -- facility #
"RTN","DGPTR0",10,0)
 S L=3,X=DG0,Z=3 D ENTER S Y=Y_$E($P(X,U,5)_"   ",1,3)
"RTN","DGPTR0",11,0)
 S DGHEAD=Y,Y="    "_Y D HEAD^DGPTR1
"RTN","DGPTR0",12,0)
 ;
"RTN","DGPTR0",13,0)
101 ; -- setup 101 transation
"RTN","DGPTR0",14,0)
 ; control data and name
"RTN","DGPTR0",15,0)
 ;S Y=$S(T1:"C",1:"N")_"101"_DGHEAD,DGNAM=$P(DG10,U,1) D DGNAM S Y=Y_$E($P(DGNAM,",",1)_"           ",1,12)_$J($E($P(DGNAM,",",2),1),1)_$J($E($P($P(DGNAM,",",2)," ",2),1),1)
"RTN","DGPTR0",16,0)
 S Y=$S(T1:"C",1:"N")_"101"_DGHEAD S Y=Y_$$PTFNMFT($P(DG10,U))
"RTN","DGPTR0",17,0)
 ; source of admission
"RTN","DGPTR0",18,0)
 S Y=Y_$S($D(^DIC(45.1,+DG101,0)):$J($P(^(0),U,1),2),1:"  ")
"RTN","DGPTR0",19,0)
 ; xfring fac and suffix
"RTN","DGPTR0",20,0)
 S L=3,X=DG101,Z=5 D ENTER S Y=Y_$E($P(X,U,6)_"   ",1,3)
"RTN","DGPTR0",21,0)
 ; source of payment
"RTN","DGPTR0",22,0)
 S Y=Y_$S("A0"[$P(DG0,U,5):" ",1:$J($P(DG101,U,3),1))
"RTN","DGPTR0",23,0)
 ;POW Location
"RTN","DGPTR0",24,0)
 S Y=Y_$S($P(DG52,U,5)="N":1,$P(DG52,U,5)'="Y":3,$P(DG52,U,6)>0&($P(DG52,U,6)<7):3+$P(DG52,U,6),$P(DG52,U,6)>6&($P(DG52,U,6)<9):$C($P(DG52,U,6)+58),1:" ")
"RTN","DGPTR0",25,0)
 ;marital status, sex
"RTN","DGPTR0",26,0)
 S Y=Y_$S($D(^DIC(11,+$P(DG10,U,5),0)):$E(^(0),1),1:" ")_$J($P(DG10,U,2),1)
"RTN","DGPTR0",27,0)
 ;  date of birth
"RTN","DGPTR0",28,0)
 S DGDOB=$P(DG10,U,3)\1,Y=Y_$E(DGDOB,4,5)_$E(DGDOB,6,7)_(1700+$E(DGDOB,1,3))
"RTN","DGPTR0",29,0)
 ; period of service
"RTN","DGPTR0",30,0)
 S DGPOS=$S($D(^DIC(21,+$P(DG32,U,3),0)):$P(^(0),U,3),1:"")
"RTN","DGPTR0",31,0)
 I $D(^DGPM(+$O(^DGPM("APTF",J,0)),"ODS")),+^("ODS") S DGPOS=6
"RTN","DGPTR0",32,0)
 ;-- if non vet admitting eligibility make POS 9
"RTN","DGPTR0",33,0)
 S DGPOS=$$CKPOS^DGPTUTL($P($G(^DGPT(PTF,101)),U,8),DGPOS)
"RTN","DGPTR0",34,0)
 S X=DGPOS,Z=1,L=2 D ENTER
"RTN","DGPTR0",35,0)
 ; agent orange
"RTN","DGPTR0",36,0)
 S G=" " S DGAO=$P(DG321,U,2) S:DGPOS=7 G=$S($P(DG321,U)'="Y":1,DGAO="N":2,DGAO="Y":3,1:4) S:(DGAO="Y")&($P(DG321,U,13)="K") G=5
"RTN","DGPTR0",37,0)
 ; rad exposure
"RTN","DGPTR0",38,0)
 S E=" " I "^0^2^4^5^7^8^Z^"[(U_DGPOS_U) S DGNT=$P(DG321,U,12),E=$S($P(DG321,U,3)'="Y":1,DGNT="N":2,DGNT="T":3,DGNT="B":4,1:" ")
"RTN","DGPTR0",39,0)
 S Y=Y_G_E K DGPOS,G,E
"RTN","DGPTR0",40,0)
 ; state code
"RTN","DGPTR0",41,0)
 S X=$S($D(^DIC(5,+$P(DG11,U,5),0)):^(0),1:""),L=2,Z=3 D ENTER0
"RTN","DGPTR0",42,0)
 ; county code
"RTN","DGPTR0",43,0)
 S X=$S($D(^DIC(5,+$P(DG11,U,5),1,+$P(DG11,U,7),0)):^(0),1:""),L=3,Z=3 D ENTER0
"RTN","DGPTR0",44,0)
 ; zip code
"RTN","DGPTR0",45,0)
 S X=DG11,Z=6,L=5 D ENTER
"RTN","DGPTR0",46,0)
 ; means test
"RTN","DGPTR0",47,0)
 S Y=Y_$S($P(DG70,U,26)="Y":"AS",1:$E($P(DG0,U,10)_"  ",1,2))
"RTN","DGPTR0",48,0)
 ; income
"RTN","DGPTR0",49,0)
 I $L($P(DG101,U,7))>6 S Y=Y_"999999"
"RTN","DGPTR0",50,0)
 E  S X=DG101,Z=7,L=6 D ENTER0
"RTN","DGPTR0",51,0)
 ;MST
"RTN","DGPTR0",52,0)
 S X=$$GETSTAT^DGMSTAPI(+DG0) S Y=Y_$S(X<0:"U",1:$P(X,"^",2))
"RTN","DGPTR0",53,0)
 D FILL^DGPTR2,SAVE
"RTN","DGPTR0",54,0)
 I T1 S Y=$E(Y,1,52)_" "_$E(Y,54,125)
"RTN","DGPTR0",55,0)
 ;
"RTN","DGPTR0",56,0)
P401 ; -- setup 401P transaction
"RTN","DGPTR0",57,0)
 G 401:'$D(^DGPT(J,"401P"))!(T1) S DG41=^("401P"),Y=$S(T1:"C",1:"N")_"401"_DGHEAD_"P"_"           "
"RTN","DGPTR0",58,0)
 S DG41=$S($D(^DGPT(J,"401P")):^("401P"),1:"")
"RTN","DGPTR0",59,0)
 S L=1 F K=1:1:5 S:'$P(DG41,U,K) DG41=$P(DG41,U,1,K-1)_U_$P(DG41,U,K+1,99),K=K-1 S L=L+1 Q:L=5
"RTN","DGPTR0",60,0)
 F I=1:1:5 S DGPTTMP=$$ICDOP^ICDCODE(+$P(DG41,U,I),$$GETDATE^ICDGTDRG(J)),Y=Y_$S(+DGPTTMP>0:$J($P($P(DGPTTMP,U,2),".",1),2)_$E($P($P(DGPTTMP,U,2),".",2)_"   ",1,3),1:"     ")_"  "
"RTN","DGPTR0",61,0)
 I $E(Y,40)'=" " D FILL^DGPTR2,SAVE
"RTN","DGPTR0",62,0)
 ;
"RTN","DGPTR0",63,0)
401 ; -- setup 401 transactions
"RTN","DGPTR0",64,0)
 G 501:'$D(^DGPT(J,"S")) K ^UTILITY($J,"S") S I=0
"RTN","DGPTR0",65,0)
SUR S I=$O(^DGPT(J,"S",I)) G 501:'I S DGSUR=^(I,0),DGAUX=$S($D(^DGPT(J,"S",I,300)):^(300),1:"") G SUR:'DGSUR
"RTN","DGPTR0",66,0)
 G SUR:DGSUR<T1!(DGSUR>T2) S DGSUD=+^(0)\1,^UTILITY($J,"S",DGSUD)=$S($D(^UTILITY($J,"S",DGSUD)):^(DGSUD),1:0)+1,F=$S(DGSUD<2871000:0,1:1)
"RTN","DGPTR0",67,0)
 I ^UTILITY($J,"S",DGSUD)>$S(F:3,1:2) D  I Y'=1 S DGERR=1 Q
"RTN","DGPTR0",68,0)
 .W !,"**There are more than ",$S(F:"three",1:"two")," surgeries on the same date**"
"RTN","DGPTR0",69,0)
 .S DIR(0)="Y",DIR("B")="YES",DIR("A")="OK to continue?" D ^DIR K DIR
"RTN","DGPTR0",70,0)
 S Y=$S(T1:"C",1:"N")_"40"_^(DGSUD)_DGHEAD_$E(DGSUD,4,5)_$E(DGSUD,6,7)_$E(DGSUD,2,3)_$E($P(+DGSUR,".",2)_"0000",1,4)_$S($D(^DIC(45.3,+$P(DGSUR,U,3),0)):$P(^(0),U,1),1:"  ")
"RTN","DGPTR0",71,0)
 S L=1,X=DGSUR F Z=4:1:7 D ENTER
"RTN","DGPTR0",72,0)
 S L=1 F K=8:1:12 S:'$P(DGSUR,U,K) DGSUR=$P(DGSUR,U,1,K-1)_U_$P(DGSUR,U,K+1,99),K=K-1 S L=L+1 Q:L=5
"RTN","DGPTR0",73,0)
 F K=8:1:12 S DGPTTMP=$$ICDOP^ICDCODE(+$P(DGSUR,U,K),$$GETDATE^ICDGTDRG(J)),Y=Y_$S(+DGPTTMP>0:$J($P($P(DGPTTMP,U,2),".",1),2)_$E($P($P(DGPTTMP,U,2),".",2)_"   ",1,3),1:"     ")_"  "
"RTN","DGPTR0",74,0)
 ;-- att phy
"RTN","DGPTR0",75,0)
 S Y=Y_"         "
"RTN","DGPTR0",76,0)
 ;-- additional ptf question
"RTN","DGPTR0",77,0)
 S Y=Y_$E($P(DGAUX,U)_" ")
"RTN","DGPTR0",78,0)
 K DGAUX
"RTN","DGPTR0",79,0)
 D FILL^DGPTR2,SAVE G SUR
"RTN","DGPTR0",80,0)
501 G 501^DGPTR2
"RTN","DGPTR0",81,0)
 Q
"RTN","DGPTR0",82,0)
ENTER S Y=Y_$J($P(X,U,Z),L)
"RTN","DGPTR0",83,0)
 Q
"RTN","DGPTR0",84,0)
ENTER0 S Y=Y_$S($P(X,U,Z)]"":$E("000000",$L($P(X,U,Z))+1,L)_$P(X,U,Z),1:$J($P(X,U,Z),L))
"RTN","DGPTR0",85,0)
 Q
"RTN","DGPTR0",86,0)
SAVE D START^DGPTR1 S:'DGERR ^XMB(3.9,DGXMZ,2,DGCNT,0)=Y,DGCNT=DGCNT+1
"RTN","DGPTR0",87,0)
 I DGERR'>0 S DGACNT=DGACNT+1,^TMP("AEDIT",$J,$E(Y,1,4),DGACNT)=Y
"RTN","DGPTR0",88,0)
Q Q
"RTN","DGPTR0",89,0)
DGNAM S X=DGNAM I X?.E.P F I=1:1:$L(X) S Z=$E(X,I) Q:Z=","  S:Z?.P&(Z]"") X=$E(X,1,I-1)_$E(X,I+1,$L(X)),I=I-1 Q:X'?.E.P
"RTN","DGPTR0",90,0)
 I X?.E.L D UP^DGHELP
"RTN","DGPTR0",91,0)
 S DGNAM=X
"RTN","DGPTR0",92,0)
 Q
"RTN","DGPTR0",93,0)
 ;
"RTN","DGPTR0",94,0)
PTFNMFT(DG10) ;this function will format the name of the patient for
"RTN","DGPTR0",95,0)
 ; transmission of the 101 record to Austin. In addition, this
"RTN","DGPTR0",96,0)
 ; function will be used by OPC so that the format will be consistent
"RTN","DGPTR0",97,0)
 ; for OPC and PTF.
"RTN","DGPTR0",98,0)
 ;  INPUT :   DG10 - .01 field from the patient record.
"RTN","DGPTR0",99,0)
 ;  OUTPUT:   name in the format proper format.
"RTN","DGPTR0",100,0)
 ;        A = <12 - characters of last name padded with blanks>
"RTN","DGPTR0",101,0)
 ;        B = <1  - first initial of fist name>
"RTN","DGPTR0",102,0)
 ;        C = <1  - first initial of middle name>
"RTN","DGPTR0",103,0)
 ;      returns :ABC <14 - characters>
"RTN","DGPTR0",104,0)
 N X,I
"RTN","DGPTR0",105,0)
 S DGNAM=DG10 D DGNAM
"RTN","DGPTR0",106,0)
 Q $E($P(DGNAM,",",1)_"           ",1,12)_$J($E($P(DGNAM,",",2),1),1)_$J($E($P($P(DGNAM,",",2)," ",2),1),1)
"RTN","DGPTR0",107,0)
 ;
"VER")
8.0^22
**END**
**END**
