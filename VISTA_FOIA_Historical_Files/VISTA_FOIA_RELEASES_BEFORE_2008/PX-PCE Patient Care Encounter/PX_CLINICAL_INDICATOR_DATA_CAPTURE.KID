KIDS Distribution saved on Aug 05, 2005@12:40:25
CLINICAL INDICATOR DATA CAPTURE 1.0
**KIDS**:PX CLINICAL INDICATOR DATA CAPTURE 1.0^PX*1.0*124^IB*2.0*260^RA*5.0*41^SR*3.0*119^RMPR*3.0*78^PSO*7.0*143^

**INSTALL NAME**
PX CLINICAL INDICATOR DATA CAPTURE 1.0
"BLD",4989,0)
PX CLINICAL INDICATOR DATA CAPTURE 1.0^^1^3050805^n
"BLD",4989,1,0)
^9.61A^2^2^3050119^^
"BLD",4989,1,1,0)
Host file deployment of all Clinical Indicator Data Capture patches except
"BLD",4989,1,2,0)
CPRS.
"BLD",4989,10,0)
^9.63^3^6
"BLD",4989,10,1,0)
PX*1.0*124^1
"BLD",4989,10,2,0)
IB*2.0*260^1
"BLD",4989,10,3,0)
RA*5.0*41^1
"BLD",4989,10,5,0)
SR*3.0*119^1
"BLD",4989,10,6,0)
RMPR*3.0*78^1
"BLD",4989,10,7,0)
PSO*7.0*143^1
"BLD",4989,10,"B","IB*2.0*260",2)

"BLD",4989,10,"B","PSO*7.0*143",7)

"BLD",4989,10,"B","PX*1.0*124",1)

"BLD",4989,10,"B","RA*5.0*41",3)

"BLD",4989,10,"B","RMPR*3.0*78",6)

"BLD",4989,10,"B","SR*3.0*119",5)

"BLD",4989,"KRN",0)
^9.67PA^8989.52^19
"BLD",4989,"KRN",.4,0)
.4
"BLD",4989,"KRN",.401,0)
.401
"BLD",4989,"KRN",.402,0)
.402
"BLD",4989,"KRN",.403,0)
.403
"BLD",4989,"KRN",.5,0)
.5
"BLD",4989,"KRN",.84,0)
.84
"BLD",4989,"KRN",3.6,0)
3.6
"BLD",4989,"KRN",3.8,0)
3.8
"BLD",4989,"KRN",9.2,0)
9.2
"BLD",4989,"KRN",9.8,0)
9.8
"BLD",4989,"KRN",19,0)
19
"BLD",4989,"KRN",19.1,0)
19.1
"BLD",4989,"KRN",101,0)
101
"BLD",4989,"KRN",409.61,0)
409.61
"BLD",4989,"KRN",771,0)
771
"BLD",4989,"KRN",870,0)
870
"BLD",4989,"KRN",8989.51,0)
8989.51
"BLD",4989,"KRN",8989.52,0)
8989.52
"BLD",4989,"KRN",8994,0)
8994
"BLD",4989,"KRN","B",.4,.4)

"BLD",4989,"KRN","B",.401,.401)

"BLD",4989,"KRN","B",.402,.402)

"BLD",4989,"KRN","B",.403,.403)

"BLD",4989,"KRN","B",.5,.5)

"BLD",4989,"KRN","B",.84,.84)

"BLD",4989,"KRN","B",3.6,3.6)

"BLD",4989,"KRN","B",3.8,3.8)

"BLD",4989,"KRN","B",9.2,9.2)

"BLD",4989,"KRN","B",9.8,9.8)

"BLD",4989,"KRN","B",19,19)

"BLD",4989,"KRN","B",19.1,19.1)

"BLD",4989,"KRN","B",101,101)

"BLD",4989,"KRN","B",409.61,409.61)

"BLD",4989,"KRN","B",771,771)

"BLD",4989,"KRN","B",870,870)

"BLD",4989,"KRN","B",8989.51,8989.51)

"BLD",4989,"KRN","B",8989.52,8989.52)

"BLD",4989,"KRN","B",8994,8994)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
PX*1.0*124
"BLD",4961,0)
PX*1.0*124^PCE PATIENT CARE ENCOUNTER^0^3050805^y
"BLD",4961,1,0)
^9.61A^2^2^3040406^^^^
"BLD",4961,1,1,0)
Please see the National Patch Module for details
"BLD",4961,1,2,0)
of the enhancements included in this patch.
"BLD",4961,4,0)
^9.64PA^9000010^5
"BLD",4961,4,9000010,0)
9000010
"BLD",4961,4,9000010,2,0)
^9.641^9000010^1
"BLD",4961,4,9000010,2,9000010,0)
VISIT  (File-top level)
"BLD",4961,4,9000010,2,9000010,1,0)
^9.6411^80017^7
"BLD",4961,4,9000010,2,9000010,1,80011,0)
SERVICE CONNECTION EDIT FLAG
"BLD",4961,4,9000010,2,9000010,1,80012,0)
AGENT ORANGE EDIT FLAG
"BLD",4961,4,9000010,2,9000010,1,80013,0)
IONIZING RADIATION EDIT FLAG
"BLD",4961,4,9000010,2,9000010,1,80014,0)
ENVIRONMENTAL CONT. EDIT FLAG
"BLD",4961,4,9000010,2,9000010,1,80015,0)
MST EDIT FLAG
"BLD",4961,4,9000010,2,9000010,1,80016,0)
HEAD AND NECK CANCER EDIT FLAG
"BLD",4961,4,9000010,2,9000010,1,80017,0)
COMBAT VETERAN EDIT FLAG
"BLD",4961,4,9000010,222)
y^n^p^^^^n^^n
"BLD",4961,4,9000010,224)

"BLD",4961,4,9000010.07,0)
9000010.07
"BLD",4961,4,9000010.07,2,0)
^9.641^9000010.07^1
"BLD",4961,4,9000010.07,2,9000010.07,0)
V POV  (File-top level)
"BLD",4961,4,9000010.07,2,9000010.07,1,0)
^9.6411^.17^1
"BLD",4961,4,9000010.07,2,9000010.07,1,.17,0)
ORDERING/RESULTING
"BLD",4961,4,9000010.07,222)
y^n^p^^^^n^^n
"BLD",4961,4,9000010.07,224)

"BLD",4961,4,9000010.11,0)
9000010.11
"BLD",4961,4,9000010.11,2,0)
^9.641^9000010.11^1
"BLD",4961,4,9000010.11,2,9000010.11,0)
V IMMUNIZATION  (File-top level)
"BLD",4961,4,9000010.11,2,9000010.11,1,0)
^9.6411^.15^8
"BLD",4961,4,9000010.11,2,9000010.11,1,.08,0)
DIAGNOSIS
"BLD",4961,4,9000010.11,2,9000010.11,1,.09,0)
DIAGNOSIS 2
"BLD",4961,4,9000010.11,2,9000010.11,1,.1,0)
DIAGNOSIS 3
"BLD",4961,4,9000010.11,2,9000010.11,1,.11,0)
DIAGNOSIS 4
"BLD",4961,4,9000010.11,2,9000010.11,1,.12,0)
DIAGNOSIS 5
"BLD",4961,4,9000010.11,2,9000010.11,1,.13,0)
DIAGNOSIS 6
"BLD",4961,4,9000010.11,2,9000010.11,1,.14,0)
DIAGNOSIS 7
"BLD",4961,4,9000010.11,2,9000010.11,1,.15,0)
DIAGNOSIS 8
"BLD",4961,4,9000010.11,222)
y^n^p^^^^n^^n
"BLD",4961,4,9000010.11,224)

"BLD",4961,4,9000010.12,0)
9000010.12
"BLD",4961,4,9000010.12,2,0)
^9.641^9000010.12^1
"BLD",4961,4,9000010.12,2,9000010.12,0)
V SKIN TEST  (File-top level)
"BLD",4961,4,9000010.12,2,9000010.12,1,0)
^9.6411^.15^8
"BLD",4961,4,9000010.12,2,9000010.12,1,.08,0)
DIAGNOSIS
"BLD",4961,4,9000010.12,2,9000010.12,1,.09,0)
DIAGNOSIS 2
"BLD",4961,4,9000010.12,2,9000010.12,1,.1,0)
DIAGNOSIS 3
"BLD",4961,4,9000010.12,2,9000010.12,1,.11,0)
DIAGNOSIS 4
"BLD",4961,4,9000010.12,2,9000010.12,1,.12,0)
DIAGNOSIS 5
"BLD",4961,4,9000010.12,2,9000010.12,1,.13,0)
DIAGNOSIS 6
"BLD",4961,4,9000010.12,2,9000010.12,1,.14,0)
DIAGNOSIS 7
"BLD",4961,4,9000010.12,2,9000010.12,1,.15,0)
DIAGNOSIS 8
"BLD",4961,4,9000010.12,222)
y^n^p^^^^n^^n
"BLD",4961,4,9000010.12,224)

"BLD",4961,4,9000010.18,0)
9000010.18
"BLD",4961,4,9000010.18,2,0)
^9.641^9000010.18^1
"BLD",4961,4,9000010.18,2,9000010.18,0)
V CPT  (File-top level)
"BLD",4961,4,9000010.18,2,9000010.18,1,0)
^9.6411^.17^9
"BLD",4961,4,9000010.18,2,9000010.18,1,.05,0)
DIAGNOSIS
"BLD",4961,4,9000010.18,2,9000010.18,1,.09,0)
DIAGNOSIS 2
"BLD",4961,4,9000010.18,2,9000010.18,1,.1,0)
DIAGNOSIS 3
"BLD",4961,4,9000010.18,2,9000010.18,1,.11,0)
DIAGNOSIS 4
"BLD",4961,4,9000010.18,2,9000010.18,1,.12,0)
DIAGNOSIS 5
"BLD",4961,4,9000010.18,2,9000010.18,1,.13,0)
DIAGNOSIS 6
"BLD",4961,4,9000010.18,2,9000010.18,1,.14,0)
DIAGNOSIS 7
"BLD",4961,4,9000010.18,2,9000010.18,1,.15,0)
DIAGNOSIS 8
"BLD",4961,4,9000010.18,2,9000010.18,1,.17,0)
ORDER REFERENCE
"BLD",4961,4,9000010.18,222)
y^n^p^^^^n^^n
"BLD",4961,4,9000010.18,224)

"BLD",4961,4,"APDD",9000010,9000010)

"BLD",4961,4,"APDD",9000010,9000010,80011)

"BLD",4961,4,"APDD",9000010,9000010,80012)

"BLD",4961,4,"APDD",9000010,9000010,80013)

"BLD",4961,4,"APDD",9000010,9000010,80014)

"BLD",4961,4,"APDD",9000010,9000010,80015)

"BLD",4961,4,"APDD",9000010,9000010,80016)

"BLD",4961,4,"APDD",9000010,9000010,80017)

"BLD",4961,4,"APDD",9000010.07,9000010.07)

"BLD",4961,4,"APDD",9000010.07,9000010.07,.17)

"BLD",4961,4,"APDD",9000010.11,9000010.11)

"BLD",4961,4,"APDD",9000010.11,9000010.11,.08)

"BLD",4961,4,"APDD",9000010.11,9000010.11,.09)

"BLD",4961,4,"APDD",9000010.11,9000010.11,.1)

"BLD",4961,4,"APDD",9000010.11,9000010.11,.11)

"BLD",4961,4,"APDD",9000010.11,9000010.11,.12)

"BLD",4961,4,"APDD",9000010.11,9000010.11,.13)

"BLD",4961,4,"APDD",9000010.11,9000010.11,.14)

"BLD",4961,4,"APDD",9000010.11,9000010.11,.15)

"BLD",4961,4,"APDD",9000010.12,9000010.12)

"BLD",4961,4,"APDD",9000010.12,9000010.12,.08)

"BLD",4961,4,"APDD",9000010.12,9000010.12,.09)

"BLD",4961,4,"APDD",9000010.12,9000010.12,.1)

"BLD",4961,4,"APDD",9000010.12,9000010.12,.11)

"BLD",4961,4,"APDD",9000010.12,9000010.12,.12)

"BLD",4961,4,"APDD",9000010.12,9000010.12,.13)

"BLD",4961,4,"APDD",9000010.12,9000010.12,.14)

"BLD",4961,4,"APDD",9000010.12,9000010.12,.15)

"BLD",4961,4,"APDD",9000010.18,9000010.18)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.05)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.09)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.1)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.11)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.12)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.13)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.14)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.15)

"BLD",4961,4,"APDD",9000010.18,9000010.18,.17)

"BLD",4961,4,"B",9000010,9000010)

"BLD",4961,4,"B",9000010.07,9000010.07)

"BLD",4961,4,"B",9000010.11,9000010.11)

"BLD",4961,4,"B",9000010.12,9000010.12)

"BLD",4961,4,"B",9000010.18,9000010.18)

"BLD",4961,"KRN",0)
^9.67PA^8989.52^19
"BLD",4961,"KRN",.4,0)
.4
"BLD",4961,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4961,"KRN",.401,0)
.401
"BLD",4961,"KRN",.401,"NM",0)
^9.68A^^
"BLD",4961,"KRN",.402,0)
.402
"BLD",4961,"KRN",.403,0)
.403
"BLD",4961,"KRN",.5,0)
.5
"BLD",4961,"KRN",.84,0)
.84
"BLD",4961,"KRN",3.6,0)
3.6
"BLD",4961,"KRN",3.8,0)
3.8
"BLD",4961,"KRN",9.2,0)
9.2
"BLD",4961,"KRN",9.8,0)
9.8
"BLD",4961,"KRN",9.8,"NM",0)
^9.68A^72^65
"BLD",4961,"KRN",9.8,"NM",2,0)
PXBPORD^^0^B2060074
"BLD",4961,"KRN",9.8,"NM",3,0)
PXBUTL0^^0^B31353311
"BLD",4961,"KRN",9.8,"NM",4,0)
PXBSTOR^^0^B38312987
"BLD",4961,"KRN",9.8,"NM",5,0)
PXBSTOR1^^0^B11329051
"BLD",4961,"KRN",9.8,"NM",6,0)
PXBPCPT^^0^B47694118
"BLD",4961,"KRN",9.8,"NM",7,0)
PXBPCPT2^^0^B6970858
"BLD",4961,"KRN",9.8,"NM",8,0)
PXBMCPT2^^0^B16601699
"BLD",4961,"KRN",9.8,"NM",9,0)
PXBHLP2^^0^B17351171
"BLD",4961,"KRN",9.8,"NM",10,0)
PXBHLPR^^0^B1647879
"BLD",4961,"KRN",9.8,"NM",11,0)
PXBGPOV^^0^B11193479
"BLD",4961,"KRN",9.8,"NM",12,0)
PXBGCPT^^0^B6773034
"BLD",4961,"KRN",9.8,"NM",13,0)
PXBDREQ^^0^B9032260
"BLD",4961,"KRN",9.8,"NM",14,0)
PXBDCPT^^0^B45424112
"BLD",4961,"KRN",9.8,"NM",15,0)
PXKFPOV^^0^B3819439
"BLD",4961,"KRN",9.8,"NM",16,0)
PXKFCPT^^0^B3210816
"BLD",4961,"KRN",9.8,"NM",18,0)
PXCEC800^^0^B2123321
"BLD",4961,"KRN",9.8,"NM",19,0)
PXCECPT^^0^B64389674
"BLD",4961,"KRN",9.8,"NM",20,0)
PXCED800^^0^B2395486
"BLD",4961,"KRN",9.8,"NM",21,0)
PXCEPOV^^0^B16838649
"BLD",4961,"KRN",9.8,"NM",22,0)
PXCEVFI4^^0^B25786304
"BLD",4961,"KRN",9.8,"NM",24,0)
PXCA0^^0^B19659643
"BLD",4961,"KRN",9.8,"NM",25,0)
PXCACPT^^0^B47517284
"BLD",4961,"KRN",9.8,"NM",26,0)
PXCACPT1^^0^B11279255
"BLD",4961,"KRN",9.8,"NM",27,0)
PXCAPOV^^0^B36491994
"BLD",4961,"KRN",9.8,"NM",29,0)
PXAICPT^^0^B22419944
"BLD",4961,"KRN",9.8,"NM",30,0)
PXAIPOV^^0^B20201014
"BLD",4961,"KRN",9.8,"NM",31,0)
PXAIPRV^^0^B21340281
"BLD",4961,"KRN",9.8,"NM",32,0)
PXAIVST^^0^B15439008
"BLD",4961,"KRN",9.8,"NM",33,0)
PXAIVSTV^^0^B54889755
"BLD",4961,"KRN",9.8,"NM",34,0)
PXCEPOV1^^0^B23888557
"BLD",4961,"KRN",9.8,"NM",35,0)
PXBCC^^0^B43568980
"BLD",4961,"KRN",9.8,"NM",36,0)
PXBDPOV^^0^B26487122
"BLD",4961,"KRN",9.8,"NM",37,0)
PXBMPOV^^0^B7483817
"BLD",4961,"KRN",9.8,"NM",38,0)
PXBPPOV^^0^B21767905
"BLD",4961,"KRN",9.8,"NM",40,0)
PXCEVFI1^^0^B18089090
"BLD",4961,"KRN",9.8,"NM",41,0)
PXCEVFIL^^0^B38064195
"BLD",4961,"KRN",9.8,"NM",42,0)
PXBAPI1^^0^B50226263
"BLD",4961,"KRN",9.8,"NM",43,0)
PXKFCPT1^^0^B22284185
"BLD",4961,"KRN",9.8,"NM",44,0)
PXCEVIMM^^0^B27090719
"BLD",4961,"KRN",9.8,"NM",45,0)
PXCESK^^0^B18964532
"BLD",4961,"KRN",9.8,"NM",46,0)
PXKFSK^^0^B2490158
"BLD",4961,"KRN",9.8,"NM",47,0)
PXKFIMM^^0^B2638532
"BLD",4961,"KRN",9.8,"NM",48,0)
PXCASK^^0^B12106125
"BLD",4961,"KRN",9.8,"NM",49,0)
PXCAVIMM^^0^B17122556
"BLD",4961,"KRN",9.8,"NM",50,0)
PXBPPOV1^^0^B23470728
"BLD",4961,"KRN",9.8,"NM",51,0)
PXBAPI21^^0^B21580661
"BLD",4961,"KRN",9.8,"NM",52,0)
PXCEPRV^^0^B27804428
"BLD",4961,"KRN",9.8,"NM",53,0)
PXCEVFI2^^0^B33899362
"BLD",4961,"KRN",9.8,"NM",54,0)
PXKMAIN^^0^B41988947
"BLD",4961,"KRN",9.8,"NM",55,0)
PXKMAIN1^^0^B37255334
"BLD",4961,"KRN",9.8,"NM",57,0)
VSITFLD^^0^B10171572
"BLD",4961,"KRN",9.8,"NM",58,0)
PXKFVST^^0^B9521492
"BLD",4961,"KRN",9.8,"NM",59,0)
PXAIPL^^0^B4591810
"BLD",4961,"KRN",9.8,"NM",60,0)
PXCEAPPM^^0^B6418906
"BLD",4961,"KRN",9.8,"NM",61,0)
PXCEVST^^0^B6324177
"BLD",4961,"KRN",9.8,"NM",62,0)
PXCESIT^^0^B9680186
"BLD",4961,"KRN",9.8,"NM",64,0)
PXBGPOV2^^0^B32290278
"BLD",4961,"KRN",9.8,"NM",65,0)
PXCEVFI5^^0^B5688048
"BLD",4961,"KRN",9.8,"NM",66,0)
PXCECCLS^^0^B21659444
"BLD",4961,"KRN",9.8,"NM",67,0)
PXAIIMM^^0^B7183500
"BLD",4961,"KRN",9.8,"NM",68,0)
PXAISK^^0^B6962384
"BLD",4961,"KRN",9.8,"NM",69,0)
PXRRMDR^^0^B81741465
"BLD",4961,"KRN",9.8,"NM",70,0)
PXBPPRV1^^0^B14985969
"BLD",4961,"KRN",9.8,"NM",71,0)
PXBPCPT1^^0^B28242162
"BLD",4961,"KRN",9.8,"NM",72,0)
PXAPI^^0^B36580622
"BLD",4961,"KRN",9.8,"NM","B","PXAICPT",29)

"BLD",4961,"KRN",9.8,"NM","B","PXAIIMM",67)

"BLD",4961,"KRN",9.8,"NM","B","PXAIPL",59)

"BLD",4961,"KRN",9.8,"NM","B","PXAIPOV",30)

"BLD",4961,"KRN",9.8,"NM","B","PXAIPRV",31)

"BLD",4961,"KRN",9.8,"NM","B","PXAISK",68)

"BLD",4961,"KRN",9.8,"NM","B","PXAIVST",32)

"BLD",4961,"KRN",9.8,"NM","B","PXAIVSTV",33)

"BLD",4961,"KRN",9.8,"NM","B","PXAPI",72)

"BLD",4961,"KRN",9.8,"NM","B","PXBAPI1",42)

"BLD",4961,"KRN",9.8,"NM","B","PXBAPI21",51)

"BLD",4961,"KRN",9.8,"NM","B","PXBCC",35)

"BLD",4961,"KRN",9.8,"NM","B","PXBDCPT",14)

"BLD",4961,"KRN",9.8,"NM","B","PXBDPOV",36)

"BLD",4961,"KRN",9.8,"NM","B","PXBDREQ",13)

"BLD",4961,"KRN",9.8,"NM","B","PXBGCPT",12)

"BLD",4961,"KRN",9.8,"NM","B","PXBGPOV",11)

"BLD",4961,"KRN",9.8,"NM","B","PXBGPOV2",64)

"BLD",4961,"KRN",9.8,"NM","B","PXBHLP2",9)

"BLD",4961,"KRN",9.8,"NM","B","PXBHLPR",10)

"BLD",4961,"KRN",9.8,"NM","B","PXBMCPT2",8)

"BLD",4961,"KRN",9.8,"NM","B","PXBMPOV",37)

"BLD",4961,"KRN",9.8,"NM","B","PXBPCPT",6)

"BLD",4961,"KRN",9.8,"NM","B","PXBPCPT1",71)

"BLD",4961,"KRN",9.8,"NM","B","PXBPCPT2",7)

"BLD",4961,"KRN",9.8,"NM","B","PXBPORD",2)

"BLD",4961,"KRN",9.8,"NM","B","PXBPPOV",38)

"BLD",4961,"KRN",9.8,"NM","B","PXBPPOV1",50)

"BLD",4961,"KRN",9.8,"NM","B","PXBPPRV1",70)

"BLD",4961,"KRN",9.8,"NM","B","PXBSTOR",4)

"BLD",4961,"KRN",9.8,"NM","B","PXBSTOR1",5)

"BLD",4961,"KRN",9.8,"NM","B","PXBUTL0",3)

"BLD",4961,"KRN",9.8,"NM","B","PXCA0",24)

"BLD",4961,"KRN",9.8,"NM","B","PXCACPT",25)

"BLD",4961,"KRN",9.8,"NM","B","PXCACPT1",26)

"BLD",4961,"KRN",9.8,"NM","B","PXCAPOV",27)

"BLD",4961,"KRN",9.8,"NM","B","PXCASK",48)

"BLD",4961,"KRN",9.8,"NM","B","PXCAVIMM",49)

"BLD",4961,"KRN",9.8,"NM","B","PXCEAPPM",60)

"BLD",4961,"KRN",9.8,"NM","B","PXCEC800",18)

"BLD",4961,"KRN",9.8,"NM","B","PXCECCLS",66)

"BLD",4961,"KRN",9.8,"NM","B","PXCECPT",19)

"BLD",4961,"KRN",9.8,"NM","B","PXCED800",20)

"BLD",4961,"KRN",9.8,"NM","B","PXCEPOV",21)

"BLD",4961,"KRN",9.8,"NM","B","PXCEPOV1",34)

"BLD",4961,"KRN",9.8,"NM","B","PXCEPRV",52)

"BLD",4961,"KRN",9.8,"NM","B","PXCESIT",62)

"BLD",4961,"KRN",9.8,"NM","B","PXCESK",45)

"BLD",4961,"KRN",9.8,"NM","B","PXCEVFI1",40)

"BLD",4961,"KRN",9.8,"NM","B","PXCEVFI2",53)

"BLD",4961,"KRN",9.8,"NM","B","PXCEVFI4",22)

"BLD",4961,"KRN",9.8,"NM","B","PXCEVFI5",65)

"BLD",4961,"KRN",9.8,"NM","B","PXCEVFIL",41)

"BLD",4961,"KRN",9.8,"NM","B","PXCEVIMM",44)

"BLD",4961,"KRN",9.8,"NM","B","PXCEVST",61)

"BLD",4961,"KRN",9.8,"NM","B","PXKFCPT",16)

"BLD",4961,"KRN",9.8,"NM","B","PXKFCPT1",43)

"BLD",4961,"KRN",9.8,"NM","B","PXKFIMM",47)

"BLD",4961,"KRN",9.8,"NM","B","PXKFPOV",15)

"BLD",4961,"KRN",9.8,"NM","B","PXKFSK",46)

"BLD",4961,"KRN",9.8,"NM","B","PXKFVST",58)

"BLD",4961,"KRN",9.8,"NM","B","PXKMAIN",54)

"BLD",4961,"KRN",9.8,"NM","B","PXKMAIN1",55)

"BLD",4961,"KRN",9.8,"NM","B","PXRRMDR",69)

"BLD",4961,"KRN",9.8,"NM","B","VSITFLD",57)

"BLD",4961,"KRN",19,0)
19
"BLD",4961,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",4961,"KRN",19,"NM",1,0)
PXRRMDR^^0
"BLD",4961,"KRN",19,"NM",2,0)
PX PCE COORDINATOR MENU^^2
"BLD",4961,"KRN",19,"NM","B","PX PCE COORDINATOR MENU",2)

"BLD",4961,"KRN",19,"NM","B","PXRRMDR",1)

"BLD",4961,"KRN",19.1,0)
19.1
"BLD",4961,"KRN",101,0)
101
"BLD",4961,"KRN",409.61,0)
409.61
"BLD",4961,"KRN",771,0)
771
"BLD",4961,"KRN",870,0)
870
"BLD",4961,"KRN",8989.51,0)
8989.51
"BLD",4961,"KRN",8989.52,0)
8989.52
"BLD",4961,"KRN",8994,0)
8994
"BLD",4961,"KRN","B",.4,.4)

"BLD",4961,"KRN","B",.401,.401)

"BLD",4961,"KRN","B",.402,.402)

"BLD",4961,"KRN","B",.403,.403)

"BLD",4961,"KRN","B",.5,.5)

"BLD",4961,"KRN","B",.84,.84)

"BLD",4961,"KRN","B",3.6,3.6)

"BLD",4961,"KRN","B",3.8,3.8)

"BLD",4961,"KRN","B",9.2,9.2)

"BLD",4961,"KRN","B",9.8,9.8)

"BLD",4961,"KRN","B",19,19)

"BLD",4961,"KRN","B",19.1,19.1)

"BLD",4961,"KRN","B",101,101)

"BLD",4961,"KRN","B",409.61,409.61)

"BLD",4961,"KRN","B",771,771)

"BLD",4961,"KRN","B",870,870)

"BLD",4961,"KRN","B",8989.51,8989.51)

"BLD",4961,"KRN","B",8989.52,8989.52)

"BLD",4961,"KRN","B",8994,8994)

"BLD",4961,"QUES",0)
^9.62^^
"BLD",4961,"REQB",0)
^9.611^14^9
"BLD",4961,"REQB",3,0)
PX*1.0*45^2
"BLD",4961,"REQB",4,0)
PX*1.0*130^2
"BLD",4961,"REQB",6,0)
PX*1.0*99^2
"BLD",4961,"REQB",7,0)
OR*3.0*195^2
"BLD",4961,"REQB",8,0)
PX*1.0*132^2
"BLD",4961,"REQB",9,0)
IB*2.0*257^2
"BLD",4961,"REQB",12,0)
PX*1.0*143^2
"BLD",4961,"REQB",13,0)
PX*1.0*149^2
"BLD",4961,"REQB",14,0)
PX*1.0*151^2
"BLD",4961,"REQB","B","IB*2.0*257",9)

"BLD",4961,"REQB","B","OR*3.0*195",7)

"BLD",4961,"REQB","B","PX*1.0*130",4)

"BLD",4961,"REQB","B","PX*1.0*132",8)

"BLD",4961,"REQB","B","PX*1.0*143",12)

"BLD",4961,"REQB","B","PX*1.0*149",13)

"BLD",4961,"REQB","B","PX*1.0*151",14)

"BLD",4961,"REQB","B","PX*1.0*45",3)

"BLD",4961,"REQB","B","PX*1.0*99",6)

"FIA",9000010)
VISIT
"FIA",9000010,0)
^AUPNVSIT(
"FIA",9000010,0,0)
9000010sID
"FIA",9000010,0,1)
y^n^p^^^^n^^n
"FIA",9000010,0,10)

"FIA",9000010,0,11)

"FIA",9000010,0,"RLRO")

"FIA",9000010,0,"VR")
1.0^PX
"FIA",9000010,9000010)
1
"FIA",9000010,9000010,80011)

"FIA",9000010,9000010,80012)

"FIA",9000010,9000010,80013)

"FIA",9000010,9000010,80014)

"FIA",9000010,9000010,80015)

"FIA",9000010,9000010,80016)

"FIA",9000010,9000010,80017)

"FIA",9000010.07)
V POV
"FIA",9000010.07,0)
^AUPNVPOV(
"FIA",9000010.07,0,0)
9000010.07IP
"FIA",9000010.07,0,1)
y^n^p^^^^n^^n
"FIA",9000010.07,0,10)

"FIA",9000010.07,0,11)

"FIA",9000010.07,0,"RLRO")

"FIA",9000010.07,0,"VR")
1.0^PX
"FIA",9000010.07,9000010.07)
1
"FIA",9000010.07,9000010.07,.17)

"FIA",9000010.11)
V IMMUNIZATION
"FIA",9000010.11,0)
^AUPNVIMM(
"FIA",9000010.11,0,0)
9000010.11IP
"FIA",9000010.11,0,1)
y^n^p^^^^n^^n
"FIA",9000010.11,0,10)

"FIA",9000010.11,0,11)

"FIA",9000010.11,0,"RLRO")

"FIA",9000010.11,0,"VR")
1.0^PX
"FIA",9000010.11,9000010.11)
1
"FIA",9000010.11,9000010.11,.08)

"FIA",9000010.11,9000010.11,.09)

"FIA",9000010.11,9000010.11,.1)

"FIA",9000010.11,9000010.11,.11)

"FIA",9000010.11,9000010.11,.12)

"FIA",9000010.11,9000010.11,.13)

"FIA",9000010.11,9000010.11,.14)

"FIA",9000010.11,9000010.11,.15)

"FIA",9000010.12)
V SKIN TEST
"FIA",9000010.12,0)
^AUPNVSK(
"FIA",9000010.12,0,0)
9000010.12IP
"FIA",9000010.12,0,1)
y^n^p^^^^n^^n
"FIA",9000010.12,0,10)

"FIA",9000010.12,0,11)

"FIA",9000010.12,0,"RLRO")

"FIA",9000010.12,0,"VR")
1.0^PX
"FIA",9000010.12,9000010.12)
1
"FIA",9000010.12,9000010.12,.08)

"FIA",9000010.12,9000010.12,.09)

"FIA",9000010.12,9000010.12,.1)

"FIA",9000010.12,9000010.12,.11)

"FIA",9000010.12,9000010.12,.12)

"FIA",9000010.12,9000010.12,.13)

"FIA",9000010.12,9000010.12,.14)

"FIA",9000010.12,9000010.12,.15)

"FIA",9000010.18)
V CPT
"FIA",9000010.18,0)
^AUPNVCPT(
"FIA",9000010.18,0,0)
9000010.18IP
"FIA",9000010.18,0,1)
y^n^p^^^^n^^n
"FIA",9000010.18,0,10)

"FIA",9000010.18,0,11)

"FIA",9000010.18,0,"RLRO")

"FIA",9000010.18,0,"VR")
1.0^PX
"FIA",9000010.18,9000010.18)
1
"FIA",9000010.18,9000010.18,.05)

"FIA",9000010.18,9000010.18,.09)

"FIA",9000010.18,9000010.18,.1)

"FIA",9000010.18,9000010.18,.11)

"FIA",9000010.18,9000010.18,.12)

"FIA",9000010.18,9000010.18,.13)

"FIA",9000010.18,9000010.18,.14)

"FIA",9000010.18,9000010.18,.15)

"FIA",9000010.18,9000010.18,.17)

"KRN",19,6024,-1)
2^2
"KRN",19,6024,0)
PX PCE COORDINATOR MENU^PCE Coordinator Menu^^M^12537^^^^^^^413
"KRN",19,6024,10,0)
^19.01IP^13^13
"KRN",19,6024,10,13,0)
11949^MDR^8
"KRN",19,6024,10,13,"^")
PXRRMDR
"KRN",19,6024,"U")
PCE COORDINATOR MENU
"KRN",19,11949,-1)
0^1
"KRN",19,11949,0)
PXRRMDR^CIDC Missing Data Report^^R^^^^^^^^PCE PATIENT CARE ENCOUNTER
"KRN",19,11949,1,0)
^^2^2^3040415^
"KRN",19,11949,1,1,0)
This produces a report of missing Clinical Indicator Data
"KRN",19,11949,1,2,0)
Collection (CIDC) data
"KRN",19,11949,10.1)
CIDC Missing Data Report
"KRN",19,11949,25)
EN^PXRRMDR
"KRN",19,11949,"U")
CIDC MISSING DATA REPORT
"MBREQ")
1
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",413,-1)
1^1
"PKG",413,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter (VA Parent package)^
"PKG",413,20,0)
^9.402P^^
"PKG",413,22,0)
^9.49I^1^1
"PKG",413,22,1,0)
1.0^2960812^2960913^12537
"PKG",413,22,1,"PAH",1,0)
124^3050805^123456828
"PKG",413,22,1,"PAH",1,1,0)
^^2^2^3050805
"PKG",413,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details
"PKG",413,22,1,"PAH",1,1,2,0)
of the enhancements included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
65
"RTN","PXAICPT")
0^29^B22419944
"RTN","PXAICPT",1,0)
PXAICPT ;ISL/JVS,ISA/KWP,ESW - SET THE PROCEDURE(CPT) NODES ;8/10/04 4:39pm
"RTN","PXAICPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**19,73,108,112,149,124**;Aug 12, 1996
"RTN","PXAICPT",3,0)
 ;
"RTN","PXAICPT",4,0)
 ;
"RTN","PXAICPT",5,0)
 Q
"RTN","PXAICPT",6,0)
CPT ;--CREAT PROVIDERS
"RTN","PXAICPT",7,0)
 ;
"RTN","PXAICPT",8,0)
 ;
"RTN","PXAICPT",9,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAICPT",10,0)
 N AFTER0,AFTER1,AFTER12,AFTER801,AFTER802,AFTER811,AFTER812
"RTN","PXAICPT",11,0)
 N BEFOR0,BEFOR1,BEFOR12,BEFOR801,BEFOR802,BEFOR811,BEFOR812
"RTN","PXAICPT",12,0)
 N PXAA,PXAB,SUB,PIECE,PXAAX,IENB,STOP
"RTN","PXAICPT",13,0)
 ;New Modifier Variables
"RTN","PXAICPT",14,0)
 D SET^PXAIMOD
"RTN","PXAICPT",15,0)
 K PXAERR
"RTN","PXAICPT",16,0)
 S PXAERR(8)=PXAK
"RTN","PXAICPT",17,0)
 S PXAERR(7)="PROCEDURE"
"RTN","PXAICPT",18,0)
 ;
"RTN","PXAICPT",19,0)
 S SUB="" F  S SUB=$O(@PXADATA@("PROCEDURE",PXAK,SUB)) Q:SUB=""  D
"RTN","PXAICPT",20,0)
 .S PXAA(SUB)=$G(@PXADATA@("PROCEDURE",PXAK,SUB))
"RTN","PXAICPT",21,0)
 ;Setup PXAA array for Modifiers
"RTN","PXAICPT",22,0)
 S SUB=""
"RTN","PXAICPT",23,0)
 F  S SUB=$O(@PXADATA@("PROCEDURE",PXAK,"MODIFIERS",SUB)) Q:SUB=""  D
"RTN","PXAICPT",24,0)
 .S PXAA("MODIFIERS",SUB)=""
"RTN","PXAICPT",25,0)
 ;
"RTN","PXAICPT",26,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAICPT",27,0)
 D VAL^PXAICPTV Q:$G(STOP)
"RTN","PXAICPT",28,0)
 ;
"RTN","PXAICPT",29,0)
 ;
"RTN","PXAICPT",30,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAICPT",31,0)
 S $P(AFTER0,"^",1)=$G(PXAA("PROCEDURE"))
"RTN","PXAICPT",32,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,"^",1)="@"
"RTN","PXAICPT",33,0)
 S $P(AFTER0,"^",2)=$G(PATIENT)
"RTN","PXAICPT",34,0)
 S $P(AFTER0,"^",3)=$G(PXAVISIT)
"RTN","PXAICPT",35,0)
 S $P(AFTER0,"^",4)=$G(PXAA("NARRATIVE")) D
"RTN","PXAICPT",36,0)
 .I $G(PXAA("NARRATIVE"))']""!($L($G(PXAA("NARRATIVE")))>245) D
"RTN","PXAICPT",37,0)
 ..S $P(AFTER0,"^",4)=$P($$CPT^ICPTCOD($G(PXAA("PROCEDURE")),$G(IDATE)),"^",3) ;-- TEXT OF NARRATIVE
"RTN","PXAICPT",38,0)
 .I $G(PXAA("NARRATIVE"))]"" S $P(AFTER0,"^",4)=+$$PROVNARR^PXAPI($G(PXAA("NARRATIVE")),9000010.18)
"RTN","PXAICPT",39,0)
 I $P(AFTER0,"^",4)<0 D VAL04^PXAICPTV,ERR^PXAI Q:$D(STOP)
"RTN","PXAICPT",40,0)
 S $P(AFTER0,"^",5)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAICPT",41,0)
 ;PX*1*124 - add dx
"RTN","PXAICPT",42,0)
 S $P(AFTER0,"^",9)=$G(PXAA("DIAGNOSIS 2"))
"RTN","PXAICPT",43,0)
 S $P(AFTER0,"^",10)=$G(PXAA("DIAGNOSIS 3"))
"RTN","PXAICPT",44,0)
 S $P(AFTER0,"^",11)=$G(PXAA("DIAGNOSIS 4"))
"RTN","PXAICPT",45,0)
 S $P(AFTER0,"^",12)=$G(PXAA("DIAGNOSIS 5"))
"RTN","PXAICPT",46,0)
 S $P(AFTER0,"^",13)=$G(PXAA("DIAGNOSIS 6"))
"RTN","PXAICPT",47,0)
 S $P(AFTER0,"^",14)=$G(PXAA("DIAGNOSIS 7"))
"RTN","PXAICPT",48,0)
 S $P(AFTER0,"^",15)=$G(PXAA("DIAGNOSIS 8"))
"RTN","PXAICPT",49,0)
 I $G(PXAA("QTY"))="" S PXAA("QTY")=1
"RTN","PXAICPT",50,0)
 S $P(AFTER0,"^",16)=$G(PXAA("QTY")) I $G(PXAA("QTY"))<1 S PXAA("DELETE")=1
"RTN","PXAICPT",51,0)
 S $P(AFTER0,"^",17)=$G(PXAA("ORD REFERENCE"))
"RTN","PXAICPT",52,0)
 ;Set Modifier nodes in AFTER1
"RTN","PXAICPT",53,0)
 D SETVARA^PXAIMOD
"RTN","PXAICPT",54,0)
 ;
"RTN","PXAICPT",55,0)
 S $P(AFTER12,"^",1)=$G(PXAA("EVENT D/T"))
"RTN","PXAICPT",56,0)
 ;PX*1*124 - add ord prv
"RTN","PXAICPT",57,0)
 S $P(AFTER12,"^",2)=$G(PXAA("ORD PROVIDER"))
"RTN","PXAICPT",58,0)
 S $P(AFTER12,"^",4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAICPT",59,0)
 ;PX*1*108 - do not try to file a provider from a "DELETED" cpt
"RTN","PXAICPT",60,0)
 I $G(PXAA("ENC PROVIDER"))]"",'$G(PXAA("DELETE")) D
"RTN","PXAICPT",61,0)
 .S ^TMP("PXAIADDPRV",$J,$G(PXAA("ENC PROVIDER")))=""
"RTN","PXAICPT",62,0)
 ;PX*1*124 - do not try to file a provider from a "DELETED" cpt
"RTN","PXAICPT",63,0)
 I $G(PXAA("ORD PROVIDER"))]"",'$G(PXAA("DELETE")) D
"RTN","PXAICPT",64,0)
 .S ^TMP("PXAIADDPRV",$J,$G(PXAA("ORD PROVIDER")))=""
"RTN","PXAICPT",65,0)
 ;
"RTN","PXAICPT",66,0)
 S $P(AFTER802,"^",1)=$G(PXAA("CATEGORY"))
"RTN","PXAICPT",67,0)
 I $G(PXAA("CATEGORY"))]"" S $P(AFTER802,"^",1)=+$$PROVNARR^PXAPI($G(PXAA("CATEGORY")),9000010.18)
"RTN","PXAICPT",68,0)
 I $P(AFTER802,"^",1)<0 D VAL45^PXAICPTV,ERR^PXAI Q:$D(STOP)
"RTN","PXAICPT",69,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAICPT",70,0)
 ;
"RTN","PXAICPT",71,0)
 ;
"RTN","PXAICPT",72,0)
 ;
"RTN","PXAICPT",73,0)
 ;--PACKAGE AND SOURCE
"RTN","PXAICPT",74,0)
 ;
"RTN","PXAICPT",75,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAICPT",76,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAICPT",77,0)
 ;
"RTN","PXAICPT",78,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAICPT",79,0)
 S ^TMP("PXK",$J,"CPT",PXAK,0,"AFTER")=AFTER0
"RTN","PXAICPT",80,0)
 ;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"AFTER")=MODIEN
"RTN","PXAICPT",81,0)
 D SETPXKA^PXAIMOD
"RTN","PXAICPT",82,0)
 S ^TMP("PXK",$J,"CPT",PXAK,12,"AFTER")=AFTER12
"RTN","PXAICPT",83,0)
 S ^TMP("PXK",$J,"CPT",PXAK,802,"AFTER")=AFTER802
"RTN","PXAICPT",84,0)
 S ^TMP("PXK",$J,"CPT",PXAK,811,"AFTER")=AFTER811
"RTN","PXAICPT",85,0)
 S ^TMP("PXK",$J,"CPT",PXAK,812,"AFTER")=AFTER812
"RTN","PXAICPT",86,0)
 ;
"RTN","PXAICPT",87,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAICPT",88,0)
 D
"RTN","PXAICPT",89,0)
 .N PXBKY,PXBSAM,PXBSKY,PXBCNT,PXI,PRV,ITEM
"RTN","PXAICPT",90,0)
 .D CPT^PXBGCPT(PXAVISIT)
"RTN","PXAICPT",91,0)
 .S PXAAX("PROCEDURE")=$P($G(^ICPT($G(PXAA("PROCEDURE")),0)),"^",1)
"RTN","PXAICPT",92,0)
 .I $G(PXAA("DELETE"))=1 S PXAAX("PROCEDURE")=$P($G(^ICPT($G(PXAA("PROCEDURE")),0)),"^",1)
"RTN","PXAICPT",93,0)
 .S ITEM=""
"RTN","PXAICPT",94,0)
 .I PXBCNT>0,$G(PXAAX("PROCEDURE"))]"" S ITEM=$O(PXBKY(PXAAX("PROCEDURE"),0))
"RTN","PXAICPT",95,0)
 .I ITEM]"" D
"RTN","PXAICPT",96,0)
 ..;--LOOK UP USING CPT AND PROVIDER
"RTN","PXAICPT",97,0)
 ..S PXI="" F  S PXI=$O(PXBKY(PXAAX("PROCEDURE"),PXI)) Q:PXI=""  D
"RTN","PXAICPT",98,0)
 ...I $D(^IBE(357.69,PXAAX("PROCEDURE"))) D  Q  ;DBIA #: 1906
"RTN","PXAICPT",99,0)
 ....S (^TMP("PXK",$J,"CPT",PXAK,"IEN"),IENB)=$O(PXBSKY(PXI,0))
"RTN","PXAICPT",100,0)
 ...I $G(PXAA("ENC PROVIDER")) D  Q
"RTN","PXAICPT",101,0)
 ....S PRV=$P(^VA(200,$G(PXAA("ENC PROVIDER")),0),"^",1)
"RTN","PXAICPT",102,0)
 ....I $P($G(PXBKY(PXAAX("PROCEDURE"),PXI)),"^",3)=PRV D
"RTN","PXAICPT",103,0)
 .....S (^TMP("PXK",$J,"CPT",PXAK,"IEN"),IENB)=$O(PXBSKY(PXI,0))
"RTN","PXAICPT",104,0)
 I $G(IENB) D
"RTN","PXAICPT",105,0)
 .F PIECE=0,12,802,811,812 S ^TMP("PXK",$J,"CPT",PXAK,PIECE,"BEFORE")=$G(^AUPNVCPT(IENB,PIECE))
"RTN","PXAICPT",106,0)
 .;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"BEFORE")=MODIEN
"RTN","PXAICPT",107,0)
 .D SETVARB^PXAIMOD
"RTN","PXAICPT",108,0)
 E  D
"RTN","PXAICPT",109,0)
 .S (BEFOR0,BEFOR12,BEFOR802,BEFOR811,BEFOR812)=""
"RTN","PXAICPT",110,0)
 .;
"RTN","PXAICPT",111,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAICPT",112,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,0,"BEFORE")=BEFOR0
"RTN","PXAICPT",113,0)
 .;Set ^TMP("PXK",$J,"CPT",PXAK,1,ien,"BEFORE")=MODIEN
"RTN","PXAICPT",114,0)
 .D SETPXKB^PXAIMOD
"RTN","PXAICPT",115,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,12,"BEFORE")=BEFOR12
"RTN","PXAICPT",116,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,802,"BEFORE")=BEFOR802
"RTN","PXAICPT",117,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,811,"BEFORE")=BEFOR811
"RTN","PXAICPT",118,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,812,"BEFORE")=BEFOR812
"RTN","PXAICPT",119,0)
 .S ^TMP("PXK",$J,"CPT",PXAK,"IEN")=""
"RTN","PXAICPT",120,0)
 ;
"RTN","PXAICPT",121,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAICPT",122,0)
 ;
"RTN","PXAICPT",123,0)
 Q
"RTN","PXAIIMM")
0^67^B7183500
"RTN","PXAIIMM",1,0)
PXAIIMM ;ISL/PKR - Set the IMMUNIZATION nodes. ;12/18/97
"RTN","PXAIIMM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**45,124**;Aug 12, 1996
"RTN","PXAIIMM",3,0)
 ;
"RTN","PXAIIMM",4,0)
IMM ;Main entry point.
"RTN","PXAIIMM",5,0)
 ;
"RTN","PXAIIMM",6,0)
 K PXAERR
"RTN","PXAIIMM",7,0)
 S PXAERR(8)=PXAK
"RTN","PXAIIMM",8,0)
 S PXAERR(7)="IMMUNIZATION"
"RTN","PXAIIMM",9,0)
 ;
"RTN","PXAIIMM",10,0)
 N IND,PXAA
"RTN","PXAIIMM",11,0)
 S IND=""
"RTN","PXAIIMM",12,0)
 F  S IND=$O(@PXADATA@("IMMUNIZATION",PXAK,IND)) Q:IND=""  D
"RTN","PXAIIMM",13,0)
 . S PXAA(IND)=@PXADATA@("IMMUNIZATION",PXAK,IND)
"RTN","PXAIIMM",14,0)
 ;
"RTN","PXAIIMM",15,0)
 ;Validate the data.
"RTN","PXAIIMM",16,0)
 N STOP
"RTN","PXAIIMM",17,0)
 D VAL^PXAIIMMV
"RTN","PXAIIMM",18,0)
 I $G(STOP) Q
"RTN","PXAIIMM",19,0)
 ;
"RTN","PXAIIMM",20,0)
SETVARA ;Set the after visit variables.
"RTN","PXAIIMM",21,0)
 N AFTER0,AFTER12,AFTER811,AFTER812
"RTN","PXAIIMM",22,0)
 S $P(AFTER0,U,1)=$G(PXAA("IMMUN"))
"RTN","PXAIIMM",23,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,U,1)="@"
"RTN","PXAIIMM",24,0)
 S $P(AFTER0,U,2)=$G(PATIENT)
"RTN","PXAIIMM",25,0)
 S $P(AFTER0,U,3)=$G(PXAVISIT)
"RTN","PXAIIMM",26,0)
 S $P(AFTER0,U,4)=$G(PXAA("SERIES"))
"RTN","PXAIIMM",27,0)
 S $P(AFTER0,U,6)=$G(PXAA("REACTION"))
"RTN","PXAIIMM",28,0)
 S $P(AFTER0,U,7)=$G(PXAA("CONTRAINDICATED"))
"RTN","PXAIIMM",29,0)
 S $P(AFTER0,U,8)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIIMM",30,0)
 S $P(AFTER0,U,9)=$G(PXAA("DIAGNOSIS 2"))
"RTN","PXAIIMM",31,0)
 S $P(AFTER0,U,10)=$G(PXAA("DIAGNOSIS 3"))
"RTN","PXAIIMM",32,0)
 S $P(AFTER0,U,11)=$G(PXAA("DIAGNOSIS 4"))
"RTN","PXAIIMM",33,0)
 S $P(AFTER0,U,12)=$G(PXAA("DIAGNOSIS 5"))
"RTN","PXAIIMM",34,0)
 S $P(AFTER0,U,13)=$G(PXAA("DIAGNOSIS 6"))
"RTN","PXAIIMM",35,0)
 S $P(AFTER0,U,14)=$G(PXAA("DIAGNOSIS 7"))
"RTN","PXAIIMM",36,0)
 S $P(AFTER0,U,15)=$G(PXAA("DIAGNOSIS 8"))
"RTN","PXAIIMM",37,0)
 S $P(AFTER12,U,1)=$G(PXAA("EVENT D/T"))
"RTN","PXAIIMM",38,0)
 S $P(AFTER12,U,4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAIIMM",39,0)
 S $P(AFTER811,U,1)=$G(PXAA("COMMENT"))
"RTN","PXAIIMM",40,0)
 ;
"RTN","PXAIIMM",41,0)
 ;--PACKAGE AND SOURCE
"RTN","PXAIIMM",42,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIIMM",43,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIIMM",44,0)
 ;
"RTN","PXAIIMM",45,0)
 S ^TMP("PXK",$J,"IMM",PXAK,0,"AFTER")=AFTER0
"RTN","PXAIIMM",46,0)
 S ^TMP("PXK",$J,"IMM",PXAK,12,"AFTER")=AFTER12
"RTN","PXAIIMM",47,0)
 S ^TMP("PXK",$J,"IMM",PXAK,811,"AFTER")=AFTER811
"RTN","PXAIIMM",48,0)
 S ^TMP("PXK",$J,"IMM",PXAK,812,"AFTER")=AFTER812
"RTN","PXAIIMM",49,0)
 ;
"RTN","PXAIIMM",50,0)
SETVARB ;Set the before variables.
"RTN","PXAIIMM",51,0)
 N BEFOR0,BEFOR12,BEFOR811,BEFOR812
"RTN","PXAIIMM",52,0)
 N IENB,PXAAX,PXBCNT,PXBKY,PXBSKY,PXBSAM
"RTN","PXAIIMM",53,0)
 D IMM^PXBGIMM(PXAVISIT)
"RTN","PXAIIMM",54,0)
 ;
"RTN","PXAIIMM",55,0)
 S IENB=""
"RTN","PXAIIMM",56,0)
 I PXBCNT>0 D
"RTN","PXAIIMM",57,0)
 . S PXAAX("IMMUN")=$P($G(^AUTTIMM(PXAA("IMMUN"),0)),U,1)
"RTN","PXAIIMM",58,0)
 . S IENB=$O(PXBKY(PXAAX("IMMUN"),IENB))
"RTN","PXAIIMM",59,0)
 I $G(IENB) D
"RTN","PXAIIMM",60,0)
 . S BEFOR0=$G(^AUPNVIMM(IENB,0))
"RTN","PXAIIMM",61,0)
 . S BEFOR12=$G(^AUPNVIMM(IENB,12))
"RTN","PXAIIMM",62,0)
 . S BEFOR811=$G(^AUPNVIMM(IENB,811))
"RTN","PXAIIMM",63,0)
 . S BEFOR812=$G(^AUPNVIMM(IENB,812))
"RTN","PXAIIMM",64,0)
 E  S (BEFOR0,BEFOR11,BEFOR12,BEFOR811,BEFOR812)=""
"RTN","PXAIIMM",65,0)
 ;
"RTN","PXAIIMM",66,0)
 S ^TMP("PXK",$J,"IMM",PXAK,0,"BEFORE")=BEFOR0
"RTN","PXAIIMM",67,0)
 S ^TMP("PXK",$J,"IMM",PXAK,12,"BEFORE")=BEFOR12
"RTN","PXAIIMM",68,0)
 S ^TMP("PXK",$J,"IMM",PXAK,811,"BEFORE")=BEFOR811
"RTN","PXAIIMM",69,0)
 S ^TMP("PXK",$J,"IMM",PXAK,812,"BEFORE")=BEFOR812
"RTN","PXAIIMM",70,0)
 S ^TMP("PXK",$J,"IMM",PXAK,"IEN")=IENB
"RTN","PXAIIMM",71,0)
 ;
"RTN","PXAIIMM",72,0)
 Q
"RTN","PXAIPL")
0^59^B4591810
"RTN","PXAIPL",1,0)
PXAIPL ;ISL/JVS - PROBLEM LIST ;2/4/05 5:15pm
"RTN","PXAIPL",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**69,124**;Aug 12, 1996
"RTN","PXAIPL",3,0)
 ;
"RTN","PXAIPL",4,0)
 ;
"RTN","PXAIPL",5,0)
 Q
"RTN","PXAIPL",6,0)
PL ;--ENTRY POINT TO EDIT PROBLEMS
"RTN","PXAIPL",7,0)
 ;
"RTN","PXAIPL",8,0)
 ;
"RTN","PXAIPL",9,0)
 Q:'$L($T(^GMPLUTL))
"RTN","PXAIPL",10,0)
 ;
"RTN","PXAIPL",11,0)
 N PXARRAY,RESULT
"RTN","PXAIPL",12,0)
DECIDE ;--DECIDE IF A PROBLEM
"RTN","PXAIPL",13,0)
 I $G(PXAA("PL ADD"))=1 G SET
"RTN","PXAIPL",14,0)
 I $G(PXAA("PL IEN"))>0 G SET
"RTN","PXAIPL",15,0)
 I $G(PXAA("PL ACTIVE"))]"" G SET
"RTN","PXAIPL",16,0)
 I $G(PXAA("PL ONSET DATE"))>0 G SET
"RTN","PXAIPL",17,0)
 I $G(PXAA("PL RESOLVED DATE"))>0 G SET
"RTN","PXAIPL",18,0)
 ;PX*1.0*124
"RTN","PXAIPL",19,0)
 ;I $G(PXAA("PL SC"))]"" G SET
"RTN","PXAIPL",20,0)
 ;I $G(PXAA("PL AO"))]"" G SET
"RTN","PXAIPL",21,0)
 ;I $G(PXAA("PL IR"))]"" G SET
"RTN","PXAIPL",22,0)
 ;I $G(PXAA("PL EC"))]"" G SET
"RTN","PXAIPL",23,0)
 ;I $G(PXAA("PL MST"))]"" G SET
"RTN","PXAIPL",24,0)
 ;I $G(PXAA("PL HNC"))]"" G SET
"RTN","PXAIPL",25,0)
 ;I $G(PXAA("PL CV"))]"" G SET
"RTN","PXAIPL",26,0)
 Q
"RTN","PXAIPL",27,0)
 ;
"RTN","PXAIPL",28,0)
 ;
"RTN","PXAIPL",29,0)
SET ;--REQUIRED
"RTN","PXAIPL",30,0)
 S PXARRAY("PATIENT")=$G(PATIENT)
"RTN","PXAIPL",31,0)
 S PXARRAY("NARRATIVE")=$G(PXAA("NARRATIVE"))
"RTN","PXAIPL",32,0)
 S PXARRAY("PROVIDER")=$G(PXAA("ENC PROVIDER"))
"RTN","PXAIPL",33,0)
 ;--OPTIONAL
"RTN","PXAIPL",34,0)
 S PXARRAY("DIAGNOSIS")=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPL",35,0)
 S PXARRAY("LEXICON")=$G(PXAA("LEXICON TERM"))
"RTN","PXAIPL",36,0)
 S PXARRAY("STATUS")=$G(PXAA("PL ACTIVE"))
"RTN","PXAIPL",37,0)
 S PXARRAY("ONSET")=$G(PXAA("PL ONSET DATE"))
"RTN","PXAIPL",38,0)
 I '$G(PXAA("PL IEN")) S PXARRAY("RECORDED")=$G(PXAA("EVENT D/T"))
"RTN","PXAIPL",39,0)
 S PXARRAY("RESOLVED")=$G(PXAA("PL RESOLVED DATE"))
"RTN","PXAIPL",40,0)
 S PXARRAY("COMMENT")=$G(PXAA("COMMENT"))
"RTN","PXAIPL",41,0)
 I $G(PXARRAY("COMMENT"))="@" S PXARRAY("COMMENT")=""
"RTN","PXAIPL",42,0)
 ;--LOCATION
"RTN","PXAIPL",43,0)
 S PXARRAY("LOCATION")=$P($G(^AUPNVSIT(PXAVISIT,0)),"^",22)
"RTN","PXAIPL",44,0)
 ;--SERVICE CONNECTEDNESS
"RTN","PXAIPL",45,0)
 S PXARRAY("SC")=$P(AFTER800,"^",1)
"RTN","PXAIPL",46,0)
 S PXARRAY("AO")=$P(AFTER800,"^",2)
"RTN","PXAIPL",47,0)
 S PXARRAY("IR")=$P(AFTER800,"^",3)
"RTN","PXAIPL",48,0)
 S PXARRAY("EC")=$P(AFTER800,"^",4)
"RTN","PXAIPL",49,0)
 S PXARRAY("MST")=$P(AFTER800,"^",5)
"RTN","PXAIPL",50,0)
 S PXARRAY("HNC")=$P(AFTER800,"^",6)
"RTN","PXAIPL",51,0)
 S PXARRAY("CV")=$P(AFTER800,"^",7)
"RTN","PXAIPL",52,0)
 ;---MISC
"RTN","PXAIPL",53,0)
 S PXARRAY("PROBLEM")=$G(PXAA("PL IEN"))
"RTN","PXAIPL",54,0)
 ;
"RTN","PXAIPL",55,0)
 ;
"RTN","PXAIPL",56,0)
 ;
"RTN","PXAIPL",57,0)
RUN ;
"RTN","PXAIPL",58,0)
 D UPDATE^GMPLUTL(.PXARRAY,.RESULT)
"RTN","PXAIPL",59,0)
 I RESULT(0)="" S $P(AFTER0,"^",16)=RESULT
"RTN","PXAIPL",60,0)
 ;--**SET ERROR INTO DIALOG
"RTN","PXAIPL",61,0)
 I RESULT(0)]"" D
"RTN","PXAIPL",62,0)
 .S PXAERR("PL1")=$G(RESULT(0))
"RTN","PXAIPL",63,0)
 .S PXAERRF=1
"RTN","PXAIPL",64,0)
 .S PXADI("DIALOG")=8390001.004
"RTN","PXAIPL",65,0)
 Q
"RTN","PXAIPOV")
0^30^B20201014
"RTN","PXAIPOV",1,0)
PXAIPOV ;ISL/JVS,ESW - SET THE DIAGNOSIS/PROBLEM LIST NODES ;6/25/03 2:05pm
"RTN","PXAIPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**28,73,69,108,112,130,124**;Aug 12, 1996
"RTN","PXAIPOV",3,0)
 ;
"RTN","PXAIPOV",4,0)
 Q
"RTN","PXAIPOV",5,0)
POV ;--CREATE DIAGNOSIS
"RTN","PXAIPOV",6,0)
 ;
"RTN","PXAIPOV",7,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAIPOV",8,0)
 N AFTER0,AFTER12,AFTER800,AFTER801,AFTER811,AFTER802,AFTER812
"RTN","PXAIPOV",9,0)
 N BEFOR0,BEFOR12,BEFOR800,BEFOR801,BEFOR811,BEFOR802,BEFOR812
"RTN","PXAIPOV",10,0)
 N PXAA,PXAB,SUB,PIECE,PXAAX,IENB,STOP,VAR,AFTER8A
"RTN","PXAIPOV",11,0)
 N FPRI,J,LNARR,GMPSAVED,NOPLLIST,PXDIGNS,VAR,PRI
"RTN","PXAIPOV",12,0)
 N POVI,PRVDR,PXBCNT,PXBCNTPL,PXBKY,PXBPMT,PXBSAM,PXBSKY,PXKDONE
"RTN","PXAIPOV",13,0)
 ;
"RTN","PXAIPOV",14,0)
 K PXAERR
"RTN","PXAIPOV",15,0)
 S PXAERR(8)=PXAK
"RTN","PXAIPOV",16,0)
 S PXAERR(7)="DX/PL"
"RTN","PXAIPOV",17,0)
 ;
"RTN","PXAIPOV",18,0)
 S SUB="" F  S SUB=$O(@PXADATA@("DX/PL",PXAK,SUB)) Q:SUB=""  D
"RTN","PXAIPOV",19,0)
 .S PXAA(SUB)=@PXADATA@("DX/PL",PXAK,SUB)
"RTN","PXAIPOV",20,0)
 ;
"RTN","PXAIPOV",21,0)
 ;--VALIDATE ENOUGH DATA
"RTN","PXAIPOV",22,0)
 D VAL^PXAIPOVV Q:$G(STOP)
"RTN","PXAIPOV",23,0)
 ;
"RTN","PXAIPOV",24,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAIPOV",25,0)
 S $P(AFTER0,"^",1)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIPOV",26,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,"^",1)="@"
"RTN","PXAIPOV",27,0)
 S $P(AFTER0,"^",2)=$G(PATIENT),PXAA("PATIENT")=$G(PATIENT)
"RTN","PXAIPOV",28,0)
 S $P(AFTER0,"^",3)=$G(PXAVISIT)
"RTN","PXAIPOV",29,0)
 S $P(AFTER0,"^",4)=$G(PXAA("NARRATIVE")) D
"RTN","PXAIPOV",30,0)
 .I $G(PXAA("NARRATIVE"))']""!($L($G(PXAA("NARRATIVE")))>245) D
"RTN","PXAIPOV",31,0)
 ..S PXAA("NARRATIVE")=$$EXTTEXT^PXUTL1($G(PXAA("DIAGNOSIS")),1,80,10,3) ;--TEXT OF NARRATIVE
"RTN","PXAIPOV",32,0)
 .S $P(AFTER0,"^",4)=+$$PROVNARR^PXAPI($G(PXAA("NARRATIVE")),9000010.07)
"RTN","PXAIPOV",33,0)
 ;PX*1*124
"RTN","PXAIPOV",34,0)
 S $P(AFTER0,"^",12)=$S($G(PXAA("PRIMARY"))=1:"P",$G(PXAA("PRIMARY"))="P":"P",1:"S")
"RTN","PXAIPOV",35,0)
 ;--ADDED FOR PATCH 28
"RTN","PXAIPOV",36,0)
 S $P(AFTER0,"^",15)=$G(PXAA("LEXICON TERM"))
"RTN","PXAIPOV",37,0)
 S $P(AFTER0,"^",16)=$G(PXAA("PL IEN"))
"RTN","PXAIPOV",38,0)
 S $P(AFTER0,"^",17)=$G(PXAA("ORD/RES"))
"RTN","PXAIPOV",39,0)
 ;--END OF NEW PATCH 28
"RTN","PXAIPOV",40,0)
 S $P(AFTER12,"^",1)=$G(PXAA("EVENT D/T"))
"RTN","PXAIPOV",41,0)
 S $P(AFTER12,"^",4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAIPOV",42,0)
 ;PX*1*108
"RTN","PXAIPOV",43,0)
 I $G(PXAA("ENC PROVIDER"))]"",'$G(PXAA("DELETE")) D
"RTN","PXAIPOV",44,0)
 .S ^TMP("PXAIADDPRV",$J,$G(PXAA("ENC PROVIDER")))=""
"RTN","PXAIPOV",45,0)
 ;
"RTN","PXAIPOV",46,0)
 I $G(PXAA("CATEGORY"))]"" S $P(AFTER802,"^",1)=+$$PROVNARR^PXAPI($G(PXAA("CATEGORY")),9000010.07)
"RTN","PXAIPOV",47,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAIPOV",48,0)
 ;
"RTN","PXAIPOV",49,0)
 ;
"RTN","PXAIPOV",50,0)
 ;
"RTN","PXAIPOV",51,0)
 ;
"RTN","PXAIPOV",52,0)
 S $P(AFTER800,"^",1)=$G(PXAA("PL SC"))
"RTN","PXAIPOV",53,0)
 S $P(AFTER800,"^",2)=$G(PXAA("PL AO"))
"RTN","PXAIPOV",54,0)
 S $P(AFTER800,"^",3)=$G(PXAA("PL IR"))
"RTN","PXAIPOV",55,0)
 S $P(AFTER800,"^",4)=$G(PXAA("PL EC"))
"RTN","PXAIPOV",56,0)
 S $P(AFTER800,U,5)=$G(PXAA("PL MST"))
"RTN","PXAIPOV",57,0)
 S $P(AFTER800,U,6)=$G(PXAA("PL HNC"))
"RTN","PXAIPOV",58,0)
 S $P(AFTER800,U,7)=$G(PXAA("PL CV"))
"RTN","PXAIPOV",59,0)
 ;
"RTN","PXAIPOV",60,0)
 ;
"RTN","PXAIPOV",61,0)
 ;
"RTN","PXAIPOV",62,0)
 D SCC^PXUTLSCC(PATIENT,$P($G(^AUPNVSIT(PXAVISIT,0)),"^",1),$P($G(^AUPNVSIT(PXAVISIT,0)),"^",22),$G(PXAVISIT),AFTER800,.AFTER800)
"RTN","PXAIPOV",63,0)
 ;
"RTN","PXAIPOV",64,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIPOV",65,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIPOV",66,0)
 ;
"RTN","PXAIPOV",67,0)
 D PL^PXAIPL
"RTN","PXAIPOV",68,0)
 ;
"RTN","PXAIPOV",69,0)
 ;
"RTN","PXAIPOV",70,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAIPOV",71,0)
 S ^TMP("PXK",$J,"POV",PXAK,0,"AFTER")=$G(AFTER0)
"RTN","PXAIPOV",72,0)
 S ^TMP("PXK",$J,"POV",PXAK,12,"AFTER")=$G(AFTER12)
"RTN","PXAIPOV",73,0)
 S ^TMP("PXK",$J,"POV",PXAK,800,"AFTER")=$G(AFTER800)
"RTN","PXAIPOV",74,0)
 S ^TMP("PXK",$J,"POV",PXAK,802,"AFTER")=$G(AFTER802)
"RTN","PXAIPOV",75,0)
 S ^TMP("PXK",$J,"POV",PXAK,811,"AFTER")=$G(AFTER811)
"RTN","PXAIPOV",76,0)
 S ^TMP("PXK",$J,"POV",PXAK,812,"AFTER")=$G(AFTER812)
"RTN","PXAIPOV",77,0)
 ;
"RTN","PXAIPOV",78,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAIPOV",79,0)
 ;
"RTN","PXAIPOV",80,0)
 ;--GET IEN FOR 'PXK NODE'
"RTN","PXAIPOV",81,0)
 D POV^PXBGPOV(PXAVISIT)
"RTN","PXAIPOV",82,0)
 I $D(^TMP("PXBGPOVMATCH",$J,$G(PXAA("DIAGNOSIS")))) D
"RTN","PXAIPOV",83,0)
 .S (^TMP("PXK",$J,"POV",PXAK,"IEN"),IENB)=$O(^TMP("PXBGPOVMATCH",$J,$G(PXAA("DIAGNOSIS")),0))
"RTN","PXAIPOV",84,0)
 K ^TMP("PXBGPOVMATCH",$J)
"RTN","PXAIPOV",85,0)
 ;
"RTN","PXAIPOV",86,0)
BEFOR ;
"RTN","PXAIPOV",87,0)
 I $G(IENB) D
"RTN","PXAIPOV",88,0)
 .F PIECE=0,12,800,802,811 S ^TMP("PXK",$J,"POV",PXAK,PIECE,"BEFORE")=$G(^AUPNVPOV(IENB,PIECE))
"RTN","PXAIPOV",89,0)
 .K ^TMP("PXK",$J,"POV",PXAK,812)
"RTN","PXAIPOV",90,0)
 E  D
"RTN","PXAIPOV",91,0)
 .S (BEFOR0,BEFOR12,BEFOR800,BEFOR802,BEFOR811,BEFOR812)=""
"RTN","PXAIPOV",92,0)
 .;
"RTN","PXAIPOV",93,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAIPOV",94,0)
 .S ^TMP("PXK",$J,"POV",PXAK,0,"BEFORE")=$G(BEFOR0)
"RTN","PXAIPOV",95,0)
 .S ^TMP("PXK",$J,"POV",PXAK,12,"BEFORE")=$G(BEFOR12)
"RTN","PXAIPOV",96,0)
 .S ^TMP("PXK",$J,"POV",PXAK,800,"BEFORE")=$G(BEFOR800)
"RTN","PXAIPOV",97,0)
 .S ^TMP("PXK",$J,"POV",PXAK,802,"BEFORE")=$G(BEFOR802)
"RTN","PXAIPOV",98,0)
 .S ^TMP("PXK",$J,"POV",PXAK,811,"BEFORE")=$G(BEFOR811)
"RTN","PXAIPOV",99,0)
 .S ^TMP("PXK",$J,"POV",PXAK,812,"BEFORE")=$G(BEFOR812)
"RTN","PXAIPOV",100,0)
 .S ^TMP("PXK",$J,"POV",PXAK,"IEN")=""
"RTN","PXAIPOV",101,0)
 ;
"RTN","PXAIPOV",102,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAIPOV",103,0)
 ;
"RTN","PXAIPOV",104,0)
 Q
"RTN","PXAIPOV",105,0)
PRIM ;--SET A PROVIDER AS PRIMARY
"RTN","PXAIPOV",106,0)
 N PXBCNT,PXBKY,PXBSAM,PXBSKY,PRVDR,FPRI ;108
"RTN","PXAIPOV",107,0)
 D PRV^PXBGPRV(PXAVISIT,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI) ;108
"RTN","PXAIPOV",108,0)
 I $D(PRVDR) Q
"RTN","PXAIPOV",109,0)
 I '$D(PXBSKY) Q
"RTN","PXAIPOV",110,0)
 ;
"RTN","PXAIPOV",111,0)
 S $P(AFTER0,"^",1)=$P(^AUPNVPRV($O(PXBSKY(1,0)),0),"^",1)
"RTN","PXAIPOV",112,0)
 S $P(AFTER0,"^",2)=$P(^AUPNVSIT(PXAVISIT,0),"^",5)
"RTN","PXAIPOV",113,0)
 S $P(AFTER0,"^",3)=PXAVISIT
"RTN","PXAIPOV",114,0)
 S $P(AFTER0,"^",4)="P"
"RTN","PXAIPOV",115,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"AFTER")=AFTER0
"RTN","PXAIPOV",116,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"BEFORE")=$G(^AUPNVPRV($O(PXBSKY(1,0)),0))
"RTN","PXAIPOV",117,0)
 S ^TMP("PXK",$J,"PRV",22222,"IEN")=$O(PXBSKY(1,0))
"RTN","PXAIPOV",118,0)
 D EN1^PXKMAIN
"RTN","PXAIPOV",119,0)
 K PXRDR
"RTN","PXAIPOV",120,0)
 K ^TMP("PXBGPOVMATCH",$J)
"RTN","PXAIPOV",121,0)
 Q
"RTN","PXAIPRV")
0^31^B21340281
"RTN","PXAIPRV",1,0)
PXAIPRV ;ISL/JVS,ESW - SET THE PROVIDER NODES ;6/3/05 12:29pm
"RTN","PXAIPRV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**5,108,124**;Aug 12, 1996
"RTN","PXAIPRV",3,0)
 ;
"RTN","PXAIPRV",4,0)
 Q
"RTN","PXAIPRV",5,0)
PRV ;--CREAT PROVIDERS
"RTN","PXAIPRV",6,0)
 ;
"RTN","PXAIPRV",7,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAIPRV",8,0)
 N AFTER0,AFTER12,AFTER801,AFTER811,AFTER812
"RTN","PXAIPRV",9,0)
 N BEFOR0,BEFOR12,BEFOR801,BEFOR811,BEFOR812
"RTN","PXAIPRV",10,0)
 N PXAA,PXAB,SUB,PIECE,PXAAX,IENB,STOP
"RTN","PXAIPRV",11,0)
 ;
"RTN","PXAIPRV",12,0)
 K PXAERR
"RTN","PXAIPRV",13,0)
 S PXAERR(8)=PXAK
"RTN","PXAIPRV",14,0)
 S PXAERR(7)="PROVIDER"
"RTN","PXAIPRV",15,0)
 ;
"RTN","PXAIPRV",16,0)
 S SUB="" F  S SUB=$O(@PXADATA@("PROVIDER",PXAK,SUB)) Q:SUB=""  D
"RTN","PXAIPRV",17,0)
 .S PXAA(SUB)=@PXADATA@("PROVIDER",PXAK,SUB)
"RTN","PXAIPRV",18,0)
 ;
"RTN","PXAIPRV",19,0)
 ;--VALIDATE ENOUGH DATA
"RTN","PXAIPRV",20,0)
 D VAL^PXAIPRVV Q:$G(STOP)
"RTN","PXAIPRV",21,0)
 ;
"RTN","PXAIPRV",22,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAIPRV",23,0)
 S $P(AFTER0,"^",1)=$G(PXAA("NAME"))
"RTN","PXAIPRV",24,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,"^",1)="@"
"RTN","PXAIPRV",25,0)
 S $P(AFTER0,"^",2)=$G(PATIENT)
"RTN","PXAIPRV",26,0)
 S $P(AFTER0,"^",3)=$G(PXAVISIT)
"RTN","PXAIPRV",27,0)
 S $P(AFTER0,"^",4)=$S($G(PXAA("PRIMARY"))=1:"P",1:"S")
"RTN","PXAIPRV",28,0)
 S $P(AFTER0,"^",5)=$S($G(PXAA("ATTENDING"))=1:"A",$G(PXAA("ATTENDING"))=0:"@",1:"")
"RTN","PXAIPRV",29,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAIPRV",30,0)
 ;
"RTN","PXAIPRV",31,0)
 ;
"RTN","PXAIPRV",32,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIPRV",33,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIPRV",34,0)
 ;
"RTN","PXAIPRV",35,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAIPRV",36,0)
 S ^TMP("PXK",$J,"PRV",PXAK,0,"AFTER")=AFTER0
"RTN","PXAIPRV",37,0)
 S ^TMP("PXK",$J,"PRV",PXAK,811,"AFTER")=AFTER811
"RTN","PXAIPRV",38,0)
 S ^TMP("PXK",$J,"PRV",PXAK,812,"AFTER")=AFTER812
"RTN","PXAIPRV",39,0)
 ;
"RTN","PXAIPRV",40,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAIPRV",41,0)
 ;
"RTN","PXAIPRV",42,0)
 ;--CHECK FOR PRIMARY DESIGNATION
"RTN","PXAIPRV",43,0)
 N ITEM,PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI
"RTN","PXAIPRV",44,0)
 D PRV^PXBGPRV(PXAVISIT,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXAIPRV",45,0)
 ;CHECK NAME
"RTN","PXAIPRV",46,0)
 S PXAAX("NAME")=$P($G(^VA(200,$G(PXAA("NAME")),0)),"^",1)
"RTN","PXAIPRV",47,0)
 I '$G(PXAPREDT) D
"RTN","PXAIPRV",48,0)
1 .I $D(PRVDR),$P($G(PRVDR("PRIMARY")),U)'=PXAAX("NAME") S PRI=1
"RTN","PXAIPRV",49,0)
2 .I $G(PRI),$P(AFTER0,"^",4)="P",$P(AFTER0,"^",1)'="@" D VAL04^PXAIPRVV,ERR^PXAI
"RTN","PXAIPRV",50,0)
3 .I $G(PRI) S $P(^TMP("PXK",$J,"PRV",PXAK,0,"AFTER"),"^",4)="S"
"RTN","PXAIPRV",51,0)
4 .I $P(AFTER0,"^",4)="P" S PRI=1
"RTN","PXAIPRV",52,0)
 ;
"RTN","PXAIPRV",53,0)
 ;--GET IEN FOR 'PXK NODE'
"RTN","PXAIPRV",54,0)
 I $G(PXAA("DELETE"))=1 S PXAAX("NAME")=$P($G(^VA(200,PXAA("NAME"),0)),"^",1)
"RTN","PXAIPRV",55,0)
 S ITEM="" I PXBCNT>0,$G(PXAAX("NAME"))]"" S ITEM=$O(PXBKY(PXAAX("NAME"),0))
"RTN","PXAIPRV",56,0)
 I ITEM]"" S (^TMP("PXK",$J,"PRV",PXAK,"IEN"),IENB)=$O(PXBSKY(ITEM,0))
"RTN","PXAIPRV",57,0)
 ;
"RTN","PXAIPRV",58,0)
 I $G(IENB) D
"RTN","PXAIPRV",59,0)
 .F PIECE=0,811,812 S ^TMP("PXK",$J,"PRV",PXAK,PIECE,"BEFORE")=$G(^AUPNVPRV(IENB,PIECE))
"RTN","PXAIPRV",60,0)
 E  D
"RTN","PXAIPRV",61,0)
 .S (BEFOR0,BEFOR811,BEFOR812)=""
"RTN","PXAIPRV",62,0)
 .;
"RTN","PXAIPRV",63,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAIPRV",64,0)
 .S ^TMP("PXK",$J,"PRV",PXAK,0,"BEFORE")=BEFOR0
"RTN","PXAIPRV",65,0)
 .S ^TMP("PXK",$J,"PRV",PXAK,811,"BEFORE")=BEFOR811
"RTN","PXAIPRV",66,0)
 .S ^TMP("PXK",$J,"PRV",PXAK,812,"BEFORE")=BEFOR812
"RTN","PXAIPRV",67,0)
 .S ^TMP("PXK",$J,"PRV",PXAK,"IEN")=""
"RTN","PXAIPRV",68,0)
 ;
"RTN","PXAIPRV",69,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAIPRV",70,0)
 ;
"RTN","PXAIPRV",71,0)
 Q
"RTN","PXAIPRV",72,0)
OTHER   ;---ADD OTHER PROVIDERS TO V PROVIDER FOR OTHER ENTRIES
"RTN","PXAIPRV",73,0)
 ;
"RTN","PXAIPRV",74,0)
 ; generate data, PXBSKY(), about currently filed providers
"RTN","PXAIPRV",75,0)
 ;
"RTN","PXAIPRV",76,0)
 N PXBSKY
"RTN","PXAIPRV",77,0)
 I $G(PXAVISIT) D PRV^PXBGPRV(PXAVISIT,.PXBSKY)
"RTN","PXAIPRV",78,0)
 ;
"RTN","PXAIPRV",79,0)
 N IEN,AFTER0,CNT,PXAK,STOP,FF
"RTN","PXAIPRV",80,0)
 S IEN="",CNT=1000
"RTN","PXAIPRV",81,0)
 ;
"RTN","PXAIPRV",82,0)
 ;---^TMP("PXAIADDPRV",$J,'IEN')=""
"RTN","PXAIPRV",83,0)
 ;
"RTN","PXAIPRV",84,0)
 F  S IEN=$O(^TMP("PXAIADDPRV",$J,IEN)),CNT=CNT+1 Q:IEN=""  D
"RTN","PXAIPRV",85,0)
 .;
"RTN","PXAIPRV",86,0)
 .;verify if an entry for a provider already exists
"RTN","PXAIPRV",87,0)
 .;
"RTN","PXAIPRV",88,0)
 .S STOP=0
"RTN","PXAIPRV",89,0)
 .I $D(^TMP("PXK",$J,"PRV")) S PXAK="" D  Q:STOP
"RTN","PXAIPRV",90,0)
 ..F  S PXAK=$O(^TMP("PXK",$J,"PRV",PXAK)) Q:PXAK=""  D  Q:STOP
"RTN","PXAIPRV",91,0)
 ...I +$G(^TMP("PXK",$J,"PRV",PXAK,0,"AFTER"))=IEN S STOP=1
"RTN","PXAIPRV",92,0)
 .S FF="PXBSKY" F  S FF=$Q(@FF) Q:FF=""  I @FF=IEN S STOP=1 Q
"RTN","PXAIPRV",93,0)
 .Q:STOP
"RTN","PXAIPRV",94,0)
 .;
"RTN","PXAIPRV",95,0)
 .S $P(AFTER0,"^",1)=IEN
"RTN","PXAIPRV",96,0)
 .S $P(AFTER0,"^",2)=$P(^AUPNVSIT(PXAVISIT,0),"^",5)
"RTN","PXAIPRV",97,0)
 .S $P(AFTER0,"^",3)=PXAVISIT
"RTN","PXAIPRV",98,0)
 .S $P(AFTER0,"^",4)="S"
"RTN","PXAIPRV",99,0)
 .S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIPRV",100,0)
 .S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIPRV",101,0)
 .S ^TMP("PXK",$J,"PRV",CNT,0,"AFTER")=$G(AFTER0)
"RTN","PXAIPRV",102,0)
 .S ^TMP("PXK",$J,"PRV",CNT,811,"AFTER")=""
"RTN","PXAIPRV",103,0)
 .S ^TMP("PXK",$J,"PRV",CNT,812,"AFTER")=$G(AFTER812)
"RTN","PXAIPRV",104,0)
 .S ^TMP("PXK",$J,"PRV",CNT,0,"BEFORE")=""
"RTN","PXAIPRV",105,0)
 .S ^TMP("PXK",$J,"PRV",CNT,811,"BEFORE")=""
"RTN","PXAIPRV",106,0)
 .S ^TMP("PXK",$J,"PRV",CNT,812,"BEFORE")=""
"RTN","PXAIPRV",107,0)
 .S ^TMP("PXK",$J,"PRV",CNT,"IEN")=""
"RTN","PXAIPRV",108,0)
 K ^TMP("PXAIADDPRV",$J)
"RTN","PXAIPRV",109,0)
 Q
"RTN","PXAIPRV",110,0)
PRIM ;--SET A PROVIDER AS PRIMARY
"RTN","PXAIPRV",111,0)
 N PXBCNT,PXBKY,PXBSAM,PXBSKY,AFTER0,FPRI,PRVDR,PXASOR
"RTN","PXAIPRV",112,0)
 D PRV^PXBGPRV(PXAVISIT,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXAIPRV",113,0)
 I $D(PRVDR) Q
"RTN","PXAIPRV",114,0)
 I '$D(PXBSKY) Q
"RTN","PXAIPRV",115,0)
 ;----ADDED
"RTN","PXAIPRV",116,0)
 S PXASOR=$G(^TMP("PXK",$J,"SOR"))
"RTN","PXAIPRV",117,0)
 K ^TMP("PXK",$J)
"RTN","PXAIPRV",118,0)
 S ^TMP("PXK",$J,"SOR")=$G(PXASOR)
"RTN","PXAIPRV",119,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=PXAVISIT
"RTN","PXAIPRV",120,0)
 ;-------
"RTN","PXAIPRV",121,0)
 ;
"RTN","PXAIPRV",122,0)
 S $P(AFTER0,"^",1)=$P(^AUPNVPRV($O(PXBSKY(1,0)),0),"^",1)
"RTN","PXAIPRV",123,0)
 S $P(AFTER0,"^",2)=$P(^AUPNVSIT(PXAVISIT,0),"^",5)
"RTN","PXAIPRV",124,0)
 S $P(AFTER0,"^",3)=PXAVISIT
"RTN","PXAIPRV",125,0)
 S $P(AFTER0,"^",4)="P"
"RTN","PXAIPRV",126,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"AFTER")=AFTER0
"RTN","PXAIPRV",127,0)
 S ^TMP("PXK",$J,"PRV",22222,0,"BEFORE")=$G(^AUPNVPRV($O(PXBSKY(1,0)),0))
"RTN","PXAIPRV",128,0)
 S ^TMP("PXK",$J,"PRV",22222,"IEN")=$O(PXBSKY(1,0))
"RTN","PXAIPRV",129,0)
 D EN1^PXKMAIN
"RTN","PXAIPRV",130,0)
 K PXRDR
"RTN","PXAIPRV",131,0)
 Q
"RTN","PXAISK")
0^68^B6962384
"RTN","PXAISK",1,0)
PXAISK ;ISL/PKR - Set the SKIN TEST nodes. ;12/18/97
"RTN","PXAISK",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**45,124**;Aug 12, 1996
"RTN","PXAISK",3,0)
 ;
"RTN","PXAISK",4,0)
SKIN ;Main entry point.
"RTN","PXAISK",5,0)
 ;
"RTN","PXAISK",6,0)
 K PXAERR
"RTN","PXAISK",7,0)
 S PXAERR(8)=PXAK
"RTN","PXAISK",8,0)
 S PXAERR(7)="SKIN TEST"
"RTN","PXAISK",9,0)
 ;
"RTN","PXAISK",10,0)
 N IND,PXAA
"RTN","PXAISK",11,0)
 S IND=""
"RTN","PXAISK",12,0)
 F  S IND=$O(@PXADATA@("SKIN TEST",PXAK,IND)) Q:IND=""  D
"RTN","PXAISK",13,0)
 . S PXAA(IND)=@PXADATA@("SKIN TEST",PXAK,IND)
"RTN","PXAISK",14,0)
 ;
"RTN","PXAISK",15,0)
 ;Validate the data.
"RTN","PXAISK",16,0)
 N STOP
"RTN","PXAISK",17,0)
 D VAL^PXAISKV
"RTN","PXAISK",18,0)
 I $G(STOP) Q
"RTN","PXAISK",19,0)
 ;
"RTN","PXAISK",20,0)
SETVARA ;Set the after visit variables.
"RTN","PXAISK",21,0)
 N AFTER0,AFTER12,AFTER811,AFTER812
"RTN","PXAISK",22,0)
 S $P(AFTER0,U,1)=$G(PXAA("TEST"))
"RTN","PXAISK",23,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,U,1)="@"
"RTN","PXAISK",24,0)
 S $P(AFTER0,U,2)=$G(PATIENT)
"RTN","PXAISK",25,0)
 S $P(AFTER0,U,3)=$G(PXAVISIT)
"RTN","PXAISK",26,0)
 S $P(AFTER0,U,4)=$G(PXAA("RESULT"))
"RTN","PXAISK",27,0)
 S $P(AFTER0,U,5)=$G(PXAA("READING"))
"RTN","PXAISK",28,0)
 S $P(AFTER0,U,6)=$G(PXAA("D/T READ"))
"RTN","PXAISK",29,0)
 S $P(AFTER0,U,8)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAISK",30,0)
 S $P(AFTER0,U,9)=$G(PXAA("DIAGNOSIS 2"))
"RTN","PXAISK",31,0)
 S $P(AFTER0,U,10)=$G(PXAA("DIAGNOSIS 3"))
"RTN","PXAISK",32,0)
 S $P(AFTER0,U,11)=$G(PXAA("DIAGNOSIS 4"))
"RTN","PXAISK",33,0)
 S $P(AFTER0,U,12)=$G(PXAA("DIAGNOSIS 5"))
"RTN","PXAISK",34,0)
 S $P(AFTER0,U,13)=$G(PXAA("DIAGNOSIS 6"))
"RTN","PXAISK",35,0)
 S $P(AFTER0,U,14)=$G(PXAA("DIAGNOSIS 7"))
"RTN","PXAISK",36,0)
 S $P(AFTER0,U,15)=$G(PXAA("DIAGNOSIS 8"))
"RTN","PXAISK",37,0)
 S $P(AFTER12,U,1)=$G(PXAA("EVENT D/T"))
"RTN","PXAISK",38,0)
 S $P(AFTER12,U,4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAISK",39,0)
 S $P(AFTER811,U,1)=$G(PXAA("COMMENT"))
"RTN","PXAISK",40,0)
 ;
"RTN","PXAISK",41,0)
 ;--PACKAGE AND SOURCE
"RTN","PXAISK",42,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAISK",43,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAISK",44,0)
 ;
"RTN","PXAISK",45,0)
 S ^TMP("PXK",$J,"SK",PXAK,0,"AFTER")=AFTER0
"RTN","PXAISK",46,0)
 S ^TMP("PXK",$J,"SK",PXAK,12,"AFTER")=AFTER12
"RTN","PXAISK",47,0)
 S ^TMP("PXK",$J,"SK",PXAK,811,"AFTER")=AFTER811
"RTN","PXAISK",48,0)
 S ^TMP("PXK",$J,"SK",PXAK,812,"AFTER")=AFTER812
"RTN","PXAISK",49,0)
 ;
"RTN","PXAISK",50,0)
SETVARB ;Set the before variables.
"RTN","PXAISK",51,0)
 N BEFOR0,BEFOR12,BEFOR811,BEFOR812
"RTN","PXAISK",52,0)
 N IENB,PXAAX,PXBCNT,PXBKY,PXBSKY,PXBSAM
"RTN","PXAISK",53,0)
 D SK^PXBGSK(PXAVISIT)
"RTN","PXAISK",54,0)
 ;
"RTN","PXAISK",55,0)
 S IENB=""
"RTN","PXAISK",56,0)
 I PXBCNT>0 D
"RTN","PXAISK",57,0)
 . S PXAAX("TEST")=$P($G(^AUTTSK(PXAA("TEST"),0)),U,1)
"RTN","PXAISK",58,0)
 . S IENB=$O(PXBKY(PXAAX("TEST"),IENB))
"RTN","PXAISK",59,0)
 I $G(IENB) D
"RTN","PXAISK",60,0)
 . S BEFOR0=$G(^AUPNVSK(IENB,0))
"RTN","PXAISK",61,0)
 . S BEFOR12=$G(^AUPNVSK(IENB,12))
"RTN","PXAISK",62,0)
 . S BEFOR811=$G(^AUPNVSK(IENB,811))
"RTN","PXAISK",63,0)
 . S BEFOR812=$G(^AUPNVSK(IENB,812))
"RTN","PXAISK",64,0)
 E  S (BEFOR0,BEFOR11,BEFOR12,BEFOR811,BEFOR812)=""
"RTN","PXAISK",65,0)
 ;
"RTN","PXAISK",66,0)
 S ^TMP("PXK",$J,"SK",PXAK,0,"BEFORE")=BEFOR0
"RTN","PXAISK",67,0)
 S ^TMP("PXK",$J,"SK",PXAK,12,"BEFORE")=BEFOR12
"RTN","PXAISK",68,0)
 S ^TMP("PXK",$J,"SK",PXAK,811,"BEFORE")=BEFOR811
"RTN","PXAISK",69,0)
 S ^TMP("PXK",$J,"SK",PXAK,812,"BEFORE")=BEFOR812
"RTN","PXAISK",70,0)
 S ^TMP("PXK",$J,"SK",PXAK,"IEN")=IENB
"RTN","PXAISK",71,0)
 ;
"RTN","PXAISK",72,0)
 Q
"RTN","PXAIVST")
0^32^B15439008
"RTN","PXAIVST",1,0)
PXAIVST ;ISL/JVS,KWP,ESW - GET A VISIT FROM ENCOUNTER NODE ;11/20/02 4:38pm
"RTN","PXAIVST",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**5,9,15,74,111,96,130,124**;Aug 12, 1996
"RTN","PXAIVST",3,0)
 ;
"RTN","PXAIVST",4,0)
 ;
"RTN","PXAIVST",5,0)
 Q
"RTN","PXAIVST",6,0)
VST ;--CREAT A VISIT
"RTN","PXAIVST",7,0)
 ;
"RTN","PXAIVST",8,0)
SET ;--SET AND NEW VARIABLES
"RTN","PXAIVST",9,0)
 N AFTER0,AFTER21,AFTER800,AFTER150,BEFOR0,BEFOR21,BEFOR800,BEFOR150
"RTN","PXAIVST",10,0)
 N AFTER811,BEFOR811,BEFOR812
"RTN","PXAIVST",11,0)
 N PXAA,PXAB,SUB,PIECE,STOP
"RTN","PXAIVST",12,0)
 N AFTER8A,AFTER812
"RTN","PXAIVST",13,0)
 ;
"RTN","PXAIVST",14,0)
 S SUB="" F  S SUB=$O(@PXADATA@("ENCOUNTER",1,SUB)) Q:SUB=""  D
"RTN","PXAIVST",15,0)
 .S PXAA(SUB)=@PXADATA@("ENCOUNTER",1,SUB)
"RTN","PXAIVST",16,0)
 ;
"RTN","PXAIVST",17,0)
 S (AFTER812,BEFOR812)=""
"RTN","PXAIVST",18,0)
 ;
"RTN","PXAIVST",19,0)
 S PXAK=1
"RTN","PXAIVST",20,0)
 S PXAERR(8)=1
"RTN","PXAIVST",21,0)
 S PXAERR(7)="ENCOUNTER"
"RTN","PXAIVST",22,0)
 ;
"RTN","PXAIVST",23,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAIVST",24,0)
 I $D(@PXADATA@("ENCOUNTER")) D VAL^PXAIVSTV Q:$G(STOP)
"RTN","PXAIVST",25,0)
 I $G(PXAVISIT) S (PATIENT,PXAA("PATIENT"))=$P(^AUPNVSIT(PXAVISIT,0),"^",5) S PXAA("ENC D/T")=$P(^AUPNVSIT(PXAVISIT,0),"^",1) S PXAA("HOS LOC")=$P(^AUPNVSIT(PXAVISIT,0),"^",22)
"RTN","PXAIVST",26,0)
 ;
"RTN","PXAIVST",27,0)
SETVARA ;--SET VISIT VARIABLES
"RTN","PXAIVST",28,0)
 S $P(AFTER0,"^",1)=$G(PXAA("ENC D/T"))
"RTN","PXAIVST",29,0)
 ;PX*1*96 - Set TYPE (Piece #3) according to following;
"RTN","PXAIVST",30,0)
 ; 1. If OUTSIDE LOCATION then TYPE is "O"
"RTN","PXAIVST",31,0)
 ; 2. If no OUTSIDE LOCATION but INSTITUTION then TYPE is "V"
"RTN","PXAIVST",32,0)
 ; 3. Else set to value of DUZ("AG")
"RTN","PXAIVST",33,0)
 ;Set TYPE
"RTN","PXAIVST",34,0)
 I $L($G(PXAA("OUTSIDE LOCATION"))) S $P(AFTER0,U,3)="O"
"RTN","PXAIVST",35,0)
 E  I $L($G(PXAA("INSTITUTION"))) S $P(AFTER0,U,3)="V"
"RTN","PXAIVST",36,0)
 E  S $P(AFTER0,U,3)=$G(DUZ("AG"))
"RTN","PXAIVST",37,0)
 S $P(AFTER0,"^",5)=$G(PXAA("PATIENT"))
"RTN","PXAIVST",38,0)
 S $P(AFTER0,"^",6)=$G(PXAA("INSTITUTION"))
"RTN","PXAIVST",39,0)
 S $P(AFTER0,"^",7)=$G(PXAA("SERVICE CATEGORY"))
"RTN","PXAIVST",40,0)
 S $P(AFTER0,"^",8)="" ;$G(PXAA("DSS ID"))
"RTN","PXAIVST",41,0)
 S $P(AFTER0,"^",12)=$G(PXAA("PARENT"))
"RTN","PXAIVST",42,0)
 S $P(AFTER0,"^",18)=$G(PXAA("CHECKOUT D/T"))
"RTN","PXAIVST",43,0)
 S $P(AFTER0,"^",21)=$G(PXAA("ELIGIBILITY"))
"RTN","PXAIVST",44,0)
 S $P(PXELAP,"^",1)=$G(PXAA("ELIGIBILITY"))
"RTN","PXAIVST",45,0)
 S $P(PXELAP,"^",3)=$G(PXAA("APPT"))
"RTN","PXAIVST",46,0)
 S $P(AFTER0,"^",22)=$G(PXAA("HOS LOC"))
"RTN","PXAIVST",47,0)
 S $P(AFTER800,"^",1)=$G(PXAA("SC"))
"RTN","PXAIVST",48,0)
 S $P(AFTER800,"^",2)=$G(PXAA("AO"))
"RTN","PXAIVST",49,0)
 S $P(AFTER800,"^",3)=$G(PXAA("IR"))
"RTN","PXAIVST",50,0)
 S $P(AFTER800,"^",4)=$G(PXAA("EC"))
"RTN","PXAIVST",51,0)
 S $P(AFTER800,"^",5)=$G(PXAA("MST"))
"RTN","PXAIVST",52,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVST",53,0)
 S $P(AFTER800,"^",6)=$G(PXAA("HNC"))
"RTN","PXAIVST",54,0)
 S $P(AFTER800,"^",7)=$G(PXAA("CV"))
"RTN","PXAIVST",55,0)
 ;--VALIDATE SERVICE CONNECTEDNESS
"RTN","PXAIVST",56,0)
 ;
"RTN","PXAIVST",57,0)
 S AFTER8A=AFTER800 D VALSCC^PXAIVSTV
"RTN","PXAIVST",58,0)
 S AFTER800=AFTER8A
"RTN","PXAIVST",59,0)
 ;
"RTN","PXAIVST",60,0)
 S $P(AFTER21,"^",1)=$G(PXAA("OUTSIDE LOCATION")) ;PX/96
"RTN","PXAIVST",61,0)
 S $P(AFTER150,"^",3)=$G(PXAA("ENCOUNTER TYPE"))
"RTN","PXAIVST",62,0)
 S $P(AFTER811,"^",1)=$G(PXAA("COMMENT"))
"RTN","PXAIVST",63,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIVST",64,0)
SETPXKA ;--SET PXK ARRAY AFTER
"RTN","PXAIVST",65,0)
 S ^TMP("PXK",$J,"VST",1,0,"AFTER")=AFTER0
"RTN","PXAIVST",66,0)
 S ^TMP("PXK",$J,"VST",1,21,"AFTER")=AFTER21
"RTN","PXAIVST",67,0)
 S ^TMP("PXK",$J,"VST",1,150,"AFTER")=AFTER150
"RTN","PXAIVST",68,0)
 S ^TMP("PXK",$J,"VST",1,800,"AFTER")=AFTER800
"RTN","PXAIVST",69,0)
 S ^TMP("PXK",$J,"VST",1,811,"AFTER")=AFTER811
"RTN","PXAIVST",70,0)
 S ^TMP("PXK",$J,"VST",1,812,"AFTER")=AFTER812
"RTN","PXAIVST",71,0)
SETVARB ;--SET VARIABLES BEFORE
"RTN","PXAIVST",72,0)
 I $G(PXAVISIT) D
"RTN","PXAIVST",73,0)
 .F PIECE=0,21,150,800,811,812 S ^TMP("PXK",$J,"VST",1,PIECE,"BEFORE")=$G(^AUPNVSIT(PXAVISIT,PIECE))
"RTN","PXAIVST",74,0)
 .I '$D(@PXADATA@("ENCOUNTER")) D
"RTN","PXAIVST",75,0)
 ..F PIECE=0,21,150,800,811,812 S ^TMP("PXK",$J,"VST",1,PIECE,"AFTER")=$G(^AUPNVSIT(PXAVISIT,PIECE))
"RTN","PXAIVST",76,0)
 E  D
"RTN","PXAIVST",77,0)
 .S (BEFOR0,BEFOR21,BEFOR150,BEFOR800,BEFOR811)=""
"RTN","PXAIVST",78,0)
 .;
"RTN","PXAIVST",79,0)
SETPXKB .;--SET PXK ARRAY BEFORE
"RTN","PXAIVST",80,0)
 .S ^TMP("PXK",$J,"VST",1,0,"BEFORE")=BEFOR0
"RTN","PXAIVST",81,0)
 .S ^TMP("PXK",$J,"VST",1,21,"BEFORE")=BEFOR21
"RTN","PXAIVST",82,0)
 .S ^TMP("PXK",$J,"VST",1,150,"BEFORE")=BEFOR150
"RTN","PXAIVST",83,0)
 .S ^TMP("PXK",$J,"VST",1,800,"BEFORE")=BEFOR800
"RTN","PXAIVST",84,0)
 .S ^TMP("PXK",$J,"VST",1,811,"BEFORE")=BEFOR811
"RTN","PXAIVST",85,0)
 .S ^TMP("PXK",$J,"VST",1,812,"BEFORE")=BEFOR812
"RTN","PXAIVST",86,0)
MISC ;--MISCELLANEOUS NODE
"RTN","PXAIVST",87,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=$G(PXAVISIT)
"RTN","PXAIVST",88,0)
 ;
"RTN","PXAIVST",89,0)
CALL ;--CALL
"RTN","PXAIVST",90,0)
 S PXALOOK=$$LOOKVSIT^PXUTLVST($P(AFTER0,U,5),$P(AFTER0,U),$P(AFTER0,U,22),$P(AFTER0,"^",8),$P(AFTER0,U,6)) I $G(PXALOOK)>0 S PXAVISIT=PXALOOK ;PX/96 - included INSTITUTION - $P(AFTER0,U,6)
"RTN","PXAIVST",91,0)
 D EN1^PXKMAIN
"RTN","PXAIVST",92,0)
 I '$G(PXAVISIT) S PXAVISIT=$G(^TMP("PXK",$J,"VST",1,"IEN"))
"RTN","PXAIVST",93,0)
 Q
"RTN","PXAIVSTV")
0^33^B54889755
"RTN","PXAIVSTV",1,0)
PXAIVSTV ;ISL/JVS,ISA/KWP - VALIDATE THE VISIT DATA ;4/23/04 11:54am
"RTN","PXAIVSTV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**9,15,19,74,111,116,130,124**;Aug 12, 1996
"RTN","PXAIVSTV",3,0)
 ;
"RTN","PXAIVSTV",4,0)
 ;
"RTN","PXAIVSTV",5,0)
 Q
"RTN","PXAIVSTV",6,0)
VALSCC ;--VALIDATE SERVICE CONNECTIVENESS
"RTN","PXAIVSTV",7,0)
 N ERR,ERR1
"RTN","PXAIVSTV",8,0)
 D SCC^PXUTLSCC($G(PXAA("PATIENT")),$G(PXAA("ENC D/T")),$G(PXAA("HOS LOC")),$G(PXAVISIT),$G(AFTER800),.AFTER8A,.ERR)
"RTN","PXAIVSTV",9,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVSTV",10,0)
 I $P(ERR,"^",1)=0,$P(ERR,"^",2)=0,$P(ERR,"^",3)=0,$P(ERR,"^",4)=0,$P(ERR,"^",5)=0,$P(ERR,"^",6)=0,$P(ERR,"^",7)=0 Q
"RTN","PXAIVSTV",11,0)
 S PXADI("DIALOG")=8390001.003
"RTN","PXAIVSTV",12,0)
 S PXAERRF=1
"RTN","PXAIVSTV",13,0)
 S PXAERR("1W")=$S($P(AFTER800,"^",1)']"":"NULL",1:$P(AFTER800,"^",1))
"RTN","PXAIVSTV",14,0)
 S PXAERR("2W")=$S($P(AFTER800,"^",2)']"":"NULL",1:$P(AFTER800,"^",2))
"RTN","PXAIVSTV",15,0)
 S PXAERR("3W")=$S($P(AFTER800,"^",3)']"":"NULL",1:$P(AFTER800,"^",3))
"RTN","PXAIVSTV",16,0)
 S PXAERR("4W")=$S($P(AFTER800,"^",4)']"":"NULL",1:$P(AFTER800,"^",4))
"RTN","PXAIVSTV",17,0)
 S PXAERR("5W")=$S($P(AFTER800,"^",5)']"":"NULL",1:$P(AFTER800,"^",5))
"RTN","PXAIVSTV",18,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVSTV",19,0)
 S PXAERR("16W")=$S($P(AFTER800,"^",6)']"":"NULL",1:$P(AFTER800,"^",6))
"RTN","PXAIVSTV",20,0)
 S PXAERR("19W")=$S($P(AFTER800,"^",7)']"":"NULL",1:$P(AFTER800,"^",7))
"RTN","PXAIVSTV",21,0)
 S ERR1=$P(ERR,"^",1),PXAERR("6W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",22,0)
 S ERR1=$P(ERR,"^",2),PXAERR("7W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",23,0)
 S ERR1=$P(ERR,"^",3),PXAERR("8W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",24,0)
 S ERR1=$P(ERR,"^",4),PXAERR("9W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",25,0)
 S ERR1=$P(ERR,"^",5),PXAERR("10W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",26,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVSTV",27,0)
 S ERR1=$P(ERR,"^",6),PXAERR("17W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",28,0)
 S ERR1=$P(ERR,"^",7),PXAERR("20W")=$S(ERR1=1:"Should be a YES or NO!, not NULL",ERR1=0:"No error",ERR1=-1:"Not a valid value",ERR1=-2:"Value must be NULL",ERR1=-3:"Must be NULL because Service Connected is yes",1:"")
"RTN","PXAIVSTV",29,0)
 S PXAERR("11W")=$S($P(AFTER8A,"^",1)']"":"NULL",1:$P(AFTER8A,"^",1))
"RTN","PXAIVSTV",30,0)
 S PXAERR("12W")=$S($P(AFTER8A,"^",2)']"":"NULL",1:$P(AFTER8A,"^",2))
"RTN","PXAIVSTV",31,0)
 S PXAERR("13W")=$S($P(AFTER8A,"^",3)']"":"NULL",1:$P(AFTER8A,"^",3))
"RTN","PXAIVSTV",32,0)
 S PXAERR("14W")=$S($P(AFTER8A,"^",4)']"":"NULL",1:$P(AFTER8A,"^",4))
"RTN","PXAIVSTV",33,0)
 S PXAERR("15W")=$S($P(AFTER8A,"^",5)']"":"NULL",1:$P(AFTER8A,"^",5))
"RTN","PXAIVSTV",34,0)
 ;PX*1*111 - Add HNC
"RTN","PXAIVSTV",35,0)
 S PXAERR("18W")=$S($P(AFTER8A,"^",6)']"":"NULL",1:$P(AFTER8A,"^",6))
"RTN","PXAIVSTV",36,0)
 S PXAERR("21W")=$S($P(AFTER8A,"^",7)']"":"NULL",1:$P(AFTER8A,"^",7))
"RTN","PXAIVSTV",37,0)
 D ERR^PXAI K PXAERRF
"RTN","PXAIVSTV",38,0)
 Q
"RTN","PXAIVSTV",39,0)
 ;
"RTN","PXAIVSTV",40,0)
VAL ;--VALIDATE ENOUGH DATA
"RTN","PXAIVSTV",41,0)
 ;
"RTN","PXAIVSTV",42,0)
 ;---Is the visit sent TO US valid?
"RTN","PXAIVSTV",43,0)
 I $G(PXAVISIT) D  Q:$D(STOP)
"RTN","PXAIVSTV",44,0)
 .I '$D(^AUPNVSIT(PXAVISIT,0)) D  Q:$G(STOP)
"RTN","PXAIVSTV",45,0)
 ..S STOP=1
"RTN","PXAIVSTV",46,0)
 ..S PXAERRF=1
"RTN","PXAIVSTV",47,0)
 ..S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",48,0)
 ..S PXAERR(11)=$G(PXAVISIT)
"RTN","PXAIVSTV",49,0)
 ..S PXAERR(12)="The value that was sent to us is not a valid visit in the VISIT file # 9000010. The Patients name will be derived from the visit file and could cause the data to be given to the wrong patient if not correct."
"RTN","PXAIVSTV",50,0)
 ..S PXAERR(13)="If the correct VISIT isn't known, set the 'ENCOUNTER' array and we will look it up or create a correct one. Setting both at the same time will only add confusion as to what data is correct."
"RTN","PXAIVSTV",51,0)
 Q:$G(PXAVISIT)
"RTN","PXAIVSTV",52,0)
 ;
"RTN","PXAIVSTV",53,0)
 ;----Missing a date and time of visit
"RTN","PXAIVSTV",54,0)
 I $G(PXAA("ENC D/T"))']"" D  Q:$G(STOP)
"RTN","PXAIVSTV",55,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","PXAIVSTV",56,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERR
"RTN","PXAIVSTV",57,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",58,0)
 .S PXAERR(9)="ENC D/T"
"RTN","PXAIVSTV",59,0)
 .S PXAERR(11)=$G(PXAA("ENC D/T"))
"RTN","PXAIVSTV",60,0)
 .S PXAERR(12)="You are missing the date and time of the visit in FileManager internal format."
"RTN","PXAIVSTV",61,0)
 ;
"RTN","PXAIVSTV",62,0)
 ;----Missing Time and not Historical Visit
"RTN","PXAIVSTV",63,0)
 I $L($G(PXAA("ENC D/T")),".")=1,$G(PXAA("SERVICE CATEGORY"))'="E" D
"RTN","PXAIVSTV",64,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","PXAIVSTV",65,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERR
"RTN","PXAIVSTV",66,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",67,0)
 .S PXAERR(9)="ENC D/T"
"RTN","PXAIVSTV",68,0)
 .S PXAERR(11)=$G(PXAA("ENC D/T"))
"RTN","PXAIVSTV",69,0)
 .S PXAERR(12)="You are missing the TIME of the visit in FileManager internal format. Unless this is an HISTORICAL encounter, you must have the time."
"RTN","PXAIVSTV",70,0)
 ;
"RTN","PXAIVSTV",71,0)
 ;
"RTN","PXAIVSTV",72,0)
 ;
"RTN","PXAIVSTV",73,0)
 ;----MISSING a pointer to PATIENT/IHS FILE # 9000001
"RTN","PXAIVSTV",74,0)
 I $G(PXAA("PATIENT"))']"" D  Q:$G(STOP)
"RTN","PXAIVSTV",75,0)
 .S STOP=1
"RTN","PXAIVSTV",76,0)
 .S PXAERRF=1
"RTN","PXAIVSTV",77,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",78,0)
 .S PXAERR(9)="PATIENT"
"RTN","PXAIVSTV",79,0)
 .S PXAERR(11)=$G(PXAA("PATIENT"))
"RTN","PXAIVSTV",80,0)
 .S PXAERR(12)="Missing a pointer to the PATIENT/IHS file #9000001"
"RTN","PXAIVSTV",81,0)
 ;
"RTN","PXAIVSTV",82,0)
 ;
"RTN","PXAIVSTV",83,0)
 ;----Not a pointer to the PATIENT/IHS file #9000001
"RTN","PXAIVSTV",84,0)
 I '$D(^AUPNPAT($G(PXAA("PATIENT")),0)) D  Q:$G(STOP)
"RTN","PXAIVSTV",85,0)
 .S STOP=1
"RTN","PXAIVSTV",86,0)
 .S PXAERRF=1
"RTN","PXAIVSTV",87,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",88,0)
 .S PXAERR(9)="PATIENT"
"RTN","PXAIVSTV",89,0)
 .S PXAERR(11)=$G(PXAA("PATIENT"))
"RTN","PXAIVSTV",90,0)
 .S PXAERR(12)="This value is not a pointer to file PATIENT/IHS file # 9000001"
"RTN","PXAIVSTV",91,0)
 ;
"RTN","PXAIVSTV",92,0)
 ;---Missing required information
"RTN","PXAIVSTV",93,0)
 I $G(PXAA("OUTSIDE LOCATION"))']"",$G(PXAA("HOS LOC"))']"",$G(PXAA("SERVICE CATEGORY"))'="E" D  Q:$G(STOP)
"RTN","PXAIVSTV",94,0)
 .S STOP=1
"RTN","PXAIVSTV",95,0)
 .S PXAERRF=1
"RTN","PXAIVSTV",96,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",97,0)
 .S PXAERR(9)="HOS LOC or OUTSIDE LOC"
"RTN","PXAIVSTV",98,0)
 .S PXAERR(11)="BOTH ENTRIES ARE NULL AND SERVICE CATEGORY IS NOT ""E"""
"RTN","PXAIVSTV",99,0)
 .S PXAERR(12)="The HOSPITAL LOCATION (pointer to the HOSPITAL LOCATION file #44 ) needs to be sent in order to create a visit."
"RTN","PXAIVSTV",100,0)
 ;
"RTN","PXAIVSTV",101,0)
 ;---not a pointer to hospital location file
"RTN","PXAIVSTV",102,0)
 I $D(PXAA("HOS LOC")) D  Q:$G(STOP)
"RTN","PXAIVSTV",103,0)
 .I '$D(^SC($G(PXAA("HOS LOC")),0)) D  Q:$G(STOP)
"RTN","PXAIVSTV",104,0)
 ..S STOP=1
"RTN","PXAIVSTV",105,0)
 ..S PXAERRF=1
"RTN","PXAIVSTV",106,0)
 ..S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",107,0)
 ..S PXAERR(9)="HOS LOC"
"RTN","PXAIVSTV",108,0)
 ..S PXAERR(11)=$G(PXAA("HOS LOC"))
"RTN","PXAIVSTV",109,0)
 ..S PXAERR(12)="This HOSPITAL LOCATION is not a pointer to the HOSPITAL LOCATION file #44"
"RTN","PXAIVSTV",110,0)
 ;---hospital location is the dispositioning location
"RTN","PXAIVSTV",111,0)
 ;Allow a dispositioning location to be used
"RTN","PXAIVSTV",112,0)
 ;I $D(PXAA("HOS LOC")) D  Q:$G(STOP)   ;PX*1.0*116
"RTN","PXAIVSTV",113,0)
 ;.I $D(^PX(815,1,"DHL","B",$G(PXAA("HOS LOC")))) D  Q:$G(STOP)
"RTN","PXAIVSTV",114,0)
 ;..S STOP=1
"RTN","PXAIVSTV",115,0)
 ;..S PXAERRF=1
"RTN","PXAIVSTV",116,0)
 ;..S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",117,0)
 ;..S PXAERR(9)="HOS LOC"
"RTN","PXAIVSTV",118,0)
 ;..S PXAERR(11)=$G(PXAA("HOS LOC"))
"RTN","PXAIVSTV",119,0)
 ;..S PXAERR(12)="This HOSPITAL LOCATION is a dispositioning location and connot be used. Refer to entries in file#815 PCE PARAMETERS"
"RTN","PXAIVSTV",120,0)
 ;--Not a service category
"RTN","PXAIVSTV",121,0)
 I '$D(PXAA("SERVICE CATEGORY")) D  Q:$G(STOP)
"RTN","PXAIVSTV",122,0)
 .S STOP=1
"RTN","PXAIVSTV",123,0)
 .S PXAERRF=1
"RTN","PXAIVSTV",124,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",125,0)
 .S PXAERR(9)="SERVICE CATEGORY"
"RTN","PXAIVSTV",126,0)
 .S PXAERR(11)=$G(PXAA("SERVICE CATEGORY"))
"RTN","PXAIVSTV",127,0)
 .S PXAERR(12)="SERVICE CATEGORY is a required field"
"RTN","PXAIVSTV",128,0)
 Q
"RTN","PXAIVSTV",129,0)
 ;
"RTN","PXAIVSTV",130,0)
VPTR ;---Is the visit sent TO US valid?
"RTN","PXAIVSTV",131,0)
 I $G(PXAVISIT) D  Q:$D(STOP)
"RTN","PXAIVSTV",132,0)
 .I '$D(^AUPNVSIT(PXAVISIT,0)) D  Q:$G(STOP)
"RTN","PXAIVSTV",133,0)
 ..S STOP=1
"RTN","PXAIVSTV",134,0)
 ..S PXAK=1
"RTN","PXAIVSTV",135,0)
 ..S PXAERRF=1
"RTN","PXAIVSTV",136,0)
 ..S PXADI("DIALOG")=8390001.001
"RTN","PXAIVSTV",137,0)
 ..S PXAERR(7)="ENCOUNTER"
"RTN","PXAIVSTV",138,0)
 ..S PXAERR(9)="GENERAL NATURE"
"RTN","PXAIVSTV",139,0)
 ..S PXAERR(11)=$G(PXAVISIT)
"RTN","PXAIVSTV",140,0)
 ..S PXAERR(12)="The value that was sent to us is not a valid visit in the VISIT file # 9000010. The Patients name will be derived from the visit file and could cause the data to be given to the wrong patient if not correct."
"RTN","PXAIVSTV",141,0)
 ..S PXAERR(13)="If the correct VISIT isn't known, set the 'ENCOUNTER' array and we will look it up or create a correct one. Setting both at the same time will only add confusion as to what data is correct."
"RTN","PXAIVSTV",142,0)
 Q:$G(PXAVISIT)
"RTN","PXAIVSTV",143,0)
 Q
"RTN","PXAPI")
0^72^B36580622
"RTN","PXAPI",1,0)
PXAPI ;ISL/dee - PCE's APIs ;6/27/05 2:02pm
"RTN","PXAPI",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**14,15,27,28,124**;Aug 12, 1996
"RTN","PXAPI",3,0)
 Q
"RTN","PXAPI",4,0)
 ;
"RTN","PXAPI",5,0)
PROVNARR(PXPNAR,PXFILE,PXCLEX) ;Convert external Provider Narrative to internal.
"RTN","PXAPI",6,0)
 ;Input:
"RTN","PXAPI",7,0)
 ;  PXPNAR    Is the text of the provider narrative.
"RTN","PXAPI",8,0)
 ;  PXFILE  Is the file that the returned pointer will be stored in.
"RTN","PXAPI",9,0)
 ;              If a new entry is created then this tells the context
"RTN","PXAPI",10,0)
 ;              that it was created under by the file using it.
"RTN","PXAPI",11,0)
 ;  PXCLEX  Is and optional pointer to the Lexicon for this narrative.
"RTN","PXAPI",12,0)
 ;
"RTN","PXAPI",13,0)
 ;Returns:
"RTN","PXAPI",14,0)
 ;  Pointer to the provider narrative file ^ narrative
"RTN","PXAPI",15,0)
 ;  or pointer to the provider narrative file ^ narrative ^1
"RTN","PXAPI",16,0)
 ;    where 1 indicates that the entry has just been added
"RTN","PXAPI",17,0)
 ;  or -1 if was unsuccessful.
"RTN","PXAPI",18,0)
 ;
"RTN","PXAPI",19,0)
 N DIC,Y,DLAYGO,DD,DO,DA
"RTN","PXAPI",20,0)
 S DIC="^AUTNPOV(",DIC(0)="L",DLAYGO=9999999.27
"RTN","PXAPI",21,0)
 S (DA,Y)=0
"RTN","PXAPI",22,0)
 S X=$E(PXPNAR,1,245)
"RTN","PXAPI",23,0)
 Q:X="" -1
"RTN","PXAPI",24,0)
 L +^AUTNPOV(0):60
"RTN","PXAPI",25,0)
 E  W !,"The Provider Narrative is LOCKED try again." Q -1
"RTN","PXAPI",26,0)
 F  S DA=$O(^AUTNPOV("B",$E(X,1,30),DA)) Q:DA'>0  I $P(^AUTNPOV(DA,0),"^")=X S Y=DA_"^"_X Q
"RTN","PXAPI",27,0)
 I '(+Y) D
"RTN","PXAPI",28,0)
 . K DA,Y
"RTN","PXAPI",29,0)
 . D FILE^DICN
"RTN","PXAPI",30,0)
 . I +Y>0,($G(PXCLEX)!$G(PXFILE)) S ^AUTNPOV(+Y,757)=$G(PXCLEX)_"^"_$G(PXFILE)
"RTN","PXAPI",31,0)
 L -^AUTNPOV(0)
"RTN","PXAPI",32,0)
 Q $S(+Y>0:Y,1:-1)
"RTN","PXAPI",33,0)
 ;
"RTN","PXAPI",34,0)
STOPCODE(PXASTOP,PXAPAT,PXADATE) ;This is the function call to return the quantity
"RTN","PXAPI",35,0)
 ;                  of a particular Stop Code for a patient on one day.
"RTN","PXAPI",36,0)
 ;Input
"RTN","PXAPI",37,0)
 ;  PXASTOP  (required) pointer to #40.7
"RTN","PXAPI",38,0)
 ;  PXAPAT   (required) pointer to #2
"RTN","PXAPI",39,0)
 ;  PXADATE  (required) the date in Fileman format
"RTN","PXAPI",40,0)
 ;                     (time is ignored if passed)
"RTN","PXAPI",41,0)
 ;Returns
"RTN","PXAPI",42,0)
 ;  the count of how many of that stop code are stored for that one day
"RTN","PXAPI",43,0)
 ;
"RTN","PXAPI",44,0)
 N PXAVST,PXREVDAT,PXENDDAT,PXACOUNT
"RTN","PXAPI",45,0)
 S PXASTOP=$G(PXASTOP)
"RTN","PXAPI",46,0)
 S PXAPAT=+$G(PXAPAT)
"RTN","PXAPI",47,0)
 S PXADATE=+$G(PXADATE)
"RTN","PXAPI",48,0)
 S (PXACOUNT,PXAVST)=0
"RTN","PXAPI",49,0)
 S PXREVDAT=9999999-$P(PXADATE,".")-.00000001
"RTN","PXAPI",50,0)
 S PXENDDAT=PXREVDAT+.9
"RTN","PXAPI",51,0)
 F  S PXREVDAT=$O(^AUPNVSIT("AA",PXAPAT,PXREVDAT)) Q:'PXREVDAT!(PXREVDAT>PXENDDAT)  D
"RTN","PXAPI",52,0)
 . F  S PXAVST=$O(^AUPNVSIT("AA",PXAPAT,PXREVDAT,PXAVST)) Q:'PXAVST  D
"RTN","PXAPI",53,0)
 .. I PXASTOP=$P(^AUPNVSIT(PXAVST,0),"^",8),"E"'=$P(^AUPNVSIT(PXAVST,0),"^",7) S PXACOUNT=PXACOUNT+1
"RTN","PXAPI",54,0)
 Q PXACOUNT
"RTN","PXAPI",55,0)
 ;
"RTN","PXAPI",56,0)
CPT(PXACPT,PXAPAT,PXADATE,PXAHLOC) ;This is the function call to return the quantity
"RTN","PXAPI",57,0)
 ;                  of a particular CPT for a patient on one day and for
"RTN","PXAPI",58,0)
 ;                  one hospital location if passed.
"RTN","PXAPI",59,0)
 ;Input
"RTN","PXAPI",60,0)
 ;  PXACPT  (required) pointer to #81
"RTN","PXAPI",61,0)
 ;  PXAPAT   (required) pointer to #2
"RTN","PXAPI",62,0)
 ;  PXADATE  (required) the date in Fileman format
"RTN","PXAPI",63,0)
 ;                     (time is ignored if passed)
"RTN","PXAPI",64,0)
 ;  PXAHLOC  (optional) pointer to #44
"RTN","PXAPI",65,0)
 ;Returns
"RTN","PXAPI",66,0)
 ;  the count of how many (and quinity) of that cpt code are stored for that one day
"RTN","PXAPI",67,0)
 ;
"RTN","PXAPI",68,0)
 ;
"RTN","PXAPI",69,0)
 N PXAVST,PXAVCPT,PXREVDAT,PXENDDAT,PXACOUNT
"RTN","PXAPI",70,0)
 S PXACPT=$G(PXACPT)
"RTN","PXAPI",71,0)
 S PXAPAT=+$G(PXAPAT)
"RTN","PXAPI",72,0)
 S PXADATE=+$G(PXADATE)
"RTN","PXAPI",73,0)
 S PXAHLOC=+$G(PXAHLOC)
"RTN","PXAPI",74,0)
 S (PXACOUNT,PXAVST)=0
"RTN","PXAPI",75,0)
 S PXREVDAT=9999999-$P(PXADATE,".")-.00000001
"RTN","PXAPI",76,0)
 S PXENDDAT=PXREVDAT+.9
"RTN","PXAPI",77,0)
 F  S PXREVDAT=$O(^AUPNVSIT("AA",PXAPAT,PXREVDAT)) Q:'PXREVDAT!(PXREVDAT>PXENDDAT)  D
"RTN","PXAPI",78,0)
 . F  S PXAVST=$O(^AUPNVSIT("AA",PXAPAT,PXREVDAT,PXAVST)) Q:'PXAVST  D
"RTN","PXAPI",79,0)
 .. Q:"E"=$P(^AUPNVSIT(PXAVST,0),"^",7)
"RTN","PXAPI",80,0)
 .. Q:"1"=$P(^AUPNVSIT(PXAVST,150),"^",2)
"RTN","PXAPI",81,0)
 .. I PXAHLOC>0,PXAHLOC'=$P(^AUPNVSIT(PXAVST,0),"^",22) Q
"RTN","PXAPI",82,0)
 .. S PXAVCPT=0
"RTN","PXAPI",83,0)
 .. F  S PXAVCPT=$O(^AUPNVCPT("AD",PXAVST,PXAVCPT)) Q:'PXAVCPT  D
"RTN","PXAPI",84,0)
 ... I PXACPT=$P(^AUPNVCPT(PXAVCPT,0),"^",1) S PXACOUNT=PXACOUNT+$P(^(0),"^",16)
"RTN","PXAPI",85,0)
 Q PXACOUNT
"RTN","PXAPI",86,0)
 ;
"RTN","PXAPI",87,0)
INTV(WHAT,PACKAGE,SOURCE,VISIT,HL,DFN,APPT,LIMITDT,ALLHLOC) ;This api will prompt the user for Visit and related V-file data used to document an encounter.
"RTN","PXAPI",88,0)
 ;See INTV^PXBAPI for parameters and return values.
"RTN","PXAPI",89,0)
 ;
"RTN","PXAPI",90,0)
 I '($D(VISIT)#2) S VISIT=""
"RTN","PXAPI",91,0)
 I '($D(DFN)#2) S DFN=""
"RTN","PXAPI",92,0)
 I '($D(HL)#2) S HL=""
"RTN","PXAPI",93,0)
 ;
"RTN","PXAPI",94,0)
 Q $$INTV^PXBAPI(WHAT,PACKAGE,SOURCE,.VISIT,.HL,.DFN,$G(APPT),$G(LIMITDT),$G(ALLHLOC))
"RTN","PXAPI",95,0)
 ;
"RTN","PXAPI",96,0)
DELVFILE(WHICH,VISIT,PACKAGE,SOURCE,ASK,ECHO,USER) ;Deletes the requesed data related to the visit.
"RTN","PXAPI",97,0)
 ;See DELVFILE^PXAPIDEL for parameters and return values.
"RTN","PXAPI",98,0)
 ;
"RTN","PXAPI",99,0)
 Q $$DELVFILE^PXAPIDEL(WHICH,VISIT,$G(PACKAGE),$G(SOURCE),$G(ASK),$G(ECHO),$G(USER))
"RTN","PXAPI",100,0)
 ;
"RTN","PXAPI",101,0)
DATA2PCE(DATA,PACKAGE,SOURCE,VISIT,USER,DISPLAY,ERROR,SCREEN,ARRAY,ACCOUNT) ;API to pass data for add/edit/delete to PCE
"RTN","PXAPI",102,0)
 ;See DATA2PCE^PXAI for parameters and return values.
"RTN","PXAPI",103,0)
 ;
"RTN","PXAPI",104,0)
 I '($D(DATA)#2) Q -3
"RTN","PXAPI",105,0)
 I '($D(PACKAGE)#2) Q -3
"RTN","PXAPI",106,0)
 I '($D(SOURCE)#2) Q -3
"RTN","PXAPI",107,0)
 I '($D(VISIT)#2) S VISIT=""
"RTN","PXAPI",108,0)
 Q $$DATA2PCE^PXAI(DATA,PACKAGE,SOURCE,.VISIT,$G(USER),$G(DISPLAY),$G(ERROR),$G(SCREEN),.ARRAY)
"RTN","PXAPI",109,0)
 ;
"RTN","PXAPI",110,0)
SOURCE(SOURCE) ;Get IEN of data source in the PCE Data Source file
"RTN","PXAPI",111,0)
 Q $$SOURCE^PXAPIUTL($G(SOURCE))
"RTN","PXAPI",112,0)
 ;
"RTN","PXAPI",113,0)
VISITLST(DFN,BEGINDT,ENDDT,HLOC,SCREEN,APPOINT,PROMPT,COSTATUS) ;--GATHER VISITS
"RTN","PXAPI",114,0)
 ;See VISITLST^PXBGVST for parameters and return values.
"RTN","PXAPI",115,0)
 ;
"RTN","PXAPI",116,0)
 I '($D(DFN)#2) Q "-2^NO PATIENT SELECTED"
"RTN","PXAPI",117,0)
 Q $$VISITLST^PXBGVST(DFN,$G(BEGINDT),$G(ENDDT),$G(HLOC),$G(SCREEN),$G(APPOINT),$G(PROMPT),$G(COSTATUS))
"RTN","PXAPI",118,0)
 ;
"RTN","PXAPI",119,0)
ENCEDIT(WHAT,PACKAGE,SOURCE,DFN,BEGINDT,ENDDT,HLOC,SCREEN,APPOINT,PROMPT,COSTATUS) ;--Ask for encounter the edit it of delete it
"RTN","PXAPI",120,0)
 ;See ENCEDIT^PXAPIEED for parameters and return values.
"RTN","PXAPI",121,0)
 ;
"RTN","PXAPI",122,0)
 Q $$ENCEDIT^PXAPIEED($G(WHAT),$G(PACKAGE),$G(SOURCE),$G(DFN),$G(BEGINDT),$G(ENDDT),$G(HLOC),$G(SCREEN),$G(APPOINT),$G(PROMPT),$G(COSTATUS))
"RTN","PXAPI",123,0)
 ;
"RTN","PXAPI",124,0)
LOPENCED(WHAT,PACKAGE,SOURCE,DFN,BEGINDT,ENDDT,HLOC,SCREEN,APPOINT,PROMPT,COSTATUS) ;--Ask for encounter the edit it of delete it
"RTN","PXAPI",125,0)
 ;See LOPENCED^PXAPIEED for parameters and return values.
"RTN","PXAPI",126,0)
 ;
"RTN","PXAPI",127,0)
 Q $$LOPENCED^PXAPIEED($G(WHAT),$G(PACKAGE),$G(SOURCE),$G(DFN),$G(BEGINDT),$G(ENDDT),$G(HLOC),$G(SCREEN),$G(APPOINT),$G(PROMPT),$G(COSTATUS))
"RTN","PXAPI",128,0)
 ;
"RTN","PXAPI",129,0)
GETENC(DFN,ENCDT,HLOC) ;--Get all of the encounter data
"RTN","PXAPI",130,0)
 ;See GETENC^PXKENC for parameters and return values.
"RTN","PXAPI",131,0)
 ;
"RTN","PXAPI",132,0)
 Q $$GETENC^PXKENC($G(DFN),$G(ENCDT),$G(HLOC))
"RTN","PXAPI",133,0)
 ;
"RTN","PXAPI",134,0)
ENCEVENT(VISIT,DONTKILL) ;--Get all of the encounter data
"RTN","PXAPI",135,0)
 ;See ENCEVENT^PXKENC for parameters and return values.
"RTN","PXAPI",136,0)
 ;
"RTN","PXAPI",137,0)
 D ENCEVENT^PXKENC($G(VISIT),$G(DONTKILL))
"RTN","PXAPI",138,0)
 Q
"RTN","PXAPI",139,0)
 ;
"RTN","PXAPI",140,0)
VST2APPT(VISIT) ;Is this visit related to an appointment
"RTN","PXAPI",141,0)
 ;See VST2APPT^PXUTL1 for parameters and return values.
"RTN","PXAPI",142,0)
 ;
"RTN","PXAPI",143,0)
 Q $$VST2APPT^PXUTL1($G(VISIT))
"RTN","PXAPI",144,0)
 ;
"RTN","PXAPI",145,0)
APPT2VST(DFN,ENCDT,HLOC) ;Get the visit for an Appointment
"RTN","PXAPI",146,0)
 ;See APPT2VST^PXUTL1 for parameters and return values.
"RTN","PXAPI",147,0)
 ;
"RTN","PXAPI",148,0)
 Q $$APPT2VST^PXUTL1($G(DFN),$G(ENCDT),$G(HLOC))
"RTN","PXAPI",149,0)
 ;
"RTN","PXAPI",150,0)
SWITCHD() ;This returns the date that PCE starts collecting the data
"RTN","PXAPI",151,0)
 ; instead Scheduling (switch over date).
"RTN","PXAPI",152,0)
 Q $P($G(^PX(815,1,0)),"^",2)
"RTN","PXAPI",153,0)
 ;
"RTN","PXAPI",154,0)
SWITCHCK(DATE) ;Returns 1 if after the switch over date 0 otherwise.
"RTN","PXAPI",155,0)
 N SWITCH
"RTN","PXAPI",156,0)
 S SWITCH=$P($G(^PX(815,1,0)),"^",2)
"RTN","PXAPI",157,0)
 Q:SWITCH<2960000 0
"RTN","PXAPI",158,0)
 Q SWITCH'>DATE
"RTN","PXAPI",159,0)
 ;
"RTN","PXAPI",160,0)
DISPVSIT ;Called by Scheduling to create a visit for a disposition
"RTN","PXAPI",161,0)
 ;Add to fix scheduling calling visit tracking wrong without the
"RTN","PXAPI",162,0)
 ;  dispositioning clinic.  Hospital Location is required by Visit
"RTN","PXAPI",163,0)
 ;  Tracking to work correctly.
"RTN","PXAPI",164,0)
 I $G(VSIT("LOC"))>0,'$D(^PX(815,1,"DHL","B",VSIT("LOC"))) S VSIT("LOC")=""
"RTN","PXAPI",165,0)
 I $G(VSIT("LOC"))'>0,'$D(ZTQUEUED) D
"RTN","PXAPI",166,0)
 . I $P(^PX(815,1,"DHL",0),"^",4)=1 S VSIT("LOC")=$O(^PX(815,1,"DHL","B",0))
"RTN","PXAPI",167,0)
 . E  D
"RTN","PXAPI",168,0)
 .. ;ask for Hospital location from those that can disposition
"RTN","PXAPI",169,0)
 .. N DIC,DA,X,Y
"RTN","PXAPI",170,0)
DISPASK .. S DA(1)=1
"RTN","PXAPI",171,0)
 .. S DIC="^PX(815,1,""DHL"","
"RTN","PXAPI",172,0)
 .. S DIC("P")=$P(^DD(815,401,0),"^",2)
"RTN","PXAPI",173,0)
 .. S DIC(0)="AEOQ"
"RTN","PXAPI",174,0)
 .. D ^DIC
"RTN","PXAPI",175,0)
 .. I Y>0 S VSIT("LOC")=$P(Y,"^",2)
"RTN","PXAPI",176,0)
 .. ;E  I '$D(DTOUT),'$D(DUOUT) W !!,$C(7),"Disposition Hospital Location is required." G DISPASK
"RTN","PXAPI",177,0)
 .. E  W !!,$C(7),"Disposition Hospital Location is required." G DISPASK
"RTN","PXAPI",178,0)
 I $G(VSIT("LOC"))'>0 S VSIT("IEN")=-1
"RTN","PXAPI",179,0)
 E  D ^VSIT
"RTN","PXAPI",180,0)
 Q
"RTN","PXAPI",181,0)
 ;
"RTN","PXAPI",182,0)
ACTIVPRV(PROVIDER,VISITDT) ;See if this is a good provider on the date of
"RTN","PXAPI",183,0)
 ;VISITDT and returns 1 if it is 0 if it is not.
"RTN","PXAPI",184,0)
 ;Can be used like S DIC("S")="I $$ACTIVPRV^PXAPIUTL(PRV,DATE)"
"RTN","PXAPI",185,0)
 Q:+$$PRVCLASS^PXAPIUTL($G(PROVIDER),$G(VISITDT))>0 1
"RTN","PXAPI",186,0)
 Q 0
"RTN","PXAPI",187,0)
 ;
"RTN","PXAPI",188,0)
PRVCLASS(PROVIDER,VISITDT) ;See if this is a good provider
"RTN","PXAPI",189,0)
 ;See PRVCLASS^PXAPIUTL for parameters and return values.
"RTN","PXAPI",190,0)
 Q $$PRVCLASS^PXAPIUTL($G(PROVIDER),$G(VISITDT))
"RTN","PXAPI",191,0)
 ;
"RTN","PXBAPI1")
0^42^B50226263
"RTN","PXBAPI1",1,0)
PXBAPI1 ;ISL/JVS,dee - PCE's API - interview questions ;5/6/05 2:59pm
"RTN","PXBAPI1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,9,23,56,104,111,113,122,116,130,147,151,124**;Aug 12, 1996
"RTN","PXBAPI1",3,0)
 ;;
"RTN","PXBAPI1",4,0)
 Q
"RTN","PXBAPI1",5,0)
 ;
"RTN","PXBAPI1",6,0)
PROCESS(PXBEXIT) ;
"RTN","PXBAPI1",7,0)
 N PXBREQ
"RTN","PXBAPI1",8,0)
 I WHAT="INTV" D
"RTN","PXBAPI1",9,0)
 . ;-- Interview is all of the questions
"RTN","PXBAPI1",10,0)
 . D ADQ(.PXBEXIT) I PXBEXIT<1 Q 
"RTN","PXBAPI1",11,0)
1 . D PRV(.PXBEXIT) I PXBEXIT<1 Q
"RTN","PXBAPI1",12,0)
3 . D POV(.PXBEXIT) I PXBEXIT<1 Q
"RTN","PXBAPI1",13,0)
2 . D CPT(.PXBEXIT) I PXBEXIT<1 Q
"RTN","PXBAPI1",14,0)
 . I $P($G(^AUPNVSIT($G(PXBVST),150)),"^",3)="O" S PXBEXIT=0 Q
"RTN","PXBAPI1",15,0)
 . I '$$DISPOSIT^PXUTL1($G(PXBPAT),$P($G(^AUPNVSIT(PXBVST,0)),"^",1),$G(PXBVST)) D STP(.PXBEXIT) I PXBEXIT<1 Q
"RTN","PXBAPI1",16,0)
 E  I WHAT="ADDEDIT" D
"RTN","PXBAPI1",17,0)
 . D ADDEDIT
"RTN","PXBAPI1",18,0)
 E  I WHAT="ADQ" D
"RTN","PXBAPI1",19,0)
 . ;-- Adminstrative questions
"RTN","PXBAPI1",20,0)
 . D ADQ(.PXBEXIT)
"RTN","PXBAPI1",21,0)
 E  I WHAT="CODT" D
"RTN","PXBAPI1",22,0)
 . ;-- Check out Date/Time
"RTN","PXBAPI1",23,0)
 . D CODT(.PXBEXIT)
"RTN","PXBAPI1",24,0)
 . Q:PXBEXIT<1
"RTN","PXBAPI1",25,0)
 . D VISIT(.PXBEXIT)
"RTN","PXBAPI1",26,0)
 . I PXBVST'>0 S PXBEXIT=-2 Q
"RTN","PXBAPI1",27,0)
 E  I WHAT="SCC" D
"RTN","PXBAPI1",28,0)
 . ;-- Service connected conditions
"RTN","PXBAPI1",29,0)
 . S PXCECAT="VST" D SCC(.PXBEXIT) K PXCECAT
"RTN","PXBAPI1",30,0)
 . Q:PXBEXIT<1
"RTN","PXBAPI1",31,0)
 . D VISIT(.PXBEXIT)
"RTN","PXBAPI1",32,0)
 . I PXBVST'>0 S PXBEXIT=-2 Q
"RTN","PXBAPI1",33,0)
 E  I WHAT="PRV" D
"RTN","PXBAPI1",34,0)
 . ;-- Providers
"RTN","PXBAPI1",35,0)
 . D PRV(.PXBEXIT)
"RTN","PXBAPI1",36,0)
 E  I WHAT="CPT" D
"RTN","PXBAPI1",37,0)
 . ;-- Providers and CPT codes
"RTN","PXBAPI1",38,0)
 . D CPT(.PXBEXIT)
"RTN","PXBAPI1",39,0)
 E  I WHAT="POV" D
"RTN","PXBAPI1",40,0)
 . ;-- Diagnoses
"RTN","PXBAPI1",41,0)
 . D POV(.PXBEXIT)
"RTN","PXBAPI1",42,0)
 E  I WHAT="STP" D
"RTN","PXBAPI1",43,0)
 . ;-- Stop Codes
"RTN","PXBAPI1",44,0)
 . D STP(.PXBEXIT)
"RTN","PXBAPI1",45,0)
 E  S PXBEXIT=-3 W !,"Procedure ""INTV^PXAPI"" was called incorrectly, contact IRM."
"RTN","PXBAPI1",46,0)
 Q
"RTN","PXBAPI1",47,0)
 ;
"RTN","PXBAPI1",48,0)
ADDEDIT ;
"RTN","PXBAPI1",49,0)
 N ANS
"RTN","PXBAPI1",50,0)
ADDEDIT1 ;
"RTN","PXBAPI1",51,0)
 D ADQ(.PXBEXIT)
"RTN","PXBAPI1",52,0)
 G:PXBEXIT<1 ADDEDIT2
"RTN","PXBAPI1",53,0)
 D PRV(.PXBEXIT)
"RTN","PXBAPI1",54,0)
 G:PXBEXIT<1 ADDEDIT2
"RTN","PXBAPI1",55,0)
 D POV(.PXBEXIT)
"RTN","PXBAPI1",56,0)
 G:PXBEXIT<1 ADDEDIT2
"RTN","PXBAPI1",57,0)
 ;
"RTN","PXBAPI1",58,0)
 ;Call to CPT is not determined by a credit stop code any more
"RTN","PXBAPI1",59,0)
 ;
"RTN","PXBAPI1",60,0)
 D CPT(.PXBEXIT)
"RTN","PXBAPI1",61,0)
 G:PXBEXIT<1 ADDEDIT2
"RTN","PXBAPI1",62,0)
ADDEDIT2 ;
"RTN","PXBAPI1",63,0)
 I PXBVST>0,'$D(^AUPNVCPT("AD",PXBVST)),'$D(^AUPNVSIT("AD",PXBVST)) D  I ANS'=1 S PXBEXIT=1 G ADDEDIT1
"RTN","PXBAPI1",64,0)
 . N DIR,X,Y
"RTN","PXBAPI1",65,0)
 . W !!
"RTN","PXBAPI1",66,0)
 . S DIR(0)="Y"
"RTN","PXBAPI1",67,0)
 . S DIR("A",1)="Must have a STOP CODE or a PROCEDURE to complete this action."
"RTN","PXBAPI1",68,0)
 . S DIR("A")="Do you want to delete this encounter"
"RTN","PXBAPI1",69,0)
 . S DIR("B")="NO"
"RTN","PXBAPI1",70,0)
 . D ^DIR
"RTN","PXBAPI1",71,0)
 . S ANS=Y
"RTN","PXBAPI1",72,0)
 . Q:ANS'=1
"RTN","PXBAPI1",73,0)
 . I $$DELVFILE^PXAPIDEL("ALL",PXBVST,"","","","","")=1 S PXBEXIT=-1
"RTN","PXBAPI1",74,0)
 I PXBVST>0,'$D(^AUPNVSIT(PXBVST,0)) S PXBVST=""
"RTN","PXBAPI1",75,0)
 Q
"RTN","PXBAPI1",76,0)
 ;
"RTN","PXBAPI1",77,0)
ADQ(PXBEXIT) ;Ask the Administration questions
"RTN","PXBAPI1",78,0)
 I PXBVST'>0 D
"RTN","PXBAPI1",79,0)
 . ;This is only done for new visits
"RTN","PXBAPI1",80,0)
 . I PXBPAT'>0 S PXBPAT=$$ASKPAT I PXBPAT'>0 S PXBEXIT=-1 Q
"RTN","PXBAPI1",81,0)
 . S DFN=PXBPAT
"RTN","PXBAPI1",82,0)
 . I PXBHLOC'>0 S PXBHLOC=$$ASKHL I PXBHLOC'>0 S PXBEXIT=-1 Q
"RTN","PXBAPI1",83,0)
 . S PXBVSTDT=$S(PXBAPPT>0:PXBAPPT,1:$$ASKDT) I PXBVSTDT'>0 S PXBEXIT=-1 Q
"RTN","PXBAPI1",84,0)
 . I PXBAPPT'>0&PXBHLOC'=+$G(^DPT(PXBPAT,"S",PXBVSTDT,0)) D
"RTN","PXBAPI1",85,0)
 .. ;This is only done if there is no appointment.
"RTN","PXBAPI1",86,0)
 .. S PXELAP=$$ELAP^SDPCE(PXBPAT,PXBHLOC)
"RTN","PXBAPI1",87,0)
 I PXBEXIT'<1,PXBHLOC'>0 S PXBHLOC=$$ASKHL I PXBHLOC'>0 S PXBEXIT=-1 Q
"RTN","PXBAPI1",88,0)
 I PXBEXIT'<1 D CODT(.PXBEXIT)
"RTN","PXBAPI1",89,0)
 I PXBEXIT'<1,WHAT'="INTV" S PXCECAT="VST" D SCC(.PXBEXIT) K PXCECAT
"RTN","PXBAPI1",90,0)
 I PXBEXIT'<1 D
"RTN","PXBAPI1",91,0)
 . D VISIT(.PXBEXIT)
"RTN","PXBAPI1",92,0)
 . I PXBVST'>0 S PXBEXIT=-2 Q
"RTN","PXBAPI1",93,0)
 Q
"RTN","PXBAPI1",94,0)
 ;
"RTN","PXBAPI1",95,0)
ASKPAT() ;Ask user for a patient
"RTN","PXBAPI1",96,0)
 ;DIC on file 9000001
"RTN","PXBAPI1",97,0)
 N DIR,DIC,Y,X,DA
"RTN","PXBAPI1",98,0)
 S DIR(0)="P^9000001:AEMQ"
"RTN","PXBAPI1",99,0)
 S DIR("A")="Patient Name"
"RTN","PXBAPI1",100,0)
 D ^DIR
"RTN","PXBAPI1",101,0)
 Q $S(+Y>0:+Y,1:-1)
"RTN","PXBAPI1",102,0)
 ;
"RTN","PXBAPI1",103,0)
ASKHL() ;Ask user for a Hospital Location
"RTN","PXBAPI1",104,0)
ASKHL2 ;DIC on file 44
"RTN","PXBAPI1",105,0)
 N DIR,DIC,Y,X,DA,PXRES
"RTN","PXBAPI1",106,0)
 S DIR(0)="PA^44:AEMQ"
"RTN","PXBAPI1",107,0)
 S DIR("A")="Clinic: "
"RTN","PXBAPI1",108,0)
 ; not occasion of service and not dispositioning
"RTN","PXBAPI1",109,0)
 ;I PXALHLOC S DIR("S")="I '+$G(^(""OOS""))&'$O(^PX(815,1,""DHL"",""B"",Y,0))"
"RTN","PXBAPI1",110,0)
 ; not occasion of service only   ;PX*1.0*116
"RTN","PXBAPI1",111,0)
 I PXALHLOC S DIR("S")="I '+$G(^(""OOS""))"   ;PX*1.0*116
"RTN","PXBAPI1",112,0)
 ; only clinic that are not occasion of service and not dispositioning
"RTN","PXBAPI1",113,0)
 ;E  S DIR("S")="I $P(^(0),U,3)=""C""&'+$G(^(""OOS""))&'$O(^PX(815,1,""DHL"",""B"",Y,0))"
"RTN","PXBAPI1",114,0)
 E  S DIR("S")="I $P(^(0),U,3)=""C""&'+$G(^(""OOS""))"   ;PX*1.0*116
"RTN","PXBAPI1",115,0)
 D ^DIR
"RTN","PXBAPI1",116,0)
 ;enable to select a disposition clinic   ;PX*1.0*116
"RTN","PXBAPI1",117,0)
 ;I $D(^PX(815,1,"DHL","B",+Y)) D HELPDISP^PXCEVSIT W !,$C(7) G ASKHL2
"RTN","PXBAPI1",118,0)
 ; disallow selection of clinics with non conforming stop codes
"RTN","PXBAPI1",119,0)
 I +Y>0 S PXRES=$$CLNCK^SDUTL2(+Y,1) I 'PXRES D  G ASKHL2
"RTN","PXBAPI1",120,0)
 .W !,?5,"Clinic MUST be corrected before continuing."
"RTN","PXBAPI1",121,0)
 Q $S(+Y>0:+Y,1:-1)
"RTN","PXBAPI1",122,0)
 ;
"RTN","PXBAPI1",123,0)
ASKDT() ;Ask user for the encounter Date/Time
"RTN","PXBAPI1",124,0)
 N DIR,Y,X,DA
"RTN","PXBAPI1",125,0)
 S DIR(0)="D^"_$S(PXLIMDT>2960000:PXLIMDT,1:"")_":"_(DT+.24)_":AEPRSX"
"RTN","PXBAPI1",126,0)
 S DIR("A")="Encounter Date and Time"
"RTN","PXBAPI1",127,0)
 S DIR("?")="Enter the Date and Time of this encounter"
"RTN","PXBAPI1",128,0)
 D ^DIR
"RTN","PXBAPI1",129,0)
 Q $S(+Y>0:+Y,1:-1)
"RTN","PXBAPI1",130,0)
 ;
"RTN","PXBAPI1",131,0)
CODT(PXBEXIT) ;Ask the user the Check out Date/Time
"RTN","PXBAPI1",132,0)
 N PXCHKOUT
"RTN","PXBAPI1",133,0)
 D CHIKOUT^PXBAPI2("",PXBPAT,PXBHLOC,PXBVSTDT)
"RTN","PXBAPI1",134,0)
 S PXBCODT=PXCHKOUT
"RTN","PXBAPI1",135,0)
 S:PXCHKOUT=-1 PXBCODT=""
"RTN","PXBAPI1",136,0)
 ;; PX*1*113 - Change for EAS*1*3 Appointment processing removed
"RTN","PXBAPI1",137,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T D  Q:PXBEXIT<1
"RTN","PXBAPI1",138,0)
 ;. S:$G(EASACT)'="W" EASACT="C"
"RTN","PXBAPI1",139,0)
 ;. I $$MT^EASMTCHK(PXBPAT,"",EASACT,PXBVSTDT) D  S PXBEXIT=-1
"RTN","PXBAPI1",140,0)
 ;. . D PAUSE^VALM1
"RTN","PXBAPI1",141,0)
 I WHAT'["ADDEDIT",PXCHKOUT=-1 S PXBEXIT=-1
"RTN","PXBAPI1",142,0)
 I $G(PXBVST),$$DISPOSIT^PXUTL1(DFN,$P($G(^AUPNVSIT(PXBVST,0)),"^",1),PXBVST) S PXBEXIT=1
"RTN","PXBAPI1",143,0)
 Q
"RTN","PXBAPI1",144,0)
 ;
"RTN","PXBAPI1",145,0)
SCC(PXBEXIT) ;Ask the user the Service connected conditions
"RTN","PXBAPI1",146,0)
 N PXBDATA,PXBCLASS,PXBOUTEN,PXDOD
"RTN","PXBAPI1",147,0)
 S (PXBOUTEN,PXDOD)=""
"RTN","PXBAPI1",148,0)
 ;I $$APPOINT^PXUTL1(PXBPAT,PXBVSTDT,PXBHLOC) D
"RTN","PXBAPI1",149,0)
 ;. S PXBOUTEN=$P($G(^DPT(+PXBPAT,"S",+PXBVSTDT,0)),"^",20)
"RTN","PXBAPI1",150,0)
 ;E  I $$DISPOSIT^PXUTL1(PXBPAT,PXBVSTDT,PXBVST) D
"RTN","PXBAPI1",151,0)
 ;. S PXBOUTEN=+$P($G(^DPT(+PXBPAT,"DIS",9999999-PXBVSTDT,0)),"^",18)
"RTN","PXBAPI1",152,0)
 ;I 'PXBOUTEN,$G(PXBVST)>0 S PXBOUTEN=$O(^SCE("AVSIT",PXBVST,0))
"RTN","PXBAPI1",153,0)
 ;D CLASS^PXBAPI21(PXBOUTEN,PXBPAT,PXBVSTDT,PXBHLOC)
"RTN","PXBAPI1",154,0)
 D CLASS^PXBAPI21(PXBOUTEN,PXBPAT,PXBVSTDT,PXBHLOC,PXBVST)
"RTN","PXBAPI1",155,0)
 ;PX*1*111 - Add HNC
"RTN","PXBAPI1",156,0)
 F PXBCLASS=1:1:7 I $G(PXBDATA("ERR",PXBCLASS))=4 S PXBEXIT=-1 Q  ; changed 6/17/98 for MST enhancement
"RTN","PXBAPI1",157,0)
 Q:PXBEXIT<1
"RTN","PXBAPI1",158,0)
 I $G(PXDOD) S PXBEXIT=-1 Q
"RTN","PXBAPI1",159,0)
 S PXB800(1)=$P($G(PXBDATA(3)),"^",2)
"RTN","PXBAPI1",160,0)
 S PXB800(2)=$P($G(PXBDATA(1)),"^",2)
"RTN","PXBAPI1",161,0)
 S PXB800(3)=$P($G(PXBDATA(2)),"^",2)
"RTN","PXBAPI1",162,0)
 S PXB800(4)=$P($G(PXBDATA(4)),"^",2)
"RTN","PXBAPI1",163,0)
 S PXB800(5)=$P($G(PXBDATA(5)),"^",2) ;added 6/17/98 for MST enhancement
"RTN","PXBAPI1",164,0)
 ;PX*1*111 - Add HNC
"RTN","PXBAPI1",165,0)
 S PXB800(6)=$P($G(PXBDATA(6)),"^",2)
"RTN","PXBAPI1",166,0)
 S PXB800(7)=$P($G(PXBDATA(7)),"^",2)
"RTN","PXBAPI1",167,0)
 Q
"RTN","PXBAPI1",168,0)
 ;
"RTN","PXBAPI1",169,0)
VISIT(PXBEXIT) ;Creat or edit the Visit
"RTN","PXBAPI1",170,0)
 ;Set up ^TMP("PXK",$J and call PXK
"RTN","PXBAPI1",171,0)
 I PXBVST>0 L +^AUPNVSIT(PXBVST):10 E  W !!,$C(7),"Cannot edit at this time, try again later." D WAIT^PXCEHELP S PXBEXIT=-2 Q
"RTN","PXBAPI1",172,0)
 K ^TMP("PXK",$J)
"RTN","PXBAPI1",173,0)
 N PXBNODE,PXBAFTER,PXKERROR
"RTN","PXBAPI1",174,0)
 F PXBNODE=0,21,150,800,811,812 D
"RTN","PXBAPI1",175,0)
 . S PXBAFTER(PXBNODE)=$S(PXBVST>0:$G(^AUPNVSIT(PXBVST,PXBNODE)),1:"")
"RTN","PXBAPI1",176,0)
 . S ^TMP("PXK",$J,"VST",1,PXBNODE,"BEFORE")=PXBAFTER(PXBNODE)
"RTN","PXBAPI1",177,0)
 I PXBVST'>0 D
"RTN","PXBAPI1",178,0)
 . S $P(PXBAFTER(0),"^",1)=PXBVSTDT
"RTN","PXBAPI1",179,0)
 . S $P(PXBAFTER(0),"^",5)=PXBPAT
"RTN","PXBAPI1",180,0)
 . S $P(PXBAFTER(0),"^",8)=$P(^SC(PXBHLOC,0),"^",7)
"RTN","PXBAPI1",181,0)
 . S:PXBAPPT>0 $P(PXBAFTER(0),"^",7)="A" ;PX*1*124
"RTN","PXBAPI1",182,0)
 . S $P(PXBAFTER(150),"^",3)="P"
"RTN","PXBAPI1",183,0)
 . S $P(PXBAFTER(812),"^",2)=PXBPKG
"RTN","PXBAPI1",184,0)
 . S $P(PXBAFTER(812),"^",3)=PXBSOURC
"RTN","PXBAPI1",185,0)
 S $P(PXBAFTER(0),"^",18)=$G(PXBCODT)
"RTN","PXBAPI1",186,0)
 S:$P(PXBAFTER(0),"^",22)="" $P(PXBAFTER(0),"^",22)=PXBHLOC
"RTN","PXBAPI1",187,0)
 S $P(PXBAFTER(800),"^",1)=$G(PXB800(1))
"RTN","PXBAPI1",188,0)
 S $P(PXBAFTER(800),"^",2)=$G(PXB800(2))
"RTN","PXBAPI1",189,0)
 S $P(PXBAFTER(800),"^",3)=$G(PXB800(3))
"RTN","PXBAPI1",190,0)
 S $P(PXBAFTER(800),"^",4)=$G(PXB800(4))
"RTN","PXBAPI1",191,0)
 S $P(PXBAFTER(800),"^",5)=$G(PXB800(5)) ;added 6/17/98 for MST emhancement
"RTN","PXBAPI1",192,0)
 ;PX*1*111 - Add HNC
"RTN","PXBAPI1",193,0)
 S $P(PXBAFTER(800),"^",6)=$G(PXB800(6))
"RTN","PXBAPI1",194,0)
 S $P(PXBAFTER(800),"^",7)=$G(PXB800(7))
"RTN","PXBAPI1",195,0)
 I $D(PXELAP)#2 D
"RTN","PXBAPI1",196,0)
 . S $P(PXBAFTER(0),"^",21)=+PXELAP
"RTN","PXBAPI1",197,0)
 F PXBNODE=0,21,150,800,811,812 D
"RTN","PXBAPI1",198,0)
 . S ^TMP("PXK",$J,"VST",1,PXBNODE,"AFTER")=PXBAFTER(PXBNODE)
"RTN","PXBAPI1",199,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=$S(PXBVST>0:PXBVST,1:"")
"RTN","PXBAPI1",200,0)
 S ^TMP("PXK",$J,"SOR")=PXBSOURC
"RTN","PXBAPI1",201,0)
 D EN1^PXKMAIN
"RTN","PXBAPI1",202,0)
 I PXBVST>0 L -^AUPNVSIT(PXBVST):5
"RTN","PXBAPI1",203,0)
 S PXBVST=$G(^TMP("PXK",$J,"VST",1,"IEN"))
"RTN","PXBAPI1",204,0)
 Q
"RTN","PXBAPI1",205,0)
 ;
"RTN","PXBAPI1",206,0)
CPT(PXBEXIT) ;Ask the user Providers and CTPs
"RTN","PXBAPI1",207,0)
 D CPT^PXBMCPT(PXBVST) K PRVDR
"RTN","PXBAPI1",208,0)
 Q
"RTN","PXBAPI1",209,0)
 ;
"RTN","PXBAPI1",210,0)
POV(PXBEXIT) ;Ask the user Diagnoses
"RTN","PXBAPI1",211,0)
 D POV^PXBMPOV(PXBVST) K PRVDR
"RTN","PXBAPI1",212,0)
 Q
"RTN","PXBAPI1",213,0)
 ;
"RTN","PXBAPI1",214,0)
PRV(PXBEXIT) ;Ask the user Providers
"RTN","PXBAPI1",215,0)
 D PRV^PXBMPRV(PXBVST,"PRV") K PRVDR
"RTN","PXBAPI1",216,0)
 Q
"RTN","PXBAPI1",217,0)
 ;
"RTN","PXBAPI1",218,0)
STP(PXBEXIT) ;Ask the user Stop Codes
"RTN","PXBAPI1",219,0)
 I $L($T(DATE^SCDXUTL)),$$DATE^SCDXUTL(+$G(^AUPNVSIT(PXBVST,0))) Q
"RTN","PXBAPI1",220,0)
 D STP^PXBMSTP(PXBVST) K PRVDR
"RTN","PXBAPI1",221,0)
 Q
"RTN","PXBAPI1",222,0)
 ;
"RTN","PXBAPI21")
0^51^B21580661
"RTN","PXBAPI21",1,0)
PXBAPI21 ;ISL/DCM - API for Classification check out ; 4/13/05 12:55pm
"RTN","PXBAPI21",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**130,147,124**;Aug 12, 1996
"RTN","PXBAPI21",3,0)
CLASS(ENCOWNTR,DFN,APTDT,LOC,VISIT) ;Edit classification fields
"RTN","PXBAPI21",4,0)
 ; Input  - ENCOWNTR - ien of ^SCE(ien (409.68 Outpatient Encounter file)
"RTN","PXBAPI21",5,0)
 ;          ENCOWNTR optional if DFN,LOC,APTDT params used
"RTN","PXBAPI21",6,0)
 ;          DFN - ien of ^DPT(DFN, (only used if no ENCOWNTR)
"RTN","PXBAPI21",7,0)
 ;          LOC - ien of ^SC(LOC,  (only used if no ENCOWNTR)
"RTN","PXBAPI21",8,0)
 ;          APTDT - Appointment Date/time (only used if no ENCOWNTR)
"RTN","PXBAPI21",9,0)
 ;          VISIT - optional if no ENCOWNTR look for main encounter that
"RTN","PXBAPI21",10,0)
 ;                  points to this visit
"RTN","PXBAPI21",11,0)
 ; Output - PXBDATA(Classification type)=OutPT Class ien^Value
"RTN","PXBAPI21",12,0)
 ;          PXBDATA("ERR",Class type)=1 Bad ptr to 409.41
"RTN","PXBAPI21",13,0)
 ;                                    =2 DATA entry not applicable
"RTN","PXBAPI21",14,0)
 ;                                    =3 DATA entry uneditable
"RTN","PXBAPI21",15,0)
 ;                                    =4 User ^ out of prompt
"RTN","PXBAPI21",16,0)
 ;            Classification type 1 - Agent Orange
"RTN","PXBAPI21",17,0)
 ;                                2 - Ionizing Radiation
"RTN","PXBAPI21",18,0)
 ;                                3 - Service Connected
"RTN","PXBAPI21",19,0)
 ;                                4 - Environmental Contaminants
"RTN","PXBAPI21",20,0)
 ;                                5 - Military Sexual Trauma
"RTN","PXBAPI21",21,0)
 ;                                6 - Head and/or Neck Cancer
"RTN","PXBAPI21",22,0)
 ;                                7 - Combat Veteran
"RTN","PXBAPI21",23,0)
 ;
"RTN","PXBAPI21",24,0)
 ; Ext References: ^SCE(DA,0)              INP^SDAM2
"RTN","PXBAPI21",25,0)
 ;                 REQ^SDM1A               CLINIC^SDAMU
"RTN","PXBAPI21",26,0)
 ;                 EXOE^SDCOU2             CLOE^SDCO21
"RTN","PXBAPI21",27,0)
 ;                 SEQ^SDCO21              CL^SDCO21
"RTN","PXBAPI21",28,0)
 ;   In ^PXBAPI22
"RTN","PXBAPI21",29,0)
 ;                 ^DG(43,1,"SCLR")  piece 24
"RTN","PXBAPI21",30,0)
 ;                 ^SD(409.41,DA,0)        ^SD(409.41,DA,2)
"RTN","PXBAPI21",31,0)
 ;                 VAL^SDCODD              SC^SDCO23
"RTN","PXBAPI21",32,0)
 I $G(ENCOWNTR)'>0,$G(VISIT)>0 D SC^PXCEVFI2($P(^AUPNVSIT(VISIT,0),U,5)) D
"RTN","PXBAPI21",33,0)
 . S ENCOWNTR=$O(^SCE("AVSIT",VISIT,0))
"RTN","PXBAPI21",34,0)
 . I ENCOWNTR,$P(^SCE(ENCOWNTR,0),"^",6) S ENCOWNTR=$P(^SCE(ENCOWNTR,0),"^",6)
"RTN","PXBAPI21",35,0)
 N IEN,IFN,SDCLOEY,ORG,END,DA,X,SQUIT
"RTN","PXBAPI21",36,0)
 I $G(ENCOWNTR) Q:'$D(^SCE(+ENCOWNTR,0))  N APTDT,DFN,LOC S END=0,X0=^(0) D ENCHK(ENCOWNTR,X0) Q:END  G ON
"RTN","PXBAPI21",37,0)
 Q:'$G(DFN)!'$G(LOC)!'$G(APTDT)
"RTN","PXBAPI21",38,0)
 D SC^PXCEVFI2(DFN)
"RTN","PXBAPI21",39,0)
 S X=$G(^DPT(DFN,"S",APTDT,0))
"RTN","PXBAPI21",40,0)
 I +X,+X=LOC,$P(X,"^",20),$D(^SCE($P(X,"^",20),0)) S ENCOWNTR=$P(X,"^",20),END=0,X0=^(0) D ENCHK(ENCOWNTR,X0) Q:END  G ON
"RTN","PXBAPI21",41,0)
ON D ASKCL($G(ENCOWNTR),.SDCLOEY,DFN,APTDT)
"RTN","PXBAPI21",42,0)
 I '$D(SDCLOEY) Q
"RTN","PXBAPI21",43,0)
 I $G(PXCECAT)="POV" D
"RTN","PXBAPI21",44,0)
 .I $P($G(PXCEAFTR(800)),"^",1)]"",$D(SDCLOEY(3)) S $P(SDCLOEY(3),"^",2)=$P(PXCEAFTR(800),"^",1)
"RTN","PXBAPI21",45,0)
 .I $P($G(PXCEAFTR(800)),"^",2)]"",$D(SDCLOEY(1)) S $P(SDCLOEY(1),"^",2)=$P(PXCEAFTR(800),"^",2)
"RTN","PXBAPI21",46,0)
 .I $P($G(PXCEAFTR(800)),"^",3)]"",$D(SDCLOEY(2)) S $P(SDCLOEY(2),"^",2)=$P(PXCEAFTR(800),"^",3)
"RTN","PXBAPI21",47,0)
 .I $P($G(PXCEAFTR(800)),"^",4)]"",$D(SDCLOEY(4)) S $P(SDCLOEY(4),"^",2)=$P(PXCEAFTR(800),"^",4)
"RTN","PXBAPI21",48,0)
 .I $P($G(PXCEAFTR(800)),"^",5)]"",$D(SDCLOEY(5)) S $P(SDCLOEY(5),"^",2)=$P(PXCEAFTR(800),"^",5)
"RTN","PXBAPI21",49,0)
 .I $P($G(PXCEAFTR(800)),"^",6)]"",$D(SDCLOEY(6)) S $P(SDCLOEY(6),"^",2)=$P(PXCEAFTR(800),"^",6)
"RTN","PXBAPI21",50,0)
 .I $P($G(PXCEAFTR(800)),"^",7)]"",$D(SDCLOEY(7)) S $P(SDCLOEY(7),"^",2)=$P(PXCEAFTR(800),"^",7)
"RTN","PXBAPI21",51,0)
 I $D(SDCLOEY) D ASK($G(ENCOWNTR),.SDCLOEY,.SQUIT) Q:$D(SQUIT)
"RTN","PXBAPI21",52,0)
 Q
"RTN","PXBAPI21",53,0)
ASKCL(ENCOWNTR,SDCLOEY,DFN,APTDT) ;Ask classifications on check out
"RTN","PXBAPI21",54,0)
 I $G(ENCOWNTR) D CLOE^SDCO21(ENCOWNTR,.SDCLOEY) Q
"RTN","PXBAPI21",55,0)
 D CL^SDCO21(DFN,APTDT,"",.SDCLOEY)
"RTN","PXBAPI21",56,0)
 Q
"RTN","PXBAPI21",57,0)
ASK(ENCOWNTR,SDCLOEY,SQUIT) ;Ask classifications
"RTN","PXBAPI21",58,0)
 N I,IOINHI,IOINORM,TYPI,TYPSEQ,CTS,X,PXVST
"RTN","PXBAPI21",59,0)
 S X="IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PXBAPI21",60,0)
 I '$D(SDCLOEY) Q
"RTN","PXBAPI21",61,0)
 W !!,"--- ",IOINHI,"Classification",IOINORM," --- [",IOINHI,"Required",IOINORM,"]"
"RTN","PXBAPI21",62,0)
 W ! S TYPSEQ=$$SEQ^SDCO21 ;Get classification type sequence (3,1,2,4,5,6,7)
"RTN","PXBAPI21",63,0)
 F CTS=1:1 S TYPI=+$P(TYPSEQ,",",CTS) Q:'TYPI!($D(SQUIT))  D
"RTN","PXBAPI21",64,0)
 .I $D(SDCLOEY(TYPI)) D
"RTN","PXBAPI21",65,0)
 ..S PXVST=$P($G(X0),U,5) I 'PXVST,($G(PXCECAT)="VST")!($G(PXCECAT)="SIT") Q
"RTN","PXBAPI21",66,0)
 ..I $G(PXCECAT)="VST",TYPI=3,($P($G(^AUPNVSIT(PXVST,800)),U,11)="1")  Q
"RTN","PXBAPI21",67,0)
 ..I $G(PXCECAT)="VST",TYPI=1,($P($G(^AUPNVSIT(PXVST,800)),U,12)="1")  Q
"RTN","PXBAPI21",68,0)
 ..I $G(PXCECAT)="VST",TYPI=2,($P($G(^AUPNVSIT(PXVST,800)),U,13)="1")  Q
"RTN","PXBAPI21",69,0)
 ..I $G(PXCECAT)="VST",TYPI=4,($P($G(^AUPNVSIT(PXVST,800)),U,14)="1")  Q
"RTN","PXBAPI21",70,0)
 ..I $G(PXCECAT)="VST",TYPI=5,($P($G(^AUPNVSIT(PXVST,800)),U,15)="1")  Q
"RTN","PXBAPI21",71,0)
 ..I $G(PXCECAT)="VST",TYPI=6,($P($G(^AUPNVSIT(PXVST,800)),U,16)="1")  Q
"RTN","PXBAPI21",72,0)
 ..I $G(PXCECAT)="VST",TYPI=7,($P($G(^AUPNVSIT(PXVST,800)),U,17)="1")  Q
"RTN","PXBAPI21",73,0)
 ..D ONE^PXBAPI22(TYPI,SDCLOEY(TYPI),ENCOWNTR,.SQUIT)
"RTN","PXBAPI21",74,0)
 ..I TYPI=3 F I=1,2,4 S:$D(SDCLOEY(I))&($P($G(PXBDATA(3)),"^",2)=1) $P(SDCLOEY(I),"^",3)=1 S:$P($G(PXBDATA(3)),"^",2)=0&('$D(SDCLOEY(I))) SDCLOEY(I)=""
"RTN","PXBAPI21",75,0)
 Q
"RTN","PXBAPI21",76,0)
ENCHK(ENCOWNTR,X0) ;Do outpatient encounter checks
"RTN","PXBAPI21",77,0)
 S APTDT=+X0,DFN=$P(X0,"^",2),LOC=$P(X0,"^",4),ORG=$P(X0,"^",8),DA=$P(X0,"^",9)
"RTN","PXBAPI21",78,0)
 I +$G(VADM(6)),+$G(VADM(6))<APTDT D  K DIR I $D(DIRUT) S (PXDOD,END)=1 Q
"RTN","PXBAPI21",79,0)
 . S DIR(0)="E",DIR("A")="Enter RETURN to continue or '^' to Quit"
"RTN","PXBAPI21",80,0)
 . S DIR("A",2)="WARNING "_VADM(7),DIR("A",1)=" ",DIR("A",3)=" " D ^DIR
"RTN","PXBAPI21",81,0)
 I $$REQ^SDM1A(+X0)'="CO" S END=1 Q  ;Check MAS Check out date parameter
"RTN","PXBAPI21",82,0)
 I ORG=1,'$$CLINIC^SDAMU(+LOC) S END=1 Q  ;Screen for valid clinic
"RTN","PXBAPI21",83,0)
 I "^1^2^"[("^"_ORG_"^"),$$INP^SDAM2(+DFN,+X0)="I" S END=1 Q  ;Inpat chk
"RTN","PXBAPI21",84,0)
 I $$EXOE^SDCOU2(ENCOWNTR) S END=1 Q  ;Chk exempt Outpt classifications
"RTN","PXBAPI21",85,0)
 Q
"RTN","PXBAPI21",86,0)
TEST ;Test call to CLASS
"RTN","PXBAPI21",87,0)
 N PXIFN S PXIFN=63
"RTN","PXBAPI21",88,0)
 F  S PXIFN=$O(^SCE(PXIFN)) Q:PXIFN<1  S DFN=$P(^(PXIFN,0),"^",2) K PXBDATA W !!,PXIFN_"   "_$P(^DPT(DFN,0),"^") D  S %=1 W !,"Continue " D YN^DICN Q:%'=1
"RTN","PXBAPI21",89,0)
 . D CLASS(PXIFN)
"RTN","PXBAPI21",90,0)
 . ;W ! ZW PXBDATA
"RTN","PXBAPI21",91,0)
 Q
"RTN","PXBCC")
0^35^B43568980
"RTN","PXBCC",1,0)
PXBCC ;ISL/JVS - CURSOR CONTROLS-UTILITY ROUTINES ;9/10/04 11:33am
"RTN","PXBCC",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**7,73,141,124**;Aug 12, 1996
"RTN","PXBCC",3,0)
 ;
"RTN","PXBCC",4,0)
 ; Variable List
"RTN","PXBCC",5,0)
 ; PXBSAVE= A Second dopy fo the top Margin in a window
"RTN","PXBCC",6,0)
 ; PXBCNT=  A Count of how many Items listed in top window
"RTN","PXBCC",7,0)
 ;
"RTN","PXBCC",8,0)
ZERO ;--ZERO $X & $Y
"RTN","PXBCC",9,0)
 N DX,DY
"RTN","PXBCC",10,0)
 S DX=0,DY=0 X ^%ZOSF("XY")
"RTN","PXBCC",11,0)
 Q
"RTN","PXBCC",12,0)
DXDY ;RESET $X $Y
"RTN","PXBCC",13,0)
 X ^%ZOSF("XY")
"RTN","PXBCC",14,0)
 Q
"RTN","PXBCC",15,0)
INHI() ; Switch to highlighted video (IOINHI must be defined by caller)
"RTN","PXBCC",16,0)
 S DX=$X#81,DY=$Y#25 W IOINHI X ^%ZOSF("XY")
"RTN","PXBCC",17,0)
 Q ""
"RTN","PXBCC",18,0)
INLO() ; Switch to lowlighted video (IOINLOW must be defined by caller)
"RTN","PXBCC",19,0)
 S DX=$X#81,DY=$Y#25 W IOINLOW X ^%ZOSF("XY")
"RTN","PXBCC",20,0)
 Q ""
"RTN","PXBCC",21,0)
FIX ;--FIX
"RTN","PXBCC",22,0)
 D TERM,FULL0 W IOUOFF,IOG0
"RTN","PXBCC",23,0)
 Q
"RTN","PXBCC",24,0)
FIX1 ;--FIX
"RTN","PXBCC",25,0)
 D TERM,FULL0 W IOUOFF,IOG0
"RTN","PXBCC",26,0)
 Q
"RTN","PXBCC",27,0)
WINDOW(PXBCNT,DOWN) ;--set up window area
"RTN","PXBCC",28,0)
 N I,IOTM,IOBM
"RTN","PXBCC",29,0)
 I PXBCNT>10 S IOTM=17
"RTN","PXBCC",30,0)
 I PXBCNT<11 S IOTM=PXBCNT+7
"RTN","PXBCC",31,0)
 S PXBSAVE=IOTM I '$D(IOSC) D TERM
"RTN","PXBCC",32,0)
 S IOBM=(IOSL-1)
"RTN","PXBCC",33,0)
 W IOSC W @IOSTBM W IORC ;--Create smaller window
"RTN","PXBCC",34,0)
 I '$D(DOWN) F I=1:1:2 W IOCUD ;-- move currsor down twice
"RTN","PXBCC",35,0)
 S PXBWIN=""
"RTN","PXBCC",36,0)
 Q
"RTN","PXBCC",37,0)
WIN17(PXBCNT) ;--set up window area on the 17th line
"RTN","PXBCC",38,0)
 N I,IOTM,IOBM
"RTN","PXBCC",39,0)
 W IOCUOFF
"RTN","PXBCC",40,0)
 S IOTM=17
"RTN","PXBCC",41,0)
 S PXBSAVE=IOTM I '$D(IOSC) D TERM
"RTN","PXBCC",42,0)
 S IOBM=(IOSL-0)
"RTN","PXBCC",43,0)
 W IOSC W @IOSTBM W IORC ;--Create smaller window
"RTN","PXBCC",44,0)
 S PXBWIN=""
"RTN","PXBCC",45,0)
 W IOCUON
"RTN","PXBCC",46,0)
 Q
"RTN","PXBCC",47,0)
 ;
"RTN","PXBCC",48,0)
WINDOW1(PXBCNT) ;--set up window area
"RTN","PXBCC",49,0)
 N I,IOTM,IOBM
"RTN","PXBCC",50,0)
 S IOBM=IOSL-1
"RTN","PXBCC",51,0)
 W IOSC W @IOSTBM W IORC ;--Create smaller window
"RTN","PXBCC",52,0)
 F I=1:1:2 W IOCUD ;-- move currsor down once
"RTN","PXBCC",53,0)
 Q
"RTN","PXBCC",54,0)
 ;
"RTN","PXBCC",55,0)
TERM ;--set up the terminal variables
"RTN","PXBCC",56,0)
 N X
"RTN","PXBCC",57,0)
 S X="IOSGRO;IOSTBM;IOCUU;IOSC;IORC;IOCUD;IOHOME;IOELALL;IORVON;IORVOFF;IOCUF;IONEL;IOBON;IOBOFF;IOUON;IOUOFF;IOELEOL;IOEDALL;IOEDEOP;IOCUB;IOECH;IOELBOL;IOIND"
"RTN","PXBCC",58,0)
 D ENDR^%ZISS,GSET^%ZISS
"RTN","PXBCC",59,0)
 S X="IOINLOW;IOINHI;IOINORM;IOCUOFF;IOCUON;IORI;IOIND;IORESET;IOCUOFF;IOCUON;IOSGR0"
"RTN","PXBCC",60,0)
 D ENDR^%ZISS
"RTN","PXBCC",61,0)
 I IOSTBM="" S IOSTBM=1
"RTN","PXBCC",62,0)
 Q
"RTN","PXBCC",63,0)
FULL ;--set terminal to full scrolling window
"RTN","PXBCC",64,0)
 N IOTM,IOBM,X
"RTN","PXBCC",65,0)
 K PXBWIN
"RTN","PXBCC",66,0)
 I '$D(IOSTBM) D TERM
"RTN","PXBCC",67,0)
 I IOSTBM]"" S IOTM=1,IOBM=(IOSL-(1)) W IOSC W @IOSTBM W IORC
"RTN","PXBCC",68,0)
 S X=IOM X ^%ZOSF("RM")
"RTN","PXBCC",69,0)
 Q
"RTN","PXBCC",70,0)
FULL0 ;--set terminal to full scrolling window
"RTN","PXBCC",71,0)
 N IOTM,IOBM,X
"RTN","PXBCC",72,0)
 I '$D(IOSTBM) D TERM
"RTN","PXBCC",73,0)
 I IOSTBM]"" S IOTM=1,IOBM=IOSL W IOSC W @IOSTBM W IORC
"RTN","PXBCC",74,0)
 S X=IOM X ^%ZOSF("RM")
"RTN","PXBCC",75,0)
 Q
"RTN","PXBCC",76,0)
CLEAR1 ;--clean out all cursor control varibles
"RTN","PXBCC",77,0)
 D KILL^%ZISS,GKILL^%ZISS
"RTN","PXBCC",78,0)
 Q
"RTN","PXBCC",79,0)
UNDON ;--underline on
"RTN","PXBCC",80,0)
 I '$D(IOUON) D TERM^PXBCC
"RTN","PXBCC",81,0)
 W IOUON
"RTN","PXBCC",82,0)
 Q
"RTN","PXBCC",83,0)
UNDOFF ;--underline off
"RTN","PXBCC",84,0)
 I '$D(IOUON) D TERM^PXBCC
"RTN","PXBCC",85,0)
 W IOUOFF
"RTN","PXBCC",86,0)
 Q
"RTN","PXBCC",87,0)
REVCPT(LINE,PXRVON) ;--Reverse Video a particular CPT CODE,PROVIDER OR POV
"RTN","PXBCC",88,0)
 ;
"RTN","PXBCC",89,0)
 ;     INPUT:  LINE = Selection from PXBSAM array
"RTN","PXBCC",90,0)
 ;             PXRVON = Flag to turn reverse video on/off
"RTN","PXBCC",91,0)
 ;                 where: 1 = reverse video on
"RTN","PXBCC",92,0)
 ;                        0 = reverse video off   
"RTN","PXBCC",93,0)
 ;
"RTN","PXBCC",94,0)
 Q:$G(NOREV)=1
"RTN","PXBCC",95,0)
 N ENTRY,XLINE,I,IOTM,IOBM,COL,DX,DY
"RTN","PXBCC",96,0)
 S ENTRY=$G(PXBSAM(LINE))
"RTN","PXBCC",97,0)
 ;Actual line on which CPT code displayed
"RTN","PXBCC",98,0)
 S XLINE=LINE#10+4
"RTN","PXBCC",99,0)
 I XLINE<5 S XLINE=XLINE+10
"RTN","PXBCC",100,0)
 I '$D(IOSC) D TERM
"RTN","PXBCC",101,0)
 S COL=4
"RTN","PXBCC",102,0)
 W IOSC S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",103,0)
 F I=1:1:XLINE W IOCUD
"RTN","PXBCC",104,0)
 F I=1:1:COL W IOCUF
"RTN","PXBCC",105,0)
 S DY=XLINE,DX=COL D DXDY
"RTN","PXBCC",106,0)
 I $G(PXRVON) W IORVON,$P(ENTRY,"^",1),IORVOFF
"RTN","PXBCC",107,0)
 I '$G(PXRVON) W IORVOFF,$P(ENTRY,"^",1)
"RTN","PXBCC",108,0)
 S IOTM=PXBSAVE,IOBM=IOSL W @IOSTBM W IORC
"RTN","PXBCC",109,0)
 Q
"RTN","PXBCC",110,0)
REVPRV(LINE) ;--Reverse Video a particular CPT CODE,PROVIDER OR POV
"RTN","PXBCC",111,0)
 Q:$G(NOREV)=1  Q:$G(FROM)["CPT"  Q:$G(FROM)["PL"
"RTN","PXBCC",112,0)
 N ENTRY,XLINE,I,IOTM,IOBM,COL,DX,DY
"RTN","PXBCC",113,0)
 S ENTRY=$G(PXBSAM(LINE)),XLINE=(LINE#10)+4
"RTN","PXBCC",114,0)
 I XLINE<5 S XLINE=XLINE+10
"RTN","PXBCC",115,0)
 I '$D(IOSC) D TERM
"RTN","PXBCC",116,0)
 S COL=4
"RTN","PXBCC",117,0)
 W IOSC S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",118,0)
 F I=1:1:XLINE W IOCUD
"RTN","PXBCC",119,0)
 F I=1:1:COL W IOCUF
"RTN","PXBCC",120,0)
 S DY=XLINE,DX=COL D DXDY
"RTN","PXBCC",121,0)
 W IORVON,$P(ENTRY,"^",1),IORVOFF
"RTN","PXBCC",122,0)
 S IOTM=PXBSAVE,IOBM=IOSL W @IOSTBM W IORC
"RTN","PXBCC",123,0)
 Q
"RTN","PXBCC",124,0)
REVPOV(LINE) ;--Reverse Video a particular CPT CODE,PROVIDER OR POV
"RTN","PXBCC",125,0)
 Q:$G(NOREV)=1
"RTN","PXBCC",126,0)
 N ENTRY,XLINE,I,IOTM,IOBM,COL,DX,DY
"RTN","PXBCC",127,0)
 S ENTRY=$G(PXBSAM(LINE)),XLINE=(LINE*2-1#10)+4
"RTN","PXBCC",128,0)
 I XLINE<5 S XLINE=XLINE+10
"RTN","PXBCC",129,0)
 I '$D(IOSC) D TERM
"RTN","PXBCC",130,0)
 S COL=4
"RTN","PXBCC",131,0)
 W IOSC S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",132,0)
 F I=1:1:XLINE W IOCUD
"RTN","PXBCC",133,0)
 F I=1:1:COL W IOCUF
"RTN","PXBCC",134,0)
 S DY=XLINE,DX=COL D DXDY
"RTN","PXBCC",135,0)
 W IORVON,$J($P($P(ENTRY,"^",1),".",1),4),".",$P($P(ENTRY,"^",1),".",2),IORVOFF
"RTN","PXBCC",136,0)
 S IOTM=PXBSAVE,IOBM=IOSL W @IOSTBM W IORC
"RTN","PXBCC",137,0)
 Q
"RTN","PXBCC",138,0)
REVSTP(LINE) ;--Reverse Video a particular CPT CODE,PROVIDER OR POV
"RTN","PXBCC",139,0)
 Q:$G(NOREV)=1
"RTN","PXBCC",140,0)
 N ENTRY,XLINE,I,IOTM,IOBM,COL,DX,DY
"RTN","PXBCC",141,0)
 S ENTRY=$G(PXBSAM(LINE)),XLINE=(LINE#10)+4
"RTN","PXBCC",142,0)
 I XLINE<5 S XLINE=XLINE+10
"RTN","PXBCC",143,0)
 I '$D(IOSC) D TERM
"RTN","PXBCC",144,0)
 S COL=4
"RTN","PXBCC",145,0)
 W IOSC S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",146,0)
 F I=1:1:XLINE W IOCUD
"RTN","PXBCC",147,0)
 F I=1:1:COL W IOCUF
"RTN","PXBCC",148,0)
 S DY=XLINE,DX=COL D DXDY
"RTN","PXBCC",149,0)
 W IORVON,$P(ENTRY,"^",1),IORVOFF
"RTN","PXBCC",150,0)
 S IOTM=PXBSAVE,IOBM=IOSL W @IOSTBM W IORC
"RTN","PXBCC",151,0)
 Q
"RTN","PXBCC",152,0)
 ;
"RTN","PXBCC",153,0)
UREV(LINE) ;--Reverse Video a particular CPT CODE,PROVIDER OR POV
"RTN","PXBCC",154,0)
 Q
"RTN","PXBCC",155,0)
 ;--**OUT OF ORDER
"RTN","PXBCC",156,0)
 N ENTRY,XLINE,I,IOTM,IOBM,DX,DY
"RTN","PXBCC",157,0)
 S ENTRY=$G(PXBSAM(LINE)),XLINE=LINE+4
"RTN","PXBCC",158,0)
 I '$D(IOSC) D TERM
"RTN","PXBCC",159,0)
 W IOSC S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",160,0)
 F I=1:1:XLINE W IOCUD
"RTN","PXBCC",161,0)
 F I=1:1:4 W IOCUF
"RTN","PXBCC",162,0)
 S DY=XLINE,DX=COL D DXDY
"RTN","PXBCC",163,0)
 W $P(ENTRY,"^",1)
"RTN","PXBCC",164,0)
 S IOTM=PXBSAVE,IOBM=IOSL W @IOSTBM W IORC
"RTN","PXBCC",165,0)
 Q
"RTN","PXBCC",166,0)
 ;
"RTN","PXBCC",167,0)
RREV(LINE,COLUMN,ENTRY) ;--Reverse REQUESTED information
"RTN","PXBCC",168,0)
 Q:$G(NOREV)=1
"RTN","PXBCC",169,0)
 N XLINE,I,IOTM,IOBM,DX,DY
"RTN","PXBCC",170,0)
 S XLINE=LINE+1
"RTN","PXBCC",171,0)
 I '$D(IOSC) D TERM
"RTN","PXBCC",172,0)
 W IOSC S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",173,0)
 F I=1:1:XLINE W IOCUD
"RTN","PXBCC",174,0)
 F I=1:1:COLUMN W IOCUF
"RTN","PXBCC",175,0)
 S DY=XLINE,DX=COLUMN D DXDY
"RTN","PXBCC",176,0)
 W IOELEOL,IOINHI,ENTRY,IOINLOW
"RTN","PXBCC",177,0)
 S IOTM=PXBSAVE,IOBM=IOSL W @IOSTBM W IORC
"RTN","PXBCC",178,0)
 Q
"RTN","PXBCC",179,0)
RREVST(LINE,COLUMN,ENTRY) ;--Reverse REQUESTED information
"RTN","PXBCC",180,0)
 Q:$G(NOREV)=1
"RTN","PXBCC",181,0)
 N XLINE,I,IOTM,IOBM,DX,DY
"RTN","PXBCC",182,0)
 S XLINE=LINE+1
"RTN","PXBCC",183,0)
 I '$D(IOSC) D TERM
"RTN","PXBCC",184,0)
 W IOSC S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",185,0)
 F I=1:1:XLINE W IOCUD
"RTN","PXBCC",186,0)
 F I=1:1:COLUMN W IOCUF
"RTN","PXBCC",187,0)
 S DY=XLINE,DX=COLUMN D DXDY
"RTN","PXBCC",188,0)
 W IORVON,ENTRY,IORVOFF
"RTN","PXBCC",189,0)
 S IOTM=PXBSAVE,IOBM=IOSL W @IOSTBM W IORC
"RTN","PXBCC",190,0)
 Q
"RTN","PXBCC",191,0)
RREVH(LINE,COLUMN,ENTRY) ;--Reverse REQUESTED information
"RTN","PXBCC",192,0)
 Q:$G(NOREV)=1
"RTN","PXBCC",193,0)
 N XLINE,I,IOTM,IOBM,DX,DY
"RTN","PXBCC",194,0)
 S XLINE=LINE+1
"RTN","PXBCC",195,0)
 I '$D(IOSC) D TERM
"RTN","PXBCC",196,0)
 W IOSC S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",197,0)
 F I=1:1:XLINE W IOCUD
"RTN","PXBCC",198,0)
 F I=1:1:COLUMN W IOCUF
"RTN","PXBCC",199,0)
 S DY=XLINE,DX=COLUMN D DXDY
"RTN","PXBCC",200,0)
 W IOELEOL,IOINHI,IOUON,ENTRY,IOINLOW,IOUON F I=1:1:5 W " "
"RTN","PXBCC",201,0)
 W IOUOFF
"RTN","PXBCC",202,0)
 S IOTM=PXBSAVE,IOBM=IOSL W @IOSTBM W IORC
"RTN","PXBCC",203,0)
 Q
"RTN","PXBCC",204,0)
LOC(LINE,COLUMN) ;--Locate Cursor to specified position
"RTN","PXBCC",205,0)
 N PXBOS
"RTN","PXBCC",206,0)
 S PXBOS=^%ZOSF("OS")
"RTN","PXBCC",207,0)
 I PXBOS'["MSM" N DY,DX S DY=LINE,DX=COLUMN X IOXY,^%ZOSF("XY") Q
"RTN","PXBCC",208,0)
 N XLINE,I,IOTM,IOBM,DX,DY
"RTN","PXBCC",209,0)
 W IOCUOFF
"RTN","PXBCC",210,0)
 I '$D(IOSTBM) D TERM
"RTN","PXBCC",211,0)
 S IOTM=1,IOBM=IOSL W @IOSTBM W IOHOME D ZERO
"RTN","PXBCC",212,0)
 I $D(LINE) F I=1:1:LINE W IOIND
"RTN","PXBCC",213,0)
 F I=1:1:COLUMN W IOCUF
"RTN","PXBCC",214,0)
 I $D(LINE) S DY=LINE
"RTN","PXBCC",215,0)
 E  S DY=$Y
"RTN","PXBCC",216,0)
 S DX=COLUMN D DXDY
"RTN","PXBCC",217,0)
 W IOCUON
"RTN","PXBCC",218,0)
 Q
"RTN","PXBCC",219,0)
 ;
"RTN","PXBCC",220,0)
ERASE ;---ERASE THE LIST GOING UPWARDS
"RTN","PXBCC",221,0)
 N PXI
"RTN","PXBCC",222,0)
 I '$D(IOCUU) D TERM^PXBCC
"RTN","PXBCC",223,0)
 D LOC^PXBCC(15,1)
"RTN","PXBCC",224,0)
 S PXI=0 F I=1:1:11 W IORI,IOELALL
"RTN","PXBCC",225,0)
 Q
"RTN","PXBDCPT")
0^14^B45424112
"RTN","PXBDCPT",1,0)
PXBDCPT ;ISL/JVS,ESW - DISPLAY CPT ;3/5/04 10:39am
"RTN","PXBDCPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,89,108,121,124**;Aug 12, 1996
"RTN","PXBDCPT",3,0)
 ;
"RTN","PXBDCPT",4,0)
 ;
"RTN","PXBDCPT",5,0)
EN0 ;---Main entry point
"RTN","PXBDCPT",6,0)
 ;
"RTN","PXBDCPT",7,0)
 ;
"RTN","PXBDCPT",8,0)
HEAD ;--HEADER ON LIST
"RTN","PXBDCPT",9,0)
 S HEAD="- - E N C O U N T E R  P R O C E D U R E S (CPT CODES) - -"
"RTN","PXBDCPT",10,0)
 W IOINHI,!,IOCUU,?(IOM-$L(HEAD))\2,HEAD,IOINLOW
"RTN","PXBDCPT",11,0)
 W IOELEOL K HEAD
"RTN","PXBDCPT",12,0)
 ;
"RTN","PXBDCPT",13,0)
 I $D(CLINIC) D PRV^PXBUTL2(CLINIC)
"RTN","PXBDCPT",14,0)
 ;
"RTN","PXBDCPT",15,0)
 ;I PXBCNT<11 D DISCPT1^PXBDCPT
"RTN","PXBDCPT",16,0)
 ;I PXBCNT<21&(PXBCNT>10) D DISCPT2^PXBDCPT
"RTN","PXBDCPT",17,0)
 ;I PXBCNT>20&(PXBCNT<31) D DISCPT3^PXBDCPT
"RTN","PXBDCPT",18,0)
 ;I PXBCNT>30&('$D(PXBNCPT))
"RTN","PXBDCPT",19,0)
 D DISCPT4^PXBDCPT("BEGIN")
"RTN","PXBDCPT",20,0)
 ;I PXBCNT>30&($D(PXBNCPT)) D DISCPT4^PXBDCPT("SAME")
"RTN","PXBDCPT",21,0)
 Q
"RTN","PXBDCPT",22,0)
 ;
"RTN","PXBDCPT",23,0)
 ;
"RTN","PXBDCPT",24,0)
 ;
"RTN","PXBDCPT",25,0)
ARRAY ;Set all CPT codes and modifiers into ^TMP("PXBDCPT",$J,"DSP"
"RTN","PXBDCPT",26,0)
 ;for display
"RTN","PXBDCPT",27,0)
 ;
"RTN","PXBDCPT",28,0)
 N PXSQ,ENTRY,PXMD,PXDESC,PX124,PXC,PXD
"RTN","PXBDCPT",29,0)
 S PXTMP="^TMP(""PXBDCPT"""_","_$J_","_"""DSP"")"
"RTN","PXBDCPT",30,0)
 K @PXTMP
"RTN","PXBDCPT",31,0)
 S (PXTLNS,PXSQ)=0
"RTN","PXBDCPT",32,0)
 F  S PXSQ=$O(PXBSAM(PXSQ)) Q:'PXSQ  D
"RTN","PXBDCPT",33,0)
 .S PXTLNS=PXTLNS+1
"RTN","PXBDCPT",34,0)
 .S ENTRY=PXBSAM(PXSQ)
"RTN","PXBDCPT",35,0)
 .S PXBSAM(PXSQ,"LINE")=PXTLNS
"RTN","PXBDCPT",36,0)
 .I $D(PXBNCPT($P(ENTRY,U))) D
"RTN","PXBDCPT",37,0)
 ..;I PXBNCPT($P(ENTRY,U))]"",'$D(PXBSKY(PXSQ,PXBNCPT($P(ENTRY,U)))) Q
"RTN","PXBDCPT",38,0)
 ..Q:'$D(PXBNCPT($P(ENTRY,U),$O(PXBSKY(PXSQ,0))))
"RTN","PXBDCPT",39,0)
 ..S $P(ENTRY,U)=$P(ENTRY,U)_"*"
"RTN","PXBDCPT",40,0)
 .S @PXTMP@(PXTLNS,0)=PXSQ_U_$P(ENTRY,U)_U_$P(ENTRY,U,2)_U_$P(ENTRY,U,4)_U_$E($P(ENTRY,U,3),1,24)
"RTN","PXBDCPT",41,0)
 .S PXMD=""
"RTN","PXBDCPT",42,0)
 .F  S PXMD=$O(PXBSAM(PXSQ,"MOD",PXMD)) Q:'PXMD  D
"RTN","PXBDCPT",43,0)
 ..S PXTLNS=PXTLNS+1
"RTN","PXBDCPT",44,0)
 ..S PXMOD=PXBSAM(PXSQ,"MOD",PXMD)
"RTN","PXBDCPT",45,0)
 ..S PXDESC=$P($$MODP^ICPTMOD($E(ENTRY,1,5),PXMOD,"E",IDATE),U,2) ;PX*108
"RTN","PXBDCPT",46,0)
 ..S @PXTMP@(PXTLNS,0)=0_U_PXMOD_U_$E(PXDESC,1,54)
"RTN","PXBDCPT",47,0)
 .S PXTLNS=PXTLNS+1
"RTN","PXBDCPT",48,0)
 .S @PXTMP@(PXTLNS,0)="-22^"_$P(ENTRY,U,22)
"RTN","PXBDCPT",49,0)
 .F PX124=5:1:12 D
"RTN","PXBDCPT",50,0)
 ..S PXC=$P(ENTRY,U,PX124) Q:PXC=""
"RTN","PXBDCPT",51,0)
 ..S PXD=$$ICDDX^ICDCODE(PXC) Q:PXD<1
"RTN","PXBDCPT",52,0)
 ..S PXC=PXC_"    "_$P(PXD,U,4)
"RTN","PXBDCPT",53,0)
 ..S PXTLNS=PXTLNS+1,@PXTMP@(PXTLNS,0)=-PX124_U_PXC
"RTN","PXBDCPT",54,0)
 ..I $G(PXBREQ(+PXD,"I"))="" S PXBREQ(+PXD,"I")=$P($$XLATE^PXBGPOV(PXBVST,+PXD),U,4,20)
"RTN","PXBDCPT",55,0)
 ..S PXTLNS=PXTLNS+1,@PXTMP@(PXTLNS,0)="I^"_PXBREQ(+PXD,"I")
"RTN","PXBDCPT",56,0)
 Q
"RTN","PXBDCPT",57,0)
DISCPT1 ;--Display the CPT Data
"RTN","PXBDCPT",58,0)
 ;
"RTN","PXBDCPT",59,0)
 N ENTRY,J
"RTN","PXBDCPT",60,0)
 D UNDON^PXBCC
"RTN","PXBDCPT",61,0)
 W !,"No.",?4,"CPT CODE",?14,"QUANTITY",?25,"DESCRIPTION",?55,"PROVIDER",?75,$C(32)
"RTN","PXBDCPT",62,0)
 W IOEDEOP
"RTN","PXBDCPT",63,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",64,0)
 ;
"RTN","PXBDCPT",65,0)
 ;
"RTN","PXBDCPT",66,0)
 S J=0
"RTN","PXBDCPT",67,0)
 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",68,0)
 .S ENTRY=$G(PXBSAM(J))
"RTN","PXBDCPT",69,0)
 .I $D(PXBNCPT($P(ENTRY,U,1))) S $P(ENTRY,U,1)=$P(ENTRY,U,1)_"*"
"RTN","PXBDCPT",70,0)
 .W !,J,?4,$P(ENTRY,U,1),?15,$P(ENTRY,U,2)
"RTN","PXBDCPT",71,0)
 .W ?25,$P(ENTRY,U,4),?55,$E($P(ENTRY,U,3),1,24)
"RTN","PXBDCPT",72,0)
 .;---Display associated modifiers
"RTN","PXBDCPT",73,0)
 .S PXSIEN=""
"RTN","PXBDCPT",74,0)
 .F  S PXSIEN=$O(PXBSAM(J,"MOD",PXSIEN)) Q:PXSIEN=""  D
"RTN","PXBDCPT",75,0)
 ..N PXWRAP,PXMOD,PXDESC,PXLN
"RTN","PXBDCPT",76,0)
 ..S PXMOD=PXBSAM(J,"MOD",PXSIEN)
"RTN","PXBDCPT",77,0)
 ..S PXDESC=$P($$MOD^ICPTMOD(PXMOD,"E",IDATE),U,3)
"RTN","PXBDCPT",78,0)
 ..D WRAP^PXCEVFI4(PXDESC,58,.PXWRAP)
"RTN","PXBDCPT",79,0)
 ..F PXLN=1:1 Q:$G(PXWRAP(PXLN))=""  D
"RTN","PXBDCPT",80,0)
 ...W:PXLN=1 !,?4,"CPT Modifier: "_PXMOD
"RTN","PXBDCPT",81,0)
 ...W:PXLN>1 !
"RTN","PXBDCPT",82,0)
 ...W ?22,PXWRAP(PXLN)
"RTN","PXBDCPT",83,0)
 ;---Write no entries if none exsist
"RTN","PXBDCPT",84,0)
 I '$D(PXBSAM) D NONE^PXBUTL(2)
"RTN","PXBDCPT",85,0)
 Q
"RTN","PXBDCPT",86,0)
 ;
"RTN","PXBDCPT",87,0)
DISCPT2 ;--display of cpt data two columns more that 10 entries.
"RTN","PXBDCPT",88,0)
 ;
"RTN","PXBDCPT",89,0)
 N ENTRY,J,PXA
"RTN","PXBDCPT",90,0)
 D GSET^%ZISS
"RTN","PXBDCPT",91,0)
 D UNDON^PXBCC W IOG1
"RTN","PXBDCPT",92,0)
 W !,"NO",?4,"CPT",?10,"QUA",?14,"DESCRIPTION",?39,IOVL
"RTN","PXBDCPT",93,0)
 W ?40,"NO",?44,"CPT",?50,"QUA",?54,"NARRATIVE"
"RTN","PXBDCPT",94,0)
 W IOEDEOP
"RTN","PXBDCPT",95,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",96,0)
 ;
"RTN","PXBDCPT",97,0)
 ;
"RTN","PXBDCPT",98,0)
 ;
"RTN","PXBDCPT",99,0)
 S J=0 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",100,0)
 .S ENTRY(J)=$G(PXBSAM(J)) I $D(PXBNCPT($P(ENTRY(J),U,1))) S $P(ENTRY(J),U,1)=$P(ENTRY(J),U,1)_"*"
"RTN","PXBDCPT",101,0)
 F J=1:1:10 D
"RTN","PXBDCPT",102,0)
 .W !,J,?4,$P(ENTRY(J),U,1),?11,$P(ENTRY(J),U,2),?14,$E($P(ENTRY(J),U,4),1,24)
"RTN","PXBDCPT",103,0)
 .D BAWRITE(ENTRY(J))
"RTN","PXBDCPT",104,0)
 .I $D(ENTRY(J+10)) D
"RTN","PXBDCPT",105,0)
 ..W ?39,IOVL,(J+10),?44,$P(ENTRY(J+10),U,1),?51,$P(ENTRY(J+10),U,2),?54,$E($P(ENTRY(J+10),U,4),1,24)
"RTN","PXBDCPT",106,0)
 ..D BAWRITE(ENTRY(J))
"RTN","PXBDCPT",107,0)
 W IOG0
"RTN","PXBDCPT",108,0)
 Q
"RTN","PXBDCPT",109,0)
 ;
"RTN","PXBDCPT",110,0)
DISCPT3 ;--display of cpt data three colums more that 20 entries.
"RTN","PXBDCPT",111,0)
 N ENTRY,J,PXA
"RTN","PXBDCPT",112,0)
 D GSET^%ZISS
"RTN","PXBDCPT",113,0)
 D UNDON^PXBCC W IOG1
"RTN","PXBDCPT",114,0)
 W !,"NO",?4,"CPT",?10,"QUA",?14,"NARRATIVE",?25,IOVL
"RTN","PXBDCPT",115,0)
 W ?26,"NO",?30,"CPT",?36,"QUA",?40,"NARRATIVE",?51,IOVL
"RTN","PXBDCPT",116,0)
 W ?52,"NO",?56,"CPT",?62,"QUA",?66,"NARRATIVE"
"RTN","PXBDCPT",117,0)
 W IOEDEOP
"RTN","PXBDCPT",118,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",119,0)
 ;
"RTN","PXBDCPT",120,0)
 S J=0 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDCPT",121,0)
 .S ENTRY(J)=$G(PXBSAM(J)) I $D(PXBNCPT($P(ENTRY(J),U,1))) S $P(ENTRY(J),U,1)=$P(ENTRY(J),U,1)_"*"
"RTN","PXBDCPT",122,0)
 F J=1:1:10 D
"RTN","PXBDCPT",123,0)
 .W !,J,?4,$P(ENTRY(J),U,1),?11,$P(ENTRY(J),U,2),?14,$E($P(ENTRY(J),U,4),1,10)
"RTN","PXBDCPT",124,0)
 .D BAWRITE(ENTRY(J))
"RTN","PXBDCPT",125,0)
 .I $D(ENTRY(J+10)) D 
"RTN","PXBDCPT",126,0)
 ..W ?25,IOVL,(J+10),?30,$P(ENTRY(J+10),U,1),?37,$P(ENTRY(J+10),U,2),?40,$E($P(ENTRY(J+10),U,4),1,10)
"RTN","PXBDCPT",127,0)
 ..D BAWRITE(ENTRY(J+10))
"RTN","PXBDCPT",128,0)
 .I $D(ENTRY(J+20)) D
"RTN","PXBDCPT",129,0)
 ..W ?51,IOVL,(J+20),?56,$P(ENTRY(J+20),U,1),?63,$P(ENTRY(J+20),U,2),?66,$E($P(ENTRY(J+20),U,4),1,10)
"RTN","PXBDCPT",130,0)
 ..D BAWRITE(ENTRY(J+20))
"RTN","PXBDCPT",131,0)
 W IOG0
"RTN","PXBDCPT",132,0)
 Q
"RTN","PXBDCPT",133,0)
 ;
"RTN","PXBDCPT",134,0)
DISCPT4(SIGN)   ;--Display the CPT Data
"RTN","PXBDCPT",135,0)
 ;
"RTN","PXBDCPT",136,0)
 ;SIGN=
"RTN","PXBDCPT",137,0)
 ; '+' add 10 to the starting point in ^TMP("PXBDCPT",$J)
"RTN","PXBDCPT",138,0)
 ; '-' subtract 10 from the starting point but not less that 0
"RTN","PXBDCPT",139,0)
 ; 'BEGIN' start at the beginning
"RTN","PXBDCPT",140,0)
 ; 'SAME' start stays where it's at
"RTN","PXBDCPT",141,0)
 ; '3'--any number set start to that number
"RTN","PXBDCPT",142,0)
 ;
"RTN","PXBDCPT",143,0)
 N PXBSTART,PXTMP
"RTN","PXBDCPT",144,0)
 D ARRAY
"RTN","PXBDCPT",145,0)
 I SIGN="BEGIN" S ^TMP("PXBDCPT",$J,"START")=0,PXBSTART=0
"RTN","PXBDCPT",146,0)
 I SIGN="SAME" S PXBSTART=^TMP("PXBDCPT",$J,"START")
"RTN","PXBDCPT",147,0)
 I SIGN="+" D
"RTN","PXBDCPT",148,0)
 .S PXBSTART=($G(^TMP("PXBDCPT",$J,"START"))+10)
"RTN","PXBDCPT",149,0)
 .I PXBSTART'<PXTLNS S PXBSTART=PXBSTART-10
"RTN","PXBDCPT",150,0)
 .S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",151,0)
 I SIGN="-" D
"RTN","PXBDCPT",152,0)
 .S PXBSTART=$G(^TMP("PXBDCPT",$J,"START"))-10
"RTN","PXBDCPT",153,0)
 .S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",154,0)
 .I PXBSTART<0 S PXBSTART=0 S ^TMP("PXBDCPT",$J,"START")=0
"RTN","PXBDCPT",155,0)
 I +SIGN>0&(SIGN#10) D  Q:^TMP("PXBDCPT",$J,"START")=PXBSTART  S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",156,0)
 .S PXBSTART=$P((SIGN/10),".")*10
"RTN","PXBDCPT",157,0)
 .S:PXBSTART<10 PXBSTART=0
"RTN","PXBDCPT",158,0)
 I +SIGN>0&'(SIGN#10) D  Q:^TMP("PXBDCPT",$J,"START")=PXBSTART  S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",159,0)
 .S PXBSTART=(($P((SIGN/10),".")*10)-10)
"RTN","PXBDCPT",160,0)
 .S:PXBSTART<10 PXBSTART=0
"RTN","PXBDCPT",161,0)
 ;
"RTN","PXBDCPT",162,0)
 ;
"RTN","PXBDCPT",163,0)
 I SIGN'="BEGIN" D LOC^PXBCC(3,0) W IOEDEOP
"RTN","PXBDCPT",164,0)
 ;
"RTN","PXBDCPT",165,0)
HEAD4 ;--HEADER ON LIST
"RTN","PXBDCPT",166,0)
 S HEAD="- - E N C O U N T E R  P R O C E D U R E S (CPT CODES) - -"
"RTN","PXBDCPT",167,0)
 W IOINHI,!,IOCUU,?(IOM-$L(HEAD))\2,HEAD,IOINLOW
"RTN","PXBDCPT",168,0)
 W IOELEOL K HEAD
"RTN","PXBDCPT",169,0)
 ;
"RTN","PXBDCPT",170,0)
 ;
"RTN","PXBDCPT",171,0)
 N ENTRY,J
"RTN","PXBDCPT",172,0)
 D UNDON^PXBCC
"RTN","PXBDCPT",173,0)
 W !,"No.",?4,"CPT CODE",?14,"QUANTITY",?25,"DESCRIPTION",?55,"PROVIDER",?75,$C(32)
"RTN","PXBDCPT",174,0)
 W IOEDEOP
"RTN","PXBDCPT",175,0)
 D UNDOFF^PXBCC
"RTN","PXBDCPT",176,0)
 ;
"RTN","PXBDCPT",177,0)
 ;
"RTN","PXBDCPT",178,0)
 N PXSIEN,PXDESC,PXMOD,PXQ,PXLNS,PX,PL
"RTN","PXBDCPT",179,0)
 S J=PXBSTART,PXQ=""
"RTN","PXBDCPT",180,0)
 S PXLNS=0
"RTN","PXBDCPT",181,0)
 F  S J=$O(@PXTMP@(J)) Q:J=""  D  Q:PXQ
"RTN","PXBDCPT",182,0)
 .S PXLNS=PXLNS+1
"RTN","PXBDCPT",183,0)
 .I '(PXLNS#11) D  Q
"RTN","PXBDCPT",184,0)
 ..S ^TMP("PXBDCPT",$J,"START")=PXBSTART
"RTN","PXBDCPT",185,0)
 ..S PXQ=1
"RTN","PXBDCPT",186,0)
 .I +@PXTMP@(J,0)>0 D  Q
"RTN","PXBDCPT",187,0)
 ..W !,$P(^(0),U),?4,$P(^(0),U,2),?15,$P(^(0),U,3)
"RTN","PXBDCPT",188,0)
 ..W ?25,$P(^(0),U,4),?55,$P(^(0),U,5)
"RTN","PXBDCPT",189,0)
 .I +@PXTMP@(J,0)<0 D  Q
"RTN","PXBDCPT",190,0)
 ..S PX=-$P(^(0),U,1)
"RTN","PXBDCPT",191,0)
 ..I PX=22 W !?4,"Ordering Provider:  ",$P(^(0),U,2) Q
"RTN","PXBDCPT",192,0)
 ..I PX<20 W !?4,"Diagnosis "_(PX-4)_":  ",$P(^(0),U,2) Q
"RTN","PXBDCPT",193,0)
 .I $P(@PXTMP@(J,0),U)="I" D CIA^PXBDPOV($P(^(0),U,2,16)) Q
"RTN","PXBDCPT",194,0)
 .I $P(@PXTMP@(J,0),U)=0 D
"RTN","PXBDCPT",195,0)
 ..W !?4,"CPT Modifier: "_$P(^(0),U,2)_"  "_$P(^(0),U,3)
"RTN","PXBDCPT",196,0)
 I SIGN'="BEGIN" W !!
"RTN","PXBDCPT",197,0)
 Q
"RTN","PXBDCPT",198,0)
 ;
"RTN","PXBDCPT",199,0)
BAWRITE(PXD)    ;WRITE BA INFO
"RTN","PXBDCPT",200,0)
 N PX,PD,PP
"RTN","PXBDCPT",201,0)
 W !?4,"Ordering Provider:  ",$P(PXD,U,22)
"RTN","PXBDCPT",202,0)
 F PX=1:1:8 D
"RTN","PXBDCPT",203,0)
 .S PD=$P(PXD,U,PX+5),PP=$$XLATE^PXBGPOV(PXBVST,PD)
"RTN","PXBDCPT",204,0)
 .Q:'PD!'PP
"RTN","PXBDCPT",205,0)
 .W:PD !?4,"Diagnosis:  ",PD
"RTN","PXBDCPT",206,0)
 .D CIA^PXBDPOV($P(PP,U,4,16))
"RTN","PXBDCPT",207,0)
 Q
"RTN","PXBDCPT",208,0)
 ;
"RTN","PXBDPOV")
0^36^B26487122
"RTN","PXBDPOV",1,0)
PXBDPOV ;ISL/JVS - DISPLAY POV (DIAGNOSIS) ;3/10/04 12:12pm
"RTN","PXBDPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Aug 12, 1996
"RTN","PXBDPOV",3,0)
 ;
"RTN","PXBDPOV",4,0)
 ;
"RTN","PXBDPOV",5,0)
EN0 ;---Main entry point
"RTN","PXBDPOV",6,0)
 I '$D(IOCUU) D TERM^PXBCC
"RTN","PXBDPOV",7,0)
 ;
"RTN","PXBDPOV",8,0)
HEAD ;--HEADER ON LIST
"RTN","PXBDPOV",9,0)
 S HEAD="- - E N C O U N T E R  D I A G N O S I S  (ICD9 CODES) - -"
"RTN","PXBDPOV",10,0)
 W !,IOCUU,?(IOM-$L(HEAD))\2,IOINHI,HEAD
"RTN","PXBDPOV",11,0)
 W IOINLOW,IOELEOL K HEAD
"RTN","PXBDPOV",12,0)
 ;
"RTN","PXBDPOV",13,0)
 I $D(CLINIC) D POV^PXBUTL2(CLINIC)
"RTN","PXBDPOV",14,0)
 ;I PXBCNT<11 D DPOV1
"RTN","PXBDPOV",15,0)
 ;I PXBCNT>10&($D(PXBNPOV)) D DPOV4("SAME")
"RTN","PXBDPOV",16,0)
 ;I PXBCNT>10&('$D(PXBNPOV)) D DPOV4("BEGIN")
"RTN","PXBDPOV",17,0)
 D DPOV4($S($D(PXBNPOV):"SAME",1:"BEGIN"))
"RTN","PXBDPOV",18,0)
 Q
"RTN","PXBDPOV",19,0)
 ;
"RTN","PXBDPOV",20,0)
 ;
"RTN","PXBDPOV",21,0)
DPOV1 ;--Display the POV Data
"RTN","PXBDPOV",22,0)
 N ENTRY,K
"RTN","PXBDPOV",23,0)
 D UNDON^PXBCC
"RTN","PXBDPOV",24,0)
 W !,"No.",?5,"ICD",?13,"DESCRIPTION",?64,"PROBLEM LIST"
"RTN","PXBDPOV",25,0)
 W IOEDEOP
"RTN","PXBDPOV",26,0)
 D UNDOFF^PXBCC
"RTN","PXBDPOV",27,0)
 ;
"RTN","PXBDPOV",28,0)
 ;
"RTN","PXBDPOV",29,0)
 S (K,J)=0 F  S J=$O(PXBSAM(J)) Q:J=""  D
"RTN","PXBDPOV",30,0)
 .S ENTRY=$G(PXBSAM(J)) I $D(PXBNPOV($P(ENTRY,"^",1))) S $P(ENTRY,"^",1)=$P(ENTRY,"^",1)_"*"
"RTN","PXBDPOV",31,0)
 .I $P(ENTRY,U)=0 D CIA($P(ENTRY,U,2,16)) Q
"RTN","PXBDPOV",32,0)
 .S K=K+1
"RTN","PXBDPOV",33,0)
 .W !,K,?4,$J($P($P(ENTRY,"^",1),".",1),4),".",$P($P(ENTRY,"^",1),".",2),?13,$E($P(ENTRY,"^",3),1,30),?44 W:$P(ENTRY,"^",4)["PRI" $P(ENTRY,"^",4)
"RTN","PXBDPOV",34,0)
 .I $P(ENTRY,"^",4)["PRI" W ?71,$P(ENTRY,"^",5)
"RTN","PXBDPOV",35,0)
 .E  W ?74,$P(ENTRY,"^",5)
"RTN","PXBDPOV",36,0)
 .D DIS
"RTN","PXBDPOV",37,0)
 ;---Write no entries if none exsist
"RTN","PXBDPOV",38,0)
 I '$D(PXBSAM) D NONE^PXBUTL(3)
"RTN","PXBDPOV",39,0)
 ;-------------UNCOMMENT TO LIST CLINIC POV TO SCREEN-----
"RTN","PXBDPOV",40,0)
 ;D DEF^PXBDPOV("A")
"RTN","PXBDPOV",41,0)
 ;----------------------------------------------------
"RTN","PXBDPOV",42,0)
 D DEF^PXBDPOV("D") I '$D(FIRST) K PXBDPOV
"RTN","PXBDPOV",43,0)
 Q
"RTN","PXBDPOV",44,0)
 ;
"RTN","PXBDPOV",45,0)
 ;
"RTN","PXBDPOV",46,0)
 ;
"RTN","PXBDPOV",47,0)
DPOV4(SIGN) ;--Display the PROVIDER Data
"RTN","PXBDPOV",48,0)
 ;
"RTN","PXBDPOV",49,0)
 ;SIGN=
"RTN","PXBDPOV",50,0)
 ; '+' add 10 to the starting point in ^TMP("PXBDPOV",$J)
"RTN","PXBDPOV",51,0)
 ; '-' subtract 10 from the starting point but not less that 0
"RTN","PXBDPOV",52,0)
 ; 'BEGIN' start at the beginning
"RTN","PXBDPOV",53,0)
 ; 'SAME' start stays where it's at
"RTN","PXBDPOV",54,0)
 ; '3'--any number set start to that number
"RTN","PXBDPOV",55,0)
 ;
"RTN","PXBDPOV",56,0)
 N PXBSTART,PXTMP
"RTN","PXBDPOV",57,0)
 I SIGN="BEGIN" S ^TMP("PXBDPOV",$J,"START")=0,PXBSTART=0
"RTN","PXBDPOV",58,0)
 I SIGN="SAME" S PXBSTART=^TMP("PXBDPOV",$J,"START")
"RTN","PXBDPOV",59,0)
 I SIGN="+" S PXBSTART=($G(^TMP("PXBDPOV",$J,"START"))+(10)) S:PXBSTART'<PXBCNT PXBSTART=(PXBCNT-(10)) S ^TMP("PXBDPOV",$J,"START")=PXBSTART
"RTN","PXBDPOV",60,0)
 I SIGN="-" S PXBSTART=$G(^TMP("PXBDPOV",$J,"START"))-10,^TMP("PXBDPOV",$J,"START")=PXBSTART I PXBSTART<0 S PXBSTART=0 S ^TMP("PXBDPOV",$J,"START")=0
"RTN","PXBDPOV",61,0)
 I +SIGN>0&(SIGN#10) S PXBSTART=$P((SIGN/10),".")*10 S:PXBSTART<10 PXBSTART=0  Q:^TMP("PXBDPOV",$J,"START")=PXBSTART  S ^TMP("PXBDPOV",$J,"START")=PXBSTART
"RTN","PXBDPOV",62,0)
 I +SIGN>0&'(SIGN#10) S PXBSTART=(($P((SIGN/10),".")*10)-10) S:PXBSTART<10 PXBSTART=0 Q:^TMP("PXBDPOV",$J,"START")=PXBSTART  S ^TMP("PXBDPOV",$J,"START")=PXBSTART
"RTN","PXBDPOV",63,0)
 ;
"RTN","PXBDPOV",64,0)
 ;
"RTN","PXBDPOV",65,0)
 I SIGN'="BEGIN" D LOC^PXBCC(3,0) W IOEDEOP
"RTN","PXBDPOV",66,0)
 ;
"RTN","PXBDPOV",67,0)
HEAD4 ;--HEADER ON LIST
"RTN","PXBDPOV",68,0)
 S HEAD="- - E N C O U N T E R  D I A G N O S I S  (ICD9 CODES) - -"
"RTN","PXBDPOV",69,0)
 W !,IOCUU,?(IOM-$L(HEAD))\2,IOINHI,HEAD ;----F  W $C(32) Q:$X=(IOM-(1))
"RTN","PXBDPOV",70,0)
 W IOINLOW,IOELEOL K HEAD
"RTN","PXBDPOV",71,0)
 ;
"RTN","PXBDPOV",72,0)
 N ENTRY,J,K
"RTN","PXBDPOV",73,0)
 D UNDON^PXBCC
"RTN","PXBDPOV",74,0)
 W !,"No.",?5,"ICD",?13,"DESCRIPTION",?64,"PROBLEM LIST"
"RTN","PXBDPOV",75,0)
 W IOEDEOP
"RTN","PXBDPOV",76,0)
 D UNDOFF^PXBCC
"RTN","PXBDPOV",77,0)
 D ARRAY
"RTN","PXBDPOV",78,0)
 ;
"RTN","PXBDPOV",79,0)
 S J=PXBSTART,K=J
"RTN","PXBDPOV",80,0)
 F  S J=$O(@PXTMP@(J)) Q:J=""  Q:K=(PXBSTART+11)  D
"RTN","PXBDPOV",81,0)
 .S ENTRY=$G(@PXTMP@(J,0)),K=K+1
"RTN","PXBDPOV",82,0)
 .I $P(ENTRY,U)=0 D CIA($P(ENTRY,U,2,16)) Q
"RTN","PXBDPOV",83,0)
 .S ENTRY=$P(ENTRY,U,2,15)
"RTN","PXBDPOV",84,0)
 .I $D(PXBNCPT($P(ENTRY,"^",1))) S $P(ENTRY,"^",1)=$P(ENTRY,"^",1)_"*"
"RTN","PXBDPOV",85,0)
 .W !,J+1\2,?4,$J($P($P(ENTRY,"^",1),".",1),4),".",$P($P(ENTRY,"^",1),".",2),?13,$E($P(ENTRY,"^",3),1,30),?44
"RTN","PXBDPOV",86,0)
 .W:$P(ENTRY,"^",4)["PRI" IOINHI,$P(ENTRY,"^",4),IOINLOW
"RTN","PXBDPOV",87,0)
 .W ?$P(ENTRY,"^",4)["PRI"*7+53,$P(ENTRY,"^",7)
"RTN","PXBDPOV",88,0)
 .I $P(ENTRY,"^",4)["PRI" W ?71,$P(ENTRY,"^",5)
"RTN","PXBDPOV",89,0)
 .D DIS
"RTN","PXBDPOV",90,0)
 I SIGN'="BEGIN" W !!
"RTN","PXBDPOV",91,0)
 ;------------UNCOMMENT TO LIST PORVIDERS TO SCREEN--------
"RTN","PXBDPOV",92,0)
 ;D DEF^PXBDPOV("A")
"RTN","PXBDPOV",93,0)
 ;---------------------------------------------------------
"RTN","PXBDPOV",94,0)
 D DEF^PXBDPOV("D") I '$D(FIRST) K PXBDPOV
"RTN","PXBDPOV",95,0)
 Q
"RTN","PXBDPOV",96,0)
 ;
"RTN","PXBDPOV",97,0)
 ;
"RTN","PXBDPOV",98,0)
DEF(CODE) ;---PROCESS DEFAULT LIST OF DIAGNOSIS
"RTN","PXBDPOV",99,0)
 ; I CODE="D" JUST SEND DEFAULT
"RTN","PXBDPOV",100,0)
 ; I CODE="A" JUST SEND THE ARRAY OF PROVIDERS
"RTN","PXBDPOV",101,0)
 D POV^PXBUTL2(CLINIC,3)
"RTN","PXBDPOV",102,0)
 N POV,X,CLNAME,STOP,LIST,NAME,NUMBER
"RTN","PXBDPOV",103,0)
 I '$D(IORC) D TERM^PXBCC
"RTN","PXBDPOV",104,0)
 I '$D(CODE) W !,"SEND PARAMETER = TO 'D'efault OR 'A'rray" Q
"RTN","PXBDPOV",105,0)
 I $G(CODE)="D",$D(PXBPMT("DEF")) S NAME=$O(PXBPMT("DEF",0)) S PXBDPOV=NAME
"RTN","PXBDPOV",106,0)
 I $G(CODE)="A" K PXBPMT("DEF") D
"RTN","PXBDPOV",107,0)
 .S (POV,STOP)="" F  S POV=$O(PXBPMT("POV",POV)) Q:POV=""  Q:STOP=0  D
"RTN","PXBDPOV",108,0)
 ..I '$D(PXBKY(POV)) S STOP=0
"RTN","PXBDPOV",109,0)
 .I STOP="" Q
"RTN","PXBDPOV",110,0)
 .S CLNAME=$P(^SC(CLINIC,0),"^",1)
"RTN","PXBDPOV",111,0)
 .S X="Other ICD CODES associated with "_CLNAME_" clinic."
"RTN","PXBDPOV",112,0)
 .W:PXBCNT<7 ! W !,?(IOM-$L(X))/2,IOINHI,X,IOINLOW K X
"RTN","PXBDPOV",113,0)
 .S (POV,LIST)="" F  S POV=$O(PXBPMT("POV",POV)) Q:POV=""  D
"RTN","PXBDPOV",114,0)
 ..I $D(PXBKY(+POV)) Q
"RTN","PXBDPOV",115,0)
 ..S LIST=LIST_POV_"  " I $L(LIST,"  ")>2 W !,?(IOM-$L(LIST))/2,LIST S LIST=""
"RTN","PXBDPOV",116,0)
 I $G(LIST)]"" W !,?(IOM-$L(LIST))/2,LIST
"RTN","PXBDPOV",117,0)
 Q
"RTN","PXBDPOV",118,0)
 ;
"RTN","PXBDPOV",119,0)
DIS ;----DISPLAY
"RTN","PXBDPOV",120,0)
 Q
"RTN","PXBDPOV",121,0)
 I $D(PXBPMT("POV",$P($P(ENTRY,"^",1),"*"))) W:PXBCNT>11 IORVON W ?37," --Clinic Associated--",IORVOFF
"RTN","PXBDPOV",122,0)
 Q
"RTN","PXBDPOV",123,0)
 ;
"RTN","PXBDPOV",124,0)
CIA(X) ;Clinical Indicator Abbreviations
"RTN","PXBDPOV",125,0)
 N V,I,CI S CI="SC^AO^IR^EC^MST^HNC^CV" W !
"RTN","PXBDPOV",126,0)
 F I=1,7,2:1:6 S V=$P(X,U,I) W:V]"" ?(I*8),$P(CI,U,I),":",$S(V:"Y",1:"N")
"RTN","PXBDPOV",127,0)
 Q
"RTN","PXBDPOV",128,0)
 ;
"RTN","PXBDPOV",129,0)
ARRAY ;Set POV entries into ^TMP("PXBDPOV",$J,"DSP" for display
"RTN","PXBDPOV",130,0)
 N ENTRY,PX124,PXTLNS
"RTN","PXBDPOV",131,0)
 S PXTMP="^TMP(""PXBDPOV"""_","_$J_","_"""DSP"")",(PXTLNS,PX124)=0
"RTN","PXBDPOV",132,0)
 K @PXTMP
"RTN","PXBDPOV",133,0)
 F  S PX124=$O(PXBSAM(PX124)) Q:'PX124  D
"RTN","PXBDPOV",134,0)
 .S PXTLNS=PXTLNS+1,ENTRY=PXBSAM(PX124)
"RTN","PXBDPOV",135,0)
 .S PXBSAM(PX124,"LINE")=PXTLNS
"RTN","PXBDPOV",136,0)
 .S @PXTMP@(PXTLNS,0)=PX124_U_ENTRY
"RTN","PXBDPOV",137,0)
 .S PXTLNS=PXTLNS+1
"RTN","PXBDPOV",138,0)
 .S @PXTMP@(PXTLNS,0)=0_U_PXBSAM(PX124,"I")
"RTN","PXBDPOV",139,0)
 S PXBCNT=PXTLNS
"RTN","PXBDPOV",140,0)
 Q
"RTN","PXBDPOV",141,0)
 ;
"RTN","PXBDREQ")
0^13^B9032260
"RTN","PXBDREQ",1,0)
PXBDREQ ;ISL/JVS - DISPLAY REQUESTS ;6/17/03  10:29
"RTN","PXBDREQ",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,124**;Aug 12, 1996
"RTN","PXBDREQ",3,0)
 ;
"RTN","PXBDREQ",4,0)
 ; Variable list
"RTN","PXBDREQ",5,0)
 ; These two variables represent the data that has been selected
"RTN","PXBDREQ",6,0)
 ;  to be saved in the v files by the user
"RTN","PXBDREQ",7,0)
 ;
"RTN","PXBDREQ",8,0)
 ;  REQ*=PROVIDER^PRIMARY^CPT^QUANTITY^POV^PRIMARY
"RTN","PXBDREQ",9,0)
 ;  REQI=Internal Values
"RTN","PXBDREQ",10,0)
 ;  REQE=External Values
"RTN","PXBDREQ",11,0)
 ;
"RTN","PXBDREQ",12,0)
REQ(NO) ;--Display the REQUESTED Data
"RTN","PXBDREQ",13,0)
 N ENTRY,VAR
"RTN","PXBDREQ",14,0)
 S VAR="N"_NO D @VAR
"RTN","PXBDREQ",15,0)
 Q
"RTN","PXBDREQ",16,0)
N4 ;---Fourth Method--for the CPT promts
"RTN","PXBDREQ",17,0)
 W !,"PROVIDER: ...Enter the provider associated with the CPT'S....."
"RTN","PXBDREQ",18,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",19,0)
 W !,?5,"CPT: "
"RTN","PXBDREQ",20,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",21,0)
 W !
"RTN","PXBDREQ",22,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",23,0)
 Q
"RTN","PXBDREQ",24,0)
N5 ;---Fifth Method--for the PROVIDER prompts
"RTN","PXBDREQ",25,0)
 W !,"PROVIDER: ...Select a Provider....."
"RTN","PXBDREQ",26,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",27,0)
 W !
"RTN","PXBDREQ",28,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",29,0)
 W !
"RTN","PXBDREQ",30,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",31,0)
 Q
"RTN","PXBDREQ",32,0)
 ;
"RTN","PXBDREQ",33,0)
N6 ;---Sixth Method--for the POV(DIAGNOSIS) prompts
"RTN","PXBDREQ",34,0)
 W !,"ICD CODE: ...Select a DIAGNOSIS Code....."
"RTN","PXBDREQ",35,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",36,0)
 W !
"RTN","PXBDREQ",37,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",38,0)
 W !
"RTN","PXBDREQ",39,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",40,0)
 Q
"RTN","PXBDREQ",41,0)
N7 ;---SEVENTH Method--for the STOP CODES prompts
"RTN","PXBDREQ",42,0)
 W !,"STOP CODE: ...Select an AMIS STOP Code....."
"RTN","PXBDREQ",43,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",44,0)
 W !
"RTN","PXBDREQ",45,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",46,0)
 W !
"RTN","PXBDREQ",47,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",48,0)
 Q
"RTN","PXBDREQ",49,0)
N8 ;---EIGHTH Method--for the ENCOUNTERS prompts
"RTN","PXBDREQ",50,0)
 W !,"ENCOUNTERS: ...Select an ENCOUNTER ....."
"RTN","PXBDREQ",51,0)
 D UNDON^PXBCC
"RTN","PXBDREQ",52,0)
 W !
"RTN","PXBDREQ",53,0)
 F  W $C(32) Q:$X=(IOM-(4))
"RTN","PXBDREQ",54,0)
 W !
"RTN","PXBDREQ",55,0)
 D UNDOFF^PXBCC
"RTN","PXBDREQ",56,0)
 Q
"RTN","PXBDREQ",57,0)
 ;
"RTN","PXBDREQ",58,0)
PRINT(NO) ;--Display the requested information
"RTN","PXBDREQ",59,0)
 N ENTRY,VAR
"RTN","PXBDREQ",60,0)
 S VAR="ZP"_NO D @VAR
"RTN","PXBDREQ",61,0)
 Q
"RTN","PXBDREQ",62,0)
ZP1 ;--PROVIDER AND PRIMARY
"RTN","PXBDREQ",63,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",64,0)
 D LOC^PXBCC(1,10) W $P(REQE,"^",1)_"      "_$P(REQE,"^",2),IOELEOL
"RTN","PXBDREQ",65,0)
 Q
"RTN","PXBDREQ",66,0)
ZP2 ;--CPT PROCEDURE AND DESCRIPTION
"RTN","PXBDREQ",67,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",68,0)
 S ENTRY=$P(REQE,"^",3) I ENTRY]"" D RREVH^PXBCC(1,10,ENTRY)
"RTN","PXBDREQ",69,0)
 Q
"RTN","PXBDREQ",70,0)
ZP3 ;--QUANTITY OF PROCEDURES
"RTN","PXBDREQ",71,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",72,0)
 S ENTRY=$P(REQE,"^",4) I ENTRY]"" D RREV^PXBCC(1,45,ENTRY)
"RTN","PXBDREQ",73,0)
 Q
"RTN","PXBDREQ",74,0)
ZP4 ;--DIAGNOSIS
"RTN","PXBDREQ",75,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",76,0)
 D LOC^PXBCC(1,10) W $P(REQE,"^",5)_"      "_$P(REQE,"^",6),IOELEOL
"RTN","PXBDREQ",77,0)
 Q
"RTN","PXBDREQ",78,0)
 ;
"RTN","PXBDREQ",79,0)
ZP5 ;--STOP CODE
"RTN","PXBDREQ",80,0)
 I '$D(REQE) Q
"RTN","PXBDREQ",81,0)
 S ENTRY=$P(REQE,"^",10) I ENTRY]"" D RREV^PXBCC(0,10,ENTRY)
"RTN","PXBDREQ",82,0)
 Q
"RTN","PXBDREQ",83,0)
 ;
"RTN","PXBDREQ",84,0)
ZP6 ;PX124
"RTN","PXBDREQ",85,0)
ZP7 ;
"RTN","PXBDREQ",86,0)
ZP8 ;
"RTN","PXBDREQ",87,0)
ZP9 ;
"RTN","PXBDREQ",88,0)
ZP10 ;
"RTN","PXBDREQ",89,0)
ZP11 ;
"RTN","PXBDREQ",90,0)
ZP12 ;
"RTN","PXBDREQ",91,0)
ZP13 ;
"RTN","PXBDREQ",92,0)
ZP14 ;
"RTN","PXBDREQ",93,0)
ZP15 ;
"RTN","PXBDREQ",94,0)
 I $D(REQE) D LOC^PXBCC(1,0) W "DIAGNOSIS: ",$P(REQE,"^",NO+6),IOELEOL
"RTN","PXBDREQ",95,0)
 Q
"RTN","PXBDREQ",96,0)
 ;               
"RTN","PXBDREQ",97,0)
RSET(CATEGORY) ; Reset the data in the REQ,REQI and REQE variables
"RTN","PXBDREQ",98,0)
 ; CATEGORY IS EQUAL TO FILE NEUMONICS (eg. CPT,POV,PRV)
"RTN","PXBDREQ",99,0)
 D @CATEGORY
"RTN","PXBDREQ",100,0)
 Q
"RTN","PXBDREQ",101,0)
CPT ;CPT CODES
"RTN","PXBDREQ",102,0)
 N PX124
"RTN","PXBDREQ",103,0)
 S $P(REQI,"^",3)="",$P(REQE,"^",3)="",$P(REQI,"^",8)=""
"RTN","PXBDREQ",104,0)
 S $P(REQI,"^",4)="",$P(REQE,"^",4)=""
"RTN","PXBDREQ",105,0)
 F PX124=12:1:22 S $P(REQI,"^",PX124)="",$P(REQE,"^",PX124)=""
"RTN","PXBDREQ",106,0)
 K REQ
"RTN","PXBDREQ",107,0)
 Q
"RTN","PXBDREQ",108,0)
PRV ;PROVIDER
"RTN","PXBDREQ",109,0)
 S $P(REQI,"^",1)="",$P(REQE,"^",1)="",$P(REQI,"^",7)=""
"RTN","PXBDREQ",110,0)
 S $P(REQI,"^",2)="",$P(REQE,"^",2)=""
"RTN","PXBDREQ",111,0)
 Q
"RTN","PXBDREQ",112,0)
POV ;PURPOSE OF VISIT
"RTN","PXBDREQ",113,0)
 S $P(REQI,"^",5)="",$P(REQE,"^",5)="",$P(REQI,"^",9)=""
"RTN","PXBDREQ",114,0)
 S $P(REQI,"^",6)="",$P(REQE,"^",6)=""
"RTN","PXBDREQ",115,0)
 Q
"RTN","PXBDREQ",116,0)
STP ;STOPCODES
"RTN","PXBDREQ",117,0)
 S $P(REQI,"^",10)="",$P(REQE,"^",10)=""
"RTN","PXBDREQ",118,0)
 S $P(REQI,"^",11)="",$P(REQE,"^",11)=""
"RTN","PXBDREQ",119,0)
 Q
"RTN","PXBDREQ",120,0)
 ;
"RTN","PXBGCPT")
0^12^B6773034
"RTN","PXBGCPT",1,0)
PXBGCPT ;ISL/JVS - GATHER CPT ;8/10/04 1:21pm
"RTN","PXBGCPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,149,124**;Aug 12, 1996
"RTN","PXBGCPT",3,0)
 ;
"RTN","PXBGCPT",4,0)
CPT(VISIT) ;--Gather the entries in the V CPT file
"RTN","PXBGCPT",5,0)
 ;
"RTN","PXBGCPT",6,0)
 N IEN,QUANTITY,PROVIDER,NARR,CPT,GROUP,PXBC
"RTN","PXBGCPT",7,0)
 N DIC,DR,DA,DIQ
"RTN","PXBGCPT",8,0)
 N PXSFIL,PXSIEN,PXMOD
"RTN","PXBGCPT",9,0)
 ;
"RTN","PXBGCPT",10,0)
 K ^TMP("PXBU",$J),VAUGHN,CPT,PXBKY,PXBSAM,PXBSKY,PXBPRV
"RTN","PXBGCPT",11,0)
 I $D(^AUPNVCPT("AD",VISIT)) D
"RTN","PXBGCPT",12,0)
 .S IEN=0
"RTN","PXBGCPT",13,0)
 .F  S IEN=$O(^AUPNVCPT("AD",VISIT,IEN)) Q:IEN'>0  D
"RTN","PXBGCPT",14,0)
 ..S ^TMP("PXBU",$J,"CPT",IEN)=""
"RTN","PXBGCPT",15,0)
 ;
"RTN","PXBGCPT",16,0)
A ;--Set array with CPT codes and associated modifiers
"RTN","PXBGCPT",17,0)
 ;
"RTN","PXBGCPT",18,0)
 I $D(^TMP("PXBU",$J,"CPT")) D
"RTN","PXBGCPT",19,0)
 .S IEN=0
"RTN","PXBGCPT",20,0)
 .F  S IEN=$O(^TMP("PXBU",$J,"CPT",IEN)) Q:IEN'>0  D
"RTN","PXBGCPT",21,0)
 ..N VAUGHN,PX124,EDATA
"RTN","PXBGCPT",22,0)
 ..S PX124=".01;.16;1204;.04;1*;1202;.05;.09:.15"
"RTN","PXBGCPT",23,0)
 ..D GETS^DIQ(9000010.18,IEN,PX124,"E","VAUGHN")
"RTN","PXBGCPT",24,0)
 ..S CPT=$G(VAUGHN(9000010.18,IEN_",",".01","E"))
"RTN","PXBGCPT",25,0)
 ..S QUANTITY=$G(VAUGHN(9000010.18,IEN_",",".16","E"))
"RTN","PXBGCPT",26,0)
 ..S PROVIDER=$G(VAUGHN(9000010.18,IEN_",","1204","E"))
"RTN","PXBGCPT",27,0)
 ..S NARR=$E($G(VAUGHN(9000010.18,IEN_",",".04","E")),1,29)
"RTN","PXBGCPT",28,0)
 ..I NARR="" S NARR=$P($$CPT^ICPTCOD(CPT,$G(IDATE)),U,3)
"RTN","PXBGCPT",29,0)
 ..S EDATA=$E($G(VAUGHN(9000010.18,IEN_",",1202,"E")),1,29)
"RTN","PXBGCPT",30,0)
 ..D CASE^PXBUTL
"RTN","PXBGCPT",31,0)
 ..S GROUP=CPT_"^"_QUANTITY_"^"_PROVIDER_"^"_NARR
"RTN","PXBGCPT",32,0)
 ..F PX124=.05,.09,.1,.11,.12,.13,.14,.15 D
"RTN","PXBGCPT",33,0)
 ...S DA=$G(VAUGHN(9000010.18,IEN_",",PX124,"E")),DR=DA,GROUP=GROUP_U_DA
"RTN","PXBGCPT",34,0)
 ...I DA S DR=$$XLATE^PXBGPOV(VISIT,DA),DA=$P(DR,U,2)
"RTN","PXBGCPT",35,0)
 ...I DR S PXBREQ(DA,"I")=$P(DR,U,4,20)
"RTN","PXBGCPT",36,0)
 ..K DR,DA
"RTN","PXBGCPT",37,0)
 ..S $P(GROUP,U,22)=EDATA,CPT(CPT,IEN)=GROUP
"RTN","PXBGCPT",38,0)
 ..S PXSFIL=9000010.181,PXSIEN=""
"RTN","PXBGCPT",39,0)
 ..F  S PXSIEN=$O(VAUGHN(PXSFIL,PXSIEN)) Q:PXSIEN=""  D
"RTN","PXBGCPT",40,0)
 ...S PXMOD=VAUGHN(PXSFIL,PXSIEN,.01,"E")
"RTN","PXBGCPT",41,0)
 ...S CPT(CPT,IEN,"MOD",+PXSIEN)=PXMOD
"RTN","PXBGCPT",42,0)
 ;
"RTN","PXBGCPT",43,0)
B ;--Add line numbers
"RTN","PXBGCPT",44,0)
 ;
"RTN","PXBGCPT",45,0)
 I $D(CPT) D
"RTN","PXBGCPT",46,0)
 .S PXBC=0,CPT=""
"RTN","PXBGCPT",47,0)
 .F  S CPT=$O(CPT(CPT)) Q:CPT=""  D
"RTN","PXBGCPT",48,0)
 ..S IEN=0
"RTN","PXBGCPT",49,0)
 ..F  S IEN=$O(CPT(CPT,IEN)) Q:IEN=""  S PXBC=PXBC+1 D
"RTN","PXBGCPT",50,0)
 ...S PXBKY(CPT,PXBC)=$G(CPT(CPT,IEN))
"RTN","PXBGCPT",51,0)
 ...S PXBSAM(PXBC)=$G(CPT(CPT,IEN))
"RTN","PXBGCPT",52,0)
 ...S PXBSKY(PXBC,IEN)=""
"RTN","PXBGCPT",53,0)
 ...S PXSIEN=0
"RTN","PXBGCPT",54,0)
 ...F  S PXSIEN=$O(CPT(CPT,IEN,"MOD",PXSIEN)) Q:PXSIEN=""  D
"RTN","PXBGCPT",55,0)
 ....S PXBKY(CPT,PXBC,"MOD",PXSIEN)=CPT(CPT,IEN,"MOD",PXSIEN)
"RTN","PXBGCPT",56,0)
 ....S PXBSAM(PXBC,"MOD",PXSIEN)=CPT(CPT,IEN,"MOD",PXSIEN)
"RTN","PXBGCPT",57,0)
 ...I $P($G(CPT(CPT,IEN)),"^",3)]"" D
"RTN","PXBGCPT",58,0)
 ....S PXBPRV($P($G(CPT(CPT,IEN)),"^",3),$P($G(CPT(CPT,IEN)),"^",1),IEN,PXBC)=QUANTITY
"RTN","PXBGCPT",59,0)
EXIT ;--KILL
"RTN","PXBGCPT",60,0)
 K ^TMP("PXBU",$J),VAUGHN
"RTN","PXBGCPT",61,0)
 S PXBCNT=+$G(PXBC)
"RTN","PXBGCPT",62,0)
 Q
"RTN","PXBGCPT",63,0)
 ;
"RTN","PXBGPOV")
0^11^B11193479
"RTN","PXBGPOV",1,0)
PXBGPOV ;ISL/JVS,ESW - GATHER POV (DIAGNOSIS) ;8/10/04 1:30pm
"RTN","PXBGPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,112,149,124**;Aug 12, 1996
"RTN","PXBGPOV",3,0)
 ;
"RTN","PXBGPOV",4,0)
POV(VISIT) ;--Gather the entries in the V POV file
"RTN","PXBGPOV",5,0)
 ;
"RTN","PXBGPOV",6,0)
 N IEN,QUANTITY,PROVIDER,SNARR,POV,GROUP,PXBC,POVI,I,PXCI
"RTN","PXBGPOV",7,0)
 N DIC,DR,DA,DIQ,PRIM,PROBLEM,PXBPLA,PXBPL,PKG,SOURC
"RTN","PXBGPOV",8,0)
 ;
"RTN","PXBGPOV",9,0)
 K ^TMP("PXBU",$J),POV,PXBKY,PXBSAM,PXBSKY,PXDIGNS,NOPLLIST
"RTN","PXBGPOV",10,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PXBGPOV",11,0)
 S FPRI="",PROBLEM=""
"RTN","PXBGPOV",12,0)
 I $D(^AUPNVPOV("AD",VISIT)) D
"RTN","PXBGPOV",13,0)
 .S IEN=0 F  S IEN=$O(^AUPNVPOV("AD",VISIT,IEN)) Q:IEN'>0  D
"RTN","PXBGPOV",14,0)
 ..S ^TMP("PXBU",$J,"POV",IEN)=""
"RTN","PXBGPOV",15,0)
 ;
"RTN","PXBGPOV",16,0)
A ;--Set array with DIAGNOSIS codes
"RTN","PXBGPOV",17,0)
 ;
"RTN","PXBGPOV",18,0)
 D PL^PXBGPL(PATIENT)
"RTN","PXBGPOV",19,0)
 I $D(^TMP("PXBU",$J,"POV")) D
"RTN","PXBGPOV",20,0)
 .S IEN=0 F  S IEN=$O(^TMP("PXBU",$J,"POV",IEN)) Q:IEN'>0  D
"RTN","PXBGPOV",21,0)
 ..S DIC=9000010.07,DR=".01;1204;.04;.12;.17;81202;81203;80001:80007",DA=IEN,DIQ(0)="IE" D EN^DIQ1
"RTN","PXBGPOV",22,0)
 ..S PROVIDER=$G(^UTILITY("DIQ1",$J,9000010.07,DA,"1204","E"))
"RTN","PXBGPOV",23,0)
 ..S LNARR=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".04","E"))
"RTN","PXBGPOV",24,0)
 ..S POV=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".01","E"))
"RTN","PXBGPOV",25,0)
 ..S PROBLEM="" S:$D(^TMP("PXBKYPL",$J,POV)) PROBLEM="YES"
"RTN","PXBGPOV",26,0)
 ..S POVI=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".01","I"))
"RTN","PXBGPOV",27,0)
 ..S PRIM=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".12","E"))
"RTN","PXBGPOV",28,0)
 ..S ORDER=$G(^UTILITY("DIQ1",$J,9000010.07,DA,".17","E"))
"RTN","PXBGPOV",29,0)
 ..S PKG=$G(^UTILITY("DIQ1",$J,9000010.07,DA,"81202","I"))
"RTN","PXBGPOV",30,0)
 ..I PKG']"" S PKG="NONE"
"RTN","PXBGPOV",31,0)
 ..S SOURC=$G(^UTILITY("DIQ1",$J,9000010.07,DA,"81203","I"))
"RTN","PXBGPOV",32,0)
 ..I SOURC']"" S SOURC="NONE"
"RTN","PXBGPOV",33,0)
 ..S SNARR=$P($$ICDDX^ICDCODE(POVI,$G(IDATE)),U,4)
"RTN","PXBGPOV",34,0)
 ..I $L(LNARR)'>30 S LNARR=$$DXNARR^PXUTL1(POVI,$G(IDATE))
"RTN","PXBGPOV",35,0)
 ..S FPRI=FPRI_$E(PRIM,1,3) ;--Creating flag for Primary prompt
"RTN","PXBGPOV",36,0)
 ..S GROUP=POV_"^"_PROVIDER_"^"_SNARR_"^"_PRIM_"^"_PROBLEM_"^"_LNARR_"^"_ORDER
"RTN","PXBGPOV",37,0)
 ..;        1        2            3        4          5          6         7
"RTN","PXBGPOV",38,0)
 ..I PRIM["PRI" S PXDIGNS("PRIMARY")=POV
"RTN","PXBGPOV",39,0)
 ..S ^TMP("PXBPOV",$J,POV,IEN)=GROUP
"RTN","PXBGPOV",40,0)
 ..S ^TMP("PXBGPOVMATCH",$J,POVI,IEN)=""
"RTN","PXBGPOV",41,0)
 ..I $P(GROUP,"^",5)'["YES" S NOPLLIST=1
"RTN","PXBGPOV",42,0)
 ..S GROUP=$G(^UTILITY("DIQ1",$J,9000010.07,IEN,80001,"I"))
"RTN","PXBGPOV",43,0)
 ..F I=2:1:7 S GROUP=GROUP_U_$G(^UTILITY("DIQ1",$J,9000010.07,IEN,80000+I,"I"))
"RTN","PXBGPOV",44,0)
 ..S PXCI(IEN)=GROUP,PXBREQ(POVI,"I")=GROUP
"RTN","PXBGPOV",45,0)
 ;
"RTN","PXBGPOV",46,0)
B ;--Add line numbers
"RTN","PXBGPOV",47,0)
 ;
"RTN","PXBGPOV",48,0)
 I $D(^TMP("PXBPOV",$J)) D
"RTN","PXBGPOV",49,0)
 .S PXBC=0,POV="" F  S POV=$O(^TMP("PXBPOV",$J,POV)) Q:POV=""  Q:PXBC>40  D
"RTN","PXBGPOV",50,0)
 ..S IEN=0 F  S IEN=$O(^TMP("PXBPOV",$J,POV,IEN)) Q:IEN=""  S PXBC=PXBC+1 D
"RTN","PXBGPOV",51,0)
 ...S PXBKY(POV,PXBC)=$G(^TMP("PXBPOV",$J,POV,IEN)),PXBSAM(PXBC)=$G(^TMP("PXBPOV",$J,POV,IEN))
"RTN","PXBGPOV",52,0)
 ...S PXBSKY(PXBC,IEN)=""
"RTN","PXBGPOV",53,0)
 ...S PXBSAM(PXBC,"LNARR")=$P(PXBSAM(PXBC),U,6)
"RTN","PXBGPOV",54,0)
 ...S PXBSAM(PXBC,"I")=PXCI(IEN)
"RTN","PXBGPOV",55,0)
FINISG ;--finish up some variables
"RTN","PXBGPOV",56,0)
 ;--FPRI=0 NO PRIMARY
"RTN","PXBGPOV",57,0)
 S:FPRI'["PRI" FPRI=0 S:FPRI["PRI" FPRI=1
"RTN","PXBGPOV",58,0)
EXIT ;--KILL
"RTN","PXBGPOV",59,0)
 K ^TMP("PXBU",$J),^TMP("PXBKYPL",$J),^TMP("PXBSAMPL",$J),PXBSKYPL
"RTN","PXBGPOV",60,0)
 K ^TMP("PXBPOV",$J),^UTILITY("DIQ1",$J)
"RTN","PXBGPOV",61,0)
 S PXBCNT=+$G(PXBC)
"RTN","PXBGPOV",62,0)
 Q
"RTN","PXBGPOV",63,0)
 ;
"RTN","PXBGPOV",64,0)
XLATE(VST,DX)   ;Translate DX into POV from VST
"RTN","PXBGPOV",65,0)
 Q:'$G(VST)!'$G(DX) ""  Q:'$D(^AUPNVPOV("AD",VST)) ""
"RTN","PXBGPOV",66,0)
 S DX=+$$ICDDX^ICDCODE(DX,+$G(^AUPNVSIT(VST,0))) Q:DX<0 ""
"RTN","PXBGPOV",67,0)
 N IEN,ANS,VAL S (IEN,ANS,VAL)=""
"RTN","PXBGPOV",68,0)
 F  Q:ANS  D
"RTN","PXBGPOV",69,0)
 .S IEN=$O(^AUPNVPOV("AD",VST,IEN)) I 'IEN S ANS=1 Q
"RTN","PXBGPOV",70,0)
 .S VAL=$G(^AUPNVPOV(IEN,0)),ANS=($P(VAL,U)=DX)
"RTN","PXBGPOV",71,0)
 S ANS=IEN_U_DX_U_$P(VAL,U,12) S:IEN ANS=ANS_U_$G(^AUPNVPOV(IEN,800))
"RTN","PXBGPOV",72,0)
 Q ANS
"RTN","PXBGPOV",73,0)
 ;
"RTN","PXBGPOV2")
0^64^B32290278
"RTN","PXBGPOV2",1,0)
PXBGPOV2 ;ISL/JVS - DOUBLE ?? GATHERING OF DIAGNOSES ;8/10/04 1:49pm
"RTN","PXBGPOV2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**1,5,11,136,149,124**;Aug 12, 1996
"RTN","PXBGPOV2",3,0)
 ;
"RTN","PXBGPOV2",4,0)
 W !,"THIS IS NOT AN ENTRY POINT" Q
"RTN","PXBGPOV2",5,0)
DOUBLE(FROM) ;--Entry point
"RTN","PXBGPOV2",6,0)
 ;  WHAT   = The same WHAT as sent in from the API
"RTN","PXBGPOV2",7,0)
 ;  FROM   = Exactly which prompt is asking for the list
"RTN","PXBGPOV2",8,0)
 ;  SCREEN = Same as the DIC("S") screen used by file man
"RTN","PXBGPOV2",9,0)
 ;  START  = The starting point as to what to look up
"RTN","PXBGPOV2",10,0)
 ;
"RTN","PXBGPOV2",11,0)
 N FILE,FIELD,TITLE,HEADING,SUB,CODE,NAME,START,SCREEN,BACK,NUM
"RTN","PXBGPOV2",12,0)
 N SCREEN,TEMP,NRD,FIRST,SUB2
"RTN","PXBGPOV2",13,0)
 S BACK="",NUM=0,SCREEN=""
"RTN","PXBGPOV2",14,0)
 D LOC
"RTN","PXBGPOV2",15,0)
 I $D(DIC("S")) S SCREEN=DIC("S")
"RTN","PXBGPOV2",16,0)
 ;
"RTN","PXBGPOV2",17,0)
 S START="001.0 "
"RTN","PXBGPOV2",18,0)
START ;--RECYCLE POINT
"RTN","PXBGPOV2",19,0)
 S TITLE="ALL DIAGNOSES (ICD9 CODES)"
"RTN","PXBGPOV2",20,0)
 D SETUP
"RTN","PXBGPOV2",21,0)
 D LIST^DIC(FILE,"",FIELD,BACK,10,.START,"","BA",SCREEN,"","^TMP(""PXBTANA"",$J)","^TMP(""PXBTANA"",$J)")
"RTN","PXBGPOV2",22,0)
 D LOC,HEAD,SUB
"RTN","PXBGPOV2",23,0)
 ;
"RTN","PXBGPOV2",24,0)
PROMPT ;---WRITE PROMPT HERE
"RTN","PXBGPOV2",25,0)
 D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBGPOV2",26,0)
 W !!,"Enter '^' to quit,  '-' for previous page."
"RTN","PXBGPOV2",27,0)
 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGPOV2",28,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit,  '-' for previous page."
"RTN","PXBGPOV2",29,0)
 S DIR(0)="N,A,O^0:10:0^I X'?.1""-"".1""^"".2N!(+X>10) K X"
"RTN","PXBGPOV2",30,0)
 D ^DIR
"RTN","PXBGPOV2",31,0)
 I X="-" S BACK="B" D BACK G START
"RTN","PXBGPOV2",32,0)
 I X="" S BACK="" D FORWARD G START
"RTN","PXBGPOV2",33,0)
 I $G(DIRUT) K DIRUT S VAL="^P" G EXIT
"RTN","PXBGPOV2",34,0)
 ;
"RTN","PXBGPOV2",35,0)
FINISH ;--FINISH SETTING A VARIBLE TO SELECTED ITEM
"RTN","PXBGPOV2",36,0)
 S VAL=$G(^TMP("PXBTANA",$J,"DILIST",2,X))_"^"_$G(^TMP("PXBTANA",$J,"DILIST","ID",X,FIRST))_"--"_$G(^TMP("PXBTANA",$J,"DILIST","ID",X,SECOND))
"RTN","PXBGPOV2",37,0)
EXIT ;--EXIT
"RTN","PXBGPOV2",38,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGPOV2",39,0)
 Q VAL
"RTN","PXBGPOV2",40,0)
 ;
"RTN","PXBGPOV2",41,0)
DOUBLE1(FROM) ;--Entry point
"RTN","PXBGPOV2",42,0)
NEW ;
"RTN","PXBGPOV2",43,0)
 N FILE,FIELD,TITLE,HEADING,SUB,CODE,NAME,START,SCREEN,CNT,OK,INDEX,CYCLE
"RTN","PXBGPOV2",44,0)
 N TOTAL,HLP,FIRST,SUB2
"RTN","PXBGPOV2",45,0)
 S BACK="",INDEX="BA"
"RTN","PXBGPOV2",46,0)
 S START=DATA,SUB=0,SUB2=0
"RTN","PXBGPOV2",47,0)
 ;
"RTN","PXBGPOV2",48,0)
START1 ;--RECYCLE POINT
"RTN","PXBGPOV2",49,0)
 W !
"RTN","PXBGPOV2",50,0)
 S TITLE="- - S E L E C T E D  D I A G N O S E S (ICD9 CODES) - -"
"RTN","PXBGPOV2",51,0)
 S FILE=80
"RTN","PXBGPOV2",52,0)
 S FIELD=".01"
"RTN","PXBGPOV2",53,0)
 I DATA?1N S START=DATA*100 S START=$O(^ICD9("BA",START_" ",-1)) S INDEX="BA"
"RTN","PXBGPOV2",54,0)
 I DATA?2N S START=DATA*10 S START=$O(^ICD9("BA",START_" ",-1)) S INDEX="BA"
"RTN","PXBGPOV2",55,0)
 I DATA?3.NP S (START)=DATA-(.99) S START=$O(^ICD9("BA",START_" ",-1)) S INDEX="BA"
"RTN","PXBGPOV2",56,0)
 I DATA?1A.NP S START=$O(^ICD9("BA",START_" ",-1)) S INDEX="BA"
"RTN","PXBGPOV2",57,0)
 I DATA?2AP S HLP=1
"RTN","PXBGPOV2",58,0)
 I DATA?3.AP S START=$O(^ICD9("D",DATA),-1),INDEX="D"
"RTN","PXBGPOV2",59,0)
 I DATA?1A!(DATA?1.2N) D WAIT^DICD
"RTN","PXBGPOV2",60,0)
 ;
"RTN","PXBGPOV2",61,0)
 D LIST^DIC(FILE,"",FIELD,BACK,"",.START,DATA,INDEX,DIC("S"),"","^TMP(""PXBTOTAL"",$J)","^TMP(""PXBTOTAL"",$J)")
"RTN","PXBGPOV2",62,0)
 ;
"RTN","PXBGPOV2",63,0)
FILTER ;--FILTER OUT DUPLICATES
"RTN","PXBGPOV2",64,0)
 N I,DXINF S I=0 F  S I=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",I)) Q:I=""  D
"RTN","PXBGPOV2",65,0)
 .S DXINF=$$DXNARR^PXUTL1(^TMP("PXBTOTAL",$J,"DILIST","ID",I,.01),$G(IDATE))
"RTN","PXBGPOV2",66,0)
 .I DXINF'="" S ^TMP("PXBOTAL",$J,$G(^TMP("PXBTOTAL",$J,"DILIST","ID",I,.01)),$E(DXINF,1,59)_" ",$G(^TMP("PXBTOTAL",$J,"DILIST",2,I))_" ")=""
"RTN","PXBGPOV2",67,0)
 K ^TMP("PXBTOTAL",$J)
"RTN","PXBGPOV2",68,0)
 N I,J,K,C S (I,J,K,C)="" F  S I=$O(^TMP("PXBOTAL",$J,I)) Q:I=""  D
"RTN","PXBGPOV2",69,0)
 .S C=C+1
"RTN","PXBGPOV2",70,0)
 .S J=$O(^TMP("PXBOTAL",$J,I,0))
"RTN","PXBGPOV2",71,0)
 .S K=$O(^TMP("PXBOTAL",$J,I,J,0))
"RTN","PXBGPOV2",72,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST","ID",C,.01)=I
"RTN","PXBGPOV2",73,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST","ID",C,10)=J
"RTN","PXBGPOV2",74,0)
 .S ^TMP("PXBTOTAL",$J,"DILIST",2,C)=K
"RTN","PXBGPOV2",75,0)
 S ^TMP("PXBTOTAL",$J,"DILIST",0)=C
"RTN","PXBGPOV2",76,0)
 K ^TMP("PXBOTAL",$J)
"RTN","PXBGPOV2",77,0)
 ;
"RTN","PXBGPOV2",78,0)
 S TOTAL=$P($G(^TMP("PXBTOTAL",$J,"DILIST",0)),"^",1)
"RTN","PXBGPOV2",79,0)
 ;
"RTN","PXBGPOV2",80,0)
 ;--DISPLAY IF NO MATCH FOUND
"RTN","PXBGPOV2",81,0)
 I TOTAL<1 D
"RTN","PXBGPOV2",82,0)
 .W IOEDEOP
"RTN","PXBGPOV2",83,0)
 .I '$G(HLP) W ! D HELP^PXBUTL0("CPTM")
"RTN","PXBGPOV2",84,0)
 .I $G(HLP) S RESULTS="USE AT LEAST THE 3 CHARACETERS" W !,IOCUU,?(IOM-$L(RESULTS))\2,RESULTS
"RTN","PXBGPOV2",85,0)
 .S ERROR=1,CYCL=1
"RTN","PXBGPOV2",86,0)
 I TOTAL<1 Q TOTAL
"RTN","PXBGPOV2",87,0)
 ;
"RTN","PXBGPOV2",88,0)
 ;----DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV2",89,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?15,""DESCRIPTION    "",IOINHI,TOTAL,"" MATCHES"",IOINLOW"
"RTN","PXBGPOV2",90,0)
LIST ;-DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV2",91,0)
 I TOTAL=1 S X=1 G VAL
"RTN","PXBGPOV2",92,0)
 D LOC W !
"RTN","PXBGPOV2",93,0)
 X HEADING
"RTN","PXBGPOV2",94,0)
 S SUB=SUB-1
"RTN","PXBGPOV2",95,0)
 S NUM=0 F  S SUB=$O(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB)) S NUM=NUM+1 Q:NUM=11  Q:SUB'>0  S SUB2=SUB2+1 D
"RTN","PXBGPOV2",96,0)
 .S CODE=$G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,.01))
"RTN","PXBGPOV2",97,0)
 .S NAME=$E($G(^TMP("PXBTOTAL",$J,"DILIST","ID",SUB,10)),1,64)
"RTN","PXBGPOV2",98,0)
 .W !,SUB,?6,CODE,?15,NAME
"RTN","PXBGPOV2",99,0)
 ;
"RTN","PXBGPOV2",100,0)
 ;----If There is only one selection go to proper prompting
"RTN","PXBGPOV2",101,0)
 I TOTAL=1 G PRMPT2
"RTN","PXBGPOV2",102,0)
 ;
"RTN","PXBGPOV2",103,0)
PRMPT ;---WRITE PROMPT HERE
"RTN","PXBGPOV2",104,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPOV2",105,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPOV2",106,0)
 W !
"RTN","PXBGPOV2",107,0)
 I SUB>0 W !,"Enter '^' to quit"
"RTN","PXBGPOV2",108,0)
 E  I TOTAL>10 W !,"               END OF LIST"
"RTN","PXBGPOV2",109,0)
 I SUB>0 S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to continue: "
"RTN","PXBGPOV2",110,0)
 E  S DIR("A")="Select a single 'ITEM NUMBER' or 'RETURN' to exit: "
"RTN","PXBGPOV2",111,0)
 S DIR("?")="Enter ITEM 'No' to select , '^' to quit"
"RTN","PXBGPOV2",112,0)
 S DIR(0)="N,A,O^0:"_SUB2_":0^I X'?.1""^"".N K X"
"RTN","PXBGPOV2",113,0)
 D ^DIR
"RTN","PXBGPOV2",114,0)
 I X="",SUB>0 G LIST
"RTN","PXBGPOV2",115,0)
 I X="",SUB'>0 S X="^"
"RTN","PXBGPOV2",116,0)
VAL ;-----Set the VAL equal to the value
"RTN","PXBGPOV2",117,0)
 S VAL=$G(^TMP("PXBTOTAL",$J,"DILIST",2,X))_"^"_$G(^TMP("PXBTOTAL",$J,"DILIST","ID",X,.01))
"RTN","PXBGPOV2",118,0)
EXITNEW ;--EXIT
"RTN","PXBGPOV2",119,0)
 K DIR,^TMP("PXBTANA",$J),^TMP("PXBTOTAL",$J)
"RTN","PXBGPOV2",120,0)
 K TANA,TOTAL
"RTN","PXBGPOV2",121,0)
 Q VAL
"RTN","PXBGPOV2",122,0)
 Q
"RTN","PXBGPOV2",123,0)
 ;
"RTN","PXBGPOV2",124,0)
 ;---SUBROUTINES
"RTN","PXBGPOV2",125,0)
BACK ;
"RTN","PXBGPOV2",126,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,1))
"RTN","PXBGPOV2",127,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,1))
"RTN","PXBGPOV2",128,0)
 Q
"RTN","PXBGPOV2",129,0)
FORWARD ;
"RTN","PXBGPOV2",130,0)
 S START=$G(^TMP("PXBTANA",$J,"DILIST",1,10))
"RTN","PXBGPOV2",131,0)
 S START("IEN")=$G(^TMP("PXBTANA",$J,"DILIST",2,10))
"RTN","PXBGPOV2",132,0)
 Q
"RTN","PXBGPOV2",133,0)
LOC ;--LOCATE CURSOR
"RTN","PXBGPOV2",134,0)
 D LOC^PXBCC(3,1) ;--LOCATE THE CURSOR
"RTN","PXBGPOV2",135,0)
 W IOEDEOP ;--CLEAR THE PAGE
"RTN","PXBGPOV2",136,0)
 Q
"RTN","PXBGPOV2",137,0)
HEAD ;--HEAD
"RTN","PXBGPOV2",138,0)
 W !,IOCUU,IOBON,"HELP SCREEN",IOSGR0,?(IOM-$L(TITLE))\2,IOINHI,TITLE,IOINLOW,IOELEOL
"RTN","PXBGPOV2",139,0)
 Q
"RTN","PXBGPOV2",140,0)
SUB ;--DISPLAY LIST TO THE SCREEN
"RTN","PXBGPOV2",141,0)
 I $P(^TMP("PXBTANA",$J,"DILIST",0),"^",1)=0 W !!,"     E N D  O F  L I S T" Q
"RTN","PXBGPOV2",142,0)
 X HEADING
"RTN","PXBGPOV2",143,0)
 S SUB=0,CNT=0 F  S SUB=$O(^TMP("PXBTANA",$J,"DILIST","ID",SUB)) Q:SUB'>0  S CNT=CNT+1 D
"RTN","PXBGPOV2",144,0)
 .S CODE=$G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,FIRST))
"RTN","PXBGPOV2",145,0)
 .S NAME=$E($G(^TMP("PXBTANA",$J,"DILIST","ID",SUB,SECOND)),1,64)
"RTN","PXBGPOV2",146,0)
 .W !,SUB,?6,CODE,?15,NAME
"RTN","PXBGPOV2",147,0)
 Q
"RTN","PXBGPOV2",148,0)
SETUP ;-SETP VARIABLES
"RTN","PXBGPOV2",149,0)
 S FILE=80,FIRST=.01,SECOND=10
"RTN","PXBGPOV2",150,0)
 S FIELD=FIRST_";"_SECOND
"RTN","PXBGPOV2",151,0)
 S HEADING="W !,""ITEM"",?6,""CODE"",?15,""DESCRIPTION"""
"RTN","PXBGPOV2",152,0)
 Q
"RTN","PXBGPOV2",153,0)
PRMPT2 ;-----Yes and No prompt if onlyi choice
"RTN","PXBGPOV2",154,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBGPOV2",155,0)
 D LOC^PXBCC(15,1)
"RTN","PXBGPOV2",156,0)
 S DIR("A")="Is this the correct entry "
"RTN","PXBGPOV2",157,0)
 S DIR("B")="YES"
"RTN","PXBGPOV2",158,0)
 S DIR(0)="Y"
"RTN","PXBGPOV2",159,0)
 D ^DIR
"RTN","PXBGPOV2",160,0)
 I Y=0 S X="^"
"RTN","PXBGPOV2",161,0)
 I Y=1 S X=1
"RTN","PXBGPOV2",162,0)
 G VAL
"RTN","PXBHLP2")
0^9^B17351171
"RTN","PXBHLP2",1,0)
PXBHLP2 ;ISL/JVS - FIRST HELP ROUITINE FOR PROVIDERS ;6/17/03  10:29
"RTN","PXBHLP2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Aug 12, 1996
"RTN","PXBHLP2",3,0)
 ;
"RTN","PXBHLP2",4,0)
 ;
"RTN","PXBHLP2",5,0)
 ;
"RTN","PXBHLP2",6,0)
 ; If you edit the text besure to change the length nest to the TAG
"RTN","PXBHLP2",7,0)
 ;   eg===  ;;4
"RTN","PXBHLP2",8,0)
 ;  you can put a line feed '!' at the end of the last line if necess.
"RTN","PXBHLP2",9,0)
 ;
"RTN","PXBHLP2",10,0)
 ;
"RTN","PXBHLP2",11,0)
 W !,"THIS IS NOT AN ENTRY POINT " Q
"RTN","PXBHLP2",12,0)
INTRO ;;6
"RTN","PXBHLP2",13,0)
 W !,"Enter a PROVIDER associated with this patient ENCOUNTER."
"RTN","PXBHLP2",14,0)
 W !,"You can enter partial names to receive a short list."
"RTN","PXBHLP2",15,0)
 W !,"Above is a list of PROVIDERS already entered. If there are any"
"RTN","PXBHLP2",16,0)
 W !,"additional ones, they should be entered at this time."
"RTN","PXBHLP2",17,0)
 W !," * indicates that the entry has been visited during this session."
"RTN","PXBHLP2",18,0)
 I $G(WHAT)="INTV" W !,"a '^^' (double up arrow) will take you out of the interview"
"RTN","PXBHLP2",19,0)
 W !,"For more detailed ",IOINHI,"HELP",IOINLOW," and selection lists enter ",IOINHI,"??",IOINLOW,!
"RTN","PXBHLP2",20,0)
 Q
"RTN","PXBHLP2",21,0)
INTRO2 ;;6
"RTN","PXBHLP2",22,0)
 W !,"Enter an ORDERING PROVIDER associated with this PROCEDURE."
"RTN","PXBHLP2",23,0)
 W !,"You can enter partial names to receive a short list."
"RTN","PXBHLP2",24,0)
 W !,"Above is a list of PROVIDERS already entered. If there are any"
"RTN","PXBHLP2",25,0)
 W !,"additional ones, they should be entered at this time."
"RTN","PXBHLP2",26,0)
 W !," * indicates that the entry has been visited during this session."
"RTN","PXBHLP2",27,0)
 I $G(WHAT)="INTV" W !,"a '^^' (double up arrow) will take you out of the interview"
"RTN","PXBHLP2",28,0)
 W !,"For more detailed ",IOINHI,"HELP",IOINLOW," and selection lists enter ",IOINHI,"??",IOINLOW,!
"RTN","PXBHLP2",29,0)
 Q
"RTN","PXBHLP2",30,0)
BODY ;;11
"RTN","PXBHLP2",31,0)
 W !,"To receive detailed help for ",IOINHI,"ADD",IOINLOW," or ",IOINHI,"DELETE",IOINLOW," enter the following:"
"RTN","PXBHLP2",32,0)
 W !
"RTN","PXBHLP2",33,0)
 W !,"  ",IOINHI,"A",IOINLOW,"   to get help on how to ADD providers."
"RTN","PXBHLP2",34,0)
 W !,"  ",IOINHI,"D",IOINLOW,"   to get help on how to DELETE providers."
"RTN","PXBHLP2",35,0)
 W !,"  ",IOINHI,"E",IOINLOW,"   to get help on how to EDIT providers."
"RTN","PXBHLP2",36,0)
 W !
"RTN","PXBHLP2",37,0)
 W !,"To receive more ",IOINHI,"SELECTION LISTS",IOINLOW," enter the following:"
"RTN","PXBHLP2",38,0)
 W !
"RTN","PXBHLP2",39,0)
 W !,"  ",IOINHI,"1",IOINLOW,"   to get a list of ALL active providers."
"RTN","PXBHLP2",40,0)
 W !,"  ",IOINHI,"2",IOINLOW,"   to get a list of CLINIC providers."
"RTN","PXBHLP2",41,0)
 W !,"  ",IOINHI,"3",IOINLOW,"   to get a list of ENCOUNTER FORM providers."
"RTN","PXBHLP2",42,0)
 Q
"RTN","PXBHLP2",43,0)
A ;;3
"RTN","PXBHLP2",44,0)
 W !,"To ",IOINHI,"ADD",IOINLOW," a PROVIDER enter one of the following:"
"RTN","PXBHLP2",45,0)
 W !,"  PROVIDER NAME (eg. SMITH,VAUGHN)"
"RTN","PXBHLP2",46,0)
 W !,"  PARTIAL LAST NAME of the PROVIDER (eg. SM or SMITH)"
"RTN","PXBHLP2",47,0)
 Q
"RTN","PXBHLP2",48,0)
E ;;9
"RTN","PXBHLP2",49,0)
 W !,"To ",IOINHI,"EDIT",IOINLOW," a PROVIDER enter one of the following:"
"RTN","PXBHLP2",50,0)
 W !,"  PROVIDER NAME (eg. SMITH,VAUGHN)"
"RTN","PXBHLP2",51,0)
 W !,"  ITEM NUMBER on the left side of the list of the PROVIDERS (eg. 7)"
"RTN","PXBHLP2",52,0)
 W !
"RTN","PXBHLP2",53,0)
 W !,"To move the PRIMARY designation from one provider to another do the following:"
"RTN","PXBHLP2",54,0)
 W !,"  select the current primary provider"
"RTN","PXBHLP2",55,0)
 W !,"  answer NO to the primary provider prompt"
"RTN","PXBHLP2",56,0)
 W !,"  select the new primary provider"
"RTN","PXBHLP2",57,0)
 W !,"  answer YES to the primary provider prompt"
"RTN","PXBHLP2",58,0)
 Q
"RTN","PXBHLP2",59,0)
D ;;3
"RTN","PXBHLP2",60,0)
 W !,"To ",IOINHI,"DELETE",IOINLOW," a PROVIDER enter one of the following:"
"RTN","PXBHLP2",61,0)
 W !,"  an '@' followed by the ITEM NUMBER (eg. @1 or @3)"
"RTN","PXBHLP2",62,0)
 W !,"  Multiple ITEM NUMBERS can be selected (eg. @1,3,5 or @1-3,6,9)"
"RTN","PXBHLP2",63,0)
 Q
"RTN","PXBHLP2",64,0)
PROMPT ;---Prompt for the help prompt
"RTN","PXBHLP2",65,0)
 N DIR,OK,POSS
"RTN","PXBHLP2",66,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBHLP2",67,0)
 W !!,"Enter '^' to leave HELP CENTER"
"RTN","PXBHLP2",68,0)
 W !,"Enter a letter or number for additional help: "
"RTN","PXBHLP2",69,0)
 R Y:DTIME
"RTN","PXBHLP2",70,0)
 S POSS="aAdDeE123^" I POSS[Y,$L(Y)=1!(Y="") S TAG=Y
"RTN","PXBHLP2",71,0)
 S TAG=$TR(TAG,"aed","AED")
"RTN","PXBHLP2",72,0)
 I POSS'[Y!($L(Y)>1) S TAG="BODY"
"RTN","PXBHLP2",73,0)
 ;
"RTN","PXBHLP2",74,0)
 ;
"RTN","PXBHLP2",75,0)
 Q
"RTN","PXBHLP2",76,0)
ROUTINE ;---routine excuted when SELECTION LISTS are selected
"RTN","PXBHLP2",77,0)
 ;W !,"ROUTINES FOR SELECTION LISTS"
"RTN","PXBHLP2",78,0)
1 ;;10
"RTN","PXBHLP2",79,0)
 S (Y,DATA,EDATA,UDATA)=$P($$DOUBLE^PXBGPRV2(WHAT),"^",2)
"RTN","PXBHLP2",80,0)
 Q
"RTN","PXBHLP2",81,0)
2 ;;10
"RTN","PXBHLP2",82,0)
 S (Y,DATA,EDATA,UDATA)=$P($$DOUBLE1^PXBGPRV3(WHAT),"^",2)
"RTN","PXBHLP2",83,0)
 Q
"RTN","PXBHLP2",84,0)
3 ;;10
"RTN","PXBHLP2",85,0)
 S (Y,DATA,EDATA,UDATA)=$P($$DOUBLE1^PXBGPRV4(WHAT),"^",2)
"RTN","PXBHLP2",86,0)
 Q
"RTN","PXBHLPR")
0^10^B1647879
"RTN","PXBHLPR",1,0)
PXBHLPR ;ISL/JVS - ROUTINE NAMES FOR HELP MESSAGES ;6/17/03  10:29
"RTN","PXBHLPR",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Aug 12, 1996
"RTN","PXBHLPR",3,0)
 ;
"RTN","PXBHLPR",4,0)
 ;
"RTN","PXBHLPR",5,0)
 ;
"RTN","PXBHLPR",6,0)
 Q
"RTN","PXBHLPR",7,0)
 ;  This routine contains the name of the routines in which
"RTN","PXBHLPR",8,0)
 ;the HELP frames and the PROMPTS ARE STORED.
"RTN","PXBHLPR",9,0)
 ;
"RTN","PXBHLPR",10,0)
 ;  The line tags are the PACK variable and the SUBJ variable
"RTN","PXBHLPR",11,0)
 ;combined together
"RTN","PXBHLPR",12,0)
 ;
"RTN","PXBHLPR",13,0)
 ; ~PIECE 1   - The body of the Introduction
"RTN","PXBHLPR",14,0)
 ; ~PIECE 2   - The body of the extended help
"RTN","PXBHLPR",15,0)
 ; ~PIECE 3   - The routine with the dir call for prompting
"RTN","PXBHLPR",16,0)
 ; ~PIECE 4   - The routines for gathering the selecion list 
"RTN","PXBHLPR",17,0)
 ;
"RTN","PXBHLPR",18,0)
EN1 ; -- The main entry point
"RTN","PXBHLPR",19,0)
 S PXBREC=""
"RTN","PXBHLPR",20,0)
 S PXBREC=$P($T(@PXBNOD),";;",2)
"RTN","PXBHLPR",21,0)
 ;
"RTN","PXBHLPR",22,0)
 Q
"RTN","PXBHLPR",23,0)
 ;
"RTN","PXBHLPR",24,0)
PXBSTP ;;INTRO^PXBHLP1~BODY^PXBHLP1~PROMPT^PXBHLP1~ROUTINE^PXBHLP1
"RTN","PXBHLPR",25,0)
PXBPRV ;;INTRO^PXBHLP2~BODY^PXBHLP2~PROMPT^PXBHLP2~ROUTINE^PXBHLP2
"RTN","PXBHLPR",26,0)
PXBORD ;;INTRO2^PXBHLP2~BODY^PXBHLP2~PROMPT^PXBHLP2~ROUTINE^PXBHLP2
"RTN","PXBHLPR",27,0)
PXBPOV ;;INTRO^PXBHLP3~BODY^PXBHLP3~PROMPT^PXBHLP3~ROUTINE^PXBHLP3
"RTN","PXBHLPR",28,0)
PXBCPT ;;INTRO^PXBHLP4~BODY^PXBHLP4~PROMPT^PXBHLP4~ROUTINE^PXBHLP4
"RTN","PXBHLPR",29,0)
 Q
"RTN","PXBMCPT2")
0^8^B16601699
"RTN","PXBMCPT2",1,0)
PXBMCPT2 ;ISL/JVS,ESW - MAIN ROUTINE CPT CODES ;3/22/05 9:22am
"RTN","PXBMCPT2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,88,89,108,124**;Aug 12, 1996
"RTN","PXBMCPT2",3,0)
 ;
"RTN","PXBMCPT2",4,0)
 W !,"This is not the entry into this routine" Q
"RTN","PXBMCPT2",5,0)
 ;
"RTN","PXBMCPT2",6,0)
 ;  VARABLE LIST
"RTN","PXBMCPT2",7,0)
 ;
"RTN","PXBMCPT2",8,0)
 ;
"RTN","PXBMCPT2",9,0)
CPT(PXBVST) ;---Real entry point
"RTN","PXBMCPT2",10,0)
 Q:'$D(^AUPNVSIT(PXBVST))
"RTN","PXBMCPT2",11,0)
 S TEST=1
"RTN","PXBMCPT2",12,0)
 ; PXBVST  = Appiontment-Encounter Visit IEN
"RTN","PXBMCPT2",13,0)
 ; PXBDPRV = Default Provider for clinic appointment IEN
"RTN","PXBMCPT2",14,0)
 ;--Set up
"RTN","PXBMCPT2",15,0)
 N PXBSKY,PXBKY,PXBSAM,PRVDR,FPRI ;108
"RTN","PXBMCPT2",16,0)
 N PXBCNT,I,J,IDATE,PRIP,PRIPOV,PRISEC,QUA,VISIT,PRI,POV,PRV,PXBENT,SAVE
"RTN","PXBMCPT2",17,0)
 N PXBUT,FPRI,ENTRY,PXBSAVE,NAME,VAR,DOUBLEQQ,CPTQUA,PXBPRV,ERROR
"RTN","PXBMCPT2",18,0)
 N REQI,REQE,DEL,COM,FROM,NOREV,PX124,PXCEAFTR,PXCEVIEN
"RTN","PXBMCPT2",19,0)
 N DATA,PROMPT,FIRSTCPT,KFIRST,FROM,IDATE,%,CYCL,PXBDXPRI
"RTN","PXBMCPT2",20,0)
 N PXBNCPT,PXBNPRV,PXBNPOV,FIRST,PXBWIN,CLINIC
"RTN","PXBMCPT2",21,0)
 N PXBPMT,LEAVE,PATIENT,PXMODSTR,PXMDCNT,PXNEWIEN,PXMREQ,PXTLNS
"RTN","PXBMCPT2",22,0)
 S (REQE,REQI)=""
"RTN","PXBMCPT2",23,0)
 S CLINIC=$P(^AUPNVSIT(PXBVST,0),"^",22),PROMPT="CPT"
"RTN","PXBMCPT2",24,0)
 ;--KILL OF THE TMP GLOGALS IN ALL PROMPTS
"RTN","PXBMCPT2",25,0)
 S ^TMP("PXBDCPT",$J,"START")=0,FIRST=1,FIRSTCPT=1,PXBEXIT=1
"RTN","PXBMCPT2",26,0)
 ;
"RTN","PXBMCPT2",27,0)
TEST3 ;---THIRD SERERIO FOR PROMPTING FOR CPT'S
"RTN","PXBMCPT2",28,0)
 I $G(DOUBLEQQ) S FIRST=1
"RTN","PXBMCPT2",29,0)
 D TERM^PXBCC
"RTN","PXBMCPT2",30,0)
TEST3C ;--Display the CPT codes
"RTN","PXBMCPT2",31,0)
 D HEADER
"RTN","PXBMCPT2",32,0)
 ;---ADDED 11/4/96
"RTN","PXBMCPT2",33,0)
 D RSET^PXBDREQ("PRV")
"RTN","PXBMCPT2",34,0)
 ;------END--------
"RTN","PXBMCPT2",35,0)
R2 K ERROR,PXMODSTR
"RTN","PXBMCPT2",36,0)
 S (PXNEWIEN,PXMREQ)=""
"RTN","PXBMCPT2",37,0)
 D CPT^PXBPCPT G:$G(PXBEXIT)<1 CPTXIT G:$G(ERROR) R2 W IOEDEOP
"RTN","PXBMCPT2",38,0)
 I DATA["^C" D RSET^PXBDREQ("CPT") K PXMREQ G TEST3C
"RTN","PXBMCPT2",39,0)
 I DATA=""!(DATA["^") D RSET^PXBDREQ("CPT") K DIRUT,PXBUT,PXMREQ G CPTXIT
"RTN","PXBMCPT2",40,0)
 ;
"RTN","PXBMCPT2",41,0)
 ;--Display the requested CPT code
"RTN","PXBMCPT2",42,0)
 D PRINT^PXBDREQ(2)
"RTN","PXBMCPT2",43,0)
 ;
"RTN","PXBMCPT2",44,0)
 ;--Prompt for CPT Modifiers
"RTN","PXBMCPT2",45,0)
 D FULL0^PXBCC
"RTN","PXBMCPT2",46,0)
 S PXNEWIEN=""
"RTN","PXBMCPT2",47,0)
 S PXMDCNT=$$CODM^ICPTCOD($P(REQI,"^",3),"^TMP(""PXMODARR"",$J",PXBSOURC,PXBVSTDT)
"RTN","PXBMCPT2",48,0)
 K ^TMP("PXMODARR",$J)
"RTN","PXBMCPT2",49,0)
 D MOD^PXBPMOD(PXBVST,PXBPAT,$P(REQI,"^",3),$G(PXMODSTR),$P(REQI,"^",8),IDATE,PXMDCNT,.PXMREQ)
"RTN","PXBMCPT2",50,0)
 I DATA["^C" D RSET^PXBDREQ("CPT") K PXMREQ G TEST3
"RTN","PXBMCPT2",51,0)
 I PXNEWIEN]"" S PXBNCPT($P(REQI,"^",3),PXNEWIEN)=""
"RTN","PXBMCPT2",52,0)
 ;
"RTN","PXBMCPT2",53,0)
TEST3Q ;--Prompt of the QUANTITY of the CPT code
"RTN","PXBMCPT2",54,0)
 S DEL=0
"RTN","PXBMCPT2",55,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMCPT2",56,0)
 D QUA^PXBPQUA S PROMPT="CPT"
"RTN","PXBMCPT2",57,0)
 I EDATA["^C" D  G TEST3
"RTN","PXBMCPT2",58,0)
 .I PXNEWIEN]"" D REMOVE^PXCEVFIL(PXNEWIEN)
"RTN","PXBMCPT2",59,0)
 .D RSET^PXBDREQ("CPT") K PXMREQ
"RTN","PXBMCPT2",60,0)
 ;
"RTN","PXBMCPT2",61,0)
 ;--Create The ^TMP("PXK", ARRAY
"RTN","PXBMCPT2",62,0)
 S COM="0@" I COM[$P(REQI,"^",4) D
"RTN","PXBMCPT2",63,0)
 .D EN0^PXBSTOR(PXBVST,PATIENT,REQI,.PXMREQ)
"RTN","PXBMCPT2",64,0)
 .D EN1^PXKMAIN
"RTN","PXBMCPT2",65,0)
 .S DEL=1
"RTN","PXBMCPT2",66,0)
 ;--File the data into the V files
"RTN","PXBMCPT2",67,0)
 I $G(DEL)=1 D  G TEST3C
"RTN","PXBMCPT2",68,0)
 .I PXNEWIEN]"" D REMOVE^PXCEVFIL(PXNEWIEN)
"RTN","PXBMCPT2",69,0)
 ;
"RTN","PXBMCPT2",70,0)
TEST3P ;--GET PROVIDER
"RTN","PXBMCPT2",71,0)
 D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI) W IOSC
"RTN","PXBMCPT2",72,0)
 S FROM="CPT" D PRV^PXBPPRV I DATA["^P" D  W IOCUU G TEST3P
"RTN","PXBMCPT2",73,0)
 .S $P(REQI,"^",1)="",$P(REQI,"^",2)="",$P(REQI,"^",7)=""
"RTN","PXBMCPT2",74,0)
 .K PXBDPRV
"RTN","PXBMCPT2",75,0)
TEST3O ;ORDERING PROVIDER - PX124
"RTN","PXBMCPT2",76,0)
 D ORD^PXBPORD
"RTN","PXBMCPT2",77,0)
 I DATA["^O" D  W IOCUU G TEST3O
"RTN","PXBMCPT2",78,0)
 .S $P(REQI,U,22)=""
"RTN","PXBMCPT2",79,0)
TEST3D ;UP TO 8 DIAGNOSES - PX124
"RTN","PXBMCPT2",80,0)
 S (PXBDXPRI,PX124)="",DATA=1
"RTN","PXBMCPT2",81,0)
 F  S PX124=$O(^AUPNVPOV("AD",PXBVST,PX124)) Q:'PX124!PXBDXPRI  D
"RTN","PXBMCPT2",82,0)
 .I $P(^AUPNVPOV(PX124,0),U,12)="P" S PXBDXPRI=$P(^(0),U,1)
"RTN","PXBMCPT2",83,0)
 F PX124=1:1:8 Q:DATA=""!(DATA["^")&$$MORE(PX124)  D DX(PX124)
"RTN","PXBMCPT2",84,0)
 ;
"RTN","PXBMCPT2",85,0)
STORE ;SAVE IN V FILES
"RTN","PXBMCPT2",86,0)
 D EN0^PXBSTOR(PXBVST,PATIENT,REQI,.PXMREQ)
"RTN","PXBMCPT2",87,0)
 D EN1^PXKMAIN
"RTN","PXBMCPT2",88,0)
 D RSET^PXBDREQ("CPT") ;--RSET^PXBDREQ("PRV")
"RTN","PXBMCPT2",89,0)
 K PXMREQ
"RTN","PXBMCPT2",90,0)
 S $P(REQI,"^",7)=""
"RTN","PXBMCPT2",91,0)
 G TEST3C
"RTN","PXBMCPT2",92,0)
 ;
"RTN","PXBMCPT2",93,0)
HEADER ;--Display header and list CPT codes and associated modifiers
"RTN","PXBMCPT2",94,0)
 D HDR^PXBUTL(PXBVST,1)
"RTN","PXBMCPT2",95,0)
 D REQ^PXBDREQ(4)
"RTN","PXBMCPT2",96,0)
 D LOC^PXBCC(3,1)
"RTN","PXBMCPT2",97,0)
 W IOEDEOP
"RTN","PXBMCPT2",98,0)
 D CPT^PXBGCPT(PXBVST)
"RTN","PXBMCPT2",99,0)
 D EN0^PXBDCPT
"RTN","PXBMCPT2",100,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMCPT2",101,0)
 D LOC^PXBCC(15,1)
"RTN","PXBMCPT2",102,0)
 Q
"RTN","PXBMCPT2",103,0)
 ;
"RTN","PXBMCPT2",104,0)
CPTXIT ;----EXIT AND CLEAN UP
"RTN","PXBMCPT2",105,0)
 D KILL^PXBUTL3
"RTN","PXBMCPT2",106,0)
 D PRIM^PXBUTL
"RTN","PXBMCPT2",107,0)
 D FULL0^PXBCC
"RTN","PXBMCPT2",108,0)
 D CLEAR1^PXBCC
"RTN","PXBMCPT2",109,0)
 K PXBKY,PXBSAM,PXBSKY,PXKVST
"RTN","PXBMCPT2",110,0)
 ;
"RTN","PXBMCPT2",111,0)
 ;----Do the EVENT to the Protocol
"RTN","PXBMCPT2",112,0)
 ;D EVENT^PXKMAIN
"RTN","PXBMCPT2",113,0)
 K ^TMP("PXBDCPT",$J),^TMP("PXBSTOR",$J),^TMP("PXK",$J)
"RTN","PXBMCPT2",114,0)
 K ^TMP("PXBTOTAL",$J),^TMP("PXBTANA",$J)
"RTN","PXBMCPT2",115,0)
 Q
"RTN","PXBMCPT2",116,0)
 ;
"RTN","PXBMCPT2",117,0)
DX(PXC) ;GET DIAGNOSIS - PX124
"RTN","PXBMCPT2",118,0)
DX2 ;2nd entry
"RTN","PXBMCPT2",119,0)
 D CDX^PXBPCPT2(PXC)
"RTN","PXBMCPT2",120,0)
 I DATA["^D" D  W IOCUU G DX2
"RTN","PXBMCPT2",121,0)
 .S $P(REQI,U,PXC+11)=""
"RTN","PXBMCPT2",122,0)
 Q:DATA["^"!(DATA["@")
"RTN","PXBMCPT2",123,0)
 D PRINT^PXBDREQ(PXC+5),WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBMCPT2",124,0)
 W IOSC,IOEDEOP,IORC
"RTN","PXBMCPT2",125,0)
 Q
"RTN","PXBMCPT2",126,0)
 ;
"RTN","PXBMCPT2",127,0)
MORE(PXC)     ;MORE DXs? - PX124
"RTN","PXBMCPT2",128,0)
 Q:PXC=19 0  ;last in list - NO More DXs
"RTN","PXBMCPT2",129,0)
 N PX,ANS
"RTN","PXBMCPT2",130,0)
 S ANS=0
"RTN","PXBMCPT2",131,0)
 F PX=PXC+1:1:19 I $P(REQI,U,PX) S ANS=1 Q
"RTN","PXBMCPT2",132,0)
 Q ANS
"RTN","PXBMCPT2",133,0)
 ;
"RTN","PXBMPOV")
0^37^B7483817
"RTN","PXBMPOV",1,0)
PXBMPOV ;ISL/JVS,ESW - MAIN ROUTINE DIAGNOSIS ;3/5/04 1:50pm
"RTN","PXBMPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,14,108,124**;Aug 12, 1996
"RTN","PXBMPOV",3,0)
 ;
"RTN","PXBMPOV",4,0)
 W !,"This is not the entry into this routine" Q
"RTN","PXBMPOV",5,0)
 ;
"RTN","PXBMPOV",6,0)
 ;  VARABLE LIST
"RTN","PXBMPOV",7,0)
 ;
"RTN","PXBMPOV",8,0)
 ;
"RTN","PXBMPOV",9,0)
 ;
"RTN","PXBMPOV",10,0)
POV(PXBVST) ;---Real entry point
"RTN","PXBMPOV",11,0)
 Q:'$D(^AUPNVSIT(PXBVST))
"RTN","PXBMPOV",12,0)
 ; PXBVST  = Appointment-Encounter Visit IEN
"RTN","PXBMPOV",13,0)
 ; PXBDPRV = Default Provider for clinic appointment IEN
"RTN","PXBMPOV",14,0)
 ;--Set up
"RTN","PXBMPOV",15,0)
 N PXBCNT,I,J,IDATE,PRIP,PRIPOV,PRISEC,QUA,VISIT,PRI,POV,PRV,PXBENT,SAVE
"RTN","PXBMPOV",16,0)
 N PXBUT,FPRI,ENTRY,PXBSAVE,DATA,PXBPRBLM,PXBRES,PXBSPL,NAME,PATIENT
"RTN","PXBMPOV",17,0)
 N REQI,REQE,PROMPT,PROVIDER,PXDIGNS,CYCL,PXBNPOVL,FROM,NOREV,NOPLLIST
"RTN","PXBMPOV",18,0)
 N PXBNCPT,PXBNPRV,PXBNPOV,FIRST,PXBWIN,CLINIC,PXBPMT,LEAVE,VAR,%
"RTN","PXBMPOV",19,0)
 K ^TMP("PXBGPOVMATCH",$J)
"RTN","PXBMPOV",20,0)
 S CLINIC=$P(^AUPNVSIT(PXBVST,0),"^",22),PROMPT="POV",FIRST=1,PXBEXIT=1
"RTN","PXBMPOV",21,0)
 S (REQE,REQI)=""
"RTN","PXBMPOV",22,0)
 S ^TMP("PXBDPOV",$J,"START")=0
"RTN","PXBMPOV",23,0)
 ;
"RTN","PXBMPOV",24,0)
PPP ;--Obtain the POV (DIAGNOSIS)
"RTN","PXBMPOV",25,0)
 N PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI
"RTN","PXBMPOV",26,0)
 D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI)
"RTN","PXBMPOV",27,0)
 K PXBSPL
"RTN","PXBMPOV",28,0)
 D TERM^PXBCC
"RTN","PXBMPOV",29,0)
 D HDR^PXBUTL(PXBVST,1)
"RTN","PXBMPOV",30,0)
 D REQ^PXBDREQ(6)
"RTN","PXBMPOV",31,0)
 N LNARR D POV^PXBGPOV(PXBVST)
"RTN","PXBMPOV",32,0)
 D EN0^PXBDPOV
"RTN","PXBMPOV",33,0)
R D WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBMPOV",34,0)
 K ERROR D POV^PXBPPOV G:$G(PXBEXIT)<1 POVXIT G:$G(ERROR) R W IOEDEOP
"RTN","PXBMPOV",35,0)
 K FIRST
"RTN","PXBMPOV",36,0)
 I DATA["^P" D RSET^PXBDREQ("POV") G PPP
"RTN","PXBMPOV",37,0)
 I $G(PXBUT)=1,$D(LEAVE) G POVXIT
"RTN","PXBMPOV",38,0)
 ;
"RTN","PXBMPOV",39,0)
 ;--Prompt for Primary or Secondary DIAGNOSIS
"RTN","PXBMPOV",40,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMPOV",41,0)
 D PRI^PXBPPOV1
"RTN","PXBMPOV",42,0)
 I $D(DIRUT) D RSET^PXBDREQ("POV") G PPP
"RTN","PXBMPOV",43,0)
 D ORD^PXBPPOV1
"RTN","PXBMPOV",44,0)
 N PXCEVIEN,PXCEAFTR,PXD
"RTN","PXBMPOV",45,0)
 S PXCEVIEN=PXBVST,PXD=$P(REQI,U,5)
"RTN","PXBMPOV",46,0)
 D WIN17^PXBCC(PXBCNT),GET800^PXCEC800 ;CI's
"RTN","PXBMPOV",47,0)
 S PXBREQ(PXD,"I")=$G(PXCEAFTR(800))
"RTN","PXBMPOV",48,0)
 ;
"RTN","PXBMPOV",49,0)
 ;--Display the Requested Diagnosis
"RTN","PXBMPOV",50,0)
 D PRINT^PXBDREQ(4),EN0^PXBSTOR(PXBVST,PATIENT,REQI),EN1^PXKMAIN
"RTN","PXBMPOV",51,0)
 ;
"RTN","PXBMPOV",52,0)
 ;--Request entry to problem list
"RTN","PXBMPOV",53,0)
 I $D(DIRUT)!('$G(PXBPRBLM)) K DIRUT,PXBPRBLM D EN0^PXBSTOR(PXBVST,PATIENT,REQI),EN1^PXKMAIN,RSET^PXBDREQ("POV") G PPP
"RTN","PXBMPOV",54,0)
 ;
"RTN","PXBMPOV",55,0)
 ;--Request the Associated Provider
"RTN","PXBMPOV",56,0)
 ;---I NOT PROVIDER GO PPP
"RTN","PXBMPOV",57,0)
 ;
"RTN","PXBMPOV",58,0)
 ;--RETURN TO THE BEGINNING
"RTN","PXBMPOV",59,0)
 D RSET^PXBDREQ("POV"),RSET^PXBDREQ("PRV")
"RTN","PXBMPOV",60,0)
 G PPP
"RTN","PXBMPOV",61,0)
 Q
"RTN","PXBMPOV",62,0)
 ;
"RTN","PXBMPOV",63,0)
POVXIT ;----EXIT AND CLEAN UP
"RTN","PXBMPOV",64,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBMPOV",65,0)
 ;
"RTN","PXBMPOV",66,0)
 ;--Send the data to the problem list
"RTN","PXBMPOV",67,0)
PL I '$G(PXBEXIT)<1 D
"RTN","PXBMPOV",68,0)
 .I '$G(PXBPRBON) Q
"RTN","PXBMPOV",69,0)
 .I PXBCNT>0 N LNARR D SET^PXBPL
"RTN","PXBMPOV",70,0)
 D PRIM^PXBUTL
"RTN","PXBMPOV",71,0)
 ;D PRIMD^PXBUTL
"RTN","PXBMPOV",72,0)
 D FULL0^PXBCC
"RTN","PXBMPOV",73,0)
 D CLEAR1^PXBCC
"RTN","PXBMPOV",74,0)
 K PXBKY,PXBSAM,PXBSKY,PXBVST
"RTN","PXBMPOV",75,0)
 ;----Do the EVENT to the Protocol
"RTN","PXBMPOV",76,0)
 ;D EVENT^PXKMAIN
"RTN","PXBMPOV",77,0)
 K ^TMP("PXBDPOV",$J),^TMP("PXBSTOR",$J),^TMP("PXK",$J),^TMP("PXBDPL",$J)
"RTN","PXBMPOV",78,0)
 K ^TMP("PXBTOTAL",$J),^TMP("PXBTANA",$J),^TMP("PXBGPOVMATCH",$J)
"RTN","PXBMPOV",79,0)
 Q
"RTN","PXBMPOV",80,0)
 ;
"RTN","PXBPCPT")
0^6^B47694118
"RTN","PXBPCPT",1,0)
PXBPCPT ;ISL/JVS,ESW - PROMPT CPT ;3/18/05 12:55pm
"RTN","PXBPCPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,89,112,121,132,149,124**;Aug 12, 1996
"RTN","PXBPCPT",3,0)
 ;
"RTN","PXBPCPT",4,0)
 ;
"RTN","PXBPCPT",5,0)
 ;
"RTN","PXBPCPT",6,0)
CPT ;--CPT CODE
"RTN","PXBPCPT",7,0)
 ;SELINE=LINE NUMBER OF SELECTED ITEM
"RTN","PXBPCPT",8,0)
 N TIMED,PXBUT,EDATA,DIC,LINE,XFLAG,SELINE
"RTN","PXBPCPT",9,0)
 N I,X,Y,Q,DOUBLEQQ,NF,BAD,OK,CPT,PXEDIT
"RTN","PXBPCPT",10,0)
 I '$D(^DISV(DUZ,"PXBCPT-1")) S ^DISV(DUZ,"PXBCPT-1")=" "
"RTN","PXBPCPT",11,0)
 I '$D(IOSC) D TERM^PXBCC
"RTN","PXBPCPT",12,0)
 S DOUBLEQQ=0,PXEDIT=""
"RTN","PXBPCPT",13,0)
 S TIMED="I '$T!(DATA[""^"")!(DATA="""")"
"RTN","PXBPCPT",14,0)
 S DIC("S")="I $$CPTSCREN^PXBUTL(Y,IDATE)"
"RTN","PXBPCPT",15,0)
C ;--SECOND ENTRY POINT
"RTN","PXBPCPT",16,0)
 W IOSC
"RTN","PXBPCPT",17,0)
 ;---DYNAMIC  HEADER-----------------
"RTN","PXBPCPT",18,0)
 I '$D(CYCL) D
"RTN","PXBPCPT",19,0)
 .I PXBCNT=0,DOUBLEQQ=0 D LOC^PXBCC(2,10) W IOUON,"...There are "_$G(PXBCNT)_" PROCEDURES associated with this encounter.",IOUOFF,IOELEOL
"RTN","PXBPCPT",20,0)
 .I PXBCNT=1,DOUBLEQQ=0 D LOC^PXBCC(2,10) W IOUON,"...There is "_$G(PXBCNT)_" PROCEDURE associated with this encounter.",IOUOFF,IOELEOL
"RTN","PXBPCPT",21,0)
 .I PXBCNT>1,DOUBLEQQ=0 D LOC^PXBCC(2,10) W IOUON,"...There are "_$G(PXBCNT)_" PROCEDURES associated with this encounter.",IOUOFF,IOELEOL
"RTN","PXBPCPT",22,0)
 ;
"RTN","PXBPCPT",23,0)
 D LOC^PXBCC(15,0)
"RTN","PXBPCPT",24,0)
 ;I PXBCNT>30 
"RTN","PXBPCPT",25,0)
 ;W IOCUU,IOELEOL,
"RTN","PXBPCPT",26,0)
 W:PXTLNS>10 !,"Enter '+' for next page, '-' for last page." ;,IORC
"RTN","PXBPCPT",27,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPCPT",28,0)
 I '$D(^TMP("PXK",$J,"CPT")) W !,"Enter PROCEDURE (CPT CODE): "
"RTN","PXBPCPT",29,0)
 I $D(^TMP("PXK",$J,"CPT")) W !,"Enter ",IOINHI,"NEXT",IOINLOW," PROCEDURE (CPT CODE): "
"RTN","PXBPCPT",30,0)
 W IOELEOL R DATA:DTIME S EDATA=DATA
"RTN","PXBPCPT",31,0)
C1 ;----Third entry point
"RTN","PXBPCPT",32,0)
 X TIMED I  S PXBUT=1 S:DATA="^^" PXBEXIT=0 S:DATA="^^^" PXBRRR="" G CPTX
"RTN","PXBPCPT",33,0)
 I DATA?1.N1"E".NAP S DATA=" "_DATA
"RTN","PXBPCPT",34,0)
 I $L(DATA)>200 S (DATA,EDATA)=$E(DATA,1,199)
"RTN","PXBPCPT",35,0)
 I DATA?24.N S (DATA,EDATA)=$E(DATA,1,24)
"RTN","PXBPCPT",36,0)
 D CASE^PXBUTL
"RTN","PXBPCPT",37,0)
 ;----SPACE BAR---
"RTN","PXBPCPT",38,0)
 I DATA=" ",$D(^DISV(DUZ,"PXBCPT-1")) S DATA=^DISV(DUZ,"PXBCPT-1") W DATA
"RTN","PXBPCPT",39,0)
 ;---------------
"RTN","PXBPCPT",40,0)
 I DATA["^P" G CPTX
"RTN","PXBPCPT",41,0)
 I DATA["^C" G CPTX
"RTN","PXBPCPT",42,0)
 ;
"RTN","PXBPCPT",43,0)
 I ((DATA="+")!(DATA="-")) D DISCPT4^PXBDCPT(DATA) G C
"RTN","PXBPCPT",44,0)
 ;
"RTN","PXBPCPT",45,0)
M ;--------If Multiple entries have been entered
"RTN","PXBPCPT",46,0)
 D ADDM^PXBPCPT1
"RTN","PXBPCPT",47,0)
 I $G(NF) G C1
"RTN","PXBPCPT",48,0)
 ;
"RTN","PXBPCPT",49,0)
DEL ;--------If Multiple deleting
"RTN","PXBPCPT",50,0)
 D DELM^PXBPCPT1
"RTN","PXBPCPT",51,0)
 I DATA["^C" G CPTX
"RTN","PXBPCPT",52,0)
 I $G(NF) G C1
"RTN","PXBPCPT",53,0)
 ;
"RTN","PXBPCPT",54,0)
 D MOD
"RTN","PXBPCPT",55,0)
 ;
"RTN","PXBPCPT",56,0)
LI ;--------If picked a line number display 
"RTN","PXBPCPT",57,0)
 ;
"RTN","PXBPCPT",58,0)
 I (DATA>0)&(DATA<(PXBCNT+1))&($L(DATA)'>$L(PXBCNT)) D
"RTN","PXBPCPT",59,0)
 .S XFLAG=1
"RTN","PXBPCPT",60,0)
 .D DISCPT4^PXBDCPT(PXBSAM(DATA,"LINE"))
"RTN","PXBPCPT",61,0)
 .D REVCPT^PXBCC(DATA,1)
"RTN","PXBPCPT",62,0)
 .S SELINE=DATA
"RTN","PXBPCPT",63,0)
 .F I=1:1:$L(DATA) W IOCUB,IOECH
"RTN","PXBPCPT",64,0)
 .S CPTQUA=$P($G(PXBSAM(DATA)),"^",2)
"RTN","PXBPCPT",65,0)
 .S DATA=$P($G(PXBSAM(DATA)),"^",1)
"RTN","PXBPCPT",66,0)
 .;I $G(Q)'>1 W DATA
"RTN","PXBPCPT",67,0)
 I $D(XFLAG),XFLAG=1 S Y=DATA G FIN
"RTN","PXBPCPT",68,0)
 ;
"RTN","PXBPCPT",69,0)
 ;
"RTN","PXBPCPT",70,0)
 ;--------If CPT is already in the file
"RTN","PXBPCPT",71,0)
 I $D(PXBKY(DATA)) D  I +PXEDIT<0 S DATA="^C" G C1
"RTN","PXBPCPT",72,0)
 .D DISCPT4^PXBDCPT(PXBSAM($O(PXBKY(DATA,0)),"LINE"))
"RTN","PXBPCPT",73,0)
 .K Q
"RTN","PXBPCPT",74,0)
 .D TIMES^PXBUTL(DATA)
"RTN","PXBPCPT",75,0)
 .S PXEDIT=$$MULTI(DATA) Q:+PXEDIT<0
"RTN","PXBPCPT",76,0)
 .I Q=1 D
"RTN","PXBPCPT",77,0)
 ..S LINE=$O(PXBKY(DATA,0))
"RTN","PXBPCPT",78,0)
 ..S XFLAG=1
"RTN","PXBPCPT",79,0)
 ..Q:PXEDIT="A"
"RTN","PXBPCPT",80,0)
 ..D REVCPT^PXBCC(LINE,1)
"RTN","PXBPCPT",81,0)
 ..S CPTQUA=$P($G(PXBSAM(LINE)),"^",2)
"RTN","PXBPCPT",82,0)
 ..S SELINE=$O(Q(0))
"RTN","PXBPCPT",83,0)
 .I Q>1,PXEDIT="E" D
"RTN","PXBPCPT",84,0)
 ..N PXPG
"RTN","PXBPCPT",85,0)
 ..S NLINE=0
"RTN","PXBPCPT",86,0)
 ..S PXPG=+$G(^TMP("PXBDCPT",$J,"START"))+10
"RTN","PXBPCPT",87,0)
 ..F  S NLINE=$O(Q(NLINE)) Q:NLINE=""  Q:PXBSAM(NLINE,"LINE")>PXPG  D
"RTN","PXBPCPT",88,0)
 ...D REVCPT^PXBCC(NLINE,1)
"RTN","PXBPCPT",89,0)
 I '$G(Q) K SELINE
"RTN","PXBPCPT",90,0)
 I PXEDIT="E",$D(Q),Q>1 D  G:DATA="^C" C1 G LI
"RTN","PXBPCPT",91,0)
 .D WHICH^PXBPWCH S:DATA["^" DATA="^C"
"RTN","PXBPCPT",92,0)
 I $D(XFLAG),XFLAG=1 S Y=DATA G FIN
"RTN","PXBPCPT",93,0)
 ;
"RTN","PXBPCPT",94,0)
 ;--------Need to do a DIC lookup on data
"RTN","PXBPCPT",95,0)
 I DATA'="??" D  G:DATA="^C" C I DATA="?" G C
"RTN","PXBPCPT",96,0)
 .D:DATA="?" EN1^PXBHLP0("PXB","CPT",1,"",1)
"RTN","PXBPCPT",97,0)
 I DATA="??" D  G:UDATA="^C" C1 G FIN
"RTN","PXBPCPT",98,0)
 .S DOUBLEQQ=1
"RTN","PXBPCPT",99,0)
 .D EN1^PXBHLP0("PXB","CPT","",1,2)
"RTN","PXBPCPT",100,0)
 .I $L(DATA,"^")>1 D
"RTN","PXBPCPT",101,0)
 ..S DATA=+$P(DATA,"^",2)_$S($P(DATA,U,3)]"":"-"_$P(DATA,U,3),1:"")
"RTN","PXBPCPT",102,0)
 ..D MOD
"RTN","PXBPCPT",103,0)
 ..S Y=DATA
"RTN","PXBPCPT",104,0)
 .S:$G(UDATA)="" UDATA="^C"
"RTN","PXBPCPT",105,0)
 .S:UDATA="^C" (DATA,EDATA,Y)=UDATA
"RTN","PXBPCPT",106,0)
 ;
"RTN","PXBPCPT",107,0)
 ;--If a "?" is NOT entered during lookup
"RTN","PXBPCPT",108,0)
 S FROM="CPT",(VAL,Y)=$P($P($$DOUBLE1^PXBGCPT2(FROM),"^",2),"--",1)
"RTN","PXBPCPT",109,0)
 S (X,DATA,EDATA)=VAL,DIC=81,DIC(0)="MZ",DIC("S")="I $P($$CPT^ICPTCOD(Y,IDATE),U,7)" D ^DIC
"RTN","PXBPCPT",110,0)
 I Y<1 S DATA="^C" G C1
"RTN","PXBPCPT",111,0)
 ;
"RTN","PXBPCPT",112,0)
 ;--If Y is good and already in file...
"RTN","PXBPCPT",113,0)
 I $D(Y),$D(PXBKY(Y)) W IORC,IOCUU,IOEDEOP,! D
"RTN","PXBPCPT",114,0)
 .D DISCPT4^PXBDCPT($O(PXBKY($P(Y,"^",2),0)))
"RTN","PXBPCPT",115,0)
 .S LINE=$O(PXBKY($P(Y,"^",2),0)) D REVCPT^PXBCC(LINE,1)
"RTN","PXBPCPT",116,0)
 .S CPTQUA=$P($G(PXBSAM(LINE)),"^",2)
"RTN","PXBPCPT",117,0)
 ;
"RTN","PXBPCPT",118,0)
 ;
"RTN","PXBPCPT",119,0)
FIN ;--FINISH CPT
"RTN","PXBPCPT",120,0)
 I $G(SELINE) S $P(REQE,"^",1)=$P($G(PXBSAM(SELINE)),"^",3)
"RTN","PXBPCPT",121,0)
 I $P(REQE,"^",1)="" S $P(REQE,"^",1)="...No Provider Selected..."
"RTN","PXBPCPT",122,0)
 I $L(Y,"^")'>1 S X=Y,DIC=81,DIC(0)="ZM",DIC("S")="I $P($$CPT^ICPTCOD(Y,IDATE),U,7)" D ^DIC
"RTN","PXBPCPT",123,0)
 I Y<0 D HELP^PXBUTL0("CPTM") G C
"RTN","PXBPCPT",124,0)
 S OK=$$CPTOK^PXBUTL(+Y,IDATE) D  G:+OK=0 C
"RTN","PXBPCPT",125,0)
 .I +OK=0 W IOCUF,IOCUF,IORVON,"INACTIVE!--",IORVOFF D HELP1^PXBUTL1("CPTI") ;--HELP
"RTN","PXBPCPT",126,0)
 S CPT=Y(0)
"RTN","PXBPCPT",127,0)
 N PXINF S PXINF=$$CPT^ICPTCOD(+Y,IDATE),$P(CPT,U,2)=$P(PXINF,U,3)
"RTN","PXBPCPT",128,0)
 S ^DISV(DUZ,"PXBCPT-1")=$P(CPT,"^",1)
"RTN","PXBPCPT",129,0)
 I $D(PXBNCPT) S PXBNCPTF=1
"RTN","PXBPCPT",130,0)
 I $D(PXBKY(Y(0,0))),$G(SELINE) D
"RTN","PXBPCPT",131,0)
 .S $P(REQI,"^",8)=$O(PXBSKY(SELINE,0))
"RTN","PXBPCPT",132,0)
 .S PREDOC=$P(PXBSAM(SELINE),"^",3)
"RTN","PXBPCPT",133,0)
 .I $D(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1))) D
"RTN","PXBPCPT",134,0)
 ..Q:$P(REQI,"^",8)]""
"RTN","PXBPCPT",135,0)
 ..S $P(REQI,"^",8)=$O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),0))
"RTN","PXBPCPT",136,0)
 .I $D(PXBPRV($P(REQE,"^",1))) D
"RTN","PXBPCPT",137,0)
 ..S CPTQUA=$P(PXBSAM($O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),$O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),0)),0))),"^",2)
"RTN","PXBPCPT",138,0)
 I $D(PXBKY(Y(0,0))),'$G(SELINE) D
"RTN","PXBPCPT",139,0)
 .;S $P(REQI,"^",8)=$O(PXBSKY($O(PXBKY(Y(0,0),0)),0))
"RTN","PXBPCPT",140,0)
 .S PREDOC=$P(PXBSAM($O(PXBKY(Y(0,0),0))),"^",3)
"RTN","PXBPCPT",141,0)
 .I $D(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1))) D
"RTN","PXBPCPT",142,0)
 ..S $P(REQI,"^",8)=$O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),0))
"RTN","PXBPCPT",143,0)
 .I $D(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1))) D
"RTN","PXBPCPT",144,0)
 ..S CPTQUA=$P(PXBSAM($O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),$O(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1),0)),0))),"^",2)
"RTN","PXBPCPT",145,0)
 S $P(REQI,"^",3)=+Y
"RTN","PXBPCPT",146,0)
 S $P(REQE,"^",3)=$P(CPT,"^",1)_"-- "_$P(CPT,"^",2)
"RTN","PXBPCPT",147,0)
 S PXBNCPT($P(CPT,"^",1))=$P(REQI,"^",8)
"RTN","PXBPCPT",148,0)
 S:$P(REQI,"^",8)]"" PXBNCPT($P(CPT,"^",1),$P(REQI,"^",8))=""
"RTN","PXBPCPT",149,0)
 ;PX124 adds to REQ*
"RTN","PXBPCPT",150,0)
REST I $P(REQI,U,8) D
"RTN","PXBPCPT",151,0)
 .N CTR,VAL,IEN
"RTN","PXBPCPT",152,0)
 .S IEN=$P(REQI,U,8)
"RTN","PXBPCPT",153,0)
 .S $P(REQI,U,13,19)=$P($G(^AUPNVCPT(IEN,0)),U,9,15)
"RTN","PXBPCPT",154,0)
 .S $P(REQI,U,12)=$P($G(^AUPNVCPT(IEN,0)),U,5)
"RTN","PXBPCPT",155,0)
 .F CTR=12:1:19 D
"RTN","PXBPCPT",156,0)
 ..S VAL=$P(REQI,U,CTR)
"RTN","PXBPCPT",157,0)
 ..S:VAL VAL=$$ICDDX^ICDCODE(VAL,IDATE),$P(REQE,U,CTR)=$P($G(VAL),U,2)_" --"_$P($G(VAL),U,4)
"RTN","PXBPCPT",158,0)
 .S VAL=$P($G(^AUPNVCPT(IEN,12)),U,2),$P(REQI,U,22)=VAL
"RTN","PXBPCPT",159,0)
 .S:VAL $P(REQE,U,22)=$P($G(^VA(200,VAL,0)),U,1)
"RTN","PXBPCPT",160,0)
 ;
"RTN","PXBPCPT",161,0)
CPTX ;--CPT Exit and cleanup
"RTN","PXBPCPT",162,0)
 I $P(REQE,"^",1)="" S $P(REQE,"^",1)="...No Provider Selected..."
"RTN","PXBPCPT",163,0)
 I $G(WHAT)="INTV",DATA="^" S PXBEXIT="^^"
"RTN","PXBPCPT",164,0)
 I $D(PXBRRR) S DATA="^"
"RTN","PXBPCPT",165,0)
 I $D(PREDOC) D
"RTN","PXBPCPT",166,0)
 .I PREDOC]""&($P(REQE,"^",1)'[PREDOC) W !,IOINHI,"--WARNING!",IOINLOW," Currently stored Provider of service:-",IOINHI,PREDOC,IOINLOW D
"RTN","PXBPCPT",167,0)
 ..I '$D(PXBPRV($P(REQE,"^",1),$P(CPT,"^",1))) S $P(REQI,"^",8)=""
"RTN","PXBPCPT",168,0)
 K PXBDPRV,PREDOC
"RTN","PXBPCPT",169,0)
 W IOEDEOP
"RTN","PXBPCPT",170,0)
 Q
"RTN","PXBPCPT",171,0)
MOD ;---Separate CPT modifiers from CPT codes in entry string, if entered
"RTN","PXBPCPT",172,0)
 I DATA?1.N1"-".NE D
"RTN","PXBPCPT",173,0)
 .S PXMODSTR=$P(DATA,"-",2)
"RTN","PXBPCPT",174,0)
 .S (DATA,EDATA)=$P(DATA,"-",1)
"RTN","PXBPCPT",175,0)
 Q
"RTN","PXBPCPT",176,0)
 ;
"RTN","PXBPCPT",177,0)
MULTI(CPTCD) ;--Prompt user to Edit existing CPT code or Add as new entry
"RTN","PXBPCPT",178,0)
 ;
"RTN","PXBPCPT",179,0)
 N DIR,DA,X,Y
"RTN","PXBPCPT",180,0)
 S DIR(0)="SB^E:EDIT;A:ADD"
"RTN","PXBPCPT",181,0)
 S DIR("A")="Do you wish to (E)dit or (A)dd"
"RTN","PXBPCPT",182,0)
 ;PX*2.0*132
"RTN","PXBPCPT",183,0)
 I (($E(CPTCD)?1N)&($D(^IBE(357.69,+CPTCD))))!(($E(CPTCD)?1A)&($D(^IBE(357.69,CPTCD)))) D
"RTN","PXBPCPT",184,0)
 .S DIR(0)="SB^E:EDIT",DIR("A")="You may only (E)dit this code, no duplicate E&M codes allowed."
"RTN","PXBPCPT",185,0)
 S DIR("A",1)="CPT "_CPTCD_" already on file for this Encounter"
"RTN","PXBPCPT",186,0)
 D ^DIR
"RTN","PXBPCPT",187,0)
 I Y']""!(Y="^") Q -1
"RTN","PXBPCPT",188,0)
 Q Y
"RTN","PXBPCPT1")
0^71^B28242162
"RTN","PXBPCPT1",1,0)
PXBPCPT1 ;ISL/JVS,ESW - PROMPT CPT ;3/22/05 9:23am
"RTN","PXBPCPT1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**7,73,88,89,108,112,121,124**;Aug 12, 1996
"RTN","PXBPCPT1",3,0)
 ;
"RTN","PXBPCPT1",4,0)
 ;
"RTN","PXBPCPT1",5,0)
 ;
"RTN","PXBPCPT1",6,0)
 ;
"RTN","PXBPCPT1",7,0)
 ;
"RTN","PXBPCPT1",8,0)
ADDM ;--------If Multiple entries have been entered assume quantity 1
"RTN","PXBPCPT1",9,0)
 ;
"RTN","PXBPCPT1",10,0)
 ;
"RTN","PXBPCPT1",11,0)
 N OK,PXBLEN,BDATA,PXMDCNT
"RTN","PXBPCPT1",12,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPCPT1",13,0)
 S NF=0,PXBLEN=0
"RTN","PXBPCPT1",14,0)
 D EDITMM
"RTN","PXBPCPT1",15,0)
 Q
"RTN","PXBPCPT1",16,0)
 I DATA[","&(DATA'["-")&($L($P(DATA,",",1))=5) S NF=1 D
"RTN","PXBPCPT1",17,0)
 .D HELP1^PXBUTL1("CPTMM"),HELP1^PXBUTL1("CON")
"RTN","PXBPCPT1",18,0)
 .R OK:DTIME
"RTN","PXBPCPT1",19,0)
 .S PXBLEN=$L(DATA,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPCPT1",20,0)
 ..I $L($G(PXBPIECE))'=5 S BAD($G(PXBPIECE))="" Q
"RTN","PXBPCPT1",21,0)
 ..I $L(PXBPIECE)=5 S X=PXBPIECE,DIC=81,DIC(0)="Z",DIC("S")="I $P($$CPT^ICPTCOD(Y,IDATE),U,7)" D ^DIC
"RTN","PXBPCPT1",22,0)
 ..I Y=-1 S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPCPT1",23,0)
 ..S $P(REQI,"^",3)=+Y,$P(REQI,"^",4)=1
"RTN","PXBPCPT1",24,0)
 ..S PXBNCPT(PXBPIECE)=""
"RTN","PXBPCPT1",25,0)
 ..D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPCPT1",26,0)
 ..D EN1^PXKMAIN
"RTN","PXBPCPT1",27,0)
 ..D RSET^PXBDREQ("CPT")
"RTN","PXBPCPT1",28,0)
BAD ;----BAD CPT CODES
"RTN","PXBPCPT1",29,0)
 N Y I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPCPT1",30,0)
 .S (BDATA,EDATA)=""
"RTN","PXBPCPT1",31,0)
 .F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPCPT1",32,0)
 .W ! D HELP^PXBUTL0("CPTM") W !
"RTN","PXBPCPT1",33,0)
 .S DIR(0)="E" D ^DIR K DIR,DIRUT
"RTN","PXBPCPT1",34,0)
 .S:Y=1 DATA="^C" S:Y=0!(Y="") DATA="^"
"RTN","PXBPCPT1",35,0)
 I $G(NF)&('$D(BAD)) S DATA="^C" Q
"RTN","PXBPCPT1",36,0)
 Q
"RTN","PXBPCPT1",37,0)
 ;
"RTN","PXBPCPT1",38,0)
BADD(PAR,EDATA) ;----BAD CPT CODES - DISPLAY
"RTN","PXBPCPT1",39,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPCPT1",40,0)
 .W !,*7 D HELP^PXBUTL0(PAR) W !
"RTN","PXBPCPT1",41,0)
 Q
"RTN","PXBPCPT1",42,0)
EDITMM ;--ADD MULTIPLE ENTRIES
"RTN","PXBPCPT1",43,0)
 ;
"RTN","PXBPCPT1",44,0)
 N STOP,BAD,GONE,PXBLEN,PXBPIECE,BDATA,PX,PXI,YY,BAD
"RTN","PXBPCPT1",45,0)
 S STOP=0
"RTN","PXBPCPT1",46,0)
 I DATA[",",DATA'["-" D
"RTN","PXBPCPT1",47,0)
 .S PXBLEN=$L(DATA,",")
"RTN","PXBPCPT1",48,0)
 .S NF=1
"RTN","PXBPCPT1",49,0)
 .F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) Q:STOP=1  D
"RTN","PXBPCPT1",50,0)
 ..;----ADDED
"RTN","PXBPCPT1",51,0)
 ..I PXBPIECE="" Q
"RTN","PXBPCPT1",52,0)
 ..I $D(PXBKY(PXBPIECE)) S BAD(PXBPIECE)="" S NF=1 D BADD("CPTMDP",PXBPIECE) H 2 Q
"RTN","PXBPCPT1",53,0)
 ..I PXI>1 I ","_$P(DATA,",",1,PXI-1)_","[(","_PXBPIECE_",") W !!,*7,"PROCEDURE "_PXBPIECE_" was already processed." H 1 Q
"RTN","PXBPCPT1",54,0)
 ..S X=PXBPIECE,DIC=81,DIC(0)="ZB",DIC("S")="I $P($$CPT^ICPTCOD(Y,IDATE),U,7)" D ^DIC
"RTN","PXBPCPT1",55,0)
 ..I Y<1 S BAD(PXBPIECE)="" S NF=1 D BADD("CPTM",PXBPIECE) Q
"RTN","PXBPCPT1",56,0)
 ..S $P(REQI,U,3)=+Y
"RTN","PXBPCPT1",57,0)
 ..S $P(REQI,U,8)=""
"RTN","PXBPCPT1",58,0)
 ..W !!,"For the PROCEDURE: "_X_"--"_$P(Y(0),U,2)
"RTN","PXBPCPT1",59,0)
 ..;--Prompt for CPT Modifiers
"RTN","PXBPCPT1",60,0)
 ..D FULL0^PXBCC
"RTN","PXBPCPT1",61,0)
 ..S PXMDCNT=$$CODM^ICPTCOD($P(REQI,"^",3),"^TMP(""PXMODARR"",$J",PXBSOURC,PXBVSTDT)
"RTN","PXBPCPT1",62,0)
 ..K ^TMP("PXMODARR",$J)
"RTN","PXBPCPT1",63,0)
 ..D MOD^PXBPMOD(PXBVST,PXBPAT,$P(REQI,"^",3),"",$P(REQI,"^",8),IDATE,PXMDCNT,.PXMREQ)
"RTN","PXBPCPT1",64,0)
 ..S:EDATA["^C" STOP=1
"RTN","PXBPCPT1",65,0)
 ..Q:STOP
"RTN","PXBPCPT1",66,0)
 ..S CPTQUA=1
"RTN","PXBPCPT1",67,0)
 ..D QUA^PXBPQUA
"RTN","PXBPCPT1",68,0)
 ..S:EDATA["^C" STOP=1 S:EDATA["^P" STOP=1 Q:STOP=1
"RTN","PXBPCPT1",69,0)
 ..;--Get Provider for CPT
"RTN","PXBPCPT1",70,0)
 ..N PXBSKY,PXBKY,PXBSAM,PXBCNT,PRVDR,FPRI
"RTN","PXBPCPT1",71,0)
 ..D PRV^PXBGPRV(PXBVST,.PXBSKY,.PXBKY,.PXBSAM,.PXBCNT,.PRVDR,.FPRI) W IOSC
"RTN","PXBPCPT1",72,0)
 ..S FROM="CPT" D  Q:STOP
"RTN","PXBPCPT1",73,0)
 ...N DATA D PRV^PXBPPRV I DATA["^P" D  W IOCUU S STOP=1 Q
"RTN","PXBPCPT1",74,0)
 ....S $P(REQI,"^",1)="",$P(REQI,"^",2)="",$P(REQI,"^",7)=""
"RTN","PXBPCPT1",75,0)
 ....K PXBDPRV
"RTN","PXBPCPT1",76,0)
 ...S (PXBNCPT(PXBPIECE),DATA)=""
"RTN","PXBPCPT1",77,0)
TEST3O ...;ORDERING PROVIDER - PX124
"RTN","PXBPCPT1",78,0)
 ...D ORD^PXBPORD
"RTN","PXBPCPT1",79,0)
 ...I DATA["^O" D  W IOCUU G TEST3O
"RTN","PXBPCPT1",80,0)
 ....S $P(REQI,U,22)=""
"RTN","PXBPCPT1",81,0)
TEST3D ...;UP TO 8 DIAGNOSES - PX124
"RTN","PXBPCPT1",82,0)
 ...S (PXBDXPRI,PX124)="",DATA=1
"RTN","PXBPCPT1",83,0)
 ...F  S PX124=$O(^AUPNVPOV("AD",PXBVST,PX124)) Q:'PX124!PXBDXPRI  D
"RTN","PXBPCPT1",84,0)
 ....I $P(^AUPNVPOV(PX124,0),U,12)="P" S PXBDXPRI=$P(^(0),U,1)
"RTN","PXBPCPT1",85,0)
 ...F PX124=1:1:8 Q:DATA=""!(DATA["^")&$$MORE(PX124)  D DX(PX124)
"RTN","PXBPCPT1",86,0)
 ..D EN0^PXBSTOR(PXBVST,PATIENT,REQI,.PXMREQ)
"RTN","PXBPCPT1",87,0)
 ..D EN1^PXKMAIN
"RTN","PXBPCPT1",88,0)
 ..D RSET^PXBDREQ("CPT")
"RTN","PXBPCPT1",89,0)
 ..D RSET^PXBDREQ("PRV")
"RTN","PXBPCPT1",90,0)
 ..K PXMREQ
"RTN","PXBPCPT1",91,0)
 ..S $P(REQI,"^",7)=""
"RTN","PXBPCPT1",92,0)
 .S DATA="^C"
"RTN","PXBPCPT1",93,0)
 Q
"RTN","PXBPCPT1",94,0)
 ;
"RTN","PXBPCPT1",95,0)
DELM ;--------If Multiple deleting
"RTN","PXBPCPT1",96,0)
 N DELM,PXBJ,BAD,PXBPIECE,PXBLEN
"RTN","PXBPCPT1",97,0)
 S NF=0,PXBLEN=0 S $P(DELM,"^",2)=1
"RTN","PXBPCPT1",98,0)
 I $E(DATA,1)="@" D
"RTN","PXBPCPT1",99,0)
 .I '$$SURE^PXCEAE2 S DATA="^C" Q
"RTN","PXBPCPT1",100,0)
 .S DATA=$P(DATA,"@",2),NF=1
"RTN","PXBPCPT1",101,0)
 .S PXBLEN=$L(DATA,",")
"RTN","PXBPCPT1",102,0)
 .F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPCPT1",103,0)
 ..I PXBPIECE'["-"&(PXBPIECE'>0!(PXBPIECE'<(PXBCNT+1))) S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPCPT1",104,0)
 ..I PXBPIECE'["-" D
"RTN","PXBPCPT1",105,0)
 ...I $D(GONE(PXBPIECE)) Q
"RTN","PXBPCPT1",106,0)
 ...Q:PXBPIECE'?.N
"RTN","PXBPCPT1",107,0)
 ...S $P(REQI,"^",8)=$O(PXBSKY(PXBPIECE,0)) ;-IEN
"RTN","PXBPCPT1",108,0)
 ...S X=$P(PXBSAM(PXBPIECE),"^",1),DIC=81,DIC(0)="ZM",DIC("S")="I $P($$CPT^ICPTCOD(Y,IDATE),U,7)" D ^DIC
"RTN","PXBPCPT1",109,0)
 ...S $P(REQI,"^",3)=+Y K Y
"RTN","PXBPCPT1",110,0)
 ...S $P(REQI,"^",4)=0 ;-QUANTITY
"RTN","PXBPCPT1",111,0)
 ...S GONE(PXBPIECE)=""
"RTN","PXBPCPT1",112,0)
 ...D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPCPT1",113,0)
 ...D EN1^PXKMAIN
"RTN","PXBPCPT1",114,0)
 ..I PXBPIECE["-" D
"RTN","PXBPCPT1",115,0)
 ...F PXBJ=$P(PXBPIECE,"-",1):1:$P(PXBPIECE,"-",2) D
"RTN","PXBPCPT1",116,0)
 ....I $D(GONE(PXBJ)) Q
"RTN","PXBPCPT1",117,0)
 ....I PXBJ'>0!(PXBJ'<(PXBCNT+1)) S BAD(PXBJ)="" Q
"RTN","PXBPCPT1",118,0)
 ....S $P(REQI,"^",8)=$O(PXBSKY(PXBJ,0)) ;-IEN
"RTN","PXBPCPT1",119,0)
 ....S X=$P(PXBSAM(PXBJ),"^",1),DIC=81,DIC(0)="ZM",DIC("S")="I $P($$CPT^ICPTCOD(Y,IDATE),U,7)" D ^DIC
"RTN","PXBPCPT1",120,0)
 ....S $P(REQI,"^",3)=+Y K Y
"RTN","PXBPCPT1",121,0)
 ....S $P(REQI,"^",4)=0 ;-QUANTITY
"RTN","PXBPCPT1",122,0)
 ....S GONE(PXBJ)=""
"RTN","PXBPCPT1",123,0)
 ....D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPCPT1",124,0)
 ....D EN1^PXKMAIN
"RTN","PXBPCPT1",125,0)
 K GONE
"RTN","PXBPCPT1",126,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPCPT1",127,0)
 .S (BDATA,EDATA)=""
"RTN","PXBPCPT1",128,0)
 .F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPCPT1",129,0)
 .W ! D HELP^PXBUTL0("CPTMD") W !
"RTN","PXBPCPT1",130,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","PXBPCPT1",131,0)
 .S:Y=1 DATA="^C" S:Y=0!(Y="") DATA="^" K Y
"RTN","PXBPCPT1",132,0)
 I $G(NF)&('$D(BAD)) S DATA="^C" Q
"RTN","PXBPCPT1",133,0)
 Q
"RTN","PXBPCPT1",134,0)
DX(PXC) ;GET DIAGNOSIS - PX124
"RTN","PXBPCPT1",135,0)
DX2 ;2nd entry
"RTN","PXBPCPT1",136,0)
 D CDX^PXBPCPT2(PXC)
"RTN","PXBPCPT1",137,0)
 I DATA["^D" D  W IOCUU G DX2
"RTN","PXBPCPT1",138,0)
 .S $P(REQI,U,PXC+11)=""
"RTN","PXBPCPT1",139,0)
 Q:DATA["^"!(DATA["@")
"RTN","PXBPCPT1",140,0)
 D PRINT^PXBDREQ(PXC+5),WIN17^PXBCC(PXBCNT),LOC^PXBCC(15,1)
"RTN","PXBPCPT1",141,0)
 W IOSC,IOEDEOP,IORC
"RTN","PXBPCPT1",142,0)
 Q
"RTN","PXBPCPT1",143,0)
MORE(PXC)     ;MORE DXs? - PX124
"RTN","PXBPCPT1",144,0)
 Q:PXC=19 0  ;last in list - NO More DXs
"RTN","PXBPCPT1",145,0)
 N PX,ANS
"RTN","PXBPCPT1",146,0)
 S ANS=0
"RTN","PXBPCPT1",147,0)
 F PX=PXC+1:1:19 I $P(REQI,U,PX) S ANS=1 Q
"RTN","PXBPCPT1",148,0)
 Q ANS
"RTN","PXBPCPT1",149,0)
 ;
"RTN","PXBPCPT2")
0^7^B6970858
"RTN","PXBPCPT2",1,0)
PXBPCPT2 ;WASH/BDB - PROMPT PROCEDURE DIAGNOSES ;10/26/04 4:19pm
"RTN","PXBPCPT2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Aug 12, 1996
"RTN","PXBPCPT2",3,0)
 ;
"RTN","PXBPCPT2",4,0)
 Q  ;not an entry
"RTN","PXBPCPT2",5,0)
 ;
"RTN","PXBPCPT2",6,0)
CDX(PXN)    ;--Diagnosis for Procedure
"RTN","PXBPCPT2",7,0)
 N TIMED,DIC,X,CPTDX,POS,PXDISV,PXD,PXC,CDX,VAL,PXCEAFTR,PXCEVIEN
"RTN","PXBPCPT2",8,0)
CPT1 K PXBUT,EDATA
"RTN","PXBPCPT2",9,0)
 S POS=PXN+11,CPTDX=$P($P(REQE,U,POS)," "),PXDISV="PXBCPTDX-"_POS
"RTN","PXBPCPT2",10,0)
 S TIMED="I '$T!(DATA[""^"")",PXD=$P(REQI,U,POS),PXC=$P(REQI,U,3)
"RTN","PXBPCPT2",11,0)
 S DIC("S")="I $P($$ICDDX^ICDCODE(Y,IDATE),""^"",10)"
"RTN","PXBPCPT2",12,0)
PCPT1 ;SECOND ENTRY POINT
"RTN","PXBPCPT2",13,0)
 W !," What is DIAGNOSIS "_PXN_" for this procedure: "_$S($G(CPTDX):CPTDX_"//",1:""),IOELEOL
"RTN","PXBPCPT2",14,0)
 R DATA:DTIME S:DATA="" DATA=CPTDX S EDATA=DATA
"RTN","PXBPCPT2",15,0)
P1CPT1 ;--
"RTN","PXBPCPT2",16,0)
 X TIMED I  S PXBUT=1,LEAVE=1 G CDXX1
"RTN","PXBPCPT2",17,0)
 I DATA="^D" G CDXX1
"RTN","PXBPCPT2",18,0)
 I DATA="^"!(DATA="^^") S PXBEXIT=0 G CDXX1
"RTN","PXBPCPT2",19,0)
 I DATA="@",'$G(PXD) S DATA="?"
"RTN","PXBPCPT2",20,0)
 I DATA="@" K PXBREQ(PXD) S $P(REQI,U,POS)="@" G CDXX1
"RTN","PXBPCPT2",21,0)
 ;I DATA="",PXN=1 W !,"PRIMARY DIAGNOSIS IS REQUIRED!" G CPT1
"RTN","PXBPCPT2",22,0)
 I DATA="?" D EN1^PXBHLP0("PXB","POV",1,"",1) G CPT1
"RTN","PXBPCPT2",23,0)
 ;I DATA="??" S DOUBLEQQ=1 D EN1^PXBHLP0("PXB","POV",1,"",2) S:$L(DATA,"^")>1 (Y,DATA,EDATA)=$P($P(DATA,"^",2),"--",1) G:Y>1 PFINCPT1 G:Y?1A1.NP PFINCPT1
"RTN","PXBPCPT2",24,0)
 I DATA="??" D EN1^PXBHLP0("PXB","POV",1,"",2) G CPT1
"RTN","PXBPCPT2",25,0)
 I $L(DATA)>200 S (DATA,EDATA)=$E(DATA,1,199)
"RTN","PXBPCPT2",26,0)
 ;---SPACE BAR---
"RTN","PXBPCPT2",27,0)
 I DATA=" ",$D(^DISV(DUZ,PXDISV)) S DATA=^DISV(DUZ,PXDISV) W DATA
"RTN","PXBPCPT2",28,0)
 ;-----
"RTN","PXBPCPT2",29,0)
 ;--Do a DIC lookup on data if a "?" is NOT entered
"RTN","PXBPCPT2",30,0)
 I DATA="^P" S DATA="^D" G P1CPT1
"RTN","PXBPCPT2",31,0)
 I DATA="" S $P(REQI,U,POS)="" G CDXX1
"RTN","PXBPCPT2",32,0)
 I $L(DATA,"--")=2 D
"RTN","PXBPCPT2",33,0)
 .S (VAL,Y)=$P(DATA,"--"),DATA=$P(VAL,U,2)
"RTN","PXBPCPT2",34,0)
 E  S (VAL,Y)=$$DOUBLE1^PXBGPOV2("POV")
"RTN","PXBPCPT2",35,0)
 I Y<1 S DATA="^D" G P1CPT1
"RTN","PXBPCPT2",36,0)
 S (DATA,EDATA)=$P(VAL,U,2),X="`"_+$P(Y,U,1) K Y S DIC=80,DIC(0)="MZ" D ^DIC  ;make ^DIC selection "exact."
"RTN","PXBPCPT2",37,0)
 ;
"RTN","PXBPCPT2",38,0)
PFINCPT1 ;--Finish DIAGNOSIS
"RTN","PXBPCPT2",39,0)
 I $L(Y,U)'>1 S X=Y,DIC=80,DIC(0)="IZM" D ^DIC
"RTN","PXBPCPT2",40,0)
 I +Y<0 D HELP1^PXBUTL1("POV") G CPT1
"RTN","PXBPCPT2",41,0)
 I $$DUP(+Y) W !,$P(Y,U,2)," IS ALREADY A DIAGNOSIS!" G PCPT1
"RTN","PXBPCPT2",42,0)
 S CDX=Y(0),^DISV(DUZ,PXDISV)=DATA,$P(REQI,U,POS)=+Y
"RTN","PXBPCPT2",43,0)
 S $P(REQE,U,POS)=$P(CDX,U,1)_" --"_$P(CDX,U,3)
"RTN","PXBPCPT2",44,0)
 I $D(PXBREQ(+Y,"I")) G CDXX1
"RTN","PXBPCPT2",45,0)
 I 'PXBDXPRI D
"RTN","PXBPCPT2",46,0)
 .D PRI^PXBPPOV1 ;PRI/SEC
"RTN","PXBPCPT2",47,0)
 .I '$D(DIRUT),$P(REQI,U,6)="P" S PXBDXPRI=+Y
"RTN","PXBPCPT2",48,0)
 S PXCEVIEN=PXBVST,PXDX=Y
"RTN","PXBPCPT2",49,0)
 D WIN17^PXBCC(PXBCNT),GET800^PXCEC800 ;CI's
"RTN","PXBPCPT2",50,0)
 I $G(PXCEQUIT) S $P(REQE,U,POS)=""
"RTN","PXBPCPT2",51,0)
 I '$G(PXCEQUIT) S PXBREQ(+PXDX,"I")=PXCEAFTR(800)
"RTN","PXBPCPT2",52,0)
 I '$G(PXCEQUIT) D EN0^PXBSTOR(PXBVST,PATIENT,REQI,.PXMREQ),EN1^PXKMAIN
"RTN","PXBPCPT2",53,0)
CDXX1 ;--EXIT AND CLEAN UP
"RTN","PXBPCPT2",54,0)
 I '$D(REQE) S REQE=""
"RTN","PXBPCPT2",55,0)
 I $P(REQE,U,POS)="" S $P(REQI,U,POS)=""
"RTN","PXBPCPT2",56,0)
 Q
"RTN","PXBPCPT2",57,0)
 ;
"RTN","PXBPCPT2",58,0)
DUP(CD) ;DUPLICATE?
"RTN","PXBPCPT2",59,0)
 N ANS,CTR
"RTN","PXBPCPT2",60,0)
 S ANS=0
"RTN","PXBPCPT2",61,0)
 F CTR=12:1:19 I CTR'=POS,$P(REQI,U,CTR)=CD S ANS=1 Q
"RTN","PXBPCPT2",62,0)
 Q ANS
"RTN","PXBPCPT2",63,0)
 ;
"RTN","PXBPORD")
0^2^B2060074
"RTN","PXBPORD",1,0)
PXBPORD ;ISL/JVS - PROMPT ORDERING PROVIDER ;6/17/03  08:56
"RTN","PXBPORD",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Aug 12, 1996
"RTN","PXBPORD",3,0)
 ;
"RTN","PXBPORD",4,0)
ORD ;--Ordering Provider
"RTN","PXBPORD",5,0)
 N TIMED,DATA,DIC,X,Y,CPTORD
"RTN","PXBPORD",6,0)
 S CPTORD=$S($P(REQI,U,22):$P(^VA(200,$P(REQI,U,22),0),U,1),1:"")
"RTN","PXBPORD",7,0)
 S TIMED="I '$T!(DATA[""^"")"
"RTN","PXBPORD",8,0)
 D WIN17^PXBCC(PXBCNT),LOC^PXBCC(16,0)
"RTN","PXBPORD",9,0)
 W IOSC,IOEDEOP
"RTN","PXBPORD",10,0)
O ;--SECOND ENTRY POINT
"RTN","PXBPORD",11,0)
 W IORC," Enter Ordering Provider: "_$G(CPTORD)_"//",IOELEOL
"RTN","PXBPORD",12,0)
 R DATA:DTIME
"RTN","PXBPORD",13,0)
O1 ;---
"RTN","PXBPORD",14,0)
 X TIMED I  G ORDX
"RTN","PXBPORD",15,0)
 I DATA="@" S $P(REQI,"^",22)="@" G ORDX
"RTN","PXBPORD",16,0)
 I DATA="^"!(DATA="^^")!(DATA["^O") G ORDX
"RTN","PXBPORD",17,0)
 ;I DATA="?" D EN1^PXBHLP0("PXB","ORD",1,"",1) G O
"RTN","PXBPORD",18,0)
 ;I DATA="??" S DOUBLEQQ=1 D EN1^PXBHLP0("PXB","ORD","",1,2) S:DATA="O" UDATA="^O" S:$L(DATA,"^")>1 (Y,DATA,EDATA)=$P(DATA,"^",2) S:$G(UDATA)="" UDATA="^O" S:UDATA="^O" (DATA,EDATA,Y)=UDATA G:UDATA="^O" O1
"RTN","PXBPORD",19,0)
 I DATA="?" D HELP^PXBUTL0("OP1") G O
"RTN","PXBPORD",20,0)
 I DATA="??" D HELP^PXBUTL0("OP2") G O
"RTN","PXBPORD",21,0)
 I DATA="",$G(CPTORD)'="" S DATA=CPTORD
"RTN","PXBPORD",22,0)
 I DATA="" G ORDX
"RTN","PXBPORD",23,0)
 D CASE^PXBUTL
"RTN","PXBPORD",24,0)
 ;----SPACE BAR---
"RTN","PXBPORD",25,0)
 I DATA'=" ",DATA'["^",DATA'="" S ^DISV(DUZ,"PXBORD-22")=DATA
"RTN","PXBPORD",26,0)
 I DATA=" ",$D(^DISV(DUZ,"PXBORD-22")) S DATA=^DISV(DUZ,"PXBORD-22") W DATA
"RTN","PXBPORD",27,0)
 ;--If a "?" is NOT entered during lookup
"RTN","PXBPORD",28,0)
 S X=DATA,DIC=200,DIC(0)="OQME" D ^DIC
"RTN","PXBPORD",29,0)
 I Y=-1 S $P(REQE,U,22)="" G ORDX
"RTN","PXBPORD",30,0)
 ;
"RTN","PXBPORD",31,0)
 S $P(REQI,U,22)=+Y,$P(REQE,U,22)=$P(Y,U,2)
"RTN","PXBPORD",32,0)
ORDX ;--EXIT AND CLEANUP
"RTN","PXBPORD",33,0)
 I '$D(REQE) S REQE=""
"RTN","PXBPORD",34,0)
 I $P(REQE,U,22)="" S $P(REQI,U,22)=""
"RTN","PXBPORD",35,0)
 Q
"RTN","PXBPPOV")
0^38^B21767905
"RTN","PXBPPOV",1,0)
PXBPPOV ;ISL/JVS - PROMPT POV ;8/10/04 2:31pm
"RTN","PXBPPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,28,92,121,149,124**;Aug 12, 1996
"RTN","PXBPPOV",3,0)
 ;
"RTN","PXBPPOV",4,0)
 ; VARIABLE LIST
"RTN","PXBPPOV",5,0)
 ; SELINE= Line number of selected item
"RTN","PXBPPOV",6,0)
 ;
"RTN","PXBPPOV",7,0)
POV ;--DIAGNOSIS
"RTN","PXBPPOV",8,0)
 I $D(PXBNPOVL) D LOC^PXBCC(2,0) W IOUON,"Previous Entry:   ",$G(PXBNPOVL(1)) F I=1:1:10 W " "
"RTN","PXBPPOV",9,0)
 W IOUOFF
"RTN","PXBPPOV",10,0)
 N TIMED,EDATA,DIC,LINE,XFLAG,SELINE,PXBEDIS,FPL,CNT
"RTN","PXBPPOV",11,0)
 I '$D(^DISV(DUZ,"PXBPOV-3")) S ^DISV(DUZ,"PXBPOV-3")="   "
"RTN","PXBPPOV",12,0)
 I '$D(IOSC) D TERM^PXBCC
"RTN","PXBPPOV",13,0)
 S DOUBLEQQ=0
"RTN","PXBPPOV",14,0)
 S TIMED="I '$T!(DATA=""^"")"
"RTN","PXBPPOV",15,0)
 S DIC("S")="I $P($$ICDDX^ICDCODE(Y,IDATE),U,10)"
"RTN","PXBPPOV",16,0)
P ;--Second Entry point
"RTN","PXBPPOV",17,0)
 W IOSC K FPL
"RTN","PXBPPOV",18,0)
 ;---DYNAMIC HEADER---
"RTN","PXBPPOV",19,0)
 I '$D(CYCL) D
"RTN","PXBPPOV",20,0)
 .S CNT=$G(PXBCNT)\2
"RTN","PXBPPOV",21,0)
 .I CNT=0,DOUBLEQQ=0 D LOC^PXBCC(1,10) W "...There are "_CNT_" ICD CODES associated with this encounter."
"RTN","PXBPPOV",22,0)
 .I CNT=1,DOUBLEQQ=0 D LOC^PXBCC(1,10) W "...There is "_CNT_" ICD CODE associated with this encounter."
"RTN","PXBPPOV",23,0)
 .I CNT>1,DOUBLEQQ=0 D LOC^PXBCC(1,10) W "...There are "_CNT_" ICD CODES associated with this encounter."
"RTN","PXBPPOV",24,0)
 D LOC^PXBCC(15,0)
"RTN","PXBPPOV",25,0)
 I PXBCNT>10&('$G(DOUBLEQQ)) W !,"Enter '+' for next page, '-' for previous page."
"RTN","PXBPPOV",26,0)
 I '$D(^TMP("PXK",$J,"POV")) W !,"Enter Diagnosis : "_$G(PXBDPOV) W:$D(PXBDPOV) " //" W IOELEOL
"RTN","PXBPPOV",27,0)
 I $D(^TMP("PXK",$J,"POV")) W !,"Enter ",IOINHI,"NEXT",IOINLOW," Diagnosis : "_$G(PXBDPOV) W:$D(PXBDPOV) " //" W IOELEOL
"RTN","PXBPPOV",28,0)
 R DATA:DTIME S EDATA=DATA
"RTN","PXBPPOV",29,0)
P1 ;--Third entry point
"RTN","PXBPPOV",30,0)
 X TIMED I  S PXBUT=1,LEAVE=1,DATA="^" G POVX
"RTN","PXBPPOV",31,0)
 I DATA?1.N1"E".NAP S DATA=" "_DATA
"RTN","PXBPPOV",32,0)
 I DATA?24.N S (DATA,EDATA)=$E(DATA,1,24)
"RTN","PXBPPOV",33,0)
 I $L(DATA)>200 S (DATA,EDATA)=$E(DATA,1,199)
"RTN","PXBPPOV",34,0)
 D CASE^PXBUTL
"RTN","PXBPPOV",35,0)
 ;----SPACE BAR---
"RTN","PXBPPOV",36,0)
 I DATA=" ",$D(^DISV(DUZ,"PXBPOV-3")) S DATA=^DISV(DUZ,"PXBPOV-3") W DATA
"RTN","PXBPPOV",37,0)
 ;-----------------
"RTN","PXBPPOV",38,0)
 I DATA="^^" S PXBEXIT=0 G POVX
"RTN","PXBPPOV",39,0)
 ;---I Prompt can jump to others put symbols in here
"RTN","PXBPPOV",40,0)
 I DATA["^P" G POVX
"RTN","PXBPPOV",41,0)
 ;------PXBDPOV=DEFAULT POV---
"RTN","PXBPPOV",42,0)
 I DATA="",$D(PXBDPOV) S DATA=$P($G(PXBDPOV),"--",1)
"RTN","PXBPPOV",43,0)
 I DATA="",'$D(PXBDPOV) S PXBUT=1,PXBSPL="",LEAVE=1 G POVX
"RTN","PXBPPOV",44,0)
 I PXBCNT>10&((DATA="+")!(DATA="-")) D DPOV4^PXBDPOV(DATA) G P
"RTN","PXBPPOV",45,0)
 ;
"RTN","PXBPPOV",46,0)
M ;--------IF Multiple entries have been entered
"RTN","PXBPPOV",47,0)
 D ADDM^PXBPPOV1
"RTN","PXBPPOV",48,0)
 I $G(NF) G P1
"RTN","PXBPPOV",49,0)
 ;
"RTN","PXBPPOV",50,0)
 ;--------IF Multiple deleting of entries
"RTN","PXBPPOV",51,0)
 D DELM^PXBPPOV1
"RTN","PXBPPOV",52,0)
 I $G(NF) G P1
"RTN","PXBPPOV",53,0)
 ;
"RTN","PXBPPOV",54,0)
LI ;--------If picked a line number
"RTN","PXBPPOV",55,0)
 I (DATA>0)&(DATA<(PXBCNT+1))&($L(DATA)'>$L(PXBCNT)) S XFLAG=1 D REVPOV^PXBCC(DATA) S SELINE=DATA D
"RTN","PXBPPOV",56,0)
 .F I=1:1:$L(DATA) W IOCUB,IOECH
"RTN","PXBPPOV",57,0)
 .S PRISEC=$P($G(PXBSAM(DATA)),"^",4) S:PRISEC["PRI" FPRI=0
"RTN","PXBPPOV",58,0)
 .S DATA=$P($G(PXBSAM(DATA)),"^",1)
"RTN","PXBPPOV",59,0)
 I $D(XFLAG),XFLAG=1 S (Y,EDATA)=DATA G PFIN
"RTN","PXBPPOV",60,0)
LI1 ;
"RTN","PXBPPOV",61,0)
 ;--------If POV is already in the file
"RTN","PXBPPOV",62,0)
 I '$G(DOUBLEQQ),$D(PXBKY(DATA)) D
"RTN","PXBPPOV",63,0)
 .I PXBCNT>10 D DPOV4^PXBDPOV($O(PXBKY(DATA,0)))
"RTN","PXBPPOV",64,0)
 .K Q D TIMES^PXBUTL(DATA)
"RTN","PXBPPOV",65,0)
 .I Q=1 S LINE=$O(PXBKY(DATA,0)) S XFLAG=1 D REVPOV^PXBCC(LINE) S PRISEC=$P($G(PXBSAM(LINE)),"^",2) S:PRISEC["PRI" FPRI=0
"RTN","PXBPPOV",66,0)
 .I Q>1 S NLINE=0 F  S NLINE=$O(Q(NLINE)) Q:NLINE=""  D REVPOV^PXBCC(NLINE)
"RTN","PXBPPOV",67,0)
 I $D(Q),Q>1 D WHICH^PXBPWCH G LI
"RTN","PXBPPOV",68,0)
 I $D(XFLAG),XFLAG=1 S Y=DATA G PFIN
"RTN","PXBPPOV",69,0)
 ;
"RTN","PXBPPOV",70,0)
 ;--------Need to do a DIC lookup on data
"RTN","PXBPPOV",71,0)
 I DATA'="??" D:DATA="?" EN1^PXBHLP0("PXB","POV",1,"",1) G:DATA="^P" P1 I DATA="?" G P
"RTN","PXBPPOV",72,0)
 I DATA="??" S DOUBLEQQ=1 D EN1^PXBHLP0("PXB","POV","",1,2) S:$L(DATA,"^")>1 (Y,DATA,EDATA)=$P($P(DATA,"^",2),"--",1) G:Y>1 PFIN G:Y?1A1.NP PFIN I DATA<1 S DATA="^P" G P1
"RTN","PXBPPOV",73,0)
 ;
"RTN","PXBPPOV",74,0)
 ;--If a "?" is NOT entered during lookup
"RTN","PXBPPOV",75,0)
 S (VAL,Y)=$$DOUBLE1^PXBGPOV2(WHAT) I Y<1 S DATA="^P" G P1
"RTN","PXBPPOV",76,0)
 ;<-*92*-<  S (X,DATA,EDATA)=$P(VAL,"^",2),DIC=80,DIC(0)="MZ" D ^DIC
"RTN","PXBPPOV",77,0)
 S (DATA,EDATA)=$P(VAL,"^",2),X="`"_+$P(Y,"^",1) K Y S DIC=80,DIC(0)="MZ",DIC("S")="I $P($$ICDDX^ICDCODE(Y,IDATE),U,10)" D ^DIC  ;** PX*1.0*92    05/01/2001  make ^DIC selection "exact."
"RTN","PXBPPOV",78,0)
 ;
"RTN","PXBPPOV",79,0)
 ;--If Y is good and already in file...
"RTN","PXBPPOV",80,0)
 I '$G(DOUBLEQQ),$D(Y),$D(PXBKY($P(Y,"^",2))) D
"RTN","PXBPPOV",81,0)
 .S LINE=$O(PXBKY($P(Y,"^",2),0)) ;---D REVPOV^PXBCC(LINE)
"RTN","PXBPPOV",82,0)
 .S PRISEC=$P($G(PXBSAM(LINE)),"^",4) S:PRISEC["PRI" FPRI=0
"RTN","PXBPPOV",83,0)
 S POV=Y(0)
"RTN","PXBPPOV",84,0)
 ;
"RTN","PXBPPOV",85,0)
PFIN ;--Finish the DIAGNOSIS
"RTN","PXBPPOV",86,0)
 I $L(Y,"^")'>1 S X=Y,DIC=80,DIC(0)="IZM",DIC("S")="I $P($$ICDDX^ICDCODE(Y,IDATE),U,10)" D ^DIC
"RTN","PXBPPOV",87,0)
 I +Y<0 D HELP1^PXBUTL1("POV") G P
"RTN","PXBPPOV",88,0)
 S POV=Y(0)
"RTN","PXBPPOV",89,0)
 ;get the correct diagnosis descriptor
"RTN","PXBPPOV",90,0)
 N DXINF S DXINF=$$ICDDX^ICDCODE(+Y,IDATE),$P(POV,U,3)=$P(DXINF,U,4)
"RTN","PXBPPOV",91,0)
 S PXBNPOV($P(POV,"^",1))=""
"RTN","PXBPPOV",92,0)
 S PXBNPOVL(1)=$P(POV,"^",1) S ^DISV(DUZ,"PXBPOV-3")=DATA
"RTN","PXBPPOV",93,0)
 I $D(PXBKY($P(Y(0),"^"))),$G(SELINE) S $P(REQI,"^",9)=$O(PXBSKY(SELINE,0))
"RTN","PXBPPOV",94,0)
 I $D(PXBKY($P(Y(0),"^"))),'$G(SELINE) S $P(REQI,"^",9)=$O(PXBSKY($O(PXBKY($P(Y(0),"^"),0)),0))
"RTN","PXBPPOV",95,0)
 I +Y>0 S PXBEDIS=$P(DXINF,U,4)
"RTN","PXBPPOV",96,0)
 S $P(REQI,"^",5)=+Y,$P(REQI,"^",6)="S"
"RTN","PXBPPOV",97,0)
 S $P(REQE,"^",5)=$P(POV,"^",1)_" --"_$G(PXBEDIS),$P(REQE,"^",6)="SECONDARY"
"RTN","PXBPPOV",98,0)
POVX ;--EXIT AND CLEAN UP
"RTN","PXBPPOV",99,0)
 I $G(WHAT)="INTV",DATA="^" S PXBEXIT="^^"
"RTN","PXBPPOV",100,0)
 I '$D(REQE) S REQE=""
"RTN","PXBPPOV",101,0)
 I $P(REQE,"^",5)="" S $P(REQE,"^",5)="...No Diagnosis Selected..."
"RTN","PXBPPOV",102,0)
 Q
"RTN","PXBPPOV1")
0^50^B23470728
"RTN","PXBPPOV1",1,0)
PXBPPOV1 ;ISL/JVS,ESW - PROMPT POV ;4/6/05 2:41pm
"RTN","PXBPPOV1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,112,121,124**;Aug 12, 1996
"RTN","PXBPPOV1",3,0)
 ;
"RTN","PXBPPOV1",4,0)
 ;
"RTN","PXBPPOV1",5,0)
 ;
"RTN","PXBPPOV1",6,0)
 ;
"RTN","PXBPPOV1",7,0)
 ;
"RTN","PXBPPOV1",8,0)
ADDM ;--------If Multiple POV entries have been entered.
"RTN","PXBPPOV1",9,0)
 ;
"RTN","PXBPPOV1",10,0)
 ;
"RTN","PXBPPOV1",11,0)
 ;
"RTN","PXBPPOV1",12,0)
 N OK,PXBLEN,BDATA
"RTN","PXBPPOV1",13,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPPOV1",14,0)
 S NF=0,PXBLEN=0
"RTN","PXBPPOV1",15,0)
 I DATA[",",$E(DATA,1)'["@" S NF=1 D
"RTN","PXBPPOV1",16,0)
 .S PXBLEN=$L(DATA,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPPOV1",17,0)
 ..S X=PXBPIECE,DIC=80,DIC(0)="IMZ",DIC("S")="I $P($$ICDDX^ICDCODE(Y,IDATE),U,10)" D ^DIC
"RTN","PXBPPOV1",18,0)
 ..I Y=-1 S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPPOV1",19,0)
 ..S $P(REQI,"^",5)=+Y
"RTN","PXBPPOV1",20,0)
 ..S PXBNPOV(PXBPIECE)=""
"RTN","PXBPPOV1",21,0)
 ..;
"RTN","PXBPPOV1",22,0)
 ..;--Prompt for Primary or Secondary DIAGNOSIS
"RTN","PXBPPOV1",23,0)
 ..W !,"For the DIAGNOSIS: ",PXBPIECE,"--"
"RTN","PXBPPOV1",24,0)
 ..W $P($$ICDDX^ICDCODE(PXBPIECE,IDATE),U,2),!
"RTN","PXBPPOV1",25,0)
 ..D WIN17^PXBCC(PXBCNT)
"RTN","PXBPPOV1",26,0)
 ..D PRI^PXBPPOV1
"RTN","PXBPPOV1",27,0)
 ..I $D(DIRUT) D RSET^PXBDREQ("POV") Q
"RTN","PXBPPOV1",28,0)
 ..D ORD^PXBPPOV1
"RTN","PXBPPOV1",29,0)
 ..N PXCEVIEN,PXCEAFTR,PXD
"RTN","PXBPPOV1",30,0)
 ..S PXCEVIEN=PXBVST,PXD=$P(REQI,U,5)
"RTN","PXBPPOV1",31,0)
 ..D WIN17^PXBCC(PXBCNT),GET800^PXCEC800 ;CI's
"RTN","PXBPPOV1",32,0)
 ..S PXBREQ(PXD,"I")=$G(PXCEAFTR(800))
"RTN","PXBPPOV1",33,0)
 ..;
"RTN","PXBPPOV1",34,0)
 ..D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPPOV1",35,0)
 ..D EN1^PXKMAIN
"RTN","PXBPPOV1",36,0)
 ..D RSET^PXBDREQ("POV")
"RTN","PXBPPOV1",37,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPPOV1",38,0)
 .S (BDATA,EDATA)="" F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPPOV1",39,0)
 .W ! D HELP^PXBUTL0("CPTM") W !
"RTN","PXBPPOV1",40,0)
 .S DIR(0)="E" D ^DIR K DIR,DIRUT
"RTN","PXBPPOV1",41,0)
 .S:Y=1 DATA="^P" S:Y=0!(Y="") DATA="^" K Y
"RTN","PXBPPOV1",42,0)
 I $G(NF)&('$D(BAD)) S DATA="^P" Q
"RTN","PXBPPOV1",43,0)
 ;
"RTN","PXBPPOV1",44,0)
 Q
"RTN","PXBPPOV1",45,0)
 ;
"RTN","PXBPPOV1",46,0)
DELM ;--------If Multiple deleting
"RTN","PXBPPOV1",47,0)
 N DELM,PXBJ,BAD,PXBLEN,BDATA
"RTN","PXBPPOV1",48,0)
 S NF=0,PXBLEN=0 S $P(DELM,"^",3)=1
"RTN","PXBPPOV1",49,0)
 I $E(DATA,1)="@" S DATA=$P(DATA,"@",2),NF=1 D
"RTN","PXBPPOV1",50,0)
 .S PXBLEN=$L(DATA,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPPOV1",51,0)
 ..I PXBPIECE'["-"&(PXBPIECE'>0!(PXBPIECE'<(PXBCNT+1))) S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPPOV1",52,0)
 ..I PXBPIECE'["-" D
"RTN","PXBPPOV1",53,0)
 ...I $D(GONE(PXBPIECE)) Q
"RTN","PXBPPOV1",54,0)
 ...Q:PXBPIECE'?.N
"RTN","PXBPPOV1",55,0)
 ...S $P(REQI,"^",9)=$O(PXBSKY(PXBPIECE,0)) ;-IEN
"RTN","PXBPPOV1",56,0)
 ...S X=$P(PXBSAM(PXBPIECE),"^",1),DIC=80,DIC(0)="IZM",DIC("S")="I $P($$ICDDX^ICDCODE(Y,IDATE),U,10)" D ^DIC
"RTN","PXBPPOV1",57,0)
 ...S $P(REQI,"^",5)=+Y K Y
"RTN","PXBPPOV1",58,0)
 ...S GONE(PXBPIECE)=""
"RTN","PXBPPOV1",59,0)
 ...D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPPOV1",60,0)
 ...D EN1^PXKMAIN
"RTN","PXBPPOV1",61,0)
 ..I PXBPIECE["-" D
"RTN","PXBPPOV1",62,0)
 ...F PXBJ=$P(PXBPIECE,"-",1):1:$P(PXBPIECE,"-",2) D
"RTN","PXBPPOV1",63,0)
 ....I $D(GONE(PXBJ)) Q
"RTN","PXBPPOV1",64,0)
 ....I PXBJ'>0!(PXBJ'<(PXBCNT+1)) S BAD(PXBJ)="" Q
"RTN","PXBPPOV1",65,0)
 ....S $P(REQI,"^",9)=$O(PXBSKY(PXBJ,0)) ;-IEN
"RTN","PXBPPOV1",66,0)
 ....S X=$P(PXBSAM(PXBJ),"^",1),DIC=80,DIC(0)="IZM",DIC("S")="I $P($$ICDDX^ICDCODE(Y,IDATE),U,10)" D ^DIC
"RTN","PXBPPOV1",67,0)
 ....S $P(REQI,"^",5)=+Y K Y
"RTN","PXBPPOV1",68,0)
 ....S GONE(PXBJ)=""
"RTN","PXBPPOV1",69,0)
 ....D EN0^PXBSTOR(PXBVST,PATIENT,REQI)
"RTN","PXBPPOV1",70,0)
 ....D EN1^PXKMAIN
"RTN","PXBPPOV1",71,0)
 K GONE
"RTN","PXBPPOV1",72,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPPOV1",73,0)
 .S (BDATA,EDATA)="" F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPPOV1",74,0)
 .W ! D HELP^PXBUTL0("CPTMD") W !
"RTN","PXBPPOV1",75,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","PXBPPOV1",76,0)
 .S:Y=1 DATA="^P" S:Y=0!(Y="") DATA="^" K Y
"RTN","PXBPPOV1",77,0)
 I $G(NF)&('$D(BAD)) S DATA="^P" Q
"RTN","PXBPPOV1",78,0)
 Q
"RTN","PXBPPOV1",79,0)
PRI ;--Prompt for primary secondary DIAGNOSIS
"RTN","PXBPPOV1",80,0)
 N DIR,Y,X,SEQ
"RTN","PXBPPOV1",81,0)
 S SEQ=0 I $D(PXBKY(DATA)) S SEQ=+$O(PXBKY(DATA,"")) ;PX112
"RTN","PXBPPOV1",82,0)
 I $G(FPRI),$P($G(PXBKY(DATA,SEQ)),U,4)'="PRIMARY" Q  ;PX112
"RTN","PXBPPOV1",83,0)
 W IOCUD,IOELALL,IOCUU
"RTN","PXBPPOV1",84,0)
 S DIR("A",1)="ONE primary diagnosis must be established for each encounter!"
"RTN","PXBPPOV1",85,0)
 S DIR("A")="Is this the PRIMARY DIAGNOSIS for this ENCOUNTER? "
"RTN","PXBPPOV1",86,0)
 S DIR("B")="YES"
"RTN","PXBPPOV1",87,0)
 S DIR("?")="One PRIMARY DIAGNOSIS must be established for each patient encounter. 'Yes' will mean PRIMARY and 'No' will mean SECONDARY."
"RTN","PXBPPOV1",88,0)
 S DIR(0)="Y,A,O"
"RTN","PXBPPOV1",89,0)
 D ^DIR I $G(DIRUT) G PPXIT
"RTN","PXBPPOV1",90,0)
PPFIN ;--Finish off variables
"RTN","PXBPPOV1",91,0)
 I Y=1 S PRI="P^PRIMARY"
"RTN","PXBPPOV1",92,0)
 I Y=0 S PRI="S^SECONDARY"
"RTN","PXBPPOV1",93,0)
 S $P(REQI,"^",6)=$P(PRI,"^",1)
"RTN","PXBPPOV1",94,0)
 S $P(REQE,"^",6)=$P(PRI,"^",2)
"RTN","PXBPPOV1",95,0)
PPXIT ;--EXIT
"RTN","PXBPPOV1",96,0)
 Q
"RTN","PXBPPOV1",97,0)
ORD ;--Prompt for ordering resulting DIAGNOSIS
"RTN","PXBPPOV1",98,0)
 N DIR,Y,X,SEQ
"RTN","PXBPPOV1",99,0)
 S SEQ=0 I $D(PXBKY(DATA)) S SEQ=+$O(PXBKY(DATA,""))
"RTN","PXBPPOV1",100,0)
 W IOCUD,IOELALL,IOCUU
"RTN","PXBPPOV1",101,0)
 S DIR("A")="Is this Diagnosis Ordering or Resulting:"
"RTN","PXBPPOV1",102,0)
 S DIR("B")=$P($G(PXBKY(DATA,SEQ)),U,7)
"RTN","PXBPPOV1",103,0)
 S DIR("?")="Resulting and/or Ordering indicators are only entered if at least one of each diagnosis type exists."
"RTN","PXBPPOV1",104,0)
 S DIR(0)="SO^O:ORDERING;R:RESULTING;OR:BOTH O&R"
"RTN","PXBPPOV1",105,0)
 D ^DIR I $G(DIRUT) G PPXIT
"RTN","PXBPPOV1",106,0)
ORFIN ;--Finish off variables
"RTN","PXBPPOV1",107,0)
 S $P(REQI,"^",7)=Y
"RTN","PXBPPOV1",108,0)
 S $P(REQE,"^",7)=$S(Y="O":"ORDERING",Y="R":"RESULTING",1:"BOTH O&R")
"RTN","PXBPPOV1",109,0)
 Q
"RTN","PXBPPOV1",110,0)
PRBLM ;--Prompt for Problem list
"RTN","PXBPPOV1",111,0)
 N DIR,Y,X,VALL
"RTN","PXBPPOV1",112,0)
 W IOCUD,IOELALL,IOCUU
"RTN","PXBPPOV1",113,0)
 D WIN17^PXBCC(PXBCNT)
"RTN","PXBPPOV1",114,0)
 S DIR("?")="^S VALL=1,VALL=$$DOUBLE1^PXBGPL2(WHAT)"
"RTN","PXBPPOV1",115,0)
 S DIR("A")="Do you want this DIAGNOSIS added to the PROBLEM LIST? "
"RTN","PXBPPOV1",116,0)
 S DIR("B")="NO"
"RTN","PXBPPOV1",117,0)
 S DIR(0)="Y,A,O"
"RTN","PXBPPOV1",118,0)
 D ^DIR
"RTN","PXBPPOV1",119,0)
 I X="+"!(X="-") S DIR("?")="D DPOV4^PXBDPL(X)"
"RTN","PXBPPOV1",120,0)
 I $G(DIRUT) G PPXIT
"RTN","PXBPPOV1",121,0)
PRPFIN ;--Finish off variables
"RTN","PXBPPOV1",122,0)
 K PXBKYPL,PXBSKYPL,PXBSAMPL,PXBCNTPL
"RTN","PXBPPOV1",123,0)
 K ^TMP("PXBKYPL",$J),^TMP("PXBSAMPL",$J)
"RTN","PXBPPOV1",124,0)
 S PXBPRBLM=+Y
"RTN","PXBPPOV1",125,0)
PRPXIT ;--EXIT
"RTN","PXBPPOV1",126,0)
 Q
"RTN","PXBPPOV1",127,0)
 ;
"RTN","PXBPPRV1")
0^70^B14985969
"RTN","PXBPPRV1",1,0)
PXBPPRV1 ;ISL/JVS - PROMPT FOR PROVIDER ;10/26/04 5:26pm
"RTN","PXBPPRV1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,19,27,88,124**;Aug 12, 1996
"RTN","PXBPPRV1",3,0)
 ;
"RTN","PXBPPRV1",4,0)
 ;
"RTN","PXBPPRV1",5,0)
 ;
"RTN","PXBPPRV1",6,0)
ACTIVE ;---CHECK TO SEE IF ACTIVE PROVIDER
"RTN","PXBPPRV1",7,0)
 ;
"RTN","PXBPPRV1",8,0)
 N PROVIDER,VISIT,DIC,DR,DA,INACTIVE,OK,NOT,PROVEX,BDATA,ACTIVE
"RTN","PXBPPRV1",9,0)
 S PROVIDER=$P(REQI,"^",1) ;-Provider IEN
"RTN","PXBPPRV1",10,0)
 S PROVEX=$P(REQE,"^",1) ;-Provider External form
"RTN","PXBPPRV1",11,0)
 S VISIT=$P(IDATE,".",1) ;-Visit date Internal form
"RTN","PXBPPRV1",12,0)
 S DIC=200,DR=53.4,DA=PROVIDER,DIQ="INACTIVE",DIQ(0)="IN" D EN^DIQ1
"RTN","PXBPPRV1",13,0)
 I $D(INACTIVE),$G(INACTIVE(200,PROVIDER,53.4,"I"))<VISIT S NOT=1
"RTN","PXBPPRV1",14,0)
 S DIC=200,DR=9.2,DA=PROVIDER,DIQ="ACTIVE",DIQ(0)="IN" D EN^DIQ1
"RTN","PXBPPRV1",15,0)
 I $D(ACTIVE),$G(ACTIVE(200,PROVIDER,9.2,"I"))<VISIT S NOT=1
"RTN","PXBPPRV1",16,0)
 ;---I $G(NOT) W !,IOEDEOP,IORVON,"--WARNING!-",PROVEX," was INACTIVE on the date of this encounter.",IORVOFF D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBPPRV1",17,0)
 I $G(NOT) W !,IOEDEOP,IORVON,"--WARNING!-",PROVEX," was INACTIVE on the date of this encounter.",IORVOFF D PMPT
"RTN","PXBPPRV1",18,0)
 ;---------3/17/97--PART OF FUTURE PATCH 27
"RTN","PXBPPRV1",19,0)
 I '$G(NOT) D
"RTN","PXBPPRV1",20,0)
 .N CLASS
"RTN","PXBPPRV1",21,0)
 .S CLASS=+$$GET^XUA4A72(PROVIDER,VISIT) I CLASS<0 D
"RTN","PXBPPRV1",22,0)
 ..D RSET^PXBDREQ("PRV") S FPRI=1
"RTN","PXBPPRV1",23,0)
 ..W !,IOEDEOP,IORVON,"--ERROR!--",PROVEX," does not have an ACTIVE person class.",IORVOFF D HELP1^PXBUTL1("CON") R OK:DTIME
"RTN","PXBPPRV1",24,0)
 ;---------END 3/17/97
"RTN","PXBPPRV1",25,0)
AXIT ;--EXIT AND KILL
"RTN","PXBPPRV1",26,0)
 K DIQ
"RTN","PXBPPRV1",27,0)
 Q
"RTN","PXBPPRV1",28,0)
PMPT ;--PROMT FOR COMFIRMATION OF USING INACTIVE PORVIDER
"RTN","PXBPPRV1",29,0)
 S DIR("A")="Are you sure you want to select this provider? "
"RTN","PXBPPRV1",30,0)
 S DIR("B")="NO"
"RTN","PXBPPRV1",31,0)
 S DIR(0)="YA"
"RTN","PXBPPRV1",32,0)
 D ^DIR
"RTN","PXBPPRV1",33,0)
 I Y<1 D RSET^PXBDREQ("PRV")
"RTN","PXBPPRV1",34,0)
 Q
"RTN","PXBPPRV1",35,0)
 ;
"RTN","PXBPPRV1",36,0)
ADDM ;--------If Multiple entries have been entered
"RTN","PXBPPRV1",37,0)
 Q
"RTN","PXBPPRV1",38,0)
 ;---NOT POSSIBLE TO ADD MULTIPLE PROVIDERS
"RTN","PXBPPRV1",39,0)
 ;
"RTN","PXBPPRV1",40,0)
DELM ;--------If Multiple deleting
"RTN","PXBPPRV1",41,0)
 ;
"RTN","PXBPPRV1",42,0)
 N DELM,CNT,CPTPRV,PXBJ,BAD,PXBLEN,BDATA
"RTN","PXBPPRV1",43,0)
 S (NF,CNT)=0,PXBLEN=0 S $P(DELM,"^",1)=1
"RTN","PXBPPRV1",44,0)
 I $E(DATA,1)="@" S DATA=$P(DATA,"@",2),NF=1 D
"RTN","PXBPPRV1",45,0)
 .S PXBLEN=$L(DATA,",") F PXI=1:1:PXBLEN S PXBPIECE=$P(DATA,",",PXI) D
"RTN","PXBPPRV1",46,0)
 ..I PXBPIECE'["-"&(PXBPIECE'>0!(PXBPIECE'<(PXBCNT+1))) S BAD(+$G(PXBPIECE))="" Q
"RTN","PXBPPRV1",47,0)
 ..I PXBPIECE'["-" D
"RTN","PXBPPRV1",48,0)
 ...I $D(GONE(PXBPIECE)) Q
"RTN","PXBPPRV1",49,0)
 ...Q:PXBPIECE'?.N
"RTN","PXBPPRV1",50,0)
 ...Q:+PXBPIECE'=PXBPIECE
"RTN","PXBPPRV1",51,0)
 ...S $P(REQI,"^",7)=$O(PXBSKY(PXBPIECE,0)) ;-IEN
"RTN","PXBPPRV1",52,0)
 ...S X=$P(PXBSAM(PXBPIECE),"^",1),DIC="^VA(200,",DIC(0)="ZM" D ^DIC
"RTN","PXBPPRV1",53,0)
 ...S $P(REQI,"^",1)=+Y S CPTPRV=+Y K Y
"RTN","PXBPPRV1",54,0)
 ...S $P(REQI,"^",2)=$P(PXBSAM(PXBPIECE),"^",2) K Y
"RTN","PXBPPRV1",55,0)
 ...S GONE(PXBPIECE)=""
"RTN","PXBPPRV1",56,0)
 ...D EN0^PXBSTOR(PXBVST,PATIENT,REQI,$G(PXMREQ))
"RTN","PXBPPRV1",57,0)
 ...D EN1^PXKMAIN
"RTN","PXBPPRV1",58,0)
 ...I $G(WHAT)["CPT" D DCPT^PXBSTOR1(CPTPRV,PXBVST)
"RTN","PXBPPRV1",59,0)
 ..I PXBPIECE["-" D
"RTN","PXBPPRV1",60,0)
 ...S PXBJ=0 F PXBJ=$P(PXBPIECE,"-",1):1:$P(PXBPIECE,"-",2) D
"RTN","PXBPPRV1",61,0)
 ....I $D(GONE(PXBJ)) Q
"RTN","PXBPPRV1",62,0)
 ....I PXBJ'>0!(PXBJ'<(PXBCNT+1)) S BAD(PXBJ)="" Q
"RTN","PXBPPRV1",63,0)
 ....S $P(REQI,"^",7)=$O(PXBSKY(PXBJ,0)) ;-IEN
"RTN","PXBPPRV1",64,0)
 ....S X=$P(PXBSAM(PXBJ),"^",1),DIC="^VA(200,",DIC(0)="ZM" D ^DIC
"RTN","PXBPPRV1",65,0)
 ....S $P(REQI,"^",1)=+Y S CPTPRV=+Y K Y
"RTN","PXBPPRV1",66,0)
 ....S $P(REQI,"^",2)=$P(PXBSAM(PXBJ),"^",1)
"RTN","PXBPPRV1",67,0)
 ....S GONE(PXBJ)=""
"RTN","PXBPPRV1",68,0)
 ....D EN0^PXBSTOR(PXBVST,PATIENT,REQI,$G(PXMREQ))
"RTN","PXBPPRV1",69,0)
 ....D EN1^PXKMAIN
"RTN","PXBPPRV1",70,0)
 ....I $G(WHAT)["CPT" D DCPT^PXBSTOR1(CPTPRV,PXBVST)
"RTN","PXBPPRV1",71,0)
 K GONE
"RTN","PXBPPRV1",72,0)
 I $G(NF)&($D(BAD)) D  Q
"RTN","PXBPPRV1",73,0)
 .S (BDATA,EDATA)="" F  S BDATA=$O(BAD(BDATA)) Q:BDATA=""  S EDATA=EDATA_BDATA_"  "
"RTN","PXBPPRV1",74,0)
 .D WIN17^PXBCC(PXBCNT)
"RTN","PXBPPRV1",75,0)
 .W ! D HELP^PXBUTL0("PRVMD") W !
"RTN","PXBPPRV1",76,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","PXBPPRV1",77,0)
 .S:Y=1 DATA="^P" S:Y=0!(Y="") DATA="^" K Y
"RTN","PXBPPRV1",78,0)
 I $G(NF)&('$D(BAD)) S DATA="^P" Q
"RTN","PXBPPRV1",79,0)
 K PRVDR,PXBDPRV
"RTN","PXBPPRV1",80,0)
 Q
"RTN","PXBPPRV1",81,0)
 ;
"RTN","PXBPPRV1",82,0)
PRI ;--Prompt for primary secondary provider
"RTN","PXBPPRV1",83,0)
 ;
"RTN","PXBPPRV1",84,0)
 N DIR,Y,X
"RTN","PXBPPRV1",85,0)
 I $G(FPRI) Q
"RTN","PXBPPRV1",86,0)
 W IOCUD,IOELALL,IOCUU
"RTN","PXBPPRV1",87,0)
 S DIR("A")="Is this the PRIMARY provider for this ENCOUNTER? "
"RTN","PXBPPRV1",88,0)
 S DIR("B")="YES"
"RTN","PXBPPRV1",89,0)
 S DIR("?")="One PRIMARY Provider must be established for each patient encounter. 'Yes' will mean PRIMARY and 'No' will mean SECONDARY."
"RTN","PXBPPRV1",90,0)
 S DIR(0)="Y,A,O"
"RTN","PXBPPRV1",91,0)
 D ^DIR I $G(DIRUT) G PPXIT
"RTN","PXBPPRV1",92,0)
PPFIN ;--Finish off variables
"RTN","PXBPPRV1",93,0)
 I Y=1 S PRI="P^PRIMARY"
"RTN","PXBPPRV1",94,0)
 I Y=0 S PRI="S^SECONDARY"
"RTN","PXBPPRV1",95,0)
 S $P(REQI,"^",2)=$P(PRI,"^",1)
"RTN","PXBPPRV1",96,0)
 S $P(REQE,"^",2)=$P(PRI,"^",2)
"RTN","PXBPPRV1",97,0)
PPXIT ;--EXIT
"RTN","PXBPPRV1",98,0)
 Q
"RTN","PXBSTOR")
0^4^B38312987
"RTN","PXBSTOR",1,0)
PXBSTOR ;ISL/JVS - PASSING THE DATA TO THE V FILES ;3/21/05 1:35pm
"RTN","PXBSTOR",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,88,149,124**;Aug 12, 1996
"RTN","PXBSTOR",3,0)
 ;
"RTN","PXBSTOR",4,0)
 ;  VARIABLE LIST
"RTN","PXBSTOR",5,0)
 ;  PEICE   1        2     3     4      5     6       7       8       9
"RTN","PXBSTOR",6,0)
 ;  REQ*=PROVDER^PRIMARY^CPT^QUANTITY^POV^PRIMARY^PRV IEN^CPT IEN^POV IEN
"RTN","PXBSTOR",7,0)
 ;  PEICE   10       11        12  13  14  15  16  17  18  19  20   21    22
"RTN","PXBSTOR",8,0)
 ;  REQ  STOPCODE^STOPCODE IEN^DX1^DX2^DX3^DX4^DX5^DX6^DX7^DX8^DX9^DX10^OrdPrv
"RTN","PXBSTOR",9,0)
 ;                             (DX5 - DX10 for future use)
"RTN","PXBSTOR",10,0)
 ;  REQ(1,MODIFIER)*=""
"RTN","PXBSTOR",11,0)
 ;  REQ("IEN")=V CPT file IEN
"RTN","PXBSTOR",12,0)
 ;  REQI=Internal Values
"RTN","PXBSTOR",13,0)
 ;  REQE=External Values
"RTN","PXBSTOR",14,0)
 ;  PXBVST=Visit Ien
"RTN","PXBSTOR",15,0)
 ;  PRVIEN=Provider IEN in V Provider file
"RTN","PXBSTOR",16,0)
 ;  CPTIEN=CPT IEN in V CPT file
"RTN","PXBSTOR",17,0)
 ;  POVIEN=POV IEN in V POV file
"RTN","PXBSTOR",18,0)
 ;  patient is defined from the visit
"RTN","PXBSTOR",19,0)
 ;
"RTN","PXBSTOR",20,0)
EN0(PXBVST,PATIENT,REQI,REQ) ;--Main Entry point
"RTN","PXBSTOR",21,0)
EN1 ;
"RTN","PXBSTOR",22,0)
 Q:'$D(REQI)!$G(PXBVST)<1
"RTN","PXBSTOR",23,0)
 K ^TMP("PXK",$J) ;--MUST BE MOVED TO AFTER THE EVENT
"RTN","PXBSTOR",24,0)
 N PRVIEN,CPTIEN,POVIEN,PRVBEF,CPTBEF,POVBEF,PPRNARR,CPRNARR
"RTN","PXBSTOR",25,0)
 N POVBEF12,PRVAFT,PRVAFT12,PRVBEF12,POVAFT12,POVAFT,POVI
"RTN","PXBSTOR",26,0)
 N CPTAFT,CPTAFT1,CPTBEF1,CPTAFT12,CPTBEF12,POVBF800,POVAF800
"RTN","PXBSTOR",27,0)
 N PRVBF812,CPTBF812,POVBF812,PRVAF812,CPTAF812,POVAF812,SEQ,CTR
"RTN","PXBSTOR",28,0)
 ;
"RTN","PXBSTOR",29,0)
SET ;--SET TEMP GLOBALS
"RTN","PXBSTOR",30,0)
 S SEQ=$$SET^PXBSTOR1
"RTN","PXBSTOR",31,0)
 D:$P(REQI,"^",1) PRV S SEQ=SEQ+1
"RTN","PXBSTOR",32,0)
 D:$P(REQI,"^",3) CPT S SEQ=SEQ+1
"RTN","PXBSTOR",33,0)
 D:$P(REQI,"^",5) POV S SEQ=SEQ+1
"RTN","PXBSTOR",34,0)
 F CTR=12:1:19 D:$P(REQI,U,CTR) DX S SEQ=SEQ+1
"RTN","PXBSTOR",35,0)
 S ^TMP("PXBSTOR",$J,"SEQ")=SEQ+1
"RTN","PXBSTOR",36,0)
 Q
"RTN","PXBSTOR",37,0)
PRV ;--PROVIDER PIECE 1 AND 2
"RTN","PXBSTOR",38,0)
 S PRVAFT=PRVBEF,PRVAFT12=PRVBEF12,PRVAF812=PRVBF812
"RTN","PXBSTOR",39,0)
 I $D(DELM),$P(DELM,"^",1)=1 S (PRVAFT,PRVAFT12)="" G PRV1
"RTN","PXBSTOR",40,0)
 S $P(PRVAFT,"^",1)=$P(REQI,"^",1) ;--PROVIDER IEN
"RTN","PXBSTOR",41,0)
 S $P(PRVAFT,"^",4)=$P(REQI,"^",2) ;--PRIMARY/SECONDARY
"RTN","PXBSTOR",42,0)
 S $P(PRVAFT,"^",2)=PATIENT ;--PATIENT
"RTN","PXBSTOR",43,0)
 S $P(PRVAFT,"^",3)=PXBVST ;--VISIT POINTER
"RTN","PXBSTOR",44,0)
 I PRVBF812']"" D
"RTN","PXBSTOR",45,0)
 .;-***POPULATE VERIFIED FIELD IN FUTURE
"RTN","PXBSTOR",46,0)
 .S $P(PRVAF812,"^",2)=$G(PXBPKG)
"RTN","PXBSTOR",47,0)
 .S $P(PRVAF812,"^",3)=$G(PXBSOURC)
"RTN","PXBSTOR",48,0)
PRV1 S ^TMP("PXK",$J,"PRV",SEQ,0,"AFTER")=PRVAFT
"RTN","PXBSTOR",49,0)
 S ^TMP("PXK",$J,"PRV",SEQ,0,"BEFORE")=PRVBEF
"RTN","PXBSTOR",50,0)
 S ^TMP("PXK",$J,"PRV",SEQ,12,"AFTER")=PRVAFT12
"RTN","PXBSTOR",51,0)
 S ^TMP("PXK",$J,"PRV",SEQ,12,"BEFORE")=PRVBEF12
"RTN","PXBSTOR",52,0)
 S ^TMP("PXK",$J,"PRV",SEQ,812,"AFTER")=PRVAF812
"RTN","PXBSTOR",53,0)
 S ^TMP("PXK",$J,"PRV",SEQ,812,"BEFORE")=PRVBF812
"RTN","PXBSTOR",54,0)
 S ^TMP("PXK",$J,"PRV",SEQ,"IEN")=PRVIEN
"RTN","PXBSTOR",55,0)
 Q
"RTN","PXBSTOR",56,0)
 ;
"RTN","PXBSTOR",57,0)
CPT ;--CPT PROCDEURE PIECE 3 AND 4
"RTN","PXBSTOR",58,0)
 N PXMODIEN
"RTN","PXBSTOR",59,0)
 S CPTAFT=CPTBEF,CPTAFT12=CPTBEF12,CPTAF812=CPTBF812
"RTN","PXBSTOR",60,0)
 I $D(DELM),$P(DELM,"^",2)=1 S (CPTAFT,CPTAFT12)="" G CPT1
"RTN","PXBSTOR",61,0)
 S $P(CPTAFT,"^",1)=$P(REQI,"^",3) ;--PROCEDURE IEN 
"RTN","PXBSTOR",62,0)
 S $P(CPTAFT,"^",2)=PATIENT ;--PATIENT
"RTN","PXBSTOR",63,0)
 S $P(CPTAFT,"^",3)=PXBVST ;--VISIT POINTER
"RTN","PXBSTOR",64,0)
 S $P(CPTAFT12,"^",4)=$P(REQI,"^",1) ;--PROVIDER POINTER
"RTN","PXBSTOR",65,0)
 S $P(CPTAFT12,"^",2)=$P(REQI,"^",22) ;--ORDERING PROVIDER POINTER
"RTN","PXBSTOR",66,0)
 S CPRNARR=$P($$CPT^ICPTCOD($P(REQI,"^",3),$G(IDATE)),U,3) ;--TEXT PROV NARR
"RTN","PXBSTOR",67,0)
 S $P(CPTAFT,"^",4)=+$$PROVNARR^PXAPI($G(CPRNARR),9000010.18) ;--PROV NAR
"RTN","PXBSTOR",68,0)
 S $P(CPTAFT,"^",16)=$P(REQI,"^",4) ;--QUANTITY
"RTN","PXBSTOR",69,0)
 S $P(CPTAFT,"^",5)=$P(REQI,"^",12) ;DX1 (REQUIRED)
"RTN","PXBSTOR",70,0)
 S $P(REQI,U,19)=$P(REQI,U,19) ;INSURE AT LEAST 19 PIECES IN REQI
"RTN","PXBSTOR",71,0)
 S $P(CPTAFT,"^",9,15)=$P(REQI,"^",13,19) ;DX2 - DX4, DX5 - DX8
"RTN","PXBSTOR",72,0)
 I $P(REQI,"^",4)=0 S (CPTAFT,CPTAFT12)=""
"RTN","PXBSTOR",73,0)
 I $P(REQI,"^",4)="@" S (CPTAFT,CPTAFT12)=""
"RTN","PXBSTOR",74,0)
 ;--------------------
"RTN","PXBSTOR",75,0)
 ;I $G(CPTIEN),$D(^AUPNVCPT(CPTIEN,12)),$P(REQI,"^",1)'=$P(^AUPNVCPT(CPTIEN,12),"^",4),'$D(DELM) S (CPTIEN,CPTBEF,CPTBEF12)=""
"RTN","PXBSTOR",76,0)
 ;---------------
"RTN","PXBSTOR",77,0)
 I CPTBF812']"" D
"RTN","PXBSTOR",78,0)
 .;-***POPULATE VERIFIED FIELD IN FUTURE
"RTN","PXBSTOR",79,0)
 .S $P(CPTAF812,"^",2)=$G(PXBPKG)
"RTN","PXBSTOR",80,0)
 .S $P(CPTAF812,"^",3)=$G(PXBSOURC)
"RTN","PXBSTOR",81,0)
 S PXMODIEN=""
"RTN","PXBSTOR",82,0)
 F  S PXMODIEN=$O(REQ(1,PXMODIEN)) Q:PXMODIEN=""  D
"RTN","PXBSTOR",83,0)
 .S CPTAFT1(PXMODIEN)=REQ(1,PXMODIEN)
"RTN","PXBSTOR",84,0)
CPT1 ;
"RTN","PXBSTOR",85,0)
 S ^TMP("PXK",$J,"CPT",SEQ,0,"AFTER")=CPTAFT
"RTN","PXBSTOR",86,0)
 S ^TMP("PXK",$J,"CPT",SEQ,0,"BEFORE")=CPTBEF
"RTN","PXBSTOR",87,0)
 S ^TMP("PXK",$J,"CPT",SEQ,12,"AFTER")=CPTAFT12
"RTN","PXBSTOR",88,0)
 S ^TMP("PXK",$J,"CPT",SEQ,12,"BEFORE")=CPTBEF12
"RTN","PXBSTOR",89,0)
 S ^TMP("PXK",$J,"CPT",SEQ,812,"AFTER")=CPTAF812
"RTN","PXBSTOR",90,0)
 S ^TMP("PXK",$J,"CPT",SEQ,812,"BEFORE")=CPTBF812
"RTN","PXBSTOR",91,0)
 S ^TMP("PXK",$J,"CPT",SEQ,"IEN")=CPTIEN
"RTN","PXBSTOR",92,0)
 ;Set modifiers into ^TMP
"RTN","PXBSTOR",93,0)
 S PXMODIEN=""
"RTN","PXBSTOR",94,0)
 F  S PXMODIEN=$O(CPTAFT1(PXMODIEN)) Q:PXMODIEN=""  D
"RTN","PXBSTOR",95,0)
 .S ^TMP("PXK",$J,"CPT",SEQ,1,PXMODIEN,"AFTER")=CPTAFT1(PXMODIEN)
"RTN","PXBSTOR",96,0)
 S PXMODIEN=""
"RTN","PXBSTOR",97,0)
 F  S PXMODIEN=$O(CPTBEF1(PXMODIEN)) Q:PXMODIEN=""  D
"RTN","PXBSTOR",98,0)
 .S ^TMP("PXK",$J,"CPT",SEQ,1,PXMODIEN,"BEFORE")=CPTBEF1(PXMODIEN)
"RTN","PXBSTOR",99,0)
 ;Set ^TMP file with V CPT IEN
"RTN","PXBSTOR",100,0)
 I $G(REQ)]"" D
"RTN","PXBSTOR",101,0)
 . S ^TMP("PXK",$J,"CPT",SEQ,"IEN")=REQ
"RTN","PXBSTOR",102,0)
 Q
"RTN","PXBSTOR",103,0)
 ;
"RTN","PXBSTOR",104,0)
POV ;--POV PIECE 5 AND 6
"RTN","PXBSTOR",105,0)
 S POVAFT=POVBEF,POVAFT12=POVBEF12,POVAF812=POVBF812,POVAF800=POVBF800
"RTN","PXBSTOR",106,0)
 S POVAFT17=POVBEF17
"RTN","PXBSTOR",107,0)
 I $D(DELM),$P(DELM,"^",3)=1 S (POVAFT,POVAFT12,POVAF800)="" G POV1
"RTN","PXBSTOR",108,0)
 S $P(POVAFT,"^",1)=$P(REQI,"^",5) ;--POV IEN 
"RTN","PXBSTOR",109,0)
 S $P(POVAFT,"^",12)=$P(REQI,"^",6) ;--PRI/SECONDARY
"RTN","PXBSTOR",110,0)
 S $P(POVAFT,U,17)=$P(REQI,U,7) ;--ORDERING/RESULTING
"RTN","PXBSTOR",111,0)
 S $P(POVAFT,"^",2)=PATIENT ;--PATIENT
"RTN","PXBSTOR",112,0)
 S $P(POVAFT,"^",3)=PXBVST ;--VISIT POINTER
"RTN","PXBSTOR",113,0)
 S PPRNARR=$$DXNARR^PXUTL1($P(REQI,"^",5),$G(IDATE)) ;--TEXT PROV NARR
"RTN","PXBSTOR",114,0)
 S $P(POVAFT,"^",4)=+$$PROVNARR^PXAPI($G(PPRNARR),9000010.07) ;--POI PROV NARR
"RTN","PXBSTOR",115,0)
 I $P($G(REQI),"^",7) S $P(POVAFT12,"^",4)=$P(^AUPNVPRV($P(REQI,"^",7),0),"^",1) ;--PROVIDER
"RTN","PXBSTOR",116,0)
 I $G(PXBRES) S $P(POVAFT,"^",16)=PXBRES ;-PROBLEM LIST ENTRY
"RTN","PXBSTOR",117,0)
 I POVBF812']"" D
"RTN","PXBSTOR",118,0)
 .;-**POPULATE VERIFIED FIELD IN FUTURE
"RTN","PXBSTOR",119,0)
 .S $P(POVAF812,"^",2)=$G(PXBPKG)
"RTN","PXBSTOR",120,0)
 .S $P(POVAF812,"^",3)=$G(PXBSOURC)
"RTN","PXBSTOR",121,0)
 I $D(PXBREQ($P(REQI,U,5))) S POVAF800=$G(PXBREQ($P(REQI,U,5),"I"))
"RTN","PXBSTOR",122,0)
POV1 S ^TMP("PXK",$J,"POV",SEQ,0,"AFTER")=POVAFT
"RTN","PXBSTOR",123,0)
 S ^TMP("PXK",$J,"POV",SEQ,0,"BEFORE")=POVBEF
"RTN","PXBSTOR",124,0)
 S ^TMP("PXK",$J,"POV",SEQ,12,"AFTER")=POVAFT12
"RTN","PXBSTOR",125,0)
 S ^TMP("PXK",$J,"POV",SEQ,12,"BEFORE")=POVBEF12
"RTN","PXBSTOR",126,0)
 S ^TMP("PXK",$J,"POV",SEQ,17,"AFTER")=POVAFT17
"RTN","PXBSTOR",127,0)
 S ^TMP("PXK",$J,"POV",SEQ,17,"BEFORE")=POVBEF17
"RTN","PXBSTOR",128,0)
 S ^TMP("PXK",$J,"POV",SEQ,812,"AFTER")=POVAF812
"RTN","PXBSTOR",129,0)
 S ^TMP("PXK",$J,"POV",SEQ,812,"BEFORE")=POVBF812
"RTN","PXBSTOR",130,0)
 S ^TMP("PXK",$J,"POV",SEQ,800,"AFTER")=POVAF800
"RTN","PXBSTOR",131,0)
 S ^TMP("PXK",$J,"POV",SEQ,800,"BEFORE")=POVBF800
"RTN","PXBSTOR",132,0)
 S ^TMP("PXK",$J,"POV",SEQ,"IEN")=POVIEN
"RTN","PXBSTOR",133,0)
 Q
"RTN","PXBSTOR",134,0)
 ;
"RTN","PXBSTOR",135,0)
DX ;CPT DIAGNOSIS - PX124
"RTN","PXBSTOR",136,0)
 N POVIEN,POVBF800,POVBF812,POVBEF12,POVBEF,POVBEF17
"RTN","PXBSTOR",137,0)
 N IEN,ANS,POVAF800,POVAF812,POVAFT12,POVAFT,POVAFT17
"RTN","PXBSTOR",138,0)
 S IEN=$P(REQI,U,CTR),ANS=$$XLATE^PXBGPOV(PXBVST,IEN),POVIEN=+ANS
"RTN","PXBSTOR",139,0)
 I POVIEN D
"RTN","PXBSTOR",140,0)
 .S POVBEF=$G(^AUPNVPOV(POVIEN,0)),POVBEF12=$G(^(12)),POVBF812=$G(^(812)),POVBF800=$G(^(800)),POVBEF17=$G(^(17))
"RTN","PXBSTOR",141,0)
 E  S (POVBF800,POVBF812,POVBEF12,POVBEF17,POVBEF)=""
"RTN","PXBSTOR",142,0)
 S POVAFT=POVBEF,POVAFT12=POVBEF12,POVAF812=POVBF812,POVAF800=POVBF800
"RTN","PXBSTOR",143,0)
 S POVAFT17=POVBEF17
"RTN","PXBSTOR",144,0)
 S $P(POVAFT,U,1,3)=IEN_U_PATIENT_U_PXBVST
"RTN","PXBSTOR",145,0)
 S PPRNARR=$$EXTTEXT^PXUTL1(IEN,1,80,10)
"RTN","PXBSTOR",146,0)
 S $P(POVAFT,U,4)=+$$PROVNARR^PXAPI(PPRNARR,9000010.07)
"RTN","PXBSTOR",147,0)
 S $P(POVAFT,U,12)=$S(IEN=$G(PXBDXPRI):"P",1:"S") ;PRI/SEC
"RTN","PXBSTOR",148,0)
 I $P(REQI,U,7) S $P(POVAFT12,U,4)=$P($G(^AUPNVPRV($P(REQI,U,7),0)),U,1)
"RTN","PXBSTOR",149,0)
 I POVBF812']"" S $P(POVAF812,U,2,3)=$G(PXBPKG)_U_$G(PXBSOURC)
"RTN","PXBSTOR",150,0)
 S POVAF800=$G(PXBREQ(IEN,"I")) S:POVAF800="" POVAF800=$P(ANS,U,4,20)
"RTN","PXBSTOR",151,0)
 D POV1
"RTN","PXBSTOR",152,0)
 Q
"RTN","PXBSTOR1")
0^5^B11329051
"RTN","PXBSTOR1",1,0)
PXBSTOR1 ;ISL/JVS - REMOVE THE DELETED PROVIDER FROM CPT'S ;2/23/04 9:41am
"RTN","PXBSTOR1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**88,124**;Aug 12, 1996
"RTN","PXBSTOR1",3,0)
 ;
"RTN","PXBSTOR1",4,0)
 ;
"RTN","PXBSTOR1",5,0)
 ;
"RTN","PXBSTOR1",6,0)
 ;
"RTN","PXBSTOR1",7,0)
DCPT(CPTPRV,PXBVST) ;---ENTRY POINT
"RTN","PXBSTOR1",8,0)
 ;CPTPRV=IEN of Provider to be removed
"RTN","PXBSTOR1",9,0)
 ;PXBVST=VISIT of the encounter
"RTN","PXBSTOR1",10,0)
 ;
"RTN","PXBSTOR1",11,0)
 ;
"RTN","PXBSTOR1",12,0)
 Q:'$D(CPTPRV)  Q:'$D(PXBVST)
"RTN","PXBSTOR1",13,0)
 ;
"RTN","PXBSTOR1",14,0)
 K ^TMP("PXK",$J)
"RTN","PXBSTOR1",15,0)
 N IEN
"RTN","PXBSTOR1",16,0)
 S IEN=0 F  S IEN=$O(^AUPNVCPT("AD",PXBVST,IEN)) Q:IEN=""  D
"RTN","PXBSTOR1",17,0)
 .I $D(^AUPNVCPT(IEN,12)),$P(^AUPNVCPT(IEN,12),"^",4)=CPTPRV D CHANGE
"RTN","PXBSTOR1",18,0)
 Q
"RTN","PXBSTOR1",19,0)
CHANGE ;--Remove the Provider from the CPT code
"RTN","PXBSTOR1",20,0)
 ;
"RTN","PXBSTOR1",21,0)
 I '$D(^TMP("PXBSTOR",$J,"SEQ")) S SEQ=1
"RTN","PXBSTOR1",22,0)
 I $D(^TMP("PXBSTOR",$J,"SEQ")) S SEQ=^TMP("PXBSTOR",$J,"SEQ")
"RTN","PXBSTOR1",23,0)
 ;------CHANGE SOURCE TO MATCH THAT SENT IN -********-
"RTN","PXBSTOR1",24,0)
 S ^TMP("PXK",$J,"SOR")=$O(^PX(839.7,"B","SD/PCE-INTERFACE-PROMPTS",0))
"RTN","PXBSTOR1",25,0)
 ;-------------
"RTN","PXBSTOR1",26,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=PXBVST
"RTN","PXBSTOR1",27,0)
 S ^TMP("PXK",$J,"VST",1,0,"AFTER")=$G(^AUPNVSIT(PXBVST,0))
"RTN","PXBSTOR1",28,0)
 S ^TMP("PXK",$J,"VST",1,0,"BEFORE")=$G(^AUPNVSIT(PXBVST,0))
"RTN","PXBSTOR1",29,0)
 ;
"RTN","PXBSTOR1",30,0)
 S (CPTBEF,CPTAFT)=$G(^AUPNVCPT(IEN,0))
"RTN","PXBSTOR1",31,0)
 S (CPTBEF12,CPTAFT12)=$G(^AUPNVCPT(IEN,12))
"RTN","PXBSTOR1",32,0)
 S $P(CPTAFT12,"^",4)="@"
"RTN","PXBSTOR1",33,0)
 ;
"RTN","PXBSTOR1",34,0)
 S SEQ=SEQ+(1)
"RTN","PXBSTOR1",35,0)
 ;
"RTN","PXBSTOR1",36,0)
 S ^TMP("PXK",$J,"CPT",SEQ,0,"AFTER")=CPTAFT
"RTN","PXBSTOR1",37,0)
 S ^TMP("PXK",$J,"CPT",SEQ,0,"BEFORE")=CPTBEF
"RTN","PXBSTOR1",38,0)
 S ^TMP("PXK",$J,"CPT",SEQ,12,"AFTER")=CPTAFT12
"RTN","PXBSTOR1",39,0)
 S ^TMP("PXK",$J,"CPT",SEQ,12,"BEFORE")=CPTBEF12
"RTN","PXBSTOR1",40,0)
 S ^TMP("PXK",$J,"CPT",SEQ,"IEN")=IEN
"RTN","PXBSTOR1",41,0)
 ;
"RTN","PXBSTOR1",42,0)
 ;
"RTN","PXBSTOR1",43,0)
 ;
"RTN","PXBSTOR1",44,0)
 D EN1^PXKMAIN
"RTN","PXBSTOR1",45,0)
 K ^TMP("PXK",$J)
"RTN","PXBSTOR1",46,0)
 ;
"RTN","PXBSTOR1",47,0)
 ;
"RTN","PXBSTOR1",48,0)
 Q
"RTN","PXBSTOR1",49,0)
STP ;--AMIS STOP CODES
"RTN","PXBSTOR1",50,0)
 ;--STOP CODE ARE ON PIECE 10 AND 11 IS THE VISIT
"RTN","PXBSTOR1",51,0)
 Q:'$D(REQI)
"RTN","PXBSTOR1",52,0)
 N SOURCE
"RTN","PXBSTOR1",53,0)
 S SOURCE=$O(^PX(839.7,"B","SD/PCE-INTERFACE-PROMPTS",0))
"RTN","PXBSTOR1",54,0)
 S STOPI=$P(REQI,"^",10)
"RTN","PXBSTOR1",55,0)
 S SECVSIT=$P(REQI,"^",11)
"RTN","PXBSTOR1",56,0)
 S VISIT=+$$STOPCODE^PXUTLSTP(SOURCE,STOPI,PXBVST,SECVSIT)
"RTN","PXBSTOR1",57,0)
 Q
"RTN","PXBSTOR1",58,0)
 ;
"RTN","PXBSTOR1",59,0)
SET() ;--SET IENS OF EACH FILE
"RTN","PXBSTOR1",60,0)
 S PRVIEN=$P(REQI,"^",7) I PRVIEN]"" D
"RTN","PXBSTOR1",61,0)
 .S PRVBEF=$G(^AUPNVPRV($P(REQI,"^",7),0))
"RTN","PXBSTOR1",62,0)
 .S PRVBEF12=$G(^AUPNVPRV($P(REQI,"^",7),12))
"RTN","PXBSTOR1",63,0)
 .S PRVBF812=$G(^AUPNVPRV($P(REQI,"^",7),812))
"RTN","PXBSTOR1",64,0)
 E  S (PRVBEF,PRVBEF12,PRVBF812)=""
"RTN","PXBSTOR1",65,0)
 S CPTIEN=$P(REQI,"^",8)
"RTN","PXBSTOR1",66,0)
 I CPTIEN]"" D
"RTN","PXBSTOR1",67,0)
 .S CPTBEF=$G(^AUPNVCPT($P(REQI,"^",8),0))
"RTN","PXBSTOR1",68,0)
 .;Build array for cpt modifiers
"RTN","PXBSTOR1",69,0)
 .N SUBIEN
"RTN","PXBSTOR1",70,0)
 .S SUBIEN=0
"RTN","PXBSTOR1",71,0)
 .F  S SUBIEN=$O(^AUPNVCPT($P(REQI,"^",8),1,SUBIEN)) Q:'SUBIEN  D
"RTN","PXBSTOR1",72,0)
 ..S CPTBEF1(SUBIEN)=$G(^AUPNVCPT($P(REQI,"^",8),1,SUBIEN,0))
"RTN","PXBSTOR1",73,0)
 .S CPTBEF12=$G(^AUPNVCPT($P(REQI,"^",8),12))
"RTN","PXBSTOR1",74,0)
 .S CPTBF812=$G(^AUPNVCPT($P(REQI,"^",8),812))
"RTN","PXBSTOR1",75,0)
 E  S (CPTBEF,CPTBEF12,CPTBF812)=""
"RTN","PXBSTOR1",76,0)
 S POVIEN=$P(REQI,"^",9) I POVIEN]"" D
"RTN","PXBSTOR1",77,0)
 .S POVBEF=$G(^AUPNVPOV($P(REQI,"^",9),0))
"RTN","PXBSTOR1",78,0)
 .S POVBEF12=$G(^AUPNVPOV($P(REQI,"^",9),12))
"RTN","PXBSTOR1",79,0)
 .S POVBEF17=$G(^AUPNVPOV($P(REQI,"^",9),17))
"RTN","PXBSTOR1",80,0)
 .S POVBF812=$G(^AUPNVPOV($P(REQI,"^",9),812))
"RTN","PXBSTOR1",81,0)
 .S POVBF800=$G(^AUPNVPOV($P(REQI,"^",9),800)) ;PX124
"RTN","PXBSTOR1",82,0)
 E  S (POVBEF,POVBEF12,POVBEF17,POVBF812,POVBF800)=""
"RTN","PXBSTOR1",83,0)
 ;
"RTN","PXBSTOR1",84,0)
MISC ;--SET MISCELLANEOUS NODES
"RTN","PXBSTOR1",85,0)
 ;--*** CONDITION THE SOURCE
"RTN","PXBSTOR1",86,0)
 I '$G(SOURCE) S ^TMP("PXK",$J,"SOR")=$O(^PX(839.7,"B","SD/PCE-INTERFACE-PROMPTS",0))
"RTN","PXBSTOR1",87,0)
 ;
"RTN","PXBSTOR1",88,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=PXBVST
"RTN","PXBSTOR1",89,0)
 S ^TMP("PXK",$J,"VST",1,0,"AFTER")=$G(^AUPNVSIT(PXBVST,0))
"RTN","PXBSTOR1",90,0)
 S ^TMP("PXK",$J,"VST",1,0,"BEFORE")=$G(^AUPNVSIT(PXBVST,0))
"RTN","PXBSTOR1",91,0)
 ;
"RTN","PXBSTOR1",92,0)
 Q $G(^TMP("PXBSTOR",$J,"SEQ"),1)
"RTN","PXBUTL0")
0^3^B31353311
"RTN","PXBUTL0",1,0)
PXBUTL0 ;ISL/JVS,ESW - UTILITIES-3 LINE HELP MESSAGES ;6/17/03 10:29
"RTN","PXBUTL0",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**108,124**;Aug 12, 1996
"RTN","PXBUTL0",3,0)
 ;
"RTN","PXBUTL0",4,0)
HELP(CAT) ;Help messages written when ?'s are entered.
"RTN","PXBUTL0",5,0)
 ;Each message must have 3 line although any of them can be blank.
"RTN","PXBUTL0",6,0)
 N MES,I
"RTN","PXBUTL0",7,0)
 D @CAT,WR
"RTN","PXBUTL0",8,0)
 Q
"RTN","PXBUTL0",9,0)
 ;
"RTN","PXBUTL0",10,0)
WR ;--Write to the screen
"RTN","PXBUTL0",11,0)
 S I=0 F I=1:1:3 W !,IOELEOL,?(IOM-$L(MES(I)))\2,MES(I)
"RTN","PXBUTL0",12,0)
 Q
"RTN","PXBUTL0",13,0)
 ;
"RTN","PXBUTL0",14,0)
STP1 ;--STOP CODE 1 ?
"RTN","PXBUTL0",15,0)
 S MES(1)="Answer with CLINIC STOP NAME, or AMIS RPORTING STOP CODE."
"RTN","PXBUTL0",16,0)
 S MES(2)=""
"RTN","PXBUTL0",17,0)
 S MES(3)=""
"RTN","PXBUTL0",18,0)
 Q
"RTN","PXBUTL0",19,0)
STP3 ;--STOP CODE 3 ?
"RTN","PXBUTL0",20,0)
 S MES(1)="Enter the STOP CODE associated with this ENCOUNTER."
"RTN","PXBUTL0",21,0)
 S MES(2)="Enter '??' to get the entire list of possible STOP CODES"
"RTN","PXBUTL0",22,0)
 S MES(3)="'*' indicates that STOP CODE has been visited in this session."
"RTN","PXBUTL0",23,0)
 Q
"RTN","PXBUTL0",24,0)
STP900 ;--STOP CODE 900
"RTN","PXBUTL0",25,0)
 S MES(1)="The stop code 900 SPECIAL SERVICES is no longer in service."
"RTN","PXBUTL0",26,0)
 S MES(2)="If you wish to enter procedures, you must use the"
"RTN","PXBUTL0",27,0)
 S MES(3)="option provided to enter a PROCEDURE."
"RTN","PXBUTL0",28,0)
 Q
"RTN","PXBUTL0",29,0)
PRV1 ;--Provider 1 ?
"RTN","PXBUTL0",30,0)
 S MES(1)="Answer with PROVIDER'S NAME, or INITIALS, or SSN, or NICK NAME,"
"RTN","PXBUTL0",31,0)
 S MES(2)="or KEY DELEGATION LEVEL, OR USER CLASS, or LINE NUMBER"
"RTN","PXBUTL0",32,0)
 S MES(3)="from the above list."
"RTN","PXBUTL0",33,0)
 Q
"RTN","PXBUTL0",34,0)
PRV3 ;--Provider 3 ?
"RTN","PXBUTL0",35,0)
 S MES(1)="Enter the PROVIDER who performed or ordered the PROCEDURES"
"RTN","PXBUTL0",36,0)
 S MES(2)="that were performed on the patient during this Encounter."
"RTN","PXBUTL0",37,0)
 S MES(3)="'*' indicates that PROVIDER has been used in this session."
"RTN","PXBUTL0",38,0)
 Q
"RTN","PXBUTL0",39,0)
PRVM ;--CPT Add Multiple Provider(s)
"RTN","PXBUTL0",40,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",41,0)
 S MES(2)="The above NAME is not a VALID PROVIDER."
"RTN","PXBUTL0",42,0)
 S MES(3)="" ;--Enter each one separately to get more complete help."
"RTN","PXBUTL0",43,0)
 Q
"RTN","PXBUTL0",44,0)
PRVMD ;--CPT Delete Multiple Providers(s)
"RTN","PXBUTL0",45,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",46,0)
 S MES(2)="The above Item(s) are not VALID line numbers or Item numbers."
"RTN","PXBUTL0",47,0)
 S MES(3)=""
"RTN","PXBUTL0",48,0)
 Q
"RTN","PXBUTL0",49,0)
 ;
"RTN","PXBUTL0",50,0)
POV1 ;--Purpose of Visit 1 ?
"RTN","PXBUTL0",51,0)
 S MES(1)=""
"RTN","PXBUTL0",52,0)
 S MES(2)="Answer with ICD DIAGNOSIS CODE NUMBER or DESCRIPTION."
"RTN","PXBUTL0",53,0)
 S MES(3)=""
"RTN","PXBUTL0",54,0)
 Q
"RTN","PXBUTL0",55,0)
POV3 ;--Purpose of Visit 3 ?
"RTN","PXBUTL0",56,0)
 S MES(1)="Enter the DIAGNOSIS that is associated with this ENCOUNTER."
"RTN","PXBUTL0",57,0)
 S MES(2)="It is possible that there is more than one DIAGNOSIS."
"RTN","PXBUTL0",58,0)
 S MES(3)=""
"RTN","PXBUTL0",59,0)
 Q
"RTN","PXBUTL0",60,0)
PL1 ;--Problem list ?
"RTN","PXBUTL0",61,0)
 S MES(1)="Select an Item Number, a '+' or '-', or 'ENTER' or '^' to EXIT this prompt."
"RTN","PXBUTL0",62,0)
 S MES(2)="By selecting one of the PROBLEMS, it can then be entered as a"
"RTN","PXBUTL0",63,0)
 S MES(3)="Diagnosis for this ENCOUNTER with "_NAME_"."
"RTN","PXBUTL0",64,0)
 Q
"RTN","PXBUTL0",65,0)
PL11 ;--Problem List ?
"RTN","PXBUTL0",66,0)
 S MES(1)="Select an Item Number, or 'ENTER' or '^' to EXIT this prompt."
"RTN","PXBUTL0",67,0)
 S MES(2)="By selecting one of the PROBLEMS, it can then be entered as a"
"RTN","PXBUTL0",68,0)
 S MES(3)="Diagnosis for this ENCOUNTER with "_PNAME_"."
"RTN","PXBUTL0",69,0)
 Q
"RTN","PXBUTL0",70,0)
PLM ;--Problem List ?
"RTN","PXBUTL0",71,0)
 S MES(1)="The above is not a valid or active problem."
"RTN","PXBUTL0",72,0)
 S MES(2)=""
"RTN","PXBUTL0",73,0)
 S MES(3)=""
"RTN","PXBUTL0",74,0)
 Q
"RTN","PXBUTL0",75,0)
 ;
"RTN","PXBUTL0",76,0)
CPT1 ;--CPT Procedure 1 ?
"RTN","PXBUTL0",77,0)
 S MES(1)="Answer with CPT CODE or CPT CATEGORY or DESCRIPTION."
"RTN","PXBUTL0",78,0)
 S MES(2)="A '*' next to a procedure indicates that it was either"
"RTN","PXBUTL0",79,0)
 S MES(3)=" ADDED or EDITED during this session."
"RTN","PXBUTL0",80,0)
 Q
"RTN","PXBUTL0",81,0)
CPT4 ;--USE MORE THAN 1 LETTER ?
"RTN","PXBUTL0",82,0)
 S MES(1)="Please use more than 1 letter for your request."
"RTN","PXBUTL0",83,0)
 S MES(2)=""
"RTN","PXBUTL0",84,0)
 S MES(3)=""
"RTN","PXBUTL0",85,0)
 Q
"RTN","PXBUTL0",86,0)
CPT3 ;--CPT Procedure 3 ?
"RTN","PXBUTL0",87,0)
 S MES(1)="Enter the PROCEDURE(S) that were performed during this ENCOUNTER."
"RTN","PXBUTL0",88,0)
 S MES(2)="It may also be a procedure that occurred at another time but."
"RTN","PXBUTL0",89,0)
 S MES(3)="occurred as a result of this ENCOUNTER with the Patient."
"RTN","PXBUTL0",90,0)
 Q
"RTN","PXBUTL0",91,0)
CPTM ;--CPT Add Multiple Procedure(s)
"RTN","PXBUTL0",92,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",93,0)
 S MES(2)="The above entry is not a VALID or ACTIVE Code(s)."
"RTN","PXBUTL0",94,0)
 S MES(3)=""
"RTN","PXBUTL0",95,0)
 ;S MES(3)="Enter each one separately to get more complete help."
"RTN","PXBUTL0",96,0)
 Q
"RTN","PXBUTL0",97,0)
CPTMDP ;--CPT Adding Procedure with Multiple that already exist
"RTN","PXBUTL0",98,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",99,0)
 S MES(2)="The above entry was already entered for this Encounter."
"RTN","PXBUTL0",100,0)
 S MES(3)="Enter it separately if you still want to add/edit."
"RTN","PXBUTL0",101,0)
 Q
"RTN","PXBUTL0",102,0)
CPTMNO ;--CPT Add Multiple Procedure(s)
"RTN","PXBUTL0",103,0)
 W !,$E(EDATA,1,50)
"RTN","PXBUTL0",104,0)
 W !,"The above Item(s) are not VALID or ACTIVE Codes."
"RTN","PXBUTL0",105,0)
 W !,"Enter each one separately to get more complete help."
"RTN","PXBUTL0",106,0)
 Q
"RTN","PXBUTL0",107,0)
CPTMD ;--CPT Delete Multiple Procedure(s)
"RTN","PXBUTL0",108,0)
 S MES(1)=$E(EDATA,1,50)
"RTN","PXBUTL0",109,0)
 S MES(2)="The above Item(s) are not VALID line numbers or Item numbers."
"RTN","PXBUTL0",110,0)
 S MES(3)=""
"RTN","PXBUTL0",111,0)
 Q
"RTN","PXBUTL0",112,0)
WH1 ;--WHICH when selecting different line options 1 ?
"RTN","PXBUTL0",113,0)
 S MES(1)="Enter the line number of the entry that you are selecting."
"RTN","PXBUTL0",114,0)
 S MES(2)=""
"RTN","PXBUTL0",115,0)
 S MES(3)=""
"RTN","PXBUTL0",116,0)
 Q
"RTN","PXBUTL0",117,0)
 ;
"RTN","PXBUTL0",118,0)
WH2 ;--WHICH when selecting different line options 2 ?
"RTN","PXBUTL0",119,0)
 S MES(1)="You can select any line number that you wish."
"RTN","PXBUTL0",120,0)
 S MES(2)=""
"RTN","PXBUTL0",121,0)
 S MES(3)=""
"RTN","PXBUTL0",122,0)
 Q
"RTN","PXBUTL0",123,0)
 ;
"RTN","PXBUTL0",124,0)
WH3 ;--WHICH when selecting different line options 3 ?
"RTN","PXBUTL0",125,0)
 S MES(1)="Please select any line number that you wish or ""^"" to exit."
"RTN","PXBUTL0",126,0)
 S MES(2)=""
"RTN","PXBUTL0",127,0)
 S MES(3)=""
"RTN","PXBUTL0",128,0)
 Q
"RTN","PXBUTL0",129,0)
QU1 ;--QUANTITY when changing quantity of CPT's ?
"RTN","PXBUTL0",130,0)
 S MES(1)="This is the number of times this CPT was done"
"RTN","PXBUTL0",131,0)
 S MES(2)="to the patient during the encounter."
"RTN","PXBUTL0",132,0)
 S MES(3)=""
"RTN","PXBUTL0",133,0)
 Q
"RTN","PXBUTL0",134,0)
QU2 ;--QUANTITY when changing quantity of CPT'S ??
"RTN","PXBUTL0",135,0)
 S MES(1)="Enter a number between 0 and 99 indicating how many"
"RTN","PXBUTL0",136,0)
 S MES(2)="times this procedure was performed on the patient"
"RTN","PXBUTL0",137,0)
 S MES(3)="during this encounter."
"RTN","PXBUTL0",138,0)
 Q
"RTN","PXBUTL0",139,0)
OP1 ;--ORDERING PROVIDER for CPT's ?
"RTN","PXBUTL0",140,0)
 S MES(1)="This is the ordering provider for the Procedure"
"RTN","PXBUTL0",141,0)
 S MES(2)="during the encounter."
"RTN","PXBUTL0",142,0)
 S MES(3)=""
"RTN","PXBUTL0",143,0)
 Q
"RTN","PXBUTL0",144,0)
OP2 ;--ORDERING PROVIDER for CPT'S ??
"RTN","PXBUTL0",145,0)
 S MES(1)="Enter the ordering provider for this"
"RTN","PXBUTL0",146,0)
 S MES(2)="procedure performed on the patient"
"RTN","PXBUTL0",147,0)
 S MES(3)="during this encounter."
"RTN","PXBUTL0",148,0)
 Q
"RTN","PXCA0")
0^24^B19659643
"RTN","PXCA0",1,0)
PXCA0 ;ISL/dee - Main routine for PCE Device Interface Module ;11/20/96
"RTN","PXCA0",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**5,14,33,124**;Aug 12, 1996
"RTN","PXCA0",3,0)
 Q
"RTN","PXCA0",4,0)
 ;
"RTN","PXCA0",5,0)
 ;Variables:
"RTN","PXCA0",6,0)
 ;  PXCANPRV  Count of the number of providers
"RTN","PXCA0",7,0)
 ;  PXCANPOV  Count of the number of diagnoses
"RTN","PXCA0",8,0)
 ;  PXCADT  Encounter Date/Time
"RTN","PXCA0",9,0)
 ;  PXCAPAT   Pointer to the patient (9000001 & 2)
"RTN","PXCA0",10,0)
 ;  PXCAHLOC  Pointer to Hospital Location (44)
"RTN","PXCA0",11,0)
 ;  PXCACSTP  Pointer to the Credit Stop (40.7)
"RTN","PXCA0",12,0)
 ;  PXCAGLB   First sub script of ^TMP(
"RTN","PXCA0",13,0)
 ;              is "PXK" to send to PXK*
"RTN","PXCA0",14,0)
 ;              is "PXCA" to use correct data errors
"RTN","PXCA0",15,0)
 ;  PXCAERRS  Flag if
"RTN","PXCA0",16,0)
 ;              true then builds ^TMP(PXCAGLB,$J, even if there are
"RTN","PXCA0",17,0)
 ;                errors, used to build the input data so that the user
"RTN","PXCA0",18,0)
 ;                can fix the error and create or correct the entry. 
"RTN","PXCA0",19,0)
 ;              false does not build ^TMP(PXCAGLB,$J, when there is an
"RTN","PXCA0",20,0)
 ;                error in the data need to build it. 
"RTN","PXCA0",21,0)
 ;  PXCADNUM  Index into ^TMP( for the diagnosis on a "DIAGNOSIS/PROBLEM"
"RTN","PXCA0",22,0)
 ;              node so that the problem number add after calling 
"RTN","PXCA0",23,0)
 ;              Problem List
"RTN","PXCA0",24,0)
 ;
"RTN","PXCA0",25,0)
EN ;Entry called form PXCAEP.
"RTN","PXCA0",26,0)
 I '$D(PXCA) S PXCA("ERROR","ENCOUNTER",0,0,0)="Local data array is missing" Q
"RTN","PXCA0",27,0)
 N PXCADT,PXCAPAT,PXCAHLOC,PXCACSTP,PXCAPPRV,PXCAPDX,PXKDUZ,PXCADNUM
"RTN","PXCA0",28,0)
 S PXKDUZ=DUZ
"RTN","PXCA0",29,0)
 D BUILD("PXK",0)
"RTN","PXCA0",30,0)
 D:'$D(PXCA("ERROR")) FINISH("PXK")
"RTN","PXCA0",31,0)
 D:$D(PXKERROR) PXKERROR^PXCAERR("PXK")
"RTN","PXCA0",32,0)
 D EXIT("PXK")
"RTN","PXCA0",33,0)
 Q
"RTN","PXCA0",34,0)
 ;
"RTN","PXCA0",35,0)
BUILD(PXCAGLB,PXCAERRS) ;Takes an PXCA array and builds the ^TMP(PXCAGLB,$J, array.
"RTN","PXCA0",36,0)
 ;
"RTN","PXCA0",37,0)
 N PXCANPRV,PXCANPOV
"RTN","PXCA0",38,0)
 K PXKERROR
"RTN","PXCA0",39,0)
 K ^TMP(PXCAGLB,$J)
"RTN","PXCA0",40,0)
 S PXCANPRV=0,PXCANPOV=0
"RTN","PXCA0",41,0)
 ;
"RTN","PXCA0",42,0)
 D PROCESS(.PXCA,1,PXCAERRS)
"RTN","PXCA0",43,0)
 ;
"RTN","PXCA0",44,0)
 I $D(ZTQUEUED),$D(PXCA("ERROR")) S PXKERROR("PXCA")="There were errors in the data validation in the tasked job, no data was stored."
"RTN","PXCA0",45,0)
 Q
"RTN","PXCA0",46,0)
 ;
"RTN","PXCA0",47,0)
PROCESS(PXCA,PXCABULD,PXCAERRS) ;
"RTN","PXCA0",48,0)
 N PXCAEVAL S PXCAEVAL=0
"RTN","PXCA0",49,0)
 I '($D(PXKDUZ)#2) N PXCAPAT,PXCAHLOC,PXCACSTP,PXCAPPRV,PXCAPDX,PXKDUZ,PXCADNUM,PXCADT S PXKDUZ=DUZ
"RTN","PXCA0",50,0)
 N PXCAPKG,PXCASOR
"RTN","PXCA0",51,0)
 S PXCAVSIT=""
"RTN","PXCA0",52,0)
 S PXCAPKG=$$PKG2IEN^VSIT("PX")
"RTN","PXCA0",53,0)
 S PXCASOR=$P($G(PXCA("SOURCE")),"^",1)
"RTN","PXCA0",54,0)
 S (PXCAPPRV,PXCAPDX)=0
"RTN","PXCA0",55,0)
 D
"RTN","PXCA0",56,0)
 . N PXCAENC
"RTN","PXCA0",57,0)
 . S PXCAENC=$G(PXCA("ENCOUNTER"))
"RTN","PXCA0",58,0)
 . S PXCADT=+$P(PXCAENC,"^",1)
"RTN","PXCA0",59,0)
 . S PXCAPAT=+$P(PXCAENC,"^",2)
"RTN","PXCA0",60,0)
 . D:PXCAPAT PATINFO^PXCEPAT(.PXCAPAT)
"RTN","PXCA0",61,0)
 . S PXCAHLOC=+$P(PXCAENC,"^",3)
"RTN","PXCA0",62,0)
 . ; - ignore stop code passed in and always use the one for
"RTN","PXCA0",63,0)
 . ;             the Hospital Location
"RTN","PXCA0",64,0)
 . S PXCACSTP=$P($G(^SC(PXCAHLOC,0)),"^",7)
"RTN","PXCA0",65,0)
 . S PXCAVSIT=$$LOOKVSIT^PXUTLVST(PXCAPAT,PXCADT,PXCAHLOC,PXCACSTP,"","")
"RTN","PXCA0",66,0)
 . S:PXCAVSIT<1 PXCAVSIT=""
"RTN","PXCA0",67,0)
 ;
"RTN","PXCA0",68,0)
 I PXCAVSIT>0 D
"RTN","PXCA0",69,0)
 . ; - return error if trying to send data for a disposition
"RTN","PXCA0",70,0)
 . I $$DISPOSIT^PXUTL1(PXCAPAT,PXCADT,PXCAVSIT) S PXCA("ERROR","ENCOUNTER",0,0,0)="Dispositions can only be done through the Disposition menu options"
"RTN","PXCA0",71,0)
 . S PXCAPPRV=$$PRIMVPRV^PXUTL1(PXCAVSIT)
"RTN","PXCA0",72,0)
 . S PXCAPDX=$$PRIMVPOV^PXUTL1(PXCAVSIT)
"RTN","PXCA0",73,0)
 ;
"RTN","PXCA0",74,0)
 D ENCOUNT^PXCAVST(.PXCA,PXCABULD,PXCAERRS,.PXCAEVAL)
"RTN","PXCA0",75,0)
 D SOURCE^PXCASOR(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",76,0)
 ;
"RTN","PXCA0",77,0)
 D PROV^PXCAPRV(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",78,0)
 D DIAG^PXCAPOV(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",79,0)
 D PROC^PXCACPT(.PXCA,PXCABULD,PXCAERRS,PXCAEVAL)
"RTN","PXCA0",80,0)
 ;
"RTN","PXCA0",81,0)
 D HFACTORS^PXCAHF(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",82,0)
 D IMMUN^PXCAVIMM(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",83,0)
 D PATED^PXCAPED(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",84,0)
 D SKINTEST^PXCASK(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",85,0)
 D EXAM^PXCAXAM(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",86,0)
 ;
"RTN","PXCA0",87,0)
 ;Have Vitals validate its data.
"RTN","PXCA0",88,0)
 D:$L($T(VALIDATE^GMRVPCE0)) VALIDATE^GMRVPCE0(.PXCA)
"RTN","PXCA0",89,0)
 ;
"RTN","PXCA0",90,0)
 D PROBLEM^PXCAPL(.PXCA,PXCABULD,PXCAERRS)
"RTN","PXCA0",91,0)
 ;
"RTN","PXCA0",92,0)
 D DXPL^PXCADXPL(.PXCA,PXCABULD,PXCAERRS) ;must be after DIAG^PXCAPOV
"RTN","PXCA0",93,0)
 ;
"RTN","PXCA0",94,0)
 ;Message if there are no Primary diagnoses
"RTN","PXCA0",95,0)
 I 'PXCAPDX D
"RTN","PXCA0",96,0)
 . I $P($G(^PX(815,1,"DI")),"^",3) S PXCA("ERROR","DIAGNOSIS",0,0,2)="There is no Primary Diagnosis for this encounter^"
"RTN","PXCA0",97,0)
 . E  S PXCA("WARNING","DIAGNOSIS",0,0,2)="There is no Primary Diagnosis for this encounter^"
"RTN","PXCA0",98,0)
 ;
"RTN","PXCA0",99,0)
 D KVA^VADPT
"RTN","PXCA0",100,0)
 Q
"RTN","PXCA0",101,0)
 ;
"RTN","PXCA0",102,0)
FINISH(PXCAGLB) ;
"RTN","PXCA0",103,0)
 ;
"RTN","PXCA0",104,0)
 ;Have Vitals process its data.
"RTN","PXCA0",105,0)
 I $L($T(VALIDATE^GMRVPCE0)),$L($T(STORE^GMRVPCE0)) D STORE^GMRVPCE0(.PXCA)
"RTN","PXCA0",106,0)
 ;
"RTN","PXCA0",107,0)
 ;Now store the problems into Problem List
"RTN","PXCA0",108,0)
 ; That are in the "PROBLEM" node
"RTN","PXCA0",109,0)
 D PROBLIST^PXCAPL1
"RTN","PXCA0",110,0)
 ; That are in the "DIAGNOSIS/PROBLEM" node
"RTN","PXCA0",111,0)
 D PROBLIST^PXCAPL2
"RTN","PXCA0",112,0)
 ;
"RTN","PXCA0",113,0)
 ;Now store the rest of the information in the V-Files
"RTN","PXCA0",114,0)
 ; - save PXKERRORs from problem list calls in PXCAPXKE
"RTN","PXCA0",115,0)
 N PXCAPXKE
"RTN","PXCA0",116,0)
 M PXCAPXKE=PXKERROR
"RTN","PXCA0",117,0)
 D EN1^PXKMAIN
"RTN","PXCA0",118,0)
 M PXKERROR=PXCAPXKE
"RTN","PXCA0",119,0)
 ; - setting PXCAVSIT for use in PXCAERR
"RTN","PXCA0",120,0)
 S PXCAVSIT=+$G(^TMP(PXCAGLB,$J,"VST",1,"IEN"))
"RTN","PXCA0",121,0)
 ;Now do the event to tell the rest of the world about the new info.
"RTN","PXCA0",122,0)
 D EVENT^PXKMAIN
"RTN","PXCA0",123,0)
 ;
"RTN","PXCA0",124,0)
 Q
"RTN","PXCA0",125,0)
 ;
"RTN","PXCA0",126,0)
EXIT(PXCAGLB) ;Done clean up and exit.
"RTN","PXCA0",127,0)
 K PXKERROR
"RTN","PXCA0",128,0)
 K ^TMP(PXCAGLB,$J)
"RTN","PXCA0",129,0)
 D PATKILL^PXCEPAT
"RTN","PXCA0",130,0)
 Q
"RTN","PXCA0",131,0)
 ;
"RTN","PXCACPT")
0^25^B47517284
"RTN","PXCACPT",1,0)
PXCACPT ;ISL/dee & LEA/Chylton - Validates & Translates data from the PCE Device Interface into PCE's PXK format for CPTs ;5/24/04 3:51pm
"RTN","PXCACPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,33,73,121,124**;Aug 12, 1996
"RTN","PXCACPT",3,0)
 Q
"RTN","PXCACPT",4,0)
 ; Variables
"RTN","PXCACPT",5,0)
 ;   PXCAPROC  Copy of a Procedure node of the PXCA array
"RTN","PXCACPT",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCACPT",7,0)
 ;   PXCANUMB  Count of the number of CPTs and treatments
"RTN","PXCACPT",8,0)
 ;   PXCAINDX  Count of the number of procedures for one provider
"RTN","PXCACPT",9,0)
 ;   PXCAPNAR  Pointer to the provider narrative (9999999.27)
"RTN","PXCACPT",10,0)
 ;   PXCATRT   Pointer to the Treatment file (9999999.17)
"RTN","PXCACPT",11,0)
 ;
"RTN","PXCACPT",12,0)
PROC(PXCA,PXCABULD,PXCAERRS,PXCAEVAL) ;
"RTN","PXCACPT",13,0)
 I '$D(PXCA("PROCEDURE")),'PXCAEVAL,$P($G(^PX(815,1,"DI")),"^",1),'$D(^AUPNVCPT("AD",+PXCAVSIT)) S PXCA("WARNING","PROCEDURE",0,0,0)="PROCEDURE data missing" Q
"RTN","PXCACPT",14,0)
 N PXCAPROC,PXCAPRV,PXCANUMB,PXCAINDX,PXCAITEM,PXCALEN
"RTN","PXCACPT",15,0)
 N PXCAPNAR,PXCANARC
"RTN","PXCACPT",16,0)
 S PXCAPRV=""
"RTN","PXCACPT",17,0)
 S PXCANUMB=1
"RTN","PXCACPT",18,0)
 F  S PXCAPRV=$O(PXCA("PROCEDURE",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCACPT",19,0)
 . I PXCAPRV>0 D
"RTN","PXCACPT",20,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","PROCEDURE",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCACPT",21,0)
 . I '$T&PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCACPT",22,0)
 . S PXCAINDX=0
"RTN","PXCACPT",23,0)
 . F  S PXCAINDX=$O(PXCA("PROCEDURE",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCACPT",24,0)
 .. N PXCATRT
"RTN","PXCACPT",25,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCACPT",26,0)
 .. S PXCAPROC=$G(PXCA("PROCEDURE",PXCAPRV,PXCAINDX))
"RTN","PXCACPT",27,0)
 .. I PXCAPROC="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,0)="PROCEDURE data missing" Q
"RTN","PXCACPT",28,0)
 .. S PXCAITEM=$P(PXCAPROC,U,1)
"RTN","PXCACPT",29,0)
 .. I PXCAITEM]"" D
"RTN","PXCACPT",30,0)
 ... S D=$G(^ICPT(+PXCAITEM,0))
"RTN","PXCACPT",31,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="CPT code not in File 81^"_PXCAITEM
"RTN","PXCACPT",32,0)
 ... E  I '(+$$CPTSCREN^PXBUTL(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="CPT code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",33,0)
 .. E  D
"RTN","PXCACPT",34,0)
 ... S PXCATRT=$O(^AUTTTRT("B",+$P(PXCAPROC,"^",6),""))
"RTN","PXCACPT",35,0)
 ... S:PXCATRT="" PXCATRT=$O(^AUTTTRT("B","OTHER",""))
"RTN","PXCACPT",36,0)
 ... I 'PXCATRT S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Could not get pointer to treatment term^"_$P(PXCAPROC,"^",6)
"RTN","PXCACPT",37,0)
 .. S PXCAITEM=$P(PXCAPROC,U,2)
"RTN","PXCACPT",38,0)
 .. I PXCAITEM="" S PXCAITEM=1,$P(PXCAPROC,U,2)=PXCAITEM
"RTN","PXCACPT",39,0)
 .. I PXCAITEM'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,2)="CPT Quantity must be > 0^"_PXCAITEM
"RTN","PXCACPT",40,0)
 .. S PXCAITEM=$P(PXCAPROC,U,3)
"RTN","PXCACPT",41,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="S")) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,3)="Specification code must be P|S^"_PXCAITEM
"RTN","PXCACPT",42,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,5)
"RTN","PXCACPT",43,0)
 .. I PXCAITEM D
"RTN","PXCACPT",44,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",45,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",46,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,5)="Associated Primary Diagnosis ICD9 Code not in File 81^"_PXCAITEM
"RTN","PXCACPT",47,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,1)="ICD code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",48,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,8)
"RTN","PXCACPT",49,0)
 .. I PXCAITEM D
"RTN","PXCACPT",50,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",51,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",52,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,8)="Associated Diagnosis 2 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",53,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,8)="Associated Diagnosis 2 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",54,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,9)
"RTN","PXCACPT",55,0)
 .. I PXCAITEM D
"RTN","PXCACPT",56,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",57,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",58,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,9)="Associated Diagnosis 3 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",59,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,9)="Associated Diagnosis 3 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",60,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,10)
"RTN","PXCACPT",61,0)
 .. I PXCAITEM D
"RTN","PXCACPT",62,0)
 ...  ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",63,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",64,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,10)="Associated Diagnosis 4 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",65,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,10)="Associated Diagnosis 4 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",66,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,11)
"RTN","PXCACPT",67,0)
 .. I PXCAITEM D
"RTN","PXCACPT",68,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",69,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",70,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,11)="Associated Diagnosis 5 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",71,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,11)="Associated Diagnosis 5 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",72,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,12)
"RTN","PXCACPT",73,0)
 .. I PXCAITEM D
"RTN","PXCACPT",74,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",75,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",76,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,12)="Associated Diagnosis 6 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",77,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,12)="Associated Diagnosis 6 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",78,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,13)
"RTN","PXCACPT",79,0)
 .. I PXCAITEM D
"RTN","PXCACPT",80,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",81,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",82,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,13)="Associated Diagnosis 7 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",83,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,13)="Associated Diagnosis 7 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",84,0)
 .. S PXCAITEM=+$P(PXCAPROC,U,14)
"RTN","PXCACPT",85,0)
 .. I PXCAITEM D
"RTN","PXCACPT",86,0)
 ... ; S D=$G(^ICD9(PXCAITEM,0))
"RTN","PXCACPT",87,0)
 ... S D=$$ICDDX^ICDCODE(PXCAITEM,PXCADT)
"RTN","PXCACPT",88,0)
 ... I D="" S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,14)="Associated Diagnosis 8 ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCACPT",89,0)
 ... E  I '(+$$ICDDX^ICDCODE(PXCAITEM,+PXCADT)) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,14)="Associated Diagnosis 8 ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCACPT",90,0)
 .. S PXCAITEM=$P(PXCAPROC,U,6),PXCALEN=$L(PXCAITEM)
"RTN","PXCACPT",91,0)
 .. I PXCALEN<2!(PXCALEN>80) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Provider's PROCEDURE term must be 2-80 Characters^"_PXCAITEM
"RTN","PXCACPT",92,0)
 .. E  D
"RTN","PXCACPT",93,0)
 ... S PXCAPNAR=+$$PROVNARR^PXAPI(PXCAITEM,$S($P(PXCAPROC,"^",1)="":9000010.15,1:9000010.18))
"RTN","PXCACPT",94,0)
 ... I PXCAPNAR'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,6)="Could not get pointer to Provider's PROCEDURE term^"_$P(PXCAPROC,"^",6) Q:'PXCAERRS
"RTN","PXCACPT",95,0)
 ... S $P(PXCAPROC,"^",6)=PXCAPNAR
"RTN","PXCACPT",96,0)
 .. S PXCAITEM=$P(PXCAPROC,U,7),PXCALEN=$L(PXCAITEM)
"RTN","PXCACPT",97,0)
 .. I PXCALEN>0 D
"RTN","PXCACPT",98,0)
 ... I PXCALEN<2!(PXCALEN>80) S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,7)="Provider's PROCEDURE grouper must be 2-80 Characters^"_PXCAITEM
"RTN","PXCACPT",99,0)
 ... E  D
"RTN","PXCACPT",100,0)
 .... S PXCANARC=+$$PROVNARR^PXAPI(PXCAITEM,$S($P(PXCAPROC,"^",1)="":9000010.15,1:9000010.18))
"RTN","PXCACPT",101,0)
 .... I PXCANARC'>0 S PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX,7)="Could not get pointer to Provider's PROCEDURE grouper^"_PXCAITEM
"RTN","PXCACPT",102,0)
 .... E  S $P(PXCAPROC,"^",7)=PXCANARC
"RTN","PXCACPT",103,0)
 .. I PXCABULD&'$D(PXCA("ERROR","PROCEDURE",PXCAPRV,PXCAINDX))!PXCAERRS D
"RTN","PXCACPT",104,0)
 ... I $P(PXCAPROC,"^",1)]"" D
"RTN","PXCACPT",105,0)
 .... D CPT^PXCACPT1(.PXCA,PXCAPROC,PXCANUMB,PXCAPRV,PXCAINDX,PXCAERRS)
"RTN","PXCACPT",106,0)
 ... E  D TRT^PXCATRT(PXCAPROC,PXCANUMB,PXCAPRV,PXCAINDX,PXCAERRS,PXCATRT)
"RTN","PXCACPT",107,0)
 Q
"RTN","PXCACPT",108,0)
 ;
"RTN","PXCACPT1")
0^26^B11279255
"RTN","PXCACPT1",1,0)
PXCACPT1 ;ISL/dee & LEA/Chylton - Validates & Translates data from the PCE Device Interface into PCE's PXK format for CPTs ;8/1/96
"RTN","PXCACPT1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**73,121,124**;Aug 12, 1996
"RTN","PXCACPT1",3,0)
 Q
"RTN","PXCACPT1",4,0)
 ; Variables
"RTN","PXCACPT1",5,0)
 ;   PXCA      Copy of PXCA array
"RTN","PXCACPT1",6,0)
 ;   PXCAPROC  Copy of a Procedure node of the PXCA array
"RTN","PXCACPT1",7,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCACPT1",8,0)
 ;   PXCANUMB  Count of the number if CPTs and treatments
"RTN","PXCACPT1",9,0)
 ;   PXCAINDX  Count of the number of procedures for one provider
"RTN","PXCACPT1",10,0)
 ;   PXCAFTER  Temp used to build ^TMP(PXCAGLB,$J,"CPT",PXCANPRV,0,"AFTER")
"RTN","PXCACPT1",11,0)
 ;               or to build ^TMP(PXCAGLB,$J,"TRT",PXCANPRV,0,"AFTER")
"RTN","PXCACPT1",12,0)
 ;
"RTN","PXCACPT1",13,0)
CPT(PXCA,PXCAPROC,PXCANUMB,PXCAPRV,PXCAINDX,PXCAERRS) ;CPT
"RTN","PXCACPT1",14,0)
 N PXCAFTER,PXCACNT,PXCASTR,PXCAWARN,PXMDIEN
"RTN","PXCACPT1",15,0)
 S PXCAFTER=$P(PXCAPROC,"^",1)_"^"
"RTN","PXCACPT1",16,0)
 S PXCAFTER=PXCAFTER_PXCAPAT_"^"_PXCAVSIT_"^"
"RTN","PXCACPT1",17,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",6)_"^"
"RTN","PXCACPT1",18,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",5)_"^^" ;1ST Dx
"RTN","PXCACPT1",19,0)
 S PXCAFTER=PXCAFTER_$S($P(PXCAPROC,"^",3)="P":"Y",$P(PXCAPROC,"^",3)="S":"N",1:"")_"^^"
"RTN","PXCACPT1",20,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",8)_"^" ;2nd Dx
"RTN","PXCACPT1",21,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",9)_"^" ;3rd Dx
"RTN","PXCACPT1",22,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",10)_"^" ;4th Dx
"RTN","PXCACPT1",23,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",11)_"^" ;5th Dx
"RTN","PXCACPT1",24,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",12)_"^" ;6th Dx
"RTN","PXCACPT1",25,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",13)_"^" ;7th Dx
"RTN","PXCACPT1",26,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",14)_"^" ;8th Dx
"RTN","PXCACPT1",27,0)
 S PXCAFTER=PXCAFTER_$P(PXCAPROC,"^",2)
"RTN","PXCACPT1",28,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,"IEN")=""
"RTN","PXCACPT1",29,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,0,"BEFORE")=""
"RTN","PXCACPT1",30,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,0,"AFTER")=PXCAFTER
"RTN","PXCACPT1",31,0)
 IF $P(PXCAFTER,"^",5)]"" D ANOTHPOV^PXCAPOV($P(PXCAFTER,"^",5))
"RTN","PXCACPT1",32,0)
 IF $P(PXCAFTER,"^",9)]"" D ANOTHPOV^PXCAPOV($P(PXCAFTER,"^",9))
"RTN","PXCACPT1",33,0)
 IF $P(PXCAFTER,"^",10)]"" D ANOTHPOV^PXCAPOV($P(PXCAFTER,"^",10))
"RTN","PXCACPT1",34,0)
 IF $P(PXCAFTER,"^",11)]"" D ANOTHPOV^PXCAPOV($P(PXCAFTER,"^",11))
"RTN","PXCACPT1",35,0)
 IF $P(PXCAFTER,"^",12)]"" D ANOTHPOV^PXCAPOV($P(PXCAFTER,"^",12))
"RTN","PXCACPT1",36,0)
 IF $P(PXCAFTER,"^",13)]"" D ANOTHPOV^PXCAPOV($P(PXCAFTER,"^",13))
"RTN","PXCACPT1",37,0)
 IF $P(PXCAFTER,"^",14)]"" D ANOTHPOV^PXCAPOV($P(PXCAFTER,"^",14))
"RTN","PXCACPT1",38,0)
 IF $P(PXCAFTER,"^",15)]"" D ANOTHPOV^PXCAPOV($P(PXCAFTER,"^",15))
"RTN","PXCACPT1",39,0)
 ;Set modifier nodes
"RTN","PXCACPT1",40,0)
 S (PXCAMOD,PXCAWARN)=""
"RTN","PXCACPT1",41,0)
 F PXCACNT=1:1 S PXCAMOD=$O(PXCA("PROCEDURE",PXCAPRV,PXCAINDX,PXCAMOD)) Q:PXCAMOD=""  D
"RTN","PXCACPT1",42,0)
 . S PXMDIEN=$$MODP^ICPTMOD(+PXCAFTER,PXCAMOD,"E",PXCADT)
"RTN","PXCACPT1",43,0)
 . I +PXMDIEN<1 D  Q
"RTN","PXCACPT1",44,0)
 .. S PXCAWARN=$S(PXCAWARN="":"",1:PXCAWARN_",")_PXCAMOD
"RTN","PXCACPT1",45,0)
 .. S PXCA("PROCEDURE",PXCAPRV,PXCAINDX,PXCAMOD)="Invalid Modifier"
"RTN","PXCACPT1",46,0)
 . S PXCASTR=$$MOD^ICPTMOD(PXMDIEN,"I",PXCADT)
"RTN","PXCACPT1",47,0)
 . S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,1,PXCACNT,"BEFORE")=""
"RTN","PXCACPT1",48,0)
 . S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,1,PXCACNT,"AFTER")=+PXCASTR
"RTN","PXCACPT1",49,0)
 . I PXCA("PROCEDURE",PXCAPRV,PXCAINDX,PXCAMOD)="" D
"RTN","PXCACPT1",50,0)
 .. S PXCA("PROCEDURE",PXCAPRV,PXCAINDX,PXCAMOD)=$P(PXCASTR,"^",1,3)
"RTN","PXCACPT1",51,0)
 I PXCAWARN]"" D
"RTN","PXCACPT1",52,0)
 . S PXCA("WARNING","PROCEDURE",PXCAPRV,PXCAINDX,0)="CPT Modifier(s) "_PXCAWARN_" invalid. Code(s) not stored."
"RTN","PXCACPT1",53,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,12,"BEFORE")=""
"RTN","PXCACPT1",54,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,12,"AFTER")=$P(PXCAPROC,"^",4)_"^^^"_$S(PXCAPRV>0:PXCAPRV,1:"")
"RTN","PXCACPT1",55,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,802,"BEFORE")=""
"RTN","PXCACPT1",56,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,802,"AFTER")=$P(PXCAPROC,"^",7)
"RTN","PXCACPT1",57,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,812,"BEFORE")=""
"RTN","PXCACPT1",58,0)
 S ^TMP(PXCAGLB,$J,"CPT",PXCANUMB,812,"AFTER")="^"_PXCAPKG_"^"_PXCASOR
"RTN","PXCACPT1",59,0)
 Q
"RTN","PXCACPT1",60,0)
 ;
"RTN","PXCAPOV")
0^27^B36491994
"RTN","PXCAPOV",1,0)
PXCAPOV ;ISL/dee & LEA/Chylton - Validates data from the PCE Device Interface into PCE's PXK format for POV ;3/20/97
"RTN","PXCAPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**24,27,33,121,130,124**;Aug 12, 1996
"RTN","PXCAPOV",3,0)
 Q
"RTN","PXCAPOV",4,0)
 ; Variables
"RTN","PXCAPOV",5,0)
 ;   PXCADIAG  Copy of a Diagnosis node of the PXCA array
"RTN","PXCAPOV",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCAPOV",7,0)
 ;   ;   PXCANPOV  Count of the number of POVs
"RTN","PXCAPOV",8,0)
 ;   PXCANUMB  Count of the number if POVs
"RTN","PXCAPOV",9,0)
 ;   PXCAINDX  Count of the number of Diagnoses for one provider
"RTN","PXCAPOV",10,0)
 ;
"RTN","PXCAPOV",11,0)
DIAG(PXCA,PXCABULD,PXCAERRS) ;Validation routine for POV
"RTN","PXCAPOV",12,0)
 N PXCADIAG,PXCAPRV,PXCAINDX
"RTN","PXCAPOV",13,0)
 S PXCAPRV=""
"RTN","PXCAPOV",14,0)
 F  S PXCAPRV=$O(PXCA("DIAGNOSIS",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCAPOV",15,0)
 . I PXCAPRV>0 D
"RTN","PXCAPOV",16,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCAPOV",17,0)
 .. E  I PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCAPOV",18,0)
 . S PXCAINDX=0
"RTN","PXCAPOV",19,0)
 . F  S PXCAINDX=$O(PXCA("DIAGNOSIS",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCAPOV",20,0)
 .. S PXCADIAG=$G(PXCA("DIAGNOSIS",PXCAPRV,PXCAINDX))
"RTN","PXCAPOV",21,0)
 .. I PXCADIAG="" S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,0)="DIAGNOSIS data missing" Q
"RTN","PXCAPOV",22,0)
 .. S PXCANPOV=PXCANPOV+1
"RTN","PXCAPOV",23,0)
 .. N PXCAITEM,PXCAITM2,PXCAPNAR,PXCANARC,PXCACLEX
"RTN","PXCAPOV",24,0)
 .. ;
"RTN","PXCAPOV",25,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",1)
"RTN","PXCAPOV",26,0)
 .. D
"RTN","PXCAPOV",27,0)
 ... ;N DIC,DR,DA,DIQ,PXCADIQ1
"RTN","PXCAPOV",28,0)
 ... ;S DIC=80
"RTN","PXCAPOV",29,0)
 ... ;S DR=".01;102"
"RTN","PXCAPOV",30,0)
 ... ;S DA=$S(PXCAITEM'="":PXCAITEM,1:-1)
"RTN","PXCAPOV",31,0)
 ... ;S DIQ="PXCADIQ1("
"RTN","PXCAPOV",32,0)
 ... ;S DIQ(0)="I"
"RTN","PXCAPOV",33,0)
 ... ;D EN^DIQ1
"RTN","PXCAPOV",34,0)
 ... ;I $G(PXCADIQ1(80,DA,.01,"I"))="" S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,1)="ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCAPOV",35,0)
 ... ;E  I $G(PXCADIQ1(80,DA,102,"I")),PXCADIQ1(80,DA,102,"I")'>+PXCADT S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,1)="ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCAPOV",36,0)
 ... N ICDSTR,ICDCN,ICDID
"RTN","PXCAPOV",37,0)
 ... S ICDSTR=$$ICDDX^ICDCODE($S(PXCAITEM'="":PXCAITEM,1:-1),+PXCADT)
"RTN","PXCAPOV",38,0)
 ... S ICDCN=$P(ICDSTR,"^",2)
"RTN","PXCAPOV",39,0)
 ... S ICDID=$P(ICDSTR,"^",12)
"RTN","PXCAPOV",40,0)
 ... I +ICDSTR=-1 S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,1)="ICD9 Code not in file 80^"_PXCAITEM
"RTN","PXCAPOV",41,0)
 ... E  I '$P(ICDSTR,"^",10) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,1)="ICD9 Code is INACTIVE^"_PXCAITEM
"RTN","PXCAPOV",42,0)
 ...;
"RTN","PXCAPOV",43,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",2)
"RTN","PXCAPOV",44,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="S")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,2)="Diagnosis specification code must be P|S^"_PXCAITEM
"RTN","PXCAPOV",45,0)
 .. E  I PXCAITEM="P" D
"RTN","PXCAPOV",46,0)
 ... I 'PXCAPDX S PXCAPDX=$P(PXCADIAG,"^",1)
"RTN","PXCAPOV",47,0)
 ... E  I $P($G(^PX(815,1,"DI")),"^",2) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,2)="There is already a Primary Diagnosis for this encounter^"_PXCAITEM
"RTN","PXCAPOV",48,0)
 ... E  D
"RTN","PXCAPOV",49,0)
 .... S PXCA("WARNING","DIAGNOSIS",PXCAPRV,PXCAINDX,2)="There is already a Primary Diagnosis. This one is changed to Secondary^"_PXCAITEM
"RTN","PXCAPOV",50,0)
 .... S $P(PXCADIAG,"^",2)="S"
"RTN","PXCAPOV",51,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",3)
"RTN","PXCAPOV",52,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,3)="SC flag bad^"_PXCAITEM
"RTN","PXCAPOV",53,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",4)
"RTN","PXCAPOV",54,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,4)="AO flag bad^"_PXCAITEM
"RTN","PXCAPOV",55,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",5)
"RTN","PXCAPOV",56,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,5)="IR flag bad^"_PXCAITEM
"RTN","PXCAPOV",57,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",6)
"RTN","PXCAPOV",58,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,6)="EC flag bad^"_PXCAITEM
"RTN","PXCAPOV",59,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",11)
"RTN","PXCAPOV",60,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,11)="MST flag bad^"_PXCAITEM
"RTN","PXCAPOV",61,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",12)
"RTN","PXCAPOV",62,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,12)="HNC flag bad^"_PXCAITEM
"RTN","PXCAPOV",63,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",13)
"RTN","PXCAPOV",64,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,13)="CV flag bad^"_PXCAITEM ;CV
"RTN","PXCAPOV",65,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",14)
"RTN","PXCAPOV",66,0)
 .. I '(PXCAITEM="R"!(PXCAITEM="O")!(PXCAITEM="RO")!(PXCAITEM="")) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,14)="Ordering/Resulting field bad^"_PXCAITEM
"RTN","PXCAPOV",67,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",7)
"RTN","PXCAPOV",68,0)
 .. I PXCAITEM]"" D
"RTN","PXCAPOV",69,0)
 ... I $G(^AUPNPROB(PXCAITEM,0))="" S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,7)="Problem not in file 9000011^"_PXCAITEM
"RTN","PXCAPOV",70,0)
 ... E  I PXCAPAT'=$P($G(^AUPNPROB(PXCAITEM,0)),"^",2) S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,7)="Problem in file 9000011 is for a different Patient^"_PXCAITEM
"RTN","PXCAPOV",71,0)
 .. ;
"RTN","PXCAPOV",72,0)
 .. ;Clinical Lexicon Term
"RTN","PXCAPOV",73,0)
 .. S PXCAITEM=$P(PXCADIAG,"^",10)
"RTN","PXCAPOV",74,0)
 .. I PXCAITEM]"" D
"RTN","PXCAPOV",75,0)
 ... I $D(^LEX(757.01)) D
"RTN","PXCAPOV",76,0)
 .... I $D(^LEX(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,10)="Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCAPOV",77,0)
 .... E  S PXCACLEX=PXCAITEM
"RTN","PXCAPOV",78,0)
 ... E  I $D(^GMP(757.01)) D
"RTN","PXCAPOV",79,0)
 .... I $D(^GMP(757.01,PXCAITEM,0))#2'=1 S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,10)="Clinical Lexicon Utility term is not in file 757.01^"_PXCAITEM
"RTN","PXCAPOV",80,0)
 .... E  S PXCACLEX=PXCAITEM
"RTN","PXCAPOV",81,0)
 ... E  S PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX,10)="Lexicon Utility is not installed^"_PXCAITEM
"RTN","PXCAPOV",82,0)
 .. ;
"RTN","PXCAPOV",83,0)
 .. D PART1^PXCAPOV1
"RTN","PXCAPOV",84,0)
 .. ;
"RTN","PXCAPOV",85,0)
 .. I PXCABULD&'$D(PXCA("ERROR","DIAGNOSIS",PXCAPRV,PXCAINDX))!PXCAERRS D POV^PXCADX(PXCADIAG,PXCANPOV,PXCAPRV,PXCAERRS)
"RTN","PXCAPOV",86,0)
 Q
"RTN","PXCAPOV",87,0)
 ;
"RTN","PXCAPOV",88,0)
ANOTHPOV(PXCAAPOV) ; 
"RTN","PXCAPOV",89,0)
 ;Add the diagnosis to V POV if they are not there.
"RTN","PXCAPOV",90,0)
 ;Quit if the provider subscript is zero
"RTN","PXCAPOV",91,0)
 ; Variables
"RTN","PXCAPOV",92,0)
 ;   PXCAAPOV  Pointer to the DIAGNOSIS (80)
"RTN","PXCAPOV",93,0)
 ;   PXCAINDX  Subscript of the diagnosis in the temp array used to
"RTN","PXCAPOV",94,0)
 ;               look to see if the above diagnosis is already know.
"RTN","PXCAPOV",95,0)
 Q:PXCAAPOV'>0
"RTN","PXCAPOV",96,0)
 N PXCAINDX
"RTN","PXCAPOV",97,0)
 ;See if this diagnosis is in the ^TMP(PXCAGLB,$J,
"RTN","PXCAPOV",98,0)
 F PXCAINDX=1:1:PXCANPOV I PXCAAPOV=+$G(^TMP(PXCAGLB,$J,"POV",PXCAINDX,0,"AFTER")) S PXCAINDX=0 Q
"RTN","PXCAPOV",99,0)
 Q:PXCAINDX'>0
"RTN","PXCAPOV",100,0)
 S PXCAINDX=0
"RTN","PXCAPOV",101,0)
 ;See if this diagnosis is already in V POV for this Encounter
"RTN","PXCAPOV",102,0)
 F  S PXCAINDX=$O(^AUPNVPOV("AD",PXCAVSIT,PXCAAPOV)) Q:PXCAINDX'>0  I PXCAAPOV=$P(^AUPNVPOV(PXCAINDX,0),"^",1) Q
"RTN","PXCAPOV",103,0)
 Q:PXCAINDX>0
"RTN","PXCAPOV",104,0)
 S PXCANPOV=PXCANPOV+1
"RTN","PXCAPOV",105,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,"IEN")=""
"RTN","PXCAPOV",106,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,0,"BEFORE")=""
"RTN","PXCAPOV",107,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,0,"AFTER")=PXCAAPOV_"^"_PXCAPAT_"^"_PXCAVSIT_"^^^^^^^^^S"
"RTN","PXCAPOV",108,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,812,"BEFORE")=""
"RTN","PXCAPOV",109,0)
 S ^TMP(PXCAGLB,$J,"POV",PXCANPOV,812,"AFTER")="^"_PXCAPKG_"^"_PXCASOR
"RTN","PXCAPOV",110,0)
 Q
"RTN","PXCAPOV",111,0)
 ;
"RTN","PXCASK")
0^48^B12106125
"RTN","PXCASK",1,0)
PXCASK ;ISL/dee - Validates & Translates data from the PCE Device Interface into PCE's PXK format for Skin Test ;3/14/97
"RTN","PXCASK",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,124**;Aug 12, 1996
"RTN","PXCASK",3,0)
 Q
"RTN","PXCASK",4,0)
 ; Variables
"RTN","PXCASK",5,0)
 ;   PXCASK  Copy of a SKIN TEST node of the PXCA array
"RTN","PXCASK",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCASK",7,0)
 ;   PXCANUMB  Count of the number if SKs
"RTN","PXCASK",8,0)
 ;   PXCAINDX  Count of the number of SKIN TEST for one provider
"RTN","PXCASK",9,0)
 ;   PXCAFTER  Temp used to build ^TMP(PXCAGLB,$J,"SK",PXCANUMB,0,"AFTER")
"RTN","PXCASK",10,0)
 ;   PXCAPNAR  Pointer to the provider narrative (9999999.27)
"RTN","PXCASK",11,0)
 ;
"RTN","PXCASK",12,0)
SK(PXCASK,PXCANUMB,PXCAPRV,PXCAERRS) ;
"RTN","PXCASK",13,0)
 N PXCAFTER
"RTN","PXCASK",14,0)
 S PXCAFTER=$P(PXCASK,"^",1)_"^"_PXCAPAT_"^"_PXCAVSIT_"^"
"RTN","PXCASK",15,0)
 S PXCAFTER=PXCAFTER_$P(PXCASK,"^",3)_"^"
"RTN","PXCASK",16,0)
 S PXCAFTER=PXCAFTER_$P(PXCASK,"^",2)_"^"
"RTN","PXCASK",17,0)
 ;PX*1*124
"RTN","PXCASK",18,0)
 S PXCAFTER=PXCAFTER_$P(PXCASK,"^",4)_"^^"_$P(PXCASK,"^",6)_"^"_$P(PXCASK,"^",7)_"^"_$P(PXCASK,"^",8)_"^"_$P(PXCASK,"^",9)_"^"_$P(PXCASK,"^",10)_"^"_$P(PXCASK,"^",11)_"^"_$P(PXCASK,"^",12)_"^"_$P(PXCASK,"^",13)
"RTN","PXCASK",19,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,"IEN")=""
"RTN","PXCASK",20,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,0,"BEFORE")=""
"RTN","PXCASK",21,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,0,"AFTER")=PXCAFTER
"RTN","PXCASK",22,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,12,"BEFORE")=""
"RTN","PXCASK",23,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,12,"AFTER")=$P(PXCASK,"^",5)_"^^^"_$S(PXCAPRV>0:PXCAPRV,1:"")
"RTN","PXCASK",24,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,812,"BEFORE")=""
"RTN","PXCASK",25,0)
 S ^TMP(PXCAGLB,$J,"SK",PXCANUMB,812,"AFTER")="^"_PXCAPKG_"^"_PXCASOR
"RTN","PXCASK",26,0)
 Q
"RTN","PXCASK",27,0)
 ;
"RTN","PXCASK",28,0)
SKINTEST(PXCA,PXCABULD,PXCAERRS) ;Validation routine for SK
"RTN","PXCASK",29,0)
 Q:'$D(PXCA("SKIN TEST"))
"RTN","PXCASK",30,0)
 N PXCASK,PXCAPRV,PXCANUMB,PXCAINDX,PXCAITEM
"RTN","PXCASK",31,0)
 S PXCAPRV=""
"RTN","PXCASK",32,0)
 S PXCANUMB=0
"RTN","PXCASK",33,0)
 F  S PXCAPRV=$O(PXCA("SKIN TEST",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCASK",34,0)
 . I PXCAPRV>0 D
"RTN","PXCASK",35,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","SKIN TEST",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCASK",36,0)
 .. E  I PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCASK",37,0)
 . S PXCAINDX=""
"RTN","PXCASK",38,0)
 . F  S PXCAINDX=$O(PXCA("SKIN TEST",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCASK",39,0)
 .. S PXCASK=$G(PXCA("SKIN TEST",PXCAPRV,PXCAINDX))
"RTN","PXCASK",40,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCASK",41,0)
 .. I PXCASK="" S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,0)="SKIN TEST data missing" Q
"RTN","PXCASK",42,0)
 .. S PXCAITEM=+$P(PXCASK,"^",1)
"RTN","PXCASK",43,0)
 .. I $G(^AUTTSK(PXCAITEM,0))="" S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,1)="SKIN TEST type not in file 9999999.28^"_PXCAITEM
"RTN","PXCASK",44,0)
 .. S PXCAITEM=$P(PXCASK,"^",2)
"RTN","PXCASK",45,0)
 .. I '((PXCAITEM=(PXCAITEM\1)&(PXCAITEM>-1)&(PXCAITEM<41))!(PXCAITEM="")) S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,2)="SKIN TEST reaction must be an integer form 0 to 40^"_PXCAITEM
"RTN","PXCASK",46,0)
 .. S PXCAITEM=$P(PXCASK,"^",3)
"RTN","PXCASK",47,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="N")!(PXCAITEM="D")!(PXCAITEM="O")) S PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX,3)="SKIN TEST results must be P|N|D|O^"_PXCAITEM
"RTN","PXCASK",48,0)
 .. I PXCABULD&'$D(PXCA("ERROR","SKIN TEST",PXCAPRV,PXCAINDX))!PXCAERRS D SK(PXCASK,.PXCANUMB,PXCAPRV,PXCAERRS)
"RTN","PXCASK",49,0)
 Q
"RTN","PXCASK",50,0)
 ;
"RTN","PXCAVIMM")
0^49^B17122556
"RTN","PXCAVIMM",1,0)
PXCAVIMM ;ISL/dee - Validates & Translates data from the PCE Device Interface into PCE's PXK format for Immunizations ;3/14/97
"RTN","PXCAVIMM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,124**;Aug 12, 1996
"RTN","PXCAVIMM",3,0)
 Q
"RTN","PXCAVIMM",4,0)
 ; Variables
"RTN","PXCAVIMM",5,0)
 ;   PXCAIMM  Copy of a IMMUNIZATION node of the PXCA array
"RTN","PXCAVIMM",6,0)
 ;   PXCAPRV   Pointer to the provider (200)
"RTN","PXCAVIMM",7,0)
 ;   PXCANUMB  Count of the number if IMMs
"RTN","PXCAVIMM",8,0)
 ;   PXCAINDX  Count of the number of IMMUNIZATION for one provider
"RTN","PXCAVIMM",9,0)
 ;   PXCAFTER  Temp used to build ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,0,"AFTER")
"RTN","PXCAVIMM",10,0)
 ;   PXCAPNAR  Pointer to the provider narrative (9999999.27)
"RTN","PXCAVIMM",11,0)
 ;
"RTN","PXCAVIMM",12,0)
IMM(PXCAIMM,PXCANUMB,PXCAPRV,PXCAERRS) ;
"RTN","PXCAVIMM",13,0)
 N PXCAFTER
"RTN","PXCAVIMM",14,0)
 S PXCAFTER=$P(PXCAIMM,"^",1)_"^"_PXCAPAT_"^"_PXCAVSIT_"^"
"RTN","PXCAVIMM",15,0)
 S PXCAFTER=PXCAFTER_$P(PXCAIMM,"^",2,4)
"RTN","PXCAVIMM",16,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,"IEN")=""
"RTN","PXCAVIMM",17,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,0,"BEFORE")=""
"RTN","PXCAVIMM",18,0)
 ;PX*1*124
"RTN","PXCAVIMM",19,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,0,"AFTER")=PXCAFTER_"^^"_$P(PXCAIMM,"^",8)_"^"_$P(PXCAIMM,"^",9)_"^"_$P(PXCAIMM,"^",10)_"^"_$P(PXCAIMM,"^",11)_"^"_$P(PXCAIMM,"^",12)_"^"_$P(PXCAIMM,"^",13)_"^"_$P(PXCAIMM,"^",14)_"^"_$P(PXCAIMM,"^",15)
"RTN","PXCAVIMM",20,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,12,"BEFORE")=""
"RTN","PXCAVIMM",21,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,12,"AFTER")=$P(PXCAIMM,"^",6)_"^^^"_$S(PXCAPRV>0:PXCAPRV,1:"")
"RTN","PXCAVIMM",22,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,811,"BEFORE")=""
"RTN","PXCAVIMM",23,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,811,"AFTER")=$P(PXCAIMM,"^",7)
"RTN","PXCAVIMM",24,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,812,"BEFORE")=""
"RTN","PXCAVIMM",25,0)
 S ^TMP(PXCAGLB,$J,"IMM",PXCANUMB,812,"AFTER")="^"_PXCAPKG_"^"_PXCASOR
"RTN","PXCAVIMM",26,0)
 Q
"RTN","PXCAVIMM",27,0)
 ;
"RTN","PXCAVIMM",28,0)
IMMUN(PXCA,PXCABULD,PXCAERRS) ;Validation routine for IMM
"RTN","PXCAVIMM",29,0)
 Q:'$D(PXCA("IMMUNIZATION"))
"RTN","PXCAVIMM",30,0)
 N PXCAIMM,PXCAPRV,PXCANUMB,PXCAINDX
"RTN","PXCAVIMM",31,0)
 N PXCAITEM,PXCAITM2
"RTN","PXCAVIMM",32,0)
 S PXCAPRV=""
"RTN","PXCAVIMM",33,0)
 S PXCANUMB=0
"RTN","PXCAVIMM",34,0)
 F  S PXCAPRV=$O(PXCA("IMMUNIZATION",PXCAPRV)) Q:PXCAPRV']""  D
"RTN","PXCAVIMM",35,0)
 . I PXCAPRV>0 D
"RTN","PXCAVIMM",36,0)
 .. I '$$ACTIVPRV^PXAPI(PXCAPRV,PXCADT) S PXCA("ERROR","IMMUNIZATION",PXCAPRV,0,0)="Provider is not active or valid^"_PXCAPRV
"RTN","PXCAVIMM",37,0)
 .. E  I PXCABULD!PXCAERRS D ANOTHPRV^PXCAPRV(PXCAPRV)
"RTN","PXCAVIMM",38,0)
 . S PXCAINDX=0
"RTN","PXCAVIMM",39,0)
 . F  S PXCAINDX=$O(PXCA("IMMUNIZATION",PXCAPRV,PXCAINDX)) Q:PXCAINDX']""  D
"RTN","PXCAVIMM",40,0)
 .. S PXCAIMM=$G(PXCA("IMMUNIZATION",PXCAPRV,PXCAINDX))
"RTN","PXCAVIMM",41,0)
 .. S PXCANUMB=PXCANUMB+1
"RTN","PXCAVIMM",42,0)
 .. I PXCAIMM="" S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,0)="IMMUNIZATION data missing" Q
"RTN","PXCAVIMM",43,0)
 .. S PXCAITEM=+$P(PXCAIMM,U,1)
"RTN","PXCAVIMM",44,0)
 .. I $G(^AUTTIMM(PXCAITEM,0))="" S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,1)="IMMUNIZATION type not in file 9999999.14^"_PXCAITEM
"RTN","PXCAVIMM",45,0)
 .. S PXCAITEM=$P(PXCAIMM,U,2)
"RTN","PXCAVIMM",46,0)
 .. I '(PXCAITEM=""!(PXCAITEM="P")!(PXCAITEM="C")!(PXCAITEM="B")!((PXCAITEM=(PXCAITEM\1))&(PXCAITEM>0)&(PXCAITEM<9))) S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,2)="IMMUNIZATION series must be P|C|B|1|2|3|4|5|6|7|8^"_PXCAITEM
"RTN","PXCAVIMM",47,0)
 .. S PXCAITEM=$P(PXCAIMM,U,4)
"RTN","PXCAVIMM",48,0)
 .. I '((PXCAITEM=(PXCAITEM\1)&(PXCAITEM>0)&(PXCAITEM<12))!(PXCAITEM="")) S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,4)="IMMUNIZATION reaction must be an integer form 1 to 11^"_PXCAITEM
"RTN","PXCAVIMM",49,0)
 .. S PXCAITEM=$P(PXCAIMM,U,5)
"RTN","PXCAVIMM",50,0)
 .. I '(PXCAITEM=1!(PXCAITEM=0)!(PXCAITEM="")) S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,5)="IMMUNIZATION contraindicated flag bad^"_PXCAITEM
"RTN","PXCAVIMM",51,0)
 .. S PXCAITEM=$P(PXCAIMM,U,6)
"RTN","PXCAVIMM",52,0)
 .. S PXCAITEM=$P(PXCAIMM,U,7)
"RTN","PXCAVIMM",53,0)
 .. I $L(PXCAITEM)>80 S PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX,6)="IMMUNIZATION remarks must be 1-80 Characters^"_PXCAITEM
"RTN","PXCAVIMM",54,0)
 .. I PXCABULD&'$D(PXCA("ERROR","IMMUNIZATION",PXCAPRV,PXCAINDX))!PXCAERRS D IMM(PXCAIMM,.PXCANUMB,PXCAPRV,PXCAERRS)
"RTN","PXCAVIMM",55,0)
 Q
"RTN","PXCAVIMM",56,0)
 ;
"RTN","PXCEAPPM")
0^60^B6418906
"RTN","PXCEAPPM",1,0)
PXCEAPPM ;ISL/dee,ISA/KWP - Used to add a new visit from the appointment display and display a visit ;04/28/99
"RTN","PXCEAPPM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,74,111,130,124**;Aug 12, 1996
"RTN","PXCEAPPM",3,0)
 ;+The classifications are displayed with this routine when adding
"RTN","PXCEAPPM",4,0)
 ;+an encounter from the appointment list
"RTN","PXCEAPPM",5,0)
 Q
"RTN","PXCEAPPM",6,0)
 ;
"RTN","PXCEAPPM",7,0)
 ;Line with the line label "FORMAT"
"RTN","PXCEAPPM",8,0)
 ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (not used on visit)~File global name
"RTN","PXCEAPPM",9,0)
 ;     1         2             3                   4                                        5
"RTN","PXCEAPPM",10,0)
 ;
"RTN","PXCEAPPM",11,0)
 ;Following lines:
"RTN","PXCEAPPM",12,0)
 ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCEAPPM",13,0)
 ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~       10
"RTN","PXCEAPPM",14,0)
 ;The Display & Edit routines are for special cases.
"RTN","PXCEAPPM",15,0)
 ;
"RTN","PXCEAPPM",16,0)
FORMAT ;;Encounter~9000010~0,21,150,800,811,812~~^AUPNVSIT
"RTN","PXCEAPPM",17,0)
 ;;0~1~.01~Encounter Date and Time:  ~Encounter Date and Time:  ~~EVISITDT^PXCEVSIT(1)~~~B
"RTN","PXCEAPPM",18,0)
 ;;0~18~.18~Check Out ~Check Out Date and Time:  ~~ECODT^PXCEVSIT~~~D
"RTN","PXCEAPPM",19,0)
 ;;800~1~80001~Service Connected:  ~Service Connected:  ~~GET800^PXCEE800~~~D
"RTN","PXCEAPPM",20,0)
 ;;800~7~80007~Combat Veteran:  ~Combat Veteran:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEAPPM",21,0)
 ;;800~2~80002~Agent Orange Exposure:  ~Agent Orange Exposure:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEAPPM",22,0)
 ;;800~3~80003~Ionizing Radiation Exposure:  ~Ionizing Radiation Exposure:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEAPPM",23,0)
 ;;800~4~80004~Environmental Contaminants:  ~Environmental Contaminants:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEAPPM",24,0)
 ;;800~5~80005~Military Sexual Trauma:  ~Military Sexual Trauma:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEAPPM",25,0)
 ;;800~6~80006~Head and/or Neck Cancer:  ~Head and/or Neck Cancer:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEAPPM",26,0)
 ;
"RTN","PXCEAPPM",27,0)
 ;
"RTN","PXCEAPPM",28,0)
 ;
"RTN","PXCEAPPM",29,0)
 ;********************************
"RTN","PXCEAPPM",30,0)
 ;Special cases for display of visit are in PXCEVSIT.
"RTN","PXCEAPPM",31,0)
 ;
"RTN","PXCEAPPM",32,0)
 ;********************************
"RTN","PXCEAPPM",33,0)
 ;Special cases for edit of visit are in PXCEVSIT.
"RTN","PXCEAPPM",34,0)
 ;
"RTN","PXCEAPPM",35,0)
 ;********************************
"RTN","PXCEAPPM",36,0)
 ;Display text for the .01 field which is a Date and Time.
"RTN","PXCEAPPM",37,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCEAPPM",38,0)
DISPLY01(PXCEVSIT) ;
"RTN","PXCEAPPM",39,0)
 Q $$DISPLY01^PXCESIT(PXCEVSIT)
"RTN","PXCEAPPM",40,0)
 ;
"RTN","PXCEC800")
0^18^B2123321
"RTN","PXCEC800",1,0)
PXCEC800 ;ISL/dee,ISA/KWP - Used in editing the 800 node, Service Connected conditions ;12/22/04 1:38pm
"RTN","PXCEC800",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Aug 12, 1996
"RTN","PXCEC800",3,0)
 ;; ;
"RTN","PXCEC800",4,0)
 Q
"RTN","PXCEC800",5,0)
 ;
"RTN","PXCEC800",6,0)
GET800 ;Used by the Service Connected Conditions
"RTN","PXCEC800",7,0)
 N PXCEINDX,PXOUT
"RTN","PXCEC800",8,0)
 N PXBDATA,PXLOC,PXAPTDT,PXDFN
"RTN","PXCEC800",9,0)
 I $O(^SCE("AVSIT",PXCEVIEN,0)) D CLASS^PXBAPI21("","","","",PXCEVIEN)
"RTN","PXCEC800",10,0)
 I '$O(^SCE("AVSIT",PXCEVIEN,0)) D
"RTN","PXCEC800",11,0)
 . S PXAPTDT=+^AUPNVSIT(PXCEVIEN,0)
"RTN","PXCEC800",12,0)
 . S PXDFN=$P(^AUPNVSIT(PXCEVIEN,0),"^",5)
"RTN","PXCEC800",13,0)
 . S PXLOC=$P(^AUPNVSIT(PXCEVIEN,0),"^",22)
"RTN","PXCEC800",14,0)
 . D CLASS^PXBAPI21("",PXDFN,PXAPTDT,PXLOC,"")
"RTN","PXCEC800",15,0)
 F PXCEINDX=1:1:6 I $G(PXBDATA("ERR",PXCEINDX))=4 S PXOUT=PXBDATA("ERR",PXCEINDX)
"RTN","PXCEC800",16,0)
 I $D(PXOUT) S PXCEEND=1 Q  ;for visit and required fields
"RTN","PXCEC800",17,0)
 S $P(PXCEAFTR(800),"^",1)=$P($G(PXBDATA(3)),"^",2)
"RTN","PXCEC800",18,0)
 S $P(PXCEAFTR(800),"^",2)=$P($G(PXBDATA(1)),"^",2)
"RTN","PXCEC800",19,0)
 S $P(PXCEAFTR(800),"^",3)=$P($G(PXBDATA(2)),"^",2)
"RTN","PXCEC800",20,0)
 S $P(PXCEAFTR(800),"^",4)=$P($G(PXBDATA(4)),"^",2)
"RTN","PXCEC800",21,0)
 S $P(PXCEAFTR(800),"^",5)=$P($G(PXBDATA(5)),"^",2)
"RTN","PXCEC800",22,0)
 S $P(PXCEAFTR(800),"^",6)=$P($G(PXBDATA(6)),"^",2)
"RTN","PXCEC800",23,0)
 S $P(PXCEAFTR(800),"^",7)=$P($G(PXBDATA(7)),"^",2)
"RTN","PXCEC800",24,0)
 Q
"RTN","PXCEC800",25,0)
 ;
"RTN","PXCECCLS")
0^66^B21659444
"RTN","PXCECCLS",1,0)
PXCECCLS ;WASH/BDB - UPDATE ENCOUNTER SC/EI FROM DX SC/EI ;5/18/05 1:31pm
"RTN","PXCECCLS",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Feb 12, 2004
"RTN","PXCECCLS",3,0)
 Q
"RTN","PXCECCLS",4,0)
 ;
"RTN","PXCECCLS",5,0)
VST(PXVIEN) ;
"RTN","PXCECCLS",6,0)
 ;  VISITIEN  Pointer to the Visit (#9000010)
"RTN","PXCECCLS",7,0)
 ;  Loop over the diagnoses SC/EI, auto-populate the encounter level
"RTN","PXCECCLS",8,0)
 ;   SC/EI based on the following rule:
"RTN","PXCECCLS",9,0)
 ;   
"RTN","PXCECCLS",10,0)
 ;   If the SC/EI for at least one ICD-9 is "Yes"the Encounter Level
"RTN","PXCECCLS",11,0)
 ;    SC/EI will automatically be set to "Yes" regardless if the
"RTN","PXCECCLS",12,0)
 ;     Encounter Level SC (or EI) was previously populated ("Yes", "No" or Null).
"RTN","PXCECCLS",13,0)
 ;            Note: This presumes that a single ICD-9 with SC/EI determination of "Yes"
"RTN","PXCECCLS",14,0)
 ;        makes the Encounter SC/EI determination "Yes"
"RTN","PXCECCLS",15,0)
 ;        
"RTN","PXCECCLS",16,0)
 ;       If the SC/EI for all ICD-9s are "No" the Encounter Level SC/EI will
"RTN","PXCECCLS",17,0)
 ;       automatically be set to "No" regardless if the Encounter Level SC/EI
"RTN","PXCECCLS",18,0)
 ;       was previously populated ("Yes", "No" or Null).
"RTN","PXCECCLS",19,0)
 ;            Note: This presumes that an Encounter SC/EI can not be "Yes" if all
"RTN","PXCECCLS",20,0)
 ;        ICD-9s have an SC/EI determination of "No".
"RTN","PXCECCLS",21,0)
 ;        
"RTN","PXCECCLS",22,0)
 ;       If at least one ICD-9 is missing SC/EI determination and none of the
"RTN","PXCECCLS",23,0)
 ;       other ICD-9s SC/EI determination is "Yes" do not change the SC/EI
"RTN","PXCECCLS",24,0)
 ;       determination of the Encounter level.
"RTN","PXCECCLS",25,0)
 ;                 Note: This presumes that if one or more ICD-9s do not have an SC/EI
"RTN","PXCECCLS",26,0)
 ;       determination then no inference can be made upon the Encounter Level SC
"RTN","PXCECCLS",27,0)
 ;       determination.  In addition if another package populates SC/EI
"RTN","PXCECCLS",28,0)
 ;       directly do not overwrite that value in the case of incomplete
"RTN","PXCECCLS",29,0)
 ;       data.  In other words do not set the Encounter Level to Null.
"RTN","PXCECCLS",30,0)
 ;       
"RTN","PXCECCLS",31,0)
 ;       VARIABLE LIST TO AUTO POPULATE THE ENCOUNTER LEVEL SC/EI
"RTN","PXCECCLS",32,0)
 ;       For each SC/EI in the PXSCEINW string:
"RTN","PXCECCLS",33,0)
 ;                =1  SC/EI Classification determined by the DX's is found to be "Yes"
"RTN","PXCECCLS",34,0)
 ;                =0  SC/EI Classification determined by the DX's is found to be "NO"
"RTN","PXCECCLS",35,0)
 ;                =-1 SC/EI can not be determined by the DX's
"RTN","PXCECCLS",36,0)
 ;                ="" Do not ask the SC/EI questions
"RTN","PXCECCLS",37,0)
 ;       
"RTN","PXCECCLS",38,0)
 ;       Edit flag for SC: SCEF, AO: AOEF, IR: IREF, EC:ECEF, MST: MSTEF, HNC: HNCEF
"RTN","PXCECCLS",39,0)
 ;           , CV: CVEF  - Used in Visit File Filing - See ^VSITFLD
"RTN","PXCECCLS",40,0)
 ;           example below          
"RTN","PXCECCLS",41,0)
 ;       VIST("SCEF")=1  SC/EI Classification determined by the DX's - do not ask SC/EI
"RTN","PXCECCLS",42,0)
 ;       VIST("SCEF")=0  SC/EI Classification undetermined by the DX's - ask SC/EI
"RTN","PXCECCLS",43,0)
 ;       etc.
"RTN","PXCECCLS",44,0)
 ;             
"RTN","PXCECCLS",45,0)
 N PX0,PXDFN,PXDT,PXCL,PXPOV,VSIT,PXDFN,PXSCEINW,PXSCEI,PXPOV800
"RTN","PXCECCLS",46,0)
 S PXSCEINW="^^^^^^"
"RTN","PXCECCLS",47,0)
 ; Set encounter data in ^TMP
"RTN","PXCECCLS",48,0)
 D ENCEVENT^PXKENC(PXVIEN)
"RTN","PXCECCLS",49,0)
 ; Get classifications
"RTN","PXCECCLS",50,0)
 S PXDFN=$P($G(^TMP("PXKENC",$J,PXVIEN,"VST",PXVIEN,0)),U,5)
"RTN","PXCECCLS",51,0)
 Q:'PXDFN
"RTN","PXCECCLS",52,0)
 D SCCOND^PXUTLSCC(PXDFN,"","",PXVIEN,.PXSCEI)
"RTN","PXCECCLS",53,0)
 ;Loop over DX's
"RTN","PXCECCLS",54,0)
 S PXPOV="" F  S PXPOV=$O(^TMP("PXKENC",$J,PXVIEN,"POV",PXPOV)) Q:'PXPOV  D
"RTN","PXCECCLS",55,0)
 .S PXPOV800=$G(^(PXPOV,800))
"RTN","PXCECCLS",56,0)
 .I +$G(PXSCEI("SC")) I '($P(PXSCEINW,U,1)="1")  S:$P(PXPOV800,U,1)="1" $P(PXSCEINW,U,1)="1" I '($P(PXSCEINW,U,1)<0)  S:$P(PXPOV800,U,1)="" $P(PXSCEINW,U,1)="-1" S:$P(PXPOV800,U,1)="0" $P(PXSCEINW,U,1)="0"
"RTN","PXCECCLS",57,0)
 .I +$G(PXSCEI("AO")) I '($P(PXSCEINW,U,2)="1")  S:$P(PXPOV800,U,2)="1" $P(PXSCEINW,U,2)="1" I '($P(PXSCEINW,U,2)<0)  S:$P(PXPOV800,U,2)="" $P(PXSCEINW,U,2)="-1" S:$P(PXPOV800,U,2)="0" $P(PXSCEINW,U,2)="0"
"RTN","PXCECCLS",58,0)
 .I +$G(PXSCEI("IR")) I '($P(PXSCEINW,U,3)="1")  S:$P(PXPOV800,U,3)="1" $P(PXSCEINW,U,3)="1" I '($P(PXSCEINW,U,3)<0)  S:$P(PXPOV800,U,3)="" $P(PXSCEINW,U,3)="-1" S:$P(PXPOV800,U,3)="0" $P(PXSCEINW,U,3)="0"
"RTN","PXCECCLS",59,0)
 .I +$G(PXSCEI("EC")) I '($P(PXSCEINW,U,4)="1")  S:$P(PXPOV800,U,4)="1" $P(PXSCEINW,U,4)="1" I '($P(PXSCEINW,U,4)<0)  S:$P(PXPOV800,U,4)="" $P(PXSCEINW,U,4)="-1" S:$P(PXPOV800,U,4)="0" $P(PXSCEINW,U,4)="0"
"RTN","PXCECCLS",60,0)
 .I +$G(PXSCEI("MST")) I '($P(PXSCEINW,U,5)="1")  S:$P(PXPOV800,U,5)="1" $P(PXSCEINW,U,5)="1" I '($P(PXSCEINW,U,5)<0)  S:$P(PXPOV800,U,5)="" $P(PXSCEINW,U,5)="-1" S:$P(PXPOV800,U,5)="0" $P(PXSCEINW,U,5)="0"
"RTN","PXCECCLS",61,0)
 .I +$G(PXSCEI("HNC")) I '($P(PXSCEINW,U,6)="1")  S:$P(PXPOV800,U,6)="1" $P(PXSCEINW,U,6)="1" I '($P(PXSCEINW,U,6)<0)  S:$P(PXPOV800,U,6)="" $P(PXSCEINW,U,6)="-1" S:$P(PXPOV800,U,6)="0" $P(PXSCEINW,U,6)="0"
"RTN","PXCECCLS",62,0)
 .I +$G(PXSCEI("CV")) I '($P(PXSCEINW,U,7)="1")  S:$P(PXPOV800,U,7)="1" $P(PXSCEINW,U,7)="1" I '($P(PXSCEINW,U,7)<0)  S:$P(PXPOV800,U,7)="" $P(PXSCEINW,U,7)="-1" S:$P(PXPOV800,U,7)="0" $P(PXSCEINW,U,7)="0"
"RTN","PXCECCLS",63,0)
 S VSIT("IEN")=PXVIEN
"RTN","PXCECCLS",64,0)
 S VSIT("SCEF")=0,VSIT("AOEF")=0,VSIT("IREF")=0,VSIT("ECEF")=0,VSIT("MSTEF")=0,VSIT("HNCEF")=0,VSIT("CVEF")=0
"RTN","PXCECCLS",65,0)
 S:$P(PXSCEINW,U,1)="0"!($P(PXSCEINW,U,1)="1") VSIT("SC")=$P(PXSCEINW,U,1),VSIT("SCEF")=1
"RTN","PXCECCLS",66,0)
 S:$P(PXSCEINW,U,2)="0"!($P(PXSCEINW,U,2)="1") VSIT("AO")=$P(PXSCEINW,U,2),VSIT("AOEF")=1 S:$G(VSIT("SC"))=1 VSIT("AO")=""
"RTN","PXCECCLS",67,0)
 S:$P(PXSCEINW,U,3)="0"!($P(PXSCEINW,U,3)="1") VSIT("IR")=$P(PXSCEINW,U,3),VSIT("IREF")=1 S:$G(VSIT("SC"))=1 VSIT("IR")=""
"RTN","PXCECCLS",68,0)
 S:$P(PXSCEINW,U,4)="0"!($P(PXSCEINW,U,4)="1") VSIT("EC")=$P(PXSCEINW,U,4),VSIT("ECEF")=1 S:$G(VSIT("SC"))=1 VSIT("EC")=""
"RTN","PXCECCLS",69,0)
 S:$P(PXSCEINW,U,5)="0"!($P(PXSCEINW,U,5)="1") VSIT("MST")=$P(PXSCEINW,U,5),VSIT("MSTEF")=1
"RTN","PXCECCLS",70,0)
 S:$P(PXSCEINW,U,6)="0"!($P(PXSCEINW,U,6)="1") VSIT("HNC")=$P(PXSCEINW,U,6),VSIT("HNCEF")=1
"RTN","PXCECCLS",71,0)
 S:$P(PXSCEINW,U,7)="0"!($P(PXSCEINW,U,7)="1") VSIT("CV")=$P(PXSCEINW,U,7),VSIT("CVEF")=1
"RTN","PXCECCLS",72,0)
 D UPD^VSIT
"RTN","PXCECCLS",73,0)
 K ^TMP("PXKENC",$J)
"RTN","PXCECCLS",74,0)
 Q
"RTN","PXCECPT")
0^19^B64389674
"RTN","PXCECPT",1,0)
PXCECPT ;ISL/dee,ISA/Zoltan,esw - Used to edit and display V CPT ;6/22/04 3:27pm
"RTN","PXCECPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**14,27,73,89,112,121,136,124**;Aug 12, 1996
"RTN","PXCECPT",3,0)
 ;; ;
"RTN","PXCECPT",4,0)
 Q
"RTN","PXCECPT",5,0)
 ;
"RTN","PXCECPT",6,0)
 ;+Structure of Line with the line label "FORMAT"
"RTN","PXCECPT",7,0)
 ;+;;Long name~File Number~Node Subscripts~Allow Duplicate entries (1=yes, 0=no)~File global name
"RTN","PXCECPT",8,0)
 ;+      1         2             3                   4                                   5
"RTN","PXCECPT",9,0)
 ;+
"RTN","PXCECPT",10,0)
 ;+Structure of Followning lines:
"RTN","PXCECPT",11,0)
 ;+;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCECPT",12,0)
 ;+   1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~         10
"RTN","PXCECPT",13,0)
 ;+The Display & Edit routines are for special cases.
"RTN","PXCECPT",14,0)
 ;+  (The .01 fields cannot have a special edit.)
"RTN","PXCECPT",15,0)
 ;
"RTN","PXCECPT",16,0)
FORMAT ;;CPT~9000010.18~0,1,12,802,811,812~1~^AUPNVCPT
"RTN","PXCECPT",17,0)
 ;;0~1~.01~CPT Code:  ~CPT Code:  ~$$DISPLY01^PXCECPT~ECPTCODE^PXCECPT~^D HELP^PXCEHELP~~B
"RTN","PXCECPT",18,0)
 ;;0~17~.17~Order Reference:  ~Order Reference:  ~~SKIP^PXCECPT~~~D
"RTN","PXCECPT",19,0)
 ;;1~0~1~CPT Modifier:  ~CPT Modifier:  ~$$DISPMOD^PXCECPT~ECPTMOD^PXCECPT~Select a Modifier that is valid for the CPT code.~~B
"RTN","PXCECPT",20,0)
 ;;0~4~.04~Provider Narrative:  ~Provider Narrative:  ~$$DNARRAT^PXCECPT~ENARRAT^PXCEPOV1(1,1,1,81,2)~~~B
"RTN","PXCECPT",21,0)
 ;;0~16~.16~Quantity:  ~Quantity:  ~~EQUAN^PXCECPT~~~D
"RTN","PXCECPT",22,0)
 ;;0~7~.07~Principal Procedure:  ~Principal Procedure:  ~~~~~D
"RTN","PXCECPT",23,0)
 ;;12~2~1202~Ordering Provider:  ~Ordering Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCECPT",24,0)
 ;;12~4~1204~Encounter Provider:  ~Encounter Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCECPT",25,0)
 ;;802~1~80201~Provider Narrative Category:  ~Provider Narrative Category:  ~$$DNARRAT^PXCECPT~ENARRAT^PXCEPOV1(0,2,0,81,3)~~C~D
"RTN","PXCECPT",26,0)
 ;;811~1~81101~Comments:  ~Comments:  ~~~~~D
"RTN","PXCECPT",27,0)
 ;;0~5~.05~Primary Diagnosis:  ~Primary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",28,0)
 ;;0~9~.09~1st Secondary Diagnosis:  ~1st Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",29,0)
 ;;0~10~.1~2nd Secondary Diagnosis:  ~2nd Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",30,0)
 ;;0~11~.11~3rd Secondary Diagnosis:  ~3rd Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",31,0)
 ;;0~12~.12~4th Secondary Diagnosis:  ~4th Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",32,0)
 ;;0~13~.13~5th Secondary Diagnosis:  ~5th Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",33,0)
 ;;0~14~.14~6th Secondary Diagnosis:  ~6th Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",34,0)
 ;;0~15~.15~7th Secondary Diagnosis:  ~7th Secondary Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCECPT~~~
"RTN","PXCECPT",35,0)
 ;;
"RTN","PXCECPT",36,0)
 ;
"RTN","PXCECPT",37,0)
 ;The interface for AICS to get list on form for help.
"RTN","PXCECPT",38,0)
INTRFACE ;;DG SELECT CPT PROCEDURE CODES
"RTN","PXCECPT",39,0)
 ;+
"RTN","PXCECPT",40,0)
 ;+********************************
"RTN","PXCECPT",41,0)
 ;+Special cases for display.
"RTN","PXCECPT",42,0)
 ;
"RTN","PXCECPT",43,0)
DISPMOD(PXCECPT) ;
"RTN","PXCECPT",44,0)
 ;+Display the modifiers associated with this V CPT entry.
"RTN","PXCECPT",45,0)
 ;+PXCECPT = IEN in V CPT file.
"RTN","PXCECPT",46,0)
 N MODS,SIEN,MODIEN,SCRATCH,MODSTR,MODNAME,OUTSTR
"RTN","PXCECPT",47,0)
 I $G(PXCECPT)="" S PXCECPT=IEN
"RTN","PXCECPT",48,0)
 S OUTSTR=""
"RTN","PXCECPT",49,0)
 I PXCECPT="" Q OUTSTR
"RTN","PXCECPT",50,0)
 S SIEN=0
"RTN","PXCECPT",51,0)
 F MODS=1:1 S SIEN=$O(^AUPNVCPT(PXCECPT,1,SIEN)) Q:'SIEN  D
"RTN","PXCECPT",52,0)
 . S MODIEN=$P($G(^AUPNVCPT(PXCECPT,1,SIEN,0)),"^")
"RTN","PXCECPT",53,0)
 . S $P(OUTSTR,U,MODS)=$$MODTEXT(MODIEN)
"RTN","PXCECPT",54,0)
 Q OUTSTR
"RTN","PXCECPT",55,0)
DNARRAT(PNAR) ;+Display Provider Narrative for procedure in V CPT file.
"RTN","PXCECPT",56,0)
 I PNAR="" Q ""
"RTN","PXCECPT",57,0)
 N PXCEPNAR
"RTN","PXCECPT",58,0)
 S PXCEPNAR=$P(^AUTNPOV(PNAR,0),"^")
"RTN","PXCECPT",59,0)
 I $G(VIEW)="B",$D(ENTRY)>0 D
"RTN","PXCECPT",60,0)
 . ;N DIC,DR,DA,DIQ,PXCEDIQ1
"RTN","PXCECPT",61,0)
 . ;S DIC=81
"RTN","PXCECPT",62,0)
 . ;S DR="2"
"RTN","PXCECPT",63,0)
 . ;S DA=$P(ENTRY(0),"^",1)
"RTN","PXCECPT",64,0)
 . ;S DIQ="PXCEDIQ1("
"RTN","PXCECPT",65,0)
 . ;S DIQ(0)="E"
"RTN","PXCECPT",66,0)
 . ;D EN^DIQ1
"RTN","PXCECPT",67,0)
 . ;S:PXCEDIQ1(81,DA,2,"E")=PXCEPNAR PXCEPNAR=""
"RTN","PXCECPT",68,0)
 . N CPTSTR
"RTN","PXCECPT",69,0)
 . S CPTSTR=$$CPT^ICPTCOD($P(ENTRY(0),U),$P(^AUPNVSIT(PXCEVIEN,0),U))
"RTN","PXCECPT",70,0)
 . S:$P(CPTSTR,U,3)=PXCEPNAR PXCEPNAR=""
"RTN","PXCECPT",71,0)
 Q PXCEPNAR
"RTN","PXCECPT",72,0)
 ;+
"RTN","PXCECPT",73,0)
 ;+********************************
"RTN","PXCECPT",74,0)
 ;+Special cases for edit.
"RTN","PXCECPT",75,0)
 ;+
"RTN","PXCECPT",76,0)
ECPTCODE ;+Code to edit CPT Code in V CPT file.
"RTN","PXCECPT",77,0)
 K DIRUT
"RTN","PXCECPT",78,0)
 N DIC,DA,PXCPTDT,PXDFLT
"RTN","PXCECPT",79,0)
 S PXCPTDT=+^TMP("PXK",$J,"VST",1,0,"AFTER")
"RTN","PXCECPT",80,0)
 S (X,PXDFLT)=""
"RTN","PXCECPT",81,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCECPT",82,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCECPT",83,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCECPT",84,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCECPT",85,0)
 . S PXDFLT=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCECPT",86,0)
 S Y=$$GETCODE^PXCPTAPI(PXDFLT,PXCPTDT)
"RTN","PXCECPT",87,0)
 I Y="@" S X="@" Q
"RTN","PXCECPT",88,0)
 I Y<0 S DIRUT=1 Q
"RTN","PXCECPT",89,0)
 S PXCEMOD=$P(Y,"-",2)
"RTN","PXCECPT",90,0)
 S Y=$P(Y,"-"),X=+Y
"RTN","PXCECPT",91,0)
 I PXCEDIRB="" Q
"RTN","PXCECPT",92,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=X Q
"RTN","PXCECPT",93,0)
 Q:$$CHGCPT()
"RTN","PXCECPT",94,0)
 G ECPTCODE
"RTN","PXCECPT",95,0)
 ;
"RTN","PXCECPT",96,0)
ECPTMOD ;+Prompt for CPT Modifier in V CPT file.
"RTN","PXCECPT",97,0)
 ;
"RTN","PXCECPT",98,0)
 ;--If there are no modifiers for CPT code do not prompt
"RTN","PXCECPT",99,0)
 Q:PXMDCNT'>0
"RTN","PXCECPT",100,0)
 N DTOUT,DUOUT,DIROUT,DIR,PXSUB,PXSEQ,PXSTR,PXARR
"RTN","PXCECPT",101,0)
 N DA,DIC,PXLINE,SUBIEN,PXFILE,PXMOD,PXI
"RTN","PXCECPT",102,0)
 S PXSUB=1,PXSTR=""
"RTN","PXCECPT",103,0)
 S DA=^TMP("PXK",$J,PXCECATS,1,"IEN")
"RTN","PXCECPT",104,0)
 S DR=1
"RTN","PXCECPT",105,0)
 S DIE="^AUPNVCPT("
"RTN","PXCECPT",106,0)
 S DIC(0)="AELMQ"
"RTN","PXCECPT",107,0)
 L +@(DIE_"DA)"):10
"RTN","PXCECPT",108,0)
 I $G(PXCEMOD)]"" D
"RTN","PXCECPT",109,0)
 . I $L(PXCEMOD,",")=1 S DR="1//"_PXCEMOD Q
"RTN","PXCECPT",110,0)
 . S PXMOD=""
"RTN","PXCECPT",111,0)
 . F PXI=1:1 S PXMOD=$P(PXCEMOD,",",PXI) Q:PXMOD=""  D
"RTN","PXCECPT",112,0)
 .. K PXERR
"RTN","PXCECPT",113,0)
 .. D VAL^DIE(9000010.181,DA,.01,"",PXMOD,.PXERR)
"RTN","PXCECPT",114,0)
 .. Q:PXERR="^"
"RTN","PXCECPT",115,0)
 .. S DR="1///^S X=PXMOD"
"RTN","PXCECPT",116,0)
 .. D ^DIE
"RTN","PXCECPT",117,0)
 . S DR=1
"RTN","PXCECPT",118,0)
 D ^DIE
"RTN","PXCECPT",119,0)
 L -@(DIE_"DA)")
"RTN","PXCECPT",120,0)
 ; SET NEWLY FILED CPT MODIFIERS INTO LOCAL ARRAY
"RTN","PXCECPT",121,0)
 K PXCEAFTR(1)
"RTN","PXCECPT",122,0)
 D GETS^DIQ(9000010.18,^TMP("PXK",$J,PXCECATS,1,"IEN"),"1*","I","PXARR")
"RTN","PXCECPT",123,0)
 S PXFILE=9000010.181
"RTN","PXCECPT",124,0)
 S PXSUB=""
"RTN","PXCECPT",125,0)
 F  S PXSUB=$O(PXARR(PXFILE,PXSUB)) Q:PXSUB=""  D
"RTN","PXCECPT",126,0)
 . S PXCEAFTR(1,$P(PXSUB,","))=PXARR(PXFILE,PXSUB,.01,"I")
"RTN","PXCECPT",127,0)
 I $D(DTOUT)!$D(Y) S (PXCEEND,PXCEQUIT)=1 Q
"RTN","PXCECPT",128,0)
 Q
"RTN","PXCECPT",129,0)
 ;
"RTN","PXCECPT",130,0)
EQUAN ;+Code to edit Quantity in V CPT file.
"RTN","PXCECPT",131,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCECPT",132,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCECPT",133,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCECPT",134,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCECPT",135,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCECPT",136,0)
 E  S DIR("B")=1
"RTN","PXCECPT",137,0)
 S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCECPT",138,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCECPT",139,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCECPT",140,0)
 D ^DIR
"RTN","PXCECPT",141,0)
 K DIR,DA
"RTN","PXCECPT",142,0)
 I $D(DTOUT)!$D(DUOUT) S (PXCEEND,PXCEQUIT)=1 Q
"RTN","PXCECPT",143,0)
 I +Y<1 W !,$C(7),"Quanitity is required.",! G EQUAN
"RTN","PXCECPT",144,0)
 N PXTMPCPT S PXTMPCPT=$P(PXCEAFTR($P(PXCETEXT,"~")),"^")
"RTN","PXCECPT",145,0)
 I +Y>1,$$GET1^DIQ(357.69,$G(PXCEIN01),.01)>0,$$GET1^DIQ(357.69,$G(PXCEIN01),.06,"I")'="Y" D
"RTN","PXCECPT",146,0)
 .W !,"E&M code, quantity changed to 1."
"RTN","PXCECPT",147,0)
 .S $P(Y,"^")=1
"RTN","PXCECPT",148,0)
 S:$P(Y,"^")="" Y=1
"RTN","PXCECPT",149,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCECPT",150,0)
 Q
"RTN","PXCECPT",151,0)
EPOV ;Edit the Associated DX
"RTN","PXCECPT",152,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCECPT",153,0)
 .N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCECPT",154,0)
 .S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCECPT",155,0)
 .S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCECPT",156,0)
 .S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCECPT",157,0)
 S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCECPT",158,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCECPT",159,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCECPT",160,0)
 D ^DIR
"RTN","PXCECPT",161,0)
 K DIR,DA
"RTN","PXCECPT",162,0)
 I X="@" S Y="@" S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^") Q
"RTN","PXCECPT",163,0)
 I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCECPT",164,0)
 I '+Y S PXCEEND=1 Q  ;S:$P(PXCETEXT,"~",3)=".05" PXCEQUIT=1 Q
"RTN","PXCECPT",165,0)
 ;See if this diagnosis is in the PXCEAFTR(0)
"RTN","PXCECPT",166,0)
 I $P(PXCETEXT,"~",2)'=5,(+Y=$P($G(PXCEAFTR(0)),"^",5)) S PXCEEND=1
"RTN","PXCECPT",167,0)
 I $P(PXCETEXT,"~",2)'=9,(+Y=$P($G(PXCEAFTR(0)),"^",9)) S PXCEEND=1
"RTN","PXCECPT",168,0)
 I $P(PXCETEXT,"~",2)'=10,(+Y=$P($G(PXCEAFTR(0)),"^",10)) S PXCEEND=1
"RTN","PXCECPT",169,0)
 I $P(PXCETEXT,"~",2)'=11,(+Y=$P($G(PXCEAFTR(0)),"^",11)) S PXCEEND=1
"RTN","PXCECPT",170,0)
 I $P(PXCETEXT,"~",2)'=12,(+Y=$P($G(PXCEAFTR(0)),"^",12)) S PXCEEND=1
"RTN","PXCECPT",171,0)
 I $P(PXCETEXT,"~",2)'=13,(+Y=$P($G(PXCEAFTR(0)),"^",13)) S PXCEEND=1
"RTN","PXCECPT",172,0)
 I $P(PXCETEXT,"~",2)'=14,(+Y=$P($G(PXCEAFTR(0)),"^",14)) S PXCEEND=1
"RTN","PXCECPT",173,0)
 I $P(PXCETEXT,"~",2)'=15,(+Y=$P($G(PXCEAFTR(0)),"^",15)) S PXCEEND=1
"RTN","PXCECPT",174,0)
 I PXCEEND=1 W !,$C(7),"Duplicate Diagnosis on this CPT code is not allowed." D WAIT^PXCEHELP Q
"RTN","PXCECPT",175,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCECPT",176,0)
 D:+Y>0 DIAGNOS^PXCEVFI4(+Y)
"RTN","PXCECPT",177,0)
 Q
"RTN","PXCECPT",178,0)
 ;+
"RTN","PXCECPT",179,0)
 ;+********************************
"RTN","PXCECPT",180,0)
 ;+Special Reusable Functionality
"RTN","PXCECPT",181,0)
DISPLY01(PXCECPT) ;
"RTN","PXCECPT",182,0)
 ;Display text for the .01 field which is a pointer to ^ICPT.
"RTN","PXCECPT",183,0)
 ;Also called with the Evaluation and Management Code from the visit
"RTN","PXCECPT",184,0)
 ;  in the parameter.
"RTN","PXCECPT",185,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCECPT",186,0)
 ;N DIC,DR,DA,DIQ,PXCEFNUM,PXCEDIQ1
"RTN","PXCECPT",187,0)
 ;S (DIC,PXCEFNUM)=81
"RTN","PXCECPT",188,0)
 ;S DR=".01;2"
"RTN","PXCECPT",189,0)
 ;S DA=+$P(PXCECPT,"^",1)
"RTN","PXCECPT",190,0)
 ;S DIQ="PXCEDIQ1("
"RTN","PXCECPT",191,0)
 ;S DIQ(0)="E"
"RTN","PXCECPT",192,0)
 ;D EN^DIQ1
"RTN","PXCECPT",193,0)
 ;Q PXCEDIQ1(PXCEFNUM,DA,.01,"E")_"     "_PXCEDIQ1(PXCEFNUM,DA,2,"E")
"RTN","PXCECPT",194,0)
 N CPTSTR
"RTN","PXCECPT",195,0)
 S CPTSTR=$$CPT^ICPTCOD($P(PXCECPT,U),$P(^AUPNVSIT(PXCEVIEN,0),U))
"RTN","PXCECPT",196,0)
 Q $P(CPTSTR,U,2)_"     "_$P(CPTSTR,U,3)
"RTN","PXCECPT",197,0)
EDMOD(MODS,CPT) ;+Edit the Modifiers for a CPT code entry.
"RTN","PXCECPT",198,0)
 N MNUM S MNUM=0 ; Modifier number.
"RTN","PXCECPT",199,0)
 N MIEN,MTEXT
"RTN","PXCECPT",200,0)
 Q
"RTN","PXCECPT",201,0)
MODNAME(MODIEN) ;+Return #.02 NAME for this CPT MODIFIER (#81.3)
"RTN","PXCECPT",202,0)
 Q
"RTN","PXCECPT",203,0)
MODTEXT(MODIEN) ;+Return string of text describing modifier.
"RTN","PXCECPT",204,0)
 ;+MODIEN = IEN in CPT MODIFIER file (#81.3).
"RTN","PXCECPT",205,0)
 ;+Returns:  MODIFIER (#.01) followed by NAME(#.02).
"RTN","PXCECPT",206,0)
 N MOD,DESC,TEXT,RVAL
"RTN","PXCECPT",207,0)
 S RVAL=$$MOD^ICPTMOD(MODIEN,"I",$P(^AUPNVSIT(PXCEVIEN,0),U))
"RTN","PXCECPT",208,0)
 S MOD=$P(RVAL,"^",2)
"RTN","PXCECPT",209,0)
 S DESC=$P(RVAL,"^",3)
"RTN","PXCECPT",210,0)
 S TEXT=MOD_"  "_DESC
"RTN","PXCECPT",211,0)
 Q TEXT
"RTN","PXCECPT",212,0)
CHGCPT() ;Verify CPT code should be modified
"RTN","PXCECPT",213,0)
 ;If response is yes remove modifiers on file for CPT code
"RTN","PXCECPT",214,0)
 N DIR,DA,X,Y,PXIEN
"RTN","PXCECPT",215,0)
 W !!,$C(7),"WARNING!  THIS WILL ALSO DELETE ANY MODIFIERS ASSOCIATED WITH CPT CODE "_PXCEDIRB
"RTN","PXCECPT",216,0)
 S DIR(0)="Y"
"RTN","PXCECPT",217,0)
 S DIR("A")="SURE YOU WANT TO CHANGE THE CPT CODE?"
"RTN","PXCECPT",218,0)
 S DIR("B")="YES"
"RTN","PXCECPT",219,0)
 D ^DIR
"RTN","PXCECPT",220,0)
 ;Delete CPT Modifiers from V CPT file for current IEN
"RTN","PXCECPT",221,0)
 I 'Y Q +Y
"RTN","PXCECPT",222,0)
 S DA(1)=PXCEFIEN
"RTN","PXCECPT",223,0)
 S DIK="^AUPNVCPT("_DA(1)_","_1_","
"RTN","PXCECPT",224,0)
 S PXIEN=""
"RTN","PXCECPT",225,0)
 F  S PXIEN=$O(PXCEAFTR(1,PXIEN)) Q:PXIEN=""  D
"RTN","PXCECPT",226,0)
 . S DA=PXIEN
"RTN","PXCECPT",227,0)
 . D ^DIK
"RTN","PXCECPT",228,0)
 Q 1
"RTN","PXCECPT",229,0)
 ;
"RTN","PXCECPT",230,0)
NEWCODE ;
"RTN","PXCECPT",231,0)
 K DD,DO
"RTN","PXCECPT",232,0)
 N DIC,X,Y
"RTN","PXCECPT",233,0)
 S DIC="^AUPNVCPT("
"RTN","PXCECPT",234,0)
 S DIC(0)=""
"RTN","PXCECPT",235,0)
 S DIC("DR")=".02////^S X=$P(PXCEAFTR(0),""^"",2);"
"RTN","PXCECPT",236,0)
 S DIC("DR")=DIC("DR")_".03////^S X=$P(PXCEAFTR(0),""^"",3);"
"RTN","PXCECPT",237,0)
 S X=PXCEIN01
"RTN","PXCECPT",238,0)
 D FILE^DICN
"RTN","PXCECPT",239,0)
 S PXCEFIEN=+Y
"RTN","PXCECPT",240,0)
 Q
"RTN","PXCECPT",241,0)
 ;
"RTN","PXCECPT",242,0)
SKIP ;
"RTN","PXCECPT",243,0)
 Q
"RTN","PXCED800")
0^20^B2395486
"RTN","PXCED800",1,0)
PXCED800 ;WASH/BDB - Used in editing the 800 node, Service Connected conditions ;1/18/05 3:33pm
"RTN","PXCED800",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Aug 12, 1996
"RTN","PXCED800",3,0)
 ;; ;
"RTN","PXCED800",4,0)
 Q
"RTN","PXCED800",5,0)
 ;
"RTN","PXCED800",6,0)
 ;            Classification type 1 - Agent Orange
"RTN","PXCED800",7,0)
 ;                                2 - Ionizing Radiation
"RTN","PXCED800",8,0)
 ;                                3 - Service Connected
"RTN","PXCED800",9,0)
 ;                                4 - Environmental Contaminants
"RTN","PXCED800",10,0)
 ;                                5 - Military Sexual Trauma
"RTN","PXCED800",11,0)
 ;                                6 - Cancer of the Head and/or Neck
"RTN","PXCED800",12,0)
 ;                                7 - Combat Veteran
"RTN","PXCED800",13,0)
GET800 ;Used by the Service Connected Conditions
"RTN","PXCED800",14,0)
 N PXCEINDX,PXOUT
"RTN","PXCED800",15,0)
 N PXBDATA,PXLOC,PXAPTDT,PXDFN
"RTN","PXCED800",16,0)
 S PXCEDXSC=""
"RTN","PXCED800",17,0)
 I $O(^SCE("AVSIT",PXCEVIEN,0)) D CLASS^PXBAPI21("","","","",PXCEVIEN)
"RTN","PXCED800",18,0)
 I '$O(^SCE("AVSIT",PXCEVIEN,0)) D
"RTN","PXCED800",19,0)
 . S PXAPTDT=+^AUPNVSIT(PXCEVIEN,0)
"RTN","PXCED800",20,0)
 . S PXDFN=$P(^AUPNVSIT(PXCEVIEN,0),"^",5)
"RTN","PXCED800",21,0)
 . S PXLOC=$P(^AUPNVSIT(PXCEVIEN,0),"^",22)
"RTN","PXCED800",22,0)
 . D CLASS^PXBAPI21("",PXDFN,PXAPTDT,PXLOC,"")
"RTN","PXCED800",23,0)
 F PXCEINDX=1:1:7 I $G(PXBDATA("ERR",PXCEINDX))=4 S PXOUT=PXBDATA("ERR",PXCEINDX)
"RTN","PXCED800",24,0)
 I $D(PXOUT) S PXCEEND=1 Q
"RTN","PXCED800",25,0)
 S $P(PXCEDXSC,"^",1)=$P($G(PXBDATA(3)),"^",2)
"RTN","PXCED800",26,0)
 I +PXCEDXSC S (PXDATA(1),PXDATA(2),PXDATA(4))="^^"
"RTN","PXCED800",27,0)
 S $P(PXCEDXSC,"^",2)=$P($G(PXBDATA(1)),"^",2)
"RTN","PXCED800",28,0)
 S $P(PXCEDXSC,"^",3)=$P($G(PXBDATA(2)),"^",2)
"RTN","PXCED800",29,0)
 S $P(PXCEDXSC,"^",4)=$P($G(PXBDATA(4)),"^",2)
"RTN","PXCED800",30,0)
 S $P(PXCEDXSC,"^",5)=$P($G(PXBDATA(5)),"^",2)
"RTN","PXCED800",31,0)
 S $P(PXCEDXSC,"^",6)=$P($G(PXBDATA(6)),"^",2)
"RTN","PXCED800",32,0)
 S $P(PXCEDXSC,"^",7)=$P($G(PXBDATA(7)),"^",2)
"RTN","PXCED800",33,0)
 Q
"RTN","PXCED800",34,0)
 ;
"RTN","PXCEPOV")
0^21^B16838649
"RTN","PXCEPOV",1,0)
PXCEPOV ;ISL/dee - Used to edit and display V POV ;3/15/04 2:23pm
"RTN","PXCEPOV",2,0)
        ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,121,124**;Aug 12, 1996
"RTN","PXCEPOV",3,0)
        ;; ;
"RTN","PXCEPOV",4,0)
        Q
"RTN","PXCEPOV",5,0)
        ;
"RTN","PXCEPOV",6,0)
        ;Line with the line label "FORMAT"
"RTN","PXCEPOV",7,0)
        ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (1=yes, 0=no)~File global name
"RTN","PXCEPOV",8,0)
        ;     1         2             3                   4                                   5
"RTN","PXCEPOV",9,0)
        ;
"RTN","PXCEPOV",10,0)
        ;Followning lines:
"RTN","PXCEPOV",11,0)
        ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR(?)~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCEPOV",12,0)
        ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8            ~          9                  ~       10
"RTN","PXCEPOV",13,0)
        ;The Display & Edit routines are for special caces.
"RTN","PXCEPOV",14,0)
        ;  (The .01 field cannot have a special edit.)
"RTN","PXCEPOV",15,0)
        ;
"RTN","PXCEPOV",16,0)
FORMAT  ;;Diagnosis~9000010.07~0,12,800,802,811,812~1~^AUPNVPOV
"RTN","PXCEPOV",17,0)
        ;;0~1~.01~ICD9 Code or Diagnosis:  ~ICD9 Code or Diagnosis:  ~$$DISPLY01^PXCEPOV~~^D HELP^PXCEHELP~~B
"RTN","PXCEPOV",18,0)
        ;;0~4~.04~Provider Narrative:  ~Provider Narrative:  ~$$DNARRAT^PXCEPOV1~ENARRAT^PXCEPOV1(1,1,1,80,10,3)~~~B
"RTN","PXCEPOV",19,0)
        ;;0~12~.12~Is this Diagnosis Primary for the Encounter:  ~Primary/Secondary Diagnosis for the Encounter:  ~$$DPRIMSEC^PXCEPOV1~EPRIMSEC^PXCEPRV~~~B
"RTN","PXCEPOV",20,0)
        ;;0~17~.17~Is this Diagnosis Ordering, Resulting, or Both:  ~Ordering/Resulting Diagnosis:  ~~~~~B
"RTN","PXCEPOV",21,0)
        ;;0~6~.06~Modifier:  ~Modifier:  ~~~~~D
"RTN","PXCEPOV",22,0)
        ;;0~13~.13~Injury Date and (optional) Time~Date of Injury:  ~~EINJURY^PXCEPOV1~~~D
"RTN","PXCEPOV",23,0)
        ;;12~4~1204~Encounter Provider:  ~Encounter Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCEPOV",24,0)
        ;;802~1~80201~Provider Narrative Category:  ~Provider Narrative Category:  ~$$DNARRAT^PXCEPOV1~ENARRAT^PXCEPOV1(0,2,0,80,5)~~C~D
"RTN","PXCEPOV",25,0)
        ;;811~1~81101~Comments:  ~Comments:  ~~~~~D
"RTN","PXCEPOV",26,0)
        ;;800~1~80001~Service Connected:  ~Service Connected:  ~~GET800^PXCEC800~~~D
"RTN","PXCEPOV",27,0)
        ;;800~7~80007~Combat Veteran:  ~Combat Veteran:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",28,0)
        ;;800~2~80002~Agent Orange Exposure:  ~Agent Orange Exposure:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",29,0)
        ;;800~3~80003~Ionizing Radiation Exposure:  ~Ionizing Radiation Exposure:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",30,0)
        ;;800~4~80004~Environmental Contaminants:  ~Environmental Contaminants:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",31,0)
        ;;800~5~80005~Military Sexual Trauma:  ~Military Sexual Trauma:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",32,0)
        ;;800~6~80006~Head and/or Neck Cancer:  ~Head and/or Neck Cancer:  ~~SKIP^PXCEPOV~~~D
"RTN","PXCEPOV",33,0)
        ;
"RTN","PXCEPOV",34,0)
        ;
"RTN","PXCEPOV",35,0)
        ;
"RTN","PXCEPOV",36,0)
        ;The interface for AICS to get list on form for help.
"RTN","PXCEPOV",37,0)
INTRFACE        ;;DG SELECT ICD-9 DIAGNOSIS CODES
"RTN","PXCEPOV",38,0)
        ;
"RTN","PXCEPOV",39,0)
        ;********************************
"RTN","PXCEPOV",40,0)
        ;Special cases for display.
"RTN","PXCEPOV",41,0)
        ;
"RTN","PXCEPOV",42,0)
        ;********************************
"RTN","PXCEPOV",43,0)
        ;Display text for the .01 field which is a pointer to ^ICD9.
"RTN","PXCEPOV",44,0)
        ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCEPOV",45,0)
DISPLY01(PXCEPOV)       ;
"RTN","PXCEPOV",46,0)
        ;N DIC,DR,DA,DIQ,PXCEDIQ1
"RTN","PXCEPOV",47,0)
        ;S DIC=80
"RTN","PXCEPOV",48,0)
        ;S DR=".01;3"
"RTN","PXCEPOV",49,0)
        ;S DA=$P(PXCEPOV,"^",1)
"RTN","PXCEPOV",50,0)
        ;S DIQ="PXCEDIQ1("
"RTN","PXCEPOV",51,0)
        ;S DIQ(0)="E"
"RTN","PXCEPOV",52,0)
        ;D EN^DIQ1
"RTN","PXCEPOV",53,0)
        ;Q PXCEDIQ1(80,DA,.01,"E")_"     "_PXCEDIQ1(80,DA,3,"E")
"RTN","PXCEPOV",54,0)
        ;
"RTN","PXCEPOV",55,0)
        N ICDSTR
"RTN","PXCEPOV",56,0)
        S ICDSTR=$$ICDDX^ICDCODE($P(PXCEPOV,"^"),$P(^AUPNVSIT(PXCEVIEN,0),"^"))
"RTN","PXCEPOV",57,0)
        Q $P(ICDSTR,"^",2)_"     "_$P(ICDSTR,"^",4) ;code and desc
"RTN","PXCEPOV",58,0)
        ;
"RTN","PXCEPOV",59,0)
SKIP    ;
"RTN","PXCEPOV",60,0)
        Q
"RTN","PXCEPOV1")
0^34^B23888557
"RTN","PXCEPOV1",1,0)
PXCEPOV1 ;ISL/dee - Used to edit and display V POV ;8/10/04 4:42pm
"RTN","PXCEPOV1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**134,149,124**;Aug 12, 1996
"RTN","PXCEPOV1",3,0)
 ;; ;
"RTN","PXCEPOV1",4,0)
 Q
"RTN","PXCEPOV1",5,0)
 ;
"RTN","PXCEPOV1",6,0)
 ;********************************
"RTN","PXCEPOV1",7,0)
 ;Special cases for display.
"RTN","PXCEPOV1",8,0)
 ;
"RTN","PXCEPOV1",9,0)
DNARRAT(PNAR) ;Provider Narrative for ICD-9
"RTN","PXCEPOV1",10,0)
 N PXCEPNAR,SNARR
"RTN","PXCEPOV1",11,0)
 I PNAR<0 Q ""
"RTN","PXCEPOV1",12,0)
 S PXCEPNAR=$P(^AUTNPOV(PNAR,0),"^")
"RTN","PXCEPOV1",13,0)
 I $G(VIEW)="B",$D(ENTRY)>0 D
"RTN","PXCEPOV1",14,0)
 . N DIC,DR,DA,DIQ,PXCEDIQ1
"RTN","PXCEPOV1",15,0)
 . ;S DIC=80
"RTN","PXCEPOV1",16,0)
 . ;S DR="3"
"RTN","PXCEPOV1",17,0)
 . S DA=$P(ENTRY(0),"^",1)
"RTN","PXCEPOV1",18,0)
 . ;S DIQ="PXCEDIQ1("
"RTN","PXCEPOV1",19,0)
 . ;S DIQ(0)="E"
"RTN","PXCEPOV1",20,0)
 . ;D EN^DIQ1
"RTN","PXCEPOV1",21,0)
 . S SNARR=$P($$ICDDX^ICDCODE(DA,$G(IDATE)),"^",4)
"RTN","PXCEPOV1",22,0)
 . ;S:$G(PXCEDIQ1(80,DA,3,"E"))=PXCEPNAR PXCEPNAR=""
"RTN","PXCEPOV1",23,0)
 . S:SNARR=PXCEPNAR PXCEPNAR=""
"RTN","PXCEPOV1",24,0)
 Q PXCEPNAR
"RTN","PXCEPOV1",25,0)
 ;
"RTN","PXCEPOV1",26,0)
DPRIMSEC(PRIMSEC) ;
"RTN","PXCEPOV1",27,0)
 I $G(VIEW)="B" Q $S(PRIMSEC="P":"PRIMARY",1:"")
"RTN","PXCEPOV1",28,0)
 Q $S(PRIMSEC="P":"PRIMARY",PRIMSEC="S":"SECONDARY",1:"")
"RTN","PXCEPOV1",29,0)
 ;
"RTN","PXCEPOV1",30,0)
 ;********************************
"RTN","PXCEPOV1",31,0)
 ;Special cases for edit.
"RTN","PXCEPOV1",32,0)
 ;
"RTN","PXCEPOV1",33,0)
ENARRAT(REQUIRED,ASK,DEFAULT,FILE,FIELD1,FIELD2) ;Provider Narrative  --  Used by ALL V-Files with Prov. Nar.
"RTN","PXCEPOV1",34,0)
 ; REQUIRED  0 for not required
"RTN","PXCEPOV1",35,0)
 ;           1 for required
"RTN","PXCEPOV1",36,0)
 ; ASK       0 for do not ask
"RTN","PXCEPOV1",37,0)
 ;           1 for ask
"RTN","PXCEPOV1",38,0)
 ;           2 for ask only if there is already a value
"RTN","PXCEPOV1",39,0)
 ; DEFAULT   0 for do not default
"RTN","PXCEPOV1",40,0)
 ;           1 for do default
"RTN","PXCEPOV1",41,0)
 ;           changed to 1 if REQUIRED is 1
"RTN","PXCEPOV1",42,0)
 ;
"RTN","PXCEPOV1",43,0)
 N PXKLAYGO,ASKING
"RTN","PXCEPOV1",44,0)
 S PXKLAYGO=""
"RTN","PXCEPOV1",45,0)
 S ASKING=ASK#2
"RTN","PXCEPOV1",46,0)
 S:REQUIRED DEFAULT=1
"RTN","PXCEPOV1",47,0)
 I PXCEKEYS["C" S ASKING=1
"RTN","PXCEPOV1",48,0)
ENARRAT1 ;
"RTN","PXCEPOV1",49,0)
 K DIR,DA,X,Y,C
"RTN","PXCEPOV1",50,0)
 S (X,Y)=""
"RTN","PXCEPOV1",51,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEPOV1",52,0)
 . N DIERR,PXCEDILF,PXCEEXT,PXCEINT
"RTN","PXCEPOV1",53,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEPOV1",54,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEPOV1",55,0)
 . S (DIR("B"),X,Y)=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEPOV1",56,0)
 S DIR(0)="FAO^1:245"
"RTN","PXCEPOV1",57,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEPOV1",58,0)
 I $P(PXCETEXT,"~",8)]"" S DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEPOV1",59,0)
 E  D
"RTN","PXCEPOV1",60,0)
 . S DIR("?",1)="This response must have at least 2 characters and no more than 245"
"RTN","PXCEPOV1",61,0)
 . S DIR("?",2)="characters and must not contain embedded uparrow."
"RTN","PXCEPOV1",62,0)
 . I REQUIRED S DIR("?")="This field is required."
"RTN","PXCEPOV1",63,0)
 . E  S DIR("?")="This field is optional."
"RTN","PXCEPOV1",64,0)
 I ASK=2,(Y]"") S ASKING=1
"RTN","PXCEPOV1",65,0)
 I ASKING D ^DIR
"RTN","PXCEPOV1",66,0)
 K DIR,DA
"RTN","PXCEPOV1",67,0)
 I X="@" S Y="@"
"RTN","PXCEPOV1",68,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 S:REQUIRED PXCEQUIT=1 Q
"RTN","PXCEPOV1",69,0)
 N PXCEX,PXCEY
"RTN","PXCEPOV1",70,0)
 I $E(Y,1)="=" S PXCEX=$E(PXCEIN01_" "_$E($P(Y,"^"),2,245),1,245)
"RTN","PXCEPOV1",71,0)
 E  S PXCEX=Y
"RTN","PXCEPOV1",72,0)
 I DEFAULT,PXCEX="" S PXCEX=$$EXTTEXT^PXUTL1($P(PXCEAFTR(0),"^",1),REQUIRED,$G(FILE),$G(FIELD1),$G(FIELD2))
"RTN","PXCEPOV1",73,0)
 I ASKING D
"RTN","PXCEPOV1",74,0)
 . W !,PXCEX
"RTN","PXCEPOV1",75,0)
 I $L(PXCEX)=1,PXCEX'="@" W !,"Must be 2 to 245 characters." G ENARRAT1
"RTN","PXCEPOV1",76,0)
 I PXCEX="@"!(PXCEX=""),REQUIRED W !,"This field is required.",$C(7) G ENARRAT1
"RTN","PXCEPOV1",77,0)
 ;
"RTN","PXCEPOV1",78,0)
 I PXCEX="@"!(PXCEX="") S PXCEY=PXCEX
"RTN","PXCEPOV1",79,0)
 E  S PXCEY=$$PROVNARR^PXAPI(PXCEX,PXCEFILE) I ASKING,+PXCEY'>0 W "??",$C(7) G ENARRAT1
"RTN","PXCEPOV1",80,0)
 E  I +PXCEY'>0 S PXCEY=""
"RTN","PXCEPOV1",81,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(PXCEY,"^")
"RTN","PXCEPOV1",82,0)
 Q
"RTN","PXCEPOV1",83,0)
 ;
"RTN","PXCEPOV1",84,0)
EINJURY ;Date/Time of Injury
"RTN","PXCEPOV1",85,0)
 ;I not an injury code Q
"RTN","PXCEPOV1",86,0)
 N DIC,DR,DA,DIQ,PXCEDIQ1
"RTN","PXCEPOV1",87,0)
 S DIC=80
"RTN","PXCEPOV1",88,0)
 S DR=".01"
"RTN","PXCEPOV1",89,0)
 S DA=$P(PXCEAFTR(0),"^",1)
"RTN","PXCEPOV1",90,0)
 S DIQ="PXCEDIQ1("
"RTN","PXCEPOV1",91,0)
 S DIQ(0)="E"
"RTN","PXCEPOV1",92,0)
 D EN^DIQ1
"RTN","PXCEPOV1",93,0)
 I PXCEDIQ1(80,DA,.01,"E")'<800,PXCEDIQ1(80,DA,.01,"E")'>999.999 D E1201^PXCEPOV1(-1,-1,0)
"RTN","PXCEPOV1",94,0)
 Q
"RTN","PXCEPOV1",95,0)
 ;
"RTN","PXCEPOV1",96,0)
 ;********************************
"RTN","PXCEPOV1",97,0)
 ;Special cases for edit for Event Date and Time field number 1201
"RTN","PXCEPOV1",98,0)
 ; and other date and times.
"RTN","PXCEPOV1",99,0)
 ;
"RTN","PXCEPOV1",100,0)
E1201(REQTIME,BEFORE,AFTER,DEFAULT) ;
"RTN","PXCEPOV1",101,0)
 ;REQTIME is 1 if time is required,
"RTN","PXCEPOV1",102,0)
 ;           0 if time is optional
"RTN","PXCEPOV1",103,0)
 ;          -1 if the date can be imprecise
"RTN","PXCEPOV1",104,0)
 ;BEFORE  is the number of days before the visit that the date can
"RTN","PXCEPOV1",105,0)
 ;        not be before or -1 for any amount before.
"RTN","PXCEPOV1",106,0)
 ;AFTER   is the number of days after the visit that the date can
"RTN","PXCEPOV1",107,0)
 ;        not be after or -1 for any amount.  In any case the date
"RTN","PXCEPOV1",108,0)
 ;        can not be later than today.
"RTN","PXCEPOV1",109,0)
 ;DEFAULT is the default date/time is there is not one in the file.
"RTN","PXCEPOV1",110,0)
 ;        If it is -1 then NOW will be used as the default.
"RTN","PXCEPOV1",111,0)
 ;        If it is 0 then TODAY will be used as the default.
"RTN","PXCEPOV1",112,0)
 N X1,X2,X,%Y,%H,%I,%
"RTN","PXCEPOV1",113,0)
 N PXCEVST S PXCEVST=$P(+^TMP("PXK",$J,"VST",1,0,"BEFORE"),".")
"RTN","PXCEPOV1",114,0)
 N PXCEBEF,PXCEAFT S (PXCEBEF,PXCEAFT)=""
"RTN","PXCEPOV1",115,0)
 I $D(AFTER)#2,AFTER'<0 D
"RTN","PXCEPOV1",116,0)
 . I AFTER=0 S PXCEAFT=PXCEVST+.9
"RTN","PXCEPOV1",117,0)
 . E  D
"RTN","PXCEPOV1",118,0)
 .. S X1=DT
"RTN","PXCEPOV1",119,0)
 .. S X2=$P(+^TMP("PXK",$J,"VST",1,0,"BEFORE"),".")
"RTN","PXCEPOV1",120,0)
 .. D ^%DTC
"RTN","PXCEPOV1",121,0)
 .. I X'>AFTER S PXCEAFT=DT+.9
"RTN","PXCEPOV1",122,0)
 .. E  D
"RTN","PXCEPOV1",123,0)
 ... S X1=$P(+^TMP("PXK",$J,"VST",1,0,"BEFORE"),".")
"RTN","PXCEPOV1",124,0)
 ... S X2=AFTER
"RTN","PXCEPOV1",125,0)
 ... D C^%DTC
"RTN","PXCEPOV1",126,0)
 ... S PXCEAFT=X+.9
"RTN","PXCEPOV1",127,0)
 I $D(BEFORE)#2,BEFORE'<0 D
"RTN","PXCEPOV1",128,0)
 . I BEFORE=0 S PXCEBEF=PXCEVST
"RTN","PXCEPOV1",129,0)
 . E  D
"RTN","PXCEPOV1",130,0)
 .. S X1=$P(+^TMP("PXK",$J,"VST",1,0,"BEFORE"),".")
"RTN","PXCEPOV1",131,0)
 .. S X2=-BEFORE
"RTN","PXCEPOV1",132,0)
 .. D C^%DTC
"RTN","PXCEPOV1",133,0)
 .. S PXCEBEF=X
"RTN","PXCEPOV1",134,0)
 S DIR(0)="DO^"_PXCEBEF_":"_PXCEAFT_":ESP"
"RTN","PXCEPOV1",135,0)
 I $G(REQTIME)=1 S DIR(0)=DIR(0)_"RX"
"RTN","PXCEPOV1",136,0)
 E  I $G(REQTIME)=-1 S DIR(0)=DIR(0)_"T"
"RTN","PXCEPOV1",137,0)
 E  S DIR(0)=DIR(0)_"TX"
"RTN","PXCEPOV1",138,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" S DIR("B")=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEPOV1",139,0)
 E  I ($D(DEFAULT)#2) D
"RTN","PXCEPOV1",140,0)
 . I DEFAULT>0 S DIR("B")=DEFAULT
"RTN","PXCEPOV1",141,0)
 . E  I DEFAULT=0 S DIR("B")=DT
"RTN","PXCEPOV1",142,0)
 . E  I DEFAULT=-1 D NOW^%DTC S DIR("B")=%
"RTN","PXCEPOV1",143,0)
 I $D(DIR("B"))#2 S Y=DIR("B") D DD^%DT S DIR("B")=Y
"RTN","PXCEPOV1",144,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEPOV1",145,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEPOV1",146,0)
 D ^DIR
"RTN","PXCEPOV1",147,0)
 K DIR,DA
"RTN","PXCEPOV1",148,0)
 I X="@" S Y="@"
"RTN","PXCEPOV1",149,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCEPOV1",150,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEPOV1",151,0)
 Q
"RTN","PXCEPOV1",152,0)
 ;
"RTN","PXCEPRV")
0^52^B27804428
"RTN","PXCEPRV",1,0)
PXCEPRV ;ISL/dee - Used to edit and display V PROVIDER ;5/10/05 6:23pm
"RTN","PXCEPRV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**7,27,124**;Aug 12, 1996
"RTN","PXCEPRV",3,0)
 ;
"RTN","PXCEPRV",4,0)
 Q
"RTN","PXCEPRV",5,0)
 ;
"RTN","PXCEPRV",6,0)
 ;Line with the line label "FORMAT"
"RTN","PXCEPRV",7,0)
 ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (1=yes, 0=no)~File global name
"RTN","PXCEPRV",8,0)
 ;     1         2             3                   4                                   5
"RTN","PXCEPRV",9,0)
 ;
"RTN","PXCEPRV",10,0)
 ;Followning lines:
"RTN","PXCEPRV",11,0)
 ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCEPRV",12,0)
 ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~       10
"RTN","PXCEPRV",13,0)
 ;The Display & Edit routines are for special caces.
"RTN","PXCEPRV",14,0)
 ;  (The .01 field cannot have a special edit.)
"RTN","PXCEPRV",15,0)
 ;
"RTN","PXCEPRV",16,0)
FORMAT ;;Provider~9000010.06~0,12,811,812~0~^AUPNVPRV
"RTN","PXCEPRV",17,0)
 ;;0~1~.01~Provider:  ~Provider:  ~$$DISPLY01^PXCEPRV~EPROV^PXCEPRV~^D HELP^PXCEHELP~~B
"RTN","PXCEPRV",18,0)
 ;;0~4~.04~Is this Provider Primary:  ~Primary:  ~$$DISPPRIM^PXCEPRV~EPRIMSEC^PXCEPRV~~~N
"RTN","PXCEPRV",19,0)
 ;;0~5~.05~Is this Provider Attending:  ~Attending:  ~~EATTEND^PXCEPRV~~~N
"RTN","PXCEPRV",20,0)
 ;;
"RTN","PXCEPRV",21,0)
 ;
"RTN","PXCEPRV",22,0)
 ;The interface for AICS to get list on form for help.
"RTN","PXCEPRV",23,0)
INTRFACE ;;SD SELECT PROVIDER
"RTN","PXCEPRV",24,0)
 ;
"RTN","PXCEPRV",25,0)
 ;********************************
"RTN","PXCEPRV",26,0)
 ;Special cases for display.
"RTN","PXCEPRV",27,0)
 ;
"RTN","PXCEPRV",28,0)
DISPPRIM(PXCEPRIM) ;
"RTN","PXCEPRV",29,0)
 Q $S(PXCEPRIM="P":$$EXTERNAL^DILFD(9000010.06,".04","",PXCEPRIM,"PXCEDILF"),1:"")
"RTN","PXCEPRV",30,0)
 ;
"RTN","PXCEPRV",31,0)
 ;********************************
"RTN","PXCEPRV",32,0)
 ;Special cases for edit.
"RTN","PXCEPRV",33,0)
 ;
"RTN","PXCEPRV",34,0)
EPROV ;
"RTN","PXCEPRV",35,0)
 K DIRUT
"RTN","PXCEPRV",36,0)
 N DIC,DA,PXPRVDT
"RTN","PXCEPRV",37,0)
 S PXPRVDT=+^TMP("PXK",$J,"VST",1,0,"AFTER")
"RTN","PXCEPRV",38,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEPRV",39,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEPRV",40,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEPRV",41,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEPRV",42,0)
 . S DIC("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEPRV",43,0)
 S DIC=200
"RTN","PXCEPRV",44,0)
 S DIC(0)="AEMQ"
"RTN","PXCEPRV",45,0)
 S DIC("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEPRV",46,0)
 S DIC("S")="I $$ACTIVPRV^PXAPI(Y,PXPRVDT)"
"RTN","PXCEPRV",47,0)
 D ^DIC
"RTN","PXCEPRV",48,0)
 K DIR
"RTN","PXCEPRV",49,0)
 I $D(DUOUT)!$D(DTOUT)!(X="") S DIRUT=1 Q
"RTN","PXCEPRV",50,0)
 Q:$D(DIRUT)
"RTN","PXCEPRV",51,0)
 S:'($D(X)#2) X=+Y
"RTN","PXCEPRV",52,0)
 Q
"RTN","PXCEPRV",53,0)
 ;
"RTN","PXCEPRV",54,0)
EPRIMSEC ;For Primary/Secondary field only allows one primary.
"RTN","PXCEPRV",55,0)
 ;  Also used by V-POV
"RTN","PXCEPRV",56,0)
 K Y,DTOUT,DUOUT,PXCEPRIM
"RTN","PXCEPRV",57,0)
 ;See if there is already a primary provider in V Provider for this Visit
"RTN","PXCEPRV",58,0)
 S PXCEPRIM=$$PRIMSEC^PXUTL1(PXCEVIEN,PXCEAUPN,$P(PXCETEXT,"~",1),$P(PXCETEXT,"~",2))
"RTN","PXCEPRV",59,0)
 I 'PXCEPRIM S Y="PRIMARY"
"RTN","PXCEPRV",60,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEPRV",61,0)
 . N DIERR,PXCEDILF,PXCEEXT,PXCEINT
"RTN","PXCEPRV",62,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEPRV",63,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEPRV",64,0)
 . S Y=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEPRV",65,0)
 I $D(Y),'PXCEPRIM!($E(Y)="P") D
"RTN","PXCEPRV",66,0)
 . S DIR("B")=$S($E(Y)="P":"YES",1:"NO")
"RTN","PXCEPRV",67,0)
 . S DIR(0)="YAO"
"RTN","PXCEPRV",68,0)
 . S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEPRV",69,0)
 . S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEPRV",70,0)
 . D ^DIR
"RTN","PXCEPRV",71,0)
 . K DIR,DA
"RTN","PXCEPRV",72,0)
 . S Y=$S(Y:"P",1:"S")
"RTN","PXCEPRV",73,0)
 E  S Y="S"
"RTN","PXCEPRV",74,0)
 I $D(DTOUT)!$D(DUOUT) S (PXCEEND,PXCEQUIT)=1 Q  ;This field is required.
"RTN","PXCEPRV",75,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEPRV",76,0)
 Q
"RTN","PXCEPRV",77,0)
 ;
"RTN","PXCEPRV",78,0)
EATTEND ;Attending/Operating field only ask for Attending
"RTN","PXCEPRV",79,0)
 S DIR("B")=$S($P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))="A":"YES",1:"NO")
"RTN","PXCEPRV",80,0)
 S DIR(0)="YAO"
"RTN","PXCEPRV",81,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEPRV",82,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEPRV",83,0)
 D ^DIR
"RTN","PXCEPRV",84,0)
 K DIR,DA
"RTN","PXCEPRV",85,0)
 I X="@" S Y="@"
"RTN","PXCEPRV",86,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCEPRV",87,0)
 E  I +Y S Y="A"
"RTN","PXCEPRV",88,0)
 E  I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))="A" S Y="@"
"RTN","PXCEPRV",89,0)
 E  S Y=""
"RTN","PXCEPRV",90,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEPRV",91,0)
 Q
"RTN","PXCEPRV",92,0)
 ;
"RTN","PXCEPRV",93,0)
EPROV12 ;
"RTN","PXCEPRV",94,0)
 K DIRUT
"RTN","PXCEPRV",95,0)
 N DIC,DA,PXPRVDT
"RTN","PXCEPRV",96,0)
 S PXPRVDT=+^TMP("PXK",$J,"VST",1,0,"AFTER")
"RTN","PXCEPRV",97,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEPRV",98,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEPRV",99,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEPRV",100,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEPRV",101,0)
 . S DIC("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEPRV",102,0)
 S DIC=200
"RTN","PXCEPRV",103,0)
 S DIC(0)="AEMQ"
"RTN","PXCEPRV",104,0)
 S DIC("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEPRV",105,0)
 S DIC("S")="I $$ACTIVPRV^PXAPI(Y,PXPRVDT)"
"RTN","PXCEPRV",106,0)
 D ^DIC
"RTN","PXCEPRV",107,0)
 K DIR
"RTN","PXCEPRV",108,0)
 I $D(DUOUT)!$D(DTOUT) S PXCEEND=1 Q
"RTN","PXCEPRV",109,0)
 Q:X=""
"RTN","PXCEPRV",110,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEPRV",111,0)
 ;S:'($D(X)#2) X=+Y
"RTN","PXCEPRV",112,0)
 Q
"RTN","PXCEPRV",113,0)
 ;
"RTN","PXCEPRV",114,0)
 ;********************************
"RTN","PXCEPRV",115,0)
PERCLASS(PXCEPRV) ;Returns text for person class
"RTN","PXCEPRV",116,0)
 N PXCEPERC
"RTN","PXCEPRV",117,0)
 S PXCEPERC=$$OCCUP^PXBGPRV(PXCEPRV,+^AUPNVSIT(PXCEVIEN,0),"",2)
"RTN","PXCEPRV",118,0)
 G PRCL
"RTN","PXCEPRV",119,0)
DPERCLAS(PXCECLAS) ;Returns text for person class
"RTN","PXCEPRV",120,0)
 N PXCEPERC
"RTN","PXCEPRV",121,0)
 S PXCEPERC=$S(PXCECLAS>0:$$OCCUP^PXBGPRV("","","",2,PXCECLAS),1:"")
"RTN","PXCEPRV",122,0)
PRCL ;
"RTN","PXCEPRV",123,0)
 I PXCEPERC="" S PXCEPERC="## No Person Class ##"
"RTN","PXCEPRV",124,0)
 E  I PXCEPERC=-1 S PXCEPERC="!! No Person Class Defined !!"
"RTN","PXCEPRV",125,0)
 E  I PXCEPERC=-2 S PXCEPERC="** No Active Person Class **"
"RTN","PXCEPRV",126,0)
 E  I +PXCEPERC<0 S PXCEPERC=""
"RTN","PXCEPRV",127,0)
 Q PXCEPERC
"RTN","PXCEPRV",128,0)
 ;
"RTN","PXCEPRV",129,0)
 ;********************************
"RTN","PXCEPRV",130,0)
 ;Display text for the .01 field which is a pointer to ^ICPT.
"RTN","PXCEPRV",131,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCEPRV",132,0)
DISPLY01(PXCEPRV) ;
"RTN","PXCEPRV",133,0)
 N DIERR,PXCEDILF,PXCEEPRV,PXCEEPS,PXCEEAO,PXCEPERC,PXCERET
"RTN","PXCEPRV",134,0)
 S PXCEEPRV=$$EXTERNAL^DILFD(9000010.06,".01","",$P(PXCEPRV,"^",1),"PXCEDILF")
"RTN","PXCEPRV",135,0)
 S PXCEEPS=$$EXTERNAL^DILFD(9000010.06,".04","",$P(PXCEPRV,"^",4),"PXCEDILF")
"RTN","PXCEPRV",136,0)
 S PXCEEAO=$$EXTERNAL^DILFD(9000010.06,".05","",$P(PXCEPRV,"^",5),"PXCEDILF")
"RTN","PXCEPRV",137,0)
 S PXCEPERC=$$DPERCLAS($P(PXCEPRV,"^",6))
"RTN","PXCEPRV",138,0)
 S PXCERET=PXCEEPRV_"   "_$S($E(PXCEEPS)="P":PXCEEPS_"   ",1:"")_$S(PXCEEAO]"":PXCEEAO_"   ",1:"")
"RTN","PXCEPRV",139,0)
 S PXCERET=PXCERET_$E(PXCEPERC,1,(65-$L(PXCERET)))
"RTN","PXCEPRV",140,0)
 Q PXCERET
"RTN","PXCEPRV",141,0)
 ;
"RTN","PXCESIT")
0^62^B9680186
"RTN","PXCESIT",1,0)
PXCESIT ;ISL/dee,ISA/KWP - Used to edit a new visit and display (use most) a visit ;3/17/04 12:10pm
"RTN","PXCESIT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,74,111,130,124**;Aug 12, 1996
"RTN","PXCESIT",3,0)
 ;+ The classifications show in the Display Detail Protocol
"RTN","PXCESIT",4,0)
 Q
"RTN","PXCESIT",5,0)
 ;
"RTN","PXCESIT",6,0)
 ;Line with the line label "FORMAT"
"RTN","PXCESIT",7,0)
 ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (not used on visit)~File global name
"RTN","PXCESIT",8,0)
 ;     1         2             3                   4                                        5
"RTN","PXCESIT",9,0)
 ;
"RTN","PXCESIT",10,0)
 ;Following lines:
"RTN","PXCESIT",11,0)
 ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCESIT",12,0)
 ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~       10
"RTN","PXCESIT",13,0)
 ;The Display & Edit routines are for special cases.
"RTN","PXCESIT",14,0)
 ;
"RTN","PXCESIT",15,0)
FORMAT ;;Encounter~9000010~0,21,150,800,811,812~~^AUPNVSIT
"RTN","PXCESIT",16,0)
 ;;0~1~.01~Encounter Date and Time:  ~Encounter Date and Time:  ~~EVISITDT^PXCEVSIT(1)~~~B
"RTN","PXCESIT",17,0)
 ;;0~5~.05~Patient Name:  ~Patient Name:  ~~EPAT^PXCEVSIT~~~D
"RTN","PXCESIT",18,0)
 ;;0~22~.22~Hospital Location:  ~Hospital Location:  ~~EHOSPLOC^PXCEVSIT~^D HELPHLOC^PXCEVSIT~~D
"RTN","PXCESIT",19,0)
 ;;0~8~.08~Clinic Stop:  ~Clinic Stop:  ~$$DISPLY08^PXCECSTP~EWORKLOD^PXCEVSIT(0)~~~D
"RTN","PXCESIT",20,0)
 ;;0~18~.18~Check Out ~Check Out Date and Time:  ~~ECODT^PXCEVSIT~~~D
"RTN","PXCESIT",21,0)
 ;;800~1~80001~Service Connected:  ~Service Connected:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCESIT",22,0)
 ;;800~7~80007~Combat Veteran:  ~Combat Veteran:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCESIT",23,0)
 ;;800~2~80002~Agent Orange Exposure:  ~Agent Orange Exposure:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCESIT",24,0)
 ;;800~3~80003~Ionizing Radiation Exposure:  ~Ionizing Radiation Exposure:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCESIT",25,0)
 ;;800~4~80004~Environmental Contaminants:  ~Environmental Contaminants:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCESIT",26,0)
 ;;800~5~80005~Military Sexual Trauma:  ~Military Sexual Trauma:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCESIT",27,0)
 ;;800~6~80006~Head and/or Neck Cancer:  ~Head and/or Neck Cancer:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCESIT",28,0)
 ;;
"RTN","PXCESIT",29,0)
 ;
"RTN","PXCESIT",30,0)
 ;********************************
"RTN","PXCESIT",31,0)
 ;Special cases for display of visit are in PXCEVSIT.
"RTN","PXCESIT",32,0)
 ;
"RTN","PXCESIT",33,0)
 ;********************************
"RTN","PXCESIT",34,0)
 ;Special cases for edit of visit are in PXCEVSIT.
"RTN","PXCESIT",35,0)
 ;
"RTN","PXCESIT",36,0)
 ;********************************
"RTN","PXCESIT",37,0)
 ;Display text for the .01 field which is a Date and Time.
"RTN","PXCESIT",38,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCESIT",39,0)
DISPLY01(PXCEVSIT) ;
"RTN","PXCESIT",40,0)
 N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCESIT",41,0)
 N TEXT
"RTN","PXCESIT",42,0)
 S PXCEINT=$P(PXCEVSIT,"^",1)
"RTN","PXCESIT",43,0)
 S PXCEEXT=$$EXTERNAL^DILFD(9000010,.01,"",PXCEINT,"PXCEDILF")
"RTN","PXCESIT",44,0)
 S TEXT=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCESIT",45,0)
 S PXCEINT=$P(PXCEVSIT,"^",22)
"RTN","PXCESIT",46,0)
 S PXCEEXT=$$EXTERNAL^DILFD(9000010,.22,"",PXCEINT,"PXCEDILF")
"RTN","PXCESIT",47,0)
 S TEXT=TEXT_"   "_$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCESIT",48,0)
 S PXCEINT=$P(PXCEVSIT,"^",8)
"RTN","PXCESIT",49,0)
 S PXCEEXT=$$EXTERNAL^DILFD(9000010,.08,"",PXCEINT,"PXCEDILF")
"RTN","PXCESIT",50,0)
 S TEXT=TEXT_"   "_$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCESIT",51,0)
 Q TEXT
"RTN","PXCESIT",52,0)
 ;
"RTN","PXCESK")
0^45^B18964532
"RTN","PXCESK",1,0)
PXCESK ;ISL/dee - Used to edit and display V SKIN TEST ;3/11/04 1:49pm
"RTN","PXCESK",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,124**;Aug 12, 1996
"RTN","PXCESK",3,0)
 ;; ;
"RTN","PXCESK",4,0)
 Q
"RTN","PXCESK",5,0)
 ;
"RTN","PXCESK",6,0)
 ;Line with the line label "FORMAT"
"RTN","PXCESK",7,0)
 ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (1=yes, 0=no)~File global name
"RTN","PXCESK",8,0)
 ;     1         2             3                   4                                   5
"RTN","PXCESK",9,0)
 ;
"RTN","PXCESK",10,0)
 ;Followning lines:
"RTN","PXCESK",11,0)
 ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCESK",12,0)
 ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~       10
"RTN","PXCESK",13,0)
 ;The Display & Edit routines are for special caces.
"RTN","PXCESK",14,0)
 ;  (The .01 field cannot have a special edit.)
"RTN","PXCESK",15,0)
 ;
"RTN","PXCESK",16,0)
 ;***Reading (.05) must be the line before Results (.04)***
"RTN","PXCESK",17,0)
 ;
"RTN","PXCESK",18,0)
FORMAT ;;Skin Test~9000010.12~0,12,811,812~1~^AUPNVSK
"RTN","PXCESK",19,0)
 ;;0~1~.01~Skin Test:  ~Skin Test:  ~~~~~B
"RTN","PXCESK",20,0)
 ;;0~5~.05~Reading in mm:  ~Reading in mm:  ~~EREADING^PXCESK~~~D
"RTN","PXCESK",21,0)
 ;;0~4~.04~Results~Results:  ~~ERESULTS^PXCESK~~~D
"RTN","PXCESK",22,0)
 ;;12~1~1201~Administered Date and (optional) Time~Date/Time of Administered:  ~~E1201^PXCEPOV1(0,30,30)~~~D
"RTN","PXCESK",23,0)
 ;;0~6~.06~Reading Date and (optional) Time~Reading Date:  ~~E1201^PXCEPOV1(0,30,60)~~~D
"RTN","PXCESK",24,0)
 ;;12~4~1204~Reader:  ~Reader:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCESK",25,0)
 ;;811~1~81101~Comments:  ~Comments:  ~~~~~D
"RTN","PXCESK",26,0)
 ;;0~8~.08~Diagnosis:  ~Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCESK",27,0)
 ;;0~9~.09~Diagnosis 2:  ~Diagnosis 2:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCESK",28,0)
 ;;0~10~.1~Diagnosis 3:  ~Diagnosis 3:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCESK",29,0)
 ;;0~11~.11~Diagnosis 4:  ~Diagnosis 4:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCESK",30,0)
 ;;0~12~.12~Diagnosis 5:  ~Diagnosis 5:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCESK",31,0)
 ;;0~13~.13~Diagnosis 6:  ~Diagnosis 6:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCESK",32,0)
 ;;0~14~.14~Diagnosis 7:  ~Diagnosis 7:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCESK",33,0)
 ;;0~15~.15~Diagnosis 8:  ~Diagnosis 8:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCESK",34,0)
 ;;
"RTN","PXCESK",35,0)
 ;
"RTN","PXCESK",36,0)
 ;The interface for AICS to get list on form for help.
"RTN","PXCESK",37,0)
INTRFACE ;;PX SELECT SKIN TEST
"RTN","PXCESK",38,0)
 ;
"RTN","PXCESK",39,0)
 ;********************************
"RTN","PXCESK",40,0)
 ;Special cases for display.
"RTN","PXCESK",41,0)
 ;
"RTN","PXCESK",42,0)
 ;********************************
"RTN","PXCESK",43,0)
 ;Special cases for edit.
"RTN","PXCESK",44,0)
 ;
"RTN","PXCESK",45,0)
EREADING ;
"RTN","PXCESK",46,0)
 I $P(PXCEAFTR(0),"^",5)'="" D
"RTN","PXCESK",47,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCESK",48,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCESK",49,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCESK",50,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCESK",51,0)
 S DIR(0)="NAO^0:40:0"
"RTN","PXCESK",52,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCESK",53,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCESK",54,0)
 D ^DIR
"RTN","PXCESK",55,0)
 K DIR,DA
"RTN","PXCESK",56,0)
 I X="@" S Y="@"
"RTN","PXCESK",57,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCESK",58,0)
 S $P(PXCEAFTR(0),"^",5)=$P(Y,"^")
"RTN","PXCESK",59,0)
 Q
"RTN","PXCESK",60,0)
 ;
"RTN","PXCESK",61,0)
ERESULTS ;
"RTN","PXCESK",62,0)
 I $P(PXCEAFTR(0),"^",4)'="" D
"RTN","PXCESK",63,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCESK",64,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCESK",65,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCESK",66,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCESK",67,0)
 S DIR(0)="SOM^P:POSITIVE;N:NEGATIVE;D:DOUBTFUL;O:NO TAKE"
"RTN","PXCESK",68,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCESK",69,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCESK",70,0)
 D ^DIR
"RTN","PXCESK",71,0)
 K DIR,DA
"RTN","PXCESK",72,0)
 I X="@" S Y="@"
"RTN","PXCESK",73,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCESK",74,0)
 S $P(PXCEAFTR(0),"^",4)=$P(Y,"^")
"RTN","PXCESK",75,0)
 I $P(PXCEAFTR(0),"^",5)]"",$P(PXCEAFTR(0),"^",5)>10,Y'="P" W !,$C(7)_"Readings of greater than 10 must be Positive",! D PAUSE^PXCEHELP S PXCELINE=PXCELINE-2
"RTN","PXCESK",76,0)
 Q
"RTN","PXCESK",77,0)
 ;
"RTN","PXCESK",78,0)
 ;********************************
"RTN","PXCESK",79,0)
 ;Display text for the .01 field which is a pointer to Skin Test.
"RTN","PXCESK",80,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCESK",81,0)
DISPLY01(PXCESK) ;
"RTN","PXCESK",82,0)
 N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCESK",83,0)
 S PXCEINT=$P(PXCESK,"^",1)
"RTN","PXCESK",84,0)
 S PXCEEXT=$$EXTERNAL^DILFD(9000010.12,.01,"",PXCEINT,"PXCEDILF")
"RTN","PXCESK",85,0)
 Q $S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCESK",86,0)
 ;
"RTN","PXCESK",87,0)
 ;********************************
"RTN","PXCESK",88,0)
 ;
"RTN","PXCESK",89,0)
SAVE ;Special code for saving a Skin Test.
"RTN","PXCESK",90,0)
 N PXCERR
"RTN","PXCESK",91,0)
 S PXCERR=$P(^TMP("PXK",$J,PXCECATS,1,0,"AFTER"),"^",4,5)
"RTN","PXCESK",92,0)
 Q:PXCERR="^"
"RTN","PXCESK",93,0)
 I $P(PXCERR,"^",1)'=$P(^TMP("PXK",$J,PXCECATS,1,0,"BEFORE"),"^",4) S $P(^TMP("PXK",$J,PXCECATS,1,0,"AFTER"),"^",4)="@"
"RTN","PXCESK",94,0)
 I $P(PXCERR,"^",2)'=$P(^TMP("PXK",$J,PXCECATS,1,0,"BEFORE"),"^",5) S $P(^TMP("PXK",$J,PXCECATS,1,0,"AFTER"),"^",5)="@"
"RTN","PXCESK",95,0)
 D EN1^PXKMAIN
"RTN","PXCESK",96,0)
 S ^TMP("PXK",$J,PXCECATS,1,0,"AFTER")=PXCEAFTR(0)
"RTN","PXCESK",97,0)
 Q
"RTN","PXCEVFI1")
0^40^B18089090
"RTN","PXCEVFI1",1,0)
PXCEVFI1 ;ISL/dee,esw - Routine to edit a visit or v-file entry ;8/3/04 10:32am
"RTN","PXCEVFI1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**23,73,112,136,143,124**;Aug 12, 1996
"RTN","PXCEVFI1",3,0)
 Q
"RTN","PXCEVFI1",4,0)
 ;
"RTN","PXCEVFI1",5,0)
EDIT ; -- edit the V-File stored in "AFTER"
"RTN","PXCEVFI1",6,0)
 N DIR,DA,X,Y,C,PXCEINP,PXCEIN01,PXCEEND
"RTN","PXCEVFI1",7,0)
 N PXCELINE,PXCETEXT,PXCEDIRB,PXCEMOD
"RTN","PXCEVFI1",8,0)
 N PXCEKEY,PXCEIKEY,PXCENKEY,PXMDCNT
"RTN","PXCEVFI1",9,0)
 W !
"RTN","PXCEVFI1",10,0)
 G:PXCECAT="VST"!(PXCECAT="APPM")!(PXCECAT="CSTP") REST
"RTN","PXCEVFI1",11,0)
 ;
"RTN","PXCEVFI1",12,0)
EDIT01 ;
"RTN","PXCEVFI1",13,0)
 I PXCECAT="CPT"!(PXCECAT="POV")!(PXCECAT="SK")!(PXCECAT="IMM") D SC^PXCEVFI2($P(^AUPNVSIT(PXCEVIEN,0),U,5))
"RTN","PXCEVFI1",14,0)
 S PXCETEXT=$P($T(FORMAT+1^@PXCECODE),";;",2)
"RTN","PXCEVFI1",15,0)
 K DIR,DA,X,Y,C,PXCEDIRB
"RTN","PXCEVFI1",16,0)
 I $P(PXCEAFTR(0),"^",1) D
"RTN","PXCEVFI1",17,0)
 . N DIEER,PXCEDILF,PXCEEXT
"RTN","PXCEVFI1",18,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,.01,"",$P(PXCEAFTR(0),"^",1),"PXCEDILF")
"RTN","PXCEVFI1",19,0)
 . S PXCEDIRB=$S('$D(DIERR):PXCEEXT,1:$P(PXCEAFTR(0),"^",1))
"RTN","PXCEVFI1",20,0)
 E  S PXCEDIRB=""
"RTN","PXCEVFI1",21,0)
 I $P(PXCETEXT,"~",7)]"" D
"RTN","PXCEVFI1",22,0)
 . D @$P(PXCETEXT,"~",7)
"RTN","PXCEVFI1",23,0)
 E  D
"RTN","PXCEVFI1",24,0)
 . I PXCEDIRB'="" S DIR("B")=PXCEDIRB
"RTN","PXCEVFI1",25,0)
 . S DIR(0)=PXCEFILE_",.01OA"
"RTN","PXCEVFI1",26,0)
 . S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVFI1",27,0)
 . S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVFI1",28,0)
 . D ^DIR
"RTN","PXCEVFI1",29,0)
 I X="@" D  G ENDEDIT
"RTN","PXCEVFI1",30,0)
 . N DIRUT
"RTN","PXCEVFI1",31,0)
 . I $P(PXCEAFTR(0),"^",1)="" D
"RTN","PXCEVFI1",32,0)
 .. W !,"There is no entry to delete."
"RTN","PXCEVFI1",33,0)
 .. D WAIT^PXCEHELP
"RTN","PXCEVFI1",34,0)
 . E  D DEL^PXCEVFI2(PXCECAT)
"RTN","PXCEVFI1",35,0)
 I $D(DIRUT),$P(PXCEAFTR(0),"^",1)="" S PXCELOOP=1
"RTN","PXCEVFI1",36,0)
 I $D(DIRUT) S PXCEQUIT=1 Q
"RTN","PXCEVFI1",37,0)
 S PXCEINP=Y
"RTN","PXCEVFI1",38,0)
 S PXCEIN01=X
"RTN","PXCEVFI1",39,0)
 I $P(Y,"^",2)'=PXCEDIRB,$$DUP(PXCEINP) G EDIT01
"RTN","PXCEVFI1",40,0)
 ;--File new CPT code and retrieve IEN
"RTN","PXCEVFI1",41,0)
 I PXCECAT="CPT" D
"RTN","PXCEVFI1",42,0)
 . S PXMDCNT=$$CODM^ICPTCOD(+Y,"^TMP(""PXMODARR"",$J",PXCESOR,+^TMP("PXK",$J,"VST",1,0,"AFTER"))
"RTN","PXCEVFI1",43,0)
 . K ^TMP("PXMODARR",$J)
"RTN","PXCEVFI1",44,0)
 . I $P(PXCEAFTR(0),"^",1)'=""!(PXMDCNT'>0) Q
"RTN","PXCEVFI1",45,0)
 . N PXCEFIEN
"RTN","PXCEVFI1",46,0)
 . D NEWCODE^PXCECPT
"RTN","PXCEVFI1",47,0)
 . S ^TMP("PXK",$J,PXCECATS,1,"IEN")=PXCEFIEN
"RTN","PXCEVFI1",48,0)
 I PXCECAT="PRV",$P(PXCEAFTR(0),"^",1)>0,PXCEDIRB]"" S $P(PXCEAFTR(0),"^",6)=""
"RTN","PXCEVFI1",49,0)
 S $P(PXCEAFTR(0),"^",1)=$P(PXCEINP,"^")
"RTN","PXCEVFI1",50,0)
 K DIR,DA
"RTN","PXCEVFI1",51,0)
 ;
"RTN","PXCEVFI1",52,0)
 ;
"RTN","PXCEVFI1",53,0)
REST S PXCEEND=0
"RTN","PXCEVFI1",54,0)
 F PXCELINE=2:1 S PXCETEXT=$P($T(FORMAT+PXCELINE^@PXCECODE),";;",2) Q:PXCETEXT']""  D  Q:PXCEEND
"RTN","PXCEVFI1",55,0)
 . I $P(PXCETEXT,"~",9)]"",$P(PXCETEXT,"~",3)'=80201 S PXCEKEY="" D  Q:PXCEKEY'=1
"RTN","PXCEVFI1",56,0)
 .. S PXCENKEY=$L($P(PXCETEXT,"~",9))
"RTN","PXCEVFI1",57,0)
 .. F PXCEIKEY=1:1:PXCENKEY I PXCEKEYS[$E($P(PXCETEXT,"~",9),PXCEIKEY) S PXCEKEY=1 Q
"RTN","PXCEVFI1",58,0)
 . K DIR,DA,X,Y,C
"RTN","PXCEVFI1",59,0)
 . I $P(PXCETEXT,"~",7)]"" D
"RTN","PXCEVFI1",60,0)
 .. D @$P(PXCETEXT,"~",7)
"RTN","PXCEVFI1",61,0)
 . E  D
"RTN","PXCEVFI1",62,0)
 .. I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEVFI1",63,0)
 ... N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVFI1",64,0)
 ... S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVFI1",65,0)
 ... S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVFI1",66,0)
 ... S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVFI1",67,0)
 .. S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCEVFI1",68,0)
 .. S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVFI1",69,0)
 .. S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVFI1",70,0)
 .. D ^DIR
"RTN","PXCEVFI1",71,0)
 .. K DIR,DA
"RTN","PXCEVFI1",72,0)
 .. I X="@" S Y="@"
"RTN","PXCEVFI1",73,0)
 .. E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 S:PXCECAT="SIT"!(PXCECAT="APPM")!(PXCECAT="HIST")!(PXCECAT="CPT") PXCEQUIT=1 Q
"RTN","PXCEVFI1",74,0)
 .. S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEVFI1",75,0)
 . I ($P(PXCETEXT,"~",3)=1202!($P(PXCETEXT,"~",3)=1204)) D:+Y>0 PROVIDER^PXCEVFI4(+Y)
"RTN","PXCEVFI1",76,0)
 ;
"RTN","PXCEVFI1",77,0)
ENDEDIT ;
"RTN","PXCEVFI1",78,0)
 Q
"RTN","PXCEVFI1",79,0)
 ;
"RTN","PXCEVFI1",80,0)
DUP(PXCEINP) ; -- Check for dup entries.
"RTN","PXCEVFI1",81,0)
 Q:PXCECAT="SIT"!(PXCECAT="APPM")!(PXCECAT="HIST") 0
"RTN","PXCEVFI1",82,0)
 ;
"RTN","PXCEVFI1",83,0)
 N PXCEDUP,PXCEINDX,X,Y
"RTN","PXCEVFI1",84,0)
 S PXCEDUP=0
"RTN","PXCEVFI1",85,0)
 S PXCEINDX=""
"RTN","PXCEVFI1",86,0)
 F  S PXCEINDX=$O(@(PXCEAUPN_"(""AD"",PXCEVIEN,PXCEINDX)")) Q:'PXCEINDX!PXCEDUP  S:+@(PXCEAUPN_"(PXCEINDX,0)")=+PXCEINP&(PXCEINDX'=PXCEFIEN) PXCEDUP=1
"RTN","PXCEVFI1",87,0)
 I PXCEDUP D
"RTN","PXCEVFI1",88,0)
 . I PXCEDUP
"RTN","PXCEVFI1",89,0)
 . W !,$P(PXCEINP,"^",2)," is already a "_PXCECATT_" for this Encounter."
"RTN","PXCEVFI1",90,0)
 . I PXCECAT="POV" W !!,"Duplicate Diagnosis Not Allowed." Q  ;PX/112
"RTN","PXCEVFI1",91,0)
 . I PXCECAT="CPT",$$GET1^DIQ(357.69,$P(PXCEINP,"^",2),.01)>0 D  Q
"RTN","PXCEVFI1",92,0)
 . . W !,"No duplicate E&M codes allowed."   ;PX/136
"RTN","PXCEVFI1",93,0)
 . I $P($T(FORMAT^@PXCECODE),"~",4) D
"RTN","PXCEVFI1",94,0)
 .. N DIR,DA
"RTN","PXCEVFI1",95,0)
 .. S DIR(0)="Y"
"RTN","PXCEVFI1",96,0)
 .. S DIR("A")="Do you want to add another "_$P(PXCEINP,"^",2)_""
"RTN","PXCEVFI1",97,0)
 .. S DIR("B")="NO"
"RTN","PXCEVFI1",98,0)
 .. D ^DIR
"RTN","PXCEVFI1",99,0)
 .. S PXCEDUP='+Y
"RTN","PXCEVFI1",100,0)
 Q PXCEDUP
"RTN","PXCEVFI1",101,0)
 ;
"RTN","PXCEVFI2")
0^53^B33899362
"RTN","PXCEVFI2",1,0)
PXCEVFI2 ;ISL/dee,ESW - Supporting routines for editing a visit or v-file entry ;2/11/04 4:40pm
"RTN","PXCEVFI2",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,73,95,96,124**;Aug 12, 1996
"RTN","PXCEVFI2",3,0)
 ;
"RTN","PXCEVFI2",4,0)
 Q
"RTN","PXCEVFI2",5,0)
ASK(PXCVIEN,PXCFIEN,PXCEAUPN,PXCCATT,PXCCODE) ; -- Display a selection list from one V-File for this visit
"RTN","PXCEVFI2",6,0)
 N PXCEINDX,PXCECNT,PXCEASK,PXCEREF
"RTN","PXCEVFI2",7,0)
 N DIR,DA,X,Y
"RTN","PXCEVFI2",8,0)
 S PXCEINDX=""
"RTN","PXCEVFI2",9,0)
 F PXCECNT=0:1 S PXCEINDX=$O(@(PXCEAUPN_"(""AD"",PXCVIEN,PXCEINDX)")) Q:'PXCEINDX  D
"RTN","PXCEVFI2",10,0)
 . I PXCECNT=0&(PXCCATT="Diagnosis") D SC($P(^AUPNVSIT(PXCEVIEN,0),U,5))
"RTN","PXCEVFI2",11,0)
 . I PXCECNT=0&(PXCCATT="CPT") D SC($P(^AUPNVSIT(PXCEVIEN,0),U,5))
"RTN","PXCEVFI2",12,0)
 . W:PXCECNT=0 !!,"--- "_PXCCATT_" ---",!
"RTN","PXCEVFI2",13,0)
 . S PXCEASK(PXCECNT+1)=PXCEINDX
"RTN","PXCEVFI2",14,0)
 . W !,$J(PXCECNT+1,3),?6,@("$$DISPLY01^"_PXCCODE_"("_PXCEAUPN_"(PXCEINDX,0))")
"RTN","PXCEVFI2",15,0)
 Q:PXCECNT'>0
"RTN","PXCEVFI2",16,0)
ASKLOOP S DIR(0)="FAO^1:"_$L(PXCECNT)
"RTN","PXCEVFI2",17,0)
 S DIR("A")="Enter 1-"_PXCECNT_" to Edit, or 'A' to Add: "
"RTN","PXCEVFI2",18,0)
 S DIR("?")="Enter the number of the "_PXCCATT_" you wish to edit or A to add a new "_PXCCATT_"."
"RTN","PXCEVFI2",19,0)
 D ^DIR
"RTN","PXCEVFI2",20,0)
 K DIR,DA
"RTN","PXCEVFI2",21,0)
 I $D(DIRUT) S PXCEQUIT=1 Q
"RTN","PXCEVFI2",22,0)
 Q:"Aa"[Y
"RTN","PXCEVFI2",23,0)
 G:Y<1!(Y>PXCECNT) ASKLOOP
"RTN","PXCEVFI2",24,0)
 G:$G(PXCEASK(Y))'>0 ASKLOOP
"RTN","PXCEVFI2",25,0)
 S PXCFIEN=$G(PXCEASK(Y))
"RTN","PXCEVFI2",26,0)
 Q
"RTN","PXCEVFI2",27,0)
 ;
"RTN","PXCEVFI2",28,0)
SAVE ; -- Save this edited and quit editing.
"RTN","PXCEVFI2",29,0)
 I PXCECAT="CSTP" S PXCEFIEN=$$STOPCODE^PXUTLSTP(PXCESOR,$P(PXCEAFTR(0),"^",8),PXCEVIEN)
"RTN","PXCEVFI2",30,0)
 E  D
"RTN","PXCEVFI2",31,0)
 . N PXCENODS,PXCEFOR,PXCENODE,PXCESEQ
"RTN","PXCEVFI2",32,0)
 . S PXCENODS=$P($T(FORMAT^@PXCECODE),"~",3)
"RTN","PXCEVFI2",33,0)
 . F PXCEFOR=1:1 S PXCENODE=$P(PXCENODS,",",PXCEFOR) Q:PXCENODE']""  D
"RTN","PXCEVFI2",34,0)
 .. I PXCENODE=1,PXCECATS="CPT" D  Q
"RTN","PXCEVFI2",35,0)
 ... S PXCESEQ=""
"RTN","PXCEVFI2",36,0)
 ... F  S PXCESEQ=$O(PXCEAFTR(PXCENODE,PXCESEQ)) Q:PXCESEQ=""  D
"RTN","PXCEVFI2",37,0)
 .... S ^TMP("PXK",$J,PXCECATS,1,PXCENODE,PXCESEQ,"AFTER")=PXCEAFTR(PXCENODE,PXCESEQ)
"RTN","PXCEVFI2",38,0)
 .. S ^TMP("PXK",$J,PXCECATS,1,PXCENODE,"AFTER")=PXCEAFTR(PXCENODE)
"RTN","PXCEVFI2",39,0)
 . I PXCECAT="SK",^TMP("PXK",$J,PXCECATS,1,"IEN")]"" D SAVE^PXCESK
"RTN","PXCEVFI2",40,0)
 . D EN1^PXKMAIN
"RTN","PXCEVFI2",41,0)
 . I PXCECAT="SIT"!(PXCECAT="APPM")!(PXCECAT="HIST") S PXCEVIEN=^TMP("PXK",$J,"VST",1,"IEN")
"RTN","PXCEVFI2",42,0)
 Q
"RTN","PXCEVFI2",43,0)
 ;
"RTN","PXCEVFI2",44,0)
DEL(PXCECAT) ; -- Delete this V-File entry from the List if all the visit infomation.
"RTN","PXCEVFI2",45,0)
 I PXCEFIEN'>0!(PXCEVIEN'>0) W !!,$C(7),"Error: Cannot delete this an unknown V-File entry." D PAUSE^PXCEHELP Q
"RTN","PXCEVFI2",46,0)
 I PXCEKEYS'["D",PXCEKEYS'["d" W !!,$C(7),"Error: You do not have delete access." D PAUSE^PXCEHELP Q
"RTN","PXCEVFI2",47,0)
 ;
"RTN","PXCEVFI2",48,0)
 N PXCENODS,PXCEFOR,PXCENODE,PXCECATS,PXCECATT,PXCECODE,PXCEAUPN,PXCEQUIT
"RTN","PXCEVFI2",49,0)
 S PXCECODE="PXCE"_$S(PXCECAT="IMM":"VIMM",1:PXCECAT)
"RTN","PXCEVFI2",50,0)
 S PXCECATS=$S(PXCECAT="CSTP":"VST",PXCECAT="HIST":"VST",1:PXCECAT)
"RTN","PXCEVFI2",51,0)
 S PXCEAUPN=$P($T(FORMAT^@PXCECODE),"~",5)
"RTN","PXCEVFI2",52,0)
 S PXCECATT=$P($P($T(FORMAT^@PXCECODE),";;",2),"~",1)
"RTN","PXCEVFI2",53,0)
 ;
"RTN","PXCEVFI2",54,0)
 I '$D(@(PXCEAUPN_"(PXCEFIEN)")) Q
"RTN","PXCEVFI2",55,0)
 I $P($G(@(PXCEAUPN_"(PXCEFIEN,812)")),"^",1) D  Q
"RTN","PXCEVFI2",56,0)
 . W !!,"Error on deleting "_PXCECATT_" ",@("$$DISPLY01^"_PXCECODE_"(@(PXCEAUPN_""(PXCEFIEN,0)""))")
"RTN","PXCEVFI2",57,0)
 . W !,"Error: You cannot delete this entry it has been ""Verified""." D WAIT^PXCEHELP
"RTN","PXCEVFI2",58,0)
 I PXCEKEYS'["D" D  Q:PXCEQUIT
"RTN","PXCEVFI2",59,0)
 . N PXCECHK
"RTN","PXCEVFI2",60,0)
 . S PXCEQUIT=0
"RTN","PXCEVFI2",61,0)
 . I PXCECATS="VST" S PXCECHK=$P($G(@(PXCEAUPN_"(PXCEFIEN,0)")),"^",23)
"RTN","PXCEVFI2",62,0)
 . E  S PXCECHK=$P($P($P($G(@(PXCEAUPN_"(PXCEFIEN,801)")),"^",2),";",1)," ",2)
"RTN","PXCEVFI2",63,0)
 . I DUZ'=PXCECHK D
"RTN","PXCEVFI2",64,0)
 .. S PXCEQUIT=1
"RTN","PXCEVFI2",65,0)
 .. N NODE0
"RTN","PXCEVFI2",66,0)
 .. S NODE0=@(PXCEAUPN_"(PXCEFIEN,0)")
"RTN","PXCEVFI2",67,0)
 .. W !!,"Error on deleting "_PXCECATT_" ",@("$$DISPLY01^"_PXCECODE_"(NODE0)")
"RTN","PXCEVFI2",68,0)
 .. W !,"Error: You cannot delete an entry you did not create." D WAIT^PXCEHELP
"RTN","PXCEVFI2",69,0)
 ;
"RTN","PXCEVFI2",70,0)
 I PXCECAT="CSTP" D
"RTN","PXCEVFI2",71,0)
 . W !!,"Deleting "_PXCECATT_" "
"RTN","PXCEVFI2",72,0)
 . W @("$$DISPLY01^"_PXCECODE_"($G(@(PXCEAUPN_""(PXCEFIEN,0)"")))")
"RTN","PXCEVFI2",73,0)
 . Q:'$$SURE^PXCEAE2
"RTN","PXCEVFI2",74,0)
 . N PXCERESU
"RTN","PXCEVFI2",75,0)
 . S PXCERESU=$$STOPCODE^PXUTLSTP(PXCESOR,"@",PXCEVIEN,PXCEFIEN)
"RTN","PXCEVFI2",76,0)
 . S:$D(PXCELOOP) PXCELOOP=1
"RTN","PXCEVFI2",77,0)
 E  I PXCECATS="VST" D
"RTN","PXCEVFI2",78,0)
 . W !!,"Deleting "_PXCECATT_" "
"RTN","PXCEVFI2",79,0)
 . W @("$$DISPLY01^"_PXCECODE_"($G(@(PXCEAUPN_""(PXCEFIEN,0)"")))")
"RTN","PXCEVFI2",80,0)
 . Q:'$$SURE^PXCEAE2
"RTN","PXCEVFI2",81,0)
 . N PXCERESU
"RTN","PXCEVFI2",82,0)
 . S PXCERESU=$$KILL^VSITKIL(PXCEVIEN)
"RTN","PXCEVFI2",83,0)
 . I PXCERESU D
"RTN","PXCEVFI2",84,0)
 .. I PXCERESU=1,$O(^SCE("AVSIT",PXCEVIEN,"")) Q
"RTN","PXCEVFI2",85,0)
 .. W !,$C(7),"Could not delete the encounter.  There are still users of it." D WAIT^PXCEHELP
"RTN","PXCEVFI2",86,0)
 . I 'PXCERESU S PXCEVDEL=1 S:$D(PXCELOOP) (PXCELOOP,PXCEQUIT,PXCENOER)=1
"RTN","PXCEVFI2",87,0)
 . D EVENT^PXKMAIN
"RTN","PXCEVFI2",88,0)
 ;
"RTN","PXCEVFI2",89,0)
 E  D
"RTN","PXCEVFI2",90,0)
 . K ^TMP("PXK",$J)
"RTN","PXCEVFI2",91,0)
 . S ^TMP("PXK",$J,"VST",1,"IEN")=PXCEVIEN
"RTN","PXCEVFI2",92,0)
 . F PXCENODE=0,21,150,800,811,812 D
"RTN","PXCEVFI2",93,0)
 .. S (^TMP("PXK",$J,"VST",1,PXCENODE,"AFTER"),^TMP("PXK",$J,"VST",1,PXCENODE,"BEFORE"))=$G(^AUPNVSIT(PXCEVIEN,PXCENODE))
"RTN","PXCEVFI2",94,0)
 . ;
"RTN","PXCEVFI2",95,0)
 . S ^TMP("PXK",$J,"SOR")=PXCESOR
"RTN","PXCEVFI2",96,0)
 . S ^TMP("PXK",$J,PXCECATS,1,"IEN")=PXCEFIEN
"RTN","PXCEVFI2",97,0)
 . ;
"RTN","PXCEVFI2",98,0)
 . S PXCENODS=$P($T(FORMAT^@PXCECODE),"~",3)
"RTN","PXCEVFI2",99,0)
 . F PXCEFOR=1:1 S PXCENODE=$P(PXCENODS,",",PXCEFOR) Q:PXCENODE']""  D
"RTN","PXCEVFI2",100,0)
 .. S ^TMP("PXK",$J,PXCECATS,1,PXCENODE,"BEFORE")=$G(@(PXCEAUPN_"(PXCEFIEN,PXCENODE)"))
"RTN","PXCEVFI2",101,0)
 . ;
"RTN","PXCEVFI2",102,0)
 . N DIK,DA
"RTN","PXCEVFI2",103,0)
 . W !!,"Deleting "_PXCECATT_" "
"RTN","PXCEVFI2",104,0)
 . W @("$$DISPLY01^"_PXCECODE_"(^TMP(""PXK"",$J,PXCECATS,1,0,""BEFORE""))")
"RTN","PXCEVFI2",105,0)
 . Q:'$$SURE^PXCEAE2  ;DELQUIT
"RTN","PXCEVFI2",106,0)
 . S PXCENODS=$P($T(FORMAT^@PXCECODE),"~",3)
"RTN","PXCEVFI2",107,0)
 . F PXCEFOR=1:1 S PXCENODE=$P(PXCENODS,",",PXCEFOR) Q:PXCENODE']""  S ^TMP("PXK",$J,PXCECATS,1,PXCENODE,"AFTER")=$S(PXCENODE=0:"@",1:"")
"RTN","PXCEVFI2",108,0)
 . D EN1^PXKMAIN
"RTN","PXCEVFI2",109,0)
 . S:$D(PXCELOOP) PXCELOOP=1
"RTN","PXCEVFI2",110,0)
 . I $D(PXCENOER)#2 S PXCENOER=1
"RTN","PXCEVFI2",111,0)
 ;
"RTN","PXCEVFI2",112,0)
DELQUIT ;
"RTN","PXCEVFI2",113,0)
 K ^TMP("PXK",$J)
"RTN","PXCEVFI2",114,0)
 Q
"RTN","PXCEVFI2",115,0)
 ;
"RTN","PXCEVFI2",116,0)
SC(PXDFN) ;Service Connected Help
"RTN","PXCEVFI2",117,0)
 ; Input  -- DFN      Patient file IEN  
"RTN","PXCEVFI2",118,0)
 ; Output -- Help
"RTN","PXCEVFI2",119,0)
 N I,SDCNT,SDDC,SDRD0
"RTN","PXCEVFI2",120,0)
 W !!,"Patient's Service Connection and Rated Disabilities:"
"RTN","PXCEVFI2",121,0)
 W !!,$S($P($G(^DPT(PXDFN,.3)),"^")="Y":"        SC Percent: "_$P(^(.3),"^",2)_"%",1:" Service Connected: No")
"RTN","PXCEVFI2",122,0)
 W !,"Rated Disabilities: "
"RTN","PXCEVFI2",123,0)
 I $P($G(^DPT(PXDFN,"VET")),"^")'="Y",$S('$D(^DIC(391,+$G(^DPT(PXDFN,"TYPE")),0)):1,$P(^(0),"^",2):0,1:1) W "Not a Veteran" Q
"RTN","PXCEVFI2",124,0)
 S (SDCNT,I)=0
"RTN","PXCEVFI2",125,0)
 F  S I=$O(^DPT(PXDFN,.372,I)) Q:'I  I $P($G(^(I,0)),"^",3) S SDRD0=^(0) D
"RTN","PXCEVFI2",126,0)
 .S SDCNT=SDCNT+1
"RTN","PXCEVFI2",127,0)
 .S SDDC=$S('$D(^DIC(31,+SDRD0,0)):"",$P(^(0),"^",4)]"":$P(^(0),"^",4),1:$P(^(0),"^"))
"RTN","PXCEVFI2",128,0)
 .W:SDCNT>1 !
"RTN","PXCEVFI2",129,0)
 .W ?20,SDDC,"  (",$P(SDRD0,"^",2),"%-",$S($P(SDRD0,"^",3):"SC",1:""),")"
"RTN","PXCEVFI2",130,0)
 I 'SDCNT W $S('$O(^DPT(PXDFN,.372,0)):"None Stated",1:"No Service Connected Disabilities Listed")
"RTN","PXCEVFI2",131,0)
 ;
"RTN","PXCEVFI4")
0^22^B25786304
"RTN","PXCEVFI4",1,0)
PXCEVFI4 ;ISL/dee - Routine to display a visit or v-file entry and input providers in to V PROVIDER from other V Files ;6/20/96
"RTN","PXCEVFI4",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**124**;Aug 12, 1996
"RTN","PXCEVFI4",3,0)
 Q
"RTN","PXCEVFI4",4,0)
DISPLAY ; -- display the data
"RTN","PXCEVFI4",5,0)
 Q:PXCECAT="CSTP"
"RTN","PXCEVFI4",6,0)
 N PXCELINE,PXCETEXT,PXCEINT,PXCEEXT
"RTN","PXCEVFI4",7,0)
 I PXCECAT="APPM"!(PXCECAT="HIST") N PXCECODE S PXCECODE="PXCESIT"
"RTN","PXCEVFI4",8,0)
 W !
"RTN","PXCEVFI4",9,0)
 F PXCELINE=1:1 S PXCETEXT=$P($T(FORMAT+PXCELINE^@PXCECODE),";;",2) Q:PXCETEXT']""  D
"RTN","PXCEVFI4",10,0)
 . S (PXCEINT,PXCEEXT)=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVFI4",11,0)
 . I PXCEINT="@" S PXCEEXT="<deleted>"
"RTN","PXCEVFI4",12,0)
 . E  I PXCEINT'="" D
"RTN","PXCEVFI4",13,0)
 .. I $P(PXCETEXT,"~",6)]"" S @("PXCEEXT="_$P(PXCETEXT,"~",6)_"("""_PXCEINT_""")")
"RTN","PXCEVFI4",14,0)
 .. E  D
"RTN","PXCEVFI4",15,0)
 ... N DIERR,PXCEDILF
"RTN","PXCEVFI4",16,0)
 ... S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVFI4",17,0)
 ... S PXCEEXT=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVFI4",18,0)
 . I ($L($P(PXCETEXT,"~",5))+$L(PXCEEXT))'>80 D
"RTN","PXCEVFI4",19,0)
 .. W !,$P(PXCETEXT,"~",5),PXCEEXT
"RTN","PXCEVFI4",20,0)
 . E  D
"RTN","PXCEVFI4",21,0)
 .. N PXCEWRAP,PXCECOUN
"RTN","PXCEVFI4",22,0)
 .. D WRAP(PXCEEXT,80-$L($P(PXCETEXT,"~",5)),.PXCEWRAP)
"RTN","PXCEVFI4",23,0)
 .. W !,$P(PXCETEXT,"~",5),$G(PXCEWRAP(1))
"RTN","PXCEVFI4",24,0)
 .. S PXCECOUN=1
"RTN","PXCEVFI4",25,0)
 .. F  S PXCECOUN=$O(PXCEWRAP(PXCECOUN)) Q:PXCECOUN']""  D
"RTN","PXCEVFI4",26,0)
 ... W !,$J("",$L($P(PXCETEXT,"~",5))),PXCEWRAP(PXCECOUN)
"RTN","PXCEVFI4",27,0)
 Q
"RTN","PXCEVFI4",28,0)
 ;
"RTN","PXCEVFI4",29,0)
WRAP(X,DIWR,WRAPPED) ;Copies the text in X into the array WRAPPED
"RTN","PXCEVFI4",30,0)
 N DIWL,DIWF,PXCEINDX
"RTN","PXCEVFI4",31,0)
 K ^UTILITY($J,"W")
"RTN","PXCEVFI4",32,0)
 S DIWL=1
"RTN","PXCEVFI4",33,0)
 S DIRF=""
"RTN","PXCEVFI4",34,0)
 D ^DIWP
"RTN","PXCEVFI4",35,0)
 S PXCEINDX=0
"RTN","PXCEVFI4",36,0)
 F  S PXCEINDX=$O(^UTILITY($J,"W",DIWL,PXCEINDX)) Q:'PXCEINDX  S WRAPPED(PXCEINDX)=^UTILITY($J,"W",DIWL,PXCEINDX,0)
"RTN","PXCEVFI4",37,0)
 K ^UTILITY($J,"W")
"RTN","PXCEVFI4",38,0)
 Q
"RTN","PXCEVFI4",39,0)
 ;
"RTN","PXCEVFI4",40,0)
PROVIDER(PXCEPRV) ;See if it is a new provider and if it is add them.
"RTN","PXCEVFI4",41,0)
 N PXCEVPRV,PXCEKPRV,PXCENPRV,PXCEPRIM
"RTN","PXCEVFI4",42,0)
 N DIR,DA,X,Y
"RTN","PXCEVFI4",43,0)
 S (PXCEVPRV,PXCEKPRV)=""
"RTN","PXCEVFI4",44,0)
 S PXCEPRIM=0
"RTN","PXCEVFI4",45,0)
 ;See if this provider is already in V Provider for this Encounter
"RTN","PXCEVFI4",46,0)
 F  S PXCEVPRV=$O(^AUPNVPRV("AD",PXCEVIEN,PXCEVPRV)) Q:PXCEVPRV'>0  Q:PXCEPRV=$P(^AUPNVPRV(PXCEVPRV,0),"^",1)  S:"P"=$P(^AUPNVPRV(PXCEVPRV,0),"^",4) PXCEPRIM=1
"RTN","PXCEVFI4",47,0)
 Q:PXCEVPRV>0
"RTN","PXCEVFI4",48,0)
 ;See if this provider is in the ^TMP("PXK",$J,
"RTN","PXCEVFI4",49,0)
 F  S PXCEKPRV=$O(^TMP("PXK",$J,"PRV",PXCEKPRV)) Q:PXCEKPRV'>0  Q:PXCEPRV=+^TMP("PXK",$J,"PRV",PXCEKPRV,0,"AFTER")  S:"P"=$P(^TMP("PXK",$J,"PRV",PXCEKPRV,0,"AFTER"),"^",4) PXCEPRIM=1
"RTN","PXCEVFI4",50,0)
 Q:PXCEKPRV>0
"RTN","PXCEVFI4",51,0)
 I 'PXCEPRIM D  I $D(DTOUT)!$D(DUOUT) Q
"RTN","PXCEVFI4",52,0)
 . N DIR,DA
"RTN","PXCEVFI4",53,0)
 . S DIR(0)="9000010.06,.04A"
"RTN","PXCEVFI4",54,0)
 . S DIR("A")="Is this provider Primary or Secondary?  "
"RTN","PXCEVFI4",55,0)
 . S DIR("B")=$S(PXCEPRIM:"S",1:"P")
"RTN","PXCEVFI4",56,0)
 . D ^DIR
"RTN","PXCEVFI4",57,0)
 I PXCEPRIM S Y="S"
"RTN","PXCEVFI4",58,0)
 ;Set PXCENPRV to the next provider in ^TMP("PXK",$J,"PRV",
"RTN","PXCEVFI4",59,0)
 I $Q(^TMP("PXK",$J,"PRV"))["PXK,"_$J_",PRV" S PXCENPRV=+$O(^TMP("PXK",$J,"PRV",""),-1)+1
"RTN","PXCEVFI4",60,0)
 E  S PXCENPRV=1
"RTN","PXCEVFI4",61,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,"IEN")=""
"RTN","PXCEVFI4",62,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,0,"BEFORE")=""
"RTN","PXCEVFI4",63,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,0,"AFTER")=PXCEPRV_"^"_PXCEPAT_"^"_PXCEVIEN_"^"_$P(Y,"^")
"RTN","PXCEVFI4",64,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,812,"BEFORE")=""
"RTN","PXCEVFI4",65,0)
 S ^TMP("PXK",$J,"PRV",PXCENPRV,812,"AFTER")="^"_PXCEPKG_"^"_PXCESOR
"RTN","PXCEVFI4",66,0)
 Q
"RTN","PXCEVFI4",67,0)
 ;
"RTN","PXCEVFI4",68,0)
DIAGNOS(PXCEPOV) ;See if it is a new diagnosis and if it is add them.
"RTN","PXCEVFI4",69,0)
 N PXCEVPOV,PXCEKPOV,PXCENPOV,PXCEPMSC,PXCENARR,PXCEMOD,PXCEDXSC,PXCEX,PXCEY
"RTN","PXCEVFI4",70,0)
 N DIR,DA,X,Y
"RTN","PXCEVFI4",71,0)
 S (PXCEVPOV,PXCEKPOV)=""
"RTN","PXCEVFI4",72,0)
 S PXCEPRIM=0
"RTN","PXCEVFI4",73,0)
 ;See if this diagnosis is already in V POV for this Encounter
"RTN","PXCEVFI4",74,0)
 F  S PXCEVPOV=$O(^AUPNVPOV("AD",PXCEVIEN,PXCEVPOV)) Q:PXCEVPOV'>0  Q:PXCEPOV=$P(^AUPNVPOV(PXCEVPOV,0),"^",1)  S:"P"=$P(^AUPNVPOV(PXCEVPOV,0),"^",12) PXCEPRIM=1
"RTN","PXCEVFI4",75,0)
 Q:PXCEVPOV>0
"RTN","PXCEVFI4",76,0)
 ;See if this diagnosis is in the ^TMP("PXK",$J,
"RTN","PXCEVFI4",77,0)
 F  S PXCEKPOV=$O(^TMP("PXK",$J,"POV",PXCEKPOV)) Q:PXCEKPOV'>0  Q:PXCEPOV=+^TMP("PXK",$J,"POV",PXCEKPOV,0,"AFTER")  S:"P"=$P(^TMP("PXK",$J,"POV",PXCEKPOV,0,"AFTER"),"^",12) PXCEPRIM=1
"RTN","PXCEVFI4",78,0)
 Q:PXCEKPOV>0
"RTN","PXCEVFI4",79,0)
 ;Is this diagnosis primary P/S
"RTN","PXCEVFI4",80,0)
 I 'PXCEPRIM D  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVFI4",81,0)
 . N DIR,DA
"RTN","PXCEVFI4",82,0)
 . S DIR(0)="9000010.07,.12A"
"RTN","PXCEVFI4",83,0)
 . S DIR("A")="Diagnosis is Primary?  "
"RTN","PXCEVFI4",84,0)
 . S DIR("B")="P"
"RTN","PXCEVFI4",85,0)
 . D ^DIR
"RTN","PXCEVFI4",86,0)
 . S PXCEPMSC=$P(Y,"^",1)
"RTN","PXCEVFI4",87,0)
 . S:PXCEPMSC="P" PXCEPRIM=1
"RTN","PXCEVFI4",88,0)
 S:'$D(PXCEPMSC) PXCEPMSC="S"
"RTN","PXCEVFI4",89,0)
 ;Diagnosis narrative
"RTN","PXCEVFI4",90,0)
 D  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVFI4",91,0)
 . N DIR,DA
"RTN","PXCEVFI4",92,0)
 . S DIR(0)="9000010.07,.04AO"
"RTN","PXCEVFI4",93,0)
 . S DIR("A")="Provider Narrative: "
"RTN","PXCEVFI4",94,0)
 . D ^DIR
"RTN","PXCEVFI4",95,0)
 S PXCEX=Y
"RTN","PXCEVFI4",96,0)
 I PXCEX="" S PXCEX=$$EXTTEXT^PXUTL1(+PXCEPOV,1,80,10,3)
"RTN","PXCEVFI4",97,0)
 W !,PXCEX
"RTN","PXCEVFI4",98,0)
 S PXCEY=$$PROVNARR^PXAPI(PXCEX,9000010.07) I +PXCEY'>0 W "??",$C(7) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVFI4",99,0)
 S PXCENARR=$P(PXCEY,"^",1)
"RTN","PXCEVFI4",100,0)
 ;Diagnosis modifier
"RTN","PXCEVFI4",101,0)
 D  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVFI4",102,0)
 . N DIR,DA
"RTN","PXCEVFI4",103,0)
 . S DIR(0)="9000010.07,.06A"
"RTN","PXCEVFI4",104,0)
 . S DIR("A")="Diagnosis Modifier: "
"RTN","PXCEVFI4",105,0)
 . D ^DIR
"RTN","PXCEVFI4",106,0)
 S PXCEMOD=$P(Y,U,2)
"RTN","PXCEVFI4",107,0)
 ;Diagnosis Service Connected, Clinical Indicators
"RTN","PXCEVFI4",108,0)
 D GET800^PXCED800
"RTN","PXCEVFI4",109,0)
 ;Set PXCENPOV to the next diagnosis in ^TMP("PXK",$J,"POV",
"RTN","PXCEVFI4",110,0)
 I $Q(^TMP("PXK",$J,"POV"))["PXK,"_$J_",POV" S PXCENPOV=+$O(^TMP("PXK",$J,"POV",""),-1)+1
"RTN","PXCEVFI4",111,0)
 E  S PXCENPOV=1
"RTN","PXCEVFI4",112,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,"IEN")=""
"RTN","PXCEVFI4",113,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,0,"BEFORE")=""
"RTN","PXCEVFI4",114,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,0,"AFTER")=PXCEPOV_"^"_PXCEPAT_"^"_PXCEVIEN_"^"_PXCENARR_"^^"_PXCEMOD_"^^^^^^"_PXCEPMSC
"RTN","PXCEVFI4",115,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,800,"BEFORE")=""
"RTN","PXCEVFI4",116,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,800,"AFTER")=PXCEDXSC
"RTN","PXCEVFI4",117,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,812,"BEFORE")=""
"RTN","PXCEVFI4",118,0)
 S ^TMP("PXK",$J,"POV",PXCENPOV,812,"AFTER")="^"_PXCEPKG_"^"_PXCESOR
"RTN","PXCEVFI4",119,0)
 Q
"RTN","PXCEVFI4",120,0)
 ;
"RTN","PXCEVFI4",121,0)
 ;
"RTN","PXCEVFI5")
0^65^B5688048
"RTN","PXCEVFI5",1,0)
PXCEVFI5 ;ISL/dee - Check to see if the encounter is a standalone and if it needs to be deleted ;3/17/04 12:24pm
"RTN","PXCEVFI5",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**14,99,124**;Aug 12, 1996
"RTN","PXCEVFI5",3,0)
 ;
"RTN","PXCEVFI5",4,0)
 Q
"RTN","PXCEVFI5",5,0)
CHECK ;Check to see if this is a standalone and if it is make sure it has
"RTN","PXCEVFI5",6,0)
 ;  a procedure or stop code.  If it does not have either then allow the
"RTN","PXCEVFI5",7,0)
 ;  user to continueing edit it or delete the encounter.
"RTN","PXCEVFI5",8,0)
 ;Also check that if there are diagnosis for the encounter that one of
"RTN","PXCEVFI5",9,0)
 ;  them is primary.
"RTN","PXCEVFI5",10,0)
 ;
"RTN","PXCEVFI5",11,0)
 ;Quit if no visit ien
"RTN","PXCEVFI5",12,0)
 I '$D(^AUPNVSIT(PXCEVIEN)) S PXCEEXIT=1 Q
"RTN","PXCEVFI5",13,0)
 N PXCEVST0,PXCEPDX,PXCEAPPT
"RTN","PXCEVFI5",14,0)
 S PXCEVST0=^AUPNVSIT(PXCEVIEN,0)
"RTN","PXCEVFI5",15,0)
 ;Quit if Historical visit
"RTN","PXCEVFI5",16,0)
 I $P(PXCEVST0,"^",7)="E" S PXCEEXIT=1 Q
"RTN","PXCEVFI5",17,0)
 ;Get primary Dx if one
"RTN","PXCEVFI5",18,0)
 I '$D(^AUPNVPOV("AD",PXCEVIEN)) S PXCEPDX=-1 ;no Dx so do not need a primary one
"RTN","PXCEVFI5",19,0)
 E  S PXCEPDX=$$PRIMVPOV^PXUTL1(PXCEVIEN)
"RTN","PXCEVFI5",20,0)
 ;Get if there is an appointment
"RTN","PXCEVFI5",21,0)
 S PXCEAPPT=$$VSTAPPT^PXUTL1(PXCEPAT,+PXCEVST0,$P(PXCEVST0,"^",22),PXCEVIEN)
"RTN","PXCEVFI5",22,0)
 ;Quit if there is an appointment and primary Dx
"RTN","PXCEVFI5",23,0)
 I PXCEPDX,PXCEAPPT S PXCEEXIT=1 Q
"RTN","PXCEVFI5",24,0)
 ;Quit if there are procedures or stop codes and a primary Dx
"RTN","PXCEVFI5",25,0)
 ;DROP PROCEDURE CHECK
"RTN","PXCEVFI5",26,0)
 S PXCEEXIT=1 Q
"RTN","PXCEVFI5",27,0)
 ;
"RTN","PXCEVFI5",28,0)
 I PXCEPDX,$D(^AUPNVCPT("AD",PXCEVIEN))!($D(^AUPNVSIT("AD",PXCEVIEN))) S PXCEEXIT=1 Q
"RTN","PXCEVFI5",29,0)
 N DIR,X,Y,PXCECNT
"RTN","PXCEVFI5",30,0)
 S DIR("B")="NO"
"RTN","PXCEVFI5",31,0)
 S DIR(0)="Y"
"RTN","PXCEVFI5",32,0)
 S PXCECNT=1
"RTN","PXCEVFI5",33,0)
 I 'PXCEPDX D
"RTN","PXCEVFI5",34,0)
 . S DIR("A",PXCECNT)="None of the diagnosis for this encounter are Primary."
"RTN","PXCEVFI5",35,0)
 . S PXCECNT=PXCECNT+1
"RTN","PXCEVFI5",36,0)
 I 'PXCEAPPT,'$D(^AUPNVCPT("AD",PXCEVIEN)),'$D(^AUPNVSIT("AD",PXCEVIEN)) D
"RTN","PXCEVFI5",37,0)
 . I $G(PXQUIT) D  Q
"RTN","PXCEVFI5",38,0)
 .. N DIR
"RTN","PXCEVFI5",39,0)
 .. S DIR(0)="FOA"
"RTN","PXCEVFI5",40,0)
 .. S DIR("A",1)="This encounter does not have a procedure, it will be DELETED."
"RTN","PXCEVFI5",41,0)
 .. S DIR("A")="Press any key to continue: "
"RTN","PXCEVFI5",42,0)
 .. D ^DIR
"RTN","PXCEVFI5",43,0)
 .. I $$DELVFILE^PXAPI("ALL",PXCEVIEN)
"RTN","PXCEVFI5",44,0)
 . S DIR("A",PXCECNT)="This encounter must have a procedure."
"RTN","PXCEVFI5",45,0)
 . S PXCECNT=PXCECNT+1
"RTN","PXCEVFI5",46,0)
 . S DIR("A",PXCECNT)="It will be deleted if a procedure is not added."
"RTN","PXCEVFI5",47,0)
 . S PXCECNT=PXCECNT+1
"RTN","PXCEVFI5",48,0)
 . S DIR("A")="Delete this encounter"
"RTN","PXCEVFI5",49,0)
 . D ^DIR
"RTN","PXCEVFI5",50,0)
 . I Y=1 D
"RTN","PXCEVFI5",51,0)
 .. I $$DELVFILE^PXAPI("ALL",PXCEVIEN)
"RTN","PXCEVFI5",52,0)
 .. S PXCEEXIT=1
"RTN","PXCEVFI5",53,0)
 . E  S PXCEEXIT=0
"RTN","PXCEVFI5",54,0)
 E  D
"RTN","PXCEVFI5",55,0)
 . S DIR("A")="Quit anyway"
"RTN","PXCEVFI5",56,0)
 . D ^DIR
"RTN","PXCEVFI5",57,0)
 . I Y=0 S PXCEEXIT=0
"RTN","PXCEVFI5",58,0)
 . E  S PXCEEXIT=1
"RTN","PXCEVFI5",59,0)
 Q
"RTN","PXCEVFI5",60,0)
 ;
"RTN","PXCEVFIL")
0^41^B38064195
"RTN","PXCEVFIL",1,0)
PXCEVFIL ;ISL/dee - Main routine to edit a visit or v-file entry ;10/15/04 11:50am
"RTN","PXCEVFIL",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**9,30,22,73,88,89,104,147,124**;Aug 12, 1996
"RTN","PXCEVFIL",3,0)
 ;
"RTN","PXCEVFIL",4,0)
 Q
"RTN","PXCEVFIL",5,0)
EN(PXCECAT) ; -- main entry point for PXCE pxcecat EDIT
"RTN","PXCEVFIL",6,0)
 I PXCECAT="SIT"!(PXCECAT="HIST") D PATINFO^PXCEPAT(.PXCEPAT) Q:$D(DIRUT)
"RTN","PXCEVFIL",7,0)
 I PXCECAT'="SIT",PXCECAT'="APPM",PXCECAT'="HIST" Q:'$D(PXCEFIEN)!'$D(PXCEVIEN)!'$D(PXCEPAT)
"RTN","PXCEVFIL",8,0)
 E  Q:(PXCEVIEW["P"&'$D(PXCEPAT))!(PXCEVIEW["H"&'$D(PXCEHLOC))!("~H~P~"'[("~"_$P(PXCEVIEW,"^")_"~"))
"RTN","PXCEVFIL",9,0)
 I PXCECAT="CSTP",$L($T(DATE^SCDXUTL)),$$DATE^SCDXUTL(+$G(^AUPNVSIT(PXCEVIEN,0))) W !!,$C(7),"Stop Codes can not be added to encounters after "_$$FMDATE^SCDXUTL Q
"RTN","PXCEVFIL",10,0)
 N PXCEQUIT
"RTN","PXCEVFIL",11,0)
 I "~CPT~CSTP~"[PXCECAT D  Q:PXCEQUIT
"RTN","PXCEVFIL",12,0)
 . S PXCEQUIT=0
"RTN","PXCEVFIL",13,0)
 . I $P($G(^AUPNVSIT(PXCEVIEN,0)),"^",7)="E" D  Q:$G(PXCEQUIT)
"RTN","PXCEVFIL",14,0)
 .. I PXCECAT="CSTP" W !!,$C(7),"Historical Encounters cannot have Stop Codes." D WAIT^PXCEHELP S PXCEQUIT=1 Q
"RTN","PXCEVFIL",15,0)
 K PXCEQUIT
"RTN","PXCEVFIL",16,0)
 D FULL^VALM1
"RTN","PXCEVFIL",17,0)
 ;
"RTN","PXCEVFIL",18,0)
 N PXCEVFIL,PXCELOOP,PXCENOER
"RTN","PXCEVFIL",19,0)
 N PXCECODE,PXCEAUPN,PXCECATS,PXCECATT,PXCEFILE
"RTN","PXCEVFIL",20,0)
 N PXCEPSCC
"RTN","PXCEVFIL",21,0)
 S PXCECATS=$S(PXCECAT="SIT":"VST",PXCECAT="APPM":"VST",PXCECAT="HIST":"VST",PXCECAT="CSTP":"VST",1:PXCECAT)
"RTN","PXCEVFIL",22,0)
 S PXCECODE="PXCE"_$S(PXCECAT="IMM":"VIMM",1:PXCECAT)
"RTN","PXCEVFIL",23,0)
 S PXCEAUPN=$P($T(FORMAT^@PXCECODE),"~",5)
"RTN","PXCEVFIL",24,0)
 S PXCECATT=$P($P($T(FORMAT^@PXCECODE),";;",2),"~",1)
"RTN","PXCEVFIL",25,0)
 S PXCEFILE=$P($T(FORMAT^@PXCECODE),"~",2)
"RTN","PXCEVFIL",26,0)
 S PXCEQUIT=0
"RTN","PXCEVFIL",27,0)
 I '$D(PXCAAFTR),PXCECAT'="SIT",PXCECAT'="APPM",PXCECAT'="HIST",PXCEFIEN'>0 D ASK^PXCEVFI2(PXCEVIEN,.PXCEFIEN,PXCEAUPN,PXCECATT,PXCECODE)
"RTN","PXCEVFIL",28,0)
 Q:PXCEQUIT
"RTN","PXCEVFIL",29,0)
 I PXCECAT'="SIT",PXCECAT'="APPM",PXCECAT'="HIST" S PXCELOOP=+PXCEFIEN
"RTN","PXCEVFIL",30,0)
 E  S PXCELOOP=1,PXCEFIEN=PXCEVIEN
"RTN","PXCEVFIL",31,0)
 I PXCECAT="CSTP" D
"RTN","PXCEVFIL",32,0)
 . I $$VSTAPPT^PXUTL1(PXCEPAT,+^AUPNVSIT(PXCEVIEN,0),PXCEHLOC,PXCEVIEN) S PXCELOOP=0
"RTN","PXCEVFIL",33,0)
 . E  S PXCELOOP=1
"RTN","PXCEVFIL",34,0)
 I $D(PXCAAFTR) S PXCELOOP=1
"RTN","PXCEVFIL",35,0)
 F  D DOONE Q:PXCELOOP
"RTN","PXCEVFIL",36,0)
 K PXCEFIEN
"RTN","PXCEVFIL",37,0)
 Q
"RTN","PXCEVFIL",38,0)
 ;
"RTN","PXCEVFIL",39,0)
DOONE ;
"RTN","PXCEVFIL",40,0)
 N PXCEUP,PXELAP
"RTN","PXCEVFIL",41,0)
 N PXCEAFTR
"RTN","PXCEVFIL",42,0)
 D INIT
"RTN","PXCEVFIL",43,0)
 Q:PXCEQUIT
"RTN","PXCEVFIL",44,0)
DOONE2 ;
"RTN","PXCEVFIL",45,0)
 K PXKERROR
"RTN","PXCEVFIL",46,0)
 S PXCENOER=0
"RTN","PXCEVFIL",47,0)
 D EDIT^PXCEVFI1
"RTN","PXCEVFIL",48,0)
 I ($P(PXCEAFTR(0),"^")]"") D
"RTN","PXCEVFIL",49,0)
 . I PXCEQUIT D
"RTN","PXCEVFIL",50,0)
 .. I 'PXCEFIEN,PXCECAT="CPT" D
"RTN","PXCEVFIL",51,0)
 ... D REMOVE(^TMP("PXK",$J,PXCECAT,1,"IEN"))
"RTN","PXCEVFIL",52,0)
 .. I 'PXCENOER D
"RTN","PXCEVFIL",53,0)
 ... I PXCEFIEN>0 D
"RTN","PXCEVFIL",54,0)
 .... D:PXCECAT="CPT" MODUPD
"RTN","PXCEVFIL",55,0)
 .... W !,$C(7),"The last entry did not have all of the required data and NOTHING was CHANGED."
"RTN","PXCEVFIL",56,0)
 ... E  W !,$C(7),"The last entry did not have all of the required data and NOTHING was STORED."
"RTN","PXCEVFIL",57,0)
 ... D WAIT^PXCEHELP
"RTN","PXCEVFIL",58,0)
 . E  D SAVE^PXCEVFI2
"RTN","PXCEVFIL",59,0)
 D EXIT
"RTN","PXCEVFIL",60,0)
 Q
"RTN","PXCEVFIL",61,0)
 ;
"RTN","PXCEVFIL",62,0)
INIT ; -- init variables and list array
"RTN","PXCEVFIL",63,0)
 N PXCENODS,PXCEFOR,PXCENODE
"RTN","PXCEVFIL",64,0)
 K ^TMP("PXK",$J),PXCEAFTR
"RTN","PXCEVFIL",65,0)
 S ^TMP("PXK",$J,"SOR")=PXCESOR
"RTN","PXCEVFIL",66,0)
 S ^TMP("PXK",$J,"VST",1,"IEN")=PXCEVIEN
"RTN","PXCEVFIL",67,0)
 I PXCECAT="SIT"!(PXCECAT="APPM")!(PXCECAT="HIST") D
"RTN","PXCEVFIL",68,0)
 . I PXCEVIEN>0 L +@(PXCEAUPN_"(PXCEVIEN)"):5 E  W !!,$C(7),"Cannot edit at this time, try again later." D PAUSE^PXCEHELP S PXCEQUIT=1 Q
"RTN","PXCEVFIL",69,0)
 . F PXCENODE=0,21,150,800,811,812 D
"RTN","PXCEVFIL",70,0)
 .. S PXCEAFTR(PXCENODE)=$S(PXCEVIEN>0:$G(^AUPNVSIT(PXCEVIEN,PXCENODE)),1:"")
"RTN","PXCEVFIL",71,0)
 .. S ^TMP("PXK",$J,"VST",1,PXCENODE,"BEFORE")=PXCEAFTR(PXCENODE)
"RTN","PXCEVFIL",72,0)
 E  D
"RTN","PXCEVFIL",73,0)
 . I PXCEFIEN>0 L +@(PXCEAUPN_"(PXCEFIEN)"):5 E  W !!,$C(7),"Cannot edit at this time, try again later." D PAUSE^PXCEHELP S PXCEQUIT=1 Q
"RTN","PXCEVFIL",74,0)
 . F PXCENODE=0,21,150,800,811,812 D
"RTN","PXCEVFIL",75,0)
 .. S ^TMP("PXK",$J,"VST",1,PXCENODE,"BEFORE")=$G(^AUPNVSIT(+PXCEVIEN,PXCENODE))
"RTN","PXCEVFIL",76,0)
 .. S ^TMP("PXK",$J,"VST",1,PXCENODE,"AFTER")=^TMP("PXK",$J,"VST",1,PXCENODE,"BEFORE")
"RTN","PXCEVFIL",77,0)
 . ;
"RTN","PXCEVFIL",78,0)
 . S ^TMP("PXK",$J,PXCECATS,1,"IEN")=PXCEFIEN
"RTN","PXCEVFIL",79,0)
 . S PXCENODS=$P($T(FORMAT^@PXCECODE),"~",3)
"RTN","PXCEVFIL",80,0)
 . F PXCEFOR=1:1 S PXCENODE=$P(PXCENODS,",",PXCEFOR) Q:PXCENODE']""  D
"RTN","PXCEVFIL",81,0)
 .. I PXCEFIEN>0 D
"RTN","PXCEVFIL",82,0)
 ... I PXCECAT="CPT",PXCENODE=1 D
"RTN","PXCEVFIL",83,0)
 .... ;Retrieve CPT Modifiers from multiple field
"RTN","PXCEVFIL",84,0)
 .... S PXCESEQ=0
"RTN","PXCEVFIL",85,0)
 .... F  S PXCESEQ=$O(@(PXCEAUPN_"(PXCEFIEN,PXCENODE,PXCESEQ)")) Q:'PXCESEQ  D
"RTN","PXCEVFIL",86,0)
 ..... S ^TMP("PXK",$J,PXCECATS,1,PXCENODE,PXCESEQ,"BEFORE")=$G(@(PXCEAUPN_"(PXCEFIEN,PXCENODE,PXCESEQ,0)"))
"RTN","PXCEVFIL",87,0)
 ..... S PXCEAFTR(PXCENODE,PXCESEQ)=^TMP("PXK",$J,PXCECATS,1,PXCENODE,PXCESEQ,"BEFORE")
"RTN","PXCEVFIL",88,0)
 ... E  D
"RTN","PXCEVFIL",89,0)
 .... S ^TMP("PXK",$J,PXCECATS,1,PXCENODE,"BEFORE")=$G(@(PXCEAUPN_"(PXCEFIEN,PXCENODE)"))
"RTN","PXCEVFIL",90,0)
 .... S PXCEAFTR(PXCENODE)=^TMP("PXK",$J,PXCECATS,1,PXCENODE,"BEFORE")
"RTN","PXCEVFIL",91,0)
 .. E  D
"RTN","PXCEVFIL",92,0)
 ... I PXCECAT="CPT",PXCENODE=1 D  Q
"RTN","PXCEVFIL",93,0)
 .... S ^TMP("PXK",$J,PXCECATS,1,PXCENODE,1,"BEFORE")=""
"RTN","PXCEVFIL",94,0)
 ... S ^TMP("PXK",$J,PXCECATS,1,PXCENODE,"BEFORE")=""
"RTN","PXCEVFIL",95,0)
 ... S PXCEAFTR(PXCENODE)=^TMP("PXK",$J,PXCECATS,1,PXCENODE,"BEFORE")
"RTN","PXCEVFIL",96,0)
 Q:PXCEQUIT
"RTN","PXCEVFIL",97,0)
 ;
"RTN","PXCEVFIL",98,0)
 I PXCEAUPN'="^AUPNVSIT" D
"RTN","PXCEVFIL",99,0)
 . ;Set the Patient and Visit pointers in the V-File.
"RTN","PXCEVFIL",100,0)
 . S:'$P(PXCEAFTR(0),"^",2) $P(PXCEAFTR(0),"^",2)=PXCEPAT
"RTN","PXCEVFIL",101,0)
 . S:'$P(PXCEAFTR(0),"^",3) $P(PXCEAFTR(0),"^",3)=PXCEVIEN
"RTN","PXCEVFIL",102,0)
 . I $P(PXCEAFTR(0),"^",1)="" D
"RTN","PXCEVFIL",103,0)
 .. S:'$P(PXCEAFTR(812),"^",2) $P(PXCEAFTR(812),"^",2)=PXCEPKG
"RTN","PXCEVFIL",104,0)
 .. S:'$P(PXCEAFTR(812),"^",3) $P(PXCEAFTR(812),"^",3)=PXCESOR
"RTN","PXCEVFIL",105,0)
 E  D
"RTN","PXCEVFIL",106,0)
 . ;If new visit set package and source.
"RTN","PXCEVFIL",107,0)
 . I $P(PXCEAFTR(0),"^",1)="" D
"RTN","PXCEVFIL",108,0)
 .. S:'$P(PXCEAFTR(812),"^",2) $P(PXCEAFTR(812),"^",2)=PXCEPKG
"RTN","PXCEVFIL",109,0)
 .. S:'$P(PXCEAFTR(812),"^",3) $P(PXCEAFTR(812),"^",3)=PXCESOR
"RTN","PXCEVFIL",110,0)
 . ;Set the Patient in the Visit for new visit.
"RTN","PXCEVFIL",111,0)
 . I $G(PXCEAPDT)>0 D
"RTN","PXCEVFIL",112,0)
 .. S:'$P(PXCEAFTR(0),"^",1) $P(PXCEAFTR(0),"^",1)=PXCEAPDT
"RTN","PXCEVFIL",113,0)
 .. I '$P(PXCEAFTR(0),"^",21) D
"RTN","PXCEVFIL",114,0)
 ... ;Get the ELIGIBILITY for the appointment
"RTN","PXCEVFIL",115,0)
 ... N PXCEELIG
"RTN","PXCEVFIL",116,0)
 ... S PXCEELIG=$$ELIGIBIL^PXCEVSIT(PXCEPAT,PXCEHLOC,PXCEAPDT)
"RTN","PXCEVFIL",117,0)
 ... S:PXCEELIG>0 $P(PXCEAFTR(0),"^",21)=PXCEELIG
"RTN","PXCEVFIL",118,0)
 . S:'$P(PXCEAFTR(0),"^",5)&($G(PXCEPAT)>0) $P(PXCEAFTR(0),"^",5)=PXCEPAT
"RTN","PXCEVFIL",119,0)
 . S:'$P(PXCEAFTR(0),"^",22)&($G(PXCEHLOC)>0) $P(PXCEAFTR(0),"^",22)=PXCEHLOC
"RTN","PXCEVFIL",120,0)
 Q
"RTN","PXCEVFIL",121,0)
 ;
"RTN","PXCEVFIL",122,0)
EXIT ; -- exit code
"RTN","PXCEVFIL",123,0)
 I PXCECAT="SIT"!(PXCECAT="APPM")!(PXCECAT="HIST") L:PXCEVIEN>0 -@(PXCEAUPN_"(PXCEVIEN)"):30
"RTN","PXCEVFIL",124,0)
 E  L:PXCEFIEN>0 -@(PXCEAUPN_"(PXCEFIEN)"):30
"RTN","PXCEVFIL",125,0)
 S PXCEFIEN=""
"RTN","PXCEVFIL",126,0)
 K ^TMP("PXK",$J)
"RTN","PXCEVFIL",127,0)
 K PXCEAFTR
"RTN","PXCEVFIL",128,0)
 S PXCEQUIT=0
"RTN","PXCEVFIL",129,0)
 Q
"RTN","PXCEVFIL",130,0)
 ;
"RTN","PXCEVFIL",131,0)
MODUPD ;Update the MODIFIER list for the currently edited CPT code when all
"RTN","PXCEVFIL",132,0)
 ;the reqired data is not entered.
"RTN","PXCEVFIL",133,0)
 ;
"RTN","PXCEVFIL",134,0)
 N SQ,DA,DIC,DIK,X
"RTN","PXCEVFIL",135,0)
 S SQ=""
"RTN","PXCEVFIL",136,0)
 F  S SQ=$O(PXCEAFTR(1,SQ)) Q:'SQ  D
"RTN","PXCEVFIL",137,0)
 .S DA(1)=PXCEFIEN,DA=SQ
"RTN","PXCEVFIL",138,0)
 .S DIK="^AUPNVCPT("_DA(1)_","_1_","
"RTN","PXCEVFIL",139,0)
 .D ^DIK
"RTN","PXCEVFIL",140,0)
 F  S SQ=$O(^TMP("PXK",$J,"CPT",1,1,SQ)) Q:'SQ  D
"RTN","PXCEVFIL",141,0)
 .S X=^TMP("PXK",$J,"CPT",1,1,SQ,"BEFORE")
"RTN","PXCEVFIL",142,0)
 .Q:X']""
"RTN","PXCEVFIL",143,0)
 .K DD,DO
"RTN","PXCEVFIL",144,0)
 .S DA(1)=PXCEFIEN
"RTN","PXCEVFIL",145,0)
 .S DIC="^AUPNVCPT("_DA(1)_","_1_","
"RTN","PXCEVFIL",146,0)
 .S DIC(0)="L",DIC("P")=$P(^DD(9000010.18,1,0),"^",2)
"RTN","PXCEVFIL",147,0)
 .D FILE^DICN
"RTN","PXCEVFIL",148,0)
 Q
"RTN","PXCEVFIL",149,0)
 ;
"RTN","PXCEVFIL",150,0)
REMOVE(DA) ;REMOVE INCOMPLETE CPT ENTRY
"RTN","PXCEVFIL",151,0)
 N DIK
"RTN","PXCEVFIL",152,0)
 S DIK="^AUPNVCPT("
"RTN","PXCEVFIL",153,0)
 I $G(DA) D ^DIK ;PX*1*124
"RTN","PXCEVFIL",154,0)
 Q
"RTN","PXCEVIMM")
0^44^B27090719
"RTN","PXCEVIMM",1,0)
PXCEVIMM ;ISL/dee - Used to edit and display V IMMUNIZATION ;3/11/04 3:00pm
"RTN","PXCEVIMM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**27,124**;Aug 12, 1996
"RTN","PXCEVIMM",3,0)
 ;; ;
"RTN","PXCEVIMM",4,0)
 Q
"RTN","PXCEVIMM",5,0)
 ;
"RTN","PXCEVIMM",6,0)
 ;Line with the line label "FORMAT"
"RTN","PXCEVIMM",7,0)
 ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (1=yes, 0=no)~File global name
"RTN","PXCEVIMM",8,0)
 ;     1         2             3                   4                                   5
"RTN","PXCEVIMM",9,0)
 ;
"RTN","PXCEVIMM",10,0)
 ;Followning lines:
"RTN","PXCEVIMM",11,0)
 ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCEVIMM",12,0)
 ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~       10
"RTN","PXCEVIMM",13,0)
 ;The Display & Edit routines are for special caces.
"RTN","PXCEVIMM",14,0)
 ;  (The .01 field cannot have a special edit.)
"RTN","PXCEVIMM",15,0)
 ;
"RTN","PXCEVIMM",16,0)
FORMAT ;;Immunization~9000010.11~0,11,12,811,812~0~^AUPNVIMM
"RTN","PXCEVIMM",17,0)
 ;;0~1~.01~Immunization:  ~Immunization:  ~~~~~B
"RTN","PXCEVIMM",18,0)
 ;;12~4~1204~Encounter Provider:  ~Encounter Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCEVIMM",19,0)
 ;;0~4~.04~Series:  ~Series:  ~~~~~D
"RTN","PXCEVIMM",20,0)
 ;;0~6~.06~Reaction:  ~Reaction:  ~~~~~D
"RTN","PXCEVIMM",21,0)
 ;;0~7~.07~Repeat Contraindicated:  ~Repeat Contraindicated:  ~~ECONTRAI^PXCEVIMM~~~D
"RTN","PXCEVIMM",22,0)
 ;;12~1~1201~Administered Date and (optional) Time~Administered Date and Time:  ~~E1201^PXCEPOV1(0,30,30)~~~D
"RTN","PXCEVIMM",23,0)
 ;;811~1~81101~Comments:  ~Comments:  ~~~~~D
"RTN","PXCEVIMM",24,0)
 ;;0~8~.08~Diagnosis:  ~Diagnosis:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",25,0)
 ;;0~9~.09~Diagnosis 2:  ~Diagnosis 2:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",26,0)
 ;;0~10~.1~Diagnosis 3:  ~Diagnosis 3:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",27,0)
 ;;0~11~.11~Diagnosis 4:  ~Diagnosis 4:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",28,0)
 ;;0~12~.12~Diagnosis 5:  ~Diagnosis 5:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",29,0)
 ;;0~13~.13~Diagnosis 6:  ~Diagnosis 6:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",30,0)
 ;;0~14~.14~Diagnosis 7:  ~Diagnosis 7:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",31,0)
 ;;0~15~.15~Diagnosis 8:  ~Diagnosis 8:  ~$$DISPLY01^PXCEPOV~EPOV^PXCEVIMM~~~
"RTN","PXCEVIMM",32,0)
 ;;
"RTN","PXCEVIMM",33,0)
 ;
"RTN","PXCEVIMM",34,0)
 ;Cannot ask work processing
"RTN","PXCEVIMM",35,0)
 ;;12~2~1202~Ordering Provider:  ~Ordering Provider:  ~~EPROV12^PXCEPRV~~~D
"RTN","PXCEVIMM",36,0)
 ;
"RTN","PXCEVIMM",37,0)
 ;The interface for AICS to get list on form for help.
"RTN","PXCEVIMM",38,0)
INTRFACE ;;PX SELECT IMMUNIZATIONS
"RTN","PXCEVIMM",39,0)
 ;
"RTN","PXCEVIMM",40,0)
 ;********************************
"RTN","PXCEVIMM",41,0)
 ;Special cases for display.
"RTN","PXCEVIMM",42,0)
 ;
"RTN","PXCEVIMM",43,0)
 ;********************************
"RTN","PXCEVIMM",44,0)
 ;Special cases for edit.
"RTN","PXCEVIMM",45,0)
 ;
"RTN","PXCEVIMM",46,0)
ECONTRAI ;
"RTN","PXCEVIMM",47,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEVIMM",48,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVIMM",49,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVIMM",50,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVIMM",51,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVIMM",52,0)
 E  S DIR("B")="NO"
"RTN","PXCEVIMM",53,0)
 S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCEVIMM",54,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVIMM",55,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVIMM",56,0)
 D ^DIR
"RTN","PXCEVIMM",57,0)
 K DIR,DA
"RTN","PXCEVIMM",58,0)
 I X="@" S Y="@"
"RTN","PXCEVIMM",59,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCEVIMM",60,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEVIMM",61,0)
 Q
"RTN","PXCEVIMM",62,0)
 ;
"RTN","PXCEVIMM",63,0)
ELOT ;
"RTN","PXCEVIMM",64,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEVIMM",65,0)
 . N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVIMM",66,0)
 . S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVIMM",67,0)
 . S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVIMM",68,0)
 . S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVIMM",69,0)
 S DIR(0)="PAO^9999999.41:EM^K:$P(^(0),U,3)'=0!($P(^(0),U,4)'=$P(PXCEAFTR(0),U,1)) X"
"RTN","PXCEVIMM",70,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVIMM",71,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVIMM",72,0)
 D ^DIR
"RTN","PXCEVIMM",73,0)
 K DIR,DA
"RTN","PXCEVIMM",74,0)
 I X="@" S Y="@"
"RTN","PXCEVIMM",75,0)
 E  I $D(DTOUT)!$D(DUOUT) S PXCEEND=1 Q
"RTN","PXCEVIMM",76,0)
 S:Y'<0 $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEVIMM",77,0)
 Q
"RTN","PXCEVIMM",78,0)
 ;
"RTN","PXCEVIMM",79,0)
 ;
"RTN","PXCEVIMM",80,0)
EPOV ;Edit the Associated DX
"RTN","PXCEVIMM",81,0)
 I $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))'="" D
"RTN","PXCEVIMM",82,0)
 .N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVIMM",83,0)
 .S PXCEINT=$P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))
"RTN","PXCEVIMM",84,0)
 .S PXCEEXT=$$EXTERNAL^DILFD(PXCEFILE,$P(PXCETEXT,"~",3),"",PXCEINT,"PXCEDILF")
"RTN","PXCEVIMM",85,0)
 .S DIR("B")=$S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVIMM",86,0)
 S DIR(0)=PXCEFILE_","_$P(PXCETEXT,"~",3)_"A"
"RTN","PXCEVIMM",87,0)
 S DIR("A")=$P(PXCETEXT,"~",4)
"RTN","PXCEVIMM",88,0)
 S:$P(PXCETEXT,"~",8)]"" DIR("?")=$P(PXCETEXT,"~",8)
"RTN","PXCEVIMM",89,0)
 D ^DIR
"RTN","PXCEVIMM",90,0)
 K DIR,DA
"RTN","PXCEVIMM",91,0)
 I X="@" S Y="@" S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^") Q
"RTN","PXCEVIMM",92,0)
 I $D(DTOUT)!$D(DUOUT) S PXCEEND=1,PXCEQUIT=1 Q
"RTN","PXCEVIMM",93,0)
 I '+Y S PXCEEND=1 Q  ;S:$P(PXCETEXT,"~",3)=".08" PXCEQUIT=1 Q
"RTN","PXCEVIMM",94,0)
 ;See if this diagnosis is in the PXCEAFTR(0)
"RTN","PXCEVIMM",95,0)
 I $P(PXCETEXT,"~",2)'=8,(+Y=$P($G(PXCEAFTR(0)),"^",8)) S PXCEEND=1
"RTN","PXCEVIMM",96,0)
 I $P(PXCETEXT,"~",2)'=9,(+Y=$P($G(PXCEAFTR(0)),"^",9)) S PXCEEND=1
"RTN","PXCEVIMM",97,0)
 I $P(PXCETEXT,"~",2)'=10,(+Y=$P($G(PXCEAFTR(0)),"^",10)) S PXCEEND=1
"RTN","PXCEVIMM",98,0)
 I $P(PXCETEXT,"~",2)'=11,(+Y=$P($G(PXCEAFTR(0)),"^",11)) S PXCEEND=1
"RTN","PXCEVIMM",99,0)
 I $P(PXCETEXT,"~",2)'=12,(+Y=$P($G(PXCEAFTR(0)),"^",12)) S PXCEEND=1
"RTN","PXCEVIMM",100,0)
 I $P(PXCETEXT,"~",2)'=13,(+Y=$P($G(PXCEAFTR(0)),"^",13)) S PXCEEND=1
"RTN","PXCEVIMM",101,0)
 I $P(PXCETEXT,"~",2)'=14,(+Y=$P($G(PXCEAFTR(0)),"^",14)) S PXCEEND=1
"RTN","PXCEVIMM",102,0)
 I $P(PXCETEXT,"~",2)'=15,(+Y=$P($G(PXCEAFTR(0)),"^",15)) S PXCEEND=1
"RTN","PXCEVIMM",103,0)
 I PXCEEND=1 W !,$C(7),"Duplicate Diagnosis on this CPT code is not allowed." D WAIT^PXCEHELP Q
"RTN","PXCEVIMM",104,0)
 S $P(PXCEAFTR($P(PXCETEXT,"~",1)),"^",$P(PXCETEXT,"~",2))=$P(Y,"^")
"RTN","PXCEVIMM",105,0)
 D:+Y>0 DIAGNOS^PXCEVFI4(+Y)
"RTN","PXCEVIMM",106,0)
 Q
"RTN","PXCEVIMM",107,0)
 ;
"RTN","PXCEVIMM",108,0)
 ;********************************
"RTN","PXCEVIMM",109,0)
 ;Display text for the .01 field which is a pointer to Immunization.
"RTN","PXCEVIMM",110,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCEVIMM",111,0)
DISPLY01(PXCEIMM) ;
"RTN","PXCEVIMM",112,0)
 N DIERR,PXCEDILF,PXCEINT,PXCEEXT
"RTN","PXCEVIMM",113,0)
 S PXCEINT=$P(PXCEIMM,"^",1)
"RTN","PXCEVIMM",114,0)
 S PXCEEXT=$$EXTERNAL^DILFD(9000010.11,.01,"",PXCEINT,"PXCEDILF")
"RTN","PXCEVIMM",115,0)
 Q $S('$D(DIERR):PXCEEXT,1:PXCEINT)
"RTN","PXCEVIMM",116,0)
 ;
"RTN","PXCEVST")
0^61^B6324177
"RTN","PXCEVST",1,0)
PXCEVST ;ISL/dee,ISA/KWP - Used to edit a visit and display a visit ;04/8/99
"RTN","PXCEVST",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,74,111,130,124**;Aug 12, 1996
"RTN","PXCEVST",3,0)
 ;; ;
"RTN","PXCEVST",4,0)
 Q
"RTN","PXCEVST",5,0)
 ;
"RTN","PXCEVST",6,0)
 ;Line with the line label "FORMAT"
"RTN","PXCEVST",7,0)
 ;;Long name~File Number~Node Subscripts~Allow Duplicate entries (not used on visit)~File global name
"RTN","PXCEVST",8,0)
 ;     1         2             3                   4                                        5
"RTN","PXCEVST",9,0)
 ;
"RTN","PXCEVST",10,0)
 ;Following lines:
"RTN","PXCEVST",11,0)
 ;;Node~Piece~,Field Number~Edit Label~Display Label~Display Routine~Edit Routine~Help Text for DIR("?")~Set of PXCEKEYS that can Edit~D if Detail Display Only~
"RTN","PXCEVST",12,0)
 ;  1  ~  2  ~      3      ~     4    ~        5    ~        6      ~     7      ~       8              ~          9                  ~       10
"RTN","PXCEVST",13,0)
 ;The Display & Edit routines are for special cases.
"RTN","PXCEVST",14,0)
 ;
"RTN","PXCEVST",15,0)
FORMAT ;;Encounter~9000010~0,21,150,800,811,812~~^AUPNVSIT
"RTN","PXCEVST",16,0)
 ;;0~1~.01~Encounter Date and Time:  ~Encounter Date and Time:  ~~EVISITDT^PXCEVSIT(1)~~~B
"RTN","PXCEVST",17,0)
 ;;0~18~.18~Check Out ~Check Out Date and Time:  ~~ECODT^PXCEVSIT~~~D
"RTN","PXCEVST",18,0)
 ;;800~1~80001~Service Connected:  ~Service Connected:  ~~GET800^PXCEE800~~~D
"RTN","PXCEVST",19,0)
 ;;800~7~80007~Combat Veteran:  ~Combat Veteran:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEVST",20,0)
 ;;800~2~80002~Agent Orange Exposure:  ~Agent Orange Exposure:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEVST",21,0)
 ;;800~3~80003~Ionizing Radiation Exposure:  ~Ionizing Radiation Exposure:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEVST",22,0)
 ;;800~4~80004~Environmental Contaminants:  ~Environmental Contaminants:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEVST",23,0)
 ;;800~5~80005~Military Sexual Trauma:  ~Military Sexual Trauma:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEVST",24,0)
 ;;800~6~80006~Head and/or Neck Cancer:  ~Head and/or Neck Cancer:  ~~SKIP^PXCEVSIT~~~D
"RTN","PXCEVST",25,0)
 ;
"RTN","PXCEVST",26,0)
 ;
"RTN","PXCEVST",27,0)
 ;
"RTN","PXCEVST",28,0)
 ;********************************
"RTN","PXCEVST",29,0)
 ;Special cases for display of visit are in PXCEVSIT.
"RTN","PXCEVST",30,0)
 ;
"RTN","PXCEVST",31,0)
 ;********************************
"RTN","PXCEVST",32,0)
 ;Special cases for edit of visit are in PXCEVSIT.
"RTN","PXCEVST",33,0)
 ;
"RTN","PXCEVST",34,0)
 ;********************************
"RTN","PXCEVST",35,0)
 ;Display text for the .01 field which is a Date and Time.
"RTN","PXCEVST",36,0)
 ;(Must have is called by ASK^PXCEVFI2 and DEL^PXCEVFI2.)
"RTN","PXCEVST",37,0)
DISPLY01(PXCEVSIT) ;
"RTN","PXCEVST",38,0)
 Q $$DISPLY01^PXCESIT(PXCEVSIT)
"RTN","PXCEVST",39,0)
 ;
"RTN","PXKFCPT")
0^16^B3210816
"RTN","PXKFCPT",1,0)
PXKFCPT ;ISL/JVS - Fields for v cpt file ;3/22/05 11:48am
"RTN","PXKFCPT",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,73,117,124**;Aug 12, 1996
"RTN","PXKFCPT",3,0)
 ;
"RTN","PXKFCPT",4,0)
 ; PX*1*117; added piece ,4, on '0' label as a required one
"RTN","PXKFCPT",5,0)
 ;  Adding or Editing of data in a particular field can be controlled
"RTN","PXKFCPT",6,0)
 ;by adding a ~ as a delimiter and the letters A and/or E to the
"RTN","PXKFCPT",7,0)
 ;end of the line of text which represents what could be added
"RTN","PXKFCPT",8,0)
 ;to the DR string in a DIE call.
"RTN","PXKFCPT",9,0)
 ; 1. If none or all three(~AE) of these characters are added then
"RTN","PXKFCPT",10,0)
 ;    the data in this field can be either added or edited.
"RTN","PXKFCPT",11,0)
 ; 2. If only the ~ is added then the data in this field can be
"RTN","PXKFCPT",12,0)
 ;    neither added or edited.
"RTN","PXKFCPT",13,0)
 ; 3. IF only the ~A is added then the data can only be added to
"RTN","PXKFCPT",14,0)
 ;    the file for this field but not edited.
"RTN","PXKFCPT",15,0)
 ; 4. If only the ~E is added the the data can only be edited in
"RTN","PXKFCPT",16,0)
 ;    this file for this field. (not a likely possibility)
"RTN","PXKFCPT",17,0)
 ;
"RTN","PXKFCPT",18,0)
 ; The word "OPTION" in front of the line of text below tells the 
"RTN","PXKFCPT",19,0)
 ;software to determine,based on the data, the appropriateness
"RTN","PXKFCPT",20,0)
 ;of using either a "///" or "////" stuff in a DIE call.
"RTN","PXKFCPT",21,0)
 ;
"RTN","PXKFCPT",22,0)
 ; The information on line tag 0 $P(,," * ",1) are the piece numbers
"RTN","PXKFCPT",23,0)
 ;of the fields on the zero node that are required by the data
"RTN","PXKFCPT",24,0)
 ;dictionary and are checked for to determine if enough data is present
"RTN","PXKFCPT",25,0)
 ;to proceed without any errors. $P(,," * ",2) are the nodes and
"RTN","PXKFCPT",26,0)
 ;piece numbers of the fields used to determine duplicates in the
"RTN","PXKFCPT",27,0)
 ;file (node+piece (eg. 12+4)). $P(,," * ",3) is a flag use to
"RTN","PXKFCPT",28,0)
 ;determine if duplicates are allowed in this visit file. 
"RTN","PXKFCPT",29,0)
 ;If it is set to 0 then no duplicate checks will occur. If it is
"RTN","PXKFCPT",30,0)
 ;set to 1 then the file will be checked for duplicates based on
"RTN","PXKFCPT",31,0)
 ;the information in $P 2.
"RTN","PXKFCPT",32,0)
 ;
"RTN","PXKFCPT",33,0)
 ; The following is the file's global name.  Each global must have a
"RTN","PXKFCPT",34,0)
 ;unique name and can not have any subscripts as part of the global root.
"RTN","PXKFCPT",35,0)
GLOBAL ;;^AUPNVCPT
"RTN","PXKFCPT",36,0)
 ;
"RTN","PXKFCPT",37,0)
EN1 ;
"RTN","PXKFCPT",38,0)
 S PXKER=""
"RTN","PXKFCPT",39,0)
 S PXKER=$P($T(@PXKNOD+PXKPCE),";;",2)
"RTN","PXKFCPT",40,0)
 Q
"RTN","PXKFCPT",41,0)
EN2 ;
"RTN","PXKFCPT",42,0)
 S PXKFD=""
"RTN","PXKFCPT",43,0)
 S PXKFD=$P($T(@PXKNOD+PXKPCE),";;",2) D
"RTN","PXKFCPT",44,0)
 .I PXKFD="" S PXKPCE=PXKPCE+1 D EN2
"RTN","PXKFCPT",45,0)
 Q
"RTN","PXKFCPT",46,0)
ADD ;Add an entry to the file
"RTN","PXKFCPT",47,0)
 Q
"RTN","PXKFCPT",48,0)
0 ;;1,2,3,4,16 * 0+1,0+4,0+16,12+4 * 1
"RTN","PXKFCPT",49,0)
 ;;.01////^S X=$G(
"RTN","PXKFCPT",50,0)
 ;;.02////^S X=$G(
"RTN","PXKFCPT",51,0)
 ;;.03////^S X=$G(
"RTN","PXKFCPT",52,0)
 ;;OPTION * .04////^S X=$G( * .04///^S X=$G(
"RTN","PXKFCPT",53,0)
 ;;.05////^S X=$G(
"RTN","PXKFCPT",54,0)
 ;;
"RTN","PXKFCPT",55,0)
 ;;.07///^S X=$G(
"RTN","PXKFCPT",56,0)
 ;;
"RTN","PXKFCPT",57,0)
 ;;.09////^S X=$G(
"RTN","PXKFCPT",58,0)
 ;;.1////^S X=$G(
"RTN","PXKFCPT",59,0)
 ;;.11////^S X=$G(
"RTN","PXKFCPT",60,0)
 ;;.12////^S X=$G(
"RTN","PXKFCPT",61,0)
 ;;.13////^S X=$G(
"RTN","PXKFCPT",62,0)
 ;;.14////^S X=$G(
"RTN","PXKFCPT",63,0)
 ;;.15////^S X=$G(
"RTN","PXKFCPT",64,0)
 ;;.16////^S X=$G(
"RTN","PXKFCPT",65,0)
 ;;.17////^S X=$G(
"RTN","PXKFCPT",66,0)
1 ;;
"RTN","PXKFCPT",67,0)
 ;;.01///^S X=$G(
"RTN","PXKFCPT",68,0)
12 ;;
"RTN","PXKFCPT",69,0)
 ;;1201////^S X=$G(
"RTN","PXKFCPT",70,0)
 ;;1202////^S X=$G(
"RTN","PXKFCPT",71,0)
 ;;
"RTN","PXKFCPT",72,0)
 ;;1204////^S X=$G(
"RTN","PXKFCPT",73,0)
801 ;;
"RTN","PXKFCPT",74,0)
 ;;80101///^S X=1;
"RTN","PXKFCPT",75,0)
 ;;80102///^S X=$G(PXKAUDIT);
"RTN","PXKFCPT",76,0)
802 ;;
"RTN","PXKFCPT",77,0)
 ;;OPTION * 80201////^S X=$G( * 80201///^S X=$G(
"RTN","PXKFCPT",78,0)
811 ;;
"RTN","PXKFCPT",79,0)
 ;;81101///^S X=$G(
"RTN","PXKFCPT",80,0)
812 ;;
"RTN","PXKFCPT",81,0)
 ;;81201///^S X=$G(
"RTN","PXKFCPT",82,0)
 ;;81202////^S X=$G(
"RTN","PXKFCPT",83,0)
 ;;81203////^S X=$G(
"RTN","PXKFCPT1")
0^43^B22284185
"RTN","PXKFCPT1",1,0)
PXKFCPT1 ;ISL/JVS - PROCEDURES Routine #2 ;2/11/04 4:18pm
"RTN","PXKFCPT1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,124**;Aug 12, 1996
"RTN","PXKFCPT1",3,0)
 ;
"RTN","PXKFCPT1",4,0)
 ;
"RTN","PXKFCPT1",5,0)
IMM ;
"RTN","PXKFCPT1",6,0)
 N PXKSEQ1
"RTN","PXKFCPT1",7,0)
 I PXKFGAD=1 D IMMADD
"RTN","PXKFCPT1",8,0)
 I PXKFGDE=1 D IMMDEL
"RTN","PXKFCPT1",9,0)
 Q
"RTN","PXKFCPT1",10,0)
IMMADD ;
"RTN","PXKFCPT1",11,0)
 S PXKKK=""
"RTN","PXKFCPT1",12,0)
 S PXKSEQ1=PXKSEQ+PXKXX
"RTN","PXKFCPT1",13,0)
 S PXKCPT=$P($P(PXKPXD(PXKX),"^",2),";")
"RTN","PXKFCPT1",14,0)
POVNAR ;
"RTN","PXKFCPT1",15,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PXKFCPT1",16,0)
 S DIC=81,DA=PXKCPT,DR=2 D EN^DIQ1
"RTN","PXKFCPT1",17,0)
 S PXKCPTN=$G(^UTILITY("DIQ1",$J,81,DA,2))
"RTN","PXKFCPT1",18,0)
 K ^UTILITY("DIQ1",$J),DIC,DA,DR D
"RTN","PXKFCPT1",19,0)
 .Q:PXKCPTN=""  I $D(^AUTNPOV("B",PXKCPTN)) S PXKCPTN=$O(^AUTNPOV("B",PXKCPTN,0))
"RTN","PXKFCPT1",20,0)
 ;
"RTN","PXKFCPT1",21,0)
QUANTIT S PXKQUN=1,PXSTOP=0
"RTN","PXKFCPT1",22,0)
 S PXXX=0
"RTN","PXKFCPT1",23,0)
 F  S PXXX=$O(^AUPNVCPT("AD",PXKAV(0,3),PXXX)) Q:PXXX=""  D  Q:$G(PXSTOP)
"RTN","PXKFCPT1",24,0)
 .I +$P(^AUPNVCPT(PXXX,0),"^")=PXKCPT D
"RTN","PXKFCPT1",25,0)
 ..S PXKQUN=($P(^AUPNVCPT(PXXX,0),"^",16)+1)
"RTN","PXKFCPT1",26,0)
 ..S PXSTOP=1
"RTN","PXKFCPT1",27,0)
 ..S PXKKK=PXXX
"RTN","PXKFCPT1",28,0)
 ..S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(PXXX,0))
"RTN","PXKFCPT1",29,0)
 K PXSTOP
"RTN","PXKFCPT1",30,0)
CATEGOR ;
"RTN","PXKFCPT1",31,0)
 N PXKSEQ2
"RTN","PXKFCPT1",32,0)
 S PXKCPTT(1)=$P(PXKCPT,"^",1)
"RTN","PXKFCPT1",33,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PXKFCPT1",34,0)
 S DIC=81,DA=PXKCPTT(1),DR=3 D EN^DIQ1
"RTN","PXKFCPT1",35,0)
 Q:$G(^UTILITY("DIQ1",$J,81,DA,3))=""
"RTN","PXKFCPT1",36,0)
 S PXKCPTT(4.1)=$G(^UTILITY("DIQ1",$J,81,DA,3))
"RTN","PXKFCPT1",37,0)
 S PXKCPTT(5)=$E(PXKCPTT(4.1),1,30)
"RTN","PXKFCPT1",38,0)
 S PXKCPTT(6)=$O(^AUTNPOV("B",PXKCPTT(5),0))
"RTN","PXKFCPT1",39,0)
 S PXKPCA=$S(PXKCPTT(6)="":PXKCPTT(5),PXKCPTT(6)'="":PXKCPTT(6),1:"")
"RTN","PXKFCPT1",40,0)
 K PXKCPTT,^UTILITY("DIQ1",$J),DIC,DR,DA
"RTN","PXKFCPT1",41,0)
 ;PX*1*124
"RTN","PXKFCPT1",42,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=$G(PXKCPT)_"^"_$G(PXKAV(0,2))_"^"_$G(PXKAV(0,3))_"^"_$G(PXKCPTN)_"^"_$G(PXKAV(0,8))_"^^^^"
"RTN","PXKFCPT1",43,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")_$G(PXKAV(0,9))_"^"_$G(PXKAV(0,10))_"^"_$G(PXKAV(0,11))_"^"_$G(PXKAV(0,12))_"^"_$G(PXKAV(0,13))_"^"_$G(PXKAV(0,14))_"^"_$G(PXKAV(0,15))_"^"_$G(PXKQUN)
"RTN","PXKFCPT1",44,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",45,0)
 F  S PXKSEQ2=$O(PXKAFT(1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",46,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"AFTER")=PXKAFT(1,PXKSEQ2)
"RTN","PXKFCPT1",47,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=$G(PXKAFT(12))
"RTN","PXKFCPT1",48,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=$G(PXKCA)
"RTN","PXKFCPT1",49,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=$G(PXKAFT(812))
"RTN","PXKFCPT1",50,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=PXKKK
"RTN","PXKFCPT1",51,0)
 K PXKQUN,PXKCPTN,PXKCA,PXXX,PXKKK
"RTN","PXKFCPT1",52,0)
 Q
"RTN","PXKFCPT1",53,0)
IMMDEL ;Retrieve all CPT information for VISIT from V CPT file
"RTN","PXKFCPT1",54,0)
 S PXKSEQ1=PXKSEQ+PXKXX
"RTN","PXKFCPT1",55,0)
 S (XPFG,XP)=0 F  Q:XPFG  S XP=$O(^AUPNVCPT("AD",PXKVST,XP)) Q:XP=""  D
"RTN","PXKFCPT1",56,0)
 .I $P(^AUPNVCPT(XP,0),"^",1)=$P($P(PXKPXD(PXKX),"^",2),";") D  S XPFG=1
"RTN","PXKFCPT1",57,0)
 ..I $P($G(^AUPNVCPT(XP,0)),"^",16)=1 D IMMDEL1
"RTN","PXKFCPT1",58,0)
 ..I $D(XP),$P($G(^AUPNVCPT(XP,0)),"^",16)>1 D IMMDEL2
"RTN","PXKFCPT1",59,0)
 Q
"RTN","PXKFCPT1",60,0)
IMMDEL1 ;
"RTN","PXKFCPT1",61,0)
 N PXKSEQ2,PXKMOD
"RTN","PXKFCPT1",62,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",63,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",64,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",65,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",66,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",67,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"BEFORE")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",68,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"BEFORE")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",69,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"BEFORE")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",70,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=XP
"RTN","PXKFCPT1",71,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")="@"
"RTN","PXKFCPT1",72,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=""
"RTN","PXKFCPT1",73,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=""
"RTN","PXKFCPT1",74,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=""
"RTN","PXKFCPT1",75,0)
 K XPFG,XP
"RTN","PXKFCPT1",76,0)
 Q
"RTN","PXKFCPT1",77,0)
IMMDEL2 ;
"RTN","PXKFCPT1",78,0)
 N PXKSEQ2,PXKMOD
"RTN","PXKFCPT1",79,0)
 S PXTEMP=$P($G(^AUPNVCPT(XP,0)),"^",16)
"RTN","PXKFCPT1",80,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",81,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",82,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",83,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",84,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",85,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"BEFORE")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",86,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"BEFORE")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",87,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"BEFORE")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",88,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=XP
"RTN","PXKFCPT1",89,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",90,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",91,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",92,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",93,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",94,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",95,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",96,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",97,0)
 S $P(^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER"),"^",16)=((PXTEMP)-(1))
"RTN","PXKFCPT1",98,0)
 K XPFG,XP,PXTEMP
"RTN","PXKFCPT1",99,0)
 Q
"RTN","PXKFCPT1",100,0)
SK ;--START OF SKIN TEST
"RTN","PXKFCPT1",101,0)
 D IMM
"RTN","PXKFCPT1",102,0)
 Q
"RTN","PXKFIMM")
0^47^B2638532
"RTN","PXKFIMM",1,0)
PXKFIMM ;ISL/JVS - Fields for V IMMUNIZATIONS file ;5/21/96  13:16
"RTN","PXKFIMM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,124**;Aug 12, 1996
"RTN","PXKFIMM",3,0)
 ;
"RTN","PXKFIMM",4,0)
 ;  Adding or Editing of data in a particular field can be controlled
"RTN","PXKFIMM",5,0)
 ;by adding a ~ as a delimiter and the letters A and/or E to the
"RTN","PXKFIMM",6,0)
 ;end of the line of text which represents what could be added
"RTN","PXKFIMM",7,0)
 ;to the DR string in a DIE call.
"RTN","PXKFIMM",8,0)
 ; 1. If none or all three(~AE) of these characters are added then
"RTN","PXKFIMM",9,0)
 ;    the data in this field can be either added or edited.
"RTN","PXKFIMM",10,0)
 ; 2. If only the ~ is added then the data in this field can be
"RTN","PXKFIMM",11,0)
 ;    neither added or edited.
"RTN","PXKFIMM",12,0)
 ; 3. IF only the ~A is added then the data can only be added to
"RTN","PXKFIMM",13,0)
 ;    the file for this field but not edited.
"RTN","PXKFIMM",14,0)
 ; 4. If only the ~E is added the the data can only be edited in
"RTN","PXKFIMM",15,0)
 ;    this file for this field. (not a likely possibility)
"RTN","PXKFIMM",16,0)
 ;
"RTN","PXKFIMM",17,0)
 ; The word "OPTION" in front of the line of text below tells the 
"RTN","PXKFIMM",18,0)
 ;software to determine,based on the data, the appropriateness
"RTN","PXKFIMM",19,0)
 ;of using either a "///" or "////" stuff in a DIE call.
"RTN","PXKFIMM",20,0)
 ;
"RTN","PXKFIMM",21,0)
 ; The information on line tag 0 $P(,," * ",1) are the piece numbers
"RTN","PXKFIMM",22,0)
 ;of the fields on the zero node that are required by the data
"RTN","PXKFIMM",23,0)
 ;dictionary and are checked for to determine if enough data is present
"RTN","PXKFIMM",24,0)
 ;to proceed without any errors. $P(,," * ",2) are the nodes and
"RTN","PXKFIMM",25,0)
 ;piece numbers of the fields used to determine duplicates in the
"RTN","PXKFIMM",26,0)
 ;file (node+piece (eg. 12+4)). $P(,," * ",3) is a flag use to
"RTN","PXKFIMM",27,0)
 ;determine if duplicates are allowed in this visit file. 
"RTN","PXKFIMM",28,0)
 ;If it is set to 0 then no duplicate checks will occur. If it is
"RTN","PXKFIMM",29,0)
 ;set to 1 then the file will be checked for duplicates based on
"RTN","PXKFIMM",30,0)
 ;the information in $P 2.
"RTN","PXKFIMM",31,0)
 ;
"RTN","PXKFIMM",32,0)
 ; The following is the file's global name.  Each global must have a
"RTN","PXKFIMM",33,0)
 ;unique name and can not have any subscripts as part of the global root.
"RTN","PXKFIMM",34,0)
GLOBAL ;;^AUPNVIMM
"RTN","PXKFIMM",35,0)
 ;
"RTN","PXKFIMM",36,0)
EN1 ;
"RTN","PXKFIMM",37,0)
 S PXKER=""
"RTN","PXKFIMM",38,0)
 S PXKER=$P($T(@PXKNOD+PXKPCE),";;",2)
"RTN","PXKFIMM",39,0)
 Q
"RTN","PXKFIMM",40,0)
EN2 ;
"RTN","PXKFIMM",41,0)
 S PXKFD=""
"RTN","PXKFIMM",42,0)
 S PXKFD=$P($T(@PXKNOD+PXKPCE),";;",2) D
"RTN","PXKFIMM",43,0)
 .I PXKFD="" S PXKPCE=PXKPCE+1 D EN2
"RTN","PXKFIMM",44,0)
 Q
"RTN","PXKFIMM",45,0)
ADD ;Add an entry to the file
"RTN","PXKFIMM",46,0)
 ;Q
"RTN","PXKFIMM",47,0)
0 ;;1,2,3 * 0+1,0+3 * 1
"RTN","PXKFIMM",48,0)
 ;;.01////^S X=$G(
"RTN","PXKFIMM",49,0)
 ;;.02////^S X=$G(
"RTN","PXKFIMM",50,0)
 ;;.03////^S X=$G(
"RTN","PXKFIMM",51,0)
 ;;.04///^S X=$G(
"RTN","PXKFIMM",52,0)
 ;;
"RTN","PXKFIMM",53,0)
 ;;.06///^S X=$G(
"RTN","PXKFIMM",54,0)
 ;;.07///^S X=$G(
"RTN","PXKFIMM",55,0)
 ;;.08////^S X=$G(
"RTN","PXKFIMM",56,0)
 ;;.09////^S X=$G(
"RTN","PXKFIMM",57,0)
 ;;.1////^S X=$G(
"RTN","PXKFIMM",58,0)
 ;;.11////^S X=$G(
"RTN","PXKFIMM",59,0)
 ;;.12////^S X=$G(
"RTN","PXKFIMM",60,0)
 ;;.13////^S X=$G(
"RTN","PXKFIMM",61,0)
 ;;.14////^S X=$G(
"RTN","PXKFIMM",62,0)
 ;;.15////^S X=$G(
"RTN","PXKFIMM",63,0)
11 ;;
"RTN","PXKFIMM",64,0)
 ;;1101///^S X=$G(
"RTN","PXKFIMM",65,0)
12 ;;
"RTN","PXKFIMM",66,0)
 ;;1201///^S X=$G(
"RTN","PXKFIMM",67,0)
 ;;1202////^S X=$G(
"RTN","PXKFIMM",68,0)
 ;;
"RTN","PXKFIMM",69,0)
 ;;1204////^S X=$G(
"RTN","PXKFIMM",70,0)
 ;;
"RTN","PXKFIMM",71,0)
 ;;
"RTN","PXKFIMM",72,0)
801 ;;
"RTN","PXKFIMM",73,0)
 ;;80101///^S X=1;
"RTN","PXKFIMM",74,0)
 ;;80102///^S X=$G(PXKAUDIT);
"RTN","PXKFIMM",75,0)
811 ;;
"RTN","PXKFIMM",76,0)
 ;;81101///^S X=$G(
"RTN","PXKFIMM",77,0)
812 ;;
"RTN","PXKFIMM",78,0)
 ;;81201///^S X=$G(
"RTN","PXKFIMM",79,0)
 ;;81202////^S X=$G(
"RTN","PXKFIMM",80,0)
 ;;81203////^S X=$G(
"RTN","PXKFIMM",81,0)
SPEC ;
"RTN","PXKFIMM",82,0)
 Q
"RTN","PXKFPOV")
0^15^B3819439
"RTN","PXKFPOV",1,0)
PXKFPOV ;ISL/JVS - Fields for V PURPOSE OF VISIT (POV) file ;3/1/04 10:46am
"RTN","PXKFPOV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,130,124**;Aug 12, 1996
"RTN","PXKFPOV",3,0)
 ;
"RTN","PXKFPOV",4,0)
 ;  Adding or Editing of data in a particular field can be controlled
"RTN","PXKFPOV",5,0)
 ;by adding a ~ as a delimiter and the letters A and/or E to the
"RTN","PXKFPOV",6,0)
 ;end of the line of text which represents what could be added
"RTN","PXKFPOV",7,0)
 ;to the DR string in a DIE call.
"RTN","PXKFPOV",8,0)
 ; 1. If none or all three(~AE) of these characters are added then
"RTN","PXKFPOV",9,0)
 ;    the data in this field can be either added or edited.
"RTN","PXKFPOV",10,0)
 ; 2. If only the ~ is added then the data in this field can be
"RTN","PXKFPOV",11,0)
 ;    neither added or edited.
"RTN","PXKFPOV",12,0)
 ; 3. IF only the ~A is added then the data can only be added to
"RTN","PXKFPOV",13,0)
 ;    the file for this field but not edited.
"RTN","PXKFPOV",14,0)
 ; 4. If only the ~E is added the the data can only be edited in
"RTN","PXKFPOV",15,0)
 ;    this file for this field. (not a likely possibility)
"RTN","PXKFPOV",16,0)
 ;
"RTN","PXKFPOV",17,0)
 ; The word "OPTION" in front of the line of text below tells the 
"RTN","PXKFPOV",18,0)
 ;software to determine,based on the data, the appropriateness
"RTN","PXKFPOV",19,0)
 ;of using either a "///" or "////" stuff in a DIE call.
"RTN","PXKFPOV",20,0)
 ;
"RTN","PXKFPOV",21,0)
 ; The information on line tag 0 $P(,," * ",1) are the piece numbers
"RTN","PXKFPOV",22,0)
 ;of the fields on the zero node that are required by the data
"RTN","PXKFPOV",23,0)
 ;dictionary and are checked for to determine if enough data is present
"RTN","PXKFPOV",24,0)
 ;to proceed without any errors. $P(,," * ",2) are the nodes and
"RTN","PXKFPOV",25,0)
 ;piece numbers of the fields used to determine duplicates in the
"RTN","PXKFPOV",26,0)
 ;file (node+piece (eg. 12+4)). $P(,," * ",3) is a flag use to
"RTN","PXKFPOV",27,0)
 ;determine if duplicates are allowed in this visit file. 
"RTN","PXKFPOV",28,0)
 ;If it is set to 0 then no duplicate checks will occur. If it is
"RTN","PXKFPOV",29,0)
 ;set to 1 then the file will be checked for duplicates based on
"RTN","PXKFPOV",30,0)
 ;the information in $P 2.
"RTN","PXKFPOV",31,0)
 ;
"RTN","PXKFPOV",32,0)
 ; The following is the file's global name.  Each global must have a
"RTN","PXKFPOV",33,0)
 ;unique name and can not have any subscripts as part of the global root.
"RTN","PXKFPOV",34,0)
GLOBAL ;;^AUPNVPOV
"RTN","PXKFPOV",35,0)
 ;
"RTN","PXKFPOV",36,0)
EN1 ;
"RTN","PXKFPOV",37,0)
 S PXKER=""
"RTN","PXKFPOV",38,0)
 S PXKER=$P($T(@PXKNOD+PXKPCE),";;",2) Q
"RTN","PXKFPOV",39,0)
EN2 ;
"RTN","PXKFPOV",40,0)
 S PXKFD=""
"RTN","PXKFPOV",41,0)
 S PXKFD=$P($T(@PXKNOD+PXKPCE),";;",2) D
"RTN","PXKFPOV",42,0)
 .I PXKFD="" S PXKPCE=PXKPCE+1 D EN2
"RTN","PXKFPOV",43,0)
 Q
"RTN","PXKFPOV",44,0)
ADD ;Add an entry to the file
"RTN","PXKFPOV",45,0)
 Q
"RTN","PXKFPOV",46,0)
0 ;;1,2,3,4 * 0+1,0+3 * 1
"RTN","PXKFPOV",47,0)
 ;;.01////^S X=$G(
"RTN","PXKFPOV",48,0)
 ;;.02////^S X=$G(
"RTN","PXKFPOV",49,0)
 ;;.03////^S X=$G(
"RTN","PXKFPOV",50,0)
 ;;OPTION * .04////^S X=$G( * .04///^S X=$G(
"RTN","PXKFPOV",51,0)
 ;;.05///^S X=$G(
"RTN","PXKFPOV",52,0)
 ;;.06///^S X=$G(
"RTN","PXKFPOV",53,0)
 ;;.07///^S X=$G(
"RTN","PXKFPOV",54,0)
 ;;.08///^S X=$G(
"RTN","PXKFPOV",55,0)
 ;;.09////^S X=$G(
"RTN","PXKFPOV",56,0)
 ;;
"RTN","PXKFPOV",57,0)
 ;;.11///^S X=$G(
"RTN","PXKFPOV",58,0)
 ;;.12///^S X=$G(
"RTN","PXKFPOV",59,0)
 ;;.13///^S X=$G(
"RTN","PXKFPOV",60,0)
 ;;.14////^S X=$G(
"RTN","PXKFPOV",61,0)
 ;;.15////^S X=$G(
"RTN","PXKFPOV",62,0)
 ;;.16////^S X=$G(
"RTN","PXKFPOV",63,0)
 ;;.17///^S X=$G(
"RTN","PXKFPOV",64,0)
12 ;;
"RTN","PXKFPOV",65,0)
 ;;1201////^S X=$G(
"RTN","PXKFPOV",66,0)
 ;;1202////^S X=$G(
"RTN","PXKFPOV",67,0)
 ;;
"RTN","PXKFPOV",68,0)
 ;;1204////^S X=$G(
"RTN","PXKFPOV",69,0)
 ;;
"RTN","PXKFPOV",70,0)
 ;;
"RTN","PXKFPOV",71,0)
800 ;;
"RTN","PXKFPOV",72,0)
 ;;80001///^S X=$G(
"RTN","PXKFPOV",73,0)
 ;;80002///^S X=$G(
"RTN","PXKFPOV",74,0)
 ;;80003///^S X=$G(
"RTN","PXKFPOV",75,0)
 ;;80004///^S X=$G(
"RTN","PXKFPOV",76,0)
 ;;80005///^S X=$G(
"RTN","PXKFPOV",77,0)
 ;;80006///^S X=$G(
"RTN","PXKFPOV",78,0)
 ;;80007///^S X=$G(
"RTN","PXKFPOV",79,0)
801 ;;
"RTN","PXKFPOV",80,0)
 ;;80101///^S X=1;
"RTN","PXKFPOV",81,0)
 ;;80102///^S X=$G(PXKAUDIT);
"RTN","PXKFPOV",82,0)
802 ;;
"RTN","PXKFPOV",83,0)
 ;;OPTION * 80201////^S X=$G( * 80201///^S X=$G(
"RTN","PXKFPOV",84,0)
811 ;;
"RTN","PXKFPOV",85,0)
 ;;81101///^S X=$G(
"RTN","PXKFPOV",86,0)
812 ;;
"RTN","PXKFPOV",87,0)
 ;;81201///^S X=$G(
"RTN","PXKFPOV",88,0)
 ;;81202////^S X=$G(
"RTN","PXKFPOV",89,0)
 ;;81203////^S X=$G(
"RTN","PXKFPOV",90,0)
SPEC ;
"RTN","PXKFPOV",91,0)
 Q
"RTN","PXKFSK")
0^46^B2490158
"RTN","PXKFSK",1,0)
PXKFSK ;ISL/JVS - Fields for V SKIN TEST file ;5/21/96  13:18
"RTN","PXKFSK",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,124**;Aug 12, 1996
"RTN","PXKFSK",3,0)
 ;  Adding or Editing of data in a particular field can be controlled
"RTN","PXKFSK",4,0)
 ;by adding a ~ as a delimiter and the letters A and/or E to the
"RTN","PXKFSK",5,0)
 ;end of the line of text which represents what could be added
"RTN","PXKFSK",6,0)
 ;to the DR string in a DIE call.
"RTN","PXKFSK",7,0)
 ; 1. If none or all three(~AE) of these characters are added then
"RTN","PXKFSK",8,0)
 ;    the data in this field can be either added or edited.
"RTN","PXKFSK",9,0)
 ; 2. If only the ~ is added then the data in this field can be
"RTN","PXKFSK",10,0)
 ;    neither added or edited.
"RTN","PXKFSK",11,0)
 ; 3. IF only the ~A is added then the data can only be added to
"RTN","PXKFSK",12,0)
 ;    the file for this field but not edited.
"RTN","PXKFSK",13,0)
 ; 4. If only the ~E is added the the data can only be edited in
"RTN","PXKFSK",14,0)
 ;    this file for this field. (not a likely possibility)
"RTN","PXKFSK",15,0)
 ;
"RTN","PXKFSK",16,0)
 ; The word option in front of the line of text below tells the 
"RTN","PXKFSK",17,0)
 ;software to determine,based on the data, the appropriateness
"RTN","PXKFSK",18,0)
 ;of using either a "///" or "////" stuff in a DIE call.
"RTN","PXKFSK",19,0)
 ;
"RTN","PXKFSK",20,0)
 ; The information on line tag 0 $P(,," * ",1) are the piece numbers
"RTN","PXKFSK",21,0)
 ;of the fields on the zero node that are required by the data
"RTN","PXKFSK",22,0)
 ;dictionary and are checked for to determine if enough data is present
"RTN","PXKFSK",23,0)
 ;to proceed without any errors. $P(,," * ",2) are the nodes and
"RTN","PXKFSK",24,0)
 ;piece numbers of the fields used to determine duplicates in the
"RTN","PXKFSK",25,0)
 ;file (node+piece (eg. 12+4)). $P(,," * ",3) is a flag use to
"RTN","PXKFSK",26,0)
 ;determine if duplicates are allowed in this visit file. 
"RTN","PXKFSK",27,0)
 ;If it is set to 0 then no duplicate checks will occur. If it is
"RTN","PXKFSK",28,0)
 ;set to 1 then the file will be checked for duplicates based on
"RTN","PXKFSK",29,0)
 ;the information in $P 2.
"RTN","PXKFSK",30,0)
 ;
"RTN","PXKFSK",31,0)
 ; The following is the file's global name.  Each global must have a
"RTN","PXKFSK",32,0)
 ;unique name and can not have any subscripts as part of the global root.
"RTN","PXKFSK",33,0)
GLOBAL ;;^AUPNVSK
"RTN","PXKFSK",34,0)
 ;
"RTN","PXKFSK",35,0)
EN1 ;
"RTN","PXKFSK",36,0)
 S PXKER=""
"RTN","PXKFSK",37,0)
 S PXKER=$P($T(@PXKNOD+PXKPCE),";;",2)
"RTN","PXKFSK",38,0)
 Q
"RTN","PXKFSK",39,0)
EN2 ;
"RTN","PXKFSK",40,0)
 S PXKFD=""
"RTN","PXKFSK",41,0)
 S PXKFD=$P($T(@PXKNOD+PXKPCE),";;",2) D
"RTN","PXKFSK",42,0)
 .I PXKFD="" S PXKPCE=PXKPCE+1 D EN2
"RTN","PXKFSK",43,0)
 Q
"RTN","PXKFSK",44,0)
ADD ;Add an entry to the file
"RTN","PXKFSK",45,0)
 Q
"RTN","PXKFSK",46,0)
0 ;;1,2,3 * 0+1,0+3 * 0
"RTN","PXKFSK",47,0)
 ;;.01///^S X=$G(
"RTN","PXKFSK",48,0)
 ;;.02////^S X=$G(
"RTN","PXKFSK",49,0)
 ;;.03////^S X=$G(
"RTN","PXKFSK",50,0)
 ;;.04///^S X=$G(
"RTN","PXKFSK",51,0)
 ;;.05////^S X=$G(
"RTN","PXKFSK",52,0)
 ;;.06////^S X=$G(
"RTN","PXKFSK",53,0)
 ;;
"RTN","PXKFSK",54,0)
 ;;.08////^S X=$G(
"RTN","PXKFSK",55,0)
 ;;.09////^S X=$G(
"RTN","PXKFSK",56,0)
 ;;.1////^S X=$G(
"RTN","PXKFSK",57,0)
 ;;.11////^S X=$G(
"RTN","PXKFSK",58,0)
 ;;.12////^S X=$G(
"RTN","PXKFSK",59,0)
 ;;.13////^S X=$G(
"RTN","PXKFSK",60,0)
 ;;.14////^S X=$G(
"RTN","PXKFSK",61,0)
 ;;.15////^S X=$G(
"RTN","PXKFSK",62,0)
12 ;;
"RTN","PXKFSK",63,0)
 ;;1201///^S X=$G(
"RTN","PXKFSK",64,0)
 ;;1202////^S X=$G(
"RTN","PXKFSK",65,0)
 ;;
"RTN","PXKFSK",66,0)
 ;;1204////^S X=$G(
"RTN","PXKFSK",67,0)
 ;;
"RTN","PXKFSK",68,0)
 ;;
"RTN","PXKFSK",69,0)
801 ;;
"RTN","PXKFSK",70,0)
 ;;80101///^S X=1;
"RTN","PXKFSK",71,0)
 ;;80102///^S X=$G(PXKAUDIT);
"RTN","PXKFSK",72,0)
811 ;;
"RTN","PXKFSK",73,0)
 ;;81101///^S X=$G(
"RTN","PXKFSK",74,0)
812 ;;
"RTN","PXKFSK",75,0)
 ;;81201///^S X=$G(
"RTN","PXKFSK",76,0)
 ;;81202////^S X=$G(
"RTN","PXKFSK",77,0)
 ;;81203////^S X=$G(
"RTN","PXKFSK",78,0)
SPEC ;
"RTN","PXKFSK",79,0)
 Q
"RTN","PXKFVST")
0^58^B9521492
"RTN","PXKFVST",1,0)
PXKFVST ;ISL/JVS - Fields for VISIT file ;7/29/96
"RTN","PXKFVST",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,56,111,130,124**;Aug 12, 1996
"RTN","PXKFVST",3,0)
 ;
"RTN","PXKFVST",4,0)
 ;  Adding or Editing of data in a particular field can be controlled
"RTN","PXKFVST",5,0)
 ;by adding a ~ as a delimiter and the letters A and/or E to the
"RTN","PXKFVST",6,0)
 ;end of the line of text which represents what could be added
"RTN","PXKFVST",7,0)
 ;to the DR string in a DIE call.
"RTN","PXKFVST",8,0)
 ; 1. If none or all three(~AE) of these characters are added then
"RTN","PXKFVST",9,0)
 ;    the data in this field can be either added or edited.
"RTN","PXKFVST",10,0)
 ; 2. If only the ~ is added then the data in this field can be
"RTN","PXKFVST",11,0)
 ;    neither added or edited.
"RTN","PXKFVST",12,0)
 ; 3. IF only the ~A is added then the data can only be added to
"RTN","PXKFVST",13,0)
 ;    the file for this field but not edited.
"RTN","PXKFVST",14,0)
 ; 4. If only the ~E is added the the data can only be edited in
"RTN","PXKFVST",15,0)
 ;    this file for this field. (not a likely possibility)
"RTN","PXKFVST",16,0)
 ;
"RTN","PXKFVST",17,0)
 ; The word "OPTION" in front of the line of text below tells the 
"RTN","PXKFVST",18,0)
 ;software to determine,based on the data, the appropriateness
"RTN","PXKFVST",19,0)
 ;of using either a "///" or "////" stuff in a DIE call.
"RTN","PXKFVST",20,0)
 ;
"RTN","PXKFVST",21,0)
 ; The information on line tag 0 $P(,," * ",1) are the piece numbers
"RTN","PXKFVST",22,0)
 ;of the fields on the zero node that are required by the data
"RTN","PXKFVST",23,0)
 ;dictionary and are checked for to determine if enough data is present
"RTN","PXKFVST",24,0)
 ;to proceed without any errors. $P(,," * ",2) are the nodes and
"RTN","PXKFVST",25,0)
 ;piece numbers of the fields used to determine duplicates in the
"RTN","PXKFVST",26,0)
 ;file (node+piece (eg. 12+4)). $P(,," * ",3) is a flag use to
"RTN","PXKFVST",27,0)
 ;determine if duplicates are allowed in this visit file. 
"RTN","PXKFVST",28,0)
 ;If it is set to 0 then no duplicate checks will occur. If it is
"RTN","PXKFVST",29,0)
 ;set to 1 then the file will be checked for duplicates based on
"RTN","PXKFVST",30,0)
 ;the information in $P 2.
"RTN","PXKFVST",31,0)
 ;
"RTN","PXKFVST",32,0)
 ; The following is the file's global name.  Each global must have a
"RTN","PXKFVST",33,0)
 ;unique name and can not have any subscripts as part of the global root.
"RTN","PXKFVST",34,0)
GLOBAL ;;^AUPNVSIT
"RTN","PXKFVST",35,0)
 ;
"RTN","PXKFVST",36,0)
EN1 ;
"RTN","PXKFVST",37,0)
 S PXKER=""
"RTN","PXKFVST",38,0)
 S PXKER=$P($T(@PXKNOD+PXKPCE),";;",2) Q
"RTN","PXKFVST",39,0)
EN2 ;
"RTN","PXKFVST",40,0)
 S PXKFD=""
"RTN","PXKFVST",41,0)
 S PXKFD=$P($T(@PXKNOD+PXKPCE),";;",2) D
"RTN","PXKFVST",42,0)
 .I PXKFD="" S PXKPCE=PXKPCE+1 D EN2
"RTN","PXKFVST",43,0)
 Q
"RTN","PXKFVST",44,0)
ADD ;Add an entry to the file
"RTN","PXKFVST",45,0)
 Q
"RTN","PXKFVST",46,0)
0 ;;1,3,5,7,8,22 *  * 0
"RTN","PXKFVST",47,0)
 ;;.01///^S X=$G(~
"RTN","PXKFVST",48,0)
 ;;.02///^S X=$G(~
"RTN","PXKFVST",49,0)
 ;;.03///^S X=$G(~
"RTN","PXKFVST",50,0)
 ;;
"RTN","PXKFVST",51,0)
 ;;.05////^S X=$G(~
"RTN","PXKFVST",52,0)
 ;;.06////^S X=$G(~
"RTN","PXKFVST",53,0)
 ;;.07///^S X=$G(~
"RTN","PXKFVST",54,0)
 ;;.08////^S X=$G(~
"RTN","PXKFVST",55,0)
 ;;.09///^S X=$G(~
"RTN","PXKFVST",56,0)
 ;;
"RTN","PXKFVST",57,0)
 ;;.11///^S X=$G(~
"RTN","PXKFVST",58,0)
 ;;.12////^S X=$G(~
"RTN","PXKFVST",59,0)
 ;;.13///^S X=$G(~
"RTN","PXKFVST",60,0)
 ;;
"RTN","PXKFVST",61,0)
 ;;
"RTN","PXKFVST",62,0)
 ;;
"RTN","PXKFVST",63,0)
 ;;
"RTN","PXKFVST",64,0)
 ;;.18///^S X=$G(~
"RTN","PXKFVST",65,0)
 ;;
"RTN","PXKFVST",66,0)
 ;;
"RTN","PXKFVST",67,0)
 ;;.21////^S X=$G(~
"RTN","PXKFVST",68,0)
 ;;.22////^S X=$G(~
"RTN","PXKFVST",69,0)
 ;;.23////^S X=$G(~
"RTN","PXKFVST",70,0)
 ;;.24////^S X=$G(~
"RTN","PXKFVST",71,0)
21 ;;
"RTN","PXKFVST",72,0)
 ;;2101///^S X=$G(~
"RTN","PXKFVST",73,0)
800 ;;
"RTN","PXKFVST",74,0)
 ;;80001///^S X=$G(~
"RTN","PXKFVST",75,0)
 ;;80002///^S X=$G(~
"RTN","PXKFVST",76,0)
 ;;80003///^S X=$G(~
"RTN","PXKFVST",77,0)
 ;;80004///^S X=$G(~
"RTN","PXKFVST",78,0)
 ;;80005///^S X=$G(~ ;added 6/17/98 for MST enhancement
"RTN","PXKFVST",79,0)
 ;;80006///^S X=$G(~ ;PX*1*111 - added for HNC enhancement
"RTN","PXKFVST",80,0)
 ;;80007///^S X=$G(~ ;PX*1*130
"RTN","PXKFVST",81,0)
812 ;;
"RTN","PXKFVST",82,0)
 ;;81201///^S X=$G(
"RTN","PXKFVST",83,0)
 ;;81202////^S X=$G(
"RTN","PXKFVST",84,0)
 ;;81203////^S X=$G(
"RTN","PXKFVST",85,0)
 ;
"RTN","PXKFVST",86,0)
UPD ;Up date visit file using visit tracking
"RTN","PXKFVST",87,0)
 ;--new VSIT to make sure that none are left around after call
"RTN","PXKFVST",88,0)
 N PXTMPVST
"RTN","PXKFVST",89,0)
 S PXTMPVST=VSIT("IEN")
"RTN","PXKFVST",90,0)
 N VSIT
"RTN","PXKFVST",91,0)
 S VSIT("IEN")=PXTMPVST
"RTN","PXKFVST",92,0)
 I $G(PXKAV(0,8))]"" D
"RTN","PXKFVST",93,0)
 .I PXKAV(0,8)="@" S VSIT("DSS")="@"
"RTN","PXKFVST",94,0)
 .E  D
"RTN","PXKFVST",95,0)
 ..K ^UTILITY("DIQ1",$J)
"RTN","PXKFVST",96,0)
 ..S DIC=40.7,DA=+$G(PXKAV(0,8)),DIQ(0)="I",DR=1 D EN^DIQ1
"RTN","PXKFVST",97,0)
 ..S VSIT("DSS")=$G(^UTILITY("DIQ1",$J,40.7,DA,1,"I"))
"RTN","PXKFVST",98,0)
 K ^UTILITY("DIQ1",$J),DIQ,DR,DA,DIC
"RTN","PXKFVST",99,0)
 I $G(PXKAV(0,6))]"" S VSIT("INS")=$G(PXKAV(0,6))
"RTN","PXKFVST",100,0)
 I $G(PXKAV(0,18))]"" S VSIT("COD")=$G(PXKAV(0,18))
"RTN","PXKFVST",101,0)
 ;--cannot edit "ELG"
"RTN","PXKFVST",102,0)
 I $G(PXKAV(0,22))]"" S VSIT("LOC")=$G(PXKAV(0,22))
"RTN","PXKFVST",103,0)
 ;Classification questions
"RTN","PXKFVST",104,0)
 N PXP,PXV,PXN
"RTN","PXKFVST",105,0)
 ;AO, IR, and EC not applicable if SC answered YES (1)
"RTN","PXKFVST",106,0)
 ;I $G(PXKAV(800,1))=1 F PXP=2:1:4 S PXKAV(800,PXP)="@"
"RTN","PXKFVST",107,0)
 F PXP=1:1:7 D
"RTN","PXKFVST",108,0)
 .S PXV=$G(PXKAV(800,PXP))
"RTN","PXKFVST",109,0)
 .S PXN=$P("SC^AO^IR^EC^MST^HNC^CV","^",PXP)
"RTN","PXKFVST",110,0)
 .I PXV'="" S VSIT(PXN)=PXV
"RTN","PXKFVST",111,0)
 D UPD^VSIT
"RTN","PXKFVST",112,0)
 K VSIT("DSS"),VSIT("COD"),VSIT("SC"),VSIT("AO"),VSIT("IR"),VSIT("EC")
"RTN","PXKFVST",113,0)
 K VSIT("LOC"),VSIT("INS"),VSIT("ELG"),VSIT("MDT")
"RTN","PXKFVST",114,0)
 ;PX*1*111 - added for HNC enhancement
"RTN","PXKFVST",115,0)
 K VSIT("MST"),VSIT("HNC"),VSIT("CV")
"RTN","PXKFVST",116,0)
 Q
"RTN","PXKFVST",117,0)
SPEC ;
"RTN","PXKFVST",118,0)
 Q
"RTN","PXKMAIN")
0^54^B41988947
"RTN","PXKMAIN",1,0)
PXKMAIN ;ISL/JVS,ISA/Zoltan - Main Routine for Data Capture ;9/11/98
"RTN","PXKMAIN",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,59,73,88,69,117,130,124**;Aug 12, 1996
"RTN","PXKMAIN",3,0)
 ;+This routine is responsible for:
"RTN","PXKMAIN",4,0)
 ;+
"RTN","PXKMAIN",5,0)
 ;+LOCAL VARIABLE LIST:
"RTN","PXKMAIN",6,0)
 ;+ PXP59LOC = LOCK name (introduced in patch PX*1.0*59).
"RTN","PXKMAIN",7,0)
 ;+ PXFG     = Stop flag with duplicate of delete
"RTN","PXKMAIN",8,0)
 ;+ PXKAFT   = After node
"RTN","PXKMAIN",9,0)
 ;+ PXKBEF   = Before node
"RTN","PXKMAIN",10,0)
 ;+ PXKAV    = Pieces from the after node
"RTN","PXKMAIN",11,0)
 ;+ PXKBV    = Pieces from the before node
"RTN","PXKMAIN",12,0)
 ;+ PXKERROR = Set when there is an error
"RTN","PXKMAIN",13,0)
 ;+ PXKFGAD  = ADD flag
"RTN","PXKMAIN",14,0)
 ;+ PXKFGED  = EDIT flag
"RTN","PXKMAIN",15,0)
 ;+ PXKFGDE  = DELETE flag
"RTN","PXKMAIN",16,0)
 ;+ PXKSEQ   = Sequence number in PXK tmp global
"RTN","PXKMAIN",17,0)
 ;+ PXKCAT   = Category of entry (CPT,MSR,VST...)
"RTN","PXKMAIN",18,0)
 ;+ PXKREF   = Root of temp global
"RTN","PXKMAIN",19,0)
 ;+ PXKPIEN  = IEN of v file or the visit file
"RTN","PXKMAIN",20,0)
 ;+ PXKREF   = The original reference we are ordering off of
"RTN","PXKMAIN",21,0)
 ;+ PXKRT    = name of the node in the v file
"RTN","PXKMAIN",22,0)
 ;+ PXKRTN   = routine name for the "f"ile routine
"RTN","PXKMAIN",23,0)
 ;+ PXKSOR   = the data source for this entry
"RTN","PXKMAIN",24,0)
 ;+ PXKSUB   = the subscript the data is located on the the v file
"RTN","PXKMAIN",25,0)
 ;+ PXKVST   = the visit IEN
"RTN","PXKMAIN",26,0)
 ;+ PXKDUZ   = the DUZ of the user
"RTN","PXKMAIN",27,0)
 ;+ *PXKHLR* = A variable set by calling routine so that duplicate
"RTN","PXKMAIN",28,0)
 ;+            PXKERROR messages aren't produced.
"RTN","PXKMAIN",29,0)
 ;
"RTN","PXKMAIN",30,0)
 W !,"This is not an entry point" Q
"RTN","PXKMAIN",31,0)
EN1 ;+Main entry point to read ^TMP("PXK", Global
"RTN","PXKMAIN",32,0)
 ;+ Partial ^TMP Global Structure when called:
"RTN","PXKMAIN",33,0)
 ;+ ^TMP("PXK",$J,"SOR") = Source ien
"RTN","PXKMAIN",34,0)
 ;+
"RTN","PXKMAIN",35,0)
 ;+ ^TMP("PXK",$J,"VST",1,0,"BEFORE") = the 0-node of the visit file
"RTN","PXKMAIN",36,0)
 ;+ ^TMP("PXK",$J,"VST",1,0,"AFTER") = 0-node after changes.
"RTN","PXKMAIN",37,0)
 ;+ ^TMP("PXK",$J,"VST",provider counter,"IEN") = ""
"RTN","PXKMAIN",38,0)
 ;+
"RTN","PXKMAIN",39,0)
 ;+ ^TMP("PXK",$J,"PRV",provider counter,0,"BEFORE") = ""
"RTN","PXKMAIN",40,0)
 ;+ ^TMP("PXK",$J,"PRV",provider counter,0,"AFTER") = Provider id^DFN^Visitien^'P' or 'S' for primary/secondary
"RTN","PXKMAIN",41,0)
 ;+ ^TMP("PXK",$J,"PRV",provider counter,"IEN") = ""
"RTN","PXKMAIN",42,0)
 ;+ ^TMP("PXK",$J,"PRV",provider counter,"BEFORE") = ""
"RTN","PXKMAIN",43,0)
 ;+ ^TMP("PXK",$J,"PRV",provider counter,"AFTER") = ^Package ien^Source ien
"RTN","PXKMAIN",44,0)
 ;+
"RTN","PXKMAIN",45,0)
 N PXP59LOC
"RTN","PXKMAIN",46,0)
 D LOCK
"RTN","PXKMAIN",47,0)
 K PXKERROR
"RTN","PXKMAIN",48,0)
 I '$G(PXKDUZ) D
"RTN","PXKMAIN",49,0)
 . I $G(DUZ) S PXKDUZ=DUZ
"RTN","PXKMAIN",50,0)
 . E  S PXKDUZ=.5
"RTN","PXKMAIN",51,0)
 D VST
"RTN","PXKMAIN",52,0)
 I $D(PXP59LOC) D UNLOCK
"RTN","PXKMAIN",53,0)
 Q
"RTN","PXKMAIN",54,0)
VST ;--Check for visit node and get one created or quit.
"RTN","PXKMAIN",55,0)
 I '$G(^TMP("PXK",$J,"VST",1,"IEN")) D
"RTN","PXKMAIN",56,0)
 .D VSIT^PXKVST
"RTN","PXKMAIN",57,0)
 I +$G(^TMP("PXK",$J,"VST",1,"IEN"))=-1 S PXKERROR("VISIT")="Visit Tracking could not get a visit." Q
"RTN","PXKMAIN",58,0)
 I +$G(^TMP("PXK",$J,"VST",1,"IEN"))=-2 S PXKERROR("VISIT")="PCE is not activated in Visit Tracking Parameters and thus cannot create visits." Q
"RTN","PXKMAIN",59,0)
 I +$G(^TMP("PXK",$J,"VST",1,"IEN"))<1 S PXKERROR("VISIT")="Did not get a visit^"_$G(^TMP("PXK",$J,"VST",1,"IEN")) Q
"RTN","PXKMAIN",60,0)
 ;
"RTN","PXKMAIN",61,0)
NEW ;--New variables and set main variables
"RTN","PXKMAIN",62,0)
 N PXKDFN,PXKSOR,PXKVST,PXKSEQ,PXFG,PXKAFT,PXKBEF,PXKAUDIT
"RTN","PXKMAIN",63,0)
 N PXKCAT,PXKER,PXKFGAD,PXKFGED,PXKFGDE,PXKNOD,PXKPCE
"RTN","PXKMAIN",64,0)
 N PXKPIEN,PXKREF,PXKRTN,PXKSORR,PXKSUB,PXKVCAT
"RTN","PXKMAIN",65,0)
 N PXKPTR,PXDFG,PX,PXJJJ,PXKAFT8,PXKAFTR,PXKGN,PXKN,PXKP
"RTN","PXKMAIN",66,0)
 N PXKRRT,PXKVRTN,PXKRT,PXKFVDLM,TMPPX
"RTN","PXKMAIN",67,0)
PRVTYPE ;---DO PROVIDER TYPE--PXKMAIN2
"RTN","PXKMAIN",68,0)
 D PRVTYPE^PXKMAIN2
"RTN","PXKMAIN",69,0)
 ;
"RTN","PXKMAIN",70,0)
SET ;--SET VARIABLES NECESSARY
"RTN","PXKMAIN",71,0)
 ;'DA' should not be defined at this point
"RTN","PXKMAIN",72,0)
 N DA ;PX*1.0*117
"RTN","PXKMAIN",73,0)
 ;
"RTN","PXKMAIN",74,0)
 S PXFG=0,TMPPX="^",PXKLAYGO="",PXDFG=0
"RTN","PXKMAIN",75,0)
SOURCE S PXKSOR=$G(^TMP("PXK",$J,"SOR")) D  Q:$D(PXKERROR("SOURCE"))
"RTN","PXKMAIN",76,0)
 .S PXKCO("SOR")=PXKSOR
"RTN","PXKMAIN",77,0)
 .I $D(PXKSOR)']"" S PXKERROR("SOURCE")="" Q
"RTN","PXKMAIN",78,0)
VISIT S (PXKVST,VSIT("IEN"))=$G(^TMP("PXK",$J,"VST",1,"IEN"))
"RTN","PXKMAIN",79,0)
ORDER ;--$ORDER Through the ^TMP("PXK", global setting variables
"RTN","PXKMAIN",80,0)
 S PXKREF="^TMP(""PXK"",$J)"
"RTN","PXKMAIN",81,0)
CATEG S PXKCAT="" F  S (PXKCAT,PXKVCAT)=$O(@PXKREF@(PXKCAT)) Q:PXKCAT=""  D
"RTN","PXKMAIN",82,0)
 .I PXKCAT="VST" S PXKVCAT="SIT"
"RTN","PXKMAIN",83,0)
 .S PXKRTN="PXKF"_PXKCAT
"RTN","PXKMAIN",84,0)
 .S X=PXKRTN X ^%ZOSF("TEST") Q:'$T
"RTN","PXKMAIN",85,0)
SEQUE .S PXKSEQ=0 F  S PXKSEQ=$O(@PXKREF@(PXKCAT,PXKSEQ)) K PXKAV,PXKBV S PXFG=0 Q:'PXKSEQ  D
"RTN","PXKMAIN",86,0)
 ..S PXKPIEN=$G(@PXKREF@(PXKCAT,PXKSEQ,"IEN")),(PXKFGAD,PXKFGDE,PXKFGED,PXDFG)=0
"RTN","PXKMAIN",87,0)
SUBSCR ..S PXKSUB="" F  S PXKSUB=$O(@PXKREF@(PXKCAT,PXKSEQ,PXKSUB)) Q:PXKSUB["IEN"  Q:PXFG=1  Q:PXDFG=1  D
"RTN","PXKMAIN",88,0)
AFTER ...S PXKAFT(PXKSUB)=$G(@PXKREF@(PXKCAT,PXKSEQ,PXKSUB,"AFTER"))
"RTN","PXKMAIN",89,0)
BEFORE ...S PXKBEF(PXKSUB)=$G(@PXKREF@(PXKCAT,PXKSEQ,PXKSUB,"BEFORE"))
"RTN","PXKMAIN",90,0)
 ...I PXKCAT="CPT",PXKSUB=1 D SUBSCR^PXKMOD
"RTN","PXKMAIN",91,0)
 ...D LOOP^PXKMAIN1 D ERROR^PXKMAIN1 S PXDFG=0 I $G(PXKAV(0,1))["@"!('$D(PXKAV(0,1))) S PXKAFT(PXKSUB)="" K PXKAV(0) S PXDFG=1
"RTN","PXKMAIN",92,0)
 ..Q:PXFG=1
"RTN","PXKMAIN",93,0)
 ..I $D(PXKAV),'$D(PXKBV) S PXKSORR=PXKSOR_"-A "_PXKDUZ,PXKFGAD=1 I PXKCAT["VST" S PXKFGAD=0
"RTN","PXKMAIN",94,0)
 ..I '$D(PXKAV),$D(PXKBV) S PXKFGDE=1,PXKFVDLM="" D
"RTN","PXKMAIN",95,0)
 ...S PXKRT=$P($T(GLOBAL^@PXKRTN),";;",2)_"("_PXKPIEN_")" I $D(@PXKRT) D DELETE^PXKMAIN1,EN1^PXKMASC S PXFG=1 K PXKRT Q
"RTN","PXKMAIN",96,0)
 ..I 'PXKFGAD,'PXKFGDE D
"RTN","PXKMAIN",97,0)
 ...I PXKCAT="VST" D CQDEL
"RTN","PXKMAIN",98,0)
 ...D CLEAN^PXKMAIN1
"RTN","PXKMAIN",99,0)
 ...I $D(PXKAV) S PXKSORR=PXKSOR_"-E "_PXKDUZ,PXKFGED=1 I PXKCAT="VST",'$D(PXKBV),$D(PXKVST) S PXKFGED=0
"RTN","PXKMAIN",100,0)
 ..I 'PXKFGAD,'PXKFGDE,'PXKFGED,PXKCAT["VST" D EN1^PXKMASC
"RTN","PXKMAIN",101,0)
 ..I PXKFGAD=1 D  Q:PXFG
"RTN","PXKMAIN",102,0)
 ...D ERROR^PXKMAIN1
"RTN","PXKMAIN",103,0)
 ...I $D(PXKERROR(PXKCAT,PXKSEQ)) S PXFG=1
"RTN","PXKMAIN",104,0)
 ...D:'PXFG DUP^PXKMAIN1
"RTN","PXKMAIN",105,0)
 ...I PXFG=1 D  Q
"RTN","PXKMAIN",106,0)
 ....Q:PXKCAT'="CPT"
"RTN","PXKMAIN",107,0)
 ....I $G(@PXKREF@(PXKCAT,PXKSEQ,"IEN"))]"" D REMOVE^PXCEVFIL(@PXKREF@(PXKCAT,PXKSEQ,"IEN"))
"RTN","PXKMAIN",108,0)
 ...D:'PXKPIEN FILE^PXKMAIN1
"RTN","PXKMAIN",109,0)
 ...S:'$G(DA) DA=PXKPIEN
"RTN","PXKMAIN",110,0)
 ...D AUD2^PXKMAIN1,DRDIE^PXKMAIN1,EN1^PXKMASC
"RTN","PXKMAIN",111,0)
 ..I PXKFGED=1,PXKCAT'="VST" S PXKRT=$P($T(GLOBAL^@PXKRTN),";;",2)_"("_PXKPIEN_")" Q:'$D(@PXKRT)  S DA=PXKPIEN D DUP^PXKMAIN1 Q:PXFG=1  D AUD12^PXKMAIN1,DRDIE^PXKMAIN1,EN1^PXKMASC
"RTN","PXKMAIN",112,0)
 ..I PXKFGED=1,PXKCAT="VST" S PXKRT=$P($T(GLOBAL^@PXKRTN),";;",2)_"("_PXKPIEN_")" Q:'$D(@PXKRT)  S DA=PXKPIEN D DUP^PXKMAIN1 Q:PXFG=1  D DRDIE^PXKMAIN1,EN1^PXKMASC
"RTN","PXKMAIN",113,0)
 ..D SPEC^PXKMAIN2
"RTN","PXKMAIN",114,0)
 ..K PXKAFT,PXKBEF
"RTN","PXKMAIN",115,0)
 I $D(^TMP("PXKSAVE",$J)) D RECALL^PXKMAIN2
"RTN","PXKMAIN",116,0)
 ;PX*1*124  AUTO-POPULATE THE ENCOUNTER SC/EI BASED ON THE ENCOUNTER DX'S
"RTN","PXKMAIN",117,0)
 D VST^PXCECCLS(PXKPIEN)
"RTN","PXKMAIN",118,0)
 D EXIT
"RTN","PXKMAIN",119,0)
 Q
"RTN","PXKMAIN",120,0)
EXIT ;--EXIT
"RTN","PXKMAIN",121,0)
 I $D(PXKFVDLM) D MODIFIED^VSIT(PXKVST)
"RTN","PXKMAIN",122,0)
 K PXKPXD,TMPPX
"RTN","PXKMAIN",123,0)
 K DA,DR,PXKI,PXKJ,PXKLAYGO,PXKDUZ,PXKAFT8,PXKAFTR,VSIT("IEN") Q
"RTN","PXKMAIN",124,0)
EVENT ;--ENTRY POINT TO POST EXECUTE PCE'S EVENT
"RTN","PXKMAIN",125,0)
 ;Setting the variable PXKNOEVT=1 will stop the event from being
"RTN","PXKMAIN",126,0)
 ;fired off whenever any data is sent into PCE
"RTN","PXKMAIN",127,0)
 ;
"RTN","PXKMAIN",128,0)
 I $G(PXKNOEVT) K ^TMP("PXKCO",$J) Q
"RTN","PXKMAIN",129,0)
 N PXP59LOC
"RTN","PXKMAIN",130,0)
 D LOCK
"RTN","PXKMAIN",131,0)
 D EVENT^PXKMASC
"RTN","PXKMAIN",132,0)
 I $D(PXP59LOC) D UNLOCK
"RTN","PXKMAIN",133,0)
 Q
"RTN","PXKMAIN",134,0)
LOCK ; Lock (results in PXP59LOC)--Patch PX*1.0*59.
"RTN","PXKMAIN",135,0)
 N PX0,PXWHO,PXWHERE,PXWHEN,PXEXIT,PXVISIT
"RTN","PXKMAIN",136,0)
 S PXEXIT=1,(PXWHO,PXWHERE,PXWHEN)=""
"RTN","PXKMAIN",137,0)
 ;First case: new visit data being saved.
"RTN","PXKMAIN",138,0)
 I 11[$D(^TMP("PXK",$J,"VST",1,0,"AFTER")) D
"RTN","PXKMAIN",139,0)
 . S PX0=^TMP("PXK",$J,"VST",1,0,"AFTER")
"RTN","PXKMAIN",140,0)
 . D L2
"RTN","PXKMAIN",141,0)
 ;Second case: use existing visit data.
"RTN","PXKMAIN",142,0)
 I 11[$D(^TMP("PXK",$J,"VST",1,"IEN")) D
"RTN","PXKMAIN",143,0)
 . S PXVISIT=+^TMP("PXK",$J,"VST",1,"IEN")
"RTN","PXKMAIN",144,0)
 . Q:'PXVISIT
"RTN","PXKMAIN",145,0)
 . Q:$D(^AUPNVSIT(PXVISIT,0))[0
"RTN","PXKMAIN",146,0)
 . S PX0=^AUPNVSIT(PXVISIT,0)
"RTN","PXKMAIN",147,0)
 . D L2
"RTN","PXKMAIN",148,0)
 ;Third case: Uses "PXKCO" instead of "PXK".
"RTN","PXKMAIN",149,0)
 I PXEXIT,$D(^TMP("PXKCO",$J)) D
"RTN","PXKMAIN",150,0)
 . S PXVISIT=$O(^TMP("PXKCO",$J,0))
"RTN","PXKMAIN",151,0)
 . Q:'PXVISIT
"RTN","PXKMAIN",152,0)
 . S PX0=$G(^TMP("PXKCO",$J,PXVISIT,"VST",PXVISIT,0,"AFTER"))
"RTN","PXKMAIN",153,0)
 . Q:PX0=""
"RTN","PXKMAIN",154,0)
 . D L2
"RTN","PXKMAIN",155,0)
 ;Fourth case: Uses "PXKENC" instead of "PXK".
"RTN","PXKMAIN",156,0)
 I PXEXIT,$D(^TMP("PXKENC",$J)) D
"RTN","PXKMAIN",157,0)
 . S PXVISIT=$O(^TMP("PXKENC",$J,0))
"RTN","PXKMAIN",158,0)
 . Q:'PXVISIT
"RTN","PXKMAIN",159,0)
 . S PX0=$G(^TMP("PXKENC",$J,PXVISIT,"VST",PXVISIT,0)) ; Look at ^TMP("PXKENC",$J
"RTN","PXKMAIN",160,0)
 . Q:PX0=""
"RTN","PXKMAIN",161,0)
 . D L2
"RTN","PXKMAIN",162,0)
 I PXEXIT Q  ; Unable to obtain non-null subscripts.
"RTN","PXKMAIN",163,0)
 S PXP59LOC=$NA(^PXLOCK(PXWHO,PXWHERE,PXWHEN))
"RTN","PXKMAIN",164,0)
 L +@PXP59LOC:300
"RTN","PXKMAIN",165,0)
 E  K PXP59LOC ; Lock was unsuccessful.
"RTN","PXKMAIN",166,0)
 Q
"RTN","PXKMAIN",167,0)
L2 ; Get values from visit 0 node (PX0).
"RTN","PXKMAIN",168,0)
 I 'PXWHO S PXWHO=$P(PX0,U,5)
"RTN","PXKMAIN",169,0)
 I 'PXWHEN S PXWHEN=$P(PX0,U,1)
"RTN","PXKMAIN",170,0)
 I 'PXWHERE S PXWHERE=+$P(PX0,U,22)
"RTN","PXKMAIN",171,0)
 I PXWHO,PXWHEN S PXEXIT=0
"RTN","PXKMAIN",172,0)
 Q
"RTN","PXKMAIN",173,0)
UNLOCK ; Unlock (use info in PXP59LOC)--Patch PX*1.0*59.
"RTN","PXKMAIN",174,0)
 L -@PXP59LOC
"RTN","PXKMAIN",175,0)
 Q
"RTN","PXKMAIN",176,0)
 ;
"RTN","PXKMAIN",177,0)
CQDEL ;Classification question deletion check
"RTN","PXKMAIN",178,0)
 I PXKCAT'="VST" Q
"RTN","PXKMAIN",179,0)
 S PXJ="" F  S PXJ=$O(PXKBV(800,PXJ)) Q:'PXJ  I PXKBV(800,PXJ)'="" I '$D(PXKAV(800,PXJ)) S PXKAV(800,PXJ)="@"
"RTN","PXKMAIN",180,0)
 K PXJ Q
"RTN","PXKMAIN1")
0^55^B37255334
"RTN","PXKMAIN1",1,0)
PXKMAIN1 ;ISL/JVS,ISA/Zoltan - Main Routine for Data Capture ;5/6/1999
"RTN","PXKMAIN1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,73,124**;Aug 12, 1996
"RTN","PXKMAIN1",3,0)
 ;+This routine is responsible for:
"RTN","PXKMAIN1",4,0)
 ;+ - creating new entries in PCE files,
"RTN","PXKMAIN1",5,0)
 ;+ - processing modifications to existing entries,
"RTN","PXKMAIN1",6,0)
 ;+ - deleting entries,
"RTN","PXKMAIN1",7,0)
 ;+ - ensuring all required variables are present,
"RTN","PXKMAIN1",8,0)
 ;+ - setting both Audit fields (EDITED FLAG and AUDIT TRAIL),
"RTN","PXKMAIN1",9,0)
 ;+ - checking for duplicate entries,
"RTN","PXKMAIN1",10,0)
 ;+ - some error reporting.
"RTN","PXKMAIN1",11,0)
 ;+
"RTN","PXKMAIN1",12,0)
 ;+LOCAL VARIABLE LIST
"RTN","PXKMAIN1",13,0)
 ;+ MOST VARIABLES ARE DEFINED AT THE TOP OF  PXKMAIN
"RTN","PXKMAIN1",14,0)
 ;+ PXKSEQ   = Sequence number in PXK tmp global
"RTN","PXKMAIN1",15,0)
 ;+ PXKCAT   = Category of entry (CPT,MSR,VST...)
"RTN","PXKMAIN1",16,0)
 ;+ PXKREF   = Root of temp global
"RTN","PXKMAIN1",17,0)
 ;+ PXKPIEN  = IEN of v file
"RTN","PXKMAIN1",18,0)
 ;+ PXKAUDIT = data located in the audit field of the v file
"RTN","PXKMAIN1",19,0)
 ;+ PXKER    = field data use to build the dr string (eg .04///^S X=$G()
"RTN","PXKMAIN1",20,0)
 ;+ PXKFLD   = field number gleened from the file routines
"RTN","PXKMAIN1",21,0)
 ;+ PXKNOD   = same as the subscript in a global node
"RTN","PXKMAIN1",22,0)
 ;+ PXKPCE   = the piece where the data is found on that node
"RTN","PXKMAIN1",23,0)
 ;
"RTN","PXKMAIN1",24,0)
 ;
"RTN","PXKMAIN1",25,0)
 W !,"This is not an entry point" Q
"RTN","PXKMAIN1",26,0)
LOOP ;+Copy delimited strings into sub-arrays.
"RTN","PXKMAIN1",27,0)
 F PXKI=1:1:$L(PXKAFT(PXKSUB),"^") I $P(PXKAFT(PXKSUB),"^",PXKI)'="" S PXKAV(PXKSUB,PXKI)=$P(PXKAFT(PXKSUB),"^",PXKI)
"RTN","PXKMAIN1",28,0)
 F PXKI=1:1:$L(PXKBEF(PXKSUB),"^") I $P(PXKBEF(PXKSUB),"^",PXKI)'="" S PXKBV(PXKSUB,PXKI)=$P(PXKBEF(PXKSUB),"^",PXKI)
"RTN","PXKMAIN1",29,0)
 K PXKI,PXKJ ; Not sure if NEW would be OK.
"RTN","PXKMAIN1",30,0)
 I PXKCAT="CPT",PXKSUB=1 D LOOP^PXKMOD
"RTN","PXKMAIN1",31,0)
 Q
"RTN","PXKMAIN1",32,0)
 ;
"RTN","PXKMAIN1",33,0)
ERROR ;+Check for missing required fields
"RTN","PXKMAIN1",34,0)
 Q:$G(PXKAV(0,1))["@"!('$D(PXKAV(0,1)))
"RTN","PXKMAIN1",35,0)
 S PXKNOD=0,PXKPCE=0
"RTN","PXKMAIN1",36,0)
 D EN1^@PXKRTN
"RTN","PXKMAIN1",37,0)
 S PXKER=$P(PXKER," * ",1)
"RTN","PXKMAIN1",38,0)
 I PXKER="" Q
"RTN","PXKMAIN1",39,0)
 F PXJ=1:1:$L(PXKER,",") D
"RTN","PXKMAIN1",40,0)
 . S PXJJ=$P(PXKER,",",PXJ)
"RTN","PXKMAIN1",41,0)
 . I '$D(PXKAV(PXKNOD,PXJJ)) D
"RTN","PXKMAIN1",42,0)
 . . S PXKPCE=PXJJ
"RTN","PXKMAIN1",43,0)
 . . D EN2^@PXKRTN
"RTN","PXKMAIN1",44,0)
 . . S PXKFLD=$P(PXKFD,"/",1)
"RTN","PXKMAIN1",45,0)
 . . S:PXKFLD["*" PXKFLD=$P(PXKFLD," * ",2)
"RTN","PXKMAIN1",46,0)
 . . S PXKERROR(PXKCAT,PXKSEQ,0,PXKFLD)="Missing Required Fields"
"RTN","PXKMAIN1",47,0)
 K PXK,PXJJ,PXKFLD,PXKFD ; Not sure about use of NEW here.
"RTN","PXKMAIN1",48,0)
 Q
"RTN","PXKMAIN1",49,0)
 ;
"RTN","PXKMAIN1",50,0)
CLEAN ;--Clean out the PXKAV array
"RTN","PXKMAIN1",51,0)
 S PXKJ=""
"RTN","PXKMAIN1",52,0)
 F  S PXKJ=$O(PXKBV(PXKJ)) Q:PXKJ=""  D
"RTN","PXKMAIN1",53,0)
 . S PXKI=""
"RTN","PXKMAIN1",54,0)
 . F  S PXKI=$O(PXKBV(PXKJ,PXKI)) Q:PXKI=""  D
"RTN","PXKMAIN1",55,0)
 . . I $G(PXKBV(PXKJ,PXKI))=$G(PXKAV(PXKJ,PXKI)) K PXKAV(PXKJ,PXKI)
"RTN","PXKMAIN1",56,0)
 K PXKI,PXKJ ; Not sure about NEW here.
"RTN","PXKMAIN1",57,0)
 Q
"RTN","PXKMAIN1",58,0)
 ;
"RTN","PXKMAIN1",59,0)
FILE ;+Create a new entry in file and get IEN
"RTN","PXKMAIN1",60,0)
 ;+This is the code that adds new entries to V-files
"RTN","PXKMAIN1",61,0)
 ;+and to the Visit file.
"RTN","PXKMAIN1",62,0)
 K DD,DO
"RTN","PXKMAIN1",63,0)
 S DIC=$P($T(GLOBAL^@PXKRTN),";;",2)_"("
"RTN","PXKMAIN1",64,0)
 S DIC(0)=""
"RTN","PXKMAIN1",65,0)
 S X=$G(PXKAV(0,1))
"RTN","PXKMAIN1",66,0)
 D FILE^DICN
"RTN","PXKMAIN1",67,0)
 S (PXKPIEN,DA)=+Y
"RTN","PXKMAIN1",68,0)
 S DR=""
"RTN","PXKMAIN1",69,0)
 K DIC,Y,X
"RTN","PXKMAIN1",70,0)
 Q
"RTN","PXKMAIN1",71,0)
 ;
"RTN","PXKMAIN1",72,0)
AUD12 ;--Set both audit fields
"RTN","PXKMAIN1",73,0)
 S DR=""
"RTN","PXKMAIN1",74,0)
 S PXKAUDIT=$P($T(GLOBAL^@PXKRTN),";;",2)_"(DA,801)"
"RTN","PXKMAIN1",75,0)
 S PXKAUDIT=$P($G(@PXKAUDIT),"^",2)_PXKSORR_";"
"RTN","PXKMAIN1",76,0)
 I $L(PXKAUDIT,";")>5 S $P(PXKAUDIT,";",2,$L(PXKAUDIT,";"))="+;"_$P(PXKAUDIT,";",4,$L(PXKAUDIT,";")) ;PX*1*124   Change 8 to 5
"RTN","PXKMAIN1",77,0)
 S PXKNOD=801
"RTN","PXKMAIN1",78,0)
 S DR=""
"RTN","PXKMAIN1",79,0)
 F PXKPCE=1,2 D EN1^@PXKRTN S DR=DR_PXKER
"RTN","PXKMAIN1",80,0)
 S PXKFVDLM=""
"RTN","PXKMAIN1",81,0)
 Q
"RTN","PXKMAIN1",82,0)
 ;
"RTN","PXKMAIN1",83,0)
AUD2 ;--Set second audit fields
"RTN","PXKMAIN1",84,0)
 S DR=""
"RTN","PXKMAIN1",85,0)
 S PXKAUDIT=$P($T(GLOBAL^@PXKRTN),";;",2)_"(DA,801)"
"RTN","PXKMAIN1",86,0)
 S PXKAUDIT=$P($G(@PXKAUDIT),"^",2)_PXKSORR_";"
"RTN","PXKMAIN1",87,0)
 I $L(PXKAUDIT,";")>5 S $P(PXKAUDIT,";",2,$L(PXKAUDIT,";"))="+;"_$P(PXKAUDIT,";",4,$L(PXKAUDIT,";")) ;PX*1*124   Change 8 to 5
"RTN","PXKMAIN1",88,0)
 S PXKNOD=801
"RTN","PXKMAIN1",89,0)
 S DR=""
"RTN","PXKMAIN1",90,0)
 S PXKPCE=2
"RTN","PXKMAIN1",91,0)
 D EN1^@PXKRTN
"RTN","PXKMAIN1",92,0)
 S DR=DR_PXKER
"RTN","PXKMAIN1",93,0)
 S PXKFVDLM=""
"RTN","PXKMAIN1",94,0)
 Q
"RTN","PXKMAIN1",95,0)
 ;
"RTN","PXKMAIN1",96,0)
DRDIE ;--Set the DR string and DO DIE
"RTN","PXKMAIN1",97,0)
 I PXKCAT="VST" D UPD^PXKFVST Q
"RTN","PXKMAIN1",98,0)
 S DIE=$P($T(GLOBAL^@PXKRTN),";;",2)_"(" K PXKPTR
"RTN","PXKMAIN1",99,0)
 S PXKLR=$P($T(GLOBAL^@PXKRTN),";;",2)_"(DA)"
"RTN","PXKMAIN1",100,0)
 S PXKNOD=""
"RTN","PXKMAIN1",101,0)
 F  S PXKNOD=$O(PXKAV(PXKNOD)) Q:PXKNOD=""  D
"RTN","PXKMAIN1",102,0)
 . I PXKFGAD=1,PXKNOD=0 S PXKPCE=1 D
"RTN","PXKMAIN1",103,0)
 .. Q:PXKCAT'="CPT"
"RTN","PXKMAIN1",104,0)
 .. I $G(^TMP("PXK",$J,PXKCAT,PXKSEQ,"IEN"))=PXKPIEN S PXKPCE=3
"RTN","PXKMAIN1",105,0)
 . I PXKFGAD=1,PXKNOD'=0 S PXKPCE=0
"RTN","PXKMAIN1",106,0)
 . I PXKFGED=1 S PXKPCE=0
"RTN","PXKMAIN1",107,0)
 . I PXKCAT="CPT",PXKNOD=1 D  Q
"RTN","PXKMAIN1",108,0)
 .. D DIE
"RTN","PXKMAIN1",109,0)
 .. I $G(^TMP("PXK",$J,PXKCAT,PXKSEQ,"IEN"))]"" Q
"RTN","PXKMAIN1",110,0)
 .. D UPD^PXKMOD
"RTN","PXKMAIN1",111,0)
 . F  S PXKPCE=$O(PXKAV(PXKNOD,PXKPCE)) Q:PXKPCE=""  D
"RTN","PXKMAIN1",112,0)
 ..D EN1^@PXKRTN
"RTN","PXKMAIN1",113,0)
 ..I $G(PXKER)'="" D
"RTN","PXKMAIN1",114,0)
 ...I PXKER["~" D
"RTN","PXKMAIN1",115,0)
 ....I $P(PXKER,"~",2)["A",PXKFGAD=1 S PXKER=$P(PXKER,"~") Q
"RTN","PXKMAIN1",116,0)
 ....I $P(PXKER,"~",2)'["A",PXKFGAD=1 S PXKER="" Q
"RTN","PXKMAIN1",117,0)
 ....I $P(PXKER,"~",2)["E",PXKFGED=1 S PXKER=$P(PXKER,"~") Q
"RTN","PXKMAIN1",118,0)
 ....I $P(PXKER,"~",2)'["E",PXKFGED=1 S PXKER="" Q
"RTN","PXKMAIN1",119,0)
 ...I +PXKER=0 D
"RTN","PXKMAIN1",120,0)
 ....I PXKAV(PXKNOD,PXKPCE)=+PXKAV(PXKNOD,PXKPCE) S PXKER=$P(PXKER," * ",2)
"RTN","PXKMAIN1",121,0)
 ....I PXKAV(PXKNOD,PXKPCE)'=+PXKAV(PXKNOD,PXKPCE) S PXKER=$P(PXKER," * ",3),PXKPTR(PXKPIEN,PXKNOD,PXKPCE)=""
"RTN","PXKMAIN1",122,0)
 ..I $G(PXKER)'="" S DR=DR_PXKER_"PXKAV("_PXKNOD_","_PXKPCE_"));"
"RTN","PXKMAIN1",123,0)
 ..I $L(DR)>200 D DIE
"RTN","PXKMAIN1",124,0)
 D DIE
"RTN","PXKMAIN1",125,0)
 K DIE,PXKLR,DIC(0)
"RTN","PXKMAIN1",126,0)
 D ER
"RTN","PXKMAIN1",127,0)
 Q
"RTN","PXKMAIN1",128,0)
DIE ;+Lock global and invoke FM ^DIE call.
"RTN","PXKMAIN1",129,0)
 L +@PXKLR:10
"RTN","PXKMAIN1",130,0)
 D ^DIE
"RTN","PXKMAIN1",131,0)
 L -@PXKLR
"RTN","PXKMAIN1",132,0)
 K DR
"RTN","PXKMAIN1",133,0)
 S DR=""
"RTN","PXKMAIN1",134,0)
 Q
"RTN","PXKMAIN1",135,0)
 ;
"RTN","PXKMAIN1",136,0)
DELETE ;+Use FM ^DIK call to delete entry identified by PXKPIEN.
"RTN","PXKMAIN1",137,0)
 S DA=PXKPIEN
"RTN","PXKMAIN1",138,0)
 S DIK=$P($T(GLOBAL^@PXKRTN),";;",2)_"("
"RTN","PXKMAIN1",139,0)
 D ^DIK
"RTN","PXKMAIN1",140,0)
 K DIK
"RTN","PXKMAIN1",141,0)
 Q
"RTN","PXKMAIN1",142,0)
 ;
"RTN","PXKMAIN1",143,0)
DUP ;+Code to check for duplicates
"RTN","PXKMAIN1",144,0)
 I PXKCAT="VST" Q
"RTN","PXKMAIN1",145,0)
 I PXKCAT="CPT" Q
"RTN","PXKMAIN1",146,0)
 N PXKRTN
"RTN","PXKMAIN1",147,0)
 I '$D(PXKPIEN) N PXKPIEN S PXKPIEN=""
"RTN","PXKMAIN1",148,0)
 S PXKNOD=0
"RTN","PXKMAIN1",149,0)
 S PXKPCE=0
"RTN","PXKMAIN1",150,0)
 S PXKRTN="PXKF"_PXKVCAT
"RTN","PXKMAIN1",151,0)
 S PXKVRTN=$P($T(GLOBAL^@PXKRTN),";;",2)
"RTN","PXKMAIN1",152,0)
 S PXJJJ=0
"RTN","PXKMAIN1",153,0)
 D EN1^@PXKRTN
"RTN","PXKMAIN1",154,0)
 I $P(PXKER," * ",3)'=0 D
"RTN","PXKMAIN1",155,0)
 .S PXKER=$P(PXKER," * ",2)
"RTN","PXKMAIN1",156,0)
 .I PXKER="" Q
"RTN","PXKMAIN1",157,0)
 .S (PX,PXFG)=0
"RTN","PXKMAIN1",158,0)
 .F  S PX=$O(@PXKVRTN@("AD",PXKVST,PX)) Q:PX=""  D  Q:PXFG=1
"RTN","PXKMAIN1",159,0)
 ..S PXJJJ=0
"RTN","PXKMAIN1",160,0)
 ..F PXJ=1:1:$L(PXKER,",") S PXJJ=$P(PXKER,",",PXJ) D
"RTN","PXKMAIN1",161,0)
 ...I $P($G(@PXKVRTN@(PX,$P(PXJJ,"+",1))),"^",$P(PXJJ,"+",2))=$G(PXKAV($P(PXJJ,"+",1),$P(PXJJ,"+",2))),PX'=PXKPIEN S PXJJJ=PXJJJ+1
"RTN","PXKMAIN1",162,0)
 ..I $L(PXKER,",")=PXJJJ S PXFG=1
"RTN","PXKMAIN1",163,0)
 ;PXKHLR Is not killed because it is a flag comming from another routine
"RTN","PXKMAIN1",164,0)
 Q
"RTN","PXKMAIN1",165,0)
 ;
"RTN","PXKMAIN1",166,0)
ER ;--PXKERROR MAKING IF NOT POPULATED CORRECTLY
"RTN","PXKMAIN1",167,0)
 N PXKRT,PXKMOD,PXKSTR
"RTN","PXKMAIN1",168,0)
 S PXKMOD=PXKSEQ#1 I $G(PXKMOD) Q
"RTN","PXKMAIN1",169,0)
 S PXKN=""
"RTN","PXKMAIN1",170,0)
 F  S PXKN=$O(PXKAV(PXKN)) Q:PXKN=""  D
"RTN","PXKMAIN1",171,0)
 . S PXKP=""
"RTN","PXKMAIN1",172,0)
 . F  S PXKP=$O(PXKAV(PXKN,PXKP)) Q:PXKP=""  D
"RTN","PXKMAIN1",173,0)
 .. S PXKRRT=$P($T(GLOBAL^@PXKRTN),";;",2)_"("_DA_","
"RTN","PXKMAIN1",174,0)
 .. I PXKN=1,PXKCAT="CPT" S PXKRRT=PXKRRT_PXKN_","_PXKP_","_0_")"
"RTN","PXKMAIN1",175,0)
 .. E  S PXKRRT=PXKRRT_PXKN_")"
"RTN","PXKMAIN1",176,0)
 .. I PXKAV(PXKN,PXKP)'=$P($G(@PXKRRT),"^",$S(PXKN=1:1,1:PXKP)) D
"RTN","PXKMAIN1",177,0)
 ... Q:PXKAV(PXKN,PXKP)["@"
"RTN","PXKMAIN1",178,0)
 ... S PXKNOD=PXKN,PXKPCE=PXKP
"RTN","PXKMAIN1",179,0)
 ... I PXKNOD=1,PXKCAT="CPT" S PXKPCE=1
"RTN","PXKMAIN1",180,0)
 ... D EN2^@PXKRTN
"RTN","PXKMAIN1",181,0)
 ... S PXKFLD=$P(PXKFD,"/",1)
"RTN","PXKMAIN1",182,0)
 ... S:PXKFLD["*" PXKFLD=$P(PXKFLD," * ",2)
"RTN","PXKMAIN1",183,0)
 ... Q:PXKFLD=1101
"RTN","PXKMAIN1",184,0)
 ... S PXKSTR="Not Stored = "_PXKAV(PXKN,PXKP)
"RTN","PXKMAIN1",185,0)
 ... I $G(PXKERROR(PXKCAT,PXKSEQ,DA,PXKFLD))]"" D
"RTN","PXKMAIN1",186,0)
 .... S PXKSTR=PXKERROR(PXKCAT,PXKSEQ,DA,PXKFLD)_","_PXKAV(PXKN,PXKP)
"RTN","PXKMAIN1",187,0)
 ... S PXKERROR(PXKCAT,PXKSEQ,DA,PXKFLD)=PXKSTR
"RTN","PXKMAIN1",188,0)
 Q
"RTN","PXRRMDR")
0^69^B81741465
"RTN","PXRRMDR",1,0)
PXRRMDR ;BP/WLC - PCE Missing Data Report ;11 Feb 04  10:10 AM
"RTN","PXRRMDR",2,0)
 ;;1.0;PCE;**124**;FEB 11, 2004
"RTN","PXRRMDR",3,0)
 ; 04/11/05 WLC changed to check for AO, IR and EC, only if SC'=YES
"RTN","PXRRMDR",4,0)
 Q
"RTN","PXRRMDR",5,0)
 ;
"RTN","PXRRMDR",6,0)
EN N PX,PXPAGE,PXLOC,PXPROV,SDDIV,ZTSAVE,%DT,DIR,DTOUT,DUOUT,X,Y,POP,PXDT,PXDS,RPTYP,EDT,PAT,SSN,DT,TY,CBU,VDT,LOC,PROV,SORT,SORTHDR,CNT,PRIO
"RTN","PXRRMDR",7,0)
 S (POP,PXPAGE)=0
"RTN","PXRRMDR",8,0)
 K PXDS
"RTN","PXRRMDR",9,0)
 D HOME^%ZIS S:'$D(IOF) IOF=FF W @IOF,!!
"RTN","PXRRMDR",10,0)
 S X=$$CTR("PCE Missing Data Report")
"RTN","PXRRMDR",11,0)
 W !! D DATASRC G:POP EXIT   ; sets PXDS()
"RTN","PXRRMDR",12,0)
 W @IOF,!! S X=$$CTR("**** Date Range Selection ****")
"RTN","PXRRMDR",13,0)
 W !!! S %DT="AEPX",%DT("A")="Beginning date: " D ^%DT G:Y<1 EXIT S PX("BDT")=Y
"RTN","PXRRMDR",14,0)
EDT S %DT("A")="   Ending date: " W ! D ^%DT G:Y<1 EXIT
"RTN","PXRRMDR",15,0)
 I Y<PX("BDT") W !!,$C(7),"End date cannot be before begin date!",! G EDT
"RTN","PXRRMDR",16,0)
 S PX("EDT")=Y_.999999
"RTN","PXRRMDR",17,0)
 W @IOF,!! S X=$$CTR("*** Report Sort Selection ***")
"RTN","PXRRMDR",18,0)
 W !!! K DIR S SORTHDR="DATA SOURCE^CPT^ICD9^PATIENT^ELIGIBILITY"
"RTN","PXRRMDR",19,0)
 F LOOP=1:1:$L(SORTHDR,U) S DESC=$P(SORTHDR,U,LOOP) W !,"("_LOOP_")  "_DESC
"RTN","PXRRMDR",20,0)
 W ! S DIR(0)="N^^I X<1!(X>5) K X",DIR("A")="Enter number between 1 and 5" D ^DIR Q:$D(DIRUT)  S PXSRT=+X
"RTN","PXRRMDR",21,0)
 S DIR(0)="S^D:DETAILED REPORT;S:STATISTICS ONLY",DIR("A")="Select report type",DIR("B")="DETAILED REPORT" D ^DIR Q:$D(DIRUT)
"RTN","PXRRMDR",22,0)
 S RPTYP=Y
"RTN","PXRRMDR",23,0)
 W !!,"This report requires 132 column output.",!
"RTN","PXRRMDR",24,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","PXRRMDR",25,0)
 I $D(IO("Q")) D  G EXIT
"RTN","PXRRMDR",26,0)
 . S ZTRTN="RUN^PXRRMDR",ZTDESC="PCE MISSING DATA REPORT"
"RTN","PXRRMDR",27,0)
 . S ZTSAVE("PX*")=""
"RTN","PXRRMDR",28,0)
 . S ZTSAVE("RPTYP")="",ZTSAVE("SORTHDR")=""
"RTN","PXRRMDR",29,0)
 . D ^%ZTLOAD W !!,$S($D(ZTSK):"This job has been queued.  The task number is "_ZTSK_".",1:"Unable to queue this job.")
"RTN","PXRRMDR",30,0)
 .K ZTSK,IO("Q"),ZTSAVE D HOME^%ZIS
"RTN","PXRRMDR",31,0)
 ;
"RTN","PXRRMDR",32,0)
RUN ;
"RTN","PXRRMDR",33,0)
 U IO
"RTN","PXRRMDR",34,0)
 K ^TMP("PXCRPW",$J),DIR S (PXOUT)=""
"RTN","PXRRMDR",35,0)
 N LOOP,PXDT,I,VSN,VISITS,CLASSIF
"RTN","PXRRMDR",36,0)
 S PXDT=(PX("BDT")-1)_.99999 K ^TMP("PXCRPW",$J)
"RTN","PXRRMDR",37,0)
 F  S PXDT=$O(^AUPNVSIT("ADEL",PXDT)) Q:PXDT>PX("EDT")!('PXDT)  D
"RTN","PXRRMDR",38,0)
 . S VSN=0 F  S VSN=$O(^AUPNVSIT("ADEL",PXDT,VSN)) Q:'VSN  D
"RTN","PXRRMDR",39,0)
 . . S VISITS=$P($G(^AUPNVSIT(VSN,812)),U,3) S:VISITS="" VISITS="Unknown"
"RTN","PXRRMDR",40,0)
 . . Q:'$D(PXDS(VISITS))
"RTN","PXRRMDR",41,0)
 . . D ENCEVENT^PXKENC(VSN,0)
"RTN","PXRRMDR",42,0)
 . . I '$D(^TMP("PXKENC",$J,VSN,"CPT")) D SET("Visit is missing a Procedure Code",1) Q
"RTN","PXRRMDR",43,0)
 . . N I,J S (I,CNT)=0 F  S I=$O(^TMP("PXKENC",$J,VSN,"CPT",I)) Q:'I  D
"RTN","PXRRMDR",44,0)
 . . . S CNT=0 F J=5,9,10,11,12,13,14,15 I $P(^TMP("PXKENC",$J,VSN,"CPT",I,0),U,J) S CNT=CNT+1
"RTN","PXRRMDR",45,0)
 . . . I CNT=0 D SET("Procedure: "_$$DISPLYP($P(^TMP("PXKENC",$J,VSN,"CPT",I,0),U))_" missing assoc. DXs",1)
"RTN","PXRRMDR",46,0)
 . . S (I,J)=0 F  S I=$O(^TMP("PXKENC",$J,VSN,"POV",I)) Q:'I  D
"RTN","PXRRMDR",47,0)
 . . . K CLASSIF S DFN=$$GET1^DIQ(9000010,VSN_",",.05,"I")
"RTN","PXRRMDR",48,0)
 . . . I $$AO^SDCO22(DFN) S CLASSIF(1)=""
"RTN","PXRRMDR",49,0)
 . . . I $$IR^SDCO22(DFN) S CLASSIF(2)=""
"RTN","PXRRMDR",50,0)
 . . . I $$SC^SDCO22(DFN) S CLASSIF(3)=""
"RTN","PXRRMDR",51,0)
 . . . I $$EC^SDCO22(DFN) S CLASSIF(4)=""
"RTN","PXRRMDR",52,0)
 . . . I $$MST^SDCO22(DFN) S CLASSIF(5)=""
"RTN","PXRRMDR",53,0)
 . . . I $$HNC^SDCO22(DFN) S CLASSIF(6)=""
"RTN","PXRRMDR",54,0)
 . . . I +$P($$CVEDT^DGCV(DFN,PXDT),"^",3) S CLASSIF(7)=""
"RTN","PXRRMDR",55,0)
 . . . I $D(CLASSIF),'$D(^TMP("PXKENC",$J,VSN,"POV",I,800)) D SET("Diagnosis: "_$$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing SC/EI",1) Q
"RTN","PXRRMDR",56,0)
 . . . S J="" F  S J=$O(CLASSIF(J)) Q:'J  D
"RTN","PXRRMDR",57,0)
 . . . . N SCEIREC S SCEIREC=$G(^TMP("PXKENC",$J,VSN,"POV",I,800))
"RTN","PXRRMDR",58,0)
 . . . . I J=3&($P(SCEIREC,U,1)="") D SET("Diagnosis: "_$$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Service Connect.",1)
"RTN","PXRRMDR",59,0)
 . . . . I J=1&($P(SCEIREC,U,2)="")&($P(SCEIREC,U,1)'=1) D SET("Diagnosis: "_$$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Agent Orange",3)
"RTN","PXRRMDR",60,0)
 . . . . I J=2&($P(SCEIREC,U,3)="")&($P(SCEIREC,U,1)'=1) D SET("Diagnosis: "_$$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Ion. Rad.",4)
"RTN","PXRRMDR",61,0)
 . . . . I J=4&($P(SCEIREC,U,4)="")&($P(SCEIREC,U,1)'=1) D SET("Diagnosis: "_$$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Env. Contam.",5)
"RTN","PXRRMDR",62,0)
 . . . . I J=5&($P(SCEIREC,U,5)="") D SET("Diagnosis: "_$$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing MST",6)
"RTN","PXRRMDR",63,0)
 . . . . I J=6&($P(SCEIREC,U,6)="") D SET("Diagnosis: "_$$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Head/Neck Cancer",6)
"RTN","PXRRMDR",64,0)
 . . . . I J=7&($P(SCEIREC,U,7)="") D SET("Diagnosis: "_$$DISPLYDX($P(^TMP("PXKENC",$J,VSN,"POV",I,0),U))_" missing Combat Vet",2)
"RTN","PXRRMDR",65,0)
 U IO D PRINT,^%ZISC
"RTN","PXRRMDR",66,0)
 K ^TMP("PXCRPW",$J)
"RTN","PXRRMDR",67,0)
EXIT Q
"RTN","PXRRMDR",68,0)
 ;
"RTN","PXRRMDR",69,0)
STOP ;Check for stop task request
"RTN","PXRRMDR",70,0)
 S:$G(ZTQUEUED) (PXOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0)
"RTN","PXRRMDR",71,0)
 Q
"RTN","PXRRMDR",72,0)
 ;
"RTN","PXRRMDR",73,0)
EVAL ;
"RTN","PXRRMDR",74,0)
 S PXLOC=$$GET1^DIQ(9000010,VSN_",",.22)
"RTN","PXRRMDR",75,0)
 S:$G(PXLOC)="" PXLOC="Unknown"
"RTN","PXRRMDR",76,0)
 N PXPTR S PXPTR=$O(^AUPNVPRV("AD",VSN,""))
"RTN","PXRRMDR",77,0)
 S PXPRV=$$GET1^DIQ(9000010.06,PXPTR_",",.01)
"RTN","PXRRMDR",78,0)
 S:$G(PRPRV)="" PXPRV="Unknown"
"RTN","PXRRMDR",79,0)
 Q
"RTN","PXRRMDR",80,0)
 ;
"RTN","PXRRMDR",81,0)
DISPLYDX(PXCEPOV)       ;
"RTN","PXRRMDR",82,0)
 N ICDSTR
"RTN","PXRRMDR",83,0)
 S ICDSTR=$$ICDDX^ICDCODE($P(PXCEPOV,"^"),$P(^AUPNVSIT(VSN,0),"^"))
"RTN","PXRRMDR",84,0)
 Q $P(ICDSTR,"^",2) ;code
"RTN","PXRRMDR",85,0)
 ;
"RTN","PXRRMDR",86,0)
DISPLYP(PXCECPT) ;
"RTN","PXRRMDR",87,0)
 N CPTSTR
"RTN","PXRRMDR",88,0)
 S CPTSTR=$$CPT^ICPTCOD($P(PXCECPT,U),$P(^AUPNVSIT(VSN,0),"^"))
"RTN","PXRRMDR",89,0)
 Q $P(CPTSTR,U,2) ;code
"RTN","PXRRMDR",90,0)
 ;
"RTN","PXRRMDR",91,0)
SET(SDX,PRIO) ;
"RTN","PXRRMDR",92,0)
 N A1
"RTN","PXRRMDR",93,0)
 S PRIO=$G(PRIO)
"RTN","PXRRMDR",94,0)
 D EVAL
"RTN","PXRRMDR",95,0)
 I PXSRT="" S A1="Unknown" D SET1(PRIO) Q
"RTN","PXRRMDR",96,0)
 D @PXSRT
"RTN","PXRRMDR",97,0)
 Q
"RTN","PXRRMDR",98,0)
 ;
"RTN","PXRRMDR",99,0)
1 ; Data Source
"RTN","PXRRMDR",100,0)
 S A1=$$GET1^DIQ(9000010,VSN_",",81203)
"RTN","PXRRMDR",101,0)
 S:A1="" A1=" "
"RTN","PXRRMDR",102,0)
 D SET1(PRIO)
"RTN","PXRRMDR",103,0)
 Q
"RTN","PXRRMDR",104,0)
 ;
"RTN","PXRRMDR",105,0)
2 ; CPT
"RTN","PXRRMDR",106,0)
 N CPT,CPT1
"RTN","PXRRMDR",107,0)
 S CPT=$O(^AUPNVCPT("AD",VSN,""))
"RTN","PXRRMDR",108,0)
 S:CPT'="" CPT1=$$GET1^DIQ(9000010.18,CPT_",",.01)
"RTN","PXRRMDR",109,0)
 S A1=$G(CPT1) D SET1(PRIO)
"RTN","PXRRMDR",110,0)
 Q
"RTN","PXRRMDR",111,0)
 ;
"RTN","PXRRMDR",112,0)
3 ; ICD-9
"RTN","PXRRMDR",113,0)
 N ICD,ICD9 S ICD="",ICD9="Unknown"
"RTN","PXRRMDR",114,0)
 F  S ICD=$O(^AUPNVPOV("AD",VSN,ICD)) Q:'ICD  D
"RTN","PXRRMDR",115,0)
 . S ICD9=$$GET1^DIQ(9000010.07,ICD,.01)
"RTN","PXRRMDR",116,0)
 S A1=ICD9 D SET1(PRIO)
"RTN","PXRRMDR",117,0)
 Q
"RTN","PXRRMDR",118,0)
 ;
"RTN","PXRRMDR",119,0)
4 S A1=$$GET1^DIQ(9000010,VSN_",",.05)
"RTN","PXRRMDR",120,0)
 S:A1="" A1="Unknown"
"RTN","PXRRMDR",121,0)
 D SET1(PRIO)
"RTN","PXRRMDR",122,0)
 Q
"RTN","PXRRMDR",123,0)
 ;
"RTN","PXRRMDR",124,0)
5 ; Eligibility
"RTN","PXRRMDR",125,0)
 S A1=$$GET1^DIQ(9000010,VSN_",",.21)
"RTN","PXRRMDR",126,0)
 S:A1="" A1="Unknown"
"RTN","PXRRMDR",127,0)
 D SET1(PRIO)
"RTN","PXRRMDR",128,0)
 Q
"RTN","PXRRMDR",129,0)
 ;
"RTN","PXRRMDR",130,0)
6 ; Default Sort
"RTN","PXRRMDR",131,0)
 S A1="Default" D SET1(PRIO)
"RTN","PXRRMDR",132,0)
 Q
"RTN","PXRRMDR",133,0)
 ;
"RTN","PXRRMDR",134,0)
SET1(PR) ; set temp global
"RTN","PXRRMDR",135,0)
 I A1="" S A1="Unknown"
"RTN","PXRRMDR",136,0)
 S Y=$$GET1^DIQ(9000010,VSN_",",.01) X ^DD("DD") S VDT=Y
"RTN","PXRRMDR",137,0)
 S:VDT="" VDT="Unknown" S VDT=$P(VDT,"@",1)
"RTN","PXRRMDR",138,0)
 S ^TMP("PXCRPW",$J,PXLOC,PXPRV,A1,VDT,VSN,PR,SDX)=VSN
"RTN","PXRRMDR",139,0)
 Q
"RTN","PXRRMDR",140,0)
PRINT ; Print Report
"RTN","PXRRMDR",141,0)
 N A,I,REC,TOT,TOTE,Y,SHDR
"RTN","PXRRMDR",142,0)
 N PAT,SSN,SSND,TYP,VIN,DEFD,ENCD
"RTN","PXRRMDR",143,0)
 K TOT,TOTE
"RTN","PXRRMDR",144,0)
 S DEFD="TOTAL DEFECTS FOR ",ENCD="TOTAL ENCOUNTERS FOR "
"RTN","PXRRMDR",145,0)
 S (TOT(1),TOTE(1))=0
"RTN","PXRRMDR",146,0)
 S LOC="" F  S LOC=$O(^TMP("PXCRPW",$J,LOC)),HDR=0 Q:LOC=""!(POP)  D
"RTN","PXRRMDR",147,0)
 . S (TOT(2),TOTE(2))=0
"RTN","PXRRMDR",148,0)
 . S PROV="" F  S PROV=$O(^TMP("PXCRPW",$J,LOC,PROV)) Q:PROV=""!(POP)  D
"RTN","PXRRMDR",149,0)
 . . S (TOT(3),TOTE(3))=0
"RTN","PXRRMDR",150,0)
 . . S SORT="" F  S SORT=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT)) Q:SORT=""!(POP)  D
"RTN","PXRRMDR",151,0)
 . . . S (TOT(4),TOTE(4))=0
"RTN","PXRRMDR",152,0)
 . . . S VDT="" F  S VDT=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT)) Q:VDT=""!(POP)  D
"RTN","PXRRMDR",153,0)
 . . . . S (TOT(5),TOTE(5))=0
"RTN","PXRRMDR",154,0)
 . . . . S VIN="" F  S VIN=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT,VIN)),HDR1=0 Q:VIN=""!(POP)  D
"RTN","PXRRMDR",155,0)
 . . . . . S TOT(6)=0
"RTN","PXRRMDR",156,0)
 . . . . . S TOTE(5)=TOTE(5)+1
"RTN","PXRRMDR",157,0)
 . . . . . S PR="" F  S PR=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT,VIN,PR)) Q:PR=""  D
"RTN","PXRRMDR",158,0)
 . . . . . . S SHDR=0
"RTN","PXRRMDR",159,0)
 . . . . . . S SDX="" F  S SDX=$O(^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT,VIN,PR,SDX)) Q:SDX=""!(POP)  D
"RTN","PXRRMDR",160,0)
 . . . . . . . S REC=^TMP("PXCRPW",$J,LOC,PROV,SORT,VDT,VIN,PR,SDX)
"RTN","PXRRMDR",161,0)
 . . . . . . . S PAT=$$GET1^DIQ(9000010,REC_",",.05)
"RTN","PXRRMDR",162,0)
 . . . . . . . S SSN=$$GET1^DIQ(2,$$GET1^DIQ(9000010,REC_",",.05,"I"),.09)
"RTN","PXRRMDR",163,0)
 . . . . . . . S SSND=$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)
"RTN","PXRRMDR",164,0)
 . . . . . . . S EDT=$$GET1^DIQ(9000010,REC_",",.01)
"RTN","PXRRMDR",165,0)
 . . . . . . . S TYP=$$GET1^DIQ(9000010,REC_",",15001)
"RTN","PXRRMDR",166,0)
 . . . . . . . S USR=$$GET1^DIQ(9000010,REC_",",.23)
"RTN","PXRRMDR",167,0)
 . . . . . . . D:HDR=0 HEADER Q:POP
"RTN","PXRRMDR",168,0)
 . . . . . . . I RPTYP="D" D
"RTN","PXRRMDR",169,0)
 . . . . . . . . I HDR1=0 D
"RTN","PXRRMDR",170,0)
 . . . . . . . . . W ! S $P(HLINE,"-",132)="" W HLINE
"RTN","PXRRMDR",171,0)
 . . . . . . . . . W !,$E(PAT,1,25),?26,SSND,?39,EDT,?59,$E(TYP,1,15),?75,$E(USR,1,15) S HDR1=1
"RTN","PXRRMDR",172,0)
 . . . . . . . . W ?94,$E(SDX,1,37),!
"RTN","PXRRMDR",173,0)
 . . . . . . . S TOT(6)=TOT(6)+1
"RTN","PXRRMDR",174,0)
 . . . . . . . I $Y>(IOSL-4) S HDR=0
"RTN","PXRRMDR",175,0)
 . . . . . . Q:POP
"RTN","PXRRMDR",176,0)
 . . . . . Q:POP
"RTN","PXRRMDR",177,0)
 . . . . . I $Y>(IOSL-4) D HEADER Q:POP
"RTN","PXRRMDR",178,0)
 . . . . . S SHDR=1
"RTN","PXRRMDR",179,0)
 . . . . . W:RPTYP="D" !?94,DEFD_TYP_":  ",TOT(6),!
"RTN","PXRRMDR",180,0)
 . . . . . S TOT(5)=TOT(5)+TOT(6)
"RTN","PXRRMDR",181,0)
 . . . . Q:POP
"RTN","PXRRMDR",182,0)
 . . . . W !?6,DEFD_VDT_":  ",TOT(5)
"RTN","PXRRMDR",183,0)
 . . . . W !?6,ENCD_VDT_":  ",TOTE(5)
"RTN","PXRRMDR",184,0)
 . . . . S TOT(4)=TOT(4)+TOT(5)
"RTN","PXRRMDR",185,0)
 . . . . S TOTE(4)=TOTE(4)+TOTE(5)
"RTN","PXRRMDR",186,0)
 . . . Q:POP
"RTN","PXRRMDR",187,0)
 . . . W !?4,DEFD_"SORT VALUE - "_SORT_": ",TOT(4)
"RTN","PXRRMDR",188,0)
 . . . W !?4,ENCD_"SORT VALUE - "_SORT_": ",TOTE(4)
"RTN","PXRRMDR",189,0)
 . . . S TOT(3)=TOT(3)+TOT(4)
"RTN","PXRRMDR",190,0)
 . . . S TOTE(3)=TOTE(3)+TOTE(4)
"RTN","PXRRMDR",191,0)
 . . Q:POP
"RTN","PXRRMDR",192,0)
 . . W !?2,DEFD_PROV_": ",TOT(3)
"RTN","PXRRMDR",193,0)
 . . W !?2,ENCD_PROV_": ",TOTE(3)
"RTN","PXRRMDR",194,0)
 . . S TOT(2)=TOT(2)+TOT(3)
"RTN","PXRRMDR",195,0)
 . . S TOTE(2)=TOTE(2)+TOTE(3)
"RTN","PXRRMDR",196,0)
 . Q:POP
"RTN","PXRRMDR",197,0)
 . W !,DEFD_LOC_":  ",TOT(2)
"RTN","PXRRMDR",198,0)
 . W !,ENCD_LOC_": ",TOTE(2)
"RTN","PXRRMDR",199,0)
 . S TOT(1)=TOT(1)+TOT(2)
"RTN","PXRRMDR",200,0)
 . S TOTE(1)=TOTE(1)+TOTE(2)
"RTN","PXRRMDR",201,0)
 Q:POP
"RTN","PXRRMDR",202,0)
 I TOT(1)+TOTE(1)=0 W !!,"No Data to print",! Q
"RTN","PXRRMDR",203,0)
 W !!,"GRAND TOTAL NUMBER OF DEFECTS:  ",TOT(1)
"RTN","PXRRMDR",204,0)
 W !,"GRAND TOTAL NUMBER OF ENCOUNTERS = ",TOTE(1)
"RTN","PXRRMDR",205,0)
 Q
"RTN","PXRRMDR",206,0)
 ;
"RTN","PXRRMDR",207,0)
HEADER ;print header
"RTN","PXRRMDR",208,0)
 N %,X,Y,MSG,HLINE,DLINE
"RTN","PXRRMDR",209,0)
 I (PXPAGE>0)&(($E(IOST)="C")&(IO=IO(0))) D
"RTN","PXRRMDR",210,0)
 . S DIR(0)="E"
"RTN","PXRRMDR",211,0)
 . W !
"RTN","PXRRMDR",212,0)
 . D ^DIR K DIR
"RTN","PXRRMDR",213,0)
 I $D(DUOUT)!($D(DTOUT)) D  Q
"RTN","PXRRMDR",214,0)
 . S POP=1
"RTN","PXRRMDR",215,0)
 I PXPAGE>0 W:$D(IOF) @IOF
"RTN","PXRRMDR",216,0)
 S PXPAGE=PXPAGE+1
"RTN","PXRRMDR",217,0)
 W !
"RTN","PXRRMDR",218,0)
 S X=$$CTR132("PCE MISSING DATA REPORT") W !
"RTN","PXRRMDR",219,0)
 D NOW^%DTC S Y=% X ^DD("DD") S X=$$CTR(Y) W !
"RTN","PXRRMDR",220,0)
 S X=$$CTR132("By Clinic, Provider, and Date") W !
"RTN","PXRRMDR",221,0)
 S Y=PX("BDT") X ^DD("DD") S STDT=$P(Y,"@",1)
"RTN","PXRRMDR",222,0)
 S Y=PX("EDT") X ^DD("DD") S ENDT=$P(Y,"@",1)
"RTN","PXRRMDR",223,0)
 S MSG=STDT_" through "_ENDT
"RTN","PXRRMDR",224,0)
 S X=$$CTR(MSG) W !
"RTN","PXRRMDR",225,0)
 S X=$$CTR132("Page "_PXPAGE) W !
"RTN","PXRRMDR",226,0)
 W !!,"Patient",?26,"SSN",?39,"Date/Time",?59,"Enc. ID",?75,"Created by User",?94,"Defect",!
"RTN","PXRRMDR",227,0)
 S $P(HLINE,"=",132)="" W HLINE,!
"RTN","PXRRMDR",228,0)
 Q:SHDR
"RTN","PXRRMDR",229,0)
 W !,LOC
"RTN","PXRRMDR",230,0)
 W !?2,PROV
"RTN","PXRRMDR",231,0)
 N SORTD S SORTD=SORT
"RTN","PXRRMDR",232,0)
 S:SORTD=" " SORTD="Unknown"
"RTN","PXRRMDR",233,0)
 W !?4,"SORT VALUE:  ",$P(SORTHDR,U,PXSRT),"= ",SORTD
"RTN","PXRRMDR",234,0)
 S:VDT="" VDT="Unknown"
"RTN","PXRRMDR",235,0)
 W !?6,$P(VDT,"@",1),":"
"RTN","PXRRMDR",236,0)
 S HDR=1
"RTN","PXRRMDR",237,0)
 Q
"RTN","PXRRMDR",238,0)
 ;
"RTN","PXRRMDR",239,0)
DATASRC ; get Data Sources to print
"RTN","PXRRMDR",240,0)
 N ID,REC
"RTN","PXRRMDR",241,0)
 K PXDS
"RTN","PXRRMDR",242,0)
 K DIR,DIC
"RTN","PXRRMDR",243,0)
 S DIR(0)="Y",DIR("A")="Would you like to include ALL Data Sources"
"RTN","PXRRMDR",244,0)
 S DIR("B")="YES" D ^DIR
"RTN","PXRRMDR",245,0)
 I $D(DIRUT) S POP=1 Q
"RTN","PXRRMDR",246,0)
 I Y D
"RTN","PXRRMDR",247,0)
 . S ID="" F  S ID=$O(^PX(839.7,"B",ID)) Q:ID=""  D
"RTN","PXRRMDR",248,0)
 . . S REC="" F  S REC=$O(^PX(839.7,"B",ID,REC)) Q:REC=""  D
"RTN","PXRRMDR",249,0)
 . . . S PXDS(REC)=ID
"RTN","PXRRMDR",250,0)
 . S PXDS("Unknown")=0
"RTN","PXRRMDR",251,0)
 E  D
"RTN","PXRRMDR",252,0)
 . S DIC=839.7,DIC(0)="QEAMZ",DIC("A")="Enter Data Source:  "
"RTN","PXRRMDR",253,0)
 . F  D ^DIC Q:$D(DTOUT)!($D(DUOUT))!(Y=-1)  S:+Y PXDS(+Y)=""
"RTN","PXRRMDR",254,0)
 I $D(DTOUT)!($D(DUOUT)) S POP=1
"RTN","PXRRMDR",255,0)
 Q
"RTN","PXRRMDR",256,0)
 ;
"RTN","PXRRMDR",257,0)
CTR(X) ;
"RTN","PXRRMDR",258,0)
 W ?(IOM-$L(X))\2,X
"RTN","PXRRMDR",259,0)
 Q 1
"RTN","PXRRMDR",260,0)
 ;
"RTN","PXRRMDR",261,0)
CTR132(X) ;
"RTN","PXRRMDR",262,0)
 W ?(132-$L(X))\2,X
"RTN","PXRRMDR",263,0)
 Q 1
"RTN","PXRRMDR",264,0)
 ;
"RTN","VSITFLD")
0^57^B10171572
"RTN","VSITFLD",1,0)
VSITFLD ;ISD/MRL,RJP - Visit Tracking file fields array setup ;6/20/96
"RTN","VSITFLD",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**76,81,111,130,124**;Aug 12, 1996
"RTN","VSITFLD",3,0)
 ; Patch PX*1*76 changes the 2nd line of all VSIT* routines to reflect
"RTN","VSITFLD",4,0)
 ; the incorporation of the module into PCE.  For historical reference,
"RTN","VSITFLD",5,0)
 ; the old (VISIT TRACKING) 2nd line is included below to reference VSIT
"RTN","VSITFLD",6,0)
 ; patches.
"RTN","VSITFLD",7,0)
 ;
"RTN","VSITFLD",8,0)
 ;;2.0;VISIT TRACKING;**4**;Aug 12, 1996;
"RTN","VSITFLD",9,0)
 ;
"RTN","VSITFLD",10,0)
 Q
"RTN","VSITFLD",11,0)
 ;
"RTN","VSITFLD",12,0)
FLD ; - Visit file fields; array subscript and field DD number fmt
"RTN","VSITFLD",13,0)
 ;   <visit subscript>;<field#>;<node>;<piece>;<error message>
"RTN","VSITFLD",14,0)
 ;
"RTN","VSITFLD",15,0)
 S ^TMP("VSITDD",$J,"VDT")="VDT;.01;0;1;Invalid Encounter/Admit Date&Time [0;1]"
"RTN","VSITFLD",16,0)
 S ^TMP("VSITDD",$J,"CDT")="CDT;.02;0;2"
"RTN","VSITFLD",17,0)
 S ^TMP("VSITDD",$J,"TYP")="TYP;.03;0;3;Invalid Type [0:3]"
"RTN","VSITFLD",18,0)
 S ^TMP("VSITDD",$J,"PAT")="PAT;.05;0;5;Invalid Patient [0:5]"
"RTN","VSITFLD",19,0)
 S ^TMP("VSITDD",$J,"INS")="INS;.06;0;6;Invalid Loc of Encounter [0:6]"
"RTN","VSITFLD",20,0)
 S ^TMP("VSITDD",$J,"SVC")="SVC;.07;0;7;Invalid Service Category [0:7]"
"RTN","VSITFLD",21,0)
 S ^TMP("VSITDD",$J,"DSS")="DSS;.08;0;8;Invalid DSS ID [0:8]"
"RTN","VSITFLD",22,0)
 S ^TMP("VSITDD",$J,"CTR")="CTR;.09;0;9"
"RTN","VSITFLD",23,0)
 S ^TMP("VSITDD",$J,"DEL")="DEL;.11;0;11"
"RTN","VSITFLD",24,0)
 S ^TMP("VSITDD",$J,"LNK")="LNK;.12;0;12"
"RTN","VSITFLD",25,0)
 S ^TMP("VSITDD",$J,"MDT")="MDT;.13;0;13"
"RTN","VSITFLD",26,0)
 S ^TMP("VSITDD",$J,"COD")="COD;.18;0;18"
"RTN","VSITFLD",27,0)
 S ^TMP("VSITDD",$J,"ELG")="ELG;.21;0;21;Invalid Eligibility [0:21]"
"RTN","VSITFLD",28,0)
 S ^TMP("VSITDD",$J,"LOC")="LOC;.22;0;22;Invalid Hospital Location [0:22] - The specified Hospital Location was not found defined in the Hospital Location file."
"RTN","VSITFLD",29,0)
 S ^TMP("VSITDD",$J,"USR")="USR;.23;0;23;Invalid Created by User [0:23]"
"RTN","VSITFLD",30,0)
 S ^TMP("VSITDD",$J,"OPT")="OPT;.24;0;24"
"RTN","VSITFLD",31,0)
 S ^TMP("VSITDD",$J,"PRO")="PRO;.25;0;25"
"RTN","VSITFLD",32,0)
 S ^TMP("VSITDD",$J,"OUT")="OUT;2101;21;1"
"RTN","VSITFLD",33,0)
 S ^TMP("VSITDD",$J,"VID")="VID;15001;150;1"
"RTN","VSITFLD",34,0)
 S ^TMP("VSITDD",$J,"IO")="IO;15002;150;2"
"RTN","VSITFLD",35,0)
 S ^TMP("VSITDD",$J,"PRI")="PRI;15003;150;3"
"RTN","VSITFLD",36,0)
 S ^TMP("VSITDD",$J,"SC")="SC;80001;800;1"
"RTN","VSITFLD",37,0)
 S ^TMP("VSITDD",$J,"AO")="AO;80002;800;2"
"RTN","VSITFLD",38,0)
 S ^TMP("VSITDD",$J,"IR")="IR;80003;800;3"
"RTN","VSITFLD",39,0)
 S ^TMP("VSITDD",$J,"EC")="EC;80004;800;4"
"RTN","VSITFLD",40,0)
 S ^TMP("VSITDD",$J,"MST")="MST;80005;800;5" ;added 6/17/98 for MST enhancement
"RTN","VSITFLD",41,0)
 S ^TMP("VSITDD",$J,"HNC")="HNC;80006;800;6" ;PX*1*111 added for HNC enhancement
"RTN","VSITFLD",42,0)
 S ^TMP("VSITDD",$J,"CV")="CV;80007;800;7" ;PX*1*130 Combat Veteran
"RTN","VSITFLD",43,0)
 S ^TMP("VSITDD",$J,"SCEF")="SCED;80011;800;11" ;PX*1*124 SC EDIT FLAG
"RTN","VSITFLD",44,0)
 S ^TMP("VSITDD",$J,"AOEF")="AOED;80012;800;12" ;PX*1*124 AO EDIT FLAG
"RTN","VSITFLD",45,0)
 S ^TMP("VSITDD",$J,"IREF")="IRED;80013;800;13" ;PX*1*124 IR EDIT FLAG
"RTN","VSITFLD",46,0)
 S ^TMP("VSITDD",$J,"ECEF")="ECED;80014;800;14" ;PX*1*124 EC EDIT FLAG
"RTN","VSITFLD",47,0)
 S ^TMP("VSITDD",$J,"MSTEF")="MSTED;80015;800;15" ;PX*1*124 MST EDIT FLAG
"RTN","VSITFLD",48,0)
 S ^TMP("VSITDD",$J,"HNCEF")="HNCED;80016;800;16" ;PX*1*124 HNC EDIT FLAG
"RTN","VSITFLD",49,0)
 S ^TMP("VSITDD",$J,"CVEF")="CVED;80017;800;17" ;PX*1*124 CV EDIT FLAG
"RTN","VSITFLD",50,0)
 S ^TMP("VSITDD",$J,"COM")="COM;81101;811;1"
"RTN","VSITFLD",51,0)
 S ^TMP("VSITDD",$J,"VER")="VER;81201;812;1"
"RTN","VSITFLD",52,0)
 S ^TMP("VSITDD",$J,"PKG")="PKG;81202;812;2"
"RTN","VSITFLD",53,0)
 S ^TMP("VSITDD",$J,"SOR")="SOR;81203;812;3"
"RTN","VSITFLD",54,0)
 Q
"RTN","VSITFLD",55,0)
 ;
"VER")
8.0^22.0
"^DD",9000010,9000010,80011,0)
SERVICE CONNECTION EDIT FLAG^S^0:EDITABLE;1:NOT EDITABLE;^800;11^Q
"^DD",9000010,9000010,80011,3)
Enter 1 to prevent user editing of the Service Connection classification.
"^DD",9000010,9000010,80011,21,0)
^.001^2^2^3040205^^^^
"^DD",9000010,9000010,80011,21,1,0)
This field is used to determine if the Service Connection Classification
"^DD",9000010,9000010,80011,21,2,0)
for the Visit can be edited by the user.
"^DD",9000010,9000010,80011,23,0)
^.001^3^3^3040205^^^^
"^DD",9000010,9000010,80011,23,1,0)
The Service Connected classification is not editable if
"^DD",9000010,9000010,80011,23,2,0)
either any of the diagnosis Service Connection classifications are "Yes"
"^DD",9000010,9000010,80011,23,3,0)
or all of the diagnosis Service Connection classifications are "No".
"^DD",9000010,9000010,80011,"DT")
3040205
"^DD",9000010,9000010,80012,0)
AGENT ORANGE EDIT FLAG^S^0:EDITABLE;1:NOT EDITABLE;^800;12^Q
"^DD",9000010,9000010,80012,3)
Enter 1 to prevent user editing of the Agent Orange classification
"^DD",9000010,9000010,80012,21,0)
^.001^2^2^3040206^^^
"^DD",9000010,9000010,80012,21,1,0)
This field is used to determine if the Agent Orange Classification
"^DD",9000010,9000010,80012,21,2,0)
for the Visit can be edited by the user.
"^DD",9000010,9000010,80012,23,0)
^.001^3^3^3040206^^
"^DD",9000010,9000010,80012,23,1,0)
The Agent Orange classification is not editable if
"^DD",9000010,9000010,80012,23,2,0)
either any of the diagnosis Agent Orange classifiactions are "Yes"
"^DD",9000010,9000010,80012,23,3,0)
or all of the diagnosis Agent Orange classifiactions are "No".
"^DD",9000010,9000010,80012,"DT")
3040205
"^DD",9000010,9000010,80013,0)
IONIZING RADIATION EDIT FLAG^S^0:EDITABLE;1:NOT EDITABLE;^800;13^Q
"^DD",9000010,9000010,80013,3)
Enter 1 to prevent user editing of the Ionizing Radiation classification
"^DD",9000010,9000010,80013,21,0)
^.001^2^2^3040206^^^^
"^DD",9000010,9000010,80013,21,1,0)
This field is used to determine if the Ionizing Radiation classification
"^DD",9000010,9000010,80013,21,2,0)
for the Visit can be edited by the user.
"^DD",9000010,9000010,80013,23,0)
^.001^3^3^3040206^^^
"^DD",9000010,9000010,80013,23,1,0)
The Ionizing Radiation classification is not editable if
"^DD",9000010,9000010,80013,23,2,0)
either any of the diagnosis Ionizing Radiation classifications are "Yes"
"^DD",9000010,9000010,80013,23,3,0)
or all of the diagnosis Ionizing Radiation classifiactions are "No".
"^DD",9000010,9000010,80013,"DT")
3040205
"^DD",9000010,9000010,80014,0)
ENVIRONMENTAL CONT. EDIT FLAG^S^0:EDITABLE;1:NOT EDITABLE;^800;14^Q
"^DD",9000010,9000010,80014,3)
Enter 1 to prevent user editing of the Environmental Contaminants classification.
"^DD",9000010,9000010,80014,21,0)
^.001^2^2^3040206^^^^
"^DD",9000010,9000010,80014,21,1,0)
This field is used to determine if the Environmental Contaminants
"^DD",9000010,9000010,80014,21,2,0)
classification for the Visit can be edited by the user.
"^DD",9000010,9000010,80014,23,0)
^.001^4^4^3040206^^^^
"^DD",9000010,9000010,80014,23,1,0)
The Environmental Contaminants classification is not editable if
"^DD",9000010,9000010,80014,23,2,0)
either any of the diagnosis Environmental Contaminants classifications
"^DD",9000010,9000010,80014,23,3,0)
are "Yes", or all of the diagnosis Environmental Contaminants
"^DD",9000010,9000010,80014,23,4,0)
classifications are "No".
"^DD",9000010,9000010,80014,"DT")
3040205
"^DD",9000010,9000010,80015,0)
MST EDIT FLAG^S^0:EDITABLE;1:NOT EDITABLE;^800;15^Q
"^DD",9000010,9000010,80015,3)
Enter 1 to prevent user editing of the Military Sexual Trauma classification
"^DD",9000010,9000010,80015,21,0)
^^2^2^3040205^
"^DD",9000010,9000010,80015,21,1,0)
This field is used to determine if the Military Sexual Trauma classification
"^DD",9000010,9000010,80015,21,2,0)
for the Visit can be edited by the user.
"^DD",9000010,9000010,80015,23,0)
^.001^4^4^3040205^^
"^DD",9000010,9000010,80015,23,1,0)
The Military Sexual Trauma classification is not editable if
"^DD",9000010,9000010,80015,23,2,0)
either any of the diagnosis Miliary Sexual Trauma classifications
"^DD",9000010,9000010,80015,23,3,0)
are "Yes", or all of the diagnosis Miliary Sexual Trauma classifications
"^DD",9000010,9000010,80015,23,4,0)
are "No".
"^DD",9000010,9000010,80015,"DT")
3040205
"^DD",9000010,9000010,80016,0)
HEAD AND NECK CANCER EDIT FLAG^S^0:EDITABLE;1:NOT EDITABLE;^800;16^Q
"^DD",9000010,9000010,80016,3)
Enter 1 to prevent user editing of the Head and Neck Cancer classification
"^DD",9000010,9000010,80016,21,0)
^^2^2^3040206^
"^DD",9000010,9000010,80016,21,1,0)
This field is used to determine if the Head and/or Neck Cancer
"^DD",9000010,9000010,80016,21,2,0)
classification can be edited by the user.
"^DD",9000010,9000010,80016,23,0)
^^4^4^3040206^
"^DD",9000010,9000010,80016,23,1,0)
The Head and/or Neck Cancer classification is not editable if
"^DD",9000010,9000010,80016,23,2,0)
either any of the diagnosis Head and/or Neck Cancer classifications
"^DD",9000010,9000010,80016,23,3,0)
are "Yes", or all of the diagnosis Head and/or Neck Cancer classifications
"^DD",9000010,9000010,80016,23,4,0)
are "No".
"^DD",9000010,9000010,80016,"DT")
3040205
"^DD",9000010,9000010,80017,0)
COMBAT VETERAN EDIT FLAG^S^0:EDITABLE;1:NOT EDITABLE;^800;17^Q
"^DD",9000010,9000010,80017,3)
Enter 1 to prevent user editing of the combat Veteran classification.
"^DD",9000010,9000010,80017,21,0)
^.001^2^2^3040226^^^
"^DD",9000010,9000010,80017,21,1,0)
This field is used to determine if the Combat Veteran classification can be 
"^DD",9000010,9000010,80017,21,2,0)
edited by the user.
"^DD",9000010,9000010,80017,23,0)
^.001^3^3^3040226^^
"^DD",9000010,9000010,80017,23,1,0)
The combat Veteran classification is not editable if either any of the
"^DD",9000010,9000010,80017,23,2,0)
diagnosis Combat Veteran classifications are "Yes", or all of the
"^DD",9000010,9000010,80017,23,3,0)
diagnosis Combat Veteran classifications are "No".
"^DD",9000010,9000010,80017,"DT")
3040217
"^DD",9000010.07,9000010.07,.17,0)
ORDERING/RESULTING^S^O:ORDERING;R:RESULTING;OR:BOTH O&R;^0;17^Q
"^DD",9000010.07,9000010.07,.17,3)
Enter O if the diagnosis is an ordering diagnosis, enter R if the diagnosis is a resulting diagnosis and enter B if the diagnosis is used for both ordering and resulting.
"^DD",9000010.07,9000010.07,.17,21,0)
^.001^2^2^3040217^^^^
"^DD",9000010.07,9000010.07,.17,21,1,0)
This field identifies a diagnosis as being Ordering, Resulting, or
"^DD",9000010.07,9000010.07,.17,21,2,0)
both Ordering and Resulting.
"^DD",9000010.07,9000010.07,.17,23,0)
^.001^2^2^3040217^^^^
"^DD",9000010.07,9000010.07,.17,23,1,0)
Ordering diagnoses are used for facility charges in billing,
"^DD",9000010.07,9000010.07,.17,23,2,0)
resulting diagnoses are used in professional services billing.
"^DD",9000010.07,9000010.07,.17,"DT")
3040217
"^DD",9000010.11,9000010.11,.08,0)
DIAGNOSIS^*P80'^ICD9(^0;8^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.11,9000010.11,.08,3)
Enter the ICD Diagnosis related to the immunization done.
"^DD",9000010.11,9000010.11,.08,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.11,9000010.11,.08,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.11,9000010.11,.08,21,0)
^.001^2^2^3040309^^
"^DD",9000010.11,9000010.11,.08,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.11,9000010.11,.08,21,2,0)
with the immunization performed.
"^DD",9000010.11,9000010.11,.08,"DT")
3040309
"^DD",9000010.11,9000010.11,.09,0)
DIAGNOSIS 2^*P80'^ICD9(^0;9^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.11,9000010.11,.09,3)
Enter the ICD Diagnosis related to the immunization done.
"^DD",9000010.11,9000010.11,.09,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.11,9000010.11,.09,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.11,9000010.11,.09,21,0)
^^2^2^3031008^
"^DD",9000010.11,9000010.11,.09,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.11,9000010.11,.09,21,2,0)
with the immunization performed.
"^DD",9000010.11,9000010.11,.09,"DT")
3031008
"^DD",9000010.11,9000010.11,.1,0)
DIAGNOSIS 3^*P80'^ICD9(^0;10^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.11,9000010.11,.1,3)
Enter the ICD Diagnosis related to the immunization done.
"^DD",9000010.11,9000010.11,.1,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.11,9000010.11,.1,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.11,9000010.11,.1,21,0)
^^2^2^3031008^
"^DD",9000010.11,9000010.11,.1,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.11,9000010.11,.1,21,2,0)
with the immunization performed.
"^DD",9000010.11,9000010.11,.1,"DT")
3031008
"^DD",9000010.11,9000010.11,.11,0)
DIAGNOSIS 4^*P80'^ICD9(^0;11^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.11,9000010.11,.11,3)
Enter the ICD Diagnosis related to the immunization done.
"^DD",9000010.11,9000010.11,.11,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.11,9000010.11,.11,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.11,9000010.11,.11,21,0)
^^2^2^3031008^
"^DD",9000010.11,9000010.11,.11,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.11,9000010.11,.11,21,2,0)
with the immunization performed.
"^DD",9000010.11,9000010.11,.11,"DT")
3031008
"^DD",9000010.11,9000010.11,.12,0)
DIAGNOSIS 5^*P80'^ICD9(^0;12^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.11,9000010.11,.12,3)
Enter the ICD Diagnosis related to the immunization done.
"^DD",9000010.11,9000010.11,.12,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.11,9000010.11,.12,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.11,9000010.11,.12,"DT")
3040115
"^DD",9000010.11,9000010.11,.13,0)
DIAGNOSIS 6^*P80'^ICD9(^0;13^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.11,9000010.11,.13,3)
Enter the ICD Diagnosis related to the immunization done.
"^DD",9000010.11,9000010.11,.13,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.11,9000010.11,.13,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.11,9000010.11,.13,"DT")
3040115
"^DD",9000010.11,9000010.11,.14,0)
DIAGNOSIS 7^*P80'^ICD9(^0;14^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.11,9000010.11,.14,3)
Enter the ICD Diagnosis related to the immunization done.
"^DD",9000010.11,9000010.11,.14,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.11,9000010.11,.14,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.11,9000010.11,.14,"DT")
3040115
"^DD",9000010.11,9000010.11,.15,0)
DIAGNOSIS 8^*P80'^ICD9(^0;15^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.11,9000010.11,.15,3)
Enter the ICD Diagnosis related to the immunization done.
"^DD",9000010.11,9000010.11,.15,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.11,9000010.11,.15,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.11,9000010.11,.15,"DT")
3040115
"^DD",9000010.12,9000010.12,.08,0)
DIAGNOSIS^*P80'^ICD9(^0;8^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.12,9000010.12,.08,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.12,9000010.12,.08,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.12,9000010.12,.08,21,0)
^.001^2^2^3040309^^
"^DD",9000010.12,9000010.12,.08,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.12,9000010.12,.08,21,2,0)
with the skin test performed.
"^DD",9000010.12,9000010.12,.08,"DT")
3040309
"^DD",9000010.12,9000010.12,.09,0)
DIAGNOSIS 2^*P80'^ICD9(^0;9^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.12,9000010.12,.09,3)
Enter the ICD Diagnosis related to the skin test performed.
"^DD",9000010.12,9000010.12,.09,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.12,9000010.12,.09,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.12,9000010.12,.09,21,0)
^^2^2^3031008^
"^DD",9000010.12,9000010.12,.09,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.12,9000010.12,.09,21,2,0)
with the skin test performed.
"^DD",9000010.12,9000010.12,.09,"DT")
3031008
"^DD",9000010.12,9000010.12,.1,0)
DIAGNOSIS 3^*P80'^ICD9(^0;10^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.12,9000010.12,.1,3)
Enter the ICD Diagnosis related to the skin test done.
"^DD",9000010.12,9000010.12,.1,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.12,9000010.12,.1,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.12,9000010.12,.1,21,0)
^.001^2^2^3031008^^
"^DD",9000010.12,9000010.12,.1,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.12,9000010.12,.1,21,2,0)
with the skin test performed.
"^DD",9000010.12,9000010.12,.1,"DT")
3031008
"^DD",9000010.12,9000010.12,.11,0)
DIAGNOSIS 4^*P80'^ICD9(^0;11^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.12,9000010.12,.11,3)
Enter the ICD Diagnosis related to the skin test done
"^DD",9000010.12,9000010.12,.11,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.12,9000010.12,.11,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.12,9000010.12,.11,21,0)
^^2^2^3031008^
"^DD",9000010.12,9000010.12,.11,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.12,9000010.12,.11,21,2,0)
with the skin test performed.
"^DD",9000010.12,9000010.12,.11,"DT")
3031008
"^DD",9000010.12,9000010.12,.12,0)
DIAGNOSIS 5^*P80'^ICD9(^0;12^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.12,9000010.12,.12,3)
Enter the ICD Diagnosis related to the skin test done
"^DD",9000010.12,9000010.12,.12,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.12,9000010.12,.12,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.12,9000010.12,.12,21,0)
^^2^2^3040114^
"^DD",9000010.12,9000010.12,.12,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.12,9000010.12,.12,21,2,0)
with the skin test performed.
"^DD",9000010.12,9000010.12,.12,"DT")
3040114
"^DD",9000010.12,9000010.12,.13,0)
DIAGNOSIS 6^P80'^ICD9(^0;13^Q
"^DD",9000010.12,9000010.12,.13,3)

"^DD",9000010.12,9000010.12,.13,21,0)
^.001^2^2^3040114^^^
"^DD",9000010.12,9000010.12,.13,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.12,9000010.12,.13,21,2,0)
with the skin test performed.
"^DD",9000010.12,9000010.12,.13,"DT")
3040114
"^DD",9000010.12,9000010.12,.14,0)
DIAGNOSIS 7^*P80'^ICD9(^0;14^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.12,9000010.12,.14,3)
Enter the ICD Diagnosis related to the skin test done
"^DD",9000010.12,9000010.12,.14,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.12,9000010.12,.14,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.12,9000010.12,.14,21,0)
^.001^2^2^3040114^^^^
"^DD",9000010.12,9000010.12,.14,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.12,9000010.12,.14,21,2,0)
with the skin test performed.
"^DD",9000010.12,9000010.12,.14,"DT")
3040114
"^DD",9000010.12,9000010.12,.15,0)
DIAGNOSIS 8^*P80'^ICD9(^0;15^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.12,9000010.12,.15,3)
Enter the ICD Diagnosis related to the skin test done
"^DD",9000010.12,9000010.12,.15,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.12,9000010.12,.15,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.12,9000010.12,.15,21,0)
^.001^2^2^3040114^^^
"^DD",9000010.12,9000010.12,.15,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.12,9000010.12,.15,21,2,0)
with the skin test performed.
"^DD",9000010.12,9000010.12,.15,"DT")
3040114
"^DD",9000010.18,9000010.18,.05,0)
DIAGNOSIS^*P80'^ICD9(^0;5^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.18,9000010.18,.05,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.05,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.05,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.18,9000010.18,.05,21,0)
^.001^2^2^3040212^^^^
"^DD",9000010.18,9000010.18,.05,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.18,9000010.18,.05,21,2,0)
with the procedure performed.
"^DD",9000010.18,9000010.18,.05,"DT")
3040211
"^DD",9000010.18,9000010.18,.09,0)
DIAGNOSIS 2^*P80'^ICD9(^0;9^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.18,9000010.18,.09,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.09,12)
Dx cannot be an inactive code, and it must be appropriat
"^DD",9000010.18,9000010.18,.09,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.18,9000010.18,.09,21,0)
^.001^2^2^3030908^^^^
"^DD",9000010.18,9000010.18,.09,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.18,9000010.18,.09,21,2,0)
with the procedure performed.
"^DD",9000010.18,9000010.18,.09,"AUDIT")

"^DD",9000010.18,9000010.18,.09,"DT")
3030908
"^DD",9000010.18,9000010.18,.1,0)
DIAGNOSIS 3^*P80'^ICD9(^0;10^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.18,9000010.18,.1,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.1,12)
Dx cannot be an inactive code, and it must be appropria
"^DD",9000010.18,9000010.18,.1,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.18,9000010.18,.1,21,0)
^^2^2^3021227^
"^DD",9000010.18,9000010.18,.1,21,1,0)
This is the diagnosis, from the ICD Diagnosis file, associated
"^DD",9000010.18,9000010.18,.1,21,2,0)
with the procedure performed.
"^DD",9000010.18,9000010.18,.1,"DT")
3030613
"^DD",9000010.18,9000010.18,.11,0)
DIAGNOSIS 4^*P80'^ICD9(^0;11^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.18,9000010.18,.11,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.11,12)
Dx cannot be an inactive code, and it must be appropriat
"^DD",9000010.18,9000010.18,.11,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.18,9000010.18,.11,"DT")
3030613
"^DD",9000010.18,9000010.18,.12,0)
DIAGNOSIS 5^*P80'^ICD9(^0;12^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.18,9000010.18,.12,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.12,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.12,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.18,9000010.18,.12,"DT")
3040112
"^DD",9000010.18,9000010.18,.13,0)
DIAGNOSIS 6^*P80'^ICD9(^0;13^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.18,9000010.18,.13,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.13,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.13,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.18,9000010.18,.13,"DT")
3040112
"^DD",9000010.18,9000010.18,.14,0)
DIAGNOSIS 7^*P80'^ICD9(^0;14^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.18,9000010.18,.14,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.14,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.14,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.18,9000010.18,.14,"DT")
3040112
"^DD",9000010.18,9000010.18,.15,0)
DIAGNOSIS 8^*P80'^ICD9(^0;15^S DIC("S")="D ^AUPNSICD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",9000010.18,9000010.18,.15,3)
Enter the ICD Diagnosis related to the procedure done.
"^DD",9000010.18,9000010.18,.15,12)
Dx cannot be an inactive code, and it must be appropriate
"^DD",9000010.18,9000010.18,.15,12.1)
S DIC("S")="D ^AUPNSICD"
"^DD",9000010.18,9000010.18,.15,"DT")
3040112
"^DD",9000010.18,9000010.18,.17,0)
ORDER REFERENCE^P100'^OR(100,^0;17^Q
"^DD",9000010.18,9000010.18,.17,21,0)
^.001^2^2^3040312^^^
"^DD",9000010.18,9000010.18,.17,21,1,0)
Pointer to the order in the Order file (#100) that ordered the
"^DD",9000010.18,9000010.18,.17,21,2,0)
procedure.
"^DD",9000010.18,9000010.18,.17,23,0)
^^3^3^3040312^
"^DD",9000010.18,9000010.18,.17,23,1,0)
This field is created to provide a place for the surgery
"^DD",9000010.18,9000010.18,.17,23,2,0)
package to place the pointer to the entry in the order file
"^DD",9000010.18,9000010.18,.17,23,3,0)
(#100) that is associated with this procedure.
"^DD",9000010.18,9000010.18,.17,"DT")
3040312
**INSTALL NAME**
IB*2.0*260
"BLD",4962,0)
IB*2.0*260^INTEGRATED BILLING^0^3050805^y
"BLD",4962,1,0)
^^1^1^3050119^^
"BLD",4962,1,1,0)
Clinical Indicator Data Capture IB support.
"BLD",4962,4,0)
^9.64PA^372^1
"BLD",4962,4,372,0)
372
"BLD",4962,4,372,222)
y^y^f^^^^n
"BLD",4962,4,"B",372,372)

"BLD",4962,"INID")
^y
"BLD",4962,"INIT")
POST^IB20P260
"BLD",4962,"KRN",0)
^9.67PA^8989.52^19
"BLD",4962,"KRN",.4,0)
.4
"BLD",4962,"KRN",.401,0)
.401
"BLD",4962,"KRN",.402,0)
.402
"BLD",4962,"KRN",.403,0)
.403
"BLD",4962,"KRN",.5,0)
.5
"BLD",4962,"KRN",.84,0)
.84
"BLD",4962,"KRN",3.6,0)
3.6
"BLD",4962,"KRN",3.8,0)
3.8
"BLD",4962,"KRN",9.2,0)
9.2
"BLD",4962,"KRN",9.8,0)
9.8
"BLD",4962,"KRN",9.8,"NM",0)
^9.68A^18^18
"BLD",4962,"KRN",9.8,"NM",1,0)
IBTRKR5^^0^B25744902
"BLD",4962,"KRN",9.8,"NM",2,0)
IBTRKR41^^0^B24615908
"BLD",4962,"KRN",9.8,"NM",3,0)
IBCCPT^^0^B67217421
"BLD",4962,"KRN",9.8,"NM",4,0)
IBCCPT1^^0^B10855757
"BLD",4962,"KRN",9.8,"NM",5,0)
IBCD3^^0^B31379755
"BLD",4962,"KRN",9.8,"NM",6,0)
IBCU81^^0^B13771358
"BLD",4962,"KRN",9.8,"NM",7,0)
IBCU7^^0^B54906275
"BLD",4962,"KRN",9.8,"NM",8,0)
IBCU74^^0^B34281515
"BLD",4962,"KRN",9.8,"NM",9,0)
IBTRKR3^^0^B23441349
"BLD",4962,"KRN",9.8,"NM",10,0)
IBCSC5C^^0^B35114956
"BLD",4962,"KRN",9.8,"NM",11,0)
IBCSC5B^^0^B22166369
"BLD",4962,"KRN",9.8,"NM",12,0)
IBCOPV^^0^B21022781
"BLD",4962,"KRN",9.8,"NM",13,0)
IBCOPV1^^0^B19654467
"BLD",4962,"KRN",9.8,"NM",14,0)
IB20P260^^0^B2350113
"BLD",4962,"KRN",9.8,"NM",15,0)
IBBAPI^^0^B540488
"BLD",4962,"KRN",9.8,"NM",16,0)
IBBASCI^^0^B2419575
"BLD",4962,"KRN",9.8,"NM",17,0)
IBBDOC^^0^B264185
"BLD",4962,"KRN",9.8,"NM",18,0)
IBBASWCH^^0^B19153346
"BLD",4962,"KRN",9.8,"NM","B","IB20P260",14)

"BLD",4962,"KRN",9.8,"NM","B","IBBAPI",15)

"BLD",4962,"KRN",9.8,"NM","B","IBBASCI",16)

"BLD",4962,"KRN",9.8,"NM","B","IBBASWCH",18)

"BLD",4962,"KRN",9.8,"NM","B","IBBDOC",17)

"BLD",4962,"KRN",9.8,"NM","B","IBCCPT",3)

"BLD",4962,"KRN",9.8,"NM","B","IBCCPT1",4)

"BLD",4962,"KRN",9.8,"NM","B","IBCD3",5)

"BLD",4962,"KRN",9.8,"NM","B","IBCOPV",12)

"BLD",4962,"KRN",9.8,"NM","B","IBCOPV1",13)

"BLD",4962,"KRN",9.8,"NM","B","IBCSC5B",11)

"BLD",4962,"KRN",9.8,"NM","B","IBCSC5C",10)

"BLD",4962,"KRN",9.8,"NM","B","IBCU7",7)

"BLD",4962,"KRN",9.8,"NM","B","IBCU74",8)

"BLD",4962,"KRN",9.8,"NM","B","IBCU81",6)

"BLD",4962,"KRN",9.8,"NM","B","IBTRKR3",9)

"BLD",4962,"KRN",9.8,"NM","B","IBTRKR41",2)

"BLD",4962,"KRN",9.8,"NM","B","IBTRKR5",1)

"BLD",4962,"KRN",19,0)
19
"BLD",4962,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",4962,"KRN",19,"NM",1,0)
IB CIDC INSURANCE SWITCH^^0
"BLD",4962,"KRN",19,"NM",2,0)
IB SITE MGR MENU^^2
"BLD",4962,"KRN",19,"NM","B","IB CIDC INSURANCE SWITCH",1)

"BLD",4962,"KRN",19,"NM","B","IB SITE MGR MENU",2)

"BLD",4962,"KRN",19.1,0)
19.1
"BLD",4962,"KRN",101,0)
101
"BLD",4962,"KRN",409.61,0)
409.61
"BLD",4962,"KRN",771,0)
771
"BLD",4962,"KRN",870,0)
870
"BLD",4962,"KRN",8989.51,0)
8989.51
"BLD",4962,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",4962,"KRN",8989.51,"NM",1,0)
IB CIDC INSURANCE CHECK^^0
"BLD",4962,"KRN",8989.51,"NM","B","IB CIDC INSURANCE CHECK",1)

"BLD",4962,"KRN",8989.52,0)
8989.52
"BLD",4962,"KRN",8994,0)
8994
"BLD",4962,"KRN","B",.4,.4)

"BLD",4962,"KRN","B",.401,.401)

"BLD",4962,"KRN","B",.402,.402)

"BLD",4962,"KRN","B",.403,.403)

"BLD",4962,"KRN","B",.5,.5)

"BLD",4962,"KRN","B",.84,.84)

"BLD",4962,"KRN","B",3.6,3.6)

"BLD",4962,"KRN","B",3.8,3.8)

"BLD",4962,"KRN","B",9.2,9.2)

"BLD",4962,"KRN","B",9.8,9.8)

"BLD",4962,"KRN","B",19,19)

"BLD",4962,"KRN","B",19.1,19.1)

"BLD",4962,"KRN","B",101,101)

"BLD",4962,"KRN","B",409.61,409.61)

"BLD",4962,"KRN","B",771,771)

"BLD",4962,"KRN","B",870,870)

"BLD",4962,"KRN","B",8989.51,8989.51)

"BLD",4962,"KRN","B",8989.52,8989.52)

"BLD",4962,"KRN","B",8994,8994)

"BLD",4962,"QUES",0)
^9.62^^
"BLD",4962,"REQB",0)
^9.611^7^3
"BLD",4962,"REQB",5,0)
IB*2.0*266^2
"BLD",4962,"REQB",6,0)
IB*2.0*275^2
"BLD",4962,"REQB",7,0)
IB*2.0*267^2
"BLD",4962,"REQB","B","IB*2.0*266",5)

"BLD",4962,"REQB","B","IB*2.0*267",7)

"BLD",4962,"REQB","B","IB*2.0*275",6)

"FIA",372)
PFSS SITE PARAMETERS
"FIA",372,0)
^IBBAS(372,
"FIA",372,0,0)
372P
"FIA",372,0,1)
y^y^f^^^^n
"FIA",372,0,10)

"FIA",372,0,11)

"FIA",372,0,"RLRO")

"FIA",372,0,"VR")
2.0^IB
"FIA",372,372)
0
"FIA",372,372.01)
0
"FIA",372,372.011)
0
"INIT")
POST^IB20P260
"KRN",19,2484,-1)
2^2
"KRN",19,2484,0)
IB SITE MGR MENU^System Manager's Integrated Billing Menu^^M^539^^^^^^^200^^1
"KRN",19,2484,10,0)
^19.01IP^19^19
"KRN",19,2484,10,19,0)
12078^CIDC
"KRN",19,2484,10,19,"^")
IB CIDC INSURANCE SWITCH
"KRN",19,2484,"U")
SYSTEM MANAGER'S INTEGRATED BI
"KRN",19,12078,-1)
0^1
"KRN",19,12078,0)
IB CIDC INSURANCE SWITCH^Edit the CIDC Insurance Switch^^A^^IB SUPERVISOR^^^^^^INTEGRATED BILLING^^1
"KRN",19,12078,1,0)
^19.06^3^3^3041217^^
"KRN",19,12078,1,1,0)
This option allows editing of the CIDC Insurance Swith.  This switch
"KRN",19,12078,1,2,0)
should be changed with great caution as it can effect multiple pakcages
"KRN",19,12078,1,3,0)
and users.
"KRN",19,12078,20)
D EDITPAR^XPAREDIT("IB CIDC INSURANCE CHECK")
"KRN",19,12078,"U")
EDIT THE CIDC INSURANCE SWITCH
"KRN",8989.51,260,-1)
0^1
"KRN",8989.51,260,0)
IB CIDC INSURANCE CHECK^CIDC Questions^0^^CIDC Insurance Check^
"KRN",8989.51,260,1)
S^0:Don't Ask;1:Ask if Insured;2:Ask Always^Specify how the CIDC related questions should be asked.
"KRN",8989.51,260,6)
N
"KRN",8989.51,260,20,0)
^8989.512^10^10^3041216^^
"KRN",8989.51,260,20,1,0)
This parameter is used to set a switch if CIDC related questions should
"KRN",8989.51,260,20,2,0)
be asked.  Setting this parameter will effect multiple packages and users,
"KRN",8989.51,260,20,3,0)
therefore great care should be cautioned when editing this parameter.
"KRN",8989.51,260,20,4,0)
Values are:  0 = Don't ask CIDC related questions for anyone
"KRN",8989.51,260,20,5,0)
             1 = Ask CIDC related questions only if the patient has active
"KRN",8989.51,260,20,6,0)
                 billable insurance.
"KRN",8989.51,260,20,7,0)
             2 = Ask CIDC questions for all patients.
"KRN",8989.51,260,20,8,0)
 
"KRN",8989.51,260,20,9,0)
This does not over-ride the CPRS switches for how the GUI asks questions,
"KRN",8989.51,260,20,10,0)
but enhances the limits of the questions for the GUI.
"KRN",8989.51,260,30,0)
^8989.513I^1^1
"KRN",8989.51,260,30,1,0)
1^4.2
"MBREQ")
1
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",200,-1)
1^1
"PKG",200,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",200,20,0)
^9.402P^2^1
"PKG",200,20,2,0)
2^^IBAXDR
"PKG",200,20,2,1)

"PKG",200,20,"B",2,2)

"PKG",200,22,0)
^9.49I^1^1
"PKG",200,22,1,0)
2.0^2940321^2990406^2447
"PKG",200,22,1,"PAH",1,0)
260^3050805^2438
"PKG",200,22,1,"PAH",1,1,0)
^^1^1^3050805
"PKG",200,22,1,"PAH",1,1,1,0)
Clinical Indicator Data Capture IB support.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
18
"RTN","IB20P260")
0^14^B2350113
"RTN","IB20P260",1,0)
IB20P260 ;OAK/ELZ - POST INSTALL ROUTINE FOR IB*2*260 ;16-DEC-2004
"RTN","IB20P260",2,0)
 ;;2.0;INTEGRATED BILLING;**260**;21-MAR-94
"RTN","IB20P260",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IB20P260",4,0)
 ;
"RTN","IB20P260",5,0)
 ; This is the post install routine for IB*2*260.  This routine will
"RTN","IB20P260",6,0)
 ; set the parameter for CIDC related questions to 1 so the CIDC
"RTN","IB20P260",7,0)
 ; related questions will only be asked if the patient is insured.
"RTN","IB20P260",8,0)
 ;
"RTN","IB20P260",9,0)
POST ;
"RTN","IB20P260",10,0)
 N IBERR,X,Y,DIC,IBS
"RTN","IB20P260",11,0)
 D EN^XPAR("SYS","IB CIDC INSURANCE CHECK",1,0,.IBERR)
"RTN","IB20P260",12,0)
 ;
"RTN","IB20P260",13,0)
 D BMES^XPDUTL($S($G(IBERR):IBERR,1:"Parameter Definition set for CIDC to Don't Ask."))
"RTN","IB20P260",14,0)
 ;
"RTN","IB20P260",15,0)
 K Y
"RTN","IB20P260",16,0)
 S DIC="^IBBAS(372,",X=+$P($G(^IBE(350.9,1,0)),"^",2),DIC(0)=""
"RTN","IB20P260",17,0)
 I $D(^IBBAS(372,1,0)) D BMES^XPDUTL("PFSS site parameter previously set") Q
"RTN","IB20P260",18,0)
 I X D FILE^DICN
"RTN","IB20P260",19,0)
 I $G(Y) S ^IBBAS(372,+Y,1)="0^"_$$NOW^XLFDT D BMES^XPDUTL("The initial PFSS site parameter has been set up.") Q
"RTN","IB20P260",20,0)
 D BMES^XPDUTL("***ERROR: Problem setting the initial PFSS site parameter")
"RTN","IB20P260",21,0)
 Q
"RTN","IBBAPI")
0^15^B540488
"RTN","IBBAPI",1,0)
IBBAPI ;OAK/ELZ - APIS FOR OTHER PACKAGES FOR PFSS ;6-MAY-2003
"RTN","IBBAPI",2,0)
 ;;2.0;INTEGRATED BILLING;**256,228,267,260**;21-MAR-94
"RTN","IBBAPI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBBAPI",4,0)
 ;
"RTN","IBBAPI",5,0)
 ; -- See IBBDOC for API details
"RTN","IBBAPI",6,0)
 ;
"RTN","IBBAPI",7,0)
INSUR(DFN,IBDT,IBSTAT,IBR,IBFLDS) ; Return Patient Insurance Information
"RTN","IBBAPI",8,0)
 ;
"RTN","IBBAPI",9,0)
 Q $$INSUR^IBBFAPI($G(DFN),$G(IBDT),$G(IBSTAT),.IBR,$G(IBFLDS))
"RTN","IBBAPI",10,0)
 ;
"RTN","IBBAPI",11,0)
 ;
"RTN","IBBAPI",12,0)
CIDC(DFN) ; Return if CIDC questions should be asked for DFN
"RTN","IBBAPI",13,0)
 ;
"RTN","IBBAPI",14,0)
 Q $$CIDC^IBBASCI($G(DFN))
"RTN","IBBAPI",15,0)
 ;
"RTN","IBBAPI",16,0)
SWSTAT() ;Return the PFSS Master switch status
"RTN","IBBAPI",17,0)
 Q $$SWSTAT^IBBASWCH
"RTN","IBBAPI",18,0)
 ;
"RTN","IBBASCI")
0^16^B2419575
"RTN","IBBASCI",1,0)
IBBASCI ;OAK/ELZ - CIDC SWITCH UTILITIES ;16-DEC-2004
"RTN","IBBASCI",2,0)
 ;;2.0;INTEGRATED BILLING;**260**;21-MAR-94
"RTN","IBBASCI",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBBASCI",4,0)
 ;
"RTN","IBBASCI",5,0)
 ;
"RTN","IBBASCI",6,0)
 ;
"RTN","IBBASCI",7,0)
CIDC(DFN) ; function to look up the status for DFN and switch
"RTN","IBBASCI",8,0)
 N IBINS,IBSTAT
"RTN","IBBASCI",9,0)
 S IBINS=$S('DFN:1,1:$$INSUR^IBBAPI(DFN))
"RTN","IBBASCI",10,0)
 I IBINS<0 S IBINS=1
"RTN","IBBASCI",11,0)
 S IBSTAT=$$STAT
"RTN","IBBASCI",12,0)
 Q $S(IBSTAT=2:1,IBSTAT=0:0,IBSTAT=1&('IBINS):0,1:1)
"RTN","IBBASCI",13,0)
 ;
"RTN","IBBASCI",14,0)
STAT() ; looks up the status of the CIDC switch
"RTN","IBBASCI",15,0)
 N IBPAR,IBENT
"RTN","IBBASCI",16,0)
 D ENVAL^XPAR(.IBPAR,"IB CIDC INSURANCE CHECK")
"RTN","IBBASCI",17,0)
 S IBENT=$O(IBPAR(""))
"RTN","IBBASCI",18,0)
 Q $S('IBENT:1,$L($G(IBPAR(IBENT,1))):$G(IBPAR(IBENT,1)),1:1)
"RTN","IBBASCI",19,0)
 ;
"RTN","IBBASCI",20,0)
SET ; option to change switch data
"RTN","IBBASCI",21,0)
 W !!,"The switch will change when CIDC prompts are displayed for related applications."
"RTN","IBBASCI",22,0)
 W !,"When changing this option, great care should be executed for it will change the"
"RTN","IBBASCI",23,0)
 W !,"display of CIDC prompts to both providers and back door users.",!!
"RTN","IBBASCI",24,0)
 ;
"RTN","IBBASCI",25,0)
 D EDITPAR^XPAREDIT("IB CIDC INSURANCE CHECK")
"RTN","IBBASCI",26,0)
 ;
"RTN","IBBASCI",27,0)
 Q
"RTN","IBBASWCH")
0^18^B19153346
"RTN","IBBASWCH",1,0)
IBBASWCH ;OAK/ELZ - PFSS MASTER SWITCH FUNCTIONS ;15-MAR-2005
"RTN","IBBASWCH",2,0)
 ;;2.0;INTEGRATED BILLING;**260**;21-MAR-94
"RTN","IBBASWCH",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBBASWCH",4,0)
 ;
"RTN","IBBASWCH",5,0)
SWSTAT() ;get current switch status
"RTN","IBBASWCH",6,0)
 N IBBRTRN,X
"RTN","IBBASWCH",7,0)
 S X=$G(^IBBAS(372,1,1))
"RTN","IBBASWCH",8,0)
 S IBBRTRN=+$P(X,"^",1)_"^"_+$P(X,"^",2)
"RTN","IBBASWCH",9,0)
 Q IBBRTRN
"RTN","IBBASWCH",10,0)
 ;
"RTN","IBBASWCH",11,0)
ONOFF ;set switch
"RTN","IBBASWCH",12,0)
 N DIR,DIRUT,DUOUT,IBBDUZ,IBBTURN,IBBCURST,IBBNEWST,IBBREAS,IBBQUE,IBBSTAT,IBBDTTM,IBBFOK,X,Y,XX
"RTN","IBBASWCH",13,0)
 S IBBDUZ=DUZ,XX=$$CHKKEY(IBBDUZ)
"RTN","IBBASWCH",14,0)
 I 'XX D  Q
"RTN","IBBASWCH",15,0)
 .W !!,"You do not have the Security Key required to use this option.",!,"Exiting...",!!
"RTN","IBBASWCH",16,0)
 ;
"RTN","IBBASWCH",17,0)
 I XX D
"RTN","IBBASWCH",18,0)
 .S IBBCURST=+$G(^IBBAS(372,1,1))
"RTN","IBBASWCH",19,0)
 .S IBBNEWST=$S(IBBCURST:0,1:1),IBBTURN=$S(IBBNEWST:"ON",1:"OFF")
"RTN","IBBASWCH",20,0)
 .;
"RTN","IBBASWCH",21,0)
 .W !
"RTN","IBBASWCH",22,0)
 .K DIR,DIRUT,DUOUT,X,Y
"RTN","IBBASWCH",23,0)
 .S DIR(0)="YA",DIR("A")="Should the PFSS On/Off Switch be turned "_IBBTURN_" ? (Y/N): "
"RTN","IBBASWCH",24,0)
 .D ^DIR
"RTN","IBBASWCH",25,0)
 .Q:$D(DIRUT)  Q:$D(DUOUT)
"RTN","IBBASWCH",26,0)
 .Q:'Y
"RTN","IBBASWCH",27,0)
 .W !
"RTN","IBBASWCH",28,0)
 .K DIR,DIRUT,DUOUT,X,Y
"RTN","IBBASWCH",29,0)
 .S DIR(0)="FA^10:80",DIR("A")="REASON: "
"RTN","IBBASWCH",30,0)
 .S DIR("?")="What is the reason for changing the PFSS On/Off Switch status? [10-80 characters]"
"RTN","IBBASWCH",31,0)
 .D ^DIR
"RTN","IBBASWCH",32,0)
 .Q:$D(DIRUT)  Q:$D(DUOUT)
"RTN","IBBASWCH",33,0)
 .Q:(Y="^")
"RTN","IBBASWCH",34,0)
 .W !
"RTN","IBBASWCH",35,0)
 .S IBBREAS=Y
"RTN","IBBASWCH",36,0)
 .K DIR,DIRUT,DUOUT,X,Y
"RTN","IBBASWCH",37,0)
 .S DIR(0)="YA",DIR("A")="Are you sure the PFSS On/Off Switch should be turned "_IBBTURN_"? (Y/N): "
"RTN","IBBASWCH",38,0)
 .D ^DIR
"RTN","IBBASWCH",39,0)
 .Q:$D(DIRUT)  Q:$D(DUOUT)
"RTN","IBBASWCH",40,0)
 .Q:'Y
"RTN","IBBASWCH",41,0)
 .W !
"RTN","IBBASWCH",42,0)
 .S IBBQUE=0
"RTN","IBBASWCH",43,0)
 .K DIR,DIRUT,DUOUT,X,Y
"RTN","IBBASWCH",44,0)
 .S DIR(0)="YA",DIR("A")="Do you wish to queue this change for a later date/time ? (Y/N): "
"RTN","IBBASWCH",45,0)
 .S DIR("?",1)="You may queue this change to the PFSS On/Off Switch for a later date/time."
"RTN","IBBASWCH",46,0)
 .S DIR("?",2)="For example, you may want the change to take place during non-business"
"RTN","IBBASWCH",47,0)
 .S DIR("?",3)="hours."
"RTN","IBBASWCH",48,0)
 .S DIR("?",4)=" "
"RTN","IBBASWCH",49,0)
 .S DIR("?")="If you opt not to queue the change, then it will be effective immediately."
"RTN","IBBASWCH",50,0)
 .D ^DIR
"RTN","IBBASWCH",51,0)
 .Q:$D(DIRUT)  Q:$D(DUOUT)
"RTN","IBBASWCH",52,0)
 .Q:(Y="^")
"RTN","IBBASWCH",53,0)
 .I Y S IBBQUE=1
"RTN","IBBASWCH",54,0)
 .I 'IBBQUE D
"RTN","IBBASWCH",55,0)
 ..W !!,"One moment please...",!
"RTN","IBBASWCH",56,0)
 ..D FILE
"RTN","IBBASWCH",57,0)
 ..I $G(IBBFOK) W !,"The PFSS On/Off Switch is now "_IBBTURN_".",!!
"RTN","IBBASWCH",58,0)
 ..I '$G(IBBFOK) D
"RTN","IBBASWCH",59,0)
 ...W !,"No update made to PFSS On/Off Switch.",!
"RTN","IBBASWCH",60,0)
 ...K X,Y S IBBSTAT=$$SWSTAT^IBBAPI(),IBBTURN=$S(+IBBSTAT:"ON",1:"OFF"),Y=$P(IBBSTAT,"^",2)
"RTN","IBBASWCH",61,0)
 ...D DD^%DT S IBBDTTM=$P(Y,"@",2)_" on "_$P(Y,"@",1)
"RTN","IBBASWCH",62,0)
 ...W !,"The PFSS On/Off Switch was set to "_IBBTURN_" at "_IBBDTTM_".",!
"RTN","IBBASWCH",63,0)
 .I IBBQUE D
"RTN","IBBASWCH",64,0)
 ..S TASK=$$TASK(IBBDUZ,IBBCURST,IBBNEWST,IBBREAS,IBBTURN)
"RTN","IBBASWCH",65,0)
 ..I TASK W !!,"PFSS On/Off Switch change queued as Task #"_TASK_".",!
"RTN","IBBASWCH",66,0)
 ..I 'TASK W !!,"PFSS On/Off Switch change could not be queued.",!
"RTN","IBBASWCH",67,0)
 Q
"RTN","IBBASWCH",68,0)
 ;
"RTN","IBBASWCH",69,0)
FILE ;file switch status in #372
"RTN","IBBASWCH",70,0)
 N CURRENT,IBB,IBBIEN,IBBIENS,IBBMSG,IBBEFFDT
"RTN","IBBASWCH",71,0)
 ;multiple queued tasks could be for same update to switch status;
"RTN","IBBASWCH",72,0)
 ;do not continue if new status=current status
"RTN","IBBASWCH",73,0)
 S IBBFOK=0
"RTN","IBBASWCH",74,0)
 Q:'$$CHKKEY(IBBDUZ)
"RTN","IBBASWCH",75,0)
 S CURRENT=+$P($G(^IBBAS(372,1,1)),"^",1)
"RTN","IBBASWCH",76,0)
 I IBBNEWST=CURRENT Q
"RTN","IBBASWCH",77,0)
 L +^IBBAS(372,1,1):5
"RTN","IBBASWCH",78,0)
 I IBBNEWST'=CURRENT D
"RTN","IBBASWCH",79,0)
 .;change switch status
"RTN","IBBASWCH",80,0)
 .S IBBIEN(1)=""
"RTN","IBBASWCH",81,0)
 .S IBBIENS="+1,1,"
"RTN","IBBASWCH",82,0)
 .S IBBMSG="IBB(""DIERR"")"
"RTN","IBBASWCH",83,0)
 .S IBBEFFDT=$$NOW^XLFDT()
"RTN","IBBASWCH",84,0)
 .S FDA(372.01,IBBIENS,.01)=IBBEFFDT
"RTN","IBBASWCH",85,0)
 .S FDA(372.01,IBBIENS,.02)=IBBCURST
"RTN","IBBASWCH",86,0)
 .S FDA(372.01,IBBIENS,.03)=IBBDUZ
"RTN","IBBASWCH",87,0)
 .S FDA(372.01,IBBIENS,.04)=IBBREAS
"RTN","IBBASWCH",88,0)
 .D UPDATE^DIE("","FDA","IBBIEN",IBBMSG)
"RTN","IBBASWCH",89,0)
 .I '$D(IBB("DIERR")) S ^IBBAS(372,1,1)=IBBNEWST_"^"_IBBEFFDT
"RTN","IBBASWCH",90,0)
 L -^IBBAS(372,1,1)
"RTN","IBBASWCH",91,0)
 S IBBFOK=1
"RTN","IBBASWCH",92,0)
 Q
"RTN","IBBASWCH",93,0)
 ;
"RTN","IBBASWCH",94,0)
TASK(IBBDUZ,IBBCURST,IBBNEWST,IBBREAS,IBBTURN) ;queue switch change via TaskManager
"RTN","IBBASWCH",95,0)
 N ZTRTN,ZTDESC,ZTDTH,ZTSAVE,ZTSK
"RTN","IBBASWCH",96,0)
 Q:'$$CHKKEY(IBBDUZ) 0
"RTN","IBBASWCH",97,0)
 S ZTDTH=""
"RTN","IBBASWCH",98,0)
 S ZTIO="",ZTDESC="Set PFSS On/Off Switch to "_IBBTURN_" by "_IBBDUZ
"RTN","IBBASWCH",99,0)
 S ZTSAVE("IBBDUZ")="",ZTSAVE("IBBCURST")="",ZTSAVE("IBBNEWST")="",ZTSAVE("IBBREAS")=""
"RTN","IBBASWCH",100,0)
 S ZTRTN="FILE^IBBASWCH"
"RTN","IBBASWCH",101,0)
 W !
"RTN","IBBASWCH",102,0)
 D ^%ZTLOAD
"RTN","IBBASWCH",103,0)
 Q $G(ZTSK)
"RTN","IBBASWCH",104,0)
 ;
"RTN","IBBASWCH",105,0)
CHKKEY(IBBDUZ) ;does user hold security key IBB MASTER SWITCH?
"RTN","IBBASWCH",106,0)
 N X,Y,IBBKEY,DIC
"RTN","IBBASWCH",107,0)
 S IBBKEY=0
"RTN","IBBASWCH",108,0)
 S DIC=19.1,DIC(0)="MXZ",X="IBB MASTER SWITCH"
"RTN","IBBASWCH",109,0)
 D ^DIC
"RTN","IBBASWCH",110,0)
 I +Y'>0 Q IBBKEY
"RTN","IBBASWCH",111,0)
 K X,Y
"RTN","IBBASWCH",112,0)
 S DIC="^VA(200,"_IBBDUZ_",51,",DIC(0)="MXZ",X="IBB MASTER SWITCH"
"RTN","IBBASWCH",113,0)
 D ^DIC
"RTN","IBBASWCH",114,0)
 I +Y'>0 Q IBBKEY
"RTN","IBBASWCH",115,0)
 S IBBKEY=+Y
"RTN","IBBASWCH",116,0)
 Q IBBKEY
"RTN","IBBDOC")
0^17^B264185
"RTN","IBBDOC",1,0)
IBBDOC ;OAK/ELZ - APIS FOR OTHER PACKAGES FOR PFSS - DOCUMENT ;5-AUG-2004
"RTN","IBBDOC",2,0)
 ;;2.0;INTEGRATED BILLING;**267,260**;21-MAR-94
"RTN","IBBDOC",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBBDOC",4,0)
 ;
"RTN","IBBDOC",5,0)
 ; Documents the calls to the routine IBBAPI.
"RTN","IBBDOC",6,0)
 ;
"RTN","IBBDOC",7,0)
INSUR ;(DFN,IBDT,IBSTAT,IBR,IBFLDS)
"RTN","IBBDOC",8,0)
 ; Function to return patient insurance information
"RTN","IBBDOC",9,0)
 ; --Input:
"RTN","IBBDOC",10,0)
 ;   DFN    = patient
"RTN","IBBDOC",11,0)
 ;   IBDT   = date insured (optional - default is today's date)
"RTN","IBBDOC",12,0)
 ;   IBSTAT = Insurance Status filter (combinable based on groups below)
"RTN","IBBDOC",13,0)
 ;      Group 1
"RTN","IBBDOC",14,0)
 ;          A = Inactive included (Default is active only)
"RTN","IBBDOC",15,0)
 ;      Group 2
"RTN","IBBDOC",16,0)
 ;          R = Not reimbursable included (Default is reimbursable only)
"RTN","IBBDOC",17,0)
 ;          B = Indemnity included (Default is not included)
"RTN","IBBDOC",18,0)
 ;      Group 3
"RTN","IBBDOC",19,0)
 ;          P = Prescription coverage required (Default is all coverages)
"RTN","IBBDOC",20,0)
 ;          O = Outpatient coverage required (Default is all coverages)
"RTN","IBBDOC",21,0)
 ;          I = Inpatient coverage only (Default is all coverages)
"RTN","IBBDOC",22,0)
 ;
"RTN","IBBDOC",23,0)
 ;   IBR    = Array to return insurance information - passed by reference
"RTN","IBBDOC",24,0)
 ;   IBFLDS = Lists of fields to return (1-19) in a comma separated list
"RTN","IBBDOC",25,0)
 ;
"RTN","IBBDOC",26,0)
 ; --Output:
"RTN","IBBDOC",27,0)
 ;   -1     = error occurred (error message passed back in
"RTN","IBBDOC",28,0)
 ;            IBR("IBBAPI","INSUR","ERROR",x) where x is error number
"RTN","IBBDOC",29,0)
 ;            between 101 & 111
"RTN","IBBDOC",30,0)
 ;    0     = No insurance found based on parameters
"RTN","IBBDOC",31,0)
 ;    1     = Insurance found
"RTN","IBBDOC",32,0)
 ;
"RTN","IBBDOC",33,0)
 ;
"RTN","IBBDOC",34,0)
CIDC ; (DFN)
"RTN","IBBDOC",35,0)
 ; Input:    DFN for the patient in question.
"RTN","IBBDOC",36,0)
 ; Output:   1 = Ask CIDC questions for the specified patient
"RTN","IBBDOC",37,0)
 ;           0 = Don't ask CIDC questions for the specified patient
"RTN","IBBDOC",38,0)
 ;
"RTN","IBBDOC",39,0)
 ; The API will evaluate both a CIDC switch and the patient's insurance
"RTN","IBBDOC",40,0)
 ; to determine if the CIDC questions should be asked.
"RTN","IBBDOC",41,0)
 ;
"RTN","IBBDOC",42,0)
 ; The switch will have three internal values:
"RTN","IBBDOC",43,0)
 ;    0 = Don't ask any patients
"RTN","IBBDOC",44,0)
 ;    1 = Ask for patients only with active billable insurance
"RTN","IBBDOC",45,0)
 ;    2 = Ask for all patients
"RTN","IBBDOC",46,0)
 ;
"RTN","IBBDOC",47,0)
 ;
"RTN","IBBDOC",48,0)
SWSTAT ; no input
"RTN","IBBDOC",49,0)
 ; output will be the status of PFSS at the local site and the date/time
"RTN","IBBDOC",50,0)
 ; the status was last updated.
"RTN","IBBDOC",51,0)
 ;
"RTN","IBCCPT")
0^3^B67217421
"RTN","IBCCPT",1,0)
IBCCPT ;ALB/LDB - MCCR OUTPATIENT VISITS LISTING CONT. ;29 MAY 90
"RTN","IBCCPT",2,0)
 ;;2.0;INTEGRATED BILLING;**55,62,52,91,106,125,51,148,174,182,245,266,260**;21-MAR-94
"RTN","IBCCPT",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCCPT",4,0)
 ;
"RTN","IBCCPT",5,0)
 ;MAP TO DGCRCPT
"RTN","IBCCPT",6,0)
 ;
"RTN","IBCCPT",7,0)
EN1(IBQUERY,IBHLP) ;
"RTN","IBCCPT",8,0)
 K DIR
"RTN","IBCCPT",9,0)
EN D:$D(DIR) HLP W @IOF S DGU=0 K DGCPT,^UTILITY($J) D VST(.IBQUERY)
"RTN","IBCCPT",10,0)
 D CHDR,WRNO
"RTN","IBCCPT",11,0)
 N ICPTVDT S ICPTVDT=$$BDATE^IBACSV($G(IBIFN)) ; Code Text Version
"RTN","IBCCPT",12,0)
 S (DGCNT,DGCNT1)=0 F  S DGCNT=$O(^UTILITY($J,"CPT-CNT",DGCNT)) Q:'DGCNT  S DGNOD=^(DGCNT),DGCPT=+DGNOD,DGDAT=$P(DGNOD,"^",2),DGBIL=$P(DGNOD,"^",3),DGASC=$P(DGNOD,"^",4),DGDIV=$P(DGNOD,"^",5),DGCNT1=DGCNT1+1 D CPRT I DGU="^" S DGCNT=DGCNT-1 Q
"RTN","IBCCPT",13,0)
 I DGU'="^" F Y=$Y:1:IOSL-6 W !
"RTN","IBCCPT",14,0)
OK1 K Y Q:'$D(^UTILITY($J,"CPT-CNT"))!($D(DIR))!($G(IBHLP))
"RTN","IBCCPT",15,0)
OK S DIR(0)="LAO^1:"_DGCNT1_"^K:X[""."" X",DIR("?")="^N DIR D EN1^IBCCPT(.IBQUERY,1)",DIR("A")="SELECT CPT CODE(S) TO INCLUDE IN THIS BILL: "
"RTN","IBCCPT",16,0)
 D ^DIR K DIR I 'Y D Q1^IBCOPV1 Q
"RTN","IBCCPT",17,0)
 S IBFT=+$P(^DGCR(399,IBIFN,0),"^",19)
"RTN","IBCCPT",18,0)
OK2 W !,"YOU HAVE SELECTED CPT CODE(S) NUMBERED-",$E(Y,1,$L(Y)-1),!,"IS THIS CORRECT" S %=1 D YN^DICN I %=-1 S IBOUT=1 D Q^IBCOPV1 Q
"RTN","IBCCPT",19,0)
 I +Y,'% W !,"Respond 'Y'es to include these codes in the bill.",!,"Respond 'N'o to reselect." G OK2
"RTN","IBCCPT",20,0)
 I +Y,%=2 G OK
"RTN","IBCCPT",21,0)
 ;
"RTN","IBCCPT",22,0)
FILE S DGCPT1=Y,(DGCNT,DGCNT2)=0
"RTN","IBCCPT",23,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR=".09///5" D ^DIE K DR,DA,DIE
"RTN","IBCCPT",24,0)
 F I9=1:1 S I1=$P(DGCPT1,",",I9) Q:'I1  I $D(^UTILITY($J,"CPT-CNT",I1)) S DGNOD=^(I1),DGNOD("DX")=$G(^(I1,"DX")) D FILE1
"RTN","IBCCPT",25,0)
 D Q1^IBCOPV1 Q
"RTN","IBCCPT",26,0)
 ;
"RTN","IBCCPT",27,0)
FILE1 ;  file procedures, if BASC, only for 1 visit date
"RTN","IBCCPT",28,0)
 K DGNOADD S (X,DINUM)=$P(DGNOD,"^",2) D VFILE1^IBCOPV1 K DINUM,X
"RTN","IBCCPT",29,0)
 N IBCPTNM S IBCPTNM=$$CPT^ICPTCOD(+DGNOD,+$P(DGNOD,U,2))
"RTN","IBCCPT",30,0)
 I $D(DGNOADD) W !?10,"Can't add Amb. Surg. ",$P(IBCPTNM,U,2)," without visit date!" Q  ;don't add cpt for date that can't go on bill
"RTN","IBCCPT",31,0)
 I IBFT'=2,+$P(DGNOD,"^",4),$$TOMANY($P(DGNOD,"^",2)) W !?10,"Can't add Billable Amb. Surg. ",$P(IBCPTNM,U,2)," when more than one visit date!",*7 Q
"RTN","IBCCPT",32,0)
 D DSPPRC(IBCPTNM,DGNOD,$G(DGNOD("DX")))
"RTN","IBCCPT",33,0)
 ;
"RTN","IBCCPT",34,0)
 S:'$D(^DGCR(399,IBIFN,"CP",0)) DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCCPT",35,0)
 S DLAYGO=399,DA(1)=IBIFN,DIC="^DGCR(399,"_DA(1)_",""CP"",",DIC(0)="L",X=+DGNOD_";ICPT(" K DD,DO D FILE^DICN S (DA,IBPROCP)=+Y K DO,DD,DLAYGO,DIC("P")
"RTN","IBCCPT",36,0)
 ;
"RTN","IBCCPT",37,0)
 S DR="1///"_$P(DGNOD,"^",2)
"RTN","IBCCPT",38,0)
 I +$P(DGNOD,"^",8) S DR=DR_";18///`"_+$P(DGNOD,"^",8)
"RTN","IBCCPT",39,0)
 I +$P(DGNOD,"^",9) S DR=DR_";6///`"_+$P(DGNOD,"^",9)
"RTN","IBCCPT",40,0)
 I +$P(DGNOD,"^",5) S DR=DR_";5////"_+$P(DGNOD,"^",5)
"RTN","IBCCPT",41,0)
 I +$P(DGNOD,"^",11) S DR=DR_";20////"_+$P(DGNOD,"^",11)
"RTN","IBCCPT",42,0)
 ;
"RTN","IBCCPT",43,0)
 ; file assoc dx if exists from pce
"RTN","IBCCPT",44,0)
 D:$G(DGNOD("DX")) ADDDX^IBCCPT1(IBIFN,IBPROCP,DGNOD("DX"),.DR)
"RTN","IBCCPT",45,0)
 ;
"RTN","IBCCPT",46,0)
 S DIE=DIC D ^DIE
"RTN","IBCCPT",47,0)
 D:$P(DGNOD,U,10)'="" ADDMOD(IBIFN,IBPROCP,$P(DGNOD,U,10))
"RTN","IBCCPT",48,0)
 ;
"RTN","IBCCPT",49,0)
 S DR="16"
"RTN","IBCCPT",50,0)
 I '$P(DGNOD,"^",8) S DR=DR_";18"
"RTN","IBCCPT",51,0)
 I '$P(DGNOD,"^",9) S DR=DR_";6"
"RTN","IBCCPT",52,0)
 I '$P(DGNOD,"^",5) S DR=DR_";5"
"RTN","IBCCPT",53,0)
 S:IBFT=2 DR=DR_";8;9;17//NO"
"RTN","IBCCPT",54,0)
 S DIE=DIC D ^DIE
"RTN","IBCCPT",55,0)
 ;
"RTN","IBCCPT",56,0)
 S DR=$$SPCUNIT^IBCU7(IBIFN,IBPROCP) I DR'="" D ^DIE ; miles/minutes/hours
"RTN","IBCCPT",57,0)
 ;
"RTN","IBCCPT",58,0)
 ; DSS QuadraMed Interface: CPT Sequence and Diagnosis Linkage for Single CPT
"RTN","IBCCPT",59,0)
 I $$QMED^IBCU1("DX^VEJDIBE1",IBIFN) D DX^VEJDIBE1(IBIFN,IBPROCP)
"RTN","IBCCPT",60,0)
 ;
"RTN","IBCCPT",61,0)
 Q:$D(Y)
"RTN","IBCCPT",62,0)
 D DX^IBCU72(IBIFN,IBPROCP):IBFT=2
"RTN","IBCCPT",63,0)
 I IBFT=2 S X=$$ADDTNL^IBCU7(IBIFN,.DA)
"RTN","IBCCPT",64,0)
 L ^DGCR(399,IBIFN):1
"RTN","IBCCPT",65,0)
 K DIE,DIC,DR,DA,IBPROCP
"RTN","IBCCPT",66,0)
 Q
"RTN","IBCCPT",67,0)
 ;
"RTN","IBCCPT",68,0)
CPRT D:$Y+6>IOSL SCR Q:DGU="^"
"RTN","IBCCPT",69,0)
 N IBCPTNM,IBNBM,IBMODS,J,IBZ,IBDATE
"RTN","IBCCPT",70,0)
 S IBDATE=$$BDATE^IBACSV($G(IBIFN))
"RTN","IBCCPT",71,0)
 S IBNBM="",IBCPTNM=$$CPT^ICPTCOD(DGCPT,IBDATE) Q:IBCPTNM'>0
"RTN","IBCCPT",72,0)
 W !,DGCNT,")",?5,$P(IBCPTNM,U,2),?13,$E($P(IBCPTNM,U,3),1,24),?39,$E($P($G(^SC(+$P(DGNOD,U,9),0)),U,1),1,15),?56,$$FMTE^XLFDT(DGDAT,2)
"RTN","IBCCPT",73,0)
 I +DGBIL,+$P($G(DGNOD),U,6) S IBNBM="  *ON BILL/"_$E($P(DGNOD,U,7),1,4)_"*"
"RTN","IBCCPT",74,0)
 I IBNBM="",DGBIL S IBNBM="  *ON THIS BILL*"
"RTN","IBCCPT",75,0)
 I IBNBM="",+$P($G(DGNOD),U,6) S IBNBM="  "_$E($P(DGNOD,U,7),1,12)
"RTN","IBCCPT",76,0)
 W ?64,IBNBM
"RTN","IBCCPT",77,0)
 ;
"RTN","IBCCPT",78,0)
 S IBMODS=$P($G(DGNOD),U,10) F J=1:1 S IBZ=$P(IBMODS,",",J) Q:IBZ=""  S IBZ=$$MOD^ICPTMOD(IBZ,"I",IBDATE) W !,?13,$P(IBZ,U,2),?18,$P(IBZ,U,3)
"RTN","IBCCPT",79,0)
 Q
"RTN","IBCCPT",80,0)
CHDR W @IOF,!,?15,"<<CURRENT PROCEDURAL TERMINOLOGY CODES>>",!!,?10,"LISTING FROM VISIT DATES WITH ASSOCIATED CPT CODES",!,?22,"IN OUTPT ENCOUNTERS FILE",!
"RTN","IBCCPT",81,0)
 K ^TMP("IBVIS",$J)
"RTN","IBCCPT",82,0)
 S L="",$P(L,"=",80)="" W !,L,!,"NO.",?5,"CODE",?13,"SHORT NAME",?39,"CLINIC",?56,"DATE",!,L,! K L
"RTN","IBCCPT",83,0)
 Q
"RTN","IBCCPT",84,0)
ADDMOD(IBIFN,IBY,IBMOD) ; Add modifier(s) from PCE procedure to CPT code mult
"RTN","IBCCPT",85,0)
 N DIE,DR,DIC,DA,DO,DD,IBS,IBM
"RTN","IBCCPT",86,0)
 F IBS=1:1:$L(IBMOD,",") S DA(2)=IBIFN,DA(1)=IBY,X=$O(^DGCR(399,DA(2),"CP",DA(1),"MOD","B",""),-1)+1 S IBM=$P(IBMOD,",",IBS) I IBM'="" D
"RTN","IBCCPT",87,0)
 . S:'$D(^DGCR(399,DA(2),"CP",DA(1),"MOD")) DIC("P")=$$GETSPEC^IBEFUNC(399.0304,16)
"RTN","IBCCPT",88,0)
 . S DIC(0)="L",DIC="^DGCR(399,"_IBIFN_",""CP"","_IBY_",""MOD"",",DLAYGO=399.30416,DIC("DR")=".02////"_IBM
"RTN","IBCCPT",89,0)
 . D FILE^DICN K DIC,DO,DD
"RTN","IBCCPT",90,0)
 Q
"RTN","IBCCPT",91,0)
 ;
"RTN","IBCCPT",92,0)
DSPPRC(CPTNM,NOD,DX) ; display summary of procedure being added
"RTN","IBCCPT",93,0)
 N IBI,IBL,IBMODS,IBMOD,IBPRVTYP,IBPRV,IBDATE,IBP,IBDXT
"RTN","IBCCPT",94,0)
 I $G(CPTNM)=""!($G(NOD)="") Q
"RTN","IBCCPT",95,0)
 S IBMODS=$P(NOD,U,10),IBPRVTYP="",IBPRV=""
"RTN","IBCCPT",96,0)
 I +$P(NOD,U,8) S IBPRV=$P($G(^VA(200,+$P(NOD,U,8),0)),U,1),IBPRVTYP=$P($$PRVTYP^IBCRU6(+$P(NOD,U,8)),U,3) S IBL=$S(($L(IBPRVTYP)+$L(IBPRV))>32:"",1:" - ")
"RTN","IBCCPT",97,0)
 ;
"RTN","IBCCPT",98,0)
 W !!?4,"Adding CPT Procedure: ",$P(CPTNM,U,2),?34,$P(CPTNM,U,3)
"RTN","IBCCPT",99,0)
 S IBDATE=$$BDATE^IBACSV($G(IBIFN))
"RTN","IBCCPT",100,0)
 I IBMODS'="" F IBI=1:1 S IBMOD=$P(IBMODS,",",IBI) Q:'IBMOD  S IBMOD=$$MOD^ICPTMOD(IBMOD,"I",IBDATE) W !,?34,$P(IBMOD,U,2)," - ",$E($P(IBMOD,U,3),1,40)
"RTN","IBCCPT",101,0)
 W !,?34,"Visit: ",$$FMTE^XLFDT(+$P(NOD,U,2),2),", ",$E($P($G(^SC(+$P(NOD,U,9),0)),U,1),1,29)
"RTN","IBCCPT",102,0)
 I IBPRV'="" W !,?34,"Provider: ",$E(IBPRV,1,35) I IBPRVTYP'="" W:IBL="" !,?44 W IBL,IBPRVTYP
"RTN","IBCCPT",103,0)
 I DX F IBP=1:1 Q:'$P(DX,"^",IBP)  S IBDXT=$$ICD9^IBACSV($P(DX,"^",IBP),+$P(NOD,U,2)) W !,?34,"Assoc Dx: ",$E($P(IBDXT,"^")_" "_$P(IBDXT,"^",3),1,35)
"RTN","IBCCPT",104,0)
 W !
"RTN","IBCCPT",105,0)
 Q
"RTN","IBCCPT",106,0)
 ;
"RTN","IBCCPT",107,0)
VST(IBQUERY) ;Procedures for outpatient visits ... If IBQUERY is defined
"RTN","IBCCPT",108,0)
 ;  on entry, the QUERY OBJECT defined by this value will be used for
"RTN","IBCCPT",109,0)
 ;  loop to extract procedures for visits, otherwise, a new QUERY will be opened
"RTN","IBCCPT",110,0)
 ;  If passed by reference, IBQUERY will be ret'd as the new QUERY ref #
"RTN","IBCCPT",111,0)
 S DGCNT=0 I $O(^DGCR(399,IBIFN,"OP",0)) F V=0:0 S V=$O(^DGCR(399,IBIFN,"OP",V)) Q:'V  S (IBOPV1,IBOPV2)=V D PROC(.IBQUERY)
"RTN","IBCCPT",112,0)
 I $O(^DGCR(399,IBIFN,"OP",0)) K ^TMP("IBVIS",$J) G VSTQ
"RTN","IBCCPT",113,0)
 S IBOPV1=$P(^DGCR(399,IBIFN,"U"),"^"),IBOPV2=$P(^("U"),"^",2)
"RTN","IBCCPT",114,0)
 D PROC(.IBQUERY) K ^TMP("IBVIS",$J)
"RTN","IBCCPT",115,0)
VSTQ Q
"RTN","IBCCPT",116,0)
 ;
"RTN","IBCCPT",117,0)
WRNO W:'$O(^UTILITY($J,"CPT-CNT",0)) !,"NO CPT CODES ON FILE FOR THE ",$S($O(^DGCR(399,IBIFN,"OP",0)):"VISIT DATES ON THIS BILL",1:"PERIOD THAT THIS STATEMENT COVERS")
"RTN","IBCCPT",118,0)
 Q
"RTN","IBCCPT",119,0)
SCR Q:DGU="^"  I $E(IOST,1,2)["C-",$Y+6>IOSL F Y=$Y:1:IOSL-5 W !
"RTN","IBCCPT",120,0)
 I  R !,"Press return to continue or ""^"" to exit display ",DGU:DTIME D:DGU'="^" CHDR
"RTN","IBCCPT",121,0)
 Q
"RTN","IBCCPT",122,0)
HLP W !!,"Enter a number between 1 and ",DGCNT1," or a range of numbers separated with commas",!,"or dashes, e.g., 1,3,5 or 2-4,8"
"RTN","IBCCPT",123,0)
 W !,"The number(s) must appear as a selectable number in the sequential list." R H:5 K H Q
"RTN","IBCCPT",124,0)
CPT S DA(1)=IBIFN,IBCCPTZ=$P(^DGCR(399,DA(1),0),U,9),IBCCPTX=$S($D(^DGCR(399,DA(1),"C"))&IBCCPTZ:1,1:0)
"RTN","IBCCPT",125,0)
 K DIK,DGTE,I1 Q
"RTN","IBCCPT",126,0)
 ;
"RTN","IBCCPT",127,0)
PROC(IBQUERY) ;  -find outpatient procedures, flag if billable
"RTN","IBCCPT",128,0)
 ;  -  ^utility($j,cpt-cnt,count)=code^date^on bill^is BASC^divis^nb^nb mess^provider^clinic^mod,mod^Opt Enc Ptr
"RTN","IBCCPT",129,0)
 ;  -  ^utility($j,cpt-cnt,count,"dx")=assoc dx(1)^assoc dx(2)^assoc dx(3)^assoc dx(4)
"RTN","IBCCPT",130,0)
 N IBVAL,IBCBK,IBFILTER
"RTN","IBCCPT",131,0)
 S IBVAL("DFN")=DFN,IBVAL("BDT")=IBOPV1,IBVAL("EDT")=(IBOPV2+.99)
"RTN","IBCCPT",132,0)
 ; Must be a billable appt type and outpt enctr status of CHECKED OUT
"RTN","IBCCPT",133,0)
 S IBFILTER=""
"RTN","IBCCPT",134,0)
 S IBCBK="I '$P(Y0,U,6),$P(Y0,U,7),$$DSP^IBEFUNC($P(Y0,U,10),+Y0),'$D(^TMP(""IBVIS"",$J,+$P(Y0,U,5))) S ^TMP(""IBVIS"",$J,+$P(Y0,U,5))="""" D EXTPROC^IBCCPT(IBIFN,Y,Y0,.DGCNT)"
"RTN","IBCCPT",135,0)
 D SCAN^IBSDU("PATIENT/DATE",.IBVAL,IBFILTER,IBCBK,0,.IBQUERY) K ^TMP("DIERR",$J)
"RTN","IBCCPT",136,0)
 ;
"RTN","IBCCPT",137,0)
 Q
"RTN","IBCCPT",138,0)
EXTPROC(IBIFN,IBOE,IBOE0,IBCNT) ; Extract procedures for an encounter
"RTN","IBCCPT",139,0)
 ; IBIFN = the ien of the bill
"RTN","IBCCPT",140,0)
 ; IBOE0 = 0-node of the outpatient encounter file entry IBOE
"RTN","IBCCPT",141,0)
 ; IBCNT  extracted entry counter
"RTN","IBCCPT",142,0)
 N I2,I7,IBCPT,IBCPTS,IBDIV,IBOED,IBZERR,Z,IBCPTDAT,IBCPTPRV,IBCLINIC,IBZ,IBONBILL,IBMODS,IBARR,IBDT,DFN,IBEX,IBDX
"RTN","IBCCPT",143,0)
 ; make sure i have this variable
"RTN","IBCCPT",144,0)
 S:$G(IBOE0)="" IBOE0=$$SCE^IBSDU(+IBOE)
"RTN","IBCCPT",145,0)
 D GETCPT^SDOE(IBOE,"IBCPTS","IBZERR")
"RTN","IBCCPT",146,0)
 Q:'$O(IBCPTS(0))  ;No procedures for this encounter
"RTN","IBCCPT",147,0)
 I '$$BDSRC^IBEFUNC3($P($G(IBOE0),U,5)) Q  ; non-billable visit data source
"RTN","IBCCPT",148,0)
 S IBOED=$$NBOE^IBCU81(IBOE,IBOE0)
"RTN","IBCCPT",149,0)
 S I7=IBOE0\1,IBDIV=$P(IBOE0,U,11)
"RTN","IBCCPT",150,0)
 S IBCLINIC="" I +$P(IBOE0,U,4),+$$CLNSCRN^IBCU(I7,+$P(IBOE0,U,4)) S IBCLINIC=+$P(IBOE0,U,4)
"RTN","IBCCPT",151,0)
 S I2=0 F  S I2=$O(IBCPTS(I2)) Q:'I2  D
"RTN","IBCCPT",152,0)
 . S IBCPT=$P(IBCPTS(I2),U)
"RTN","IBCCPT",153,0)
 . S IBCPTPRV=$P($G(IBCPTS(I2,12)),U,4)
"RTN","IBCCPT",154,0)
 . S IBONBILL=0 S IBZ=0 F  S IBZ=$O(^DGCR(399,IBIFN,"CP","B",IBCPT_";ICPT(",IBZ)) Q:'IBZ  I $P($G(^DGCR(399,IBIFN,"CP",IBZ,0)),U,2)=I7 S IBONBILL=1
"RTN","IBCCPT",155,0)
 . S IBMODS="",IBZ=0 F  S IBZ=$O(IBCPTS(I2,1,IBZ)) Q:'IBZ  S IBMODS=IBMODS_$S(IBMODS="":"",1:",")_+$G(IBCPTS(I2,1,IBZ,0))
"RTN","IBCCPT",156,0)
 . ;
"RTN","IBCCPT",157,0)
 . ; look up of a procedure is non-billable and get assoc dx
"RTN","IBCCPT",158,0)
 . S IBOEDP=$$NBOEP^IBCCPT1(IBOE0,IBCPT,.IBDX)
"RTN","IBCCPT",159,0)
 . S IBCPTDAT=IBCPT_U_I7_U_IBONBILL_U_0_U_IBDIV_U_$S($P(IBOED,U):$P(IBOED,U),1:$P(IBOEDP,U))_U_$S($P(IBOED,U):$P(IBOED,U,2),1:$P(IBOEDP,U,2))_U_IBCPTPRV_U_IBCLINIC_U_IBMODS_U_IBOE
"RTN","IBCCPT",160,0)
 . F Z=1:1:$P(IBCPTS(I2),U,16) S IBCNT=IBCNT+1,^UTILITY($J,"CPT-CNT",IBCNT)=IBCPTDAT,^UTILITY($J,"CPT-CNT",IBCNT,"DX")=$G(IBDX)
"RTN","IBCCPT",161,0)
 . K IBDX
"RTN","IBCCPT",162,0)
 I $O(IBARR("CPT",0)),'$D(^UTILITY($J,"CPT",+IBOE0,0)) S ^(0)="Y"
"RTN","IBCCPT",163,0)
 Q
"RTN","IBCCPT",164,0)
 ;
"RTN","IBCCPT",165,0)
TOMANY(DATE) ;  - returns 1 if more than 1 visit date on bill (for basc)
"RTN","IBCCPT",166,0)
 G TOMANYQ:'$D(DATE)
"RTN","IBCCPT",167,0)
 S DGVCNT=+$P($G(^DGCR(399,IBIFN,"OP",0)),"^",4)
"RTN","IBCCPT",168,0)
 I DGVCNT>1!(DGVCNT=1&('$D(^DGCR(399,IBIFN,"OP",DATE)))) K DGVCNT Q 1
"RTN","IBCCPT",169,0)
TOMANYQ Q 0
"RTN","IBCCPT",170,0)
 ;
"RTN","IBCCPT1")
0^4^B10855757
"RTN","IBCCPT1",1,0)
IBCCPT1 ;OAK/ELZ - MCCR OUTPATIENT VISITS LISTING CONT.(2) ;30-JUL-2003
"RTN","IBCCPT1",2,0)
 ;;2.0;INTEGRATED BILLING;**260**;21-MAR-94
"RTN","IBCCPT1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCCPT1",4,0)
 ;
"RTN","IBCCPT1",5,0)
 ;
"RTN","IBCCPT1",6,0)
NBOEP(IBOEO,IBBCPT,IBDXDAT) ; returnes if a procedure is billable
"RTN","IBCCPT1",7,0)
 ;
"RTN","IBCCPT1",8,0)
 N IBRMARK,IBPCEX,IBARR,IBP,IBDX,IBL,IBT,IBVST800,IBCPT800,IBDX800,DFN,IBDT,IBCPT
"RTN","IBCCPT1",9,0)
 S IBRMARK="",IBPCEX=$P(IBOEO,"^",5)
"RTN","IBCCPT1",10,0)
 S DFN=$P(IBOEO,"^",2),IBDT=IBOEO/1
"RTN","IBCCPT1",11,0)
 ;
"RTN","IBCCPT1",12,0)
 ; look up classification info needed (if any)
"RTN","IBCCPT1",13,0)
 D CL^SDCO21(DFN,IBDT,"",.IBARR) ;I '$D(IBARR) G NBOEPQ
"RTN","IBCCPT1",14,0)
 ;
"RTN","IBCCPT1",15,0)
 ; look up PCE info
"RTN","IBCCPT1",16,0)
 D ENCEVENT^PXKENC(IBPCEX)
"RTN","IBCCPT1",17,0)
 S IBVST800=$G(^TMP("PXKENC",$J,IBPCEX,"VST",IBPCEX,800))
"RTN","IBCCPT1",18,0)
 ;
"RTN","IBCCPT1",19,0)
 ; do comparison to find dx to cpt relations
"RTN","IBCCPT1",20,0)
 S IBCPT=0 F  S IBCPT=$O(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT)) Q:IBCPT<1  S IBDX=0 I IBBCPT=+^(IBCPT,0) F  S IBDX=$O(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX)) Q:IBDX<1  D
"RTN","IBCCPT1",21,0)
 . F IBP=5,9,10,11 Q:'$D(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0))  I $P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP)=+$G(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX,0)) D
"RTN","IBCCPT1",22,0)
 .. S IBDXDAT=$G(IBDXDAT)_+$G(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX,0))_"^"
"RTN","IBCCPT1",23,0)
 .. S IBDX800=$G(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX,800))
"RTN","IBCCPT1",24,0)
 .. S IBCPT800=$G(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,800))
"RTN","IBCCPT1",25,0)
 .. ;
"RTN","IBCCPT1",26,0)
 .. ; is classification filled in as true on dx level?
"RTN","IBCCPT1",27,0)
 .. F IBL=2:1  S IBT=$P($T(CLDATA+IBL^IBTRKR41),";",3) Q:IBT=""  I $D(IBARR(+IBT)),$P(IBDX800,"^",$P(IBT,"^",2)) S IBRMARK=$P(IBT,"^",3) Q
"RTN","IBCCPT1",28,0)
 .. ;
"RTN","IBCCPT1",29,0)
 .. ; if no cl filled in for dx, then check cpt level for true
"RTN","IBCCPT1",30,0)
 .. I $D(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0)) F IBL=2:1  S IBT=$P($T(CLDATA+IBL^IBTRKR41),";",3) Q:IBT=""  I $D(IBARR(+IBT)),$P(IBDX800,"^",$P(IBT,"^",2))="",$P(IBCPT800,"^",$P(IBT,"^",2)) S IBRMARK=$P(IBT,"^",3) Q
"RTN","IBCCPT1",31,0)
 .. ;
"RTN","IBCCPT1",32,0)
 .. ; if no cl for dx or cpt, use visit level
"RTN","IBCCPT1",33,0)
 .. I $D(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0)) F IBL=2:1  S IBT=$P($T(CLDATA+IBL^IBTRKR41),";",3) Q:IBT=""  D
"RTN","IBCCPT1",34,0)
 ... I $D(IBARR(+IBT)),$P(IBDX800,"^",$P(IBT,"^",2))="",$P(IBCPT800,"^",$P(IBT,"^",2))="",$P(IBVST800,"^",$P(IBT,"^",2)) S IBRMARK=$P(IBT,"^",3) Q
"RTN","IBCCPT1",35,0)
 ;
"RTN","IBCCPT1",36,0)
 ;
"RTN","IBCCPT1",37,0)
NBOEPQ K ^TMP("PXKENC",$J)
"RTN","IBCCPT1",38,0)
 Q IBRMARK
"RTN","IBCCPT1",39,0)
 ;
"RTN","IBCCPT1",40,0)
ADDDX(IBIFN,IBPROCP,IBDX,IBDR) ; file assoc dx, add to DR string for bill
"RTN","IBCCPT1",41,0)
 N DIC,X,Y,DLAYGO,IBP,IBDXDA,DD,DO
"RTN","IBCCPT1",42,0)
 F IBP=1:1:4 S X=$P(IBDX,"^",IBP) D:X
"RTN","IBCCPT1",43,0)
 . S IBDXDA=$O(^IBA(362.3,"AIFN"_IBIFN,X,0)) I IBDXDA S IBDR=$G(IBDR)_$S($L($G(IBDR)):";",1:"")_(IBP+9)_"////"_IBDXDA Q
"RTN","IBCCPT1",44,0)
 . S DIC("DR")=".02////"_IBIFN,DIC="^IBA(362.3,",DIC(0)="L",DLAYGO=362.3 K DD,DO D FILE^DICN I Y>0 S IBDR=$G(IBDR)_$S($L($G(IBDR)):";",1:"")_(IBP+9)_"////"_(+Y)
"RTN","IBCCPT1",45,0)
 Q
"RTN","IBCD3")
0^5^B31379755
"RTN","IBCD3",1,0)
IBCD3 ;ALB/ARH - AUTOMATED BILLER (ADD NEW BILL - CREATE BILL ENTRY) ;9/5/93
"RTN","IBCD3",2,0)
 ;;2.0;INTEGRATED BILLING;**14,55,52,91,106,125,51,148,160,137,210,245,260**;21-MAR-94
"RTN","IBCD3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCD3",4,0)
 ;
"RTN","IBCD3",5,0)
 ;Called by IBCD2,IBACUS2
"RTN","IBCD3",6,0)
 ;
"RTN","IBCD3",7,0)
EN(IBQUERY) ;
"RTN","IBCD3",8,0)
 N IBI,IBX,IBY,I,X,X1,X2,IBAC,IBCPY K IBDR,IBDR222 S IBAC=1
"RTN","IBCD3",9,0)
 S X=$P($T(WHERE),";;",2),X2=$P($T(WHERE+1),";;",2) F I=0:0 S I=$O(IB(I)) Q:'I  S X1=$P($E(X,$F(X,I)+1,999),";",1) S:X1="" X1=$P($E(X2,$F(X2,I)+1,999),";",1) I $D(IB(I))=1 S $P(IBDR($P(X1,"^",1)),"^",$P(X1,"^",2))=IB(I)
"RTN","IBCD3",10,0)
 F I=0,"C","M","M1","S","U","U1","U2" I $D(IBDR(I)) S ^DGCR(399,IBIFN,I)=IBDR(I)
"RTN","IBCD3",11,0)
 S $P(^DGCR(399,0),"^",3)=IBIFN,$P(^(0),"^",4)=$P(^(0),"^",4)+1
"RTN","IBCD3",12,0)
 S DIK="^DGCR(399,",DA=IBIFN D IX1^DIK K DA,DIK ; set cross-references
"RTN","IBCD3",13,0)
 ;
"RTN","IBCD3",14,0)
 ; Set the attending/rendering provider into provider multiple
"RTN","IBCD3",15,0)
 I $G(IB("PRV",.01))'="" D
"RTN","IBCD3",16,0)
 . S DIC("DR")="",I=.01
"RTN","IBCD3",17,0)
 . N IBV
"RTN","IBCD3",18,0)
 . F  S I=$O(IB("PRV",I)) Q:'I  I IB("PRV",I)'="" S IBV(I)=IB("PRV",I),DIC("DR")=DIC("DR")_$S(DIC("DR")="":"",1:";")_I_"////^S X=IBV("_I_")"
"RTN","IBCD3",19,0)
 . S DIC="^DGCR(399,"_IBIFN_",""PRV"",",DIC(0)="L",DLAYGO=399,DA(1)=IBIFN,X=IB("PRV",.01)
"RTN","IBCD3",20,0)
 . K DO,DD D FILE^DICN K DO,DD,DLAYGO,DA,DIC
"RTN","IBCD3",21,0)
 ;
"RTN","IBCD3",22,0)
 ; Set the occurrence span codes for leave/pass days
"RTN","IBCD3",23,0)
 I $O(IB("OC",0)) D
"RTN","IBCD3",24,0)
 . N I,I1
"RTN","IBCD3",25,0)
 . S I1=0 F  S I1=$O(IB("OC",I1)) Q:'I1  D
"RTN","IBCD3",26,0)
 .. S I=0,DIC("DR")=""
"RTN","IBCD3",27,0)
 .. F  S I=$O(IB("OC",I1,I)) Q:'I  S DIC("DR")=DIC("DR")_$S(DIC("DR")="":"",1:";")_I_"////"_IB("OC",I1,I)
"RTN","IBCD3",28,0)
 .. S DIC="^DGCR(399,"_IBIFN_",""OC"",",DIC(0)="L",DLAYGO=399,DA(1)=IBIFN,DIC("P")=$$GETSPEC^IBEFUNC(399,41),X=IB("OC")
"RTN","IBCD3",29,0)
 .. K DO,DD D FILE^DICN K DO,DD,DLAYGO,DA,DIC
"RTN","IBCD3",30,0)
 ;
"RTN","IBCD3",31,0)
 ; file rx refills, default CPT and Dx if defined
"RTN","IBCD3",32,0)
 I $D(IB(362.4))>2 D  G END
"RTN","IBCD3",33,0)
 . N IBZ
"RTN","IBCD3",34,0)
 . S IBRX=0 F  S IBRX=$O(IB(362.4,IBRX)) Q:'IBRX  S IBY="" F  S IBY=$O(IB(362.4,IBRX,IBY)) Q:IBY=""  D
"RTN","IBCD3",35,0)
 .. S IBX=IB(362.4,IBRX,IBY) Q:IBX=""
"RTN","IBCD3",36,0)
 .. S IBZ=$$ADD^IBCSC5A($P(IBX,U),IBIFN,$P(IBX,U,4),$P(IBX,U,2),+IBRX,$P(IBX,U,3)_U_$P(IBX,U,5)_U_$P(IBX,U,6))
"RTN","IBCD3",37,0)
 ;
"RTN","IBCD3",38,0)
 ;file outpatient visit dates and find/store outpatient procedures and dx
"RTN","IBCD3",39,0)
 ;NOTE: If IBQUERY is defined at this point, it will be used to perform
"RTN","IBCD3",40,0)
 ;       the scan for outpatient procedures
"RTN","IBCD3",41,0)
 I '$$INPAT^IBCEF(IBIFN) D  G END
"RTN","IBCD3",42,0)
 . I $D(IB(43))>2 D
"RTN","IBCD3",43,0)
 .. S ^DGCR(399,IBIFN,"OP",0)="^399.043DA^" S IBX=0 F  S IBX=$O(IB(43,IBX)) Q:'IBX  D
"RTN","IBCD3",44,0)
 ... S DIC="^DGCR(399,"_IBIFN_",""OP"",",DIC(0)="L",DA(1)=IBIFN,(DINUM,X)=IBX,DLAYGO=399.043 K DD,DO D FILE^DICN K DIC,DA,DINUM,DO,DD,DLAYGO
"RTN","IBCD3",45,0)
 . ;
"RTN","IBCD3",46,0)
 . D VST^IBCCPT(.IBQUERY) I $D(^UTILITY($J,"CPT-CNT")) D
"RTN","IBCD3",47,0)
 .. N IBPRX
"RTN","IBCD3",48,0)
 .. S DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCD3",49,0)
 .. S IBY=0 F  S IBY=$O(^UTILITY($J,"CPT-CNT",IBY)) Q:'IBY  S IBX=^(IBY) I '$P(IBX,U,6) D
"RTN","IBCD3",50,0)
 ... S IBPRX(+$P(IBX,U,8))=""
"RTN","IBCD3",51,0)
 ... S DIC="^DGCR(399,"_IBIFN_",""CP"",",DIC(0)="L",DA(1)=IBIFN,X=+IBX_";ICPT(",DLAYGO=399 K DD,DO D FILE^DICN K DO,DD,DLAYGO Q:Y'>0
"RTN","IBCD3",52,0)
 ... ;
"RTN","IBCD3",53,0)
 ... S IBCPY=+Y
"RTN","IBCD3",54,0)
 ... ;
"RTN","IBCD3",55,0)
 ... ; add dx to 362.3 for associations if they exist
"RTN","IBCD3",56,0)
 ... I $G(^UTILITY($J,"CPT-CNT",IBY,"DX")) D ADDDX^IBCCPT1(IBIFN,IBCPY,^("DX"),.IBDR) I $L($G(IBDR)) S IBDR=IBDR_";"
"RTN","IBCD3",57,0)
 ... ;
"RTN","IBCD3",58,0)
 ... ;
"RTN","IBCD3",59,0)
 ... S DR=$G(IBDR)_"1////"_$P(IBX,U,2)_$S(+$P(IBX,U,8):";18////"_+$P(IBX,U,8),1:"") K IBDR
"RTN","IBCD3",60,0)
 ... S DR=DR_$S(+$P(IBX,U,9):";6////"_+$P(IBX,U,9),1:"")_$S(+$P(IBX,U,5):";5////"_+$P(IBX,U,5),1:"")
"RTN","IBCD3",61,0)
 ... S DR=DR_$S(+$P(IBX,U,11):";20////"_+$P(IBX,U,11),1:"")
"RTN","IBCD3",62,0)
 ... S DIE=DIC,DA=+IBCPY D ^DIE K DIE,DIC,DA,DINUM,DO,DD
"RTN","IBCD3",63,0)
 ... I $P(IBX,U,10) D ADDMOD^IBCCPT(IBIFN,IBCPY,$P(IBX,U,10)) ;Modifiers
"RTN","IBCD3",64,0)
 .. I $O(IBPRX(""))=$O(IBPRX(""),-1),$O(IBPRX(0)) D
"RTN","IBCD3",65,0)
 ... ;If only 1 provider - make it the rendering
"RTN","IBCD3",66,0)
 ... S IB("PRV",.02)=+$O(IBPRX(0))_";VA(200,",IB("PRV",.01)=3
"RTN","IBCD3",67,0)
 . K DGCNT,V,IBOPV1,IBOPV2,I,DGDIV,I1,DGNOD,DGCPTS,I7,I2,DGCPT,^UTILITY($J,"CPT-CNT")
"RTN","IBCD3",68,0)
 . ;
"RTN","IBCD3",69,0)
 . D OPTDX^IBCSC4D(DFN,IB(151),IB(152),.IBDX) I +IBDX D  K IBDX
"RTN","IBCD3",70,0)
 .. S IBY=0 F  S IBY=$O(IBDX(IBY)) Q:IBY=""  S IBX=IBDX(IBY) I '$P(IBX,U,5) D
"RTN","IBCD3",71,0)
 ... I '$D(^DGCR(399,"AOPV",DFN,(+$P(IBX,U,4)\1),IBIFN)) Q
"RTN","IBCD3",72,0)
 ... S DIC("DR")=".02////"_IBIFN,DIC="^IBA(362.3,",DIC(0)="L",X=+IBX,DLAYGO=362.3 K DD,DO D FILE^DICN
"RTN","IBCD3",73,0)
 ... K DIE,DIC,DA,DLAYGO,DO,DD
"RTN","IBCD3",74,0)
 ;
"RTN","IBCD3",75,0)
 ;store inpatient diagnosis and procedures, default admit dx to first dx found
"RTN","IBCD3",76,0)
 I $$INPAT^IBCEF(IBIFN) D  G END
"RTN","IBCD3",77,0)
 . I $G(^TMP("IBDX",$J))=IB(.08) D  K ^TMP("IBDX",$J)
"RTN","IBCD3",78,0)
 .. N IBXDEF S IBXDEF=0
"RTN","IBCD3",79,0)
 .. S (IBI,IBX)="" F  S IBX=$O(^TMP("IBDX",$J,IBX)) Q:'IBX  S IBY=0 F  S IBY=$O(^TMP("IBDX",$J,IBX,IBY)) Q:'IBY  D
"RTN","IBCD3",80,0)
 ... S IBZ=^TMP("IBDX",$J,IBX,IBY) Q:($$ICD9^IBACSV(+IBZ)="")  S IBI=IBI+1
"RTN","IBCD3",81,0)
 ... S DIC("DR")=".02////"_IBIFN_";.03////"_IBI,DIC="^IBA(362.3,",DIC(0)="L",X=+IBZ,DLAYGO=362.3 K DD,DO D FILE^DICN
"RTN","IBCD3",82,0)
 ... K DIE,DIC,DA,DLAYGO,DO,DD
"RTN","IBCD3",83,0)
 ... I Y>0,'IBXDEF S IBXDEF=1,DR="215////"_+IBZ,DIE="^DGCR(399,",DA=IBIFN D ^DIE
"RTN","IBCD3",84,0)
 . ;
"RTN","IBCD3",85,0)
 . D IPRC^IBCD4(+IB(.08),IB(151),IB(152)) I $D(^TMP("IBIPRC",$J)) D  K ^TMP("IBIPRC",$J)
"RTN","IBCD3",86,0)
 .. S ^DGCR(399,IBIFN,"CP",0)="^399.0304AVI^"
"RTN","IBCD3",87,0)
 .. S IBX=0 F  S IBX=$O(^TMP("IBIPRC",$J,IBX)) Q:'IBX  D
"RTN","IBCD3",88,0)
 ... S IBY=^TMP("IBIPRC",$J,IBX) F IBI=1:1 S IBZ=$P(IBY,U,IBI) Q:'IBZ  D
"RTN","IBCD3",89,0)
 .... S DIC="^DGCR(399,"_IBIFN_",""CP"",",DIC(0)="L",DA(1)=IBIFN,X=+IBZ_";ICD0(",DLAYGO=399.0304 K DD,DO D FILE^DICN
"RTN","IBCD3",90,0)
 .... I Y>0 S DIE=DIC,DA=+Y,DR="1////"_(IBX\1) D ^DIE K DIE,DIC,DA,DLAYGO,DO,DD
"RTN","IBCD3",91,0)
 ;
"RTN","IBCD3",92,0)
END S IBX="1^Billing Record #"_$P(^DGCR(399,+IBIFN,0),"^",1)_" established for "_$P($G(^DPT(IBDFN,0)),U,1)
"RTN","IBCD3",93,0)
 ;
"RTN","IBCD3",94,0)
 S IBAUTO=1,DGPTUPDT="" I '$G(IBCHTRN) D PROC^IBCU7A(IBIFN) D ^IBCU6 ; auto calculate/store revenue codes
"RTN","IBCD3",95,0)
 ;
"RTN","IBCD3",96,0)
Q K %,%DT,IBDR,X1,X2,X3,X4,Y,DGDIRA,DGDIRB,DGDIR0,DIR,DGRVRCAL,DIC,DA,DR,DINUM,DGPTUPDT,DGXRF1,IBCHK,IBINDT,IBIDS,DLAYGO
"RTN","IBCD3",97,0)
 Q
"RTN","IBCD3",98,0)
 ;
"RTN","IBCD3",99,0)
WHERE ;;.01^0^1;.02^0^2;.03^0^3;.04^0^4;.05^0^5;.06^0^6;.07^0^7;.08^0^8;.09^0^9;.11^0^11;.17^0^17;.16^0^16;.18^0^18;.19^0^19;.2^0^20;.22^0^22;.27^0^27;112^M^12;151^U^1;152^U^2;155^U^5;101^M^1;158^U^8;159^U^9;160^U^10;161^U^11;162^U^12;
"RTN","IBCD3",100,0)
 ;;217^U2^3;221^U2^7;
"RTN","IBCOPV")
0^12^B21022781
"RTN","IBCOPV",1,0)
IBCOPV ;ALB/LDB,TMP - ROUTINE TO LIST PATIENT VISITS ;30 APR 90
"RTN","IBCOPV",2,0)
 ;;2.0;INTEGRATED BILLING;**27,91,106,124,174,260**;21-MAR-94
"RTN","IBCOPV",3,0)
 ;
"RTN","IBCOPV",4,0)
 ;MAP TO DGCROPV ... input IBIFN
"RTN","IBCOPV",5,0)
 ;
"RTN","IBCOPV",6,0)
 N DGNO,DGNO1,IBCBK,IBVAL,IBZ,IBPB,IBOE,IBOE0
"RTN","IBCOPV",7,0)
 S IBCOPV=^DGCR(399,IBIFN,"U"),IBCOPV1=$P(IBCOPV,"^"),IBCOPV2=$P(IBCOPV,"^",2) Q:'(IBCOPV1+IBCOPV2)
"RTN","IBCOPV",8,0)
 S (DGCNT,DGU)=0 K DGCPT,^UTILITY($J),DGNOD
"RTN","IBCOPV",9,0)
 ;
"RTN","IBCOPV",10,0)
 S IBVAL("DFN")=DFN,IBVAL("BDT")=IBCOPV1,IBVAL("EDT")=IBCOPV2+.9999
"RTN","IBCOPV",11,0)
 S IBCBK="I '$P(Y0,U,6) S ^TMP(""IBOE"",$J,+$P(Y0,U,8),Y)=Y0"
"RTN","IBCOPV",12,0)
 K ^TMP("IBOE",$J)
"RTN","IBCOPV",13,0)
 S DGNO1=1
"RTN","IBCOPV",14,0)
 D SCAN^IBSDU("PATIENT/DATE",.IBVAL,"",IBCBK,1) K ^TMP("DIERR",$J)
"RTN","IBCOPV",15,0)
 F IBZ=9,13 S IBCK(IBZ)=""
"RTN","IBCOPV",16,0)
 K ^TMP("IBVIS",$J)
"RTN","IBCOPV",17,0)
 S IBZ=0 F  S IBZ=$O(^TMP("IBOE",$J,IBZ)) Q:'IBZ  S IBOE=0 F  S IBOE=$O(^TMP("IBOE",$J,IBZ,IBOE)) Q:'IBOE  S IBOE0=$G(^(IBOE)) D
"RTN","IBCOPV",18,0)
 . K IBPB
"RTN","IBCOPV",19,0)
 . S IBEP=$$BILLCK^IBAMTEDU(IBOE,IBOE0,.IBCK,.IBPB)
"RTN","IBCOPV",20,0)
 . I IBEP D CHK(IBOE,IBOE0,.DGNO1)
"RTN","IBCOPV",21,0)
 . S ^TMP("IBVIS",$J,+$P(IBOE0,U,5))=""
"RTN","IBCOPV",22,0)
 K ^TMP("IBOE",$J),^TMP("IBVIS",$J)
"RTN","IBCOPV",23,0)
 D CNT,CNT399 K DIR
"RTN","IBCOPV",24,0)
 I 'DGCNT D NOVT^IBCOPV1 Q
"RTN","IBCOPV",25,0)
 D PRT^IBCOPV1
"RTN","IBCOPV",26,0)
 Q
"RTN","IBCOPV",27,0)
 ;
"RTN","IBCOPV",28,0)
CHK(IBOE,IBOE0,DGNO1) ;
"RTN","IBCOPV",29,0)
 N IBZ,DGFIL,DFN,I,DGNOD
"RTN","IBCOPV",30,0)
 S DGFIL=$P("2^409.5^2.101^",U,+$P(IBOE0,U,8)),DFN=$P(IBOE0,U,2),I=+IBOE0
"RTN","IBCOPV",31,0)
 ;
"RTN","IBCOPV",32,0)
 Q:'DGFIL
"RTN","IBCOPV",33,0)
 I '$$BDSRC^IBEFUNC3($P(IBOE0,U,5)) Q  ; non-billable visit data source
"RTN","IBCOPV",34,0)
 ;
"RTN","IBCOPV",35,0)
 I '$D(^TMP("IBVIS",$J,+$P(IBOE0,U,5))) D  ;Process visit CPT's only once
"RTN","IBCOPV",36,0)
 .N I,I2,I7,IBCPT,IBCPTS,IBZERR
"RTN","IBCOPV",37,0)
 .D GETCPT^SDOE(IBOE,"IBCPTS","IBZERR")
"RTN","IBCOPV",38,0)
 .Q:'$O(IBCPTS(0))  ;No procedures for this encounter
"RTN","IBCOPV",39,0)
 .S I7=IBOE0\1
"RTN","IBCOPV",40,0)
 .S I2=0 F  S I2=$O(IBCPTS(I2)) Q:'I2  D
"RTN","IBCOPV",41,0)
 .. N Z
"RTN","IBCOPV",42,0)
 .. S IBCPT=$P(IBCPTS(I2),U)
"RTN","IBCOPV",43,0)
 .. F Z=1:1:$P(IBCPTS(I2),U,16) D
"RTN","IBCOPV",44,0)
 ... I $L($G(^UTILITY($J,"CPT",I7,DGNO1)))+$L(IBCPT)+1>140 S DGNO1=DGNO1+1
"RTN","IBCOPV",45,0)
 ... S ^UTILITY($J,"CPT",I7,DGNO1)=$G(^UTILITY($J,"CPT",I7,DGNO1))_U_IBCPT
"RTN","IBCOPV",46,0)
 .S ^UTILITY($J,"CPT",0)="Y"
"RTN","IBCOPV",47,0)
 .;
"RTN","IBCOPV",48,0)
 .I $O(^UTILITY($J,"CPT",0)) S DGNO=0 F  S DGNO=$O(^UTILITY($J,"CPT",I7,DGNO)) Q:DGNO=""  S ^UTILITY($J,"CPT1",I7,DGNO)=^UTILITY($J,"CPT",I7,DGNO) D PROD^IBCOPV2
"RTN","IBCOPV",49,0)
 ;
"RTN","IBCOPV",50,0)
 N IBPRVS,IBPRV,IBI S IBPRV="" D GETPRV^SDOE(IBOE,"IBPRVS")
"RTN","IBCOPV",51,0)
 S IBI=0 F  S IBI=$O(IBPRVS(IBI)) Q:'IBI  I $P(IBPRVS(IBI),U,4)="P" S IBPRV=+IBPRVS(IBI) Q
"RTN","IBCOPV",52,0)
 ;
"RTN","IBCOPV",53,0)
 S DGNOD=IBOE0
"RTN","IBCOPV",54,0)
 D SET K DGNOD
"RTN","IBCOPV",55,0)
 Q
"RTN","IBCOPV",56,0)
 ;
"RTN","IBCOPV",57,0)
TYP ;Q:'$D(DGNOD)
"RTN","IBCOPV",58,0)
 ;K DGNO,DGTYP
"RTN","IBCOPV",59,0)
 ;I "479"'[$P(DGNOD,U,10) S DGNO=1 Q
"RTN","IBCOPV",60,0)
 ;I DGFIL=2,$P(DGNOD,U,10)=9 D  Q:$G(DGNO)
"RTN","IBCOPV",61,0)
 ;. I $P(DGNOD,U,10)=9 S DGTYP=$P(DGNOD,U,13)
"RTN","IBCOPV",62,0)
 ;. I $G(DGTYP),"^6^7^9^"[(U_$P($G(^DIC(8,DGTYP,0)),U,9)_U) S DGNO=1
"RTN","IBCOPV",63,0)
 ;I $G(DGTYP) S DGTYP=$E($P($G(^DIC(8,DGTYP,0)),"^"),1,3)
"RTN","IBCOPV",64,0)
 ;S:$G(DGTYP)="" DGTYP=$P(DGNOD,U,10)
"RTN","IBCOPV",65,0)
 ;S:DGTYP&(DGTYP<9) DGTYP=$E($P($G(^SD(409.1,+DGTYP,0)),U),1,3)
"RTN","IBCOPV",66,0)
 ;S DGTYP=$E(DGTYP,1,3)
"RTN","IBCOPV",67,0)
 ;;- If the code gets here, DGTYP will either be the first 3 charaters of the
"RTN","IBCOPV",68,0)
 ;;  appointment type name, the first 3 characters of the eligibility name or a 9
"RTN","IBCOPV",69,0)
 ;
"RTN","IBCOPV",70,0)
 ; appointment type must be:  4 - Employee, 7 - Collateral of Vet, 8 - Sharing Agreement, or 9 - Regular
"RTN","IBCOPV",71,0)
 ; appointment MAS eligibilty must not be:  6 - Other Federal Agency, or 7 - Allied Veteran
"RTN","IBCOPV",72,0)
 ;
"RTN","IBCOPV",73,0)
 ; if 9-regular or 8-sharing agreement then return appointment eligibilty, otherwise return appointment type
"RTN","IBCOPV",74,0)
 ;
"RTN","IBCOPV",75,0)
 Q:'$D(DGNOD)  K DGNO,DGTYP N IBZT,IBZE,IBZ
"RTN","IBCOPV",76,0)
 S DGTYP=""
"RTN","IBCOPV",77,0)
 S IBZT=$P(DGNOD,U,10) I "4789"'[IBZT S DGNO=1 Q
"RTN","IBCOPV",78,0)
 S IBZE=$P(DGNOD,U,13),IBZ=+$P($G(^DIC(8,+IBZE,0)),U,9) I +IBZ,"6^7"[IBZ S DGNO=1 Q
"RTN","IBCOPV",79,0)
 ;
"RTN","IBCOPV",80,0)
 I +IBZT,IBZT<8 S DGTYP=$E($P($G(^SD(409.1,+IBZT,0)),U,1),1,3)
"RTN","IBCOPV",81,0)
 I +IBZE,DGTYP="" S DGTYP=$E($P($G(^DIC(8,+IBZE,0)),U,1),1,3)
"RTN","IBCOPV",82,0)
 Q
"RTN","IBCOPV",83,0)
 ;
"RTN","IBCOPV",84,0)
SET S DGDT=$P(I,"."),DGDT1=$P(I,".",2)
"RTN","IBCOPV",85,0)
 D TYP,ELIG^IBCOPV2 Q:$D(DGNO)!('$D(DGNOD))
"RTN","IBCOPV",86,0)
 S:'$D(DGNO) ^UTILITY($J,"OPV",DGDT,DGDT1,DGFIL)=DGTYP_"^"_DGMT_"^"_$S($D(^UTILITY($J,"CPT",0))&(DGFIL=409.5):^UTILITY($J,"CPT",0),1:"")
"RTN","IBCOPV",87,0)
 S $P(^UTILITY($J,"OPV",DGDT,DGDT1,DGFIL),"^",6)=$S(DGCOD]"":DGCOD,1:"")
"RTN","IBCOPV",88,0)
 S $P(^UTILITY($J,"OPV",DGDT,DGDT1,DGFIL),"^",7)=$G(IBCODCL)
"RTN","IBCOPV",89,0)
 S $P(^UTILITY($J,"OPV",DGDT,DGDT1,DGFIL),"^",8)=$G(IBPRV)
"RTN","IBCOPV",90,0)
 S $P(^UTILITY($J,"OPV",DGDT,DGDT1,DGFIL),"^",9)=$G(IBOE)
"RTN","IBCOPV",91,0)
 Q:'$D(^DGCR(399,"AOPV",DFN,DGDT))
"RTN","IBCOPV",92,0)
BIL S DGBIL=0 N IBZ
"RTN","IBCOPV",93,0)
 F DGBIL1=1:1 S DGBIL=$O(^DGCR(399,"AOPV",DFN,I,DGBIL)) Q:'DGBIL  I $D(^DGCR(399,DGBIL,0)) D
"RTN","IBCOPV",94,0)
 . F B=1,7 S DGBIL(B)=$P(^DGCR(399,DGBIL,0),"^",B) I DGBIL(B)]"" D
"RTN","IBCOPV",95,0)
 .. I B=7 S IBZ=$P(^DGCR(399,DGBIL,0),"^",27),IBZ=$S(+IBZ=1:"-I",+IBZ=2:"-P",1:"")
"RTN","IBCOPV",96,0)
 .. I B=7,$D(^DGCR(399.3,DGBIL(B),0)) S DGBIL(B)=$P(^(0),"^",4) I IBZ'="" S DGBIL(B)=$E(DGBIL(B),1,6)_IBZ
"RTN","IBCOPV",97,0)
 .. S $P(^UTILITY($J,"OPV","AP",DGCNT),"^",$S((DGBIL1+B)=2:4,(DGBIL1+B)=8:5,(DGBIL1+B)<8:(DGBIL1+DGBIL1+2),1:(DGBIL1+DGBIL1+3)))=DGBIL(B)
"RTN","IBCOPV",98,0)
 Q
"RTN","IBCOPV",99,0)
 ;
"RTN","IBCOPV",100,0)
CNT F I=0:0 S I=$O(^UTILITY($J,"OPV",I)) Q:'I  S DGCNT=DGCNT+1,^UTILITY($J,"OPV","AP",DGCNT)=I D CHG^IBCOPV2,BIL
"RTN","IBCOPV",101,0)
 Q
"RTN","IBCOPV",102,0)
 ;
"RTN","IBCOPV",103,0)
CNT399 S DGCNT1=0 F I=0:0 S I=$O(^DGCR(399,IBIFN,"OP",I)) Q:'I  S DGCNT1=DGCNT1+1
"RTN","IBCOPV",104,0)
 Q
"RTN","IBCOPV",105,0)
 ;
"RTN","IBCOPV1")
0^13^B19654467
"RTN","IBCOPV1",1,0)
IBCOPV1 ;ALB/LDB - CPT LISTING IN MCCR ;30 APR 90
"RTN","IBCOPV1",2,0)
 ;;2.0;INTEGRATED BILLING;**106,260**;21-MAR-94
"RTN","IBCOPV1",3,0)
 ;
"RTN","IBCOPV1",4,0)
 ;MAP TO DGCROPV1
"RTN","IBCOPV1",5,0)
 ;
"RTN","IBCOPV1",6,0)
PRT ;
"RTN","IBCOPV1",7,0)
 N IBQUIT,IBNUM,IBDATE,Z1 S IBQUIT=0
"RTN","IBCOPV1",8,0)
 ;D:$D(DIR) HLP
"RTN","IBCOPV1",9,0)
 D HDR1,HDR F I=0:0 S I=$O(^UTILITY($J,"OPV","AP",I)) Q:'I  S IBNUM=I-1 W ! D SCR Q:IBQUIT  S IBNUM=I W ?1,I_")",?5 S (Y,I1)=+^UTILITY($J,"OPV","AP",I) D DT^DIQ S IBDATE=Y K Y D VT Q:IBQUIT
"RTN","IBCOPV1",10,0)
 ;W:DGCNT>30 !!,"THERE ARE MORE THAN TEN VISITS DURING THE PERIOD THAT THIS STATEMENT COVERS."
"RTN","IBCOPV1",11,0)
 F C=$Y:1:(IOSL-6) W !
"RTN","IBCOPV1",12,0)
 D:'IBQUIT PICK
"RTN","IBCOPV1",13,0)
 G Q2
"RTN","IBCOPV1",14,0)
 ;Q:$D(DIR)
"RTN","IBCOPV1",15,0)
PICK K Y S DIR("A")="Select visits to include in this bill (1-"_IBNUM_"): "
"RTN","IBCOPV1",16,0)
OK S DIR(0)="LAO^1:"_IBNUM_"^K:X[""."" X" D ^DIR
"RTN","IBCOPV1",17,0)
 I $D(DTOUT)!$D(DUOUT) S IBQUIT=1 Q
"RTN","IBCOPV1",18,0)
 Q:X=""
"RTN","IBCOPV1",19,0)
 I $P($$OPV1^IBCU41(IBIFN,1,($L(Y,",")-1)),U,2)'="" G OK
"RTN","IBCOPV1",20,0)
 ;I (DGCNT1+($L(Y,",")-1))>30 W !,"Maximum of 30 visits allowed per bill!",!,"The visits already on the bill along with those selected total more than 30." G OK
"RTN","IBCOPV1",21,0)
 ;I $D(^DIC(36,+^DGCR(399,IBIFN,"M"),0)),$P(^(0),"^",8),+$P(Y,",",2)>0!(DGCNT1&(+$E(Y)>0)) W !,*7,"THIS INSURANCE COMPANY WILL ONLY ACCEPT ONE VISIT PER BILL.",! G OK
"RTN","IBCOPV1",22,0)
OK1 I +Y W !,"YOU HAVE SELECTED VISIT(S) NUMBERED- ",$E(Y,1,$L(Y)-1),!,"IS THIS CORRECT" S %=1 D YN^DICN I %=-1 S IBOUT=1 G Q2
"RTN","IBCOPV1",23,0)
 I +Y,'% W !,"Enter 'Y'es to include these visits.",!,"Enter 'N'o to reselect." G OK1
"RTN","IBCOPV1",24,0)
 I +Y,%=2 G OK
"RTN","IBCOPV1",25,0)
 G:'Y Q1
"RTN","IBCOPV1",26,0)
 S IBVT=Y
"RTN","IBCOPV1",27,0)
 F I=1:1 S:$P(IBVT,",",I) DGAP=$P(IBVT,",",I) Q:$P(IBVT,",",I)']""  D VFILE
"RTN","IBCOPV1",28,0)
 D Q2 Q
"RTN","IBCOPV1",29,0)
VFILE S (DINUM,X)=+^UTILITY($J,"OPV","AP",DGAP)
"RTN","IBCOPV1",30,0)
VFILE1 S DA(1)=IBIFN,DIC(0)="L",DIC="^DGCR(399,"_DA(1)_",""OP"","
"RTN","IBCOPV1",31,0)
 S:'$D(^DGCR(399,DA(1),"OP",0)) ^(0)="^399.043DA^"
"RTN","IBCOPV1",32,0)
 I $D(^DGCR(399,DA(1),"OP",DINUM)) G VFILEQ
"RTN","IBCOPV1",33,0)
 I '$$OPV1^IBCU41(IBIFN,1)!('$$OPV2^IBCU41(DINUM,IBIFN,1)) D  S DGNOADD=1 G VFILEQ
"RTN","IBCOPV1",34,0)
 . W !,?10,"Can't add OP Visit Date of ",$$DAT2^IBOUTL(X)
"RTN","IBCOPV1",35,0)
 S Y=$$DUPCHK^IBCU41(DINUM,IBIFN,1)
"RTN","IBCOPV1",36,0)
 ;I $P(^DGCR(399,IBIFN,0),"^",19)'=2,$O(^DGCR(399,DA(1),"OP",0)),$D(^DGCR(399,"ASC2",DA(1))) W !?4,"Only 1 visit date allowed on bills with Amb. Surg. Codes!" S DGNOADD=1 G VFILEQ
"RTN","IBCOPV1",37,0)
 W !?4,"Adding OP Visit Date of ",$$DAT2^IBOUTL(X)
"RTN","IBCOPV1",38,0)
 K DD,DO D FILE^DICN L ^DGCR(399,IBIFN):1
"RTN","IBCOPV1",39,0)
VFILEQ Q
"RTN","IBCOPV1",40,0)
Q2 S IBQUIT=1 K DIR,DIRUT G Q
"RTN","IBCOPV1",41,0)
Q1 S:$D(DUOUT)!$D(DTOUT) IBOUT=1 K DIR,DIRUT
"RTN","IBCOPV1",42,0)
Q K DA,DGBIL,DGCNT,DGCNT2,DGCOD,DGCT1,IBCD,DGCPT,DGCPT1,IBOPV,IBCOPV1,IBOPV2,IBOPV3,IBOPV4,DGCNT1,DGCNT2,DGDT,DGDT,DGDT1,DGFIL,DGMT,DGMT1,DGNO,DGNOD,DGTYP,DGTYPE,DIC,DIE,DINUM,DR,L,V,X,Y,IBCHG1,IBCHG2,IBRVCE,IBVDT
"RTN","IBCOPV1",43,0)
 K DGTE,I9,DGLP,DGCPT0,DGCPT2,DGCPT3,I7,P,IBVT,DGAP,Z,I4,DGASC,DGCPTS,DGBIL1,DGDIV,DGDAT,DGNOADD,IBFT,IBCODCL Q
"RTN","IBCOPV1",44,0)
 ;
"RTN","IBCOPV1",45,0)
HDR1 W @IOF,?25,"<<<OUTPATIENT VISITS>>>",!! S X="",$P(X,"=",80)="" W X Q
"RTN","IBCOPV1",46,0)
HDR W !,"NO.",?6,"VISIT DATE",?19,"ELIG/MT",?28,"PROVIDER",?45,"BILL# - TYPE",?65,"STOP CD/CLINIC"
"RTN","IBCOPV1",47,0)
 W !,"===",?6,"==========",?19,"=======",?28,"========",?45,"============",?65,"==============="
"RTN","IBCOPV1",48,0)
 Q
"RTN","IBCOPV1",49,0)
VT S I2="" F Z1=1:1 S I2=$O(^UTILITY($J,"OPV",I1,I2)) Q:I2=""!IBQUIT  S I3="" F I4=1:1 S I3=$O(^UTILITY($J,"OPV",I1,I2,I3)) Q:I3=""  S IBOPV3=^UTILITY($J,"OPV",I1,I2,I3) D VT1 Q:IBQUIT
"RTN","IBCOPV1",50,0)
 Q
"RTN","IBCOPV1",51,0)
VT1 D SCR Q:IBQUIT  I (Z1>1)!(I4>1) W:$X>1 ! W ?5,$G(IBDATE)
"RTN","IBCOPV1",52,0)
 W ?19,$P(IBOPV3,"^") W:$P(IBOPV3,"^",2)]"" "/"_$P(IBOPV3,"^",2)
"RTN","IBCOPV1",53,0)
 W:+$P(IBOPV3,U,8) ?28,$E($P($G(^VA(200,+$P(IBOPV3,U,8),0)),"^",1),1,15)
"RTN","IBCOPV1",54,0)
 I Z1=1,I4=1,$P(^UTILITY($J,"OPV","AP",I),"^",4)'="" W ?45,$J($P(^UTILITY($J,"OPV","AP",I),"^",4),7),"-",$P(^UTILITY($J,"OPV","AP",I),"^",5)
"RTN","IBCOPV1",55,0)
 W ?65,$E($P(^UTILITY($J,"OPV",I1,I2,I3),"^",6),1,15)
"RTN","IBCOPV1",56,0)
 W !
"RTN","IBCOPV1",57,0)
 I $P($G(^IBT(356,+$O(^IBT(356,"ASCE",+$P(^UTILITY($J,"OPV",I1,I2,I3),"^",9),0)),0)),"^",19) W ?7,$E("**RNB: "_$P($G(^IBE(356.8,+$P(^(0),"^",19),0)),"^"),1,30)
"RTN","IBCOPV1",58,0)
 I Z1=1,I4=1,$P(^UTILITY($J,"OPV","AP",I),"^",6)'="" W ?45,$J($P(^UTILITY($J,"OPV","AP",I),"^",6),7),"-",$P(^UTILITY($J,"OPV","AP",I),"^",7)
"RTN","IBCOPV1",59,0)
 W ?65,$E($P(^UTILITY($J,"OPV",I1,I2,I3),"^",7),1,15)
"RTN","IBCOPV1",60,0)
 I (Z1=1)&(I4=1) F P=8:2 Q:$P(^UTILITY($J,"OPV","AP",I),"^",P)=""  W !,?45,$J($P(^UTILITY($J,"OPV","AP",I),"^",P),7),"-",$P(^UTILITY($J,"OPV","AP",I),"^",P+1)
"RTN","IBCOPV1",61,0)
 Q
"RTN","IBCOPV1",62,0)
SCR Q:IBQUIT  I $E(IOST,1,2)["C-",$Y+6>IOSL F Y=$Y:1:IOSL-5 W !
"RTN","IBCOPV1",63,0)
 I  W !,"Press return to continue, ""^"" to exit display, or " D PICK I 'IBQUIT W @IOF D HDR1,HDR W !
"RTN","IBCOPV1",64,0)
 Q
"RTN","IBCOPV1",65,0)
HLP ;W !!,"Enter a number between 1 and ",DGCNT," or a list or range separated with commas",!,"or dashes, e.g., 1,3,5 or 2-4,8"
"RTN","IBCOPV1",66,0)
 ;W !,"The number(s) must correspond to a visit." R H:5 K H
"RTN","IBCOPV1",67,0)
 Q
"RTN","IBCOPV1",68,0)
CHG W:(Z1=1)&(I4=1) ?31,$J($P(^UTILITY($J,"OPV","AP",I),"^",2),8) Q
"RTN","IBCOPV1",69,0)
NOVT I 'DGCNT D HDR1 W !!,"NO OUTPATIENT VISITS FOUND DURING THE PERIOD COVERED BY THIS STATEMENT" D Q Q
"RTN","IBCSC5B")
0^11^B22166369
"RTN","IBCSC5B",1,0)
IBCSC5B ;ALB/ARH - ADD/ENTER PROSTHETIC ITEMS ;12/28/93
"RTN","IBCSC5B",2,0)
 ;;2.0;INTEGRATED BILLING;**4,52,260**;21-MAR-94
"RTN","IBCSC5B",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSC5B",4,0)
 ;
"RTN","IBCSC5B",5,0)
 ;
"RTN","IBCSC5B",6,0)
EN ;add/edit prosthetic items for a bill, IBIFN required
"RTN","IBCSC5B",7,0)
 S IBX=$$BILL(IBIFN) Q:'IBIFN  S DFN=+IBX,IBDT1=$P(IBX,U,2),IBDT2=$P(IBX,U,3)
"RTN","IBCSC5B",8,0)
 D SET(IBIFN,.IBPDA),PIDISP(DFN,IBDT1,IBDT2,.IBPDE,.IBPDA),DISP(.IBPDA)
"RTN","IBCSC5B",9,0)
E1 S IBPIFN=0,IBDT=$$ASKDT(IBDT1,IBDT2) G:'IBDT EXIT
"RTN","IBCSC5B",10,0)
 S IBPD=$O(IBPDA(IBDT,0)) S:'IBPD IBPD=$O(IBPDE(IBDT,0)) S IBPD=$$ASKPD(IBPD) G:'IBPD E1
"RTN","IBCSC5B",11,0)
 S IBPIFN=$G(IBPDA(IBDT,+IBPD)) I 'IBPIFN S IBPIFN=$$ADD(IBDT,IBIFN,+IBPD,+$G(IBPDE(IBDT,+IBPD))) I 'IBPIFN W " ??" G E1
"RTN","IBCSC5B",12,0)
 I '$D(IBPDE(IBDT,+IBPD)) W !,"This prosthetic item does not exist in this patients prosthetics record.",!
"RTN","IBCSC5B",13,0)
 D EDIT(+IBPIFN) D SET(IBIFN,.IBPDA) W ! G E1
"RTN","IBCSC5B",14,0)
 ;
"RTN","IBCSC5B",15,0)
EXIT K IBPIFN,IBX,IBDT1,IBDT2,IBPDA,IBPDE,IBPD,IBDT
"RTN","IBCSC5B",16,0)
 Q
"RTN","IBCSC5B",17,0)
 ;
"RTN","IBCSC5B",18,0)
ASKDT(IBDT1,IBDT2,IBDT) ;
"RTN","IBCSC5B",19,0)
 I +$G(IBIFN) S DIR("?")="Enter the date the item was delivered to the patient",DIR("??")="^D HELP^IBCSC5B("_IBIFN_")"
"RTN","IBCSC5B",20,0)
 S DIR("A")="Select ITEM DELIVERY DATE",DIR(0)="DO^"_IBDT1_":"_IBDT2_":EX" D ^DIR K DIR,DTOUT,DIRUT
"RTN","IBCSC5B",21,0)
 Q $S(Y?7N:Y,1:0)
"RTN","IBCSC5B",22,0)
 ;
"RTN","IBCSC5B",23,0)
ASKPD(PD) ;
"RTN","IBCSC5B",24,0)
 N X,Y
"RTN","IBCSC5B",25,0)
 S DIR("A")="Select PROSTHETIC ITEM",DIR(0)="660,4O" S:+$G(PD) DIR("B")=+$G(^RMPR(661,+$G(PD),0)) D ^DIR S:$D(DIRUT)!(Y'>0) Y="" K DIR,DIRUT
"RTN","IBCSC5B",26,0)
 Q Y
"RTN","IBCSC5B",27,0)
 ;
"RTN","IBCSC5B",28,0)
ADD(IBDT,IFN,IBPD,PIFN) ;
"RTN","IBCSC5B",29,0)
 N IBX,IBY,IBDX,IBHCPCS S IBX=0,DIC="^IBA(362.5,",DIC(0)="AQL",X=IBDT K DA,DO D FILE^DICN K DA,DO,X
"RTN","IBCSC5B",30,0)
 I Y>0 S DIE=DIC,(IBX,DA)=+Y,DR=".02////"_IFN_";.03////"_IBPD_";.04////"_PIFN D ^DIE K DIE,DIC,DA,DR W "... ADDED"
"RTN","IBCSC5B",31,0)
 ;add dx if known
"RTN","IBCSC5B",32,0)
 F IBY=1:1:4 S IBDX=+$G(^RMPR(660,PIFN,"BA"_IBY)) I IBDX,'$O(^IBA(362.3,"AIFN"_IFN,IBDX)) D
"RTN","IBCSC5B",33,0)
 . S DIC="^IBA(362.3,",DIC(0)="L",DLAYGO=362.3,X=IBDX,DIC("DR")=".02////"_IFN K DD,DO D FILE^DICN S IBDX(+Y)=""
"RTN","IBCSC5B",34,0)
 ;add hcpcs if known
"RTN","IBCSC5B",35,0)
 ;S IBHCPCS=$P($G(^RMPR(660,PIEN,0)),"^",22) I IBHCPCS
"RTN","IBCSC5B",36,0)
 ;
"RTN","IBCSC5B",37,0)
 Q IBX
"RTN","IBCSC5B",38,0)
 ;
"RTN","IBCSC5B",39,0)
EDIT(PIFN) ;
"RTN","IBCSC5B",40,0)
 S DIDEL=362.5,DIE="^IBA(362.5,",DR=".01;.03",DA=PIFN D ^DIE K DIE,DR,DA,DIC,DIDEL
"RTN","IBCSC5B",41,0)
 Q
"RTN","IBCSC5B",42,0)
 ;
"RTN","IBCSC5B",43,0)
SET(IFN,PDARR) ;setup array of all prosthetic devices for bill, array name should be passed by reference
"RTN","IBCSC5B",44,0)
 ;returns: PDARR(PD DELIV DATE, PD ITEM (661 ptr))=PD IFN (362.5 ptr),  PDARR=BILL IFN ^ PD count
"RTN","IBCSC5B",45,0)
 N CNT,IBX,IBY,PIFN,IBC,IBRC K PDARR S IBC="AIFN"_$G(IFN)
"RTN","IBCSC5B",46,0)
 D RCITEM^IBCSC5A(IBIFN,"IBRC",5)
"RTN","IBCSC5B",47,0)
 S (CNT,IBX)=0 F  S IBX=$O(^IBA(362.5,IBC,IBX)) Q:'IBX  S PIFN=0 F  S PIFN=$O(^IBA(362.5,IBC,IBX,PIFN)) Q:'PIFN  D
"RTN","IBCSC5B",48,0)
 . S IBY=$G(^IBA(362.5,PIFN,0)) Q:IBY=""  S CNT=CNT+1,PDARR(+IBY,$P(IBY,U,3))=PIFN_U_$$CHG^IBCF4(PIFN,5,.IBRC)
"RTN","IBCSC5B",49,0)
 S PDARR=$G(IFN)_"^"_CNT
"RTN","IBCSC5B",50,0)
 Q
"RTN","IBCSC5B",51,0)
 ;
"RTN","IBCSC5B",52,0)
DISP(PDARR) ;screen display of existing prosthetic devices for a bill,
"RTN","IBCSC5B",53,0)
 ;input should be array returned by SET^IBCSC5B: PDARR(PD DT, PD ITEM)=PD IFN (362.5), pass by reference
"RTN","IBCSC5B",54,0)
 N IBX,IBY,IBZ
"RTN","IBCSC5B",55,0)
 W !!,?5,"-----------------  Existing Prosthetic Items for Bill  -----------------",!
"RTN","IBCSC5B",56,0)
 S IBX=0 F  S IBX=$O(PDARR(IBX)) Q:IBX=""  S IBY=0 F  S IBY=$O(PDARR(IBX,IBY)) Q:'IBY  D
"RTN","IBCSC5B",57,0)
 . S IBZ=$$PIN(IBY) W !,$$DATE(IBX),?12,$P(IBZ,U,1),?20,$P(IBZ,U,2)
"RTN","IBCSC5B",58,0)
 W !
"RTN","IBCSC5B",59,0)
 Q
"RTN","IBCSC5B",60,0)
 ;
"RTN","IBCSC5B",61,0)
HELP(IFN) ;called for help from prosthetics enter to display existing devices, displays devices from 660 and 399
"RTN","IBCSC5B",62,0)
 I +$G(IFN) N IBX,IBPDA S IBX=$$BILL(IFN) I +IBX D SET(IFN,.IBPDA),PIDISP($P(IBX,U,1),$P(IBX,U,2),$P(IBX,U,3),"",.IBPDA),DISP(.IBPDA)
"RTN","IBCSC5B",63,0)
 Q
"RTN","IBCSC5B",64,0)
 ;
"RTN","IBCSC5B",65,0)
PIDISP(DFN,DT1,DT2,ARRAY,PDARR) ; display all prosthetic items (660) for a patient and date range
"RTN","IBCSC5B",66,0)
 ;PDARR (as defined by SET^IBCSC5B) passed by ref. only to check if pros. item is on the bill, not necessary, not changed
"RTN","IBCSC5B",67,0)
 ;returns ARRAY(PD DEL DATE (660,10), PD ITEM (660,4=661 ptr))=RECORD (660 ptr), should pass by ref. if desired
"RTN","IBCSC5B",68,0)
 N PIFN,IBX,IBY,PNAME,DDT,PI,IBICD,IBEX,IBP
"RTN","IBCSC5B",69,0)
 K ARRAY S DT1=$G(DT1)-.0001,DT2=$G(DT2) S:'DT2 DT2=9999999 Q:'$G(DFN)
"RTN","IBCSC5B",70,0)
 S PIFN=0 F  S PIFN=$O(^RMPR(660,"C",DFN,PIFN)) Q:'PIFN  D
"RTN","IBCSC5B",71,0)
 . S IBX=$G(^RMPR(660,PIFN,0)),DDT=+$P(IBX,U,12)\1 I (DDT<DT1)!(DDT>DT2) Q
"RTN","IBCSC5B",72,0)
 . S ARRAY(DDT,+$P(IBX,U,6))=PIFN
"RTN","IBCSC5B",73,0)
 ;
"RTN","IBCSC5B",74,0)
 W @IOF,?33,"PROSTHETICS SCREEN",!,"================================================================================",!
"RTN","IBCSC5B",75,0)
 S DDT=0 F  S DDT=$O(ARRAY(DDT)) Q:'DDT  S PI=0 F  S PI=$O(ARRAY(DDT,PI)) Q:'PI  D
"RTN","IBCSC5B",76,0)
 . S PIFN=ARRAY(DDT,PI),PNAME=$$PIN(PI),IBY=$G(^RMPR(660,PIFN,"AM")),IBX=$G(^RMPR(660,PIFN,0))
"RTN","IBCSC5B",77,0)
 . ; look for exemption info
"RTN","IBCSC5B",78,0)
 . F IBICD=1:1:4 Q:$D(IBEX)  I $D(^RMPR(660,PIFN,"BA"_IBICD)) F IBP=2:1:8 I $P(^RMPR(660,PIFN,"BA"_IBICD),"^",IBP) S IBEX="("_$P($T(EXEMPT+(IBP-1)),";",3)_")" Q
"RTN","IBCSC5B",79,0)
 . W !,$S($D(PDARR(+DDT,PI)):"*",1:"")
"RTN","IBCSC5B",80,0)
 . W ?2,$$DATE(DDT),?12,$P(PNAME,U,1),$G(IBEX),?20,$E($P(PNAME,U,2),1,30),?55,$E($$EXSET^IBEFUNC($P(IBX,U,14),660,12),1,4),?62,$$EXSET^IBEFUNC($P(IBY,U,3),660,62),?70,$J(+$P(IBX,U,16),9,2)
"RTN","IBCSC5B",81,0)
 Q
"RTN","IBCSC5B",82,0)
 ;
"RTN","IBCSC5B",83,0)
PIN(PITEM) ;given the pros item IFN (661 ptr) returns name for printing (661,.01^441,.05)
"RTN","IBCSC5B",84,0)
 N IBX,IBY S IBY="" I +$G(PITEM) S IBX=+$G(^RMPR(661,+PITEM,0)) I +IBX S IBY=IBX_U_$$DESCR^PRCPUX1(0,+IBX)
"RTN","IBCSC5B",85,0)
 Q IBY
"RTN","IBCSC5B",86,0)
 ;
"RTN","IBCSC5B",87,0)
BILL(IBIFN) ; display all existing prescription refills (52) for a patient and date range
"RTN","IBCSC5B",88,0)
 ; (call is a short cut to calling rxdisp if have bill number)
"RTN","IBCSC5B",89,0)
 N IBX,IBY S IBX=$G(^DGCR(399,+$G(IBIFN),0)),IBY=$P(IBX,U,2)
"RTN","IBCSC5B",90,0)
 S IBX=$G(^DGCR(399,+IBIFN,"U")),$P(IBY,U,2)=+IBX,$P(IBY,U,3)=+$P(IBX,U,2)
"RTN","IBCSC5B",91,0)
 Q IBY
"RTN","IBCSC5B",92,0)
 ;
"RTN","IBCSC5B",93,0)
DATE(X) ;
"RTN","IBCSC5B",94,0)
 Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCSC5B",95,0)
 ;
"RTN","IBCSC5B",96,0)
EXEMPT ; exemption reasons
"RTN","IBCSC5B",97,0)
 ;;AO
"RTN","IBCSC5B",98,0)
 ;;IR
"RTN","IBCSC5B",99,0)
 ;;SC
"RTN","IBCSC5B",100,0)
 ;;EC
"RTN","IBCSC5B",101,0)
 ;;MST
"RTN","IBCSC5B",102,0)
 ;;HNC
"RTN","IBCSC5B",103,0)
 ;;CV
"RTN","IBCSC5B",104,0)
 ;
"RTN","IBCSC5C")
0^10^B35114956
"RTN","IBCSC5C",1,0)
IBCSC5C ;ALB/ARH - ADD/EDIT PRESCRIPTION FILLS (CONTINUED) ;3/4/94
"RTN","IBCSC5C",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,130,51,160,260**;21-MAR-94
"RTN","IBCSC5C",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCSC5C",4,0)
 ;
"RTN","IBCSC5C",5,0)
 ;
"RTN","IBCSC5C",6,0)
DEFAULT(IFN,IBRX) ; add default DX and CPT to a prescription bill
"RTN","IBCSC5C",7,0)
 ; if one is not in PSO.  If there is, use it instead.
"RTN","IBCSC5C",8,0)
 ; IFN = ien of bill entry
"RTN","IBCSC5C",9,0)
 N IBX,IBPAR1,IBDX,IBCPT,IBDT,IBBIL,IBDXIFN,IBCPTIFN,IBY,IB52,IBC
"RTN","IBCSC5C",10,0)
 S IBDXIFN=0
"RTN","IBCSC5C",11,0)
 S IBPAR1=$G(^IBE(350.9,1,1)),IBDX=$P(IBPAR1,U,29),IBCPT=$P(IBPAR1,U,30)
"RTN","IBCSC5C",12,0)
 S IBBIL=$G(^DGCR(399,+$G(IFN),0)) Q:IBBIL=""
"RTN","IBCSC5C",13,0)
 S IBX=$S($G(IBRX):$P($G(^DGCR(399,IFN,"RC",+IBRX,0)),U,11),1:$O(^IBA(362.4,"C",IFN,0))) Q:'IBX
"RTN","IBCSC5C",14,0)
 S IB52=+$P($G(^IBA(362.4,IBX,0)),"^",5),IBY=0 F  S IBY=$O(^PSRX(IB52,"ICD",IBY)) Q:'IBY  S IBDX(IBY)=$G(^PSRX(IB52,"ICD",IBY,0))
"RTN","IBCSC5C",15,0)
 I 'IBDX,'IBCPT,$D(IBDX)<10 Q
"RTN","IBCSC5C",16,0)
 S IBDT=$P($G(^IBA(362.4,+IBX,0)),U,3) Q:'IBDT
"RTN","IBCSC5C",17,0)
 ; add dx associated with rx if they are there.
"RTN","IBCSC5C",18,0)
 I $D(IBDX)>9 S (IBC,IBDX,IBY)=0 F  S IBY=$O(IBDX(IBY)) Q:'IBY  D
"RTN","IBCSC5C",19,0)
 . I $D(^IBA(362.3,"AIFN"_IFN,+IBDX(IBY))) Q
"RTN","IBCSC5C",20,0)
 . S IBC=IBC+1
"RTN","IBCSC5C",21,0)
 . S DIC="^IBA(362.3,",DIC(0)="L",DIC("DR")=".02////"_IFN_";.03////"_IBC,X=+IBDX(IBY),DLAYGO=362.3
"RTN","IBCSC5C",22,0)
 . K DD,DO D FILE^DICN K DIC,DA,DR,DD,DO,DLAYGO
"RTN","IBCSC5C",23,0)
 . S IBDXIFN(IBC)=+Y
"RTN","IBCSC5C",24,0)
 ; add default dx if none found on actual rx.
"RTN","IBCSC5C",25,0)
 I +IBDX,'$D(^IBA(362.3,"AIFN"_IFN,+IBDX)) S DIC="^IBA(362.3,",DIC(0)="L",DIC("DR")=".02////"_IFN,X=IBDX,DLAYGO=362.3 K DD,DO D FILE^DICN K DIC,DA,DR,DD,DO,DLAYGO S IBDXIFN=+Y
"RTN","IBCSC5C",26,0)
 I +IBCPT D  ;Check if the procedure is already present for the Rx
"RTN","IBCSC5C",27,0)
 . N Z,Z0,DUP
"RTN","IBCSC5C",28,0)
 . S (DUP,Z)=0 F  S Z=$O(^DGCR(399,IFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) D  Q:DUP
"RTN","IBCSC5C",29,0)
 .. I $P(Z0,U,10)=3,$P(Z0,U,15),$P(Z0,U,11)=IBX S DUP=1
"RTN","IBCSC5C",30,0)
 . Q:DUP
"RTN","IBCSC5C",31,0)
 . I $P($G(^DGCR(399,IFN,0)),U,9)="" S DIE="^DGCR(399,",DA=IFN,DR=".09////5" D ^DIE K DIE,DIC,DA,DR
"RTN","IBCSC5C",32,0)
 . I '$D(^DGCR(399,IFN,"CP",0)) S DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCSC5C",33,0)
 . S DLAYGO=399,DIC("DR")="1////"_IBDT D
"RTN","IBCSC5C",34,0)
 . . I +IBDXIFN>0 S DIC("DR")=DIC("DR")_";10////"_IBDXIFN Q
"RTN","IBCSC5C",35,0)
 . . I $D(IBDXIFN)>9 F IBY=1:1:4 I $D(IBDXIFN(IBY)) S DIC("DR")=DIC("DR")_";"_(IBY+9)_"////"_IBDXIFN(IBY)
"RTN","IBCSC5C",36,0)
 . S DIC="^DGCR(399,"_IFN_",""CP"",",DIC(0)="L",DA(1)=IFN,X=IBCPT_";ICPT(" K DD,DO D FILE^DICN K DIC,DA,DD,DO,DR,DLAYGO
"RTN","IBCSC5C",37,0)
 . I +Y D
"RTN","IBCSC5C",38,0)
 .. N Z,IBZ
"RTN","IBCSC5C",39,0)
 .. S IBZ=+Y,Z=$S($G(IBREV):IBREV,1:$$FINDREV^IBCSC5A(IFN,3,+IBX))
"RTN","IBCSC5C",40,0)
 .. I Z S DR=".15////"_IBZ_";.06////"_IBCPT,DA=+Z,DA(1)=IFN,DIE="^DGCR(399,"_DA(1)_",""RC""," D ^DIE
"RTN","IBCSC5C",41,0)
 Q
"RTN","IBCSC5C",42,0)
 ;
"RTN","IBCSC5C",43,0)
RXDISP(DFN,DT1,DT2,ARRAY,POARR,RXARR,IBRXALL,NODISP) ; display all rx fills for a patient and date range
"RTN","IBCSC5C",44,0)
 ;RXARR (as defined by SET^IBCSC5A) passed by ref. only to check if rx-fill is on the bill, not necessary not changed
"RTN","IBCSC5C",45,0)
 ;returns: ARRAY(RX #, FILL DT) = RX IFN (52) ^ FILL IFN ^ DRUG ^ DAYS SUPPLY ^ QTY ^ NDC, pass by reference if desired
"RTN","IBCSC5C",46,0)
 ;         POARR(CNT)=RX # ^ FILL DT
"RTN","IBCSC5C",47,0)
 N PIFN,RIFN,IBX,IBY,DTE,DTR,RX,IBCNT,IBRX0,IBRX2,IBS K ARRAY,POARR S POARR=0,NODISP=+$G(NODISP)
"RTN","IBCSC5C",48,0)
 S IBCNT=0,DT1=$G(DT1)-.0001,DT2=$G(DT2) S:'DT2 DT2=9999999 Q:'$G(DFN)
"RTN","IBCSC5C",49,0)
 ;^PS(55,DFN,"P","A",EXPIRATION DATE, RX) is the best xref available for finding patient fills in a date range
"RTN","IBCSC5C",50,0)
 ;if RX expires/cancelled before start of bill then should not be applicable to bill
"RTN","IBCSC5C",51,0)
 S DTE=DT1 F  S DTE=$O(^PS(55,DFN,"P","A",DTE)) Q:'DTE  D
"RTN","IBCSC5C",52,0)
 . S PIFN=0 F  S PIFN=$O(^PS(55,DFN,"P","A",DTE,PIFN)) Q:'PIFN  D
"RTN","IBCSC5C",53,0)
 .. S IBRX0=$G(^PSRX(PIFN,0)),IBRX2=$G(^PSRX(PIFN,2))
"RTN","IBCSC5C",54,0)
 .. ; original fill
"RTN","IBCSC5C",55,0)
 .. I +$G(IBRXALL) S DTR=$P(IBRX2,U,2) I DTR'<DT1,DTR'>DT2 D
"RTN","IBCSC5C",56,0)
 ... S ARRAY($P(IBRX0,U,1),+DTR)=PIFN_U_0_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBRX0,U,7)_U_$P($G(^PSDRUG(+$P(IBRX0,U,6),2)),U,4)
"RTN","IBCSC5C",57,0)
 .. ; refills
"RTN","IBCSC5C",58,0)
 .. S DTR=DT1 F  S DTR=$O(^PSRX(PIFN,1,"B",DTR)) Q:'DTR!(DTR>DT2)  D
"RTN","IBCSC5C",59,0)
 ... S RIFN=0 F  S RIFN=$O(^PSRX(PIFN,1,"B",DTR,RIFN)) Q:'RIFN  D
"RTN","IBCSC5C",60,0)
 .... S IBY=$G(^PSRX(PIFN,1,RIFN,0)) Q:IBY=""
"RTN","IBCSC5C",61,0)
 .... S ARRAY($P(IBRX0,U,1),+IBY)=PIFN_U_RIFN_U_$P(IBRX0,U,6)_U_$P(IBRX0,U,8)_U_$P(IBY,U,4)_U_$P($G(^PSDRUG(+$P(IBRX0,U,6),2)),U,4)
"RTN","IBCSC5C",62,0)
 ;
"RTN","IBCSC5C",63,0)
 S IBX="",IBS=0 F  S IBX=$O(ARRAY(IBX)) Q:IBX=""  S IBY=0 F  S IBY=$O(ARRAY(IBX,IBY)) Q:'IBY  D
"RTN","IBCSC5C",64,0)
 . S IBCNT=IBCNT+1,POARR(IBCNT)=$P(IBX,U,1)_"^"_+IBY,POARR=IBCNT I $D(RXARR(IBX,IBY)) S IBS=IBS+1
"RTN","IBCSC5C",65,0)
 S $P(POARR,U,2)=IBCNT-IBS
"RTN","IBCSC5C",66,0)
 ;
"RTN","IBCSC5C",67,0)
 Q:+NODISP
"RTN","IBCSC5C",68,0)
 W @IOF,?33,"PRESCRIPTIONS IN DATE RANGE",!,"===============================================================================",!
"RTN","IBCSC5C",69,0)
 S IBCNT=0 F  S IBCNT=$O(POARR(IBCNT)) Q:IBCNT=""  S RX=$P(POARR(IBCNT),U,1),DTR=$P(POARR(IBCNT),U,2) I RX'="",DTR'="" D
"RTN","IBCSC5C",70,0)
 . S IBS=$$RXSTAT^IBCU1($P(ARRAY(RX,DTR),U,3),$P(ARRAY(RX,DTR),U,1),DTR)
"RTN","IBCSC5C",71,0)
 . S IBY="" I $D(RXARR(RX,+DTR)) S IBY="*"
"RTN","IBCSC5C",72,0)
 . W !,$J(IBCNT,2),")",?5,IBY,?6,RX,?19,$E($P($G(^PSDRUG(+$P(ARRAY(RX,DTR),U,3),0)),U,1),1,25),?46,$$DATE(+DTR),?56,$P(IBS,U,1),?61,$P(IBS,U,2),?69,$P(IBS,U,3),?75,$$EXEMPT(+ARRAY(RX,DTR))
"RTN","IBCSC5C",73,0)
 . S IBY=$$RXDUP^IBCU3(RX,DTR,IBIFN) I +IBY W ?73,$P($G(^DGCR(399,+IBY,0)),U,1)
"RTN","IBCSC5C",74,0)
 Q
"RTN","IBCSC5C",75,0)
DATE(X) Q $E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"RTN","IBCSC5C",76,0)
 ;
"RTN","IBCSC5C",77,0)
NEWRX(IBX) ;
"RTN","IBCSC5C",78,0)
 Q:'$G(IBX)  N X,Y K IBLIST W !
"RTN","IBCSC5C",79,0)
NEWRX1 S DIR("?")="Enter the number preceding the RX Fills you want added to the bill.     "_$$HTEXT
"RTN","IBCSC5C",80,0)
 S DIR("A")="SELECT NEW RX FILLS TO ADD THE BILL"
"RTN","IBCSC5C",81,0)
 S DIR(0)="LO^1:"_+IBX D ^DIR K DIR G:'Y!$D(DIRUT) NEWRXE
"RTN","IBCSC5C",82,0)
 S IBLIST=Y
"RTN","IBCSC5C",83,0)
 ;
"RTN","IBCSC5C",84,0)
 S DIR("A")="YOU HAVE SELECTED "_IBLIST_" TO BE ADDED TO THE BILL IS THIS CORRECT",DIR("B")="YES"
"RTN","IBCSC5C",85,0)
 S DIR(0)="YO" D ^DIR K DIR I $D(DIRUT) K IBLIST G NEWRXE
"RTN","IBCSC5C",86,0)
 I 'Y K IBLIST G NEWRX1
"RTN","IBCSC5C",87,0)
NEWRXE Q
"RTN","IBCSC5C",88,0)
 ;
"RTN","IBCSC5C",89,0)
ADDNEW(IBIFN,LIST,IBPR,IBPRO) ;
"RTN","IBCSC5C",90,0)
 Q:'LIST  N IBI,IBX,IBRX,IBDT,IBQ,IBY,IBPIFN,IBZ
"RTN","IBCSC5C",91,0)
 F IBI=1:1 S IBX=$P(LIST,",",IBI) Q:'IBX  I $D(IBPRO(IBX)) D
"RTN","IBCSC5C",92,0)
 . S IBRX=$P(IBPRO(IBX),U,1),IBDT=$P(IBPRO(IBX),U,2) Q:IBRX=""
"RTN","IBCSC5C",93,0)
 . S IBQ=0,IBY=$G(IBPR(IBRX,+IBDT)) Q:'IBY
"RTN","IBCSC5C",94,0)
 . S IBPIFN=0 F  S IBPIFN=$O(^IBA(362.4,"AIFN"_IBIFN,IBRX,IBPIFN)) Q:'IBPIFN  I $P($G(^IBA(362.4,IBPIFN,0)),U,3)=IBDT S IBQ=1 Q
"RTN","IBCSC5C",95,0)
 . I 'IBQ S IBZ=$G(IBPR(IBRX,IBDT)) I $$ADD^IBCSC5A(IBRX,IBIFN,IBDT,$P(IBZ,U,3),$P(IBZ,U,1),$P(IBZ,U,4,6)) W "."
"RTN","IBCSC5C",96,0)
 Q
"RTN","IBCSC5C",97,0)
 ;
"RTN","IBCSC5C",98,0)
HTEXT() ;
"RTN","IBCSC5C",99,0)
 N X S X="If an Rx fill has been assigned to another bill it will be displayed in the last column.  [ORG=Original Fill, NR=Not Released, RTS=Returned to Stock, OTC=Over-the-Counter, INV=Investigational, SUP=Supply Item]"
"RTN","IBCSC5C",100,0)
 Q X
"RTN","IBCSC5C",101,0)
 ;
"RTN","IBCSC5C",102,0)
RXLINK(IBIFN,CPIEN) ; Function returns the ien of the Rx rev code the proc
"RTN","IBCSC5C",103,0)
 ; code is linked to or 0 if no link found.
"RTN","IBCSC5C",104,0)
 Q +$O(^DGCR(399,IBIFN,"RC","ACP",+CPIEN,0))
"RTN","IBCSC5C",105,0)
 ;
"RTN","IBCSC5C",106,0)
EXEMPT(RX) ; Used to look up exemption if any on rx, the return value
"RTN","IBCSC5C",107,0)
 ; will be only the first exemption reason found.
"RTN","IBCSC5C",108,0)
 N IBX,IBZ,IBS,IBR
"RTN","IBCSC5C",109,0)
 S IBR="",(IBS,IBX)=0 F  S IBX=$O(^PSRX(RX,"ICD",IBX)) Q:'IBX!(IBS)  S IBZ=$G(^PSRX(RX,"ICD",IBX,0)) F IBP=2:1:8 Q:IBS  I $P(IBZ,"^",IBP) S IBR=$P($T(EREASON+(IBP-1)),";",3),IBS=1
"RTN","IBCSC5C",110,0)
 Q IBR
"RTN","IBCSC5C",111,0)
EREASON ;
"RTN","IBCSC5C",112,0)
 ;;AO
"RTN","IBCSC5C",113,0)
 ;;IR
"RTN","IBCSC5C",114,0)
 ;;SC
"RTN","IBCSC5C",115,0)
 ;;EC
"RTN","IBCSC5C",116,0)
 ;;MST
"RTN","IBCSC5C",117,0)
 ;;HNC
"RTN","IBCSC5C",118,0)
 ;;CV
"RTN","IBCSC5C",119,0)
 ;
"RTN","IBCU7")
0^7^B54906275
"RTN","IBCU7",1,0)
IBCU7 ;ALB/AAS - INTERCEPT SCREEN INPUT OF PROCEDURE CODES ;29-OCT-91
"RTN","IBCU7",2,0)
 ;;2.0;INTEGRATED BILLING;**62,52,106,125,51,137,210,245,228,260**;21-MAR-94
"RTN","IBCU7",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU7",4,0)
 ;
"RTN","IBCU7",5,0)
 ;MAP TO DGCRU7
"RTN","IBCU7",6,0)
 ;
"RTN","IBCU7",7,0)
CHKX ;  -interception of input x from Additional Procedure input
"RTN","IBCU7",8,0)
 G:X=" " CHKXQ
"RTN","IBCU7",9,0)
 I $$INPAT^IBCEF(DA(1)),'$P($G(^IBE(350.9,1,1)),"^",15),X'?1A1N D  G CHKXQ
"RTN","IBCU7",10,0)
 . K X
"RTN","IBCU7",11,0)
 . D EN^DDIOL("Site param does not allow entry of non-PTF procedures") ;Fileman error here will be: The previous error occurred when performing an action specified in a Pre-lookup transform (7.5 node).
"RTN","IBCU7",12,0)
 G:'$D(^UTILITY($J,"IB")) CHKXQ
"RTN","IBCU7",13,0)
 S M=($A($E(X,1))-64),S=+$E(X,2) Q:'$G(^UTILITY($J,"IB",M,S))  S X="`"_+^(S)
"RTN","IBCU7",14,0)
 I $D(DGPROCDT),DGPROCDT'=$P($G(^UTILITY($J,"IB",M,1)),"^",2) S DGPROCDT=$P(^(1),"^",2) W !!,"Procedure Date: " S Y=DGPROCDT X ^DD("DD") W Y,!
"RTN","IBCU7",15,0)
CHKXQ Q
"RTN","IBCU7",16,0)
 ;
"RTN","IBCU7",17,0)
CODMUL ;Date oriented entry of procedure 
"RTN","IBCU7",18,0)
DELASK I $D(IBZ20),IBZ20,IBZ20'=$P(^DGCR(399,IBIFN,0),U,9) S %=2 W !,"SINCE THE PROCEDURE CODING METHOD HAS BEEN CHANGED, DO YOU WANT TO DELETE ALL",!,"PROCEDURE CODES IN THIS BILL"
"RTN","IBCU7",19,0)
 I  D YN^DICN Q:%=-1  D:%=1 DELADD I %Y?1."?" W !!,"If you answer 'Yes', all procedure codes will be DELETED from this bill.",! G DELASK
"RTN","IBCU7",20,0)
 K %,%Y,DA,IBZ20,DIK ;W !,"Procedure Entry:"
"RTN","IBCU7",21,0)
 ;
"RTN","IBCU7",22,0)
CODDT I $D(IBIFN),$D(^DGCR(399,IBIFN,0)),$P(^(0),U,9) S DIC("V")=$S($P(^(0),U,9)=9:"I +Y(0)=80.1",$P(^(0),U,9)=4!($P(^(0),U,9)=5):"I +Y(0)=81",1:"")
"RTN","IBCU7",23,0)
 I $P($G(^DGCR(399,IBIFN,0)),"^",5)<3 S IBZTYPE=1 I $P($G(^UTILITY($J,"IB",1,1)),"^",2) S DGPROCDT=$P(^(1),"^",2) D ASKCOD
"RTN","IBCU7",24,0)
 S X=$$PRCDIV^IBCU71(IBIFN) I +X W !!,$P(X,U,2),!
"RTN","IBCU7",25,0)
 N Z,Z0 S Z=$G(^DGCR(399,IBIFN,"U")),Z0=$$FMTE^XLFDT($P(Z,U),"2D")_"-"_$$FMTE^XLFDT($P(Z,U,2),"2D")
"RTN","IBCU7",26,0)
 W !,"Select PROCEDURE DATE"_$S($TR(Z0,"-")'="":" ("_Z0_")",1:"")_": " R X:DTIME G:'$T!("^"[X) CODQ D:X["?" CODHLP
"RTN","IBCU7",27,0)
 S IBEX=0 D  ; Get procedure date
"RTN","IBCU7",28,0)
 . I X=" ",$D(DGPROCDT),DGPROCDT?7N S Y=DGPROCDT D D^DIQ W "   (",Y,")" Q
"RTN","IBCU7",29,0)
 . I X=" ",+$P($G(^DGCR(399,IBIFN,"OP",0)),"^",4) S (DGPROCDT,Y)=$O(^DGCR(399,IBIFN,"OP",0)) D D^DIQ W "   (",Y,")" Q
"RTN","IBCU7",30,0)
 . S %DT="EXP",%DT(0)=-DT D ^%DT K %DT I Y<1 S IBEX=1 Q
"RTN","IBCU7",31,0)
 . I '$$OPV2^IBCU41(Y,IBIFN,1) S IBEX=1 Q
"RTN","IBCU7",32,0)
 . S:'$G(IBZTYPE) X=$$OPV^IBCU41(Y,IBIFN) S DGPROCDT=Y
"RTN","IBCU7",33,0)
 I 'IBEX D ASKCOD,ADDCPT^IBCU71:$D(DGCPT)
"RTN","IBCU7",34,0)
 K IBEX
"RTN","IBCU7",35,0)
 G CODDT
"RTN","IBCU7",36,0)
 ;
"RTN","IBCU7",37,0)
ASKCOD N Z,Z0,DA,IBACT,IBQUIT
"RTN","IBCU7",38,0)
 K DGCPT
"RTN","IBCU7",39,0)
 S DGCPT=0,DGCPTUP=$P($G(^IBE(350.9,1,1)),"^",19),DGADDVST=0,IBFT=$P($G(^DGCR(399,IBIFN,0)),"^",19)
"RTN","IBCU7",40,0)
 I '$D(^DGCR(399,IBIFN,"CP",0)) S ^DGCR(399,IBIFN,"CP",0)=U_$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCU7",41,0)
 ;
"RTN","IBCU7",42,0)
 F  S IBQUIT=0 D  Q:IBQUIT
"RTN","IBCU7",43,0)
 . S DIC("A")="   Select PROCEDURE: "
"RTN","IBCU7",44,0)
 . S DIC="^DGCR(399,"_IBIFN_",""CP"","
"RTN","IBCU7",45,0)
 . S DIC(0)="AEQMNL"
"RTN","IBCU7",46,0)
 . S DIC("S")="I '$D(DIV(""S""))&($P(^(0),U,2)=DGPROCDT)"
"RTN","IBCU7",47,0)
 . S DIC("DR")="1///^S X=DGPROCDT"
"RTN","IBCU7",48,0)
 . S DA(1)=IBIFN,DLAYGO=399
"RTN","IBCU7",49,0)
 . W ! D ^DIC I Y<1 S IBQUIT=1 Q
"RTN","IBCU7",50,0)
 . ; If we just added inactive code - it must be deleted.
"RTN","IBCU7",51,0)
 . S IBACT=0 ; Active flag
"RTN","IBCU7",52,0)
 . I Y["ICD0" S IBACT=$$ICD0ACT^IBACSV(+$P(Y,U,2),DGPROCDT)
"RTN","IBCU7",53,0)
 . I Y["ICPT" S IBACT=$$CPTACT^IBACSV(+$P(Y,U,2),DGPROCDT)
"RTN","IBCU7",54,0)
 . S DGCPTNEW=$P(Y,"^",3) ;Was the procedure just added?
"RTN","IBCU7",55,0)
 . I DGCPTNEW,'IBACT D DELPROC Q
"RTN","IBCU7",56,0)
 . I 'IBACT W !,*7,"Warning:  Procedure code is inactive on this date",!
"RTN","IBCU7",57,0)
 . I DGCPTNEW,$D(^UTILITY($J,"IB")),$$INPAT^IBCEF(IBIFN),Y["ICPT(" D DATA^IBCU74(Y)
"RTN","IBCU7",58,0)
 . S DGADDVST=$S(DGCPTNEW:1,$D(DGADDVST):DGADDVST,1:0)
"RTN","IBCU7",59,0)
 . N IBPRV,IBPRVO,IBPRVN
"RTN","IBCU7",60,0)
 . S IBPRVO=$$MAINPRV^IBCEU(IBIFN),IBPRV=$P(IBPRVO,U,3),IBPRVN=(IBPRVO["IBA(355.93,"),IBPRV=$S(IBPRV="":"",'IBPRVN:$P(IBPRVO,U),1:"")
"RTN","IBCU7",61,0)
 . I IBPRV="",'IBPRVN D
"RTN","IBCU7",62,0)
 .. S IBPRV=0 F  S IBPRV=$O(^DGCR(399,IBIFN,"CP",IBPRV)) S:'IBPRV IBPRV="" Q:'IBPRV  S Z=$P($G(^(IBPRV,0)),U,18) I Z S IBPRV=$P($G(^VA(200,Z,0)),U) Q
"RTN","IBCU7",63,0)
 . S DR="" I Y["ICPT" S DR="16"_$S(IBPRVN:";18///@",1:";18//"_IBPRV)_";6;5//"_$$DEFDIV(IBIFN)_";"
"RTN","IBCU7",64,0)
 . S DR=".01;"_DR_$S(IBFT=2:"8;9;17//NO;",1:"")_3,DIE=DIC,(IBPROCP,DA)=+Y D ^DIE Q:'$D(DA)!($E($G(Y))=U)
"RTN","IBCU7",65,0)
 . ;
"RTN","IBCU7",66,0)
 . S DR=$$SPCUNIT(IBIFN,IBPROCP) I DR'="" D ^DIE ; miles/minutes/hours
"RTN","IBCU7",67,0)
 . ;
"RTN","IBCU7",68,0)
 . I IBFT=2 D
"RTN","IBCU7",69,0)
 .. D DX^IBCU72(IBIFN,IBPROCP)
"RTN","IBCU7",70,0)
 .. S X=$$ADDTNL(IBIFN,.DA)
"RTN","IBCU7",71,0)
 . Q:$$INPAT^IBCEF(IBIFN)  ;only outpatient bills
"RTN","IBCU7",72,0)
 . ;add procedures to array for download to PCE: dgcpt(assoc clinic,cpt,'provider^first dx^modifiers',cnt)=""
"RTN","IBCU7",73,0)
 . S DGPROC=$G(^DGCR(399,IBIFN,"CP",+DA,0))
"RTN","IBCU7",74,0)
 . S X=$P(DGPROC,U,18)_U_+$G(^IBA(362.3,+$P(DGPROC,U,11),0))_U_$P(DGPROC,U,15)
"RTN","IBCU7",75,0)
 . I 'DGCPTNEW,$P(DGPROC,"^",7)="" S DGCPTNEW=2
"RTN","IBCU7",76,0)
 . I DGCPTUP,DGCPTNEW S DGCPT=DGCPT+1 I $P(DGPROC,"^",7) S DGCPT($P(DGPROC,"^",7),+DGPROC,X,DGCPT)=""
"RTN","IBCU7",77,0)
 . ; add visit date to bill
"RTN","IBCU7",78,0)
 . I DGADDVST S (X,DINUM)=DGPROCDT D VFILE1^IBCOPV1 K DINUM,X,DGNOADD,DGADDVST
"RTN","IBCU7",79,0)
 ; Delete modifers with only a sequence #, no code
"RTN","IBCU7",80,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  S Z0=0 F  S Z0=$O(^DGCR(399,IBIFN,"CP",Z,"MOD",Z0)) Q:'Z0  I $P($G(^(Z0,0)),U,2)="" S DA(2)=IBIFN,DA(1)=Z,DA=Z0,DIK="^DGCR(399,"_DA(2)_",""CP"","_DA(1)_",""MOD""," D ^DIK
"RTN","IBCU7",81,0)
 Q
"RTN","IBCU7",82,0)
CODQ K %DT,DGPROC,DIC,DIE,DR,DGPROCDT,IBPROCP,DLAYGO
"RTN","IBCU7",83,0)
 K IBFT,DGNOADD,DGADDVST,DGCPT,DGCPTUP,IBZTYPE,DGCPTNEW
"RTN","IBCU7",84,0)
 Q
"RTN","IBCU7",85,0)
 ;
"RTN","IBCU7",86,0)
DELPROC ; Remove the selected procedure, because of inactive status (cancel selection)
"RTN","IBCU7",87,0)
 W !!,*7,"The Procedure code is inactive on ",$$DAT1^IBOUTL(DGPROCDT),"."
"RTN","IBCU7",88,0)
 W !,"Please select another Procedure."
"RTN","IBCU7",89,0)
 S DA(1)=IBIFN,DA=+Y,DIK="^DGCR(399,"_IBIFN_",""CP"","
"RTN","IBCU7",90,0)
 D ^DIK
"RTN","IBCU7",91,0)
 Q
"RTN","IBCU7",92,0)
 ;
"RTN","IBCU7",93,0)
DELADD N Z,Z0,DA,DIK,X,Y
"RTN","IBCU7",94,0)
 S DA(1)=IBIFN
"RTN","IBCU7",95,0)
 ;Delete references to proc on rev codes
"RTN","IBCU7",96,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$G(^(Z,0)) I Z0'="",$P(Z0,U,15)!$S($P(Z0,U,10)=3:$P(Z0,U,11),1:0) S DIE="^DGCR(399,"_DA(1)_",""RC"",",DA=Z,DR=".11///@;.15///@"_$S($P(Z0,U,8):"",1:";.08////1") D ^DIE
"RTN","IBCU7",97,0)
 S DIK="^DGCR(399,"_DA(1)_",""CP""," F DA=0:0 S DA=$O(^DGCR(399,DA(1),"CP",DA)) Q:'DA  D ^DIK
"RTN","IBCU7",98,0)
 S DGRVRCAL=1
"RTN","IBCU7",99,0)
 Q
"RTN","IBCU7",100,0)
 ;
"RTN","IBCU7",101,0)
DTMES ;Message if procedure date not in date range
"RTN","IBCU7",102,0)
 Q:'$D(IBIFN)  Q:'$D(^DGCR(399,IBIFN,"U"))  S DGNODUU=^("U")
"RTN","IBCU7",103,0)
 G:X'<$P(DGNODUU,"^")&(X'>$P(DGNODUU,"^",2)) DTMESQ
"RTN","IBCU7",104,0)
 W *7,!!?3,"Date must be within STATEMENT COVERS FROM and STATEMENT COVERS TO period."
"RTN","IBCU7",105,0)
 S Y=$P(DGNODUU,"^") X ^DD("DD")
"RTN","IBCU7",106,0)
 W !?3,"Enter a date between ",Y," and " S Y=$P(DGNODUU,"^",2) X ^DD("DD") W Y,!
"RTN","IBCU7",107,0)
 K X,Y
"RTN","IBCU7",108,0)
DTMESQ K DGNODUU Q
"RTN","IBCU7",109,0)
 ;
"RTN","IBCU7",110,0)
CODHLP ;Display Additional Procedure codes
"RTN","IBCU7",111,0)
 N I,J,Y,IBMOD
"RTN","IBCU7",112,0)
 I '$O(^DGCR(399,IBIFN,"CP",0)) W !!?5,"No Codes Entered!",! Q
"RTN","IBCU7",113,0)
 F I=0:0 S I=$O(^DGCR(399,IBIFN,"CP",I)) Q:'I  S Y=$G(^(I,0)) S Z=$$PRCNM^IBCSCH1($P(Y,"^",1),$P(Y,"^",2)) W !?5,$E($P(Z,"^",2),1,28),?35,"- ",$P(Z,"^") D
"RTN","IBCU7",114,0)
 . N IBY
"RTN","IBCU7",115,0)
 . S IBY=$P(Y,U,2)
"RTN","IBCU7",116,0)
 . S IBMOD=$$GETMOD^IBEFUNC(IBIFN,I,1)
"RTN","IBCU7",117,0)
 . I IBMOD'="" S IBMOD="/"_IBMOD W IBMOD
"RTN","IBCU7",118,0)
 . W ?60,"Date: " S Y=IBY D DT^DIQ
"RTN","IBCU7",119,0)
 ;
"RTN","IBCU7",120,0)
 K Z Q
"RTN","IBCU7",121,0)
 ;
"RTN","IBCU7",122,0)
DICV I $D(IBIFN),$D(^DGCR(399,IBIFN,0)),$P(^(0),U,9) S DIC("V")=$S($P(^(0),U,9)=9:"I +Y(0)=80.1",$P(^(0),U,9)=4!($P(^(0),U,9)=5):"I +Y(0)=81",1:"")
"RTN","IBCU7",123,0)
 Q
"RTN","IBCU7",124,0)
 ;
"RTN","IBCU7",125,0)
DEFDIV(IBIFN) ; Find default division for bill IBIFN
"RTN","IBCU7",126,0)
 Q $P($G(^DG(40.8,+$P($G(^DGCR(399,IBIFN,0)),U,22),0)),U)
"RTN","IBCU7",127,0)
 ;
"RTN","IBCU7",128,0)
ADDTNL(IBIFN,DA) ;
"RTN","IBCU7",129,0)
 N DR,IBOK,X,Y,DIR
"RTN","IBCU7",130,0)
 S IBOK=1
"RTN","IBCU7",131,0)
 ;S DR="19;S:$P($G(^IBE(353.2,+$P($G(^DGCR(399,DA(1),""CP"",DA,0)),U,10),0)),U,2)'=""ANESTHESIA"" Y=""@20"";15;@20;50.01;50.08" D ^DIE
"RTN","IBCU7",132,0)
 S DR="19;50.01;50.08" D ^DIE
"RTN","IBCU7",133,0)
 I $D(Y) S IBOK=0 G ADDTNLQ
"RTN","IBCU7",134,0)
 S DIR("B")="NO",DIR("A")="EDIT HCFA 1500 SPECIAL PROGRAM FIELDS and BOX 19?: ",DIR("A",1)=" ",DIR(0)="YA"
"RTN","IBCU7",135,0)
 S DIR("?",1)="Respond YES only if you need to add/edit data for chiropratic visits,"
"RTN","IBCU7",136,0)
 S DIR("?")="EPSDT care, or if billing for HOSPICE and attending is not a hospice employee."
"RTN","IBCU7",137,0)
 D ^DIR K DIR
"RTN","IBCU7",138,0)
 I Y'=1 S IBOK=0 G ADDTNLQ
"RTN","IBCU7",139,0)
 S DR="W !,""  <<EPSDT>>"";50.07;W !!,""  <<HOSPICE>>"";50.03;W !!,""  <<CHIROPRACTIC>>"";50.04;50.02;50.05;50.06"
"RTN","IBCU7",140,0)
 D ^DIE
"RTN","IBCU7",141,0)
 W !
"RTN","IBCU7",142,0)
ADDTNLQ Q IBOK
"RTN","IBCU7",143,0)
 ;
"RTN","IBCU7",144,0)
XTRA1(Y) ;
"RTN","IBCU7",145,0)
 K Y
"RTN","IBCU7",146,0)
 Q
"RTN","IBCU7",147,0)
 ;
"RTN","IBCU7",148,0)
SPCUNIT(IBIFN,DA) ; return fields for special units if applicable, in DR form
"RTN","IBCU7",149,0)
 N IB0,IBCPT,IBDR,IBCT,IBFT,DFN S IBDR=""
"RTN","IBCU7",150,0)
 S IB0=$G(^DGCR(399,+$G(IBIFN),0)),IBCT=$P(IB0,U,27),IBFT=$P(IB0,U,19),DFN=$P(IB0,U,2)
"RTN","IBCU7",151,0)
 S IBCPT=$G(^DGCR(399,+$G(IBIFN),"CP",+$G(DA),0)) I IBCPT'["ICPT" G SPCUNTQ
"RTN","IBCU7",152,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,5,IBCT) S IBDR="15;" D SROMIN^IBCU74(IBIFN,DA) G SPCUNTQ ; minutes
"RTN","IBCU7",153,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,4,IBCT) S IBDR="21;" G SPCUNTQ ; miles
"RTN","IBCU7",154,0)
 I +$$ITMUNIT^IBCRU4(+IBCPT,6,IBCT) S IBDR="22//"_$$OBSHOUR^IBCU74(DFN,$P(IBCPT,U,2))_";" G SPCUNTQ ; hours
"RTN","IBCU7",155,0)
 I +IBFT=2,$P($G(^IBE(353.2,+$P(IBCPT,U,10),0)),U,2)="ANESTHESIA" S IBDR="15;" ; minutes
"RTN","IBCU7",156,0)
SPCUNTQ Q IBDR
"RTN","IBCU74")
0^8^B34281515
"RTN","IBCU74",1,0)
IBCU74 ;OAK/ELZ - INTERCEPT SCREEN INPUT OF PROCEDURE CODES (CONT) ;6-JAN-04
"RTN","IBCU74",2,0)
 ;;2.0;INTEGRATED BILLING;**228,260**;21-MAR-94
"RTN","IBCU74",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU74",4,0)
 ;
"RTN","IBCU74",5,0)
 ;
"RTN","IBCU74",6,0)
DATA(IBP) ; this is used to add data when new procedures are added for
"RTN","IBCU74",7,0)
 ; inpatient cases
"RTN","IBCU74",8,0)
 N IBX,IBY,IB1,IB2,IBC,DO,X,DIC,DIE,DA,DR,IB9,Y,IBQ,IBDR,IBZ,IBS
"RTN","IBCU74",9,0)
 S DR="" I '$P(IBP,"^",2)!('DGPROCDT) Q
"RTN","IBCU74",10,0)
 S IB1=0 F  S IB1=$O(^UTILITY($J,"IB",IB1)) Q:IB1<1!(DR)  I $P($G(^UTILITY($J,"IB",IB1,1)),"^",2)=DGPROCDT D
"RTN","IBCU74",11,0)
 . S IB2=0 F  S IB2=$O(^UTILITY($J,"IB",IB1,IB2)) Q:IB2<1!(DR)  S IBY=$G(^UTILITY($J,"IB",IB1,IB2)) I +IBY=+$P(IBP,"^",2) D  Q
"RTN","IBCU74",12,0)
 .. F IBX=6:1:9 I $P(IBY,"^",IBX) D
"RTN","IBCU74",13,0)
 ... F IBC=1:1:4 Q:'$D(^IBA(362.3,"AO",IBIFN,IBC))
"RTN","IBCU74",14,0)
 ... I $D(^IBA(362.3,"AO",IBIFN,IBC)) Q
"RTN","IBCU74",15,0)
 ... S IB9=$$ICD9^IBACSV($P(IBY,"^",IBX),DGPROCDT)
"RTN","IBCU74",16,0)
 ... W !?10,"Adding associated dx: ",$P(IB9,"^"),"  ",$P(IB9,"^",3)
"RTN","IBCU74",17,0)
 ... ; first check to see if dx on bill already
"RTN","IBCU74",18,0)
 ... S Y=$O(^IBA(362.3,"AIFN"_IBIFN,$P(IBY,"^",IBX),0))
"RTN","IBCU74",19,0)
 ... I 'Y S DIC="^IBA(362.3,",DIC(0)="",X=$P(IBY,"^",IBX),DIC("DR")=".02////^S X=IBIFN;.03////^S X=IBC" D FILE^DICN Q:Y<1
"RTN","IBCU74",20,0)
 ... ;need to find what field is not occupied starting with 10
"RTN","IBCU74",21,0)
 ... S IBZ=10 F IBS=1:1 Q:$P(DR,";",IBS)=""  I $P(DR,";",IBS)[IBZ_"////" S IBZ=IBZ+1
"RTN","IBCU74",22,0)
 ... S DR=DR_IBZ_"////"_(+Y)_";"
"RTN","IBCU74",23,0)
 .. I $P(IBY,"^",13) W !!?10,"Associating Provider: ",$P($G(^VA(200,$P(IBY,"^",13),0)),"^") D  S DR=DR_"18////"_$P(IBY,"^",13)_";"
"RTN","IBCU74",24,0)
 ... ;
"RTN","IBCU74",25,0)
 ... ; as requested by users, need to update the last look up value for
"RTN","IBCU74",26,0)
 ... ; the provider
"RTN","IBCU74",27,0)
 ... N DIC,X,DR,Y S DIC="^VA(200,",DIC(0)="INOS",X="`"_$P(IBY,"^",13)
"RTN","IBCU74",28,0)
 ... D ^DIC
"RTN","IBCU74",29,0)
 ... ;
"RTN","IBCU74",30,0)
 .. I $P(IBY,"^",14) W !?10,"Assigning Location: ",$P($G(^SC($P(IBY,"^",14),0)),"^") S DR=DR_"6////"_$P(IBY,"^",14)_";"_$S($P($G(^SC($P(IBY,"^",14),0)),"^",15):"5////"_$P(^(0),"^",15)_";",1:"")
"RTN","IBCU74",31,0)
 .. I $L(DR) S DIE="^DGCR(399,"_IBIFN_",""CP"",",DA(1)=IBIFN,DA=+IBP,IBDR=DR D ^DIE
"RTN","IBCU74",32,0)
 .. S IBC=0 F IBX=11,12 I $P(IBY,"^",IBX) S IB9=$$MOD^ICPTMOD($P(IBY,"^",IBX),"I") W !?10,"Adding Modifier: ",$P(IB9,"^",2)," - ",$P(IB9,"^",3) D
"RTN","IBCU74",33,0)
 ... S IBC=IBC+1,DIC="^DGCR(399,"_IBIFN_",""CP"","_(+IBP)_",""MOD"",",DA(1)=+IBP,DA(2)=IBIFN,X=IBC,DIC("DR")=".02////"_$P(IBY,"^",IBX),DIC(0)="" D FILE^DICN
"RTN","IBCU74",34,0)
 .. ;
"RTN","IBCU74",35,0)
 .. ; need to check for quantity >1 then duplicate entry
"RTN","IBCU74",36,0)
 .. I $P(IBY,"^",10)>1 W !!?10,"Duplicating Procedure for Quantity of ",$P(IBY,"^",10) F IBQ=1:1:$P(IBY,"^",10)-1 D
"RTN","IBCU74",37,0)
 ... K DO S DIC="^DGCR(399,"_IBIFN_",""CP"",",DIC(0)="",X=(+IBY)_";ICPT(",DA(1)=IBIFN,DIC("DR")="1////"_DGPROCDT_";"_$G(IBDR) D FILE^DICN S IBCP=+Y
"RTN","IBCU74",38,0)
 ... S IBC=0 F IBX=11,12 I $P(IBY,"^",IBX) S IB9=$$MOD^ICPTMOD($P(IBY,"^",IBX),"I"),IBC=IBC+1,DIC="^DGCR(399,"_IBIFN_",""CP"","_IBCP_",""MOD"",",DA(1)=IBCP,DA(2)=IBIFN,X=IBC,DIC("DR")=".02////"_$P(IBY,"^",IBX),DIC(0)="" D FILE^DICN
"RTN","IBCU74",39,0)
 .. K IBDR
"RTN","IBCU74",40,0)
 Q
"RTN","IBCU74",41,0)
 ;
"RTN","IBCU74",42,0)
SROMIN(IBIFN,IBPROCP) ; will ask as user to select anesthesia to populate into
"RTN","IBCU74",43,0)
 ; the minutes of a bill
"RTN","IBCU74",44,0)
 N IBSR,DFN,IBFDT,IBTDT,IBSRC,IBSRSDT,IBSREDT,IBC,IBSRDAT,IBSRMIN,DR,DA
"RTN","IBCU74",45,0)
 N DIE,X,Y,IBP,DIR
"RTN","IBCU74",46,0)
 K ^TMP("SRANES",$J),^TMP("IBSRDAT",$J)
"RTN","IBCU74",47,0)
 ;
"RTN","IBCU74",48,0)
 S DFN=$P($G(^DGCR(399,+$G(IBIFN),0)),"^",2)
"RTN","IBCU74",49,0)
 S IBFDT=+$G(^DGCR(399,IBIFN,"U")),IBTDT=$P($G(^("U")),"^",2)
"RTN","IBCU74",50,0)
 I 'DFN!('IBFDT)!('IBTDT) G SROMINQ
"RTN","IBCU74",51,0)
 ;
"RTN","IBCU74",52,0)
 S IBSR=$$ANESTIME^SROANEST(DFN,IBFDT,IBTDT) I IBSR<1 G SROMINQ
"RTN","IBCU74",53,0)
 ;
"RTN","IBCU74",54,0)
 W !!,"The following surgical/anesthesia times were found:",!
"RTN","IBCU74",55,0)
 S (IBC,IBSRC)=0 F  S IBSRC=$O(^TMP("SRANES",$J,IBSRC)) Q:IBSRC<1  S IBSRSDT=0 F  S IBSRSDT=$O(^TMP("SRANES",$J,IBSRC,IBSRSDT)) Q:'IBSRSDT  S IBSREDT=0 F  S IBSREDT=$O(^TMP("SRANES",$J,IBSRC,IBSRSDT,IBSREDT)) Q:'IBSREDT  D
"RTN","IBCU74",56,0)
 . ;
"RTN","IBCU74",57,0)
 . S IBC=IBC+1
"RTN","IBCU74",58,0)
 . S IBSRDAT=^TMP("SRANES",$J,IBSRC,IBSRSDT,IBSREDT)
"RTN","IBCU74",59,0)
 . S ^TMP("IBSRDAT",$J,IBC)=IBSRDAT
"RTN","IBCU74",60,0)
 . W !,$J(IBC,4)," Case #",IBSRC,?20,$$FMTE^XLFDT(IBSRSDT,2),?35,$$FMTE^XLFDT(IBSREDT,2),?50,$P(IBSRDAT,"^",2),?60
"RTN","IBCU74",61,0)
 . F IBP=4:1:10 I $P(IBSRDAT,"^",IBP) W:$X>61 "," W $P($T(EXEMPT+(IBP-3)),";",3)
"RTN","IBCU74",62,0)
 ;
"RTN","IBCU74",63,0)
 S DIR(0)="LO^1:"_IBC_":0" D ^DIR G:'Y SROMINQ
"RTN","IBCU74",64,0)
 ;
"RTN","IBCU74",65,0)
 S IBSRMIN=0 F IBP=1:1 Q:'$P(Y,",",IBP)  S IBSRMIN=IBSRMIN+$P(^TMP("IBSRDAT",$J,$P(Y,",",IBP)),"^",2)
"RTN","IBCU74",66,0)
 S DIE="^DGCR(399,"_IBIFN_",""CP"",",DR="15///"_IBSRMIN,DA=IBPROCP,DA(1)=IBIFN D ^DIE
"RTN","IBCU74",67,0)
 ;
"RTN","IBCU74",68,0)
SROMINQ K ^TMP("SRANES",$J),^TMP("IBSRDAT",$J)
"RTN","IBCU74",69,0)
 Q
"RTN","IBCU74",70,0)
 ;
"RTN","IBCU74",71,0)
 ;
"RTN","IBCU74",72,0)
OBSHOUR(DFN,EVNTDT) ; Get Observation Hours (for Procedures whose charge requires Hours)
"RTN","IBCU74",73,0)
 ; display Observation Discharges 72 hours before date (procedure date)
"RTN","IBCU74",74,0)
 ; allow user to input exact observation date times, using the last observation admission/discharge as default
"RTN","IBCU74",75,0)
 ; based on the date/times entered by the user calculate the total hours
"RTN","IBCU74",76,0)
 ; Input:  DFN = Patient ifn,   EVNTDT = Procedure Date
"RTN","IBCU74",77,0)
 ; Output: returns total hours with 1 decimal digit selected/input or ""
"RTN","IBCU74",78,0)
 ;
"RTN","IBCU74",79,0)
 N IBBEG,IBEND,IBDATE,IBPTF,IBPTF0,IBPTF70,IBDSPLT,IBADMDT,IBDSCDT,IBDSH,DIR,X,Y,DIRUT,DTOUT,DUOUT,IBHOURS
"RTN","IBCU74",80,0)
 S (IBDSH,IBHOURS,IBADMDT,IBDSCDT)="" I '$G(DFN) G OBSHOURQ
"RTN","IBCU74",81,0)
 S EVNTDT=$S(+$G(EVNTDT):EVNTDT,1:DT)\1,IBBEG=$$FMADD^XLFDT(EVNTDT,-3)+.0001,IBEND=EVNTDT+.2359
"RTN","IBCU74",82,0)
 ;
"RTN","IBCU74",83,0)
 W !!,?6,"Inpatient Observation Discharges 72 hours before "_$$FMTE^XLFDT(EVNTDT,2),":"
"RTN","IBCU74",84,0)
 S IBDATE=IBBEG F  S IBDATE=$O(^DGPT("ADS",IBDATE)) Q:'IBDATE  Q:IBDATE>IBEND  D
"RTN","IBCU74",85,0)
 . S IBPTF=0 F  S IBPTF=$O(^DGPT("ADS",IBDATE,IBPTF)) Q:'IBPTF  D
"RTN","IBCU74",86,0)
 .. S IBPTF0=$G(^DGPT(IBPTF,0)) Q:+IBPTF0'=DFN  S IBPTF70=$G(^DGPT(IBPTF,70))
"RTN","IBCU74",87,0)
 .. ;
"RTN","IBCU74",88,0)
 .. S IBDSPLT=+$P(IBPTF70,U,2) I ",18,23,24,36,41,65,94,"'[(","_IBDSPLT_",") Q
"RTN","IBCU74",89,0)
 .. ;
"RTN","IBCU74",90,0)
 .. S IBDSPLT=$G(^DIC(42.4,IBDSPLT,0)),IBADMDT=$E(+$P(IBPTF0,U,2),1,12),IBDSCDT=$E(+IBPTF70,1,12)
"RTN","IBCU74",91,0)
 .. ;
"RTN","IBCU74",92,0)
 .. S IBDSH=$$FMDIFF^XLFDT(IBDSCDT,IBADMDT,2)/60/60
"RTN","IBCU74",93,0)
 .. ;
"RTN","IBCU74",94,0)
 .. W !,?6,$P(IBDSPLT,U,1),?39,$$FMTE^XLFDT(IBADMDT,2),?55,$$FMTE^XLFDT(IBDSCDT,2),?72,"(",$J(IBDSH,"",1),")"
"RTN","IBCU74",95,0)
 I 'IBDSH W " None found"
"RTN","IBCU74",96,0)
 ;
"RTN","IBCU74",97,0)
 W !!,?6,"Observation Start/Stop Times are optional, used only to calculate Hours:"
"RTN","IBCU74",98,0)
 S DIR("A")="      Enter Observation Start Date/Time: " I +IBADMDT S DIR("B")=$$FMTE^XLFDT(IBADMDT,2)
"RTN","IBCU74",99,0)
 S DIR(0)="DAO^::XR" D ^DIR S IBADMDT=+Y I ('Y)!($D(DIRUT)) G OBSHOURQ
"RTN","IBCU74",100,0)
 ;
"RTN","IBCU74",101,0)
 S DIR("A")="      Enter Observation Stop Date/Time: " I IBDSCDT>IBADMDT S DIR("B")=$$FMTE^XLFDT(IBDSCDT,2)
"RTN","IBCU74",102,0)
 S DIR(0)="DAO^"_IBADMDT_"::XR" D ^DIR S IBDSCDT=+Y I ('Y)!($D(DIRUT)) G OBSHOURQ
"RTN","IBCU74",103,0)
 ;
"RTN","IBCU74",104,0)
 S IBHOURS=$J($$FMDIFF^XLFDT(IBDSCDT,IBADMDT,2)/60/60,"",1) W "     (",IBHOURS,")",!
"RTN","IBCU74",105,0)
 ;
"RTN","IBCU74",106,0)
OBSHOURQ Q IBHOURS
"RTN","IBCU74",107,0)
 ;
"RTN","IBCU74",108,0)
 ;
"RTN","IBCU74",109,0)
EXEMPT ; exemption reasons to display
"RTN","IBCU74",110,0)
 ;;SC
"RTN","IBCU74",111,0)
 ;;CV
"RTN","IBCU74",112,0)
 ;;AO
"RTN","IBCU74",113,0)
 ;;IR
"RTN","IBCU74",114,0)
 ;;MST
"RTN","IBCU74",115,0)
 ;;HNC
"RTN","IBCU74",116,0)
 ;;EC
"RTN","IBCU81")
0^6^B13771358
"RTN","IBCU81",1,0)
IBCU81 ;ALB/ARH - THIRD PARTY BILLING UTILITIES (AUTOMATED BILLER) ;02 JUL 93
"RTN","IBCU81",2,0)
 ;;2.0;INTEGRATED BILLING;**55,91,106,124,160,174,260**;21-MAR-94
"RTN","IBCU81",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBCU81",4,0)
 ;
"RTN","IBCU81",5,0)
EABD(IBETYP,IBTDT) ; -- compute earliest auto bill date: date entered plus days delay for event type
"RTN","IBCU81",6,0)
 ;the difference betwieen this and EABD^IBTUTL is that the autobill of the event type may be turned off
"RTN","IBCU81",7,0)
 ;and this procedure will still return a date
"RTN","IBCU81",8,0)
 ; -- input   IBETYPE = pointer to type of entry file
"RTN","IBCU81",9,0)
 ;            IBTDT   = episode date, if not passed in uses DT
"RTN","IBCU81",10,0)
 ;
"RTN","IBCU81",11,0)
 N X,X1,X2,Y,IBETYPD S Y="" I '$G(IBETYP) G EABDQ
"RTN","IBCU81",12,0)
 S IBETYPD=$G(^IBE(356.6,+IBETYP,0)) I '$G(IBTDT) S IBTDT=DT
"RTN","IBCU81",13,0)
 S X2=+$P(IBETYPD,"^",6) ;set earliest autobill date to entered date plus days delay
"RTN","IBCU81",14,0)
 S X1=IBTDT D C^%DTC S Y=X\1
"RTN","IBCU81",15,0)
EABDQ Q Y
"RTN","IBCU81",16,0)
 ;
"RTN","IBCU81",17,0)
EVBILL(IBTRN) ;check if event is auto billable, return EABD if it is, the difference between this and BILL^IBTUTL is that
"RTN","IBCU81",18,0)
 ;this procedure will return a date if the auto biller is turned off for this event type
"RTN","IBCU81",19,0)
 ;returns "^error message" if it is not billable
"RTN","IBCU81",20,0)
 N X,Y,Z,E,IBTRND S (X,Y,E)="" S IBTRND=$G(^IBT(356,+$G(IBTRN),0)) I IBTRND="" G BILLQ
"RTN","IBCU81",21,0)
 ;
"RTN","IBCU81",22,0)
 ; -- billed and bill not cancelled and not inpt interim first or continuous
"RTN","IBCU81",23,0)
 S Z=$$BILLED^IBCU8(IBTRN),Y=$P(Z,U,2) I +Z,'Y S E="^Event already billed on "_$P($G(^DGCR(399,+Z,0)),U,1)_"." G BILLQ
"RTN","IBCU81",24,0)
 ;
"RTN","IBCU81",25,0)
 ; -- special type (not riem. ins), not billable, inactive
"RTN","IBCU81",26,0)
 I +$P(IBTRND,U,12) S E="^Bill may not be Reimbursable Insurance, possibly "_$$EXSET^IBEFUNC(+$P(IBTRND,U,12),356,.12)_"." G BILLQ
"RTN","IBCU81",27,0)
 I +$P(IBTRND,U,19) S E="^Event has a Reason Not Billable: "_$P($G(^IBE(356.8,+$P(IBTRND,U,19),0)),U,1)_"." G BILLQ
"RTN","IBCU81",28,0)
 I '$P(IBTRND,U,20) S E="^Event is Inactive." G BILLQ
"RTN","IBCU81",29,0)
 I 'Y S Y=+$G(^IBT(356,+$G(IBTRN),1)) I 'Y S Y=DT
"RTN","IBCU81",30,0)
 S X=$$EABD(+$P(IBTRND,U,18),Y)
"RTN","IBCU81",31,0)
BILLQ Q X_E
"RTN","IBCU81",32,0)
 ;
"RTN","IBCU81",33,0)
RXRF(IBTRN) ; returns rx # and fill date for given claims tracking rx entry
"RTN","IBCU81",34,0)
 N IBX,IBY,IBZ,X S (X,IBY)=""
"RTN","IBCU81",35,0)
 S IBX=$G(^IBT(356,+$G(IBTRN),0)) I IBX'="" S IBY=$P($G(^PSRX(+$P(IBX,U,8),0)),U,1)
"RTN","IBCU81",36,0)
 I IBY'="",$P(IBX,U,10)=0 S IBZ=$P($G(^PSRX(+$P(IBX,U,8),2)),U,2) I +IBZ S X=IBY_"^"_IBZ
"RTN","IBCU81",37,0)
 I IBY'="",+$P(IBX,U,10) S IBZ=+$G(^PSRX(+$P(IBX,U,8),1,+$P(IBX,U,10),0)) I +IBZ S X=IBY_"^"_IBZ
"RTN","IBCU81",38,0)
 Q X
"RTN","IBCU81",39,0)
 ;
"RTN","IBCU81",40,0)
NABSCT(IBTRN) ; -- true if CT outpatient visit should NOT be auto billed, based only on stop (1) and clinic (2) auto billable
"RTN","IBCU81",41,0)
 ; returns true only for those stops (352.3) and clinics (352.4) specifically flagged as not auto billable
"RTN","IBCU81",42,0)
 N IBX,IBY,IBTRND S IBX=0,IBTRND="" I +$G(IBTRN) S IBTRND=$G(^IBT(356,+IBTRN,0))
"RTN","IBCU81",43,0)
 I +$P(IBTRND,U,4) S IBY=$$SCE^IBSDU(+$P(IBTRND,U,4)) I +IBY D
"RTN","IBCU81",44,0)
 . I +$P(IBY,U,3),$$NABST^IBEFUNC($P(IBY,U,3),DT) S IBX=1 Q
"RTN","IBCU81",45,0)
 . I +$P(IBY,U,4),$$NABCT^IBEFUNC($P(IBY,U,4),DT) S IBX=2
"RTN","IBCU81",46,0)
 Q IBX
"RTN","IBCU81",47,0)
 ;
"RTN","IBCU81",48,0)
NBOE(IBOE,IBOE0) ; returns true if outpatient encounter is non-billable, "" otherwise
"RTN","IBCU81",49,0)
 ; input:  IBOE - pointer to encounter (409.68)
"RTN","IBCU81",50,0)
 ;         IBOE0 - 0-node of the encounter (optional)
"RTN","IBCU81",51,0)
 ; output: "" or x^message, where x=1 if SC, x=2 if NB Stop code, x=3 if NB Clinic, x=4 if NB Appt Status
"RTN","IBCU81",52,0)
 N IBOED,IBOEP,IBX,IBCK,IBZ,IBPB,IBAPST,IBDT,DFN
"RTN","IBCU81",53,0)
 S IBX=""
"RTN","IBCU81",54,0)
 I $G(IBOE0)="" S IBOE0=$$SCE^IBSDU(IBOE)
"RTN","IBCU81",55,0)
 I 'IBOE0 G NBOEQ
"RTN","IBCU81",56,0)
 S DFN=$P(IBOE0,"^",2),IBDT=+IBOE0
"RTN","IBCU81",57,0)
 F IBZ=7,12,13 S IBCK(IBZ)=""
"RTN","IBCU81",58,0)
 S IBZ=$$BILLCK^IBAMTEDU(IBOE,IBOE0,.IBCK,.IBPB)
"RTN","IBCU81",59,0)
 S IBAPST="" I $G(IBPB)=13 S IBAPST=$E($$EXPAND^IBTRE(409.68,.12,$P(IBOE0,U,12)),1,10)
"RTN","IBCU81",60,0)
 ; check out sc and other questions
"RTN","IBCU81",61,0)
 I $G(IBPB)="" S IBAPST=$$CL^IBTRKR41(IBOE0) I $L(IBAPST) S IBPB=$S(IBAPST="SC TREATMENT":11,1:13)
"RTN","IBCU81",62,0)
 S:$G(IBPB)'="" IBX=$S(IBPB=11:"1^SC VISIT",IBPB=7:"2^NB STOP CODE",IBPB=12:"3^NB CLINIC",IBPB=13:"4^"_IBAPST,1:"")
"RTN","IBCU81",63,0)
NBOEQ Q IBX
"RTN","IBCU81",64,0)
 ;
"RTN","IBCU81",65,0)
OEDX(IBOE,IBDXA,IBDXB) ; returns arrays containing encounters diagnosis (includes duplicates)
"RTN","IBCU81",66,0)
 ; IBDXA(ORDER,DATE/TIME,IBOE,DX IFN)=DX ^ PCE ORDER ^ IBOE ^ DATE/TIME ^  TRUE IF NON-BILLABLE ^ NB MES ^ CLINIC
"RTN","IBCU81",67,0)
 ; IBDXB(IBDX) = 1 for each billable dx found
"RTN","IBCU81",68,0)
 ;
"RTN","IBCU81",69,0)
 N IBNBOE,X,IBPOV,IBDXN,IBPCE,IBPCEI,IBDT,IBOE0,IBZERR
"RTN","IBCU81",70,0)
 Q:'$G(IBOE)
"RTN","IBCU81",71,0)
 S IBOE0=$$SCE^IBSDU(+IBOE),IBDT=+IBOE0 Q:'IBDT
"RTN","IBCU81",72,0)
 I '$$BDSRC^IBEFUNC3($P(IBOE0,U,5)) Q  ; non-billable visit data source
"RTN","IBCU81",73,0)
 S IBNBOE=$$NBOE(IBOE,IBOE0)
"RTN","IBCU81",74,0)
 ;
"RTN","IBCU81",75,0)
 D GETDX^SDOE(IBOE,"IBPOV","IBZERR")
"RTN","IBCU81",76,0)
 S IBDXN=0 F  S IBDXN=$O(IBPOV(IBDXN)) Q:'IBDXN  D
"RTN","IBCU81",77,0)
 . S IBPCE=IBPOV(IBDXN),IBPCEI=$P(IBPCE,U,12)
"RTN","IBCU81",78,0)
 . S IBDXA($S(IBPCEI="P":1,IBPCEI="S":2,1:999),IBDT,IBOE,IBDXN)=+IBPCE_U_IBPCEI_U_IBOE_U_IBDT_U_$P(IBNBOE,U,1)_U_$P(IBNBOE,U,2)_U_+$P(IBOE0,U,4)
"RTN","IBCU81",79,0)
 . I 'IBNBOE S IBDXB(+IBPCE)=1
"RTN","IBCU81",80,0)
 ;
"RTN","IBCU81",81,0)
 Q
"RTN","IBCU81",82,0)
 ;
"RTN","IBTRKR3")
0^9^B23441349
"RTN","IBTRKR3",1,0)
IBTRKR3 ;ALB/AAS - CLAIMS TRACKING - ADD/TRACK RX FILLS ;13-AUG-93
"RTN","IBTRKR3",2,0)
 ;;2.0;INTEGRATED BILLING;**13,43,121,160,247,275,260**;21-MAR-94
"RTN","IBTRKR3",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRKR3",4,0)
 ;
"RTN","IBTRKR3",5,0)
% ; -- entry point for nightly background job
"RTN","IBTRKR3",6,0)
 N IBTSBDT,IBTSEDT
"RTN","IBTRKR3",7,0)
 S IBTSBDT=$$FMADD^XLFDT(DT,-14)-.1
"RTN","IBTRKR3",8,0)
 S IBTSEDT=$$FMADD^XLFDT(DT,-7)+.9
"RTN","IBTRKR3",9,0)
 D EN1
"RTN","IBTRKR3",10,0)
 Q
"RTN","IBTRKR3",11,0)
 ;
"RTN","IBTRKR3",12,0)
EN ; -- entry point to ask date range
"RTN","IBTRKR3",13,0)
 N IBBDT,IBEDT,IBTSBDT,IBTSEDT,IBTALK,IBMESS
"RTN","IBTRKR3",14,0)
 S IBTALK=1
"RTN","IBTRKR3",15,0)
 I '$P($G(^IBE(350.9,1,6)),"^",4) W !!,"I'm sorry, Tracking of Prescription Refills is currently turned off." G ENQ
"RTN","IBTRKR3",16,0)
 W !!!,"Select the Date Range of Rx Refills to Add to Claims Tracking.",!
"RTN","IBTRKR3",17,0)
 D DATE^IBOUTL
"RTN","IBTRKR3",18,0)
 I IBBDT<1!(IBEDT<1) G ENQ
"RTN","IBTRKR3",19,0)
 S IBTSBDT=IBBDT,IBTSEDT=IBEDT
"RTN","IBTRKR3",20,0)
 ;
"RTN","IBTRKR3",21,0)
 ; -- check selected dates
"RTN","IBTRKR3",22,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR3",23,0)
 ; start date can't be before parameters
"RTN","IBTRKR3",24,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR W !!,"Begin date is before Claims Tracking Start Date, changed to ",$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR3",25,0)
 ; -- end date into future
"RTN","IBTRKR3",26,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-3) W !!,"I'll automatically change the end date to 3 days prior to the date queued to run."
"RTN","IBTRKR3",27,0)
 ;
"RTN","IBTRKR3",28,0)
 W !!!,"I'm going to automatically queue this off and send you a"
"RTN","IBTRKR3",29,0)
 W !,"mail message when complete.",!
"RTN","IBTRKR3",30,0)
 S ZTIO="",ZTRTN="EN1^IBTRKR3",ZTSAVE("IB*")="",ZTDESC="IB - Add Rx Refills to Claims Tracking"
"RTN","IBTRKR3",31,0)
 D ^%ZTLOAD I $G(ZTSK) K ZTSK W !,"Request Queued"
"RTN","IBTRKR3",32,0)
ENQ K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBTRKR3",33,0)
 D HOME^%ZIS
"RTN","IBTRKR3",34,0)
 Q
"RTN","IBTRKR3",35,0)
 ;
"RTN","IBTRKR3",36,0)
EN1 ; -- add rx refills to claims tracking file
"RTN","IBTRKR3",37,0)
 N I,J,X,Y,IBTRKR,IBDT,IBRXN,IBFILL,DFN,IBDATA,IBCNT,IBCNT1,IBCNT2
"RTN","IBTRKR3",38,0)
 ;
"RTN","IBTRKR3",39,0)
 ; -- check parameters
"RTN","IBTRKR3",40,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR3",41,0)
 G:'$P(IBTRKR,"^",4) EN1Q ; quit if rx tracking off
"RTN","IBTRKR3",42,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR ; start date can't be before parameters
"RTN","IBTRKR3",43,0)
 ;
"RTN","IBTRKR3",44,0)
 ; -- users can queue into future, make sure dates not after date run
"RTN","IBTRKR3",45,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-3) S IBMESS="(Selected end date of "_$$DAT1^IBOUTL(IBTSEDT)_" automatically changed to "_$$DAT1^IBOUTL($$FMADD^XLFDT(DT,-3))_".)",IBTSEDT=$$FMADD^XLFDT(DT,-3)
"RTN","IBTRKR3",46,0)
 ;
"RTN","IBTRKR3",47,0)
 S IBRXTYP=$O(^IBE(356.6,"AC",4,0)) ; event type pointer for rx billing
"RTN","IBTRKR3",48,0)
 ;
"RTN","IBTRKR3",49,0)
 ; -- cnt= total count, cnt1=count added nsc, cnt2=count of pending
"RTN","IBTRKR3",50,0)
 S (IBCNT,IBCNT1,IBCNT2)=0
"RTN","IBTRKR3",51,0)
 S IBDT=IBTSBDT-.0001
"RTN","IBTRKR3",52,0)
 F  S IBDT=$O(^PSRX("AD",IBDT)) Q:'IBDT!(IBDT>IBTSEDT)  S IBRXN="" F  S IBRXN=$O(^PSRX("AD",IBDT,IBRXN)) Q:'IBRXN  S IBFILL="" F  S IBFILL=$O(^PSRX("AD",IBDT,IBRXN,IBFILL)) Q:IBFILL=""  D RXCHK
"RTN","IBTRKR3",53,0)
 ;
"RTN","IBTRKR3",54,0)
 I $G(IBTALK) D BULL^IBTRKR31
"RTN","IBTRKR3",55,0)
EN1Q I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBTRKR3",56,0)
 Q
"RTN","IBTRKR3",57,0)
 ;
"RTN","IBTRKR3",58,0)
RXCHK ; -- check and add rx
"RTN","IBTRKR3",59,0)
 S IBCNT=IBCNT+1
"RTN","IBTRKR3",60,0)
 ;I IBFILL<1 G RXCHKQ ;       original fill
"RTN","IBTRKR3",61,0)
 I IBDT>(DT+.24) G RXCHKQ ;  future fill
"RTN","IBTRKR3",62,0)
 I '$D(ZTQUEUED),($G(IBTALK)) W "."
"RTN","IBTRKR3",63,0)
 ;
"RTN","IBTRKR3",64,0)
 S IBRXDATA=$G(^PSRX(IBRXN,0)),IBRXSTAT=$P(IBRXDATA,"^",15)
"RTN","IBTRKR3",65,0)
 S DFN=$P(IBRXDATA,"^",2)
"RTN","IBTRKR3",66,0)
 ;I IBDT=$P($O(^DPT(DFN,"S",(IBDT-.00001))),".") G RXCHKQ ;scheduled appointment on same day as fill date
"RTN","IBTRKR3",67,0)
 ;I $$BABCSC^IBEFUNC(DFN,$P(IBDT,".",1)) G RXCHKQ ; is billable clinic stop in encounter file for data (allows telephone stops on same day, but not others) (P121 - RC, can now bill Rx if on same day as opt visit)
"RTN","IBTRKR3",68,0)
 ;
"RTN","IBTRKR3",69,0)
 ; -- not already in claims tracking
"RTN","IBTRKR3",70,0)
 I $O(^IBT(356,"ARXFL",IBRXN,IBFILL,0)) G RXCHKQ ; already in claims tracking
"RTN","IBTRKR3",71,0)
 ;
"RTN","IBTRKR3",72,0)
 ; -- see if tracking only insured and pt is insured
"RTN","IBTRKR3",73,0)
 I $P(IBTRKR,"^",4)=1,'$$INSURED^IBCNS1(DFN,IBDT) G RXCHKQ ; patient not insure
"RTN","IBTRKR3",74,0)
 ;
"RTN","IBTRKR3",75,0)
 ; -- check rx status (not deleted)
"RTN","IBTRKR3",76,0)
 I IBRXSTAT=13 G RXCHKQ
"RTN","IBTRKR3",77,0)
 ;
"RTN","IBTRKR3",78,0)
 ; -- original fill not released or returned to stock
"RTN","IBTRKR3",79,0)
 I 'IBFILL,'$P($G(^PSRX(IBRXN,2)),"^",13) G RXCHKQ
"RTN","IBTRKR3",80,0)
 I 'IBFILL,$P($G(^PSRX(IBRXN,2)),"^",15) G RXCHKQ
"RTN","IBTRKR3",81,0)
 ;
"RTN","IBTRKR3",82,0)
 ; -- refill not released or returned to stock
"RTN","IBTRKR3",83,0)
 I +IBFILL,'$P($G(^PSRX(IBRXN,1,IBFILL,0)),"^",18) G RXCHKQ
"RTN","IBTRKR3",84,0)
 I +IBFILL,$P($G(^PSRX(IBRXN,1,IBFILL,0)),"^",16) G RXCHKQ
"RTN","IBTRKR3",85,0)
 ;
"RTN","IBTRKR3",86,0)
 ; -- check drug (not investigational, supply, or over the counter drug
"RTN","IBTRKR3",87,0)
 S IBDRUG=$P(IBRXDATA,"^",6)
"RTN","IBTRKR3",88,0)
 S IBDEA=$P($G(^PSDRUG(+$P(IBRXDATA,"^",6),0)),"^",3)
"RTN","IBTRKR3",89,0)
 I IBDEA["I"!(IBDEA["S")!(IBDEA["9") G RXCHKQ ; investigational drug, supply or otc
"RTN","IBTRKR3",90,0)
 ;
"RTN","IBTRKR3",91,0)
 ; -- see if insured for prescriptions
"RTN","IBTRKR3",92,0)
 I '$$PTCOV^IBCNSU3(DFN,IBDT,"PHARMACY",.IBANY) S IBRMARK=$S($G(IBANY):"SERVICE NOT COVERED",1:"NOT INSURED")
"RTN","IBTRKR3",93,0)
 ;
"RTN","IBTRKR3",94,0)
 ; -- check sc status and others
"RTN","IBTRKR3",95,0)
 I $G(IBRMARK)="" D CL^SDCO21(DFN,IBDT,"",.IBARR) I $D(IBARR) D
"RTN","IBTRKR3",96,0)
 . S IBM=0 F  S IBM=$O(^PSRX(IBRXN,"ICD",IBM)) Q:'IBM!($G(IBRMARK)'="")  S IBZ=$G(^PSRX(IBRXN,"ICD",IBM,0)) F IBP=1:1:7 Q:$G(IBRMARK)'=""  I $D(IBARR(IBP)) D
"RTN","IBTRKR3",97,0)
 .. S IBRMARK=$S($P(IBZ,"^",IBP+1):$P($T(EXEMPT+IBP),";",3),$P(IBZ,"^",IBP+1)=0:"",1:"NEEDS SC DETERMINATION")
"RTN","IBTRKR3",98,0)
 ;
"RTN","IBTRKR3",99,0)
 ;
"RTN","IBTRKR3",100,0)
 ; -- ok to add to tracking module
"RTN","IBTRKR3",101,0)
 D REFILL^IBTUTL1(DFN,IBRXTYP,IBDT,IBRXN,IBFILL,$G(IBRMARK)) I '$D(ZTQUEUED),$G(IBTALK) W "+"
"RTN","IBTRKR3",102,0)
 I $G(IBRMARK)'="" S IBCNT2=IBCNT2+1
"RTN","IBTRKR3",103,0)
 I $G(IBRMARK)="" S IBCNT1=IBCNT1+1
"RTN","IBTRKR3",104,0)
 K IBANY,IBRMARK,VAEL,VA,IBDEA,IBDRUG,IBRXSTAT,IBRXDATA,DFN,X,Y
"RTN","IBTRKR3",105,0)
 K IBARR,IBM,IBZ,IBP
"RTN","IBTRKR3",106,0)
RXCHKQ Q
"RTN","IBTRKR3",107,0)
 ;
"RTN","IBTRKR3",108,0)
EXEMPT ; exemption reasons
"RTN","IBTRKR3",109,0)
 ;;AGENT ORANGE
"RTN","IBTRKR3",110,0)
 ;;IONIZING RADIATION
"RTN","IBTRKR3",111,0)
 ;;SC TREATMENT
"RTN","IBTRKR3",112,0)
 ;;ENV. CONTAM.
"RTN","IBTRKR3",113,0)
 ;;MILITARY SEXUAL TRAUMA
"RTN","IBTRKR3",114,0)
 ;;HEAD/NECK CANCER
"RTN","IBTRKR3",115,0)
 ;;COMBAT VETERAN
"RTN","IBTRKR3",116,0)
 ;;
"RTN","IBTRKR41")
0^2^B24615908
"RTN","IBTRKR41",1,0)
IBTRKR41 ;ALB/AAS - CLAIMS TRACKING - ADD/TRACK OUTPATIENT ENCOUNTERS ;13-AUG-93
"RTN","IBTRKR41",2,0)
 ;;2.0;INTEGRATED BILLING;**43,55,91,132,174,247,260**;21-MAR-94
"RTN","IBTRKR41",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRKR41",4,0)
 ;
"RTN","IBTRKR41",5,0)
OPCHK ; -- check and add rx
"RTN","IBTRKR41",6,0)
 N Y,Y0
"RTN","IBTRKR41",7,0)
 K IBRMARK
"RTN","IBTRKR41",8,0)
 I '$D(ZTQUEUED),($G(IBTALK)) W "."
"RTN","IBTRKR41",9,0)
 ;
"RTN","IBTRKR41",10,0)
 S IBOEDATA=$$SCE^IBSDU(IBOE),IBOESTAT=$P(IBOEDATA,"^",15)
"RTN","IBTRKR41",11,0)
 S DFN=$P(IBOEDATA,"^",2)
"RTN","IBTRKR41",12,0)
 I 'DFN G OPCHKQ
"RTN","IBTRKR41",13,0)
 I $P(IBOEDATA,"^",5) S IBVSIT=$P(IBOEDATA,"^",5) I '$$BDSRC^IBEFUNC3(IBVSIT) G OPCHKQ ;non-billable data sources
"RTN","IBTRKR41",14,0)
 ;
"RTN","IBTRKR41",15,0)
 ; -- see if tracking only insured and pt is insured/insured for outpt visits
"RTN","IBTRKR41",16,0)
 I $P(IBTRKR,"^",3)=1,'$$INSURED^IBCNS1(DFN,IBDT) G OPCHKQ ; patient not insured
"RTN","IBTRKR41",17,0)
 ;
"RTN","IBTRKR41",18,0)
 ; -- see if outpatient services are covered
"RTN","IBTRKR41",19,0)
 I '$$PTCOV^IBCNSU3(DFN,IBDT,"OUTPATIENT",.IBANY) S IBRMARK=$S($G(IBANY):"SERVICE NOT COVERED",1:"NOT INSURED")
"RTN","IBTRKR41",20,0)
 ;
"RTN","IBTRKR41",21,0)
 ; -- see if appointment type is billable
"RTN","IBTRKR41",22,0)
 I '$$RPT^IBEFUNC($P(IBOEDATA,"^",10),+IBOEDATA) S IBRMARK="NON-BILLABLE APPOINTMENT TYPE"
"RTN","IBTRKR41",23,0)
 ;
"RTN","IBTRKR41",24,0)
 ; -- check sc status, special conditions etc.
"RTN","IBTRKR41",25,0)
 I $G(IBRMARK)="" S IBRMARK=$$CL(IBOEDATA)
"RTN","IBTRKR41",26,0)
 ;
"RTN","IBTRKR41",27,0)
 ; -- check for non-billable stops or clinic
"RTN","IBTRKR41",28,0)
 S X=$P(IBOEDATA,"^",4) I X,$$NBCT^IBEFUNC(X,+IBOEDATA) S IBRMARK="NON-BILLABLE CLINIC"
"RTN","IBTRKR41",29,0)
 S X=$P(IBOEDATA,"^",3) I X,$$NBST^IBEFUNC(X,+IBOEDATA) S IBRMARK="NON-BILLABLE STOP CODE"
"RTN","IBTRKR41",30,0)
 ;
"RTN","IBTRKR41",31,0)
 ; -- ok to add to tracking module
"RTN","IBTRKR41",32,0)
 D OPT^IBTUTL1(DFN,IBOETYP,IBDT,IBOE,IBRMARK,$G(IBVSIT)) I '$D(ZTQUEUED),$G(IBTALK) W "+"
"RTN","IBTRKR41",33,0)
 I IBRMARK'="" S IBCNT2=IBCNT2+1
"RTN","IBTRKR41",34,0)
 I IBRMARK="" S IBCNT1=IBCNT1+1
"RTN","IBTRKR41",35,0)
OPCHKQ K IBANY,IBRMARK,VAEL,VA,IBOEDATA,IBVSIT,DFN,X,Y
"RTN","IBTRKR41",36,0)
 Q
"RTN","IBTRKR41",37,0)
 ;
"RTN","IBTRKR41",38,0)
BULL ; -- send bulletin
"RTN","IBTRKR41",39,0)
 ;
"RTN","IBTRKR41",40,0)
 S XMSUB="Outpatient Encounters added to Claims Tracking Complete"
"RTN","IBTRKR41",41,0)
 S IBT(1)="The process to automatically add Opt Encounters has successfully completed."
"RTN","IBTRKR41",42,0)
 S IBT(1.1)=""
"RTN","IBTRKR41",43,0)
 S IBT(2)="              Start Date: "_$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR41",44,0)
 S IBT(3)="                End Date: "_$$DAT1^IBOUTL(IBTSEDT)
"RTN","IBTRKR41",45,0)
 I $D(IBMESS) S IBT(3.1)=IBMESS
"RTN","IBTRKR41",46,0)
 S IBT(4)=""
"RTN","IBTRKR41",47,0)
 S IBT(5)="            Total Encounters Checked: "_$G(IBCNT)
"RTN","IBTRKR41",48,0)
 S IBT(6)="              Total Encounters Added: "_$G(IBCNT1)
"RTN","IBTRKR41",49,0)
 S IBT(7)=" Total Non-billable Encounters Added: "_$G(IBCNT2)
"RTN","IBTRKR41",50,0)
 S IBT(8)=""
"RTN","IBTRKR41",51,0)
 S IBT(9)="*The SC, Agent Orange, Environmental Contaminate, Ionizing Radiation,"
"RTN","IBTRKR41",52,0)
 S IBT(10)="Military Sexual Trauma,Head Neck Cancer and Combat Veteran status"
"RTN","IBTRKR41",53,0)
 S IBT(11)="visits have been added for insured patients but automatically"
"RTN","IBTRKR41",54,0)
 S IBT(12)="indicated as not billable."
"RTN","IBTRKR41",55,0)
 D SEND^IBTRKR31
"RTN","IBTRKR41",56,0)
BULLQ Q
"RTN","IBTRKR41",57,0)
 ;
"RTN","IBTRKR41",58,0)
CL(IBOEDATA,IBR) ; check out classification questions for encounter
"RTN","IBTRKR41",59,0)
 ; this new check will look at the V POV level then to the Visit level
"RTN","IBTRKR41",60,0)
 ; as necessary to determine if it relates or not.  This will indicate
"RTN","IBTRKR41",61,0)
 ; if the WHOLE visit is not billable, otherwise it will say it is
"RTN","IBTRKR41",62,0)
 ; (even if just part is billable).
"RTN","IBTRKR41",63,0)
 ; call with the zero node of 409.68 in IBOEDATA
"RTN","IBTRKR41",64,0)
 ; assumes DFN and IBDT defined
"RTN","IBTRKR41",65,0)
 ; pass in IBR by ref to get values back
"RTN","IBTRKR41",66,0)
 ;
"RTN","IBTRKR41",67,0)
 N IBRMARK,IBPCEX,IBCPT,IBARR,IBP,IBDX,IBVRNB
"RTN","IBTRKR41",68,0)
 S IBRMARK="",IBPCEX=$P(IBOEDATA,"^",5)
"RTN","IBTRKR41",69,0)
 ;
"RTN","IBTRKR41",70,0)
 ; look up classification info needed (if any)
"RTN","IBTRKR41",71,0)
 D CL^SDCO21(DFN,IBDT,"",.IBARR) I '$D(IBARR) G CLQ
"RTN","IBTRKR41",72,0)
 ;
"RTN","IBTRKR41",73,0)
 ; look up PCE info
"RTN","IBTRKR41",74,0)
 D ENCEVENT^PXKENC(IBPCEX)
"RTN","IBTRKR41",75,0)
 ;
"RTN","IBTRKR41",76,0)
 S IBVRNB=$$RNB($G(^TMP("PXKENC",$J,IBPCEX,"VST",IBPCEX,800)),.IBARR)
"RTN","IBTRKR41",77,0)
 ;
"RTN","IBTRKR41",78,0)
 ; find dx rnb's
"RTN","IBTRKR41",79,0)
 S IBDX=0 F  S IBDX=$O(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX)) Q:'IBDX  S IBDX(+$G(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX,0)))=$$RNB($G(^TMP("PXKENC",$J,IBPCEX,"POV",IBDX,800)),.IBARR)
"RTN","IBTRKR41",80,0)
 ;
"RTN","IBTRKR41",81,0)
 ; look for v cpt's with IBDX
"RTN","IBTRKR41",82,0)
 S IBCPT=0 F  S IBCPT=$O(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT)) Q:'IBCPT  F IBP=5,9,10,11 Q:'$D(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0))  D
"RTN","IBTRKR41",83,0)
 . ;
"RTN","IBTRKR41",84,0)
 . ; dx exists in v cpt but not v pov use visit level determination
"RTN","IBTRKR41",85,0)
 . I $P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP),'$D(IBDX($P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP))) D:IBVRNB REL(IBVRNB) Q
"RTN","IBTRKR41",86,0)
 . ;
"RTN","IBTRKR41",87,0)
 . ; use dx determination (where dx exists on v cpt)
"RTN","IBTRKR41",88,0)
 . I $P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP) D:$G(IBDX($P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP))) REL($G(IBDX($P(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0),"^",IBP)))) Q
"RTN","IBTRKR41",89,0)
 ;
"RTN","IBTRKR41",90,0)
 ; check for no assoc dx and apply visit level determination
"RTN","IBTRKR41",91,0)
 S IBCPT=0 F  S IBCPT=$O(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT)) Q:'IBCPT  D
"RTN","IBTRKR41",92,0)
 . S IBDX=0 F IBP=5,9,10,11 Q:IBDX  I +$P($G(^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT,0)),"^",IBP) S IBDX=1
"RTN","IBTRKR41",93,0)
 . I 'IBDX,IBVRNB D REL(IBVRNB)
"RTN","IBTRKR41",94,0)
 ;
"RTN","IBTRKR41",95,0)
 ; if some procedures left, then we need to bill, set return array
"RTN","IBTRKR41",96,0)
 I $D(^TMP("PXKENC",$J,IBPCEX,"CPT")) S IBRMARK="" M IBR=^TMP("PXKENC",$J,IBPCEX)
"RTN","IBTRKR41",97,0)
 ;
"RTN","IBTRKR41",98,0)
CLQ K ^TMP("PXKENC",$J)
"RTN","IBTRKR41",99,0)
 Q IBRMARK
"RTN","IBTRKR41",100,0)
 ;
"RTN","IBTRKR41",101,0)
RNB(IBDATA,IBARR) ; find rnb's
"RTN","IBTRKR41",102,0)
 ; pass in PCE 800 data (visit or v pov) to find any reasons not billalbe
"RTN","IBTRKR41",103,0)
 ; IBARR = classifications that could apply to patient
"RTN","IBTRKR41",104,0)
 ; the RNB number returned is from the IBARR number (SDCO21 array)
"RTN","IBTRKR41",105,0)
 N IBX,IBR S IBR=""
"RTN","IBTRKR41",106,0)
 S IBX=0 F  S IBX=$O(IBARR(IBX)) Q:'IBX!(IBR)  I $P(IBDATA,"^",$P($T(CLDATA+(IBX+1)),"^",2)) S IBR=IBX
"RTN","IBTRKR41",107,0)
 Q IBR
"RTN","IBTRKR41",108,0)
 ;
"RTN","IBTRKR41",109,0)
REL(IBRNB) ; kills of tmp if related and set IBRMARK
"RTN","IBTRKR41",110,0)
 K ^TMP("PXKENC",$J,IBPCEX,"CPT",IBCPT)
"RTN","IBTRKR41",111,0)
 S IBRMARK=$P($T(CLDATA+(IBRNB+1)),"^",3)
"RTN","IBTRKR41",112,0)
 Q
"RTN","IBTRKR41",113,0)
 ;
"RTN","IBTRKR41",114,0)
CLDATA ; classification data
"RTN","IBTRKR41",115,0)
 ; format is:  SCDO21 array^vpov/vcpt/visit 800 piece^reason not billable
"RTN","IBTRKR41",116,0)
 ;;1^2^AGENT ORANGE
"RTN","IBTRKR41",117,0)
 ;;2^3^IONIZING RADIATION
"RTN","IBTRKR41",118,0)
 ;;3^1^SC TREATMENT
"RTN","IBTRKR41",119,0)
 ;;4^4^ENV. CONTAM.
"RTN","IBTRKR41",120,0)
 ;;5^5^MILITARY SEXUAL TRAUMA
"RTN","IBTRKR41",121,0)
 ;;6^6^HEAD/NECK CANCER
"RTN","IBTRKR41",122,0)
 ;;7^7^COMBAT VETERAN
"RTN","IBTRKR41",123,0)
 ;
"RTN","IBTRKR5")
0^1^B25744902
"RTN","IBTRKR5",1,0)
IBTRKR5 ;ALB/AAS - CLAIMS TRACKING - ADD/TRACK PROSTHETICS ;13-JAN-94
"RTN","IBTRKR5",2,0)
 ;;2.0;INTEGRATED BILLING;**13,260**;21-MAR-94
"RTN","IBTRKR5",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBTRKR5",4,0)
 ;
"RTN","IBTRKR5",5,0)
% ; -- entry point for nightly background job
"RTN","IBTRKR5",6,0)
 N IBTSBDT,IBTSEDT
"RTN","IBTRKR5",7,0)
 S IBTSBDT=$$FMADD^XLFDT(DT,-30)-.1
"RTN","IBTRKR5",8,0)
 S IBTSEDT=$$FMADD^XLFDT(DT,-3)+.9
"RTN","IBTRKR5",9,0)
 D EN1
"RTN","IBTRKR5",10,0)
 Q
"RTN","IBTRKR5",11,0)
 ;
"RTN","IBTRKR5",12,0)
EN ; -- entry point to ask date range
"RTN","IBTRKR5",13,0)
 N IBBDT,IBEDT,IBTSBDT,IBTSEDT,IBTALK
"RTN","IBTRKR5",14,0)
 S IBTALK=1
"RTN","IBTRKR5",15,0)
 I '$P($G(^IBE(350.9,1,6)),"^",4) W !!,"I'm sorry, Tracking of Prosthetics is currrently turned off." G ENQ
"RTN","IBTRKR5",16,0)
 W !!!,"Select the Date Range of Prosthetics to Add to Claims Tracking.",!
"RTN","IBTRKR5",17,0)
 D DATE^IBOUTL
"RTN","IBTRKR5",18,0)
 I IBBDT<1!(IBEDT<1) G ENQ
"RTN","IBTRKR5",19,0)
 S IBTSBDT=IBBDT,IBTSEDT=IBEDT
"RTN","IBTRKR5",20,0)
 ;
"RTN","IBTRKR5",21,0)
 ; -- check selected dates
"RTN","IBTRKR5",22,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR5",23,0)
 ; start date can't be before parameters
"RTN","IBTRKR5",24,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR W !!,"Begin date is before Claims Tracking Start Date, changed to ",$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR5",25,0)
 ; -- end date into future
"RTN","IBTRKR5",26,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-3) W !!,"I'll automatically change the end date to 3 days prior to the date queued to run."
"RTN","IBTRKR5",27,0)
 ;
"RTN","IBTRKR5",28,0)
 W !!!,"I'm going to automatically queue this off and send you a"
"RTN","IBTRKR5",29,0)
 W !,"mail message when complete.",!
"RTN","IBTRKR5",30,0)
 S ZTIO="",ZTRTN="EN1^IBTRKR5",ZTSAVE("IB*")="",ZTDESC="IB - Add Prosthetics to Claims Tracking"
"RTN","IBTRKR5",31,0)
 D ^%ZTLOAD I $G(ZTSK) K ZTSK W !,"Request Queued"
"RTN","IBTRKR5",32,0)
ENQ K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBTRKR5",33,0)
 D HOME^%ZIS
"RTN","IBTRKR5",34,0)
 Q
"RTN","IBTRKR5",35,0)
 ;
"RTN","IBTRKR5",36,0)
EN1 ; -- add prostethics to claims tracking file
"RTN","IBTRKR5",37,0)
 N I,J,X,Y,IBTRKR,IBDT,DFN,IBDATA,IBCNT,IBCNT1,IBCNT2,IBDTS
"RTN","IBTRKR5",38,0)
 ;
"RTN","IBTRKR5",39,0)
 ; -- check parameters
"RTN","IBTRKR5",40,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR5",41,0)
 G:'$P(IBTRKR,"^",5) EN1Q ; quit if prothetics tracking off
"RTN","IBTRKR5",42,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR ; start date can't be before parameters
"RTN","IBTRKR5",43,0)
 ;
"RTN","IBTRKR5",44,0)
 ; -- users can queue into future, make sure dates not after date run
"RTN","IBTRKR5",45,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-3) S IBMESS="(Selected end date of "_$$DAT1^IBOUTL(IBTSEDT)_" automatically changed to "_$$DAT1^IBOUTL($$FMADD^XLFDT(DT,-3))_".)",IBTSEDT=$$FMADD^XLFDT(DT,-3)
"RTN","IBTRKR5",46,0)
 ;
"RTN","IBTRKR5",47,0)
 ;S IBPRTYP=$O(^IBE(356.6,"AC",3,0)) ; this is the event type pointer for prosthetics
"RTN","IBTRKR5",48,0)
 ;
"RTN","IBTRKR5",49,0)
 ; -- cnt= total count, cnt1=count added nsc, cnt2=count of pending
"RTN","IBTRKR5",50,0)
 S (IBCNT,IBCNT1,IBCNT2)=0
"RTN","IBTRKR5",51,0)
 S (IBDTS,IBDT)=IBTSBDT-.0001
"RTN","IBTRKR5",52,0)
 ;
"RTN","IBTRKR5",53,0)
 ; loop twice, once for shipmnet date (new search), and once for
"RTN","IBTRKR5",54,0)
 ; delivery date (old search) for backward compatibility.
"RTN","IBTRKR5",55,0)
 F  S IBDT=$O(^RMPR(660,"AF",IBDT)) Q:'IBDT!(IBDT>IBTSEDT)  S IBDA=0 F  S IBDA=$O(^RMPR(660,"AF",IBDT,IBDA)) Q:'IBDA  D PRCHK
"RTN","IBTRKR5",56,0)
 ; reset date and do old check
"RTN","IBTRKR5",57,0)
 S IBDT=IBDTS
"RTN","IBTRKR5",58,0)
 F  S IBDT=$O(^RMPR(660,"CT",IBDT)) Q:'IBDT!(IBDT>IBTSEDT)  S IBDA="" F  S IBDA=$O(^RMPR(660,"CT",IBDT,IBDA)) Q:'IBDA  D PRCHK
"RTN","IBTRKR5",59,0)
 ;
"RTN","IBTRKR5",60,0)
 I $G(IBTALK) D BULL ;^IBTRKR51
"RTN","IBTRKR5",61,0)
EN1Q I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBTRKR5",62,0)
 Q
"RTN","IBTRKR5",63,0)
 ;
"RTN","IBTRKR5",64,0)
PRCHK ; -- check and add item
"RTN","IBTRKR5",65,0)
 N IBE,IBP,IBDX,IBRMARK,IBARR,IBT
"RTN","IBTRKR5",66,0)
 S IBCNT=IBCNT+1,IBRMARK=""
"RTN","IBTRKR5",67,0)
 I '$D(ZTQUEUED),($G(IBTALK)) W "."
"RTN","IBTRKR5",68,0)
 ;
"RTN","IBTRKR5",69,0)
 S IBDATA=$G(^RMPR(660,+IBDA,0)) Q:IBDATA=""
"RTN","IBTRKR5",70,0)
 S DFN=$P(IBDATA,"^",2)
"RTN","IBTRKR5",71,0)
 D CL^SDCO21(DFN,IBDT,"",.IBARR)
"RTN","IBTRKR5",72,0)
 ;
"RTN","IBTRKR5",73,0)
 ; -- checks copied from rmprbil v2.0 /feb 2, 1994
"RTN","IBTRKR5",74,0)
 Q:'$D(^RMPR(660,+IBDA,"AM"))
"RTN","IBTRKR5",75,0)
 Q:$P(^RMPR(660,+IBDA,0),U,9)=""!($P(^(0),U,12)="")!($P(^(0),U,6)="")!($P(^(0),U,14)="V")!($P(^(0),U,2)="")!($P(^(0),U,15)="*")
"RTN","IBTRKR5",76,0)
 ;Q:($P(^RMPR(660,+IBDA,"AM"),U,3)=2)!($P(^("AM"),U,3)=3)
"RTN","IBTRKR5",77,0)
 ;
"RTN","IBTRKR5",78,0)
 ;
"RTN","IBTRKR5",79,0)
 I $O(^IBT(356,"APRO",IBDA,0)) G PRCHKQ ; already in claims tracking
"RTN","IBTRKR5",80,0)
 ;
"RTN","IBTRKR5",81,0)
 ; -- see if tracking only insured and pt is insured
"RTN","IBTRKR5",82,0)
 I $P(IBTRKR,"^",5)=1,'$$INSURED^IBCNS1(DFN,IBDT) G PRCHKQ ; patient not insure
"RTN","IBTRKR5",83,0)
 ;
"RTN","IBTRKR5",84,0)
 ; -- if clasifications required, check exemptions
"RTN","IBTRKR5",85,0)
 I '$D(IBARR) G CLQ
"RTN","IBTRKR5",86,0)
 F IBP=1:1:4 S IBDX(IBP)=$G(^RMPR(660,+IBDA,"BA"_IBP))
"RTN","IBTRKR5",87,0)
 S IBE=0 F  S IBE=$O(IBARR(IBE)) Q:'IBE!($L($G(IBRMARK)))  F IBP=1:1:4 Q:$L($G(IBRMARK))  I IBDX(IBP) S IBRMARK=$S($P(IBDX(IBP),"^",IBE+1):$P($T(CLTXT+IBE),";",3),$P(IBDX(IBP),"^",IBE+1)=0:"",1:"NEEDS SC DETERMINATION")
"RTN","IBTRKR5",88,0)
 ;
"RTN","IBTRKR5",89,0)
 ;
"RTN","IBTRKR5",90,0)
CLQ ; -- ok to add to tracking module
"RTN","IBTRKR5",91,0)
 D PRO^IBTUTL1(DFN,IBDT,IBDA,$G(IBRMARK)) I '$D(ZTQUEUED),$G(IBTALK) W "+"
"RTN","IBTRKR5",92,0)
 I $G(IBRMARK)'="" S IBCNT2=IBCNT2+1
"RTN","IBTRKR5",93,0)
 I $G(IBRMARK)="" S IBCNT1=IBCNT1+1
"RTN","IBTRKR5",94,0)
 K VAEL,VA,IBDATA,DFN,X,Y
"RTN","IBTRKR5",95,0)
PRCHKQ Q
"RTN","IBTRKR5",96,0)
 ;
"RTN","IBTRKR5",97,0)
BULL ; -- send bulletin
"RTN","IBTRKR5",98,0)
 ;
"RTN","IBTRKR5",99,0)
 S XMSUB="Prothetic Items added to Claims Tracking Complete"
"RTN","IBTRKR5",100,0)
 S IBT(1)="The process to automatically add Prosthetic Items has successfully completed."
"RTN","IBTRKR5",101,0)
 S IBT(1.1)=""
"RTN","IBTRKR5",102,0)
 S IBT(2)="                      Start Date: "_$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR5",103,0)
 S IBT(3)="                        End Date: "_$$DAT1^IBOUTL(IBTSEDT)
"RTN","IBTRKR5",104,0)
 I $D(IBMESS) S IBT(3.1)=IBMESS
"RTN","IBTRKR5",105,0)
 S IBT(4)=""
"RTN","IBTRKR5",106,0)
 S IBT(5)=" Total Prosthetics Items checked: "_$G(IBCNT)
"RTN","IBTRKR5",107,0)
 S IBT(6)="Total NSC Prosthetic Items Added: "_$G(IBCNT1)
"RTN","IBTRKR5",108,0)
 S IBT(7)=" Total SC Prosthetic Items Added: "_$G(IBCNT2)
"RTN","IBTRKR5",109,0)
 S IBT(8)=""
"RTN","IBTRKR5",110,0)
 S IBT(9)="*The items added as SC require determination and editing to be billed"
"RTN","IBTRKR5",111,0)
 D SEND^IBTRKR31
"RTN","IBTRKR5",112,0)
BULLQ Q
"RTN","IBTRKR5",113,0)
 ;
"RTN","IBTRKR5",114,0)
CLTXT ; classification text for reason not billable
"RTN","IBTRKR5",115,0)
 ;;AGENT ORANGE
"RTN","IBTRKR5",116,0)
 ;;IONIZING RADIATION
"RTN","IBTRKR5",117,0)
 ;;SC TREATMENT
"RTN","IBTRKR5",118,0)
 ;;ENV. CONTAM.
"RTN","IBTRKR5",119,0)
 ;;MILITARY SEXUAL TRAUMA
"RTN","IBTRKR5",120,0)
 ;;HEAD/NECK CANCER
"RTN","IBTRKR5",121,0)
 ;;COMBAT VETERAN
"SEC","^DIC",372,372,0,"AUDIT")
@
"SEC","^DIC",372,372,0,"DD")
@
"SEC","^DIC",372,372,0,"DEL")
@
"SEC","^DIC",372,372,0,"LAYGO")
@
"SEC","^DIC",372,372,0,"RD")
@
"SEC","^DIC",372,372,0,"WR")
@
"VER")
8.0^22.0
"^DD",372,372,0)
FIELD^^.05^11
"^DD",372,372,0,"DDA")
N
"^DD",372,372,0,"DT")
3050802
"^DD",372,372,0,"IX","B",372,.01)

"^DD",372,372,0,"NM","PFSS SITE PARAMETERS")

"^DD",372,372,.01,0)
SITE^RP4'XI^DIC(4,^0;1^K:+$G(^IBBAS(372,1,0)) X
"^DD",372,372,.01,1,0)
^.1
"^DD",372,372,.01,1,1,0)
372^B
"^DD",372,372,.01,1,1,1)
S ^IBBAS(372,"B",$E(X,1,30),DA)=""
"^DD",372,372,.01,1,1,2)
K ^IBBAS(372,"B",$E(X,1,30),DA)
"^DD",372,372,.01,3)
The SITE field is populated at installation.  Additional records may not be created.
"^DD",372,372,.01,4)

"^DD",372,372,.01,21,0)
^^4^4^3050518^
"^DD",372,372,.01,21,1,0)
The SITE field (#.01) is populated during the initial installation
"^DD",372,372,.01,21,2,0)
of this file.  Once set, it may not be edited or deleted, nor can
"^DD",372,372,.01,21,3,0)
additional records be added to the file.  Only one record exists and its
"^DD",372,372,.01,21,4,0)
internal entry number is 1.
"^DD",372,372,.01,"DT")
3050518
"^DD",372,372,.03,0)
MESSAGES PER BATCH^RNJ3,0I^^0;3^K:+X'=X!(X>999)!(X<10)!(X?.E1"."1N.N) X
"^DD",372,372,.03,3)
Type a Number between 10 and 999, 0 Decimal Digits
"^DD",372,372,.03,21,0)
^.001^5^5^3050527^^
"^DD",372,372,.03,21,1,0)
The value in this field determines the maximum number of charge records to
"^DD",372,372,.03,21,2,0)
be inserted into a Charge Batch when running the background job associated 
"^DD",372,372,.03,21,3,0)
with the PFSS Charge Batch Processing [IBBA BATCH DFT] menu option.  The 
"^DD",372,372,.03,21,4,0)
field is site configurable from a minimum of 10 records to a maximum of 
"^DD",372,372,.03,21,5,0)
999 records per batch message.
"^DD",372,372,.03,"DT")
3050609
"^DD",372,372,.04,0)
SERVICE MASTER DIRECTORY^F^^0;4^K:$L(X)>40!($L(X)<3) X
"^DD",372,372,.04,3)
Answer must be 3-40 characters in length.
"^DD",372,372,.04,21,0)
^.001^2^2^3050426^^
"^DD",372,372,.04,21,1,0)
The system directory which will hold the text file used for seeding
"^DD",372,372,.04,21,2,0)
or updating the PFSS SERVICE MASTER file (#374).
"^DD",372,372,.04,"DT")
3050419
"^DD",372,372,.05,0)
MAIL GROUP FOR SERVICE MASTER^P3.8'^XMB(3.8,^0;5^Q
"^DD",372,372,.05,21,0)
^^3^3^3050802^
"^DD",372,372,.05,21,1,0)
This selection of the appropriate mail group is left to the local
"^DD",372,372,.05,21,2,0)
site.  This mail group will receive the Error Reports issued from
"^DD",372,372,.05,21,3,0)
the PFSS SERVICE MASTER file (#374) seeding and maintenance processes.
"^DD",372,372,.05,"DT")
3050802
"^DD",372,372,.1,0)
CHARGE PROCESSOR RUNNING^SI^1:YES;0:NO;^0;10^Q
"^DD",372,372,.1,21,0)
^^9^9^3050426^
"^DD",372,372,.1,21,1,0)
When menu option IBBA BATCH DFT invokes EN^IBBADFTO, the setting of this 
"^DD",372,372,.1,21,2,0)
field is immediately checked.  This is intended to prevent concurrent jobs 
"^DD",372,372,.1,21,3,0)
from processing the Charge Cache.
"^DD",372,372,.1,21,4,0)
 
"^DD",372,372,.1,21,5,0)
If this field is set to "YES , then EN^IBBADFTO exits immediately.
"^DD",372,372,.1,21,6,0)
If this field is set to "NO , then it is set to "YES  and processing in 
"^DD",372,372,.1,21,7,0)
EN^IBBADFTO continues.
"^DD",372,372,.1,21,8,0)
When processing of the Charge Cache is completed, just before EN^IBBADFTO 
"^DD",372,372,.1,21,9,0)
exits, this field is set to "NO .
"^DD",372,372,.1,"DT")
3050609
"^DD",372,372,.11,0)
CHARGE PROCESS START TIME^DI^^0;11^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",372,372,.11,21,0)
^^6^6^3050426^
"^DD",372,372,.11,21,1,0)
The CHARGE PROCESS START TIME indicates the exact date/time when charge 
"^DD",372,372,.11,21,2,0)
processing is started via EN^IBBADFTO.
"^DD",372,372,.11,21,3,0)
 
"^DD",372,372,.11,21,4,0)
When field #.1 is set to "YES , then current system date/time is set 
"^DD",372,372,.11,21,5,0)
into field #.11.
"^DD",372,372,.11,21,6,0)
When field #.1 is set to "NO , then any data in field #.11 is deleted.
"^DD",372,372,.11,"DT")
3050609
"^DD",372,372,1.01,0)
MASTER SWITCH^RSI^1:ON;0:OFF;^1;1^Q
"^DD",372,372,1.01,21,0)
^^2^2^3050426^
"^DD",372,372,1.01,21,1,0)
This is the PFSS On/Off Switch which determines whether the PFSS 
"^DD",372,372,1.01,21,2,0)
functionality is in use ("ON ) or not in use ("OFF ).
"^DD",372,372,1.01,"DT")
3050404
"^DD",372,372,1.02,0)
EFFECTIVE DATE/TIME^RDI^^1;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",372,372,1.02,21,0)
^^2^2^3050426^
"^DD",372,372,1.02,21,1,0)
This is the exact date/time at which the PFSS On/Off Switch enters the 
"^DD",372,372,1.02,21,2,0)
status shown in field #1 as determined by the local site/user.
"^DD",372,372,1.02,"DT")
3050404
"^DD",372,372,2,0)
CURRENT CHARGE ID^NJ8,0I^^2;1^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",372,372,2,3)
Type a Number between 1 and 99999999, 0 Decimal Digits
"^DD",372,372,2,21,0)
^.001^9^9^3050527^^^
"^DD",372,372,2,21,1,0)
This is the current setting of the PFSS Charge Identifier.  Applications
"^DD",372,372,2,21,2,0)
using PFSS must tag each charge transaction with a unique identifying 
"^DD",372,372,2,21,3,0)
number, which is stored within the application's file structure,
"^DD",372,372,2,21,4,0)
and sent within the HL7 charge message to the external medical billing.
"^DD",372,372,2,21,5,0)
system.
"^DD",372,372,2,21,6,0)
 
"^DD",372,372,2,21,7,0)
To obtain a PFSS Charge Identifier the application calls 
"^DD",372,372,2,21,8,0)
$$GETCHGID^IBBAPI().  That function increments the CURRENT CHARGE ID
"^DD",372,372,2,21,9,0)
by 1 and returns that value to the calling application.
"^DD",372,372,2,"DT")
3050609
"^DD",372,372,10,0)
SWITCH HISTORY^372.01DA^^H;0
"^DD",372,372,10,21,0)
^^3^3^3050426^
"^DD",372,372,10,21,1,0)
This is a multiple field which will be automatically updated each time 
"^DD",372,372,10,21,2,0)
the IBBA MASTER SWITCH menu option is used to change the setting of the 
"^DD",372,372,10,21,3,0)
MASTER SWITCH field (#1).
"^DD",372,372,11,0)
SERVICE MASTER HISTORY^372.011DA^^11;0
"^DD",372,372,11,21,0)
^^3^3^3050426^
"^DD",372,372,11,21,1,0)
This is a multiple field (subfile) which will be automatically updated 
"^DD",372,372,11,21,2,0)
each time the PFSS SERVICE MASTER file (#374) is updated via a text file 
"^DD",372,372,11,21,3,0)
from an external source.
"^DD",372,372.01,0)
SWITCH HISTORY SUB-FIELD^^.04^4
"^DD",372,372.01,0,"DT")
3050404
"^DD",372,372.01,0,"IX","B",372.01,.01)

"^DD",372,372.01,0,"NM","SWITCH HISTORY")

"^DD",372,372.01,0,"UP")
372
"^DD",372,372.01,.01,0)
DATE/TIME OF CHANGE^RDI^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",372,372.01,.01,1,0)
^.1
"^DD",372,372.01,.01,1,1,0)
372.01^B
"^DD",372,372.01,.01,1,1,1)
S ^IBBAS(372,DA(1),"H","B",$E(X,1,30),DA)=""
"^DD",372,372.01,.01,1,1,2)
K ^IBBAS(372,DA(1),"H","B",$E(X,1,30),DA)
"^DD",372,372.01,.01,21,0)
^^2^2^3050426^
"^DD",372,372.01,.01,21,1,0)
This is the date/time at which the setting of the MASTER SWITCH 
"^DD",372,372.01,.01,21,2,0)
(field #1.01) was changed.
"^DD",372,372.01,.01,"DT")
3050609
"^DD",372,372.01,.02,0)
PREVIOUS STATUS^RSI^1:ON;0:OFF;^0;2^Q
"^DD",372,372.01,.02,21,0)
^^2^2^3050426^
"^DD",372,372.01,.02,21,1,0)
This is the setting of the MASTER SWITCH field (#1.01) of file #372 
"^DD",372,372.01,.02,21,2,0)
before the change is made.
"^DD",372,372.01,.02,"DT")
3050609
"^DD",372,372.01,.03,0)
CHANGED BY^RP200'I^VA(200,^0;3^Q
"^DD",372,372.01,.03,21,0)
^^2^2^3050426^
"^DD",372,372.01,.03,21,1,0)
This is the identity of the user that changed the setting of the 
"^DD",372,372.01,.03,21,2,0)
MASTER SWITCH field (#1.01) of file #372.
"^DD",372,372.01,.03,"DT")
3050609
"^DD",372,372.01,.04,0)
REASON^RFI^^0;4^K:$L(X)>80!($L(X)<10) X
"^DD",372,372.01,.04,3)
Answer must be 10-80 characters in length.
"^DD",372,372.01,.04,21,0)
^^2^2^3050426^
"^DD",372,372.01,.04,21,1,0)
This is the reason provided by the user for the change to the MASTER 
"^DD",372,372.01,.04,21,2,0)
SWITCH (field #1.01) setting in the PFSS MASTER file (#372).
"^DD",372,372.01,.04,"DT")
3050609
"^DD",372,372.011,0)
SERVICE MASTER HISTORY SUB-FIELD^^.03^3
"^DD",372,372.011,0,"DT")
3050527
"^DD",372,372.011,0,"IX","B",372.011,.01)

"^DD",372,372.011,0,"NM","SERVICE MASTER HISTORY")

"^DD",372,372.011,0,"UP")
372
"^DD",372,372.011,.01,0)
DATE/TIME UPDATE STARTED^DI^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",372,372.011,.01,1,0)
^.1
"^DD",372,372.011,.01,1,1,0)
372.011^B
"^DD",372,372.011,.01,1,1,1)
S ^IBBAS(372,DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",372,372.011,.01,1,1,2)
K ^IBBAS(372,DA(1),11,"B",$E(X,1,30),DA)
"^DD",372,372.011,.01,21,0)
^.001^2^2^3050426^^^
"^DD",372,372.011,.01,21,1,0)
The date/time at which a seeding or update operation on PFSS SERVICE
"^DD",372,372.011,.01,21,2,0)
MASTER file (#374) was started.
"^DD",372,372.011,.01,"DT")
3050609
"^DD",372,372.011,.02,0)
UPDATE FILE NAME^FI^^0;2^K:$L(X)>50!($L(X)<3) X
"^DD",372,372.011,.02,1,0)
^.1^^0
"^DD",372,372.011,.02,3)
Answer must be 3-50 characters in length.
"^DD",372,372.011,.02,21,0)
^.001^2^2^3050426^^
"^DD",372,372.011,.02,21,1,0)
The name of the text file used for a seeding or update operation on
"^DD",372,372.011,.02,21,2,0)
the PFSS SERVICE MASTER file (#374).
"^DD",372,372.011,.02,"DT")
3050803
"^DD",372,372.011,.03,0)
DATE/TIME UPDATED COMPLETED^DI^^0;3^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",372,372.011,.03,21,0)
^.001^2^2^3050426^^
"^DD",372,372.011,.03,21,1,0)
The date/time at which a seeding or update operation on PFSS SERVICE
"^DD",372,372.011,.03,21,2,0)
MASTER file (#374) was completed.
"^DD",372,372.011,.03,"DT")
3050803
"^DIC",372,372,0)
PFSS SITE PARAMETERS^372
"^DIC",372,372,0,"GL")
^IBBAS(372,
"^DIC",372,372,"%D",0)
^1.001^5^5^3050426^^
"^DIC",372,372,"%D",1,0)
The PFSS SITE PARAMETERS file holds data required for proper function
"^DIC",372,372,"%D",2,0)
of the IBB software, which provides common utilities and procedures
"^DIC",372,372,"%D",3,0)
for PFSS.
"^DIC",372,372,"%D",4,0)
 
"^DIC",372,372,"%D",5,0)
Per VHA Directive 10-93-142, this file definition should not be modified.
"^DIC",372,"B","PFSS SITE PARAMETERS",372)

**INSTALL NAME**
RA*5.0*41
"BLD",4963,0)
RA*5.0*41^RADIOLOGY/NUCLEAR MEDICINE^0^3050805^y
"BLD",4963,1,0)
^^1^1^3050511^^^^
"BLD",4963,1,1,0)
Billing Awareness - Radiology
"BLD",4963,4,0)
^9.64PA^79.1^4
"BLD",4963,4,70,0)
70
"BLD",4963,4,70,2,0)
^9.641^70.03^1
"BLD",4963,4,70,2,70.03,0)
EXAMINATIONS  (sub-file)
"BLD",4963,4,70,2,70.03,1,0)
^9.6411^11^3
"BLD",4963,4,70,2,70.03,1,11,0)
IMAGING ORDER
"BLD",4963,4,70,2,70.03,1,14,0)
REQUESTING PHYSICIAN
"BLD",4963,4,70,2,70.03,1,26,0)
CREDIT METHOD
"BLD",4963,4,70,222)
y^n^p^^^^n^^n
"BLD",4963,4,70,224)

"BLD",4963,4,74,0)
74
"BLD",4963,4,74,2,0)
^9.641^74^1
"BLD",4963,4,74,2,74,0)
RAD/NUC MED REPORTS  (File-top level)
"BLD",4963,4,74,2,74,1,0)
^9.6411^86^1
"BLD",4963,4,74,2,74,1,86,0)
INTERPRETING IMAGING LOCATION
"BLD",4963,4,74,222)
y^n^p^^^^n^^n
"BLD",4963,4,74,224)

"BLD",4963,4,75.1,0)
75.1
"BLD",4963,4,75.1,2,0)
^9.641^75.13^2
"BLD",4963,4,75.1,2,75.1,0)
RAD/NUC MED ORDERS  (File-top level)
"BLD",4963,4,75.1,2,75.1,1,0)
^9.6411^99^9
"BLD",4963,4,75.1,2,75.1,1,14,0)
REQUESTING PHYSICIAN
"BLD",4963,4,75.1,2,75.1,1,91,0)
PRIMARY ORDERING ICD DIAGNOSIS
"BLD",4963,4,75.1,2,75.1,1,92,0)
PRIMARY DX RELATED TO SC
"BLD",4963,4,75.1,2,75.1,1,93,0)
PRIMARY DX RELATED TO AO
"BLD",4963,4,75.1,2,75.1,1,94,0)
PRIMARY DX RELATED TO IR
"BLD",4963,4,75.1,2,75.1,1,95,0)
PRIMARY DX RELATED TO EC
"BLD",4963,4,75.1,2,75.1,1,96,0)
PRIMARY DX RELATED TO MST
"BLD",4963,4,75.1,2,75.1,1,97,0)
PRIMARY DX RELATED TO NTR
"BLD",4963,4,75.1,2,75.1,1,99,0)
PRIMARY DX RELATED TO CV
"BLD",4963,4,75.1,2,75.13,0)
SECONDARY ORDERING ICD DIAG.  (sub-file)
"BLD",4963,4,75.1,2,75.13,1,0)
^9.6411^^
"BLD",4963,4,75.1,222)
y^n^p^^^^n^^n
"BLD",4963,4,75.1,224)

"BLD",4963,4,79.1,0)
79.1
"BLD",4963,4,79.1,2,0)
^9.641^79.1^1
"BLD",4963,4,79.1,2,79.1,0)
IMAGING LOCATIONS  (File-top level)
"BLD",4963,4,79.1,2,79.1,1,0)
^9.6411^21^1
"BLD",4963,4,79.1,2,79.1,1,21,0)
CREDIT METHOD
"BLD",4963,4,79.1,222)
y^n^p^^^^n^^n
"BLD",4963,4,79.1,224)

"BLD",4963,4,"APDD",70,70.03)

"BLD",4963,4,"APDD",70,70.03,11)

"BLD",4963,4,"APDD",70,70.03,14)

"BLD",4963,4,"APDD",70,70.03,26)

"BLD",4963,4,"APDD",74,74)

"BLD",4963,4,"APDD",74,74,86)

"BLD",4963,4,"APDD",75.1,75.1)

"BLD",4963,4,"APDD",75.1,75.1,14)

"BLD",4963,4,"APDD",75.1,75.1,91)

"BLD",4963,4,"APDD",75.1,75.1,92)

"BLD",4963,4,"APDD",75.1,75.1,93)

"BLD",4963,4,"APDD",75.1,75.1,94)

"BLD",4963,4,"APDD",75.1,75.1,95)

"BLD",4963,4,"APDD",75.1,75.1,96)

"BLD",4963,4,"APDD",75.1,75.1,97)

"BLD",4963,4,"APDD",75.1,75.1,99)

"BLD",4963,4,"APDD",75.1,75.13)

"BLD",4963,4,"APDD",79.1,79.1)

"BLD",4963,4,"APDD",79.1,79.1,21)

"BLD",4963,4,"B",70,70)

"BLD",4963,4,"B",74,74)

"BLD",4963,4,"B",75.1,75.1)

"BLD",4963,4,"B",79.1,79.1)

"BLD",4963,"INI")
RA41PRE
"BLD",4963,"INIT")
RA41PST
"BLD",4963,"KRN",0)
^9.67PA^8989.52^19
"BLD",4963,"KRN",.4,0)
.4
"BLD",4963,"KRN",.401,0)
.401
"BLD",4963,"KRN",.402,0)
.402
"BLD",4963,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",4963,"KRN",.402,"NM",1,0)
RA ON-LINE CRITERIA    FILE #79.2^79.2^0
"BLD",4963,"KRN",.402,"NM","B","RA ON-LINE CRITERIA    FILE #79.2",1)

"BLD",4963,"KRN",.403,0)
.403
"BLD",4963,"KRN",.5,0)
.5
"BLD",4963,"KRN",.84,0)
.84
"BLD",4963,"KRN",3.6,0)
3.6
"BLD",4963,"KRN",3.8,0)
3.8
"BLD",4963,"KRN",9.2,0)
9.2
"BLD",4963,"KRN",9.8,0)
9.8
"BLD",4963,"KRN",9.8,"NM",0)
^9.68A^24^17
"BLD",4963,"KRN",9.8,"NM",1,0)
RABWORD^^0^B22120210
"BLD",4963,"KRN",9.8,"NM",2,0)
RABWORD1^^0^B18640503
"BLD",4963,"KRN",9.8,"NM",3,0)
RABWPCE^^0^B2776659
"BLD",4963,"KRN",9.8,"NM",7,0)
RABWRTE^^0^B8306601
"BLD",4963,"KRN",9.8,"NM",8,0)
RABWUTL^^0^B1548732
"BLD",4963,"KRN",9.8,"NM",9,0)
RAO7NEW^^0^B34874778
"BLD",4963,"KRN",9.8,"NM",10,0)
RAO7RON^^0^B14133845
"BLD",4963,"KRN",9.8,"NM",12,0)
RAORD1^^0^B47171265
"BLD",4963,"KRN",9.8,"NM",13,0)
RAORD6^^0^B44913351
"BLD",4963,"KRN",9.8,"NM",15,0)
RAPCE^^0^B41092533
"BLD",4963,"KRN",9.8,"NM",16,0)
RAPURGE^^0^B20015335
"BLD",4963,"KRN",9.8,"NM",17,0)
RARTE4^^0^B24962657
"BLD",4963,"KRN",9.8,"NM",18,0)
RARTRPV1^^0^B7495041
"BLD",4963,"KRN",9.8,"NM",19,0)
RAORD3^^0^B24179273
"BLD",4963,"KRN",9.8,"NM",22,0)
RABWORD2^^0^B16425324
"BLD",4963,"KRN",9.8,"NM",23,0)
RAORDU^^0^B27120538
"BLD",4963,"KRN",9.8,"NM",24,0)
RAORDU1^^0^B30958799
"BLD",4963,"KRN",9.8,"NM","B","RABWORD",1)

"BLD",4963,"KRN",9.8,"NM","B","RABWORD1",2)

"BLD",4963,"KRN",9.8,"NM","B","RABWORD2",22)

"BLD",4963,"KRN",9.8,"NM","B","RABWPCE",3)

"BLD",4963,"KRN",9.8,"NM","B","RABWRTE",7)

"BLD",4963,"KRN",9.8,"NM","B","RABWUTL",8)

"BLD",4963,"KRN",9.8,"NM","B","RAO7NEW",9)

"BLD",4963,"KRN",9.8,"NM","B","RAO7RON",10)

"BLD",4963,"KRN",9.8,"NM","B","RAORD1",12)

"BLD",4963,"KRN",9.8,"NM","B","RAORD3",19)

"BLD",4963,"KRN",9.8,"NM","B","RAORD6",13)

"BLD",4963,"KRN",9.8,"NM","B","RAORDU",23)

"BLD",4963,"KRN",9.8,"NM","B","RAORDU1",24)

"BLD",4963,"KRN",9.8,"NM","B","RAPCE",15)

"BLD",4963,"KRN",9.8,"NM","B","RAPURGE",16)

"BLD",4963,"KRN",9.8,"NM","B","RARTE4",17)

"BLD",4963,"KRN",9.8,"NM","B","RARTRPV1",18)

"BLD",4963,"KRN",19,0)
19
"BLD",4963,"KRN",19,"NM",0)
^9.68A^^
"BLD",4963,"KRN",19.1,0)
19.1
"BLD",4963,"KRN",101,0)
101
"BLD",4963,"KRN",409.61,0)
409.61
"BLD",4963,"KRN",771,0)
771
"BLD",4963,"KRN",870,0)
870
"BLD",4963,"KRN",8989.51,0)
8989.51
"BLD",4963,"KRN",8989.52,0)
8989.52
"BLD",4963,"KRN",8994,0)
8994
"BLD",4963,"KRN","B",.4,.4)

"BLD",4963,"KRN","B",.401,.401)

"BLD",4963,"KRN","B",.402,.402)

"BLD",4963,"KRN","B",.403,.403)

"BLD",4963,"KRN","B",.5,.5)

"BLD",4963,"KRN","B",.84,.84)

"BLD",4963,"KRN","B",3.6,3.6)

"BLD",4963,"KRN","B",3.8,3.8)

"BLD",4963,"KRN","B",9.2,9.2)

"BLD",4963,"KRN","B",9.8,9.8)

"BLD",4963,"KRN","B",19,19)

"BLD",4963,"KRN","B",19.1,19.1)

"BLD",4963,"KRN","B",101,101)

"BLD",4963,"KRN","B",409.61,409.61)

"BLD",4963,"KRN","B",771,771)

"BLD",4963,"KRN","B",870,870)

"BLD",4963,"KRN","B",8989.51,8989.51)

"BLD",4963,"KRN","B",8989.52,8989.52)

"BLD",4963,"KRN","B",8994,8994)

"BLD",4963,"QUES",0)
^9.62^^
"BLD",4963,"REQB",0)
^9.611^7^5
"BLD",4963,"REQB",3,0)
PX*1.0*124^2
"BLD",4963,"REQB",4,0)
RA*5.0*2^2
"BLD",4963,"REQB",5,0)
RA*5.0*27^2
"BLD",4963,"REQB",6,0)
RA*5.0*34^2
"BLD",4963,"REQB",7,0)
RA*5.0*45^2
"BLD",4963,"REQB","B","PX*1.0*124",3)

"BLD",4963,"REQB","B","RA*5.0*2",4)

"BLD",4963,"REQB","B","RA*5.0*27",5)

"BLD",4963,"REQB","B","RA*5.0*34",6)

"BLD",4963,"REQB","B","RA*5.0*45",7)

"FIA",70)
RAD/NUC MED PATIENT
"FIA",70,0)
^RADPT(
"FIA",70,0,0)
70IP
"FIA",70,0,1)
y^n^p^^^^n^^n
"FIA",70,0,10)

"FIA",70,0,11)

"FIA",70,0,"RLRO")

"FIA",70,0,"VR")
5.0^RA
"FIA",70,70)
1
"FIA",70,70.03)
1
"FIA",70,70.03,11)

"FIA",70,70.03,14)

"FIA",70,70.03,26)

"FIA",74)
RAD/NUC MED REPORTS
"FIA",74,0)
^RARPT(
"FIA",74,0,0)
74I
"FIA",74,0,1)
y^n^p^^^^n^^n
"FIA",74,0,10)

"FIA",74,0,11)

"FIA",74,0,"RLRO")

"FIA",74,0,"VR")
5.0^RA
"FIA",74,74)
1
"FIA",74,74,86)

"FIA",75.1)
RAD/NUC MED ORDERS
"FIA",75.1,0)
^RAO(75.1,
"FIA",75.1,0,0)
75.1PI
"FIA",75.1,0,1)
y^n^p^^^^n^^n
"FIA",75.1,0,10)

"FIA",75.1,0,11)

"FIA",75.1,0,"RLRO")

"FIA",75.1,0,"VR")
5.0^RA
"FIA",75.1,75.1)
1
"FIA",75.1,75.1,14)

"FIA",75.1,75.1,91)

"FIA",75.1,75.1,92)

"FIA",75.1,75.1,93)

"FIA",75.1,75.1,94)

"FIA",75.1,75.1,95)

"FIA",75.1,75.1,96)

"FIA",75.1,75.1,97)

"FIA",75.1,75.1,98)

"FIA",75.1,75.1,99)

"FIA",75.1,75.13)
0
"FIA",79.1)
IMAGING LOCATIONS
"FIA",79.1,0)
^RA(79.1,
"FIA",79.1,0,0)
79.1IP
"FIA",79.1,0,1)
y^n^p^^^^n^^n
"FIA",79.1,0,10)

"FIA",79.1,0,11)

"FIA",79.1,0,"RLRO")

"FIA",79.1,0,"VR")
5.0^RA
"FIA",79.1,79.1)
1
"FIA",79.1,79.1,21)

"INI")
RA41PRE
"INIT")
RA41PST
"KRN",.402,90,-1)
0^1
"KRN",.402,90,0)
RA ON-LINE CRITERIA^3030825.1005^^79.2^^^3050712
"KRN",.402,90,"%D",0)
^^2^2^2940607^
"KRN",.402,90,"%D",1,0)
This template is used to input data associated with the storing of
"KRN",.402,90,"%D",2,0)
on-line data for an imaging location.
"KRN",.402,90,"DR",1,79.2)
W !!,"Please indicate how many days each type of data should remain on-line:",!,"----------------------------------------------------------------------";S RA1=$S($D(^RA(79.2,DA,.1)):^(.1),1:"");.11//90;.12//90;.13//90;.14//90;Q;
"KRN",.402,90,"DR",1,79.2,1)
S RA2=$S($D(^RA(79.2,DA,.1)):^(.1),1:"") S:RA1=RA2 Y="@99";100///^S X="""NOW""";@99;K RA1,RA2;
"KRN",.402,90,"DR",2,79.23)
2///^S X="O";3////^S X=DUZ;
"MBREQ")
1
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",31,-1)
1^1
"PKG",31,0)
RADIOLOGY/NUCLEAR MEDICINE^RA^REGISTERS PATIENTS,RECORDS EXAMS,PROFILES,AMIS REPORTS
"PKG",31,22,0)
^9.49I^1^1
"PKG",31,22,1,0)
5.0^2980317^2981117^66481
"PKG",31,22,1,"PAH",1,0)
41^3050805^123456822
"PKG",31,22,1,"PAH",1,1,0)
^^1^1^3050805
"PKG",31,22,1,"PAH",1,1,1,0)
Billing Awareness - Radiology
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
19
"RTN","RA41PRE")
0^^B2783766
"RTN","RA41PRE",1,0)
RA41PRE ;HOIFO/SWM-Pre install ;3/1/04  11:28
"RTN","RA41PRE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**;Mar 16, 1998
"RTN","RA41PRE",3,0)
 ; This is the pre-install routine for patch RA*5.0*41
"RTN","RA41PRE",4,0)
 ; 
"RTN","RA41PRE",5,0)
 ; This routine may be deleted after RA*5.0*41 is installed.
"RTN","RA41PRE",6,0)
 ;
"RTN","RA41PRE",7,0)
 ; Three field descriptions (not data) will be deleted:
"RTN","RA41PRE",8,0)
 ;     Subfile 70.03   field 26  CREDIT METHOD
"RTN","RA41PRE",9,0)
 ;     File    79.1    field 21  CREDIT METHOD
"RTN","RA41PRE",10,0)
 ;     File    75.1    field 14  REQUESTING PHYSICIAN
"RTN","RA41PRE",11,0)
 ; Their descriptions will be put back in by the 
"RTN","RA41PRE",12,0)
 ;     installation with new information.
"RTN","RA41PRE",13,0)
 ;
"RTN","RA41PRE",14,0)
 I '$D(XPDNM)#2 D EN^DDIOL("This entry point must be called from the KIDS installation -- Nothing Done.",,"!!,$C(7)") Q
"RTN","RA41PRE",15,0)
 K %,%Z,DA,DIC,DIK,X,Y
"RTN","RA41PRE",16,0)
 N RATXT
"RTN","RA41PRE",17,0)
 S DIK="^DD(70.03,",DA(1)=70.03,DA=26 D ^DIK
"RTN","RA41PRE",18,0)
 S RATXT(1)=" Temporarily removed description for subfile 70.03, field 26  CREDIT METHOD."
"RTN","RA41PRE",19,0)
 S RATXT(2)=" "
"RTN","RA41PRE",20,0)
 D MES^XPDUTL(.RATXT)
"RTN","RA41PRE",21,0)
 K %,%Z,DA,DIC,DIK,X,Y
"RTN","RA41PRE",22,0)
 S DIK="^DD(79.1,",DA(1)=79.1,DA=21 D ^DIK
"RTN","RA41PRE",23,0)
 S RATXT(1)=" Temporarily removed description for file 79.1, field 21  CREDIT METHOD."
"RTN","RA41PRE",24,0)
 D MES^XPDUTL(.RATXT)
"RTN","RA41PRE",25,0)
 K %,%Z,DA,DIC,DIK,X,Y
"RTN","RA41PRE",26,0)
 S DIK="^DD(75.1,",DA(1)=75.1,DA=14 D ^DIK
"RTN","RA41PRE",27,0)
 S RATXT(1)=" Temporarily removed description for file 75.1, field 14  REQUESTING PHYSICIAN."
"RTN","RA41PRE",28,0)
 D MES^XPDUTL(.RATXT)
"RTN","RA41PRE",29,0)
 K %,%Z,DA,DIC,DIK,X,Y
"RTN","RA41PRE",30,0)
 Q
"RTN","RA41PST")
0^^B4780627
"RTN","RA41PST",1,0)
RA41PST ;HOIFO/SWM-Post install ;6/2/03  10:30
"RTN","RA41PST",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**;Mar 16, 1998
"RTN","RA41PST",3,0)
 ; This is the post-install routine for patch RA*5.0*41
"RTN","RA41PST",4,0)
 ; 
"RTN","RA41PST",5,0)
 ; This routine may be deleted after RA*5.0*41 is installed.
"RTN","RA41PST",6,0)
 ;
"RTN","RA41PST",7,0)
 ; Silent recompile of input templates:
"RTN","RA41PST",8,0)
 ;   RA REGISTER (file 70)
"RTN","RA41PST",9,0)
 ;   RA ORDER EXAM (file 75.1)
"RTN","RA41PST",10,0)
 ;   RA QUICK EXAM ORDER (file 75.1)
"RTN","RA41PST",11,0)
 ;
"RTN","RA41PST",12,0)
 I '$D(XPDNM)#2 D EN^DDIOL("This entry point must be called from the KIDS installation -- Nothing Done.",,"!!,$C(7)") Q
"RTN","RA41PST",13,0)
 N X,Y,DMAX,RATXT,RAITMPL,RAERR,I,N,RABAD
"RTN","RA41PST",14,0)
 ;
"RTN","RA41PST",15,0)
 ; X=rtn name, RAITMPL=tmpl name
"RTN","RA41PST",16,0)
 ;
"RTN","RA41PST",17,0)
 S X="RACTRG",RAITMPL="RA REGISTER" D COMP
"RTN","RA41PST",18,0)
 S X="RACTQE",RAITMPL="RA QUICK EXAM ORDER" D COMP
"RTN","RA41PST",19,0)
 S X="RACTOE",RAITMPL="RA ORDER EXAM" D COMP
"RTN","RA41PST",20,0)
 Q
"RTN","RA41PST",21,0)
COMP S DMAX=$$ROUSIZE^DILF
"RTN","RA41PST",22,0)
 S Y=$$FIND1^DIC(.402,,"BX",RAITMPL,,,"RAERR")
"RTN","RA41PST",23,0)
 I 'Y D  S RABAD=1
"RTN","RA41PST",24,0)
 . S RATXT(1)=" "
"RTN","RA41PST",25,0)
 . S RATXT(2)="** Cannot find input template "_RAITMPL_" **"
"RTN","RA41PST",26,0)
 . S RATXT(6)=" "
"RTN","RA41PST",27,0)
 . D MES^XPDUTL(.RATXT)
"RTN","RA41PST",28,0)
 I $D(RAERR) D  S RABAD=1
"RTN","RA41PST",29,0)
 . K RATXT
"RTN","RA41PST",30,0)
 . S RATXT(1)=" "
"RTN","RA41PST",31,0)
 . S RATXT(2)="** One or more error codes were return: **"
"RTN","RA41PST",32,0)
 . S N=2
"RTN","RA41PST",33,0)
 . S I=0 F I=1:1:17 S I=$O(RAERR("DIERR","E",I)) Q:'I  S N=N+1,RATXT(N)="     "_I_" -- "_$G(RAERR("DIERR",1,"TEXT",1))
"RTN","RA41PST",34,0)
 . S N=N+1,RATXT(N)=" "
"RTN","RA41PST",35,0)
 . D MES^XPDUTL(.RATXT)
"RTN","RA41PST",36,0)
 I $D(RABAD) D  Q
"RTN","RA41PST",37,0)
 . K RATXT
"RTN","RA41PST",38,0)
 . S RATXT(1)="** Recompilation of "_RAITMPL_" is not done. **"
"RTN","RA41PST",39,0)
 . S RATXT(2)=" "
"RTN","RA41PST",40,0)
 . S RATXT(3)="** Please log a NOIS for the Radiology module. **"
"RTN","RA41PST",41,0)
 . S RATXT(4)=" "
"RTN","RA41PST",42,0)
 . D MES^XPDUTL(.RATXT)
"RTN","RA41PST",43,0)
 S RATXT="          Compiling input template "_RAITMPL_"."
"RTN","RA41PST",44,0)
 D BMES^XPDUTL(RATXT)
"RTN","RA41PST",45,0)
 D EN^DIEZ
"RTN","RA41PST",46,0)
 S RATXT="          Finished compiling input template "_RAITMPL_"."
"RTN","RA41PST",47,0)
 D BMES^XPDUTL(RATXT)
"RTN","RA41PST",48,0)
 Q
"RTN","RABWORD")
0^1^B22120210
"RTN","RABWORD",1,0)
RABWORD ;HOIFO/JH&MM - Radiology Billing Awareness; ; 12/20/04 12:55am
"RTN","RABWORD",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**;Mar 16, 1998
"RTN","RABWORD",3,0)
 ;
"RTN","RABWORD",4,0)
 ; Rtn invokes IA #226-C, #1300-A, #2083, #10082, #2343, #4419
"RTN","RABWORD",5,0)
 Q
"RTN","RABWORD",6,0)
 ;
"RTN","RABWORD",7,0)
ASK(RADFN,RASDDT) ; Ask ICD DX & SC/EI/MST/HNC questions at time of Order.
"RTN","RABWORD",8,0)
 ; Called from BAQUES^RAORD1
"RTN","RABWORD",9,0)
 Q:'$D(^XUSEC("PROVIDER",DUZ))  ;user provider key check
"RTN","RABWORD",10,0)
 Q:'$$CIDC^IBBAPI(RADFN)  ;patient insurance & CIDC switch check
"RTN","RABWORD",11,0)
 N DIC,I11,RACNT,RADUP,RAQUIT,RABCOPY,RABASEC K RAKILL S RABASEC=0
"RTN","RABWORD",12,0)
 ;if previous order's ICD9 etc. were copied, then put them in RABWDX to file
"RTN","RABWORD",13,0)
 I $D(^TMP("RACOPY",$J)) D
"RTN","RABWORD",14,0)
 .I ^TMP("RACOPY",$J,"BA") S RABWDX(1)=^("BA")
"RTN","RABWORD",15,0)
 .S RABCOPY=0,RACNT=1
"RTN","RABWORD",16,0)
 .F  S RABCOPY=$O(^TMP("RACOPY",$J,"BA",RABCOPY)) Q:'RABCOPY  S RACNT=RACNT+1,RABWDX(RACNT)=^(RABCOPY)
"RTN","RABWORD",17,0)
PRIMDX I $D(^TMP("RACOPY",$J,"BA")) D
"RTN","RABWORD",18,0)
 .S RABCOPY(1)=^TMP("RACOPY",$J,"BA")
"RTN","RABWORD",19,0)
 .D BADISP^RABWORD1(.RABCOPY)
"RTN","RABWORD",20,0)
 S DIC="^ICD9(",DIC(0)="QEAMNZ"
"RTN","RABWORD",21,0)
 S DIC("A")="Ordering ICD-9 Diagnosis: "
"RTN","RABWORD",22,0)
 S DIC("B")="" I $D(RABWDX(1))&($P($G(RABWDX(1)),U)>0) S DIC("B")=$P(^ICD9(+RABWDX(1),0),U)
"RTN","RABWORD",23,0)
 I $D(RABCOPY) S DIC("B")=$P(RABCOPY(1),U) K RABCOPY
"RTN","RABWORD",24,0)
 S DIC("S")="I $P($$ICDDX^ICDCODE(Y,DT),U,10)" D ^DIC
"RTN","RABWORD",25,0)
 S:(+Y<0) Y=0
"RTN","RABWORD",26,0)
 S:Y="^" RAQUIT=1
"RTN","RABWORD",27,0)
 I (+Y>0) D
"RTN","RABWORD",28,0)
 .S RACNT=1,$P(RABWDX(RACNT),U,1)=+Y D BAQUES S Y=1
"RTN","RABWORD",29,0)
 ; check @ deletion of previous entry
"RTN","RABWORD",30,0)
 I X="@" K RABWDX(1)
"RTN","RABWORD",31,0)
 Q:'$D(RABWDX)!$G(RAQUIT)
"RTN","RABWORD",32,0)
 ;
"RTN","RABWORD",33,0)
SECDX F I11=1:1:7 Q:($G(RAQUIT)&'$O(RABWDX(I11)))  W ! D
"RTN","RABWORD",34,0)
 .I $D(^TMP("RACOPY",$J,"BA"))&(RABASEC'="") D
"RTN","RABWORD",35,0)
 ..S RABASEC=$O(^TMP("RACOPY",$J,"BA",RABASEC))
"RTN","RABWORD",36,0)
 ..Q:RABASEC=""
"RTN","RABWORD",37,0)
 ..S RABCOPY(2)=^TMP("RACOPY",$J,"BA",RABASEC)
"RTN","RABWORD",38,0)
 ..D BADISP^RABWORD1(.RABCOPY)
"RTN","RABWORD",39,0)
 .S DIC="^ICD9(",DIC(0)="QEAMNZ"
"RTN","RABWORD",40,0)
 .S DIC("A")="Secondary Ordering ICD-9 Diagnosis: "
"RTN","RABWORD",41,0)
 .S DIC("B")="" I $D(RABWDX(I11+1)) S DIC("B")=$P(^ICD9(+RABWDX(I11+1),0),U)
"RTN","RABWORD",42,0)
 .I $D(RABCOPY(2)) S DIC("B")=$P(RABCOPY(2),U) K RABCOPY
"RTN","RABWORD",43,0)
 .S DIC("S")="I $P($$ICDDX^ICDCODE(Y,DT),U,10)" D ^DIC
"RTN","RABWORD",44,0)
 .; delete node RABWDX() if its secondary ICD9 was @-deleted
"RTN","RABWORD",45,0)
 .I X="@" K RABWDX(I11+1)
"RTN","RABWORD",46,0)
 .I +Y<1 S RAQUIT=1 Q  ; No More Secondary ICD Dx to Enter.
"RTN","RABWORD",47,0)
 .S RADUP=0 D DUPDX
"RTN","RABWORD",48,0)
 .I RADUP W !?5,"* Cannot Enter Duplicate ICD-9 Diagnosis *" S I11=I11-1 Q
"RTN","RABWORD",49,0)
 .S RACNT=RACNT+1,$P(RABWDX(RACNT),U,1)=+Y D BAQUES
"RTN","RABWORD",50,0)
 K ^TMP("RACOPY",$J)
"RTN","RABWORD",51,0)
 Q  ; Quit back to RAORD1 routine.
"RTN","RABWORD",52,0)
 ;
"RTN","RABWORD",53,0)
BAQUES ; Ask the SC/EI/MST/HNC questions associated to each ICD Dx.
"RTN","RABWORD",54,0)
 N RASEQ,RASEQ1,RASEQ2,RAI0,RASDCLY,RAQUES,RADEFLT,RAEXHELP
"RTN","RABWORD",55,0)
 S RASDCLY=""
"RTN","RABWORD",56,0)
 D CL^SDCO21(RADFN,RASDDT,"",.RASDCLY)
"RTN","RABWORD",57,0)
 ; Current Question Sequence is:  SC, CV, AO, IR, EC, MST, HNC
"RTN","RABWORD",58,0)
 S RASEQ="3,7,1,2,4,5,6" ; Same Question Sequence as in $$SEQ^SDCO21
"RTN","RABWORD",59,0)
 F RAI0=1:1:$L(RASEQ,",") Q:$G(RAQUIT)  S RASEQ1=+$P(RASEQ,",",RAI0) I $D(RASDCLY(RASEQ1)) D
"RTN","RABWORD",60,0)
 .S RAQUES="Was treatment related to "_$P($G(^SD(409.41,RASEQ1,0)),U,6)
"RTN","RABWORD",61,0)
 .I RASEQ1=3 S RAQUES="Was treatment for a SC Condition"
"RTN","RABWORD",62,0)
 .S RAEXHELP=$S(RASEQ1=3:"D DIS^DGRPDB",1:"")
"RTN","RABWORD",63,0)
 .S RASEQ2=$S(RASEQ1=3:2,RASEQ1=1:3,RASEQ1=2:4,1:RASEQ1+1)
"RTN","RABWORD",64,0)
 .S RADEFLT=$S($P(RABWDX(RACNT),U,RASEQ2)=1:"Yes",$P(RABWDX(RACNT),U,RASEQ2)=0:"NO",1:"")
"RTN","RABWORD",65,0)
 .I RADEFLT=""&($D(^TMP("RACOPY",$J))) D
"RTN","RABWORD",66,0)
 ..I $P(^TMP("RACOPY",$J,"BA"),U,1)=$P(RABWDX(RACNT),U,1) S RADEFLT=$S($P(^TMP("RACOPY",$J,"BA"),U,RASEQ2)=1:"Yes",$P(^TMP("RACOPY",$J,"BA"),U,RASEQ2)=0:"No",1:"")
"RTN","RABWORD",67,0)
 ..I $D(^TMP("RACOPY",$J,"BA",$P(RABWDX(RACNT),U,1))) S RADEFLT=$S($P(^TMP("RACOPY",$J,"BA",$P(RABWDX(RACNT),U,1)),U,RASEQ2)=1:"Yes",$P(^TMP("RACOPY",$J,"BA",$P(RABWDX(RACNT),U,1)),U,RASEQ2)=0:"No",1:"")
"RTN","RABWORD",68,0)
 .S $P(RABWDX(RACNT),U,RASEQ2)=$S($P(RABWDX(RACNT),U,1)>0:$$ASKYN(RAQUES,RADEFLT,RAEXHELP),1:0)
"RTN","RABWORD",69,0)
 Q
"RTN","RABWORD",70,0)
 ;
"RTN","RABWORD",71,0)
ASKYN(RAQUES,RADEFLT,RAEXHELP) ; Ask Yes/No Questions
"RTN","RABWORD",72,0)
 N DIR,DIRUT,DUOUT,DTOUT
"RTN","RABWORD",73,0)
 I $G(RAEXHELP)'="" S DIR("??")="^"_RAEXHELP
"RTN","RABWORD",74,0)
 S DIR("A")="  "_RAQUES,DIR(0)="YO"
"RTN","RABWORD",75,0)
 S DIR("B")=RADEFLT D ^DIR
"RTN","RABWORD",76,0)
 S:Y="^" RAQUIT=1
"RTN","RABWORD",77,0)
 I $D(DIRUT)!($D(DTOUT))!($D(DUOUT)) S Y="" ; user typed  @ , ^ , or timed out
"RTN","RABWORD",78,0)
 Q Y
"RTN","RABWORD",79,0)
 ;
"RTN","RABWORD",80,0)
DUPDX ; Check If A Duplicate ICD Dx Has Been Entered.
"RTN","RABWORD",81,0)
 N I
"RTN","RABWORD",82,0)
 F I=1:1 Q:'$D(RABWDX(I))  I (I11+1)'=I,+Y=+RABWDX(I) S RADUP=1 Q
"RTN","RABWORD",83,0)
 Q
"RTN","RABWORD",84,0)
 ;
"RTN","RABWORD",85,0)
PROV() ; Validate for Provider Key, Active, and non-Terminated statuses.
"RTN","RABWORD",86,0)
 ; Original DIC("S") for Requesting Provider.
"RTN","RABWORD",87,0)
 ; Y = ien file #200
"RTN","RABWORD",88,0)
 S RACRE=0 ; 1 =  person is Active and Credentialed; 0 =  otherwise
"RTN","RABWORD",89,0)
 ; Check PROVIDER KEY
"RTN","RABWORD",90,0)
 I $$ACTIVE^XUSER(Y),$D(^XUSEC("PROVIDER",Y)) S RACRE=1
"RTN","RABWORD",91,0)
 Q RACRE
"RTN","RABWORD",92,0)
 ;
"RTN","RABWORD",93,0)
FILEDX(RADFN,RAO) ; Store SC/EI Fields in Order file #75.1
"RTN","RABWORD",94,0)
 ; Called from RAORD1 routine.
"RTN","RABWORD",95,0)
 I '$D(RABWDX) Q
"RTN","RABWORD",96,0)
 N RA1,RA11,RA2,RAFDA,RAIEN,RAMSG
"RTN","RABWORD",97,0)
 S RAFDA(75.1,RAO_",",91)=+RABWDX(1) ; Primary Ordering ICD Dx pointer.
"RTN","RABWORD",98,0)
 F RA1=2:1:8 D
"RTN","RABWORD",99,0)
 .S RA11=$S(RA1=8:9,1:RA1) ;Skip a field # for CV
"RTN","RABWORD",100,0)
 .S RAFDA(75.1,RAO_",",(90+RA11))=$P(RABWDX(1),U,RA1)
"RTN","RABWORD",101,0)
 D FILE^DIE("K","RAFDA","RAMSG") K RAFDA,RAMSG
"RTN","RABWORD",102,0)
 S RA1=1
"RTN","RABWORD",103,0)
 F  S RA1=$O(RABWDX(RA1)) Q:RA1=""  D
"RTN","RABWORD",104,0)
 .S RAFDA(75.13,"?+2,"_RAO_",",.01)=+RABWDX(RA1)
"RTN","RABWORD",105,0)
 .F RA2=2:1:8 D
"RTN","RABWORD",106,0)
 ..S RAFDA(75.13,"?+2,"_RAO_",",RA2)=$P(RABWDX(RA1),U,RA2)
"RTN","RABWORD",107,0)
 .D UPDATE^DIE("","RAFDA","RAIEN","RAMSG") K RAFDA,RAIEN,RAMSG
"RTN","RABWORD",108,0)
 Q
"RTN","RABWORD1")
0^2^B18640503
"RTN","RABWORD1",1,0)
RABWORD1 ;HOIFO/MM-Radiology Billing Awareness ; 10/26/04 1:36pm
"RTN","RABWORD1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**;Mar 16, 1998
"RTN","RABWORD1",3,0)
 ;
"RTN","RABWORD1",4,0)
 ; This routine invokes IA #10082
"RTN","RABWORD1",5,0)
 Q
"RTN","RABWORD1",6,0)
 ;
"RTN","RABWORD1",7,0)
BADISP(RABWDX) ; Display ICD DX & SC/EI/MST/HNC answers from the Order.
"RTN","RABWORD1",8,0)
 ; Called from BADISP^RAORDU1
"RTN","RABWORD1",9,0)
 I '$D(RABWDX) Q
"RTN","RABWORD1",10,0)
 N I1,RACNT,RAIND
"RTN","RABWORD1",11,0)
 ; Create Temp. Array of the Clinical Indicators.
"RTN","RABWORD1",12,0)
 S RAIND(2)="SC",RAIND(3)="AO",RAIND(4)="IR"
"RTN","RABWORD1",13,0)
 S RAIND(5)="EC",RAIND(6)="MST",RAIND(7)="HNC",RAIND(8)="CV"
"RTN","RABWORD1",14,0)
 ;
"RTN","RABWORD1",15,0)
PRIMDX W:$D(RABWDX(1)) !!,"Primary Ordering ICD-9 Diagnosis: "
"RTN","RABWORD1",16,0)
 N RAICD
"RTN","RABWORD1",17,0)
 I $G(RABWDX(1)) S RAICD=$$ICDDX^ICDCODE($P(RABWDX(1),U),DT,) W $P(RAICD,U,4),"  ",$P(RAICD,U,2)
"RTN","RABWORD1",18,0)
 S RACNT=1 D:$D(RABWDX(1)) BARESP
"RTN","RABWORD1",19,0)
 S Y=1
"RTN","RABWORD1",20,0)
 ;
"RTN","RABWORD1",21,0)
SECDX S I1=1
"RTN","RABWORD1",22,0)
 F  S I1=$O(RABWDX(I1)) Q:'I1  D
"RTN","RABWORD1",23,0)
 .W !!,"Secondary Ordering ICD-9 Diagnosis: "
"RTN","RABWORD1",24,0)
 .S RAICD=$$ICDDX^ICDCODE($P(RABWDX(I1),U),DT,)
"RTN","RABWORD1",25,0)
 .W $P(RAICD,U,4),"  ",$P(RAICD,U,2)
"RTN","RABWORD1",26,0)
 .S RACNT=RACNT+1 D BARESP
"RTN","RABWORD1",27,0)
 Q  ; Quit back to calling routine.
"RTN","RABWORD1",28,0)
 ;
"RTN","RABWORD1",29,0)
BARESP ; Display the SC/EC/EI/MST/HNC responses associated to each ICD Dx.
"RTN","RABWORD1",30,0)
 ; Current Question Sequence is:  SC, CV, AO, IR, EC, MST, HNC
"RTN","RABWORD1",31,0)
 N I0,I2,RA1,RABA S I2=0
"RTN","RABWORD1",32,0)
 F I0=2:1:8 D
"RTN","RABWORD1",33,0)
 .S RABA=$S(I0=2:2,I0=3:8,1:I0-1)
"RTN","RABWORD1",34,0)
 .S RA1=$P(RABWDX(RACNT),U,RABA)
"RTN","RABWORD1",35,0)
 .Q:RA1=""
"RTN","RABWORD1",36,0)
 .I I2=0 W !?5
"RTN","RABWORD1",37,0)
 .S I2=I2+1 I I2>2 S I2=1 W !?5
"RTN","RABWORD1",38,0)
 .I I2>1 W ?40
"RTN","RABWORD1",39,0)
 .W RAIND(RABA)," Related? ",$S(RA1=0:"NO",RA1=1:"YES",1:"")
"RTN","RABWORD1",40,0)
 Q
"RTN","RABWORD1",41,0)
 ;
"RTN","RABWORD1",42,0)
SENDCPRS(RAO) ; Send Billing Aware Ordering ICD Dx data to CPRS.
"RTN","RABWORD1",43,0)
 ; Called from EN1+n^RAO7NEW.
"RTN","RABWORD1",44,0)
 ; RABWDX1 variable comes from RAO7NEW routine.
"RTN","RABWORD1",45,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*190")  ;check for required BA-OR patch
"RTN","RABWORD1",46,0)
 N I,II,RA1,RA2,RA2A,RACNT,RACNT1,RAICD1,RAICD3
"RTN","RABWORD1",47,0)
 I '$D(^RAO(75.1,RAO,0)) Q
"RTN","RABWORD1",48,0)
 S RA1=$G(^RAO(75.1,RAO,"BA")) I +RA1<1 Q
"RTN","RABWORD1",49,0)
 S (RACNT,RACNT1)=0
"RTN","RABWORD1",50,0)
 S RA2=^RAO(75.1,RAO,"BA") D SEND1
"RTN","RABWORD1",51,0)
 S RA1=0
"RTN","RABWORD1",52,0)
 F  S RA1=$O(^RAO(75.1,RAO,"BAS",RA1)) Q:+RA1<1  S RA2=^(RA1,0) D SEND1
"RTN","RABWORD1",53,0)
 Q
"RTN","RABWORD1",54,0)
 ;
"RTN","RABWORD1",55,0)
SEND1 S RAICD1=$P(^ICD9(+RA2,0),U,1),RAICD3=$P(^ICD9(+RA2,0),U,3)
"RTN","RABWORD1",56,0)
 S RACNT=RACNT+1
"RTN","RABWORD1",57,0)
 S RABWDX1(RACNT)="DG1"_RAHLFS_RACNT_RAHLFS_RAHLFS_+RA2_RAECH(1)_RAICD3_RAECH(1)_"80"_RAECH(1)_RAICD1_RAECH(1)_RAICD3_RAECH(1)_"ICD9"
"RTN","RABWORD1",58,0)
 S RACNT1=RACNT
"RTN","RABWORD1",59,0)
 F I=2:1:8 D
"RTN","RABWORD1",60,0)
 .S II=$S(I=2:3,I=3:4,I=4:2,1:I),RA2A=$P(RA2,U,II)
"RTN","RABWORD1",61,0)
 .S RACNT1=RACNT1+.1
"RTN","RABWORD1",62,0)
 .S RABWDX1(RACNT1)="ZCL"_RAHLFS_RACNT_RAHLFS_(I-1)_RAHLFS_RA2A
"RTN","RABWORD1",63,0)
 Q
"RTN","RABWORD1",64,0)
 ;
"RTN","RABWORD1",65,0)
GETCPRS ; Retrieve and Store Ordering ICD Dx data from CPRS DG1 & ZCL Segments.
"RTN","RABWORD1",66,0)
 ; Called from EN1+n^RAO7RON.
"RTN","RABWORD1",67,0)
 I '$D(RADATA) Q
"RTN","RABWORD1",68,0)
 N I,RA1
"RTN","RABWORD1",69,0)
 I RAHDR="DG1" D  ; Ordering ICD Dx.
"RTN","RABWORD1",70,0)
 .I +RADATA=1 S RANEW(75.1,"+1,",91)=+$P(RADATA,RAHLFS,3)
"RTN","RABWORD1",71,0)
 .E  S RANEW(75.13,"+1"_(+RADATA)_",+1,",.01)=+$P(RADATA,RAHLFS,3)
"RTN","RABWORD1",72,0)
 I RAHDR="ZCL" D  ; Ordering ICD Dx related SC/EI/MST/HNC.
"RTN","RABWORD1",73,0)
 .F I=2,3 S RA1(I)=$P(RADATA,RAHLFS,I)
"RTN","RABWORD1",74,0)
 .S RA1(2)=$S(RA1(2)=3:1,RA1(2)=1:2,RA1(2)=2:3,1:RA1(2))
"RTN","RABWORD1",75,0)
 .I +RADATA=1 S:RA1(2)=7 RA1(2)=8 S RANEW(75.1,"+1,",(91+RA1(2)))=RA1(3)
"RTN","RABWORD1",76,0)
 .E  S RANEW(75.13,"+1"_(+RADATA)_",+1,",(1+RA1(2)))=RA1(3)
"RTN","RABWORD1",77,0)
 Q
"RTN","RABWORD1",78,0)
CPRSUPD(RADFN,RAITEM,RAORIEN,RADX,RASCEI) ;Update Order DXs edited during SignOff in CPRS
"RTN","RABWORD1",79,0)
 N RAMSG,RADXIN,RADTI,RACNI,RAUPD,RASCEII S RAMSG=1,(RADXIN,RAUPD)=0,(RADTI,RACNI)=""
"RTN","RABWORD1",80,0)
 I $P($G(^RAO(75.1,+RAITEM,0)),U,7)'=+RAORIEN D
"RTN","RABWORD1",81,0)
 .S RAMSG="0^Order #"_RAORIEN_" does not match Radiology Order #"_RAITEM
"RTN","RABWORD1",82,0)
 I RAMSG&($P($G(^RAO(75.1,+RAITEM,0)),U)'=RADFN) D
"RTN","RABWORD1",83,0)
 .S RAMSG="0^Order #"_RAORIEN_"'s DFN="_RADFN_", but Radiology Order #"_RAITEM_"'s DFN="_$P(^RAO(75.1,+RAITEM,0),U)
"RTN","RABWORD1",84,0)
 I RAMSG D
"RTN","RABWORD1",85,0)
 .K DIK,DA S DA(1)=RAITEM,DA=0,DIK="^RAO(75.1,"_DA(1)_",""BAS"","        ;Delete old DXs
"RTN","RABWORD1",86,0)
 .F  S DA=$O(^RAO(75.1,RAITEM,"BAS",DA)) Q:DA=""  D
"RTN","RABWORD1",87,0)
 ..D ^DIK
"RTN","RABWORD1",88,0)
 .K DIK,DA
"RTN","RABWORD1",89,0)
 .;Build the DX array and file
"RTN","RABWORD1",90,0)
 .S RASCEII=RASCEI,$P(RASCEII,U,2)=$P(RASCEI,U),$P(RASCEII,U,3)=$P(RASCEI,U,2),$P(RASCEII,U)=$P(RASCEI,U,3)
"RTN","RABWORD1",91,0)
 .F  S RADXIN=$O(RADX(RADXIN)) Q:RADXIN=""  D
"RTN","RABWORD1",92,0)
 ..S RABWDX(RADXIN)=RADX(RADXIN)_"^"_RASCEII
"RTN","RABWORD1",93,0)
 .I $D(RABWDX) D
"RTN","RABWORD1",94,0)
 ..S:$P($G(^RAO(75.1,RAITEM,0)),U,5)=2 RAUPD=1
"RTN","RABWORD1",95,0)
 ..D FILEDX^RABWORD(RADFN,RAITEM)
"RTN","RABWORD1",96,0)
 ..I RAUPD D
"RTN","RABWORD1",97,0)
 ...S RADTI=$O(^RADPT("AO",RAITEM,RADFN,RADTI)) Q:'RADTI
"RTN","RABWORD1",98,0)
 ...S RACNI=$O(^RADPT("AO",RAITEM,RADFN,RADTI,RACNI)) Q:'RACNI
"RTN","RABWORD1",99,0)
 ...S ZTQUEUED=1
"RTN","RABWORD1",100,0)
 ...D UNCOMPL^RAPCE1(RADFN,RADTI,RACNI)
"RTN","RABWORD1",101,0)
 ...D:$P($G(^RADPT(RADFN,"DT",0)),U,5) COMPLETE^RAPCE(RADFN,RADTI,RACNI)
"RTN","RABWORD1",102,0)
 K RADFN,RAITEM,RAORIEN,RASCEI,RABWDX,RADX
"RTN","RABWORD1",103,0)
 Q RAMSG
"RTN","RABWORD2")
0^22^B16425324
"RTN","RABWORD2",1,0)
RABWORD2 ;HOIFO/KAR - Radiology Billing Awareness ;12/20/04  3:55pm
"RTN","RABWORD2",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**;Mar 16, 1998
"RTN","RABWORD2",3,0)
 ;
"RTN","RABWORD2",4,0)
 ; Rtn invokes IA #1300-A, #2083, #4419
"RTN","RABWORD2",5,0)
 Q
"RTN","RABWORD2",6,0)
ORDER ; List Exam Orders to select to copy ICD-9 SC/EC Indicator values from
"RTN","RABWORD2",7,0)
 D HDR S (RAXIT,RACOPY)=0
"RTN","RABWORD2",8,0)
 N RALP,RA751,DIROUT,DIRUT,DTOUT,DUOUT S (RALP,RAXIT)=0
"RTN","RABWORD2",9,0)
 F  S RALP=$O(^RAO(75.1,"B",RADFN,RALP)) Q:RALP'>0!(RAXIT)  D
"RTN","RABWORD2",10,0)
 .S RA751(0)=$G(^RAO(75.1,RALP,0)),RA751(2)=$P(RA751(0),U,2)
"RTN","RABWORD2",11,0)
 .Q:RA751(2)=""
"RTN","RABWORD2",12,0)
 .S RA751(16)=$P(RA751(0),U,16),RA751(20)=$P(RA751(0),U,20)
"RTN","RABWORD2",13,0)
 .S RA751(5)=+$P(RA751(0),U,5) Q:RA751(5)=1
"RTN","RABWORD2",14,0)
 .S Y=RA751(2),C=$P($G(^DD(75.1,2,0)),U,2) D Y^DIQ S RA751(2)=Y
"RTN","RABWORD2",15,0)
 .S Y=RA751(20),C=$P($G(^DD(75.1,20,0)),U,2) D Y^DIQ S RA751(20)=Y
"RTN","RABWORD2",16,0)
 .S RACOPY=RACOPY+1,RACOPY(RACOPY)=RALP
"RTN","RABWORD2",17,0)
 .W !,RACOPY,?10,$E(RA751(2),1,28),?39
"RTN","RABWORD2",18,0)
 .W $S(RA751(16)]"":$$FMTE^XLFDT(RA751(16),"2D"),1:"")
"RTN","RABWORD2",19,0)
 .W ?52,$E(RA751(20),1,12) ; prints 'SUBMIT REQUEST TO' data
"RTN","RABWORD2",20,0)
 .I $E(IOST,1,2)="C-",($Y>(IOSL-4)) D
"RTN","RABWORD2",21,0)
 ..K DIR S DIR(0)="E" D ^DIR K DIR S:'+Y RAXIT=1
"RTN","RABWORD2",22,0)
 ..I 'RAXIT W @IOF D HDR
"RTN","RABWORD2",23,0)
 Q
"RTN","RABWORD2",24,0)
HDR ; Header
"RTN","RABWORD2",25,0)
 D HOME^%ZIS W:$D(RAOPT("ORDEREXAM"))#2 @IOF
"RTN","RABWORD2",26,0)
 W !!,"#",?10,"Last Procedures/New Orders",?39,"Order Date",?52,"Imaging Loc."
"RTN","RABWORD2",27,0)
 W !,"------",?10,"----------------------------",?39,"------------",?52,"------------"
"RTN","RABWORD2",28,0)
 Q
"RTN","RABWORD2",29,0)
PREV ;Prompt for Copying a previous Order's DX/SC/EC values.
"RTN","RABWORD2",30,0)
 Q:'$D(^XUSEC("PROVIDER",DUZ))  ;user provider key check
"RTN","RABWORD2",31,0)
 Q:'$$CIDC^IBBAPI(RADFN)  ;patient insurance & CIDC switch check
"RTN","RABWORD2",32,0)
 N RAPREV S RAPREV=0 K DIR
"RTN","RABWORD2",33,0)
 I $P($G(VAEL(3)),"^") D
"RTN","RABWORD2",34,0)
 .S DIR("B")="NO",DIR("A")="Copy a previous order's ICD codes and SC/EI values",DIR(0)="YO"
"RTN","RABWORD2",35,0)
 .S DIR("?")="Answer 'Y' if you plan to copy ICD-9 Diagnosis codes and Service Connected/Environmental Indicator values to this order." D ^DIR
"RTN","RABWORD2",36,0)
 I '$P($G(VAEL(3)),"^") D
"RTN","RABWORD2",37,0)
 .S DIR("B")="NO",DIR("A")="Copy a previous order's ICD codes",DIR(0)="YO"
"RTN","RABWORD2",38,0)
 .S DIR("?")="Answer 'Y' if you plan to copy ICD-9 Diagnosis codes to this order." D ^DIR
"RTN","RABWORD2",39,0)
 I Y D 
"RTN","RABWORD2",40,0)
 .N RACOPY D ORDER
"RTN","RABWORD2",41,0)
 .K DIR S DIR("A")="Select Order # to copy",DIR(0)="NO" D ^DIR
"RTN","RABWORD2",42,0)
 .I '$D(RACOPY(+Y)) W !,"*Invalid selection" S RAPREV=1 Q
"RTN","RABWORD2",43,0)
 .I +Y>0 D
"RTN","RABWORD2",44,0)
 ..I '$D(^RAO(75.1,RACOPY(+Y),"BA")) W !,"*No Previous ICD codes entered for this order" Q
"RTN","RABWORD2",45,0)
 ..S ^TMP("RACOPY",$J,"BA")=^RAO(75.1,RACOPY(+Y),"BA")
"RTN","RABWORD2",46,0)
 ..N RABASEC S RABASEC=0 F  S RABASEC=$O(^RAO(75.1,RACOPY(+Y),"BAS",RABASEC)) Q:RABASEC<1  D
"RTN","RABWORD2",47,0)
 ...S ^TMP("RACOPY",$J,"BA",$P(^RAO(75.1,RACOPY(+Y),"BAS",RABASEC,0),U,1))=^RAO(75.1,RACOPY(+Y),"BAS",RABASEC,0)
"RTN","RABWORD2",48,0)
 G:RAPREV PREV
"RTN","RABWORD2",49,0)
 Q
"RTN","RABWORD2",50,0)
ELIG ;List the Service Connected ratios for the patient
"RTN","RABWORD2",51,0)
 N RAY,RAELIG,RASC,RAPERC,RAAO,RAIR,RAEC
"RTN","RABWORD2",52,0)
 D DEM^VADPT,ELIG^VADPT,SVC^VADPT
"RTN","RABWORD2",53,0)
 S RAELIG=$P(VAEL(1),"^",2),RASC=$P(VAEL(3),"^"),RASC=$S(RASC:"YES",RASC=0:"NO",1:""),RAPERC=$P(VAEL(3),"^",2)
"RTN","RABWORD2",54,0)
 S RAAO=$S(VASV(2):"YES",1:"NO"),RAIR=$S(VASV(3):"YES",1:"NO")
"RTN","RABWORD2",55,0)
 S DIC=2,DA=RADFN,DR=".322013",DIQ="RAY",DIQ(0)="I" D EN^DIQ1 K DA,DIC,DIQ,DR
"RTN","RABWORD2",56,0)
 S RAEC=RAY(2,RADFN,.322013,"I"),RAEC=$S(RAEC="Y":"YES",1:"NO")
"RTN","RABWORD2",57,0)
 W @IOF,!,VADM(1)_"  ("_VA("PID")_")       ",$P(VAEL(6),"^",2),!!,"   * * * Eligibility Information and Service Connected Conditions * * *"
"RTN","RABWORD2",58,0)
 W !!,?5,"Primary Eligibility: "_RAELIG,!,?5,"A/O Exp.: "_RAAO,?24,"ION Rad.: "_RAIR,?44,"Env Contam: "_RAEC,!
"RTN","RABWORD2",59,0)
 Q
"RTN","RABWORD2",60,0)
ADDEXAM ;Add DX/SC/EI data to new order when adding order to Last Visit
"RTN","RABWORD2",61,0)
 Q:'$D(^XUSEC("PROVIDER",DUZ))  ;user provider key check
"RTN","RABWORD2",62,0)
 Q:'$$CIDC^IBBAPI(RADFN)  ;patient insurance & CIDC switch check
"RTN","RABWORD2",63,0)
 N RAOIEN,RACOPY,RABASEC
"RTN","RABWORD2",64,0)
 S RAOIEN=$P(^RADPT(RADFN,"DT",RAVLEDTI,"P",RAVLECNI,0),U,11)
"RTN","RABWORD2",65,0)
 Q:'$D(^RAO(75.1,RAOIEN,"BA"))
"RTN","RABWORD2",66,0)
 S ^TMP("RACOPY",$J,"BA")=^RAO(75.1,RAOIEN,"BA")
"RTN","RABWORD2",67,0)
 S RABASEC=0 F  S RABASEC=$O(^RAO(75.1,RAOIEN,"BAS",RABASEC)) Q:RABASEC<1  D
"RTN","RABWORD2",68,0)
 .S ^TMP("RACOPY",$J,"BA",$P(^RAO(75.1,RAOIEN,"BAS",RABASEC,0),U,1))=^RAO(75.1,RAOIEN,"BAS",RABASEC,0)
"RTN","RABWORD2",69,0)
 Q
"RTN","RABWPCE")
0^3^B2776659
"RTN","RABWPCE",1,0)
RABWPCE ;HISC/MM - Billing Awareness Project: PCE API ; 3/23/04 10:17am
"RTN","RABWPCE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**; Mar 16, 1998
"RTN","RABWPCE",3,0)
 Q
"RTN","RABWPCE",4,0)
 ;
"RTN","RABWPCE",5,0)
DX(RAO) ; Create ^TMP("RAPXAPI",$J,"DX/PL" for PCE API:  Ordering ICD Dx.
"RTN","RABWPCE",6,0)
 ; Called from LON+n^RAPCE.
"RTN","RABWPCE",7,0)
 ; ^RAO(75.1,RAO,"BAx",0) = ICD Diagnosis^SC^AO^IR^EC^MST^HNC
"RTN","RABWPCE",8,0)
 ; Set an Order" node for Billing Replacement
"RTN","RABWPCE",9,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",1,"ORD REFERENCE")=$P(^RAO(75.1,RAO,0),U,7)
"RTN","RABWPCE",10,0)
 I '$D(^RAO(75.1,RAO,"BA")) Q
"RTN","RABWPCE",11,0)
 N RA1,RA2,RA3,RACNT,RADXTYP,RAIND
"RTN","RABWPCE",12,0)
 ;
"RTN","RABWPCE",13,0)
 ; Create Temp. Array of the Clinical Indicators.
"RTN","RABWPCE",14,0)
 S RAIND(1)="SC",RAIND(2)="AO",RAIND(3)="IR"
"RTN","RABWPCE",15,0)
 S RAIND(4)="EC",RAIND(5)="MST",RAIND(6)="HNC",RAIND(7)="CV"
"RTN","RABWPCE",16,0)
 ;
"RTN","RABWPCE",17,0)
 S RACNT=0
"RTN","RABWPCE",18,0)
 S RA2=^RAO(75.1,RAO,"BA") D DXPL ; Primary Ordering ICD Dx.
"RTN","RABWPCE",19,0)
 S RA1=0
"RTN","RABWPCE",20,0)
 F  S RA1=$O(^RAO(75.1,RAO,"BAS",RA1)) Q:+RA1<1  S RA2=^(RA1,0) D DXPL
"RTN","RABWPCE",21,0)
 Q
"RTN","RABWPCE",22,0)
 ;
"RTN","RABWPCE",23,0)
DXPL ; Create "DX/PL" Node.
"RTN","RABWPCE",24,0)
 S RACNT=RACNT+1
"RTN","RABWPCE",25,0)
 S RADXTYP=$S(RACNT=1:"P",1:"S")
"RTN","RABWPCE",26,0)
 S ^TMP("RAPXAPI",$J,"DX/PL",RACNT,"DIAGNOSIS")=$P(RA2,U)
"RTN","RABWPCE",27,0)
 S ^TMP("RAPXAPI",$J,"DX/PL",RACNT,"PRIMARY")=RADXTYP
"RTN","RABWPCE",28,0)
 ;F RA3=2:1:8 I $P(RA2,U,RA3)'="" D
"RTN","RABWPCE",29,0)
 F RA3=2:1:8 D
"RTN","RABWPCE",30,0)
 .S ^TMP("RAPXAPI",$J,"DX/PL",RACNT,"PL "_RAIND(RA3-1))=$P(RA2,U,RA3)
"RTN","RABWPCE",31,0)
 Q
"RTN","RABWPCE",32,0)
 ;
"RTN","RABWPCE",33,0)
PROCDX(X) ; Called from PROC^RAPCE.
"RTN","RABWPCE",34,0)
 ; Add Ordering ICD Dx to Procedure for Billing Purposes.
"RTN","RABWPCE",35,0)
 N I
"RTN","RABWPCE",36,0)
 F I=1:1:8 Q:'$D(^TMP("RAPXAPI",$J,"DX/PL",I,"DIAGNOSIS"))  D
"RTN","RABWPCE",37,0)
 .I I=1 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"DIAGNOSIS")=^("DIAGNOSIS") Q
"RTN","RABWPCE",38,0)
 .S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"DIAGNOSIS "_I)=^("DIAGNOSIS")
"RTN","RABWPCE",39,0)
 Q
"RTN","RABWRTE")
0^7^B8306601
"RTN","RABWRTE",1,0)
RABWRTE ;HISC/SM - Billing Aware Report Entry ;11/19/04  12:35
"RTN","RABWRTE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**;Mar 16,1998
"RTN","RABWRTE",3,0)
 Q
"RTN","RABWRTE",4,0)
ELOC ;Enter Inter. Img. Location
"RTN","RABWRTE",5,0)
 ; called from IN1^RARTE4 & NOEDIT^RARTRPV1
"RTN","RABWRTE",6,0)
 N RACLC0,RADT0,RAERR,RAXITYPI,RAXITYPE,RAIIL
"RTN","RABWRTE",7,0)
 ; RACLC0 = current switchedTo/signedOn loc's 0 node
"RTN","RABWRTE",8,0)
 ; RADT0 = exam's DT 0 node
"RTN","RABWRTE",9,0)
 ; RAXITYP = exam's Imaging Type in text
"RTN","RABWRTE",10,0)
 ; RAIIL = value of current report's Int. Img Loc ien
"RTN","RABWRTE",11,0)
 S RAERR=0
"RTN","RABWRTE",12,0)
 S RACLC0=$G(^RA(79.1,+$G(RAMLC),0)) Q:RACLC0=""
"RTN","RABWRTE",13,0)
 S RAIIL=$G(^RARPT(RARPT,"BA"))
"RTN","RABWRTE",14,0)
 S RADT0=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RABWRTE",15,0)
 S RAXITYPI=$P(RADT0,U,2) ; Exam's Img Type, Internal
"RTN","RABWRTE",16,0)
 S RAXITYPE=$P(^RA(79.2,+RAXITYPI,0),U) ; Exam's Img Type, External
"RTN","RABWRTE",17,0)
 ;
"RTN","RABWRTE",18,0)
 ; skip checks if there's Int. Img Loc data and its Credit Method is ok
"RTN","RABWRTE",19,0)
 I RAIIL,$P($G(^RA(79.1,+RAIIL,0)),U,21)'=3 G INPUT
"RTN","RABWRTE",20,0)
 ;
"RTN","RABWRTE",21,0)
 I $P(RACLC0,U,21)=3 D
"RTN","RABWRTE",22,0)
 . W !!?5,$C(7),"Your signed-on or switched-to location is ",$P($G(RACCESS(DUZ,"LOC",+$G(RAMLC))),U,2),",",!?5,"which has a Credit Method of '",$P($P($P(^DD(79.1,21,0),U,3),"3:",2),";"),"'."
"RTN","RABWRTE",23,0)
 . W !,?5,"This Credit Method does not allow for Interpretation work.",!
"RTN","RABWRTE",24,0)
 . S RAERR=1
"RTN","RABWRTE",25,0)
 I $P(RACLC0,U,6)'=$P(RADT0,U,2) D
"RTN","RABWRTE",26,0)
 . W !!?5,$C(7),"Your signed-on or switched-to location is ",$P($G(RACCESS(DUZ,"LOC",+$G(RAMLC))),U,2),",",!?5,"which has an Imaging Type of '",$P(^RA(79.2,+$P(RACLC0,U,6),0),U),"'."
"RTN","RABWRTE",27,0)
 . W !?5,"But the exam has an Imaging Type of '"_RAXITYPE,"'."
"RTN","RABWRTE",28,0)
 . S RAERR=2
"RTN","RABWRTE",29,0)
 I RAERR D
"RTN","RABWRTE",30,0)
 . W !!?5,"You may optionally switch your current location to a location that",!?5,"allows either Regular or Interpretation credit.  Then that location"
"RTN","RABWRTE",31,0)
 . W !?5,"will be used as the default value to this field.",!
"RTN","RABWRTE",32,0)
INPUT S DA=RARPT
"RTN","RABWRTE",33,0)
 S DIE="^RARPT("
"RTN","RABWRTE",34,0)
 S DR=86 S:'RAERR DR=DR_"//"_$P(RACCESS(DUZ,"LOC",+RAMLC),U,2)
"RTN","RABWRTE",35,0)
 W ! D ^DIE W !
"RTN","RABWRTE",36,0)
 Q
"RTN","RABWRTE",37,0)
SIIL() ; Screen Interpreting Imaging Location
"RTN","RABWRTE",38,0)
 ; called by DD(74,86's DIC("S")
"RTN","RABWRTE",39,0)
 ; check file 79.1 img loc's credit method 
"RTN","RABWRTE",40,0)
 I $P(^RA(79.1,+Y,0),U,21)=3 Q 0 ;Img Loc's Credit Meth is Tech Only
"RTN","RABWRTE",41,0)
 I '$D(RADFN) Q 1 ; can't continue, thus default to ok
"RTN","RABWRTE",42,0)
 I '$D(RADTI) Q 1 ; can't continue, thus default to ok
"RTN","RABWRTE",43,0)
 ; check file 79.1 img loc against case's imaging location
"RTN","RABWRTE",44,0)
 I $P(^RA(79.1,+Y,0),U,6)'=$P(^RADPT(RADFN,"DT",RADTI,0),U,2) Q 0
"RTN","RABWRTE",45,0)
 ; check file 79.1 img loc's INACTIVE dt against case's exam date
"RTN","RABWRTE",46,0)
 I $P(^RA(79.1,+Y,0),U,19),$G(RADTE)]$P(^RA(79.1,+Y,0),U,19) Q 0
"RTN","RABWRTE",47,0)
 Q 1
"RTN","RABWUTL")
0^8^B1548732
"RTN","RABWUTL",1,0)
RABWUTL ;HISC/SM - Billing Aware utilities ;3/24/04
"RTN","RABWUTL",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**;Mar 16,1998
"RTN","RABWUTL",3,0)
 Q
"RTN","RABWUTL",4,0)
ODX(RA) ;ordering diagnosis
"RTN","RABWUTL",5,0)
 ;RA = ien file 75.1
"RTN","RABWUTL",6,0)
 ;RAX(n) = ien80^SC^AO^IR^EC^MST^HNC^CV where pieces 2+ has 1=Y
"RTN","RABWUTL",7,0)
 ;N RAX,RA1,I,J,RABA,RA751,X
"RTN","RABWUTL",8,0)
 S RA751=$S($D(RAORD0):RAORD0,1:^RAO(75.1,RA,0))
"RTN","RABWUTL",9,0)
 D GETDX
"RTN","RABWUTL",10,0)
 D WRTDX
"RTN","RABWUTL",11,0)
 Q
"RTN","RABWUTL",12,0)
GETDX ; get DX and Clin. Indicators from file 75.1
"RTN","RABWUTL",13,0)
 Q:'$D(^RAO(75.1,RA,"BA"))  S RAX(1)=^("BA")
"RTN","RABWUTL",14,0)
 S I=0,RA1=1
"RTN","RABWUTL",15,0)
 F  S I=$O(^RAO(75.1,RA,"BAS",I)) Q:'I  D
"RTN","RABWUTL",16,0)
 . S RA1=RA1+1
"RTN","RABWUTL",17,0)
 . S RAX(RA1)=^RAO(75.1,RA,"BAS",I,0)
"RTN","RABWUTL",18,0)
 .Q
"RTN","RABWUTL",19,0)
 Q
"RTN","RABWUTL",20,0)
WRTDX ; write DX and Clin. Inds.
"RTN","RABWUTL",21,0)
 Q:'$O(RAX(0))
"RTN","RABWUTL",22,0)
 W !,"Ordering Diagnoses:"
"RTN","RABWUTL",23,0)
 S I=0
"RTN","RABWUTL",24,0)
 F  S I=$O(RAX(I)) Q:'I  D
"RTN","RABWUTL",25,0)
 . W !?2,$$GET1^DIQ(80,+RAX(I),.01),?10,$$GET1^DIQ(80,+RAX(I),3)
"RTN","RABWUTL",26,0)
 . S X=$P(RAX(I),U,2,8)
"RTN","RABWUTL",27,0)
 . Q:X'["1"
"RTN","RABWUTL",28,0)
 . W !,?10,"Clinical Indicator(s):  "
"RTN","RABWUTL",29,0)
 . F J=1:1:7 I $P(X,U,J) W $S(J=1:"SC",J=2:"AO",J=3:"IR",J=4:"EC",J=5:"MST",J=6:"HNC",1:"CV") I J<7,$P(X,U,J+1) W ","
"RTN","RABWUTL",30,0)
 . Q
"RTN","RABWUTL",31,0)
 Q
"RTN","RAO7NEW")
0^9^B34874778
"RTN","RAO7NEW",1,0)
RAO7NEW ;HISC/FPT - Create entry in OE/RR Order file (100) ;11/16/98  15:10
"RTN","RAO7NEW",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,10,18,41**;Mar 16, 1998 
"RTN","RAO7NEW",3,0)
 ;
"RTN","RAO7NEW",4,0)
 ; This routine invokes IA #1300-A, #2083, #10082
"RTN","RAO7NEW",5,0)
 ;last modification for P18 by SS July 5,2000
"RTN","RAO7NEW",6,0)
EN1(RAOIFN) ; 'RAOIFN' is the ien in file 75.1  
"RTN","RAO7NEW",7,0)
 ; In RA*5.0*18 this call is used when procedure CHANGED during registration, adding to visit and editing 
"RTN","RAO7NEW",8,0)
 ; New vars & define the following variables: RAECH, RAECH array & RAHLFS
"RTN","RAO7NEW",9,0)
 N A,B,DFN,RA,RA0,RACNT,RACPT,RADFN,RAECH,RAHL7DT,RAHLFS,RALOC,RANATURE
"RTN","RAO7NEW",10,0)
 N RAPRIOR,RAPROC,RAR,RARMBED,RATAB,RAVAR,RAWARD,RAXIT
"RTN","RAO7NEW",11,0)
 N RAORORDN,RAD70SB,RAORDCTR ;P18, OR Order No, "DT" of #70, Orderctrl,subscr of 70
"RTN","RAO7NEW",12,0)
 N RABWDX,RABWDX1 ; Billing Awareness Project.
"RTN","RAO7NEW",13,0)
 S RAORORDN="",RAD70SB=0,RAORDCTR="SN" ;P18, these sets mean that it's request mode (not the case, when procedure changed during registering or editing) 
"RTN","RAO7NEW",14,0)
 I $D(RAREGMOD) S RAORORDN=$P(^RAO(75.1,RAOIFN,0),"^",7)_"^OR",RAORDCTR="XX" ;P18,if register mode (see RAREG2 for EN1^RAO7XX)
"RTN","RAO7NEW",15,0)
 S RATAB=1 D EN1^RAO7UTL
"RTN","RAO7NEW",16,0)
 S RA0=$G(^RAO(75.1,RAOIFN,0)) Q:RA0']""
"RTN","RAO7NEW",17,0)
SS2 I RAORDCTR="XX" D UPDTRA0^RAO7XX ;P18, update RA0 with #70 inf, sets RAD70SB, that provide D2^D3 of #70
"RTN","RAO7NEW",18,0)
 S RADFN=+RA0,RAR=$G(^RAO(75.1,RAOIFN,"R"))
"RTN","RAO7NEW",19,0)
SS3 I RAORDCTR="XX",RAD70SB'=0 S RAR=$G(^RADPT(+RA0,"DT",$P(RAD70SB,"^",1),"P",$P(RAD70SB,"^",2),"R")) ;P18
"RTN","RAO7NEW",20,0)
 ;
"RTN","RAO7NEW",21,0)
 ;*Billing Awarenes Project:
"RTN","RAO7NEW",22,0)
 ;   Retrieve Ordering ICD Dx data to Send to CPRS.
"RTN","RAO7NEW",23,0)
 D SENDCPRS^RABWORD1(RAOIFN)
"RTN","RAO7NEW",24,0)
 ;*
"RTN","RAO7NEW",25,0)
 S RAVAR="RATMP(",RAVARBLE="RATMP"
"RTN","RAO7NEW",26,0)
 ; msh
"RTN","RAO7NEW",27,0)
 S @(RAVAR_RATAB_")")=$$MSH^RAO7UTL("ORM^O01") ;P18
"RTN","RAO7NEW",28,0)
 ; pid
"RTN","RAO7NEW",29,0)
 S RATAB=RATAB+1,@(RAVAR_RATAB_")")=$$PID^RAO7UTL(RA0)
"RTN","RAO7NEW",30,0)
 ; pv1
"RTN","RAO7NEW",31,0)
 S RATAB=RATAB+1,@(RAVAR_RATAB_")")=$$PV1^RAO7UTL(RA0)
"RTN","RAO7NEW",32,0)
 K RA("PV1"),VAIP,RABWVSIT
"RTN","RAO7NEW",33,0)
 ; orc
"RTN","RAO7NEW",34,0)
 S RAHL7DT=$$HLDATE^HLFNC($P(RA0,U,21),"TS"),RAPRIOR=$P(RA0,U,6)
"RTN","RAO7NEW",35,0)
 S RAPRIOR=$S(RAPRIOR=1:"S",RAPRIOR=2:"A",RAPRIOR=9:"R",1:"")
"RTN","RAO7NEW",36,0)
 S RA("ORC",7)="^^^"_RAHL7DT_"^^"_RAPRIOR
"RTN","RAO7NEW",37,0)
 S RA("ORC",10)=$P(RA0,U,15),RA("ORC",12)=$P(RA0,U,14)
"RTN","RAO7NEW",38,0)
 S RA("ORC",11)=$P(RA0,U,8) ;approving radiologist
"RTN","RAO7NEW",39,0)
 S RA("ORC",15)=$$HLDATE^HLFNC($P(RA0,"^",16),"TS")
"RTN","RAO7NEW",40,0)
 S RANATURE="" I $L($P(RA0,"^",26)) S RANATURE=$$UP^XLFSTR($P(RA0,"^",26))_RAECH(1)_$$EXTERNAL^DILFD(75.1,26,"",$P(RA0,"^",26))
"RTN","RAO7NEW",41,0)
 F I=1,2 I '$L($P(RANATURE,"^",I)) S RANATURE="S"_RAECH(1)_"SERVICE CORRECTION"
"RTN","RAO7NEW",42,0)
 S RA("ORC",16)=RANATURE_RAECH(1)_"99ORN"_RAECH(1)_RAECH(1)_RAECH(1)
"RTN","RAO7NEW",43,0)
 S RATAB=RATAB+1
"RTN","RAO7NEW",44,0)
 ;P18, next line was modified
"RTN","RAO7NEW",45,0)
SS4 S @(RAVAR_RATAB_")")="ORC"_RAHLFS_RAORDCTR_RAHLFS_RAORORDN_RAHLFS_RAOIFN_RAECH(1)_"RA"_$$STR^RAO7UTL(4)_RA("ORC",7)_$$STR^RAO7UTL(3)_RA("ORC",10)_RAHLFS_RA("ORC",11)_RAHLFS_RA("ORC",12)_$$STR^RAO7UTL(3)_RA("ORC",15)_RAHLFS_RA("ORC",16)
"RTN","RAO7NEW",46,0)
 K RA("ORC")
"RTN","RAO7NEW",47,0)
 ; obr
"RTN","RAO7NEW",48,0)
 S RAPROC(0)=$G(^RAMIS(71,+$P(RA0,U,2),0)),RAPROC(9)=+$P(RAPROC(0),U,9)
"RTN","RAO7NEW",49,0)
 S RACPT(0)=$$NAMCODE^RACPTMSC(RAPROC(9),DT)
"RTN","RAO7NEW",50,0)
 S RA("OBR",4)=$P(RACPT(0),U)_U_$P(RACPT(0),U,2)_U_"CPT4"_U_+$P(RA0,U,2)_U_$P(RAPROC(0),U)_"^99RAP"
"RTN","RAO7NEW",51,0)
 S RA("OBR",12)=""
"RTN","RAO7NEW",52,0)
 S:$P(RA0,U,24)]""&("Yy"[$P(RA0,U,24)) RA("OBR",12)="isolation"
"RTN","RAO7NEW",53,0)
 S RA("OBR",18)=""
"RTN","RAO7NEW",54,0)
SS5 I RAORDCTR="XX",RAD70SB'=0 D MODIF70^RAO7XX($P(RAD70SB,"^",1),$P(RAD70SB,"^",2))  G CONTIN ;P18 by SS
"RTN","RAO7NEW",55,0)
 I $O(^RAO(75.1,RAOIFN,"M",0)) D
"RTN","RAO7NEW",56,0)
 . S (A,RAXIT)=0
"RTN","RAO7NEW",57,0)
 . F  S A=$O(^RAO(75.1,RAOIFN,"M",A)) Q:A'>0  D  Q:RAXIT
"RTN","RAO7NEW",58,0)
 .. S B(0)=$G(^RAO(75.1,RAOIFN,"M",A,0))
"RTN","RAO7NEW",59,0)
 .. S B(1)=$P($G(^RAMIS(71.2,+B(0),0)),U)
"RTN","RAO7NEW",60,0)
 .. I $L(RA("OBR",18))+$L(B(1))>60 S RAXIT=1 Q
"RTN","RAO7NEW",61,0)
 .. S RA("OBR",18)=$G(RA("OBR",18))_B(1)_RAECH(2)
"RTN","RAO7NEW",62,0)
 .. Q
"RTN","RAO7NEW",63,0)
 . S RA("OBR",18)=$P(RA("OBR",18),RAECH(2),1,$L(RA("OBR",18),RAECH(2))-1)
"RTN","RAO7NEW",64,0)
 . Q
"RTN","RAO7NEW",65,0)
CONTIN S RALOC(0)=$G(^RA(79.1,+$P(RA0,U,20),0))
"RTN","RAO7NEW",66,0)
 S RA("OBR",19)=+$P(RA0,U,20)_U_$P($G(^SC(+RALOC(0),0)),U)
"RTN","RAO7NEW",67,0)
 S:+RA("OBR",19)'>0 RA("OBR",19)=""
"RTN","RAO7NEW",68,0)
 S RA("OBR",30)=$S($P(RA0,U,19)="":"","Aa"[$P(RA0,U,19):"WALK","Pp"[$P(RA0,U,19):"PORT","Ss"[$P(RA0,U,19):"CART","Ww"[$P(RA0,U,19):"WHLC",1:"")
"RTN","RAO7NEW",69,0)
 S RATAB=RATAB+1,@(RAVAR_RATAB_")")="OBR"_$$STR^RAO7UTL(4)_RA("OBR",4)_$$STR^RAO7UTL(8)_RA("OBR",12)_$$STR^RAO7UTL(6)_RA("OBR",18)_RAHLFS_RA("OBR",19)_$$STR^RAO7UTL(11)_RA("OBR",30) K RA("OBR")
"RTN","RAO7NEW",70,0)
 ; nte
"RTN","RAO7NEW",71,0)
SS1 I RAORDCTR="XX",RAD70SB'=0 D  ;P18 nte segment
"RTN","RAO7NEW",72,0)
 . N RA18Z S RA18Z=$$GETTCOM^RAUTL11(+RA0,$P(RAD70SB,"^",1),$P(RAD70SB,"^",2))
"RTN","RAO7NEW",73,0)
 . I RA18Z="" K RA18Z Q
"RTN","RAO7NEW",74,0)
 . S RATAB=RATAB+1,@(RAVAR_RATAB_")")="NTE"_RAHLFS_"16"_RAHLFS_"L"_RAHLFS_$E(RA18Z,1,245)
"RTN","RAO7NEW",75,0)
 . K RA18Z Q
"RTN","RAO7NEW",76,0)
 ; obx
"RTN","RAO7NEW",77,0)
 ;P18 next line was modified
"RTN","RAO7NEW",78,0)
SS6 S (A,RACNT)=0 F  S A=$S(RAORDCTR="XX"&(RAD70SB'=0):$O(^RADPT(+RA0,"DT",$P(RAD70SB,"^",1),"P",$P(RAD70SB,"^",2),"H",A)),1:$O(^RAO(75.1,RAOIFN,"H",A))) Q:A'>0  D
"RTN","RAO7NEW",79,0)
SS7 . S RACNT=RACNT+1,RATAB=RATAB+1
"RTN","RAO7NEW",80,0)
 . ;P18 next line was modified
"RTN","RAO7NEW",81,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TX"_RAHLFS_"2000.02^Clinical History^AS4"_RAHLFS_"1"_RAHLFS_$S(RAORDCTR="XX"&(RAD70SB'=0):$G(^RADPT(+RA0,"DT",$P(RAD70SB,"^",1),"P",$P(RAD70SB,"^",2),"H",A,0)),1:$G(^RAO(75.1,RAOIFN,"H",A,0)))
"RTN","RAO7NEW",82,0)
 . Q
"RTN","RAO7NEW",83,0)
 S DFN=RADFN D DEM^VADPT
"RTN","RAO7NEW",84,0)
 I $P(VADM(5),U)]"",("Ff"[$P(VADM(5),U)) D
"RTN","RAO7NEW",85,0)
 . S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",86,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TX"_RAHLFS_"2000.33^Pregnant^AS4"_$$STR^RAO7UTL(2)_$S($P(RA0,U,13)="":"","Yy"[$P(RA0,U,13):"Y","Nn"[$P(RA0,U,13):"N",1:"U")
"RTN","RAO7NEW",87,0)
 . Q
"RTN","RAO7NEW",88,0)
 I +$P(RA0,U,9) D
"RTN","RAO7NEW",89,0)
 . S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",90,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"CE"_RAHLFS_"34^Contract Sharing/Source^99DD"_$$STR^RAO7UTL(2)_$P(RA0,U,9)_RAECH(1)_$P($G(^DIC(34,+$P(RA0,U,9),0)),U)
"RTN","RAO7NEW",91,0)
 . Q
"RTN","RAO7NEW",92,0)
 I RAR]"" D
"RTN","RAO7NEW",93,0)
 . S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",94,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TX"_RAHLFS_"^Research Source^"_$$STR^RAO7UTL(2)_RAR
"RTN","RAO7NEW",95,0)
 . Q
"RTN","RAO7NEW",96,0)
 I +$P(RA0,U,12) D
"RTN","RAO7NEW",97,0)
 . S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",98,0)
 . S @(RAVAR_RATAB_")")="OBX"_RAHLFS_RACNT_RAHLFS_"TS"_RAHLFS_"^Pre Op Scheduled Date/Time^"_$$STR^RAO7UTL(2)_$$HLDATE^HLFNC($P(RA0,U,12),"TS")
"RTN","RAO7NEW",99,0)
 . Q
"RTN","RAO7NEW",100,0)
 ; DG1 Segment
"RTN","RAO7NEW",101,0)
 ;*Billing Awareness Project:
"RTN","RAO7NEW",102,0)
 ;   Send Ordering ICD Dx data to CPRS: DG1 and related ZCL segments.
"RTN","RAO7NEW",103,0)
 I $D(RABWDX1) D
"RTN","RAO7NEW",104,0)
 . N RA1 S RA1=""
"RTN","RAO7NEW",105,0)
 . F  S RA1=$O(RABWDX1(RA1)) Q:RA1=""  D
"RTN","RAO7NEW",106,0)
 .. S RATAB=RATAB+1,RACNT=RACNT+1
"RTN","RAO7NEW",107,0)
 .. S @(RAVAR_RATAB_")")=RABWDX1(RA1)
"RTN","RAO7NEW",108,0)
 . Q
"RTN","RAO7NEW",109,0)
 ;*
"RTN","RAO7NEW",110,0)
 K VA,VADM,VAERR D MSG^RAO7UTL("RA EVSEND OR",.@RAVARBLE)
"RTN","RAO7NEW",111,0)
 Q
"RTN","RAO7RON")
0^10^B14133845
"RTN","RAO7RON",1,0)
RAO7RON ;HISC/GJC- Request message from OE/RR. (frontdoor) ;2/2/98  12:34
"RTN","RAO7RON",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**41**;Mar 16, 1998
"RTN","RAO7RON",3,0)
 ;
"RTN","RAO7RON",4,0)
 ;------------------------- Variable List -------------------------------
"RTN","RAO7RON",5,0)
 ; RADATA=HL7 data minus seg. hdr    RAHDR=Segment header
"RTN","RAO7RON",6,0)
 ; RAHLFS="|"                        RAMSG=HL7 message passed in
"RTN","RAO7RON",7,0)
 ; RAOBR12=danger code               RAOBR18=modifier
"RTN","RAO7RON",8,0)
 ; RAOBR19=hosp. loc. pntr (44)      RAOBR30=trans. mode
"RTN","RAO7RON",9,0)
 ; RAOBR4=univ. trans. mode          RAOBX2=format of observ. value
"RTN","RAO7RON",10,0)
 ; RAOBX3=observ. ID                 RAOBX5=observ. value
"RTN","RAO7RON",11,0)
 ; RAORC1=order control              RAORC10=entered by (200)
"RTN","RAO7RON",12,0)
 ; RAORC11=approving rad/nm phys (for some procedures only)
"RTN","RAO7RON",13,0)
 ; RAORC12=ordering provider (200)   RAORC15=order effective D/T
"RTN","RAO7RON",14,0)
 ; RAORC16=order control reason      RAORC2=placer order #_"^OR"
"RTN","RAO7RON",15,0)
 ; RAORC3=filler order #_"^RA"       RAORC7=start dt/freq. of service
"RTN","RAO7RON",16,0)
 ; RAPID3=patient ID                 RAPID5=patient name (2)
"RTN","RAO7RON",17,0)
 ; RAPV119=visit #                   RAPV12=patient class
"RTN","RAO7RON",18,0)
 ; RAPV13=patient location (44)      RASEG=message seg. including header
"RTN","RAO7RON",19,0)
 ; ----------------------------------------------------------------------
"RTN","RAO7RON",20,0)
EN1(RAMSG) ; Pass in the message from RAO7RO.  Decipher information.
"RTN","RAO7RON",21,0)
 D BRKOUT^RAO7UTL1
"RTN","RAO7RON",22,0)
 ; defines RAORC2, RAORC3, RAPID3, RAPID5, RAMSH3 & RADIV(.119)
"RTN","RAO7RON",23,0)
 S (RAERR,RAWP,RALINEX)=0,RACLIN=1 K ^TMP("RAWP",$J)
"RTN","RAO7RON",24,0)
 F  S RALINEX=$O(RAMSG(RALINEX)) Q:RALINEX'>0  D  Q:RAERR
"RTN","RAO7RON",25,0)
 . S RASEG=$G(RAMSG(RALINEX)) Q:$P(RASEG,RAHLFS)="MSH"  ; quit if MSH segment
"RTN","RAO7RON",26,0)
 . S RAHDR=$P(RASEG,RAHLFS),RADATA=$P(RASEG,RAHLFS,2,999)
"RTN","RAO7RON",27,0)
 . D @$S(RAHDR="PID":"PID",RAHDR="PV1":"PV1",RAHDR="ORC":"ORC",RAHDR="OBR":"OBR^RAO7RON1",RAHDR="OBX":"OBX^RAO7RON1",RAHDR="DG1":"GETCPRS^RABWORD1",RAHDR="ZCL":"GETCPRS^RABWORD1",1:"ERR")
"RTN","RAO7RON",28,0)
 . Q
"RTN","RAO7RON",29,0)
 ; if RACLIN=1 clin hist. text did not pass send REJECT mssg in RAO7RO!
"RTN","RAO7RON",30,0)
 S RANEW(75.1,"+1,",18)=RALDT
"RTN","RAO7RON",31,0)
 Q
"RTN","RAO7RON",32,0)
PID ; breakdown the 'PID' segment
"RTN","RAO7RON",33,0)
 S RAERR=$$EN2^RAO7VLD(2,RAPID3,RAPID5) S:RAERR RAERR=2
"RTN","RAO7RON",34,0)
 I 'RAERR S RANEW(75.1,"+1,",.01)=RAPID3
"RTN","RAO7RON",35,0)
 Q
"RTN","RAO7RON",36,0)
PV1 ; breakdown the 'PV1' segment
"RTN","RAO7RON",37,0)
 S RAPV12=$P(RADATA,RAHLFS,2)
"RTN","RAO7RON",38,0)
 S RAERR=$$EN1^RAO7VLD(75.1,4,"E",RAPV12,"RASULT","") S:RAERR RAERR=27 Q:RAERR
"RTN","RAO7RON",39,0)
 S RANEW(75.1,"+1,",4)=RAPV12
"RTN","RAO7RON",40,0)
 S RAPV13=$P(RADATA,RAHLFS,3)
"RTN","RAO7RON",41,0)
 S RAERR=$$EN3^RAO7VLD(44,+RAPV13) S:RAERR RAERR=3 Q:RAERR
"RTN","RAO7RON",42,0)
 S RANEW(75.1,"+1,",22)=+RAPV13
"RTN","RAO7RON",43,0)
 I RAPV12="I",$P(^SC($P(RAPV13,U,1),0),U,3)'="W" S RAERR=9 Q:RAERR
"RTN","RAO7RON",44,0)
 I RAPV12="O",$P(^SC($P(RAPV13,U,1),0),U,3)="W" S RAERR=9 Q:RAERR
"RTN","RAO7RON",45,0)
 S RAPV119=$P(RADATA,RAHLFS,19)
"RTN","RAO7RON",46,0)
 Q
"RTN","RAO7RON",47,0)
ORC ; breakdown the 'ORC' segment
"RTN","RAO7RON",48,0)
 ; RAORC7D is: timestamp HL7 format
"RTN","RAO7RON",49,0)
 ; RAORC7P is: priority/urgency
"RTN","RAO7RON",50,0)
 S:+RAORC2'>0 RAERR=16 Q:RAERR
"RTN","RAO7RON",51,0)
 S RANEW(75.1,"+1,",7)=+RAORC2
"RTN","RAO7RON",52,0)
 S RANEW(75.1,"+1,",5)=5
"RTN","RAO7RON",53,0)
 S RAORC7=$P(RADATA,RAHLFS,7)
"RTN","RAO7RON",54,0)
 S RAORC7D=$P(RAORC7,RAECH(1),4)
"RTN","RAO7RON",55,0)
 S RAORC7D=$$FMDATE^HLFNC(RAORC7D)
"RTN","RAO7RON",56,0)
 S RAERR=$$EN1^RAO7VLD(75.1,21,"E",RAORC7D,"RASULT","") S:RAERR RAERR=28 Q:RAERR
"RTN","RAO7RON",57,0)
 S RANEW(75.1,"+1,",21)=RAORC7D
"RTN","RAO7RON",58,0)
 S X=$P(RAORC7,RAECH(1),6)
"RTN","RAO7RON",59,0)
 S RAORC7P=$S(X="S":1,X="A":2,X="R":9,1:"") I +RAORC7P'>0 S RAERR=5 Q
"RTN","RAO7RON",60,0)
 S RANEW(75.1,"+1,",6)=RAORC7P
"RTN","RAO7RON",61,0)
 S RAORC10=$P(RADATA,RAHLFS,10)
"RTN","RAO7RON",62,0)
 S RAERR=$$EN3^RAO7VLD(200,RAORC10) S:RAERR RAERR=4 Q:RAERR
"RTN","RAO7RON",63,0)
 S RANEW(75.1,"+1,",15)=RAORC10
"RTN","RAO7RON",64,0)
 S RAORC11=$P(RADATA,RAHLFS,11) ;approving rad/nm phys for some proc's
"RTN","RAO7RON",65,0)
 I $G(RAORC11) S RAERR=$$EN3^RAO7VLD(200,RAORC11) S:RAERR RAERR=36 Q:RAERR
"RTN","RAO7RON",66,0)
 I $G(RAORC11) S RANEW(75.1,"+1,",8)=RAORC11
"RTN","RAO7RON",67,0)
 S RAORC12=$P(RADATA,RAHLFS,12)
"RTN","RAO7RON",68,0)
 S RAERR=$$EN3^RAO7VLD(200,RAORC12) S:RAERR RAERR=6 Q:RAERR
"RTN","RAO7RON",69,0)
 S RANEW(75.1,"+1,",14)=RAORC12
"RTN","RAO7RON",70,0)
 S RAORC15=$P(RADATA,RAHLFS,15)
"RTN","RAO7RON",71,0)
 S RAORC15=$$FMDATE^HLFNC(RAORC15)
"RTN","RAO7RON",72,0)
 ;The order entered dt/time validity ck results are ignored because we
"RTN","RAO7RON",73,0)
 ;have never been able to determine why FileMan erroneously rejects
"RTN","RAO7RON",74,0)
 ;some date/times in a Silent FM call.  We now assume this date is OK.
"RTN","RAO7RON",75,0)
 S RAERR=$$EN1^RAO7VLD(75.1,16,"E",RAORC15,"RASULT","") S:RAERR RAERR=35
"RTN","RAO7RON",76,0)
 ;Q:RAERR
"RTN","RAO7RON",77,0)
 I RAERR D  S RAERR=0
"RTN","RAO7RON",78,0)
 . N I,RAX,RAVARS,RAERRDT
"RTN","RAO7RON",79,0)
 . S RAX=$G(^TMP("DIERR",$J,1,"TEXT",1))
"RTN","RAO7RON",80,0)
 . S RAERRDT=$$NOW^XLFDT()
"RTN","RAO7RON",81,0)
 . F I="RAX","RAORC15","RAERRDT","RAERR" S RAVARS(I)=""
"RTN","RAO7RON",82,0)
 . S:$D(X) RAVARS("X")="" S:$D(%DT) RAVARS("%DT")=""
"RTN","RAO7RON",83,0)
 . S:$D(%DT(0)) RAVARS("%DT(0)")=""
"RTN","RAO7RON",84,0)
 . ;S RAVARS("RAX")="",RAVARS("RAORC15")="",RAVARS("RAERRDT")="",RAVARS("RAERR")=""
"RTN","RAO7RON",85,0)
 . D EN^ORERR("RAD MYSTERY ERROR",.RAMSG,.RAVARS)
"RTN","RAO7RON",86,0)
 . Q
"RTN","RAO7RON",87,0)
 S RANOW=$$NOW^XLFDT() I RANOW<RAORC15 S RAERR=7 Q
"RTN","RAO7RON",88,0)
 S RANEW(75.1,"+1,",16)=RAORC15
"RTN","RAO7RON",89,0)
 Q
"RTN","RAO7RON",90,0)
ERR ; error control - file 'soft' errors with CPRS
"RTN","RAO7RON",91,0)
 N RAVAR S RAVAR("XQY0")=""
"RTN","RAO7RON",92,0)
 D ERR^RAO7UTL("HL7 message with unknown segment header",.RAMSG,.RAVAR)
"RTN","RAO7RON",93,0)
 Q
"RTN","RAORD1")
0^12^B47171265
"RTN","RAORD1",1,0)
RAORD1 ;HISC/CAH - AISC/RMO-Request An Exam ; 01/21/05 11:25am
"RTN","RAORD1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,45,41**;Mar 16, 1998
"RTN","RAORD1",3,0)
 ;*Billing Awareness Project:
"RTN","RAORD1",4,0)
 ; RABWDX Array: ICD Diagnosis^SC^AO^IR^EC^MST^HNC
"RTN","RAORD1",5,0)
 ;  RABWDX is used in RABWORD* and RABWPCE*. 
"RTN","RAORD1",6,0)
 K RABWDX
"RTN","RAORD1",7,0)
 ;*
"RTN","RAORD1",8,0)
 S RAPKG="" N RAPTLKUP,RAGMTS,RACOPYOR
"RTN","RAORD1",9,0)
 G ADDORD:$D(RAVSTFLG)&($D(RALIFN))&($D(RAPIFN))
"RTN","RAORD1",10,0)
 I '$D(RAREGFLG),'$D(RAVSTFLG) N RAPTLOCK K RAWARD D  G:'RAPTLKUP Q
"RTN","RAORD1",11,0)
PAT .S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC
"RTN","RAORD1",12,0)
 .I Y<0 S RAPTLKUP=0 Q
"RTN","RAORD1",13,0)
 .I $$ORVR^RAORDU()'<3 D  G:'RAPTLOCK PAT
"RTN","RAORD1",14,0)
 ..S RAPTLOCK=$$LK^RAUTL19(+Y_";DPT(")
"RTN","RAORD1",15,0)
 ..Q
"RTN","RAORD1",16,0)
 .S (DFN,RADFN)=+Y,(VA200,RAPTLKUP)=1
"RTN","RAORD1",17,0)
 .W ! D IN5^VADPT S:VAIP(1) RAWARD=$P(VAIP(5),"^",2)
"RTN","RAORD1",18,0)
 .D ELIG^RABWORD2
"RTN","RAORD1",19,0)
 .Q
"RTN","RAORD1",20,0)
PL S DIC("A")="Patient Location: ",DIC("B")=$S($D(RAWARD):RAWARD,1:""),DIC="^SC(",DIC(0)="AEMQ",DIC("S")="I $$SCREEN^RAORD1A()"
"RTN","RAORD1",21,0)
 D ^DIC K DIC K:'$D(RAREGFLG) RAWARD G Q:Y<0 S RALIFN=+Y
"RTN","RAORD1",22,0)
 S DIC("A")="Person Requesting Order: "
"RTN","RAORD1",23,0)
 ;*Billing Awareness Project:
"RTN","RAORD1",24,0)
 S DIC("S")="I $$PROV^RABWORD()"
"RTN","RAORD1",25,0)
 ;Display Service Connected prompts if user is a Provider.
"RTN","RAORD1",26,0)
 S DIC="^VA(200,",DIC(0)="AEMQ",Y=DUZ S:$$PROV^RABWORD DIC("B")=$P(^VA(200,DUZ,0),"^",1)
"RTN","RAORD1",27,0)
 D ^DIC K DIC G Q:Y<0 S RAPIFN=+Y K DD,DO,VA200,VAERR,VAIP G ADDORD:$D(RAVSTFLG)
"RTN","RAORD1",28,0)
 ;
"RTN","RAORD1",29,0)
ENADD ;OE/RR Entry Point for the ACTION Option
"RTN","RAORD1",30,0)
 K ORSTOP,ORTO,ORCOST,ORPURG
"RTN","RAORD1",31,0)
 I '$D(RAPKG) G Q:'$D(ORVP)!('$D(ORL))!('$D(ORNP)) S (DFN,RADFN)=+ORVP,RALIFN=+ORL,RAPIFN=$S(+ORNP:+ORNP,$D(RAPIFN):RAPIFN,1:+ORNP),RAFOERR=""
"RTN","RAORD1",32,0)
 ; RAFOERR is used as a flag to track when a user enters this option
"RTN","RAORD1",33,0)
 ; from OE/RR (frontdoor).  If this variable exists when a request is
"RTN","RAORD1",34,0)
 ; being printed, exam information is omitted from the request.
"RTN","RAORD1",35,0)
 S RANME=^DPT(RADFN,0),RASEX=$P(RANME,"^",2),RANME=$P(RANME,"^") D EXAM^RADEM1:'$D(RAREGFLG)&($D(RAPKG)) I '$D(RAREGFLG) S VA200=1 D IN5^VADPT S:VAIP(1) RAWARD=$P(VAIP(5),"^",2)
"RTN","RAORD1",36,0)
 D SAVE ; save off original value of RAMDV!
"RTN","RAORD1",37,0)
 S RAL0=$S($D(^SC(RALIFN,0)):^(0),1:0)
"RTN","RAORD1",38,0)
 S RADIV=+$$SITE^VASITE(DT,+$P(RAL0,"^",15)) S:RADIV<0 RADIV=0
"RTN","RAORD1",39,0)
 S RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORD1",40,0)
 S RAMDV=$TR($G(^RA(79,+RADIV,.1)),"YyNn","1100")
"RTN","RAORD1",41,0)
 S RACAT=$S($D(RACAT):RACAT,$D(RAWARD):"INPATIENT",$P(RAL0,"^",2)="PERSONNEL HEALTH":"EMPLOYEE",'$D(^RADPT(RADFN,0)):"OUTPATIENT",$P(^(0),"^",4)]"":$P($P(^DD(70,.04,0),$P(^RADPT(RADFN,0),"^",4)_":",2),";"),1:"OUTPATIENT")
"RTN","RAORD1",42,0)
 I "IO"[$E(RACAT,1) D
"RTN","RAORD1",43,0)
 .S RASTRNG=$$MATCH^RAORD1A(RACAT,RALIFN)
"RTN","RAORD1",44,0)
 .;if necessary, change category of exam to match type of requesting
"RTN","RAORD1",45,0)
 .;location and display msg to user
"RTN","RAORD1",46,0)
 .S RACAT=$P(RASTRNG,"^"),RAWARD=$P(RASTRNG,"^",2)
"RTN","RAORD1",47,0)
 .Q
"RTN","RAORD1",48,0)
 K:$D(RAWARD)&($E(RACAT,1)="O") RAWARD
"RTN","RAORD1",49,0)
 K RASTRNG
"RTN","RAORD1",50,0)
 ; clear clin hist if:
"RTN","RAORD1",51,0)
 ;   rad backdoor, or
"RTN","RAORD1",52,0)
 ;   oe/rr's first order (quick or not)
"RTN","RAORD1",53,0)
 I $D(RAPKG) K ^TMP($J,"RAWP")
"RTN","RAORD1",54,0)
 I '$D(RAPKG),$G(XQORS)>1,$G(^TMP("XQORS",$J,XQORS-1,"ITM"))=1 K ^TMP($J,"RAWP")
"RTN","RAORD1",55,0)
 ;
"RTN","RAORD1",56,0)
ADDORD I $D(RADR1) D ALLERGY,CREATE1 G Q
"RTN","RAORD1",57,0)
 ; Set flag variable 'RASTOP' to track if procedure messages (if any)
"RTN","RAORD1",58,0)
 ; have been displayed.  Value altered in EN2+1^RAPRI & DISP+12^RAORDU1.
"RTN","RAORD1",59,0)
 D:'$D(VAEL) ELIG^VADPT
"RTN","RAORD1",60,0)
 I $D(^RAO(75.1,"B",RADFN)) D
"RTN","RAORD1",61,0)
 .I '$D(RAVSTFLG) D PREV^RABWORD2 Q
"RTN","RAORD1",62,0)
 .D ADDEXAM^RABWORD2
"RTN","RAORD1",63,0)
 D DISP^RAPRI G:RAIMGTYI'>0 Q
"RTN","RAORD1",64,0)
ADDORD1 W !,"Select Procedure",$S(RACNT:" (1-"_RACNT_") ",1:" "),"or enter '?' for help: "
"RTN","RAORD1",65,0)
 R RARX:DTIME
"RTN","RAORD1",66,0)
 S:'$T RARX="^" G Q:RARX=""!($E(RARX)="^")
"RTN","RAORD1",67,0)
 S:RARX=" " RARX=$S($D(RASX):RASX,1:RARX)
"RTN","RAORD1",68,0)
 I $E(RARX)="?"!(RARX=0)!(RARX=" ")!(RARX?.E1N1"-"1N.E)!(RARX?.E1".".E) D HELP^RAPRI G Q:Y'=1 D DISP1^RAPRI G ADDORD1
"RTN","RAORD1",69,0)
 S RAEXMUL=1 K RAHSMULT
"RTN","RAORD1",70,0)
 F RAJ=1:1 S X=$P(RARX,",",RAJ) Q:X=""  S RASTOP=0 W !!!,"Processing procedure: ",$S(+X&(+X'>RACNT):$P($G(RAPRC(X)),"^"),$E(X)'="`":X,1:"") D LOOKUP^RAPRI Q:$D(RAOUT)  S:RAPRI>0 RASX="`"_RAPRI D:RAPRI>0 ALLERGY,CREATE Q:$D(RAOUT)  K RAPRI
"RTN","RAORD1",71,0)
 I $D(RAREASK),'$D(RAOUT) K RAREASK D DISP1^RAPRI G ADDORD1
"RTN","RAORD1",72,0)
Q ; Kill, unlock if locked, and quit
"RTN","RAORD1",73,0)
 D KILL^RAORD
"RTN","RAORD1",74,0)
 D SAVE ; reset RAMDV to its original value!
"RTN","RAORD1",75,0)
 I $$ORVR^RAORDU()'<3,(+$G(RAPTLOCK)),(+$G(RADFN)) D
"RTN","RAORD1",76,0)
 . D ULK^RAUTL19(RADFN_";DPT(")
"RTN","RAORD1",77,0)
 K:'$D(RAREGFLG)&('$D(RAVSTFLG)) RACAT,RADFN,RANME,RAWARD
"RTN","RAORD1",78,0)
 I '$D(RAPKG) K RAMDIV,RAMDV,RAMLC
"RTN","RAORD1",79,0)
 I $D(RAPKG) K ORIFN,ORIT,ORL,ORNP,ORNS,ORPCL,ORPK,ORPV,ORPURG,ORSTS,ORTX,ORVP,RAPKG
"RTN","RAORD1",80,0)
 K RAHSMULT,RAPOP,RAIMAG,RAREQLOC
"RTN","RAORD1",81,0)
 K C,DI,DIG,DIH,DISYS,DIU,DIW,DIWF,DIWL,DIWR,DIWT,DN,I,ORCHART,POP,RAMDVZZ,RASCI,RASERIES
"RTN","RAORD1",82,0)
 Q
"RTN","RAORD1",83,0)
CREATE S RACT=0 D MODS Q:$D(RAOUT)
"RTN","RAORD1",84,0)
CREATE1 S RAWHEN=$$DESDT^RAUTL12(RAPRI) Q:$D(RAOUT)
"RTN","RAORD1",85,0)
 ; Ask pregnant if age is between 12 & 55.  Ask once for mult requests
"RTN","RAORD1",86,0)
 ; RASKPREG is the variable used to track if the pregnant prompt has
"RTN","RAORD1",87,0)
 ; been asked.  Ask only once for multiple requests.
"RTN","RAORD1",88,0)
 S:'$D(RASKPREG) RAPREG=$$PREG^RAORD1A(RADFN,$G(DT)),RASKPREG="" Q:$D(RAOUT)
"RTN","RAORD1",89,0)
 D CH^RAUTL5 Q:$D(RAOUT)  ; Ask for Clinical History.
"RTN","RAORD1",90,0)
BAQUES ;*Billing Awareness Project
"RTN","RAORD1",91,0)
 ;   Ask Ordering ICD-9 Diagnosis and Related SC/EI/MST/HNC questions.
"RTN","RAORD1",92,0)
 N RADTM D NOW^%DTC S RADTM=%
"RTN","RAORD1",93,0)
 D ASK^RABWORD(RADFN,RADTM)
"RTN","RAORD1",94,0)
 I '$D(RADR1) D DISP^RAORDU1 Q:$D(RAOUT)  ; Display Order Responses.
"RTN","RAORD1",95,0)
 S X=RADFN,DIC="^RAO(75.1,",DIC(0)="L",DLAYGO=75.1
"RTN","RAORD1",96,0)
 D FILE^DICN K DIC Q:Y<0  S RAOIFN=+Y K DLAYGO
"RTN","RAORD1",97,0)
 I $D(RAREGFLG)!($D(RAVSTFLG)) S RANUM=$S('$D(RANUM):1,1:RANUM+1),RAORDS(RANUM)=RAOIFN
"RTN","RAORD1",98,0)
 I $D(^RA(79,+RADIV,.1)),$P(^(.1),"^",21)="y" S RALOCFLG=""
"RTN","RAORD1",99,0)
 W ! S DA=RAOIFN,DIE="^RAO(75.1,",DIE("NO^")="OUTOK"
"RTN","RAORD1",100,0)
 S DR=$S($D(RADR1):"[RA QUICK EXAM ORDER]",$D(RADR2):"[RA ORDER EXAM]",$D(RAEXMUL)&($D(RAFIN1)):"[RA QUICK EXAM ORDER]",1:"[RA ORDER EXAM]")
"RTN","RAORD1",101,0)
 ;*Billing Awareness Project
"RTN","RAORD1",102,0)
 ;   If Order questions are being Re-Asked then Re-Ask ICD-9 Dx questions
"RTN","RAORD1",103,0)
 I DR="[RA ORDER EXAM]" D ASK^RABWORD(RADFN,RADTM) W !!
"RTN","RAORD1",104,0)
 D ^DIE
"RTN","RAORD1",105,0)
 K DIE("NO^"),DE,DQ,DIE,DR,RADR1,RADR2
"RTN","RAORD1",106,0)
 I $D(RAFIN),$D(^RAO(75.1,RAOIFN,0)) S RAORD0=^(0) D FILEDX^RABWORD(RADFN,RAOIFN) Q:'$D(RAFIN)  D SETORD^RAORDU D OERR^RAORDU:'$D(RAPKG) D ^RAORDQ:$D(RAPKG) K RAORD0
"RTN","RAORD1",107,0)
 I '$D(RAFIN) W !?3,$C(7),"Request not complete. Must Delete..." S DA=RAOIFN,DIK="^RAO(75.1," D ^DIK W "...deletion complete!" I $D(RAREGFLG)!($D(RAVSTFLG)) K RAORDS(RANUM)
"RTN","RAORD1",108,0)
 I '$D(RAFIN),('$D(^RAO(75.1,RAOIFN,0))#2) Q  ; record deleted!
"RTN","RAORD1",109,0)
 K RAFIN
"RTN","RAORD1",110,0)
 ; check if the 'stat' or 'urgent' alert is to be sent.
"RTN","RAORD1",111,0)
 N RALOC,RAORD0
"RTN","RAORD1",112,0)
 S RAORD0=$G(^RAO(75.1,RAOIFN,0)),RALOC=+$P(RAORD0,"^",20)
"RTN","RAORD1",113,0)
 Q:'RALOC  ; if no 'SUBMIT TO' location, can't send stat/urgent alerts
"RTN","RAORD1",114,0)
 I $P(RAORD0,"^",6)=1!(($P(RAORD0,"^",6)=2)&($P(^RA(79.1,RALOC,0),"^",20)="Y")) D
"RTN","RAORD1",115,0)
 .; If 6th piece of RAORD0=1 *stat*, =2 *urgent*
"RTN","RAORD1",116,0)
 .Q:$$ORVR^RAORDU()<3
"RTN","RAORD1",117,0)
 .; needs OE/RR 3.0 or greater for stat/urgent alerts to fire
"RTN","RAORD1",118,0)
 .D OENO^RAUTL19(RAOIFN)
"RTN","RAORD1",119,0)
 .Q
"RTN","RAORD1",120,0)
 Q
"RTN","RAORD1",121,0)
 ;
"RTN","RAORD1",122,0)
MODS ;RAPRI= Procedure IEN, RAIMAG=Imaging Type for the procedure.
"RTN","RAORD1",123,0)
 ;Edited 4/19/94, Type of Imaging is now a multiple in file 71.2. CEW
"RTN","RAORD1",124,0)
 S RAIMAG=+$$ITYPE^RASITE(RAPRI),DIC(0)="AEQMZ",DIC="^RAMIS(71.2,",DIC("A")="Select "_$P($G(^DIC(71.2,0)),"^")_": "
"RTN","RAORD1",125,0)
 S DIC("S")="I +$D(^RAMIS(71.2,""AB"",RAIMAG,+Y)),$S('$G(RASERIES):1,$P(^RAMIS(71.2,+Y,0),U,2)="""":1,1:0),$$INIMOD^RAORD1A($P($G(^RAMIS(71.2,+Y,0)),""^""))"
"RTN","RAORD1",126,0)
 D ^DIC K DIC,RAIMAG S:$D(DTOUT)!($D(DUOUT)) RAOUT=1 Q:$D(RAOUT)!(X="^")!(X="")  I Y<1 W $C(7),"  ??" G MODS
"RTN","RAORD1",127,0)
 S RACT=RACT+1,RAMOD(RACT)=$P(Y,"^",2) G MODS
"RTN","RAORD1",128,0)
 Q
"RTN","RAORD1",129,0)
 ;
"RTN","RAORD1",130,0)
ALLERGY ; If patient has had a previous contrast media allergic reaction
"RTN","RAORD1",131,0)
 ; check procedure RAPRI for specific contrast media associations
"RTN","RAORD1",132,0)
 ; (new with RA*5*45)
"RTN","RAORD1",133,0)
 Q:'$$ORCHK^GMRAOR(RADFN,"CM")
"RTN","RAORD1",134,0)
 S RAPRI(0)=$G(^RAMIS(71,RAPRI,0))
"RTN","RAORD1",135,0)
 I $P(RAPRI(0),U,6)'="P" D  ;not a parent check lone procedure
"RTN","RAORD1",136,0)
 .D CONTRAST^RAUTL2(RAPRI)
"RTN","RAORD1",137,0)
 .Q
"RTN","RAORD1",138,0)
 E  S I=0 D  ;check descendent procedures for CM
"RTN","RAORD1",139,0)
 .F  S I=$O(^RAMIS(71,RAPRI,4,I)) Q:'I  D CONTRAST^RAUTL2(+$G(^(I,0)))
"RTN","RAORD1",140,0)
 .K I
"RTN","RAORD1",141,0)
 .Q
"RTN","RAORD1",142,0)
 K RAPRI(0)
"RTN","RAORD1",143,0)
 Q
"RTN","RAORD1",144,0)
SAVE ; Save original value of RAMDV before it is altered in the ENADD sub-
"RTN","RAORD1",145,0)
 ; routine.  This code will also reset RAMDV to the sign-on value.
"RTN","RAORD1",146,0)
 Q:'$D(RAPKG)  ; entered through OE/RR (RAMDV will not be set)
"RTN","RAORD1",147,0)
 Q:'$D(RAMDV)&('$D(RAMDVZZ))  ;entered through 'Request an Exam' option used stand-alone outside of Rad/NM pkg
"RTN","RAORD1",148,0)
 I '$D(RAMDVZZ) S RAMDVZZ=RAMDV
"RTN","RAORD1",149,0)
 E  S RAMDV=RAMDVZZ
"RTN","RAORD1",150,0)
 Q
"RTN","RAORD3")
0^19^B24179273
"RTN","RAORD3",1,0)
RAORD3 ;HISC/CAH - AISC/RMO-Detailed Request Display Cont. ;01/20/05  11:55
"RTN","RAORD3",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,15,21,27,45,41**;Mar 16, 1998
"RTN","RAORD3",3,0)
 I $P(RADPT0,U,2)="F" D  ;display pregnancy status for females ptch 45
"RTN","RAORD3",4,0)
 .W !,"Pregnancy Status: ",?22,$S($P(RAORD0,"^",13)="y":"Patient is Pregnant",$P(RAORD0,"^",13)="n":"Patient not pregnant at time of order",1:"Unknown")
"RTN","RAORD3",5,0)
 .Q
"RTN","RAORD3",6,0)
 W:$P(RAORD0,"^",24)="y" !?12,"*** Universal Isolation Precautions ***" W:$D(RA("VDT")) !?8,$C(7),"** Note:  Request Associated with Visit on ",RA("VDT")," **"
"RTN","RAORD3",7,0)
 W:$D(RA("RDT"))&($D(RAPKG)) !,"Desired Date:",?22,RA("RDT") W:$D(RA("PDT")) !,"Pre-op Scheduled:",?22,RA("PDT") S RAOSTS=$P(RAORD0,"^",5) I RAOSTS=8,$D(RA("SDT")) W !,"Exam Scheduled:",?22,RA("SDT")
"RTN","RAORD3",8,0)
 I RAOSTS=1 D USERCAN
"RTN","RAORD3",9,0)
 W !,"Transport:",?22,RA("TRAN")
"RTN","RAORD3",10,0)
 D ODX^RABWUTL(RAOIFN) ;display Ordering DX and Clin Inds, Billing Aware
"RTN","RAORD3",11,0)
 I $O(^RAO(75.1,RAOIFN,"H",0)) D  Q:$G(OREND)=1!($G(RAX)="^")
"RTN","RAORD3",12,0)
 . D CHIST(RAOIFN)
"RTN","RAORD3",13,0)
 . Q
"RTN","RAORD3",14,0)
 I RAOSTS=1!(RAOSTS=3) W !,"Reason ",$S(RAOSTS=1:"Cancelled",1:"Held"),":",?22,$S($D(^RA(75.2,+$P(RAORD0,"^",10),0)):$E($P(^(0),"^"),1,50),$P(RAORD0,"^",27)]"":$E($P(RAORD0,"^",27),1,50),1:"UNKNOWN") D TEXT:RAOSTS=3
"RTN","RAORD3",15,0)
 W:$D(RA("ST")) !,"Exam Status:",?22,RA("ST") W:$D(RA("ILC")) !,"Request Submitted to: ",RA("ILC")
"RTN","RAORD3",16,0)
 G A:$P(RAORD0,"^",11)'="y",A:'$D(RADTI)!('$D(RACNI))
"RTN","RAORD3",17,0)
 W !!?7,$C(7),"** Note:  Request has been changed by the Imaging Service **"
"RTN","RAORD3",18,0)
A I $D(^RAO(75.1,RAOIFN,"T")) D ASK:$E(IOST,1,2)="C-" I $D(DIRUT) S RAX="^" K DIRUT
"RTN","RAORD3",19,0)
 Q:Y'=1  I $D(RAPKG),RAX'="^" R !!,"Press return to continue or ""^"" to escape ",X:DTIME S RAX=$E(X)
"RTN","RAORD3",20,0)
 Q
"RTN","RAORD3",21,0)
 ;
"RTN","RAORD3",22,0)
ASK W ! S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to display request status tracking log",DIR("?")="Enter 'YES' if status tracking log should be displayed, or 'NO' if not." D ^DIR K DIR S:$D(DIRUT) OREND=1 Q:$D(DIRUT)!(Y=0)
"RTN","RAORD3",23,0)
 W !!?20,"*** Request Status Tracking Log ***",!,"Date/Time",?18,"Status",?31,"User",?44,"Reason",!,"-----------------",?18,"------------",?31,"-----------",?44,"------------------------------------"
"RTN","RAORD3",24,0)
 F RALNB=0:0 S RALNB=$O(^RAO(75.1,RAOIFN,"T",RALNB)) Q:'RALNB  I $D(^(RALNB,0)) S RATORD0=^(0) D PRTLOG
"RTN","RAORD3",25,0)
Q K RALNB,RATORD0,RATODT,RATOST,RATREA,RATUSR Q
"RTN","RAORD3",26,0)
 ;
"RTN","RAORD3",27,0)
PRTLOG S (X,RATODT)=$P(RATORD0,"^") I X S RATODT=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) I $P(X,".",2) D TIME^RAUTL1 S RATODT=RATODT_" "_X
"RTN","RAORD3",28,0)
 S RATOST=$P($P(^DD(75.12,2,0),$P(RATORD0,"^",2)_":",2),";"),RATUSR=$S($D(^VA(200,+$P(RATORD0,"^",3),0)):$P(^(0),"^"),1:"")
"RTN","RAORD3",29,0)
 S RATREA=$S($D(^RA(75.2,+$P(RATORD0,"^",4),0)):$P(^(0),"^"),1:"")
"RTN","RAORD3",30,0)
 W !,RATODT,?18,$E(RATOST,1,12),?31,$E(RATUSR,1,11),?44,$E(RATREA,1,35) I $E(RATREA,36,70)'="" W !,?44,$E(RATREA,36,70)
"RTN","RAORD3",31,0)
 Q
"RTN","RAORD3",32,0)
TEXT ; display Hold Description text
"RTN","RAORD3",33,0)
 Q:'$O(^RAO(75.1,RAOIFN,1,0))
"RTN","RAORD3",34,0)
 W !,"Hold Description:",!
"RTN","RAORD3",35,0)
 K ^UTILITY($J,"W"),^(1) S DIWL=22,DIWR=75,DIWF="W"
"RTN","RAORD3",36,0)
 F RARR=0:0 S RARR=$O(^RAO(75.1,RAOIFN,1,RARR)) Q:RARR'>0  S X=^(RARR,0) D ^DIWP
"RTN","RAORD3",37,0)
 D ^DIWW
"RTN","RAORD3",38,0)
 Q
"RTN","RAORD3",39,0)
CHIST(RAY) ; display Clinical History (if applicable)
"RTN","RAORD3",40,0)
 Q:RAY'?1N.N  Q:'$O(^RAO(75.1,RAY,"H",0))
"RTN","RAORD3",41,0)
 N DIWF,DIWL,DIWR,RABAN,RARR,RAXIT
"RTN","RAORD3",42,0)
 K ^UTILITY($J,"W") S DIWL=22,DIWR=75,DIWF="",RARR=0
"RTN","RAORD3",43,0)
 F  S RARR=$O(^RAO(75.1,RAY,"H",RARR)) Q:RARR'>0  D
"RTN","RAORD3",44,0)
 . ; store into ^UTILITY($J,"W")
"RTN","RAORD3",45,0)
 . S X=$G(^RAO(75.1,RAY,"H",RARR,0)) D ^DIWP
"RTN","RAORD3",46,0)
 . Q
"RTN","RAORD3",47,0)
 S (RARR,RAXIT)=0,RABAN="Clinical History: "
"RTN","RAORD3",48,0)
 I $Y>(IOSL-4) D
"RTN","RAORD3",49,0)
 . S RAXIT=$$EOS()
"RTN","RAORD3",50,0)
 . I 'RAXIT,('$D(RAPKG)) W @IOF
"RTN","RAORD3",51,0)
 . I 'RAXIT,($D(RAPKG)) D HDR^RAORD2
"RTN","RAORD3",52,0)
 . Q
"RTN","RAORD3",53,0)
 I RAXIT S:$D(RAPKG) RAX="^" K ^UTILITY($J,"W") Q
"RTN","RAORD3",54,0)
 W !,RABAN
"RTN","RAORD3",55,0)
 F  S RARR=$O(^UTILITY($J,"W",DIWL,RARR)) Q:RARR'>0  D  Q:RAXIT
"RTN","RAORD3",56,0)
 . S X=$G(^UTILITY($J,"W",DIWL,RARR,0)) W ?22,X,!
"RTN","RAORD3",57,0)
 . I $Y>(IOSL-4) D
"RTN","RAORD3",58,0)
 .. S RAXIT=$$EOS()
"RTN","RAORD3",59,0)
 .. I 'RAXIT,('$D(RAPKG)) W @IOF
"RTN","RAORD3",60,0)
 .. I 'RAXIT,($D(RAPKG)) D HDR^RAORD2 W !
"RTN","RAORD3",61,0)
 .. Q
"RTN","RAORD3",62,0)
 . Q
"RTN","RAORD3",63,0)
 S:RAXIT&($D(RAPKG)) RAX="^" K ^UTILITY($J,"W") ; kill global
"RTN","RAORD3",64,0)
 Q
"RTN","RAORD3",65,0)
EOS() ; End of screen check for both OE/RR & Rad/Nuc Med
"RTN","RAORD3",66,0)
 ; Var List: $D(RAPKG) entry through Rad/Nuc Med, else through OE/RR
"RTN","RAORD3",67,0)
 ; Passes back 'Y', Y=1 do not continue, Y=0 continue
"RTN","RAORD3",68,0)
 ; NOTE: Sets OREND if code entered through OE/RR.  This code may be
"RTN","RAORD3",69,0)
 ;       hit when the user accesses the 'Act On Existing Orders' through
"RTN","RAORD3",70,0)
 ;       OE/RR.  'Detailed Order Display' (8^RAORR) hits ENDIS^RAORD2
"RTN","RAORD3",71,0)
 ;       which mimics (hits same code) the Rad/Nuc Med 'Detailed Request
"RTN","RAORD3",72,0)
 ;       Display' option.  The old PGBRK^ORUHDR code set OREND to 0
"RTN","RAORD3",73,0)
 ;       initially, (even though it is set to 0 upon entering this
"RTN","RAORD3",74,0)
 ;       sub-routine) and re-set it to 1 if the user enters an '^' at
"RTN","RAORD3",75,0)
 ;       the "Enter RETURN to continue or '^' to exit:" prompt.
"RTN","RAORD3",76,0)
 S Y=$$EOS^RAUTL5() S:'$D(RAPKG) OREND=Y
"RTN","RAORD3",77,0)
 Q Y
"RTN","RAORD3",78,0)
USERCAN ;user who cancelled this request
"RTN","RAORD3",79,0)
 Q:$P($G(^RAO(75.1,RAOIFN,0)),U,5)'=1  ;only look at 'discontinued'
"RTN","RAORD3",80,0)
 N RA8,RA9 S RA8=0
"RTN","RAORD3",81,0)
 F  S RA8=$O(^RAO(75.1,RAOIFN,"T",RA8)) Q:'RA8  I $G(^(RA8,0))]"",$P(^(0),U,2)=1 S RA9=RA8 ; find latest ien of 'discontinued'
"RTN","RAORD3",82,0)
 S RA("ODT")="",RA("USR")=""
"RTN","RAORD3",83,0)
 I $G(RA9) D USERCAN1
"RTN","RAORD3",84,0)
 E  D USERCAN2
"RTN","RAORD3",85,0)
 W !,"Cancelled:",?22,RA("ODT") W:RA("USR")]"" "  by ",RA("USR")
"RTN","RAORD3",86,0)
 K RA("ODT"),RA("USR")
"RTN","RAORD3",87,0)
 Q
"RTN","RAORD3",88,0)
USERCAN1 ;use request track times to get when and who cancelled
"RTN","RAORD3",89,0)
 S X=$P(^RAO(75.1,RAOIFN,"T",RA9,0),U) D:X TRDT
"RTN","RAORD3",90,0)
 S RA("USR")=$P($G(^VA(200,+$P(^RAO(75.1,RAOIFN,"T",RA9,0),U,3),0)),U)
"RTN","RAORD3",91,0)
 Q
"RTN","RAORD3",92,0)
USERCAN2 ;use vars DUZ and RAORD0 to get "who" and "when" cancelled
"RTN","RAORD3",93,0)
 S X=$P($G(RAORD0),U,18) D:X TRDT
"RTN","RAORD3",94,0)
 ; don't use  duz  if within any one of 3 rad request options
"RTN","RAORD3",95,0)
 Q:$D(RASCREEN)  Q:$D(RAOPT("ORDERPRINTS"))  Q:$D(RAOPT("ORDERPRINTPAT"))
"RTN","RAORD3",96,0)
 S RA("USR")=$P($G(^VA(200,$G(DUZ),0)),U)
"RTN","RAORD3",97,0)
 Q
"RTN","RAORD3",98,0)
TRDT S:$P(X,".",2) X=$P(X,".")_"."_$$NOSECNDS($P(X,".",2))
"RTN","RAORD3",99,0)
 S RA("ODT")=$$FMTE^XLFDT(X,"1P")
"RTN","RAORD3",100,0)
 Q
"RTN","RAORD3",101,0)
NOSECNDS(X) ; If a timestamp is associated with a date, strip off seconds.
"RTN","RAORD3",102,0)
 ; Input : X-timestamp (153048)
"RTN","RAORD3",103,0)
 ; Output: (1530)
"RTN","RAORD3",104,0)
 Q $E(X,1,4)
"RTN","RAORD6")
0^13^B44913351
"RTN","RAORD6",1,0)
RAORD6 ;HISC/CAH - AISC/RMO-Print A Request Cont. ;2/2/98  15:28
"RTN","RAORD6",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,10,15,18,27,45,41**;Mar 16, 1998
"RTN","RAORD6",3,0)
 D HD Q:RAX["^"
"RTN","RAORD6",4,0)
 I $P(RADPT0,U,2)="F" D  ;display pregnancy status for females ptch 45
"RTN","RAORD6",5,0)
 .W !,"Pregnancy Status: ",?22,$S($P(RAORD0,"^",13)="y":"Patient is Pregnant",$P(RAORD0,"^",13)="n":"Patient not pregnant at time of order",1:"Unknown")
"RTN","RAORD6",6,0)
 .Q
"RTN","RAORD6",7,0)
 W:$P(RAORD0,"^",24)="y" !!?12,"*** Universal Isolation Precautions ***"
"RTN","RAORD6",8,0)
 W:$D(RA("VDT")) !!?8,"** Note Request Associated with Visit on ",RA("VDT")," **"
"RTN","RAORD6",9,0)
 W !!,"Requested:",?18,RA("PRC INFO")
"RTN","RAORD6",10,0)
 I $D(^TMP($J,"RA DIFF PRC")),('$D(RAFOERR)),('$D(RAOPT("REG"))),('$D(RAOPT("ORDEREXAM"))),('$D(RAOPT("ADDEXAM"))) D  Q:RAX["^"
"RTN","RAORD6",11,0)
 . ; don't print registered procedure info (CPT, Proc Type, Imaging
"RTN","RAORD6",12,0)
 . ; Type) if entering through 'Request An Exam', 'Register Patient
"RTN","RAORD6",13,0)
 . ; for Exams' or 'Add Exams To Last Visit'.  Don't print if ordered
"RTN","RAORD6",14,0)
 . ; through ANY version of OE/RR.  If ordered through OE/RR, RAFOERR
"RTN","RAORD6",15,0)
 . ; will be defined. (Set in RAORD1 & RAO7RO)
"RTN","RAORD6",16,0)
 . N RAT,RA18NLIN S RAT="",RA18NLIN=0 W !,"Registered:"
"RTN","RAORD6",17,0)
 . F  S RAT=$O(^TMP($J,"RA DIFF PRC",RAT)) Q:RAT=""  D  Q:RAX["^"
"RTN","RAORD6",18,0)
 .. D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",19,0)
 .. W:RA18NLIN ! W ?12,RAT
"RTN","RAORD6",20,0)
 .. S RA18NLIN=1
"RTN","RAORD6",21,0)
 .. Q
"RTN","RAORD6",22,0)
 . Q
"RTN","RAORD6",23,0)
 I $G(RACMFLG("O"))'="" W !?12,"** The requested procedure has contrast media assigned **"
"RTN","RAORD6",24,0)
 I $G(RACMFLG("R"))'="" W !?12,"** A registered procedure uses contrast media **"
"RTN","RAORD6",25,0)
 W:$D(RA("MOD")) !,"Procedure Modifiers:",?22,RA("MOD")
"RTN","RAORD6",26,0)
 I RA("PRC MSG") D  Q:RAX["^"
"RTN","RAORD6",27,0)
 . N A,B,C,X S (A,C)=0 W !,"Procedure Message: ",!
"RTN","RAORD6",28,0)
 . F  S A=$O(^RAMIS(71,+$P(RAORD0,"^",2),3,A)) Q:A'>0!(RAX["^")  D
"RTN","RAORD6",29,0)
 .. S B=+$G(^RAMIS(71,+$P(RAORD0,"^",2),3,A,0))
"RTN","RAORD6",30,0)
 .. S X=$G(^RAMIS(71.4,B,0))
"RTN","RAORD6",31,0)
 .. W:'C ?3,"-" W:C !?3,"-"
"RTN","RAORD6",32,0)
 .. D OUTTEXT^RAUTL9(X,"",5,80,4,"","!")
"RTN","RAORD6",33,0)
 .. D HD:($Y+6)>IOSL S C=C+1
"RTN","RAORD6",34,0)
 .. Q
"RTN","RAORD6",35,0)
 . Q
"RTN","RAORD6",36,0)
 W !,"Request Status:",?22,$E(RA("OST"),1,24)
"RTN","RAORD6",37,0)
 I $P(RAORD0,"^",5)=1!($P(RAORD0,"^",5)=3) D  Q:RAX["^"
"RTN","RAORD6",38,0)
 . W !,"Reason ",$S($P(RAORD0,"^",5)=1:"Cancelled",1:"Held"),":"
"RTN","RAORD6",39,0)
 . W ?22,$S($D(^RA(75.2,+$P(RAORD0,"^",10),0)):$E($P(^(0),"^"),1,50),$P(RAORD0,"^",27)]"":$E($P(RAORD0,"^",27),1,50),1:"UNKNOWN")
"RTN","RAORD6",40,0)
 . D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",41,0)
 . I $D(^RAO(75.1,RAOIFN,1)) D  Q:RAX["^"
"RTN","RAORD6",42,0)
 .. N X,I,RAXX
"RTN","RAORD6",43,0)
 .. K ^UTILITY($J,"W")
"RTN","RAORD6",44,0)
 .. W !,"Hold Description:",!
"RTN","RAORD6",45,0)
 .. S I=0 F  S I=$O(^RAO(75.1,RAOIFN,1,I)) Q:'I  S (RAXX,X)=^(I,0) D HD:($Y+6)>IOSL Q:RAX["^"  S X=RAXX D ^DIWP
"RTN","RAORD6",46,0)
 .. Q:RAX["^"
"RTN","RAORD6",47,0)
 .. D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",48,0)
 .. D ^DIWW:$D(RAXX)
"RTN","RAORD6",49,0)
 .. D HD:($Y+6)>IOSL Q:RAX["X"
"RTN","RAORD6",50,0)
 . I $P(RAORD0,"^",5)=1 D
"RTN","RAORD6",51,0)
 .. W !!,?(IOM-(IOM/2+15)),"*********************",!,?(IOM-(IOM/2+15)),"* C A N C E L L E D *",!,?(IOM-(IOM/2+15)),"*********************"
"RTN","RAORD6",52,0)
 W:$P(RAORD0,"^",5)=6&($D(RA("ST"))) !,"Exam Status:",?22,RA("ST")
"RTN","RAORD6",53,0)
 W:$P(RAORD0,"^",5)=8&($D(RA("SDT"))) !,"Exam Scheduled:",?22,RA("SDT")
"RTN","RAORD6",54,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",55,0)
 W !!,"Requester:",?22,$E(RA("PHY"),1,20)
"RTN","RAORD6",56,0)
 W:RA("PHY")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("RPHOINFO"))
"RTN","RAORD6",57,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",58,0)
 W !,"Attend Phy Current:",?22,$E(RA("ATTEN"),1,20)
"RTN","RAORD6",59,0)
 W:RA("ATTEN")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("APHOINFO"))
"RTN","RAORD6",60,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",61,0)
 W !,"Prim Phy Current:",?22,$E(RA("PRIM"),1,20)
"RTN","RAORD6",62,0)
 W:RA("PRIM")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("PPHOINFO"))
"RTN","RAORD6",63,0)
 K RAPASS1,RAPASS2
"RTN","RAORD6",64,0)
 S RAPASS1=RA("ATTEN"),RAPASS2=RA("OATTEN")
"RTN","RAORD6",65,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",66,0)
 I $$ID^RAORD6(RAPASS1,RAPASS2) D
"RTN","RAORD6",67,0)
 . W !,"Attend Phy At Order:",?22,$E(RA("OATTEN"),1,20)
"RTN","RAORD6",68,0)
 . W:RA("OATTEN")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("OAPHOINFO"))
"RTN","RAORD6",69,0)
 . Q
"RTN","RAORD6",70,0)
 S RAPASS1=RA("PRIM"),RAPASS2=RA("OPRIM")
"RTN","RAORD6",71,0)
 I $$ID^RAORD6(RAPASS1,RAPASS2) D
"RTN","RAORD6",72,0)
 . W !,"Prim Phy At Order:",?22,$E(RA("OPRIM"),1,20)
"RTN","RAORD6",73,0)
 . W:RA("OPRIM")'="UNKNOWN" !?1,"Tel/Page/Dig Page: ",$G(RA("OPPHOINFO"))
"RTN","RAORD6",74,0)
 . Q
"RTN","RAORD6",75,0)
 K RAPASS1,RAPASS2
"RTN","RAORD6",76,0)
 I +$P(RAORD0,"^",8) D
"RTN","RAORD6",77,0)
 . N RAPPRAD S RAPPRAD=+$P(RAORD0,"^",8)
"RTN","RAORD6",78,0)
 . S:$P($G(^VA(200,RAPPRAD,20)),"^",2)]"" RAPPRAD=$P(^(20),"^",2)
"RTN","RAORD6",79,0)
 . S:RAPPRAD=+RAPPRAD RAPPRAD=$P(^VA(200,RAPPRAD,0),"^")
"RTN","RAORD6",80,0)
 . W !,"Approved by: ",?22,RAPPRAD
"RTN","RAORD6",81,0)
 . Q
"RTN","RAORD6",82,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",83,0)
 W !,"Date/Time Ordered:",?22,$S($D(RA("ODT")):RA("ODT"),1:""),"  by ",$E(RA("USR"),1,20)
"RTN","RAORD6",84,0)
 W:$D(RA("RDT")) !,"Date Desired:",?22,RA("RDT")
"RTN","RAORD6",85,0)
 D:$P(RAORD0,"^",5)=1 USERCAN^RAORD3
"RTN","RAORD6",86,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",87,0)
 W:$D(RA("PDT")) !,"Pre-op Date/Time:",?22,RA("PDT"),!!?26,"**** P R E - O P ****",!
"RTN","RAORD6",88,0)
BAR ;Print bar-coded SSN on request form if term type has bar code setup
"RTN","RAORD6",89,0)
 I $G(RASSN)'?3N1"-"2N1"-".E G CONT
"RTN","RAORD6",90,0)
 S X3=$E(RASSN,1,3)_$E(RASSN,5,6)_$E(RASSN,8,11)
"RTN","RAORD6",91,0)
 D PSET^%ZISP I IOBARON]"",(IOBAROFF]"") W !?49,@IOBARON,X3,@IOBAROFF,!
"RTN","RAORD6",92,0)
 D PKILL^%ZISP
"RTN","RAORD6",93,0)
 ;
"RTN","RAORD6",94,0)
CONT D HD:($Y+6)>IOSL Q:RAX["^"  D ODX^RABWUTL(RAOIFN) ; * Billing Aware *
"RTN","RAORD6",95,0)
 D HD:($Y+6)>IOSL Q:RAX["^"  K ^UTILITY($J,"W"),^(1) W !!,"Clinical History:",! K RAXX F RAV=0:0 S RAV=$O(^RAO(75.1,RAOIFN,"H",RAV)) Q:'RAV  I $D(^(RAV,0)) S RAXX=^(0) D HD:($Y+6)>IOSL Q:RAX["^"  S X=RAXX D ^DIWP
"RTN","RAORD6",96,0)
 Q:RAX["^"  D HD:($Y+6)>IOSL Q:RAX["^"  D ^DIWW:$D(RAXX),HD:($Y+6)>IOSL Q:RAX["^"  D WORK ;always print bottom section of form 012601
"RTN","RAORD6",97,0)
 W ! S BOT=IOSL-($Y+4) S:($E(IOST,1,6)="P-BROW"&($D(DDBRZIS))) BOT=5 F BT=1:1:BOT W !
"RTN","RAORD6",98,0)
 K BOT,BT
"RTN","RAORD6",99,0)
 W !,"VA Form 519a-ADP"
"RTN","RAORD6",100,0)
 Q
"RTN","RAORD6",101,0)
 ;
"RTN","RAORD6",102,0)
WORK W !,RALNE,!,"Date Performed: ________________________",?46
"RTN","RAORD6",103,0)
 I $O(^RADPT("AO",RAOIFN,0))="" W "Case No.: ______________________"
"RTN","RAORD6",104,0)
 E  W "Case No.: ______see above_______"
"RTN","RAORD6",105,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",106,0)
 W !,"Technologist Initials: _________________"
"RTN","RAORD6",107,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",108,0)
 W !?46,"Number/Size Films: _____________",!,"Interpreting Phys. Initials: ___________",?65,"_____________",!?65,"_____________",!
"RTN","RAORD6",109,0)
 D HD:($Y+6)>IOSL Q:RAX["^"
"RTN","RAORD6",110,0)
 W !,"Comments:"
"RTN","RAORD6",111,0)
 ;
"RTN","RAORD6",112,0)
TC D EN30^RAO7PC1(RAOIFN),TC^RAORD61 Q:RAX["^"
"RTN","RAORD6",113,0)
 ;
"RTN","RAORD6",114,0)
DASHLN W ! F I=1:1:5 D HD:($Y+6)>IOSL Q:RAX["^"  W !,RALNE ;P18
"RTN","RAORD6",115,0)
 Q
"RTN","RAORD6",116,0)
 ;
"RTN","RAORD6",117,0)
HD S:'$D(RAPGE) RAPGE=0 D CRCHK Q:$G(RAX)["^"  S RATAB=$S($D(RA("ILC")):1,1:16)
"RTN","RAORD6",118,0)
 W:$Y @IOF W !?RATAB,">>"_$S($D(RACRHD):"Discontinued ",1:"")_"Rad/Nuc Med Consultation" W:$D(RA("ILC")) " for ",$E(RA("ILC"),1,17) W "<<" S X="NOW",%DT="T" D ^%DT K %DT D D^RAUTL W ?52,Y ;P18
"RTN","RAORD6",119,0)
 S RAPGE=RAPGE+1 W ?71,"Page ",RAPGE ;P18
"RTN","RAORD6",120,0)
 W !,RALNE1,!,"Name         : ",RA("NME"),?46,"Urgency    : ",RA("OUG") W:$D(RA("PORTABLE")) "  *PORTABLE*"
"RTN","RAORD6",121,0)
 W !,"Pt ID Num    : ",RASSN,?46,"Transport  : ",RA("TRAN")
"RTN","RAORD6",122,0)
 S Y=RA("DOB") D D^RAUTL W !,"Date of Birth: ",Y,?46,"Patient Loc: ",$E(RA("HLC"),1,20)
"RTN","RAORD6",123,0)
 W !,"Age          : ",RA("AGE"),?46,"Phone Ext  : ",RA("HPH")
"RTN","RAORD6",124,0)
 W !,"Sex          : ",$S(RA("SEX")="M":"MALE",1:"FEMALE") W:$D(RA("ROOM-BED")) ?46,"Room-Bed   : ",RA("ROOM-BED") W !,RALNE1
"RTN","RAORD6",125,0)
 W:$P(RAORD0,U,5)=1 !,"***C A N C E L L E D***",?56,"***C A N C E L L E D***"
"RTN","RAORD6",126,0)
 Q
"RTN","RAORD6",127,0)
 ;
"RTN","RAORD6",128,0)
CRCHK I RAPGE,$E(IOST)="C" W !!,$C(7),"Press RETURN to continue or '^' to stop " R X:DTIME S RAX=X
"RTN","RAORD6",129,0)
 Q
"RTN","RAORD6",130,0)
ID(X,Y) ; Checks for the following condition:
"RTN","RAORD6",131,0)
 ; 1) Attending Phy. Current & Attending Phy. At Order are the same.
"RTN","RAORD6",132,0)
 ; 2) Primary Phy. Current & Primary Phy. At Order are the same.
"RTN","RAORD6",133,0)
 ; Input Variables:
"RTN","RAORD6",134,0)
 ; 'X'-> Attending/Primary Phy. Current
"RTN","RAORD6",135,0)
 ; 'Y'-> Attending/Primary Phy. At Order
"RTN","RAORD6",136,0)
 I X']""!(Y']"") Q 0
"RTN","RAORD6",137,0)
 I $$UP^XLFSTR(X)="UNKNOWN",($$UP^XLFSTR(Y)="UNKNOWN") Q 0
"RTN","RAORD6",138,0)
 N A,B,Z S A=+$O(^VA(200,"B",X,"")),B=+$O(^VA(200,"B",Y,""))
"RTN","RAORD6",139,0)
 I A>0,(B>0),(A=B) S Z=0
"RTN","RAORD6",140,0)
 E  S Z=1
"RTN","RAORD6",141,0)
 Q Z ; $S(Z=1:"different physician",Z=0:"same physician")
"RTN","RAORDU")
0^23^B27120538
"RTN","RAORDU",1,0)
RAORDU ;HISC/CAH - AISC/RMO-Update Request Status ; 9/7/04 11:01am
"RTN","RAORDU",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**18,41**;Mar 16, 1998
"RTN","RAORDU",3,0)
 ; last modif JULY 5,00
"RTN","RAORDU",4,0)
 ;The variables RAOIFN and RAOSTS must be defined. The variable
"RTN","RAORDU",5,0)
 ;RAOREA is set when Canceling and Holding a request. The
"RTN","RAORDU",6,0)
 ;variable RAOSCH is set when Scheduling a request.
"RTN","RAORDU",7,0)
 ; RAOSTS=request status of exam
"RTN","RAORDU",8,0)
 ; RAESTAT=min stat exams same dt/tm^max stat^1(if stat found) 0(else)
"RTN","RAORDU",9,0)
 N RAESTAT
"RTN","RAORDU",10,0)
 I RAOSTS=2,($$PARNT^RASETU(RAOIFN,RADFN)),($P($G(RAEXM0),"^",25)) D  Q:RAOSTS=6
"RTN","RAORDU",11,0)
 . S RAESTAT=$$EN1^RASETU(RAOIFN,RADFN)
"RTN","RAORDU",12,0)
 . S RAOSTS=$S((+RAESTAT'<1)&(+RAESTAT'>8):6,1:RAOSTS)
"RTN","RAORDU",13,0)
 . K:RAOSTS=6 ORIFN,ORETURN
"RTN","RAORDU",14,0)
 . I '$D(RAF1),(+RAESTAT=9) D
"RTN","RAORDU",15,0)
 .. W !?3,"...will now designate request status as 'COMPLETE'..."
"RTN","RAORDU",16,0)
 .. W !?10,"...request status successfully updated."
"RTN","RAORDU",17,0)
 .. Q
"RTN","RAORDU",18,0)
 . Q
"RTN","RAORDU",19,0)
 I $D(ORSTS),ORSTS=11,$P(^RAO(75.1,RAOIFN,0),"^",5)=11 S ORIFN=+$P(^(0),"^",7),ORSTS="K",DA=RAOIFN,DIK="^RAO(75.1," D DELETE,^DIK K DIK D:ORIFN ST^ORX K ORSTS Q
"RTN","RAORDU",20,0)
 K N I $D(RAOREA)>1 S N=$S($D(RAOIFN):RAOIFN,$D(ORPK):ORPK,1:1) I '$D(RAOREA(N)) S N=$O(RAOREA(0))
"RTN","RAORDU",21,0)
 S DA=RAOIFN,DIE="^RAO(75.1,",DR="10///"_$S($D(RAOREA)&(RAOSTS=1!(RAOSTS=3)):"/^S X="_$S($D(N):RAOREA(N),1:RAOREA),'$D(^RAO(75.1,RAOIFN,0)):"",$P(^(0),"^",10):"@",1:"")_";I 1;5///^S X="_RAOSTS
"RTN","RAORDU",22,0)
 I $D(RAVSTFLG),$D(RAVLEDTI) S DR=DR_";17///^S X="_(9999999.9999-RAVLEDTI)
"RTN","RAORDU",23,0)
 S DR=DR_";18///^S X=""NOW"";23///"_$S($D(RAOSCH)&(RAOSTS=8):"^S X="_RAOSCH,'$D(^RAO(75.1,RAOIFN,0)):"",$P(^(0),"^",23):"@",1:"")
"RTN","RAORDU",24,0)
 S RADIV=$$SITE(),RADIV=$S($D(^RA(79,RADIV,0)):RADIV,1:$O(^RA(79,0)))
"RTN","RAORDU",25,0)
 I $D(^RA(79,+RADIV,.1)),$P(^(.1),"^",19)="y" D SETLOG
"RTN","RAORDU",26,0)
 D ^DIE K DE,DQ,DIE,DR I $$ORVR^RAORDU()=2.5 S ORIFN=$S($D(^RAO(75.1,RAOIFN,0)):+$P(^(0),"^",7),1:0),ORETURN("ORSTS")=RAOSTS D:ORIFN RETURN^ORX K ORIFN,ORETURN
"RTN","RAORDU",27,0)
 ;
"RTN","RAORDU",28,0)
 ; if oe/rr v.3 or greater do the following
"RTN","RAORDU",29,0)
 ; .send a discontinue or hold message to oe/rr if request status in file
"RTN","RAORDU",30,0)
 ;  75.1 is discontinued (1) or hold (3).
"RTN","RAORDU",31,0)
 ; .send a complete message to oe/rr if request status in file 75.1 is 
"RTN","RAORDU",32,0)
 ;  complete.
"RTN","RAORDU",33,0)
 ; .send a scheduled message to oe/rr if request status is active (6) or
"RTN","RAORDU",34,0)
 ;  scheduled (8) AND the request was not a rollback from a status of
"RTN","RAORDU",35,0)
 ;  complete.
"RTN","RAORDU",36,0)
 ;
"RTN","RAORDU",37,0)
 I $$ORVR^RAORDU()'<3 D
"RTN","RAORDU",38,0)
 . D:(RAOSTS=1)!(RAOSTS=3) EN1^RAO7CH(RAOIFN)
"RTN","RAORDU",39,0)
 . D:RAOSTS=2 EN1^RAO7CMP(RAOIFN)
"RTN","RAORDU",40,0)
 . I (RAOSTS=6) Q:$G(RA18PCHG,0)=1  ;P18 quit if procedure was changed - do not send "SC" message,because "XX" have been sent already
"RTN","RAORDU",41,0)
 . I ((RAOSTS=6)!(RAOSTS=8))&($P($G(RAORDB4),"^",5)'=2) D
"RTN","RAORDU",42,0)
 .. D EN1^RAO7SCH(RAOIFN)
"RTN","RAORDU",43,0)
 .. Q
"RTN","RAORDU",44,0)
 . Q
"RTN","RAORDU",45,0)
 ; ***** PCE changes follow *****
"RTN","RAORDU",46,0)
 I $$PCE^RAWORK(),(RAOSTS=2),$G(RASAVDR)'="[RA OVERRIDE]" D
"RTN","RAORDU",47,0)
 . N RA7003 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAORDU",48,0)
 . Q:$P(RA7003,"^",24)="Y"  ; quit if clinic stop credited
"RTN","RAORDU",49,0)
 . ;BILLING AWARE PHASE II, NO LONGER SENDING TO PTF
"RTN","RAORDU",50,0)
 . ;I $P(RA7003,"^",6)]"",($P(^DIC(42,$P(RA7003,"^",6),0),"^",3)'="D") Q
"RTN","RAORDU",51,0)
 . ;omit quit since both inpatient and outpatient data are sent to PCE
"RTN","RAORDU",52,0)
 . D COMPLETE^RAPCE(RADFN,RADTI,RACNI)
"RTN","RAORDU",53,0)
 . Q
"RTN","RAORDU",54,0)
 Q
"RTN","RAORDU",55,0)
 ;
"RTN","RAORDU",56,0)
SETLOG K N I $D(RAOREA)>1 S N=$S($D(RAOIFN):RAOIFN,$D(ORPK):ORPK,1:1) I '$D(RAOREA(N)) S N=$O(RAOREA(0))
"RTN","RAORDU",57,0)
 S DR=DR_";75///^S X=$$MIDNGHT^RAUTL5($$NOW^XLFDT())",DR(2,75.12)="2////^S X="_RAOSTS_";3////^S X="_$S($G(RADUZ):RADUZ,1:DUZ)_";4///"_$S($D(RAOREA)&(RAOSTS=1!(RAOSTS=3)):"/^S X="_$S($D(N):RAOREA(N),1:RAOREA),1:"")
"RTN","RAORDU",58,0)
 Q
"RTN","RAORDU",59,0)
SETORD ;Create request in OE/RR file and add OE/RR order number to file 75.1
"RTN","RAORDU",60,0)
 ; if oe/rr v.3 or greater send an hl7 message when creating a new request/order.
"RTN","RAORDU",61,0)
 I $$ORVR^RAORDU()'<3 D EN1^RAO7NEW(RAOIFN) Q
"RTN","RAORDU",62,0)
 Q:$$ORVR^RAORDU()'=2.5
"RTN","RAORDU",63,0)
 N RAPRGST S RAPRGST=$P(RAORD0,"^",13)
"RTN","RAORDU",64,0)
 K RAMOD S $P(RABLNK," ",41)="" F I=0:0 S I=$O(^RAO(75.1,RAOIFN,"M","B",I)) Q:'I  I $D(^RAMIS(71.2,+I,0)) S RAMOD=$S('$D(RAMOD):$P(^(0),"^"),1:RAMOD_", "_$P(^(0),"^"))
"RTN","RAORDU",65,0)
 I $$ORVR^RAORDU()=2.5 S (RAPRCD,ORTX(1))=$P($G(^RAMIS(71,+$P(RAORD0,"^",2),0)),"^")_"," D
"RTN","RAORDU",66,0)
 .I $D(RAMOD) S ORTX(2)="Modifiers: "_$E(RAMOD,1,80)_","
"RTN","RAORDU",67,0)
 .S ORTX(3)="Urgency: "_$S($P(RAORD0,"^",6)=1:"STAT",$P(RAORD0,"^",6)=2:"URGENT",1:"ROUTINE")_","
"RTN","RAORDU",68,0)
 .I $P(RAORD0,"^",19)]"" S X=$P(RAORD0,"^",19),ORTX(3)=ORTX(3)_" Transport: "_$S(X="a":"AMBULATORY",X="p":"PORTABLE",X="s":"STRETCHER",1:"WHEELCHAIR")_","
"RTN","RAORDU",69,0)
 .I $D(RASEX),RASEX'="M" S ORTX(3)=ORTX(3)_" Pregnant: "_$S(RAPRGST="n":"NO",RAPRGST="y":"YES",RAPRGST="u":"UNKNOWN",1:"")
"RTN","RAORDU",70,0)
 S ORIT=$P(RAORD0,"^",2)_";RAMIS(71,"
"RTN","RAORDU",71,0)
 S DIC="^RA(79.2,",DIC(0)="N",X=+$P(^RAMIS(71,+$P(RAORD0,"^",2),0),"^",12) D ^DIC K DIC,RABLNK,RAMOD,RAPRCD S ORPURG=$S(Y<0:30,$D(^RA(79.2,+Y,.1)):+$P(^(.1),"^",6),1:30)
"RTN","RAORDU",72,0)
 S ORVP=RADFN_";DPT(",ORL=RALIFN_";SC(",ORNP=RAPIFN S ORPCL=$O(^ORD(101,"B","RA OERR EXAM",0))_";ORD(101,",ORPK=RAOIFN,ORSTS=$P(RAORD0,"^",5),ORSTRT=$P(RAORD0,"^",21) D FILE^ORX
"RTN","RAORDU",73,0)
 I $D(ORIFN),ORIFN]"" S DA=RAOIFN,DIE="^RAO(75.1,",DR="7////^S X="_ORIFN D ^DIE K DE,DQ,DIE,DR
"RTN","RAORDU",74,0)
 Q
"RTN","RAORDU",75,0)
OERR ;Set ^XUTL("OR",$J,"RA",IFN of oerr,IFN of Rad/Nuc Med order)
"RTN","RAORDU",76,0)
 I $D(ORIFN),ORIFN,$D(RAOIFN),RAOIFN S ^XUTL("OR",$J,"RA",ORIFN,RAOIFN)=RADIV
"RTN","RAORDU",77,0)
 K RADR1 Q
"RTN","RAORDU",78,0)
DELETE W:'$D(ZTQUEUED) !,"Since this order has not been released will delete instead of cancel...",!
"RTN","RAORDU",79,0)
 Q
"RTN","RAORDU",80,0)
 ;
"RTN","RAORDU",81,0)
ORVR() ;returns version number of OE/RR
"RTN","RAORDU",82,0)
 ;returns 0 if OE/RR is not installed
"RTN","RAORDU",83,0)
 ;
"RTN","RAORDU",84,0)
 ;Q 3.0 ;for testing purposes
"RTN","RAORDU",85,0)
 Q $S('$D(^ORD(100.99,0)):0,'$D(^DD(100,0,"VR")):0,1:^("VR"))
"RTN","RAORDU",86,0)
 ;
"RTN","RAORDU",87,0)
ORQUIK() ;returns 1 if CPRS Order Dialogue file 101.41 exists
"RTN","RAORDU",88,0)
 ;this means the quick order conversion to file 101.41 has been
"RTN","RAORDU",89,0)
 ;done and users should no longer be allowed to edit quick order
"RTN","RAORDU",90,0)
 ;parameters in the Common Procedure file 71.3.  The quick order
"RTN","RAORDU",91,0)
 ;conversion can be done prior to installing 3.0
"RTN","RAORDU",92,0)
 Q $S('$D(^ORD(101.41,0)):0,1:1)
"RTN","RAORDU",93,0)
 ;
"RTN","RAORDU",94,0)
SITE() ; Determine the value of RADIV
"RTN","RAORDU",95,0)
 ; +$P(RA1,"^",22)=Requesting Location
"RTN","RAORDU",96,0)
 ; +$P(RA2,"^",15)=Division (pntr to 40.8)
"RTN","RAORDU",97,0)
 Q:$D(RADIV)#2 RADIV
"RTN","RAORDU",98,0)
 N RA1,RA2,RADIVSON
"RTN","RAORDU",99,0)
 S RA1=$G(^RAO(75.1,RAOIFN,0))
"RTN","RAORDU",100,0)
 S RA2=$G(^SC(+$P(RA1,"^",22),0))
"RTN","RAORDU",101,0)
 S RADIVSON=+$$SITE^VASITE(DT,+$P(RA2,"^",15))
"RTN","RAORDU",102,0)
 Q $S(RADIVSON<0:0,1:RADIVSON)
"RTN","RAORDU1")
0^24^B30958799
"RTN","RAORDU1",1,0)
RAORDU1 ;HISC/CAH - AISC/SAW-Utility for Rad/NM Orders Module ;10/27/97  12:56
"RTN","RAORDU1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,41**;Mar 16, 1998
"RTN","RAORDU1",3,0)
CP ;Create protocols for Rad/Nuc Med in OE/RR Protocol file (#100)
"RTN","RAORDU1",4,0)
 ;based upon entries in the Rad/Nuc Med Common Procedure file (#71.3)
"RTN","RAORDU1",5,0)
 ;
"RTN","RAORDU1",6,0)
 I $$ORVR^RAORDU()>2.5 W !!,"In order to use this option, your site must be running version 2.5 of the",!,"Order Entry/Results Reporting package." G Q
"RTN","RAORDU1",7,0)
 ;
"RTN","RAORDU1",8,0)
 ;Check/set package and default protocol values
"RTN","RAORDU1",9,0)
 S ORPKG=$O(^DIC(9.4,"C","RA",0)) I 'ORPKG W !,*7,"There is no entry for the Radiology/Nuclear Medicine package in your Package",!,"file (#9.4), unable to proceed.  Contact your site manager." G Q
"RTN","RAORDU1",10,0)
 S ORDEF=$O(^ORD(101,"B","RA OERR DEFAULT PROTOCOL",0)) I 'ORDEF W !,*7,"You do not have a default Radiology/Nuclear Medicine protocol in your",!,"Protocol file (#101), unable to continue.  Contact your site manager." G Q
"RTN","RAORDU1",11,0)
 S (I,RACNT,RAF1,X)=0 K ^TMP($J,"RAEX") W !!?10,"Create an OE/RR Protocol from a Radiology/Nuclear Medicine",!?10,"Common Procedure",!
"RTN","RAORDU1",12,0)
 F  S I=$O(^RAMIS(71.3,I)) Q:I'>0  I $D(^(I,0)) S Y=I_"^"_^(0) I $P(Y,"^",6)']"",$D(^RAMIS(71,+$P(Y,"^",2),0)) S RACNT=RACNT+1,^TMP($J,"RAEX",RACNT)=Y W !,RACNT,?6,$P(^RAMIS(71,+$P(Y,"^",2),0),"^") D:'(RACNT#15) ASK^RAUTL4 Q:X="^"!(X>0)
"RTN","RAORDU1",13,0)
 G Q:X="^" I 'RACNT W !,*7,"The Common Procedures file does not have any entries from which to choose." G Q
"RTN","RAORDU1",14,0)
 I RACNT=1 S RADUP(1)="" W !!,"There is only one Common Procedure to choose from." S DIR(0)="YA",DIR("A")="Okay to continue? " D ^DIR G Q:Y'=1,CP1
"RTN","RAORDU1",15,0)
 I X'>0,RACNT#15 D ASK^RAUTL4 G Q:'$D(RADUP)
"RTN","RAORDU1",16,0)
CP1 S RAI=0 F  S RAI=$O(RADUP(RAI)) Q:RAI'>0  S Y=^TMP($J,"RAEX",RAI),DA=+Y,Y=$P(Y,"^",2,99) W !!,"Processing the ",$P(^RAMIS(71,+Y,0),"^")," procedure.",! D CP2
"RTN","RAORDU1",17,0)
Q K %1,D,D0,DA,DIC,DIE,DIR,DR,I,J,K,ORDEF,OREA,ORFL,ORPKG,ORTXT,RACNT,RADUP,RAERR,RAF1,RAI,RAILOC,RAPAR,RASEL,X,Y,Z,^TMP($J,"RAEX")
"RTN","RAORDU1",18,0)
 K DI,DIG,DIH,DIU,DIV,DQ
"RTN","RAORDU1",19,0)
 Q
"RTN","RAORDU1",20,0)
CP2 S RAERR=0 S RAILOC=$P(Y,"^",8) I 'RAILOC S RAILOC=$O(^RA(79.1,0)) I RAILOC,$O(^(RAILOC)) K RAILOC W !,*7,"You must enter an 'Imaging Location' before this procedure can be processed",!,"as an orderable item in OE/RR." S RAERR=1
"RTN","RAORDU1",21,0)
 S ORTXT=$P(Y,"^",13) I ORTXT']"" W !,*7,"You must enter a 'Name of Ordeable Item' before this procedure can be processed",!,"as an orderable item in OE/RR." S RAERR=1
"RTN","RAORDU1",22,0)
 I RAERR K RAILOC,ORTXT Q
"RTN","RAORDU1",23,0)
 S ORFL=+Y_";RAMIS(71,",OREA="S RADR1=1,RAPRI="_+Y_",RAILOC="_RAILOC_$S($P(Y,"^",11):",RARU="_$P(Y,"^",11),1:"")
"RTN","RAORDU1",24,0)
 S Z="^^^^^RACAT^RAREQDT^^RAMT^RAIP" F X=6,9,10 S OREA=OREA_$S($P(Y,"^",X)]"":","_$P(Z,"^",X)_"="_""""_$P(Y,"^",X)_"""",1:"")
"RTN","RAORDU1",25,0)
 I $O(^RAMIS(71.3,DA,"M",0)) S K=0 F J=1:1 S K=$O(^RAMIS(71.3,DA,"M",K)) Q:K'>0  S X=$G(^(K,0)) I $D(^RAMIS(71.2,+X,0)) S X=$P(^(0),"^") I X]"" S OREA=OREA_",RAMOD("_J_")="_""""_X_""""
"RTN","RAORDU1",26,0)
 S OREA=OREA_" D ^RAORR"
"RTN","RAORDU1",27,0)
 I $G(^DIC(9.4,ORPKG,0))]"" N RA1 S RA1=$P(^(0),"^",2)_+ORFL_" "_ORTXT S:$O(^ORD(101,"B",RA1,0)) ORDA=$O(^(0)) ; define ORDA if filelink record exists in file #101
"RTN","RAORDU1",28,0)
 ;D EN3^ORUPREF2 W:$D(Y) !,*7,"Unable to create an orderable item in OE/RR." Q
"RTN","RAORDU1",29,0)
 ;
"RTN","RAORDU1",30,0)
DISP ;Display request with defaults
"RTN","RAORDU1",31,0)
 S:'$D(RAMOD)#2 RAMOD=""
"RTN","RAORDU1",32,0)
 S J="",$P(J,"-",80)="" W !!,J
"RTN","RAORDU1",33,0)
 I $D(RAMOD)>9 S RAMOD="" F I=1:1 Q:'$D(RAMOD(I))  S RAMOD=RAMOD_$S(I'=1:", ",1:"")_RAMOD(I) S RAI=0 S RAI=+$O(^RAMIS(71.2,"B",RAMOD(I),RAI)) I $P($G(^RAMIS(71.2,RAI,0)),U,2)="p" S RAACI="p"
"RTN","RAORDU1",34,0)
 W !?10,"Patient: ",RANME I RASEX'="M" S:'$D(RAPREG) RAPREG="" W ?58,"Pregnant: ",$S(RAPREG="y":"YES",RAPREG="u":"UNKNOWN",RAPREG="n":"NO",1:"")
"RTN","RAORDU1",35,0)
 W !?8,"Procedure: ",$S($D(^RAMIS(71,RAPRI,0)):$P(^(0),"^"),1:"UNKNOWN"),!?2,"Proc. Modifiers: ",RAMOD
"RTN","RAORDU1",36,0)
 S:'$D(RAMT) RAMT=$S($G(RAACI)="p":"p",$E(RACAT)="I":"w",1:"a") S RAMT=RAMT_"^"_$P($P(^DD(75.1,19,0),RAMT_":",2),";") W !?9,"Category: ",RACAT,?49,"Mode of Transport: ",$P(RAMT,"^",2)
"RTN","RAORDU1",37,0)
 S:'$D(RAWHEN) RAWHEN="TODAY" S:'$D(RAIP) RAIP="n" W !,"     Desired Date: ",$$FMTE^XLFDT(RAWHEN,1),?46,"Isolation Procedures: ",$S(RAIP="y":"YES",1:"NO")
"RTN","RAORDU1",38,0)
 S:'$D(RARU) RARU=9 W !,"  Request Urgency: ",$S($D(RARU):$P($P(^DD(75.1,6,0),RARU_":",2),";"),1:"ROUTINE"),?46,"Scheduled for Pre-op: ",$S($D(RAPREOP1):"YES",1:"NO")
"RTN","RAORDU1",39,0)
 I $D(RAILOC) W !,"Submit Request To: ",$S($D(^RA(79.1,+RAILOC,0)):$S($D(^SC(+$P(^(0),"^"),0)):$P(^(0),"^"),1:"Unknown"),1:"Unknown")
"RTN","RAORDU1",40,0)
 W !," Request Location: ",$S($P($G(^SC(+RALIFN,0)),U,1)]"":$P($G(^SC(+RALIFN,0)),U,1),1:"Unkown") I $$ORVR^RAORDU()'<3 W ?46,"Nature of order:  SVC CORRECTION"
"RTN","RAORDU1",41,0)
 ;*Billing Aware Project:
"RTN","RAORDU1",42,0)
 ;   Display New ICD-9 Dx and their related SC/EI/MST/HNC responses.
"RTN","RAORDU1",43,0)
 ;
"RTN","RAORDU1",44,0)
BADISP D:$P($G(RABWDX(1)),U,1)>0 BADISP^RABWORD1(.RABWDX)
"RTN","RAORDU1",45,0)
 ;*
"RTN","RAORDU1",46,0)
 K ^UTILITY($J,"W"),^(1) S DIWF="WN",DIWL=1,DIWR=79,I=0 W !!,"Clinical History:",! F  S I=$O(^TMP($J,"RAWP",I)) Q:I'>0  S X=^(I,0) D ^DIWP
"RTN","RAORDU1",47,0)
 D ^DIWW W !,J
"RTN","RAORDU1",48,0)
 S DIR(0)="Y",DIR("A")="Do you want to change any of the above",DIR("B")="NO" D ^DIR K DIR S:$D(DUOUT)!($D(DTOUT)) RAOUT=1 Q:$D(RAOUT)  S:Y=0 RADR1=1 S:Y'=0 RADR2=1,RASTOP=0
"RTN","RAORDU1",49,0)
 ; RASTOP is used to track whether the procedure messages have printed.
"RTN","RAORDU1",50,0)
 ; If you answer 'yes' to "Do you want to edit this request", you
"RTN","RAORDU1",51,0)
 ; will see the procedure messages again (if they exist and if you
"RTN","RAORDU1",52,0)
 ; viewed them before.  Value altered in ADDORD+1^RAORD1 & EN2+1^RAPRI)
"RTN","RAORDU1",53,0)
 Q
"RTN","RAPCE")
0^15^B41092533
"RTN","RAPCE",1,0)
RAPCE ;HIRMFO/GJC-Interface with PCE APIs for wrkload, visits ; 9/7/04 12:36pm
"RTN","RAPCE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**10,17,21,26,41**;Mar 16, 1998
"RTN","RAPCE",3,0)
 Q
"RTN","RAPCE",4,0)
COMPLETE(RADFN,RADTI,RACNI) ; When an exam status changes to 'complete'
"RTN","RAPCE",5,0)
 ; Input: RADFN-> Patient DFN, RADTI-> Exam Timestamp, RACNI-> Case IEN
"RTN","RAPCE",6,0)
 ; NOTE:  RACNI input param is ignored for exam sets (all cases under
"RTN","RAPCE",7,0)
 ; an exam set are processed at once when order is complete)
"RTN","RAPCE",8,0)
 ; $$DATA2PCE^PXAPI returns: 1 if no errors, else error condition
"RTN","RAPCE",9,0)
 ;
"RTN","RAPCE",10,0)
 K ^TMP("DIERR",$J),^TMP("RAPXAPI",$J)
"RTN","RAPCE",11,0)
 N RA7002,RA7003,RA71,RA791,RACNT,RADTE,RAEARRY,RAPKG,RAVSIT,RABAD,RASTAT,RACPTM,RA,RA1,RARECMPL,RACNISAV
"RTN","RAPCE",12,0)
 N RADUPRC,RACOMIEN,RASENT,RALCKFAL
"RTN","RAPCE",13,0)
 S RALCKFAL=0 ; >0 if lock fails when :
"RTN","RAPCE",14,0)
 ; 1= complt'g exam that's unique to other cases same dt/tm, if any
"RTN","RAPCE",15,0)
 ; 2= complt'g exam that's a dupl of another cmplt'd exam (RESEND^RAPCE1)
"RTN","RAPCE",16,0)
 ; 3= UNcompleting exam before deleting credit+visit pointers same dt/tm
"RTN","RAPCE",17,0)
 S RAPKG=$O(^DIC(9.4,"B","RADIOLOGY/NUCLEAR MEDICINE",0))
"RTN","RAPCE",18,0)
 S RADTE=9999999.9999-RADTI,RACNT=0
"RTN","RAPCE",19,0)
 S RA7002=$G(^RADPT(RADFN,"DT",RADTI,0))
"RTN","RAPCE",20,0)
 S RAXAMSET=+$P(RA7002,"^",5) ; is this part of an exam set? 1=YES
"RTN","RAPCE",21,0)
EN2 S RA791=$G(^RA(79.1,+$P(RA7002,"^",4),0))
"RTN","RAPCE",22,0)
 Q:+$P(RA791,"^",21)=2  ; no credit, quit
"RTN","RAPCE",23,0)
 S RAEARRY="RAERROR" N @RAEARRY
"RTN","RAPCE",24,0)
LON ; lock at P level
"RTN","RAPCE",25,0)
 L +^RADPT(RADFN,"DT",RADTI,"P",RACNI):30 I '$T S RALCKFAL=1 D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ)) Q
"RTN","RAPCE",26,0)
 I 'RAXAMSET G NONSET
"RTN","RAPCE",27,0)
 ; exam set, grab all the completed records!
"RTN","RAPCE",28,0)
 S RACNISAV=RACNI
"RTN","RAPCE",29,0)
 S RACNI=0
"RTN","RAPCE",30,0)
 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0!($G(RABAD))  D
"RTN","RAPCE",31,0)
 . S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)) I $P($G(^RA(72,+$P(RA7003,U,3),0)),U,3)'=9 Q  ;check code instead of name
"RTN","RAPCE",32,0)
 . S RACNT=RACNT+1 D SETUP I $G(RABAD) Q
"RTN","RAPCE",33,0)
 . D:'$D(^TMP("RAPXAPI",$J,"ENCOUNTER")) ENC(RACNT)
"RTN","RAPCE",34,0)
 . D DX^RABWPCE($P(RA7003,U,11)) ; Ordering ICD Dx and related data.
"RTN","RAPCE",35,0)
 . D PROC(RACNT)
"RTN","RAPCE",36,0)
 . Q
"RTN","RAPCE",37,0)
 S RACNI=RACNISAV ;restore value so unlock would work 012601
"RTN","RAPCE",38,0)
 I '$G(RABAD),$D(^TMP("RAPXAPI",$J)) D PCE(RADFN,RADTI,RACNI)
"RTN","RAPCE",39,0)
 ;Missing data, send failure bulletin for ea case in set, don't attempt to send data to PCE
"RTN","RAPCE",40,0)
 I $G(RABAD) W:'$D(ZTQUEUED)&('$D(RARECMPL)) !,"Unable to credit Exam set" D
"RTN","RAPCE",41,0)
 . S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0  D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ))
"RTN","RAPCE",42,0)
 G KOUT
"RTN","RAPCE",43,0)
NONSET ; non-exam sets
"RTN","RAPCE",44,0)
 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPCE",45,0)
 D CKDUP^RAPCE1 ; chk for duplicate procedure(s) non-examset
"RTN","RAPCE",46,0)
 I $G(RADUPRC) D RESEND^RAPCE1 G KOUT ; branch off to re-send rec(s) this dt/tm
"RTN","RAPCE",47,0)
 S RACNT=RACNT+1
"RTN","RAPCE",48,0)
 D SETUP
"RTN","RAPCE",49,0)
 D:'$G(RABAD) ENC(RACNT) D:'$G(RABAD) DX^RABWPCE($P(RA7003,U,11)) D:'$G(RABAD) PROC(RACNT) D:'$G(RABAD) PCE(RADFN,RADTI,RACNI)
"RTN","RAPCE",50,0)
 I $G(RABAD) W:'$D(ZTQUEUED)&('$D(RARECMPL)) !,"Unable to credit exam" D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ)) ;Missing data, send failure bulletin for single case, don't attempt to pass data to PCE
"RTN","RAPCE",51,0)
 ;
"RTN","RAPCE",52,0)
KOUT K ^TMP("RAPXAPI",$J)
"RTN","RAPCE",53,0)
 L -^RADPT(RADFN,"DT",RADTI,"P",RACNI)
"RTN","RAPCE",54,0)
 Q
"RTN","RAPCE",55,0)
ENC(X) ; Set up the '"RAPXAPI",$J,"ENCOUNTER"' nodes
"RTN","RAPCE",56,0)
 N RAIMGLOC,RA17,RARPTLOC
"RTN","RAPCE",57,0)
 S RA17=+$P(RA7003,U,17)
"RTN","RAPCE",58,0)
 S RARPTLOC=$P($G(^RARPT(RA17,"BA")),U,1)
"RTN","RAPCE",59,0)
 S RAIMGLOC=$P($G(^RA(79.1,+RARPTLOC,0)),"^")
"RTN","RAPCE",60,0)
 S:'RAIMGLOC RAIMGLOC=$P($G(^RA(79.1,+$P(RA7002,"^",4),0)),"^")
"RTN","RAPCE",61,0)
 I RAIMGLOC="" S RABAD=1 Q  ; needs imaging location
"RTN","RAPCE",62,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"PATIENT")=RADFN
"RTN","RAPCE",63,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"ENC D/T")=RADTE
"RTN","RAPCE",64,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"HOS LOC")=RAIMGLOC
"RTN","RAPCE",65,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"SERVICE CATEGORY")="X"
"RTN","RAPCE",66,0)
 S ^TMP("RAPXAPI",$J,"ENCOUNTER",X,"ENCOUNTER TYPE")="A"
"RTN","RAPCE",67,0)
 Q
"RTN","RAPCE",68,0)
PCE(RADFN,RADTI,RACNI) ; Pass on the information to the PCE software
"RTN","RAPCE",69,0)
 N RASULT S RASULT=$$DATA2PCE^PXAPI("^TMP(""RAPXAPI"",$J)",RAPKG,"RAD/NUC MED",.RAVSIT,"","","","",.@RAEARRY)
"RTN","RAPCE",70,0)
 I (RASULT=1)!(RASULT=-1) D  ;Visit file pointer, set 'Credit recorded' to yes. 
"RTN","RAPCE",71,0)
 . W:'$D(ZTQUEUED)&('$D(RARECMPL)) !?5,"Visit credited.",!
"RTN","RAPCE",72,0)
 . D:'RAXAMSET VISIT(RADFN,RADTI,RACNI,RAVSIT)
"RTN","RAPCE",73,0)
 . D:'RAXAMSET RECDCS(RADFN,RADTI,RACNI) ; only one exam, not a set
"RTN","RAPCE",74,0)
 . D:RAXAMSET MULCS(RADFN,RADTI) ; set, update all exams!
"RTN","RAPCE",75,0)
 . S RASENT=1 ; sent to PCE was okay
"RTN","RAPCE",76,0)
 . Q
"RTN","RAPCE",77,0)
 E  D
"RTN","RAPCE",78,0)
 . N RAWHOERR S RAWHOERR=""
"RTN","RAPCE",79,0)
 . W:'$D(ZTQUEUED)&('$D(RARECMPL)) !?5,$C(7),"Unable to credit.",!
"RTN","RAPCE",80,0)
 . I '$G(RAXAMSET) D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ))
"RTN","RAPCE",81,0)
 . I $G(RAXAMSET) D
"RTN","RAPCE",82,0)
 .. S RACNI=0 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0  D FAILBUL^RAPCE2(RADFN,RADTI,RACNI,$S($G(RADUZ):RADUZ,1:DUZ))
"RTN","RAPCE",83,0)
 .. Q
"RTN","RAPCE",84,0)
 . Q
"RTN","RAPCE",85,0)
 Q
"RTN","RAPCE",86,0)
MULCS(RADFN,RADTI) ; Update the 'Credit recorded' field and the Visit 
"RTN","RAPCE",87,0)
 ;pointer for each case that is complete
"RTN","RAPCE",88,0)
 N RACNI S RACNI=0
"RTN","RAPCE",89,0)
 F  S RACNI=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI)) Q:RACNI'>0  D
"RTN","RAPCE",90,0)
 . Q:$P($G(^RA(72,+$P($G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0)),U,3),0)),U,3)'=9
"RTN","RAPCE",91,0)
 . D RECDCS(RADFN,RADTI,RACNI)
"RTN","RAPCE",92,0)
 . D VISIT(RADFN,RADTI,RACNI,RAVSIT)
"RTN","RAPCE",93,0)
 . Q
"RTN","RAPCE",94,0)
 Q
"RTN","RAPCE",95,0)
PROC(X) ; Set up the other '"RAPXAPI",$J,"PROCEDURE"' nodes for this case
"RTN","RAPCE",96,0)
 ; If same procedure repeated in exam set, add to qty of existing 
"RTN","RAPCE",97,0)
 ; 'procedure' node.   Else, if different provider, create new 
"RTN","RAPCE",98,0)
 ; separate 'procedure' nodes
"RTN","RAPCE",99,0)
 N X1,X2,X3,RADUP F X1=1:1:X S X2=$G(^TMP("RAPXAPI",$J,"PROCEDURE",X1,"PROCEDURE")) I X2=$P(RA71,"^",9),^("ENC PROVIDER")=$S(RA7003(15)]"":RA7003(15),1:RA7003(12)) D  Q
"RTN","RAPCE",100,0)
 . S ^TMP("RAPXAPI",$J,"PROCEDURE",X1,"QTY")=^("QTY")+1
"RTN","RAPCE",101,0)
 . D CPTMOD(X1)
"RTN","RAPCE",102,0)
 . S RADUP=1
"RTN","RAPCE",103,0)
 . Q
"RTN","RAPCE",104,0)
 I $D(RADUP) Q
"RTN","RAPCE",105,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"QTY")=1
"RTN","RAPCE",106,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"PROCEDURE")=$P(RA71,"^",9)
"RTN","RAPCE",107,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"NARRATIVE")=$P(RA71,"^")
"RTN","RAPCE",108,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"ENC PROVIDER")=$S(RA7003(15)]"":RA7003(15),1:RA7003(12)) ; Pri. Int Staff if exists, else Pri Int Resident
"RTN","RAPCE",109,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"ORD PROVIDER")=RA7003(14) ; Requesting Physician.
"RTN","RAPCE",110,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X,"EVENT D/T")=RADTE
"RTN","RAPCE",111,0)
 D CPTMOD(X)
"RTN","RAPCE",112,0)
 D PROCDX^RABWPCE(X) ; Add Ordering ICD Dx to each Procedure.
"RTN","RAPCE",113,0)
 Q
"RTN","RAPCE",114,0)
RECDCS(RADFN,RADTI,RACNI) ; Set 'Clinic Stop Recorded' to yes
"RTN","RAPCE",115,0)
 ; (70.03, fld 23)
"RTN","RAPCE",116,0)
 N RAFDA S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",23)="Y"
"RTN","RAPCE",117,0)
 D FILE^DIE("K","RAFDA")
"RTN","RAPCE",118,0)
 Q
"RTN","RAPCE",119,0)
SETUP ; Setup examination data node information
"RTN","RAPCE",120,0)
 ; If no provider, or inactive CPT, fail
"RTN","RAPCE",121,0)
 S RA7003=$G(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0))
"RTN","RAPCE",122,0)
 S RA7003(12)=$P(RA7003,"^",12) ; Pri. Inter. Resident
"RTN","RAPCE",123,0)
 S RA7003(14)=$P(RA7003,"^",14) ; Requesting Physician.
"RTN","RAPCE",124,0)
 S RA7003(15)=$P(RA7003,"^",15) ; Pri. Inter. Staff
"RTN","RAPCE",125,0)
 I (RA7003(12)="")&(RA7003(15)="") S RABAD=1 Q
"RTN","RAPCE",126,0)
 S RA71=$G(^RAMIS(71,+$P(RA7003,"^",2),0))
"RTN","RAPCE",127,0)
 ; store CPT Modifiers' .01 value
"RTN","RAPCE",128,0)
 K RACPTM S RA=0 F  S RA=$O(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"CMOD",RA)) Q:'RA  S RA1=$$BASICMOD^RACPTMSC($P($G(^(RA,0)),"^"),+$P(RA7002,"^")) S:+RA1>0 RACPTM(RA)=$P(RA1,"^",2) ;only valid cpt mods
"RTN","RAPCE",129,0)
 ; find out if CPT code is active
"RTN","RAPCE",130,0)
 I '$$ACTCODE^RACPTMSC(+$P(RA71,"^",9),$P(RA7002,"^")) S RABAD=1
"RTN","RAPCE",131,0)
 Q
"RTN","RAPCE",132,0)
VISIT(RADFN,RADTI,RACNI,RAVSIT) ; Stuff the Visit file pointer passed back
"RTN","RAPCE",133,0)
 ; from $$DATA2PCE^PXAPI() into the Visit field (70.02, fld 6)
"RTN","RAPCE",134,0)
 N RAFDA S RAFDA(70.03,RACNI_","_RADTI_","_RADFN_",",27)=RAVSIT
"RTN","RAPCE",135,0)
 D FILE^DIE("K","RAFDA")
"RTN","RAPCE",136,0)
 Q
"RTN","RAPCE",137,0)
CPTMOD(X3) ;CPT Modifiers
"RTN","RAPCE",138,0)
 ; CPT Mods for dupl. procedure+provider will be accounted for
"RTN","RAPCE",139,0)
 ; however, same CPT Mod will overwrite previous CPT Mod
"RTN","RAPCE",140,0)
 S ^TMP("RAPXAPI",$J,"PROCEDURE",X3,"MODIFIERS")="" ;prevent abend
"RTN","RAPCE",141,0)
 S RA=0
"RTN","RAPCE",142,0)
 F  S RA=$O(RACPTM(RA)) Q:'RA  S ^TMP("RAPXAPI",$J,"PROCEDURE",X3,"MODIFIERS",RACPTM(RA))=""
"RTN","RAPCE",143,0)
 Q
"RTN","RAPURGE")
0^16^B20015335
"RTN","RAPURGE",1,0)
RAPURGE ;HISC/CAH - AISC/MJK - Schedule Data Purge ;4/17/03  08:45
"RTN","RAPURGE",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**34,41**;Mar 16, 1998
"RTN","RAPURGE",3,0)
SCH ;Edit purge parameters and schedule Rad/Nuc Med data purge
"RTN","RAPURGE",4,0)
 I '($D(DUZ)#2) W !!,$C(7),"No 'DUZ' code. Purging not allowed.",! Q
"RTN","RAPURGE",5,0)
 I '$D(^VA(200,DUZ,0)) W !!,$C(7),"Not a valid 'DUZ' code. Purging not allowed.",! Q
"RTN","RAPURGE",6,0)
 F I=1:1:15 W !?9,$P($T(REMIND+I),";;",2)
"RTN","RAPURGE",7,0)
 S DIR(0)="Y",DIR("B")="Yes",DIR("?")="Enter 'YES' or 'RETURN' to edit purge parameters, or 'NO' not to.",DIR("A")="Do you want to edit the Imaging Type purge parameters" D ^DIR K DIR G QB:$D(DIRUT),PURGE:'Y
"RTN","RAPURGE",8,0)
EDIT W !! S DIC="^RA(79.2,",DIC(0)="AEQM",DIC("A")="Select IMAGING TYPE: " D ^DIC K DIC I Y>0 S DA=+Y,DIE="^RA(79.2,",DIE("NO^")="",DR="[RA ON-LINE CRITERIA]" D ^DIE K DE,DQ,DIC,DIE,DR G EDIT
"RTN","RAPURGE",9,0)
PURGE W ! S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you wish to schedule the data purge",DIR("?")="Enter 'YES' to schedule the data purge, or 'NO' not to."
"RTN","RAPURGE",10,0)
 D ^DIR K DIR I $D(DIRUT)!(Y=0) G QB
"RTN","RAPURGE",11,0)
 D RECORD
"RTN","RAPURGE",12,0)
 ; Display entries from 79.2 for selection
"RTN","RAPURGE",13,0)
 N I,J,CNT,RAX S (I,J,CNT)=0 K RAPUR
"RTN","RAPURGE",14,0)
 W !!?12,"IMAGING TYPES",!?12,"-------------",!
"RTN","RAPURGE",15,0)
 ; RAX(sequential no.)=ien file 79.2
"RTN","RAPURGE",16,0)
 F  S I=$O(^RA(79.2,"B",I)) Q:I=""  F  S J=$O(^RA(79.2,"B",I,J)) Q:'J  S CNT=CNT+1 W !?3,CNT,") ",I S RAX(CNT)=J
"RTN","RAPURGE",17,0)
 W ! S DIR(0)="L^1:"_CNT,DIR("A")="Select Imaging Type(s) to Purge",DIR("?")="Select by number, one or more imaging types to be purged" D ^DIR K DIR I $D(DIRUT) G QB
"RTN","RAPURGE",18,0)
 ; RAPUR(ien file 79.2)=""
"RTN","RAPURGE",19,0)
 S I="" F J=1:1 S I=$P(Y,",",J) Q:'I  S RAPUR(RAX(I))=""
"RTN","RAPURGE",20,0)
 W ! S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you wish to re-purge records that have been purged in the past",DIR("?")="Enter 'YES' to re-purge records purged in the past, or 'NO' not to."
"RTN","RAPURGE",21,0)
 D ^DIR K DIR G QB:$D(DIRUT) S RAREPURG=Y
"RTN","RAPURGE",22,0)
 D ASKF
"RTN","RAPURGE",23,0)
 G:'RAGO QB
"RTN","RAPURGE",24,0)
 K RAX S RAX="" F  S RAX=$O(RAPUR(RAX)) Q:'RAX  S DA=RAX,DIE="^RA(79.2,",DR="100///""NOW""",DR(2,79.23)="2///S;3////"_DUZ D ^DIE
"RTN","RAPURGE",25,0)
 K DA,DE,DIE,DQ,DR
"RTN","RAPURGE",26,0)
 S ZTRTN="START^RAPURGE1",ZTSAVE("RAPUR*")="",ZTSAVE("RAREPURG")="",ZTDESC="Rad/Nuc Med Data Purge" W ! D ZIS^RAUTL G Q:RAPOP
"RTN","RAPURGE",27,0)
 G START^RAPURGE1
"RTN","RAPURGE",28,0)
QB W !,"--Nothing Done--"
"RTN","RAPURGE",29,0)
Q K D0,D1,DA,DLAYGO,POP,RAPOP,RAPR,RAPUR,RAREPURG,X,Y,ZTDESC,ZTRTN,ZTSAVE,RAMES,RAGO,RAPURTYP Q
"RTN","RAPURGE",30,0)
 ;
"RTN","RAPURGE",31,0)
RECORD ; select which records to purge
"RTN","RAPURGE",32,0)
 S DIR(0)="S^E:Exams only;R:Reports only;B:Both exams & reports;"
"RTN","RAPURGE",33,0)
 S DIR("?")="Do you want to purge Exams, Reports, Exams & Reports ?"
"RTN","RAPURGE",34,0)
 S DIR("A")="Enter type of data to purge"
"RTN","RAPURGE",35,0)
 S DIR("B")="Reports only"
"RTN","RAPURGE",36,0)
 D ^DIR K DIR
"RTN","RAPURGE",37,0)
 S RAPURTYP=Y
"RTN","RAPURGE",38,0)
 Q
"RTN","RAPURGE",39,0)
ASKF ;ask final question
"RTN","RAPURGE",40,0)
 S RAGO=0
"RTN","RAPURGE",41,0)
 W !!,"You have chosen to purge ",$S(RAPURTYP="E":"Exam",RAPURTYP="R":"Report",RAPURTYP="B":"Exam & Report",1:"?")," records from "
"RTN","RAPURGE",42,0)
 S I=""
"RTN","RAPURGE",43,0)
 F  S I=$O(RAPUR(I)) Q:'I  W " ",$P(^RA(79.2,I,0),U) W:$O(RAPUR(I)) ","
"RTN","RAPURGE",44,0)
 W !
"RTN","RAPURGE",45,0)
 S DIR(0)="Y",DIR("B")="No",DIR("A")="Do you wish to proceed with the purge"
"RTN","RAPURGE",46,0)
 S DIR("?")="Enter 'YES' to go ahead with the purge, or 'NO' to exit from this option."
"RTN","RAPURGE",47,0)
 D ^DIR K DIR
"RTN","RAPURGE",48,0)
 S RAGO=Y
"RTN","RAPURGE",49,0)
 Q
"RTN","RAPURGE",50,0)
REMIND ;
"RTN","RAPURGE",51,0)
 ;;+--------------------------------------------------------+
"RTN","RAPURGE",52,0)
 ;;| This option is used to remove data from one or all of  |
"RTN","RAPURGE",53,0)
 ;;| these globals:  ^RADPT, ^RARPT                         |
"RTN","RAPURGE",54,0)
 ;;|                                                        |
"RTN","RAPURGE",55,0)
 ;;| Make sure IRM keeps the backup that was made prior to  |
"RTN","RAPURGE",56,0)
 ;;| running this option, and NOT overwrite that backup for |
"RTN","RAPURGE",57,0)
 ;;| at least 6 months.  Data from ^RADPT and ^RARPT can be |
"RTN","RAPURGE",58,0)
 ;;| recovered.                                             |
"RTN","RAPURGE",59,0)
 ;;|                                                        |
"RTN","RAPURGE",60,0)
 ;;| The cut-off dates for the 4 items (activity log,       |
"RTN","RAPURGE",61,0)
 ;;| report, clinical history, tracking time) are           |
"RTN","RAPURGE",62,0)
 ;;| compared to the exam date of those items.  If the      |
"RTN","RAPURGE",63,0)
 ;;| exam date for an item is older than the cut-off date   |
"RTN","RAPURGE",64,0)
 ;;| for that item, then that item would be purged.         |
"RTN","RAPURGE",65,0)
 ;;+--------------------------------------------------------+
"RTN","RAPURGE",66,0)
 ;;
"RTN","RAPURGE",67,0)
 Q
"RTN","RARTE4")
0^17^B24962657
"RTN","RARTE4",1,0)
RARTE4 ;HISC/GJC - Edit/Delete Reports (cont) ;11/4/97  08:02
"RTN","RARTE4",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**15,27,41**;Mar 16, 1998
"RTN","RARTE4",3,0)
LOCK ;Try to lock next avail IEN, if locked - fail, if used - increment again
"RTN","RARTE4",4,0)
 S I=I+1 S RAXIT=$$LOCK^RAUTL12("^RARPT(",I) I RAXIT D UNLOCK2 D INCRPT G START^RARTE
"RTN","RARTE4",5,0)
 I $D(^RARPT(I))!($D(^RARPT("B",I))) D UNLOCK^RAUTL12("^RARPT(",I) G LOCK
"RTN","RARTE4",6,0)
 S ^RARPT(I,0)=RARPTN,RARPT=I,^(0)=$P(^RARPT(0),"^",1,2)_"^"_I_"^"_($P(^(0),"^",4)+1),^DISV($S($D(DUZ)#2:DUZ,1:0),"^RARPT(")=I S:'$D(^RARPT(RARPT,"T")) ^("T")=""
"RTN","RARTE4",7,0)
 S ^RARPT(RARPT,0)=RARPTN_"^"_RADFN_"^"_RADTE_"^"_RACN_"^D",DIK="^RARPT(",DA=RARPT D IX1^DIK
"RTN","RARTE4",8,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RARTE4",9,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTE4",10,0)
 S DIE="^RADPT("_RADFN_",""DT"","_RADTI_",""P"","
"RTN","RARTE4",11,0)
 S DR="17////"_RARPT D ^DIE
"RTN","RARTE4",12,0)
 K %,D,D0,DA,DI,DIC,DIE,DQ,DR,RAY1,X,Y
"RTN","RARTE4",13,0)
 I RAPRTSET D PTR^RARTE2
"RTN","RARTE4",14,0)
 I RAXIT D UNLOCK2,UNLOCK^RAUTL12("^RARPT(",RARPT) Q
"RTN","RARTE4",15,0)
 G IN0
"RTN","RARTE4",16,0)
IN ;lock rpt for the 1st time if editing existing rpt
"RTN","RARTE4",17,0)
 S RAXIT=$$LOCK^RAUTL12("^RARPT(",RARPT) I RAXIT D UNLOCK2,Q Q
"RTN","RARTE4",18,0)
IN0 ;skip to here if rpt created in this session and already locked
"RTN","RARTE4",19,0)
 G IN1:'$P(RAMDV,"^",14) K RACOPY S DIC("S")="I RARPT'=+Y",DIC("A")="Select Report to Copy: ",DIC(0)="AMEQ",DIC="^RARPT(" D DICW,^DIC K DIC("S"),DIC("A") S RAY1=Y
"RTN","RARTE4",20,0)
 I X="^" D UNLOCK^RAUTL12("^RARPT(",RARPT),UNLOCK2 S RAXIT=$$EN3^RAUTL15(RARPT) D INCRPT G START^RARTE
"RTN","RARTE4",21,0)
 G IN1:RAY1<0
"RTN","RARTE4",22,0)
 F J="H","R","I" K ^RARPT(RARPT,J)
"RTN","RARTE4",23,0)
 F J="R","I" F I=1:1 Q:'$D(^RARPT(+Y,J,I,0))  S ^RARPT(RARPT,J,I,0)=^(0)
"RTN","RARTE4",24,0)
 ;F I=1:1 Q:'$D(^RADPT(RADFN,"DT",RADTI,"P",1,"H",I,0))  S ^RARPT(RARPT,"H",I,0)=^RADPT(RADFN,"DT",RADTI,"P",1,"H",I,0)
"RTN","RARTE4",25,0)
 S RACOPY=""
"RTN","RARTE4",26,0)
IN1 ;skip to here if div param disallows rpt copying
"RTN","RARTE4",27,0)
 I $P(RAMDV,"^",14) W !,RAI
"RTN","RARTE4",28,0)
 K RAFIN
"RTN","RARTE4",29,0)
 S DR="50///"_RACN
"RTN","RARTE4",30,0)
 S DR(2,70.03)="12//^S X=$S($D(RARES)&($D(RABTCH)):RARES,1:"""");S:$D(^VA(200,+X,0)) RARES=$P(^(0),U);I X'>0 S Y=""@15"";70;@15;15"
"RTN","RARTE4",31,0)
 I $P(RAMDV,"^",28) S DR(2,70.03)=DR(2,70.03)_"R" ; req'd for DIVISION
"RTN","RARTE4",32,0)
 S DR(2,70.03)=DR(2,70.03)_"//^S X=$S($D(RASTFF)&($D(RABTCH)):RASTFF,1:"""");S:$D(^VA(200,+X,0)) RASTFF=$P(^(0),U);I X'>0 S Y=""@1"";60;@1;S RAFIN="""""
"RTN","RARTE4",33,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT""," D ^DIE K DE,DQ
"RTN","RARTE4",34,0)
 D ELOC^RABWRTE ; Billing Aware -- ask Inter. Img Loc
"RTN","RARTE4",35,0)
 I RAPRTSET S RADRS=2 D COPY^RARTE2 ; copy resid and staff
"RTN","RARTE4",36,0)
 G PRT:'$D(RAFIN) W !,RAI
"RTN","RARTE4",37,0)
 ;
"RTN","RARTE4",38,0)
 ; **BNT - Commented out to stop copying history from file 70 to 74
"RTN","RARTE4",39,0)
 ; in patch RA*5*27.  The history is now referenced directly from file 70.
"RTN","RARTE4",40,0)
 ; I $D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H")),'$D(^RARPT(RARPT,"H")) F I=1:1 Q:'$D(^RADPT(RADFN,"DT",RADTI,"P",RACNI,"H",I,0))  S ^RARPT(RARPT,"H",I,0)=^(0)
"RTN","RARTE4",41,0)
 ; **
"RTN","RARTE4",42,0)
 I '$D(RACOPY),$P(RAMDV,"^",12) D STD^RARTE1 I X="^" G PRT
"RTN","RARTE4",43,0)
 W !,RAI D EDTRPT^RARTE1
"RTN","RARTE4",44,0)
PRT D UNLOCK^RAUTL12(RAPNODE,RACNI)
"RTN","RARTE4",45,0)
 ; --- copy diags to other cases of print set
"RTN","RARTE4",46,0)
 I RAPRTSET S RADRS=1,RAXIT=0 D COPY^RARTE2 L -^RADPT(RADFN,"DT",RADTI) ;unlock dt level only after copying is done
"RTN","RARTE4",47,0)
 ; wait til report has been checked for completeness before unlocking it
"RTN","RARTE4",48,0)
 S RAXIT=$$EN3^RAUTL15(RARPT) D UNLOCK^RAUTL12("^RARPT(",RARPT)
"RTN","RARTE4",49,0)
 I RAXIT S RAXIT=0 D UNLOCK2 D INCRPT G START^RARTE
"RTN","RARTE4",50,0)
 ; ---
"RTN","RARTE4",51,0)
 D:$S('$D(RACT):0,RACT="V":1,1:0) UPSTAT^RAUTL0 D:$S('$D(RACT):1,RACT'="V":1,1:0) UP1^RAUTL1 K RAAB G PRT1:'$D(RABTCH),PRT1:'$D(^RABTCH(74.2,+RABTCH,0))
"RTN","RARTE4",52,0)
ASKREP W !!,"Do you want to place this report in the batch ",RABTCHN,"? Yes// " R X:DTIME S:'$T!(X["^") X="N" S:X="" X="Y" G PRT1:"Nn"[$E(X)
"RTN","RARTE4",53,0)
 I "Yy"'[$E(X) W:X'["?" *7 W !!?3,"Enter 'YES' to place this report in the batch, or 'NO' not to." G ASKREP
"RTN","RARTE4",54,0)
 I $D(^RABTCH(74.2,"D",RARPT,RABTCH)) W !?5,"...report is already part of the '",RABTCHN,"' batch" D INCRPT G START^RARTE
"RTN","RARTE4",55,0)
 W !?5,"...will now place report in the '",RABTCHN,"' batch" S DIE="^RABTCH(74.2,",DA=RABTCH,DR="25///"_$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_RACN,DR(2,74.21)="2////N" D ^DIE K DQ,DE D INCRPT G START^RARTE
"RTN","RARTE4",56,0)
PRT1 R !!,"Do you wish to print this report? No// ",X:DTIME S:'$T!(X["^") X="N" S:X="" X="N" ;030497
"RTN","RARTE4",57,0)
 I "Nn"[$E(X) D INCRPT G START^RARTE
"RTN","RARTE4",58,0)
 I "Yy"'[$E(X) W:X'["?" *7 W !!?3,"Enter 'YES' to print this report, or 'NO' not to." G PRT1
"RTN","RARTE4",59,0)
 S ION=$P(RAMLC,"^",10),IOP=$S(ION]"":"Q;"_ION,1:"Q")
"RTN","RARTE4",60,0)
 S RAMES="W !!?3,""Report has been queued for printing on device "",ION,""."""
"RTN","RARTE4",61,0)
 D Q^RARTR D INCRPT G START^RARTE
"RTN","RARTE4",62,0)
 ;
"RTN","RARTE4",63,0)
Q I $D(RABTCH),$D(^RABTCH(74.2,+RABTCH,"R",0)) D ASKPRT^RARTE1,BTCH^RABTCH:"Yy"[$E(X)
"RTN","RARTE4",64,0)
Q1 K %,%DT,%W,%Y,%Y1,C,D0,D1,DA,DIC,DIE,DR,OREND,RABTCH,RABTCHN,RACN,RACNI,RACOPY,RACS,RACT,RADATE,RADFN,RADTE,RADTI,RADUZ,RAELESIG,RAFIN,RAHEAD,RAI,RAJ1
"RTN","RARTE4",65,0)
 K RALI,RALR,RANME,RANUM,RAOR,RAORDIFN,RAPNODE,RAPRC,RAPRIT,RAQUIT,RAREPORT,RARES,RARPDT,RARPT,RARPTN,RARPTZ,RARTPN,RASET,RASI,RASIG,RASN,RASSN,RAST,RAST1,RASTI,RASTFF,RAVW,XQUIT,W,X,Y
"RTN","RARTE4",66,0)
 K D,D2,DDER,DI,DIPGM,DLAYGO,J,RAEND,RAF5,RAFL,RAFST,RAIX,RAPOP,RAY1
"RTN","RARTE4",67,0)
 K ^TMP($J,"RAEX")
"RTN","RARTE4",68,0)
 K POP,DUOUT
"RTN","RARTE4",69,0)
 Q
"RTN","RARTE4",70,0)
DICW ; Build DIC("W") string
"RTN","RARTE4",71,0)
 N DO D DO^DIC1
"RTN","RARTE4",72,0)
 S DIC("W")=$S($G(DIC("W"))]"":DIC("W")_" ",1:"")_"W ""   "",$$FLD^RARTFLDS(+Y,""PROC"")"
"RTN","RARTE4",73,0)
 Q
"RTN","RARTE4",74,0)
INCRPT ; Kill extraneous variables to avoid collisions.
"RTN","RARTE4",75,0)
 ; Incomplete report information, select another case #.
"RTN","RARTE4",76,0)
 K %,%DT,D,D0,D1,D2,DI,DIC,DIWT,DN,I,J,RACN,RACNI,RACT,RADATE,RADTE
"RTN","RARTE4",77,0)
 K RADTI,RAFIN,RAI,RALI,RALR,RANME,RAPRC,RARPT,RARPTN,RASSN,RAST,RAVW,X
"RTN","RARTE4",78,0)
 Q
"RTN","RARTE4",79,0)
UNLOCK2 D UNLOCK^RAUTL12(RAPNODE,RACNI) L -^RADPT(RADFN,"DT",RADTI)
"RTN","RARTE4",80,0)
 Q
"RTN","RARTRPV1")
0^18^B7495041
"RTN","RARTRPV1",1,0)
RARTRPV1 ;HISC/FPT - Resident Pre-Verify Report ;11/16/98  15:02
"RTN","RARTRPV1",2,0)
 ;;5.0;Radiology/Nuclear Medicine;**5,41**;Mar 16, 1998
"RTN","RARTRPV1",3,0)
EDTRPT ; edit report text and pre-verify
"RTN","RARTRPV1",4,0)
 S RACT=$S('$D(^RARPT(RARPT,"L",0)):"I",1:"E")
"RTN","RARTRPV1",5,0)
 S:'$D(^RARPT(RARPT,"T")) ^("T")=""
"RTN","RARTRPV1",6,0)
 S DA=RARPT,DR="[RA PRE-VERIFY REPORT EDIT]",DIE="^RARPT("
"RTN","RARTRPV1",7,0)
 D ^DIE K DE,DQ,DR
"RTN","RARTRPV1",8,0)
 S:$D(Y) DUOUT=1
"RTN","RARTRPV1",9,0)
 Q
"RTN","RARTRPV1",10,0)
 ;
"RTN","RARTRPV1",11,0)
NOEDIT ; pre-verify a report only, no report text edit
"RTN","RARTRPV1",12,0)
 S DIE("NO^")="",DA=RARPT,DR="[RA PRE-VERIFY REPORT ONLY]",DIE="^RARPT("
"RTN","RARTRPV1",13,0)
 D ^DIE K DE,DIE,DQ,DR
"RTN","RARTRPV1",14,0)
 S:$D(Y) DUOUT=1
"RTN","RARTRPV1",15,0)
 I $D(DTOUT)!($D(DUOUT)) G NEXT
"RTN","RARTRPV1",16,0)
 D PDX I RAXIT!($D(DTOUT))!($D(DUOUT)) G NEXT
"RTN","RARTRPV1",17,0)
 I ($P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,13)]"") D SDX
"RTN","RARTRPV1",18,0)
 I RAXIT!($D(DTOUT))!($D(DUOUT)) G NEXT
"RTN","RARTRPV1",19,0)
 D PSTAFF I RAXIT!($D(DTOUT))!($D(DUOUT)) G NEXT
"RTN","RARTRPV1",20,0)
 I ($P(^RADPT(RADFN,"DT",RADTI,"P",RACNI,0),U,15)]"") D SSTAFF
"RTN","RARTRPV1",21,0)
 D ELOC^RABWRTE ; Billing Aware -- ask Inter. Img Loc
"RTN","RARTRPV1",22,0)
NEXT ; copy dx & phys, then return to RARTRPV and get next report
"RTN","RARTRPV1",23,0)
 ; rpt exists & locked, thus no need to lock at "DT" level because users
"RTN","RARTRPV1",24,0)
 ; can only use 'report entry/edit' option to enter dx's for printsets
"RTN","RARTRPV1",25,0)
 N:'$D(RAPRTSET) RAPRTSET N:'$D(RAMEMARR) RAMEMARR
"RTN","RARTRPV1",26,0)
 D EN2^RAUTL20(.RAMEMARR)
"RTN","RARTRPV1",27,0)
 I RAPRTSET S RAXIT=0 D
"RTN","RARTRPV1",28,0)
 . S RADRS=1 D COPY^RARTE2 ; copy dx
"RTN","RARTRPV1",29,0)
 . S RADRS=2 D COPY^RARTE2 ; copy resid and staff
"RTN","RARTRPV1",30,0)
 . Q
"RTN","RARTRPV1",31,0)
 K RAXIT
"RTN","RARTRPV1",32,0)
 I $P(^RARPT(RARPT,0),U,5)="R" D RPT^RAHLRPC
"RTN","RARTRPV1",33,0)
 I $D(DTOUT) K ^TMP($J,"RA")
"RTN","RARTRPV1",34,0)
 I '$D(DTOUT) I $G(RARDX)="S" D
"RTN","RARTRPV1",35,0)
 . D SAVE^RARTVER2
"RTN","RARTRPV1",36,0)
 . ; for 'Resident On-Line Pre-Verification' default device selection is
"RTN","RARTRPV1",37,0)
 . ; the "REPORT PRINTER NAME"
"RTN","RARTRPV1",38,0)
 . S %ZIS("B")=$P($G(RAMLC),"^",10) K:%ZIS("B")']"" %ZIS("B")
"RTN","RARTRPV1",39,0)
 . D Q^RARTR,RESTORE^RARTVER2
"RTN","RARTRPV1",40,0)
 . K:$D(%ZIS("B")) %ZIS("B")
"RTN","RARTRPV1",41,0)
 . Q
"RTN","RARTRPV1",42,0)
 G GETRPT^RARTRPV
"RTN","RARTRPV1",43,0)
 ;
"RTN","RARTRPV1",44,0)
PDX ; primary diagnostic code
"RTN","RARTRPV1",45,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTRPV1",46,0)
 S DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"",",DR=13
"RTN","RARTRPV1",47,0)
 S RAXIT=$$LOCK^RAUTL12(DIE,.DA)
"RTN","RARTRPV1",48,0)
 I 'RAXIT D ^DIE D UNLOCK^RAUTL12(DIE,.DA) K DA,DE,DQ,DIE,DR
"RTN","RARTRPV1",49,0)
 Q
"RTN","RARTRPV1",50,0)
SDX ; secondary diagnostic code
"RTN","RARTRPV1",51,0)
 S DR="50///"_RACN
"RTN","RARTRPV1",52,0)
 S DR(2,70.03)=13.1
"RTN","RARTRPV1",53,0)
 S DR(3,70.14)=.01
"RTN","RARTRPV1",54,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT"","
"RTN","RARTRPV1",55,0)
 S RAXIT=$$LOCK^RAUTL12(DIE,.DA)
"RTN","RARTRPV1",56,0)
 I 'RAXIT D ^DIE D UNLOCK^RAUTL12(DIE,.DA) K DA,DE,DQ,DIE,DR
"RTN","RARTRPV1",57,0)
 Q
"RTN","RARTRPV1",58,0)
PSTAFF ; primary staff
"RTN","RARTRPV1",59,0)
 S DA(2)=RADFN,DA(1)=RADTI,DA=RACNI
"RTN","RARTRPV1",60,0)
 S DIE="^RADPT("_DA(2)_",""DT"","_DA(1)_",""P"",",DR=15
"RTN","RARTRPV1",61,0)
 S RAXIT=$$LOCK^RAUTL12(DIE,.DA)
"RTN","RARTRPV1",62,0)
 I 'RAXIT D ^DIE D UNLOCK^RAUTL12(DIE,.DA) K DA,DE,DQ,DIE,DR
"RTN","RARTRPV1",63,0)
 Q
"RTN","RARTRPV1",64,0)
SSTAFF ; secondary staff
"RTN","RARTRPV1",65,0)
 S DR="50///"_RACN
"RTN","RARTRPV1",66,0)
 S DR(2,70.03)=60
"RTN","RARTRPV1",67,0)
 S DR(3,70.11)=.01
"RTN","RARTRPV1",68,0)
 S DA(1)=RADFN,DA=RADTI,DIE="^RADPT("_DA(1)_",""DT"","
"RTN","RARTRPV1",69,0)
 S RAXIT=$$LOCK^RAUTL12(DIE,.DA)
"RTN","RARTRPV1",70,0)
 I 'RAXIT D ^DIE D UNLOCK^RAUTL12(DIE,.DA) K DA,DE,DQ,DIE,DR
"RTN","RARTRPV1",71,0)
 Q
"UP",70,70.03,-2)
70^DT
"UP",70,70.03,-1)
70.02^P
"UP",70,70.03,0)
70.03
"UP",75.1,75.13,-1)
75.1^BAS
"UP",75.1,75.13,0)
75.13
"VER")
8.0^22.0
"^DD",70,70.03,11,0)
IMAGING ORDER^P75.1'^RAO(75.1,^0;11^Q
"^DD",70,70.03,11,1,0)
^.1
"^DD",70,70.03,11,1,1,0)
70^AO
"^DD",70,70.03,11,1,1,1)
S ^RADPT("AO",$E(X,1,30),DA(2),DA(1),DA)=""
"^DD",70,70.03,11,1,1,2)
K ^RADPT("AO",$E(X,1,30),DA(2),DA(1),DA)
"^DD",70,70.03,11,1,1,"%D",0)
^^1^1^2940517^
"^DD",70,70.03,11,1,1,"%D",1,0)
Used to link the Radiology/Nuclear Medicine Request/Order to the Exam.
"^DD",70,70.03,11,3)
This field contains the order from the 'RAD/NUC MED ORDERS' file that is associated with this exam.
"^DD",70,70.03,11,21,0)
^.001^4^4^3040628^^^^
"^DD",70,70.03,11,21,1,0)
This field points to the 'RAD/NUC MED ORDERS' File (#75.1). It contains
"^DD",70,70.03,11,21,2,0)
the order associated with this exam. This field will only contain data if
"^DD",70,70.03,11,21,3,0)
the exam has an 'ACTIVE' order associated with it.  When orders are
"^DD",70,70.03,11,21,4,0)
purged, the pointer in this field is also purged.
"^DD",70,70.03,11,23,0)
^.001^2^2^3040628^^
"^DD",70,70.03,11,23,1,0)
Patch RA*5*41 will dis-allow purging of orders from the Radiology/Nuclear 
"^DD",70,70.03,11,23,2,0)
Medicine application.
"^DD",70,70.03,11,"DT")
2940608
"^DD",70,70.03,14,0)
REQUESTING PHYSICIAN^R*P200'X^VA(200,^0;14^S DIC("S")="I $$PROV^RABWORD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",70,70.03,14,.1)
NAME OF THE REQUESTING PHYSICIAN
"^DD",70,70.03,14,3)
Enter the name of the person requesting this exam.
"^DD",70,70.03,14,10)
RAD/NUC MED RECEPTIONIST
"^DD",70,70.03,14,12)
Provider must be active.
"^DD",70,70.03,14,12.1)
S DIC("S")="I $$PROV^RABWORD"
"^DD",70,70.03,14,21,0)
^.001^3^3^3030827^^^^
"^DD",70,70.03,14,21,1,0)
This field points to the 'NEW PERSON' file (#200) to indicate the name of
"^DD",70,70.03,14,21,2,0)
the person who requested this Rad/Nuc Med exam.  This person is not always a
"^DD",70,70.03,14,21,3,0)
physician.  (i.e. A nurse might request the exam.)
"^DD",70,70.03,14,"DT")
3030827
"^DD",70,70.03,26,0)
CREDIT METHOD^S^0:Regular Credit;1:Interpretation Only;2:No Credit;3:Technical Component Only;^0;26^Q
"^DD",70,70.03,26,3)
Enter the type of credit this location will receive for this examination.
"^DD",70,70.03,26,9.2)
D EN^DDIOL("'Interpreting Only' and 'Technical Component Only' are for future use.","","!")
"^DD",70,70.03,26,21,0)
^.001^10^10^3030826^^^
"^DD",70,70.03,26,21,1,0)
This field indicates the type of credit this location receives for
"^DD",70,70.03,26,21,2,0)
examinations.  This field is populated automatically by the system at the
"^DD",70,70.03,26,21,3,0)
time an exam is registered based on the Credit Method entered for the
"^DD",70,70.03,26,21,4,0)
Imaging Location where the exam is registered.  If only the interpretation
"^DD",70,70.03,26,21,5,0)
was done at this facility, code 1 should be used.  If the exam was
"^DD",70,70.03,26,21,6,0)
performed at this facility, but the interpretation was done elsewhere,
"^DD",70,70.03,26,21,7,0)
code 3 should be used.  If both the exam and interpretation were done at
"^DD",70,70.03,26,21,8,0)
this facility, code 0 should be used. If the entire exam was done outside
"^DD",70,70.03,26,21,9,0)
the facility and exam data is being entered for the purposes of
"^DD",70,70.03,26,21,10,0)
record-keeping only, code 2 should be used.
"^DD",70,70.03,26,"DT")
3030826
"^DD",74,74,86,0)
INTERPRETING IMAGING LOCATION^*P79.1'^RA(79.1,^BA;1^S DIC("S")="I $$SIIL^RABWRTE" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",74,74,86,3)
Enter the imaging location where the interpretation was performed.
"^DD",74,74,86,12)
Location must not be 'Performed Only', and its Img Type must match Exam's Img Type (if exam is available.)
"^DD",74,74,86,12.1)
S DIC("S")="I $$SIIL^RABWRTE"
"^DD",74,74,86,21,0)
^.001^2^2^3040218^^^^
"^DD",74,74,86,21,1,0)
This is the imaging location where the interpretation was performed.
"^DD",74,74,86,21,2,0)
It is a pointer to the Imaging Location file (#79.1).
"^DD",74,74,86,"DT")
3030827
"^DD",75.1,75.1,14,0)
REQUESTING PHYSICIAN^R*P200'X^VA(200,^0;14^S DIC("S")="I $$PROV^RABWORD" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",75.1,75.1,14,.1)
NAME OF THE REQUESTING PHYSICIAN
"^DD",75.1,75.1,14,3)
Enter the name of the person requesting this exam.
"^DD",75.1,75.1,14,10)
MEDICAL ADMINISTRATION SERVICE OR RAD/NUC MED SERVICE
"^DD",75.1,75.1,14,12)
Provider must be active.
"^DD",75.1,75.1,14,12.1)
S DIC("S")="I $$PROV^RABWORD"
"^DD",75.1,75.1,14,21,0)
^.001^3^3^3030827^^^^
"^DD",75.1,75.1,14,21,1,0)
This field points to the 'NEW PERSON' file (#200) to indicate the name of
"^DD",75.1,75.1,14,21,2,0)
the person who requested this rad/nuc med exam. This person is not always a
"^DD",75.1,75.1,14,21,3,0)
physician.  (i.e. A nurse might request the exam.)
"^DD",75.1,75.1,14,"AUDIT")
n
"^DD",75.1,75.1,14,"DT")
3040301
"^DD",75.1,75.1,91,0)
PRIMARY ORDERING ICD DIAGNOSIS^RP80'^ICD9(^BA;1^Q
"^DD",75.1,75.1,91,3)
Enter the ICD Diagnosis primarily responsible for this order.
"^DD",75.1,75.1,91,21,0)
^.001^1^1^3030922^^^
"^DD",75.1,75.1,91,21,1,0)
This field contains the Primary ICD Diagnosis responsible for this order.
"^DD",75.1,75.1,91,"DT")
3030918
"^DD",75.1,75.1,92,0)
PRIMARY DX RELATED TO SC^S^0:NO;1:YES;^BA;2^Q
"^DD",75.1,75.1,92,3)
If this order is for treating a Service Connected related problem, enter "YES" here.
"^DD",75.1,75.1,92,21,0)
^.001^2^2^3030922^^^^
"^DD",75.1,75.1,92,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.1,92,21,2,0)
a VA patient based on a Service Connected related problem.
"^DD",75.1,75.1,92,"DT")
3030922
"^DD",75.1,75.1,93,0)
PRIMARY DX RELATED TO AO^S^0:NO;1:YES;^BA;3^Q
"^DD",75.1,75.1,93,3)
If this order is for treating an Agent Orange related problem, enter "YES" here.
"^DD",75.1,75.1,93,21,0)
^.001^2^2^3040218^^^
"^DD",75.1,75.1,93,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.1,93,21,2,0)
a VA patient based on an Agent Orange related problem.
"^DD",75.1,75.1,93,"DT")
3030922
"^DD",75.1,75.1,94,0)
PRIMARY DX RELATED TO IR^S^0:NO;1:YES;^BA;4^Q
"^DD",75.1,75.1,94,3)
If this order is for treating an Ionizing Radiation related problem, enter "YES" here.
"^DD",75.1,75.1,94,21,0)
^.001^2^2^3030923^^
"^DD",75.1,75.1,94,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.1,94,21,2,0)
a VA patient based on an Ionizing Radiation related problem.
"^DD",75.1,75.1,94,"DT")
3030922
"^DD",75.1,75.1,95,0)
PRIMARY DX RELATED TO EC^S^0:NO;1:YES;^BA;5^Q
"^DD",75.1,75.1,95,3)
If this order is for treating an Environmental Contaminant related problem, enter "YES" here.
"^DD",75.1,75.1,95,21,0)
^.001^2^2^3030923^^
"^DD",75.1,75.1,95,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.1,95,21,2,0)
a VA patient based on an Environmental Contaminant related problem.
"^DD",75.1,75.1,95,"DT")
3030922
"^DD",75.1,75.1,96,0)
PRIMARY DX RELATED TO MST^S^0:NO;1:YES;^BA;6^Q
"^DD",75.1,75.1,96,3)
If this order is for treating a Military Sexual Trauma related problem, enter "YES" here. 
"^DD",75.1,75.1,96,21,0)
^^2^2^3030922^
"^DD",75.1,75.1,96,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.1,96,21,2,0)
a VA patient based on a Military Sexual Trauma related problem.
"^DD",75.1,75.1,96,"DT")
3030922
"^DD",75.1,75.1,97,0)
PRIMARY DX RELATED TO HNC^S^0:NO;1:YES;^BA;7^Q
"^DD",75.1,75.1,97,3)
If this order is for treating a Head and Neck cancer (HNC) related problem, enter "YES" here.
"^DD",75.1,75.1,97,21,0)
^^2^2^3040526^
"^DD",75.1,75.1,97,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.1,97,21,2,0)
a VA patient based on a Head and Neck cancer (HNC) related problem.
"^DD",75.1,75.1,97,"DT")
3040526
"^DD",75.1,75.1,98,0)
SECONDARY ORDERING ICD DIAG.^75.13PA^^BAS;0
"^DD",75.1,75.1,99,0)
PRIMARY DX RELATED TO CV^S^0:NO;1:YES;^BA;8^Q
"^DD",75.1,75.1,99,3)
If this order is for treating a Combat Veteran related problem, enter "YES" here.
"^DD",75.1,75.1,99,21,0)
^.001^2^2^3040310^^
"^DD",75.1,75.1,99,21,1,0)
This field will be used to indicate if this order was for treating a VA 
"^DD",75.1,75.1,99,21,2,0)
patient based on an Combat Veteran related problem.
"^DD",75.1,75.1,99,"DT")
3040218
"^DD",75.1,75.13,0)
SECONDARY ORDERING ICD DIAG. SUB-FIELD^^8^8
"^DD",75.1,75.13,0,"DT")
3040218
"^DD",75.1,75.13,0,"IX","B",75.13,.01)

"^DD",75.1,75.13,0,"NM","SECONDARY ORDERING ICD DIAG.")

"^DD",75.1,75.13,0,"UP")
75.1
"^DD",75.1,75.13,.01,0)
SECONDARY ORDERING ICD DIAG.^MP80'^ICD9(^0;1^Q
"^DD",75.1,75.13,.01,1,0)
^.1
"^DD",75.1,75.13,.01,1,1,0)
75.13^B
"^DD",75.1,75.13,.01,1,1,1)
S ^RAO(75.1,DA(1),"BAS","B",$E(X,1,30),DA)=""
"^DD",75.1,75.13,.01,1,1,2)
K ^RAO(75.1,DA(1),"BAS","B",$E(X,1,30),DA)
"^DD",75.1,75.13,.01,3)
Enter an ICD diagnosis secindarily responsible for this order.
"^DD",75.1,75.13,.01,21,0)
^.001^1^1^3030922^^
"^DD",75.1,75.13,.01,21,1,0)
This field contains a Secondary Diagnosis responsible for this order.
"^DD",75.1,75.13,.01,"DT")
3030918
"^DD",75.1,75.13,2,0)
SECONDARY DX RELATED TO SC^S^0:NO;1:YES;^0;2^Q
"^DD",75.1,75.13,2,3)
If this order is for treating a Service Connected related problem, enter "YES" here.
"^DD",75.1,75.13,2,21,0)
^^2^2^3030922^
"^DD",75.1,75.13,2,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.13,2,21,2,0)
a VA patient based on a Service Connected related problem.
"^DD",75.1,75.13,2,"DT")
3030922
"^DD",75.1,75.13,3,0)
SECONDARY DX RELATED TO AO^S^0:NO;1:YES;^0;3^Q
"^DD",75.1,75.13,3,3)
If this order is for treating an Agent Orange related problem, enter "YES" here.
"^DD",75.1,75.13,3,21,0)
^.001^2^2^3040218^^
"^DD",75.1,75.13,3,21,1,0)
This field will be used to indicate if this order was for treating 
"^DD",75.1,75.13,3,21,2,0)
a VA patient based on an Agent Orange related problem.
"^DD",75.1,75.13,3,"DT")
3030922
"^DD",75.1,75.13,4,0)
SECONDARY DX RELATED TO IR^S^0:NO;1:YES;^0;4^Q
"^DD",75.1,75.13,4,3)
If this order is for treating an Ionizing Radiation related problem,enter "YES" here.
"^DD",75.1,75.13,4,21,0)
^^2^2^3030922^
"^DD",75.1,75.13,4,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.13,4,21,2,0)
a VA patient based on an Ionizing Radiation related problem.
"^DD",75.1,75.13,4,"DT")
3030922
"^DD",75.1,75.13,5,0)
SECONDARY DX RELATED TO EC^S^0:NO;1:YES;^0;5^Q
"^DD",75.1,75.13,5,3)
If this order is for treating an Environmental Contaminant related problem,enter "YES" here.
"^DD",75.1,75.13,5,21,0)
^^2^2^3030922^
"^DD",75.1,75.13,5,21,1,0)
This field will be used to indicate if this order was for treating 
"^DD",75.1,75.13,5,21,2,0)
a VA patient based on an Environmental Contaminant related problem.
"^DD",75.1,75.13,5,"DT")
3030922
"^DD",75.1,75.13,6,0)
SECONDARY DX RELATED TO MST^S^0:NO;1:YES;^0;6^Q
"^DD",75.1,75.13,6,3)
If this order is for treating a Military Sexual Trauma related problem, enter "YES" here.
"^DD",75.1,75.13,6,21,0)
^^2^2^3030922^
"^DD",75.1,75.13,6,21,1,0)
This field will be used to indicate if this order was for treating
"^DD",75.1,75.13,6,21,2,0)
a VA patient based on a Military Sexual Trauma related problem.
"^DD",75.1,75.13,6,"DT")
3030922
"^DD",75.1,75.13,7,0)
SECONDARY DX RELATED TO HNC^S^0:NO;1:YES;^0;7^Q
"^DD",75.1,75.13,7,3)
If this order is for treating a Head and Neck cancer (HNC) related problem, enter "YES" here.
"^DD",75.1,75.13,7,21,0)
^^2^2^3040526^
"^DD",75.1,75.13,7,21,1,0)
This field will be used to indicate if this order was for treating 
"^DD",75.1,75.13,7,21,2,0)
a VA patient based on a Head and Neck cancer (HNC) related problem.
"^DD",75.1,75.13,7,"DT")
3040526
"^DD",75.1,75.13,8,0)
SECONDARY DX RELATED TO CV^S^0:NO;1:YES;^0;8^Q
"^DD",75.1,75.13,8,3)
If this order is for treating a Combat Veteran related problem, enter "YES" here.
"^DD",75.1,75.13,8,21,0)
^^2^2^3040218^
"^DD",75.1,75.13,8,21,1,0)
This field will be used to indicate if this order was for treating a VA 
"^DD",75.1,75.13,8,21,2,0)
patient based on a Combat Veteran related problem.
"^DD",75.1,75.13,8,"DT")
3040218
"^DD",79.1,79.1,21,0)
CREDIT METHOD^S^0:Regular Credit;1:Interpretation Only;2:No Credit;3:Technical Component Only;^0;21^Q
"^DD",79.1,79.1,21,3)
Enter the type of credit this location will receive for this examination.
"^DD",79.1,79.1,21,9.2)
D EN^DDIOL("'Interpreting Only' and 'Technical Component Only' are for future use.","","!")
"^DD",79.1,79.1,21,21,0)
9^.001^9^9^3031002^^^^
"^DD",79.1,79.1,21,21,1,0)
This field indicates the type of credit this location receives for
"^DD",79.1,79.1,21,21,2,0)
examinations.  The default is REGULAR (code 0), which means that for this
"^DD",79.1,79.1,21,21,3,0)
imaging location both the exam and the interpretation are done at your
"^DD",79.1,79.1,21,21,4,0)
facility. If this imaging location has been set up to register exams done
"^DD",79.1,79.1,21,21,5,0)
in another facility, with the imaging interpretation only done at this
"^DD",79.1,79.1,21,21,6,0)
facility, enter code 1.  If exams are done in this location, but
"^DD",79.1,79.1,21,21,7,0)
interpretation is done elsewhere, enter code 3.  If both the exam and the
"^DD",79.1,79.1,21,21,8,0)
interpretation are done elsewhere, and exams entered for this imaging
"^DD",79.1,79.1,21,21,9,0)
location are entered only for record-keeping purposes, enter code 2.
"^DD",79.1,79.1,21,"DT")
3030826
**INSTALL NAME**
SR*3.0*119
"BLD",4965,0)
SR*3.0*119^SURGERY^0^3050805^y
"BLD",4965,1,0)
^^1^1^3050608^
"BLD",4965,1,1,0)
CLINICAL INDICATOR DATA CAPTURE - SURGERY
"BLD",4965,4,0)
^9.64PA^133^3
"BLD",4965,4,130,0)
130
"BLD",4965,4,130,2,0)
^9.641^130.3513^8
"BLD",4965,4,130,2,130,0)
SURGERY  (File-top level)
"BLD",4965,4,130,2,130,1,0)
^9.6411^.024^14
"BLD",4965,4,130,2,130,1,.024,0)
COMBAT VET
"BLD",4965,4,130,2,130,1,.214,0)
ANES CARE BILLABLE TIME FLAG
"BLD",4965,4,130,2,130,1,.218,0)
ANES CARE BILLABLE TIME
"BLD",4965,4,130,2,130,1,.3511,0)
ANES PERSONALLY PERFORMED
"BLD",4965,4,130,2,130,1,.3512,0)
NUM OF CONCURRENT ANES CASES
"BLD",4965,4,130,2,130,1,.3514,0)
ANES MEDICALLY DIRECTED
"BLD",4965,4,130,2,130,1,.3515,0)
ANES PHYSICIAN AVAILABLE
"BLD",4965,4,130,2,130,1,26,0)
PRINCIPAL PROCEDURE
"BLD",4965,4,130,2,130,1,27,0)
PRINCIPAL PROCEDURE CODE
"BLD",4965,4,130,2,130,1,32,0)
PRINCIPAL PRE-OP DIAGNOSIS
"BLD",4965,4,130,2,130,1,32.5,0)
PRIN PRE-OP ICD DIAGNOSIS CODE
"BLD",4965,4,130,2,130,1,33,0)
PRINCIPAL DIAGNOSIS
"BLD",4965,4,130,2,130,1,34,0)
PRINCIPAL POST-OP DIAG
"BLD",4965,4,130,2,130,1,66,0)
PRIN DIAGNOSIS CODE
"BLD",4965,4,130,2,130.03,0)
REFERRING PHYSICIAN  (sub-file)
"BLD",4965,4,130,2,130.03,1,0)
^9.6411^6^2
"BLD",4965,4,130,2,130.03,1,.01,0)
REFERRING PHYSICIAN
"BLD",4965,4,130,2,130.03,1,6,0)
REF PHY 200 LINK
"BLD",4965,4,130,2,130.16,0)
OTHER PROCEDURES  (sub-file)
"BLD",4965,4,130,2,130.16,1,0)
^9.6411^3^2
"BLD",4965,4,130,2,130.16,1,.01,0)
OTHER PROCEDURE
"BLD",4965,4,130,2,130.16,1,3,0)
OTHER PROCEDURE CPT CODE
"BLD",4965,4,130,2,130.165,0)
OTHER ASSOC DIAGNOSIS  (sub-file)
"BLD",4965,4,130,2,130.165,1,0)
^9.6411^^
"BLD",4965,4,130,2,130.18,0)
OTHER POSTOP DIAGS  (sub-file)
"BLD",4965,4,130,2,130.18,1,0)
^9.6411^10^9
"BLD",4965,4,130,2,130.18,1,.01,0)
OTHER POSTOP DIAGS
"BLD",4965,4,130,2,130.18,1,3,0)
ICD DIAGNOSIS CODE
"BLD",4965,4,130,2,130.18,1,4,0)
SERVICE CONNECTED
"BLD",4965,4,130,2,130.18,1,5,0)
AGENT ORANGE EXPOSURE
"BLD",4965,4,130,2,130.18,1,6,0)
IONIZING RADIATION EXPOSURE
"BLD",4965,4,130,2,130.18,1,7,0)
MILITARY SEXUAL TRAUMA
"BLD",4965,4,130,2,130.18,1,8,0)
HEAD AND/OR NECK CANCER
"BLD",4965,4,130,2,130.18,1,9,0)
ENVIRONMENTAL CONTAMINANTS
"BLD",4965,4,130,2,130.18,1,10,0)
COMBAT VET
"BLD",4965,4,130,2,130.213,0)
ANES CARE TIME BLOCK  (sub-file)
"BLD",4965,4,130,2,130.213,1,0)
^9.6411^^
"BLD",4965,4,130,2,130.275,0)
PRIN ASSOC DIAGNOSIS  (sub-file)
"BLD",4965,4,130,2,130.275,1,0)
^9.6411^^
"BLD",4965,4,130,2,130.3513,0)
ANES CONCURRENT CASES  (sub-file)
"BLD",4965,4,130,2,130.3513,1,0)
^9.6411^^
"BLD",4965,4,130,222)
y^n^p^^^^n^^n
"BLD",4965,4,130,224)

"BLD",4965,4,133,0)
133
"BLD",4965,4,133,2,0)
^9.641^133^1
"BLD",4965,4,133,2,133,0)
SURGERY SITE PARAMETERS  (File-top level)
"BLD",4965,4,133,2,133,1,0)
^9.6411^19^2
"BLD",4965,4,133,2,133,1,18,0)
UPDATES TO PCE
"BLD",4965,4,133,2,133,1,19,0)
ASK CLASSIFICATION QUESTIONS
"BLD",4965,4,133,222)
y^n^p^^^^n^^n
"BLD",4965,4,133,224)

"BLD",4965,4,133.8,0)
133.8
"BLD",4965,4,133.8,2,0)
^9.641^133.801^2
"BLD",4965,4,133.8,2,133.801,0)
PATIENT  (sub-file)
"BLD",4965,4,133.8,2,133.801,1,0)
^9.6411^23^1
"BLD",4965,4,133.8,2,133.801,1,23,0)
COMBAT VET
"BLD",4965,4,133.8,2,133.8013,0)
REFERRING PHYSICIAN  (sub-file)
"BLD",4965,4,133.8,2,133.8013,1,0)
^9.6411^6^2
"BLD",4965,4,133.8,2,133.8013,1,.01,0)
REFERRING PHYSICIAN
"BLD",4965,4,133.8,2,133.8013,1,6,0)
REF PHY 200 LINK
"BLD",4965,4,133.8,222)
y^n^p^^^^n^^n
"BLD",4965,4,133.8,224)

"BLD",4965,4,"APDD",130,130)

"BLD",4965,4,"APDD",130,130,.024)

"BLD",4965,4,"APDD",130,130,.214)

"BLD",4965,4,"APDD",130,130,.218)

"BLD",4965,4,"APDD",130,130,.3511)

"BLD",4965,4,"APDD",130,130,.3512)

"BLD",4965,4,"APDD",130,130,.3514)

"BLD",4965,4,"APDD",130,130,.3515)

"BLD",4965,4,"APDD",130,130,26)

"BLD",4965,4,"APDD",130,130,27)

"BLD",4965,4,"APDD",130,130,32)

"BLD",4965,4,"APDD",130,130,32.5)

"BLD",4965,4,"APDD",130,130,33)

"BLD",4965,4,"APDD",130,130,34)

"BLD",4965,4,"APDD",130,130,66)

"BLD",4965,4,"APDD",130,130.03)

"BLD",4965,4,"APDD",130,130.03,.01)

"BLD",4965,4,"APDD",130,130.03,6)

"BLD",4965,4,"APDD",130,130.16)

"BLD",4965,4,"APDD",130,130.16,.01)

"BLD",4965,4,"APDD",130,130.16,3)

"BLD",4965,4,"APDD",130,130.165)

"BLD",4965,4,"APDD",130,130.18)

"BLD",4965,4,"APDD",130,130.18,.01)

"BLD",4965,4,"APDD",130,130.18,3)

"BLD",4965,4,"APDD",130,130.18,4)

"BLD",4965,4,"APDD",130,130.18,5)

"BLD",4965,4,"APDD",130,130.18,6)

"BLD",4965,4,"APDD",130,130.18,7)

"BLD",4965,4,"APDD",130,130.18,8)

"BLD",4965,4,"APDD",130,130.18,9)

"BLD",4965,4,"APDD",130,130.18,10)

"BLD",4965,4,"APDD",130,130.213)

"BLD",4965,4,"APDD",130,130.275)

"BLD",4965,4,"APDD",130,130.3513)

"BLD",4965,4,"APDD",133,133)

"BLD",4965,4,"APDD",133,133,18)

"BLD",4965,4,"APDD",133,133,19)

"BLD",4965,4,"APDD",133.8,133.801)

"BLD",4965,4,"APDD",133.8,133.801,23)

"BLD",4965,4,"APDD",133.8,133.8013)

"BLD",4965,4,"APDD",133.8,133.8013,.01)

"BLD",4965,4,"APDD",133.8,133.8013,6)

"BLD",4965,4,"B",130,130)

"BLD",4965,4,"B",133,133)

"BLD",4965,4,"B",133.8,133.8)

"BLD",4965,"ABNS",0)
^9.66A^^
"BLD",4965,"ABPKG")
n^n
"BLD",4965,"INID")
^y
"BLD",4965,"INIT")
SR119PI
"BLD",4965,"KRN",0)
^9.67PA^8989.52^19
"BLD",4965,"KRN",.4,0)
.4
"BLD",4965,"KRN",.401,0)
.401
"BLD",4965,"KRN",.402,0)
.402
"BLD",4965,"KRN",.402,"NM",0)
^9.68A^13^12
"BLD",4965,"KRN",.402,"NM",1,0)
SROMEN-ANES    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",3,0)
SRNON-OR    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",4,0)
SROMEN-OPER    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",5,0)
SROMEN-OUT    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",6,0)
SREQUEST    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",7,0)
SRSRES-ENTRY    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",8,0)
SROMEN-START    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",9,0)
SRSCHED-UNREQUESTED    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",10,0)
SRPARAM    FILE #133^133^0
"BLD",4965,"KRN",.402,"NM",11,0)
SRSRES1    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",12,0)
SROMEN-POST    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM",13,0)
SROARPT    FILE #130^130^0
"BLD",4965,"KRN",.402,"NM","B","SREQUEST    FILE #130",6)

"BLD",4965,"KRN",.402,"NM","B","SRNON-OR    FILE #130",3)

"BLD",4965,"KRN",.402,"NM","B","SROARPT    FILE #130",13)

"BLD",4965,"KRN",.402,"NM","B","SROMEN-ANES    FILE #130",1)

"BLD",4965,"KRN",.402,"NM","B","SROMEN-OPER    FILE #130",4)

"BLD",4965,"KRN",.402,"NM","B","SROMEN-OUT    FILE #130",5)

"BLD",4965,"KRN",.402,"NM","B","SROMEN-POST    FILE #130",12)

"BLD",4965,"KRN",.402,"NM","B","SROMEN-START    FILE #130",8)

"BLD",4965,"KRN",.402,"NM","B","SRPARAM    FILE #133",10)

"BLD",4965,"KRN",.402,"NM","B","SRSCHED-UNREQUESTED    FILE #130",9)

"BLD",4965,"KRN",.402,"NM","B","SRSRES-ENTRY    FILE #130",7)

"BLD",4965,"KRN",.402,"NM","B","SRSRES1    FILE #130",11)

"BLD",4965,"KRN",.403,0)
.403
"BLD",4965,"KRN",.5,0)
.5
"BLD",4965,"KRN",.84,0)
.84
"BLD",4965,"KRN",3.6,0)
3.6
"BLD",4965,"KRN",3.8,0)
3.8
"BLD",4965,"KRN",9.2,0)
9.2
"BLD",4965,"KRN",9.8,0)
9.8
"BLD",4965,"KRN",9.8,"NM",0)
^9.68A^19^16
"BLD",4965,"KRN",9.8,"NM",1,0)
SROCON^^0^B9792980
"BLD",4965,"KRN",9.8,"NM",2,0)
SROCON1^^0^B2288672
"BLD",4965,"KRN",9.8,"NM",3,0)
SROANEST^^0^B53233881
"BLD",4965,"KRN",9.8,"NM",4,0)
SROWL^^0^B27135451
"BLD",4965,"KRN",9.8,"NM",5,0)
SROADX^^0^B90954946
"BLD",4965,"KRN",9.8,"NM",6,0)
SROADX1^^0^B91413355
"BLD",4965,"KRN",9.8,"NM",7,0)
SROVER^^0^B25619011
"BLD",4965,"KRN",9.8,"NM",8,0)
SROVER1^^0^B14904185
"BLD",4965,"KRN",9.8,"NM",9,0)
SROVER2^^0^B26717453
"BLD",4965,"KRN",9.8,"NM",10,0)
SROVER3^^0^B34463738
"BLD",4965,"KRN",9.8,"NM",13,0)
SROPCE^^0^B75482609
"BLD",4965,"KRN",9.8,"NM",14,0)
SROPCE1^^0^B37901378
"BLD",4965,"KRN",9.8,"NM",15,0)
SROADX2^^0^B25027264
"BLD",4965,"KRN",9.8,"NM",16,0)
SROPCEX^^0^B9882023
"BLD",4965,"KRN",9.8,"NM",18,0)
SROPCE0^^0^B31414628
"BLD",4965,"KRN",9.8,"NM",19,0)
SR119PI^^0^B573587
"BLD",4965,"KRN",9.8,"NM","B","SR119PI",19)

"BLD",4965,"KRN",9.8,"NM","B","SROADX",5)

"BLD",4965,"KRN",9.8,"NM","B","SROADX1",6)

"BLD",4965,"KRN",9.8,"NM","B","SROADX2",15)

"BLD",4965,"KRN",9.8,"NM","B","SROANEST",3)

"BLD",4965,"KRN",9.8,"NM","B","SROCON",1)

"BLD",4965,"KRN",9.8,"NM","B","SROCON1",2)

"BLD",4965,"KRN",9.8,"NM","B","SROPCE",13)

"BLD",4965,"KRN",9.8,"NM","B","SROPCE0",18)

"BLD",4965,"KRN",9.8,"NM","B","SROPCE1",14)

"BLD",4965,"KRN",9.8,"NM","B","SROPCEX",16)

"BLD",4965,"KRN",9.8,"NM","B","SROVER",7)

"BLD",4965,"KRN",9.8,"NM","B","SROVER1",8)

"BLD",4965,"KRN",9.8,"NM","B","SROVER2",9)

"BLD",4965,"KRN",9.8,"NM","B","SROVER3",10)

"BLD",4965,"KRN",9.8,"NM","B","SROWL",4)

"BLD",4965,"KRN",19,0)
19
"BLD",4965,"KRN",19,"NM",0)
^9.68A^^0
"BLD",4965,"KRN",19.1,0)
19.1
"BLD",4965,"KRN",101,0)
101
"BLD",4965,"KRN",409.61,0)
409.61
"BLD",4965,"KRN",771,0)
771
"BLD",4965,"KRN",870,0)
870
"BLD",4965,"KRN",8989.51,0)
8989.51
"BLD",4965,"KRN",8989.52,0)
8989.52
"BLD",4965,"KRN",8994,0)
8994
"BLD",4965,"KRN","B",.4,.4)

"BLD",4965,"KRN","B",.401,.401)

"BLD",4965,"KRN","B",.402,.402)

"BLD",4965,"KRN","B",.403,.403)

"BLD",4965,"KRN","B",.5,.5)

"BLD",4965,"KRN","B",.84,.84)

"BLD",4965,"KRN","B",3.6,3.6)

"BLD",4965,"KRN","B",3.8,3.8)

"BLD",4965,"KRN","B",9.2,9.2)

"BLD",4965,"KRN","B",9.8,9.8)

"BLD",4965,"KRN","B",19,19)

"BLD",4965,"KRN","B",19.1,19.1)

"BLD",4965,"KRN","B",101,101)

"BLD",4965,"KRN","B",409.61,409.61)

"BLD",4965,"KRN","B",771,771)

"BLD",4965,"KRN","B",870,870)

"BLD",4965,"KRN","B",8989.51,8989.51)

"BLD",4965,"KRN","B",8989.52,8989.52)

"BLD",4965,"KRN","B",8994,8994)

"BLD",4965,"QUES",0)
^9.62^^
"BLD",4965,"REQB",0)
^9.611^11^5
"BLD",4965,"REQB",4,0)
SR*3.0*105^2
"BLD",4965,"REQB",5,0)
SR*3.0*107^2
"BLD",4965,"REQB",8,0)
SR*3.0*50^2
"BLD",4965,"REQB",10,0)
SR*3.0*127^2
"BLD",4965,"REQB",11,0)
SR*3.0*125^2
"BLD",4965,"REQB","B","SR*3.0*105",4)

"BLD",4965,"REQB","B","SR*3.0*107",5)

"BLD",4965,"REQB","B","SR*3.0*125",11)

"BLD",4965,"REQB","B","SR*3.0*127",10)

"BLD",4965,"REQB","B","SR*3.0*50",8)

"FIA",130)
SURGERY
"FIA",130,0)
^SRF(
"FIA",130,0,0)
130IP
"FIA",130,0,1)
y^n^p^^^^n^^n
"FIA",130,0,10)

"FIA",130,0,11)

"FIA",130,0,"RLRO")

"FIA",130,0,"VR")
3.0^SR
"FIA",130,130)
1
"FIA",130,130,.024)

"FIA",130,130,.213)

"FIA",130,130,.214)

"FIA",130,130,.218)

"FIA",130,130,.3511)

"FIA",130,130,.3512)

"FIA",130,130,.3513)

"FIA",130,130,.3514)

"FIA",130,130,.3515)

"FIA",130,130,.42)

"FIA",130,130,.74)

"FIA",130,130,23)

"FIA",130,130,26)

"FIA",130,130,27)

"FIA",130,130,27.5)

"FIA",130,130,32)

"FIA",130,130,32.5)

"FIA",130,130,33)

"FIA",130,130,34)

"FIA",130,130,66)

"FIA",130,130.03)
1
"FIA",130,130.03,.01)

"FIA",130,130.03,6)

"FIA",130,130.16)
1
"FIA",130,130.16,.01)

"FIA",130,130.16,3)

"FIA",130,130.16,5)

"FIA",130,130.165)
0
"FIA",130,130.18)
1
"FIA",130,130.18,.01)

"FIA",130,130.18,3)

"FIA",130,130.18,4)

"FIA",130,130.18,5)

"FIA",130,130.18,6)

"FIA",130,130.18,7)

"FIA",130,130.18,8)

"FIA",130,130.18,9)

"FIA",130,130.18,10)

"FIA",130,130.213)
0
"FIA",130,130.275)
0
"FIA",130,130.3513)
0
"FIA",133)
SURGERY SITE PARAMETERS
"FIA",133,0)
^SRO(133,
"FIA",133,0,0)
133P
"FIA",133,0,1)
y^n^p^^^^n^^n
"FIA",133,0,10)

"FIA",133,0,11)

"FIA",133,0,"RLRO")

"FIA",133,0,"VR")
3.0^SR
"FIA",133,133)
1
"FIA",133,133,18)

"FIA",133,133,19)

"FIA",133.8)
SURGERY WAITING LIST
"FIA",133.8,0)
^SRO(133.8,
"FIA",133.8,0,0)
133.8IP
"FIA",133.8,0,1)
y^n^p^^^^n^^n
"FIA",133.8,0,10)

"FIA",133.8,0,11)

"FIA",133.8,0,"RLRO")

"FIA",133.8,0,"VR")
3.0^SR
"FIA",133.8,133.8)
1
"FIA",133.8,133.801)
1
"FIA",133.8,133.801,3)

"FIA",133.8,133.801,23)

"FIA",133.8,133.8013)
1
"FIA",133.8,133.8013,.01)

"FIA",133.8,133.8013,6)

"INIT")
SR119PI
"IX",130,130,"AD",0)
130^AD^CoreFLS fields monitor flag.^MU^^R^IR^I^130^^^^^A
"IX",130,130,"AD",.1,0)
^^2^2^3020822^
"IX",130,130,"AD",.1,1,0)
This cross-reference will be checked before sending a notification to
"IX",130,130,"AD",.1,2,0)
the CoreFLS software after editing any of these fields.
"IX",130,130,"AD",1)
S ^TMP("CSLSUR1",$J)="" Q
"IX",130,130,"AD",1.4)
N I S (X,I)=0 F  S I=$O(X1(I)) Q:'I  I X1(I)'=X2(I) S X=1 Q
"IX",130,130,"AD",2)
S ^TMP("CSLSUR1",$J)="" Q
"IX",130,130,"AD",2.4)
N I S (X,I)=0 F  S I=$O(X1(I)) Q:'I  I X1(I)'=X2(I) S X=1 Q
"IX",130,130,"AD",2.5)
Q
"IX",130,130,"AD",11.1,0)
^.114IA^11^11
"IX",130,130,"AD",11.1,1,0)
1^F^130^.14^^^F
"IX",130,130,"AD",11.1,2,0)
2^F^130^27^^^F
"IX",130,130,"AD",11.1,3,0)
3^F^130^.02^^^F
"IX",130,130,"AD",11.1,4,0)
4^F^130^.04^^^F
"IX",130,130,"AD",11.1,5,0)
5^F^130^10^^^F
"IX",130,130,"AD",11.1,6,0)
6^F^130^11^^^F
"IX",130,130,"AD",11.1,7,0)
7^F^130^26^^^F
"IX",130,130,"AD",11.1,8,0)
8^F^130^.011^^^F
"IX",130,130,"AD",11.1,9,0)
9^F^130^.09^^^F
"IX",130,130,"AD",11.1,10,0)
10^F^130^35^^^F
"IX",130,130,"AD",11.1,11,0)
11^F^130^.164^^^F
"IX",130,130.16,"AC",0)
130.16^AC^CoreFLS fields monitor flag.^MU^^R^IR^I^130.16^^^^^A
"IX",130,130.16,"AC",.1,0)
^^2^2^3020822^
"IX",130,130.16,"AC",.1,1,0)
This cross-reference will be checked before sending a notification to
"IX",130,130.16,"AC",.1,2,0)
the CoreFLS software after editing any of these fields.
"IX",130,130.16,"AC",1)
S ^TMP("CSLSUR1",$J)="" Q
"IX",130,130.16,"AC",1.4)
N I S (X,I)=0 F  S I=$O(X1(I)) Q:'I  I X1(I)'=X2(I) S X=1 Q
"IX",130,130.16,"AC",2)
S ^TMP("CSLSUR1",$J)="" Q
"IX",130,130.16,"AC",2.4)
N I S (X,I)=0 F  S I=$O(X1(I)) Q:'I  I X1(I)'=X2(I) S X=1 Q
"IX",130,130.16,"AC",2.5)
Q
"IX",130,130.16,"AC",11.1,0)
^.114IA^2^2
"IX",130,130.16,"AC",11.1,1,0)
1^F^130.16^.01^^^F
"IX",130,130.16,"AC",11.1,2,0)
2^F^130.16^3^^^F
"KRN",.402,1393,-1)
0^7
"KRN",.402,1393,0)
SRSRES-ENTRY^3040217.1302^^130^^^3040217
"KRN",.402,1393,"DIAB",1,0,130,0)
26;T
"KRN",.402,1393,"DIAB",1,1,130.03,0)
.01;T
"KRN",.402,1393,"DIAB",1,1,130.065,0)
.01;T
"KRN",.402,1393,"DIAB",1,1,130.14,0)
.01;T
"KRN",.402,1393,"DIAB",1,1,130.16,0)
.01;T
"KRN",.402,1393,"DIAB",1,1,130.17,0)
.01;T
"KRN",.402,1393,"DIAB",2,0,130,0)
.42;T
"KRN",.402,1393,"DIAB",2,1,130.03,0)
1;T
"KRN",.402,1393,"DIAB",2,1,130.14,0)
1;T
"KRN",.402,1393,"DIAB",2,1,130.16,0)
3;T
"KRN",.402,1393,"DIAB",2,1,130.17,0)
2;T
"KRN",.402,1393,"DIAB",3,0,130,0)
27;T
"KRN",.402,1393,"DIAB",3,1,130.03,0)
2;T
"KRN",.402,1393,"DIAB",3,1,130.16,0)
1.5;T
"KRN",.402,1393,"DIAB",4,0,130,0)
32;T
"KRN",.402,1393,"DIAB",4,1,130.03,0)
3;T
"KRN",.402,1393,"DIAB",5,0,130,0)
32.5;T
"KRN",.402,1393,"DIAB",5,1,130.03,0)
4;T
"KRN",.402,1393,"DIAB",6,0,130,0)
PRIN DIAGNOSIS CODE;T
"KRN",.402,1393,"DIAB",6,1,130.03,0)
5;T
"KRN",.402,1393,"DIAB",7,0,130,0)
.72;T
"KRN",.402,1393,"DIAB",8,0,130,0)
.011//I;T
"KRN",.402,1393,"DIAB",9,0,130,0)
56;T
"KRN",.402,1393,"DIAB",10,0,130,0)
.035;T
"KRN",.402,1393,"DIAB",11,0,130,0)
.04;T
"KRN",.402,1393,"DIAB",12,0,130,0)
.14;T
"KRN",.402,1393,"DIAB",13,0,130,0)
.15;T
"KRN",.402,1393,"DIAB",14,0,130,0)
.16;T
"KRN",.402,1393,"DIAB",15,0,130,0)
.164;T
"KRN",.402,1393,"DIAB",16,0,130,0)
.43;T
"KRN",.402,1393,"DIAB",17,0,130,0)
.037;T
"KRN",.402,1393,"DIAB",18,0,130,0)
SURGERY POS;T
"KRN",.402,1393,"DIAB",19,0,130,0)
1.01;T
"KRN",.402,1393,"DIAB",20,0,130,0)
1.02;T
"KRN",.402,1393,"DIAB",21,0,130,0)
1.03;T
"KRN",.402,1393,"DIAB",22,0,130,0)
1.035;T
"KRN",.402,1393,"DIAB",23,0,130,0)
38;T
"KRN",.402,1393,"DIAB",24,0,130,0)
40;T
"KRN",.402,1393,"DIAB",25,0,130,0)
1.05;T
"KRN",.402,1393,"DIAB",26,0,130,0)
1.04;T
"KRN",.402,1393,"DIAB",27,0,130,0)
.05;T
"KRN",.402,1393,"DIAB",28,0,130,0)
23;T
"KRN",.402,1393,"DIAB",29,0,130,0)
.28;T
"KRN",.402,1393,"DIAB",30,0,130,0)
55;T
"KRN",.402,1393,"DIAB",31,0,130,0)
BRIEF;T
"KRN",.402,1393,"DIAB",32,0,130,0)
80;T
"KRN",.402,1393,"DR",1,130)
26T~;.42T~;27T~;32T~;32.5T~;66T~;.72T~;.011T~//I;56T~;.035T~;.04T~;.14T~;.15T~;.16T~;.164T~;.43T~;.037T~;65T~;1.01T~;1.02T~;1.03T~;1.035T~;38T~;40T~;1.05T~;1.04T~;.05T~;23T~;.28T~;55T~;60T~;80T~;
"KRN",.402,1393,"DR",2,130.03)
.01T~;1T~;2T~;3T~;4T~;5T~;
"KRN",.402,1393,"DR",2,130.065)
.01T~;
"KRN",.402,1393,"DR",2,130.14)
.01T~;1T~;
"KRN",.402,1393,"DR",2,130.16)
.01T~;3T~;1.5T~;
"KRN",.402,1393,"DR",2,130.17)
.01T~;2T~;
"KRN",.402,1394,-1)
0^1
"KRN",.402,1394,0)
SROMEN-ANES^3031003.1608^^130^^^3041122
"KRN",.402,1394,"DIAB",1,0,130,0)
.34;T
"KRN",.402,1394,"DIAB",1,1,130.04,0)
.01;T
"KRN",.402,1394,"DIAB",1,1,130.06,0)
.01;T
"KRN",.402,1394,"DIAB",1,1,130.213,0)
.01;T
"KRN",.402,1394,"DIAB",1,1,130.32,0)
.01;T
"KRN",.402,1394,"DIAB",1,1,130.33,0)
.01;T
"KRN",.402,1394,"DIAB",1,1,130.3513,0)
.01;T
"KRN",.402,1394,"DIAB",1,1,130.41,0)
.01;T
"KRN",.402,1394,"DIAB",1,2,130.34,0)
.01;T
"KRN",.402,1394,"DIAB",2,0,130,0)
.345;T
"KRN",.402,1394,"DIAB",2,1,130.04,0)
1;T
"KRN",.402,1394,"DIAB",2,1,130.06,0)
.05;T
"KRN",.402,1394,"DIAB",2,1,130.213,0)
1;T
"KRN",.402,1394,"DIAB",2,1,130.32,0)
1;T
"KRN",.402,1394,"DIAB",2,1,130.33,0)
1;T
"KRN",.402,1394,"DIAB",2,1,130.41,0)
1;T
"KRN",.402,1394,"DIAB",2,2,130.34,0)
1;T
"KRN",.402,1394,"DIAB",3,0,130,0)
.31;T
"KRN",.402,1394,"DIAB",3,1,130.04,0)
3;T
"KRN",.402,1394,"DIAB",3,1,130.06,0)
42;T
"KRN",.402,1394,"DIAB",3,1,130.32,0)
2;T
"KRN",.402,1394,"DIAB",3,1,130.41,0)
2;T
"KRN",.402,1394,"DIAB",3,2,130.34,0)
4;T
"KRN",.402,1394,"DIAB",4,0,130,0)
.32;T
"KRN",.402,1394,"DIAB",4,1,130.04,0)
4;T
"KRN",.402,1394,"DIAB",4,1,130.06,0)
12;T
"KRN",.402,1394,"DIAB",4,1,130.32,0)
3;T
"KRN",.402,1394,"DIAB",4,1,130.41,0)
3;T
"KRN",.402,1394,"DIAB",5,0,130,0)
.33;T
"KRN",.402,1394,"DIAB",5,1,130.04,0)
5;T
"KRN",.402,1394,"DIAB",6,0,130,0)
.213;T
"KRN",.402,1394,"DIAB",7,0,130,0)
.215;T
"KRN",.402,1394,"DIAB",8,0,130,0)
1.13;T
"KRN",.402,1394,"DIAB",9,0,130,0)
.25;T
"KRN",.402,1394,"DIAB",10,0,130,0)
.36;T
"KRN",.402,1394,"DIAB",11,0,130,0)
.65;T
"KRN",.402,1394,"DIAB",12,0,130,0)
.255;T
"KRN",.402,1394,"DIAB",13,0,130,0)
.46;T
"KRN",.402,1394,"DIAB",14,0,130,0)
1.19;T
"KRN",.402,1394,"DIAB",15,0,130,0)
901.1;T
"KRN",.402,1394,"DIAB",16,0,130,0)
901.2;T
"KRN",.402,1394,"DIAB",17,0,130,0)
.27;T
"KRN",.402,1394,"DIAB",18,0,130,0)
.375;T
"KRN",.402,1394,"DIAB",19,0,130,0)
.293;T
"KRN",.402,1394,"DIAB",20,0,130,0)
.28;T
"KRN",.402,1394,"DIAB",21,0,130,0)
.757;T
"KRN",.402,1394,"DIAB",22,0,130,0)
.37;T
"KRN",.402,1394,"DIAB",23,0,130,0)
.3511;T
"KRN",.402,1394,"DIAB",24,0,130,0)
.3512;T
"KRN",.402,1394,"DIAB",25,0,130,0)
.3513;T
"KRN",.402,1394,"DIAB",26,0,130,0)
.3514;T
"KRN",.402,1394,"DIAB",27,0,130,0)
.3515;T
"KRN",.402,1394,"DR",1,130)
.34T~;.345T~;.31T~;.32T~;.33T~;.213T~;.215T~;1.13T~;.25T~;.36T~;.65T~;.255T~;.46T~;1.19T~;901.1T~;901.2T~;.27T~;.375T~;.293T~;.28T~;.757T~;.37T~;.3511T~;.3512T~;.3513T~;.3514T~;.3515T~;
"KRN",.402,1394,"DR",2,130.04)
.01T~;1T~;3T~;4T~;5T~;
"KRN",.402,1394,"DR",2,130.06)
.01T~;.05T~;42T~;12T~;
"KRN",.402,1394,"DR",2,130.213)
.01T~;1T~;
"KRN",.402,1394,"DR",2,130.32)
.01T~;1T~;2T~;3T~;
"KRN",.402,1394,"DR",2,130.33)
.01T~;1T~;
"KRN",.402,1394,"DR",2,130.3513)
.01T~;
"KRN",.402,1394,"DR",2,130.41)
.01T~;1T~;2T~;3T~;
"KRN",.402,1394,"DR",3,130.34)
.01T~;1T~;4T~;
"KRN",.402,1395,-1)
0^5
"KRN",.402,1395,0)
SROMEN-OUT^3040915.1243^^130^^^3040915
"KRN",.402,1395,"DIAB",1,0,130,0)
.09;T
"KRN",.402,1395,"DIAB",1,0,130,1)
.37;T
"KRN",.402,1395,"DIAB",1,1,130.042,0)
.01;T
"KRN",.402,1395,"DIAB",1,1,130.06,0)
.01;T
"KRN",.402,1395,"DIAB",1,1,130.16,0)
.01;T
"KRN",.402,1395,"DIAB",1,1,130.17,0)
.01;T
"KRN",.402,1395,"DIAB",1,1,130.213,0)
.01;T
"KRN",.402,1395,"DIAB",1,1,130.28,0)
.01;T
"KRN",.402,1395,"DIAB",1,1,130.36,0)
.01;T
"KRN",.402,1395,"DIAB",1,2,130.29,0)
.01;T
"KRN",.402,1395,"DIAB",1,2,130.37,0)
.01;T
"KRN",.402,1395,"DIAB",1,2,130.47,0)
.01;T
"KRN",.402,1395,"DIAB",2,0,130,0)
.011//OUT;T
"KRN",.402,1395,"DIAB",2,0,130,1)
.213;T
"KRN",.402,1395,"DIAB",2,1,130.042,0)
1;T
"KRN",.402,1395,"DIAB",2,1,130.06,0)
.05//YES;T
"KRN",.402,1395,"DIAB",2,1,130.16,0)
3;T
"KRN",.402,1395,"DIAB",2,1,130.17,0)
2;T
"KRN",.402,1395,"DIAB",2,1,130.213,0)
1;T
"KRN",.402,1395,"DIAB",2,1,130.28,0)
2;T
"KRN",.402,1395,"DIAB",2,1,130.36,0)
1;T
"KRN",.402,1395,"DIAB",2,2,130.29,0)
1;T
"KRN",.402,1395,"DIAB",2,2,130.37,0)
1;T
"KRN",.402,1395,"DIAB",2,2,130.47,0)
1;T
"KRN",.402,1395,"DIAB",3,0,130,0)
.14;T
"KRN",.402,1395,"DIAB",3,0,130,1)
42;T
"KRN",.402,1395,"DIAB",3,1,130.042,0)
2;T
"KRN",.402,1395,"DIAB",3,1,130.06,0)
24;T
"KRN",.402,1395,"DIAB",3,1,130.28,0)
3;T
"KRN",.402,1395,"DIAB",3,1,130.36,0)
3;T
"KRN",.402,1395,"DIAB",3,2,130.29,0)
2;T
"KRN",.402,1395,"DIAB",3,2,130.37,0)
2;T
"KRN",.402,1395,"DIAB",4,0,130,0)
32;T
"KRN",.402,1395,"DIAB",4,0,130,1)
17;T
"KRN",.402,1395,"DIAB",4,2,130.29,0)
3;T
"KRN",.402,1395,"DIAB",4,2,130.37,0)
3;T
"KRN",.402,1395,"DIAB",5,0,130,0)
32.5;T
"KRN",.402,1395,"DIAB",5,0,130,1)
18;T
"KRN",.402,1395,"DIAB",6,0,130,0)
66;T
"KRN",.402,1395,"DIAB",7,0,130,0)
.72;T
"KRN",.402,1395,"DIAB",8,0,130,0)
26;T
"KRN",.402,1395,"DIAB",9,0,130,0)
27;T
"KRN",.402,1395,"DIAB",10,0,130,0)
.42;T
"KRN",.402,1395,"DIAB",11,0,130,0)
.205;T
"KRN",.402,1395,"DIAB",12,0,130,0)
73;T
"KRN",.402,1395,"DIAB",13,0,130,0)
72;T
"KRN",.402,1395,"DIAB",14,0,130,0)
71;T
"KRN",.402,1395,"DIAB",15,0,130,0)
84;T
"KRN",.402,1395,"DIAB",16,0,130,0)
83;T
"KRN",.402,1395,"DIAB",17,0,130,0)
82;T
"KRN",.402,1395,"DIAB",18,0,130,0)
.22;T
"KRN",.402,1395,"DIAB",19,0,130,0)
.23;T
"KRN",.402,1395,"DIAB",20,0,130,0)
.232;T
"KRN",.402,1395,"DIAB",21,0,130,0)
63;T
"KRN",.402,1395,"DIAB",22,0,130,0)
.111;T
"KRN",.402,1395,"DIAB",23,0,130,0)
.112;T
"KRN",.402,1395,"DIAB",24,0,130,0)
.02;T
"KRN",.402,1395,"DIAB",25,0,130,0)
.15;T
"KRN",.402,1395,"DIAB",26,0,130,0)
44;T
"KRN",.402,1395,"DIAB",27,0,130,0)
45;T
"KRN",.402,1395,"DIAB",28,0,130,0)
46;T
"KRN",.402,1395,"DIAB",29,0,130,0)
47;T
"KRN",.402,1395,"DIAB",30,0,130,0)
48;T
"KRN",.402,1395,"DIAB",31,0,130,0)
.04;T
"KRN",.402,1395,"DIAB",32,0,130,0)
1.09;T
"KRN",.402,1395,"DIAB",33,0,130,0)
.164;T
"KRN",.402,1395,"DIAB",34,0,130,0)
.166;T
"KRN",.402,1395,"DIAB",35,0,130,0)
49;T
"KRN",.402,1395,"DIAB",36,0,130,0)
64;T
"KRN",.402,1395,"DIAB",37,0,130,0)
.29;T
"KRN",.402,1395,"DIAB",38,0,130,0)
1.13;T
"KRN",.402,1395,"DIAB",39,0,130,0)
.31;T
"KRN",.402,1395,"DR",1,130)
.09T~;.011T~//OUT;.14T~;32T~;32.5T~;66T~;.72T~;26T~;27T~;.42T~;.205T~;73T~;72T~;71T~;84T~;83T~;82T~;.22T~;.23T~;.232T~;63T~;.111T~;.112T~;.02T~;.15T~;44T~;45T~;46T~;47T~;48T~;.04T~;1.09T~;.164T~;.166T~;49T~;64T~;.29T~;1.13T~;.31T~;
"KRN",.402,1395,"DR",1,130,1)
.37T~;.213T~;42T~;17T~;18T~;
"KRN",.402,1395,"DR",2,130.042)
.01T~;1T~;2T~;
"KRN",.402,1395,"DR",2,130.06)
.01T~;.05T~//YES;24T~;
"KRN",.402,1395,"DR",2,130.16)
.01T~;3T~;
"KRN",.402,1395,"DR",2,130.17)
.01T~;2T~;
"KRN",.402,1395,"DR",2,130.213)
.01T~;1T~;
"KRN",.402,1395,"DR",2,130.28)
.01T~;2T~;3T~;
"KRN",.402,1395,"DR",2,130.36)
.01T~;1T~;3T~;
"KRN",.402,1395,"DR",3,130.29)
.01T~;1T~;2T~;3T~;
"KRN",.402,1395,"DR",3,130.37)
.01T~;1T~;2T~;3T~;
"KRN",.402,1395,"DR",3,130.47)
.01T~;1T~;
"KRN",.402,1396,-1)
0^12
"KRN",.402,1396,0)
SROMEN-POST^3040915.1251^^130^^^3040915
"KRN",.402,1396,"DIAB",1,0,130,0)
41;T
"KRN",.402,1396,"DIAB",1,1,130.16,0)
.01;T
"KRN",.402,1396,"DIAB",1,1,130.18,0)
.01;T
"KRN",.402,1396,"DIAB",1,1,130.213,0)
.01;T
"KRN",.402,1396,"DIAB",2,0,130,0)
.875;T
"KRN",.402,1396,"DIAB",2,1,130.16,0)
3;T
"KRN",.402,1396,"DIAB",2,1,130.213,0)
1;T
"KRN",.402,1396,"DIAB",3,0,130,0)
22;T
"KRN",.402,1396,"DIAB",3,1,130.16,0)
1.5;T
"KRN",.402,1396,"DIAB",3,1,130.18,0)
2;T
"KRN",.402,1396,"DIAB",4,0,130,0)
.25;T
"KRN",.402,1396,"DIAB",5,0,130,0)
.255;T
"KRN",.402,1396,"DIAB",6,0,130,0)
62;T
"KRN",.402,1396,"DIAB",7,0,130,0)
1.09;T
"KRN",.402,1396,"DIAB",8,0,130,0)
.81;T
"KRN",.402,1396,"DIAB",9,0,130,0)
.821;T
"KRN",.402,1396,"DIAB",10,0,130,0)
.76;T
"KRN",.402,1396,"DIAB",11,0,130,0)
.23;T
"KRN",.402,1396,"DIAB",12,0,130,0)
.213;T
"KRN",.402,1396,"DIAB",13,0,130,0)
.232;T
"KRN",.402,1396,"DIAB",14,0,130,0)
.46;T
"KRN",.402,1396,"DIAB",15,0,130,0)
25;T
"KRN",.402,1396,"DIAB",16,0,130,0)
34;T
"KRN",.402,1396,"DIAB",17,0,130,0)
66;T
"KRN",.402,1396,"DIAB",18,0,130,0)
.74;T
"KRN",.402,1396,"DIAB",19,0,130,0)
26;T
"KRN",.402,1396,"DIAB",20,0,130,0)
27;T
"KRN",.402,1396,"DIAB",21,0,130,0)
.42;T
"KRN",.402,1396,"DIAB",22,0,130,0)
.166;T
"KRN",.402,1396,"DR",1,130)
41T~;.875T~;22T~;.25T~;.255T~;62T~;1.09T~;.81T~;.821T~;.76T~;.23T~;.213T~;.232T~;.46T~;25T~;34T~;66T~;.74T~;26T~;27T~;.42T~;.166T~;
"KRN",.402,1396,"DR",2,130.16)
.01T~;3T~;1.5T~;
"KRN",.402,1396,"DR",2,130.18)
.01T~;3;2T~;
"KRN",.402,1396,"DR",2,130.213)
.01T~;1T~;
"KRN",.402,1397,-1)
0^4
"KRN",.402,1397,0)
SROMEN-OPER^3040915.1228^^130^^^3040915
"KRN",.402,1397,"DIAB",1,0,130,0)
.203;T
"KRN",.402,1397,"DIAB",1,0,130,1)
60;T
"KRN",.402,1397,"DIAB",1,1,130.01,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.0129,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.013,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.02,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.04,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.08,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.16,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.213,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.32,0)
.01;T
"KRN",.402,1397,"DIAB",1,1,130.33,0)
.01;T
"KRN",.402,1397,"DIAB",1,2,130.0134,0)
.01;T
"KRN",.402,1397,"DIAB",1,2,130.34,0)
.01;T
"KRN",.402,1397,"DIAB",1,2,130.39,0)
.01;T
"KRN",.402,1397,"DIAB",2,0,130,0)
.205;T
"KRN",.402,1397,"DIAB",2,1,130.01,0)
1;T
"KRN",.402,1397,"DIAB",2,1,130.0129,0)
1;T
"KRN",.402,1397,"DIAB",2,1,130.013,0)
1;T
"KRN",.402,1397,"DIAB",2,1,130.02,0)
1;T
"KRN",.402,1397,"DIAB",2,1,130.04,0)
1;T
"KRN",.402,1397,"DIAB",2,1,130.08,0)
1;T
"KRN",.402,1397,"DIAB",2,1,130.16,0)
3;T
"KRN",.402,1397,"DIAB",2,1,130.213,0)
1;T
"KRN",.402,1397,"DIAB",2,1,130.32,0)
1;T
"KRN",.402,1397,"DIAB",2,1,130.33,0)
1;T
"KRN",.402,1397,"DIAB",2,2,130.0134,0)
1;T
"KRN",.402,1397,"DIAB",2,2,130.34,0)
1;T
"KRN",.402,1397,"DIAB",2,2,130.39,0)
1;T
"KRN",.402,1397,"DIAB",3,0,130,0)
73;T
"KRN",.402,1397,"DIAB",3,1,130.01,0)
2;T
"KRN",.402,1397,"DIAB",3,1,130.0129,0)
2;T
"KRN",.402,1397,"DIAB",3,1,130.013,0)
2;T
"KRN",.402,1397,"DIAB",3,1,130.02,0)
2;T
"KRN",.402,1397,"DIAB",3,1,130.04,0)
3;T
"KRN",.402,1397,"DIAB",3,1,130.16,0)
1.5;T
"KRN",.402,1397,"DIAB",3,1,130.32,0)
2;T
"KRN",.402,1397,"DIAB",3,2,130.0134,0)
2;T
"KRN",.402,1397,"DIAB",3,2,130.34,0)
2;T
"KRN",.402,1397,"DIAB",3,2,130.39,0)
2;T
"KRN",.402,1397,"DIAB",4,0,130,0)
72;T
"KRN",.402,1397,"DIAB",4,1,130.01,0)
2.5;T
"KRN",.402,1397,"DIAB",4,1,130.0129,0)
4;T
"KRN",.402,1397,"DIAB",4,1,130.013,0)
3;T
"KRN",.402,1397,"DIAB",4,1,130.02,0)
3;T
"KRN",.402,1397,"DIAB",4,1,130.04,0)
4;T
"KRN",.402,1397,"DIAB",4,1,130.32,0)
3;T
"KRN",.402,1397,"DIAB",4,2,130.34,0)
3;T
"KRN",.402,1397,"DIAB",5,0,130,0)
71;T
"KRN",.402,1397,"DIAB",5,1,130.01,0)
5;T
"KRN",.402,1397,"DIAB",5,1,130.0129,0)
3;T
"KRN",.402,1397,"DIAB",5,1,130.013,0)
4;T
"KRN",.402,1397,"DIAB",5,1,130.02,0)
4;T
"KRN",.402,1397,"DIAB",5,1,130.04,0)
5;T
"KRN",.402,1397,"DIAB",5,2,130.34,0)
4;T
"KRN",.402,1397,"DIAB",6,0,130,0)
84;T
"KRN",.402,1397,"DIAB",6,1,130.01,0)
6;T
"KRN",.402,1397,"DIAB",6,1,130.0129,0)
5;T
"KRN",.402,1397,"DIAB",6,2,130.34,0)
5;T
"KRN",.402,1397,"DIAB",7,0,130,0)
83;T
"KRN",.402,1397,"DIAB",7,1,130.01,0)
7;T
"KRN",.402,1397,"DIAB",8,0,130,0)
82;T
"KRN",.402,1397,"DIAB",9,0,130,0)
.213;T
"KRN",.402,1397,"DIAB",10,0,130,0)
.22;T
"KRN",.402,1397,"DIAB",16,0,130,0)
49;T
"KRN",.402,1397,"DIAB",17,0,130,0)
64;T
"KRN",.402,1397,"DIAB",18,0,130,0)
.757;T
"KRN",.402,1397,"DIAB",19,0,130,0)
.75;T
"KRN",.402,1397,"DIAB",20,0,130,0)
57;T
"KRN",.402,1397,"DIAB",21,0,130,0)
58;T
"KRN",.402,1397,"DIAB",22,0,130,0)
.48;T
"KRN",.402,1397,"DIAB",23,0,130,0)
.47;T
"KRN",.402,1397,"DIAB",24,0,130,0)
.27;T
"KRN",.402,1397,"DIAB",25,0,130,0)
.39;T
"KRN",.402,1397,"DIAB",26,0,130,0)
.375;T
"KRN",.402,1397,"DIAB",27,0,130,0)
44;T
"KRN",.402,1397,"DIAB",28,0,130,0)
45;T
"KRN",.402,1397,"DIAB",29,0,130,0)
46;T
"KRN",.402,1397,"DIAB",30,0,130,0)
47;T
"KRN",.402,1397,"DIAB",31,0,130,0)
48;T
"KRN",.402,1397,"DIAB",32,0,130,0)
127;T
"KRN",.402,1397,"DIAB",33,0,130,0)
129;T
"KRN",.402,1397,"DIAB",34,0,130,0)
130;T
"KRN",.402,1397,"DIAB",35,0,130,0)
.29;T
"KRN",.402,1397,"DIAB",36,0,130,0)
32;T
"KRN",.402,1397,"DIAB",37,0,130,0)
32.5;T
"KRN",.402,1397,"DIAB",38,0,130,0)
66;T
"KRN",.402,1397,"DIAB",39,0,130,0)
26;T
"KRN",.402,1397,"DIAB",40,0,130,0)
27;T
"KRN",.402,1397,"DIAB",41,0,130,0)
.42;T
"KRN",.402,1397,"DIAB",42,0,130,0)
55;T
"KRN",.402,1397,"DR",1,130)
.203T~;.205T~;73T~;72T~;71T~;84T~;83T~;82T~;.213T~;.22T~;W !;W !;W !;W !;W !;49T~;64T~;.757T~;.75T~;57T~;58T~;.48T~;.47T~;.27T~;.39T~;.375T~;44T~;45T~;46T~;47T~;48T~;127T~;129T~;130T~;.29T~;32T~;32.5T~;66T~;26T~;27T~;.42T~;55T~;
"KRN",.402,1397,"DR",1,130,1)
60T~;
"KRN",.402,1397,"DR",2,130.01)
.01T~;1T~;2T~;2.5T~;5T~;6T~;7T~;
"KRN",.402,1397,"DR",2,130.0129)
.01T~;1T~;2T~;4T~;3T~;5T~;
"KRN",.402,1397,"DR",2,130.013)
.01T~;1T~;2T~;3T~;4T~;
"KRN",.402,1397,"DR",2,130.02)
.01T~;1T~;2T~;3T~;4T~;
"KRN",.402,1397,"DR",2,130.04)
.01T~;1T~;3T~;4T~;5T~;
"KRN",.402,1397,"DR",2,130.08)
.01T~;1T~;
"KRN",.402,1397,"DR",2,130.16)
.01T~;3T~;1.5T~;
"KRN",.402,1397,"DR",2,130.213)
.01T~;1T~;
"KRN",.402,1397,"DR",2,130.32)
.01T~;1T~;2T~;3T~;
"KRN",.402,1397,"DR",2,130.33)
.01T~;1T~;
"KRN",.402,1397,"DR",3,130.0134)
.01T~;1T~;2T~;
"KRN",.402,1397,"DR",3,130.34)
.01T~;1T~;2T~;3T~;4T~;5T~;
"KRN",.402,1397,"DR",3,130.39)
.01T~;1T~;2T~;
"KRN",.402,1400,-1)
0^11
"KRN",.402,1400,0)
SRSRES1^3040407.1409^^130^^^3050324
"KRN",.402,1400,"DIAB",1,1,130.03,0)
.01;T
"KRN",.402,1400,"DIAB",1,1,130.065,0)
.01;T
"KRN",.402,1400,"DIAB",2,0,130,0)
32;T
"KRN",.402,1400,"DIAB",2,1,130.03,0)
1;T
"KRN",.402,1400,"DIAB",3,0,130,0)
32.5;T
"KRN",.402,1400,"DIAB",3,1,130.03,0)
2;T
"KRN",.402,1400,"DIAB",4,0,130,0)
PRIN DIAGNOSIS CODE;T
"KRN",.402,1400,"DIAB",4,1,130.03,0)
3;T
"KRN",.402,1400,"DIAB",5,0,130,0)
.011//I;T
"KRN",.402,1400,"DIAB",5,1,130.03,0)
4;T
"KRN",.402,1400,"DIAB",6,0,130,0)
.035;T
"KRN",.402,1400,"DIAB",6,1,130.03,0)
5;T
"KRN",.402,1400,"DIAB",7,0,130,0)
.15;T
"KRN",.402,1400,"DIAB",8,0,130,0)
.16;T
"KRN",.402,1400,"DIAB",10,0,130,0)
.164;T
"KRN",.402,1400,"DIAB",11,0,130,0)
.43;T
"KRN",.402,1400,"DIAB",12,0,130,0)
.037;T
"KRN",.402,1400,"DIAB",13,0,130,0)
SURGERY POS;T
"KRN",.402,1400,"DIAB",14,0,130,0)
1.01;T
"KRN",.402,1400,"DIAB",15,0,130,0)
1.02;T
"KRN",.402,1400,"DIAB",16,0,130,0)
1.03;T
"KRN",.402,1400,"DIAB",17,0,130,0)
1.035;T
"KRN",.402,1400,"DIAB",18,0,130,0)
1.04;T
"KRN",.402,1400,"DIAB",19,0,130,0)
.05;T
"KRN",.402,1400,"DIAB",20,0,130,0)
23;T
"KRN",.402,1400,"DIAB",21,0,130,0)
.28;T
"KRN",.402,1400,"DIAB",22,0,130,0)
80;T
"KRN",.402,1400,"DR",1,130)
W !;32T~;32.5T~;66T~;.011T~//I;.035T~;.15T~;.16T~;Q;.164T~;.43T~;.037T~;65T~;1.01T~;1.02T~;1.03T~;1.035T~;1.04T~;.05T~;23T~;.28T~;80T~;
"KRN",.402,1400,"DR",2,130.03)
.01T~;1T~;2T~;3T~;4T~;5T~;
"KRN",.402,1400,"DR",2,130.065)
.01T~;
"KRN",.402,1409,-1)
0^8
"KRN",.402,1409,0)
SROMEN-START^3040915.1258^^130^^^3040915
"KRN",.402,1409,"DIAB",1,0,130,0)
.09;T
"KRN",.402,1409,"DIAB",1,1,130.042,0)
.01;T
"KRN",.402,1409,"DIAB",1,1,130.065,0)
.01;T
"KRN",.402,1409,"DIAB",1,1,130.17,0)
.01;T
"KRN",.402,1409,"DIAB",1,1,130.31,0)
.01;T
"KRN",.402,1409,"DIAB",2,0,130,0)
32;T
"KRN",.402,1409,"DIAB",2,1,130.042,0)
1;T
"KRN",.402,1409,"DIAB",2,1,130.065,0)
1;T
"KRN",.402,1409,"DIAB",2,1,130.17,0)
3;T
"KRN",.402,1409,"DIAB",2,1,130.31,0)
1;T
"KRN",.402,1409,"DIAB",3,0,130,0)
32.5;T
"KRN",.402,1409,"DIAB",3,1,130.042,0)
2;T
"KRN",.402,1409,"DIAB",3,1,130.17,0)
2;T
"KRN",.402,1409,"DIAB",4,0,130,0)
.72;T
"KRN",.402,1409,"DIAB",5,0,130,0)
.02;T
"KRN",.402,1409,"DIAB",6,0,130,0)
.04;T
"KRN",.402,1409,"DIAB",7,0,130,0)
.03;T
"KRN",.402,1409,"DIAB",8,0,130,0)
.43;T
"KRN",.402,1409,"DIAB",9,0,130,0)
.035;T
"KRN",.402,1409,"DIAB",10,0,130,0)
1.01;T
"KRN",.402,1409,"DIAB",11,0,130,0)
.971;T
"KRN",.402,1409,"DIAB",12,0,130,0)
17;T
"KRN",.402,1409,"DIAB",13,0,130,0)
18;T
"KRN",.402,1409,"DIAB",14,0,130,0)
67;T
"KRN",.402,1409,"DIAB",15,0,130,0)
42;T
"KRN",.402,1409,"DIAB",16,0,130,0)
.69;T
"KRN",.402,1409,"DIAB",17,0,130,0)
73;T
"KRN",.402,1409,"DIAB",18,0,130,0)
72;T
"KRN",.402,1409,"DIAB",19,0,130,0)
71;T
"KRN",.402,1409,"DIAB",20,0,130,0)
84;T
"KRN",.402,1409,"DIAB",21,0,130,0)
83;T
"KRN",.402,1409,"DIAB",22,0,130,0)
82;T
"KRN",.402,1409,"DIAB",23,0,130,0)
1.13;T
"KRN",.402,1409,"DIAB",24,0,130,0)
.19;T
"KRN",.402,1409,"DIAB",25,0,130,0)
.196;T
"KRN",.402,1409,"DIAB",26,0,130,0)
.07;T
"KRN",.402,1409,"DIAB",27,0,130,0)
.11;T
"KRN",.402,1409,"DIAB",28,0,130,0)
.12;T
"KRN",.402,1409,"DIAB",29,0,130,0)
.18;T
"KRN",.402,1409,"DIAB",30,0,130,0)
4;T
"KRN",.402,1409,"DIAB",31,0,130,0)
.175;T
"KRN",.402,1409,"DIAB",32,0,130,0)
8;T
"KRN",.402,1409,"DIAB",33,0,130,0)
65;T
"KRN",.402,1409,"DIAB",34,0,130,0)
.13;T
"KRN",.402,1409,"DIAB",35,0,130,0)
.55;T
"KRN",.402,1409,"DIAB",36,0,130,0)
6;T
"KRN",.402,1409,"DR",1,130)
.09T~;32T~;32.5T~;.72T~;.02T~;.04T~;.03T~;.43T~;.035T~;1.01T~;.971T~;17T~;18T~;67T~;42T~;.69T~;73T~;72T~;71T~;84T~;83T~;82T~;1.13T~;.19T~;.196T~;.07T~;.11T~;.12T~;.18T~;4T~;.175T~;8T~;65T~;.13T~;.55T~;6T~;
"KRN",.402,1409,"DR",2,130.042)
.01T~;1T~;2T~;
"KRN",.402,1409,"DR",2,130.065)
.01T~;1T~;
"KRN",.402,1409,"DR",2,130.17)
.01T~;3T~;2T~;
"KRN",.402,1409,"DR",2,130.31)
.01T~;1T~;
"KRN",.402,1411,-1)
0^3
"KRN",.402,1411,0)
SRNON-OR^3040915.111^^130^^^3040915
"KRN",.402,1411,"DIAB",1,0,130,0)
120;T
"KRN",.402,1411,"DIAB",1,1,130.0126,0)
.01;T
"KRN",.402,1411,"DIAB",1,1,130.06,0)
.01;T
"KRN",.402,1411,"DIAB",1,1,130.16,0)
.01;T
"KRN",.402,1411,"DIAB",1,1,130.18,0)
.01;T
"KRN",.402,1411,"DIAB",1,1,130.213,0)
.01;T
"KRN",.402,1411,"DIAB",1,2,130.47,0)
.01;T
"KRN",.402,1411,"DIAB",2,0,130,0)
26;T
"KRN",.402,1411,"DIAB",2,1,130.0126,0)
1;T
"KRN",.402,1411,"DIAB",2,1,130.06,0)
.05//YES;T
"KRN",.402,1411,"DIAB",2,1,130.16,0)
3;T
"KRN",.402,1411,"DIAB",2,1,130.18,0)
3;T
"KRN",.402,1411,"DIAB",2,1,130.213,0)
1;T
"KRN",.402,1411,"DIAB",2,2,130.47,0)
1;T
"KRN",.402,1411,"DIAB",3,0,130,0)
27;T
"KRN",.402,1411,"DIAB",3,1,130.0126,0)
2;T
"KRN",.402,1411,"DIAB",3,1,130.06,0)
24;T
"KRN",.402,1411,"DIAB",3,1,130.16,0)
1.5;T
"KRN",.402,1411,"DIAB",4,0,130,0)
125;T
"KRN",.402,1411,"DIAB",4,1,130.0126,0)
3;T
"KRN",.402,1411,"DIAB",5,0,130,0)
1004;T
"KRN",.402,1411,"DIAB",5,1,130.0126,0)
4;T
"KRN",.402,1411,"DIAB",6,0,130,0)
.011;T
"KRN",.402,1411,"DIAB",6,1,130.0126,0)
5;T
"KRN",.402,1411,"DIAB",7,0,130,0)
121;T
"KRN",.402,1411,"DIAB",8,0,130,0)
122;T
"KRN",.402,1411,"DIAB",9,0,130,0)
123;T
"KRN",.402,1411,"DIAB",10,0,130,0)
119;T
"KRN",.402,1411,"DIAB",11,0,130,0)
.021;T
"KRN",.402,1411,"DIAB",12,0,130,0)
33;T
"KRN",.402,1411,"DIAB",13,0,130,0)
66;T
"KRN",.402,1411,"DIAB",14,0,130,0)
55;T
"KRN",.402,1411,"DIAB",17,0,130,0)
124;T
"KRN",.402,1411,"DIAB",18,0,130,0)
.166;T
"KRN",.402,1411,"DIAB",19,0,130,0)
.31;T
"KRN",.402,1411,"DIAB",20,0,130,0)
.34;T
"KRN",.402,1411,"DIAB",21,0,130,0)
.213;T
"KRN",.402,1411,"DIAB",22,0,130,0)
.37;T
"KRN",.402,1411,"DIAB",23,0,130,0)
.345;T
"KRN",.402,1411,"DIAB",24,0,130,0)
20;T
"KRN",.402,1411,"DIAB",25,0,130,0)
1.13;T
"KRN",.402,1411,"DIAB",26,0,130,0)
.42;T
"KRN",.402,1411,"DIAB",27,0,130,0)
.74;T
"KRN",.402,1411,"DIAB",28,0,130,0)
126;T
"KRN",.402,1411,"DIAB",30,0,130,0)
.28;T
"KRN",.402,1411,"DR",1,130)
120T~;26T~;27T~;125T~;1004T~;.011T~;121T~;122T~;123T~;119T~;.021T~;33T~;66T~;55T~;60;59;124T~;.166T~;.31T~;.34T~;.213T~;.37T~;.345T~;20T~;1.13T~;.42T~;.74T~;126T~;49;.28T~;17;18;
"KRN",.402,1411,"DR",2,130.0126)
.01T~;1T~;2T~;3T~;4T~;5T~;
"KRN",.402,1411,"DR",2,130.06)
.01T~;.05T~//YES;24T~;
"KRN",.402,1411,"DR",2,130.16)
.01T~;3T~;1.5T~;
"KRN",.402,1411,"DR",2,130.18)
.01T~;3T~;
"KRN",.402,1411,"DR",2,130.213)
.01T~;1T~;
"KRN",.402,1411,"DR",3,130.47)
.01T~;1T~;
"KRN",.402,1412,-1)
0^10
"KRN",.402,1412,0)
SRPARAM^3040505.1513^^133^^^3040505
"KRN",.402,1412,"DIAB",1,0,133,0)
3;T
"KRN",.402,1412,"DIAB",1,1,133.027,0)
.01;T
"KRN",.402,1412,"DIAB",1,1,133.028,0)
.01;T
"KRN",.402,1412,"DIAB",2,0,133,0)
6;T
"KRN",.402,1412,"DIAB",2,1,133.028,0)
1;T
"KRN",.402,1412,"DIAB",3,0,133,0)
41;T
"KRN",.402,1412,"DIAB",4,0,133,0)
9;T
"KRN",.402,1412,"DIAB",5,0,133,0)
10;T
"KRN",.402,1412,"DIAB",6,0,133,0)
11;T
"KRN",.402,1412,"DIAB",7,0,133,0)
13;T
"KRN",.402,1412,"DIAB",8,0,133,0)
29;T
"KRN",.402,1412,"DIAB",9,0,133,0)
15;T
"KRN",.402,1412,"DIAB",10,0,133,0)
17;T
"KRN",.402,1412,"DIAB",11,0,133,0)
18.5;T
"KRN",.402,1412,"DIAB",12,0,133,0)
33;T
"KRN",.402,1412,"DIAB",14,0,133,0)
28;T
"KRN",.402,1412,"DIAB",15,0,133,0)
20;T
"KRN",.402,1412,"DIAB",16,0,133,0)
21;T
"KRN",.402,1412,"DIAB",17,0,133,0)
22;T
"KRN",.402,1412,"DIAB",18,0,133,0)
23;T
"KRN",.402,1412,"DIAB",19,0,133,0)
24;T
"KRN",.402,1412,"DIAB",20,0,133,0)
25;T
"KRN",.402,1412,"DIAB",21,0,133,0)
26;T
"KRN",.402,1412,"DIAB",22,0,133,0)
27;T
"KRN",.402,1412,"DIAB",23,0,133,0)
35;T
"KRN",.402,1412,"DIAB",24,0,133,0)
37;T
"KRN",.402,1412,"DIAB",25,0,133,0)
40;T
"KRN",.402,1412,"DIAB",26,0,133,0)
42;T
"KRN",.402,1412,"DR",1,133)
3T~;6T~;41T~;9T~;10T~;11T~;13T~;29T~;15T~;17T~;18.5T~;33T~;Q;28T~;20T~;21T~;22T~;23T~;24T~;25T~;26T~;27T~;35T~;37T~;40T~;42T~;
"KRN",.402,1412,"DR",2,133.027)
.01T~;
"KRN",.402,1412,"DR",2,133.028)
.01T~;1T~;
"KRN",.402,1418,-1)
0^6
"KRN",.402,1418,0)
SREQUEST^3040217.1238^^130^^^3050329
"KRN",.402,1418,"DIAB",1,1,130.03,0)
.01;T
"KRN",.402,1418,"DIAB",1,1,130.065,0)
.01;T
"KRN",.402,1418,"DIAB",2,0,130,0)
32;T
"KRN",.402,1418,"DIAB",2,0,130,1)
.16;T
"KRN",.402,1418,"DIAB",2,0,130,2)
1.03;T
"KRN",.402,1418,"DIAB",2,1,130.03,0)
1;T
"KRN",.402,1418,"DIAB",3,1,130.03,0)
2;T
"KRN",.402,1418,"DIAB",4,1,130.03,0)
3;T
"KRN",.402,1418,"DIAB",5,0,130,0)
32.5;T
"KRN",.402,1418,"DIAB",5,0,130,1)
.164;T
"KRN",.402,1418,"DIAB",5,0,130,2)
1.035;T
"KRN",.402,1418,"DIAB",5,1,130.03,0)
4;T
"KRN",.402,1418,"DIAB",6,1,130.03,0)
5;T
"KRN",.402,1418,"DIAB",8,0,130,0)
PRIN DIAGNOSIS CODE;T
"KRN",.402,1418,"DIAB",8,0,130,1)
.43;T
"KRN",.402,1418,"DIAB",8,0,130,2)
1.04;T
"KRN",.402,1418,"DIAB",11,0,130,0)
.011//I;T
"KRN",.402,1418,"DIAB",11,0,130,1)
.037;T
"KRN",.402,1418,"DIAB",11,0,130,2)
.05;T
"KRN",.402,1418,"DIAB",13,0,130,0)
56;T
"KRN",.402,1418,"DIAB",13,0,130,1)
SURGERY POS;T
"KRN",.402,1418,"DIAB",13,0,130,2)
23;T
"KRN",.402,1418,"DIAB",14,0,130,2)
.28;T
"KRN",.402,1418,"DIAB",15,0,130,1)
1.01;T
"KRN",.402,1418,"DIAB",15,0,130,2)
80;T
"KRN",.402,1418,"DIAB",16,0,130,0)
.035;T
"KRN",.402,1418,"DIAB",18,0,130,1)
1.02;T
"KRN",.402,1418,"DIAB",19,0,130,0)
.15;T
"KRN",.402,1418,"DR",1,130)
I $D(SREQ(32)) S Y="@1";32T~;@1;I $D(SREQ(32.5)) S Y="@2";32.5T~;@2;I $D(SREQ(66)) S Y="@3";66T~;@3;I $D(SREQ(.011)) S Y="@4";.011T~//I;I X="I" S Y="@4";56T~;@4;I $D(SREQ(.035)) S Y="@5";.035T~;@5;I $D(SREQ(.15)) S Y="@6";.15T~;@6;
"KRN",.402,1418,"DR",1,130,1)
I $D(SREQ(.16)) S Y="@7";.16T~;@7;I $D(SREQ(.164)) S Y="@8";.164T~;@8;I $D(SREQ(.43)) S Y="@9";.43T~;@9;I $D(SREQ(.037)) S Y="@10";.037T~;@10;65T~;I $D(SREQ(1.01)) S Y="@11";1.01T~;@11;I $D(SREQ(1.02)) S Y="@12";1.02T~;@12;
"KRN",.402,1418,"DR",1,130,2)
I $D(SREQ(1.03)) S Y="@13";1.03T~;@13;I $D(SREQ(1.035)) S Y="@14";1.035T~;@14;I $D(SREQ(1.04)) S Y="@15";1.04T~;@15;I $D(SREQ(.05)) S Y="@16";.05T~;@16;23T~;.28T~;80T~;
"KRN",.402,1418,"DR",2,130.03)
.01T~;1T~;2T~;3T~;4T~;5T~;
"KRN",.402,1418,"DR",2,130.065)
.01T~;
"KRN",.402,1419,-1)
0^9
"KRN",.402,1419,0)
SRSCHED-UNREQUESTED^3040217.1416^^130^^^3040217
"KRN",.402,1419,"DIAB",2,0,130,0)
32;T
"KRN",.402,1419,"DIAB",2,0,130,2)
1.03;T
"KRN",.402,1419,"DIAB",3,0,130,1)
.16;T
"KRN",.402,1419,"DIAB",5,0,130,0)
32.5;T
"KRN",.402,1419,"DIAB",5,0,130,2)
1.035;T
"KRN",.402,1419,"DIAB",6,0,130,1)
.164;T
"KRN",.402,1419,"DIAB",8,0,130,0)
PRIN DIAGNOSIS CODE;T
"KRN",.402,1419,"DIAB",8,0,130,2)
1.04;T
"KRN",.402,1419,"DIAB",9,0,130,1)
.43;T
"KRN",.402,1419,"DIAB",11,0,130,0)
.011//I;T
"KRN",.402,1419,"DIAB",11,0,130,2)
.05;T
"KRN",.402,1419,"DIAB",12,0,130,0)
.011//I;T
"KRN",.402,1419,"DIAB",12,0,130,1)
.037;T
"KRN",.402,1419,"DIAB",13,0,130,2)
.28;T
"KRN",.402,1419,"DIAB",14,0,130,0)
56;T
"KRN",.402,1419,"DIAB",14,0,130,2)
80;T
"KRN",.402,1419,"DIAB",15,0,130,1)
1.01;T
"KRN",.402,1419,"DIAB",17,0,130,0)
.035;T
"KRN",.402,1419,"DIAB",18,0,130,1)
1.02;T
"KRN",.402,1419,"DIAB",20,0,130,0)
.15;T
"KRN",.402,1419,"DR",1,130)
I $D(SREQ(32)) S Y="@1";32T~;@1;I $D(SREQ(32.5)) S Y="@2";32.5T~;@2;I $D(SREQ(66)) S Y="@3";66T~;@3;I $D(SREQ(.011)) S Y="@4";Q;.011T~//I;I X="I" S Y="@4";56T~;@4;I $D(SREQ(.035)) S Y="@5";.035T~;@5;I $D(SREQ(.15)) S Y="@6";.15T~;
"KRN",.402,1419,"DR",1,130,1)
@6;I $D(SREQ(.16)) S Y="@7";.16T~;@7;I $D(SREQ(.164)) S Y="@8";.164T~;@8;I $D(SREQ(.43)) S Y="@9";.43T~;@9;I $D(SREQ(.037)) S Y="@10";.037T~;@10;I $D(SREQ(1.01)) S Y="@11";1.01T~;@11;I $D(SREQ(1.02)) S Y="@12";1.02T~;@12;
"KRN",.402,1419,"DR",1,130,2)
I $D(SREQ(1.03)) S Y="@13";1.03T~;@13;I $D(SREQ(1.035)) S Y="@14";1.035T~;@14;I $D(SREQ(1.04)) S Y="@15";1.04T~;@15;I $D(SREQ(.05)) S Y="@16";.05T~;@16;.28T~;80T~;
"KRN",.402,1419,"DR",99,1,9.2)
S (D,D0)=$QS(DIMQ,$QL(DIMQ)) I D,$D(^PRCP(445.3,D,0)) S X=$P(^(0),U) S DWLC=DWLC+1,^SRF(DA,DV,DWLC,0)=X
"KRN",.402,1419,"DR",99,1,9.3)
N DIMQ,DIMSTRT,DIMSCNT S (DIMQ,DIMSTRT)=$NA(^PRCP(445.3,"ASR2",I(0,0))),DIMSCNT=$QL(DIMQ) F  S DIMQ=$Q(@DIMQ) Q:DIMQ=""  Q:$NA(@DIMQ,DIMSCNT)'=DIMSTRT   X DR(99,1,9.2) Q:'$D(D)  S D=D0
"KRN",.402,2696,-1)
0^13
"KRN",.402,2696,0)
SROARPT^3050603.1308^^130^^^3050603
"KRN",.402,2696,"DIAB",1,0,130,0)
.02;T
"KRN",.402,2696,"DIAB",1,1,130.04,0)
.01;T
"KRN",.402,2696,"DIAB",1,1,130.06,0)
.01;T
"KRN",.402,2696,"DIAB",1,1,130.16,0)
.01;T
"KRN",.402,2696,"DIAB",1,1,130.213,0)
.01;T
"KRN",.402,2696,"DIAB",1,1,130.33,0)
.01;T
"KRN",.402,2696,"DIAB",1,1,130.41,0)
.01;T
"KRN",.402,2696,"DIAB",1,2,130.34,0)
.01;T
"KRN",.402,2696,"DIAB",1,2,130.47,0)
.01;T
"KRN",.402,2696,"DIAB",1,2,130.49,0)
.01;T
"KRN",.402,2696,"DIAB",2,0,130,0)
.31;T
"KRN",.402,2696,"DIAB",2,1,130.04,0)
1;T
"KRN",.402,2696,"DIAB",2,1,130.06,0)
.05;T
"KRN",.402,2696,"DIAB",2,1,130.16,0)
2;T
"KRN",.402,2696,"DIAB",2,1,130.213,0)
1;T
"KRN",.402,2696,"DIAB",2,1,130.33,0)
1;T
"KRN",.402,2696,"DIAB",2,1,130.41,0)
3;T
"KRN",.402,2696,"DIAB",2,2,130.34,0)
4;T
"KRN",.402,2696,"DIAB",2,2,130.47,0)
1;T
"KRN",.402,2696,"DIAB",2,2,130.49,0)
1;T
"KRN",.402,2696,"DIAB",3,0,130,0)
.32;T
"KRN",.402,2696,"DIAB",3,1,130.04,0)
3;T
"KRN",.402,2696,"DIAB",3,1,130.06,0)
24;T
"KRN",.402,2696,"DIAB",3,1,130.41,0)
1;T
"KRN",.402,2696,"DIAB",3,2,130.34,0)
2;T
"KRN",.402,2696,"DIAB",3,2,130.49,0)
2;T
"KRN",.402,2696,"DIAB",4,0,130,0)
.34;T
"KRN",.402,2696,"DIAB",4,1,130.04,0)
4;T
"KRN",.402,2696,"DIAB",4,1,130.06,0)
41;T
"KRN",.402,2696,"DIAB",4,1,130.41,0)
2;T
"KRN",.402,2696,"DIAB",4,2,130.34,0)
3;T
"KRN",.402,2696,"DIAB",5,0,130,0)
.345;T
"KRN",.402,2696,"DIAB",5,1,130.06,0)
42;T
"KRN",.402,2696,"DIAB",5,2,130.34,0)
5;T
"KRN",.402,2696,"DIAB",6,0,130,0)
.33;T
"KRN",.402,2696,"DIAB",6,1,130.06,0)
3;T
"KRN",.402,2696,"DIAB",7,0,130,0)
.213;T
"KRN",.402,2696,"DIAB",7,1,130.06,0)
4;T
"KRN",.402,2696,"DIAB",8,0,130,0)
1.13;T
"KRN",.402,2696,"DIAB",8,1,130.06,0)
5;T
"KRN",.402,2696,"DIAB",9,0,130,0)
.46;T
"KRN",.402,2696,"DIAB",9,1,130.06,0)
6;T
"KRN",.402,2696,"DIAB",10,0,130,0)
.37;T
"KRN",.402,2696,"DIAB",10,1,130.06,0)
7;T
"KRN",.402,2696,"DIAB",11,0,130,0)
26;T
"KRN",.402,2696,"DIAB",11,1,130.06,0)
8;T
"KRN",.402,2696,"DIAB",12,0,130,0)
.42;T
"KRN",.402,2696,"DIAB",12,1,130.06,0)
9;T
"KRN",.402,2696,"DIAB",13,0,130,0)
.375;T
"KRN",.402,2696,"DIAB",13,1,130.06,0)
10;T
"KRN",.402,2696,"DIAB",14,0,130,0)
.36;T
"KRN",.402,2696,"DIAB",14,1,130.06,0)
11;T
"KRN",.402,2696,"DIAB",15,0,130,0)
.293;T
"KRN",.402,2696,"DIAB",15,1,130.06,0)
12;T
"KRN",.402,2696,"DIAB",16,0,130,0)
.27;T
"KRN",.402,2696,"DIAB",16,1,130.06,0)
21;T
"KRN",.402,2696,"DIAB",17,0,130,0)
.25;T
"KRN",.402,2696,"DIAB",17,1,130.06,0)
39;T
"KRN",.402,2696,"DIAB",18,0,130,0)
.255;T
"KRN",.402,2696,"DIAB",18,1,130.06,0)
22;T
"KRN",.402,2696,"DIAB",19,0,130,0)
1.11;T
"KRN",.402,2696,"DIAB",19,1,130.06,0)
17;T
"KRN",.402,2696,"DIAB",20,0,130,0)
1.12;T
"KRN",.402,2696,"DIAB",20,1,130.06,0)
18;T
"KRN",.402,2696,"DIAB",21,0,130,0)
1.19;T
"KRN",.402,2696,"DIAB",21,1,130.06,0)
25;T
"KRN",.402,2696,"DIAB",22,0,130,0)
1.2;T
"KRN",.402,2696,"DIAB",22,1,130.06,0)
26;T
"KRN",.402,2696,"DIAB",23,0,130,0)
.28;T
"KRN",.402,2696,"DIAB",23,1,130.06,0)
27;T
"KRN",.402,2696,"DIAB",24,1,130.06,0)
29;T
"KRN",.402,2696,"DIAB",25,1,130.06,0)
43;T
"KRN",.402,2696,"DIAB",26,1,130.06,0)
34;T
"KRN",.402,2696,"DIAB",27,1,130.06,0)
35;T
"KRN",.402,2696,"DIAB",28,1,130.06,0)
44;T
"KRN",.402,2696,"DIAB",29,1,130.06,0)
38;T
"KRN",.402,2696,"DR",1,130)
.02T~;.31T~;.32T~;.34T~;.345T~;.33T~;.213T~;1.13T~;.46T~;.37T~;26T~;.42T~;.375T~;.36T~;.293T~;.27T~;.25T~;.255T~;1.11T~;1.12T~;1.19T~;1.2T~;.28T~;
"KRN",.402,2696,"DR",2,130.04)
.01T~;1T~;3T~;4T~;
"KRN",.402,2696,"DR",2,130.06)
.01T~;.05T~;24T~;41T~;42T~;3T~;4T~;5T~;6T~;7T~;8T~;9T~;10T~;11T~;12T~;21T~;39T~;22T~;17T~;18T~;25T~;26T~;27T~;29T~;43T~;34T~;35T~;44T~;38T~;Q;
"KRN",.402,2696,"DR",2,130.16)
.01T~;2T~;
"KRN",.402,2696,"DR",2,130.213)
.01T~;1T~;
"KRN",.402,2696,"DR",2,130.33)
.01T~;1T~;
"KRN",.402,2696,"DR",2,130.41)
.01T~;3T~;1T~;2T~;
"KRN",.402,2696,"DR",3,130.34)
.01T~;4T~;2T~;3T~;5T~;
"KRN",.402,2696,"DR",3,130.47)
.01T~;1T~;
"KRN",.402,2696,"DR",3,130.49)
.01T~;1T~;2T~;
"MBREQ")
1
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"PKG",308,-1)
1^1
"PKG",308,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",308,20,0)
^9.402P^^
"PKG",308,22,0)
^9.49I^1^1
"PKG",308,22,1,0)
3.0^2930624^2940818
"PKG",308,22,1,"PAH",1,0)
119^3050805^123456826
"PKG",308,22,1,"PAH",1,1,0)
^^1^1^3050805
"PKG",308,22,1,"PAH",1,1,1,0)
CLINICAL INDICATOR DATA CAPTURE - SURGERY
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
16
"RTN","SR119PI")
0^19^B573587
"RTN","SR119PI",1,0)
SR119PI ;BIR/TJH - Utility routine for patch SR*3*119 ;[02/17/04  10:33 AM ]
"RTN","SR119PI",2,0)
 ;;3.0;Surgery;**119**;24 Jun 93
"RTN","SR119PI",3,0)
POST ; post-install action for SR*3*119
"RTN","SR119PI",4,0)
 N SRSREC,SRSREC2,SRUPT
"RTN","SR119PI",5,0)
 S SRSREC=""
"RTN","SR119PI",6,0)
 F  S SRSREC=$O(^SRO(133,"B",SRSREC)) Q:SRSREC=""  D
"RTN","SR119PI",7,0)
 .S SRSREC2=""
"RTN","SR119PI",8,0)
 .F  S SRSREC2=$O(^SRO(133,"B",SRSREC,SRSREC2)) Q:SRSREC2=""  D
"RTN","SR119PI",9,0)
 ..S SRUPT(133,SRSREC2_",",18)="A",SRUPT(133,SRSREC2_",",19)=1 D FILE^DIE("","SRUPT")
"RTN","SR119PI",10,0)
 Q
"RTN","SROADX")
0^5^B90954946
"RTN","SROADX",1,0)
SROADX ; BIR/RJS - ASSOCIATED DIAGNOSIS FOR CODER AND VERIFY SCREENS ; 12/22/04 12:01pm
"RTN","SROADX",2,0)
 ;;3.0;Surgery;**119**;24 Jun 93
"RTN","SROADX",3,0)
CASDX ;Associate/Delete "Primary" CPT to Diagnosis from the CPT Coding menu. 
"RTN","SROADX",4,0)
 N SRDX0,SRDX1,SRDX2,SROANS,SRODIR,SRDIRX,OTHCNT,SRASSDS
"RTN","SROADX",5,0)
 S S("OP")=^SRF(SRTN,"OP"),CPT=$P(S("OP"),U,2),SROPER=$P(S("OP"),U)
"RTN","SROADX",6,0)
 Q:'CPT
"RTN","SROADX",7,0)
 K DIR
"RTN","SROADX",8,0)
 D HDR^SROVER2
"RTN","SROADX",9,0)
 D CPTDISP^SROADX1,ASDX^SROADX1,ADXPRMT
"RTN","SROADX",10,0)
 Q:($G(Y(0))="")!($G(Y(0))="QUIT")
"RTN","SROADX",11,0)
 K DIR
"RTN","SROADX",12,0)
 S Y=$P(SROLST,",",Y)
"RTN","SROADX",13,0)
 S SROANS=Y
"RTN","SROADX",14,0)
 S SRODIR("A",1)="   Select the number(s) of the Diagnosis Code appropriate for this procedure"
"RTN","SROADX",15,0)
 S SRODIR("A")="     ("_SRTXT_")"
"RTN","SROADX",16,0)
 S:$G(SROANS)="D" SRODIR("A",1)="   Select the number(s) of the Diagnosis Code(s) to delete from this procedure"
"RTN","SROADX",17,0)
 D HDR^SROVER2
"RTN","SROADX",18,0)
 D CPTDISP^SROADX1,ASDX^SROADX1
"RTN","SROADX",19,0)
 S Y=SROANS
"RTN","SROADX",20,0)
 I Y="D" D
"RTN","SROADX",21,0)
 .W !,?8,SRDXCNT,". ALL"
"RTN","SROADX",22,0)
 .S DIR(0)=SRDX1,DIR("A")=SRODIR("A"),DIR("A",1)="",DIR("A",2)=SRODIR("A",1)
"RTN","SROADX",23,0)
 .F I=1:1 D ^DIR Q:$$VALASC()
"RTN","SROADX",24,0)
 .Q:(Y="^")!(Y="")
"RTN","SROADX",25,0)
 .I +Y(0)'=SRDXCNT D PDEL1^SROADX1
"RTN","SROADX",26,0)
 .I +Y(0)=SRDXCNT D PDELALL^SROADX1
"RTN","SROADX",27,0)
 I Y="A" D
"RTN","SROADX",28,0)
 .K DIR
"RTN","SROADX",29,0)
 .D SRODIR^SROADX1
"RTN","SROADX",30,0)
 .W ! F I=1:1:80 W "-"
"RTN","SROADX",31,0)
 .S DIR(0)=SRDX2
"RTN","SROADX",32,0)
 .S SRASSDS=$$PASSDS^SROADX1
"RTN","SROADX",33,0)
 .S DIR("B")=SRASSDS
"RTN","SROADX",34,0)
 .F I=1:1 D ^DIR Q:(($$VALASC())&('$$DXDUP(X)))
"RTN","SROADX",35,0)
 .Q:(Y="^")!(Y="")
"RTN","SROADX",36,0)
 .I SRDIRX(+Y(0))'="ALL" D PADD1^SROADX1 Q
"RTN","SROADX",37,0)
 .I SRDIRX(+Y(0))="ALL" D PADDALL^SROADX1 Q
"RTN","SROADX",38,0)
 Q:Y="Q"!(Y["")
"RTN","SROADX",39,0)
 G CASDX
"RTN","SROADX",40,0)
 Q
"RTN","SROADX",41,0)
COTHADX D COTHBLD^SROADX1        ;Associate/Delete "Other" CPTs to Diagnosis from CPT/CODE menu.
"RTN","SROADX",42,0)
 N SRDX0,SRDX1,SRDX2,SRDIR,OTHCNT,SRASSDS
"RTN","SROADX",43,0)
 D HDR^SROVER2
"RTN","SROADX",44,0)
 S OTHCNT=SRDA
"RTN","SROADX",45,0)
 K DIR
"RTN","SROADX",46,0)
 D OTHCPTD^SROADX1
"RTN","SROADX",47,0)
 D OTHADX^SROADX1,ADXPRMT
"RTN","SROADX",48,0)
 Q:($G(Y(0))="")!($G(Y(0))="QUIT")
"RTN","SROADX",49,0)
 S SRODIR("A",1)="   Select the number(s) of the Diagnosis Code appropriate for this procedure"
"RTN","SROADX",50,0)
 S SRODIR("A")="     ("_$G(SRSHT)_")"
"RTN","SROADX",51,0)
 S:$G(Y(0))="DELETE" SRODIR("A",1)="   Select the number(s) of the Diagnosis Code(s) to delete from this procedure"
"RTN","SROADX",52,0)
 K DIR
"RTN","SROADX",53,0)
 S Y=$P(SROLST,",",Y)
"RTN","SROADX",54,0)
 S SROANS=Y
"RTN","SROADX",55,0)
 W @IOF
"RTN","SROADX",56,0)
 D OTHCPTD^SROADX1
"RTN","SROADX",57,0)
 D OTHADX^SROADX1
"RTN","SROADX",58,0)
 S Y=SROANS
"RTN","SROADX",59,0)
 I Y="D" D
"RTN","SROADX",60,0)
 .W !,?8,SRDXCNT,". ALL"
"RTN","SROADX",61,0)
 .S DIR(0)=SRDX1,DIR("A")=SRODIR("A"),DIR("A",1)="",DIR("A",2)=SRODIR("A",1)
"RTN","SROADX",62,0)
 .F I=1:1 D ^DIR Q:$$VALASC()
"RTN","SROADX",63,0)
 .Q:(Y="^")!(Y="")
"RTN","SROADX",64,0)
 .I +Y(0)=SRDXCNT D
"RTN","SROADX",65,0)
 ..W !,"ARE YOU SRE YOU WANT TO DELETE ALL ? (Y/N) "
"RTN","SROADX",66,0)
 ..S %=2 D YN^DICN
"RTN","SROADX",67,0)
 ..I %=1 Q:$E($G(IOST))'="C"!($G(DIK)'="")  D KOADX^SROADX2(SRTN,OTH)
"RTN","SROADX",68,0)
 ..W @IOF
"RTN","SROADX",69,0)
 ..S OTHCNT=SRDA
"RTN","SROADX",70,0)
 .I +Y(0)'=SRDXCNT D
"RTN","SROADX",71,0)
 ..S DIR(0)=SRDX1,DIR("A")=SRODIR("A"),DIR("A",1)="",DIR("A",2)=SRODIR("A",1)
"RTN","SROADX",72,0)
 ..D ODEL1^SROADX1
"RTN","SROADX",73,0)
 ..W @IOF
"RTN","SROADX",74,0)
 .D OTHCPTD^SROADX1
"RTN","SROADX",75,0)
 I Y="A" D  G COTHADX
"RTN","SROADX",76,0)
 .K DIR
"RTN","SROADX",77,0)
 .D SRODIR^SROADX1
"RTN","SROADX",78,0)
 .W ! F I=1:1:80 W "-"
"RTN","SROADX",79,0)
 .S DIR(0)=SRDX2
"RTN","SROADX",80,0)
 .S SRASSDS=$$OASSDS^SROADX1
"RTN","SROADX",81,0)
 .S DIR("B")=SRASSDS
"RTN","SROADX",82,0)
 .F I=1:1 D ^DIR Q:(($$VALASC())&('$$DXDUP(X)))
"RTN","SROADX",83,0)
 .Q:(Y="^")!(Y="")
"RTN","SROADX",84,0)
 .I SRDIRX(+Y(0))="ALL",SRDX0'="SO^1:ASSOCIATE;2:DELETE;3:QUIT" D  Q
"RTN","SROADX",85,0)
 ..D OADDALL^SROADX1
"RTN","SROADX",86,0)
 .I SRDIRX(+Y(0))="ALL",SRDX0="SO^1:ASSOCIATE;2:DELETE;3:QUIT" D  Q
"RTN","SROADX",87,0)
 ..D OADD1^SROADX1
"RTN","SROADX",88,0)
 .I SRDIRX(+Y(0))'="ALL" D
"RTN","SROADX",89,0)
 ..D OADD1^SROADX1
"RTN","SROADX",90,0)
 .W @IOF
"RTN","SROADX",91,0)
 .D OTHCPTD^SROADX1
"RTN","SROADX",92,0)
 .D OTHADX^SROADX1
"RTN","SROADX",93,0)
 Q:Y="Q"!(Y["")
"RTN","SROADX",94,0)
 G COTHADX
"RTN","SROADX",95,0)
 Q
"RTN","SROADX",96,0)
VASDX         ;Associate/Delete PRINCIPAL CPTs to Diagnosis from Physician's Verify menu.
"RTN","SROADX",97,0)
 N SRDX0,SRDX1,SRDX2,SROANS,SRODIR,SRDIRX,SRASSDS
"RTN","SROADX",98,0)
 K DIR
"RTN","SROADX",99,0)
 W @IOF
"RTN","SROADX",100,0)
 S DIR("?")="^D VHELP^SROADX"
"RTN","SROADX",101,0)
 S DIR("??")="^D VHELP1^SROADX"
"RTN","SROADX",102,0)
 D CPTDISP^SROADX1,ASDX^SROADX1,ADXPRMT
"RTN","SROADX",103,0)
 Q:($G(Y(0))="")!($G(Y(0))="QUIT")
"RTN","SROADX",104,0)
 S SRODIR("A",1)="   Select the number(s) of the Diagnosis Code appropriate for this procedure"
"RTN","SROADX",105,0)
 S SRODIR("A")="     ("_SROCPT2_")"
"RTN","SROADX",106,0)
 S:$G(Y(0))="DELETE" SRODIR("A",1)="   Select the number(s) of the Diagnosis Code(s) to delete from this procedure"
"RTN","SROADX",107,0)
 K DIR
"RTN","SROADX",108,0)
 S Y=$P(SROLST,",",Y)
"RTN","SROADX",109,0)
 S SROANS=Y
"RTN","SROADX",110,0)
 W @IOF
"RTN","SROADX",111,0)
 D CPTDISP^SROADX1,ASDX^SROADX1
"RTN","SROADX",112,0)
 S Y=SROANS
"RTN","SROADX",113,0)
 I Y="D" D
"RTN","SROADX",114,0)
 .W !,?8,SRDXCNT,". ALL"
"RTN","SROADX",115,0)
 .S DIR(0)=SRDX1,DIR("A")=SRODIR("A"),DIR("A",1)="",DIR("A",2)=SRODIR("A",1)
"RTN","SROADX",116,0)
 .S DIR("?")="^D DHELP^SROADX"
"RTN","SROADX",117,0)
 .S DIR("??")="^D PHELP^SROADX"
"RTN","SROADX",118,0)
 .F I=1:1 D ^DIR Q:$$VALASC()
"RTN","SROADX",119,0)
 .Q:(Y="^")!(Y="")
"RTN","SROADX",120,0)
 .I +Y(0)=SRDXCNT D PDELALL^SROADX1 Q
"RTN","SROADX",121,0)
 .I +Y(0)'=SRDXCNT D PDEL1^SROADX1 Q
"RTN","SROADX",122,0)
 I Y="A" D
"RTN","SROADX",123,0)
 .K DIR
"RTN","SROADX",124,0)
 .D SRODIR^SROADX1
"RTN","SROADX",125,0)
 .W ! F I=1:1:80 W "-"
"RTN","SROADX",126,0)
 .S DIR("?")="^D AHELP^SROADX"
"RTN","SROADX",127,0)
 .S DIR("??")="^D PHELP^SROADX"
"RTN","SROADX",128,0)
 .S SRASSDS=$$PASSDS^SROADX1
"RTN","SROADX",129,0)
 .S DIR("B")=SRASSDS
"RTN","SROADX",130,0)
 .S DIR(0)=SRDX2
"RTN","SROADX",131,0)
 .F I=1:1 D ^DIR Q:(($$VALASC())&('$$DXDUP(X)))
"RTN","SROADX",132,0)
 .Q:(Y="^")!(Y="")
"RTN","SROADX",133,0)
 .I SRDIRX(+Y(0))'="ALL" D PADD1^SROADX1 Q
"RTN","SROADX",134,0)
 .I SRDIRX(+Y(0))="ALL" D PADDALL^SROADX1 Q
"RTN","SROADX",135,0)
 G VASDX
"RTN","SROADX",136,0)
 Q
"RTN","SROADX",137,0)
NOTHADX S OTH=DA,OTHCNT=CNT
"RTN","SROADX",138,0)
 S SRSEL(CNT)=OTH_U_$G(OTHER)_"^CPT Code: "_CPT_U_$G(CPT1)
"RTN","SROADX",139,0)
VOTHADX N SRDX0,SRDX1,SRDX2,SRDIR,SRASSDS        ;Associate/Delete OTHER Diagnosis to CPTs from Physician's Verify menu.
"RTN","SROADX",140,0)
 Q:'$D(^SRF(SRTN,13,OTH))
"RTN","SROADX",141,0)
 W @IOF
"RTN","SROADX",142,0)
 K DIR
"RTN","SROADX",143,0)
 D OTHCPTD^SROADX1,OTHADX^SROADX1,ADXPRMT
"RTN","SROADX",144,0)
 Q:($G(Y(0))="")!($G(Y(0))="QUIT")
"RTN","SROADX",145,0)
 S SRODIR("A",1)="   Select the number(s) of the Diagnosis Code appropriate for this procedure"
"RTN","SROADX",146,0)
 S SRODIR("A")="     ("_$G(SRSHT)_")"
"RTN","SROADX",147,0)
 S:$G(Y(0))="DELETE" SRODIR("A",1)="   Select the number(s) of the Diagnosis Code(s) to delete from this procedure"
"RTN","SROADX",148,0)
 K DIR
"RTN","SROADX",149,0)
 S Y=$P(SROLST,",",Y)
"RTN","SROADX",150,0)
 S SROANS=Y
"RTN","SROADX",151,0)
 W @IOF
"RTN","SROADX",152,0)
 D OTHCPTD^SROADX1
"RTN","SROADX",153,0)
 D OTHADX^SROADX1
"RTN","SROADX",154,0)
 S Y=SROANS
"RTN","SROADX",155,0)
 I Y="D" D
"RTN","SROADX",156,0)
 .W !,?8,SRDXCNT,". ALL"
"RTN","SROADX",157,0)
 .S DIR("?")="^D DHELP^SROADX"
"RTN","SROADX",158,0)
 .S DIR("??")="^D OHELP^SROADX"
"RTN","SROADX",159,0)
 .S DIR(0)=SRDX1,DIR("A")=SRODIR("A"),DIR("A",1)="",DIR("A",2)=SRODIR("A",1)
"RTN","SROADX",160,0)
 .F I=1:1 D ^DIR Q:$$VALASC()
"RTN","SROADX",161,0)
 .Q:(Y="^")!(Y="")
"RTN","SROADX",162,0)
 .I +Y(0)=SRDXCNT D
"RTN","SROADX",163,0)
 ..W !,"ARE YOU SRE YOU WANT TO DELETE ALL ? (Y/N) "
"RTN","SROADX",164,0)
 ..S %=2 D YN^DICN
"RTN","SROADX",165,0)
 ..I %=1 Q:$E($G(IOST))'="C"!($G(DIK)'="")  D KOADX^SROADX2(SRTN,OTH)
"RTN","SROADX",166,0)
 .I +Y(0)'=SRDXCNT D  Q
"RTN","SROADX",167,0)
 ..S DIR(0)=SRDX1,DIR("A")=SRODIR("A"),DIR("A",1)=""
"RTN","SROADX",168,0)
 ..W ! F I=1:1:80 W "-"
"RTN","SROADX",169,0)
 ..S DIR("A",2)=SRODIR("A",1)
"RTN","SROADX",170,0)
 ..D ODEL1^SROADX1
"RTN","SROADX",171,0)
 .W @IOF
"RTN","SROADX",172,0)
 .D OTHCPTD^SROADX1
"RTN","SROADX",173,0)
 I Y="A" D
"RTN","SROADX",174,0)
 .K DIR
"RTN","SROADX",175,0)
 .D SRODIR^SROADX1
"RTN","SROADX",176,0)
 .W ! F I=1:1:80 W "-"
"RTN","SROADX",177,0)
 .S DIR("?")="^D AHELP^SROADX"
"RTN","SROADX",178,0)
 .S DIR("??")="^D OHELP^SROADX"
"RTN","SROADX",179,0)
 .S SRASSDS=$$OASSDS^SROADX1
"RTN","SROADX",180,0)
 .S DIR("B")=SRASSDS
"RTN","SROADX",181,0)
 .S DIR(0)=SRDX2
"RTN","SROADX",182,0)
 .F I=1:1 D ^DIR Q:(($$VALASC())&('$$DXDUP(X)))
"RTN","SROADX",183,0)
 .Q:(Y="^")!(Y="")
"RTN","SROADX",184,0)
 .I SRDIRX(+Y(0))="ALL" D OADDALL^SROADX1 Q
"RTN","SROADX",185,0)
 .I SRDIRX(+Y(0))'="ALL" D OADD1^SROADX1 Q
"RTN","SROADX",186,0)
 G VOTHADX
"RTN","SROADX",187,0)
 Q
"RTN","SROADX",188,0)
OHELP ;
"RTN","SROADX",189,0)
 W !!,?5,"The Other Associated Diagnosis is used to associate a diagnosis"
"RTN","SROADX",190,0)
 W !,?5,"or a group of diagnoses to the Other Procedures"
"RTN","SROADX",191,0)
 Q
"RTN","SROADX",192,0)
PHELP ;
"RTN","SROADX",193,0)
 W !!,?5,"The Principal Associated Diagnosis is used to associate a diagnosis"
"RTN","SROADX",194,0)
 W !,?5,"or a group of diagnoses to the Principal CPT Code"
"RTN","SROADX",195,0)
 Q
"RTN","SROADX",196,0)
DHELP ;
"RTN","SROADX",197,0)
 W !!,?5,"Please enter a list or range, e.g.,2, or 2,3 or 1-3"
"RTN","SROADX",198,0)
 W !,?5,"from the above list to be Deleted."
"RTN","SROADX",199,0)
 Q
"RTN","SROADX",200,0)
AHELP ;
"RTN","SROADX",201,0)
 W !!,?5,"Please enter a list or range, e.g.,2, or 2,3 or 1-3"
"RTN","SROADX",202,0)
 W !,?5,"from the above list to be Associated."
"RTN","SROADX",203,0)
 Q
"RTN","SROADX",204,0)
VHELP ;
"RTN","SROADX",205,0)
 W !!,?5
"RTN","SROADX",206,0)
 W:DIR("0")="SO^D:DELETE;Q:QUIT" "Select either D to Delete or Q to Quit"
"RTN","SROADX",207,0)
 W:DIR("0")="SO^A:ASSOCIATE;D:DELETE;Q:QUIT" "Select A to Associate, D to Delete or Q to Quit"
"RTN","SROADX",208,0)
 W:DIR("0")="SO^A:ASSOCIATE;Q:QUIT" "Select A to Associate or Q to Quit"
"RTN","SROADX",209,0)
 Q
"RTN","SROADX",210,0)
VHELP1 ;
"RTN","SROADX",211,0)
 W !!,?5
"RTN","SROADX",212,0)
 W:DIR("0")="SO^D:DELETE;Q:QUIT" "This will setup your choices for Deleting any Associated Diagnosis"
"RTN","SROADX",213,0)
 W:DIR("0")="SO^A:ASSOCIATE;D:DELETE;Q:QUIT" "This will setup your choices for Associating or Deleting any Associated Diagnosis"
"RTN","SROADX",214,0)
 W:DIR("0")="SO^A:ASSOCIATE;Q:QUIT" "This will setup your choices for Associating any Associated Diagnosis"
"RTN","SROADX",215,0)
 Q
"RTN","SROADX",216,0)
PINPUT ;
"RTN","SROADX",217,0)
 Q:$D(EMILY)
"RTN","SROADX",218,0)
 N SRC,SRDX
"RTN","SROADX",219,0)
 S SRC(1)="The Associated Diagnosis can only be added via the",SRC(1,"F")="!!?5"
"RTN","SROADX",220,0)
 S SRC(2)="Surgery Menu options.  Your entry has NOT been filed",SRC(2,"F")="!?5"
"RTN","SROADX",221,0)
 D EN^DDIOL(.SRC),CONT^SROADX1
"RTN","SROADX",222,0)
 K X
"RTN","SROADX",223,0)
 Q
"RTN","SROADX",224,0)
ADXPRMT ;
"RTN","SROADX",225,0)
 I SRDX1'="LO^:0",SRDX2'="LO^:0" S SRDX0="SO^1:ASSOCIATE;2:DELETE;3:QUIT",SROLST="A,D,Q",DIR("L")="   1  ASSOCIATE      2  DELETE    3  QUIT"
"RTN","SROADX",226,0)
 I SRDX1'="LO^:0",SRDX2="LO^:0" S SRDX0="SO^1:DELETE;2:QUIT",SROLST="D,Q",DIR("L")="         1  DELETE    2  QUIT"
"RTN","SROADX",227,0)
 I SRDX1="LO^:1",SRDX2'="LO^:0" S SRDX0="SO^1:ASSOCIATE;2:QUIT",SROLST="A,Q",DIR("L")="          1  ASSOCIATE    2  QUIT"
"RTN","SROADX",228,0)
 I SRDX1="LO^:0",SRDX2="LO^:0" S SRDX0="SO^1:QUIT",SROLST="A,Q",DIR("L")="          No Diagnosis to associate    1  QUIT"
"RTN","SROADX",229,0)
 S DIR(0)=SRDX0,DIR("L",1)="     Select one of the following:",DIR("L",2)=""
"RTN","SROADX",230,0)
 D ^DIR K DIR
"RTN","SROADX",231,0)
 Q
"RTN","SROADX",232,0)
DXDUP(SRDX) I (Y="^")!($G(DTOUT)) Q 0
"RTN","SROADX",233,0)
 N SRAI,SRDXX,SRDUP,DIR S SRDUP=0
"RTN","SROADX",234,0)
 I SRDX="" Q 0
"RTN","SROADX",235,0)
 F SRAI=1:1:$L(SRDX,",") D
"RTN","SROADX",236,0)
 .Q:$P(SRDX,",",SRAI)<1
"RTN","SROADX",237,0)
 .I $D(SRDXX($P(SRDX,",",SRAI)))!((SRDIRX($P(SRDX,",",SRAI))="ALL")&($L(SRDX,",")>1)) S SRDUP=1,DIR(0)="FO^",DIR("A",1)="     **Duplicates entered",DIR("A")="     Press Return to continue" D ^DIR
"RTN","SROADX",238,0)
 .S SRDXX($P(SRDX,",",SRAI))=""
"RTN","SROADX",239,0)
 Q SRDUP
"RTN","SROADX",240,0)
VALASC() I (Y="^")!('$G(Y(0)))!($G(DTOUT)) Q 1
"RTN","SROADX",241,0)
 N VALA,DIR S VALA=1
"RTN","SROADX",242,0)
 S:Y=""!(Y=U)!('+Y(0))!(Y[",0")!($P(Y,",",1)=0) VALA=0
"RTN","SROADX",243,0)
 I 'VALA S DIR("A",1)="     **Invalid input",DIR(0)="FO^",DIR("A")="     Press Return to continue" D ^DIR
"RTN","SROADX",244,0)
 Q VALA
"RTN","SROADX1")
0^6^B91413355
"RTN","SROADX1",1,0)
SROADX1 ; BIR/RJS - CONTINUED FROM SROADX ASSOCIATED DIAGNOSIS FOR CODER AND VERIFY SCREENS ;February 27, 2003 07:35:03
"RTN","SROADX1",2,0)
 ;;3.0;Surgery;**119**;24 Jun 93
"RTN","SROADX1",3,0)
OTHADX ;Display ASDX for OTHER PROCS
"RTN","SROADX1",4,0)
 K SRTMP,SRASSD,SROICD
"RTN","SROADX1",5,0)
 S SRPADX=0,SROCNTR=1
"RTN","SROADX1",6,0)
 F SRI=1:1 S SRPADX=$O(^SRF(SRTN,13,OTH,"OADX",SRPADX)) Q:'SRPADX  D
"RTN","SROADX1",7,0)
 .S SRASSD=^SRF(SRTN,13,OTH,"OADX",SRPADX,0)
"RTN","SROADX1",8,0)
 .D AASDX
"RTN","SROADX1",9,0)
 .S SRTMP(SRI)=SROICD,SROCNTR=SROCNTR+1
"RTN","SROADX1",10,0)
 S SROCNTR=0
"RTN","SROADX1",11,0)
 D ADXDISP
"RTN","SROADX1",12,0)
 I '$O(^SRF(SRTN,13,OTH,"OADX",0)) W !,?5,SRMSG,!
"RTN","SROADX1",13,0)
 D PASSDIAG
"RTN","SROADX1",14,0)
 D ASSDIAG
"RTN","SROADX1",15,0)
 Q
"RTN","SROADX1",16,0)
ASDX N SRI,SRFIRST,SRICD9,SRPRIN,SRPADX,SRASSD ;Display ASDX for PRIN Procs
"RTN","SROADX1",17,0)
 K SRTMP
"RTN","SROADX1",18,0)
 S SRI=0,SRFIRST=1
"RTN","SROADX1",19,0)
 F  S SRI=$O(^SRF(SRTN,"OPMOD",SRI)) Q:'SRI  S SRM=$P(^SRF(SRTN,"OPMOD",SRI,0),U)
"RTN","SROADX1",20,0)
 S SRPADX=0,SROCNTR=2
"RTN","SROADX1",21,0)
 F SRI=1:1 S SRPADX=$O(^SRF(SRTN,"PADX",SRPADX)) Q:'SRPADX  D
"RTN","SROADX1",22,0)
 .S SRASSD=^SRF(SRTN,"PADX",SRPADX,0)
"RTN","SROADX1",23,0)
 .D AASDX
"RTN","SROADX1",24,0)
 .S SRTMP(SRI)=SROICD,SROCNTR=SROCNTR+1
"RTN","SROADX1",25,0)
 D ADXDISP
"RTN","SROADX1",26,0)
 I '$O(^SRF(SRTN,"PADX",0)) W !,?5,SRMSG
"RTN","SROADX1",27,0)
 D PASSDIAG
"RTN","SROADX1",28,0)
 D ASSDIAG
"RTN","SROADX1",29,0)
 Q
"RTN","SROADX1",30,0)
AASDX S SROICD=""
"RTN","SROADX1",31,0)
 S:SRASSD SRICD9=$P($G(^SRF(SRTN,15,SRASSD,0)),U,3)
"RTN","SROADX1",32,0)
 S:'SRASSD SRICD9=$P($G(^SRF(SRTN,34)),U,2)
"RTN","SROADX1",33,0)
 S:SRICD9 SROICD=$$ICDSTR
"RTN","SROADX1",34,0)
 I 'SRICD9 D
"RTN","SROADX1",35,0)
 .S:SRASSD SROICD=^SRF(SRTN,15,SRASSD,0)
"RTN","SROADX1",36,0)
 .S:'SRASSD SROICD=$P(^SRF(SRTN,34),U,1)
"RTN","SROADX1",37,0)
 Q
"RTN","SROADX1",38,0)
PASSDIAG N ADCNT,SRICD9,SRFLG,SRCNTR,SRASSD  ;List PRIN DX to assoc.
"RTN","SROADX1",39,0)
 K SRADX,SRDIRX,SRADIAG
"RTN","SROADX1",40,0)
 S SRICD9=$P($G(^SRF(SRTN,34)),U,2)
"RTN","SROADX1",41,0)
 I SRICD9'="" S SRDIRX(1)=$$ICDSTR,SRADX(1)=$P(^ICD9(SRICD9,0),U,1),SRADIAG(1)=0
"RTN","SROADX1",42,0)
 I SRICD9="" S SRDIRX(1)=$G(^SRF(SRTN,34)),SRADIAG(1)=0
"RTN","SROADX1",43,0)
 Q
"RTN","SROADX1",44,0)
ASSDIAG N SRDCNT,SRADCNT,SRQ ;DXs for assoc.
"RTN","SROADX1",45,0)
 S (ADCNT,SRASSD)=0,SRCNT=2
"RTN","SROADX1",46,0)
 F  S ADCNT=$O(^SRF(SRTN,15,ADCNT)) Q:ADCNT=""  D
"RTN","SROADX1",47,0)
 .S SRICD9=$P(^SRF(SRTN,15,ADCNT,0),U,3)
"RTN","SROADX1",48,0)
 .S:SRICD9'="" SRDIRX(SRCNT)=$$ICDSTR,SRADX(SRCNT)=$P(^ICD9(SRICD9,0),U,1)
"RTN","SROADX1",49,0)
 .S:SRICD9="" SRDIRX(SRCNT)=$P(^SRF(SRTN,15,ADCNT,0),U,1)
"RTN","SROADX1",50,0)
 .S SRADIAG(SRCNT)=ADCNT,SRCNT=SRCNT+1
"RTN","SROADX1",51,0)
 S SRDX2="LO^:0"
"RTN","SROADX1",52,0)
 I (ADCNT<$$SRDIAGS) D
"RTN","SROADX1",53,0)
 .S:(SRCNT>2) SRDIRX(SRCNT)="ALL"
"RTN","SROADX1",54,0)
 .S:$D(SRDIRX) SRDX2="LO^:"_SRCNT
"RTN","SROADX1",55,0)
 Q
"RTN","SROADX1",56,0)
SRDIAGS() N SRDIAGS,SRDGCNT
"RTN","SROADX1",57,0)
 S (SRDIAGS,SRDGCNT)=0
"RTN","SROADX1",58,0)
 S:$D(^SRF(SRTN,34)) SRDIAGS=1
"RTN","SROADX1",59,0)
 F I=1:1 S SRDGCNT=$O(^SRF(SRTN,15,SRDGCNT)) Q:SRDGCNT=""  S SRDIAGS=SRDIAGS+1
"RTN","SROADX1",60,0)
 Q SRDIAGS
"RTN","SROADX1",61,0)
ICDSTR() N SRICDSTR
"RTN","SROADX1",62,0)
 S SRICDSTR=$P($$ICDDX^ICDCODE(SRICD9,SRSDATE),U,2)_"-"_$P($$ICDDX^ICDCODE(SRICD9,SRSDATE),U,4)
"RTN","SROADX1",63,0)
 Q SRICDSTR
"RTN","SROADX1",64,0)
PASSDS() N SRPADX,SRASSDS,SRPX
"RTN","SROADX1",65,0)
 S SRASSDS="",SRPADX=0
"RTN","SROADX1",66,0)
 F SRI=1:1 S SRPADX=$O(^SRF(SRTN,"PADX",SRPADX)) Q:'SRPADX  D
"RTN","SROADX1",67,0)
 .S SRPX=^SRF(SRTN,"PADX",SRPADX,0)
"RTN","SROADX1",68,0)
 .S SRPX=SRPX+1
"RTN","SROADX1",69,0)
 .S SRASSDS=$S($L(SRASSDS)<1:SRPX,1:SRASSDS_","_SRPX)
"RTN","SROADX1",70,0)
 Q SRASSDS
"RTN","SROADX1",71,0)
OASSDS() N SRPADX,SRASSDS,SRPX
"RTN","SROADX1",72,0)
 S SRASSDS="",SRPADX=0
"RTN","SROADX1",73,0)
 F SRI=1:1 S SRPADX=$O(^SRF(SRTN,13,D0,"OADX",SRPADX)) Q:'SRPADX  D
"RTN","SROADX1",74,0)
 .S SRPX=^SRF(SRTN,13,D0,"OADX",SRPADX,0)
"RTN","SROADX1",75,0)
 .S SRPX=SRPX+1
"RTN","SROADX1",76,0)
 .S SRASSDS=$S($L(SRASSDS)<1:SRPX,1:SRASSDS_","_SRPX)
"RTN","SROADX1",77,0)
 Q SRASSDS
"RTN","SROADX1",78,0)
SRODIR N SRFLG,SRCNT,SRCNTR
"RTN","SROADX1",79,0)
 S DIR("A",1)=""
"RTN","SROADX1",80,0)
 S (SRFLG,SRCNT)=1,SRCNTR=2,ADCNT=""
"RTN","SROADX1",81,0)
 F  S ADCNT=$O(SRDIRX(ADCNT)) Q:'ADCNT  D
"RTN","SROADX1",82,0)
 .S:'$D(DIR("A",SRCNTR)) DIR("A",SRCNTR)=""
"RTN","SROADX1",83,0)
 .S DIR("A",SRCNTR)=DIR("A",SRCNTR)_SRCNT_". "_SRDIRX(ADCNT),SRCNT=SRCNT+1,SRCNTR=SRCNTR+1,SRFLG=1
"RTN","SROADX1",84,0)
 S DIR("A",SRCNTR+2)=SRODIR("A",1),DIR("A")=SRODIR("A"),DIR("A",SRCNTR+1)=""
"RTN","SROADX1",85,0)
 Q
"RTN","SROADX1",86,0)
COTHBLD N SRCNT,OTH,X,CPT,CPT1,SRDA K SRSEL
"RTN","SROADX1",87,0)
 S OTH=0,SRCNT=1
"RTN","SROADX1",88,0)
 F  S OTH=$O(^SRF(SRTN,13,OTH)) Q:'OTH  D
"RTN","SROADX1",89,0)
 .S OTHER=$P(^SRF(SRTN,13,OTH,0),U)
"RTN","SROADX1",90,0)
 .S X=$P($G(^SRF(SRTN,13,OTH,2)),U),CPT="NOT ENTERED",CPT1=""
"RTN","SROADX1",91,0)
 .I X S CPT1=X,Y=$$CPT^ICPTCOD(X),SRCPT=$P(Y,U,2),SRSHT=$P(Y,U,3),Y=SRCPT,SRDA=OTH D SSOTH^SROCPT S SRCPT=Y,CPT=SRCPT_"  "_SRSHT
"RTN","SROADX1",92,0)
 .S SRSEL(SRCNT)=OTH_U_OTHER_"^CPT Code: "_CPT_U_CPT1
"RTN","SROADX1",93,0)
 .S SRCNT=SRCNT+1
"RTN","SROADX1",94,0)
 Q
"RTN","SROADX1",95,0)
OTHADXD N SRCOMMA,SROADX,SRICD9,SROADX1,SROODX,SRASSD,SRSUB ;OTHER PROCS ADXs
"RTN","SROADX1",96,0)
 I '$O(^SRF(SRTN,13,OTH,"OADX",0)) W !,?5,SRMSG Q
"RTN","SROADX1",97,0)
 S SRSUB=1
"RTN","SROADX1",98,0)
 D OTHADX
"RTN","SROADX1",99,0)
 Q
"RTN","SROADX1",100,0)
PADXD N SRCOMMA,SRPADX,SRICD9,SRPDX,SRPDX1,SROPRIN,SRSUB
"RTN","SROADX1",101,0)
 S SRPADX=0,SROCNTR=2,SRSUB=1
"RTN","SROADX1",102,0)
 I '$O(^SRF(SRTN,"PADX",0)),($D(^SRF(SRTN,34))),$D(^SRF(SRTN,"OP")) D
"RTN","SROADX1",103,0)
 .S SRASSD=0,SRFDA="130.275",SRIENU="+1"_","_SRTN_",",SRIENF=0_","_SRTN_"," D UPDATE,FILE
"RTN","SROADX1",104,0)
 D ASDX
"RTN","SROADX1",105,0)
 Q
"RTN","SROADX1",106,0)
ADXDISP N SROCNTR ;ADXS for PROC
"RTN","SROADX1",107,0)
 W !,?5,"Assoc. DX: "
"RTN","SROADX1",108,0)
 S (SROCNTR,SRDXCNT)=0
"RTN","SROADX1",109,0)
 F I=1:1  S SROCNTR=$O(SRTMP(SROCNTR)) Q:'SROCNTR  D
"RTN","SROADX1",110,0)
 .I $D(SRSUB) D
"RTN","SROADX1",111,0)
 ..W:'(I#2) ?48
"RTN","SROADX1",112,0)
 ..W:I#2 ?16
"RTN","SROADX1",113,0)
 ..W I,". ",$E(SRTMP(SROCNTR),1,25)
"RTN","SROADX1",114,0)
 ..I '(I#2),($O(SRTMP(SROCNTR))) W !
"RTN","SROADX1",115,0)
 .W:'$D(SRSUB) !,?8,I,". ",SRTMP(SROCNTR)
"RTN","SROADX1",116,0)
 S SRDXCNT=I
"RTN","SROADX1",117,0)
 S SRDX1="LO^:"_SRDXCNT
"RTN","SROADX1",118,0)
 S:SRDXCNT>0 SRDX1="LO^:"_SRDXCNT
"RTN","SROADX1",119,0)
 Q
"RTN","SROADX1",120,0)
OTHCPTD N SRM,SRI,SRFIRST ;PROCS/Codes/Mods.
"RTN","SROADX1",121,0)
 S SRFIRST=0
"RTN","SROADX1",122,0)
 W !,?3,"Other Procedures:",!!,OTHCNT,"."
"RTN","SROADX1",123,0)
 D COTHBLD
"RTN","SROADX1",124,0)
 W ?3,$P(SRSEL(SRDA),U,2),!,?2,"Other ",$P(SRSEL(SRDA),U,3)
"RTN","SROADX1",125,0)
 S OTH=$P(SRSEL(SRDA),U) K SRDES S CPT1=$P(SRSEL(SRDA),U,4),X=$$CPTD^ICPTCOD(CPT1,"SRDES") I $O(SRDES(0)) F I=1:1:X W !,?4,SRDES(I)
"RTN","SROADX1",126,0)
 W !,?3,"Modifiers: "
"RTN","SROADX1",127,0)
 S SRI=0
"RTN","SROADX1",128,0)
 F  S SRI=$O(^SRF(SRTN,13,OTH,"MOD",SRI)) Q:'SRI  D
"RTN","SROADX1",129,0)
 .S SRM=$P(^SRF(SRTN,13,OTH,"MOD",SRI,0),U)
"RTN","SROADX1",130,0)
 .W:SRFIRST !,?14
"RTN","SROADX1",131,0)
 .W $P($$MOD^ICPTMOD(SRM,"I"),"^",2),"-",$P($$MOD^ICPTMOD(SRM,"I"),"^",3)
"RTN","SROADX1",132,0)
 .S SRFIRST=1
"RTN","SROADX1",133,0)
 Q
"RTN","SROADX1",134,0)
CPTDISP S X=$P(S("OP"),U,2) I X D  W !
"RTN","SROADX1",135,0)
 .S SRY=$$CPT^ICPTCOD(X),Y=$P(SRY,U,2),(SROCPT2,Z)=$P(SRY,U,3)
"RTN","SROADX1",136,0)
 S:'$D(Y) Y="NOT ENTERED",Z=""
"RTN","SROADX1",137,0)
 W "  CPT Code: "_Y_"  ",Z,!,"  Description:" D ^SROCPT W ! F I=1:1:80 W "-"
"RTN","SROADX1",138,0)
 W !,?3,"Principal CPT Code: "_Y_"  ",!,?3,"Description:",Z,!,?3,"Modifiers: "
"RTN","SROADX1",139,0)
 S SRMOD=0
"RTN","SROADX1",140,0)
 F  S SRMOD=$O(^SRF(SRTN,"OPMOD",SRMOD)) Q:'SRMOD  D
"RTN","SROADX1",141,0)
 .S SRMO=$P(^SRF(SRTN,"OPMOD",SRMOD,0),U)
"RTN","SROADX1",142,0)
 .W:$G(SRFIRST) !,?14
"RTN","SROADX1",143,0)
 .W $P($$MOD^ICPTMOD(SRMO,"I"),"^",2),"-",$P($$MOD^ICPTMOD(SRMO,"I"),"^",3)
"RTN","SROADX1",144,0)
 .S SRFIRST=1
"RTN","SROADX1",145,0)
 Q
"RTN","SROADX1",146,0)
PADDALL Q:$E($G(IOST))'="C"!($G(DIK)'="")
"RTN","SROADX1",147,0)
 D KPADX^SROADX2(DA)
"RTN","SROADX1",148,0)
 N DIE,DR,DA,PADX,SRY,SRY1,SRICD9,SRCNTRN,SRIENU,SRIENF,SRASSD
"RTN","SROADX1",149,0)
 S SRY(0)=Y(0),SRFDA="130.275",SRIENU="+1"_","_SRTN_","
"RTN","SROADX1",150,0)
 S SRICD9=$P($G(^SRF(SRTN,34)),U,2),SRCNTR=1,SRIENF=SRCNTR_","_SRTN_",",SRASSD=0
"RTN","SROADX1",151,0)
 K SRY1 D UPDATE,FILE
"RTN","SROADX1",152,0)
 S PADX=0
"RTN","SROADX1",153,0)
 F  S PADX=$O(^SRF(SRTN,15,PADX)) Q:'PADX  S SRASSD=PADX,SRICD9=$P(^SRF(SRTN,15,SRASSD,0),U,3),SRCNTR=SRCNTR+1,SRIENF=SRCNTR_","_SRTN_"," K SRY1 D UPDATE,FILE
"RTN","SROADX1",154,0)
 S Y(0)=SRY(0)
"RTN","SROADX1",155,0)
 Q
"RTN","SROADX1",156,0)
PADD1 ;PRIN ADX
"RTN","SROADX1",157,0)
 N SRY,SRY0,SRY1,SRY2,SRC,REC,DIE,DA,DR,SRASSD
"RTN","SROADX1",158,0)
 S SRY(0)=Y(0)
"RTN","SROADX1",159,0)
 D KPADX^SROADX2(SRTN)
"RTN","SROADX1",160,0)
 S SRCNTR=0,SRASSD=SRADIAG($P(SRY(0),",",1)),SRFDA="130.275",SRIENU="+1"_","_SRTN_",",SRIENF=SRCNTR_","_SRTN_"," D UPDATE,FILE
"RTN","SROADX1",161,0)
 S SRY(0)=$E(SRY(0),2,$L(SRY(0)))
"RTN","SROADX1",162,0)
 F SRY2=1:1:$P(SRDX2,":",2) D
"RTN","SROADX1",163,0)
 .S SRY0=$P(SRY(0),",",SRY2)
"RTN","SROADX1",164,0)
 .Q:SRY0<1
"RTN","SROADX1",165,0)
 .S SRCNTR=$P(^SRF(SRTN,"PADX",0),U,3)+1,SRASSD=SRADIAG(SRY0),SRFDA="130.275",SRIENU="+1"_","_SRTN_",",SRIENF=SRCNTR_","_SRTN_"," D UPDATE,FILE
"RTN","SROADX1",166,0)
 S Y(0)=SRY(0)
"RTN","SROADX1",167,0)
 Q
"RTN","SROADX1",168,0)
UPDATE ;
"RTN","SROADX1",169,0)
 S SRY1(SRFDA,SRIENU,".01")=SRASSD
"RTN","SROADX1",170,0)
 D UPDATE^DIE("","SRY1")
"RTN","SROADX1",171,0)
 Q
"RTN","SROADX1",172,0)
FILE ;
"RTN","SROADX1",173,0)
 S SRY1(SRFDA,SRIENF,".01")=SRASSD
"RTN","SROADX1",174,0)
 D FILE^DIE("","SRY1")
"RTN","SROADX1",175,0)
 K SRY1
"RTN","SROADX1",176,0)
 Q
"RTN","SROADX1",177,0)
PDELALL W !,"Are you sure you want to DELETE ALL Associated Diagnoses ? (Y/N) "
"RTN","SROADX1",178,0)
 S SRY(0)=Y(0)
"RTN","SROADX1",179,0)
 S %=2 D YN^DICN
"RTN","SROADX1",180,0)
 I %=1 Q:$E($G(IOST))'="C"!($G(DIK)'="")  D KPADX^SROADX2(DA)
"RTN","SROADX1",181,0)
 S Y(0)=SRY(0)
"RTN","SROADX1",182,0)
 Q
"RTN","SROADX1",183,0)
PDEL1 N SRC,SRY,SRY1,SRY2,REC,SRICD9,SRASSD ;DEL 1 PRIN ADX
"RTN","SROADX1",184,0)
 S (SRY,SRY0)=0
"RTN","SROADX1",185,0)
 F  S SRY=$O(^SRF(SRTN,"PADX",SRY)) Q:'SRY  S SRY0=SRY0+1,REC(SRY0)=SRY
"RTN","SROADX1",186,0)
 S SRY(0)=Y(0),SRFDA="130.275"
"RTN","SROADX1",187,0)
 F SRY2=1:1:SRDXCNT D
"RTN","SROADX1",188,0)
 .S SRY0=$P(SRY(0),",",SRY2)
"RTN","SROADX1",189,0)
 .Q:'SRY0
"RTN","SROADX1",190,0)
 .Q:'$D(REC(SRY0))
"RTN","SROADX1",191,0)
 .I SRY0=1,$P(^SRF(SRTN,"PADX",0),U,4)>1 K SRC S SRC(1)="PLEASE DELETE ALL DIAGNOSIS BEFORE THE PRINCIPAL",SRC(1,"F")="!!?5" D SRCWRT K SRC Q 
"RTN","SROADX1",192,0)
 .S SRIENF=REC(SRY0)_","_SRTN_",",SRASSD="@"
"RTN","SROADX1",193,0)
 .W !,"Are you sure you want to DELETE ",SRTMP(SRY0)," ? (Y/N) "
"RTN","SROADX1",194,0)
 .S %=2 D YN^DICN
"RTN","SROADX1",195,0)
 .I %=1 D FILE
"RTN","SROADX1",196,0)
 S Y(0)=SRY(0)
"RTN","SROADX1",197,0)
 Q
"RTN","SROADX1",198,0)
ODEL1 N SRY,SRY0,SRY1,SRY2,SRASSD ;DEL 1 OTH ADX
"RTN","SROADX1",199,0)
 S (SRY,SRY0)=0
"RTN","SROADX1",200,0)
 F  S SRY=$O(^SRF(SRTN,13,OTH,"OADX",SRY)) Q:'SRY  S SRY0=SRY0+1,REC(SRY0)=SRY
"RTN","SROADX1",201,0)
 S SRY(0)=Y(0),SRFDA="130.165"
"RTN","SROADX1",202,0)
 F SRY2=1:1:SRDXCNT D
"RTN","SROADX1",203,0)
 .S SRY0=$P(SRY(0),",",SRY2)
"RTN","SROADX1",204,0)
 .Q:'SRY0
"RTN","SROADX1",205,0)
 .S SRIENF=REC(SRY0)_","_OTH_","_SRTN_",",SRASSD="@"
"RTN","SROADX1",206,0)
 .W !,"Are you sure you want to DELETE ",SRTMP(SRY0)," ? (Y/N) "
"RTN","SROADX1",207,0)
 .Q:SRTMP(SRY0)=""
"RTN","SROADX1",208,0)
 .S %=2 D YN^DICN
"RTN","SROADX1",209,0)
 .I %=1 D FILE
"RTN","SROADX1",210,0)
 S Y(0)=SRY(0)
"RTN","SROADX1",211,0)
 Q
"RTN","SROADX1",212,0)
OADDALL Q:$E($G(IOST))'="C"!($G(DIK)'="")  D KOADX^SROADX2(SRTN,OTH) ;Associate all Diagnosis to OTHER Procedure
"RTN","SROADX1",213,0)
 N SRICD9,PADX,SRFDA,SRIENU,SRIENF,SRY,SRY1
"RTN","SROADX1",214,0)
 S SRY(0)=Y(0),SRFDA="130.165",SRIENU="+1"_","_OTH_","_SRTN_","
"RTN","SROADX1",215,0)
 S PADX=0
"RTN","SROADX1",216,0)
 F  S PADX=$O(SRADIAG(PADX)) Q:'PADX  S SRASSD=SRADIAG(PADX),SRIENF=PADX_","_OTH_","_SRTN_"," K SRY1 D UPDATE,FILE
"RTN","SROADX1",217,0)
 S Y(0)=SRY(0)
"RTN","SROADX1",218,0)
 Q
"RTN","SROADX1",219,0)
OADD1 N SRY,SRY0,SRY1,SRY2,SRCNTR,SRASSD ;Associate 1 Diagnosis to OTHER Procedure
"RTN","SROADX1",220,0)
 S SRY(0)=Y(0),SRCNTR=0
"RTN","SROADX1",221,0)
 S:$D(^SRF(SRTN,13,OTH,"OADX")) SRCNTR=$P(^SRF(SRTN,13,OTH,"OADX",0),U,3)+1
"RTN","SROADX1",222,0)
 D KOADX^SROADX2(SRTN,OTH)
"RTN","SROADX1",223,0)
 S:'$D(^SRF(SRTN,13,OTH,"OADX")) SRCNTR=1
"RTN","SROADX1",224,0)
 S SRFDA="130.165",SRIENU="+1"_","_OTH_","_SRTN_","
"RTN","SROADX1",225,0)
 I SRDIRX(+Y)="ALL" D
"RTN","SROADX1",226,0)
 .S SRY0=0
"RTN","SROADX1",227,0)
 .F  S SRY0=$O(SRADIAG(SRY0)) Q:'SRY0  D
"RTN","SROADX1",228,0)
 ..I '$D(^SRF(SRTN,13,OTH,"OADX","B",SRADIAG(SRY0))) D
"RTN","SROADX1",229,0)
 ..S SRASSD=SRADIAG(SRY0),SRIENF=SRCNTR_","_OTH_","_SRTN_"," K SRY1 D UPDATE,FILE
"RTN","SROADX1",230,0)
 ..S SRCNTR=SRCNTR+1
"RTN","SROADX1",231,0)
 I SRDIRX(+Y)'="ALL" D
"RTN","SROADX1",232,0)
 .F SRY2=1:1:$P(SRDX2,":",2) D
"RTN","SROADX1",233,0)
 ..S SRY0=$P(SRY(0),",",SRY2)
"RTN","SROADX1",234,0)
 ..Q:'SRY0
"RTN","SROADX1",235,0)
 ..S SRASSD=SRADIAG(SRY0),SRIENF=SRCNTR_","_OTH_","_SRTN_"," K SRY1 D UPDATE,FILE
"RTN","SROADX1",236,0)
 ..S SRCNTR=SRCNTR+1
"RTN","SROADX1",237,0)
 S Y(0)=SRY(0)
"RTN","SROADX1",238,0)
 Q
"RTN","SROADX1",239,0)
SRCMSG S SRDX=X
"RTN","SROADX1",240,0)
 S SRC(1)="The Diagnosis/Procedure Code Association may no longer be correct,",SRC(1,"F")="!!?5"
"RTN","SROADX1",241,0)
 S SRC(2)="please confirm or update the values in the Diagnosis Association Field",SRC(2,"F")="!?5"
"RTN","SROADX1",242,0)
 Q
"RTN","SROADX1",243,0)
SRCWRT D EN^DDIOL(.SRC)
"RTN","SROADX1",244,0)
 D CONT
"RTN","SROADX1",245,0)
 Q:$G(DTOUT)
"RTN","SROADX1",246,0)
 S:$D(SRDX) X=SRDX
"RTN","SROADX1",247,0)
 S SRFLG=1
"RTN","SROADX1",248,0)
 Q
"RTN","SROADX1",249,0)
CONT N DIR
"RTN","SROADX1",250,0)
 S DIR(0)="FO^"
"RTN","SROADX1",251,0)
 S DIR("A")="Press RETURN to continue  "
"RTN","SROADX1",252,0)
 D ^DIR
"RTN","SROADX1",253,0)
 Q
"RTN","SROADX1",254,0)
ADXKILL K ADCNT,SRCOMMA,SRDXCNT,SROCNTR,SROCPT2,SROFLG,SRTMP,SRICD9,SRDIAGS
"RTN","SROADX1",255,0)
 K SRASDX,SRMSG,SRADX,SRPADX,SRODIR,REC,SRDIRX,SROANS
"RTN","SROADX1",256,0)
 Q
"RTN","SROADX2")
0^15^B25027264
"RTN","SROADX2",1,0)
SROADX2 ; BIR/RJS - ASSOCIATED DIAGNOSIS FOR CODER AND VERIFY SCREENS ; 3/8/05 2:14pm
"RTN","SROADX2",2,0)
 ;;3.0; Surgery ;**119**;24 Jun 93
"RTN","SROADX2",3,0)
PDXCHK(SRCODE) N SRYBAK,SRXBAK,DIR,SRQUIT,SRTEMP,DA
"RTN","SROADX2",4,0)
 Q:'$D(D0)
"RTN","SROADX2",5,0)
 I '$D(SRTN) N SRTN S SRTN=D0
"RTN","SROADX2",6,0)
 Q:D0=SRTN
"RTN","SROADX2",7,0)
 S ^TMP($J,"SRASOC",SRTN)=""
"RTN","SROADX2",8,0)
 M SRYBAK=Y
"RTN","SROADX2",9,0)
 I SRYBAK=1 S SRYBAK=""
"RTN","SROADX2",10,0)
 S DIR(0)="Y",SRXBAK=X,SRQUIT=0,SRKALL=0,Y=0
"RTN","SROADX2",11,0)
 S DIR("A",1)="The Procedure Associations may no longer be correct,"
"RTN","SROADX2",12,0)
 I SRCODE D
"RTN","SROADX2",13,0)
 .Q:$$PRLOOP(1)=0
"RTN","SROADX2",14,0)
 .I $P(XQY0,U)'="SROVER"&($P(XQY0,U)'="SRCODING EDIT") S DIR("A",2)="Please update the Associations in the CPT/CODE or PHYSICIAN'S VERIFY menu"
"RTN","SROADX2",15,0)
 .S DIR("A")="Delete PRINCIPAL Procedure Associations for this DX",DIR("B")="N"
"RTN","SROADX2",16,0)
 .S:$$GET1^DIQ(130.18,D0_","_SRTN_",",3) DIR("B")="Y"
"RTN","SROADX2",17,0)
 .D ^DIR
"RTN","SROADX2",18,0)
 I 'SRCODE D
"RTN","SROADX2",19,0)
 .I $$PRLOOP(1)=0,$$OTLOOP(1)=0 Q
"RTN","SROADX2",20,0)
 .S DIR("A")="All Procedure Associations for this DX will be deleted. Continue",DIR("B")="N"
"RTN","SROADX2",21,0)
 .D ^DIR S:'Y SRXBAK=SRYBAK,SRQUIT=1
"RTN","SROADX2",22,0)
 .S:Y SRKALL=1
"RTN","SROADX2",23,0)
 S:Y SRTEMP=$$PRLOOP(0)
"RTN","SROADX2",24,0)
 M Y=SRYBAK S X=SRXBAK
"RTN","SROADX2",25,0)
 I SRQUIT W !! Q
"RTN","SROADX2",26,0)
 K DIR
"RTN","SROADX2",27,0)
 D OTHCHK(SRCODE)
"RTN","SROADX2",28,0)
 K SRKALL,SRMATCH,DIR
"RTN","SROADX2",29,0)
 Q
"RTN","SROADX2",30,0)
OTHCHK(SRCODE) N OTH,DA,SRY,SRQUIT,SRYBAK,SRXBAK,DIR
"RTN","SROADX2",31,0)
 M SRYBAK=Y
"RTN","SROADX2",32,0)
 S SRQUIT=0,SRXBAK=X
"RTN","SROADX2",33,0)
 I 'SRKALL W ! D
"RTN","SROADX2",34,0)
 .Q:$$OTLOOP(1)=0
"RTN","SROADX2",35,0)
 .S DIR(0)="Y",DIR("A",1)="The OTHER Prodecure Associations may no longer be correct."
"RTN","SROADX2",36,0)
 .I SRCODE D
"RTN","SROADX2",37,0)
 ..I $P(XQY0,U)'="SROVER"&($P(XQY0,U)'="SRCODING EDIT") S DIR("A",2)="Please update the Associations in the CPT/CODE or PHYSICIAN'S VERIFY menu"
"RTN","SROADX2",38,0)
 ..S DIR("A")="Delete OTHER Procedure Associations for this DX",DIR("B")="N"
"RTN","SROADX2",39,0)
 ..S:$$GET1^DIQ(130.18,D0_","_SRTN_",",3) DIR("B")="Y"
"RTN","SROADX2",40,0)
 ..D ^DIR W !!
"RTN","SROADX2",41,0)
 I Y!SRKALL D
"RTN","SROADX2",42,0)
 .N DA S OTH=0
"RTN","SROADX2",43,0)
 .F  S OTH=$O(^SRF(SRTN,13,OTH)) Q:'OTH  D
"RTN","SROADX2",44,0)
 ..S DA=0
"RTN","SROADX2",45,0)
 ..F  S DA=$O(^SRF(SRTN,13,OTH,"OADX",DA)) Q:'+DA  D
"RTN","SROADX2",46,0)
 ...I D0=^SRF(SRTN,13,OTH,"OADX",DA,0) D  Q
"RTN","SROADX2",47,0)
 ....D KOADX(SRTN,OTH)
"RTN","SROADX2",48,0)
 M Y=SRYBAK S X=SRXBAK
"RTN","SROADX2",49,0)
 Q
"RTN","SROADX2",50,0)
MSG Q:$D(SRFLG)
"RTN","SROADX2",51,0)
 Q:'$D(EMILY)
"RTN","SROADX2",52,0)
 D SRCMSG^SROADX1
"RTN","SROADX2",53,0)
 D SRCWRT^SROADX1
"RTN","SROADX2",54,0)
 Q
"RTN","SROADX2",55,0)
PRLOOP(SRCHK) N SRDX,SRMATCH S (SRDX,SRMATCH)=0
"RTN","SROADX2",56,0)
 F SRI=1:1 S SRDX=$O(^SRF(SRTN,"PADX",SRDX)) Q:'SRDX  D
"RTN","SROADX2",57,0)
 .I (D0=^SRF(SRTN,"PADX",SRDX,0))!($G(DA)=^SRF(SRTN,"PADX",SRDX,0)) S SRMATCH=1 Q
"RTN","SROADX2",58,0)
 I SRMATCH,'SRCHK D KPADX(SRTN)
"RTN","SROADX2",59,0)
 Q SRMATCH
"RTN","SROADX2",60,0)
OTLOOP(SRCHK) N SRDA,OTH,SRMATCH S (OTH,SRMATCH)=0
"RTN","SROADX2",61,0)
 F  S OTH=$O(^SRF(SRTN,13,OTH)) Q:'OTH  D
"RTN","SROADX2",62,0)
 .S SRDA=0
"RTN","SROADX2",63,0)
 .F  S SRDA=$O(^SRF(SRTN,13,OTH,"OADX",SRDA)) Q:'+SRDA  D
"RTN","SROADX2",64,0)
 ..I (D0=^SRF(SRTN,13,OTH,"OADX",SRDA,0))!($G(DA)=^SRF(SRTN,13,OTH,"OADX",SRDA,0)) D  Q
"RTN","SROADX2",65,0)
 ...I 'SRCHK D KOADX(SRTN,SRDA)
"RTN","SROADX2",66,0)
 ...S SRMATCH=1
"RTN","SROADX2",67,0)
 Q SRMATCH
"RTN","SROADX2",68,0)
DELASOC N DIR,Y,SRPR,SROT,SRXBAK
"RTN","SROADX2",69,0)
 S:'$D(SRTN)&$D(DA(1)) SRTN=DA(1)
"RTN","SROADX2",70,0)
 S:'$D(SRTN)&'$D(DA(1)) SRTN=DA
"RTN","SROADX2",71,0)
 I $D(^TMP($J,"SRASOC",SRTN)) K ^TMP($J,"SRASOC",SRTN) Q
"RTN","SROADX2",72,0)
 Q:$G(D0)=""
"RTN","SROADX2",73,0)
 S SRPR=$$PRLOOP(1),SROT=$$OTLOOP(1),SRXBAK=X
"RTN","SROADX2",74,0)
 I 'SRPR,'SROT Q
"RTN","SROADX2",75,0)
 S DIR(0)="FO",DIR("A")="Procedure Associations for this Diagnosis will be deleted. Continue"
"RTN","SROADX2",76,0)
 D ^DIR
"RTN","SROADX2",77,0)
 S SRPR=$$PRLOOP(0),SROT=$$OTLOOP(0)
"RTN","SROADX2",78,0)
 S X=SRXBAK
"RTN","SROADX2",79,0)
 Q
"RTN","SROADX2",80,0)
PRINASO(SRCODE) Q:$G(SRTN)=""!($G(X)="")
"RTN","SROADX2",81,0)
 N D0 S D0=0  D PDXCHK(SRCODE) K SRCODE Q
"RTN","SROADX2",82,0)
PRINASOD Q:$G(SRTN)=""!($G(X)="")
"RTN","SROADX2",83,0)
 I $D(^TMP($J,"SRASOC",SRTN)) K ^TMP($J,"SRASOC",SRTN) Q
"RTN","SROADX2",84,0)
 N D0 S D0=0  D DELASOC Q
"RTN","SROADX2",85,0)
PCPTASO(SRCODE) Q:$G(SRTN)=""!($G(X)="")
"RTN","SROADX2",86,0)
 I $G(D0)=""!('+$G(X)&(SRCODE))!('$D(^SRF(SRTN,"PADX"))) Q
"RTN","SROADX2",87,0)
 D:$$EDITWARN(SRCODE) KPADX(SRTN)
"RTN","SROADX2",88,0)
 K SRCODE
"RTN","SROADX2",89,0)
 Q
"RTN","SROADX2",90,0)
OCPTASO(SRCODE) Q:$G(SRTN)=""!($G(DA)="")!($G(X)="")
"RTN","SROADX2",91,0)
 I $G(D0)=""!('+$G(X)&(SRCODE))!('$D(^SRF(SRTN,13,DA,"OADX",0))) Q
"RTN","SROADX2",92,0)
 K:$$EDITWARN(SRCODE) ^SRF(SRTN,13,DA,"OADX")
"RTN","SROADX2",93,0)
 K SRCODE
"RTN","SROADX2",94,0)
 Q
"RTN","SROADX2",95,0)
EDITWARN(SRCODE) N SRYBAK,SRXBAK,DIR,SRY
"RTN","SROADX2",96,0)
 M SRYBAK=Y,SRDABAK=DA
"RTN","SROADX2",97,0)
 S DIR(0)="Y",DIR("B")="N",SRXBAK=X,SRQUIT=0
"RTN","SROADX2",98,0)
 S DIR("A",1)="The Diagnosis to Procedure Associations may no longer be correct."
"RTN","SROADX2",99,0)
 I SRCODE D
"RTN","SROADX2",100,0)
 .I $P(XQY0,U)'="SROVER"&($P(XQY0,U)'="SRCODING EDIT") S DIR("A",2)="Please update the Associations in the CPT/CODE or PHYSICIAN'S VERIFY menu."
"RTN","SROADX2",101,0)
 .S DIR("A")="Delete Diagnosis Associations for this Procedure"
"RTN","SROADX2",102,0)
 .D ^DIR
"RTN","SROADX2",103,0)
 I 'SRCODE D
"RTN","SROADX2",104,0)
 .S DIR("A")="All DX Associations for this Procedure will be deleted. Continue"
"RTN","SROADX2",105,0)
 .D ^DIR
"RTN","SROADX2",106,0)
 .S:'Y SRXBAK=SRYBAK
"RTN","SROADX2",107,0)
 S X=SRXBAK,SRY=Y
"RTN","SROADX2",108,0)
 M Y=SRYBAK,DA=SRDABAK
"RTN","SROADX2",109,0)
 W !!
"RTN","SROADX2",110,0)
 Q SRY
"RTN","SROADX2",111,0)
KPADX(SRCN) ; kill all the principal cpt associated diagnosis codes
"RTN","SROADX2",112,0)
 N DA,DIK,SRX1,Y
"RTN","SROADX2",113,0)
 S SRX1=0,DA(1)=SRCN
"RTN","SROADX2",114,0)
 F  S SRX1=$O(^SRF(DA(1),"PADX",SRX1)) Q:'SRX1  D
"RTN","SROADX2",115,0)
 .S DA=SRX1,DA(1)=SRCN,DIK="^SRF("_DA(1)_",""PADX""," D ^DIK
"RTN","SROADX2",116,0)
 Q
"RTN","SROADX2",117,0)
KOADX(SRCN,SRREC) ; kill other cpt associated diagnosis codes
"RTN","SROADX2",118,0)
 N DA,DIK,SRX1,Y
"RTN","SROADX2",119,0)
 S SRX1=0,DA(2)=SRCN
"RTN","SROADX2",120,0)
 F  S SRX1=$O(^SRF(DA(2),13,SRREC,"OADX",SRX1)) Q:'SRX1  D
"RTN","SROADX2",121,0)
 .S DA=SRX1,DA(1)=SRREC,DA(2)=SRCN,DIK="^SRF("_DA(2)_",13,"_DA(1)_",""OADX""," D ^DIK
"RTN","SROADX2",122,0)
 Q
"RTN","SROANEST")
0^3^B53233881
"RTN","SROANEST",1,0)
SROANEST ;BIR/TJH - ANESTHESIA ENTRY ;01 Jun 2003
"RTN","SROANEST",2,0)
 ;;3.0;Surgery;**119**;24 Jun 93
"RTN","SROANEST",3,0)
SINPUT ;
"RTN","SROANEST",4,0)
 N SRSTART
"RTN","SROANEST",5,0)
 S Z=$E($P(^SRF($S($D(SRTN):SRTN,1:DA(1)),0),"^",9),1,7),X=$S(X?1.4N.A!(X?1.2N1":"2N.A):Z_"@"_X,1:X) K %DT,Z S %DT="RTX" D ^%DT S X=Y K:Y<1 X
"RTN","SROANEST",6,0)
 I '$D(X),$G(SRFLAG)=1 D  K SRFLAG Q
"RTN","SROANEST",7,0)
 .W !!,"Check date format.",!,"     Examples of Valid Dates:",!,"       JAN 20 1957 or 20 JAN 57 or 1/20/57 or 012057",!,"       T   (for TODAY),  T+1 (for TOMORROW),  T+2,  T+7,  etc."
"RTN","SROANEST",8,0)
 .W !,"       T-1 (for YESTERDAY),  T-3W (for 3 WEEKS AGO), etc.",!,"     If the year is omitted, the computer uses CURRENT YEAR.  Two digit year"
"RTN","SROANEST",9,0)
 .W !,"       assumes no more than 20 years in the future, or 80 years in the past.",!,"     If only the time is entered, the current date is assumed."
"RTN","SROANEST",10,0)
 .W !,"     Follow the date with a time, such as JAN 20@10, T@10AM, 10:30, etc.",!,"     You may enter a time, such as NOON, MIDNIGHT or NOW."
"RTN","SROANEST",11,0)
 .W !,"     You may enter   NOW+3'  (for current date and time Plus 3 minutes",!,"       *Note--the Apostrophe following the number of minutes)"
"RTN","SROANEST",12,0)
 .W !,"     Time is REQUIRED in this response.",!,"     Enter the time a member of the Anesthesia staff begins preparing the",!,"     patient for surgery in the O.R. suite or if the care is interrupted, the"
"RTN","SROANEST",13,0)
 .W !,"     time the care resumes."
"RTN","SROANEST",14,0)
 Q:'$D(X)
"RTN","SROANEST",15,0)
 S SRSTART=$P($G(^SRF($S($D(SRTN):SRTN,1:DA(1)),.2)),"^",15)
"RTN","SROANEST",16,0)
 I SRSTART="" K SRFLAG Q
"RTN","SROANEST",17,0)
 I X<SRSTART W !!,"The time entered is before the 'TIME PAT IN HOLD AREA'.  Please check the",!,"DATE/TIME entered for this field." K X
"RTN","SROANEST",18,0)
 K SRFLAG
"RTN","SROANEST",19,0)
 Q
"RTN","SROANEST",20,0)
STIME ;
"RTN","SROANEST",21,0)
 I '$D(X) Q
"RTN","SROANEST",22,0)
 N SRSPREC,SRPET,SRTIME,SRCRET
"RTN","SROANEST",23,0)
 S SRCRET=$$GET1^DIQ(130.213,DA(2)_","_DA(1)_",",1,"I")
"RTN","SROANEST",24,0)
 I SRCRET,(X>SRCRET) W !!,"Start time is after current end time. Please correct." K X Q
"RTN","SROANEST",25,0)
 S SRSPREC=$O(^SRF(DA(1),50,DA(2)),-1)
"RTN","SROANEST",26,0)
 I SRSPREC'=0 D
"RTN","SROANEST",27,0)
 .S SRPET=$$GET1^DIQ(130.213,SRSPREC_","_DA(1)_",",1,"I")
"RTN","SROANEST",28,0)
 .I SRPET="" W !!,"New start time entry not permitted until previous end time is entered." K X Q
"RTN","SROANEST",29,0)
 .I SRPET>X W !!,"Start time is prior to previous end time. Please correct." K X
"RTN","SROANEST",30,0)
 I $D(X),(DA(2)=1) S SRTIME(130,DA(1)_",",.21)=X D FILE^DIE("","SRTIME","^TMP(""SR"",$J)")
"RTN","SROANEST",31,0)
 Q
"RTN","SROANEST",32,0)
FINALT  ;
"RTN","SROANEST",33,0)
 N SRCST,SRLET,SRYN,SRSNREC,SRFDA,SRTIME,SRLREC,SRCON
"RTN","SROANEST",34,0)
 I $D(^SRF(DA(1),"CON")),$P(^("CON"),"^") S SRCON=$P(^SRF(DA(1),"CON"),"^")
"RTN","SROANEST",35,0)
 S SRCST=$$GET1^DIQ(130.213,DA(2)_","_DA(1)_",",.01,"I")
"RTN","SROANEST",36,0)
 I X<SRCST W !!,"End time prior to start time.  Please correct." K X Q
"RTN","SROANEST",37,0)
 S SRSNREC=$O(^SRF(DA(1),50,DA(2)))
"RTN","SROANEST",38,0)
 I SRSNREC'="B" Q
"RTN","SROANEST",39,0)
ASK W !!,"Does this entry complete all start and end times for this case?  (Y/N)//  " R SRYN:DTIME I '$T!(SRYN["^") S SRYN="N" Q
"RTN","SROANEST",40,0)
 S SRYN=$E(SRYN) I "YyNn?"'[SRYN W !,"Invalid response, please enter Yes or No. Use ? for help." G ASK
"RTN","SROANEST",41,0)
 I "?"[SRYN D HELP G ASK
"RTN","SROANEST",42,0)
 I ("Nn"[SRYN) S SRFDA(130,DA(1)_",",.214)="@" D FILE^DIE("","SRFDA","^TMP(""SR"",$J)") K SRFDA Q
"RTN","SROANEST",43,0)
 D CHKTIME
"RTN","SROANEST",44,0)
 I SRAFLAG=1 K SRAFLAG Q
"RTN","SROANEST",45,0)
 S SRLREC=$O(^SRF(DA(1),50,"B"),-1)
"RTN","SROANEST",46,0)
 I SRLREC'=DA(2) S SRLET=$$GET1^DIQ(130.213,SRLREC_","_DA(1)_",",1,"I")
"RTN","SROANEST",47,0)
 I SRLREC=DA(2) S SRLET=X
"RTN","SROANEST",48,0)
 S SRTIME(130,DA(1)_",",.24)=SRLET,SRTIME(130,DA(1)_",",.214)="1" D FILE^DIE("","SRTIME","^TMP(""SR"",$J)")
"RTN","SROANEST",49,0)
 K SRAFLAG
"RTN","SROANEST",50,0)
 Q:'$D(SRCON)
"RTN","SROANEST",51,0)
ASK2 ;
"RTN","SROANEST",52,0)
 W !,"Does this entry complete all start and end times for the concurrent",!,"case? (Y/N)//  " R SRYN:DTIME I '$T!(SRYN["^") S SRYN="N" Q
"RTN","SROANEST",53,0)
 I "?"[SRYN D HELP^SROCON D HELP G ASK2
"RTN","SROANEST",54,0)
 S SRYN=$E(SRYN) I "YyNn"'[SRYN W !,"Invalid response, please enter Yes or No. Use ? for help." G ASK2
"RTN","SROANEST",55,0)
 I ("Nn"[SRYN),(($P(^SRF(SRCON,.2),"^",17)=1)) S SRFDA(130,SRCON_",",.214)="@" D FILE^DIE("","SRFDA","^TMP(""SR"",$J)") K SRFDA Q
"RTN","SROANEST",56,0)
 S SRTIME(130,SRCON_",",.214)="1" D FILE^DIE("","SRTIME","^TMP(""SR"",$J)")
"RTN","SROANEST",57,0)
 Q
"RTN","SROANEST",58,0)
CHKTIME ;  verify blocks of time are valid
"RTN","SROANEST",59,0)
 N SRSREC,SRCST,SRCET,SRAFLAG1,SRSNREC,SRNST,SRLREC
"RTN","SROANEST",60,0)
 S SRAFLAG=0,SRSREC=0,SRAFLAG1=0
"RTN","SROANEST",61,0)
 F  S SRSREC=$O(^SRF(DA(1),50,SRSREC)) Q:'SRSREC!(SRAFLAG1=1)  D 
"RTN","SROANEST",62,0)
 .S SRCST=$$GET1^DIQ(130.213,SRSREC_","_DA(1)_",",.01,"I"),SRCET=$$GET1^DIQ(130.213,SRSREC_","_DA(1)_",",1,"I")
"RTN","SROANEST",63,0)
 .S SRLREC=$O(^SRF(DA(1),50,"B"),-1)
"RTN","SROANEST",64,0)
 .I (SRCET=""),(SRSREC'=SRLREC) W !!,"One or more time entries missing end time.  Please correct." S SRAFLAG=1,SRAFLAG1=1 Q
"RTN","SROANEST",65,0)
 .S SRSNREC=$O(^SRF(DA(1),50,SRSREC))
"RTN","SROANEST",66,0)
 .I SRSNREC="B" S SRAFLAG1=1 Q
"RTN","SROANEST",67,0)
 .S SRNST=$$GET1^DIQ(130.213,SRSNREC_","_DA(1)_",",.01,"I")
"RTN","SROANEST",68,0)
 .I SRNST<SRCET W !!,"Some time entries overlap.  Please correct." S SRAFLAG=1,SRAFLAG1=1 Q
"RTN","SROANEST",69,0)
 Q
"RTN","SROANEST",70,0)
CSET ;  caled by set xref of mult anes start and end times used for concurrent case anes field stuffing
"RTN","SROANEST",71,0)
 N SRSREC,SRCST,SRCET,SRTIME
"RTN","SROANEST",72,0)
 I $$GET1^DIQ(130,DA(1),.214,"I")'=1 Q
"RTN","SROANEST",73,0)
 S SRSREC=0
"RTN","SROANEST",74,0)
 F  S SRSREC=$O(^SRF(DA(1),50,SRSREC)) Q:'SRSREC  D
"RTN","SROANEST",75,0)
 .S:'$D(SRCST) SRCST=$$GET1^DIQ(130.213,SRSREC_","_DA(1)_",",.01,"I")
"RTN","SROANEST",76,0)
 .S SRCET=$$GET1^DIQ(130.213,SRSREC_","_DA(1)_",",1,"I")
"RTN","SROANEST",77,0)
 S SRTIME(130,DA(1)_",",.24)=SRCET,SRTIME(130,DA(1)_",",.21)=SRCST D FILE^DIE("","SRTIME","^TMP(""SR"",$J)")
"RTN","SROANEST",78,0)
 Q
"RTN","SROANEST",79,0)
DEL ; called by kill xref of mult anes start and end times
"RTN","SROANEST",80,0)
 I '$D(DA(2)) Q
"RTN","SROANEST",81,0)
 I (DA(2)=1),(D=.01) S SRFDA(130,DA(1)_",",.21)="@" D FILE^DIE("","SRFDA","^TMP(""SR"",$J)") K SRFDA
"RTN","SROANEST",82,0)
 I $O(^SRF(DA(1),50,DA(2)))="B" S SRFDA(130,DA(1)_",",.24)="@",SRFDA(130,DA(1)_",",.214)="@" D FILE^DIE("","SRFDA","^TMP(""SR"",$J)") K SRFDA
"RTN","SROANEST",83,0)
 Q
"RTN","SROANEST",84,0)
HELP ;
"RTN","SROANEST",85,0)
 W !,"Enter ""Y"" only if the block of time entered is the final block of time for"
"RTN","SROANEST",86,0)
 W !,"this case.  If the block of time is not the final block, enter ""N""."
"RTN","SROANEST",87,0)
 Q
"RTN","SROANEST",88,0)
BILLTIME() ;  calculate total minutes for mult anes start and end times
"RTN","SROANEST",89,0)
 N SRSREC,SRCST,SRCET,SRTTIME
"RTN","SROANEST",90,0)
 S SRSREC=0,SRTTIME=0
"RTN","SROANEST",91,0)
 I $$GET1^DIQ(130,D0,.214,"I")'=1 Q SRTTIME
"RTN","SROANEST",92,0)
 I '$D(^SRF(D0,50)) Q SRTTIME
"RTN","SROANEST",93,0)
 F  S SRSREC=$O(^SRF(D0,50,SRSREC)) Q:'SRSREC  D
"RTN","SROANEST",94,0)
 .S SRCST=$$GET1^DIQ(130.213,SRSREC_","_D0_",",.01,"I"),SRCET=$$GET1^DIQ(130.213,SRSREC_","_D0_",",1,"I")
"RTN","SROANEST",95,0)
 .D CALC
"RTN","SROANEST",96,0)
 Q SRTTIME
"RTN","SROANEST",97,0)
CALC ; calculate minutes between start and end times
"RTN","SROANEST",98,0)
 N SRETH,SRDHRS,SRSHR,SREHR,SRSMN,SREMN,SRSTH,X1,X2,Y,%H
"RTN","SROANEST",99,0)
 S X1=SRCST,X2=0 D C^%DTC S SRSTH=%H
"RTN","SROANEST",100,0)
 S X1=SRCET,X2=0 D C^%DTC S SRETH=%H
"RTN","SROANEST",101,0)
 S SRDHRS=(SRETH-SRSTH)*24
"RTN","SROANEST",102,0)
 S SRSHR=$E(($P(SRCST_"0",".",2)),1,2)
"RTN","SROANEST",103,0)
 S SREHR=$E(($P(SRCET_"0",".",2)),1,2)
"RTN","SROANEST",104,0)
 I SREHR<SRSHR S SREHR=SREHR+24,SRDHRS=SRDHRS-24
"RTN","SROANEST",105,0)
 S SRSMN=$E(($P(SRCST_"00",".",2)),3,4)
"RTN","SROANEST",106,0)
 S SREMN=$E(($P(SRCET_"00",".",2)),3,4)
"RTN","SROANEST",107,0)
 I SREMN<SRSMN S SREMN=SREMN+60,SREHR=SREHR-1
"RTN","SROANEST",108,0)
 S Y=(SRDHRS*60)+((SREHR-SRSHR)*60)+(SREMN-SRSMN)
"RTN","SROANEST",109,0)
 S SRTTIME=SRTTIME+Y
"RTN","SROANEST",110,0)
 Q
"RTN","SROANEST",111,0)
ANESTIME(SRDFN,SRFDATE,SRTDATE) ; API to return multiple anesthesia records and times
"RTN","SROANEST",112,0)
 N SRCASE,SRREC,SRCNT,SRNON,SRX,SRDATE,SRRES,SRSC,SRCV,SRQO,SRIR,SREC,SRMST,SRHNC,SRAO,SRSREC,SRCST,SRCET,SRTTIME,SR,SRDIAG
"RTN","SROANEST",113,0)
 S (SRREC,SRCNT,SRRES)=0
"RTN","SROANEST",114,0)
 I '$D(SRDFN)!'$D(SRFDATE) Q -1
"RTN","SROANEST",115,0)
 I '$D(SRTDATE) S SRTDATE=SRFDATE
"RTN","SROANEST",116,0)
 I '$D(^SRF("B",SRDFN)) Q 0
"RTN","SROANEST",117,0)
 S SRFDATE=$P(SRFDATE,"."),SRTDATE=$P(SRTDATE,".")
"RTN","SROANEST",118,0)
 F  S SRREC=$O(^SRF("B",SRDFN,SRREC)) Q:'SRREC  S SRCNT=SRCNT+1,SRCASE(SRCNT)=SRREC
"RTN","SROANEST",119,0)
 S SRREC=0
"RTN","SROANEST",120,0)
 F  S SRREC=$O(SRCASE(SRREC)) Q:'SRREC  D
"RTN","SROANEST",121,0)
 .S SRCASE=SRCASE(SRREC)
"RTN","SROANEST",122,0)
 .S SRNON=$S($P($G(^SRF(SRCASE,"NON")),"^")="Y":1,1:0)
"RTN","SROANEST",123,0)
 .I 'SRNON S SRX=$G(^SRF(SRCASE,.2)),SRDATE=$P(SRX,"^",10)
"RTN","SROANEST",124,0)
 .I SRNON S SRX=$G(^SRF(SRCASE,"NON")),SRDATE=$P(SRX,"^",4)
"RTN","SROANEST",125,0)
 .S SRDATE=$P(SRDATE,".")
"RTN","SROANEST",126,0)
 .I (SRDATE<SRFDATE)!(SRDATE>SRTDATE) K SRCASE(SRREC) Q
"RTN","SROANEST",127,0)
 S SRREC=0
"RTN","SROANEST",128,0)
 F  S SRREC=$O(SRCASE(SRREC)) Q:'SRREC  D
"RTN","SROANEST",129,0)
 .S SRCASE=SRCASE(SRREC)
"RTN","SROANEST",130,0)
 .I $$GET1^DIQ(130,SRCASE,.214,"I")'=1 S SRRES=-2 Q
"RTN","SROANEST",131,0)
 .S SRDIAG=$P($G(^SRF(SRCASE,34)),"^",2)
"RTN","SROANEST",132,0)
 .S (SRAO,SREC,SRHNC,SRIR,SRMST)=0
"RTN","SROANEST",133,0)
 .S SR(0)=$G(^SRF(SRCASE,0))
"RTN","SROANEST",134,0)
 .S SRSC=$P(SR(0),"^",16),SRAO=$P(SR(0),"^",17),SRIR=$P(SR(0),"^",18),SREC=$P(SR(0),"^",19),SRMST=$P(SR(0),"^",22),SRHNC=$P(SR(0),"^",23),SRCV=$P(SR(0),"^",24)
"RTN","SROANEST",135,0)
 .I '$D(^SRF(SRCASE,50)) S:SRRES'=1 SRRES=-2 Q
"RTN","SROANEST",136,0)
 .S SRRES=1,SRREC=0
"RTN","SROANEST",137,0)
 .F  S SRREC=$O(^SRF(SRCASE,50,SRREC)) Q:(SRREC="B")!(SRREC="")  D
"RTN","SROANEST",138,0)
 ..S SRCST=$$GET1^DIQ(130.213,SRREC_","_SRCASE_",",.01,"I"),SRCET=$$GET1^DIQ(130.213,SRREC_","_SRCASE_",",1,"I")
"RTN","SROANEST",139,0)
 ..I 'SRCET K ^TMP("SRANES",$J,SRCASE) S SRRES=-2,SRREC="" Q
"RTN","SROANEST",140,0)
 ..S SRTTIME=0 D CALC
"RTN","SROANEST",141,0)
 ..S ^TMP("SRANES",$J,SRCASE,SRCST,SRCET)=SRDFN_"^"_SRTTIME_"^"_SRDIAG_"^"_SRSC_"^"_SRCV_"^"_SRAO_"^"_SRIR_"^"_SREC_"^"_SRMST_"^"_SRHNC
"RTN","SROANEST",142,0)
 Q SRRES
"RTN","SROCON")
0^1^B9792980
"RTN","SROCON",1,0)
SROCON ;B'HAM ISC/MAM - STUFF ENTRY IN CONCURRENT CASE ;23 AUG 1990  9:15 AM
"RTN","SROCON",2,0)
 ;;3.0;Surgery;**78,119**;24 Jun 93
"RTN","SROCON",3,0)
 I $D(SRNOCON),SRNOCON=1 Q
"RTN","SROCON",4,0)
 I $D(SRFLAG) S SRCON=$P(^SRF(DA(1),"CON"),"^")
"RTN","SROCON",5,0)
 I '$D(SRFLAG) S SRCON=$P(^SRF(DA,"CON"),"^")
"RTN","SROCON",6,0)
ASK W !!,"Do you want to store this information in the concurrent case ?  YES//  " R SRYN:DTIME I '$T!(SRYN["^") S SRYN="N" Q
"RTN","SROCON",7,0)
 S:SRYN="" SRYN="Y" S SRYN=$E(SRYN) I "YyNn"'[SRYN D HELP G ASK
"RTN","SROCON",8,0)
 I "Yy"'[SRYN W ! Q
"RTN","SROCON",9,0)
STUFF ; concatonate field to SRODR
"RTN","SROCON",10,0)
 W ! I $G(SRFLAG)=1 S SRODR(130.213,DA(2)_","_SRCON_",",SRFLD)=X K SRFLAG Q
"RTN","SROCON",11,0)
 S SRODR(130,SRCON_",",SRFLD)=X
"RTN","SROCON",12,0)
 Q
"RTN","SROCON",13,0)
HELP ;
"RTN","SROCON",14,0)
 S SRMX=X W @IOF S DFN=$P(^SRF(DA,0),"^") D DEM^VADPT S X=SRMX
"RTN","SROCON",15,0)
 W !!,"There is a concurrent surgical case associated with this procedure.  A brief",!,"description of that case is listed below."
"RTN","SROCON",16,0)
 S SROPER=$P(^SRF(SRCON,"OP"),"^") I $O(^SRF(SRCON,13,0)) S SROTHER=0 F I=0:0 S SROTHER=$O(^SRF(SRCON,13,SROTHER)) Q:'SROTHER  D OTHER
"RTN","SROCON",17,0)
 K SROPS,MM,MMM S:$L(SROPER)<65 SROPS(1)=SROPER I $L(SROPER)>64 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROCON",18,0)
 S SRSUR=$S($D(^SRF(SRCON,.1)):$P(^(.1),"^",4),1:"") S:'SRSUR SRSUR="NOT ENTERED" S:SRSUR SRSUR=$P(^VA(200,SRSUR,0),"^")
"RTN","SROCON",19,0)
 S SRSS=$P(^SRF(SRCON,0),"^",4) S:'SRSS SRSS="NOT ENTERED" S:SRSS SRSS=$P(^SRO(137.45,SRSS,0),"^")
"RTN","SROCON",20,0)
 W !!,"Surgeon: "_SRSUR,!,"Surgical Specialty: "_SRSS,!!,"Procedure: ",?12,SROPS(1) I $D(SROPS(2)) W !,?12,SROPS(2) I $D(SROPS(3)) W !,?12,SROPS(3) I $D(SROPS(4)) W !,?12,SROPS(4)
"RTN","SROCON",21,0)
 W !!,"If you answer 'YES', the information you entered for this field will also",!,"be stored for the concurrent case.  If this information is not pertinent for",!,"the concurrent case, enter 'NO'.",!!
"RTN","SROCON",22,0)
 Q
"RTN","SROCON",23,0)
OTHER ; other operations
"RTN","SROCON",24,0)
 S SRLONG=1 I $L(SROPER)+$L($P(^SRF(SRCON,13,SROTHER,0),"^"))>235 S SRLONG=0,SROTHER=999,SROPERS=" ..."
"RTN","SROCON",25,0)
 I SRLONG S SROPERS=$P(^SRF(SRCON,13,SROTHER,0),"^")
"RTN","SROCON",26,0)
 S SROPER=SROPER_$S(SROPERS=" ...":SROPERS,1:", "_SROPERS)
"RTN","SROCON",27,0)
 Q
"RTN","SROCON",28,0)
LOOP ; break procedure
"RTN","SROCON",29,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<65  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROCON",30,0)
 Q
"RTN","SROCON1")
0^2^B2288672
"RTN","SROCON1",1,0)
SROCON1 ;B'HAM ISC/MAM - MULTIPLES (.01) & CONCURRENTS ;16 AUG 1990  1:30 PM
"RTN","SROCON1",2,0)
 ;;3.0;Surgery;**78,107,119**;24 Jun 93
"RTN","SROCON1",3,0)
 ;
"RTN","SROCON1",4,0)
 ; Reference to ^TMP("CSLSUR1" supported by DBIA #3498
"RTN","SROCON1",5,0)
 ;
"RTN","SROCON1",6,0)
 W !!,"The information to be duplicated in the concurrent case will now be entered....",!!
"RTN","SROCON1",7,0)
EN ;
"RTN","SROCON1",8,0)
 I $D(SRODR("130.213"))  D
"RTN","SROCON1",9,0)
   . S SRCTMP="",SRCNTR=0
"RTN","SROCON1",10,0)
   . F  S SRCTMP=$O(SRODR("130.213",SRCTMP)) Q:SRCTMP=""  D
"RTN","SROCON1",11,0)
   . . I '$D(^SRF(SRCON,50,$P(SRCTMP,","))) S SRCNTR=SRCNTR+1 K SRODR1 S SRODR1("130.213","+"_SRCNTR_","_SRCON_",",".01")="0" D UPDATE^DIE("","SRODR1","^TMP(""SR"",$J)")
"RTN","SROCON1",12,0)
   . K SRCTMP,SRODR1,SRCNTR Q
"RTN","SROCON1",13,0)
 I $D(SRODR) D FILE^DIE("","SRODR","^TMP(""SR"",$J)") D
"RTN","SROCON1",14,0)
 .N SROERR S SROERR=SRCON I $D(^TMP("CSLSUR1",$J)) D ^SROERR0 S ^TMP("CSLSUR1",$J)=""
"RTN","SROCON1",15,0)
 K DIR S DIR("A")="Press RETURN to continue  ",DIR(0)="FOA" D ^DIR K DIR
"RTN","SROCON1",16,0)
 Q
"RTN","SROPCE")
0^13^B75482609
"RTN","SROPCE",1,0)
SROPCE ;BIR/ADM - PCE updates ;[ 10/17/01  9:28 AM ]
"RTN","SROPCE",2,0)
 ;;3.0;Surgery;**58,62,69,88,105,119**;24 Jun 93
"RTN","SROPCE",3,0)
 ;
"RTN","SROPCE",4,0)
 ; Reference to $$DATA2PCE^PXAPI supported by DBIA #1889
"RTN","SROPCE",5,0)
 ; Reference to $$DELVFILE^PXAPI supported by DBIA #1890
"RTN","SROPCE",6,0)
 ;
"RTN","SROPCE",7,0)
 Q
"RTN","SROPCE",8,0)
NITE ; entry for nightly update of PCE with surgery & non-OR procedure data
"RTN","SROPCE",9,0)
 N DFN,SR,SRAO,SRATT,SRCHK,SRCPT,SRDATE,SRDIAG,SRDXN,SREC,SRHNC,SRIR,SRCV,SRK,SRLOC,SRMST,SRNAR,SRNON,SROTH,SRPKG,SRPROV,SRS,SRSC,SRTN,SRV,SRVSIT,SRX
"RTN","SROPCE",10,0)
 N SRPLSC,SRPLAO,SRPLIR,SRPLEC,SRPLMST,SRPLHNC,SRPLCV,SRADX,SRADX1,SRCNT,SRD,SRDX,SRRPROV,SRUP,SRINOUT,SRODIAG,SRDXF
"RTN","SROPCE",11,0)
 K DIC S DIC=9.4,DIC(0)="XM",X="SURGERY" D ^DIC K DIC Q:Y=-1  S SRPKG=+Y
"RTN","SROPCE",12,0)
 S SRS="SURGERY DATA",SRFILE=0 K ^TMP("SRPXAPI",$J)
"RTN","SROPCE",13,0)
 S SRTN=0 F  S SRTN=$O(^SRF("APCE",SRTN)) Q:'SRTN  D UTIL K:SRK ^SRF("APCE",SRTN) I 'SRK D PCE
"RTN","SROPCE",14,0)
 Q
"RTN","SROPCE",15,0)
DEL ; delete data from the Visit file and V files
"RTN","SROPCE",16,0)
 K DA,DIE,DR S DA=SRTN,DIE=130,DR=".015///@" D ^DIE K DA,DIE,DR
"RTN","SROPCE",17,0)
 S SRV=$$DELVFILE^PXAPI("ALL",SRVSIT) K SRVSIT
"RTN","SROPCE",18,0)
 Q
"RTN","SROPCE",19,0)
UTIL ; set procedure variables
"RTN","SROPCE",20,0)
 N SRDIV,SRSITE,SRSR
"RTN","SROPCE",21,0)
 S SRSR="",SRK=0,SRDIV=$P($G(^SRF(SRTN,8)),"^") I SRDIV S SRSITE=$O(^SRO(133,"B",SRDIV,0)),X=^SRO(133,SRSITE,0),SRUP=$P(X,"^",15),SRSR=$P(X,"^",19) I SRUP=""!(SRUP="N") S SRK=1 Q
"RTN","SROPCE",22,0)
 I 'SRFILE S SRX=$G(^SRF("APCE",SRTN)) I SRX S SRVSIT=SRX D DEL I '$D(^SRF(SRTN,0)) S SRK=1 Q
"RTN","SROPCE",23,0)
 S SR(0)=$G(^SRF(SRTN,0)) I SR(0)=""!$P($G(^SRF(SRTN,30)),"^") S SRK=1 Q
"RTN","SROPCE",24,0)
 S DFN=$P(SR(0),"^")
"RTN","SROPCE",25,0)
 S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0),SRCPT=$P(^SRF(SRTN,"OP"),"^",2) I 'SRCPT S SRK=1 Q
"RTN","SROPCE",26,0)
 S SRX=0 F  S SRX=$O(^SRF(SRTN,13,SRX)) Q:'SRX  I '$P($G(^SRF(SRTN,13,SRX,2)),"^") S SRK=1 Q
"RTN","SROPCE",27,0)
 Q:SRK  S SRDIAG=$P($G(^SRF(SRTN,34)),"^",2) I 'SRDIAG S SRK=1 Q
"RTN","SROPCE",28,0)
 S SRODIAG=$P($G(^SRF(SRTN,34)),"^",3)
"RTN","SROPCE",29,0)
 S SRDXF=$S(SRODIAG=SRDIAG:1,1:0)
"RTN","SROPCE",30,0)
 I 'SRNON D  I SRK Q
"RTN","SROPCE",31,0)
 .S SRX=$P(SR(0),"^",21) I SRX S SRLOC=SRX
"RTN","SROPCE",32,0)
 .I 'SRX S SRX=$P(^SRO(137.45,$P(SR(0),"^",4),0),"^",5) I SRX S SRLOC=SRX
"RTN","SROPCE",33,0)
 .I 'SRX S SRX=$P(SR(0),"^",2) S:SRX SRLOC=$P(^SRS(SRX,0),"^") I 'SRX S SRK=1 Q
"RTN","SROPCE",34,0)
 .S SRX=$G(^SRF(SRTN,.2)),SRCHK=$P(SRX,"^",12) I 'SRCHK S SRK=1 Q
"RTN","SROPCE",35,0)
 .S SRDATE=$P(SRX,"^",10) I 'SRDATE S SRK=1 Q
"RTN","SROPCE",36,0)
 .S SRX=$G(^SRF(SRTN,.1)),SRPROV=$P(SRX,"^",4),SRATT=$P(SRX,"^",13) I 'SRPROV S SRK=1 Q
"RTN","SROPCE",37,0)
 .I SRSR'=0,'SRATT S SRK=1 Q
"RTN","SROPCE",38,0)
 I SRNON D  I SRK Q
"RTN","SROPCE",39,0)
 .S SRLOC=$P(SR(0),"^",21)
"RTN","SROPCE",40,0)
 .S SRX=^SRF(SRTN,"NON"),SRCHK=$P(SRX,"^",5) I 'SRCHK S SRK=1 Q
"RTN","SROPCE",41,0)
 .S SRDATE=$P(SRX,"^",4) I 'SRDATE S SRK=1 Q
"RTN","SROPCE",42,0)
 .I 'SRLOC S SRLOC=$P(SRX,"^",2) I 'SRLOC S SRK=1 Q
"RTN","SROPCE",43,0)
 .S SRPROV=$P(SRX,"^",6),SRATT=$P(SRX,"^",7) I 'SRPROV S SRK=1
"RTN","SROPCE",44,0)
 .I SRSR'=0,'SRATT S SRK=1
"RTN","SROPCE",45,0)
 S VAINDT=SRDATE
"RTN","SROPCE",46,0)
 D INP^VADPT
"RTN","SROPCE",47,0)
 I VAIN(1) S SRINOUT="I"
"RTN","SROPCE",48,0)
 I 'VAIN(1) S SRINOUT="O"
"RTN","SROPCE",49,0)
 K VAINDT,VAIN
"RTN","SROPCE",50,0)
 I '$$CLINIC^SROUTL(SRLOC,SRTN) S SRK=1 Q
"RTN","SROPCE",51,0)
 S SRX=0,SRX=$O(^SRF(SRTN,"PADX",SRX)) I SRX="" S SRK=1 Q
"RTN","SROPCE",52,0)
 S SRX=0 F  S SRX=$O(^SRF(SRTN,13,SRX)) Q:'SRX  I $D(^SRF(SRTN,13,SRX)),'$D(^SRF(SRTN,13,SRX,"OADX")) S SRK=1  Q:SRK
"RTN","SROPCE",53,0)
 S SRX=0 F  S SRX=$O(^SRF(SRTN,15,SRX)) Q:'SRX  I '$P($G(^SRF(SRTN,15,SRX,0)),"^",3) S SRK=1  Q:SRK
"RTN","SROPCE",54,0)
 S SRRPROV="" I $D(^SRF(SRTN,18)) S SRX=0,SRX=$O(^SRF(SRTN,18,SRX)) I SRX S SRRPROV=$P($G(^SRF(SRTN,18,SRX,0)),"^",7)
"RTN","SROPCE",55,0)
 S (SRSC,SRAO,SREC,SRHNC,SRIR,SRMST,SRCV)=0,SRSC=$P(SR(0),"^",16),SRAO=$P(SR(0),"^",17),SRIR=$P(SR(0),"^",18),SREC=$P(SR(0),"^",19),SRMST=$P(SR(0),"^",22),SRHNC=$P(SR(0),"^",23),SRCV=$P(SR(0),"^",24)
"RTN","SROPCE",56,0)
 Q
"RTN","SROPCE",57,0)
PCE ; set up call to PCE
"RTN","SROPCE",58,0)
 N SRI,SRJ,SRCODE,SROTH D TMP
"RTN","SROPCE",59,0)
D2PCE S SRV=$$DATA2PCE^PXAPI("^TMP(""SRPXAPI"",$J)",SRPKG,SRS,.SRVSIT) I SRVSIT K DA,DIE,DR S DA=SRTN,DIE=130,DR=".015////"_SRVSIT D ^DIE K DA,DIE,DR,^SRF("APCE",SRTN)
"RTN","SROPCE",60,0)
 K ^TMP("SRPXAPI",$J),SRVSIT
"RTN","SROPCE",61,0)
 Q
"RTN","SROPCE",62,0)
TMP ; set up ^TMP global array
"RTN","SROPCE",63,0)
ENC S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"ENC D/T")=SRDATE
"RTN","SROPCE",64,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"PATIENT")=DFN
"RTN","SROPCE",65,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"HOS LOC")=SRLOC
"RTN","SROPCE",66,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"CHECKOUT D/T")=SRCHK
"RTN","SROPCE",67,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"SERVICE CATEGORY")="S"
"RTN","SROPCE",68,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","SROPCE",69,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"APPT")=9
"RTN","SROPCE",70,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"SC")=SRSC
"RTN","SROPCE",71,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"AO")=SRAO
"RTN","SROPCE",72,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"IR")=SRIR
"RTN","SROPCE",73,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"EC")=SREC
"RTN","SROPCE",74,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"MST")=SRMST
"RTN","SROPCE",75,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"HNC")=SRHNC
"RTN","SROPCE",76,0)
 S ^TMP("SRPXAPI",$J,"ENCOUNTER",1,"CV")=SRCV
"RTN","SROPCE",77,0)
PROC S SRI=1,SRCODE=SRCPT,SRNAR=$P(^SRF(SRTN,"OP"),"^") D PMOD,CPT
"RTN","SROPCE",78,0)
 S SROTH=0 F  S SROTH=$O(^SRF(SRTN,13,SROTH)) Q:'SROTH  I $P(^SRF(SRTN,13,SROTH,0),"^",3)'="N" S SRCODE=$P($G(^SRF(SRTN,13,SROTH,2)),"^") I SRCODE S SRNAR=$P(^SRF(SRTN,13,SROTH,0),"^"),SRI=SRI+1 D OMOD,CPT
"RTN","SROPCE",79,0)
PROV S ^TMP("SRPXAPI",$J,"PROVIDER",1,"NAME")=SRPROV
"RTN","SROPCE",80,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",1,"PRIMARY")=1
"RTN","SROPCE",81,0)
 I 'SRNON S ^TMP("SRPXAPI",$J,"PROVIDER",1,"COMMENT")="Surgeon"
"RTN","SROPCE",82,0)
 I SRPROV=SRATT!'SRATT S ^TMP("SRPXAPI",$J,"PROVIDER",1,"ATTENDING")=1 G DIAG
"RTN","SROPCE",83,0)
 I 'SRATT G DIAG
"RTN","SROPCE",84,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"NAME")=SRATT
"RTN","SROPCE",85,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"ATTENDING")=1
"RTN","SROPCE",86,0)
 S ^TMP("SRPXAPI",$J,"PROVIDER",2,"PRIMARY")=0
"RTN","SROPCE",87,0)
 I 'SRNON S ^TMP("SRPXAPI",$J,"PROVIDER",2,"COMMENT")="Attending Surgeon"
"RTN","SROPCE",88,0)
DIAG S SRI=1,SRDX=SRDIAG,SRDXN=$S(SRNON:$P($G(^SRF(SRTN,33)),"^",2),1:$P($G(^SRF(SRTN,34)),"^")) D DX
"RTN","SROPCE",89,0)
 S SRD=0 F  S SRD=$O(^SRF(SRTN,15,SRD)) Q:'SRD  S SRDX=$P(^SRF(SRTN,15,SRD,0),"^",3) I SRDX S SRDXN=$P(^SRF(SRTN,15,SRD,0),"^") D DX
"RTN","SROPCE",90,0)
 I 'SRDXF,SRODIAG D
"RTN","SROPCE",91,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"DIAGNOSIS")=SRODIAG
"RTN","SROPCE",92,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"ORD/RES")="O"
"RTN","SROPCE",93,0)
 .S SRDXN=$P($G(^SRF(SRTN,33)),"^")
"RTN","SROPCE",94,0)
 .I SRDXN'="" S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"NARRATIVE")=SRDXN
"RTN","SROPCE",95,0)
 Q
"RTN","SROPCE",96,0)
DX S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"DIAGNOSIS")=SRDX
"RTN","SROPCE",97,0)
 I SRI=1 D
"RTN","SROPCE",98,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PRIMARY")=1
"RTN","SROPCE",99,0)
 .I SRDXF S ^TMP("SRPXAPI",$J,"DX/PL",1,"ORD/RES")="OR"
"RTN","SROPCE",100,0)
 .I 'SRDXF S ^TMP("SRPXAPI",$J,"DX/PL",1,"ORD/RES")="R"
"RTN","SROPCE",101,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL SC")=SRSC
"RTN","SROPCE",102,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL AO")=SRAO
"RTN","SROPCE",103,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL IR")=SRIR
"RTN","SROPCE",104,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL EC")=SREC
"RTN","SROPCE",105,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL MST")=SRMST
"RTN","SROPCE",106,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL HNC")=SRHNC
"RTN","SROPCE",107,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",1,"PL CV")=SRCV
"RTN","SROPCE",108,0)
 I SRI'=1 D
"RTN","SROPCE",109,0)
 .S SR(15)=$G(^SRF(SRTN,15,SRD,2))
"RTN","SROPCE",110,0)
 .S (SRPLSC,SRPLAO,SRPLIR,SRPLEC,SRPLMST,SRPLHNC,SRPLCV)=0,SRPLSC=$P(SR(15),"^",1),SRPLAO=$P(SR(15),"^",2),SRPLIR=$P(SR(15),"^",3),SRPLMST=$P(SR(15),"^",4),SRPLHNC=$P(SR(15),"^",5),SRPLEC=$P(SR(15),"^",6),SRPLCV=$P(SR(15),"^",7)
"RTN","SROPCE",111,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"ORD/RES")="R"
"RTN","SROPCE",112,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL SC")=SRPLSC
"RTN","SROPCE",113,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL AO")=SRPLAO
"RTN","SROPCE",114,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL IR")=SRPLIR
"RTN","SROPCE",115,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL EC")=SRPLEC
"RTN","SROPCE",116,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL MST")=SRPLMST
"RTN","SROPCE",117,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL HNC")=SRPLHNC
"RTN","SROPCE",118,0)
 .S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"PL CV")=SRPLCV
"RTN","SROPCE",119,0)
 I SRDXN'="" S ^TMP("SRPXAPI",$J,"DX/PL",SRI,"NARRATIVE")=SRDXN
"RTN","SROPCE",120,0)
 S SRI=SRI+1
"RTN","SROPCE",121,0)
 Q
"RTN","SROPCE",122,0)
CPT S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"ENC PROVIDER")=SRPROV
"RTN","SROPCE",123,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"ORD PROVIDER")=SRRPROV
"RTN","SROPCE",124,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"EVENT D/T")=SRDATE
"RTN","SROPCE",125,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"PROCEDURE")=SRCODE
"RTN","SROPCE",126,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"NARRATIVE")=SRNAR
"RTN","SROPCE",127,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"QTY")=1
"RTN","SROPCE",128,0)
 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"COMMENT")=$S(SRI=1:"Principal Procedure",1:"Other Procedure")
"RTN","SROPCE",129,0)
 I SRI=1 D
"RTN","SROPCE",130,0)
 .S SRCNT=1,SRX=0 F  S SRX=$O(^SRF(SRTN,"PADX",SRX)) Q:'SRX  D
"RTN","SROPCE",131,0)
 ..S SRADX1=$P(^SRF(SRTN,"PADX",SRX,0),"^",1)
"RTN","SROPCE",132,0)
 ..I SRADX1=0 S SRADX=SRDIAG  ; 0 IS A FLAG USED TO INDICATE DX IS PRIMARY DX AND NOT OTHER DX
"RTN","SROPCE",133,0)
 ..I SRADX1'=0 S SRADX=$P(^SRF(SRTN,15,SRADX1,0),"^",3)
"RTN","SROPCE",134,0)
 ..I SRCNT=1 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS")=SRADX
"RTN","SROPCE",135,0)
 ..I SRCNT=2 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 2")=SRADX
"RTN","SROPCE",136,0)
 ..I SRCNT=3 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 3")=SRADX
"RTN","SROPCE",137,0)
 ..I SRCNT=4 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 4")=SRADX
"RTN","SROPCE",138,0)
 ..I SRCNT=5 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 5")=SRADX
"RTN","SROPCE",139,0)
 ..I SRCNT=6 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 6")=SRADX
"RTN","SROPCE",140,0)
 ..I SRCNT=7 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 7")=SRADX
"RTN","SROPCE",141,0)
 ..I SRCNT=8 S ^TMP("SRPXAPI",$J,"PROCEDURE",1,"DIAGNOSIS 8")=SRADX
"RTN","SROPCE",142,0)
 ..S SRCNT=SRCNT+1
"RTN","SROPCE",143,0)
 I SRI'=1 D
"RTN","SROPCE",144,0)
 .S SRCNT=1,SRX=0 F  S SRX=$O(^SRF(SRTN,13,SROTH,"OADX",SRX)) Q:'SRX  D
"RTN","SROPCE",145,0)
 ..S SRADX1=$P(^SRF(SRTN,13,SROTH,"OADX",SRX,0),"^",1)
"RTN","SROPCE",146,0)
 ..I SRADX1=0 S SRADX=SRDIAG  ; 0 IS A FLAG USED TO INDICATE DX IS PRIMARY DX AND NOT OTHER DX
"RTN","SROPCE",147,0)
 ..I SRADX1'=0 S SRADX=$P(^SRF(SRTN,15,SRADX1,0),"^",3)
"RTN","SROPCE",148,0)
 ..I SRCNT=1 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS")=SRADX
"RTN","SROPCE",149,0)
 ..I SRCNT=2 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 2")=SRADX
"RTN","SROPCE",150,0)
 ..I SRCNT=3 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 3")=SRADX
"RTN","SROPCE",151,0)
 ..I SRCNT=4 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 4")=SRADX
"RTN","SROPCE",152,0)
 ..I SRCNT=5 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 5")=SRADX
"RTN","SROPCE",153,0)
 ..I SRCNT=6 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 6")=SRADX
"RTN","SROPCE",154,0)
 ..I SRCNT=7 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 7")=SRADX
"RTN","SROPCE",155,0)
 ..I SRCNT=8 S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"DIAGNOSIS 8")=SRADX
"RTN","SROPCE",156,0)
 ..S SRCNT=SRCNT+1
"RTN","SROPCE",157,0)
 Q
"RTN","SROPCE",158,0)
PMOD ; get modifiers for principal CPT code
"RTN","SROPCE",159,0)
 N SRM,SRMOD,X
"RTN","SROPCE",160,0)
 S SRM=0 F  S SRM=$O(^SRF(SRTN,"OPMOD",SRM)) Q:'SRM  S X=$P(^SRF(SRTN,"OPMOD",SRM,0),"^"),SRMOD=$P($$MOD^ICPTMOD(X,"I"),"^",2),^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS",SRMOD)=""
"RTN","SROPCE",161,0)
 S SRMOD="" I $O(^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS",SRMOD))'="" S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS")=""
"RTN","SROPCE",162,0)
 Q
"RTN","SROPCE",163,0)
OMOD ; get modifiers for other CPT codes
"RTN","SROPCE",164,0)
 N SRM,SRMOD,X
"RTN","SROPCE",165,0)
 S SRM=0 F  S SRM=$O(^SRF(SRTN,13,SROTH,"MOD",SRM)) Q:'SRM  S X=$P(^SRF(SRTN,13,SROTH,"MOD",SRM,0),"^"),SRMOD=$P($$MOD^ICPTMOD(X,"I"),"^",2),^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS",SRMOD)=""
"RTN","SROPCE",166,0)
 S SRMOD="" I $O(^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS",SRMOD))'="" S ^TMP("SRPXAPI",$J,"PROCEDURE",SRI,"MODIFIERS")=""
"RTN","SROPCE",167,0)
 Q
"RTN","SROPCE0")
0^18^B31414628
"RTN","SROPCE0",1,0)
SROPCE0 ;BIR/ADM-PCE Filing Status Report ;[ 09/22/98  11:39 AM ]
"RTN","SROPCE0",2,0)
 ;;3.0;Surgery;**58,62,69,77,50,119**;24 Jun 93
"RTN","SROPCE0",3,0)
 W @IOF,!,?26,"Report of PCE Filing Status",!!,"This report displays the filing status of completed cases performed during the",!,"selected date range.",!
"RTN","SROPCE0",4,0)
 S (SRFLG,SRSOUT)=0,SRSPEC=""
"RTN","SROPCE0",5,0)
ASK W ! K DIR S DIR("A",1)="Print PCE filing status of completed cases for",DIR("A",2)="",DIR("A",3)="1. O.R. Surgical Procedures",DIR("A",4)="2. Non-O.R. Procedures"
"RTN","SROPCE0",6,0)
 S DIR("A",5)="3. Both O.R. Surgical Procedures and Non-O.R. Procedures (All Specialties)",DIR("A",6)="",DIR("A")="Select Number (1, 2 or 3): ",DIR("B")="1"
"RTN","SROPCE0",7,0)
 S DIR(0)="NA^1:3:0" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 G END
"RTN","SROPCE0",8,0)
 S SRFLG=Y I SRFLG=1 D SPEC G:SRSOUT END
"RTN","SROPCE0",9,0)
 I SRFLG=2 D MSP G:SRSOUT END
"RTN","SROPCE0",10,0)
DATE D DATE^SROUTL(.SDATE,.EDATE,.SRSOUT) G:SRSOUT END
"RTN","SROPCE0",11,0)
FORM W ! K DIR S DIR("A")="Print the long form or the short form ? ",DIR("B")="SHORT",DIR(0)="SAM^L:LONG;S:SHORT" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 G END
"RTN","SROPCE0",12,0)
 S SRFORM=Y I Y="L" W !!,"This report is designed to use a 132 column format."
"RTN","SROPCE0",13,0)
 W ! K %ZIS,IOP,IO("Q"),POP S %ZIS("A")="Print the PCE Filing Status Report to which Printer ? ",%ZIS="Q" D ^%ZIS I POP S SRSOUT=1 G END
"RTN","SROPCE0",14,0)
 I $D(IO("Q")) K IO("Q") S ZTDESC="PCE FILING STATUS REPORT",(ZTSAVE("EDATE"),ZTSAVE("SRFORM"),ZTSAVE("SDATE"),ZTSAVE("SRSITE*"),ZTSAVE("SRSPEC*"),ZTSAVE("SRFLG"))="",ZTRTN="EN^SROPCE0" D ^%ZTLOAD S SRSOUT=1 G END
"RTN","SROPCE0",15,0)
EN U IO S SRSOUT=0,(SRHDR,SRPAGE)=1,SRSDT=SDATE-.0001,SRSEDT=EDATE+.9999,Y=SDATE X ^DD("DD") S STARTDT=Y,Y=EDATE X ^DD("DD") S ENDATE=Y F I=1:1:6 S CNT(I)=0
"RTN","SROPCE0",16,0)
 S SRRPT="PCE FILING STATUS REPORT",SRTITLE="For Completed "_$S(SRFLG=1:"O.R. Surgical Procedures",SRFLG=2:"Non-O.R. Procedures",1:"O.R. Surgical and Non-O.R. Procedures"),SRFRTO="From: "_STARTDT_"  To: "_ENDATE
"RTN","SROPCE0",17,0)
 S SRINST=SRSITE("SITE") D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S SRPRINT="Report Printed: "_Y
"RTN","SROPCE0",18,0)
 I SRFORM="L" D ^SROPCE0A G END
"RTN","SROPCE0",19,0)
 D ^SROPCE0B
"RTN","SROPCE0",20,0)
END W:$E(IOST)="P" @IOF I $D(ZTQUEUED) Q:$G(ZTSTOP)  S ZTREQ="@" Q
"RTN","SROPCE0",21,0)
 I 'SRSOUT,$E(IOST)'="P" W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SROPCE0",22,0)
 D ^%ZISC K SRDIV,SRDX,SRFCPT,SRFICD,SRFRTO,SRINOUT,SRPARAM,SRPODX,SRQCPT,SRQICD,SRRPT,SRSCHED,SRSPS,SRSR,SRTN,SRUCPT,SRUICD D ^SRSKILL W @IOF
"RTN","SROPCE0",23,0)
 Q
"RTN","SROPCE0",24,0)
SPEC W @IOF,! S DIR("?",1)="Enter YES if you would like the report printed for all Surgical Specialties",DIR("?")="or enter NO to select a specific specialty."
"RTN","SROPCE0",25,0)
 S DIR("A")="Do you want the report for all Surgical Specialties ? ",DIR("B")="YES",DIR(0)="YA" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROPCE0",26,0)
 I 'Y W ! K DIC S DIC=137.45,DIC(0)="QEAMZ",DIC("A")="Select Surgical Specialty: ",DIC("S")="I '$P(^(0),""^"",3)" D ^DIC K DIC S:Y<0 SRSOUT=1 Q:Y<0  S SRSPEC=+Y,SRSPECN=$P(Y(0),"^")
"RTN","SROPCE0",27,0)
 Q
"RTN","SROPCE0",28,0)
MSP W @IOF,! S DIR("?",1)="Enter YES if you would like the report printed for all Medical Specialties",DIR("?")="or enter NO to select a specific specialty."
"RTN","SROPCE0",29,0)
 S DIR("A")="Do you want the report for all Medical Specialties ? ",DIR("B")="YES",DIR(0)="YA" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROPCE0",30,0)
 I 'Y W ! K DIC S DIC=723,DIC(0)="QEAMZ",DIC("A")="Select Medical Specialty: " D ^DIC K DIC S:Y<0 SRSOUT=1 Q:Y<0  S SRSPEC=+Y,SRSPECN=$P(Y(0),"^")
"RTN","SROPCE0",31,0)
 Q
"RTN","SROPCE0",32,0)
CHK ; set up array of fields missing data
"RTN","SROPCE0",33,0)
 K SRX,DA,DIC,DIQ,DR,SRY S DIC="^SRF(",DA=SRTN,DIQ="SRY",DIQ(0)="I" D  D EN^DIQ1
"RTN","SROPCE0",34,0)
 .I SRNON S DR="27;66;119;121;122;123;"_$S(SRSR'=0:"124;",1:"")_"125;"
"RTN","SROPCE0",35,0)
 .I 'SRNON S DR=".04;.14;"_$S(SRSR'=0:".164;",1:"")_".205;.232;27;66;"
"RTN","SROPCE0",36,0)
 .I $P(^SRO(133,SRSITE,0),"^",16) S DR=DR_".0155;"
"RTN","SROPCE0",37,0)
 .I SRSTATUS=5 S DR=DR_".011;"
"RTN","SROPCE0",38,0)
 D CLINIC
"RTN","SROPCE0",39,0)
 S SRZ=0 F  S SRZ=$O(SRY(130,SRTN,SRZ)) Q:'SRZ  I SRY(130,SRTN,SRZ,"I")="" D TR S X=$T(@SRP),SRFLD=$P(X,";;",2),SRX(SRZ)=$P(SRFLD,"^",2)
"RTN","SROPCE0",40,0)
OTH I $O(^SRF(SRTN,13,0)) S SROTH=0 F  S SROTH=$O(^SRF(SRTN,13,SROTH)) Q:'SROTH  I '$P($G(^SRF(SRTN,13,SROTH,2)),"^") S SRX(.42)="OTHER PROCEDURE CPT CODE" Q
"RTN","SROPCE0",41,0)
 I $O(^SRF(SRTN,15,0)) S SROTH=0 F  S SROTH=$O(^SRF(SRTN,15,SROTH)) Q:'SROTH  I '$P($G(^SRF(SRTN,15,SROTH,0)),"^",3) S SRX(.74)="OTHER POST-OP DIAGNOSIS ICD CODE" Q
"RTN","SROPCE0",42,0)
 S SROTH=0,SROTH=$O(^SRF(SRTN,"PADX",SROTH)) I SROTH="" S SRX(99998)="PRIN PROCEDURE CODE MISSING ASSOCIATED DIAGNOSIS CODE"
"RTN","SROPCE0",43,0)
 S SROTH=0 F  S SROTH=$O(^SRF(SRTN,13,SROTH)) Q:'SROTH  D
"RTN","SROPCE0",44,0)
 .I '$D(^SRF(SRTN,13,SROTH,"OADX")) S SRX(99999)="OTHER PROCEDURE CPT MISSING ASSOCIATED DIAGNOSIS ICD CODE" Q
"RTN","SROPCE0",45,0)
 .S SRZ=0 S SRZ=$O(^SRF(SRTN,13,SROTH,"OADX",SRZ)) I 'SRZ S SRX(99999)="OTHER PROCEDURE CPT MISSING ASSOCIATED DIAGNOSIS ICD CODE" Q
"RTN","SROPCE0",46,0)
 Q
"RTN","SROPCE0",47,0)
CLINIC N SRCLINIC S SRCLINIC=$P(^SRF(SRTN,0),"^",21) D
"RTN","SROPCE0",48,0)
 .I SRNON S:SRCLINIC="" SRCLINIC=$P(^SRF(SRTN,"NON"),"^",2) Q
"RTN","SROPCE0",49,0)
 .S:SRCLINIC="" SRCLINIC=$P(^SRO(137.45,$P(^SRF(SRTN,0),"^",4),0),"^",5) I SRCLINIC="",$P(^SRF(SRTN,0),"^",2) S SRCLINIC=$P(^SRS($P(^SRF(SRTN,0),"^",2),0),"^")
"RTN","SROPCE0",50,0)
 I SRCLINIC,'$$CLINIC^SROUTL(SRCLINIC,SRTN) S SRCLINIC=""
"RTN","SROPCE0",51,0)
 S SRY(130,SRTN,.021,"I")=SRCLINIC
"RTN","SROPCE0",52,0)
 Q
"RTN","SROPCE0",53,0)
TR S SRP=SRZ,SRP=$TR(SRP,"1234567890.","ABCDEFGHIJP")
"RTN","SROPCE0",54,0)
 Q
"RTN","SROPCE0",55,0)
PJAA ;;.011^IN/OUT-PATIENT STATUS
"RTN","SROPCE0",56,0)
PJAEE ;;.0155^CLASSIFICATION INFORMATION
"RTN","SROPCE0",57,0)
PJBA ;;.021^ASSOCIATED CLINIC
"RTN","SROPCE0",58,0)
PJD ;;.04^SURGERY SPECIALTY
"RTN","SROPCE0",59,0)
PAFD ;;.164^ATTEND SURG
"RTN","SROPCE0",60,0)
PBJE ;;.205^TIME PAT IN OR
"RTN","SROPCE0",61,0)
PBCB ;;.232^TIME PAT OUT OR
"RTN","SROPCE0",62,0)
BG ;;27^PRINCIPAL PROCEDURE CODE
"RTN","SROPCE0",63,0)
FF ;;66^PRIN DIAGNOSIS CODE
"RTN","SROPCE0",64,0)
AAI ;;119^NON-OR LOCATION
"RTN","SROPCE0",65,0)
ABA ;;121^TIME PROCEDURE BEGAN
"RTN","SROPCE0",66,0)
ABB ;;122^TIME PROCEDURE ENDED
"RTN","SROPCE0",67,0)
ABC ;;123^PROVIDER
"RTN","SROPCE0",68,0)
ABD ;;124^ATTEND PROVIDER
"RTN","SROPCE0",69,0)
ABE ;;125^MEDICAL SPECIALTY
"RTN","SROPCE1")
0^14^B37901378
"RTN","SROPCE1",1,0)
SROPCE1 ;BIR/ADM - Ask Classification Questions for PCE and Cross Reference Logic ;[ 11/26/01  6:48 AM ]
"RTN","SROPCE1",2,0)
 ;;3.0;Surgery;**58,105,119**;24 Jun 93
"RTN","SROPCE1",3,0)
 ;
"RTN","SROPCE1",4,0)
 ; Reference to CL^SDCO21 supported by DBIA #406
"RTN","SROPCE1",5,0)
 ; Reference to DIS^DGRPDB supported by DBIA #700
"RTN","SROPCE1",6,0)
 ; Reference to Field #.322013 in File #2 supported by DBIA #3475
"RTN","SROPCE1",7,0)
 ;
"RTN","SROPCE1",8,0)
EN1 I '$P(^SRO(133,SRSITE,0),"^",16) Q
"RTN","SROPCE1",9,0)
 N SRPDATE,SRSDATE S SRPDATE=$P(^SRO(133,SRSITE,0),"^",17),SRSDATE=$S($D(SRTN):$P(^SRF(SRTN,0),"^",9),$D(SRWLST):$P(^SRO(133.8,SRSS,1,SROFN,0),"^",5),1:DT) I SRPDATE,SRSDATE<SRPDATE Q
"RTN","SROPCE1",10,0)
 N SRAO,SRDR,SREC,SRELIG,SRIR,SRPERC,SRQ,SRSC,SRCL,SRX,VAEL,VASV,SRCV
"RTN","SROPCE1",11,0)
 S SRQ=0 D  I SRQ=1 Q
"RTN","SROPCE1",12,0)
 .I '$D(SRWLST) Q
"RTN","SROPCE1",13,0)
 .I $D(SRWLST),'$P(^SRO(133.8,SRSS,1,SROFN,0),"^",4) Q
"RTN","SROPCE1",14,0)
 .S SRQ=1
"RTN","SROPCE1",15,0)
CLASS ; build classification array
"RTN","SROPCE1",16,0)
 S:$D(SRTN) DFN=$P(^SRF(SRTN,0),"^") D CL^SDCO21(DFN,SRSDATE,,.SRCL)
"RTN","SROPCE1",17,0)
 I '$D(SRCL) W !!,"No classification information is required for this patient.",! K DA,DIE,DR S:$D(SRTN) DA=SRTN,DIE=130,DR=".0155////1" S:$D(SRWLST) DA(1)=SRSS,DA=SROFN,DIE="^SRO(133.8,"_DA(1)_",1,",DR="20////1" D ^DIE G END
"RTN","SROPCE1",18,0)
 I $D(SRTN),'$P(^SRF(SRTN,0),"^",20) G ELIG
"RTN","SROPCE1",19,0)
 I $D(SRWLST),'$P(^SRO(133.8,SRSS,1,SROFN,0),"^",20) G ELIG
"RTN","SROPCE1",20,0)
ASK W ! K DIR S DIR("A")="Do you want to update classification information (Y/N)? ",DIR("B")="NO",DIR(0)="YA" D ^DIR K DIR I 'Y!$D(DTOUT)!$D(DUOUT) W:'$D(SRWLST) @IOF Q
"RTN","SROPCE1",21,0)
ELIG ; output of eligibility and service connected conditions
"RTN","SROPCE1",22,0)
 N SRY D DEM^VADPT,ELIG^VADPT,SVC^VADPT
"RTN","SROPCE1",23,0)
 S SRELIG=$P(VAEL(1),"^",2),SRSC=$P(VAEL(3),"^"),SRSC=$S(SRSC:"YES",SRSC=0:"NO",1:""),SRPERC=$P(VAEL(3),"^",2)
"RTN","SROPCE1",24,0)
 S SRAO=$S(VASV(2):"YES",1:"NO"),SRIR=$S(VASV(3):"YES",1:"NO"),SRCV=$S(VASV(10):"YES",1:"NO")
"RTN","SROPCE1",25,0)
 S DIC=2,DA=DFN,DR=".322013",DIQ="SRY",DIQ(0)="I" D EN^DIQ1 K DA,DIC,DIQ,DR
"RTN","SROPCE1",26,0)
 S SREC=SRY(2,DFN,.322013,"I"),SREC=$S(SREC="Y":"YES",1:"NO")
"RTN","SROPCE1",27,0)
 W @IOF,!,VADM(1)_"  ("_VA("PID")_")       ",$P(VAEL(6),"^",2),!!,"   * * * Eligibility Information and Service Connected Conditions * * *"
"RTN","SROPCE1",28,0)
 W !!,?5,"Primary Eligibility: "_SRELIG,!,?5,"Combat Vet: "_SRCV,?22,"A/O Exp.: "_SRAO,!,?5,"ION Rad.: "_SRIR,?22,"Env Contam: "_SREC
"RTN","SROPCE1",29,0)
 D DIS^DGRPDB
"RTN","SROPCE1",30,0)
 W ! F I=1:1:79 W "-"
"RTN","SROPCE1",31,0)
SUP S SRY="operation" I $D(SRTN),$P($G(^SRF(SRTN,"NON")),"^")="Y" S SRY="procedure"
"RTN","SROPCE1",32,0)
 K DIR W !!,"Please supply the following required information about this "_SRY_":",! S:$D(SRWLST) DA(1)=SRSS,DA=SROFN S:$D(SRTN) DA=SRTN S SRDR="" S:'$D(SRQ) SRQ=0 D  I SRQ S:$D(SRWLST) SRSOUT=1 G END
"RTN","SROPCE1",33,0)
 .I $D(SRCL(3)) D SC I SRQ Q
"RTN","SROPCE1",34,0)
 .I $D(SRCL(7)) D CV I SRQ Q
"RTN","SROPCE1",35,0)
 .I $D(SRCL(1)) D AO I SRQ Q
"RTN","SROPCE1",36,0)
 .I $D(SRCL(2)) D IR I SRQ Q
"RTN","SROPCE1",37,0)
 .I $D(SRCL(4)) D EC I SRQ Q
"RTN","SROPCE1",38,0)
 .I $D(SRCL(5)) D MST I SRQ Q
"RTN","SROPCE1",39,0)
 .I $D(SRCL(6)) D HNC
"RTN","SROPCE1",40,0)
 K DA,DIE,DR S:$D(SRTN) DA=SRTN,DIE=130,DR=SRDR_".0155////1" S:$D(SRWLST) DA(1)=SRSS,DA=SROFN,DIE="^SRO(133.8,"_DA(1)_",1,",DR=SRDR_"20////1"
"RTN","SROPCE1",41,0)
 D ^DIE
"RTN","SROPCE1",42,0)
UPDX I X,$D(^SRF(SRTN,15)) D
"RTN","SROPCE1",43,0)
 .R !!,"Update all 'OTHER POSTOP DIAGNOSIS' Eligibility and",!,"Service Connected Conditions with these values?  Enter YES or NO. <NO>",Z:DTIME S:'$T Z=""
"RTN","SROPCE1",44,0)
 .D:(Z["Y")!(Z["y") UPDSC
"RTN","SROPCE1",45,0)
 .I Z["?" D  G UPDX
"RTN","SROPCE1",46,0)
 ..W !!,"Associate all of the existing OTHER POSTOP DIAGNOSIS for this surgical case with the new Eligibility and Service Connected Conditions?"
"RTN","SROPCE1",47,0)
 ..W !,"To edit diagnoses classification status individually, please use the Physician's Verification or the CPT/ICD9 Coding screens"
"RTN","SROPCE1",48,0)
END K DA,DIE,DR,SRZ,X,Y I 'SRQ,'$D(SRREQ),'$D(SRWLST) D PRESS
"RTN","SROPCE1",49,0)
 Q
"RTN","SROPCE1",50,0)
SC S DIR("A")="Treatment related to Service Connected condition (Y/N)",DIR(0)=$S($D(SRWLST):"133.801,16",1:"130,.016") D ^DIR K DIR I $D(DTOUT) S SRQ=1 Q
"RTN","SROPCE1",51,0)
 I X=""!$D(DUOUT)!(X="@") W !,*7,?15,"Enter YES or NO." G SC
"RTN","SROPCE1",52,0)
 S SRCL(3)=Y,SRDR=$G(SRDR)_$S($D(SRWLST):"16",1:".016")_"////"_SRCL(3)_";"
"RTN","SROPCE1",53,0)
 S SRCL(3,"UPDATE")=1
"RTN","SROPCE1",54,0)
 Q
"RTN","SROPCE1",55,0)
CV S DIR("A")="Treatment related to Combat (Y/N)",DIR(0)=$S($D(SRWLST):"133.801,23",1:"130,.024") D ^DIR K DIR I $D(DTOUT) S SRQ=1 Q
"RTN","SROPCE1",56,0)
 I X=""!$D(DUOUT)!(X="@") W !,*7,?15,"Enter YES or NO." G CV
"RTN","SROPCE1",57,0)
 S SRCL(7)=Y,SRDR=SRDR_$S($D(SRWLST):"23",1:".024")_"////"_SRCL(7)_";"
"RTN","SROPCE1",58,0)
 S SRCL(7,"UPDATE")=1
"RTN","SROPCE1",59,0)
 Q
"RTN","SROPCE1",60,0)
AO S DIR("A")="Treatment related to Agent Orange Exposure (Y/N)",DIR(0)=$S($D(SRWLST):"133.801,17",1:"130,.017") D ^DIR K DIR I $D(DTOUT) S SRQ=1 Q
"RTN","SROPCE1",61,0)
 I X=""!$D(DUOUT)!(X="@") W !,*7,?15,"Enter YES or NO." G AO
"RTN","SROPCE1",62,0)
 S SRCL(1)=Y,SRDR=SRDR_$S($D(SRWLST):"17",1:".017")_"////"_SRCL(1)_";"
"RTN","SROPCE1",63,0)
 S SRCL(1,"UPDATE")=1
"RTN","SROPCE1",64,0)
 Q
"RTN","SROPCE1",65,0)
IR S DIR("A")="Treatment related to Ionizing Radiation Exposure (Y/N)",DIR(0)=$S($D(SRWLST):"133.801,18",1:"130,.018") D ^DIR K DIR I $D(DTOUT) S SRQ=1 Q
"RTN","SROPCE1",66,0)
 I X=""!$D(DUOUT)!(X="@") W !,*7,?15,"Enter YES or NO." G IR
"RTN","SROPCE1",67,0)
 S SRCL(2)=Y,SRDR=SRDR_$S($D(SRWLST):"18",1:".018")_"////"_SRCL(2)_";"
"RTN","SROPCE1",68,0)
 S SRCL(2,"UPDATE")=1
"RTN","SROPCE1",69,0)
 Q
"RTN","SROPCE1",70,0)
EC S DIR("A")="Treatment related to Environmental Contaminant Exposure (Y/N)",DIR(0)=$S($D(SRWLST):"133.801,19",1:"130,.019") D ^DIR K DIR I $D(DTOUT) S SRQ=1 Q
"RTN","SROPCE1",71,0)
 I X=""!$D(DUOUT)!(X="@") W !,*7,?15,"Enter YES or NO." G EC
"RTN","SROPCE1",72,0)
 S SRCL(4)=Y,SRDR=SRDR_$S($D(SRWLST):"19",1:".019")_"////"_SRCL(4)_";"
"RTN","SROPCE1",73,0)
 S SRCL(4,"UPDATE")=1
"RTN","SROPCE1",74,0)
 Q
"RTN","SROPCE1",75,0)
MST S DIR("A")="Treatment related to Military Sexual Trauma (Y/N)",DIR(0)=$S($D(SRWLST):"133.801,21",1:"130,.022") D ^DIR K DIR I $D(DTOUT) S SRQ=1 Q
"RTN","SROPCE1",76,0)
 I X=""!$D(DUOUT)!(X="@") W !,*7,?15,"Enter YES or NO." G MST
"RTN","SROPCE1",77,0)
 S SRCL(5)=Y,SRDR=SRDR_$S($D(SRWLST):"21",1:".022")_"////"_SRCL(5)_";"
"RTN","SROPCE1",78,0)
 S SRCL(5,"UPDATE")=1
"RTN","SROPCE1",79,0)
 Q
"RTN","SROPCE1",80,0)
HNC S DIR("A")="Treatment related to Head and/or Neck Cancer (Y/N)",DIR(0)=$S($D(SRWLST):"133.801,22",1:"130,.023") D ^DIR K DIR I $D(DTOUT) S SRQ=1 Q
"RTN","SROPCE1",81,0)
 I X=""!$D(DUOUT)!(X="@") W !,*7,?15,"Enter YES or NO." G HNC
"RTN","SROPCE1",82,0)
 S SRCL(6)=Y,SRDR=SRDR_$S($D(SRWLST):"22",1:".023")_"////"_SRCL(6)_";"
"RTN","SROPCE1",83,0)
 S SRCL(6,"UPDATE")=1
"RTN","SROPCE1",84,0)
 Q
"RTN","SROPCE1",85,0)
WL ; entry from waiting list
"RTN","SROPCE1",86,0)
 N SRWLST S SRWLST=1 G EN1
"RTN","SROPCE1",87,0)
 Q
"RTN","SROPCE1",88,0)
REQ ; entry from new request entry
"RTN","SROPCE1",89,0)
 N SRREQ S SRREQ=1 G EN1
"RTN","SROPCE1",90,0)
PRESS W ! K DIR S DIR("A")="Press RETURN to continue  ",DIR(0)="FOA" D ^DIR K DIR W @IOF
"RTN","SROPCE1",91,0)
 Q
"RTN","SROPCE1",92,0)
UPDSC ;Update existing DX to Service Connected/Environmental Indicators associations.
"RTN","SROPCE1",93,0)
 K DA,DIE
"RTN","SROPCE1",94,0)
 S (DA,I)=0,DA(1)=SRTN,DIE="^SRF("_SRTN_",15,"
"RTN","SROPCE1",95,0)
 K DR
"RTN","SROPCE1",96,0)
 D:$D(SRCL(1,"UPDATE")) BLDDR(5,SRCL(1))
"RTN","SROPCE1",97,0)
 D:$D(SRCL(2,"UPDATE")) BLDDR(6,SRCL(2))
"RTN","SROPCE1",98,0)
 D:$D(SRCL(3,"UPDATE")) BLDDR(4,SRCL(3))
"RTN","SROPCE1",99,0)
 D:$D(SRCL(4,"UPDATE")) BLDDR(9,SRCL(4))
"RTN","SROPCE1",100,0)
 D:$D(SRCL(5,"UPDATE")) BLDDR(7,SRCL(5))
"RTN","SROPCE1",101,0)
 D:$D(SRCL(6,"UPDATE")) BLDDR(8,SRCL(6))
"RTN","SROPCE1",102,0)
 D:$D(SRCL(7,"UPDATE")) BLDDR(10,SRCL(7))
"RTN","SROPCE1",103,0)
 F I=1:1 S DA=$O(^SRF(SRTN,15,DA)) Q:DA=""  D ^DIE
"RTN","SROPCE1",104,0)
 Q
"RTN","SROPCE1",105,0)
BLDDR(DXPIECE,NEWSC) ;Build the DR string for updating DX/Service Indicators associations
"RTN","SROPCE1",106,0)
 S:$D(DR) DR=DR_";"
"RTN","SROPCE1",107,0)
 S:'$D(DR) DR=""
"RTN","SROPCE1",108,0)
 S DR=DR_DXPIECE_"///"_NEWSC
"RTN","SROPCE1",109,0)
 K DXPIECE,NEWSC
"RTN","SROPCE1",110,0)
 Q
"RTN","SROPCEX")
0^16^B9882023
"RTN","SROPCEX",1,0)
SROPCEX ;BIR/ADM - Cross Reference Logic  ; 3/24/05 5:10pm
"RTN","SROPCEX",2,0)
 ;;3.0;Surgery;**58,62,69,86,119**;24 Jun 93
"RTN","SROPCEX",3,0)
 Q
"RTN","SROPCEX",4,0)
APCE ; set logic for APCE cross reference
"RTN","SROPCEX",5,0)
 N SRCASE,SRDIV,SRCLINIC,SRPDATE,SRQ,SRSITE,SRSR,SRWC,SRX,SRY,SRZ S SRQ=0 S:$D(SRTN) SRCASE=SRTN I '$D(SRCASE) S SRCASE=$S($G(DA(1)):DA(1),1:DA)
"RTN","SROPCEX",6,0)
 Q:($P($G(^SRF(SRCASE,30)),"^"))!'$P(^SRF(SRCASE,"OP"),"^",2)!'$P($G(^SRF(SRCASE,34)),"^",2)
"RTN","SROPCEX",7,0)
 S SRSR="",SRDIV=$P($G(^SRF(SRCASE,8)),"^") I SRDIV D  Q:SRQ
"RTN","SROPCEX",8,0)
 .S SRSITE=$O(^SRO(133,"B",SRDIV,0)),SRWC=$P(^SRO(133,SRSITE,0),"^",15),SRSR=$P(^SRO(133,SRSITE,0),"^",19)
"RTN","SROPCEX",9,0)
 .S SRPDATE=$P(^SRO(133,SRSITE,0),"^",17) I SRPDATE,$P(^SRF(SRCASE,0),"^",9)<SRPDATE S SRQ=1 Q
"RTN","SROPCEX",10,0)
 .I $P(^SRO(133,SRSITE,0),"^",16),'$P(^SRF(SRCASE,0),"^",20) S SRQ=1 Q
"RTN","SROPCEX",11,0)
 .Q:SRWC="A"  I "N"[SRWC S SRQ=1 Q
"RTN","SROPCEX",12,0)
 S (SRX,SRY)=0 F  S SRX=$O(^SRF(SRCASE,13,SRX)) Q:'SRX  I '$P($G(^SRF(SRCASE,13,SRX,2)),"^") S SRY=1 Q
"RTN","SROPCEX",13,0)
 S (SRX,SRY)=0 F  S SRX=$O(^SRF(SRCASE,13,SRX)) Q:'SRX  D
"RTN","SROPCEX",14,0)
 .I '$P($G(^SRF(SRCASE,13,SRX,2)),"^") S SRY=1
"RTN","SROPCEX",15,0)
 .I '$D(^SRF(SRCASE,13,SRX,"OADX")) S SRY=1 K ^SRF("APCE",SRCASE) Q
"RTN","SROPCEX",16,0)
 .S SRZ=0 S SRZ=$O(^SRF(SRCASE,13,SRX,"OADX",SRZ)) I 'SRZ S SRY=1
"RTN","SROPCEX",17,0)
 .K:SRY ^SRF("APCE",SRCASE)
"RTN","SROPCEX",18,0)
 S SRZ=0,SRZ=$O(^SRF(SRCASE,"PADX",SRZ)) I 'SRZ S SRY=1 K ^SRF("APCE",SRCASE)
"RTN","SROPCEX",19,0)
 Q:SRY  S SRX=0 F  S SRX=$O(^SRF(SRCASE,15,SRX)) Q:'SRX  I '$P(^SRF(SRCASE,15,SRX,0),"^",3) K ^SRF("APCE",SRCASE) S SRY=1 Q
"RTN","SROPCEX",20,0)
 Q:SRY  S SRCLINIC=$P(^SRF(SRCASE,0),"^",21)
"RTN","SROPCEX",21,0)
 S SRX=$G(^SRF(SRCASE,"NON")) I $P(SRX,"^")="Y" Q:'$P(SRX,"^",4)!'$P(SRX,"^",5)!'$P(SRX,"^",6)!((SRSR'=0)&('$P(SRX,"^",7)))  S:SRCLINIC="" SRCLINIC=$P(SRX,"^",2) Q:SRCLINIC=""  Q:'$$CLINIC^SROUTL(SRCLINIC,SRCASE)  G SET
"RTN","SROPCEX",22,0)
 S:SRCLINIC="" SRCLINIC=$P(^SRO(137.45,$P(^SRF(SRCASE,0),"^",4),0),"^",5) I SRCLINIC="",$P(^SRF(SRCASE,0),"^",2) S SRCLINIC=$P(^SRS($P(^SRF(SRCASE,0),"^",2),0),"^")
"RTN","SROPCEX",23,0)
 Q:SRCLINIC=""  I '$$CLINIC^SROUTL(SRCLINIC,SRCASE) Q
"RTN","SROPCEX",24,0)
 S SRX=$G(^SRF(SRCASE,.2)) Q:'$P(SRX,"^",10)!'$P(SRX,"^",12)
"RTN","SROPCEX",25,0)
 S SRX=$G(^SRF(SRCASE,.1)) Q:'$P(SRX,"^",4)  I SRSR'=0,'$P(SRX,"^",13) Q
"RTN","SROPCEX",26,0)
 Q:SRQ
"RTN","SROPCEX",27,0)
SET S SRZ=$P(^SRF(SRCASE,0),"^",15) I SRZ S ^SRF("APCE",SRCASE)=SRZ Q
"RTN","SROPCEX",28,0)
 S ^SRF("APCE",SRCASE)=""
"RTN","SROPCEX",29,0)
 Q
"RTN","SROPCEX",30,0)
KAPCE ; kill logic for APCE cross reference
"RTN","SROPCEX",31,0)
 N SRCASE,SRDIV,SRSITE,SRWC S:$G(SRTN) SRCASE=SRTN I '$G(SRCASE) S SRCASE=$S($G(DA(1)):DA(1),1:DA)
"RTN","SROPCEX",32,0)
 I '$P(^SRF(SRCASE,0),"^",15) K ^SRF("APCE",SRCASE),SRFLD Q
"RTN","SROPCEX",33,0)
 I SRFLD=.011 S SRDIV=$P($G(^SRF(SRCASE,8)),"^") I SRDIV S SRSITE=$O(^SRO(133,"B",SRDIV,0)),SRWC=$P(^SRO(133,SRSITE,0),"^",15) I SRWC="A" K SRFLD Q
"RTN","SROPCEX",34,0)
 S ^SRF("APCE",SRCASE)=$P(^SRF(SRCASE,0),"^",15) K SRFLD
"RTN","SROPCEX",35,0)
 Q
"RTN","SROVER")
0^7^B25619011
"RTN","SROVER",1,0)
SROVER ;BIR/MAM - VERIFY CASE ;[ 01/30/01  1:52 PM ]
"RTN","SROVER",2,0)
 ;;3.0;Surgery;**7,34,38,86,88,100,119**;24 Jun 93
"RTN","SROVER",3,0)
BEG S (SRSOUT,SRS,SR2)=0 I $D(^SRF(SRTN,.2)),$P(^(.2),"^",3) S SRS=1
"RTN","SROVER",4,0)
DONE K X I $D(^SRF(SRTN,"VER")),$P(^("VER"),"^")="Y" W !!,"The procedure has already been verified.  Do you wish to continue ?  YES// " R X:DTIME I '$T!(X["^") G END
"RTN","SROVER",5,0)
 S:'$D(X) X="Y"
"RTN","SROVER",6,0)
 S:X="" X="Y" S X=$E(X) I X["?"!("YyNn"'[X) W !!,"Enter RETURN if you would like to reverify this case, or 'N' to exit",!,"this option." G DONE
"RTN","SROVER",7,0)
 G:"Yy"'[X END
"RTN","SROVER",8,0)
 S S(0)=^SRF(SRTN,0),Y=$E($P(S(0),"^",9),1,7),SRDATE=Y X ^DD("DD") S SRSDATE=Y,DFN=$P(S(0),"^") D DEM^VADPT S SRNM=VADM(1)_" ("_VA("PID")_")"
"RTN","SROVER",9,0)
 N ANS,SRLCK S ANS="NO"
"RTN","SROVER",10,0)
STRT D PRINT
"RTN","SROVER",11,0)
 I $P($G(^SRF(SRTN,"LOCK")),"^") W !!,"This case has been locked.  If you wish to update it, please contact",!,"your Chief of Surgery, or package coordinator." G END
"RTN","SROVER",12,0)
UP W ! G:SR2 VER W !,"Do you need to update the information above ?  NO// " R X:DTIME S:'$T X="^"
"RTN","SROVER",13,0)
 I X["^" W !!,"Verification of this case has not been made." G END
"RTN","SROVER",14,0)
 S (X,ANS)=$E(X)
"RTN","SROVER",15,0)
 I X?.E1C.E W !!,"Your answer has a control character in it, please re-type it.",! G UP
"RTN","SROVER",16,0)
 I "YyNn"'[X W !!,"If the information above is not correct, enter 'YES'.  You may then update",!,"any of the fields displayed.  Enter RETURN to proceed with verification",!,"of this case." G UP
"RTN","SROVER",17,0)
 S:X="" (X,ANS)="N" I "Yy"[X D CHECK^SROES I SRSOUT S SRLCK=0 K XQUIT G END
"RTN","SROVER",18,0)
 I "Yy"[ANS S SRLCK=1 D PRINT,RT,^SROVER1 G:SRSOUT END G STRT
"RTN","SROVER",19,0)
VER W !,"Will you verify that the information on your screen is correct ? YES// " R X:DTIME S:'$T X="^" I X["^" W !!,"No action has been taken. " G END
"RTN","SROVER",20,0)
 S X=$E(X)
"RTN","SROVER",21,0)
 I "YyNn"'[X W !,"Enter 'YES' if the procedures, diagnosis, and occurrences are correct",!,"for this case.  If you enter 'NO', the case will be left unverified." G VER
"RTN","SROVER",22,0)
 S:X="" X="Y" I "Yy"[X S $P(^SRF(SRTN,"VER"),"^")="Y"
"RTN","SROVER",23,0)
END S SROERR=SRTN D ^SROERR0
"RTN","SROVER",24,0)
 I $G(SRLCK) D UNLOCK^SROUTL(SRTN)
"RTN","SROVER",25,0)
 W !!,"Press RETURN to continue  " R X:DTIME D ^SRSKILL,ADXKILL^SROADX1 W @IOF
"RTN","SROVER",26,0)
 Q
"RTN","SROVER",27,0)
LOOP ; break procedure if greater than 45 characters
"RTN","SROVER",28,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<45  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROVER",29,0)
 Q
"RTN","SROVER",30,0)
RT ; start RT logging
"RTN","SROVER",31,0)
 I $D(XRTL) S XRTN="SROVER" D T0^%ZOSV
"RTN","SROVER",32,0)
 Q
"RTN","SROVER",33,0)
OTHER I '$O(^SRF(SRTN,13,0)) Q
"RTN","SROVER",34,0)
 S OTH=0 F  S OTH=$O(^SRF(SRTN,13,OTH)) Q:'OTH!(SRSOUT)  D
"RTN","SROVER",35,0)
 .S OTHER=$P(^SRF(SRTN,13,OTH,0),"^"),CPT=$P($G(^SRF(SRTN,13,OTH,2)),"^"),X=$S(CPT:$P($$CPT^ICPTCOD(CPT),"^",2),1:"NOT ENTERED")
"RTN","SROVER",36,0)
 .W !,?3,OTHER_"  CPT Code: ",X
"RTN","SROVER",37,0)
 .I CPT,$O(^SRF(SRTN,13,OTH,"MOD",0)) D  W !,?10,SRX
"RTN","SROVER",38,0)
 ..S (SRCOMMA,SRI)=0,SRCMOD="",SRX="Modifiers:  -" F  S SRI=$O(^SRF(SRTN,13,OTH,"MOD",SRI)) Q:'SRI  D
"RTN","SROVER",39,0)
 ...S SRM=$P(^SRF(SRTN,13,OTH,"MOD",SRI,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRM,"I"),"^",2)
"RTN","SROVER",40,0)
 ...S SRX=SRX_$S(SRCOMMA:",",1:"")_SRCMOD,SRCOMMA=1
"RTN","SROVER",41,0)
 .D OTHADXD^SROADX1
"RTN","SROVER",42,0)
 Q
"RTN","SROVER",43,0)
PRINT ; print information
"RTN","SROVER",44,0)
 W @IOF,!,SRNM,?52,"Operation Date: "_SRSDATE,! F I=1:1:80 W "-"
"RTN","SROVER",45,0)
 K ^UTILITY($J,"W") W !,"1. Indications for Operation:" S SRIND=0 F I=0:0 S SRIND=$O(^SRF(SRTN,40,SRIND)) Q:'SRIND  S X=^SRF(SRTN,40,SRIND,0),DIWL=3,DIWR=76,DIWF="N" D ^DIWP
"RTN","SROVER",46,0)
 I $D(^UTILITY($J,"W")) F V=1:1:^UTILITY($J,"W",3)-1 W !,?3,^UTILITY($J,"W",3,V,0)
"RTN","SROVER",47,0)
 S S("OP")=^SRF(SRTN,"OP"),CPT=$P(S("OP"),"^",2) S SROPER=$P(S("OP"),"^")
"RTN","SROVER",48,0)
 K SROPS,MM,MMM S:$L(SROPER)<45 SROPS(1)=SROPER I $L(SROPER)>44 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROVER",49,0)
 S X=$S(CPT:$P($$CPT^ICPTCOD(CPT),"^",2),1:"NOT ENTERED")
"RTN","SROVER",50,0)
 W !,"2. Principal CPT Code:  ",X I CPT K SRDES S X=$$CPTD^ICPTCOD(CPT,"SRDES") I $O(SRDES(0)) F I=1:1:X W !,?5,SRDES(I)
"RTN","SROVER",51,0)
 I CPT,$O(^SRF(SRTN,"OPMOD",0)) D  W !,?10,SRX
"RTN","SROVER",52,0)
 .S (SRCOMMA,SRI)=0,SRCMOD="",SRX="Modifiers:  -" F  S SRI=$O(^SRF(SRTN,"OPMOD",SRI)) Q:'SRI  D
"RTN","SROVER",53,0)
 ..S SRM=$P(^SRF(SRTN,"OPMOD",SRI,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRM,"I"),"^",2)
"RTN","SROVER",54,0)
 ..S SRX=SRX_$S(SRCOMMA:",",1:"")_SRCMOD,SRCOMMA=1
"RTN","SROVER",55,0)
 S SRMSG="NO Assoc. DX ENTERED",SRASDX="Assoc. DX: "
"RTN","SROVER",56,0)
 D PADXD^SROADX1
"RTN","SROVER",57,0)
 W !,"3. Principal Procedure: ",?24,SROPS(1) I $D(SROPS(2)) W !,?24,SROPS(2) I $D(SROPS(3)) W !,?24,SROPS(3)
"RTN","SROVER",58,0)
 W !,"4. Other Procedures: ",?24 D OTHER
"RTN","SROVER",59,0)
 W !,"5. Postoperative Diagnosis: " I $D(^SRF(SRTN,34)) W ?30,$P(^(34),"^")
"RTN","SROVER",60,0)
 W !,"6. Intraoperative Occurrences: "_$S($O(^SRF(SRTN,10,0)):"** INFORMATION ENTERED **",1:"NO OCCURRENCES HAVE BEEN ENTERED")
"RTN","SROVER",61,0)
 W !,"7. Principal Pre-OP Diagnosis: " I $D(^SRF(SRTN,33)) W $P(^(33),"^")
"RTN","SROVER",62,0)
 S SRDIAG="NOT ENTERED",SRDX=$P($G(^SRF(SRTN,34)),"^",3) I SRDX S SRDIAG=$$ICDDX^ICDCODE(SRDX,SRDATE),SRDIAG=$P(SRDIAG,"^",2)_"  "_$P(SRDIAG,"^",4)
"RTN","SROVER",63,0)
 W !,"8. Principal Pre-OP Diagnosis Code: "_SRDIAG
"RTN","SROVER",64,0)
 W ! F LINE=1:1:80 W "-"
"RTN","SROVER",65,0)
 Q
"RTN","SROVER1")
0^8^B14904185
"RTN","SROVER1",1,0)
SROVER1 ;BIR/MAM - EDIT, VERIFICATION SCREEN ;[ 10/01/99  12:55 PM ]
"RTN","SROVER1",2,0)
 ;;3.0;Surgery;**18,67,88,127,119**;24 Jun 93
"RTN","SROVER1",3,0)
 S SROVER=1,SRAO(1)=55,SRAO(2)=27,SRAO(3)=26,SRAO(4)="",SRAO(5)=34,SRAO(6)="",SRAO(7)=32,SRAO(8)=32.5,SRMSG="NO Assoc. DX ENTERED"
"RTN","SROVER1",4,0)
ASK W !!,"Select Information to Edit: " R X:DTIME I '$T!("^"[X) S SRSOUT=1 Q
"RTN","SROVER1",5,0)
 S:$E(X)="a" X="A" I '$D(SRAO(X)),(X'?.N1":".N),($E(X)'="A") D HELP Q:SRSOUT  G ASK
"RTN","SROVER1",6,0)
 I $E(X)="A" S X="1:8"
"RTN","SROVER1",7,0)
 I X?.N1":".N S Y=$E(X),Z=$P(X,":",2) I Y<1!(Z>8)!(Y>Z) D HELP Q:SRSOUT  G ASK
"RTN","SROVER1",8,0)
 I X?.N1":".N D RANGE Q
"RTN","SROVER1",9,0)
 S EMILY=X D ONE Q
"RTN","SROVER1",10,0)
 Q
"RTN","SROVER1",11,0)
HELP W !!,"Enter the number corresponding to the information you want to update.  You may",!,"enter 'ALL' to update all the information displayed on this screen, or a"
"RTN","SROVER1",12,0)
 W !,"range of numbers separated by a ':' to update more than one item."
"RTN","SROVER1",13,0)
 Q
"RTN","SROVER1",14,0)
RANGE ; range of numbers
"RTN","SROVER1",15,0)
 S SHEMP=$P(X,":"),CURLEY=$P(X,":",2) F EMILY=SHEMP:1:CURLEY Q:SRSOUT  D ONE
"RTN","SROVER1",16,0)
 Q
"RTN","SROVER1",17,0)
ONE ; edit one item
"RTN","SROVER1",18,0)
 W @IOF I EMILY=2 S X=$P(S("OP"),"^",2) I X D  W !
"RTN","SROVER1",19,0)
 .S SRY=$$CPT^ICPTCOD(X,$P($G(^SRF(SRTN,0)),"^",9)),Y=$P(SRY,"^",2),Z=$P(SRY,"^",3)
"RTN","SROVER1",20,0)
 .W !,"  CPT Code: "_Y_"  ",Z,!,?5,"Description:" D ^SROCPT W ! F I=1:1:80 W "-"
"RTN","SROVER1",21,0)
 I EMILY=4 D POTH Q
"RTN","SROVER1",22,0)
 I EMILY=6 D INTRA^SROCMPS S SRSOUT=0 Q
"RTN","SROVER1",23,0)
 W ! K DR,DIE,DA S DIE=130,DA=SRTN,DR=SRAO(EMILY)_"T" D ^DIE K DR,DIE
"RTN","SROVER1",24,0)
 I EMILY=5 D
"RTN","SROVER1",25,0)
 .D:$$SCEC^SROVER3() ASK^SROPCE1 K SRCL
"RTN","SROVER1",26,0)
 .D DOTH^SROVER3 I $D(Y) S SRSOUT=0
"RTN","SROVER1",27,0)
 I EMILY=2,$P(S("OP"),"^",2)'="" D VASDX^SROADX
"RTN","SROVER1",28,0)
 Q
"RTN","SROVER1",29,0)
POTH W !,"Other Procedures:",!
"RTN","SROVER1",30,0)
 N SRSHT K SRSEL S CNT=1,OTH=0 F  S OTH=$O(^SRF(SRTN,13,OTH)) Q:'OTH!(SRSOUT)  D
"RTN","SROVER1",31,0)
 .S OTHER=$P(^SRF(SRTN,13,OTH,0),"^"),X=$P($G(^SRF(SRTN,13,OTH,2)),"^"),CPT="NOT ENTERED",CPT1=""
"RTN","SROVER1",32,0)
 .I X S CPT1=X,Y=$$CPT^ICPTCOD(X,$P($G(^SRF(SRTN,0)),"^",9)),SRCPT=$P(Y,"^",2),SRSHT=$P(Y,"^",3),CPT=SRCPT_"  "_SRSHT
"RTN","SROVER1",33,0)
 .W !,CNT_". "_OTHER,!,?5,"CPT Code: "_CPT S SRSEL(CNT)=OTH_"^"_OTHER_"^CPT Code: "_CPT_"^"_CPT1
"RTN","SROVER1",34,0)
 .I CPT1,$O(^SRF(SRTN,13,OTH,"MOD",0)) D  W "  ("_SRX_")"
"RTN","SROVER1",35,0)
 ..S (SRCOMMA,SRI)=0,SRCMOD="",SRX="Modifiers: " F  S SRI=$O(^SRF(SRTN,13,OTH,"MOD",SRI)) Q:'SRI  D
"RTN","SROVER1",36,0)
 ...S SRM=$P(^SRF(SRTN,13,OTH,"MOD",SRI,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRM,"I"),"^",2)
"RTN","SROVER1",37,0)
 ...S SRX=SRX_$S(SRCOMMA:",",1:"")_SRCMOD,SRCOMMA=1
"RTN","SROVER1",38,0)
 . D OTHADXD^SROADX1
"RTN","SROVER1",39,0)
 .S CNT=CNT+1
"RTN","SROVER1",40,0)
 W !,CNT_". Enter NEW Other Procedure",! K DIR S DIR("A")="Enter selection",DIR(0)="NO^1:"_CNT D ^DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER1",41,0)
 Q:'Y  S SRDA=Y W !! I SRDA<CNT D  W @IOF G POTH
"RTN","SROVER1",42,0)
 .N OTHCNT S OTHCNT=Y
"RTN","SROVER1",43,0)
 .W @IOF,!,"Other Procedures:",!!,OTHCNT,"."
"RTN","SROVER1",44,0)
 .W ?3,$P(SRSEL(SRDA),"^",2),!,?5,$P(SRSEL(SRDA),"^",3)
"RTN","SROVER1",45,0)
 .S OTH=$P(SRSEL(SRDA),"^") K SRDES S CPT1=$P(SRSEL(SRDA),"^",4),X=$$CPTD^ICPTCOD(CPT1,"SRDES",,$P($G(^SRF(SRTN,0)),"^",9)) I $O(SRDES(0)) F I=1:1:X W !,?5,SRDES(I)
"RTN","SROVER1",46,0)
 .K DA,DIE,DIR,DR W ! S DA=$P(SRSEL(SRDA),"^"),DA(1)=SRTN,DIE="^SRF(SRTN,13,",DR=".01;3" D ^DIE K DA,DIE,DR Q:$D(Y)
"RTN","SROVER1",47,0)
 .D VOTHADX^SROADX
"RTN","SROVER1",48,0)
 K DIR S DIR("A")="Enter new OTHER PROCEDURE",DIR(0)="130.16,.01" D ^DIR K DIR S SRNEW=Y I $D(DTOUT)!$D(DUOUT)!(Y="") D PH Q
"RTN","SROVER1",49,0)
 K DD,DO S DIC="^SRF(SRTN,13,",X=SRNEW,DIC(0)="L",DIC("P")=$P(^DD(130,.42,0),"^",2) D FILE^DICN K DIC,DD,DO I +Y<0 D PH Q
"RTN","SROVER1",50,0)
 K DA,DIE,DIR,DR S DA=+Y,DA(1)=SRTN,DIE="^SRF(SRTN,13,",DR="3" D ^DIE
"RTN","SROVER1",51,0)
 D NOTHADX^SROADX K DA,DIE,DR Q:$D(Y)
"RTN","SROVER1",52,0)
PH W @IOF G POTH
"RTN","SROVER1",53,0)
 Q
"RTN","SROVER1",54,0)
PRESS W ! K DIR S DIR("A")="Press RETURN to continue ",DIR(0)="FOA" D ^DIR K DIR
"RTN","SROVER1",55,0)
 Q
"RTN","SROVER2")
0^9^B26717453
"RTN","SROVER2",1,0)
SROVER2 ;BIR/ADM - Case Coding and Verification ; 8/10/04 3:00pm
"RTN","SROVER2",2,0)
 ;;3.0;Surgery;**86,88,100,127,119**;24 Jun 93
"RTN","SROVER2",3,0)
 I '$D(SRSITE) D ^SROVAR I '$D(SRSITE) S XQUIT="" Q
"RTN","SROVER2",4,0)
 I '$G(SRTN) D ^SROPS1 I '$D(SRTN) S XQUIT="" Q
"RTN","SROVER2",5,0)
BEG N SRDES,SRDX,SREDIT,SRMOD,SRNON,SRSEL,SRTXT S (SREDIT,SRMOD,SRSOUT,SRS,SR2)=0 K ^TMP("SRV1",$J),^TMP("SRV2",$J) I $D(^SRF(SRTN,.2)),$P(^(.2),"^",3) S SRS=1
"RTN","SROVER2",6,0)
 S S(0)=^SRF(SRTN,0),Y=$P(S(0),"^",9),SRDATE=Y D D^DIQ S SRSDATE=Y,DFN=$P(S(0),"^") D DEM^VADPT S SRNM=VADM(1)_"  ("_VA("PID")_")"
"RTN","SROVER2",7,0)
 S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0)
"RTN","SROVER2",8,0)
PRINT ; print information
"RTN","SROVER2",9,0)
 D HDR S S("OP")=^SRF(SRTN,"OP"),CPT=$P(S("OP"),"^",2),SROPER=$P(S("OP"),"^")
"RTN","SROVER2",10,0)
 S SRJ=0,Y="" F  S SRJ=$O(^SRF(SRTN,"OPMOD",SRJ)) Q:'SRJ  S Y=Y_$S($L(Y):",",1:"")_^SRF(SRTN,"OPMOD",SRJ,0)
"RTN","SROVER2",11,0)
 S ^TMP("SRV1",$J,"OP")=SROPER_"^"_CPT_"^"_Y
"RTN","SROVER2",12,0)
 S SRCPT="" I CPT S Y=$$CPT^ICPTCOD(CPT,$P($G(^SRF(SRTN,0)),"^",9)),SRCPT=$P(Y,"^",2)_"  "_$P(Y,"^",3)
"RTN","SROVER2",13,0)
 K SROPS,MM,MMM S:$L(SROPER)<45 SROPS(1)=SROPER I $L(SROPER)>44 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROVER2",14,0)
 W !,"1. Principal Procedure: ",?24,SROPS(1) I $D(SROPS(2)) W !,?24,SROPS(2) I $D(SROPS(3)) W !,?24,SROPS(3)
"RTN","SROVER2",15,0)
 W !,"2. Principal CPT Code: ",?24,$S(CPT:SRCPT,1:"NOT ENTERED")
"RTN","SROVER2",16,0)
 I CPT K SRDES S X=$$CPTD^ICPTCOD(CPT,"SRDES",,$P($G(^SRF(SRTN,0)),"^",9)) I $O(SRDES(0)) F I=1:1:X W !,?6,SRDES(I)
"RTN","SROVER2",17,0)
 I CPT,$O(^SRF(SRTN,"OPMOD",0)) D  W !,?10,SRX
"RTN","SROVER2",18,0)
 .S (SRCOMMA,SRI)=0,SRCMOD="",SRX="Modifiers:  -" F  S SRI=$O(^SRF(SRTN,"OPMOD",SRI)) Q:'SRI  D
"RTN","SROVER2",19,0)
 ..S SRM=$P(^SRF(SRTN,"OPMOD",SRI,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRM,"I"),"^",2) K SRM
"RTN","SROVER2",20,0)
 ..S SRX=SRX_$S(SRCOMMA:",",1:"")_SRCMOD,SRCOMMA=1
"RTN","SROVER2",21,0)
 S SRMSG="NO Assoc. DX ENTERED"
"RTN","SROVER2",22,0)
 D PADXD^SROADX1
"RTN","SROVER2",23,0)
 W !,"3. Other Procedures: "_$S($O(^SRF(SRTN,13,0)):"** INFORMATION ENTERED **",1:"NO OTHER PROCEDURES HAVE BEEN ENTERED")
"RTN","SROVER2",24,0)
 S X=0 F  S X=$O(^SRF(SRTN,13,X)) Q:'X  D  S ^TMP("SRV1",$J,13,X)=$P($G(^SRF(SRTN,13,X,0)),"^")_"^"_$P($G(^SRF(SRTN,13,X,2)),"^")_"^"_Y
"RTN","SROVER2",25,0)
 .S SRJ=0,Y="" F  S SRJ=$O(^SRF(SRTN,13,X,"MOD",SRJ)) Q:'SRJ  S Y=Y_$S($L(Y):",",1:"")_^SRF(SRTN,13,X,"MOD",SRJ,0)
"RTN","SROVER2",26,0)
 I SRNON S SRTXT=$P($G(^SRF(SRTN,33)),"^",2) W !,"4. Principal Diagnosis: "_SRTXT
"RTN","SROVER2",27,0)
 I 'SRNON S SRTXT=$P($G(^SRF(SRTN,34)),"^") W !,"4. Postoperative Diagnosis: "_SRTXT
"RTN","SROVER2",28,0)
 S SRDIAG="NOT ENTERED",SRDX=$P($G(^SRF(SRTN,34)),"^",2) I SRDX S SRDIAG=$$ICDDX^ICDCODE(SRDX,SRDATE),SRDIAG=$P(SRDIAG,"^",2)_"  "_$P(SRDIAG,"^",4)
"RTN","SROVER2",29,0)
 W !,"5. Principal Diagnosis Code: "_SRDIAG S ^TMP("SRV1",$J,34)=SRTXT_"^"_SRDX
"RTN","SROVER2",30,0)
 W !,"6. Other Postop Diagnosis: "_$S($O(^SRF(SRTN,15,0)):"** INFORMATION ENTERED **",1:"NO OTHER POSTOP DIAGNOSIS HAS BEEN ENTERED")
"RTN","SROVER2",31,0)
 W !,"7. Principal Pre-OP Diagnosis: " I $D(^SRF(SRTN,33)) W $P(^(33),"^")
"RTN","SROVER2",32,0)
 S SRDIAG="NOT ENTERED",SRDX=$P($G(^SRF(SRTN,34)),"^",3) I SRDX S SRDIAG=$$ICDDX^ICDCODE(SRDX,SRDATE),SRDIAG=$P(SRDIAG,"^",2)_"  "_$P(SRDIAG,"^",4)
"RTN","SROVER2",33,0)
 W !,"8. Principal Pre-OP Diagnosis Code: "_SRDIAG
"RTN","SROVER2",34,0)
 S X=0 F  S X=$O(^SRF(SRTN,15,X)) Q:'X  S Y=$G(^SRF(SRTN,15,X,0)),^TMP("SRV1",$J,15,X)=$P(Y,"^")_"^"_$P(Y,"^",3)
"RTN","SROVER2",35,0)
 W ! F LINE=1:1:80 W "-"
"RTN","SROVER2",36,0)
 N SRLCK S SRLCK=$$LOCK^SROUTL(SRTN) I 'SRLCK G END
"RTN","SROVER2",37,0)
 D ^SROVER3,MOD G:SRSOUT END G:'SREDIT PRINT
"RTN","SROVER2",38,0)
END K ^TMP("SRV1",$J),^TMP("SRV2",$J) S SROERR=SRTN D ^SROERR0,^SRSKILL,ADXKILL^SROADX1 W @IOF
"RTN","SROVER2",39,0)
 I $G(SRLCK) D UNLOCK^SROUTL(SRTN)
"RTN","SROVER2",40,0)
 Q
"RTN","SROVER2",41,0)
HDR W @IOF,!,SRNM,!,"Operation Date: "_SRSDATE,?40,"Case #",SRTN,! F I=1:1:80 W "-"
"RTN","SROVER2",42,0)
 Q
"RTN","SROVER2",43,0)
LOOP ; break procedure if greater than 45 characters
"RTN","SROVER2",44,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<45  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROVER2",45,0)
 Q
"RTN","SROVER2",46,0)
ORPT ; print operation/procedure report
"RTN","SROVER2",47,0)
 N SRNON S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0) I SRNON D CODE^SRONON Q
"RTN","SROVER2",48,0)
 D CODE^SROPRPT
"RTN","SROVER2",49,0)
 Q
"RTN","SROVER2",50,0)
NRPT ; print nurse intraoperative report
"RTN","SROVER2",51,0)
 N SRNON S SRNON=$S($P($G(^SRF(SRTN,"NON")),"^")="Y":1,1:0) I SRNON W !!,?5,"Nurse Intraoperative Report NOT available on Non-OR Procedure",! D PRESS^SROVER3 W @IOF Q
"RTN","SROVER2",52,0)
 D CODE^SRONIN
"RTN","SROVER2",53,0)
 Q
"RTN","SROVER2",54,0)
MOD ; if data changed set coder verification field
"RTN","SROVER2",55,0)
 D CHECK I SRMOD S $P(^SRF(SRTN,"VER"),"^",2)=DUZ
"RTN","SROVER2",56,0)
 Q
"RTN","SROVER2",57,0)
CHECK ; check for changes to data
"RTN","SROVER2",58,0)
 S X=$P(^SRF(SRTN,"OP"),"^",1,2) D  I X'=^TMP("SRV1",$J,"OP") S SRMOD=1 Q
"RTN","SROVER2",59,0)
 .S SRJ=0,Y="" F  S SRJ=$O(^SRF(SRTN,"OPMOD",SRJ)) Q:'SRJ  S Y=Y_$S($L(Y):",",1:"")_^SRF(SRTN,"OPMOD",SRJ,0)
"RTN","SROVER2",60,0)
 .S X=X_"^"_Y
"RTN","SROVER2",61,0)
 S X=0 F  S X=$O(^SRF(SRTN,13,X)) Q:'X!SRMOD  D  S ^TMP("SRV2",$J,13,X)=$P($G(^SRF(SRTN,13,X,0)),"^")_"^"_$P($G(^SRF(SRTN,13,X,2)),"^")_"^"_Y I ^TMP("SRV2",$J,13,X)'=$G(^TMP("SRV1",$J,13,X)) S SRMOD=1 Q
"RTN","SROVER2",62,0)
 .S SRJ=0,Y="" F  S SRJ=$O(^SRF(SRTN,13,X,"MOD",SRJ)) Q:'SRJ  S Y=Y_$S($L(Y):",",1:"")_^SRF(SRTN,13,X,"MOD",SRJ,0)
"RTN","SROVER2",63,0)
 Q:SRMOD  S X=0 F  S X=$O(^TMP("SRV1",$J,13,X)) Q:'X!SRMOD  I ^TMP("SRV1",$J,13,X)'=$G(^TMP("SRV2",$J,13,X)) S SRMOD=1 Q
"RTN","SROVER2",64,0)
 Q:SRMOD  I SRNON S X=$P($G(^SRF(SRTN,33)),"^",2)_"^"_$P($G(^SRF(SRTN,34)),"^",2) I X'=^TMP("SRV1",$J,34) S SRMOD=1 Q
"RTN","SROVER2",65,0)
 I 'SRNON S X=$P($G(^SRF(SRTN,34)),"^",1,2) I X'=^TMP("SRV1",$J,34) S SRMOD=1 Q
"RTN","SROVER2",66,0)
 S X=0 F  S X=$O(^SRF(SRTN,15,X)) Q:'X!SRMOD  S Y=$G(^SRF(SRTN,15,X,0)),^TMP("SRV2",$J,15,X)=$P(Y,"^")_"^"_$P(Y,"^",3) I ^TMP("SRV2",$J,15,X)'=$G(^TMP("SRV1",$J,15,X)) S SRMOD=1 Q
"RTN","SROVER2",67,0)
 Q:SRMOD  S X=0 F  S X=$O(^TMP("SRV1",$J,15,X)) Q:'X!SRMOD  I ^TMP("SRV1",$J,15,X)'=$G(^TMP("SRV2",$J,15,X)) S SRMOD=1 Q
"RTN","SROVER2",68,0)
 Q
"RTN","SROVER3")
0^10^B34463738
"RTN","SROVER3",1,0)
SROVER3 ;BIR/ADM - Case Coding and Verification ; 8/17/04 4:09pm
"RTN","SROVER3",2,0)
 ;;3.0;Surgery;**86,88,127,119**;24 Jun 93
"RTN","SROVER3",3,0)
 ;;
"RTN","SROVER3",4,0)
 ; Reference to CL^SDCO21 supported by DBIA #406
"RTN","SROVER3",5,0)
 ;;
"RTN","SROVER3",6,0)
 S SROVER=1,SRAO(1)=26,SRAO(2)=27,SRAO(3)="",SRAO(4)=$S(SRNON:33,1:34),SRAO(5)=66,SRAO(6)="",SRAO(7)=32,SRAO(8)=32.5,SRMSG="NO Assoc. DX ENTERED"
"RTN","SROVER3",7,0)
ASK W ! K DIR S DIR("A")="Select Information to Edit: ",DIR(0)="FOA",DIR("?",1)="Enter the number corresponding to the information you want to update.  You may"
"RTN","SROVER3",8,0)
 S DIR("?",2)="enter 'ALL' to update all the information displayed on this screen, or a",DIR("?")="range of numbers separated by a ':' to update more than one item." D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER3",9,0)
 I X="" S SREDIT=1 Q
"RTN","SROVER3",10,0)
 S:$E(X)="a" X="A" I '$D(SRAO(X)),(X'?.N1":".N),($E(X)'="A") D HELP Q:SRSOUT  G ASK
"RTN","SROVER3",11,0)
 I $E(X)="A" S X="1:8"
"RTN","SROVER3",12,0)
 I X?.N1":".N S Y=$E(X),Z=$P(X,":",2) I Y<1!(Z>8)!(Y>Z) D HELP Q:SRSOUT  G ASK
"RTN","SROVER3",13,0)
 D HDR^SROVER2 I X?.N1":".N D RANGE Q
"RTN","SROVER3",14,0)
 S EMILY=X D ONE Q
"RTN","SROVER3",15,0)
 Q
"RTN","SROVER3",16,0)
HELP W !!,"Enter the number corresponding to the information you want to update.  You may",!,"enter 'ALL' to update all the information displayed on this screen, or a"
"RTN","SROVER3",17,0)
 W !,"range of numbers separated by a ':' to update more than one item."
"RTN","SROVER3",18,0)
 Q
"RTN","SROVER3",19,0)
PRESS W ! K DIR S DIR("A")="Press RETURN to continue ",DIR(0)="FOA" D ^DIR K DIR
"RTN","SROVER3",20,0)
 Q
"RTN","SROVER3",21,0)
RANGE ; range of numbers
"RTN","SROVER3",22,0)
 S SHEMP=$P(X,":"),CURLEY=$P(X,":",2) F EMILY=SHEMP:1:CURLEY Q:SRSOUT  W ! D ONE
"RTN","SROVER3",23,0)
 Q
"RTN","SROVER3",24,0)
ONE ; edit one item
"RTN","SROVER3",25,0)
 I EMILY=3 D POTH Q
"RTN","SROVER3",26,0)
 I EMILY=6 D DOTH Q
"RTN","SROVER3",27,0)
 W ! K DR,DIE,DA S DIE=130,DA=SRTN,DR=SRAO(EMILY)_"T" D ^DIE K DR,DIE I $D(Y) S SRSOUT=1
"RTN","SROVER3",28,0)
 I EMILY=4&($$SCEC()) D ASK^SROPCE1 K SRCL
"RTN","SROVER3",29,0)
 I EMILY=2 D CASDX^SROADX
"RTN","SROVER3",30,0)
 Q
"RTN","SROVER3",31,0)
POTH W !,"Other Procedures:",!
"RTN","SROVER3",32,0)
 N SRSHT K SRSEL S CNT=1,OTH=0 F  S OTH=$O(^SRF(SRTN,13,OTH)) Q:'OTH!(SRSOUT)  D
"RTN","SROVER3",33,0)
 .S OTHER=$P(^SRF(SRTN,13,OTH,0),U),X=$P($G(^SRF(SRTN,13,OTH,2)),U),CPT="NOT ENTERED",CPT1=""
"RTN","SROVER3",34,0)
 .I X S CPT1=X,Y=$$CPT^ICPTCOD(X,$P($G(^SRF(SRTN,0)),"^",9)),SRCPT=$P(Y,U,2),SRSHT=$P(Y,U,3),Y=SRCPT,SRDA=OTH D SSOTH^SROCPT S SRCPT=Y,CPT=SRCPT_"  "_SRSHT
"RTN","SROVER3",35,0)
 .W !,CNT_". "_OTHER
"RTN","SROVER3",36,0)
 .W !,?5,"CPT Code: "_CPT
"RTN","SROVER3",37,0)
 .S SRSEL(CNT)=OTH_"^"_OTHER_"^CPT Code: "_CPT_"^"_CPT1
"RTN","SROVER3",38,0)
 .D OTHADXD^SROADX1
"RTN","SROVER3",39,0)
 .S CNT=CNT+1
"RTN","SROVER3",40,0)
 W !,CNT_". Enter NEW Other Procedure",! K DIR S DIR("A")="Enter selection",DIR(0)="NO^1:"_CNT D ^DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER3",41,0)
 Q:'Y  S SRDA=Y W !! I SRDA<CNT D  G PH
"RTN","SROVER3",42,0)
 .D HDR^SROVER2
"RTN","SROVER3",43,0)
 .W !,"Other Procedures:",!
"RTN","SROVER3",44,0)
 .W !,SRDA,"."
"RTN","SROVER3",45,0)
 .W ?3,$P(SRSEL(SRDA),U,2),!,?5,$P(SRSEL(SRDA),U,3)
"RTN","SROVER3",46,0)
 .S OTH=$P(SRSEL(SRDA),U) K SRDES S CPT1=$P(SRSEL(SRDA),U,4),X=$$CPTD^ICPTCOD(CPT1,"SRDES",,$P($G(^SRF(SRTN,0)),"^",9)) I $O(SRDES(0)) F I=1:1:X W !,?5,SRDES(I)
"RTN","SROVER3",47,0)
 .K DA,DIE,DIR,DR W ! S DA=$P(SRSEL(SRDA),U),DA(1)=SRTN,DIE="^SRF(SRTN,13,",DR=".01;3" D ^DIE D:$D(DA) COTHADX^SROADX K DA,DIE,DR Q:$D(Y)  D PRESS
"RTN","SROVER3",48,0)
 K DIR S DIR("A")="Enter new OTHER PROCEDURE",DIR(0)="130.16,.01" D ^DIR K DIR S SRNEW=Y I $D(DTOUT)!$D(DUOUT)!(Y="") G PH
"RTN","SROVER3",49,0)
 K DD,DO S DIC="^SRF(SRTN,13,",X=SRNEW,DIC(0)="L",DIC("P")=$P(^DD(130,.42,0),U,2) D FILE^DICN K DIC,DD,DO I +Y<0 Q
"RTN","SROVER3",50,0)
 K DA,DIE,DIR,DR S DA=+Y,DA(1)=SRTN,DIE="^SRF(SRTN,13,",DR="3" D ^DIE K DA,DIE,DR Q:$D(Y)  S SRDA=CNT,OTHER=SRNEW D COTHADX^SROADX D PRESS
"RTN","SROVER3",51,0)
PH D HDR^SROVER2 D POTH
"RTN","SROVER3",52,0)
 Q
"RTN","SROVER3",53,0)
DOTH W !,"Other Postop Diagnosis:",!
"RTN","SROVER3",54,0)
 N SCEC,ENVARR S SCEC=$$SCEC()
"RTN","SROVER3",55,0)
 K SRSEL S CNT=1,OTH=0 F  S OTH=$O(^SRF(SRTN,15,OTH)) Q:'OTH!(SRSOUT)  D
"RTN","SROVER3",56,0)
 .S OTHER=$P(^SRF(SRTN,15,OTH,0),U),X=$P($G(^SRF(SRTN,15,OTH,0)),U,3),SRDIAG="NOT ENTERED"
"RTN","SROVER3",57,0)
 .I X S Y=$$ICDDX^ICDCODE(X,$P($G(^SRF(SRTN,9)),"^",9)),SRNUM=$P(Y,U,2),SRDES=$P(Y,U,4),SRDIAG=SRNUM_"  "_SRDES
"RTN","SROVER3",58,0)
 .W !,CNT_". "_OTHER,!,?5,"ICD9 Code: "_SRDIAG S SRSEL(CNT)=OTH_"^"_OTHER_"^ICD9 Code: "_SRDIAG
"RTN","SROVER3",59,0)
 .D:SCEC
"RTN","SROVER3",60,0)
 ..D GETS^DIQ(130.18,OTH_","_SRTN_",","4:10","E","ENVARR")
"RTN","SROVER3",61,0)
 ..I $D(ENVARR(130.18,OTH_","_SRTN_",",4,"E")) D
"RTN","SROVER3",62,0)
 ...N SRCOLSPN S SRCOLSPN=13 W !
"RTN","SROVER3",63,0)
 ...I $D(SRCL(3)) W ?SRCOLSPN,"SC:",$E(ENVARR(130.18,OTH_","_SRTN_",",4,"E")) S SRCOLSPN=SRCOLSPN+8
"RTN","SROVER3",64,0)
 ...I $D(SRCL(7)) W ?SRCOLSPN,"CV:",$E(ENVARR(130.18,OTH_","_SRTN_",",10,"E")) S SRCOLSPN=SRCOLSPN+8
"RTN","SROVER3",65,0)
 ...I $D(SRCL(1)) W ?SRCOLSPN,"AO:",$E(ENVARR(130.18,OTH_","_SRTN_",",5,"E")) S SRCOLSPN=SRCOLSPN+8
"RTN","SROVER3",66,0)
 ...I $D(SRCL(2)) W ?SRCOLSPN,"IR:",$E(ENVARR(130.18,OTH_","_SRTN_",",6,"E")) S SRCOLSPN=SRCOLSPN+8
"RTN","SROVER3",67,0)
 ...I $D(SRCL(4)) W ?SRCOLSPN,"EC:",$E(ENVARR(130.18,OTH_","_SRTN_",",9,"E")) S SRCOLSPN=SRCOLSPN+8
"RTN","SROVER3",68,0)
 ...I $D(SRCL(5)) W ?SRCOLSPN,"MST:",$E(ENVARR(130.18,OTH_","_SRTN_",",7,"E")) S SRCOLSPN=SRCOLSPN+8
"RTN","SROVER3",69,0)
 ...I $D(SRCL(6)) W ?SRCOLSPN,"H&N:",$E(ENVARR(130.18,OTH_","_SRTN_",",8,"E")) S SRCOLSPN=SRCOLSPN+8
"RTN","SROVER3",70,0)
 .S CNT=CNT+1
"RTN","SROVER3",71,0)
 W !,CNT_". Enter NEW Other Postop Diagnosis",! K DIR S DIR("A")="Enter selection",DIR(0)="NO^1:"_CNT D ^DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER3",72,0)
 Q:'Y  S SRDA=Y W !! I SRDA<CNT D  G DH
"RTN","SROVER3",73,0)
 .W ?3,$P(SRSEL(SRDA),U,2),!,?5,$P(SRSEL(SRDA),U,3)
"RTN","SROVER3",74,0)
 .K DA,DIE,DIR S DA=$P(SRSEL(SRDA),U),DA(1)=SRTN,DIE="^SRF(SRTN,15,",DR=".01;3;"
"RTN","SROVER3",75,0)
 .S:$D(SRCL(3)) DR=DR_"4;" S:$D(SRCL(7)) DR=DR_"10;" S:$D(SRCL(1)) DR=DR_"5;" S:$D(SRCL(2)) DR=DR_"6;" S:$D(SRCL(4)) DR=DR_"9;" S:$D(SRCL(5)) DR=DR_"7;" S:$D(SRCL(6)) DR=DR_"8;"
"RTN","SROVER3",76,0)
 .D ^DIE K DA,DIE,DIR,DR
"RTN","SROVER3",77,0)
 K DIR,SRCL S DIR("A")="Enter new OTHER POSTOP DIAGNOSIS",DIR(0)="130.18,.01" D ^DIR K DIR S SRNEW=Y I $D(DTOUT)!$D(DUOUT)!(Y="") G DH
"RTN","SROVER3",78,0)
 S DIR(0)="130.18,3" D ^DIR K DIR S SRCODE=$P(Y,U) I $D(DTOUT)!$D(DUOUT) S SRSOUT=1 Q
"RTN","SROVER3",79,0)
 S:'$D(DA(1)) DA(1)=SRTN
"RTN","SROVER3",80,0)
 S SRCODE=Y K DD,DO S DIC="^SRF(SRTN,15,",X=SRNEW,DIC(0)="L",DIC("DR")="3////"_$P(SRCODE,U),DIC("P")=$P(^DD(130,.74,0),U,2) D FILE^DICN K DA,DD,DIC,DO,DR
"RTN","SROVER3",81,0)
DH D HDR^SROVER2 D DOTH
"RTN","SROVER3",82,0)
 Q
"RTN","SROVER3",83,0)
SCEC() N SRSDATE,DFN,SCEC S SRSDATE=$S($D(SRTN):$P(^SRF(SRTN,0),U,9),1:DT)
"RTN","SROVER3",84,0)
 S DFN=$P(^SRF(SRTN,0),U) D CL^SDCO21(DFN,SRSDATE,,.SRCL)
"RTN","SROVER3",85,0)
 S SCEC=$S($D(SRCL):1,1:0)
"RTN","SROVER3",86,0)
 Q SCEC
"RTN","SROWL")
0^4^B27135451
"RTN","SROWL",1,0)
SROWL ;B'HAM ISC/MAM - ENTER PATIENT ON WAITING LIST ;13 Feb 1989  11:32 AM
"RTN","SROWL",2,0)
 ;;3.0;Surgery;**58,119**;24 Jun 93
"RTN","SROWL",3,0)
ENTER ; enter a patient on the waiting list
"RTN","SROWL",4,0)
 S SRSOUT=0 W @IOF K DIC S DIC(0)="QEAMZL",(DIC,DLAYGO)=133.8,DIC("A")="  Select Surgical Specialty: " D ^DIC K DIC,DLAYGO G:Y<0 END S SRSS=+Y,SRSS1=+Y(0)
"RTN","SROWL",5,0)
 S SRSSNM=$P(^SRO(137.45,SRSS1,0),"^")
"RTN","SROWL",6,0)
PAT W ! S DIC=2,DIC(0)="QEAMZ",DIC("A")="  Select Patient: " D ^DIC K DIC I Y<0 W !!,"No action taken." G END
"RTN","SROWL",7,0)
 S DFN=+Y,SRNM=$P(Y(0),"^") I $D(^DPT(DFN,.35)),$P(^(.35),"^")'="" S Y=$E($P(^(.35),"^"),1,7) D D^DIQ W !!,"The records show that "_SRNM_" died on "_Y_".",! G PAT
"RTN","SROWL",8,0)
 I $O(^SRO(133.8,"AP",DFN,SRSS,0)) D CHK G:"Yy"'[ECYN END
"RTN","SROWL",9,0)
OP W ! K DIR S DIR("A")="  Select Operative Procedure",DIR(0)="133.801,1" D ^DIR I $D(DTOUT)!$D(DUOUT) W !!,"No action taken." G END
"RTN","SROWL",10,0)
 S SROPER=Y
"RTN","SROWL",11,0)
 W ! D NOW^%DTC S SRSDT=%
"RTN","SROWL",12,0)
 K DD,DO,DIC,DR,DA S DIC(0)="L",DIC="^SRO(133.8,SRSS,1,",DA(1)=SRSS,X=DFN D FILE^DICN I +Y S SROFN=+Y
"RTN","SROWL",13,0)
 K DA,DIE,DR S DA=SRSS,DIE=133.8,DR="1///"_SRNM,DR(2,133.801)="1////"_SROPER_";2///"_SRSDT_";4T;W !;5T;6T;W !;3T",DR(3,133.8013)=".01T;1T;2T;3T;4T;5T" D ^DIE K DIE,DR
"RTN","SROWL",14,0)
 D WL^SROPCE1 I SRSOUT G DEL
"RTN","SROWL",15,0)
 W @IOF,!,SRNM_" has been entered on the waiting list",!,"for "_SRSSNM
"RTN","SROWL",16,0)
END D PRESS,^SRSKILL W @IOF
"RTN","SROWL",17,0)
 Q
"RTN","SROWL",18,0)
PRESS W ! K DIR S DIR("A")="Press RETURN to continue  ",DIR(0)="FOA" D ^DIR K DIR
"RTN","SROWL",19,0)
 Q
"RTN","SROWL",20,0)
DEL S DA(1)=SRSS,DA=SROFN,DIK="^SRO(133.8,"_DA(1)_",1," D ^DIK
"RTN","SROWL",21,0)
 W @IOF,!,"Classification information is incomplete.  No action taken." G END
"RTN","SROWL",22,0)
 Q
"RTN","SROWL",23,0)
HELP W !!,"Enter RETURN if you want to continue entering a new procedure on the waiting",!,"list for "_SRNM_".  If the procedure you are about to enter appears",!,"above, enter 'NO' to quit this option."
"RTN","SROWL",24,0)
 W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SROWL",25,0)
 Q
"RTN","SROWL",26,0)
CHK ; check for existing entries for a patient
"RTN","SROWL",27,0)
 W @IOF,!,"Procedure(s) already entered for "_SRNM,!,"on the Waiting List for "_SRSSNM,!
"RTN","SROWL",28,0)
 S SROFN=0 F  S SROFN=$O(^SRO(133.8,"AP",DFN,SRSS,SROFN)) Q:'SROFN  D LIST
"RTN","SROWL",29,0)
 W !!,"Do you wish to continue entering a new procedure for "_SRNM_" on",!,"the waiting list for "_SRSSNM_" ?  YES// " R ECYN:DTIME I '$T!(ECYN["^") S ECYN="N" Q
"RTN","SROWL",30,0)
 S ECYN=$E(ECYN) S:"y"[ECYN ECYN="Y"
"RTN","SROWL",31,0)
 I "YNn"'[ECYN D HELP G CHK
"RTN","SROWL",32,0)
 Q
"RTN","SROWL",33,0)
LIST ; list existing procedures for specialty selected
"RTN","SROWL",34,0)
 S SROPER=$P(^SRO(133.8,SRSS,1,SROFN,0),"^",2),SRDT=$P(^(0),"^",3),SROPDT=$P(^(0),"^",5),Y=SRDT D D^DIQ S SRDT=$E(Y,1,12) I SROPDT S Y=SROPDT D D^DIQ S SROPDT=$E(Y,1,12)
"RTN","SROWL",35,0)
 K SROP,MM,MMM S:$L(SROPER)<36 SROP(1)=SROPER I $L(SROPER)>35 S SROPER=SROPER_"  " S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROWL",36,0)
 W !,SRNM,?40,"Date Entered on List:",?66,SRDT,!,?3,SROP(1),?40,"Tentative Operation Date: ",?66,SROPDT
"RTN","SROWL",37,0)
 I $D(SROP(2)) W !,?3,SROP(2)
"RTN","SROWL",38,0)
 W !
"RTN","SROWL",39,0)
 Q
"RTN","SROWL",40,0)
LOOP ; break procedure if greater than 36 characters
"RTN","SROWL",41,0)
 S SROP(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROP(M))+$L(MM)'<36  S SROP(M)=SROP(M)_MM_" ",SROPER=MMM
"RTN","SROWL",42,0)
 Q
"RTN","SROWL",43,0)
REFPHY   ; Look up Referring Physician in "New Person" file with filter and auto-populate Referring Physician demographic fields
"RTN","SROWL",44,0)
 N SRCONT,Y,SRDEMO
"RTN","SROWL",45,0)
 S SRCONT=""
"RTN","SROWL",46,0)
PRMPT R !,"Is this a VA Physician from this facility?  (Y/N): <Y> ",SRCONT:DTIME I '$T Q
"RTN","SROWL",47,0)
 I SRCONT["?" D  G PRMPT
"RTN","SROWL",48,0)
 .W !!,"Enter 'Y' if you would like to select the Referring Physician from this facility's VA personnel.",!,"Enter 'N' to continue data entry.",!
"RTN","SROWL",49,0)
 S:SRCONT="" SRCONT="Y"
"RTN","SROWL",50,0)
 I SRCONT="^" S X="" Q
"RTN","SROWL",51,0)
 Q:(SRCONT'["Y")&(SRCONT'["y")
"RTN","SROWL",52,0)
 ; Store FileMan variables and arrays
"RTN","SROWL",53,0)
 M SRDABAK=DA,SRDICBAK=DIC,SRDZERO=D0,SRDRBAK=DR,SRXBAK=X,SRDOBAK=DO
"RTN","SROWL",54,0)
 ; Setup variables and call ^DIC to lookup REFERRING PHYSICIAN from NEW PERSON file
"RTN","SROWL",55,0)
 S DIC="^VA(200,",DIC(0)="E",DIC("B")=X
"RTN","SROWL",56,0)
 D ^DIC
"RTN","SROWL",57,0)
 ; Restore FileMan's variables and arrays
"RTN","SROWL",58,0)
 M DA=SRDABAK,DIC=SRDICBAK,D0=SRDZERO,DR=SRDRBAK,X=SRXBAK,DO=SRDOBAK
"RTN","SROWL",59,0)
 K SRCONT,SRDABAK,SRDICBAK,SRDZERO,SRDRBAK,SRXBAK,SRDOBAK
"RTN","SROWL",60,0)
 Q:Y="-1"        ; Quit if no record was selected from the NEW PERSON file
"RTN","SROWL",61,0)
 S SRNPREC=$P(Y,U,1)_","   ;The record number of the NEW PERSON file
"RTN","SROWL",62,0)
 ; Retrieve demographic data from the NEW PERSON file.
"RTN","SROWL",63,0)
 D GETS^DIQ(200,SRNPREC,".01:.116;.132","","SRDEMO")
"RTN","SROWL",64,0)
 ; Build SRDEMO array for "stuffing" into REFERRING PHYSICIAN demographic fields
"RTN","SROWL",65,0)
 S X=SRDEMO(200,SRNPREC,".01")                       ;Name
"RTN","SROWL",66,0)
 S SRDEMO(1)=SRDEMO(200,SRNPREC,".111")        ;Address
"RTN","SROWL",67,0)
 S:$L(SRDEMO(200,SRNPREC,".112"))>0 SRDEMO(1)=SRDEMO(1)_" "_SRDEMO(200,SRNPREC,".112")   ;Concatenate Address 2 to single address
"RTN","SROWL",68,0)
 S:$L(SRDEMO(200,SRNPREC,".113"))>0 SRDEMO(1)=SRDEMO(1)_" "_SRDEMO(200,SRNPREC,".113")   ;Concatenate Address 3 to single address
"RTN","SROWL",69,0)
 S SRDEMO(1)=$E(SRDEMO(1),1,75)
"RTN","SROWL",70,0)
 S SRDEMO(2)=SRDEMO(200,SRNPREC,".114")        ;City
"RTN","SROWL",71,0)
 S SRDEMO(3)=SRDEMO(200,SRNPREC,".115")        ;State
"RTN","SROWL",72,0)
 S SRDEMO(4)=SRDEMO(200,SRNPREC,".116")        ;Zip
"RTN","SROWL",73,0)
 S SRDEMO(5)=SRDEMO(200,SRNPREC,".132")        ;Office Phone
"RTN","SROWL",74,0)
 ; Set up DR array that FileMan will use, with a call to ^DIE, after this subroutine Quits to "stuff" the demographic data.
"RTN","SROWL",75,0)
 S DIC("DR")="1///"_SRDEMO(1)_";2///"_SRDEMO(2)_";3///"_SRDEMO(3)_";4///"_SRDEMO(4)_";5///"_SRDEMO(5)_";6///"_$P(Y,U,1)
"RTN","SROWL",76,0)
 S DIC(0)="Z"    ;Tells FileMan to file the data without any more user input
"RTN","SROWL",77,0)
 Q
"UP",130,130.03,-1)
130^18
"UP",130,130.03,0)
130.03
"UP",130,130.16,-1)
130^13
"UP",130,130.16,0)
130.16
"UP",130,130.165,-2)
130^13
"UP",130,130.165,-1)
130.16^OADX
"UP",130,130.165,0)
130.165
"UP",130,130.18,-1)
130^15
"UP",130,130.18,0)
130.18
"UP",130,130.213,-1)
130^50
"UP",130,130.213,0)
130.213
"UP",130,130.275,-1)
130^PADX
"UP",130,130.275,0)
130.275
"UP",130,130.3513,-1)
130^55
"UP",130,130.3513,0)
130.3513
"UP",133.8,133.801,-1)
133.8^1
"UP",133.8,133.801,0)
133.801
"UP",133.8,133.8013,-2)
133.8^1
"UP",133.8,133.8013,-1)
133.801^1
"UP",133.8,133.8013,0)
133.8013
"VER")
8.0^22.0
"^DD",130,130,.024,0)
COMBAT VET^S^1:YES;0:NO;^0;24^Q
"^DD",130,130,.024,.1)
Treatment related to Combat (Y/N)
"^DD",130,130,.024,1,0)
^.1
"^DD",130,130,.024,1,1,0)
130^APCE27^MUMPS
"^DD",130,130,.024,1,1,1)
D APCE^SROPCEX
"^DD",130,130,.024,1,1,2)
S SRFLD=.024 D KAPCE^SROPCEX
"^DD",130,130,.024,1,1,"%D",0)
^^2^2^3040210^
"^DD",130,130,.024,1,1,"%D",1,0)
This MUMPS cross reference maintains the APCE cross reference nodes used 
"^DD",130,130,.024,1,1,"%D",2,0)
in updating PCE.
"^DD",130,130,.024,1,1,"DT")
3040210
"^DD",130,130,.024,3)
If this case is treating a problem related to Combat, enter YES.
"^DD",130,130,.024,21,0)
^.001^3^3^3040210^^^^
"^DD",130,130,.024,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure 
"^DD",130,130,.024,21,2,0)
is treating a VA patient for a problem that is related to Combat.  This 
"^DD",130,130,.024,21,3,0)
information may be passed to the VISIT file (#9000010) for use by PCE.
"^DD",130,130,.024,"DT")
3040210
"^DD",130,130,.213,0)
ANES CARE TIME BLOCK^130.213DA^^50;0
"^DD",130,130,.213,21,0)
^.001^1^1^3040412^^^^
"^DD",130,130,.213,21,1,0)
This is the date and time for which anesthesia care is provided.
"^DD",130,130,.214,0)
ANES CARE BILLABLE TIME FLAG^S^1:YES;0:NO;^.2;17^Q
"^DD",130,130,.214,.1)
Anesthesia Care Billable Time Flag
"^DD",130,130,.214,3)
"Yes" indicates all anesthesia care time has been entered. "No" indicates time entry is not complete.
"^DD",130,130,.214,21,0)
^.001^4^4^3030806^^^
"^DD",130,130,.214,21,1,0)
This field is a flag that indicates all anesthesia care time has been 
"^DD",130,130,.214,21,2,0)
entered for a case.  It is used in calculating the total anesthesia 
"^DD",130,130,.214,21,3,0)
billable time.  "Yes" indicates all time has been entered. "No" indicates 
"^DD",130,130,.214,21,4,0)
time entry is not complete.
"^DD",130,130,.214,"DT")
3030905
"^DD",130,130,.218,0)
ANES CARE BILLABLE TIME^CJ8,0^^ ; ^S X=$$BILLTIME^SROANEST
"^DD",130,130,.218,.1)
Anesthesia Care Billable Time
"^DD",130,130,.218,9)
^
"^DD",130,130,.218,9.01)

"^DD",130,130,.218,9.1)
S X=$$BILLTIME^SROANEST
"^DD",130,130,.218,21,0)
^.001^3^3^3040311^^
"^DD",130,130,.218,21,1,0)
This is the total anesthesia care billable time in minutes. It is 
"^DD",130,130,.218,21,2,0)
calculated from all time intervals entered in the multiple anesthesia 
"^DD",130,130,.218,21,3,0)
start and end time fields..
"^DD",130,130,.218,"DT")
3040311
"^DD",130,130,.3511,0)
ANES PERSONALLY PERFORMED^SX^0:NO;1:YES;^.2;19^Q
"^DD",130,130,.3511,.1)
Anesthesiologist Personally Performed
"^DD",130,130,.3511,3)
Choose from: Y YES   N NO
"^DD",130,130,.3511,21,0)
^.001^2^2^3030908^^^^
"^DD",130,130,.3511,21,1,0)
Answer yes only if the anesthesiologist personally performed the entire 
"^DD",130,130,.3511,21,2,0)
anesthesia procedure.
"^DD",130,130,.3511,23,0)
^.001^3^3^3030908^^^^
"^DD",130,130,.3511,23,1,0)
Did the anesthesiologist personally perform the anesthesia care? This 
"^DD",130,130,.3511,23,2,0)
field only accepts and displays a "Y" for yes or "N" for no.  The set of 
"^DD",130,130,.3511,23,3,0)
codes  stores/translates 1 = YES and 0 = No.
"^DD",130,130,.3511,"DT")
3030908
"^DD",130,130,.3512,0)
NUM OF CONCURRENT ANES CASES^NJ1,0X^^.2;20^K:X<1!(X>9) X
"^DD",130,130,.3512,.1)
Number Of Concurrent Anesthesiology Cases
"^DD",130,130,.3512,3)
Enter the total number of concurrent anesthesia procedures to this anesthesia care including this care.  
"^DD",130,130,.3512,21,0)
^^8^8^3040505^
"^DD",130,130,.3512,21,1,0)
Including this case, enter the number of cases that the
"^DD",130,130,.3512,21,2,0)
anesthesiologist supervised where the time of the anesthesia
"^DD",130,130,.3512,21,3,0)
care overlapped with this care. This field is required to support
"^DD",130,130,.3512,21,4,0)
billing for the care and is critical for accurate coding of the
"^DD",130,130,.3512,21,5,0)
primary anesthesia procedure.  Enter a zero if the anesthesiologist
"^DD",130,130,.3512,21,6,0)
personally performed the care.  Enter 1 if the principal anesthetist
"^DD",130,130,.3512,21,7,0)
was not an anesthesiologist and was medically directed by an
"^DD",130,130,.3512,21,8,0)
anesthesiologist.  
"^DD",130,130,.3512,23,0)
^.001^2^2^3040505^^^^
"^DD",130,130,.3512,23,1,0)
Total number of concurrent cases the anesthesiologist supervised during 
"^DD",130,130,.3512,23,2,0)
this care? This field can contain only one digit.  
"^DD",130,130,.3512,"DT")
3030904
"^DD",130,130,.3513,0)
ANES CONCURRENT CASES^130.3513PA^^55;0
"^DD",130,130,.3513,21,0)
^.001^3^3^3041123^^
"^DD",130,130,.3513,21,1,0)
This field is for information only and is not required. It will assist in 
"^DD",130,130,.3513,21,2,0)
correcting potential errors if a start or end time is edited since other 
"^DD",130,130,.3513,21,3,0)
cases could be affected by the edit.
"^DD",130,130,.3513,23,0)
^.001^2^2^3041123^^
"^DD",130,130,.3513,23,1,0)
This field lists the concurrent anesthesia cases to this case by the 
"^DD",130,130,.3513,23,2,0)
SURGERY case number.
"^DD",130,130,.3514,0)
ANES MEDICALLY DIRECTED^SX^0:NO;1:YES;^.2;22^Q
"^DD",130,130,.3514,.1)
Anesthesiologist Medically Directed
"^DD",130,130,.3514,3)
Choose from Y YES   N NO
"^DD",130,130,.3514,21,0)
^.001^3^3^3030904^^^^
"^DD",130,130,.3514,21,1,0)
If the principal anesthetist was other than an anesthesiologist, answer 
"^DD",130,130,.3514,21,2,0)
yes if an anesthesiologist supervised the care.  Answering no indicates 
"^DD",130,130,.3514,21,3,0)
that the anesthetist was unsupervised.
"^DD",130,130,.3514,23,0)
^.001^3^3^3030904^^^
"^DD",130,130,.3514,23,1,0)
Was the CRNA medically directed by an anesthesiologist during this care? 
"^DD",130,130,.3514,23,2,0)
This field only accepts and displays a "Y" for yes or "N" for no.  The 
"^DD",130,130,.3514,23,3,0)
set of codes  stores/translates 1 = YES and 0 = NO.
"^DD",130,130,.3514,"DT")
3030908
"^DD",130,130,.3515,0)
ANES PHYSICIAN AVAILABLE^SX^0:NO;1:YES;^.2;23^Q
"^DD",130,130,.3515,.1)
Teaching Physician Present
"^DD",130,130,.3515,3)
Choose from Y YES   N NO
"^DD",130,130,.3515,21,0)
^.001^3^3^3030904^^^^
"^DD",130,130,.3515,21,1,0)
If the anesthetist was a resident, answer yes if the teaching physician 
"^DD",130,130,.3515,21,2,0)
was present during all key portions of the procedure and immediately 
"^DD",130,130,.3515,21,3,0)
available during the entire procedure.
"^DD",130,130,.3515,23,0)
^.001^4^4^3030904^^^^
"^DD",130,130,.3515,23,1,0)
Was the teaching physician present during all key portions of the 
"^DD",130,130,.3515,23,2,0)
procedure and immediately available during the entire procedure? This 
"^DD",130,130,.3515,23,3,0)
field only accepts and displays a "Y" for yes or "N" for no. The set of 
"^DD",130,130,.3515,23,4,0)
codes  stores/translates 1 = YES and 0 = NO.
"^DD",130,130,.3515,"DT")
3030908
"^DD",130,130,.42,0)
OTHER PROCEDURES^130.16A^^13;0
"^DD",130,130,.42,.1)
Other Operative Procedures (Same Specialty)
"^DD",130,130,.42,12)
QUICK LOOK-UP OF OPERATIONS IS BUILT FROM OPERATIONS PERFORMED AT THE HOSPITAL
"^DD",130,130,.42,12.1)
S DIC("S")="I $D(^SRS(""AOP"",""AC"",Y))"
"^DD",130,130,.42,21,0)
^^3^3^2911206^^
"^DD",130,130,.42,21,1,0)
This is information related to procedures performed in addition
"^DD",130,130,.42,21,2,0)
to the principal procedure.
"^DD",130,130,.42,21,3,0)
 
"^DD",130,130,.42,"DT")
2911206
"^DD",130,130,.74,0)
OTHER POSTOP DIAGS^130.18A^^15;0
"^DD",130,130,.74,.1)
Other Postoperative Diagnosis
"^DD",130,130,.74,21,0)
^.001^3^3^3040210^^^^
"^DD",130,130,.74,21,1,0)
This is information related to any postoperative diagnosis in addition
"^DD",130,130,.74,21,2,0)
to the principal postoperative diagnosis.
"^DD",130,130,.74,21,3,0)
 
"^DD",130,130,.74,"DT")
2921026
"^DD",130,130,23,0)
REFERRING PHYSICIAN^130.03A^^18;0
"^DD",130,130,23,.1)
Referring Physician/Medical Center
"^DD",130,130,23,21,0)
^.001^2^2^3031006^^^^
"^DD",130,130,23,21,1,0)
This is information related to the referring physician.
"^DD",130,130,23,21,2,0)
 
"^DD",130,130,26,0)
PRINCIPAL PROCEDURE^RFX^^OP;1^K:$L(X)>135!($L(X)<3) X D:$D(X) PROC^SROPROC,PCPTASO^SROADX2(0) K:$G(X)="" X
"^DD",130,130,26,.1)
Principal Procedure
"^DD",130,130,26,1,0)
^.1^^0
"^DD",130,130,26,3)
Your answer must be 3-135 characters in length and must not contain an up-arrow (^).
"^DD",130,130,26,21,0)
^^21^21^3040316^
"^DD",130,130,26,21,1,0)
This is the name of the principal procedure for this case. All cases 
"^DD",130,130,26,21,2,0)
must have a principal procedure.
"^DD",130,130,26,21,3,0)
 
"^DD",130,130,26,21,4,0)
The principal procedure must be 3 to 135 characters in length. The
"^DD",130,130,26,21,5,0)
procedure name must not contain a semicolon (;), an at-sign (@), an up-
"^DD",130,130,26,21,6,0)
arrow (^) or control characters. If the procedure name is longer than 
"^DD",130,130,26,21,7,0)
30 characters, it must contain at least one space in every 31
"^DD",130,130,26,21,8,0)
characters of length. If a comma is being used to separate information,
"^DD",130,130,26,21,9,0)
a space should follow the comma.
"^DD",130,130,26,21,10,0)
 
"^DD",130,130,26,21,11,0)
NSQIP Definition (2004):
"^DD",130,130,26,21,12,0)
The most complex of all the procedures by the primary operating team 
"^DD",130,130,26,21,13,0)
during this trip to the operating room. Your answer must be at least 3
"^DD",130,130,26,21,14,0)
characters in length. Do not enter an additional procedure if it is 
"^DD",130,130,26,21,15,0)
covered by a single CPT code. (Note that a single CPT code can cover 
"^DD",130,130,26,21,16,0)
more than one procedure, e.g., cholecystectomy and common bile duct 
"^DD",130,130,26,21,17,0)
exploration have a single CPT code). Additional procedures requiring 
"^DD",130,130,26,21,18,0)
separate CPT codes and/or concurrent procedures will be entered 
"^DD",130,130,26,21,19,0)
separately below. An exploratory laparotomy should be entered as the 
"^DD",130,130,26,21,20,0)
principal operative procedure only when no other procedure eligible for
"^DD",130,130,26,21,21,0)
assessment has been performed in that particular surgical case.  
"^DD",130,130,26,"DT")
3040915
"^DD",130,130,27,0)
PRINCIPAL PROCEDURE CODE^*P81'OX^ICPT(^OP;2^D IN^SROCPT S DIC("S")="I $$ACTIV^SROCPT($S($D(SRTN):SRTN,$D(DA):DA,1:""""),+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X D PCPTASO^SROADX2(1) K:$G(X)="" X
"^DD",130,130,27,.1)
Principal Procedure Code (CPT)
"^DD",130,130,27,1,0)
^.1
"^DD",130,130,27,1,1,0)
130^APCE2^MUMPS
"^DD",130,130,27,1,1,1)
D APCE^SROPCEX
"^DD",130,130,27,1,1,2)
S SRFLD=27 D KAPCE^SROPCEX
"^DD",130,130,27,1,1,"%D",0)
^^2^2^2960907^^^^
"^DD",130,130,27,1,1,"%D",1,0)
This MUMPS cross reference maintains the APCE cross reference nodes
"^DD",130,130,27,1,1,"%D",2,0)
used in updating PCE.
"^DD",130,130,27,1,1,"DT")
2960907
"^DD",130,130,27,1,2,0)
130^ACPT^MUMPS
"^DD",130,130,27,1,2,1)
D SPRIN^SROMOD
"^DD",130,130,27,1,2,2)
D KPRIN^SROMOD
"^DD",130,130,27,1,2,"%D",0)
^^20^20^2991029^^^
"^DD",130,130,27,1,2,"%D",1,0)
This MUMPS cross reference provides for updating CPT modifiers for the
"^DD",130,130,27,1,2,"%D",2,0)
principal procedure code.  CPT modifiers for the PRINCIPAL PROCEDURE CODE
"^DD",130,130,27,1,2,"%D",3,0)
field (#27) are stored in the PRIN. PROCEDURE CPT MODIFIER field (#.01) of
"^DD",130,130,27,1,2,"%D",4,0)
the PRIN. PROCEDURE CPT MODIFIER multiple field (#28) in SURGERY file
"^DD",130,130,27,1,2,"%D",5,0)
(#130).
"^DD",130,130,27,1,2,"%D",6,0)
 
"^DD",130,130,27,1,2,"%D",7,0)
After selecting a CPT code, this cross reference prompts the user for a
"^DD",130,130,27,1,2,"%D",8,0)
CPT modifier.  If a CPT modifier was entered concatenated with a hyphen to
"^DD",130,130,27,1,2,"%D",9,0)
the CPT code, this CPT modifier is displayed as a default modifier. Upon
"^DD",130,130,27,1,2,"%D",10,0)
entering a CPT modifier, the user is prompted for another CPT modifier
"^DD",130,130,27,1,2,"%D",11,0)
until the user makes a null entry. CPT modifier input is controlled by the
"^DD",130,130,27,1,2,"%D",12,0)
input transform on the PRIN. PROCEDURE CPT MODIFIER field (#28). At the
"^DD",130,130,27,1,2,"%D",13,0)
CPT modifier prompt, the user may to enter a question mark (?) to see a
"^DD",130,130,27,1,2,"%D",14,0)
list of CPT modifiers already entered and a list of acceptable CPT
"^DD",130,130,27,1,2,"%D",15,0)
modifiers to choose from.  If the user selects a modifier already entered,
"^DD",130,130,27,1,2,"%D",16,0)
the user may change or delete the modifier.  If a user enters a new CPT
"^DD",130,130,27,1,2,"%D",17,0)
code, replacing a previously entered CPT code, KILL logic on the ACPT
"^DD",130,130,27,1,2,"%D",18,0)
cross reference deletes any previously entered CPT modifiers for the old
"^DD",130,130,27,1,2,"%D",19,0)
CPT code before the SET logic prompts the user to enter CPT modifiers for
"^DD",130,130,27,1,2,"%D",20,0)
the new CPT code.
"^DD",130,130,27,1,2,"DT")
2990224
"^DD",130,130,27,2)
S Y(0)=Y D DISPLAY^SROCPT
"^DD",130,130,27,2.1)
D DISPLAY^SROCPT
"^DD",130,130,27,3)
Enter the CPT code for the principal procedure.
"^DD",130,130,27,12)
Screen out Inactive Codes
"^DD",130,130,27,12.1)
S DIC("S")="I $$ACTIV^SROCPT($S($D(SRTN):SRTN,$D(DA):DA,1:""""),+Y)"
"^DD",130,130,27,21,0)
^^13^13^3040316^
"^DD",130,130,27,21,1,0)
This is the Current Procedural Terminology (CPT) code corresponding 
"^DD",130,130,27,21,2,0)
with the principal procedure. A CPT modifier on the CPT code may be
"^DD",130,130,27,21,3,0)
included by appending the modifier to the CPT code separated by a
"^DD",130,130,27,21,4,0)
hyphen in the format "XXXXX-YY" where "XXXXX" is the five character CPT
"^DD",130,130,27,21,5,0)
code and "YY" is the two character CPT modifier.
"^DD",130,130,27,21,6,0)
 
"^DD",130,130,27,21,7,0)
NSQIP Definition (2004):
"^DD",130,130,27,21,8,0)
Provide or verify the CPT code. (In the VISTA Module, you can enter 
"^DD",130,130,27,21,9,0)
"?" and "YES" if you want the entire CPT list or you can enter the name
"^DD",130,130,27,21,10,0)
of the operation in word processing [e.g., cholecystectomy] if you want
"^DD",130,130,27,21,11,0)
to display possible CPT codes to use. This field should be verified
"^DD",130,130,27,21,12,0)
and, if need be, edited postoperatively by the Nurse Reviewer in
"^DD",130,130,27,21,13,0)
accordance with the official operating room log.
"^DD",130,130,27,"DT")
3040915
"^DD",130,130,27.5,0)
PRIN ASSOC DIAGNOSIS^130.275A^^PADX;0
"^DD",130,130,27.5,21,0)
^.001^2^2^3040227^^^^
"^DD",130,130,27.5,21,1,0)
This Surgery sub-file is used to store the Procedure/Diagnosis 
"^DD",130,130,27.5,21,2,0)
association data.
"^DD",130,130,27.5,"DT")
3040227
"^DD",130,130,32,0)
PRINCIPAL PRE-OP DIAGNOSIS^FX^^33;1^K:$L(X)>40!($L(X)<1) X D:$D(X) DIAG^SROUTL,PRINASO^SROADX2(0)
"^DD",130,130,32,.1)
Principal Preoperative Diagnosis
"^DD",130,130,32,1,0)
^.1
"^DD",130,130,32,1,1,0)
^^TRIGGER^130^34
"^DD",130,130,32,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^SRF(D0,34)):^(34),1:"") S X=$P(Y(1),U,1),X=X S DIU=X K Y S X=DIV S X=DIV X ^DD(130,32,1,1,1.4)
"^DD",130,130,32,1,1,1.4)
S DIH=$S($D(^SRF(DIV(0),34)):^(34),1:""),DIV=X S %=$P(DIH,U,2,999),DIU=$P(DIH,U,1),^(34)=DIV_$S(%]"":U_%,1:""),DIH=130,DIG=34 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",130,130,32,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^SRF(D0,34)):^(34),1:"") S X=$P(Y(1),U,1),X=X S DIU=X K Y X ^DD(130,32,1,1,2.1) X ^DD(130,32,1,1,2.4)
"^DD",130,130,32,1,1,2.1)
S X=DIV S Y(1)=$S($D(^SRF(D0,33)):^(33),1:"") S X=$P(Y(1),U,1)
"^DD",130,130,32,1,1,2.4)
S DIH=$S($D(^SRF(DIV(0),34)):^(34),1:""),DIV=X S %=$P(DIH,U,2,999),DIU=$P(DIH,U,1),^(34)=DIV_$S(%]"":U_%,1:""),DIH=130,DIG=34 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",130,130,32,1,1,"%D",0)
^.101^3^3^3031002^^^
"^DD",130,130,32,1,1,"%D",1,0)
This trigger on the PRINCIPAL PRE-OP DIAGNOSIS field stuffs the PRINCIPAL
"^DD",130,130,32,1,1,"%D",2,0)
POST-OP DIAGNOSIS field with what is entered as the PRINCIPAL PRE-OP
"^DD",130,130,32,1,1,"%D",3,0)
DIAGNOSIS.
"^DD",130,130,32,1,1,"CREATE VALUE")
PRINCIPAL PRE
"^DD",130,130,32,1,1,"DELETE VALUE")
PRINCIPAL PRE
"^DD",130,130,32,1,1,"FIELD")
PRINCIPAL PO
"^DD",130,130,32,1,2,0)
130^DADX1^MUMPS
"^DD",130,130,32,1,2,1)
Q
"^DD",130,130,32,1,2,2)
D DELASOC^SROADX2
"^DD",130,130,32,1,2,"%D",0)
^.101^1^1^3031014^^
"^DD",130,130,32,1,2,"%D",1,0)
This cross reference removes associations from diagnosis being deleted.
"^DD",130,130,32,1,2,"DT")
3031001
"^DD",130,130,32,3)
Your answer must be 1 to 40 characters in length.
"^DD",130,130,32,21,0)
^.001^2^2^3031014^^^^
"^DD",130,130,32,21,1,0)
This is the preoperative diagnosis for which the surgical procedure
"^DD",130,130,32,21,2,0)
is being performed.
"^DD",130,130,32,"DT")
3031006
"^DD",130,130,32.5,0)
PRIN PRE-OP ICD DIAGNOSIS CODE^*P80'^ICD9(^34;3^S DIC("S")="I $P(^(0),""^"",9)'=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",130,130,32.5,.1)
Prin Pre-OP ICD Diagnosis Code
"^DD",130,130,32.5,1,0)
^.1
"^DD",130,130,32.5,1,1,0)
130^APCE26^MUMPS
"^DD",130,130,32.5,1,1,1)
D APCE^SROPCEX
"^DD",130,130,32.5,1,1,2)
S SRFLD=32.5 D KAPCE^SROPCEX
"^DD",130,130,32.5,1,1,"%D",0)
^^2^2^3040210^
"^DD",130,130,32.5,1,1,"%D",1,0)
This MUMPS cross reference maintains the APCE cross reference nodes used 
"^DD",130,130,32.5,1,1,"%D",2,0)
in updating PCE.
"^DD",130,130,32.5,1,1,"DT")
3040210
"^DD",130,130,32.5,3)
Enter the ICD Diagnosis code for the principal Pre-OP diagnosis..
"^DD",130,130,32.5,12)
Screen prevents selection of inactive diagnosis.
"^DD",130,130,32.5,12.1)
S DIC("S")="I $P(^(0),""^"",9)'=1"
"^DD",130,130,32.5,21,0)
^.001^2^2^3040308^^^
"^DD",130,130,32.5,21,1,0)
This is the principal Pre-OP ICD diagnosis code.  It should be entered
"^DD",130,130,32.5,21,2,0)
for all cases and will be used for Surgery Central Office reporting needs.
"^DD",130,130,32.5,"DT")
3040210
"^DD",130,130,33,0)
PRINCIPAL DIAGNOSIS^FX^^33;2^K:$L(X)>40!($L(X)<1) X D:$D(X) DIAG^SROUTL,PRINASO^SROADX2(0) K:$G(X)="" X
"^DD",130,130,33,.1)
Principal Diagnosis
"^DD",130,130,33,1,0)
^.1
"^DD",130,130,33,1,1,0)
130^PADX1^MUMPS
"^DD",130,130,33,1,1,1)
Q
"^DD",130,130,33,1,1,2)
D PRINASOD^SROADX2
"^DD",130,130,33,1,1,"%D",0)
^.101^2^2^3031002^^^
"^DD",130,130,33,1,1,"%D",1,0)
THIS CROSS REFERENCE REMOVES ASSOCIATIONS TO PROCEDURES UPON EDITS OR 
"^DD",130,130,33,1,1,"%D",2,0)
DELETES OF THE DIAGNOSIS.
"^DD",130,130,33,1,1,"DT")
3031002
"^DD",130,130,33,3)
Answer must be 1-40 characters in length.
"^DD",130,130,33,21,0)
^.001^2^2^3031008^^
"^DD",130,130,33,21,1,0)
This is the principal diagnosis for which the non-OR procedure is being
"^DD",130,130,33,21,2,0)
performed.
"^DD",130,130,33,"DT")
3031006
"^DD",130,130,34,0)
PRINCIPAL POST-OP DIAG^FX^^34;1^K:$L(X)>40!($L(X)<1) X D:$D(X) DIAG^SROUTL,PRINASO^SROADX2(0) K:$G(X)="" X
"^DD",130,130,34,.1)
Principal Postoperative Diagnosis
"^DD",130,130,34,1,0)
^.1^^0
"^DD",130,130,34,3)
Your answer must be 1 to 40 characters in length.
"^DD",130,130,34,5,1,0)
130^32^1
"^DD",130,130,34,21,0)
^^1^1^2921026^^^^
"^DD",130,130,34,21,1,0)
This is the principal postoperative diagnosis.
"^DD",130,130,34,"DT")
3031006
"^DD",130,130,66,0)
PRIN DIAGNOSIS CODE^*P80'X^ICD9(^34;2^S DIC("S")="I $$ACTIV^SROICD($S($D(SRTN):SRTN,$D(DA):DA,1:""""),+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",130,130,66,.1)
Principal Diagnosis Code (ICD9)
"^DD",130,130,66,1,0)
^.1
"^DD",130,130,66,1,1,0)
130^APCE8^MUMPS
"^DD",130,130,66,1,1,1)
D APCE^SROPCEX
"^DD",130,130,66,1,1,2)
S SRFLD=66 D KAPCE^SROPCEX
"^DD",130,130,66,1,1,"%D",0)
^^2^2^2960906^^^^
"^DD",130,130,66,1,1,"%D",1,0)
This MUMPS cross reference maintains the APCE cross reference nodes
"^DD",130,130,66,1,1,"%D",2,0)
used in updating PCE.
"^DD",130,130,66,1,1,"DT")
2960906
"^DD",130,130,66,1,2,0)
130^PADX1^MUMPS
"^DD",130,130,66,1,2,1)
Q
"^DD",130,130,66,1,2,2)
D PRINASOD^SROADX2
"^DD",130,130,66,1,2,"%D",0)
^.101^2^2^3031015^^
"^DD",130,130,66,1,2,"%D",1,0)
This MUMPS cross reference removes associations to procedures upon edits 
"^DD",130,130,66,1,2,"%D",2,0)
or deletes of the diagnosis.
"^DD",130,130,66,1,2,"DT")
3031002
"^DD",130,130,66,3)
Enter the ICD Diagnosis code for the principal diagnosis.
"^DD",130,130,66,12)
Screen prevents selection of inactive diagnosis.
"^DD",130,130,66,12.1)
S DIC("S")="I $$ACTIV^SROICD($S($D(SRTN):SRTN,$D(DA):DA,1:""""),+Y)"
"^DD",130,130,66,21,0)
^^4^4^3040726^
"^DD",130,130,66,21,1,0)
NSQIP Definition (2004):
"^DD",130,130,66,21,2,0)
Enter the appropriate ICD-9-CM code corresponding to the condition 
"^DD",130,130,66,21,3,0)
noted in the Surgical Package as the postoperative diagnosis. This can
"^DD",130,130,66,21,4,0)
be obtained from the Surgical Package.
"^DD",130,130,66,"DT")
3040726
"^DD",130,130.03,0)
REFERRING PHYSICIAN SUB-FIELD^^6^7
"^DD",130,130.03,0,"NM","REFERRING PHYSICIAN")

"^DD",130,130.03,.01,0)
REFERRING PHYSICIAN^FX^^0;1^D REFPHY^SROWL K:$L(X)>50!($L(X)<1) X
"^DD",130,130.03,.01,.1)
Referring Physician/Medical Center
"^DD",130,130.03,.01,1,0)
^.1
"^DD",130,130.03,.01,1,1,0)
130.03^B
"^DD",130,130.03,.01,1,1,1)
S ^SRF(DA(1),18,"B",$E(X,1,30),DA)=""
"^DD",130,130.03,.01,1,1,2)
K ^SRF(DA(1),18,"B",$E(X,1,30),DA)
"^DD",130,130.03,.01,3)
Enter the name of the referring physician.  Your answer must be 1 to 50 characters long.
"^DD",130,130.03,.01,4)

"^DD",130,130.03,.01,21,0)
^.001^3^3^3030902^^^^
"^DD",130,130.03,.01,21,1,0)
This is the name of the referring physician, or medical center.  Although
"^DD",130,130.03,.01,21,2,0)
optional, this information may be useful in documentation of this case.
"^DD",130,130.03,.01,21,3,0)
 
"^DD",130,130.03,.01,"DEL",.01,0)
I $D(^SRF(DA(1),"CON")),$P(^("CON"),"^") D ^SROCOND I 0
"^DD",130,130.03,.01,"DT")
3031117
"^DD",130,130.03,6,0)
REF PHY 200 LINK^P200'^VA(200,^0;7^Q
"^DD",130,130.03,6,.1)
Pointer To NEW PERSON File (#200)
"^DD",130,130.03,6,3)
The VA record number of the Referring Physician.
"^DD",130,130.03,6,21,0)
^.001^3^3^3030904^^^^
"^DD",130,130.03,6,21,1,0)
Field (not accessed by the user) is a pointer to the NEW PERSON file. It 
"^DD",130,130.03,6,21,2,0)
is  populated when a Referring Physician is selected from the NEW PERSON 
"^DD",130,130.03,6,21,3,0)
file with the record number from NEW PERSON file.
"^DD",130,130.03,6,23,0)
^.001^3^3^3030904^^^^
"^DD",130,130.03,6,23,1,0)
Pointer Field (not accessed by the user) to the NEW PERSON file. It will 
"^DD",130,130.03,6,23,2,0)
be populated when and if the Referring Physician is selected from the NEW 
"^DD",130,130.03,6,23,3,0)
PERSON file (#200).
"^DD",130,130.03,6,"DT")
3030904
"^DD",130,130.16,0)
OTHER PROCEDURES SUB-FIELD^NL^5^6
"^DD",130,130.16,0,"NM","OTHER PROCEDURES")

"^DD",130,130.16,.01,0)
OTHER PROCEDURE^MFX^^0;1^K:$L(X)>50!($L(X)<1) X D:$D(X) PROC^SROPROC,OCPTASO^SROADX2(0) K:$G(X)="" X
"^DD",130,130.16,.01,.1)
Other Procedure (Same Specialty)
"^DD",130,130.16,.01,1,0)
^.1^^0
"^DD",130,130.16,.01,3)
Your answer must be 1 to 50 characters in length.
"^DD",130,130.16,.01,21,0)
^^8^8^3040316^
"^DD",130,130.16,.01,21,1,0)
NSQIP Definition (2004):
"^DD",130,130.16,.01,21,2,0)
An additional operative procedure performed by the same surgical team 
"^DD",130,130.16,.01,21,3,0)
(i.e., the same specialty/service) under the same anesthetic which has 
"^DD",130,130.16,.01,21,4,0)
a CPT code different from that of the Principal Operative Procedure
"^DD",130,130.16,.01,21,5,0)
(e.g., a splenectomy performed in the course of a cholecystectomy).  
"^DD",130,130.16,.01,21,6,0)
Your answer must be 1 to 50 characters in length. This field should be
"^DD",130,130.16,.01,21,7,0)
verified and, if need be, edited postoperatively by the Nurse Reviewer
"^DD",130,130.16,.01,21,8,0)
in accordance with the official operating room log.
"^DD",130,130.16,.01,"DEL",.01,0)
I $D(^SRF(DA(1),"CON")),$P(^("CON"),"^") D ^SROCOND I 0
"^DD",130,130.16,.01,"DT")
3041101
"^DD",130,130.16,3,0)
OTHER PROCEDURE CPT CODE^*P81'OX^ICPT(^2;1^D OCPTASO^SROADX2(1) K:X="" X D IN^SROCPT S DIC("S")="I $$ACTIV^SROCPT($S($D(SRTN):SRTN,$D(DA(1)):DA(1),1:""""),+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",130,130.16,3,.1)
CPT Code
"^DD",130,130.16,3,1,0)
^.1
"^DD",130,130.16,3,1,1,0)
130.16^APCE14^MUMPS
"^DD",130,130.16,3,1,1,1)
D APCE^SROPCEX
"^DD",130,130.16,3,1,1,2)
S SRFLD=.42 D KAPCE^SROPCEX
"^DD",130,130.16,3,1,1,"%D",0)
^^2^2^3050531^
"^DD",130,130.16,3,1,1,"%D",1,0)
This MUMPS cross reference maintains the APCE cross reference nodes used 
"^DD",130,130.16,3,1,1,"%D",2,0)
in updating PCE.
"^DD",130,130.16,3,1,1,"DT")
3050531
"^DD",130,130.16,3,1,2,0)
130.16^ACPT1^MUMPS
"^DD",130,130.16,3,1,2,1)
D SOTH^SROMOD
"^DD",130,130.16,3,1,2,2)
D KOTH^SROMOD
"^DD",130,130.16,3,1,2,"%D",0)
^^21^21^2990610^
"^DD",130,130.16,3,1,2,"%D",1,0)
This MUMPS cross reference provides for updating CPT modifiers for other
"^DD",130,130.16,3,1,2,"%D",2,0)
procedure CPT codes.  CPT modifiers for the OTHER PROCEDURE CPT CODE field
"^DD",130,130.16,3,1,2,"%D",3,0)
(#3) of the OTHER PROCEDURES multiple field (#.42) in SURGERY file (#130)
"^DD",130,130.16,3,1,2,"%D",4,0)
are stored in the OTHER PROCEDURE CPT MODIFIER field (#.01) of the OTHER
"^DD",130,130.16,3,1,2,"%D",5,0)
PROCEDURE CPT MODIFIER multiple field (#4) of the OTHER PROCEDURES
"^DD",130,130.16,3,1,2,"%D",6,0)
multiple field (#.42).
"^DD",130,130.16,3,1,2,"%D",7,0)
 
"^DD",130,130.16,3,1,2,"%D",8,0)
After selecting a CPT code, this cross reference prompts the user for a
"^DD",130,130.16,3,1,2,"%D",9,0)
CPT modifier.  If a CPT modifier was entered concatenated with a hyphen to
"^DD",130,130.16,3,1,2,"%D",10,0)
the CPT code, this CPT modifier is displayed as a default modifier. Upon
"^DD",130,130.16,3,1,2,"%D",11,0)
entering a CPT modifier, the user is prompted for another CPT modifier
"^DD",130,130.16,3,1,2,"%D",12,0)
until the user makes a null entry. CPT modifier input is controlled by the
"^DD",130,130.16,3,1,2,"%D",13,0)
input transform on the OTHER PROCEDURE CPT MODIFIER field (#.01 of
"^DD",130,130.16,3,1,2,"%D",14,0)
sub-file #130.164).  At the CPT modifier prompt, the user may enter a
"^DD",130,130.16,3,1,2,"%D",15,0)
question mark (?) to see a list of CPT modifiers already entered and a
"^DD",130,130.16,3,1,2,"%D",16,0)
list of acceptable CPT modifiers to choose from.  If the user selects a
"^DD",130,130.16,3,1,2,"%D",17,0)
modifier already entered, the user may change or delete the modifier.  If
"^DD",130,130.16,3,1,2,"%D",18,0)
a user enters a new CPT code, replacing a previously entered CPT code,
"^DD",130,130.16,3,1,2,"%D",19,0)
KILL logic on the ACPT1 cross reference deletes any previously entered CPT
"^DD",130,130.16,3,1,2,"%D",20,0)
modifiers for the old CPT code before the SET logic prompts the user to
"^DD",130,130.16,3,1,2,"%D",21,0)
enter CPT modifiers for the new CPT code.
"^DD",130,130.16,3,1,2,"DT")
2990225
"^DD",130,130.16,3,2)
S Y(0)=Y D OTHDISP^SROCPT
"^DD",130,130.16,3,2.1)
D OTHDISP^SROCPT
"^DD",130,130.16,3,3)
Enter the CPT code of this procedure.
"^DD",130,130.16,3,12)
Screen out Inactive Codes
"^DD",130,130.16,3,12.1)
S DIC("S")="I $$ACTIV^SROCPT($S($D(SRTN):SRTN,$D(DA(1)):DA(1),1:""""),+Y)"
"^DD",130,130.16,3,21,0)
^^5^5^2990517^
"^DD",130,130.16,3,21,1,0)
This is the Current Procedural Terminology (CPT) code corresponding to
"^DD",130,130.16,3,21,2,0)
this operative procedure.  A CPT modifier on the CPT code may be included
"^DD",130,130.16,3,21,3,0)
by appending the modifier to the CPT code separated by a hyphen in the
"^DD",130,130.16,3,21,4,0)
format "XXXXX-YY" where "XXXXX" is the five character CPT code and "YY" is
"^DD",130,130.16,3,21,5,0)
the two character CPT modifier.
"^DD",130,130.16,3,"DT")
3050531
"^DD",130,130.16,5,0)
OTHER ASSOC DIAGNOSIS^130.165A^^OADX;0
"^DD",130,130.16,5,21,0)
^.001^2^2^3040227^^^^
"^DD",130,130.16,5,21,1,0)
The OTHER ASSOC DIAGNOSIS is used to associate diagnoses to OTHER 
"^DD",130,130.16,5,21,2,0)
PROCEDURES.  This information is needed to generate a clean claim.
"^DD",130,130.16,5,"DT")
3040227
"^DD",130,130.165,0)
OTHER ASSOC DIAGNOSIS SUB-FIELD^^.01^1
"^DD",130,130.165,0,"DT")
3030815
"^DD",130,130.165,0,"IX","APCE25",130.165,.01)

"^DD",130,130.165,0,"IX","B",130.165,.01)

"^DD",130,130.165,0,"NM","OTHER ASSOC DIAGNOSIS")

"^DD",130,130.165,0,"UP")
130.16
"^DD",130,130.165,.01,0)
OTHER ASSOC DIAGNOSIS^NJ5,0^^0;1^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",130,130.165,.01,.1)
Other Associated Diagnosis
"^DD",130,130.165,.01,1,0)
^.1
"^DD",130,130.165,.01,1,1,0)
130.165^B
"^DD",130,130.165,.01,1,1,1)
S ^SRF(DA(2),13,DA(1),"OADX","B",$E(X,1,30),DA)=""
"^DD",130,130.165,.01,1,1,2)
K ^SRF(DA(2),13,DA(1),"OADX","B",$E(X,1,30),DA)
"^DD",130,130.165,.01,1,2,0)
130.165^APCE25^MUMPS
"^DD",130,130.165,.01,1,2,1)
D APCE^SROPCEX
"^DD",130,130.165,.01,1,2,2)
S SRFLD=130.165 D KAPCE^SROPCEX
"^DD",130,130.165,.01,1,2,"%D",0)
^^2^2^3050531^
"^DD",130,130.165,.01,1,2,"%D",1,0)
This MUMPS cross reference node ensures APCE is set if a diagnosis is 
"^DD",130,130.165,.01,1,2,"%D",2,0)
associated to a procedure.
"^DD",130,130.165,.01,1,2,"DT")
3050531
"^DD",130,130.165,.01,3)
The associated Diagnosis can only be added via the Surgery Menu options.
"^DD",130,130.165,.01,21,0)
^^2^2^3040227^
"^DD",130,130.165,.01,21,1,0)
The OTHER ASSOC DIAGNOSIS is used to associate diagnoses to OTHER 
"^DD",130,130.165,.01,21,2,0)
PROCEDURES.  This information is needed to generate a clean claim.
"^DD",130,130.165,.01,"DT")
3050531
"^DD",130,130.18,0)
OTHER POSTOP DIAGS SUB-FIELD^NL^10^11
"^DD",130,130.18,0,"NM","OTHER POSTOP DIAGS")

"^DD",130,130.18,.01,0)
OTHER POSTOP DIAGS^MFX^^0;1^K:$L(X)>40!($L(X)<1) X D:$D(X) DIAG^SROUTL,PDXCHK^SROADX2(0) K:$G(X)="" X
"^DD",130,130.18,.01,.1)
Other Postoperative Diagnosis
"^DD",130,130.18,.01,1,0)
^.1
"^DD",130,130.18,.01,1,1,0)
^^TRIGGER^130.18^4
"^DD",130,130.18,.01,1,1,1)
X ^DD(130.18,.01,1,1,1.3) I X S X=DIV S Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P(Y(1),U,1),X=X S DIU=X K Y S X=DIV S X=$P(^SRF(DA(1),0),U,16) X ^DD(130.18,.01,1,1,1.4)
"^DD",130,130.18,.01,1,1,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(2)=$C(59)_$P($G(^DD(130.18,4,0)),U,3),Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P($P(Y(2),$C(59)_$P(Y(1),U,1)_":",2),$C(59))=""
"^DD",130,130.18,.01,1,1,1.4)
S DIH=$G(^SRF(DIV(0),15,DIV(1),2)),DIV=X S $P(^(2),U,1)=DIV,DIH=130.18,DIG=4 D ^DICR
"^DD",130,130.18,.01,1,1,2)
Q
"^DD",130,130.18,.01,1,1,"CREATE CONDITION")
SERVICE CONNECTED=""
"^DD",130,130.18,.01,1,1,"CREATE VALUE")
S X=$P(^SRF(DA(1),0),U,16)
"^DD",130,130.18,.01,1,1,"DELETE VALUE")
NO EFFECT
"^DD",130,130.18,.01,1,1,"DT")
3030707
"^DD",130,130.18,.01,1,1,"FIELD")
SERVICE CONNECTED
"^DD",130,130.18,.01,1,2,0)
^^TRIGGER^130.18^10
"^DD",130,130.18,.01,1,2,1)
X ^DD(130.18,.01,1,2,1.3) I X S X=DIV S Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P(Y(1),U,7),X=X S DIU=X K Y S X=DIV S X=$P(^SRF(DA(1),0),U,24) X ^DD(130.18,.01,1,2,1.4)
"^DD",130,130.18,.01,1,2,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(2)=$C(59)_$P($G(^DD(130.18,10,0)),U,3),Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P($P(Y(2),$C(59)_$P(Y(1),U,7)_":",2),$C(59))=""
"^DD",130,130.18,.01,1,2,1.4)
S DIH=$G(^SRF(DIV(0),15,DIV(1),2)),DIV=X S $P(^(2),U,7)=DIV,DIH=130.18,DIG=10 D ^DICR
"^DD",130,130.18,.01,1,2,2)
Q
"^DD",130,130.18,.01,1,2,"CREATE CONDITION")
COMBAT VET=""
"^DD",130,130.18,.01,1,2,"CREATE VALUE")
S X=$P(^SRF(DA(1),0),U,24)
"^DD",130,130.18,.01,1,2,"DELETE VALUE")
NO EFFECT
"^DD",130,130.18,.01,1,2,"DT")
3040318
"^DD",130,130.18,.01,1,2,"FIELD")
COMBAT VET
"^DD",130,130.18,.01,1,3,0)
^^TRIGGER^130.18^5
"^DD",130,130.18,.01,1,3,1)
X ^DD(130.18,.01,1,3,1.3) I X S X=DIV S Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P(Y(1),U,2),X=X S DIU=X K Y S X=DIV S X=$P(^SRF(DA(1),0),U,17) X ^DD(130.18,.01,1,3,1.4)
"^DD",130,130.18,.01,1,3,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(2)=$C(59)_$P($G(^DD(130.18,5,0)),U,3),Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P($P(Y(2),$C(59)_$P(Y(1),U,2)_":",2),$C(59))=""
"^DD",130,130.18,.01,1,3,1.4)
S DIH=$G(^SRF(DIV(0),15,DIV(1),2)),DIV=X S $P(^(2),U,2)=DIV,DIH=130.18,DIG=5 D ^DICR
"^DD",130,130.18,.01,1,3,2)
Q
"^DD",130,130.18,.01,1,3,"CREATE CONDITION")
AGENT ORANGE=""
"^DD",130,130.18,.01,1,3,"CREATE VALUE")
S X=$P(^SRF(DA(1),0),U,17)
"^DD",130,130.18,.01,1,3,"DELETE VALUE")
NO EFFECT
"^DD",130,130.18,.01,1,3,"DT")
3040318
"^DD",130,130.18,.01,1,3,"FIELD")
AGENT ORANGE
"^DD",130,130.18,.01,1,4,0)
^^TRIGGER^130.18^6
"^DD",130,130.18,.01,1,4,1)
X ^DD(130.18,.01,1,4,1.3) I X S X=DIV S Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S X=$P(^SRF(DA(1),0),U,18) X ^DD(130.18,.01,1,4,1.4)
"^DD",130,130.18,.01,1,4,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(2)=$C(59)_$P($G(^DD(130.18,6,0)),U,3),Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P($P(Y(2),$C(59)_$P(Y(1),U,3)_":",2),$C(59))=""
"^DD",130,130.18,.01,1,4,1.4)
S DIH=$G(^SRF(DIV(0),15,DIV(1),2)),DIV=X S $P(^(2),U,3)=DIV,DIH=130.18,DIG=6 D ^DICR
"^DD",130,130.18,.01,1,4,2)
Q
"^DD",130,130.18,.01,1,4,"CREATE CONDITION")
IONIZING RADIATION EXPOSURE=""
"^DD",130,130.18,.01,1,4,"CREATE VALUE")
S X=$P(^SRF(DA(1),0),U,18)
"^DD",130,130.18,.01,1,4,"DELETE VALUE")
NO EFFECT
"^DD",130,130.18,.01,1,4,"DT")
3040318
"^DD",130,130.18,.01,1,4,"FIELD")
IONIZI
"^DD",130,130.18,.01,1,5,0)
^^TRIGGER^130.18^9
"^DD",130,130.18,.01,1,5,1)
X ^DD(130.18,.01,1,5,1.3) I X S X=DIV S Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P(Y(1),U,6),X=X S DIU=X K Y S X=DIV S X=$P(^SRF(DA(1),0),U,19) X ^DD(130.18,.01,1,5,1.4)
"^DD",130,130.18,.01,1,5,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(2)=$C(59)_$P($G(^DD(130.18,9,0)),U,3),Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P($P(Y(2),$C(59)_$P(Y(1),U,6)_":",2),$C(59))=""
"^DD",130,130.18,.01,1,5,1.4)
S DIH=$G(^SRF(DIV(0),15,DIV(1),2)),DIV=X S $P(^(2),U,6)=DIV,DIH=130.18,DIG=9 D ^DICR
"^DD",130,130.18,.01,1,5,2)
Q
"^DD",130,130.18,.01,1,5,"CREATE CONDITION")
ENVIRONMENTAL CONTAMINANTS=""
"^DD",130,130.18,.01,1,5,"CREATE VALUE")
S X=$P(^SRF(DA(1),0),U,19)
"^DD",130,130.18,.01,1,5,"DELETE VALUE")
NO EFFECT
"^DD",130,130.18,.01,1,5,"DT")
3040318
"^DD",130,130.18,.01,1,5,"FIELD")
ENVI
"^DD",130,130.18,.01,1,6,0)
^^TRIGGER^130.18^7
"^DD",130,130.18,.01,1,6,1)
X ^DD(130.18,.01,1,6,1.3) I X S X=DIV S Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S X=$P(^SRF(DA(1),0),U,22) X ^DD(130.18,.01,1,6,1.4)
"^DD",130,130.18,.01,1,6,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(2)=$C(59)_$P($G(^DD(130.18,7,0)),U,3),Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P($P(Y(2),$C(59)_$P(Y(1),U,4)_":",2),$C(59))=""
"^DD",130,130.18,.01,1,6,1.4)
S DIH=$G(^SRF(DIV(0),15,DIV(1),2)),DIV=X S $P(^(2),U,4)=DIV,DIH=130.18,DIG=7 D ^DICR
"^DD",130,130.18,.01,1,6,2)
Q
"^DD",130,130.18,.01,1,6,"CREATE CONDITION")
MILITARY SEXUAL TRAUMA=""
"^DD",130,130.18,.01,1,6,"CREATE VALUE")
S X=$P(^SRF(DA(1),0),U,22)
"^DD",130,130.18,.01,1,6,"DELETE VALUE")
NO EFFECT
"^DD",130,130.18,.01,1,6,"DT")
3040318
"^DD",130,130.18,.01,1,6,"FIELD")
MILITARY
"^DD",130,130.18,.01,1,7,0)
^^TRIGGER^130.18^8
"^DD",130,130.18,.01,1,7,1)
X ^DD(130.18,.01,1,7,1.3) I X S X=DIV S Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P(Y(1),U,5),X=X S DIU=X K Y S X=DIV S X=$P(^SRF(DA(1),0),U,23) X ^DD(130.18,.01,1,7,1.4)
"^DD",130,130.18,.01,1,7,1.3)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(0)=X S Y(2)=$C(59)_$P($G(^DD(130.18,8,0)),U,3),Y(1)=$S($D(^SRF(D0,15,D1,2)):^(2),1:"") S X=$P($P(Y(2),$C(59)_$P(Y(1),U,5)_":",2),$C(59))=""
"^DD",130,130.18,.01,1,7,1.4)
S DIH=$G(^SRF(DIV(0),15,DIV(1),2)),DIV=X S $P(^(2),U,5)=DIV,DIH=130.18,DIG=8 D ^DICR
"^DD",130,130.18,.01,1,7,2)
Q
"^DD",130,130.18,.01,1,7,"CREATE CONDITION")
HEAD AND/OR NECK CANCER=""
"^DD",130,130.18,.01,1,7,"CREATE VALUE")
S X=$P(^SRF(DA(1),0),U,23)
"^DD",130,130.18,.01,1,7,"DELETE VALUE")
NO EFFECT
"^DD",130,130.18,.01,1,7,"DT")
3040318
"^DD",130,130.18,.01,1,7,"FIELD")
HEAD
"^DD",130,130.18,.01,1,8,0)
130.18^DADX1^MUMPS
"^DD",130,130.18,.01,1,8,1)
Q
"^DD",130,130.18,.01,1,8,2)
D DELASOC^SROADX2
"^DD",130,130.18,.01,1,8,"%D",0)
^^2^2^3040318^
"^DD",130,130.18,.01,1,8,"%D",1,0)
This MUMPS cross reference removes associations to procedures upon edits 
"^DD",130,130.18,.01,1,8,"%D",2,0)
or deletes of the diagnosis.
"^DD",130,130.18,.01,1,8,"DT")
3040318
"^DD",130,130.18,.01,1,9,0)
130.18^APCE28^MUMPS
"^DD",130,130.18,.01,1,9,1)
D APCE^SROPCEX
"^DD",130,130.18,.01,1,9,2)
S SRFLD=.74 D KAPCE^SROPCEX
"^DD",130,130.18,.01,1,9,"%D",0)
^^2^2^3040603^
"^DD",130,130.18,.01,1,9,"%D",1,0)
This MUMPS cross reference maintains the APCE cross reference nodes used 
"^DD",130,130.18,.01,1,9,"%D",2,0)
in updating PCE.
"^DD",130,130.18,.01,1,9,"DT")
3040603
"^DD",130,130.18,.01,3)
Your answer must be 1 to 40 characters in length.
"^DD",130,130.18,.01,21,0)
^.001^3^3^3030917^^^^
"^DD",130,130.18,.01,21,1,0)
This is the name of a postoperative diagnosis other than the principal
"^DD",130,130.18,.01,21,2,0)
postoperative diagnosis.
"^DD",130,130.18,.01,21,3,0)
 
"^DD",130,130.18,.01,"DT")
3040603
"^DD",130,130.18,3,0)
ICD DIAGNOSIS CODE^*P80'X^ICD9(^0;3^S DIC("S")="I $$ACTIV^SROICD($S($D(SRTN):SRTN,$D(DA(1)):DA(1),1:""""),+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",130,130.18,3,.1)
ICD Diagnosis Code
"^DD",130,130.18,3,1,0)
^.1
"^DD",130,130.18,3,1,1,0)
130^APCE15^MUMPS
"^DD",130,130.18,3,1,1,1)
D APCE^SROPCEX
"^DD",130,130.18,3,1,1,2)
S SRFLD=.74 D KAPCE^SROPCEX
"^DD",130,130.18,3,1,1,"%D",0)
^^2^2^2960907^
"^DD",130,130.18,3,1,1,"%D",1,0)
This MUMPS cross reference maintains the APCE cross reference nodes
"^DD",130,130.18,3,1,1,"%D",2,0)
used in updating PCE.
"^DD",130,130.18,3,1,1,"DT")
2960907
"^DD",130,130.18,3,1,2,0)
130.18^PADX^MUMPS
"^DD",130,130.18,3,1,2,1)
Q
"^DD",130,130.18,3,1,2,2)
D DELASOC^SROADX2
"^DD",130,130.18,3,1,2,"%D",0)
^^2^2^3031014^
"^DD",130,130.18,3,1,2,"%D",1,0)
This MUMPS cross reference removes associations to procedures upon edits 
"^DD",130,130.18,3,1,2,"%D",2,0)
or deletes of the diagnosis.
"^DD",130,130.18,3,1,2,"DT")
3030923
"^DD",130,130.18,3,3)
Enter the ICD Diagnosis Code that corresponds to this diagnosis.
"^DD",130,130.18,3,12)
Screen prevents selection of inactive diagnosis.
"^DD",130,130.18,3,12.1)
S DIC("S")="I $$ACTIV^SROICD($S($D(SRTN):SRTN,$D(DA(1)):DA(1),1:""""),+Y)"
"^DD",130,130.18,3,21,0)
^^4^4^2921106^^
"^DD",130,130.18,3,21,1,0)
This is the ICD Diagnosis Code that corresponds with this postoperative
"^DD",130,130.18,3,21,2,0)
diagnosis.  Although optional, this information may be useful in the
"^DD",130,130.18,3,21,3,0)
documentation of this case.
"^DD",130,130.18,3,21,4,0)
 
"^DD",130,130.18,3,"DT")
3030411
"^DD",130,130.18,4,0)
SERVICE CONNECTED^RS^0:NO;1:YES;^2;1^Q
"^DD",130,130.18,4,.1)
Treatment related to Service Connected condition (Y/N)
"^DD",130,130.18,4,3)
If this case is treating a service connected problem, enter YES. 
"^DD",130,130.18,4,5,1,0)
130.18^.01^1
"^DD",130,130.18,4,21,0)
^^3^3^3040210^
"^DD",130,130.18,4,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure   
"^DD",130,130.18,4,21,2,0)
is treating a VA patient for a service connected problem.  This
"^DD",130,130.18,4,21,3,0)
information may be passed to the VISIT file (#9000010) for use by PCE.
"^DD",130,130.18,4,"DT")
3030812
"^DD",130,130.18,5,0)
AGENT ORANGE EXPOSURE^RS^1:YES;0:NO;^2;2^Q
"^DD",130,130.18,5,.1)
Treatment related to Agent Orange Exposure (Y/N)
"^DD",130,130.18,5,3)
If this case is treating an agent orange exposure problem, enter YES. 
"^DD",130,130.18,5,5,1,0)
130.18^.01^3
"^DD",130,130.18,5,21,0)
^^4^4^3040210^
"^DD",130,130.18,5,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure
"^DD",130,130.18,5,21,2,0)
is treating a VA patient for a problem that is related to Agent Orange
"^DD",130,130.18,5,21,3,0)
Exposure.  This information may be passed to the VISIT file (#9000010) for
"^DD",130,130.18,5,21,4,0)
use by PCE.
"^DD",130,130.18,5,"DT")
3030812
"^DD",130,130.18,6,0)
IONIZING RADIATION EXPOSURE^RS^1:YES;0:NO;^2;3^Q
"^DD",130,130.18,6,.1)
Treatment related to Ionizing Radiation Exposure (Y/N)
"^DD",130,130.18,6,3)
If this case is treating an Ionizing Radiation Exposure problem, enter YES. 
"^DD",130,130.18,6,5,1,0)
130.18^.01^4
"^DD",130,130.18,6,21,0)
^^4^4^3040210^
"^DD",130,130.18,6,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure is
"^DD",130,130.18,6,21,2,0)
treating a VA patient for a problem that is related to Ionizing Radiation
"^DD",130,130.18,6,21,3,0)
Exposure.  This information may be passed to the VISIT file (#9000010) for
"^DD",130,130.18,6,21,4,0)
use by PCE.
"^DD",130,130.18,6,"DT")
3030812
"^DD",130,130.18,7,0)
MILITARY SEXUAL TRAUMA^RS^0:NO;1:YES;^2;4^Q
"^DD",130,130.18,7,.1)
Treatment related to Military Sexual Trauma (Y/N)
"^DD",130,130.18,7,3)
If this case is treating a problem related to Military Sexual Trauma, enter YES.
"^DD",130,130.18,7,5,1,0)
130.18^.01^6
"^DD",130,130.18,7,21,0)
^^4^4^3040210^
"^DD",130,130.18,7,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure is
"^DD",130,130.18,7,21,2,0)
treating a VA patient for a problem that is related to Military Sexual
"^DD",130,130.18,7,21,3,0)
Trauma.  This information may be passed to the VISIT file (#9000010) for
"^DD",130,130.18,7,21,4,0)
use by PCE.
"^DD",130,130.18,7,"DT")
3030812
"^DD",130,130.18,8,0)
HEAD AND/OR NECK CANCER^RS^0:NO;1:YES;^2;5^Q
"^DD",130,130.18,8,.1)
Treatment related to Head and/or Neck Cancer (Y/N)
"^DD",130,130.18,8,3)
If this case is treating a problem related to Head and/or Neck Cancer, enter YES.
"^DD",130,130.18,8,5,1,0)
130.18^.01^7
"^DD",130,130.18,8,21,0)
^^4^4^3040210^
"^DD",130,130.18,8,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure is
"^DD",130,130.18,8,21,2,0)
treating a VA patient for a problem that is related to Head and/or Neck
"^DD",130,130.18,8,21,3,0)
Cancer.  This information may be passed to the VISIT file (#9000010) for
"^DD",130,130.18,8,21,4,0)
use by PCE.
"^DD",130,130.18,8,"DT")
3030812
"^DD",130,130.18,9,0)
ENVIRONMENTAL CONTAMINANTS^RS^0:NO;1:YES;^2;6^Q
"^DD",130,130.18,9,.1)
Treatment related to Environmental Contaminants (Y/N)
"^DD",130,130.18,9,3)
If this case is treating an Environment Contaminants problem enter YES.
"^DD",130,130.18,9,5,1,0)
130.18^.01^5
"^DD",130,130.18,9,21,0)
^^4^4^3040210^
"^DD",130,130.18,9,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure 
"^DD",130,130.18,9,21,2,0)
is treating a VA patient for a problem that is related to Environmental  
"^DD",130,130.18,9,21,3,0)
Contaminants.  This information may be passed to the VISIT file 
"^DD",130,130.18,9,21,4,0)
(#9000010) for use by PCE.
"^DD",130,130.18,9,"DT")
3030812
"^DD",130,130.18,10,0)
COMBAT VET^RS^0:NO;1:YES;^2;7^Q
"^DD",130,130.18,10,.1)
Treatment related to Combat (Y/N)
"^DD",130,130.18,10,3)
If this case is treating a problem related to Combat, enter YES.
"^DD",130,130.18,10,5,1,0)
130.18^.01^2
"^DD",130,130.18,10,21,0)
^.001^3^3^3040210^^
"^DD",130,130.18,10,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure 
"^DD",130,130.18,10,21,2,0)
is treating a VA patient for a problem that is related to Combat.  This 
"^DD",130,130.18,10,21,3,0)
information may be passed to the VISIT file (#9000010) for use by PCE.
"^DD",130,130.18,10,"DT")
3040210
"^DD",130,130.213,0)
ANES CARE TIME BLOCK SUB-FIELD^^1^2
"^DD",130,130.213,0,"DT")
3030620
"^DD",130,130.213,0,"IX","B",130.213,.01)

"^DD",130,130.213,0,"NM","ANES CARE TIME BLOCK")

"^DD",130,130.213,0,"UP")
130
"^DD",130,130.213,.01,0)
ANES CARE MULTIPLE START TIME^DX^^0;1^I $D(X) K %DT,Z S %DT="ERTX" D ^%DT S X=Y K:Y<1 X D STIME^SROANEST I $D(X),$D(^SRF(DA(1),"CON")),$P(^("CON"),"^") S SRFLD=.01,SRFLAG=1 D ^SROCON Q
"^DD",130,130.213,.01,.1)
Anesthesia Care Multiple Start Time
"^DD",130,130.213,.01,1,0)
^.1
"^DD",130,130.213,.01,1,1,0)
130.213^B
"^DD",130,130.213,.01,1,1,1)
S ^SRF(DA(1),50,"B",$E(X,1,30),DA)=""
"^DD",130,130.213,.01,1,1,2)
K ^SRF(DA(1),50,"B",$E(X,1,30),DA)
"^DD",130,130.213,.01,1,2,0)
130^AG^MUMPS
"^DD",130,130.213,.01,1,2,1)
D CSET^SROANEST
"^DD",130,130.213,.01,1,2,2)
D DEL^SROANEST
"^DD",130,130.213,.01,1,2,"%D",0)
^^6^6^3040412^
"^DD",130,130.213,.01,1,2,"%D",1,0)
The set cross reference is used to update the value of ANES
"^DD",130,130.213,.01,1,2,"%D",2,0)
CARE START TIME, field .21.
"^DD",130,130.213,.01,1,2,"%D",3,0)
 
"^DD",130,130.213,.01,1,2,"%D",4,0)
The delete cross reference is used to delete the value in ANES CARE START 
"^DD",130,130.213,.01,1,2,"%D",5,0)
TIME, FIELD .21, when the first ANES CARE MULTIPLE START TIME value is 
"^DD",130,130.213,.01,1,2,"%D",6,0)
deleted.
"^DD",130,130.213,.01,1,2,"DT")
3040412
"^DD",130,130.213,.01,3)
Enter the time a member of the Anesthesia staff begins preparing the patient for surgery in the O.R. suite or if the care is interrupted, the time the care resumes.
"^DD",130,130.213,.01,7.5)
S SRFLAG=1 D SINPUT^SROANEST
"^DD",130,130.213,.01,21,0)
^.001^7^7^3040311^^
"^DD",130,130.213,.01,21,1,0)
This is the date and time that this block of anesthesia care began or
"^DD",130,130.213,.01,21,2,0)
if the care is interrupted, the time the care resumed.  It is required
"^DD",130,130.213,.01,21,3,0)
as part of the anesthesia report. The definition of what constitutes
"^DD",130,130.213,.01,21,4,0)
the time anesthesia care begins may vary depending on local anesthesia 
"^DD",130,130.213,.01,21,5,0)
policy. Anesthesia care starts when the anesthesia practitioner begins 
"^DD",130,130.213,.01,21,6,0)
to prepare the patient for anesthesia services in the operating room or 
"^DD",130,130.213,.01,21,7,0)
an equivalent area.
"^DD",130,130.213,.01,"DT")
3040412
"^DD",130,130.213,1,0)
ANES CARE MULTIPLE END TIME^DX^^0;2^D SINPUT^SROANEST I $D(X) K %DT,Z S %DT="ERTX" D ^%DT S X=Y K:Y<1 X D FINALT^SROANEST I $D(X),$D(^SRF(DA(1),"CON")),$P(^("CON"),"^") S SRFLD=1,SRFLAG=1 D ^SROCON Q
"^DD",130,130.213,1,.1)
Anesthesia Care Multiple End Time
"^DD",130,130.213,1,1,0)
^.1
"^DD",130,130.213,1,1,1,0)
130^AJ^MUMPS
"^DD",130,130.213,1,1,1,1)
D CSET^SROANEST
"^DD",130,130.213,1,1,1,2)
D DEL^SROANEST
"^DD",130,130.213,1,1,1,"%D",0)
^^6^6^3040412^
"^DD",130,130.213,1,1,1,"%D",1,0)
The set cross reference is used to update the value of ANES CARE END 
"^DD",130,130.213,1,1,1,"%D",2,0)
TIME, field .24.
"^DD",130,130.213,1,1,1,"%D",3,0)
 
"^DD",130,130.213,1,1,1,"%D",4,0)
The delete cross reference is used to delete the value in ANES CARE END 
"^DD",130,130.213,1,1,1,"%D",5,0)
TIME, field .24, when the last ANES CARE MULTIPLE END TIME value is 
"^DD",130,130.213,1,1,1,"%D",6,0)
deleted.
"^DD",130,130.213,1,1,1,"DT")
3040412
"^DD",130,130.213,1,3)
Enter the time that the anesthesia staff transfers care to other care providers or the time that care has been interrupted.
"^DD",130,130.213,1,21,0)
^^5^5^3040311^
"^DD",130,130.213,1,21,1,0)
This is the date and time that anesthesia care ends or is interrupted. 
"^DD",130,130.213,1,21,2,0)
Its definition may vary according to local anesthesia policy. It ends
"^DD",130,130.213,1,21,3,0)
when the anesthesia practitioner is no longer furnishing anesthesia
"^DD",130,130.213,1,21,4,0)
services to the patient, that is, when the patient may be placed safely
"^DD",130,130.213,1,21,5,0)
under postoperative care.
"^DD",130,130.213,1,"DT")
3040412
"^DD",130,130.275,0)
PRIN ASSOC DIAGNOSIS SUB-FIELD^^.01^1
"^DD",130,130.275,0,"DT")
3030815
"^DD",130,130.275,0,"IX","APCE24",130.275,.01)

"^DD",130,130.275,0,"IX","B",130.275,.01)

"^DD",130,130.275,0,"NM","PRIN ASSOC DIAGNOSIS")

"^DD",130,130.275,0,"UP")
130
"^DD",130,130.275,.01,0)
PRIN ASSOC DIAGNOSIS^NJ5,0^^0;1^K:+X'=X!(X>99999)!(X<0)!(X?.E1"."1N.N) X
"^DD",130,130.275,.01,.1)
Pointer To ICD DIAGNOSIS File (#80)
"^DD",130,130.275,.01,1,0)
^.1
"^DD",130,130.275,.01,1,1,0)
130.275^APCE24^MUMPS
"^DD",130,130.275,.01,1,1,1)
D APCE^SROPCEX
"^DD",130,130.275,.01,1,1,2)
S SRFLD=130.275 D KAPCE^SROPCEX
"^DD",130,130.275,.01,1,1,"%D",0)
^^2^2^3030916^
"^DD",130,130.275,.01,1,1,"%D",1,0)
This MUMPS cross reference maintains the APCE cross reference nodes used 
"^DD",130,130.275,.01,1,1,"%D",2,0)
in updating PCE.
"^DD",130,130.275,.01,1,1,"DT")
3030916
"^DD",130,130.275,.01,1,2,0)
130.275^B
"^DD",130,130.275,.01,1,2,1)
S ^SRF(DA(1),"PADX","B",$E(X,1,30),DA)=""
"^DD",130,130.275,.01,1,2,2)
K ^SRF(DA(1),"PADX","B",$E(X,1,30),DA)
"^DD",130,130.275,.01,1,2,"DT")
3030915
"^DD",130,130.275,.01,3)
This field can only be changed via the Surgery Menu.  All entries outside of the Surgery menu will not be filed.
"^DD",130,130.275,.01,21,0)
^.001^3^3^3040227^^^^
"^DD",130,130.275,.01,21,1,0)
This field holds the IEN of the associated diagnosis.  It is used to 
"^DD",130,130.275,.01,21,2,0)
store the Procedure/Diagnosis association data needed to create a clean 
"^DD",130,130.275,.01,21,3,0)
claim.  This field can only be changed via the Surgery menu.
"^DD",130,130.275,.01,"DT")
3040227
"^DD",130,130.3513,0)
ANES CONCURRENT CASES SUB-FIELD^^.01^1
"^DD",130,130.3513,0,"DT")
3041123
"^DD",130,130.3513,0,"IX","B",130.3513,.01)

"^DD",130,130.3513,0,"NM","ANES CONCURRENT CASES")

"^DD",130,130.3513,0,"UP")
130
"^DD",130,130.3513,.01,0)
ANES CONCURRENT CASES^P130'^SRF(^0;1^Q
"^DD",130,130.3513,.01,1,0)
^.1
"^DD",130,130.3513,.01,1,1,0)
130.3513^B
"^DD",130,130.3513,.01,1,1,1)
S ^SRF(DA(1),55,"B",$E(X,1,30),DA)=""
"^DD",130,130.3513,.01,1,1,2)
K ^SRF(DA(1),55,"B",$E(X,1,30),DA)
"^DD",130,130.3513,.01,3)
Enter the Surgery Package case numbers of the surgical cases that were concurrent to this one. 
"^DD",130,130.3513,.01,21,0)
^.001^3^3^3041123^^
"^DD",130,130.3513,.01,21,1,0)
This field is for information only and is not required. It will assist in 
"^DD",130,130.3513,.01,21,2,0)
correcting potential errors if a start or end time is edited since other 
"^DD",130,130.3513,.01,21,3,0)
cases could be affected by the edit.
"^DD",130,130.3513,.01,23,0)
^^2^2^3041123^
"^DD",130,130.3513,.01,23,1,0)
This field lists the concurrent anesthesia cases to this case by the 
"^DD",130,130.3513,.01,23,2,0)
SURGERY case number.
"^DD",130,130.3513,.01,"DT")
3041123
"^DD",133,133,18,0)
UPDATES TO PCE^SI^O:OUTPATIENT ONLY;A:ALL CASES;N:PCE NOT UPDATED;^0;15^Q
"^DD",133,133,18,.1)
Updates to PCE
"^DD",133,133,18,3)
Enter the site's preference for PCE updating.
"^DD",133,133,18,21,0)
^.001^5^5^3040112^^^^
"^DD",133,133,18,21,1,0)
This indicates the site's preference for PCE updating.  If this field
"^DD",133,133,18,21,2,0)
contains O, PCE will be updated with outpatient case information only.  If
"^DD",133,133,18,21,3,0)
this field contains A, PCE will be updated information from all cases,
"^DD",133,133,18,21,4,0)
both inpatient and outpatient.  If this field contains N or is null, no
"^DD",133,133,18,21,5,0)
PCE updating will occur.
"^DD",133,133,18,"DT")
3040217
"^DD",133,133,19,0)
ASK CLASSIFICATION QUESTIONS^SI^1:YES;0:NO;^0;16^Q
"^DD",133,133,19,.1)
Ask Classification Questions
"^DD",133,133,19,3)
Enter YES if classification questions should be asked when requesting a case.
"^DD",133,133,19,21,0)
^^3^3^2960905^
"^DD",133,133,19,21,1,0)
This field indicates whether the patient service connected classification
"^DD",133,133,19,21,2,0)
questions should be asked when entering a new case or when updating an
"^DD",133,133,19,21,3,0)
existing case.
"^DD",133,133,19,"DT")
3040505
"^DD",133.8,133.801,3,0)
REFERRING PHYSICIAN^133.8013A^^1;0
"^DD",133.8,133.801,3,.1)
Name of the Referring Physician/Medical Center
"^DD",133.8,133.801,3,21,0)
^.001^3^3^3030904^^^^
"^DD",133.8,133.801,3,21,1,0)
This is the name of the referring physician.  Information related
"^DD",133.8,133.801,3,21,2,0)
to the referring physician is optional.
"^DD",133.8,133.801,3,21,3,0)
 
"^DD",133.8,133.801,3,"DT")
3030805
"^DD",133.8,133.801,23,0)
COMBAT VET^S^1:YES;0:NO;^0;23^Q
"^DD",133.8,133.801,23,.1)
Treatment related to Combat (Y/N)
"^DD",133.8,133.801,23,3)
If this case is treating a problem related to Combat, enter YES.
"^DD",133.8,133.801,23,21,0)
^.001^3^3^3040210^^^
"^DD",133.8,133.801,23,21,1,0)
This field will be used to indicate if this surgery or non-OR procedure 
"^DD",133.8,133.801,23,21,2,0)
is treating a VA patient for a problem that is related to Combat.  This 
"^DD",133.8,133.801,23,21,3,0)
information may be passed to the VISIT file (#9000010) for use by PCE.
"^DD",133.8,133.801,23,"DT")
3040210
"^DD",133.8,133.8013,0)
REFERRING PHYSICIAN SUB-FIELD^^6^7
"^DD",133.8,133.8013,0,"NM","REFERRING PHYSICIAN")

"^DD",133.8,133.8013,.01,0)
REFERRING PHYSICIAN^FX^^0;1^D REFPHY^SROWL K:$L(X)>50!($L(X)<1) X
"^DD",133.8,133.8013,.01,.1)
Referring Physician/Medical Center
"^DD",133.8,133.8013,.01,1,0)
^.1
"^DD",133.8,133.8013,.01,1,1,0)
133.8013^B
"^DD",133.8,133.8013,.01,1,1,1)
S ^SRO(133.8,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",133.8,133.8013,.01,1,1,2)
K ^SRO(133.8,DA(2),1,DA(1),1,"B",$E(X,1,30),DA)
"^DD",133.8,133.8013,.01,3)
ANSWER MUST BE 1-50 CHARACTERS IN LENGTH
"^DD",133.8,133.8013,.01,4)

"^DD",133.8,133.8013,.01,21,0)
^.001^3^3^3030515^^^^
"^DD",133.8,133.8013,.01,21,1,0)
This is the name of the physician and/or Medical Center that referred
"^DD",133.8,133.8013,.01,21,2,0)
the patient for surgery at this facility.
"^DD",133.8,133.8013,.01,21,3,0)
 
"^DD",133.8,133.8013,.01,"DT")
3030410
"^DD",133.8,133.8013,6,0)
REF PHY 200 LINK^P200'^VA(200,^0;7^Q
"^DD",133.8,133.8013,6,.1)
Pointer To NEW PERSON File (#200)
"^DD",133.8,133.8013,6,3)
The VA record number of the Referring Physician.
"^DD",133.8,133.8013,6,21,0)
^.001^3^3^3030904^^^^
"^DD",133.8,133.8013,6,21,1,0)
Field (not accessed by the user) is a pointer to the NEW PERSON file. It 
"^DD",133.8,133.8013,6,21,2,0)
is  populated when a Referring Physician is selected from the NEW PERSON 
"^DD",133.8,133.8013,6,21,3,0)
file with the record number from NEW PERSON file.
"^DD",133.8,133.8013,6,23,0)
^.001^3^3^3030904^^^^
"^DD",133.8,133.8013,6,23,1,0)
Pointer Field (not accessed by the user) to the NEW PERSON file. It will 
"^DD",133.8,133.8013,6,23,2,0)
be populated when and if the Referring Physician is selected from the NEW 
"^DD",133.8,133.8013,6,23,3,0)
PERSON file (#200).
"^DD",133.8,133.8013,6,"DT")
3030904
**INSTALL NAME**
RMPR*3.0*78
"BLD",4988,0)
RMPR*3.0*78^PROSTHETICS^0^3050805^y
"BLD",4988,1,0)
^^1^1^3040708^
"BLD",4988,1,1,0)
PROSTHETICS CLINICAL INDICATOR DATA CAPTURE BUILD
"BLD",4988,4,0)
^9.64PA^668^2
"BLD",4988,4,660,0)
660
"BLD",4988,4,660,2,0)
^9.641^660^1
"BLD",4988,4,660,2,660,0)
RECORD OF PROS APPLIANCE/REPAIR  (File-top level)
"BLD",4988,4,660,2,660,1,0)
^9.6411^33.7^34
"BLD",4988,4,660,2,660,1,10,0)
DELIVERY DATE
"BLD",4988,4,660,2,660,1,30,0)
PRIMARY ICD DIAGNOSIS CODE
"BLD",4988,4,660,2,660,1,30.1,0)
PRIMARY AGENT ORANGE EXPOSURE
"BLD",4988,4,660,2,660,1,30.2,0)
PRIMARY IONIZED RADIATION
"BLD",4988,4,660,2,660,1,30.3,0)
PRIMARY SERVICE-CONNECTED
"BLD",4988,4,660,2,660,1,30.4,0)
PRIMARY ENVIRONMENTAL CONT.
"BLD",4988,4,660,2,660,1,30.5,0)
PRIMARY MST
"BLD",4988,4,660,2,660,1,30.6,0)
PRIMARY HEAD/NECK CANCER
"BLD",4988,4,660,2,660,1,30.7,0)
PRIMARY COMBAT VET
"BLD",4988,4,660,2,660,1,31,0)
SECONDARY ICD DIAGNOSIS CODE 1
"BLD",4988,4,660,2,660,1,31.1,0)
SECONDARY AGENT ORANGE 1
"BLD",4988,4,660,2,660,1,31.2,0)
SECONDARY IONIZED RADIATION 1
"BLD",4988,4,660,2,660,1,31.3,0)
SECONDARY SERVICE-CONNECTED 1
"BLD",4988,4,660,2,660,1,31.4,0)
SECONDARY ENVIRONMENTAL CONT 1
"BLD",4988,4,660,2,660,1,31.5,0)
SECONDARY MST 1
"BLD",4988,4,660,2,660,1,31.6,0)
SECONDARY HEAD/NECK CANCER 1
"BLD",4988,4,660,2,660,1,31.7,0)
SECONDARY COMBAT VET 1
"BLD",4988,4,660,2,660,1,32,0)
SECONDARY ICD DIAGNOSIS 2
"BLD",4988,4,660,2,660,1,32.1,0)
SECONDARY AGENT ORANGE 2
"BLD",4988,4,660,2,660,1,32.2,0)
SECONDARY IONIZED RADIATION 2
"BLD",4988,4,660,2,660,1,32.3,0)
SECONDARY SERVICE-CONNECTED 2
"BLD",4988,4,660,2,660,1,32.4,0)
SECONDARY ENVIR. CONT. 2
"BLD",4988,4,660,2,660,1,32.5,0)
SECONDARY MST 2
"BLD",4988,4,660,2,660,1,32.6,0)
SECONDARY HEAD/NECK CANCER 2
"BLD",4988,4,660,2,660,1,32.7,0)
SECONDARY COMBAT VET 2
"BLD",4988,4,660,2,660,1,33,0)
SECONDARY ICD DIAGNOSIS 3
"BLD",4988,4,660,2,660,1,33.1,0)
SECONDARY AGENT ORANGE 3
"BLD",4988,4,660,2,660,1,33.2,0)
SECONDARY IONIZED RADIATION 3
"BLD",4988,4,660,2,660,1,33.3,0)
SECONDARY SERVICE-CONNECTED 3
"BLD",4988,4,660,2,660,1,33.4,0)
SECONDARY ENVIRON. CONT. 3
"BLD",4988,4,660,2,660,1,33.5,0)
SECONDARY MST 3
"BLD",4988,4,660,2,660,1,33.6,0)
SECONDARY HEAD/NECK CANCER 3
"BLD",4988,4,660,2,660,1,33.7,0)
SECONDARY COMBAT VET 3
"BLD",4988,4,660,2,660,1,39,0)
DATE OF SERVICE
"BLD",4988,4,660,222)
y^n^p^^^^n^^n
"BLD",4988,4,660,224)

"BLD",4988,4,668,0)
668
"BLD",4988,4,668,2,0)
^9.641^668^1
"BLD",4988,4,668,2,668,0)
PROSTHETIC SUSPENSE  (File-top level)
"BLD",4988,4,668,2,668,1,0)
^9.6411^33.7^32
"BLD",4988,4,668,2,668,1,30,0)
PRIMARY ICD DIAGNOSIS CODE
"BLD",4988,4,668,2,668,1,30.1,0)
PRIMARY AGENT ORANGE
"BLD",4988,4,668,2,668,1,30.2,0)
PRIMARY IONIZED RADIATION
"BLD",4988,4,668,2,668,1,30.3,0)
PRIMARY SERVICE-CONNECTED
"BLD",4988,4,668,2,668,1,30.4,0)
PRIMARY ENVIRONMENTAL CONT.
"BLD",4988,4,668,2,668,1,30.5,0)
PRIMARY MST
"BLD",4988,4,668,2,668,1,30.6,0)
PRIMARY HEAD/NECK CANCER
"BLD",4988,4,668,2,668,1,30.7,0)
PRIMARY COMBAT VET
"BLD",4988,4,668,2,668,1,31,0)
SECONDARY ICD DIAGNOSIS 1
"BLD",4988,4,668,2,668,1,31.1,0)
SECONDARY AGENT ORANGE 1
"BLD",4988,4,668,2,668,1,31.2,0)
SECONDARY IONIZED RADIATION 1
"BLD",4988,4,668,2,668,1,31.3,0)
SECONDARY SERVICE-CONNECTED 1
"BLD",4988,4,668,2,668,1,31.4,0)
SECONDARY ENVIRON. CONT. 1
"BLD",4988,4,668,2,668,1,31.5,0)
SECONDARY MST 1
"BLD",4988,4,668,2,668,1,31.6,0)
SECONDARY HEAD/NECK CANCER 1
"BLD",4988,4,668,2,668,1,31.7,0)
SECONDARY COMBAT VET 1
"BLD",4988,4,668,2,668,1,32,0)
SECONDARY ICD DIAGNOSIS 2
"BLD",4988,4,668,2,668,1,32.1,0)
SECONDARY AGENT ORANGE 2
"BLD",4988,4,668,2,668,1,32.2,0)
SECONDARY IONIZED RADIATION 2
"BLD",4988,4,668,2,668,1,32.3,0)
SECONDARY SERVICE-CONNECTED 2
"BLD",4988,4,668,2,668,1,32.4,0)
SECONDARY ENVIRON. CONT. 2
"BLD",4988,4,668,2,668,1,32.5,0)
SECONDARY MST 2
"BLD",4988,4,668,2,668,1,32.6,0)
SECONDARY HEAD/NECK CANCER 2
"BLD",4988,4,668,2,668,1,32.7,0)
SECONDARY COMBAT VET 2
"BLD",4988,4,668,2,668,1,33,0)
SECONDARY ICD DIAGNOSIS 3
"BLD",4988,4,668,2,668,1,33.1,0)
SECONDARY AGENT ORANGE 3
"BLD",4988,4,668,2,668,1,33.2,0)
SECONDARY IONIZED RADIATION 3
"BLD",4988,4,668,2,668,1,33.3,0)
SECONDARY SERVICE-CONNECTED 3
"BLD",4988,4,668,2,668,1,33.4,0)
SECONDARY ENVIRON. CONT. 3
"BLD",4988,4,668,2,668,1,33.5,0)
SECONDARY MST 3
"BLD",4988,4,668,2,668,1,33.6,0)
SECONDARY HEAD/NECK CANCER 3
"BLD",4988,4,668,2,668,1,33.7,0)
SECONDARY COMBAT VET 3
"BLD",4988,4,668,222)
y^n^p^^^^n^^n
"BLD",4988,4,668,224)

"BLD",4988,4,"APDD",660,660)

"BLD",4988,4,"APDD",660,660,10)

"BLD",4988,4,"APDD",660,660,30)

"BLD",4988,4,"APDD",660,660,30.1)

"BLD",4988,4,"APDD",660,660,30.2)

"BLD",4988,4,"APDD",660,660,30.3)

"BLD",4988,4,"APDD",660,660,30.4)

"BLD",4988,4,"APDD",660,660,30.5)

"BLD",4988,4,"APDD",660,660,30.6)

"BLD",4988,4,"APDD",660,660,30.7)

"BLD",4988,4,"APDD",660,660,31)

"BLD",4988,4,"APDD",660,660,31.1)

"BLD",4988,4,"APDD",660,660,31.2)

"BLD",4988,4,"APDD",660,660,31.3)

"BLD",4988,4,"APDD",660,660,31.4)

"BLD",4988,4,"APDD",660,660,31.5)

"BLD",4988,4,"APDD",660,660,31.6)

"BLD",4988,4,"APDD",660,660,31.7)

"BLD",4988,4,"APDD",660,660,32)

"BLD",4988,4,"APDD",660,660,32.1)

"BLD",4988,4,"APDD",660,660,32.2)

"BLD",4988,4,"APDD",660,660,32.3)

"BLD",4988,4,"APDD",660,660,32.4)

"BLD",4988,4,"APDD",660,660,32.5)

"BLD",4988,4,"APDD",660,660,32.6)

"BLD",4988,4,"APDD",660,660,32.7)

"BLD",4988,4,"APDD",660,660,33)

"BLD",4988,4,"APDD",660,660,33.1)

"BLD",4988,4,"APDD",660,660,33.2)

"BLD",4988,4,"APDD",660,660,33.3)

"BLD",4988,4,"APDD",660,660,33.4)

"BLD",4988,4,"APDD",660,660,33.5)

"BLD",4988,4,"APDD",660,660,33.6)

"BLD",4988,4,"APDD",660,660,33.7)

"BLD",4988,4,"APDD",660,660,39)

"BLD",4988,4,"APDD",668,668)

"BLD",4988,4,"APDD",668,668,30)

"BLD",4988,4,"APDD",668,668,30.1)

"BLD",4988,4,"APDD",668,668,30.2)

"BLD",4988,4,"APDD",668,668,30.3)

"BLD",4988,4,"APDD",668,668,30.4)

"BLD",4988,4,"APDD",668,668,30.5)

"BLD",4988,4,"APDD",668,668,30.6)

"BLD",4988,4,"APDD",668,668,30.7)

"BLD",4988,4,"APDD",668,668,31)

"BLD",4988,4,"APDD",668,668,31.1)

"BLD",4988,4,"APDD",668,668,31.2)

"BLD",4988,4,"APDD",668,668,31.3)

"BLD",4988,4,"APDD",668,668,31.4)

"BLD",4988,4,"APDD",668,668,31.5)

"BLD",4988,4,"APDD",668,668,31.6)

"BLD",4988,4,"APDD",668,668,31.7)

"BLD",4988,4,"APDD",668,668,32)

"BLD",4988,4,"APDD",668,668,32.1)

"BLD",4988,4,"APDD",668,668,32.2)

"BLD",4988,4,"APDD",668,668,32.3)

"BLD",4988,4,"APDD",668,668,32.4)

"BLD",4988,4,"APDD",668,668,32.5)

"BLD",4988,4,"APDD",668,668,32.6)

"BLD",4988,4,"APDD",668,668,32.7)

"BLD",4988,4,"APDD",668,668,33)

"BLD",4988,4,"APDD",668,668,33.1)

"BLD",4988,4,"APDD",668,668,33.2)

"BLD",4988,4,"APDD",668,668,33.3)

"BLD",4988,4,"APDD",668,668,33.4)

"BLD",4988,4,"APDD",668,668,33.5)

"BLD",4988,4,"APDD",668,668,33.6)

"BLD",4988,4,"APDD",668,668,33.7)

"BLD",4988,4,"B",660,660)

"BLD",4988,4,"B",668,668)

"BLD",4988,"ABNS",0)
^9.66A^^
"BLD",4988,"ABPKG")
n^n
"BLD",4988,"KRN",0)
^9.67PA^8989.52^19
"BLD",4988,"KRN",.4,0)
.4
"BLD",4988,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",.401,0)
.401
"BLD",4988,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",.402,0)
.402
"BLD",4988,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",.403,0)
.403
"BLD",4988,"KRN",.5,0)
.5
"BLD",4988,"KRN",.5,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",.84,0)
.84
"BLD",4988,"KRN",3.6,0)
3.6
"BLD",4988,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",3.8,0)
3.8
"BLD",4988,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",9.2,0)
9.2
"BLD",4988,"KRN",9.2,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",9.8,0)
9.8
"BLD",4988,"KRN",9.8,"NM",0)
^9.68A^12^11
"BLD",4988,"KRN",9.8,"NM",1,0)
RMPRHL7A^^0^B33495720
"BLD",4988,"KRN",9.8,"NM",2,0)
RMPRHL7B^^0^B11924217
"BLD",4988,"KRN",9.8,"NM",3,0)
RMPR4E21^^0^B59863834
"BLD",4988,"KRN",9.8,"NM",4,0)
RMPR4E23^^0^B3669234
"BLD",4988,"KRN",9.8,"NM",5,0)
RMPRE21^^0^B44342803
"BLD",4988,"KRN",9.8,"NM",7,0)
RMPR29T^^0^B37837792
"BLD",4988,"KRN",9.8,"NM",8,0)
RMPRPCEA^^0^B50058297
"BLD",4988,"KRN",9.8,"NM",9,0)
RMPRPCE1^^0^B29214954
"BLD",4988,"KRN",9.8,"NM",10,0)
RMPRHL7U^^0^B6054692
"BLD",4988,"KRN",9.8,"NM",11,0)
RMPRSTE^^0^B14458194
"BLD",4988,"KRN",9.8,"NM",12,0)
RMPRPCEB^^0^B20413279
"BLD",4988,"KRN",9.8,"NM","B","RMPR29T",7)

"BLD",4988,"KRN",9.8,"NM","B","RMPR4E21",3)

"BLD",4988,"KRN",9.8,"NM","B","RMPR4E23",4)

"BLD",4988,"KRN",9.8,"NM","B","RMPRE21",5)

"BLD",4988,"KRN",9.8,"NM","B","RMPRHL7A",1)

"BLD",4988,"KRN",9.8,"NM","B","RMPRHL7B",2)

"BLD",4988,"KRN",9.8,"NM","B","RMPRHL7U",10)

"BLD",4988,"KRN",9.8,"NM","B","RMPRPCE1",9)

"BLD",4988,"KRN",9.8,"NM","B","RMPRPCEA",8)

"BLD",4988,"KRN",9.8,"NM","B","RMPRPCEB",12)

"BLD",4988,"KRN",9.8,"NM","B","RMPRSTE",11)

"BLD",4988,"KRN",19,0)
19
"BLD",4988,"KRN",19,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",19.1,0)
19.1
"BLD",4988,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",101,0)
101
"BLD",4988,"KRN",101,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",409.61,0)
409.61
"BLD",4988,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",4988,"KRN",771,0)
771
"BLD",4988,"KRN",771,"NM",0)
^9.68A^^
"BLD",4988,"KRN",870,0)
870
"BLD",4988,"KRN",8989.51,0)
8989.51
"BLD",4988,"KRN",8989.52,0)
8989.52
"BLD",4988,"KRN",8994,0)
8994
"BLD",4988,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",4988,"KRN","B",.4,.4)

"BLD",4988,"KRN","B",.401,.401)

"BLD",4988,"KRN","B",.402,.402)

"BLD",4988,"KRN","B",.403,.403)

"BLD",4988,"KRN","B",.5,.5)

"BLD",4988,"KRN","B",.84,.84)

"BLD",4988,"KRN","B",3.6,3.6)

"BLD",4988,"KRN","B",3.8,3.8)

"BLD",4988,"KRN","B",9.2,9.2)

"BLD",4988,"KRN","B",9.8,9.8)

"BLD",4988,"KRN","B",19,19)

"BLD",4988,"KRN","B",19.1,19.1)

"BLD",4988,"KRN","B",101,101)

"BLD",4988,"KRN","B",409.61,409.61)

"BLD",4988,"KRN","B",771,771)

"BLD",4988,"KRN","B",870,870)

"BLD",4988,"KRN","B",8989.51,8989.51)

"BLD",4988,"KRN","B",8989.52,8989.52)

"BLD",4988,"KRN","B",8994,8994)

"BLD",4988,"QUES",0)
^9.62^^
"BLD",4988,"REQB",0)
^9.611^5^1
"BLD",4988,"REQB",5,0)
RMPR*3.0*82^2
"BLD",4988,"REQB","B","RMPR*3.0*82",5)

"FIA",660)
RECORD OF PROS APPLIANCE/REPAIR
"FIA",660,0)
^RMPR(660,
"FIA",660,0,0)
660IOD
"FIA",660,0,1)
y^n^p^^^^n^^n
"FIA",660,0,10)

"FIA",660,0,11)

"FIA",660,0,"RLRO")

"FIA",660,0,"VR")
3.0^RMPR
"FIA",660,660)
1
"FIA",660,660,10)

"FIA",660,660,30)

"FIA",660,660,30.1)

"FIA",660,660,30.2)

"FIA",660,660,30.3)

"FIA",660,660,30.4)

"FIA",660,660,30.5)

"FIA",660,660,30.6)

"FIA",660,660,30.7)

"FIA",660,660,31)

"FIA",660,660,31.1)

"FIA",660,660,31.2)

"FIA",660,660,31.3)

"FIA",660,660,31.4)

"FIA",660,660,31.5)

"FIA",660,660,31.6)

"FIA",660,660,31.7)

"FIA",660,660,32)

"FIA",660,660,32.1)

"FIA",660,660,32.2)

"FIA",660,660,32.3)

"FIA",660,660,32.4)

"FIA",660,660,32.5)

"FIA",660,660,32.6)

"FIA",660,660,32.7)

"FIA",660,660,33)

"FIA",660,660,33.1)

"FIA",660,660,33.2)

"FIA",660,660,33.3)

"FIA",660,660,33.4)

"FIA",660,660,33.5)

"FIA",660,660,33.6)

"FIA",660,660,33.7)

"FIA",660,660,39)

"FIA",668)
PROSTHETIC SUSPENSE
"FIA",668,0)
^RMPR(668,
"FIA",668,0,0)
668ID
"FIA",668,0,1)
y^n^p^^^^n^^n
"FIA",668,0,10)

"FIA",668,0,11)

"FIA",668,0,"RLRO")

"FIA",668,0,"VR")
3.0^RMPR
"FIA",668,668)
1
"FIA",668,668,30)

"FIA",668,668,30.1)

"FIA",668,668,30.2)

"FIA",668,668,30.3)

"FIA",668,668,30.4)

"FIA",668,668,30.5)

"FIA",668,668,30.6)

"FIA",668,668,30.7)

"FIA",668,668,31)

"FIA",668,668,31.1)

"FIA",668,668,31.2)

"FIA",668,668,31.3)

"FIA",668,668,31.4)

"FIA",668,668,31.5)

"FIA",668,668,31.6)

"FIA",668,668,31.7)

"FIA",668,668,32)

"FIA",668,668,32.1)

"FIA",668,668,32.2)

"FIA",668,668,32.3)

"FIA",668,668,32.4)

"FIA",668,668,32.5)

"FIA",668,668,32.6)

"FIA",668,668,32.7)

"FIA",668,668,33)

"FIA",668,668,33.1)

"FIA",668,668,33.2)

"FIA",668,668,33.3)

"FIA",668,668,33.4)

"FIA",668,668,33.5)

"FIA",668,668,33.6)

"FIA",668,668,33.7)

"MBREQ")
1
"PKG",280,-1)
1^1
"PKG",280,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",280,20,0)
^9.402P^1^1
"PKG",280,20,1,0)
2^^
"PKG",280,20,1,1)

"PKG",280,20,"B",2,1)

"PKG",280,22,0)
^9.49I^1^1
"PKG",280,22,1,0)
3.0^2960209^2970624
"PKG",280,22,1,"PAH",1,0)
78^3050805^2438
"PKG",280,22,1,"PAH",1,1,0)
^^1^1^3050805
"PKG",280,22,1,"PAH",1,1,1,0)
PROSTHETICS CLINICAL INDICATOR DATA CAPTURE BUILD
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","RMPR29T")
0^7^B37837792
"RTN","RMPR29T",1,0)
RMPR29T ;PHX/JLT-PROCESSING 2529-3 ACTION ;01/04/95 3:56 PM
"RTN","RMPR29T",2,0)
 ;;3.0;PROSTHETICS;**78**;Feb 09, 1996
"RTN","RMPR29T",3,0)
 ;
"RTN","RMPR29T",4,0)
 ;RMS 08/25/03 Patch #78 - Add shipment date for
"RTN","RMPR29T",5,0)
 ;Billing Awareness project
"RTN","RMPR29T",6,0)
 ;
"RTN","RMPR29T",7,0)
ASK ;ASK TYPE OF PROCESSING ACTION
"RTN","RMPR29T",8,0)
 ;CALLED BY RMPR29T
"RTN","RMPR29T",9,0)
 ;VARIABLES REQUIRED: RMPRDA - ENTRY IN FILE 664.1
"RTN","RMPR29T",10,0)
 ;                    RMPR ARRAY - AN ARRAY SET UP BY CALL TO 
"RTN","RMPR29T",11,0)
 ;                                 DIV4^RMPRSIT
"RTN","RMPR29T",12,0)
 ;
"RTN","RMPR29T",13,0)
 I $Y<17 F  W ! Q:$Y>17
"RTN","RMPR29T",14,0)
 W !,RMPR("L") K DIR S DIR("A")="Select Processing Action",DIR("A")=$S($D(HLD):DIR("A")_" or press 'return' to view more items: ",1:DIR("A")_": ") G:$D(PSM) AMP G:$D(PASS) ASP G:$D(PAC) ACK G:$D(PNK) ANK
"RTN","RMPR29T",15,0)
 S DIR(0)="SAO^1:EDIT 2529-3 ITEM;2:PROCESS JOB SECTION  ;3:INITIATE PROCUREMENT;4:PRINT 2529-3     ;5:RE-DISPLAY SCREEN    ;6:CANCEL 2529-3",DIR("?")="^D HELP^RMPR29W W !,$C(7),?5,""Enter a number 1-6""" D HELP^RMPR29W
"RTN","RMPR29T",16,0)
 D ^DIR I (X=""&$D(HLD)) S PAGE=PAGE+1 D HD^RMPR29W G:$D(^UTILITY($J,"W"))!$O(^UTILITY("DIQ1",$J,664.16,+RI,7,0)) EXT^RMPR29D G ITD^RMPR29D
"RTN","RMPR29T",17,0)
 G:$D(DTOUT) END^RMPR29A G:+Y=1 ITM^RMPR29A G:+Y=2 ^RMPR29B G:+Y=3 ^RMPR29P G:+Y=5 DISP^RMPR29D G:+Y=6 CA^RMPR29C
"RTN","RMPR29T",18,0)
 I +Y=4 D PRT^RMPR29R G DISP^RMPR29D
"RTN","RMPR29T",19,0)
 I $D(^XUSEC("RMPR LAB SUPERVISOR",DUZ)) G COM
"RTN","RMPR29T",20,0)
 K DIR S DIR(0)="Y",DIR("A")="Ready for Supervisor Inspection",DIR("B")="NO" D ^DIR I +Y=1 W !!,?5,$C(7),"Request Ready Inspection" S DIE="^RMPR(664.1,",DA=RMPRDA,DR="16///^S X=""PC""" D ^DIE
"RTN","RMPR29T",21,0)
 ;I +Y=0 G END^RMPR29A
"RTN","RMPR29T",22,0)
 G END^RMPR29A
"RTN","RMPR29T",23,0)
 ; D ^RMPR4E23 ADDED BY RMS
"RTN","RMPR29T",24,0)
ASP ;ASK TYPE OF ASSIGNMENT ACTION
"RTN","RMPR29T",25,0)
 S DIR(0)="SAO^1:EDIT 2529-3 ITEM;2:ASSIGN 2529-3 TO TECH;3:CANCEL 2529-3;4:PRINT 2529-3",DIR("?")="^D HELP^RMPR29W" D HELP^RMPR29W
"RTN","RMPR29T",26,0)
 D ^DIR I (X=""&$D(HLD)) S PAGE=PAGE+1 D HD^RMPR29W G:$D(^UTILITY($J,"W"))!$O(^UTILITY("DIQ1",$J,664.16,+RI,7,0)) EXT^RMPR29D G ITD^RMPR29D
"RTN","RMPR29T",27,0)
 G:$D(DTOUT) EXIT^RMPR29S G:+Y=1 ITM^RMPR29A G:+Y=2 ATCH^RMPR29S G:+Y=3 CA^RMPR29C
"RTN","RMPR29T",28,0)
 I +Y=4 D PRT^RMPR29R G DISP^RMPR29D
"RTN","RMPR29T",29,0)
 G EXIT^RMPR29S
"RTN","RMPR29T",30,0)
ACK ;ASK TYPE OF COMPLETION ACTION
"RTN","RMPR29T",31,0)
 S DIR(0)="SAO^1:EDIT 2529-3 ITEM     ;2:COMPLETE JOB SECTION;3:RETURN 2529-3 TO LAB;4:PRINT 2529-3         ;5:RE-DISPLAY SCREEN   ;6:CANCEL 2529-3",DIR("?")="^D HELP^RMPR29W W !,$C(7),?5,""Enter a Number 1-6""" D HELP^RMPR29W
"RTN","RMPR29T",32,0)
 D ^DIR I (X=""&$D(HLD)) S PAGE=PAGE+1 D HD^RMPR29W G:$D(^UTILITY($J,"W"))!($O(^UTILITY("DIQ1",$J,664.16,+RI,7,0))) EXT^RMPR29D G ITD^RMPR29D
"RTN","RMPR29T",33,0)
 G:$D(DTOUT) END^RMPR29A G:+Y=1 ITM^RMPR29A G:+Y=2 ^RMPR29B G:+Y=3 RT^RMPR29C G:+Y=5 DISP^RMPR29D G:+Y=6 CA^RMPR29C
"RTN","RMPR29T",34,0)
 I +Y=4 D PRT^RMPR29R G DISP^RMPR29D
"RTN","RMPR29T",35,0)
COM ;COMPLETE 2529-3
"RTN","RMPR29T",36,0)
 K DIR S DIR(0)="Y",DIR("A")="Complete and Post 2529-3",DIR("B")="NO" D ^DIR I +Y=0 G END^RMPR29A
"RTN","RMPR29T",37,0)
 D CHK I $D(RFL) G END^RMPR29A
"RTN","RMPR29T",38,0)
 K DA,Y,DIC,X S DA=RMPRDA,DR="24",DIE="^RMPR(664.1," D ^DIE I $D(DTOUT)!($D(Y)) D MESS G END^RMPR29A
"RTN","RMPR29T",39,0)
 I $P(^RMPR(664.1,RMPRDA,0),U,27)=3 W !!,$C(7),?5,"2529-3 cannot be completed until issued to Veteran" G END^RMPR29A
"RTN","RMPR29T",40,0)
 S DA=RMPRDA,DR="33;20R",DIE="^RMPR(664.1," D ^DIE I $D(DTOUT)!($D(Y)) D MESS G END^RMPR29A
"RTN","RMPR29T",41,0)
 ; RMS 9/2003, PATCH 78, NEXT 2 LINES
"RTN","RMPR29T",42,0)
 D GETDT
"RTN","RMPR29T",43,0)
 N RMPR660D S RMPR660D=$P(^RMPR(664.1,RMPRDA,0),U,5) D RTBILL
"RTN","RMPR29T",44,0)
 S:'$P(^RMPR(664.1,RMPRDA,0),U,25) $P(^RMPR(664.1,RMPRDA,0),U,25)=DUZ S $P(^RMPR(664.1,RMPRDA,0),U,26)=DT
"RTN","RMPR29T",45,0)
 W !!,?5,$C(7),"Request Completed and Posted!!!" S DIE="^RMPR(664.1,",DR="16///^S X=""C""",DA=RMPRDA D ^DIE
"RTN","RMPR29T",46,0)
 G END^RMPR29A
"RTN","RMPR29T",47,0)
ANK ;ASK TYPE OF CLOSE OUT ACTION
"RTN","RMPR29T",48,0)
 S DIR(0)="SAO^1:EDIT 2529-3 ITEM     ;2:PRINT 2529-3         ;3:RE-DISPLAY SCREEN   ;4:CANCEL 2529-3       ;5:CLOSE OUT A 2529-3",DIR("?")="^D HELP^RMPR29W W !,$C(7),?5,""Enter a Number 1-5""" D HELP^RMPR29W
"RTN","RMPR29T",49,0)
 D ^DIR I (X=""&$D(HLD)) S PAGE=PAGE+1 D HDC^RMPR29W G:$D(^UTILITY($J,"W"))!($O(^UTILITY("DIQ1",$J,664.16,+RI,7,0))) EXT^RMPR29D G ITD^RMPR29D
"RTN","RMPR29T",50,0)
 G:+Y=1 ITM^RMPR29A G:+Y=3 DISP^RMPR29D G:+Y=4 CA^RMPR29C
"RTN","RMPR29T",51,0)
 I +Y=2 D PRT^RMPR29R G DISP^RMPR29D
"RTN","RMPR29T",52,0)
 ;K DIR S DIR(0)="Y",DIR("A")="Close out 2529-3",DIR("B")="NO" D ^DIR I +Y=0 D MESS G EXIT^RMPR29C
"RTN","RMPR29T",53,0)
 I +Y=5 D  G EXIT^RMPR29C
"RTN","RMPR29T",54,0)
 .K DA,Y,DIC,X
"RTN","RMPR29T",55,0)
 .S DA=RMPRDA,DIE="^RMPR(664.1,",DR="4;33;20R"
"RTN","RMPR29T",56,0)
 .D ^DIE
"RTN","RMPR29T",57,0)
 .I $D(DTOUT)!$D(Y) D MESS Q
"RTN","RMPR29T",58,0)
 .W !!,?5,$C(7),"Request Closed out and Posted!!!"
"RTN","RMPR29T",59,0)
 .I $P(^RMPR(664.1,RMPRDA,0),U,20),$P(^(0),U,23) D DEL^RMPR29P(RMPRDA),PST^RMPR29P(RMPRDA)
"RTN","RMPR29T",60,0)
 .N RMPRDL S RMPRDL=$P($G(^RMPR(664.1,RMPRDA,7)),U,2)
"RTN","RMPR29T",61,0)
 .F RI=0:0 S RI=$O(^RMPR(664.1,RMPRDA,2,RI)) Q:RI'>0  I $D(^(RI,0)) S DA=$P(^(0),U,5) I +DA>0,RMPRDL S DIE="^RMPR(660,",DR="10///@;10///^S X=RMPRDL;39///@;39////"_RMPRSHIP D ^DIE,RTBILL
"RTN","RMPR29T",62,0)
 .;F RI=0:0 S RI=$O(^RMPR(664.1,RMPRDA,2,RI)) Q:RI'>0  I $D(^(RI,0)) S DA=$P(^(0),U,5) I +DA>0,RMPRDL S DIE="^RMPR(660,",DR="10///@;10///^S X=RMPRDL" D ^DIE
"RTN","RMPR29T",63,0)
 .S:'$P(^RMPR(664.1,RMPRDA,0),U,25) $P(^RMPR(664.1,RMPRDA,0),U,25)=DUZ S $P(^RMPR(664.1,RMPRDA,0),U,26)=DT
"RTN","RMPR29T",64,0)
 .S DIE="^RMPR(664.1,",DA=RMPRDA,DR="16///^S X=""C""" D ^DIE
"RTN","RMPR29T",65,0)
 Q
"RTN","RMPR29T",66,0)
CHK ;CHK TO SEE IF JOB SECTION IS COMPLETE
"RTN","RMPR29T",67,0)
 K RFL F RI=0:0 S RI=$O(^RMPR(664.1,RMPRDA,2,RI)) Q:RI'>0  I $D(^(RI,0)) S RDA=^(0),RA=$P(RDA,U,5) D
"RTN","RMPR29T",68,0)
 .;see internal notes
"RTN","RMPR29T",69,0)
 .S (RZP,DA)=$O(^RMPR(664.2,"C",RA,0))
"RTN","RMPR29T",70,0)
 .S RMPRCD=$P($G(^RMPR(664.2,+DA,0)),U,10) I 'RMPRCD S RFL=1 W !!,$C(7),"Date Completed has not been entered for JOB "
"RTN","RMPR29T",71,0)
 I $D(RFL) W !!,$C(7),?5,"2529-3 Job Section is Incomplete!!"
"RTN","RMPR29T",72,0)
 Q
"RTN","RMPR29T",73,0)
AMP ;ASK TYPE OF MULTIPLE ASSIGMENT ACTION
"RTN","RMPR29T",74,0)
 S DIR(0)="SAO^1:EDIT 2529-3 ITEM;2:ASSIGN 2529-3 TO TECH;3:CANCEL 2529-3;4:PRINT 2529-3    ;5:NEXT ENTRY           ;6:PREVIOUS ENTRY",DIR("?")="^D HELP^RMPR29W" D HELP^RMPR29W
"RTN","RMPR29T",75,0)
 D ^DIR I (X=""&$D(HLD)) S PAGE=PAGE+1 D HD^RMPR29W G:$D(^UTILITY($J,"W"))!$O(^UTILITY("DIQ1",$J,664.16,+RI,7,0)) EXT^RMPR29D G ITD^RMPR29D
"RTN","RMPR29T",76,0)
 G:$D(DTOUT) EXIT^RMPR29S G:+Y=1 ITM^RMPR29A G:+Y=2 ATCH^RMPR29S G:+Y=3 CA^RMPR29C G:+Y=5 NEXT^RMPR29S G:+Y=6 PREV^RMPR29S
"RTN","RMPR29T",77,0)
 I +Y=4 D PRT^RMPR29R G DISP^RMPR29D
"RTN","RMPR29T",78,0)
 G EXIT^RMPR29S
"RTN","RMPR29T",79,0)
MESS ;MESSAGE IF DTOUT OR $D(Y)
"RTN","RMPR29T",80,0)
 W !!,$C(7),?5,"2529-3 has not been completed!!" Q
"RTN","RMPR29T",81,0)
GETDT ; DIR call to obtain the shipment date, RMS, PATCH 78
"RTN","RMPR29T",82,0)
 N DIR,RMPRTRDT
"RTN","RMPR29T",83,0)
 S RMPRTRDT=DT
"RTN","RMPR29T",84,0)
 S RMPRTRDT=$$FMTE^XLFDT(RMPRTRDT,"2D")
"RTN","RMPR29T",85,0)
 S DIR(0)="D",DIR("A")="SHIPMENT DATE",DIR("B")=$G(RMPRTRDT)
"RTN","RMPR29T",86,0)
 S DIR("?")="The date that the item was shipped or delivered to the patient."
"RTN","RMPR29T",87,0)
 S DIR("?")=DIR("?")_"The default date is today's date."
"RTN","RMPR29T",88,0)
 D ^DIR
"RTN","RMPR29T",89,0)
 S RMPRSHIP=Y
"RTN","RMPR29T",90,0)
 Q
"RTN","RMPR29T",91,0)
RTBILL ; Mark as ready for billing, RMS, PATCH 78
"RTN","RMPR29T",92,0)
 Q  ; taken out for Phase II Billing Aware (WLC 02/26/04)
"RTN","RMPR29T",93,0)
 N DIC,X,DLAYGO,RMPRO,DIE,DR
"RTN","RMPR29T",94,0)
 S DIC="^RMPR(660.5,"
"RTN","RMPR29T",95,0)
 S DIC(0)="L",X="""N"""
"RTN","RMPR29T",96,0)
 S DLAYGO=660.5 D ^DIC K DLAYGO Q:Y<1
"RTN","RMPR29T",97,0)
 S RMPRO=+Y,DIE=DIC
"RTN","RMPR29T",98,0)
 ;
"RTN","RMPR29T",99,0)
 L +^RMPR(660.5,RMPRO)
"RTN","RMPR29T",100,0)
 ; .01-Transaction Date; 2-Send Required; .02-Shipment Date
"RTN","RMPR29T",101,0)
 ; 3-ProsFile(pointer to file #660)
"RTN","RMPR29T",102,0)
 S DR=".01////^S X=DT;2////1;.02////^S X=RMPRSHIP;3////^S X=RMPR660D"
"RTN","RMPR29T",103,0)
 D ^DIE
"RTN","RMPR29T",104,0)
 L -^RMPR(660.5,RMPRO)
"RTN","RMPR29T",105,0)
 Q
"RTN","RMPR4E21")
0^3^B59863834
"RTN","RMPR4E21",1,0)
RMPR4E21 ;PHX/HNC - CLOSE OUT PURCHASE CARD TRANSACTION ;3/1/1996
"RTN","RMPR4E21",2,0)
 ;;3.0;PROSTHETICS;**3,12,26,28,30,34,41,45,62,111,78**;Feb 09, 1996
"RTN","RMPR4E21",3,0)
 ;TH  Patch #78 - 08/04/03 - Add shipment date. Call routine ^RMPR4E23
"RTN","RMPR4E21",4,0)
 ;RVD patch #62 - PCE processing and link to suspense
"RTN","RMPR4E21",5,0)
 ;
"RTN","RMPR4E21",6,0)
 ;I '$D(^PRC(440.5,"H",DUZ)) W !!,"You are not an authorized Purchase Card User, CONTACT FISCAL!" Q
"RTN","RMPR4E21",7,0)
START I '$D(RMPR) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPR4E21",8,0)
CL K ^TMP($J,"RMPRPCE")
"RTN","RMPR4E21",9,0)
 K DIC S DIC="664",DIC(0)="AEQM",DIC("W")="D EN2^RMPR4D1",DIC("A")="Select PATIENT: "
"RTN","RMPR4E21",10,0)
 S DIC("S")="I $D(^(4)) I ('$P(^(0),U,8)&'$P(^(0),U,5)),($P(^(0),U,14)=RMPR(""STA""))"
"RTN","RMPR4E21",11,0)
 W !!,"You may also make a selection by Purchase Card Transaction"
"RTN","RMPR4E21",12,0)
 W !,"(Example, PO number), or Bank Authorization Number (6 digit number).",!
"RTN","RMPR4E21",13,0)
 D ^DIC S (DA,RMPRA)=+Y I Y=-1 G EXIT
"RTN","RMPR4E21",14,0)
 K DIC G:$P(^RMPR(664,RMPRA,0),U,8) M4 G:$P(^(0),U,5) M6
"RTN","RMPR4E21",15,0)
 L +^RMPR(664,RMPRA,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPR4E21",16,0)
 ;get amis grouper number RGRP1
"RTN","RMPR4E21",17,0)
 S RGRP=0,RGRP1=""
"RTN","RMPR4E21",18,0)
 S RGRP=$O(^RMPR(664,RMPRA,1,RGRP)) G:'RGRP BRK S RGRPP=$P($G(^RMPR(664,RMPRA,1,RGRP,0)),U,13) I 'RGRPP W !!,$C(7),"ERROR** This transaction was not posted to 2319, please contact your IRM..",!! S DIR(0)="E" D ^DIR G EXIT
"RTN","RMPR4E21",19,0)
 S RGRP1=$P($G(^RMPR(660,RGRPP,"AMS")),U,1)
"RTN","RMPR4E21",20,0)
 S (RMPRDFN,DFN)=$P(^RMPR(664,RMPRA,0),U,2),RMPRWO=$P(^(0),U,15),RMPRDA=$P(^(0),U,17)
"RTN","RMPR4E21",21,0)
 D DEM^VADPT S RMPRSSNE=VA("PID"),RMPRSSN=+VADM(2),RMPRNAM=VADM(1) K VADM
"RTN","RMPR4E21",22,0)
 ;set original value before close-out
"RTN","RMPR4E21",23,0)
 K ^TMP("RM",$J),RM(RMPRA),RHCED S RMPRF=2
"RTN","RMPR4E21",24,0)
 K %X,%Y S %X="^RMPR(664,RMPRA,",%Y="^TMP("_"""RM"""_",$J,RMPRA," D %XY^%RCR
"RTN","RMPR4E21",25,0)
 S RM(RMPRA,0)=$G(^RMPR(664,RMPRA,0)),RM(RMPRA,2)=$G(^(2)),RM(RMPRA,4)=$G(^(4))
"RTN","RMPR4E21",26,0)
 S RMPER=$P(RM(RMPRA,2),U,6),RMBAN=$P(RM(RMPRA,4),U,2),RMSHI=$P(RM(RMPRA,0),U,11),RMSHIEN=$P(RM(RMPRA,0),U,12)
"RTN","RMPR4E21",27,0)
 ;added by #62
"RTN","RMPR4E21",28,0)
 ;collect all items and previous linkage to suspense.
"RTN","RMPR4E21",29,0)
 I $G(RMSHIEN) S:'$D(^RMPR(660,RMSHIEN,10)) RM60LINK(RMSHIEN)=""
"RTN","RMPR4E21",30,0)
 D COL^RMPRPCEL
"RTN","RMPR4E21",31,0)
 ;
"RTN","RMPR4E21",32,0)
L ;**** ask for final posting *****************************************
"RTN","RMPR4E21",33,0)
 D ^RMPR4LI N DIR K RFLG
"RTN","RMPR4E21",34,0)
 S DIR("A")="Ready to Reconcile and Close-Out Transaction",DIR("B")="NO",DIR(0)="Y"
"RTN","RMPR4E21",35,0)
 S DIR("?")="You may now Close-out and Post this Transaction. Please answer Yes or No."
"RTN","RMPR4E21",36,0)
 D ^DIR I Y["^"!($D(DTOUT)) W !,"Transaction NOT Closed-Out!" S:$D(^TMP("RM",$J)) RFLG=1 G:$D(RFLG) POST1 G KTMP
"RTN","RMPR4E21",37,0)
 I Y=1 G POST1
"RTN","RMPR4E21",38,0)
 ;***add/edit transaction**********************************************
"RTN","RMPR4E21",39,0)
L1 K DIR S DIR(0)="FO",DIR("A")="Select ITEM"
"RTN","RMPR4E21",40,0)
 S DIR("?")="^S RFL=1 D ZDSP^RMPR421A"
"RTN","RMPR4E21",41,0)
 D ^DIR G:(Y="^")!(Y="") DS G:$D(DTOUT) L
"RTN","RMPR4E21",42,0)
 G:$D(DIRUT)&($D(^RMPR(664,RMPRA,1))) L
"RTN","RMPR4E21",43,0)
 S DIC=661,DIC(0)="ENMZ" D ^DIC I +Y'>0 W !,"** No Item selected.." G DS
"RTN","RMPR4E21",44,0)
 G:$D(DTOUT)!$D(DUOUT) L
"RTN","RMPR4E21",45,0)
 D PROC G L1
"RTN","RMPR4E21",46,0)
 ;***process items*******************************************************
"RTN","RMPR4E21",47,0)
PROC N NEW S HY=+Y I $D(^RMPR(664,RMPRA,1,"B",+Y)) S DA=$O(^RMPR(664,RMPRA,1,"B",+Y,0)) G CHK
"RTN","RMPR4E21",48,0)
FILE S Y=HY,NUM=$P(^RMPR(664,RMPRA,1,0),U,4)+1,$P(^(0),U,4)=NUM,$P(^(0),U,3)=$P(^(0),U,3)+1,^RMPR(664,RMPRA,1,NUM,0)=+Y,DA=NUM,^RMPR(664,RMPRA,1,"B",+Y,NUM)="" S NEW=1
"RTN","RMPR4E21",49,0)
ENT K DR,DQ S DA(1)=RMPRA,DIE="^RMPR(664,"_RMPRA_",1,"
"RTN","RMPR4E21",50,0)
 ;S DR=$S($D(NEW):"",1:".01;")
"RTN","RMPR4E21",51,0)
 I '$D(NEW),($P(^RMPR(664,RMPRA,1,DA,0),U,7)="") S $P(^(0),U,7)=$P(^(0),U,3)
"RTN","RMPR4E21",52,0)
 S:'$D(NEW) RMDACA=$P(^RMPR(664,RMPRA,1,DA,0),U,13)
"RTN","RMPR4E21",53,0)
 S R4DA=DA
"RTN","RMPR4E21",54,0)
 S DR="8;S RMTYPE=$P(^RMPR(664,RMPRA,1,R4DA,0),U,9);9;.01;"
"RTN","RMPR4E21",55,0)
 S DR=DR_"16R;1;14;17;15;3R;"
"RTN","RMPR4E21",56,0)
 I $D(NEW) S DR=DR_"2R~UNIT COST;"
"RTN","RMPR4E21",57,0)
 E  S DR=DR_"6R;",RHCNEW=$P($G(^RMPR(664,RMPRA,1,R4DA,0)),U,16)
"RTN","RMPR4E21",58,0)
 S DR=DR_"4R~UNIT OF ISSUE;7;11////C" D ^DIE
"RTN","RMPR4E21",59,0)
 I $D(NEW) S:$G(DA) ^TMP("RM",$J,"N",R4DA)=$G(^RMPR(664,RMPRA,1,R4DA,0))
"RTN","RMPR4E21",60,0)
 E  S:'$G(DA)&(RMDACA) ^TMP("RM",$J,"C",RMDACA)="" I $G(DA) S ^TMP("RM",$J,"E",DA)=$G(^RMPR(664,RMPRA,1,DA,0)),RHCOLD=$P(^RMPR(664,RMPRA,1,DA,0),U,16),RD660=$P(^(0),U,13) I RHCNEW'=RHCOLD D
"RTN","RMPR4E21",61,0)
 .S RHCED=1
"RTN","RMPR4E21",62,0)
 .I $D(RD660)&(RD660) S DIE="^RMPR(660,",DA=RD660,DR="4.5///^S X=$G(RHCOLD)" D ^DIE
"RTN","RMPR4E21",63,0)
 I $D(R4DA),$P($G(^RMPR(664,RMPRA,1,R4DA,0)),U,10)=4 S DA=R4DA,DR=10 D ^DIE
"RTN","RMPR4E21",64,0)
 ;check for Type of Transaction and update the cpt modifier.
"RTN","RMPR4E21",65,0)
 I $D(R4DA),$D(RMTYPE) S RDATA=RMTYPE_"^"_RMPRA_"^"_R4DA D CHKCPT^RMPR4UTL(RDATA)
"RTN","RMPR4E21",66,0)
 Q:$D(DTOUT)  K NUM,R4DA,DA,Y,DR,RD660,RHCOLD,RHCNEW,DIE,RDATA,RMTYPE Q
"RTN","RMPR4E21",67,0)
CHK ;ADD DUPLICATE LINE ITEM
"RTN","RMPR4E21",68,0)
 K DIR,Y S DIR(0)="S^Y:YES;N:NO",DIR("A")="DO YOU WANT TO ADD A DUPLICATE ITEM?",DIR("B")="NO" D ^DIR Q:$D(DIRUT)!($D(DTOUT))  I (X["Y")!(X["y") G FILE
"RTN","RMPR4E21",69,0)
 S RD=0 F RDA=0:0 S RDA=$O(^RMPR(664,RMPRA,1,"B",HY,RDA)) Q:RDA'>0  S RD=RD+1
"RTN","RMPR4E21",70,0)
LKP I RD>1 D  Q:$D(DIRUT)!$D(DTOUT)  I '$D(RD(+Y)) W $C(7) G LKP
"RTN","RMPR4E21",71,0)
 .F RDA=0:0 S RDA=$O(^RMPR(664,RMPRA,1,"B",HY,RDA)) Q:RDA'>0  S RD(RDA)=^RMPR(664,RMPRA,1,RDA,0) W !?5,RDA,?10,$P(^PRC(441,$P(^RMPR(661,$P(RD(RDA),U),0),U),0),U,2),"  $",$S($P(RD(RDA),U,7)'="":$P(RD(RDA),U,7),1:$P(RD(RDA),U,3))
"RTN","RMPR4E21",72,0)
 .K DIR,Y S DIR(0)="N" D ^DIR I +Y S DA=+Y
"RTN","RMPR4E21",73,0)
 G ENT
"RTN","RMPR4E21",74,0)
 ;
"RTN","RMPR4E21",75,0)
DS ;**** update shipping cost, % discount and bank authorization ********
"RTN","RMPR4E21",76,0)
 S (RMPERF,RMBANF,RMSHIF)=0
"RTN","RMPR4E21",77,0)
 I $P(^RMPR(664,RMPRA,0),U,11)="",$P(^(0),U,10) S $P(^(0),U,11)=$P(RM(RMPRA,0),U,10)
"RTN","RMPR4E21",78,0)
 S DA=RMPRA,DIE="^RMPR(664,",DR="12;17;26" D ^DIE
"RTN","RMPR4E21",79,0)
 I RMPER'=$P(^RMPR(664,RMPRA,2),U,6) S RMPERF=1
"RTN","RMPR4E21",80,0)
 I RMBAN'=$P(^RMPR(664,RMPRA,4),U,2) S RMBANF=1
"RTN","RMPR4E21",81,0)
 I RMSHI'=$P(^RMPR(664,RMPRA,0),U,11) S RMSHIF=1
"RTN","RMPR4E21",82,0)
 S:$P(^RMPR(664,RMPRA,0),U,11)="" $P(^(0),U,11)=0
"RTN","RMPR4E21",83,0)
CHK1 ;delete imcomplete items
"RTN","RMPR4E21",84,0)
 S DIK="^RMPR(664,"_RMPRA_",1,",DA(1)=RMPRA F I=0:0 S I=$O(^RMPR(664,RMPRA,1,I)) Q:I'>0  S RMPRI=$G(^(I,0)) I $P(RMPRI,U,3)=""!($P(RMPRI,U,4)="")!($P(RMPRI,U,5)="") S DA=I D ^DIK
"RTN","RMPR4E21",85,0)
 G L ;go back to select ITEM
"RTN","RMPR4E21",86,0)
 ;*************************************************************
"RTN","RMPR4E21",87,0)
POST1 ;SET AMOUNT FOR IFCAP AMENDMENT.
"RTN","RMPR4E21",88,0)
 S (R1,RMPR("AMT"),AMT,DCT,RMPRTO)=0
"RTN","RMPR4E21",89,0)
 I $D(^RMPR(664,RMPRA,2)),$P(^(2),U,6) S DCT=$P(^(2),U,6),DCT=DCT/100
"RTN","RMPR4E21",90,0)
 F RI=0:0 S RI=$O(^RMPR(664,RMPRA,1,RI)) Q:RI'>0  D
"RTN","RMPR4E21",91,0)
 .N RMACT
"RTN","RMPR4E21",92,0)
 .S RMX=$G(^RMPR(664,RMPRA,1,RI,0)),RMACT=$P(RMX,U,7),RMQTY=$P(RMX,U,4)
"RTN","RMPR4E21",93,0)
 .I DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT-$J(RMACT*DCT,0,2)*RMQTY,1:$P(RMX,U,3)-$J($P(RMX,U,3)*DCT,0,2)*RMQTY)
"RTN","RMPR4E21",94,0)
 .I 'DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT*RMQTY,1:$P(RMX,U,3)*RMQTY)
"RTN","RMPR4E21",95,0)
 .S RMPR("AMT")=RMPR("AMT")+RMTOT,RMPRTO=RMPR("AMT")
"RTN","RMPR4E21",96,0)
 S RMPRSH=$S($P(^RMPR(664,RMPRA,0),U,11)=0:0,$P(^RMPR(664,RMPRA,0),U,11):$P(^(0),U,11),$P(^RMPR(664,RMPRA,0),U,10):$P(^(0),U,10),1:"")
"RTN","RMPR4E21",97,0)
 D CHECK^RMPRCT I '$D(RMPRTO) W !,"***** NOT CLOSED-OUT !!!!" G KTMP
"RTN","RMPR4E21",98,0)
 ;**************************************************************
"RTN","RMPR4E21",99,0)
 ;check 4;3,2;8&2;9&4;6 call PRCH7C if needed
"RTN","RMPR4E21",100,0)
 ;if total amount has not changed, then don't need to call ammend
"RTN","RMPR4E21",101,0)
 ;if it is an early record with no ifcap order then don't call ammend
"RTN","RMPR4E21",102,0)
 ;set the reprint flag
"RTN","RMPR4E21",103,0)
 I $FN($P(^RMPR(664,RMPRA,4),U,3),"P",2)'=$FN(RMPRTO+RMPRSH,"P",2)&($P(^(2),U,9)="")!($P(^(2),U,9)'="")&($FN($P(^(2),U,9),"P",2)'=$FN(RMPRTO+RMPRSH,"P",2)) D  I (X=0)&'$D(^TMP("RM",$J)) W !!,"**** NOT CLOSED-OUT!! ****" G KTMP
"RTN","RMPR4E21",104,0)
 .;call IFCAP AMMEND
"RTN","RMPR4E21",105,0)
 .S RMPR442=$P(^RMPR(664,RMPRA,4),U,6) I RMPR442="" Q
"RTN","RMPR4E21",106,0)
 .D AMEND^PRCH7C(RMPR442,RMPRTO+RMPRSH)
"RTN","RMPR4E21",107,0)
 .I X=1 S $P(^RMPR(664,RMPRA,2),U,8)=DUZ,$P(^RMPR(664,RMPRA,2),U,9)=RMPRTO+RMPRSH,$P(^RMPR(664,RMPRA,2),U,10)=1
"RTN","RMPR4E21",108,0)
 .I X'=1 S $P(^RMPR(664,RMPRA,2),U,10)=""
"RTN","RMPR4E21",109,0)
 ;do posting to 660
"RTN","RMPR4E21",110,0)
 I $D(^TMP("RM",$J))!$G(RMSHIF)!$G(RMPERF)!$G(RMBANF) D POST2^RMPR4M
"RTN","RMPR4E21",111,0)
 I $D(RMPRWO),$D(^RMPR(664.2,+RMPRWO,0)) S $P(^("AM"),U,2)=1 S $P(^RMPR(664.2,+RMPRWO,0),U,7)=$P(^(0),U,7)+RMPRSH D DA0^RMPR29M(RMPRDA,RMPRA),POST^RMPR29U
"RTN","RMPR4E21",112,0)
 G:$D(RFLG) EXIT
"RTN","RMPR4E21",113,0)
 ;go to exit in above line if not close-out.
"RTN","RMPR4E21",114,0)
 ;close-out remarks
"RTN","RMPR4E21",115,0)
 W ! S DIE="^RMPR(664,",DA=RMPRA,DR="8.1" D ^DIE S RMPRCC=$P($G(^RMPR(664,RMPRA,2)),U,3)
"RTN","RMPR4E21",116,0)
 F  S R1=$O(^RMPR(664,RMPRA,1,R1)) Q:R1'>0  I $D(^(R1,0)) D
"RTN","RMPR4E21",117,0)
 .N RM660
"RTN","RMPR4E21",118,0)
 .S RM660=$P($G(^(0)),U,13) I RM660,$P($G(^RMPR(660,RM660,0)),U,18)'[RMPRCC S $P(^(0),U,18)=$P(^(0),U,18)_" "_RMPRCC
"RTN","RMPR4E21",119,0)
 ;
"RTN","RMPR4E21",120,0)
EX ;***reindex record in 664 here
"RTN","RMPR4E21",121,0)
 L -^RMPR(664,RMPRA,0)
"RTN","RMPR4E21",122,0)
 ;IFCAP final charge payment
"RTN","RMPR4E21",123,0)
 S RMPR442=$P(^RMPR(664,RMPRA,4),U,6) ;don't call recon if it is an early record, no ifcap order.
"RTN","RMPR4E21",124,0)
 D:RMPR442'="" RECON^PRCH7C(RMPR442,DUZ)
"RTN","RMPR4E21",125,0)
 I (X=0)&(RMPR442'="") W !!,"**** TRANSACTION NOT CLOSED-OUT!! ****" G EX1
"RTN","RMPR4E21",126,0)
 S $P(^RMPR(664,RMPRA,4),U,4)=RMPRTO+RMPRSH
"RTN","RMPR4E21",127,0)
 ;set close out date 
"RTN","RMPR4E21",128,0)
 D NOW^%DTC S $P(^RMPR(664,RMPRA,0),U,8)=%
"RTN","RMPR4E21",129,0)
 ;set closed by
"RTN","RMPR4E21",130,0)
 S $P(^RMPR(664,RMPRA,2),U,7)=DUZ,DA=$P(^RMPR(664,RMPRA,0),U,12)
"RTN","RMPR4E21",131,0)
 I DA'="" S $P(^RMPR(660,DA,0),U,12)=%,DIK="^RMPR(660," D IX1^DIK
"RTN","RMPR4E21",132,0)
 S RMPR660=0,DA="",DIK="^RMPR(660,"
"RTN","RMPR4E21",133,0)
 F  S RMPR660=$O(^RMPR(664,RMPRA,1,RMPR660)) Q:RMPR660'>0  D
"RTN","RMPR4E21",134,0)
 .;get pointer from item mult
"RTN","RMPR4E21",135,0)
 .S DA=$P(^RMPR(664,RMPRA,1,RMPR660,0),U,13)
"RTN","RMPR4E21",136,0)
 .;set delivery date
"RTN","RMPR4E21",137,0)
 .I DA'="" S $P(^RMPR(660,DA,0),U,12)=DT D IX1^DIK
"RTN","RMPR4E21",138,0)
 .;Patch #78 - Get IFCAP Transaction Date and prompt for Shipment Date
"RTN","RMPR4E21",139,0)
 .D ^RMPR4E23
"RTN","RMPR4E21",140,0)
EX1 ;
"RTN","RMPR4E21",141,0)
 ;added by #62
"RTN","RMPR4E21",142,0)
 D:RM68FG=1 AUTO^RMPRPCEL D:RM68FG>1 MAN^RMPRPCEL
"RTN","RMPR4E21",143,0)
 ;
"RTN","RMPR4E21",144,0)
 D EXIT
"RTN","RMPR4E21",145,0)
 W !!,"Enter Next Transaction to Close-out, or <RETURN> to continue."
"RTN","RMPR4E21",146,0)
 G CL
"RTN","RMPR4E21",147,0)
 ;
"RTN","RMPR4E21",148,0)
EXIT ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPR4E21",149,0)
 L:$D(RMPRA) -^RMPR(664,RMPRA,0)
"RTN","RMPR4E21",150,0)
 K ^TMP($J),^TMP("RM")
"RTN","RMPR4E21",151,0)
 K RGRP,RGRP1,RGRPP,RMBAN,RMBANF
"RTN","RMPR4E21",152,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR4E21",153,0)
 Q
"RTN","RMPR4E21",154,0)
 ;
"RTN","RMPR4E21",155,0)
KTMP S DIK="^RMPR(664,"_RMPRA_",1,",DA(1)=RMPRA F I=0:0 S I=$O(^TMP("RM",$J,"N",I)) Q:I'>0  S DA=I D ^DIK
"RTN","RMPR4E21",156,0)
 S %X="^TMP("_"""RM"""_",$J,RMPRA,",%Y="^RMPR(664,RMPRA," D %XY^%RCR G EX1
"RTN","RMPR4E21",157,0)
BRK W !,$C(7),"INCOMPLETE RECORD..file 664..entry..",RMPRA,"...PLEASE CONTACT YOUR IRM or CANCEL THIS ENTRY!!!" G EX1
"RTN","RMPR4E21",158,0)
UNK W !,$C(7),"UNKNOWN 2319 RECORD TO UPDATE, 2319 NOT UPDATED!" G EXIT
"RTN","RMPR4E21",159,0)
M4 W !,$C(7),"This Transaction has already been CLOSED!" G EXIT
"RTN","RMPR4E21",160,0)
M6 W !,$C(7),"This Transaction has been CANCELED!" G EXIT
"RTN","RMPR4E23")
0^4^B3669234
"RTN","RMPR4E23",1,0)
RMPR4E23 ;HINES CIOFO/TH - PROMPT FOR SHIPMENT DATE ;08/05/03
"RTN","RMPR4E23",2,0)
 ;;3.0;PROSTHETICS;**78**;Feb 09, 1996
"RTN","RMPR4E23",3,0)
 ;
"RTN","RMPR4E23",4,0)
 ;TH 08/05/03 Patch #78 - Add shipment date.
"RTN","RMPR4E23",5,0)
 ;                      - DBIA #3427
"RTN","RMPR4E23",6,0)
 ;
"RTN","RMPR4E23",7,0)
 ; RMIFCAP = IFCAP Order
"RTN","RMPR4E23",8,0)
 ; RMPRTRDT = Transaction Date from file #440.6
"RTN","RMPR4E23",9,0)
 ; RMPRSHIP = Shipment Date
"RTN","RMPR4E23",10,0)
 ;
"RTN","RMPR4E23",11,0)
 S (RMIFCAP,RMPRTRDT,RMPRSHIP)=""
"RTN","RMPR4E23",12,0)
 ; Set default to today's date
"RTN","RMPR4E23",13,0)
 S RMPRTRDT=DT
"RTN","RMPR4E23",14,0)
 I $D(^RMPR(664,RMPRA)) D
"RTN","RMPR4E23",15,0)
 . Q:'$D(^RMPR(664,RMPRA,4))
"RTN","RMPR4E23",16,0)
 . S RMIFCAP=$P(^RMPR(664,RMPRA,4),U,6) Q:RMIFCAP=""
"RTN","RMPR4E23",17,0)
 . I $D(^PRCH(440.6,"PO",RMIFCAP)) D
"RTN","RMPR4E23",18,0)
 . . S D1="",D1=$O(^PRCH(440.6,"PO",RMIFCAP,D1),-1) Q:D1=""
"RTN","RMPR4E23",19,0)
 . . Q:'$D(^PRCH(440.6,D1,0))
"RTN","RMPR4E23",20,0)
 . . S RMPRTRDT=$$GET1^DIQ(440.6,D1,6,"I")
"RTN","RMPR4E23",21,0)
 S RMPRTRDT=$$FMTE^XLFDT(RMPRTRDT,"2D")
"RTN","RMPR4E23",22,0)
 D GETDT,BILL,EXIT
"RTN","RMPR4E23",23,0)
 Q
"RTN","RMPR4E23",24,0)
 ;
"RTN","RMPR4E23",25,0)
GETDT ; DIR call to obtain the shipment date
"RTN","RMPR4E23",26,0)
 K DIR,DIRUT
"RTN","RMPR4E23",27,0)
 S DIR(0)="D",DIR("A")="Shipment Date",DIR("B")=$G(RMPRTRDT)
"RTN","RMPR4E23",28,0)
 S DIR("?")="The date that the item shipped to the patient. The default"
"RTN","RMPR4E23",29,0)
 S DIR("?")=DIR("?")_" date would be the transaction date from IFCAP."
"RTN","RMPR4E23",30,0)
 D ^DIR
"RTN","RMPR4E23",31,0)
 S RMPRSHIP=Y
"RTN","RMPR4E23",32,0)
 G:'$D(^RMPR(660,DA)) EXIT
"RTN","RMPR4E23",33,0)
 G:RMPRSHIP="" EXIT
"RTN","RMPR4E23",34,0)
 ; Shipment Date/Date of Service filed in file #660.
"RTN","RMPR4E23",35,0)
 I DA'="" S $P(^RMPR(660,DA,1),U,8)=RMPRSHIP
"RTN","RMPR4E23",36,0)
 Q
"RTN","RMPR4E23",37,0)
 ;
"RTN","RMPR4E23",38,0)
BILL ; File to #660.5 - ready to bill
"RTN","RMPR4E23",39,0)
 Q  ; taken out for phase II Billing Aware (WLC 02/26/04)
"RTN","RMPR4E23",40,0)
 N DIC,X,DLAYGO,DIR
"RTN","RMPR4E23",41,0)
 S DIC="^RMPR(660.5,"
"RTN","RMPR4E23",42,0)
 S DIC(0)="L",X="""N"""
"RTN","RMPR4E23",43,0)
 S DLAYGO=660.5 D ^DIC K DLAYGO Q:Y<1
"RTN","RMPR4E23",44,0)
 S RMPRO=+Y,DIE=DIC
"RTN","RMPR4E23",45,0)
 ;
"RTN","RMPR4E23",46,0)
 L +^RMPR(660.5,RMPRO)
"RTN","RMPR4E23",47,0)
 ; .01-Transaction Date; 2-Send Required; .02-Shipment Date
"RTN","RMPR4E23",48,0)
 ; 3-ProsFile(pointer to file #660)
"RTN","RMPR4E23",49,0)
 S DR=".01////^S X=DT;2////1;.02////^S X=RMPRSHIP;3////^S X=DA"
"RTN","RMPR4E23",50,0)
 D ^DIE
"RTN","RMPR4E23",51,0)
 L -^RMPR(660.5,RMPRO)
"RTN","RMPR4E23",52,0)
 Q
"RTN","RMPR4E23",53,0)
 ;
"RTN","RMPR4E23",54,0)
EXIT ; Exit
"RTN","RMPR4E23",55,0)
 K DA,DIC,DIE,DR,RMIFCAP,RMPRTRDT,RMPRSHIP
"RTN","RMPR4E23",56,0)
 Q
"RTN","RMPRE21")
0^5^B44342803
"RTN","RMPRE21",1,0)
RMPRE21 ;PHX/HNC - CLOSE OUT 1358 ;8/29/1994
"RTN","RMPRE21",2,0)
 ;;3.0;PROSTHETICS;**12,28,30,34,41,62,78**;Feb 09, 1996
"RTN","RMPRE21",3,0)
 ; RMS 08/25/03 Patch #78 - Add shipment date
"RTN","RMPRE21",4,0)
 ; RVD #62 - 1/14/02 include an auto-link
"RTN","RMPRE21",5,0)
 ;
"RTN","RMPRE21",6,0)
EDIT K ^TMP($J) S PRCS("A")="Select OBLIGATION NUMBER: " D EN1^PRCS58 G:Y=-1 EXIT S RMPR("OB")=$P(Y(0),U,1),RMPROB=$P(Y,U,2) D BAL^RMPRPSC
"RTN","RMPRE21",7,0)
CL K DIC S DIC="664",DIC(0)="AEQM"
"RTN","RMPRE21",8,0)
 S DIC("W")="D EN2^RMPRD1"
"RTN","RMPRE21",9,0)
 S DIC("A")="Select PATIENT: "
"RTN","RMPRE21",10,0)
 S DIC("S")="S RZZZ=^(0) I $P(RZZZ,U,3)=RMPROB,('$P(RZZZ,U,8)&'$P(RZZZ,U,5)),($P(RZZZ,U,14)=RMPR(""STA""))"
"RTN","RMPRE21",11,0)
 I RMPRSITE=1 S DIC("S")=DIC("S")_"!($P(RZZZ,U,14)="""")"
"RTN","RMPRE21",12,0)
 D ^DIC S (DA,RMPRA)=+Y I Y=-1 K:(X["^")!(X="^") RMPROB G EXIT
"RTN","RMPRE21",13,0)
 K DIC G:$P(^RMPR(664,RMPRA,0),U,8) M4 G:$P(^(0),U,5) M6
"RTN","RMPRE21",14,0)
 K ^TMP($J),RHCED D GET^RMPRFSH
"RTN","RMPRE21",15,0)
 L +^RMPR(664,RMPRA,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRE21",16,0)
 S (RMPRDFN,DFN)=$P(^RMPR(664,RMPRA,0),U,2),RMPRWO=$P(^(0),U,15),RMPRDA=$P(^(0),U,17),RMPRNAM=$P(^DPT(DFN,0),U,1),RMPRSSN=$P(^(0),U,9) K RZZZ
"RTN","RMPRE21",17,0)
 ;added by #62
"RTN","RMPRE21",18,0)
 ;get amis grouper number RGRP1
"RTN","RMPRE21",19,0)
 S RGRP1=""
"RTN","RMPRE21",20,0)
 S RGRP=$O(^RMPR(664,RMPRA,1,0)) G:'RGRP L S RGRPP=$P($G(^RMPR(664,RMPRA,1,RGRP,0)),U,13) I 'RGRPP G L
"RTN","RMPRE21",21,0)
 S RGRP1=$P($G(^RMPR(660,RGRPP,"AMS")),U,1)
"RTN","RMPRE21",22,0)
 ;
"RTN","RMPRE21",23,0)
 ;set shipping entry and collect previous linkage.
"RTN","RMPRE21",24,0)
 I $P(^RMPR(664,RMPRA,0),U,12) S RMSHIEN=$P(^RMPR(664,RMPRA,0),U,12) S:'$D(^RMPR(660,RMSHIEN,10)) RM60LINK(RMSHIEN)=""
"RTN","RMPRE21",25,0)
 D COL^RMPRPCEL
"RTN","RMPRE21",26,0)
 ;
"RTN","RMPRE21",27,0)
L D ^RMPRLI
"RTN","RMPRE21",28,0)
ASK ;ASKS THE USER IF THEY WANT TO CLOSE-OUT THE TRANSACTION
"RTN","RMPRE21",29,0)
 S:'$D(RMPRSER) RMPRSER="" K DCT S %=2
"RTN","RMPRE21",30,0)
 W !!!,"Ready to Close-Out Transaction"
"RTN","RMPRE21",31,0)
 D YN^DICN G:$D(DTOUT) EX G:%=2&(RMPRF=10) EX G:%=1 POST2^RMPRM
"RTN","RMPRE21",32,0)
 I %=0 W !!,"You may now Close-out and Post this Transaction.  Please answer Yes or No." G ASK
"RTN","RMPRE21",33,0)
 I %=-1 W !,"Transaction NOT Closed-Out!" S $P(^RMPR(664,RMPRA,0),U,11)="" K RMPROB G EXIT
"RTN","RMPRE21",34,0)
 I '$D(^RMPR(664,RMPRA,1)) S DA=RMPRA,DIE="^RMPR(664,",DR="12" D ^DIE G L
"RTN","RMPRE21",35,0)
L1 G:'$D(^RMPR(664,RMPRA,1)) L
"RTN","RMPRE21",36,0)
 W !,"Enter Item to Edit: " R X:DTIME G:'$T EXIT
"RTN","RMPRE21",37,0)
 G:X["^"!(X="") DS I X["?" D ZDSP^RMPR21A G L1
"RTN","RMPRE21",38,0)
 S DIC="^RMPR(664,"_RMPRA_",1,",DIC(0)="EQMZ"
"RTN","RMPRE21",39,0)
 D ^DIC G:Y<0 L S RMPRSD=+Y_"^"_Y(0)
"RTN","RMPRE21",40,0)
 S DA=+Y,DA(1)=RMPRA,DIE=DIC,RHCOLD=$P($G(^RMPR(664,RMPRA,1,DA,0)),U,16)
"RTN","RMPRE21",41,0)
 S RD660=$P($G(^RMPR(664,RMPRA,1,DA,0)),U,13)
"RTN","RMPRE21",42,0)
 ;S DR=".01;1;15;6;3;16;8;9;I $P(^RMPR(664,DA(1),1,DA,0),U,10)'=4 S Y="""";10"
"RTN","RMPRE21",43,0)
 S DR="8;9;S RMTYPE=$P(^RMPR(664,DA(1),1,DA,0),U,9);I $P(^RMPR(664,DA(1),1,DA,0),U,10)=4 S Y=10;.01;16;1;15;6;3;S Y="""";10;.01;16;1;15;6;3"
"RTN","RMPRE21",44,0)
 D ^DIE
"RTN","RMPRE21",45,0)
 I '$D(DA) S DIK="^RMPR(660,",DA=RD660,RHCED=1 D ^DIK K RAC,DA,DIK,RMTYPE G CHK
"RTN","RMPRE21",46,0)
 ;check for Type of Transaction and update the cpt modifier.
"RTN","RMPRE21",47,0)
 D CHKCPT^RMPR21A
"RTN","RMPRE21",48,0)
 ;force HCPCS & CPT MODIFIER in 660 even transaction is not closed.
"RTN","RMPRE21",49,0)
 S RD660=$P(^RMPR(664,RMPRA,1,DA,0),U,13),RHCNEW=$P(^(0),U,16)
"RTN","RMPRE21",50,0)
 S $P(^RMPR(660,RD660,1),U,6)=$P($G(^RMPR(664,RMPRA,1,DA,4)),U,2)
"RTN","RMPRE21",51,0)
 I RHCOLD'=RHCNEW S RHCED=1,DA=RD660,DIE="^RMPR(660,",DR="4.5///^S X=$G(RHCNEW)" D ^DIE
"RTN","RMPRE21",52,0)
CHK S FL=1 I $D(^RMPR(664,RMPRA,1)) S FL=0 F RI=0:0 S RI=$O(^RMPR(664,RMPRA,1,RI)) Q:RI'>0  I $D(^(RI,0)) S FL=1
"RTN","RMPRE21",53,0)
 I 'FL W !!,$C(7),?5,"REQUIRED ITEMS DO NOT EXIST ON THIS FORM",!,?8,"THIS TRANSACTION HAS BEEN CANCELED",! S RMPRAR=$P(^RMPR(664,RMPRA,0),U,12),$P(^(0),U,12)="" D:RMPRAR K660^RMPRC21
"RTN","RMPRE21",54,0)
 I 'FL S X=$P(^RMPR(664,RMPRA,0),U,7),DIC=424,DIC(0)="MZ" D ^DIC S $P(B2,U,7)=+Y,B3=Y(0) G C58^RMPRC21
"RTN","RMPRE21",55,0)
 G L1
"RTN","RMPRE21",56,0)
DS W !! S DA=RMPRA,DIE="^RMPR(664,",DR="12;17" D ^DIE G L
"RTN","RMPRE21",57,0)
POST1 ;POSTS THE COMPLETED TRANSACTION TO 664,660 AND 424
"RTN","RMPRE21",58,0)
 S R1=0
"RTN","RMPRE21",59,0)
 F  S R1=$O(^RMPR(664,RMPRA,1,R1)) Q:R1'>0  S RMPRAR=$S($P(^RMPR(664,RMPRA,1,R1,0),U,13)'="":$P(^(0),U,13),1:"NP") Q:R1'>0  G:'$D(^RMPR(660,+RMPRAR,0)) UNK D ^RMPRE22
"RTN","RMPRE21",60,0)
 I $D(RMPRWO),+RMPRWO D DA0^RMPR29M(RMPRDA,RMPRA)
"RTN","RMPRE21",61,0)
 I $P(^RMPR(664,RMPRA,0),U,10)>0&($P(^(0),U,11)=0)&($P(^(0),U,12)) S DA=$P(^(0),U,12),DIK="^RMPR(660," D ^DIK
"RTN","RMPRE21",62,0)
 I $P(^RMPR(664,RMPRA,0),U,12)&(RMPRSH>0) S $P(^RMPR(660,$P(^RMPR(664,RMPRA,0),U,12),0),U,16)=RMPRSH,$P(^(0),U,12)=DT D
"RTN","RMPRE21",63,0)
 .S DA=$P(^RMPR(664,RMPRA,0),U,12),DIK="^RMPR(660," D IX1^DIK
"RTN","RMPRE21",64,0)
 .I $D(RMPRWO),$D(^RMPR(664.2,+RMPRWO,0)) S $P(^RMPR(664.2,RMPRWO,0),U,7)=$P(^(0),U,7)+RMPRSH D POST^RMPR29U
"RTN","RMPRE21",65,0)
 ; Prompt for Shipment Date, mark as billable, Patch 78, Added by RMS
"RTN","RMPRE21",66,0)
 D ^RMPR4E23
"RTN","RMPRE21",67,0)
 I RMPRSH>0&('$P(^RMPR(664,RMPRA,0),U,12))&($P(^(0),U,11)) G PSH
"RTN","RMPRE21",68,0)
 W !!,?5,$C(7),"Closed out Transaction"
"RTN","RMPRE21",69,0)
 N DA,DIK S DA=RMPRA,DIK="^RMPR(664," D IX1^DIK
"RTN","RMPRE21",70,0)
 G EX
"RTN","RMPRE21",71,0)
PSH S RMPRB=$O(^RMPR(664,RMPRA,1,0))
"RTN","RMPRE21",72,0)
 S X=DT,DIC(0)="AEQLM",DLAYGO=660,DIC="^RMPR(660,"
"RTN","RMPRE21",73,0)
 S DIC("DR")=".02////^S X="_$P(^RMPR(664,RMPRA,0),U,2)
"RTN","RMPRE21",74,0)
 K DINUM,DD,DO D FILE^DICN K DLAYGO
"RTN","RMPRE21",75,0)
 S ^RMPR(660,+Y,0)=DT_U_RMPRDFN_U_$P(^RMPR(664,RMPRA,0),U)_"^X^^^^^"_$P(^(0),U,4)_U_RMPR("STA")_U_$P(^RMPR(664,RMPRA,1,RMPRB,0),U,15)_U_DT_U_$S($P(^RMPR(660,$P(^RMPR(664,RMPRA,1,RMPRB,0),U,13),0),U,13):$P(^(0),U,13),1:"")
"RTN","RMPRE21",76,0)
 S $P(^RMPR(660,+Y,0),U,14)="C"
"RTN","RMPRE21",77,0)
 S $P(^RMPR(660,+Y,0),U,16)=$G(RMPRSH)
"RTN","RMPRE21",78,0)
 S $P(^RMPR(660,+Y,0),U,17)=$G(RMPRSH)
"RTN","RMPRE21",79,0)
 ;INITIATOR
"RTN","RMPRE21",80,0)
 S $P(^RMPR(660,+Y,0),U,27)=$G(DUZ)
"RTN","RMPRE21",81,0)
 ;HCPCS code
"RTN","RMPRE21",82,0)
 S RMHCPC=$P(^RMPR(664,RMPRA,1,RMPRB,0),U,16)
"RTN","RMPRE21",83,0)
 S:RMHCPC $P(^RMPR(660,+Y,0),U,22)=$P(^RMPR(661.1,RMHCPC,0),U,4)
"RTN","RMPRE21",84,0)
 S $P(^RMPR(660,+Y,1),U,4)=RMHCPC
"RTN","RMPRE21",85,0)
 S ^RMPR(660,+Y,"AM")=U_U_$P(^RMPR(664,RMPRA,1,RMPRB,0),U,10)_U_$P(^RMPR(664,RMPRA,1,RMPRB,0),U,11)
"RTN","RMPRE21",86,0)
 S $P(^RMPR(660,+Y,"AMS"),U,1)=$G(RGRP1)
"RTN","RMPRE21",87,0)
 ;
"RTN","RMPRE21",88,0)
 ;use da in ix1^dik call
"RTN","RMPRE21",89,0)
 S:$D(Y) $P(^RMPR(664,RMPRA,0),U,12)=+Y
"RTN","RMPRE21",90,0)
 S INX=+Y
"RTN","RMPRE21",91,0)
 I $D(RMPRWO),$D(^RMPR(664.2,+RMPRWO,0)) N Y S $P(^("AM"),U,2)=1 S $P(^RMPR(664.2,RMPRWO,0),U,7)=$P(^RMPR(664.2,RMPRWO,0),U,7)+RMPRSH D DA0^RMPR29M(RMPRDA,RMPRA),POST^RMPR29U
"RTN","RMPRE21",92,0)
 S DA=INX,DIK="^RMPR(660," D IX1^DIK
"RTN","RMPRE21",93,0)
 S RM60LINK(INX)=""
"RTN","RMPRE21",94,0)
 ;
"RTN","RMPRE21",95,0)
 W !!,?5,$C(7),"Closed out 1358 Transaction"
"RTN","RMPRE21",96,0)
 N DA,DIK S DA=RMPRA,DIK="^RMPR(664," D IX1^DIK
"RTN","RMPRE21",97,0)
 ;
"RTN","RMPRE21",98,0)
 G EX
"RTN","RMPRE21",99,0)
EX D EN1^RMPRFSH L -^RMPR(664,RMPRA,0) I RMPRF'=10,RMPRF'="E" D LINK^RMPRS
"RTN","RMPRE21",100,0)
 ;added by #62
"RTN","RMPRE21",101,0)
 ;call suspense listmanager screen for multiple suspense and items.
"RTN","RMPRE21",102,0)
 I $D(RM60LINK),RMPRF="E",RM68FG>1 D MAN^RMPRPCEL
"RTN","RMPRE21",103,0)
 ;
"RTN","RMPRE21",104,0)
 ;do auto-link if only one suspense
"RTN","RMPRE21",105,0)
 I $D(RM60LINK),RMPRF="E",RM68FG=1 D AUTO^RMPRPCEL
"RTN","RMPRE21",106,0)
 K INX,RM68LINK,RM668I,RM660I,RM664DAT,RM668D10,RM60LINK,RMSHIEN,RM68LIFG
"RTN","RMPRE21",107,0)
 ;
"RTN","RMPRE21",108,0)
 I $D(RMPRF),RMPRF'=10 W !!,"Enter Next Transaction to Close-out, or <RETURN> to Continue."
"RTN","RMPRE21",109,0)
 K RMPR("AMT"),RMPRAR,RMPRSER,RMPRTO,RMPRCT,RMPRQT,RMPRSH,RZZZ,R1,B2,%,Y,DIC,R2,RMPRA,RMPRCTDA,DIE,DIK,DR,RMPR("DRN"),RMPR("DDT"),DCT,DIR,B3,RMPRB K ^TMP($J)
"RTN","RMPRE21",110,0)
 K RGRP,RGRP1,RGRPP
"RTN","RMPRE21",111,0)
 I $D(RMPRF),RMPRF=10 Q
"RTN","RMPRE21",112,0)
 K X G CL
"RTN","RMPRE21",113,0)
 ;
"RTN","RMPRE21",114,0)
EXIT ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPRE21",115,0)
 D:$D(^TMP($J))&'$D(RHCED) EN2^RMPRFSH L:$D(RMPRA) -^RMPR(664,RMPRA,0)
"RTN","RMPRE21",116,0)
 K PRCSCPAN,LINE,PRCSIP,RMPRAMIS,RMPRCNT,RMPRIT,RMPRIT1,RMPRU,RMPRX,RMPR("AMT"),AMT,BO,PRCSX,PRCS("A"),RMPRA1,RMPRDFN,RMPRNAM,RMPRSSN,RMPRAR
"RTN","RMPRE21",117,0)
 K DCT,RMPRTO,RMPRCT,RMPRQT,RMPRSH,RZZZ,R1,B2,%,Y,DIC,R2,RMPRA,RMPRCT,RMPRI,RMPRCONT,DIR,RMX,RHCED,RHCNEW,RHCOLD
"RTN","RMPRE21",118,0)
 K RMPRSER,FL,RMPRN,RMPRI1,RA,DIRUT,DA,DFN,DIE,DIK,DR,RMPR("DRN"),RMPR("DDT"),RMPR("OB"),RD,RC,RIT,RIN,RZ,RT,RF,RE,RAC,RMPRSD,DCTZ,ACT,RI,RMPRP,RMPR90,RMPRAMT,RMPRPSC,^TMP($J),B2,RMPRCC,B3,J,K,DIR,PQTY,RD660
"RTN","RMPRE21",119,0)
 I $D(RMPROB) D PRCS^RMPRPSC G:(X'["^")!(X'="^") CL
"RTN","RMPRE21",120,0)
 K RMPRF,RMPROB,PRC,RMHCPC,PRCRI,RBL,RDA,RMPRDELN,RMPRWO,RVA Q
"RTN","RMPRE21",121,0)
UNK W !,$C(7),"UNKNOWN 2319 RECORD TO UPDATE, IFCAP DAILY RECORD NOT UPDATED!" G EXIT
"RTN","RMPRE21",122,0)
M4 W !,$C(7),"This Transaction has already been CLOSED!" G EXIT
"RTN","RMPRE21",123,0)
M6 W !,$C(7),"This Transaction has been CANCELED!" G EXIT
"RTN","RMPRHL7A")
0^1^B33495720
"RTN","RMPRHL7A",1,0)
RMPRHL7A ;HINES CIOFO/HNC - Receive HL-7 CPRS Message, parse into components and store in File 668 ;3/13/00
"RTN","RMPRHL7A",2,0)
 ;;3.0;PROSTHETICS;**45,78**;Feb 09, 1996
"RTN","RMPRHL7A",3,0)
 ;
"RTN","RMPRHL7A",4,0)
 ;Patch #78 - 09/25/03 - TH - Add multiple DG1 and ZCL segments.
"RTN","RMPRHL7A",5,0)
 ;
"RTN","RMPRHL7A",6,0)
 Q
"RTN","RMPRHL7A",7,0)
URG(X) ;Return Urgency give Z-code from HL-7 segment; see ORC+9
"RTN","RMPRHL7A",8,0)
 S X=$S(X="S":"STAT",X="R":"ROUTINE",X="ZT":"TODAY",X="Z24":"WITHIN 24 HOURS",X="Z48":"WITHIN 48 HOURS",X="Z72":"WITHIN 72 HOURS",X="ZW":"WITHIN 1 WEEK",X="ZM":"WITHIN 1 MONTH",X="ZNA":"NEXT AVAILABLE",1:X)
"RTN","RMPRHL7A",9,0)
 I $E(X,1)="Z" S X=$S(X="ZT":"TODAY",X="ZE":"EMERGENCY",1:"")
"RTN","RMPRHL7A",10,0)
 Q X
"RTN","RMPRHL7A",11,0)
 ;
"RTN","RMPRHL7A",12,0)
ORC(RMPRORC) ;Get fields from ORC segment and set into RMPR variables
"RTN","RMPRHL7A",13,0)
 ;RMPRTRLC=ORC control code from HL7 Table 119
"RTN","RMPRHL7A",14,0)
 ;RMPRURGI=priority/urgency     RMPRPLCR=who entered the order
"RTN","RMPRHL7A",15,0)
 ;RMPRORNP=provider             RMPRNATO=nature of order
"RTN","RMPRHL7A",16,0)
 ;RMPRAD=date of request        RMPROCR=order request reason
"RTN","RMPRHL7A",17,0)
 ;RMPR RMPRORFN=oe/rr file number
"RTN","RMPRHL7A",18,0)
 ;RMPRO=file 668 IEN - if not a new order
"RTN","RMPRHL7A",19,0)
 ;RMPRS38=order status - taken from Table 38, HL7 standard
"RTN","RMPRHL7A",20,0)
 I $E(RMPRMSG,1,6)'="ORC|NW" S RMPRQT=1 Q
"RTN","RMPRHL7A",21,0)
 S RMPRTRLC=$P(RMPRORC,"|",2)
"RTN","RMPRHL7A",22,0)
 S RMPRORFN=$P(RMPRORC,"|",3)
"RTN","RMPRHL7A",23,0)
 S RMPRORFN=$P($P(RMPRORFN,"^",1),";",1)
"RTN","RMPRHL7A",24,0)
 S RMPRAPP=$P($P(RMPRORC,"|",3),"^",2)
"RTN","RMPRHL7A",25,0)
 S RMPRS38=$P(RMPRORC,"|",6)
"RTN","RMPRHL7A",26,0)
 S RMPRURGI=$P($P(RMPRORC,"|",8),"^",6)
"RTN","RMPRHL7A",27,0)
 S RMPRPLCR=$P(RMPRORC,"|",11)
"RTN","RMPRHL7A",28,0)
 S RMPRORNP=$P(RMPRORC,"|",13)
"RTN","RMPRHL7A",29,0)
 I $L(RMPRURGI) S RMPRURGI=$$URG(RMPRURGI)
"RTN","RMPRHL7A",30,0)
 S RMPRO=+$P($P(RMPRORC,"|",4),"^",1)
"RTN","RMPRHL7A",31,0)
 N RMPRODT S RMPRODT=$P(RMPRORC,"|",16)
"RTN","RMPRHL7A",32,0)
 S RMPRAD=$$FMDATE^RMPRHL7(RMPRODT)
"RTN","RMPRHL7A",33,0)
 S RMPROCR=$P(RMPRORC,"|",17)
"RTN","RMPRHL7A",34,0)
 S RMPRNATO=$P(RMPROCR,"^",5)
"RTN","RMPRHL7A",35,0)
 Q
"RTN","RMPRHL7A",36,0)
OBR(RMPROBR) ;Get fields from OBR segment and set into RMPR variables
"RTN","RMPRHL7A",37,0)
 ;RMPRSS=type of consult, field 9, 1-4 if NO, then not prosthetics
"RTN","RMPRHL7A",38,0)
 ;Must have 99CON in RMPR99C.
"RTN","RMPRHL7A",39,0)
 ;
"RTN","RMPRHL7A",40,0)
 ;RMPRODT=observation date/time
"RTN","RMPRHL7A",41,0)
 ;RMPRPRI=procedure from file ^ORD(101,
"RTN","RMPRHL7A",42,0)
 ;
"RTN","RMPRHL7A",43,0)
 N RMPR99C
"RTN","RMPRHL7A",44,0)
 S RMPR99C=$P($P(RMPROBR,"|",5),"^",6)
"RTN","RMPRHL7A",45,0)
 I RMPR99C'="99CON" S RMPRSS="NO",RMPRQT=1 Q
"RTN","RMPRHL7A",46,0)
 S RMPRSST=$P($P(RMPROBR,"|",5),"^",4)
"RTN","RMPRHL7A",47,0)
 S RMPRSS=$P(^GMR(123.5,RMPRSST,0),U,1) D
"RTN","RMPRHL7A",48,0)
 .;translate to set of codes
"RTN","RMPRHL7A",49,0)
 .I RMPRSS["PROSTHETICS REQUEST" S RMPRSS=1 Q
"RTN","RMPRHL7A",50,0)
 .I RMPRSS["CONTACT LENS REQUEST" S RMPRSS=3 Q
"RTN","RMPRHL7A",51,0)
 .I RMPRSS["HOME OXYGEN REQUEST" S RMPRSS=4 Q
"RTN","RMPRHL7A",52,0)
 .I RMPRSS["EYEGLASS REQUEST" S RMPRSS=2 Q
"RTN","RMPRHL7A",53,0)
 .;then not prosthetics
"RTN","RMPRHL7A",54,0)
 .S RMPRSS="NO"
"RTN","RMPRHL7A",55,0)
 ;
"RTN","RMPRHL7A",56,0)
 I RMPRSS="NO" S RMPRQT=1 Q
"RTN","RMPRHL7A",57,0)
 ;
"RTN","RMPRHL7A",58,0)
 S RMPRODT=$P(RMPROBR,"|",7)
"RTN","RMPRHL7A",59,0)
 I RMPRODT]"" S RMPRODT=$$FMDATE^RMPRHL7(RMPRODT)
"RTN","RMPRHL7A",60,0)
 S RMPRATN=$P(RMPROBR,"|",20)
"RTN","RMPRHL7A",61,0)
 S RMPRSTDT=$P(RMPROBR,"|",23)
"RTN","RMPRHL7A",62,0)
 S RMPRSTDT=$$FMDATE^RMPRHL7(RMPRSTDT)
"RTN","RMPRHL7A",63,0)
 S RMPRS668=$P(RMPROBR,"|",26)
"RTN","RMPRHL7A",64,0)
 S RMPRINTR=$P(RMPROBR,"|",33)
"RTN","RMPRHL7A",65,0)
 Q
"RTN","RMPRHL7A",66,0)
 ;
"RTN","RMPRHL7A",67,0)
DG1(RMPRDG1) ;Get fields from DG1 and ZCL segments
"RTN","RMPRHL7A",68,0)
 ; RMPRSID = Set ID
"RTN","RMPRHL7A",69,0)
 ; RMPRDIAG = pointer to ICD DIAGNOSIS (#80)
"RTN","RMPRHL7A",70,0)
 ; RMPRCI = Outpat. Classification Type
"RTN","RMPRHL7A",71,0)
 ; RMPRVAL = Value of each SC or EI - 0,1,Null.
"RTN","RMPRHL7A",72,0)
 S RMPRMSG=MSG(RMPRDG1)
"RTN","RMPRHL7A",73,0)
 S RMPRSID=$P(RMPRMSG,"|",2)
"RTN","RMPRHL7A",74,0)
 I $P(RMPRMSG,"|",1)="DG1" D
"RTN","RMPRHL7A",75,0)
 . S RMPRDIAG=$P($P(RMPRMSG,"|",4),"^",1)
"RTN","RMPRHL7A",76,0)
 . S RMPRMSG1(RMPRSID,1)=RMPRDIAG
"RTN","RMPRHL7A",77,0)
 I $P(RMPRMSG,"|",1)="ZCL" D
"RTN","RMPRHL7A",78,0)
 . S RMPRCI=$P(RMPRMSG,"|",3)
"RTN","RMPRHL7A",79,0)
 . S RMPRVAL=$P(RMPRMSG,"|",4)
"RTN","RMPRHL7A",80,0)
 . S RMPRMSG1(RMPRSID,RMPRCI+1)=RMPRVAL
"RTN","RMPRHL7A",81,0)
 Q 
"RTN","RMPRHL7A",82,0)
 ;
"RTN","RMPRHL7A",83,0)
ZSV(RMPRZSV) ;Get service from ZSV segment
"RTN","RMPRHL7A",84,0)
 S RMPRZSS=$P($P(RMPRZSV,"|",2),"^",4)
"RTN","RMPRHL7A",85,0)
 ;Set the service if ZSV provided
"RTN","RMPRHL7A",86,0)
 I $L($P(RMPRZSV,"|",3)) S RMPROTXT=$P(RMPRZSV,"|",3) ;consult type
"RTN","RMPRHL7A",87,0)
 Q
"RTN","RMPRHL7A",88,0)
 ;
"RTN","RMPRHL7A",89,0)
OBX(RMPROBX) ;Get fields from OBX segment and set into RMPR variables
"RTN","RMPRHL7A",90,0)
 ;RMPRVTYP=Value type from table 668-i.e. TX(text), ST(string data),etc.
"RTN","RMPRHL7A",91,0)
 ;RMPROID=observation id identifying value in seg. 5
"RTN","RMPRHL7A",92,0)
 ;RMPRVAL=observation value coded by segment 3
"RTN","RMPRHL7A",93,0)
 ;RMPRPRDG=provisional diagnosis
"RTN","RMPRHL7A",94,0)
 ;free text or code^free text^I9C
"RTN","RMPRHL7A",95,0)
 S RMPRMSG=MSG(RMPROBX)
"RTN","RMPRHL7A",96,0)
 S RMPRVTYP=$P(RMPRMSG,"|",3),RMPROID=$P($P(RMPRMSG,"|",4),"^",2)
"RTN","RMPRHL7A",97,0)
 S RMPRVAL=$P(RMPROID,"^",3)
"RTN","RMPRHL7A",98,0)
 I RMPROID="REASON FOR REQUEST" D
"RTN","RMPRHL7A",99,0)
 .S RMPRRFQ(1)=$P(RMPRMSG,"|",6)
"RTN","RMPRHL7A",100,0)
 .S LN=0 F  S LN=$O(MSG(RMPROBX,LN)) Q:LN=""  S RMPRRFQ(LN+1)=MSG(RMPROBX,LN)
"RTN","RMPRHL7A",101,0)
 .Q
"RTN","RMPRHL7A",102,0)
 I RMPROID="PROVISIONAL DIAGNOSIS" D  Q
"RTN","RMPRHL7A",103,0)
 . I RMPRVTYP="TX" S RMPRPRDG=$P(RMPRMSG,"|",6) Q
"RTN","RMPRHL7A",104,0)
 . I RMPRVTYP="CE" D  Q
"RTN","RMPRHL7A",105,0)
 .. N PRDXSEG S PRDXSEG=$P(RMPRMSG,"|",6)
"RTN","RMPRHL7A",106,0)
 .. S RMPRPRDG=$P(PRDXSEG,"^",2)_" ("_$P(PRDXSEG,"^")_")"
"RTN","RMPRHL7A",107,0)
 .. S RMPRPRCD=$P(PRDXSEG,"^")
"RTN","RMPRHL7A",108,0)
 I RMPROID["COMMENT" D
"RTN","RMPRHL7A",109,0)
 .S RMPRCMT(1)=$P(RMPRMSG,"|",6)
"RTN","RMPRHL7A",110,0)
 .S LN=0 F  S LN=$O(MSG(RMPROBX,NL)) Q:LN=""  S RMPRCMT(LN+1)=MSG(RMPROBX,LN)
"RTN","RMPRHL7A",111,0)
 .Q
"RTN","RMPRHL7A",112,0)
 K LN
"RTN","RMPRHL7A",113,0)
 Q
"RTN","RMPRHL7A",114,0)
 ;
"RTN","RMPRHL7A",115,0)
EN(MSG) ;Entry point from protocol RMPR RECEIVE
"RTN","RMPRHL7A",116,0)
 ;
"RTN","RMPRHL7A",117,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","RMPRHL7A",118,0)
 ;RMPRFAC=sending facility
"RTN","RMPRHL7A",119,0)
 ;RMPRMTP=message type
"RTN","RMPRHL7A",120,0)
 N DFN,RMPRACT,RMPRADD,RMPRFAC,RMPRMTP,RMPRPNM,RMPRO,RMPROCR,RMPRORNP
"RTN","RMPRHL7A",121,0)
 N RMPRORFN,RMPRPLCR,RMPRRB,RMPRSEND,RMPRSTS,RMPRTRLC,RMPRWARD,ORIFN
"RTN","RMPRHL7A",122,0)
 N RMPRTRLC,RMPRAD,ORC,RMPRSBR,RMPRZSS,RMPRSS,RMPRSST,RMPROTXT
"RTN","RMPRHL7A",123,0)
 N RMPRMSGO
"RTN","RMPRHL7A",124,0)
 S RMPRMSG="",RMPRNOD=0,RMPRI=0
"RTN","RMPRHL7A",125,0)
 F  S RMPRNOD=$O(MSG(RMPRNOD)) Q:RMPRNOD=""  S RMPRMSG=MSG(RMPRNOD) I $E(RMPRMSG,1,3)="MSH" D  Q
"RTN","RMPRHL7A",126,0)
 .S RMPRSEND=$P(RMPRMSG,"|",3),RMPRFAC=$P(RMPRMSG,"|",4),RMPRMTP=$P(RMPRMSG,"|",9)
"RTN","RMPRHL7A",127,0)
 .Q
"RTN","RMPRHL7A",128,0)
 ;RMPRQT, stop flag in loop
"RTN","RMPRHL7A",129,0)
 S RMPRMSG="",RMPRNOD=0,RMPRQT=0,N=0
"RTN","RMPRHL7A",130,0)
 F  S RMPRNOD=$O(MSG(RMPRNOD)) Q:RMPRNOD=""  Q:RMPRQT=1  S RMPRMSG=MSG(RMPRNOD) D
"RTN","RMPRHL7A",131,0)
 .I $E(RMPRMSG,1,3)="PID" D PID^RMPRHL7U(RMPRMSG) Q
"RTN","RMPRHL7A",132,0)
 .I $E(RMPRMSG,1,3)="PV1" D PV1^RMPRHL7U(RMPRMSG) Q
"RTN","RMPRHL7A",133,0)
 .;look at ORC|NW for new order
"RTN","RMPRHL7A",134,0)
 .I $E(RMPRMSG,1,3)="ORC" D ORC(RMPRMSG) Q
"RTN","RMPRHL7A",135,0)
 .I RMPRQT=1 Q
"RTN","RMPRHL7A",136,0)
 .I $E(RMPRMSG,1,3)="OBR" D OBR(RMPRMSG) I RMPRSS="NO" S RMPRQT=1 K RMPRSS Q
"RTN","RMPRHL7A",137,0)
 .I RMPRQT=1 Q
"RTN","RMPRHL7A",138,0)
 .;Patch #78 - Add multiple DG1 and ZCL segments
"RTN","RMPRHL7A",139,0)
 .I $E(RMPRMSG,1,3)="DG1"!($E(RMPRMSG,1,3)="ZCL") D DG1(RMPRNOD) Q
"RTN","RMPRHL7A",140,0)
 .;look at ZSV for Prosthetic (4)
"RTN","RMPRHL7A",141,0)
 .I $E(RMPRMSG,1,3)="ZSV" D ZSV(RMPRMSG) Q
"RTN","RMPRHL7A",142,0)
 .I $E(RMPRMSG,1,3)="OBX" D OBX(RMPRNOD) Q
"RTN","RMPRHL7A",143,0)
 .;I $E(RMPRMSG,1,3)="NTE" D NTE^RMPRHL7U(.MSG,RMPRNOD,RMPRO,RMPRTRLC) Q
"RTN","RMPRHL7A",144,0)
 .Q
"RTN","RMPRHL7A",145,0)
 K N
"RTN","RMPRHL7A",146,0)
 ;check for new order, NW, and a prosthetic consult in RMPRSS
"RTN","RMPRHL7A",147,0)
 I '$D(RMPRTRLC) D EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",148,0)
 I RMPRTRLC'="NW" D EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",149,0)
 I '$D(RMPRSS) D EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",150,0)
 I RMPRSS="NO" D EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",151,0)
 ;
"RTN","RMPRHL7A",152,0)
 D NEW^RMPRHL7B
"RTN","RMPRHL7A",153,0)
 ;
"RTN","RMPRHL7A",154,0)
 I '$D(RMPRO) D REJECT^RMPRHL7U(.MSG,"unable to file order"),EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",155,0)
 ;
"RTN","RMPRHL7A",156,0)
 D RTN(RMPRORFN,.RMPRO)
"RTN","RMPRHL7A",157,0)
 ;
"RTN","RMPRHL7A",158,0)
 D EXIT^RMPRHL7U
"RTN","RMPRHL7A",159,0)
 Q
"RTN","RMPRHL7A",160,0)
 ;
"RTN","RMPRHL7A",161,0)
RTN(RMPRORN,RMPRO) ;Put ^OR(100, ien for order into ^RMPR(668, 
"RTN","RMPRHL7A",162,0)
 S DA=RMPRO
"RTN","RMPRHL7A",163,0)
 S DIE="^RMPR(668,",DR="19////^S X=RMPRORN"
"RTN","RMPRHL7A",164,0)
 L +^RMPR(668,RMPRO) D ^DIE L -^RMPR(668,RMPRO)
"RTN","RMPRHL7A",165,0)
 K DIE,DR
"RTN","RMPRHL7A",166,0)
 ; set file 123 ien
"RTN","RMPRHL7A",167,0)
 S RMPRGMRC=$$PKGID^ORX8($P(^RMPR(668,RMPRO,0),U,14))
"RTN","RMPRHL7A",168,0)
 I RMPRGMRC["GMRC" S $P(^RMPR(668,RMPRO,0),U,15)=+RMPRGMRC
"RTN","RMPRHL7A",169,0)
 E  D REJECT^RMPRHL7U(.MSG),EXIT^RMPRHL7U
"RTN","RMPRHL7A",170,0)
 Q
"RTN","RMPRHL7B")
0^2^B11924217
"RTN","RMPRHL7B",1,0)
RMPRHL7B ;HINES/HNC - Process order parameters set file 668 ;3-21-00
"RTN","RMPRHL7B",2,0)
 ;;3.0;PROSTHETICS;**45,52,62,78**;Feb 09, 1996
"RTN","RMPRHL7B",3,0)
 ;
"RTN","RMPRHL7B",4,0)
 ; ODJ - patch 52 - 10/13/00 - remove leading blank lines from
"RTN","RMPRHL7B",5,0)
 ;                             consult text
"RTN","RMPRHL7B",6,0)
 ; RVD - patch 62 - update ICD9 field from the HL7 message.
"RTN","RMPRHL7B",7,0)
 ; TH  - patch 78 - 09/26/03 - update ICD9 codes, value for each SC and 
"RTN","RMPRHL7B",8,0)
 ;                             EI. 
"RTN","RMPRHL7B",9,0)
 ;
"RTN","RMPRHL7B",10,0)
NEW ;Create new suspense
"RTN","RMPRHL7B",11,0)
 ;
"RTN","RMPRHL7B",12,0)
 ;RMPRO=^RMPR(668,IFN, the new file number in file ^RMPR(668,
"RTN","RMPRHL7B",13,0)
 ;RMPRORFN=OE/RR file number (pointer to Order file)
"RTN","RMPRHL7B",14,0)
 ;RMPRWARD=ward patient is on
"RTN","RMPRHL7B",15,0)
 ;RMPRSS=type of consult
"RTN","RMPRHL7B",16,0)
 ;RMPRAD=date/time of request
"RTN","RMPRHL7B",17,0)
 ;RMPRPRI=procedure/request       
"RTN","RMPRHL7B",18,0)
 ;RMPRURGI=urgency POINTER 101 TO FREE T
"RTN","RMPRHL7B",19,0)
 ;RMPRORNP=patient's ordering provider
"RTN","RMPRHL7B",20,0)
 ;RMPRTYPE=request type (request or consult)
"RTN","RMPRHL7B",21,0)
 ;RMPRSBR=service rendered on what basis (Inpatient, or Outpatient)
"RTN","RMPRHL7B",22,0)
 ;RMPRRFQ=reason for request array - word processing fields
"RTN","RMPRHL7B",23,0)
 ;RMPRPRDG=provisional DX
"RTN","RMPRHL7B",24,0)
 ;RMPRPRCD=provisional DX code
"RTN","RMPRHL7B",25,0)
 ;
"RTN","RMPRHL7B",26,0)
 ;
"RTN","RMPRHL7B",27,0)
 ;next 4 lines added by patch #62
"RTN","RMPRHL7B",28,0)
 S RMPRIECD=""
"RTN","RMPRHL7B",29,0)
 I $D(RMPRPRCD),RMPRPRCD'="" D
"RTN","RMPRHL7B",30,0)
 .S RMPRIECD=$O(^ICD9("BA",RMPRPRCD,0))
"RTN","RMPRHL7B",31,0)
 .I '$G(RMPRIECD) S RMPRIECD=$O(^ICD9("BA",RMPRPRCD_" ",0))
"RTN","RMPRHL7B",32,0)
 ; next 5 lines added by patch #78
"RTN","RMPRHL7B",33,0)
 ; override previous Provisional Diagnosis code with first BA code
"RTN","RMPRHL7B",34,0)
 I $D(RMPRMSG1(1,1)) S RMPRPRCD=$$GET1^DIQ(80,RMPRMSG1(1,1)_",",.01),RMPRIECD=RMPRMSG1(1,1)
"RTN","RMPRHL7B",35,0)
 I '$G(RMPRIECD) D
"RTN","RMPRHL7B",36,0)
 . N RMLP F RMLP=2:1:4 I $D(RMPRMSG1(RMLP,1)) S RMPRPRCD=$$GET1^DIQ(RMPRMSG1(RMLP,1)_",",.01),RMPRIECD=RMPRMSG1(RMLP,1) Q
"RTN","RMPRHL7B",37,0)
 ;
"RTN","RMPRHL7B",38,0)
 N DIC,DLAYGO,X,DR,DIE
"RTN","RMPRHL7B",39,0)
 S DIC="^RMPR(668,",DIC(0)="L",X="""N""",DLAYGO=668 D ^DIC K DLAYGO Q:Y<1
"RTN","RMPRHL7B",40,0)
 S (DA,RMPRO)=+Y,DIE=DIC
"RTN","RMPRHL7B",41,0)
 ;
"RTN","RMPRHL7B",42,0)
 L +^RMPR(668,RMPRO)
"RTN","RMPRHL7B",43,0)
 ; .01-Suspense date;22-Date RX written
"RTN","RMPRHL7B",44,0)
 S DR=".01////^S X=RMPRAD;22////^S X=RMPRAD"
"RTN","RMPRHL7B",45,0)
 ; 1-Veteran;19-CPRS order #;2-station;9-Type or request;2.3-Urgency
"RTN","RMPRHL7B",46,0)
 ; 30-Consult Visit#
"RTN","RMPRHL7B",47,0)
 S DR=DR_";1////^S X=DFN;19////^S X=RMPRORFN;2////^S X=RMPRFAC;9////^S X=RMPRSS;2.3////^S X=RMPRURGI;30////^S X=VISIT"
"RTN","RMPRHL7B",48,0)
 D ^DIE
"RTN","RMPRHL7B",49,0)
 ;
"RTN","RMPRHL7B",50,0)
 ; 8-Suspense by (ordering provider);14-Status (O=Open);
"RTN","RMPRHL7B",51,0)
 ; 3-Suspense form (9=for other);13-Requestor (ordering provider)
"RTN","RMPRHL7B",52,0)
 ; 1.5-Provisional Diagnosis;1.6-ICD9
"RTN","RMPRHL7B",53,0)
 S DR="8////^S X=RMPRORNP;14////^S X=""O"";3////^S X=9;13////^S X=RMPRORNP;1.5////^S X=$G(RMPRPRDG);1.6////^S X=$G(RMPRIECD)"
"RTN","RMPRHL7B",54,0)
 D ^DIE
"RTN","RMPRHL7B",55,0)
 ;
"RTN","RMPRHL7B",56,0)
 ; Patch 78: Update ICD9 and value of each SC and EI.
"RTN","RMPRHL7B",57,0)
 S RMPRMAX=8  ; ao - cv
"RTN","RMPRHL7B",58,0)
 F RMPRI=1:1:99 Q:'$D(RMPRMSG1(RMPRI))  S DR="" D
"RTN","RMPRHL7B",59,0)
 . F RMPRJ=1:1:RMPRMAX S RMVALUE=$G(RMPRMSG1(RMPRI,RMPRJ)) D
"RTN","RMPRHL7B",60,0)
 . . S DR=DR_"3"_(RMPRI-1)_$S(RMPRJ>1:"."_(RMPRJ-1),1:"")_"////^S X="
"RTN","RMPRHL7B",61,0)
 . . S DR=DR_$S(RMVALUE="":"""""",1:RMVALUE)_$S(RMPRJ<RMPRMAX:";",1:"")
"RTN","RMPRHL7B",62,0)
 . . D ^DIE
"RTN","RMPRHL7B",63,0)
 ; following lines deleted by WLC 05/24/04
"RTN","RMPRHL7B",64,0)
 ; New BA Phase II modifications for multiples
"RTN","RMPRHL7B",65,0)
 ;S RMPRMAX=8
"RTN","RMPRHL7B",66,0)
 ;F RMPRI=1:1:99 Q:'$D(RMPRMSG1(RMPRI))  K FDA D
"RTN","RMPRHL7B",67,0)
 ;. S FDA(668.02,"+"_RMPRI_","_RMPRO_",",.01)=RMPRMSG1(RMPRI,1)
"RTN","RMPRHL7B",68,0)
 ;. F RMPRJ=2:1:RMPRMAX S RMVALUE=$G(RMPRMSG1(RMPRI,RMPRJ)) D
"RTN","RMPRHL7B",69,0)
 ;. . S FDA(668.02,"+"_RMPRI_","_RMPRO_",","30."_RMPRJ)=RMVALUE
"RTN","RMPRHL7B",70,0)
 ;. S DIE=668.02
"RTN","RMPRHL7B",71,0)
 ;. D UPDATE^DIE(,"FDA") I $D(^TMP("DIERR",$J))
"RTN","RMPRHL7B",72,0)
 ;K FDA
"RTN","RMPRHL7B",73,0)
 ;
"RTN","RMPRHL7B",74,0)
 I $O(RMPRRFQ(0)) D REASON
"RTN","RMPRHL7B",75,0)
 L -^RMPR(668,RMPRO)
"RTN","RMPRHL7B",76,0)
 ;
"RTN","RMPRHL7B",77,0)
 D REASON
"RTN","RMPRHL7B",78,0)
 D EXIT
"RTN","RMPRHL7B",79,0)
 Q
"RTN","RMPRHL7B",80,0)
REASON ;load the reason for request into description of item field 4
"RTN","RMPRHL7B",81,0)
 ;^RMPR(668,D0,2,D1,0)
"RTN","RMPRHL7B",82,0)
 ;
"RTN","RMPRHL7B",83,0)
 N RMPRC
"RTN","RMPRHL7B",84,0)
 S ^RMPR(668,RMPRO,2,0)="^^^"_$S($D(RMPRDA):RMPRDA,1:DT)_"^"
"RTN","RMPRHL7B",85,0)
 S RMPRL=0,RMPRLN=0
"RTN","RMPRHL7B",86,0)
 F  S RMPRL=$O(RMPRRFQ(RMPRL)) Q:RMPRL=""  D
"RTN","RMPRHL7B",87,0)
 . I 'RMPRLN D  Q:RMPRC=""  ;strip leading space from 1st line, ignore blank line
"RTN","RMPRHL7B",88,0)
 .. S RMPRC=$E($TR(RMPRRFQ(RMPRL)," ","")) ;1st non space char
"RTN","RMPRHL7B",89,0)
 .. S:RMPRC'="" RMPRRFQ(RMPRL)=$E(RMPRRFQ(RMPRL),$F(RMPRRFQ(RMPRL),RMPRC)-1,$L(RMPRRFQ(RMPRL))) ;extract from 1st non space char to end of line
"RTN","RMPRHL7B",90,0)
 .. Q
"RTN","RMPRHL7B",91,0)
 . S RMPRLN=RMPRLN+1,^RMPR(668,RMPRO,2,RMPRLN,0)=RMPRRFQ(RMPRL)
"RTN","RMPRHL7B",92,0)
 . Q
"RTN","RMPRHL7B",93,0)
 S $P(^RMPR(668,RMPRO,2,0),"^",3)=RMPRLN
"RTN","RMPRHL7B",94,0)
 K RMPRL,RMPRLN
"RTN","RMPRHL7B",95,0)
 Q
"RTN","RMPRHL7B",96,0)
 ;
"RTN","RMPRHL7B",97,0)
EXIT ;common exit
"RTN","RMPRHL7B",98,0)
 K DA,DIC,DIE,DR,RMPRORTX
"RTN","RMPRHL7B",99,0)
 K RMPRI,RMPRJ,RMPRMAX,RMVALUE,RMPRMSG1,RMPRPRCD,RMPRIECD
"RTN","RMPRHL7B",100,0)
 Q
"RTN","RMPRHL7B",101,0)
 ;END
"RTN","RMPRHL7U")
0^10^B6054692
"RTN","RMPRHL7U",1,0)
RMPRHL7U ;HINES CIOFO/HNC - Utilities for HL7 messages ;3/14/00
"RTN","RMPRHL7U",2,0)
 ;;3.0;PROSTHETICS;**45,78**;Feb 09, 1996
"RTN","RMPRHL7U",3,0)
 ;
"RTN","RMPRHL7U",4,0)
 ;Patch #78 09/26/03 TH - Add field desc for PV1 & ZCL segments.
"RTN","RMPRHL7U",5,0)
 ;                      - Clean up DG1 related variables.
"RTN","RMPRHL7U",6,0)
 Q
"RTN","RMPRHL7U",7,0)
 ;
"RTN","RMPRHL7U",8,0)
PID(RMPRPID) ;Get fields from PID segment and set into RMPR variables.
"RTN","RMPRHL7U",9,0)
 S DFN=$P(RMPRPID,"|",4),RMPRPNM=$P(RMPRPID,"|",6)
"RTN","RMPRHL7U",10,0)
 Q
"RTN","RMPRHL7U",11,0)
 ;
"RTN","RMPRHL7U",12,0)
PV1(RMPRPV1) ;
"RTN","RMPRHL7U",13,0)
 ;Get fields from PV1 segment of HL-7 message and set into RMPR variables
"RTN","RMPRHL7U",14,0)
 N X
"RTN","RMPRHL7U",15,0)
 ; RMPRSBR = service basis to be rendered (Inpatient or Outpatient)
"RTN","RMPRHL7U",16,0)
 S X=$P(RMPRPV1,"|",3),RMPRSBR=$S(X]"":X,1:"")
"RTN","RMPRHL7U",17,0)
 ;
"RTN","RMPRHL7U",18,0)
 ; Patient Location
"RTN","RMPRHL7U",19,0)
 ; Inpatient: Hospital Location IEN^Room-Bed
"RTN","RMPRHL7U",20,0)
 ; Outpatinet: Hospital Location IEN
"RTN","RMPRHL7U",21,0)
 ; RMPRWARD=patients ward
"RTN","RMPRHL7U",22,0)
 S X=$P(RMPRPV1,"|",4),RMPRWARD=$S($P(X,"^",1)]"":$P(X,"^",1),1:"")
"RTN","RMPRHL7U",23,0)
 ; RMPRRB  = patients room/bed
"RTN","RMPRHL7U",24,0)
 S RMPRRB=$S($P(X,"^",2)]"":$P(X,"^",2),1:"")
"RTN","RMPRHL7U",25,0)
 ;
"RTN","RMPRHL7U",26,0)
 ; Outpatient: VISIT=Pointer for the Visit file (#9000010)
"RTN","RMPRHL7U",27,0)
 S VISIT=$S($P(RMPRPV1,"|",20)]"":$P(RMPRPV1,"|",20),1:"")
"RTN","RMPRHL7U",28,0)
 N RMPRVSIT S:VISIT]"" RMPRVSIT=$$FMDATE^RMPRHL7(VISIT)
"RTN","RMPRHL7U",29,0)
 Q
"RTN","RMPRHL7U",30,0)
 ;
"RTN","RMPRHL7U",31,0)
REJECT(RMPRMSG) ;can't be filed send reject message
"RTN","RMPRHL7U",32,0)
 ;
"RTN","RMPRHL7U",33,0)
 ;send message to mail group RMPR SUSP
"RTN","RMPRHL7U",34,0)
 N XMDUZ
"RTN","RMPRHL7U",35,0)
 S XMDUZ=.5
"RTN","RMPRHL7U",36,0)
 S XMTEXT="RMPRMSG("
"RTN","RMPRHL7U",37,0)
 S XMSUB="Request Failed to Suspense"
"RTN","RMPRHL7U",38,0)
 S XMY("RMPR SUSP")=""
"RTN","RMPRHL7U",39,0)
 D ^XMD
"RTN","RMPRHL7U",40,0)
 Q
"RTN","RMPRHL7U",41,0)
 ;
"RTN","RMPRHL7U",42,0)
FILE(RMPRO,DR) ;File data "^"RMPR(668,IEN,4 using "^"DIE
"RTN","RMPRHL7U",43,0)
 N DIE,DA
"RTN","RMPRHL7U",44,0)
 ;RMPRO = IEN
"RTN","RMPRHL7U",45,0)
 L +^RMPR(668,+RMPRO,4) S:'$D(^RMPR(668,+RMPRO,4,0)) ^(0)="^668.02DA^^"
"RTN","RMPRHL7U",46,0)
 S DA=$S($P(^RMPR(668,+RMPRO,4,0),"^",3):$P(^(0),"^",3)+1,1:1),DA(1)=+RMPRO
"RTN","RMPRHL7U",47,0)
 S DIE="^RMPR(668,"_RMPRO_",4,"
"RTN","RMPRHL7U",48,0)
 S $P(^RMPR(668,+RMPRO,4,0),"^",3,4)=DA_"^"_DA
"RTN","RMPRHL7U",49,0)
 D ^DIE
"RTN","RMPRHL7U",50,0)
 L -^RMPR(668,+RMPRO,4)
"RTN","RMPRHL7U",51,0)
 Q
"RTN","RMPRHL7U",52,0)
 ;
"RTN","RMPRHL7U",53,0)
EXIT ;Kill variables and exit
"RTN","RMPRHL7U",54,0)
 K HLQ,J,LN,ND,ND1,ND2
"RTN","RMPRHL7U",55,0)
 K RMPRA,RMPRACT,RMPRAD,RMPRAP,RMPRAPP,RMPRATN,RMPRDA,RMPRDEV,RMPRFAC
"RTN","RMPRHL7U",56,0)
 K RMPRFF,RMPRINTR,RMPRMTP,RMPRMSG,RMPRMSH,RMPRNOD,RMPRNTC,RMPRODT
"RTN","RMPRHL7U",57,0)
 K RMPROID,RMPRORFN,RMPRPA,RMPRPLCR,RMPRPLI,RMPRPNM,RMPRPR,RMPRPRI,RMPRFQ
"RTN","RMPRHL7U",58,0)
 K RMPRPRDG,RMPRSEND,RMPRSTDT,RMPRSTS,RMPRURGI,RMPRVAL,RMPRVTYP,RMPRWARD
"RTN","RMPRHL7U",59,0)
 K RMPRPRV,RMPRTYPE,RMPRND,RMPRND1,VISIT
"RTN","RMPRHL7U",60,0)
 K RMPRRB,RMPRPRA,RMPRRFQ,MSH,OBXND,PID,RMPRORPV,RMPROTXT
"RTN","RMPRHL7U",61,0)
 K RMPRTRLC,RMPRSS,RMPRO,RMPRORNP
"RTN","RMPRHL7U",62,0)
 K RMPRGMRC,RMPRCD,RMPRNATO,RMPRQT,RMPRS38,RMPRS668
"RTN","RMPRHL7U",63,0)
 K DA,DIC
"RTN","RMPRHL7U",64,0)
 K RMPRMSG,RMPRCI,RMPRSID,RMPRDIAG,RMPRDG1
"RTN","RMPRHL7U",65,0)
 Q
"RTN","RMPRHL7U",66,0)
 ;END
"RTN","RMPRPCE1")
0^9^B29214954
"RTN","RMPRPCE1",1,0)
RMPRPCE1 ;HCIOFO/RVD - Prosthetics/PCE UPDATE UTILITY ;5/7/03  09:12
"RTN","RMPRPCE1",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,78**;Feb 09, 1996
"RTN","RMPRPCE1",3,0)
 ;
"RTN","RMPRPCE1",4,0)
 ;patch #69
"RTN","RMPRPCE1",5,0)
 ;RVD 4/10/02 - validate the length (16 c) of provisional diagnosis
"RTN","RMPRPCE1",6,0)
 ;              before filing.  Change Routine Prosthetic to ROUTINE
"RTN","RMPRPCE1",7,0)
 ;              Type of Request field in 660.
"RTN","RMPRPCE1",8,0)
 ;RVD 5/6/03 patch #77 - SET Consult Request Service field in #660.
"RTN","RMPRPCE1",9,0)
 ;                     - POST init for setting Consult Request Service. 
"RTN","RMPRPCE1",10,0)
 ;TH 9/29/03 Patch #78 - Add Billing Aware related fields.
"RTN","RMPRPCE1",11,0)
 ;
"RTN","RMPRPCE1",12,0)
 ;DBIA # 10060, Fileman read of file #200.
"RTN","RMPRPCE1",13,0)
 ;
"RTN","RMPRPCE1",14,0)
 ;This routine contains the code for updating file #660 and #668.
"RTN","RMPRPCE1",15,0)
 ;
"RTN","RMPRPCE1",16,0)
 ;RMIE60 - ien of file #660
"RTN","RMPRPCE1",17,0)
UP60(RMIE60,RMIE68,RMSUSTAT) ; update file #660.
"RTN","RMPRPCE1",18,0)
 D NEWVAR
"RTN","RMPRPCE1",19,0)
 S RMERR=0
"RTN","RMPRPCE1",20,0)
 S:RMSUSTAT="" RMSUSTAT=0
"RTN","RMPRPCE1",21,0)
 L +^RMPR(660,RMIE60):2
"RTN","RMPRPCE1",22,0)
 I $T=0 W !,"Someone else is Editing this entry!!!",! H 3 S RMERR=1 G UP60X
"RTN","RMPRPCE1",23,0)
 S RM680=$G(^RMPR(668,RMIE68,0))
"RTN","RMPRPCE1",24,0)
 S RM688=$G(^RMPR(668,RMIE68,8))
"RTN","RMPRPCE1",25,0)
 S RM6810=$G(^RMPR(668,RMIE68,10))
"RTN","RMPRPCE1",26,0)
 ;code here for 668 fields
"RTN","RMPRPCE1",27,0)
 S RMDATE=$P(RM680,U,1)  ;Suspense Date
"RTN","RMPRPCE1",28,0)
 S RMCODT=$P(RM680,U,5)  ;Completion Date
"RTN","RMPRPCE1",29,0)
 S RMINDT=$P(RM680,U,9)  ;Initial Action Date
"RTN","RMPRPCE1",30,0)
 S RMPRCO=$P(RM680,U,15) ;Consult
"RTN","RMPRPCE1",31,0)
 S RMDWRT=$P(RM680,U,16) ;Date RX Written
"RTN","RMPRPCE1",32,0)
 S RMSTAT=$P(RM680,U,7)  ;Station
"RTN","RMPRPCE1",33,0)
 S RMTRES=$P(RM680,U,8)  ;Type of Request
"RTN","RMPRPCE1",34,0)
 S RMTYRE=$S(RMTRES=1:"ROUTINE",RMTRES=2:"EYEGLASS",RMTRES=3:"CONTACT LENS",RMTRES=4:"OXYGEN",RMTRES=5:"MANUAL",1:"")
"RTN","RMPRPCE1",35,0)
 S RMREQU=$P(RM680,U,11) ;Requestor (Ordering Provider)
"RTN","RMPRPCE1",36,0)
 S RMSERV=""
"RTN","RMPRPCE1",37,0)
 ;I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPRPCE1",38,0)
 S RMPRDI=$E($P(RM688,U,2),1,16) ;Provisional Diagnosis
"RTN","RMPRPCE1",39,0)
 S RMICD9=$P(RM688,U,3)   ;ICD9
"RTN","RMPRPCE1",40,0)
 ;
"RTN","RMPRPCE1",41,0)
 S RMDAT(660,RMIE60_",",8.1)=RMDATE    ;Suspense Date
"RTN","RMPRPCE1",42,0)
 S RMDAT(660,RMIE60_",",8.2)=RMDWRT    ;Date RX Written
"RTN","RMPRPCE1",43,0)
 S RMDAT(660,RMIE60_",",8.3)=RMINDT    ;Initial Action Date
"RTN","RMPRPCE1",44,0)
 S RMDAT(660,RMIE60_",",8.4)=RMCODT    ;Completion Date
"RTN","RMPRPCE1",45,0)
 S RMDAT(660,RMIE60_",",8.5)=RMTYRE    ;Type of Request
"RTN","RMPRPCE1",46,0)
 S RMDAT(660,RMIE60_",",8.6)=RMREQU    ;Ordering Provider
"RTN","RMPRPCE1",47,0)
 S RMDAT(660,RMIE60_",",8.61)=RMSERV   ;Consult Request Service
"RTN","RMPRPCE1",48,0)
 S RMDAT(660,RMIE60_",",8.7)=RMPRDI    ;Provisional Diagnosis
"RTN","RMPRPCE1",49,0)
 S RMDAT(660,RMIE60_",",8.8)=RMICD9    ;Suspense ICD9
"RTN","RMPRPCE1",50,0)
 S RMDAT(660,RMIE60_",",8.9)=RMPRCO    ;Pointer to Request/Consultation
"RTN","RMPRPCE1",51,0)
 S RMDAT(660,RMIE60_",",8.11)=RMSTAT   ;Suspense Station
"RTN","RMPRPCE1",52,0)
 S RMDAT(660,RMIE60_",",8.14)=RMSUSTAT ;Suspense Status
"RTN","RMPRPCE1",53,0)
 ;
"RTN","RMPRPCE1",54,0)
 ; Patch #78
"RTN","RMPRPCE1",55,0)
 ; #668,BA nodes
"RTN","RMPRPCE1",56,0)
 F RMPRL=1:1:99 S RM68BA=$G(^RMPR(668,RMIE68,"BA"_RMPRL)) Q:RM68BA=""  D
"RTN","RMPRPCE1",57,0)
 . N RMICD,RMAO,RMIR,RMSC,RMEC,RMMST,RMHNC,RMCBV
"RTN","RMPRPCE1",58,0)
 . S RMICD=$P(RM68BA,U,1)
"RTN","RMPRPCE1",59,0)
 . S RMAO=$P(RM68BA,U,2)
"RTN","RMPRPCE1",60,0)
 . S RMIR=$P(RM68BA,U,3)
"RTN","RMPRPCE1",61,0)
 . S RMSC=$P(RM68BA,U,4)
"RTN","RMPRPCE1",62,0)
 . S RMEC=$P(RM68BA,U,5)
"RTN","RMPRPCE1",63,0)
 . S RMMST=$P(RM68BA,U,6)
"RTN","RMPRPCE1",64,0)
 . S RMHNC=$P(RM68BA,U,7)
"RTN","RMPRPCE1",65,0)
 . S RMCBV=$P(RM68BA,U,8)
"RTN","RMPRPCE1",66,0)
 . N RMPTR
"RTN","RMPRPCE1",67,0)
 . S RMPTR=29+RMPRL
"RTN","RMPRPCE1",68,0)
 . S RMDAT(660,RMIE60_",",RMPTR)=RMICD
"RTN","RMPRPCE1",69,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".1")=RMAO
"RTN","RMPRPCE1",70,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".2")=RMIR
"RTN","RMPRPCE1",71,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".3")=RMSC
"RTN","RMPRPCE1",72,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".4")=RMEC
"RTN","RMPRPCE1",73,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".5")=RMMST
"RTN","RMPRPCE1",74,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".6")=RMHNC
"RTN","RMPRPCE1",75,0)
 . S RMDAT(660,RMIE60_",",RMPTR_".7")=RMCBV
"RTN","RMPRPCE1",76,0)
 ;
"RTN","RMPRPCE1",77,0)
 D UPDATE^DIE("","RMDAT",,"RMERROR")
"RTN","RMPRPCE1",78,0)
 I $D(RMERROR) S RMERR=1 D ERR0
"RTN","RMPRPCE1",79,0)
 ;
"RTN","RMPRPCE1",80,0)
 L -^RMPR(660,RMIE60)
"RTN","RMPRPCE1",81,0)
UP60X ; exit point
"RTN","RMPRPCE1",82,0)
 Q RMERR
"RTN","RMPRPCE1",83,0)
 ;
"RTN","RMPRPCE1",84,0)
 ;RMIE60 = IEN of file #660.
"RTN","RMPRPCE1",85,0)
 ;RMIE68 = IEN of file #668.
"RTN","RMPRPCE1",86,0)
UP68(RMIE60,RMIE68,RMAMIS) ; update file #668.
"RTN","RMPRPCE1",87,0)
 D NEWVAR
"RTN","RMPRPCE1",88,0)
 S (RMI,RMERR)=0
"RTN","RMPRPCE1",89,0)
 ;S RMAMIS=$G(^RMPR(660,RMIE60,"AMS"))
"RTN","RMPRPCE1",90,0)
 I '$G(RMAMIS) D ERR8 S RMERR=1 G UP68X
"RTN","RMPRPCE1",91,0)
 ;L +^RMPR(668,RMIE68):2
"RTN","RMPRPCE1",92,0)
 ;I $T=0 W !,"Someone else is Editing this entry!!!",! H 3 S RMERR=1 G UP68X
"RTN","RMPRPCE1",93,0)
 I $D(^RMPR(668,RMIE68,10,"B",RMIE60)) G UP68X
"RTN","RMPRPCE1",94,0)
 S DA(1)=RMIE68 K DD,DO
"RTN","RMPRPCE1",95,0)
 S DIC="^RMPR(668,"_DA(1)_","_"10,",DIC(0)="L",DLAYGO=668,X=RMIE60
"RTN","RMPRPCE1",96,0)
 D FILE^DICN K DIC,X,DLAYGO,DD,DO
"RTN","RMPRPCE1",97,0)
 I Y=-1 S RMERR=1 D ERR8 G UNL68
"RTN","RMPRPCE1",98,0)
 I $D(^RMPR(668,RMIE68,11,"B",RMAMIS)) G UP68X
"RTN","RMPRPCE1",99,0)
 S DA(1)=RMIE68
"RTN","RMPRPCE1",100,0)
 S DIC="^RMPR(668,"_DA(1)_","_"11,",DIC(0)="L",DLAYGO=668,X=RMAMIS
"RTN","RMPRPCE1",101,0)
 D FILE^DICN K DIC
"RTN","RMPRPCE1",102,0)
 I Y=-1 S RMERR=1 D ERR8 G UNL68
"RTN","RMPRPCE1",103,0)
 ;
"RTN","RMPRPCE1",104,0)
UNL68 ;L -^RMPR(668,RMIE68)
"RTN","RMPRPCE1",105,0)
UP68X ; exit point
"RTN","RMPRPCE1",106,0)
 Q RMERR
"RTN","RMPRPCE1",107,0)
 ;
"RTN","RMPRPCE1",108,0)
ERR0 ;error updating file #660
"RTN","RMPRPCE1",109,0)
 W !,"*** Error updating file #660 in PCE module!!!",!
"RTN","RMPRPCE1",110,0)
 Q
"RTN","RMPRPCE1",111,0)
ERR8 ;error updating file #668
"RTN","RMPRPCE1",112,0)
 W !,"*** Error updating file #668 in PCE module!!!",!
"RTN","RMPRPCE1",113,0)
 Q
"RTN","RMPRPCE1",114,0)
LINK ;link 2319 to suspense
"RTN","RMPRPCE1",115,0)
 D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPRPCE1",116,0)
 K ^TMP($J)
"RTN","RMPRPCE1",117,0)
 W ! S DIC="^RMPR(660,",DIC(0)="AEMQZ",DIC("A")="Select PATIENT: "
"RTN","RMPRPCE1",118,0)
 S DIC("S")="S RMZ=$G(^RMPR(660,+Y,10)) I $P(RMZ,U,14)'=1,$D(^(""AMS"")),RMPR(""STA"")=$P(^(0),U,10)"
"RTN","RMPRPCE1",119,0)
 S DIC("W")="D EN^RMPRD1"
"RTN","RMPRPCE1",120,0)
 W !
"RTN","RMPRPCE1",121,0)
 D ^DIC G:Y'>0 EXIT
"RTN","RMPRPCE1",122,0)
 L +^RMPR(660,+Y):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRPCE1",123,0)
 S RMPRDA=+Y
"RTN","RMPRPCE1",124,0)
 S RMPRDFN=$P(^RMPR(660,+Y,0),U,2)
"RTN","RMPRPCE1",125,0)
 I $D(^RMPR(660,+Y,"AMS")) N RMPRAMIS S RMPRAMIS=$P(^RMPR(660,+Y,"AMS"),U,1)
"RTN","RMPRPCE1",126,0)
 S ^TMP($J,"RMPRPCE",660,+Y)=RMPRAMIS_"^"_RMPRDFN
"RTN","RMPRPCE1",127,0)
 D LINK^RMPRS
"RTN","RMPRPCE1",128,0)
 L -^RMPR(660,RMPRDA)
"RTN","RMPRPCE1",129,0)
EXIT ;quit
"RTN","RMPRPCE1",130,0)
 K ^TMP($J)
"RTN","RMPRPCE1",131,0)
 K RMPR,RMPRSTE
"RTN","RMPRPCE1",132,0)
 K RMCODT
"RTN","RMPRPCE1",133,0)
 D KILL^XUSCLEAN
"RTN","RMPRPCE1",134,0)
 Q
"RTN","RMPRPCE1",135,0)
 ;
"RTN","RMPRPCE1",136,0)
SCRS ;set consult request service.
"RTN","RMPRPCE1",137,0)
 ;start conversion on 1/1/2002, the date of PCE/Link to suspense patch.
"RTN","RMPRPCE1",138,0)
 W !!,"Setting Consult Request Service in file #660....."
"RTN","RMPRPCE1",139,0)
 N RI,RJ F RI=3020100:0 S RI=$O(^RMPR(660,"B",RI)) Q:RI'>0  F RJ=0:0 S RJ=$O(^RMPR(660,"B",RI,RJ)) Q:RJ'>0  I $D(^RMPR(660,RJ,10)) D
"RTN","RMPRPCE1",140,0)
 .K RMAA
"RTN","RMPRPCE1",141,0)
 .S RMREQU=$P(^RMPR(660,RJ,10),U,6)
"RTN","RMPRPCE1",142,0)
 .S RMSERV=""
"RTN","RMPRPCE1",143,0)
 .I $G(RMREQU) D GETS^DIQ(200,RMREQU,"29","E","RMAA") S RMSERV=RMAA(200,RMREQU_",",29,"E")
"RTN","RMPRPCE1",144,0)
 .S:RMSERV'="" $P(^RMPR(660,RJ,4),U,3)=RMSERV
"RTN","RMPRPCE1",145,0)
 W !!,"Done setting Consult Request Service!!",!
"RTN","RMPRPCE1",146,0)
 Q
"RTN","RMPRPCE1",147,0)
 ;
"RTN","RMPRPCE1",148,0)
NEWVAR N DA,DIE,DIC,I,J,RMDFN,RMI,RMDATE,RM680,RM688,RM6810,RMERROR
"RTN","RMPRPCE1",149,0)
 N RMERR,RMCHK,RMAMIS,DLAYGO,X,DR,RMAA,RMSERV,RMREQU,RMDAT
"RTN","RMPRPCE1",150,0)
 N RMPRL,RM68BA,RMDWRT,RMICD9,RMINDT,RMPRCO,RMPRDI,RMSTAT,RMTRES,RMTYRE
"RTN","RMPRPCE1",151,0)
 Q
"RTN","RMPRPCEA")
0^8^B50058297
"RTN","RMPRPCEA",1,0)
RMPRPCEA ;HCIOFO/RVD - Prosthetics/PCE Interface; 05/31/01
"RTN","RMPRPCEA",2,0)
 ;;3.0;PROSTHETICS;**62,82,78**;Feb 09, 1996
"RTN","RMPRPCEA",3,0)
 ;
"RTN","RMPRPCEA",4,0)
 ; RMS  10/1/03 Patch 78 - Change Service connected, and environmental
"RTN","RMPRPCEA",5,0)
 ;                         indicators (Agent Orange, Ionizing Radiation,
"RTN","RMPRPCEA",6,0)
 ;                         Environmental Contaminants, Military Sexual
"RTN","RMPRPCEA",7,0)
 ;                         Trauma, Head/Neck Cancer, and Combat Veteran
"RTN","RMPRPCEA",8,0)
 ;                         Status) to come from new BA fields if they
"RTN","RMPRPCEA",9,0)
 ;                         exist.
"RTN","RMPRPCEA",10,0)
 ;
"RTN","RMPRPCEA",11,0)
 ;This routine contains the code for sending a Prosthetic visit to PCE.
"RTN","RMPRPCEA",12,0)
 ;
"RTN","RMPRPCEA",13,0)
 ;DBIA #1889-A  - this API is used to add, edit and delete the
"RTN","RMPRPCEA",14,0)
 ;                of encounter, provider, diagnosis and procedure
"RTN","RMPRPCEA",15,0)
 ;                data to VISIT and V files in the PCE module.
"RTN","RMPRPCEA",16,0)
 ; 04/23/2004 KAM RMPR*3*82 Make Background Message more Robust
"RTN","RMPRPCEA",17,0)
 ;
"RTN","RMPRPCEA",18,0)
 ;RMIE60 - ien in file #660
"RTN","RMPRPCEA",19,0)
SENDPCE(RMIE60) ; send a Prosthetic Visit to PCE.
"RTN","RMPRPCEA",20,0)
 ; D NEWVAR subroutine removed for functionality  01/31/05  WLC
"RTN","RMPRPCEA",21,0)
 ;
"RTN","RMPRPCEA",22,0)
 N RMPROB,RMPCE,RME2,RMSENT,RMLOCK,RMERR,RMPKG,RMSRC,RMDIAG,RMQTY
"RTN","RMPRPCEA",23,0)
 N RMSCAT,RMPROC,RMUPD,RMIEPCE,RMHLOC,RMLOC,RMPAT,RMDATE,RMINST
"RTN","RMPRPCEA",24,0)
 N RMETYP,RMCDAT,RMPCAT,RMDANOW,DIE,DA,DIC,RMAO,RMEC,RMIR,DFN,RMSCON
"RTN","RMPRPCEA",25,0)
 N RMMST,RMHNC,RMCBV
"RTN","RMPRPCEA",26,0)
 ; PATCH 78, RMS - 10/1/2003, Billing aware related variables
"RTN","RMPRPCEA",27,0)
 N RMBASCON,RMBAAO,RMBAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV,RMBAICD9,RMLOOP
"RTN","RMPRPCEA",28,0)
 N RMPROV,RMCPDT
"RTN","RMPRPCEA",29,0)
 ;
"RTN","RMPRPCEA",30,0)
 S RMERR=1
"RTN","RMPRPCEA",31,0)
 S RMSRC="PROSTHETICS DATA"
"RTN","RMPRPCEA",32,0)
 S RMPKG=$O(^DIC(9.4,"B","PROSTHETICS",0))
"RTN","RMPRPCEA",33,0)
 I '$G(RMPKG) S RMERR=-2 G SENDPCEX
"RTN","RMPRPCEA",34,0)
 S RMSTA=$P(^RMPR(660,RMIE60,0),U,10)
"RTN","RMPRPCEA",35,0)
 S (RMLOC,RERRMSG,RERRMSG2)=""
"RTN","RMPRPCEA",36,0)
 F I=0:0 S I=$O(^RMPR(669.9,"C",RMSTA,I)) Q:I'>0  D
"RTN","RMPRPCEA",37,0)
 .I ($D(^RMPR(669.9,I,0))),($D(^RMPR(669.9,I,"PCE"))) S RMLOC=$P(^RMPR(669.9,I,"PCE"),U,3)
"RTN","RMPRPCEA",38,0)
 ;exit if Hospital Location (clinic) not defined.
"RTN","RMPRPCEA",39,0)
 I '$G(RMLOC) D  G SENDPCEX
"RTN","RMPRPCEA",40,0)
 .S RMERR=-2
"RTN","RMPRPCEA",41,0)
 .;RMPR*3*82 04/23/2004 KAM Added next 8 lines
"RTN","RMPRPCEA",42,0)
 .N SPACES,VNAME,ENDAT
"RTN","RMPRPCEA",43,0)
 .S VNAME=$$GET1^DIQ(2,$P(^RMPR(660,RMIE60,0),U,2),.01)
"RTN","RMPRPCEA",44,0)
 .S ENDAT=$$GET1^DIQ(660,RMIE60,.01),SPACES=""
"RTN","RMPRPCEA",45,0)
 .I $G(ENDAT)="" S ENDAT=" No Entry Data Found"
"RTN","RMPRPCEA",46,0)
 .F I=1:1:42-($L(VNAME)+$L(ENDAT)) S SPACES=$G(SPACES)_" "
"RTN","RMPRPCEA",47,0)
 .S RERRMSG="              *** NAME = "_VNAME_"   ENTRY DATE = "_ENDAT_SPACES
"RTN","RMPRPCEA",48,0)
 .S RERRMSG=RERRMSG_"              *** Clinic is not defined....Please ask your ADPAC to enter a prosthetics      *** clinic in the Prosthetics Site Parameters file for station # = "_$G(RMSTA)
"RTN","RMPRPCEA",49,0)
 .S RERRMSG2="         *** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",50,0)
 .W !,"*** Clinic is not defined....."
"RTN","RMPRPCEA",51,0)
 .W !,"*** Please ask your ADPAC to enter a prosthetics clinic in the"
"RTN","RMPRPCEA",52,0)
 .W !,"*** Prosthetics Site Parameters file for station # = ",RMSTA
"RTN","RMPRPCEA",53,0)
 .W !,"*** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",54,0)
 S RMSENT=0,RMLOCK=0
"RTN","RMPRPCEA",55,0)
 ; initialize temp file.
"RTN","RMPRPCEA",56,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",57,0)
 ;
"RTN","RMPRPCEA",58,0)
 ; get the visit data (#660) and place in temp file.
"RTN","RMPRPCEA",59,0)
 D GETDATA
"RTN","RMPRPCEA",60,0)
 ;don't create a PCE encounter if Date of Death is before the transaction
"RTN","RMPRPCEA",61,0)
 I $D(VADM(6)),$P(VADM(6),U,1),$P(VADM(6),U,1)<(RMDATE) G SENDPCEX
"RTN","RMPRPCEA",62,0)
 ;
"RTN","RMPRPCEA",63,0)
 ; build the temp file for sending to PCE
"RTN","RMPRPCEA",64,0)
 D BUILD
"RTN","RMPRPCEA",65,0)
 ;
"RTN","RMPRPCEA",66,0)
 ; now send
"RTN","RMPRPCEA",67,0)
 D SENDIT
"RTN","RMPRPCEA",68,0)
 ;
"RTN","RMPRPCEA",69,0)
SENDPCEX ; exit point
"RTN","RMPRPCEA",70,0)
 ;
"RTN","RMPRPCEA",71,0)
 ; clear the temp file
"RTN","RMPRPCEA",72,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",73,0)
 ;
"RTN","RMPRPCEA",74,0)
 ; return
"RTN","RMPRPCEA",75,0)
 Q RMERR
"RTN","RMPRPCEA",76,0)
 ;
"RTN","RMPRPCEA",77,0)
GETDATA ; get the visit data and place in temp file
"RTN","RMPRPCEA",78,0)
 K RMDA,RMDA2
"RTN","RMPRPCEA",79,0)
 S RMDA=$NA(^TMP("RMPRPCE1",$J,"RM"))
"RTN","RMPRPCEA",80,0)
 D GETS^DIQ(660,RMIE60_",","*","I",RMDA,"")
"RTN","RMPRPCEA",81,0)
 S RMDA2=$NA(^TMP("RMPRPCE1",$J,"RM",660,RMIE60_","))
"RTN","RMPRPCEA",82,0)
 D NOW^%DTC
"RTN","RMPRPCEA",83,0)
 S RMDANOW=%
"RTN","RMPRPCEA",84,0)
 S RMDATE=@RMDA2@(.01,"I"),RMDATE=RMDATE_"."_$P(%,".",2)
"RTN","RMPRPCEA",85,0)
 S (DFN,RMPAT)=@RMDA2@(.02,"I")
"RTN","RMPRPCEA",86,0)
 S RMHLOC=RMLOC
"RTN","RMPRPCEA",87,0)
 S RMINST=@RMDA2@(8.11,"I")
"RTN","RMPRPCEA",88,0)
 S RMPCAT=@RMDA2@(62,"I")
"RTN","RMPRPCEA",89,0)
 S RMSCON=0
"RTN","RMPRPCEA",90,0)
 I (RMPCAT=1)!(RMPCAT=2) S RMSCON=1
"RTN","RMPRPCEA",91,0)
 ;==============================
"RTN","RMPRPCEA",92,0)
 S RMSCAT="A"
"RTN","RMPRPCEA",93,0)
 S RMETYP="P"
"RTN","RMPRPCEA",94,0)
 S RMUSER=@RMDA2@(27,"I")
"RTN","RMPRPCEA",95,0)
 S RMDIAG=@RMDA2@(8.8,"I")
"RTN","RMPRPCEA",96,0)
 S RMPROC=@RMDA2@(4.1,"I")
"RTN","RMPRPCEA",97,0)
 S RMPROV=@RMDA2@(8.6,"I")
"RTN","RMPRPCEA",98,0)
 S RMCPDT=@RMDA2@(8.4,"I")
"RTN","RMPRPCEA",99,0)
 S RMQTY=@RMDA2@(5,"I")
"RTN","RMPRPCEA",100,0)
 S RMCDAT=@RMDA2@(10,"I")
"RTN","RMPRPCEA",101,0)
 S (RMPCE,RMIEPCE)=@RMDA2@(8.12,"I")
"RTN","RMPRPCEA",102,0)
 ; PATCH 78, RMS - 10/1/2003, billing aware related variables
"RTN","RMPRPCEA",103,0)
 K RMBAICD9,RMBAAO,RMBASCON,RMBAAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV
"RTN","RMPRPCEA",104,0)
 I '$D(^RMPR(660,RMIE60,"BA1")) G GTDT  ; no BA data, skip retrieval
"RTN","RMPRPCEA",105,0)
 F RMLOOP=30:1:33 D
"RTN","RMPRPCEA",106,0)
 . N RMBAREC S RMBAREC=RMLOOP-29
"RTN","RMPRPCEA",107,0)
 . S RMBAICD9(RMBAREC)=@RMDA2@(RMLOOP,"I")
"RTN","RMPRPCEA",108,0)
 . S RMBAAO(RMBAREC)=@RMDA2@((RMLOOP+.1),"I")
"RTN","RMPRPCEA",109,0)
 . S RMBAIR(RMBAREC)=@RMDA2@((RMLOOP+.2),"I")
"RTN","RMPRPCEA",110,0)
 . S RMBASCON(RMBAREC)=@RMDA2@((RMLOOP+.3),"I")
"RTN","RMPRPCEA",111,0)
 . S RMBAEC(RMBAREC)=@RMDA2@((RMLOOP+.4),"I")
"RTN","RMPRPCEA",112,0)
 . S RMBAMST(RMBAREC)=@RMDA2@((RMLOOP+.5),"I")
"RTN","RMPRPCEA",113,0)
 . S RMBAHNC(RMBAREC)=@RMDA2@((RMLOOP+.6),"I")
"RTN","RMPRPCEA",114,0)
 . S RMBACBV(RMBAREC)=@RMDA2@((RMLOOP+.7),"I")
"RTN","RMPRPCEA",115,0)
 ; Retrieve order number
"RTN","RMPRPCEA",116,0)
GTDT S RMPTR123=@RMDA2@(8.9,"I")
"RTN","RMPRPCEA",117,0)
 S RMODENT=$$GET1^DIQ(123,RMPTR123_",",.03)
"RTN","RMPRPCEA",118,0)
 ;get Date of Death.
"RTN","RMPRPCEA",119,0)
 D DEM^VADPT
"RTN","RMPRPCEA",120,0)
 ;get Agent Orange and Radiation.
"RTN","RMPRPCEA",121,0)
 D SVC^VADPT S RMAO=VASV(2),RMIR=VASV(3)
"RTN","RMPRPCEA",122,0)
 ;get environmental contaminants.
"RTN","RMPRPCEA",123,0)
 S RMEC=$$GET1^DIQ(2,DFN,.322013,"I") I RMEC="Y" S RMEC=1
"RTN","RMPRPCEA",124,0)
 S:RMEC'=1 RMEC=0
"RTN","RMPRPCEA",125,0)
 ;
"RTN","RMPRPCEA",126,0)
 S RMMST="",RMCBV="",RMHNC=""
"RTN","RMPRPCEA",127,0)
 Q
"RTN","RMPRPCEA",128,0)
 ;
"RTN","RMPRPCEA",129,0)
BUILD ; now build array for passing data to PCE
"RTN","RMPRPCEA",130,0)
 K ^TMP("RMPRPCE1",$J,"PXAPI"),RMAPI
"RTN","RMPRPCEA",131,0)
 S RMAPI=$NA(^TMP("RMPRPCE1",$J,"PXAPI"))
"RTN","RMPRPCEA",132,0)
 ; ---------encounter date/time----------------
"RTN","RMPRPCEA",133,0)
 S @RMAPI@("ENCOUNTER",1,"ENC D/T")=RMDATE
"RTN","RMPRPCEA",134,0)
 ; --------------patient-----------------------
"RTN","RMPRPCEA",135,0)
 S @RMAPI@("ENCOUNTER",1,"PATIENT")=RMPAT
"RTN","RMPRPCEA",136,0)
 ; ---------------clinic-----------------------
"RTN","RMPRPCEA",137,0)
 S @RMAPI@("ENCOUNTER",1,"HOS LOC")=RMHLOC
"RTN","RMPRPCEA",138,0)
 ; -------------checkout date/time-------------
"RTN","RMPRPCEA",139,0)
 S @RMAPI@("ENCOUNTER",1,"CHECKOUT D/T")=RMDATE
"RTN","RMPRPCEA",140,0)
 ; ------------agent orange--------------------
"RTN","RMPRPCEA",141,0)
 S @RMAPI@("ENCOUNTER",1,"AO")=RMAO
"RTN","RMPRPCEA",142,0)
 ;--------------ionizing radiation-------------
"RTN","RMPRPCEA",143,0)
 S @RMAPI@("ENCOUNTER",1,"IR")=RMIR
"RTN","RMPRPCEA",144,0)
 ;-----------environmental contaminants--------
"RTN","RMPRPCEA",145,0)
 S @RMAPI@("ENCOUNTER",1,"EC")=RMEC
"RTN","RMPRPCEA",146,0)
 ; --------------service connected--------------
"RTN","RMPRPCEA",147,0)
 S @RMAPI@("ENCOUNTER",1,"SC")=RMSCON
"RTN","RMPRPCEA",148,0)
 ; ------------Military Sexual Trauma----------
"RTN","RMPRPCEA",149,0)
 S @RMAPI@("ENCOUNTER",1,"MST")=RMMST
"RTN","RMPRPCEA",150,0)
 ; -------------Head/Neck Cancer---------------
"RTN","RMPRPCEA",151,0)
 S @RMAPI@("ENCOUNTER",1,"HNC")=RMHNC
"RTN","RMPRPCEA",152,0)
 ; --------------Combat Veteran---------
"RTN","RMPRPCEA",153,0)
 S @RMAPI@("ENCOUNTER",1,"CV")=RMCBV
"RTN","RMPRPCEA",154,0)
 ; --------------service category--------------
"RTN","RMPRPCEA",155,0)
 S @RMAPI@("ENCOUNTER",1,"SERVICE CATEGORY")=RMSCAT
"RTN","RMPRPCEA",156,0)
 ; ---------------encounter type---------------
"RTN","RMPRPCEA",157,0)
 S @RMAPI@("ENCOUNTER",1,"ENCOUNTER TYPE")=RMETYP
"RTN","RMPRPCEA",158,0)
 ; ------------primary provider----------------
"RTN","RMPRPCEA",159,0)
 S @RMAPI@("PROVIDER",1,"NAME")=RMUSER
"RTN","RMPRPCEA",160,0)
 ; ----------------diagnosis------------------
"RTN","RMPRPCEA",161,0)
 S @RMAPI@("DX/PL",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",162,0)
 S @RMAPI@("DX/PL",1,"PRIMARY")=1
"RTN","RMPRPCEA",163,0)
 ; -------------- procedures -----------------
"RTN","RMPRPCEA",164,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",165,0)
 ; ---------------- Quantity -----------------
"RTN","RMPRPCEA",166,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",167,0)
 ; -------------- Procedures -----------------
"RTN","RMPRPCEA",168,0)
 I '$D(RMBAICD9(1)) D  Q
"RTN","RMPRPCEA",169,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",170,0)
 ;
"RTN","RMPRPCEA",171,0)
 F RMLOOP=1:1:99 Q:$G(RMBAICD9(RMLOOP))=""  D
"RTN","RMPRPCEA",172,0)
 . S @RMAPI@("DX/PL",RMLOOP,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",173,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL AO")=$G(RMBAAO(RMLOOP))
"RTN","RMPRPCEA",174,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL IR")=$G(RMBAIR(RMLOOP))
"RTN","RMPRPCEA",175,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL SC")=$G(RMBASCON(RMLOOP))
"RTN","RMPRPCEA",176,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL EC")=$G(RMBAEC(RMLOOP))
"RTN","RMPRPCEA",177,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL MST")=$G(RMBAMST(RMLOOP))
"RTN","RMPRPCEA",178,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL HNC")=$G(RMBAHNC(RMLOOP))
"RTN","RMPRPCEA",179,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL CV")=$G(RMBACBV(RMLOOP))
"RTN","RMPRPCEA",180,0)
 . I RMLOOP=1 D  Q
"RTN","RMPRPCEA",181,0)
 . . S @RMAPI@("DX/PL",RMLOOP,"PRIMARY")=RMLOOP
"RTN","RMPRPCEA",182,0)
 . . S RMDIAG=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",183,0)
 . . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",184,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS "_RMLOOP)=$G(RMBAICD9(RMLOOP))  ; only one procedure per send
"RTN","RMPRPCEA",185,0)
 ;
"RTN","RMPRPCEA",186,0)
 ; -----------------procedures----------------
"RTN","RMPRPCEA",187,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",188,0)
 S @RMAPI@("PROCEDURE",1,"ORD PROVIDER")=RMPROV
"RTN","RMPRPCEA",189,0)
 S @RMAPI@("PROCEDURE",1,"EVENT D/T")=RMCPDT
"RTN","RMPRPCEA",190,0)
 ; ------------- Order Reference -------------
"RTN","RMPRPCEA",191,0)
 S @RMAPI@("PROCEDURE",1,"ORD REFERENCE")=RMODENT
"RTN","RMPRPCEA",192,0)
 ; -----------------Quantity------------------
"RTN","RMPRPCEA",193,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",194,0)
 ; -----------------diagnosis-----------------
"RTN","RMPRPCEA",195,0)
 S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",196,0)
 Q
"RTN","RMPRPCEA",197,0)
 ;
"RTN","RMPRPCEA",198,0)
SENDIT ; send the data to PCE. API (1891)
"RTN","RMPRPCEA",199,0)
 K RMPROB
"RTN","RMPRPCEA",200,0)
 S (RMPRCPER,RMPROB)=0
"RTN","RMPRPCEA",201,0)
 ; call the PCE package API.
"RTN","RMPRPCEA",202,0)
 S RMERR=$$DATA2PCE^PXAPI($NA(^TMP("RMPRPCE1",$J,"PXAPI")),RMPKG,RMSRC,.RMPCE,RMUSER,0,,"",.RMPROB)
"RTN","RMPRPCEA",203,0)
 ;To check for returned error messages, list the RMPROB array.
"RTN","RMPRPCEA",204,0)
 I RMERR<1 W !,"File #660 IEN="_RMIE60_" - Error in PCE interface !!!"
"RTN","RMPRPCEA",205,0)
 ;delete PCE entry if Provider and CPT CODE error, but send an error
"RTN","RMPRPCEA",206,0)
 ;message to RMPR PCE mailgroup.
"RTN","RMPRPCEA",207,0)
 I $D(RMPROB($J)) D CHECK^RMPRPCED
"RTN","RMPRPCEA",208,0)
 I $G(RMPCE),$G(RMPRCPER) S RMCHK=$$DELVFILE^PXAPI("ALL",.RMPCE,RMPKG,RMSRC,0,0,"") Q
"RTN","RMPRPCEA",209,0)
 ;
"RTN","RMPRPCEA",210,0)
 Q:'$G(RMPCE)
"RTN","RMPRPCEA",211,0)
 ;update PCE pointer and date last sent in #660.
"RTN","RMPRPCEA",212,0)
 K RMUPD
"RTN","RMPRPCEA",213,0)
 S RMUPD(660,RMIE60_",",8.12)=RMPCE
"RTN","RMPRPCEA",214,0)
 S RMUPD(660,RMIE60_",",8.13)=RMDANOW
"RTN","RMPRPCEA",215,0)
 D FILE^DIE("","RMUPD","")
"RTN","RMPRPCEA",216,0)
 Q
"RTN","RMPRPCEA",217,0)
 ;
"RTN","RMPRPCEB")
0^12^B20413279
"RTN","RMPRPCEB",1,0)
RMPRPCEB ;HIN/RVD-PROS PCE BACKGROUND UTILITY ; 1/23/04 8:09am
"RTN","RMPRPCEB",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,82,78**;Feb 09, 1996
"RTN","RMPRPCEB",3,0)
 ;
"RTN","RMPRPCEB",4,0)
 ;RVD patch #69 - add STATION in the error message.
"RTN","RMPRPCEB",5,0)
 ;                QUIT if no data in specified date range.
"RTN","RMPRPCEB",6,0)
 ;RVD patch #77 - only create 1 PCE entry for the same pt & same day.
"RTN","RMPRPCEB",7,0)
 ;
"RTN","RMPRPCEB",8,0)
 ;KAM Patch #82 06/21/2004 - Add more robust text to 'Missing
"RTN","RMPRPCEB",9,0)
 ;                           Prosthetics Clinic PCE error message
"RTN","RMPRPCEB",10,0)
 ;
"RTN","RMPRPCEB",11,0)
 ;WLC Patch #78 02/03/3005 - added NEW statement for error message
"RTN","RMPRPCEB",12,0)
 ;                           variables defined for Patch 82.
"RTN","RMPRPCEB",13,0)
 ;
"RTN","RMPRPCEB",14,0)
 W !,"Invalid Entry Point.....",!
"RTN","RMPRPCEB",15,0)
 Q
"RTN","RMPRPCEB",16,0)
TASK ;entry point for task job to send pros encounters to PCE.
"RTN","RMPRPCEB",17,0)
 N RERRMSG,RERRMSG2  ; correction for patch 82  02/03/05 WLC
"RTN","RMPRPCEB",18,0)
 S IO=0,RMAIL=1
"RTN","RMPRPCEB",19,0)
 S Y=DT D DD^%DT S RMRDAT=Y K RMX,RMXMT,^TMP($J)
"RTN","RMPRPCEB",20,0)
 D NOW^%DTC S RMSTDT=%
"RTN","RMPRPCEB",21,0)
 S X="T-90" D ^%DT S RM90DAY=Y
"RTN","RMPRPCEB",22,0)
 S RMBIEN=$O(^RMPR(660,"B",RM90DAY))
"RTN","RMPRPCEB",23,0)
 Q:RMBIEN=""
"RTN","RMPRPCEB",24,0)
 S (RMENDT,RFLDAT)=0
"RTN","RMPRPCEB",25,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  D PCEFLG
"RTN","RMPRPCEB",26,0)
 S RI=$O(^RMPR(660,"B",RMBIEN,0))
"RTN","RMPRPCEB",27,0)
 F  S RI=$O(^RMPR(660,RI)) Q:RI'>0  D
"RTN","RMPRPCEB",28,0)
 .S RM600=$G(^RMPR(660,RI,0))
"RTN","RMPRPCEB",29,0)
 .S RM611=$G(^RMPR(660,RI,1))
"RTN","RMPRPCEB",30,0)
 .S RM610=$G(^RMPR(660,RI,10))
"RTN","RMPRPCEB",31,0)
 .Q:$P(RM600,U,15)
"RTN","RMPRPCEB",32,0)
 .Q:$P(RM600,U,17)
"RTN","RMPRPCEB",33,0)
 .Q:'$P(RM610,U,8)
"RTN","RMPRPCEB",34,0)
 .S RMSTA=$P(RM600,U,10)
"RTN","RMPRPCEB",35,0)
 .;quit if already been processed.
"RTN","RMPRPCEB",36,0)
 .Q:$P(RM610,U,12)
"RTN","RMPRPCEB",37,0)
 .Q:(RMSTA="")!('$D(RSTAFLG(RMSTA)))
"RTN","RMPRPCEB",38,0)
 .Q:'$P(RM611,U,4)!'$P(RM600,U,22)
"RTN","RMPRPCEB",39,0)
 .S RMDATE=$P(RM600,U,1),RMDFN=$P(RM600,U,2)
"RTN","RMPRPCEB",40,0)
 .S RMICD9=$P(RM610,U,8)
"RTN","RMPRPCEB",41,0)
 .Q:$D(^TMP($J,RMSTA,RMDATE,RMDFN))
"RTN","RMPRPCEB",42,0)
 .S RMPROCF=0
"RTN","RMPRPCEB",43,0)
 .F J=0:0 S J=$O(^RMPR(660,"C",RMDFN,J)) Q:J'>0  D
"RTN","RMPRPCEB",44,0)
 ..S RMJ60=$G(^RMPR(660,J,0)),RMJDT=$P(RMJ60,U,1),RMJST=$P(RMJ60,U,10)
"RTN","RMPRPCEB",45,0)
 ..Q:(RMJST'=RMSTA)!(RMJDT'=RMDATE)
"RTN","RMPRPCEB",46,0)
 ..S RMJ610=$G(^RMPR(660,J,10)),RMJ12=$P(RMJ610,U,12)
"RTN","RMPRPCEB",47,0)
 ..I $G(RMJ12) S RMPROCF=1
"RTN","RMPRPCEB",48,0)
 .;don't process if PCE data was process for the same day.
"RTN","RMPRPCEB",49,0)
 .Q:$G(RMPROCF)
"RTN","RMPRPCEB",50,0)
 .S ^TMP($J,RMSTA,RMDATE,RMDFN,RI)=""
"RTN","RMPRPCEB",51,0)
 ;
"RTN","RMPRPCEB",52,0)
 D PROC
"RTN","RMPRPCEB",53,0)
 I '$D(^TMP($J,"RMPRERR")) D
"RTN","RMPRPCEB",54,0)
 .S ^TMP($J,"RMPR",5)="***** NO ERROR TO REPORT !!!!!"
"RTN","RMPRPCEB",55,0)
 S RMSUBI=4 D BUILD D:$D(^XMB(3.8,"B","RMPR PCE")) MES1,MES2
"RTN","RMPRPCEB",56,0)
 G EXIT
"RTN","RMPRPCEB",57,0)
 ;
"RTN","RMPRPCEB",58,0)
PCEFLG ;
"RTN","RMPRPCEB",59,0)
 S:$D(^RMPR(669.9,RS,"PCE")) RFLDAT=$P($G(^RMPR(669.9,RS,"PCE")),U,2)
"RTN","RMPRPCEB",60,0)
 S:'$D(^RMPR(669.9,RS,"PCE")) RFLDAT=0
"RTN","RMPRPCEB",61,0)
 S RSTAFLG($P(^RMPR(669.9,RS,0),U,2))=RFLDAT
"RTN","RMPRPCEB",62,0)
 S $P(^RMPR(669.9,RS,"PCE"),U,1)=RMSTDT
"RTN","RMPRPCEB",63,0)
 Q
"RTN","RMPRPCEB",64,0)
 ;
"RTN","RMPRPCEB",65,0)
PROC ;process
"RTN","RMPRPCEB",66,0)
 F RS=0:0 S RS=$O(^TMP($J,RS)) Q:RS'>0  F RII=0:0 S RII=$O(^TMP($J,RS,RII)) Q:RII'>0  F RJ=0:0 S RJ=$O(^TMP($J,RS,RII,RJ)) Q:RJ'>0  S RK=$O(^TMP($J,RS,RII,RJ,0)) D
"RTN","RMPRPCEB",67,0)
 .;call PCE Interface
"RTN","RMPRPCEB",68,0)
 .S RMIE60RK=RK
"RTN","RMPRPCEB",69,0)
 .S RMC=$$SENDPCE^RMPRPCEA(RK)
"RTN","RMPRPCEB",70,0)
 . I RMC<1 D
"RTN","RMPRPCEB",71,0)
 ..S RSNAM="        "
"RTN","RMPRPCEB",72,0)
 ..I $G(RS),$D(^DIC(4,RS,0)) S RSNAM=$E($P(^DIC(4,RS,0),U,1),1,8)
"RTN","RMPRPCEB",73,0)
 ..S ^TMP($J,"RMPRERR",RK)="Station: "_RSNAM_", File #660 IEN="_RK_" - Error in PCE interface!!!"
"RTN","RMPRPCEB",74,0)
 ..;Added next line for RMPR*3*82
"RTN","RMPRPCEB",75,0)
 ..I '$G(RMLOC) S ^TMP($J,"RMPRERR",RK)=^TMP($J,"RMPRERR",RK)_$G(RERRMSG)_$G(RERRMSG2)
"RTN","RMPRPCEB",76,0)
 ..I $D(RMPROB($J,1))!$D(RMPROB($J,2)) D
"RTN","RMPRPCEB",77,0)
 ...S (R2,R3,RMMESS)="",R6I=RK,RC=0
"RTN","RMPRPCEB",78,0)
 ...F R1=0:0 S R1=$O(RMPROB($J,R1)) Q:R1'>0  S RC=RC+1 F  S R2=$O(RMPROB($J,R1,"ERROR1",R2)) Q:R2=""  F  S R3=$O(RMPROB($J,R1,"ERROR1",R2,R3)) Q:R3=""  D
"RTN","RMPRPCEB",79,0)
 ....F R4=0:0 S R4=$O(RMPROB($J,R1,"ERROR1",R2,R3,R4)) Q:R4'>0  D
"RTN","RMPRPCEB",80,0)
 .....S RMMESS=RMPROB($J,R1,"ERROR1",R2,R3,R4),RMK=R6I_"."_RC,^TMP($J,"RMPRERR",RMK)="    ???? "_$E(RMMESS,1,65)
"RTN","RMPRPCEB",81,0)
 Q
"RTN","RMPRPCEB",82,0)
 ;
"RTN","RMPRPCEB",83,0)
MES1 ;
"RTN","RMPRPCEB",84,0)
 S XMY("G.RMPR PCE")="",XMDUZ=.5,XMTEXT="^TMP($J,""RMPR"","
"RTN","RMPRPCEB",85,0)
 S XMSUB="PROSTHETICS PCE BACKGROUND MESSAGE"
"RTN","RMPRPCEB",86,0)
 S ^TMP($J,"RMPR",1)="Run Date: "_RMRDAT
"RTN","RMPRPCEB",87,0)
 S ^TMP($J,"RMPR",2)="This is a notification from the Prosthetics Department........"
"RTN","RMPRPCEB",88,0)
 S ^TMP($J,"RMPR",3)=""
"RTN","RMPRPCEB",89,0)
 S ^TMP($J,"RMPR",4)=""
"RTN","RMPRPCEB",90,0)
 Q
"RTN","RMPRPCEB",91,0)
MES2 ;
"RTN","RMPRPCEB",92,0)
 S ^TMP($J,"RMPR",RMSUBI+2)=""
"RTN","RMPRPCEB",93,0)
 I $D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)="*** Please contact your PCE Coordinator or IRM ***"
"RTN","RMPRPCEB",94,0)
 I '$D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)=""
"RTN","RMPRPCEB",95,0)
 S ^TMP($J,"RMPR",RMSUBI+4)=""
"RTN","RMPRPCEB",96,0)
 S ^TMP($J,"RMPR",RMSUBI+5)="Thank You!!!"
"RTN","RMPRPCEB",97,0)
 S ^TMP($J,"RMPR",RMSUBI+6)=""
"RTN","RMPRPCEB",98,0)
 S ^TMP($J,"RMPR",RMSUBI+7)="PROSTHETICS DEPARTMENT"
"RTN","RMPRPCEB",99,0)
 D ^XMD
"RTN","RMPRPCEB",100,0)
 D NOW^%DTC
"RTN","RMPRPCEB",101,0)
 ;if task finish to completion and;
"RTN","RMPRPCEB",102,0)
 ;if no errors, set the PCE end date of the background job in #669.9.
"RTN","RMPRPCEB",103,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  S $P(^RMPR(669.9,RS,"PCE"),U,2)=%
"RTN","RMPRPCEB",104,0)
 Q
"RTN","RMPRPCEB",105,0)
 ;
"RTN","RMPRPCEB",106,0)
BUILD ;
"RTN","RMPRPCEB",107,0)
 F I=0:0 S I=$O(^TMP($J,"RMPRERR",I)) Q:I'>0  D
"RTN","RMPRPCEB",108,0)
 .S RMMAIL=^TMP($J,"RMPRERR",I)
"RTN","RMPRPCEB",109,0)
 .S RMSUBI=RMSUBI+1
"RTN","RMPRPCEB",110,0)
 .S ^TMP($J,"RMPR",RMSUBI)=RMMAIL
"RTN","RMPRPCEB",111,0)
 Q
"RTN","RMPRPCEB",112,0)
 ;
"RTN","RMPRPCEB",113,0)
EXIT ;MAIN EXIT POINT
"RTN","RMPRPCEB",114,0)
 K ^TMP($J)
"RTN","RMPRPCEB",115,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPCEB",116,0)
 Q
"RTN","RMPRSTE")
0^11^B14458194
"RTN","RMPRSTE",1,0)
RMPRSTE ;HINCIO/RVD-ISSUE FROM STOCK / CONT. ;11/06/00
"RTN","RMPRSTE",2,0)
 ;;3.0;PROSTHETICS;**53,62,78**;Feb 09, 1996
"RTN","RMPRSTE",3,0)
 ;modified for cpt modifier
"RTN","RMPRSTE",4,0)
 ;RVD patch #62 - modified for PCE interface.
"RTN","RMPRSTE",5,0)
 ;TH  Patch #78 - Add Date of Service/Shipment Date 
"RTN","RMPRSTE",6,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RMPRSTE",7,0)
NEX K DIR,Y,X
"RTN","RMPRSTE",8,0)
 S $P(R1(0),U,16)=RMPRUCST*$P(R1(0),U,7)
"RTN","RMPRSTE",9,0)
 S $P(R3("D"),U,16)=RMPRUCST*$P(R1(0),U,7)
"RTN","RMPRSTE",10,0)
QTY K DIR,Y S DIR(0)="660,5" S:$P(R1(0),U,7) DIR("B")=$P(R1(0),U,7)
"RTN","RMPRSTE",11,0)
 D ^DIR I $P(R1(0),U,7)'=""&$D(DUOUT) G LIST
"RTN","RMPRSTE",12,0)
 I $D(DTOUT) X CK2 G ^RMPRSTI
"RTN","RMPRSTE",13,0)
 I $D(DIRUT) G LOC^RMPRSTI
"RTN","RMPRSTE",14,0)
 I $G(RMUBA),((RMUBA-Y)<0) D LOWBA^RMPRSTI G LOC^RMPRSTI
"RTN","RMPRSTE",15,0)
 S $P(R1(0),U,7)=Y,$P(R1(0),U,16)=Y*RMPRUCST K DIR
"RTN","RMPRSTE",16,0)
 ;SET DELIVERY DATE to today
"RTN","RMPRSTE",17,0)
 ;
"RTN","RMPRSTE",18,0)
DATE ;delivery date and date of service/shipment date is set to today's date
"RTN","RMPRSTE",19,0)
 S $P(R1(0),U,12)=DT,$P(R1(1),U,8)=DT,Y=DT D DD^%DT S $P(R3("D"),U,12)=Y
"RTN","RMPRSTE",20,0)
LI S DIR(0)="660,9" S:$P(R1(0),U,11)'="" DIR("B")=$P(R1(0),U,11)
"RTN","RMPRSTE",21,0)
 D ^DIR I $D(DTOUT) X CK1 Q
"RTN","RMPRSTE",22,0)
 G:$D(DUOUT) LIST
"RTN","RMPRSTE",23,0)
 I X["^" W !,"Jumping not allowed" G LI
"RTN","RMPRSTE",24,0)
 I $P(R1(0),U,11)'=""&(X="@") S $P(R1(0),U,11)="" W $C(7),!?5,"Deleted..." H 1 G LOT
"RTN","RMPRSTE",25,0)
 S $P(R1(0),U,11)=X
"RTN","RMPRSTE",26,0)
 ;
"RTN","RMPRSTE",27,0)
LOT ;
"RTN","RMPRSTE",28,0)
 ;
"RTN","RMPRSTE",29,0)
 K DIR S DIR(0)="660,21" S:$P(R1(0),U,24)'="" DIR("B")=$P(R1(0),U,24)
"RTN","RMPRSTE",30,0)
 D ^DIR I $D(DTOUT) X CK1 Q
"RTN","RMPRSTE",31,0)
 G:$D(DUOUT) LIST
"RTN","RMPRSTE",32,0)
 I X["^" W !,"Jumping not allowed" G LOT
"RTN","RMPRSTE",33,0)
 I $P(R1(0),U,24)'=""&(X="@") S $P(R1(0),U,24)="" W $C(7),!?5,"Deleted..." H 1 G REMA
"RTN","RMPRSTE",34,0)
 S $P(R1(0),U,24)=X
"RTN","RMPRSTE",35,0)
 ;
"RTN","RMPRSTE",36,0)
REMA ;
"RTN","RMPRSTE",37,0)
 ;
"RTN","RMPRSTE",38,0)
 K DIR S DIR(0)="660,16" S:$P(R1(0),U,18)'="" DIR("B")=$P(R1(0),U,18)
"RTN","RMPRSTE",39,0)
 D ^DIR I $D(DTOUT) X CK1 Q
"RTN","RMPRSTE",40,0)
 G:$D(DUOUT) LIST
"RTN","RMPRSTE",41,0)
 I X["^" W !,"Jumping not allowed" G REMA
"RTN","RMPRSTE",42,0)
 I $P(R1(0),U,18)'=""&(X="@") S $P(R1(0),U,18)="" W $C(7),!?5,"Deleted..." H 1 G LIST
"RTN","RMPRSTE",43,0)
 S $P(R1(0),U,18)=X
"RTN","RMPRSTE",44,0)
 ;
"RTN","RMPRSTE",45,0)
LIST ;ENTRY POINT FOR STOCK ISSUE ROUTINES TO DISPLAY TRANSACTION DATA
"RTN","RMPRSTE",46,0)
 S RMDAHC=$P(R1(1),U,4)
"RTN","RMPRSTE",47,0)
 D NODE2^RMPRSTI
"RTN","RMPRSTE",48,0)
 D:$D(RMCPT) CHK^RMPRED5
"RTN","RMPRSTE",49,0)
 D ^RMPRST2
"RTN","RMPRSTE",50,0)
 K DIR,RQUIT
"RTN","RMPRSTE",51,0)
 S DIR(0)="SBO^P:POST;E:EDIT;D:DELETE"
"RTN","RMPRSTE",52,0)
 S DIR("A")="Would you like to POST/EDIT/DELETE this entry"
"RTN","RMPRSTE",53,0)
 S DIR("B")="P"
"RTN","RMPRSTE",54,0)
 S DIR("?")="Answer `P` to post the transaction, `E` to edit the transaction,'D' to delete the transaction"
"RTN","RMPRSTE",55,0)
 D ^DIR K DIR G:Y="P" POST G:Y="D" DEA
"RTN","RMPRSTE",56,0)
 I Y="E" S REDIT=1 G 1^RMPRSTI
"RTN","RMPRSTE",57,0)
 I $D(DIRUT)!$D(DUOUT)!$D(DTOUT) G ^RMPRSTI
"RTN","RMPRSTE",58,0)
 ;
"RTN","RMPRSTE",59,0)
DEA ;
"RTN","RMPRSTE",60,0)
 K DIR
"RTN","RMPRSTE",61,0)
 S DIR("A")="Are you sure you want to DELETE this entry"
"RTN","RMPRSTE",62,0)
 S DIR("B")="N",DIR(0)="Y"
"RTN","RMPRSTE",63,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!$D(DIRUT) X CK Q
"RTN","RMPRSTE",64,0)
 I Y=1 W !!,$C(7),?50," Deleted..." H 2 K DIR G RES^RMPRSTI
"RTN","RMPRSTE",65,0)
 G LIST
"RTN","RMPRSTE",66,0)
 ;
"RTN","RMPRSTE",67,0)
POST ;
"RTN","RMPRSTE",68,0)
 ;
"RTN","RMPRSTE",69,0)
 I RMPRG'="" G GGC
"RTN","RMPRSTE",70,0)
 L +^RMPR(669.9,RMPRSITE,0):999 I $T=0 S RMPRG=DT_99 G GGC
"RTN","RMPRSTE",71,0)
 S RMPRG=$P(^RMPR(669.9,RMPRSITE,0),U,7),RMPRG=RMPRG-1
"RTN","RMPRSTE",72,0)
 S $P(^RMPR(669.9,RMPRSITE,0),U,7)=RMPRG L -^RMPR(669.9,RMPRSITE,0)
"RTN","RMPRSTE",73,0)
GGC S $P(RMPRI("AMS"),U,1)=RMPRG,RMSER=$P(R1(0),U,11)
"RTN","RMPRSTE",74,0)
 ;update inventory balance
"RTN","RMPRSTE",75,0)
 I $G(RMLOC) S RMQTY=$P(R1(0),U,7) D ADD^RMPR5NU1 I $D(RQUIT) X CK Q
"RTN","RMPRSTE",76,0)
 I '$D(RMLOC) X CK Q
"RTN","RMPRSTE",77,0)
 S:$D(RMLOC) $P(R1(1),U,2)=RDESC,$P(R1(0),U,13)=11,$P(R1(1),U,5)=RM6612
"RTN","RMPRSTE",78,0)
 ;
"RTN","RMPRSTE",79,0)
 ;create 2319
"RTN","RMPRSTE",80,0)
 K Y,DD,DO,DA S DIC="^RMPR(660,",DIC(0)="L",X=DT,DLAYGO=660
"RTN","RMPRSTE",81,0)
 D FILE^DICN K DLAYGO
"RTN","RMPRSTE",82,0)
 I Y'>0 W !,"** Error posting to 2319...entry deleted..." G RES^RMPRSTI
"RTN","RMPRSTE",83,0)
 S ^RMPR(660,+Y,0)=R1(0),^(1)=R1(1),^("AM")=R1("AM"),^(2)=R1(2)
"RTN","RMPRSTE",84,0)
 S $P(R1(1),U,8)=DT
"RTN","RMPRSTE",85,0)
 S ^("AMS")=RMPRI("AMS")
"RTN","RMPRSTE",86,0)
 I $D(RMLOC) MERGE ^RMPR(660,+Y,"DES")=^RMPR(661.1,RMDAHC,2) S $P(^RMPR(660,+Y,"DES",0),U,2)=""
"RTN","RMPRSTE",87,0)
 S DIK="^RMPR(660,",(RM60,DA)=+Y D IX1^DIK K DIC
"RTN","RMPRSTE",88,0)
 S ^TMP($J,"RMPRPCE",660,DA)=RMPRG_"^"_$G(RMPRDFN)
"RTN","RMPRSTE",89,0)
 ;
"RTN","RMPRSTE",90,0)
 W !,"Posted to 2319..." H 3
"RTN","RMPRSTE",91,0)
 G RES^RMPRSTI
"RTN","RMPRSTE",92,0)
 ;
"RTN","RMPRSTE",93,0)
EXIT ;EXIT FOR STOCK ISSUES
"RTN","RMPRSTE",94,0)
 K ^TMP($J)
"RTN","RMPRSTE",95,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRSTE",96,0)
 Q
"RTN","RMPRSTE",97,0)
 ;
"RTN","RMPRSTE",98,0)
ERR0 ;delete entry & print error message if posting fails.
"RTN","RMPRSTE",99,0)
 ;K DIK
"RTN","RMPRSTE",100,0)
 ;S DIK="^RMPR(660,",DA=RM60 D ^DIK
"RTN","RMPRSTE",101,0)
 ;W !,"** Error posting to 2319...entry deleted...",!! H 3
"RTN","RMPRSTE",102,0)
 ;Q
"RTN","RMPRSTE",103,0)
 ;
"RTN","RMPRSTE",104,0)
 ;
"RTN","RMPRSTE",105,0)
INV1 I $P(R1(0),U,14)="C" S $P(R1(0),U,16)=RMPRUCST*$P(R1(0),U,7)
"RTN","RMPRSTE",106,0)
 G QTY
"VER")
8.0^22.0
"^DD",660,660,10,0)
DELIVERY DATE^D^^0;12^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",660,660,10,1,0)
^.1^^-1
"^DD",660,660,10,1,1,0)
660^CT
"^DD",660,660,10,1,1,1)
S ^RMPR(660,"CT",$E(X,1,30),DA)=""
"^DD",660,660,10,1,1,2)
K ^RMPR(660,"CT",$E(X,1,30),DA)
"^DD",660,660,10,1,1,"%D",0)
^^2^2^2950417^^^^
"^DD",660,660,10,1,1,"%D",1,0)
Allows lookups of Appliance Repair entries that have been delivered.
"^DD",660,660,10,1,1,"%D",2,0)
This x-ref is used to calculate end-of-quarter AMIS for closed-out items.
"^DD",660,660,10,3)
Please enter date of delivery to (and acceptance by) the patient.
"^DD",660,660,10,21,0)
^^4^4^2950417^^^^
"^DD",660,660,10,21,1,0)
This is the date that the appliance was delivered and accepted by the
"^DD",660,660,10,21,2,0)
patient.  This date, under certain circumstances, may be a date that the
"^DD",660,660,10,21,3,0)
appliance was mailed to the patient.  It may or may not be the same as the
"^DD",660,660,10,21,4,0)
transaction date and/or the request date.
"^DD",660,660,10,"DT")
2930915
"^DD",660,660,30,0)
PRIMARY ICD DIAGNOSIS CODE^P80'^ICD9(^BA1;1^Q
"^DD",660,660,30,3)
Enter pointer to ICD DIAGNOSIS FILE (#80)
"^DD",660,660,30,21,0)
^^1^1^3040524^
"^DD",660,660,30,21,1,0)
Pointer to Primary Diagnosis code for order.
"^DD",660,660,30,"DT")
3040525
"^DD",660,660,30.1,0)
PRIMARY AGENT ORANGE EXPOSURE^S^0:NO;1:YES;^BA1;2^Q
"^DD",660,660,30.1,3)
Enter 'Y'es if Primary diagnosis is related to Agent Orange exposure.
"^DD",660,660,30.1,21,0)
^^1^1^3040524^
"^DD",660,660,30.1,21,1,0)
Primary diagnosis is related to Agent Orange exposure.
"^DD",660,660,30.1,"DT")
3040525
"^DD",660,660,30.2,0)
PRIMARY IONIZED RADIATION^S^0:NO;1:YES;^BA1;3^Q
"^DD",660,660,30.2,3)
Enter 'Y'es if Primary diagnosis is related to Ionized Radiation exposure.
"^DD",660,660,30.2,21,0)
^^1^1^3040524^
"^DD",660,660,30.2,21,1,0)
Primary diagnosis is related to Ionized Radiation exposure.
"^DD",660,660,30.2,"DT")
3040525
"^DD",660,660,30.3,0)
PRIMARY SERVICE-CONNECTED^S^0:NO;1:YES;^BA1;4^Q
"^DD",660,660,30.3,3)
Enter 'Y'es if Primary diagnosis is related to a Service-Connected condition.
"^DD",660,660,30.3,21,0)
^^1^1^3040524^
"^DD",660,660,30.3,21,1,0)
Primary diagnosis is related to a Service-Connected condition.
"^DD",660,660,30.3,"DT")
3040525
"^DD",660,660,30.4,0)
PRIMARY ENVIRONMENTAL CONT.^S^0:NO;1:YES;^BA1;5^Q
"^DD",660,660,30.4,3)
Enter 'Y'es if Primary diagnosis is related to Environmental Contaminants exposure.
"^DD",660,660,30.4,21,0)
^^1^1^3040524^
"^DD",660,660,30.4,21,1,0)
Primary diagnosis is related to Environmental Contaminants exposure.
"^DD",660,660,30.4,"DT")
3040525
"^DD",660,660,30.5,0)
PRIMARY MST^S^0:NO;1:YES;^BA1;6^Q
"^DD",660,660,30.5,3)
Enter 'Y'es if Primary diagnosis is related to Military Sexual Trauma.
"^DD",660,660,30.5,21,0)
^^1^1^3040524^
"^DD",660,660,30.5,21,1,0)
Primary diagnosis is related to Military Sexual Trauma.
"^DD",660,660,30.5,"DT")
3040525
"^DD",660,660,30.6,0)
PRIMARY HEAD/NECK CANCER^S^0:NO;1:YES;^BA1;7^Q
"^DD",660,660,30.6,3)
Enter 'Y'es if Primary diagnosis is related to Head/Neck Cancer.
"^DD",660,660,30.6,21,0)
^^1^1^3040524^
"^DD",660,660,30.6,21,1,0)
Primary diagnosis is related to Head/Neck Cancer.
"^DD",660,660,30.6,"DT")
3040525
"^DD",660,660,30.7,0)
PRIMARY COMBAT VET^S^0:NO;1:YES;^BA1;8^Q
"^DD",660,660,30.7,3)
Enter 'Y'es if Primary diagnosis is related to Combat.
"^DD",660,660,30.7,21,0)
^^1^1^3040524^
"^DD",660,660,30.7,21,1,0)
Primary diagnosis related to Combat.
"^DD",660,660,30.7,"DT")
3040525
"^DD",660,660,31,0)
SECONDARY ICD DIAGNOSIS CODE 1^P80'^ICD9(^BA2;1^Q
"^DD",660,660,31,3)
Enter the pointer to the ICD Diagnosis file (#80) for the Secondary ICD Diagnosis code 1.
"^DD",660,660,31,21,0)
^^1^1^3040524^
"^DD",660,660,31,21,1,0)
Pointer to ICD Diagnosis file (#80) for Secondary ICD Diagnosis code 1.
"^DD",660,660,31,"DT")
3040525
"^DD",660,660,31.1,0)
SECONDARY AGENT ORANGE 1^S^0:NO;1:YES;^BA2;2^Q
"^DD",660,660,31.1,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Agent Orange exposure. 
"^DD",660,660,31.1,21,0)
^^1^1^3040524^
"^DD",660,660,31.1,21,1,0)
Secondary diagnosis 1 is related to Agent Orange exposure.
"^DD",660,660,31.1,"DT")
3040525
"^DD",660,660,31.2,0)
SECONDARY IONIZED RADIATION 1^S^0:NO;1:YES;^BA2;3^Q
"^DD",660,660,31.2,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Ionized Radiation exposure.
"^DD",660,660,31.2,21,0)
^.001^1^1^3040524^^
"^DD",660,660,31.2,21,1,0)
Secondary diagnosis 1 is related to Ionized Radiation exposure.
"^DD",660,660,31.2,"DT")
3040525
"^DD",660,660,31.3,0)
SECONDARY SERVICE-CONNECTED 1^S^0:NO;1:YES;^BA2;4^Q
"^DD",660,660,31.3,3)
Enter 'Y'es if Secondary diagnosis 1 is related to a Service-Connected condition.
"^DD",660,660,31.3,21,0)
^^1^1^3040524^
"^DD",660,660,31.3,21,1,0)
Secondary Diagnosis 1 is related to a Service-Connected condition.
"^DD",660,660,31.3,"DT")
3040525
"^DD",660,660,31.4,0)
SECONDARY ENVIRONMENTAL CONT 1^S^0:NO;1:YES;^BA2;5^Q
"^DD",660,660,31.4,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Environmental Contaminants exposure.
"^DD",660,660,31.4,21,0)
^^1^1^3040524^
"^DD",660,660,31.4,21,1,0)
Secondary diagnosis 1 is related to Environmental Contaminants exposure.
"^DD",660,660,31.4,"DT")
3040525
"^DD",660,660,31.5,0)
SECONDARY MST 1^S^0:NO;1:YES;^BA2;6^Q
"^DD",660,660,31.5,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Military Sexual Trauma.
"^DD",660,660,31.5,21,0)
^^1^1^3040524^
"^DD",660,660,31.5,21,1,0)
Secondary diagnosis 1 is related to Military Sexual Trauma.
"^DD",660,660,31.5,"DT")
3040525
"^DD",660,660,31.6,0)
SECONDARY HEAD/NECK CANCER 1^S^0:NO;1:YES;^BA2;7^Q
"^DD",660,660,31.6,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Head/Neck cancer.
"^DD",660,660,31.6,21,0)
^^1^1^3040524^
"^DD",660,660,31.6,21,1,0)
Secondary diagnosis 1 is related to Head/Neck cancer.
"^DD",660,660,31.6,"DT")
3040525
"^DD",660,660,31.7,0)
SECONDARY COMBAT VET 1^S^0:NO;1:YES;^BA2;8^Q
"^DD",660,660,31.7,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Combat.
"^DD",660,660,31.7,21,0)
^.001^1^1^3040524^^
"^DD",660,660,31.7,21,1,0)
Secondary diagnosis 1 is related to Combat.
"^DD",660,660,31.7,"DT")
3040525
"^DD",660,660,32,0)
SECONDARY ICD DIAGNOSIS 2^P80'^ICD9(^BA3;1^Q
"^DD",660,660,32,3)
Enter pointer to ICD Diagnosis file (#80) for Secondary diagnosis code 2.
"^DD",660,660,32,21,0)
^^1^1^3040524^
"^DD",660,660,32,21,1,0)
Pointer to ICD Diagnosis file (#80) for Secondary ICD diagnosis code 2.
"^DD",660,660,32,"DT")
3040525
"^DD",660,660,32.1,0)
SECONDARY AGENT ORANGE 2^S^0:NO;1:YES;^BA3;2^Q
"^DD",660,660,32.1,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Agent Orange exposure.
"^DD",660,660,32.1,21,0)
^^1^1^3040524^
"^DD",660,660,32.1,21,1,0)
Secondary diagnosis 2 is related to Agent Orange exposure.
"^DD",660,660,32.1,"DT")
3040525
"^DD",660,660,32.2,0)
SECONDARY IONIZED RADIATION 2^S^0:NO;1:YES;^BA3;3^Q
"^DD",660,660,32.2,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Ionized Radiation exposure.
"^DD",660,660,32.2,21,0)
^^1^1^3040524^
"^DD",660,660,32.2,21,1,0)
Secondary diagnosis 2 is related to Ionized Radiation exposure.
"^DD",660,660,32.2,"DT")
3040525
"^DD",660,660,32.3,0)
SECONDARY SERVICE-CONNECTED 2^S^0:NO;1:YES;^BA3;4^Q
"^DD",660,660,32.3,3)
Enter 'Y'es if Secondary diagnosis 2 is related to a Service-Connected condition.
"^DD",660,660,32.3,21,0)
^^1^1^3040524^
"^DD",660,660,32.3,21,1,0)
Secondary diagnosis 2 is related to a Service-Connected condition.
"^DD",660,660,32.3,"DT")
3040525
"^DD",660,660,32.4,0)
SECONDARY ENVIR. CONT. 2^S^0:NO;1:YES;^BA3;5^Q
"^DD",660,660,32.4,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Environmental Contaminants exposure.
"^DD",660,660,32.4,21,0)
^^1^1^3040524^
"^DD",660,660,32.4,21,1,0)
Secondary diagnosis 2 is related to Environmental Contaminants exposure.
"^DD",660,660,32.4,"DT")
3040525
"^DD",660,660,32.5,0)
SECONDARY MST 2^S^0:NO;1:YES;^BA3;6^Q
"^DD",660,660,32.5,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Military Sexual Trauma.
"^DD",660,660,32.5,21,0)
^^1^1^3040524^
"^DD",660,660,32.5,21,1,0)
Secondary diagnosis 2 is related to Military Sexual Trauma.
"^DD",660,660,32.5,"DT")
3040525
"^DD",660,660,32.6,0)
SECONDARY HEAD/NECK CANCER 2^S^0:NO;1:YES;^BA3;7^Q
"^DD",660,660,32.6,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Head/Neck cancer.
"^DD",660,660,32.6,21,0)
^^1^1^3040524^
"^DD",660,660,32.6,21,1,0)
Secondary diagnosis 2 is related to Head/Neck cancer.
"^DD",660,660,32.6,"DT")
3040525
"^DD",660,660,32.7,0)
SECONDARY COMBAT VET 2^S^0:NO;1:YES;^BA3;8^Q
"^DD",660,660,32.7,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Combat.
"^DD",660,660,32.7,21,0)
^^1^1^3040524^
"^DD",660,660,32.7,21,1,0)
Secondary diagnosis 2 is related to Combat.
"^DD",660,660,32.7,"DT")
3040525
"^DD",660,660,33,0)
SECONDARY ICD DIAGNOSIS 3^P80'^ICD9(^BA4;1^Q
"^DD",660,660,33,3)
Enter pointer to ICD Diagnosis file (#80) for Secondary ICD diagnosis code 3.
"^DD",660,660,33,21,0)
^^1^1^3040524^
"^DD",660,660,33,21,1,0)
Pointer to ICD Diagnosis file (#80) for Secondary ICD diagnosis code 3.
"^DD",660,660,33,"DT")
3040525
"^DD",660,660,33.1,0)
SECONDARY AGENT ORANGE 3^S^0:NO;1:YES;^BA4;2^Q
"^DD",660,660,33.1,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Agent Orange exposure.
"^DD",660,660,33.1,21,0)
^^1^1^3040524^
"^DD",660,660,33.1,21,1,0)
Secondary diagnosis 3 is related to Agent Orange exposure.
"^DD",660,660,33.1,"DT")
3040525
"^DD",660,660,33.2,0)
SECONDARY IONIZED RADIATION 3^S^0:NO;1:YES;^BA4;3^Q
"^DD",660,660,33.2,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Ionized Radiation exposure.
"^DD",660,660,33.2,21,0)
^^1^1^3040524^
"^DD",660,660,33.2,21,1,0)
Secondary diagnosis 3 is related to Ionized Radiation exposure.
"^DD",660,660,33.2,"DT")
3040525
"^DD",660,660,33.3,0)
SECONDARY SERVICE-CONNECTED 3^S^0:NO;1:YES;^BA4;4^Q
"^DD",660,660,33.3,3)
Enter 'Y'es if Secondary diagnosis 3 is related to a Service-Connected condition.
"^DD",660,660,33.3,21,0)
^^1^1^3040524^
"^DD",660,660,33.3,21,1,0)
Secondary diagnosis 3 is related to a Service-Connected condition.
"^DD",660,660,33.3,"DT")
3040525
"^DD",660,660,33.4,0)
SECONDARY ENVIRON. CONT. 3^S^0:NO;1:YES;^BA4;5^Q
"^DD",660,660,33.4,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Environmental Contaminants exposure. 
"^DD",660,660,33.4,21,0)
^^1^1^3040524^
"^DD",660,660,33.4,21,1,0)
Secondary diagnosis 3 is related to Environmental Contaminants exposure.
"^DD",660,660,33.4,"DT")
3040525
"^DD",660,660,33.5,0)
SECONDARY MST 3^S^0:NO;1:YES;^BA4;6^Q
"^DD",660,660,33.5,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Military Sexual Trauma.
"^DD",660,660,33.5,21,0)
^^1^1^3040524^
"^DD",660,660,33.5,21,1,0)
Secondary diagnosis 3 is related to Military Sexual Trauma.
"^DD",660,660,33.5,"DT")
3040525
"^DD",660,660,33.6,0)
SECONDARY HEAD/NECK CANCER 3^S^0:NO;1:YES;^BA4;7^Q
"^DD",660,660,33.6,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Head/Neck cancer.
"^DD",660,660,33.6,21,0)
^^1^1^3040524^
"^DD",660,660,33.6,21,1,0)
Secondary diagnosis 3 is related to Head/Neck cancer.
"^DD",660,660,33.6,"DT")
3040525
"^DD",660,660,33.7,0)
SECONDARY COMBAT VET 3^S^0:NO;1:YES;^BA4;8^Q
"^DD",660,660,33.7,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Combat.
"^DD",660,660,33.7,21,0)
^.001^1^1^3040524^^
"^DD",660,660,33.7,21,1,0)
Secondary diagnosis 3 is related to Combat.
"^DD",660,660,33.7,"DT")
3040525
"^DD",660,660,39,0)
DATE OF SERVICE^D^^1;8^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",660,660,39,1,0)
^.1
"^DD",660,660,39,1,1,0)
660^AF
"^DD",660,660,39,1,1,1)
S ^RMPR(660,"AF",$E(X,1,30),DA)=""
"^DD",660,660,39,1,1,2)
K ^RMPR(660,"AF",$E(X,1,30),DA)
"^DD",660,660,39,1,1,"%D",0)
^^1^1^3040402^
"^DD",660,660,39,1,1,"%D",1,0)
Cross-reference for Shipment date to be used for Billing.
"^DD",660,660,39,1,1,"DT")
3040402
"^DD",660,660,39,21,0)
^^1^1^3030203^
"^DD",660,660,39,21,1,0)
This is the date when an item is issued to the patient.
"^DD",660,660,39,"DT")
3040402
"^DD",668,668,30,0)
PRIMARY ICD DIAGNOSIS CODE^P80'^ICD9(^BA1;1^Q
"^DD",668,668,30,3)
Enter a pointer to the ICD DIAGNOSIS file (#80) for Primary ICD Diagnosis code.
"^DD",668,668,30,21,0)
^.001^1^1^3040524^^
"^DD",668,668,30,21,1,0)
CPRS ICD Diagnosis code 1 at time of consult.
"^DD",668,668,30,"DT")
3040525
"^DD",668,668,30.1,0)
PRIMARY AGENT ORANGE^S^0:NO;1:YES;^BA1;2^Q
"^DD",668,668,30.1,3)
Enter 'Y'es if Primary diagnosis is related to Agent Orange exposure.
"^DD",668,668,30.1,21,0)
^^1^1^3040524^
"^DD",668,668,30.1,21,1,0)
Primary diagnosis is related to Agent Orange exposure.
"^DD",668,668,30.1,"DT")
3040525
"^DD",668,668,30.2,0)
PRIMARY IONIZED RADIATION^S^0:NO;1:YES;^BA1;3^Q
"^DD",668,668,30.2,3)
Enter 'Y'es if Primary diagnosis is related to Ionized Radiation exposure.
"^DD",668,668,30.2,21,0)
^^1^1^3040524^
"^DD",668,668,30.2,21,1,0)
Primary diagnosis is related to Ionized Radiation exposure.
"^DD",668,668,30.2,"DT")
3040525
"^DD",668,668,30.3,0)
PRIMARY SERVICE-CONNECTED^S^0:NO;1:YES;^BA1;4^Q
"^DD",668,668,30.3,3)
Enter 'Y'es if Primary diagnosis is related to a Service-Connected condition.
"^DD",668,668,30.3,21,0)
^^1^1^3040524^
"^DD",668,668,30.3,21,1,0)
Primary diagnosis is related to a Service-Connected condition.
"^DD",668,668,30.3,"DT")
3040525
"^DD",668,668,30.4,0)
PRIMARY ENVIRONMENTAL CONT.^S^0:NO;1:YES;^BA1;5^Q
"^DD",668,668,30.4,3)
Enter 'Y'es if Primary diagnosis is related to Environmental Contaminants exposure.
"^DD",668,668,30.4,21,0)
^^1^1^3040524^
"^DD",668,668,30.4,21,1,0)
Primary diagnosis is related to Environmental Contaminants exposure.
"^DD",668,668,30.4,"DT")
3040525
"^DD",668,668,30.5,0)
PRIMARY MST^S^0:NO;1:YES;^BA1;6^Q
"^DD",668,668,30.5,3)
Enter 'Y'es if diagnosis is related to Military Sexual Trauma.
"^DD",668,668,30.5,21,0)
^^1^1^3040524^
"^DD",668,668,30.5,21,1,0)
Primary diagnosis is related to Military Sexual Trauma.
"^DD",668,668,30.5,"DT")
3040525
"^DD",668,668,30.6,0)
PRIMARY HEAD/NECK CANCER^S^0:NO;1:YES;^BA1;7^Q
"^DD",668,668,30.6,3)
Enter 'Y'es if Primary diagnosis is related to Head/Neck Cancer.
"^DD",668,668,30.6,21,0)
^^1^1^3040524^
"^DD",668,668,30.6,21,1,0)
Primary diagnosis is related to Head/Neck Cancer.
"^DD",668,668,30.6,"DT")
3040525
"^DD",668,668,30.7,0)
PRIMARY COMBAT VET^S^0:NO;1:YES;^BA1;8^Q
"^DD",668,668,30.7,3)
Enter 'Y'es if Primary diagnosis is related to Combat.
"^DD",668,668,30.7,21,0)
^.001^1^1^3040524^^
"^DD",668,668,30.7,21,1,0)
Primary diagnosis is related to Combat.
"^DD",668,668,30.7,"DT")
3040525
"^DD",668,668,31,0)
SECONDARY ICD DIAGNOSIS 1^P80'^ICD9(^BA2;1^Q
"^DD",668,668,31,3)
Enter pointer to ICD Diagnosis file (#80) for Secondary ICD diagnosis code 1.
"^DD",668,668,31,21,0)
^^1^1^3040524^
"^DD",668,668,31,21,1,0)
Pointer to ICD Diagnosis file (#80) for Secondary ICD diagnosis code 1.
"^DD",668,668,31,"DT")
3040525
"^DD",668,668,31.1,0)
SECONDARY AGENT ORANGE 1^S^0:NO;1:YES;^BA2;2^Q
"^DD",668,668,31.1,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Agent Orange exposure.
"^DD",668,668,31.1,21,0)
^^1^1^3040524^
"^DD",668,668,31.1,21,1,0)
Secondary diagnosis 1 is related to Agent Orange exposure.
"^DD",668,668,31.1,"DT")
3040525
"^DD",668,668,31.2,0)
SECONDARY IONIZED RADIATION 1^S^0:NO;1:YES;^BA2;3^Q
"^DD",668,668,31.2,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Ionized Radiation exposure.
"^DD",668,668,31.2,21,0)
^.001^1^1^3040524^^
"^DD",668,668,31.2,21,1,0)
Secondary diagnosis 1 is related to Ionized Radiation exposure.
"^DD",668,668,31.2,"DT")
3040525
"^DD",668,668,31.3,0)
SECONDARY SERVICE-CONNECTED 1^S^0:NO;1:YES;^BA2;4^Q
"^DD",668,668,31.3,3)
Enter 'Y'es if Secondary diagnosis 1 is related to a Service-Connected condition.
"^DD",668,668,31.3,21,0)
^^1^1^3040524^
"^DD",668,668,31.3,21,1,0)
Secondary diagnosis 1 is related to a Service-Connected condition.
"^DD",668,668,31.3,"DT")
3040525
"^DD",668,668,31.4,0)
SECONDARY ENVIRON. CONT. 1^S^0:NO;1:YES;^BA2;5^Q
"^DD",668,668,31.4,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Environmental Contaminants exposure.
"^DD",668,668,31.4,21,0)
^^1^1^3040524^
"^DD",668,668,31.4,21,1,0)
Secondary diagnosis 1 is related to Environmental Contaminants exposure.
"^DD",668,668,31.4,"DT")
3040525
"^DD",668,668,31.5,0)
SECONDARY MST 1^S^0:NO;1:YES;^BA2;6^Q
"^DD",668,668,31.5,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Military Sexual Trauma.
"^DD",668,668,31.5,21,0)
^^1^1^3040524^
"^DD",668,668,31.5,21,1,0)
Secondary diagnosis 1 is related to Military Sexual Trauma.
"^DD",668,668,31.5,"DT")
3040525
"^DD",668,668,31.6,0)
SECONDARY HEAD/NECK CANCER 1^S^0:NO;1:YES;^BA2;7^Q
"^DD",668,668,31.6,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Head/Neck Cancer.
"^DD",668,668,31.6,21,0)
^^1^1^3040524^
"^DD",668,668,31.6,21,1,0)
Secondary diagnosis 1 is related to Head/Neck Cancer.
"^DD",668,668,31.6,"DT")
3040525
"^DD",668,668,31.7,0)
SECONDARY COMBAT VET 1^S^0:NO;1:YES;^BA2;8^Q
"^DD",668,668,31.7,3)
Enter 'Y'es if Secondary diagnosis 1 is related to Combat.
"^DD",668,668,31.7,21,0)
^.001^1^1^3040524^^
"^DD",668,668,31.7,21,1,0)
Secondary diagnosis 1 is related to Combat.
"^DD",668,668,31.7,"DT")
3040525
"^DD",668,668,32,0)
SECONDARY ICD DIAGNOSIS 2^P80'^ICD9(^BA3;1^Q
"^DD",668,668,32,3)
Enter pointer to ICD Diagnosis file (#80) for Secondary ICD diagnosis code 2.
"^DD",668,668,32,21,0)
^^1^1^3040524^
"^DD",668,668,32,21,1,0)
Pointer to ICD Diagnosis file (#80) for Secondary ICD Diagnosis 2.
"^DD",668,668,32,"DT")
3040525
"^DD",668,668,32.1,0)
SECONDARY AGENT ORANGE 2^S^0:NO;1:YES;^BA3;2^Q
"^DD",668,668,32.1,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Agent Orange exposure.
"^DD",668,668,32.1,21,0)
^^1^1^3040524^
"^DD",668,668,32.1,21,1,0)
Secondary diagnosis 2 is related to Agent Orange exposure.
"^DD",668,668,32.1,"DT")
3040525
"^DD",668,668,32.2,0)
SECONDARY IONIZED RADIATION 2^S^0:NO;1:YES;^BA3;3^Q
"^DD",668,668,32.2,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Ionized Radiation exposure.
"^DD",668,668,32.2,21,0)
^^1^1^3040524^
"^DD",668,668,32.2,21,1,0)
Secondary diagnosis 2 is related to Ionized Radiation exposure.
"^DD",668,668,32.2,"DT")
3040525
"^DD",668,668,32.3,0)
SECONDARY SERVICE-CONNECTED 2^S^0:NO;1:YES;^BA3;4^Q
"^DD",668,668,32.3,3)
Enter 'Y'es if Secondary diagnosis 2 is related to a Service-Connected condition.
"^DD",668,668,32.3,21,0)
^^1^1^3040524^
"^DD",668,668,32.3,21,1,0)
Secondary diagnosis 2 is related to a Service-Connected condition.
"^DD",668,668,32.3,"DT")
3040525
"^DD",668,668,32.4,0)
SECONDARY ENVIRON. CONT. 2^S^0:NO;1:YES;^BA3;5^Q
"^DD",668,668,32.4,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Environmental Contaminants exposure.
"^DD",668,668,32.4,21,0)
^^1^1^3040524^
"^DD",668,668,32.4,21,1,0)
Secondary diagnosis 2 is related to Environmental Contaminants exposure.
"^DD",668,668,32.4,"DT")
3040525
"^DD",668,668,32.5,0)
SECONDARY MST 2^S^0:NO;1:YES;^BA3;6^Q
"^DD",668,668,32.5,3)
Enter 'Y'es if diagnosis is related to Military Sexual Trauma.
"^DD",668,668,32.5,21,0)
^^1^1^3040524^
"^DD",668,668,32.5,21,1,0)
Secondary diagnosis 2 is related to Military Sexual Trauma.
"^DD",668,668,32.5,"DT")
3040525
"^DD",668,668,32.6,0)
SECONDARY HEAD/NECK CANCER 2^S^0:NO;1:YES;^BA3;7^Q
"^DD",668,668,32.6,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Head/Neck Cancer.
"^DD",668,668,32.6,21,0)
^^1^1^3040524^
"^DD",668,668,32.6,21,1,0)
Secondary diagnosis 2 is related to Head/Neck Cancer.
"^DD",668,668,32.6,"DT")
3040525
"^DD",668,668,32.7,0)
SECONDARY COMBAT VET 2^S^0:NO;1:YES;^BA3;8^Q
"^DD",668,668,32.7,3)
Enter 'Y'es if Secondary diagnosis 2 is related to Combat.
"^DD",668,668,32.7,21,0)
^.001^1^1^3040524^^
"^DD",668,668,32.7,21,1,0)
Secondary diagnosis 2 is related to Combat.
"^DD",668,668,32.7,"DT")
3040525
"^DD",668,668,33,0)
SECONDARY ICD DIAGNOSIS 3^P80'^ICD9(^BA4;1^Q
"^DD",668,668,33,3)
Enter pointer to ICD Diagnosis file (#80) for Secondary Diagnosis 3.
"^DD",668,668,33,21,0)
^.001^1^1^3040524^^
"^DD",668,668,33,21,1,0)
Pointer to ICD Diagnosis file (#80) for Secondary Diagnosis code 3.
"^DD",668,668,33,"DT")
3040525
"^DD",668,668,33.1,0)
SECONDARY AGENT ORANGE 3^S^0:NO;1:YES;^BA4;2^Q
"^DD",668,668,33.1,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Agent Orange exposure.
"^DD",668,668,33.1,21,0)
^^1^1^3040524^
"^DD",668,668,33.1,21,1,0)
Secondary diagnosis 3 is related to Agent Orange.
"^DD",668,668,33.1,"DT")
3040525
"^DD",668,668,33.2,0)
SECONDARY IONIZED RADIATION 3^S^0:NO;1:YES;^BA4;3^Q
"^DD",668,668,33.2,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Ionized Radiation exposure.
"^DD",668,668,33.2,21,0)
^^1^1^3040524^
"^DD",668,668,33.2,21,1,0)
Secondary diagnosis 3 is related to Ionized Radiation.
"^DD",668,668,33.2,"DT")
3040525
"^DD",668,668,33.3,0)
SECONDARY SERVICE-CONNECTED 3^S^0:NO;1:YES;^BA4;4^Q
"^DD",668,668,33.3,3)
Enter 'Y'es if Secondary diagnosis 3 is related to a Service-Connected condition.
"^DD",668,668,33.3,21,0)
^^1^1^3040524^
"^DD",668,668,33.3,21,1,0)
Secondary diagnosis 3 is related to a Service-Connected condition.
"^DD",668,668,33.3,"DT")
3040525
"^DD",668,668,33.4,0)
SECONDARY ENVIRON. CONT. 3^S^0:NO;1:YES;^BA4;5^Q
"^DD",668,668,33.4,3)
Enter 'Y'es if Secondary diagnosis 3 is related to Environmental Contaminants exposure.
"^DD",668,668,33.4,21,0)
^^1^1^3040524^
"^DD",668,668,33.4,21,1,0)
Secondary diagnosis 3 is related to Environmental Contaminants exposure.
"^DD",668,668,33.4,"DT")
3040525
"^DD",668,668,33.5,0)
SECONDARY MST 3^S^0:NO;1:YES;^BA4;6^Q
"^DD",668,668,33.5,3)
Enter 'Y'es if diagnosis is related to Military Sexual Trauma.
"^DD",668,668,33.5,21,0)
^^1^1^3040524^
"^DD",668,668,33.5,21,1,0)
Secondary diagnosis 3 is related to Military Sexual Trauma.
"^DD",668,668,33.5,"DT")
3040525
"^DD",668,668,33.6,0)
SECONDARY HEAD/NECK CANCER 3^S^0:NO;1:YES;^BA4;7^Q
"^DD",668,668,33.6,3)
Enter 'Y'es to indicate Secondary diagnosis 3 is related to Head/Neck Cancer.
"^DD",668,668,33.6,21,0)
^^1^1^3040524^
"^DD",668,668,33.6,21,1,0)
Secondary diagnosis 3 is related to Head/Neck Cancer.
"^DD",668,668,33.6,"DT")
3040525
"^DD",668,668,33.7,0)
SECONDARY COMBAT VET 3^S^0:NO;1:YES;^BA4;8^Q
"^DD",668,668,33.7,3)
Enter 'Y'es to indicate Secondary diagnosis 3 is related to Combat.
"^DD",668,668,33.7,21,0)
^^1^1^3040524^
"^DD",668,668,33.7,21,1,0)
Secondary diagnosis 3 is related to Combat.
"^DD",668,668,33.7,"DT")
3040525
**INSTALL NAME**
PSO*7.0*143
"BLD",4987,0)
PSO*7.0*143^OUTPATIENT PHARMACY^0^3050805^y
"BLD",4987,1,0)
^^1^1^3050131^
"BLD",4987,1,1,0)
PSO*7.0*143 = Outpatient Pharmacy Clinical Indicator Data Capture (CIDC) KIDS
"BLD",4987,4,0)
^9.64PA^52.41^2
"BLD",4987,4,52,0)
52
"BLD",4987,4,52,2,0)
^9.641^52.052311^1
"BLD",4987,4,52,2,52.052311,0)
ICD DIAGNOSIS  (sub-file)
"BLD",4987,4,52,2,52.052311,1,0)
^9.6411^^0
"BLD",4987,4,52,222)
y^n^p^^^^n^^n
"BLD",4987,4,52,224)

"BLD",4987,4,52.41,0)
52.41
"BLD",4987,4,52.41,2,0)
^9.641^52.41311^1
"BLD",4987,4,52.41,2,52.41311,0)
DIAGNOSIS  (sub-file)
"BLD",4987,4,52.41,2,52.41311,1,0)
^9.6411^^0
"BLD",4987,4,52.41,222)
y^n^p^^^^n^^n
"BLD",4987,4,52.41,224)

"BLD",4987,4,"APDD",52,52.052311)

"BLD",4987,4,"APDD",52.41,52.41311)

"BLD",4987,4,"B",52,52)

"BLD",4987,4,"B",52.41,52.41)

"BLD",4987,"ABPKG")
n
"BLD",4987,"KRN",0)
^9.67PA^8989.52^19
"BLD",4987,"KRN",.4,0)
.4
"BLD",4987,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4987,"KRN",.401,0)
.401
"BLD",4987,"KRN",.401,"NM",0)
^9.68A^^
"BLD",4987,"KRN",.402,0)
.402
"BLD",4987,"KRN",.402,"NM",0)
^9.68A^^
"BLD",4987,"KRN",.403,0)
.403
"BLD",4987,"KRN",.403,"NM",0)
^9.68A^^
"BLD",4987,"KRN",.5,0)
.5
"BLD",4987,"KRN",.5,"NM",0)
^9.68A^^
"BLD",4987,"KRN",.84,0)
.84
"BLD",4987,"KRN",.84,"NM",0)
^9.68A^^
"BLD",4987,"KRN",3.6,0)
3.6
"BLD",4987,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",4987,"KRN",3.8,0)
3.8
"BLD",4987,"KRN",3.8,"NM",0)
^9.68A^^
"BLD",4987,"KRN",9.2,0)
9.2
"BLD",4987,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",4987,"KRN",9.8,0)
9.8
"BLD",4987,"KRN",9.8,"NM",0)
^9.68A^55^27
"BLD",4987,"KRN",9.8,"NM",7,0)
PSOHLNE1^^0^B71499142
"BLD",4987,"KRN",9.8,"NM",9,0)
PSOHLNEW^^0^B76783562
"BLD",4987,"KRN",9.8,"NM",21,0)
PSOHLSN1^^0^B86664066
"BLD",4987,"KRN",9.8,"NM",22,0)
PSOHLSN2^^0^B4070101
"BLD",4987,"KRN",9.8,"NM",23,0)
PSOHLSNC^^0^B54609968
"BLD",4987,"KRN",9.8,"NM",24,0)
PSOCP^^0^B75761381
"BLD",4987,"KRN",9.8,"NM",28,0)
PSOCPB^^0^B84161951
"BLD",4987,"KRN",9.8,"NM",29,0)
PSON52^^0^B58027930
"BLD",4987,"KRN",9.8,"NM",30,0)
PSOPTPST^^0^B26961793
"BLD",4987,"KRN",9.8,"NM",31,0)
PSONEW1^^0^B14209647
"BLD",4987,"KRN",9.8,"NM",32,0)
PSONEW2^^0^B28589674
"BLD",4987,"KRN",9.8,"NM",33,0)
PSORN52^^0^B69149232
"BLD",4987,"KRN",9.8,"NM",35,0)
PSORN52D^^0^B50476982
"BLD",4987,"KRN",9.8,"NM",36,0)
PSORENW1^^0^B54536370
"BLD",4987,"KRN",9.8,"NM",37,0)
PSONEWF^^0^B42076489
"BLD",4987,"KRN",9.8,"NM",38,0)
PSONEWG^^0^B21031672
"BLD",4987,"KRN",9.8,"NM",39,0)
PSOORED6^^0^B52070560
"BLD",4987,"KRN",9.8,"NM",40,0)
PSOBKDED^^0^B80276763
"BLD",4987,"KRN",9.8,"NM",41,0)
PSOOREDT^^0^B59269830
"BLD",4987,"KRN",9.8,"NM",43,0)
PSOMLLDT^^0^B85011495
"BLD",4987,"KRN",9.8,"NM",44,0)
PSOORNEW^^0^B67580073
"BLD",4987,"KRN",9.8,"NM",45,0)
PSOHLINC^^0^B13372670
"BLD",4987,"KRN",9.8,"NM",51,0)
PSOHLNE3^^0^B58436703
"BLD",4987,"KRN",9.8,"NM",52,0)
PSOMLLD2^^0^B18143810
"BLD",4987,"KRN",9.8,"NM",53,0)
PSODIAG^^0^B62047244
"BLD",4987,"KRN",9.8,"NM",54,0)
PSOCPC^^0^B66994025
"BLD",4987,"KRN",9.8,"NM",55,0)
PSOCPA^^0^B36106278
"BLD",4987,"KRN",9.8,"NM","B","PSOBKDED",40)

"BLD",4987,"KRN",9.8,"NM","B","PSOCP",24)

"BLD",4987,"KRN",9.8,"NM","B","PSOCPA",55)

"BLD",4987,"KRN",9.8,"NM","B","PSOCPB",28)

"BLD",4987,"KRN",9.8,"NM","B","PSOCPC",54)

"BLD",4987,"KRN",9.8,"NM","B","PSODIAG",53)

"BLD",4987,"KRN",9.8,"NM","B","PSOHLINC",45)

"BLD",4987,"KRN",9.8,"NM","B","PSOHLNE1",7)

"BLD",4987,"KRN",9.8,"NM","B","PSOHLNE3",51)

"BLD",4987,"KRN",9.8,"NM","B","PSOHLNEW",9)

"BLD",4987,"KRN",9.8,"NM","B","PSOHLSN1",21)

"BLD",4987,"KRN",9.8,"NM","B","PSOHLSN2",22)

"BLD",4987,"KRN",9.8,"NM","B","PSOHLSNC",23)

"BLD",4987,"KRN",9.8,"NM","B","PSOMLLD2",52)

"BLD",4987,"KRN",9.8,"NM","B","PSOMLLDT",43)

"BLD",4987,"KRN",9.8,"NM","B","PSON52",29)

"BLD",4987,"KRN",9.8,"NM","B","PSONEW1",31)

"BLD",4987,"KRN",9.8,"NM","B","PSONEW2",32)

"BLD",4987,"KRN",9.8,"NM","B","PSONEWF",37)

"BLD",4987,"KRN",9.8,"NM","B","PSONEWG",38)

"BLD",4987,"KRN",9.8,"NM","B","PSOORED6",39)

"BLD",4987,"KRN",9.8,"NM","B","PSOOREDT",41)

"BLD",4987,"KRN",9.8,"NM","B","PSOORNEW",44)

"BLD",4987,"KRN",9.8,"NM","B","PSOPTPST",30)

"BLD",4987,"KRN",9.8,"NM","B","PSORENW1",36)

"BLD",4987,"KRN",9.8,"NM","B","PSORN52",33)

"BLD",4987,"KRN",9.8,"NM","B","PSORN52D",35)

"BLD",4987,"KRN",19,0)
19
"BLD",4987,"KRN",19,"NM",0)
^9.68A^^
"BLD",4987,"KRN",19.1,0)
19.1
"BLD",4987,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",4987,"KRN",101,0)
101
"BLD",4987,"KRN",101,"NM",0)
^9.68A^^
"BLD",4987,"KRN",409.61,0)
409.61
"BLD",4987,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",4987,"KRN",771,0)
771
"BLD",4987,"KRN",771,"NM",0)
^9.68A^^
"BLD",4987,"KRN",870,0)
870
"BLD",4987,"KRN",870,"NM",0)
^9.68A^^
"BLD",4987,"KRN",8989.51,0)
8989.51
"BLD",4987,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",4987,"KRN",8989.52,0)
8989.52
"BLD",4987,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",4987,"KRN",8994,0)
8994
"BLD",4987,"KRN",8994,"NM",0)
^9.68A^^
"BLD",4987,"KRN","B",.4,.4)

"BLD",4987,"KRN","B",.401,.401)

"BLD",4987,"KRN","B",.402,.402)

"BLD",4987,"KRN","B",.403,.403)

"BLD",4987,"KRN","B",.5,.5)

"BLD",4987,"KRN","B",.84,.84)

"BLD",4987,"KRN","B",3.6,3.6)

"BLD",4987,"KRN","B",3.8,3.8)

"BLD",4987,"KRN","B",9.2,9.2)

"BLD",4987,"KRN","B",9.8,9.8)

"BLD",4987,"KRN","B",19,19)

"BLD",4987,"KRN","B",19.1,19.1)

"BLD",4987,"KRN","B",101,101)

"BLD",4987,"KRN","B",409.61,409.61)

"BLD",4987,"KRN","B",771,771)

"BLD",4987,"KRN","B",870,870)

"BLD",4987,"KRN","B",8989.51,8989.51)

"BLD",4987,"KRN","B",8989.52,8989.52)

"BLD",4987,"KRN","B",8994,8994)

"BLD",4987,"QUES",0)
^9.62^^
"BLD",4987,"REQB",0)
^9.611^14^6
"BLD",4987,"REQB",8,0)
PSO*7.0*157^2
"BLD",4987,"REQB",10,0)
PSO*7.0*132^2
"BLD",4987,"REQB",11,0)
PSO*7.0*133^2
"BLD",4987,"REQB",12,0)
PSO*7.0*119^2
"BLD",4987,"REQB",13,0)
PSO*7.0*185^2
"BLD",4987,"REQB",14,0)
PSO*7.0*181^2
"BLD",4987,"REQB","B","PSO*7.0*119",12)

"BLD",4987,"REQB","B","PSO*7.0*132",10)

"BLD",4987,"REQB","B","PSO*7.0*133",11)

"BLD",4987,"REQB","B","PSO*7.0*157",8)

"BLD",4987,"REQB","B","PSO*7.0*181",14)

"BLD",4987,"REQB","B","PSO*7.0*185",13)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52I
"FIA",52,0,1)
y^n^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52,52311)

"FIA",52,52.052311)
0
"FIA",52.41)
PENDING OUTPATIENT ORDERS
"FIA",52.41,0)
^PS(52.41,
"FIA",52.41,0,0)
52.41I
"FIA",52.41,0,1)
y^n^p^^^^n^^n
"FIA",52.41,0,10)

"FIA",52.41,0,11)

"FIA",52.41,0,"RLRO")

"FIA",52.41,0,"VR")
7.0^PSO
"FIA",52.41,52.41)
1
"FIA",52.41,52.41,311)

"FIA",52.41,52.41311)
0
"MBREQ")
1
"PKG",206,-1)
1^1
"PKG",206,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",206,20,0)
^9.402P^^
"PKG",206,22,0)
^9.49I^1^1
"PKG",206,22,1,0)
7.0^3021122^3021202^66481
"PKG",206,22,1,"PAH",1,0)
143^3050805^123456821
"PKG",206,22,1,"PAH",1,1,0)
^^1^1^3050805
"PKG",206,22,1,"PAH",1,1,1,0)
PSO*7.0*143 = Outpatient Pharmacy Clinical Indicator Data Capture (CIDC) KIDS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
27
"RTN","PSOBKDED")
0^40^B80276763
"RTN","PSOBKDED",1,0)
PSOBKDED ;BIR/SAB - Edit backdoor Rx Order entry ;04/17/95
"RTN","PSOBKDED",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,46,91,78,99,117,133,143**;DEC 1997
"RTN","PSOBKDED",3,0)
 ;Ref PS(50.607 IA 2221
"RTN","PSOBKDED",4,0)
 ;Ref PS(50.7 IA 2223
"RTN","PSOBKDED",5,0)
 ;Ref PS(51.2 IA 2226
"RTN","PSOBKDED",6,0)
 ;Ref PSDRUG( IA 221
"RTN","PSOBKDED",7,0)
 ;Ref DOSE^PSSORPH IA 3234
"RTN","PSOBKDED",8,0)
 ;Ref PS(55 IA 2228
"RTN","PSOBKDED",9,0)
1 S %DT="AEX",%DT(0)=-PSONEW("FILL DATE"),Y=PSONEW("ISSUE DATE") X ^DD("DD") S %DT("A")="ISSUE DATE: ",%DT("B")=Y D ^%DT
"RTN","PSOBKDED",10,0)
 I "^"[$E(X) D KX K %DT Q
"RTN","PSOBKDED",11,0)
 G:Y=-1 1 S (PSOID,PSONEW("ISSUE DATE"))=Y D KX K %DT
"RTN","PSOBKDED",12,0)
 Q
"RTN","PSOBKDED",13,0)
2 S PSONEW("FLD")=2 D FILLDT^PSODIR2(.PSONEW) ;Fdt
"RTN","PSOBKDED",14,0)
 Q
"RTN","PSOBKDED",15,0)
3 S:$G(POERR) PSONEW("ISSUE DATE")=PSOID
"RTN","PSOBKDED",16,0)
 S PSONEW("FLD")=3 D PTSTAT^PSODIR1(.PSONEW) ;Sta
"RTN","PSOBKDED",17,0)
 Q
"RTN","PSOBKDED",18,0)
4 S PSONEW("FLD")=4 D PROV^PSODIR(.PSONEW) ;Pro
"RTN","PSOBKDED",19,0)
 Q
"RTN","PSOBKDED",20,0)
5 S PSONEW("FLD")=5 D CLINIC^PSODIR2(.PSONEW) ;Cli
"RTN","PSOBKDED",21,0)
 Q
"RTN","PSOBKDED",22,0)
6 S PSONEW("FLD")=6 D ^PSODRG,EN^PSODIAG ;Drg/ICD
"RTN","PSOBKDED",23,0)
 Q
"RTN","PSOBKDED",24,0)
7 S PSONEW("FLD")=7 D QTY^PSODIR1(.PSONEW) ;Qty
"RTN","PSOBKDED",25,0)
 Q
"RTN","PSOBKDED",26,0)
8 S PSONEW("FLD")=8 D DAYS^PSODIR1(.PSONEW) ;Day
"RTN","PSOBKDED",27,0)
 K PSMAX,PSTMAX D REF^PSOORNEW S PSONEW("N# REF")=PSONEW("# OF REFILLS")
"RTN","PSOBKDED",28,0)
 Q
"RTN","PSOBKDED",29,0)
9 S PSONEW("FLD")=9 D REFILL^PSODIR1(.PSONEW) ;Ref
"RTN","PSOBKDED",30,0)
 K PSMAX,PSTMAX
"RTN","PSOBKDED",31,0)
 Q
"RTN","PSOBKDED",32,0)
10 S PSONEW("FLD")="3A" D DOSE^PSODIR(.PSONEW) ;Dose
"RTN","PSOBKDED",33,0)
 Q
"RTN","PSOBKDED",34,0)
 ;
"RTN","PSOBKDED",35,0)
 Q  I $G(COPY),$G(SIGOK) S PSOFDR=1 K PSONEW("SIG")
"RTN","PSOBKDED",36,0)
 S PSONEW("FLD")=10 D SIG^PSODIR1(.PSONEW) ;Sig
"RTN","PSOBKDED",37,0)
 I $G(COPY) K PSOFDR
"RTN","PSOBKDED",38,0)
 S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR D KV
"RTN","PSOBKDED",39,0)
 Q
"RTN","PSOBKDED",40,0)
INS S PSONEW("FLD")="3B" D INS^PSODIR(.PSONEW) ;Ins
"RTN","PSOBKDED",41,0)
 Q
"RTN","PSOBKDED",42,0)
11 S PSONEW("FLD")=11 D COPIES^PSODIR1(.PSONEW) ;Cop
"RTN","PSOBKDED",43,0)
 Q
"RTN","PSOBKDED",44,0)
12 S PSONEW("FLD")=12 D MW^PSODIR2(.PSONEW) ;M/W
"RTN","PSOBKDED",45,0)
 Q
"RTN","PSOBKDED",46,0)
13 S PSONEW("FLD")=13 D RMK^PSODIR2(.PSONEW) ;Rem
"RTN","PSOBKDED",47,0)
 Q
"RTN","PSOBKDED",48,0)
DOSE ;backdoor
"RTN","PSOBKDED",49,0)
 I '$G(PSONEW("ENT")) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (5) Dosage Ordered: " G INS1
"RTN","PSOBKDED",50,0)
 S SD=1 F I=1:1:PSONEW("ENT") D 
"RTN","PSOBKDED",51,0)
 .I '$G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOBKDED",52,0)
 .S:$G(SD)=1 IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (5)",DS=1 K SD
"RTN","PSOBKDED",53,0)
 .D DOSE1
"RTN","PSOBKDED",54,0)
INS1 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  (6)Pat Instruction:"
"RTN","PSOBKDED",55,0)
INS2 I $O(PSONEW("SIG",0)) F D=0:0 S D=$O(PSONEW("SIG",D)) Q:'D  D
"RTN","PSOBKDED",56,0)
 .F SG=1:1:$L(PSONEW("SIG",D)) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(PSONEW("SIG",D)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",21)=" " D
"RTN","PSOBKDED",57,0)
 ..S:$P(PSONEW("SIG",D)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(PSONEW("SIG",D)," ",SG)
"RTN","PSOBKDED",58,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") D  Q
"RTN","PSOBKDED",59,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" Other Patient Inst.: "
"RTN","PSOBKDED",60,0)
 .I $G(^PSRX(+$G(PSONEW("OIRXN")),"INSS"))]"" S PSONEW("SINS")=^PSRX(PSONEW("OIRXN"),"INSS")
"RTN","PSOBKDED",61,0)
 .S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_$G(PSONEW("SINS"))
"RTN","PSOBKDED",62,0)
 Q
"RTN","PSOBKDED",63,0)
 ;
"RTN","PSOBKDED",64,0)
DOSE1 I $G(DS)=1 D  K DS G DU
"RTN","PSOBKDED",65,0)
 .S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_" Dosage Ordered: "_$S($E(PSONEW("DOSE",I),1)="."&($G(PSONEW("DOSE ORDERED",I))):"0",1:"")_PSONEW("DOSE",I)_$S($G(PSONEW("UNITS",I))'="":" ("_$P(^PS(50.607,PSONEW("UNITS",I),0),"^")_")",1:"")
"RTN","PSOBKDED",66,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Dosage Ordered: "_$S($E(PSONEW("DOSE",I),1)="."&($G(PSONEW("DOSE ORDERED",I))):"0",1:"")_PSONEW("DOSE",I)_$S($G(PSONEW("UNITS",I))'="":" ("_$P(^PS(50.607,PSONEW("UNITS",I),0),"^")_")",1:"")
"RTN","PSOBKDED",67,0)
DU I '$G(PSONEW("DOSE ORDERED",I)),$P($G(^PS(55,PSODFN,"LAN")),"^") S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Oth. Lang. Dosage: "_$G(PSONEW("ODOSE",I))
"RTN","PSOBKDED",68,0)
 I $G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("VERB",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Verb: "_$G(PSONEW("VERB",I))
"RTN","PSOBKDED",69,0)
 S:$G(PSONEW("DOSE ORDERED",I)) IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="      Dispense Units: "_$S($E($G(PSONEW("DOSE ORDERED",I)),1)=".":"0",1:"")_$G(PSONEW("DOSE ORDERED",I))
"RTN","PSOBKDED",70,0)
 I $G(PSONEW("DOSE ORDERED",I)),$G(PSONEW("NOUN",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                Noun: "_PSONEW("NOUN",I)
"RTN","PSOBKDED",71,0)
 I $G(PSONEW("ROUTE",I)) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="               Route: "_$P(^PS(51.2,PSONEW("ROUTE",I),0),"^")
"RTN","PSOBKDED",72,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="            Schedule: "_PSONEW("SCHEDULE",I)
"RTN","PSOBKDED",73,0)
 I $G(PSONEW("DURATION",I))]"" D
"RTN","PSOBKDED",74,0)
 .S IEN=IEN+1
"RTN","PSOBKDED",75,0)
 .S ^TMP("PSOPO",$J,IEN,0)="           *Duration: "_PSONEW("DURATION",I)_" ("_$S(PSONEW("DURATION",I)["M":"MINUTES",PSONEW("DURATION",I)["W":"WEEKS",PSONEW("DURATION",I)["L":"MONTHS",PSONEW("DURATION",I)["H":"HOURS",1:"DAYS")_")"
"RTN","PSOBKDED",76,0)
 I $G(PSONEW("CONJUNCTION",I))]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="         Conjunction: "_$S($G(PSONEW("CONJUNCTION",I))="A":"AND",$G(PSONEW("CONJUNCTION",I))="T":"THEN",$G(PSONEW("CONJUNCTION",I))="X":"EXCEPT",1:"")
"RTN","PSOBKDED",77,0)
 Q
"RTN","PSOBKDED",78,0)
RTE I $G(DRET) S PSORXED("ROUTE",ENT)=""
"RTN","PSOBKDED",79,0)
 I $G(RTE) K RTE
"RTN","PSOBKDED",80,0)
 K DIR,DIRUT S DIR(0)="FO^2:45",DIR("A")="ROUTE",DIR("?")="^D HLP^PSOORED4"
"RTN","PSOBKDED",81,0)
 S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,$G(DRET):"",1:"PO") K:DIR("B")="" DIR("B")
"RTN","PSOBKDED",82,0)
 ;I '$G(PSORXED("ROUTE",ENT)),$G(PSOREEDT) K DIR("B")
"RTN","PSOBKDED",83,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="RTE",JUMP=1 K DIRUT,DTOUT Q
"RTN","PSOBKDED",84,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOBKDED",85,0)
 I X="@"!(X="") K RTE,ERTE S DRET=1,PSORXED("ROUTE",ENT)="" Q
"RTN","PSOBKDED",86,0)
 K DRET I X=$P($G(^PS(51.2,+$G(PSORXED("ROUTE",ENT)),0)),"^") S RTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^") W X_" "_$G(ERTE) Q
"RTN","PSOBKDED",87,0)
 S DIC=51.2,DIC(0)="QEZM",DIC("S")="I $P(^(0),""^"",4)" D ^DIC Q:X[U  G:Y=-1 RTE W "  "_$P(Y(0),"^",2)
"RTN","PSOBKDED",88,0)
 S:X'="" PSORXED("ROUTE",ENT)=+Y,RTE=Y(0,0),ERTE=$P(Y(0),"^",2)
"RTN","PSOBKDED",89,0)
 Q
"RTN","PSOBKDED",90,0)
ASK K JUMP,UNITN,DOSE D KV D DOSE^PSSORPH(.DOSE,PSODRUG("IEN"),"O",PSODFN)
"RTN","PSOBKDED",91,0)
 I $D(DOSE("DD")) I $G(PSOFROM)="PENDING"!($G(PSOREEDQ)) D LST2^PSOBKDE1 G ASK1
"RTN","PSOBKDED",92,0)
 D:$G(PSOFROM)="NEW"&($G(PSORX("EDIT"))']"")!($G(PSOFROM1))!($G(COPY)) LST^PSOBKDE1:$O(DOSE(0))
"RTN","PSOBKDED",93,0)
ASK1 S STRE=$P($G(DOSE("DD",PSODRUG("IEN"))),"^",5),UNITN=$P($G(DOSE("DD",PSODRUG("IEN"))),"^",6),DOSE("LD")=$P($G(DOSE("DD",PSODRUG("IEN"))),"^",11)
"RTN","PSOBKDED",94,0)
 W ! S DIR(0)="F^1:60",DIR("A",1)="Select from list of Available Dosages, Enter Free Text Dose",DIR("?")="^D LST1^PSOBKDE1",DIR("A")="or Enter a Question Mark (?) to view list"
"RTN","PSOBKDED",95,0)
 I $G(PSORXED("DOSE",ENT))]"" S DIR("B")=PSORXED("DOSE",ENT) D
"RTN","PSOBKDED",96,0)
 .I $G(PSORXED("UNITS",ENT))]"",DIR("B")'[($P($G(^PS(50.607,PSORXED("UNITS",ENT),0)),"^")) S DIR("B")=DIR("B")_$P($G(^PS(50.607,PSORXED("UNITS",ENT),0)),"^")
"RTN","PSOBKDED",97,0)
 K:$G(PSOREEDQ)!($G(PSOBDRG)) DIR("B")
"RTN","PSOBKDED",98,0)
 D ^DIR
"RTN","PSOBKDED",99,0)
 I X[U,$L(X)>1 S FIELD="ASK",JUMP=1 K DIRUT,DTOUT Q
"RTN","PSOBKDED",100,0)
 I $D(DIRUT) S:$G(ORD) PSODSPL=1 Q
"RTN","PSOBKDED",101,0)
 I X=$G(PSORXED("DOSE",ENT)),$D(DOSE(Y)) G GD1
"RTN","PSOBKDED",102,0)
 I X=$G(PSORXED("DOSE",ENT)) D  G DOS
"RTN","PSOBKDED",103,0)
 .S DOSE=X,UNITS=$G(PSORXED("UNITS",ENT))
"RTN","PSOBKDED",104,0)
 .I DOSE'?.N&(DOSE'?.N1".".N)!'DOSE("LD") S (UNITN,UNITS,PSORXED("UNITS",ENT))="" K PSORXED("DOSE ORDERED",ENT),DUPD,PSORXED("NOUN",ENT)
"RTN","PSOBKDED",105,0)
GD1 N PSORXTE
"RTN","PSOBKDED",106,0)
 I $D(DOSE(Y)) D  G DOS ;from list
"RTN","PSOBKDED",107,0)
 .S DOSE=$S($P(DOSE(Y),"^"):$P(DOSE(Y),"^"),$P(DOSE(Y),"^",3)]"":$P(DOSE(Y),"^",3),1:1),DOLST=Y
"RTN","PSOBKDED",108,0)
 .I $P(DOSE(Y),"^") S UNITS=$P(DOSE(Y),"^",2),DUPD=$P(DOSE(Y),"^",3),UNITN=$P(DOSE("DD",PSODRUG("IEN")),"^",6),PSORXTE("DOSE ORDERED",ENT)=DUPD
"RTN","PSOBKDED",109,0)
 .S PSORXTE("NOUN",ENT)=$P(DOSE(Y),"^",6),PSORXTE("VERB",ENT)=$P(DOSE(Y),"^",8)
"RTN","PSOBKDED",110,0)
 .I DOSE'?.N&(DOSE'?.N1".".N)!'DOSE("LD") D  Q
"RTN","PSOBKDED",111,0)
 ..S (UNITN,UNITS,PSORXED("UNITS",ENT))="" K PSORXED("DOSE ORDERED",ENT),DUPD,PSORXED("NOUN",ENT)
"RTN","PSOBKDED",112,0)
 ..I $P($G(^PS(55,PSODFN,"LAN")),"^"),$G(PSOFROM)="PENDING" D LAN^PSOORED5 Q
"RTN","PSOBKDED",113,0)
 ..I $P($G(^PS(55,PSODFN,"LAN")),"^"),$G(PSOFROM)="NEW" D LAN^PSOORED5
"RTN","PSOBKDED",114,0)
 .S PSORXTE("UNITS",ENT)=$G(UNITS)
"RTN","PSOBKDED",115,0)
 S DOSE=Y,DOLST=0 ;non-numeric and numeric not in list
"RTN","PSOBKDED",116,0)
 I DOSE("LD") D
"RTN","PSOBKDED",117,0)
 .F I=1:1:$L(DOSE)  I $E(DOSE,I)'?.N&($E(DOSE,I)'?1" ")&($E(DOSE,I)'?1".") S DCHK=$G(DCHK)_$E(DOSE,I)
"RTN","PSOBKDED",118,0)
 .I $G(DCHK)]"" D
"RTN","PSOBKDED",119,0)
 ..S DCHK=$TR(DCHK,"qwertyuioplkjhgfdsazxcvbnm","QWERTYUIOPLKJHGFDSAZXCVBNM")
"RTN","PSOBKDED",120,0)
 ..I DCHK=UNITN S DOSE=+DOSE
"RTN","PSOBKDED",121,0)
 K I,DCHK
"RTN","PSOBKDED",122,0)
 S PSOINDT=$$GET1^DIQ(50,PSODRUG("IEN"),100,"I") I PSOINDT,DT>PSOINDT G DOS
"RTN","PSOBKDED",123,0)
 S PSORXTE("NOUN",ENT)=$P(DOSE("DD",PSODRUG("IEN")),"^",9),PSORXTE("VERB",ENT)=$P(DOSE("DD",PSODRUG("IEN")),"^",10)
"RTN","PSOBKDED",124,0)
 I DOSE'?.N&(DOSE'?.N1".".N)!'DOSE("LD") S (UNITN,UNITS,PSORXED("UNITS",ENT))="" K PSORXED("NOUN",ENT),PSORXED("ODOSE",ENT) G DOS
"RTN","PSOBKDED",125,0)
 S:$P(DOSE("DD",PSODRUG("IEN")),"^",6)]"" (PSORXTE("UNITS",ENT),UNITS)=$O(^PS(50.607,"B",$P(DOSE("DD",PSODRUG("IEN")),"^",6),0)),UNITN=$P(DOSE("DD",PSODRUG("IEN")),"^",6)
"RTN","PSOBKDED",126,0)
 S:$P(DOSE("DD",PSODRUG("IEN")),"^",5) DUPD=DOSE/$P(DOSE("DD",PSODRUG("IEN")),"^",5),PSORXTE("DOSE ORDERED",ENT)=DUPD
"RTN","PSOBKDED",127,0)
DOS W " "_$S($E(DOSE,1)="."&($G(UNITN)'=""):"0",1:"")_DOSE W:$G(UNITN)'="" UNITN
"RTN","PSOBKDED",128,0)
 W ! K DIR,DIRUT S DIR(0)="Y",DIR("A")="You entered "_$S($E(DOSE,1)="."&($G(UNITN)'=""):"0",1:"")_DOSE_$S($G(UNITN)'="":UNITN,1:"")_" is this correct",DIR("B")="Yes"
"RTN","PSOBKDED",129,0)
 D ^DIR I 'Y D KX K DOSE,UNITS,PSORXTE,PSOINDT G ASK
"RTN","PSOBKDED",130,0)
 S PSORXED("DOSE",ENT)=DOSE
"RTN","PSOBKDED",131,0)
 S:$G(PSORXTE("DOSE ORDERED",ENT))]"" PSORXED("DOSE ORDERED",ENT)=PSORXTE("DOSE ORDERED",ENT)
"RTN","PSOBKDED",132,0)
 S:$G(PSORXTE("NOUN",ENT))]"" PSORXED("NOUN",ENT)=PSORXTE("NOUN",ENT)
"RTN","PSOBKDED",133,0)
 S:$G(PSORXTE("VERB",ENT))]"" PSORXED("VERB",ENT)=PSORXTE("VERB",ENT)
"RTN","PSOBKDED",134,0)
 S:$G(PSORXTE("UNITS",ENT))]"" PSORXED("UNITS",ENT)=PSORXTE("UNITS",ENT)
"RTN","PSOBKDED",135,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD"),$P($G(^PS(55,PSODFN,"LAN")),"^") D
"RTN","PSOBKDED",136,0)
 .K OTHDOS(ENT) D KX S DIR(0)="52.0113,9"
"RTN","PSOBKDED",137,0)
 .I '$G(OTHDOS(ENT)),$G(PSORXED("ODOSE",ENT))']"" D LAN^PSOORED5
"RTN","PSOBKDED",138,0)
 .I $G(PSORXED("ODOSE",ENT))]"" S DIR("B")=PSORXED("ODOSE",ENT) K:DIR("B")="" DIR("B")
"RTN","PSOBKDED",139,0)
 .K DTOUT,DUOUT,DIRUT,Y,X D ^DIR K DIR K:$G(X)="@"!($G(X)="") DIRUT I $D(DIRUT) Q
"RTN","PSOBKDED",140,0)
 .I X="@" S OTHDOS(ENT)=1 D KX K PSORXED("ODOSE",ENT) Q
"RTN","PSOBKDED",141,0)
 .S:X'="" PSORXED("ODOSE",ENT)=X
"RTN","PSOBKDED",142,0)
 Q
"RTN","PSOBKDED",143,0)
 ;
"RTN","PSOBKDED",144,0)
SCH D KX
"RTN","PSOBKDED",145,0)
 S DIR("?")="^D SCHLP^PSOORED4",DIR("A")="Schedule: ",DIR(0)="FA^1:20^I X[""""""""!(X?.E1C.E)!($A(X)=45)!($L(X,"" "")>3)!($L(X)>20)!($L(X)<1) K X"
"RTN","PSOBKDED",146,0)
 I '$D(PSOSCH),'$D(PSORXED("SCHEDULE",ENT)),$P(^PS(50.7,PSODRUG("OI"),0),"^",8)]"" S PSOSCH=$P(^PS(50.7,PSODRUG("OI"),0),"^",8)
"RTN","PSOBKDED",147,0)
 S DIR("B")=$S($D(PSOSCH)&('$D(PSORXED("SCHEDULE",ENT))):PSOSCH,$G(PSORXED("SCHEDULE",ENT))]"":PSORXED("SCHEDULE",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOBKDED",148,0)
 I $G(PSORXED("SCHEDULE",ENT))']"",$G(PSOREEDT) K DIR("B")
"RTN","PSOBKDED",149,0)
 D ^DIR
"RTN","PSOBKDED",150,0)
 Q
"RTN","PSOBKDED",151,0)
KX K X,Y
"RTN","PSOBKDED",152,0)
KV K DTOUT,DUOUT,DIR,DIRUT
"RTN","PSOBKDED",153,0)
 Q
"RTN","PSOCP")
0^24^B75761381
"RTN","PSOCP",1,0)
PSOCP ;BIR/BAB - Pharmacy CO-PAY Application Utilities for IB ;02/06/92
"RTN","PSOCP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,46,71,85,137,157,143**;DEC 1997
"RTN","PSOCP",3,0)
 ;
"RTN","PSOCP",4,0)
 ;REF/IA
"RTN","PSOCP",5,0)
 ;IBARX/125
"RTN","PSOCP",6,0)
 ;SDCO22/1579
"RTN","PSOCP",7,0)
 ;PS(55/2228
"RTN","PSOCP",8,0)
 ;PSDRUG(/221
"RTN","PSOCP",9,0)
 ;VADPT/10061
"RTN","PSOCP",10,0)
 ;DGMSTAPI/2716
"RTN","PSOCP",11,0)
CP ;Check if COPAY-Requires RXP,PSOSITE7
"RTN","PSOCP",12,0)
 I '$D(PSOPAR) D ^PSOLSET G CP
"RTN","PSOCP",13,0)
 K PSOCP
"RTN","PSOCP",14,0)
 S PSOCPN=$P(^PSRX(RXP,0),"^",2) ; Set COPAY dfn PTR TO PATIENT
"RTN","PSOCP",15,0)
 S PSOCP=$P($G(^PSRX(RXP,"IB")),"^") ; IB action type
"RTN","PSOCP",16,0)
 S PSOSAVE=$S(PSOCP:1,1:"") ; save current copay status
"RTN","PSOCP",17,0)
 ;   Set x=service^dfn^actiontype^user duz
"RTN","PSOCP",18,0)
 I +$G(PSOSITE7)'>0 S PSOSITE7=$P(^PS(59,PSOSITE,"IB"),"^")
"RTN","PSOCP",19,0)
 S X=PSOSITE7_"^"_PSOCPN_"^"_PSOCP_"^"_$P(^PSRX(RXP,0),"^",16)
"RTN","PSOCP",20,0)
 ;
"RTN","PSOCP",21,0)
RX ;Determine Orig or Refill for RX
"RTN","PSOCP",22,0)
 N PSOIB
"RTN","PSOCP",23,0)
 S PSOIB=0
"RTN","PSOCP",24,0)
 S PSOREF=0
"RTN","PSOCP",25,0)
 I $G(^PSRX(RXP,1,+$G(YY),0))]"" S PSOREF=YY
"RTN","PSOCP",26,0)
 ; Check if bill # already exists for this RX or Refill
"RTN","PSOCP",27,0)
 I 'PSOREF,+$P($G(^PSRX(RXP,"IB")),"^",2)>0 D CHKIB^PSOCP1 I PSOIB G QUIT
"RTN","PSOCP",28,0)
 I 'PSOREF,+$P($G(^PSRX(RXP,"IB")),"^",4)>0 G QUIT ; 'POTENTIAL BILL' - ALREADY ATTEMPTED TO BILL, BUT EXCEEDED ANNUAL COPAY CAP
"RTN","PSOCP",29,0)
 I PSOREF,+$G(^PSRX(RXP,1,PSOREF,"IB")) D CHKIB^PSOCP1 I PSOIB G QUIT
"RTN","PSOCP",30,0)
 I PSOREF,+$P($G(^PSRX(RXP,1,PSOREF,"IB")),"^",2) G QUIT ; POTENTIAL BILL
"RTN","PSOCP",31,0)
 S PSOCHG=1 ; set tem variable to copay and then look for exceptions
"RTN","PSOCP",32,0)
 N MAILMSG
"RTN","PSOCP",33,0)
 D COPAYREL
"RTN","PSOCP",34,0)
 I 'PSOCHG D  G QUIT
"RTN","PSOCP",35,0)
 . I PSOSAVE S PSODA=RXP,PREA="R" D ACTLOG^PSOCPA S $P(^PSRX(RXP,"IB"),"^",1)=""
"RTN","PSOCP",36,0)
 I PSOCHG=2 D  I 'PSOCP G QUIT ; IF 'SC' QUESTION APPLIES, BUT HAS NOT BEEN ANSWERED, SEND MAIL MSG AND KEEP COPAY STATUS AS IT WAS
"RTN","PSOCP",37,0)
 . D MAIL2^PSOCPE ; SEND MAIL TO PHARMACIST, PROVIDER, AND HOLDERS OF THE PSO COPAY KEY
"RTN","PSOCP",38,0)
 I PSOCHG=1,PSOSAVE="" D  I PSOREF S PSOCOMM="",PSOOLD="No Copay",PSONW="Copay" S PSODA=RXP,PREA="R" D ACTLOG^PSOCPA
"RTN","PSOCP",39,0)
 . I '$D(^PSRX(RXP,"IB")),'PSOREF S $P(^PSRX(RXP,"IB"),"^",1)=1 Q
"RTN","PSOCP",40,0)
 . S $P(^PSRX(RXP,"IB"),"^",1)=1
"RTN","PSOCP",41,0)
 . S PSOCP=1,$P(X,"^",3)=PSOCP
"RTN","PSOCP",42,0)
 I PSOCHG'=2 I $G(MAILMSG) D MAIL2^PSOCPE ; SEND MAIL TO PHARMACIST, PROVIDER, AND HOLDERS OF PSO COPAY KEY
"RTN","PSOCP",43,0)
 ;         Units for COPAY
"RTN","PSOCP",44,0)
 S PSOCPUN=$P(($P(^PSRX(RXP,0),"^",8)+29)/30,".",1)
"RTN","PSOCP",45,0)
 ;         Build softlink for x(n)=softlink^units
"RTN","PSOCP",46,0)
 S X(1)="52:"_RXP S:PSOREF>0 X(1)=X(1)_";1:"_PSOREF S X(1)=X(1)_"^"_PSOCPUN
"RTN","PSOCP",47,0)
 ;   Set correct user duz if refill
"RTN","PSOCP",48,0)
 I PSOREF S:+$P(^PSRX(RXP,1,PSOREF,0),"^",7)>0 $P(X,"^",4)=$P(^PSRX(RXP,1,PSOREF,0),"^",7)
"RTN","PSOCP",49,0)
 ;
"RTN","PSOCP",50,0)
IBNEW ;  Load ^TMP global for IB call
"RTN","PSOCP",51,0)
 Q:$G(RXP)'>0
"RTN","PSOCP",52,0)
 N D0
"RTN","PSOCP",53,0)
 G QUIT:'$D(X)
"RTN","PSOCP",54,0)
 S XTMP=X,XTMP(1)=X(1)
"RTN","PSOCP",55,0)
 ;
"RTN","PSOCP",56,0)
 ;   Requires x=service^dfn^action type^user duz
"RTN","PSOCP",57,0)
 ;        x(n)=softlink^units 
"RTN","PSOCP",58,0)
 I $P(X,"^",3)="" S $P(X,"^",3)=$P(^PSRX(RXP,"IB"),"^",1)
"RTN","PSOCP",59,0)
 D NEW^IBARX
"RTN","PSOCP",60,0)
 ;         Returns y=1^total charges for this group or Y=-1^error code
"RTN","PSOCP",61,0)
 ;              y(n)=IB number^charge for this Rx^AR bill #^Cap met^Partial or Full charge^Copay Exempt^Number from file 354.71
"RTN","PSOCP",62,0)
 ;                   Cap met ('1' - If patient has met cap amount or 
"RTN","PSOCP",63,0)
 ;                     reached cap with this charge or '0' if not)
"RTN","PSOCP",64,0)
 ;                   Partial or Full ('P' for partial billing, 'F' for
"RTN","PSOCP",65,0)
 ;                     full billing, null for no billing)
"RTN","PSOCP",66,0)
 ;                   Copay Exempt - ('1' for exempt, '0' for non-exempt,
"RTN","PSOCP",67,0)
 ;                     '-1' for copay off (manila))
"RTN","PSOCP",68,0)
 ;                   ('1' - If patient has met cap amount or reach cap with this charge
"RTN","PSOCP",69,0)
 ;                  Entry from file 354.71 will only be saved for fills that met the annual cap and could not be fully billed
"RTN","PSOCP",70,0)
 ;
"RTN","PSOCP",71,0)
 G QUIT:+Y=-1
"RTN","PSOCP",72,0)
 S XTMP=XTMP_"^"_Y,XTMP(1)=XTMP(1)_"^"_Y(1)
"RTN","PSOCP",73,0)
 ;
"RTN","PSOCP",74,0)
 ; see if exempt or copay cap was met for this fill
"RTN","PSOCP",75,0)
 I $P(Y(1),"^",6) D  G QUIT
"RTN","PSOCP",76,0)
 . S PREA="R",PSOOLD="Copay",PSONW="No Copay"
"RTN","PSOCP",77,0)
 . S PSOCOMM="RX COPAY INCOME EXEMPTION" S PSODA=RXP D ACTLOG^PSOCPA
"RTN","PSOCP",78,0)
 . S $P(^PSRX(RXP,"IB"),"^",1)=""
"RTN","PSOCP",79,0)
 I $P(Y(1),"^",4) D
"RTN","PSOCP",80,0)
 . S PSOCOMM=$S($P(Y(1),"^",5)="F":" FULL BILLING FOR THIS FILL",$P(Y(1),"^",5)="P":" PARTIAL BILLING FOR THIS FILL ",1:" NO BILLING FOR THIS FILL")
"RTN","PSOCP",81,0)
 . S PREA="A"
"RTN","PSOCP",82,0)
 . S PSODA=RXP D ACTLOG^PSOCPA
"RTN","PSOCP",83,0)
 . I $P(Y(1),"^",5)'="F" D
"RTN","PSOCP",84,0)
 . . I PSOREF S $P(^PSRX(RXP,1,PSOREF,"IB"),"^",2)=$P(Y(1),"^",7) Q
"RTN","PSOCP",85,0)
 . . S $P(^PSRX(RXP,"IB"),"^",4)=$P(Y(1),"^",7)
"RTN","PSOCP",86,0)
 I $P(Y(1),"^",1)="" G QUIT
"RTN","PSOCP",87,0)
 ;
"RTN","PSOCP",88,0)
FILE ;         File IB number in ^PSRX
"RTN","PSOCP",89,0)
 S PSOCP2=0
"RTN","PSOCP",90,0)
 S PSOCP2=+$P(XTMP(1),":",3)
"RTN","PSOCP",91,0)
 S:PSOCP2>0 ^PSRX(RXP,1,PSOCP2,"IB")=$P(XTMP(1),U,3) ;  Filing in refill node
"RTN","PSOCP",92,0)
 I PSOCP2>0,'$D(^PSRX(RXP,"IB")) S ^PSRX(RXP,"IB")="1^^" ;  If refill "IB" exists, need "IB" entry on original fill node
"RTN","PSOCP",93,0)
 S:PSOCP2=0 $P(^PSRX(RXP,"IB"),"^",2)=$P(XTMP(1),U,3) ;Filing in original fill (zero node)
"RTN","PSOCP",94,0)
QUIT ;
"RTN","PSOCP",95,0)
 K Y,PSOCP1,PSOCP2,QQ,PSOCPN,X,X2,XTMP,PSOCPUN,PSOREF,PSOCHG,PSOSAVE,PSOCOMM,PSOOLD,PSONW,PREA,PSORSN
"RTN","PSOCP",96,0)
 Q
"RTN","PSOCP",97,0)
EN D ^PSOLSET
"RTN","PSOCP",98,0)
EN1 S DIR(0)="NO",DIR("A")="Enter PRESCRIPTION number" D ^DIR K DIR G:$D(DIRUT) EXIT S RXP=X I +$G(^PSRX(RXP,0))'>0!+$P($G(^PSRX(RXP,"IB")),"^",0)>0 W !,?10,"RE-CHECK PRESCRIPTION NUMBER AND RE-ENTER " G EN1
"RTN","PSOCP",99,0)
 S PSOSITE7=$P(^PS(59,PSOSITE,"IB"),"^")
"RTN","PSOCP",100,0)
 S PSODFN=$P(^PSRX(RXP,0),"^",2)
"RTN","PSOCP",101,0)
 D CP G EN1
"RTN","PSOCP",102,0)
EXIT K RXP D FINAL^PSOLSET Q
"RTN","PSOCP",103,0)
 ;
"RTN","PSOCP",104,0)
SC(PSODFN,PSODD) ;supported reference for CPRS, Pre-Copay enhancement
"RTN","PSOCP",105,0)
 N PSOSC
"RTN","PSOCP",106,0)
 I $$DT^PSOMLLDT S PSOSC="" G SCQ
"RTN","PSOCP",107,0)
 I $G(PSODD),($P($G(^PSDRUG(PSODD,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I") S PSOSC=1 G SCQ
"RTN","PSOCP",108,0)
 I $P($G(^PS(55,+$G(PSODFN),"PS")),"^"),$P($G(^PS(53,+$P(^("PS"),"^"),0)),"^",7) S PSOSC=1 G SCQ
"RTN","PSOCP",109,0)
 N I,J,X S (X,PSOSC)=""
"RTN","PSOCP",110,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",111,0)
 G:'X SCQ
"RTN","PSOCP",112,0)
 S X=X_"^"_PSODFN D XTYPE^IBARX
"RTN","PSOCP",113,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSC=I
"RTN","PSOCP",114,0)
SCQ Q $S($G(PSOSC)=2:0,1:1)
"RTN","PSOCP",115,0)
 ;
"RTN","PSOCP",116,0)
COPAYREL ; Recheck copay status at release
"RTN","PSOCP",117,0)
 ;
"RTN","PSOCP",118,0)
 ; check Rx patient status
"RTN","PSOCP",119,0)
 I $P(^PSRX(RXP,0),"^",3)'="",$P($G(^PS(53,$P(^PSRX(RXP,0),"^",3),0)),"^",7)=1 S PSOCHG=0,PSOCOMM="Rx Patient Status Change",PSOOLD="Copay",PSONW="No Copay" Q
"RTN","PSOCP",120,0)
 ; see if drug is investigational or supply
"RTN","PSOCP",121,0)
 N DRG,DRGTYP,X
"RTN","PSOCP",122,0)
 S DRG=+$P(^PSRX(RXP,0),"^",6),DRGTYP=$P($G(^PSDRUG(DRG,0)),"^",3)
"RTN","PSOCP",123,0)
 I DRGTYP["I" S PSOCOMM="Investigational Drug",PSOCHG=0,PSOOLD="Copay",PSONW="No Copay",PSOCHG=0 Q
"RTN","PSOCP",124,0)
 I DRGTYP["S" S PSOCOMM="Supply Item",PSOCHG=0,PSOOLD="Copay",PSONW="No Copay",PSOCHG=0 Q
"RTN","PSOCP",125,0)
 K PSOTG,CHKXTYPE
"RTN","PSOCP",126,0)
 I +$G(^PSRX(RXP,"IBQ")) D XTYPE1^PSOCP1
"RTN","PSOCP",127,0)
 I $G(^PSRX(RXP,"IBQ"))["1" D  S PSOCHG=0,PSOOLD="Copay",PSONW="No Copay" Q  ; COPAY EXEMPT
"RTN","PSOCP",128,0)
 . N EXMT,II,PSOCIBQ
"RTN","PSOCP",129,0)
 . S PSOCIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCP",130,0)
 . F II=1,7,3,4,5,6,2 I $P(PSOCIBQ,"^",II)=1 S EXMT=$S(II=1:"SC",II=7:"CV",II=3:"AO",II=4:"IR",II=5:"EC",II=2:"MST",II=6:"HNC",1:"") D:EXMT'="" SETCOMM Q
"RTN","PSOCP",131,0)
 D SCNEW(.PSOTG,PSOCPN,DRG,RXP)
"RTN","PSOCP",132,0)
 N EXMT
"RTN","PSOCP",133,0)
 I '$D(CHKXTYPE) D XTYPE
"RTN","PSOCP",134,0)
 F EXMT="SC","CV","AO","IR","EC","MST","HNC" I $D(PSOTG(EXMT)) D  I 'PSOCHG Q
"RTN","PSOCP",135,0)
 . I PSOTG(EXMT)=1 S PSOCHG=0 D SETCOMM
"RTN","PSOCP",136,0)
 I 'PSOCHG S PSOOLD="Copay",PSONW="No Copay" Q
"RTN","PSOCP",137,0)
 ;
"RTN","PSOCP",138,0)
 ; If any of the applicable exemption questions have never been answered, generate a mail message with all of the questions
"RTN","PSOCP",139,0)
 S EXMT="",MAILMSG=0 F  S EXMT=$O(PSOTG(EXMT)) Q:EXMT=""  I PSOTG(EXMT)="" S MAILMSG=1 Q
"RTN","PSOCP",140,0)
 I MAILMSG,$D(PSOTG("SC")) I $G(PSOTG("SC"))="" S PSOCHG=2 ; 'SC' question not answered, don't reset copay status to 'copay'
"RTN","PSOCP",141,0)
 Q
"RTN","PSOCP",142,0)
 ;
"RTN","PSOCP",143,0)
SCNEW(PSOTG,PSOPT,PSODR,PSORN) ;CPRS supported reference
"RTN","PSOCP",144,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSOCP",145,0)
 I '$G(PSOPT) Q
"RTN","PSOCP",146,0)
 I $G(PSODR),($P($G(^PSDRUG(PSODR,0)),"^",3)["S")!($P($G(^(0)),"^",3)["I") Q
"RTN","PSOCP",147,0)
 N PSOCIBQ,PSOQMSH,PSOQVEH,PSOQRQD,PSOQHNC,PSOQPGW,DFN,PSONSC
"RTN","PSOCP",148,0)
 K PSOSCP,PSOANSQ("SC>50")
"RTN","PSOCP",149,0)
 S DFN=PSOPT D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) S:PSOSCP=""&($P(VAEL(3),U,1)=1) PSOSCP=0 S PSONSC=0 S:+$G(VAEL(1))=5 PSONSC=1 K VAEL
"RTN","PSOCP",150,0)
 I $G(PSORN) S PSOCIBQ=$G(^PSRX(PSORN,"IBQ"))
"RTN","PSOCP",151,0)
 I $G(PSORN)&(PSOSCP>49) D
"RTN","PSOCP",152,0)
 . I $D(^PSRX(PSORN,"ICD",1,0)) N ZXX S ZXX=^PSRX(PSORN,"ICD",1,0) D
"RTN","PSOCP",153,0)
 .. S PSOCIBQ=$P(ZXX,U,4)_"^"_$P(ZXX,U,6)_"^"_$P(ZXX,U,2)_"^"_$P(ZXX,U,3)_"^"_$P(ZXX,U,5)_"^"_$P(ZXX,U,7)_"^"_$P(ZXX,U,8)
"RTN","PSOCP",154,0)
 I '$G(PSORN) S PSOCIBQ=""
"RTN","PSOCP",155,0)
 ;Rx Patient Status check is not being done here
"RTN","PSOCP",156,0)
 N PSOSCMX,Y,I,J,X S (X,PSOSCMX)=""
"RTN","PSOCP",157,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",158,0)
 G:'X SKIP
"RTN","PSOCP",159,0)
 S X=X_"^"_PSOPT D XTYPE^IBARX
"RTN","PSOCP",160,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP",161,0)
SKIP ;
"RTN","PSOCP",162,0)
 I '$G(PSONSC) S PSOTG("SC")=$S($P(PSOCIBQ,"^")=1:1,$P(PSOCIBQ,"^")=0:0,$G(PSORN)&($P($G(^PSRX(+$G(PSORN),"IB")),"^")):0,1:"")
"RTN","PSOCP",163,0)
 ;I '$G(PSOSCMX) Q  ;;(CIDC-ask all quest flagged in enrollment)
"RTN","PSOCP",164,0)
 S:$$AO^SDCO22(PSOPT) PSOTG("AO")=$S($P(PSOCIBQ,"^",3)=1:1,$P(PSOCIBQ,"^",3)=0:0,1:"")
"RTN","PSOCP",165,0)
 S:$$IR^SDCO22(PSOPT) PSOTG("IR")=$S($P(PSOCIBQ,"^",4)=1:1,$P(PSOCIBQ,"^",4)=0:0,1:"")
"RTN","PSOCP",166,0)
 S:$$EC^SDCO22(PSOPT) PSOTG("EC")=$S($P(PSOCIBQ,"^",5)=1:1,$P(PSOCIBQ,"^",5)=0:0,1:"")
"RTN","PSOCP",167,0)
 S:$P($$GETSTAT^DGMSTAPI(PSOPT),"^",2)="Y" PSOTG("MST")=$S($P(PSOCIBQ,"^",2)=1:1,$P(PSOCIBQ,"^",2)=0:0,1:"")
"RTN","PSOCP",168,0)
 I $T(GETCUR^DGNTAPI)]"" N PSONC,PSONCX S PSONCX=$$GETCUR^DGNTAPI(PSOPT,"PSONC") I $P($G(PSONC("IND")),"^")="Y" S PSOTG("HNC")=$S($P(PSOCIBQ,"^",6)=1:1,$P(PSOCIBQ,"^",6)=0:0,1:"")
"RTN","PSOCP",169,0)
 S:$P($$CVEDT^DGCV(PSOPT),"^",3) PSOTG("CV")=$S($P(PSOCIBQ,"^",7)=1:1,$P(PSOCIBQ,"^",7)=0:0,1:"")
"RTN","PSOCP",170,0)
 Q
"RTN","PSOCP",171,0)
 ;
"RTN","PSOCP",172,0)
XTYPE ;
"RTN","PSOCP",173,0)
 N PSOCIBQ,PSOSCMX,Y,I,J,X,SAVY
"RTN","PSOCP",174,0)
 S (X,PSOSCMX,SAVY)=""
"RTN","PSOCP",175,0)
 S PSOCIBQ=$G(^PSRX(RXP,"IBQ"))
"RTN","PSOCP",176,0)
 I $P(PSOCIBQ,"^",1)'="" S PSOTG("SC")=$P(PSOCIBQ,"^",1)
"RTN","PSOCP",177,0)
 I $D(PSOTG("SC")),$P(PSOCIBQ,"^",1)="" S PSOTG("SC")="" ; USE "CURRENT" SETTING AS ANSWER TO SERVICE CONNECTED QUESTION IF IT APPLIES
"RTN","PSOCP",178,0)
 S J=0 F  S J=$O(^PS(59,J)) Q:'J  I +$G(^(J,"IB")) S X=+^("IB") Q
"RTN","PSOCP",179,0)
 I 'X Q
"RTN","PSOCP",180,0)
 S X=X_"^"_PSOCPN D XTYPE^IBARX
"RTN","PSOCP",181,0)
 I $G(Y)'=1 Q
"RTN","PSOCP",182,0)
 S J="" F  S J=$O(Y(J)) Q:'J  S I="" F  S SAVY=I,I=$O(Y(J,I)) Q:I=""  S:I>0 PSOSCMX=I
"RTN","PSOCP",183,0)
 I PSOSCMX="",SAVY=0 S PSOCHG=0 S PSOCOMM="Exempt from copayment" Q  ; INCOME EXEMPT OR SERVICE-CONNECTED
"RTN","PSOCP",184,0)
 I PSOSCMX=2,'$D(PSOTG("SC")) S PSOTG("SC")=$S(($G(RXP)&($P($G(^PSRX(+$G(RXP),"IB")),"^")))!($P(PSOCIBQ,"^")=0):0,$P(PSOCIBQ,"^")=1:1,1:"") Q
"RTN","PSOCP",185,0)
 Q
"RTN","PSOCP",186,0)
 ;
"RTN","PSOCP",187,0)
SETCOMM ;
"RTN","PSOCP",188,0)
 I EXMT="SC" S PSOCOMM="Service Connected" Q
"RTN","PSOCP",189,0)
 I EXMT="CV" S PSOCOMM="COMBAT VETERAN" Q
"RTN","PSOCP",190,0)
 I EXMT="AO" S PSOCOMM="AGENT ORANGE RELATED" Q
"RTN","PSOCP",191,0)
 I EXMT="IR" S PSOCOMM="IONIZING RAD RELATED" Q
"RTN","PSOCP",192,0)
 I EXMT="EC" S PSOCOMM="ENV CONTAMINANTS RELATED" Q
"RTN","PSOCP",193,0)
 I EXMT="MST" S PSOCOMM="MILITARY SEXUAL TRAUMA" Q
"RTN","PSOCP",194,0)
 I EXMT="HNC" S PSOCOMM="Head and/or Neck Cancer" Q
"RTN","PSOCP",195,0)
 Q
"RTN","PSOCP",196,0)
 ;
"RTN","PSOCPA")
0^55^B36106278
"RTN","PSOCPA",1,0)
PSOCPA ;BHAM ISC/LGH - PHARMACY CO-PAY CANCEL & RESET STATUS OPTIONS ; 05/27/92
"RTN","PSOCPA",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**9,71,85,137,143**;DEC 1997
"RTN","PSOCPA",3,0)
 ;
"RTN","PSOCPA",4,0)
 ;REF/IA
"RTN","PSOCPA",5,0)
 ;^IBARX/125
"RTN","PSOCPA",6,0)
 ;^IBE(350.3/2216
"RTN","PSOCPA",7,0)
 ; PSO=1 (REMOVE CHARGE cancel),PSO=2 (UPDATE CHARGE called from EDIT)
"RTN","PSOCPA",8,0)
 ; PSO=3 (REMOVE CHARGE cancel in background processing) ... USED FOR PSOHLNE3
"RTN","PSOCPA",9,0)
 ;
"RTN","PSOCPA",10,0)
EN ;Entry point for Remove Co-Pay charge
"RTN","PSOCPA",11,0)
 S PSOFLAG=0
"RTN","PSOCPA",12,0)
 S PSO=1 ; Remove Co-Pay charge
"RTN","PSOCPA",13,0)
RX ;
"RTN","PSOCPA",14,0)
 G EXIT:PSO'>0
"RTN","PSOCPA",15,0)
 W ! S DIC="^PSRX(",DIC(0)="AEQMZ" D ^DIC K DIC G EXIT:Y<0 S PSODA=+Y
"RTN","PSOCPA",16,0)
RXED ;         Entry point from PSORXED and PSORESK1...requires PSODA,PSO,PSODAYS,PSOFLAG
"RTN","PSOCPA",17,0)
 N POTBILL
"RTN","PSOCPA",18,0)
 S PSORXN=$P(^PSRX(PSODA,0),"^") ;..........Rx #
"RTN","PSOCPA",19,0)
 ;          Determine if Rx is COPAY 
"RTN","PSOCPA",20,0)
 I PSO'=3 I '$D(^PSRX(PSODA,"IB")) W !,"Rx # ",PSORXN," is NOT a COPAY transaction...NO action taken." G EXIT
"RTN","PSOCPA",21,0)
 I PSO'=3 S PSOIB=^PSRX(PSODA,"IB")
"RTN","PSOCPA",22,0)
 I PSO=2!(PSO=1) I $P(PSOIB,"^",2)'>0 S POTBILL=$P(PSOIB,"^",4) I POTBILL="",'$D(^PSRX(PSODA,1)) G EXIT ; No bill#, no refills
"RTN","PSOCPA",23,0)
 I PSO=3&($G(PSOREF)=0) I $P(PSOIB,"^",2)'>0 S POTBILL=$P(PSOIB,"^",4) I POTBILL="",'$D(^PSRX(PSODA,1)) G EXIT ; No bill#, no refills
"RTN","PSOCPA",24,0)
 ;          Determine last entry in ^PSRX
"RTN","PSOCPA",25,0)
 I PSO=3&($D(^PSRX(PSODA,1))) G RXED2
"RTN","PSOCPA",26,0)
 S PSOREF=0
"RTN","PSOCPA",27,0)
 G:'$D(^PSRX(PSODA,1)) REASON
"RTN","PSOCPA",28,0)
 F PSZ=0:0 S PSZ=$O(^PSRX(PSODA,1,PSZ)) Q:PSZ'>0  S PSOREF=PSZ
"RTN","PSOCPA",29,0)
 S PSOIB=$G(^PSRX(PSODA,1,PSOREF,"IB"))
"RTN","PSOCPA",30,0)
RXED2 I PSO=2!(PSO=1)!(PSO=3) I $P(PSOIB,"^",1)'>0 S POTBILL=$P(PSOIB,"^",2)
"RTN","PSOCPA",31,0)
 G:($P(PSOIB,"^",1)'>0)&($G(POTBILL)'>0) EXIT ; No bill#
"RTN","PSOCPA",32,0)
REASON ;
"RTN","PSOCPA",33,0)
 ;          Get Cancellation reason
"RTN","PSOCPA",34,0)
 I PSO=1!(PSO=3) G CANCEL
"RTN","PSOCPA",35,0)
 S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select CHARGE REMOVAL REASON : " D ^DIC S:$G(Y)<0 COPAYFLG=0 K DIC D ENDMSG:Y<0 G EXIT:Y<0 S PSORSN=+Y
"RTN","PSOCPA",36,0)
 G UPDATE:PSO=2
"RTN","PSOCPA",37,0)
 G EXIT
"RTN","PSOCPA",38,0)
CANCEL ;
"RTN","PSOCPA",39,0)
 ;          Set x=service^dfn^^user duz
"RTN","PSOCPA",40,0)
 ;              x(n)=IB number^cancellation reason
"RTN","PSOCPA",41,0)
 N PSOIBST
"RTN","PSOCPA",42,0)
 I PSOREF=0,$P(PSOIB,"^",2)>0 S PSOIBST=$$STATUS^IBARX($P(PSOIB,"^",2)) I PSOIBST'=1,PSOIBST'=3 G EXITA
"RTN","PSOCPA",43,0)
 I $G(PSO)=1!(PSO=3) I PSOREF>0,$P(PSOIB,"^",1)>0 S PSOIBST=$$STATUS^IBARX($P(PSOIB,"^",1)) I PSOIBST'=1,PSOIBST'=3 G EXITA
"RTN","PSOCPA",44,0)
 I PSO'=3 S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select CHARGE REMOVAL REASON : " D ^DIC S:$G(Y)<0 COPAYFLG=0 K DIC D ENDMSG:Y<0 G EXIT:Y<0 S PSORSN=+Y
"RTN","PSOCPA",45,0)
 I PSO=3 S DIC="^IBE(350.3,",DIC(0)="QEZ",X="RX EDITED" D ^DIC K DIC G EXIT:Y<0 S PSORSN=+Y
"RTN","PSOCPA",46,0)
 S X=PSOPAR7_"^"_+$P(^PSRX(PSODA,0),"^",2)_"^^"_DUZ
"RTN","PSOCPA",47,0)
 S:PSOREF=0 X(PSORXN)=$S($G(POTBILL)="":+$P(PSOIB,"^",2),1:POTBILL)_"^"_PSORSN ; Original Rx
"RTN","PSOCPA",48,0)
 S:PSOREF>0 X(PSORXN)=$S($G(POTBILL)="":+^PSRX(PSODA,1,PSOREF,"IB"),1:POTBILL)_"^"_PSORSN ; Refill Rx
"RTN","PSOCPA",49,0)
 I $G(POTBILL)'="" D CANIBAM^IBARX G CANCEL2
"RTN","PSOCPA",50,0)
 D CANCEL^IBARX
"RTN","PSOCPA",51,0)
 ;          Return y=1 if success, -1^error code if error
"RTN","PSOCPA",52,0)
 ;                 y(n)=IB number^total charge^AR bill number
"RTN","PSOCPA",53,0)
 I +Y=-1 W !,"Error in processing...No action taken." G EXIT
"RTN","PSOCPA",54,0)
 G EXIT:'$D(Y(PSORXN))
"RTN","PSOCPA",55,0)
CANCEL2 D FILE
"RTN","PSOCPA",56,0)
 G EXIT
"RTN","PSOCPA",57,0)
FILE ;
"RTN","PSOCPA",58,0)
 ;          File new Bill # in ^PSRX
"RTN","PSOCPA",59,0)
 I '$G(POTBILL) S:PSOREF=0 $P(^PSRX(PSODA,"IB"),"^",2)=+Y(PSORXN) ;...Original Rx
"RTN","PSOCPA",60,0)
 I $G(POTBILL) S:PSOREF=0 $P(^PSRX(PSODA,"IB"),"^",4)="" ; IF POTENTIAL BILL IS CANCELLED, REMOVE ITS NUMBER FROM ^PSRX
"RTN","PSOCPA",61,0)
 I '$G(POTBILL) S:PSOREF>0 ^PSRX(PSODA,1,PSOREF,"IB")=+Y(PSORXN) ; ...Refill Rx
"RTN","PSOCPA",62,0)
 I $G(POTBILL) S:PSOREF>0 $P(^PSRX(PSODA,1,PSOREF,"IB"),"^",2)="" ; ...Refill Rx (REMOVE "POTENTIAL" BILL NUMBER WHEN CANCELLED)
"RTN","PSOCPA",63,0)
 I PSO=1 W !!,"Co-Pay transaction for Rx # ",PSORXN,$S(PSOREF>0:" refill # "_PSOREF,1:"")," has been cancelled." S PREA="C",PSOCOMM="Returned to stock"
"RTN","PSOCPA",64,0)
 I PSO=2 W !!,"Co-Pay transaction for Rx # ",PSORXN,$S(PSOREF>0:" refill # "_PSOREF,1:"")," has been updated." S PREA="E",PSOCOMM="Days supply change. Copay amount updated"
"RTN","PSOCPA",65,0)
 D ACTLOG
"RTN","PSOCPA",66,0)
 Q
"RTN","PSOCPA",67,0)
UPDATE ;if days supply changes during Rx edit, cancel old bill and get new bill number
"RTN","PSOCPA",68,0)
 N SAVEDA
"RTN","PSOCPA",69,0)
 S SAVEDA=$G(DA)
"RTN","PSOCPA",70,0)
 I PSOFLAG=0 W !,"Use Pharmacy Manager Option - Edit Prescriptions - to UPDATE this Rx." G EXIT
"RTN","PSOCPA",71,0)
 ;
"RTN","PSOCPA",72,0)
 ;    Set x=service^dfn^action type^user duz.....x value for update
"RTN","PSOCPA",73,0)
 ;  x(n)=softlink^units^IB number of parent to cancel^Cancellation reason
"RTN","PSOCPA",74,0)
 ;
"RTN","PSOCPA",75,0)
 S X=PSOPAR7_"^"_+$P(^PSRX(PSODA,0),"^",2)_"^"_$P(^PSRX(PSODA,"IB"),"^")_"^"_DUZ
"RTN","PSOCPA",76,0)
 ;                Units for COPAY
"RTN","PSOCPA",77,0)
 S PSOCPUN=$P(($P(^PSRX(PSODA,0),"^",8)+29)/30,".",1)
"RTN","PSOCPA",78,0)
 G EXIT:PSOCPUN=$P((PSODAYS+29)/30,".",1) ; No change if UNITS unchanged
"RTN","PSOCPA",79,0)
 ;
"RTN","PSOCPA",80,0)
 ;               Build softlink for x(n)
"RTN","PSOCPA",81,0)
 S X(PSORXN)="52:"_PSODA S:PSOREF>0 X(PSORXN)=X(PSORXN)_";1:"_PSOREF
"RTN","PSOCPA",82,0)
 ;
"RTN","PSOCPA",83,0)
 ;         Set IB number of Parent record to update
"RTN","PSOCPA",84,0)
 S PSOPARNT=$S(PSOREF=0:+$P(^PSRX(PSODA,"IB"),"^",2),PSOREF>0:+^PSRX(PSODA,1,PSOREF,"IB"),1:0)
"RTN","PSOCPA",85,0)
 S X(PSORXN)=X(PSORXN)_"^"_PSOCPUN_"^"_PSOPARNT_"^"_PSORSN
"RTN","PSOCPA",86,0)
 I $G(POTBILL)'="" D
"RTN","PSOCPA",87,0)
 . S $P(X(PSORXN),"^",3)=POTBILL
"RTN","PSOCPA",88,0)
 . I $T(UPIBAM^IBARX)="" Q
"RTN","PSOCPA",89,0)
 . D UPIBAM^IBARX
"RTN","PSOCPA",90,0)
 I '$G(POTBILL) D UPDATE^IBARX
"RTN","PSOCPA",91,0)
 ;          Return y=1 if success, -1^error code if error
"RTN","PSOCPA",92,0)
 ;                 y(n)=IB number^total charge^AR bill number
"RTN","PSOCPA",93,0)
 I +Y=-1 W !,"Error in processing...No action taken." G EXIT
"RTN","PSOCPA",94,0)
 G EXIT:'$D(Y(PSORXN))
"RTN","PSOCPA",95,0)
 D FILE
"RTN","PSOCPA",96,0)
 G EXIT
"RTN","PSOCPA",97,0)
 ;
"RTN","PSOCPA",98,0)
RXDEL ;          Entry point when Rx is deleted thru menu option -- THIS ENTRY POINT NO LONGER USED WITH MILL BILL COPAY CHANGES
"RTN","PSOCPA",99,0)
 K DIC S DIC="^IBE(350.3,",DIC(0)="M",X="RX DELETED" D ^DIC K DIC Q:+Y<0  S PSORSN=+Y
"RTN","PSOCPA",100,0)
 K Y
"RTN","PSOCPA",101,0)
 S PSODA=RXN,PSORXN=+RX
"RTN","PSOCPA",102,0)
 S X=PSOPAR7_"^"_+$P(RX,"^",2)_"^^"_DUZ
"RTN","PSOCPA",103,0)
 S X(PSORXN)=+$P(PSOIB,"^",2)_"^"_PSORSN ; Original Rx
"RTN","PSOCPA",104,0)
 D CANCEL^IBARX
"RTN","PSOCPA",105,0)
 W:+Y=1 !!,"Copay transaction for this Rx has been cancelled."
"RTN","PSOCPA",106,0)
 S PREA="C" D ACTLOG
"RTN","PSOCPA",107,0)
 G EXIT
"RTN","PSOCPA",108,0)
EXITA ;
"RTN","PSOCPA",109,0)
 I PSO=1 W !!,"Co-Pay transaction for Rx # ",PSORXN,$S(PSOREF>0:" refill # "_PSOREF,1:"")," has previously been cancelled."
"RTN","PSOCPA",110,0)
EXIT I $D(SAVEDA) S DA=SAVEDA ;
"RTN","PSOCPA",111,0)
 I PSO'=3 K PSO,PSOCPUN,PSODA,PSOFLAG,PSOIB,PSOPARNT,PSOREF,PSORSN,PSORXN,PSZ,X,Y Q
"RTN","PSOCPA",112,0)
 I PSO=3 K PSOCPUN,PSOPARNT,PSORXN,X,Y
"RTN","PSOCPA",113,0)
 Q
"RTN","PSOCPA",114,0)
ENDMSG ;
"RTN","PSOCPA",115,0)
 I PSO'=3 W !!,"Unable to UPDATE COPAY TRANSACTON without REMOVAL REASON entry."
"RTN","PSOCPA",116,0)
 Q
"RTN","PSOCPA",117,0)
ACTLOG ;ENTER MESSAGE INTO RX COPAY ACTIVITY LOG
"RTN","PSOCPA",118,0)
 N X,Y
"RTN","PSOCPA",119,0)
 S:'$D(PREA) PREA="R" D NOW^%DTC S PSI=0
"RTN","PSOCPA",120,0)
ACTL S PSI=+$O(^PSRX(PSODA,"COPAY",PSI)) G:$O(^PSRX(PSODA,"COPAY",PSI)) ACTL
"RTN","PSOCPA",121,0)
 K DIC,PSORSNZ I $G(PSORSN)'="" S DIC="^IBE(350.3,",DIC(0)="M",X="`"_PSORSN D ^DIC K DIC I $G(Y) S PSORSNZ=$P($G(Y),"^",2)
"RTN","PSOCPA",122,0)
 S PSORSNZ=$G(PSORSNZ)_$S($G(PSORSNZ)="":"",1:" ")_$G(PSOCOMM)
"RTN","PSOCPA",123,0)
 S ^PSRX(PSODA,"COPAY",+PSI+1,0)=%_"^"_PREA_"^"_DUZ_"^"_$G(PSOREF)_"^"_PSORSNZ_"^"_$G(PSOOLD)_"^"_$G(PSONW)
"RTN","PSOCPA",124,0)
 S ^PSRX(PSODA,"COPAY",0)="^52.0107DA^"_(+PSI+1)_"^"_(+PSI+1)
"RTN","PSOCPA",125,0)
 K PSORSNZ
"RTN","PSOCPA",126,0)
 Q
"RTN","PSOCPA",127,0)
 ;
"RTN","PSOCPB")
0^28^B84161951
"RTN","PSOCPB",1,0)
PSOCPB ;BIR/BaB - pharmacy co-pay application cont'd ; 9/20/96 11:47
"RTN","PSOCPB",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**72,71,85,185,143**;DEC 1997
"RTN","PSOCPB",3,0)
 ;
"RTN","PSOCPB",4,0)
 ;REF/IA
"RTN","PSOCPB",5,0)
 ;DIS^SDROUT2/112
"RTN","PSOCPB",6,0)
 ;^IBARX/125
"RTN","PSOCPB",7,0)
 ;VADPT/10061
"RTN","PSOCPB",8,0)
COPAY ;
"RTN","PSOCPB",9,0)
 ; Called by PSON52,PSORN52...Requires PSOCPAY,PSOBILL,DEA=PSDEA,PSOFLAG
"RTN","PSOCPB",10,0)
 ;PSOFLAG=1 NEW, PSOFLAG=0 RENEW
"RTN","PSOCPB",11,0)
 ;I '$G(DA) S DA=$G(PSOX("IRXN")) Q:'DA
"RTN","PSOCPB",12,0)
 ;S DA=$G(PSOX("IRXN")) Q:'DA
"RTN","PSOCPB",13,0)
 S PSOSAVE=PSOCPAY ; Save original status of PSOCPAY 
"RTN","PSOCPB",14,0)
 I $G(PSODRUG("DEA"))["S"!($G(PSODRUG("DEA"))["I") S PSOCPAY=0 ;G COPAY2
"RTN","PSOCPB",15,0)
 G:+PSOBILL'=2 COPAY2
"RTN","PSOCPB",16,0)
 D FULL^VALM1
"RTN","PSOCPB",17,0)
 ;S DFN=+$P(^PSRX(DA,0),"^",2) D DIS^SDROUT2
"RTN","PSOCPB",18,0)
 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing medication copay exemption defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSOCPB",19,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing medication copay exemption defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSOCPB",20,0)
 S DFN=+$G(PSODFN) D DIS^SDROUT2
"RTN","PSOCPB",21,0)
 ;CIDC:Below is to verify that SC question should be asked because
"RTN","PSOCPB",22,0)
 ; the enrollment info may have changed.  Checking to see if SC is marked
"RTN","PSOCPB",23,0)
 ; as yes even if no % is defined
"RTN","PSOCPB",24,0)
 K PSOSCP D ELIG^VADPT S PSOSCP="",PSOSCP=$P(VAEL(3),U,2) S:$P(VAEL(3),U,2)=""&($P(VAEL(3),U,1)=1) PSOSCP=0
"RTN","PSOCPB",25,0)
 I PSOSCP="" S PSOANSQ("SC")="",PSOCPAY=0,PSOSCP=$P(VAEL(3),U,2) G COPAY2  ;don't ask question and return with correct PSOSCP value.
"RTN","PSOCPB",26,0)
 E  S PSOSCP=$P(VAEL(3),U,2)
"RTN","PSOCPB",27,0)
 K VAEL
"RTN","PSOCPB",28,0)
ASK ;
"RTN","PSOCPB",29,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOCPB",30,0)
 K PSOCPZ("DFLG"),PSONEW("NEWCOPAY")
"RTN","PSOCPB",31,0)
 W ! K DIR,DTOUT,DIRUT,DUOUT
"RTN","PSOCPB",32,0)
 I $G(PSORX("SC"))="SC"!($G(PSORX("SC"))="NSC")!($G(PSOSCOTH)) W !,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! I $G(PSOSCOTX) S PSOSCOTX=2
"RTN","PSOCPB",33,0)
 S DIR("A")="Was treatment for Service Connected condition",DIR(0)="Y"
"RTN","PSOCPB",34,0)
 S DIR("?")="Enter 'Yes' if this prescription is for a Service Connected condition"
"RTN","PSOCPB",35,0)
 ;S:$G(PSORX("SC"))]"" DIR("B")=$S($G(PSORX("SC"))="SC":"YES",1:"NO") D ^DIR ;G:$D(DUOUT)!($D(DTOUT)) EXIT
"RTN","PSOCPB",36,0)
 I $G(PSORX("SC"))]""!($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))'="") S DIR("B")=$S($G(PSORX("SC"))="SC":"YES",$G(PSORX("SC"))="NSC":"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",1:"")
"RTN","PSOCPB",37,0)
 I $G(PSONEWFF),$G(PSOFLAG) I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) S DIR("B")=$S($G(PSOANSQD("SC"))=1:"YES",1:"NO")
"RTN","PSOCPB",38,0)
 I $G(DIR("B"))="YES"!($G(DIR("B"))="NO") S PSOUFLAG=$G(DIR("B"))
"RTN","PSOCPB",39,0)
 I $G(DIR("B"))="" K DIR("B")
"RTN","PSOCPB",40,0)
 D ^DIR
"RTN","PSOCPB",41,0)
 I $G(Y)=1!($G(Y)=0) S PSOANSQ("SC")=$G(Y) I $G(PSONEWFF),$G(PSOFLAG) S PSOANSQD("SC")=$G(Y)
"RTN","PSOCPB",42,0)
 I PSOFLAG I Y["^"!($D(DTOUT))!($D(DUOUT)) S PSOCPZ("DFLG")=1
"RTN","PSOCPB",43,0)
 S:Y=0 Y=2
"RTN","PSOCPB",44,0)
 S PSOANSR=+Y I 'PSOANSR,'PSOFLAG D  S $P(PSOCPAY,"^")=$S($G(PSOUFLAG)="N":1,1:0) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR G COPAY2
"RTN","PSOCPB",45,0)
 .W !!,"This Renewal has been designated as "_$S($G(PSOUFLAG)="Y":"SERVICE CONNECTED",1:"NON-SERVICE CONNECTED.")
"RTN","PSOCPB",46,0)
 .W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make corrections."
"RTN","PSOCPB",47,0)
 .S PSOANSQ("SC")=$S($G(PSOUFLAG)="Y":1,1:0)
"RTN","PSOCPB",48,0)
 ;I 'PSOANSR,PSOFLAG G EXIT
"RTN","PSOCPB",49,0)
 I $G(PSOFLAG),$G(PSOCPZ("DFLG")) G EXIT
"RTN","PSOCPB",50,0)
 S:PSOANSR=1 PSOCPAY=0 S:PSOANSR=2 $P(PSOCPAY,"^")=1
"RTN","PSOCPB",51,0)
 G COPAY2
"RTN","PSOCPB",52,0)
HELP ;
"RTN","PSOCPB",53,0)
 ;W !!,"You must answer YES or NO to this question to continue."
"RTN","PSOCPB",54,0)
 ;G ASK
"RTN","PSOCPB",55,0)
COPAY2 ;
"RTN","PSOCPB",56,0)
 I +PSOCPAY=1,($P(PSOCPAY,"^",2)=1)!($P(PSOCPAY,"^",2)=2) D
"RTN","PSOCPB",57,0)
 .;set IB node in ^PSRX for copay if xactn type is 1 or 2
"RTN","PSOCPB",58,0)
 .;S ^PSRX(DA,"IB")=$P(PSOCPAY,"^",2),$P(^("IB"),"^",3)=$P(PSOCPAY,"^",2)
"RTN","PSOCPB",59,0)
 .S PSONEW("NEWCOPAY")=$P($G(PSOCPAY),"^",2)_"^^"_$P($G(PSOCPAY),"^",2)
"RTN","PSOCPB",60,0)
EXIT ;
"RTN","PSOCPB",61,0)
 S PSOCPAY=PSOSAVE ; Restore value of PSOCPAY
"RTN","PSOCPB",62,0)
 K PSOSAVE,PSOANSR,DIR,DUOUT,DIRUT,DTOUT,Y,X
"RTN","PSOCPB",63,0)
 Q
"RTN","PSOCPB",64,0)
RESET ; RESET COPAY STATUS
"RTN","PSOCPB",65,0)
 K PSOSUMM
"RTN","PSOCPB",66,0)
 I '$D(PSOPAR) D ^PSOLSET G RESET
"RTN","PSOCPB",67,0)
 W ! S DIC="^PSRX(",DIC(0)="AEQMZ" D ^DIC K DIC G:Y<0 EXT S PSODA=+Y
"RTN","PSOCPB",68,0)
 W !,?17,"PATIENT: ",$P($G(^DPT($P(^PSRX(PSODA,0),"^",2),0)),"^")
"RTN","PSOCPB",69,0)
 D ICN^PSODPT($P(^PSRX(PSODA,0),"^",2))
"RTN","PSOCPB",70,0)
 S PSORXN=$P(^PSRX(PSODA,0),"^"),PREA="R"
"RTN","PSOCPB",71,0)
 S PCOPAY=$G(^PSRX(PSODA,"IB"))
"RTN","PSOCPB",72,0)
 W !!,"Rx # ",PSORXN," is a ",$S(+PCOPAY:"Copay",1:"No Copay")," prescription"
"RTN","PSOCPB",73,0)
 D EXEMCHK^PSOCPC ; CHECK/CHANGE EXEMPTION FLAGS
"RTN","PSOCPB",74,0)
 ;
"RTN","PSOCPB",75,0)
 S PSOIBQ=$G(^PSRX(PSODA,"IBQ"))
"RTN","PSOCPB",76,0)
 I '$G(^PSRX(PSODA,"IB")),PSOIBQ'["1" D  G ASKCAN
"RTN","PSOCPB",77,0)
 . K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want to reset the status to COPAY" D ^DIR K DIR
"RTN","PSOCPB",78,0)
 . I Y'=1 Q
"RTN","PSOCPB",79,0)
 . S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset : " D ^DIC K DIC I Y'<0 S PSORSN=+Y
"RTN","PSOCPB",80,0)
 . S PREA="R",PSOOLD="No Copay",PSONW="Copay",PSOCOMM="" D ACTLOG^PSOCPA
"RTN","PSOCPB",81,0)
 . S PSI=0,PSOCOMM="Copay status of this Rx has been reset to COPAY." D SETSUMM^PSOCPC
"RTN","PSOCPB",82,0)
 . S $P(^PSRX(PSODA,"IB"),"^")=1 ; Reset flag to COPAY
"RTN","PSOCPB",83,0)
 ;
"RTN","PSOCPB",84,0)
 I $G(^PSRX(PSODA,"IB")) D  G ASKCAN
"RTN","PSOCPB",85,0)
 . K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Do you want to reset the status to NO COPAYMENT" D ^DIR K DIR
"RTN","PSOCPB",86,0)
 . I Y'=1 Q
"RTN","PSOCPB",87,0)
 . S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset : " D ^DIC K DIC I Y'<0 S PSORSN=+Y
"RTN","PSOCPB",88,0)
 . S PREA="R",PSOOLD="Copay",PSONW="No Copay",PSOCOMM="" D ACTLOG^PSOCPA
"RTN","PSOCPB",89,0)
 . S PSI=0,PSOCOMM="Copay status of this Rx has been reset to NO COPAY." D SETSUMM^PSOCPC
"RTN","PSOCPB",90,0)
 . S $P(^PSRX(PSODA,"IB"),"^")="" ; Reset flag to NO COPAY
"RTN","PSOCPB",91,0)
ASKCAN D ASKCAN^PSOCPD
"RTN","PSOCPB",92,0)
 I '$D(PSOSUMM) S PSI=0,PSOCOMM="No action taken" D SETSUMM^PSOCPC
"RTN","PSOCPB",93,0)
 D PRTSUMM
"RTN","PSOCPB",94,0)
RESETE K PSODA,PSORXN,PSORSN,PSOREF,X,Y,PCOPAY,PREA,PSOCOMM,PSI
"RTN","PSOCPB",95,0)
 G RESET
"RTN","PSOCPB",96,0)
EXT K PSODA,PSORXN,PSORSN,PSOREF,X,Y,PCOPAY,PREA,PSOCOPAY
"RTN","PSOCPB",97,0)
 Q
"RTN","PSOCPB",98,0)
BILLED ; Collect IB numbers,cancel chrgs,reset flag.
"RTN","PSOCPB",99,0)
 W !!,"**********Charges are on file for this Rx.**********"
"RTN","PSOCPB",100,0)
 Q
"RTN","PSOCPB",101,0)
BILL2 ;
"RTN","PSOCPB",102,0)
 N PSOPREV ; VARIABLE FOR PREVIOUSLY CANCELLED
"RTN","PSOCPB",103,0)
 S PSOPREV=0
"RTN","PSOCPB",104,0)
 S DIC="^IBE(350.3,",DIC("S")="I $P(^(0),U,3)'=2",DIC(0)="AEQMZ",DIC("A")="Select Reason for Reset or Charge Cancellation : " D ^DIC K DIC G ENDMSG:Y<0 S PSORSN=+Y
"RTN","PSOCPB",105,0)
 S X=PSOPAR7_"^"_+$P(^PSRX(PSODA,0),"^",2)_"^^"_DUZ
"RTN","PSOCPB",106,0)
 S SAVX=X
"RTN","PSOCPB",107,0)
 D POTBILL2
"RTN","PSOCPB",108,0)
 I '$D(PSOCAN) G BILL2END
"RTN","PSOCPB",109,0)
 I $G(CANTYPE) D PREVCAN I $O(X(""))="" Q
"RTN","PSOCPB",110,0)
 I '$G(CANTYPE) S I="" F  S I=$O(PSOCAN(I)) Q:I=""  S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN
"RTN","PSOCPB",111,0)
 D CANCEL^IBARX
"RTN","PSOCPB",112,0)
 I $G(CANTYPE) D MSG
"RTN","PSOCPB",113,0)
 I '$D(Y) Q
"RTN","PSOCPB",114,0)
 I +Y=-1 Q
"RTN","PSOCPB",115,0)
 I $D(Y(PSORXN)),+Y(PSORXN)'=-1 S $P(^PSRX(PSODA,"IB"),"^",2)=+Y(PSORXN) K Y(PSORXN) S PREA="C",PSOREF=0,PSOOLD="",PSONW="" D ACTLOG^PSOCPA I '$G(CANTYPE) D MSG
"RTN","PSOCPB",116,0)
 F PSOREF=0:0 S PSOREF=$O(Y(PSOREF)) Q:PSOREF=""  I +Y(PSOREF)'=-1 S ^PSRX(PSODA,1,PSOREF,"IB")=+Y(PSOREF) S PREA="C",PSOOLD="",PSONW="" D ACTLOG^PSOCPA I '$G(CANTYPE) D MSG
"RTN","PSOCPB",117,0)
BILL2END K X,Y,SAVX,PSOREF,PSOCAN
"RTN","PSOCPB",118,0)
 Q
"RTN","PSOCPB",119,0)
 ;
"RTN","PSOCPB",120,0)
POTBILL2 ; see if any potential charges (entries from file 354.71 -- bills that exceeded cap previously) to be cancelled before cancelling regular charges
"RTN","PSOCPB",121,0)
 N X,I
"RTN","PSOCPB",122,0)
 S X=SAVX
"RTN","PSOCPB",123,0)
 I $T(CANIBAM^IBARX)="" Q
"RTN","PSOCPB",124,0)
 S I="" F  S I=$O(PSOCAN(I)) Q:I=""  I PSOCAN(I)["^CAP" S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN K PSOCAN(I)
"RTN","PSOCPB",125,0)
 I $O(X(""))="" Q
"RTN","PSOCPB",126,0)
 S PSOPREV=1
"RTN","PSOCPB",127,0)
 D CANIBAM^IBARX
"RTN","PSOCPB",128,0)
 I $D(X(PSORXN)) S $P(^PSRX(PSODA,"IB"),"^",4)="" S PREA="C",PSOREF=0,PSOCOMM="Potential charge cancelled",PSOOLD="",PSONW="" D ACTLOG^PSOCPA D POTMSG K X(PSORXN)
"RTN","PSOCPB",129,0)
 F PSOREF=0:0 S PSOREF=$O(X(PSOREF)) Q:PSOREF=""  Q:PSOREF>11  S $P(^PSRX(PSODA,1,PSOREF,"IB"),"^",2)="" S PREA="C",PSOCOMM="Potential charge cancelled",PSOOLD="",PSONW="" D ACTLOG^PSOCPA D POTMSG
"RTN","PSOCPB",130,0)
 K PSOREF,PREA,PSOCOMM
"RTN","PSOCPB",131,0)
 Q
"RTN","PSOCPB",132,0)
 ;
"RTN","PSOCPB",133,0)
REFILL S PSOREF=0
"RTN","PSOCPB",134,0)
 F  S PSOREF=$O(^PSRX(PSODA,1,PSOREF)) Q:PSOREF'?1N.N  I $D(^PSRX(PSODA,1,PSOREF,"IB")),+^("IB")>0 S X(PSOREF)=+^PSRX(PSODA,1,PSOREF,"IB")_"^"_$G(PSORSN)
"RTN","PSOCPB",135,0)
 S PSOREF=0 F  S PSOREF=$O(^PSRX(PSODA,1,PSOREF)) Q:PSOREF'?1N.N  I '$D(X(PSOREF)),+$P($G(^PSRX(PSODA,1,PSOREF,"IB")),"^",2) S XX(PSOREF)=+$P(^PSRX(PSODA,1,PSOREF,"IB"),"^",2)_"^"_$G(PSORSN) ; IF ONLY ENTRY FROM 354.71 SAVE IT
"RTN","PSOCPB",136,0)
 Q
"RTN","PSOCPB",137,0)
SETCP ; IF NOT COPAY MAKE ELIG CALL/SET FLAG FOR FUTURE
"RTN","PSOCPB",138,0)
 W ! S X=PSOPAR7_"^"_+$P(^PSRX(PSODA,0),"^",2)
"RTN","PSOCPB",139,0)
 D XTYPE^IBARX
"RTN","PSOCPB",140,0)
 I +Y=-1 W !!,"Error in processing Copay eligibility, no action taken." Q
"RTN","PSOCPB",141,0)
 S (ACTYP,BL)="",(PSOBILL,PSOCPAY)=0
"RTN","PSOCPB",142,0)
CP ;
"RTN","PSOCPB",143,0)
 S ACTYP=$O(Y(ACTYP)) G:'ACTYP CP1
"RTN","PSOCPB",144,0)
 F I=0:0 S BL=$O(Y(ACTYP,BL)) Q:BL=""  I BL>0 S PSOBILL=BL,PSOCPAY=ACTYP
"RTN","PSOCPB",145,0)
 G CP
"RTN","PSOCPB",146,0)
CP1 K ACTYP,BL,I
"RTN","PSOCPB",147,0)
 I (PSOBILL'>0)!(PSOCPAY=0) G INELIG
"RTN","PSOCPB",148,0)
 S $P(^PSRX(PSODA,"IB"),"^")=PSOCPAY
"RTN","PSOCPB",149,0)
 W !,"COPAY status on this Rx has been reset.",!,"*** Future refills will be classified as COPAY."
"RTN","PSOCPB",150,0)
 S PREA="R",PSOOLD="No Copay",PSONW="Copay"
"RTN","PSOCPB",151,0)
 D ACTLOG^PSOCPA
"RTN","PSOCPB",152,0)
 Q
"RTN","PSOCPB",153,0)
INELIG W !,"This Rx does not meet patient eligibility requirement for Copay.",!,"****** Status unchanged *******"
"RTN","PSOCPB",154,0)
 S Y=-1
"RTN","PSOCPB",155,0)
 ; K PSOCPAY,PSOBILL,PSODA,PSORXN,PSORSN
"RTN","PSOCPB",156,0)
 Q
"RTN","PSOCPB",157,0)
ENDMSG K X W !,"Unable to process CHARGE REMOVAL without REASON for Reset."
"RTN","PSOCPB",158,0)
 R !,"ENTER a REASON now?  (Y/N) ",X:DTIME Q:'$T
"RTN","PSOCPB",159,0)
 I ($E(X)["?")!("YyNn^"'[$E(X)) W !,"Enter YES to select REASON and RESET STATUS." G ENDMSG
"RTN","PSOCPB",160,0)
 I "Yy"[$E(X) G BILL2
"RTN","PSOCPB",161,0)
 Q
"RTN","PSOCPB",162,0)
 ;
"RTN","PSOCPB",163,0)
MSG ;
"RTN","PSOCPB",164,0)
 S PSI=0
"RTN","PSOCPB",165,0)
 I $G(CANTYPE) S PSOCOMM="Rx # "_PSORXN_" - All copay charges cancelled" D SETSUMM^PSOCPC K PSOCOMM Q
"RTN","PSOCPB",166,0)
 S PSOCOMM="Rx # "_PSORXN_" - "_$S(PSOREF=0:"Original fill",1:"Refill "_PSOREF)_" copay charge cancelled"
"RTN","PSOCPB",167,0)
 D SETSUMM^PSOCPC
"RTN","PSOCPB",168,0)
 K PSOCOMM
"RTN","PSOCPB",169,0)
 Q
"RTN","PSOCPB",170,0)
 ;
"RTN","PSOCPB",171,0)
POTMSG ;
"RTN","PSOCPB",172,0)
 S PSI=0
"RTN","PSOCPB",173,0)
 I $G(CANTYPE) Q  ; (MESSAGE WILL GET SET LATER)
"RTN","PSOCPB",174,0)
 S PSOCOMM="Rx # "_PSORXN_" - "_$S(PSOREF=0:"Original fill",1:"Refill "_PSOREF)_" potential copay charge cancelled"
"RTN","PSOCPB",175,0)
 D SETSUMM^PSOCPC
"RTN","PSOCPB",176,0)
 K PSOCOMM
"RTN","PSOCPB",177,0)
 Q
"RTN","PSOCPB",178,0)
 ;
"RTN","PSOCPB",179,0)
MSGNOCAN ;
"RTN","PSOCPB",180,0)
 S PSI=0
"RTN","PSOCPB",181,0)
 S PSOCOMM="Rx # "_PSORXN_" - All copay charges have already been cancelled." D SETSUMM^PSOCPC K PSOCOMM
"RTN","PSOCPB",182,0)
 Q
"RTN","PSOCPB",183,0)
 ;
"RTN","PSOCPB",184,0)
PRTSUMM ; print summary of actions in reset/cancel
"RTN","PSOCPB",185,0)
 I '$D(PSOSUMM) Q
"RTN","PSOCPB",186,0)
 W !
"RTN","PSOCPB",187,0)
 S PSI=""
"RTN","PSOCPB",188,0)
 F  S PSI=$O(PSOSUMM(PSI)) Q:PSI=""  W !,PSOSUMM(PSI)
"RTN","PSOCPB",189,0)
 K PSOSUMM
"RTN","PSOCPB",190,0)
 Q
"RTN","PSOCPB",191,0)
 ;
"RTN","PSOCPB",192,0)
PREVCAN ; PREVIEW CANCELS IF "ALL" IS SELECTED
"RTN","PSOCPB",193,0)
 N I,PSOBILL
"RTN","PSOCPB",194,0)
 S I="" F  S I=$O(PSOCAN(I)) Q:I=""  D  I PSOBILL S X($P(PSOCAN(I),"^",1))=$P(PSOCAN(I),"^",2)_"^"_PSORSN
"RTN","PSOCPB",195,0)
 . S PSOBILL=1 I $T(STATUS^IBARX)'="" I PSOCAN(I)'["CAP" S PSOBILL=$$STATUS^IBARX($P(PSOCAN(I),"^",2)) S:PSOBILL=2 PSOBILL=0 ; PREVIOUSLY CANCELLED
"RTN","PSOCPB",196,0)
 I $O(X(""))="" D
"RTN","PSOCPB",197,0)
 . I PSOPREV D MSG Q
"RTN","PSOCPB",198,0)
 . D MSGNOCAN
"RTN","PSOCPB",199,0)
 Q
"RTN","PSOCPB",200,0)
 ;
"RTN","PSOCPC")
0^54^B66994025
"RTN","PSOCPC",1,0)
PSOCPC ;BHAM ISC/BAB - PHARMACY CO-PAY APPLICATION ;06/09/92
"RTN","PSOCPC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,9,71,85,114,157,143**;DEC 1997
"RTN","PSOCPC",3,0)
 ;
"RTN","PSOCPC",4,0)
 ;REF/IA
"RTN","PSOCPC",5,0)
 ;piece 9 of zero node of File 350 and APDT cross reference of File 350/2215
"RTN","PSOCPC",6,0)
 ;$$STATUS^IBARX/125
"RTN","PSOCPC",7,0)
 ;File 350.1/592 (DBIA125-B)
"RTN","PSOCPC",8,0)
WARN ; Message when attempt is made to delete a refill date on COPAY
"RTN","PSOCPC",9,0)
 N PSOIB,PSOIBST
"RTN","PSOCPC",10,0)
 S PSOFLG=0
"RTN","PSOCPC",11,0)
 G:'$D(^PSRX(DA(1),1,DA,"IB")) ENDW
"RTN","PSOCPC",12,0)
 S PSOIB=^PSRX(DA(1),1,DA,"IB")
"RTN","PSOCPC",13,0)
 I +PSOIB'>0 G ENDW
"RTN","PSOCPC",14,0)
 S PSOIBST=$$STATUS^IBARX(+PSOIB) I PSOIBST=2!(PSOIBST=0) G ENDW
"RTN","PSOCPC",15,0)
 I +PSOIB>0 D CANCEL G ENDW:PSOFLG=0
"RTN","PSOCPC",16,0)
 I '$G(PSOXXDEL) D EN^DDIOL("This REFILL has COPAY charges, which MUST be removed","","$C(7),!!"),EN^DDIOL("BEFORE the refill date is deleted.","","!")
"RTN","PSOCPC",17,0)
 I '$G(PSOXXDEL) D EN^DDIOL("Use option RESET COPAY STATUS/CANCEL CHARGES, return to EDIT A PRESCRIPTION,","","!!"),EN^DDIOL("and delete the refill date.","","!"),EN^DDIOL(" ","","!!")
"RTN","PSOCPC",18,0)
 S PSOFLG=1
"RTN","PSOCPC",19,0)
ENDW ;
"RTN","PSOCPC",20,0)
 I PSOFLG
"RTN","PSOCPC",21,0)
 K PSOFLG
"RTN","PSOCPC",22,0)
 Q
"RTN","PSOCPC",23,0)
CANCEL ;Check if charge is cancelled for this Refill date
"RTN","PSOCPC",24,0)
 S PSOFLG=1 ;indicates a charge not cancelled
"RTN","PSOCPC",25,0)
 S PSOX=+^PSRX(DA(1),1,DA,"IB")
"RTN","PSOCPC",26,0)
 D LAST I PSOLAST'=PSOPARNT,$D(^IB(PSOLAST,0)),$P(^IBE(350.1,$P(^IB(PSOLAST,0),"^",3),0),"^",5)=2 S PSOFLG=0
"RTN","PSOCPC",27,0)
 K PSOLAST,PSOPARNT,PSOX,PSOL,PSOLDT
"RTN","PSOCPC",28,0)
 Q
"RTN","PSOCPC",29,0)
LAST ;find last entry
"RTN","PSOCPC",30,0)
 S PSOLAST=""
"RTN","PSOCPC",31,0)
 S PSOPARNT=$P(^IB(+PSOX,0),"^",9) I 'PSOPARNT S PSOPARNT=+PSOX
"RTN","PSOCPC",32,0)
 S PSOLDT=$O(^IB("APDT",PSOPARNT,"")) I +PSOLDT F PSOL=0:0 S PSOL=$O(^IB("APDT",PSOPARNT,PSOLDT,PSOL)) Q:'PSOL  S PSOLAST=PSOL
"RTN","PSOCPC",33,0)
 I PSOLAST="" S PSOLAST=PSOPARNT
"RTN","PSOCPC",34,0)
 Q
"RTN","PSOCPC",35,0)
 ;
"RTN","PSOCPC",36,0)
EXEMCHK ; Allow reset of exemption answers
"RTN","PSOCPC",37,0)
 N PSOTG,PSOCPN,PSOEXMT,PSOANS,OLDIBQ
"RTN","PSOCPC",38,0)
 S PSOANS=0
"RTN","PSOCPC",39,0)
 S OLDIBQ=$G(^PSRX(PSODA,"IBQ"))
"RTN","PSOCPC",40,0)
 I OLDIBQ[0!(OLDIBQ)[1 D
"RTN","PSOCPC",41,0)
 . S PSOANS=1
"RTN","PSOCPC",42,0)
 . I $P(OLDIBQ,"^",1)'="" S PSOTG("SC")=$P(OLDIBQ,"^",1)
"RTN","PSOCPC",43,0)
 . I $P(OLDIBQ,"^",2)'="" S PSOTG("MST")=$P(OLDIBQ,"^",2)
"RTN","PSOCPC",44,0)
 . I $P(OLDIBQ,"^",3)'="" S PSOTG("AO")=$P(OLDIBQ,"^",3)
"RTN","PSOCPC",45,0)
 . I $P(OLDIBQ,"^",4)'="" S PSOTG("IR")=$P(OLDIBQ,"^",4)
"RTN","PSOCPC",46,0)
 . I $P(OLDIBQ,"^",5)'="" S PSOTG("EC")=$P(OLDIBQ,"^",5)
"RTN","PSOCPC",47,0)
 . I $P(OLDIBQ,"^",6)'="" S PSOTG("HNC")=$P(OLDIBQ,"^",6)
"RTN","PSOCPC",48,0)
 . I $P(OLDIBQ,"^",7)'="" S PSOTG("CV")=$P(OLDIBQ,"^",7)
"RTN","PSOCPC",49,0)
 S PSOCPN=$P(^PSRX(PSODA,0),"^",2)
"RTN","PSOCPC",50,0)
 S RXP=PSODA
"RTN","PSOCPC",51,0)
 D SCNEW^PSOCP(.PSOTG,PSOCPN,"",PSODA)
"RTN","PSOCPC",52,0)
 N EXMT
"RTN","PSOCPC",53,0)
 D XTYPE^PSOCP ; KEEP THIS CALL IN HERE TO SEE IF SC QUESTION APPLIES
"RTN","PSOCPC",54,0)
 I $D(PSOTG("SC")) S PSOTG("SC")=$P(OLDIBQ,"^",1) ; CHANGED TO JUST USE IBQ SETTING IF SC QUESTION APPLIES - DON'T RE-CALCULATE SERVICE-CONNECTED
"RTN","PSOCPC",55,0)
 S EXMT="" F  S EXMT=$O(PSOTG(EXMT)) Q:EXMT=""  I PSOTG(EXMT)'="" S PSOANS=1 Q
"RTN","PSOCPC",56,0)
 I $O(PSOTG(""))="" Q
"RTN","PSOCPC",57,0)
 I PSOANS W !!,"The following exemption flags have been set:"
"RTN","PSOCPC",58,0)
 F EXMT="SC","CV","AO","IR","EC","MST","HNC" I $G(PSOTG(EXMT))'="" W !,EXMT,": ",?6,$S(PSOTG(EXMT)=1:"Yes",PSOTG(EXMT)=0:"No",1:"")
"RTN","PSOCPC",59,0)
 W !
"RTN","PSOCPC",60,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="N" D  S DIR("A")="Do you want to enter/edit any copay exemption flags"
"RTN","PSOCPC",61,0)
 . S EXMT="" F  S EXMT=$O(PSOTG(EXMT)) Q:EXMT=""  I PSOTG(EXMT)="" S DIR("B")="Y" Q
"RTN","PSOCPC",62,0)
 S DIR("?")="Enter 'Y' for Yes if you want to edit any applicable medication exemption flags."
"RTN","PSOCPC",63,0)
 S DIR("??")="^D HELPEXEM^PSOCPC"
"RTN","PSOCPC",64,0)
 D ^DIR K DIR S PSOEXMT=Y I Y'=1 Q
"RTN","PSOCPC",65,0)
 ; PRESENT ALL APPLICABLE EXEMPTIONS AND SAVE NEW ANSWERS
"RTN","PSOCPC",66,0)
 N PSOIBQ,PSOSUBS,PSOQUES,PSOLTAG,OLDIBQ,II,PSOCHG
"RTN","PSOCPC",67,0)
 S PSOIBQ=""
"RTN","PSOCPC",68,0)
 S OLDIBQ=$G(^PSRX(PSODA,"IBQ"))
"RTN","PSOCPC",69,0)
 I '$D(^PSRX(PSODA,"IBQ")),+($G(^PSRX(PSODA,"IB")))=2 S $P(OLDIBQ,"^",1)=0 ; SC QUESTION WAS PREVIOUSLY ANSWERED AS N
"RTN","PSOCPC",70,0)
 S PSOCOMM="",PSOOLD="",PSONW=""
"RTN","PSOCPC",71,0)
 S II=0
"RTN","PSOCPC",72,0)
 F EXMT="SC","CV","AO","IR","EC","MST","HNC" I $D(PSOTG(EXMT)) D
"RTN","PSOCPC",73,0)
 . S PSOLTAG="REL"_EXMT_"^PSOCPE"
"RTN","PSOCPC",74,0)
 . S HELPTAG="HELP"_EXMT
"RTN","PSOCPC",75,0)
 . S PSOQUES=$P($T(@PSOLTAG),";",2) I PSOQUES="" Q
"RTN","PSOCPC",76,0)
 . S PSOQUES=$P(PSOQUES,"?")
"RTN","PSOCPC",77,0)
 . S PSOSUBS=$P($T(@PSOLTAG),";",3) I PSOSUBS="" Q
"RTN","PSOCPC",78,0)
 . D ASKEXEM
"RTN","PSOCPC",79,0)
 I $D(PSOCHG) D
"RTN","PSOCPC",80,0)
 . S ^PSRX(PSODA,"IBQ")=PSOIBQ
"RTN","PSOCPC",81,0)
 . D RESET^PSORN52D  ;set SC/EI on ICD node
"RTN","PSOCPC",82,0)
 . D EN^PSOHLSN1(PSODA,"XX","","Order edited")
"RTN","PSOCPC",83,0)
 . I PCOPAY,PSOIBQ["1" D  ; RESET TO NO COPAY
"RTN","PSOCPC",84,0)
 . . W !,"Editing of exemption flag(s) has resulted in a copay status change.",!,"The status for this Rx will be reset to NO COPAY."
"RTN","PSOCPC",85,0)
 . . S $P(^PSRX(PSODA,"IB"),"^",1)=""
"RTN","PSOCPC",86,0)
 . . S PSOREF="",PSOOLD="Copay",PSONW="No Copay",PREA="R" D ACTLOG^PSOCPA
"RTN","PSOCPC",87,0)
 . . S PSOCOMM="Copay status reset due to exemption flag(s)"
"RTN","PSOCPC",88,0)
 . . S PSI=0 D SETSUMM
"RTN","PSOCPC",89,0)
 . I $G(II)>0 D
"RTN","PSOCPC",90,0)
 . . S PSOCOMM="The following exemption flags have been changed: ",PSI=0 D SETSUMM
"RTN","PSOCPC",91,0)
 . . S II="" F  S II=$O(PSOCHG(II)) Q:II=""  S PSOCOMM=PSOCHG(II),PSI=0 D SETSUMM
"RTN","PSOCPC",92,0)
 Q
"RTN","PSOCPC",93,0)
 ;
"RTN","PSOCPC",94,0)
ASKEXEM ; ASK THE EXEMPTION QUESTIONS
"RTN","PSOCPC",95,0)
 K DIR S DIR("A")=PSOQUES,DIR(0)="YO" S:PSOTG(EXMT)=1 DIR("B")="Y" S:PSOTG(EXMT)=0 DIR("B")="N" D @HELPTAG
"RTN","PSOCPC",96,0)
ASKEXEM1 D ^DIR I X="@" R !,"  Are you sure you want to delete this answer? ",X:DTIME I $E(X)'="Y",$E(X)'="y" G ASKEXEM1
"RTN","PSOCPC",97,0)
 I X="^" S X=$G(DIR("B")) S Y=$S(X="Y":1,X="N":0,1:"")
"RTN","PSOCPC",98,0)
 S $P(PSOIBQ,"^",PSOSUBS)=$S(Y=1:1,Y=0:0,1:"")
"RTN","PSOCPC",99,0)
 I $P(PSOIBQ,"^",PSOSUBS)'=$P(OLDIBQ,"^",PSOSUBS) S II=II+1,PSOCHG(II)=EXMT_": "_$S($P(PSOIBQ,"^",PSOSUBS)=1:"Yes",$P(PSOIBQ,"^",PSOSUBS)=0:"No",1:"")
"RTN","PSOCPC",100,0)
 I Y=1 D
"RTN","PSOCPC",101,0)
 . I PSOCOMM'="" Q
"RTN","PSOCPC",102,0)
 . D SETCOMM^PSOCP
"RTN","PSOCPC",103,0)
 Q
"RTN","PSOCPC",104,0)
 ;
"RTN","PSOCPC",105,0)
HELPEXEM ; help text for exemption edit question
"RTN","PSOCPC",106,0)
 W !,"Enter 'Y' for Yes if you want to edit any applicable exemption flags such as"
"RTN","PSOCPC",107,0)
 W !,"Service Connected (SC), Combat Veteran(CV), Agent Orange (AO), Ionizing Radiation (IR),"
"RTN","PSOCPC",108,0)
 W !,"Environmental Contaminants (EC), Military Sexual Trauma (MST), or"
"RTN","PSOCPC",109,0)
 W !,"Head and/or Neck Cancer (HNC)."
"RTN","PSOCPC",110,0)
 Q
"RTN","PSOCPC",111,0)
 ;
"RTN","PSOCPC",112,0)
HELPSC ;
"RTN","PSOCPC",113,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is for a Service Connected condition."
"RTN","PSOCPC",114,0)
 S DIR("?",2)="This response will be used to determine whether or not a copay should be"
"RTN","PSOCPC",115,0)
 S DIR("?",3)="applied to the prescription."
"RTN","PSOCPC",116,0)
 Q
"RTN","PSOCPC",117,0)
 ;
"RTN","PSOCPC",118,0)
HELPAO ;
"RTN","PSOCPC",119,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="Vietnam-Era Herbicide (Agent Orange) exposure. This response will be used to"
"RTN","PSOCPC",120,0)
 S DIR("?",3)="determine whether or not a copay should be applied to the prescription."
"RTN","PSOCPC",121,0)
 Q
"RTN","PSOCPC",122,0)
 ;
"RTN","PSOCPC",123,0)
HELPIR ;
"RTN","PSOCPC",124,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="ionizing radiation exposure during military service. This response will be used"
"RTN","PSOCPC",125,0)
 S DIR("?",3)="to determine whether or not a copay should be applied to the prescription."
"RTN","PSOCPC",126,0)
 Q
"RTN","PSOCPC",127,0)
 ;
"RTN","PSOCPC",128,0)
HELPEC ;
"RTN","PSOCPC",129,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="environmental contaminant exposure during the Persian Gulf War. This response"
"RTN","PSOCPC",130,0)
 S DIR("?",3)="will be used to determine whether or not a copay should be applied to the",DIR("?",4)="prescription."
"RTN","PSOCPC",131,0)
 Q
"RTN","PSOCPC",132,0)
 ;
"RTN","PSOCPC",133,0)
HELPMST ;
"RTN","PSOCPC",134,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Military Sexual Trauma. This response will be used to determine whether or"
"RTN","PSOCPC",135,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOCPC",136,0)
 Q
"RTN","PSOCPC",137,0)
 ;
"RTN","PSOCPC",138,0)
HELPHNC ;
"RTN","PSOCPC",139,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat Head and/or Neck Cancer",DIR("?",2)="due to nose or throat radium treatments while in the military. This response"
"RTN","PSOCPC",140,0)
 S DIR("?",3)="will be used to determine whether or not a copay should be applied to the",DIR("?",4)="prescription."
"RTN","PSOCPC",141,0)
 Q
"RTN","PSOCPC",142,0)
 ;
"RTN","PSOCPC",143,0)
HELPCV ;
"RTN","PSOCPC",144,0)
 S DIR("?")=" "
"RTN","PSOCPC",145,0)
 S DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related"
"RTN","PSOCPC",146,0)
 S DIR("?",2)="to Combat Services. This response will be used to determine whether or"
"RTN","PSOCPC",147,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOCPC",148,0)
 Q
"RTN","PSOCPC",149,0)
 ;
"RTN","PSOCPC",150,0)
SETSUMM ; SET MESSAGE INTO SUMMARY
"RTN","PSOCPC",151,0)
 S PSI=$O(PSOSUMM(PSI)) G:$O(PSOSUMM(PSI)) SETSUMM
"RTN","PSOCPC",152,0)
 S PSI=PSI+1,PSOSUMM(PSI)=PSOCOMM
"RTN","PSOCPC",153,0)
 K PSOCOMM
"RTN","PSOCPC",154,0)
 Q
"RTN","PSOCPC",155,0)
 ;
"RTN","PSODIAG")
0^53^B62047244
"RTN","PSODIAG",1,0)
PSODIAG ; BIR/LE - Diagnosis code prompts ;02/27/04
"RTN","PSODIAG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143**;DEC 1997
"RTN","PSODIAG",3,0)
 ;Ext ref to ^XUSEC sup by DBIA 10076
"RTN","PSODIAG",4,0)
 ;Ext ref to $$ICDDX^ICDCODE sup DBIA 3990
"RTN","PSODIAG",5,0)
 ;Ext ref to $$STATCHK^ICDAPIU sup DBIA 3991
"RTN","PSODIAG",6,0)
EN ;
"RTN","PSODIAG",7,0)
 ;don't ask icd's if user doesn't hold provider key
"RTN","PSODIAG",8,0)
 Q:$T(CIDC^IBBAPI)']""
"RTN","PSODIAG",9,0)
 Q:'$D(^XUSEC("PROVIDER",DUZ))
"RTN","PSODIAG",10,0)
 N PSODDFN S PSODDFN=$S($D(DFN):DFN,$D(PSODFN):PSODFN,1:"")  ;need to do this since PU patient update deletes DFN and in case some other function does
"RTN","PSODIAG",11,0)
 I PSODDFN'="" Q:'$$CIDC^IBBAPI(PSODDFN)  ;is CIDC activated; does patient have insurance
"RTN","PSODIAG",12,0)
 ;new variables and initialize variables based on CPRS or backdoor order.
"RTN","PSODIAG",13,0)
 N DX,POP,I,J,X,Y,Z,OLD,OLDI,SOLDI,NEW,TNEW,RAR,CPRS,FILDAT,STATCHK,STATCHK2
"RTN","PSODIAG",14,0)
 I '$G(PSOX("IRXN")) N PSOX S:$G(PSORXED("IRXN")) PSOX("IRXN")=PSORXED("IRXN")
"RTN","PSODIAG",15,0)
 K DIC
"RTN","PSODIAG",16,0)
 S CPRS=0
"RTN","PSODIAG",17,0)
 I $G(PSORXED) S RAR="PSORXED",@RAR@("DFLG")=0,PSORXED("FLD",39.3)=""
"RTN","PSODIAG",18,0)
 E  S RAR="PSONEW",@RAR@("DFLG")=0 I $G(ORD) D
"RTN","PSODIAG",19,0)
 . I $D(^PS(52.41,ORD)) S CPRS=1 M PSONEW("ICD")=PSORXED("ICD") K PSORXED("ICD"),PSORXED("FLD",39.3)
"RTN","PSODIAG",20,0)
 ;
"RTN","PSODIAG",21,0)
 S FILDAT="",FILDAT=DT I $G(PSOX("IRXN")) S FILDAT=$$GET1^DIQ(52,PSOX("IRXN")_",","22","I")
"RTN","PSODIAG",22,0)
 ;display any previously entered ICD's
"RTN","PSODIAG",23,0)
 W !!,"Previously entered ICD-9 diagnosis codes: "
"RTN","PSODIAG",24,0)
 I 'CPRS D  ;&(RAR="PSORXED"!(RAR="PSONEW")) D
"RTN","PSODIAG",25,0)
 . I $D(PSOX("IRXN")) I '$D(PSORXED("ICD")) I $D(^PSRX(PSOX("IRXN"),"ICD")) F I=1:1:8 Q:'$D(^PSRX(PSOX("IRXN"),"ICD",I,0))  D
"RTN","PSODIAG",26,0)
 .. S OLD(I)=$$GET1^DIQ(52.052311,I_","_PSOX("IRXN")_",",".01")
"RTN","PSODIAG",27,0)
 .. S OLDI(I)=$$GET1^DIQ(52.052311,I_","_PSOX("IRXN")_",",".01","I")
"RTN","PSODIAG",28,0)
 . I ($D(@RAR@("ICD"))&('$D(OLD)))!($G(PSOCOPY)) D
"RTN","PSODIAG",29,0)
 .. F I=1:1:8 Q:'$D(@RAR@("ICD",I))  S OLDI(I)=@RAR@("ICD",I) D
"RTN","PSODIAG",30,0)
 ... S OLD(I)=$P(^ICD9(OLDI(I),0),"^",1)
"RTN","PSODIAG",31,0)
 ... S J=I-1 I I=1 W OLD(I) Q
"RTN","PSODIAG",32,0)
 . F I=1:1:8 Q:'$D(OLD(I))  D WRITE
"RTN","PSODIAG",33,0)
 E  I CPRS D
"RTN","PSODIAG",34,0)
 . I '$G(PSONEW("ICD")) F I=1:1:8 Q:'$D(^PS(52.41,ORD,"ICD",I,0))  D
"RTN","PSODIAG",35,0)
 .. S OLD(I)=$$GET1^DIQ(52.41311,I_","_ORD_",",".01")
"RTN","PSODIAG",36,0)
 .. S OLDI(I)=$$GET1^DIQ(52.41311,I_","_ORD_",",".01","I")
"RTN","PSODIAG",37,0)
 . I $D(PSONEW("ICD")) K OLD,OLDI D
"RTN","PSODIAG",38,0)
 .. F I=1:1:8 Q:'$D(PSONEW("ICD",I))  S OLDI(I)=PSONEW("ICD",I) D
"RTN","PSODIAG",39,0)
 ... S OLD(I)=$P(^ICD9(OLDI(I),0),"^",1)
"RTN","PSODIAG",40,0)
 . F I=1:1:8 Q:'$D(OLD(I))  D WRITE
"RTN","PSODIAG",41,0)
 M SOLDI=OLDI
"RTN","PSODIAG",42,0)
 ;
"RTN","PSODIAG",43,0)
EN2 ;ask for ICD's or display previously entered ones for editing
"RTN","PSODIAG",44,0)
 ;note: because ICD's are not longer required, could not use standard
"RTN","PSODIAG",45,0)
 ;       FileMan calls everywhere because of need to control deleted
"RTN","PSODIAG",46,0)
 ;       entries and cross-references.
"RTN","PSODIAG",47,0)
 W !
"RTN","PSODIAG",48,0)
 F I=1:1:8 D  Q:+$G(Y)=-1!(@RAR@("DFLG")) 
"RTN","PSODIAG",49,0)
 . I '$G(PSORXED)&('$G(CPRS)) S RAR="PSONEW"
"RTN","PSODIAG",50,0)
 .K DIC S DIC("A")=$S(I=1:"Select Primary ICD-9 Code: ",1:"Select Secondary ICD-9 Code: ")
"RTN","PSODIAG",51,0)
 . I $D(OLD(I)),(OLD(I)'="") S DIC("B")=OLD(I)
"RTN","PSODIAG",52,0)
 . S X="" W !,DIC("A") D  R X:60   ;did this so that I have control of the deletes
"RTN","PSODIAG",53,0)
 .. I $D(OLD(I)),(OLD(I)'="") W OLD(I)_"// "
"RTN","PSODIAG",54,0)
 . I $D(OLD(I)) S:X="" X=OLD(I)
"RTN","PSODIAG",55,0)
 . I X="" S Y=-1 Q
"RTN","PSODIAG",56,0)
 . I X["?" W !,"Enter a valid ICD-9 diagnosis code." S I=1-1 Q
"RTN","PSODIAG",57,0)
 . I X="@" D DELETE Q
"RTN","PSODIAG",58,0)
 . I X="^" S Y=-1 Q
"RTN","PSODIAG",59,0)
 . K DIC S DIC=80,DIC(0)="EMZQ"
"RTN","PSODIAG",60,0)
 . ;S DIC("S")="I $P($$ICDDX^ICDCODE(Y,FILDAT),U,10)&($P($$ICDDX^ICDCODE(Y,FILDAT),U,17)>$P($$ICDDX^ICDCODE(Y,FILDAT),U,12))"
"RTN","PSODIAG",61,0)
 . S DIC("S")="I $$STATCHK^PSODIAG(Y,FILDAT)"
"RTN","PSODIAG",62,0)
 . K DTOUT,DUOUT D ^DIC K DIC
"RTN","PSODIAG",63,0)
 . I X="^" S I=I-1,Y="" Q
"RTN","PSODIAG",64,0)
 . I $G(DUOUT)!($G(DTOUT)) S Y=-1,X="^" Q
"RTN","PSODIAG",65,0)
 . I +Y=-1&(X'=""!(X'="^")) I $D(^ICD9("BA",X)) S I=I-1,(X,Y)="" Q  ;user said No to are you sure ?.
"RTN","PSODIAG",66,0)
 . I Y=-1&(X?1A.A) S I=I-1,Y="" Q  ;user said not to Yes? question.
"RTN","PSODIAG",67,0)
 . I Y'=-1 D  I STATCHK2=1 S I=I-1,Y="" Q
"RTN","PSODIAG",68,0)
 .. S (STATCHK,STATCHK2)="",STATCHK=$$STATCHK^ICDAPIU($P(Y,U,2),FILDAT) D
"RTN","PSODIAG",69,0)
 ... I $P(STATCHK,"^",2)=-1 W !!,"Invalid ICD-9 diagnosis code.  Please choose another.",! S STATCHK2=1 Q
"RTN","PSODIAG",70,0)
 ... I +STATCHK=0 W !!,"Inactivated ICD-9 Diagnosis Code.  Please choose another.",! S STATCHK2=1 Q
"RTN","PSODIAG",71,0)
 . I +Y=-1 S I=I-1,Y="" W !!,"Invalid or inactivated ICD-9 diagnosis code.  Please choose another.",! Q
"RTN","PSODIAG",72,0)
 . S (POP,J)=0 F J=1:1:I D
"RTN","PSODIAG",73,0)
 ..I $G(DX(J))=+Y W $C(7),!," Duplicate entry.  Please select a different ICD-9 diagnosis code.",! S I=I-1,(Y,X)="",POP=1
"RTN","PSODIAG",74,0)
 . Q:POP
"RTN","PSODIAG",75,0)
 . S NEW("ICD",I)=$P(Y,U,1),DX(I)=+Y
"RTN","PSODIAG",76,0)
 ;
"RTN","PSODIAG",77,0)
 ;resequence entered ICD's and removed deleted ones from file
"RTN","PSODIAG",78,0)
 ;I X="^"&(RAR="PSONEW")&('CPRS) S @RAR@("DFLG")=0 K DUOUT,DTOUT,Y,X Q
"RTN","PSODIAG",79,0)
 ;
"RTN","PSODIAG",80,0)
 I '$D(NEW("ICD")) I $D(OLDI) M NEW("ICD")=OLDI ;if user ^ out on first icd
"RTN","PSODIAG",81,0)
 K PSOICDD I '$D(NEW("ICD"))&($G(PSOCOPY)) S PSOICDD=1
"RTN","PSODIAG",82,0)
 ;
"RTN","PSODIAG",83,0)
 S J=0 F I=1:1:8 Q:'$D(NEW("ICD",I))  I NEW("ICD",I)'="" S J=J+1,@RAR@("ICD",J)=NEW("ICD",I)
"RTN","PSODIAG",84,0)
 S TNEW=I
"RTN","PSODIAG",85,0)
 I X="^" D  ;if up arrow out, set all icd's past ^ point into array
"RTN","PSODIAG",86,0)
 . ;S Y=TNEW-1 F  S Y=$O(OLDI(Y)) Q:Y=""  S J=J+1,@RAR@("ICD",J)=OLDI(Y)
"RTN","PSODIAG",87,0)
 . K @RAR@("ICD") S Y="" F  S Y=$O(SOLDI(Y)) Q:Y=""  S @RAR@("ICD",Y)=SOLDI(Y)
"RTN","PSODIAG",88,0)
 . K PSORXED("FLD",39.3)  ;7/12/04
"RTN","PSODIAG",89,0)
 I $G(CPRS) K PSORX("ICD") M PSORXED("ICD")=@RAR@("ICD"),PSORX("ICD")=@RAR@("ICD")
"RTN","PSODIAG",90,0)
 I '$D(@RAR@("ICD"))&(CPRS) S PSONEW("IDFLG")=1 ;user deleted all in finish/complete order
"RTN","PSODIAG",91,0)
 Q:(RAR="PSONEW")
"RTN","PSODIAG",92,0)
 I '$D(@RAR@("ICD"))&('CPRS)&($D(^PSRX(PSOX("IRXN"),"ICD",1,0))) S PSORXED("IDFLG")=1  ;user deleted all
"RTN","PSODIAG",93,0)
 Q
"RTN","PSODIAG",94,0)
 ;
"RTN","PSODIAG",95,0)
 ;called from above to write previously entered ICD's to screen.
"RTN","PSODIAG",96,0)
WRITE S J=I-1 I I=1 W !,?10,"Primary: ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4) Q
"RTN","PSODIAG",97,0)
WRITE2 I I=2 W !,?3,"Secondaries #"_J_": ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4) Q
"RTN","PSODIAG",98,0)
 I I>2 W !,?15,"#"_J_": ",OLD(I),?30,$P($$ICDDX^ICDCODE(OLD(I),FILDAT),U,4)
"RTN","PSODIAG",99,0)
 Q
"RTN","PSODIAG",100,0)
STATCHK(ICDIEN,FILDAT) ;called from above to check active/inactive date during FileMan call.
"RTN","PSODIAG",101,0)
 N X S X=""
"RTN","PSODIAG",102,0)
 S ICDIEN=$P(^ICD9(ICDIEN,0),"^",1) S X=$$STATCHK^ICDAPIU(ICDIEN,FILDAT)
"RTN","PSODIAG",103,0)
 Q +X
"RTN","PSODIAG",104,0)
DELETE ;called from above to verify delete with user and to delete said entries
"RTN","PSODIAG",105,0)
 W !,"SURE YOU WANT TO DELETE? " S X="" R X:30 S X=$TR(X,"yn","YN")
"RTN","PSODIAG",106,0)
 I X'="Y"&(X'="N") W !,"Enter Y or N" G DELETE
"RTN","PSODIAG",107,0)
 I X="N" S I=I-1 Q
"RTN","PSODIAG",108,0)
 F J=I:1:8 Q:'$D(OLDI(J))  D
"RTN","PSODIAG",109,0)
 . I $D(OLDI(J+1)) S OLDI(J)=OLDI(J+1),OLD(J)=OLD(J+1) D
"RTN","PSODIAG",110,0)
 .. I CPRS&($D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=PSONEW("ICD",J+1)
"RTN","PSODIAG",111,0)
 .. E  I CPRS&('$D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=OLDI(J+1)
"RTN","PSODIAG",112,0)
 .. I $G(PSOCOPY) D
"RTN","PSODIAG",113,0)
 ... I ($D(PSONEW("ICD",J+1))) S PSONEW("ICD",J)=PSONEW("ICD",J+1)
"RTN","PSODIAG",114,0)
 ... I ($D(PSORXED("ICD",J+1))) S PSORXED("ICD",J)=PSORXED("ICD",J+1)
"RTN","PSODIAG",115,0)
 . E  K OLD(J),OLDI(J),PSONEW("ICD",J),PSORXED("ICD",J)
"RTN","PSODIAG",116,0)
 . ;I CPRS!($G(PSOCOPY)) K PSONEW("ICD",J),PSORXED("ICD",J)
"RTN","PSODIAG",117,0)
 S I=I-1,(X,Y)=""
"RTN","PSODIAG",118,0)
 Q
"RTN","PSODIAG",119,0)
 ;
"RTN","PSODIAG",120,0)
ICD ;called from PSON52 cause PSON52'S too large.  Stores ICD info for new Rx's (CPRS and backdoor) using variables from copy function and new order functions.
"RTN","PSODIAG",121,0)
 N D,DDATA,ICD
"RTN","PSODIAG",122,0)
 I $G(PSOCOPY)&('$D(PSOX("ICD")))&('$G(PSOICDD)) D
"RTN","PSODIAG",123,0)
 . S D=0 F D=1:1 Q:'$D(PSOX("ICD",D))
"RTN","PSODIAG",124,0)
 . F D=D:1:8 K ^PSRX(PSOX("IRXN"),"ICD",D,0)  ;remove any icd's del
"RTN","PSODIAG",125,0)
 . I $D(^PSRX(PSOX("OIRXN"),"ICD",0)) F D=1:1:8 Q:'$D(^PSRX(PSOX("OIRXN"),"ICD",D,0))  S PSOX("ICD",D)=$P(^PSRX(PSOX("OIRXN"),"ICD",D,0),U,1)
"RTN","PSODIAG",126,0)
 I $G(ORD) I $D(^PS(52.41,ORD,0))&($D(PSORX("ICD"))) M PSOX("ICD")=PSONEW("ICD")
"RTN","PSODIAG",127,0)
 I $D(PSOX("ICD")) F D=1:1:8 Q:'$D(PSOX("ICD",D))  S ICD=$G(PSOX("ICD",D)) D
"RTN","PSODIAG",128,0)
 . S DDATA="",DDATA=ICD_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$S(PSOSCP>49:$G(PSOANSQ("SC>50")),PSOSCP<50:$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSODIAG",129,0)
 . I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 I PSOSCP<50&($D(PSOANSQ("SC>50"))) S $P(DDATA,"^",4)=PSOANSQ("SC>50")  ;for times when sc has no % defined.
"RTN","PSODIAG",130,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",D,0)=DDATA
"RTN","PSODIAG",131,0)
 E  S D=1 D  S D=2
"RTN","PSODIAG",132,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",D,0)="^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$S(PSOSCP>49:$G(PSOANSQ("SC>50")),PSOSCP<50:$G(PSOANSQ("SC")),1:"")_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSODIAG",133,0)
 . I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 I PSOSCP<50&($D(PSOANSQ("SC>50"))) S $P(^PSRX(PSOX("IRXN"),"ICD",D,0),"^",4)=PSOANSQ("SC>50")
"RTN","PSODIAG",134,0)
 S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^"_(D-1)_"^"_(D-1)
"RTN","PSODIAG",135,0)
 K PSOX("ICD"),PSORXED("ICD"),PSONEW("ICD"),PSORX("ICD")
"RTN","PSODIAG",136,0)
 Q
"RTN","PSODIAG",137,0)
 ;
"RTN","PSODIAG",138,0)
UPDATE ;was in PSOORED6; now called from PSOORED6; removes deletes for edits and stores data.
"RTN","PSODIAG",139,0)
 ;
"RTN","PSODIAG",140,0)
 N TNEW S TNEW=""
"RTN","PSODIAG",141,0)
 ;I $D(PSORXED("FLD",39.3)) D
"RTN","PSODIAG",142,0)
 I '$D(PSORXED("ICD"))&($G(PSORXED("IDFLG"))) D  K PSORXED("IDFLG") Q
"RTN","PSODIAG",143,0)
 . I $D(^PSRX(PSORXED("IRXN"),"ICD",1,0)) D
"RTN","PSODIAG",144,0)
 .. S TNEW=2 K ^PSRX(PSORXED("IRXN"),"ICD","B") S $P(^PSRX(PSORXED("IRXN"),"ICD",1,0),U,1)=""
"RTN","PSODIAG",145,0)
 .. F I=TNEW:1:8 Q:'$D(^PSRX(PSORXED("IRXN"),"ICD",I,0))  S DIK="^PSRX("_PSORXED("IRXN")_","_$C(34)_"ICD"_$C(34)_",",DA=I,DA(1)=PSORXED("IRXN") D ^DIK K DA,DIK
"RTN","PSODIAG",146,0)
 N I,XX,SCEI,J
"RTN","PSODIAG",147,0)
 S SCEI="^^^^^^^"
"RTN","PSODIAG",148,0)
 F I=1:1:8 Q:'$D(^PSRX(DA,"ICD",I,0))  S SCEI(I)=^PSRX(DA,"ICD",I,0),SCEI=SCEI(I)
"RTN","PSODIAG",149,0)
 K ^PSRX(DA,"ICD"),^PSRX(DA,"ICD","B")
"RTN","PSODIAG",150,0)
 F I=1:1:8 Q:'$D(PSORXED("ICD",I))
"RTN","PSODIAG",151,0)
 F I=I:1:8 K SCEI(I)  ;remove all icd's past last sequence entered by user
"RTN","PSODIAG",152,0)
 F I=1:1:8 Q:'$D(PSORXED("ICD",I))  S:'$D(SCEI(I)) SCEI(I)=SCEI S $P(SCEI(I),U,1)=PSORXED("ICD",I)
"RTN","PSODIAG",153,0)
 S ^PSRX(DA,"ICD",0)="^52.052311P^"_(I-1)_U_(I-1)
"RTN","PSODIAG",154,0)
 F I=1:1:8 D
"RTN","PSODIAG",155,0)
 . I '$D(SCEI(I)) D  Q
"RTN","PSODIAG",156,0)
 .. I $D(^PSRX(DA,"ICD",I,0)) K ^PSRX(DA,"ICD",I,0) Q
"RTN","PSODIAG",157,0)
 . E  S ^PSRX(DA,"ICD",I,0)=SCEI(I) S:$P(SCEI(I),U,1)'="" ^PSRX(DA,"ICD","B",$P(SCEI(I),U,1),I)=""
"RTN","PSODIAG",158,0)
 K PSORXED("FLD",39.3)
"RTN","PSODIAG",159,0)
 Q
"RTN","PSOHLINC")
0^45^B13372670
"RTN","PSOHLINC",1,0)
PSOHLINC ;BIR/RTR - Process incoming order messages from CHCS ;06/17/02
"RTN","PSOHLINC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**111,143**;DEC 1997
"RTN","PSOHLINC",3,0)
 ;
"RTN","PSOHLINC",4,0)
EN ;Process incoming outpatient order messages
"RTN","PSOHLINC",5,0)
 N PSOXLONG,PSOHDFOR,PSOHLTAG,PSOHBDS,PSOHMSG,PSOHLMIS,PSOHLRS,PSOHEID,PSOHEIDS,PSOHFSP,PSOHLNOP,PSOXHI,PSOHLZ,PSOHLZC,PSOHLRXO,PSOXMH,PSOHY,PSOEXMS,PSOEXXQ,PSOHG,PSOBH,X,Y
"RTN","PSOHLINC",6,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLINC",7,0)
 S (PSOXLONG,PSOHLRXO,PSOHLNOP,PSOHDFOR)=0
"RTN","PSOHLINC",8,0)
 S PSOHFSP=$E(HL("ECH"),1)
"RTN","PSOHLINC",9,0)
 K PSOHLMIS
"RTN","PSOHLINC",10,0)
 F PSOXHI=1:1 K PSOHB X HLNEXT Q:HLQUIT'>0!(PSOHLNOP)!(PSOHDFOR)!(PSOXLONG)  S PSOHB=HLNODE,PSOXMH=$E(PSOHB,1,3) D
"RTN","PSOHLINC",11,0)
 .S PSOHG=0 F  S PSOHG=$O(HLNODE(PSOHG)) Q:'PSOHG!(PSOHLNOP)!(PSOHDFOR)!(PSOXLONG)  S PSOHB(PSOHG)=HLNODE(PSOHG)
"RTN","PSOHLINC",12,0)
 .I (PSOXMH'?3U),(PSOXMH'?2U1N) S PSOHDFOR=1 Q
"RTN","PSOHLINC",13,0)
 .I $T(@PSOXMH)]"" D @PSOXMH
"RTN","PSOHLINC",14,0)
 ;Quit if not a Pharmacy message, no acknowledgements
"RTN","PSOHLINC",15,0)
 I $G(PSOHLNOP) Q
"RTN","PSOHLINC",16,0)
 I $G(PSOHY("OCC"))="CA" D ENDC^PSOHLDC Q
"RTN","PSOHLINC",17,0)
 I PSOXLONG S PSOEXMS="Invalid NTE segment, greater than 245 characters." D NAK^PSOHLEXC Q
"RTN","PSOHLINC",18,0)
 S (PSOHBDS,PSOEXXQ)=0
"RTN","PSOHLINC",19,0)
 I PSOHDFOR S PSOEXMS="Invalid message structure." D NAK^PSOHLEXC Q
"RTN","PSOHLINC",20,0)
 F PSOHMSG="MSH","PID","PV1","ORC","RXO" Q:PSOEXXQ  I '$D(PSOHLMIS(PSOHMSG)) S PSOEXMS="Missing "_PSOHMSG_" segment." S PSOHBDS=1 D NAK^PSOHLEXC
"RTN","PSOHLINC",21,0)
 ;Quit if segment is missing
"RTN","PSOHLINC",22,0)
 I $G(PSOEXXQ) Q
"RTN","PSOHLINC",23,0)
 ;Quit if not a Pharmacy message, no acknowledgements
"RTN","PSOHLINC",24,0)
 ;I $G(PSOHLNOP) Q
"RTN","PSOHLINC",25,0)
 ;check for data exceptions
"RTN","PSOHLINC",26,0)
 D CHECK^PSOHLEXC
"RTN","PSOHLINC",27,0)
 ;PSOEXXQ set if a NAK was sent back
"RTN","PSOHLINC",28,0)
 I $G(PSOEXXQ) Q
"RTN","PSOHLINC",29,0)
 ;Enter order into Pending Outpatient Orders file
"RTN","PSOHLINC",30,0)
 D ADD^PSOHCPRS
"RTN","PSOHLINC",31,0)
 ;Send successful acknowledgement if PSOEXXQ not set
"RTN","PSOHLINC",32,0)
 I '$G(PSOEXXQ) D ACK^PSOHLEXC
"RTN","PSOHLINC",33,0)
 Q
"RTN","PSOHLINC",34,0)
 ;What about regular acknowledgements?  handled by HL7 package somehow
"RTN","PSOHLINC",35,0)
 Q
"RTN","PSOHLINC",36,0)
MSH ;Process MSH segment
"RTN","PSOHLINC",37,0)
 I $P(PSOHB,HL("FS"),5)'="PSO RECEIVE" S PSOHLNOP=1
"RTN","PSOHLINC",38,0)
 S PSOHLMIS("MSH")=""
"RTN","PSOHLINC",39,0)
 Q
"RTN","PSOHLINC",40,0)
PID ;Process PID segment
"RTN","PSOHLINC",41,0)
 D FORM
"RTN","PSOHLINC",42,0)
 S PSOHY("PAT")=+$P(PSOHB,HL("FS"),3)
"RTN","PSOHLINC",43,0)
 S PSOHLMIS("PID")=""
"RTN","PSOHLINC",44,0)
 Q
"RTN","PSOHLINC",45,0)
PV1 ;Process PV1 segment
"RTN","PSOHLINC",46,0)
 D FORM
"RTN","PSOHLINC",47,0)
 S PSOHY("LOC")=+$P(PSOHB,HL("FS"),3)
"RTN","PSOHLINC",48,0)
 S PSOHLMIS("PV1")=""
"RTN","PSOHLINC",49,0)
 Q
"RTN","PSOHLINC",50,0)
DG1 ;Process DG1 segment ; future use
"RTN","PSOHLINC",51,0)
 D FORM
"RTN","PSOHLINC",52,0)
 S $P(PSOHY("ICD"),U,$P(PSOHB,HL("FS"),1))=$P(PSOHB,HL("FS"),3)
"RTN","PSOHLINC",53,0)
ZCL Q  ;future use
"RTN","PSOHLINC",54,0)
 ;
"RTN","PSOHLINC",55,0)
ORC ;Process ORC segment
"RTN","PSOHLINC",56,0)
 S PSOHLRXO=1 ;For future use in processing NTE's, if other segments get NTE(6) or (7)
"RTN","PSOHLINC",57,0)
 D FORM
"RTN","PSOHLINC",58,0)
 I $O(PSOHB(""))'="" D ORC^PSOHLINL Q
"RTN","PSOHLINC",59,0)
 S PSOHY("OCC")=$P(PSOHB,HL("FS"))
"RTN","PSOHLINC",60,0)
 ;Set priority to Routine
"RTN","PSOHLINC",61,0)
 S PSOHY("PRIOR")="R"
"RTN","PSOHLINC",62,0)
 S PSOHY("CHNUM")=$P($P(PSOHB,HL("FS"),2),PSOHFSP)
"RTN","PSOHLINC",63,0)
 D NOW^%DTC S PSOHY("EDT")=%
"RTN","PSOHLINC",64,0)
 S X=$P(PSOHB,HL("FS"),9) D
"RTN","PSOHLINC",65,0)
 .I X S PSOHY("SDT")=$$HL7TFM^XLFDT(X) Q
"RTN","PSOHLINC",66,0)
 .S PSOHY("SDT")=$G(PSOHY("EDT"))
"RTN","PSOHLINC",67,0)
 S PSOHY("ENTER")=+$P(PSOHB,HL("FS"),10)
"RTN","PSOHLINC",68,0)
 S PSOHY("PROV")=+$P(PSOHB,HL("FS"),12)
"RTN","PSOHLINC",69,0)
 S PSOHLMIS("ORC")=""
"RTN","PSOHLINC",70,0)
 Q
"RTN","PSOHLINC",71,0)
RXO ;Process RXO segment
"RTN","PSOHLINC",72,0)
 D FORM
"RTN","PSOHLINC",73,0)
 I $O(PSOHB(""))'="" D RXO^PSOHLINL Q
"RTN","PSOHLINC",74,0)
 S PSOHY("DRUG")=+$P(PSOHB,HL("FS"),10)
"RTN","PSOHLINC",75,0)
 S PSOHY("QTY")=$P(PSOHB,HL("FS"),11)
"RTN","PSOHLINC",76,0)
 S PSOHY("REF")=$P(PSOHB,HL("FS"),13)
"RTN","PSOHLINC",77,0)
 S PSOHLMIS("RXO")=""
"RTN","PSOHLINC",78,0)
 Q
"RTN","PSOHLINC",79,0)
RXR ;Process RXR segment
"RTN","PSOHLINC",80,0)
 D FORM
"RTN","PSOHLINC",81,0)
 Q
"RTN","PSOHLINC",82,0)
ZRX ;Process ZRX segment
"RTN","PSOHLINC",83,0)
 D FORM
"RTN","PSOHLINC",84,0)
 S PSOHY("PICK")=$S($P(PSOHB,HL("FS"),4)="M":"M",1:"W")
"RTN","PSOHLINC",85,0)
 Q
"RTN","PSOHLINC",86,0)
NTE ;
"RTN","PSOHLINC",87,0)
 D FORM
"RTN","PSOHLINC",88,0)
 I $P(PSOHB,HL("FS"))=6 D COMM Q
"RTN","PSOHLINC",89,0)
 I $P(PSOHB,HL("FS"))=7 D SIG Q
"RTN","PSOHLINC",90,0)
 Q
"RTN","PSOHLINC",91,0)
COMM ;Process Provider Comments
"RTN","PSOHLINC",92,0)
 I $O(PSOHB(""))'="" D COMM^PSOHLINL Q
"RTN","PSOHLINC",93,0)
 K ^UTILITY($J,"W")
"RTN","PSOHLINC",94,0)
 S X=$P(PSOHB,HL("FS"),3,999)
"RTN","PSOHLINC",95,0)
 I $L(X)>245 S PSOXLONG=1 Q
"RTN","PSOHLINC",96,0)
 S DIWL=1,DIWR=70,DIWF="" D ^DIWP
"RTN","PSOHLINC",97,0)
 D ENCOMM^PSOHLINL
"RTN","PSOHLINC",98,0)
 K ^UTILITY($J,"W")
"RTN","PSOHLINC",99,0)
 Q
"RTN","PSOHLINC",100,0)
SIG ;Process SIG
"RTN","PSOHLINC",101,0)
 I $O(PSOHB(""))'="" D SIG^PSOHLINL Q
"RTN","PSOHLINC",102,0)
 K ^UTILITY($J,"W")
"RTN","PSOHLINC",103,0)
 S X=$P(PSOHB,HL("FS"),3,999)
"RTN","PSOHLINC",104,0)
 I $L(X)>245 S PSOXLONG=1 Q
"RTN","PSOHLINC",105,0)
 S DIWL=1,DIWR=70,DIWF="" D ^DIWP
"RTN","PSOHLINC",106,0)
 D ENSIG^PSOHLINL
"RTN","PSOHLINC",107,0)
 K ^UTILITY($J,"W")
"RTN","PSOHLINC",108,0)
 Q
"RTN","PSOHLINC",109,0)
FORM ;
"RTN","PSOHLINC",110,0)
 S PSOHB=$E(PSOHB,(4+$L(HL("FS"))),$L(PSOHB))
"RTN","PSOHLINC",111,0)
 Q
"RTN","PSOHLINC",112,0)
 ;AND IF YOU ADD PSOHLNEW TO THE PATCH, FIX THE HEADER OF THE 3 NODE TO MATCH HOW YOU DID IT IN PSOHCPRS. SINCE IT IS A WORD PROCESSING FIELD
"RTN","PSOHLINC",113,0)
 ; And maybe fix -1 problem if no related institution is found
"RTN","PSOHLINC",114,0)
 ; AND IF YOU PATCH PSOHLSN1, AT THE rxr POINT, INITIALIZE RTENAME AT THE BEGINNING OF EACH LOOP
"RTN","PSOHLNE1")
0^7^B71499142
"RTN","PSOHLNE1",1,0)
PSOHLNE1 ;BIR/RTR-Parsing out segments from OERR ;01/20/95
"RTN","PSOHLNE1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,9,46,71,98,111,117,131,157,181,143**;DEC 1997
"RTN","PSOHLNE1",3,0)
 ;External reference to EN^ORERR supported by DBIA 2187
"RTN","PSOHLNE1",4,0)
 ;External reference to PS(50.607 supported by DBIA 2221
"RTN","PSOHLNE1",5,0)
 ;External reference to OR(100 supported by DBIA 2219
"RTN","PSOHLNE1",6,0)
 ;External reference to PSDRUG( supported by DBIA 221
"RTN","PSOHLNE1",7,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSOHLNE1",8,0)
 ;
"RTN","PSOHLNE1",9,0)
EN ;ORC segment
"RTN","PSOHLNE1",10,0)
 N Q1,Q2,Q3,Q4,Q5,Q6,Q7,PSOPOSSD
"RTN","PSOHLNE1",11,0)
 K PSOLQ1I,PSOLQ1II,PSOLQ1IX
"RTN","PSOHLNE1",12,0)
 I '$O(MSG(ZZ,0)) D
"RTN","PSOHLNE1",13,0)
 .S PSOOC="NW",PLACER=+$P(PSOSEG,"|",2),PLACERXX=+$P($P(PSOSEG,"|",2),";",2),ENTERED=$P(PSOSEG,"|",10),PROV=$P(PSOSEG,"|",12)
"RTN","PSOHLNE1",14,0)
 .S X=$P(PSOSEG,"|",15) S EFFECT=$$HL7TFM^XLFDT(X) K X
"RTN","PSOHLNE1",15,0)
 .D NOW^%DTC S PSOLOG=% K %
"RTN","PSOHLNE1",16,0)
 .;S RSN=$P(PSOSEG,"|",16)
"RTN","PSOHLNE1",17,0)
 .S ORCSEG=$P(PSOSEG,"|",7),QCOUNT=1 Q:$G(ORCSEG)'["~"
"RTN","PSOHLNE1",18,0)
 .F JJ=1:1:$L(ORCSEG) S:$E(ORCSEG,JJ)="~" QCOUNT=QCOUNT+1
"RTN","PSOHLNE1",19,0)
 I '$O(MSG(ZZ,0)) D  Q
"RTN","PSOHLNE1",20,0)
 .F JJJ=1:1:QCOUNT S QQQ=$P(ORCSEG,"~",JJJ) D:QQQ'=""
"RTN","PSOHLNE1",21,0)
 ..S PSOPOSSD=$S($P($P(QQQ,"^"),"&"):1,1:0) ;PSOPOSSD=1 if possible dose
"RTN","PSOHLNE1",22,0)
 ..S Q1I(JJJ)=$S(PSOPOSSD:$P(QQQ,"^"),1:$P(QQQ,"^",8)),PSOLQ1IX(JJJ)=$P($P(QQQ,"^"),"&",5) S PSOLQ1I(JJJ)=$P(QQQ,"^",8),PSOLQ1II(JJJ)=PSOPOSSD ;ORC piece 1 if Possible Dosage, ORC piece 8 if Local Possible Dosage
"RTN","PSOHLNE1",23,0)
 ..S Q1(JJJ)=$P(QQQ,"^",2) ;schedule
"RTN","PSOHLNE1",24,0)
 ..S Q2(JJJ)=$P(QQQ,"^",3) ;duration
"RTN","PSOHLNE1",25,0)
 ..S Q3(JJJ)=$P(QQQ,"^",4) I Q3(JJJ) S X=Q3(JJJ) S Q3(JJJ)=$$HL7TFM^XLFDT(X) K X ;start date
"RTN","PSOHLNE1",26,0)
 ..S Q4(JJJ)=$P(QQQ,"^",5) ;end date
"RTN","PSOHLNE1",27,0)
 ..S:$G(PRIOR)="" PRIOR=$P(QQQ,"^",6)
"RTN","PSOHLNE1",28,0)
 ..S Q6(JJJ)=$P(QQQ,"^",9) ;conjunction
"RTN","PSOHLNE1",29,0)
 ..S Q7(JJJ)=$P(QQQ,"^",10) ;sequencing
"RTN","PSOHLNE1",30,0)
 ..S QTARRAY(JJJ)=Q1(JJJ)_"^"_Q2(JJJ)_"^"_Q3(JJJ)_"^"_Q4(JJJ)_"^^"_Q6(JJJ)_"^"_Q7(JJJ)
"RTN","PSOHLNE1",31,0)
 ..S QTARRAY2(JJJ)=$S(PSOPOSSD:$P(Q1I(JJJ),"&"),1:Q1I(JJJ))_"^"_$S(PSOPOSSD:$P(Q1I(JJJ),"&",3),1:"")
"RTN","PSOHLNE1",32,0)
 ..I PSOPOSSD S $P(QTARRAY(JJJ),"^",5)=$P(Q1I(JJJ),"&",4)
"RTN","PSOHLNE1",33,0)
 ..I PSOPOSSD S PSOUNN=$P(Q1I(JJJ),"&",2) I PSOUNN'="" S PSOUNN=$O(^PS(50.607,"B",PSOUNN,0)) S $P(QTARRAY(JJJ),"^",9)=$G(PSOUNN)
"RTN","PSOHLNE1",34,0)
 ..K PSOUNN
"RTN","PSOHLNE1",35,0)
 ;For multiple ORC subscripts
"RTN","PSOHLNE1",36,0)
 S (POVAR,POVAR1)="",(NNCK,NNN,NNNN)=0,PSOIII=1,MSG(ZZ,0)=$E(MSG(ZZ),5,$L(MSG(ZZ)))
"RTN","PSOHLNE1",37,0)
 S AAA="" F  S AAA=$O(MSG(ZZ,AAA)) Q:AAA=""  S NNN=0 F OOO=1:1:$L(MSG(ZZ,AAA)) S NNN=NNN+1 D  D:$G(POVAR1)="~"&(NNNN=6) PARSE D:$G(POVAR1)="|" PARSE
"RTN","PSOHLNE1",38,0)
 .I $E(MSG(ZZ,AAA),OOO)="|" S NNNN=NNNN+1
"RTN","PSOHLNE1",39,0)
 .S POVAR1=$E(MSG(ZZ,AAA),OOO)
"RTN","PSOHLNE1",40,0)
 .S POLIM=POVAR
"RTN","PSOHLNE1",41,0)
 .S POVAR=$S(POVAR="":POVAR1,1:POVAR_POVAR1)
"RTN","PSOHLNE1",42,0)
 .;I NNNN=6 I $G(POVAR1)="~"!($G(POVAR1)="|")
"RTN","PSOHLNE1",43,0)
END ;16 OF ORC?
"RTN","PSOHLNE1",44,0)
 ;I $G(POVAR)'="" I NNNN=14!(NNNN=15) S EFFECT=$G(POVAR)
"RTN","PSOHLNE1",45,0)
 S QCOUNT=0 F JJJ=0:0 S JJJ=$O(QTVAR(JJJ)) Q:'JJJ  I $L($G(QTVAR(JJJ))) S QCOUNT=QCOUNT+1 D
"RTN","PSOHLNE1",46,0)
 .S PSOPOSSD=$S($P($P(QTVAR(JJJ),"^"),"&"):1,1:0) ;PSOPOSSD =1 if possible dose
"RTN","PSOHLNE1",47,0)
 .S Q1I(JJJ)=$S(PSOPOSSD:$P(QTVAR(JJJ),"^"),1:$P(QTVAR(JJJ),"^",8)),PSOLQ1IX(JJJ)=$P($P(QTVAR(JJJ),"^"),"&",5) S PSOLQ1I(JJJ)=$P(QTVAR(JJJ),"^",8),PSOLQ1II(JJJ)=PSOPOSSD ;piece 1 if possible dose, piece 8 if not
"RTN","PSOHLNE1",48,0)
 .S Q1(JJJ)=$P(QTVAR(JJJ),"^",2)
"RTN","PSOHLNE1",49,0)
 .S Q2(JJJ)=$P(QTVAR(JJJ),"^",3)
"RTN","PSOHLNE1",50,0)
 .;S Q2(JJJ)=$S($E($P(QTVAR(JJJ),"^",3)):"D"_$P(QTVAR(JJJ),"^",3),$E($P(QTVAR(JJJ),"^",3))=0:"D"_$P(QTVAR(JJJ),"^",3),1:$P(QTVAR(JJJ),"^",3))
"RTN","PSOHLNE1",51,0)
 .S Q3(JJJ)=$P(QTVAR(JJJ),"^",4) I Q3(JJJ) S X=Q3(JJJ) S Q3(JJJ)=$$HL7TFM^XLFDT(X) K X
"RTN","PSOHLNE1",52,0)
 .S Q4(JJJ)=$P(QTVAR(JJJ),"^",5)
"RTN","PSOHLNE1",53,0)
 .S:$G(PRIOR)="" PRIOR=$P(QTVAR(JJJ),"^",6)
"RTN","PSOHLNE1",54,0)
 .S Q6(JJJ)=$P(QTVAR(JJJ),"^",9)
"RTN","PSOHLNE1",55,0)
 .S Q7(JJJ)=$P(QTVAR(JJJ),"^",10)
"RTN","PSOHLNE1",56,0)
 .S QTARRAY(JJJ)=Q1(JJJ)_"^"_Q2(JJJ)_"^"_Q3(JJJ)_"^"_Q4(JJJ)_"^^"_Q6(JJJ)_"^"_Q7(JJJ)
"RTN","PSOHLNE1",57,0)
 .S QTARRAY2(JJJ)=$S(PSOPOSSD:$P(Q1I(JJJ),"&"),1:Q1I(JJJ))_"^"_$S(PSOPOSSD:$P(Q1I(JJJ),"&",3),1:"")
"RTN","PSOHLNE1",58,0)
 .I PSOPOSSD S $P(QTARRAY(JJJ),"^",5)=$P(Q1I(JJJ),"&",4)
"RTN","PSOHLNE1",59,0)
 .I PSOPOSSD S PSOUNN=$P(Q1I(JJJ),"&",2) I PSOUNN'="" S PSOUNN=$O(^PS(50.607,"B",PSOUNN,0)) S $P(QTARRAY(JJJ),"^",9)=$G(PSOUNN)
"RTN","PSOHLNE1",60,0)
 .K PSOUNN
"RTN","PSOHLNE1",61,0)
 I $G(EFFECT) S X=EFFECT S EFFECT=$$HL7TFM^XLFDT(X) K X
"RTN","PSOHLNE1",62,0)
 D NOW^%DTC S PSOLOG=% S:'$G(EFFECT) EFFECT=% K %
"RTN","PSOHLNE1",63,0)
 K MSG(ZZ,0)
"RTN","PSOHLNE1",64,0)
 Q
"RTN","PSOHLNE1",65,0)
PARSE I NNNN=1 S PSOOC="NW" G SET
"RTN","PSOHLNE1",66,0)
 I NNNN=2 S PLACER=+$G(POLIM),PLACERXX=+$P($G(POLIM),";",2) G SET
"RTN","PSOHLNE1",67,0)
 I NNNN=3!(NNNN=4)!(NNNN=5) G SET
"RTN","PSOHLNE1",68,0)
 I NNNN=6,$G(POVAR1)="~" S NNCK=NNCK+1,QTVAR(NNCK)=$G(POLIM) G SET
"RTN","PSOHLNE1",69,0)
 I NNNN=7 S NNCK=NNCK+1 S QTVAR(NNCK)=$G(POLIM) G SET
"RTN","PSOHLNE1",70,0)
 I NNNN=8!(NNNN=9) G SET
"RTN","PSOHLNE1",71,0)
 I NNNN=10 S ENTERED=$G(POLIM) G SET
"RTN","PSOHLNE1",72,0)
 I NNNN=11 G SET
"RTN","PSOHLNE1",73,0)
 I NNNN=12 S PROV=$G(POLIM) G SET
"RTN","PSOHLNE1",74,0)
 I NNNN=13!(NNNN=14) G SET
"RTN","PSOHLNE1",75,0)
 I NNNN=15 S EFFECT=$G(POLIM)
"RTN","PSOHLNE1",76,0)
SET S (POVAR,POLIM)="" Q
"RTN","PSOHLNE1",77,0)
 ;
"RTN","PSOHLNE1",78,0)
EXP ;
"RTN","PSOHLNE1",79,0)
 ;Q:'$G(OR("PLACE"))
"RTN","PSOHLNE1",80,0)
 Q:'$G(PSOFILNM)
"RTN","PSOHLNE1",81,0)
 S PSOMSORR=1
"RTN","PSOHLNE1",82,0)
 N PSOSSMES S PSOSSMES="CPRSUP"
"RTN","PSOHLNE1",83,0)
 I $G(PSOFILNM),$G(PSOFILNM)["S" S LL=+$G(PSOFILNM) I $D(^PS(52.41,LL,0)),$P($G(^(0)),"^",3)'="RF" G EXPEN
"RTN","PSOHLNE1",84,0)
 S LL=$G(PSOFILNM) I 'LL!('$D(^PSRX(+$G(LL),0))) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) D  G EXPQ
"RTN","PSOHLNE1",85,0)
 .F EER=0:0 S EER=$O(MSG(EER)) Q:'EER  S:$P(MSG(EER),"|")="PV1" PSERRPV1=MSG(EER) S:$P(MSG(EER),"|")="PID" PSERRPID=MSG(EER) S:$P(MSG(EER),"|")="ORC"&($G(PSERRORC)="") PSERRORC=MSG(EER)
"RTN","PSOHLNE1",86,0)
 .N MSG,PSOHINST D INIT^PSOHLSN S MSG(2)=$G(PSERRPID),MSG(3)=$G(PSERRPV1),MSG(4)="ORC|DE|"_$G(OR("PLACE"))_$S($G(PLACERXX):";"_PLACERXX,1:"")_"^OR"_"|"_$S($P($G(PSERRORC),"|",4)'="":$P(PSERRORC,"|",4),1:"") S:$G(COMM)'="" MSG(5)="NTE|16||"_COMM
"RTN","PSOHLNE1",87,0)
 .D SEND^PSOHLSN
"RTN","PSOHLNE1",88,0)
 Q:'$D(^PSRX(LL,0))
"RTN","PSOHLNE1",89,0)
 I +$P($G(^PSRX(LL,2)),"^",6)<DT D
"RTN","PSOHLNE1",90,0)
 .I +$P($G(^PSRX(LL,"STA")),"^")<12!($P($G(^("STA")),"^")=16) S $P(^PSRX(LL,"STA"),"^")=11 D ECAN^PSOUTL(LL)
"RTN","PSOHLNE1",91,0)
 S GG=+$P($G(^PSRX(LL,"STA")),"^")
"RTN","PSOHLNE1",92,0)
 ;S AA=$S(GG=3:"OH",GG=12:"OD",GG=13:"OC",GG=14:"OD",GG=15:"OD",GG=16:"OH",1:"SC"),AAA=$S(GG=0:"CM",GG=1:"IP",GG=4:"IP",GG=5:"ZS",GG=11:"ZE",1:"")
"RTN","PSOHLNE1",93,0)
 S AA="SC",AAA=$S(GG=0:"CM",GG=2:"CM",GG=1:"IP",GG=4:"IP",GG=5:"ZS",GG=3:"HD",GG=16:"HD",GG=11:"ZE",1:"DC")
"RTN","PSOHLNE1",94,0)
 D EN^PSOHLSN1(LL,AA,AAA,"")
"RTN","PSOHLNE1",95,0)
 K PSOSSMES
"RTN","PSOHLNE1",96,0)
EXPQ K LL,GG,AA,AAA,PSOMSORR Q
"RTN","PSOHLNE1",97,0)
EXPEN ;SS on Pending orders
"RTN","PSOHLNE1",98,0)
 S AA=$P($G(^PS(52.41,LL,0)),"^",3)
"RTN","PSOHLNE1",99,0)
 S AAA=$S(AA="DC"!(AA="DE"):"DC",AA="HD":"HD",1:"IP")
"RTN","PSOHLNE1",100,0)
 D EN^PSOHLSN(OR("PLACE"),"SC",AAA)
"RTN","PSOHLNE1",101,0)
 G EXPQ
"RTN","PSOHLNE1",102,0)
 ;
"RTN","PSOHLNE1",103,0)
OID ;Check for 1 to 1 match from Dispense Drug to Orderable Item
"RTN","PSOHLNE1",104,0)
 N PSOCDD,PSOCDDI,PSOCDDIZ
"RTN","PSOHLNE1",105,0)
 Q:'$G(PSORDITE)
"RTN","PSOHLNE1",106,0)
 K PSOCDDIZ
"RTN","PSOHLNE1",107,0)
 S (PSOCDD,PSOCDDI)=0
"RTN","PSOHLNE1",108,0)
 F  S PSOCDD=$O(^PSDRUG("ASP",PSORDITE,PSOCDD)) Q:'PSOCDD  I $S('$P($G(^PSDRUG(PSOCDD,"I")),"^"):1,DT'>$P($G(^("I")),"^"):1,1:0),$P($G(^PSDRUG(PSOCDD,2)),"^",3)["O" S PSOCDDI=PSOCDDI+1,PSOCDDIZ=PSOCDD
"RTN","PSOHLNE1",109,0)
 I PSOCDDI'=1 Q
"RTN","PSOHLNE1",110,0)
 S PSOQWX=$G(PSOCDDIZ)
"RTN","PSOHLNE1",111,0)
 Q
"RTN","PSOHLNE1",112,0)
CP ;ZSC segment (replaced by ZCL segment)
"RTN","PSOHLNE1",113,0)
 S SERV=$S($P(PSOSEG,"|")=1:"SC",$P(PSOSEG,"|")=0:"NSC",1:$P(PSOSEG,"|"))
"RTN","PSOHLNE1",114,0)
 S PSOIBY=$P(PSOSEG,"|",2)_"^"_$P(PSOSEG,"|",3)_"^"_$P(PSOSEG,"|",4)_"^"_$P(PSOSEG,"|",5)_"^"_$P(PSOSEG,"|",6)_"^"_$P(PSOSEG,"|",7)
"RTN","PSOHLNE1",115,0)
 Q
"RTN","PSOHLNE1",116,0)
 ;
"RTN","PSOHLNE1",117,0)
ZCL ;ZCL segment - SC/EI related to ICDs
"RTN","PSOHLNE1",118,0)
 N SEQ,SEQ2,SEQ3 S SEQ3=$P(PSOSEG,"|",2),SEQ2=$P(PSOSEG,"|",1)
"RTN","PSOHLNE1",119,0)
 S:'$D(PSOICD(SEQ2)) PSOICD(SEQ2)=""
"RTN","PSOHLNE1",120,0)
 S $P(PSOICD(SEQ2),"^",(SEQ3+1))=$P(PSOSEG,"|",3)
"RTN","PSOHLNE1",121,0)
 D ELIG^VADPT S PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSOHLNE1",122,0)
 S:'$D(PSOIBY) PSOIBY=""
"RTN","PSOHLNE1",123,0)
 I PSOSCP<50 D  ;set IBQ node variables if <50% SC
"RTN","PSOHLNE1",124,0)
 . Q:$P(PSOIBY,U,$S(SEQ3=1:2,SEQ3=2:3,SEQ3=4:4,SEQ3=5:1,SEQ3=6:5,SEQ3=7:6,1:""))>0
"RTN","PSOHLNE1",125,0)
 . S:SEQ3=1 $P(PSOIBY,U,2)=$P(PSOSEG,"|",3) ;AO
"RTN","PSOHLNE1",126,0)
 . S:SEQ3=2 $P(PSOIBY,U,3)=$P(PSOSEG,"|",3) ;IR
"RTN","PSOHLNE1",127,0)
 . S:SEQ3=3 SERV=$S($P(PSOSEG,"|",3)=1:"SC",$P(PSOSEG,"|",3)=0:"NSC",1:$P(PSOSEG,"|",3))           ;SC
"RTN","PSOHLNE1",128,0)
 . S:SEQ3=4 $P(PSOIBY,U,4)=$P(PSOSEG,"|",3) ;EC
"RTN","PSOHLNE1",129,0)
 . S:SEQ3=5 $P(PSOIBY,U,1)=$P(PSOSEG,"|",3) ;MST
"RTN","PSOHLNE1",130,0)
 . S:SEQ3=6 $P(PSOIBY,U,5)=$P(PSOSEG,"|",3) ;HNC
"RTN","PSOHLNE1",131,0)
 . S:SEQ3=7 $P(PSOIBY,U,6)=$P(PSOSEG,"|",3) ;CV
"RTN","PSOHLNE1",132,0)
 E  D
"RTN","PSOHLNE1",133,0)
 . S PSOIBY="^^^^^^",SERV=""
"RTN","PSOHLNE1",134,0)
 Q
"RTN","PSOHLNE1",135,0)
MISX ;Mismatch patient on CPRS New Order
"RTN","PSOHLNE1",136,0)
 S RCOMM="Patient mismatch on New Order from CPRS." D EN^ORERR(RCOMM,.MSG) S NWFLAG=1 D RERROR^PSOHLSN D KL^PSOHLSIH
"RTN","PSOHLNE1",137,0)
 Q
"RTN","PSOHLNE1",138,0)
MISRN ;Mismatch on CPRS renewal
"RTN","PSOHLNE1",139,0)
 N PSOCINV
"RTN","PSOHLNE1",140,0)
 I $G(PDFN)'=$P($G(^PSRX(+$G(PREV),0)),"^",2) D  S PSOMO=1 Q
"RTN","PSOHLNE1",141,0)
 .S RCOMM="Patient mismatch on CPRS Renewal." D EN^ORERR(RCOMM,.MSG) S PSOXRP=1 D RERROR^PSOHLSN D KL^PSOHLSIH
"RTN","PSOHLNE1",142,0)
 S PSOCINV=+$P($G(^OR(100,+$G(PLACER),3)),"^",5)
"RTN","PSOHLNE1",143,0)
 I PSOCINV'=$P($G(^PSRX(+$G(PREV),"OR1")),"^",2) D  S PSOMO=1 Q
"RTN","PSOHLNE1",144,0)
 .S RCOMM="Order mismatch on CPRS Renewal." D EN^ORERR(RCOMM,.MSG) S PSOCVI=1 D RERROR^PSOHLSN D KL^PSOHLSIH
"RTN","PSOHLNE1",145,0)
 Q
"RTN","PSOHLNE1",146,0)
ZRX ;Process ZRX segment
"RTN","PSOHLNE1",147,0)
 I $P(PSOSEG,"|",3)="R" S PSOOC="RNW",PSRNFLAG=1
"RTN","PSOHLNE1",148,0)
 S PREV=$S(+$P(PSOSEG,"|"):+$P(PSOSEG,"|"),1:"")
"RTN","PSOHLNE1",149,0)
 I $P(PSOSEG,"|")["P"!($P(PSOSEG,"|")["S") S PFLAG=1
"RTN","PSOHLNE1",150,0)
 S NATURE=$P(PSOSEG,"|",2)
"RTN","PSOHLNE1",151,0)
 S PSORSO=$P(PSOSEG,"|",3)
"RTN","PSOHLNE1",152,0)
 S ROUTING=$P(PSOSEG,"|",4)
"RTN","PSOHLNE1",153,0)
 I ROUTING="" S ROUTING="M"
"RTN","PSOHLNE1",154,0)
 I $P(PSOSEG,"|",7) S DSIG=1
"RTN","PSOHLNE1",155,0)
 Q
"RTN","PSOHLNE1",156,0)
CHCS ;Replace CHCS number with CPRS number in .01 field
"RTN","PSOHLNE1",157,0)
 N PSOHTMP
"RTN","PSOHLNE1",158,0)
 I $G(PDFN),PDFN'=+$P($G(^PS(52.41,+$G(PSOCHFFL),0)),"^",2) S COMM="Patient does not match" D EN^ORERR(COMM,.MSG) K PSOPLC,PSOFFL,PSOSND Q
"RTN","PSOHLNE1",159,0)
 I '$D(^PS(52.41,+$G(PSOCHFFL),0)) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) K PSOPLC,PSOFFL,PSOSND Q
"RTN","PSOHLNE1",160,0)
 S PSOHTMP=$P($G(^PS(52.41,+$G(PSOCHFFL),0)),"^")
"RTN","PSOHLNE1",161,0)
 I PSOHTMP'="" K ^PS(52.41,"B",PSOHTMP,+$G(PSOCHFFL))
"RTN","PSOHLNE1",162,0)
 S $P(^PS(52.41,+$G(PSOCHFFL),0),"^")=PSOPLC,^PS(52.41,"B",PSOPLC,+$G(PSOCHFFL))=""
"RTN","PSOHLNE1",163,0)
 S $P(^PS(52.41,+$G(PSOCHFFL),"EXT"),"^",2)=1
"RTN","PSOHLNE1",164,0)
 Q
"RTN","PSOHLNE1",165,0)
CNT ;
"RTN","PSOHLNE1",166,0)
 S TAC=0 F TACA=0:0 S TACA=$O(^PSRX(PREV,"A",TACA)) Q:'TACA  S TAC=TACA
"RTN","PSOHLNE1",167,0)
 S PAC=0 F PACA=0:0 S PACA=$O(^PSRX(PREV,1,PACA)) Q:'PACA  S PAC=PACA
"RTN","PSOHLNE1",168,0)
 D NOW^%DTC S TAC=TAC+1,^PSRX(PREV,"A",0)="^52.3DA^"_TAC_"^"_TAC,^PSRX(PREV,"A",TAC,0)=%_"^"_"C"_"^"_$S(+$G(PROV):$G(PROV),1:+$G(ENTERED))_"^"_PAC_"^"_"Discontinued due to CPRS edit"
"RTN","PSOHLNE1",169,0)
 K TAC,PAC,TACA,PACA
"RTN","PSOHLNE1",170,0)
 Q
"RTN","PSOHLNE1",171,0)
NTE ;
"RTN","PSOHLNE1",172,0)
 S WPCT=1,WORDP=$S($P(MSG(LL),"|",2):$P(MSG(LL),"|",2),1:$P(MSG(LL),"|",3)) S:$P(MSG(LL),"|",4)'="" WPARRAY(WORDP,WPCT)=$P(MSG(LL),"|",4) S:$P(MSG(LL),"|",4)'="" WPCT=WPCT+1 F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNE1",173,0)
 .I $G(MSG(LL,LLL))'="" S WPARRAY(WORDP,WPCT)=$G(MSG(LL,LLL)),WPCT=WPCT+1
"RTN","PSOHLNE1",174,0)
 Q
"RTN","PSOHLNE3")
0^51^B58436703
"RTN","PSOHLNE3",1,0)
PSOHLNE3 ;BIR/LE - Process Edit Information from CPRS ;02/27/04
"RTN","PSOHLNE3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143**;DEC 1997
"RTN","PSOHLNE3",3,0)
 ;External reference to ^OR(100 private DBIA 2219
"RTN","PSOHLNE3",4,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSOHLNE3",5,0)
 ;
"RTN","PSOHLNE3",6,0)
 ;This API is used to update the prescription file when ICD-9 diagnosis
"RTN","PSOHLNE3",7,0)
 ; and SC/EI's are updated as a result of an e-sig in CPRS.  
"RTN","PSOHLNE3",8,0)
 ;
"RTN","PSOHLNE3",9,0)
EN(DFN,ORITEM,ORIEN,ORDX,ORSCEI) ;ENTRY POINT
"RTN","PSOHLNE3",10,0)
 ;     Used to import edit information from CPRS 
"RTN","PSOHLNE3",11,0)
 ;
"RTN","PSOHLNE3",12,0)
 ;Where Input:
"RTN","PSOHLNE3",13,0)
 ;DFN = Patient IEN
"RTN","PSOHLNE3",14,0)
 ;ORITEM = Package reference number from file 100
"RTN","PSOHLNE3",15,0)
 ;ORIEN = ien from file 100
"RTN","PSOHLNE3",16,0)
 ;ORDX(1)= (pointer to file 80) up to 8 accepted and first is primary ICD
"RTN","PSOHLNE3",17,0)
 ;ORDX(2)= (pointer to file 80)
"RTN","PSOHLNE3",18,0)
 ;ORSCEI=  seven pieces - where 1=yes, 0=no, null or ? =not asked
"RTN","PSOHLNE3",19,0)
 ;  ORSCEI=AO^IR^SC^EC^MST^HNC^CV
"RTN","PSOHLNE3",20,0)
 ;
"RTN","PSOHLNE3",21,0)
 ;Output: 
"RTN","PSOHLNE3",22,0)
 ;   1 = success, package information has been updated.
"RTN","PSOHLNE3",23,0)
 ;
"RTN","PSOHLNE3",24,0)
 ;   0^error message = indicates function call did not succeed.  The
"RTN","PSOHLNE3",25,0)
 ;    second piece will be a package specific error message
"RTN","PSOHLNE3",26,0)
 ;     indicating the reason for failure.  Possible reasons for 
"RTN","PSOHLNE3",27,0)
 ;    failure are the Order Number, DFN and Orderable Item did not match.
"RTN","PSOHLNE3",28,0)
 ;        WHERE error message:  1 = Prescription # cannot be found
"RTN","PSOHLNE3",29,0)
 ;                              2 = ORSCEI contains ? for unasked sc/ei's
"RTN","PSOHLNE3",30,0)
 ;                              3 = patient IEN is different
"RTN","PSOHLNE3",31,0)
 ;                              4 = orderable item is different
"RTN","PSOHLNE3",32,0)
 ;                              5 = ORIEN does not equal PLACER ORDER #
"RTN","PSOHLNE3",33,0)
 ;                              6 = DC'ed order;NO COPAY RESETS
"RTN","PSOHLNE3",34,0)
 ;                                   field (#39.3) in Prescription file.
"RTN","PSOHLNE3",35,0)
 ;                            Note: ? marks are translated to null.  CPRS
"RTN","PSOHLNE3",36,0)
 ;                                  is also sending zeros for nulls as of
"RTN","PSOHLNE3",37,0)
 ;                                  5/12/04.  Supposed to change this.
"RTN","PSOHLNE3",38,0)
 ;
"RTN","PSOHLNE3",39,0)
 N DX,DX2,RXN,PSOSCP,PSOX,ORDPROV,PSOSCP2,DA,RET,PSOANSQ,PSORX,PTSTATUS,PSOSCP3,ARRAY,PSOOI,ORITEM2,ORID,OICHK,PSORENW
"RTN","PSOHLNE3",40,0)
 N PSODCPY,PSONEW,PSOOIBQ,PSOFLD,PSODCZ,PSOSTAZ,PREA,PSOPIBQ,PSOIBQC
"RTN","PSOHLNE3",41,0)
 S PSOSCP3=0
"RTN","PSOHLNE3",42,0)
 S:'$D(ORIEN) ORIEN="" S:'$D(ORSCEI) ORSCEI="" S:'$D(ORITEM) ORITEM=""
"RTN","PSOHLNE3",43,0)
 ;
"RTN","PSOHLNE3",44,0)
 ;validate prescription IEN with DFN, ord item, and placer#
"RTN","PSOHLNE3",45,0)
 S RET=1,PSODCZ=",12,14,15,"
"RTN","PSOHLNE3",46,0)
 S RXN=ORITEM I '$D(^PSRX(RXN)) S RET="0^1" Q RET  ;invalid RX ien
"RTN","PSOHLNE3",47,0)
 I $D(^PSRX(RXN,"STA")) S PSOSTAZ=^PSRX(RXN,"STA")
"RTN","PSOHLNE3",48,0)
 ; get prescription file patient ien, drug, and placer order #
"RTN","PSOHLNE3",49,0)
 D GETS^DIQ(52,RXN_",","2;6;39.3","I","ARRAY")
"RTN","PSOHLNE3",50,0)
 I '$D(ARRAY(52,RXN_",",2,"I")) S RET="0^3" Q RET  ;quit if you don't have a patient ien
"RTN","PSOHLNE3",51,0)
 I ARRAY(52,RXN_",",2,"I")'=DFN S RET="0^3" Q RET  ;quit if patient dfn is differnt
"RTN","PSOHLNE3",52,0)
 I '$D(ARRAY(52,RXN_",",39.3,"I")) S ARRAY(52,RXN_",",39.3,"I")=""  ;if don't have it; treat is as null
"RTN","PSOHLNE3",53,0)
 I ARRAY(52,RXN_",",39.3,"I")'="" I ARRAY(52,RXN_",",39.3,"I")'=ORIEN S RET="0^5" Q RET  ;placer # is different
"RTN","PSOHLNE3",54,0)
 I ARRAY(52,RXN_",",39.3,"I")="" S OICHK=0 D CHKOI I OICHK S RET="0^4" Q RET  ;quit if placer # is null and orderable item is different or null.
"RTN","PSOHLNE3",55,0)
 ;end of validation process
"RTN","PSOHLNE3",56,0)
 ;
"RTN","PSOHLNE3",57,0)
 S PSOPIBQ=$G(^PSRX(RXN,"IBQ"))
"RTN","PSOHLNE3",58,0)
 S PSOX("IRXN")=RXN,PSORENW("IRXN")=RXN
"RTN","PSOHLNE3",59,0)
 S (PSONEW("PATIENT STATUS"),PTSTATUS)=$$GET1^DIQ(52,RXN_",","3","I")
"RTN","PSOHLNE3",60,0)
 I '$D(PTSTATUS) S (PSONEW("PATIENT STATUS"),PTSTATUS)=""
"RTN","PSOHLNE3",61,0)
 ;if patient status is null, treat same as PSONEW2, PSORN52, PSONEWG, AND PSONEWF.  If piece 7 of ^PS(53 doesn't equal 1, it's not exempt from copay.
"RTN","PSOHLNE3",62,0)
 I ORSCEI["?" S ORSCEI=$TR(ORSCEI,"?","")
"RTN","PSOHLNE3",63,0)
 D ELIG^VADPT S PSOSCP="",PSOSCP=$P(VAEL(3),"^",2) S:PSOSCP=""&($P(VAEL(3),"^",1)=1) PSOSCP3=1 K VAEL
"RTN","PSOHLNE3",64,0)
 S PSOANSQ(PSOX("IRXN"),"VEH")=$P(ORSCEI,U,1)
"RTN","PSOHLNE3",65,0)
 S PSOANSQ(PSOX("IRXN"),"RAD")=$P(ORSCEI,U,2)
"RTN","PSOHLNE3",66,0)
 I PSOSCP<50&($P($G(^PS(53,+$G(PTSTATUS),0)),"^",7)'=1) S PSOANSQ(PSOX("IRXN"),"SC")=$P(ORSCEI,U,3),PSOANSQ("SC")=$P(ORSCEI,U,3)
"RTN","PSOHLNE3",67,0)
 I PSOSCP>49!($P($G(^PS(53,+$G(PTSTATUS),0)),"^",7)=1) S PSOANSQ(PSOX("IRXN"),"SC>50")=$P(ORSCEI,U,3),PSOANSQ("SC>50")=$P(ORSCEI,U,3)
"RTN","PSOHLNE3",68,0)
 I PSOSCP3&('$D(PSOANSQ("SC")))&($D(^PSRX(RXN,"ICD",1))) S PSOANSQ("SC")=$P(^PSRX(RXN,"ICD",1,0),"^",4),PSOANSQ(PSOX("IRXN"),"SC")=PSOANSQ("SC")  ;for SC with no percentage defined/ legacy
"RTN","PSOHLNE3",69,0)
 S PSOANSQ(PSOX("IRXN"),"PGW")=$P(ORSCEI,U,4)
"RTN","PSOHLNE3",70,0)
 S PSOANSQ(PSOX("IRXN"),"MST")=$P(ORSCEI,U,5)
"RTN","PSOHLNE3",71,0)
 S PSOANSQ(PSOX("IRXN"),"HNC")=$P(ORSCEI,U,6)
"RTN","PSOHLNE3",72,0)
 S PSOANSQ(PSOX("IRXN"),"CV")=$P(ORSCEI,U,7)
"RTN","PSOHLNE3",73,0)
 ;I '+$G(ORDX(1)) 
"RTN","PSOHLNE3",74,0)
 S DX="",DX2=0 F  S DX=$O(ORDX(DX)) Q:DX=""  S DX2=DX2+1,PSORX("ICD",DX2)=ORDX(DX)  ;Multi signed Rx's come in consecutively and the diagnosis subscript doesn't start with 1 for each Rx
"RTN","PSOHLNE3",75,0)
 ;E  M PSORX("ICD")=ORDX
"RTN","PSOHLNE3",76,0)
 S PSOSCP2=1
"RTN","PSOHLNE3",77,0)
 I PSOSCP<50 D  ;compare old IBQ SC/EI to newly received ones from CPRS, set PSODCPY variable if changed.
"RTN","PSOHLNE3",78,0)
 . D GETS^DIQ(52,PSOX("IRXN")_",","116;117;118;119;120;121;122","I","PSOOIBQ")
"RTN","PSOHLNE3",79,0)
 . S PSODCPY=0,PSOFLD=""
"RTN","PSOHLNE3",80,0)
 . F  S PSOFLD=$O(PSOOIBQ(52,PSOX("IRXN")_",",PSOFLD)) Q:PSOFLD=""  D
"RTN","PSOHLNE3",81,0)
 .. I $D(PSOANSQ("SC"))&(PSOFLD=116) S:PSOANSQ("SC")'=PSOOIBQ(52,PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1
"RTN","PSOHLNE3",82,0)
 .. I $D(PSOANSQ(PSOX("IRXN"),"MST"))&(PSOFLD=117) S:PSOANSQ(PSOX("IRXN"),"MST")'=PSOOIBQ(52,PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1
"RTN","PSOHLNE3",83,0)
 .. I $D(PSOANSQ(PSOX("IRXN"),"VEH"))&(PSOFLD=118) S:PSOANSQ(PSOX("IRXN"),"VEH")'=PSOOIBQ(52,PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1
"RTN","PSOHLNE3",84,0)
 .. I $D(PSOANSQ(PSOX("IRXN"),"RAD"))&(PSOFLD=119) S:PSOANSQ(PSOX("IRXN"),"RAD")'=PSOOIBQ(52,PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1
"RTN","PSOHLNE3",85,0)
 .. I $D(PSOANSQ(PSOX("IRXN"),"PGW"))&(PSOFLD=120) S:PSOANSQ(PSOX("IRXN"),"PGW")'=PSOOIBQ(52,PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1
"RTN","PSOHLNE3",86,0)
 .. I $D(PSOANSQ(PSOX("IRXN"),"HNC"))&(PSOFLD=121) S:PSOANSQ(PSOX("IRXN"),"HNC")'=PSOOIBQ(52,PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1
"RTN","PSOHLNE3",87,0)
 .. I $D(PSOANSQ(PSOX("IRXN"),"CV"))&(PSOFLD=122) S:PSOANSQ(PSOX("IRXN"),"CV")'=PSOOIBQ(52,PSOX("IRXN")_",",PSOFLD,"I") PSODCPY=1
"RTN","PSOHLNE3",88,0)
 D FILE2^PSORN52D  ;file SC/EI/ICD'S into Rx file
"RTN","PSOHLNE3",89,0)
 ;set activity log with edit info from cprs
"RTN","PSOHLNE3",90,0)
 N ACNT,SUB,RF,RFCNT
"RTN","PSOHLNE3",91,0)
 S ACNT=0 F SUB=0:0 S SUB=$O(^PSRX(RXN,"A",SUB)) Q:'SUB  S ACNT=SUB
"RTN","PSOHLNE3",92,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(RXN,1,RF)) Q:'RF  S RFCNT=RF S:RF>5 RFCNT=RF+1
"RTN","PSOHLNE3",93,0)
 D NOW^%DTC S ACNT=ACNT+1
"RTN","PSOHLNE3",94,0)
 S ^PSRX(RXN,"A",0)="^52.3DA^"_ACNT_"^"_ACNT S ^PSRX(RXN,"A",ACNT,0)=%_"^"_"E"_"^^"_RFCNT_"^Clinical Indicators and SC/EI's were updated from a CPRS e-sig edit at "_$E($P(%,".",2),1,2)_":"_$E($P(%,".",2),3,4)_"."
"RTN","PSOHLNE3",95,0)
 ;only do copay if SC/EI changed and SC is less than 50%.
"RTN","PSOHLNE3",96,0)
 I PSODCZ[(","_$G(PSOSTAZ)_",") S RET="0^6" Q RET  ;discontinue's no copay changes allowed.
"RTN","PSOHLNE3",97,0)
 S PSOIBQC=$G(^PSRX(RXN,"IBQ"))
"RTN","PSOHLNE3",98,0)
 I PSOPIBQ[1&(PSOIBQC'[1)&(PSOSCP<50) S $P(^PSRX(RXN,"IB"),"^",1)=1 D  Q RET  ;don't do no copay to copay updates, but update status
"RTN","PSOHLNE3",99,0)
 . S PSOOLD="No Copay",PSONW="Copay",PREA="R",PSODA=RXN D ACTLOG^PSOCPA
"RTN","PSOHLNE3",100,0)
 I $G(PSODCPY)&(PSOSCP<50) D COPAY
"RTN","PSOHLNE3",101,0)
 Q RET
"RTN","PSOHLNE3",102,0)
 ;
"RTN","PSOHLNE3",103,0)
COPAY ;cancel copay charges if SC<50% and SC/EI changed and released
"RTN","PSOHLNE3",104,0)
 ;  must have PSODA,PSO,PSODAYS,PSOFLAG,PSOREF,PSOIB,PSOPAR7,PSOOLD,PSONW before call to PSOCPA
"RTN","PSOHLNE3",105,0)
 N PSODA,PSO,PSODAYS,PSOFLAG,PSOREF,PSOIB,PSZ,PSOPAR7,PSOCSEQ,PSZ1,PSZ2,RELDAT,PSOOLD,PSONW,PSOSITE
"RTN","PSOHLNE3",106,0)
 S PSODA=RXN,PSO=3,PSODAYS=$$GET1^DIQ(52,PSODA_",","8")
"RTN","PSOHLNE3",107,0)
 S PSOOLD="Copay"
"RTN","PSOHLNE3",108,0)
 S PSONW="No Copay"
"RTN","PSOHLNE3",109,0)
 S PSOSITE=$P(^PSRX(PSODA,2),"^",9)
"RTN","PSOHLNE3",110,0)
 S PSOPAR7=$G(^PS(59,PSOSITE,"IB"))
"RTN","PSOHLNE3",111,0)
 S PSOFLAG=1  ;1 used here to eliminate display/print of messages.
"RTN","PSOHLNE3",112,0)
CSORT ; get orig fill copay info if released.
"RTN","PSOHLNE3",113,0)
 S RELDAT=$$GET1^DIQ(52,PSODA_",","31","I")
"RTN","PSOHLNE3",114,0)
 I RELDAT'="" S PSOCSEQ("A",0)=$G(^PSRX(PSODA,"IB"))
"RTN","PSOHLNE3",115,0)
 I RELDAT="" S PREA="R" D ACTLOG^PSOCPA G SET ;set act log when unreleased, but SC/EI changed copay
"RTN","PSOHLNE3",116,0)
 ; get copay info for all released refills; if any
"RTN","PSOHLNE3",117,0)
 F PSZ=0:0 S PSZ=$O(^PSRX(PSODA,1,PSZ)) Q:PSZ'>0  D
"RTN","PSOHLNE3",118,0)
 . S RELDAT="",RELDAT=$$GET1^DIQ(52.1,PSZ_","_PSODA_",","17","I")
"RTN","PSOHLNE3",119,0)
 . Q:RELDAT=""
"RTN","PSOHLNE3",120,0)
 . S PSOCSEQ("A",PSZ)=$G(^PSRX(PSODA,1,PSZ,"IB"))
"RTN","PSOHLNE3",121,0)
 ; Sort potential refills to be cancelled first starting with last fill
"RTN","PSOHLNE3",122,0)
 ;    then orig fill then the rest of the entries.
"RTN","PSOHLNE3",123,0)
 S (PSZ1,PSZ2,PSZ)="" F  S PSZ=$O(PSOCSEQ("A",PSZ),-1) Q:PSZ=""  D
"RTN","PSOHLNE3",124,0)
 . I PSZ>0&($P(PSOCSEQ("A",PSZ),"^",2)'="") S PSZ1=PSZ1+1,PSOCSEQ("B",PSZ1,PSZ)="" Q
"RTN","PSOHLNE3",125,0)
 . I PSZ>0&($P(PSOCSEQ("A",PSZ),"^",2)="") S PSZ2=PSZ2+1000,PSOCSEQ("B",PSZ2,PSZ)="" Q
"RTN","PSOHLNE3",126,0)
 . I PSZ=0&($P(PSOCSEQ("A",PSZ),"^",4)'="") S PSZ1=PSZ1+1,PSOCSEQ("B",PSZ1,PSZ)="" Q
"RTN","PSOHLNE3",127,0)
 . I PSZ=0&($P(PSOCSEQ("A",PSZ),"^",4)="") S PSZ2=PSZ2+1000,PSOCSEQ("B",PSZ2,PSZ)="" Q
"RTN","PSOHLNE3",128,0)
 ;
"RTN","PSOHLNE3",129,0)
 S (PSZ,PSZ1)="",PSOFLD=0 F  S PSZ1=$O(PSOCSEQ("B",PSZ1)) Q:PSZ1=""  D
"RTN","PSOHLNE3",130,0)
 . F  S PSZ=$O(PSOCSEQ("B",PSZ1,PSZ)) Q:PSZ=""  D
"RTN","PSOHLNE3",131,0)
 .. S (PSOREF,PSOIB)="",PSOFLD=PSOFLD+1 S PREA=$S(PSOFLD=1:"R",1:"C")
"RTN","PSOHLNE3",132,0)
 .. I PSOFLD>1 S (PSOOLD,PSONW)=""
"RTN","PSOHLNE3",133,0)
 .. S PSOREF=PSZ,PSOIB=PSOCSEQ("A",PSZ) D RXED^PSOCPA
"RTN","PSOHLNE3",134,0)
SET S $P(^PSRX(PSODA,"IB"),"^",1)=""
"RTN","PSOHLNE3",135,0)
 Q
"RTN","PSOHLNE3",136,0)
 ;
"RTN","PSOHLNE3",137,0)
CHKOI ;get and compare orderable items in file #100 and #52; don't process
"RTN","PSOHLNE3",138,0)
 ;  if it's different and the placer # is null.
"RTN","PSOHLNE3",139,0)
 I '$D(ARRAY(52,RXN_",",6,"I")) S OICHK=1 Q
"RTN","PSOHLNE3",140,0)
 D GETS^DIQ(50,ARRAY(52,RXN_",",6,"I")_",","2.1","I","PSOOI")
"RTN","PSOHLNE3",141,0)
 S ORITEM2=$$GET1^DIQ(100.001,"1,"_ORIEN_",",".01","I")
"RTN","PSOHLNE3",142,0)
 S ORID=$$GET1^DIQ(101.43,ORITEM2_",","2","I") S ORID=$P(ORID,";",1)
"RTN","PSOHLNE3",143,0)
 I PSOOI(50,ARRAY(52,RXN_",",6,"I")_",",2.1,"I")'="" I PSOOI(50,ARRAY(52,RXN_",",6,"I")_",",2.1,"I")'=ORID S OICHK=1
"RTN","PSOHLNE3",144,0)
 Q
"RTN","PSOHLNE3",145,0)
 ;
"RTN","PSOHLNE3",146,0)
TEST(ORIEN) ;manually test an individual order record
"RTN","PSOHLNE3",147,0)
 N I,X,ORSCEIS,ORSCEI,ORDX,EDFLG,ORITEM,DFN
"RTN","PSOHLNE3",148,0)
 F I=1:1 Q:'$D(^OR(100,ORIEN,5.1,I))  S ORDX(I)=^OR(100,ORIEN,5.1,I,0)
"RTN","PSOHLNE3",149,0)
 S ORSCEIS=^OR(100,ORIEN,5.2),ORITEM=$P($G(^OR(100,ORIEN,4)),"^",1)
"RTN","PSOHLNE3",150,0)
 S ORSCEI="" F I=3,4,1,5,2,6,7 S ORSCEI=ORSCEI_"^"_$P(ORSCEIS,"^",I)
"RTN","PSOHLNE3",151,0)
 S ORSCEI=$E(ORSCEI,2,99)
"RTN","PSOHLNE3",152,0)
 S RXN=ORITEM,DFN=$P($P(^OR(100,ORIEN,0),"^",2),";",1)
"RTN","PSOHLNE3",153,0)
 S X="",X=$$EN^PSOHLNE3(DFN,ORITEM,ORIEN,.ORDX,ORSCEI)
"RTN","PSOHLNE3",154,0)
 Q X
"RTN","PSOHLNEW")
0^9^B76783562
"RTN","PSOHLNEW",1,0)
PSOHLNEW ;BIR/RTR - CPRS orders ;07/21/96
"RTN","PSOHLNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,7,15,46,71,98,111,124,117,131,146,132,143**;DEC 1997
"RTN","PSOHLNEW",3,0)
 ;40.8-728,50-221,SC-2675,100-2219,50.7-2223,EN^ORERR-2187
"RTN","PSOHLNEW",4,0)
EN(MSG) ;
"RTN","PSOHLNEW",5,0)
 N PSODDRUG,ENTERED,LOCATION,PLACER,PSOOC,ROUTE,NATURE,PREV,ROUTING,OO,OR,STAT,ZZ,DFN,COMM,QCOUNT,OCOUNT,Q1I,QTARRAY,QTARRAY2,EE,PP,XOFLAG,PSODYSPL,PSOFILNM
"RTN","PSOHLNEW",6,0)
 N ONEFLAG,SERV,WPCT,EFFECT,PROV,PENDING,RRX,PSOLQ1I,PSOLQ1II,PSOQWX,PSOLQ1IX,PSONVA,PSOICD,PSOSCP,EEE
"RTN","PSOHLNEW",7,0)
 N OBXAR,AA,II,SIG1,FILLER,COMM,GG,FF,JJ,JJJ,CT,LIM,VAR,VAR1,QQQ,PSRNFLAG,PSRNQFLG,RCOMM,XOFLAGZ,NWFLAG,PFLAG,PSINPTR,INPTRX,PSOIBN,PSOIBY
"RTN","PSOHLNEW",8,0)
 N DSIG,PSOCHFFL,PSOCVI,PSOMO,PSOXRP,NN,LL,LLL,WPARRAY,QTVAR,POVAR,POVAR1,ORCSEG,NNN,OOO,AAA,NNNN,POLIM,NNCK,PRIOR,IPPLACER,PLACERXX,EER,PSERRPID,PSERRPV1,PSERRORC,PSOEXFLG,PSOMSORR,PDFN
"RTN","PSOHLNEW",9,0)
 S (SEND,PSOSND,OCOUNT)=0 K PSOPLC,PSOFFL,PSORSO,PSOSUSZ
"RTN","PSOHLNEW",10,0)
 F OO=0:0 S OO=$O(MSG(OO)) Q:'OO!(SEND)!(PSOSND)  D:$P(MSG(OO),"|")="PID" SPDFN I $P(MSG(OO),"|")="ORC",$P(MSG(OO),"|",2)'="NW",$P(MSG(OO),"|",2)'="XO" D
"RTN","PSOHLNEW",11,0)
 .S OR("STAT")=$P(MSG(OO),"|",2),OR("PLACE")=+$P(MSG(OO),"|",3),PLACERXX=+$P($P(MSG(OO),"|",3),";",2),OR("COMM")=$P(MSG(OO),"|",17),OR("USER")=$P(MSG(OO),"|",11) I $P(MSG(OO),"|",2)'="DE",$P(MSG(OO),"|",2)'="NA" S SEND=1 D FILL Q
"RTN","PSOHLNEW",12,0)
 .S PSOPLC=+$P(MSG(OO),"|",3),PSOFFL=+$P(MSG(OO),"|",4),PSOSND=1,PSOCHFFL=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",13,0)
 I $G(OR("COMM"))["^" S OR("COMM")=$P(OR("COMM"),"^",5)
"RTN","PSOHLNEW",14,0)
 I PSOSND,$G(PSOCHFFL)["S",$G(OR("STAT"))="NA" D CHCS^PSOHLNE1 Q
"RTN","PSOHLNEW",15,0)
 I PSOSND,'$D(^PSRX(+$G(PSOFFL),0)) S COMM="Order was not located by Pharmacy" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",16,0)
 I PSOSND,$G(PDFN),PDFN'=+$P($G(^PSRX(+$G(PSOFFL),0)),"^",2) S COMM="Patient does not match" D EN^ORERR(COMM,.MSG) D KL Q
"RTN","PSOHLNEW",17,0)
 I PSOSND,$G(OR("STAT"))'="DE" S $P(^PSRX(PSOFFL,"OR1"),"^",2)=PSOPLC,^PSRX("APL",PSOPLC,PSOFFL)="" D KL Q
"RTN","PSOHLNEW",18,0)
 D KL
"RTN","PSOHLNEW",19,0)
 I SEND,$G(OR("STAT"))="Z@" G PURGE^PSOHLNE2
"RTN","PSOHLNEW",20,0)
 I SEND,$G(OR("STAT"))="ZF" G REF^PSOHLNE2
"RTN","PSOHLNEW",21,0)
 I SEND,$G(OR("STAT"))'="CA",$G(OR("STAT"))'="DC",$G(OR("STAT"))'="HD",$G(OR("STAT"))'="RL",$G(OR("STAT"))'="SS" S RCOMM="Invalid Order Control Code" D EN^ORERR(RCOMM,.MSG) Q
"RTN","PSOHLNEW",22,0)
 I SEND K SEND G:$G(OR("STAT"))="SS" ESTAT D EN^PSOORUTL(.OR) S PLACER=OR("PLACE"),STAT=OR("STAT"),COMM=OR("COMM") S PSOMSORR=1 D  K PSOMSORR Q
"RTN","PSOHLNEW",23,0)
 .I $G(OR("FILLER"))="" D  D ERROR^PSOHLSN Q
"RTN","PSOHLNEW",24,0)
 ..F EER=0:0 S EER=$O(MSG(EER)) Q:'EER  S:$P(MSG(EER),"|")="PV1" PSERRPV1=MSG(EER) S:$P(MSG(EER),"|")="PID" PSERRPID=MSG(EER) S:$P(MSG(EER),"|")="ORC"&($G(PSERRORC)="") PSERRORC=MSG(EER)
"RTN","PSOHLNEW",25,0)
 .I $P(OR("FILLER"),"^",2)="R" S FILLER=$P(OR("FILLER"),"^") D EN^PSOHLSN1(FILLER,STAT,$G(OR("PHARMST")),COMM) K:$G(PSOEXFLG) PSOMSORR,PLACERXX D:$G(PSOEXFLG) EN^PSOHLSN1(FILLER,"SC","ZE","") D:$G(PSOSUSZ) SUS^PSOORUT1 K PSOSUSZ Q
"RTN","PSOHLNEW",26,0)
 .D EN^PSOHLSN(PLACER,STAT,COMM) Q
"RTN","PSOHLNEW",27,0)
 D KL^PSOHLSIH S RRX=1 F ZZ=0:0 S ZZ=$O(MSG(ZZ)) Q:'ZZ  S PSOSEG=$G(MSG(ZZ)),PSOTYPE=$P(PSOSEG,"|") S PSOSEG=$E(PSOSEG,5,$L(PSOSEG)) I PSOTYPE'="NTE" D @PSOTYPE
"RTN","PSOHLNEW",28,0)
 I $G(PSRNFLAG) S PSOMO=0 D MISRN^PSOHLNE1 I $G(PSOMO) Q
"RTN","PSOHLNEW",29,0)
 S PSRNQFLG=0 I $G(PSRNFLAG),$G(PREV) D  I $G(PSRNQFLG) S RCOMM="Duplicate Renewal Request. Order rejected by Pharmacy." D EN^ORERR(RCOMM,.MSG) D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",30,0)
 .I $P($G(^PSRX(PREV,"OR1")),"^",4) S PSRNQFLG=1 Q
"RTN","PSOHLNEW",31,0)
 .I $O(^PS(52.41,"AQ",PREV,0)) S PSRNQFLG=1
"RTN","PSOHLNEW",32,0)
 .I $G(XOFLAG),$G(DFN)'=$S($G(PFLAG):$P($G(^PS(52.41,+$G(PREV),0)),"^",2),1:$P($G(^PSRX(+$G(PREV),0)),"^",2)) S RCOMM="Patient mismatch on previous order." D EN^ORERR(RCOMM,.MSG) S XOFLAGZ=1 D RERROR^PSOHLSN D KL^PSOHLSIH Q
"RTN","PSOHLNEW",33,0)
 I $G(DFN)'=+$P($G(^OR(100,+$G(PLACER),0)),"^",2) G MISX^PSOHLNE1
"RTN","PSOHLNEW",34,0)
 I $G(PLACER) D NFILE
"RTN","PSOHLNEW",35,0)
 D KL^PSOHLSIH
"RTN","PSOHLNEW",36,0)
 Q
"RTN","PSOHLNEW",37,0)
ESTAT ;
"RTN","PSOHLNEW",38,0)
 D EXP^PSOHLNE1
"RTN","PSOHLNEW",39,0)
 Q
"RTN","PSOHLNEW",40,0)
MSH Q
"RTN","PSOHLNEW",41,0)
PID S DFN=+$P(PSOSEG,"|",3)
"RTN","PSOHLNEW",42,0)
 Q
"RTN","PSOHLNEW",43,0)
PV1 S LOCATION=+$P(+$P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",44,0)
 S:'$D(^SC(LOCATION,0)) LOCATION=""
"RTN","PSOHLNEW",45,0)
 S INPTRX=0 I $G(LOCATION) S PSINPTR=$P($G(^SC(LOCATION,0)),"^",4) I PSINPTR Q
"RTN","PSOHLNEW",46,0)
 I $G(LOCATION) S INPTRX=$P($G(^SC(LOCATION,0)),"^",15)
"RTN","PSOHLNEW",47,0)
 I '$G(INPTRX) S INPTRX=$O(^DG(40.8,0))
"RTN","PSOHLNEW",48,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLNEW",49,0)
 S PSINPTR=+$$SITE^VASITE(DT,INPTRX)
"RTN","PSOHLNEW",50,0)
 Q
"RTN","PSOHLNEW",51,0)
DG1 S $P(PSOICD($P(PSOSEG,"|",1)),"^")=$P($P(PSOSEG,"|",3),"^")
"RTN","PSOHLNEW",52,0)
 Q
"RTN","PSOHLNEW",53,0)
ORC ;
"RTN","PSOHLNEW",54,0)
 Q:$P(PSOSEG,"|")="DE"
"RTN","PSOHLNEW",55,0)
 S:$P(PSOSEG,"|")="XO" XOFLAG=1 D ^PSOHLNE1 S:$G(PRIOR)="A" PRIOR="E" S:$G(PRIOR)="" PRIOR="R"
"RTN","PSOHLNEW",56,0)
 Q
"RTN","PSOHLNEW",57,0)
 ;
"RTN","PSOHLNEW",58,0)
RXO I $O(MSG(ZZ,0)) D ^PSOHLNE2 G RXOPS
"RTN","PSOHLNEW",59,0)
 S PSORDITE=$P($P(PSOSEG,"|"),"^",4)
"RTN","PSOHLNEW",60,0)
 S PSODDRUG=$P($P(PSOSEG,"|",10),"^",4) I $G(PSODDRUG) S:'$D(^PSDRUG(PSODDRUG,0)) PSODDRUG=""
"RTN","PSOHLNEW",61,0)
 S PSOXQTY=$P(PSOSEG,"|",11)
"RTN","PSOHLNEW",62,0)
 S PSOREFIL=$P(PSOSEG,"|",13)
"RTN","PSOHLNEW",63,0)
 S PSODYSPL=$P(PSOSEG,"|",17)
"RTN","PSOHLNEW",64,0)
RXOPS S ONEFLAG=0,WPCT=1,LL=ZZ+1
"RTN","PSOHLNEW",65,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNEW",66,0)
 .S ONEFLAG=1,WORDP=$S($P(MSG(LL),"|",2):$P(MSG(LL),"|",2),1:$P(MSG(LL),"|",3)) S:$P(MSG(LL),"|",4)'="" WPARRAY(WORDP,WPCT)=$P(MSG(LL),"|",4) S:$P(MSG(LL),"|",4)'="" WPCT=WPCT+1 F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNEW",67,0)
 ..I $G(MSG(LL,LLL))'="" S WPARRAY(WORDP,WPCT)=$G(MSG(LL,LLL)),WPCT=WPCT+1
"RTN","PSOHLNEW",68,0)
 I ONEFLAG S LL=LL+1 I $P($G(MSG(LL)),"|")="NTE" D NTE^PSOHLNE1
"RTN","PSOHLNEW",69,0)
 K WORDP
"RTN","PSOHLNEW",70,0)
 Q
"RTN","PSOHLNEW",71,0)
RXR I $P($P(PSOSEG,"|"),"^",4) S ROUTE(RRX)=$P($P(PSOSEG,"|"),"^",4) S RRX=RRX+1
"RTN","PSOHLNEW",72,0)
 Q
"RTN","PSOHLNEW",73,0)
OBX I $O(MSG(ZZ,0)) D OBXX^PSOHLNE2 G OBXNTE
"RTN","PSOHLNEW",74,0)
 S OCOUNT=OCOUNT+1
"RTN","PSOHLNEW",75,0)
 S OBXAR(OCOUNT,1)=$P(PSOSEG,"|",5)
"RTN","PSOHLNEW",76,0)
OBXNTE ;
"RTN","PSOHLNEW",77,0)
 S LL=ZZ+1,PSOBCT=2
"RTN","PSOHLNEW",78,0)
 I $P($G(MSG(LL)),"|")="NTE" D
"RTN","PSOHLNEW",79,0)
 .I $P(MSG(LL),"|",4)'="" S PSOBCT=3,OBXAR(OCOUNT,2)=$P(MSG(LL),"|",4)
"RTN","PSOHLNEW",80,0)
 .F LLL=0:0 S LLL=$O(MSG(LL,LLL)) Q:'LLL  D
"RTN","PSOHLNEW",81,0)
 ..I $P($G(MSG(LL,LLL)),"|",4)'="" S OBXAR(OCOUNT,PSOBCT)=$P(MSG(LL,LLL),"|",4),PSOBCT=PSOBCT+1
"RTN","PSOHLNEW",82,0)
 Q
"RTN","PSOHLNEW",83,0)
ZRN S PSODSC=1_"^"_$P(PSOSEG,"|",2)
"RTN","PSOHLNEW",84,0)
 I $O(MSG(ZZ,0)) F T=0:0 S T=$O(MSG(ZZ,T)) Q:'T  S PSODSC(T)=MSG(ZZ,T)
"RTN","PSOHLNEW",85,0)
 K T
"RTN","PSOHLNEW",86,0)
 Q
"RTN","PSOHLNEW",87,0)
 ;
"RTN","PSOHLNEW",88,0)
ZRX D ZRX^PSOHLNE1
"RTN","PSOHLNEW",89,0)
 Q
"RTN","PSOHLNEW",90,0)
 ;
"RTN","PSOHLNEW",91,0)
ZCL D ZCL^PSOHLNE1
"RTN","PSOHLNEW",92,0)
 Q
"RTN","PSOHLNEW",93,0)
ZSC D CP^PSOHLNE1
"RTN","PSOHLNEW",94,0)
 Q
"RTN","PSOHLNEW",95,0)
NFILE ;
"RTN","PSOHLNEW",96,0)
 I $G(PSODSC) D ^PSONVNEW Q  ;adds non-va med to #55
"RTN","PSOHLNEW",97,0)
 ;
"RTN","PSOHLNEW",98,0)
 K DD,DO,DIC S DLAYGO="52.41",DIC="^PS(52.41,",DIC(0)="L",X=PLACER,DIC("DR")="1////"_DFN_";2////"_PSOOC_";6////"_$G(EFFECT)_";12////"_$G(PSOXQTY)_";25////"_$G(PRIOR)
"RTN","PSOHLNEW",99,0)
 S DIC("DR")=DIC("DR")_";22////"_$G(PSORSO)_";22.1////"_$G(PREV)_";19////"_$G(ROUTING)_";17////"_$G(SERV)_";7////"_$G(NATURE)_";13////"_$G(PSOREFIL)_";1.1////"_$G(LOCATION)_";117////"_$G(DSIG)
"RTN","PSOHLNEW",100,0)
 D FILE^DICN K DIC,DR I Y<0 Q
"RTN","PSOHLNEW",101,0)
 S PENDING=+Y
"RTN","PSOHLNEW",102,0)
 S $P(^PS(52.41,PENDING,0),"^",4)=$S($G(ENTERED):+$G(ENTERED),1:""),$P(^(0),"^",5)=$S($G(PROV):+$G(PROV),1:""),$P(^(0),"^",8)=$S($G(PSORDITE):+$G(PSORDITE),1:""),$P(^(0),"^",9)=$S($G(PSODDRUG):+$G(PSODDRUG),1:""),$P(^(0),"^",15)=$G(ROUTE)
"RTN","PSOHLNEW",103,0)
 S ^PS(52.41,PENDING,"IBQ")=$G(PSOIBY)
"RTN","PSOHLNEW",104,0)
 I $G(PSODYSPL)'="",$E(PSODYSPL)?1A S PSODYSPL=$E(PSODYSPL,2,$L(PSODYSPL))
"RTN","PSOHLNEW",105,0)
 S $P(^PS(52.41,PENDING,"INI"),"^")=$G(PSINPTR),$P(^(0),"^",12)=$G(PSOLOG),$P(^(0),"^",22)=$G(PSODYSPL)
"RTN","PSOHLNEW",106,0)
 I $G(QCOUNT) S ^PS(52.41,PENDING,1,0)="^52.413^"_QCOUNT_"^"_QCOUNT
"RTN","PSOHLNEW",107,0)
 S PSOQWX=$G(PSODDRUG) D:'$G(PSOQWX) OID^PSOHLNE1
"RTN","PSOHLNEW",108,0)
 F PP=0:0 S PP=$O(Q1I(PP)) Q:'PP  S ^PS(52.41,PENDING,1,PP,0)=$S($G(PSOQWX)&($G(PSOLQ1II(PP))):Q1I(PP),$G(PSOQWX)&($G(PSOLQ1IX(PP))'="")&('$G(PSOLQ1II(PP))):PSOLQ1IX(PP),1:PSOLQ1I(PP))
"RTN","PSOHLNEW",109,0)
 F EE=0:0 S EE=$O(QTARRAY(EE)) Q:'EE  S ^PS(52.41,PENDING,1,EE,1)=QTARRAY(EE),^PS(52.41,PENDING,1,EE,2)=$S($G(PSOQWX)&($G(PSOLQ1II(EE))):$G(QTARRAY2(EE)),$G(PSOQWX)&($G(PSOLQ1IX(EE))'="")&('$G(PSOLQ1II(EE))):PSOLQ1IX(EE),1:$G(PSOLQ1I(EE))) D
"RTN","PSOHLNEW",110,0)
 .S $P(^PS(52.41,PENDING,1,EE,1),"^",8)=+$G(ROUTE(EE))
"RTN","PSOHLNEW",111,0)
 S:$P($G(^PS(52.41,PENDING,1,1,1)),"^",3) $P(^PS(52.41,PENDING,0),"^",18)=$E($P($G(^PS(52.41,PENDING,1,1,1)),"^",3),1,7)
"RTN","PSOHLNEW",112,0)
 D STUFF^PSOHLNE2
"RTN","PSOHLNEW",113,0)
 D ^PSOHLPII
"RTN","PSOHLNEW",114,0)
 S LL=0 I $O(WPARRAY(6,0)) F LLL=0:0 S LLL=$O(WPARRAY(6,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,3,LL,0)=$G(WPARRAY(6,LLL))
"RTN","PSOHLNEW",115,0)
 I LL S ^PS(52.41,PENDING,3,0)="^52.42^"_LL_"^"_LL
"RTN","PSOHLNEW",116,0)
 S LL=0 I $O(WPARRAY(7,0)) F LLL=0:0 S LLL=$O(WPARRAY(7,LLL)) Q:'LLL  S LL=LL+1 S ^PS(52.41,PENDING,"INS1",LL,0)=$G(WPARRAY(7,LLL))
"RTN","PSOHLNEW",117,0)
 I LL S ^PS(52.41,PENDING,"INS1",0)="^^"_LL_"^"_LL_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",118,0)
 I $P($G(^PS(50.7,+$G(PSORDITE),"INS")),"^")'="" S $P(^PS(52.41,PENDING,"INS"),"^",2)=$S($O(^PS(52.41,PENDING,"INS1",0)):1,1:0)
"RTN","PSOHLNEW",119,0)
 I $G(OCOUNT) S ^PS(52.41,PENDING,"OBX",0)="^52.4118A^"_OCOUNT_"^"_OCOUNT F OCOUNT=1:1:OCOUNT D
"RTN","PSOHLNEW",120,0)
 .S ^PS(52.41,PENDING,"OBX",OCOUNT,0)=$G(OBXAR(OCOUNT,1))
"RTN","PSOHLNEW",121,0)
 .D USER^PSOORFI2(+$G(PROV)) S ^PS(52.41,PENDING,"OBX",OCOUNT,1)=USER1 K USER1
"RTN","PSOHLNEW",122,0)
 .S PSOBCT=1 F LLL=2:1 Q:'$D(OBXAR(OCOUNT,LLL))  S ^PS(52.41,PENDING,"OBX",OCOUNT,2,PSOBCT,0)=OBXAR(OCOUNT,LLL),^PS(52.41,PENDING,"OBX",OCOUNT,2,0)="^^"_PSOBCT_"^"_PSOBCT_"^"_$G(DT)_"^"
"RTN","PSOHLNEW",123,0)
 D ^PSOHLPIS
"RTN","PSOHLNEW",124,0)
 K DIK S DIK="^PS(52.41,",DA=PENDING D IX^DIK
"RTN","PSOHLNEW",125,0)
 I $G(PSOOC)="RNW",$G(PREV),$D(^PSRX(+$G(PREV),0)) D EN^PSOHLSN1(PREV,"SC","ZZ","")
"RTN","PSOHLNEW",126,0)
 S PSOMSORR=1,IPPLACER=$P($G(^PS(52.41,PENDING,0)),"^") I IPPLACER D
"RTN","PSOHLNEW",127,0)
 .I '$G(XOFLAG) D EN^PSOHLSN(IPPLACER,"OK","IP") Q
"RTN","PSOHLNEW",128,0)
 .D EN^PSOHLSN(IPPLACER,"XR","IP") I $G(PFLAG) D DCP^PSOHLSN Q
"RTN","PSOHLNEW",129,0)
 .K PSOMSORR I $D(^PSRX(+$G(PREV),0)) S $P(^PSRX(PREV,"STA"),"^")=15 D CAN^PSOTPCAN(PREV),CAN^PSOUTL(PREV) D  D EN^PSOHLSN1(PREV,"RP","","","A")
"RTN","PSOHLNEW",130,0)
 ..D CNT^PSOHLNE1
"RTN","PSOHLNEW",131,0)
 ..D:$G(^PS(52.41,PENDING,1,1,0))=""&($P($G(^PS(52.41,PENDING,1,1,1)),"^")="")&($G(^PS(52.41,PENDING,"SIG",1,0))="")
"RTN","PSOHLNEW",132,0)
 ...N FSIG,BSIG
"RTN","PSOHLNEW",133,0)
 ...I '$P($G(^PSRX(PREV,"SIG")),"^",2),$P($G(^("SIG")),"^")'="" D
"RTN","PSOHLNEW",134,0)
 ....D EN3^PSOUTLA1(PREV,70)
"RTN","PSOHLNEW",135,0)
 ....I $G(BSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$G(BSIG(1)) I $O(BSIG(1)) F EE=1:0 S EE=$O(BSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$G(BSIG(EE))
"RTN","PSOHLNEW",136,0)
 ...I $P($G(^PSRX(PREV,"SIG")),"^",2),$G(^PSRX(PREV,"SIG1",1,0))'="" D
"RTN","PSOHLNEW",137,0)
 ....D FSIG^PSOUTLA("R",PREV,70)
"RTN","PSOHLNEW",138,0)
 ....I $G(FSIG(1))'="" S ^PS(52.41,PENDING,"SIG",1,0)=$G(FSIG(1)) I $O(FSIG(1)) F EE=1:0 S EE=$O(FSIG(EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",EE,0)=$G(FSIG(EE))
"RTN","PSOHLNEW",139,0)
 ...F EE=0:0 S EE=$O(^PS(52.41,PENDING,"SIG",EE)) Q:'EE  S ^PS(52.41,PENDING,"SIG",0)="^52.4124A^"_EE_"^"_EE
"RTN","PSOHLNEW",140,0)
 S (EE,EEE)=0 F  S EE=$O(PSOICD(EE)) Q:EE=""  D
"RTN","PSOHLNEW",141,0)
 .S EEE=EEE+1,^PS(52.41,PENDING,"ICD",EEE,0)=PSOICD(EE)
"RTN","PSOHLNEW",142,0)
 .S ^PS(52.41,PENDING,"ICD",0)="^52.41311PA"_U_EEE_U_EEE
"RTN","PSOHLNEW",143,0)
 Q
"RTN","PSOHLNEW",144,0)
SPDFN S PDFN=$P($G(MSG(OO)),"|",4) Q
"RTN","PSOHLNEW",145,0)
KL K PSOPLC,PSOFFL,PSOSND
"RTN","PSOHLNEW",146,0)
 Q
"RTN","PSOHLNEW",147,0)
FILL ;
"RTN","PSOHLNEW",148,0)
 S (PSOFILNM,OR("PSOFILNM"))=$P($P(MSG(OO),"|",4),"^")
"RTN","PSOHLNEW",149,0)
 Q
"RTN","PSOHLSN1")
0^21^B86664066
"RTN","PSOHLSN1",1,0)
PSOHLSN1 ;BIR/RTR - Send order info to OERR from file 52 ;10/10/94
"RTN","PSOHLSN1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,10,24,27,55,46,71,101,99,121,139,157,181,143**;DEC 1997
"RTN","PSOHLSN1",3,0)
 ;Ref #50.606-DBIA 2174
"RTN","PSOHLSN1",4,0)
 ;#50.607-DBIA 2221
"RTN","PSOHLSN1",5,0)
 ;#50.7-DBIA 2223
"RTN","PSOHLSN1",6,0)
 ;#51.2-DBIA 2226
"RTN","PSOHLSN1",7,0)
 ;#50-DBIA 221
"RTN","PSOHLSN1",8,0)
 ;PSNDF-DBIA 2195
"RTN","PSOHLSN1",9,0)
 ;EN^PSSUTIL1-DBIA 3179
"RTN","PSOHLSN1",10,0)
 ;
"RTN","PSOHLSN1",11,0)
EN(PSRXIEN,STAT,PSSTAT,COMM,PSNOO) ;
"RTN","PSOHLSN1",12,0)
 N COUNT,DFN,J,LIMIT,NAME,NULLFLDS,PSDIEN,PSFLAG,PSND1,PSND2,PSND3,PRODUCT,UNIT,POIPTR,PSOHINST,PODOSE,PODOSENM,PSROUTE,RTNAME,SEGMENT,CCC,BBB,CSCOUNT,PPTR,MSG,PSOHSTRT,PSOHSTOP,PSOHISSD,PSORTLP,ZRXFLAG,RXE2FLAG,RXE2ONLY,PSODFN,EDUZ
"RTN","PSOHLSN1",13,0)
 N PSOCDDUZ,DA,FSIG,BSIG,PSHRX,PSHORX,PSNOOTX,ZPRE,PSOZSTAT,CCCX,PSOCPS,PSOICD
"RTN","PSOHLSN1",14,0)
 K FIELD
"RTN","PSOHLSN1",15,0)
 I $G(STAT)="" Q
"RTN","PSOHLSN1",16,0)
 I STAT="CR"!(STAT="DR")!(STAT="HR")!(STAT="OC")!(STAT="OD")!(STAT="OH")!(STAT="Z@")!(STAT="RP") S PSOZSTAT=STAT D DELP^PSOHLSN S STAT=PSOZSTAT G SKIP
"RTN","PSOHLSN1",17,0)
 I STAT="SC" I $G(PSSTAT)="ZE"!($G(PSSTAT)="HD")!($G(PSSTAT)="DC") S PSOZSTAT=STAT D DELP^PSOHLSN S STAT=PSOZSTAT
"RTN","PSOHLSN1",18,0)
SKIP ;
"RTN","PSOHLSN1",19,0)
 I $G(STAT)="SC",$G(PSSTAT)="ZE",$P($G(^PSRX(+$G(PSRXIEN),0)),"^",19)=2 Q
"RTN","PSOHLSN1",20,0)
 I $G(STAT)="RP" S STAT="OD",PSSTAT="RP"
"RTN","PSOHLSN1",21,0)
 S COUNT=0,NULLFLDS="F JJ=0:1:LIMIT S FIELD(JJ)="""""
"RTN","PSOHLSN1",22,0)
 I '$D(^PSRX(PSRXIEN,0)) Q
"RTN","PSOHLSN1",23,0)
 I STAT'="SN",STAT'="ZC",'$P($G(^PSRX(PSRXIEN,"OR1")),"^",2) Q
"RTN","PSOHLSN1",24,0)
 I $G(STAT)="SC",$G(PSSTAT)="ZE" S $P(^PSRX(PSRXIEN,0),"^",19)=2
"RTN","PSOHLSN1",25,0)
 D INIT
"RTN","PSOHLSN1",26,0)
 S COUNT=1,(ZRXFLAG,RXE2FLAG,RXE2ONLY)=0 D PID,PV1,ORC
"RTN","PSOHLSN1",27,0)
 I $G(STAT)="Z@" G NCM
"RTN","PSOHLSN1",28,0)
 I $G(STAT)="OK"!($G(STAT)="SN")!($G(STAT)="ZC")!($G(STAT)="XX")!($G(STAT)="SC")!($G(STAT)="RO") D RXO,RXE,RXR,ZRX,DG1,ZCL G NCM
"RTN","PSOHLSN1",29,0)
 I $G(STAT)="SC",$G(PSSTAT)="CM" D RXO,RXE,RXR,ZRX,DG1,ZCL
"RTN","PSOHLSN1",30,0)
 I '$G(RXE2FLAG) S RXE2ONLY=1 D RXE,SEGPARX^PSOHLSN
"RTN","PSOHLSN1",31,0)
 I '$G(ZRXFLAG) D ZRX
"RTN","PSOHLSN1",32,0)
NCM D SEND
"RTN","PSOHLSN1",33,0)
 K PSRXIEN Q
"RTN","PSOHLSN1",34,0)
INIT K ^UTILITY("DIQ1",$J),DIQ S DA=$P($$SITE^VASITE(),"^") I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOHINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIQ,DIC
"RTN","PSOHLSN1",35,0)
 S MSG(1)="MSH|^~\&|PHARMACY|"_$G(PSOHINST)_"|||||"_$S($G(PSOMSORR):"ORR",1:"ORM")
"RTN","PSOHLSN1",36,0)
 Q
"RTN","PSOHLSN1",37,0)
PID S LIMIT=5 X NULLFLDS
"RTN","PSOHLSN1",38,0)
 S DFN=+$P(^PSRX(PSRXIEN,0),"^",2) D DEM^VADPT S NAME=$G(VADM(1)) K VADM
"RTN","PSOHLSN1",39,0)
 S FIELD(0)="PID"
"RTN","PSOHLSN1",40,0)
 S FIELD(3)=DFN
"RTN","PSOHLSN1",41,0)
 S FIELD(5)=NAME
"RTN","PSOHLSN1",42,0)
 D SEG Q
"RTN","PSOHLSN1",43,0)
DG1 D DG1^PSOHLSN2
"RTN","PSOHLSN1",44,0)
 Q
"RTN","PSOHLSN1",45,0)
PV1 ;
"RTN","PSOHLSN1",46,0)
 S LIMIT=19 X NULLFLDS
"RTN","PSOHLSN1",47,0)
 S FIELD(0)="PV1"
"RTN","PSOHLSN1",48,0)
 S FIELD(2)="O"
"RTN","PSOHLSN1",49,0)
 S:$P(^PSRX(PSRXIEN,0),"^",5) FIELD(3)=$P(^(0),"^",5)
"RTN","PSOHLSN1",50,0)
 D SEG Q
"RTN","PSOHLSN1",51,0)
ORC ;
"RTN","PSOHLSN1",52,0)
 S LIMIT=15 X NULLFLDS
"RTN","PSOHLSN1",53,0)
 S FIELD(0)="ORC"
"RTN","PSOHLSN1",54,0)
 S FIELD(1)=$G(STAT)
"RTN","PSOHLSN1",55,0)
 I $G(STAT)'="SN",$G(STAT)'="ZC" S FIELD(2)=$P($G(^PSRX(PSRXIEN,"OR1")),"^",2)
"RTN","PSOHLSN1",56,0)
 S:FIELD(2)'="" FIELD(2)=FIELD(2)_$S($G(PLACERXX):";"_PLACERXX,1:"")_"^OR"
"RTN","PSOHLSN1",57,0)
 S FIELD(3)=PSRXIEN_"^PS"
"RTN","PSOHLSN1",58,0)
 S FIELD(5)=$G(PSSTAT)
"RTN","PSOHLSN1",59,0)
 I $G(STAT)="RO",$G(PSOROPCH)'="PATCH" S FIELD(5)="CM"
"RTN","PSOHLSN1",60,0)
 I $G(FIELD(5))="" I $G(STAT)="OR"!($G(STAT)="OE") S FIELD(5)="CM"
"RTN","PSOHLSN1",61,0)
 S X=$P($G(^PSRX(PSRXIEN,2)),"^") I X S FIELD(9)=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSN1",62,0)
 S EDUZ=$P($G(^PSRX(PSRXIEN,0)),"^",16) I EDUZ S FIELD(10)=EDUZ_"^"_$P($G(^VA(200,EDUZ,0)),"^")
"RTN","PSOHLSN1",63,0)
 I $G(PSOCANRC),$G(PSOCANRN)'="" I $G(STAT)="OD"!($G(STAT)="OC") S FIELD(12)=$G(PSOCANRC)_"^"_$G(PSOCANRN)
"RTN","PSOHLSN1",64,0)
 I '$G(FIELD(12)) S FIELD(12)=$P($G(^PSRX(PSRXIEN,0)),"^",4)_"^"_$P($G(^VA(200,+$P($G(^PSRX(PSRXIEN,0)),"^",4),0)),"^")
"RTN","PSOHLSN1",65,0)
 S PSOHISSD="",X=$P($G(^PSRX(PSRXIEN,0)),"^",13) I X S PSOHISSD=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSN1",66,0)
 S FIELD(15)=$G(PSOHISSD) K X
"RTN","PSOHLSN1",67,0)
 D SEG
"RTN","PSOHLSN1",68,0)
 I $G(COMM)'=""!($G(PSNOO)'="") D
"RTN","PSOHLSN1",69,0)
 .I $G(PSNOO)'="" D NOO
"RTN","PSOHLSN1",70,0)
 .I $L($G(COMM))+($L(MSG(COUNT)))+($L($G(PSNOOTX)))+($S($G(PSNOO)'="":11,1:5))<245 S MSG(COUNT)=MSG(COUNT)_"|"_$G(PSNOO)_"^"_$G(PSNOOTX)_"^"_$S($G(PSNOO)'="":"99ORN",1:"")_"^^"_$G(COMM)_"^" Q
"RTN","PSOHLSN1",71,0)
 .S MSG(COUNT,1)="|"_$G(PSNOO)_"^"_$G(PSNOOTX)_"^"_$S($G(PSNOO)'="":"99ORN",1:"")_"^^"_$G(COMM)_"^"
"RTN","PSOHLSN1",72,0)
 Q
"RTN","PSOHLSN1",73,0)
 ;
"RTN","PSOHLSN1",74,0)
RXO ;
"RTN","PSOHLSN1",75,0)
 S LIMIT=1 X NULLFLDS
"RTN","PSOHLSN1",76,0)
 S FIELD(0)="RXO"
"RTN","PSOHLSN1",77,0)
 S PPTR=+$P($G(^PSRX(PSRXIEN,"OR1")),"^")
"RTN","PSOHLSN1",78,0)
 S FIELD(1)=$S('PPTR:"^^^^^",1:"^^^"_PPTR_"^"_$P($G(^PS(50.7,PPTR,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")_"^99PSP")
"RTN","PSOHLSN1",79,0)
 D SEG Q
"RTN","PSOHLSN1",80,0)
 ;
"RTN","PSOHLSN1",81,0)
RXE ;
"RTN","PSOHLSN1",82,0)
 S RXE2FLAG=1
"RTN","PSOHLSN1",83,0)
 S LIMIT=$S('$G(RXE2ONLY):26,1:2) X NULLFLDS
"RTN","PSOHLSN1",84,0)
 S FIELD(0)="RXE"
"RTN","PSOHLSN1",85,0)
 S (PSOHSTRT,PSOHSTOP)="" S X=$P($G(^PSRX(PSRXIEN,2)),"^",2) I X S PSOHSTRT=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSN1",86,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOHLSN1",87,0)
 S X=$S($P($G(^PSRX(PSRXIEN,3)),"^",5):$P($G(^(3)),"^",5),$G(STAT)="OD"!($G(STAT)="OC"):$G(DT),$P($G(^(2)),"^",6):$P($G(^(2)),"^",6),1:$G(DT)) I X S PSOHSTOP=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSN1",88,0)
 K X N PSOMZT,MMZZ,MMZZT S MMZZT=1 F MMZZ=0:0 S MMZZ=$O(^PSRX(PSRXIEN,6,MMZZ)) Q:'MMZZ  D:$D(^(MMZZ,0))
"RTN","PSOHLSN1",89,0)
 .S FIELD(1,MMZZT)=$S($P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^",2):$P($G(^(0)),"^")_"&"_$P($G(^PS(50.607,+$P($G(^(0)),"^",3),0)),"^")_"&"_$P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^",2)_"&"_$P($G(^(0)),"^",4),1:"")_"^"_$P($G(^(0)),"^",8)
"RTN","PSOHLSN1",90,0)
 .I $P($G(FIELD(1,MMZZT)),"^")'="" F PSOMZT=1,3 I $E($P(FIELD(1,MMZZT),"&",PSOMZT),1)="." S $P(FIELD(1,MMZZT),"&",PSOMZT)="0"_$P(FIELD(1,MMZZT),"&",PSOMZT)
"RTN","PSOHLSN1",91,0)
 .S FIELD(1,MMZZT)=$G(FIELD(1,MMZZT))_"^"_$$DUR(PSRXIEN,MMZZ)_"^^^^^"_$S($P($G(FIELD(1,MMZZT)),"^")'="":$P($G(FIELD(1,MMZZT)),"&")_$P($G(FIELD(1,MMZZT)),"&",2),1:$P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^"))
"RTN","PSOHLSN1",92,0)
 .S FIELD(1,MMZZT)=$G(FIELD(1,MMZZT))_"^"_$P($G(^PSRX(PSRXIEN,6,MMZZ,0)),"^",6)
"RTN","PSOHLSN1",93,0)
 .I $O(^PSRX(PSRXIEN,6,MMZZ)) S FIELD(1,MMZZT)=$G(FIELD(1,MMZZT))_"~"
"RTN","PSOHLSN1",94,0)
 .S MMZZT=MMZZT+1
"RTN","PSOHLSN1",95,0)
 S $P(FIELD(1,1),"^",4)=$G(PSOHSTRT),$P(FIELD(1,1),"^",5)=$G(PSOHSTOP)
"RTN","PSOHLSN1",96,0)
 S PSFLAG=0,PSDIEN=+$P(^PSRX(PSRXIEN,0),"^",6),PSND1=$P($G(^PSDRUG(PSDIEN,"ND")),"^"),PSND2=$P($G(^("ND")),"^",2),PSND3=$P($G(^("ND")),"^",3) I PSND1,PSND3 S PSFLAG=1
"RTN","PSOHLSN1",97,0)
 S FIELD(2)=$S(PSFLAG:PSND1_"."_PSND3_"^"_PSND2_"^"_"99NDF",1:"^^")_"^"_PSDIEN_"^"_$P($G(^PSDRUG(PSDIEN,0)),"^")_"^"_"99PSD"
"RTN","PSOHLSN1",98,0)
 Q:$G(RXE2ONLY)
"RTN","PSOHLSN1",99,0)
 I PSFLAG D
"RTN","PSOHLSN1",100,0)
 .I $T(^PSNAPIS)]"" S PSOXN=$$DFSU^PSNAPIS(PSND1,PSND3) S FIELD(5)="^^^"_$P($G(PSOXN),"^",5)_"^"_$P($G(PSOXN),"^",6)_"^"_"99PSU" K PSOXN Q
"RTN","PSOHLSN1",101,0)
 .S PRODUCT=$G(^PSNDF(PSND1,5,PSND3,0)) S UNIT=$P($G(^PSNDF(PSND1,2,+$P(PRODUCT,"^",2),3,+$P(PRODUCT,"^",3),4,+$P(PRODUCT,"^",4),0)),"^")
"RTN","PSOHLSN1",102,0)
 .S FIELD(5)="^^^"_UNIT_"^"_$P($G(^PS(50.607,+UNIT,0)),"^")_"^"_"99PSU"
"RTN","PSOHLSN1",103,0)
 S POIPTR=$P($G(^PSRX(PSRXIEN,"OR1")),"^") I POIPTR S PODOSE=$P($G(^PS(50.7,POIPTR,0)),"^",2),PODOSENM=$P($G(^PS(50.606,+PODOSE,0)),"^")
"RTN","PSOHLSN1",104,0)
 I POIPTR S FIELD(6)="^^^"_$G(PODOSE)_"^"_$G(PODOSENM)_"^"_"99PSF"
"RTN","PSOHLSN1",105,0)
 S FIELD(10)=$P(^PSRX(PSRXIEN,0),"^",7)
"RTN","PSOHLSN1",106,0)
 S FIELD(12)=$P(^PSRX(PSRXIEN,0),"^",9)
"RTN","PSOHLSN1",107,0)
 S FIELD(14)=$P(^PSRX(PSRXIEN,0),"^",4)
"RTN","PSOHLSN1",108,0)
 S FIELD(15)=$P(^PSRX(PSRXIEN,0),"^")
"RTN","PSOHLSN1",109,0)
 S FIELD(22)=$P(^PSRX(PSRXIEN,0),"^",8)
"RTN","PSOHLSN1",110,0)
 K MMZZ S MMZZ=$$EN^PSSUTIL1(PSDIEN) S FIELD(25)=$S($E($P(MMZZ,"|"),1)=".":"0",1:"")_$P(MMZZ,"|"),FIELD(26)=$P(MMZZ,"|",2)
"RTN","PSOHLSN1",111,0)
 N PLIM,PVAR,PVAR1,SUBCOUNT D SEGPARX^PSOHLSN
"RTN","PSOHLSN1",112,0)
 ;
"RTN","PSOHLSN1",113,0)
 I $O(^PSRX(PSRXIEN,"PRC",0)) D
"RTN","PSOHLSN1",114,0)
 .S COUNT=COUNT+1,CCC=$O(^PSRX(PSRXIEN,"PRC",0))
"RTN","PSOHLSN1",115,0)
 .S MSG(COUNT)="NTE|6||"_$G(^PSRX(PSRXIEN,"PRC",CCC,0))
"RTN","PSOHLSN1",116,0)
 .S CSCOUNT=1 F CCC=CCC:0 S CCC=$O(^PSRX(PSRXIEN,"PRC",CCC)) Q:'CCC  S MSG(COUNT,CSCOUNT)=$G(^PSRX(PSRXIEN,"PRC",CCC,0)),CSCOUNT=CSCOUNT+1
"RTN","PSOHLSN1",117,0)
 I $O(^PSRX(PSRXIEN,"INS1",0)) D
"RTN","PSOHLSN1",118,0)
 .S COUNT=COUNT+1,CCC=$O(^PSRX(PSRXIEN,"INS1",0))
"RTN","PSOHLSN1",119,0)
 .S MSG(COUNT)="NTE|7|L|"_$G(^PSRX(PSRXIEN,"INS1",CCC,0))
"RTN","PSOHLSN1",120,0)
 .S CCCX=1 F CCC=CCC:0 S CCC=$O(^PSRX(PSRXIEN,"INS1",CCC,0)) Q:'CCC  I $D(^(0)) S MSG(COUNT,CCCX)=$G(^(0)) S CCCX=CCCX+1
"RTN","PSOHLSN1",121,0)
 S COUNT=COUNT+1
"RTN","PSOHLSN1",122,0)
 I $P($G(^PSRX(PSRXIEN,"SIG")),"^",2) D  Q
"RTN","PSOHLSN1",123,0)
 .D FSIG^PSOUTLA("R",PSRXIEN,238) S MSG(COUNT)="NTE|21||"_$S($G(FSIG(1))'="":$G(FSIG(1)),1:"No SIG available") I $O(FSIG(1)) F CCC=1:0 S CCC=$O(FSIG(CCC)) Q:'CCC  S MSG(COUNT,(CCC-1))=$G(FSIG(CCC))
"RTN","PSOHLSN1",124,0)
 I '$P($G(^PSRX(PSRXIEN,"SIG")),"^",2) D  Q
"RTN","PSOHLSN1",125,0)
 .D EN3^PSOUTLA1(PSRXIEN,238) S MSG(COUNT)="NTE|21||"_$S($G(BSIG(1))'="":$G(BSIG(1)),1:"No SIG available") I $O(BSIG(1)) F CCC=1:0 S CCC=$O(BSIG(CCC)) Q:'CCC  S MSG(COUNT,(CCC-1))=$G(BSIG(CCC))
"RTN","PSOHLSN1",126,0)
 Q
"RTN","PSOHLSN1",127,0)
 ;
"RTN","PSOHLSN1",128,0)
RXR ;
"RTN","PSOHLSN1",129,0)
 F PSORTLP=0:0 S PSORTLP=$O(^PSRX(PSRXIEN,6,PSORTLP)) Q:'PSORTLP  D
"RTN","PSOHLSN1",130,0)
 .S LIMIT=1 X NULLFLDS
"RTN","PSOHLSN1",131,0)
 .S FIELD(0)="RXR"
"RTN","PSOHLSN1",132,0)
 .S PSROUTE=$P($G(^PSRX(PSRXIEN,6,PSORTLP,0)),"^",7) I PSROUTE,$D(^PS(51.2,PSROUTE,0))  S RTNAME=$P(^PS(51.2,PSROUTE,0),"^")
"RTN","PSOHLSN1",133,0)
 .S FIELD(1)="^^^"_$G(PSROUTE)_"^"_$G(RTNAME)_"^"_"99PSR"
"RTN","PSOHLSN1",134,0)
 .D SEG
"RTN","PSOHLSN1",135,0)
 Q
"RTN","PSOHLSN1",136,0)
 ;
"RTN","PSOHLSN1",137,0)
ZCL D ZCL^PSOHLSN2
"RTN","PSOHLSN1",138,0)
 Q
"RTN","PSOHLSN1",139,0)
ZSC S PSOCPS=$$DT^PSOMLLDT S LIMIT=$S($G(PSOCPS):6,1:1) X NULLFLDS
"RTN","PSOHLSN1",140,0)
 S FIELD(0)="ZSC"
"RTN","PSOHLSN1",141,0)
 I '$G(PSOCPS) S FIELD(1)=$S($P($G(^PSRX(PSRXIEN,"IB")),"^"):"NSC",1:"SC")
"RTN","PSOHLSN1",142,0)
 I $G(PSOCPS) D
"RTN","PSOHLSN1",143,0)
 .S FIELD(1)=$P($G(^PSRX(PSRXIEN,"IBQ")),"^"),FIELD(2)=$P($G(^("IBQ")),"^",2),FIELD(3)=$P($G(^("IBQ")),"^",3),FIELD(4)=$P($G(^("IBQ")),"^",4),FIELD(5)=$P($G(^("IBQ")),"^",5),FIELD(6)=$P($G(^("IBQ")),"^",6),FIELD(7)=$P($G(^("IBQ")),"^",7)
"RTN","PSOHLSN1",144,0)
 D SEG Q
"RTN","PSOHLSN1",145,0)
ZRX ;
"RTN","PSOHLSN1",146,0)
 S ZRXFLAG=1
"RTN","PSOHLSN1",147,0)
 S LIMIT=6 X NULLFLDS
"RTN","PSOHLSN1",148,0)
 S FIELD(0)="ZRX"
"RTN","PSOHLSN1",149,0)
 S ZPRE=$P($G(^PSRX(PSRXIEN,"OR1")),"^",3) I ZPRE S FIELD(1)=$P($G(^PSRX(ZPRE,"OR1")),"^",2)
"RTN","PSOHLSN1",150,0)
 I '$G(FIELD(1)),$G(PSORDEDT) S FIELD(1)=$P($G(^PS(52.41,$G(PSORDEDT),0)),"^")
"RTN","PSOHLSN1",151,0)
 S FIELD(2)=$G(PSNOO)
"RTN","PSOHLSN1",152,0)
 I $G(STAT)="SN"!($G(STAT)="RO") S FIELD(3)=$S($G(STAT)="RO"!($G(PSOEDIT)):"E",$G(PSOOPT)=3:"R",1:"N")
"RTN","PSOHLSN1",153,0)
 S FIELD(4)=$P(^PSRX(PSRXIEN,0),"^",11)
"RTN","PSOHLSN1",154,0)
 S PSOCDDUZ=$S($G(PSOROPCH)="PATCH":$P($G(^PSRX(PSRXIEN,"OR1")),"^",5),$G(PSOHUIOR)&($P($G(^PSRX(PSRXIEN,"EXT")),"^")'=""):+$G(PSOCANRC),1:$G(DUZ))
"RTN","PSOHLSN1",155,0)
 I $G(PSOCDDUZ) S FIELD(5)=PSOCDDUZ_"^"_$P($G(^VA(200,PSOCDDUZ,0)),"^")_"^"_"99NP"
"RTN","PSOHLSN1",156,0)
 I $G(STAT)="ZD",$G(PSODISPP) S FIELD(6)="P"
"RTN","PSOHLSN1",157,0)
 D SEG Q
"RTN","PSOHLSN1",158,0)
SEG S SEGMENT="" F J=0:1:LIMIT S SEGMENT=$S(SEGMENT="":FIELD(J),1:SEGMENT_"|"_FIELD(J))
"RTN","PSOHLSN1",159,0)
 S COUNT=COUNT+1,MSG(COUNT)=SEGMENT
"RTN","PSOHLSN1",160,0)
 Q
"RTN","PSOHLSN1",161,0)
SEND D:$G(PSRXIEN)&($T(EN^PSOHDR)]"")&($G(PSOSSMES)'="CPRSUP")  K FIELD D MSG^XQOR("PS EVSEND OR",.MSG) Q
"RTN","PSOHLSN1",162,0)
 .I $G(STAT)="ZC"!($G(STAT)="UC")!($G(STAT)="UD")!($G(STAT)="UH")!($G(STAT)="UR")!($G(STAT)="DE")!($G(STAT)="ZD") Q
"RTN","PSOHLSN1",163,0)
 .I $G(STAT)="SC" I $G(PSSTAT)="ZZ"!($G(PSSTAT)="ZS")!($G(PSSTAT)="ZU") Q
"RTN","PSOHLSN1",164,0)
 .D EN^PSOHDR("PRES",PSRXIEN)
"RTN","PSOHLSN1",165,0)
 ;
"RTN","PSOHLSN1",166,0)
NOO ;
"RTN","PSOHLSN1",167,0)
 I $G(PSNOO)="" S PSNOOTX="" Q
"RTN","PSOHLSN1",168,0)
 S PSNOOTX=$S(PSNOO="W":"Written",PSNOO="V":"Verbal",PSNOO="P":"Telephoned",PSNOO="S":"Service Correction",PSNOO="X":"Rejected",PSNOO="D":"Duplicate",PSNOO="I":"Policy",PSNOO="E":"Physician Entered",PSNOO="A":"Auto DC",1:"") Q
"RTN","PSOHLSN1",169,0)
 Q
"RTN","PSOHLSN1",170,0)
 ;
"RTN","PSOHLSN1",171,0)
DUR(PSODX1,PSODX2) ;
"RTN","PSOHLSN1",172,0)
 N PSODX,PSODX4,PSODX5,PSODX6,PSODX7 S PSODX=$P($G(^PSRX(PSODX1,6,PSODX2,0)),"^",5)
"RTN","PSOHLSN1",173,0)
 I 'PSODX Q PSODX
"RTN","PSOHLSN1",174,0)
 S PSODX4=$L(PSODX),PSODX5=$E(PSODX,PSODX4)
"RTN","PSOHLSN1",175,0)
 S PSODX=$S(PSODX5?1A:PSODX,1:PSODX_"D")
"RTN","PSOHLSN1",176,0)
 S PSODX6=$L(PSODX)
"RTN","PSOHLSN1",177,0)
 S PSODX7=$E(PSODX,PSODX6)_$E(PSODX,1,(PSODX6-1))
"RTN","PSOHLSN1",178,0)
 Q PSODX7
"RTN","PSOHLSN1",179,0)
 Q
"RTN","PSOHLSN2")
0^22^B4070101
"RTN","PSOHLSN2",1,0)
PSOHLSN2 ;BIR/LE - Utilities for PSOHLSN1 ;02/27/04
"RTN","PSOHLSN2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143**;DEC 1997
"RTN","PSOHLSN2",3,0)
 ;
"RTN","PSOHLSN2",4,0)
DG1 ;this section builds both DG1 segments 
"RTN","PSOHLSN2",5,0)
 Q:'$D(^PSRX(PSRXIEN,"ICD",1,0))
"RTN","PSOHLSN2",6,0)
 N LP,DG,DXDESC,I
"RTN","PSOHLSN2",7,0)
 S LIMIT=4,FIELD(0)="DG1",FIELD(4)=""
"RTN","PSOHLSN2",8,0)
 ;I '$D(^PSRX(PSRXIEN,"ICD",1,0)) S FIELD(1)=1,FIELD(2)="",FIELD(3)="^^^^^" D SEG^PSOHLSN1 Q
"RTN","PSOHLSN2",9,0)
 I $P(^PSRX(PSRXIEN,"ICD",1,0),"^",1)="" Q  ;S FIELD(1)=1,FIELD(2)="",FIELD(3)="^^^^^" D SEG^PSOHLSN1 Q
"RTN","PSOHLSN2",10,0)
 F I=1:1:8 D
"RTN","PSOHLSN2",11,0)
 . Q:'$D(^PSRX(PSRXIEN,"ICD",I,0))
"RTN","PSOHLSN2",12,0)
 . S PSOICD="",PSOICD=^PSRX(PSRXIEN,"ICD",I,0) Q:$P(PSOICD,U,1)=""
"RTN","PSOHLSN2",13,0)
 . S (DG,DXDESC)=""
"RTN","PSOHLSN2",14,0)
 . I $P(PSOICD,U,1)'="" D
"RTN","PSOHLSN2",15,0)
 .. S DXDESC=$$GET1^DIQ(80,$P(PSOICD,U,1)_",",10),FIELD(1)=I,FIELD(2)=""
"RTN","PSOHLSN2",16,0)
 .. S FIELD(3)=$P(PSOICD,U,1)_U_DXDESC_U_"80"_U_$$GET1^DIQ(80,$P(PSOICD,U,1)_",",.01)_U_DXDESC_U_"ICD9"
"RTN","PSOHLSN2",17,0)
 .. D SEG^PSOHLSN1
"RTN","PSOHLSN2",18,0)
 K PSOICD("K")
"RTN","PSOHLSN2",19,0)
 Q
"RTN","PSOHLSN2",20,0)
ZCL N STOP,IBQ,ICD,I,JJJ,EI
"RTN","PSOHLSN2",21,0)
 S LIMIT=3,FIELD(0)="ZCL"
"RTN","PSOHLSN2",22,0)
 I '$D(^PSRX(PSRXIEN,"ICD"))&($D(^PSRX(PSRXIEN,"IBQ"))) D
"RTN","PSOHLSN2",23,0)
 . S FIELD(1)=1,FIELD(2)=3
"RTN","PSOHLSN2",24,0)
 . S IBQ="",IBQ=^PSRX(PSRXIEN,"IBQ")
"RTN","PSOHLSN2",25,0)
 . S FIELD(3)="^"_$P(IBQ,U,3)_"^"_$P(IBQ,U,4)_"^"_$P(IBQ,U,1)_"^"_$P(IBQ,U,5)_"^"_$P(IBQ,U,2)_"^"_$P(IBQ,U,6)_"^"_$P(IBQ,U,7)
"RTN","PSOHLSN2",26,0)
 . D SEG^PSOHLSN1
"RTN","PSOHLSN2",27,0)
 . S EI="",EI=^PSRX(PSRXIEN,"IBQ")
"RTN","PSOHLSN2",28,0)
 . F I=2,3,4,1,5,6 S FIELD(3)=$P(EI,U,I) S FIELD(1)=1,FIELD(2)=I D SEG^PSOHLSN1
"RTN","PSOHLSN2",29,0)
 E  F I=1:1:8 D
"RTN","PSOHLSN2",30,0)
 . Q:'$D(^PSRX(PSRXIEN,"ICD",I,0))
"RTN","PSOHLSN2",31,0)
 . S PSOICD=^PSRX(PSRXIEN,"ICD",I,0),ICD=$P(PSOICD,"^",1)
"RTN","PSOHLSN2",32,0)
 . Q:ICD=""&(I>1)
"RTN","PSOHLSN2",33,0)
 . F JJJ=2:1:8 S EI=$P(PSOICD,U,JJJ),FIELD(2)=JJJ-1 D
"RTN","PSOHLSN2",34,0)
 .. S FIELD(1)=$S(ICD="":1,1:I)
"RTN","PSOHLSN2",35,0)
 .. ;S FIELD(3)=$S(EI=1:EI,1:0)
"RTN","PSOHLSN2",36,0)
 .. S FIELD(3)=$S(EI=1:EI,EI=0:EI,1:"")
"RTN","PSOHLSN2",37,0)
 .. D SEG^PSOHLSN1
"RTN","PSOHLSN2",38,0)
 K PSOICD
"RTN","PSOHLSN2",39,0)
 Q
"RTN","PSOHLSNC")
0^23^B54609968
"RTN","PSOHLSNC",1,0)
PSOHLSNC ;BIR/RTR - Send CHCS message to CPRS ;07/03/02
"RTN","PSOHLSNC",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**111,157,143**;DEC 1997
"RTN","PSOHLSNC",3,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOHLSNC",4,0)
 ;External reference to ^PS(51.2 supported by DBIA 2226
"RTN","PSOHLSNC",5,0)
 ;External reference to ^PSDRUG( supported by DBIA 221
"RTN","PSOHLSNC",6,0)
 ;External reference to ^PS(50.607 supported by DBIA 2221
"RTN","PSOHLSNC",7,0)
 ;External reference to ^PS(50.606 supported by DBIA 2174
"RTN","PSOHLSNC",8,0)
 ;External reference to EN^PSSUTIL1 supported by DBIA 3179
"RTN","PSOHLSNC",9,0)
 ;
"RTN","PSOHLSNC",10,0)
 ;PSOPND=Internal number from 52.41
"RTN","PSOHLSNC",11,0)
 ;PSOPNDST=Order Control Code Status
"RTN","PSOHLSNC",12,0)
 ;PSOPNDPT=Pharmacy Status
"RTN","PSOHLSNC",13,0)
 ;
"RTN","PSOHLSNC",14,0)
EN(PSOPND,PSOPNDST,PSOPNDPT) ;
"RTN","PSOHLSNC",15,0)
 N MSG,PSOHLIP,PSOHLIPX,PSOHLIPC,PSOHLTTL,PSOHUTL,PSOHND,PSOHNDD,PSOHNDU,PSONFLD,PSOXFLD,PSOLIMIT,PSONJJ,PSOHJJ,PSOHCT,PSOSEGMT,PSOHENT,PSOHPRO,PSOHIM,PSOHPC,PSOHPCTX,PSOHRT,PSOHRTE,PSOHRTEN,PSOHRTX,Y,DA,DIQ,DR
"RTN","PSOHLSNC",16,0)
 I $G(PSOPND)=""!($G(PSOPNDST)="") Q
"RTN","PSOHLSNC",17,0)
 I '$D(^PS(52.41,+$G(PSOPND),0)) Q
"RTN","PSOHLSNC",18,0)
 S PSONFLD="F PSONJJ=0:1:PSOLIMIT S PSOXFLD(PSONJJ)="""""
"RTN","PSOHLSNC",19,0)
 S PSOHCT=1
"RTN","PSOHLSNC",20,0)
 D INIT^PSOHLSN
"RTN","PSOHLSNC",21,0)
 D PID,PV1,ORC,RXO,RXE,RXR,ZRX,DG1,ZCL
"RTN","PSOHLSNC",22,0)
 D MSG^XQOR("PS EVSEND OR",.MSG)
"RTN","PSOHLSNC",23,0)
 Q
"RTN","PSOHLSNC",24,0)
PID ;Build PID segment
"RTN","PSOHLSNC",25,0)
 S PSOLIMIT=5 X PSONFLD
"RTN","PSOHLSNC",26,0)
 ;What about this ICN number?
"RTN","PSOHLSNC",27,0)
 S PSOXFLD(0)="PID"
"RTN","PSOHLSNC",28,0)
 S PSOXFLD(3)=$P($G(^PS(52.41,PSOPND,0)),"^",2)
"RTN","PSOHLSNC",29,0)
 D SEG
"RTN","PSOHLSNC",30,0)
 Q
"RTN","PSOHLSNC",31,0)
PV1 ;Build PV1 segment
"RTN","PSOHLSNC",32,0)
 S PSOLIMIT=19 X PSONFLD
"RTN","PSOHLSNC",33,0)
 S PSOXFLD(0)="PV1"
"RTN","PSOHLSNC",34,0)
 S PSOXFLD(2)="O"
"RTN","PSOHLSNC",35,0)
 I $P($G(^PS(52.41,PSOPND,0)),"^",13) S PSOXFLD(3)=$P(^(0),"^",13)
"RTN","PSOHLSNC",36,0)
 D SEG
"RTN","PSOHLSNC",37,0)
 Q
"RTN","PSOHLSNC",38,0)
DG1 ;Build DG1 segment
"RTN","PSOHLSNC",39,0)
 ;future use; chcs does not send ICD-9 codes.
"RTN","PSOHLSNC",40,0)
 Q:'$D(^PS(52.41,PSOPND,"ICD"))
"RTN","PSOHLSNC",41,0)
 S PSOLIMIT=4 X PSONFLD
"RTN","PSOHLSNC",42,0)
 S PSOXFLD(0)="DG1"
"RTN","PSOHLSNC",43,0)
 N LP,VDG,FLAG,DXDESC,DG
"RTN","PSOHLSNC",44,0)
 S FLAG="",PSOXFLD(4)="",PSOXFLD(2)=""
"RTN","PSOHLSNC",45,0)
 F LP=1:1:8 Q:'$D(^PS(52.41,PSOPND,"ICD",LP,0))  D
"RTN","PSOHLSNC",46,0)
 . S VDG="",VDG=^PS(52.41,PSOPND,"ICD",LP,0) Q:$P(VDG,U,1)=""
"RTN","PSOHLSNC",47,0)
 . S (DG,DXDESC)=""
"RTN","PSOHLSNC",48,0)
 . S DXDESC=$$GET1^DIQ(80,$P(VDG,U,1)_",",10),PSOXFLD(1)=LP
"RTN","PSOHLSNC",49,0)
 . S PSOXFLD(3)=$P(VDG,U,1)_U_DXDESC_U_"80"_U_$$GET1^DIQ(80,$P(VDG,U,1)_",",.01)_U_DXDESC_U_"ICD9"
"RTN","PSOHLSNC",50,0)
 . D SEG
"RTN","PSOHLSNC",51,0)
 Q
"RTN","PSOHLSNC",52,0)
ORC ;Build ORC segment
"RTN","PSOHLSNC",53,0)
 S PSOLIMIT=15 X PSONFLD
"RTN","PSOHLSNC",54,0)
 S PSOXFLD(0)="ORC"
"RTN","PSOHLSNC",55,0)
 S PSOXFLD(1)=$G(PSOPNDST)
"RTN","PSOHLSNC",56,0)
 S PSOXFLD(3)=PSOPND_"S^PS"
"RTN","PSOHLSNC",57,0)
 S PSOXFLD(5)=$G(PSOPNDPT)
"RTN","PSOHLSNC",58,0)
 S X=$P($G(^PS(52.41,PSOPND,0)),"^",6) I X S PSOXFLD(9)=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSNC",59,0)
 S PSOHENT=$P($G(^PS(52.41,PSOPND,0)),"^",4) I PSOHENT K ^UTILITY("DIQ1",$J) S DIC=200,DR=.01,DA=PSOHENT,DIQ(0)="E" D EN^DIQ1 S PSOXFLD(10)=PSOHENT_"^"_$P($G(^UTILITY("DIQ1",$J,200,PSOHENT,.01,"E")),"^")
"RTN","PSOHLSNC",60,0)
 S PSOHPRO=$P($G(^PS(52.41,PSOPND,0)),"^",5) I PSOHPRO K ^UTILITY("DIQ1",$J) S DIC=200,DR=.01,DA=PSOHPRO,DIQ(0)="E" D EN^DIQ1 S PSOXFLD(12)=PSOHPRO_"^"_$P($G(^UTILITY("DIQ1",$J,200,PSOHPRO,.01,"E")),"^")
"RTN","PSOHLSNC",61,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PSOHLSNC",62,0)
 S X=$P($G(^PS(52.41,PSOPND,0)),"^",12) I X S PSOXFLD(15)=$$FMTHL7^XLFDT(X)
"RTN","PSOHLSNC",63,0)
 D SEG
"RTN","PSOHLSNC",64,0)
 Q
"RTN","PSOHLSNC",65,0)
RXO ;Build RXO segment
"RTN","PSOHLSNC",66,0)
 S PSOLIMIT=1 X PSONFLD
"RTN","PSOHLSNC",67,0)
 S PSOXFLD(0)="RXO"
"RTN","PSOHLSNC",68,0)
 S PSOHITM=$P($G(^PS(52.41,PSOPND,0)),"^",8)
"RTN","PSOHLSNC",69,0)
 S PSOXFLD(1)=$S($G(PSOHITM):"^^^"_PSOHITM_"^"_$P($G(^PS(50.7,+$G(PSOHITM),0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")_"^99PSP",1:"^^^^^")
"RTN","PSOHLSNC",70,0)
 D SEG
"RTN","PSOHLSNC",71,0)
 Q
"RTN","PSOHLSNC",72,0)
RXE ;Build RXE segment
"RTN","PSOHLSNC",73,0)
 K PSOXFLD S PSOLIMIT=26 X PSONFLD
"RTN","PSOHLSNC",74,0)
 S PSOXFLD(0)="RXE"
"RTN","PSOHLSNC",75,0)
 ;No Quantity Timing, since the Sig is entered as free text
"RTN","PSOHLSNC",76,0)
 S PSOHNDD=$P($G(^PS(52.41,PSOPND,0)),"^",9)
"RTN","PSOHLSNC",77,0)
 S PSOHND="" I PSOHNDD S PSOHND=$G(^PSDRUG(PSOHNDD,"ND"))
"RTN","PSOHLSNC",78,0)
 S PSOXFLD(2)=$S($P(PSOHND,"^")&($P(PSOHND,"^",3)):$P(PSOHND,"^")_"."_$P(PSOHND,"^",3)_"^"_$P(PSOHND,"^",2)_"^"_"99NDF",1:"^^")_"^"_$G(PSOHNDD)_"^"_$S($G(PSOHNDD):$P($G(^PSDRUG(PSOHNDD,0)),"^"),1:"")_"^"_"99PSD"
"RTN","PSOHLSNC",79,0)
 I $P(PSOHND,"^"),$P(PSOHND,"^",3) D
"RTN","PSOHLSNC",80,0)
 .I $T(^PSNAPIS)]"" S PSOHNDU=$$DFSU^PSNAPIS($P(PSOHND,"^"),$P(PSOHND,"^",3)) S PSOXFLD(5)="^^^"_$P($G(PSOHNDU),"^",5)_"^"_$P($G(PSOHNDU),"^",6)_"^"_"99PSU"
"RTN","PSOHLSNC",81,0)
 I $G(PSOHITM) S PSOXFLD(6)="^^^"_$P($G(^PS(50.7,$G(PSOHITM),0)),"^",2)_"^"_$P($G(^PS(50.606,+$P($G(^PS(50.7,$G(PSOHITM),0)),"^",2),0)),"^")_"^"_"99PSF"
"RTN","PSOHLSNC",82,0)
 S PSOXFLD(10)=$P(^PS(52.41,PSOPND,0),"^",10)
"RTN","PSOHLSNC",83,0)
 S PSOXFLD(12)=$P(^PS(52.41,PSOPND,0),"^",11)
"RTN","PSOHLSNC",84,0)
 S PSOXFLD(22)=$P(^PS(52.41,PSOPND,0),"^",22)
"RTN","PSOHLSNC",85,0)
 I $G(PSOHNDD) S PSOHUTL=$$EN^PSSUTIL1(PSOHNDD) S PSOXFLD(25)=$S($E($P(PSOHUTL,"|"),1)=".":"0",1:"")_$P(PSOHUTL,"|"),PSOXFLD(26)=$P(PSOHUTL,"|",2)
"RTN","PSOHLSNC",86,0)
 ;Create RXE segment, can possibly go over 245 in length
"RTN","PSOHLSNC",87,0)
 S PSOHCT=PSOHCT+1
"RTN","PSOHLSNC",88,0)
 S (PSOHLIPX,PSOHLIPC,PSOHLTTL)=0,PSOHLIP="" F  S PSOHLIP=$O(PSOXFLD(PSOHLIP)) Q:PSOHLIP=""  D
"RTN","PSOHLSNC",89,0)
 .I PSOHLIP S PSOXFLD(PSOHLIP)="|"_PSOXFLD(PSOHLIP)
"RTN","PSOHLSNC",90,0)
 .I PSOHLTTL+$L(PSOXFLD(PSOHLIP))<246 D  S PSOHLTTL=PSOHLTTL+$L(PSOXFLD(PSOHLIP)) Q
"RTN","PSOHLSNC",91,0)
 ..I 'PSOHLIPX S MSG(PSOHCT)=$G(MSG(PSOHCT))_PSOXFLD(PSOHLIP) Q
"RTN","PSOHLSNC",92,0)
 ..S MSG(PSOHCT,PSOHLIPX)=$G(MSG(PSOHCT,PSOHLIPX))_PSOXFLD(PSOHLIP)
"RTN","PSOHLSNC",93,0)
 .S PSOHLICP=245-PSOHLTTL
"RTN","PSOHLSNC",94,0)
 .I 'PSOHLIPX D  S PSOHLTTL=$L(MSG(PSOHCT,PSOHLIPX)) Q
"RTN","PSOHLSNC",95,0)
 ..S MSG(PSOHCT)=$G(MSG(PSOHCT))_$E(PSOXFLD(PSOHLIP),1,PSOHLICP)
"RTN","PSOHLSNC",96,0)
 ..S PSOHLIPX=1,MSG(PSOHCT,PSOHLIPX)=$E(PSOXFLD(PSOHLIP),(PSOHLICP+1),999)
"RTN","PSOHLSNC",97,0)
 .S MSG(PSOHCT,PSOHLIPX)=$G(MSG(PSOHCT,PSOHLIPX))_$E(PSOXFLD(PSOHLIP),1,PSOHLICP)
"RTN","PSOHLSNC",98,0)
 .S PSOHLIPX=PSOHLIPX+1,MSG(PSOHCT,PSOHLIPX)=$E(PSOXFLD(PSOHLIP),(PSOHLICP+1),999)
"RTN","PSOHLSNC",99,0)
 .S PSOHLTTL=$L(MSG(PSOHCT,PSOHLIPX))
"RTN","PSOHLSNC",100,0)
 ;Set NTE segments
"RTN","PSOHLSNC",101,0)
 S PSOHPCT=0,PSOHCT=PSOHCT+1 I $O(^PS(52.41,PSOPND,3,0)) F PSOHPC=0:0 S PSOHPC=$O(^PS(52.41,PSOPND,3,PSOHPC)) Q:'PSOHPC  D
"RTN","PSOHLSNC",102,0)
 .I $G(^PS(52.41,PSOPND,3,PSOHPC,0))="" Q
"RTN","PSOHLSNC",103,0)
 .I 'PSOHPCT S MSG(PSOHCT)="NTE|6||"_$G(^PS(52.41,PSOPND,3,PSOHPC,0)) S PSOHPCT=1 Q
"RTN","PSOHLSNC",104,0)
 .S MSG(PSOHCT,PSOHPCT)=$G(^PS(52.41,PSOPND,3,PSOHPC,0)),PSOHPCT=PSOHPCT+1
"RTN","PSOHLSNC",105,0)
 I 'PSOHPCT S PSOHCT=PSOHCT-1
"RTN","PSOHLSNC",106,0)
 S PSOHCT=PSOHCT+1,PSOHPCT=0 I $O(^PS(52.41,PSOPND,"SIG",0)) F PSOHPC=0:0 S PSOHPC=$O(^PS(52.41,PSOPND,"SIG",PSOHPC)) Q:'PSOHPC  D
"RTN","PSOHLSNC",107,0)
 .I $G(^PS(52.41,PSOPND,"SIG",PSOHPC,0))="" Q
"RTN","PSOHLSNC",108,0)
 .I 'PSOHPCT S MSG(PSOHCT)="NTE|21||"_$G(^PS(52.41,PSOPND,"SIG",PSOHPC,0)) S PSOHPCT=1 Q
"RTN","PSOHLSNC",109,0)
 .S MSG(PSOHCT,PSOHPCT)=$G(^PS(52.41,PSOPND,"SIG",PSOHPC,0)),PSOHPCT=PSOHPCT+1
"RTN","PSOHLSNC",110,0)
 I 'PSOHPCT S MSG(PSOHCT)="NTE|21||"_"No SIG available"
"RTN","PSOHLSNC",111,0)
 Q
"RTN","PSOHLSNC",112,0)
RXR ;Build RXR segment
"RTN","PSOHLSNC",113,0)
 S PSOHRTX="" F PSOHRT=0:0 S PSOHRT=$O(^PS(52.41,PSOPND,1,PSOHRT)) Q:'PSOHRT  D
"RTN","PSOHLSNC",114,0)
 .S PSOHRTX=1
"RTN","PSOHLSNC",115,0)
 .S PSOLIMIT=1 X PSONFLD
"RTN","PSOHLSNC",116,0)
 .S PSOXFLD(0)="RXR"
"RTN","PSOHLSNC",117,0)
 .S PSOHRTEN=""
"RTN","PSOHLSNC",118,0)
 .S PSOHRTE=$P($G(^PS(52.41,PSOPND,1,PSOHRT,1)),"^",8) I PSOHRTE,$D(^PS(51.2,PSOHRTE,0)) S PSOHRTEN=$P($G(^(0)),"^")
"RTN","PSOHLSNC",119,0)
 .S PSOXFLD(1)="^^^"_$G(PSOHRTE)_"^"_$G(PSOHRTEN)_"^"_"99PSR"
"RTN","PSOHLSNC",120,0)
 .D SEG
"RTN","PSOHLSNC",121,0)
 I '$G(PSOHRTX) S PSOLIMIT=1 X PSONFLD S PSOXFLD(0)="RXR",PSOXFLD(1)="^^^^^99PSR" D SEG
"RTN","PSOHLSNC",122,0)
 Q
"RTN","PSOHLSNC",123,0)
ZRX ;Build ZRX segment
"RTN","PSOHLSNC",124,0)
 S PSOLIMIT=6 X PSONFLD
"RTN","PSOHLSNC",125,0)
 S PSOXFLD(0)="ZRX"
"RTN","PSOHLSNC",126,0)
 S PSOXFLD(3)="N"
"RTN","PSOHLSNC",127,0)
 S PSOXFLD(4)=$P($G(^PS(52.41,PSOPND,0)),"^",17)
"RTN","PSOHLSNC",128,0)
 D SEG
"RTN","PSOHLSNC",129,0)
 Q
"RTN","PSOHLSNC",130,0)
ZCL ;Build ZCL segment
"RTN","PSOHLSNC",131,0)
 N I,JJJ,INODE,EI
"RTN","PSOHLSNC",132,0)
 S PSOXFLD(0)="ZCL",PSOLIMIT=3 X PSONFLD
"RTN","PSOHLSNC",133,0)
 I $D(^PS(52.41,PSOPND,"ICD")) D
"RTN","PSOHLSNC",134,0)
 .F I=1:1:8 D
"RTN","PSOHLSNC",135,0)
 ..Q:'$D(^PS(52.41,PSOPND,"ICD",I,0))
"RTN","PSOHLSNC",136,0)
 ..S INODE="",INODE=^PS(52.41,PSOPND,"ICD",I,0)
"RTN","PSOHLSNC",137,0)
 ..F JJJ=2:1:8 S EI=$P(INODE,U,JJJ) D
"RTN","PSOHLSNC",138,0)
 ...S PSOXFLD(1)=I,PSOXFLD(2)=JJJ-1,PSOXFLD(3)=EI
"RTN","PSOHLSNC",139,0)
 ...;I JJJ=4 S EI=$S(EI=1:"SC",EI=0:"NSC",1:"") S PSOXFLD(3)=EI
"RTN","PSOHLSNC",140,0)
 ...D SEG
"RTN","PSOHLSNC",141,0)
 E  D  ;if no ICD node, send one ZCL segment
"RTN","PSOHLSNC",142,0)
 .S PSOXFLD(0)="ZCL",PSOXFLD(1)=1,PSOXFLD(2)=3
"RTN","PSOHLSNC",143,0)
 .S PSOXFLD(3)=$S($P(^PS(52.41,PSOPND,0),"^",16)="SC":1,$P(^(0),"^",16)="NSC":0,1:"")
"RTN","PSOHLSNC",144,0)
 .D SEG
"RTN","PSOHLSNC",145,0)
 .Q:'$D(^PS(52.41,PSOPND,"IBQ"))
"RTN","PSOHLSNC",146,0)
 .S EI=^PS(52.41,PSOPND,"IBQ")
"RTN","PSOHLSNC",147,0)
 .F I=2,3,4,1,5,6 S PSOXFLD(3)=$P(EI,U,I) D
"RTN","PSOHLSNC",148,0)
 .. S PSOXFLD(2)=$S(I=2:1,I=3:2,I=4:4,I=1:5,I=5:6,I=6:7,1:"") D SEG
"RTN","PSOHLSNC",149,0)
 Q
"RTN","PSOHLSNC",150,0)
ZSC ;Build ZSC segment
"RTN","PSOHLSNC",151,0)
 S PSOLIMIT=6 X PSONFLD
"RTN","PSOHLSNC",152,0)
 S PSOXFLD(0)="ZSC"
"RTN","PSOHLSNC",153,0)
 S PSOXFLD(1)=$S($P(^PS(52.41,PSOPND,0),"^",16)="SC":1,$P(^(0),"^",16)="NSC":0,1:"")
"RTN","PSOHLSNC",154,0)
 S PSOXFLD(2)=$P($G(^PS(52.41,PSOPND,"IBQ")),"^"),PSOXFLD(3)=$P($G(^("IBQ")),"^",2),PSOXFLD(4)=$P($G(^("IBQ")),"^",3),PSOXFLD(5)=$P($G(^("IBQ")),"^",4),PSOXFLD(6)=$P($G(^("IBQ")),"^",5),PSOXFLD(7)=$P($G(^("IBQ")),"^",6)
"RTN","PSOHLSNC",155,0)
 D SEG
"RTN","PSOHLSNC",156,0)
 Q
"RTN","PSOHLSNC",157,0)
SEG ;
"RTN","PSOHLSNC",158,0)
 S PSOSEGMT="" F PSOHJJ=0:1:PSOLIMIT S PSOSEGMT=$S(PSOSEGMT="":PSOXFLD(PSOHJJ),1:PSOSEGMT_"|"_PSOXFLD(PSOHJJ))
"RTN","PSOHLSNC",159,0)
 S PSOHCT=PSOHCT+1,MSG(PSOHCT)=PSOSEGMT
"RTN","PSOHLSNC",160,0)
 Q
"RTN","PSOMLLD2")
0^52^B18143810
"RTN","PSOMLLD2",1,0)
PSOMLLD2 ;BIR/LE - Service Connection Check for SC>50% ;02/27/04
"RTN","PSOMLLD2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143**;DEC 1997
"RTN","PSOMLLD2",3,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSOMLLD2",4,0)
 ;External reference SDC022 supported by DBIA 1579
"RTN","PSOMLLD2",5,0)
 ;External reference DIS^SDROUT2 private by DBIA 112
"RTN","PSOMLLD2",6,0)
SC ;SC>50% OUTSIDE OF COPAY
"RTN","PSOMLLD2",7,0)
 I $G(PSODFN)&(PSOSCP="") S DFN=PSODFN D ELIG^VADPT Q:$P(VAEL(3),U,1)'=1  G SC2  ;ask sc quest same as legacy copay;ask if sc is flagged yes even though percentage is null
"RTN","PSOMLLD2",8,0)
 I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) S DFN=PSODFN D ELIG^VADPT Q:$P(VAEL(3),U,1)'=1  G SC2  ;ask quest same as legacy copay; ask if SC<50 and copay is exempt.
"RTN","PSOMLLD2",9,0)
 I $G(PSODFN) I '$$SC^SDCO22(PSODFN) D  Q  ;if SC>49 don't ask if api says not to
"RTN","PSOMLLD2",10,0)
 . K PSOANSQ("SC>50"),PSOANSQD("SC>50") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"SC>50")
"RTN","PSOMLLD2",11,0)
SC2 K VAEL S DFN=+$G(PSODFN) D DIS^SDROUT2
"RTN","PSOMLLD2",12,0)
 N PSOUFLAG S PSOUFLAG=0 K DIR S DIR(0)="Y"
"RTN","PSOMLLD2",13,0)
 S DIR("A")="Was treatment for a Service Connected condition"
"RTN","PSOMLLD2",14,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Service Connected."
"RTN","PSOMLLD2",15,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLD2",16,0)
 . I PSOSCP<50 S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",17,0)
 . I PSOSCP<50&($D(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=1:"YES",1:"") I DIR("B")=""  K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",18,0)
 . I PSOSCP>49 S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"SC>50"))=1:"YES",1:"") I DIR("B")=""  K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",19,0)
 . I '$D(DIR("B"))&($D(PSOANSQD("SC>50"))!($D(PSOANSQD("SC")))) D  I '$D(DIR("B")) K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLD2",20,0)
 .. I $D(PSOANSQD("SC>50")) I $G(PSOANSQD("SC>50"))=0!($G(PSOANSQD("SC>50"))=1) S (PSOUFLAG,DIR("B"))=$S($G(PSOANSQD("SC>50"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",21,0)
 .. I $D(PSOANSQD("SC")) I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) S (PSOUFLAG,DIR("B"))=$S($G(PSOANSQD("SC"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",22,0)
 ;
"RTN","PSOMLLD2",23,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("SC>50"))=0!($G(PSOANSQD("SC>50"))=1) S DIR("B")=$S($G(PSOANSQD("SC>50"))=1:"YES",1:"NO")
"RTN","PSOMLLD2",24,0)
 I $G(DIR("B"))="YES"!($G(DIR("B"))="NO") S PSOUFLAG=$G(DIR("B"))
"RTN","PSOMLLD2",25,0)
 I $G(DIR("B"))="" K DIR("B")
"RTN","PSOMLLD2",26,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLD2",27,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLD2",28,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLD2",29,0)
 .S PSOANSQ("SC>50")=Y I $G(PSONEWFF) S PSOANSQD("SC>50")=Y
"RTN","PSOMLLD2",30,0)
 I $G(Y)=1!($G(Y)=0) S PSOANSQ("SC>50")=$G(Y) I $G(PSONEWFF),$G(PSOFLAG) S PSOANSQD("SC>50")=$G(Y)
"RTN","PSOMLLD2",31,0)
 S PSOANSR=+Y I 'PSOANSR,'PSOFLAG D  S $P(PSOCPAY,"^")=$S($G(PSOUFLAG)="N":1,1:0) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSOMLLD2",32,0)
 .W !!,"This Renewal has been designated as "_$S($G(PSOUFLAG)="Y":"SERVICE CONNECTED",1:"NON-SERVICE CONNECTED.")
"RTN","PSOMLLD2",33,0)
 .W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make  corrections."
"RTN","PSOMLLD2",34,0)
 .S PSOANSQ("SC>50")=$S($G(PSOUFLAG)="Y":1,1:0)
"RTN","PSOMLLD2",35,0)
 S PSOANSR=+Y I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"SC>50")=+Y
"RTN","PSOMLLD2",36,0)
 E  S PSOANSQ("SC>50")=+Y
"RTN","PSOMLLD2",37,0)
 Q
"RTN","PSOMLLD2",38,0)
 ;
"RTN","PSOMLLD2",39,0)
PAUSE K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOMLLD2",40,0)
 Q
"RTN","PSOMLLD2",41,0)
 ;
"RTN","PSOMLLD2",42,0)
MESS W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make corrections.",!
"RTN","PSOMLLD2",43,0)
 Q
"RTN","PSOMLLD2",44,0)
 ;
"RTN","PSOMLLD2",45,0)
MESSM W " Please use the 'Reset Copay Status/Cancel Charges' option",!,"to make corrections.",!
"RTN","PSOMLLD2",46,0)
 Q
"RTN","PSOMLLD2",47,0)
 ;
"RTN","PSOMLLD2",48,0)
MESSV W " Please use the 'Reset Copay Status/Cancel",!,"Charges' option to make corrections.",!
"RTN","PSOMLLD2",49,0)
 Q
"RTN","PSOMLLDT")
0^43^B85011495
"RTN","PSOMLLDT",1,0)
PSOMLLDT ;BIR/RTR - Copay date routine ;08/24/01
"RTN","PSOMLLDT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143**;DEC 1997
"RTN","PSOMLLDT",3,0)
 ;External reference SDC022 supported by DBIA 1579
"RTN","PSOMLLDT",4,0)
 ;External reference DGMSTAPI supported by DBIA2716
"RTN","PSOMLLDT",5,0)
 ;CIDC: Before doing EI question, check to see if should ask ei question 
"RTN","PSOMLLDT",6,0)
 ; because the flag could have changed in enrollment and we shouldn't
"RTN","PSOMLLDT",7,0)
 ; ask if not flagged and should set nulls for answer if Rx is renewed
"RTN","PSOMLLDT",8,0)
 ; or copied when flags changed.  Also, CPRS sometimes sends zeros for
"RTN","PSOMLLDT",9,0)
 ; null answers. 5/12/04
"RTN","PSOMLLDT",10,0)
DT() ;function for Copay date
"RTN","PSOMLLDT",11,0)
 ;0 means Copay not in effect, 1 means Copay in effect
"RTN","PSOMLLDT",12,0)
 N PSOMILDT
"RTN","PSOMLLDT",13,0)
 S PSOMILDT=3020101
"RTN","PSOMLLDT",14,0)
 I '$G(DT) S DT=$$DT^XLFDT
"RTN","PSOMLLDT",15,0)
 Q $S(DT<PSOMILDT:0,1:1)
"RTN","PSOMLLDT",16,0)
 ;
"RTN","PSOMLLDT",17,0)
 Q
"RTN","PSOMLLDT",18,0)
 ;New Copay questions, require if a Renewal
"RTN","PSOMLLDT",19,0)
 ;PSOFLAG=1 for New, PSOFLAG=0 for Renewal
"RTN","PSOMLLDT",20,0)
MST ;Military Sexual Trauma Question
"RTN","PSOMLLDT",21,0)
 I $G(PSODFN) I $P($$GETSTAT^DGMSTAPI(PSODFN),"^",2)'="Y" D  Q
"RTN","PSOMLLDT",22,0)
 . K PSOANSQ("MST"),PSOANSQD("MST") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"MST")
"RTN","PSOMLLDT",23,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",24,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",25,0)
 S DIR("A")="Was treatment related to Military Sexual Trauma"
"RTN","PSOMLLDT",26,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition related",DIR("?",2)="to Military Sexual Trauma. This response will be used to determine whether or"
"RTN","PSOMLLDT",27,0)
 S DIR("?",3)="not a copay should be applied to the prescription."
"RTN","PSOMLLDT",28,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"MST"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"MST"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",29,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("MST"))=0!($G(PSOANSQD("MST"))=1) S DIR("B")=$S($G(PSOANSQD("MST"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",30,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",31,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",32,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",33,0)
 .S PSOANSQ("MST")=Y
"RTN","PSOMLLDT",34,0)
 .I $G(PSONEWFF) S PSOANSQD("MST")=Y
"RTN","PSOMLLDT",35,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="Y":"",1:" NOT")_" being used for treatment of Military",!,"Sexual Trauma." D MESSM D PAUSE Q
"RTN","PSOMLLDT",36,0)
 .S PSOANSQ(PSOX("IRXN"),"MST")=$S($G(PSOUFLAG)="Y":1,1:0)
"RTN","PSOMLLDT",37,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"MST")=Y
"RTN","PSOMLLDT",38,0)
 E  S PSOANSQ("MST")=Y
"RTN","PSOMLLDT",39,0)
 Q
"RTN","PSOMLLDT",40,0)
VEH ;Vietnam-Era Herbicide Question
"RTN","PSOMLLDT",41,0)
 I $G(PSODFN) I '$$AO^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",42,0)
 . K PSOANSQ("VEH"),PSOANSQD("VEH") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"VEH")
"RTN","PSOMLLDT",43,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",44,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",45,0)
 S DIR("A")="Was treatment related to Agent Orange exposure"
"RTN","PSOMLLDT",46,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="Vietnam-Era Herbicide (Agent Orange) exposure. This response will be used to"
"RTN","PSOMLLDT",47,0)
 S DIR("?",3)="determine whether or not a copay should be applied to the prescription."
"RTN","PSOMLLDT",48,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"VEH"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"VEH"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",49,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("VEH"))=0!($G(PSOANSQD("VEH"))=1) S DIR("B")=$S($G(PSOANSQD("VEH"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",50,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",51,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",52,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",53,0)
 .S PSOANSQ("VEH")=Y
"RTN","PSOMLLDT",54,0)
 .I $G(PSONEWFF) S PSOANSQD("VEH")=Y
"RTN","PSOMLLDT",55,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="Y":"",1:" NOT")_" being used for treatment of Vietnam-Era",!,"Herbicide (Agent Orange) exposure." D MESSV D PAUSE Q
"RTN","PSOMLLDT",56,0)
 .S PSOANSQ(PSOX("IRXN"),"VEH")=$S($G(PSOUFLAG)="Y":1,1:0)
"RTN","PSOMLLDT",57,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"VEH")=Y
"RTN","PSOMLLDT",58,0)
 E  S PSOANSQ("VEH")=Y
"RTN","PSOMLLDT",59,0)
 Q
"RTN","PSOMLLDT",60,0)
RAD ;Radiation question
"RTN","PSOMLLDT",61,0)
 I $G(PSODFN) I '$$IR^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",62,0)
 . K PSOANSQ("RAD"),PSOANSQD("RAD") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"RAD")
"RTN","PSOMLLDT",63,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",64,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",65,0)
 S DIR("A")="Was treatment related to Ionizing Radiation exposure"
"RTN","PSOMLLDT",66,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="ionizing radiation exposure during military service. This response will be used"
"RTN","PSOMLLDT",67,0)
 S DIR("?",3)="to determine whether or not a copay should be applied to the prescription."
"RTN","PSOMLLDT",68,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"RAD"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"RAD"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",69,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("RAD"))=0!($G(PSOANSQD("RAD"))=1) S DIR("B")=$S($G(PSOANSQD("RAD"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",70,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",71,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",72,0)
 .I Y["^"!($D(DUOUT))!($G(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",73,0)
 .S PSOANSQ("RAD")=Y
"RTN","PSOMLLDT",74,0)
 .I $G(PSONEWFF) S PSOANSQD("RAD")=Y
"RTN","PSOMLLDT",75,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="Y":"",1:" NOT")_" being used for treatment of ionizing",!,"radiation exposure." D MESSM D PAUSE Q
"RTN","PSOMLLDT",76,0)
 .S PSOANSQ(PSOX("IRXN"),"RAD")=$S($G(PSOUFLAG)="Y":1,1:0)
"RTN","PSOMLLDT",77,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"RAD")=Y
"RTN","PSOMLLDT",78,0)
 E  S PSOANSQ("RAD")=Y
"RTN","PSOMLLDT",79,0)
 Q
"RTN","PSOMLLDT",80,0)
PGW ;Persian Gulf War question
"RTN","PSOMLLDT",81,0)
 I $G(PSODFN) I '$$EC^SDCO22(PSODFN) D  Q
"RTN","PSOMLLDT",82,0)
 . K PSOANSQ("PGW"),PSOANSQD("PGW") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"PGW")
"RTN","PSOMLLDT",83,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",84,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",85,0)
 S DIR("A")="Was treatment related to Environmental Contaminant exposure"
"RTN","PSOMLLDT",86,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to",DIR("?",2)="environmental contaminant exposure during the Persian Gulf War. This response"
"RTN","PSOMLLDT",87,0)
 S DIR("?",3)="will be used to determine whether or not a copay should be applied to the",DIR("?",4)="prescription."
"RTN","PSOMLLDT",88,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"PGW"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"PGW"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",89,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("PGW"))=0!($G(PSOANSQD("PGW"))=1) S DIR("B")=$S($G(PSOANSQD("PGW"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",90,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",91,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",92,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",93,0)
 .S PSOANSQ("PGW")=Y
"RTN","PSOMLLDT",94,0)
 .I $G(PSONEWFF) S PSOANSQD("PGW")=Y
"RTN","PSOMLLDT",95,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="Y":"",1:" NOT")_" being used for treatment of",!,"environmental contaminant exposure during the Persian Gulf War." D MESS D PAUSE Q
"RTN","PSOMLLDT",96,0)
 .S PSOANSQ(PSOX("IRXN"),"PGW")=$S($G(PSOUFLAG)="Y":1,1:0)
"RTN","PSOMLLDT",97,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"PGW")=Y
"RTN","PSOMLLDT",98,0)
 E  S PSOANSQ("PGW")=Y
"RTN","PSOMLLDT",99,0)
 Q
"RTN","PSOMLLDT",100,0)
HNC ;Head or Neck Cancer question
"RTN","PSOMLLDT",101,0)
 I $G(PSODFN) I $T(GETCUR^DGNTAPI)]"" N PSONCP,PSONCPX S PSONCPX=$$GETCUR^DGNTAPI(PSODFN,"PSONCP") I $P($G(PSONCP("IND")),"^")'="Y" D  Q
"RTN","PSOMLLDT",102,0)
 . K PSOANSQ("HNC"),PSOANSQD("HNC") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"HNC")
"RTN","PSOMLLDT",103,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",104,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",105,0)
 S DIR("A")="Was treatment related to Head and/or Neck Cancer"
"RTN","PSOMLLDT",106,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Yes' if this prescription is being used to treat Head and/or Neck Cancer",DIR("?",2)="due to nose or throat radium treatments while in the military. This response"
"RTN","PSOMLLDT",107,0)
 S DIR("?",3)="will be used to determine whether or not a copay should be applied to the",DIR("?",4)="prescription."
"RTN","PSOMLLDT",108,0)
 I '$G(PSOFLAG) S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"HNC"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"HNC"))=1:"YES",1:"") I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",109,0)
 I $G(PSOFLAG),$G(PSONEWFF) I $G(PSOANSQD("HNC"))=0!($G(PSOANSQD("HNC"))=1) S DIR("B")=$S($G(PSOANSQD("HNC"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",110,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",111,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",112,0)
 .I Y["^"!($D(DUOUT))!($D(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",113,0)
 .S PSOANSQ("HNC")=Y
"RTN","PSOMLLDT",114,0)
 .I $G(PSONEWFF) S PSOANSQD("HNC")=Y
"RTN","PSOMLLDT",115,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="Y":"",1:" NOT")_" being used for treatment related to",!,"Head and/or Neck Cancer." D MESSV D PAUSE Q
"RTN","PSOMLLDT",116,0)
 .S PSOANSQ(PSOX("IRXN"),"HNC")=$S($G(PSOUFLAG)="Y":1,1:0)
"RTN","PSOMLLDT",117,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"HNC")=Y
"RTN","PSOMLLDT",118,0)
 E  S PSOANSQ("HNC")=Y
"RTN","PSOMLLDT",119,0)
 Q
"RTN","PSOMLLDT",120,0)
CV ; Combat Veteran Question
"RTN","PSOMLLDT",121,0)
 I $G(PSODFN) I '(+$P($$CVEDT^DGCV(PSODFN),"^",3)) D  Q
"RTN","PSOMLLDT",122,0)
 . K PSOANSQ("CV"),PSOANSQD("CV") I $G(PSOX("IRXN")) K PSOANSQ(PSOX("IRXN"),"CV")
"RTN","PSOMLLDT",123,0)
 N PSOUFLAG S PSOUFLAG=0
"RTN","PSOMLLDT",124,0)
 K DIR S DIR(0)="Y"
"RTN","PSOMLLDT",125,0)
 S DIR("A")="Was treatment related to Combat"
"RTN","PSOMLLDT",126,0)
 S DIR("?")=" "
"RTN","PSOMLLDT",127,0)
 S DIR("?",1)="Enter 'Yes' if this prescription is being used to treat a condition due to"
"RTN","PSOMLLDT",128,0)
 S DIR("?",2)="active duty in a theater of combat operations during a period of war after the"
"RTN","PSOMLLDT",129,0)
 S DIR("?",3)="Gulf War. This response will be used to determine whether or not a copay should"
"RTN","PSOMLLDT",130,0)
 S DIR("?",4)="be applied to the prescription."
"RTN","PSOMLLDT",131,0)
 I '$G(PSOFLAG) D
"RTN","PSOMLLDT",132,0)
 .  S (DIR("B"),PSOUFLAG)=$S($G(PSORX(+$G(PSORENW("OIRXN")),"CV"))=0:"NO",$G(PSORX(+$G(PSORENW("OIRXN")),"CV"))=1:"YES",1:"")
"RTN","PSOMLLDT",133,0)
 .  I DIR("B")="" K DIR("B") S PSOUFLAG=0
"RTN","PSOMLLDT",134,0)
 I $G(PSOFLAG),$G(PSONEWFF) D
"RTN","PSOMLLDT",135,0)
 .  I $G(PSOANSQD("CV"))=0!($G(PSOANSQD("CV"))=1) D
"RTN","PSOMLLDT",136,0)
 .  .  S DIR("B")=$S($G(PSOANSQD("CV"))=1:"YES",1:"NO")
"RTN","PSOMLLDT",137,0)
 W ! D ^DIR K DIR
"RTN","PSOMLLDT",138,0)
 I $G(PSOFLAG) W ! D  Q
"RTN","PSOMLLDT",139,0)
 .  I Y["^"!($D(DUOUT))!($G(DTOUT)) S PSOCPZ("DFLG")=1 Q
"RTN","PSOMLLDT",140,0)
 .  S PSOANSQ("CV")=Y
"RTN","PSOMLLDT",141,0)
 .  I $G(PSONEWFF) S PSOANSQD("CV")=Y
"RTN","PSOMLLDT",142,0)
 I Y["^"!($D(DUOUT))!($D(DTOUT)) D
"RTN","PSOMLLDT",143,0)
 .  W !!,"This Renewal has been designated as"_$S($G(PSOUFLAG)="Y":"",1:" NOT")_" being used for treatment of military"
"RTN","PSOMLLDT",144,0)
 .  W !,"combat service." D MESSM D PAUSE Q
"RTN","PSOMLLDT",145,0)
 .  S PSOANSQ(PSOX("IRXN"),"CV")=$S($G(PSOUFLAG)="Y":1,1:0)
"RTN","PSOMLLDT",146,0)
 I $G(PSOX("IRXN")) S PSOANSQ(PSOX("IRXN"),"CV")=Y
"RTN","PSOMLLDT",147,0)
 E  S PSOANSQ("CV")=Y
"RTN","PSOMLLDT",148,0)
 Q
"RTN","PSOMLLDT",149,0)
PAUSE ;
"RTN","PSOMLLDT",150,0)
 K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOMLLDT",151,0)
 Q
"RTN","PSOMLLDT",152,0)
MESS ;
"RTN","PSOMLLDT",153,0)
 W !,"Please use the 'Reset Copay Status/Cancel Charges' option to make corrections.",!
"RTN","PSOMLLDT",154,0)
 Q
"RTN","PSOMLLDT",155,0)
MESSM ;
"RTN","PSOMLLDT",156,0)
 W " Please use the 'Reset Copay Status/Cancel Charges' option",!,"to make corrections.",!
"RTN","PSOMLLDT",157,0)
 Q
"RTN","PSOMLLDT",158,0)
MESSV ;
"RTN","PSOMLLDT",159,0)
 W " Please use the 'Reset Copay Status/Cancel",!,"Charges' option to make corrections.",!
"RTN","PSON52")
0^29^B58027930
"RTN","PSON52",1,0)
PSON52 ;BIR/DSD - files new entries in prescription file ;08/09/93
"RTN","PSON52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,16,23,27,32,46,71,111,124,117,131,139,157,143**;DEC 1997
"RTN","PSON52",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSON52",4,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSON52",5,0)
 ;External reference to ^XUSEC supported by DBIA 10076
"RTN","PSON52",6,0)
EN(PSOX) ;Entry Point
"RTN","PSON52",7,0)
START ;
"RTN","PSON52",8,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Monitor
"RTN","PSON52",9,0)
 D INIT G:PSON52("QFLG") END D NFILE Q:$G(PSONEW("DFLG"))  D PS55,DIK
"RTN","PSON52",10,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","PSON52",11,0)
 D FINISH
"RTN","PSON52",12,0)
 ;I $P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)'=1,$G(DUZ("AG"))="V" S PSOFLAG=1,DA=PSOX("IRXN") D COPAY^PSOCPB
"RTN","PSON52",13,0)
 I $P(^PSRX(PSOX("IRXN"),0),"^",11)="W",$G(^("IB")) S ^PSRX("ACP",$P(^PSRX(PSOX("IRXN"),0),"^",2),$P(^(2),"^",2),0,PSOX("IRXN"))=""
"RTN","PSON52",14,0)
END D EOJ
"RTN","PSON52",15,0)
 Q
"RTN","PSON52",16,0)
INIT ;
"RTN","PSON52",17,0)
 K X,%DT S:$G(PSOID) PSOX("ISSUE DATE")=PSOID
"RTN","PSON52",18,0)
 S PSOX("CS")=0
"RTN","PSON52",19,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S $P(PSOX("CS"),"^")=1 S:$E(+PSODRUG("DEA"),DEA)=2 $P(PSOX("CS"),"^",2)=1
"RTN","PSON52",20,0)
 S PSON52("QFLG")=0,X1=PSOX("ISSUE DATE"),X2=PSOX("DAYS SUPPLY")*(PSOX("# OF REFILLS")+1)\1
"RTN","PSON52",21,0)
 I $D(CLOZPAT) S X2=$S(X2=14:14,X2=7:7,1:X2) G DT
"RTN","PSON52",22,0)
 S X2=$S(PSOX("DAYS SUPPLY")=X2:X2,+$G(PSOX("CS")):184,+$G(DEA("CS")):184,1:366)
"RTN","PSON52",23,0)
 I X2<30 D
"RTN","PSON52",24,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSON52",25,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSON52",26,0)
DT D C^%DTC S PSOX("STOP DATE")=$P(X,".") K X
"RTN","PSON52",27,0)
 I PSOX("# OF REFILLS")>0 S X1=PSOX("FILL DATE"),X2=$S((PSOX("DAYS SUPPLY")-10\1)<1:1,1:PSOX("DAYS SUPPLY")-10\1) D C^%DTC S PSOX("NEXT POSSIBLE REFILL")=$P(X,".") K X
"RTN","PSON52",28,0)
 S PSOX("TYPE OF RX")=0,PSOX("DISPENSED DATE")=PSOX("FILL DATE") D NOW^%DTC S PSOX("LOGIN DATE")=$S($P($G(OR0),"^",12):$P($G(OR0),"^",12),1:%) K %,X
"RTN","PSON52",29,0)
 S PSOX("STATUS")=$S($G(PSOX("STATUS"))]"":PSOX("STATUS"),$D(PSORX("VERIFY")):1,1:0)
"RTN","PSON52",30,0)
 S PSOX("COPIES")=$S($G(PSOX("COPIES"))]"":PSOX("COPIES"),1:1)
"RTN","PSON52",31,0)
 I $G(PSORX("PHARM"))]"" S PSOX("PHARMACIST")=PSORX("PHARM") K PSORX("PHARM")
"RTN","PSON52",32,0)
INITX Q
"RTN","PSON52",33,0)
 ;
"RTN","PSON52",34,0)
NFILE I $G(OR0) D  Q:$G(PSONEW("DFLG"))
"RTN","PSON52",35,0)
 .D NOOR^PSONEW Q:$G(PSONEW("DFLG"))
"RTN","PSON52",36,0)
 .I $G(PSOSIGFL)!($G(PSODRUG("OI"))'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSONEW("REMARKS")=$G(PSONEW("REMARKS"))_" CPRS Order #"_$P(OR0,"^")_" Edited."
"RTN","PSON52",37,0)
 S DIC="^PSRX(",DLAYGO=52,DIC(0)="L",X=PSOX("RX #") K DD,DO D FILE^DICN S PSOX("IRXN")=+Y K DLAYGO,X,Y,DIC,DD,DO D:+$G(DGI) TECH^PSODGDGI
"RTN","PSON52",38,0)
 F PSOX1=0:1 S PSON52=$P($T(DD+PSOX1),";;",2,4) Q:PSON52=""  K PSOY S PSOY=$P(PSON52,";;") I $G(@PSOY)]"" S $P(PSON52(PSOX("IRXN"),$P(PSON52,";;",2)),"^",$P(PSON52,";;",3))=@PSOY
"RTN","PSON52",39,0)
 F I=1:1:PSOX("ENT") S ^PSRX(PSOX("IRXN"),6,I,0)=PSOX("DOSE",I)_"^"_$G(PSOX("DOSE ORDERED",I))_"^"_$G(PSOX("UNITS",I))_"^"_$G(PSOX("NOUN",I))_"^" D
"RTN","PSON52",40,0)
 .S ^PSRX(PSOX("IRXN"),6,I,0)=^PSRX(PSOX("IRXN"),6,I,0)_$G(PSOX("DURATION",I))_"^"_$G(PSOX("CONJUNCTION",I))_"^"_$G(PSOX("ROUTE",I))_"^"_$G(PSOX("SCHEDULE",I))_"^"_$G(PSOX("VERB",I))
"RTN","PSON52",41,0)
 .I $G(PSOX("ODOSE",I))]"" S ^PSRX(PSOX("IRXN"),6,I,1)=PSOX("ODOSE",I)
"RTN","PSON52",42,0)
 S ^PSRX(PSOX("IRXN"),6,0)="^52.0113^"_PSOX("ENT")_"^"_PSOX("ENT")
"RTN","PSON52",43,0)
 K PSOX1,PSOY
"RTN","PSON52",44,0)
 S PSOX1="" F  S PSOX1=$O(PSON52(PSOX("IRXN"),PSOX1)) Q:PSOX1=""  S ^PSRX(PSOX("IRXN"),PSOX1)=$G(PSON52(PSOX("IRXN"),PSOX1))
"RTN","PSON52",45,0)
 I $O(PSOX("SIG",0)) D
"RTN","PSON52",46,0)
 .S D=0 F  S D=$O(PSOX("SIG",D)) Q:'D  S ^PSRX(PSOX("IRXN"),"INS1",D,0)=PSOX("SIG",D),TP=$G(TP)+1
"RTN","PSON52",47,0)
 .S ^PSRX(PSOX("IRXN"),"INS1",0)="^52.0115^"_TP_"^"_TP_"^"_DT_"^^" K TP,D
"RTN","PSON52",48,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSON52",49,0)
 I $G(SIGOK) D
"RTN","PSON52",50,0)
 .S $P(^PSRX(PSOX("IRXN"),"SIG"),"^",2)=1,^PSRX(PSOX("IRXN"),"SIG1",0)="^52.04A^^"
"RTN","PSON52",51,0)
 .S D=0 F  S D=$O(SIG(D)) Q:'D  S ^PSRX(PSOX("IRXN"),"SIG1",D,0)=SIG(D),$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"SIG1",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1 Q:'$O(SIG(D))
"RTN","PSON52",52,0)
 .K SIG
"RTN","PSON52",53,0)
 I $D(PSOINSFL) S ^PSRX(PSOX("IRXN"),"A",0)="^52.3DA^1^1",^PSRX(PSOX("IRXN"),"A",1,0)=DT_"^G^^0^Patient Instructions "_$S(PSOINSFL=1:"",1:"Not ")_"Sent By Provider."
"RTN","PSON52",54,0)
 I $G(OR0) S:$P(OR0,"^",24) ^PSRX(PSOX("IRXN"),"PKI")=1
"RTN","PSON52",55,0)
 K PSOX1,PSOFINFL,HLDSIG,D,PSOINSFL,D
"RTN","PSON52",56,0)
 D:$G(^TMP("PSODAI",$J,0))
"RTN","PSON52",57,0)
 .S $P(^PSRX(PSOX("IRXN"),3),"^",6)=1
"RTN","PSON52",58,0)
 .I $O(^TMP("PSODAI",$J,0)) S DAI=0 F  S DAI=$O(^TMP("PSODAI",$J,DAI)) Q:'DAI  D
"RTN","PSON52",59,0)
 ..S:'$D(^PSRX(PSOX("IRXN"),"DAI",0)) ^PSRX(PSOX("IRXN"),"DAI",0)="^52.03^^" S ^PSRX(PSOX("IRXN"),"DAI",DAI,0)=^TMP("PSODAI",$J,DAI,0)
"RTN","PSON52",60,0)
 ..S $P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)=+$P(^PSRX(PSOX("IRXN"),"DAI",0),"^",3)+1,$P(^(0),"^",4)=+$P(^(0),"^",4)+1
"RTN","PSON52",61,0)
 .K ^TMP("PSODAI",$J),DAI
"RTN","PSON52",62,0)
 I $G(PSOX("CHCS NUMBER"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^")=$G(PSOX("CHCS NUMBER"))
"RTN","PSON52",63,0)
 I $G(PSOX("EXTERNAL SYSTEM"))'="" S $P(^PSRX(PSOX("IRXN"),"EXT"),"^",2)=$G(PSOX("EXTERNAL SYSTEM"))
"RTN","PSON52",64,0)
 I $G(PSOX("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=$G(PSOX("NEWCOPAY"))
"RTN","PSON52",65,0)
 ;Next line, set SC question based on Copay status?
"RTN","PSON52",66,0)
IBQ ;I $G(PSOBILL)=2 S ^PSRX(PSOX("IRXN"),"IBQ")=$S($G(PSOX("NEWCOPAY")):0,1:1)
"RTN","PSON52",67,0)
 I $G(PSOANSQ("SC"))'="" S ^PSRX(PSOX("IRXN"),"IBQ")=$G(PSOANSQ("SC"))
"RTN","PSON52",68,0)
 I $D(PSOANSQ)&(PSOSCP<50) D
"RTN","PSON52",69,0)
 . Q:PSOSCP=""  ;don't set if SC % is null, just set it in ICD node
"RTN","PSON52",70,0)
 . S ^PSRX(PSOX("IRXN"),"IBQ")=$S($D(^PSRX(PSOX("IRXN"),"IBQ")):$G(^PSRX(PSOX("IRXN"),"IBQ")),1:"")_"^"_$G(PSOANSQ("MST"))_"^"_$G(PSOANSQ("VEH"))_"^"_$G(PSOANSQ("RAD"))_"^"_$G(PSOANSQ("PGW"))_"^"_$G(PSOANSQ("HNC"))_"^"_$G(PSOANSQ("CV"))
"RTN","PSON52",71,0)
 E  S ^PSRX(PSOX("IRXN"),"IBQ")="^^^^^^^"
"RTN","PSON52",72,0)
 I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) S ^PSRX(PSOX("IRXN"),"IBQ")="^^^^^^^"
"RTN","PSON52",73,0)
 D ICD^PSODIAG
"RTN","PSON52",74,0)
 K PSOANSQ,PSOANSQD,PSOX("NEWCOPAY")
"RTN","PSON52",75,0)
 L -^PSRX("B",PSOX("IRXN"))
"RTN","PSON52",76,0)
 Q
"RTN","PSON52",77,0)
 ;
"RTN","PSON52",78,0)
PS55 ;
"RTN","PSON52",79,0)
 L +^PS(55,PSODFN,"P"):0
"RTN","PSON52",80,0)
 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSON52",81,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSON52",82,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSON52",83,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSON52",84,0)
 S ^PS(55,PSODFN,"P","A",PSONEW("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSON52",85,0)
PS55X L -^PS(55,PSODFN,"P")
"RTN","PSON52",86,0)
 K PSOX1
"RTN","PSON52",87,0)
 Q
"RTN","PSON52",88,0)
DIK ;
"RTN","PSON52",89,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSON52",90,0)
 K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSON52",91,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSON52",92,0)
 Q
"RTN","PSON52",93,0)
FINISH ;
"RTN","PSON52",94,0)
ANQ I $G(ANQDATA)]"" D NOW^%DTC G:$D(^PS(52.52,"B",%)) ANQ D
"RTN","PSON52",95,0)
 .K DD,DO S DIC="^PS(52.52,",DIC(0)="L",DLAYGO=52.52,X=% D FILE^DICN K DIC,DLAYGO,DD,DO
"RTN","PSON52",96,0)
 .S ^PS(52.52,+Y,0)=$P(Y,"^",2)_"^"_PSOX("IRXN")_"^"_ANQDATA,^PS(52.52,"A",PSOX("IRXN"),+Y)="" K ANQDATA,X,Y,%,ANQREM
"RTN","PSON52",97,0)
 G:PSOX("STATUS")=4 FINISHP
"RTN","PSON52",98,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSON52",99,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML",X=PSOX("IRXN")
"RTN","PSON52",100,0)
 .D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_PSODFN_"^"_DUZ_"^"_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSON52",101,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSON52",102,0)
 ;
"RTN","PSON52",103,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSON52",104,0)
 ;
"RTN","PSON52",105,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSON52",106,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSON52",107,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSON52",108,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSON52",109,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSON52",110,0)
FINISHX ; 
"RTN","PSON52",111,0)
 ;call to build Rx array for bingo board
"RTN","PSON52",112,0)
 I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSON52",113,0)
 K PSOX1,PSOX2
"RTN","PSON52",114,0)
 Q
"RTN","PSON52",115,0)
EOJ ;
"RTN","PSON52",116,0)
 ;B xref locked in routine PSONRXN
"RTN","PSON52",117,0)
 L -^PSRX("B",PSOX("IRXN")) K OTHDOS,DA,PSON52,PSOPRC,RTE,SCH,PSOX("INS"),PSONEW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT
"RTN","PSON52",118,0)
 D PSOUL^PSSLOCK(PSOX("IRXN"))
"RTN","PSON52",119,0)
 Q
"RTN","PSON52",120,0)
 ;
"RTN","PSON52",121,0)
 ;;PSOX("SIG");;SIG;;1
"RTN","PSON52",122,0)
DD ;;PSOX("RX #");;0;;1
"RTN","PSON52",123,0)
 ;;PSOX("ISSUE DATE");;0;;13
"RTN","PSON52",124,0)
 ;;PSODFN;;0;;2
"RTN","PSON52",125,0)
 ;;PSOX("PATIENT STATUS");;0;;3
"RTN","PSON52",126,0)
 ;;PSOX("PROVIDER");;0;;4
"RTN","PSON52",127,0)
 ;;PSOX("CLINIC");;0;;5
"RTN","PSON52",128,0)
 ;;PSODRUG("IEN");;0;;6
"RTN","PSON52",129,0)
 ;;PSODRUG("TRADE NAME");;TN;;1
"RTN","PSON52",130,0)
 ;;PSOX("QTY");;0;;7
"RTN","PSON52",131,0)
 ;;PSOX("DAYS SUPPLY");;0;;8
"RTN","PSON52",132,0)
 ;;PSOX("# OF REFILLS");;0;;9
"RTN","PSON52",133,0)
 ;;PSOX("COPIES");;0;;18
"RTN","PSON52",134,0)
 ;;PSOX("MAIL/WINDOW");;0;;11
"RTN","PSON52",135,0)
 ;;PSOX("REMARKS");;3;;7
"RTN","PSON52",136,0)
 ;;PSOX("CLERK CODE");;0;;16
"RTN","PSON52",137,0)
 ;;PSODRUG("COST");;0;;17
"RTN","PSON52",138,0)
 ;;PSOSITE;;2;;9
"RTN","PSON52",139,0)
 ;;PSOX("LOGIN DATE");;2;;1
"RTN","PSON52",140,0)
 ;;PSOX("FILL DATE");;2;;2
"RTN","PSON52",141,0)
 ;;PSOX("PHARMACIST");;2;;3
"RTN","PSON52",142,0)
 ;;PSOX("LOT #");;2;;4
"RTN","PSON52",143,0)
 ;;PSOX("DISPENSED DATE");;2;;5
"RTN","PSON52",144,0)
 ;;PSOX("STOP DATE");;2;;6
"RTN","PSON52",145,0)
 ;;PSODRUG("NDC");;2;;7
"RTN","PSON52",146,0)
 ;;PSODRUG("MANUFACTURER");;2;;8
"RTN","PSON52",147,0)
 ;;PSOX("EXPIRATION DATE");;2;;11
"RTN","PSON52",148,0)
 ;;PSOX("GENERIC PROVIDER");;2;;12
"RTN","PSON52",149,0)
 ;;PSOX("RELEASED DATE/TIME");;2;;13
"RTN","PSON52",150,0)
 ;;PSOX("METHOD OF PICK-UP");;MP;;1
"RTN","PSON52",151,0)
 ;;PSOX("STATUS");;STA;;1
"RTN","PSON52",152,0)
 ;;PSOX("LAST DISPENSED DATE");;3;;1
"RTN","PSON52",153,0)
 ;;PSOX("NEXT POSSIBLE REFILL");;3;;2
"RTN","PSON52",154,0)
 ;;PSOX("COSIGNING PROVIDER");;3;;3
"RTN","PSON52",155,0)
 ;;PSOX("TYPE OF RX");;TYPE;;1
"RTN","PSON52",156,0)
 ;;PSOX("SAND");;SAND;;1
"RTN","PSON52",157,0)
 ;;PSOX("POE");;POE;;1
"RTN","PSON52",158,0)
 ;;PSOX("INS");;INS;;1
"RTN","PSONEW1")
0^31^B14209647
"RTN","PSONEW1",1,0)
PSONEW1 ;BIR/DSD - new Rx order entry ;10/17/92
"RTN","PSONEW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**46,104,117,143**;DEC 1997
"RTN","PSONEW1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSONEW1",4,0)
 ;
"RTN","PSONEW1",5,0)
START ;
"RTN","PSONEW1",6,0)
 S (PSONEW("DFLG"),PSONEW("FIELD"),PSONEW1)=0
"RTN","PSONEW1",7,0)
 ;
"RTN","PSONEW1",8,0)
1 S PSONEW("FLD")=1 S PSONEW("FIELD")=0
"RTN","PSONEW1",9,0)
 I $P($G(PSOPAR),"^",7)'=1 D MANUAL^PSONRXN ; Get Manual Rx number
"RTN","PSONEW1",10,0)
 G:PSONEW("QFLG")!PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",11,0)
 ;
"RTN","PSONEW1",12,0)
2 S PSONEW("FLD")=2 D PTSTAT^PSODIR1(.PSONEW) ; Get Patient Status
"RTN","PSONEW1",13,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",14,0)
 ;
"RTN","PSONEW1",15,0)
3 S PSONEW("FLD")=3 D ^PSODRG  ; Get drug and related information
"RTN","PSONEW1",16,0)
 G:PSONEW("DFLG") END D EN^PSODIAG  ; get ICD diagnosis codes for order
"RTN","PSONEW1",17,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",18,0)
 ;
"RTN","PSONEW1",19,0)
31 S PSONEW("FLD")=31 D DOSE^PSODIR(.PSONEW) ; Get Dosing
"RTN","PSONEW1",20,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",21,0)
 ;
"RTN","PSONEW1",22,0)
32 I '$G(PSONEW("ENT")) W !,"Incomplete Dosaging Data!",! K DIRUT G 31
"RTN","PSONEW1",23,0)
 S PSONEW("FLD")=32 D INS^PSODIR(.PSONEW) ; Get Patient Instructions
"RTN","PSONEW1",24,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",25,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") D SINS^PSODIR(.PSONEW)
"RTN","PSONEW1",26,0)
 ;
"RTN","PSONEW1",27,0)
4 D EN^PSOFSIG(.PSONEW) I $O(SIG(0)) S SIGOK=1
"RTN","PSONEW1",28,0)
 ;S PSONEW("FLD")=4 D SIG^PSODIR1(.PSONEW) ; Get Rx directions
"RTN","PSONEW1",29,0)
 ;G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",30,0)
 ;
"RTN","PSONEW1",31,0)
7 S PSONEW("FLD")=7 D DAYS^PSODIR1(.PSONEW) ; Get days supply
"RTN","PSONEW1",32,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",33,0)
 ;
"RTN","PSONEW1",34,0)
5 S PSONEW("FLD")=5 D QTY^PSODIR1(.PSONEW) ; Get quantity
"RTN","PSONEW1",35,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",36,0)
 ;
"RTN","PSONEW1",37,0)
6 I $P($G(PSOPAR),"^",15) S PSONEW("FLD")=6 D COPIES^PSODIR1(.PSONEW) ; Get label copies
"RTN","PSONEW1",38,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",39,0)
 ;
"RTN","PSONEW1",40,0)
8 S PSONEW("FLD")=8 D REFILL^PSODIR1(.PSONEW) ; Get # of refills
"RTN","PSONEW1",41,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",42,0)
 ;
"RTN","PSONEW1",43,0)
9 S PSONEW("FLD")=9 D PROV^PSODIR(.PSONEW) ; Get Provider
"RTN","PSONEW1",44,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",45,0)
 G:$G(DUZ("AG"))'="I" 11
"RTN","PSONEW1",46,0)
 ;
"RTN","PSONEW1",47,0)
10 Q:$G(DUZ("AG"))'="I"  S PSONEW("FLD")=10 D EXP^PSODIR2(.PSONEW) ; Get Expiration Date - Indian Health Service ONLY
"RTN","PSONEW1",48,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",49,0)
 ;
"RTN","PSONEW1",50,0)
11 S PSONEW("FLD")=11 D CLINIC^PSODIR2(.PSONEW) ; Get Clinic
"RTN","PSONEW1",51,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",52,0)
 ;
"RTN","PSONEW1",53,0)
12 S PSONEW("FLD")=12 D MW^PSODIR2(.PSONEW) ; Get Mail/Window Info
"RTN","PSONEW1",54,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",55,0)
 ;
"RTN","PSONEW1",56,0)
13 S PSONEW("FLD")=13 D RMK^PSODIR2(.PSONEW) ; Get Remarks
"RTN","PSONEW1",57,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",58,0)
 ;
"RTN","PSONEW1",59,0)
14 S PSONEW("FLD")=14 D ISSDT^PSODIR2(.PSONEW) ; Get Issue Date
"RTN","PSONEW1",60,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",61,0)
 ;
"RTN","PSONEW1",62,0)
15 S PSONEW("FLD")=15 D FILLDT^PSODIR2(.PSONEW) ; Get Fill date
"RTN","PSONEW1",63,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",64,0)
 ;
"RTN","PSONEW1",65,0)
16 S PSONEW("FLD")=16 D CLERK^PSODIR2(.PSONEW) ; Get Clerk Code
"RTN","PSONEW1",66,0)
 G:PSONEW("DFLG") END G:PSONEW("FIELD") @PSONEW("FIELD")
"RTN","PSONEW1",67,0)
 ;
"RTN","PSONEW1",68,0)
END ;
"RTN","PSONEW1",69,0)
 K PSONEW1
"RTN","PSONEW1",70,0)
 Q
"RTN","PSONEW1",71,0)
 ;
"RTN","PSONEW1",72,0)
JUMP ;
"RTN","PSONEW1",73,0)
 S PSONEW("FIELD")=$S(+Y=.01:1,+Y=3:2,+Y=6:3,+Y=10:4,+Y=7:5,+Y=10.6:6,+Y=8:7,+Y=9:8,+Y=4:9,+Y=29:10,+Y=5:11,+Y=11:12,+Y=12:13,+Y=1:14,+Y=22:15,+Y=16:16,+Y=113:31,+Y=114:32,1:PSONEW("FLD"))
"RTN","PSONEW1",74,0)
 I PSONEW("FIELD")>PSONEW("FLD") W !,$C(7),"Cannot jump ahead ..",! S PSONEW("FIELD")=PSONEW("FLD")
"RTN","PSONEW1",75,0)
 Q
"RTN","PSONEW2")
0^32^B28589674
"RTN","PSONEW2",1,0)
PSONEW2 ;BIR/DSD - displays new rx information for edit ;07/26/96
"RTN","PSONEW2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**32,37,46,71,94,124,139,157,143**;DEC 1997
"RTN","PSONEW2",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSONEW2",4,0)
 ;External reference to ^DPT supported by DBIA 10035
"RTN","PSONEW2",5,0)
 ;External reference to PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSONEW2",6,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEW2",7,0)
 ; This routine displays the entered new rx information and
"RTN","PSONEW2",8,0)
 ; asks if correct, if not allows editing of the data.
"RTN","PSONEW2",9,0)
 ;------------------------------------------------------------
"RTN","PSONEW2",10,0)
START ;
"RTN","PSONEW2",11,0)
 S (PSONEW("DFLG"),PSONEW2("QFLG"))=0
"RTN","PSONEW2",12,0)
 D STOP
"RTN","PSONEW2",13,0)
 D DISPLAY ; Displays information
"RTN","PSONEW2",14,0)
 ;Copay exemption checks
"RTN","PSONEW2",15,0)
 S PSONEWFF=1 K PSOANSQ,PSOANSQD S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0 I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1,$G(DUZ("AG"))="V" S PSOFLAG=1 D COPAY^PSOCPB W !
"RTN","PSONEW2",16,0)
 D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSONEW2",17,0)
 I ($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1)!(PSOSCP>49) S PSOFLAG=1 D SC^PSOMLLD2
"RTN","PSONEW2",18,0)
 I $G(PSOCPZ("DFLG")) K PSONEWFF,PSOANSQD,PSOCPZ("DFLG"),PSONEW("NEWCOPAY") S DIRUT="",PSONEW("DFLG")=1 D ASKX G END
"RTN","PSONEW2",19,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEW2",20,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSONEWFF,PSOANSQD,PSOANSQ,PSOCPZ("DFLG"),PSONEW("NEWCOPAY") S DIRUT="",PSONEW("DFLG")=1 D ASKX G END
"RTN","PSONEW2",21,0)
 .;New prompts Quit after first '^'
"RTN","PSONEW2",22,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D CV^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEW2",23,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D VEH^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEW2",24,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D RAD^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEW2",25,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D PGW^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEW2",26,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MST^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEW2",27,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D HNC^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY")
"RTN","PSONEW2",28,0)
 K PSOCPZ("DFLG"),PSONEWFF
"RTN","PSONEW2",29,0)
 D ASK K:$G(PSONEW("DFLG")) PSOANSQ G:PSONEW2("QFLG")!PSONEW("DFLG") END
"RTN","PSONEW2",30,0)
 S PSORX("EDIT")=1 D EN^PSOORNE1(.PSONEW),FULL^VALM1 G:$G(PSORX("FN")) END  I '$G(PSORX("FN")) S PSONEW("DFLG")=1 K PSOANSQ G END ;D EDIT
"RTN","PSONEW2",31,0)
 G:'$G(PSONEW("DFLG")) START
"RTN","PSONEW2",32,0)
 S PSONEW("QFLG")=1,PSONEW("DFLG")=0
"RTN","PSONEW2",33,0)
END D EOJ
"RTN","PSONEW2",34,0)
 Q
"RTN","PSONEW2",35,0)
 ;------------------------------------------------------------
"RTN","PSONEW2",36,0)
STOP K PSEXDT,X,%DT S PSON52("QFLG")=0
"RTN","PSONEW2",37,0)
 S X1=PSOID,X2=PSONEW("DAYS SUPPLY")*(PSONEW("# OF REFILLS")+1)\1
"RTN","PSONEW2",38,0)
 S X2=$S(PSONEW("DAYS SUPPLY")=X2:X2,+$G(PSONEW("CS")):184,1:366)
"RTN","PSONEW2",39,0)
 I X2<30 D
"RTN","PSONEW2",40,0)
 . N % S %=$P($G(PSORX("PATIENT STATUS")),"^"),X2=30
"RTN","PSONEW2",41,0)
 . S:%?.N %=$P($G(^PS(53,+%,0)),"^") I %["AUTH ABS" S X2=5
"RTN","PSONEW2",42,0)
 D C^%DTC I PSONEW("FILL DATE")>$P(X,".") S PSEXDT=1_"^"_$P(X,".")
"RTN","PSONEW2",43,0)
 K X1,X2,X,%DT
"RTN","PSONEW2",44,0)
 Q
"RTN","PSONEW2",45,0)
DISPLAY ;
"RTN","PSONEW2",46,0)
 W !!,"Rx # ",PSONEW("RX #")
"RTN","PSONEW2",47,0)
 W ?23,$E(PSONEW("FILL DATE"),4,5),"/",$E(PSONEW("FILL DATE"),6,7),"/",$E(PSONEW("FILL DATE"),2,3),!,$G(PSORX("NAME")),?30,"#",PSONEW("QTY")
"RTN","PSONEW2",48,0)
 I $G(SIGOK),$O(SIG(0)) D  K D G TRN
"RTN","PSONEW2",49,0)
 .F D=0:0 S D=$O(SIG(D)) W !,SIG(D) Q:'$O(SIG(D))
"RTN","PSONEW2",50,0)
 E  S X=PSONEW("SIG") D SIGONE^PSOHELP W !,$G(INS1)
"RTN","PSONEW2",51,0)
TRN ;I $G(PSOPRC) F I=0:0 S I=$O(PRC(I)) Q:'I  W !,PRC(I)
"RTN","PSONEW2",52,0)
 W !!,$S($G(PSODRUG("TRADE NAME"))]"":PSODRUG("TRADE NAME"),1:PSODRUG("NAME"))
"RTN","PSONEW2",53,0)
 W !,PSONEW("PROVIDER NAME"),?25,PSORX("CLERK CODE"),!,"# of Refills: ",PSONEW("# OF REFILLS"),!
"RTN","PSONEW2",54,0)
 Q
"RTN","PSONEW2",55,0)
 ;
"RTN","PSONEW2",56,0)
ASK ;
"RTN","PSONEW2",57,0)
 K DIR,X,Y S DIR("A")="Is this correct"
"RTN","PSONEW2",58,0)
 S DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S PSONEW("DFLG")=1 G ASKX
"RTN","PSONEW2",59,0)
ASK1 I Y D  S PSONEW2("QFLG")=1
"RTN","PSONEW2",60,0)
 .S:$G(PSONEW("MAIL/WINDOW"))["W" BINGCRT=Y,BINGRTE="W"
"RTN","PSONEW2",61,0)
 .D:+$G(PSEXDT)
"RTN","PSONEW2",62,0)
 ..S Y=PSONEW("FILL DATE") X ^DD("DD") W !!,$C(7),Y_" fill date is greater than possible expiration date of " S Y=$P(PSEXDT,"^",2) X ^DD("DD") W Y_"."
"RTN","PSONEW2",63,0)
 .D DCORD K RORD,^TMP("PSORXDC",$J)
"RTN","PSONEW2",64,0)
ASKX I $D(DIRUT) D
"RTN","PSONEW2",65,0)
 .I +$G(PSEXDT) K DIRUT S (PSONEW2("QFLG"),PSONEW2("DFLG"),PSONEW("DFLG"),Y)=1
"RTN","PSONEW2",66,0)
 K X,Y,DIRUT,DTOUT,DUOUT
"RTN","PSONEW2",67,0)
 D:+$G(PSEXDT) PAUSE^VALM1
"RTN","PSONEW2",68,0)
 Q
"RTN","PSONEW2",69,0)
DCORD ;dc rxs and pending orders after new order is entered
"RTN","PSONEW2",70,0)
 F RORD=0:0 S RORD=$O(^TMP("PSORXDC",$J,RORD)) Q:'RORD  D @$S($P(^TMP("PSORXDC",$J,RORD,0),"^")="P":"PEN",1:"RX52")
"RTN","PSONEW2",71,0)
 K RORD
"RTN","PSONEW2",72,0)
 Q
"RTN","PSONEW2",73,0)
PEN ;pending ^tmp("psorxdc",$j,rord,0)="p^"_rord_"^"_msg
"RTN","PSONEW2",74,0)
 S $P(^PS(52.41,RORD,0),"^",3)="DC",^PS(52.41,RORD,4)=$P(^TMP("PSORXDC",$J,RORD,0),"^",3)
"RTN","PSONEW2",75,0)
 K ^PS(52.41,"AOR",PSODFN,+$P($G(^PS(52.41,RORD,"INI")),"^"),RORD)
"RTN","PSONEW2",76,0)
 D EN^PSOHLSN($P(^PS(52.41,RORD,0),"^"),"OC",$P(^TMP("PSORXDC",$J,RORD,0),"^",3),"D") W $C(7),!," -Pending Order was discontinued..."
"RTN","PSONEW2",77,0)
 D PSOUL^PSSLOCK(RORD_"S") K ^TMP("PSORXDC",$J,RORD,0)
"RTN","PSONEW2",78,0)
 Q
"RTN","PSONEW2",79,0)
RX52 ;rxs in file 52 ^tmp("psorxdc",$j,rord,0)=52^rord^msg^rea^act^sta^dnm
"RTN","PSONEW2",80,0)
 S PSCAN($P(^PSRX(RORD,0),"^"))=RORD_"^"_$P(^TMP("PSORXDC",$J,RORD,0),"^",4)
"RTN","PSONEW2",81,0)
 S MSG=$P(^TMP("PSORXDC",$J,RORD,0),"^",3),REA=$P(^(0),"^",4),ACT=$P(^(0),"^",5)
"RTN","PSONEW2",82,0)
 N PSONOOR S PSONOOR="D",DUP=1,DA=RORD D CAN^PSOCAN K PSONOOR
"RTN","PSONEW2",83,0)
 W !," -Rx "_$P(^PSRX(RORD,0),"^")_" has been discontinued...",!
"RTN","PSONEW2",84,0)
 K PSOSD($P(^TMP("PSORXDC",$J,RORD,0),"^",6),$P(^TMP("PSORXDC",$J,RORD,0),"^",7))
"RTN","PSONEW2",85,0)
 D PSOUL^PSSLOCK(RORD) K ^TMP("PSORXDC",$J,RORD,0)
"RTN","PSONEW2",86,0)
 Q
"RTN","PSONEW2",87,0)
 ;
"RTN","PSONEW2",88,0)
EDIT ;
"RTN","PSONEW2",89,0)
 S PSORX("EDIT")=1
"RTN","PSONEW2",90,0)
 D ^PSONEW3
"RTN","PSONEW2",91,0)
 S PSONEW("DFLG")=$S($G(PSORX("DFLG")):1,1:0)
"RTN","PSONEW2",92,0)
 Q
"RTN","PSONEW2",93,0)
 ;
"RTN","PSONEW2",94,0)
EOJ ;
"RTN","PSONEW2",95,0)
 K PSONEW2,PSORX("EDIT"),PSORX("DFLG"),PSOEDIT
"RTN","PSONEW2",96,0)
 Q
"RTN","PSONEW2",97,0)
 ;
"RTN","PSONEW2",98,0)
EN1(PSONEW2) ; Entry point to just display and ask if okay
"RTN","PSONEW2",99,0)
 S PSONEW("DFLG")=0
"RTN","PSONEW2",100,0)
 I $G(^PSRX(PSONEW2("IRXN"),0))']"" S PSONEW("DFLG")=1 G EN1X
"RTN","PSONEW2",101,0)
 S PSOX=^PSRX(PSONEW2("IRXN"),0),PSONEW("TRADE NAME")=$G(^("TN")),PSONEW("FILL DATE")=$P($G(^(2)),"^",2)
"RTN","PSONEW2",102,0)
 S PSONEW("RX #")=$P(PSOX,"^"),PSORX("NAME")=$P(^DPT($P(PSOX,"^",2),0),"^")
"RTN","PSONEW2",103,0)
 S PSONEW("QTY")=$P(PSOX,"^",7),PSODRUG("NAME")=$P(^PSDRUG($P(PSOX,"^",6),0),"^"),PSONEW("# OF REFILLS")=$P(PSOX,"^",9)
"RTN","PSONEW2",104,0)
 S PSORX("CLERK CODE")=$P(^VA(200,$P(PSOX,"^",16),0),"^")
"RTN","PSONEW2",105,0)
 S:$G(PSONEW("PROVIDER NAME"))="" PSONEW("PROVIDER NAME")=$P(^VA(200,$P(PSOX,"^",4),0),"^")
"RTN","PSONEW2",106,0)
 S PSONEW("SIG")=$P($G(^PSRX(PSONEW2("IRXN"),"SIG")),"^")
"RTN","PSONEW2",107,0)
 D DISPLAY
"RTN","PSONEW2",108,0)
 D ASK
"RTN","PSONEW2",109,0)
 I PSONEW("DFLG")=1 S PSONEW2("DFLG")=1
"RTN","PSONEW2",110,0)
EN1X ;
"RTN","PSONEW2",111,0)
 Q
"RTN","PSONEWF")
0^37^B42076489
"RTN","PSONEWF",1,0)
PSONEWF ;BIR/RTR - Copay finish questions ;07/26/96
"RTN","PSONEWF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143**;DEC 1997
"RTN","PSONEWF",3,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEWF",4,0)
START ;
"RTN","PSONEWF",5,0)
 N PSOPENIB,PSOSCOTH,PSOSCOTX,PSOMESFI
"RTN","PSONEWF",6,0)
 S PSOPENIB=$S($G(ORD):$G(^PS(52.41,+$G(ORD),"IBQ")),1:"")
"RTN","PSONEWF",7,0)
 ;set PSOSCOTH for display of Provider Copay intent, used with PSORX(SC)
"RTN","PSONEWF",8,0)
 S PSOSCOTH=0 I $P(PSOPENIB,"^")=1!($P(PSOPENIB,"^",2)=1)!($P(PSOPENIB,"^",3)=1)!($P(PSOPENIB,"^",4)=1)!($P(PSOPENIB,"^",5)=1)!($P(PSOPENIB,"^",6)=1) S PSOSCOTH=1
"RTN","PSONEWF",9,0)
 S PSOSCOTX=0 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSONEWF",10,0)
 ;Check for Orderable Item change to display message
"RTN","PSONEWF",11,0)
 S PSOMESFI=0 I $G(OR0),$G(PSODRUG("OI")) D
"RTN","PSONEWF",12,0)
 .I $G(PSODRUG("OI"))'=$P($G(OR0),"^",8) S PSOMESFI=1
"RTN","PSONEWF",13,0)
 S PSONEWFF=1
"RTN","PSONEWF",14,0)
 ;Copay exemption checks
"RTN","PSONEWF",15,0)
 K PSOSCP D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSONEWF",16,0)
 K PSOANSQ D SET S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0 I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1,$G(DUZ("AG"))="V" S PSOFLAG=1 D COPAY^PSOCPB W !
"RTN","PSONEWF",17,0)
 I $P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1) S PSOANSQ("CV")=$P(PSOPENIB,"^",6)
"RTN","PSONEWF",18,0)
 I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY"),PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI Q
"RTN","PSONEWF",19,0)
 I PSOSCP>49!($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1)!(+PSOBILL=0) D
"RTN","PSONEWF",20,0)
 . I PSOSCP<50 D MESS S:PSOSCP<50 PSOANSQD("SC>50")=$G(PSOANSQD("SC"))
"RTN","PSONEWF",21,0)
 . S PSOFLAG=1 D SC^PSOMLLD2
"RTN","PSONEWF",22,0)
 . I PSOSCP<50&($D(PSOANSQD("SC"))) S:PSOSCP<50 PSOANSQD("SC")=PSOANSQD("SC>50") K PSOANSQD("SC")
"RTN","PSONEWF",23,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEWF",24,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI Q
"RTN","PSONEWF",25,0)
 .;New prompts Quit after first '^'
"RTN","PSONEWF",26,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D  D MESSOI,MESS D CV^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",27,0)
 ..I '$D(PSOANSQD("CV")),($P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1)) S PSOANSQD("CV")=$P(PSOPENIB,"^",6)
"RTN","PSONEWF",28,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D  D MESSOI,MESS D VEH^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",29,0)
 ..I '$D(PSOANSQD("VEH")),($P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1)) S PSOANSQD("VEH")=$P(PSOPENIB,"^",2)
"RTN","PSONEWF",30,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D  D MESSOI,MESS D RAD^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",31,0)
 ..I '$D(PSOANSQD("RAD")),($P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1)) S PSOANSQD("RAD")=$P(PSOPENIB,"^",3)
"RTN","PSONEWF",32,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D  D MESSOI,MESS D PGW^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",33,0)
 ..I '$D(PSOANSQD("PGW")),($P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1)) S PSOANSQD("PGW")=$P(PSOPENIB,"^",4)
"RTN","PSONEWF",34,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D  D MESSOI,MESS D MST^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWF",35,0)
 ..I '$D(PSOANSQD("MST")),($P(PSOPENIB,"^")=0!($P(PSOPENIB,"^")=1)) S PSOANSQD("MST")=$P(PSOPENIB,"^")
"RTN","PSONEWF",36,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D  D MESSOI,MESS D HNC^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY")
"RTN","PSONEWF",37,0)
 ..I '$D(PSOANSQD("HNC")),($P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1)) S PSOANSQD("HNC")=$P(PSOPENIB,"^",5)
"RTN","PSONEWF",38,0)
 K PSONEWFF,PSOSCOTH,PSOSCOTX,PSOMESFI
"RTN","PSONEWF",39,0)
 Q
"RTN","PSONEWF",40,0)
SET ;Set original answers that were passed from CPRS
"RTN","PSONEWF",41,0)
 Q:'$G(ORD)
"RTN","PSONEWF",42,0)
 Q:'$G(PSOFDR)
"RTN","PSONEWF",43,0)
 I $P($G(^PS(52.41,ORD,0)),"^",16)="SC"!($P($G(^(0)),"^",16)="NSC") D
"RTN","PSONEWF",44,0)
 . I PSOSCP<50 S PSOANSQ("SC")=$S($P($G(^(0)),"^",16)="SC":1,1:0),PSOANSQD("SC")=PSOANSQ("SC") S:PSOANSQ("SC")'="" PSOIBQS(PSODFN,"SC")=PSOANSQ("SC")
"RTN","PSONEWF",45,0)
 . E  S PSOANSQ("SC>50")=$S($P($G(^(0)),"^",16)="SC":1,1:0),PSOANSQD("SC>50")=PSOANSQ("SC>50") S:PSOANSQ("SC>50")'="" PSOIBQS(PSODFN,"SC>50")=PSOANSQ("SC>50")
"RTN","PSONEWF",46,0)
 I $G(PSOPENIB)="" G ICD1:$D(^PS(52.41,ORD,"ICD")) Q
"RTN","PSONEWF",47,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSONEWF",48,0)
 I $P(PSOPENIB,"^")=0!($P(PSOPENIB,"^")=1) S PSOANSQ("MST")=$P(PSOPENIB,"^")
"RTN","PSONEWF",49,0)
 I $P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1) S PSOANSQ("VEH")=$P(PSOPENIB,"^",2)
"RTN","PSONEWF",50,0)
 I $P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1) S PSOANSQ("RAD")=$P(PSOPENIB,"^",3)
"RTN","PSONEWF",51,0)
 I $P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1) S PSOANSQ("PGW")=$P(PSOPENIB,"^",4)
"RTN","PSONEWF",52,0)
 I $P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1) S PSOANSQ("HNC")=$P(PSOPENIB,"^",5)
"RTN","PSONEWF",53,0)
 I $P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1) S PSOANSQ("CV")=$P(PSOPENIB,"^",6)
"RTN","PSONEWF",54,0)
ICD1 ;
"RTN","PSONEWF",55,0)
 N PSONOCHG S PSONOCHG=0
"RTN","PSONEWF",56,0)
 I ('$D(PSORXED("ICD"))) S PSONOCHG=1
"RTN","PSONEWF",57,0)
 I $D(^PS(52.41,ORD,"ICD",0)) D
"RTN","PSONEWF",58,0)
 . N JJ,ICD,II,FLD,RXN S RXN=ORD
"RTN","PSONEWF",59,0)
 . S II=0 F  S II=$O(^PS(52.41,ORD,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSONEWF",60,0)
 .. S ICD="",ICD=^PS(52.41,ORD,"ICD",II,0)
"RTN","PSONEWF",61,0)
 .. S JJ="" F JJ=1:1:8 S FLD=$P(ICD,U,JJ) S:$G(PSONEW("IDFLG"))&(JJ=1) FLD=""  D ICD
"RTN","PSONEWF",62,0)
 Q
"RTN","PSONEWF",63,0)
MESS ;
"RTN","PSONEWF",64,0)
 I $G(PSOSCOTX)=1 W !,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSONEWF",65,0)
 Q
"RTN","PSONEWF",66,0)
MESSOI ;
"RTN","PSONEWF",67,0)
 I $G(PSOMESFI)=1 W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing medication copay exemption defaults carefully for appropriateness.",! S PSOMESFI=2
"RTN","PSONEWF",68,0)
 Q
"RTN","PSONEWF",69,0)
 ;
"RTN","PSONEWF",70,0)
ICD ;called from PSONEWG and used by PSONEW
"RTN","PSONEWF",71,0)
 I '$D(PSOSCP) D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSONEWF",72,0)
 I JJ=1 D
"RTN","PSONEWF",73,0)
 . I $G(PSOCOPY)&($D(PSORXED("ICD")))&($D(PSONEW("IDFLG"))) Q:'$D(PSORXED("ICD",II))
"RTN","PSONEWF",74,0)
 . I $G(PSOCOPY)&($D(PSORXED("ICD",II))) S PSONEW("ICD",II)=PSORXED("ICD",II) Q
"RTN","PSONEWF",75,0)
 . Q:'$G(PSOCOPY)&('$D(PSORXED("ICD",II)))&('$G(PSONOCHG))  ;don't set deleted ones
"RTN","PSONEWF",76,0)
 . Q:$G(PSONEW("IDFLG"))
"RTN","PSONEWF",77,0)
 . I $D(PSORX("ICD",II)) S PSONEW("ICD",II)=PSORX("ICD",II) Q
"RTN","PSONEWF",78,0)
 . S PSONEW("ICD",II)=FLD
"RTN","PSONEWF",79,0)
 ;
"RTN","PSONEWF",80,0)
 I JJ=2 S:'$G(PSOANSQD("VEH")) PSOANSQD("VEH")="" S:PSOANSQD("VEH")=""!(PSOANSQD("VEH")=0) PSOANSQD("VEH")=FLD,PSORX(RXN,"VEH")=FLD S:FLD'="" PSOIBQS(PSODFN,"VEH")=FLD Q
"RTN","PSONEWF",81,0)
 I JJ=3 S:'$G(PSOANSQD("RAD")) PSOANSQD("RAD")="" S:PSOANSQD("RAD")=""!(PSOANSQD("RAD")=0) PSOANSQD("RAD")=FLD,PSORX(RXN,"RAD")=FLD S:FLD'="" PSOIBQS(PSODFN,"RAD")=FLD Q
"RTN","PSONEWF",82,0)
 I JJ=4 D
"RTN","PSONEWF",83,0)
 . I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=0) S:'$G(PSOANSQD("SC")) PSOANSQD("SC")="" S:PSOANSQD("SC")=""!(PSOANSQD("SC")="") PSOANSQD("SC")=FLD,PSORX(RXN,"SC")=FLD S:FLD'="" PSOIBQS(PSODFN,"SC")=FLD
"RTN","PSONEWF",84,0)
 . E  S:'$G(PSOANSQD("SC>50")) PSOANSQD("SC>50")="" S:PSOANSQD("SC>50")=""!(PSOANSQD("SC>50")=0) PSOANSQD("SC>50")=FLD,PSORX(RXN,"SC>50")=FLD S:FLD'="" PSOIBQS(PSODFN,"SC>50")=FLD
"RTN","PSONEWF",85,0)
 I JJ=5 S:'$G(PSOANSQD("PGW")) PSOANSQD("PGW")="" S:PSOANSQD("PGW")=""!(PSOANSQD("PGW")=0) PSOANSQD("PGW")=FLD,PSORX(RXN,"PGW")=FLD S:FLD'="" PSOIBQS(PSODFN,"PGW")=FLD Q
"RTN","PSONEWF",86,0)
 I JJ=6 S:'$G(PSOANSQD("MST")) PSOANSQD("MST")="" S:PSOANSQD("MST")=""!(PSOANSQD("MST")=0) PSOANSQD("MST")=FLD,PSORX(RXN,"MST")=FLD S:FLD'="" PSOIBQS(PSODFN,"MST")=FLD Q
"RTN","PSONEWF",87,0)
 I JJ=7 S:'$G(PSOANSQD("HNC")) PSOANSQD("HNC")="" S:PSOANSQD("HNC")=""!(PSOANSQD("HNC")=0) PSOANSQD("HNC")=FLD,PSORX(RXN,"HNC")=FLD S:FLD'="" PSOIBQS(PSODFN,"HNC")=FLD Q
"RTN","PSONEWF",88,0)
 I JJ=8 S:'$G(PSOANSQD("CV")) PSOANSQD("CV")="" S:PSOANSQD("CV")=""!(PSOANSQD("CV")=0) PSOANSQD("CV")=FLD,PSORX(RXN,"CV")=FLD S:FLD'="" PSOIBQS(PSODFN,"CV")=FLD
"RTN","PSONEWF",89,0)
 Q
"RTN","PSONEWG")
0^38^B21031672
"RTN","PSONEWG",1,0)
PSONEWG ;BIR/RTR - Copay copy and edit questions ;07/26/96
"RTN","PSONEWG",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**71,157,143**;DEC 1997
"RTN","PSONEWG",3,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSONEWG",4,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSONEWG",5,0)
START ;
"RTN","PSONEWG",6,0)
 N PSOPENIB,PSOMESOI
"RTN","PSONEWG",7,0)
 S PSOPENIB="" I $G(PSORXED)!($G(PSOCOPY)) I $G(PSORXED("IRXN")) S PSOPENIB=$G(^PSRX(PSORXED("IRXN"),"IBQ"))
"RTN","PSONEWG",8,0)
 S PSOMESOI=0 I $G(PSORXED) D
"RTN","PSONEWG",9,0)
 .I $G(PSODRUG("OI")),$P($G(PSORXED("RX0")),"^",6) D
"RTN","PSONEWG",10,0)
 ..I $G(PSODRUG("OI"))'=$P($G(^PSDRUG(+$P($G(PSORXED("RX0")),"^",6),2)),"^") S PSOMESOI=1
"RTN","PSONEWG",11,0)
 S PSONEWFF=1
"RTN","PSONEWG",12,0)
 ;Copay exemption checks
"RTN","PSONEWG",13,0)
 K PSOSCP D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSONEWG",14,0)
 K PSOANSQ D SET S PSOCPZ("DFLG")=0,PSONEW("NEWCOPAY")=0 I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)'=1,$G(DUZ("AG"))="V" S PSOFLAG=1 D  D COPAY^PSOCPB W !
"RTN","PSONEWG",15,0)
 .;I $G(PSOANSQD("SC"))=0!($G(PSOANSQD("SC"))=1) Q
"RTN","PSONEWG",16,0)
 .I $G(PSOANSQ("SC"))=0!($G(PSOANSQ("SC"))=1) S PSOANSQD("SC")=$G(PSOANSQ("SC"))
"RTN","PSONEWG",17,0)
 I PSOSCP>49!($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) S PSOFLAG=1 D SC^PSOMLLD2
"RTN","PSONEWG",18,0)
 I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY"),PSONEWFF,PSOMESOI Q
"RTN","PSONEWG",19,0)
 ;IF MILL BILL, AND COPAY (*******TEST THE COPAY CHECK)
"RTN","PSONEWG",20,0)
 I $$DT^PSOMLLDT D  I $G(PSOCPZ("DFLG")) K PSOANSQ,PSONEW("NEWCOPAY"),PSONEWFF,PSOMESOI Q
"RTN","PSONEWG",21,0)
 .;New prompts Quit after first '^'
"RTN","PSONEWG",22,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D  D MESS D CV^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",23,0)
 ..I '$D(PSOANSQD("CV")),($P(PSOPENIB,"^",7)=0!($P(PSOPENIB,"^",7)=1)) S PSOANSQD("CV")=$P(PSOPENIB,"^",7)
"RTN","PSONEWG",24,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D  D MESS D VEH^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",25,0)
 ..I '$D(PSOANSQD("VEH")),($P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1)) S PSOANSQD("VEH")=$P(PSOPENIB,"^",3)
"RTN","PSONEWG",26,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D  D MESS D RAD^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",27,0)
 ..I '$D(PSOANSQD("RAD")),($P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1)) S PSOANSQD("RAD")=$P(PSOPENIB,"^",4)
"RTN","PSONEWG",28,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D  D MESS D PGW^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",29,0)
 ..I '$D(PSOANSQD("PGW")),($P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1)) S PSOANSQD("PGW")=$P(PSOPENIB,"^",5)
"RTN","PSONEWG",30,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D  D MESS D MST^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY") Q
"RTN","PSONEWG",31,0)
 ..I '$D(PSOANSQD("MST")),($P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1)) S PSOANSQD("MST")=$P(PSOPENIB,"^",2)
"RTN","PSONEWG",32,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D  D MESS D HNC^PSOMLLDT I $G(PSOCPZ("DFLG")) K PSONEW("NEWCOPAY")
"RTN","PSONEWG",33,0)
 ..I '$D(PSOANSQD("HNC")),($P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1)) S PSOANSQD("HNC")=$P(PSOPENIB,"^",6)
"RTN","PSONEWG",34,0)
 K PSONEWFF,PSOMESOI
"RTN","PSONEWG",35,0)
 Q
"RTN","PSONEWG",36,0)
SET ;Set original answers that were passed from CPRS
"RTN","PSONEWG",37,0)
 Q:'$G(PSORXED("IRXN"))
"RTN","PSONEWG",38,0)
 S PSOANSQ("SC")=$S($P($G(^PSRX(PSORXED("IRXN"),"IBQ")),"^")'="":$P($G(^("IBQ")),"^"),$P($G(^PSRX(PSORXED("IRXN"),"IB")),"^"):0,1:"")
"RTN","PSONEWG",39,0)
 I $G(PSOANSQ("SC"))="" K PSOANSQ("SC")
"RTN","PSONEWG",40,0)
 I $G(PSOPENIB)="" G ICD
"RTN","PSONEWG",41,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSONEWG",42,0)
 I $P(PSOPENIB,"^",2)=0!($P(PSOPENIB,"^",2)=1) S PSOANSQ("MST")=$P(PSOPENIB,"^",2)
"RTN","PSONEWG",43,0)
 I $P(PSOPENIB,"^",3)=0!($P(PSOPENIB,"^",3)=1) S PSOANSQ("VEH")=$P(PSOPENIB,"^",3)
"RTN","PSONEWG",44,0)
 I $P(PSOPENIB,"^",4)=0!($P(PSOPENIB,"^",4)=1) S PSOANSQ("RAD")=$P(PSOPENIB,"^",4)
"RTN","PSONEWG",45,0)
 I $P(PSOPENIB,"^",5)=0!($P(PSOPENIB,"^",5)=1) S PSOANSQ("PGW")=$P(PSOPENIB,"^",5)
"RTN","PSONEWG",46,0)
 I $P(PSOPENIB,"^",6)=0!($P(PSOPENIB,"^",6)=1) S PSOANSQ("HNC")=$P(PSOPENIB,"^",6)
"RTN","PSONEWG",47,0)
 I $P(PSOPENIB,"^",7)=0!($P(PSOPENIB,"^",7)=1) S PSOANSQ("CV")=$P(PSOPENIB,"^",7)
"RTN","PSONEWG",48,0)
ICD ;
"RTN","PSONEWG",49,0)
 N PSONOCHG S PSONOCHG=0
"RTN","PSONEWG",50,0)
 I '$D(PSONEW("ICD"))&('$D(PSORXED("ICD"))) S PSONOCHG=1
"RTN","PSONEWG",51,0)
 I $D(^PSRX(PSORXED("IRXN"),"ICD",0)) D
"RTN","PSONEWG",52,0)
 . N JJ,ICD,II,FLD,RXN,TNEW S RXN=PSORXED("IRXN")
"RTN","PSONEWG",53,0)
 . S II=0 F  S II=$O(^PSRX(RXN,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSONEWG",54,0)
 .. S ICD="",ICD=^PSRX(RXN,"ICD",II,0)
"RTN","PSONEWG",55,0)
 .. Q:$G(PSOCOPY)&(II>1)&('PSONOCHG)        ;user deleted all after this II or no changes made
"RTN","PSONEWG",56,0)
 .. S JJ="" F JJ=1:1:8 S FLD=$P(ICD,U,JJ) S:$G(PSONEW("IDFLG"))&(JJ=1) FLD="" D ICD^PSONEWF
"RTN","PSONEWG",57,0)
 E  I $G(PSONEW("IDFLG")) K ^PSRX(RXN,"B") S $P(^PSRX(RXN,"ICD",1,0),"^",1)="",TNEW=2 D
"RTN","PSONEWG",58,0)
 . F TNEW=TNEW:1:8 Q:'$D(^PSRX(RXN,"ICD",TNEW,0))  S DIK="^PSRX("_RXN_","_$C(34)_"ICD"_$C(34)_",",DA=TNEW,DA(1)=RXN D ^DIK K DA,DIK ;user deleted all
"RTN","PSONEWG",59,0)
 K PSONEW("IDFLG"),PSORXED("IDFLG")
"RTN","PSONEWG",60,0)
 Q
"RTN","PSONEWG",61,0)
MESS ;
"RTN","PSONEWG",62,0)
 I $G(PSOMESOI)=1,$G(PSORXED) W !!,"The Pharmacy Orderable Item has changed for this order. Please review any",!,"existing medication copay exemption defaults carefully for appropriateness.",! S PSOMESOI=2
"RTN","PSONEWG",63,0)
 Q
"RTN","PSOORED6")
0^39^B52070560
"RTN","PSOORED6",1,0)
PSOORED6 ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOORED6",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**78,104,117,133,143**;DEC 1997
"RTN","PSOORED6",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORED6",4,0)
 ;External reference to ^PS(50.7 supported by DBIA 2223
"RTN","PSOORED6",5,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOORED6",6,0)
DRG ;select drug
"RTN","PSOORED6",7,0)
 S PSORX("EDIT")=1,RX0HLD=RX0
"RTN","PSOORED6",8,0)
 S PSODRUG("IEN")=$S($G(PSODRUG("IEN"))]"":PSODRUG("IEN"),1:$P(RX0,"^",6)),PSODRUG("NAME")=$S($G(PSODRUG("NAME"))]"":PSODRUG("NAME"),1:$P(^PSDRUG($P(RX0,"^",6),0),"^"))
"RTN","PSOORED6",9,0)
 D ^PSODRG I PSODRUG("IEN")=$P(RX0,"^",6) K PSORXED("FLD",6)
"RTN","PSOORED6",10,0)
 D:PSODRUG("IEN")'=$P(RX0,"^",6)  I $G(PSORX("DFLG")) K PSORXED("FLD",6) S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",11,0)
 .D POST^PSODRG
"RTN","PSOORED6",12,0)
 .I '$O(^PSRX(PSORXED("IRXN"),1,0)) S PSORXED("FLD",17)=$G(PSODRUG("COST"))
"RTN","PSOORED6",13,0)
 .I $G(PSORX("DFLG")) K PSORXED("FLD",6),PSODRUG,PSOOIFLG,PSOSIGFL,VALMSG Q
"RTN","PSOORED6",14,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the dispense drug from",DIR("A",2)=$P(^PSDRUG($P(PSORXED("RX0"),"^",6),0),"^")_" to "_$P(^PSDRUG(PSODRUG("IEN"),0),"^")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",15,0)
 .D ^DIR K DIR I $D(DIRUT) S PSORX("DFLG")=1 D M1
"RTN","PSOORED6",16,0)
 .Q:$D(DIRUT)!('Y)
"RTN","PSOORED6",17,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",18,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",19,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",20,0)
 S RX0=RX0HLD K RX0HLD I $G(PSODRUG("OI"))=$G(PSOI) D  Q
"RTN","PSOORED6",21,0)
 .D:$O(^TMP("PSORXDC",$J,0))
"RTN","PSOORED6",22,0)
 ..W !!,"This edit will discontinue the duplicate Rx & change the dispensed drug!"
"RTN","PSOORED6",23,0)
 ..K DIR,X,Y S DIR("A")="Do You Want to Proceed",DIR("B")="NO",DIR(0)="Y"
"RTN","PSOORED6",24,0)
 ..D ^DIR K DIR S:'Y!($D(DIRUT)) PSORXED("DFLG")=1 D:Y DCORD^PSONEW2
"RTN","PSOORED6",25,0)
 .Q:$G(PSORXED("DFLG"))
"RTN","PSOORED6",26,0)
 .I PSODRUG("IEN")'=$P(RX0,"^",6) D
"RTN","PSOORED6",27,0)
 ..S PSORXED("FLD",6)=PSODRUG("IEN"),PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",28,0)
 .S:$G(PSODRUG("TRADE NAME"))]"" PSORXED("FLD",6.5)=PSODRUG("TRADE NAME")
"RTN","PSOORED6",29,0)
 W !!,"New Orderable Item selected. This edit will create a new prescription!",! D PAUSE^VALM1 S VALMSG="New Orderable Item selected. This edit will create a new prescription!" S (PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",30,0)
 Q
"RTN","PSOORED6",31,0)
PSOCOU ;patient counseling
"RTN","PSOORED6",32,0)
 K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=41 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",33,0)
 D KV S DIR(0)="52,41" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",34,0)
 I $D(DIRUT) K PSORXED("FLD",41) D KV Q
"RTN","PSOORED6",35,0)
 S PSORXED("FLD",DR)=Y D  K DIRUT
"RTN","PSOORED6",36,0)
 .I Y D  Q
"RTN","PSOORED6",37,0)
 ..K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED",DR=42 D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED6",38,0)
 ..K DIR,DIRUT S DIR(0)="52,42" S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR) D ^DIR K DIR,PSORXED(52,DA,DR)
"RTN","PSOORED6",39,0)
 ..I $D(DIRUT) K PSORXED("FLD",41),DUOUT,DTOUT Q
"RTN","PSOORED6",40,0)
 ..S PSORXED("FLD",42)=Y
"RTN","PSOORED6",41,0)
 .S PSORXED("FLD",41)=0,PSORXED("FLD",42)="@"
"RTN","PSOORED6",42,0)
 Q
"RTN","PSOORED6",43,0)
PSOI ;select orderable item
"RTN","PSOORED6",44,0)
 W !!,"Current Orderable Item: "_$P(^PS(50.7,PSOI,0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOORED6",45,0)
 S DIC("B")=$P(^PS(50.7,PSOI,0),"^"),DIC="^PS(50.7,",DIC(0)="AEMQZ"
"RTN","PSOORED6",46,0)
 S DIC("S")="I '$P(^PS(50.7,+Y,0),""^"",4)!($P(^(0),""^"",4)'<DT) N PSOF,PSOL S (PSOF,PSOL)=0 F  S PSOL=$O(^PSDRUG(""ASP"",+Y,PSOL)) Q:PSOF!'PSOL  "
"RTN","PSOORED6",47,0)
 S DIC("S")=DIC("S")_"I $P($G(^PSDRUG(PSOL,2)),U,3)[""O"",'$G(^(""I""))!($G(^(""I""))'<DT) S PSOF=1" D ^DIC I "^"[X S PSORXED("DFLG")=1 Q
"RTN","PSOORED6",48,0)
 G:Y<1 PSOI Q:PSOI=+Y
"RTN","PSOORED6",49,0)
 S PSODRUG("OI")=+Y,PSODRUG("OIN")=Y(0,0) K DIC
"RTN","PSOORED6",50,0)
 I PSOI'=PSODRUG("OI") W !!,"New Orderable Item selected. This edit will create a new prescription!",! D  K PSHOLDD Q
"RTN","PSOORED6",51,0)
 .D PAUSE^VALM1,M2
"RTN","PSOORED6",52,0)
 .S PSHOLDD=$G(PSODRUG("IEN")) K PSODRUG("IEN"),PSODRUG("NAME") S PSODRUG("DEA")="",(PSOOIFLG,PSOSIGFL)=1
"RTN","PSOORED6",53,0)
 .D DREN^PSOORNW2
"RTN","PSOORED6",54,0)
 .I $G(PSHOLDD),$G(PSODRUG("IEN")),$G(PSHOLDD)'=$G(PSODRUG("IEN")) D  Q:$G(PSORX("DFLG"))
"RTN","PSOORED6",55,0)
 ..D FULL^VALM1,POST^PSODRG S VALMBCK="R"
"RTN","PSOORED6",56,0)
 ..I $G(PSORX("DFLG")) K PSODRUG S PSODRUG("IEN")=$G(PSHOLDD),PSODRUG("NAME")=$P($G(^PSDRUG(PSODRUG("IEN"),0)),"^") K PSOOIFLG,PSOSIGFL S VALMSG=""
"RTN","PSOORED6",57,0)
 .I '$G(PSODRUG("IEN")) W !!,"DRUG NAME REQUIRED!" D 2^PSOORNW1
"RTN","PSOORED6",58,0)
 .I '$G(PSODRUG("IEN")) K PSORXED("FLD"),INDEL,^TMP($J,"INS1"),PSOSIGFL,VALMSG S PSORXED("DFLG")=1,VALMSG="Dispense Drug NOT Selected!" Q
"RTN","PSOORED6",59,0)
 .D KV S DIR(0)="Y",DIR("B")="NO",DIR("A",1)="You have changed the Orderable Item from",DIR("A",2)=$P(^PS(50.7,PSOI,0),"^")_" to "_PSODRUG("OIN")_".",DIR("A")="Do You want to Edit the SIG"
"RTN","PSOORED6",60,0)
 .D ^DIR K DIR I $D(DIRUT) K PSODRUG("OIN"),PSOOIFLG,PSOSIGFL S PSODRUG("OI")=PSOI,VALMSG="",PSORX("DFLG")=1 Q
"RTN","PSOORED6",61,0)
 .I 'Y S PSORX("DFLG")=1 Q
"RTN","PSOORED6",62,0)
 .S PSOREEDQ=1 D DOLST^PSOORED3,DOSE^PSOORED3 K PSOREEDQ
"RTN","PSOORED6",63,0)
 .I '$O(PSORXED("DOSE",0)) S PSORX("DFLG")=1 Q
"RTN","PSOORED6",64,0)
 .D:$G(PSOSIGFL) M2
"RTN","PSOORED6",65,0)
 S PSORXED("FLD",39.2)=PSOI
"RTN","PSOORED6",66,0)
 Q
"RTN","PSOORED6",67,0)
UPDATE ;add new data to file
"RTN","PSOORED6",68,0)
 N RXREF
"RTN","PSOORED6",69,0)
 Q:'$G(PSORXED("IRXN"))
"RTN","PSOORED6",70,0)
 I $O(PSORXED("FLD",0))!($G(^TMP($J,"INS1",0))]"")!($G(INSDEL))!($O(PSORXED("ODOSE",0))) D  G:'Y UPDX
"RTN","PSOORED6",71,0)
 .K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",72,0)
 .S DIR(0)="Y",DIR("A")="Are You Sure You Want to Update Rx "_$P(^PSRX(PSORXED("IRXN"),0),"^"),DIR("B")="Yes"
"RTN","PSOORED6",73,0)
 .D ^DIR K DIR I 'Y D M1 Q
"RTN","PSOORED6",74,0)
 .I $D(^PSRX(PSORXED("IRXN"),1,0))  D
"RTN","PSOORED6",75,0)
 ..S RXREF=$P(^PSRX(PSORXED("IRXN"),0),"^",9)-$P(^PSRX(PSORXED("IRXN"),1,0),"^",4)
"RTN","PSOORED6",76,0)
 .E  S RXREF=0
"RTN","PSOORED6",77,0)
 .K X,DIRUT,DUOUT,DTOUT
"RTN","PSOORED6",78,0)
 K Y S DA=PSORXED("IRXN"),DIE="^PSRX(",FLD=0
"RTN","PSOORED6",79,0)
 I $D(PSORXED("FLD",39.3)) D UPDATE^PSODIAG  ;update ICD's after edit
"RTN","PSOORED6",80,0)
 K Y S DA=PSORXED("IRXN"),DIE="^PSRX(",FLD=0
"RTN","PSOORED6",81,0)
 F  S FLD=$O(PSORXED("FLD",FLD)) Q:'FLD  D
"RTN","PSOORED6",82,0)
 .I FLD=12!(FLD=24)!(FLD=35) D  Q
"RTN","PSOORED6",83,0)
 ..I FLD=12,PSORXED("FLD",12)="@" S $P(^PSRX(DA,3),"^",7)="" Q
"RTN","PSOORED6",84,0)
 ..I FLD=12,PSORXED("FLD",12)]"" S $P(^PSRX(DA,3),"^",7)=PSORXED("FLD",12) Q
"RTN","PSOORED6",85,0)
 ..I FLD=24,PSORXED("FLD",24)="@" S $P(^PSRX(DA,2),"^",4)="" Q
"RTN","PSOORED6",86,0)
 ..I FLD=24,PSORXED("FLD",24)]"" S $P(^PSRX(DA,2),"^",4)=PSORXED("FLD",24) Q
"RTN","PSOORED6",87,0)
 ..I FLD=35,PSORXED("FLD",35)="@" S $P(^PSRX(DA,"MP"),"^")="" Q
"RTN","PSOORED6",88,0)
 ..I FLD=35,PSORXED("FLD",35)]"" S $P(^PSRX(DA,"MP"),"^")=PSORXED("FLD",35) Q
"RTN","PSOORED6",89,0)
 .I FLD=114 D  Q
"RTN","PSOORED6",90,0)
 ..I PSORXED("FLD",114)="@" K ^PSRX(DA,"INS"),^PSRX(DA,"INS1")
"RTN","PSOORED6",91,0)
 ..I PSORXED("FLD",114)'="@" D
"RTN","PSOORED6",92,0)
 ...S ^PSRX(DA,"INS")=PSORXED("FLD",114)
"RTN","PSOORED6",93,0)
 ...S X=PSORXED("FLD",114) D SIG^PSOHELP Q:$G(INS1)']""
"RTN","PSOORED6",94,0)
 ...S PSORXED("SIG",1)=$E(INS1,2,9999999) K ^PSRX(DA,"INS1")
"RTN","PSOORED6",95,0)
 ...S ^PSRX(DA,"INS1",0)="^52.0115^1^1^"_DT_"^^"
"RTN","PSOORED6",96,0)
 ...S ^PSRX(DA,"INS1",1,0)=PSORXED("SIG",1)
"RTN","PSOORED6",97,0)
 ..D DOLST^PSOORED3 K:PSORXED("FLD",114)="@" PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",98,0)
 .S DR=FLD_"////"_PSORXED("FLD",FLD) D ^DIE
"RTN","PSOORED6",99,0)
 .I FLD=4 D UDPROV^PSOOREDT Q
"RTN","PSOORED6",100,0)
 I $G(INSDEL) K ^PSRX(DA,"INS"),^PSRX(DA,"INS1") D DOLST^PSOORED3 K PSORXED("SIG") D EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3 G UPDX
"RTN","PSOORED6",101,0)
 I $O(^TMP($J,"INS1",0)) D
"RTN","PSOORED6",102,0)
 .K ^PSRX(DA,"INS"),^PSRX(DA,"INS1"),DD,PSORXED("SIG")
"RTN","PSOORED6",103,0)
 .F I=0:0 S I=$O(^TMP($J,"INS1",I)) Q:'I  S (PSORXED("SIG",I),^PSRX(DA,"INS1",I,0))=^TMP($J,"INS1",I,0),DD=$G(DD)+1
"RTN","PSOORED6",104,0)
 .S ^PSRX(DA,"INS1",0)=^TMP($J,"INS1",0)
"RTN","PSOORED6",105,0)
 .I DD=1 S ^PSRX(DA,"INS")=^PSRX(DA,"INS1",1,0)
"RTN","PSOORED6",106,0)
 .D DOLST^PSOORED3,EN^PSOFSIG(.PSORXED),UPDSIG^PSOORED3
"RTN","PSOORED6",107,0)
 ;
"RTN","PSOORED6",108,0)
UPDX K DIE,DA,DR,FLD,X,Y,PSORXED("FLD"),DD,^TMP($J,"INS1")
"RTN","PSOORED6",109,0)
KV K DIR,DIRUT,DTOUT,DUOUT
"RTN","PSOORED6",110,0)
 Q
"RTN","PSOORED6",111,0)
UPD ;updates dosing array
"RTN","PSOORED6",112,0)
 S HENT=ENT
"RTN","PSOORED6",113,0)
UPD1 ;
"RTN","PSOORED6",114,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD
"RTN","PSOORED6",115,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED6",116,0)
 .I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED6",117,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED6",118,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED6",119,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED6",120,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED6",121,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED6",122,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED6",123,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED6",124,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED6",125,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED6",126,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED6",127,0)
 ..K PSORXED("DOSE",(HENT+2)),PSORXED("ODOSE",(HENT+2)),PSORXED("DOSE ORDERED",(HENT+2))
"RTN","PSOORED6",128,0)
 ..K PSORXED("UNITS",(HENT+2)),PSORXED("NOUN",(HENT+2)),PSORXED("DURATION",(HENT+2)),PSORXED("ROUTE",(HENT+2)),PSORXED("SCHEDULE",(HENT+2)),PSORXED("VERB",(HENT+2))
"RTN","PSOORED6",129,0)
 .S HENT=HENT+1
"RTN","PSOORED6",130,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED6",131,0)
 Q
"RTN","PSOORED6",132,0)
M1 D M1^PSOOREDX
"RTN","PSOORED6",133,0)
 Q
"RTN","PSOORED6",134,0)
M2 D M2^PSOOREDX
"RTN","PSOORED6",135,0)
 Q
"RTN","PSOOREDT")
0^41^B59269830
"RTN","PSOOREDT",1,0)
PSOOREDT ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOOREDT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,20,27,37,57,46,78,102,104,119,143**;DEC 1997
"RTN","PSOOREDT",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOOREDT",4,0)
 ;External reference to PSSLOCK supported by DBIA 2789
"RTN","PSOOREDT",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOOREDT",6,0)
SEL K PSOISLKD,PSOLOKED S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY D SVAL K PSOPLCK S VALMBCK="" Q
"RTN","PSOOREDT",7,0)
 K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(+$G(PSODFN)) D SVALO K PSOMSG S VALMBCK="" Q
"RTN","PSOOREDT",8,0)
 K PSOMSG S PSOLOKED=1
"RTN","PSOOREDT",9,0)
 K PSORX("DFLG"),DIR,DUOUT,DIRUT S DIR("A")="Select fields by number",DIR(0)="LO^1:"_$S($G(REF):20,1:19) D ^DIR I $D(DIRUT) K DIR,DIRUT,DTOUT S VALMBCK="" D UL K PSOLOKED Q
"RTN","PSOOREDT",10,0)
EDTSEL N VALMCNT K PSOISLKD,PSORX("DFLG"),PSOOIFLG,PSOMRFLG,DIR,DIRUT,DTOUT,DTOUT,ZONE S (PSOEDIT,PSORXED)=1 I +Y S FST=Y D HLDHDR^PSOLMUTL D  G EX ;PSO LM SELECT MENU protocol
"RTN","PSOOREDT",11,0)
 .I '$G(PSOLOKED) S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY D SVAL K PSOPLCK S VALMBCK="",(PSOISLKD,PSODE)=1 Q
"RTN","PSOOREDT",12,0)
 .I '$G(PSOLOKED) K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(+$G(PSODFN)) D SVALO K PSOMSG S VALMBCK="",(PSOISLKD,PSODE)=1 Q
"RTN","PSOOREDT",13,0)
 .K PSOMSG,PSOPLCK S (NEWEDT,PSOLOKED)=1 D EDT
"RTN","PSOOREDT",14,0)
 E  S VALMBCK="",PSODE=1
"RTN","PSOOREDT",15,0)
EX I $G(PSOISLKD) D UL K PSOISLKD G EX2
"RTN","PSOOREDT",16,0)
 I '$G(PSOSIGFL),'$G(PSORXED("DFLG")) D UPDATE^PSOORED6 D LOG^PSORXED,POST^PSORXED G EX1
"RTN","PSOOREDT",17,0)
 I $G(PSOSIGFL)=1 D  Q:$G(PSORX("FN"))
"RTN","PSOOREDT",18,0)
 .N PSOTMP
"RTN","PSOOREDT",19,0)
 .S PSOTMP=$G(PSOFROM),PSOFROM="NEW"
"RTN","PSOOREDT",20,0)
 .S VALMSG="This change will create a new prescription!"
"RTN","PSOOREDT",21,0)
 .D EN^PSOORED1(.PSORXED)
"RTN","PSOOREDT",22,0)
 .I $G(PSORX("FN")) D  Q
"RTN","PSOOREDT",23,0)
 ..D ^PSOBUILD
"RTN","PSOOREDT",24,0)
 ..K QUIT,PSORX("DFLG"),FST,FLD,IEN,FLN,INCOM,PSOI,PSODRUG,PSOEDIT
"RTN","PSOOREDT",25,0)
 ..K PSORENW,PSOSIGFL,PSOOIFLG,PSOMRFLG,PSODIR,CHK,PSORX("SIG"),PSODE
"RTN","PSOOREDT",26,0)
 ..K PSOTRN,PSORX("EDIT"),PSORXED("FLD"),NEWEDT
"RTN","PSOOREDT",27,0)
 ..D EOJ^PSONEW
"RTN","PSOOREDT",28,0)
 ..D UL K PSOLOKED S VALMBCK="Q"
"RTN","PSOOREDT",29,0)
 .S PSOFROM=PSOTMP I PSOFROM="" K PSOFROM
"RTN","PSOOREDT",30,0)
 ;
"RTN","PSOOREDT",31,0)
EX1 I '$G(PSODE)!('$G(ZONE)) I $G(PSORENW("OIRXN")) D EN^PSOHLSN1(PSORENW("OIRXN"),"XX","","Order edited")
"RTN","PSOOREDT",32,0)
QUIT D UL K PSOLOKED D ^PSOBUILD,ACT^PSOORNE2 D:+^PSRX($P(PSOLST(ORN),"^",2),"STA")=5 EN^PSOCMOPC($P(PSOLST(ORN),"^",2))
"RTN","PSOOREDT",33,0)
 K:'$O(^PSRX($P(PSOLST(ORN),"^",2),1,0)) REF
"RTN","PSOOREDT",34,0)
EX2 S VALMBCK=$S($G(PSORX("FN")):"Q",$G(ZONE):"Q",1:"R") K PSORXED,FST,FLD,IEN,FLN,INCOM,PSOI,PSODRUG,PSOEDIT,PSORENW,PSOSIGFL,PSODIR,CHK,PSORX("SIG"),PSODE,PSOTRN,PSORX("DFLG"),RFED,ZONE,PSORX("EDIT"),PSOOIFLG,PSOMRFLG,SIG,QUIT
"RTN","PSOOREDT",35,0)
 K NEWEDT I $G(VALMBCK)="R" W ! D CLEAN^PSOVER1 H 2
"RTN","PSOOREDT",36,0)
 Q
"RTN","PSOOREDT",37,0)
 ;
"RTN","PSOOREDT",38,0)
EDT S I=0 F  S I=$O(^PSRX($P(PSOLST(ORN),"^",2),1,I)) Q:'I  S PSORXED("RX1")=^PSRX($P(PSOLST(ORN),"^",2),1,I,0)
"RTN","PSOOREDT",39,0)
 S (RX0,PSORXED("RX0"))=^PSRX($P(PSOLST(ORN),"^",2),0),PSORXED("RX2")=$G(^(2)),PSORXED("RX3")=$G(^(3)),PSOSIG=$P(^("SIG"),"^")
"RTN","PSOOREDT",40,0)
 F FLD=1:1:$L(FST,",") Q:$P(FST,",",FLD)']""!($G(PSORXED("DFLG")))!($G(PSORX("DFLG")))  S FLN=+$P(FST,",",FLD) D
"RTN","PSOOREDT",41,0)
 .S PSORXED("DFLG")=0,(DA,PSORXED("IRXN"),PSORENW("OIRXN"))=$P(PSOLST(ORN),"^",2),RX0=^PSRX(PSORXED("IRXN"),0) S:$G(PSOSIG)="" PSOSIG=$P(^("SIG"),"^")
"RTN","PSOOREDT",42,0)
 .I '$G(PSOSIGFL) D
"RTN","PSOOREDT",43,0)
 ..S PSOI=+^PSRX(DA,"OR1"),PSODAYS=$P(RX0,"^",8),PSORXST=+$P($G(^PS(53,$P(RX0,"^",3),0)),"^",7)
"RTN","PSOOREDT",44,0)
 ..I 'PSOI S PSOI=+^PSDRUG($P(RX0,"^",6),2),$P(^PSRX(DA,"OR1"),"^")=PSOI
"RTN","PSOOREDT",45,0)
 ..S:'$G(PSODRUG("IEN")) PSODRUG("IEN")=$P(RX0,"^",6),PSODRUG("NAME")=$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSOOREDT",46,0)
 ..S PSODRUG("OI")=PSOI
"RTN","PSOOREDT",47,0)
 .S PSORX("PROVIDER")=$P(RX0,"^",4),PSORX("PROVIDER NAME")=$P(^VA(200,$P(RX0,"^",4),0),"^"),PSOTRN=$G(^PSRX(DA,"TN"))
"RTN","PSOOREDT",48,0)
 .D:'$G(CHK) POP^PSOSIGNO(DA),CHK Q:$G(PSORXED("DFLG"))
"RTN","PSOOREDT",49,0)
 .S FDR="39.2^"_$S($P(PSOPAR,"^",3):"6",1:"")_";6.5^113^114^3^1^22R^24^8^7^9^4^11;"_$S($P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)):"35;",1:"")_"^10.6^5^20^23^12^PSOCOU^RF"
"RTN","PSOOREDT",50,0)
 .S DR=$P(FDR,"^",FLN) I DR="RF" D REF^PSOORED2 Q
"RTN","PSOOREDT",51,0)
 .I DR="PSOCOU" D PSOCOU^PSOORED6 Q
"RTN","PSOOREDT",52,0)
 .I FLN'>2,'$P(PSOPAR,"^",3) S VALMSG="Check site parameters, Drug data is not editable." Q
"RTN","PSOOREDT",53,0)
 .I FLN=3 D EDTDOSE^PSOORED2 Q
"RTN","PSOOREDT",54,0)
 .I FLN=4 D INS^PSOORED1 Q
"RTN","PSOOREDT",55,0)
 .I FLN=1 D PSOI^PSOORED6 N PSOX S PSORXED=1,PSOX("IRXN")=$S($D(DA):DA,$D(PSORXED("IRXN")):PSORXED("IRXN"),$D(PSORENW("OIRXN")):PSORENW("OIRXN")) D:'$G(PSORXED("DFLG")) EN^PSODIAG Q
"RTN","PSOOREDT",56,0)
 .I FLN=2 D DRG^PSOORED6 N PSOX S PSORXED=1,PSOX("IRXN")=PSORXED("IRXN") D:'$G(PSORXED("DFLG")) EN^PSODIAG S:$O(^PSRX(PSORXED("IRXN"),1,0)) REF=1 Q
"RTN","PSOOREDT",57,0)
 .;I FLN=5 D  Q  ;I POE=1 W !,"Invalid Field Selection",! H 2 Q  ..;D SIG
"RTN","PSOOREDT",58,0)
 .I FLN=12 D PROV Q
"RTN","PSOOREDT",59,0)
 .I FLN=6 D ISDT^PSOORED2 Q
"RTN","PSOOREDT",60,0)
 .I FLN=7 D FLDT^PSOORED2 Q
"RTN","PSOOREDT",61,0)
 .I FLN=9!(FLN=10)!(FLN=11) D NOCHG^PSOORED2 Q
"RTN","PSOOREDT",62,0)
 .S DR=+DR
"RTN","PSOOREDT",63,0)
 .K DIR,DIRUT,DIROUT ;S DIE=52 D ^DIE I $D(Y) S PSORXED("DFLG")=1
"RTN","PSOOREDT",64,0)
 .K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ
"RTN","PSOOREDT",65,0)
 .S DIR("B")=$S($G(PSORXED("FLD",DR))]"":PSORXED("FLD",DR),1:PSORXED(52,DA,DR)),DIR(0)="52,"_DR D ^DIR
"RTN","PSOOREDT",66,0)
 .I DR=24!(DR=12) S PSORXED("FLD",DR)=X
"RTN","PSOOREDT",67,0)
 .I $D(DIRUT) K DIR,DIRUT,DUOUT,DTOUT,PSORXED(52,DA,DR),PSORXED("FLD",DR) Q
"RTN","PSOOREDT",68,0)
 .I DR'=5,X="@" W !,"Data Required!",! K DIC,DIQ,DR,DA,DIR,DIRUT,PSORXED(52,DA,DR),X,Y Q
"RTN","PSOOREDT",69,0)
 .I DR=5,X'="@" S Y=+Y
"RTN","PSOOREDT",70,0)
 .I DR=3!(DR=20)!(DR=23) S Y=+Y
"RTN","PSOOREDT",71,0)
 .S PSORXED("FLD",DR)=$S(X="@":X,1:Y) K DIR,DIRUT,DIROUT,X,Y,PSORXED(52,DA,DR)
"RTN","PSOOREDT",72,0)
 .I DR=11,PSORXED("FLD",DR)="W",$P(PSOPAR,"^",12) D
"RTN","PSOOREDT",73,0)
 ..D FIELD^DID(52,DR,"","LABEL","ZZ") S PSORXED(ZZ("LABEL"))=PSORXED("FLD",DR) K ZZ
"RTN","PSOOREDT",74,0)
 ..S DR=35,DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ,DIRUT,DUOUT,DTOUT
"RTN","PSOOREDT",75,0)
 ..S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR)
"RTN","PSOOREDT",76,0)
 ..S DIR(0)="52,"_(DR) D ^DIR I $D(DIRUT),X'="@" K DIR,DIRUT Q
"RTN","PSOOREDT",77,0)
 ..S PSORXED("FLD",DR)=X K DIR,DIRUT,DIROUT,X,Y,PSORXED(52,DA,DR)
"RTN","PSOOREDT",78,0)
 .I $G(PSORXED("FLD",DR))]"" D FIELD^DID(52,DR,"","LABEL","ZZ") S PSORXED(ZZ("LABEL"))=PSORXED("FLD",DR) K ZZ
"RTN","PSOOREDT",79,0)
 Q:$G(PSOSIGFL)
"RTN","PSOOREDT",80,0)
 S (RX1,I,RFD,RFDT)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFD=I,RFDT=$P(^PSRX(PSORXED("IRXN"),1,I,0),"^"),RX1(I)=$G(RX1(I))+1
"RTN","PSOOREDT",81,0)
 Q
"RTN","PSOOREDT",82,0)
CHK S CHK=1 I $G(^PSDRUG($P(PSORXED("RX0"),"^",6),"I"))]"",^("I")<DT S VALMSG="This drug has been inactivated. ",PSORXED("DFLG")=1 Q
"RTN","PSOOREDT",83,0)
 K PSPOP I $G(PSODIV),$P(PSORXED("RX2"),"^",9)'=PSOSITE S PSPRXN=PSORXED("IRXN") D  Q:PSORXED("DFLG")
"RTN","PSOOREDT",84,0)
 .I '$P(PSOSYS,"^",2) S VALMSG="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is not a valid choice. (Different Division)" S PSORXED("DFLG")=1 Q
"RTN","PSOOREDT",85,0)
 .I $P(PSOSYS,"^",3) K DIR,DUOUT,DTOUT D  K DIR,DUOUT,DTOUT Q
"RTN","PSOOREDT",86,0)
 ..W $C(7) S DIR("A",1)="",DIR("A",2)="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is from another division.",DIR("A")="Continue: (Y/N)",DIR(0)="Y",DIR("?",1)="'Y' FOR YES",DIR("?")="'N' FOR NO"
"RTN","PSOOREDT",87,0)
 ..S DIR("B")="N" D ^DIR I 'Y!($D(DIRUT)) S PSORXED("DFLG")=1 W !
"RTN","PSOOREDT",88,0)
 ;
"RTN","PSOOREDT",89,0)
 I $P(^PSRX(PSORXED("IRXN"),"STA"),"^")=14!($P(^("STA"),"^")=15) S PSORXED("DFLG")=1 S VALMSG="Discontinued prescriptions cannot be edited." Q
"RTN","PSOOREDT",90,0)
 I $P(^PSRX(PSORXED("IRXN"),"STA"),"^")=16 S PSORXED("DFLG")=1 S VALMSG="Prescriptions on Provider Hold cannot be edited." Q
"RTN","PSOOREDT",91,0)
CHKX K PSPOP,DIR,DTOUT,DUOUT,Y,X Q
"RTN","PSOOREDT",92,0)
 Q
"RTN","PSOOREDT",93,0)
PROV ;select provider
"RTN","PSOOREDT",94,0)
 S PSORXED("PROVIDER")=$P(RX0,"^",4),PSORXED("PROVIDER NAME")=$P(^VA(200,$P(RX0,"^",4),0),"^")
"RTN","PSOOREDT",95,0)
 D PROV^PSODIR(.PSORXED) I PSORXED("PROVIDER")'=$P(RX0,"^",4) D
"RTN","PSOOREDT",96,0)
 .K DIR,DIRUT W ! S DIR(0)="Y",DIR("A",1)="You have changed the name of the provider entered for this Rx."
"RTN","PSOOREDT",97,0)
 .S DIR("A",2)="This edit will cause the provider's name to be update for all fills.",DIR("A")="Do you want to continue" D ^DIR
"RTN","PSOOREDT",98,0)
 .I 'Y!$D(DIRUT) K PSORX("PROVIDER"),PSORX("PROVIDER NAME"),PSORX("COSIGNING PROVIDER") Q
"RTN","PSOOREDT",99,0)
 .S PSORXED("FLD",4)=PSORXED("PROVIDER") K DIR,DIRUT,DUOUT
"RTN","PSOOREDT",100,0)
 .S PSORXED("FLD",109)=$G(PSORXED("COSIGNING PROVIDER"))
"RTN","PSOOREDT",101,0)
 Q
"RTN","PSOOREDT",102,0)
UDPROV ;update provider
"RTN","PSOOREDT",103,0)
 S $P(^PSRX(PSORXED("IRXN"),0),"^",4)=PSORXED("PROVIDER"),$P(^(3),"^",3)=$G(PSORX("COSIGNING PROVIDER"))
"RTN","PSOOREDT",104,0)
 F XTY="1","P" F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),XTY,I)) Q:'I  S $P(^PSRX(PSORXED("IRXN"),XTY,I,0),"^",17)=PSORXED("PROVIDER") S:XTY RFED=I
"RTN","PSOOREDT",105,0)
 K XTY,I
"RTN","PSOOREDT",106,0)
 Q
"RTN","PSOOREDT",107,0)
SIG ;edit medication instructions (SIG)
"RTN","PSOOREDT",108,0)
 S PSOFDR=+$P(^PSRX(PSORXED("IRXN"),"SIG"),"^",2) I PSOFDR D
"RTN","PSOOREDT",109,0)
 .F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORXED("IRXN"),"SIG1",I,0)
"RTN","PSOOREDT",110,0)
 E  S PSORX("SIG")=$P(^PSRX(PSORXED("IRXN"),"SIG"),"^")
"RTN","PSOOREDT",111,0)
 D SIG^PSODIR1(.PSORX) D:$G(PSORX("SIG"))]"" EN1^PSOSIGNO(PSORXED("IRXN"),PSORX("SIG"))
"RTN","PSOOREDT",112,0)
 I '$G(PSOSIGFL),$G(PSORX("SIG"))]"" S ^PSRX(PSORXED("IRXN"),"SIG")=PSORX("SIG") K ^PSRX(PSORXED("IRXN"),"SIG1") Q
"RTN","PSOOREDT",113,0)
 S PSOMRFLG=1
"RTN","PSOOREDT",114,0)
 Q
"RTN","PSOOREDT",115,0)
UL ;
"RTN","PSOOREDT",116,0)
 I '$G(PSOLOKED) Q
"RTN","PSOOREDT",117,0)
 D UL^PSSLOCK(PSODFN)
"RTN","PSOOREDT",118,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOOREDT",119,0)
 Q
"RTN","PSOOREDT",120,0)
SVAL ;Set message for patient lock
"RTN","PSOOREDT",121,0)
 S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.")
"RTN","PSOOREDT",122,0)
 Q
"RTN","PSOOREDT",123,0)
SVALO ;Set message for order lock
"RTN","PSOOREDT",124,0)
 S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order.")
"RTN","PSOOREDT",125,0)
 Q
"RTN","PSOOREDT",126,0)
 ;
"RTN","PSOORNEW")
0^44^B67580073
"RTN","PSOORNEW",1,0)
PSOORNEW ;BIR/SAB - display orders from oerr ;07/29/96
"RTN","PSOORNEW",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,23,27,32,55,46,71,90,94,106,131,133,143**;DEC 1997
"RTN","PSOORNEW",3,0)
 ;^PS(50.7 -2223
"RTN","PSOORNEW",4,0)
 ;^PSDRUG -221
"RTN","PSOORNEW",5,0)
 ;^PS(50.606 -2174
"RTN","PSOORNEW",6,0)
 ;^PS(55 -2228
"RTN","PSOORNEW",7,0)
DSPL I $G(PSODSPL) S VALMBCK="Q" K PSODSPL,PSOANSQD Q
"RTN","PSOORNEW",8,0)
 Q:'$D(PSOLMC)  K ^TMP("PSOPO",$J) S PSOLMC=PSOLMC+1
"RTN","PSOORNEW",9,0)
 I $D(CLOZPAT) S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),1:7) G OI
"RTN","PSOORNEW",10,0)
 S PSONEW("DAYS SUPPLY")=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3))&('$G(PSONEW("DAYS SUPPLY"))):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:30)
"RTN","PSOORNEW",11,0)
OI I '$G(PSODRUG("OI")) D
"RTN","PSOORNEW",12,0)
 .S (OI,PSODRUG("OI"))=$P(OR0,"^",8),PSODRUG("OIN")=$P(^PS(50.7,$P(OR0,"^",8),0),"^"),OID=$P(OR0,"^",9)
"RTN","PSOORNEW",13,0)
 .I $P($G(OR0),"^",9) S POERR=1,DREN=$P(OR0,"^",9) D DRG^PSOORDRG K POERR
"RTN","PSOORNEW",14,0)
 I '$D(CLOZPAT) I $G(PSODRUG("DEA"))["A",$G(PSODRUG("DEA"))'["B"!($G(PSODRUG("DEA"))["F") S PSONEW("# OF REFILLS")=0
"RTN","PSOORNEW",15,0)
 I $D(CLOZPAT) S PSONEW("# OF REFILLS")=$S($D(PSONEW("# OF REFILLS")):PSONEW("# OF REFILLS"),$G(CLOZPAT)=1&($P(OR0,"^",11)<1):0,1:1)
"RTN","PSOORNEW",16,0)
 S IEN=0 D OBX^PSOORFI1,DIN^PSONFI(PSODRUG("OI"),$S($G(PSODRUG("IEN")):PSODRUG("IEN"),1:""))
"RTN","PSOORNEW",17,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="*(1) Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORNEW",18,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",19,0)
 K LST I $G(PSODRUG("NAME"))]"" D  G PT
"RTN","PSOORNEW",20,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)"_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORNEW",21,0)
 .S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORNEW",22,0)
 .I $P($G(^PSDRUG(PSODRUG("IEN"),0)),"^",10)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Drug Message:" D DRGMSG
"RTN","PSOORNEW",23,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)           Drug: No Dispense Drug Selected"
"RTN","PSOORNEW",24,0)
PT D DOSE2^PSOORFI4
"RTN","PSOORNEW",25,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (4)   Pat Instruct:" D:$O(PSONEW("SIG",0)) INST^PSOORFI4
"RTN","PSOORNEW",26,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Provider Comments:" S TY=3 D INST^PSOORFI1
"RTN","PSOORNEW",27,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Instructions:" S TY=2 D INST^PSOORFI1
"RTN","PSOORNEW",28,0)
 K PSOELSE S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                SIG:"
"RTN","PSOORNEW",29,0)
 F I=0:0 S I=$O(SIG(I)) Q:'I  S SIG=SIG(I) D
"RTN","PSOORNEW",30,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNEW",31,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (5) Patient Status: "_$P($G(^PS(53,+PSONEW("PATIENT STATUS"),0)),"^")
"RTN","PSOORNEW",32,0)
 K PSOELSE I $G(PSONEW("ISSUE DATE"))']"" S PSOELSE=1 S IEN=IEN+1,(PSOID,Y)=$E($P(OR0,"^",6),1,7) X ^DD("DD") S PSONEW("ISSUE DATE")=Y,^TMP("PSOPO",$J,IEN,0)=" (4)     Issue Date: "_Y
"RTN","PSOORNEW",33,0)
 I '$G(PSOELSE) S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (6)     Issue Date: "_PSONEW("ISSUE DATE")
"RTN","PSOORNEW",34,0)
 K PSOELSE I $G(PSORX("FILL DATE"))']"" S PSOELSE=1 D
"RTN","PSOORNEW",35,0)
 .S (Y,PSORX("FILL DATE"))=$S($E($P(OR0,"^",6),1,7)<DT:DT,1:$E($P(OR0,"^",6),1,7)) X ^DD("DD") S PSONEW("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"                  (5) Fill Date: "_Y
"RTN","PSOORNEW",36,0)
 I '$G(PSOELSE) S Y=PSORX("FILL DATE") X ^DD("DD") S PSORX("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"       (7) Fill Date: "_PSORX("FILL DATE")
"RTN","PSOORNEW",37,0)
 I $P(OR0,"^",18) S IEN=IEN+1,Y=$P(OR0,"^",18) X ^DD("DD") S $P(^TMP("PSOPO",$J,IEN,0)," ",39)="Effective Date: "_Y
"RTN","PSOORNEW",38,0)
 I $G(CLOZPAT)=1 D ELIG^PSOORFI2
"RTN","PSOORNEW",39,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (8)    Days Supply: "_PSONEW("DAYS SUPPLY")
"RTN","PSOORNEW",40,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"               (9)   QTY"_$S($P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)]"":" ("_$P($G(^PSDRUG(+PSODRUG("IEN"),660)),"^",8)_")",1:" (  )")
"RTN","PSOORNEW",41,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_": "_$S($G(PSONEW("QTY")):PSONEW("QTY"),1:$P(OR0,"^",10))
"RTN","PSOORNEW",42,0)
 I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),5)),"^")]"" D
"RTN","PSOORNEW",43,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNEW",44,0)
 .S ^TMP("PSOPO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^") K RN
"RTN","PSOORNEW",45,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Provider ordered "_+$P(OR0,"^",11)_" refills"
"RTN","PSOORNEW",46,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(10)   # of Refills: "_$S($G(PSONEW("# OF REFILLS"))]"":PSONEW("# OF REFILLS"),1:$P(OR0,"^",11))_"               (11)   Routing: "_$S($G(PSONEW("MAIL/WINDOW"))="M":"MAIL",1:"WINDOW")
"RTN","PSOORNEW",47,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(12)         Clinic: "_PSORX("CLINIC")
"RTN","PSOORNEW",48,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(13)       Provider: "_PSONEW("PROVIDER NAME")
"RTN","PSOORNEW",49,0)
 I $P($G(^VA(200,$S($G(PSONEW("PROVIDER")):PSONEW("PROVIDER"),1:$P(OR0,"^",5)),"PS")),"^",7)&($P($G(^("PS")),"^",8)) D
"RTN","PSOORNEW",50,0)
 .S IEN=IEN+1,PSONEW("COSIGNING PROVIDER")=$S($G(PSONEW("COSIGNING PROVIDER")):PSONEW("COSIGNING PROVIDER"),1:$P(^("PS"),"^",8))
"RTN","PSOORNEW",51,0)
 .S ^TMP("PSOPO",$J,IEN,0)="       Cos-Provider: "_$P(^VA(200,PSONEW("COSIGNING PROVIDER"),0),"^")
"RTN","PSOORNEW",52,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(14)         Copies: "_$S($G(PSONEW("COPIES")):PSONEW("COPIES"),1:1)
"RTN","PSOORNEW",53,0)
 S PSONEW("REMARKS")=$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),$P(OR0,"^",17)="C":"Administered in Clinic.",1:"")
"RTN","PSOORNEW",54,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(15)        Remarks:"
"RTN","PSOORNEW",55,0)
 I $G(PSONEW("REMARKS"))]"" D
"RTN","PSOORNEW",56,0)
 .F SG=1:1:$L(PSONEW("REMARKS")) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P(PSONEW("REMARKS")," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",57,0)
 ..S:$P(PSONEW("REMARKS")," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P(PSONEW("REMARKS")," ",SG)
"RTN","PSOORNEW",58,0)
 I $G(PSOSIGFL)!(PSODRUG("OI")'=$P(OR0,"^",8)) S PSONEW("CLERK CODE")=DUZ,PSORX("CLERK CODE")=$P(^VA(200,DUZ,0),"^"),VALMSG="This change will create a new prescription!"
"RTN","PSOORNEW",59,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_$P(^VA(200,PSONEW("CLERK CODE"),0),"^")_$E(RN,$L($P(^VA(200,PSONEW("CLERK CODE"),0),"^"))+1,35)
"RTN","PSOORNEW",60,0)
 S Y=$P(OR0,"^",12) X ^DD("DD") S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$E($P(OR0,"^",12),4,5)_"/"_$E($P(OR0,"^",12),6,7)_"/"_$E($P(OR0,"^",12),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORNEW",61,0)
 I PSOLMC<2 D ^PSOLMPO1 S VALMBCK="Q",PSOLMC=0
"RTN","PSOORNEW",62,0)
 S:PSOLMC>1 VALMBCK="R"
"RTN","PSOORNEW",63,0)
 Q
"RTN","PSOORNEW",64,0)
ORCHK D PROVCOM^PSOORFI4,ORCHK^PSOORFI4
"RTN","PSOORNEW",65,0)
 Q
"RTN","PSOORNEW",66,0)
EDT D KV S DIR("A",1)="* Indicates which fields will create an new Order",DIR("A")="Select Field to Edit by number",DIR(0)="LO^1:15" D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOORNEW",67,0)
EDTSEL N LST,FLD,OUT D KV S OUT=0
"RTN","PSOORNEW",68,0)
 I +Y S LST=Y D FULL^VALM1 N PSODOSE M PSODOSE=PSONEW D  G DSPL
"RTN","PSOORNEW",69,0)
 .F FLD=1:1:$L(LST,",") Q:$P(LST,",",FLD)']""!(OUT)  D @(+$P(LST,",",FLD)) D:$P(LST,",",FLD)=8 REF D KV
"RTN","PSOORNEW",70,0)
 E  S VALMBCK="" Q
"RTN","PSOORNEW",71,0)
 Q
"RTN","PSOORNEW",72,0)
ACP S (PSODIR("DFLG"),PSORX("DFLG"),PSODIR("QFLD"))=0,ACP=1 D ORCHK
"RTN","PSOORNEW",73,0)
 G:$G(PSONEW("QFLG")) DSPL
"RTN","PSOORNEW",74,0)
 I $G(PSODIR("DFLG"))!$G(PSORX("DFLG")) Q
"RTN","PSOORNEW",75,0)
 I $G(PSONEW("FLD"))!($G(PSODRUG("NAME"))']"")!('$O(SIG(0))) G DSPL
"RTN","PSOORNEW",76,0)
 I $G(PSODRUG("NAME"))]"",'$G(ORCHK)!($G(ORDRG)'=PSODRUG("NAME")) D  I $G(PSORX("DFLG")) D CLEAN^PSOVER1 G DSPL
"RTN","PSOORNEW",77,0)
 .D POST^PSODRG S:'$G(PSORX("DFLG")) ORCHK=1,ORDRG=PSODRUG("NAME")
"RTN","PSOORNEW",78,0)
 I '$D(PSONEW("RX #")) S PSOFROM="NEW",RTN=$S($P($G(PSOPAR),"^",7):"AUTO^PSONRXN",1:"MANUAL^PSONRXN") D @RTN Q:PSONEW("QFLG")  I '$P($G(PSOPAR),"^",7) S PSOX=PSONEW("RX #") D CHECK^PSONRXN
"RTN","PSOORNEW",79,0)
 D RXNCHK^PSOORNE1 I $G(PSONEW("QFLG")) S PSONEW("DFLG")=1 Q
"RTN","PSOORNEW",80,0)
 D STOP^PSONEW2,DISPLAY^PSONEW2,^PSONEWF
"RTN","PSOORNEW",81,0)
 I $G(PSOCPZ("DFLG")) W !!,"No action taken!",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR,KV K PSOCPZ("DFLG"),DRET,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",82,0)
 K PSOCPZ("DFLG") D KV S DIR(0)="Y",DIR("A")="Are you sure you want to Accept this Order",DIR("B")="NO" D ^DIR I $D(DIRUT) D KV K DRET,PSOANSQ,PSOANSQD S VALMBCK="Q" Q
"RTN","PSOORNEW",83,0)
 D KV I 'Y K PSOANSQ G DSPL
"RTN","PSOORNEW",84,0)
 I $G(PSONEW("MAIL/WINDOW"))["W" D:$P($G(PSOPAR),"^",12)  S BINGCRT="Y",BINGRTE="W",PSORX("MAIL/WINDOW")="WINDOW" K RTN
"RTN","PSOORNEW",85,0)
 .W ! K DIR,DIRUT S DIR(0)="52,35O"
"RTN","PSOORNEW",86,0)
 .S:$G(PSORX("METHOD OF PICK-UP"))]"" DIR("B")=PSORX("METHOD OF PICK-UP") D ^DIR I $D(DIRUT) K DIR,DIRUT Q
"RTN","PSOORNEW",87,0)
 .S (PSONEW("METHOD OF PICK-UP"),PSORX("METHOD OF PICK-UP"))=Y K X,Y
"RTN","PSOORNEW",88,0)
 S PSONEW("POE")=1 D EN^PSON52(.PSONEW) G:$G(PSONEW("DFLG")) ABORT D DCORD^PSONEW2
"RTN","PSOORNEW",89,0)
 D NPSOSD^PSOUTIL(.PSONEW),FULL^VALM1 K PSORX("MAIL/WINDOW")
"RTN","PSOORNEW",90,0)
 D EOJ^PSONEW
"RTN","PSOORNEW",91,0)
ABORT S VALMBCK="Q",DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR,CLEAN^PSOVER1,KV
"RTN","PSOORNEW",92,0)
 Q
"RTN","PSOORNEW",93,0)
KV K DIRUT,DUOUT,DTOUT,DIR
"RTN","PSOORNEW",94,0)
 Q
"RTN","PSOORNEW",95,0)
REF Q:$G(PSODRUG("DEA"))']""
"RTN","PSOORNEW",96,0)
 S CS=0 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S CS=1
"RTN","PSOORNEW",97,0)
 S PTRF=PSONEW("# OF REFILLS"),PSDAYS=PSONEW("DAYS SUPPLY")
"RTN","PSOORNEW",98,0)
 I CS D
"RTN","PSOORNEW",99,0)
 .S PSOX1=$S(PTRF>5:5,1:PTRF),PSOX=$S(PSOX1=5:5,1:PSOX1)
"RTN","PSOORNEW",100,0)
 .S PSOX=$S('PSOX:0,PSDAYS=90:1,1:PSOX),PSDY1=$S(PSDAYS<60:5,PSDAYS'<60&(PSDAYS'>89):2,PSDAYS=90:1,1:0)
"RTN","PSOORNEW",101,0)
 E  D
"RTN","PSOORNEW",102,0)
 .S PSOX1=PTRF,PSOX=$S(PSOX1=11:11,1:PSOX1),PSOX=$S('PSOX:0,PSDAYS=90:3,1:PSOX)
"RTN","PSOORNEW",103,0)
 .S PSDY1=$S(PSDAYS<60:11,PSDAYS'<60&(PSDAYS'>89):5,PSDAYS=90:3,1:0)
"RTN","PSOORNEW",104,0)
 S PSONEW("# OF REFILLS")=$S(PSONEW("# OF REFILLS")>PSDY1:PSDY1,1:PSONEW("# OF REFILLS"))
"RTN","PSOORNEW",105,0)
 Q
"RTN","PSOORNEW",106,0)
1 N PSOBDR,PSOBDRG S PSOBDRG=1 D 1^PSOORNW2 Q  ;oi
"RTN","PSOORNEW",107,0)
 ;
"RTN","PSOORNEW",108,0)
4 D INS^PSOORNW2 Q
"RTN","PSOORNEW",109,0)
 ;
"RTN","PSOORNEW",110,0)
3 D DOSE^PSOORED4(.PSONEW) Q
"RTN","PSOORNEW",111,0)
 ;
"RTN","PSOORNEW",112,0)
6 D 4^PSOORNW2 Q  ;idt
"RTN","PSOORNEW",113,0)
 ;
"RTN","PSOORNEW",114,0)
7 D 5^PSOORNW2 Q  ;fdt
"RTN","PSOORNEW",115,0)
 ;
"RTN","PSOORNEW",116,0)
5 D 3^PSOORNW2 Q  ;pstat
"RTN","PSOORNEW",117,0)
 ;
"RTN","PSOORNEW",118,0)
13 D 12^PSOORNW2 Q  ;doc
"RTN","PSOORNEW",119,0)
 ;
"RTN","PSOORNEW",120,0)
12 D 11^PSOORNW2 Q  ;cli
"RTN","PSOORNEW",121,0)
 ;
"RTN","PSOORNEW",122,0)
2 N PSOCSIG I '$G(PSOBDRG) N PSOBDR,PSOBDRG S PSOBDRG=1
"RTN","PSOORNEW",123,0)
 D 2^PSOORNW1 Q:$G(PSOQFLG)  D EN^PSODIAG  ;drg/ICD
"RTN","PSOORNEW",124,0)
 I $G(PSOCSIG) K PSOCSIG G 3
"RTN","PSOORNEW",125,0)
 Q
"RTN","PSOORNEW",126,0)
 ;
"RTN","PSOORNEW",127,0)
9 D 8^PSOORNW2 Q  ;qty
"RTN","PSOORNEW",128,0)
 ;
"RTN","PSOORNEW",129,0)
8 D 7^PSOORNW2 Q  ;ds
"RTN","PSOORNEW",130,0)
 ;
"RTN","PSOORNEW",131,0)
10 D 9^PSOORNW2 Q  ;#rfs
"RTN","PSOORNEW",132,0)
 ;
"RTN","PSOORNEW",133,0)
14 D 13^PSOORNW2 Q  ;cop
"RTN","PSOORNEW",134,0)
 ;
"RTN","PSOORNEW",135,0)
11 D 10^PSOORNW2 Q  ;m/w
"RTN","PSOORNEW",136,0)
 ;
"RTN","PSOORNEW",137,0)
15 D 14^PSOORNW2 Q  ;rem
"RTN","PSOORNEW",138,0)
 ;
"RTN","PSOORNEW",139,0)
DRGMSG ;
"RTN","PSOORNEW",140,0)
 F SG=1:1:$L($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)) S:$L(^TMP("PSOPO",$J,IEN,0)_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOPO",$J,IEN,0)," ",20)=" " D
"RTN","PSOORNEW",141,0)
 .S:$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)'="" ^TMP("PSOPO",$J,IEN,0)=$G(^TMP("PSOPO",$J,IEN,0))_" "_$P($P(^PSDRUG(PSODRUG("IEN"),0),"^",10)," ",SG)
"RTN","PSOORNEW",142,0)
 K SG Q
"RTN","PSOPTPST")
0^30^B26961793
"RTN","PSOPTPST",1,0)
PSOPTPST ;BIR/DSD - Post Patient Selection Action ;07/25/96
"RTN","PSOPTPST",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,71,88,146,157,143**;DEC 1997
"RTN","PSOPTPST",3,0)
 ;External reference to SDCO22 supported by DBIA 1579
"RTN","PSOPTPST",4,0)
 ;External reference to IBE(350.1,"ANEW" supported by DBIA 592
"RTN","PSOPTPST",5,0)
 ;External reference to PS(55 supported by DBIA 2228
"RTN","PSOPTPST",6,0)
 ;External reference to IBARX supported by DBIA 125
"RTN","PSOPTPST",7,0)
START S PSOQFLG=0
"RTN","PSOPTPST",8,0)
 D GET ; Gets data from Patient file
"RTN","PSOPTPST",9,0)
 D DEAD G:PSOQFLG END ; Checks to see if patient still alive
"RTN","PSOPTPST",10,0)
 G:$G(PSOFROM("PTLKUP"))']"" END ; skips questions if not called by RX data entry
"RTN","PSOPTPST",11,0)
 D INP G:PSOQFLG END ;Checks to see if inpatient and whether to continue
"RTN","PSOPTPST",12,0)
 D CNH G:PSOQFLG END ; Checks to see if nursing home patient
"RTN","PSOPTPST",13,0)
 D ELIG ; Checks eligibility
"RTN","PSOPTPST",14,0)
 D:$G(DUZ("AG"))="V" COPAY ; Deals with copay
"RTN","PSOPTPST",15,0)
 D ADDRESS ; Display address information
"RTN","PSOPTPST",16,0)
 D:$G(^PS(55,PSODFN,1))]"" REMARKS ; Displays narrative about patient
"RTN","PSOPTPST",17,0)
END D EOJ
"RTN","PSOPTPST",18,0)
 Q
"RTN","PSOPTPST",19,0)
 ;----------------------------------------------------------
"RTN","PSOPTPST",20,0)
GET K DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=".1;.172;.351;.361;148",DIQ="PSOPTPST"
"RTN","PSOPTPST",21,0)
 D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","PSOPTPST",22,0)
 Q
"RTN","PSOPTPST",23,0)
 ;
"RTN","PSOPTPST",24,0)
DEAD ;
"RTN","PSOPTPST",25,0)
 I $G(PSOPTPST(2,PSODFN,.351))]"" S (PSODEATH,PSOQFLG)=1 S SSN=$P(^DPT(PSODFN,0),"^",9) W !?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_") DIED "_PSOPTPST(2,PSODFN,.351),! S:$G(POERR) POERR("DEAD")=1 D
"RTN","PSOPTPST",26,0)
 .;I '$O(^PS(55,PSODFN,"P","A",DT)) Q
"RTN","PSOPTPST",27,0)
 .S ACOM="Date of Death "_PSOPTPST(2,PSODFN,.351)_".",ZTRTN="CAN^PSOCAN3",ZTDESC="Outpatient Pharmacy Autocancel Due to Death of Patient",ZTSAVE("ACOM")="",ZTSAVE("PSODFN")="",ZTSAVE("PSODEATH")=""
"RTN","PSOPTPST",28,0)
 .S ZTIO="",PSOCLC=DUZ,ZTSAVE("PSOCLC")="",ZTDTH=$H D ^%ZTLOAD K ACOM,ZTSK,PSODEATH
"RTN","PSOPTPST",29,0)
 Q
"RTN","PSOPTPST",30,0)
 ;
"RTN","PSOPTPST",31,0)
INP I '$G(PSOXFLG),'$G(PSOFIN),$G(PSOPTPST(2,PSODFN,.1))]"" S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSOPTPST",32,0)
 I $G(PSOPTPST(2,PSODFN,.1))]"" W !?10,$C(7),"Patient is an Inpatient on Ward "_PSOPTPST(2,PSODFN,.1)_" !!" D DIR
"RTN","PSOPTPST",33,0)
 Q
"RTN","PSOPTPST",34,0)
TPB ;
"RTN","PSOPTPST",35,0)
 N PSOTPSSN
"RTN","PSOPTPST",36,0)
 I '$G(PSODFN) Q
"RTN","PSOPTPST",37,0)
 I $D(^PS(52.91,PSODFN,0)) I '$P(^PS(52.91,PSODFN,0),"^",3)!($P(^(0),"^",3)>DT) D
"RTN","PSOPTPST",38,0)
 .S PSOTPSSN=$P($G(^DPT(PSODFN,0)),"^",9)
"RTN","PSOPTPST",39,0)
 .I $G(PSOFIN)!($G(MEDP)) D
"RTN","PSOPTPST",40,0)
 ..I $G(MEDP) W !!?10,$C(7),$P($G(^DPT(PSODFN,0)),"^")_" ("_$E(PSOTPSSN,1,3)_"-"_$E(PSOTPSSN,4,5)_"-"_$E(PSOTPSSN,6,9)_")" Q
"RTN","PSOPTPST",41,0)
 ..I $G(PSOFIN) I $G(PSOPTPST(2,PSODFN,148))="YES"!($G(PSOPTPST(2,PSODFN,.1))]"") W !!?10,$C(7),$P($G(^DPT(PSODFN,0)),"^")_" ("_$E(PSOTPSSN,1,3)_"-"_$E(PSOTPSSN,4,5)_"-"_$E(PSOTPSSN,6,9)_")"
"RTN","PSOPTPST",42,0)
 .I '$G(PSOFIN),'$G(MEDP) W !
"RTN","PSOPTPST",43,0)
 .W !?10,"Patient is eligible for the Transitional Pharmacy Benefit!!" D DIR
"RTN","PSOPTPST",44,0)
 Q
"RTN","PSOPTPST",45,0)
 ;
"RTN","PSOPTPST",46,0)
CNH I $G(MEDP),$G(PSOPTPST(2,PSODFN,148))="YES",$G(PSOPTPST(2,PSODFN,.1))']"" D
"RTN","PSOPTPST",47,0)
 .S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSOPTPST",48,0)
 K PSORX("CNH") I $G(PSOPTPST(2,PSODFN,148))="YES" W !?10,$C(7),"Patient is in a Contract Nursing Home !!" D DIR S:'$G(PSOQFLG) PSORX("CNH")=1
"RTN","PSOPTPST",49,0)
 Q
"RTN","PSOPTPST",50,0)
 ;
"RTN","PSOPTPST",51,0)
ELIG I $G(PSOPTPST(2,PSODFN,.361))]"",$G(PSOPTPST(2,PSODFN,.172))'="I" W !,"MAS Eligibility: "_PSOPTPST(2,PSODFN,.361)
"RTN","PSOPTPST",52,0)
 S DFN=PSODFN D RE^PSODEM
"RTN","PSOPTPST",53,0)
 Q
"RTN","PSOPTPST",54,0)
 ;
"RTN","PSOPTPST",55,0)
COPAY K PSOBILL,PSOCPAY S DFN=PSODFN,(X,PSOPTIB)=$P($G(^PS(59,+PSOSITE,"IB")),"^")_"^"_PSODFN D XTYPE^IBARX
"RTN","PSOPTPST",56,0)
 I '$D(^IBE(350.1,"ANEW",+PSOPTIB,1,1)) S PSOQFLG=1 D  K PSOPTIB Q
"RTN","PSOPTPST",57,0)
 .W $C(7),!!,"There is a problem with the IB SERVICE/SECTION entry in your Pharmacy Site File."
"RTN","PSOPTPST",58,0)
 .W !,"You will not be able to enter any new prescriptions until this is corrected!",!
"RTN","PSOPTPST",59,0)
 S (ACTYP,BL)="",(PSOBILL,PSOCPAY)=0 I +Y=-1 W !,"ERROR IN COPAY ELIGIBILITY ENCOUNTERED." G COPAYX
"RTN","PSOPTPST",60,0)
COPAY1 S ACTYP=$O(Y(ACTYP)) G:'ACTYP COPAYX F III=0:0 S BL=$O(Y(ACTYP,BL)) Q:BL=""  I BL>0 S PSOBILL=BL,PSOCPAY=BL_"^"_Y(ACTYP,BL)
"RTN","PSOPTPST",61,0)
 G COPAY1
"RTN","PSOPTPST",62,0)
COPAYX K X,Y,ACTYP,BL,III,PSOPTIB
"RTN","PSOPTPST",63,0)
 ;I $G(PSOBILL) 
"RTN","PSOPTPST",64,0)
 D QST
"RTN","PSOPTPST",65,0)
 Q
"RTN","PSOPTPST",66,0)
 ;
"RTN","PSOPTPST",67,0)
ADDRESS N DFN S (DA,DFN)=PSODFN D ADD^VADPT K DFN,PSOI,DA,DR
"RTN","PSOPTPST",68,0)
 Q
"RTN","PSOPTPST",69,0)
 ;
"RTN","PSOPTPST",70,0)
REMARKS S PSOX=$G(^PS(55,PSODFN,1)) W !!,?5
"RTN","PSOPTPST",71,0)
 F PSOI=1:1 Q:$P(PSOX," ",PSOI,900)=""  W:$X+$L($P(PSOX," ",PSOI))+$L(" ")>IOM !?5 W $P(PSOX," ",PSOI)_" "
"RTN","PSOPTPST",72,0)
 K PSOX,PSOI
"RTN","PSOPTPST",73,0)
 Q
"RTN","PSOPTPST",74,0)
 ;
"RTN","PSOPTPST",75,0)
DIR K DIR W !
"RTN","PSOPTPST",76,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do You Want To Continue" D ^DIR K DIR
"RTN","PSOPTPST",77,0)
 S:'Y PSOQFLG=1 K X,Y,DIRUT,DTOUT,DUOUT
"RTN","PSOPTPST",78,0)
 Q
"RTN","PSOPTPST",79,0)
 ;
"RTN","PSOPTPST",80,0)
EOJ K:PSOQFLG PSORX("CNH") K PSOPTPST,VAPA
"RTN","PSOPTPST",81,0)
 Q
"RTN","PSOPTPST",82,0)
QST ;Ask new questions for Copay
"RTN","PSOPTPST",83,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSOPTPST",84,0)
 K PSOIBQS
"RTN","PSOPTPST",85,0)
 I $G(PSOBILL) S PSOIBQS(PSODFN,"SC")=""
"RTN","PSOPTPST",86,0)
 S PSOIBQS(PSODFN,"SC>50")=""
"RTN","PSOPTPST",87,0)
 I +$P($$CVEDT^DGCV(PSODFN),"^",3) S PSOIBQS(PSODFN,"CV")=""
"RTN","PSOPTPST",88,0)
 I $$AO^SDCO22(PSODFN) S PSOIBQS(PSODFN,"VEH")=""
"RTN","PSOPTPST",89,0)
 I $$IR^SDCO22(PSODFN) S PSOIBQS(PSODFN,"RAD")=""
"RTN","PSOPTPST",90,0)
 I $$EC^SDCO22(PSODFN) S PSOIBQS(PSODFN,"PGW")=""
"RTN","PSOPTPST",91,0)
 I $P($$GETSTAT^DGMSTAPI(PSODFN),"^",2)="Y" S PSOIBQS(PSODFN,"MST")=""
"RTN","PSOPTPST",92,0)
 I $T(GETCUR^DGNTAPI)]"" N PSONCP,PSONCPX S PSONCPX=$$GETCUR^DGNTAPI(PSODFN,"PSONCP") I $P($G(PSONCP("IND")),"^")="Y" S PSOIBQS(PSODFN,"HNC")=""
"RTN","PSOPTPST",93,0)
 Q
"RTN","PSORENW1")
0^36^B54536370
"RTN","PSORENW1",1,0)
PSORENW1 ;BIR/DSD - Renew Main Driver Continuation ;03/29/93
"RTN","PSORENW1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**20,37,51,46,71,117,157,143**;DEC 1997
"RTN","PSORENW1",3,0)
 ;External reference ^VA(200 supported by DBIA 10060
"RTN","PSORENW1",4,0)
 ;External reference VADPT supported by DBIA 10061
"RTN","PSORENW1",5,0)
 ;
"RTN","PSORENW1",6,0)
START ;
"RTN","PSORENW1",7,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN")),SIGOK=+$P($G(^("SIG")),"^",2)
"RTN","PSORENW1",8,0)
 S PSOIBOLD=$G(PSORENW("OIRXN"))
"RTN","PSORENW1",9,0)
 K PSOSCP,PSOANSQ("SC>50") D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) S:PSOSCP=""&($P(VAEL(3),U,1)=1) PSOSCP=0 K VAEL
"RTN","PSORENW1",10,0)
 D SETIB
"RTN","PSORENW1",11,0)
 S PSORENW("PROVIDER")=$P(PSORENW("RX0"),"^",4)
"RTN","PSORENW1",12,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW1",13,0)
 S PSORENW("CLINIC")=$P(PSORENW("RX0"),"^",5),PSORENW("COPIES")=$P(PSORENW("RX0"),"^",18)
"RTN","PSORENW1",14,0)
 I $G(PSOFDR),$P($G(OR0),"^",13) S PSORENW("CLINIC")=$P($G(OR0),"^",13)
"RTN","PSORENW1",15,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",16,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^")
"RTN","PSORENW1",17,0)
 S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW1",18,0)
 S (PSODFN,PSORENW("PSODFN"))=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW1",19,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",20,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6)
"RTN","PSORENW1",21,0)
 S PSORENW("INS")=$S($G(PSORENW("INS"))]"":PSORENW("INS"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW1",22,0)
 S D=0 F  S D=$O(^PSRX(PSORENW("OIRXN"),"INS1",D)) Q:'D  S PSORENW("SIG",D)=^PSRX(PSORENW("OIRXN"),"INS1",D,0)
"RTN","PSORENW1",23,0)
 I '$O(PSORENW("SIG",0)),$G(PSORENW("INS"))]"" S PSORENW("SIG",1)=PSORENW("INS")
"RTN","PSORENW1",24,0)
 G:$G(PSORENW("ENT")) FDR
"RTN","PSORENW1",25,0)
 I $G(PSORENW("ENT"))'>0,'$O(^PSRX(PSORENW("OIRXN"),6,0)) S PSORENW("ENT")=0 G FDR
"RTN","PSORENW1",26,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW1",27,0)
 .S PSORENW("ENT")=$G(PSORENW("ENT"))+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW1",28,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW1",29,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW1",30,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW1",31,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",32,0)
 .K DOSE
"RTN","PSORENW1",33,0)
FDR I $G(PSOFDR) D
"RTN","PSORENW1",34,0)
 .F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",I)=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",35,0)
 .S $P(PSORENW("RX0"),"^",7)=$P(OR0,"^",10),$P(PSORENW("RX0"),"^",11)=$P(OR0,"^",17)
"RTN","PSORENW1",36,0)
 .S (PSORX("PROVIDER NAME"),PSORENW("PROVIDER NAME"))=$P(^VA(200,$P(OR0,"^",5),0),"^"),PSORENW("PROVIDER")=$P(OR0,"^",5)
"RTN","PSORENW1",37,0)
 .K PSORENW("COSIGNING PROVIDER")
"RTN","PSORENW1",38,0)
 .I $G(PSORENW("PROVIDER")),$P($G(^VA(200,PSORENW("PROVIDER"),"PS")),"^",7),$P($G(^("PS")),"^",8) S PSORENW("COSIGNING PROVIDER")=$P($G(^("PS")),"^",8)
"RTN","PSORENW1",39,0)
 .S (PSDY,PSORENW("DAYS SUPPLY"))=$P(PSORENW("RX0"),"^",8)
"RTN","PSORENW1",40,0)
 .S POERR=1,DREN=$P(PSORENW("RX0"),"^",6) D DRG^PSOORDRG K POERR S PSODIR("CS")=0
"RTN","PSORENW1",41,0)
 .F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S PSODIR("CS")=1
"RTN","PSORENW1",42,0)
 .I PSODIR("CS") S RFMX=$S(PSDY<60:5,PSDY'<60&(PSDY'>89):2,PSDY=90:1,1:0)
"RTN","PSORENW1",43,0)
 .E  S RFMX=$S(PSDY<60:11,PSDY'<60&(PSDY'>89):5,PSDY=90:3,1:0)
"RTN","PSORENW1",44,0)
 .S $P(PSORENW("RX0"),"^",9)=$S($P(OR0,"^",11)'>RFMX:$P(OR0,"^",11),1:RFMX),$P(OR0,"^",11)=$P(PSORENW("RX0"),"^",9)
"RTN","PSORENW1",45,0)
 .K RFMX,PSODIR("CS"),PSDY
"RTN","PSORENW1",46,0)
END Q
"RTN","PSORENW1",47,0)
STOP K PSEXDT,X,%DT S PSON52("QFLG")=0,DAYS=$S($G(PSORENW("DAYS SUPPLY")):PSORENW("DAYS SUPPLY"),1:$P(PSORENW("RX0"),"^",8))
"RTN","PSORENW1",48,0)
 S DEA("CS")=0 K DIR,DIC
"RTN","PSORENW1",49,0)
 F DEA=1:1 Q:$E(PSODRUG("DEA"),DEA)=""  I $E(+PSODRUG("DEA"),DEA)>1,$E(+PSODRUG("DEA"),DEA)<6 S DEA("CS")=1
"RTN","PSORENW1",50,0)
 S X1=$S($G(PSORENW("ISSUE DATE")):$G(PSORENW("ISSUE DATE")),1:DT),X2=DAYS*($P(PSORENW("RX0"),"^",9)+1)\1
"RTN","PSORENW1",51,0)
 S X2=$S(DAYS=X2&('DEA("CS")):X2,DEA("CS"):184,1:366) D C^%DTC
"RTN","PSORENW1",52,0)
 I PSORENW("FILL DATE")>$P(X,".") S PSEXDT=1_"^"_$P(X,".")
"RTN","PSORENW1",53,0)
 K X1,X2,X,%DT
"RTN","PSORENW1",54,0)
 Q
"RTN","PSORENW1",55,0)
OERR ;renewal finish from oe/rr
"RTN","PSORENW1",56,0)
 S PSORENW("RX0")=^PSRX(PSORENW("OIRXN"),0),PSORENW("RX2")=^(2),PSORENW("RX3")=^(3),PSORENW("STA")=^("STA"),PSORENW("TN")=$G(^("TN"))
"RTN","PSORENW1",57,0)
 S $P(PSORENW("RX0"),"^",4)=$P(OR0,"^",5)
"RTN","PSORENW1",58,0)
 S PSORENW("PROVIDER")=$P(OR0,"^",5)
"RTN","PSORENW1",59,0)
 S PSORX("PROVIDER NAME")=$P($G(^VA(200,PSORENW("PROVIDER"),0)),"^")
"RTN","PSORENW1",60,0)
 S $P(PSORENW("RX0"),"^",5)=$P(OR0,"^",13)
"RTN","PSORENW1",61,0)
 S PSORENW("CLINIC")=$P(OR0,"^",13)
"RTN","PSORENW1",62,0)
 S PSORENW("REMARKS")="RENEWED FROM RX # "_$P(PSORENW("RX0"),"^")_"."_$S($P(OR0,"^",17)="C":" Administered in Clinic.",1:"")
"RTN","PSORENW1",63,0)
 S PSORENW("SIG")=$P($G(^PSRX(PSORENW("OIRXN"),"SIG")),"^"),SIGOK=$P(^("SIG"),"^",2) I SIGOK D
"RTN","PSORENW1",64,0)
 .F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORENW("OIRXN"),"SIG1",I,0)
"RTN","PSORENW1",65,0)
 S:$P(PSORENW("RX3"),"^",3) PSORENW("COSIGNING PROVIDER")=$P(PSORENW("RX3"),"^",3)
"RTN","PSORENW1",66,0)
 S PSORENW("PSODFN")=$P(PSORENW("RX0"),"^",2)
"RTN","PSORENW1",67,0)
 S PSORENW("ORX #")=$P(PSORENW("RX0"),"^")
"RTN","PSORENW1",68,0)
 S PSORENW("DRUG IEN")=$P(PSORENW("RX0"),"^",6),$P(PSORENW("RX0"),"^",11)=$P(OR0,"^",17)
"RTN","PSORENW1",69,0)
 S PSORENW("INS")=$S($G(PSORENW("INS"))]"":PSORENW("INS"),1:$G(^PSRX(PSORENW("OIRXN"),"INS")))
"RTN","PSORENW1",70,0)
 Q:$G(PSORENW("ENT"))>0
"RTN","PSORENW1",71,0)
 F I=0:0 S I=$O(^PSRX(PSORENW("OIRXN"),6,I)) Q:'I  S DOSE=^PSRX(PSORENW("OIRXN"),6,I,0) D
"RTN","PSORENW1",72,0)
 .S PSORENW("ENT")=PSORENW("ENT")+1,PSORENW("DOSE",PSORENW("ENT"))=$P(DOSE,"^")
"RTN","PSORENW1",73,0)
 .S PSORENW("UNITS",PSORENW("ENT"))=$P(DOSE,"^",3),PSORENW("DOSE ORDERED",PSORENW("ENT"))=$P(DOSE,"^",2),PSORENW("ROUTE",PSORENW("ENT"))=$P(DOSE,"^",7)
"RTN","PSORENW1",74,0)
 .S PSORENW("SCHEDULE",PSORENW("ENT"))=$P(DOSE,"^",8),PSORENW("DURATION",PSORENW("ENT"))=$P(DOSE,"^",5),PSORENW("CONJUNCTION",PSORENW("ENT"))=$P(DOSE,"^",6)
"RTN","PSORENW1",75,0)
 .S PSORENW("NOUN",PSORENW("ENT"))=$P(DOSE,"^",4),PSORENW("VERB",PSORENW("ENT"))=$P(DOSE,"^",9)
"RTN","PSORENW1",76,0)
 .I $G(^PSRX(PSORENW("OIRXN"),6,I,1))]"" S PSORENW("ODOSE",PSORENW("ENT"))=^PSRX(PSORENW("OIRXN"),6,I,1)
"RTN","PSORENW1",77,0)
 .K DOSE
"RTN","PSORENW1",78,0)
 Q
"RTN","PSORENW1",79,0)
SETIB ;Set defaults on Renewals with Copay information
"RTN","PSORENW1",80,0)
 ;If answer is in Pending File, use that, else look in Prescription file
"RTN","PSORENW1",81,0)
 I '$G(PSOIBOLD) Q
"RTN","PSORENW1",82,0)
 I $G(PSOFDR),$G(ORD) D SETIBP
"RTN","PSORENW1",83,0)
 ;I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",84,0)
 I $G(PSORX(PSOIBOLD,"SC"))'=0,$G(PSORX(PSOIBOLD,"SC"))'=1 S PSORX(PSOIBOLD,"SC")=$S($P($G(^PSRX(PSOIBOLD,"IBQ")),"^")'="":$P($G(^("IBQ")),"^"),$P($G(^PSRX(PSOIBOLD,"IB")),"^"):0,1:"")
"RTN","PSORENW1",85,0)
 I $G(PSORX(PSOIBOLD,"SC"))="" K PSORX(PSOIBOLD,"SC")
"RTN","PSORENW1",86,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",87,0)
 I $G(PSORX(PSOIBOLD,"MST"))'=0,$G(PSORX(PSOIBOLD,"MST"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",2)'="" S PSORX(PSOIBOLD,"MST")=$P($G(^("IBQ")),"^",2)
"RTN","PSORENW1",88,0)
 I $G(PSORX(PSOIBOLD,"VEH"))'=0,$G(PSORX(PSOIBOLD,"VEH"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",3)'="" S PSORX(PSOIBOLD,"VEH")=$P($G(^("IBQ")),"^",3)
"RTN","PSORENW1",89,0)
 I $G(PSORX(PSOIBOLD,"RAD"))'=0,$G(PSORX(PSOIBOLD,"RAD"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",4)'="" S PSORX(PSOIBOLD,"RAD")=$P($G(^("IBQ")),"^",4)
"RTN","PSORENW1",90,0)
 I $G(PSORX(PSOIBOLD,"PGW"))'=0,$G(PSORX(PSOIBOLD,"PGW"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",5)'="" S PSORX(PSOIBOLD,"PGW")=$P($G(^("IBQ")),"^",5)
"RTN","PSORENW1",91,0)
 I $G(PSORX(PSOIBOLD,"HNC"))'=0,$G(PSORX(PSOIBOLD,"HNC"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",6)'="" S PSORX(PSOIBOLD,"HNC")=$P($G(^("IBQ")),"^",6)
"RTN","PSORENW1",92,0)
 I $G(PSORX(PSOIBOLD,"CV"))'=0,$G(PSORX(PSOIBOLD,"CV"))'=1,$P($G(^PSRX(PSOIBOLD,"IBQ")),"^",7)'="" S PSORX(PSOIBOLD,"CV")=$P($G(^("IBQ")),"^",7)
"RTN","PSORENW1",93,0)
 ;
"RTN","PSORENW1",94,0)
ICD I $D(^PSRX(PSORENW("OIRXN"),"ICD",0)) D
"RTN","PSORENW1",95,0)
 . N JJ,ICD,II,FLD,RXN S RXN=PSOIBOLD
"RTN","PSORENW1",96,0)
 . S II=0 F  S II=$O(^PSRX(PSORENW("OIRXN"),"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORENW1",97,0)
 .. S ICD="",ICD=^PSRX(PSORENW("OIRXN"),"ICD",II,0)
"RTN","PSORENW1",98,0)
 .. S JJ="" F JJ=1:1:8 S FLD=$P(ICD,U,JJ) D ICD^PSONEWF
"RTN","PSORENW1",99,0)
 Q
"RTN","PSORENW1",100,0)
SETIBP ;
"RTN","PSORENW1",101,0)
 I $P($G(^PS(52.41,ORD,0)),"^",16)="SC"!($P($G(^(0)),"^",16)="NSC") S PSORX(PSOIBOLD,"SC")=$S($P($G(^(0)),"^",16)="SC":1,1:0)
"RTN","PSORENW1",102,0)
 I '$$DT^PSOMLLDT Q
"RTN","PSORENW1",103,0)
 N PSOIBQFN S PSOIBQFN=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORENW1",104,0)
 I $P(PSOIBQFN,"^",1)=0!($P(PSOIBQFN,"^",1)=1) S PSORX(PSOIBOLD,"MST")=$P(PSOIBQFN,"^")
"RTN","PSORENW1",105,0)
 I $P(PSOIBQFN,"^",2)=0!($P(PSOIBQFN,"^",2)=1) S PSORX(PSOIBOLD,"VEH")=$P(PSOIBQFN,"^",2)
"RTN","PSORENW1",106,0)
 I $P(PSOIBQFN,"^",3)=0!($P(PSOIBQFN,"^",3)=1) S PSORX(PSOIBOLD,"RAD")=$P(PSOIBQFN,"^",3)
"RTN","PSORENW1",107,0)
 I $P(PSOIBQFN,"^",4)=0!($P(PSOIBQFN,"^",4)=1) S PSORX(PSOIBOLD,"PGW")=$P(PSOIBQFN,"^",4)
"RTN","PSORENW1",108,0)
 I $P(PSOIBQFN,"^",5)=0!($P(PSOIBQFN,"^",5)=1) S PSORX(PSOIBOLD,"HNC")=$P(PSOIBQFN,"^",5)
"RTN","PSORENW1",109,0)
 I $P(PSOIBQFN,"^",6)=0!($P(PSOIBQFN,"^",6)=1) S PSORX(PSOIBOLD,"CV")=$P(PSOIBQFN,"^",6)
"RTN","PSORENW1",110,0)
 ;
"RTN","PSORENW1",111,0)
ICD2 I $D(^PS(52.41,ORD,"ICD",0)) D
"RTN","PSORENW1",112,0)
 . N JJ,ICD,II,FLD,RXN S RXN=ORD
"RTN","PSORENW1",113,0)
 . S II=0 F  S II=$O(^PS(52.41,ORD,"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORENW1",114,0)
 .. S ICD="",ICD=^PS(52.41,ORD,"ICD",II,0)
"RTN","PSORENW1",115,0)
 .. S JJ="" F JJ=1:1:8 S FLD=$P(ICD,U,JJ) D ICD^PSONEWF
"RTN","PSORENW1",116,0)
 ;
"RTN","PSORENW1",117,0)
 K PSOIBQFN
"RTN","PSORENW1",118,0)
 Q
"RTN","PSORENW1",119,0)
KLIB ;Kill renewal IB array
"RTN","PSORENW1",120,0)
 I '$G(PSOIBOLD) Q
"RTN","PSORENW1",121,0)
 K PSORX(PSOIBOLD,"SC"),PSORX(PSOIBOLD,"MST"),PSORX(PSOIBOLD,"VEH"),PSORX(PSOIBOLD,"RAD"),PSORX(PSOIBOLD,"PGW"),PSORX(PSOIBOLD,"HNC"),PSORX(PSOIBOLD,"CV")
"RTN","PSORENW1",122,0)
 K PSOIBOLD
"RTN","PSORENW1",123,0)
 Q
"RTN","PSORN52")
0^33^B69149232
"RTN","PSORN52",1,0)
PSORN52 ;BIR/DSD - files renewal entries in prescription file ;08/09/93
"RTN","PSORN52",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,11,27,37,46,79,71,100,117,157,143**;DEC 1997
"RTN","PSORN52",3,0)
 ;Ext ref to ^PS(55 sup by DBIA 2228
"RTN","PSORN52",4,0)
 ;Ext ref to PSOUL^PSSLOCK sup by DBIA 2789
"RTN","PSORN52",5,0)
 ;Ext ref to ^VA(200 sup by DBIA 10060
"RTN","PSORN52",6,0)
EN(PSOX) ;EP
"RTN","PSORN52",7,0)
START ;
"RTN","PSORN52",8,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Mon
"RTN","PSORN52",9,0)
 N PSOIBHLD,PSOSCOTH,PSOSCOTX S (PSOSCOTH,PSOSCOTX)=0 S PSOIBHLD="" I $G(PSOFDR),$G(ORD) D
"RTN","PSORN52",10,0)
 .S PSOIBHLD=$S($P($G(^PS(52.41,ORD,0)),"^",16)="SC":1,$P($G(^(0)),"^",16)="NSC":0,1:"")
"RTN","PSORN52",11,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",12,0)
 .N PSOIBHLX S PSOIBHLX=$G(^PS(52.41,ORD,"IBQ"))
"RTN","PSORN52",13,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^")=1:1,$P(PSOIBHLX,"^")=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",2)=1:1,$P(PSOIBHLX,"^",2)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",3)=1:1,$P(PSOIBHLX,"^",3)=0:0,1:"")
"RTN","PSORN52",14,0)
 .S PSOIBHLD=PSOIBHLD_"^"_$S($P(PSOIBHLX,"^",4)=1:1,$P(PSOIBHLX,"^",4)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",5)=1:1,$P(PSOIBHLX,"^",5)=0:0,1:"")_"^"_$S($P(PSOIBHLX,"^",6)=1:1,$P(PSOIBHLX,"^",6)=0:0,1:"")
"RTN","PSORN52",15,0)
 .I $P(PSOIBHLX,"^")=1!($P(PSOIBHLX,"^",2)=1)!($P(PSOIBHLX,"^",3)=1)!($P(PSOIBHLX,"^",4)=1)!($P(PSOIBHLX,"^",5)=1) S PSOSCOTH=1
"RTN","PSORN52",16,0)
 I $G(PSOSCOTH)!($G(PSORX("SC"))="SC")!($G(PSORX("SC"))="NSC") S PSOSCOTX=1
"RTN","PSORN52",17,0)
 K PSOSCP D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSORN52",18,0)
 I $G(PSOFDR),$G(ORD) I $D(^PS(52.41,ORD,"ICD")) S FILE=52.41 D GET^PSORN52D
"RTN","PSORN52",19,0)
 ;Set ans to renew from Rx, only if no ans from Pend file
"RTN","PSORN52",20,0)
 I $G(PSORENW("OIRXN")) D
"RTN","PSORN52",21,0)
 .N PSOLDIBQ S PSOLDIBQ=$G(^PSRX(PSORENW("OIRXN"),"IBQ"))
"RTN","PSORN52",22,0)
 .I $P(PSOIBHLD,"^")="" D
"RTN","PSORN52",23,0)
 ..I $P($G(^PSRX(PSORENW("OIRXN"),"IB")),"^")=2 S $P(PSOIBHLD,"^")=0
"RTN","PSORN52",24,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",25,0)
 .I PSOLDIBQ="" Q
"RTN","PSORN52",26,0)
 .D IBHLD^PSORN52A
"RTN","PSORN52",27,0)
 D INIT G:PSORN52("QFLG") END D DATA,FILE,PS55,DIK
"RTN","PSORN52",28,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Mon
"RTN","PSORN52",29,0)
 D FINISH
"RTN","PSORN52",30,0)
 K PSOANSQ,PSOANSQD,PSONEWFF
"RTN","PSORN52",31,0)
 I $G(PSOIBHLD)'="" D
"RTN","PSORN52",32,0)
 .;Set answers based on Pend Renew, prior to Phar call
"RTN","PSORN52",33,0)
 .Q:'$G(PSOX("IRXN"))
"RTN","PSORN52",34,0)
 .I $P(PSOIBHLD,"^")=1!($P(PSOIBHLD,"^")=0) S PSOANSQ("SC")=$P(PSOIBHLD,"^")
"RTN","PSORN52",35,0)
 .I '$$DT^PSOMLLDT Q
"RTN","PSORN52",36,0)
 .I $P(PSOIBHLD,"^",2)=1!($P(PSOIBHLD,"^",2)=0) S PSOANSQ(PSOX("IRXN"),"MST")=$P(PSOIBHLD,"^",2)
"RTN","PSORN52",37,0)
 .I $P(PSOIBHLD,"^",3)=1!($P(PSOIBHLD,"^",3)=0) S PSOANSQ(PSOX("IRXN"),"VEH")=$P(PSOIBHLD,"^",3)
"RTN","PSORN52",38,0)
 .I $P(PSOIBHLD,"^",4)=1!($P(PSOIBHLD,"^",4)=0) S PSOANSQ(PSOX("IRXN"),"RAD")=$P(PSOIBHLD,"^",4)
"RTN","PSORN52",39,0)
 .I $P(PSOIBHLD,"^",5)=1!($P(PSOIBHLD,"^",5)=0) S PSOANSQ(PSOX("IRXN"),"PGW")=$P(PSOIBHLD,"^",5)
"RTN","PSORN52",40,0)
 .I $P(PSOIBHLD,"^",6)=1!($P(PSOIBHLD,"^",6)=0) S PSOANSQ(PSOX("IRXN"),"HNC")=$P(PSOIBHLD,"^",6)
"RTN","PSORN52",41,0)
 .I $P(PSOIBHLD,"^",7)=1!($P(PSOIBHLD,"^",7)=0) S PSOANSQ(PSOX("IRXN"),"CV")=$P(PSOIBHLD,"^",7)
"RTN","PSORN52",42,0)
 K PSOIBHLD
"RTN","PSORN52",43,0)
 I '$G(ORD) I $G(PSORENW("OIRXN")) S FILE=52 D GET^PSORN52D
"RTN","PSORN52",44,0)
 S PSONEW("NEWCOPAY")="" I PSOSCP<50 I '$P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7),$G(DUZ("AG"))="V" S PSOFLAG=0 D COPAY^PSOCPB
"RTN","PSORN52",45,0)
 I PSOSCP>49!($P($G(^PS(53,+$P(^PSRX(PSOX("IRXN"),0),"^",3),0)),"^",7)=1) S PSOFLAG=0 D SC^PSOMLLD2
"RTN","PSORN52",46,0)
 I $$DT^PSOMLLDT D
"RTN","PSORN52",47,0)
 .I $D(PSOIBQS(PSODFN,"CV")) D MESS D CV^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"CV")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",48,0)
 .I $D(PSOIBQS(PSODFN,"VEH")) D MESS D VEH^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"VEH")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",49,0)
 .I $D(PSOIBQS(PSODFN,"RAD")) D MESS D RAD^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"RAD")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",50,0)
 .I $D(PSOIBQS(PSODFN,"PGW")) D MESS D PGW^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"PGW")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",51,0)
 .I $D(PSOIBQS(PSODFN,"MST")) D MESS D MST^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"MST")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",52,0)
 .I $D(PSOIBQS(PSODFN,"HNC")) D MESS D HNC^PSOMLLDT I $G(PSOANSQ(PSOX("IRXN"),"HNC")) K PSONEW("NEWCOPAY")
"RTN","PSORN52",53,0)
 K PSOSCOTH,PSOSCOTX
"RTN","PSORN52",54,0)
 I $G(PSONEW("NEWCOPAY")) S ^PSRX(PSOX("IRXN"),"IB")=PSONEW("NEWCOPAY")
"RTN","PSORN52",55,0)
 D ACP^PSOUTIL
"RTN","PSORN52",56,0)
 I $G(PSOANSQ("SC"))'="" S ^PSRX(PSOX("IRXN"),"IBQ")=$G(PSOANSQ("SC"))
"RTN","PSORN52",57,0)
 I PSOSCP<50&($D(PSOANSQ)) D
"RTN","PSORN52",58,0)
 .S ^PSRX(PSOX("IRXN"),"IBQ")=$S($D(^PSRX(PSOX("IRXN"),"IBQ")):$G(^PSRX(PSOX("IRXN"),"IBQ")),1:"")_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52",59,0)
 .S ^PSRX(PSOX("IRXN"),"IBQ")=$G(^PSRX(PSOX("IRXN"),"IBQ"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))
"RTN","PSORN52",60,0)
 D FILE2^PSORN52D
"RTN","PSORN52",61,0)
 K PSONEW("NEWCOPAY"),PSOANSQ
"RTN","PSORN52",62,0)
END D EOJ
"RTN","PSORN52",63,0)
 Q
"RTN","PSORN52",64,0)
INIT S PSORN52("QFLG")=0 S:'$D(PSOX("DAYS SUPPLY")) PSOX("DAYS SUPPLY")=$P(PSOX("RX0"),"^",8)
"RTN","PSORN52",65,0)
 S:'$D(PSOX("# OF REFILLS")) PSOX("# OF REFILLS")=$P(PSOX("RX0"),"^",9) S:'$D(PSOX("ISSUE DATE")) PSOX("ISSUE DATE")=DT
"RTN","PSORN52",66,0)
 D INIT^PSON52 K PSON52
"RTN","PSORN52",67,0)
 Q
"RTN","PSORN52",68,0)
DATA ;
"RTN","PSORN52",69,0)
 S PSOX("NRX0")=PSORENW("RX0"),PSOX("NRX2")=PSORENW("RX2"),PSOX("NRX3")=PSORENW("RX3"),$P(PSOX("NRX3"),"^",5)=""
"RTN","PSORN52",70,0)
 S $P(PSOX("NRX0"),"^")=PSOX("NRX #") S:$G(PSOX("PROVIDER"))]"" $P(PSOX("NRX0"),"^",4)=PSOX("PROVIDER")
"RTN","PSORN52",71,0)
 I $G(PSORNSPD),$G(PSOX("PATIENT STATUS")),$G(PSOX("PATIENT STATUS"))?.N S $P(PSOX("NRX0"),"^",3)=PSOX("PATIENT STATUS")
"RTN","PSORN52",72,0)
 S:$G(PSOX("COSIGNING PROVIDER"))]"" $P(PSOX("NRX3"),"^",3)=PSOX("COSIGNING PROVIDER")
"RTN","PSORN52",73,0)
 S $P(PSOX("NRX0"),"^",5)=PSOX("CLINIC"),$P(PSOX("NRX0"),"^",9)=PSOX("# OF REFILLS")
"RTN","PSORN52",74,0)
 I $G(PSOX("DAYS SUPPLY")) S $P(PSOX("NRX0"),"^",8)=PSOX("DAYS SUPPLY")
"RTN","PSORN52",75,0)
 I $G(PSOX("QTY")) S $P(PSOX("NRX0"),"^",7)=PSOX("QTY")
"RTN","PSORN52",76,0)
 S $P(PSOX("NRX0"),"^",11)=$S(PSOX("FILL DATE")>DT&($P(PSOPAR,"^",6)):"M",$D(PSOX("MAIL/WINDOW")):PSOX("MAIL/WINDOW"),1:$P(PSOX("NRX0"),"^",11))
"RTN","PSORN52",77,0)
 S $P(PSOX("NRX0"),"^",13)=PSOX("ISSUE DATE"),$P(PSOX("STA"),"^")=PSOX("STATUS"),$P(PSOX("NRX0"),"^",16)=$S($G(PSOX("CLERK CODE"))]"":PSOX("CLERK CODE"),1:DUZ)
"RTN","PSORN52",78,0)
 S $P(PSOX("NRX0"),"^",17)=$G(PSODRUG("COST"))
"RTN","PSORN52",79,0)
 S $P(PSOX("NRX2"),"^")=PSOX("LOGIN DATE"),$P(PSOX("NRX2"),"^",2)=PSOX("FILL DATE"),$P(PSOX("NRX2"),"^",3)="",$P(PSOX("NRX2"),"^",5)=PSOX("DISPENSED DATE")
"RTN","PSORN52",80,0)
 S $P(PSOX("NRX2"),"^",6)=PSOX("STOP DATE"),$P(PSOX("NRX2"),"^",7)=$S($G(PSOX("NDC"))]"":PSOX("NDC"),1:$G(PSODRUG("NDC")))
"RTN","PSORN52",81,0)
 S $P(PSOX("NRX2"),"^",8)=$S($G(PSOX("MANUFACTURER"))]"":PSOX("MANUFACTURER"),1:$G(PSODRUG("MANUFACTURER")))
"RTN","PSORN52",82,0)
 S $P(PSOX("NRX2"),"^",9)=+PSOSITE,$P(PSOX("NRX2"),"^",10)=""
"RTN","PSORN52",83,0)
 S $P(PSOX("NRX2"),"^",11)=$S($G(PSOX("EXPIRATION DATE"))]"":PSOX("EXPIRATION DATE"),1:$G(PSODRUG("EXPIRATION DATE")))
"RTN","PSORN52",84,0)
 S:$G(PSOX("GENERIC PROVIDER"))]"" $P(PSOX("NRX2"),"^",12)=PSOX("GENERIC PROVIDER")
"RTN","PSORN52",85,0)
 S $P(PSOX("NRX2"),"^",13)="",$P(PSOX("NRX2"),"^",15)="",$P(PSOX("NRX3"),"^",4)=$P(PSOX("NRX3"),"^")
"RTN","PSORN52",86,0)
 ;S PSOX("LAST DISPENSED DATE")=$P(PSOX("NRX3"),"^")
"RTN","PSORN52",87,0)
 S PSOX("LAST DISPENSED DATE")=PSOX("DISPENSED DATE")
"RTN","PSORN52",88,0)
 S $P(PSOX("NRX3"),"^")=PSOX("LAST DISPENSED DATE")
"RTN","PSORN52",89,0)
 S:$G(PSOX("NEXT POSSIBLE REFILL"))]"" $P(PSOX("NRX3"),"^",2)=PSOX("NEXT POSSIBLE REFILL")
"RTN","PSORN52",90,0)
 S:'$P(^VA(200,$P(PSOX("NRX0"),"^",4),"PS"),"^",7) $P(PSOX("NRX3"),"^",3)=""
"RTN","PSORN52",91,0)
 S:$G(PSOX("REMARKS"))']"" PSOX("REMARKS")="RENEWED FROM RX # "_$P(PSOX("RX0"),"^")
"RTN","PSORN52",92,0)
 S $P(PSOX("NRX3"),"^",7)=PSOX("REMARKS"),$P(PSOX("NRX3"),"^",8)=""
"RTN","PSORN52",93,0)
 Q
"RTN","PSORN52",94,0)
FILE I $G(PSOFXRNX) S PSOFXRN=1
"RTN","PSORN52",95,0)
 D ^PSORN52C,FILE^PSORN52D
"RTN","PSORN52",96,0)
 I $G(^PSRX(PSOX("OIRXN"),"INSS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=^PSRX(PSOX("OIRXN"),"INSS") K PSOX1 Q
"RTN","PSORN52",97,0)
 I $G(PSOX("SINS"))]"" S ^PSRX(PSOX("IRXN"),"INSS")=PSOX("SINS")
"RTN","PSORN52",98,0)
 K PSOX1
"RTN","PSORN52",99,0)
 Q
"RTN","PSORN52",100,0)
PS55 L +^PS(55,PSODFN,"P"):0 S:'$D(^PS(55,PSODFN,"P",0)) ^(0)="^55.03PA^^"
"RTN","PSORN52",101,0)
 F PSOX1=$P(^PS(55,PSODFN,"P",0),"^",3):1 Q:'$D(^PS(55,PSODFN,"P",PSOX1))
"RTN","PSORN52",102,0)
 S PSOX("55 IEN")=PSOX1
"RTN","PSORN52",103,0)
 S ^PS(55,PSODFN,"P",PSOX1,0)=PSOX("IRXN"),$P(^PS(55,PSODFN,"P",0),"^",3,4)=PSOX1_"^"_($P(^PS(55,PSODFN,"P",0),"^",4)+1)
"RTN","PSORN52",104,0)
 S ^PS(55,PSODFN,"P","A",PSOX("STOP DATE"),PSOX("IRXN"))=""
"RTN","PSORN52",105,0)
PS55X L -^PS(55,PSODFN,"P")
"RTN","PSORN52",106,0)
 K PSOX1
"RTN","PSORN52",107,0)
 Q
"RTN","PSORN52",108,0)
DIK I $G(OR0) D FULL^VALM1,COUN^PSONEW S PSONOOR=""
"RTN","PSORN52",109,0)
 I $D(^XUSEC("PSORPH",DUZ)) S DA=PSOX("IRXN"),DIE=52,DR="41////"_PSOCOU_";S:'X Y=""@1"";42////"_PSOCOUU_";@1" D ^DIE K DIE,DR
"RTN","PSORN52",110,0)
DIKX K DIK,DA S DIK="^PSRX(",DA=PSOX("IRXN") D IX1^DIK K DIK
"RTN","PSORN52",111,0)
 S DA=PSOX("IRXN") D ORC^PSORN52C
"RTN","PSORN52",112,0)
 Q
"RTN","PSORN52",113,0)
FINISH G:PSOX("STATUS")=4 FINISHP
"RTN","PSORN52",114,0)
 I $D(PSORX("VERIFY")) D  G FINISHX
"RTN","PSORN52",115,0)
 .K DIC,DLAYGO,DINUM,DIADD,X,DD,DO S DIC="^PS(52.4,",DLAYGO=52.4,DINUM=PSOX("IRXN"),DIC(0)="ML"
"RTN","PSORN52",116,0)
 .S X=PSOX("IRXN") D FILE^DICN K DD,DO,DIC,DLAYGO,DINUM,X
"RTN","PSORN52",117,0)
 .S ^PS(52.4,PSOX("IRXN"),0)=PSOX("IRXN")_"^"_$P(PSOX("NRX0"),"^",2)_"^"_DUZ_"^"_$G(PSOX("OIRXN"))_"^"_$E(PSOX("LOGIN DATE"),1,7)_"^"_PSOX("IRXN")_"^"_PSOX("STOP DATE")
"RTN","PSORN52",118,0)
 .K DIK,DA S DIK="^PS(52.4,",DA=PSOX("IRXN") D IX^DIK K DIK,DA
"RTN","PSORN52",119,0)
 ;
"RTN","PSORN52",120,0)
 I $G(PSOX("QS"))="S",$G(PSOBARCD) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",121,0)
 ;
"RTN","PSORN52",122,0)
 I PSOX("FILL DATE")>DT,$P(PSOPAR,"^",6) S DA=PSOX("IRXN"),RXFL(PSOX("IRXN"))=0 D SUS^PSORXL K DA G FINISHX
"RTN","PSORN52",123,0)
 ;
"RTN","PSORN52",124,0)
 I $G(PSOX("QS"))="Q",$G(PSOBARCD) D  G FINISHX
"RTN","PSORN52",125,0)
 . N PSOFROM S PSOFROM="BATCH" I $G(PPL),$L(PPL_PSOX("IRXN")_",")>240 D TRI^PSOBBC D Q^PSORXL K PPL,RXFL
"RTN","PSORN52",126,0)
 .S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",127,0)
 . I $G(PPL) S PPL=PPL_PSOX("IRXN")_","
"RTN","PSORN52",128,0)
 . E  S PPL=PSOX("IRXN")_","
"RTN","PSORN52",129,0)
 . Q
"RTN","PSORN52",130,0)
FINISHP I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSOX("IRXN")_",",RXFL(PSOX("IRXN"))=0 G FINISHX
"RTN","PSORN52",131,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORN52",132,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSOX("IRXN"))<220 S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSOX("IRXN")_","
"RTN","PSORN52",133,0)
 E  S PSORX("PSOL",PSOX2+1)=PSOX("IRXN")_","
"RTN","PSORN52",134,0)
 S RXFL(PSOX("IRXN"))=0
"RTN","PSORN52",135,0)
FINISHX ;
"RTN","PSORN52",136,0)
 ;call to build bingo board Rx array
"RTN","PSORN52",137,0)
 S:'$G(PSORX("MAIL/WINDOW")) PSORX("MAIL/WINDOW")=$P(PSORENW("NRX0"),"^",11) I $G(PSORX("MAIL/WINDOW"))["W" S BINGCRT=1,BINGRTE="W",BBFLG=1 D BBRX^PSORN52C
"RTN","PSORN52",138,0)
 K PSOX1,PSOX2
"RTN","PSORN52",139,0)
 Q
"RTN","PSORN52",140,0)
EOJ ;
"RTN","PSORN52",141,0)
 L -^PSRX("B",PSOX("IRXN")) K PSORN52,PSOX("INS"),PSORENW("INS"),PSORXED("INS"),PSONEW("ENT"),PSORXED("ENT"),OLENT,PSOIBHLD,PSOX("SINS"),PSORENW("SINS"),PSORXED("SINS"),FILE
"RTN","PSORN52",142,0)
 D PSOUL^PSSLOCK(PSOX("IRXN")) D PSOUL^PSSLOCK(PSOX("OIRXN"))
"RTN","PSORN52",143,0)
 Q
"RTN","PSORN52",144,0)
MESS ;
"RTN","PSORN52",145,0)
 I $G(PSOSCOTX)=1 W !!,"This Rx has been flagged by the provider as: "_$S($G(PSOSCOTH):"NO COPAY",$G(PSORX("SC"))="SC":"NO COPAY",1:"COPAY"),! S PSOSCOTX=2
"RTN","PSORN52",146,0)
 Q
"RTN","PSORN52D")
0^35^B50476982
"RTN","PSORN52D",1,0)
PSORN52D ;BIR/LE - files new and renewal entries con't ;02/27/04
"RTN","PSORN52D",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**143**;DEC 1997
"RTN","PSORN52D",3,0)
 Q
"RTN","PSORN52D",4,0)
GET ;must have FILE and PSORENW variables to pull default data for ICD and SC/EI for SC>50% Rx's from file 52
"RTN","PSORN52D",5,0)
 N ARRAY,ERR,SUBF,RXN,II,JJ,ORXN,SUBFLD
"RTN","PSORN52D",6,0)
 I FILE=52 S SUBF=52.052311,SUBFLD=52311,RXN=PSORENW("IRXN"),ORXN=PSORENW("OIRXN")
"RTN","PSORN52D",7,0)
 I FILE=52.41 S SUBF=52.41311,SUBFLD=311,RXN=ORD,ORXN=PSORENW("OIRXN")
"RTN","PSORN52D",8,0)
 D GETS^DIQ(FILE,RXN,SUBFLD_"*","I","ARRAY","ERR")
"RTN","PSORN52D",9,0)
 Q:$D(ERR)
"RTN","PSORN52D",10,0)
 K PSORX("ICD"),PSOX("ICD")
"RTN","PSORN52D",11,0)
 F II=1:1:8 Q:'$D(ARRAY(SUBF,(II_","_RXN_",")))  D
"RTN","PSORN52D",12,0)
 . S PSORX("ICD",II)=ARRAY(SUBF,(II_","_RXN_","),.01,"I") S:FILE=52.41 PSONEW("ICD",II)=PSORX("ICD",II)
"RTN","PSORN52D",13,0)
 .; I '$D(PSOSCP2) Q:PSOSCP<50
"RTN","PSORN52D",14,0)
 . F JJ=1:1:7 D
"RTN","PSORN52D",15,0)
 .. I JJ=1 S:$G(PSOANSQ(RXN,"VEH"))=""!($G(PSOANSQ(RXN,"VEH"))=0) PSOANSQ(RXN,"VEH")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"VEH")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I") Q
"RTN","PSORN52D",16,0)
 .. I JJ=2 S:$G(PSOANSQ(RXN,"RAD"))=""!($G(PSOANSQ(RXN,"RAD"))=0) PSOANSQ(RXN,"RAD")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"RAD")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I") Q
"RTN","PSORN52D",17,0)
 .. I JJ=3 D
"RTN","PSORN52D",18,0)
 ... I PSOSCP>49 S:$G(PSOANSQ(RXN,"SC>50"))=""!($G(PSOANSQ(RXN,"SC>50"))=0) PSOANSQ(RXN,"SC>50")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"SC>50")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I") Q
"RTN","PSORN52D",19,0)
 ... I PSOSCP<50 D
"RTN","PSORN52D",20,0)
 .... I $G(PSOSCP2) S PSOANSQ(RXN,"SC")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"SC")=PSOANSQ(RXN,"SC"),PSOANSQ("SC")=PSOANSQ(RXN,"SC")
"RTN","PSORN52D",21,0)
 .... I $P($G(^PS(53,+$P(^PSRX($S(FILE=52:RXN,FILE=52.41:ORXN,1:RXN),0),"^",3),0)),"^",7)=1 D
"RTN","PSORN52D",22,0)
 ..... S:$G(PSOANSQ(RXN,"SC>50"))=""!($G(PSOANSQ(RXN,"SC>50"))=0) PSOANSQ(RXN,"SC>50")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"SC>50")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I")
"RTN","PSORN52D",23,0)
 .. I JJ=4 S:$G(PSOANSQ(RXN,"PGW"))=""!($G(PSOANSQ(RXN,"PGW"))=0) PSOANSQ(RXN,"PGW")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"PGW")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I") Q
"RTN","PSORN52D",24,0)
 .. I JJ=5 S:$G(PSOANSQ(RXN,"MST"))=""!($G(PSOANSQ(RXN,"MST"))=0) PSOANSQ(RXN,"MST")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"MST")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I") Q
"RTN","PSORN52D",25,0)
 .. I JJ=6 S:$G(PSOANSQ(RXN,"HNC"))=""!($G(PSOANSQ(RXN,"HNC"))=0) PSOANSQ(RXN,"HNC")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"HNC")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I") Q
"RTN","PSORN52D",26,0)
 .. I JJ=7 S:$G(PSOANSQ(RXN,"CV"))=""!($G(PSOANSQ(RXN,"CV"))=0) PSOANSQ(RXN,"CV")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I"),PSORX(ORXN,"CV")=ARRAY(SUBF,(II_","_RXN_","),JJ,"I") Q
"RTN","PSORN52D",27,0)
 Q
"RTN","PSORN52D",28,0)
FILE ;
"RTN","PSORN52D",29,0)
 Q:'$D(^PSRX(PSOX("OIRXN"),"ICD"))
"RTN","PSORN52D",30,0)
 N II F II=1:1:8 Q:$G(^PSRX(PSOX("OIRXN"),"ICD",II,0))=""  D
"RTN","PSORN52D",31,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",II,0)=$G(^PSRX(PSOX("OIRXN"),"ICD",II,0))
"RTN","PSORN52D",32,0)
 . S:$P(^PSRX(PSOX("IRXN"),"ICD",II,0),"^",1)'="" ^PSRX(PSOX("IRXN"),"ICD","B",$P(^PSRX(PSOX("IRXN"),"ICD",II,0),"^",1),II)=""
"RTN","PSORN52D",33,0)
 I II>1 S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311^"_(II-1)_"^"_(II-1)
"RTN","PSORN52D",34,0)
 Q
"RTN","PSORN52D",35,0)
FILE2 ;file ICD's on existing node or build new nodes
"RTN","PSORN52D",36,0)
 ;note: variable PSOSCP2 is only available from CPRS Edit API and MISS
"RTN","PSORN52D",37,0)
 ;        sub-routine below.
"RTN","PSORN52D",38,0)
 N D,RXN
"RTN","PSORN52D",39,0)
 I '$G(PSONEW("PATIENT STATUS")) I $G(PSOX("IRXN")) S PSONEW("PATIENT STATUS")=$$GET1^DIQ(52,PSOX("IRXN")_",",3,"I")
"RTN","PSORN52D",40,0)
 I $G(PSOSCP2)!($G(PSOFDR)&($G(ORD))) D
"RTN","PSORN52D",41,0)
 .;if RX edited in CPRS delete all but what is sent from CPRS
"RTN","PSORN52D",42,0)
 . K ^PSRX(PSOX("IRXN"),"ICD")
"RTN","PSORN52D",43,0)
 I $O(PSORX("ICD","")) D
"RTN","PSORN52D",44,0)
 . F D=1:1:8 Q:'$D(PSORX("ICD",D))  S $P(^PSRX(PSOX("IRXN"),"ICD",D,0),U,1)=PSORX("ICD",D)
"RTN","PSORN52D",45,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^"_D-1_"^"_D-1
"RTN","PSORN52D",46,0)
 ;  Set SC/EI's
"RTN","PSORN52D",47,0)
 I $D(^PSRX(PSOX("IRXN"),"ICD",0)) D
"RTN","PSORN52D",48,0)
 . N II,TYPE,DATA
"RTN","PSORN52D",49,0)
 . S II=0 F  S II=$O(^PSRX(PSOX("IRXN"),"ICD",II)) Q:II=""!(II'?1N.N)  D
"RTN","PSORN52D",50,0)
 .. S DATA="",DATA=^PSRX(PSOX("IRXN"),"ICD",II,0)
"RTN","PSORN52D",51,0)
 .. I PSOSCP<50&($D(PSOANSQ("SC"))) S:PSOANSQ("SC")'="" $P(DATA,U,4)=PSOANSQ("SC")
"RTN","PSORN52D",52,0)
 .. I PSOSCP<50&($D(PSOANSQ("SC>50"))) I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 S:PSOANSQ("SC>50")'="" $P(DATA,U,4)=PSOANSQ("SC>50")
"RTN","PSORN52D",53,0)
 .. I PSOSCP=""&($D(PSOANSQ(PSOX("IRXN"),"SC>50"))) S:PSOANSQ(PSOX("IRXN"),"SC>50")'="" $P(DATA,U,4)=PSOANSQ(PSOX("IRXN"),"SC>50")
"RTN","PSORN52D",54,0)
 .. I PSOSCP>49&('$D(PSOANSQ(PSOX("IRXN"),"SC>50")))&($D(PSOANSQ("SC>50"))) S:PSOANSQ("SC>50")'="" $P(DATA,U,4)=PSOANSQ("SC>50")
"RTN","PSORN52D",55,0)
 .. S TYPE="" F  S TYPE=$O(PSOANSQ(PSOX("IRXN"),TYPE)) Q:TYPE=""  D
"RTN","PSORN52D",56,0)
 ... I TYPE="VEH"&($D(PSOANSQ(PSOX("IRXN"),"VEH"))) S:PSOANSQ(PSOX("IRXN"),"VEH")'="" $P(DATA,U,2)=PSOANSQ(PSOX("IRXN"),"VEH")
"RTN","PSORN52D",57,0)
 ... I TYPE="RAD"&($D(PSOANSQ(PSOX("IRXN"),"RAD"))) S:PSOANSQ(PSOX("IRXN"),"RAD")'="" $P(DATA,U,3)=PSOANSQ(PSOX("IRXN"),"RAD")
"RTN","PSORN52D",58,0)
 ... I TYPE="SC>50"&(PSOSCP>49) D
"RTN","PSORN52D",59,0)
 .... I $D(PSOANSQ(PSOX("IRXN"),"SC>50")) S:PSOANSQ(PSOX("IRXN"),"SC>50")'="" $P(DATA,U,4)=PSOANSQ(PSOX("IRXN"),"SC>50")
"RTN","PSORN52D",60,0)
 .... E  I $D(PSOANSQ("SC>50")) S:PSOANSQ("SC>50")'="" $P(DATA,U,4)=PSOANSQ("SC>50")
"RTN","PSORN52D",61,0)
 ... I PSOSCP<50&($D(PSOANSQ("SC"))) S:PSOANSQ("SC")'="" $P(DATA,U,4)=PSOANSQ("SC")
"RTN","PSORN52D",62,0)
 ... I TYPE="PGW"&($D(PSOANSQ(PSOX("IRXN"),"PGW"))) S:PSOANSQ(PSOX("IRXN"),"PGW")'="" $P(DATA,U,5)=PSOANSQ(PSOX("IRXN"),"PGW")
"RTN","PSORN52D",63,0)
 ... I TYPE="MST"&($D(PSOANSQ(PSOX("IRXN"),"MST"))) S:PSOANSQ(PSOX("IRXN"),"MST")'="" $P(DATA,U,6)=PSOANSQ(PSOX("IRXN"),"MST")
"RTN","PSORN52D",64,0)
 ... I TYPE="HNC"&($D(PSOANSQ(PSOX("IRXN"),"HNC"))) S:PSOANSQ(PSOX("IRXN"),"HNC")'="" $P(DATA,U,7)=PSOANSQ(PSOX("IRXN"),"HNC")
"RTN","PSORN52D",65,0)
 ... I TYPE="CV"&($D(PSOANSQ(PSOX("IRXN"),"CV"))) S:PSOANSQ(PSOX("IRXN"),"CV")'="" $P(DATA,U,8)=PSOANSQ(PSOX("IRXN"),"CV")
"RTN","PSORN52D",66,0)
 .. S ^PSRX(PSOX("IRXN"),"ICD",II,0)=DATA
"RTN","PSORN52D",67,0)
 .. S:$P(DATA,U,1)'="" ^PSRX(PSOX("IRXN"),"ICD","B",$P(DATA,U,1),II)=""
"RTN","PSORN52D",68,0)
 .. S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^"_II_"^"_II
"RTN","PSORN52D",69,0)
 .. I PSOSCP<50 D
"RTN","PSORN52D",70,0)
 ... I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 S ^PSRX(PSOX("IRXN"),"IBQ")="^^^^^^^" Q
"RTN","PSORN52D",71,0)
 ... S ^PSRX(PSOX("IRXN"),"IBQ")=$G(PSOANSQ("SC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52D",72,0)
 ... S ^PSRX(PSOX("IRXN"),"IBQ")=$G(^PSRX(PSOX("IRXN"),"IBQ"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))
"RTN","PSORN52D",73,0)
 E  D
"RTN","PSORN52D",74,0)
 . N DATA S DATA=$S($D(PSORX("ICD",1)):PSORX("ICD",1),1:"")_"^"_$G(PSOANSQ(PSORENW("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSORENW("IRXN"),"RAD"))_"^"_$S(PSOSCP<50:$G(PSOANSQ("SC")),PSOSCP>49:$G(PSOANSQ("SC>50")),1:"")
"RTN","PSORN52D",75,0)
 . S DATA=DATA_"^"_$G(PSOANSQ(PSORENW("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSORENW("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSORENW("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSORENW("IRXN"),"CV"))
"RTN","PSORN52D",76,0)
 . I PSOSCP<50&($D(PSOANSQ("SC>50"))) I $P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1 S $P(DATA,U,4)=PSOANSQ("SC>50")
"RTN","PSORN52D",77,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",1,0)=DATA S:$P(DATA,"^",1)'="" ^PSRX(PSOX("IRXN"),"ICD","B",$P(DATA,"^",1),1)=""
"RTN","PSORN52D",78,0)
 . S ^PSRX(PSOX("IRXN"),"ICD",0)="^52.052311P^1^1"
"RTN","PSORN52D",79,0)
 . ; set IBQ NODE
"RTN","PSORN52D",80,0)
 . I PSOSCP<50&($P($G(^PS(53,+$G(PSONEW("PATIENT STATUS")),0)),"^",7)=1) S ^PSRX(PSOX("IRXN"),"IBQ")="^^^^^^^" Q
"RTN","PSORN52D",81,0)
 . S ^PSRX(PSOX("IRXN"),"IBQ")=$G(PSOANSQ("SC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"MST"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"VEH"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"RAD"))
"RTN","PSORN52D",82,0)
 . S ^PSRX(PSOX("IRXN"),"IBQ")=$G(^PSRX(PSOX("IRXN"),"IBQ"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"PGW"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"HNC"))_"^"_$G(PSOANSQ(PSOX("IRXN"),"CV"))
"RTN","PSORN52D",83,0)
 K PSORX("ICD")
"RTN","PSORN52D",84,0)
 Q
"RTN","PSORN52D",85,0)
 ;
"RTN","PSORN52D",86,0)
RESET ;called from reset copay status PSOCPC
"RTN","PSORN52D",87,0)
 ;Must be available at this point:  PSODA, PSOIBQ=SC^MST^AO^IR^EC^HNC^CV
"RTN","PSORN52D",88,0)
 Q:'$D(PSODA)!('$D(PSOIBQ))
"RTN","PSORN52D",89,0)
 Q:'$D(^PSRX(PSODA))
"RTN","PSORN52D",90,0)
 Q:'$D(^PSRX(PSODA,"ICD"))  ;if old Rx and no ICD's defined; don't set
"RTN","PSORN52D",91,0)
 N PSOX,PSOANSQ,PSOIND,PSOTYP,PSOSCP
"RTN","PSORN52D",92,0)
 D ELIG^VADPT S PSOANSQ("SC>50")="",PSOSCP="",PSOSCP=$P(VAEL(3),U,2) K VAEL
"RTN","PSORN52D",93,0)
 S PSOX("IRXN")=PSODA
"RTN","PSORN52D",94,0)
 F PSOTYP=1:1:7 S PSOIND=$P(PSOIBQ,"^",PSOTYP) D
"RTN","PSORN52D",95,0)
 . I PSOTYP=1&(PSOSCP<50) S PSOANSQ(PSOX("IRXN"),"SC")=PSOIND,PSOANSQ("SC")=PSOIND
"RTN","PSORN52D",96,0)
 . I PSOTYP=1&(PSOSCP>49) S PSOANSQ(PSOX("IRXN"),"SC>50")=PSOIND,PSOANSQ("SC>50")=PSOIND
"RTN","PSORN52D",97,0)
 . I PSOTYP=2 S PSOANSQ(PSOX("IRXN"),"MST")=PSOIND
"RTN","PSORN52D",98,0)
 . I PSOTYP=3 S PSOANSQ(PSOX("IRXN"),"VEH")=PSOIND
"RTN","PSORN52D",99,0)
 . I PSOTYP=4 S PSOANSQ(PSOX("IRXN"),"RAD")=PSOIND
"RTN","PSORN52D",100,0)
 . I PSOTYP=5 S PSOANSQ(PSOX("IRXN"),"PGW")=PSOIND
"RTN","PSORN52D",101,0)
 . I PSOTYP=6 S PSOANSQ(PSOX("IRXN"),"HNC")=PSOIND
"RTN","PSORN52D",102,0)
 . I PSOTYP=7 S PSOANSQ(PSOX("IRXN"),"CV")=PSOIND
"RTN","PSORN52D",103,0)
 D FILE2
"RTN","PSORN52D",104,0)
 Q
"UP",52,52.052311,-1)
52^ICD
"UP",52,52.052311,0)
52.052311
"UP",52.41,52.41311,-1)
52.41^ICD
"UP",52.41,52.41311,0)
52.41311
"VER")
8.0^22.0
"^DD",52,52,52311,0)
ICD DIAGNOSIS^52.052311P^^ICD;0
"^DD",52,52,52311,"DT")
3040401
"^DD",52,52.052311,0)
ICD DIAGNOSIS SUB-FIELD^^7^8
"^DD",52,52.052311,0,"DIK")
PSOXZA
"^DD",52,52.052311,0,"DT")
3030916
"^DD",52,52.052311,0,"IX","B",52.052311,.01)

"^DD",52,52.052311,0,"NM","ICD DIAGNOSIS")

"^DD",52,52.052311,0,"UP")
52
"^DD",52,52.052311,.01,0)
ICD DIAGNOSIS^MP80^ICD9(^0;1^Q
"^DD",52,52.052311,.01,1,0)
^.1
"^DD",52,52.052311,.01,1,1,0)
52.052311^B
"^DD",52,52.052311,.01,1,1,1)
S ^PSRX(DA(1),"ICD","B",$E(X,1,30),DA)=""
"^DD",52,52.052311,.01,1,1,2)
K ^PSRX(DA(1),"ICD","B",$E(X,1,30),DA)
"^DD",52,52.052311,.01,1,2,0)
52^E
"^DD",52,52.052311,.01,1,2,1)
S ^PSRX("E",$E(X,1,30),DA(1),DA)=""
"^DD",52,52.052311,.01,1,2,2)
K ^PSRX("E",$E(X,1,30),DA(1),DA)
"^DD",52,52.052311,.01,1,2,"DT")
3031015
"^DD",52,52.052311,.01,3)
Enter a pointer to file #80
"^DD",52,52.052311,.01,21,0)
^.001^2^2^3031015^^
"^DD",52,52.052311,.01,21,1,0)
Diagnoses (up to nine) assigned for this prescription by the Ordering 
"^DD",52,52.052311,.01,21,2,0)
Provider.
"^DD",52,52.052311,.01,"DT")
3031015
"^DD",52,52.052311,1,0)
AGENT ORANGE^S^0:NO;1:YES;^0;2^Q
"^DD",52,52.052311,1,3)
ENTER YES OR NO.
"^DD",52,52.052311,1,21,0)
^.001^2^2^3050322^^
"^DD",52,52.052311,1,21,1,0)
This field is used to direclty identify the corresponding ICD-9 code in the .01
"^DD",52,52.052311,1,21,2,0)
field as related to Agent Orange for 3rd party billing.
"^DD",52,52.052311,1,"DT")
3040130
"^DD",52,52.052311,2,0)
IONIZING RADIATION^S^0:NO;1:YES;^0;3^Q
"^DD",52,52.052311,2,3)
Enter NO for YES.
"^DD",52,52.052311,2,21,0)
^^2^2^3040130^
"^DD",52,52.052311,2,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the  
"^DD",52,52.052311,2,21,2,0)
.01 field as IONIZING RADIATION related for 3rd party billing.
"^DD",52,52.052311,2,"DT")
3040130
"^DD",52,52.052311,3,0)
SERVICE CONNECTION^S^0:NO;1:YES;^0;4^Q
"^DD",52,52.052311,3,3)
ENTER YES OR NO.
"^DD",52,52.052311,3,21,0)
^^2^2^3040130^
"^DD",52,52.052311,3,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52,52.052311,3,21,2,0)
.01 field as related to Service Connection for 3rd Party Billing.
"^DD",52,52.052311,3,"DT")
3040130
"^DD",52,52.052311,4,0)
ENVIRONMENTAL CONTAMINANTS^S^0:NO;1:YES;^0;5^Q
"^DD",52,52.052311,4,3)
ENTER YES OR NO.
"^DD",52,52.052311,4,21,0)
^.001^2^2^3040129^^
"^DD",52,52.052311,4,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52,52.052311,4,21,2,0)
.01 field as related to Environmental Contaminants for 3rd Party Billing.
"^DD",52,52.052311,4,"DT")
3040129
"^DD",52,52.052311,5,0)
MILITARY SEXUAL TRAUMA^S^0:NO;1:YES;^0;6^Q
"^DD",52,52.052311,5,3)
ENTER YES OR NO.
"^DD",52,52.052311,5,21,0)
^.001^2^2^3040129^^
"^DD",52,52.052311,5,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52,52.052311,5,21,2,0)
.01 field as related to Military Sexual Trauma for 3rd Party Billing.
"^DD",52,52.052311,5,"DT")
3040129
"^DD",52,52.052311,6,0)
HEAD AND/OR NECK CANCER^S^0:NO;1:YES;^0;7^Q
"^DD",52,52.052311,6,3)
ENTER YES OR NO.
"^DD",52,52.052311,6,21,0)
^.001^2^2^3040129^^
"^DD",52,52.052311,6,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52,52.052311,6,21,2,0)
.01 field as related to Head and/or Neck Cancer for 3rd Party Billing.
"^DD",52,52.052311,6,"DT")
3040129
"^DD",52,52.052311,7,0)
COMBAT VETERAN^S^0:NO;1:YES;^0;8^Q
"^DD",52,52.052311,7,3)
ENTER YES OR NO.
"^DD",52,52.052311,7,21,0)
^.001^2^2^3040129^^^
"^DD",52,52.052311,7,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52,52.052311,7,21,2,0)
.01 field as related to Combat Veteran for 3rd Party Billing.
"^DD",52,52.052311,7,"DT")
3040129
"^DD",52.41,52.41,311,0)
DIAGNOSIS^52.41311PA^^ICD;0
"^DD",52.41,52.41,311,21,0)
^^13^13^3040211^
"^DD",52.41,52.41,311,21,1,0)
This multiple is used to store up to eight ICD-9 codes per prescription
"^DD",52.41,52.41,311,21,2,0)
with the first always being the primary diagnosis code and subsequent ones
"^DD",52.41,52.41,311,21,3,0)
being secondary diagnosis codes.  Also stored in this multiple are all of
"^DD",52.41,52.41,311,21,4,0)
the Service Connection (SC) and Environmental Indicators (EI) that 
"^DD",52.41,52.41,311,21,5,0)
directly relate to each ICD-9 code.  These SC/EI's are passed from CPRS in
"^DD",52.41,52.41,311,21,6,0)
this manner. This ICD-9/SC/EI relationship is necessary for 3rd Party
"^DD",52.41,52.41,311,21,7,0)
Billing.
"^DD",52.41,52.41,311,21,8,0)
 
"^DD",52.41,52.41,311,21,9,0)
Current Copay functionality deals only with SC<50% and only stores EI's 
"^DD",52.41,52.41,311,21,10,0)
when with this is true or not overridden in some way.  The new SC/EI 
"^DD",52.41,52.41,311,21,11,0)
fields allow for Outpatient Pharmacy to know if a prescription is
"^DD",52.41,52.41,311,21,12,0)
SC 0-100%, to know all EI's that apply, and to know how
"^DD",52.41,52.41,311,21,13,0)
they relate to the ICD-9 code without affecting Copay functionality.
"^DD",52.41,52.41,311,"DT")
3030923
"^DD",52.41,52.41311,0)
DIAGNOSIS SUB-FIELD^^7^8
"^DD",52.41,52.41311,0,"DT")
3040130
"^DD",52.41,52.41311,0,"IX","B",52.41311,.01)

"^DD",52.41,52.41311,0,"NM","DIAGNOSIS")

"^DD",52.41,52.41311,0,"UP")
52.41
"^DD",52.41,52.41311,.01,0)
DIAGNOSIS^MP80'^ICD9(^0;1^Q
"^DD",52.41,52.41311,.01,1,0)
^.1
"^DD",52.41,52.41311,.01,1,1,0)
52.41311^B
"^DD",52.41,52.41311,.01,1,1,1)
S ^PS(52.41,DA(1),"ICD","B",$E(X,1,30),DA)=""
"^DD",52.41,52.41311,.01,1,1,2)
K ^PS(52.41,DA(1),"ICD","B",$E(X,1,30),DA)
"^DD",52.41,52.41311,.01,3)
Enter a valid ICD-9 code, partial ICD-9 code, or partial name.
"^DD",52.41,52.41311,.01,21,0)
^^3^3^3040127^
"^DD",52.41,52.41311,.01,21,1,0)
This multiple field will store 8 diagnosis codes.  The first code is 
"^DD",52.41,52.41311,.01,21,2,0)
considered the primary diagnosis and the last seven are secondary 
"^DD",52.41,52.41311,.01,21,3,0)
diagnosis codes.
"^DD",52.41,52.41311,.01,"DT")
3040127
"^DD",52.41,52.41311,1,0)
AGENT ORANGE^S^0:NO;1:YES;^0;2^Q
"^DD",52.41,52.41311,1,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,1,21,0)
^^2^2^3040130^
"^DD",52.41,52.41311,1,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52.41,52.41311,1,21,2,0)
.01 field as related to Agent Orange for 3rd Party Billing.
"^DD",52.41,52.41311,1,"DT")
3040130
"^DD",52.41,52.41311,2,0)
IONIZING RADIATION^S^0:NO;1:YES;^0;3^Q
"^DD",52.41,52.41311,2,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,2,21,0)
^^2^2^3040130^
"^DD",52.41,52.41311,2,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52.41,52.41311,2,21,2,0)
.01 field as related to Ionizing Radiation for 3rd Party Billing.
"^DD",52.41,52.41311,2,"DT")
3040130
"^DD",52.41,52.41311,3,0)
SERVICE CONNECTION^S^0:NO;1:YES;^0;4^Q
"^DD",52.41,52.41311,3,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,3,21,0)
^^2^2^3040130^
"^DD",52.41,52.41311,3,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52.41,52.41311,3,21,2,0)
.01 field as related to Service Connection for 3rd Party Billing.
"^DD",52.41,52.41311,3,"DT")
3040130
"^DD",52.41,52.41311,4,0)
ENVIRONMENTAL CONTAMINANTS^S^0:NO;1:YES;^0;5^Q
"^DD",52.41,52.41311,4,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,4,21,0)
^^2^2^3040129^
"^DD",52.41,52.41311,4,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52.41,52.41311,4,21,2,0)
.01 field as related to Environmental Contaminants for 3rd Party Billing.
"^DD",52.41,52.41311,4,"DT")
3040129
"^DD",52.41,52.41311,5,0)
MILITARY SEXUAL TRAUMA^S^0:NO;1:YES;^0;6^Q
"^DD",52.41,52.41311,5,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,5,21,0)
^^2^2^3040129^
"^DD",52.41,52.41311,5,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52.41,52.41311,5,21,2,0)
.01 field as releated to Military Sexual Trauma for 3rd Party Billing.
"^DD",52.41,52.41311,5,"DT")
3040129
"^DD",52.41,52.41311,6,0)
HEAD AND/OR NECK CANCER^S^0:NO;1:YES;^0;7^Q
"^DD",52.41,52.41311,6,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,6,21,0)
^^2^2^3040129^
"^DD",52.41,52.41311,6,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52.41,52.41311,6,21,2,0)
.01 field as related to Head and/or Neck Cancer for 3rd Party Billing.
"^DD",52.41,52.41311,6,"DT")
3040129
"^DD",52.41,52.41311,7,0)
COMBAT VETERAN^S^0:NO;1:YES;^0;8^Q
"^DD",52.41,52.41311,7,3)
ENTER YES OR NO.
"^DD",52.41,52.41311,7,21,0)
^^2^2^3040129^
"^DD",52.41,52.41311,7,21,1,0)
This field is used to directly identify the corresponding ICD-9 code in the
"^DD",52.41,52.41311,7,21,2,0)
.01 field as related to Combat Veteran for 3rd Party Billing.
"^DD",52.41,52.41311,7,"DT")
3040129
**END**
**END**
