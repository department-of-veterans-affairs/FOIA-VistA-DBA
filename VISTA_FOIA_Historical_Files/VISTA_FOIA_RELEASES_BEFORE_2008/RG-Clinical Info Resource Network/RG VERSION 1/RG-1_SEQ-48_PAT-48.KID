Released RG*1*48 SEQ #48
Extracted from mail message
**KIDS**:RG*1.0*48^

**INSTALL NAME**
RG*1.0*48
"BLD",2524,0)
RG*1.0*48^CLINICAL INFO RESOURCE NETWORK^0^3070821^y
"BLD",2524,1,0)
^^3^3^3070612^
"BLD",2524,1,1,0)
EXCEPTION HANDLER ENHANCEMENTS
"BLD",2524,1,2,0)
Refer to patch RG*1*48 in the FORUM Patch Module for a complete
"BLD",2524,1,3,0)
description.
"BLD",2524,4,0)
^9.64PA^991.1^1
"BLD",2524,4,991.1,0)
991.1
"BLD",2524,4,991.1,2,0)
^9.641^991.12^1
"BLD",2524,4,991.1,2,991.12,0)
EXCEPTION  (sub-file)
"BLD",2524,4,991.1,2,991.12,1,0)
^9.6411^8^2
"BLD",2524,4,991.1,2,991.12,1,7,0)
DATE/TIME PROCESSED
"BLD",2524,4,991.1,2,991.12,1,8,0)
WHO MARKED PROCESSED
"BLD",2524,4,991.1,222)
y^n^p^^^^n^^n
"BLD",2524,4,991.1,224)

"BLD",2524,4,"APDD",991.1,991.12)

"BLD",2524,4,"APDD",991.1,991.12,7)

"BLD",2524,4,"APDD",991.1,991.12,8)

"BLD",2524,4,"B",991.1,991.1)

"BLD",2524,6.3)
3
"BLD",2524,"ABNS",0)
^9.66A^^
"BLD",2524,"ABPKG")
^^
"BLD",2524,"KRN",0)
^9.67PA^8989.52^19
"BLD",2524,"KRN",.4,0)
.4
"BLD",2524,"KRN",.401,0)
.401
"BLD",2524,"KRN",.402,0)
.402
"BLD",2524,"KRN",.403,0)
.403
"BLD",2524,"KRN",.5,0)
.5
"BLD",2524,"KRN",.84,0)
.84
"BLD",2524,"KRN",3.6,0)
3.6
"BLD",2524,"KRN",3.8,0)
3.8
"BLD",2524,"KRN",9.2,0)
9.2
"BLD",2524,"KRN",9.8,0)
9.8
"BLD",2524,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",2524,"KRN",9.8,"NM",1,0)
RGRPC^^0^B13556106
"BLD",2524,"KRN",9.8,"NM",2,0)
RGACTIV^^0^B2013191
"BLD",2524,"KRN",9.8,"NM",3,0)
RGEX03^^0^B69509022
"BLD",2524,"KRN",9.8,"NM",4,0)
RGADTP2^^0^B48920670
"BLD",2524,"KRN",9.8,"NM",5,0)
RGADTP3^^0^B11058020
"BLD",2524,"KRN",9.8,"NM",6,0)
RGEX06^^0^B8462958
"BLD",2524,"KRN",9.8,"NM",7,0)
RGEX01^^0^B34733554
"BLD",2524,"KRN",9.8,"NM",8,0)
RGPVMPI^^0^B17890972
"BLD",2524,"KRN",9.8,"NM",9,0)
RGADTP1^^0^B39482051
"BLD",2524,"KRN",9.8,"NM","B","RGACTIV",2)

"BLD",2524,"KRN",9.8,"NM","B","RGADTP1",9)

"BLD",2524,"KRN",9.8,"NM","B","RGADTP2",4)

"BLD",2524,"KRN",9.8,"NM","B","RGADTP3",5)

"BLD",2524,"KRN",9.8,"NM","B","RGEX01",7)

"BLD",2524,"KRN",9.8,"NM","B","RGEX03",3)

"BLD",2524,"KRN",9.8,"NM","B","RGEX06",6)

"BLD",2524,"KRN",9.8,"NM","B","RGPVMPI",8)

"BLD",2524,"KRN",9.8,"NM","B","RGRPC",1)

"BLD",2524,"KRN",19,0)
19
"BLD",2524,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",2524,"KRN",19,"NM",1,0)
RG EXCEPTION PURGE^^0
"BLD",2524,"KRN",19,"NM",2,0)
RG PRIMARY VIEW FROM MPI^^0
"BLD",2524,"KRN",19,"NM",3,0)
RG EXCEPTION MENU^^2
"BLD",2524,"KRN",19,"NM","B","RG EXCEPTION MENU",3)

"BLD",2524,"KRN",19,"NM","B","RG EXCEPTION PURGE",1)

"BLD",2524,"KRN",19,"NM","B","RG PRIMARY VIEW FROM MPI",2)

"BLD",2524,"KRN",19.1,0)
19.1
"BLD",2524,"KRN",101,0)
101
"BLD",2524,"KRN",101,"NM",0)
^9.68A^23^23
"BLD",2524,"KRN",101,"NM",1,0)
RG EXCPT PV MPI PDAT^^0
"BLD",2524,"KRN",101,"NM",2,0)
RG EXCPT ACTION MENU^^0
"BLD",2524,"KRN",101,"NM",3,0)
RG EXCPT BLANK1^^0
"BLD",2524,"KRN",101,"NM",4,0)
RG EXCPT DATE SORT^^0
"BLD",2524,"KRN",101,"NM",5,0)
RG EXCPT DISPLAY ONLY QUERY^^0
"BLD",2524,"KRN",101,"NM",6,0)
RG EXCPT EDIT NOTE^^0
"BLD",2524,"KRN",101,"NM",7,0)
RG EXCPT EDIT PATIENT DATA^^0
"BLD",2524,"KRN",101,"NM",8,0)
RG EXCPT HINQ INQUIRY^^0
"BLD",2524,"KRN",101,"NM",9,0)
RG EXCPT MAIN MENU^^0
"BLD",2524,"KRN",101,"NM",10,0)
RG EXCPT MPI/PD DATA^^0
"BLD",2524,"KRN",101,"NM",11,0)
RG EXCPT PATIENT AUDIT^^0
"BLD",2524,"KRN",101,"NM",12,0)
RG EXCPT PATIENT INQUIRY^^0
"BLD",2524,"KRN",101,"NM",13,0)
RG EXCPT PATIENT SORT^^0
"BLD",2524,"KRN",101,"NM",14,0)
RG EXCPT PDAT MENU^^0
"BLD",2524,"KRN",101,"NM",15,0)
RG EXCPT POT MATCH^^0
"BLD",2524,"KRN",101,"NM",16,0)
RG EXCPT PV REJECT^^0
"BLD",2524,"KRN",101,"NM",17,0)
RG EXCPT RCHK^^0
"BLD",2524,"KRN",101,"NM",18,0)
RG EXCPT RDISP^^0
"BLD",2524,"KRN",101,"NM",19,0)
RG EXCPT RSEND^^0
"BLD",2524,"KRN",101,"NM",20,0)
RG EXCPT SELECT^^0
"BLD",2524,"KRN",101,"NM",21,0)
RG EXCPT SELECT TYPE^^0
"BLD",2524,"KRN",101,"NM",22,0)
RG EXCPT TYPE SORT^^0
"BLD",2524,"KRN",101,"NM",23,0)
RG EXCPT UPDATE STATUS^^0
"BLD",2524,"KRN",101,"NM","B","RG EXCPT ACTION MENU",2)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT BLANK1",3)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT DATE SORT",4)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT DISPLAY ONLY QUERY",5)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT EDIT NOTE",6)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT EDIT PATIENT DATA",7)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT HINQ INQUIRY",8)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT MAIN MENU",9)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT MPI/PD DATA",10)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT PATIENT AUDIT",11)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT PATIENT INQUIRY",12)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT PATIENT SORT",13)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT PDAT MENU",14)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT POT MATCH",15)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT PV MPI PDAT",1)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT PV REJECT",16)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT RCHK",17)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT RDISP",18)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT RSEND",19)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT SELECT",20)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT SELECT TYPE",21)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT TYPE SORT",22)

"BLD",2524,"KRN",101,"NM","B","RG EXCPT UPDATE STATUS",23)

"BLD",2524,"KRN",409.61,0)
409.61
"BLD",2524,"KRN",409.61,"NM",0)
^9.68A^1^1
"BLD",2524,"KRN",409.61,"NM",1,0)
RG EXCPT PV MPI PDAT^^0
"BLD",2524,"KRN",409.61,"NM","B","RG EXCPT PV MPI PDAT",1)

"BLD",2524,"KRN",771,0)
771
"BLD",2524,"KRN",870,0)
870
"BLD",2524,"KRN",8989.51,0)
8989.51
"BLD",2524,"KRN",8989.52,0)
8989.52
"BLD",2524,"KRN",8994,0)
8994
"BLD",2524,"KRN",8994,"NM",0)
^9.68A^2^2
"BLD",2524,"KRN",8994,"NM",1,0)
RG VIEW VISTA EXCEPTIONS^^0
"BLD",2524,"KRN",8994,"NM",2,0)
RG PRIMARY VIEW FROM MPI^^0
"BLD",2524,"KRN",8994,"NM","B","RG PRIMARY VIEW FROM MPI",2)

"BLD",2524,"KRN",8994,"NM","B","RG VIEW VISTA EXCEPTIONS",1)

"BLD",2524,"KRN","B",.4,.4)

"BLD",2524,"KRN","B",.401,.401)

"BLD",2524,"KRN","B",.402,.402)

"BLD",2524,"KRN","B",.403,.403)

"BLD",2524,"KRN","B",.5,.5)

"BLD",2524,"KRN","B",.84,.84)

"BLD",2524,"KRN","B",3.6,3.6)

"BLD",2524,"KRN","B",3.8,3.8)

"BLD",2524,"KRN","B",9.2,9.2)

"BLD",2524,"KRN","B",9.8,9.8)

"BLD",2524,"KRN","B",19,19)

"BLD",2524,"KRN","B",19.1,19.1)

"BLD",2524,"KRN","B",101,101)

"BLD",2524,"KRN","B",409.61,409.61)

"BLD",2524,"KRN","B",771,771)

"BLD",2524,"KRN","B",870,870)

"BLD",2524,"KRN","B",8989.51,8989.51)

"BLD",2524,"KRN","B",8989.52,8989.52)

"BLD",2524,"KRN","B",8994,8994)

"BLD",2524,"QUES",0)
^9.62^^
"BLD",2524,"REQB",0)
^9.611^4^3
"BLD",2524,"REQB",1,0)
RG*1.0*25^2
"BLD",2524,"REQB",2,0)
RG*1.0*47^2
"BLD",2524,"REQB",4,0)
DG*5.3*756^2
"BLD",2524,"REQB","B","DG*5.3*756",4)

"BLD",2524,"REQB","B","RG*1.0*25",1)

"BLD",2524,"REQB","B","RG*1.0*47",2)

"FIA",991.1)
CIRN HL7 EXCEPTION LOG
"FIA",991.1,0)
^RGHL7(991.1,
"FIA",991.1,0,0)
991.1
"FIA",991.1,0,1)
y^n^p^^^^n^^n
"FIA",991.1,0,10)

"FIA",991.1,0,11)

"FIA",991.1,0,"RLRO")

"FIA",991.1,0,"VR")
1.0^RG
"FIA",991.1,991.1)
1
"FIA",991.1,991.12)
1
"FIA",991.1,991.12,7)

"FIA",991.1,991.12,8)

"KRN",19,6403,-1)
2^3
"KRN",19,6403,0)
RG EXCEPTION MENU^Message Exception Menu^^M^^^^^^^^272
"KRN",19,6403,10,0)
^19.01IP^7^5
"KRN",19,6403,10,7,0)
7133^^40
"KRN",19,6403,10,7,"^")
RG PRIMARY VIEW FROM MPI
"KRN",19,6403,"U")
MESSAGE EXCEPTION MENU
"KRN",19,6656,-1)
0^1
"KRN",19,6656,0)
RG EXCEPTION PURGE^MPI/PD Exception Purge ^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,6656,1,0)
^^9^9^3070522^
"KRN",19,6656,1,1,0)
The MPI/PD Exception Purge [RG EXCEPTION PURGE] option purges entries 
"KRN",19,6656,1,2,0)
from the CIRN HL7 EXCEPTION LOG (#991.1) file.  Entries that are purged 
"KRN",19,6656,1,3,0)
include duplicate entries, resolved entries over 30 days old, and entries 
"KRN",19,6656,1,4,0)
for patients were the name field is null or the patient has been merge 
"KRN",19,6656,1,5,0)
(i.e., has a -9 node.)  Additionally, only the most recent Primary View 
"KRN",19,6656,1,6,0)
Reject exception for a given patient/date is retained.
"KRN",19,6656,1,7,0)
  
"KRN",19,6656,1,8,0)
This option should be scheduled to run via Taskman once an hour.  (This 
"KRN",19,6656,1,9,0)
recommendation was added in patch RG*1*48.)
"KRN",19,6656,25)
MAIN^RGEVPRG
"KRN",19,6656,"U")
MPI/PD EXCEPTION PURGE 
"KRN",19,7133,-1)
0^2
"KRN",19,7133,0)
RG PRIMARY VIEW FROM MPI^Primary View Display from MPI^^R^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",19,7133,1,0)
^^6^6^3070517^
"KRN",19,7133,1,1,0)
For a selected patient, this option sends a remote request for data to 
"KRN",19,7133,1,2,0)
the Master Patient Index, using a Remote Procedure Call (RPC).  When the 
"KRN",19,7133,1,3,0)
RPC returns the information, the user can review Primary View data as it 
"KRN",19,7133,1,4,0)
currently exists on the MPI Patient Data Inquiry (PDAT) report.
"KRN",19,7133,1,5,0)
  
"KRN",19,7133,1,6,0)
Be sure that HISTORY is enabled to capture the information.
"KRN",19,7133,25)
RGPVMPI
"KRN",19,7133,"U")
PRIMARY VIEW DISPLAY FROM MPI
"KRN",101,1692,-1)
0^9
"KRN",101,1692,0)
RG EXCPT MAIN MENU^MPI/PD EXCEPTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1692,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1692,1,1,0)
This protocol serves as the main menu of exception handling options
"KRN",101,1692,1,2,0)
under the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1692,4)
40^4
"KRN",101,1692,10,0)
^101.01PA^7^7
"KRN",101,1692,10,3,0)
1693^SE^15^^^Select Exception
"KRN",101,1692,10,3,"^")
RG EXCPT SELECT
"KRN",101,1692,10,4,0)
1699^ST^10^^^Sort by Exception Type
"KRN",101,1692,10,4,"^")
RG EXCPT TYPE SORT
"KRN",101,1692,10,5,0)
1700^SD^5^^^Sort Exceptions by Date
"KRN",101,1692,10,5,"^")
RG EXCPT DATE SORT
"KRN",101,1692,10,6,0)
1701^SN^7^^^Sort by Patient Name
"KRN",101,1692,10,6,"^")
RG EXCPT PATIENT SORT
"KRN",101,1692,10,7,0)
1702^VT^12^^^View Selected Exception Type
"KRN",101,1692,10,7,"^")
RG EXCPT SELECT TYPE
"KRN",101,1692,26)
D SHOW^VALM
"KRN",101,1692,28)
Select Action:
"KRN",101,1692,99)
58639,51005
"KRN",101,1693,-1)
0^20
"KRN",101,1693,0)
RG EXCPT SELECT^Select Exception^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1693,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1693,1,1,0)
This protocol allows the user to select an exception for processing
"KRN",101,1693,1,2,0)
from the MPI/PD Exceptions screen in the MPI/PD Exception Handling
"KRN",101,1693,1,3,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1693,20)
D SELECT^RGEXHND1
"KRN",101,1693,99)
58043,62323
"KRN",101,1694,-1)
0^2
"KRN",101,1694,0)
RG EXCPT ACTION MENU^MPI/PD EXCEPTION HANDLING^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1694,1,0)
^101.06^4^4^3070516^^^^
"KRN",101,1694,1,1,0)
This protocol serves as the action menu and allows several
"KRN",101,1694,1,2,0)
actions to be taken for a patient selected from the MPI/PD
"KRN",101,1694,1,3,0)
Exception Menu [RG EXCPT MAIN MENU].  This is activated through
"KRN",101,1694,1,4,0)
the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1694,4)
26^4
"KRN",101,1694,10,0)
^101.01PAI^15^14
"KRN",101,1694,10,3,0)
1695^UPD^90^^^Update to Processed
"KRN",101,1694,10,3,"^")
RG EXCPT UPDATE STATUS
"KRN",101,1694,10,4,0)
1696^DO^50^^^MPI Display Only Qry
"KRN",101,1694,10,4,"^")
RG EXCPT DISPLAY ONLY QUERY
"KRN",101,1694,10,6,0)
1698^ED^70^^^Edit Patient Data
"KRN",101,1694,10,6,"^")
RG EXCPT EDIT PATIENT DATA
"KRN",101,1694,10,7,0)
1703^PI^20^^^Patient Inquiry
"KRN",101,1694,10,7,"^")
RG EXCPT PATIENT INQUIRY
"KRN",101,1694,10,8,0)
1704^AUD^10^^^Patient Audit
"KRN",101,1694,10,8,"^")
RG EXCPT PATIENT AUDIT
"KRN",101,1694,10,9,0)
1705^HI^30^^^Hinq Inquiry
"KRN",101,1694,10,9,"^")
RG EXCPT HINQ INQUIRY
"KRN",101,1694,10,10,0)
1806^DI^100^^^MPI/PD Data Inquiry
"KRN",101,1694,10,10,"^")
RG EXCPT MPI/PD DATA
"KRN",101,1694,10,11,0)
1846^NT^110^^^Edit Note
"KRN",101,1694,10,11,"^")
RG EXCPT EDIT NOTE
"KRN",101,1694,10,12,0)
2064^PMR^60^^^Potential Match Rev
"KRN",101,1694,10,12,"^")
RG EXCPT POT MATCH
"KRN",101,1694,10,13,0)
2098^PVR^80^^^View PV Rej Detail
"KRN",101,1694,10,13,"^")
RG EXCPT PV REJECT
"KRN",101,1694,10,14,0)
2103^^40^
"KRN",101,1694,10,14,"^")
RG EXCPT BLANK1
"KRN",101,1694,10,15,0)
2117^PR^120^^^MPI Primary View
"KRN",101,1694,10,15,"^")
RG EXCPT PV MPI PDAT
"KRN",101,1694,20)

"KRN",101,1694,26)
D SHOW^VALM
"KRN",101,1694,28)
Select Action:
"KRN",101,1694,99)
60766,56859
"KRN",101,1695,-1)
0^23
"KRN",101,1695,0)
RG EXCPT UPDATE STATUS^Update Status to Processed^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1695,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1695,1,1,0)
This protocol allows the user to update the exception status 
"KRN",101,1695,1,2,0)
to PROCESSED from the MPI/PD Exception Handling option [RG 
"KRN",101,1695,1,3,0)
EXCEPTION HANDLING].
"KRN",101,1695,2,0)
^101.02A^^0
"KRN",101,1695,4)
^^^
"KRN",101,1695,20)
D UPD^RGEX03
"KRN",101,1695,99)
58043,62323
"KRN",101,1696,-1)
0^5
"KRN",101,1696,0)
RG EXCPT DISPLAY ONLY QUERY^Display Only Query to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1696,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1696,1,1,0)
This protocol allows the user to perform a Display Only Query to the MPI
"KRN",101,1696,1,2,0)
from the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1696,20)
D DISP^RGEX03
"KRN",101,1696,99)
58043,62323
"KRN",101,1698,-1)
0^7
"KRN",101,1698,0)
RG EXCPT EDIT PATIENT DATA^Edit Patient Data^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1698,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1698,1,1,0)
This protocol allows the user to edit patient data from the 
"KRN",101,1698,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1698,20)
D LOAD^RGEX03
"KRN",101,1698,99)
58043,62323
"KRN",101,1699,-1)
0^22
"KRN",101,1699,0)
RG EXCPT TYPE SORT^Sort by Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1699,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1699,1,1,0)
This protocol allows the user to sort exceptions by type in the
"KRN",101,1699,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1699,20)
S RGSORT="ST" D SORT^RGEX01
"KRN",101,1699,99)
58043,62323
"KRN",101,1700,-1)
0^4
"KRN",101,1700,0)
RG EXCPT DATE SORT^Sort by Exception Date^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1700,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1700,1,1,0)
This protocol allows the user to sort exceptions by date in the
"KRN",101,1700,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1700,20)
S RGSORT="SD" D SORT^RGEX01
"KRN",101,1700,99)
58043,62323
"KRN",101,1701,-1)
0^13
"KRN",101,1701,0)
RG EXCPT PATIENT SORT^Sort by Patient ^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1701,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1701,1,1,0)
This protocol allows the user to sort exceptions by patient in
"KRN",101,1701,1,2,0)
the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1701,20)
S RGSORT="SN" D SORT^RGEX01
"KRN",101,1701,99)
58043,62323
"KRN",101,1702,-1)
0^21
"KRN",101,1702,0)
RG EXCPT SELECT TYPE^View Selected Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1702,1,0)
^101.06^4^4^3010719^^^^
"KRN",101,1702,1,1,0)
This protocol allows the user to select an exception type to 
"KRN",101,1702,1,2,0)
view, all others will be filtered out, for exception processing
"KRN",101,1702,1,3,0)
from the MPI/PD Exceptions screen in the MPI/PD Exception Handling
"KRN",101,1702,1,4,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1702,20)
S RGSORT="VT" D SORT^RGEX01
"KRN",101,1702,27)

"KRN",101,1702,99)
58043,62323
"KRN",101,1703,-1)
0^12
"KRN",101,1703,0)
RG EXCPT PATIENT INQUIRY^Patient Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1703,1,0)
^101.06^2^2^3061108^^^^
"KRN",101,1703,1,1,0)
This protocol allows the user to do a Patient Inquiry from the 
"KRN",101,1703,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1703,20)
D INQ^RGEX03
"KRN",101,1703,99)
58043,62323
"KRN",101,1704,-1)
0^11
"KRN",101,1704,0)
RG EXCPT PATIENT AUDIT^Patient Audit^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1704,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1704,1,1,0)
This protocol allows the user to audit the changes made in the
"KRN",101,1704,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1704,20)
D PA^RGEX03
"KRN",101,1704,99)
58043,62323
"KRN",101,1705,-1)
0^8
"KRN",101,1705,0)
RG EXCPT HINQ INQUIRY^Hinq Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1705,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1705,1,1,0)
This protocol allows the user to do a HINQ Inquiry for a 
"KRN",101,1705,1,2,0)
selected patient in the MPI/PD Exception Handling option 
"KRN",101,1705,1,3,0)
[RG EXCEPTION HANDLING].
"KRN",101,1705,20)
D HI^RGEX03
"KRN",101,1705,99)
58043,62323
"KRN",101,1806,-1)
0^10
"KRN",101,1806,0)
RG EXCPT MPI/PD DATA^MPI/PD Data Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1806,1,0)
^101.06^2^2^3011022^^^^
"KRN",101,1806,1,1,0)
This protocol displays Master Patient Index/Patient Demographics 
"KRN",101,1806,1,2,0)
(MPI/PD) information for the selected patient.
"KRN",101,1806,2,0)
^101.02A^2^1
"KRN",101,1806,2,2,0)
DI
"KRN",101,1806,2,"B","DI",2)

"KRN",101,1806,20)
D PDAT^RGEX03
"KRN",101,1806,99)
58734,46469
"KRN",101,1842,-1)
0^19
"KRN",101,1842,0)
RG EXCPT RSEND^Send Remote Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1842,1,0)
^^2^2^3011016^
"KRN",101,1842,1,1,0)
This protocol allows the user to send a remote patient data query to
"KRN",101,1842,1,2,0)
treating facility sites.
"KRN",101,1842,20)
D RSEND^RGEX04
"KRN",101,1842,99)
58728,59197
"KRN",101,1843,-1)
0^17
"KRN",101,1843,0)
RG EXCPT RCHK^Check Remote Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1843,1,0)
^^2^2^3011016^
"KRN",101,1843,1,1,0)
This protocol allows the user to check the status of a remote patient data
"KRN",101,1843,1,2,0)
query.
"KRN",101,1843,20)
D RCHK^RGEX04
"KRN",101,1843,99)
58728,59359
"KRN",101,1844,-1)
0^18
"KRN",101,1844,0)
RG EXCPT RDISP^Display Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1844,1,0)
^^2^2^3011016^
"KRN",101,1844,1,1,0)
This protocol allows the user to check the status of a remote patient data
"KRN",101,1844,1,2,0)
query.
"KRN",101,1844,20)
D RDISP^RGEX04
"KRN",101,1844,99)
58728,59436
"KRN",101,1845,-1)
0^14
"KRN",101,1845,0)
RG EXCPT PDAT MENU^MPI/PD PATIENT DATA ACTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1845,1,0)
^^2^2^3011016^
"KRN",101,1845,1,1,0)
This protocol serves as the action menu for the MPI/PD Exception Handling
"KRN",101,1845,1,2,0)
Patient Data Query actions.
"KRN",101,1845,4)
40
"KRN",101,1845,10,0)
^101.01PAI^3^3
"KRN",101,1845,10,1,0)
1842^SND^5^^^Send Remote Query
"KRN",101,1845,10,1,"^")
RG EXCPT RSEND
"KRN",101,1845,10,2,0)
1843^CHK^10^^^Check Remote Query
"KRN",101,1845,10,2,"^")
RG EXCPT RCHK
"KRN",101,1845,10,3,0)
1844^DSP^15^^^Display Query Data
"KRN",101,1845,10,3,"^")
RG EXCPT RDISP
"KRN",101,1845,26)
D SHOW^VALM
"KRN",101,1845,28)
Select Action:
"KRN",101,1845,99)
58728,59920
"KRN",101,1846,-1)
0^6
"KRN",101,1846,0)
RG EXCPT EDIT NOTE^Edit Notes^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1846,1,0)
^^1^1^3011030^
"KRN",101,1846,1,1,0)
This protocol allows the user to add/edit notes to the exception.
"KRN",101,1846,20)
D EDTNOT^RGEX03
"KRN",101,1846,99)
58742,35539
"KRN",101,2064,-1)
0^15
"KRN",101,2064,0)
RG EXCPT POT MATCH^Resolve Potential Match^^A^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",101,2064,1,0)
^101.06^2^2^3051212^^
"KRN",101,2064,1,1,0)
This action will allow the review of a potential match exception and 
"KRN",101,2064,1,2,0)
resolution even though the patient already has a National ICN.
"KRN",101,2064,20)
D POT^RGEX03
"KRN",101,2064,99)
60239,28567
"KRN",101,2098,-1)
0^16
"KRN",101,2098,0)
RG EXCPT PV REJECT^Primary View Reject^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,2098,1,0)
^101.06^8^8^3070226^^^^
"KRN",101,2098,1,1,0)
This action allows the review of remote data from the Master Patient 
"KRN",101,2098,1,2,0)
Index (MPI).  When patient identity information is edited locally and 
"KRN",101,2098,1,3,0)
sent to the MPI, it is compared to the Primary View data and must also 
"KRN",101,2098,1,4,0)
pass specific data business rules before updating the MPI.  If the local 
"KRN",101,2098,1,5,0)
data fails, either because the Authority Score was not high enough (in 
"KRN",101,2098,1,6,0)
comparison to Primary View) or it failed a business rule, it is 
"KRN",101,2098,1,7,0)
rejected.  This protocol allows the local facility to review the reason 
"KRN",101,2098,1,8,0)
for the rejected data.
"KRN",101,2098,20)
D REJ^RGEX03
"KRN",101,2098,99)
60687,44429
"KRN",101,2103,-1)
0^3
"KRN",101,2103,0)
RG EXCPT BLANK1^^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,2103,1,0)
^^2^2^3061116^
"KRN",101,2103,1,1,0)
The purpose of this protocol entry is to control menu alignment.
"KRN",101,2103,1,2,0)
It contains no ITEM TEXT or MNEMONIC, as it is only a placeholder.
"KRN",101,2117,-1)
0^1
"KRN",101,2117,0)
RG EXCPT PV MPI PDAT^MPI Primary View^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,2117,1,0)
^101.06^5^5^3070516^^^
"KRN",101,2117,1,1,0)
This action allows the review of remote data from the Master Patient 
"KRN",101,2117,1,2,0)
Index (MPI).  For a selected patient, the Remote Procedure Call returns 
"KRN",101,2117,1,3,0)
the Primary View data as it currently exists on the MPI Patient Data 
"KRN",101,2117,1,4,0)
Inquiry (PDAT) report.  This protocol allows the local facility to review 
"KRN",101,2117,1,5,0)
the Primary View data.
"KRN",101,2117,20)
D MPIPV^RGEX03
"KRN",101,2117,99)
60766,56625
"KRN",409.61,291,-1)
0^1
"KRN",409.61,291,0)
RG EXCPT PV MPI PDAT^1^^80^5^21^1^1^^^MPI PRIMARY VIEW^1^^1
"KRN",409.61,291,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,291,"ARRAY")
 ^TMP("RGEXC6",$J)
"KRN",409.61,291,"COL",0)
^409.621^1^1
"KRN",409.61,291,"COL",1,0)
EXCEPTION^5^70^MPI Primary View Display^H^0
"KRN",409.61,291,"COL","AIDENT",0,1)

"KRN",409.61,291,"COL","B","EXCEPTION",1)

"KRN",409.61,291,"FNL")
D EXIT^RGEX06
"KRN",409.61,291,"HDR")
D HDR^RGEX06
"KRN",409.61,291,"HLP")
D HELP^RGEX06
"KRN",409.61,291,"INIT")
D INIT^RGEX06
"KRN",8994,248,-1)
0^1
"KRN",8994,248,0)
RG VIEW VISTA EXCEPTIONS^EN^RGRPC^2^^^^^1
"KRN",8994,248,1,0)
^^2^2^3070503^
"KRN",8994,248,1,1,0)
This RPC will allow the MPI IMDQ staff to view VistA exceptions for a 
"KRN",8994,248,1,2,0)
given patient logged during a specific date range.
"KRN",8994,248,2,0)
^8994.02A^5^5
"KRN",8994,248,2,1,0)
ICN^1^10^0^2
"KRN",8994,248,2,1,1,0)
^^2^2^3070503^
"KRN",8994,248,2,1,1,1,0)
Integration Control Number for patient exceptions are being requested 
"KRN",8994,248,2,1,1,2,0)
for.  If ICN is not passed, then SSN or DFN must be.
"KRN",8994,248,2,2,0)
SSN^1^9^0^3
"KRN",8994,248,2,2,1,0)
^^2^2^3070503^
"KRN",8994,248,2,2,1,1,0)
Social Security Number for patient exceptions are being requested 
"KRN",8994,248,2,2,1,2,0)
for.  If SSN is not passed, then ICN or DFN must be.
"KRN",8994,248,2,3,0)
DFN^1^32000^0^4
"KRN",8994,248,2,3,1,0)
^^2^2^3070503^
"KRN",8994,248,2,3,1,1,0)
Internal Entry Number for patient, in the PATIENT (#2) file, exceptions
"KRN",8994,248,2,3,1,2,0)
are being requested for  If DFN is not passed, then ICN or SSN must be.
"KRN",8994,248,2,4,0)
BRANGE^1^7^0^5
"KRN",8994,248,2,4,1,0)
^^1^1^3070503^
"KRN",8994,248,2,4,1,1,0)
Beginning Date Range for exceptions to be in.
"KRN",8994,248,2,5,0)
ERANGE^1^7^0^6
"KRN",8994,248,2,5,1,0)
^^1^1^3070503^
"KRN",8994,248,2,5,1,1,0)
Ending Date Range for Exceptions to have been logged in.
"KRN",8994,248,2,"B","BRANGE",4)

"KRN",8994,248,2,"B","DFN",3)

"KRN",8994,248,2,"B","ERANGE",5)

"KRN",8994,248,2,"B","ICN",1)

"KRN",8994,248,2,"B","SSN",2)

"KRN",8994,248,2,"PARAMSEQ",2,1)

"KRN",8994,248,2,"PARAMSEQ",3,2)

"KRN",8994,248,2,"PARAMSEQ",4,3)

"KRN",8994,248,2,"PARAMSEQ",5,4)

"KRN",8994,248,2,"PARAMSEQ",6,5)

"KRN",8994,248,3,0)
^^46^46^3070503^
"KRN",8994,248,3,1,0)
Exceptions found for the patient in the given date range.  Fields 
"KRN",8994,248,3,2,0)
returned are from file 991.1:
"KRN",8994,248,3,3,0)
 
"KRN",8994,248,3,4,0)
991.1,.01     NUMBER                 0;1 NUMBER (Required)
"KRN",8994,248,3,5,0)
              DESCRIPTION:      This is the internal entry number (IEN) 
"KRN",8994,248,3,6,0)
of this HL7 exception.  
"KRN",8994,248,3,7,0)
 
"KRN",8994,248,3,8,0)
991.1,1       START                  0;2 DATE (Required)
"KRN",8994,248,3,9,0)
              DESCRIPTION:      This the date/time the message processing 
"KRN",8994,248,3,10,0)
started.  
"KRN",8994,248,3,11,0)
 
"KRN",8994,248,3,12,0)
991.12,2        TYPE                 0;3 POINTER TO CIRN HL7 EXCEPTION 
"KRN",8994,248,3,13,0)
TYPE FILE (#991.11)
"KRN",8994,248,3,14,0)
                DESCRIPTION:    This is a pointer to the CIRN HL7 
"KRN",8994,248,3,15,0)
EXCEPTION TYPE file (#991.11).  
"KRN",8994,248,3,16,0)
 
"KRN",8994,248,3,17,0)
991.12,3        PATIENT              0;4 POINTER TO PATIENT FILE (#2)
"KRN",8994,248,3,18,0)
                DESCRIPTION:    Pointer to PATIENT file (#2) for the 
"KRN",8994,248,3,19,0)
patient involved in this exception (DFN). This field is not required as
"KRN",8994,248,3,20,0)
every exception type does not have an associated DFN.
"KRN",8994,248,3,21,0)
 
"KRN",8994,248,3,22,0)
991.12,6        EXCEPTION STATUS     0;5 SET
"KRN",8994,248,3,23,0)
                                '0' FOR NOT PROCESSED; 
"KRN",8994,248,3,24,0)
                                '1' FOR PROCESSED; 
"KRN",8994,248,3,25,0)
                DESCRIPTION:    This is the exception status for this 
"KRN",8994,248,3,26,0)
message.   A status of NOT PROCESSED indicates that user intervention is
"KRN",8994,248,3,27,0)
necessary.  The status should be changed to PROCESSED after confirming
"KRN",8994,248,3,28,0)
that the patient data is correct.
"KRN",8994,248,3,29,0)
 
"KRN",8994,248,3,30,0)
991.12,10       TEXT                 10;E1,250 FREE TEXT
"KRN",8994,248,3,31,0)
                DESCRIPTION:    This is a free text field used for 
"KRN",8994,248,3,32,0)
supplemental text for the exception.  
"KRN",8994,248,3,33,0)
 
"KRN",8994,248,3,34,0)
991.12,11       NOTES                11;0   WORD-PROCESSING #991.1211
"KRN",8994,248,3,35,0)
                DESCRIPTION:    This field allows users to enter notes 
"KRN",8994,248,3,36,0)
regarding an exception to aid in resolving the exception.  
"KRN",8994,248,3,37,0)
 
"KRN",8994,248,3,38,0)
and new fields:
"KRN",8994,248,3,39,0)
 
"KRN",8994,248,3,40,0)
991.12,7        DATE/TIME PROCESSED  0;6 DATE
"KRN",8994,248,3,41,0)
               DESCRIPTION:    This field will capture the date/time the
"KRN",8994,248,3,42,0)
exception was marked processed.  
"KRN",8994,248,3,43,0)
 
"KRN",8994,248,3,44,0)
991.12,8        WHO MARKED PROCESSED 0;7 POINTER TO NEW PERSON FILE (#200)
"KRN",8994,248,3,45,0)
                DESCRIPTION:    This field will capture who has marked 
"KRN",8994,248,3,46,0)
the exception as processed.  
"KRN",8994,249,-1)
0^2
"KRN",8994,249,0)
RG PRIMARY VIEW FROM MPI^MPIPV^MPIRPC^2^R^^^^1
"KRN",8994,249,1,0)
^^2^2^3070516^
"KRN",8994,249,1,1,0)
This remote procedure call will return the MPI Patient Data Inquiry [MPI 
"KRN",8994,249,1,2,0)
DATA MGT PDAT MPI] (PDAT) report for a requested ICN.
"KRN",8994,249,2,0)
^8994.02A^1^1
"KRN",8994,249,2,1,0)
ICN^1^16^1^1
"KRN",8994,249,2,1,1,0)
^8994.021^2^2^3070516^^
"KRN",8994,249,2,1,1,1,0)
This is the Integration Control Number of the patient for whom data is 
"KRN",8994,249,2,1,1,2,0)
requested.
"KRN",8994,249,2,"B","ICN",1)

"KRN",8994,249,2,"PARAMSEQ",1,1)

"KRN",8994,249,3,0)
^8994.03^2^2^3070516^^
"KRN",8994,249,3,1,0)
This Remote Procedure Call will return the MPI Patient Data Inquiry 
"KRN",8994,249,3,2,0)
(PDAT) Report to the requesting VistA facility.
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
48^3070821
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3070821
"PKG",272,22,1,"PAH",1,1,1,0)
EXCEPTION HANDLER ENHANCEMENTS
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*48 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","RGACTIV")
0^2^B2013191^B1923961
"RTN","RGACTIV",1,0)
RGACTIV ;BAY/ALS-MPI/PD PATIENT ACTIVITY INFORMATION ;03/08/02
"RTN","RGACTIV",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**25,48**;30 Apr 99;Build 3
"RTN","RGACTIV",3,0)
 ; Reference to ^VAT(391.71 supported by IA# 3422
"RTN","RGACTIV",4,0)
EN(ARRAY,ICN,SSN) ;
"RTN","RGACTIV",5,0)
 I '$D(ICN) S ARRAY(0)="-1^ICN NOT PASSED" G QUIT
"RTN","RGACTIV",6,0)
 S DFN=$$GETDFN^MPIF001(ICN)
"RTN","RGACTIV",7,0)
 I DFN<1 S ARRAY(ICN,0)=DFN G QUIT
"RTN","RGACTIV",8,0)
 ;S SITE=+$$SITE^VASITE()
"RTN","RGACTIV",9,0)
 ;**48 CHANGE TO PASS STATION NUMBER
"RTN","RGACTIV",10,0)
 S SITE=$P($$SITE^VASITE(),"^",3)
"RTN","RGACTIV",11,0)
PIVOT ; Get message information from ADT/HL7 PIVOT file
"RTN","RGACTIV",12,0)
 S RGMSG="",MSGDATA=""
"RTN","RGACTIV",13,0)
 I $D(^VAT(391.71,"C",DFN)) D
"RTN","RGACTIV",14,0)
 . S MSG=0 S MSG=$O(^VAT(391.71,"C",DFN,MSG)) Q:'MSG  D
"RTN","RGACTIV",15,0)
 .. S DIC="391.71",DR=".01;.04;2.1",DA=MSG,DIQ="RGMSG",DIQ(0)="E"
"RTN","RGACTIV",16,0)
 .. D EN^DIQ1 K DIC,DR,DA,DIQ
"RTN","RGACTIV",17,0)
 .. S MSGDATA=RGMSG(391.71,MSG,.04,"E")_"^"_RGMSG(391.71,MSG,.01,"E")_"^"_MSG_"^"_RGMSG(391.71,MSG,2.1,"E")
"RTN","RGACTIV",18,0)
 .. S ARRAY(ICN,SITE,"PIVOT",MSG)=ICN_"^"_SITE_"^"_"PIVOT^"_MSGDATA
"RTN","RGACTIV",19,0)
EXC ;Get exception information 
"RTN","RGACTIV",20,0)
 D GETEX^RGEX03(.RETURN,DFN)
"RTN","RGACTIV",21,0)
 S X=0 F  S X=$O(RETURN(X)) Q:'X  S ARRAY(ICN,SITE,"EXC",X)=ICN_"^"_SITE_"^"_"EXC^"_RETURN(X)
"RTN","RGACTIV",22,0)
QUIT ;
"RTN","RGACTIV",23,0)
 K DFN,RGMSG,MSG,MSGDATA,RETURN,SITE,X
"RTN","RGACTIV",24,0)
 Q
"RTN","RGADTP1")
0^9^B39482051^B32629728
"RTN","RGADTP1",1,0)
RGADTP1 ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS - CONTINUED ;6/2/02
"RTN","RGADTP1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**26,27,42,45,44,47,48**;30 Apr 99;Build 3
"RTN","RGADTP1",3,0)
PIDP(MSG,ARRAY,HL) ;process PID segment
"RTN","RGADTP1",4,0)
 N ID,IDS,PIDAA,PIDNTC
"RTN","RGADTP1",5,0)
 ;Since PID can be over 245 characters loop through setting a PID ARRAY
"RTN","RGADTP1",6,0)
 ;sequenced PID(1)="PID"... PID(4 or 5) can be over 245 characters so
"RTN","RGADTP1",7,0)
 ;it will also loop and place it in PID(4,1...
"RTN","RGADTP1",8,0)
 ;
"RTN","RGADTP1",9,0)
 ; Input variables
"RTN","RGADTP1",10,0)
 ;   assumes that MSG or MSG(I) will contain the PID segment
"RTN","RGADTP1",11,0)
 ; Output ARRAY ARRAY will contain the following subscripts
"RTN","RGADTP1",12,0)
 ;   SSN - patient SSN
"RTN","RGADTP1",13,0)
 ;   ICN - patient ICN
"RTN","RGADTP1",14,0)
 ;   DFN - sites local identifier
"RTN","RGADTP1",15,0)
 ;   MPISSITE - authoritative source (station# of sending site)
"RTN","RGADTP1",16,0)
 ;   SEX - patient's SEX
"RTN","RGADTP1",17,0)
 ;   MPIDOB - Date of Birth
"RTN","RGADTP1",18,0)
 ;   NAME,SURNAME,FIRST,MIDDLE,PREFIX,and SUFFIX - Patient Name
"RTN","RGADTP1",19,0)
 ;   MMN - Mother's maiden name
"RTN","RGADTP1",20,0)
 ;   POBCITY, POBSTATE - Place of birth city and state
"RTN","RGADTP1",21,0)
 ;
"RTN","RGADTP1",22,0)
 N PID,MPIJ,LNGTH,LNGTH1,PID1,SEQ,SEQ1,COMP,SUBCOMP,REP,HLECH,X,Y,CNT,NXT,ID,IDS,PIDAA,PIDNTC,NAME,LNGTH2,PIDSITE,PIDXDT,HLECH,HLFS
"RTN","RGADTP1",23,0)
 S HLFS=HL("FS"),HLECH=HL("ECH")
"RTN","RGADTP1",24,0)
 S ARRAY("DFN")="",ARRAY("ICN")="",ARRAY("CLAIMN")="",ARRAY("SSN")="",ARRAY("ALIAS")=""
"RTN","RGADTP1",25,0)
 S COMP=$E(HL("ECH"),1),SUBCOMP=$E(HL("ECH"),4),REP=$E(HL("ECH"),2)
"RTN","RGADTP1",26,0)
 S LNGTH=$L(MSG,HL("FS")) F SEQ=1:1:LNGTH S PID(SEQ)=$P(MSG,HL("FS"),SEQ)
"RTN","RGADTP1",27,0)
 S SEQ1=1,X=0 F  S X=$O(MSG(X)) Q:'X  S LNGTH=$L(MSG(X),HL("FS")) D
"RTN","RGADTP1",28,0)
 . F Y=1:1:LNGTH S:Y'=1 SEQ=SEQ+1 D
"RTN","RGADTP1",29,0)
 .. S NXT=$P(MSG(X),HL("FS"),Y) D
"RTN","RGADTP1",30,0)
 ... I $L($G(PID(SEQ)))=245 D  Q
"RTN","RGADTP1",31,0)
 .... I $L(NXT_$G(PID(SEQ,SEQ1)))>245 S LNGTH1=$L(PID(SEQ,SEQ1)) S LNGTH2=245-LNGTH1,PID(SEQ,SEQ1)=$G(PID(SEQ,SEQ1))_$E(NXT,1,LNGTH2),LNGTH2=LNGTH2+1,NXT=$E(NXT,LNGTH2,$L(NXT)),SEQ1=SEQ1+1
"RTN","RGADTP1",32,0)
 .... I $L(NXT_$G(PID(SEQ,SEQ1)))'>245 S PID(SEQ,SEQ1)=$G(PID(SEQ,SEQ1))_NXT
"RTN","RGADTP1",33,0)
 ... I $L(NXT_$G(PID(SEQ)))>245 S LNGTH1=$L($G(PID(SEQ))) S LNGTH2=245-LNGTH1,PID(SEQ)=$G(PID(SEQ))_$E(NXT,1,LNGTH2),LNGTH2=LNGTH2+1,NXT=$E(NXT,LNGTH2,$L(NXT)) S PID(SEQ,SEQ1)=NXT
"RTN","RGADTP1",34,0)
 ... I $L(NXT_$G(PID(SEQ)))'>245 S PID(SEQ)=$G(PID(SEQ))_NXT Q
"RTN","RGADTP1",35,0)
 ;get PID-3 Patient Identifier List (three ids should be returned ICN, SSN, and DFN)
"RTN","RGADTP1",36,0)
 N LASTID,IDCNT,CNT,ACNT
"RTN","RGADTP1",37,0)
 S IDS=PID(4)
"RTN","RGADTP1",38,0)
 S LASTID=$L(IDS,REP),IDCNT=1,IDS=PID(4),CNT=1,ACNT=1
"RTN","RGADTP1",39,0)
 F X=1:1:LASTID S ID=$P(IDS,REP,X) D
"RTN","RGADTP1",40,0)
 .;if this is the last entry check for an extension of the message and reset the key variables
"RTN","RGADTP1",41,0)
 .I X=LASTID I $D(PID(4,IDCNT)) S ID=ID_$P(PID(4,IDCNT),REP),IDS=$P(PID(4,IDCNT),REP,2,99),IDCNT=IDCNT+1,X=0,LASTID=$L(IDS,REP)
"RTN","RGADTP1",42,0)
 . ;get id, assigning authority, and name type code
"RTN","RGADTP1",43,0)
 . S PIDAA=$P($P(ID,COMP,4),SUBCOMP),PIDNTC=$P(ID,COMP,5),PIDSITE=$P($P(ID,COMP,6),SUBCOMP,2),PIDXDT=$P(ID,COMP,8)
"RTN","RGADTP1",44,0)
 . S ID=$P(ID,COMP)
"RTN","RGADTP1",45,0)
 . ;Q:ID="" **48
"RTN","RGADTP1",46,0)
 . ;check assigning authority(0363) AND name type code(0203)
"RTN","RGADTP1",47,0)
 . I PIDAA="USVHA" D
"RTN","RGADTP1",48,0)
 .. I PIDNTC="NI" D
"RTN","RGADTP1",49,0)
 ... I $G(PIDXDT)="" S ARRAY("ICN")=ID,ARRAY("MPISSITE")=PIDSITE,ARRAY(991.02)=$P(ID,"V",2)  ;National unique individual identifier
"RTN","RGADTP1",50,0)
 ... I $G(PIDXDT)'="" S ARRAY("OID",CNT)=ID_"^"_PIDAA_"^"_PIDSITE_"^"_PIDXDT,CNT=CNT+1  ;Deprecated National unique individual identifier
"RTN","RGADTP1",51,0)
 .. I PIDNTC="PI" S ARRAY("DFN")=ID,ARRAY("DFNLOC")=PIDSITE  ;Patient internal identifier
"RTN","RGADTP1",52,0)
 . I PIDAA="USSSA" D
"RTN","RGADTP1",53,0)
 .. I PIDNTC="SS",PIDXDT="" S ARRAY("SSN")=ID I ID=HL("Q") S ARRAY("SSN")="@"  ;Social Security number **44 (new) look out for alias ssns
"RTN","RGADTP1",54,0)
 .. I PIDNTC="SS",PIDXDT'="" S $P(ARRAY("ALIAS",ACNT),"^",2)=ID,ACNT=ACNT+1 ;**48 store alias ssn
"RTN","RGADTP1",55,0)
 .. ;**47 includes HL("Q") check
"RTN","RGADTP1",56,0)
 . I PIDAA="USVBA" D
"RTN","RGADTP1",57,0)
 .. I PIDNTC="PN" S ARRAY("CLAIMN")=ID  ;VBA CLAIM#
"RTN","RGADTP1",58,0)
 ;get PID-4 alternate ID (ICN History)
"RTN","RGADTP1",59,0)
 I $G(PID(5))'="" D
"RTN","RGADTP1",60,0)
 . S CNT=1
"RTN","RGADTP1",61,0)
 . F X=1:1:$L(PID(5),REP) S ARRAY("OID",CNT)=$P(PID(5),REP,X),CNT=CNT+1
"RTN","RGADTP1",62,0)
 . S Y=0 F  S Y=$O(PID(5,Y)) Q:'Y  D
"RTN","RGADTP1",63,0)
 .. S ARRAY("OID",CNT-1)=ARRAY("OID",CNT-1)_$P(PID(5,Y),REP)
"RTN","RGADTP1",64,0)
 .. F X=2:1:$L(PID(5,Y),REP) S ARRAY("OID",CNT)=$P(PID(5,Y),REP,X),CNT=CNT+1
"RTN","RGADTP1",65,0)
 . S X=0 F  S X=$O(ARRAY("OID",X)) Q:'X  D
"RTN","RGADTP1",66,0)
 .. N ID,AA,AL S ID=$P(ARRAY("OID",X),COMP),AA=$P($P(ARRAY("OID",X),COMP,4),SUBCOMP,1),AL=$P($P(ARRAY("OID",X),COMP,6),SUBCOMP,2) S AL=$$IEN^XUAF4(AL)
"RTN","RGADTP1",67,0)
 .. S ARRAY("OID",X)=ID_"^"_AA_"^"_AL
"RTN","RGADTP1",68,0)
 ;get PID-5 Patient Name
"RTN","RGADTP1",69,0)
 N KK,JJ,TMPJ,IDCNT2 S IDCNT=1
"RTN","RGADTP1",70,0)
 I $G(PID(6))'="" F IDCNT2=1:1:$L(PID(6),REP) S NAME=$P(PID(6),REP,IDCNT2) D
"RTN","RGADTP1",71,0)
 .I $P(NAME,COMP,7)="L" S ARRAY("SURNAME")=$P(NAME,COMP),ARRAY("FIRST")=$P(NAME,COMP,2),ARRAY("MIDDLE")=$P(NAME,COMP,3),ARRAY("PREFIX")=$P(NAME,COMP,4),ARRAY("SUFFIX")=$P(NAME,COMP,5),ARRAY("NAME")=$$FMNAME^HLFNC($P(NAME,COMP,1,6)) Q
"RTN","RGADTP1",72,0)
 .I $P(NAME,COMP,7)="A" S $P(ARRAY("ALIAS",IDCNT),"^")=$$FMNAME^HLFNC($P(NAME,COMP,1,6)),IDCNT=IDCNT+1 Q  ;**48 ALIAS NAMES?
"RTN","RGADTP1",73,0)
 .;**48 alias could send PID(6) to second subscript level
"RTN","RGADTP1",74,0)
 .S KK=$O(PID(6,"")) I KK'="" S PID(6,KK)=$P(PID(6),REP,IDCNT2)_PID(6,KK)
"RTN","RGADTP1",75,0)
 .S JJ=0 F  S JJ=$O(PID(6,JJ)) Q:'JJ  D
"RTN","RGADTP1",76,0)
 ..I JJ'=KK S PID(6,JJ)=$P(PID(6,$O(PID(6,JJ),-1)),REP,TMPJ)_PID(6,JJ)
"RTN","RGADTP1",77,0)
 ..F TMPJ=1:1:$L(PID(6,JJ),REP) S NAME=$P(PID(6,JJ),REP,TMPJ) D
"RTN","RGADTP1",78,0)
 ...I $P(NAME,COMP,7)="A" S $P(ARRAY("ALIAS",IDCNT),"^")=$$FMNAME^HLFNC($P(NAME,COMP,1,6)),IDCNT=IDCNT+1
"RTN","RGADTP1",79,0)
 ;get PID-6 Mother's maiden name
"RTN","RGADTP1",80,0)
 S ARRAY("MMN")=$P($G(PID(7)),COMP,1,5) D
"RTN","RGADTP1",81,0)
 . I $P(ARRAY("MMN"),COMP)'=HL("Q") S HLECH=HL("ECH") S ARRAY("MMN")=$$FREE^RGRSPARS($$FMNAME^HLFNC(ARRAY("MMN"))) Q
"RTN","RGADTP1",82,0)
 . I $P(ARRAY("MMN"),COMP)=HL("Q") S ARRAY("MMN")=$$FREE^RGRSPARS($P(ARRAY("MMN"),COMP))
"RTN","RGADTP1",83,0)
 ;get PID-7 Date of Birth
"RTN","RGADTP1",84,0)
 ;**47 taking HL("Q") into account
"RTN","RGADTP1",85,0)
 I $G(PID(8))=HL("Q") S PID(8)="@",ARRAY("MPIDOB")="@"
"RTN","RGADTP1",86,0)
 I $G(PID(8))'="@" S ARRAY("MPIDOB")=$$FMDATE^HLFNC($G(PID(8)))
"RTN","RGADTP1",87,0)
 ;get PID-8 Sex
"RTN","RGADTP1",88,0)
 ;**47 taking HL("Q") into account
"RTN","RGADTP1",89,0)
 I $G(PID(9))=HL("Q") S PID(9)="@"
"RTN","RGADTP1",90,0)
 S ARRAY("SEX")=$G(PID(9))
"RTN","RGADTP1",91,0)
 ;get PID-11-3 ADDRESS BOTH "P"rimary and "N" Place of
"RTN","RGADTP1",92,0)
 S CNT=1
"RTN","RGADTP1",93,0)
 N ADRTYPE,ADDR
"RTN","RGADTP1",94,0)
 F X=1:1:$L(PID(12),REP) D
"RTN","RGADTP1",95,0)
 . S ADDR=$P(PID(12),REP,X),ADRTYPE=$P(ADDR,COMP,7)
"RTN","RGADTP1",96,0)
 . I ADRTYPE="P" D
"RTN","RGADTP1",97,0)
 .. S ADDR=$$FREE^RGRSPARS(ADDR)
"RTN","RGADTP1",98,0)
 .. S ARRAY(.111)=$$FREE^RGRSPARS($P(ADDR,COMP,1))  ;addr [1]
"RTN","RGADTP1",99,0)
 .. S ARRAY(.112)=$$FREE^RGRSPARS($P(ADDR,COMP,2))  ;addr [2]
"RTN","RGADTP1",100,0)
 .. S ARRAY(.113)=$$FREE^RGRSPARS($P(ADDR,COMP,8))  ;addr [3]
"RTN","RGADTP1",101,0)
 .. S ARRAY(.114)=$$FREE^RGRSPARS($P(ADDR,COMP,3))  ;city
"RTN","RGADTP1",102,0)
 .. S ARRAY(.115)=$$STATE^RGRSPARS($P(ADDR,COMP,4))  ;state
"RTN","RGADTP1",103,0)
 .. S ARRAY(.1112)=$$FREE^RGRSPARS($P(ADDR,COMP,5))  ;zip+4
"RTN","RGADTP1",104,0)
 .. N CNTYCODE S CNTYCODE=PID(13)  ;county code
"RTN","RGADTP1",105,0)
 .. S ARRAY(.117)=$$COUNTY^RGRSPARS(ARRAY(.115),CNTYCODE)
"RTN","RGADTP1",106,0)
 .. S ARRAY(.131)=$$FREE^RGRSPARS(PID(14))
"RTN","RGADTP1",107,0)
 .. S ARRAY(.132)=$$FREE^RGRSPARS(PID(15))
"RTN","RGADTP1",108,0)
 . I ADRTYPE="N" D
"RTN","RGADTP1",109,0)
 .. S ARRAY("POBCITY")=$$FREE^RGRSPARS($P(ADDR,COMP,3))  ;POB city
"RTN","RGADTP1",110,0)
 .. S ARRAY("POBSTATE")=$$STATE^RGRSPARS($P(ADDR,COMP,4))  ;POB state
"RTN","RGADTP1",111,0)
 ;marital status
"RTN","RGADTP1",112,0)
 S ARRAY(.05)=$$MARITAL^RGRSPARS(PID(17))
"RTN","RGADTP1",113,0)
 ;multiple birth indicator **47
"RTN","RGADTP1",114,0)
 S ARRAY("MBI")=$G(PID(25)) I ARRAY("MBI")=HL("Q") S ARRAY("MBI")="@" ;**47 to get MBI and setup as yes/no field change to @ if HL("Q")
"RTN","RGADTP1",115,0)
 ;;REMOVED FROM PATCH 45 DUE TO NEEDING DG707
"RTN","RGADTP1",116,0)
 ;religious preference
"RTN","RGADTP1",117,0)
 S ARRAY(.08)=$$RELIG^RGRSPARS(PID(18))
"RTN","RGADTP1",118,0)
 ;address
"RTN","RGADTP1",119,0)
 ;get PID-29 Date of Death
"RTN","RGADTP1",120,0)
 S ARRAY("MPIDOD")=$$FREE^RGRSPARS($$FMDATE^HLFNC($G(PID(30)))),ARRAY(.351)=ARRAY("MPIDOD")
"RTN","RGADTP1",121,0)
 Q
"RTN","RGADTP2")
0^4^B48920670^B68268271
"RTN","RGADTP2",1,0)
RGADTP2 ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS - CONTINUED ;10/30/02  10:04
"RTN","RGADTP2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**27,20,45,44,47,48**;30 Apr 99;Build 3
"RTN","RGADTP2",3,0)
DBIA ;
"RTN","RGADTP2",4,0)
 ;Reference to $$ADD^VAFCEHU1 supported by IA #2753
"RTN","RGADTP2",5,0)
 ;Reference to EDIT^VAFCPTED supported by IA #2784
"RTN","RGADTP2",6,0)
 Q
"RTN","RGADTP2",7,0)
PROCIN(ARRAY,RGLOCAL,RGER,DFN,HL) ;
"RTN","RGADTP2",8,0)
 N RGRSDFN,OTHSITE,NODE,ICN,CMORIEN,CMOR,CMORDISP,SENSTVTY,RMTDOD,LOCDOD,VAFCA,VAFCA08,HERE,BOGUS,ARAY,REP
"RTN","RGADTP2",9,0)
 S REP=$E(HL("ECH"),2)
"RTN","RGADTP2",10,0)
 S HERE=$P($$SITE^VASITE,"^",3)
"RTN","RGADTP2",11,0)
 ;if sending site is your site quit
"RTN","RGADTP2",12,0)
 Q:$G(ARRAY("MPISSITE"))=$G(HERE)
"RTN","RGADTP2",13,0)
 S ARRAY(.097)=$P($$NOW^XLFDT,".")
"RTN","RGADTP2",14,0)
 I $G(ARRAY("ICN"))'="" D
"RTN","RGADTP2",15,0)
 .S RGRSDFN=$$GETDFN^MPIF001(+ARRAY("ICN")) I +RGRSDFN<1 S RGER=RGRSDFN_" ICN#"_$G(ARRAY("ICN")) Q  ;quit and return error msg
"RTN","RGADTP2",16,0)
 .S OTHSITE=ARRAY("SENDING SITE") ;**40 REMOVED THE PLUS TO KEEP SUFFIX ON STATION# & CHANGED THE SITE TO BE SENDING SITE INSTEAD OF AUTHORITATIVE SOURCE
"RTN","RGADTP2",17,0)
 I $G(RGRSDFN)="" S RGRSDFN=$G(DFN)
"RTN","RGADTP2",18,0)
 I $G(RGRSDFN)="" S RGER="-1^DFN not defined"
"RTN","RGADTP2",19,0)
 Q:$G(RGER)
"RTN","RGADTP2",20,0)
 I $G(OTHSITE)="" S OTHSITE=""
"RTN","RGADTP2",21,0)
 S NODE=$$MPINODE^MPIFAPI(RGRSDFN)
"RTN","RGADTP2",22,0)
 S ICN=$P(NODE,"^")
"RTN","RGADTP2",23,0)
 S CMORIEN=$P(NODE,"^",3)
"RTN","RGADTP2",24,0)
 S CMOR=$$NS^XUAF4(CMORIEN)
"RTN","RGADTP2",25,0)
 S CMORDISP=$P(CMOR,"^",1)
"RTN","RGADTP2",26,0)
 S CMOR=$P(CMOR,"^",2)
"RTN","RGADTP2",27,0)
 ;
"RTN","RGADTP2",28,0)
 ;If patient is Sensitive at other site but not here send bulletin
"RTN","RGADTP2",29,0)
 I $G(ARRAY("SENSITIVITY"))'="" S SENSTVTY=$G(ARRAY("SENSITIVITY")) D
"RTN","RGADTP2",30,0)
 .N NAME S NAME=ARRAY("NAME")
"RTN","RGADTP2",31,0)
 .I '$$SENSTIVE^RGRSENS(RGRSDFN),SENSTVTY D
"RTN","RGADTP2",32,0)
 ..S ARAY("SSN")=ARRAY("SSN"),ARAY("SENDING SITE")=ARRAY("SENDING SITE")
"RTN","RGADTP2",33,0)
 ..S ARAY("SENSITIVITY USER")=ARRAY("SENSITIVITY USER"),ARAY("SENSITIVITY DATE")=ARRAY("SENSITIVITY DATE")
"RTN","RGADTP2",34,0)
 ..D SENSTIVE^RGRSBUL1(RGRSDFN,"ARAY",NAME)
"RTN","RGADTP2",35,0)
 ;
"RTN","RGADTP2",36,0)
 ;If patient has DATE OF DEATH (DOD) at remote site send bulletin
"RTN","RGADTP2",37,0)
 ;Ignore time if present with date.
"RTN","RGADTP2",38,0)
 S RMTDOD=$G(ARRAY("MPIDOD")),RMTDOD=$P(RMTDOD,".")
"RTN","RGADTP2",39,0)
 S DFN=RGRSDFN D DEM^VADPT
"RTN","RGADTP2",40,0)
 S LOCDOD=$P($P(VADM(6),"^"),".")
"RTN","RGADTP2",41,0)
 ;If there is a remote DOD but no local DOD  OR if remote DOD is different from local DOD, send bulletin
"RTN","RGADTP2",42,0)
 I RMTDOD D
"RTN","RGADTP2",43,0)
 .N NAME S NAME=ARRAY("NAME"),ARAY("SSN")=ARRAY("SSN"),ARAY("SENDING SITE")=ARRAY("SENDING SITE")
"RTN","RGADTP2",44,0)
 .D RMTDOD^RGRSBUL1(RGRSDFN,"ARAY",NAME,RMTDOD,LOCDOD)
"RTN","RGADTP2",45,0)
 K VADM
"RTN","RGADTP2",46,0)
 ;
"RTN","RGADTP2",47,0)
NOTLOC I 'RGLOCAL D
"RTN","RGADTP2",48,0)
 .;if sending site is not the CMOR AND NOT THE MPI - log update into PDR if differences exist **45 ADDED MPI
"RTN","RGADTP2",49,0)
 .I (OTHSITE)'=(CMOR)&(OTHSITE'="200M") D  Q
"RTN","RGADTP2",50,0)
 ..S VAFCA=$P($$NOW^XLFDT,".")_"^"_$$NOW^XLFDT_"^"_$G(ARRAY("SENDING SITE"))_"^"_RGRSDFN
"RTN","RGADTP2",51,0)
 ..S ARRAY(.01)=$$FREE^RGRSPARS(ARRAY("NAME")),ARRAY(.03)=$$FREE^RGRSPARS($G(ARRAY("MPIDOB")))
"RTN","RGADTP2",52,0)
 ..S ARRAY(.09)=$$FREE^RGRSPARS($G(ARRAY("SSN"))),ARRAY(.02)=$$SEX^RGRSPARS($G(ARRAY("SEX")))
"RTN","RGADTP2",53,0)
 ..S ARRAY(.2403)=$$FREE^RGRSPARS($G(ARRAY("MMN"))),ARRAY(991.01)=$P($G(ARRAY("ICN")),"V")
"RTN","RGADTP2",54,0)
 ..N ARAY M ARAY(2)=ARRAY
"RTN","RGADTP2",55,0)
 ..S VAFCA08=1 S BOGUS=$$ADD^VAFCEHU1(VAFCA,"ARAY")
"RTN","RGADTP2",56,0)
 .;if sending site is the CMOR OR MPI - synchronize data **45 ADDED MPI AND SSNV TO UPDATED FIELDS
"RTN","RGADTP2",57,0)
 .I (OTHSITE)=(CMOR)!(OTHSITE="200M") D
"RTN","RGADTP2",58,0)
 ..;**44 is there an outstanding edit in the ADT/HL7 PIVOT file for this patient for an identity element
"RTN","RGADTP2",59,0)
 ..S RGER=$$CHKPVT^RGADTP3(.ARRAY) Q:+RGER<0
"RTN","RGADTP2",60,0)
 ..N DR,ARAY2 S RGER=""
"RTN","RGADTP2",61,0)
 ..D DIFF^RGADTP3(.ARRAY,RGRSDFN,.DR,.ARRAY) ;**47
"RTN","RGADTP2",62,0)
 ..I DR'="" D
"RTN","RGADTP2",63,0)
 ...S VAFCA08=1,ARAY(2,.01)=ARRAY("NAME"),ARAY(2,.03)=$G(ARRAY("MPIDOB"))
"RTN","RGADTP2",64,0)
 ...I ARRAY("SSN")'="" S ARAY(2,.09)=$G(ARRAY("SSN")) ;**45 only set SSN to update if it isn't null
"RTN","RGADTP2",65,0)
 ...S ARAY(2,.02)=$G(ARRAY("SEX")),ARAY(2,.2403)=$G(ARRAY("MMN")),ARAY(2,994)=$G(ARRAY("MBI"))
"RTN","RGADTP2",66,0)
 ...;**48 ONLY SET SSN VERIFICATION STATUS AND PSEUDO SSN REASON IF SSN UPDATE WAS SUCCESSFUL
"RTN","RGADTP2",67,0)
 ...I $D(ARRAY("ALIAS")) M ARAY(2,1)=ARRAY("ALIAS") ;**48 ADD ALIAS TO MIX
"RTN","RGADTP2",68,0)
 ...D EDIT^VAFCPTED(RGRSDFN,"ARAY(2)",DR)
"RTN","RGADTP2",69,0)
 ...;check to see if edits were successful, if not set RGER="why it failed"
"RTN","RGADTP2",70,0)
 ...N NAME,SSN,PDOB,SEX,MMN,OLDNAME,OLDHLNAM,OLDMMN,OLDHLMMN,HLNAME,HLMMN,SSNV,MBI
"RTN","RGADTP2",71,0)
 ...S NAME=$$GET1^DIQ(2,+RGRSDFN_",",.01,"I"),PDOB=$$GET1^DIQ(2,+RGRSDFN_",",.03,"I")
"RTN","RGADTP2",72,0)
 ...S SSN=$$GET1^DIQ(2,+RGRSDFN_",",.09,"I"),SEX=$$GET1^DIQ(2,+RGRSDFN_",",.02,"I")
"RTN","RGADTP2",73,0)
 ...S MMN=$$GET1^DIQ(2,+RGRSDFN_",",.2403,"I"),MBI=$$GET1^DIQ(2,+RGRSDFN_",",994,"I")
"RTN","RGADTP2",74,0)
 ...D STDNAME^XLFNAME(.NAME,"F",.OLDNAME) S HLNAME=ARRAY("NAME") D STDNAME^XLFNAME(.HLNAME,"F",.OLDHLNAM)
"RTN","RGADTP2",75,0)
 ...I NAME'=$G(HLNAME) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Name field failure"
"RTN","RGADTP2",76,0)
 ...I PDOB'=$G(ARRAY("MPIDOB")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"DOB field failure"
"RTN","RGADTP2",77,0)
 ...;**48
"RTN","RGADTP2",78,0)
 ...I SSN["P" D
"RTN","RGADTP2",79,0)
 ....;if pseudo SSN reason field has been added to the DD then attempt to set it
"RTN","RGADTP2",80,0)
 ....N PS,ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",81,0)
 .....S ARAY2(2,.0906)=$G(ARRAY(.0906)),DR=".0906;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",82,0)
 .....S PS=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I")
"RTN","RGADTP2",83,0)
 .....I PS=""&(ARAY2(2,.0906)="@") Q
"RTN","RGADTP2",84,0)
 .....I PS'=ARAY2(2,.0906) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Pseudo SSN Reason field failure"
"RTN","RGADTP2",85,0)
 .....I PS=ARAY2(2,.0906) D
"RTN","RGADTP2",86,0)
 ......K ARAY2 N ERROR,LABEL D FIELD^DID(2,.0907,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",87,0)
 ......S ARAY2(2,.0907)=$G(ARRAY(.0907)),DR=".0907;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",88,0)
 ......S SSNV=$$GET1^DIQ(2,+RGRSDFN_",",.0907,"I")
"RTN","RGADTP2",89,0)
 ......S:$G(ARRAY(.0907))="@" ARRAY(.0907)="" I SSNV'=$G(ARRAY(.0907)) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN VERIFICATION field failure"
"RTN","RGADTP2",90,0)
 ...I $G(ARRAY("SSN"))'="",SSN'=$G(ARRAY("SSN")) D
"RTN","RGADTP2",91,0)
 ....I $G(ARRAY("SSN"))="P",SSN["P" Q  ;**47 NEEDED TO CREATE PSEUDO AND DID
"RTN","RGADTP2",92,0)
 ....S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN field failure" ;**45 only check if SSN is sent isn't null
"RTN","RGADTP2",93,0)
 ...I SSN=$G(ARRAY("SSN")) D
"RTN","RGADTP2",94,0)
 ....;if SSN VERIFICATION STATUS field has been added to the DD then attempt to set it
"RTN","RGADTP2",95,0)
 ....K ARAY2 N ERROR,LABEL D FIELD^DID(2,.0907,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",96,0)
 .....S ARAY2(2,.0907)=$G(ARRAY(.0907)) S DR=".0907;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",97,0)
 .....S SSNV=$$GET1^DIQ(2,+RGRSDFN_",",.0907,"I")
"RTN","RGADTP2",98,0)
 .....S:$G(ARRAY(.0907))="@" ARRAY(.0907)="" I SSNV'=$G(ARRAY(.0907)) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN VERIFICATION field failure"
"RTN","RGADTP2",99,0)
 .....I SSNV'="" D
"RTN","RGADTP2",100,0)
 ......N PS,ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",101,0)
 ......S ARAY2(2,.0906)=$G(ARRAY(.0906)) S DR=".0906;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",102,0)
 ......S PS=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I")
"RTN","RGADTP2",103,0)
 ......I PS=""&(ARAY2(2,.0906)="@") Q
"RTN","RGADTP2",104,0)
 ......S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Pseudo SSN Reason field failure"
"RTN","RGADTP2",105,0)
 ...I SEX'=$G(ARRAY("SEX")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SEX field failure"
"RTN","RGADTP2",106,0)
 ...D STDNAME^XLFNAME(.MMN,"F",.OLDMMN) S HLMMN=ARRAY("MMN") D STDNAME^XLFNAME(.HLMMN,"F",.OLDHLMMN)
"RTN","RGADTP2",107,0)
 ...I MMN'=$G(HLMMN) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"MOTHER'S MAIDEN NAME field failure"
"RTN","RGADTP2",108,0)
 ...;**REMOVED MBI FROM PATCH 45 PUT BACK IN **47
"RTN","RGADTP2",109,0)
 ...I MBI'=$G(ARRAY("MBI")) D
"RTN","RGADTP2",110,0)
 ....Q:MBI=""&($G(ARRAY("MBI"))="@")  ;**47 "" AND @ ARE THE SAME
"RTN","RGADTP2",111,0)
 ....S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"MULTIPLE BIRTH INDICATOR field failure"
"RTN","RGADTP2",112,0)
 ...;send the updated fields to the MPI to synch site with MPI
"RTN","RGADTP2",113,0)
 ...I HL("ETN")'="A31" S ZTSAVE("DFN")="",ZTRTN="MPISYN^RGADTPC",ZTDESC="Sending Synchronized Patient Data to MPI...",ZTIO="RG QUEUE",ZTDTH=$H D ^%ZTLOAD
"RTN","RGADTP2",114,0)
 ...;**45 ^ don't trigger A31 sync message if A31 was being processed-- ack to a31 will sync id elements on MPI
"RTN","RGADTP2",115,0)
 Q
"RTN","RGADTP3")
0^5^B11058020^n/a
"RTN","RGADTP3",1,0)
RGADTP3 ;BIR/CMC-RGADTP2 - CONTINUED ;10/30/02  10:04
"RTN","RGADTP3",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**48**;30 Apr 99;Build 3
"RTN","RGADTP3",3,0)
 ;
"RTN","RGADTP3",4,0)
 ;MOVED CHKPVT AND DIFF FROM RGADTP2 DUE TO ROUTINE SIZE ISSUE
"RTN","RGADTP3",5,0)
 Q
"RTN","RGADTP3",6,0)
CHKPVT(ARRAY) ;CHECKS TO SEE IF OUTSTANDING IDENTITY EDIT IS WAITING TO BE SENT IN THE ADT/HL7 PIVOT FILE
"RTN","RGADTP3",7,0)
 ;**44 CREATED - ARRAY CONTAINS THE ARRAY ELEMENTS NEEDED TO FIND THE PATIENT IN THE ADT/HL7 PIVOT FILE
"RTN","RGADTP3",8,0)
 ;RETURNED IS -1^EDIT PENDING IN PIVOT FILE OR 0 IF THERE ISN'T ONE
"RTN","RGADTP3",9,0)
 I '$D(^VAT(391.71,"C",ARRAY("DFN"))) Q 0
"RTN","RGADTP3",10,0)
 N PIV,FIELDS
"RTN","RGADTP3",11,0)
 S PIV=$O(^VAT(391.71,"C",ARRAY("DFN"),"A"),-1) ;get last entry in the pivot file for this patient
"RTN","RGADTP3",12,0)
 I '$D(^VAT(391.71,"AXMIT",4,PIV))&('$D(^VAT(391.71,"AXMIT",3,PIV))) Q 0
"RTN","RGADTP3",13,0)
 S FIELDS=$$GET1^DIQ(391.71,PIV_",",2.1,"I")
"RTN","RGADTP3",14,0)
 I FIELDS[".01;"!(FIELDS[".02;")!(FIELDS[".03;")!(FIELDS[".09;")!(FIELDS[".0906;")!(FIELDS[".2403;")!(FIELDS["994;") Q "-1^DFN "_ARRAY("DFN")_":  Edits made to identity fields waiting to come to MPI, MPI update not processed as of yet."
"RTN","RGADTP3",15,0)
 Q 0
"RTN","RGADTP3",16,0)
 ;
"RTN","RGADTP3",17,0)
DIFF(ARRAY,RGRSDFN,DR,ARAY) ; are there fields to update? **47
"RTN","RGADTP3",18,0)
 N NAME,SSN,PDOB,SEX,MMN,OLDNAME,OLDHLNAM,OLDMMN,OLDHLMMN,HLNAME,HLMMN,SSNV,MBI,PSNR
"RTN","RGADTP3",19,0)
 S DR="",NAME=$$GET1^DIQ(2,+RGRSDFN_",",.01,"I"),HLNAME=ARRAY("NAME")
"RTN","RGADTP3",20,0)
 ;**48 remove name standardization check
"RTN","RGADTP3",21,0)
 ;D STDNAME^XLFNAME(.NAME,"F",.OLDNAME) S HLNAME=ARRAY("NAME") D STDNAME^XLFNAME(.HLNAME,"F",.OLDHLNAM)
"RTN","RGADTP3",22,0)
 I NAME'=$G(HLNAME) S DR=DR_".01;",ARAY(2,.01)=ARRAY("NAME")
"RTN","RGADTP3",23,0)
 S PDOB=$$GET1^DIQ(2,+RGRSDFN_",",.03,"I") I PDOB'=ARRAY("MPIDOB") S DR=DR_".03;",ARAY(2,.03)=ARRAY("MPIDOB")
"RTN","RGADTP3",24,0)
 S SSN=$$GET1^DIQ(2,+RGRSDFN_",",.09,"I") D
"RTN","RGADTP3",25,0)
 .I SSN["P",ARRAY("SSN")=""!(ARRAY("SSN")="@") Q
"RTN","RGADTP3",26,0)
 .; ^ treat pseudos and null/@ as the same
"RTN","RGADTP3",27,0)
 .; **47 if incoming SSN value is null/@ and existing SSN isn't a pseudo create a new pseudo SSN
"RTN","RGADTP3",28,0)
 .I SSN'["P" I ARRAY("SSN")="@"!(ARRAY("SSN")="") S ARRAY("SSN")="P"
"RTN","RGADTP3",29,0)
 .I SSN'=ARRAY("SSN"),ARRAY("SSN")'="" S DR=DR_".09;",ARAY(2,.09)=ARRAY("SSN")
"RTN","RGADTP3",30,0)
 S SEX=$$GET1^DIQ(2,+RGRSDFN_",",.02,"I") D
"RTN","RGADTP3",31,0)
 .I SEX=""&(ARRAY("SEX")="@") Q
"RTN","RGADTP3",32,0)
 .; ^ treat null and @ as same
"RTN","RGADTP3",33,0)
 .I SEX'=ARRAY("SEX") S DR=DR_".02;",ARAY(2,.02)=ARRAY("SEX")
"RTN","RGADTP3",34,0)
 S SSNV=$$GET1^DIQ(2,+RGRSDFN_",",.0907,"I") I SSNV="" S SSNV="@"
"RTN","RGADTP3",35,0)
 ;if SSN VERIFICATION STATUS field has been added to the DD then attempt to set it
"RTN","RGADTP3",36,0)
 N ERROR,LABEL D FIELD^DID(2,.0907,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP3",37,0)
 .I SSNV'=ARRAY(.0907) S ARAY(2,.0907)=$G(ARRAY(.0907)),DR=DR_".0907;"
"RTN","RGADTP3",38,0)
 S PSNR=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I") I PSNR="" S PSNR="@"
"RTN","RGADTP3",39,0)
 ;if Pseudo SSN Reason field has been added to the DD then attempt to set it
"RTN","RGADTP3",40,0)
 N ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP3",41,0)
 .I PSNR'=ARRAY(.0906) S ARAY(2,.0906)=$G(ARRAY(.0906)),DR=DR_".0906;"
"RTN","RGADTP3",42,0)
 S MBI=$$GET1^DIQ(2,+RGRSDFN_",",994,"I") I MBI="" S MBI="@"
"RTN","RGADTP3",43,0)
 I MBI="@"&(ARRAY("MBI")="") Q
"RTN","RGADTP3",44,0)
 ; ^ treat @ and null as the same
"RTN","RGADTP3",45,0)
 I MBI'=ARRAY("MBI") S DR=DR_"994;",ARAY(2,994)=ARRAY("MBI")
"RTN","RGADTP3",46,0)
 S MMN=$$GET1^DIQ(2,+RGRSDFN_",",.2403,"I") I MMN="" S MMN="@"
"RTN","RGADTP3",47,0)
 D STDNAME^XLFNAME(.MMN,"F",.OLDMMN) S HLMMN=ARRAY("MMN") D STDNAME^XLFNAME(.HLMMN,"F",.OLDHLMMN)
"RTN","RGADTP3",48,0)
 I MMN="@"&($G(HLMMN)="") Q
"RTN","RGADTP3",49,0)
 ; ^ treat @ and null as same
"RTN","RGADTP3",50,0)
 I MMN'=$G(HLMMN) S DR=DR_".2403;",ARAY(2,.2403)=ARRAY("MMN")
"RTN","RGADTP3",51,0)
 I $D(ARRAY("ALIAS")) S DR=DR_"1;"
"RTN","RGADTP3",52,0)
 Q
"RTN","RGEX01")
0^7^B34733554^B33945025
"RTN","RGEX01",1,0)
RGEX01 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/07/99
"RTN","RGEX01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23,43,45,47,48**;30 Apr 99;Build 3
"RTN","RGEX01",3,0)
 ;
"RTN","RGEX01",4,0)
 ;Reference to MAIN^VAFCPDAT supported by IA #3299
"RTN","RGEX01",5,0)
EN ; -- main entry point for RG EXCPT SUMMARY
"RTN","RGEX01",6,0)
 N STDT,ENDDT,PRGSTAT,XFLAG,NOW,%,X,%H,%I,INDT,RUN,INDTT
"RTN","RGEX01",7,0)
 S XFLAG=0 D NOW^%DTC S NOW=%
"RTN","RGEX01",8,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1),INDT=STDT
"RTN","RGEX01",9,0)
 I $D(STDT) S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGEX01",10,0)
 S PRGSTAT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",3)
"RTN","RGEX01",11,0)
 ;status shows 'running' but lock shows 'not running';**47
"RTN","RGEX01",12,0)
 I PRGSTAT="R" D
"RTN","RGEX01",13,0)
 .L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 I $T D  ;can get lock
"RTN","RGEX01",14,0)
 ..L +^RGSITE(991.8):10
"RTN","RGEX01",15,0)
 ..S DIE="^RGSITE(991.8,",DA=1,DR="42///@"
"RTN","RGEX01",16,0)
 ..D ^DIE K DA,DIE,DR ;delete old status
"RTN","RGEX01",17,0)
 ..L -^RGSITE(991.8)
"RTN","RGEX01",18,0)
 ..S PRGSTAT=""
"RTN","RGEX01",19,0)
 .L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",20,0)
 I PRGSTAT="" D
"RTN","RGEX01",21,0)
 . W $C(7)
"RTN","RGEX01",22,0)
 . W !!,"The MPI/PD Exception Purge process has not been run."
"RTN","RGEX01",23,0)
 . ;**48 NO LONGER A CHOICE
"RTN","RGEX01",24,0)
 . W !!,"The MPI/PD Exception Purge process will now run."
"RTN","RGEX01",25,0)
 . W !,"Please come back to this option in five minutes."
"RTN","RGEX01",26,0)
 . W !!,"Please contact IRM to schedule the MPI/PD EXCEPTION PURGE"
"RTN","RGEX01",27,0)
 . W !,"[RG EXCEPTION PURGE] option via TaskMan with a frequency of once an hour."
"RTN","RGEX01",28,0)
 . S XFLAG=1 D QUEPRG
"RTN","RGEX01",29,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 I '$T W $C(7),!!,"The MPI/PD Exception Purge process is currently running.",!,"Please try this option again in five minutes." S XFLAG=1 G EXIT
"RTN","RGEX01",30,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",31,0)
 S RUN=0
"RTN","RGEX01",32,0)
 I $G(PRGSTAT)="C" D
"RTN","RGEX01",33,0)
 . I $P(INDT,".")<$P(NOW,".") S RUN=1 ;RAN A PREVIOUS DAY
"RTN","RGEX01",34,0)
 . I $P(INDT,".")=$P(NOW,".") D
"RTN","RGEX01",35,0)
 .. S INDTT=$E($P(INDT,".",2),1,4),INDTT=INDTT+101
"RTN","RGEX01",36,0)
 .. I INDTT<$E($P(NOW,".",2),1,4) S RUN=1
"RTN","RGEX01",37,0)
 . Q:RUN=0
"RTN","RGEX01",38,0)
 . ;** if job ran more than 1 hour ago, run it now.
"RTN","RGEX01",39,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGEX01",40,0)
 . W !!,"The MPI/PD Exception Purge process will now run."
"RTN","RGEX01",41,0)
 . W !,"Please come back to this option in five minutes."
"RTN","RGEX01",42,0)
 . W !!,"Please contact IRM to verify that the MPI/PD EXCEPTION PURGE "
"RTN","RGEX01",43,0)
 . W !,"[RG EXCEPTION PURGE] option is scheduled to run via TaskMan"
"RTN","RGEX01",44,0)
 . W !,"with a frequency of once an hour."
"RTN","RGEX01",45,0)
 . S XFLAG=1 D QUEPRG
"RTN","RGEX01",46,0)
 I XFLAG=1 G EXIT
"RTN","RGEX01",47,0)
 K RGANS
"RTN","RGEX01",48,0)
 D WAIT^DICD
"RTN","RGEX01",49,0)
 D EN^VALM("RG EXCPT SUMMARY")
"RTN","RGEX01",50,0)
 Q
"RTN","RGEX01",51,0)
 ;
"RTN","RGEX01",52,0)
HDR ; -- header code
"RTN","RGEX01",53,0)
 S VALMHDR(1)="MPI/PD Exception Handling"
"RTN","RGEX01",54,0)
 S VALMHDR(2)=""
"RTN","RGEX01",55,0)
 Q
"RTN","RGEX01",56,0)
 ;
"RTN","RGEX01",57,0)
INIT ; -- init variables and list array
"RTN","RGEX01",58,0)
 I '$D(RGSORT) S RGSORT="SD"
"RTN","RGEX01",59,0)
 K @VALMAR
"RTN","RGEX01",60,0)
 I RGSORT="SD" D DTLIST^RGEXHND1
"RTN","RGEX01",61,0)
 E  I RGSORT="ST" D EXCLST^RGEXHND1
"RTN","RGEX01",62,0)
 E  I RGSORT="SN" D PATLST^RGEXHND1
"RTN","RGEX01",63,0)
 E  I RGSORT="VT" D SELTYP^RGEXHND1
"RTN","RGEX01",64,0)
 Q
"RTN","RGEX01",65,0)
 ;
"RTN","RGEX01",66,0)
SORT ;
"RTN","RGEX01",67,0)
 D INIT
"RTN","RGEX01",68,0)
 S VALMBCK="R"
"RTN","RGEX01",69,0)
 Q
"RTN","RGEX01",70,0)
HELP ; -- help code
"RTN","RGEX01",71,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX01",72,0)
 Q
"RTN","RGEX01",73,0)
HLPPRG ;
"RTN","RGEX01",74,0)
 W !,"Enter Y(YES) to run the MPI/PD Exception Purge process now."
"RTN","RGEX01",75,0)
 W !!,"Enter N(NO) to go directly into the MPI/PD Exception Handling option."
"RTN","RGEX01",76,0)
 Q
"RTN","RGEX01",77,0)
 ;
"RTN","RGEX01",78,0)
EXIT ; -- exit code
"RTN","RGEX01",79,0)
 K VADM,RGDFN,RGNM,RGSORT,RGSSN,STAT,STRING,NDX,NM,IEN,IEN2,X,DATA,CNT,EXCTYPE,ETYPE,^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEX01",80,0)
 Q
"RTN","RGEX01",81,0)
QUEPRG S ZTRTN="MAIN^RGEVPRG",ZTDESC="PURGE ZZ*, OVER 30 DAY AND DUPLICATE RECORDS FROM THE CIRN HL7 EXCEPTION LOG FILE"
"RTN","RGEX01",82,0)
 D NOW^%DTC
"RTN","RGEX01",83,0)
 S ZTIO="",ZTDTH=%
"RTN","RGEX01",84,0)
 I $D(DUZ) S ZTSAVE("DUZ")=DUZ
"RTN","RGEX01",85,0)
 D ^%ZTLOAD
"RTN","RGEX01",86,0)
 D HOME^%ZIS K IO("Q")
"RTN","RGEX01",87,0)
 K ZTDESC,ZTDTH,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK,%
"RTN","RGEX01",88,0)
 Q
"RTN","RGEX01",89,0)
 ;
"RTN","RGEX01",90,0)
EXPND ; -- expand code
"RTN","RGEX01",91,0)
 Q
"RTN","RGEX01",92,0)
 ;
"RTN","RGEX01",93,0)
CUREX() ;Are there any patients in the CIRN HL7 EXCEPTION LOG file (#991.1)
"RTN","RGEX01",94,0)
 ;that are NOT PROCESSED for specific exception types?
"RTN","RGEX01",95,0)
 ;     Return RGEX:
"RTN","RGEX01",96,0)
 ;If RGEX=3 both unprocessed and Primary View Reject exceptions exist
"RTN","RGEX01",97,0)
 ;If RGEX=2 only Primary View Reject exceptions exist
"RTN","RGEX01",98,0)
 ;If RGEX=1 only unprocessed exceptions exist
"RTN","RGEX01",99,0)
 ;If RGEX=0 no unprocessed exceptions exist
"RTN","RGEX01",100,0)
 ;
"RTN","RGEX01",101,0)
 N EXCTYP,RG1,RG2,RGEX
"RTN","RGEX01",102,0)
 S EXCTYP="",(RG1,RG2,RGEX)=0
"RTN","RGEX01",103,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ASTAT","0",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEX01",104,0)
 .I ((EXCTYP=234)!((EXCTYP>214)&(EXCTYP<219))) S RG1=1
"RTN","RGEX01",105,0)
 .I (EXCTYP=234) S RG2=1 ;Primary View Reject
"RTN","RGEX01",106,0)
 I (RG1=1),(RG2=1) S RGEX=3 ;Send both messages
"RTN","RGEX01",107,0)
 I (RG1=1),(RG2=0) S RGEX=1 ;Only unresolved exceptions exist
"RTN","RGEX01",108,0)
 I (RG1=0),(RG2=1) S RGEX=2 ;Only Primary View Reject exceptions exist
"RTN","RGEX01",109,0)
 Q RGEX
"RTN","RGEX01",110,0)
 ;
"RTN","RGEX01",111,0)
PROC ; For a given patient, set exceptions STATUS to PROCESSED.
"RTN","RGEX01",112,0)
 ; DFN must be defined
"RTN","RGEX01",113,0)
 Q:'$D(DFN)
"RTN","RGEX01",114,0)
 S EXCTYP=""
"RTN","RGEX01",115,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX01",116,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEX01",117,0)
 . S RGDFN="",ICN=""
"RTN","RGEX01",118,0)
 . F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEX01",119,0)
 .. I DFN=RGDFN D
"RTN","RGEX01",120,0)
 ... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX01",121,0)
 ... ;Only set to PROCESSED if patient has national ICN.
"RTN","RGEX01",122,0)
 ... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX01",123,0)
 .... ;Exclude Death exceptions (215-217); they must be processed manually.
"RTN","RGEX01",124,0)
 .... ;Exclude 218 Potential Matches Returned exception **43
"RTN","RGEX01",125,0)
 .... I (EXCTYP>218)!(EXCTYP<215) D
"RTN","RGEX01",126,0)
 ..... S IEN=0
"RTN","RGEX01",127,0)
 ..... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEX01",128,0)
 ...... S IEN2=0
"RTN","RGEX01",129,0)
 ...... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX01",130,0)
 ....... L +^RGHL7(991.1,IEN):10
"RTN","RGEX01",131,0)
 ....... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX01",132,0)
 ....... D ^DIE K DIE,DA,DR
"RTN","RGEX01",133,0)
 ....... L -^RGHL7(991.1,IEN)
"RTN","RGEX01",134,0)
 K IEN,IEN2,RGDFN,EXCTYP,ICN
"RTN","RGEX01",135,0)
 Q
"RTN","RGEX01",136,0)
PDAT ;
"RTN","RGEX01",137,0)
 K DIRUT
"RTN","RGEX01",138,0)
 W !,"This report prints MPI/PD Data for a selected patient.  The"
"RTN","RGEX01",139,0)
 W !,"information displayed includes the Integration Control Number"
"RTN","RGEX01",140,0)
 W !,"(ICN), patient identity information, and Treating Facility list."
"RTN","RGEX01",141,0)
 W !!,"The information is pulled from the Patient (#2) file and the"
"RTN","RGEX01",142,0)
 W !,"Treating Facility List (#391.91) file."
"RTN","RGEX01",143,0)
 ;
"RTN","RGEX01",144,0)
ASK ;Ask for PATIENT
"RTN","RGEX01",145,0)
 I $D(DIRUT) G QUIT
"RTN","RGEX01",146,0)
 W !!,"Patient lookup can be done by Patient Name/SSN or by ICN.",!
"RTN","RGEX01",147,0)
 N DFN,ICN
"RTN","RGEX01",148,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","RGEX01",149,0)
 D MIX^DIC1 K DIC
"RTN","RGEX01",150,0)
 G:Y<0 QUIT
"RTN","RGEX01",151,0)
 S DFN=+Y
"RTN","RGEX01",152,0)
 D MAIN^VAFCPDAT
"RTN","RGEX01",153,0)
 G ASK
"RTN","RGEX01",154,0)
 Q
"RTN","RGEX01",155,0)
QUIT ;
"RTN","RGEX01",156,0)
 K DFN,ICN,D,Y,HOME
"RTN","RGEX03")
0^3^B69509022^B64947419
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23,27,30,38,39,43,44,48**;30 Apr 99;Build 3
"RTN","RGEX03",3,0)
 ;
"RTN","RGEX03",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX03",5,0)
 ;Reference to ^DIA(2 supported by IA #2097
"RTN","RGEX03",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGEX03",7,0)
 ;Reference to HINQ^DG10 supported by IA #2076
"RTN","RGEX03",8,0)
 ;Reference to CIRNEXC^MPIFQ0 supported by IA #2942
"RTN","RGEX03",9,0)
 ;Reference to VTQ^MPIFSAQ supported by IA #2941
"RTN","RGEX03",10,0)
 ;Reference to NOTICE^DGSEC4 and PTSEC^DGSEC4 supported by IA#3027
"RTN","RGEX03",11,0)
 ;Reference to POT^MPIFDUP supported by IA #4464
"RTN","RGEX03",12,0)
 ;
"RTN","RGEX03",13,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",14,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",15,0)
 Q
"RTN","RGEX03",16,0)
HDR ; -- header code
"RTN","RGEX03",17,0)
 S VALMHDR(1)="MPI/PD EXCEPTION HANDLING ACTIONS.",VALMHDR(2)=""
"RTN","RGEX03",18,0)
 Q
"RTN","RGEX03",19,0)
INIT ; -- init variables and list array
"RTN","RGEX03",20,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",21,0)
 K @VALMAR
"RTN","RGEX03",22,0)
 I DATA="" Q
"RTN","RGEX03",23,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN="",DFN="",CHKSM="" ;**44
"RTN","RGEX03",24,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",25,0)
 S DFN=$P(DATA,"^",5),CHKSM=$P($G(^DPT(DFN,"MPI")),"^",2) ;**44
"RTN","RGEX03",26,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6),STR=$$SETSTR^VALM1(NAME,STR,14,30) D ADDTMP
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6),STR=$$SETSTR^VALM1(SSN,STR,14,12) D ADDTMP
"RTN","RGEX03",28,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6),STR=$$SETSTR^VALM1(DOB,STR,14,20) D ADDTMP
"RTN","RGEX03",29,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6),STR=$$SETSTR^VALM1(DFN,STR,14,12) D ADDTMP ;**44
"RTN","RGEX03",30,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6),ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",31,0)
 S STR=$$SETSTR^VALM1(ICN_($S(CHKSM="":"",1:"V"_CHKSM)),STR,14,20) D ADDTMP ;**44
"RTN","RGEX03",32,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20) D ADDTMP
"RTN","RGEX03",33,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50) D ADDTMP
"RTN","RGEX03",34,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30) D ADDTMP
"RTN","RGEX03",35,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",36,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",37,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",38,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20),STR=$$SETSTR^VALM1(STATUS,STR,26,15) D ADDTMP
"RTN","RGEX03",39,0)
 ;Added Exception Text to Exception Handler, patch 39
"RTN","RGEX03",40,0)
 N IEN,IEN2,X K ^UTILITY($J,"W") S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",41,0)
 I IEN'=""!(IEN2'="") D
"RTN","RGEX03",42,0)
 .S EXCTEXT=$P($G(^RGHL7(991.1,IEN,1,IEN2,10)),"^",1) Q:EXCTEXT=""
"RTN","RGEX03",43,0)
 .S STR=$$SETSTR^VALM1("Exception Text:",STR,6,20)
"RTN","RGEX03",44,0)
 .S X=EXCTEXT,DIWL=1,DIWR=50,DIWF="|" D ^DIWP
"RTN","RGEX03",45,0)
 .F N=1:1:$P($G(^UTILITY($J,"W",1)),1) D  Q:'N
"RTN","RGEX03",46,0)
 ..S STR=$$SETSTR^VALM1(^UTILITY($J,"W",1,(N),0),STR,26,76)
"RTN","RGEX03",47,0)
 ..D ADDTMP
"RTN","RGEX03",48,0)
ADDNOTE ;Display Exception Notes, Word Processing field
"RTN","RGEX03",49,0)
 S STR=$$SETSTR^VALM1("Exception Notes:",STR,6,20) D ADDTMP
"RTN","RGEX03",50,0)
 N IEN,IEN2,IENS,N,NOTE
"RTN","RGEX03",51,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11),IENS=IEN2_","_IEN_",",N=$$GET1^DIQ(991.12,IENS,11,"","NT")
"RTN","RGEX03",52,0)
 S L=0 F  S L=$O(NT(L)) Q:'L  S NOTE=NT(L),STR=$$SETSTR^VALM1(NOTE,STR,6,74) D ADDTMP
"RTN","RGEX03",53,0)
 S VALMCNT=LIN-1,DFN=$P(DATA,"^",5),VAFCDFN=DFN
"RTN","RGEX03",54,0)
 K L,NT
"RTN","RGEX03",55,0)
 Q
"RTN","RGEX03",56,0)
ADDTMP ;
"RTN","RGEX03",57,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR,^TMP("RGEXC2",$J,"IDX",LIN,LIN)="",LIN=LIN+1,STR=""
"RTN","RGEX03",58,0)
 Q
"RTN","RGEX03",59,0)
UPD ;
"RTN","RGEX03",60,0)
 N PROCDT,%,X,%I,%H
"RTN","RGEX03",61,0)
 W !,"This option updates the exception status to PROCESSED.",!,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",62,0)
 S DIR("A")="Are you sure you want to change the status? ",DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",63,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",64,0)
 .;**48 populating the date/time marked as processed and who marked it as processed
"RTN","RGEX03",65,0)
 .D NOW^%DTC S PROCDT=%
"RTN","RGEX03",66,0)
 .S IEN="",IEN2="",IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11) L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",67,0)
 .S DA(1)=IEN,DA=IEN2,DR="6///"_1_";7///"_PROCDT_";8///"_$G(DUZ),DIE="^RGHL7(991.1,"_DA(1)_",1," D ^DIE K DIE,DA,DR
"RTN","RGEX03",68,0)
 .L -^RGHL7(991.1,IEN) S $P(DATA,"^",9)=1
"RTN","RGEX03",69,0)
 .D INIT
"RTN","RGEX03",70,0)
 K DIR,DIRUT S VALMBCK="R"
"RTN","RGEX03",71,0)
 Q
"RTN","RGEX03",72,0)
PA ;Patient Audit
"RTN","RGEX03",73,0)
 S PDFN=DFN
"RTN","RGEX03",74,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",75,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",76,0)
 S DFN=PDFN K QFLG,PDFN
"RTN","RGEX03",77,0)
PAQ Q
"RTN","RGEX03",78,0)
HI ;Hinq Inquiry
"RTN","RGEX03",79,0)
 S VALMBCK="" D HINQ^DG10 D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",80,0)
 Q
"RTN","RGEX03",81,0)
DISP ; Display Only Query
"RTN","RGEX03",82,0)
 S VALMBCK="" D FULL^VALM1
"RTN","RGEX03",83,0)
 S MPIVAR("DFN")=DFN,MPIVAR("SSN")=SSN,MPIVAR("NM")=NAME,MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",84,0)
 D VTQ^MPIFSAQ(.MPIVAR) D PAUSE^VALM1
"RTN","RGEX03",85,0)
 S VALMBCK="R" K MPIVAR
"RTN","RGEX03",86,0)
 Q
"RTN","RGEX03",87,0)
 ;
"RTN","RGEX03",88,0)
POT ;Potential Match on MPI, Query MPI, resolve duplicate if needed. **43 Added this entry point
"RTN","RGEX03",89,0)
 D POT^MPIFDUP
"RTN","RGEX03",90,0)
 D INIT S VALMBCK="R" K PROCESS
"RTN","RGEX03",91,0)
 Q
"RTN","RGEX03",92,0)
 ;
"RTN","RGEX03",93,0)
REJ ;Primary View Reject. **44 Added entry point
"RTN","RGEX03",94,0)
 D REJ^RGPVREJ
"RTN","RGEX03",95,0)
 D INIT S VALMBCK="R"
"RTN","RGEX03",96,0)
 Q
"RTN","RGEX03",97,0)
 ;
"RTN","RGEX03",98,0)
MPIPV ;MPI Primary View PDAT. **48 Added entry point
"RTN","RGEX03",99,0)
 S SAPV=0 ;from EH, not stand alone option
"RTN","RGEX03",100,0)
 D SEND^RGPVMPI
"RTN","RGEX03",101,0)
 D INIT S VALMBCK="R"
"RTN","RGEX03",102,0)
 Q
"RTN","RGEX03",103,0)
 ;
"RTN","RGEX03",104,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified - check for DG ELIGIBILITY key for user
"RTN","RGEX03",105,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",106,0)
 D FULL^VALM1 D ELIG^VADPT
"RTN","RGEX03",107,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",108,0)
 .I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",109,0)
 ..W !!,"Eligibility has been verified for this patient.",!!,"You do not have access to edit the Name, Date of ",!,"Birth or Social Security Number for this patient."
"RTN","RGEX03",110,0)
 ..D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",111,0)
 .E  D SENS
"RTN","RGEX03",112,0)
 E  D SENS
"RTN","RGEX03",113,0)
 Q
"RTN","RGEX03",114,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",115,0)
 N RESULT,RGSEN
"RTN","RGEX03",116,0)
 D PTSEC^DGSEC4(.RESULT,DFN,0,"RG EXCEPTION HANDLING^MPI/PD Exception Handling")
"RTN","RGEX03",117,0)
 I RESULT(1)=-1 W !!,"Access denied: Required parameters not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",118,0)
 I RESULT(1)>0 W !!?15,"***PATIENT MARKED SENSITIVE***"
"RTN","RGEX03",119,0)
 I RESULT(1)=3 W !!?15,"Access not allowed on your own PATIENT (#2) file entry" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",120,0)
 I RESULT(1)=4 W !!?15,"Access denied: Your SSN is not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",121,0)
 I RESULT(1)<3 D
"RTN","RGEX03",122,0)
 .I RESULT(1)=1 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",2)
"RTN","RGEX03",123,0)
 .I RESULT(1)=2 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",3)
"RTN","RGEX03",124,0)
 D EDIT
"RTN","RGEX03",125,0)
 Q
"RTN","RGEX03",126,0)
EDIT ; edit patient data
"RTN","RGEX03",127,0)
 S ACCESS=0
"RTN","RGEX03",128,0)
 D REC
"RTN","RGEX03",129,0)
 Q:ACCESS=0
"RTN","RGEX03",130,0)
 S DIE="^DPT(",DA=DFN,DR=".01///^S X=$$NCEDIT^DPTNAME(DA);.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",131,0)
 L +^DPT(DFN):10 D ^DIE K DIE,DA,DR L -^DPT(DFN)
"RTN","RGEX03",132,0)
 S DATAOLD=DATA
"RTN","RGEX03",133,0)
 D DEATH
"RTN","RGEX03",134,0)
 D DEM^VADPT
"RTN","RGEX03",135,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",136,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",137,0)
 D INIT
"RTN","RGEX03",138,0)
 S VALMBCK="R"
"RTN","RGEX03",139,0)
 K DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",140,0)
QUIT Q
"RTN","RGEX03",141,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",142,0)
 ; check for security key
"RTN","RGEX03",143,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",144,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",145,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",146,0)
 .W !!,"Your SSN is missing from the NEW PERSON file.",!,"Contact your ADP Coordinator."
"RTN","RGEX03",147,0)
 .D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",148,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",149,0)
 .W !!,"Security regulations prohibit computer access to your",!,"own medical record."
"RTN","RGEX03",150,0)
 .D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",151,0)
 E  S ACCESS=1
"RTN","RGEX03",152,0)
 Q
"RTN","RGEX03",153,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",154,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",155,0)
 .K VADM,DIE,DA,DR
"RTN","RGEX03",156,0)
 .S DOD=""
"RTN","RGEX03",157,0)
 .D DEM^VADPT
"RTN","RGEX03",158,0)
 .S DOD=$P($G(VADM(6)),"^",2)
"RTN","RGEX03",159,0)
 .S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD"
"RTN","RGEX03",160,0)
 .L +^DPT(DFN):10
"RTN","RGEX03",161,0)
 .D ^DIE
"RTN","RGEX03",162,0)
 .L -^DPT(DFN)
"RTN","RGEX03",163,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",164,0)
 K VADM,DIE,DA,DR,DOD
"RTN","RGEX03",165,0)
 Q
"RTN","RGEX03",166,0)
INQ ; Patient Inquiry
"RTN","RGEX03",167,0)
 S VALMBCK=""
"RTN","RGEX03",168,0)
 D FULL^VALM1 D EN^DGRPD D PAUSE^VALM1 D CLEAN^VALM10 D INIT
"RTN","RGEX03",169,0)
 S VALMBCK="R"
"RTN","RGEX03",170,0)
 Q
"RTN","RGEX03",171,0)
EDTNOT ; Edit Exception Notes
"RTN","RGEX03",172,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",173,0)
 L +^RGHL7(991.1,IEN):10 S DIE="^RGHL7(991.1,"_IEN_",1,",DA(1)=IEN,DA=IEN2,DR="11" D ^DIE L -^RGHL7(991.1,IEN)
"RTN","RGEX03",174,0)
 K DIE,DA,DR,IEN,IEN2
"RTN","RGEX03",175,0)
 D INIT
"RTN","RGEX03",176,0)
 S VALMBCK="R"
"RTN","RGEX03",177,0)
 Q
"RTN","RGEX03",178,0)
PDAT S VALMBCK="",PICN="",PSSN=""
"RTN","RGEX03",179,0)
 I $D(SSN) S PSSN=SSN
"RTN","RGEX03",180,0)
 S ARRAY="^TMP(""RGXHFS"","_$J_")",TYPE="I",REP=1,RGXDIR=$$GET^XPAR("SYS","RGX HFS SCRATCH"),RGXFILE="RGX"_DUZ_".DAT"
"RTN","RGEX03",181,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","RGEX03",182,0)
 D OPEN^%ZISH("RGX",RGXDIR,RGXFILE,"W") Q:POP
"RTN","RGEX03",183,0)
 U IO
"RTN","RGEX03",184,0)
 I ICN'="" S PICN=ICN D START^VAFCPDAT
"RTN","RGEX03",185,0)
 N RGXDEL
"RTN","RGEX03",186,0)
 D CLOSE^%ZISH("RGX")
"RTN","RGEX03",187,0)
 K ^TMP("RGPDAT",$J)
"RTN","RGEX03",188,0)
 S RGXDEL(RGXFILE)="",X=$$FTG^%ZISH(RGXDIR,RGXFILE,$NAME(^TMP("RGPDAT",$J,1)),3),X=$$DEL^%ZISH(RGXDIR,$NA(RGXDEL))
"RTN","RGEX03",189,0)
 I $D(^TMP("RGPDAT",$J)) D EN^RGEX04
"RTN","RGEX03",190,0)
 S ICN=PICN,SSN=PSSN
"RTN","RGEX03",191,0)
 D INIT
"RTN","RGEX03",192,0)
 S VALMBCK="R" K PICN,PSSN,ARRAY,REP,RGXDIR,RGXFILE,TYPE
"RTN","RGEX03",193,0)
 Q
"RTN","RGEX03",194,0)
GETEX(RETURN,DFN) ; Get array of pending exceptions for a patient
"RTN","RGEX03",195,0)
 K RETURN
"RTN","RGEX03",196,0)
 S CNT=0,RETURN(0)="0^No Pending Exceptions",TYP=""
"RTN","RGEX03",197,0)
 I 'DFN S RETURN(0)="-1^DFN not passed" G QGET
"RTN","RGEX03",198,0)
 F  S TYP=$O(^RGHL7(991.1,"ADFN",TYP)) Q:'TYP  D
"RTN","RGEX03",199,0)
 .I $D(^RGHL7(991.1,"ADFN",TYP,DFN)) D
"RTN","RGEX03",200,0)
 ..S IEN="" F  S IEN=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEX03",201,0)
 ...S IEN2="",ETYP="" F  S IEN2=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX03",202,0)
 ....I $P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)<1 D
"RTN","RGEX03",203,0)
 .....S CNT=CNT+1,ETYP=$P(^RGHL7(991.11,TYP,10),"^",1)
"RTN","RGEX03",204,0)
 .....S RETURN(CNT)=ETYP_"^"_IEN_"^"_IEN2
"RTN","RGEX03",205,0)
 I CNT>0 S RETURN(0)=CNT_"^Pending Exception(s)"
"RTN","RGEX03",206,0)
QGET ;
"RTN","RGEX03",207,0)
 K TYP,ETYP,IEN,IEN2,CNT
"RTN","RGEX03",208,0)
 Q
"RTN","RGEX03",209,0)
HELP ; -- help code
"RTN","RGEX03",210,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",211,0)
 Q
"RTN","RGEX03",212,0)
EXIT ; -- exit code
"RTN","RGEX03",213,0)
 S VALMBCK="" K ^TMP("RGEXC2",$J),CHKSM,DFN,DIR,EXCTEXT,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",214,0)
 S VALMBCK="R",RGBG=1
"RTN","RGEX03",215,0)
 Q
"RTN","RGEX03",216,0)
EXPND ; -- expand code
"RTN","RGEX03",217,0)
 Q
"RTN","RGEX06")
0^6^B8462958^n/a
"RTN","RGEX06",1,0)
RGEX06 ;BIR/PTD-LIST MANAGER ROUTINE FOR REMOTE MPI PRIMARY VIEW PDAT ;5/17/07
"RTN","RGEX06",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**48**;30 Apr 99;Build 3
"RTN","RGEX06",3,0)
 ;
"RTN","RGEX06",4,0)
 ;Reference to ^XWB2HL7 supported by IA #3144
"RTN","RGEX06",5,0)
 ;Reference to ^XWBDRPC supported by IA #3149
"RTN","RGEX06",6,0)
 ;
"RTN","RGEX06",7,0)
EN(ICN) ;Entry point calling List Template for primary view PDAT display
"RTN","RGEX06",8,0)
 D EN^VALM("RG EXCPT PV MPI PDAT")
"RTN","RGEX06",9,0)
 Q
"RTN","RGEX06",10,0)
 ;
"RTN","RGEX06",11,0)
HDR ; -- header code
"RTN","RGEX06",12,0)
 S VALMHDR(1)="MPI PRIMARY VIEW PATIENT DATA DISPLAY"
"RTN","RGEX06",13,0)
 Q
"RTN","RGEX06",14,0)
 ;
"RTN","RGEX06",15,0)
INIT ;Display the MPI Primary View Patient Data (PDAT)
"RTN","RGEX06",16,0)
 K ^TMP("RGEXC6",$J)
"RTN","RGEX06",17,0)
 K @VALMAR
"RTN","RGEX06",18,0)
 I '$D(ICN) G EXIT
"RTN","RGEX06",19,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","RGEX06",20,0)
 I '$D(^XTMP("RGPVMPI",ICN)) S TXT=" - No MPI Primary View data exists for this patient." D ADDTMP
"RTN","RGEX06",21,0)
 N STATUS,R,RETURN,RESULT,RET
"RTN","RGEX06",22,0)
 I $D(^XTMP("RGPVMPI",ICN)) S RETURN(0)=$P(^XTMP("RGPVMPI",ICN),"^") D
"RTN","RGEX06",23,0)
 .D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","RGEX06",24,0)
 ..;Retrieve the data
"RTN","RGEX06",25,0)
 ..D RTNDATA^XWBDRPC(.RET,RETURN(0)) D
"RTN","RGEX06",26,0)
 ...I $G(RET(0))<0 S TXT="No Data Returned Due To: "_$P(RET(0),"^",2,99) S STR=$$SETSTR^VALM1(TXT,STR,1,80) D ADDTMP Q
"RTN","RGEX06",27,0)
 ...I $G(RET)'="",$D(@RET) S GLO=RET F  S GLO=$Q(@GLO) Q:$QS(GLO,1)'=$J  S TXT=@GLO S STR=$$SETSTR^VALM1(TXT,STR,1,80) D ADDTMP
"RTN","RGEX06",28,0)
 ...S R="" F  S R=$O(RET(R)) Q:R=""  S TXT=RET(R) S STR=$$SETSTR^VALM1(TXT,STR,1,80) D ADDTMP
"RTN","RGEX06",29,0)
 K GLO,L,R,SL
"RTN","RGEX06",30,0)
 S VALMCNT=LIN-1
"RTN","RGEX06",31,0)
 Q
"RTN","RGEX06",32,0)
 ;
"RTN","RGEX06",33,0)
ADDTMP ;Set string into the array.
"RTN","RGEX06",34,0)
 S ^TMP("RGEXC6",$J,LIN,0)=STR
"RTN","RGEX06",35,0)
 S ^TMP("RGEXC6",$J,"IDX",LIN,LIN)=""
"RTN","RGEX06",36,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX06",37,0)
 Q
"RTN","RGEX06",38,0)
 ;
"RTN","RGEX06",39,0)
HELP ; -- help code
"RTN","RGEX06",40,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX06",41,0)
 Q
"RTN","RGEX06",42,0)
 ;
"RTN","RGEX06",43,0)
EXIT ; -- exit code
"RTN","RGEX06",44,0)
 S VALMBCK=""
"RTN","RGEX06",45,0)
 K ^TMP("RGEXC6",$J),GLO,L,LIN,R,RESULT,RET,RETURN,SL,STATUS,STR,TXT,X
"RTN","RGEX06",46,0)
 S VALMBCK="R"
"RTN","RGEX06",47,0)
 Q
"RTN","RGEX06",48,0)
 ;
"RTN","RGEX06",49,0)
EXPND ; -- expand code
"RTN","RGEX06",50,0)
 Q
"RTN","RGEX06",51,0)
 ;
"RTN","RGEX06",52,0)
SAPV(ICN) ;Print stand alone Primary View display
"RTN","RGEX06",53,0)
 I '$D(^XTMP("RGPVMPI",ICN)) W !," - No MPI Primary View data exists for this patient." Q
"RTN","RGEX06",54,0)
 N STATUS,R,RETURN,RESULT,RET
"RTN","RGEX06",55,0)
 I $D(^XTMP("RGPVMPI",ICN)) S RETURN(0)=$P(^XTMP("RGPVMPI",ICN),"^") D
"RTN","RGEX06",56,0)
 .D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","RGEX06",57,0)
 ..;Retrieve the data
"RTN","RGEX06",58,0)
 ..D RTNDATA^XWBDRPC(.RET,RETURN(0)) D
"RTN","RGEX06",59,0)
 ...I $D(RET(0)) I RET(0)<0 W !!,"No data returned due to: "_$P(RET(0),"^",2) Q
"RTN","RGEX06",60,0)
 ...I $G(RET)'="",$D(@RET) S GLO=RET F  S GLO=$Q(@GLO) Q:$QS(GLO,1)'=$J  S TXT=@GLO W !,TXT I $Y>22 S DIR(0)="E" D ^DIR K DIR W @IOF S $Y=1
"RTN","RGEX06",61,0)
 ...S R="" F  S R=$O(RET(R)) Q:R=""  W !,RET(R) I $Y>22 S DIR(0)="E" D ^DIR K DIR Q:'Y  W @IOF S $Y=1
"RTN","RGEX06",62,0)
 Q
"RTN","RGEX06",63,0)
 ;
"RTN","RGPVMPI")
0^8^B17890972^n/a
"RTN","RGPVMPI",1,0)
RGPVMPI ;BIR/PTD-REMOTE PRIMARY VIEW DISPLAY FROM MPI ;5/17/07
"RTN","RGPVMPI",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**48**;30 Apr 99;Build 3
"RTN","RGPVMPI",3,0)
 ;
"RTN","RGPVMPI",4,0)
 ;Reference to EN1^XWB2HL7 supported by IA #3144
"RTN","RGPVMPI",5,0)
 ;Reference to RPCCHK^XWB2HL7 supported by IA #3144
"RTN","RGPVMPI",6,0)
 ;
"RTN","RGPVMPI",7,0)
INTRO ;Display purpose of option
"RTN","RGPVMPI",8,0)
 W @IOF S SAPV=1 ;from stand alone option, not EH
"RTN","RGPVMPI",9,0)
 W !,"This option sends a remote request for data to the Master Patient"
"RTN","RGPVMPI",10,0)
 W !,"Index, using a Remote Procedure Call (RPC).  When the RPC returns"
"RTN","RGPVMPI",11,0)
 W !,"the information, you can review Primary View data as it currently"
"RTN","RGPVMPI",12,0)
 W !,"exists on the MPI Patient Data Inquiry (PDAT) report."
"RTN","RGPVMPI",13,0)
 ;
"RTN","RGPVMPI",14,0)
 W !!,"Choose the patient for whom Primary View data is to be requested."
"RTN","RGPVMPI",15,0)
 W !,"The selected patient must have an Integration Control Number (ICN)."
"RTN","RGPVMPI",16,0)
 W !,"You can select by Patient Name, Social Security Number, or ICN.",!
"RTN","RGPVMPI",17,0)
 ;
"RTN","RGPVMPI",18,0)
ASK ;Ask For Patient
"RTN","RGPVMPI",19,0)
 S DFN="",RGICN="" K DTOUT,DUOUT
"RTN","RGPVMPI",20,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","RGPVMPI",21,0)
 D MIX^DIC1 K DIC,D
"RTN","RGPVMPI",22,0)
 I Y<0 G EXIT
"RTN","RGPVMPI",23,0)
 S DFN=+Y
"RTN","RGPVMPI",24,0)
 S RGICN=+$$GETICN^MPIF001(DFN) I RGICN<1 W !,"There is no Integration Control Number for this patient." G ASK
"RTN","RGPVMPI",25,0)
 ;
"RTN","RGPVMPI",26,0)
SEND ;Send a remote query to the MPI for Primary View PDAT
"RTN","RGPVMPI",27,0)
 ;Entry point from Exception Handler; DATA should be defined.
"RTN","RGPVMPI",28,0)
 S (QFLG,QUIT)=0 N RETURN,RESULT,SNTDT
"RTN","RGPVMPI",29,0)
 I SAPV=0 D  I QUIT=1 G EXIT
"RTN","RGPVMPI",30,0)
 .I DATA="" W !,"No Exception Data available." S QUIT=1 Q
"RTN","RGPVMPI",31,0)
 .S RGICN=$P(DATA,"^",6) I RGICN="" W !,"No ICN defined." S QUIT=1 Q
"RTN","RGPVMPI",32,0)
 .S VALMBCK=""
"RTN","RGPVMPI",33,0)
 .D FULL^VALM1
"RTN","RGPVMPI",34,0)
NOQ ;No previous query exists for this ICN
"RTN","RGPVMPI",35,0)
 I '$D(^XTMP("RGPVMPI",RGICN)) D RPC G DISP
"RTN","RGPVMPI",36,0)
 ;
"RTN","RGPVMPI",37,0)
OLDQ ;Query previously sent for this ICN
"RTN","RGPVMPI",38,0)
 I $D(^XTMP("RGPVMPI",RGICN)) D
"RTN","RGPVMPI",39,0)
 .S SNTDT=$$FMTE^XLFDT($P(^XTMP("RGPVMPI",RGICN),"^",2))
"RTN","RGPVMPI",40,0)
 .W !,"A query was last sent for this ICN on "_SNTDT
"RTN","RGPVMPI",41,0)
 .;Has data returned for query?
"RTN","RGPVMPI",42,0)
 .S RETURN(0)=$P(^XTMP("RGPVMPI",RGICN),"^")
"RTN","RGPVMPI",43,0)
 .D RPCCHK^XWB2HL7(.RESULT,RETURN(0))
"RTN","RGPVMPI",44,0)
 .;Data has NOT returned
"RTN","RGPVMPI",45,0)
 .I +RESULT(0)'=1 S QUIT=1 W !,"Query data has NOT returned from the MPI; please check back later." Q
"RTN","RGPVMPI",46,0)
 .I +RESULT(0)=1 D  ;Data has returned
"RTN","RGPVMPI",47,0)
 ..S DIR("A")="Do you wish to view the existing query data now? ",DIR(0)="YA"
"RTN","RGPVMPI",48,0)
 ..S DIR("?")="Enter YES to review the existing data; enter NO to send a new query"
"RTN","RGPVMPI",49,0)
 ..S DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S QUIT=1 Q  ;up-arrowed out
"RTN","RGPVMPI",50,0)
 ..I Y>0 K DIR Q  ;yes, use existing query
"RTN","RGPVMPI",51,0)
 ..I Y=0 D  Q  ;no, don't use existing, send new query
"RTN","RGPVMPI",52,0)
 ...K ^XTMP("RGPVMPI",RGICN)
"RTN","RGPVMPI",53,0)
 ...D RPC
"RTN","RGPVMPI",54,0)
 ...K DIR
"RTN","RGPVMPI",55,0)
 ;
"RTN","RGPVMPI",56,0)
DISP ;Display Primary View Data
"RTN","RGPVMPI",57,0)
 I QUIT'=1 D  I QFLG G EXIT
"RTN","RGPVMPI",58,0)
 .I SAPV=1 D  Q:QFLG  ;Stand alone PV display
"RTN","RGPVMPI",59,0)
 ..W !,"(Be sure HISTORY is enabled to capture data!)"
"RTN","RGPVMPI",60,0)
 ..S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGPVMPI",61,0)
 ..W !,@IOF D SAPV^RGEX06(RGICN)
"RTN","RGPVMPI",62,0)
 .I SAPV=0 D EN^RGEX06(RGICN) ;Exception Handler PV display
"RTN","RGPVMPI",63,0)
 ;
"RTN","RGPVMPI",64,0)
EXIT ;Kill variables and quit
"RTN","RGPVMPI",65,0)
 K CNT,D,DFN,DIC,DIR,DIRUT,DTOUT,DUOUT,QFLG,QUIT,RGICN,SAPV,X,Y
"RTN","RGPVMPI",66,0)
 Q
"RTN","RGPVMPI",67,0)
 ;
"RTN","RGPVMPI",68,0)
RPC ;Send the Remote Query
"RTN","RGPVMPI",69,0)
 W !!,"Sending a Remote Query to the Master Patient Index."
"RTN","RGPVMPI",70,0)
 W !,"This will take some time; please be patient."
"RTN","RGPVMPI",71,0)
 D EN1^XWB2HL7(.RETURN,"200M","RG PRIMARY VIEW FROM MPI",1,RGICN) I RETURN(0)'="" D  Q
"RTN","RGPVMPI",72,0)
 .S ^XTMP("RGPVMPI",0)=$$FMADD^XLFDT(DT,2)_"^"_DT_"^"_"PRIMARY VIEW MPI PDAT"
"RTN","RGPVMPI",73,0)
 .S ^XTMP("RGPVMPI",RGICN)=RETURN(0)_"^"_$$NOW^XLFDT
"RTN","RGPVMPI",74,0)
 .;Has data returned for this query?
"RTN","RGPVMPI",75,0)
 .S CNT=0 F  S CNT=CNT+1 D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) Q:RESULT(0)  H 2 I CNT>15 Q  ;result(0)=status of handle
"RTN","RGPVMPI",76,0)
 .I +RESULT(0)=1 W !,"Query data has returned from the MPI and is available for review."
"RTN","RGPVMPI",77,0)
 .I +RESULT(0)'=1 D  ;quit, info not back after 30 seconds
"RTN","RGPVMPI",78,0)
 ..W !,"Query data has NOT returned from the MPI; please check back later."
"RTN","RGPVMPI",79,0)
 ..S QUIT=1
"RTN","RGPVMPI",80,0)
 ..I SAPV=0 D PAUSE^VALM1
"RTN","RGPVMPI",81,0)
 W !!,"Problem with Query: ",RETURN(0)_"^"_$G(RETURN(1))
"RTN","RGPVMPI",82,0)
 S QUIT=1
"RTN","RGPVMPI",83,0)
 I SAPV=0 D PAUSE^VALM1
"RTN","RGPVMPI",84,0)
 Q
"RTN","RGPVMPI",85,0)
 ;
"RTN","RGRPC")
0^1^B13556106^n/a
"RTN","RGRPC",1,0)
RGRPC ;BIRMIO/CMC-RG RPC API ;3 MAY 07
"RTN","RGRPC",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**48**;30 Apr 99;Build 3
"RTN","RGRPC",3,0)
 ;
"RTN","RGRPC",4,0)
 ;
"RTN","RGRPC",5,0)
EN(RETURN,ICN,SSN,DFN,BRANGE,ERANGE) ;
"RTN","RGRPC",6,0)
 ;RETURN IS THE ARRAY TO HOLD THE RESULTS
"RTN","RGRPC",7,0)
 ;ICN is the Integration Control Number of the patient to find exceptions for (optional)
"RTN","RGRPC",8,0)
 ;SSN is the social of the patient to find exceptions for (optional)
"RTN","RGRPC",9,0)
 ;DFN is the internal entry number of the patient in the PATIENT (#2) file to find exceptions for (optional)
"RTN","RGRPC",10,0)
 ;Either ICN, SSN or DFN must be present
"RTN","RGRPC",11,0)
 ;BRANGE is the BEGINNING date range specified to find exceptions for the patient
"RTN","RGRPC",12,0)
 ;ERANGE is the ENDING date range specified to find exceptions for the patient
"RTN","RGRPC",13,0)
 ;
"RTN","RGRPC",14,0)
 ;S ^XTMP("CMC")=ICN_"^"_SSN_"^"_DFN_"^"_BRANGE_"^"_ERANGE FOR DEBUGGING
"RTN","RGRPC",15,0)
 I $G(ICN)=""&$G(SSN)=""&$G(DFN)="" S RETURN="-1^Patient not specified" Q
"RTN","RGRPC",16,0)
 I $G(BRANGE)="" S BRANGE=DT
"RTN","RGRPC",17,0)
 I $G(ERANGE)="" S ERANGE=DT
"RTN","RGRPC",18,0)
 I BRANGE>ERANGE S RETURN="-1^Beginning date is newer than End date" Q
"RTN","RGRPC",19,0)
 ;
"RTN","RGRPC",20,0)
 I $G(DFN)="" D
"RTN","RGRPC",21,0)
 .;need to get DFN
"RTN","RGRPC",22,0)
 .I $G(SSN)'="" S ICN=$$GETICNS^MPIF002(SSN)
"RTN","RGRPC",23,0)
 .I $G(ICN)'="" S DFN=$$GETDFN^MPIF001(ICN)
"RTN","RGRPC",24,0)
 I $G(DFN)=""!(+$G(DFN)=-1) S RETURN="-1^Can't find Patient" Q
"RTN","RGRPC",25,0)
 ;
"RTN","RGRPC",26,0)
 ; check if this data can be returned and if sensative pt bulletin needed
"RTN","RGRPC",27,0)
 N SENS D PTSEC^DGSEC4(.SENS,DFN,1,"Remote Procedure from MPI^RPC from MPI for RG Exception Information")
"RTN","RGRPC",28,0)
 N NOT D NOTICE^DGSEC4(.NOT,DFN,"Remote Procedure from MPI^RPC from MPI for RG Exception Information")
"RTN","RGRPC",29,0)
 I SENS(1)=3!(SENS(1)=4)!(SENS(1)=-1) S RETURN="-1^SENSATIVE PT ISSUE "_SENS(2)_" DFN= "_DFN_" ICN= "_ICN Q
"RTN","RGRPC",30,0)
 ;
"RTN","RGRPC",31,0)
 ;are there any exceptions for this patient?
"RTN","RGRPC",32,0)
 N TYP,CNT,IEN,IEN2,ETYP,WHO,X,Y,DIC,WTYP,WSTAT,MCNT S TYP="",CNT=1,MCNT=0
"RTN","RGRPC",33,0)
 F  S TYP=$O(^RGHL7(991.1,"ADFN",TYP)) Q:TYP=""  D
"RTN","RGRPC",34,0)
 .I $D(^RGHL7(991.1,"ADFN",TYP,DFN)) D
"RTN","RGRPC",35,0)
 ..S IEN=0 F  S IEN=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN)) Q:IEN=""  D
"RTN","RGRPC",36,0)
 ...S IEN2="",ETYP="" F  S IEN2=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGRPC",37,0)
 ....S NODE=$G(^RGHL7(991.1,IEN,1,IEN2,0))
"RTN","RGRPC",38,0)
 ....S NODE10=$G(^RGHL7(991.1,IEN,1,IEN2,10))
"RTN","RGRPC",39,0)
 ....S LOGGED=$P(^RGHL7(991.1,IEN,0),"^",2)
"RTN","RGRPC",40,0)
 ....I $P(LOGGED,".")<BRANGE!($P(LOGGED,".")>ERANGE) Q
"RTN","RGRPC",41,0)
 ....S RETURN(CNT)="Exception Number: "_$P($G(^RGHL7(991.1,IEN,0)),"^"),CNT=CNT+1,MCNT=MCNT+1
"RTN","RGRPC",42,0)
 ....K Y S Y=LOGGED I Y'="" D DD^%DT
"RTN","RGRPC",43,0)
 ....S RETURN(CNT)="Exception logged on: "_Y,CNT=CNT+1
"RTN","RGRPC",44,0)
 ....S WTYP=$G(^RGHL7(991.11,TYP,10))
"RTN","RGRPC",45,0)
 ....S RETURN(CNT)="Exception Type: "_TYP_" - "_WTYP,CNT=CNT+1
"RTN","RGRPC",46,0)
 ....S RETURN(CNT)="Patient DFN: "_$P(NODE,"^",4),CNT=CNT+1
"RTN","RGRPC",47,0)
 ....S WSTAT=$P(NODE,"^",5) S WSTAT=$S(WSTAT=1:"PROCESSED",WSTAT=0:"NOT PROCESSED",1:"")
"RTN","RGRPC",48,0)
 ....S RETURN(CNT)="Exception Status: "_WSTAT,CNT=CNT+1
"RTN","RGRPC",49,0)
 ....I $P(NODE,"^",5)=1 D
"RTN","RGRPC",50,0)
 .....;MARKED AS PROCESSED
"RTN","RGRPC",51,0)
 .....K Y S Y=$P(NODE,"^",6) I Y'="" D DD^%DT
"RTN","RGRPC",52,0)
 .....S RETURN(CNT)="Date Processed: "_Y,CNT=CNT+1
"RTN","RGRPC",53,0)
 .....S WHO=$P(NODE,"^",7) I WHO'="" K X,Y S DIC="^VA(200,",DIC(0)="ZMO",X="`"_WHO D ^DIC I $G(Y)>1 S WHO=$G(Y(0,0))
"RTN","RGRPC",54,0)
 .....S RETURN(CNT)="Processed by: "_WHO,CNT=CNT+1
"RTN","RGRPC",55,0)
 ....S RETURN(CNT)="Exception Text: "_NODE10,CNT=CNT+1
"RTN","RGRPC",56,0)
 ....I $D(^RGHL7(991.1,IEN,1,IEN2,11)) D
"RTN","RGRPC",57,0)
 .....S RETURN(CNT)="Exception Notes:",CNT=CNT+1
"RTN","RGRPC",58,0)
 .....N IEN3 S IEN3=0 F  S IEN3=$O(^RGHL7(991.1,IEN,1,IEN2,11,IEN3)) Q:IEN3=""  S RETURN(CNT)=$G(^RGHL7(991.1,IEN,1,IEN2,11,IEN3,0)),CNT=CNT+1
"RTN","RGRPC",59,0)
 ....S RETURN(CNT)="**************************",CNT=CNT+1
"RTN","RGRPC",60,0)
 I CNT=1 S RETURN(0)="-1^No Exceptions found in date range.",RETURN=0
"RTN","RGRPC",61,0)
 S SITE=$$SITE^VASITE
"RTN","RGRPC",62,0)
 N PT S PT=$S(ICN'="":"ICN= "_ICN,DFN'="":"DFN= "_DFN,SSN'="":"SSN= "_SSN)
"RTN","RGRPC",63,0)
 I CNT>1 S RETURN(0)=MCNT_" exceptions found for "_PT_" at "_$P(SITE,"^",2)_" ("_$P(SITE,"^",3)_")",RETURN=MCNT
"RTN","RGRPC",64,0)
 Q
"UP",991.1,991.12,-1)
991.1^1
"UP",991.1,991.12,0)
991.12
"VER")
8.0^22.0
"^DD",991.1,991.12,7,0)
DATE/TIME PROCESSED^D^^0;6^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",991.1,991.12,7,3)
Enter the date/time the exception is processed.
"^DD",991.1,991.12,7,21,0)
^^1^1^3070502^
"^DD",991.1,991.12,7,21,1,0)
This field will capture the date/time the exception was marked processed.
"^DD",991.1,991.12,7,"DT")
3070502
"^DD",991.1,991.12,8,0)
WHO MARKED PROCESSED^P200'^VA(200,^0;7^Q
"^DD",991.1,991.12,8,3)
Enter the person who marked the exception as processed.
"^DD",991.1,991.12,8,21,0)
^^1^1^3070502^
"^DD",991.1,991.12,8,21,1,0)
This field will capture who has marked the exception as processed.
"^DD",991.1,991.12,8,"DT")
3070502
"BLD",2524,6)
^48
**END**
**END**
