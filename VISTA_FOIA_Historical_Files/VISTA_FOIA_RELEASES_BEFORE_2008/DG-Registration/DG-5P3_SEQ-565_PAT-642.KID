Released DG*5.3*642 SEQ #565
Extracted from mail message
**KIDS**:DG*5.3*642^

**INSTALL NAME**
DG*5.3*642
"BLD",5929,0)
DG*5.3*642^REGISTRATION^0^3050103^y
"BLD",5929,1,0)
^^1^1^3050103^
"BLD",5929,1,1,0)
This patch disables old VIC prompts in Registration.
"BLD",5929,4,0)
^9.64PA^^
"BLD",5929,"KRN",0)
^9.67PA^8989.52^19
"BLD",5929,"KRN",.4,0)
.4
"BLD",5929,"KRN",.401,0)
.401
"BLD",5929,"KRN",.402,0)
.402
"BLD",5929,"KRN",.403,0)
.403
"BLD",5929,"KRN",.5,0)
.5
"BLD",5929,"KRN",.84,0)
.84
"BLD",5929,"KRN",3.6,0)
3.6
"BLD",5929,"KRN",3.8,0)
3.8
"BLD",5929,"KRN",9.2,0)
9.2
"BLD",5929,"KRN",9.8,0)
9.8
"BLD",5929,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",5929,"KRN",9.8,"NM",1,0)
DG10^^0^B18421958
"BLD",5929,"KRN",9.8,"NM",2,0)
DG1010P^^0^B18385183
"BLD",5929,"KRN",9.8,"NM",3,0)
DGREG00^^0^B13329459
"BLD",5929,"KRN",9.8,"NM","B","DG10",1)

"BLD",5929,"KRN",9.8,"NM","B","DG1010P",2)

"BLD",5929,"KRN",9.8,"NM","B","DGREG00",3)

"BLD",5929,"KRN",19,0)
19
"BLD",5929,"KRN",19.1,0)
19.1
"BLD",5929,"KRN",101,0)
101
"BLD",5929,"KRN",409.61,0)
409.61
"BLD",5929,"KRN",771,0)
771
"BLD",5929,"KRN",870,0)
870
"BLD",5929,"KRN",8989.51,0)
8989.51
"BLD",5929,"KRN",8989.52,0)
8989.52
"BLD",5929,"KRN",8994,0)
8994
"BLD",5929,"KRN","B",.4,.4)

"BLD",5929,"KRN","B",.401,.401)

"BLD",5929,"KRN","B",.402,.402)

"BLD",5929,"KRN","B",.403,.403)

"BLD",5929,"KRN","B",.5,.5)

"BLD",5929,"KRN","B",.84,.84)

"BLD",5929,"KRN","B",3.6,3.6)

"BLD",5929,"KRN","B",3.8,3.8)

"BLD",5929,"KRN","B",9.2,9.2)

"BLD",5929,"KRN","B",9.8,9.8)

"BLD",5929,"KRN","B",19,19)

"BLD",5929,"KRN","B",19.1,19.1)

"BLD",5929,"KRN","B",101,101)

"BLD",5929,"KRN","B",409.61,409.61)

"BLD",5929,"KRN","B",771,771)

"BLD",5929,"KRN","B",870,870)

"BLD",5929,"KRN","B",8989.51,8989.51)

"BLD",5929,"KRN","B",8989.52,8989.52)

"BLD",5929,"KRN","B",8994,8994)

"BLD",5929,"QUES",0)
^9.62^^
"BLD",5929,"REQB",0)
^9.611^3^3
"BLD",5929,"REQB",1,0)
DG*5.3*149^1
"BLD",5929,"REQB",2,0)
DG*5.3*161^1
"BLD",5929,"REQB",3,0)
DG*5.3*574^1
"BLD",5929,"REQB","B","DG*5.3*149",1)

"BLD",5929,"REQB","B","DG*5.3*161",2)

"BLD",5929,"REQB","B","DG*5.3*574",3)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
642^3050103
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3050103
"PKG",5,22,1,"PAH",1,1,1,0)
This patch disables old VIC prompts in Registration.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DG10")
0^1^B18421958
"RTN","DG10",1,0)
DG10 ;ALB/MRL,DAK,AEG-LOAD/EDIT PATIENT DATA ; 1/3/05 6:18pm
"RTN","DG10",2,0)
 ;;5.3;Registration;**32,109,139,149,182,326,513,425,574,642**;Aug 13, 1993
"RTN","DG10",3,0)
START ;
"RTN","DG10",4,0)
 D LO^DGUTL
"RTN","DG10",5,0)
 I $G(DGPRFLG)=1,$G(DGPLOC)=1 D  G Q:$G(DGRPOUT),A1
"RTN","DG10",6,0)
 .; D EN^DGRPD,REG^IVMCQ($G(DFN))
"RTN","DG10",7,0)
 . D EN^DGRPD
"RTN","DG10",8,0)
 . Q:$G(DGRPOUT)
"RTN","DG10",9,0)
 . D REG^IVMCQ($G(DFN))
"RTN","DG10",10,0)
 . D HINQ
"RTN","DG10",11,0)
 ;
"RTN","DG10",12,0)
A W !! K VET,DIE,DIC,CARD S DIC=2,DLAYGO=2,DIC(0)="ALEQM" K DIC("S") D ^DIC G Q:Y<0 S (DFN,DA)=+Y,DGNEW=$P(Y,"^",3) K DLAYGO
"RTN","DG10",13,0)
 N Y D PAUSE I DGNEW D NEW^DGRP S DA=DFN,VET=$S($D(^DPT(DFN,"VET")):^("VET")'="Y",1:0)
"RTN","DG10",14,0)
 ;
"RTN","DG10",15,0)
 ;MPI QUERY
"RTN","DG10",16,0)
 ;check to see if CIRN PD/MPI is installed
"RTN","DG10",17,0)
 N X S X="MPIFAPI" X ^%ZOSF("TEST") G:'$T SKIP
"RTN","DG10",18,0)
 K MPIFRTN
"RTN","DG10",19,0)
 D MPIQ^MPIFAPI(DFN)
"RTN","DG10",20,0)
 K MPIFRTN
"RTN","DG10",21,0)
 ;
"RTN","DG10",22,0)
 I +$G(DGNEW) D
"RTN","DG10",23,0)
 . ; query CMOR for Patient Record Flag Assignments if NEW patient and
"RTN","DG10",24,0)
 . ; display results
"RTN","DG10",25,0)
 . I $$PRFQRY^DGPFAPI(DFN) D DISPPRF^DGPFAPI(DFN)
"RTN","DG10",26,0)
 ;
"RTN","DG10",27,0)
SKIP ;
"RTN","DG10",28,0)
 S DGELVER=0 D EN^DGRPD I $D(DGRPOUT) K DGRPOUT G A
"RTN","DG10",29,0)
 D HINQ,REG^IVMCQ($G(DFN)) G A1
"RTN","DG10",30,0)
 ;
"RTN","DG10",31,0)
HINQ ;
"RTN","DG10",32,0)
 S Y=$S($D(^DG(43,1,0)):^(0),1:0) I $P(Y,U,27) S X="DVBHQZ4" X ^%ZOSF("TEST") I $T D
"RTN","DG10",33,0)
 .N DGROUT
"RTN","DG10",34,0)
 .S DGROUT=X
"RTN","DG10",35,0)
 .I $G(DFN) D
"RTN","DG10",36,0)
 ..N X,Y,DGRP
"RTN","DG10",37,0)
 ..F X=.3,.32 S DGRP(X)=$G(^DPT(DFN,X))
"RTN","DG10",38,0)
 ..W !,"     Money Verified: " S Y=$P(DGRP(.3),"^",6) X:Y]"" ^DD("DD") W $S(Y]"":Y,1:"NOT VERIFIED")
"RTN","DG10",39,0)
 ..W ?40,"   Service Verified: " S Y=$P(DGRP(.32),"^",2) X:Y]"" ^DD("DD") W $S(Y]"":Y,1:"NOT VERIFIED")
"RTN","DG10",40,0)
 .D @("EN^"_DGROUT) K Y Q  ;from dgdem0
"RTN","DG10",41,0)
 Q
"RTN","DG10",42,0)
 ;
"RTN","DG10",43,0)
 ;   SDIEMM is used as a flag by AMBCARE Incomplete Encounter Management 
"RTN","DG10",44,0)
 ;   to bypass the embossing routines when calling load/edit from IEMM
"RTN","DG10",45,0)
 ;
"RTN","DG10",46,0)
A1 W !,"Do you want to ",$S(DGNEW:"enter",1:"edit")," Patient Data" S %=1 D YN^DICN G H:'%,CK:%'=1 S DGRPV=0 D EN1^DGRP,MT(DFN),CP G Q:$G(DGPRFLG)=1 G Q:$G(SDIEMM) G Q:'$D(DA),EMBOS
"RTN","DG10",47,0)
 ;
"RTN","DG10",48,0)
H W !?5,"Enter 'YES' to enter/edit registration data or 'NO' to continue without",!?5,"editing."
"RTN","DG10",49,0)
 G A1
"RTN","DG10",50,0)
 ;
"RTN","DG10",51,0)
CK S DGEDCN=1 D ^DGRPC,MT(DFN),CP
"RTN","DG10",52,0)
 G Q:$G(DGPRFLG)=1 G Q:$G(SDIEMM)
"RTN","DG10",53,0)
 I $G(DGER)[55 K DIR S DIR(0)="Y",DIR("A")="Do you wish to return to Screen #9 to enter missing Income Data? " D ^DIR K DIR
"RTN","DG10",54,0)
 ;G:Y ^DGRP9
"RTN","DG10",55,0)
 ;
"RTN","DG10",56,0)
EMBOS ;W ! D EMBOS^DGQEMA G A
"RTN","DG10",57,0)
 G A
"RTN","DG10",58,0)
 ;
"RTN","DG10",59,0)
 ;
"RTN","DG10",60,0)
Q K X,Y,Z,DIC,DGELVER,DGNEW,DGRPV,VET Q
"RTN","DG10",61,0)
 ;
"RTN","DG10",62,0)
MT(DFN) ; Check if user requires a means test.  Ask user if they want to proceedif
"RTN","DG10",63,0)
 ; one is required
"RTN","DG10",64,0)
 I '$D(SDIEMM) DO
"RTN","DG10",65,0)
 .N DGREQF,DIV
"RTN","DG10",66,0)
 .D EN^DGMTR
"RTN","DG10",67,0)
 .I DGREQF D EDT^DGMTU(DFN,DT):$P($$MTS^DGMTU(DFN),U,2)="R"
"RTN","DG10",68,0)
 .Q
"RTN","DG10",69,0)
 I $D(SDIEMM) DO
"RTN","DG10",70,0)
 .N DGMTI
"RTN","DG10",71,0)
 .S DGMTI=$$LST^DGMTU(DFN,SCINF("ENCOUNTER"),1)
"RTN","DG10",72,0)
 .I $P(DGMTI,U,4)="R" D  I 1
"RTN","DG10",73,0)
 ..S DGMT0=$G(^DGMT(408.31,+DGMTI,0)),DGMTDT=$P(DGMT0,"^")
"RTN","DG10",74,0)
 ..I '$$OKTOCONT(DGMTDT) Q
"RTN","DG10",75,0)
 ..S DGMTI=+DGMTI,DGMTYPT=1,DGMTACT="COM",DGMTROU="COM^DGMTEO" D EN^DGMTSC
"RTN","DG10",76,0)
 .E  D WARNING
"RTN","DG10",77,0)
 .Q
"RTN","DG10",78,0)
 Q
"RTN","DG10",79,0)
 ;
"RTN","DG10",80,0)
WARNING ;
"RTN","DG10",81,0)
 ;prints a warning to the screen about means test
"RTN","DG10",82,0)
 ;
"RTN","DG10",83,0)
 W !!,"A means test for this encounter date was not found and may be required!"
"RTN","DG10",84,0)
 W !,"Further investigation will be needed."
"RTN","DG10",85,0)
 W !
"RTN","DG10",86,0)
 D PAUSE
"RTN","DG10",87,0)
 Q
"RTN","DG10",88,0)
 ;
"RTN","DG10",89,0)
PAUSE ;
"RTN","DG10",90,0)
 N DIR
"RTN","DG10",91,0)
 S DIR(0)="FAO",DIR("A")="Press ENTER to continue " D ^DIR
"RTN","DG10",92,0)
 Q
"RTN","DG10",93,0)
 ;
"RTN","DG10",94,0)
OKTOCONT(Y) ;
"RTN","DG10",95,0)
 ;
"RTN","DG10",96,0)
 N DIR
"RTN","DG10",97,0)
 W !!,"Patient Requires a means Test"
"RTN","DG10",98,0)
 X ^DD("DD")
"RTN","DG10",99,0)
 W !,"Primary Means Test Required from '",Y,"'",!
"RTN","DG10",100,0)
 ;
"RTN","DG10",101,0)
 I $D(SDIEMM),'$D(^XUSEC("SCENI MEANS TEST EDIT",DUZ)) DO  G OKQ
"RTN","DG10",102,0)
 .W !,$C(7),"You do not have the appropriate IEMM Security Key.  Contact your supervisor.",!
"RTN","DG10",103,0)
 .D PAUSE
"RTN","DG10",104,0)
 .S Y=0
"RTN","DG10",105,0)
 ;
"RTN","DG10",106,0)
 S DIR("A")="Do you wish to proceed with the means test at this time"
"RTN","DG10",107,0)
 S DIR("B")="YES"
"RTN","DG10",108,0)
 S DIR(0)="Y"
"RTN","DG10",109,0)
 D ^DIR
"RTN","DG10",110,0)
OKQ Q $S(Y=1:1,1:0)
"RTN","DG10",111,0)
 ;
"RTN","DG10",112,0)
CP ;If not (autoexempt or MTested) & no CP test this year then
"RTN","DG10",113,0)
 ;prompt for add/edit cp test
"RTN","DG10",114,0)
 N DIV,DGIB,DGIBDT,DGX,X,DIRUT,DTOUT
"RTN","DG10",115,0)
 G:'$P($G(^DG(43,1,0)),U,41) QTCP ;USE CP FLAG
"RTN","DG10",116,0)
 S DGIBDT=$S($D(DFN1):9999999-DFN1,1:DT)
"RTN","DG10",117,0)
 D EN^DGMTCOR
"RTN","DG10",118,0)
 I +$G(DGNOCOPF) S DGMTCOR=0
"RTN","DG10",119,0)
 I DGMTCOR D THRESH^DGMTCOU1(DGIBDT) D EDT^DGMTCOU(DFN,DT)
"RTN","DG10",120,0)
 K DGNOCOPF
"RTN","DG10",121,0)
QTCP Q
"RTN","DG1010P")
0^2^B18385183
"RTN","DG1010P",1,0)
DG1010P ;ALB/JDS;REW - 1010 PRINT--INQUIRY PATIENT ; 1/3/05 6:18pm
"RTN","DG1010P",2,0)
 ;;5.3;Registration;**86,108,113,161,642**;Aug 13, 1993
"RTN","DG1010P",3,0)
 ;
"RTN","DG1010P",4,0)
FIND W !! S DIC="^DPT(",DIC(0)="AEQZM" D ^DIC G Q:+Y'>0 S (DA,DFN)=+Y
"RTN","DG1010P",5,0)
 S FREE=+$P(^DG(43,1,0),U,8),DGOPT=""
"RTN","DG1010P",6,0)
 I $O(^DPT(DFN,"DIS",0))'>0 W !!,"No registrations to print from.",!! G FIND
"RTN","DG1010P",7,0)
F11 R !!,"Registration date/time: ",X:DTIME G Q:'$T D UP^DGHELP G FIND:X?1"^".E!(X=""),NUM:$L(X)<7 S %DT="T" D ^%DT S DFN1=9999999-Y G W1:$D(^DPT(DFN,"DIS",DFN1)) W !!
"RTN","DG1010P",8,0)
HELP S J=0 F I=0:0 S I=$O(^DPT(DFN,"DIS",I)) Q:'I  S J=J+1,L=+(^(I,0))_"00000" W $J(J,2),".  ",$$FMTE^XLFDT($E(L,1,12),"5Z") W ?$X\40+1*40 W:$X>75 ! Q:J>20
"RTN","DG1010P",9,0)
 W !,"Enter the date and time, Entry #, or 'L' for the last registration,",!," to select the registration you wish to print a 10/10 for." G F11
"RTN","DG1010P",10,0)
NUM W:$E(X)="L" $E("LAST",$L(X)+1,99) W !! I $E(X)="L" S DFN1=$O(^DPT(DFN,"DIS",0)) G HELP:DFN1'>0,W1
"RTN","DG1010P",11,0)
 S DFN1=0 F I=1:1:+X S DFN1=$O(^DPT(DFN,"DIS",DFN1)) Q:'DFN
"RTN","DG1010P",12,0)
 G HELP:DFN1'>0 W !
"RTN","DG1010P",13,0)
W1 D NOREG^DG1010PA(DFN)
"RTN","DG1010P",14,0)
QU ;
"RTN","DG1010P",15,0)
 S DGHDFN=DFN
"RTN","DG1010P",16,0)
 I DGOPT]"" D  S DGPGM="DQ^DG1010P",DGVAR="DGOPT^PRF^FREE^DFN^DFN1^DUZ^DGPMDA^DGT^PSOINST^PSONOPG^PSOPAR^PSTYPE^GMTSTYP" D ZIS^DGUTQ G:POP EMB U IO D DQ G EMB
"RTN","DG1010P",17,0)
 .W:DGOPT'=5 !!?5,*7,"This output requires 132 column output to a PRINTER.",!?5,*7,"Output to SCREEN will be unreadable."
"RTN","DG1010P",18,0)
 G EMB
"RTN","DG1010P",19,0)
EN ;
"RTN","DG1010P",20,0)
 D:'$D(DT) DT^DICRW F I=0,.11,.121,.13,.24,.31,57,1010.15 S DGP(I)=$G(^DPT(DFN,I))
"RTN","DG1010P",21,0)
 S DGPAGE=0
"RTN","DG1010P",22,0)
 D NOW^%DTC,YX^%DTC S DGNOW=Y
"RTN","DG1010P",23,0)
 F I=0,1,2,3 S DGP("DIS",I)=$G(^DPT(DFN,"DIS",DFN1,I))
"RTN","DG1010P",24,0)
 S DGD=DGP("DIS",0),Y=+DGD X ^DD("DD") S DGAP=Y,DGCLK=$S($D(^VA(200,+$P(DGD,U,5),0)):$S($P(^(0),U,2)]"":$P(^(0),U,2)_"/"_$P(DGD,U,5),1:"unk/"_$P(DGD,U,5)),1:"unspecified"),DGNAM=$P(DGP(0),U,1)
"RTN","DG1010P",25,0)
 S DGSS=$P(DGP(0),U,9),DGSS=$E(DGSS,1,3)_"-"_$E(DGSS,4,5)_"-"_$E(DGSS,6,10)
"RTN","DG1010P",26,0)
 S DGLDOUBL="",$P(DGLDOUBL,"=",132)=""
"RTN","DG1010P",27,0)
 S (DGLDASH,DGLUND,DGL2)=""
"RTN","DG1010P",28,0)
 S $P(DGLDASH,"-",132)="",$P(DGL2,"-",131)="",$P(DGL2,"-",67)="|"
"RTN","DG1010P",29,0)
 S $P(DGLUND,"_",132)=""
"RTN","DG1010P",30,0)
 G ^DG1010S1:FREE=2
"RTN","DG1010P",31,0)
 I $$FIRST^DGUTL G Q
"RTN","DG1010P",32,0)
 W DGLDOUBL,!?35,"D E P A R T M E N T   O F   V E T E R A N S   A F F A I R S",!,DGLDOUBL,!,"FACILITY:  "
"RTN","DG1010P",33,0)
 S (DGSITE,X)=$$SITE^VASITE W $S((+X=-1):"FACILITY NOT IDENTIFIED",1:$P(X,U,2)_" ("_$P(X,U,3)_")")
"RTN","DG1010P",34,0)
 W ?96,"APPLICATION FOR MEDICAL BENEFITS",!,DGLDOUBL
"RTN","DG1010P",35,0)
 G ^DG1010P1
"RTN","DG1010P",36,0)
ADM K DGPMDA I $D(^DGPM("ATID1",DFN)) F I=0:0 S I=$O(^DGPM("ATID1",DFN,I)) Q:'I!(I>(DFN1+.9999))  S DGPMDA=$O(^(I,0))
"RTN","DG1010P",37,0)
 S DGPMDA=$S($D(DGPMDA):DGPMDA,1:0) Q
"RTN","DG1010P",38,0)
ASK W !,"PRINT ",DGX S %=1 D YN^DICN I '% W !,"ENTER 'Y'ES TO PRINT A ",DGX,".  OTHERWISE ENTER 'N'O."
"RTN","DG1010P",39,0)
 Q
"RTN","DG1010P",40,0)
DQ ;
"RTN","DG1010P",41,0)
 D NOW^%DTC,YX^%DTC S DGNOW=Y
"RTN","DG1010P",42,0)
 S X=132 X ^%ZOSF("RM") F I="DFN","DFN1","FREE","DGPMDA","DGT","PRF","GMTSTYP" S DGHOLD(I)=$S($D(@I):@I,1:"")
"RTN","DG1010P",43,0)
 I DGOPT[9&'($G(DGSTOP)) D EN^DGRPTP ; 1010T
"RTN","DG1010P",44,0)
 I DGOPT[1&'($G(DGSTOP)) S DA=DFN D EN^DG1010P ;1010
"RTN","DG1010P",45,0)
 I DGOPT[4&'($G(DGSTOP)) D EN^DG1010S1 ;SUP 1010
"RTN","DG1010P",46,0)
 I DGOPT[2&'($G(DGSTOP)) D RESTORE,^DG3PR0 ;1010I
"RTN","DG1010P",47,0)
 I DGOPT[3&'($G(DGSTOP)) D RESTORE,RET^DGBLRV ;3rd party review
"RTN","DG1010P",48,0)
 I DGOPT[6!(DGOPT[7)&'($G(DGSTOP)) S DGMTDT=$P(DGT,U,2),DGMTI=$P(DGT,U,1),DGMTYPT=$P(DGT,U,5) D RESTORE,START^DGMTP ;1010F
"RTN","DG1010P",49,0)
 I DGOPT[8&'($G(DGSTOP)) D RESTORE,ENXQ^GMTSDVR
"RTN","DG1010P",50,0)
 I DGOPT[5&'($G(DGSTOP)) S POP=0 D RESTORE,DFN^PSOSD1 K POP S X=132 X ^%ZOSF("RM") ;DRUG PROFILE NOTE: EXECUTES ^%ZIS("C")
"RTN","DG1010P",51,0)
 D ^%ZISC
"RTN","DG1010P",52,0)
 D CLOSE^DGUTQ,Q K DGHOLD,DGOPT,DGPMDA Q
"RTN","DG1010P",53,0)
Q K %,%DT,DA,DB,DFN,DFN1,DGHSFLG,DGOPT,DGL2,DGLDASH,DGLDOUBL,DGLSUP,DGLSUP1,DGLUND,DGPGM,DGPMDA,DGMTDT,DGMTI,DGMTYPT,DGNOW,DGT,DGVAR,DGX,DIC,DIRUT,DTOUT,DUOUT,FREE,I,J,L,POP,PRF,X,Y,DGSTOP
"RTN","DG1010P",54,0)
 K LMI,PSCNT,PSDIS,PSDT,PSII,PSOPRINT ;FROM DRUG PROFILE
"RTN","DG1010P",55,0)
 K GMTSTYP
"RTN","DG1010P",56,0)
 Q
"RTN","DG1010P",57,0)
RESTORE F I="DFN","DFN1","FREE","PRF","DGPMDA","DGT","GMTSTYP" S @I=DGHOLD(I)
"RTN","DG1010P",58,0)
 Q
"RTN","DG1010P",59,0)
EMB ;emboss card?
"RTN","DG1010P",60,0)
 S DFN=DGHDFN
"RTN","DG1010P",61,0)
 ;W !! D EMBOS^DGQEMA
"RTN","DG1010P",62,0)
 D EF
"RTN","DG1010P",63,0)
 K DGHDFN G FIND
"RTN","DG1010P",64,0)
 ;
"RTN","DG1010P",65,0)
EF ;encounter form?
"RTN","DG1010P",66,0)
 N EFX,WITHDATA,IBDFRION
"RTN","DG1010P",67,0)
 I $$PROMPRN^DG1010PA("EF") I DG1'<0 S EFX=1 D
"RTN","DG1010P",68,0)
 .S WITHDATA=1
"RTN","DG1010P",69,0)
 .D MAIN^IBDFREG(WITHDATA)
"RTN","DG1010P",70,0)
 Q
"RTN","DGREG00")
0^3^B13329459
"RTN","DGREG00",1,0)
DGREG00 ;ALB/JDS-REGISTER A PATIENT, CONT. ; 1/3/05 6:18pm
"RTN","DGREG00",2,0)
 ;;5.3;Registration;**86,108,113,91,149,642**;Aug 13, 1993
"RTN","DGREG00",3,0)
W1 D NOW^%DTC S DGNOW=% K A,DGOPT
"RTN","DGREG00",4,0)
 ;If 10-10T registration, print 10-10T
"RTN","DGREG00",5,0)
 I $G(DG1010TF),$$PROMPRN^DG1010PA("1010T") G Q:DG1<0  D
"RTN","DGREG00",6,0)
 . D QUE^DGRPTP(DFN,DFN1,.DGIO)
"RTN","DGREG00",7,0)
 I $$PROMPRN^DG1010PA("1010") S DB=1
"RTN","DGREG00",8,0)
W2 I $$PROMPRN^DG1010PA("1010I") D
"RTN","DGREG00",9,0)
 .S ZTRTN="^DG3PR0",ZTDTH=DGNOW,ZTSAVE("DFN")=DFN,ZTDESC="PRINT 1010 - FROM REGISTRATION",ZTIO=DGIO(10)
"RTN","DGREG00",10,0)
 .D ^%ZTLOAD
"RTN","DGREG00",11,0)
 ;
"RTN","DGREG00",12,0)
W3 S PRF=0,RT=0 G QU:'$D(^DG(43,1,0))
"RTN","DGREG00",13,0)
PRO I $$PROMPRN^DG1010PA("PRO") S PRF=1
"RTN","DGREG00",14,0)
 I $$PROMPRN^DG1010PA("HS") S DGHS=1
"RTN","DGREG00",15,0)
RT W !,"ROUTING SLIP" S %=1 D YN^DICN G Q:%=-1 I '% S DGPRINT=4 D HLP G RT
"RTN","DGREG00",16,0)
 S RT=(%=1)
"RTN","DGREG00",17,0)
QU I $G(DB) S ZTRTN="EN^DG1010P",ZTDTH=DGNOW,ZTDESC="1010 - FROM REGISTRATION",ZTSAVE("DA")=DFN,ZTSAVE("DFN")=DFN,ZTSAVE("DFN1")=DFN1,ZTSAVE("FREE")=$S($D(^DG(43,1,0)):+$P(^(0),"^",8),1:0),ZTIO=DGIO(10) D ^%ZTLOAD
"RTN","DGREG00",18,0)
QUPRF I $G(PRF) D
"RTN","DGREG00",19,0)
 .S ZTRTN="DFN^PSOSD1",ZTDTH=DGNOW,ZTDESC="DRUG PROFILE - FROM REGISTRATION",ZTSAVE("PSOINST")=$G(PSOINST),ZTSAVE("PSONOPG")=$G(PSONOPG)
"RTN","DGREG00",20,0)
 .S ZTSAVE("PSOPAR")=$G(PSOPAR),ZTSAVE("PSTYPE")=$G(PSTYPE),ZTSAVE("DFN")=DFN,ZTSAVE("DFN1")=DFN1,ZTIO=DGIO("PRF")
"RTN","DGREG00",21,0)
 .D ^%ZTLOAD
"RTN","DGREG00",22,0)
QUHS I $G(DGHS)&$G(GMTSTYP) D
"RTN","DGREG00",23,0)
 .S ZTRTN="ENXQ^GMTSDVR",ZTDTH=DGNOW,ZTDESC="HEALTH SUMMARY - FROM REGISTRATION",ZTSAVE("GMTSTYP")=GMTSTYP,ZTSAVE("DFN")=DFN,ZTIO=DGIO(10)
"RTN","DGREG00",24,0)
 .D ^%ZTLOAD
"RTN","DGREG00",25,0)
 .K DGHS,GMTSTYP
"RTN","DGREG00",26,0)
QURT I $G(RT) S ZTRTN="EN1^SDROUT1",ZTDTH=DGNOW,ZTDESC="ROUTING SLIP - FROM REGISTRATION",ZTSAVE("DFN")=DFN,ZTSAVE("DIV")=DIV,ZTSAVE("DT")=DT,ZTIO=DGIO("RT") D ^%ZTLOAD
"RTN","DGREG00",27,0)
EMBOS ;W ! D EMBOS^DGQEMA
"RTN","DGREG00",28,0)
 D EF^DG1010P
"RTN","DGREG00",29,0)
Q K:'$D(DGASKDEV) DGIO
"RTN","DGREG00",30,0)
Q1 ;
"RTN","DGREG00",31,0)
 D EVNT
"RTN","DGREG00",32,0)
 D CIRN
"RTN","DGREG00",33,0)
 K %,%DT,A,B,ANS,APD,B,CURR,DA,DB,DE,DEF,DG1,DGCLPR,DGDAY,DGDFN,DGE,DGL,DGLL,DFMD,DGNEW,DGNOW,DGO,DIC,DIE,DINUM,DOW,DP,DR,I,I1,IOZBK,IOZFO,L,L1,L2,LL,LL1,LL2,MDCARD,PARA,PRF,RT,S,SC,SEEN
"RTN","DGREG00",34,0)
 K VET,X,X1,X2,Y,Y1,ZTSK,D0,D1,DIV,DLAYGO,J,PGM,Z G A^DGREG:('$D(DGRPFEE)&('$G(DG1010TF))&('$D(RGMPI))) Q
"RTN","DGREG00",35,0)
 ;
"RTN","DGREG00",36,0)
DT G DT^DIQ:Y
"RTN","DGREG00",37,0)
 Q
"RTN","DGREG00",38,0)
SSD S DIV=$S('$D(^DG(40.8,+$P(A(0),"^",4),0)):" 1",1:" "_$P(A(0),"^",4))
"RTN","DGREG00",39,0)
 Q
"RTN","DGREG00",40,0)
HLP S DGPRINT=$P("10-10^10-10I^DRUG PROFILE^ROUTING SLIP","^",DGPRINT) W !!,"CHOOSE FROM",!?4,"YES - To include a copy of the ",DGPRINT," for this patient.",!?4,"NO  - If you don't want to print a copy of the ",DGPRINT,"." K DGPRINT Q
"RTN","DGREG00",41,0)
 ;
"RTN","DGREG00",42,0)
EVNT ;list of external calls
"RTN","DGREG00",43,0)
 N VAFHDATE
"RTN","DGREG00",44,0)
 S VAFHDATE=+$G(^DPT(DFN,"DIS",DFN1,0))
"RTN","DGREG00",45,0)
 K VAFHFLG D:+$$SEND^VAFHUTL() EN^VAFHLA04(DFN,VAFHDATE) ;fires Registration HL7 V1.5 message
"RTN","DGREG00",46,0)
 K VAFHMRG
"RTN","DGREG00",47,0)
 Q
"RTN","DGREG00",48,0)
CIRN ;
"RTN","DGREG00",49,0)
 Q:$P($$SEND^VAFHUTL(),"^",2)'>0
"RTN","DGREG00",50,0)
 ;W !,"Doing CIRN Messaging..."
"RTN","DGREG00",51,0)
 N DGZDATE,ERR
"RTN","DGREG00",52,0)
 S DGZDATE=+$G(^DPT(DFN,"DIS",DFN1,0))
"RTN","DGREG00",53,0)
 S ERR=$$EN^VAFCA04(DFN,DGZDATE) ; fires off HL7 V1.6 message
"RTN","DGREG00",54,0)
 Q
"VER")
8.0^22
**END**
**END**
