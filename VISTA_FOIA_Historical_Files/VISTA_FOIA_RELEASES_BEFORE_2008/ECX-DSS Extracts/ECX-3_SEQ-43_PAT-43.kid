Released ECX*3*43 SEQ #43
Extracted from mail message
**KIDS**:ECX*3.0*43^

**INSTALL NAME**
ECX*3.0*43
"BLD",3700,0)
ECX*3.0*43^DSS EXTRACTS^0^3020515^y
"BLD",3700,4,0)
^9.64PA^727.815^2
"BLD",3700,4,727.815,0)
727.815
"BLD",3700,4,727.815,2,0)
^9.641^727.815^1
"BLD",3700,4,727.815,2,727.815,0)
EVENT CAPTURE LOCAL EXTRACT  (File-top level)
"BLD",3700,4,727.815,2,727.815,1,0)
^9.6411^11^1
"BLD",3700,4,727.815,2,727.815,1,11,0)
PROCEDURE
"BLD",3700,4,727.815,222)
y^n^p^^^^n
"BLD",3700,4,727.825,0)
727.825
"BLD",3700,4,727.825,2,0)
^9.641^727.825^1
"BLD",3700,4,727.825,2,727.825,0)
QUASAR EXTRACT  (File-top level)
"BLD",3700,4,727.825,2,727.825,1,0)
^9.6411^11^1
"BLD",3700,4,727.825,2,727.825,1,11,0)
PROCEDURE
"BLD",3700,4,727.825,222)
y^n^p^^^^n
"BLD",3700,4,"APDD",727.815,727.815)

"BLD",3700,4,"APDD",727.815,727.815,11)

"BLD",3700,4,"APDD",727.825,727.825)

"BLD",3700,4,"APDD",727.825,727.825,11)

"BLD",3700,4,"B",727.815,727.815)

"BLD",3700,4,"B",727.825,727.825)

"BLD",3700,"KRN",0)
^9.67PA^19^17
"BLD",3700,"KRN",.4,0)
.4
"BLD",3700,"KRN",.401,0)
.401
"BLD",3700,"KRN",.402,0)
.402
"BLD",3700,"KRN",.403,0)
.403
"BLD",3700,"KRN",.5,0)
.5
"BLD",3700,"KRN",.84,0)
.84
"BLD",3700,"KRN",3.6,0)
3.6
"BLD",3700,"KRN",3.8,0)
3.8
"BLD",3700,"KRN",9.2,0)
9.2
"BLD",3700,"KRN",9.8,0)
9.8
"BLD",3700,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",3700,"KRN",9.8,"NM",1,0)
ECXQSR^^0^B44095677
"BLD",3700,"KRN",9.8,"NM",2,0)
ECXAECQ^^0^B46472821
"BLD",3700,"KRN",9.8,"NM","B","ECXAECQ",2)

"BLD",3700,"KRN",9.8,"NM","B","ECXQSR",1)

"BLD",3700,"KRN",19,0)
19
"BLD",3700,"KRN",19.1,0)
19.1
"BLD",3700,"KRN",101,0)
101
"BLD",3700,"KRN",409.61,0)
409.61
"BLD",3700,"KRN",771,0)
771
"BLD",3700,"KRN",870,0)
870
"BLD",3700,"KRN",8994,0)
8994
"BLD",3700,"KRN","B",.4,.4)

"BLD",3700,"KRN","B",.401,.401)

"BLD",3700,"KRN","B",.402,.402)

"BLD",3700,"KRN","B",.403,.403)

"BLD",3700,"KRN","B",.5,.5)

"BLD",3700,"KRN","B",.84,.84)

"BLD",3700,"KRN","B",3.6,3.6)

"BLD",3700,"KRN","B",3.8,3.8)

"BLD",3700,"KRN","B",9.2,9.2)

"BLD",3700,"KRN","B",9.8,9.8)

"BLD",3700,"KRN","B",19,19)

"BLD",3700,"KRN","B",19.1,19.1)

"BLD",3700,"KRN","B",101,101)

"BLD",3700,"KRN","B",409.61,409.61)

"BLD",3700,"KRN","B",771,771)

"BLD",3700,"KRN","B",870,870)

"BLD",3700,"KRN","B",8994,8994)

"BLD",3700,"QUES",0)
^9.62^^
"BLD",3700,"REQB",0)
^9.611^3^3
"BLD",3700,"REQB",1,0)
ECX*3.0*39^2
"BLD",3700,"REQB",2,0)
ACKQ*3.0*2^2
"BLD",3700,"REQB",3,0)
ECX*3.0*35^2
"BLD",3700,"REQB","B","ACKQ*3.0*2",2)

"BLD",3700,"REQB","B","ECX*3.0*35",3)

"BLD",3700,"REQB","B","ECX*3.0*39",1)

"FIA",727.815)
EVENT CAPTURE LOCAL EXTRACT
"FIA",727.815,0)
^ECX(727.815,
"FIA",727.815,0,0)
727.815
"FIA",727.815,0,1)
y^n^p^^^^n
"FIA",727.815,0,10)

"FIA",727.815,0,11)

"FIA",727.815,0,"RLRO")

"FIA",727.815,0,"VR")
3.0^ECX
"FIA",727.815,727.815)
1
"FIA",727.815,727.815,11)

"FIA",727.825)
QUASAR EXTRACT
"FIA",727.825,0)
^ECX(727.825,
"FIA",727.825,0,0)
727.825
"FIA",727.825,0,1)
y^n^p^^^^n
"FIA",727.825,0,10)

"FIA",727.825,0,11)

"FIA",727.825,0,"RLRO")

"FIA",727.825,0,"VR")
3.0^ECX
"FIA",727.825,727.825)
1
"FIA",727.825,727.825,11)

"MBREQ")
0
"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,20,0)
^9.402P^^
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^3010618^2980112^11714
"PKG",513,22,1,"PAH",1,0)
43^3020515
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ECXAECQ")
0^2^B46472821
"RTN","ECXAECQ",1,0)
ECXAECQ ;ALB/JAP - ECQ Extract Audit Report ; 5/13/02 11:18am
"RTN","ECXAECQ",2,0)
 ;;3.0;DSS EXTRACTS;**8,33,35,43**;Dec 22, 1997
"RTN","ECXAECQ",3,0)
 ;
"RTN","ECXAECQ",4,0)
EN ;entry point for ECQ extract audit report
"RTN","ECXAECQ",5,0)
 N %X,%Y,X,Y,DIC,DA,DR,DIQ,DIR,ECXQV,ECXPOS,ECXYR,ECXMTH,ECXPFLG,ECXOPT,QFLG,Q2FLG
"RTN","ECXAECQ",6,0)
 S (ECXERR,QFLG)=0
"RTN","ECXAECQ",7,0)
 ;ecxaud=0 for 'extract' audit
"RTN","ECXAECQ",8,0)
 S ECXHEAD="ECQ",ECXAUD=0
"RTN","ECXAECQ",9,0)
 W !!,"Setup for ",ECXHEAD," Extract Audit Report --",!!
"RTN","ECXAECQ",10,0)
 ;select extract
"RTN","ECXAECQ",11,0)
 D AUDIT^ECXUTLA(ECXHEAD,.ECXERR,.ECXARRAY,ECXAUD)
"RTN","ECXAECQ",12,0)
 Q:ECXERR
"RTN","ECXAECQ",13,0)
 ;determine if version 3 and using EC National Procedure Codes for current fiscal year
"RTN","ECXAECQ",14,0)
 D FILE^DID(509850.6,,"VERSION","ARR","ERR")
"RTN","ECXAECQ",15,0)
 S ECXQV=$G(ARR("VERSION"))
"RTN","ECXAECQ",16,0)
 S ECXPOS=29
"RTN","ECXAECQ",17,0)
 I +ECXQV=3 D 
"RTN","ECXAECQ",18,0)
 .S ECXYR=$E($P(ECXARRAY("START"),",",2),4,5)
"RTN","ECXAECQ",19,0)
 .S ECXMTH=$E(ECXARRAY("START"),1,3)
"RTN","ECXAECQ",20,0)
 .I (ECXMTH="OCT")!(ECXMTH="NOV")!(ECXMTH="DEC") S ECXYR=ECXYR+1
"RTN","ECXAECQ",21,0)
 .S ECDA=0 F  S ECDA=$O(^ACK(509850.8,ECDA)) Q:'ECDA!QFLG  S ECDIV=0 F  S ECDIV=$O(^ACK(509850.8,ECDA,2,ECDIV)) Q:'ECDIV!QFLG  D
"RTN","ECXAECQ",22,0)
 ..S ECCL=0 F  S ECCL=$O(^ACK(509850.8,ECDA,2,ECDIV,2,"B",ECXYR,ECCL)) Q:'ECCL!QFLG  D
"RTN","ECXAECQ",23,0)
 ...S ECXPFLG=$P($G(^ACK(509850.8,ECDA,2,ECDIV,2,ECCL,0)),U,2)
"RTN","ECXAECQ",24,0)
 ...I ECXPFLG D  S QFLG=1
"RTN","ECXAECQ",25,0)
 ....W !!,"Your site has division(s) which are using EC National Procedure Codes for the",!,"fiscal year covering the time period of this extract."
"RTN","ECXAECQ",26,0)
 ....W !!,"You have the option to display either EC National Procedure Codes or CPT Codes",!,"for these division(s)."
"RTN","ECXAECQ",27,0)
 ....F  D  Q:Q2FLG
"RTN","ECXAECQ",28,0)
 .....S Q2FLG=1
"RTN","ECXAECQ",29,0)
 .....S DIR(0)="S^1:EC National Procedure Codes;2:CPT Codes",DIR("A")="Selection",DIR("B")=1 D ^DIR K DIR S ECXOPT=Y
"RTN","ECXAECQ",30,0)
 .....I X["^" W !!,"This is a required response" S Q2FLG=0
"RTN","ECXAECQ",31,0)
 ....I ECXOPT=1 S ECXPOS=12
"RTN","ECXAECQ",32,0)
 ;currently, quasar does not accommodate multi-divisional sites
"RTN","ECXAECQ",33,0)
 S ECXALL=0
"RTN","ECXAECQ",34,0)
 D ECQ^ECXDVSN1(.ECXDIV,ECXALL,.ECXERR)
"RTN","ECXAECQ",35,0)
 I ECXERR=1 D  Q
"RTN","ECXAECQ",36,0)
 .W !!,?5,"Try again later... exiting.",!
"RTN","ECXAECQ",37,0)
 .D AUDIT^ECXKILL
"RTN","ECXAECQ",38,0)
 ;determine output device and queue if requested
"RTN","ECXAECQ",39,0)
 W !
"RTN","ECXAECQ",40,0)
 S ECXPGM="PROCESS^ECXAECQ",ECXDESC="ECQ Extract Audit Report"
"RTN","ECXAECQ",41,0)
 S ECXSAVE("ECXHEAD")="",ECXSAVE("ECXALL")="",ECXSAVE("ECXDIV(")="",ECXSAVE("ECXARRAY(")=""
"RTN","ECXAECQ",42,0)
 W !
"RTN","ECXAECQ",43,0)
 D DEVICE^ECXUTLA(ECXPGM,ECXDESC,.ECXSAVE)
"RTN","ECXAECQ",44,0)
 I ECXSAVE("POP")=1 D  Q
"RTN","ECXAECQ",45,0)
 .W !!,?5,"Try again later... exiting.",!
"RTN","ECXAECQ",46,0)
 .D AUDIT^ECXKILL
"RTN","ECXAECQ",47,0)
 I ECXSAVE("ZTSK")=0 D
"RTN","ECXAECQ",48,0)
 .K ECXSAVE,ECXPGM,ECXDESC
"RTN","ECXAECQ",49,0)
 .D PROCESS^ECXAECQ
"RTN","ECXAECQ",50,0)
 I IO'=IO(0) D ^%ZISC
"RTN","ECXAECQ",51,0)
 D HOME^%ZIS
"RTN","ECXAECQ",52,0)
 D AUDIT^ECXKILL
"RTN","ECXAECQ",53,0)
 Q
"RTN","ECXAECQ",54,0)
 ;
"RTN","ECXAECQ",55,0)
PROCESS ;process data in file #727.825
"RTN","ECXAECQ",56,0)
 N X,Y,W,ADIV,DATA,DATE,DIV,DIVACK,IEN,LOC,ECNIEN
"RTN","ECXAECQ",57,0)
 N UNIT,UNITN,VOL,PROC,PROCN,SDIV,QQFLG,CNT
"RTN","ECXAECQ",58,0)
 K ^TMP($J,"ECXAUD"),^TMP($J,"ECXPROC")
"RTN","ECXAECQ",59,0)
 S (CNT,QQFLG)=0,ECXEXT=ECXARRAY("EXTRACT"),ECXDEF=ECXARRAY("DEF")
"RTN","ECXAECQ",60,0)
 S X=ECXARRAY("START") D ^%DT S ECXSTART=Y,X=ECXARRAY("END")
"RTN","ECXAECQ",61,0)
 D ^%DT S ECXEND=Y
"RTN","ECXAECQ",62,0)
 ;get run date in external format
"RTN","ECXAECQ",63,0)
 D NOW^%DTC S Y=$E(%,1,12) D DD^%DT S ECXRUN=Y
"RTN","ECXAECQ",64,0)
 ;get the dss unit links for this division/site
"RTN","ECXAECQ",65,0)
 S DIV=0
"RTN","ECXAECQ",66,0)
 F  S DIV=$O(ECXDIV(DIV)) Q:DIV=""  D
"RTN","ECXAECQ",67,0)
 .S DIVACK=$P(ECXDIV(DIV),U,1),ECXLINK(DIV)=^ACK(509850.8,DIVACK,"DSS")
"RTN","ECXAECQ",68,0)
 ;get extract records in date range
"RTN","ECXAECQ",69,0)
 S IEN=""
"RTN","ECXAECQ",70,0)
 F  S IEN=$O(^ECX(727.825,"AC",ECXEXT,IEN)) Q:IEN=""  D  Q:QQFLG
"RTN","ECXAECQ",71,0)
 .S DATA=^ECX(727.825,IEN,0),DIV=$P(DATA,U,4),DATE=$P(DATA,U,9)
"RTN","ECXAECQ",72,0)
 .S ADIV=$P(^ECX(727.825,IEN,1),U,11) S:ADIV="" ADIV="UNK"
"RTN","ECXAECQ",73,0)
 .I +ADIV S X=^DG(40.8,ADIV,0),ADIV=$P(X,U)_" ("_$P(X,U,2)_")"
"RTN","ECXAECQ",74,0)
 .;convert free text date to fm internal format date
"RTN","ECXAECQ",75,0)
 .S $E(DATE,1,2)=$E(DATE,1,2)-17
"RTN","ECXAECQ",76,0)
 .Q:$L(DATE)<7  Q:(DATE<ECXSTART)  Q:(DATE>ECXEND)
"RTN","ECXAECQ",77,0)
 .;if location is among those selected, then tally event capture data
"RTN","ECXAECQ",78,0)
 .I $D(ECXDIV(DIV)) D  Q:QQFLG
"RTN","ECXAECQ",79,0)
 ..;any quasar site that doesn't have links to dss is identified by "xx"
"RTN","ECXAECQ",80,0)
 ..S UNIT=$P(DATA,U,10)
"RTN","ECXAECQ",81,0)
 ..S LOC=$S(UNIT=$P(ECXLINK(DIV),U,1):"A",UNIT=$P(ECXLINK(DIV),U,2):"S",1:"XX")
"RTN","ECXAECQ",82,0)
 ..;any invalid cpt code is identified as "xxxxx"
"RTN","ECXAECQ",83,0)
 ..S PROC=$E($P(DATA,U,ECXPOS),1,5),VOL=$P(DATA,U,13),PROCN=""
"RTN","ECXAECQ",84,0)
 ..I ECXPOS=12 D
"RTN","ECXAECQ",85,0)
 ...S ECNIEN=0,ECNIEN=$O(^EC(725,"D",PROC,ECNIEN)) Q:'ECNIEN
"RTN","ECXAECQ",86,0)
 ...S PROCN=$P($G(^EC(725,+ECNIEN,0)),U)
"RTN","ECXAECQ",87,0)
 ..I PROCN="" D
"RTN","ECXAECQ",88,0)
 ...S ECNIEN=0,ECNIEN=$O(^ICPT("B",PROC,ECNIEN)) Q:'ECNIEN
"RTN","ECXAECQ",89,0)
 ...S PROCN=$P($G(^ICPT(ECNIEN,0)),U,2)
"RTN","ECXAECQ",90,0)
 ..S PROC="A"_PROC S:VOL="" VOL=1
"RTN","ECXAECQ",91,0)
 ..S:PROCN="" PROCN="Unknown"
"RTN","ECXAECQ",92,0)
 ..I '$D(^TMP($J,"ECXAUD",DIV,ADIV,LOC,PROC)) S ^TMP($J,"ECXAUD",DIV,ADIV,LOC,PROC)=0_U_PROCN
"RTN","ECXAECQ",93,0)
 ..S $P(^(PROC),U,1)=$P(^TMP($J,"ECXAUD",DIV,ADIV,LOC,PROC),U,1)+VOL,CNT=CNT+1
"RTN","ECXAECQ",94,0)
 ..I $D(ZTQUEUED),(CNT>499),'(CNT#500),$$S^%ZTLOAD S QQFLG=1,ZTSTOP=1 K ZTREQ
"RTN","ECXAECQ",95,0)
 ;print the report
"RTN","ECXAECQ",96,0)
 D PRINT
"RTN","ECXAECQ",97,0)
 D AUDIT^ECXKILL
"RTN","ECXAECQ",98,0)
 Q
"RTN","ECXAECQ",99,0)
 ;
"RTN","ECXAECQ",100,0)
PRINT ;print quasar data by site and dss unit order
"RTN","ECXAECQ",101,0)
 N JJ,SS,LN,P,LOC,UNITN,PG,QFLG,GTOT,STOT,TOT,PROC,PROCN
"RTN","ECXAECQ",102,0)
 N DIR,DIRUT,DIV,DIVNM,DTOUT,DUOUT
"RTN","ECXAECQ",103,0)
 U IO
"RTN","ECXAECQ",104,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S ZTSTOP=1 K ZTREQ Q
"RTN","ECXAECQ",105,0)
 S (QFLG,PG)=0,$P(LN,"-",80)="",DIV=""
"RTN","ECXAECQ",106,0)
 F  S DIV=$O(ECXDIV(DIV)) Q:DIV=""  D  Q:QFLG
"RTN","ECXAECQ",107,0)
 .S DIVNM=$P(ECXDIV(DIV),U,2)_" ("_$P(ECXDIV(DIV),U,3)_")"
"RTN","ECXAECQ",108,0)
 .D HEADER Q:QFLG
"RTN","ECXAECQ",109,0)
 .S GTOT=0,STOT("A")=0,STOT("S")=0,STOT("XX")=0
"RTN","ECXAECQ",110,0)
 .I '$D(^TMP($J,"ECXAUD",DIV)) D  Q
"RTN","ECXAECQ",111,0)
 ..W !!,?5,"No data available for this QUASAR site.",!!
"RTN","ECXAECQ",112,0)
 .I $D(^TMP($J,"ECXAUD",DIV)) S ADIV="" D
"RTN","ECXAECQ",113,0)
 ..F  S ADIV=$O(^TMP($J,"ECXAUD",DIV,ADIV)) Q:ADIV=""  S LOC="" D  Q:QFLG
"RTN","ECXAECQ",114,0)
 ...F  S LOC=$O(^TMP($J,"ECXAUD",DIV,ADIV,LOC)) Q:LOC=""  D  Q:QFLG
"RTN","ECXAECQ",115,0)
 ....;write the unit name
"RTN","ECXAECQ",116,0)
 ....S UNITN=$S(LOC="A":"Audiology",LOC="S":"Speech Pathology",1:"Unknown"),PROC=""
"RTN","ECXAECQ",117,0)
 ....D:($Y+2>IOSL) HEADER Q:QFLG  W !,"Division: ("_ADIV_")",!?20,UNITN
"RTN","ECXAECQ",118,0)
 ....F  S PROC=$O(^TMP($J,"ECXAUD",DIV,ADIV,LOC,PROC)) Q:PROC=""  D  Q:QFLG
"RTN","ECXAECQ",119,0)
 .....S TOT=+^TMP($J,"ECXAUD",DIV,ADIV,LOC,PROC),PROCN=$P(^(PROC),U,2),P=$E(PROC,2,99)
"RTN","ECXAECQ",120,0)
 .....S SDIV(ADIV,LOC)=$G(SDIV(ADIV,LOC))+TOT
"RTN","ECXAECQ",121,0)
 .....S STOT(LOC)=STOT(LOC)+TOT,GTOT=GTOT+TOT
"RTN","ECXAECQ",122,0)
 .....D:($Y+3>IOSL) HEADER Q:QFLG  W !,?25,P,?35,$E(PROCN,1,30),?68,$$RJ^XLFSTR(TOT,5," ")
"RTN","ECXAECQ",123,0)
 ....;write the unit subtotal
"RTN","ECXAECQ",124,0)
 ....D:($Y+4>IOSL) HEADER Q:QFLG
"RTN","ECXAECQ",125,0)
 ....W !,?25,$E(LN,1,54)
"RTN","ECXAECQ",126,0)
 ....W !,"Volume for "_UNITN_":",?68,$$RJ^XLFSTR(+$G(SDIV(ADIV,LOC)),5," "),!!
"RTN","ECXAECQ",127,0)
 .;write the division grandtotal
"RTN","ECXAECQ",128,0)
 .D:($Y+5>IOSL) HEADER Q:QFLG
"RTN","ECXAECQ",129,0)
 .W !!,"Total Volume for Audiology:",?68,$$RJ^XLFSTR(STOT("A"),5," ")
"RTN","ECXAECQ",130,0)
 .W !,"Total Volume for Speech Pathology:",?68,$$RJ^XLFSTR(STOT("S"),5," ")
"RTN","ECXAECQ",131,0)
 .W !!,"Grand Total for Site "_DIVNM_":",?68,$$RJ^XLFSTR(GTOT,5," ")
"RTN","ECXAECQ",132,0)
 ;print the audit descriptive narrative
"RTN","ECXAECQ",133,0)
 I $E(IOST)'="C" D
"RTN","ECXAECQ",134,0)
 .W @IOF S PG=PG+1
"RTN","ECXAECQ",135,0)
 .W !,ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report"
"RTN","ECXAECQ",136,0)
 .W !,"DSS Extract Log #:       "_ECXEXT
"RTN","ECXAECQ",137,0)
 .W !,"Date Range of Audit:     "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXAECQ",138,0)
 .W !,"Report Run Date/Time:    "_ECXRUN,?68,"Page: ",PG
"RTN","ECXAECQ",139,0)
 .W !!,LN,!!
"RTN","ECXAECQ",140,0)
 .S DIC="^ECX(727.1,",DA=ECXARRAY("DEF"),DR="1" D EN^DIQ
"RTN","ECXAECQ",141,0)
 I ($E(IOST)="C"),('QFLG) D
"RTN","ECXAECQ",142,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXAECQ",143,0)
 .S DIR(0)="E" W ! D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXAECQ",144,0)
 Q
"RTN","ECXAECQ",145,0)
 ;
"RTN","ECXAECQ",146,0)
HEADER ;header and page control
"RTN","ECXAECQ",147,0)
 N JJ,SS
"RTN","ECXAECQ",148,0)
 I ($E(IOST)="C"),('QFLG) D
"RTN","ECXAECQ",149,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXAECQ",150,0)
 .I PG>0 S DIR(0)="E" W ! D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXAECQ",151,0)
 Q:QFLG
"RTN","ECXAECQ",152,0)
 W:$Y!($E(IOST)="C") @IOF S PG=PG+1
"RTN","ECXAECQ",153,0)
 W !,ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report"
"RTN","ECXAECQ",154,0)
 W !,"DSS Extract Log #:    "_ECXARRAY("EXTRACT")
"RTN","ECXAECQ",155,0)
 W !,"Date Range of Audit:  "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXAECQ",156,0)
 W !,"Report Run Date/Time: "_ECXRUN
"RTN","ECXAECQ",157,0)
 W !,"QUASAR Site:         "_$P(ECXDIV(DIV),U,2)_"("_$P(ECXDIV(DIV),U,3)_")",?68,"Page: "_PG
"RTN","ECXAECQ",158,0)
 W !!,"DSS Unit",?25,"Procedure",?68,"Volume"
"RTN","ECXAECQ",159,0)
 W !,LN
"RTN","ECXAECQ",160,0)
 Q
"RTN","ECXQSR")
0^1^B44095677
"RTN","ECXQSR",1,0)
ECXQSR ;ALB/JAP,BIR/PTD-DSS QUASAR Extract ; 5/13/02 10:43am
"RTN","ECXQSR",2,0)
 ;;3.0;DSS EXTRACTS;**11,8,13,26,24,34,33,35,39,43**;Dec 22, 1997
"RTN","ECXQSR",3,0)
BEG ;entry point from option
"RTN","ECXQSR",4,0)
 I '$O(^ACK(509850.8,0)) W !,"You must be using the Quality Audiology & Speech Pathology",!,"Audit & Review (QUASAR) software to run this extract.",!! Q
"RTN","ECXQSR",5,0)
 I '$D(^ACK(509850.8,1,"DSS")) W !,"Linkage has not been established between QUASAR and the DSS UNIT file (#724).",!! Q
"RTN","ECXQSR",6,0)
 I '$O(^ACK(509850.6,0)) W !,"There is no data in the A&SP CLINIC VISIT file (#509850.6).",!! Q
"RTN","ECXQSR",7,0)
 D SETUP I ECFILE="" Q
"RTN","ECXQSR",8,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXQSR",9,0)
 Q
"RTN","ECXQSR",10,0)
 ;
"RTN","ECXQSR",11,0)
START ;entry point from tasked job
"RTN","ECXQSR",12,0)
 N ERR,ECXQDT
"RTN","ECXQSR",13,0)
 S QFLG=0,ECED=ECED+.9,ECD=ECSD1,ECXQV=""
"RTN","ECXQSR",14,0)
 D QINST I $D(ERR) Q
"RTN","ECXQSR",15,0)
 S ECL=+^ACK(509850.8,1,0),ECLINK=^ACK(509850.8,1,"DSS")
"RTN","ECXQSR",16,0)
 F  S ECD=$O(^ACK(509850.6,"B",ECD)),ECDA=0 Q:(ECD>ECED)!('ECD)!(QFLG)  D
"RTN","ECXQSR",17,0)
 .I +ECXQV=3,ECD<ECXQDT S ECXQV=2.0
"RTN","ECXQSR",18,0)
 .F  S ECDA=$O(^ACK(509850.6,"B",ECD,ECDA)) Q:'ECDA  D UPDATE Q:QFLG
"RTN","ECXQSR",19,0)
 Q
"RTN","ECXQSR",20,0)
 ;
"RTN","ECXQSR",21,0)
QINST ;Get installed information for QUASAR
"RTN","ECXQSR",22,0)
 N ARR,IENS,QVIEN,INTIEN
"RTN","ECXQSR",23,0)
 S ECXQDT=""
"RTN","ECXQSR",24,0)
 D FILE^DID(509850.6,,"VERSION","ARR","ERR")
"RTN","ECXQSR",25,0)
 S ECXQV=$G(ARR("VERSION")) I +ECXQV=0 S ERR=1 Q
"RTN","ECXQSR",26,0)
 S QVIEN=$$FIND1^DIC(9.4,"","X","QUASAR") I +QVIEN<1 S ERR=1 Q
"RTN","ECXQSR",27,0)
 S IENS=","_QVIEN_","
"RTN","ECXQSR",28,0)
 S INTIEN=$$FIND1^DIC(9.49,IENS,"X",ECXQV) I +INTIEN<1 S ERR=1 Q
"RTN","ECXQSR",29,0)
 S IENS=INTIEN_","_QVIEN,ECXQDT=$$GET1^DIQ(9.49,IENS,2,"I")
"RTN","ECXQSR",30,0)
 Q
"RTN","ECXQSR",31,0)
 ;
"RTN","ECXQSR",32,0)
UPDATE ;create record for each unique CPT code for clinic visit 
"RTN","ECXQSR",33,0)
 N ARY,ECZNODE,CPT,LOC,MOD,STR,VOL,XX,ECTP,ECV
"RTN","ECXQSR",34,0)
 Q:'$D(^ACK(509850.6,ECDA,0))
"RTN","ECXQSR",35,0)
 S ECZNODE=^ACK(509850.6,ECDA,0),EC2NODE=$G(^ACK(509850.6,ECDA,2))
"RTN","ECXQSR",36,0)
 S ECDT=$P(ECZNODE,U),ECDAY=$$ECXDATE^ECXUTL(ECDT,ECXYM)
"RTN","ECXQSR",37,0)
 S ECTIME=$$ECXTIME^ECXUTL(ECDT) S:$P(ECDT,".",2)="" ECTIME="000000"
"RTN","ECXQSR",38,0)
 S ECXDFN=$P(ECZNODE,U,2)
"RTN","ECXQSR",39,0)
 Q:'$$PATDEM^ECXUTL2(ECXDFN,ECD,"1;3;5")
"RTN","ECXQSR",40,0)
 S (ECHL,ECXDSSD)=""
"RTN","ECXQSR",41,0)
 S ECXDIV=$P($G(^ACK(509850.6,ECDA,5)),U),ECSTOP=$P(EC2NODE,U)
"RTN","ECXQSR",42,0)
 Q:ECSTOP=""
"RTN","ECXQSR",43,0)
 S (ECHLS,ECHL2S)="000",ECAC=$P($G(ECZNODE),U,6)
"RTN","ECXQSR",44,0)
 I ECAC D
"RTN","ECXQSR",45,0)
 .S ECHL=+$P($G(^SC(ECAC,0)),U,7),ECHL2=+$P($G(^(0)),U,18) I ECHL D
"RTN","ECXQSR",46,0)
 ..S ECHLS=$P($G(^DIC(40.7,+ECHL,0)),U,2)
"RTN","ECXQSR",47,0)
 ..S ECHL2S=$P($G(^DIC(40.7,+ECHL2,0)),U,2)
"RTN","ECXQSR",48,0)
 ..S ECHLS=$$RJ^XLFSTR(ECHLS,3,0),ECHL2S=$$RJ^XLFSTR(ECHL2S,3,0)
"RTN","ECXQSR",49,0)
 S ECDSS=ECHLS_ECHL2S
"RTN","ECXQSR",50,0)
 S ECDU=$S(ECSTOP["A":$P(ECLINK,U),ECSTOP["S":$P(ECLINK,U,2),1:"")
"RTN","ECXQSR",51,0)
 Q:'ECDU
"RTN","ECXQSR",52,0)
 S ECDSSU=$G(^ECD(ECDU,0)),ECCS=+$P(ECDSSU,U,4),(ECO,ECM)=+$P(ECDSSU,U,3)
"RTN","ECXQSR",53,0)
 Q:'$O(^ACK(509850.6,ECDA,3,0))
"RTN","ECXQSR",54,0)
 ;Create local array of procedure codes and # of times each procedure
"RTN","ECXQSR",55,0)
 ; was performed.
"RTN","ECXQSR",56,0)
 F I=1:1:4 S @("ECXICD9"_I)=""
"RTN","ECXQSR",57,0)
 S (ECDIA,ECXMST,ECXPPC,ECXPRV1,ECXPRV2,ECXPRV3,ECUN1NPI)=""
"RTN","ECXQSR",58,0)
 ;if QUASAR v2
"RTN","ECXQSR",59,0)
 I +ECXQV=2 D
"RTN","ECXQSR",60,0)
 .S ECXPRV1=$P(EC2NODE,U,7),ECXPRV2=$P(EC2NODE,U,3)
"RTN","ECXQSR",61,0)
 .S ECXPRV3=$P(EC2NODE,U,5),ECPN=0
"RTN","ECXQSR",62,0)
 .F  S ECPN=$O(^ACK(509850.6,ECDA,3,ECPN)) Q:'ECPN  D
"RTN","ECXQSR",63,0)
 ..S XX=^ACK(509850.6,ECDA,3,ECPN,0),XX=$P(XX,U)
"RTN","ECXQSR",64,0)
 ..S XX=$P($G(^ACK(509850.4,XX,0)),U),ECXCPT=$E($$CPT^ECXUTL3(XX),1,5)
"RTN","ECXQSR",65,0)
 ..I ECXCPT]"" D
"RTN","ECXQSR",66,0)
 ...I '$D(LOC(ECXCPT)) S LOC(ECXCPT)=0_U_ECXPRV1
"RTN","ECXQSR",67,0)
 ...S $P(LOC(ECXCPT),U)=$P(LOC(ECXCPT),U)+1
"RTN","ECXQSR",68,0)
 .S ECIEN=$O(^ACK(509850.6,ECDA,1,0))
"RTN","ECXQSR",69,0)
 .S ECDIA=$P($G(^ICD9(+$G(^ACK(509850.6,ECDA,1,ECIEN,0)),0)),U)
"RTN","ECXQSR",70,0)
 .F I=1:1:4 S ECIEN=$O(^ACK(509850.6,ECDA,1,ECIEN)) Q:'+ECIEN  D
"RTN","ECXQSR",71,0)
 ..S @("ECXICD9"_I)=$P($G(^ICD9(+$P(^ACK(509850.6,ECDA,1,ECIEN,0),U),0)),U)
"RTN","ECXQSR",72,0)
 ;if QUASAR v3
"RTN","ECXQSR",73,0)
 I +ECXQV=3 D
"RTN","ECXQSR",74,0)
 .N CPT,DIA,I,J,MOD,MOD1,P,STR,VOL,ECTP,ARY,ECP,ECPN
"RTN","ECXQSR",75,0)
 .S ECXMST=$P(EC2NODE,U,9),ECXMST=$S(ECXMST=1:"Y",ECXMST=0:"N",1:"")
"RTN","ECXQSR",76,0)
 .S ECXPRV2=$G(^ACK(509850.6,ECDA,2.7,1,0))
"RTN","ECXQSR",77,0)
 .S ECXPRV3=$G(^ACK(509850.6,ECDA,2.7,2,0))
"RTN","ECXQSR",78,0)
 .S ECPN=0
"RTN","ECXQSR",79,0)
 .F  S ECPN=$O(^ACK(509850.6,ECDA,3,ECPN)) Q:'ECPN  D
"RTN","ECXQSR",80,0)
 ..S CPT=^ACK(509850.6,ECDA,3,ECPN,0)
"RTN","ECXQSR",81,0)
 ..S ECXCPT=$P(CPT,U),ECTP=+$P(CPT,U,5),ECV=1,ECP=""
"RTN","ECXQSR",82,0)
 ..Q:ECXCPT=""
"RTN","ECXQSR",83,0)
 ..I ECTP D
"RTN","ECXQSR",84,0)
 ...S CPT=$G(^ACK(509850.6,ECDA,7,ECTP,0)),ECP=$P(CPT,U)
"RTN","ECXQSR",85,0)
 ...S ECP=$S(ECP<90000:$P($G(^EC(725,+ECP,0)),U,2)_"N",1:$P($G(^EC(725,+ECP,0)),U,2)_"L")
"RTN","ECXQSR",86,0)
 ...S VOL=+$P(CPT,U,2),ECXPRV1=$P(CPT,U,3)
"RTN","ECXQSR",87,0)
 ..I 'ECTP D
"RTN","ECXQSR",88,0)
 ...S VOL=+$P(CPT,U,3),ECXPRV1=$P(CPT,U,4)
"RTN","ECXQSR",89,0)
 ..S ECXCPT=$E($$CPT^ECXUTL3(ECXCPT),1,5)
"RTN","ECXQSR",90,0)
 ..S ECXMOD="",MOD=0
"RTN","ECXQSR",91,0)
 ..F  S MOD=$O(^ACK(509850.6,ECDA,3,ECPN,1,MOD)) Q:'MOD  D
"RTN","ECXQSR",92,0)
 ...S MOD1=+^ACK(509850.6,ECDA,3,ECPN,1,MOD,0) D:MOD1
"RTN","ECXQSR",93,0)
 ....S ECXMOD=ECXMOD_MOD1_";"
"RTN","ECXQSR",94,0)
 ..F I=1:1:$L(ECXMOD,";") I $G(ARY(ECXCPT))'[$P(ECXMOD,";",I) D
"RTN","ECXQSR",95,0)
 ...S ARY(ECXCPT)=$G(ARY(ECXCPT))_$P(ECXMOD,";",I)_";"
"RTN","ECXQSR",96,0)
 ..S:VOL ECV=VOL
"RTN","ECXQSR",97,0)
 ..S ECV=ECV+$G(LOC(ECXCPT))
"RTN","ECXQSR",98,0)
 ..S LOC(ECXCPT)=ECV_U_ECXPRV1_U_ECP
"RTN","ECXQSR",99,0)
 .S ECIEN=0
"RTN","ECXQSR",100,0)
 .F  S ECIEN=$O(^ACK(509850.6,ECDA,1,ECIEN)) Q:'ECIEN  D
"RTN","ECXQSR",101,0)
 ..S DIA=^ACK(509850.6,ECDA,1,ECIEN,0)
"RTN","ECXQSR",102,0)
 ..S P=$P(DIA,U,2),P=$S(P=1:"P",1:"S"),CNT=$G(STR(P))+1
"RTN","ECXQSR",103,0)
 ..S STR(P,CNT)=$P($G(^ICD9(+DIA,0)),U),STR(P)=CNT
"RTN","ECXQSR",104,0)
 .S ECDIA=$G(STR("P",1))
"RTN","ECXQSR",105,0)
 .F I=1:1:4 Q:'$D(STR("P",I+1))  S @("ECXICD9"_I)=STR("P",I)
"RTN","ECXQSR",106,0)
 .S:ECDIA="" ECDIA=$G(STR("S",1)),I=2
"RTN","ECXQSR",107,0)
 .F J=I:1:4 Q:'$D(STR("S",J))  S @("ECXICD9"_J)=STR("S",J)
"RTN","ECXQSR",108,0)
 Q:('$D(LOC))!('$O(^ACK(509850.6,ECDA,1,0)))
"RTN","ECXQSR",109,0)
 ;
"RTN","ECXQSR",110,0)
 ;- Ord Div, Contrct St/End Dates, Contrct Type placeholders for FY2002
"RTN","ECXQSR",111,0)
 S (ECXODIV,ECXCSDT,ECXCEDT,ECXCTYP)=""
"RTN","ECXQSR",112,0)
 ;set up Provider Person class
"RTN","ECXQSR",113,0)
 S (ECXCPT,ECXPPC1,ECXPPC2,ECXPPC3)=""
"RTN","ECXQSR",114,0)
 S:ECXPRV2'="" ECXPPC2=$$PRVCLASS^ECXUTL(ECXPRV2,ECD),ECXPRV2=2_ECXPRV2
"RTN","ECXQSR",115,0)
 S:ECXPRV3'="" ECXPPC3=$$PRVCLASS^ECXUTL(ECXPRV3,ECD),ECXPRV3=2_ECXPRV3
"RTN","ECXQSR",116,0)
 ;
"RTN","ECXQSR",117,0)
 ;- Observation Patient Indicator (yes/no)
"RTN","ECXQSR",118,0)
 S ECXOBS=$$OBSPAT^ECXUTL4(ECXA,ECXTS,ECDSS)
"RTN","ECXQSR",119,0)
 ;
"RTN","ECXQSR",120,0)
 ;- CNH status (YES/NO)
"RTN","ECXQSR",121,0)
 S ECXCNH=$$CNHSTAT^ECXUTL4(ECXDFN)
"RTN","ECXQSR",122,0)
 ;
"RTN","ECXQSR",123,0)
 ;- If no encounter number don't file record
"RTN","ECXQSR",124,0)
 S ECXENC=$$ENCNUM^ECXUTL4(ECXA,ECXSSN,ECXADMDT,ECDT,ECXTS,ECXOBS,ECHEAD,ECDSS,)
"RTN","ECXQSR",125,0)
 Q:ECXENC=""
"RTN","ECXQSR",126,0)
 ;Loop through array of unique procedures. Create record in ECODE.
"RTN","ECXQSR",127,0)
 S CPT=""
"RTN","ECXQSR",128,0)
 F  S CPT=$O(LOC(CPT)) Q:CPT=""  D
"RTN","ECXQSR",129,0)
 .S ECV=+$P(LOC(CPT),U),ECXCPT=$$CPT^ECXUTL3(CPT,$G(ARY(CPT)),ECV)
"RTN","ECXQSR",130,0)
 .S ECXPRV1=$P(LOC(CPT),U,2)
"RTN","ECXQSR",131,0)
 .S:ECXPRV1'="" ECXPPC1=$$PRVCLASS^ECXUTL(ECXPRV1,ECD),ECXPRV1=2_ECXPRV1
"RTN","ECXQSR",132,0)
 .S ECP=$P(LOC(CPT),U,3) I ECP="" S ECP=$$CPT^ECXUTL3(CPT,"",ECV)
"RTN","ECXQSR",133,0)
 .D FILE
"RTN","ECXQSR",134,0)
 K CPT,LOC
"RTN","ECXQSR",135,0)
 Q
"RTN","ECXQSR",136,0)
 ;
"RTN","ECXQSR",137,0)
FILE ;file record in #727.825
"RTN","ECXQSR",138,0)
 ;node0
"RTN","ECXQSR",139,0)
 ;inst^dfn ECXDFN^ssn ECXSSN^name ECXPNM^i/o status ECXA^
"RTN","ECXQSR",140,0)
 ;day ECDAY^DSS unit ECDU^^
"RTN","ECXQSR",141,0)
 ;category ECPTTM^procedure ECP^volume ECV^
"RTN","ECXQSR",142,0)
 ;cost center ^ordering sec ^section^
"RTN","ECXQSR",143,0)
 ;provider ECXPRV1^ECXPPC1^ECXPRV2^ECXPPC2^ECXPRV3^ECXPPC3^
"RTN","ECXQSR",144,0)
 ;mov # ECXMN^treat spec ECXTS^time ECTIME^
"RTN","ECXQSR",145,0)
 ;primary care team ECPTTM^
"RTN","ECXQSR",146,0)
 ;primary care provider ECPTPR^pce cpt code & modifers ECXCPT^
"RTN","ECXQSR",147,0)
 ;primary icd-9 code ECDIA^secondary icd-9 #1 ECXICD91^
"RTN","ECXQSR",148,0)
 ;secondary icd-9 #2 ECXICD92^secondary icd-9 #3 ECXICD93^
"RTN","ECXQSR",149,0)
 ;secondary icd-9 #4 ECXICD94^agent orange ECXAST^
"RTN","ECXQSR",150,0)
 ;radiation exposure ECRE^
"RTN","ECXQSR",151,0)
 ;environmental contaminants ECENV^
"RTN","ECXQSR",152,0)
 ;service connected ECSC^sent to pce^^dss identifier ECDSS^placeholder
"RTN","ECXQSR",153,0)
 ;node1
"RTN","ECXQSR",154,0)
 ;mpi ECXNPI^dss dept ECXDSSD^provider npi ECUN1NPI^^^
"RTN","ECXQSR",155,0)
 ;pc prov person class ECPTNPI^assoc pc provider ECASPR^
"RTN","ECXQSR",156,0)
 ;assoc pc prov person class ECCLAS2^assoc pc provider npi ECASNPI^
"RTN","ECXQSR",157,0)
 ;divison ECXDIV^dom ECXDOM^enrollment category ECXCAT^
"RTN","ECXQSR",158,0)
 ;enrollment status ECXSTAT^enrollment priority ECXPRIOR^
"RTN","ECXQSR",159,0)
 ;period of service ECXPOS^purple heart ECXPHI^observ pat ind ECXOBS^
"RTN","ECXQSR",160,0)
 ;encounter num ECXENC^ao loc ECXAOL^ord div ECXODIV^contr st dt ECXCSDT^
"RTN","ECXQSR",161,0)
 ;contr end dt ECXCEDT^contr typ ECXCTYP^CNH stat ECXCNH
"RTN","ECXQSR",162,0)
 N DA,DIK
"RTN","ECXQSR",163,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXQSR",164,0)
 S ECODE=EC7_U_EC23_U
"RTN","ECXQSR",165,0)
 S ECODE=ECODE_ECL_U_ECXDFN_U_ECXSSN_U_ECXPNM_U_ECXA_U_ECDAY_U_ECDU_U_U
"RTN","ECXQSR",166,0)
 S ECODE=ECODE_ECP_U_ECV_U_ECCS_U_ECO_U_ECM_U_ECXPRV1_U_ECXPPC1_U
"RTN","ECXQSR",167,0)
 S ECODE=ECODE_ECXPRV2_U_ECXPPC2_U_ECXPRV3_U_ECXPPC3_U_U
"RTN","ECXQSR",168,0)
 S ECODE=ECODE_ECXMN_U_ECXTS_U_ECTIME_U_ECPTTM_U
"RTN","ECXQSR",169,0)
 S ECODE=ECODE_ECPTPR_U_ECXCPT_U_ECDIA_U_ECXICD91_U_ECXICD92_U
"RTN","ECXQSR",170,0)
 S ECODE=ECODE_ECXICD93_U_ECXICD94_U_ECXAST_U_ECXRST_U_ECXEST_U
"RTN","ECXQSR",171,0)
 S ECODE=ECODE_ECSC_U_"N"_U_U_ECDSS_U_U
"RTN","ECXQSR",172,0)
 S ECODE1=ECXMPI_U_ECXDSSD_U_ECUN1NPI_U_U_U_ECCLAS_U_ECPTNPI_U_ECASPR_U
"RTN","ECXQSR",173,0)
 S ECODE1=ECODE1_ECCLAS2_U_ECASNPI_U_ECXDIV_U_ECXMST_U_ECXDOM_U
"RTN","ECXQSR",174,0)
 S ECODE1=ECODE1_ECXDOB_U_ECXCAT_U_ECXSTAT_U_ECXPRIOR_U_ECXPOS_U_ECXPHI_U
"RTN","ECXQSR",175,0)
 S ECODE1=ECODE1_ECXOBS_U_ECXENC_U_ECXAOL_U_ECXODIV_U_ECXCSDT_U_ECXCEDT_U
"RTN","ECXQSR",176,0)
 S ECODE1=ECODE1_ECXCTYP_U_ECXCNH
"RTN","ECXQSR",177,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,ECRN=ECRN+1
"RTN","ECXQSR",178,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX1^DIK K DIK,DA
"RTN","ECXQSR",179,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD
"RTN","ECXQSR",180,0)
 Q
"RTN","ECXQSR",181,0)
 ;
"RTN","ECXQSR",182,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXQSR",183,0)
 S ECHEAD="ECQ"
"RTN","ECXQSR",184,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXQSR",185,0)
 Q
"RTN","ECXQSR",186,0)
 ;
"RTN","ECXQSR",187,0)
QUE ;Entry point for the background requeuing handled by ECXTAUTO.
"RTN","ECXQSR",188,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"VER")
8.0^22.0
"^DD",727.815,727.815,11,0)
PROCEDURE^F^^0;12^K:$L(X)>8!($L(X)<5) X
"^DD",727.815,727.815,11,.1)
Procedure
"^DD",727.815,727.815,11,3)
Answer must be 5-8 characters in length.
"^DD",727.815,727.815,11,21,0)
1^.001^2^2^3020425^^^^
"^DD",727.815,727.815,11,21,1,0)
This field contains the name of the procedure selected
"^DD",727.815,727.815,11,21,2,0)
for this extract record.
"^DD",727.815,727.815,11,23,0)
^.001^8^8^3020425^^
"^DD",727.815,727.815,11,23,1,0)
The procedure pointer is pulled from the PROCEDURE field (8) in the EVENT
"^DD",727.815,727.815,11,23,2,0)
CAPTURE PATIENT file (#721).  For CPT codes from the CPT file (#81), it is
"^DD",727.815,727.815,11,23,3,0)
the CPT code (.01)_volume.  Volume is pulled from the VOLUME field (9) in
"^DD",727.815,727.815,11,23,4,0)
the EVENT CAPTURE PATIENT file (#721) and is padded to the left with
"^DD",727.815,727.815,11,23,5,0)
zeros.  For national procedures from the EC NATIONAL PROCEDURE file
"^DD",727.815,727.815,11,23,6,0)
(#725), it is the NATIONAL NUMBER field (1)_"N". For local procedures from
"^DD",727.815,727.815,11,23,7,0)
the EC NATIONAL PROCEDURE file (#725), it is the NATIONAL NUMBER field
"^DD",727.815,727.815,11,23,8,0)
(1)_"L".
"^DD",727.815,727.815,11,"DT")
2971030
"^DD",727.825,727.825,11,0)
PROCEDURE^F^^0;12^K:$L(X)>8!($L(X)<5) X
"^DD",727.825,727.825,11,.1)
Procedure
"^DD",727.825,727.825,11,3)
Answer must be 5-8 characters in length.
"^DD",727.825,727.825,11,21,0)
1^.001^2^2^3020424^^^^
"^DD",727.825,727.825,11,21,1,0)
This field contains the name of the procedure selected
"^DD",727.825,727.825,11,21,2,0)
for this extract record.
"^DD",727.825,727.825,11,23,0)
^.001^12^12^3020424^^
"^DD",727.825,727.825,11,23,1,0)
For divisions using CPT codes, the procedure pointer is pulled from the
"^DD",727.825,727.825,11,23,2,0)
PROCEDURE CODE field (.01) of the PROCEDURE CODE multiple (10) of the A&SP
"^DD",727.825,727.825,11,23,3,0)
CLINIC VISIT file (#509850.6).  The CPT CODE (.01) from the CPT file (#81)
"^DD",727.825,727.825,11,23,4,0)
is concatenated with the volume (2 digits padded to the right with zeros).
"^DD",727.825,727.825,11,23,5,0)
Volume is pulled from the VOLUME field (.03) of the PROCEDURE CODE
"^DD",727.825,727.825,11,23,6,0)
multiple (10) of the A&SP CLINIC VISIT file (#509850.6).
"^DD",727.825,727.825,11,23,7,0)
 
"^DD",727.825,727.825,11,23,8,0)
For divisions using Event Capture Procedure codes, the procedure pointer
"^DD",727.825,727.825,11,23,9,0)
is pulled from the EVENT CAPTURE PROCEDURE field (.01) of the EVENT
"^DD",727.825,727.825,11,23,10,0)
CAPTURE PROECEDURE multiple (15) of the A&SP CLINIC VISIT file
"^DD",727.825,727.825,11,23,11,0)
(#509850.6). The NATIONAL NUMBER (1) from the EC NATIONAL PROCEDURE file
"^DD",727.825,727.825,11,23,12,0)
(#725) is concatenated with "N" for national codes or "L" for local codes.
"^DD",727.825,727.825,11,"DT")
2971030
**END**
**END**
