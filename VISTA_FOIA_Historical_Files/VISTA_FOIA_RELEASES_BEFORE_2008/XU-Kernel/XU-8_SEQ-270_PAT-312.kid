Released XU*8*312 SEQ #270
Extracted from mail message
**KIDS**:XU*8.0*312^

**INSTALL NAME**
XU*8.0*312
"BLD",750,0)
XU*8.0*312^KERNEL^0^3031009^y
"BLD",750,1,0)
^^2^2^3030703^^
"BLD",750,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",750,1,2,0)
Patch XU*8*312.
"BLD",750,4,0)
^9.64PA^^
"BLD",750,"KRN",0)
^9.67PA^8989.52^19
"BLD",750,"KRN",.4,0)
.4
"BLD",750,"KRN",.401,0)
.401
"BLD",750,"KRN",.402,0)
.402
"BLD",750,"KRN",.403,0)
.403
"BLD",750,"KRN",.5,0)
.5
"BLD",750,"KRN",.84,0)
.84
"BLD",750,"KRN",3.6,0)
3.6
"BLD",750,"KRN",3.8,0)
3.8
"BLD",750,"KRN",9.2,0)
9.2
"BLD",750,"KRN",9.8,0)
9.8
"BLD",750,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",750,"KRN",9.8,"NM",1,0)
XQ82^^0^B6919718
"BLD",750,"KRN",9.8,"NM",2,0)
XUS6^^0^B1259933
"BLD",750,"KRN",9.8,"NM",3,0)
XUSPURGE^^0^B7738964
"BLD",750,"KRN",9.8,"NM","B","XQ82",1)

"BLD",750,"KRN",9.8,"NM","B","XUS6",2)

"BLD",750,"KRN",9.8,"NM","B","XUSPURGE",3)

"BLD",750,"KRN",19,0)
19
"BLD",750,"KRN",19.1,0)
19.1
"BLD",750,"KRN",101,0)
101
"BLD",750,"KRN",409.61,0)
409.61
"BLD",750,"KRN",771,0)
771
"BLD",750,"KRN",870,0)
870
"BLD",750,"KRN",8989.51,0)
8989.51
"BLD",750,"KRN",8989.52,0)
8989.52
"BLD",750,"KRN",8994,0)
8994
"BLD",750,"KRN","B",.4,.4)

"BLD",750,"KRN","B",.401,.401)

"BLD",750,"KRN","B",.402,.402)

"BLD",750,"KRN","B",.403,.403)

"BLD",750,"KRN","B",.5,.5)

"BLD",750,"KRN","B",.84,.84)

"BLD",750,"KRN","B",3.6,3.6)

"BLD",750,"KRN","B",3.8,3.8)

"BLD",750,"KRN","B",9.2,9.2)

"BLD",750,"KRN","B",9.8,9.8)

"BLD",750,"KRN","B",19,19)

"BLD",750,"KRN","B",19.1,19.1)

"BLD",750,"KRN","B",101,101)

"BLD",750,"KRN","B",409.61,409.61)

"BLD",750,"KRN","B",771,771)

"BLD",750,"KRN","B",870,870)

"BLD",750,"KRN","B",8989.51,8989.51)

"BLD",750,"KRN","B",8989.52,8989.52)

"BLD",750,"KRN","B",8994,8994)

"BLD",750,"QUES",0)
^9.62^^
"BLD",750,"REQB",0)
^9.611^2^2
"BLD",750,"REQB",1,0)
XU*8.0*258^2
"BLD",750,"REQB",2,0)
XU*8.0*180^2
"BLD",750,"REQB","B","XU*8.0*180",2)

"BLD",750,"REQB","B","XU*8.0*258",1)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^2950703^2970507^.5
"PKG",3,22,1,"PAH",1,0)
312^3031009
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3031009
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
Patch XU*8*312.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","XQ82")
0^1^B6919718
"RTN","XQ82",1,0)
XQ82 ;SF-ISC.SEA/JLI - CLEAN OLD $JOB DATA OUT OF XUTL("XQ", & OTHERS ;08/27/2003  15:42
"RTN","XQ82",2,0)
 ;;8.0;KERNEL;**59,67,157,258,312**;Jul 10, 1995
"RTN","XQ82",3,0)
 S DDATE=$$HTFM^XLFDT($H-7) ;Get seven days ago in FM format
"RTN","XQ82",4,0)
 ;Do work as a set of sub routines
"RTN","XQ82",5,0)
 D L0,L1,L2,L3,L4,L5,L6
"RTN","XQ82",6,0)
EXIT ;
"RTN","XQ82",7,0)
 K A,X,%DT,Y,J,K,DDATE
"RTN","XQ82",8,0)
 Q
"RTN","XQ82",9,0)
 ;For any entry in user stack w/ date older than 7 days or w/o zero node
"RTN","XQ82",10,0)
 ;kill XUTL("XQ",n) and corresponding UTILITY(n) and TMP(n) nodes.
"RTN","XQ82",11,0)
L0 F J=0:0 S J=$O(^XUTL("XQ",J)) Q:J'>0  I $S('$D(^(J,0)):1,1:^(0)<DDATE) D
"RTN","XQ82",12,0)
 . I $D(^XUTL("XQ",J,"ZTSKNUM")) L +^%ZTSCH("TASK",^XUTL("XQ",J,"ZTSKNUM")):0 Q:'$T  L -^%ZTSCH("TASK",^XUTL("XQ",J,"ZTSKNUM"))
"RTN","XQ82",13,0)
 . K ^XUTL("XQ",J),^UTILITY(J),^TMP(J)
"RTN","XQ82",14,0)
 . Q
"RTN","XQ82",15,0)
 Q
"RTN","XQ82",16,0)
 ;
"RTN","XQ82",17,0)
 ;Loop thru UTILITY and look for nodes w/o corresponding XUTL("XQ",n)
"RTN","XQ82",18,0)
L1 S A="" F  S A=$O(^UTILITY(A)) Q:A=""  D
"RTN","XQ82",19,0)
 . I A>0,'$D(^XUTL("XQ",A)) K ^UTILITY(A) Q  ;UTILITY($J) w/o XUTL("XQ",$J) node.
"RTN","XQ82",20,0)
 . Q:A>0  Q:"^ROU^GLO^LRLTR^"[("^"_A_"^")
"RTN","XQ82",21,0)
 . F J=0:0 S J=$O(^UTILITY(A,J)) Q:J'>0  I '$D(^XUTL("XQ",J)) K ^UTILITY(A,J) ;Remove UTILITY(namespace,$J) w/o XUTL("XQ",$J)
"RTN","XQ82",22,0)
 . Q
"RTN","XQ82",23,0)
 Q
"RTN","XQ82",24,0)
 ;
"RTN","XQ82",25,0)
 ;Loop thru TMP and look for nodes w/o corresponding XUTL("XQ",n)
"RTN","XQ82",26,0)
L2 S A="" F  S A=$O(^TMP(A)) Q:A=""  D
"RTN","XQ82",27,0)
 . I A>0,'$D(^XUTL("XQ",A)) K ^TMP(A) Q  ;TMP($J) w/o XUTL("XQ",$J) node.
"RTN","XQ82",28,0)
 . Q:A>0  ;Q:"^ROU^GLO^LRLTR^"[("^"_A_"^")
"RTN","XQ82",29,0)
 . F J=0:0 S J=$O(^TMP(A,J)) Q:J'>0  I '$D(^XUTL("XQ",J)) K ^TMP(A,J) ;Remove TMP(namespace,$J) w/o XUTL("XQ",$J)
"RTN","XQ82",30,0)
 . Q
"RTN","XQ82",31,0)
 Q
"RTN","XQ82",32,0)
 ;
"RTN","XQ82",33,0)
L3 ;Now to cleanup the XTMP global w/ XTMP(namespace,0)<DT
"RTN","XQ82",34,0)
 S A="" F  S A=$O(^XTMP(A)) Q:A=""  S J=$G(^XTMP(A,0)) I J<DT K ^XTMP(A)
"RTN","XQ82",35,0)
 Q
"RTN","XQ82",36,0)
 ;
"RTN","XQ82",37,0)
L4 ;Now go thru and clean old ^XUSEC(0,"CUR",duz,sign-on) nodes.
"RTN","XQ82",38,0)
 D L51("CUR")
"RTN","XQ82",39,0)
 Q
"RTN","XQ82",40,0)
 ;
"RTN","XQ82",41,0)
L5 ;Now go through and clean old ^XUSEC(0,"AS*" nodes.
"RTN","XQ82",42,0)
 D L51("AS1"),L51("AS2")
"RTN","XQ82",43,0)
 Q
"RTN","XQ82",44,0)
 ;
"RTN","XQ82",45,0)
L6 ;Clean out old build nodes from ^XUTL
"RTN","XQ82",46,0)
 S K=""
"RTN","XQ82",47,0)
 F  S K=$O(^XUTL("XQO",K)) Q:K=""  D
"RTN","XQ82",48,0)
 . I $D(^XUTL("XQO",K,"^BUILD")),($P($H,",",2)-^("^BUILD")>1800)!(^("^BUILD")>$P($H,",",2)) K ^("^BUILD")
"RTN","XQ82",49,0)
 Q
"RTN","XQ82",50,0)
 ;
"RTN","XQ82",51,0)
L51(NDX) ;Clean old Sign-on log entries from X-ref
"RTN","XQ82",52,0)
 N I,J,FDA,NOW,ERR,IEN
"RTN","XQ82",53,0)
 S I="",NOW=$$NOW^XLFDT
"RTN","XQ82",54,0)
 F  S I=$O(^XUSEC(0,NDX,I)) Q:I=""  F J=0:0 S J=$O(^XUSEC(0,NDX,I,J)) Q:(J'>0)  D
"RTN","XQ82",55,0)
 . ;Look at every entry in the X-ref, check for data record
"RTN","XQ82",56,0)
 . I $D(^XUSEC(0,J,0))[0 K ^XUSEC(0,NDX,I,J) Q  ;No data record.
"RTN","XQ82",57,0)
 . Q:J'<DDATE  ;Keep for now
"RTN","XQ82",58,0)
 . S FDA(3.081,J_",",3)=NOW,FDA(3.081,J_",",16)=1 D UPDATE^DIE("","FDA","IEN","ERR")
"RTN","XQ82",59,0)
 . K FDA,IEN,ERR
"RTN","XQ82",60,0)
 . Q
"RTN","XQ82",61,0)
 Q
"RTN","XUS6")
0^2^B1259933
"RTN","XUS6",1,0)
XUS6 ;ISCSF/RWF - Clear users at startup. ;06/17/2003  13:18
"RTN","XUS6",2,0)
 ;;8.0;KERNEL;**258,312**;Jul 10, 1995
"RTN","XUS6",3,0)
 I '$D(ZTQUEUED) W !,"This is only to be run by taskman at startup." Q
"RTN","XUS6",4,0)
A ;
"RTN","XUS6",5,0)
 N I,J,NOW,FDA,IEN,ERR S I=0,NOW=$$NOW^XLFDT
"RTN","XUS6",6,0)
 F  S I=$O(^XUSEC(0,"CUR",I)),J=0 Q:I'>0  F  S J=$O(^XUSEC(0,"CUR",I,J)) Q:J'>0  D
"RTN","XUS6",7,0)
 . I $D(^XUSEC(0,J,0))[0 K ^XUSEC(0,"CUR",I,J) Q  ;No data record.
"RTN","XUS6",8,0)
 . S FDA(3.081,J_",",3)=NOW,FDA(3.081,J_",",16)=1 D UPDATE^DIE("","FDA","IEN","ERR")
"RTN","XUS6",9,0)
 . K FDA,IEN,ERR
"RTN","XUS6",10,0)
 . Q
"RTN","XUS6",11,0)
 ;Clear the signed on flag.
"RTN","XUS6",12,0)
 F I=0:0 S I=$O(^VA(200,I)) Q:I'>0  I $P($G(^VA(200,I,1.1)),U,3) S $P(^VA(200,I,1.1),U,3)=0
"RTN","XUS6",13,0)
 Q
"RTN","XUSPURGE")
0^3^B7738964
"RTN","XUSPURGE",1,0)
XUSPURGE ;SFISC/STAFF - PURGE ROUTINE FOR XUSEC ;08/27/2003  15:26
"RTN","XUSPURGE",2,0)
 ;;8.0;KERNEL;**180,312**;Jul 10, 1995
"RTN","XUSPURGE",3,0)
SCPURG ;Purge sign-on log to 30 days
"RTN","XUSPURGE",4,0)
 N XU1,XU2,XUDT,DIK,DA
"RTN","XUSPURGE",5,0)
 S XUDT=$$FMADD^XLFDT(DT,-30) ;Set the limit
"RTN","XUSPURGE",6,0)
 I $O(^XUSEC(0,0))'>0 G SCEXIT
"RTN","XUSPURGE",7,0)
 S DIK="^XUSEC(0,"
"RTN","XUSPURGE",8,0)
 F DA=0:0 S DA=$O(^XUSEC(0,DA)) Q:(DA'>0)!(DA>XUDT)  D
"RTN","XUSPURGE",9,0)
 . S XU1=+$G(^XUSEC(0,DA,0))
"RTN","XUSPURGE",10,0)
 . D ^DIK
"RTN","XUSPURGE",11,0)
 . ;Make sure the CUR X-ref is cleared.
"RTN","XUSPURGE",12,0)
 . I XU1 K ^XUSEC(0,"CUR",XU1,DA)
"RTN","XUSPURGE",13,0)
 . Q
"RTN","XUSPURGE",14,0)
SCEXIT K DIK,DA,XUDT,X1,X2
"RTN","XUSPURGE",15,0)
 Q
"RTN","XUSPURGE",16,0)
 ;
"RTN","XUSPURGE",17,0)
AOLD ;
"RTN","XUSPURGE",18,0)
 N DIRUT,DIR,XUT,XUDAYS,XUDT,XUI,XUJ,XUK,X
"RTN","XUSPURGE",19,0)
 I $D(ZTQUEUED) D  Q
"RTN","XUSPURGE",20,0)
 . S X=$G(ZTQPARAM),X=$S(X<270:270,1:X) D A02(X),V02(X)
"RTN","XUSPURGE",21,0)
 . Q
"RTN","XUSPURGE",22,0)
 W !!,"This option will purge the log of inactive access and verify codes ",!,"older than the date specified to allow for their re-use."
"RTN","XUSPURGE",23,0)
 S DIR("A")="Do you wish to continue",DIR(0)="Y",DIR("B")="NO" D ^DIR G:$D(DIRUT)!(Y'=1) ENDA
"RTN","XUSPURGE",24,0)
DAYS K DIR S DIR("A")="How far back do you wish to retain codes",DIR("A",1)="VHA has set the minimum time to keep old codes at 270 days.",DIR("B")=270
"RTN","XUSPURGE",25,0)
 S DIR("?")="Enter the number of days indicating at what date codes should be purged.",DIR(0)="N^270:400"
"RTN","XUSPURGE",26,0)
 D ^DIR Q:$D(DIRUT)
"RTN","XUSPURGE",27,0)
 D A02(X),V02(X)
"RTN","XUSPURGE",28,0)
 Q
"RTN","XUSPURGE",29,0)
 ;
"RTN","XUSPURGE",30,0)
A02(XUDAYS) ;Purge old Access codes in the AOLD x-ref.
"RTN","XUSPURGE",31,0)
 N XUT,XUI,XUJ,XUK,XUDT
"RTN","XUSPURGE",32,0)
 S XUT=0,XUDT=$H-XUDAYS,XUI=""
"RTN","XUSPURGE",33,0)
 F  S XUI=$O(^VA(200,"AOLD",XUI)) Q:XUI=""  S XUJ=$O(^(XUI,0)) S XUK=^(XUJ) I XUK<XUDT K ^VA(200,"AOLD",XUI,XUJ) S XUT=XUT+1 W:'$D(ZTQUEUED) "."
"RTN","XUSPURGE",34,0)
 I '$D(ZTQUEUED) W !!,$S('XUT:"No",1:XUT)," old access codes have been purged."
"RTN","XUSPURGE",35,0)
 Q
"RTN","XUSPURGE",36,0)
 ;
"RTN","XUSPURGE",37,0)
V02(XUDAYS) ;Purge old Verify code from each users VOLD x-ref
"RTN","XUSPURGE",38,0)
 N XUT,XUI,XUJ,XUK,XUDT
"RTN","XUSPURGE",39,0)
 S XUT=0,XUDT=$H-XUDAYS,XUI=0
"RTN","XUSPURGE",40,0)
 F  S XUI=$O(^VA(200,XUI)) Q:XUI'>0  S XUK="" D
"RTN","XUSPURGE",41,0)
 . F  S XUK=$O(^VA(200,XUI,"VOLD",XUK)) Q:XUK=""  I ^(XUK)<XUDT K ^VA(200,XUI,"VOLD",XUK) S XUT=XUT+1 W:'$D(ZTQUEUED) "."
"RTN","XUSPURGE",42,0)
 I '$D(ZTQUEUED) W !!,$S('XUT:"No",1:XUT)," old verify codes have been purged."
"RTN","XUSPURGE",43,0)
 Q
"RTN","XUSPURGE",44,0)
ENDA K DIRUT,DIR,XUT,XUDAYS,XUDT,XUI,XUJ,XUK
"RTN","XUSPURGE",45,0)
 Q
"VER")
8.0^22.0
**END**
**END**
