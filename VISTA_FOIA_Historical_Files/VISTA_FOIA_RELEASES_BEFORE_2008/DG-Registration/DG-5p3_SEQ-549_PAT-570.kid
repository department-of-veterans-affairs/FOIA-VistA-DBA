Released DG*5.3*570 SEQ #549
Extracted from mail message
**KIDS**:DG*5.3*570^

**INSTALL NAME**
DG*5.3*570
"BLD",5741,0)
DG*5.3*570^REGISTRATION^0^3050105^y
"BLD",5741,1,0)
^^13^13^3040616^
"BLD",5741,1,1,0)
This patch is in support of the Billing Replacement - Encapsulation 
"BLD",5741,1,2,0)
Project.  The objective of this project is to standardize existing VistA 
"BLD",5741,1,3,0)
Integrated Billing and Accounts Receivable functionality so that a new 
"BLD",5741,1,4,0)
COTS billing/AR product may be effectively integrated into the VistA 
"BLD",5741,1,5,0)
suite. This will be accomplished by replacing direct IB and AR touch 
"BLD",5741,1,6,0)
points with standard authorized API's available to all VistA packages. 
"BLD",5741,1,7,0)
 
"BLD",5741,1,8,0)
This patch will replace all current direct access of Insurance 
"BLD",5741,1,9,0)
Information in the VistA Registration package with a new API call.  Code 
"BLD",5741,1,10,0)
which had been retrieving insurance information from either the INSURANCE 
"BLD",5741,1,11,0)
File (#36) or the INSURANCE TYPE sub-file (#2.312) of the PATIENT File 
"BLD",5741,1,12,0)
(#2), has been modified to use the $$INSUR^IBBAPI API call originally 
"BLD",5741,1,13,0)
released with patch IB*2*256, IB INSURANCE API.
"BLD",5741,4,0)
^9.64PA^^
"BLD",5741,"KRN",0)
^9.67PA^8989.52^19
"BLD",5741,"KRN",.4,0)
.4
"BLD",5741,"KRN",.401,0)
.401
"BLD",5741,"KRN",.402,0)
.402
"BLD",5741,"KRN",.403,0)
.403
"BLD",5741,"KRN",.5,0)
.5
"BLD",5741,"KRN",.84,0)
.84
"BLD",5741,"KRN",3.6,0)
3.6
"BLD",5741,"KRN",3.8,0)
3.8
"BLD",5741,"KRN",9.2,0)
9.2
"BLD",5741,"KRN",9.8,0)
9.8
"BLD",5741,"KRN",9.8,"NM",0)
^9.68A^24^16
"BLD",5741,"KRN",9.8,"NM",7,0)
DG1010P5^^0^B13853039
"BLD",5741,"KRN",9.8,"NM",10,0)
DG1010PA^^0^B16915740
"BLD",5741,"KRN",9.8,"NM",11,0)
DG3PR0^^0^B14612597
"BLD",5741,"KRN",9.8,"NM",12,0)
DG3PR1^^0^B5219961
"BLD",5741,"KRN",9.8,"NM",13,0)
DG3PR2^^0^B16655720
"BLD",5741,"KRN",9.8,"NM",14,0)
DGBLRV^^0^B20450982
"BLD",5741,"KRN",9.8,"NM",15,0)
DGPMVBUR^^0^B14242436
"BLD",5741,"KRN",9.8,"NM",16,0)
DGRPTP2^^0^B11418526
"BLD",5741,"KRN",9.8,"NM",17,0)
DGRP1^^0^B22054109
"BLD",5741,"KRN",9.8,"NM",18,0)
DGRP5^^0^B2663401
"BLD",5741,"KRN",9.8,"NM",19,0)
DGRPDB^^0^B12888917
"BLD",5741,"KRN",9.8,"NM",20,0)
DGUTL^^0^B21195521
"BLD",5741,"KRN",9.8,"NM",21,0)
DGRPTL3^^0^B13982838
"BLD",5741,"KRN",9.8,"NM",22,0)
DGPMGLG5^^0^B4902085
"BLD",5741,"KRN",9.8,"NM",23,0)
DGRPC2^^0^B59651485
"BLD",5741,"KRN",9.8,"NM",24,0)
DGIBDSP^^0^B6183279
"BLD",5741,"KRN",9.8,"NM","B","DG1010P5",7)

"BLD",5741,"KRN",9.8,"NM","B","DG1010PA",10)

"BLD",5741,"KRN",9.8,"NM","B","DG3PR0",11)

"BLD",5741,"KRN",9.8,"NM","B","DG3PR1",12)

"BLD",5741,"KRN",9.8,"NM","B","DG3PR2",13)

"BLD",5741,"KRN",9.8,"NM","B","DGBLRV",14)

"BLD",5741,"KRN",9.8,"NM","B","DGIBDSP",24)

"BLD",5741,"KRN",9.8,"NM","B","DGPMGLG5",22)

"BLD",5741,"KRN",9.8,"NM","B","DGPMVBUR",15)

"BLD",5741,"KRN",9.8,"NM","B","DGRP1",17)

"BLD",5741,"KRN",9.8,"NM","B","DGRP5",18)

"BLD",5741,"KRN",9.8,"NM","B","DGRPC2",23)

"BLD",5741,"KRN",9.8,"NM","B","DGRPDB",19)

"BLD",5741,"KRN",9.8,"NM","B","DGRPTL3",21)

"BLD",5741,"KRN",9.8,"NM","B","DGRPTP2",16)

"BLD",5741,"KRN",9.8,"NM","B","DGUTL",20)

"BLD",5741,"KRN",19,0)
19
"BLD",5741,"KRN",19.1,0)
19.1
"BLD",5741,"KRN",101,0)
101
"BLD",5741,"KRN",409.61,0)
409.61
"BLD",5741,"KRN",771,0)
771
"BLD",5741,"KRN",870,0)
870
"BLD",5741,"KRN",8989.51,0)
8989.51
"BLD",5741,"KRN",8989.52,0)
8989.52
"BLD",5741,"KRN",8994,0)
8994
"BLD",5741,"KRN","B",.4,.4)

"BLD",5741,"KRN","B",.401,.401)

"BLD",5741,"KRN","B",.402,.402)

"BLD",5741,"KRN","B",.403,.403)

"BLD",5741,"KRN","B",.5,.5)

"BLD",5741,"KRN","B",.84,.84)

"BLD",5741,"KRN","B",3.6,3.6)

"BLD",5741,"KRN","B",3.8,3.8)

"BLD",5741,"KRN","B",9.2,9.2)

"BLD",5741,"KRN","B",9.8,9.8)

"BLD",5741,"KRN","B",19,19)

"BLD",5741,"KRN","B",19.1,19.1)

"BLD",5741,"KRN","B",101,101)

"BLD",5741,"KRN","B",409.61,409.61)

"BLD",5741,"KRN","B",771,771)

"BLD",5741,"KRN","B",870,870)

"BLD",5741,"KRN","B",8989.51,8989.51)

"BLD",5741,"KRN","B",8989.52,8989.52)

"BLD",5741,"KRN","B",8994,8994)

"BLD",5741,"QUES",0)
^9.62^^
"BLD",5741,"REQB",0)
^9.611^11^11
"BLD",5741,"REQB",1,0)
DG*5.3*108^2
"BLD",5741,"REQB",2,0)
DG*5.3*113^2
"BLD",5741,"REQB",3,0)
DG*5.3*279^2
"BLD",5741,"REQB",4,0)
DG*5.3*358^2
"BLD",5741,"REQB",5,0)
DG*5.3*366^2
"BLD",5741,"REQB",6,0)
DG*5.3*515^2
"BLD",5741,"REQB",7,0)
DG*5.3*528^2
"BLD",5741,"REQB",8,0)
DG*5.3*546^2
"BLD",5741,"REQB",9,0)
IB*2.0*267^2
"BLD",5741,"REQB",10,0)
DG*5.3*617^2
"BLD",5741,"REQB",11,0)
DG*5.3*564^2
"BLD",5741,"REQB","B","DG*5.3*108",1)

"BLD",5741,"REQB","B","DG*5.3*113",2)

"BLD",5741,"REQB","B","DG*5.3*279",3)

"BLD",5741,"REQB","B","DG*5.3*358",4)

"BLD",5741,"REQB","B","DG*5.3*366",5)

"BLD",5741,"REQB","B","DG*5.3*515",6)

"BLD",5741,"REQB","B","DG*5.3*528",7)

"BLD",5741,"REQB","B","DG*5.3*546",8)

"BLD",5741,"REQB","B","DG*5.3*564",11)

"BLD",5741,"REQB","B","DG*5.3*617",10)

"BLD",5741,"REQB","B","IB*2.0*267",9)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
570^3050105^100110
"PKG",5,22,1,"PAH",1,1,0)
^^13^13^3050105
"PKG",5,22,1,"PAH",1,1,1,0)
This patch is in support of the Billing Replacement - Encapsulation 
"PKG",5,22,1,"PAH",1,1,2,0)
Project.  The objective of this project is to standardize existing VistA 
"PKG",5,22,1,"PAH",1,1,3,0)
Integrated Billing and Accounts Receivable functionality so that a new 
"PKG",5,22,1,"PAH",1,1,4,0)
COTS billing/AR product may be effectively integrated into the VistA 
"PKG",5,22,1,"PAH",1,1,5,0)
suite. This will be accomplished by replacing direct IB and AR touch 
"PKG",5,22,1,"PAH",1,1,6,0)
points with standard authorized API's available to all VistA packages. 
"PKG",5,22,1,"PAH",1,1,7,0)
 
"PKG",5,22,1,"PAH",1,1,8,0)
This patch will replace all current direct access of Insurance 
"PKG",5,22,1,"PAH",1,1,9,0)
Information in the VistA Registration package with a new API call.  Code 
"PKG",5,22,1,"PAH",1,1,10,0)
which had been retrieving insurance information from either the INSURANCE 
"PKG",5,22,1,"PAH",1,1,11,0)
File (#36) or the INSURANCE TYPE sub-file (#2.312) of the PATIENT File 
"PKG",5,22,1,"PAH",1,1,12,0)
(#2), has been modified to use the $$INSUR^IBBAPI API call originally 
"PKG",5,22,1,"PAH",1,1,13,0)
released with patch IB*2*256, IB INSURANCE API.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
16
"RTN","DG1010P5")
0^7^B13853039
"RTN","DG1010P5",1,0)
DG1010P5 ;ALB/REW - PRINT 1010 CONT'D PART V ; 15 MAR 92
"RTN","DG1010P5",2,0)
 ;;5.3;Registration;**570**;Aug 13, 1993
"RTN","DG1010P5",3,0)
 ;;1
"RTN","DG1010P5",4,0)
 ;NOTE: Due to space reasons, the convention of having the code for
"RTN","DG1010P5",5,0)
 ;      section 'n' in DG1010Pn is modified.  The question #11 code
"RTN","DG1010P5",6,0)
 ;      is in DG1010PX.
"RTN","DG1010P5",7,0)
PARTV ;
"RTN","DG1010P5",8,0)
 W !?50,"PART V - ELIGIBILITY STATUS DATA",!,DGLUND
"RTN","DG1010P5",9,0)
 W !,"1.  PATIENT TYPE: ",$$POINT^DG1010P0(DGP("TYPE"),1,"^DG(391,"),!,DGLUND
"RTN","DG1010P5",10,0)
 W !,"2.  IS NEED FOR MEDICAL CARE RELATED TO AN",?44,"| ","3.  IS THE NEED FOR MEDICAL CARE RELATED",?89,"| ","4.  IS PATIENT ELIGIBLE FOR MEDICAID:"
"RTN","DG1010P5",11,0)
 W !,"    ON THE JOB INJURY: ",$$YN2(DGP("DIS2"),1),?44,"| ",?50,"TO AN ACCIDENT: ",$$YN2(DGP("DIS2"),4),?89,"| ",?95,$$YN2(DGP(.38),1),?131,$C(13),DGLUND
"RTN","DG1010P5",12,0)
 W !,"5A. DOES PATIENT HAVE HEALTH INSURANCE",?44,"| ","5B. IF YES, COVERAGE PROVIDED BY:"
"RTN","DG1010P5",13,0)
 N DGIB,DGIBA,DGYN,DGIB8,DGIB4,DGINS,DGX ; changes for DG*570
"RTN","DG1010P5",14,0)
 S DGYN=$$INSUR^IBBAPI(DFN,,"R",.DGINS,"1,10,11,12")
"RTN","DG1010P5",15,0)
 W !?4,"COVERAGE: ",$S(DGYN:"YES",1:"NO"),?44,"| ",?50
"RTN","DG1010P5",16,0)
 I 'DGYN W "NOT APPLICABLE" G GI
"RTN","DG1010P5",17,0)
INSINFO ;
"RTN","DG1010P5",18,0)
 S (DGVT,DGSP,DGOT)="",DGX=0
"RTN","DG1010P5",19,0)
 F  S DGX=$O(DGINS("IBBAPI","INSUR",DGX)) Q:'DGX  D
"RTN","DG1010P5",20,0)
 . S DGIB8=$G(DGINS("IBBAPI","INSUR",DGX,10)),DGIB4=$G(DGINS("IBBAPI","INSUR",DGX,11))
"RTN","DG1010P5",21,0)
 . I $S((DGIB8>(9999999-DFN1)):1,(DGIB4']""):0,((9999999-DFN1)>DGIB4):1,1:0) Q
"RTN","DG1010P5",22,0)
 . I $P(DGINS("IBBAPI","INSUR",DGX,12),U,1)="P" S DGVT="PATIENT'S INSURANCE"
"RTN","DG1010P5",23,0)
 . I $P(DGINS("IBBAPI","INSUR",DGX,12),U,1)="S" S DGSP="SPOUSE'S INSURANCE"
"RTN","DG1010P5",24,0)
 . I $P(DGINS("IBBAPI","INSUR",DGX,12),U,1)="O" S DGOT="OTHER"
"RTN","DG1010P5",25,0)
 I DGVT_DGSP_DGOT="" W "NO ACTIVE (UNEXPIRED) INSURANCE ON FILE FOR THIS APPLICANT"
"RTN","DG1010P5",26,0)
 I DGVT_DGSP_DGOT'="" W DGVT_$S((DGVT'="")&((DGSP_DGOT)'=""):" & ",1:"")_DGSP_$S((DGOT'="")&((DGVT_DGSP)'=""):" & ",1:"")_DGOT
"RTN","DG1010P5",27,0)
GI W ?131,$C(13),DGLUND
"RTN","DG1010P5",28,0)
 W !,"6.  DOES VETERAN HAVE GI",?31,"| ","7. PRIMARY ELIGIBILITY CODE",?65,"| ","8. OTHER ELIGIBILITY CODE",?98,"| ","9. PERIOD OF SERVICE"
"RTN","DG1010P5",29,0)
 W !?4,"INSURANCE: ",$$YN2(DGP(.362),17),?31,"| ",?36,$$ELIG($P(DGP(.36),U,1)),?65,"| ",?70
"RTN","DG1010P5",30,0)
 S DGOTHER=$O(^DPT(DFN,"E",0)) S:(DGOTHER=DGE)&($L(DGE)) DGOTHER=$O(^DPT(DFN,"E",DGOTHER))
"RTN","DG1010P5",31,0)
 S DGX=DGE
"RTN","DG1010P5",32,0)
 W $$ELIG(DGOTHER),?98,"| ",?103,$$POINT^DG1010P0(DGP(.32),3,21,1,0,1)
"RTN","DG1010P5",33,0)
 I 'DGUNK!DGOTHER F  D  Q:(DGUNK)!(DGOTHER="")
"RTN","DG1010P5",34,0)
 .S DGOTHER=$O(^DPT(DFN,"E",DGOTHER)),DGD=$$ELIG(DGOTHER)
"RTN","DG1010P5",35,0)
 .Q:(DGUNK)!(DGX=DGOTHER)
"RTN","DG1010P5",36,0)
 .W !,?31,"| ",?65,"| ",?70,DGD,?98,"| "
"RTN","DG1010P5",37,0)
 W ?131,$C(13),DGLUND
"RTN","DG1010P5",38,0)
SCCOND ;
"RTN","DG1010P5",39,0)
 ;RATED=.372 STATED=.373
"RTN","DG1010P5",40,0)
 S DGSC=$S((($P(DGP(.3),U,1)="Y")&($P(DGP(.361),U,1)="V")):.372,($O(^DPT(DFN,.373,0))>0):.373,($$DISP^DG1010P0(DGP(.3),1)'="Y"):"NA",1:0)
"RTN","DG1010P5",41,0)
 I DGSC=.373 D
"RTN","DG1010P5",42,0)
 .W !,"10. SERVICE CONNECTED CONDITIONS AS STATED BY APPLICANT:"
"RTN","DG1010P5",43,0)
 .S E=0 S E=$O(^DPT(DFN,.373,E)) Q:E'>0  W ?59,$P(^(E,0),U,1)," (",$P(^(0),U,2),"%)"
"RTN","DG1010P5",44,0)
 .F  S E=$O(^DPT(DFN,.373,E)) Q:E'>0  W !,?59,$P(^(E,0),U,1)," (",$P(^(0),U,2),"%)"
"RTN","DG1010P5",45,0)
 I DGSC=.372 D
"RTN","DG1010P5",46,0)
 .W !,"10. RATED SERVICE CONNECTED CONDITIONS: "
"RTN","DG1010P5",47,0)
 .S DGFL=1
"RTN","DG1010P5",48,0)
 .F E=0:0 S E=$O(^DPT(DFN,.372,E)) Q:E'>0  S DGP(.372)=$G(^(E,0)) D
"RTN","DG1010P5",49,0)
 ..Q:'$$DISP^DG1010P0(DGP(.372),3)
"RTN","DG1010P5",50,0)
 ..W ?59,$$POINT^DG1010P0(DGP(.372),1,31)," (",$$DISP^DG1010P0(DGP(.372),2),"%)",!
"RTN","DG1010P5",51,0)
 ..S DGFL=0
"RTN","DG1010P5",52,0)
 .W:DGFL "NO RATED SERVICE-CONNECTED CONDITIONS",! K DGFL
"RTN","DG1010P5",53,0)
 I +DGSC=0 W !,"10. SERVICE CONNECTED CONDITIONS: "_$S((DGSC="NA"):"NOT APPLICABLE: NOT A SERVICE-CONNECTED APPLICANT",1:"UNANSWERED"),!
"RTN","DG1010P5",54,0)
 W ?131,$C(13),DGLUND
"RTN","DG1010P5",55,0)
 G Q11PTV^DG1010PX
"RTN","DG1010P5",56,0)
YN2(N,P) ;
"RTN","DG1010P5",57,0)
 ; Ext Val of YES/NO given node & piece.
"RTN","DG1010P5",58,0)
 ;IN:  N  -- Val of Node
"RTN","DG1010P5",59,0)
 ;     P  -- Piece
"RTN","DG1010P5",60,0)
 ;OUT:[RETURN] -- Ext Val 
"RTN","DG1010P5",61,0)
 S X=$P(N,"^",P)
"RTN","DG1010P5",62,0)
 Q $S((X="Y"):"YES",(X="N"):"NO",(X="U"):"UNKNOWN",(X=""):"UNANSWERED",("0"[X):"NO",("12"[X):"YES",("3"[X):"UNKNOWN",1:"INVALID")
"RTN","DG1010P5",63,0)
ELIG(X) ;
"RTN","DG1010P5",64,0)
 ; Ext Val of Elig
"RTN","DG1010P5",65,0)
 ;IN:  X  -- Pointer to #8
"RTN","DG1010P5",66,0)
 ;OUT:[RETURN] -- Ext Val 
"RTN","DG1010P5",67,0)
 ;OUT [SET]    -- DGE (Int Elig Val)
"RTN","DG1010P5",68,0)
 S DGE=X
"RTN","DG1010P5",69,0)
 Q $$UNK^DG1010P0($P($G(^DIC(8,+(X),0)),U,1))
"RTN","DG1010PA")
0^10^B16915740
"RTN","DG1010PA",1,0)
DG1010PA ;ALB/REW - 1010 PRINT--INQUIRY PATIENT -ADDITIONL ; 28-MAY-93
"RTN","DG1010PA",2,0)
 ;;5.3;Registration;**18,28,86,108,113,570**;Aug 13, 1993
"RTN","DG1010PA",3,0)
 ;
"RTN","DG1010PA",4,0)
NOREG(DFN) ; DOES PROMPTS FOR 10/10 PRINT W/O REGISTRATION
"RTN","DG1010PA",5,0)
 ;INPUT: DFN
"RTN","DG1010PA",6,0)
 ;OUTPUT: VARIABLES NEEDED FOR DIFFERENT PRINTOUTS
"RTN","DG1010PA",7,0)
 ;   DB      - 10/10 SELECTED
"RTN","DG1010PA",8,0)
 ;   DGMTYPT - MT=1 Copay=2 None=0
"RTN","DG1010PA",9,0)
 ;   DGOPT   - WHICH REPORTS TO PRINT
"RTN","DG1010PA",10,0)
 ;   DGPMDA  - Admssions Report Info
"RTN","DG1010PA",11,0)
 ;   DGT     - 1010F Info
"RTN","DG1010PA",12,0)
 ;   FREE    - SUPPLEMENTAL FLAG
"RTN","DG1010PA",13,0)
 ;   PRF     - FLAG FOR RX PROFILE
"RTN","DG1010PA",14,0)
 ;   PSOINST - STATION NUMBER (INSTITUTION FILE) FOR ACTION PROFILE PRINT
"RTN","DG1010PA",15,0)
 ;   PSONOPG - USED FOR PRINTING ACTION PROFILE (SET TO 1)
"RTN","DG1010PA",16,0)
 ;   PSOPAR  - PRINT BARCODES FOR ACTION PROFILE (SET TO 1)
"RTN","DG1010PA",17,0)
 ;   PSTYPE  - TYPE OF DRUG PROFILE
"RTN","DG1010PA",18,0)
 ;   GMTSTYP - TYPE OF HEALTH SUMMARYD
"RTN","DG1010PA",19,0)
 ;   
"RTN","DG1010PA",20,0)
 ;
"RTN","DG1010PA",21,0)
 N DB,DG1,I,X,Y
"RTN","DG1010PA",22,0)
 S FREE=+$P(^DG(43,1,0),U,8),DGOPT=""
"RTN","DG1010PA",23,0)
 I $$PROMPRN("1010T") G:DG1<0 QTNOREG S DGOPT=DGOPT_9 ;*DG*5.3*108; 1010T
"RTN","DG1010PA",24,0)
 I $$PROMPRN(1010) G:DG1<0 QTNOREG S DB=1,DGOPT=DGOPT_1
"RTN","DG1010PA",25,0)
 I $$PROMPRN("1010I") G:DG1<0 QTNOREG S DGOPT=DGOPT_2
"RTN","DG1010PA",26,0)
 S PRF=0 G QTNOREG:'$D(^DG(43,1,0)) ;NEED MAS PARAMETERS TO CONTINUE
"RTN","DG1010PA",27,0)
 I $$PROMPRN("THIRD") G:DG1<0 QTNOREG S DGOPT=DGOPT_3
"RTN","DG1010PA",28,0)
 I $$PROMPRN("SUP") G:DG1<0 QTNOREG S DGOPT=DGOPT_4
"RTN","DG1010PA",29,0)
 I $$PROMPRN("MTCP") G:DG1<0 QTNOREG S DGOPT=DGOPT_$S(DGMTYPT=1:6,1:7)
"RTN","DG1010PA",30,0)
 I $$PROMPRN("HS") G:DG1<0 QTNOREG S DGOPT=DGOPT_8
"RTN","DG1010PA",31,0)
 I $$PROMPRN("PRO") G:DG1<0 QTNOREG S DGOPT=DGOPT_5,PRF=1
"RTN","DG1010PA",32,0)
QTNOREG S:$G(DG1)<0 DGOPT=""
"RTN","DG1010PA",33,0)
 Q
"RTN","DG1010PA",34,0)
PROMPRN(DGX) ; PROMPTS FOR PRINT
"RTN","DG1010PA",35,0)
 ; RETURNS DGX [1=YES;0=NO;-1=DIRUT CONDITIONS]
"RTN","DG1010PA",36,0)
 ; OUTPUT:DG1 VALUE
"RTN","DG1010PA",37,0)
 S DG1=0
"RTN","DG1010PA",38,0)
 I $$FAILCOND(DGX) S DG1=$S($D(DG1):DG1,1:2) G QTPROMP ;DEFAULT=NO
"RTN","DG1010PA",39,0)
 F  D  Q:$G(DG1)
"RTN","DG1010PA",40,0)
 .S DG1=$$ASK(DGX)
"RTN","DG1010PA",41,0)
 .S:DG1=1 DG1=$$AFTERASK(DGX)
"RTN","DG1010PA",42,0)
QTPROMP Q $S(DG1=2:0,(DG1=1):1,1:DG1)
"RTN","DG1010PA",43,0)
ASK(DGX) ; PROMPTS FOR PRINT
"RTN","DG1010PA",44,0)
 ; RETURNS DGX [2=NO,1=YES;0=?,-1=DIRUT CONDITIONS]
"RTN","DG1010PA",45,0)
 W !,"PRINT "
"RTN","DG1010PA",46,0)
 W $S(DGX=1010:"10/10",(DGX="1010T"):"1010T",(DGX="1010I"):"1010I",(DGX="THIRD"):"ERROR",(DGX="SUP"):"SUPPLEMENTAL DATA SHEET",(DGX="MTCP"):"1010F",(DGX="HS"):"HEALTH SUMMARY",(DGX="PRO"):"DRUG PROFILE",(DGX="EF"):"ENCOUNTER FORMS",1:"ERROR")
"RTN","DG1010PA",47,0)
 S %=1 D YN^DICN I '% W !,"ENTER 'Y'ES TO PRINT A ",DGX,".  OTHERWISE ENTER 'N'O."
"RTN","DG1010PA",48,0)
 Q $G(%)
"RTN","DG1010PA",49,0)
FAILCOND(DGX) ;CHECKS IF PROMPT SHOULD BE ASKED
"RTN","DG1010PA",50,0)
 ;   DGI: 2=NO;1=YES;-1=DIRUT
"RTN","DG1010PA",51,0)
 ;RETURNS 1=DON'T ASK AND SKIP TO NEXT;0=ASK
"RTN","DG1010PA",52,0)
 ;
"RTN","DG1010PA",53,0)
 N DGFAIL
"RTN","DG1010PA",54,0)
 S DGFAIL=0
"RTN","DG1010PA",55,0)
 I DGX=1010 G QTFAIL
"RTN","DG1010PA",56,0)
 I DGX="1010I" D  G QTFAIL
"RTN","DG1010PA",57,0)
 . I '($$INSUR^IBBAPI(DFN)) S DGFAIL=1
"RTN","DG1010PA",58,0)
 I DGX="THIRD" F  D  Q:$G(%)  G QTFAIL
"RTN","DG1010PA",59,0)
 .N DGNOQ,DGDEF
"RTN","DG1010PA",60,0)
 .D ADM
"RTN","DG1010PA",61,0)
 .S DGFAIL=1
"RTN","DG1010PA",62,0)
 .I DGPMDA>0!$D(^DGS(41.1,"B",DFN)) D
"RTN","DG1010PA",63,0)
 ..S (DGNOQ,DGDEF)=1 D ASK^DGBLRV
"RTN","DG1010PA",64,0)
 ..S DG1=%
"RTN","DG1010PA",65,0)
 I DGX="MTCP" D  G QTFAIL
"RTN","DG1010PA",66,0)
 .S DGT=$$LST^DGMTCOU1(DFN) S DGMTYPT=$P(DGT,U,5)
"RTN","DG1010PA",67,0)
 .S DGFAIL=$S($P(DGT,U,4)["R":1,+DGMTYPT:0,1:1)
"RTN","DG1010PA",68,0)
 I DGX="HS" S DGFAIL=1 D  G QTFAIL
"RTN","DG1010PA",69,0)
 .S X="GMTSDVR" X ^%ZOSF("TEST") I $T D
"RTN","DG1010PA",70,0)
 ..S:$T(ENXQ^GMTSDVR)]""&($P(^DG(43,1,0),U,42)) DGFAIL=0
"RTN","DG1010PA",71,0)
 I DGX="PRO" S DGFAIL=1 D  G QTFAIL
"RTN","DG1010PA",72,0)
 .S X="PSOSD1" X ^%ZOSF("TEST") I '$T Q
"RTN","DG1010PA",73,0)
 .I '$P(^DG(43,1,0),U,17) Q
"RTN","DG1010PA",74,0)
 .S DGFAIL=0
"RTN","DG1010PA",75,0)
 I DGX="SUP" D  G QTFAIL
"RTN","DG1010PA",76,0)
 .I $G(DB),($P(^DG(43,1,0),U,8)'=1) S DGFAIL=1 Q
"RTN","DG1010PA",77,0)
 I DGX="EF" D  G QTFAIL
"RTN","DG1010PA",78,0)
 .I $P(^DG(43,1,0),U,47)'=1 S DGFAIL=1 Q
"RTN","DG1010PA",79,0)
QTFAIL Q DGFAIL
"RTN","DG1010PA",80,0)
AFTERASK(DGX) ;ACTIONS AFTER REPONSE OF YES TO PRINT
"RTN","DG1010PA",81,0)
 ; RETURNS DGGO[2=DON'T PRINT,1=PRINT,-1=ABORT]
"RTN","DG1010PA",82,0)
 ; SETS PRINT-SETUP VARIABLES
"RTN","DG1010PA",83,0)
 ;   PSOINST - STATION NUMBER (INSTITUTION FILE) FOR ACTION PROFILE PRINT
"RTN","DG1010PA",84,0)
 ;   PSONOPG - USED FOR PRINTING ACTION PROFILE (SET TO 1)
"RTN","DG1010PA",85,0)
 ;   PSOPAR  - PRINT BARCODES FOR ACTION PROFILE (SET TO 1)
"RTN","DG1010PA",86,0)
 ;   PSTYPE = DRUG PROFILE TYPE
"RTN","DG1010PA",87,0)
 ;   GMTSTYP = POINTER TO HEALTH SUMMARY TYPE
"RTN","DG1010PA",88,0)
 N DGGO,DIR,X,Y
"RTN","DG1010PA",89,0)
 S DGGO=1
"RTN","DG1010PA",90,0)
 I DGX="HS" D  ;HEALTH SUMMARY
"RTN","DG1010PA",91,0)
 .S X=$P($G(^DG(43,1,0)),U,43),DIC=142,DIC(0)="NX"
"RTN","DG1010PA",92,0)
 .D ^DIC K DIC
"RTN","DG1010PA",93,0)
 .S:+Y DIR("B")=$P(Y,U,2)
"RTN","DG1010PA",94,0)
 .S DIR(0)="PO^142:QAMEZ"
"RTN","DG1010PA",95,0)
 .D ^DIR
"RTN","DG1010PA",96,0)
 .I Y'>0 W !,*7,"No Type Selected.  HS will not print" S DGGO=2 K DIR,DIRUT,DUOUT Q
"RTN","DG1010PA",97,0)
 .S GMTSTYP=+Y
"RTN","DG1010PA",98,0)
 I DGX="PRO" D  ;DRUG PROFILE
"RTN","DG1010PA",99,0)
 .S DGGO=0
"RTN","DG1010PA",100,0)
 .N DGDEF
"RTN","DG1010PA",101,0)
 .S DGDEF=$P(^DG(43,1,0),U,45)
"RTN","DG1010PA",102,0)
 .I $P(^DG(43,1,0),U,44) D
"RTN","DG1010PA",103,0)
 ..S:DGDEF]"" DIR("B")=$S(DGDEF="A":"ACTION",(DGDEF="I"):"INFORMATIONAL",1:"")
"RTN","DG1010PA",104,0)
 ..S DIR(0)="SM^A:ACTION;I:INFORMATIONAL"
"RTN","DG1010PA",105,0)
 ..S DIR("A")="Select type of Drug Profile"
"RTN","DG1010PA",106,0)
 ..D ^DIR
"RTN","DG1010PA",107,0)
 ..S DGDEF=Y
"RTN","DG1010PA",108,0)
 .I '$D(DIRUT) D
"RTN","DG1010PA",109,0)
 ..S (PSOPAR,PSTYPE)=$S(DGDEF="A":1,(DGDEF="I"):0,1:0),(DGGO,PSONOPG)=1
"RTN","DG1010PA",110,0)
 ..S PSOINST=+$P($G(^DIC(4,+$P($G(^XMB(1,1,"XUS")),U,17),99)),U)
"RTN","DG1010PA",111,0)
 Q DGGO
"RTN","DG1010PA",112,0)
ADM K DGPMDA I $D(^DGPM("ATID1",DFN)) F I=0:0 S I=$O(^DGPM("ATID1",DFN,I)) Q:'I!(I>(DFN1+.9999))  S DGPMDA=$O(^(I,0))
"RTN","DG1010PA",113,0)
 S DGPMDA=$S($D(DGPMDA):DGPMDA,1:0)
"RTN","DG1010PA",114,0)
 Q
"RTN","DG3PR0")
0^11^B14612597
"RTN","DG3PR0",1,0)
DG3PR0 ;ALB/JDS - 10-10I ;01 JAN 1987
"RTN","DG3PR0",2,0)
 ;;5.3;Registration;**26,69,570**;Aug 13, 1993
"RTN","DG3PR0",3,0)
START K ^UTILITY($J)
"RTN","DG3PR0",4,0)
 N DGIBB,DGX,DGINS,DGBLD
"RTN","DG3PR0",5,0)
 S (N(1),N(0),DG(1),DG(0))=""
"RTN","DG3PR0",6,0)
 I $$INSUR^IBBAPI(DFN,,,.DGIBB,"*")
"RTN","DG3PR0",7,0)
 S DGX="DGIBB(""IBBAPI"",""INSUR"")" M DGINS=@DGX
"RTN","DG3PR0",8,0)
 ;
"RTN","DG3PR0",9,0)
 F I=0:0 S I=$O(DGINS(I)) Q:'I  D
"RTN","DG3PR0",10,0)
 . S L=+DGINS(I,1)
"RTN","DG3PR0",11,0)
 . S M=$P($G(DGINS(I,12)),U)
"RTN","DG3PR0",12,0)
 . S M=$S(M="P":"v",M="S":"s",M="O":"o",1:0)
"RTN","DG3PR0",13,0)
 . S DGBLD=L ; ID Number
"RTN","DG3PR0",14,0)
 . S $P(DGBLD,U,2)=DGINS(I,14) ; Subscriber ID 
"RTN","DG3PR0",15,0)
 . S $P(DGBLD,U,3)=DGINS(I,18) ; Group Policy No.
"RTN","DG3PR0",16,0)
 . S $P(DGBLD,U,4)=DGINS(I,11) ; Expiration Date
"RTN","DG3PR0",17,0)
 . S $P(DGBLD,U,6)=M ; Subscriber Relationship (Whose Insurance)
"RTN","DG3PR0",18,0)
 . S $P(DGBLD,U,8)=DGINS(I,10) ; Effective Date
"RTN","DG3PR0",19,0)
 . S $P(DGBLD,U,16)=$S(M="v":"01",M="s":"02",M="o":"09",1:"09") ; (Pt. Relationship to Insured - Derived)
"RTN","DG3PR0",20,0)
 . S $P(DGBLD,U,17)=DGINS(I,13) ; Subscriber Name
"RTN","DG3PR0",21,0)
 . S $P(DGBLD,U,18)=+DGINS(I,8) ; Group Plan (Policy Name)
"RTN","DG3PR0",22,0)
 . S $P(DGBLD,U,20)=+DGINS(I,7) ; Coord. of Benefits
"RTN","DG3PR0",23,0)
 . S $P(DGBLD,U,30)=I ; Save of Insurance API Index
"RTN","DG3PR0",24,0)
 . S ^UTILITY($J,M,L)=DGBLD
"RTN","DG3PR0",25,0)
 ;
"RTN","DG3PR0",26,0)
 F I="v",0,"s","o" I $D(^UTILITY($J,I)) S DG(0)=^($O(^(I,0))),N(0)=I Q
"RTN","DG3PR0",27,0)
 F I="v",0,"s","o" I $D(^UTILITY($J,I)) S L=$S(N(0)=I:$O(^($O(^(I,0)))),1:$O(^(I,0))) I L>0 S DG(1)=^UTILITY($J,I,L),N(1)=I Q
"RTN","DG3PR0",28,0)
 ;K ^UTILITY($J)
"RTN","DG3PR0",29,0)
PRINT ;
"RTN","DG3PR0",30,0)
 G:$$FIRST^DGUTL Q
"RTN","DG3PR0",31,0)
 I '$D(DGNOW) N DGNOW D NOW^%DTC,YX^%DTC S DGNOW=Y
"RTN","DG3PR0",32,0)
 W "Printed: ",DGNOW
"RTN","DG3PR0",33,0)
 S DIC(0)="LM",X="DG1010I",DIC="^DIC(47," D ^DIC G Q:Y'>0 S DGY=+Y
"RTN","DG3PR0",34,0)
 F I=0,.21,.22,.25,.311 S D(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DG3PR0",35,0)
 S Y=$P(D(.22),U,5) D ZIPOUT^VAFADDR S X=$P(D(.311),U,6,7)_U_Y D AD2 S D(.311)=$P(D(.311),U,1)_U_$P(D(.311),U,9)_U_$P(D(.311),U,3)_" "_$P(D(.311),U,4)_" "_$P(D(.311),U,5)_U_X
"RTN","DG3PR0",36,0)
 S Y=$P(D(.22),U,6) D ZIPOUT^VAFADDR S X=$P(D(.25),U,5,6)_U_Y D AD2 S D(.25)=$P(D(.25),U,1)_U_$P(D(.25),U,8)_U_$P(D(.25),U,2)_" "_$P(D(.25),U,3)_" "_$P(D(.25),U,4)_U_X
"RTN","DG3PR0",37,0)
 F I=0,1 D SET
"RTN","DG3PR0",38,0)
 S (L,DGL)=0 F I=0:0 S I=$O(^DIC(47,+DGY,1,I)) Q:'I!(DGL=I)  S J=^(I,0),X="" W ! F K=1:1 W $E($P(J,"{}",K),$S(K=1:1,X']"":1,1:$L(X)-1),999) S X=$P(J,"{",K+1) Q:X']""  S L=L+1 D SE W:X']"" "  "
"RTN","DG3PR0",39,0)
Q D ENDREP^DGUTL K A,B,D,DG,DGL,DGY,DIC,E,I,J,K,L,M,N,X,X1,X2,Y,DGIBINS,^UTILITY($J)
"RTN","DG3PR0",40,0)
 Q
"RTN","DG3PR0",41,0)
 ;
"RTN","DG3PR0",42,0)
SET ;
"RTN","DG3PR0",43,0)
 N DGX
"RTN","DG3PR0",44,0)
 S DGX=$P($G(DG(I)),U,30)
"RTN","DG3PR0",45,0)
 S A=$S(DGX>0:$P(DGINS(DGX,1),U,2),1:"") ; Insurance Co. Name
"RTN","DG3PR0",46,0)
 S X=""
"RTN","DG3PR0",47,0)
 S:DGX>0 X=DGINS(DGX,3)_", "_$P(DGINS(DGX,4),U,2)_" "_DGINS(DGX,5)
"RTN","DG3PR0",48,0)
 ;
"RTN","DG3PR0",49,0)
 S X(I)=A_U_$S(DGX>0:DGINS(DGX,6),1:"")_U_$S(DGX>0:DGINS(DGX,2),1:"")_U_X_U_$P(DG(I),U,2)_U_$P(DG(I),U,3)_U
"RTN","DG3PR0",50,0)
 S Y=$S(DGX>0:DGINS(DGX,10),1:""),Y=$$FMTE^XLFDT(Y) ; Effective Date of Policy
"RTN","DG3PR0",51,0)
 S X(I)=X(I)_Y_U
"RTN","DG3PR0",52,0)
 S Y="",Y=$$FMTE^XLFDT(Y)  ; Renewal Date (Not available in Insurance API)
"RTN","DG3PR0",53,0)
 S X(I)=X(I)_Y
"RTN","DG3PR0",54,0)
 ;
"RTN","DG3PR0",55,0)
 S N=$S(N(I)="s":$P(DG(I),U,17)_U_"SPOUSE",(N(I)=0!(N(I)="v")):$P(D(0),U,1)_U_"SAME",1:$P(DG(I),U,17)_U)
"RTN","DG3PR0",56,0)
 S E=$S(N(I)=0!(N(I)="v"):D(.311),N(I)="s":D(.25),1:"^^^^")
"RTN","DG3PR0",57,0)
 S X=$P(DG(I),U,12,14) D AD2 S X1(I)=N_U_E,X2(I)=$P(DG(I),U,9,11)_U_X
"RTN","DG3PR0",58,0)
 Q
"RTN","DG3PR0",59,0)
AD2 S X=$P(X,U,1)_$S($P(X,U,1)]"":", ",1:"")_$S($D(^DIC(5,+$P(X,U,2),0)):$P(^(0),U,1),1:"")_" "_$P(X,U,3) Q
"RTN","DG3PR0",60,0)
SE I L>2&(L<11) S X=$P(X(L\21),U,L-$S(L>20:20,1:2)) W X Q
"RTN","DG3PR0",61,0)
 I L>10&(L<17) S X=$P(X1(L\21),U,L-10) W X Q
"RTN","DG3PR0",62,0)
 I L>16&(L<21) S X=$P(X2(L\21),U,L-16) W X Q
"RTN","DG3PR0",63,0)
 I L>20&(L<29) S X=$P(X(L\21),U,L-20) W X Q
"RTN","DG3PR0",64,0)
 I L>28&(L<35) S X=$P(X1(L\21),U,L-28) W X Q
"RTN","DG3PR0",65,0)
 I L>34 S X=$P(X2(L\21),U,L-34) W X Q
"RTN","DG3PR0",66,0)
 S X=$P(D(0),U,$S(L=1:1,1:9)) W X Q
"RTN","DG3PR0",67,0)
 Q
"RTN","DG3PR1")
0^12^B5219961
"RTN","DG3PR1",1,0)
DG3PR1 ;ALB/JDS/MIR - 3rd PARTY REIMBURSEMENT SORT/PRINT ; 3 MAY 90@8P
"RTN","DG3PR1",2,0)
 ;;5.3;Registration;**26,570**;Aug 13, 1993
"RTN","DG3PR1",3,0)
SORT S (DGFL,DGTIME)=1 F DGI=DGFR:0 S DGI=$O(^DGPM(DGBY,DGI)) Q:'DGI!(DGI>DGTO)!'DGFL  F DGJ=0:0 S DGJ=$O(^DGPM(DGBY,DGI,DGJ)) Q:'DGJ  D PRINT Q:'DGFL
"RTN","DG3PR1",4,0)
 D Q^DG3PR Q
"RTN","DG3PR1",5,0)
PRINT ;OUTPUT
"RTN","DG3PR1",6,0)
 Q:'$D(^DGPM(+DGJ,0))  I DGBY[3 S DGDC=^(0),DGCA=$P(DGDC,"^",14),DGAD=$S($D(^DGPM(+DGCA,0)):^(0),1:"")
"RTN","DG3PR1",7,0)
 I DGBY[1 S DGAD=^(0),DGCA=DGJ,DGDC=$S($D(^DGPM(+$P(DGAD,"^",17),0)):^(0),1:"")
"RTN","DG3PR1",8,0)
 S DFN=$P(DGAD,"^",3)
"RTN","DG3PR1",9,0)
 I $S('DFN:1,'$D(^DPT(DFN,0)):1,'$$INSUR^IBBAPI(DFN,"","R"):1,'$D(^DPT(DFN,"VET")):1,$P(^("VET"),"^",1)'="Y":1,1:0) Q
"RTN","DG3PR1",10,0)
 I 'DGTIME,($E(IOST,1)="C") S DIR(0)="E" D ^DIR S DGFL=Y Q:'DGFL
"RTN","DG3PR1",11,0)
 S DGTIME=0 W @IOF,!,"THIRD PARTY REIMBURSEMENT",?49,"PRINTED:  " D NOW^%DTC S Y=% X ^DD("DD") W Y S DGNOW=Y
"RTN","DG3PR1",12,0)
 W !!,$P(^DPT(DFN,0),"^",1),?39,"EMPLOYMENT STATUS:  " S DGX=$S($D(^DPT(DFN,.311)):^(.311),1:""),X1=$P(DGX,"^",15)
"RTN","DG3PR1",13,0)
 W $S(X1=1:"EMPLOYED FULL TIME",X1=2:"EMPLOYED PART TIME",X1=3:"NOT EMPLOYED",X1=4:"SELF EMPLOYED",X1=5:"RETIRED",X1=6:"ACTIVE MILITARY DUTY",1:"UNKNOWN")
"RTN","DG3PR1",14,0)
 D PID^VADPT6 W !,"(PT ID:  ",VA("PID"),")",?48,"EMPLOYER:  ",$P(DGX,"^",1) S X=$S($D(^DPT(DFN,.11)):^(.11),1:"") W !,$P(X,"^",1),?46,"OCCUPATION:  ",$P(^DPT(DFN,0),"^",7)
"RTN","DG3PR1",15,0)
 I $P(X,"^",2)]"" W !,$P(X,"^",2) I $P(X,"^",3)]"" W !,$P(X,"^",3)
"RTN","DG3PR1",16,0)
 I $P(X,"^",4)]"" W !,$P(X,"^",4),", ",$S($D(^DIC(5,+$P(X,"^",5),0)):$P(^(0),"^",1),1:""),"  "
"RTN","DG3PR1",17,0)
 S Y=$P(X,U,12) D ZIPOUT^VAFADDR W Y
"RTN","DG3PR1",18,0)
 D ^DG3PR2
"RTN","DG3PR1",19,0)
 Q
"RTN","DG3PR2")
0^13^B16655720
"RTN","DG3PR2",1,0)
DG3PR2 ;ALB/MIR - CONTINUATION OF THE THIRD PARTY REIMBURSEMENT ; NOV 21 90@8
"RTN","DG3PR2",2,0)
 ;;5.3;Registration;**26,606,617,570**;Aug 13, 1993
"RTN","DG3PR2",3,0)
 S DGINS=0 W !!,"INSURANCE TYPE",?24,"INSURANCE #",?45,"GROUP #",?63,"EXPIRES   HOLDER",!,"--------- ----",?24,"--------- -",?45,"----- -",?63,"-------   ------"
"RTN","DG3PR2",4,0)
 ;570
"RTN","DG3PR2",5,0)
 ;D ALL^IBCNS1(DFN,"DGIBINS") F I=0:0 S I=$O(DGIBINS(I)) Q:'I  S J=DGIBINS(I,0) S X=$G(^DIC(36,+J,0)) W !,$S($P(X,"^",2)="N":"*",1:""),$E($P(X,"^",1),1,22),?24,$P(J,"^",2),?45,$P(J,"^",3) S DGINS=$S($P(X,"^",2)="N":1,1:0) D INS2
"RTN","DG3PR2",6,0)
 N DGX,DGDATA
"RTN","DG3PR2",7,0)
 I $$INSUR^IBBAPI(DFN,,"R",.DGDATA,"1,8,9,11,12,14,18")
"RTN","DG3PR2",8,0)
 S DGX="DGDATA(""IBBAPI"",""INSUR"")" M DGIBINS=@DGX
"RTN","DG3PR2",9,0)
 F I=0:0 S I=$O(DGIBINS(I)) Q:'I  D
"RTN","DG3PR2",10,0)
 . W !,$S('+DGIBINS(I,9):"*",1:" "),$E($P(DGIBINS(I,1),"^",2),1,22),?24,DGIBINS(I,14),?45
"RTN","DG3PR2",11,0)
 . I $D(DGIBINS(I,18)) W $G(DGIBINS(I,18)) ; Group Policy number
"RTN","DG3PR2",12,0)
 . S DGINS=$S($P(DGIBINS(I,9),U,2)="NO":1,1:0) D INS2
"RTN","DG3PR2",13,0)
 ;
"RTN","DG3PR2",14,0)
 I DGINS W !?22,"* - Insurer may not reimburse!"
"RTN","DG3PR2",15,0)
 K DGINS,DGIBINS
"RTN","DG3PR2",16,0)
 S Y=+DGAD X ^DD("DD") W !!,"Admitted: ",Y,?40,"Discharged: " S Y=+DGDC I Y X ^DD("DD") W Y
"RTN","DG3PR2",17,0)
 I $P(DGAD,"^",18)=9 W !,"Transferred in From ",$S($D(^DIC(4,+$P(DGAD,"^",5),0)):$P(^(0),"^",1),1:"")
"RTN","DG3PR2",18,0)
 S DGPTF=$P(DGAD,"^",16) I 'DGPTF!('$D(^DGPT(+DGPTF,0))) W !,"No PTF Record Exists" Q
"RTN","DG3PR2",19,0)
 I '$D(^DGP(45.84,DGPTF)) W !,"PTF Record not closed",!
"RTN","DG3PR2",20,0)
 K ^UTILITY("DG") F I=0:0 S I=$O(^DGPT(DGPTF,"M",I)) Q:'I  S J=^(I,0) S:$P(J,"^",2) ^UTILITY("DG",$J,"M",+$P(J,"^",10))=J
"RTN","DG3PR2",21,0)
 F I=0:0 S I=$O(^DGPT(DGPTF,"S",I)) Q:'I  D HEAD:$Y>(IOSL-5) Q:'DGFL  S J=^DGPT(DGPTF,"S",I,0),^UTILITY("DG",$J,"S",+J)=J
"RTN","DG3PR2",22,0)
 Q:'DGFL  I $O(^UTILITY("DG",$J,"M",0)) W !!,"DATE",?22,"LOS BEDSECTION",?39,"LOS",?45,"DIAGNOSES",!,"----",?22,"---------------",?39,"----  ---------"
"RTN","DG3PR2",23,0)
 N DGDAT,DXD
"RTN","DG3PR2",24,0)
 S DGDAT=$P(^DGPT(DGPTF,0),"^",2)
"RTN","DG3PR2",25,0)
 S DGPR=DGAD F I=0:0 S I=$O(^UTILITY("DG",$J,"M",I)) Q:'I  S J=^(I) D HEAD:$Y>(IOSL-5) Q:'DGFL  S (DGDAT,Y)=I X ^DD("DD") D LOL W !,Y,?22,$E($S($D(^DIC(42.4,+$P(J,"^",2),0)):$P(^(0),"^",1),1:""),1,16),?39,$J(DGLOL,4) D DIAG S DGPR=I
"RTN","DG3PR2",26,0)
 ;Q:'DGFL  S DGPMIFN=DGCA D ^DGPMLOS W !?39,"----  ----------",!?26,"TOTAL LOS:",?39,$J(+$P(X,"^",5),4),?45,$S($D(^ICD9(+$S($D(^DGPT(DGPTF,70)):$P(^(70),"^",10),1:""),0)):"DXLS: "_$P(^(0),"^",1)_" ("_$P(^(0),"^",3)_")",1:"")
"RTN","DG3PR2",27,0)
 Q:'DGFL  S DGPMIFN=DGCA
"RTN","DG3PR2",28,0)
 D ^DGPMLOS W !?39,"----  ----------",!?26,"TOTAL LOS:",?39,$J(+$P(X,"^",5),4) S DXD=+$S($D(^DGPT(DGPTF,70)):$P(^(70),"^",10),1:0),DXD=$S(+DXD:$$ICDDX^ICDCODE(DXD,DGDAT),1:"") W ?45,$S(+DXD>0:"DXLS: "_$P(DXD,"^",2)_" ("_$P(DXD,"^",4)_")",1:"")
"RTN","DG3PR2",29,0)
 Q:'$O(^UTILITY("DG",$J,"S",0))  D HEAD:$Y>(IOSL-10) Q:'DGFL  W !!,"SURGERY DATE",?22,"SPECIALTY",?45,"OP CODES",!,"------------",?22,"----------",?44,"--------"
"RTN","DG3PR2",30,0)
 F I=0:0 S I=$O(^UTILITY("DG",$J,"S",I)) Q:'I  S J=^(I),(DGDAT,Y)=I X ^DD("DD") W !,Y,?22,$E($S($D(^DIC(45.3,+$P(J,"^",3),0)):$P(^(0),"^",2),1:""),1,16) D OP
"RTN","DG3PR2",31,0)
 Q
"RTN","DG3PR2",32,0)
DIAG S M=0 F K=5:1:15 I K'=10 S L=$P(J,"^",K) I L S DXD=$$ICDDX^ICDCODE(+L,$G(DGDAT)) W:M ! W ?45,$S(+DXD>0:$P(DXD,"^",2)_" ("_$P(DXD,"^",4)_")",1:"") S M=1
"RTN","DG3PR2",33,0)
 Q
"RTN","DG3PR2",34,0)
OP S M=0 F K=8:1:12 S L=$P(J,"^",K) I L S DXD=$$ICDOP^ICDCODE(+L,$G(DGDAT)) W:M ! W ?45,$S(+DXD>0:$P(DXD,"^",2)_" ("_$P(DXD,"^",5)_")",1:"") S M=1
"RTN","DG3PR2",35,0)
 Q
"RTN","DG3PR2",36,0)
LOL S X1=I,X2=DGPR D DTC S DGLOL=X
"RTN","DG3PR2",37,0)
 F K=DGPR+.0000005:0 S K=$O(^DGPM("APCA",DFN,DGCA,K)) Q:'K!(K>I)  S C=$O(^(+K,0)) I $D(^DGPM(+C,0)),"^2^3^13^43^44^45^"[("^"_$P(^(0),"^",18)_"^") S X1=$O(^DGPM("APCA",DFN,DGCA,K)),X1=$S('X1:I,X1>I:I,1:X1),X2=K D DTC S DGLOL=DGLOL-X
"RTN","DG3PR2",38,0)
 Q
"RTN","DG3PR2",39,0)
HEAD N I,J,K,L,M,Y I $E(IOST,1)="C" S DIR(0)="E" D ^DIR S DGFL=Y I 'DGFL Q
"RTN","DG3PR2",40,0)
 W @IOF,!,"THIRD PARTY REIMBURSEMENT",?49,"PRINTED:  ",DGNOW
"RTN","DG3PR2",41,0)
 W !,"("_$P(^DPT(DFN,0),"^",1)_")",!
"RTN","DG3PR2",42,0)
 Q
"RTN","DG3PR2",43,0)
INS2 ;insurance data continued
"RTN","DG3PR2",44,0)
 ;570
"RTN","DG3PR2",45,0)
 N X
"RTN","DG3PR2",46,0)
 ;I $P(X,"^",2)="N" S DGINS=1
"RTN","DG3PR2",47,0)
 ;S X=$P(J,"^",4) W:X]"" ?63,$E(X,4,5),"/",$E(X,6,7),"/",$E(X,2,3) S X=$P(J,"^",6) W ?73,$S(X="v":"VETERAN",X="s":"SPOUSE",X="o":"OTHER",1:"UNKNOWN")
"RTN","DG3PR2",48,0)
 I $P(DGIBINS(I,9),U,2)="NO" S DGINS=1
"RTN","DG3PR2",49,0)
 S X=DGIBINS(I,11) W:X]"" ?63,$$FMTE^XLFDT(X,"2D")
"RTN","DG3PR2",50,0)
 S X=$P(DGIBINS(I,12),U) W ?73,$S(X="P":"VETERAN",X="S":"SPOUSE",X="O":"OTHER",1:"UNKNOWN")
"RTN","DG3PR2",51,0)
 Q
"RTN","DG3PR2",52,0)
DTC N I,J,K,L,M,Y D ^%DTC Q
"RTN","DGBLRV")
0^14^B20450982
"RTN","DGBLRV",1,0)
DGBLRV ;ALB/BOK - PATIENT ADMISSION FORM/BILL REVIEW ; 18 SEP 86  11:00
"RTN","DGBLRV",2,0)
 ;;5.3;Registration;**26,570**;Aug 13, 1993
"RTN","DGBLRV",3,0)
 ;
"RTN","DGBLRV",4,0)
 D LO^DGUTL K ^UTILITY($J)
"RTN","DGBLRV",5,0)
START S DIC="^DPT(",DIC(0)="AEQMZ" D ^DIC G QUIT:Y'>0 S DFN=+Y I '$D(^DGPM("ATID1",DFN)) W !,"No admissions on file, will check scheduled admissions",! G SCHAD
"RTN","DGBLRV",6,0)
 S DIC("S")="I $P(^(0),U,2)=1" D EN^DGPMUTL K DIC I Y'>0 W !,"Since an admission was not chosen, scheduled admissions for this patient will be checked",! G SCHAD
"RTN","DGBLRV",7,0)
 S DGPMDA=+Y G IO
"RTN","DGBLRV",8,0)
SCHAD I '$D(^DGS(41.1,"B",DFN)) W !,"No scheduled admissions on file" G QUIT
"RTN","DGBLRV",9,0)
 S DGPMDA=0
"RTN","DGBLRV",10,0)
IO K DIS(0) S DGPGM="RET^DGBLRV",DGVAR="DFN^DGPMDA" W !!,"This report requires 132 column output",! D ZIS^DGUTQ G QUIT:POP U IO S X=132 X ^%ZOSF("RM")
"RTN","DGBLRV",11,0)
RET S:'$D(DGPMDA) DGPMDA=0 K DGADT,DGADX,DGINAD,DGSDT,DGSDX,I S DGINFO=^DPT(DFN,0) D PID^VADPT6
"RTN","DGBLRV",12,0)
 I DGPMDA S DGI=$S($D(^DGPM(DGPMDA,0)):^(0),1:"") Q:DGI']""  S Y=$P(DGI,"^",1) D D^DIQ S DGADT=Y,DGADX=$P(DGI,"^",10),DGWD=$P(DGI,"^",6) G INS
"RTN","DGBLRV",13,0)
 S DGI=$O(^DGS(41.1,"B",DFN,0)),DGI=^DGS(41.1,DGI,0),DGSDT=$P(DGI,U,2) S Y=DGSDT D D^DIQ S DGSDT=Y,DGSDX=$P(DGI,U,4),DGWD=$P(DGI,U,8)
"RTN","DGBLRV",14,0)
 ;
"RTN","DGBLRV",15,0)
INS ; -- new insurance logic, modified for IBBAPI insurance call, DG*570
"RTN","DGBLRV",16,0)
 N DGIBINS,DGIBDT,DGDATA,DGIB,DGX
"RTN","DGBLRV",17,0)
 S DGIBDT=$S($D(DGPMDA):+$G(^DGPM(DGPMDA,0)),$G(DGSDT):DGSDT,1:DT)
"RTN","DGBLRV",18,0)
 S DGIBDT=$P(DGIBDT,".")
"RTN","DGBLRV",19,0)
 S DGIB=$$INSUR^IBBAPI(DFN,DGIBDT,"R",.DGDATA,"*")
"RTN","DGBLRV",20,0)
 S DGX="DGDATA(""IBBAPI"",""INSUR"")" M DGIBINS=@DGX
"RTN","DGBLRV",21,0)
 S P=1,I=0
"RTN","DGBLRV",22,0)
 I DGIB F  S I=$O(DGIBINS(I)) Q:'I  D
"RTN","DGBLRV",23,0)
 . I DGIBINS(I,11)>DT!(DGIBINS(I,11)="") D
"RTN","DGBLRV",24,0)
 . . K DGINAD D:DGI ADDR
"RTN","DGBLRV",25,0)
 . . S I(P)=+DGIBINS(I,1)_U_DGIBINS(I,14)_U
"RTN","DGBLRV",26,0)
 . . N DGGRP
"RTN","DGBLRV",27,0)
 . . S DGGRP=DGIBINS(I,18) ; Group Policy Number
"RTN","DGBLRV",28,0)
 . . S I(P)=I(P)_$G(DGGRP)_U
"RTN","DGBLRV",29,0)
 . . S I(P)=I(P)_$P(DGIBINS(I,8),U,2)_U_$S($D(DGINAD):DGINAD,1:"NO ADDRESS ON FILE")
"RTN","DGBLRV",30,0)
 . . S P=P+1
"RTN","DGBLRV",31,0)
 ;
"RTN","DGBLRV",32,0)
PRT K DIC S DIC(0)="M",X="DGBILLREVIEW",DIC="^DIC(47," D ^DIC G QUIT:Y'>0 S DGY=+Y I '$D(DIS(0)) I $$FIRST^DGUTL G Q
"RTN","DGBLRV",33,0)
 S P=0 F DGLN=0:0 S DGLN=$O(^DIC(47,+DGY,1,DGLN)) Q:'DGLN  S J=^(DGLN,0),X1="" W ! F K=1:1 W $E($P(J,"{}",K),$S(K=1:1,X1']"":1,1:$L(X)+1),999) S X1=$P(J,"{",K+1),P=$S(DGLN<9:1,DGLN<14:2,1:3) Q:X1']""  D CKLN
"RTN","DGBLRV",34,0)
Q W ! Q:$D(DIS(0))  I '$D(DGOPT) D CLOSE^DGUTQ
"RTN","DGBLRV",35,0)
QUIT D ENDREP^DGUTL I '$D(DGPMA) K DFN,DGPMDA
"RTN","DGBLRV",36,0)
 K DGADT,DGADX,DGI,DGIMULT,DGINAD,DGINFO,DGINS,DGLN,DGPGM,DGSDT,DGSDX,DGVAR,DGWD,DGY,DIC,I,J,K,P,X,X1,L,VA,Y,POP Q
"RTN","DGBLRV",37,0)
 Q
"RTN","DGBLRV",38,0)
 ;
"RTN","DGBLRV",39,0)
CKLN S L=$S(DGLN>9&(DGLN<14):(DGLN-5),DGLN>14&(DGLN<19):(DGLN-10),1:DGLN)_K D @L Q
"RTN","DGBLRV",40,0)
ADDR ; 
"RTN","DGBLRV",41,0)
 S DGINAD=$S(DGIBINS(I,2)]"":DGIBINS(I,2)_", ",1:"")_$S(DGIBINS(I,2)]"":DGIBINS(I,3)_", ",1:"")_$S(DGIBINS(I,4)]"":$P(DGIBINS(I,4),U,2)_", ",1:"")_$S(DGIBINS(I,5)]"":DGIBINS(I,5)_", ",1:"")
"RTN","DGBLRV",42,0)
 Q
"RTN","DGBLRV",43,0)
21 S Y=DT D DT^DIQ Q
"RTN","DGBLRV",44,0)
31 W $P(DGINFO,U,1) Q
"RTN","DGBLRV",45,0)
32 W VA("PID") Q
"RTN","DGBLRV",46,0)
51 W $S($D(DGIBINS(P)):$P(DGIBINS(P,1),U,2),1:"") Q
"RTN","DGBLRV",47,0)
61 W $S($D(I(P)):$P(I(P),U,5),1:"") Q
"RTN","DGBLRV",48,0)
71 W $S($D(DGIBINS(P)):DGIBINS(P,6),1:"") Q
"RTN","DGBLRV",49,0)
72 W $S($D(I(P)):$P(I(P),U,2),1:"") Q
"RTN","DGBLRV",50,0)
73 W $S($D(I(P)):$P(I(P),U,3),1:"") Q
"RTN","DGBLRV",51,0)
81 W " " Q  ; Pre-certification phone# not currently available in API
"RTN","DGBLRV",52,0)
82 W " " Q  ; Billing phone# not currently available in API
"RTN","DGBLRV",53,0)
201 W $S($D(DGADX):DGADX,$D(DGSDX):DGSDX,1:"") Q
"RTN","DGBLRV",54,0)
202 S X=$S(DGWD:DGWD,1:"-") W $S($D(^DIC(42,X,0)):$P(^(0),U,1),1:"") Q
"RTN","DGBLRV",55,0)
211 W $S($D(DGSDT):DGSDT,1:"") Q
"RTN","DGBLRV",56,0)
212 W $S($D(DGADT):DGADT,1:"") Q
"RTN","DGBLRV",57,0)
 ;
"RTN","DGBLRV",58,0)
EN1 S DIC="^DGPM(",BY="@.01",L=0,FLDS="[DGPMBLRV]",DHD="@"
"RTN","DGBLRV",59,0)
 S DIS(0)="S DFN=$P(^DGPM(D0,0),U,3) I $P(^(0),""^"",2)=1,$D(^DPT(DFN,""VET"")),($P(^(""VET""),""^"",1)=""Y""),$$INSUR^IBBAPI(DFN,"""",""A"")"
"RTN","DGBLRV",60,0)
 D EN1^DIP,QUIT K BY,DHD,DIC,DIS,FLDS,I Q
"RTN","DGBLRV",61,0)
 ;
"RTN","DGBLRV",62,0)
CK ;check logic to see if 3rd party review is asked
"RTN","DGBLRV",63,0)
 ;***if this logic is altered, also change line EN1+1 in DIS(0)***
"RTN","DGBLRV",64,0)
 I $S('$$INSUR^IBBAPI(DFN,"","A"):1,'$D(^DPT(DFN,"VET")):1,^("VET")'="Y":1,1:0) Q
"RTN","DGBLRV",65,0)
ASK ;print TPR?
"RTN","DGBLRV",66,0)
 W !,"PRINT THIRD PARTY REVIEW" S %=$S($D(DGDEF):DGDEF,1:2) D YN^DICN
"RTN","DGBLRV",67,0)
 I %=2!(%<0) Q
"RTN","DGBLRV",68,0)
 I '% W !!,"CHOOSE FROM",!?4,"YES - If you wish to print Third Party Review Sheet",!?4,"NO  - If you don't want to print Third Party Review Sheet",! G ASK
"RTN","DGBLRV",69,0)
 Q:$D(DGNOQ)  ;quit if from 10/10 w/out registration
"RTN","DGBLRV",70,0)
 K DGPTPR S DGPGM="RET^DGBLRV",DGVAR="DFN"_$S($D(DGPMDA):"^DGPMDA",1:"") K DIS D ZIS^DGUTQ I 'POP U IO D RET^DGBLRV
"RTN","DGBLRV",71,0)
 K DGPGM,DGVAR Q
"RTN","DGIBDSP")
0^24^B6183279
"RTN","DGIBDSP",1,0)
DGIBDSP ;ALB/SCK - FORMATTED INSURANCE DISPLAY ; 16-JUNE-04
"RTN","DGIBDSP",2,0)
 ;;5.3;Registration;**570**;Aug 13, 1993
"RTN","DGIBDSP",3,0)
 ; This routine replaces the supported API DISP^IBCNS which provided a formatted
"RTN","DGIBDSP",4,0)
 ; display of patient insurance information.  This functionality was removed
"RTN","DGIBDSP",5,0)
 ; when DBIA10146 was retired.
"RTN","DGIBDSP",6,0)
 ;
"RTN","DGIBDSP",7,0)
 Q
"RTN","DGIBDSP",8,0)
 ;
"RTN","DGIBDSP",9,0)
DISP ;-Display all insurance company information
"RTN","DGIBDSP",10,0)
 ;  -input DFN
"RTN","DGIBDSP",11,0)
 ;  -input DGSTAT [optional] Defaults to "RAB" if not defined.
"RTN","DGIBDSP",12,0)
 ;
"RTN","DGIBDSP",13,0)
 N DGDTIN
"RTN","DGIBDSP",14,0)
 Q:'$D(DFN)  D:'$D(IOF) HOME^%ZIS
"RTN","DGIBDSP",15,0)
 ;
"RTN","DGIBDSP",16,0)
 N X,DGINS,DGX,DGRTN,DGERR,DGY
"RTN","DGIBDSP",17,0)
 ;
"RTN","DGIBDSP",18,0)
 I '$D(DGSTAT) S DGSTAT="RAB"
"RTN","DGIBDSP",19,0)
 S DGX=$$INSUR^IBBAPI(DFN,"",DGSTAT,.DGRTN,"*")
"RTN","DGIBDSP",20,0)
 S:DGX<0 DGERR=$O(DGRTN("IBBAPI","INSUR","ERROR",0))
"RTN","DGIBDSP",21,0)
 ;
"RTN","DGIBDSP",22,0)
 D HDR
"RTN","DGIBDSP",23,0)
 I $G(DGERR) W !?6,DGRTN("IBBAPI","INSUR","ERROR",DGERR) G DISPQ
"RTN","DGIBDSP",24,0)
 I 'DGX W !,"    No Insurance Information" G DISPQ
"RTN","DGIBDSP",25,0)
 ;
"RTN","DGIBDSP",26,0)
 M DGINS=DGRTN("IBBAPI","INSUR")
"RTN","DGIBDSP",27,0)
 S DGY=0
"RTN","DGIBDSP",28,0)
 F  S DGY=$O(DGINS(DGY)) Q:'DGY  D D1(DGY)
"RTN","DGIBDSP",29,0)
 ;
"RTN","DGIBDSP",30,0)
DISPQ K DGSTAT
"RTN","DGIBDSP",31,0)
 Q
"RTN","DGIBDSP",32,0)
 ;
"RTN","DGIBDSP",33,0)
HDR ; -- print standard header
"RTN","DGIBDSP",34,0)
 D HDR1("=",IOM-$S($G(DGDTIN):1,1:4))
"RTN","DGIBDSP",35,0)
 Q
"RTN","DGIBDSP",36,0)
 ;
"RTN","DGIBDSP",37,0)
HDR1(CHAR,LENG) ; -- print header, specify character
"RTN","DGIBDSP",38,0)
 N OFF
"RTN","DGIBDSP",39,0)
 S OFF=$S($G(DGDTIN):0,1:2)
"RTN","DGIBDSP",40,0)
 W !?(1+OFF),"Insurance",?(13+OFF),"COB",?(17+OFF),"Subscriber ID",?(35+OFF),"Group",?(47+OFF),"Holder",?(55+OFF),"Effect"_$S('OFF:"",1:"i")_"ve",?(65+OFF+$S('OFF:0,1:1)),"Expires" W:'OFF ?75,"Only"
"RTN","DGIBDSP",41,0)
 I $G(CHAR)'="",LENG S X="",$P(X,CHAR,LENG)="" W !?(1+OFF),X
"RTN","DGIBDSP",42,0)
 Q
"RTN","DGIBDSP",43,0)
 ;
"RTN","DGIBDSP",44,0)
D1(DGVAL) ; 
"RTN","DGIBDSP",45,0)
 N DGX,DGY,DGZ,CAT,OFF
"RTN","DGIBDSP",46,0)
 ;
"RTN","DGIBDSP",47,0)
 Q:'$D(DGINS)
"RTN","DGIBDSP",48,0)
 S OFF=$S($G(DGDTIN):0,1:2)
"RTN","DGIBDSP",49,0)
 W !?(1+OFF),$S($D(DGINS(DGVAL,1)):$E($P(DGINS(DGVAL,1),U,2),1,10),1:"UNKNOWN")
"RTN","DGIBDSP",50,0)
 S X=+DGINS(DGVAL,7) I X'="" S X=$S(X=1:"p",X=2:"s",X=3:"t",1:"")
"RTN","DGIBDSP",51,0)
 W ?(14+OFF),X
"RTN","DGIBDSP",52,0)
 W ?(17+OFF),$E(DGINS(DGVAL,14),1,16)
"RTN","DGIBDSP",53,0)
 W ?(35+OFF),$E(DGINS(DGVAL,18),1,10)
"RTN","DGIBDSP",54,0)
 S DGX=$P(DGINS(DGVAL,12),U,1)
"RTN","DGIBDSP",55,0)
 W ?(47+OFF),$S(DGX="P":"SELF",DGX="S":"SPOUSE",1:"OTHER")
"RTN","DGIBDSP",56,0)
 W ?(55+OFF),$$FMTE^XLFDT(DGINS(DGVAL,10),"2DF"),?(65+OFF+$S(OFF:1,1:0)),$$FMTE^XLFDT(DGINS(DGVAL,11),"2DF")
"RTN","DGIBDSP",57,0)
 I 'OFF D
"RTN","DGIBDSP",58,0)
 .I $P(DGINS(DGVAL,9),U,2)="NO" W ?75,"*WNR*" Q
"RTN","DGIBDSP",59,0)
 Q
"RTN","DGPMGLG5")
0^22^B4902085
"RTN","DGPMGLG5",1,0)
DGPMGLG5 ;ALB/LM - G&L GENERATION, CONT.; 27 APR 2003
"RTN","DGPMGLG5",2,0)
 ;;5.3;Registration;**34,137,515,570**;Aug 13, 1993
"RTN","DGPMGLG5",3,0)
 ;
"RTN","DGPMGLG5",4,0)
A ;
"RTN","DGPMGLG5",5,0)
 S NLS=0 ; non-loss indicator
"RTN","DGPMGLG5",6,0)
 I MV("TT")=2!(MV("TT")=3) D NLS ; MV("TT")=2 (transfer) MV("TT")=3 (disch)
"RTN","DGPMGLG5",7,0)
 I MV("TT")=1!(MV("TT")=3)!(MV("TT")=6) D ID ; MV("TT")=1 (adm)  MV("TT")=6 (TS transfer)
"RTN","DGPMGLG5",8,0)
 ;
"RTN","DGPMGLG5",9,0)
Q Q
"RTN","DGPMGLG5",10,0)
 ;
"RTN","DGPMGLG5",11,0)
NLS ;  Non-Loss
"RTN","DGPMGLG5",12,0)
 S X=$P(MDP,"^",18) ;  type of movement
"RTN","DGPMGLG5",13,0)
 I "^1^2^3^25^26^"[("^"_X_"^") S NLS=+X ;  NLS=1 (PASS), NLS=2 (AA), NLS=3 (UA), NLS=25 (FROM AA TO UA), NLS=26 (FROM UA TO AA)
"RTN","DGPMGLG5",14,0)
 S:MV("MT")=42 NLS=42 ;  WHILE ASIH
"RTN","DGPMGLG5",15,0)
 S:MV("MT")=47 NLS=47 ;  DISCHARGE FROM NHCU/DOM WHILE ASIH
"RTN","DGPMGLG5",16,0)
 Q
"RTN","DGPMGLG5",17,0)
 ;
"RTN","DGPMGLG5",18,0)
ID ; ID info for patient and legend LEG(X) setup
"RTN","DGPMGLG5",19,0)
 ; Q:MV("TT")'=1!(MV("TT")'=3)  ;  1=adm, 3=disch
"RTN","DGPMGLG5",20,0)
 ;  Means Test
"RTN","DGPMGLG5",21,0)
 ;I MT,$D(^DG(41.3,DFN,0)) S X=9999999.999998-TO S X=+$O(^DG(41.3,DFN,2,X)) I $D(^(X,0)) S X=$P(^(0),"^",2) I "^A^B^C^R^"[("^"_X_"^") S X=$C($A(X)+32),ID=ID_X,LEG(X)="" K X
"RTN","DGPMGLG5",22,0)
 I MT,$D(^DGMT(408.31,"C",DFN)) N DGX,X D
"RTN","DGPMGLG5",23,0)
 . S DGX=$$MTIENLT^DGMTU3(1,DFN,-TO)
"RTN","DGPMGLG5",24,0)
 . I $D(^DGMT(408.31,+DGX,0)) D
"RTN","DGPMGLG5",25,0)
 . . S X=$P(^(0),"^",3),X=$P(^DG(408.32,+X,0),"^",2)
"RTN","DGPMGLG5",26,0)
 . . I $G(X)="P" D  ;evaluate pending adjudication to MT (C) or GMT (G)
"RTN","DGPMGLG5",27,0)
 . . . I '$D(DGX) S X="U" Q
"RTN","DGPMGLG5",28,0)
 . . . S X=$$PA^DGMTUTL(DGX),X=$S('$D(X):"U",X="MT":"C",X="GMT":"G",1:"U")
"RTN","DGPMGLG5",29,0)
 . . I "^A^B^C^G^R^"[("^"_X_"^") S X=$C($A(X)+32),ID=ID_X,LEG(X)="" K X,DGX
"RTN","DGPMGLG5",30,0)
INS ;  Reimburse Insurance (+)
"RTN","DGPMGLG5",31,0)
 S INS=0
"RTN","DGPMGLG5",32,0)
 N DGINS,DGX
"RTN","DGPMGLG5",33,0)
 ; API returns ONLY Active and Re-imbursable Insurance entries
"RTN","DGPMGLG5",34,0)
 I $$INSUR^IBBAPI(DFN,"","",.DGINS,9) D
"RTN","DGPMGLG5",35,0)
 . S DGX=0 F  S DGX=$O(DGINS("IBBAPI","INSUR",DGX)) Q:'DGX  S INS=INS+1
"RTN","DGPMGLG5",36,0)
 S:INS>0 ID=ID_"+",LEG("+")=""
"RTN","DGPMGLG5",37,0)
 K INS,INS1,JJ
"RTN","DGPMGLG5",38,0)
 Q:MV("TT")'=3
"RTN","DGPMGLG5",39,0)
 ;  While ASIH (*), Discharge after less than 48 hours (#)
"RTN","DGPMGLG5",40,0)
 I $D(^DGPM(+MV("CA"),0)) S X=^(0) S:$P(X,"^",15) ID=ID_"*",LEG("*")="" S X1=+X,X2=2 D C^%DTC I +MD'>X S ID=ID_"#",LEG("#")="" K X,X1,X2
"RTN","DGPMGLG5",41,0)
 ;  Absence (!)
"RTN","DGPMGLG5",42,0)
 I MDP]"",$P(MDP,"^",2)=2 S X=$P(MDP,"^",18) I "^1^2^3^25^26^"[("^"_X_"^") S ID=ID_"!",LEG("!")="" K X
"RTN","DGPMGLG5",43,0)
 Q
"RTN","DGPMVBUR")
0^15^B14242436
"RTN","DGPMVBUR",1,0)
DGPMVBUR ;ALB/MIR - UR ADMISSION BULLETIN FOR MCCR ; 9/16/03 2:24pm
"RTN","DGPMVBUR",2,0)
 ;;5.3;Registration;**26,31,483,549,570**;AUG 13, 1993
"RTN","DGPMVBUR",3,0)
 ;
"RTN","DGPMVBUR",4,0)
UR ;UR bulletin
"RTN","DGPMVBUR",5,0)
 K DGPMUR
"RTN","DGPMVBUR",6,0)
 D INS I '$D(DGPMUR(10)) D URQ Q
"RTN","DGPMVBUR",7,0)
 S DGPMX=$O(^XMB(3.8,"B","DGPM UR ADMISSION",0)) I '$O(^XMB(3.8,+DGPMX,1,0)) K DGPMX D URQ Q  ; if no mailgroup members, quit
"RTN","DGPMVBUR",8,0)
 S XMSUB="UR ADMISSION BULLETIN",XMTEXT="DGPMUR(",DGPMBLN=0
"RTN","DGPMVBUR",9,0)
 S XMY("G.DGPM UR ADMISSION")="" ; pass mailgroup
"RTN","DGPMVBUR",10,0)
 D PID^VADPT6 S DGPMBL="Admission for  : "_$P(^DPT(DFN,0),"^",1)_"   "_VA("PID") D SETLN
"RTN","DGPMVBUR",11,0)
 S Y=+DGPMA X ^DD("DD") S DGPMBL="Date/Time      : "_Y D SETLN
"RTN","DGPMVBUR",12,0)
 S DGPMBL="Type of Admit  : "_$S($D(^DG(405.1,+$P(DGPMA,"^",4),0)):$P(^(0),"^",1),1:"") D SETLN
"RTN","DGPMVBUR",13,0)
 S DGPMBL=" " D SETLN
"RTN","DGPMVBUR",14,0)
 S DGPMBL="Ward Location  : "_$S($D(^DIC(42,+$P(DGPMA,"^",6),0)):$P(^(0),"^",1),1:"UNKNOWN") D SETLN
"RTN","DGPMVBUR",15,0)
 S DGPMBL="Room-Bed       : "_$S($D(^DG(405.4,+$P(DGPMA,"^",7),0)):$P(^(0),"^",1),1:"UNKNOWN") D SETLN
"RTN","DGPMVBUR",16,0)
 S DGPMBL="Admitting DX   : "_$P(DGPMA,"^",10) D SETLN
"RTN","DGPMVBUR",17,0)
 S DGPMBL=" " D SETLN
"RTN","DGPMVBUR",18,0)
 S DGPMBLN=DGPMLAST D V72HR  ; visits in last 72 hours
"RTN","DGPMVBUR",19,0)
 D DIS ;SC disabilities
"RTN","DGPMVBUR",20,0)
 D ^XMD
"RTN","DGPMVBUR",21,0)
URQ K DGPMBL,DGPMBLN,DGPMLAST,DGPMUR,DGTMP,XMY,XMSUB,XMTEXT
"RTN","DGPMVBUR",22,0)
 K %,%Y,DGPMOB,DGPMOW,DGPMX,I,X,X1,X2,Y,DGIBINS
"RTN","DGPMVBUR",23,0)
 Q
"RTN","DGPMVBUR",24,0)
 ;
"RTN","DGPMVBUR",25,0)
INS ;get insurance effective at time of admission, start at DGPMBLN=10
"RTN","DGPMVBUR",26,0)
 S DGPMBLN=9
"RTN","DGPMVBUR",27,0)
 K DGIBINS
"RTN","DGPMVBUR",28,0)
 N DGX,DGDATA,DGIB
"RTN","DGPMVBUR",29,0)
 ;
"RTN","DGPMVBUR",30,0)
 S DGIB=$$INSUR^IBBAPI(DFN,"","",.DGDATA,"*") ; Returns Active, Reimbursable Ins. only
"RTN","DGPMVBUR",31,0)
 S DGX="DGDATA(""IBBAPI"",""INSUR"")" M DGIBINS=@DGX
"RTN","DGPMVBUR",32,0)
 F I=0:0 S I=$O(DGIBINS(I)) Q:'I  D ACT
"RTN","DGPMVBUR",33,0)
 ;
"RTN","DGPMVBUR",34,0)
 I $D(DGPMUR(10)) S DGPMLAST=DGPMBLN
"RTN","DGPMVBUR",35,0)
 Q
"RTN","DGPMVBUR",36,0)
 ;
"RTN","DGPMVBUR",37,0)
ACT ;is insurance active?  If so, set in DGPMBLN array
"RTN","DGPMVBUR",38,0)
 I DGIBINS(I,11)<+DGPMA,DGIBINS(I,11)]"" Q  ;insurance expired before admission
"RTN","DGPMVBUR",39,0)
 I DGIBINS(I,10)>+DGPMA Q  ;insurance effective after admission
"RTN","DGPMVBUR",40,0)
 Q:'+DGIBINS(I,1)
"RTN","DGPMVBUR",41,0)
 ; get insurance company information
"RTN","DGPMVBUR",42,0)
 S DGPMBL="Insurance Co.  : "_$P(DGIBINS(I,1),"^",2) D SETLN
"RTN","DGPMVBUR",43,0)
 S DGTMP=$P(DGIBINS(I,8),U,2)
"RTN","DGPMVBUR",44,0)
 I DGTMP']"" S DGTMP=$S($G(DGIBNS(I,18))]"":DGIBINS(I,18),1:"")
"RTN","DGPMVBUR",45,0)
 I DGTMP']"" S DGTMP=""
"RTN","DGPMVBUR",46,0)
 I DGTMP]"" S DGPMBL="Group          : "_DGTMP D SETLN
"RTN","DGPMVBUR",47,0)
 S DGPMBL="Policy Holder  : "_DGIBINS(I,13) D SETLN
"RTN","DGPMVBUR",48,0)
 S DGPMBL="Subscriber ID  : "_DGIBINS(I,14) D SETLN
"RTN","DGPMVBUR",49,0)
 S DGPMBL="Ins. Co Phone# : "_$S(DGIBINS(I,6)]"":DGIBINS(I,6),1:"UNKNOWN") D SETLN
"RTN","DGPMVBUR",50,0)
 S DGPMBL=" " D SETLN
"RTN","DGPMVBUR",51,0)
 Q
"RTN","DGPMVBUR",52,0)
DIS ;rated disabilities
"RTN","DGPMVBUR",53,0)
 I $S('$D(^DPT(DFN,.3)):1,$P(^(.3),"^",1)'="Y":1,1:"") Q  ;not service connected...
"RTN","DGPMVBUR",54,0)
 I $S('$D(^DPT(DFN,"VET")):1,$P(^("VET"),"^",1)'="Y":1,1:0),$S('$D(^DG(391,+$S($D(^DPT(DFN,"TYPE")):^("TYPE"),1:""),0)):1,$P(^(0),"^",2):0,1:1) Q
"RTN","DGPMVBUR",55,0)
 ;X=0 node, X1=already one SC disability?
"RTN","DGPMVBUR",56,0)
 S X1=0 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  I $D(^(I,0)) S X=^(0) I $P(X,"^",3)&$D(^DIC(31,+X,0)) S DGPMBL=$S('X1:"SC Disabilities: ",1:"                 ")_$P(^(0),"^",1)_" ("_+$P(X,"^",2)_"%)" S X1=1 D SETLN
"RTN","DGPMVBUR",57,0)
 Q
"RTN","DGPMVBUR",58,0)
V72HR ; GET INFORMATION FROM VISITS FOR THE LAST 72 HOURS
"RTN","DGPMVBUR",59,0)
 NEW X,X1,X2,IDEN,ID,LOCN,HSPN
"RTN","DGPMVBUR",60,0)
 S X1=+DGPMA,X2=-3
"RTN","DGPMVBUR",61,0)
 D C^%DTC
"RTN","DGPMVBUR",62,0)
 S X=X-.0001
"RTN","DGPMVBUR",63,0)
GVTIME ; LOOP THROUGH "B" INDEX OF ^AUPNVSIT FILE
"RTN","DGPMVBUR",64,0)
 S X=$O(^AUPNVSIT("B",X))
"RTN","DGPMVBUR",65,0)
 I X="" Q
"RTN","DGPMVBUR",66,0)
 I X'<+DGPMA Q
"RTN","DGPMVBUR",67,0)
 S IDEN=""
"RTN","DGPMVBUR",68,0)
GVID ; CHECK FOR CORRECT PATIENT
"RTN","DGPMVBUR",69,0)
 S IDEN=$O(^AUPNVSIT("B",X,IDEN))
"RTN","DGPMVBUR",70,0)
 I IDEN="" G GVTIME
"RTN","DGPMVBUR",71,0)
 I +$P($G(^AUPNVSIT(IDEN,0)),"^",5)'=+DFN G GVID
"RTN","DGPMVBUR",72,0)
 S LOCN=$P(^AUPNVSIT(IDEN,0),"^",22)
"RTN","DGPMVBUR",73,0)
 ; DG/549
"RTN","DGPMVBUR",74,0)
 I $G(LOCN)>0 S HSPN=$P($G(^SC(LOCN,0)),"^",1)
"RTN","DGPMVBUR",75,0)
 E  S HSPN="Unknown location" I $P($G(^AUPNVSIT(IDEN,0)),"^",7)="E" S HSPN=HSPN_"-Event(Historical)"
"RTN","DGPMVBUR",76,0)
 ;
"RTN","DGPMVBUR",77,0)
 S Y=+X X ^DD("DD")
"RTN","DGPMVBUR",78,0)
 S DGPMBL="Previous Visit : "_HSPN_" "_Y
"RTN","DGPMVBUR",79,0)
 D SETLN
"RTN","DGPMVBUR",80,0)
 G GVID
"RTN","DGPMVBUR",81,0)
 Q
"RTN","DGPMVBUR",82,0)
SETLN ;--set line in xmtext array
"RTN","DGPMVBUR",83,0)
 S DGPMBLN=DGPMBLN+1
"RTN","DGPMVBUR",84,0)
 S DGPMUR(DGPMBLN)=DGPMBL
"RTN","DGPMVBUR",85,0)
 Q
"RTN","DGRP1")
0^17^B22054109
"RTN","DGRP1",1,0)
DGRP1 ;ALB/MRL - DEMOGRAPHIC DATA ; 7/24/03 11:46am
"RTN","DGRP1",2,0)
 ;;5.3;Registration;**109,161,506,244,546,570**;Aug 13, 1993
"RTN","DGRP1",3,0)
 ;
"RTN","DGRP1",4,0)
EN S (DGRPS,DGRPW)=1 D H^DGRPU F I=0,.11,.121,.13,.15,.24,57 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRP1",5,0)
 I $P(DGRP(.15),"^",2)]"" S Z="APPLICANT IS LISTED AS 'INELIGIBLE' FOR TREATMENT!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",6,0)
 I $P(DGRP(.15),"^",3)]"" S Z="APPLICANT IS LISTED AS 'MISSING'.  NOTIFY APPROPRIATE PERSONNEL!",DGRPCM=1 D WW^DGRPV S DGRPCM=0
"RTN","DGRP1",7,0)
 W ! S Z=1 D WW^DGRPV W "    Name: " S Z=$P(DGRP(0),"^",1),Z1=31 D WW1^DGRPV W "SS: " S X=$P(DGRP(0),"^",9),Z=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),Z1=13 D WW1^DGRPV S Y=$P(DGRP(0),"^",3) X ^DD("DD") W "DOB: ",Y
"RTN","DGRP1",8,0)
 D GETNCAL  ;Display name component and alias information
"RTN","DGRP1",9,0)
 S Z=3,DGRPX=DGRP(0) D WW^DGRPV W " Remarks: ",$S($P(DGRPX,"^",10)]"":$E($P(DGRPX,"^",10),1,65),1:"NO REMARKS ENTERED FOR THIS PATIENT") S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU I $P(DGRP(.121),"^",9)="Y" S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRP1",10,0)
 S Z=4 D WW^DGRPV W " Permanent Address: " S Z=" ",Z1=17
"RTN","DGRP1",11,0)
 D WW1^DGRPV S Z=5,DGRPW=0 D WW^DGRPV W " Temporary Address: "
"RTN","DGRP1",12,0)
 W !?11
"RTN","DGRP1",13,0)
 S Z1=40,Z=$S($D(DGA(1)):DGA(1),1:"NONE ON FILE") D WW1^DGRPV W $S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRP1",14,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?11 W:'(I#2) ?51 W DGA(I)
"RTN","DGRP1",15,0)
 S DGCC=$S($D(^DIC(5,+$P(DGRP(.11),U,5),1,+$P(DGRP(.11),U,7),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W !?3,"County: ",DGCC K DGCC
"RTN","DGRP1",16,0)
 S DGCC=$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$D(^DIC(5,+$P(DGRP(.121),U,5),1,+$P(DGRP(.121),U,11),0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W ?43,"County: ",DGCC K DGCC
"RTN","DGRP1",17,0)
 W !?4,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S($P(DGRP(.121),U,9)'="Y":"NOT APPLICABLE",$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU)
"RTN","DGRP1",18,0)
 S X="NOT APPLICABLE" I $P(DGRP(.121),U,9)="Y" S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRP1",19,0)
 W !?3,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU),?42,"From/To: ",X
"RTN","DGRP1",20,0)
 W !?1,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$P(DGRP(.11),U,16))
"RTN","DGRP1",21,0)
 ;
"RTN","DGRP1",22,0)
 ; ***  Additional displays added for Pre-Registration
"RTN","DGRP1",23,0)
 I $G(DGPRFLG)=1 D
"RTN","DGRP1",24,0)
 . W !
"RTN","DGRP1",25,0)
 . N I,MIS1,X,X1,SA1,TP1,X2,X3,ES1
"RTN","DGRP1",26,0)
 . I $D(^DIA(2,"B",DFN)) S X="" F I=1:1 S X=$O(^DIA(2,"B",DFN,X)) Q:X<1  I $P(^DIA(2,X,0),U,3)=.05 S MIS1=$P(^DIA(2,X,0),U,2)
"RTN","DGRP1",27,0)
 . W:$D(MIS1)>0 !," [MARITAL STATUS CHANGED:] "_$$FMTE^XLFDT(MIS1,"5D")
"RTN","DGRP1",28,0)
 . I $D(^DIA(2,"B",DFN)) S X1="" F I=1:1 S X1=$O(^DIA(2,"B",DFN,X1)) Q:X1<1  S:$P(^DIA(2,X1,0),U,3)=.111 SA1=$P(^DIA(2,X1,0),U,2)
"RTN","DGRP1",29,0)
 . W:$D(SA1)>0 !," [STREET ADDRESS LAST CHANGED:] "_$$FMTE^XLFDT(SA1,"5D")
"RTN","DGRP1",30,0)
 . I $D(^DIA(2,"B",DFN)) S X2="" F I=1:1 S X2=$O(^DIA(2,"B",DFN,X2)) Q:X2<1  S:$P(^DIA(2,X2,0),U,3)=.131 TP1=$P(^DIA(2,X2,0),U,2)
"RTN","DGRP1",31,0)
 . W:$D(TP1)>0 !," [HOME PHONE NUMBER CHANGED:] "_$$FMTE^XLFDT(TP1,"5D")
"RTN","DGRP1",32,0)
 . I $D(^DIA(2,"B",DFN)) S X3="" F I=1:1 S X3=$O(^DIA(2,"B",DFN,X3)) Q:X3<1  S:$P(^DIA(2,X3,0),U,3)=.31115 ES1=$P(^DIA(2,X3,0),U,2)
"RTN","DGRP1",33,0)
 . W:$D(ES1)>0 !," [EMPLOYMENT STATUS CHANGED:] "_$$FMTE^XLFDT(ES1,"5D")
"RTN","DGRP1",34,0)
 . ; The IB Insurance API does not provide date entered or edited information, so this information will not be displayed for preregistration
"RTN","DGRP1",35,0)
 . I $$INSUR^IBBAPI(DFN,"","AR",.DGDATA,"1,10,11") F DGI=0:0 S DGI=$O(DGDATA("IBBAPI","INSUR",DGI)) Q:'DGI  D
"RTN","DGRP1",36,0)
 .. W !," [INSURANCE:] ",$P(DGDATA("IBBAPI","INSUR",DGI,1),U,2)
"RTN","DGRP1",37,0)
 .. W "  EFFECTIVE DATE: ",$$FMTE^XLFDT(DGDATA("IBBAPI","INSUR",DGI,10),"5D"),"  EXPIRATION DATE: ",$$FMTE^XLFDT(DGDATA("IBBAPI","INSUR",DGI,11),"5D")
"RTN","DGRP1",38,0)
 ;
"RTN","DGRP1",39,0)
 G ^DGRPP
"RTN","DGRP1",40,0)
 ;
"RTN","DGRP1",41,0)
GETNCAL ;Get name component values
"RTN","DGRP1",42,0)
 N DGCOMP,DGNC,DGI,DGA,DGALIAS,DGX,DGRPW
"RTN","DGRP1",43,0)
 S DGNC="Family^Given^Middle^Prefix^Suffix^Degree"
"RTN","DGRP1",44,0)
 S DGCOMP=+$G(^DPT(DFN,"NAME"))_","
"RTN","DGRP1",45,0)
 I DGCOMP D GETS^DIQ(20,DGCOMP,"1:6",,"DGCOMP")
"RTN","DGRP1",46,0)
 ;Get alias values
"RTN","DGRP1",47,0)
 S DGA=0 F DGI=1:1:6 D  Q:'$D(DGALIAS(DGI))
"RTN","DGRP1",48,0)
A2 .S DGA=$O(^DPT(DFN,.01,DGA))
"RTN","DGRP1",49,0)
 .I 'DGA D:DGI=1  Q
"RTN","DGRP1",50,0)
 ..S DGALIAS(DGI)="< No alias entries on file >" Q
"RTN","DGRP1",51,0)
 .I DGI=6 S DGALIAS(DGI)="< More alias entries on file >" Q
"RTN","DGRP1",52,0)
 .S DGX=$G(^DPT(DFN,.01,DGA,0)) G:'$L(DGX) A2
"RTN","DGRP1",53,0)
 .S DGALIAS(DGI)=$P(DGX,U),DGX=$P(DGX,U,2)
"RTN","DGRP1",54,0)
 .I $L(DGX) D
"RTN","DGRP1",55,0)
 ..S DGX=" "_$E(DGX,1,3)_"-"_$E(DGX,4,5)_"-"_$E(DGX,6,9)
"RTN","DGRP1",56,0)
 ..S $E(DGALIAS(DGI),20)=DGX Q
"RTN","DGRP1",57,0)
 .S DGALIAS(DGI)=$E(DGALIAS(DGI),1,31)
"RTN","DGRP1",58,0)
 .Q
"RTN","DGRP1",59,0)
 ;Display name component and alias data
"RTN","DGRP1",60,0)
 F DGI=1:1:6 D
"RTN","DGRP1",61,0)
 .W !?5,$J($P(DGNC,U,DGI),6),": ",$E($G(DGCOMP(20,DGCOMP,DGI)),1,$S(DGI=1:23,1:27))
"RTN","DGRP1",62,0)
 .I DGI=1 S DGRPW=0,Z=2 W ?37 D WW^DGRPV W " Alias: "
"RTN","DGRP1",63,0)
 .W ?48,$G(DGALIAS(DGI))
"RTN","DGRP1",64,0)
 .Q
"RTN","DGRP1",65,0)
 Q
"RTN","DGRP5")
0^18^B2663401
"RTN","DGRP5",1,0)
DGRP5 ;ALB/MRL - REGISTRATION SCREEN 5/INSURANCE INFORMATION ;06 JUN 88@2300
"RTN","DGRP5",2,0)
 ;;5.3;Registration;**190,366,570**;Aug 13, 1993
"RTN","DGRP5",3,0)
 S DGRPW=1,DGRPS=5 D H^DGRPU S Z=1 D WW^DGRPV W " Covered by Health Insurance: " S Z=$S($D(^DPT(DFN,.31)):$P(^(.31),"^",11),1:""),Z=$S(Z="Y":"YES",Z="N":"NO",Z="U":"UNKNOWN",1:"NOT ANSWERED"),Z1=15 D WW1^DGRPV
"RTN","DGRP5",4,0)
 W ! D DISP^DGIBDSP
"RTN","DGRP5",5,0)
 W ! S DGRPX=$G(^DPT(DFN,.38)),Z=2 D WW^DGRPV W " Eligible for MEDICAID: ",$S(+DGRPX:"YES",$P(DGRPX,"^",1)=0:"NO",1:DGRPU)
"RTN","DGRP5",6,0)
 S Y=$P(DGRPX,"^",2) I Y X ^DD("DD") W "   [last updated ",Y,"]"
"RTN","DGRP5",7,0)
 ;; *** Added for Medicaid information
"RTN","DGRP5",8,0)
 W ! S Z=3 D WW^DGRPV W " Medicaid Number: ",$P(DGRPX,U,3) ;previous $S($P(DGRPX,U,3)>0:$P(DGRPX,U,3),1:"")
"RTN","DGRP5",9,0)
 G ^DGRPP
"RTN","DGRP5",10,0)
IN ; This code is no longer called, replaced by DISP^IBCNSP2
"RTN","DGRP5",11,0)
 Q
"RTN","DGRPC2")
0^23^B59651485
"RTN","DGRPC2",1,0)
DGRPC2 ;ALB/MRL/SCK/PJR - CHECK CONSISTENCY OF PATIENT DATA (CONT) ; 5/28/04 8:52am
"RTN","DGRPC2",2,0)
 ;;5.3;Registration;**45,69,108,121,205,218,342,387,470,467,489,505,507,528,451,564,570**;Aug 13, 1993
"RTN","DGRPC2",3,0)
 ;
"RTN","DGRPC2",4,0)
43 ;off
"RTN","DGRPC2",5,0)
44 ;off
"RTN","DGRPC2",6,0)
45 ;off
"RTN","DGRPC2",7,0)
46 ;off
"RTN","DGRPC2",8,0)
47 ;off
"RTN","DGRPC2",9,0)
 S DGLST=$S(DGCHK[",47,":47,DGCHK[",46,":46,DGCHK[",45,":45,DGCHK[",44,":44,1:DGLST)
"RTN","DGRPC2",10,0)
 D NEXT G @DGLST
"RTN","DGRPC2",11,0)
48 I DGVT S DGD=DGP(.362) I DGCHK[(",48,"),($P(DGD,"^",17)="Y"),($P(DGD,"^",6)="") S X=48 D COMB
"RTN","DGRPC2",12,0)
 D NEXT G @DGLST
"RTN","DGRPC2",13,0)
49 ;
"RTN","DGRPC2",14,0)
50 ; insurance checks
"RTN","DGRPC2",15,0)
 I DGCHK[",49,"!(DGCHK[",50,") D  S DGLST=$S(DGCHK["50":50,1:49)
"RTN","DGRPC2",16,0)
 . N COV,INS,X
"RTN","DGRPC2",17,0)
 . S X=0,COV=$S($P(DGP(.31),"^",11)="Y":1,1:0)
"RTN","DGRPC2",18,0)
 . S INS=$$INSUR^IBBAPI(DFN,DT,"R")
"RTN","DGRPC2",19,0)
 . I COV,'INS S X=49 ; yes, but none
"RTN","DGRPC2",20,0)
 . I 'COV,INS S X=50 ; not yes, but some
"RTN","DGRPC2",21,0)
 . I DGCHK[(","_X_",") D COMB
"RTN","DGRPC2",22,0)
 D NEXT G @DGLST
"RTN","DGRPC2",23,0)
51 D NEXT G @DGLST ; 51 disabled
"RTN","DGRPC2",24,0)
 S X=$S($D(^DIC(21,+$P(DGP(.32),"^",3),0)):$P(^(0),"^",3),1:"")
"RTN","DGRPC2",25,0)
 I X="Z"&($P(DGP(.32),"^",5)'=7)&($P(DGP(.32),"^",10)'=7)&($P(DGP(.32),"^",15)'=7)!($P(DGP(.32),"^",5)=7&(X'="Z")) S X=51 D COMB
"RTN","DGRPC2",26,0)
 ;
"RTN","DGRPC2",27,0)
52 I $P(DGP(.31),"^",11)']"" S X=52 D COMB ;automatically on
"RTN","DGRPC2",28,0)
 D NEXT G @DGLST
"RTN","DGRPC2",29,0)
53 I $P(DGP(.311),"^",15)']"" S X=53 D COMB ;automatically on
"RTN","DGRPC2",30,0)
 D NEXT G @DGLST
"RTN","DGRPC2",31,0)
54 ;
"RTN","DGRPC2",32,0)
55 ;BELOW IS USED BY BOTH 54 & 55
"RTN","DGRPC2",33,0)
 S DGLST=$S(DGCHK["55":55,1:54)
"RTN","DGRPC2",34,0)
 I $G(^DPT(DFN,.35)),(^(.35)<+($E(DT,1,3)_"0000")) D NEXT G @DGLST ; patient died before current year
"RTN","DGRPC2",35,0)
 N DGE S DGE=+$O(^DIC(8.1,"B","SERVICE CONNECTED 50% to 100%",0))
"RTN","DGRPC2",36,0)
 I $P($G(^DPT(DFN,.3)),U,2)'<50!($P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),U,9)=DGE) D NEXT G @DGLST ;50-100% SC
"RTN","DGRPC2",37,0)
 S DGPTYP=$G(^DG(391,+DGP("TYPE"),"S")),DGISYR=$E(DT,1,3)-1_"0000" I '$P(DGPTYP,"^",8)&('$P(DGPTYP,"^",9)) K DGPTYP,DGISYR D NEXT G @DGLST ; screens 8 and 9 off
"RTN","DGRPC2",38,0)
 D ALL^DGMTU21(DFN,"VSD",DT,"IP")
"RTN","DGRPC2",39,0)
 I '$P(DGPTYP,"^",8)!(DGCHK'["54") G JUST55 ; screen 8 off OR JUST 55 IN CHK
"RTN","DGRPC2",40,0)
 S DGFL=0 I $D(DGREL("S")),($$SSN^DGMTU1(+DGREL("S"))']"") S DGFL=1
"RTN","DGRPC2",41,0)
 I 'DGFL F I=0:0 S I=$O(DGREL("D",I)) Q:'I  I $$SSN^DGMTU1(+DGREL("D",I))']"" S DGFL=1 Q
"RTN","DGRPC2",42,0)
 I DGFL S X=54 D COMB
"RTN","DGRPC2",43,0)
JUST55 I DGCHK'["55" D NEXT G @DGLST
"RTN","DGRPC2",44,0)
 S DGLST=55
"RTN","DGRPC2",45,0)
 I '$P(DGPTYP,"^",9) D NEXT G @DGLST ; screen 9 off
"RTN","DGRPC2",46,0)
 D TOT^DGRP9(.DGINC) S DGFL=0
"RTN","DGRPC2",47,0)
 F DGD="V","S","D" I $D(DGTOT(DGD)) F I=8:1:17 I $P(DGTOT(DGD),"^",I)]"" S DGFL=1 Q
"RTN","DGRPC2",48,0)
 I 'DGFL N DGAPD,DG55 D  I 'DGAPD&('DG55)  S X=55 D COMB
"RTN","DGRPC2",49,0)
 . S DGAPD=+$$LST^DGMTU(DFN),DGAPD=+$P($G(^DGMT(408.31,+DGAPD,0)),U,11)
"RTN","DGRPC2",50,0)
 . S DG55=$$CHECK55(DFN) ; **507, Additional Income Checks
"RTN","DGRPC2",51,0)
 D NEXT G @DGLST
"RTN","DGRPC2",52,0)
56 I DGVT S DGD=DGP(.3) I DGCHK[(",56,"),($P(DGD,"^",11)="Y"),($P(DGP(.362),"^",20)="") S X=56 D COMB
"RTN","DGRPC2",53,0)
 D NEXT G END^DGRPC3:$S('+DGLST:1,+DGLST=99:1,1:0) G @DGLST
"RTN","DGRPC2",54,0)
57 I $P(DGP(.38),U,1) D
"RTN","DGRPC2",55,0)
 .N X1,X2
"RTN","DGRPC2",56,0)
 .S X1=$P(DGP(.38),U,2)
"RTN","DGRPC2",57,0)
 .S X=$P($G(^DG(43,1,0)),U,46) S X2=$S(X:X,1:365) D C^%DTC
"RTN","DGRPC2",58,0)
 .I X<DT S X=57 D COMB
"RTN","DGRPC2",59,0)
 D NEXT G @DGLST
"RTN","DGRPC2",60,0)
58 ;58 - EC Claim - No Gulf/Som Svc
"RTN","DGRPC2",61,0)
 ;off
"RTN","DGRPC2",62,0)
 D NEXT G @DGLST
"RTN","DGRPC2",63,0)
59 ;59 - incomplete Catastrophic Disability info
"RTN","DGRPC2",64,0)
 I $$HASCAT^DGENCDA(DFN) D
"RTN","DGRPC2",65,0)
 .I '$P(DGP(.39),"^",2) S X=59 D COMB
"RTN","DGRPC2",66,0)
 D NEXT G @DGLST
"RTN","DGRPC2",67,0)
60 ;60 - Location of agent orange exposure unanswered
"RTN","DGRPC2",68,0)
 I DGVT,$P(DGP(.321),"^",2)="Y",$P(DGP(.321),"^",13)="" S X=60 D COMB
"RTN","DGRPC2",69,0)
 D NEXT G @DGLST
"RTN","DGRPC2",70,0)
61 ;61 - Incomplete Phone Number
"RTN","DGRPC2",71,0)
 I $P(DGP(.13),"^")=""!($P(DGP(.13),"^",2)="") S X=61 D COMB
"RTN","DGRPC2",72,0)
 D NEXT G @DGLST
"RTN","DGRPC2",73,0)
62 ;62 - Missing Emergency Contact Name
"RTN","DGRPC2",74,0)
 I $P(DGP(.33),"^")="" S X=62 D COMB
"RTN","DGRPC2",75,0)
 D NEXT G @DGLST
"RTN","DGRPC2",76,0)
63 ;Confidential Address check
"RTN","DGRPC2",77,0)
 I $P($$CAACT^DGRPCADD(DFN),U) D
"RTN","DGRPC2",78,0)
 .N DGI,DGERR
"RTN","DGRPC2",79,0)
 .S DGERR=0
"RTN","DGRPC2",80,0)
 .F DGI=1,4,5,6 Q:DGERR  I $P(DGP(.141),U,DGI)="" S DGERR=1
"RTN","DGRPC2",81,0)
 .I DGERR S X=63 D COMB
"RTN","DGRPC2",82,0)
 D NEXT G @DGLST
"RTN","DGRPC2",83,0)
64 ;64 - Place of Birth City/State Missing ;**505
"RTN","DGRPC2",84,0)
 I $P(DGP(0),"^",11)=""!($P(DGP(0),"^",12)="") S X=64 D COMB
"RTN","DGRPC2",85,0)
 D NEXT G @DGLST
"RTN","DGRPC2",86,0)
65 ;65 - Mother's Maiden Name Missing ;**505
"RTN","DGRPC2",87,0)
 I $P(DGP(.24),"^",3)="" S X=65 D COMB
"RTN","DGRPC2",88,0)
 D NEXT G @DGLST
"RTN","DGRPC2",89,0)
66 ;66 - Pseudo SSN in use ;**505
"RTN","DGRPC2",90,0)
 I $P(DGP(0),"^",9)["P" S X=66 D COMB
"RTN","DGRPC2",91,0)
 D NEXT G @DGLST
"RTN","DGRPC2",92,0)
67 ;67 - Serv Sep Date [Last] missing or imprecise, patch 528
"RTN","DGRPC2",93,0)
 N DGG
"RTN","DGRPC2",94,0)
 S DGG=$$CVELIG^DGCV(DFN)
"RTN","DGRPC2",95,0)
 I $G(DGG)["A"!($G(DGG)["F") S X=67 D COMB
"RTN","DGRPC2",96,0)
 D NEXT G @DGLST
"RTN","DGRPC2",97,0)
68 ;used for 68-71, for Combat Vet, DG*5.3*528
"RTN","DGRPC2",98,0)
69 ;
"RTN","DGRPC2",99,0)
70 ;
"RTN","DGRPC2",100,0)
71 ;
"RTN","DGRPC2",101,0)
 ;68 - Combat To Date missing or imprecise, patch 528
"RTN","DGRPC2",102,0)
 ;69 - Yugoslavia To Date missing or imprecise, patch 528
"RTN","DGRPC2",103,0)
 ;70 - Somalia To Date missing or imprecise, patch 528
"RTN","DGRPC2",104,0)
 ;71 - Persian Gulf To Date missing or imprecise, patch 528
"RTN","DGRPC2",105,0)
 N DGG
"RTN","DGRPC2",106,0)
 S DGG=$$CVELIG^DGCV(DFN)
"RTN","DGRPC2",107,0)
 I DGG["B"!(DGG["G") S X=68 D COMB
"RTN","DGRPC2",108,0)
 I DGG["C"!(DGG["H") S X=69 D COMB
"RTN","DGRPC2",109,0)
 I DGG["D"!(DGG["I") S X=70 D COMB
"RTN","DGRPC2",110,0)
 I DGG["E"!(DGG["J") S X=71 D COMB
"RTN","DGRPC2",111,0)
 S DGLST=71
"RTN","DGRPC2",112,0)
 D NEXT G @DGLST
"RTN","DGRPC2",113,0)
72 ;; MSE - Required Fields
"RTN","DGRPC2",114,0)
 S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK I MSERR S X=72 D COMB
"RTN","DGRPC2",115,0)
 D NEXT G @DGLST
"RTN","DGRPC2",116,0)
73 ;; An MSE FROM date precedes an MSE TO date
"RTN","DGRPC2",117,0)
 S:'$G(MSECHK) MSECHK=$$MSCK^DGMSCK I MSDATERR D NEXT G @DGLST
"RTN","DGRPC2",118,0)
 F I1=6,11,16 I '$$B4^DGRPDT($P(DGP(.32),"^",I1),$P(DGP(.32),"^",I1+1),1) S X=73 D COMB S (MSERR,MSDATERR)=1 Q
"RTN","DGRPC2",119,0)
 D NEXT G @DGLST
"RTN","DGRPC2",120,0)
74 ;; Conflict Date Missing or Incomplete
"RTN","DGRPC2",121,0)
 S:'$G(CONCHK) CONCHK=$$CNCK^DGMSCK I CONERR S X=74 D COMB
"RTN","DGRPC2",122,0)
 D NEXT G @DGLST
"RTN","DGRPC2",123,0)
75 ;; Conflict TO date precedes FROM date
"RTN","DGRPC2",124,0)
76 ;; Conflict Date out of range for conflict
"RTN","DGRPC2",125,0)
 S:'$G(CONCHK) CONCHK=$$CNCK^DGMSCK
"RTN","DGRPC2",126,0)
 S LOC="",(I5,I6)=0 F I1=1:1 S LOC=$O(CONSPEC(LOC)) Q:LOC=""  I CONARR(LOC)=1 D
"RTN","DGRPC2",127,0)
 .N FROMDAT,FROMPC,TODAT,TOPC,NODE,DATA
"RTN","DGRPC2",128,0)
 .S DATA=CONSPEC(LOC)
"RTN","DGRPC2",129,0)
 .S NODE=$P(DATA,",",1),FROMPC=$P(DATA,",",3),TOPC=$P(DATA,",",4)
"RTN","DGRPC2",130,0)
 .S FROMDAT=$P(DGP(NODE),"^",FROMPC),TODAT=$P(DGP(NODE),"^",TOPC)
"RTN","DGRPC2",131,0)
 .I '$$B4^DGRPDT(FROMDAT,TODAT,1) S X=75 D COMB:'I5&(DGCHK[(",75,")) S CONARR(LOC)=2,I5=1 Q
"RTN","DGRPC2",132,0)
 .I DGCHK'[(",76,") Q
"RTN","DGRPC2",133,0)
 .S:'$G(RANSET) RANSET=$$RANGE^DGMSCK
"RTN","DGRPC2",134,0)
 .I '$$RWITHIN^DGRPDT($P(RANGE(LOC),"^",1),$P(RANGE(LOC),"^",2),FROMDAT,TODAT) S X=76 D COMB:'I6 S CONARR(LOC)=2,I6=1
"RTN","DGRPC2",135,0)
 .Q
"RTN","DGRPC2",136,0)
 S DGLST=76 D NEXT G @DGLST
"RTN","DGRPC2",137,0)
77 ;; Date out of range for POW Location
"RTN","DGRPC2",138,0)
 S:'$G(RANSET) RANSET=$$RANGE^DGMSCK
"RTN","DGRPC2",139,0)
 ;; Don't check if POW Data Incomplete or if POW TO precedes FROM
"RTN","DGRPC2",140,0)
 I ((","_DGER_",")[(",37,"))!((","_DGER_",")[(",38,")) D NEXT G @DGLST
"RTN","DGRPC2",141,0)
 I $P(DGP(.52),"^",5)'="Y" D NEXT G @DGLST ;; Don't check if no POW
"RTN","DGRPC2",142,0)
 S LOC=$$COMPOW^DGRPMS($P(DGP(.52),"^",6)) I LOC="" D NEXT G @DGLST
"RTN","DGRPC2",143,0)
 I '$$RWITHIN^DGRPDT($P(RANGE(LOC),"^",1),$P(RANGE(LOC),"^",2),$P(DGP(.52),"^",7),$P(DGP(.52),"^",8)) S X=77 D COMB
"RTN","DGRPC2",144,0)
 D NEXT G @DGLST
"RTN","DGRPC2",145,0)
78 ;; Date out of range for Combat Location
"RTN","DGRPC2",146,0)
 S:'$G(RANSET) RANSET=$$RANGE^DGMSCK
"RTN","DGRPC2",147,0)
 ;; Don't check if Combat Data Incomplete or if Combat TO precedes FROM
"RTN","DGRPC2",148,0)
 I ((","_DGER_",")[(",39,"))!((","_DGER_",")[(",40,")) D NEXT G @DGLST
"RTN","DGRPC2",149,0)
 I $P(DGP(.52),"^",11)'="Y" D NEXT G @DGLST ;; Don't check if no COMBAT
"RTN","DGRPC2",150,0)
 S LOC=$$COMPOW^DGRPMS($P(DGP(.52),"^",12)) I LOC="" D NEXT G @DGLST
"RTN","DGRPC2",151,0)
 I '$$RWITHIN^DGRPDT($P(RANGE(LOC),"^",1),$P(RANGE(LOC),"^",2),$P(DGP(.52),"^",13),$P(DGP(.52),"^",14)) S X=78 D COMB
"RTN","DGRPC2",152,0)
 D NEXT G @DGLST
"RTN","DGRPC2",153,0)
COMB S DGCT=DGCT+1,DGER=DGER_X_",",DGLST=X Q
"RTN","DGRPC2",154,0)
 ;
"RTN","DGRPC2",155,0)
NEXT S I=$F(DGCHK,(","_+DGLST_",")),DGLST=+$E(DGCHK,I,999) I +DGLST,+DGLST<79 Q
"RTN","DGRPC2",156,0)
 S:'DGLST DGLST="END^DGRPC3" I +DGLST S DGLST=DGLST_"^DGRPC3"
"RTN","DGRPC2",157,0)
 Q
"RTN","DGRPC2",158,0)
FIND F I=DGLST:1:99 I DGCHK[(","_I_",") Q
"RTN","DGRPC2",159,0)
 I DGNCK,(I>17),(I<36) S DGLST=36 G FIND
"RTN","DGRPC2",160,0)
 I I,I<99 S DGLST=I G @(DGLST_$S(DGLST>78:"^DGRPC3",DGLST>42:"",DGLST>17:"^DGRPC1",1:"^DGRPC"))
"RTN","DGRPC2",161,0)
 G END^DGRPC3
"RTN","DGRPC2",162,0)
 ;
"RTN","DGRPC2",163,0)
CHECK55(DFN) ;Buisness rules for additional 55-INCOME DATA MISSING checks
"RTN","DGRPC2",164,0)
 ;  Modeled from DGMTR checks.
"RTN","DGRPC2",165,0)
 ;  Input  DFN - IEN from PATIENT File #2
"RTN","DGRPC2",166,0)
 ;
"RTN","DGRPC2",167,0)
 ;  Output 1 - If Income check passes additional buisness rules
"RTN","DGRPC2",168,0)
 ;         0 - If Income check fails additional buisness rules
"RTN","DGRPC2",169,0)
 ;
"RTN","DGRPC2",170,0)
 N VAMB,VASV,VA,VADMVT,VAEL,VAINDT,DGRTN,DGMED,DG,DG1,DGWARD,DGSRVC
"RTN","DGRPC2",171,0)
 ;
"RTN","DGRPC2",172,0)
 S DGRTN=0
"RTN","DGRPC2",173,0)
 D MB^VADPT I +VAMB(7) S DGRTN=1 G Q55  ; Check if receiving VA Disability
"RTN","DGRPC2",174,0)
 D SVC^VADPT I +VASV(4) S DGRTN=1 G Q55  ; check if POW status indicated
"RTN","DGRPC2",175,0)
 I +VASV(9),(+VASV(9,1)=3) S DGRTN=1 G Q55  ; Check if Purple Heart Status is Confirmed
"RTN","DGRPC2",176,0)
 D GETS^DIQ(2,DFN_",",".381:.383","I","DGMED")
"RTN","DGRPC2",177,0)
 I $G(DGMED(2,DFN_",",.381,"I")) S DGRTN=1 G Q55  ; Check if eligible for Medicaid
"RTN","DGRPC2",178,0)
 D ADM^VADPT2 ; Check for current admission to DOM ward 
"RTN","DGRPC2",179,0)
 I +$G(VADMVT) D  G:DGRTN Q55
"RTN","DGRPC2",180,0)
 . Q:'$$GET1^DIQ(43,1,16,"I")  ; Has Dom wards?
"RTN","DGRPC2",181,0)
 . S DGWARD=$$GET1^DIQ(405,VADMVT,.06,"I") ; Get ward location
"RTN","DGRPC2",182,0)
 . S DGSRVC=$$GET1^DIQ(42,DGWARD,.03,"I") ; Get ward service
"RTN","DGRPC2",183,0)
 . S:DGSRVC="D" DGRTN=1 ; If ward service is 'D', then return 1
"RTN","DGRPC2",184,0)
 ;
"RTN","DGRPC2",185,0)
 ; Additional checks for 0% SC
"RTN","DGRPC2",186,0)
 D ELIG^VADPT
"RTN","DGRPC2",187,0)
 I +VAEL(3),'$P(VAEL(3),U,2) D  ; Check if service connected with % of zero
"RTN","DGRPC2",188,0)
 . I +VAMB(4) S DGRTN=1 Q  ; Check if receiving a VA pension
"RTN","DGRPC2",189,0)
 . S DG=0 ; Check for secondary eligibilities
"RTN","DGRPC2",190,0)
 . F  S DG=$O(VAEL(1,DG)) Q:'DG  D  Q:DGRTN
"RTN","DGRPC2",191,0)
 . . F DG1=2,4,15,16,17,18 I DG=DG1 S DGRTN=1 Q
"RTN","DGRPC2",192,0)
 ;
"RTN","DGRPC2",193,0)
Q55 D KVAR^VADPT
"RTN","DGRPC2",194,0)
 Q $G(DGRTN)
"RTN","DGRPDB")
0^19^B12888917
"RTN","DGRPDB",1,0)
DGRPDB ;ALB/AAS,JAN - VIEW ONLY SCREEN TO DETERMINE BILLING ELIGIBILITY ; 6/14/01 11:58am
"RTN","DGRPDB",2,0)
 ;;5.3;Registration;**26,50,358,570**;Aug 13, 1993
"RTN","DGRPDB",3,0)
 ;
"RTN","DGRPDB",4,0)
% S:'$D(DGQUIT) DGQUIT=0
"RTN","DGRPDB",5,0)
 G:DGQUIT END S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC G:+Y<1 END S DFN=+Y D EN
"RTN","DGRPDB",6,0)
 G %
"RTN","DGRPDB",7,0)
 ;
"RTN","DGRPDB",8,0)
EN ;entry with DFN defined.
"RTN","DGRPDB",9,0)
 Q:'$D(DFN)  D HOME^%ZIS,2^VADPT,HDR
"RTN","DGRPDB",10,0)
 D MT,AOIR,ELIG,DIS
"RTN","DGRPDB",11,0)
 N DGINS
"RTN","DGRPDB",12,0)
 I $$INSUR^IBBAPI(DFN,"","AR",.DGINS,1)
"RTN","DGRPDB",13,0)
 S C="",C=$O(DGINS("IBBAPI","INSUR",C),-1),C=+C+6
"RTN","DGRPDB",14,0)
 D:($Y>(IOSL-C)) PAUSE,HDR:'DGQUIT Q:DGQUIT  D INS,PAUSE
"RTN","DGRPDB",15,0)
 Q
"RTN","DGRPDB",16,0)
 ;
"RTN","DGRPDB",17,0)
ELIG ;eligibility code(s)
"RTN","DGRPDB",18,0)
 W !!," Primary Elig. Code: ",$P(VAEL(1),"^",2),"  --  ",$S(VAEL(8)']"":"NOT VERIFIED",1:$P(VAEL(8),"^",2))
"RTN","DGRPDB",19,0)
 I VAEL(8)]"" S Y=$S($D(^DPT(DFN,.361)):$P(^(.361),"^",2),1:"") W "  " D DT^DIQ
"RTN","DGRPDB",20,0)
 W !,"Other Elig. Code(s): " I $D(VAEL(1))>9 S I1=0 F I=0:0 S I=$O(VAEL(1,I)) Q:'I  S I1=I1+1 W:I1>1 !?21 W $P(VAEL(1,I),"^",2)
"RTN","DGRPDB",21,0)
 E  W "NO ADDITIONAL ELIGIBILITIES IDENTIFIED"
"RTN","DGRPDB",22,0)
 Q
"RTN","DGRPDB",23,0)
 ;
"RTN","DGRPDB",24,0)
DIS ;rated disabilities
"RTN","DGRPDB",25,0)
 ;
"RTN","DGRPDB",26,0)
 ;  This is called from the FEE and MCCR package!!!
"RTN","DGRPDB",27,0)
 ;
"RTN","DGRPDB",28,0)
 ;  Input:  DFN as IEN of PATIENT file
"RTN","DGRPDB",29,0)
 ;          VAEL array (if no passed, it is set) of eligibility info
"RTN","DGRPDB",30,0)
 ;
"RTN","DGRPDB",31,0)
 I '$D(VAEL) D ELIG^VADPT S DGKVAR=1
"RTN","DGRPDB",32,0)
 W:'+VAEL(3) !!,"  Service Connected: NO" W:+VAEL(3) !!,"         SC Percent: ",$P(VAEL(3),"^",2)_"%"
"RTN","DGRPDB",33,0)
 W !," Rated Disabilities: " I 'VAEL(4),$S('$D(^DG(391,+VAEL(6),0)):1,$P(^(0),"^",2):0,1:1) W "NOT A VETERAN" G DISQ
"RTN","DGRPDB",34,0)
 S I3=0 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=^(I,0),I2=$S($D(^DIC(31,+I1,0)):$P(^(0),"^",1)_" ("_+$P(I1,"^",2)_"%-"_$S($P(I1,"^",3):"SC",$P(I1,"^",3)']"":"not specified",1:"NSC")_")",1:""),I3=I3+1 W:I3>1 !?21 W I2
"RTN","DGRPDB",35,0)
 W:'I3 "NONE STATED"
"RTN","DGRPDB",36,0)
DISQ I $D(DGKVAR) D KVAR^VADPT K DGKVAR
"RTN","DGRPDB",37,0)
 K I,I1,I2,I3
"RTN","DGRPDB",38,0)
 Q
"RTN","DGRPDB",39,0)
 ;
"RTN","DGRPDB",40,0)
INS ;insurance information
"RTN","DGRPDB",41,0)
 ;
"RTN","DGRPDB",42,0)
 ;  This is called form the FEE package!!!
"RTN","DGRPDB",43,0)
 ;
"RTN","DGRPDB",44,0)
 ;  Input:  DFN as IEN of PATIENT file
"RTN","DGRPDB",45,0)
 ;          DGINSDT as date to compute insurance flag as of (default DT)
"RTN","DGRPDB",46,0)
 ;
"RTN","DGRPDB",47,0)
 Q:'$D(DFN)
"RTN","DGRPDB",48,0)
 W !!,"    Health Insurance: "
"RTN","DGRPDB",49,0)
 S Z=$$INSUR^IBBAPI(DFN,$S($D(DGINSDT):DGINSDT,1:DT))
"RTN","DGRPDB",50,0)
 W $S(Z:"YES",1:"NO")
"RTN","DGRPDB",51,0)
 D DISP^DGIBDSP
"RTN","DGRPDB",52,0)
INSQ K I,I1,DGX,Z
"RTN","DGRPDB",53,0)
 Q
"RTN","DGRPDB",54,0)
 ;
"RTN","DGRPDB",55,0)
IN ; Old code
"RTN","DGRPDB",56,0)
 Q
"RTN","DGRPDB",57,0)
 ;
"RTN","DGRPDB",58,0)
AOIR ;Agent Orange/ionizing radiation
"RTN","DGRPDB",59,0)
 S DGX=$S($D(^DPT(DFN,.321)):^(.321),1:"")
"RTN","DGRPDB",60,0)
 F I=2,3 S X=$P(DGX,"^",I) W:I=2 !,"           A/O Exp.: " W:I=3 "ION Rad.: " W $S(X="Y":"YES",X="N":"NO",X="U":"UNKNOWN",1:"NOT ANSWERED"),"   "
"RTN","DGRPDB",61,0)
 S X=$G(^DPT(DFN,.38)),X1=$P(X,"^",1) W "Medicaid Elig: ",$S(X1="":"NOT ANSWERED",'X1:"NO",1:"YES") I ($X+15)'>IOM W " - " S Y=$P(X,"^",2) D D^DIQ W $P(Y,"@")
"RTN","DGRPDB",62,0)
 Q
"RTN","DGRPDB",63,0)
 ;
"RTN","DGRPDB",64,0)
PAUSE F J=1:1 Q:($Y>(IOSL-3))  W !
"RTN","DGRPDB",65,0)
 S DGX1="" I $E(IOST,1,2)["C-" N DIR S DIR(0)="E" D ^DIR S DGQUIT='Y
"RTN","DGRPDB",66,0)
 Q
"RTN","DGRPDB",67,0)
 ;
"RTN","DGRPDB",68,0)
HDR ;Screen Header
"RTN","DGRPDB",69,0)
 W @IOF I $P(VAEL(6),"^",2)]"" S DGTYPE=$P(VAEL(6),"^",2)
"RTN","DGRPDB",70,0)
 W $P(VADM(1),"^",1),?32,VA("PID"),?47,$P(VADM(3),"^",2) S X=$S($D(DGTYPE):$P(DGTYPE,"^",1),1:"PATIENT TYPE UNKNOWN"),X1=79-$L(X) W ?X1,X
"RTN","DGRPDB",71,0)
 S X="",$P(X,"=",80)="" W !,X Q
"RTN","DGRPDB",72,0)
 Q
"RTN","DGRPDB",73,0)
 ;
"RTN","DGRPDB",74,0)
MT I '$O(^DGMT(408.31,"AD",1,DFN,0)) W !,"  Means Test Status:  NOT IN MEANS TEST FILE" Q
"RTN","DGRPDB",75,0)
 ;if patient is on a DOM ward, don't display Means Test required message
"RTN","DGRPDB",76,0)
 D DOM^DGMTR D:'$G(DGDOM) DIS^DGMTU(DFN) K DGDOM
"RTN","DGRPDB",77,0)
 Q
"RTN","DGRPDB",78,0)
 ;
"RTN","DGRPDB",79,0)
END D KVAR^VADPT
"RTN","DGRPDB",80,0)
 K A,C,I,I1,I2,I3,J,DIC,DIR,DFN,DGA1,DGMT,DGMTL,DGMTLA,DGX,DGX1,DGT,DGTYPE,DGQUIT,DGMTLL,X,X1,VAROOT,VA,Y,Z
"RTN","DGRPDB",81,0)
 Q
"RTN","DGRPTL3")
0^21^B13982838
"RTN","DGRPTL3",1,0)
DGRPTL3 ;ALB/RMO - 10-10T Registration - Build List Area Cont.;26 DEC 1996 08:00 am
"RTN","DGRPTL3",2,0)
 ;;5.3;Registration;**108,570**;08/13/93
"RTN","DGRPTL3",3,0)
 ;
"RTN","DGRPTL3",4,0)
EN(DGARY,DFN,DGLINE,DGCNT) ;Entry point to build list area cont.
"RTN","DGRPTL3",5,0)
 ; Input  -- DGARY    Global array subscript
"RTN","DGRPTL3",6,0)
 ;           DFN      Patient IEN
"RTN","DGRPTL3",7,0)
 ;           DGLINE   Line number
"RTN","DGRPTL3",8,0)
 ; Output -- DGCNT    Number of lines in the list
"RTN","DGRPTL3",9,0)
 N C,DGDEP,DGINC,DGINR,DGLYINC,DGREL,DGSP,DGSTART,X,Y
"RTN","DGRPTL3",10,0)
 ;
"RTN","DGRPTL3",11,0)
 ;Marital/Spouse
"RTN","DGRPTL3",12,0)
 S DGSTART=DGLINE ;starting line number
"RTN","DGRPTL3",13,0)
 D SET^DGRPTL1(DGARY,DGLINE,"Marital/Spouse",31,.DGCNT,IORVON,IORVOFF)
"RTN","DGRPTL3",14,0)
 ;
"RTN","DGRPTL3",15,0)
 ;Married last year
"RTN","DGRPTL3",16,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",17,0)
 D ALL^DGMTU21(DFN,"VS",DT,"IPR")
"RTN","DGRPTL3",18,0)
 S Y=$P($G(^DGMT(408.22,+$G(DGINR("V")),0)),U,5),C=$P(^DD(408.22,.05,0),U,2) D Y^DIQ
"RTN","DGRPTL3",19,0)
 D SET^DGRPTL1(DGARY,DGLINE,"Married Last Year: "_$S(Y'="":Y,1:"UNANSWERED"),1,.DGCNT)
"RTN","DGRPTL3",20,0)
 ;
"RTN","DGRPTL3",21,0)
 ;Spouse's name, ssn, dob
"RTN","DGRPTL3",22,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",23,0)
 S X=$P($G(DGREL("S")),U,2)
"RTN","DGRPTL3",24,0)
 S DGSP(0)=$S(X'="":$G(@(U_$P(X,";",2)_+X_",0)")),1:"")
"RTN","DGRPTL3",25,0)
 D SET^DGRPTL1(DGARY,DGLINE,"Spouse's Name: "_$E($P(DGSP(0),U),1,20),5,.DGCNT)
"RTN","DGRPTL3",26,0)
 S X=$P(DGSP(0),U,9) D SET^DGRPTL1(DGARY,DGLINE,"SS: "_$S(X'="":$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),1:""),42,.DGCNT)
"RTN","DGRPTL3",27,0)
 D SET^DGRPTL1(DGARY,DGLINE,"DOB: "_$S(DGSP(0)'="":$$FTIME^VALM1($P(DGSP(0),U,3)),1:""),59,.DGCNT)
"RTN","DGRPTL3",28,0)
 ;
"RTN","DGRPTL3",29,0)
 ;Income
"RTN","DGRPTL3",30,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",31,0)
 D SET^DGRPTL1(DGARY,DGLINE,"",1,.DGCNT)
"RTN","DGRPTL3",32,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",33,0)
 S DGLYINC=$P($G(^DGMT(408.21,+$G(DGINC("V")),0)),U,21)
"RTN","DGRPTL3",34,0)
 D SET^DGRPTL1(DGARY,DGLINE,"Income",31,.DGCNT,IORVON,IORVOFF)
"RTN","DGRPTL3",35,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",36,0)
 D SET^DGRPTL1(DGARY,DGLINE,"Last Year's Estimated ""Household"" Taxable Income: "_$S(DGLYINC'="":"$"_DGLYINC,1:"UNANSWERED"),1,.DGCNT)
"RTN","DGRPTL3",37,0)
 ;
"RTN","DGRPTL3",38,0)
 ;Insurance
"RTN","DGRPTL3",39,0)
 D INS(DGARY,DFN,.DGLINE,.DGCNT)
"RTN","DGRPTL3",40,0)
 Q
"RTN","DGRPTL3",41,0)
 ;
"RTN","DGRPTL3",42,0)
INS(DGARY,DFN,DGLINE,DGCNT) ;Insurance
"RTN","DGRPTL3",43,0)
 ; Input  -- DGARY    Global array subscript
"RTN","DGRPTL3",44,0)
 ;           DFN      Patient IEN
"RTN","DGRPTL3",45,0)
 ;           DGLINE   Line number
"RTN","DGRPTL3",46,0)
 ; Output -- DGCNT    Number of lines in the list
"RTN","DGRPTL3",47,0)
 N C,DGINS,DGRP,I,X,Y
"RTN","DGRPTL3",48,0)
 ;
"RTN","DGRPTL3",49,0)
 ;Insurance
"RTN","DGRPTL3",50,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",51,0)
 D SET^DGRPTL1(DGARY,DGLINE,"",1,.DGCNT)
"RTN","DGRPTL3",52,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",53,0)
 S DGRP(.31)=$G(^DPT(DFN,.31)) ;insurance
"RTN","DGRPTL3",54,0)
 D SET^DGRPTL1(DGARY,DGLINE,"Insurance",31,.DGCNT,IORVON,IORVOFF)
"RTN","DGRPTL3",55,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",56,0)
 S Y=$P(DGRP(.31),U,11),C=$P(^DD(2,.3192,0),U,2) D Y^DIQ
"RTN","DGRPTL3",57,0)
 D SET^DGRPTL1(DGARY,DGLINE,"Covered by Health Insurance: "_$S(Y'="":Y,1:"UNANSWERED"),1,.DGCNT)
"RTN","DGRPTL3",58,0)
 ;
"RTN","DGRPTL3",59,0)
 ;List insurance
"RTN","DGRPTL3",60,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",61,0)
 D SET^DGRPTL1(DGARY,DGLINE,"",1,.DGCNT)
"RTN","DGRPTL3",62,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",63,0)
 D SET^DGRPTL1(DGARY,DGLINE,"Insurance Co.      Subscriber ID     Group       Holder  Effective Expires",1,.DGCNT)
"RTN","DGRPTL3",64,0)
 S DGLINE=DGLINE+1
"RTN","DGRPTL3",65,0)
 D SET^DGRPTL1(DGARY,DGLINE,"============================================================================",1,.DGCNT)
"RTN","DGRPTL3",66,0)
 N DGX
"RTN","DGRPTL3",67,0)
 I $$INSUR^IBBAPI(DFN,"","AR",.DGX,"*")
"RTN","DGRPTL3",68,0)
 M DGINS=DGX("IBBAPI","INSUR")
"RTN","DGRPTL3",69,0)
 S I=0 F  S I=$O(DGINS(I)) Q:'I  D
"RTN","DGRPTL3",70,0)
 . S DGLINE=DGLINE+1
"RTN","DGRPTL3",71,0)
 . D SET^DGRPTL1(DGARY,DGLINE,$P(DGINS(I,1),U,2),1,.DGCNT)
"RTN","DGRPTL3",72,0)
 . D SET^DGRPTL1(DGARY,DGLINE,$E(DGINS(I,14),1,16),20,.DGCNT)
"RTN","DGRPTL3",73,0)
 . N DGGRP S DGGRP=$G(DGINS(I,18))
"RTN","DGRPTL3",74,0)
 . I DGGRP']"" S DGGRP=$P($G(DGINS(I,8)),U,2)
"RTN","DGRPTL3",75,0)
 . D SET^DGRPTL1(DGARY,DGLINE,$E(DGGRP,1,10),38,.DGCNT)
"RTN","DGRPTL3",76,0)
 . D SET^DGRPTL1(DGARY,DGLINE,$P(DGINS(I,12),U,2),50,.DGCNT)
"RTN","DGRPTL3",77,0)
 . D SET^DGRPTL1(DGARY,DGLINE,$S(DGINS(I,10)'="":$$FDATE^VALM1(DGINS(I,10)),1:""),58,.DGCNT)
"RTN","DGRPTL3",78,0)
 . D SET^DGRPTL1(DGARY,DGLINE,$S(DGINS(I,11)'="":$$FDATE^VALM1(DGINS(I,11)),1:""),67,.DGCNT)
"RTN","DGRPTL3",79,0)
 I '$D(DGINS) D
"RTN","DGRPTL3",80,0)
 . S DGLINE=DGLINE+1
"RTN","DGRPTL3",81,0)
 . D SET^DGRPTL1(DGARY,DGLINE,"No Insurance Information",1,.DGCNT)
"RTN","DGRPTL3",82,0)
 Q
"RTN","DGRPTP2")
0^16^B11418526
"RTN","DGRPTP2",1,0)
DGRPTP2 ;ALB/RMO - Print 10-10T Registration Cont.;10 JAN 1997 09:06 am
"RTN","DGRPTP2",2,0)
 ;;5.3;Registration;**108,570**;08/13/93
"RTN","DGRPTP2",3,0)
 ;
"RTN","DGRPTP2",4,0)
EN(DFN,DFN1,DGNAM,DGSSN,DGLNE,DGPGE) ;Entry point to print 10-10T cont.
"RTN","DGRPTP2",5,0)
 ; Input  -- DFN      Patient IEN
"RTN","DGRPTP2",6,0)
 ;           DFN1     Disposition multiple IEN  (optional)
"RTN","DGRPTP2",7,0)
 ;           DGNAM    Patient name
"RTN","DGRPTP2",8,0)
 ;           DGSSN    Patient ssn
"RTN","DGRPTP2",9,0)
 ;           DGLNE    Line format array
"RTN","DGRPTP2",10,0)
 ;           DGPGE    Page number
"RTN","DGRPTP2",11,0)
 ; Output -- None
"RTN","DGRPTP2",12,0)
 D INS(DFN,.DGLNE) ;insurance
"RTN","DGRPTP2",13,0)
 D SER(DFN,.DGLNE) ;service branch and number, marital
"RTN","DGRPTP2",14,0)
 D SPO(DFN,.DGLNE) ;spouse, income
"RTN","DGRPTP2",15,0)
 S DGPGE=1 D FT^DGRPTP(DFN,$G(DFN1),.DGLNE,.DGPGE) ;end of first page of form
"RTN","DGRPTP2",16,0)
 D HD^DGRPTP(DGNAM,DGSSN,.DGLNE) ;header
"RTN","DGRPTP2",17,0)
 D EN^DGRPTP3(.DGLNE) ;consent, co-pay, signature block, burden, privacy act
"RTN","DGRPTP2",18,0)
 S DGPGE=2 D FT^DGRPTP(DFN,$G(DFN1),.DGLNE,.DGPGE) ;end of second page of form
"RTN","DGRPTP2",19,0)
 Q
"RTN","DGRPTP2",20,0)
 ;
"RTN","DGRPTP2",21,0)
INS(DFN,DGLNE) ;Insurance
"RTN","DGRPTP2",22,0)
 ; Modified for IBBAPI call to rtn ins info, DG*570
"RTN","DGRPTP2",23,0)
 ; Input  -- DFN      Patient IEN
"RTN","DGRPTP2",24,0)
 ;           DGLNE    Line format array
"RTN","DGRPTP2",25,0)
 ; Output -- None
"RTN","DGRPTP2",26,0)
 N C,DGINS,DGRP,I,Y,DGX,DGDATA,DGIBAPI
"RTN","DGRPTP2",27,0)
 ;
"RTN","DGRPTP2",28,0)
 ;Insurance
"RTN","DGRPTP2",29,0)
 W !,"14A. Do You Have Health Coverage",?40,"|14B. Name of Health Insurance Carrier"
"RTN","DGRPTP2",30,0)
 S Y=$$GET1^DIQ(2,DFN,.3192)
"RTN","DGRPTP2",31,0)
 W !,?5,$S(Y'="":Y,1:"UNANSWERED")
"RTN","DGRPTP2",32,0)
 S DGIBAPI=$$INSUR^IBBAPI(DFN,DT,"",.DGDATA,1)
"RTN","DGRPTP2",33,0)
 S DGX="DGDATA(""IBBAPI"",""INSUR"")" M DGINS=@DGX
"RTN","DGRPTP2",34,0)
 S (C,I)=0 F  S I=$O(DGINS(I)) Q:'I  S DGINS=DGINS(I,1) D
"RTN","DGRPTP2",35,0)
 . S C=C+1
"RTN","DGRPTP2",36,0)
 . W:C>1 !
"RTN","DGRPTP2",37,0)
 . W ?40,"|     ",$P(DGINS,U,2)
"RTN","DGRPTP2",38,0)
 I '$D(DGINS) D
"RTN","DGRPTP2",39,0)
 . W ?40,"|     ","NO ACTIVE (UNEXPIRED) INSURANCE ON FILE FOR THIS APPLICANT"
"RTN","DGRPTP2",40,0)
 W ?131,$C(13) W:DGLNE("ULC")="-" ! W DGLNE("UL")
"RTN","DGRPTP2",41,0)
 Q
"RTN","DGRPTP2",42,0)
 ;
"RTN","DGRPTP2",43,0)
SER(DFN,DGLNE) ;Service branch and number, marital status
"RTN","DGRPTP2",44,0)
 ; Input  -- DFN      Patient IEN
"RTN","DGRPTP2",45,0)
 ;           DGLNE    Line format array
"RTN","DGRPTP2",46,0)
 ; Output -- None
"RTN","DGRPTP2",47,0)
 N C,DGRP,Y
"RTN","DGRPTP2",48,0)
 ;
"RTN","DGRPTP2",49,0)
 ;Service branch and number
"RTN","DGRPTP2",50,0)
 W !,"15. Branch of Service",?33,"|16. Latest Service Number",?65,"|17. Marital Status"
"RTN","DGRPTP2",51,0)
 S DGRP(.32)=$G(^DPT(DFN,.32)) ;military service
"RTN","DGRPTP2",52,0)
 W !?4,$E($$POINT^DG1010P0(DGRP(.32),5,23),1,20)
"RTN","DGRPTP2",53,0)
 W ?33,"|    ",$$DISP^DG1010P0(DGRP(.32),8)
"RTN","DGRPTP2",54,0)
 ;
"RTN","DGRPTP2",55,0)
 ;Marital status
"RTN","DGRPTP2",56,0)
 S DGRP(0)=$G(^DPT(DFN,0)) ;patient
"RTN","DGRPTP2",57,0)
 S Y=$P(DGRP(0),U,5),C=$P(^DD(2,.05,0),U,2) D Y^DIQ
"RTN","DGRPTP2",58,0)
 W ?65,"|    ",$S(Y'="":Y,1:"UNANSWERED")
"RTN","DGRPTP2",59,0)
 W ?131,$C(13) W:DGLNE("ULC")="-" ! W DGLNE("UL")
"RTN","DGRPTP2",60,0)
 Q
"RTN","DGRPTP2",61,0)
 ;
"RTN","DGRPTP2",62,0)
SPO(DFN,DGLNE) ;Spouse and income
"RTN","DGRPTP2",63,0)
 ; Input  -- DFN      Patient IEN
"RTN","DGRPTP2",64,0)
 ;           DGLNE    Line format array
"RTN","DGRPTP2",65,0)
 ; Output -- None
"RTN","DGRPTP2",66,0)
 N C,DGDEP,DGINC,DGINR,DGLYINC,DGREL,DGSP,X,Y
"RTN","DGRPTP2",67,0)
 ;
"RTN","DGRPTP2",68,0)
 ;Spouse's name, ssn
"RTN","DGRPTP2",69,0)
 W !,"18A. Spouse's Name",?65,"|18B. Spouse's Social Security Number"
"RTN","DGRPTP2",70,0)
 D ALL^DGMTU21(DFN,"VS",DT,"IPR")
"RTN","DGRPTP2",71,0)
 S X=$P($G(DGREL("S")),U,2)
"RTN","DGRPTP2",72,0)
 S DGSP(0)=$S(X'="":$G(@(U_$P(X,";",2)_+X_",0)")),1:"")
"RTN","DGRPTP2",73,0)
 I DGSP(0)'="" D
"RTN","DGRPTP2",74,0)
 . W !?5,$$DISP^DG1010P0(DGSP(0),1)
"RTN","DGRPTP2",75,0)
 . S X=$P(DGSP(0),U,9)
"RTN","DGRPTP2",76,0)
 . W ?65,"|     ",$S(X'="":$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10),1:"")
"RTN","DGRPTP2",77,0)
 ELSE  D
"RTN","DGRPTP2",78,0)
 . W !?5,"NOT APPLICABLE"
"RTN","DGRPTP2",79,0)
 . W ?65,"|"
"RTN","DGRPTP2",80,0)
 W ?131,$C(13) W:DGLNE("ULC")="-" ! W DGLNE("UL")
"RTN","DGRPTP2",81,0)
 ;
"RTN","DGRPTP2",82,0)
 ;Year of marriage, number of dependents, income
"RTN","DGRPTP2",83,0)
 W !,"18C. Year of Marriage",?33,"|18D. Number of Dependents",?65,"|19. Last Year's Estimated ""Household"" Taxable Income",!
"RTN","DGRPTP2",84,0)
 I DGSP(0)'="" D
"RTN","DGRPTP2",85,0)
 . W ?5,$$DATENP^DG1010P0($G(^DGPR(408.12,+DGREL("S"),"E",1,0)),1)
"RTN","DGRPTP2",86,0)
 S DGLYINC=$P($G(^DGMT(408.21,+$G(DGINC("V")),0)),U,21)
"RTN","DGRPTP2",87,0)
 W ?33,"|"
"RTN","DGRPTP2",88,0)
 W ?65,"|    ",$S(DGLYINC'="":"$"_DGLYINC,1:"UNANSWERED")
"RTN","DGRPTP2",89,0)
 Q
"RTN","DGUTL")
0^20^B21195521
"RTN","DGUTL",1,0)
DGUTL ;ALB/MRL - DG UTILITY FUNCTIONS ; 08 JAN 86
"RTN","DGUTL",2,0)
 ;;5.3;Registration;**279,570**;Aug 13, 1993
"RTN","DGUTL",3,0)
 ;
"RTN","DGUTL",4,0)
RI ;Reimbursable Insurance
"RTN","DGUTL",5,0)
 ; ** NOTE: This procedure appears to be obsolete, but code was modified
"RTN","DGUTL",6,0)
 ; for IB/AR Encapsulation anyways.
"RTN","DGUTL",7,0)
 S DGINS=$$INSUR^IBBAPI(DFN,"","A")
"RTN","DGUTL",8,0)
 Q
"RTN","DGUTL",9,0)
 ;
"RTN","DGUTL",10,0)
TS ;Table of Contents SET
"RTN","DGUTL",11,0)
 I '$D(^UTILITY($J,"DGTC",DGPAG)) S ^UTILITY($J,"DGTC",DGPAG,DGPAG1)="" Q
"RTN","DGUTL",12,0)
TP ;Table of Contents PRINT
"RTN","DGUTL",13,0)
 I '$D(^UTILITY($J,"DGTC")) Q
"RTN","DGUTL",14,0)
 D TH S J=0 F I=0:0 S J=$O(^UTILITY($J,"DGTC",J)),J1=0 Q:J=""  F I1=0:0 S J1=$O(^UTILITY($J,"DGTC",J,J1)) Q:J1=""  S X="",$P(X,".",(IOM-20-$L(J)-$L(J1)))="" W !?10,J,"  ",X,"  ",J1 I $Y>$S($D(IOSL):(IOSL-6),1:62) D TH
"RTN","DGUTL",15,0)
 W ! K ^UTILITY($J,"DGTC"),I,I1,J,J1,DGTCH,X,Y Q
"RTN","DGUTL",16,0)
TH ;Table of Contents HEADER
"RTN","DGUTL",17,0)
 W @IOF,!,"TABLE OF CONTENTS FOR '",$P(DGTCH,U,1),"'",?(IOM-11) S Y=DT X ^DD("DD") W Y,!?10,$P(DGTCH,U,2),?IOM-7-$L($P(DGTCH,U,3)),$P(DGTCH,U,3) S X="",$P(X,"=",IOM)="" W !,X K X Q
"RTN","DGUTL",18,0)
C ;Cover Page
"RTN","DGUTL",19,0)
 W @IOF S TT=0 F I=0:0 S I=$O(DGCPG(I)) Q:'I  S TT=TT+1,$P(DGCPG(I),U,2)=$S($D(IOM):IOM-$L($P(DGCPG(I),U,1))\2,1:132-$L($P(DGCPG(I),U,1))\2)
"RTN","DGUTL",20,0)
 S TT=$S($D(IOSL):IOSL-(TT*2+10)\2,1:66-(TT*2+10)\2) F I=1:1:TT W !
"RTN","DGUTL",21,0)
 F I=0:0 S I=$O(DGCPG(I)) Q:'I  W !!?$P(DGCPG(I),U,2),$P(DGCPG(I),U,1)
"RTN","DGUTL",22,0)
 I $D(DUZ),$D(^VA(200,+DUZ,0)) S X="Printed by:  "_$P(^(0),U,1),X1=$S($D(IOM):IOM-$L(X)\2,1:132-$L(X)\2) W !!?X1,X
"RTN","DGUTL",23,0)
 I $D(^DD("SITE"))#2 S X=^("SITE")_" ("_^("SITE",1)_")",X1=$S($D(IOM):IOM-$L(X)\2,1:132-$L(X)\2) W !!?X1,X
"RTN","DGUTL",24,0)
 I $D(DGCPT) X "F I=1:1:$S($D(IOSL):(IOSL-5),1:61)-$Y W !" W DGCPT
"RTN","DGUTL",25,0)
 W !! K TT,I,X,X1 Q
"RTN","DGUTL",26,0)
H ;Convert $H to Readable Date/Time
"RTN","DGUTL",27,0)
 D:'$D(DT) DT^DICRW S DGTIME=$P($H,",",2),DGTIME=DT+(DGTIME\3600/100)+(DGTIME\60#60/10000),DGDATE=DGTIME\1 Q
"RTN","DGUTL",28,0)
DIV ;Determine Division
"RTN","DGUTL",29,0)
 I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) S DGDIV="" Q
"RTN","DGUTL",30,0)
 S DGDIV=$S($O(^DG(40.8,0))>0:$O(^DG(40.8,0)),1:"") I DGDIV S DGDIV=DGDIV_"^"_$P(^DG(40.8,+DGDIV,0),"^",1)
"RTN","DGUTL",31,0)
 Q
"RTN","DGUTL",32,0)
DT W:$E(%,4,5) +$E(%,4,5)_"-" W:$E(%,6,7) +$E(%,6,7)_"-" W $E(%,1,3)+1700 W:%["." " ("_$E(%_0,9,10)_":"_$E(%_"000",11,12)_")" Q
"RTN","DGUTL",33,0)
EOM ;Required Variable: X - Date should be in internal FM date format
"RTN","DGUTL",34,0)
 ;Returned Variable: Y - End of Month in internal FM date format
"RTN","DGUTL",35,0)
 S X1=$S($E(X,4,5)=12:$E(X,1,3)+1_"01",1:$E(X,1,5)+1)_"01"_$S($P(X,".",2):"."_$P(X,".",2),1:""),X2=-1 D C^%DTC S Y=X K X
"RTN","DGUTL",36,0)
 Q
"RTN","DGUTL",37,0)
LO D:'$D(DT) DT^DICRW S:'$D(DTIME) DTIME=300 S U="^" Q
"RTN","DGUTL",38,0)
 I '$D(^DG(43,1,0)) W !,"ADT parameters not set up",*7 G H^XUS
"RTN","DGUTL",39,0)
 S USER=$S($D(DUZ)#10:DUZ,1:0) I 'USER!('$D(^VA(200,USER,0))) W !!,"Please log off the computer and then back to use this option.",!!,*7 K ^UTILITY("DG",$J) G H^XUS
"RTN","DGUTL",40,0)
 K USER Q
"RTN","DGUTL",41,0)
 ;
"RTN","DGUTL",42,0)
UPPER(X) ; -- convert to uppercase
"RTN","DGUTL",43,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","DGUTL",44,0)
 ;
"RTN","DGUTL",45,0)
LOWER(X) ;
"RTN","DGUTL",46,0)
 N Y,C,Z,I
"RTN","DGUTL",47,0)
 S Y=$E(X)_$TR($E(X,2,999),"ABCDEFGHIJKLMNOPQRSTUVWXYZ@","abcdefghijklmnopqrstuvwxyz ")
"RTN","DGUTL",48,0)
 F C=" ",",","/" F I=2:1 S Z=$P(Y,C,I,999) Q:Z=""  S Y=$P(Y,C,1,I-1)_C_$TR($E(Z),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(Z,2,999)
"RTN","DGUTL",49,0)
 Q Y
"RTN","DGUTL",50,0)
QUES(DFN,DGQCODE) ; EDIT REGISTRATION DATA FOR AMIE USE ONLY
"RTN","DGUTL",51,0)
 ;
"RTN","DGUTL",52,0)
 ;  INPUT:
"RTN","DGUTL",53,0)
 ;     DFN
"RTN","DGUTL",54,0)
 ;     DGQCODE = Code for question(s) to be asked
"RTN","DGUTL",55,0)
 ;  OUTPUT:
"RTN","DGUTL",56,0)
 ;     DGERR   = ERROR VARIABLE
"RTN","DGUTL",57,0)
 ;     DGCHANGE= 1 IF DATA MODIFIED 0 O/W
"RTN","DGUTL",58,0)
 ;
"RTN","DGUTL",59,0)
 N D,D0,DI,DIC,DGCODE,DGDR,DGNODE,DGQNODES,DGPC,DGPTND,DGRPS,DGQ,DGX,DQ,N,X,Y,%Y
"RTN","DGUTL",60,0)
 S (DGERR,DGRPS,DGCHANGE)=0
"RTN","DGUTL",61,0)
 G:'($G(DFN)&($G(DGQCODE)="ADD1")) QTE
"RTN","DGUTL",62,0)
 S DGPC=2,DGCODE="ADD1"
"RTN","DGUTL",63,0)
 S DGDR=104
"RTN","DGUTL",64,0)
 S DGRPS=1
"RTN","DGUTL",65,0)
 S DGQNODES=".11~.13"
"RTN","DGUTL",66,0)
 F N=1:1 S DGNODE=$P(DGQNODES,"~",N) Q:DGNODE']""  S DGPTND(DGNODE)=$G(^DPT(DFN,DGNODE))
"RTN","DGUTL",67,0)
 D ^DGRPE
"RTN","DGUTL",68,0)
 F DGNODE=0:0 S DGNODE=$O(DGPTND(DGNODE)) Q:DGNODE']""  S:$G(^DPT(DFN,DGNODE))'=(DGPTND(DGNODE)) DGCHANGE=1
"RTN","DGUTL",69,0)
QTE I 'DGRPS S DGERR=1
"RTN","DGUTL",70,0)
QTQ Q
"RTN","DGUTL",71,0)
 ;FORM FEED & STOPPING UTILITIES
"RTN","DGUTL",72,0)
FIRST() ;First heading of report
"RTN","DGUTL",73,0)
 ; RETURNS STOP; 0=GO,1=STOP
"RTN","DGUTL",74,0)
 N STOP
"RTN","DGUTL",75,0)
 D STOPCHK
"RTN","DGUTL",76,0)
 D:$G(STOP) STOPPED
"RTN","DGUTL",77,0)
 I '$G(STOP),$E($G(IOST),1,2)="C-" W @IOF
"RTN","DGUTL",78,0)
 Q $G(STOP)
"RTN","DGUTL",79,0)
 ;
"RTN","DGUTL",80,0)
SUBSEQ() ;enter for further headings of report
"RTN","DGUTL",81,0)
 ; RETURNS STOP; 0=GO,1=STOP
"RTN","DGUTL",82,0)
 N STOP,DIR,X,Y
"RTN","DGUTL",83,0)
 D STOPCHK
"RTN","DGUTL",84,0)
 I $E($G(IOST),1,2)="C-" S DIR(0)="E" D ^DIR S:$D(DIRUT) STOP=1
"RTN","DGUTL",85,0)
 D:$G(STOP) STOPPED
"RTN","DGUTL",86,0)
 I '$G(STOP) W @IOF
"RTN","DGUTL",87,0)
 Q $G(STOP)
"RTN","DGUTL",88,0)
 ;
"RTN","DGUTL",89,0)
STOPCHK I $D(ZTQUEUED),$$S^%ZTLOAD S (ZTSTOP,STOP)=1
"RTN","DGUTL",90,0)
 Q
"RTN","DGUTL",91,0)
STOPPED ;
"RTN","DGUTL",92,0)
 W !?5,"------------- Report stopped at user's request ------------"
"RTN","DGUTL",93,0)
 K ZTREQ
"RTN","DGUTL",94,0)
 Q
"RTN","DGUTL",95,0)
ENDREP I $E(IOST,1,2)'["C-" W:$Y&'$D(IONOFF) @IOF Q
"RTN","DGUTL",96,0)
 Q
"RTN","DGUTL",97,0)
 ;
"RTN","DGUTL",98,0)
ASKDIV(NOTALL) ;Ask for division (one/many/all)
"RTN","DGUTL",99,0)
 ; Input: NOTALL - Flag that prevents selection of all divisions
"RTN","DGUTL",100,0)
 ;          1 = Don't allow selection of all divisions
"RTN","DGUTL",101,0)
 ;          0 = Allow selection of all divisions (default)
"RTN","DGUTL",102,0)
 ;Output: Integer indicating if selection was made
"RTN","DGUTL",103,0)
 ;          0 = No divisions selected (user quit)
"RTN","DGUTL",104,0)
 ;          1 = Divisions selected
"RTN","DGUTL",105,0)
 ;        VAUTD will be set as follows:
"RTN","DGUTL",106,0)
 ;          VAUTD = 1 if all divisions selected
"RTN","DGUTL",107,0)
 ;          VAUTD = 0 if individual divisions selected
"RTN","DGUTL",108,0)
 ;          VAUTD(DivPtr) = DivisionName for each division selected
"RTN","DGUTL",109,0)
 ; Notes: VAUTD is KILLed in input
"RTN","DGUTL",110,0)
 ;
"RTN","DGUTL",111,0)
 N FIRSTDIV,MULTIDIV,Y,VAUTNALL
"RTN","DGUTL",112,0)
 K VAUTD
"RTN","DGUTL",113,0)
 S FIRSTDIV=+$O(^DG(40.80,0))
"RTN","DGUTL",114,0)
 I '$D(^DG(40.8,FIRSTDIV,0)) D  G ASKDIVQ
"RTN","DGUTL",115,0)
 .W !
"RTN","DGUTL",116,0)
 .W $C(7),"***WARNING...MEDICAL CENTER DIVISION FILE IS NOT SET UP***"
"RTN","DGUTL",117,0)
 .W !
"RTN","DGUTL",118,0)
 S MULTIDIV=+$P($G(^DG(43,1,"GL")),"^",2)
"RTN","DGUTL",119,0)
 I 'MULTIDIV S VAUTD=1 G ASKDIVQ
"RTN","DGUTL",120,0)
 S (VAUTD,Y)=0
"RTN","DGUTL",121,0)
 I +$G(NOTALL) S VAUTNALL=1
"RTN","DGUTL",122,0)
 D DIVISION^VAUTOMA
"RTN","DGUTL",123,0)
 I Y<0 K VAUTD
"RTN","DGUTL",124,0)
ASKDIVQ Q $D(VAUTD)>0
"VER")
8.0^22
**END**
**END**
