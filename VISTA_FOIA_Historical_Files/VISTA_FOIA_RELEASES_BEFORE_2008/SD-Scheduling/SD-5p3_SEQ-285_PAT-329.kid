Released SD*5.3*329 SEQ #285
Extracted from mail message
**KIDS**:SD*5.3*329^

**INSTALL NAME**
SD*5.3*329
"BLD",5238,0)
SD*5.3*329^SCHEDULING^0^3031201^y
"BLD",5238,1,0)
^^1^1^3031201^
"BLD",5238,1,1,0)
ACRP AD HOC REPORT DOES NOT RECOGNIZE PRIMARY DX
"BLD",5238,4,0)
^9.64PA^^
"BLD",5238,"KRN",0)
^9.67PA^8989.52^19
"BLD",5238,"KRN",.4,0)
.4
"BLD",5238,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5238,"KRN",.401,0)
.401
"BLD",5238,"KRN",.402,0)
.402
"BLD",5238,"KRN",.403,0)
.403
"BLD",5238,"KRN",.5,0)
.5
"BLD",5238,"KRN",.84,0)
.84
"BLD",5238,"KRN",3.6,0)
3.6
"BLD",5238,"KRN",3.8,0)
3.8
"BLD",5238,"KRN",9.2,0)
9.2
"BLD",5238,"KRN",9.8,0)
9.8
"BLD",5238,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5238,"KRN",9.8,"NM",1,0)
SCRPW24^^0^B75185848
"BLD",5238,"KRN",9.8,"NM","B","SCRPW24",1)

"BLD",5238,"KRN",19,0)
19
"BLD",5238,"KRN",19.1,0)
19.1
"BLD",5238,"KRN",101,0)
101
"BLD",5238,"KRN",409.61,0)
409.61
"BLD",5238,"KRN",771,0)
771
"BLD",5238,"KRN",870,0)
870
"BLD",5238,"KRN",8989.51,0)
8989.51
"BLD",5238,"KRN",8989.52,0)
8989.52
"BLD",5238,"KRN",8994,0)
8994
"BLD",5238,"KRN","B",.4,.4)

"BLD",5238,"KRN","B",.401,.401)

"BLD",5238,"KRN","B",.402,.402)

"BLD",5238,"KRN","B",.403,.403)

"BLD",5238,"KRN","B",.5,.5)

"BLD",5238,"KRN","B",.84,.84)

"BLD",5238,"KRN","B",3.6,3.6)

"BLD",5238,"KRN","B",3.8,3.8)

"BLD",5238,"KRN","B",9.2,9.2)

"BLD",5238,"KRN","B",9.8,9.8)

"BLD",5238,"KRN","B",19,19)

"BLD",5238,"KRN","B",19.1,19.1)

"BLD",5238,"KRN","B",101,101)

"BLD",5238,"KRN","B",409.61,409.61)

"BLD",5238,"KRN","B",771,771)

"BLD",5238,"KRN","B",870,870)

"BLD",5238,"KRN","B",8989.51,8989.51)

"BLD",5238,"KRN","B",8989.52,8989.52)

"BLD",5238,"KRN","B",8994,8994)

"BLD",5238,"QUES",0)
^9.62^^
"BLD",5238,"REQB",0)
^9.611^1^1
"BLD",5238,"REQB",1,0)
SD*5.3*295^1
"BLD",5238,"REQB","B","SD*5.3*295",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
329^3031201
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3031201
"PKG",16,22,1,"PAH",1,1,1,0)
ACRP AD HOC REPORT DOES NOT RECOGNIZE PRIMARY DX
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SCRPW24")
0^1^B75185848
"RTN","SCRPW24",1,0)
SCRPW24 ;RENO/KEITH - ACRP Ad Hoc Report (cont.) ;06/19/99
"RTN","SCRPW24",2,0)
 ;;5.3;Scheduling;**144,163,180,254,243,295,329**;AUG 13, 1993
"RTN","SCRPW24",3,0)
 ;06/19/99 ACS - Added CPT modifier API calls
"RTN","SCRPW24",4,0)
 ;
"RTN","SCRPW24",5,0)
 ;11/26/03 RLC - 329 fixes primary/secondary dx problem with report
"RTN","SCRPW24",6,0)
 ;
"RTN","SCRPW24",7,0)
APAC(SDX) ;Get all procedure codes
"RTN","SCRPW24",8,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U),SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U)_U_$P(SDY(SDI),U,16) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",9,0)
 D APAC^SCRPW241(.SDX)
"RTN","SCRPW24",10,0)
 D NX Q
"RTN","SCRPW24",11,0)
 ;
"RTN","SCRPW24",12,0)
APOTR ;Transform procedure external value
"RTN","SCRPW24",13,0)
 ;S $P(SDX,U,2)=$P(SDX,U,2)_" "_$P(^ICPT(+SDX,0),U,2) Q
"RTN","SCRPW24",14,0)
 D APOTR^SCRPW241(.SDX)
"RTN","SCRPW24",15,0)
 Q
"RTN","SCRPW24",16,0)
 ;
"RTN","SCRPW24",17,0)
APAP(SDX) ;Get ambulatory procedures (no E&M codes)
"RTN","SCRPW24",18,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I '$D(^IBE(357.69,"B",SDX)) S SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",19,0)
 D APAP^SCRPW241(.SDX)
"RTN","SCRPW24",20,0)
 D NX Q
"RTN","SCRPW24",21,0)
 ;
"RTN","SCRPW24",22,0)
APEM(SDX) ;Get evaluation and management codes
"RTN","SCRPW24",23,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I $D(^IBE(357.69,"B",SDX)) S SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",24,0)
 D APEM^SCRPW241(.SDX)
"RTN","SCRPW24",25,0)
 D NX Q
"RTN","SCRPW24",26,0)
 ;
"RTN","SCRPW24",27,0)
CLCG(SDX) ;Get clinic group
"RTN","SCRPW24",28,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=$P($G(^SC(SDX,0)),U,31) I SDX,$D(^SD(409.67,SDX)) S SDX=SDX_U_$P(^SD(409.67,SDX,0),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",29,0)
 D NX Q
"RTN","SCRPW24",30,0)
 ;
"RTN","SCRPW24",31,0)
CLCN(SDX) ;Get clinic name
"RTN","SCRPW24",32,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=SDX_U_$P($G(^SC(SDX,0)),U) I $L($P(SDX,U,2)) S SDX(1)=SDX
"RTN","SCRPW24",33,0)
 D NX Q
"RTN","SCRPW24",34,0)
 ;
"RTN","SCRPW24",35,0)
CLCS(SDX) ;Get clinic service
"RTN","SCRPW24",36,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=$P($G(^SC(SDX,0)),U,8) D FST(.SDX,44,9) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",37,0)
 D NX Q
"RTN","SCRPW24",38,0)
 ;
"RTN","SCRPW24",39,0)
DXAD(SDX) ;Get all diagnoses
"RTN","SCRPW24",40,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",41,0)
 D NX Q
"RTN","SCRPW24",42,0)
 ;
"RTN","SCRPW24",43,0)
DXOTR ;Transform diagnosis external value
"RTN","SCRPW24",44,0)
 S SDX=SDX_" "_$P($$ICDDX^ICDCODE(+SDX),U,4) Q
"RTN","SCRPW24",45,0)
 ;
"RTN","SCRPW24",46,0)
DXGS(SDX,SDZ) ;Get GAF score
"RTN","SCRPW24",47,0)
 K SDX N SDI,SDY S SDY=$S(SDZ="H":$P($P(SDOE0,U),"."),1:DT)_.9999,SDY=9999999-SDY,SDY=$O(^YSD(627.8,"AX5",$P(SDOE0,U,2),SDY))
"RTN","SCRPW24",48,0)
 I SDY S SDI=$O(^YSD(627.8,"AX5",$P(SDOE0,U,2),SDY,""),-1) I SDI S SDX=+$P($G(^YSD(627.8,SDI,60)),U,3) I SDX S SDX(1)=SDX_U_SDX
"RTN","SCRPW24",49,0)
 D NX Q
"RTN","SCRPW24",50,0)
 ;
"RTN","SCRPW24",51,0)
DXGSQ(SDI) ;Set up GAF help text
"RTN","SCRPW24",52,0)
 S SDIRQ("?",1)="Specify a value representing the Global Assessment of Functioning (GAF) score."
"RTN","SCRPW24",53,0)
 I SDI="H" S SDIRQ("?")="Status as of the encounter date/time is used to determine 'historical' values."
"RTN","SCRPW24",54,0)
 I SDI="C" S SDIRQ("?")="Status as of the report run date is used to determine 'current' values."
"RTN","SCRPW24",55,0)
 Q
"RTN","SCRPW24",56,0)
 ;
"RTN","SCRPW24",57,0)
DXPD(SDX) ;Get primary diagnosis
"RTN","SCRPW24",58,0)
 ;K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)="P" S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX),U,2) I $L($P(SDX,U,3)) D DXOTR S SDX(SDI)=SDX Q
"RTN","SCRPW24",59,0)
 ;SD*5.3*329 fixes problem of report not working for primary dx
"RTN","SCRPW24",60,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)="P" S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",61,0)
 D NX Q
"RTN","SCRPW24",62,0)
 ;
"RTN","SCRPW24",63,0)
DXSD(SDX) ;Get secondary diagnoses
"RTN","SCRPW24",64,0)
 ;K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)'="P" S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX),U,2) I $L($P(SDX,U,3)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",65,0)
 ;SD*5.3*329 fixes problem of report not working for secondary dx
"RTN","SCRPW24",66,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)'="P" S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",67,0)
 D NX Q
"RTN","SCRPW24",68,0)
 ;
"RTN","SCRPW24",69,0)
ENED(SDX,SDZ) ;Get enrollment date
"RTN","SCRPW24",70,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S (SDX,Y)=$P(SDY,U) X ^DD("DD") S SDX(1)=SDX_U_Y
"RTN","SCRPW24",71,0)
 D NX Q
"RTN","SCRPW24",72,0)
 ;
"RTN","SCRPW24",73,0)
ENEF(SDX,SDZ) ;Get enrollment effective date
"RTN","SCRPW24",74,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S (SDX,Y)=$P(SDY,U,8) X ^DD("DD") S SDX(1)=SDX_U_Y
"RTN","SCRPW24",75,0)
 D NX Q
"RTN","SCRPW24",76,0)
 ;
"RTN","SCRPW24",77,0)
ENEP(SDX,SDZ) ;Get enrollment priority
"RTN","SCRPW24",78,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,7) D FST(.SDX,27.11,.07) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",79,0)
 D NX Q
"RTN","SCRPW24",80,0)
 ;
"RTN","SCRPW24",81,0)
ENES(SDX,SDZ) ;Get enrollment status
"RTN","SCRPW24",82,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,4),SDX=SDX_U_$$EXTERNAL^DILFD(27.11,.04,"F",SDX) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",83,0)
 D NX Q
"RTN","SCRPW24",84,0)
 ;
"RTN","SCRPW24",85,0)
ENFR(SDX,SDZ) ;Get enrollment facility received
"RTN","SCRPW24",86,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,6) I SDX S SDX=SDX_U_$P($G(^DIC(4,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",87,0)
 D NX Q
"RTN","SCRPW24",88,0)
 ;
"RTN","SCRPW24",89,0)
ENSE(SDX,SDZ) ;Get enrollment source of enrollment
"RTN","SCRPW24",90,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,3) D FST(.SDX,27.11,.03) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",91,0)
 D NX Q
"RTN","SCRPW24",92,0)
 ;
"RTN","SCRPW24",93,0)
ENQ(SDZ) ;Set up help text for enrollment
"RTN","SCRPW24",94,0)
 I SDZ="H" S SDIRQ("?")="Enrollment status as of the encounter date/time is used for 'historical' values."
"RTN","SCRPW24",95,0)
 I SDZ="C" S SDIRQ("?")="Enrollment status as of the report run date is used for 'current' values."
"RTN","SCRPW24",96,0)
 Q
"RTN","SCRPW24",97,0)
 ;
"RTN","SCRPW24",98,0)
OEAT(SDX) ;Get encounter appointment type
"RTN","SCRPW24",99,0)
 K SDX S SDX=$P(SDOE0,U,10) I SDX S SDX=SDX_U_$P($G(^SD(409.1,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",100,0)
 D NX Q
"RTN","SCRPW24",101,0)
 ;
"RTN","SCRPW24",102,0)
OEDV(SDX) ;Get encounter division
"RTN","SCRPW24",103,0)
 K SDX S SDX=$P(SDOE0,U,11) I SDX S SDX=SDX_U_$P($G(^DG(40.8,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",104,0)
 D NX Q
"RTN","SCRPW24",105,0)
 ;
"RTN","SCRPW24",106,0)
OEEE(SDX) ;Get encounter eligibility
"RTN","SCRPW24",107,0)
 K SDX S SDX=$P(SDOE0,U,13) I SDX S SDX=SDX_U_$P($G(^DIC(8,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",108,0)
 D NX Q
"RTN","SCRPW24",109,0)
 ;
"RTN","SCRPW24",110,0)
OEOP(SDX) ;Get encounter originating process type
"RTN","SCRPW24",111,0)
 K SDX S SDX=$P(SDOE0,U,8) D FST(.SDX,409.68,.08) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",112,0)
 D NX Q
"RTN","SCRPW24",113,0)
 ;
"RTN","SCRPW24",114,0)
OEPA(SDX) ;Get encounter patient
"RTN","SCRPW24",115,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I $L(VADM(1)) S SDX(1)=DFN_U_VADM(1)
"RTN","SCRPW24",116,0)
 D NX Q
"RTN","SCRPW24",117,0)
 ;
"RTN","SCRPW24",118,0)
OEES(SDX) ;Get encounter status
"RTN","SCRPW24",119,0)
 K SDX S SDX=$P(SDOE0,U,12) I SDX S SDX=SDX_U_$P($G(^SD(409.63,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",120,0)
 D NX Q
"RTN","SCRPW24",121,0)
 ;
"RTN","SCRPW24",122,0)
OETS(SDX) ;Get transmission status
"RTN","SCRPW24",123,0)
 K SDX S SDX(1)=$$STX^SCRPW8(SDOE,SDOE0) Q
"RTN","SCRPW24",124,0)
 ;
"RTN","SCRPW24",125,0)
TSQ(DIR) ;Set up DIR array for transmission status question
"RTN","SCRPW24",126,0)
 K DIR S DIR("A")="Select transmission status",DIR("?")="This value represents the transmission status of the encounter record."
"RTN","SCRPW24",127,0)
 S DIR(0)="SO^0:Not checked-out;1:No transmission record;2:Not required, not transmitted;3:Rejected for transmission;4:Awaiting transmission;5:Transmitted, no acknowledgment;6:Transmitted, rejected;7:Transmitted, error;8:Transmitted, accepted"
"RTN","SCRPW24",128,0)
 Q
"RTN","SCRPW24",129,0)
 ;
"RTN","SCRPW24",130,0)
CLQ(DIR,SDZ) ;Set up DIR array for classification questions
"RTN","SCRPW24",131,0)
 K DIR S SDZ=$S(SDZ="A":"Agent Orange exposure",SDZ="I":"ionizing radiation exposure",SDZ="S":"service connected condition",1:"environmental contaminants exposure")
"RTN","SCRPW24",132,0)
 S DIR(0)="SO^1:YES;0:NO",DIR("A")="Treatment related to "_SDZ,DIR("?")="Indicates if treatment was related to "_SDZ Q
"RTN","SCRPW24",133,0)
 ;
"RTN","SCRPW24",134,0)
OECL(SDX,SDZ) ;Get classification values
"RTN","SCRPW24",135,0)
 K SDX N SDY S SDZ=$S(SDZ="A":1,SDZ="I":2,SDZ="S":3,SDZ="E":4,1:"") I SDZ D CLASK^SDCO2(SDOE,.SDY) S SDX=$P($G(SDY(SDZ)),U,2) I $L(SDX) S SDX(1)=$S(SDX=1:"1^YES",1:"0^NO")
"RTN","SCRPW24",136,0)
 D NX Q
"RTN","SCRPW24",137,0)
 ;
"RTN","SCRPW24",138,0)
OEOU(SDX) ;Get option used to create
"RTN","SCRPW24",139,0)
 K SDX S SDX=+$P(SDOE0,U,5),SDX=+$P($G(^AUPNVSIT(SDX,0)),U,24)
"RTN","SCRPW24",140,0)
 N SDY D GETS^DIQ(19,SDX,.01,"","SDY")
"RTN","SCRPW24",141,0)
 S SDX=SDX_U_SDY(19,SDX_",",.01) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",142,0)
 D NX Q
"RTN","SCRPW24",143,0)
 ;
"RTN","SCRPW24",144,0)
SUQ(DIR) ;Set up DIR() array for Scheduled/unscheduled question
"RTN","SCRPW24",145,0)
 K DIR S DIR("A")="Select outpatient activity type",DIR("?",1)="Only pre-scheduled appointments will be reflected as SCHEDULED.  All other",DIR("?",2)="types of activity (add/edits, registrations, walkins or unscheduled activity)"
"RTN","SCRPW24",146,0)
 S DIR("?")="will be reflected as UNSCHEDULED.",DIR(0)="SO^S:SCHEDULED;U:UNSCHEDULED" Q
"RTN","SCRPW24",147,0)
 ;
"RTN","SCRPW24",148,0)
OESU(SDX) ;Get scheduled/unscheduled status
"RTN","SCRPW24",149,0)
 N SDAP0 K SDX S SDX(1)=""
"RTN","SCRPW24",150,0)
 I $P(SDOE0,U,8)=1 D  Q:$L(SDX(1))
"RTN","SCRPW24",151,0)
 .S SDAP0=$G(^DPT(+$P(SDOE0,U,2),"S",+SDOE0,0))
"RTN","SCRPW24",152,0)
 .Q:$P(SDAP0,U,20)'=SDOE  Q:$P(SDAP0,U,7)=4
"RTN","SCRPW24",153,0)
 .S SDX(1)="S^SCHEDULED" Q
"RTN","SCRPW24",154,0)
 S SDX(1)="U^UNSCHEDULED" Q
"RTN","SCRPW24",155,0)
 ;
"RTN","SCRPW24",156,0)
PCPR(SDX,SDZ) ;Get primary care provider
"RTN","SCRPW24",157,0)
 ;Required input: SDZ="C" for current, "H" for historical
"RTN","SCRPW24",158,0)
 K SDX S SDX=$S(SDZ="C":$$OUTPTPR^SDUTL3(+$P(SDOE0,U,2)),1:$$OUTPTPR^SDUTL3(+$P(SDOE0,U,2),+$P(SDOE0,U))) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",159,0)
 D NX Q
"RTN","SCRPW24",160,0)
 ;
"RTN","SCRPW24",161,0)
PCTM(SDX,SDZ) ;Get priamry care team
"RTN","SCRPW24",162,0)
 ;Required input: SDZ="C" for current, "H" for historical
"RTN","SCRPW24",163,0)
 K SDX S SDX=$S(SDZ="C":$$OUTPTTM^SDUTL3(+$P(SDOE0,U,2)),1:$$OUTPTTM^SDUTL3(+$P(SDOE0,U,2),+$P(SDOE0,U))) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",164,0)
 D NX Q
"RTN","SCRPW24",165,0)
 ;
"RTN","SCRPW24",166,0)
PDPA(SDX) ;Get patient age
"RTN","SCRPW24",167,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I VADM(4)=+VADM(4) S SDX(1)=VADM(4)_U_VADM(4)
"RTN","SCRPW24",168,0)
 D NX Q
"RTN","SCRPW24",169,0)
 ;
"RTN","SCRPW24",170,0)
PDPS(SDX) ;Get patient sex
"RTN","SCRPW24",171,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I $L($P(VADM(5),U,2)) S SDX(1)=VADM(5)
"RTN","SCRPW24",172,0)
 D NX Q
"RTN","SCRPW24",173,0)
 ;
"RTN","SCRPW24",174,0)
PDSC(SDX) ;Get patient state/county
"RTN","SCRPW24",175,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D ADD^VADPT I $L($P(VAPA(7),U,2)) S SDX(1)=$P(VAPA(5),U)_";"_$P(VAPA(7),U)_U_$P(VAPA(5),U,2)_" / "_$P(VAPA(7),U,2)
"RTN","SCRPW24",176,0)
 D NX Q
"RTN","SCRPW24",177,0)
 ;
"RTN","SCRPW24",178,0)
PDZC(SDX) ;Get patient zip code
"RTN","SCRPW24",179,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D ADD^VADPT I $L(VAPA(6)) S SDX(1)=VAPA(6)_U_VAPA(6)
"RTN","SCRPW24",180,0)
 D NX Q
"RTN","SCRPW24",181,0)
 ;
"RTN","SCRPW24",182,0)
ENROL(SDATE)  ;Get enrollment record (most recent to encounter date)
"RTN","SCRPW24",183,0)
 N SDY,SDI,X1,X2,X,%Y S:SDATE#1=0 SDATE=SDATE+.9999 S SDI=0 F  S SDI=$O(^DGEN(27.11,"C",+$P(SDOE0,U,2),SDI)) Q:'SDI  S SDY=$G(^DGEN(27.11,SDI,0)),SDY(+SDY)=SDY
"RTN","SCRPW24",184,0)
 S SDI=$O(SDY(SDATE),-1) Q:'SDI ""  S X1=$P($P(SDOE0,U),"."),X2=SDI D ^%DTC Q SDY(SDI)
"RTN","SCRPW24",185,0)
 ;
"RTN","SCRPW24",186,0)
NX S:$D(SDX)<10 SDX(1)="~~~NONE~~~^~~~NONE~~~" Q
"RTN","SCRPW24",187,0)
 ;
"RTN","SCRPW24",188,0)
FST(SDX,SDFI,SDFE) ;Field set transform
"RTN","SCRPW24",189,0)
 Q:'$L(SDX)  N SDY,SDI D FIELD^DID(SDFI,SDFE,"","POINTER","SDY") S SDY=SDY("POINTER") F SDI=1:1:$L(SDY,";") I SDX=$P($P(SDY,";",SDI),":") S SDX=SDX_U_$P($P(SDY,";",SDI),":",2) Q
"RTN","SCRPW24",190,0)
 Q
"VER")
8.0^22
**END**
**END**
