Released EAS*1*9 SEQ #7
Extracted from mail message
**KIDS**:EAS*1.0*9^

**INSTALL NAME**
EAS*1.0*9
"BLD",3832,0)
EAS*1.0*9^ENROLLMENT APPLICATION SYSTEM^0^3020204^y
"BLD",3832,4,0)
^9.64PA^^
"BLD",3832,"KRN",0)
^9.67PA^8989.52^19
"BLD",3832,"KRN",.4,0)
.4
"BLD",3832,"KRN",.401,0)
.401
"BLD",3832,"KRN",.402,0)
.402
"BLD",3832,"KRN",.403,0)
.403
"BLD",3832,"KRN",.5,0)
.5
"BLD",3832,"KRN",.84,0)
.84
"BLD",3832,"KRN",3.6,0)
3.6
"BLD",3832,"KRN",3.8,0)
3.8
"BLD",3832,"KRN",9.2,0)
9.2
"BLD",3832,"KRN",9.8,0)
9.8
"BLD",3832,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",3832,"KRN",9.8,"NM",1,0)
EASEZF2^^0^B58323512
"BLD",3832,"KRN",9.8,"NM",2,0)
EASEZI^^0^B45881794
"BLD",3832,"KRN",9.8,"NM","B","EASEZF2",1)

"BLD",3832,"KRN",9.8,"NM","B","EASEZI",2)

"BLD",3832,"KRN",19,0)
19
"BLD",3832,"KRN",19,"NM",0)
^9.68A^^
"BLD",3832,"KRN",19.1,0)
19.1
"BLD",3832,"KRN",101,0)
101
"BLD",3832,"KRN",409.61,0)
409.61
"BLD",3832,"KRN",771,0)
771
"BLD",3832,"KRN",870,0)
870
"BLD",3832,"KRN",8989.51,0)
8989.51
"BLD",3832,"KRN",8989.52,0)
8989.52
"BLD",3832,"KRN",8994,0)
8994
"BLD",3832,"KRN","B",.4,.4)

"BLD",3832,"KRN","B",.401,.401)

"BLD",3832,"KRN","B",.402,.402)

"BLD",3832,"KRN","B",.403,.403)

"BLD",3832,"KRN","B",.5,.5)

"BLD",3832,"KRN","B",.84,.84)

"BLD",3832,"KRN","B",3.6,3.6)

"BLD",3832,"KRN","B",3.8,3.8)

"BLD",3832,"KRN","B",9.2,9.2)

"BLD",3832,"KRN","B",9.8,9.8)

"BLD",3832,"KRN","B",19,19)

"BLD",3832,"KRN","B",19.1,19.1)

"BLD",3832,"KRN","B",101,101)

"BLD",3832,"KRN","B",409.61,409.61)

"BLD",3832,"KRN","B",771,771)

"BLD",3832,"KRN","B",870,870)

"BLD",3832,"KRN","B",8989.51,8989.51)

"BLD",3832,"KRN","B",8989.52,8989.52)

"BLD",3832,"KRN","B",8994,8994)

"BLD",3832,"QUES",0)
^9.62^^
"BLD",3832,"REQB",0)
^9.611^1^1
"BLD",3832,"REQB",1,0)
EAS*1.0*1^2
"BLD",3832,"REQB","B","EAS*1.0*1",1)

"MBREQ")
0
"PKG",552,-1)
1^1
"PKG",552,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",552,20,0)
^9.402P^^
"PKG",552,22,0)
^9.49I^1^1
"PKG",552,22,1,0)
1.0^3010315^3010419^66481
"PKG",552,22,1,"PAH",1,0)
9^3020204
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","EASEZF2")
0^1^B58323512
"RTN","EASEZF2",1,0)
EASEZF2 ;ALB/jap - Filing 1010EZ Data to Patient Database ;10/31/00  13:07
"RTN","EASEZF2",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**1,9**;Mar 15, 2001
"RTN","EASEZF2",3,0)
 ;
"RTN","EASEZF2",4,0)
F408(EASAPP,EASDFN) ;
"RTN","EASEZF2",5,0)
 N KEYIEN,FILE,SUBFILE,FLD,DATAKEY,MULTIPLE,MM,SECT,QUES,SUBIEN,ACCEPT,EZDATA,PTDATA,LINK
"RTN","EASEZF2",6,0)
 N DGPR12,INCYR,TESTYR,LASTINC,XLINK,EROOT,EAS,ERR,IENS,MSG,X,Y
"RTN","EASEZF2",7,0)
 Q:'$G(EASDFN)
"RTN","EASEZF2",8,0)
 ;determine income year for financial data
"RTN","EASEZF2",9,0)
 S Y=$P($G(^EAS(712,EASAPP,0)),U,6) I Y="" S Y=DT
"RTN","EASEZF2",10,0)
 S %F=5,X=$$FMTE^XLFDT(Y,%F),X=+$P(X,"/",3)-1,%DT="P" D ^%DT S INCYR=Y
"RTN","EASEZF2",11,0)
 S YREND=$E(DT,1,3)_"1231"
"RTN","EASEZF2",12,0)
 ;don't file any 408 data if applicant has income test for current year at this site
"RTN","EASEZF2",13,0)
 S LASTINC=$$LST^DGMTU(EASDFN,YREND,1) I LASTINC="" S LASTINC=$$LST^DGMTU(EASDFN,YREND,2)
"RTN","EASEZF2",14,0)
 S TESTYR=$P(LASTINC,U,2)
"RTN","EASEZF2",15,0)
 Q:($E(TESTYR,1,3)=$E(DT,1,3))
"RTN","EASEZF2",16,0)
 ;
"RTN","EASEZF2",17,0)
 ;DGPR12("AP") is the Applicant's (veteran's) IEN in file #408.12
"RTN","EASEZF2",18,0)
 S DGPR12("AP")=""
"RTN","EASEZF2",19,0)
 ;add Applicant to file #408.12 if not there already;
"RTN","EASEZF2",20,0)
 ;make this addition even if no other financial data is available;
"RTN","EASEZF2",21,0)
 I '$D(^DGPR(408.12,"B",EASDFN)) D
"RTN","EASEZF2",22,0)
 .;create the file #408.12 record
"RTN","EASEZF2",23,0)
 .K EAS,ERR,EZIENS
"RTN","EASEZF2",24,0)
 .S EAS(EASAPP,408.12,"+1,",".01")=EASDFN
"RTN","EASEZF2",25,0)
 .S EAS(EASAPP,408.12,"+1,",".02")=1
"RTN","EASEZF2",26,0)
 .S EAS(EASAPP,408.12,"+1,",".03")=EASDFN_";DPT("
"RTN","EASEZF2",27,0)
 .S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF2",28,0)
 .D UPDATE^DIE("S",EROOT,"EZIENS","ERR")
"RTN","EASEZF2",29,0)
 .S DGPR12("AP")=$G(EZIENS(1))
"RTN","EASEZF2",30,0)
 .Q:DGPR12("AP")=""
"RTN","EASEZF2",31,0)
 .;create the subfile #408.1275 record
"RTN","EASEZF2",32,0)
 .K EAS,ERR,EZIENS
"RTN","EASEZF2",33,0)
 .S KEY=+$$KEY711^EASEZU1("APPLICANT DATE OF BIRTH")
"RTN","EASEZF2",34,0)
 .S DOB=$P($$DATA712^EASEZU1(EASAPP,KEY,1),U,1)
"RTN","EASEZF2",35,0)
 .S EAS(EASAPP,408.1275,"+1,"_DGPR12("AP")_",",".01")=DOB
"RTN","EASEZF2",36,0)
 .S EAS(EASAPP,408.1275,"+1,"_DGPR12("AP")_",",".02")="YES"
"RTN","EASEZF2",37,0)
 .D UPDATE^DIE("ES",EROOT,"EZIENS","ERR")
"RTN","EASEZF2",38,0)
 .;link 1010EZ data with new record in #408.12
"RTN","EASEZF2",39,0)
 I DGPR12("AP")="" S DGPR12("AP")=$O(^DGPR(408.12,"B",EASDFN,0))
"RTN","EASEZF2",40,0)
 ;if no record for Applicant in file #408.12 exists, then don't continue
"RTN","EASEZF2",41,0)
 Q:DGPR12("AP")=""
"RTN","EASEZF2",42,0)
 ;
"RTN","EASEZF2",43,0)
 ;kill local holding arrays
"RTN","EASEZF2",44,0)
 K AP,SP,CN,FLINK
"RTN","EASEZF2",45,0)
 ;get data for file #408.12,#408.13,#408.21,#408.22 into local arrays 
"RTN","EASEZF2",46,0)
 S SECT=""
"RTN","EASEZF2",47,0)
 F  S SECT=$O(^TMP("EZTEMP",$J,SECT)) Q:SECT=""  S MULTIPLE=0 D
"RTN","EASEZF2",48,0)
 .F  S MULTIPLE=$O(^TMP("EZTEMP",$J,SECT,MULTIPLE)) Q:MULTIPLE=""  S QUES="" D
"RTN","EASEZF2",49,0)
 ..F  S QUES=$O(^TMP("EZTEMP",$J,SECT,MULTIPLE,QUES)) Q:QUES=""  D
"RTN","EASEZF2",50,0)
 ...S X=^TMP("EZTEMP",$J,SECT,MULTIPLE,QUES)
"RTN","EASEZF2",51,0)
 ...S KEYIEN=$P(X,U,1),EZDATA=$P(X,U,2),ACCEPT=$P(X,U,3),SUBIEN=$P(X,U,4),PTDATA=$P(X,U,5)
"RTN","EASEZF2",52,0)
 ...S LN=^TMP("EZDATA",$J,KEYIEN),FILE=$P(LN,U,1),SUBFILE=$P(LN,U,2),FLD=$P(LN,U,3)
"RTN","EASEZF2",53,0)
 ...Q:($P(FILE,".",1)'=408)
"RTN","EASEZF2",54,0)
 ...S LINK=$P($G(^EAS(712,EASAPP,10,SUBIEN,2)),U,2)
"RTN","EASEZF2",55,0)
 ...S DATANM=$P($G(^EAS(711,KEYIEN,0)),U,1)
"RTN","EASEZF2",56,0)
 ...S MM=MULTIPLE S:DATANM["CHILD(N)" MM=MULTIPLE+1
"RTN","EASEZF2",57,0)
 ...S ARR=$S(DATANM["SPOUSE":"SP",DATANM["CHILD":"CN",1:"AP")
"RTN","EASEZF2",58,0)
 ...S @ARR@(MM,FILE,SUBFILE,FLD)=EZDATA_U_ACCEPT_U_SUBIEN_U_PTDATA_U_LINK
"RTN","EASEZF2",59,0)
 ;delete any Spouse or Dependent data if #.01 field for file #408.13 does not exist
"RTN","EASEZF2",60,0)
 I $D(SP(1,408.13,408.13,.01))'=1 K SP
"RTN","EASEZF2",61,0)
 S MM=0 F  S MM=$O(CN(MM)) Q:'MM  I $D(CN(MM,408.13,408.13,.01))'=1 K CN(MM)
"RTN","EASEZF2",62,0)
 ;
"RTN","EASEZF2",63,0)
 ;gather links to VistA for Applicant
"RTN","EASEZF2",64,0)
 S FLINK("AP",1,408.12)=DGPR12("AP")
"RTN","EASEZF2",65,0)
 F FILE=408.21,408.22 D
"RTN","EASEZF2",66,0)
 .S XLINK="",MULTIPLE=1,SUBFILE=FILE,FLD=""
"RTN","EASEZF2",67,0)
 .F  S FLD=$O(AP(MULTIPLE,FILE,SUBFILE,FLD)) Q:FLD=""  D
"RTN","EASEZF2",68,0)
 ..S FLINK("AP",1,FILE)=+$P(AP(MULTIPLE,FILE,SUBFILE,FLD),U,5)
"RTN","EASEZF2",69,0)
 ;gather links to VistA for Spouse
"RTN","EASEZF2",70,0)
 F FILE=408.12,408.13,408.21,408.22 D
"RTN","EASEZF2",71,0)
 .S XLINK="",MULTIPLE=1,SUBFILE=FILE,FLD=""
"RTN","EASEZF2",72,0)
 .F  S FLD=$O(SP(MULTIPLE,FILE,SUBFILE,FLD)) Q:FLD=""  D
"RTN","EASEZF2",73,0)
 ..S FLINK("SP",MULTIPLE,FILE)=+$P(SP(MULTIPLE,FILE,SUBFILE,FLD),U,5)
"RTN","EASEZF2",74,0)
 .I FILE=408.12 S SUBFILE=408.1275 F  S FLD=$O(SP(MULTIPLE,FILE,SUBFILE,FLD)) Q:FLD=""  D
"RTN","EASEZF2",75,0)
 ..S FLINK("SP",MULTIPLE,SUBFILE)=$P($P(SP(MULTIPLE,FILE,SUBFILE,FLD),U,5),";",2)
"RTN","EASEZF2",76,0)
 ..S FLINK("SP",MULTIPLE,FILE)=$P($P(SP(MULTIPLE,FILE,SUBFILE,FLD),U,5),";",1)
"RTN","EASEZF2",77,0)
 ;gather links to VistA for Dependents
"RTN","EASEZF2",78,0)
 S MULTIPLE=0 F  S MULTIPLE=$O(CN(MULTIPLE)) Q:'MULTIPLE  D
"RTN","EASEZF2",79,0)
 .F FILE=408.13,408.12,408.21,408.22 D
"RTN","EASEZF2",80,0)
 ..S XLINK="",SUBFILE=FILE,FLD=""
"RTN","EASEZF2",81,0)
 ..F  S FLD=$O(CN(MULTIPLE,FILE,SUBFILE,FLD)) Q:FLD=""  D
"RTN","EASEZF2",82,0)
 ...S FLINK("CN",MULTIPLE,FILE)=+$P(CN(MULTIPLE,FILE,SUBFILE,FLD),U,5)
"RTN","EASEZF2",83,0)
 ..I FILE=408.12 S SUBFILE=408.1275 F  S FLD=$O(CN(MULTIPLE,FILE,SUBFILE,FLD)) Q:FLD=""  D
"RTN","EASEZF2",84,0)
 ...S FLINK("CN",MULTIPLE,SUBFILE)=$P($P(CN(MULTIPLE,FILE,SUBFILE,FLD),U,5),";",2)
"RTN","EASEZF2",85,0)
 ...S FLINK("CN",MULTIPLE,FILE)=$P($P(CN(MULTIPLE,FILE,SUBFILE,FLD),U,5),";",1)
"RTN","EASEZF2",86,0)
 ;
"RTN","EASEZF2",87,0)
 ;file data
"RTN","EASEZF2",88,0)
 Q:DGPR12("AP")=""
"RTN","EASEZF2",89,0)
 D AP
"RTN","EASEZF2",90,0)
 I $D(FLINK("SP")) D SP^EASEZF3
"RTN","EASEZF2",91,0)
 I $D(FLINK("CN")) D CN^EASEZF4
"RTN","EASEZF2",92,0)
 D LINKUP^EASEZF4
"RTN","EASEZF2",93,0)
 ;
"RTN","EASEZF2",94,0)
 Q
"RTN","EASEZF2",95,0)
 ;
"RTN","EASEZF2",96,0)
AP ;file Applicant data
"RTN","EASEZF2",97,0)
 N MT,P22,MULTIPLE,FILE,SUBFILE,FLD,XDATA,ACCEPT,SUBIEN,EZDATA,EAS,ERR,KEY
"RTN","EASEZF2",98,0)
 F FILE=408.21,408.22 D
"RTN","EASEZF2",99,0)
 .S MULTIPLE=1,SUBFILE=FILE,FLD=""
"RTN","EASEZF2",100,0)
 .S XLINK=$G(FLINK("AP",1,FILE))
"RTN","EASEZF2",101,0)
 .;record in file #408.21 needed for all further data filing
"RTN","EASEZF2",102,0)
 .Q:(FILE'=408.21)&('$G(FLINK("AP",1,408.21)))
"RTN","EASEZF2",103,0)
 .;for data elements with link to database, 
"RTN","EASEZF2",104,0)
 .;only file 1010EZ data if accepted by user;
"RTN","EASEZF2",105,0)
 .;data in external format
"RTN","EASEZF2",106,0)
 .I XLINK D
"RTN","EASEZF2",107,0)
 ..S FLD="" F  S FLD=$O(AP(MULTIPLE,FILE,SUBFILE,FLD)) Q:FLD=""  D
"RTN","EASEZF2",108,0)
 ...S XDATA=AP(MULTIPLE,FILE,SUBFILE,FLD),ACCEPT=$P(XDATA,U,2)
"RTN","EASEZF2",109,0)
 ...I ACCEPT D LINK(XDATA,FILE,FLD,"AP",MULTIPLE)
"RTN","EASEZF2",110,0)
 .;for data elements with no link to database, 
"RTN","EASEZF2",111,0)
 .;always create new record(s) to store 1010EZ data;
"RTN","EASEZF2",112,0)
 .;use internal data format
"RTN","EASEZF2",113,0)
 .I 'XLINK D
"RTN","EASEZF2",114,0)
 ..K EAS,ERR
"RTN","EASEZF2",115,0)
 ..S FLD="" F  S FLD=$O(AP(MULTIPLE,FILE,SUBFILE,FLD)) Q:FLD=""  D
"RTN","EASEZF2",116,0)
 ...S EZDATA=$P(AP(MULTIPLE,FILE,SUBFILE,FLD),U,1)
"RTN","EASEZF2",117,0)
 ...S EAS(EASAPP,FILE,"+1,",FLD)=EZDATA
"RTN","EASEZF2",118,0)
 ..I FILE=408.21 D
"RTN","EASEZF2",119,0)
 ...S EAS(EASAPP,FILE,"+1,",".01")=INCYR
"RTN","EASEZF2",120,0)
 ...S EAS(EASAPP,FILE,"+1,",".02")=FLINK("AP",1,408.12)
"RTN","EASEZF2",121,0)
 ...S EAS(EASAPP,FILE,"+1,","101")=DUZ
"RTN","EASEZF2",122,0)
 ...S EAS(EASAPP,FILE,"+1,","102")=DT
"RTN","EASEZF2",123,0)
 ...S EAS(EASAPP,FILE,"+1,","103")=DUZ
"RTN","EASEZF2",124,0)
 ...S EAS(EASAPP,FILE,"+1,","104")=DT
"RTN","EASEZF2",125,0)
 ..I FILE=408.22,$G(FLINK("AP",1,408.21)) D
"RTN","EASEZF2",126,0)
 ...S EAS(EASAPP,FILE,"+1,",".01")=EASDFN
"RTN","EASEZF2",127,0)
 ...S EAS(EASAPP,FILE,"+1,",".02")=FLINK("AP",1,408.21)
"RTN","EASEZF2",128,0)
 ..S FLINK("AP",MULTIPLE,FILE)=$$NOLINK(.EAS,"AP",MULTIPLE)
"RTN","EASEZF2",129,0)
 ..S FLD="" F  S FLD=$O(AP(MULTIPLE,FILE,SUBFILE,FLD)) Q:FLD=""  D
"RTN","EASEZF2",130,0)
 ...S SUBIEN=$P(AP(MULTIPLE,FILE,SUBFILE,FLD),U,3)
"RTN","EASEZF2",131,0)
 ...;store link to new record in subfile #712.01
"RTN","EASEZF2",132,0)
 ...S $P(AP(MULTIPLE,FILE,SUBFILE,FLD),U,5)=FLINK("AP",1,FILE)
"RTN","EASEZF2",133,0)
 ;
"RTN","EASEZF2",134,0)
 Q
"RTN","EASEZF2",135,0)
 ;
"RTN","EASEZF2",136,0)
LINK(XDATA,FILE,FLD,GRP,MULTIPLE) ;setup to call FM database server if link to file exists & data accepted
"RTN","EASEZF2",137,0)
 N MSG,EZDATA,SUBIEN,PTDATA,XLINK
"RTN","EASEZF2",138,0)
 K EAS,ERR
"RTN","EASEZF2",139,0)
 S EZDATA=$P(XDATA,U,1),SUBIEN=$P(XDATA,U,3),PTDATA=$P(XDATA,U,4),XLINK=$P(XDATA,U,5)
"RTN","EASEZF2",140,0)
 S IENS=XLINK_","
"RTN","EASEZF2",141,0)
 S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF2",142,0)
 D VAL^DIE(FILE,IENS,FLD,"F",EZDATA,,EROOT,"ERR")
"RTN","EASEZF2",143,0)
 I $D(ERR) D ERROR(GRP,MULTIPLE,.ERR,"LINK") Q
"RTN","EASEZF2",144,0)
 ;file to database if input is valid
"RTN","EASEZF2",145,0)
 I '$D(ERR) D
"RTN","EASEZF2",146,0)
 .I FILE=408.21 D
"RTN","EASEZF2",147,0)
 ..S EAS(EASAPP,FILE,IENS,103)=DUZ
"RTN","EASEZF2",148,0)
 ..S EAS(EASAPP,FILE,IENS,104)=DT
"RTN","EASEZF2",149,0)
 .D FILE^DIE("S",EROOT,"ERR")
"RTN","EASEZF2",150,0)
 .;set any replaced data into subfile #712.01 for audit
"RTN","EASEZF2",151,0)
 .I SUBIEN S $P(^EAS(712,EASAPP,10,SUBIEN,2),U,1)=PTDATA
"RTN","EASEZF2",152,0)
 Q
"RTN","EASEZF2",153,0)
 ;
"RTN","EASEZF2",154,0)
NOLINK(EAS,GRP,MULTIPLE) ;add new record with accepted data if no link exists;
"RTN","EASEZF2",155,0)
 ;
"RTN","EASEZF2",156,0)
 K EZIENS,ERR,LINK
"RTN","EASEZF2",157,0)
 S EROOT="EAS("_EASAPP_")"
"RTN","EASEZF2",158,0)
 D UPDATE^DIE("S",EROOT,"EZIENS","ERR")
"RTN","EASEZF2",159,0)
 ;call to UPDATE should not return ERR since internal data formats are used, but just in case;
"RTN","EASEZF2",160,0)
 I $D(ERR) D ERROR(GRP,MULTIPLE,.ERR,"NOLINK")
"RTN","EASEZF2",161,0)
 ;return ien to new record
"RTN","EASEZF2",162,0)
 S LINK=$G(EZIENS(1))
"RTN","EASEZF2",163,0)
 Q LINK
"RTN","EASEZF2",164,0)
 ;
"RTN","EASEZF2",165,0)
ERROR(GRP,MULTIPLE,ERR,FROM) ;add FM error text to error msg
"RTN","EASEZF2",166,0)
 N L,LSTLN,ECODE,ENUMBER
"RTN","EASEZF2",167,0)
 S ECODE="" F  S ECODE=$O(ERR("DIERR","E",ECODE)) Q:ECODE=""  S ENUMBER=0 F  S ENUMBER=$O(ERR("DIERR","E",ECODE,ENUMBER)) Q:'ENUMBER  D
"RTN","EASEZF2",168,0)
 .S LSTLN=+$O(^TMP("1010EZERROR",$J,""),-1) I 'LSTLN S LSTLN=6
"RTN","EASEZF2",169,0)
 .S WHO=$S(GRP="SP":"SPOUSE",GRP="CN":"CHILD",1:"APPLICANT")
"RTN","EASEZF2",170,0)
 .I WHO="CHILD" S WHO=WHO_" #"_MULTIPLE
"RTN","EASEZF2",171,0)
 .S FIELD=$G(ERR("DIERR",ENUMBER,"PARAM","FIELD")),FILE=$G(ERR("DIERR",ENUMBER,"PARAM","FILE"))
"RTN","EASEZF2",172,0)
 .I FROM="LINK" D
"RTN","EASEZF2",173,0)
 ..S LSTLN=LSTLN+1,^TMP("1010EZERROR",$J,LSTLN,0)="1010EZ data for "_WHO_" was not filed to"
"RTN","EASEZF2",174,0)
 ..S LSTLN=LSTLN+1,^TMP("1010EZERROR",$J,LSTLN,0)="Field #"_FIELD_" of File #"_FILE_" because:"
"RTN","EASEZF2",175,0)
 .I FROM="NOLINK" D
"RTN","EASEZF2",176,0)
 ..S LSTLN=LSTLN+1,^TMP("1010EZERROR",$J,LSTLN,0)="A new record for "_WHO_" could not be created in"
"RTN","EASEZF2",177,0)
 ..S LSTLN=LSTLN+1,^TMP("1010EZERROR",$J,LSTLN,0)="File #"_FILE_" because Field #"_FIELD_" produced an error:"
"RTN","EASEZF2",178,0)
 .S L=0 F  S L=$O(ERR("DIERR",ENUMBER,"TEXT",L)) Q:'L  D
"RTN","EASEZF2",179,0)
 ..S LN=ERR("DIERR",ENUMBER,"TEXT",L)
"RTN","EASEZF2",180,0)
 ..I $L(LN)<50 S LSTLN=LSTLN+1,^TMP("1010EZERROR",$J,LSTLN,0)=LN Q
"RTN","EASEZF2",181,0)
 ..D WRAP(LN,.LSTLN)
"RTN","EASEZF2",182,0)
 .S LSTLN=LSTLN+1,^TMP("1010EZERROR",$J,LSTLN,0)=" "
"RTN","EASEZF2",183,0)
 Q
"RTN","EASEZF2",184,0)
 ;
"RTN","EASEZF2",185,0)
WRAP(LN,LSTLN) ;parse a long error text line into several message lines
"RTN","EASEZF2",186,0)
 N PART,BB
"RTN","EASEZF2",187,0)
 F  D  Q:$L(LN)<41
"RTN","EASEZF2",188,0)
 .S PART=""
"RTN","EASEZF2",189,0)
 .F BB=1:1:99 S PART=PART_$P(LN," ",BB)_" " I $L(PART)>40 D  Q
"RTN","EASEZF2",190,0)
 ..S LSTLN=LSTLN+1,^TMP("1010EZERROR",$J,LSTLN,0)=PART
"RTN","EASEZF2",191,0)
 ..S LN=$P(LN," ",BB+1,99)
"RTN","EASEZF2",192,0)
 S LSTLN=LSTLN+1,^TMP("1010EZERROR",$J,LSTLN,0)=LN
"RTN","EASEZF2",193,0)
 Q
"RTN","EASEZI")
0^2^B45881794
"RTN","EASEZI",1,0)
EASEZI ;ALB/jap - Database Inquiry & Record Finder for 1010EZ Processing ;10/12/00  13:08
"RTN","EASEZI",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**1,9**;Mar 15, 2001
"RTN","EASEZI",3,0)
 ;
"RTN","EASEZI",4,0)
DFN(EASAPP,EASDFN) ;match or add 1010EZ applicant to Patient file #2
"RTN","EASEZI",5,0)
 ;
"RTN","EASEZI",6,0)
 ;input  
"RTN","EASEZI",7,0)
 ;  EASAPP = application ien in file #712
"RTN","EASEZI",8,0)
 ;output 
"RTN","EASEZI",9,0)
 ;  EASDFN = valid ien in file #2; passed by reference
"RTN","EASEZI",10,0)
 ;           OR -1 if no patient match made;
"RTN","EASEZI",11,0)
 ;           note: this may be an existing patient or one newly created by user action
"RTN","EASEZI",12,0)
 ;
"RTN","EASEZI",13,0)
 ;This entry point it used only for initial match of Applicant with Patient database.
"RTN","EASEZI",14,0)
 ;
"RTN","EASEZI",15,0)
 N DFN,DGNEWPF,DGRPTOUT,EZDATA,KEY,NAME,SSN,DOB,SEX,KEYIEN,ACCEPT,ARRAY,RECD
"RTN","EASEZI",16,0)
 N VETTYPE,NEW,TSSN,REM,N,X,DA,DR,DIE,DIC,DIQ,ALREADY,OUT,FILE,SUBFILE,FLD,ELIGVER,SVCVER
"RTN","EASEZI",17,0)
 Q:'EASAPP
"RTN","EASEZI",18,0)
 ;do not proceed if link to file #2 already established
"RTN","EASEZI",19,0)
 S EASDFN=$P($G(^EAS(712,EASAPP,0)),U,10) Q:EASDFN
"RTN","EASEZI",20,0)
 ;
"RTN","EASEZI",21,0)
 D FULL^VALM1 W @IOF
"RTN","EASEZI",22,0)
 S EASEZNEW="",ELIGVER=0,SVCVER=0
"RTN","EASEZI",23,0)
 S KEY=$$KEY711^EASEZU1("APPLICANT SEX")
"RTN","EASEZI",24,0)
 S SEX=$P($$DATA712^EASEZU1(EASAPP,KEY),U,1),SEX=$S(SEX="M":"Male",SEX="F":"Female",1:"")
"RTN","EASEZI",25,0)
 S DIQ="ARRAY",DIQ(0)="E",DA=EASAPP,DR="1;2;3;3.3",DIC=712 D EN^DIQ1
"RTN","EASEZI",26,0)
 S NAME=$G(ARRAY(712,EASAPP,1,"E"))
"RTN","EASEZI",27,0)
 S SSN=$P($G(ARRAY(712,EASAPP,2,"E")),"&",1)
"RTN","EASEZI",28,0)
 S DOB=$P($G(ARRAY(712,EASAPP,2,"E")),"&",2)
"RTN","EASEZI",29,0)
 S RECD=$G(ARRAY(712,EASAPP,3,"E"))
"RTN","EASEZI",30,0)
 S VETTYPE=$G(ARRAY(712,EASAPP,3.3,"E"))
"RTN","EASEZI",31,0)
 W !,"Applicant Data",?24,"Application #: ",EASAPP,?48,"Received: ",RECD,!
"RTN","EASEZI",32,0)
 W !,"Name: ",NAME
"RTN","EASEZI",33,0)
 W !,"SSN: ",SSN,?24,"DOB: ",DOB,?48,"Sex: ",SEX
"RTN","EASEZI",34,0)
 W !,"Veteran Type: ",VETTYPE
"RTN","EASEZI",35,0)
 W !!,"Enter Applicant data as prompted --"
"RTN","EASEZI",36,0)
 ;
"RTN","EASEZI",37,0)
 ;Get Patient file (#2) IEN - DFN
"RTN","EASEZI",38,0)
 D GETPAT^DGRPTU("",1,.DFN,.DGNEWPF)
"RTN","EASEZI",39,0)
 Q:($G(DFN)'>0)
"RTN","EASEZI",40,0)
 ;if DGNEWPF=1 then applicant has just been added to file #2 as new patient
"RTN","EASEZI",41,0)
 S NEW=""
"RTN","EASEZI",42,0)
 I DGNEWPF D
"RTN","EASEZI",43,0)
 .S NEW=1
"RTN","EASEZI",44,0)
 .;add a remark to file #2 record to help keep track of new patients added by 1010EZ
"RTN","EASEZI",45,0)
 .S REM="NEW PT. FROM ELECTRONIC 10-10EZ -- IN PROCESS"
"RTN","EASEZI",46,0)
 .S DA=DFN,DIE="^DPT(",DR=".091///^S X=REM"
"RTN","EASEZI",47,0)
 .D ^DIE
"RTN","EASEZI",48,0)
 ;if seems to be not new, check remark field just to make sure
"RTN","EASEZI",49,0)
 I NEW="" D
"RTN","EASEZI",50,0)
 .S REM="NEW PT. FROM ELECTRONIC 10-10EZ -- IN PROCESS"
"RTN","EASEZI",51,0)
 .I $P(^DPT(DFN,0),U,10)=REM S NEW=1
"RTN","EASEZI",52,0)
 ;
"RTN","EASEZI",53,0)
 ;MPI Query
"RTN","EASEZI",54,0)
 S X="MPIFAPI" X ^%ZOSF("TEST")  D
"RTN","EASEZI",55,0)
 .Q:'$T
"RTN","EASEZI",56,0)
 .K MPIFRTN
"RTN","EASEZI",57,0)
 .D MPIQ^MPIFAPI(DFN)
"RTN","EASEZI",58,0)
 .K MPIFRTN,MPIQRYNM
"RTN","EASEZI",59,0)
 ;
"RTN","EASEZI",60,0)
 ;check for an in-process application already linked to this DFN
"RTN","EASEZI",61,0)
 S OUT=0,ALREADY=0 F  S ALREADY=$O(^EAS(712,"AC",DFN,ALREADY)) Q:'ALREADY  D  Q:OUT
"RTN","EASEZI",62,0)
 .S FILDATE=$P($G(^EAS(712,ALREADY,2)),U,5)
"RTN","EASEZI",63,0)
 .S CLSDATE=$P($G(^EAS(712,ALREADY,2)),U,9)
"RTN","EASEZI",64,0)
 .I 'FILDATE,'CLSDATE S OUT=1 D
"RTN","EASEZI",65,0)
 ..W !!?3,"Sorry... cannot link to selected Patient."
"RTN","EASEZI",66,0)
 ..W !?3,"Application #"_ALREADY_" is already linked to this Patient,"
"RTN","EASEZI",67,0)
 ..W !?3,"and is still in-process."
"RTN","EASEZI",68,0)
 ..D PAUSE^VALM1 K FILDATE,CLSDATE
"RTN","EASEZI",69,0)
 Q:OUT
"RTN","EASEZI",70,0)
 ;
"RTN","EASEZI",71,0)
 ;set link in file #712 record
"RTN","EASEZI",72,0)
 S DA=EASAPP
"RTN","EASEZI",73,0)
 S DIE="^EAS(712,"
"RTN","EASEZI",74,0)
 S DR="3.4///^S X=DFN;" I NEW S DR=DR_"3.5///^S X=NEW"
"RTN","EASEZI",75,0)
 D ^DIE
"RTN","EASEZI",76,0)
 ;
"RTN","EASEZI",77,0)
 W !,"One moment please...",!
"RTN","EASEZI",78,0)
 S EASDFN=DFN
"RTN","EASEZI",79,0)
 ;if applicant is new to database, user accept/not accept of data elements is constrained; 
"RTN","EASEZI",80,0)
 ;if applicant is new to VistA, mark all data elements 'accepted';
"RTN","EASEZI",81,0)
 I NEW S N=0 F  S N=$O(^EAS(712,EASAPP,10,N)) Q:'N  I $G(^EAS(712,EASAPP,10,N,1))'="" D
"RTN","EASEZI",82,0)
 .S ACCEPT="",FLD="",SUBFILE="",FILE=""
"RTN","EASEZI",83,0)
 .S KEYIEN=$P(^EAS(712,EASAPP,10,N,0),U,1)
"RTN","EASEZI",84,0)
 .I KEYIEN S X=$G(^EAS(711,KEYIEN,1)),FILE=$P(X,U,1),SUBFILE=$P(X,U,2),FLD=$P(X,U,3)
"RTN","EASEZI",85,0)
 .I FLD S ACCEPT=1
"RTN","EASEZI",86,0)
 .I 'FLD S ACCEPT=-1
"RTN","EASEZI",87,0)
 .I (FILE=355.33)!(FILE>408) S ACCEPT=2
"RTN","EASEZI",88,0)
 .I FILE=2,((FLD=.01)!(FLD=.03)!(FLD=.09)!(FLD=.531)) S ACCEPT=-1
"RTN","EASEZI",89,0)
 .I ((SUBFILE=2.01)!(SUBFILE=2.101)) S ACCEPT=-1
"RTN","EASEZI",90,0)
 .S $P(^EAS(712,EASAPP,10,N,0),U,3)=ACCEPT
"RTN","EASEZI",91,0)
 ;for applicants matched to existing patients check for verified eligibility
"RTN","EASEZI",92,0)
 I 'NEW D
"RTN","EASEZI",93,0)
 .K ARRAY
"RTN","EASEZI",94,0)
 .S DA=EASDFN,DIC="^DPT(",DR=".3611;.3613",DIQ(0)="I",DIQ="ARRAY"
"RTN","EASEZI",95,0)
 .D EN^DIQ1
"RTN","EASEZI",96,0)
 .I ARRAY(2,EASDFN,.3611,"I")="V",ARRAY(2,EASDFN,.3613,"I")="H" S ELIGVER=1
"RTN","EASEZI",97,0)
 ;setup tmp array for data mapping
"RTN","EASEZI",98,0)
 D LOCAL711^EASEZU2
"RTN","EASEZI",99,0)
 ;correlate #712 data with mapping array
"RTN","EASEZI",100,0)
 S N=0 F  S N=$O(^EAS(712,EASAPP,10,N)) Q:'N  S X=^(N,0) D
"RTN","EASEZI",101,0)
 .;don't set array node if no 1010EZ data
"RTN","EASEZI",102,0)
 .S EZDATA=$P($G(^EAS(712,EASAPP,10,N,1)),U,1)
"RTN","EASEZI",103,0)
 .Q:EZDATA=""
"RTN","EASEZI",104,0)
 .S IEN=$P(X,U,1),MULTIPLE=$P(X,U,2),ACCEPT=$P(X,U,3)
"RTN","EASEZI",105,0)
 .S ^TMP("EZDATA",$J,IEN,MULTIPLE,1)=EZDATA_U_ACCEPT_U_N
"RTN","EASEZI",106,0)
 ;
"RTN","EASEZI",107,0)
 ;if applicant new to VistA, stop here;
"RTN","EASEZI",108,0)
 I NEW S EASEZNEW=1
"RTN","EASEZI",109,0)
 Q:EASEZNEW
"RTN","EASEZI",110,0)
 ;if matched to existing patient, get all iens needed
"RTN","EASEZI",111,0)
 W !,"Preparing for data comparison to VistA Patient database...",!
"RTN","EASEZI",112,0)
 K ALIAS,DISPOS,ENROLL,INCREL
"RTN","EASEZI",113,0)
 D I201^EASEZI(EASDFN,.ALIAS) W "."
"RTN","EASEZI",114,0)
 I $D(ALIAS)>1 D C201^EASEZC1
"RTN","EASEZI",115,0)
 D I2101^EASEZI(EASDFN,.DISPOS) W "."
"RTN","EASEZI",116,0)
 I $D(DISPOS)>1 D C2101^EASEZC1
"RTN","EASEZI",117,0)
 ;finish getting the rest of file #2 data needed for comparison 
"RTN","EASEZI",118,0)
 D C2^EASEZC1
"RTN","EASEZI",119,0)
 D I2711^EASEZI(EASDFN,.ENROLL) W "."
"RTN","EASEZI",120,0)
 I $D(ENROLL)>1 D C2711^EASEZC1
"RTN","EASEZI",121,0)
 D I408^EASEZI(EASDFN,EASAPP,.INCREL) W "."
"RTN","EASEZI",122,0)
 I $D(INCREL)>1 D C408^EASEZC1
"RTN","EASEZI",123,0)
 ;
"RTN","EASEZI",124,0)
 ;for all applicants matched to existing patients, 
"RTN","EASEZI",125,0)
 ;  set file #355.33 data to 'always accept';
"RTN","EASEZI",126,0)
 ;  ;set unmatched data for files #408.12, #408.13, #408.21, #408.22 to 'always accept';
"RTN","EASEZI",127,0)
 S N=0 F  S N=$O(^EAS(712,EASAPP,10,N)) Q:'N  S X=^(N,0) D
"RTN","EASEZI",128,0)
 .S KEYIEN=$P(X,U,1),MULTIPLE=$P(X,U,2)
"RTN","EASEZI",129,0)
 .;S LINK=$P($G(^EAS(712,EASAPP,10,N,2)),U,2)
"RTN","EASEZI",130,0)
 .S X=$G(^EAS(711,KEYIEN,1)),FILE=$P(X,U,1),FLD=$P(X,U,3)
"RTN","EASEZI",131,0)
 .S ACCEPT=""
"RTN","EASEZI",132,0)
 .I 'FLD S ACCEPT=-1
"RTN","EASEZI",133,0)
 .I FILE=2,((FLD=.01)!(FLD=.03)!(FLD=.09)!(FLD=.531)) S ACCEPT=-1
"RTN","EASEZI",134,0)
 .;set certain eligibility related data elements to 'never accept' if eligibility verified
"RTN","EASEZI",135,0)
 .I FILE=2,FLD=.313,$G(ARRAY(2,EASDFN,.3611,"I"))="V" S ACCEPT=-1
"RTN","EASEZI",136,0)
 .I FILE=2,ELIGVER,((FLD=.301)!(FLD=.302)!(FLD=.36235)) S ACCEPT=-1
"RTN","EASEZI",137,0)
 .I FILE=355.33 S ACCEPT=2
"RTN","EASEZI",138,0)
 .I FILE>408 S ACCEPT=2
"RTN","EASEZI",139,0)
 .S $P(^EAS(712,EASAPP,10,N,0),U,3)=ACCEPT
"RTN","EASEZI",140,0)
 .S $P(^TMP("EZDATA",$J,KEYIEN,MULTIPLE,1),U,2)=ACCEPT
"RTN","EASEZI",141,0)
 K ALIAS,DISPOS,ENROLL,INCREL
"RTN","EASEZI",142,0)
 Q
"RTN","EASEZI",143,0)
 ;
"RTN","EASEZI",144,0)
I201(EASDFN,EASARRAY) ;retrieve ien(s) in Alias subfile #2.01
"RTN","EASEZI",145,0)
 ;input EASDFN    = ien to #2
"RTN","EASEZI",146,0)
 ;output EASARRAY = ien(s) to #2.01
"RTN","EASEZI",147,0)
 ;                  each array element = EASDFN;subfile_ien
"RTN","EASEZI",148,0)
 ;
"RTN","EASEZI",149,0)
 N N,IEN
"RTN","EASEZI",150,0)
 S IEN=0,N=0 F  S IEN=$O(^DPT(EASDFN,.01,IEN)) Q:'IEN  S N=N+1,EASARRAY(N)=EASDFN_";"_IEN
"RTN","EASEZI",151,0)
 Q
"RTN","EASEZI",152,0)
 ;
"RTN","EASEZI",153,0)
I2101(EASDFN,EASARRAY) ;retrieve ien to Disposition subfile #2.101
"RTN","EASEZI",154,0)
 ;input EASDFN    = ien to #2
"RTN","EASEZI",155,0)
 ;output EASARRAY = most recent ien in #2.101;
"RTN","EASEZI",156,0)
 ;                  array element = EASDFN;subfile_ien
"RTN","EASEZI",157,0)
 ;
"RTN","EASEZI",158,0)
 N N,IEN,ARR,LAST
"RTN","EASEZI",159,0)
 S IEN=0,N=0 F  S IEN=$O(^DPT(EASDFN,"DIS",IEN)) Q:'IEN  D
"RTN","EASEZI",160,0)
 .S RDATE=$P(^DPT(EASDFN,"DIS",IEN,0),U,1),ARR(RDATE)=IEN
"RTN","EASEZI",161,0)
 I $D(ARR) D
"RTN","EASEZI",162,0)
 .S LAST=$O(ARR(999999999),-1),IEN=ARR(LAST)
"RTN","EASEZI",163,0)
 .S EASARRAY(1)=EASDFN_";"_IEN
"RTN","EASEZI",164,0)
 Q
"RTN","EASEZI",165,0)
 ;
"RTN","EASEZI",166,0)
I2711(EASDFN,EASARRAY) ;retrieve ien to Enrollment file #27.11
"RTN","EASEZI",167,0)
 ;input EASDFN    = ien to #2
"RTN","EASEZI",168,0)
 ;output EASARRAY = current enrollment ien in #27.11;
"RTN","EASEZI",169,0)
 ;                  array element = ien
"RTN","EASEZI",170,0)
 N CUR
"RTN","EASEZI",171,0)
 S CUR=$$FINDCUR^DGENA(+EASDFN)
"RTN","EASEZI",172,0)
 S EASARRAY(1)=CUR
"RTN","EASEZI",173,0)
 Q
"RTN","EASEZI",174,0)
 ;
"RTN","EASEZI",175,0)
I408(EASDFN,EASAPP,EASARRAY) ;retrieve ien(s) to files #408.12,#408.13,#408.21,#408.22
"RTN","EASEZI",176,0)
 ;
"RTN","EASEZI",177,0)
 ;input EASDFN    = ien to #2
"RTN","EASEZI",178,0)
 ;      EASAPP    = ien to #712
"RTN","EASEZI",179,0)
 ;output EASARRAY = ien(s) to files; passed by reference
"RTN","EASEZI",180,0)
 ;       array(408,"V",1) = ien_#408.12^ien_#408.13^ien_#408.21^ien#408.22 ;veteran data
"RTN","EASEZI",181,0)
 ;       array(408,"S",1) = ien_#408.12^ien_#408.13^ien_#408.21^ien#408.22 ;spouse data
"RTN","EASEZI",182,0)
 ;       array(408,"C",multiple) = ien_#408.12^ien_#408.13^ien_#408.21^ien#408.22 ;child data
"RTN","EASEZI",183,0)
 ;   where ien_#408.13 = ien;global_root
"RTN","EASEZI",184,0)
 ;
"RTN","EASEZI",185,0)
 N CURINCYR,X,Y,DIC,DA,DR,DIQ,EAS,DEP,REL,IX,JX,KX,I13,SUB1,SUB2,INCYR,PT
"RTN","EASEZI",186,0)
 ;
"RTN","EASEZI",187,0)
 Q:'EASDFN
"RTN","EASEZI",188,0)
 S Y=$P($G(^EAS(712,EASAPP,0)),U,6) I Y="" S Y=DT
"RTN","EASEZI",189,0)
 S %F=5,X=$$FMTE^XLFDT(Y,%F),X=+$P(X,"/",3)-1,%DT="P" D ^%DT S CURINCYR=Y
"RTN","EASEZI",190,0)
 ;find all associated 408 records, even if no actual income test
"RTN","EASEZI",191,0)
 ; get #408.12, #408.13, #408.21, #408.22 iens
"RTN","EASEZI",192,0)
 K EAS S DEP=0
"RTN","EASEZI",193,0)
 S IX=0 F  S IX=$O(^DGPR(408.12,"B",EASDFN,IX)) Q:'IX  D
"RTN","EASEZI",194,0)
 .S DIC=408.12,DA=IX,DIQ="EAS",DIQ(0)="I",DR=".02;.03" D EN^DIQ1
"RTN","EASEZI",195,0)
 .S REL=$G(EAS(408.12,IX,.02,"I")),I13=$G(EAS(408.12,IX,.03,"I"))
"RTN","EASEZI",196,0)
 .S (SUB1,SUB2)="" S:REL=1 SUB1="V",SUB2=1 S:REL=2 SUB1="S",SUB2=1 S:REL>2 SUB1="C",DEP=DEP+1,SUB2=DEP
"RTN","EASEZI",197,0)
 .I SUB1]"" S EASARRAY(408,SUB1,SUB2)=IX_U_I13 D
"RTN","EASEZI",198,0)
 ..S JX=$O(^DGMT(408.21,"C",IX,""),-1)
"RTN","EASEZI",199,0)
 ..I JX D
"RTN","EASEZI",200,0)
 ...S DIC=408.21,DA=JX,DIQ="EAS",DIQ(0)="I",DR=".01;.02" D EN^DIQ1
"RTN","EASEZI",201,0)
 ...S INCYR=$G(EAS(408.21,JX,.01,"I")),PT=$G(EAS(408.21,JX,.02,"I"))
"RTN","EASEZI",202,0)
 ...Q:PT'=IX
"RTN","EASEZI",203,0)
 ...Q:(INCYR<CURINCYR)
"RTN","EASEZI",204,0)
 ...S KX=$O(^DGMT(408.22,"AIND",JX,0))
"RTN","EASEZI",205,0)
 ...S EASARRAY(408,SUB1,SUB2)=EASARRAY(408,SUB1,SUB2)_U_JX_U_KX
"RTN","EASEZI",206,0)
 Q
"RTN","EASEZI",207,0)
 ;
"RTN","EASEZI",208,0)
I1275(IEN) ;get the active subrecord from subfile #408.1275
"RTN","EASEZI",209,0)
 ;input     IEN = internal record number to file #408.12
"RTN","EASEZI",210,0)
 ;output SUBIEN = internal record number for active subrecord,
"RTN","EASEZI",211,0)
 ;                or -1 if invalid
"RTN","EASEZI",212,0)
 N B,ACT,SUBIEN
"RTN","EASEZI",213,0)
 I 'IEN Q -1
"RTN","EASEZI",214,0)
 S SUBIEN=-1
"RTN","EASEZI",215,0)
 S B=0 F  S B=$O(^DGPR(408.12,IEN,"E",B)) Q:'B  D
"RTN","EASEZI",216,0)
 .S ACT=$P(^DGPR(408.12,IEN,"E",B,0),U,2)
"RTN","EASEZI",217,0)
 .I ACT S SUBIEN=B
"RTN","EASEZI",218,0)
 Q SUBIEN
"VER")
8.0^22
**END**
**END**
