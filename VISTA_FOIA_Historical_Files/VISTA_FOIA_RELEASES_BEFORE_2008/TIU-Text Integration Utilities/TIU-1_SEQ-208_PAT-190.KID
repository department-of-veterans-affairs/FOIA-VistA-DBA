Released TIU*1*190 SEQ #208
Extracted from mail message
**KIDS**:TIU*1.0*190^

**INSTALL NAME**
TIU*1.0*190
"BLD",5482,0)
TIU*1.0*190^TEXT INTEGRATION UTILITIES^0^3061012^y
"BLD",5482,4,0)
^9.64PA^^
"BLD",5482,6.3)
1
"BLD",5482,"KRN",0)
^9.67PA^8989.52^19
"BLD",5482,"KRN",.4,0)
.4
"BLD",5482,"KRN",.401,0)
.401
"BLD",5482,"KRN",.402,0)
.402
"BLD",5482,"KRN",.403,0)
.403
"BLD",5482,"KRN",.5,0)
.5
"BLD",5482,"KRN",.84,0)
.84
"BLD",5482,"KRN",3.6,0)
3.6
"BLD",5482,"KRN",3.8,0)
3.8
"BLD",5482,"KRN",9.2,0)
9.2
"BLD",5482,"KRN",9.8,0)
9.8
"BLD",5482,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",5482,"KRN",9.8,"NM",1,0)
TIUPXAP2^^0^B36374051
"BLD",5482,"KRN",9.8,"NM",2,0)
TIUVSIT^^0^B64134241
"BLD",5482,"KRN",9.8,"NM",3,0)
TIUVSIT1^^0^B10242353
"BLD",5482,"KRN",9.8,"NM",4,0)
TIUVISIT^^0^B24528930
"BLD",5482,"KRN",9.8,"NM","B","TIUPXAP2",1)

"BLD",5482,"KRN",9.8,"NM","B","TIUVISIT",4)

"BLD",5482,"KRN",9.8,"NM","B","TIUVSIT",2)

"BLD",5482,"KRN",9.8,"NM","B","TIUVSIT1",3)

"BLD",5482,"KRN",19,0)
19
"BLD",5482,"KRN",19.1,0)
19.1
"BLD",5482,"KRN",101,0)
101
"BLD",5482,"KRN",409.61,0)
409.61
"BLD",5482,"KRN",771,0)
771
"BLD",5482,"KRN",870,0)
870
"BLD",5482,"KRN",8989.51,0)
8989.51
"BLD",5482,"KRN",8989.52,0)
8989.52
"BLD",5482,"KRN",8994,0)
8994
"BLD",5482,"KRN","B",.4,.4)

"BLD",5482,"KRN","B",.401,.401)

"BLD",5482,"KRN","B",.402,.402)

"BLD",5482,"KRN","B",.403,.403)

"BLD",5482,"KRN","B",.5,.5)

"BLD",5482,"KRN","B",.84,.84)

"BLD",5482,"KRN","B",3.6,3.6)

"BLD",5482,"KRN","B",3.8,3.8)

"BLD",5482,"KRN","B",9.2,9.2)

"BLD",5482,"KRN","B",9.8,9.8)

"BLD",5482,"KRN","B",19,19)

"BLD",5482,"KRN","B",19.1,19.1)

"BLD",5482,"KRN","B",101,101)

"BLD",5482,"KRN","B",409.61,409.61)

"BLD",5482,"KRN","B",771,771)

"BLD",5482,"KRN","B",870,870)

"BLD",5482,"KRN","B",8989.51,8989.51)

"BLD",5482,"KRN","B",8989.52,8989.52)

"BLD",5482,"KRN","B",8994,8994)

"BLD",5482,"QUES",0)
^9.62^^
"BLD",5482,"REQB",0)
^9.611^1^1
"BLD",5482,"REQB",1,0)
TIU*1.0*179^2
"BLD",5482,"REQB","B","TIU*1.0*179",1)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
190^3061012
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","TIUPXAP2")
0^1^B36374051^B35346501
"RTN","TIUPXAP2",1,0)
TIUPXAP2 ; SLC/JER - More code for the workload capture ;12/4/02@07:54:52 [1/18/05 9:27am]
"RTN","TIUPXAP2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**20,67,82,107,126,124,149,179,190**;Jun 20, 1997;Build 1
"RTN","TIUPXAP2",3,0)
TEST ; Test the PXAPI Data Capture dialogs
"RTN","TIUPXAP2",4,0)
 N CPT,DFN,ICD,ICDARR,CPTARR,SC,DTOUT,TIU,TIUOK
"RTN","TIUPXAP2",5,0)
 S DFN=+$$PATIENT^TIULA
"RTN","TIUPXAP2",6,0)
 S TIU("LOC")=$$SELLOC^TIUVSIT
"RTN","TIUPXAP2",7,0)
 D GETICD^TIUPXAPI(TIU("LOC"),.ICDARR)
"RTN","TIUPXAP2",8,0)
 D ICD^TIUPXAPI(.ICD,.ICDARR)
"RTN","TIUPXAP2",9,0)
 D GETCPT^TIUPXAPC(TIU("LOC"),.CPTARR)
"RTN","TIUPXAP2",10,0)
CPTCALL D CPT^TIUPXAPC(.CPT,.CPTARR)
"RTN","TIUPXAP2",11,0)
 I '$D(CPT),'$D(DTOUT) W !!,$C(7),"You MUST enter one or more Procedures." G CPTCALL
"RTN","TIUPXAP2",12,0)
 D SCASK^TIUPXAPS(.SC,+DFN,.TIU)
"RTN","TIUPXAP2",13,0)
 I $D(DTOUT)!(+$O(ICD(0))'>0)&(+$O(CPT(0))'>0)&(+$O(SC(0))'>0) D  Q
"RTN","TIUPXAP2",14,0)
 . W !,$C(7),"Insufficient information for Workload Credit."
"RTN","TIUPXAP2",15,0)
 . W !,"Missing information will have to be captured by another method."
"RTN","TIUPXAP2",16,0)
 S TIUOK=$$CONFIRM^TIUPXAPI(.ICD,.CPT,.SC)
"RTN","TIUPXAP2",17,0)
 I '+TIUOK D  G TEST
"RTN","TIUPXAP2",18,0)
 . W !!,"Changes Discarded. Please Enter Corrected Workload Data..." H 3
"RTN","TIUPXAP2",19,0)
 . K ICD,CPT,SC,ICDARR,CPTARR
"RTN","TIUPXAP2",20,0)
 K CPTARR,ICDARR
"RTN","TIUPXAP2",21,0)
 W "Done."
"RTN","TIUPXAP2",22,0)
 Q
"RTN","TIUPXAP2",23,0)
CMBLST(EMCODES,CPTCODES) ; Combine E/M and other CPT codes
"RTN","TIUPXAP2",24,0)
 N TIUI,TIUJ,TMPARRY S (TIUI,TIUJ)=0
"RTN","TIUPXAP2",25,0)
 M TMPARRY=EMCODES S TIUI=EMCODES(0)
"RTN","TIUPXAP2",26,0)
 F  S TIUJ=$O(CPTCODES(TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUPXAP2",27,0)
 . S TIUI=+$G(TIUI)+1,TMPARRY(TIUI)=CPTCODES(TIUJ),TMPARRY(0)=TIUI
"RTN","TIUPXAP2",28,0)
 . ;Merge CPT Modifiers
"RTN","TIUPXAP2",29,0)
 . M TMPARRY(TIUI,"MODIFIER")=CPTCODES(TIUJ,"MODIFIER")
"RTN","TIUPXAP2",30,0)
 K CPTCODES
"RTN","TIUPXAP2",31,0)
 M CPTCODES=TMPARRY
"RTN","TIUPXAP2",32,0)
 Q
"RTN","TIUPXAP2",33,0)
PICK(LOW,HIGH,PROMPT,TYPE) ; List selection
"RTN","TIUPXAP2",34,0)
 N X,Y S PROMPT=$G(PROMPT,"Select Item"),TYPE=$G(TYPE,"LO")
"RTN","TIUPXAP2",35,0)
 W !
"RTN","TIUPXAP2",36,0)
 S Y=$$READ^TIUU(TYPE_U_LOW_":"_HIGH,PROMPT)
"RTN","TIUPXAP2",37,0)
 Q Y
"RTN","TIUPXAP2",38,0)
EDTENC(TIUDA,CHNG) ; Edit the encounter for a given note
"RTN","TIUPXAP2",39,0)
 N TIUD0,TIUD12,TIUDFN,TIUI,TIUVSIT,TIUHL,TIUEDT,TIUPAUSE,TIUERR,TIUWHAT
"RTN","TIUPXAP2",40,0)
 N TIUCONT,DA
"RTN","TIUPXAP2",41,0)
 Q:$D(XWBOS)
"RTN","TIUPXAP2",42,0)
 Q:+$P($G(TIUDPRM(0)),U,14)
"RTN","TIUPXAP2",43,0)
 D FULL^VALM1
"RTN","TIUPXAP2",44,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^(12))
"RTN","TIUPXAP2",45,0)
 S TIUHL=$P(TIUD12,U,11)
"RTN","TIUPXAP2",46,0)
 I $P($G(^SC(+TIUHL,0)),U,3)'="C" Q
"RTN","TIUPXAP2",47,0)
 ;
"RTN","TIUPXAP2",48,0)
 ;If not ok to ask workload, quit
"RTN","TIUPXAP2",49,0)
 I '$$WORKOK^TIUPXAP1(+TIUDA) Q
"RTN","TIUPXAP2",50,0)
 ;
"RTN","TIUPXAP2",51,0)
 S TIUDFN=$P(TIUD0,U,2),TIUEDT=$P(TIUD0,U,7),TIUVSIT=$P(TIUD0,U,3)
"RTN","TIUPXAP2",52,0)
 N TIUMVSTF,TIUVSITS
"RTN","TIUPXAP2",53,0)
 ;If no visit has been filed with the document
"RTN","TIUPXAP2",54,0)
 I $G(TIUVSIT)'>0 D
"RTN","TIUPXAP2",55,0)
 . ;Check for the visit
"RTN","TIUPXAP2",56,0)
 . S TIUVSITS=$$GETENC^PXAPI(TIUDFN,TIUEDT,TIUHL)
"RTN","TIUPXAP2",57,0)
 . I TIUVSITS>0 S TIUVSIT=+TIUVSITS
"RTN","TIUPXAP2",58,0)
 . ;Set a flag if multiple visits
"RTN","TIUPXAP2",59,0)
 . I $P(TIUVSITS,U,2)'="" S TIUMVSTF=1
"RTN","TIUPXAP2",60,0)
 . ;If only one visit update the document
"RTN","TIUPXAP2",61,0)
 . I $G(TIUVSIT)>0,'$G(TIUMVSTF) D
"RTN","TIUPXAP2",62,0)
 . . S TIUERR=$$UPDVST(TIUDA,TIUVSIT)
"RTN","TIUPXAP2",63,0)
 . . K ^TMP("PXKENC",$J)
"RTN","TIUPXAP2",64,0)
 W !!
"RTN","TIUPXAP2",65,0)
 ;Ask the user if they wish to enter workload if the parameter is defined
"RTN","TIUPXAP2",66,0)
 ;and the multiple visit flag is not set
"RTN","TIUPXAP2",67,0)
 I $D(TIUDPRM(0)),'$G(TIUMVSTF),$G(TIUVSIT)>0 D  Q:'+TIUCONT
"RTN","TIUPXAP2",68,0)
 . S TIUCONT=$$READ^TIUU("Y","Do you wish to enter workload data at this time","YES")
"RTN","TIUPXAP2",69,0)
 I $G(VALMAR)="^TMP(""TIUR"",$J)" D
"RTN","TIUPXAP2",70,0)
 . N TIU D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPXAP2",71,0)
 . W !!,"For ",$G(TIU("PNM"))," ",$G(TIU("PID"))," Visit on "
"RTN","TIUPXAP2",72,0)
 . W $P($G(TIU("EDT")),U,2),"...",!
"RTN","TIUPXAP2",73,0)
 I $P($P(TIUD0,U,7),".")>DT D  Q
"RTN","TIUPXAP2",74,0)
 . W !!,$C(7),"ACRP will not accept data for future Encounters.",!
"RTN","TIUPXAP2",75,0)
 . W !,"Workload questions won't be asked for this note.",!
"RTN","TIUPXAP2",76,0)
 . S TIUPAUSE=$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUPXAP2",77,0)
 I $G(VALMAR)'="^TMP(""TIUR"",$J)" W !!,"Editing Encounter Data...",!
"RTN","TIUPXAP2",78,0)
 S TIUWHAT=$S($$CHKAPPT(TIUVSIT,TIUDFN,TIUEDT,TIUHL):"INTV",1:"ADDEDIT")
"RTN","TIUPXAP2",79,0)
 S TIUERR=$$INTV^PXAPI(TIUWHAT,"TIU","TEXT INTEGRATION UTILITIES",.TIUVSIT,$S(+$G(TIUVSIT):"",1:TIUHL),TIUDFN,$S(+$G(TIUVSIT):"",1:TIUEDT))
"RTN","TIUPXAP2",80,0)
 ;
"RTN","TIUPXAP2",81,0)
 ;If an error is returned prompt to continue otherwise if a Visit
"RTN","TIUPXAP2",82,0)
 ;IEN is returned and one is not already defined update the document
"RTN","TIUPXAP2",83,0)
 I +TIUERR<0 D
"RTN","TIUPXAP2",84,0)
 . W ! S TIUPAUSE=$$READ^TIUU("EA","Press RETURN to continue...")
"RTN","TIUPXAP2",85,0)
 ELSE  D
"RTN","TIUPXAP2",86,0)
 . I $G(TIUVSIT)>0,'$P($G(^TIU(8925,+TIUDA,0)),U,3) S TIUERR=$$UPDVST(TIUDA,TIUVSIT)
"RTN","TIUPXAP2",87,0)
 S CHNG=1
"RTN","TIUPXAP2",88,0)
 Q
"RTN","TIUPXAP2",89,0)
 ;
"RTN","TIUPXAP2",90,0)
CHKVST(TIUDA) ;Check the visit associated with the document for key workload
"RTN","TIUPXAP2",91,0)
 ;data elements.  Key data elements include provider, diagnosis,
"RTN","TIUPXAP2",92,0)
 ;procedure and classifications.
"RTN","TIUPXAP2",93,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUPXAP2",94,0)
 ; Output -- 0=No Key Workload Data Elements Exist
"RTN","TIUPXAP2",95,0)
 ;           1=Key Workload Data Elements Exist
"RTN","TIUPXAP2",96,0)
 ;           2=Unable to Determine if Key Workload Data Elements Exist
"RTN","TIUPXAP2",97,0)
 N I,TIUCHKF,TIUD0,TIUDFN,TIUEDT,TIUHL,TIUVSIT,TIUVSITS,X
"RTN","TIUPXAP2",98,0)
 ;
"RTN","TIUPXAP2",99,0)
 ;Set variables, if the 0th node of the document is not defined quit
"RTN","TIUPXAP2",100,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)) I TIUD0="" S TIUCHKF=2 G CHKVSTQ
"RTN","TIUPXAP2",101,0)
 S TIUDFN=$P(TIUD0,U,2),TIUVSIT=$P(TIUD0,U,3),TIUEDT=$P(TIUD0,U,7)
"RTN","TIUPXAP2",102,0)
 S TIUHL=$P($G(^TIU(8925,+TIUDA,12)),U,11)
"RTN","TIUPXAP2",103,0)
 ;
"RTN","TIUPXAP2",104,0)
 ;Get data associated with the visit
"RTN","TIUPXAP2",105,0)
 I $G(TIUVSIT)>0 D
"RTN","TIUPXAP2",106,0)
 . D ENCEVENT^PXKENC(TIUVSIT)
"RTN","TIUPXAP2",107,0)
 ELSE  D
"RTN","TIUPXAP2",108,0)
 . S TIUVSITS=$$GETENC^PXAPI(TIUDFN,TIUEDT,TIUHL)
"RTN","TIUPXAP2",109,0)
 . I TIUVSITS>0 S TIUVSIT=+TIUVSITS
"RTN","TIUPXAP2",110,0)
 . I $P(TIUVSITS,U,2)'="" S TIUCHKF=2 ;multiple visits
"RTN","TIUPXAP2",111,0)
 ;
"RTN","TIUPXAP2",112,0)
 ;If a visit is not defined or multiple visits exist, quit
"RTN","TIUPXAP2",113,0)
 I $G(TIUVSIT)'>0!($G(TIUCHKF)=2) G CHKVSTQ
"RTN","TIUPXAP2",114,0)
 ;
"RTN","TIUPXAP2",115,0)
 ;If a provider or diagnosis or procedure exists for the visit, set flag
"RTN","TIUPXAP2",116,0)
 ;and quit
"RTN","TIUPXAP2",117,0)
 I $D(^TMP("PXKENC",$J,TIUVSIT,"PRV"))!($D(^("CPT")))!($D(^("POV"))) S TIUCHKF=1 G CHKVSTQ
"RTN","TIUPXAP2",118,0)
 ;
"RTN","TIUPXAP2",119,0)
 ;If a classification exists for the visit, set flag and quit
"RTN","TIUPXAP2",120,0)
 I $D(^TMP("PXKENC",$J,TIUVSIT,"VST",TIUVSIT,800)) S X=^(800) D
"RTN","TIUPXAP2",121,0)
 . F I=1:1:6 I $P(X,U,I)'="" S TIUCHKF=1 Q
"RTN","TIUPXAP2",122,0)
 ;
"RTN","TIUPXAP2",123,0)
CHKVSTQ K ^TMP("PXKENC",$J)
"RTN","TIUPXAP2",124,0)
 Q +$G(TIUCHKF)
"RTN","TIUPXAP2",125,0)
 ;
"RTN","TIUPXAP2",126,0)
UPDVST(TIUDA,TIUVSIT,ERROR) ;Update Visit in TIU Document file #8925
"RTN","TIUPXAP2",127,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUPXAP2",128,0)
 ;           TIUVSIT  Visit file (#9000010) IEN
"RTN","TIUPXAP2",129,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUPXAP2",130,0)
 ;           ERROR    Error Message  (Optional)
"RTN","TIUPXAP2",131,0)
 N DIERR,OKF,TIUFDA
"RTN","TIUPXAP2",132,0)
 ;
"RTN","TIUPXAP2",133,0)
 ;Quit if a visit is not defined
"RTN","TIUPXAP2",134,0)
 G UPDVSTQ:$G(TIUVSIT)'>0
"RTN","TIUPXAP2",135,0)
 ;
"RTN","TIUPXAP2",136,0)
 ;Update document with visit
"RTN","TIUPXAP2",137,0)
 S TIUFDA(8925,TIUDA_",",.03)=TIUVSIT
"RTN","TIUPXAP2",138,0)
 L +^TIU(8925,TIUDA):1 I $T D
"RTN","TIUPXAP2",139,0)
 . D FILE^DIE("","TIUFDA","") L -^TIU(8925,TIUDA)
"RTN","TIUPXAP2",140,0)
 . S ERROR=$G(DIERR)
"RTN","TIUPXAP2",141,0)
 . S OKF=$S(+$G(ERROR):0,1:1)
"RTN","TIUPXAP2",142,0)
 ELSE  D
"RTN","TIUPXAP2",143,0)
 . S OKF=0
"RTN","TIUPXAP2",144,0)
UPDVSTQ Q +$G(OKF)
"RTN","TIUPXAP2",145,0)
 ;
"RTN","TIUPXAP2",146,0)
CHKWKL(TIUDA,TIUDPRM) ;Check if workload data should be entered
"RTN","TIUPXAP2",147,0)
 ; Input  -- TIUDA    TIU Document file (#8925) IEN
"RTN","TIUPXAP2",148,0)
 ;           TIUDPRM  TIU Document Parameters file (#8925.95) Array
"RTN","TIUPXAP2",149,0)
 ; Output -- 1=Enter Workload and 0=Do Not Enter Workload
"RTN","TIUPXAP2",150,0)
 N STATUS,TIUAPPTF,TIUD0,TIUDFN,TIUEDT,TIUHL,TIUVSIT,TIUWKLF,TIURES,TIUINC,TIUARRAY,TIUCNT
"RTN","TIUPXAP2",151,0)
 ;
"RTN","TIUPXAP2",152,0)
 ;Set variables, if the 0th node of the document is not defined quit
"RTN","TIUPXAP2",153,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)) G CHKWKLQ:TIUD0=""
"RTN","TIUPXAP2",154,0)
 S TIUDFN=$P(TIUD0,U,2),TIUVSIT=$P(TIUD0,U,3),TIUEDT=$P(TIUD0,U,7)
"RTN","TIUPXAP2",155,0)
 S TIUHL=$P($G(^TIU(8925,+TIUDA,12)),U,11)
"RTN","TIUPXAP2",156,0)
 ;
"RTN","TIUPXAP2",157,0)
 ;Check if an appointment is associated with the visit
"RTN","TIUPXAP2",158,0)
 S:$$CHKAPPT(TIUVSIT,TIUDFN,TIUEDT,TIUHL)>0 TIUAPPTF=1
"RTN","TIUPXAP2",159,0)
 ;
"RTN","TIUPXAP2",160,0)
 ;If an appointment is not associated with the visit, assume
"RTN","TIUPXAP2",161,0)
 ;the visit is new, set flag to enter workload and quit
"RTN","TIUPXAP2",162,0)
 I '$G(TIUAPPTF) S TIUWKLF=1 G CHKWKLQ
"RTN","TIUPXAP2",163,0)
 ;
"RTN","TIUPXAP2",164,0)
 ;Check the parameter 'Ask Dx/CPT on All Opt Visits'.  If it is set to
"RTN","TIUPXAP2",165,0)
 ;No, workload should not be entered for the appointment.
"RTN","TIUPXAP2",166,0)
 I '$$BROKER^XWBLIB(),'$P($G(TIUDPRM(0)),U,16) G CHKWKLQ
"RTN","TIUPXAP2",167,0)
 ;
"RTN","TIUPXAP2",168,0)
 ;Get the status of the appointment
"RTN","TIUPXAP2",169,0)
 S TIUARRAY(1)=TIUEDT_";"_TIUEDT
"RTN","TIUPXAP2",170,0)
 S TIUARRAY(2)=TIUHL
"RTN","TIUPXAP2",171,0)
 S TIUARRAY(4)=TIUDFN
"RTN","TIUPXAP2",172,0)
 S TIUARRAY("SORT")="P"
"RTN","TIUPXAP2",173,0)
 S TIUARRAY("FLDS")="22"
"RTN","TIUPXAP2",174,0)
 S TIUARRAY("MAX")=1
"RTN","TIUPXAP2",175,0)
 S TIUCNT=$$SDAPI^SDAMA301(.TIUARRAY)
"RTN","TIUPXAP2",176,0)
 I TIUCNT=-1 K ^TMP($J,"SDAMA301") Q +$G(TIUWKLF)
"RTN","TIUPXAP2",177,0)
 S STATUS=+$P($G(^TMP($J,"SDAMA301",TIUDFN,TIUEDT)),U,22)
"RTN","TIUPXAP2",178,0)
 K ^TMP($J,"SDAMA301")
"RTN","TIUPXAP2",179,0)
 ;Check the status of the appointment.  If the appointment can be
"RTN","TIUPXAP2",180,0)
 ;checked-out, workload can be entered.
"RTN","TIUPXAP2",181,0)
 I $D(^SD(409.63,"ACO",1,STATUS)) S TIUWKLF=1
"RTN","TIUPXAP2",182,0)
 ;
"RTN","TIUPXAP2",183,0)
CHKWKLQ Q +$G(TIUWKLF)
"RTN","TIUPXAP2",184,0)
 ;
"RTN","TIUPXAP2",185,0)
CHKAPPT(TIUVSIT,TIUDFN,TIUEDT,TIUHL) ;Check if an appointment is associated with the Visit
"RTN","TIUPXAP2",186,0)
 ; Input  -- TIUVSIT  Visit file (#9000010) IEN
"RTN","TIUPXAP2",187,0)
 ;           TIUDFN   Patient file (#2) IEN
"RTN","TIUPXAP2",188,0)
 ;           TIUEDT   Episode Begin Date/Time
"RTN","TIUPXAP2",189,0)
 ;           TIUHL    Hospital Location file (#44) IEN
"RTN","TIUPXAP2",190,0)
 ; Output -- 0=Appointment is not associated with the Visit
"RTN","TIUPXAP2",191,0)
 ;           1=Appointment is associated with the Visit
"RTN","TIUPXAP2",192,0)
 N TIUAPPTF
"RTN","TIUPXAP2",193,0)
 I $G(TIUVSIT),'$$BROKER^XWBLIB() D
"RTN","TIUPXAP2",194,0)
 . S:$$VST2APPT^PXAPI(TIUVSIT)>0 TIUAPPTF=1
"RTN","TIUPXAP2",195,0)
 ELSE  D
"RTN","TIUPXAP2",196,0)
 . S:$$APPOINT^PXUTL1(TIUDFN,TIUEDT,TIUHL)>0 TIUAPPTF=1
"RTN","TIUPXAP2",197,0)
 Q +$G(TIUAPPTF)
"RTN","TIUVISIT")
0^4^B24528930^B21599632
"RTN","TIUVISIT",1,0)
TIUVISIT ; SLC/JER - Visit File look-up ;4/28/99@09:47:44 [1/27/05 12:36pm]
"RTN","TIUVISIT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**39,124,190**;Jun 20, 1997;Build 1
"RTN","TIUVISIT",3,0)
MAIN(TIUY,DFN,TIUSSN,TIUVDT,TIULDT,TIUDFLT,TIUMODE,TIULOC,TIUOCC,LETNEW,FILTER,UNSONLY,TIUFUTUR) ;Control
"RTN","TIUVISIT",4,0)
AGN K ^TMP("TIUVN",$J),^TMP("TIUVD",$J),^TMP("TIUVDA",$J)
"RTN","TIUVISIT",5,0)
 N C,I,N,TIUI,TIUII,TIUVDA,TIUER,TIUOK,TIUX,X,TIUNVIS,TIUVDATE
"RTN","TIUVISIT",6,0)
 S LETNEW=$G(LETNEW,1),UNSONLY=+$G(UNSONLY)
"RTN","TIUVISIT",7,0)
 S:+$G(DFN)'>0 DFN=+$$PATIENT^TIULA($G(TIUSSN)) I +DFN'>0 S TIUOUT=1 Q
"RTN","TIUVISIT",8,0)
 S TIUMODE=$G(TIUMODE,1),TIUOCC=$G(TIUOCC,20)
"RTN","TIUVISIT",9,0)
 S TIULOC=$S(+$G(TIULOC):TIULOC,$G(TIULOC)]"":+$O(^SC("B",TIULOC,0)),1:"")
"RTN","TIUVISIT",10,0)
 I +$G(TIUVDT) S TIUVDATE=(9999999-$P(TIUVDT,"."))_"."_$P(TIUVDT,".",2)
"RTN","TIUVISIT",11,0)
 S TIULDT=$S(+$G(TIULDT)>0:(9999999-$P(TIULDT,"."))_$S($L(TIULDT,".")>1:"."_$P(TIULDT,".",2),1:""),+$G(TIUVDT):(9999999-$P(TIUVDT,"."))_"."_$P($$FMADD^XLFDT(TIUVDT,"","","",-1),".",2),1:0)
"RTN","TIUVISIT",12,0)
 I '+$G(TIUVDT) S TIUVDT=$S(+$G(TIULDT):(9999999-$P(+$G(TIUVDT),"."))_"."_$P($$FMADD^XLFDT(+$G(TIUVDT),"",23,59,59),".",2),+$G(TIUVDT)>0:(9999999-$P(TIUVDT,"."))_"."_$P($$FMADD^XLFDT(TIUVDT,"","","",1),".",2),1:9999999) I 1
"RTN","TIUVISIT",13,0)
 E  S TIUVDT=$G(TIUVDATE)
"RTN","TIUVISIT",14,0)
 I '$D(^AUPNVSIT("AA",DFN)) W !,"No UNSCHEDULED VISITS on file",! Q
"RTN","TIUVISIT",15,0)
 S I=TIULDT F  S I=$O(^AUPNVSIT("AA",DFN,I)) Q:+I'>0!(+I>TIUVDT)  D
"RTN","TIUVISIT",16,0)
 . N N S N=0
"RTN","TIUVISIT",17,0)
 . F  S N=$O(^AUPNVSIT("AA",DFN,I,N)) Q:+N'>0  D
"RTN","TIUVISIT",18,0)
 . . N D
"RTN","TIUVISIT",19,0)
 . . S:$G(FILTER)'["XD" FILTER=$G(FILTER)_"XD"
"RTN","TIUVISIT",20,0)
 . . Q:'$D(^AUPNVSIT(+N,0))!(FILTER[$P($G(^AUPNVSIT(+N,0)),U,7))
"RTN","TIUVISIT",21,0)
 . . ; If unscheduled visits only, then omit scheduled visits
"RTN","TIUVISIT",22,0)
 . . I +UNSONLY,$$CHKAPPT^TIUPXAP2(N) Q
"RTN","TIUVISIT",23,0)
 . . S D=^AUPNVSIT(+N,0)
"RTN","TIUVISIT",24,0)
 . . I +$G(TIULOC)>0,($P(D,U,22)'=TIULOC) Q
"RTN","TIUVISIT",25,0)
 . . S ^TMP("TIUVD",$J,(9999999-+D))=N_U_D
"RTN","TIUVISIT",26,0)
 S (C,I)=0 F  S I=$O(^TMP("TIUVD",$J,I)) Q:+I'>0  D
"RTN","TIUVISIT",27,0)
 . S C=C+1,^TMP("TIUVN",$J,C)=$G(^TMP("TIUVD",$J,I))
"RTN","TIUVISIT",28,0)
 . S ^TMP("TIUVDA",$J,+$G(^TMP("TIUVD",$J,I)))=C
"RTN","TIUVISIT",29,0)
 I '+TIUMODE,'$D(^TMP("TIUVN",$J)) Q
"RTN","TIUVISIT",30,0)
 I '$D(^TMP("TIUVN",$J)) Q
"RTN","TIUVISIT",31,0)
 I '+TIUMODE,$G(TIUDFLT)="LAST" D  Q:'+TIUX  G VADPT
"RTN","TIUVISIT",32,0)
 . N TIUI S TIUI=+$O(^TMP("TIUVN",$J,0))
"RTN","TIUVISIT",33,0)
 . S TIUX=$G(^TMP("TIUVN",$J,+TIUI))
"RTN","TIUVISIT",34,0)
 S (TIUER,TIUOK,TIUI)=0
"RTN","TIUVISIT",35,0)
 W !!,"The following",$S(FILTER["H":" UNSCHEDULED",1:"")," VISITS are available:",!
"RTN","TIUVISIT",36,0)
 F  S TIUI=$O(^TMP("TIUVN",$J,TIUI)) Q:+TIUI'>0  D  Q:+TIUER!+TIUOK!+$G(TIUOUT)
"RTN","TIUVISIT",37,0)
 . N TIUVR
"RTN","TIUVISIT",38,0)
 . S TIUII=TIUI,TIUVR=$P(^TMP("TIUVN",$J,TIUI),"^",2,20),TIUVDA=+^(TIUI)
"RTN","TIUVISIT",39,0)
 . D WRITE
"RTN","TIUVISIT",40,0)
 . I '(TIUI#5) D BREAK I +$G(TIUX),($L($G(TIUX),";")=3) D VADPT^TIUVSIT S TIUOUT=1 Q
"RTN","TIUVISIT",41,0)
 . I $G(X)["?" S X="",TIUI=TIUI-5
"RTN","TIUVISIT",42,0)
 G:$D(TIUOUT) CLEAN
"RTN","TIUVISIT",43,0)
 G AGN:TIUER
"RTN","TIUVISIT",44,0)
 I +$G(TIUII)#5 D BREAK I +$G(TIUX),($L($G(TIUX),";")=3) D VADPT^TIUVSIT G CLEAN
"RTN","TIUVISIT",45,0)
 I +$G(TIUOUT) G CLEAN
"RTN","TIUVISIT",46,0)
 I +TIUER!($G(X)["?") G AGN
"RTN","TIUVISIT",47,0)
 I +TIUOK,'+$G(TIUNVIS) D
"RTN","TIUVISIT",48,0)
 . S TIUX=$G(^TMP("TIUVN",$J,+TIUOK)),^DISV(DUZ,"^AUPNVSIT(")=+TIUX
"RTN","TIUVISIT",49,0)
 . W "  ",$$DATE^TIULS(+$P(TIUX,U,2),"AMTH DD CCYY@HR:MIN")
"RTN","TIUVISIT",50,0)
VADPT ; Call PATVADPT^TIULV to fill TIUY array
"RTN","TIUVISIT",51,0)
 N TIUVSTR
"RTN","TIUVISIT",52,0)
 S TIUVSTR=$P(TIUX,U,23)_";"_$P(TIUX,U,2)_";"_$P(TIUX,U,8)
"RTN","TIUVISIT",53,0)
 D PATVADPT^TIULV(.TIUY,DFN,"",TIUVSTR)
"RTN","TIUVISIT",54,0)
CLEAN K ^TMP("TIUVN",$J),^TMP("TIUVD",$J),^TMP("TIUVDA",$J)
"RTN","TIUVISIT",55,0)
 Q
"RTN","TIUVISIT",56,0)
BREAK ; Handle prompting
"RTN","TIUVISIT",57,0)
 N TIUARR,TIUAPT
"RTN","TIUVISIT",58,0)
 I TIUII=1 S (TIUOK,X)=1
"RTN","TIUVISIT",59,0)
 W !,"CHOOSE 1-",TIUII," or"
"RTN","TIUVISIT",60,0)
 S TIUARR("FLDS")="1;",TIUARR(4)=DFN,TIUARR("MAX")=1
"RTN","TIUVISIT",61,0)
 S TIUAPT=$$SDAPI^SDAMA301(.TIUARR)
"RTN","TIUVISIT",62,0)
 I TIUAPT=-1 D  Q
"RTN","TIUVISIT",63,0)
 . W !,"An error occurred while accessing the appointments database"
"RTN","TIUVISIT",64,0)
 . W !,"    Please contact IRM!",!
"RTN","TIUVISIT",65,0)
 . S (TIUER,TIUOUT)=1
"RTN","TIUVISIT",66,0)
 . N X,X1,X2,TIUERR
"RTN","TIUVISIT",67,0)
 . S X1=DT,X2=90 D C^%DTC
"RTN","TIUVISIT",68,0)
 . S ^XTMP("TIUSDAMA",0)=X_"^"_DT_"^"
"RTN","TIUVISIT",69,0)
 . S TIUERR=$O(^TMP($J,"SDAMA301",""))
"RTN","TIUVISIT",70,0)
 . S:TIUERR ^XTMP("TIUSDAMA",$$NOW^XLFDT,TIUERR)=$G(^TMP($J,"SDAMA301",TIUERR))
"RTN","TIUVISIT",71,0)
 . K ^TMP($J,"SDAMA301")
"RTN","TIUVISIT",72,0)
 K ^TMP($J,"SDAMA301")
"RTN","TIUVISIT",73,0)
 W:TIUAPT !,"<F>UTURE VISITS, or" W:+LETNEW " <N>EW VISIT"
"RTN","TIUVISIT",74,0)
 W:$D(^TMP("TIUVN",$J,TIUII+1)) !,"<RETURN> TO CONTINUE",!,"OR '^' TO QUIT"
"RTN","TIUVISIT",75,0)
 W ": " W:$D(TIUPICK) $P(^TMP("TIUVN",$J,TIUPICK),U),"// " R X:DTIME
"RTN","TIUVISIT",76,0)
 S X=$$UP^XLFSTR(X)
"RTN","TIUVISIT",77,0)
 I $S('$T:1,X["^":1,1:0) S (TIUER,TIUOUT)=1 Q
"RTN","TIUVISIT",78,0)
 S:X=""&$D(TIUPICK) X=TIUPICK
"RTN","TIUVISIT",79,0)
 I X["?" D HELP(X) Q
"RTN","TIUVISIT",80,0)
 I $E(X)="F" S (TIUFUTUR,TIUOUT)=1 Q
"RTN","TIUVISIT",81,0)
 I +LETNEW'>0,(X=""),'$D(^TMP("TIUVN",$J,TIUII+1)) S (TIUER,TIUOUT)=1 Q
"RTN","TIUVISIT",82,0)
 I +LETNEW,$S(X="N":1,X="NEW":1,X=""&'$D(^TMP("TIUVN",$J,TIUII+1)):1,1:0) D ADD^TIUVSIT(DFN,.TIUX,$S(X="N":0,X="NEW":0,1:1),.TIUSDC) S TIUVTRY=1 I +$G(TIUX)'>0 S (TIUER,TIUOUT)=1 Q
"RTN","TIUVISIT",83,0)
 I $S(X="":1,X="N":1,X="NEW":1,1:0) Q
"RTN","TIUVISIT",84,0)
 I X'=+X!'$D(^TMP("TIUVN",$J,+X)) W !!,$C(7),"INVALID RESPONSE",! G BREAK
"RTN","TIUVISIT",85,0)
 S TIUOK=X
"RTN","TIUVISIT",86,0)
 Q
"RTN","TIUVISIT",87,0)
HELP(X) ; Offer help
"RTN","TIUVISIT",88,0)
 W !!?3,"Indicate the visit with which the document is associated by choosing"
"RTN","TIUVISIT",89,0)
 W !?3,"the corresponding number.  To add a new visit (e.g., for unscheduled or"
"RTN","TIUVISIT",90,0)
 W !?3,"telephone contacts), enter ""N"".",!!
"RTN","TIUVISIT",91,0)
 Q
"RTN","TIUVISIT",92,0)
WRITE ; Writes each list element
"RTN","TIUVISIT",93,0)
 N DIC,DIQ,DA,DR,TIUVISIT,I,J,X,Y
"RTN","TIUVISIT",94,0)
 S DIC="^AUPNVSIT(",DIQ="TIUVISIT(",DIQ(0)="IE",DA=+TIUVDA
"RTN","TIUVISIT",95,0)
 S DR=".07;.08;.16;.21;.22" D EN^DIQ1
"RTN","TIUVISIT",96,0)
 W !,$J(TIUI,4),">  ",$$DATE^TIULS(+TIUVR,"AMTH DD, CCYY@HR:MIN")
"RTN","TIUVISIT",97,0)
 W ?27,$E($G(TIUVISIT(9000010,DA,.07,"E")),1,18)
"RTN","TIUVISIT",98,0)
 W ?47,$E($S(TIUVISIT(9000010,DA,.22,"E")]"":TIUVISIT(9000010,DA,.22,"E"),1:TIUVISIT(9000010,DA,.08,"E")),1,18)
"RTN","TIUVISIT",99,0)
 ;W ?67,$E($G(TIUVISIT(9000010,DA,.22,"E")),1,12) I $G(TIUVISIT(9000010,DA,.21,"E"))]"" W !?23,TIUVISIT(9000010,DA,.21,"E")
"RTN","TIUVISIT",100,0)
 Q
"RTN","TIUVSIT")
0^2^B64134241^B62393589
"RTN","TIUVSIT",1,0)
TIUVSIT ; SLC/JER - Interactive Visit look-up; 28-OCT-2003 [1/27/05 12:35pm]
"RTN","TIUVSIT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**39,91,107,117,179,190**;Jun 20, 1997;Build 1
"RTN","TIUVSIT",3,0)
ENPN(TIUY,DFN,ALLOWNEW) ; Entry point for Progress Notes
"RTN","TIUVSIT",4,0)
 N DIRUT,DUOUT,DTOUT,TIULOC,TIUINOUT
"RTN","TIUVSIT",5,0)
 I +$G(DFN)'>0 Q
"RTN","TIUVSIT",6,0)
 I +$D(^DPT(DFN,.1)) D MAIN^TIUMOVE(.TIUY,DFN,"","","","1","CURRENT",0) Q
"RTN","TIUVSIT",7,0)
 S TIUINOUT=$$INOUT
"RTN","TIUVSIT",8,0)
 I $D(DIRUT) Q
"RTN","TIUVSIT",9,0)
 I $P(TIUINOUT,U)="o" D MAIN(.TIUY,DFN,"","","","",1,"","",$G(ALLOWNEW)) Q
"RTN","TIUVSIT",10,0)
 D MAIN^TIUMOVE(.TIUY,DFN,"","","",1,"LAST",1)
"RTN","TIUVSIT",11,0)
 Q
"RTN","TIUVSIT",12,0)
MAIN(TIUY,DFN,TIUSSN,TIUVDT,TIULDT,TIUDFLT,TIUMODE,TIULOC,TIUOCC,LETNEW) ;Control
"RTN","TIUVSIT",13,0)
 N TIUFUTUR
"RTN","TIUVSIT",14,0)
AGN K ^TMP("TIUVN",$J),^TMP("TIUVDT",$J),^TMP("TIUVNI",$J),^TMP("TIUNOT",$J),^TMP($J,"SDAMA301")
"RTN","TIUVSIT",15,0)
 N C,I,N,TIUI,TIUII,TIUDA,TIUER,TIUOK,TIUX,TIUOUT,X,TIUNVIS,VASD,VAERR
"RTN","TIUVSIT",16,0)
 N TIUPICK,TIULAST,TIUSDC,TIUVTRY,TIUAPPTS,TIUARR
"RTN","TIUVSIT",17,0)
 S TIUMODE=$G(TIUMODE,1),LETNEW=$G(LETNEW,1)
"RTN","TIUVSIT",18,0)
 S:+$G(DFN)'>0 DFN=+$$PATIENT^TIULA($G(TIUSSN)) I +DFN'>0 S TIUOUT=1 Q
"RTN","TIUVSIT",19,0)
 S TIUOCC=$G(TIUOCC,20)
"RTN","TIUVSIT",20,0)
 S TIUARR("FLDS")="1;2"
"RTN","TIUVSIT",21,0)
 S TIUARR(1)=2000000,TIUARR(4)=DFN,TIUARR("MAX")=1
"RTN","TIUVSIT",22,0)
 S TIUAPPTS=$$SDAPI^SDAMA301(.TIUARR)
"RTN","TIUVSIT",23,0)
 K ^TMP($J,"SDAMA301")
"RTN","TIUVSIT",24,0)
 I TIUAPPTS=-1 D  Q
"RTN","TIUVSIT",25,0)
 . W !!,"Could not retrieve patient information due to a problem with the database.",!,"Please contact IRM"
"RTN","TIUVSIT",26,0)
 I '$G(TIUAPPTS),(+TIUMODE'>0) Q
"RTN","TIUVSIT",27,0)
 ; No appointments
"RTN","TIUVSIT",28,0)
 I '$G(TIUAPPTS),(+TIUMODE>0) D  I +$G(TIUX)'>0 Q
"RTN","TIUVSIT",29,0)
 . W !!,"No SCHEDULED APPOINTMENTS on file"
"RTN","TIUVSIT",30,0)
 . D MAIN^TIUVISIT(.TIUY,DFN,$G(TIUSSN),$G(TIUVDT),$G(TIULDT),$G(TIUDFLT),$G(TIUMODE),$G(TIULOC),$G(TIUOCC),$G(LETNEW),"H",1,.TIUFUTUR)
"RTN","TIUVSIT",31,0)
 . I +$G(TIUOUT) Q
"RTN","TIUVSIT",32,0)
 . I '$D(TIUY),+LETNEW,'+$G(TIUVTRY) D ADD(DFN,.TIUX,1,.TIUSDC)
"RTN","TIUVSIT",33,0)
 I '$G(TIUAPPTS),(+TIUX>0) G VADPT
"RTN","TIUVSIT",34,0)
 I '$D(^TMP("TIUVN",$J)) D GETAPPT^TIUVSIT1(DFN,$G(TIULOC),$G(TIUOCC),$G(TIULDT),"",.TIULAST,$G(TIUVDT),+$G(TIUFUTUR)) S TIUFUTUR=0
"RTN","TIUVSIT",35,0)
 ; error in visit lookup
"RTN","TIUVSIT",36,0)
 I +TIUMODE,$D(^TMP("TIUVERR",$J)) D  Q
"RTN","TIUVSIT",37,0)
 . W !!,$G(^TMP("TIUVERR",$J)),!
"RTN","TIUVSIT",38,0)
 . I $D(^TMP("TIUVERR",$J,115)) W ^TMP("TIUVERR",$J,115),!
"RTN","TIUVSIT",39,0)
 . K ^TMP("TIUVERR",$J)
"RTN","TIUVSIT",40,0)
 ; no appointments scheduled w/in selection range
"RTN","TIUVSIT",41,0)
 I +TIUMODE,'$D(^TMP("TIUVN",$J)),+LETNEW D  G:+$G(TIUFUTUR) AGN Q:+$G(TIUX)'>0  G VADPT
"RTN","TIUVSIT",42,0)
 . N WHATNOW
"RTN","TIUVSIT",43,0)
 . W !!,"No SCHEDULED APPOINTMENTS found through "
"RTN","TIUVSIT",44,0)
 . W $$DATE^TIULS($$FMADD^XLFDT(DT,1),"AMTH DD, CCYY"),"...",!
"RTN","TIUVSIT",45,0)
 . S WHATNOW=$$UP^XLFSTR($E($$NOTFOUND^TIUVSIT1))
"RTN","TIUVSIT",46,0)
 . Q:$S(+$G(DUOUT):1,+$G(DTOUT):1,+$G(DIROUT):1,1:0)
"RTN","TIUVSIT",47,0)
 . I $E(WHATNOW)="U" D  Q
"RTN","TIUVSIT",48,0)
 . . D MAIN^TIUVISIT(.TIUY,DFN,$G(TIUSSN),$G(TIUVDT),$G(TIULDT),$G(TIUDFLT),$G(TIUMODE),$G(TIULOC),$G(TIUOCC),$G(LETNEW),"H",1,.TIUFUTUR) Q:+$G(TIUFUTUR)
"RTN","TIUVSIT",49,0)
 . . I '$D(TIUY),+LETNEW,'+$G(TIUVTRY) D ADD(DFN,.TIUX,1,.TIUSDC)
"RTN","TIUVSIT",50,0)
 . I $E(WHATNOW)="F" S TIUFUTUR=1 Q  ; FUTURE
"RTN","TIUVSIT",51,0)
 . D ADD(DFN,.TIUX,$S($E(WHATNOW)="N":"",1:1),.TIUSDC)
"RTN","TIUVSIT",52,0)
 I '+TIUMODE,'$D(^TMP("TIUVNI",$J)) Q
"RTN","TIUVSIT",53,0)
 I '+TIUMODE,$G(TIUDFLT)="LAST" D  Q:+$G(TIUX)'>0  G VADPT
"RTN","TIUVSIT",54,0)
 . N TIUI S TIUI=+$O(^TMP("TIUVNI",$J,0))
"RTN","TIUVSIT",55,0)
 . S TIUX=$$GETVSIT(TIUI)
"RTN","TIUVSIT",56,0)
 I +TIUMODE,($G(TIUDFLT)="LAST"),(+$O(^TMP("TIUVNI",$J,0))>0) S TIUPICK=+$O(^TMP("TIUVNI",$J,0))
"RTN","TIUVSIT",57,0)
 S (TIUER,TIUOK,TIUI)=0
"RTN","TIUVSIT",58,0)
 W !!,"The following SCHEDULED VISITS are available:",!
"RTN","TIUVSIT",59,0)
 F  S TIUI=$O(^TMP("TIUVN",$J,TIUI)) Q:+TIUI'>0  D  Q:+TIUER!+TIUOK!+$G(TIUX)!+$G(TIUOUT)
"RTN","TIUVSIT",60,0)
 . S TIUII=TIUI D WRITE
"RTN","TIUVSIT",61,0)
 . I '(TIUI#5) D BREAK I $S($G(X)="U":1,$G(X)["UNS":1,1:0) D  Q
"RTN","TIUVSIT",62,0)
 . . D MAIN^TIUVISIT(.TIUY,DFN,$G(TIUSSN),$G(TIUVDT),$G(TIULDT),$G(TIUDFLT),$G(TIUMODE),$G(TIULOC),$G(TIUOCC),$G(LETNEW),"H",1,.TIUFUTUR)
"RTN","TIUVSIT",63,0)
 . . S TIUOUT=1
"RTN","TIUVSIT",64,0)
 . I $G(X)["?" S X="",TIUI=TIUI-5
"RTN","TIUVSIT",65,0)
 . I $G(X)["F" S X=""
"RTN","TIUVSIT",66,0)
 I +$G(TIUFUTUR),$S(+TIUOK:1,+TIUER:1,$D(TIUY)>9:1,+$G(TIUX):1,1:0) S TIUFUTUR=0
"RTN","TIUVSIT",67,0)
 I +$G(TIUFUTUR) S TIUOUT=0 G AGN
"RTN","TIUVSIT",68,0)
 G:$D(TIUOUT) CLEAN
"RTN","TIUVSIT",69,0)
 G AGN:+TIUER
"RTN","TIUVSIT",70,0)
 I +$G(TIUII)#5,+TIUMODE D BREAK I $S($G(X)="U":1,$G(X)["UNS":1,1:0) D  G:+$G(TIUFUTUR) AGN Q
"RTN","TIUVSIT",71,0)
 . D MAIN^TIUVISIT(.TIUY,DFN,$G(TIUSSN),$G(TIUVDT),$G(TIULDT),$G(TIUDFLT),$G(TIUMODE),$G(TIULOC),$G(TIUOCC),$G(LETNEW),"H",1,.TIUFUTUR)
"RTN","TIUVSIT",72,0)
 G:$D(TIUOUT) CLEAN
"RTN","TIUVSIT",73,0)
 I $S(+TIUER:1,$G(X)["?":1,$G(X)["F":1,1:0) G AGN
"RTN","TIUVSIT",74,0)
 I +TIUOK,'+$G(TIUNVIS) D
"RTN","TIUVSIT",75,0)
 . S TIUX=$$GETVSIT(+TIUOK)
"RTN","TIUVSIT",76,0)
 . W "  ",$$DATE^TIULS(+$P(TIUX,";",2),"AMTH DD CCYY@HR:MIN")
"RTN","TIUVSIT",77,0)
VADPT D PATVADPT^TIULV(.TIUY,DFN,"",$G(TIUX),$G(TIUSDC))
"RTN","TIUVSIT",78,0)
CLEAN K ^TMP("TIUVN",$J),^TMP("TIUVDT",$J),^TMP("TIUVNI",$J),^TMP("TIUNOT",$J)
"RTN","TIUVSIT",79,0)
 Q
"RTN","TIUVSIT",80,0)
BREAK ; Handle prompting
"RTN","TIUVSIT",81,0)
 I TIUII=1 S (TIUOK,X)=1
"RTN","TIUVSIT",82,0)
 W !,"CHOOSE 1-",TIUII,", or",!
"RTN","TIUVSIT",83,0)
 W:'(TIUII#20) "<M>ORE VISITS, " W "<U>NSCHEDULED VISITS, "
"RTN","TIUVSIT",84,0)
 I +$P(TIUPRM0,U,14) W:'+LETNEW " or " W "<F>UTURE VISITS, "
"RTN","TIUVSIT",85,0)
 W:+LETNEW "or <N>EW VISIT"
"RTN","TIUVSIT",86,0)
 W:$D(^TMP("TIUVN",$J,TIUII+1)) !,"<RETURN> TO CONTINUE",!,"OR '^' TO QUIT"
"RTN","TIUVSIT",87,0)
 W ": " W:$D(TIUPICK) $P(^TMP("TIUVN",$J,TIUPICK),U),"// " R X:DTIME
"RTN","TIUVSIT",88,0)
 S X=$$UP^XLFSTR(X)
"RTN","TIUVSIT",89,0)
 I $S('$T:1,X["^":1,1:0) S (TIUER,TIUOUT)=1 Q
"RTN","TIUVSIT",90,0)
 S:X=""&$D(TIUPICK) X=TIUPICK
"RTN","TIUVSIT",91,0)
 I X["?" D HELP^TIUVSITH(X) Q
"RTN","TIUVSIT",92,0)
 I $S(X="M":1,X="MORE":1,1:0) D MORE Q
"RTN","TIUVSIT",93,0)
 I $S(X="F":1,X["FUT":1,1:0) D FUTURE Q
"RTN","TIUVSIT",94,0)
 I $S(X="U":1,X["UNS":1,1:0) Q
"RTN","TIUVSIT",95,0)
 I +LETNEW'>0,(X=""),'$D(^TMP("TIUVN",$J,TIUII+1)) S (TIUER,TIUOUT)=1 Q
"RTN","TIUVSIT",96,0)
 I +LETNEW,$S(X="N":1,X="NEW":1,X=""&'$D(^TMP("TIUVN",$J,TIUII+1)):1,1:0) D ADD(DFN,.TIUX,$S(X="N":0,X="NEW":0,1:1),.TIUSDC) I +$G(TIUX)'>0 S (TIUER,TIUOUT)=1 Q
"RTN","TIUVSIT",97,0)
 I $S(X="":1,X="N":1,X="NEW":1,1:0) Q
"RTN","TIUVSIT",98,0)
 I X'=+X!'$D(^TMP("TIUVN",$J,+X)) W !!,$C(7),"INVALID RESPONSE",! G BREAK
"RTN","TIUVSIT",99,0)
 S TIUOK=X
"RTN","TIUVSIT",100,0)
 Q
"RTN","TIUVSIT",101,0)
INOUT() ; Ask INPATIENT/OUTPATIENT
"RTN","TIUVSIT",102,0)
 N TIUPRMT S TIUPRMT="Is this note for INPATIENT or OUTPATIENT care? "
"RTN","TIUVSIT",103,0)
 W:'$D(^DPT(DFN,.1)) !!,"This patient is not currently admitted to the facility...",!
"RTN","TIUVSIT",104,0)
 Q $$READ^TIUU("SA^i:INPATIENT;o:OUTPATIENT",TIUPRMT,"OUTPATIENT")
"RTN","TIUVSIT",105,0)
MORE ; Modify date range, list more visits
"RTN","TIUVSIT",106,0)
 N TIUI,TIUCNT
"RTN","TIUVSIT",107,0)
 S TIUI=+$O(^TMP("TIUVDT",$J,0)),TIUCNT=+$G(^TMP("TIUVDT",$J,+TIUI))
"RTN","TIUVSIT",108,0)
 D GETAPPT^TIUVSIT1(DFN,$G(TIULOC),$G(TIUOCC),TIUI,TIUCNT,.TIULAST)
"RTN","TIUVSIT",109,0)
 Q
"RTN","TIUVSIT",110,0)
FUTURE ; Get future appointments
"RTN","TIUVSIT",111,0)
 D GETAPPT^TIUVSIT1(DFN,$G(TIULOC),$G(TIUOCC),$G(TIULDT),"",.TIULAST,$G(TIUVDT),1)
"RTN","TIUVSIT",112,0)
 I $D(^TMP("TIUVERR",$J)) D
"RTN","TIUVSIT",113,0)
 . W !!,$G(^TMP("TIUVERR",$J)),!
"RTN","TIUVSIT",114,0)
 . I $D(^TMP("TIUVERR",$J,115)) W ^TMP("TIUVERR",$J,115),!
"RTN","TIUVSIT",115,0)
 I $P(+$G(^TMP("TIUVNI",$J,1)),".")'>+$$NOW^XLFDT D
"RTN","TIUVSIT",116,0)
 . W !!,"No Future Appointments found...",!
"RTN","TIUVSIT",117,0)
 E  I $P(+$G(^TMP("TIUVNI",$J,1)),".")'>$$FMADD^XLFDT(DT,1) D
"RTN","TIUVSIT",118,0)
 . W !!,"No Appointments found more than one day in future..."
"RTN","TIUVSIT",119,0)
 S TIUI=0,TIUFUTUR=1
"RTN","TIUVSIT",120,0)
 Q
"RTN","TIUVSIT",121,0)
GETVSIT(TIUOK) ; Get associated visit
"RTN","TIUVSIT",122,0)
 N APPT,TIUVSIT,VLOC,VSTOP,VDT,VTYPE
"RTN","TIUVSIT",123,0)
 S APPT=$G(^TMP("TIUVNI",$J,+TIUOK))
"RTN","TIUVSIT",124,0)
 S VDT=+APPT,VLOC=$P(APPT,U,2)
"RTN","TIUVSIT",125,0)
 S VSTOP=$P($G(^SC(+VLOC,0)),U,7)
"RTN","TIUVSIT",126,0)
 S VTYPE=$S($P(APPT,U,3)="I":"I",1:"A")
"RTN","TIUVSIT",127,0)
 S TIUVSIT=VLOC_";"_VDT_";"_VTYPE
"RTN","TIUVSIT",128,0)
 Q TIUVSIT
"RTN","TIUVSIT",129,0)
ADD(DFN,VSTR,ASK,VSTOP) ; Add a visit for patient
"RTN","TIUVSIT",130,0)
 N VTYPE,VDT,VLOC,TIUY,DA,DIE,DR,TIUAPDT,X,Y W !
"RTN","TIUVSIT",131,0)
 S ASK=$G(ASK,1)
"RTN","TIUVSIT",132,0)
 I +ASK D
"RTN","TIUVSIT",133,0)
 . W !,$C(7),$C(7),"Patient & Visit are Required...",!
"RTN","TIUVSIT",134,0)
 . S TIUY=$$READ^TIUU("YAO","Do you wish to add a NEW Visit? ","NO")
"RTN","TIUVSIT",135,0)
 I +ASK,(+TIUY'>0) S TIUX=0,TIUER=1 Q
"RTN","TIUVSIT",136,0)
 I $G(VLOC)']"" S VLOC=$$SELLOC
"RTN","TIUVSIT",137,0)
 I +VLOC'>0 S TIUER=1 Q
"RTN","TIUVSIT",138,0)
 S VSTOP=+$P(^SC(+VLOC,0),U,7)
"RTN","TIUVSIT",139,0)
 S VDT=+$$READ^TIUU("D^:NOW:ERSX","Enter Visit Date/Time","NOW","Precise Date & Time are Required")
"RTN","TIUVSIT",140,0)
 I +VDT'>0 S TIUER=1 Q
"RTN","TIUVSIT",141,0)
 S TIUAPDT=+$O(^TMP("TIUNOT",$J,+VLOC,+$P(VDT,".")))
"RTN","TIUVSIT",142,0)
 I +TIUAPDT>0,(+$P(TIUAPDT,".")=+$P(VDT,".")) D  Q
"RTN","TIUVSIT",143,0)
 . W !!,$C(7),"  Item #",+$G(^TMP("TIUNOT",$J,+VLOC,+TIUAPDT))
"RTN","TIUVSIT",144,0)
 . W " is scheduled for ",$$DATE^TIULS(TIUAPDT,"MM/DD/YY HR:MIN")
"RTN","TIUVSIT",145,0)
 . W " at this location..."
"RTN","TIUVSIT",146,0)
 . W !!,"Please select the existing appointment, rather than creating a "
"RTN","TIUVSIT",147,0)
 . W "redundant one.",!
"RTN","TIUVSIT",148,0)
 . S TIUER=1
"RTN","TIUVSIT",149,0)
 S VTYPE=$$VSITYPE(VSTOP)
"RTN","TIUVSIT",150,0)
 S VSTR=+VLOC_";"_+VDT_";"_VTYPE
"RTN","TIUVSIT",151,0)
 I +VSTR'>0 S TIUER=1 Q
"RTN","TIUVSIT",152,0)
 S TIUNVIS=+VDT,TIUER=0
"RTN","TIUVSIT",153,0)
 Q
"RTN","TIUVSIT",154,0)
WRITE ; Writes each list element
"RTN","TIUVSIT",155,0)
 N TIUX S TIUX=^TMP("TIUVN",$J,TIUI)
"RTN","TIUVSIT",156,0)
 W !,$J(TIUII,4),">  ",$P(TIUX,U),?27,$E($P(TIUX,U,3),1,21),?50,$P(TIUX,U,2)
"RTN","TIUVSIT",157,0)
 Q
"RTN","TIUVSIT",158,0)
SELLOC() ; Select Hospital Location
"RTN","TIUVSIT",159,0)
 N DIC,X,Y,TIUAPDT S DIC=44,DIC(0)="AEMQ"
"RTN","TIUVSIT",160,0)
 S DIC("A")="PATIENT LOCATION: "
"RTN","TIUVSIT",161,0)
 S DIC("B")=$P($$PERSLOC^TIULE(DUZ),U,2)
"RTN","TIUVSIT",162,0)
 S:DIC("B")']"" DIC("B")=$P($G(^SC(+$G(^DISV(DUZ,"^SC(")),0)),U)
"RTN","TIUVSIT",163,0)
 S DIC("S")="I $$GOODLOC^TIUPREF(Y)"
"RTN","TIUVSIT",164,0)
 D ^DIC K DIC("S")
"RTN","TIUVSIT",165,0)
 Q Y
"RTN","TIUVSIT",166,0)
DEFER(DA,TIUSDC) ; Mark record for deferred crediting of stop code
"RTN","TIUVSIT",167,0)
 N DIE,DR,X,Y,TIUVSIT
"RTN","TIUVSIT",168,0)
 I +$G(TIUSDC)'>0 Q
"RTN","TIUVSIT",169,0)
 S DIE=8925
"RTN","TIUVSIT",170,0)
 S:$$WORKOK^TIUPXAP1(+DA) DR=".11////1;"
"RTN","TIUVSIT",171,0)
 S DR=$G(DR)_"1206////^S X="_+TIUSDC
"RTN","TIUVSIT",172,0)
 D ^DIE
"RTN","TIUVSIT",173,0)
 ;If not called via the broker try to link document to an existing visit
"RTN","TIUVSIT",174,0)
 I '$$BROKER^XWBLIB,$$LNKVST^TIUPXAP3(+DA,.TIUVSIT)
"RTN","TIUVSIT",175,0)
 Q
"RTN","TIUVSIT",176,0)
CREDIT(TIUDA) ; Call EN3^SDACS to Credit Stop Code
"RTN","TIUVSIT",177,0)
 N DA,DFN,VSIT,TIU,TIUD0,TIUDPRM
"RTN","TIUVSIT",178,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0))
"RTN","TIUVSIT",179,0)
 I TIUD0']"" Q
"RTN","TIUVSIT",180,0)
 D DOCPRM^TIULC1(+TIUD0,.TIUDPRM)
"RTN","TIUVSIT",181,0)
 ; If SUPPRESS DX/CPT ON NEW VISIT is set to YES, then Quit
"RTN","TIUVSIT",182,0)
 I +$P($G(TIUDPRM(0)),U,14)>0 Q
"RTN","TIUVSIT",183,0)
 S DFN=+$P(TIUD0,U,2),VSIT=$P(TIUD0,U,3)
"RTN","TIUVSIT",184,0)
 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUVSIT",185,0)
 D CREDIT^TIUPXAPI(DFN,.TIU,VSIT)
"RTN","TIUVSIT",186,0)
 Q
"RTN","TIUVSIT",187,0)
REMFLAG(DA) ; Remove credit flag from TIU Document Record
"RTN","TIUVSIT",188,0)
 N DIE,DR,X,Y
"RTN","TIUVSIT",189,0)
 S DIE=8925,DR=".11///@" D ^DIE
"RTN","TIUVSIT",190,0)
 Q
"RTN","TIUVSIT",191,0)
VSITYPE(VSTOP) ; Call reader to get VISIT TYPE
"RTN","TIUVSIT",192,0)
 N DFLT,PROMPT,X,Y S VSTOP=$P($G(^DIC(40.7,+$G(VSTOP),0)),U)
"RTN","TIUVSIT",193,0)
 S DFLT=$S(VSTOP["TELE":"TELEPHONE",1:"AMBULATORY")
"RTN","TIUVSIT",194,0)
 S PROMPT="TYPE OF VISIT: "
"RTN","TIUVSIT",195,0)
 S X="SMA^a:AMBULATORY (WALK-IN);t:TELEPHONE;i:IN HOSPITAL;e:EVENT (HISTORICAL)"
"RTN","TIUVSIT",196,0)
 S Y=$$READ^TIUU(X,PROMPT,DFLT) W "   ",$P(Y,U,2),!
"RTN","TIUVSIT",197,0)
 S Y=$$UP^XLFSTR($P(Y,U))
"RTN","TIUVSIT",198,0)
 Q Y
"RTN","TIUVSIT",199,0)
GETAPPT(DFN,CLINIC,OCCLIM,INDEX,COUNT,LAST,EARLY,FUTURE) ; Get list
"RTN","TIUVSIT",200,0)
 D GETAPPT^TIUVSIT1($G(DFN),$G(CLINIC),$G(OCCLIM),$G(INDEX),$G(COUNT),$G(LAST),$G(EARLY),$G(FUTURE))
"RTN","TIUVSIT",201,0)
 Q
"RTN","TIUVSIT1")
0^3^B10242353^B10115199
"RTN","TIUVSIT1",1,0)
TIUVSIT1 ; SLC/JER - Visit look-up (cont'd) ;4/29/99@11:51:42 [1/18/05 9:22am]
"RTN","TIUVSIT1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**39,179,190**;Jun 20, 1997;Build 1
"RTN","TIUVSIT1",3,0)
NOTFOUND() ; Ask <U>NSCHEDULED or <F>UTURE
"RTN","TIUVSIT1",4,0)
 N TIUY
"RTN","TIUVSIT1",5,0)
 W !,"CHOOSE <U>NSCHEDULED VISITS, <F>UTURE VISITS, or <N>EW VISIT"
"RTN","TIUVSIT1",6,0)
 W !,"<RETURN> TO CONTINUE"
"RTN","TIUVSIT1",7,0)
 S TIUY=$$READ^TIUU("FOA","OR '^' TO QUIT: ","","^D HELP^TIUVSITH(""?"")")
"RTN","TIUVSIT1",8,0)
 Q TIUY
"RTN","TIUVSIT1",9,0)
GETAPPT(DFN,CLINIC,OCCLIM,INDEX,COUNT,LAST,EARLY,FUTURE) ; Get list
"RTN","TIUVSIT1",10,0)
 ; of appointments
"RTN","TIUVSIT1",11,0)
 N TIUCNT,TIUI,TIUSREC,TIUJ,TIUFLIM,TIUARRAY,LATE,TIUK,TIUNUM
"RTN","TIUVSIT1",12,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUVSIT1",13,0)
 S TIUFLIM=$S(+$P(TIUPRM0,U,14)>0&+$G(FUTURE):$P(TIUPRM0,U,14),1:1)
"RTN","TIUVSIT1",14,0)
 S OCCLIM=$S(+$G(OCCLIM):+$G(OCCLIM),1:20)
"RTN","TIUVSIT1",15,0)
 S:'+$G(DT) DT=$$DT^XLFDT
"RTN","TIUVSIT1",16,0)
 S EARLY=+$G(EARLY)
"RTN","TIUVSIT1",17,0)
 S LATE=$S(+$G(INDEX):+$G(INDEX),1:$$FMADD^XLFDT(DT,TIUFLIM)_"."_235959)
"RTN","TIUVSIT1",18,0)
 S (LAST,TIUCNT,TIUK)=0,TIUJ=$S(+$G(COUNT):+$G(COUNT),1:0)
"RTN","TIUVSIT1",19,0)
 S TIUARRAY(1)=EARLY_";"_LATE
"RTN","TIUVSIT1",20,0)
 I $G(EARLY)=0 S TIUARRAY(1)=";"_LATE
"RTN","TIUVSIT1",21,0)
 S TIUARRAY(4)=DFN
"RTN","TIUVSIT1",22,0)
 S TIUARRAY("SORT")="P"
"RTN","TIUVSIT1",23,0)
 S TIUARRAY("FLDS")="1;2;3;10;12;22"
"RTN","TIUVSIT1",24,0)
 S TIUNUM=$$SDAPI^SDAMA301(.TIUARRAY) Q:'TIUNUM
"RTN","TIUVSIT1",25,0)
 S TIUI=LATE+.000001
"RTN","TIUVSIT1",26,0)
 I TIUNUM=-1 D  Q
"RTN","TIUVSIT1",27,0)
 . S ^TMP("TIUVERR",$J)="Could not retrieve patient information due to a problem with the database."
"RTN","TIUVSIT1",28,0)
 . I $D(^TMP($J,"SDAMA301",115)) S ^TMP("TIUVERR",$J,115)="This patient may not have an assigned ICN."
"RTN","TIUVSIT1",29,0)
 F  S TIUI=$O(^TMP($J,"SDAMA301",DFN,TIUI),-1) S:+TIUI'>0 LAST=1 Q:+TIUI'>0!(+TIUCNT'<OCCLIM)!(+TIUI<EARLY)  D
"RTN","TIUVSIT1",30,0)
 . N APPTDT,APPTCL,APPTST,APPTTY,OPENC,STATUS
"RTN","TIUVSIT1",31,0)
 . S TIUCNT=+$G(TIUCNT)+1,TIUJ=+$G(TIUJ)+1
"RTN","TIUVSIT1",32,0)
 . S APPTCL=$P(^TMP($J,"SDAMA301",DFN,TIUI),U,2)
"RTN","TIUVSIT1",33,0)
 . S APPTST=$P(^TMP($J,"SDAMA301",DFN,TIUI),U,3)
"RTN","TIUVSIT1",34,0)
 . S APPTTY=$P(^TMP($J,"SDAMA301",DFN,TIUI),U,10)
"RTN","TIUVSIT1",35,0)
 . S OPENC=$P(^TMP($J,"SDAMA301",DFN,TIUI),U,12)
"RTN","TIUVSIT1",36,0)
 . S STATUS=$P(^TMP($J,"SDAMA301",DFN,TIUI),U,22)
"RTN","TIUVSIT1",37,0)
 . I +$G(CLINIC),(+APPTCL'=+CLINIC) Q
"RTN","TIUVSIT1",38,0)
 . ;Set up internal value array
"RTN","TIUVSIT1",39,0)
 . S ^TMP("TIUVNI",$J,TIUJ)=TIUI_U_+APPTCL
"RTN","TIUVSIT1",40,0)
 . I $P(APPTST,";")="R" S ^TMP("TIUVNI",$J,TIUJ)=^TMP("TIUVNI",$J,TIUJ)_U
"RTN","TIUVSIT1",41,0)
 . I $P(APPTST,";")'="R" S ^TMP("TIUVNI",$J,TIUJ)=^TMP("TIUVNI",$J,TIUJ)_U_$P(APPTST,";")
"RTN","TIUVSIT1",42,0)
 . S ^TMP("TIUVNI",$J,TIUJ)=^TMP("TIUVNI",$J,TIUJ)_U_+APPTTY
"RTN","TIUVSIT1",43,0)
 . S ^TMP("TIUVNI",$J,TIUJ)=^TMP("TIUVNI",$J,TIUJ)_U_$G(OPENC)
"RTN","TIUVSIT1",44,0)
 . ;Set up external value array
"RTN","TIUVSIT1",45,0)
 . S ^TMP("TIUVN",$J,TIUJ)=$$DATE^TIULS(TIUI,"AMTH DD, CCYY@HR:MIN")
"RTN","TIUVSIT1",46,0)
 . S ^TMP("TIUVN",$J,TIUJ)=^TMP("TIUVN",$J,TIUJ)_U_$P(APPTCL,";",2)
"RTN","TIUVSIT1",47,0)
 . S ^TMP("TIUVN",$J,TIUJ)=^TMP("TIUVN",$J,TIUJ)_U_$P(STATUS,";",3)
"RTN","TIUVSIT1",48,0)
 . S ^TMP("TIUVN",$J,TIUJ)=^TMP("TIUVN",$J,TIUJ)_U_$P(APPTTY,";",2)
"RTN","TIUVSIT1",49,0)
 . ;Set up index by date
"RTN","TIUVSIT1",50,0)
 . S ^TMP("TIUVDT",$J,TIUI)=TIUJ
"RTN","TIUVSIT1",51,0)
 . ;Set up array of appts to exclude dup visit creation if appt is for today
"RTN","TIUVSIT1",52,0)
 . I $P(APPTST,";")="R" S ^TMP("TIUNOT",$J,+$P($G(^TMP($J,"SDAMA301",DFN,TIUI)),U,2),+TIUI)=TIUJ
"RTN","TIUVSIT1",53,0)
 K ^TMP($J,"SDAMA301")
"RTN","TIUVSIT1",54,0)
 Q
"VER")
8.0^22.0
"BLD",5482,6)
^208
**END**
**END**
