Released XM*7.1*41 SEQ #40
Extracted from mail message
**KIDS**:XM*7.1*41^

**INSTALL NAME**
XM*7.1*41
"BLD",25,0)
XM*7.1*41^MAILMAN^0^2970307^n
"BLD",25,1,0)
^^48^48^2970307^^^^
"BLD",25,1,1,0)
MailMan patch XM*7.1*41 contains the following bug fixes and enhancements:
"BLD",25,1,2,0)

"BLD",25,1,3,0)
NOIS:       IND-0297-42072
"BLD",25,1,4,0)
Rtn:        ^XMGAPI2
"BLD",25,1,5,0)
Test Site:  Indianapolis,IN
"BLD",25,1,6,0)
Returns info for broadcast message now, instead of returning error stating that
"BLD",25,1,7,0)
user is not sender or recipient.  Returns message type correctly now. 
"BLD",25,1,8,0)

"BLD",25,1,9,0)
Note correct definition for the following variable:
"BLD",25,1,10,0)
       L("SENDER")     - sender's name
"BLD",25,1,11,0)

"BLD",25,1,12,0)
Returns 4 new variables:
"BLD",25,1,13,0)
       L("SENDER DUZ") - sender's DUZ (null if remote)
"BLD",25,1,14,0)
       L("BSKT IEN")   - basket IEN
"BLD",25,1,15,0)
       L("DATE FM")    - date sent, in FileMan format (null if uncertain)
"BLD",25,1,16,0)
       L("BROADCAST")  - 1 if message was broadcast; 0 otherwise
"BLD",25,1,17,0)

"BLD",25,1,18,0)
Please correct/include in documentation in 'MailMan V.7.1 Programmer Reference
"BLD",25,1,19,0)
Manual' pages 14-16.
"BLD",25,1,20,0)

"BLD",25,1,21,0)
===========================================================================
"BLD",25,1,22,0)
This patch may be installed with users on the system.
"BLD",25,1,23,0)
===========================================================================
"BLD",25,1,24,0)
 
"BLD",25,1,25,0)
INSTALLATION:
"BLD",25,1,26,0)
1.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.  This loads
"BLD",25,1,27,0)
    the patch into a Transport Global on your system.
"BLD",25,1,28,0)
2.  On the KIDS:Installation menu, use the following options to install the
"BLD",25,1,29,0)
    Transport Global:
"BLD",25,1,30,0)
       Verify Checksums in Transport Global
"BLD",25,1,31,0)
       Print Transport Global
"BLD",25,1,32,0)
       Compare Transport Global to Current System
"BLD",25,1,33,0)
       Backup a Transport Global
"BLD",25,1,34,0)
       Install Package(s)
"BLD",25,1,35,0)
3.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",25,1,36,0)
    other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",25,1,37,0)
============================================================================ 
"BLD",25,1,38,0)
  
"BLD",25,1,39,0)
ROUTINES:
"BLD",25,1,40,0)
The second line of the routine now looks like:
"BLD",25,1,41,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"BLD",25,1,42,0)
 
"BLD",25,1,43,0)
              Before          After
"BLD",25,1,44,0)
Name          Checksum        Checksum        Patch List
"BLD",25,1,45,0)
----------------------------------------------------------
"BLD",25,1,46,0)
XMGAPI2        2120231         3885152        41
"BLD",25,1,47,0)

"BLD",25,1,48,0)
============================================================================
"BLD",25,4,0)
^9.64PA^^0
"BLD",25,"INI")

"BLD",25,"INIT")

"BLD",25,"KRN",0)
^9.67PA^19^12
"BLD",25,"KRN",.4,0)
.4
"BLD",25,"KRN",.401,0)
.401
"BLD",25,"KRN",.402,0)
.402
"BLD",25,"KRN",.403,0)
.403
"BLD",25,"KRN",.5,0)
.5
"BLD",25,"KRN",.84,0)
.84
"BLD",25,"KRN",3.6,0)
3.6
"BLD",25,"KRN",3.8,0)
3.8
"BLD",25,"KRN",9.2,0)
9.2
"BLD",25,"KRN",9.8,0)
9.8
"BLD",25,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",25,"KRN",9.8,"NM",1,0)
XMGAPI2^^0^B11014443
"BLD",25,"KRN",9.8,"NM","B","XMGAPI2",1)

"BLD",25,"KRN",19,0)
19
"BLD",25,"KRN",19,"NM",0)
^9.68A^^
"BLD",25,"KRN",19.1,0)
19.1
"BLD",25,"KRN","B",.4,.4)

"BLD",25,"KRN","B",.401,.401)

"BLD",25,"KRN","B",.402,.402)

"BLD",25,"KRN","B",.403,.403)

"BLD",25,"KRN","B",.5,.5)

"BLD",25,"KRN","B",.84,.84)

"BLD",25,"KRN","B",3.6,3.6)

"BLD",25,"KRN","B",3.8,3.8)

"BLD",25,"KRN","B",9.2,9.2)

"BLD",25,"KRN","B",9.8,9.8)

"BLD",25,"KRN","B",19,19)

"BLD",25,"KRN","B",19.1,19.1)

"BLD",25,"QUES",0)
^9.62^^
"BLD",25,"REQB",0)
^9.611^^
"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
41^2970307
"PKG",6,22,1,"PAH",1,1,0)
^^48^48^2970307
"PKG",6,22,1,"PAH",1,1,1,0)
MailMan patch XM*7.1*41 contains the following bug fixes and enhancements:
"PKG",6,22,1,"PAH",1,1,2,0)

"PKG",6,22,1,"PAH",1,1,3,0)
NOIS:       IND-0297-42072
"PKG",6,22,1,"PAH",1,1,4,0)
Rtn:        ^XMGAPI2
"PKG",6,22,1,"PAH",1,1,5,0)
Test Site:  Indianapolis,IN
"PKG",6,22,1,"PAH",1,1,6,0)
Returns info for broadcast message now, instead of returning error stating that
"PKG",6,22,1,"PAH",1,1,7,0)
user is not sender or recipient.  Returns message type correctly now. 
"PKG",6,22,1,"PAH",1,1,8,0)

"PKG",6,22,1,"PAH",1,1,9,0)
Note correct definition for the following variable:
"PKG",6,22,1,"PAH",1,1,10,0)
       L("SENDER")     - sender's name
"PKG",6,22,1,"PAH",1,1,11,0)

"PKG",6,22,1,"PAH",1,1,12,0)
Returns 4 new variables:
"PKG",6,22,1,"PAH",1,1,13,0)
       L("SENDER DUZ") - sender's DUZ (null if remote)
"PKG",6,22,1,"PAH",1,1,14,0)
       L("BSKT IEN")   - basket IEN
"PKG",6,22,1,"PAH",1,1,15,0)
       L("DATE FM")    - date sent, in FileMan format (null if uncertain)
"PKG",6,22,1,"PAH",1,1,16,0)
       L("BROADCAST")  - 1 if message was broadcast; 0 otherwise
"PKG",6,22,1,"PAH",1,1,17,0)

"PKG",6,22,1,"PAH",1,1,18,0)
Please correct/include in documentation in 'MailMan V.7.1 Programmer Reference
"PKG",6,22,1,"PAH",1,1,19,0)
Manual' pages 14-16.
"PKG",6,22,1,"PAH",1,1,20,0)

"PKG",6,22,1,"PAH",1,1,21,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,22,0)
This patch may be installed with users on the system.
"PKG",6,22,1,"PAH",1,1,23,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,24,0)
 
"PKG",6,22,1,"PAH",1,1,25,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,26,0)
1.  On the PackMan menu, use the 'INSTALL/CHECK MESSAGE' option.  This loads
"PKG",6,22,1,"PAH",1,1,27,0)
    the patch into a Transport Global on your system.
"PKG",6,22,1,"PAH",1,1,28,0)
2.  On the KIDS:Installation menu, use the following options to install the
"PKG",6,22,1,"PAH",1,1,29,0)
    Transport Global:
"PKG",6,22,1,"PAH",1,1,30,0)
       Verify Checksums in Transport Global
"PKG",6,22,1,"PAH",1,1,31,0)
       Print Transport Global
"PKG",6,22,1,"PAH",1,1,32,0)
       Compare Transport Global to Current System
"PKG",6,22,1,"PAH",1,1,33,0)
       Backup a Transport Global
"PKG",6,22,1,"PAH",1,1,34,0)
       Install Package(s)
"PKG",6,22,1,"PAH",1,1,35,0)
3.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",6,22,1,"PAH",1,1,36,0)
    other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",6,22,1,"PAH",1,1,37,0)
============================================================================ 
"PKG",6,22,1,"PAH",1,1,38,0)
  
"PKG",6,22,1,"PAH",1,1,39,0)
ROUTINES:
"PKG",6,22,1,"PAH",1,1,40,0)
The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,41,0)
       ;;7.1;MailMan;**[patch list]**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,42,0)
 
"PKG",6,22,1,"PAH",1,1,43,0)
              Before          After
"PKG",6,22,1,"PAH",1,1,44,0)
Name          Checksum        Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,45,0)
----------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,46,0)
XMGAPI2        2120231         3885152        41
"PKG",6,22,1,"PAH",1,1,47,0)

"PKG",6,22,1,"PAH",1,1,48,0)
============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XMGAPI2")
0^1^B11014443
"RTN","XMGAPI2",1,0)
XMGAPI2 ;(WASH ISC)/JKL-HEADER INFO FOR A MESSAGE ;03/07/97  06:46
"RTN","XMGAPI2",2,0)
 ;;7.1;MailMan;**41**;Jun 02, 1994
"RTN","XMGAPI2",3,0)
 ;USAGE:  S X=$$HDR^XMGAPI2(A,.B,C)
"RTN","XMGAPI2",4,0)
 ;WHERE: A=message or response #
"RTN","XMGAPI2",5,0)
 ;      .B=array into which data is placed
"RTN","XMGAPI2",6,0)
 ;       C=flag that determines what data is returned as follows:
"RTN","XMGAPI2",7,0)
 ;Not defined or 0 = returns a function value of 0 if successful, an
"RTN","XMGAPI2",8,0)
 ;   error message if unsuccessful, and a value array:
"RTN","XMGAPI2",9,0)
 ;   L("BROADCAST")= 1 if the message was broadcast; 0 otherwise
"RTN","XMGAPI2",10,0)
 ;   L("BSKT") = basket (of local user)
"RTN","XMGAPI2",11,0)
 ;   L("BSKT IEN") = basket IEN (of local user)
"RTN","XMGAPI2",12,0)
 ;   L("DATE") = origination date
"RTN","XMGAPI2",13,0)
 ;   L("DATE FM") = origination date in FileMan format
"RTN","XMGAPI2",14,0)
 ;   L("LINES") = number of lines in the original message
"RTN","XMGAPI2",15,0)
 ;   L("NEW") = 1 if the message is new; 0 otherwise
"RTN","XMGAPI2",16,0)
 ;   L("PXMZ") = pointer to the original message
"RTN","XMGAPI2",17,0)
 ;   L("SENDER") = sender name
"RTN","XMGAPI2",18,0)
 ;   L("SENDER DUZ") = sender DUZ
"RTN","XMGAPI2",19,0)
 ;   L("SUBJ") = subject
"RTN","XMGAPI2",20,0)
 ;   L("SURROG") = surrogate (DUZ if local user or string if not)
"RTN","XMGAPI2",21,0)
 ;   L("TYPE") = message type(s)
"RTN","XMGAPI2",22,0)
 ;   L("XMZ") = message or response number
"RTN","XMGAPI2",23,0)
 ;1 = returns function value and value array above, also
"RTN","XMGAPI2",24,0)
 ;    additional value array as follows:
"RTN","XMGAPI2",25,0)
 ;   L("RRED") = responses read
"RTN","XMGAPI2",26,0)
 ;   L("RRCV") = responses received
"RTN","XMGAPI2",27,0)
 ;   L("BLOBCNT") = number of non-textual body parts attached
"RTN","XMGAPI2",28,0)
 ;91= returns function value, value array as with flag 1,
"RTN","XMGAPI2",29,0)
 ;    and an array of response nodes and values as follows:
"RTN","XMGAPI2",30,0)
 ;   L(counter)= (pointer to 3.9 file) / array of responses
"RTN","XMGAPI2",31,0)
 ;92= returns function value, value array as with flag 1,
"RTN","XMGAPI2",32,0)
 ;    and an array of non-textual body parts as follows:
"RTN","XMGAPI2",33,0)
 ;   L(counter) = (pointer to 2005 file) array of BLOBS
"RTN","XMGAPI2",34,0)
 ;93= returns function value, value array as with flag 1,
"RTN","XMGAPI2",35,0)
 ;    response node array, and an array of non-textual body parts.
"RTN","XMGAPI2",36,0)
HDR(XMZ,L,F) ;Entry for non-MailMan (documented)
"RTN","XMGAPI2",37,0)
GO N %,%0,D,XMBCAST
"RTN","XMGAPI2",38,0)
 S %=$G(XMZ) I +%'=%!(%<1) S %="1-Undefined message number" G ERR
"RTN","XMGAPI2",39,0)
 I XMZ="" S %="1-No message number" G ERR
"RTN","XMGAPI2",40,0)
 S %0=$G(^XMB(3.9,XMZ,0)) I %0="" S %="1-No such message" G ERR
"RTN","XMGAPI2",41,0)
 S D=$S($G(XMDUZ):XMDUZ,1:DUZ)
"RTN","XMGAPI2",42,0)
 I $S(+D'=D:1,D'>0:1,'$D(^XMB(3.7,D,0)):1,1:0) S %="4-Invalid user" G ERR
"RTN","XMGAPI2",43,0)
 S %=$P(%0,U,8),%=$S(%:%,1:XMZ)
"RTN","XMGAPI2",44,0)
 S XMBCAST=$S($D(^XMB(3.9,%,1,"C","* (Broadcast to all local users)")):1,$D(^XMB(3.9,%,1,"C","* (Broadcast to all local user")):1,1:0)
"RTN","XMGAPI2",45,0)
 I $S($P(%0,U,2)=D:0,$D(^XMB(3.9,%,1,"C",D)):0,XMBCAST:0,1:1) S %="2-User is not a sender or recipient." G ERR
"RTN","XMGAPI2",46,0)
 I $G(F)=""!'$G(F) S F=0   ;Default FLAG
"RTN","XMGAPI2",47,0)
 N %1,%2,XMK
"RTN","XMGAPI2",48,0)
 S %1=$$NET^XMRENT(XMZ)    ;get message information
"RTN","XMGAPI2",49,0)
 I %1="" S %="4-Message not defined" G ERR
"RTN","XMGAPI2",50,0)
 S L("BROADCAST")=XMBCAST
"RTN","XMGAPI2",51,0)
 S L("XMZ")=XMZ            ;set message number into array
"RTN","XMGAPI2",52,0)
 S L("DATE")=$P(%1,U)      ;get origination date
"RTN","XMGAPI2",53,0)
 S %2=$P(%0,U,3)
"RTN","XMGAPI2",54,0)
 S L("DATE FM")=$S(%2?7N1".".N:%2,%2?7N:%2,1:$$CONVERT^XMA32A(%2))
"RTN","XMGAPI2",55,0)
 S:L("DATE FM")<2000000 L("DATE FM")=""
"RTN","XMGAPI2",56,0)
 S L("SENDER")=$P(%1,U,3)  ;get sender
"RTN","XMGAPI2",57,0)
 S L("SENDER DUZ")=$S($P(%0,U,2):$P(%0,U,2),1:"")
"RTN","XMGAPI2",58,0)
 S L("PXMZ")=$P(%1,U,7)    ;get pointer to original message
"RTN","XMGAPI2",59,0)
 S L("TYPE")=$P(%1,U,8)    ;Message Type(s)
"RTN","XMGAPI2",60,0)
 ;get number of message lines
"RTN","XMGAPI2",61,0)
 S L("LINES")=$S($D(^XMB(3.9,XMZ,2,0)):$P(^(0),U,4),1:"")
"RTN","XMGAPI2",62,0)
 S L("SUBJ")=$P(%1,U,6)    ;get subject
"RTN","XMGAPI2",63,0)
 S L("SURROG")=$P(%1,U,5)  ;get surrogate
"RTN","XMGAPI2",64,0)
 S XMK=$O(^XMB(3.7,"M",XMZ,D,0))  ;get basket
"RTN","XMGAPI2",65,0)
 I XMK,$D(^XMB(3.7,D,2,XMK,0)) D
"RTN","XMGAPI2",66,0)
 . S L("BSKT")=$P(^(0),U)
"RTN","XMGAPI2",67,0)
 . S L("BSKT IEN")=XMK
"RTN","XMGAPI2",68,0)
 E  D
"RTN","XMGAPI2",69,0)
 . S L("BSKT")=""
"RTN","XMGAPI2",70,0)
 . S L("BSKT IEN")=""
"RTN","XMGAPI2",71,0)
 I $G(XMK) S L("NEW")=$S($D(^XMB(3.7,D,"N0",XMK,XMZ)):1,1:0)
"RTN","XMGAPI2",72,0)
 G Q:F=0
"RTN","XMGAPI2",73,0)
 ;get responses read/received
"RTN","XMGAPI2",74,0)
 S L("RRED")="",L("RRCV")="",%1=$O(^XMB(3.9,XMZ,1,"C",D,0))
"RTN","XMGAPI2",75,0)
 I %1 S L("RRED")=$P(^XMB(3.9,XMZ,1,%1,0),U,2)
"RTN","XMGAPI2",76,0)
 I $D(^XMB(3.9,XMZ,3,0)) S L("RRCV")=$P(^(0),U,4)
"RTN","XMGAPI2",77,0)
 S L("BLOBCNT")=0          ;get blob count
"RTN","XMGAPI2",78,0)
 I $D(^XMB(3.9,XMZ,2005,0)) S L("BLOBCNT")=$P(^(0),U,3)
"RTN","XMGAPI2",79,0)
 G Q:F=1,BLOB:F=92
"RTN","XMGAPI2",80,0)
 ;flag=91 - get response numbers and values
"RTN","XMGAPI2",81,0)
 S %1=0 F  S %1=$O(^XMB(3.9,XMZ,3,%1)) Q:'%1  S L("RSP",%1)=^(%1,0)
"RTN","XMGAPI2",82,0)
 I F=91 G Q
"RTN","XMGAPI2",83,0)
 ;flag=92 - get nodes and values of non-textual body parts
"RTN","XMGAPI2",84,0)
BLOB S %1=0 F  S %1=$O(^XMB(3.9,XMZ,2005,%1)) Q:'%1  S L("BLOB",%1)=^(%1,0)
"RTN","XMGAPI2",85,0)
Q Q 0
"RTN","XMGAPI2",86,0)
ERR Q %
"RTN","XMGAPI2",87,0)
XMENT(XMZ,L,F) ;MailMan Internal Use Entry Point
"RTN","XMGAPI2",88,0)
 N G S G=1 G GO
"VER")
8.0^21.0
**END**
**END**
