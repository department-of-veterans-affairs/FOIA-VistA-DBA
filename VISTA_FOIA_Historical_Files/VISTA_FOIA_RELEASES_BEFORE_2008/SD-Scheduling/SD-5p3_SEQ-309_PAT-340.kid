Released SD*5.3*340 SEQ #309
Extracted from mail message
**KIDS**:SD*5.3*340^

**INSTALL NAME**
SD*5.3*340
"BLD",5333,0)
SD*5.3*340^SCHEDULING^0^3040721^y
"BLD",5333,1,0)
^^1^1^3040720^
"BLD",5333,1,1,0)
BAD ADDRESS INDICATOR NEEDS TO STOP PRINTING SCHEDULING LETTERS.
"BLD",5333,4,0)
^9.64PA^^
"BLD",5333,"ABPKG")
n
"BLD",5333,"KRN",0)
^9.67PA^8989.52^19
"BLD",5333,"KRN",.4,0)
.4
"BLD",5333,"KRN",.401,0)
.401
"BLD",5333,"KRN",.402,0)
.402
"BLD",5333,"KRN",.403,0)
.403
"BLD",5333,"KRN",.5,0)
.5
"BLD",5333,"KRN",.84,0)
.84
"BLD",5333,"KRN",3.6,0)
3.6
"BLD",5333,"KRN",3.8,0)
3.8
"BLD",5333,"KRN",9.2,0)
9.2
"BLD",5333,"KRN",9.8,0)
9.8
"BLD",5333,"KRN",9.8,"NM",0)
^9.68A^6^5
"BLD",5333,"KRN",9.8,"NM",1,0)
SDCNL^^0^B20351777
"BLD",5333,"KRN",9.8,"NM",3,0)
SDN1^^0^B19827145
"BLD",5333,"KRN",9.8,"NM",4,0)
SDL1^^0^B12888093
"BLD",5333,"KRN",9.8,"NM",5,0)
SDC3^^0^B6243114
"BLD",5333,"KRN",9.8,"NM",6,0)
SDCNP1A^^0^B27916769
"BLD",5333,"KRN",9.8,"NM","B","SDC3",5)

"BLD",5333,"KRN",9.8,"NM","B","SDCNL",1)

"BLD",5333,"KRN",9.8,"NM","B","SDCNP1A",6)

"BLD",5333,"KRN",9.8,"NM","B","SDL1",4)

"BLD",5333,"KRN",9.8,"NM","B","SDN1",3)

"BLD",5333,"KRN",19,0)
19
"BLD",5333,"KRN",19,"NM",0)
^9.68A^^
"BLD",5333,"KRN",19.1,0)
19.1
"BLD",5333,"KRN",101,0)
101
"BLD",5333,"KRN",409.61,0)
409.61
"BLD",5333,"KRN",771,0)
771
"BLD",5333,"KRN",870,0)
870
"BLD",5333,"KRN",8989.51,0)
8989.51
"BLD",5333,"KRN",8989.52,0)
8989.52
"BLD",5333,"KRN",8994,0)
8994
"BLD",5333,"KRN","B",.4,.4)

"BLD",5333,"KRN","B",.401,.401)

"BLD",5333,"KRN","B",.402,.402)

"BLD",5333,"KRN","B",.403,.403)

"BLD",5333,"KRN","B",.5,.5)

"BLD",5333,"KRN","B",.84,.84)

"BLD",5333,"KRN","B",3.6,3.6)

"BLD",5333,"KRN","B",3.8,3.8)

"BLD",5333,"KRN","B",9.2,9.2)

"BLD",5333,"KRN","B",9.8,9.8)

"BLD",5333,"KRN","B",19,19)

"BLD",5333,"KRN","B",19.1,19.1)

"BLD",5333,"KRN","B",101,101)

"BLD",5333,"KRN","B",409.61,409.61)

"BLD",5333,"KRN","B",771,771)

"BLD",5333,"KRN","B",870,870)

"BLD",5333,"KRN","B",8989.51,8989.51)

"BLD",5333,"KRN","B",8989.52,8989.52)

"BLD",5333,"KRN","B",8994,8994)

"BLD",5333,"QUES",0)
^9.62^^
"BLD",5333,"REQB",0)
^9.611^2^2
"BLD",5333,"REQB",1,0)
SD*5.3*330^1
"BLD",5333,"REQB",2,0)
SD*5.3*167^1
"BLD",5333,"REQB","B","SD*5.3*167",2)

"BLD",5333,"REQB","B","SD*5.3*330",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
340^3040721
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3040721
"PKG",16,22,1,"PAH",1,1,1,0)
BAD ADDRESS INDICATOR NEEDS TO STOP PRINTING SCHEDULING LETTERS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","SDC3")
0^5^B6243114
"RTN","SDC3",1,0)
SDC3 ;ALB/LDB - CANCELLATION LETTERS; 23-DEC-88@12:30
"RTN","SDC3",2,0)
 ;;5.3;Scheduling;**330,340**;Aug 13, 1993
"RTN","SDC3",3,0)
EN N SDBAD F L1=0:0 S L1=$O(^SC(+SC,"S",SD,1,L1)) Q:L1'>0  S A=+^(L1,0) D CHECK,SET:$D(SDOK)
"RTN","SDC3",4,0)
 Q
"RTN","SDC3",5,0)
CHECK K SDOK I $S('$D(^DPT(+A,.35)):1,$P(^DPT(+A,.35),"^",1)']"":1,1:0),$D(^DPT(+A,"S",SD)),$P(^DPT(+A,"S",SD,0),"^",2)="C"!($P(^(0),"^",2)="CA") S SDOK=1
"RTN","SDC3",6,0)
 S SDBAD=$$BADADR^DGUTL3(+A) I SDBAD K SDOK
"RTN","SDC3",7,0)
 Q
"RTN","SDC3",8,0)
SET S ^UTILITY("SDLT",$J,+SDLET,+A,SD,+SC)="" I $P(^DPT(+A,"S",SD,0),"^",2)="CA"&($P(^(0),"^",10)]"") S SD8=$P(^(0),"^",10) I $D(^DPT(+A,"S",SD8,0)),$P(^(0),"^",2)'["C" S ^UTILITY("SDLT",$J,+SDLET,"A",+A,SD8,+SC)=""
"RTN","SDC3",9,0)
 Q
"RTN","SDC3",10,0)
PR F SD1=0:0 S SD1=$O(^UTILITY("SDLT",$J,SD1)) Q:SD1=""  S SDLET=SD1 D PR0
"RTN","SDC3",11,0)
 Q
"RTN","SDC3",12,0)
PR0 S S81=0 F SD8=0:0 D:SD8'=S81 PR1 S S81=SD8,SD8=$O(^UTILITY("SDLT",$J,SD1,SD8)) Q:SD8'>0  S A=SD8 D B Q:SDBAD  D ^SDLT F S82=0:0 S S82=$O(^UTILITY("SDLT",$J,SD1,SD8,S82)) Q:S82'>0  S SDC=$O(^(S82,-1)),SDX=S82,S=^DPT(+A,"S",S82,0) D WRAPP^SDLT
"RTN","SDC3",13,0)
 K SD8,S81,S82
"RTN","SDC3",14,0)
 Q
"RTN","SDC3",15,0)
PR1 I $D(^UTILITY("SDLT",$J,SD1,"A",SD8)),A=SD8 W !!,"The cancelled appointments have been rescheduled as follows:",! D PR2
"RTN","SDC3",16,0)
 D REST^SDLT Q
"RTN","SDC3",17,0)
PR2 F SD82=0:0 S SD82=$O(^UTILITY("SDLT",$J,SD1,"A",SD8,SD82)),SDX=SD82 Q:SD82'>0  S SC=$O(^(SD82,-1)),S=^DPT(+A,"S",SD82,0) D WRAPP^SDLT
"RTN","SDC3",18,0)
 K SD82
"RTN","SDC3",19,0)
 Q
"RTN","SDC3",20,0)
 ;CHECK FOR BAD ADDRESS
"RTN","SDC3",21,0)
B S SDBAD=$$BADADR^DGUTL3(A)
"RTN","SDC3",22,0)
 Q
"RTN","SDCNL")
0^1^B20351777
"RTN","SDCNL",1,0)
SDCNL ;ALB/LDB - CANCELLED APPOINTMENT LETTER ; 25 MAR 88@13:00
"RTN","SDCNL",2,0)
 ;;5.3;Scheduling;**330,340**;Aug 13, 1993
"RTN","SDCNL",3,0)
 N SDBAD S (SDOK,SDV)=0 I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) S SDV=1
"RTN","SDCNL",4,0)
 G:"Cc"[S1 ASDCN
"RTN","SDCNL",5,0)
PT S (SDPT,SDINP)=0 F B=0:0 S SDPT=$O(VAUTN(SDPT)) Q:SDPT=""  S SDBAD=$$BADADR^DGUTL3(SDPT) Q:SDBAD  W:$D(^DPT(SDPT,.1)) !,$P(^DPT(SDPT,0),"^")," ",$P(^(0),"^",9)," is currently an inpatient!" S:$D(^DPT(SDPT,.1)) SDINP=1 D:'SDINP START S SDINP=0
"RTN","SDCNL",6,0)
 D:$O(^UTILITY($J,0)) PR Q
"RTN","SDCNL",7,0)
START F SDX=SDBD:0 S SDX=$O(^DPT(SDPT,"S",SDX)) Q:SDX>(SDED+.9999)!(SDX'>0)  S SDAP=^DPT(SDPT,"S",SDX,0),SDV2=0 I $P(SDAP,"^",2)["C" D MDIV I SDV2!'SDV S SDC=+SDAP D CHK1 I 'SDOK D CHK
"RTN","SDCNL",8,0)
 Q
"RTN","SDCNL",9,0)
PR N SDFIRST S SDFIRST=1
"RTN","SDCNL",10,0)
 S SDLET="" F A0=0:0 S SDLET=$O(^UTILITY($J,SDLET)) Q:'SDLET  S (B0,X7)="" F A1=0:0 S A5=B0,B0=$O(^UTILITY($J,SDLET,B0)) D:B0="" R Q:B0=""  D R:A5&(B0'=A5) S A=B0 D ^SDLT F A2=0:0 S X7=$O(^UTILITY($J,SDLET,B0,X7)) Q:X7=""  D S,WRAPP^SDLT
"RTN","SDCNL",11,0)
 I $D(^UTILITY($J,"NO")) D NO W:$D(DUZ) !!,"Printed by: ",$P(^VA(200,DUZ,0),"^")
"RTN","SDCNL",12,0)
 D END
"RTN","SDCNL",13,0)
 Q
"RTN","SDCNL",14,0)
END D END^SDN1 K ^UTILITY($J),A0,A1,A3,A5,ALL,B0,SDA,SDINP,SDOK,SDS,SDV,SDV21,SDX,SDX1,SDX8,Z0,Z5,ZTSK,SDAP,X7,DIC,DGPGM,DGVAR,SDPT
"RTN","SDCNL",15,0)
 K BEGDATE,DTOUT,DUOUT,ENDDATE,SDBD,SDBD1,SDCP,SDED,SDLET,SDLET1,SDV,SDV2,X8,Y Q
"RTN","SDCNL",16,0)
MDIV S SDAP=^DPT(SDPT,"S",SDX,0),SDV=$P(^SC(+SDAP,0),"^",15) I SDV=SDV1 S SDV2=1 Q
"RTN","SDCNL",17,0)
 Q
"RTN","SDCNL",18,0)
CAN S SDAP=^DPT(SDPT,"S",SDX,0),SDC=+SDAP
"RTN","SDCNL",19,0)
 S SDLET="" I $D(^SC(SDC,"LTR")),'SDLT1 S SDLET=$S('SD9:$P(^("LTR"),"^",4),1:$P(^("LTR"),"^",3))
"RTN","SDCNL",20,0)
 I 'SDLET&'SDLT1 S ^UTILITY($J,"NO",SDPT,SDC,SDX)=""
"RTN","SDCNL",21,0)
 S SDAP=^DPT(SDPT,"S",SDX,0) I SDLET!SDLT1 S ^UTILITY($J,$S(SDLET:SDLET,1:SDLT1),SDPT,SDX)=SDC
"RTN","SDCNL",22,0)
 I (SDLET!SDLT1),$P(SDAP,"^",10),$D(^DPT(SDPT,"S",$P(SDAP,"^",10))),$P(^DPT(SDPT,"S",$P(SDAP,"^",10),0),"^",2)'["C" S ^UTILITY($J,$S(SDLET:SDLET,1:SDLT1),SDPT,SDX)=$P(SDAP,"^")_"^"_$P(SDAP,"^",10)
"RTN","SDCNL",23,0)
 Q
"RTN","SDCNL",24,0)
ASDCN I 'VAUTC S SDC=0 F Z=0:0 S SDC=$O(VAUTC(SDC)) Q:SDC=""  S SDAP=SDC D ASDCN1
"RTN","SDCNL",25,0)
 G:'VAUTC PR
"RTN","SDCNL",26,0)
 I VAUTC S SDC=0 F Z=0:0 S SDC=$O(^SC(SDC)) Q:'SDC  I $P(^SC(SDC,0),"^",3)="C",$S($P(^(0),"^",15)=SDV1:1,'$P(^(0),"^",15):1,1:0),'$D(SDVAUTC(SDC)) S SDAP=SDC D ASDCN1
"RTN","SDCNL",27,0)
 G:VAUTC PR
"RTN","SDCNL",28,0)
ASDCN1 S SDX=SDBD F W=0:0 S SDX=$O(^DPT("ASDCN",SDC,SDX)) Q:(SDX>(SDED+.9))!(SDX="")  S SDPT=0 F T=0:0 S SDPT=$O(^DPT("ASDCN",SDC,SDX,SDPT)) Q:SDPT=""  I $D(^DPT(SDPT,"S",SDX,0)),$P(^(0),"^")=SDC,'$D(^DPT(SDPT,.1)) D CHK1 D:'SDOK CHK
"RTN","SDCNL",29,0)
 Q
"RTN","SDCNL",30,0)
R S SDR=0,SDX8="",SDA=A5
"RTN","SDCNL",31,0)
 F A3=0:0 S SDX8=$O(^UTILITY($J,SDLET,A5,SDX8)) Q:SDX8=""  I ^(SDX8),$P(^(SDX8),"^",2) S SDX=$P(^(SDX8),"^",2),SDC=$P(^(SDX8),"^"),(DFN,A)=A5,SDS=^DPT(DFN,"S",SDX,0) W:'SDR !!,"The rescheduled appointment(s) follow:",! D WRAPP^SDLT S SDR=1
"RTN","SDCNL",32,0)
 D REST^SDLT Q
"RTN","SDCNL",33,0)
S S A=B0,SDX=X7,SDS=^DPT(A,"S",SDX,0),SDC=+^(0) Q
"RTN","SDCNL",34,0)
NO W @IOF S SDPT=""
"RTN","SDCNL",35,0)
 F A3=0:0 S SDPT=$O(^UTILITY($J,"NO",SDPT)) Q:SDPT=""  S SDC="" F A4=0:0 S SDC=$O(^UTILITY($J,"NO",SDPT,SDC)) Q:SDC=""  D NOAP S SDAP="" F A5=0:0 S SDAP=$O(^UTILITY($J,"NO",SDPT,SDC,SDAP)) D:SDAP="" NOAP2 Q:SDAP=""  W ! D NOAP1
"RTN","SDCNL",36,0)
 Q
"RTN","SDCNL",37,0)
NOAP W !!,$P(^DPT(SDPT,0),"^")," ",$P(^(0),"^",9),!,"has the following cancelled appointment(s) in ",$P(^SC(SDC,0),"^")," CLINIC" Q
"RTN","SDCNL",38,0)
NOAP1 S Y=SDAP D DT^DIQ Q
"RTN","SDCNL",39,0)
NOAP2 W !,"but no letter is assigned to the clinic" Q
"RTN","SDCNL",40,0)
 S Y=SDAP D DT^DIQ W ! Q
"RTN","SDCNL",41,0)
 Q
"RTN","SDCNL",42,0)
CHK S DFN=SDPT D DEM^VADPT I VADM(6) D KVAR^VADPT Q
"RTN","SDCNL",43,0)
 S SDBAD=$$BADADR^DGUTL3(SDPT) Q:SDBAD
"RTN","SDCNL",44,0)
 D CAN:$D(^DPT("ASDCN",SDC,SDX,SDPT)),KVAR^VADPT Q
"RTN","SDCNL",45,0)
CHK1 S SDOK=0 I '$D(^SC(+SDAP,"S",SDX)) Q
"RTN","SDCNL",46,0)
 I $D(^SC(+SDAP,"S",SDX)) F P=0:0 S P=$O(^SC(+SDAP,"S",SDX,1,P)) Q:P'>0  I $P(^(P,0),"^")=SDPT S SDOK=1
"RTN","SDCNL",47,0)
 Q
"RTN","SDCNP1A")
0^6^B27916769
"RTN","SDCNP1A",1,0)
SDCNP1A ;ALB/LDB - CANCEL APPT. (continued) ; 14 MAR 88@13:00
"RTN","SDCNP1A",2,0)
 ;;5.3;Scheduling;**167,340**;Aug 13, 1993
"RTN","SDCNP1A",3,0)
LOOP S SDCNT1=0 F SDAP=0:0 S SDAP=$O(^UTILITY($J,"SDCNP2","REBK",DFN,SDAP)) Q:SDAP'>0  S SDP1=^(SDAP),S1=$P(SDP1,"^",2),S9=$P(^SC(S1,0),"^") D SDDT Q:X8="^"  D RBK S MAX=1
"RTN","SDCNP1A",4,0)
 Q
"RTN","SDCNP1A",5,0)
SDDT W !!,"IN ",S9 D:'$D(DT) DT^SDUTL D DT S %DT="AEX",%DT("A")="START REBOOKING FROM WHAT DATE: "_D S %DT(0)=DT D ^%DT K %DT S X8=X Q:$D(DTOUT)!(X="^")  S:X8="" Y=DT G:Y<0 SDDT S SDDT=+Y\1 K X,Y,DIC S X1=SDDT,X2=DT D ^%DTC
"RTN","SDCNP1A",6,0)
 S (M8,MAX)=0,S1=$P(SDP1,"^",2),S2=$P(SDP1,"^"),M1=$S($D(^SC(S1,"SDP")):$P(^("SDP"),"^",4),1:0) D MAX G:M8 SDDT
"RTN","SDCNP1A",7,0)
 I S2>DT S X1=SDDT,X2=1 D C^%DTC S SDDT=X
"RTN","SDCNP1A",8,0)
 Q
"RTN","SDCNP1A",9,0)
MAX I X>M1 S M8=1 W !!,"Exceeds maximum number of days for rebooking in ",S9 S MAX=0
"RTN","SDCNP1A",10,0)
 Q
"RTN","SDCNP1A",11,0)
RBK S GDATE=S2,SC=S1,LEN=$P(SDP1,"^",6),A=DFN_"^"_LEN,(CDATE,DATE)=SDDT D OVR1,SDIN D ^SDAUT1 D:'MAX NRBK D:MAX ^SDAUT2,SDNP K SDIN Q
"RTN","SDCNP1A",12,0)
OVR1 N X S SL=$S($D(^SC(SC,"SL")):^("SL"),1:"") Q:'SL  S X=$P(SL,U,6),SI=$S(X="":4,X<3:4,X:X,1:4),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SDSTRTDT=$S(DT>DATE:DT,1:DATE),STIME=$S($D(^SC(SC,"SDP")):$P(^("SDP"),U,3),1:"0800"),SDSTRTDT=SDSTRTDT+2
"RTN","SDCNP1A",13,0)
 Q
"RTN","SDCNP1A",14,0)
SDIN I $D(^SC(SC,"I")) S SDIN=+^("I") Q
"RTN","SDCNP1A",15,0)
 Q
"RTN","SDCNP1A",16,0)
SDNP S SDCL(SDAP)=SC_"^"_GDATE_"^"_NDATE S:NDATE SDCNT1=SDCNT1+1 Q
"RTN","SDCNP1A",17,0)
NRBK W !,"NO REBOOKING ALLOWED FOR ",$P(^SC(SC,0),"^") Q
"RTN","SDCNP1A",18,0)
DT S X1=$P(DT,"."),X2=10 D C^%DTC S Y=X D D^DIQ S D=Y_"//" Q
"RTN","SDCNP1A",19,0)
PROT S SDPRT=0 I $D(^SC(+I,"SDPROT")),$P(^("SDPROT"),U)="Y",'$D(^SC(+I,"SDPRIV",DUZ)) W !,*7,"Appt. in ",$P(^SC(+I,0),"^")," NOT CANCELLED ",!,"Access to this clinic is restricted to only privileged users!",*7 S SDPRT=1 Q
"RTN","SDCNP1A",20,0)
 Q
"RTN","SDCNP1A",21,0)
FLEN S COV=$S($P(^DPT(DFN,"S",NDT,0),"^",11)=1:" (COLLATERAL) ",1:"") I $D(^SC(SC,"S",NDT)) F ZL=0:0 S ZL=$O(^SC(SC,"S",NDT,1,ZL)) Q:ZL'>0  I +^(ZL,0)=DFN S APL=$P(^(0),"^",2) Q
"RTN","SDCNP1A",22,0)
 Q
"RTN","SDCNP1A",23,0)
LOOP1 S SDCNT1=0 F L=0:0 S L=$O(^UTILITY($J,"SDCNP",L)) Q:L'>0  I ^(L)["JUST CANCELLED" S $P(SDCL(L),"^")=$P(^(L),"^",2),$P(SDCL(L),"^",2)=$P(^(L),"^")
"RTN","SDCNP1A",24,0)
 K ^UTILITY($J) Q
"RTN","SDCNP1A",25,0)
SDLET N NDT,GDT
"RTN","SDCNP1A",26,0)
 U IO D Q F SDP=0:0 S SDP=$O(SDCL(SDP)) Q:SDP'>0  S SDP1=SDCL(SDP),SDC=+SDP1,GDT=$P(SDP1,"^",2),NDT=$P(SDP1,"^",3),SDV1=$P(^SC(SDC,0),"^",15) D B G:SDB E G:SDK E S:'SDV1 SDV1=+$O(^DG(40.8,0)) D F S:SDLET ^UTILITY($J,SDLET,+A,GDT)=SDC_"^"_NDT
"RTN","SDCNP1A",27,0)
 F SDLET=0:0 S SDLET=$O(^UTILITY($J,SDLET)) Q:SDLET'>0  F B0=0:0 S A1=B0,B0=$O(^UTILITY($J,SDLET,B0)) D:'B0 R Q:'B0  D:A1&(A1'=B0) R S A=B0 D ^SDLT,APP
"RTN","SDCNP1A",28,0)
 I $D(^UTILITY($J,"NO")) W @IOF,! F SC=0:0 S SC=$O(^UTILITY($J,"NO",SC)) Q:SC'>0  W !,$P(^SC(SC,0),"^")," Clinic is not assigned a letter",!!
"RTN","SDCNP1A",29,0)
E I $G(SDB),SDB W !!,"BAD ADDRESS INDICATOR FOR THIS PATIENT. NO LETTER WILL BE PRINTED." S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1A",30,0)
 I $G(SDK),'SDK W !!,"NO LETTER CAN BE PRINTED FOR THIS PATIENT." S DIR(0)="E" D ^DIR K DIR(0)
"RTN","SDCNP1A",31,0)
 K A,SDCL D CLOSE^DGUTQ
"RTN","SDCNP1A",32,0)
Q K A1,SDFORM,SDLET,SDNDT,SDP1,SDV1,^UTILITY($J),SDB,SDK Q
"RTN","SDCNP1A",33,0)
F S SDFORM="" I $D(^DG(40.8,SDV1,"LTR")),^("LTR") S SDFORM=^("LTR")
"RTN","SDCNP1A",34,0)
 S SDLET="" I $D(^SC(SDC,"LTR")) S:SDWH["P" SDLET=$P(^("LTR"),"^",4) S:SDWH'["P" SDLET=$P(^("LTR"),"^",3)
"RTN","SDCNP1A",35,0)
 I 'SDLET S ^UTILITY($J,"NO",SDC)=""
"RTN","SDCNP1A",36,0)
 Q
"RTN","SDCNP1A",37,0)
R I $D(^UTILITY($J,"R",SDLET,A1)) W !!,"The appointment(s) have been rescheduled as follows:",! F A2=0:0 S A2=$O(^UTILITY($J,"R",SDLET,A1,A2)) Q:A2'>0  S (X,SDX)=A2,SDC=+^(A2),A=A1,SDS=^DPT(DFN,"S",SDX,0) D WRAPP^SDLT K X,SDX
"RTN","SDCNP1A",38,0)
 D REST^SDLT Q
"RTN","SDCNP1A",39,0)
APP F SDX=0:0 S SDX=$O(^UTILITY($J,SDLET,A,SDX)) Q:SDX'>0  S S=^DPT(+A,"S",SDX,0),SDC=+^(0) D WRAPP^SDLT I $P(^UTILITY($J,SDLET,A,SDX),"^",2) S ^UTILITY($J,"R",SDLET,A,$P(^UTILITY($J,SDLET,A,SDX),"^",2))=$P(^(SDX),"^")
"RTN","SDCNP1A",40,0)
 Q
"RTN","SDCNP1A",41,0)
CKK I $L(SDDI)>4!($L(SDDM)>4) S SDERR=1 W !,"There is no appointment number ",$S($L(SDDI)>5:SDDI,1:SDDM) Q
"RTN","SDCNP1A",42,0)
 Q
"RTN","SDCNP1A",43,0)
CKK1 F Z0=SDDI,SDDM Q:'SDDI!('SDDM&(SDDI-Z0))  S SDERR=0 S:$L(Z0)>5 SDERR=1 Q:SDERR  S:$L(SDDI)<5 SDDI=+SDDI S:$L(SDDM)<5 SDDM=+SDDM I $L(Z0)>5!('$D(^UTILITY($J,"SDCNP",Z0,"CNT"))) S SDERR=1 Q
"RTN","SDCNP1A",44,0)
 W:SDERR !,*7,"There is no appointment number ",Z0 H 2 Q
"RTN","SDCNP1A",45,0)
CKK2 F Z0=SDDI,SDDM Q:'SDDI!('SDDM&(SDDI-Z0))  S SDERR=0 S:$L(Z0)>5 SDERR=1 Q:SDERR  S:$L(SDDI)<5 SDDI=+SDDI S:$L(SDDM)<5 SDDM=+SDDM I $L(Z0)>5!('$D(^UTILITY($J,"SDCNP2",DFN,Z0))) S SDERR=1 Q
"RTN","SDCNP1A",46,0)
 W:SDERR !,*7,"There is no appointment number ",Z0 Q
"RTN","SDCNP1A",47,0)
B S SDB=$$BADADR^DGUTL3(+A)
"RTN","SDCNP1A",48,0)
CHECK S SDK=0 I $S('$D(^DPT(+A,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(+A,"S",GDT,0)),$S($P(^(0),"^",2)["N":1,$D(SDCP)&$P(^(0),"^",2)["C":1,1:0),$P(^(0),"^",14)=SDTIME!(SDTIME="*"),'$D(^DPT(+A,.1)) S SDK=1
"RTN","SDCNP1A",49,0)
 Q
"RTN","SDL1")
0^4^B12888093
"RTN","SDL1",1,0)
SDL1 ;BSN/GRR,ALB/LDB - PRE-APPOINTMENT LETTERS ; 7/7/04 10:45am
"RTN","SDL1",2,0)
 ;;5.3;Scheduling;**106,330,340**;Aug 13, 1993
"RTN","SDL1",3,0)
 ;
"RTN","SDL1",4,0)
 ;******************MODIFICATIONS***********************************
"RTN","SDL1",5,0)
 ;
"RTN","SDL1",6,0)
 ;  DATE        PATCH       DEVELOPER    DESCRIPTION
"RTN","SDL1",7,0)
 ;  ----        -----       ---------    -----------
"RTN","SDL1",8,0)
 ;  12/12/2003  SD*5.3*330  JOHN LUNDEN  FIX FORM FEED LOGIC
"RTN","SDL1",9,0)
 ;
"RTN","SDL1",10,0)
 ;******************************************************************
"RTN","SDL1",11,0)
 ;
"RTN","SDL1",12,0)
 U IO N SDBAD K ^UTILITY($J) S SDLT1=SDLET G:"Pp"'[S1 BC
"RTN","SDL1",13,0)
 I $D(VAUTN) F C=0:0 S C=$O(VAUTN(C)) Q:'C  S DFN=C D BAD Q:SDBAD  D DATE
"RTN","SDL1",14,0)
 D LST Q
"RTN","SDL1",15,0)
DATE F D=SDBD:0 S D=$O(^DPT(C,"S",D)) Q:'D!(D>(SDED+.9999))  I $D(^(D,0)),$P(^(0),"^",2)'["C",$S('$D(^DPT(C,.35)):1,$P(^(.35),"^",1)']"":1,1:0) S A1=C,B1=D,D1=+^DPT(C,"S",D,0) D SET
"RTN","SDL1",16,0)
 Q
"RTN","SDL1",17,0)
APP F J=0:0 S J=$O(^UTILITY($J,L,A,J)) Q:'J  S SDX=J,SDC=^(J),S=^DPT(+A,"S",J,0) D WRAPP^SDLT
"RTN","SDL1",18,0)
 D REST^SDLT Q
"RTN","SDL1",19,0)
BC S U="^" I $D(VAUTC),'VAUTC D CL G LST
"RTN","SDL1",20,0)
ALCL F C=0:0 S C=$O(^SC(C)) Q:'C  I '$D(SDVAUTC(C)),$P(^SC(C,0),U,3)="C",$S('$D(^("I")):1,'+^("I"):1,+^("I")<SDBD&('$P(^("I"),U,2)):0,+^("I")<SDBD&($P(^("I"),U,2)>SDED):0,1:1) D NCHECK I $T D D D:$D(SDD) OVER
"RTN","SDL1",21,0)
LST N SDFIRST S SDFIRST=1       ;SD*5.3*330. Flag to determine first pag
"RTN","SDL1",22,0)
 F L=0:0 S L=$O(^UTILITY($J,L)) Q:'L  D
"RTN","SDL1",23,0)
 .F A=0:0 S A=$O(^UTILITY($J,L,A)) Q:'A  D
"RTN","SDL1",24,0)
 ..S DFN=A D BAD Q:SDBAD
"RTN","SDL1",25,0)
 ..S SDLET=L D ^SDLT,APP
"RTN","SDL1",26,0)
 D NO,END,CLOSE^DGUTQ Q
"RTN","SDL1",27,0)
CL F C=0:0 S C=$O(VAUTC(C)) Q:'C  S:'SDLT1 SDLET=0 D OVER
"RTN","SDL1",28,0)
 Q
"RTN","SDL1",29,0)
OVER Q:'$D(^SC(C,"S"))  F SDT=SDBD:0 S SDT=$O(^SC(C,"S",SDT)) Q:'SDT!(SDT>(SDED+.9999))  F K=0:0 S K=$O(^SC(C,"S",SDT,1,K)) Q:'K  S DFN=+^(K,0) I $P(^(0),"^",9)'["C" D BAD Q:SDBAD  D CHECK
"RTN","SDL1",30,0)
 Q
"RTN","SDL1",31,0)
END W ! K %,%H,%I,%Y,%DT,%IS,%ZIS,A,B,C,D,DN,CLIN,CNN,DATE,DATEND,DFN,DIC,DIV,DOW,GDATE,SDHX,I,J,J1,K,L,L0,PDAT,S,S1,SC,SDADD,SDFORM,SDT,SDXX,TIME,X,Y,Z,Z0,Z5 Q
"RTN","SDL1",32,0)
CHECK I $S('$D(^DPT(DFN,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(DFN,"S",SDT,0)),$P(^(0),"^",2)'["C",'$D(^DPT(DFN,.1)) S A1=DFN,B1=SDT,D1=C D SET
"RTN","SDL1",33,0)
 Q
"RTN","SDL1",34,0)
SET I $D(^SC(D1,"LTR"))!(SDLT1) S:'SDLT1 SDLET=$P(^SC(D1,"LTR"),"^",2) I SDLET S ^UTILITY($J,SDLET,A1,B1)=D1 S:'SDLT1 SDLET=0 K A,A1,B1,D1 Q
"RTN","SDL1",35,0)
 I 'SDLET S ^UTILITY($J,"C",A1,D1)="" K A,A1,B1,D1 Q
"RTN","SDL1",36,0)
 Q
"RTN","SDL1",37,0)
NO I $D(VAUTN),'$O(^UTILITY($J,0)),'$D(^UTILITY($J,"C")) D
"RTN","SDL1",38,0)
 .I SDBAD W !,"THIS PATIENT(S) HAS THE BAD ADDRESS INDICATOR SET AND PRE-APPOINTMENT LETTER(S) WILL NOT PRINT." Q
"RTN","SDL1",39,0)
 .W !,"NO ACTIVE APPOINTMENTS FOR THE PATIENT(S) DURING THAT TIME PERIOD!",*7
"RTN","SDL1",40,0)
 I $D(^UTILITY($J,"C")) W @IOF F X=0:0 S X=$O(^UTILITY($J,"C",X)) Q:'X  W !!,$P(^DPT(X,0),"^")," ",$P(^(0),"^",9)," HAS FUTURE APPTS., but" D NOCL
"RTN","SDL1",41,0)
 Q
"RTN","SDL1",42,0)
NOCL F XX=0:0 S XX=$O(^UTILITY($J,"C",X,XX)) Q:'XX  W !,$P(^SC(XX,0),"^")," Clinic is not assigned a PRE-APPOINTMENT LETTER"
"RTN","SDL1",43,0)
 Q
"RTN","SDL1",44,0)
D K SDD I ($P(^SC(C,0),"^",15)=SDV1)!(SDV1=$O(^DG(40.8,0))&($P(^SC(C,0),"^",15)="")) S SDD=1
"RTN","SDL1",45,0)
 Q
"RTN","SDL1",46,0)
NCHECK ;
"RTN","SDL1",47,0)
 N NOC S NOC=$P($G(^SC(C,0)),U,17)
"RTN","SDL1",48,0)
 I SDCONC="B" Q
"RTN","SDL1",49,0)
 I SDCONC="C"&(NOC="N") Q
"RTN","SDL1",50,0)
 I SDCONC="N"&(NOC="Y") Q
"RTN","SDL1",51,0)
 Q
"RTN","SDL1",52,0)
BAD S SDBAD=$$BADADR^DGUTL3(DFN)
"RTN","SDL1",53,0)
 Q
"RTN","SDN1")
0^3^B19827145
"RTN","SDN1",1,0)
SDN1 ;BSN/GRR - NO-SHOW LETTERS ; 17 AUG 84  4:34 pm
"RTN","SDN1",2,0)
 ;;5.3;Scheduling;**330,340**;Aug 13, 1993
"RTN","SDN1",3,0)
 N SDBAD
"RTN","SDN1",4,0)
 I ANS["Y"&($D(C)) F A=0:0 S A=$O(^UTILITY($J,A)) Q:A'>0  F C=0:0 S C=$O(^(A,C)) Q:C'>0  S SC=+^(C),SDLET="" S:$D(^SC(SC,"LTR")) SDLET=+^("LTR") S:SDLET ^UTILITY($J,"SDLT",SDLET,A,C)=^UTILITY($J,A,C) S:'SDLET ^UTILITY($J,"NO",A,C)=SC D KLL
"RTN","SDN1",5,0)
 S SDFORM=$S($D(^DG(40.8,SDV1,"LTR")):^("LTR"),1:"") G:ANS["Y"&($D(C)) LST
"RTN","SDN1",6,0)
BC K:$D(SDLT) C S:$D(SDLT) SDT=SDBD,DATEND=SDED K ^UTILITY($J) I $D(C) K VAUTC S (VAUTC,VAUTC(C))=""
"RTN","SDN1",7,0)
 I $D(VAUTC),'VAUTC F C=0:0 S C=$O(VAUTC(C)) Q:C'>0  D:$D(SDLT) LT D CHECK1 I $T D OVER
"RTN","SDN1",8,0)
 I $D(VAUTC),'VAUTC G LST
"RTN","SDN1",9,0)
LST1 F C=0:0 S C=$O(^SC(C)) Q:C'>0  D LT,CHECK1 I $T,$S(SDV1="":1,SDV=SDV1:1,SDV="":1,1:0),'$D(SDVAUTC(+C)),$D(^SC(C,"S")) D OVER
"RTN","SDN1",10,0)
LST N SDFIRST S SDFIRST=1
"RTN","SDN1",11,0)
 F SDLET=0:0 S SDLET=$O(^UTILITY($J,"SDLT",SDLET)) Q:SDLET'>0  F A=0:0 S A=$O(^UTILITY($J,"SDLT",SDLET,A)) Q:A'>0  I $S('$D(^DPT(A,.35)):1,$P(^(.35),"^",1)']"":1,1:0) D ^SDLT,WR
"RTN","SDN1",12,0)
 I $D(^UTILITY($J,"NO")) W @IOF F A=0:0 S A=$O(^UTILITY($J,"NO",A)) Q:A'>0  F A1=0:0 S A1=$O(^(A,A1)) Q:A1'>0  Q:$$BADADR^DGUTL3(A)  W !,$P(^DPT(A,0),"^")," ",$P(^(0),"^",9)," has failed to keep the following appointment(s):" D NDT
"RTN","SDN1",13,0)
 W:$D(^UTILITY($J,"NO")) !,"However, there are no letters assigned to the clinic(s).",!! G END
"RTN","SDN1",14,0)
OVER S GDATE=SDT Q:'$D(^SC(C,"S"))  F J=0:0 S GDATE=$O(^SC(C,"S",GDATE)) Q:GDATE=""!(GDATE>(DATEND+.9999))  F K=0:0 S K=$O(^SC(C,"S",GDATE,1,K)) Q:K=""  I $D(^(K,0)) S DFN=+^(0) D CHECK
"RTN","SDN1",15,0)
 Q
"RTN","SDN1",16,0)
END K %,%DT,%IS,A,A0,A1,A2,ALL,ALS,ANS,BY,C,CDATE,DA,DFN,DGPGM,DGVAR,DH,DHD,DIC,DIS,DIV,DIW,DIWF,DIWL,DIWR,DIWT,DO,DOW,DN,DUPE,FLDS,F,F1,FR,GDATE,I,I1,L,L0,LET,MAX,MESS,MIN,NOAP,P,POP,SC,SD,SDFOR,SDLET,SDTIME,SI,SL,SS,ST,SDSTRTDT,TO,X,Y,ADDR,B
"RTN","SDN1",17,0)
 K CLIN,HX,LL,PDAT,S,TIME,Z,D,NDATE,ENDATE,J,SDMDT,SDMSTIME,X1,X2,SDTADE,SDADTB,SDRE,SDRE1,SDIN,SDIS,SDYES,CNN,SDT,DATEND,SDV1,K,SDR,SDJ1,^UTILITY($J),SD1,SD2,SDADD,SDC,SDCL,SDCMAX,SDCONS,SDD,SDDAT,SDDIF,SDDT,SDED,SDFORM,SDHX,SDINP,SDIP
"RTN","SDN1",18,0)
 K %ZIS,Y1,SDBD,SDCT,SDVAUTC,VAUTC,SDX,SDX1,SDNOSH,SDLT1,SDMSG,SDNODE,SDQ,SDRT,SDSOH,SDSTAT,SDT0,SDZSC,SM,SM1,STARTDAY,STIME,SDV,Z0,Z5 D CLOSE^DGUTQ Q
"RTN","SDN1",19,0)
CHECK I $S('$D(^DPT(DFN,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(DFN,"S",GDATE,0)),$S($P(^(0),"^",2)["N":1,$D(SDCP)&$P(^(0),"^",2)["C":1,1:0),$P(^(0),"^",14)=SDTIME!(SDTIME="*"),'$D(^DPT(DFN,.1)) D BAD Q:SDBAD  D SET
"RTN","SDN1",20,0)
 Q
"RTN","SDN1",21,0)
SET I SDLT1!SDLET S ^UTILITY($J,"SDLT",$S(SDLT1:SDLT1,1:SDLET),DFN,GDATE)=C_"^"_$P(^DPT(DFN,"S",GDATE,0),"^",10) Q
"RTN","SDN1",22,0)
 S ^UTILITY($J,"NO",DFN,GDATE)=C Q
"RTN","SDN1",23,0)
CHECK1 S SDV=$P(^SC(C,0),"^",15) I $P(^(0),"^",3)="C",$S('$D(^SC(C,"I")):1,'(+^("I")):1,+^("I")>DATEND:1,+$P(^("I"),"^",2)'>DATEND&(+$P(^("I"),"^",2)):1,1:0)
"RTN","SDN1",24,0)
 Q
"RTN","SDN1",25,0)
WR K CNN F J=0:0 S J=$O(^UTILITY($J,"SDLT",SDLET,A,J)) Q:J=""  S SDR=0,SDX=J,CNN(J)=^(J),CLIN=$P(^SC(+$P(CNN(J),"^",1),0),"^",1),SDC=+CNN(J),S=$S($D(^DPT(A,"S",J,0)):^(0),1:"") D WRAPP^SDLT,SET1
"RTN","SDN1",26,0)
 D:SDR SDR D REST^SDLT Q
"RTN","SDN1",27,0)
SDR W !!,"The appointment(s) have been rescheduled as follows:",!
"RTN","SDN1",28,0)
 F J=0:0 S J=$O(CNN(J)) Q:J=""  S SDX=$P(CNN(J),"^",2),SDC=$P(CNN(J),"^") I SDX S S=$S($D(^DPT(A,"S",SDX,0)):^(0),1:"") D WRAPP^SDLT
"RTN","SDN1",29,0)
 Q
"RTN","SDN1",30,0)
SET1 S:'SDR SDR=$S($P(CNN(J),"^",2)]"":1,1:0) Q
"RTN","SDN1",31,0)
 Q
"RTN","SDN1",32,0)
LT S:'SDLT1 SDLET=0 I $D(^SC(C,"LTR")),^("LTR") S SDLET=+^("LTR")
"RTN","SDN1",33,0)
 Q
"RTN","SDN1",34,0)
NDT W !?15,$P(^SC(+^UTILITY($J,"NO",A,A1),0),"^")," on " S Y=A1 D DT^DIQ Q
"RTN","SDN1",35,0)
KLL K ^UTILITY($J,A,C) Q
"RTN","SDN1",36,0)
BAD S SDBAD=$$BADADR^DGUTL3(DFN) Q
"VER")
8.0^22
**END**
**END**
