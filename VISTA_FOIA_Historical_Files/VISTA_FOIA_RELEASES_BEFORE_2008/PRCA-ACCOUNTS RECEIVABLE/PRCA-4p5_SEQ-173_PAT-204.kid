EMERGENCY Released PRCA*4.5*204 SEQ #173
Extracted from mail message
**KIDS**:PRCA*4.5*204^

**INSTALL NAME**
PRCA*4.5*204
"BLD",4408,0)
PRCA*4.5*204^ACCOUNTS RECEIVABLE^0^3030828^y
"BLD",4408,1,0)
^^2^2^3030820^
"BLD",4408,1,1,0)
This patch adds the functionality of holding transmissions to FMS of new 
"BLD",4408,1,2,0)
documents created after the EOAM.
"BLD",4408,4,0)
^9.64PA^347^2
"BLD",4408,4,347,0)
347
"BLD",4408,4,347,2,0)
^9.641^347^1
"BLD",4408,4,347,2,347,0)
AR FMS DOCUMENT  (File-top level)
"BLD",4408,4,347,2,347,1,0)
^9.6411^2^1
"BLD",4408,4,347,2,347,1,2,0)
FMS TRANSMISSION DATE
"BLD",4408,4,347,222)
y^n^p^^^^n^^n
"BLD",4408,4,347,224)

"BLD",4408,4,430,0)
430
"BLD",4408,4,430,2,0)
^9.641^430^1
"BLD",4408,4,430,2,430,0)
ACCOUNTS RECEIVABLE  (File-top level)
"BLD",4408,4,430,2,430,1,0)
^9.6411^266^1
"BLD",4408,4,430,2,430,1,266,0)
FMS TRANSMISSION DATE
"BLD",4408,4,430,222)
y^n^p^^^^n^^n
"BLD",4408,4,430,224)

"BLD",4408,4,"APDD",347,347)

"BLD",4408,4,"APDD",347,347,2)

"BLD",4408,4,"APDD",430,430)

"BLD",4408,4,"APDD",430,430,266)

"BLD",4408,4,"B",347,347)

"BLD",4408,4,"B",430,430)

"BLD",4408,"ABPKG")
n
"BLD",4408,"KRN",0)
^9.67PA^8989.52^19
"BLD",4408,"KRN",.4,0)
.4
"BLD",4408,"KRN",.401,0)
.401
"BLD",4408,"KRN",.402,0)
.402
"BLD",4408,"KRN",.403,0)
.403
"BLD",4408,"KRN",.5,0)
.5
"BLD",4408,"KRN",.84,0)
.84
"BLD",4408,"KRN",3.6,0)
3.6
"BLD",4408,"KRN",3.8,0)
3.8
"BLD",4408,"KRN",9.2,0)
9.2
"BLD",4408,"KRN",9.8,0)
9.8
"BLD",4408,"KRN",9.8,"NM",0)
^9.68A^15^15
"BLD",4408,"KRN",9.8,"NM",1,0)
RCFMFN02^^0^B9211943
"BLD",4408,"KRN",9.8,"NM",2,0)
RCXFMSCR^^0^B27286518
"BLD",4408,"KRN",9.8,"NM",3,0)
RCDPURE1^^0^B21522658
"BLD",4408,"KRN",9.8,"NM",4,0)
PRCACPV^^0^B13150999
"BLD",4408,"KRN",9.8,"NM",5,0)
PRCAFBD^^0^B13967018
"BLD",4408,"KRN",9.8,"NM",6,0)
PRCAFBDU^^0^B21918353
"BLD",4408,"KRN",9.8,"NM",7,0)
PRCAFBDM^^0^B5315454
"BLD",4408,"KRN",9.8,"NM",8,0)
PRCARFD2^^0^B3042732
"BLD",4408,"KRN",9.8,"NM",9,0)
PRCARFD1^^0^B28483384
"BLD",4408,"KRN",9.8,"NM",10,0)
RCXFMSW1^^0^B32448827
"BLD",4408,"KRN",9.8,"NM",11,0)
RCWROFF^^0^B30058500
"BLD",4408,"KRN",9.8,"NM",12,0)
RCWROFF1^^0^B33308622
"BLD",4408,"KRN",9.8,"NM",13,0)
PRCAFWO^^0^B13955887
"BLD",4408,"KRN",9.8,"NM",14,0)
RCBEADJ^^0^B57130808
"BLD",4408,"KRN",9.8,"NM",15,0)
RCBEUTRA^^0^B29640170
"BLD",4408,"KRN",9.8,"NM","B","PRCACPV",4)

"BLD",4408,"KRN",9.8,"NM","B","PRCAFBD",5)

"BLD",4408,"KRN",9.8,"NM","B","PRCAFBDM",7)

"BLD",4408,"KRN",9.8,"NM","B","PRCAFBDU",6)

"BLD",4408,"KRN",9.8,"NM","B","PRCAFWO",13)

"BLD",4408,"KRN",9.8,"NM","B","PRCARFD1",9)

"BLD",4408,"KRN",9.8,"NM","B","PRCARFD2",8)

"BLD",4408,"KRN",9.8,"NM","B","RCBEADJ",14)

"BLD",4408,"KRN",9.8,"NM","B","RCBEUTRA",15)

"BLD",4408,"KRN",9.8,"NM","B","RCDPURE1",3)

"BLD",4408,"KRN",9.8,"NM","B","RCFMFN02",1)

"BLD",4408,"KRN",9.8,"NM","B","RCWROFF",11)

"BLD",4408,"KRN",9.8,"NM","B","RCWROFF1",12)

"BLD",4408,"KRN",9.8,"NM","B","RCXFMSCR",2)

"BLD",4408,"KRN",9.8,"NM","B","RCXFMSW1",10)

"BLD",4408,"KRN",19,0)
19
"BLD",4408,"KRN",19.1,0)
19.1
"BLD",4408,"KRN",101,0)
101
"BLD",4408,"KRN",409.61,0)
409.61
"BLD",4408,"KRN",771,0)
771
"BLD",4408,"KRN",870,0)
870
"BLD",4408,"KRN",8989.51,0)
8989.51
"BLD",4408,"KRN",8989.52,0)
8989.52
"BLD",4408,"KRN",8994,0)
8994
"BLD",4408,"KRN","B",.4,.4)

"BLD",4408,"KRN","B",.401,.401)

"BLD",4408,"KRN","B",.402,.402)

"BLD",4408,"KRN","B",.403,.403)

"BLD",4408,"KRN","B",.5,.5)

"BLD",4408,"KRN","B",.84,.84)

"BLD",4408,"KRN","B",3.6,3.6)

"BLD",4408,"KRN","B",3.8,3.8)

"BLD",4408,"KRN","B",9.2,9.2)

"BLD",4408,"KRN","B",9.8,9.8)

"BLD",4408,"KRN","B",19,19)

"BLD",4408,"KRN","B",19.1,19.1)

"BLD",4408,"KRN","B",101,101)

"BLD",4408,"KRN","B",409.61,409.61)

"BLD",4408,"KRN","B",771,771)

"BLD",4408,"KRN","B",870,870)

"BLD",4408,"KRN","B",8989.51,8989.51)

"BLD",4408,"KRN","B",8989.52,8989.52)

"BLD",4408,"KRN","B",8994,8994)

"BLD",4408,"QUES",0)
^9.62^^
"BLD",4408,"REQB",0)
^9.611^8^8
"BLD",4408,"REQB",1,0)
PRCA*4.5*90^1
"BLD",4408,"REQB",2,0)
PRCA*4.5*114^1
"BLD",4408,"REQB",3,0)
PRCA*4.5*119^1
"BLD",4408,"REQB",4,0)
PRCA*4.5*165^1
"BLD",4408,"REQB",5,0)
PRCA*4.5*168^1
"BLD",4408,"REQB",6,0)
PRCA*4.5*172^1
"BLD",4408,"REQB",7,0)
PRCA*4.5*190^1
"BLD",4408,"REQB",8,0)
PRCA*4.5*169^1
"BLD",4408,"REQB","B","PRCA*4.5*114",2)

"BLD",4408,"REQB","B","PRCA*4.5*119",3)

"BLD",4408,"REQB","B","PRCA*4.5*165",4)

"BLD",4408,"REQB","B","PRCA*4.5*168",5)

"BLD",4408,"REQB","B","PRCA*4.5*169",8)

"BLD",4408,"REQB","B","PRCA*4.5*172",6)

"BLD",4408,"REQB","B","PRCA*4.5*190",7)

"BLD",4408,"REQB","B","PRCA*4.5*90",1)

"FIA",347)
AR FMS DOCUMENT
"FIA",347,0)
^RC(347,
"FIA",347,0,0)
347I
"FIA",347,0,1)
y^n^p^^^^n^^n
"FIA",347,0,10)

"FIA",347,0,11)

"FIA",347,0,"RLRO")

"FIA",347,0,"VR")
4.5^PRCA
"FIA",347,347)
1
"FIA",347,347,2)

"FIA",430)
ACCOUNTS RECEIVABLE
"FIA",430,0)
^PRCA(430,
"FIA",430,0,0)
430I
"FIA",430,0,1)
y^n^p^^^^n^^n
"FIA",430,0,10)

"FIA",430,0,11)

"FIA",430,0,"RLRO")

"FIA",430,0,"VR")
4.5^PRCA
"FIA",430,430)
1
"FIA",430,430,266)

"MBREQ")
0
"PKG",142,-1)
1^1
"PKG",142,0)
ACCOUNTS RECEIVABLE^PRCA^BILL COLLECTIONS
"PKG",142,20,0)
^9.402P^1^1
"PKG",142,20,1,0)
2^^PRCAMRG
"PKG",142,20,1,1)

"PKG",142,20,"B",2,1)

"PKG",142,22,0)
^9.49I^1^1
"PKG",142,22,1,0)
4.5
"PKG",142,22,1,"PAH",1,0)
204^3030828
"PKG",142,22,1,"PAH",1,1,0)
^^2^2^3030828
"PKG",142,22,1,"PAH",1,1,1,0)
This patch adds the functionality of holding transmissions to FMS of new 
"PKG",142,22,1,"PAH",1,1,2,0)
documents created after the EOAM.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","PRCACPV")
0^4^B13150999
"RTN","PRCACPV",1,0)
PRCACPV ;WASH-ISC@ALTOONA,PA/LDB- CHAMPVA FMS DOCUMENTS ;5/1/95  3:06 PM
"RTN","PRCACPV",2,0)
V ;;4.5;Accounts Receivable;**1,48,90,119,204**;Mar 20, 1995
"RTN","PRCACPV",3,0)
 ;
"RTN","PRCACPV",4,0)
EN(BILL,ERR) ;Send CHAMPVA SUBSISTENCE bill to FMS
"RTN","PRCACPV",5,0)
 N ADD,ADDR,AMT,BILL0,BNUM,CAT,DA,DIE,DOC,DR,ERROR,ENT,FY,GECSFMS,I,P,PAT,SITE,TXT,VA,VAERR,VADM,X,XMDUZ,XMTEXT,XMY,XMSUB,Y
"RTN","PRCACPV",6,0)
 S ERR=-1
"RTN","PRCACPV",7,0)
 I '$G(BILL) S ERR="NO BILL NUMBER TO PROCESS" D ERR Q
"RTN","PRCACPV",8,0)
 S BILL0=$G(^PRCA(430,+BILL,0)) I BILL0']"" S ERR="BILL INFO CORRUPTED FOR BILL '"_BILL D ERR Q
"RTN","PRCACPV",9,0)
 I "^27^28^30^31^"'[("^"_$P(BILL0,"^",2)_"^")  Q
"RTN","PRCACPV",10,0)
 I $P(BILL0,"^",2)=30,$$AUD^IBRFN(+BILL) Q
"RTN","PRCACPV",11,0)
 S SITE=$P($P(BILL0,"^"),"-") I SITE']"" S ERR="BILL NUMBER CORRUPTED" D ERR Q
"RTN","PRCACPV",12,0)
 S BNUM=$P(BILL0,"^")
"RTN","PRCACPV",13,0)
 S AMT=$J($P(BILL0,"^",3),0,2)
"RTN","PRCACPV",14,0)
 S CAT=$P(BILL0,"^",2)
"RTN","PRCACPV",15,0)
 I "^27^31^"[("^"_CAT_"^") S PAT=$P($G(^PRCA(430,+BILL,0)),"^",9),PAT=$P($G(^RCD(340,+PAT,0)),"^"),PAT=$$NAM^RCFN01(PAT),PAT=$P(PAT,",",2)_" "_$P(PAT,",")
"RTN","PRCACPV",16,0)
 S FY=$$FY^RCFN01(DT)
"RTN","PRCACPV",17,0)
 S ADD=$$SADD^RCFN01(5)
"RTN","PRCACPV",18,0)
 S DESC=$S(CAT=27:"CHAMPVA Subsistence",CAT=30:"CHAMPUS",CAT=31:"CHAMPUS PATIENT",1:"CHAMPVA Third Party")
"RTN","PRCACPV",19,0)
 F I=1:1:6 S ADDR(I)=$P(ADD,"^",I) I (I'=3),(ADDR(I)']"") S ERR="NO HOSPITAL ADDRESS FOUND FOR SITE GROUP" D ERR Q
"RTN","PRCACPV",20,0)
 I ERR>0 Q
"RTN","PRCACPV",21,0)
 ;CALL TO GET VENDORID BELOW - CHECK NOT NECESSARY SINCE GENERIC
"RTN","PRCACPV",22,0)
 ;VENDOR CODE ALWAYS RETURNED FOR THESE BILL TYPES
"RTN","PRCACPV",23,0)
 S VENDORID=$$VENDORID^RCXFMSUV(BILL)
"RTN","PRCACPV",24,0)
 I ADDR(6)["-" S ADDR(7)=$P(ADDR(6),"-",2),ADDR(6)=$P(ADDR(6),"-")
"RTN","PRCACPV",25,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCACPV",26,0)
 S ^TMP("PRCACPV",$J,1)="BD2^"_$E(FMSDT,4,5)_"^"_$E(FMSDT,6,7)_"^"_$E(FMSDT,2,3)
"RTN","PRCACPV",27,0)
 S ^TMP("PRCACPV",$J,1)=^TMP("PRCACPV",$J,1)_"^^^^^^E^"_VENDORID_"^^"_AMT_"^^^^"_$E(ADDR(1),1,30)_"^"_$E(ADDR(2),1,30)_"^"_$E(ADDR(3),1,30)_"^"_$E(ADDR(4),1,19)_"^"_ADDR(5)_"^"_ADDR(6)_"^"_$G(ADDR(7))_"^"_"N^^^^^^W^~"
"RTN","PRCACPV",28,0)
 S ^TMP("PRCACPV",$J,2)="LIN^~BDA^"_$$LINE^RCXFMSC1(BILL)_"^"_FY_"^^"_$S(CAT<30:"3220",1:"0160A1")_"^"_SITE_"^^^"
"RTN","PRCACPV",29,0)
 S:CAT<30 CAT("R")=1000
"RTN","PRCACPV",30,0)
 I CAT'<30 S CAT("R")=$P($G(^PRCA(430,+BILL,11)),U,6)
"RTN","PRCACPV",31,0)
 S ^TMP("PRCACPV",$J,2)=^TMP("PRCACPV",$J,2)_CAT("R")_"^^^^^^^"_AMT_"^I^AR_INTERFACE^^^^"_$S(CAT<30:"09",1:"02")_"^~"
"RTN","PRCACPV",32,0)
 D CONTROL^GECSUFMS("A",SITE,BNUM,"BD",10,0,"",DESC)
"RTN","PRCACPV",33,0)
 I '$D(GECSFMS("DA")) S ERR="COULD NOT ACCESS STACK FILE" D ERR Q
"RTN","PRCACPV",34,0)
 S DOC=$S($G(GECSFMS("DOC"))]"":$P(GECSFMS("DOC"),"^",3)_"-"_$P(GECSFMS("DOC"),"^",4),1:BNUM)
"RTN","PRCACPV",35,0)
 S DA=0 F  S DA=$O(^TMP("PRCACPV",$J,DA)) Q:'DA  D
"RTN","PRCACPV",36,0)
 . D SETCS^GECSSTAA(GECSFMS("DA"),^TMP("PRCACPV",$J,DA))
"RTN","PRCACPV",37,0)
 D OPEN^RCFMDRV1(DOC,6,"B"_+BILL,.ENT,.ERROR,+BILL)
"RTN","PRCACPV",38,0)
 I ERROR]"" S ERR="AR DOCUMENT MISSING - "_ERROR Q
"RTN","PRCACPV",39,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCACPV",40,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCACPV",41,0)
 D SSTAT^RCFMFN02("B"_+BILL,1)
"RTN","PRCACPV",42,0)
 K ^TMP("PRCACPV",$J)
"RTN","PRCACPV",43,0)
 ;
"RTN","PRCACPV",44,0)
ERR I ERR'<0 S ERR="1^"_ERR D
"RTN","PRCACPV",45,0)
 .S TXT(1)="The following error has occurred while processing a "_$S(CAT=31:"CHAMPUS PATIENT ",1:"CHAMPVA")
"RTN","PRCACPV",46,0)
 .S TXT(2)="bill: ("_$S($G(BNUM):BNUM,1:"BILL IFN - "_+BILL)_")"
"RTN","PRCACPV",47,0)
 .S TXT(3)=" "
"RTN","PRCACPV",48,0)
 .S TXT(4)=$P(ERR,"^",2)
"RTN","PRCACPV",49,0)
 .S TXT(5)=""
"RTN","PRCACPV",50,0)
 .S TXT(6)="You will need to use the BILLING DOCUMENT REGENERATION option to create the FMS document."
"RTN","PRCACPV",51,0)
 .S XMTEXT="TXT(",XMY("G.PRCA ERROR")=""
"RTN","PRCACPV",52,0)
 .S XMSUB=$S(CAT=31:"CHAMPUS PATIENT",1:"CHAMPVA")_" FMS DOC error",XMDUZ="ACCOUNTS RECEIVABLE PACKAGE"
"RTN","PRCACPV",53,0)
 .D ^XMD
"RTN","PRCACPV",54,0)
 Q
"RTN","PRCAFBD")
0^5^B13967018
"RTN","PRCAFBD",1,0)
PRCAFBD ;WASH-ISC@ALTOONA,PA/CLH-Build FMS Billing Document ;8/2/95  3:14 PM
"RTN","PRCAFBD",2,0)
V ;;4.5;Accounts Receivable;**16,48,86,90,119,165,204**;Mar 20, 1995
"RTN","PRCAFBD",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAFBD",4,0)
EN(BILL,ERR) ;Process NEW BILL to FMS
"RTN","PRCAFBD",5,0)
 S ERR=-1
"RTN","PRCAFBD",6,0)
 Q:$D(RCONVERT)
"RTN","PRCAFBD",7,0)
 I '$D(^PRCA(430,BILL,11)) S ERR="1^ACCOUNTING INFORMATION MISSING.  CANNOT PROCESS BILL" Q
"RTN","PRCAFBD",8,0)
 ;
"RTN","PRCAFBD",9,0)
 ;  funds 5014 (old), 2431 (old), and 5287 should not create a BD
"RTN","PRCAFBD",10,0)
 S %=$P($G(^PRCA(430,BILL,11)),"^",17)
"RTN","PRCAFBD",11,0)
 I %=5014!(%=2431)!(%=5287) Q
"RTN","PRCAFBD",12,0)
 ;
"RTN","PRCAFBD",13,0)
 I '$D(PRCA("SITE")) S PRCA("SITE")=$S($G(BILL):$P($P($G(^PRCA(430,BILL,0)),"^"),"-"),1:$$SITE^RCMSITE)
"RTN","PRCAFBD",14,0)
 K ^TMP("PRCABD",$J)
"RTN","PRCAFBD",15,0)
 I $G(BILL)="" S ERR="1^Missing Bill Number"
"RTN","PRCAFBD",16,0)
 I '$D(^PRCA(430,BILL,0)),$P(^(0),U,9)="" S ERR="1^No debtor for bill" Q
"RTN","PRCAFBD",17,0)
 N GECSFMS,REC,REC11,VENCODE,BFY,EFY,LINEFUND,%,%I,%H,X,VEN,CAT,CP,ADDR,AC,RJ,FMSNUM,FMSNUM1,VENDORID
"RTN","PRCAFBD",18,0)
 D NOW^%DTC
"RTN","PRCAFBD",19,0)
 W !,"Building FMS Billing Document. Please hold...",!
"RTN","PRCAFBD",20,0)
 S REC=$G(^PRCA(430,BILL,0)),REC11=$G(^PRCA(430,BILL,11)),FMSNUM=$P($P(REC,U),"-")_$P($P(REC,U),"-",2)
"RTN","PRCAFBD",21,0)
 ;gather vendor information
"RTN","PRCAFBD",22,0)
 S VENCODE=$$VENDORID^RCXFMSUV(BILL)
"RTN","PRCAFBD",23,0)
 I VENCODE="UNKNOWN" S ERR="1^Need FMS Vendor ID for BD Document" Q
"RTN","PRCAFBD",24,0)
 I VENCODE="LINK" S ERR="1^Debtor must be linked to vendor file" Q
"RTN","PRCAFBD",25,0)
 S ADD=$$SADD^RCFN01(5)
"RTN","PRCAFBD",26,0)
 I (VENCODE="PERSONOTH")!(VENCODE="XEMPL")!(VENCODE="CUREMPL")!($E(VENCODE,1,4)="CHMP")!($E(VENCODE,1,3)="TRI")!(VENCODE="INELIG") D
"RTN","PRCAFBD",27,0)
  . F I=1:1:6 S ADDR(I)=$P(ADD,U,I)
"RTN","PRCAFBD",28,0)
  . I ADDR(6)["-" S ADDR(7)=$P(ADDR(6),"-",2),ADDR(6)=$P(ADDR(6),"-")
"RTN","PRCAFBD",29,0)
  . Q
"RTN","PRCAFBD",30,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCAFBD",31,0)
 S ^TMP("PRCABD",$J,1)="BD2^"_$E(FMSDT,4,5)_U_$E(FMSDT,6,7)_U_$E(FMSDT,2,3)_"^^^^^^E^"_$E(VENCODE,1,9)_U_$E(VENCODE,10,11)_U_$J($P(REC,U,3),0,2)_"^^^^"_$E($G(ADDR(1)),1,30)_U_$E($G(ADDR(2)),1,30)_U_$E($G(ADDR(3)),1,30)
"RTN","PRCAFBD",32,0)
 S ^TMP("PRCABD",$J,1)=^TMP("PRCABD",$J,1)_U_$E($G(ADDR(4)),1,19)_U_$G(ADDR(5))_U_$G(ADDR(6))_U_$G(ADDR(7))_"^N^^^^^^W^~"
"RTN","PRCAFBD",33,0)
 S ^TMP("PRCABD",$J,2)="LIN^~"
"RTN","PRCAFBD",34,0)
 ;accouting information - stored on 11th node file 430
"RTN","PRCAFBD",35,0)
 S ^TMP("PRCABD",$J,3)="BDA^"_$$LINE^RCXFMSC1(BILL)_"^"_$P(REC11,U,15)_U_$P(REC11,U,16)_U_$P(REC11,U,17)_U_$P(REC11,U,8)_U_$P(REC11,U,11)_U_$P(REC11,U,20)_U_$P(REC11,U,6)_U_$P(REC11,U,7)_U_$P(REC11,U,21)_U_$P(REC11,U,5)
"RTN","PRCAFBD",36,0)
 S ^TMP("PRCABD",$J,3)=^TMP("PRCABD",$J,3)_U_$P(REC11,U,12)_U_$P(REC11,U,14)_"^^"_$J($P(REC,U,3),0,2)_"^I^AR_INTERFACE^^^^"
"RTN","PRCAFBD",37,0)
 S ^TMP("PRCABD",$J,3)=^TMP("PRCABD",$J,3)_$P(REC11,U,10)_"^^^^^^^^"_$P(REC11,U,2)_U_$P(REC11,U,3)_"^~"
"RTN","PRCAFBD",38,0)
 ;build control segment
"RTN","PRCAFBD",39,0)
 D CONTROL^GECSUFMS("A",PRCA("SITE"),FMSNUM,"BD",10,"","","Billing Document")
"RTN","PRCAFBD",40,0)
 S FMSNUM1=$P($G(GECSFMS("DOC")),U,3)_"-"_$P($G(GECSFMS("DOC")),U,4)
"RTN","PRCAFBD",41,0)
 ;build and send document to FTH
"RTN","PRCAFBD",42,0)
 S DA=0 F  S DA=$O(^TMP("PRCABD",$J,DA)) Q:'DA  D SETCS^GECSSTAA(GECSFMS("DA"),^(DA))
"RTN","PRCAFBD",43,0)
 D OPEN^RCFMDRV1(FMSNUM1,6,"B"_BILL,.ENT,.ERR,BILL) I ERR]"" W !!,"Unable to create an entry in AR Document file.",! S ERR=-1
"RTN","PRCAFBD",44,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCAFBD",45,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCAFBD",46,0)
 D SSTAT^RCFMFN02(FMSNUM1,1)
"RTN","PRCAFBD",47,0)
 S Y=FMSDT D DD^%DT W !!,"FMS document, # ",GECSFMS("DA"),", built and queued for transmission on "_Y,!!
"RTN","PRCAFBD",48,0)
 Q
"RTN","PRCAFBD",49,0)
 ;
"RTN","PRCAFBDM")
0^7^B5315454
"RTN","PRCAFBDM",1,0)
PRCAFBDM ;WASH-ISC@ALTOONA,PA/CLH-Build MODIFIED FMS Billing Document ;9/16/94  12:11 PM
"RTN","PRCAFBDM",2,0)
V ;;4.5;Accounts Receivable;**60,90,204**;Mar 20, 1995
"RTN","PRCAFBDM",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAFBDM",4,0)
EN(BILL,AMT,ADJTYP,PRCADJD,TN,ERR) ;Process NEW BILL to FMS
"RTN","PRCAFBDM",5,0)
 Q:$D(RCONVERT)
"RTN","PRCAFBDM",6,0)
 N GECSFMS,REC,FMSNUM
"RTN","PRCAFBDM",7,0)
 K ^TMP("PRCABD",$J)
"RTN","PRCAFBDM",8,0)
 I $G(BILL)="" S ERR="1^Missing Bill Number" Q
"RTN","PRCAFBDM",9,0)
 ;
"RTN","PRCAFBDM",10,0)
 ;  funds 5014 (old), 2431 (old), and 5287 should not create a BD
"RTN","PRCAFBDM",11,0)
 S %=$P($G(^PRCA(430,BILL,11)),"^",17)
"RTN","PRCAFBDM",12,0)
 I %=5014!(%=2431)!(%=5287) Q
"RTN","PRCAFBDM",13,0)
 ;
"RTN","PRCAFBDM",14,0)
 I +PRCADJD<1 S PRCADJD=DT
"RTN","PRCAFBDM",15,0)
 I AMT<0 S AMT=-AMT
"RTN","PRCAFBDM",16,0)
 I '$D(^PRCA(430,BILL,0)) S ERR="1^Unable to locate bill" Q
"RTN","PRCAFBDM",17,0)
 S REC=$G(^PRCA(430,BILL,0)),FMSNUM=$P($P(REC,U),"-")_$P($P(REC,U),"-",2)
"RTN","PRCAFBDM",18,0)
 W !!,"Creating FMS Modified Billing Document..."
"RTN","PRCAFBDM",19,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCAFBDM",20,0)
 S ^TMP("PRCABD",$J,1)="BD2^"_$E(FMSDT,4,5)_U_$E(FMSDT,6,7)_U_$E(FMSDT,2,3)_"^^^^^^M^^^"_$J(AMT,0,2)_"^~"
"RTN","PRCAFBDM",21,0)
 S ^TMP("PRCABD",$J,2)="LIN^~"
"RTN","PRCAFBDM",22,0)
 S ^TMP("PRCABD",$J,3)="BDA^"_$$LINE^RCXFMSC1(BILL)_"^^^^^^^^^^^^^^"_$J(AMT,0,2)_"^"_$S(ADJTYP=35:"D",ADJTYP=1:"I",1:"")_"^AR_INTERFACE^~"
"RTN","PRCAFBDM",23,0)
 ;build control segment
"RTN","PRCAFBDM",24,0)
 D CONTROL^GECSUFMS("A",$P(REC,U,12),FMSNUM,"BD",10,"1","","Modified Billing Document")
"RTN","PRCAFBDM",25,0)
 S FMSNUM1=$P($G(GECSFMS("DOC")),U,3)_"-"_$P($G(GECSFMS("DOC")),U,4)_"-"_$P($G(GECSFMS("BAT")),U,3)
"RTN","PRCAFBDM",26,0)
 D OPEN^RCFMDRV1(FMSNUM1,7,"T"_TN,.ENT,.ERR,BILL,TN) I ERR]"" W !!,"Unable to create entry in AR Document File.",! S ERR=-1
"RTN","PRCAFBDM",27,0)
 ;build and send document to FTH
"RTN","PRCAFBDM",28,0)
 S DA=0 F  S DA=$O(^TMP("PRCABD",$J,DA)) Q:'DA  D SETCS^GECSSTAA(GECSFMS("DA"),^(DA))
"RTN","PRCAFBDM",29,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCAFBDM",30,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCAFBDM",31,0)
 D SSTAT^RCFMFN02("T"_TN,1)
"RTN","PRCAFBDM",32,0)
 W !,"Document #",GECSFMS("DA")," Created.",!
"RTN","PRCAFBDM",33,0)
 Q
"RTN","PRCAFBDM",34,0)
 ;
"RTN","PRCAFBDU")
0^6^B21918353
"RTN","PRCAFBDU",1,0)
PRCAFBDU ;WASH-ISC@ALTOONA,PA/CLH-FMS Billing Document Utilities ;6/27/96  11:48 AM
"RTN","PRCAFBDU",2,0)
V ;;4.5;Accounts Receivable;**2,16,29,42,168,169,204**;Mar 20, 1995
"RTN","PRCAFBDU",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAFBDU",4,0)
BDGEN ;regenerate billing document
"RTN","PRCAFBDU",5,0)
 N Y,ID,REFMS
"RTN","PRCAFBDU",6,0)
EN S DIC="^PRCA(430,",DIC(0)="AEMNQZ",DIC("A")="Select BILL NUMBER: "
"RTN","PRCAFBDU",7,0)
 D ^DIC K DIC Q:+Y<0
"RTN","PRCAFBDU",8,0)
 I $$GSTAT^RCFMFN02("B"_+Y)'=3 W !!,*7,"You CANNOT resend a document that has NOT REJECTED in FMS.",!! G EN
"RTN","PRCAFBDU",9,0)
 S PRCABN=+Y
"RTN","PRCAFBDU",10,0)
 S DIR(0)="Y",DIR("A")="Are you sure",DIR("A",1)="This will RESEND the selected Billing Document to FMS.",DIR("B")="NO" D ^DIR K DIR
"RTN","PRCAFBDU",11,0)
 W ! G:+Y'=1 EN
"RTN","PRCAFBDU",12,0)
 ;Setting variable REFMS flags for retransmission of document and will
"RTN","PRCAFBDU",13,0)
 ;have a date of DT for transmission to FMS.
"RTN","PRCAFBDU",14,0)
 S REFMS=1 D RSEND
"RTN","PRCAFBDU",15,0)
 G EN
"RTN","PRCAFBDU",16,0)
RSEND S FMSNUM="B"_PRCABN
"RTN","PRCAFBDU",17,0)
 D DEL^RCFMFN02(FMSNUM)
"RTN","PRCAFBDU",18,0)
 K FMSNUM
"RTN","PRCAFBDU",19,0)
 D EN^PRCAFBD(PRCABN)
"RTN","PRCAFBDU",20,0)
 K PRCABN
"RTN","PRCAFBDU",21,0)
 Q
"RTN","PRCAFBDU",22,0)
 ;
"RTN","PRCAFBDU",23,0)
BDMGEN ;regenerate modified billing document
"RTN","PRCAFBDU",24,0)
 N Y,DIC,BN,AMT,ADJTYO,TDT,TN,ERR,REFMS
"RTN","PRCAFBDU",25,0)
EN2 S DIC="^PRCA(433,",DIC(0)="AEMNQZ",DIC("A")="Select A/R TRANSACTION NUMBER: " D ^DIC
"RTN","PRCAFBDU",26,0)
 Q:+Y<0
"RTN","PRCAFBDU",27,0)
 I $$GSTAT^RCFMFN02("T"_+Y)'=3 W !!,*7,"You CANNOT resend a document that has NOT REJECTED in FMS.",!! G EN2
"RTN","PRCAFBDU",28,0)
 S TN=+Y,BN=$P(^PRCA(433,TN,0),U,2),TDT=$P(^(1),U),ADJTYP=$P(^(1),U,2),AMT=$P(^(1),U,5)
"RTN","PRCAFBDU",29,0)
 S DIR(0)="Y",DIR("A")="Are you sure",DIR("A",1)="This will RESEND the selected Billing Document to FMS.",DIR("B")="NO" D ^DIR K DIR
"RTN","PRCAFBDU",30,0)
 W ! G:+Y'=1 EN2
"RTN","PRCAFBDU",31,0)
 S FMSNUM="T"_TN,REFMS=1
"RTN","PRCAFBDU",32,0)
 D DEL^RCFMFN02(FMSNUM)
"RTN","PRCAFBDU",33,0)
 K FMSNUM
"RTN","PRCAFBDU",34,0)
 D EN^PRCAFBDM(BN,AMT,ADJTYP,TDT,TN,.ERR)
"RTN","PRCAFBDU",35,0)
 G EN2
"RTN","PRCAFBDU",36,0)
 ;
"RTN","PRCAFBDU",37,0)
 ;
"RTN","PRCAFBDU",38,0)
CC ;cost center
"RTN","PRCAFBDU",39,0)
 N DIC,Y
"RTN","PRCAFBDU",40,0)
 S CCC=$$COST^PRCSREC2($S($D(PRCA("SITE")):PRCA("SITE"),1:$$SITE^RCMSITE),CP)
"RTN","PRCAFBDU",41,0)
 S DIC="^PRCD(420.1,",DIC(0)="EMNQ",DIC("A")="COST CENTER: "
"RTN","PRCAFBDU",42,0)
 D ^DIC Q:+Y<0
"RTN","PRCAFBDU",43,0)
 I $D(DUOUT)!($D(DTOUT)) S PRCA("EXIT")=1 Q
"RTN","PRCAFBDU",44,0)
 I CCC'[$P(Y,U) W !!,*7,"Invalid Cost Center for the Control Point" D CCDISP Q
"RTN","PRCAFBDU",45,0)
 S CCC=+Y,CC=$E(+Y,1,4)_"00",SCC=$E(+Y,5,6)
"RTN","PRCAFBDU",46,0)
 Q
"RTN","PRCAFBDU",47,0)
 ;
"RTN","PRCAFBDU",48,0)
BOC ;budget object code
"RTN","PRCAFBDU",49,0)
 N DIC,Y
"RTN","PRCAFBDU",50,0)
 I '$D(CCC) S CCC=$P($G(^PRCA(430,$S($D(PRCABN):PRCABN,$D(DA):DA,1:-1),11)),U,2)
"RTN","PRCAFBDU",51,0)
 S DIC="^PRCD(420.2,",DIC(0)="EMNQ"
"RTN","PRCAFBDU",52,0)
 D ^DIC Q:+Y<0
"RTN","PRCAFBDU",53,0)
 I $D(DUOUT)!($D(DTOUT)) S PRCA("EXIT")=1 Q
"RTN","PRCAFBDU",54,0)
 I +CCC>0,'$D(^PRCD(420.1,CCC,1,+Y,0)) S Y=-1 Q
"RTN","PRCAFBDU",55,0)
 S BOC=+Y
"RTN","PRCAFBDU",56,0)
 Q
"RTN","PRCAFBDU",57,0)
 ;
"RTN","PRCAFBDU",58,0)
CCDISP ;display valid cost centers
"RTN","PRCAFBDU",59,0)
 N DIC,X,Y
"RTN","PRCAFBDU",60,0)
 S:'$D(CCC) CCC=$$COST^PRCSREC2($S($D(PRCA("SITE")):PRCA("SITE"),1:$$SITE^RCMSITE),CP)
"RTN","PRCAFBDU",61,0)
 S X="?"
"RTN","PRCAFBDU",62,0)
 S DIC="^PRC(420,"_$S($D(PRCA("SITE")):PRCA("SITE"),1:$$SITE^RCMSITE)_",1,"_+CP_",2,"
"RTN","PRCAFBDU",63,0)
 S DIC(0)="EMNQ"
"RTN","PRCAFBDU",64,0)
 D ^DIC
"RTN","PRCAFBDU",65,0)
 Q
"RTN","PRCAFBDU",66,0)
 W !!,"Valid Cost Centers for this Control Point are:",!
"RTN","PRCAFBDU",67,0)
 F I=1:1:$L(CCC,U) W ?10,$E($P($G(^PRCD(420.1,$P(CCC,U,I),0)),U),1,40),!
"RTN","PRCAFBDU",68,0)
 Q
"RTN","PRCAFBDU",69,0)
 ;
"RTN","PRCAFBDU",70,0)
BOCDISP ;display valid BOCs
"RTN","PRCAFBDU",71,0)
 N ZZDA,DIC,X,Y
"RTN","PRCAFBDU",72,0)
 S:'$D(CCC) CCC=$P($G(^PRCA(430,$S($D(PRCABN):PRCABN,1:$G(DA)),11)),U,2)
"RTN","PRCAFBDU",73,0)
 S DIC="^PRCD(420.1,"_+CCC_",1,",DIC(0)="EMNQ",X="?"
"RTN","PRCAFBDU",74,0)
 W ?10,!!,"Valid BOCs for this Cost Center are:",!
"RTN","PRCAFBDU",75,0)
 D ^DIC
"RTN","PRCAFBDU",76,0)
 Q
"RTN","PRCAFBDU",77,0)
 ;
"RTN","PRCAFBDU",78,0)
RHLP ;help for refund/reimbursement prompt
"RTN","PRCAFBDU",79,0)
 W !!,"If this BILL will create a receivable for a budget element, i.e. Control Point,",!,"Answer REFUND.  Otherwise answer REIMBURSEMENT.",!!,"A REFUND will ALWAYS reference a Control Point, i.e. SALARY OVERPAYMENT."
"RTN","PRCAFBDU",80,0)
 W !,"A REIMBURSEMENT is usually for services, i.e. Emergency/Humanitarian Care.",!!
"RTN","PRCAFBDU",81,0)
 Q
"RTN","PRCAFBDU",82,0)
 ;
"RTN","PRCAFBDU",83,0)
ACCT ;edit accounting line information on rejected documents
"RTN","PRCAFBDU",84,0)
 NEW BILL,DIE,DA,PRCABN,DIC,X,Y,L,FR,TO,FLDS,DIR,REFMS
"RTN","PRCAFBDU",85,0)
ACCT1 SET (DIC,DIE)="^PRCA(430,",DIC(0)="AEMNQ",DIC("A")="Select BILL NUMBER: " DO ^DIC
"RTN","PRCAFBDU",86,0)
 QUIT:+Y<0
"RTN","PRCAFBDU",87,0)
 I '$P($G(^PRCA(430,+Y,6)),"^",21) W !,"YOU CAN ONLY SELECT BILLS THAT ARE ACTIVE.",! G ACCT1
"RTN","PRCAFBDU",88,0)
 I $D(RCONVERT) S PRCABN=+Y G EDT
"RTN","PRCAFBDU",89,0)
 SET BILL="B"_+Y
"RTN","PRCAFBDU",90,0)
 SET PRCABN=+Y
"RTN","PRCAFBDU",91,0)
EDT SET IOP=IO(0),DIC="^PRCA(430,",FLDS="[PRCA DISP AUDIT2]",(FR,TO)=PRCABN,L=0,BY="@NUMBER" DO EN1^DIP
"RTN","PRCAFBDU",92,0)
 SET (DIC,DIE)="^PRCA(430,"
"RTN","PRCAFBDU",93,0)
 DO CPLK^PRCAFUT(PRCABN)
"RTN","PRCAFBDU",94,0)
 QUIT:$D(PRCA("EXIT"))
"RTN","PRCAFBDU",95,0)
 ;DO:'$DATA(RCONVERT) RSEND
"RTN","PRCAFBDU",96,0)
 I '$D(RCONVERT) S REFMS=1 D RSEND
"RTN","PRCAFBDU",97,0)
 G ACCT
"RTN","PRCAFBDU",98,0)
 ;
"RTN","PRCAFBDU",99,0)
FUND ;valid fund seletion
"RTN","PRCAFBDU",100,0)
 NEW DIC,X,Y
"RTN","PRCAFBDU",101,0)
 S DIC(0)="EMNQ",DIC="^PRCD(420.14,",X="?"
"RTN","PRCAFBDU",102,0)
 D ^DIC
"RTN","PRCAFBDU",103,0)
 Q
"RTN","PRCAFBDU",104,0)
SBOC ;remove SUB BOC from rejected bills
"RTN","PRCAFBDU",105,0)
 N DIE,DA,DIC,DR
"RTN","PRCAFBDU",106,0)
 S (DIC,DIE)="^PRCA(430,",DIC(0)="AEMNQ" D ^DIC
"RTN","PRCAFBDU",107,0)
 Q:+Y<0
"RTN","PRCAFBDU",108,0)
 S DA=+Y
"RTN","PRCAFBDU",109,0)
 S DR="254///^S X=""@""" D ^DIE
"RTN","PRCAFBDU",110,0)
 W !,"SUB BOC removed.",!
"RTN","PRCAFBDU",111,0)
 Q
"RTN","PRCAFBDU",112,0)
 ;
"RTN","PRCAFBDU",113,0)
BDTRANS ;Select trans type for billing documents
"RTN","PRCAFBDU",114,0)
 N DIC,DA,X,Y
"RTN","PRCAFBDU",115,0)
 S DIC="^PRCA(347.4,",DIC(0)="AEMNQ",DIC("A")="Select TRANS. TYPE: ",DIC("S")="I $P(^(0),U,2)=1" D ^DIC
"RTN","PRCAFBDU",116,0)
 I +Y<0 S PRCA("EXIT")=1 Q
"RTN","PRCAFBDU",117,0)
 S TYPE=$P(Y,U,2)
"RTN","PRCAFBDU",118,0)
 Q
"RTN","PRCAFBDU",119,0)
 ;
"RTN","PRCAFWO")
0^13^B13955887
"RTN","PRCAFWO",1,0)
PRCAFWO ;WASH-ISC@ALTOONA,PA/CLH-FMS WRITE OFF DOCUMENT  ;8/2/95  3:20 PM
"RTN","PRCAFWO",2,0)
V ;;4.5;Accounts Receivable;**16,48,89,90,204**;Mar 20, 1995
"RTN","PRCAFWO",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCAFWO",4,0)
EN(BN,DATE,AMOUNT,SITE,TN) ;entry point for auto-creation of FMS write off document
"RTN","PRCAFWO",5,0)
 NEW GECSFMS,FMSNUM,DA,TYPE,NUM,FMSNUM1 KILL ^TMP("PRCAWR",$J)
"RTN","PRCAFWO",6,0)
 SET NUM=$PIECE(^PRCA(430,BN,0),U),NUM=$PIECE(NUM,"-")_$PIECE(NUM,"-",2)
"RTN","PRCAFWO",7,0)
 SET FMSNUM=$$ENUM^RCMSNUM
"RTN","PRCAFWO",8,0)
 SET TYPE=$$RECTYP^PRCAFUT(BN)
"RTN","PRCAFWO",9,0)
 DO CONTROL^GECSUFMS("A",SITE,FMSNUM,"WR",10,"","N","WRITE OFF")
"RTN","PRCAFWO",10,0)
 S FMSNUM1=$P($G(GECSFMS("DOC")),U,3)_"-"_$P($G(GECSFMS("DOC")),U,4)
"RTN","PRCAFWO",11,0)
 DO OPEN^RCFMDRV1(FMSNUM1,1,"T"_TN,.ENT,.ERR,BN,TN)
"RTN","PRCAFWO",12,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCAFWO",13,0)
 SET ^TMP("PRCAWR",$J,1)="CR2^"_$EXTRACT(FMSDT,2,3)_U_$EXTRACT(FMSDT,4,5)_U_$EXTRACT(FMSDT,6,7)_"^^^^^^E^^^999999999999^^"_$JUSTIFY(AMOUNT,0,2)_"^^"_$EXTRACT(DT,2,3)_U_$EXTRACT(DT,4,5)_U_$EXTRACT(DT,6,7)_"^~"
"RTN","PRCAFWO",14,0)
 I "^30^32^"[("^"_$P($G(^PRCA(430,+BN,0)),"^",2)_"^") S $P(^TMP("PRCAWR",$J,1),"^",15)=$TR($P(^TMP("PRCAWR",$J,1),"^",15),"-","")
"RTN","PRCAFWO",15,0)
 SET ^TMP("PRCAWR",$J,2)="LIN^~"
"RTN","PRCAFWO",16,0)
 SET ^TMP("PRCAWR",$J,3)="CRA^001^^^^^^^^^^^^^^^^^"_$JUSTIFY(AMOUNT,0,2)_"^I^^"_$P($$DTYPE^PRCAFBD1(TYPE),U,4)_"^BD^"_NUM_"^"_$$LINE^RCXFMSC1(BN)_"^~"
"RTN","PRCAFWO",17,0)
 ;Tricare document
"RTN","PRCAFWO",18,0)
 I "^30^32^"[("^"_$P($G(^PRCA(430,+BN,0)),"^",2)_"^") S $P(^TMP("PRCAWR",$J,3),"^",22)="06",$P(^TMP("PRCAWR",$J,3),"^",19)=$TR($P(^TMP("PRCAWR",$J,3),"^",19),"-","")
"RTN","PRCAFWO",19,0)
 SET DA=0 FOR  SET DA=$ORDER(^TMP("PRCAWR",$J,DA)) QUIT:'DA  DO SETCS^GECSSTAA(GECSFMS("DA"),^(DA))
"RTN","PRCAFWO",20,0)
 DO SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCAFWO",21,0)
 DO SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCAFWO",22,0)
 DO SSTAT^RCFMFN02("T"_TN,1)
"RTN","PRCAFWO",23,0)
 WRITE !,"WRITE OFF Document Created.  Number # ",GECSFMS("DA"),".",!
"RTN","PRCAFWO",24,0)
 SET $PIECE(^PRCA(430,BN,11),U,22)=$P(FMSNUM,"-")_$P(FMSNUM,"-",2)
"RTN","PRCAFWO",25,0)
 KILL ^TMP("PRCAWR",$J)
"RTN","PRCAFWO",26,0)
 QUIT
"RTN","PRCAFWO",27,0)
 ;
"RTN","PRCAFWO",28,0)
MODWR(BN,AMOUNT,FMSNUM,TN,MOD) ;send modified write-off document
"RTN","PRCAFWO",29,0)
 W !!,"Creating Modified WR document..."
"RTN","PRCAFWO",30,0)
 NEW GECSFMS,DA,TYPE,NUM,FMSNUM1 KILL ^TMP("PRCAWR",$J)
"RTN","PRCAFWO",31,0)
 S NUM=$P(^PRCA(430,BN,0),U),NUM=$P(NUM,"-")_$P(NUM,"-",2)
"RTN","PRCAFWO",32,0)
 S TYPE=$$RECTYP^PRCAFUT(BN)
"RTN","PRCAFWO",33,0)
 D CONTROL^GECSUFMS("A",$$SITE^RCMSITE,FMSNUM,"WR",10,$S(MOD=1:1,1:""),"N","MODIFIED WRITE OFF")
"RTN","PRCAFWO",34,0)
 I MOD S FMSNUM1=$P($G(GECSFMS("DOC")),U,3)_"-"_$P($G(GECSFMS("DOC")),U,4)_"-"_$P($G(GECSFMS("BAT")),U,3)
"RTN","PRCAFWO",35,0)
 D OPEN^RCFMDRV1($S($D(FMSNUM1):FMSNUM1,1:FMSNUM),1,"T"_TN,.ENT,.ERR,BN,TN)
"RTN","PRCAFWO",36,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCAFWO",37,0)
 S ^TMP("PRCAWR",$J,1)="CR2^"_$E(FMSDT,2,3)_U_$E(FMSDT,4,5)_U_$E(FMSDT,6,7)_"^^^^^^M^^^999999999999^^"_$J(AMOUNT,0,2)_"^^"_$E(DT,2,3)_U_$E(DT,4,5)_U_$E(DT,6,7)_"^~"
"RTN","PRCAFWO",38,0)
 S ^TMP("PRCAWR",$J,2)="LIN^~"
"RTN","PRCAFWO",39,0)
 S ^TMP("PRCAWR",$J,3)="CRA^001^^^^^^^^^^^^^^^^^"_$J(AMOUNT,0,2)_"^D^^"_$P($$DTYPE^PRCAFBD1(TYPE),U,4)_"^BD^"_NUM_"^"_$$LINE^RCXFMSC1(BN)_"^~"
"RTN","PRCAFWO",40,0)
 S DA=0 FOR  S DA=$O(^TMP("PRCAWR",$J,DA)) Q:'DA  D SETCS^GECSSTAA(GECSFMS("DA"),^(DA))
"RTN","PRCAFWO",41,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCAFWO",42,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCAFWO",43,0)
 D SSTAT^RCFMFN02("T"_TN,1)
"RTN","PRCAFWO",44,0)
 W !,"Document Created.  Number # ",GECSFMS("DA"),".",!
"RTN","PRCAFWO",45,0)
 I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !!,"   * * * * Transmission will be held until "_Y_" * * * *"
"RTN","PRCAFWO",46,0)
 S $P(^PRCA(430,BN,11),U,22)=FMSNUM
"RTN","PRCAFWO",47,0)
 K ^TMP("PRCAWR",$J)
"RTN","PRCAFWO",48,0)
 Q
"RTN","PRCAFWO",49,0)
 ;
"RTN","PRCARFD1")
0^9^B28483384
"RTN","PRCARFD1",1,0)
PRCARFD1 ;WASH-ISC@ALTOONA,PA/LDB-APPROVE REFUND AND GENERATE FMS DOC ;2/14/96  9:13 AM
"RTN","PRCARFD1",2,0)
V ;;4.5;Accounts Receivable;**21,36,90,104,141,190,204**;Mar 20, 1995
"RTN","PRCARFD1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCARFD1",4,0)
 ;
"RTN","PRCARFD1",5,0)
APPRV ;Enter Elec sig for CFO
"RTN","PRCARFD1",6,0)
 N ADD,DA,ENT,ERROR,PRCABN0,PRCANM,RA,TIME,X,Y
"RTN","PRCARFD1",7,0)
 F X=1:1:5 S RA=+$G(RA)+$P($G(^PRCA(430,PRCABN,7)),U,X)
"RTN","PRCARFD1",8,0)
 I +$G(RA)'=$P($G(^PRCA(430,PRCABN,7)),U,18) W !!,"REFUND AMOUNT OUT-OF-BALANCE!" Q
"RTN","PRCARFD1",9,0)
 S DA=+PRCABN D SIG^PRCASIG I $G(PRCANM)']"" W !!,"DID NOT APPROVE REFUND" Q
"RTN","PRCARFD1",10,0)
 L +^PRCA(430,PRCABN):1 Q:'$T  S $P(^PRCA(430,PRCABN,9),U,2)=PRCANM,$P(^(9),U,1)=DUZ,$P(^(9),U,3)=$G(DT) L -^PRCA(430,PRCABN) W !," <APPROVED BY CERTIFYING OFFICER>"
"RTN","PRCARFD1",11,0)
 I $G(^PRCA(430,PRCABN,7))'>0 W !!,*7,"This Accounts Receivable doesn't have an excess payment !" D CANC^PRCARFD(PRCABN) W !!,"Status Changed to 'CANCELLATION'",! Q
"RTN","PRCARFD1",12,0)
 W *7,!!,"No other transactions may be made to the bill now."
"RTN","PRCARFD1",13,0)
 ;
"RTN","PRCARFD1",14,0)
FMSDOC ;Create FMS overcollection payment voucher document
"RTN","PRCARFD1",15,0)
 ;
"RTN","PRCARFD1",16,0)
 N %,ADD,GECSFMS,DATE,DEBT,DY,MO,PRCA,PRCANM,STAT,YR,DOC
"RTN","PRCARFD1",17,0)
 I '$D(^PRCA(430,+$G(PRCABN),0)) W !,"THIS BILL NUMBER ENTRY IN FILE 430 IS CORRUPTED",!,"NO PROCESSING CAN CONTINUE - SEE IRM" Q
"RTN","PRCARFD1",18,0)
 S PRCABN0=$G(^PRCA(430,+PRCABN,0)),PRCANM=$P(PRCABN0,"^")
"RTN","PRCARFD1",19,0)
 S STAT=$$GSTAT^RCFMFN02(PRCANM)
"RTN","PRCARFD1",20,0)
 I STAT>0&(STAT<3) W !!,*7,"THIS DOCUMENT SEEMS TO HAVE ALREADY BEEN SENT TO FMS-",!,"IT CANNOT BE RESENT UNLESS FMS REJECTS IT." Q
"RTN","PRCARFD1",21,0)
FMS W !!,"Creating an FMS Overcollection Payment Voucher . . .",!
"RTN","PRCARFD1",22,0)
 S PRCA("STN")=$P($P(PRCABN0,U),"-")
"RTN","PRCARFD1",23,0)
 S DEBT=+$P(PRCABN0,U,9),DEBT=$P($G(^RCD(340,DEBT,0)),U)
"RTN","PRCARFD1",24,0)
 S PRCA("VNAME")=$$NAM^RCFN01(DEBT) I PRCA("VNAME")="" S ADD=0
"RTN","PRCARFD1",25,0)
 S PRCA("VNAME")=$P(PRCA("VNAME"),",",2)_" "_$P(PRCA("VNAME"),",")
"RTN","PRCARFD1",26,0)
 S PRCA("VCODE")=$$SSN^RCFN01(DEBT)
"RTN","PRCARFD1",27,0)
 S ADD=1
"RTN","PRCARFD1",28,0)
 S PRCA("ADD")=$$DADD^RCAMADD(DEBT,1)
"RTN","PRCARFD1",29,0)
 S PRCA("VADD1")=$P(PRCA("ADD"),U) I PRCA("VADD1")="" S ADD=0
"RTN","PRCARFD1",30,0)
 S PRCA("VADD2")=$P(PRCA("ADD"),U,2)
"RTN","PRCARFD1",31,0)
 S PRCA("VCITY")=$P(PRCA("ADD"),U,4) I PRCA("VCITY")="" S ADD=0
"RTN","PRCARFD1",32,0)
 S PRCA("VSTATE")=$P(PRCA("ADD"),U,5) I PRCA("VSTATE")="" S ADD=0
"RTN","PRCARFD1",33,0)
 S PRCA("VZIP")=$P(PRCA("ADD"),U,6) I PRCA("VZIP")="" S ADD=0
"RTN","PRCARFD1",34,0)
 S PRCA("LAMT")=$P($G(^PRCA(430,+PRCABN,7)),U,18)
"RTN","PRCARFD1",35,0)
 S PRCANM=$P($G(^PRCA(430,+PRCABN,0)),U)
"RTN","PRCARFD1",36,0)
 I 'ADD D  Q
"RTN","PRCARFD1",37,0)
 .W *7,!,"THIS PATIENT DOES NOT HAVE A VALID ADDRESS."
"RTN","PRCARFD1",38,0)
 .W !,"AN FMS DOCUMENT CANNOT BE CREATED WITHOUT A VALID ADDRESS."
"RTN","PRCARFD1",39,0)
 .Q
"RTN","PRCARFD1",40,0)
 I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !!,"   * * * * Transmission will be held until "_Y_" * * * *",!
"RTN","PRCARFD1",41,0)
 D NOW^%DTC S YR=$E(%,2,3),MO=$E(%,4,5),DY=$E(%,6,7)
"RTN","PRCARFD1",42,0)
 S Y=$P(%,".") X ^DD("DD") S DATE=$P(Y,",",2)_MO_DY
"RTN","PRCARFD1",43,0)
 S TIME=$P(%,".",2)
"RTN","PRCARFD1",44,0)
 S PRCA("FY")=$$FY^RCFN01($P(%,"."))
"RTN","PRCARFD1",45,0)
 S PRCA("LAMT")=$J(PRCA("LAMT"),0,2)
"RTN","PRCARFD1",46,0)
 D CONTROL^GECSUFMS("A",PRCA("STN"),PRCANM,"OP",10,0,"","")
"RTN","PRCARFD1",47,0)
 ;S FMSTRING("CTL")="CTL^FMS^"_PRCA("STN")^DOC^OP^10^^"_PRCA("STN")_PRCA("FY")_SEQ_U_YYYYMMDD_U_TIME_U_SEQ_U_PRCANM_"^ARS"_PRCA("STN")_U_VER
"RTN","PRCARFD1",48,0)
 I '$D(GECSFMS("DA")) W !,"AN ENTRY WAS NOT MADE IN THE STACKER FILE.",!,"PLEASE RE-SELECT THE BILL IN THE APPROVE OPTION." Q
"RTN","PRCARFD1",49,0)
 S DOC=$S($G(GECSFMS("DOC"))]"":$P(GECSFMS("DOC"),"^",3)_"-"_$P(GECSFMS("DOC"),"^",4),1:PRCANM)
"RTN","PRCARFD1",50,0)
 D OPEN^RCFMDRV1(DOC,5,"B"_PRCABN,.ENT,.ERROR,PRCABN)
"RTN","PRCARFD1",51,0)
 I ERROR]"" W !!,*7,"AN AR DOC REF CANNOT BE CREATED BECAUSE THE FOLLOWING ERROR HAS OCCURRED -",!?10,ERROR,!
"RTN","PRCARFD1",52,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","PRCARFD1",53,0)
 S ^TMP($J,"PRCA",1)="PV2^"_$E(FMSDT,4,5)_U_$E(FMSDT,6,7)_U_$E(FMSDT,2,3)_"^^^^^E^01^^^^^^^^^^MISCVET^^"_PRCA("LAMT")_"^"
"RTN","PRCARFD1",54,0)
 S ^TMP($J,"PRCA",2)=PRCA("VNAME")_U_$E(PRCA("VADD1"),1,30)_U_$E(PRCA("VADD2"),1,30)_U_PRCA("VCITY")_U_PRCA("VSTATE")_U_PRCA("VZIP")_"^~"
"RTN","PRCARFD1",55,0)
 S ^TMP($J,"PRCA",3)="LIN^~PVA^001^^^^^^^^^^^"_PRCA("FY")_"^^5287^"_PRCA("STN")_"^^^^^^^^^^^"_$$CALCRSC^RCXFMSUR(+PRCABN)_"^^^^^^"_PRCA("LAMT")_"^I^~"
"RTN","PRCARFD1",56,0)
 S DA=0 F  S DA=$O(^TMP($J,"PRCA",DA)) Q:'DA  D
"RTN","PRCARFD1",57,0)
 .D SETCS^GECSSTAA(GECSFMS("DA"),^TMP($J,"PRCA",DA))
"RTN","PRCARFD1",58,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","PRCARFD1",59,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","PRCARFD1",60,0)
 D SSTAT^RCFMFN02("B"_+$G(PRCABN),1)
"RTN","PRCARFD1",61,0)
 Q:$P($G(^PRCA(430,+$G(PRCABN),0)),U,8)=$O(^PRCA(430.3,"AC",41,0))
"RTN","PRCARFD1",62,0)
 K ^TMP($J)
"RTN","PRCARFD1",63,0)
 ;Pass to FMS
"RTN","PRCARFD1",64,0)
 ;Call generic interface to setup document if completed flag proceed
"RTN","PRCARFD1",65,0)
 ;change date if resent to FMS
"RTN","PRCARFD1",66,0)
 ;
"RTN","PRCARFD1",67,0)
TREF ;Create REFUNDED transaction and set to REFUNDED status
"RTN","PRCARFD1",68,0)
 N DIE,DR,DA,PRCASVC,PRCAA2,PRCAEN,PRCAMT,X,Y,DIR,DEBTOR,CLYRRF
"RTN","PRCARFD1",69,0)
 S U="^"
"RTN","PRCARFD1",70,0)
 I $P($G(^PRCA(430,+PRCABN,0)),U,8)=$O(^PRCA(430.3,"AC",120,0)) Q
"RTN","PRCARFD1",71,0)
 D SETTR^PRCAUTL I '$G(PRCAEN) W !!,"COULD NOT SET UP A REFUND TRANSACTION!" Q
"RTN","PRCARFD1",72,0)
 W !!,"Creating a REFUNDED transaction for bill number: ",$P(^PRCA(430,PRCABN,0),"^")," . . .",!
"RTN","PRCARFD1",73,0)
 D PATTR^PRCAUTL S PRCA("ADJ")=$O(^PRCA(430.3,"AC",120,0)),PRCASV("BDT")=$G(DT),PRCASV("APR")=DUZ,PRCASV("FY")="^"_+$P($G(^PRCA(430,PRCABN,7)),U,18)
"RTN","PRCARFD1",74,0)
 S DIE="^PRCA(433,",DR="[PRCA FY ADJ2 BATCH]",DA=PRCAEN D ^DIE
"RTN","PRCARFD1",75,0)
 S PRCAMT=-$G(PRCAMT),PRCAA2=$P(^PRCA(433,PRCAEN,4,0),U,3)
"RTN","PRCARFD1",76,0)
 D UPFY^PRCADJ,TRANUP^PRCAUTL
"RTN","PRCARFD1",77,0)
 S $P(^PRCA(430,PRCABN,7),U,1)=$G(^PRCA(430,PRCABN,7))+PRCAMT,PRCA("STATUS")=$O(^PRCA(430.3,"AC",120,0)) D UPSTATS^PRCAUT2
"RTN","PRCARFD1",78,0)
 W !,"Bill is now in REFUNDED status.",!
"RTN","PRCARFD1",79,0)
 ;CHECK TO SEE IF TOP REFUND AND SET UP FIELDS TO SEND WITH NEXT
"RTN","PRCARFD1",80,0)
 ;TOP TRANSMISSION
"RTN","PRCARFD1",81,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Is this a TOP Refund",DIR("??")="Enter 'YES' only if this is a refund of a payment from TOP"
"RTN","PRCARFD1",82,0)
 D ^DIR Q:'Y
"RTN","PRCARFD1",83,0)
 S DEBTOR=$P(^PRCA(430,PRCABN,0),U,9) Q:'DEBTOR
"RTN","PRCARFD1",84,0)
 S TRACE=$P($G(^RCD(340,DEBTOR,6)),U,7)
"RTN","PRCARFD1",85,0)
 I $L(TRACE)'=10 W !,*7,"There is no valid trace number entered for this debtor",!,"Cannot process as TOP refund." Q
"RTN","PRCARFD1",86,0)
 S CLYRRF=$E(DT,1,3)+1700,DA=PRCABN
"RTN","PRCARFD1",87,0)
 S DIE="^PRCA(430,",DR="144//^S X=CLYRRF;142////1;143///^S X=TRACE"
"RTN","PRCARFD1",88,0)
 S DA=PRCABN,DIE("NO^")=1 D ^DIE
"RTN","PRCARFD1",89,0)
 W !,"TOP REFUND DOCUMENT WILL BE SENT WITH NEXT TOP TRANSMISSION"
"RTN","PRCARFD1",90,0)
 Q
"RTN","PRCARFD1",91,0)
 ;
"RTN","PRCARFD2")
0^8^B3042732
"RTN","PRCARFD2",1,0)
PRCARFD2 ;WASH-ISC@ALTOONA,PA/LDB-GENERATE FMS DOC ;10/19/94  3:36 PM
"RTN","PRCARFD2",2,0)
V ;;4.5;Accounts Receivable;**204**;Mar 20, 1995
"RTN","PRCARFD2",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCARFD2",4,0)
 ;;
"RTN","PRCARFD2",5,0)
TRANS ;TRANSMIT A REFUND (OVERCOLLECTION) DOC
"RTN","PRCARFD2",6,0)
 N DIC,PRCABN,PRCABN0,REF,U,REFMS
"RTN","PRCARFD2",7,0)
 S U="^",REF=$O(^PRCA(430.3,"AC",120,0))
"RTN","PRCARFD2",8,0)
 S D0=+$O(^PRCA(430.2,"AC",33,0)),D0(1)=$P(^PRCA(430.2,+D0,0),U)
"RTN","PRCARFD2",9,0)
 S DIC="^PRCA(430,",DIC("S")="I $P(^(0),U,2)="_D0_",$P(^(0),U,8)="_REF,DIC(0)="AEQMZ" D ^DIC Q:Y<0  S PRCABN=+Y
"RTN","PRCARFD2",10,0)
 I $P(^PRCA(430,PRCABN,9),U,2)="" W !,"THIS BILL HAS NOT BEEN APPROVED!" Q
"RTN","PRCARFD2",11,0)
 I '$D(^PRCA(430,+$G(PRCABN),0)) W !,"THIS BILL NUMBER ENTRY IN FILE 430 IS CORRUPTED",!,"NO PROCESSING CAN CONTINUE - SEE IRM" Q
"RTN","PRCARFD2",12,0)
 S PRCABN0=^(0),PRCANM=$P($G(^PRCA(430,+PRCABN,0)),U)
"RTN","PRCARFD2",13,0)
 S STAT=$$GSTAT^RCFMFN02("B"_PRCABN)
"RTN","PRCARFD2",14,0)
 I STAT<0 W !,"THIS DOCUMENT IS EITHER NOT READY FOR FMS OR HAS ALREADY BEEN ACCEPTED." Q
"RTN","PRCARFD2",15,0)
 I STAT'=3 W !!,*7,"THIS DOCUMENT SEEMS TO HAVE ALREADY BEEN SENT TO FMS-",!,"IT CANNOT BE RESENT UNLESS FMS REJECTS IT." Q
"RTN","PRCARFD2",16,0)
 D DEL^RCFMFN02("B"_PRCABN) S REFMS=1 D FMS^PRCARFD1
"RTN","PRCARFD2",17,0)
 Q
"RTN","RCBEADJ")
0^14^B57130808
"RTN","RCBEADJ",1,0)
RCBEADJ ;WISC/RFJ-adjustment ;1 Mar 2001
"RTN","RCBEADJ",2,0)
 ;;4.5;Accounts Receivable;**169,172,204**;Mar 20, 1995
"RTN","RCBEADJ",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCBEADJ",4,0)
 Q
"RTN","RCBEADJ",5,0)
 ;
"RTN","RCBEADJ",6,0)
 ;
"RTN","RCBEADJ",7,0)
DECREASE ;  menu option: create a decrease adjustment
"RTN","RCBEADJ",8,0)
 D ADJUST("DECREASE")
"RTN","RCBEADJ",9,0)
 Q
"RTN","RCBEADJ",10,0)
 ;
"RTN","RCBEADJ",11,0)
 ;
"RTN","RCBEADJ",12,0)
INCREASE ;  menu option: create an increase adjustment
"RTN","RCBEADJ",13,0)
 D ADJUST("INCREASE")
"RTN","RCBEADJ",14,0)
 Q
"RTN","RCBEADJ",15,0)
 ;
"RTN","RCBEADJ",16,0)
 ;
"RTN","RCBEADJ",17,0)
ADJUST(RCBETYPE) ;  create an adjustment
"RTN","RCBEADJ",18,0)
 ;  rcbetype = INCREASE for increase or DECREASE for decrease
"RTN","RCBEADJ",19,0)
 N RCBILLDA
"RTN","RCBEADJ",20,0)
 F  D  Q:RCBILLDA<0
"RTN","RCBEADJ",21,0)
 .   K RCTRANDA,RCLIST
"RTN","RCBEADJ",22,0)
 .   ;
"RTN","RCBEADJ",23,0)
 .   ;  select a bill
"RTN","RCBEADJ",24,0)
 .   S RCBILLDA=$$GETABILL^RCBEUBIL I RCBILLDA<1 Q
"RTN","RCBEADJ",25,0)
 .   ;
"RTN","RCBEADJ",26,0)
 .   ;  adjust the bill
"RTN","RCBEADJ",27,0)
 .   D ADJBILL(RCBETYPE,RCBILLDA)
"RTN","RCBEADJ",28,0)
 Q
"RTN","RCBEADJ",29,0)
 ;
"RTN","RCBEADJ",30,0)
 ;
"RTN","RCBEADJ",31,0)
ADJBILL(RCBETYPE,RCBILLDA) ;  adjust a bill
"RTN","RCBEADJ",32,0)
 N RCAMOUNT,RCBALANC,RCDATA7,RCLIST,RCONTADJ,RCTRANDA,TOTALCAL,TOTALSTO,I,X,Y
"RTN","RCBEADJ",33,0)
 ;  lock the bill
"RTN","RCBEADJ",34,0)
 L +^PRCA(430,RCBILLDA):5 I '$T W !,"ANOTHER USER IS CURRENTLY WORKING WITH THIS BILL." Q
"RTN","RCBEADJ",35,0)
 ;
"RTN","RCBEADJ",36,0)
 ;  show data for the bill
"RTN","RCBEADJ",37,0)
 D SHOWBILL^RCWROFF1(RCBILLDA)
"RTN","RCBEADJ",38,0)
 ;
"RTN","RCBEADJ",39,0)
 ;  check the balance of the bill
"RTN","RCBEADJ",40,0)
 W !!,"Checking the bill's balance ..."
"RTN","RCBEADJ",41,0)
 S RCBALANC=$$OUTOFBAL^RCBDBBAL(RCBILLDA)
"RTN","RCBEADJ",42,0)
 I RCBALANC="" W " IN Balance!"
"RTN","RCBEADJ",43,0)
 ;
"RTN","RCBEADJ",44,0)
 ;  out of balance, ask to fix it
"RTN","RCBEADJ",45,0)
 I RCBALANC'="" D  I RCBILLDA<1 D UNLOCK Q
"RTN","RCBEADJ",46,0)
 .   S TOTALCAL=$P(RCBALANC,"^")+$P(RCBALANC,"^",2)+$P(RCBALANC,"^",3)+$P(RCBALANC,"^",4)+$P(RCBALANC,"^",5)
"RTN","RCBEADJ",47,0)
 .   S RCDATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEADJ",48,0)
 .   S TOTALSTO=$P(RCDATA7,"^")+$P(RCDATA7,"^",2)+$P(RCDATA7,"^",3)+$P(RCDATA7,"^",4)+$P(RCDATA7,"^",5)
"RTN","RCBEADJ",49,0)
 .   W " OUT of Balance!"
"RTN","RCBEADJ",50,0)
 .   W !!,"                  BALANCE:",$J("Calculated",12),$J("Stored",12)
"RTN","RCBEADJ",51,0)
 .   W !,"                  ------- ",$J("------------",12),$J("------------",12)
"RTN","RCBEADJ",52,0)
 .   W !,"        Principal Balance:",$J($P(RCBALANC,"^",1),12,2),$J($P(RCDATA7,"^",1),12,2)
"RTN","RCBEADJ",53,0)
 .   I +$P(RCBALANC,"^",1)'=+$P(RCDATA7,"^",1) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",54,0)
 .   W !,"         Interest Balance:",$J($P(RCBALANC,"^",2),12,2),$J($P(RCDATA7,"^",2),12,2)
"RTN","RCBEADJ",55,0)
 .   I +$P(RCBALANC,"^",2)'=+$P(RCDATA7,"^",2) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",56,0)
 .   W !,"            Admin Balance:",$J($P(RCBALANC,"^",3),12,2),$J($P(RCDATA7,"^",3),12,2)
"RTN","RCBEADJ",57,0)
 .   I +$P(RCBALANC,"^",3)'=+$P(RCDATA7,"^",3) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",58,0)
 .   W !,"               MF Balance:",$J($P(RCBALANC,"^",4),12,2),$J($P(RCDATA7,"^",4),12,2)
"RTN","RCBEADJ",59,0)
 .   I +$P(RCBALANC,"^",4)'=+$P(RCDATA7,"^",4) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",60,0)
 .   W !,"               CC Balance:",$J($P(RCBALANC,"^",5),12,2),$J($P(RCDATA7,"^",5),12,2)
"RTN","RCBEADJ",61,0)
 .   I +$P(RCBALANC,"^",5)'=+$P(RCDATA7,"^",5) W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",62,0)
 .   W !,"                  ------- ",$J("----------",12),$J("----------",12)
"RTN","RCBEADJ",63,0)
 .   W !,"                    TOTAL:",$J(TOTALCAL,12,2),$J(TOTALSTO,12,2)
"RTN","RCBEADJ",64,0)
 .   I +TOTALCAL'=+TOTALSTO W "  <<-- OUT OF BALANCE"
"RTN","RCBEADJ",65,0)
 .   ;
"RTN","RCBEADJ",66,0)
 .   ;  ask to fix the balances
"RTN","RCBEADJ",67,0)
 .   S Y=$$ASKFIX I Y'=1 W !,"  NOTE: You must fix the Balance Discrepancy before processing an adjustment!" S RCBILLDA=0 Q
"RTN","RCBEADJ",68,0)
 .   ;
"RTN","RCBEADJ",69,0)
 .   ;  fix it
"RTN","RCBEADJ",70,0)
 .   S $P(RCDATA7,"^",1)=+$P(RCBALANC,"^",1) ; principal
"RTN","RCBEADJ",71,0)
 .   S $P(RCDATA7,"^",2)=+$P(RCBALANC,"^",2) ; interest
"RTN","RCBEADJ",72,0)
 .   S $P(RCDATA7,"^",3)=+$P(RCBALANC,"^",3) ; admin
"RTN","RCBEADJ",73,0)
 .   S $P(RCDATA7,"^",4)=+$P(RCBALANC,"^",4) ; marshal fee
"RTN","RCBEADJ",74,0)
 .   S $P(RCDATA7,"^",5)=+$P(RCBALANC,"^",5) ; court cost
"RTN","RCBEADJ",75,0)
 .   S $P(^PRCA(430,RCBILLDA,7),"^",1,5)=$P(RCDATA7,"^",1,5)
"RTN","RCBEADJ",76,0)
 .   ;
"RTN","RCBEADJ",77,0)
 .   W !,"  Balance Discrepancy FIXED!"
"RTN","RCBEADJ",78,0)
 ;
"RTN","RCBEADJ",79,0)
 ;  if the principal balance is zero, do not allow it to be adjusted
"RTN","RCBEADJ",80,0)
 ;  ask to close/cancel it
"RTN","RCBEADJ",81,0)
 I RCBETYPE="DECREASE",'$G(^PRCA(430,RCBILLDA,7)) W !!,"Note: This bill has NO PRINCIPAL BALANCE to decrease !" D INTADMIN(RCBILLDA),UNLOCK Q
"RTN","RCBEADJ",82,0)
 ;
"RTN","RCBEADJ",83,0)
 ;  ask to enter adjustment amount
"RTN","RCBEADJ",84,0)
 S RCAMOUNT=$$AMOUNT(RCBILLDA,RCBETYPE)
"RTN","RCBEADJ",85,0)
 I RCAMOUNT<0 D UNLOCK Q
"RTN","RCBEADJ",86,0)
 ;
"RTN","RCBEADJ",87,0)
 ;  if decrease, make negative
"RTN","RCBEADJ",88,0)
 I RCBETYPE="DECREASE" S RCAMOUNT=-RCAMOUNT
"RTN","RCBEADJ",89,0)
 ;
"RTN","RCBEADJ",90,0)
 ;  ask if it is a contract adjustment
"RTN","RCBEADJ",91,0)
 I RCBETYPE="DECREASE","^9^28^29^30^32^"[("^"_$P($G(^PRCA(430,RCBILLDA,0)),"^",2)_"^") S RCONTADJ=$$ASKCONT I RCONTADJ<0 D UNLOCK Q
"RTN","RCBEADJ",92,0)
 ;
"RTN","RCBEADJ",93,0)
 ;  show what the new transaction will look like
"RTN","RCBEADJ",94,0)
 S RCDATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEADJ",95,0)
 W !!,"If you process the transaction, the bill will look like:"
"RTN","RCBEADJ",96,0)
 W !,"Current Principal Balance: ",$J($P(RCDATA7,"^"),9,2)
"RTN","RCBEADJ",97,0)
 W !,"  NEW ",RCBETYPE," Adjustment: ",$J(RCAMOUNT,9,2)
"RTN","RCBEADJ",98,0)
 W !,"                           ---------"
"RTN","RCBEADJ",99,0)
 W !,"    NEW Principal Balance: ",$J($P(RCDATA7,"^")+RCAMOUNT,9,2)
"RTN","RCBEADJ",100,0)
 ;
"RTN","RCBEADJ",101,0)
 ;  ask to enter transaction
"RTN","RCBEADJ",102,0)
 S Y=$$ASKOK(RCBETYPE) I Y'=1 D UNLOCK Q
"RTN","RCBEADJ",103,0)
 ;
"RTN","RCBEADJ",104,0)
 ;  add adjustment
"RTN","RCBEADJ",105,0)
 S RCTRANDA=$$INCDEC^RCBEUTR1(RCBILLDA,RCAMOUNT,"","","",$G(RCONTADJ))
"RTN","RCBEADJ",106,0)
 I 'RCTRANDA W !,"  *** W A R N I N G: Adjustment NOT Processed! ***" D UNLOCK Q
"RTN","RCBEADJ",107,0)
 I RCTRANDA W !,"  Adjustment Transaction: ",RCTRANDA," has been added."
"RTN","RCBEADJ",108,0)
 I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !!,"   * * * * Transmission will be held until "_Y_" * * * *"
"RTN","RCBEADJ",109,0)
 ;
"RTN","RCBEADJ",110,0)
 ;  ask to enter a comment
"RTN","RCBEADJ",111,0)
 W !!,"Enter a comment for the ",RCBETYPE," Adjustment:"
"RTN","RCBEADJ",112,0)
 S Y=$$EDIT433^RCBEUTRA(RCTRANDA,"41;")
"RTN","RCBEADJ",113,0)
 ;
"RTN","RCBEADJ",114,0)
 ;  ask to exempt interest and admin charges
"RTN","RCBEADJ",115,0)
 I RCBETYPE="DECREASE" D INTADMIN(RCBILLDA)
"RTN","RCBEADJ",116,0)
 ;
"RTN","RCBEADJ",117,0)
 ;  notification of subsequent payer bulletin
"RTN","RCBEADJ",118,0)
 S RCDATA7=$G(^PRCA(430,RCBILLDA,7)),X=0
"RTN","RCBEADJ",119,0)
 F I=1:1:5 S X=X+$P(RCDATA7,"^",I)
"RTN","RCBEADJ",120,0)
 I RCDATA7'="",'X D
"RTN","RCBEADJ",121,0)
 .   N PRCABN,PRCAEN,PRCAMT
"RTN","RCBEADJ",122,0)
 .   S PRCABN=RCBILLDA,PRCAEN=RCTRANDA,PRCAMT=+$P($G(^PRCA(433,RCTRANDA,1)),"^",5)
"RTN","RCBEADJ",123,0)
 .   D EOB^PRCADJ
"RTN","RCBEADJ",124,0)
 ;
"RTN","RCBEADJ",125,0)
 ;  unlock and ask the next bill to adjust
"RTN","RCBEADJ",126,0)
 D UNLOCK
"RTN","RCBEADJ",127,0)
 Q
"RTN","RCBEADJ",128,0)
 ;
"RTN","RCBEADJ",129,0)
 ;
"RTN","RCBEADJ",130,0)
UNLOCK ;  unlock bill and transaction
"RTN","RCBEADJ",131,0)
 L -^PRCA(430,RCBILLDA)
"RTN","RCBEADJ",132,0)
 I $G(RCTRANDA) L -^PRCA(433,RCTRANDA)
"RTN","RCBEADJ",133,0)
 Q
"RTN","RCBEADJ",134,0)
 ;
"RTN","RCBEADJ",135,0)
 ;
"RTN","RCBEADJ",136,0)
INTADMIN(RCBILLDA) ;  ask and adjust the interest and admin
"RTN","RCBEADJ",137,0)
 N RCAMOUNT,RCTRANDA,Y
"RTN","RCBEADJ",138,0)
 ;
"RTN","RCBEADJ",139,0)
 ;  check to see if there is interest and admin charges
"RTN","RCBEADJ",140,0)
 S RCAMOUNT=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCBEADJ",141,0)
 I '$P(RCAMOUNT,"^",2),'$P(RCAMOUNT,"^",3),'$P(RCAMOUNT,"^",4),'$P(RCAMOUNT,"^",5) Q
"RTN","RCBEADJ",142,0)
 ;
"RTN","RCBEADJ",143,0)
 ;  only ask if there is no principal
"RTN","RCBEADJ",144,0)
 I RCAMOUNT Q
"RTN","RCBEADJ",145,0)
 ;
"RTN","RCBEADJ",146,0)
 W !!,"You have the option to automatically EXEMPT the interest"
"RTN","RCBEADJ",147,0)
 W !,"and administrative charges.  This will close the bill."
"RTN","RCBEADJ",148,0)
 S Y=$$ASKEXEMP I Y'=1 Q
"RTN","RCBEADJ",149,0)
 ;
"RTN","RCBEADJ",150,0)
 W !!,"Creating an EXEMPT transaction ..."
"RTN","RCBEADJ",151,0)
 S RCTRANDA=$$EXEMPT^RCBEUTR2(RCBILLDA,$P(RCAMOUNT,"^",2)_"^"_$P(RCAMOUNT,"^",3)_"^^"_$P(RCAMOUNT,"^",4)_"^"_$P(RCAMOUNT,"^",5))
"RTN","RCBEADJ",152,0)
 I 'RCTRANDA W !,"  *** W A R N I N G: EXEMPTION NOT Processed! ***" Q
"RTN","RCBEADJ",153,0)
 I RCTRANDA W !,"   Exempt Transaction: ",RCTRANDA," has been added."
"RTN","RCBEADJ",154,0)
 ;
"RTN","RCBEADJ",155,0)
 W !,"  Current Bill Status: ",$P($G(^PRCA(430.3,+$P($G(^PRCA(430,RCBILLDA,0)),"^",8),0)),"^")
"RTN","RCBEADJ",156,0)
 Q
"RTN","RCBEADJ",157,0)
 ;
"RTN","RCBEADJ",158,0)
 ;
"RTN","RCBEADJ",159,0)
ASKOK(RCBETYPE) ;  ask record decrease or increase transaction
"RTN","RCBEADJ",160,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCBEADJ",161,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","RCBEADJ",162,0)
 S DIR("A")="Are you sure you want to enter this "_RCBETYPE_" adjustment "
"RTN","RCBEADJ",163,0)
 W ! D ^DIR
"RTN","RCBEADJ",164,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",165,0)
 Q Y
"RTN","RCBEADJ",166,0)
 ;
"RTN","RCBEADJ",167,0)
 ;
"RTN","RCBEADJ",168,0)
ASKFIX() ;  ask to fix bill's balance
"RTN","RCBEADJ",169,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCBEADJ",170,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","RCBEADJ",171,0)
 S DIR("A")="  Do you want to FIX the balance discrepancy "
"RTN","RCBEADJ",172,0)
 W ! D ^DIR
"RTN","RCBEADJ",173,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",174,0)
 Q Y
"RTN","RCBEADJ",175,0)
 ;
"RTN","RCBEADJ",176,0)
 ;
"RTN","RCBEADJ",177,0)
ASKEXEMP() ;  ask to record an exempt transaction
"RTN","RCBEADJ",178,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCBEADJ",179,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCBEADJ",180,0)
 S DIR("A")="  Would you like to EXEMPT the interest and admin charges "
"RTN","RCBEADJ",181,0)
 D ^DIR
"RTN","RCBEADJ",182,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",183,0)
 Q Y
"RTN","RCBEADJ",184,0)
 ;
"RTN","RCBEADJ",185,0)
 ;
"RTN","RCBEADJ",186,0)
ASKCONT() ;  ask if contract adjustment
"RTN","RCBEADJ",187,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCBEADJ",188,0)
 S DIR(0)="YO",DIR("B")="YES"
"RTN","RCBEADJ",189,0)
 S DIR("A")="  Is this a CONTRACT adjustment "
"RTN","RCBEADJ",190,0)
 W ! D ^DIR
"RTN","RCBEADJ",191,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",192,0)
 Q Y
"RTN","RCBEADJ",193,0)
 ;
"RTN","RCBEADJ",194,0)
 ;
"RTN","RCBEADJ",195,0)
ADJNUM(RCBILLDA) ;  get next adjustment number for a bill
"RTN","RCBEADJ",196,0)
 N %,ADJUST,DATA1,RCTRANDA
"RTN","RCBEADJ",197,0)
 S RCTRANDA=0
"RTN","RCBEADJ",198,0)
 F  S RCTRANDA=$O(^PRCA(433,"C",RCBILLDA,RCTRANDA)) Q:'RCTRANDA  S DATA1=$G(^PRCA(433,RCTRANDA,1)) I $P(DATA1,"^",4),$P(DATA1,"^",2)=1!($P(DATA1,"^",2)=35) S ADJUST=$P(DATA1,"^",4)+1
"RTN","RCBEADJ",199,0)
 Q ADJUST
"RTN","RCBEADJ",200,0)
 ;
"RTN","RCBEADJ",201,0)
 ;
"RTN","RCBEADJ",202,0)
AMOUNT(RCBILLDA,RCBETYPE) ;  enter the adjustment amount for a bill
"RTN","RCBEADJ",203,0)
 N DIR,DIRUT,DTOUT,DUOUT,PRINBAL,X,Y
"RTN","RCBEADJ",204,0)
 S PRINBAL=+$P($G(^PRCA(430,RCBILLDA,7)),"^")
"RTN","RCBEADJ",205,0)
 I RCBETYPE="INCREASE" S PRINBAL=99999.99
"RTN","RCBEADJ",206,0)
 W !!,"Enter the ",RCBETYPE," Adjustment AMOUNT, from .01 to ",$J(PRINBAL,0,2),"."
"RTN","RCBEADJ",207,0)
 S DIR(0)="NAO^.01:"_PRINBAL_":2"
"RTN","RCBEADJ",208,0)
 S DIR("A")="  "_RCBETYPE_" PRINCIPAL BALANCE BY: "
"RTN","RCBEADJ",209,0)
 D ^DIR
"RTN","RCBEADJ",210,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCBEADJ",211,0)
 Q $S(Y'="":Y,1:-1)
"RTN","RCBEUTRA")
0^15^B29640170
"RTN","RCBEUTRA",1,0)
RCBEUTRA ;WISC/RFJ-utilties for transactions (in file 433)           ;1 Jun 00
"RTN","RCBEUTRA",2,0)
 ;;4.5;Accounts Receivable;**153,169,204**;Mar 20, 1995
"RTN","RCBEUTRA",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCBEUTRA",4,0)
 Q
"RTN","RCBEUTRA",5,0)
 ;
"RTN","RCBEUTRA",6,0)
 ;
"RTN","RCBEUTRA",7,0)
ADD433(BILLDA,TRANTYPE) ;  add a new transaction to file 433 (silent)
"RTN","RCBEUTRA",8,0)
 ;  return: ien of 433 transaction or 0^error msg
"RTN","RCBEUTRA",9,0)
 ;        : ^prca(433,ien) will be locked if entry selected
"RTN","RCBEUTRA",10,0)
 N %I,DA,DATA0,DD,DIC,DICR,DIE,DINUM,DIW,DLAYGO,DO,I,RCTRANDA,REFCODE,X,Y
"RTN","RCBEUTRA",11,0)
 ;
"RTN","RCBEUTRA",12,0)
 ;  find next available transaction number
"RTN","RCBEUTRA",13,0)
 ;  add an extra level of locks, some operating systems do not process
"RTN","RCBEUTRA",14,0)
 ;  the locks correctly if they happen at the same time.
"RTN","RCBEUTRA",15,0)
 L +^PRCA(433,"ADDNEWENTRY")
"RTN","RCBEUTRA",16,0)
 ;  start with last entry in file
"RTN","RCBEUTRA",17,0)
 ;    -> if no data is in the entry, lock it
"RTN","RCBEUTRA",18,0)
 ;       -> if the lock works and no data was added (prior to the lock)
"RTN","RCBEUTRA",19,0)
 ;          -> then you have the entry.
"RTN","RCBEUTRA",20,0)
 ;          -> otherwise, unlock it and start over
"RTN","RCBEUTRA",21,0)
 F DINUM=$P(^PRCA(433,0),"^",3)+1:1 I '$D(^PRCA(433,DINUM)) L +^PRCA(433,DINUM):1 Q:$T&('$D(^PRCA(433,DINUM)))  L -^PRCA(433,DINUM)
"RTN","RCBEUTRA",22,0)
 L -^PRCA(433,"ADDNEWENTRY")
"RTN","RCBEUTRA",23,0)
 ;
"RTN","RCBEUTRA",24,0)
 ;  add entry to file
"RTN","RCBEUTRA",25,0)
 S RCTRANDA=DINUM,(DIC,DIE)="^PRCA(433,",DIC(0)="L",DLAYGO=433,X=DINUM
"RTN","RCBEUTRA",26,0)
 ;  build DR string, 42=processed by (use postmaster if queued)
"RTN","RCBEUTRA",27,0)
 S DIC("DR")="42////"_$S($D(ZTQUEUED):.5,1:DUZ)_";"
"RTN","RCBEUTRA",28,0)
 S DIC("DR")=DIC("DR")_".03////"_BILLDA_";"  ;bill ien
"RTN","RCBEUTRA",29,0)
 S DIC("DR")=DIC("DR")_"12////"_TRANTYPE_";" ;transaction type
"RTN","RCBEUTRA",30,0)
 S DATA0=$G(^PRCA(430,BILLDA,0))
"RTN","RCBEUTRA",31,0)
 ;  appropriation symbol
"RTN","RCBEUTRA",32,0)
 I $P(DATA0,"^",18)'="" S DIC("DR")=DIC("DR")_"8////"_$P(DATA0,"^",18)_";"
"RTN","RCBEUTRA",33,0)
 ;  segment
"RTN","RCBEUTRA",34,0)
 I $P(DATA0,"^",21)'="" S DIC("DR")=DIC("DR")_"6////"_$P(DATA0,"^",21)_";"
"RTN","RCBEUTRA",35,0)
 ;  test for referral code
"RTN","RCBEUTRA",36,0)
 S REFCODE=$P($G(^PRCA(430,BILLDA,6)),"^",5)
"RTN","RCBEUTRA",37,0)
 I REFCODE'="" S REFCODE=$S(REFCODE="DC":"RC",1:REFCODE),DIC("DR")=DIC("DR")_"7////"_REFCODE_";"
"RTN","RCBEUTRA",38,0)
 ;  file it
"RTN","RCBEUTRA",39,0)
 D FILE^DICN
"RTN","RCBEUTRA",40,0)
 I Y=-1 L -^PRCA(433,RCTRANDA) Q "0^UNABLE TO ADD A NEW ENTRY TO FILE 433"
"RTN","RCBEUTRA",41,0)
 Q RCTRANDA
"RTN","RCBEUTRA",42,0)
 ;
"RTN","RCBEUTRA",43,0)
 ;
"RTN","RCBEUTRA",44,0)
FY433(RCTRANDA) ;  transfer fiscal year multiple from 430 to 433
"RTN","RCBEUTRA",45,0)
 ;  bill number must be stored in file 433, field .03 before calling
"RTN","RCBEUTRA",46,0)
 N BILLDA,FY,FYDATA
"RTN","RCBEUTRA",47,0)
 S BILLDA=+$P($G(^PRCA(433,RCTRANDA,0)),"^",2) I 'BILLDA Q
"RTN","RCBEUTRA",48,0)
 K ^PRCA(433,RCTRANDA,4)
"RTN","RCBEUTRA",49,0)
 S FY=0 F  S FY=$O(^PRCA(430,BILLDA,2,FY)) Q:'FY  D
"RTN","RCBEUTRA",50,0)
 .   S FYDATA=$G(^PRCA(430,BILLDA,2,FY,0)) I $P(FYDATA,"^")="" Q
"RTN","RCBEUTRA",51,0)
 .   S ^PRCA(433,RCTRANDA,4,FY,0)=$P(FYDATA,"^",1,3)_"^1"
"RTN","RCBEUTRA",52,0)
 .   S ^PRCA(433,RCTRANDA,4,"B",$P(FYDATA,"^"),FY)=""
"RTN","RCBEUTRA",53,0)
 ;
"RTN","RCBEUTRA",54,0)
 S ^PRCA(433,RCTRANDA,4,0)="^433.01I^"_$P($G(^PRCA(430,BILLDA,2,0)),"^",3,4)
"RTN","RCBEUTRA",55,0)
 Q
"RTN","RCBEUTRA",56,0)
 ;
"RTN","RCBEUTRA",57,0)
 ;
"RTN","RCBEUTRA",58,0)
FYMULT(RCTRANDA) ;  apply payment to fy multiple, oldest first
"RTN","RCBEUTRA",59,0)
 N AMOUNT,FYDA,FYAMOUNT
"RTN","RCBEUTRA",60,0)
 ;  transfer fy multiple if not there
"RTN","RCBEUTRA",61,0)
 I '$D(^PRCA(433,RCTRANDA,4)) D FY433(RCTRANDA)
"RTN","RCBEUTRA",62,0)
 ;  amount is principal amount
"RTN","RCBEUTRA",63,0)
 S AMOUNT=$P($$TRANVALU^RCDPBTLM(RCTRANDA),"^",2) I 'AMOUNT Q
"RTN","RCBEUTRA",64,0)
 ;
"RTN","RCBEUTRA",65,0)
 ;  the transaction value is minus, decrease principal
"RTN","RCBEUTRA",66,0)
 I AMOUNT<0 D  Q
"RTN","RCBEUTRA",67,0)
 .   S AMOUNT=-AMOUNT
"RTN","RCBEUTRA",68,0)
 .   S FYDA=0 F  S FYDA=$O(^PRCA(433,RCTRANDA,4,FYDA)) Q:'FYDA  D  I 'AMOUNT Q
"RTN","RCBEUTRA",69,0)
 .   .   S FYAMOUNT=$P($G(^PRCA(433,RCTRANDA,4,FYDA,0)),"^",2)
"RTN","RCBEUTRA",70,0)
 .   .   ;  fy amount is greater than transaction amount
"RTN","RCBEUTRA",71,0)
 .   .   I FYAMOUNT>AMOUNT D  Q
"RTN","RCBEUTRA",72,0)
 .   .   .   S $P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",2)=FYAMOUNT-AMOUNT
"RTN","RCBEUTRA",73,0)
 .   .   .   S $P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",5)=AMOUNT
"RTN","RCBEUTRA",74,0)
 .   .   .   S AMOUNT=0
"RTN","RCBEUTRA",75,0)
 .   .   ;  fy amount not greater than total amount
"RTN","RCBEUTRA",76,0)
 .   .   S $P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",2)=0
"RTN","RCBEUTRA",77,0)
 .   .   S $P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",5)=FYAMOUNT
"RTN","RCBEUTRA",78,0)
 .   .   S AMOUNT=AMOUNT-FYAMOUNT
"RTN","RCBEUTRA",79,0)
 .   ;  move back to 430
"RTN","RCBEUTRA",80,0)
 .   D FYMULT^RCBEUBIL(RCTRANDA)
"RTN","RCBEUTRA",81,0)
 ;
"RTN","RCBEUTRA",82,0)
 ;  the transaction value is plus, increase principal
"RTN","RCBEUTRA",83,0)
 S FYDA=$O(^PRCA(433,RCTRANDA,4,999),-1) I 'FYDA Q
"RTN","RCBEUTRA",84,0)
 S $P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",2)=$P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",2)+AMOUNT
"RTN","RCBEUTRA",85,0)
 S $P(^PRCA(433,RCTRANDA,4,FYDA,0),"^",5)=AMOUNT
"RTN","RCBEUTRA",86,0)
 ;  move back to 430
"RTN","RCBEUTRA",87,0)
 D FYMULT^RCBEUBIL(RCTRANDA)
"RTN","RCBEUTRA",88,0)
 Q
"RTN","RCBEUTRA",89,0)
 ;
"RTN","RCBEUTRA",90,0)
 ;
"RTN","RCBEUTRA",91,0)
EDIT433(RCTRANDA,DR) ;  edit the field in 433 with the DR string passed
"RTN","RCBEUTRA",92,0)
 I '$D(^PRCA(433,RCTRANDA)) Q
"RTN","RCBEUTRA",93,0)
 N %,D,D0,D1,DA,DDH,DI,DIC,DIE,DQ,J,X,Y
"RTN","RCBEUTRA",94,0)
 S (DIC,DIE)="^PRCA(433,",DA=RCTRANDA
"RTN","RCBEUTRA",95,0)
 D ^DIE
"RTN","RCBEUTRA",96,0)
 ;  user pressed up-arrow
"RTN","RCBEUTRA",97,0)
 I $D(Y) Q "0^TRANSACTION NOT COMPLETELY PROCESSED"
"RTN","RCBEUTRA",98,0)
 Q 1
"RTN","RCBEUTRA",99,0)
 ;
"RTN","RCBEUTRA",100,0)
 ;
"RTN","RCBEUTRA",101,0)
PROCESS(RCTRANDA) ;  mark transaction as processed
"RTN","RCBEUTRA",102,0)
 I '$D(^PRCA(433,RCTRANDA,0)) Q
"RTN","RCBEUTRA",103,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCBEUTRA",104,0)
 S (DIC,DIE)="^PRCA(433,",DA=RCTRANDA
"RTN","RCBEUTRA",105,0)
 S DR="3////0;4////2;"
"RTN","RCBEUTRA",106,0)
 D ^DIE
"RTN","RCBEUTRA",107,0)
 Q
"RTN","RCBEUTRA",108,0)
 ;
"RTN","RCBEUTRA",109,0)
 ;
"RTN","RCBEUTRA",110,0)
INCOMPLE(RCTRANDA) ;  opposite of processed, make a transaction incomplete
"RTN","RCBEUTRA",111,0)
 I '$D(^PRCA(433,RCTRANDA,0)) Q
"RTN","RCBEUTRA",112,0)
 N D,D0,DA,DI,DIC,DIE,DQ,DR,X,Y
"RTN","RCBEUTRA",113,0)
 S (DIC,DIE)="^PRCA(433,",DA=RCTRANDA
"RTN","RCBEUTRA",114,0)
 S DR="4////1;"
"RTN","RCBEUTRA",115,0)
 D ^DIE
"RTN","RCBEUTRA",116,0)
 Q
"RTN","RCBEUTRA",117,0)
 ;
"RTN","RCBEUTRA",118,0)
 ;
"RTN","RCBEUTRA",119,0)
DEL433(RCTRANDA,COMMENT,ARCHIVE) ;  delete (mark incomplete) in file 433
"RTN","RCBEUTRA",120,0)
 ;  comment is the user comment in field 41 (default USER CANCELLED)
"RTN","RCBEUTRA",121,0)
 ;  archive is set to 1 if called to archive transaction
"RTN","RCBEUTRA",122,0)
 I '$D(^PRCA(433,RCTRANDA,0)) Q
"RTN","RCBEUTRA",123,0)
 N %,D,D0,DA,DI,DIC,DIE,DQ,DR,J,RCBILLDA,X,Y
"RTN","RCBEUTRA",124,0)
 ;
"RTN","RCBEUTRA",125,0)
 S (DIC,DIE)="^PRCA(433,",DA=RCTRANDA
"RTN","RCBEUTRA",126,0)
 ;  build DR string
"RTN","RCBEUTRA",127,0)
 S DR=""
"RTN","RCBEUTRA",128,0)
 S DR=DR_"4////1;"  ;transaction status incomplete
"RTN","RCBEUTRA",129,0)
 S DR=DR_"10////1;" ;incomplete transaction flag
"RTN","RCBEUTRA",130,0)
 S DR=DR_"11///T;"  ;transaction date
"RTN","RCBEUTRA",131,0)
 I $G(COMMENT)="" S COMMENT="USER CANCELLED"
"RTN","RCBEUTRA",132,0)
 S DR=DR_"41///"_COMMENT_";"
"RTN","RCBEUTRA",133,0)
 ;  brief comment
"RTN","RCBEUTRA",134,0)
 S RCBILLDA=$P($G(^PRCA(433,RCTRANDA,0)),"^",2)
"RTN","RCBEUTRA",135,0)
 S DR=DR_"5.02////SYSTEM "_$S($G(ARCHIVE):"ARCHIVED",1:"INACTIVATED")_$S(RCBILLDA:" (BILL "_$P($G(^PRCA(430,RCBILLDA,0)),"^")_")",1:"")_";"
"RTN","RCBEUTRA",136,0)
 D ^DIE
"RTN","RCBEUTRA",137,0)
 ;  since the bill number (field .03) is required, it must be manually removed
"RTN","RCBEUTRA",138,0)
 I RCBILLDA S $P(^PRCA(433,RCTRANDA,0),"^",2)="" K ^PRCA(433,"C",RCBILLDA,RCTRANDA)
"RTN","RCBEUTRA",139,0)
 ;  remove fy multiple
"RTN","RCBEUTRA",140,0)
 K ^PRCA(433,RCTRANDA,4)
"RTN","RCBEUTRA",141,0)
 Q
"RTN","RCBEUTRA",142,0)
 ;
"RTN","RCBEUTRA",143,0)
 ;
"RTN","RCBEUTRA",144,0)
ADDCOMM(RCTRANDA,COMMENT) ;  automatically put a comment on a transaction
"RTN","RCBEUTRA",145,0)
 ;  comment in the array comment(1)=first line
"RTN","RCBEUTRA",146,0)
 ;                       comment(2)=second line
"RTN","RCBEUTRA",147,0)
 N CURRLINE,LINE
"RTN","RCBEUTRA",148,0)
 ;  get the last line
"RTN","RCBEUTRA",149,0)
 S CURRLINE=$O(^PRCA(433,RCTRANDA,7,99999999),-1)
"RTN","RCBEUTRA",150,0)
 ;  if comment already on transaction, add a blank line and
"RTN","RCBEUTRA",151,0)
 ;  date time of new comment
"RTN","RCBEUTRA",152,0)
 I CURRLINE D
"RTN","RCBEUTRA",153,0)
 .   S CURRLINE=CURRLINE+1,^PRCA(433,RCTRANDA,7,CURRLINE,0)=" "
"RTN","RCBEUTRA",154,0)
 .   S CURRLINE=CURRLINE+1,^PRCA(433,RCTRANDA,7,CURRLINE,0)="Comment added on: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","RCBEUTRA",155,0)
 ;  add new lines
"RTN","RCBEUTRA",156,0)
 F LINE=1:1 Q:'$D(COMMENT(LINE))  S ^PRCA(433,RCTRANDA,7,CURRLINE+LINE,0)=COMMENT(LINE)
"RTN","RCBEUTRA",157,0)
 ;  set the 0th node
"RTN","RCBEUTRA",158,0)
 S ^PRCA(433,RCTRANDA,7,0)="^^"_(CURRLINE+LINE-1)_"^"_(CURRLINE+LINE-1)_"^"_DT_"^"
"RTN","RCBEUTRA",159,0)
 Q
"RTN","RCBEUTRA",160,0)
FMSDATE(X) ;Finds the next month & year and sets the date for transmission
"RTN","RCBEUTRA",161,0)
 ;of the document to FMS.  If DT is after EOAM and the document has not
"RTN","RCBEUTRA",162,0)
 ;been previously transmitted, the date will be set to the first of the
"RTN","RCBEUTRA",163,0)
 ;next month.  If the DT is after the EOAM and the document is being 
"RTN","RCBEUTRA",164,0)
 ;re-transmitted, the the date of transmission will be DT. The flag REGEN
"RTN","RCBEUTRA",165,0)
 ;is set in the source code if the document is being 
"RTN","RCBEUTRA",166,0)
 ;re-transmitted, thus will have a transmission date of DT.
"RTN","RCBEUTRA",167,0)
 I $G(REFMS) G QUIT
"RTN","RCBEUTRA",168,0)
 I DT>$$LDATE^RCRJR(DT) S X=$E($$FPS^RCAMFN01(X,1),1,5)_"01"
"RTN","RCBEUTRA",169,0)
QUIT Q X
"RTN","RCDPURE1")
0^3^B21522658
"RTN","RCDPURE1",1,0)
RCDPURE1 ;WISC/RFJ-process a receipt ;1 Jun 99
"RTN","RCDPURE1",2,0)
 ;;4.5;Accounts Receivable;**114,148,153,169,204**;Mar 20, 1995
"RTN","RCDPURE1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCDPURE1",4,0)
 Q
"RTN","RCDPURE1",5,0)
 ;
"RTN","RCDPURE1",6,0)
 ;
"RTN","RCDPURE1",7,0)
PROCESS(RCRECTDA,RCSCREEN) ;  process a receipt, update ar, generate cr documents to fms
"RTN","RCDPURE1",8,0)
 ;  the receipt and deposit must be locked before calling this label
"RTN","RCDPURE1",9,0)
 ;  if $g(rcscreen) show messages during processing
"RTN","RCDPURE1",10,0)
 N RCPAYDA,RCDPFPAY,RCERROR
"RTN","RCDPURE1",11,0)
 ;
"RTN","RCDPURE1",12,0)
 ;  first mark the receipt as processed/closed to prevent changing the
"RTN","RCDPURE1",13,0)
 ;  data if the receipt does not fully process.  this will lock the
"RTN","RCDPURE1",14,0)
 ;  cancel payment, edit payment, etc. options.  once a receipt is
"RTN","RCDPURE1",15,0)
 ;  processed, even partially, it should not be changed.
"RTN","RCDPURE1",16,0)
 D MARKPROC^RCDPUREC(RCRECTDA,"")
"RTN","RCDPURE1",17,0)
 ;
"RTN","RCDPURE1",18,0)
 ;  === no payments ===
"RTN","RCDPURE1",19,0)
 ;  if there are no payments for the receipt, quit
"RTN","RCDPURE1",20,0)
 I '$O(^RCY(344,RCRECTDA,1,0)) D  Q
"RTN","RCDPURE1",21,0)
 .   I $G(RCSCREEN) W !!,"Receipt does not have any payments and has been marked as processed/closed."
"RTN","RCDPURE1",22,0)
 ;
"RTN","RCDPURE1",23,0)
 ;  check to see if the payments have dollar amounts
"RTN","RCDPURE1",24,0)
 S RCPAYDA=0 F  S RCPAYDA=$O(^RCY(344,RCRECTDA,1,RCPAYDA)) Q:'RCPAYDA  I $P($G(^(RCPAYDA,0)),"^",4) S RCDPFPAY=1 Q
"RTN","RCDPURE1",25,0)
 I '$G(RCDPFPAY) D  Q
"RTN","RCDPURE1",26,0)
 .   I $G(RCSCREEN) W !!,"Receipt does not have any payments and has been marked as processed/closed."
"RTN","RCDPURE1",27,0)
 ;
"RTN","RCDPURE1",28,0)
 ;  === update AR accounts ===
"RTN","RCDPURE1",29,0)
 I $G(RCSCREEN) W !!,"Updating AR accounts..."
"RTN","RCDPURE1",30,0)
 ;
"RTN","RCDPURE1",31,0)
 ;  loop payments and apply to account in AR
"RTN","RCDPURE1",32,0)
 S RCPAYDA=0 F  S RCPAYDA=$O(^RCY(344,RCRECTDA,1,RCPAYDA)) Q:'RCPAYDA  D  I RCERROR Q
"RTN","RCDPURE1",33,0)
 .   S RCERROR=$$PROCESS^RCBEPAY(RCRECTDA,RCPAYDA)
"RTN","RCDPURE1",34,0)
 ;
"RTN","RCDPURE1",35,0)
 ;  an error occurred during processing a payment
"RTN","RCDPURE1",36,0)
 I $G(RCERROR) D  Q
"RTN","RCDPURE1",37,0)
 .   I '$G(RCSCREEN) Q
"RTN","RCDPURE1",38,0)
 .   W !
"RTN","RCDPURE1",39,0)
 .   W !,"+-----------------------------------------------------------------------------+"
"RTN","RCDPURE1",40,0)
 .   W !,"|  An ERROR has occurred when processing payment ",RCPAYDA," on receipt ",$P(^RCY(344,RCRECTDA,0),"^"),".",?78,"|"
"RTN","RCDPURE1",41,0)
 .   W !,"|  The error message returned during processing is:",?78,"|"
"RTN","RCDPURE1",42,0)
 .   W !,"|",?78,"|"
"RTN","RCDPURE1",43,0)
 .   W !,"|  ",$P(RCERROR,"^",2),?78,"|"
"RTN","RCDPURE1",44,0)
 .   W !,"|",?78,"|"
"RTN","RCDPURE1",45,0)
 .   W !,"|  You will need to correct the error before you can completely process the",?78,"|"
"RTN","RCDPURE1",46,0)
 .   W !,"|  receipt.  Once the receipt is completely processed, the FMS Cash Receipt",?78,"|"
"RTN","RCDPURE1",47,0)
 .   W !,"|  document will be generated.",?78,"|"
"RTN","RCDPURE1",48,0)
 .   W !,"+-----------------------------------------------------------------------------+"
"RTN","RCDPURE1",49,0)
 ;
"RTN","RCDPURE1",50,0)
 ;  all payments processed correctly
"RTN","RCDPURE1",51,0)
 I $G(RCSCREEN) W " Done."
"RTN","RCDPURE1",52,0)
 ;
"RTN","RCDPURE1",53,0)
 ;  if there is not a deposit ticket, do not send to fms
"RTN","RCDPURE1",54,0)
 I '$P(^RCY(344,RCRECTDA,0),"^",6) D  Q
"RTN","RCDPURE1",55,0)
 .   D 215
"RTN","RCDPURE1",56,0)
 .   I $G(RCSCREEN) W !!,"Receipt does not have a deposit ticket and will NOT be sent to FMS."
"RTN","RCDPURE1",57,0)
 ;
"RTN","RCDPURE1",58,0)
 ;  === send fms cash receipt document ===
"RTN","RCDPURE1",59,0)
 N GECSDATA,FMSDOCNO,RESULT,REFMS
"RTN","RCDPURE1",60,0)
 ;  lookup fms document number to see if the receipt has been
"RTN","RCDPURE1",61,0)
 ;  sent to fms (field 200 in file 344)
"RTN","RCDPURE1",62,0)
 S FMSDOCNO=$P($G(^RCY(344,RCRECTDA,2)),"^")
"RTN","RCDPURE1",63,0)
 ;  if there is an entry, find the code sheet in gcs to rebuild
"RTN","RCDPURE1",64,0)
 ;  gecsdata will be the ien for file 2100.1
"RTN","RCDPURE1",65,0)
 I FMSDOCNO'="" S REFMS=1 N DIQ2 D DATA^GECSSGET(FMSDOCNO,0)
"RTN","RCDPURE1",66,0)
 ;I $G(RCSCREEN) W !! W:$G(GECSDATA) "Re-" W "Transmitting CR document to FMS... "
"RTN","RCDPURE1",67,0)
 I $G(RCSCREEN)&$G(GECSDATA) S RCMSG="Re-Transmitting CR document to FMS... " D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",68,0)
 I $G(RCSCREEN)&'$G(GECSDATA) S RCMSG="Transmitting CR document to FMS... " D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",69,0)
 ;
"RTN","RCDPURE1",70,0)
 ;  build and send the document to fms
"RTN","RCDPURE1",71,0)
 S RESULT=$$BUILDCR^RCXFMSCR(RCRECTDA,+$G(GECSDATA))
"RTN","RCDPURE1",72,0)
 ;  error in building code sheet
"RTN","RCDPURE1",73,0)
 I 'RESULT W:$G(RCSCREEN) !!,"ERROR - ",$P(RESULT,"^",2) Q
"RTN","RCDPURE1",74,0)
 ;
"RTN","RCDPURE1",75,0)
 ;  no document to send
"RTN","RCDPURE1",76,0)
 I $P(RESULT,"^")=-1,$G(RCSCREEN) W !!,"NOTE - ",$P(RESULT,"^",2) S $P(RESULT,"^",2)=""
"RTN","RCDPURE1",77,0)
 ;  document built and sent
"RTN","RCDPURE1",78,0)
 I $P(RESULT,"^")=1,$G(RCSCREEN) S RCMSG="Done. FMS document number "_$P(RESULT,"^",2) D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",79,0)
 I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !! S RCMSG="   * * * * Transmission will be held until "_Y_" * * * *" D MSG(RCMSG,RCSCREEN,"!!")
"RTN","RCDPURE1",80,0)
 ;
"RTN","RCDPURE1",81,0)
 ;
"RTN","RCDPURE1",82,0)
 ;  store the fms document number (receipt already marked processed/
"RTN","RCDPURE1",83,0)
 ;  closed at the top of the routine just before posting the dollars.
"RTN","RCDPURE1",84,0)
 D MARKPROC^RCDPUREC(RCRECTDA,$P(RESULT,"^",2))
"RTN","RCDPURE1",85,0)
 ;
"RTN","RCDPURE1",86,0)
 ;
"RTN","RCDPURE1",87,0)
215 ;  === print 215 report ===
"RTN","RCDPURE1",88,0)
 I $G(RCSCREEN) W !!,"Queuing 215 report..."
"RTN","RCDPURE1",89,0)
 N DEVICE
"RTN","RCDPURE1",90,0)
 S DEVICE=$G(^DISV(DUZ,"RCDPRPLM","215REPORT"))
"RTN","RCDPURE1",91,0)
 I DEVICE="" W:$G(RCSCREEN) " Use Customize Option to set up the default printer." Q
"RTN","RCDPURE1",92,0)
 ;
"RTN","RCDPURE1",93,0)
 S ZTIO=DEVICE,ZTDTH=$H,ZTRTN="DQ^RCDPR215",ZTSAVE("RECEIPDA")=RCRECTDA,ZTSAVE("RCTYPE")="A"
"RTN","RCDPURE1",94,0)
 D ^%ZTLOAD,^%ZISC
"RTN","RCDPURE1",95,0)
 I $G(RCSCREEN) W " Done."
"RTN","RCDPURE1",96,0)
 Q
"RTN","RCDPURE1",97,0)
MSG(RCMSG,RCSCREEN,PRELINE,POSTLINE) ; Write message or set into msg array
"RTN","RCDPURE1",98,0)
 ; RCMSG = text to write  RCSCREEN = screen flag
"RTN","RCDPURE1",99,0)
 ; PRELINE = the line feeds to print before the text
"RTN","RCDPURE1",100,0)
 ; POSTLINE = the line feeds to print after the text
"RTN","RCDPURE1",101,0)
 N RCPRE,RCPOST,Z
"RTN","RCDPURE1",102,0)
 S RCPRE=$L($G(PRELINE),"!")-1,RCPOST=$L($G(POSTLINE),"!")-1
"RTN","RCDPURE1",103,0)
 I RCSCREEN=1 D  G MSGQ
"RTN","RCDPURE1",104,0)
 . F Z=1:1:RCPRE W !
"RTN","RCDPURE1",105,0)
 . W RCMSG
"RTN","RCDPURE1",106,0)
 . F Z=1:1:RCPOST W !
"RTN","RCDPURE1",107,0)
 F Z=1:1:RCPRE S ^TMP($J,"RCDPEMSG",+$O(^TMP("RCDPEMSG",""),-1)+1)=""
"RTN","RCDPURE1",108,0)
 S ^TMP($J,"RCDPEMSG",+$O(^TMP("RCDPEMSG",""),-1)+1)=RCMSG
"RTN","RCDPURE1",109,0)
 F Z=1:1:RCPOST S ^TMP($J,"RCDPEMSG",+$O(^TMP("RCDPEMSG",""),-1)+1)=""
"RTN","RCDPURE1",110,0)
MSGQ Q
"RTN","RCFMFN02")
0^1^B9211943
"RTN","RCFMFN02",1,0)
RCFMFN02 ;WASH-ISC@ATLOONA,PA/RGY-Return information for FMS Document processing ;8/27/94  8:40 PM
"RTN","RCFMFN02",2,0)
V ;;4.5;Accounts Receivable;**114,204**;Mar 20, 1995
"RTN","RCFMFN02",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCFMFN02",4,0)
DEL(ID) ;Delete entry from DOCUMENT file (347)
"RTN","RCFMFN02",5,0)
 NEW DA
"RTN","RCFMFN02",6,0)
 I '$D(ID) Q
"RTN","RCFMFN02",7,0)
 S DA=+$O(^RC(347,"C",ID,0)) S:'DA DA=+$O(^RC(347,"D",ID,0))
"RTN","RCFMFN02",8,0)
 I '$D(^RC(347,DA,0)) Q
"RTN","RCFMFN02",9,0)
 D DEL^RCFMPUR(DA)
"RTN","RCFMFN02",10,0)
 Q
"RTN","RCFMFN02",11,0)
SSTAT(ID,STAT) ;Set status for DOCUMENT file (347)
"RTN","RCFMFN02",12,0)
 NEW %DT,D,D0,DA,DI,DIC,DIE,DQ,DR,X
"RTN","RCFMFN02",13,0)
 I '$D(ID) Q
"RTN","RCFMFN02",14,0)
 S DA=+$O(^RC(347,"C",ID,0)) S:'DA DA=+$O(^RC(347,"D",ID,0))
"RTN","RCFMFN02",15,0)
 I '$D(^RC(347,DA,0)) Q
"RTN","RCFMFN02",16,0)
 I ",0,1,2,3,"'[(","_$G(STAT)_",") Q
"RTN","RCFMFN02",17,0)
 S DIE="^RC(347,",DR=".05///^S X=""NOW"";.03////^S X="_STAT D ^DIE
"RTN","RCFMFN02",18,0)
 ;Update the FMS TRAMSISSION DATE in files 430 and 347
"RTN","RCFMFN02",19,0)
 S FMSDT=$S($G(FMSDT):FMSDT,1:DT)
"RTN","RCFMFN02",20,0)
 ;DA is already set above
"RTN","RCFMFN02",21,0)
 I $D(^RC(347,DA,2)) K ^RC(347,"FMS",^RC(347,DA,2),DA)
"RTN","RCFMFN02",22,0)
 S ^RC(347,DA,2)=FMSDT,^RC(347,"FMS",FMSDT,DA)=""
"RTN","RCFMFN02",23,0)
 ;need to set DA for file 430... from the AR Bill number from file 347.
"RTN","RCFMFN02",24,0)
 S DA=$P($G(^RC(347,DA,0)),"^",7) I DA D
"RTN","RCFMFN02",25,0)
 .I $D(^PRCA(430,DA,203)) K ^PRCA(430,"FMS",^PRCA(430,DA,203),DA)
"RTN","RCFMFN02",26,0)
 .S ^PRCA(430,DA,203)=FMSDT,^PRCA(430,"FMS",FMSDT,DA)=""
"RTN","RCFMFN02",27,0)
 Q
"RTN","RCFMFN02",28,0)
GSTAT(ID) ;Get status for DOCUMENT file (347)
"RTN","RCFMFN02",29,0)
 NEW DA
"RTN","RCFMFN02",30,0)
 I '$D(ID) Q -1
"RTN","RCFMFN02",31,0)
 S DA=+$O(^RC(347,"C",ID,0)) S:'DA DA=+$O(^RC(347,"D",ID,0))
"RTN","RCFMFN02",32,0)
 I '$D(^RC(347,DA,0)) Q -1
"RTN","RCFMFN02",33,0)
 Q $P(^RC(347,DA,0),"^",3)
"RTN","RCFMFN02",34,0)
RETN(ID,ST) ;Process return document from stacker
"RTN","RCFMFN02",35,0)
 NEW DA
"RTN","RCFMFN02",36,0)
 I '$D(ID) Q
"RTN","RCFMFN02",37,0)
 ;line removed to accomodate full fms doc number - CLH
"RTN","RCFMFN02",38,0)
 S ST=$G(ST),ST=$S(ST="A":2,ST="R":3,1:-1)
"RTN","RCFMFN02",39,0)
 I ST<0 Q
"RTN","RCFMFN02",40,0)
 ;  if a CR document and it rejects, send message to users
"RTN","RCFMFN02",41,0)
 I $E(ID,1,3)="CR-",ST=3 D MAILREJ(ID)
"RTN","RCFMFN02",42,0)
 D SSTAT(ID,ST)
"RTN","RCFMFN02",43,0)
 Q
"RTN","RCFMFN02",44,0)
STSTAT(DA,ST) ;set processed status in 433 (used for summary docs)
"RTN","RCFMFN02",45,0)
 Q:'$D(DA)
"RTN","RCFMFN02",46,0)
 Q:'$D(ST)
"RTN","RCFMFN02",47,0)
 Q:'$D(^PRCA(433,DA,0))
"RTN","RCFMFN02",48,0)
 N DIE,DR
"RTN","RCFMFN02",49,0)
 S DIE="^PRCA(433,",DR="91///^S X="_ST D ^DIE
"RTN","RCFMFN02",50,0)
 Q
"RTN","RCFMFN02",51,0)
GTSTAT(DA) ;function to return transaction status
"RTN","RCFMFN02",52,0)
 I DA<0 Q -1
"RTN","RCFMFN02",53,0)
 I '$D(^PRCA(433,DA,8)) Q -1
"RTN","RCFMFN02",54,0)
 Q $P(^PRCA(433,DA,0),U,9)
"RTN","RCFMFN02",55,0)
 ;
"RTN","RCFMFN02",56,0)
 ;
"RTN","RCFMFN02",57,0)
MAILREJ(DOCUMENT) ;  mail reject message to user to ask for retransmission
"RTN","RCFMFN02",58,0)
 N MESSAGE,RECEIPT,XCNP,XMDUZ,XMZ
"RTN","RCFMFN02",59,0)
 S MESSAGE(1)="The following "_$E(DOCUMENT,1,2)_" FMS document rejected and needs to be retransmitted."
"RTN","RCFMFN02",60,0)
 S MESSAGE(2)=" "
"RTN","RCFMFN02",61,0)
 S MESSAGE(3)="        Document: "_DOCUMENT
"RTN","RCFMFN02",62,0)
 S MESSAGE(4)=" "
"RTN","RCFMFN02",63,0)
 ;  show information for cash receipt document
"RTN","RCFMFN02",64,0)
 I $E(DOCUMENT,1,2)="CR" D
"RTN","RCFMFN02",65,0)
 .   S MESSAGE(5)="You may regenerate this cash receipt document by selecting the"
"RTN","RCFMFN02",66,0)
 .   S MESSAGE(6)="option Process Receipt (PR) located under the Receipt Processing"
"RTN","RCFMFN02",67,0)
 .   S MESSAGE(7)="Listmanager screen."
"RTN","RCFMFN02",68,0)
 .   S RECEIPT=$P($G(^RCY(344,+$O(^RCY(344,"ADOC",DOCUMENT,0)),0)),"^")
"RTN","RCFMFN02",69,0)
 .   I RECEIPT'="" S MESSAGE(8)=" ",MESSAGE(9)="  This cash receipt document was generated by receipt "_RECEIPT_"."
"RTN","RCFMFN02",70,0)
 ;
"RTN","RCFMFN02",71,0)
 S XMTEXT="MESSAGE("
"RTN","RCFMFN02",72,0)
 S XMSUB="FMS Cash Receipt Document Rejected"
"RTN","RCFMFN02",73,0)
 S XMDUZ="AR Package",XMY("G.RCDP PAYMENTS")=""
"RTN","RCFMFN02",74,0)
 D ^XMD
"RTN","RCFMFN02",75,0)
 Q
"RTN","RCWROFF")
0^11^B30058500
"RTN","RCWROFF",1,0)
RCWROFF ;WISC/RFJ-write off, terminated ;1 Feb 2000
"RTN","RCWROFF",2,0)
 ;;4.5;Accounts Receivable;**168,204**;Mar 20, 1995
"RTN","RCWROFF",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCWROFF",4,0)
 Q
"RTN","RCWROFF",5,0)
 ;
"RTN","RCWROFF",6,0)
 ;
"RTN","RCWROFF",7,0)
8 ;  terminated by fiscal officer (trantype=8) (menu option)
"RTN","RCWROFF",8,0)
 N RCDRSTRG
"RTN","RCWROFF",9,0)
 S RCDRSTRG="11TERMINATION DATE;"
"RTN","RCWROFF",10,0)
 S RCDRSTRG=RCDRSTRG_"17;"  ;termination reason
"RTN","RCWROFF",11,0)
 D MAIN("8^Fiscal Officer Termination",RCDRSTRG)
"RTN","RCWROFF",12,0)
 Q
"RTN","RCWROFF",13,0)
 ;
"RTN","RCWROFF",14,0)
 ;
"RTN","RCWROFF",15,0)
9 ;  terminated by compromise (trantype=9) (menu option)
"RTN","RCWROFF",16,0)
 N RCDRSTRG
"RTN","RCWROFF",17,0)
 S RCDRSTRG="11TERMINATION DATE;"
"RTN","RCWROFF",18,0)
 S RCDRSTRG=RCDRSTRG_"17;"  ;termination reason
"RTN","RCWROFF",19,0)
 D MAIN("9^Compromise Termination",RCDRSTRG)
"RTN","RCWROFF",20,0)
 Q
"RTN","RCWROFF",21,0)
 ;
"RTN","RCWROFF",22,0)
 ;
"RTN","RCWROFF",23,0)
A9 ;  compromised by rc/doj (use trantype=9) (menu option)
"RTN","RCWROFF",24,0)
 N RCDRSTRG
"RTN","RCWROFF",25,0)
 S RCDRSTRG="11TERMINATION DATE;"
"RTN","RCWROFF",26,0)
 S RCDRSTRG=RCDRSTRG_"17;"  ;termination reason
"RTN","RCWROFF",27,0)
 D MAIN("9^Compromise Termination by RC/DOJ",RCDRSTRG)
"RTN","RCWROFF",28,0)
 Q
"RTN","RCWROFF",29,0)
 ;
"RTN","RCWROFF",30,0)
 ;
"RTN","RCWROFF",31,0)
10 ;  waived in full transaction (trantype=10) (menu option)
"RTN","RCWROFF",32,0)
 D MAIN("10^Waiver","11WAIVED DATE;")
"RTN","RCWROFF",33,0)
 Q
"RTN","RCWROFF",34,0)
 ;
"RTN","RCWROFF",35,0)
 ;
"RTN","RCWROFF",36,0)
A10 ;  waived by rc/doj (use trantype=10) (menu option)
"RTN","RCWROFF",37,0)
 D MAIN("10^RC/DOJ Waiver","11WAIVED DATE;")
"RTN","RCWROFF",38,0)
 Q
"RTN","RCWROFF",39,0)
 ;
"RTN","RCWROFF",40,0)
 ;
"RTN","RCWROFF",41,0)
29 ;  terminated by rc/doj (trantype=29) (menu option)
"RTN","RCWROFF",42,0)
 N RCDRSTRG
"RTN","RCWROFF",43,0)
 S RCDRSTRG="11TERMINATION DATE;"
"RTN","RCWROFF",44,0)
 S RCDRSTRG=RCDRSTRG_"17;"  ;termination reason
"RTN","RCWROFF",45,0)
 D MAIN("29^RC/DOJ Termination",RCDRSTRG)
"RTN","RCWROFF",46,0)
 Q
"RTN","RCWROFF",47,0)
 ;
"RTN","RCWROFF",48,0)
 ;
"RTN","RCWROFF",49,0)
47 ;  suspended (trantype=47) (menu option)
"RTN","RCWROFF",50,0)
 N RCDRSTRG
"RTN","RCWROFF",51,0)
 S RCDRSTRG="11SUSPENDED DATE;"
"RTN","RCWROFF",52,0)
 S RCDRSTRG=RCDRSTRG_"90R;"  ;suspension type
"RTN","RCWROFF",53,0)
 S RCDRSTRG=RCDRSTRG_"S RCX=$S('X:""NOT CO-PAY SUSPENSION"",X=1:""INITIAL CO-PAY WAIVER"",1:""APPEAL CO-PAY WAIVER"");"
"RTN","RCWROFF",54,0)
 S RCDRSTRG=RCDRSTRG_"5.02////^S X=RCX;"  ;brief comment
"RTN","RCWROFF",55,0)
 S RCDRSTRG=RCDRSTRG_"K RCX;"
"RTN","RCWROFF",56,0)
 D MAIN("47^Suspension",RCDRSTRG)
"RTN","RCWROFF",57,0)
 Q
"RTN","RCWROFF",58,0)
 ;
"RTN","RCWROFF",59,0)
 ;
"RTN","RCWROFF",60,0)
MAIN(RCTRTYPE,RCDRSTRG) ;  main subroutine to process a waiver, termination, suspended transaction
"RTN","RCWROFF",61,0)
 ;  rctrtype = transaction type^description, example 10^waiver
"RTN","RCWROFF",62,0)
 ;  rcdrstrg = dr string used when calling die
"RTN","RCWROFF",63,0)
 N BALANCE,DR,RCBILLDA,RCTRANDA,Y
"RTN","RCWROFF",64,0)
 F  D  Q:RCBILLDA<1
"RTN","RCWROFF",65,0)
 .   K RCTRANDA  ;do not leave around in for loop
"RTN","RCWROFF",66,0)
 .   ;  select a bill
"RTN","RCWROFF",67,0)
 .   S RCBILLDA=$$GETABILL^RCBEUBIL I RCBILLDA<1 Q
"RTN","RCWROFF",68,0)
 .   ;  check to see if bill has been referred to rc/doj (6;4 = referral date)
"RTN","RCWROFF",69,0)
 .   I $P(RCTRTYPE,"^",2)["RC/DOJ",$P($G(^PRCA(430,RCBILLDA,6)),"^",4)="" W !,"THIS ACCOUNT IS NOT REFERRED TO RC/DOJ." Q
"RTN","RCWROFF",70,0)
 .   ;  lock the bill
"RTN","RCWROFF",71,0)
 .   L +^PRCA(430,RCBILLDA):5 I '$T W !,"ANOTHER USER IS CURRENTLY WORKING WITH THIS BILL." Q
"RTN","RCWROFF",72,0)
 .   D SHOWBILL^RCWROFF1(RCBILLDA)
"RTN","RCWROFF",73,0)
 .   I '$G(^PRCA(430,RCBILLDA,7)) W !,"THIS BILL HAS NO PRINCIPAL BALANCE." D UNLOCK Q
"RTN","RCWROFF",74,0)
 .   ;  ask to enter transaction
"RTN","RCWROFF",75,0)
 .   S Y=$$ASKOK($P(RCTRTYPE,"^",2)) I Y'=1 D UNLOCK S:Y<0 RCBILLDA=0 Q
"RTN","RCWROFF",76,0)
 .   ;  add a new transaction to file 433
"RTN","RCWROFF",77,0)
 .   S RCTRANDA=$$ADD433^RCBEUTRA(RCBILLDA,$P(RCTRTYPE,"^")) I 'RCTRANDA W !,$P(RCTRANDA,"^",2) D UNLOCK Q
"RTN","RCWROFF",78,0)
 .   W !,"  Transaction number ",RCTRANDA," added ..."
"RTN","RCWROFF",79,0)
 .   ;
"RTN","RCWROFF",80,0)
 .   ;  set up dr string for die call
"RTN","RCWROFF",81,0)
 .   S DR=RCDRSTRG_"41;"  ;comment
"RTN","RCWROFF",82,0)
 .   ;  bill amount moved to transaction amount
"RTN","RCWROFF",83,0)
 .   S BALANCE=$P($G(^PRCA(430,RCBILLDA,7)),"^",1,5)
"RTN","RCWROFF",84,0)
 .   S DR=DR_"15////"_($P(BALANCE,"^")+$P(BALANCE,"^",2)+$P(BALANCE,"^",3)+$P(BALANCE,"^",4)+$P(BALANCE,"^",5))_";"
"RTN","RCWROFF",85,0)
 .   I $P(BALANCE,"^",1) S DR=DR_"81////"_+$P(BALANCE,"^",1)_";"   ;principal
"RTN","RCWROFF",86,0)
 .   I $P(BALANCE,"^",2) S DR=DR_"82////"_+$P(BALANCE,"^",2)_";"   ;interest
"RTN","RCWROFF",87,0)
 .   I $P(BALANCE,"^",3) S DR=DR_"83////"_+$P(BALANCE,"^",3)_";"   ;admin
"RTN","RCWROFF",88,0)
 .   I $P(BALANCE,"^",4) S DR=DR_"84////"_+$P(BALANCE,"^",4)_";"   ;marshal fee
"RTN","RCWROFF",89,0)
 .   I $P(BALANCE,"^",5) S DR=DR_"85////"_+$P(BALANCE,"^",5)_";"   ;court cost
"RTN","RCWROFF",90,0)
 .   ;
"RTN","RCWROFF",91,0)
 .   ;  edit the fields
"RTN","RCWROFF",92,0)
 .   S Y=$$EDIT433^RCBEUTRA(RCTRANDA,DR)
"RTN","RCWROFF",93,0)
 .   I 'Y W !,$P(Y,"^",2) D DEL433^RCBEUTRA(RCTRANDA,"",0),UNLOCK Q
"RTN","RCWROFF",94,0)
 .   ;  set the bill and transaction as RC/DOJ
"RTN","RCWROFF",95,0)
 .   I $P(RCTRTYPE,"^",2)["RC/DOJ" D SETRCDOJ^RCBEUBIL(RCBILLDA,RCTRANDA,"RC")
"RTN","RCWROFF",96,0)
 .   ;  change the status of the bill
"RTN","RCWROFF",97,0)
 .   I $P(RCTRTYPE,"^")'=47 D CHGSTAT^RCBEUBIL(RCBILLDA,23)  ;write off
"RTN","RCWROFF",98,0)
 .   I $P(RCTRTYPE,"^")=47 D CHGSTAT^RCBEUBIL(RCBILLDA,40)   ;suspended
"RTN","RCWROFF",99,0)
 .   ;  mark transaction as processed
"RTN","RCWROFF",100,0)
 .   D PROCESS^RCBEUTRA(RCTRANDA)
"RTN","RCWROFF",101,0)
 .   ;
"RTN","RCWROFF",102,0)
 .   ;  create fms write off document, if not accrued and not suspended (47) transaction
"RTN","RCWROFF",103,0)
 .   I '$$ACCK^PRCAACC(RCBILLDA),$P($G(^PRCA(433,RCTRANDA,1)),"^",2)'=47 D FMSDOC(RCTRANDA)
"RTN","RCWROFF",104,0)
 .   ;
"RTN","RCWROFF",105,0)
 .   W !,"  * * * * * ",$P(RCTRTYPE,"^",2)," has been PROCESSED! * * * * *"
"RTN","RCWROFF",106,0)
 .I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !!,"   * * * * Transmission will be held until "_Y_" * * * *"
"RTN","RCWROFF",107,0)
 .   D UNLOCK
"RTN","RCWROFF",108,0)
 Q
"RTN","RCWROFF",109,0)
 ;
"RTN","RCWROFF",110,0)
 ;
"RTN","RCWROFF",111,0)
FMSDOC(RCTRANDA) ;  create fms write off document
"RTN","RCWROFF",112,0)
 N Y
"RTN","RCWROFF",113,0)
 W !!,"Creating FMS Write-off document ... "
"RTN","RCWROFF",114,0)
 S Y=$$BUILDWR^RCXFMSW1(RCTRANDA)
"RTN","RCWROFF",115,0)
 I Y W $P(Y,"^",2)," created."
"RTN","RCWROFF",116,0)
 E  W "ERROR: ",$P(Y,"^",2)
"RTN","RCWROFF",117,0)
 Q
"RTN","RCWROFF",118,0)
 ;
"RTN","RCWROFF",119,0)
 ;
"RTN","RCWROFF",120,0)
UNLOCK ;  unlock bill and transaction
"RTN","RCWROFF",121,0)
 L -^PRCA(430,RCBILLDA)
"RTN","RCWROFF",122,0)
 I $G(RCTRANDA) L -^PRCA(433,RCTRANDA)
"RTN","RCWROFF",123,0)
 Q
"RTN","RCWROFF",124,0)
 ;
"RTN","RCWROFF",125,0)
 ;
"RTN","RCWROFF",126,0)
ASKOK(TRANTYPE) ;  ask record transaction
"RTN","RCWROFF",127,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCWROFF",128,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCWROFF",129,0)
 S DIR("A")="  Are you sure you want to record this bill as a "
"RTN","RCWROFF",130,0)
 I $L(TRANTYPE)<20 S DIR("A")=DIR("A")_TRANTYPE
"RTN","RCWROFF",131,0)
 E  S DIR("A",1)=DIR("A"),DIR("A")="  "_TRANTYPE
"RTN","RCWROFF",132,0)
 W ! D ^DIR
"RTN","RCWROFF",133,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCWROFF",134,0)
 Q Y
"RTN","RCWROFF1")
0^12^B33308622
"RTN","RCWROFF1",1,0)
RCWROFF1 ;WISC/RFJ-partial waiver ;1 Feb 2000
"RTN","RCWROFF1",2,0)
 ;;4.5;Accounts Receivable;**168,204**;Mar 20, 1995
"RTN","RCWROFF1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCWROFF1",4,0)
 Q
"RTN","RCWROFF1",5,0)
 ;
"RTN","RCWROFF1",6,0)
 ;
"RTN","RCWROFF1",7,0)
PARTIAL ;  enter a partial waived (menu option)
"RTN","RCWROFF1",8,0)
 N DR,RCBILLDA,RCCURPRI,RCFYCNT,RCTOTAL,RCTRANDA,RCWAIVED,Y
"RTN","RCWROFF1",9,0)
 F  D  Q:RCBILLDA<1
"RTN","RCWROFF1",10,0)
 .   K RCTRANDA  ;do not leave around in for loop
"RTN","RCWROFF1",11,0)
 .   ;  select a bill
"RTN","RCWROFF1",12,0)
 .   S RCBILLDA=$$GETABILL^RCBEUBIL I RCBILLDA<1 Q
"RTN","RCWROFF1",13,0)
 .   ;  lock the bill
"RTN","RCWROFF1",14,0)
 .   L +^PRCA(430,RCBILLDA):5 I '$T W !,"ANOTHER USER IS CURRENTLY WORKING WITH THIS BILL." Q
"RTN","RCWROFF1",15,0)
 .   D SHOWBILL(RCBILLDA)
"RTN","RCWROFF1",16,0)
 .   I '$G(^PRCA(430,RCBILLDA,7)) W !,"THIS BILL HAS NO PRINCIPAL BALANCE." D UNLOCK^RCWROFF Q
"RTN","RCWROFF1",17,0)
 .   W !
"RTN","RCWROFF1",18,0)
 .   ;  add a new partial waiver transaction to file 433
"RTN","RCWROFF1",19,0)
 .   S RCTRANDA=$$ADD433^RCBEUTRA(RCBILLDA,11) I 'RCTRANDA W !,$P(RCTRANDA,"^",2) D UNLOCK^RCWROFF Q
"RTN","RCWROFF1",20,0)
 .   W !,"  Transaction number ",RCTRANDA," added ..."
"RTN","RCWROFF1",21,0)
 .   ;  transfer fy multiple from bill
"RTN","RCWROFF1",22,0)
 .   D FY433^RCBEUTRA(RCTRANDA)
"RTN","RCWROFF1",23,0)
 .   ;
"RTN","RCWROFF1",24,0)
 .   ;  build dr string for call to die
"RTN","RCWROFF1",25,0)
 .   S DR="11WAIVED IN PART DATE;"
"RTN","RCWROFF1",26,0)
 .   ;  determine if there is more than one fiscal year for build DR string
"RTN","RCWROFF1",27,0)
 .   S RCFYCNT=$P($G(^PRCA(433,RCTRANDA,4,0)),"^",4)
"RTN","RCWROFF1",28,0)
 .   ;  single fiscal year in multiple
"RTN","RCWROFF1",29,0)
 .   I RCFYCNT'>1 D
"RTN","RCWROFF1",30,0)
 .   .   ;  get the current principal balance
"RTN","RCWROFF1",31,0)
 .   .   S RCCURPRI=+$P($G(^PRCA(433,RCTRANDA,4,+$O(^PRCA(433,RCTRANDA,4,0)),0)),"^",2)
"RTN","RCWROFF1",32,0)
 .   .   S DR=DR_"15WAIVED AMOUNT;"
"RTN","RCWROFF1",33,0)
 .   .   S DR=DR_"S RCWAIVED=+X;"
"RTN","RCWROFF1",34,0)
 .   .   S DR=DR_"I RCWAIVED'>0 W !,""Amount must be greater than ZERO.  Press ^ to exit."" S Y=15;"
"RTN","RCWROFF1",35,0)
 .   .   S DR=DR_"I RCWAIVED>RCCURPRI W !,""Waived amount CAN NOT EXCEED Principal amount ($ "",$J(RCCURPRI,0,2),"")."" S Y=15;"
"RTN","RCWROFF1",36,0)
 .   .   S DR=DR_"I RCWAIVED=RCCURPRI W !,""If you are creating a waiver for the FULL AMOUNT, use the option Full Waiver."" S Y=15;"
"RTN","RCWROFF1",37,0)
 .   .   S DR=DR_"81///^S X=RCWAIVED;"
"RTN","RCWROFF1",38,0)
 .   ;  multiple fiscal years in multiple
"RTN","RCWROFF1",39,0)
 .   I RCFYCNT>1 D
"RTN","RCWROFF1",40,0)
 .   .   S DR=DR_"S RCTOTAL=0;"
"RTN","RCWROFF1",41,0)
 .   .   S DR=DR_".02;"
"RTN","RCWROFF1",42,0)
 .   .   S DR(2,433.01)="4WAIVED AMOUNT;"
"RTN","RCWROFF1",43,0)
 .   .   S DR(2,433.01)=DR(2,433.01)_"S RCWAIVED=+X,RCCURPRI=+$P(^PRCA(433,DA(1),4,DA,0),U,2);"
"RTN","RCWROFF1",44,0)
 .   .   S DR(2,433.01)=DR(2,433.01)_"I RCWAIVED>RCCURPRI W !,""Waived amount CAN NOT EXCEED Principal Amount ($ "",$J(RCCURPRI,0,2),"") for this Fiscal Year."" S Y=4;"
"RTN","RCWROFF1",45,0)
 .   .   S DR(2,433.01,1)="I RCWAIVED=RCCURPRI W !,""If you are creating a waiver for the FULL AMOUNT, use the option Full Waiver."" S Y=4;"
"RTN","RCWROFF1",46,0)
 .   .   S DR(2,433.01,1)=DR(2,433.01,1)_"1///^S X=$P(^PRCA(433,DA(1),4,DA,0),U,2)-RCWAIVED;"
"RTN","RCWROFF1",47,0)
 .   .   S DR(2,433.01,1)=DR(2,433.01,1)_"S RCTOTAL=$G(RCTOTAL)+RCWAIVED;"
"RTN","RCWROFF1",48,0)
 .   .   S DR=DR_"I RCTOTAL'>0 W !,""Amount must be greater than ZERO.  Press ^ to exit."" S Y=.02;"
"RTN","RCWROFF1",49,0)
 .   .   S DR=DR_"15///^S X=RCTOTAL;"
"RTN","RCWROFF1",50,0)
 .   .   S DR=DR_"81///^S X=RCTOTAL;"
"RTN","RCWROFF1",51,0)
 .   ;
"RTN","RCWROFF1",52,0)
 .   ;  allow user to edit key fields
"RTN","RCWROFF1",53,0)
 .   S Y=$$EDIT433^RCBEUTRA(RCTRANDA,.DR)
"RTN","RCWROFF1",54,0)
 .   I 'Y W !,$P(Y,"^",2) D DEL433^RCBEUTRA(RCTRANDA,"",0),UNLOCK^RCWROFF Q
"RTN","RCWROFF1",55,0)
 .   ;
"RTN","RCWROFF1",56,0)
 .   ;  if only one fiscal year, update the multiple since it was not done
"RTN","RCWROFF1",57,0)
 .   ;  by the user in the die call
"RTN","RCWROFF1",58,0)
 .   I RCFYCNT=1 D
"RTN","RCWROFF1",59,0)
 .   .   N DA40,DATA40,RCTOTAL
"RTN","RCWROFF1",60,0)
 .   .   S RCTOTAL=$P($G(^PRCA(433,RCTRANDA,8)),"^")  ;amount waived
"RTN","RCWROFF1",61,0)
 .   .   S DA40=+$O(^PRCA(433,RCTRANDA,4,0)) I 'DA40 Q
"RTN","RCWROFF1",62,0)
 .   .   S DATA40=$G(^PRCA(433,RCTRANDA,4,DA40,0)) I DATA40="" Q
"RTN","RCWROFF1",63,0)
 .   .   S $P(DATA40,"^",2)=$P(DATA40,"^",2)-RCTOTAL  ;principal remaining
"RTN","RCWROFF1",64,0)
 .   .   S $P(DATA40,"^",5)=RCTOTAL                   ;amount waived
"RTN","RCWROFF1",65,0)
 .   .   S ^PRCA(433,RCTRANDA,4,DA40,0)=DATA40
"RTN","RCWROFF1",66,0)
 .   ;
"RTN","RCWROFF1",67,0)
 .   D SHOWTRAN(RCTRANDA)
"RTN","RCWROFF1",68,0)
 .   I $$ASKOK^RCWROFF("Partial Waiver")'=1 D DEL433^RCBEUTRA(RCTRANDA,"",0),UNLOCK^RCWROFF Q
"RTN","RCWROFF1",69,0)
 .   ;
"RTN","RCWROFF1",70,0)
 .   ;  move the fy multiple from 433 to 430
"RTN","RCWROFF1",71,0)
 .   D FYMULT^RCBEUBIL(RCTRANDA)
"RTN","RCWROFF1",72,0)
 .   ;  mark transaction as processed
"RTN","RCWROFF1",73,0)
 .   D PROCESS^RCBEUTRA(RCTRANDA)
"RTN","RCWROFF1",74,0)
 .   ;  update the principal balance on the bill (subtract the waived amount)
"RTN","RCWROFF1",75,0)
 .   D SETBAL^RCBEUBIL(RCTRANDA)
"RTN","RCWROFF1",76,0)
 .   ;  create fms write off document, if not accrued
"RTN","RCWROFF1",77,0)
 .   I '$$ACCK^PRCAACC(RCBILLDA) D FMSDOC^RCWROFF(RCTRANDA)
"RTN","RCWROFF1",78,0)
 .   ;
"RTN","RCWROFF1",79,0)
 .   W !,"  * * * * * Partial Waiver has been PROCESSED! * * * * *"
"RTN","RCWROFF1",80,0)
 .I '$G(REFMS)&(DT>$$LDATE^RCRJR(DT)) S Y=$E($$FPS^RCAMFN01(DT,1),1,5)_"01" D DD^%DT W !!,"   * * * * Transmission will be held until "_Y_" * * * *"
"RTN","RCWROFF1",81,0)
 .   D UNLOCK^RCWROFF
"RTN","RCWROFF1",82,0)
 Q
"RTN","RCWROFF1",83,0)
 ;
"RTN","RCWROFF1",84,0)
 ;
"RTN","RCWROFF1",85,0)
SHOWTRAN(RCTRANDA) ;  show data for transaction
"RTN","RCWROFF1",86,0)
 N %,DATA0,DATA1,DATA40,RCWRLINE,Y
"RTN","RCWROFF1",87,0)
 S DATA0=$G(^PRCA(433,RCTRANDA,0))
"RTN","RCWROFF1",88,0)
 S DATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCWROFF1",89,0)
 S RCWRLINE="",$P(RCWRLINE,"=",79)=""
"RTN","RCWROFF1",90,0)
 W !!,RCWRLINE
"RTN","RCWROFF1",91,0)
 W !,"BILL NUMBER: ",$P($G(^PRCA(430,+$P(DATA0,"^",2),0)),"^")
"RTN","RCWROFF1",92,0)
 W ?40,"WAIVED AMOUNT: ",$J($P(DATA1,"^",5),0,2)
"RTN","RCWROFF1",93,0)
 S Y=$P($P(DATA1,"^"),".") I Y D DD^%DT
"RTN","RCWROFF1",94,0)
 W !?42,"WAIVED DATE: ",Y
"RTN","RCWROFF1",95,0)
 W !!,"FISCAL YEAR",?30,"WAIVED AMOUNT",?50,"NEW PRINCIPAL BALANCE DUE"
"RTN","RCWROFF1",96,0)
 S %=0 F  S %=$O(^PRCA(433,RCTRANDA,4,%)) Q:'%  D
"RTN","RCWROFF1",97,0)
 .   S DATA40=$G(^PRCA(433,RCTRANDA,4,%,0))
"RTN","RCWROFF1",98,0)
 .   W !,$P(DATA40,"^"),?30,$J($P(DATA40,"^",5),13,2),?50,$J($P(DATA40,"^",2),25,2)
"RTN","RCWROFF1",99,0)
 W !!,RCWRLINE
"RTN","RCWROFF1",100,0)
 Q
"RTN","RCWROFF1",101,0)
 ;
"RTN","RCWROFF1",102,0)
 ;
"RTN","RCWROFF1",103,0)
SHOWBILL(RCBILLDA) ;  show data for bill
"RTN","RCWROFF1",104,0)
 N DATA7,DATA20,FYDA
"RTN","RCWROFF1",105,0)
 S DATA7=$G(^PRCA(430,RCBILLDA,7))
"RTN","RCWROFF1",106,0)
 W !?8,"Principal Balance: ",$J($P(DATA7,"^"),9,2)
"RTN","RCWROFF1",107,0)
 ;
"RTN","RCWROFF1",108,0)
 ;  show fy data
"RTN","RCWROFF1",109,0)
 S FYDA=$O(^PRCA(430,RCBILLDA,2,0)),DATA20=$G(^PRCA(430,RCBILLDA,2,FYDA,0))
"RTN","RCWROFF1",110,0)
 W ?40,"FY: ",$P(DATA20,"^"),?50,"Principal Balance: ",$J($P(DATA20,"^",2),0,2)
"RTN","RCWROFF1",111,0)
 ;  if multiple fiscal years, show them here
"RTN","RCWROFF1",112,0)
 F  S FYDA=$O(^PRCA(430,RCBILLDA,2,FYDA)) Q:'FYDA  D
"RTN","RCWROFF1",113,0)
 .   S DATA20=$G(^PRCA(430,RCBILLDA,2,FYDA,0))
"RTN","RCWROFF1",114,0)
 .   W !?40,"FY: ",$P(DATA20,"^"),?50,"Principal Balance: ",$J($P(DATA20,"^",2),0,2)
"RTN","RCWROFF1",115,0)
 ;
"RTN","RCWROFF1",116,0)
 W !?8," Interest Balance: ",$J($P(DATA7,"^",2),9,2)
"RTN","RCWROFF1",117,0)
 W !?8,"    Admin Balance: ",$J($P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5),9,2)
"RTN","RCWROFF1",118,0)
 W !?27,"---------"
"RTN","RCWROFF1",119,0)
 W !?8,"    TOTAL Balance: ",$J($P(DATA7,"^")+$P(DATA7,"^",2)+$P(DATA7,"^",3)+$P(DATA7,"^",4)+$P(DATA7,"^",5),9,2)
"RTN","RCWROFF1",120,0)
 Q
"RTN","RCXFMSCR")
0^2^B27286518
"RTN","RCXFMSCR",1,0)
RCXFMSCR ;WISC/RFJ-fms cash receipt (cr) code sheet generator ;1 Oct 97
"RTN","RCXFMSCR",2,0)
 ;;4.5;Accounts Receivable;**90,114,148,172,204**;Mar 20, 1995
"RTN","RCXFMSCR",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSCR",4,0)
 Q
"RTN","RCXFMSCR",5,0)
 ;
"RTN","RCXFMSCR",6,0)
 ;        
"RTN","RCXFMSCR",7,0)
BUILDCR(RCRECTDA,RCGECSDA) ;  generate a cr code sheet for a receipt
"RTN","RCXFMSCR",8,0)
 ;  rcgecsda is the ien for the gcs stack file 2100.1 for rebuilds
"RTN","RCXFMSCR",9,0)
 ;
"RTN","RCXFMSCR",10,0)
 N AMOUNT,BILLDA,COUNT,CR2,DETAIL,DEPOSIT,DESCRIP,DOCTOTAL,FISCALYR,FMSTYPE,FUND,GECSFMS,LINE,RCDEPTDA,REVSRCE,TOTAL,TRANDA,TRANNUMB,UNAPPLY,UNAPPNUM,VENDORID
"RTN","RCXFMSCR",11,0)
 ;
"RTN","RCXFMSCR",12,0)
 ;  build the lines for all payments on receipt
"RTN","RCXFMSCR",13,0)
 K ^TMP($J,"RCFMSCR")  ;  used for 215 report, not used here
"RTN","RCXFMSCR",14,0)
 D FMSLINES^RCXFMSC1(RCRECTDA)
"RTN","RCXFMSCR",15,0)
 K ^TMP($J,"RCFMSCR")
"RTN","RCXFMSCR",16,0)
 ;
"RTN","RCXFMSCR",17,0)
 ;  unapplied payments to accounts
"RTN","RCXFMSCR",18,0)
 S TRANDA=0 F  S TRANDA=$O(^RCY(344,RCRECTDA,1,TRANDA)) Q:'TRANDA  D
"RTN","RCXFMSCR",19,0)
 .   ;  dollars applied in AR
"RTN","RCXFMSCR",20,0)
 .   I $P(^RCY(344,RCRECTDA,1,TRANDA,0),"^",5) Q
"RTN","RCXFMSCR",21,0)
 .   ;  no dollars on transaction
"RTN","RCXFMSCR",22,0)
 .   S AMOUNT=$P(^RCY(344,RCRECTDA,1,TRANDA,0),"^",4) I 'AMOUNT Q
"RTN","RCXFMSCR",23,0)
 .   ;
"RTN","RCXFMSCR",24,0)
 .   S UNAPPLY($$GETUNAPP(RCRECTDA,TRANDA,1))=AMOUNT
"RTN","RCXFMSCR",25,0)
 ;
"RTN","RCXFMSCR",26,0)
 ;  no code sheets to send
"RTN","RCXFMSCR",27,0)
 I '$D(DETAIL),'$D(TOTAL),'$D(UNAPPLY) Q "-1^No code sheets to send for this receipt"
"RTN","RCXFMSCR",28,0)
 ;
"RTN","RCXFMSCR",29,0)
 ;  get the next common number in the series = station "-" nextnumber
"RTN","RCXFMSCR",30,0)
 ;  use (field 200 in file 344) if document previously sent
"RTN","RCXFMSCR",31,0)
 S TRANNUMB=$P($P($G(^RCY(344,RCRECTDA,2)),"^"),"-",2)
"RTN","RCXFMSCR",32,0)
 I TRANNUMB="" S TRANNUMB=$$ENUM^RCMSNUM
"RTN","RCXFMSCR",33,0)
 I TRANNUMB<0 Q "0^Unable to lookup next transaction number"
"RTN","RCXFMSCR",34,0)
 ;  remove the dash (i,e, 460-K1A05HY)
"RTN","RCXFMSCR",35,0)
 S TRANNUMB=$TR(TRANNUMB,"-")
"RTN","RCXFMSCR",36,0)
 ;
"RTN","RCXFMSCR",37,0)
 S FISCALYR=$$FY^RCFN01(DT)
"RTN","RCXFMSCR",38,0)
 ;
"RTN","RCXFMSCR",39,0)
 S COUNT=0,DOCTOTAL=0
"RTN","RCXFMSCR",40,0)
 ;  build detail line
"RTN","RCXFMSCR",41,0)
 S FMSTYPE="" F  S FMSTYPE=$O(DETAIL(FMSTYPE)) Q:FMSTYPE=""  D
"RTN","RCXFMSCR",42,0)
 .   S BILLDA=0 F  S BILLDA=$O(DETAIL(FMSTYPE,BILLDA)) Q:'BILLDA  D
"RTN","RCXFMSCR",43,0)
 .   .   S AMOUNT=DETAIL(FMSTYPE,BILLDA),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSCR",44,0)
 .   .   S COUNT=COUNT+1
"RTN","RCXFMSCR",45,0)
 .   .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSCR",46,0)
 .   .   S $P(LINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSCR",47,0)
 .   .   S $P(LINE(COUNT),"^",21)="I"
"RTN","RCXFMSCR",48,0)
 .   .   S $P(LINE(COUNT),"^",23)=FMSTYPE
"RTN","RCXFMSCR",49,0)
 .   .   S $P(LINE(COUNT),"^",24)="BD"
"RTN","RCXFMSCR",50,0)
 .   .   S $P(LINE(COUNT),"^",25)=$TR($P(^PRCA(430,BILLDA,0),"^"),"-")
"RTN","RCXFMSCR",51,0)
 .   .   S $P(LINE(COUNT),"^",26)=$$LINE^RCXFMSC1(BILLDA)
"RTN","RCXFMSCR",52,0)
 .   .   S $P(LINE(COUNT),"^",27)="~"
"RTN","RCXFMSCR",53,0)
 ;
"RTN","RCXFMSCR",54,0)
 ;  build summary line
"RTN","RCXFMSCR",55,0)
 S FUND="" F  S FUND=$O(TOTAL(FUND)) Q:FUND=""  D
"RTN","RCXFMSCR",56,0)
 .   S REVSRCE="" F  S REVSRCE=$O(TOTAL(FUND,REVSRCE)) Q:REVSRCE=""  D
"RTN","RCXFMSCR",57,0)
 .   .   S VENDORID="" F  S VENDORID=$O(TOTAL(FUND,REVSRCE,VENDORID)) Q:VENDORID=""  D
"RTN","RCXFMSCR",58,0)
 .   .   .   S AMOUNT=TOTAL(FUND,REVSRCE,VENDORID),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSCR",59,0)
 .   .   .   S COUNT=COUNT+1
"RTN","RCXFMSCR",60,0)
 .   .   .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSCR",61,0)
 .   .   .   S $P(LINE(COUNT),"^",4)=FISCALYR
"RTN","RCXFMSCR",62,0)
 .   .   .   S $P(LINE(COUNT),"^",6)=FUND
"RTN","RCXFMSCR",63,0)
 .   .   .   S $P(LINE(COUNT),"^",7)=$E(TRANNUMB,1,3) ; station #
"RTN","RCXFMSCR",64,0)
 .   .   .   S $P(LINE(COUNT),"^",10)=REVSRCE
"RTN","RCXFMSCR",65,0)
 .   .   .   S $P(LINE(COUNT),"^",18)=VENDORID
"RTN","RCXFMSCR",66,0)
 .   .   .   S $P(LINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSCR",67,0)
 .   .   .   S $P(LINE(COUNT),"^",21)="I"
"RTN","RCXFMSCR",68,0)
 .   .   .   S $P(LINE(COUNT),"^",23)=23
"RTN","RCXFMSCR",69,0)
 .   .   .   S $P(LINE(COUNT),"^",24)="~"
"RTN","RCXFMSCR",70,0)
 ;
"RTN","RCXFMSCR",71,0)
 ;  build unapplied payment lines
"RTN","RCXFMSCR",72,0)
 S UNAPPNUM="" F  S UNAPPNUM=$O(UNAPPLY(UNAPPNUM)) Q:UNAPPNUM=""  D
"RTN","RCXFMSCR",73,0)
 .   S AMOUNT=UNAPPLY(UNAPPNUM),DOCTOTAL=DOCTOTAL+AMOUNT
"RTN","RCXFMSCR",74,0)
 .   S COUNT=COUNT+1
"RTN","RCXFMSCR",75,0)
 .   S LINE(COUNT)="LIN^~CRA^"_$S($L(COUNT)=1:"00",$L(COUNT)=2:"0",1:"")_COUNT
"RTN","RCXFMSCR",76,0)
 .   S $P(LINE(COUNT),"^",4)=FISCALYR
"RTN","RCXFMSCR",77,0)
 .   S $P(LINE(COUNT),"^",6)=3875
"RTN","RCXFMSCR",78,0)
 .   S $P(LINE(COUNT),"^",7)=$E(TRANNUMB,1,3) ; station #
"RTN","RCXFMSCR",79,0)
 .   S $P(LINE(COUNT),"^",20)=$J(AMOUNT,0,2)
"RTN","RCXFMSCR",80,0)
 .   S $P(LINE(COUNT),"^",21)="I"
"RTN","RCXFMSCR",81,0)
 .   S $P(LINE(COUNT),"^",23)=17
"RTN","RCXFMSCR",82,0)
 .   S $P(LINE(COUNT),"^",24)="~CRB"
"RTN","RCXFMSCR",83,0)
 .   S $P(LINE(COUNT),"^",32)=UNAPPNUM
"RTN","RCXFMSCR",84,0)
 .   S $P(LINE(COUNT),"^",33)="~"
"RTN","RCXFMSCR",85,0)
 ;
"RTN","RCXFMSCR",86,0)
 ;  get data from file 344.1, the ar deposit file
"RTN","RCXFMSCR",87,0)
 S RCDEPTDA=$P(^RCY(344,RCRECTDA,0),"^",6),DEPOSIT=$G(^RCY(344.1,RCDEPTDA,0))
"RTN","RCXFMSCR",88,0)
 ;
"RTN","RCXFMSCR",89,0)
 ;  build cr2, $p(deposit,^,3)=deposit date
"RTN","RCXFMSCR",90,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","RCXFMSCR",91,0)
 ;S CR2="CR2^"_$E(DT,2,3)_"^"_$E(DT,4,5)_"^"_$E(DT,6,7)_"^^^^^^E^^^"
"RTN","RCXFMSCR",92,0)
 S CR2="CR2^"_$E(FMSDT,2,3)_"^"_$E(FMSDT,4,5)_"^"_$E(FMSDT,6,7)_"^^^^^^E^^^"
"RTN","RCXFMSCR",93,0)
 S CR2=CR2_$P(DEPOSIT,"^")_"^^"_$J(DOCTOTAL,0,2)_"^^"
"RTN","RCXFMSCR",94,0)
 S CR2=CR2_$E($P(DEPOSIT,"^",3),2,3)_"^"_$E($P(DEPOSIT,"^",3),4,5)_"^"_$E($P(DEPOSIT,"^",3),6,7)_"^~"
"RTN","RCXFMSCR",95,0)
 ;
"RTN","RCXFMSCR",96,0)
 ;  put together document in gcs
"RTN","RCXFMSCR",97,0)
 N %DT,D,D0,DA,DI,DIC,DIE,DIQ2,DQ,DR
"RTN","RCXFMSCR",98,0)
 S DESCRIP="Receipt: "_$P(^RCY(344,RCRECTDA,0),"^")
"RTN","RCXFMSCR",99,0)
 I 'RCGECSDA D CONTROL^GECSUFMS("A",$E(TRANNUMB,1,3),TRANNUMB,"CR",10,0,"",DESCRIP)
"RTN","RCXFMSCR",100,0)
 I RCGECSDA D REBUILD^GECSUFM1(RCGECSDA,"A",10,"N","Rebuild "_DESCRIP) S GECSFMS("DA")=RCGECSDA
"RTN","RCXFMSCR",101,0)
 ;
"RTN","RCXFMSCR",102,0)
 ;  store document in gcs
"RTN","RCXFMSCR",103,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),CR2)
"RTN","RCXFMSCR",104,0)
 F COUNT=1:1 Q:'$D(LINE(COUNT))  D SETCS^GECSSTAA(GECSFMS("DA"),LINE(COUNT))
"RTN","RCXFMSCR",105,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMSCR",106,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMSCR",107,0)
 ;
"RTN","RCXFMSCR",108,0)
 ;  add/update entry in file 347 for unprocessed document report
"RTN","RCXFMSCR",109,0)
 N %DT,%X,D,DA347,D0,DI,DQ,DIC,ERROR,FMSDOCNO,X
"RTN","RCXFMSCR",110,0)
 S FMSDOCNO="CR-"_$P(GECSFMS("CTL"),"^",9)
"RTN","RCXFMSCR",111,0)
 S DA347=$O(^RC(347,"C",FMSDOCNO,0))
"RTN","RCXFMSCR",112,0)
 ;  if not in the file, addit   fmsdocid   cr   id
"RTN","RCXFMSCR",113,0)
 I 'DA347 D OPEN^RCFMDRV1(FMSDOCNO,3,"RC"_$P($G(^RCY(344,RCRECTDA,0)),"^"),.DA347,.ERROR)
"RTN","RCXFMSCR",114,0)
 I DA347 D SSTAT^RCFMFN02(FMSDOCNO,1)
"RTN","RCXFMSCR",115,0)
 ;
"RTN","RCXFMSCR",116,0)
 ;  return 1 for success ^ fms document transaction number
"RTN","RCXFMSCR",117,0)
 Q "1^"_FMSDOCNO
"RTN","RCXFMSCR",118,0)
 ;
"RTN","RCXFMSCR",119,0)
 ;
"RTN","RCXFMSCR",120,0)
GETUNAPP(RCRECTDA,RCTRANDA,RCSTORE) ;  get unapplied deposit number for receipt
"RTN","RCXFMSCR",121,0)
 ;  if $g(rcstore) store it with transaction
"RTN","RCXFMSCR",122,0)
 N UNAPPNUM
"RTN","RCXFMSCR",123,0)
 ;  if number is already assigned, use it
"RTN","RCXFMSCR",124,0)
 I $P($G(^RCY(344,RCRECTDA,1,RCTRANDA,2)),"^",5)'="" Q $P(^(2),"^",5)
"RTN","RCXFMSCR",125,0)
 ;
"RTN","RCXFMSCR",126,0)
 S UNAPPNUM=$P(^RCY(344,RCRECTDA,0),"^")
"RTN","RCXFMSCR",127,0)
 ;  if the receipt number is more than 9 characters, take the last 9
"RTN","RCXFMSCR",128,0)
 I $L(UNAPPNUM)>9 S UNAPPNUM=$E(UNAPPNUM,$L(UNAPPNUM)-8,$L(UNAPPNUM))
"RTN","RCXFMSCR",129,0)
 S UNAPPNUM=UNAPPNUM_$TR($J(RCTRANDA,4)," ",0)
"RTN","RCXFMSCR",130,0)
 ;
"RTN","RCXFMSCR",131,0)
 ;  store unapplied number
"RTN","RCXFMSCR",132,0)
 I $G(RCSTORE) D SETUNAPP^RCDPURET(RCRECTDA,RCTRANDA,UNAPPNUM)
"RTN","RCXFMSCR",133,0)
 ;
"RTN","RCXFMSCR",134,0)
 Q UNAPPNUM
"RTN","RCXFMSW1")
0^10^B32448827
"RTN","RCXFMSW1",1,0)
RCXFMSW1 ;WISC/RFJ-fms writeoff (wr) code sheet generator for a transaction ;1 Feb 2000
"RTN","RCXFMSW1",2,0)
 ;;4.5;Accounts Receivable;**168,172,204**;Mar 20, 1995
"RTN","RCXFMSW1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RCXFMSW1",4,0)
 Q
"RTN","RCXFMSW1",5,0)
 ;
"RTN","RCXFMSW1",6,0)
 ;
"RTN","RCXFMSW1",7,0)
REGENWR ;  regenerate write off document (menu option)
"RTN","RCXFMSW1",8,0)
 N FMSDOC,PRINAMT,RCTRANDA,TRANTYPE,Y
"RTN","RCXFMSW1",9,0)
 F  D  Q:'RCTRANDA
"RTN","RCXFMSW1",10,0)
 .   W ! S RCTRANDA=$$SELTRAN^RCDPTPLM I RCTRANDA<1 S RCTRANDA=0 Q
"RTN","RCXFMSW1",11,0)
 .   L +^PRCA(433,RCTRANDA):5 I '$T W !,"Another user is working with this transaction.  Try again later." Q
"RTN","RCXFMSW1",12,0)
 .   S TRANTYPE=$P($G(^PRCA(433,RCTRANDA,1)),"^",2)
"RTN","RCXFMSW1",13,0)
 .   I TRANTYPE'=8,TRANTYPE'=9,TRANTYPE'=10,TRANTYPE'=11,TRANTYPE'=29 L -^PRCA(433,RCTRANDA) W !,"You can only send a WRITE OFF document for transactions that write off a bill." Q
"RTN","RCXFMSW1",14,0)
 .   ;  check to see if transaction was processed
"RTN","RCXFMSW1",15,0)
 .   I $P($G(^PRCA(433,RCTRANDA,0)),"^",4)'=2 L -^PRCA(433,RCTRANDA) W !,"This transaction was NOT processed." Q
"RTN","RCXFMSW1",16,0)
 .   D SHOWTRAN(RCTRANDA)
"RTN","RCXFMSW1",17,0)
 .   I $$ACCK^PRCAACC(+$P($G(^PRCA(433,RCTRANDA,0)),"^",2)) L -^PRCA(433,RCTRANDA) W !,"ACCRUED bills do not get sent in detail to FMS." Q
"RTN","RCXFMSW1",18,0)
 .   ;  get fms document and status
"RTN","RCXFMSW1",19,0)
 .   S FMSDOC=$$FMSSTAT(RCTRANDA)
"RTN","RCXFMSW1",20,0)
 .   W !,"Previously sent in WR FMS document: ",$S($P(FMSDOC,"^")="":"NOT FOUND",1:$P(FMSDOC,"^")),"    Status: ",$E($P(FMSDOC,"^",2),1,16)
"RTN","RCXFMSW1",21,0)
 .   I $P(FMSDOC,"^",2)["ACCEPT"!($P(FMSDOC,"^",2)["TRANSMIT") L -^PRCA(433,RCTRANDA) W !,"The FMS document has been ",$P(FMSDOC,"^",2)," and cannot be regenerated." Q
"RTN","RCXFMSW1",22,0)
 .   S PRINAMT=$P($G(^PRCA(433,RCTRANDA,8)),"^")
"RTN","RCXFMSW1",23,0)
 .   I PRINAMT'>0 L -^PRCA(433,RCTRANDA) W !,"The principal amount needs to be greater than ZERO." Q
"RTN","RCXFMSW1",24,0)
 .   S Y=$$ASKOK I Y'=1 L -^PRCA(433,RCTRANDA) S:Y<0 RCTRANDA=0 Q
"RTN","RCXFMSW1",25,0)
 .   S Y=$$BUILDWR(RCTRANDA)
"RTN","RCXFMSW1",26,0)
 .   L -^PRCA(433,RCTRANDA)
"RTN","RCXFMSW1",27,0)
 .   I Y W !,"WR Document regenerated and retransmitted to FMS." Q
"RTN","RCXFMSW1",28,0)
 .   W !,"Unable to regenerate document.  ",$P(Y,"^",2)
"RTN","RCXFMSW1",29,0)
 Q
"RTN","RCXFMSW1",30,0)
 ;
"RTN","RCXFMSW1",31,0)
 ;
"RTN","RCXFMSW1",32,0)
BUILDWR(RCTRANDA) ;  this entry point is called to generate a wr document to fms for a single transaction
"RTN","RCXFMSW1",33,0)
 N CATEGORY,CR2,DA347,DIQ2,DOCTOTAL,FMSDOCNO,FMSLINE,GECSDATA,RCBILLDA,TRANNUMB,REFMS
"RTN","RCXFMSW1",34,0)
 S RCBILLDA=$P($G(^PRCA(433,RCTRANDA,0)),"^",2)
"RTN","RCXFMSW1",35,0)
 I 'RCBILLDA Q "0^Bill Number missing on transaction."
"RTN","RCXFMSW1",36,0)
 ;
"RTN","RCXFMSW1",37,0)
 S DOCTOTAL=$P($G(^PRCA(433,RCTRANDA,8)),"^")
"RTN","RCXFMSW1",38,0)
 I 'DOCTOTAL Q "0^Total Principal Amount is ZERO."
"RTN","RCXFMSW1",39,0)
 ;
"RTN","RCXFMSW1",40,0)
 ;  find a previously sent document
"RTN","RCXFMSW1",41,0)
 S FMSDOCNO=$P($G(^PRCA(433,RCTRANDA,1)),"^",12) I FMSDOCNO'="" S DA347=$O(^RC(347,"C",FMSDOCNO,0))
"RTN","RCXFMSW1",42,0)
 I FMSDOCNO="" D
"RTN","RCXFMSW1",43,0)
 .   S DA347=$O(^RC(347,"D","T"_RCTRANDA,0)) I 'DA347 Q
"RTN","RCXFMSW1",44,0)
 .   S FMSDOCNO=$P($G(^RC(347,DA347,0)),"^",9)
"RTN","RCXFMSW1",45,0)
 ;  if previously sent, get the data from gcs
"RTN","RCXFMSW1",46,0)
 I FMSDOCNO'="" S REFMS=1 D DATA^GECSSGET(FMSDOCNO,0) I $G(GECSDATA) S TRANNUMB=$E($P(FMSDOCNO,"-",2),1,11)
"RTN","RCXFMSW1",47,0)
 ;
"RTN","RCXFMSW1",48,0)
 I $G(TRANNUMB)="" S TRANNUMB=$$ENUM^RCMSNUM
"RTN","RCXFMSW1",49,0)
 I TRANNUMB<0 Q "0^Unable to lookup next transaction number."
"RTN","RCXFMSW1",50,0)
 ;  remove dash (example 460-K1A05HY)
"RTN","RCXFMSW1",51,0)
 S TRANNUMB=$TR(TRANNUMB,"-")
"RTN","RCXFMSW1",52,0)
 ;
"RTN","RCXFMSW1",53,0)
 S FMSLINE="LIN^~CRA^001"
"RTN","RCXFMSW1",54,0)
 S $P(FMSLINE,"^",20)=$J(DOCTOTAL,0,2)
"RTN","RCXFMSW1",55,0)
 S $P(FMSLINE,"^",21)="I"
"RTN","RCXFMSW1",56,0)
 S $P(FMSLINE,"^",23)=$P($$DTYPE^PRCAFBD1($P($G(^PRCA(430,RCBILLDA,11)),"^",10)),"^",4) ;refund/reimbursement
"RTN","RCXFMSW1",57,0)
 S $P(FMSLINE,"^",24)="BD"
"RTN","RCXFMSW1",58,0)
 S $P(FMSLINE,"^",25)=$TR($P(^PRCA(430,RCBILLDA,0),"^"),"-")  ;bill number with no dash
"RTN","RCXFMSW1",59,0)
 S $P(FMSLINE,"^",26)=$$LINE^RCXFMSC1(RCBILLDA)_"^~"
"RTN","RCXFMSW1",60,0)
 ;
"RTN","RCXFMSW1",61,0)
 ;  tricare bill
"RTN","RCXFMSW1",62,0)
 S CATEGORY=$P($G(^PRCA(430,RCBILLDA,0)),"^",2)
"RTN","RCXFMSW1",63,0)
 I CATEGORY=30!(CATEGORY=32) S $P(FMSLINE,"^",23)="06"
"RTN","RCXFMSW1",64,0)
 ;
"RTN","RCXFMSW1",65,0)
 N FMSDT S FMSDT=$$FMSDATE^RCBEUTRA(DT)
"RTN","RCXFMSW1",66,0)
 S CR2="CR2^"_$E(FMSDT,2,3)_"^"_$E(FMSDT,4,5)_"^"_$E(FMSDT,6,7)
"RTN","RCXFMSW1",67,0)
 S $P(CR2,"^",10)="E"
"RTN","RCXFMSW1",68,0)
 S $P(CR2,"^",13)=999999999999
"RTN","RCXFMSW1",69,0)
 S $P(CR2,"^",15)=$J(DOCTOTAL,0,2)
"RTN","RCXFMSW1",70,0)
 S $P(CR2,"^",17)=$E(DT,2,3)
"RTN","RCXFMSW1",71,0)
 S $P(CR2,"^",18)=$E(DT,4,5)
"RTN","RCXFMSW1",72,0)
 S $P(CR2,"^",19)=$E(DT,6,7)_"^~"
"RTN","RCXFMSW1",73,0)
 ;
"RTN","RCXFMSW1",74,0)
 ;  put together document in fms
"RTN","RCXFMSW1",75,0)
 N %DT,D,D0,DA,DI,DIC,DIE,DQ,DR,GECSFMS,X
"RTN","RCXFMSW1",76,0)
 I '$G(GECSDATA) D CONTROL^GECSUFMS("A",$E(TRANNUMB,1,3),TRANNUMB,"WR",10,0,"","WRITE OFF")
"RTN","RCXFMSW1",77,0)
 E  D REBUILD^GECSUFM1(+GECSDATA,"A",10,"N","Rebuild WRITE OFF") S GECSFMS("DA")=+GECSDATA
"RTN","RCXFMSW1",78,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),CR2)
"RTN","RCXFMSW1",79,0)
 D SETCS^GECSSTAA(GECSFMS("DA"),FMSLINE)
"RTN","RCXFMSW1",80,0)
 D SETCODE^GECSSDCT(GECSFMS("DA"),"D RETN^RCFMFN02")
"RTN","RCXFMSW1",81,0)
 D SETSTAT^GECSSTAA(GECSFMS("DA"),"Q")
"RTN","RCXFMSW1",82,0)
 ;
"RTN","RCXFMSW1",83,0)
 ;  store the gcs number in 433 for future reference
"RTN","RCXFMSW1",84,0)
 S $P(^PRCA(433,RCTRANDA,1),"^",12)="WR-"_$P(GECSFMS("CTL"),"^",9)
"RTN","RCXFMSW1",85,0)
 ;
"RTN","RCXFMSW1",86,0)
 ;  add/update entry in file 347 for reports
"RTN","RCXFMSW1",87,0)
 N %DT,X,D,D0,DI,DQ,DIC,ERROR
"RTN","RCXFMSW1",88,0)
 I 'DA347 D OPEN^RCFMDRV1("WR-"_$P(GECSFMS("CTL"),"^",9),1,"T"_RCTRANDA,.DA347,.ERROR,RCBILLDA,RCTRANDA)
"RTN","RCXFMSW1",89,0)
 I DA347 D SSTAT^RCFMFN02("T"_RCTRANDA,1)
"RTN","RCXFMSW1",90,0)
 ;
"RTN","RCXFMSW1",91,0)
 Q "1^WR-"_$P(GECSFMS("CTL"),"^",9)
"RTN","RCXFMSW1",92,0)
 ;
"RTN","RCXFMSW1",93,0)
 ;
"RTN","RCXFMSW1",94,0)
FMSSTAT(RCTRANDA) ;  return the fms wr document ^ status ^ file 347 ien
"RTN","RCXFMSW1",95,0)
 N DA347,FMSDOCNO,STATUS
"RTN","RCXFMSW1",96,0)
 ;  get the fms document from the transaction
"RTN","RCXFMSW1",97,0)
 S FMSDOCNO=$P($G(^PRCA(433,RCTRANDA,1)),"^",12)
"RTN","RCXFMSW1",98,0)
 ;  if fms document found, get the file 347 entry
"RTN","RCXFMSW1",99,0)
 I FMSDOCNO'="" S DA347=$O(^RC(347,"C",FMSDOCNO,0))
"RTN","RCXFMSW1",100,0)
 ;  if not on transaction, it may be earlier than patch 146
"RTN","RCXFMSW1",101,0)
 I FMSDOCNO="" D
"RTN","RCXFMSW1",102,0)
 .   S DA347=$O(^RC(347,"D","T"_RCTRANDA,0)) I 'DA347 Q
"RTN","RCXFMSW1",103,0)
 .   S FMSDOCNO=$P($G(^RC(347,DA347,0)),"^",9)
"RTN","RCXFMSW1",104,0)
 ;  get the status
"RTN","RCXFMSW1",105,0)
 S STATUS="NOT FOUND"
"RTN","RCXFMSW1",106,0)
 I FMSDOCNO'="" S STATUS=$$STATUS^GECSSGET(FMSDOCNO)
"RTN","RCXFMSW1",107,0)
 Q FMSDOCNO_"^"_STATUS_"^"_$G(DA347)
"RTN","RCXFMSW1",108,0)
 ;
"RTN","RCXFMSW1",109,0)
 ;
"RTN","RCXFMSW1",110,0)
SHOWTRAN(RCTRANDA) ;  show data for transaction
"RTN","RCXFMSW1",111,0)
 N DATA0,DATA1,DATA8,RCWRLINE,Y
"RTN","RCXFMSW1",112,0)
 S DATA0=$G(^PRCA(433,RCTRANDA,0))
"RTN","RCXFMSW1",113,0)
 S DATA1=$G(^PRCA(433,RCTRANDA,1))
"RTN","RCXFMSW1",114,0)
 S DATA8=$G(^PRCA(433,RCTRANDA,8))
"RTN","RCXFMSW1",115,0)
 S RCWRLINE="",$P(RCWRLINE,"=",79)=""
"RTN","RCXFMSW1",116,0)
 W !!,RCWRLINE
"RTN","RCXFMSW1",117,0)
 W !,"TRANSACTION NUMBER: ",RCTRANDA
"RTN","RCXFMSW1",118,0)
 W ?40,"WAIVED AMOUNT: ",$J($P(DATA1,"^",5),0,2)
"RTN","RCXFMSW1",119,0)
 W !,"BILL NUMBER: ",$P($G(^PRCA(430,+$P(DATA0,"^",2),0)),"^")
"RTN","RCXFMSW1",120,0)
 S Y=$P($P(DATA1,"^"),".") I Y D DD^%DT
"RTN","RCXFMSW1",121,0)
 W ?42,"WAIVED DATE: ",Y
"RTN","RCXFMSW1",122,0)
 W !?8,"Principal Waived: ",$J($P(DATA8,"^"),9,2)
"RTN","RCXFMSW1",123,0)
 W !?8," Interest Waived: ",$J($P(DATA8,"^",2),9,2)
"RTN","RCXFMSW1",124,0)
 W !?8,"    Admin Waived: ",$J($P(DATA8,"^",3)+$P(DATA8,"^",4)+$P(DATA8,"^",5),9,2)
"RTN","RCXFMSW1",125,0)
 W !?26,"---------"
"RTN","RCXFMSW1",126,0)
 W !?8,"    TOTAL Waived: ",$J($P(DATA8,"^")+$P(DATA8,"^",2)+$P(DATA8,"^",3)+$P(DATA8,"^",4)+$P(DATA8,"^",5),9,2)
"RTN","RCXFMSW1",127,0)
 W !!,RCWRLINE
"RTN","RCXFMSW1",128,0)
 Q
"RTN","RCXFMSW1",129,0)
 ;
"RTN","RCXFMSW1",130,0)
 ;
"RTN","RCXFMSW1",131,0)
ASKOK() ;  ask to regenerate write off document
"RTN","RCXFMSW1",132,0)
 N DIR,DIQ2,DIRUT,DTOUT,DUOUT,X,Y
"RTN","RCXFMSW1",133,0)
 S DIR(0)="YO",DIR("B")="NO"
"RTN","RCXFMSW1",134,0)
 S DIR("A")="Are you sure you want to regenerate the write off document to FMS"
"RTN","RCXFMSW1",135,0)
 W ! D ^DIR
"RTN","RCXFMSW1",136,0)
 I $G(DTOUT)!($G(DUOUT)) S Y=-1
"RTN","RCXFMSW1",137,0)
 Q Y
"VER")
8.0^22.0
"^DD",347,347,2,0)
FMS TRANSMISSION DATE^DI^^2;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",347,347,2,1,0)
^.1
"^DD",347,347,2,1,1,0)
347^FMS
"^DD",347,347,2,1,1,1)
S ^RC(347,"FMS",$E(X,1,30),DA)=""
"^DD",347,347,2,1,1,2)
K ^RC(347,"FMS",$E(X,1,30),DA)
"^DD",347,347,2,1,1,"%D",0)
^^2^2^3030814^
"^DD",347,347,2,1,1,"%D",1,0)
This is a cross-reference on the FMS TRANSMISSION DATE field.  That field 
"^DD",347,347,2,1,1,"%D",2,0)
stores the date that the document was transmitted to FMS.
"^DD",347,347,2,1,1,"DT")
3030814
"^DD",347,347,2,21,0)
^.001^1^1^3030814^^
"^DD",347,347,2,21,1,0)
This field contains the date this document was transmitted to FMS.
"^DD",347,347,2,23,0)
^^2^2^3030814^
"^DD",347,347,2,23,1,0)
 
"^DD",347,347,2,23,2,0)
 
"^DD",347,347,2,"DT")
3030819
"^DD",430,430,266,0)
FMS TRANSMISSION DATE^DI^^203;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",430,430,266,1,0)
^.1
"^DD",430,430,266,1,1,0)
430^FMS
"^DD",430,430,266,1,1,1)
S ^PRCA(430,"FMS",$E(X,1,30),DA)=""
"^DD",430,430,266,1,1,2)
K ^PRCA(430,"FMS",$E(X,1,30),DA)
"^DD",430,430,266,1,1,"%D",0)
^^2^2^3030814^
"^DD",430,430,266,1,1,"%D",1,0)
This is a cross-reference on the FMS TRANSMISSION DATE field.  That field 
"^DD",430,430,266,1,1,"%D",2,0)
stores the date that the document was transmitted to FMS.
"^DD",430,430,266,1,1,"DT")
3030814
"^DD",430,430,266,21,0)
^.001^1^1^3030814^^
"^DD",430,430,266,21,1,0)
This field contains the date this document was transmitted to FMS.
"^DD",430,430,266,23,0)
^^2^2^3030814^
"^DD",430,430,266,23,1,0)
 
"^DD",430,430,266,23,2,0)
 
"^DD",430,430,266,"DT")
3030819
**END**
**END**
