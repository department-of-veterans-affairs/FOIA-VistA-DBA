Released DG*5.3*756 SEQ #672
Extracted from mail message
**KIDS**:DG*5.3*756^

**INSTALL NAME**
DG*5.3*756
"BLD",2546,0)
DG*5.3*756^REGISTRATION^0^3070821^y
"BLD",2546,1,0)
^^3^3^3070716^
"BLD",2546,1,1,0)
UPDATE THE ALIAS MULTIPLE
"BLD",2546,1,2,0)
Refer to patch DG*5.3*756 in the FORUM Patch Module for a complete
"BLD",2546,1,3,0)
description.
"BLD",2546,4,0)
^9.64PA^^
"BLD",2546,6.3)
5
"BLD",2546,"ABNS",0)
^9.66A^^
"BLD",2546,"ABPKG")
^^
"BLD",2546,"KRN",0)
^9.67PA^8989.52^19
"BLD",2546,"KRN",.4,0)
.4
"BLD",2546,"KRN",.401,0)
.401
"BLD",2546,"KRN",.402,0)
.402
"BLD",2546,"KRN",.403,0)
.403
"BLD",2546,"KRN",.5,0)
.5
"BLD",2546,"KRN",.84,0)
.84
"BLD",2546,"KRN",3.6,0)
3.6
"BLD",2546,"KRN",3.8,0)
3.8
"BLD",2546,"KRN",9.2,0)
9.2
"BLD",2546,"KRN",9.8,0)
9.8
"BLD",2546,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",2546,"KRN",9.8,"NM",1,0)
VAFCPTED^^0^B12372310
"BLD",2546,"KRN",9.8,"NM",2,0)
VAFCEHU3^^0^B19512600
"BLD",2546,"KRN",9.8,"NM",3,0)
VAFCSB^^0^B8457410
"BLD",2546,"KRN",9.8,"NM","B","VAFCEHU3",2)

"BLD",2546,"KRN",9.8,"NM","B","VAFCPTED",1)

"BLD",2546,"KRN",9.8,"NM","B","VAFCSB",3)

"BLD",2546,"KRN",19,0)
19
"BLD",2546,"KRN",19.1,0)
19.1
"BLD",2546,"KRN",101,0)
101
"BLD",2546,"KRN",409.61,0)
409.61
"BLD",2546,"KRN",771,0)
771
"BLD",2546,"KRN",870,0)
870
"BLD",2546,"KRN",8989.51,0)
8989.51
"BLD",2546,"KRN",8989.52,0)
8989.52
"BLD",2546,"KRN",8994,0)
8994
"BLD",2546,"KRN","B",.4,.4)

"BLD",2546,"KRN","B",.401,.401)

"BLD",2546,"KRN","B",.402,.402)

"BLD",2546,"KRN","B",.403,.403)

"BLD",2546,"KRN","B",.5,.5)

"BLD",2546,"KRN","B",.84,.84)

"BLD",2546,"KRN","B",3.6,3.6)

"BLD",2546,"KRN","B",3.8,3.8)

"BLD",2546,"KRN","B",9.2,9.2)

"BLD",2546,"KRN","B",9.8,9.8)

"BLD",2546,"KRN","B",19,19)

"BLD",2546,"KRN","B",19.1,19.1)

"BLD",2546,"KRN","B",101,101)

"BLD",2546,"KRN","B",409.61,409.61)

"BLD",2546,"KRN","B",771,771)

"BLD",2546,"KRN","B",870,870)

"BLD",2546,"KRN","B",8989.51,8989.51)

"BLD",2546,"KRN","B",8989.52,8989.52)

"BLD",2546,"KRN","B",8994,8994)

"BLD",2546,"QUES",0)
^9.62^^
"BLD",2546,"REQB",0)
^9.611^3^3
"BLD",2546,"REQB",1,0)
DG*5.3*333^2
"BLD",2546,"REQB",2,0)
DG*5.3*620^2
"BLD",2546,"REQB",3,0)
DG*5.3*707^2
"BLD",2546,"REQB","B","DG*5.3*333",1)

"BLD",2546,"REQB","B","DG*5.3*620",2)

"BLD",2546,"REQB","B","DG*5.3*707",3)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813^2970721^12541
"PKG",5,22,1,"PAH",1,0)
756^3070821
"PKG",5,22,1,"PAH",1,1,0)
^^3^3^3070821
"PKG",5,22,1,"PAH",1,1,1,0)
UPDATE THE ALIAS MULTIPLE
"PKG",5,22,1,"PAH",1,1,2,0)
Refer to patch DG*5.3*756 in the FORUM Patch Module for a complete
"PKG",5,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","VAFCEHU3")
0^2^B19512600^B18681050
"RTN","VAFCEHU3",1,0)
VAFCEHU3 ;BIR/LTL,PTD-File utilities for 391.98 ;10/23/02
"RTN","VAFCEHU3",2,0)
 ;;5.3;Registration;**149,295,384,474,477,479,620,756**;Aug 13, 1993;Build 5
"RTN","VAFCEHU3",3,0)
 ;
"RTN","VAFCEHU3",4,0)
 ;Check for select fields that if edited can update without review
"RTN","VAFCEHU3",5,0)
EN ;
"RTN","VAFCEHU3",6,0)
 N VAFC,VAFCE,VAFCF S VAFCF=1
"RTN","VAFCEHU3",7,0)
 ;Save the array so a new one can be built for edit
"RTN","VAFCEHU3",8,0)
 M VAFC=@VAFCB K @VAFCB
"RTN","VAFCEHU3",9,0)
 F  S VAFCE=$P(VAFC(2,"FLD"),";",VAFCF) Q:'VAFCE  S VAFCF=VAFCF+1 D
"RTN","VAFCEHU3",10,0)
 .Q:(VAFCE>.01&(VAFCE<.111))!(VAFCE>.219)
"RTN","VAFCEHU3",11,0)
 .S @VAFCB@(2,VAFCE)=$G(VAFC(2,VAFCE)) ;**756 added $get
"RTN","VAFCEHU3",12,0)
 ;save the sending site's station number
"RTN","VAFCEHU3",13,0)
 I $D(VAFC(2,"SENDING SITE")) S @VAFCB@(2,"SENDING SITE")=VAFC(2,"SENDING SITE")
"RTN","VAFCEHU3",14,0)
ED ;D:$D(VAFCB) EDIT^VAFCPTED(PAT,VAFCB_"(2)",".01") ;**295 auto-updated fields - removed .111;.112;.113;.114;.115;.1112;.117;.131;.132;.211;.219 ;**474 stop all auto-updates
"RTN","VAFCEHU3",15,0)
 ;restore the array for possible exceptions
"RTN","VAFCEHU3",16,0)
 M @VAFCB=VAFC
"RTN","VAFCEHU3",17,0)
CH ;Any differences?
"RTN","VAFCEHU3",18,0)
 N DFN,DGNAME ;**295,**384
"RTN","VAFCEHU3",19,0)
 S DFN=PAT,VAFCQ=0,VAFCF=@VAFCB@(2,"FLD") D DEM^VADPT
"RTN","VAFCEHU3",20,0)
 ;reformat problem data
"RTN","VAFCEHU3",21,0)
 I @VAFCB@(2,.05)="N" S @VAFCB@(2,.05)="NEVER MARRIED" ;**477
"RTN","VAFCEHU3",22,0)
 ;If not null and different or null and edited and different,
"RTN","VAFCEHU3",23,0)
 ;we got an exception, we're out of here
"RTN","VAFCEHU3",24,0)
 ;NAME - .01 - VADM(1)
"RTN","VAFCEHU3",25,0)
 I '$$COMP^VAFCUTL(VADM(1),@VAFCB@(2,.01)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",26,0)
 ;SEX - .02 - VADM(5)
"RTN","VAFCEHU3",27,0)
 I (@VAFCB@(2,.02)'[U)&(($P(VADM(5),U,2)'=@VAFCB@(2,.02))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",28,0)
 ;DOB - .03 - VADM(3)
"RTN","VAFCEHU3",29,0)
 I (@VAFCB@(2,.03)'=$P(VADM(3),U)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",30,0)
 ;MARITAL STATUS - .05 - VADM(10)
"RTN","VAFCEHU3",31,0)
 I (@VAFCB@(2,.05)'="""@"""),($P(VADM(10),U,2)'=@VAFCB@(2,.05)),(@VAFCB@(2,.05)'[U) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",32,0)
 ;RELIGION - .08 - VADM(9)
"RTN","VAFCEHU3",33,0)
 I (@VAFCB@(2,.08)'[U),($P(VADM(9),U,2)'=@VAFCB@(2,.08)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",34,0)
 ;SSN - .09 - VADM(2)
"RTN","VAFCEHU3",35,0)
 I (@VAFCB@(2,.09)'=$P(VADM(2),U)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",36,0)
 ;get some address stuff
"RTN","VAFCEHU3",37,0)
 D ADD^VADPT
"RTN","VAFCEHU3",38,0)
 ;STREET ADDRESS [1] - .111 - VAPA(1)
"RTN","VAFCEHU3",39,0)
 ;I (@VAFCB@(2,.111)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.111),VAPA(1)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",40,0)
 ;STREET ADDRESS [2] - .112 - VAPA(2)
"RTN","VAFCEHU3",41,0)
 ;I (@VAFCB@(2,.112)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.112),VAPA(2)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",42,0)
 ;STREET ADDRESS [3] - .113 - VAPA(3)
"RTN","VAFCEHU3",43,0)
 ;I (@VAFCB@(2,.113)'="""@"""),'$$COMP^VAFCUTL(@VAFCB@(2,.113),VAPA(3)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",44,0)
 ;CITY - .114 - VAPA(4)
"RTN","VAFCEHU3",45,0)
 ;I (@VAFCB@(2,.114)'="""@"""),'$$COMP^VAFCUTL(VAPA(4),@VAFCB@(2,.114)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",46,0)
 ;STATE - .115 - VAPA(5)
"RTN","VAFCEHU3",47,0)
 ;I (@VAFCB@(2,.115)'="""@"""),($P(VAPA(5),U,2)'=@VAFCB@(2,.115)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",48,0)
 ;ZIP+4 - .1112 - VAPA(11)
"RTN","VAFCEHU3",49,0)
 ;I (@VAFCB@(2,.1112)'="""@"""),(@VAFCB@(2,.1112)'=$P(VAPA(11),U,2)) S VAFCQ=1 G CHQ ;**477 added u,2) ;**479
"RTN","VAFCEHU3",50,0)
 ;COUNTY CODE - .117 - VAPA(7)
"RTN","VAFCEHU3",51,0)
 ;I @VAFCB@(2,.117),(@VAFCB@(2,.117)'=$P(VAPA(7),U)) S VAFCQ=1 G CHQ ;**479
"RTN","VAFCEHU3",52,0)
 ;PHONE HOME - .131 - VAPA(8)
"RTN","VAFCEHU3",53,0)
 I ($G(@VAFCB@(2,.131))'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(8)),$$HLPHONE^HLFNC($G(@VAFCB@(2,.131)))) S VAFCQ=1 G CHQ ;**384 ;**756 added $get's
"RTN","VAFCEHU3",54,0)
 ;Get the rest
"RTN","VAFCEHU3",55,0)
 D GETS^DIQ(2,DFN_",",".132;.211;.219;.2403;.301;.302;.31115;.323;.361;391;1901","","VAPA")
"RTN","VAFCEHU3",56,0)
 ;PHONE WORK - .132 - VAPA(2,DFN,.132)
"RTN","VAFCEHU3",57,0)
 I ($G(@VAFCB@(2,.132))'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(2,DFN_",",.132)),$$HLPHONE^HLFNC($G(@VAFCB@(2,.132)))) S VAFCQ=1 G CHQ ;**384 ;**756 added $get's
"RTN","VAFCEHU3",58,0)
 ;K-NAME - .211 - VAPA(2,DFN,.211)
"RTN","VAFCEHU3",59,0)
 I $S(VAPA(2,DFN_",",.211)="":0,1:1) S DGNAME=VAPA(2,DFN_",",.211) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35),VAPA(2,DFN_",",.211)=DGNAME ;**384 **477
"RTN","VAFCEHU3",60,0)
 I $S(@VAFCB@(2,.211)="":0,@VAFCB@(2,.211)["@":0,1:1) S DGNAME=@VAFCB@(2,.211) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35),@VAFCB@(2,.211)=DGNAME ;**384 **477
"RTN","VAFCEHU3",61,0)
 I (@VAFCB@(2,.211)'="""@"""),'$$COMP^VAFCUTL(VAPA(2,DFN_",",.211),@VAFCB@(2,.211)) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",62,0)
 ;K-PHONE - .219 - VAPA(2,DFN,.219)
"RTN","VAFCEHU3",63,0)
 I (@VAFCB@(2,.219)'="""@"""),'$$COMP^VAFCUTL($$HLPHONE^HLFNC(VAPA(2,DFN_",",.219)),$$HLPHONE^HLFNC(@VAFCB@(2,.219))) S VAFCQ=1 G CHQ ;**384
"RTN","VAFCEHU3",64,0)
 ;MOTHER'S MAIDEN NAME - .2403 - VAPA(2,DFN,.2403)
"RTN","VAFCEHU3",65,0)
 I $S(VAPA(2,DFN_",",.2403)="":0,1:1) S DGNAME=VAPA(2,DFN_",",.2403) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35,,2,,1),VAPA(2,DFN_",",.2403)=DGNAME ;**384 **477
"RTN","VAFCEHU3",66,0)
 I $S(@VAFCB@(2,.2403)="":0,@VAFCB@(2,.2403)["@":0,1:1) S DGNAME=@VAFCB@(2,.2403) D STDNAME^XLFNAME(.DGNAME,"P") S DGNAME=$$FORMAT^XLFNAME7(.DGNAME,3,35,,2,,1),@VAFCB@(2,.2403)=DGNAME ;**384 **477
"RTN","VAFCEHU3",67,0)
 I ((@VAFCB@(2,.2403)'="""@""")&('$$COMP^VAFCUTL(VAPA(2,DFN_",",.2403),@VAFCB@(2,.2403))))!((@VAFCB@(2,.2403)="""@""")&((VAFCF[".2403;"))&((VAPA(2,DFN_",",.2403)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",68,0)
 ;SERVICE CONNECTED - .301 - VAPA(2,DFN,.301)
"RTN","VAFCEHU3",69,0)
 ;I ((@VAFCB@(2,.301)'="""@""")&((VAPA(2,DFN_",",.301)'=@VAFCB@(2,.301))))!((@VAFCB@(2,.301)="""@""")&((VAFCF[".301;"))&((VAPA(2,DFN_",",.301)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",70,0)
 ;SC% - .302 - VAPA(2,DFN,.302)
"RTN","VAFCEHU3",71,0)
 ;I (@VAFCB@(2,.302)&((VAPA(2,DFN_",",.302)'=@VAFCB@(2,.302))))!((@VAFCB@(2,.302)="""@""")&((VAFCF[".302;"))&((VAPA(2,DFN_",",.302)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",72,0)
 ;EMPLOYMENT STATUS - .31115 - VAPA(2,DFN,.31115)
"RTN","VAFCEHU3",73,0)
 I ((@VAFCB@(2,.31115)'="""@""")&((VAPA(2,DFN_",",.31115)'=@VAFCB@(2,.31115))))!((@VAFCB@(2,.31115)="""@""")&((VAFCF[".31115;"))&((VAPA(2,DFN_",",.31115)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",74,0)
 ;PERIOD OF SERVICE - .323 - VAPA(2,DFN,.323)
"RTN","VAFCEHU3",75,0)
 ;I ((@VAFCB@(2,.323)'="""@""")&((VAPA(2,DFN_",",.323)'=@VAFCB@(2,.323))))!((@VAFCB@(2,.323)="""@""")&((VAFCF[".323;"))&((VAPA(2,DFN_",",.323)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",76,0)
 ;DATE OF DEATH - .351 - VAPA(2,DFN,.351)
"RTN","VAFCEHU3",77,0)
 S VAPA(2,DFN_",",.351)=$$GET1^DIQ(2,DFN_",",.351,"I")
"RTN","VAFCEHU3",78,0)
 I ((@VAFCB@(2,.351)'="""@""")&((@VAFCB@(2,.351)'=VAPA(2,DFN_",",.351))))!((@VAFCB@(2,.351)="""@""")&((VAFCF[".351"))&(VAPA(2,DFN_",",.351))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",79,0)
 ;PRIMARY ELIG CODE - .361 - VAPA(2,DFN,.361)
"RTN","VAFCEHU3",80,0)
 ;I (@VAFCB@(2,.361)]"")&(@VAFCB@(2,.361)'=VAPA(2,DFN_",",.361))!((@VAFCB@(2,.361)="")&((VAFCF[".361;"))&((@VAFCB@(2,.361)'=VAPA(2,DFN_",",.361)))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",81,0)
 ;PATIENT TYPE - 391 - VAPA(2,DFN,391)
"RTN","VAFCEHU3",82,0)
 ;I ((@VAFCB@(2,391)'="""@""")&(@VAFCB@(2,391)'=VAPA(2,DFN_",",391)))!((@VAFCB@(2,391)="""@""")&((VAFCF["391;"))&((VAPA(2,DFN_",",391)]""))) S VAFCQ=1 G CHQ
"RTN","VAFCEHU3",83,0)
 ;VETERAN (Y/N) - 1901 - VAPA(2,DFN,1901)
"RTN","VAFCEHU3",84,0)
 ;I ((@VAFCB@(2,1901)'="""@""")&(@VAFCB@(2,1901)'=VAPA(2,DFN_",",1901)))!((@VAFCB@(2,1901)="""@""")&((VAFCF["1901;"))&((VAPA(2,DFN_",",1901)]""))) S VAFCQ=1
"RTN","VAFCEHU3",85,0)
CHQ D:'$G(VAFCQ) EN^VAFCEHU4
"RTN","VAFCEHU3",86,0)
 D KVA^VADPT Q
"RTN","VAFCPTED")
0^1^B12372310^B2607851
"RTN","VAFCPTED",1,0)
VAFCPTED ;ISA/RJS,Zoltan-EDIT EXISTING PATIENT ;04/06/99
"RTN","VAFCPTED",2,0)
 ;;5.3;Registration;**149,333,756**;Aug 13, 1993;Build 5
"RTN","VAFCPTED",3,0)
EDIT(DGDFN,ARRAY,STRNGDR) ;-- Edits existing patient
"RTN","VAFCPTED",4,0)
 ;Input:
"RTN","VAFCPTED",5,0)
 ;  DGDFN - IEN in the PATIENT (#2) file
"RTN","VAFCPTED",6,0)
 ;  ARRAY - Array containing fields to be edited.
"RTN","VAFCPTED",7,0)
 ;          Ex. ARRAY(.111)="123 STREET" or ARRAY(2,.111)="123...
"RTN","VAFCPTED",8,0)
 ;  STRNGDR - String of delimited PATIENT (#2) file fields in the order 
"RTN","VAFCPTED",9,0)
 ;            in which the fields will be processed by DIE.
"RTN","VAFCPTED",10,0)
 ;            Ex. ".01;.03;.05..."
"RTN","VAFCPTED",11,0)
 ;Output:
"RTN","VAFCPTED",12,0)
 ;  No output
"RTN","VAFCPTED",13,0)
 ;
"RTN","VAFCPTED",14,0)
 S U="^"
"RTN","VAFCPTED",15,0)
 N LOCKFLE,FLD,ZTQUEUED,DIQUIET,OLDZIP,VAFCX,STRNG
"RTN","VAFCPTED",16,0)
 S (ZTQUEUED,DIQUIET)=1
"RTN","VAFCPTED",17,0)
 L +^DPT(DGDFN):60
"RTN","VAFCPTED",18,0)
 S LOCKFLE=$T ; Need to remember whether the lock went through.
"RTN","VAFCPTED",19,0)
 I $L($G(@ARRAY@(.1112)))=5 D
"RTN","VAFCPTED",20,0)
 . ; This section prevents a 5-digit ZIP from replacing
"RTN","VAFCPTED",21,0)
 . ; an otherwise equivalent ZIP+4.
"RTN","VAFCPTED",22,0)
 . S OLDZIP=$$GET1^DIQ(2,DGDFN_",",.1112,"I")
"RTN","VAFCPTED",23,0)
 . I $E(OLDZIP,1,5)=@ARRAY@(.1112) S @ARRAY@(.1112)=OLDZIP
"RTN","VAFCPTED",24,0)
 ;process the given PATIENT file DR string in the given order
"RTN","VAFCPTED",25,0)
 S STRNG=STRNGDR F VAFCX=1:1 Q:STRNG=""  S FLD=$P(STRNGDR,";",VAFCX) S STRNG=$P(STRNGDR,";",VAFCX+1,$L(STRNGDR,";")) D LOAD
"RTN","VAFCPTED",26,0)
 ;
"RTN","VAFCPTED",27,0)
 ;Do Address Bulletin if incoming Address does not equal existing
"RTN","VAFCPTED",28,0)
 ;Address - removed bulletin with patch DG*5.3*333
"RTN","VAFCPTED",29,0)
 ;
"RTN","VAFCPTED",30,0)
 ;I $D(@ARRAY@(.111))!$D(@ARRAY@(.112))!$D(@ARRAY@(.113))!$D(@ARRAY@(.114))!$D(@ARRAY@(.115))!$D(@ARRAY@(.117))!$D(@ARRAY@(.1112)) D  ;**333
"RTN","VAFCPTED",31,0)
 ;. D ADDRESS^RGRSBULL(DGDFN,$G(@ARRAY@(.01)),$G(@ARRAY@(.111)),$G(@ARRAY@(.112)),$G(@ARRAY@(.113)),@ARRAY@("SENDING SITE"),$G(@ARRAY@(.114)),$G(@ARRAY@(.117)),$G(@ARRAY@(.115)),$G(@ARRAY@(.1112)))
"RTN","VAFCPTED",32,0)
 ;
"RTN","VAFCPTED",33,0)
 I LOCKFLE L -^DPT(DGDFN)
"RTN","VAFCPTED",34,0)
 ;
"RTN","VAFCPTED",35,0)
 K DIE,DA
"RTN","VAFCPTED",36,0)
 Q
"RTN","VAFCPTED",37,0)
 ;
"RTN","VAFCPTED",38,0)
LOAD ; -- Loads fields to patient file
"RTN","VAFCPTED",39,0)
 N DR,DIE
"RTN","VAFCPTED",40,0)
 ;**756 check if updating ALIAS
"RTN","VAFCPTED",41,0)
 I FLD=1 D ALIAS Q
"RTN","VAFCPTED",42,0)
 S DA=DGDFN,DIE="^DPT("
"RTN","VAFCPTED",43,0)
 I $G(@ARRAY@(FLD))="" Q
"RTN","VAFCPTED",44,0)
 I $G(@ARRAY@(FLD))["@" S @ARRAY@(FLD)="@"
"RTN","VAFCPTED",45,0)
 ;GENERATE BULLETIN FOR CONDITION BELOW ?
"RTN","VAFCPTED",46,0)
 I $G(@ARRAY@(FLD))[U Q
"RTN","VAFCPTED",47,0)
 S DR=FLD_"///^S X=$G(@ARRAY@(FLD))"
"RTN","VAFCPTED",48,0)
 D ^DIE
"RTN","VAFCPTED",49,0)
 Q
"RTN","VAFCPTED",50,0)
 ;
"RTN","VAFCPTED",51,0)
ALIAS ; update Alias multiple **756
"RTN","VAFCPTED",52,0)
 ;allow the synchronizing of the Alias multiple with the data passed in the array
"RTN","VAFCPTED",53,0)
 ;array(1,x)=name (last, first middle suffix format)^ssn
"RTN","VAFCPTED",54,0)
 N HAVE,I,MIEN,ADD,DONE,FDA,MPIFERR,DEL,ALIAS,CNT
"RTN","VAFCPTED",55,0)
 M HAVE=^DPT(DGDFN,.01)
"RTN","VAFCPTED",56,0)
 S CNT=0
"RTN","VAFCPTED",57,0)
 ;see if any need to be added
"RTN","VAFCPTED",58,0)
 S I=0 F  S I=$O(@ARRAY@(1,I)) Q:'I  D  ;loop through incoming data
"RTN","VAFCPTED",59,0)
 . S ADD=1,(DONE,MIEN)=0 F  S MIEN=$O(HAVE(MIEN)) Q:'MIEN  D  I DONE Q  ;loop through existing data
"RTN","VAFCPTED",60,0)
 ..I $P(@ARRAY@(1,I),"^",1,2)=$P($G(HAVE(MIEN,0)),"^",1,2) S ADD=0,DONE=1 Q  ;compare to existing data to see if already in subfile, if not then
"RTN","VAFCPTED",61,0)
 .I ADD S ALIAS=@ARRAY@(1,I) D  ;add new entry to subfile
"RTN","VAFCPTED",62,0)
 ..S FDA(2.01,"+"_I_","_DGDFN_",",.01)=$P(@ARRAY@(1,I),"^")
"RTN","VAFCPTED",63,0)
 ..S FDA(2.01,"+"_I_","_DGDFN_",",1)=$P(@ARRAY@(1,I),"^",2)
"RTN","VAFCPTED",64,0)
 I $D(FDA) D UPDATE^DIE("E","FDA",,"MPIFERR") I $G(MPIFERR("DIERR",1,"TEXT",1))'="" S RGER="-1^"_MPIFERR("DIERR",1,"TEXT",1)
"RTN","VAFCPTED",65,0)
 ;delete entries
"RTN","VAFCPTED",66,0)
 K FDA,MPIFERR
"RTN","VAFCPTED",67,0)
 S MIEN=0 F  S MIEN=$O(HAVE(MIEN)) Q:'MIEN  D  ;loop through existing data
"RTN","VAFCPTED",68,0)
 . S DEL=1,(DONE,I)=0 F  S I=$O(@ARRAY@(1,I)) Q:'I  D  I DONE Q  ;loop through incoming data
"RTN","VAFCPTED",69,0)
 . . I $P($G(HAVE(MIEN,0)),"^",1,2)=$P(@ARRAY@(1,I),"^",1,2) S DEL=0,DONE=1 Q  ;compare to existing data to see if data should be deleted
"RTN","VAFCPTED",70,0)
 . I DEL S FDA(2.01,MIEN_","_DGDFN_",",.01)="@" ;existing entry to delete
"RTN","VAFCPTED",71,0)
 I $D(FDA) D FILE^DIE("E","FDA","MPIERR") I $G(MPIFERR("DIERR",1,"TEXT",1))'=""  S RGER="-1^"_MPIFERR("DIERR",1,"TEXT",1) ;delete entry
"RTN","VAFCPTED",72,0)
 Q
"RTN","VAFCSB")
0^3^B8457410^B7574512
"RTN","VAFCSB",1,0)
VAFCSB ;BIR/CMC-CONT ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS ;8/21/06
"RTN","VAFCSB",2,0)
 ;;5.3;Registration;**707,756**;Aug 13, 1993;Build 5
"RTN","VAFCSB",3,0)
 ;
"RTN","VAFCSB",4,0)
 ;Reference to $$XAMDT^RAO7UTL1 is supported by IA #4875
"RTN","VAFCSB",5,0)
 ;Reference to RESUTLS^LRPXAPI is supported by IA #4245
"RTN","VAFCSB",6,0)
 ;
"RTN","VAFCSB",7,0)
PV2() ;build pv2 segment
"RTN","VAFCSB",8,0)
 N PV2,LSTA,APPT,VASD,VAIP,VARP,VAROOT
"RTN","VAFCSB",9,0)
 S PV2=""
"RTN","VAFCSB",10,0)
 ;get next outpatient appointment
"RTN","VAFCSB",11,0)
 K ^UTILITY("VASD",$J) S VASD("F")=DT D SDA^VADPT
"RTN","VAFCSB",12,0)
 S APPT=$P($G(^UTILITY("VASD",$J,1,"I")),"^")
"RTN","VAFCSB",13,0)
 I APPT'="" S $P(PV2,HL("FS"),9)=$$HLDATE^HLFNC(APPT)
"RTN","VAFCSB",14,0)
 ;GET LAST ADMISSION DATE
"RTN","VAFCSB",15,0)
 K VAIP S VAIP("D")="LAST",VAIP("M")=0 D IN5^VADPT
"RTN","VAFCSB",16,0)
 I VAIP(2)="1^ADMISSION" S $P(PV2,HL("FS"),15)=$$HLDATE^HLFNC($P(VAIP(3),"^"))
"RTN","VAFCSB",17,0)
 ;get last registration
"RTN","VAFCSB",18,0)
 S VAROOT="VARP"
"RTN","VAFCSB",19,0)
 D REG^VADPT
"RTN","VAFCSB",20,0)
 I $D(VARP(1,"I")),$G(VARP(1,"I"))>0 S $P(PV2,HL("FS"),46)=$$HLDATE^HLFNC($P(VARP(1,"I"),"^"),"DT"),$P(PV2,HL("FS"),24)="CR"
"RTN","VAFCSB",21,0)
 ;**756 ^ ONLY RETURN DATE FOR LAST REGISTRATION AS HL7 STANDARD CAN ONLY HAVE DATE
"RTN","VAFCSB",22,0)
 I PV2'="" S PV2="PV2"_HL("FS")_PV2
"RTN","VAFCSB",23,0)
 Q PV2
"RTN","VAFCSB",24,0)
PHARA() ;build obx to show active prescriptions
"RTN","VAFCSB",25,0)
 N RET S RET=""
"RTN","VAFCSB",26,0)
 I '$$PATCH^XPDUTL("PSS*1.0*101") Q RET
"RTN","VAFCSB",27,0)
 N PHARM,DGLIST
"RTN","VAFCSB",28,0)
 S PHARM="" D PROF^PSO52API(DFN,"DGLIST")
"RTN","VAFCSB",29,0)
 I +$G(^TMP($J,"DGLIST",DFN,0))>0 S PHARM="OBX"_HL("FS")_HL("FS")_"CE"_HL("FS")_"ACTIVE PRESCRIPTIONS"_HL("FS")_HL("FS")_"Y"
"RTN","VAFCSB",30,0)
 ;**756 CE added as the data type
"RTN","VAFCSB",31,0)
 Q PHARM
"RTN","VAFCSB",32,0)
LABE() ;BUILD OBX FOR LAST LAB TEST DATE
"RTN","VAFCSB",33,0)
 N OBX S OBX=""
"RTN","VAFCSB",34,0)
 I '$$PATCH^XPDUTL("LR*5.2*295") Q OBX
"RTN","VAFCSB",35,0)
 N LAB,LAB2,EN
"RTN","VAFCSB",36,0)
 S LAB="" K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"C")
"RTN","VAFCSB",37,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB=$P($G(^TMP("DGLAB",$J,EN)),"^")
"RTN","VAFCSB",38,0)
 K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"A")
"RTN","VAFCSB",39,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB2=$P($G(^TMP("DGLAB",$J,EN)),"^") I LAB2>LAB S LAB=LAB2
"RTN","VAFCSB",40,0)
 K ^TMP("DGLAB",$J) D RESULTS^LRPXAPI("DGLAB",DFN,"M")
"RTN","VAFCSB",41,0)
 S EN=$O(^TMP("DGLAB",$J,"")) I EN'="" S LAB2=$P($G(^TMP("DGLAB",$J,EN)),"^") I LAB2>LAB S LAB=LAB2
"RTN","VAFCSB",42,0)
 I LAB'="" D
"RTN","VAFCSB",43,0)
 .S $P(OBX,HL("FS"),2)="TS" ;**756 added the data type
"RTN","VAFCSB",44,0)
 .S $P(OBX,HL("FS"),3)="LAST LAB TEST DATE/TIME"
"RTN","VAFCSB",45,0)
 .S $P(OBX,HL("FS"),11)="F"
"RTN","VAFCSB",46,0)
 .S $P(OBX,HL("FS"),14)=$$HLDATE^HLFNC(LAB)
"RTN","VAFCSB",47,0)
 .S OBX="OBX"_HL("FS")_OBX
"RTN","VAFCSB",48,0)
 Q OBX
"RTN","VAFCSB",49,0)
RADE() ;BUILD OBX FOR LAST RADIOLOGY TEST DATE
"RTN","VAFCSB",50,0)
 N RET S RET=""
"RTN","VAFCSB",51,0)
 I '$$PATCH^XPDUTL("RA*5.0*76") Q RET
"RTN","VAFCSB",52,0)
 N RAD,RADE
"RTN","VAFCSB",53,0)
 S RAD="",RADE=$$XAMDT^RAO7UTL1(DFN) I +RADE<1 Q RAD
"RTN","VAFCSB",54,0)
 I +RADE>0 D
"RTN","VAFCSB",55,0)
 .S $P(OBX,HL("FS"),2)="TS" ;**756 added the data type
"RTN","VAFCSB",56,0)
 .S $P(RAD,HL("FS"),3)="LAST RADIOLOGY EXAM DATE/TIME"
"RTN","VAFCSB",57,0)
 .S $P(RAD,HL("FS"),11)="F"
"RTN","VAFCSB",58,0)
 .S $P(RAD,HL("FS"),14)=$$HLDATE^HLFNC(RADE)
"RTN","VAFCSB",59,0)
 .S RAD="OBX"_HL("FS")_RAD
"RTN","VAFCSB",60,0)
 Q RAD
"RTN","VAFCSB",61,0)
PD1() ;BUILD PD1 segment
"RTN","VAFCSB",62,0)
 ;PREFERRED FACILITY -- NOT GOING TO BE PASSED PER IMDQ 9/7/06
"RTN","VAFCSB",63,0)
 N TEAM,PD1
"RTN","VAFCSB",64,0)
 S PD1=""
"RTN","VAFCSB",65,0)
 ;S TEAM=$$PREF^DGENPTA(DFN)
"RTN","VAFCSB",66,0)
 ;I TEAM'="" S PD1="PD1"_HL("FS")_HL("FS")_HL("FS")_$$STA^XUAF4(TEAM)
"RTN","VAFCSB",67,0)
 Q PD1
"RTN","VAFCSB",68,0)
PV1() ;BUILD PV1 SEGMENT
"RTN","VAFCSB",69,0)
 ;CURRENTLY ADMITTED?
"RTN","VAFCSB",70,0)
 N PV1,VAINDT
"RTN","VAFCSB",71,0)
 S PV1=""
"RTN","VAFCSB",72,0)
 S VAINDT=DT
"RTN","VAFCSB",73,0)
 D INP^VADPT
"RTN","VAFCSB",74,0)
 I $G(VAIN(1))'="" S $P(PV1,HL("FS"),44)=$$HLDATE^HLFNC($P(VAIN(7),"^")),PV1="PV1"_HL("FS")_PV1
"RTN","VAFCSB",75,0)
 K VAIN
"RTN","VAFCSB",76,0)
 Q PV1
"VER")
8.0^22.0
"BLD",2546,6)
^672
**END**
**END**
