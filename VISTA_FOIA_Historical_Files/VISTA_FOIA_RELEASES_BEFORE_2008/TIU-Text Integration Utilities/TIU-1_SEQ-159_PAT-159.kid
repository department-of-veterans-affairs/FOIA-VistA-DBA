Released TIU*1*159 SEQ #159
Extracted from mail message
**KIDS**:TIU*1.0*159^

**INSTALL NAME**
TIU*1.0*159
"BLD",4195,0)
TIU*1.0*159^TEXT INTEGRATION UTILITIES^0^3031215^y
"BLD",4195,1,0)
^^2^2^3030527^^
"BLD",4195,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",4195,1,2,0)
under TIU*1.0*159.
"BLD",4195,4,0)
^9.64PA^^0
"BLD",4195,"ABPKG")
n
"BLD",4195,"INI")
EN^TIUWRII1
"BLD",4195,"KRN",0)
^9.67PA^8989.52^19
"BLD",4195,"KRN",.4,0)
.4
"BLD",4195,"KRN",.401,0)
.401
"BLD",4195,"KRN",.402,0)
.402
"BLD",4195,"KRN",.403,0)
.403
"BLD",4195,"KRN",.5,0)
.5
"BLD",4195,"KRN",.84,0)
.84
"BLD",4195,"KRN",3.6,0)
3.6
"BLD",4195,"KRN",3.8,0)
3.8
"BLD",4195,"KRN",9.2,0)
9.2
"BLD",4195,"KRN",9.8,0)
9.8
"BLD",4195,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",4195,"KRN",9.8,"NM",1,0)
TIUWRIIS^^0^B41724372
"BLD",4195,"KRN",9.8,"NM",2,0)
TIUWRII1^^0^B28334840
"BLD",4195,"KRN",9.8,"NM","B","TIUWRII1",2)

"BLD",4195,"KRN",9.8,"NM","B","TIUWRIIS",1)

"BLD",4195,"KRN",19,0)
19
"BLD",4195,"KRN",19.1,0)
19.1
"BLD",4195,"KRN",101,0)
101
"BLD",4195,"KRN",409.61,0)
409.61
"BLD",4195,"KRN",771,0)
771
"BLD",4195,"KRN",870,0)
870
"BLD",4195,"KRN",8989.51,0)
8989.51
"BLD",4195,"KRN",8989.52,0)
8989.52
"BLD",4195,"KRN",8994,0)
8994
"BLD",4195,"KRN","B",.4,.4)

"BLD",4195,"KRN","B",.401,.401)

"BLD",4195,"KRN","B",.402,.402)

"BLD",4195,"KRN","B",.403,.403)

"BLD",4195,"KRN","B",.5,.5)

"BLD",4195,"KRN","B",.84,.84)

"BLD",4195,"KRN","B",3.6,3.6)

"BLD",4195,"KRN","B",3.8,3.8)

"BLD",4195,"KRN","B",9.2,9.2)

"BLD",4195,"KRN","B",9.8,9.8)

"BLD",4195,"KRN","B",19,19)

"BLD",4195,"KRN","B",19.1,19.1)

"BLD",4195,"KRN","B",101,101)

"BLD",4195,"KRN","B",409.61,409.61)

"BLD",4195,"KRN","B",771,771)

"BLD",4195,"KRN","B",870,870)

"BLD",4195,"KRN","B",8989.51,8989.51)

"BLD",4195,"KRN","B",8989.52,8989.52)

"BLD",4195,"KRN","B",8994,8994)

"BLD",4195,"PRE")

"BLD",4195,"QUES",0)
^9.62^^
"BLD",4195,"REQB",0)
^9.611^1^1
"BLD",4195,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",4195,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"INI")
EN^TIUWRII1
"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
159^3031215
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3031215
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1.0*159.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIUWRII1")
0^2^B28334840
"RTN","TIUWRII1",1,0)
TIUWRII1 ;SLC/AJB,AGP - War Related Illness and Injury Study Center ; 08/18/03
"RTN","TIUWRII1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**159**;Jun 20, 1997
"RTN","TIUWRII1",3,0)
 ;
"RTN","TIUWRII1",4,0)
 Q
"RTN","TIUWRII1",5,0)
EN ;
"RTN","TIUWRII1",6,0)
 X ^%ZOSF("EON") W $G(IOCUON),@IOF
"RTN","TIUWRII1",7,0)
 N FDA,FDAIEN,MSG,POP,TIUABORT,TIUDA,TIUFPRIV,TIUPRNT
"RTN","TIUWRII1",8,0)
 S TIUFPRIV=1,TIUPRNT=0
"RTN","TIUWRII1",9,0)
 I '$$PATCH^XPDUTL("TIU*1.0*159")!($$CHKTITLE(8925.1,"WRIISC ASSESSMENT NOTE")=-1) F  D  Q:TIUPRNT>0!($D(DUOUT))
"RTN","TIUWRII1",10,0)
 . D GETCLASS
"RTN","TIUWRII1",11,0)
 . I +TIUPRNT<0 W !!,"Installation Error:  Invalid Selection.",!
"RTN","TIUWRII1",12,0)
 I +TIUPRNT<0 W !,"Enter EN^TIUWRII1 at the programmer prompt to re-build note title and objects.",! H 1 Q
"RTN","TIUWRII1",13,0)
 I $$CHKTITLE(8925.1,"WRIISC ASSESSMENT NOTE")>0,'$$PATCH^XPDUTL("TIU*1.0*159") W !!,"Installation Error:  WRIISC Assessment Note already exists.",! Q
"RTN","TIUWRII1",14,0)
 I $$CHKTITLE(8930,"CLINICAL COORDINATOR")<0 W !!,"Installation Error:  Class owner cannot be defined.",! Q
"RTN","TIUWRII1",15,0)
 D DELOBJS,MKOBJS I $G(TIUABORT)>0 D DELOBJS H 2 Q
"RTN","TIUWRII1",16,0)
 I '$$PATCH^XPDUTL("TIU*1.0*159")!($$CHKTITLE(8925.1,"WRIISC ASSESSMENT NOTE")=-1) D
"RTN","TIUWRII1",17,0)
 . S FDA(8925.1,"+1,",.01)="WRIISC ASSESSMENT NOTE"
"RTN","TIUWRII1",18,0)
 . S FDA(8925.1,"+1,",.03)="WRIISC ASSESSMENT NOTE"
"RTN","TIUWRII1",19,0)
 . S FDA(8925.1,"+1,",.04)="DOC"
"RTN","TIUWRII1",20,0)
 . S FDA(8925.1,"+1,",.06)=$$CHKTITLE(8930,"CLINICAL COORDINATOR")
"RTN","TIUWRII1",21,0)
 . S FDA(8925.1,"+1,",.07)=11
"RTN","TIUWRII1",22,0)
 . S FDA(8925.1,"+1,",3.02)=1
"RTN","TIUWRII1",23,0)
 . S FDA(8925.1,"+1,",99)=$H
"RTN","TIUWRII1",24,0)
 . D UPDATE^DIE("","FDA","FDAIEN","MSG")
"RTN","TIUWRII1",25,0)
 . I $D(MSG) D  D DELOBJS Q
"RTN","TIUWRII1",26,0)
 .. W !!,"The following error message was returned:",!!
"RTN","TIUWRII1",27,0)
 .. S MSG="" F  S MSG=$O(MSG("DIERR",1,"TEXT",MSG)) Q:MSG=""  W MSG("DIERR",1,"TEXT",MSG),!
"RTN","TIUWRII1",28,0)
 . W !!,"Creation of WRIISC ASSESSMENT NOTE title successful...",! H 1
"RTN","TIUWRII1",29,0)
 . S TIUDA=FDAIEN(1)
"RTN","TIUWRII1",30,0)
 . S FDA(8925.14,"+2,"_TIUPRNT_",",.01)=FDAIEN(1)
"RTN","TIUWRII1",31,0)
 . S FDA(8925.14,"+2,"_TIUPRNT_",",4)="WRIISC Assessment Note"
"RTN","TIUWRII1",32,0)
 . D UPDATE^DIE("","FDA","FDAIEN","MSG")
"RTN","TIUWRII1",33,0)
 . I $D(MSG) D  Q
"RTN","TIUWRII1",34,0)
 .. W !!,"The following error message was returned:",!!
"RTN","TIUWRII1",35,0)
 .. S MSG="" F  S MSG=$O(MSG("DIERR",1,"TEXT",MSG)) Q:MSG=""  W MSG("DIERR",1,"TEXT",MSG),!
"RTN","TIUWRII1",36,0)
 . W !,"Addition of "_$P(^TIU(8925.1,TIUPRNT,0),U)_" as parent successful...",! H 1
"RTN","TIUWRII1",37,0)
 W !,"Update finished."
"RTN","TIUWRII1",38,0)
 D
"RTN","TIUWRII1",39,0)
 .N DIR,X,Y
"RTN","TIUWRII1",40,0)
 .S DIR(0)="E"
"RTN","TIUWRII1",41,0)
 .W ! D ^DIR
"RTN","TIUWRII1",42,0)
 Q
"RTN","TIUWRII1",43,0)
CHKTITLE(FILE,NAME) ;
"RTN","TIUWRII1",44,0)
 N DIC,X,Y
"RTN","TIUWRII1",45,0)
 S DIC=FILE,DIC(0)="X"
"RTN","TIUWRII1",46,0)
 S X=NAME
"RTN","TIUWRII1",47,0)
 D ^DIC
"RTN","TIUWRII1",48,0)
 Q +Y
"RTN","TIUWRII1",49,0)
GETCLASS ;
"RTN","TIUWRII1",50,0)
 N DIC,X,Y
"RTN","TIUWRII1",51,0)
 S DIC("A")="Select the DOCUMENT CLASS where the new title will be installed:  "
"RTN","TIUWRII1",52,0)
 S DIC(0)="AEQ",DIC="^TIU(8925.1,",DIC("S")="I $P(^(0),U,4)=""DC"""
"RTN","TIUWRII1",53,0)
 D ^DIC
"RTN","TIUWRII1",54,0)
 S TIUPRNT=+Y
"RTN","TIUWRII1",55,0)
 Q
"RTN","TIUWRII1",56,0)
GETLAB ;
"RTN","TIUWRII1",57,0)
 N DIC,X,Y
"RTN","TIUWRII1",58,0)
 S DIC("A")="Enter your site's local lab name for "_LABNAME_": "
"RTN","TIUWRII1",59,0)
 S DIC(0)="AEQ",DIC="^LAB(60,"
"RTN","TIUWRII1",60,0)
 W ! D ^DIC
"RTN","TIUWRII1",61,0)
 S LABIEN=+Y S:LABIEN>0 LABNAME=$P(Y,U,2)
"RTN","TIUWRII1",62,0)
 Q
"RTN","TIUWRII1",63,0)
MKOBJS ;
"RTN","TIUWRII1",64,0)
 N LABIEN,LABNAME,LINE,LINETXT,METHOD,NAME
"RTN","TIUWRII1",65,0)
 F LINE=1:1 S LINETXT=$P($T(DATA+LINE),";;",2) Q:LINETXT="EOM"!$G(TIUABORT)>0  D
"RTN","TIUWRII1",66,0)
 .S NAME=$P(LINETXT,";"),METHOD=$P(LINETXT,";",2)
"RTN","TIUWRII1",67,0)
 .S:METHOD["@" METHOD=$TR(METHOD,"@",";")
"RTN","TIUWRII1",68,0)
 .I $$CHKTITLE(8925.1,NAME)>0 W !!,"Installation Error:  TIU Object "_NAME_" already exists." H 1 Q
"RTN","TIUWRII1",69,0)
 .I METHOD="ASK USER" D
"RTN","TIUWRII1",70,0)
 ..N DUOUT,FLAG S FLAG=0
"RTN","TIUWRII1",71,0)
 ..S LABNAME=$P(LINETXT,";",3)
"RTN","TIUWRII1",72,0)
 ..I LABNAME="HEPATITIS C ANTIBODY" S FLAG=1
"RTN","TIUWRII1",73,0)
 ..S LABIEN=0
"RTN","TIUWRII1",74,0)
 ..F  Q:LABIEN>0!($D(DUOUT))  D GETLAB
"RTN","TIUWRII1",75,0)
 ..S:LABIEN>0 METHOD=$S(FLAG=1:"S X=$$LAB2^TIUWRIIS(DFN,"""_LABNAME_""",5,,1410102,$$NOW^XLFDT)",1:"S X=$$LAB2^TIUWRIIS(DFN,"""_LABNAME_""",5,""T-365"")")
"RTN","TIUWRII1",76,0)
 .I METHOD="ASK USER" D  S TIUABORT=1 Q
"RTN","TIUWRII1",77,0)
 ..W !!,"Installation Error:  TIU Object "_NAME_" creation aborted by user."
"RTN","TIUWRII1",78,0)
 ..W !,"Enter EN^TIUWRII1 at the programmer prompt to re-build note title and objects.",!
"RTN","TIUWRII1",79,0)
 ..W !,"See the patch description for more details."
"RTN","TIUWRII1",80,0)
 .I $$MKOBJ(NAME,METHOD)<0 D
"RTN","TIUWRII1",81,0)
 ..W !!,"Installation Error:  Creation of TIU Object "_NAME_" failed.",!
"RTN","TIUWRII1",82,0)
 Q
"RTN","TIUWRII1",83,0)
MKOBJ(NAME,METHOD) ;
"RTN","TIUWRII1",84,0)
 N FDA,FDAIEN,MSG
"RTN","TIUWRII1",85,0)
 S FDA(8925.1,"+1,",.01)=NAME
"RTN","TIUWRII1",86,0)
 S FDA(8925.1,"+1,",.03)=NAME
"RTN","TIUWRII1",87,0)
 S FDA(8925.1,"+1,",.04)="O"
"RTN","TIUWRII1",88,0)
 S FDA(8925.1,"+1,",.06)=$$CHKTITLE(8930,"CLINICAL COORDINATOR")
"RTN","TIUWRII1",89,0)
 S FDA(8925.1,"+1,",.07)=11
"RTN","TIUWRII1",90,0)
 S FDA(8925.1,"+1,",9)=METHOD
"RTN","TIUWRII1",91,0)
 S FDA(8925.1,"+1,",99)=$H
"RTN","TIUWRII1",92,0)
 D UPDATE^DIE("","FDA","FDAIEN","MSG")
"RTN","TIUWRII1",93,0)
 I $D(MSG) D  Q -1
"RTN","TIUWRII1",94,0)
 . W !!,"TIU Object creation failed.  The following error message was returned:",!!
"RTN","TIUWRII1",95,0)
 . S MSG="" F  S MSG=$O(MSG("DIERR",1,"TEXT",MSG)) Q:MSG=""  W MSG("DIERR",1,"TEXT",MSG),!
"RTN","TIUWRII1",96,0)
 W !!,"Creation of TIU Object "_NAME_" successful..." H 1
"RTN","TIUWRII1",97,0)
 Q 1
"RTN","TIUWRII1",98,0)
DELOBJS ;
"RTN","TIUWRII1",99,0)
 N DA,DIK,LINE,LINETXT,NAME,X,Y
"RTN","TIUWRII1",100,0)
 F LINE=1:1 S LINETXT=$P($T(DATA+LINE),";;",2) Q:LINETXT="EOM"  D
"RTN","TIUWRII1",101,0)
 .S NAME=$P(LINETXT,";")
"RTN","TIUWRII1",102,0)
 .S DA=0,DA=$O(^TIU(8925.1,"B",NAME,DA))
"RTN","TIUWRII1",103,0)
 .S DIK="^TIU(8925.1,"
"RTN","TIUWRII1",104,0)
 .I DA>0 D ^DIK
"RTN","TIUWRII1",105,0)
 Q
"RTN","TIUWRII1",106,0)
DATA ;
"RTN","TIUWRII1",107,0)
 ;;VA-WRIISC ADDRESS;S X=$$ADDRESS^TIUWRIIS(DFN)
"RTN","TIUWRII1",108,0)
 ;;VA-WRIISC ACTIVE PROBLEMS;S X=$$PROB^TIUWRIIS(DFN)
"RTN","TIUWRII1",109,0)
 ;;VA-WRIISC NEXT OF KIN;S X=$$PNOK^TIUWRIIS(DFN)
"RTN","TIUWRII1",110,0)
 ;;VA-WRIISC VITALS;S X=$$VITALS^TIUWRIIS(DFN,"T@BP@P@R",1,"T-90")
"RTN","TIUWRII1",111,0)
 ;;VA-WRIISC CBC;ASK USER;CBC
"RTN","TIUWRII1",112,0)
 ;;VA-WRIISC GLUCOSE;ASK USER;GLUCOSE
"RTN","TIUWRII1",113,0)
 ;;VA-WRIISC HEMATOCRIT;ASK USER;HEMATOCRIT
"RTN","TIUWRII1",114,0)
 ;;VA-WRIISC HEMOGLOBIN;ASK USER;HEMOGLOBIN
"RTN","TIUWRII1",115,0)
 ;;VA-WRIISC HEPATITIS C ANTIBODY;ASK USER;HEPATITIS C ANTIBODY
"RTN","TIUWRII1",116,0)
 ;;VA-WRIISC POTASSIUM;ASK USER;POTASSIUM
"RTN","TIUWRII1",117,0)
 ;;VA-WRIISC SODIUM;ASK USER;SODIUM
"RTN","TIUWRII1",118,0)
 ;;VA-WRIISC URINALYSIS;ASK USER;URINALYSIS
"RTN","TIUWRII1",119,0)
 ;;EOM
"RTN","TIUWRII1",120,0)
 Q
"RTN","TIUWRIIS")
0^1^B41724372
"RTN","TIUWRIIS",1,0)
TIUWRIIS ;SLC/AJB,AGP - War Related Illness and Injury Study Center ; 08/18/03
"RTN","TIUWRIIS",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**159**;Jun 20, 1997
"RTN","TIUWRIIS",3,0)
 ;
"RTN","TIUWRIIS",4,0)
 Q
"RTN","TIUWRIIS",5,0)
ADDRESS(DFN) ;
"RTN","TIUWRIIS",6,0)
 N TIUCNT,TIUI,TIUY,VAPA S TIUI=0
"RTN","TIUWRIIS",7,0)
 N TIUCITY,TIUST,TIUZIP
"RTN","TIUWRIIS",8,0)
 D ADD^VADPT
"RTN","TIUWRIIS",9,0)
 S TIUY=$NA(^TMP("TIUWRIISC",$J))
"RTN","TIUWRIIS",10,0)
 F TIUCNT=1:1:3 D
"RTN","TIUWRIIS",11,0)
 . Q:VAPA(TIUCNT)=""
"RTN","TIUWRIIS",12,0)
 . S TIUI=TIUI+1
"RTN","TIUWRIIS",13,0)
 . S @TIUY@(TIUI,0)=VAPA(TIUCNT) I TIUCNT>1 S @TIUY@(TIUI,0)="             "_@TIUY@(TIUI,0)
"RTN","TIUWRIIS",14,0)
 S TIUCITY="             "_VAPA(4)
"RTN","TIUWRIIS",15,0)
 S TIUST=$$GET1^DIQ(5,+VAPA(5),1)
"RTN","TIUWRIIS",16,0)
 S TIUZIP=VAPA(6)
"RTN","TIUWRIIS",17,0)
 S @TIUY@(4,0)=TIUCITY_", "_TIUST_"  "_TIUZIP
"RTN","TIUWRIIS",18,0)
 Q "~@"_$NA(@TIUY)
"RTN","TIUWRIIS",19,0)
LAB2(DFN,TIUTEST,COUNT,TPERIOD,TIUEDT,TIULDT) ; Get Lab Results
"RTN","TIUWRIIS",20,0)
 N CNT,DRANGE,INDATE,LABIEN,NUM,OUTPUT,REGDATE,SEQ,SEQ1,SUB,STRING
"RTN","TIUWRIIS",21,0)
 N TIULOUT,TIUY,TIUTST,TIUX,TMP1,TMP2
"RTN","TIUWRIIS",22,0)
 K ^TMP($J,"TIUWRIIS","LABOUT"),^TMP("LRRR",$J)
"RTN","TIUWRIIS",23,0)
 I $G(TPERIOD)="",$G(TIUEDT)="",$G(TIULDT)="" Q "<Invalid Date or Time Period Entered>"
"RTN","TIUWRIIS",24,0)
 I ($G(TPERIOD)?1"T-"1N.N) D
"RTN","TIUWRIIS",25,0)
 . S TIULDT=$$NOW^XLFDT D DT^DILF("P",TPERIOD,.DRANGE) S TIUEDT=$G(DRANGE)
"RTN","TIUWRIIS",26,0)
 I $G(COUNT)="" S COUNT=1
"RTN","TIUWRIIS",27,0)
 I $G(TIUTEST)="" Q "LAB NAME NOT FOUND"
"RTN","TIUWRIIS",28,0)
 S LABIEN=+$O(^LAB(60,"B",TIUTEST,0))
"RTN","TIUWRIIS",29,0)
 I '+$G(LABIEN) Q "INVALID LAB TEST NAME"
"RTN","TIUWRIIS",30,0)
 D RR^LR7OR1(DFN,"",$G(TIUEDT),$G(TIULDT),"",LABIEN,"",$G(COUNT),"",0)
"RTN","TIUWRIIS",31,0)
 I '$D(^TMP("LRRR",$J)) Q "No Lab Information Found for "_TIUTEST
"RTN","TIUWRIIS",32,0)
 S TIULOUT="^TMP($J,""TIUWRIIS"",""LABOUT"")",CNT=1,@TIULOUT@(CNT,0)="Lab Information for "_TIUTEST
"RTN","TIUWRIIS",33,0)
 S STRING=$$LJ^XLFSTR("Collection Date/Time",25),STRING=STRING_$$LJ^XLFSTR("Specimen",10)
"RTN","TIUWRIIS",34,0)
 S STRING=STRING_$$LJ^XLFSTR("Test",8),STRING=STRING_$$LJ^XLFSTR("Result",12)
"RTN","TIUWRIIS",35,0)
 S STRING=STRING_$$LJ^XLFSTR("Range",10),CNT=CNT+1,@TIULOUT@(CNT,0)=STRING
"RTN","TIUWRIIS",36,0)
 S SUB="" F  S SUB=$O(^TMP("LRRR",$J,DFN,SUB)) Q:SUB=""  D
"RTN","TIUWRIIS",37,0)
 . S INDATE=""  F  S INDATE=$O(^TMP("LRRR",$J,DFN,SUB,INDATE)) Q:+INDATE'>0  D
"RTN","TIUWRIIS",38,0)
 . . S SEQ="" F  S SEQ=$O(^TMP("LRRR",$J,DFN,SUB,INDATE,SEQ)) Q:SEQ=""  D
"RTN","TIUWRIIS",39,0)
 . . . I SEQ'="N" D
"RTN","TIUWRIIS",40,0)
 . . . . S CNT=CNT+1
"RTN","TIUWRIIS",41,0)
 . . . . S REGDATE=$$FMTE^XLFDT(9999999-INDATE)
"RTN","TIUWRIIS",42,0)
 . . . . S NODE=$G(^TMP("LRRR",$J,DFN,SUB,INDATE,SEQ))
"RTN","TIUWRIIS",43,0)
 . . . . S STRING=$$LJ^XLFSTR(REGDATE,25)
"RTN","TIUWRIIS",44,0)
 . . . . S STRING=STRING_$$LJ^XLFSTR($$GET1^DIQ(61,$P($G(NODE),U,19)_",",.01),10)
"RTN","TIUWRIIS",45,0)
 . . . . S STRING=STRING_$$LJ^XLFSTR($P($G(NODE),U,15),8)
"RTN","TIUWRIIS",46,0)
 . . . . S STRING=STRING_$$LJ^XLFSTR($P($G(NODE),U,2)_" "_$P($G(NODE),U,3)_$P($G(NODE),U,4),12)
"RTN","TIUWRIIS",47,0)
 . . . . S STRING=STRING_$$LJ^XLFSTR($P($G(NODE),U,5),10)
"RTN","TIUWRIIS",48,0)
 . . . . S @TIULOUT@(CNT,0)=STRING
"RTN","TIUWRIIS",49,0)
 . . . I SEQ="N" S SEQ1="" F  S SEQ1=$O(^TMP("LRRR",$J,DFN,SUB,INDATE,SEQ,SEQ1)) Q:+SEQ1'>0  D
"RTN","TIUWRIIS",50,0)
 . . . . S NODE=$G(^TMP("LRRR",$J,DFN,SUB,INDATE,SEQ,SEQ1))
"RTN","TIUWRIIS",51,0)
 . . . . I $G(NODE)["[" D
"RTN","TIUWRIIS",52,0)
 . . . . . S NAME=$P($G(NODE),"[",2),NAME=$P($G(NAME),"]",1)
"RTN","TIUWRIIS",53,0)
 . . . . . S NAME=$$GET1^DIQ(200,$G(NAME)_",",.01)
"RTN","TIUWRIIS",54,0)
 . . . . . S TMP1=$P($G(NODE),"["),TMP2=$P($G(NODE),"]",2)
"RTN","TIUWRIIS",55,0)
 . . . . . S NODE=TMP1_" "_NAME_" "_TMP2
"RTN","TIUWRIIS",56,0)
 . . . . S CNT=CNT+1,@TIULOUT@(CNT,0)="Comment: "_NODE
"RTN","TIUWRIIS",57,0)
 K ^TMP("LRRR",$J)
"RTN","TIUWRIIS",58,0)
LABQ Q "~@"_$NA(@TIULOUT)
"RTN","TIUWRIIS",59,0)
PNOK(DFN) ;
"RTN","TIUWRIIS",60,0)
 N CNT,PNOK,VAOA
"RTN","TIUWRIIS",61,0)
 K ^TMP($J,"TIUWRIIS","PNOK")
"RTN","TIUWRIIS",62,0)
 D OAD^VADPT
"RTN","TIUWRIIS",63,0)
 S CNT=1
"RTN","TIUWRIIS",64,0)
 S PNOK="^TMP($J,""TIUWRIIS"",""PNOK"")"
"RTN","TIUWRIIS",65,0)
 I $D(VAOA) D
"RTN","TIUWRIIS",66,0)
 . S @PNOK@(CNT,0)="Primary Next of Kin Information"
"RTN","TIUWRIIS",67,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",68,0)
 . S @PNOK@(CNT,0)=$S($G(VAOA(9))'="":$G(VAOA(9)),1:"No Next of Kin Enter")
"RTN","TIUWRIIS",69,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",70,0)
 . S @PNOK@(CNT,0)=$S($G(VAOA(10))'="":"Relationship to Patient: "_VAOA(10),1:"Relationship Unknown")
"RTN","TIUWRIIS",71,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",72,0)
 . I $G(VAOA(1))=""&($G(VAOA(2))="")&($G(VAOA(3))="") S @PNOK@(CNT,0)="No Address Information Enter"
"RTN","TIUWRIIS",73,0)
 . E  D
"RTN","TIUWRIIS",74,0)
 . . S @PNOK@(CNT,0)=$G(VAOA(1))
"RTN","TIUWRIIS",75,0)
 . . I $G(VAOA(2))'="" S @PNOK@(CNT,0)=@PNOK@(CNT,0)_" "_VAOA(2)
"RTN","TIUWRIIS",76,0)
 . . I $G(VAOA(3))'="" S CNT=CNT+1 S @PNOK@(CNT,0)=VAOA(3)
"RTN","TIUWRIIS",77,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",78,0)
 . I $G(VAOA(4))'="" S @PNOK@(CNT,0)=$G(VAOA(4))_", "_$P($G(VAOA(5)),U,2)_" "_$G(VAOA(6))
"RTN","TIUWRIIS",79,0)
 . I $G(VAOA(8))'="" S CNT=CNT+1 S @PNOK@(CNT,0)="Home Phone Number: "_VAOA(8)
"RTN","TIUWRIIS",80,0)
 E  Q "No Next Kin Information Found"
"RTN","TIUWRIIS",81,0)
 Q "~@"_$NA(@PNOK)
"RTN","TIUWRIIS",82,0)
 ;
"RTN","TIUWRIIS",83,0)
SNOK(DFN) ;
"RTN","TIUWRIIS",84,0)
 N CNT,VAOA
"RTN","TIUWRIIS",85,0)
 K ^TMP($J,"TIUWRIIS","SNOK")
"RTN","TIUWRIIS",86,0)
 S VAOA("A")=3
"RTN","TIUWRIIS",87,0)
 D OAD^VADPT
"RTN","TIUWRIIS",88,0)
 S CNT=1
"RTN","TIUWRIIS",89,0)
 S PNOK="^TMP($J,""TIUWRIIS"",""SNOK"")"
"RTN","TIUWRIIS",90,0)
 I $D(VAOA) D
"RTN","TIUWRIIS",91,0)
 . S @PNOK@(CNT,0)="Secondary Next of Kin Information"
"RTN","TIUWRIIS",92,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",93,0)
 . S @PNOK@(CNT,0)=$S($G(VAOA(9))'="":$G(VAOA(9)),1:"No Next of Kin Enter")
"RTN","TIUWRIIS",94,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",95,0)
 . S @PNOK@(CNT,0)=$S($G(VAOA(10))'="":"Relationship to Patient: "_VAOA(10),1:"Relationship Unknown")
"RTN","TIUWRIIS",96,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",97,0)
 . I $G(VAOA(1))=""&($G(VAOA(2))="")&($G(VAOA(3))="") S @PNOK@(CNT,0)="No Address Information Enter"
"RTN","TIUWRIIS",98,0)
 . E  D
"RTN","TIUWRIIS",99,0)
 . . S @PNOK@(CNT,0)=$G(VAOA(1))
"RTN","TIUWRIIS",100,0)
 . . I $G(VAOA(2))'="" S @PNOK@(CNT,0)=@PNOK@(CNT,0)_" "_VAOA(2)
"RTN","TIUWRIIS",101,0)
 . . I $G(VAOA(3))'="" S CNT=CNT+1 S @PNOK@(CNT,0)=VAOA(3)
"RTN","TIUWRIIS",102,0)
 . S CNT=CNT+1
"RTN","TIUWRIIS",103,0)
 . I $G(VAOA(4))'="" S @PNOK@(CNT,0)=$G(VAOA(4))_", "_$P($G(VAOA(5)),U,2)_" "_$G(VAOA(6))
"RTN","TIUWRIIS",104,0)
 . I $G(VAOA(8))'="" S CNT=CNT+1 S @PNOK@(CNT,0)="Home Phone Number: "_VAOA(8)
"RTN","TIUWRIIS",105,0)
 E  Q "No Next Kin Information Found"
"RTN","TIUWRIIS",106,0)
 Q "~@"_$NA(@PNOK)
"RTN","TIUWRIIS",107,0)
 ;
"RTN","TIUWRIIS",108,0)
VITALS(DFN,TEST,COUNT,TPERIOD) ; Return vitals for last 24 hours.
"RTN","TIUWRIIS",109,0)
 N %,CNT,DATE,END,GMRVSTR,IEN,INVDATE,NODE,START,TIUVITAL,VITAL,VITALS
"RTN","TIUWRIIS",110,0)
 K ^TMP($J,"TIUWRIIS","VITALS")
"RTN","TIUWRIIS",111,0)
 K ^UTILITY($J,"GMRVD")
"RTN","TIUWRIIS",112,0)
 I ($G(TPERIOD)?1"T-"1N.N) D
"RTN","TIUWRIIS",113,0)
 . D NOW^%DTC S END=%
"RTN","TIUWRIIS",114,0)
 . D DT^DILF("P",TPERIOD,.DRANGE)
"RTN","TIUWRIIS",115,0)
 . S START=$G(DRANGE)_"."_$P(END,".",2)
"RTN","TIUWRIIS",116,0)
 E  I $G(TPERIOD)'="" Q "INVALID DATE TIME PERIOD ENTER"
"RTN","TIUWRIIS",117,0)
 S CNT=1
"RTN","TIUWRIIS",118,0)
 S DATE=0
"RTN","TIUWRIIS",119,0)
 S TIUVITAL="^TMP($J,""TIUWRIIS"",""VITALS"")"
"RTN","TIUWRIIS",120,0)
 S GMRVSTR=$G(TEST)
"RTN","TIUWRIIS",121,0)
 S GMRVSTR(0)=START_U_END_U_COUNT_U_"1"
"RTN","TIUWRIIS",122,0)
 D EN1^GMRVUT0
"RTN","TIUWRIIS",123,0)
 I '$D(^UTILITY($J,"GMRVD")) S @TIUVITAL@(CNT,0)="No Vitals Were Found" Q "~@"_$NA(@TIUVITAL)
"RTN","TIUWRIIS",124,0)
 S INVDATE="" F  S INVDATE=$O(^UTILITY($J,"GMRVD",INVDATE)) Q:+INVDATE=0  D
"RTN","TIUWRIIS",125,0)
 . S VITAL="" F  S VITAL=$O(^UTILITY($J,"GMRVD",INVDATE,VITAL)) Q:VITAL=""  D
"RTN","TIUWRIIS",126,0)
 . .S IEN="" F  S IEN=$O(^UTILITY($J,"GMRVD",INVDATE,VITAL,IEN)) Q:+IEN=0  D
"RTN","TIUWRIIS",127,0)
 . . . S NODE=^UTILITY($J,"GMRVD",INVDATE,VITAL,IEN)
"RTN","TIUWRIIS",128,0)
 . . . I DATE'=INVDATE D  Q
"RTN","TIUWRIIS",129,0)
 . . . . S @TIUVITAL@(CNT,0)="Vitals Enter at: "_$$FMTE^XLFDT(9999999-INVDATE)
"RTN","TIUWRIIS",130,0)
 . . . . S CNT=CNT+1
"RTN","TIUWRIIS",131,0)
 . . . . S DATE=INVDATE
"RTN","TIUWRIIS",132,0)
 . . . . S @TIUVITAL@(CNT,0)=VITAL_": "_$P($G(NODE),U,8)
"RTN","TIUWRIIS",133,0)
 . . . . S CNT=CNT+1
"RTN","TIUWRIIS",134,0)
 . . . I DATE=INVDATE D
"RTN","TIUWRIIS",135,0)
 . . . . S @TIUVITAL@(CNT,0)=VITAL_": "_$P($G(NODE),U,8)
"RTN","TIUWRIIS",136,0)
 . . . . S CNT=CNT+1
"RTN","TIUWRIIS",137,0)
 K ^UTILITY($J,"GMRVD")
"RTN","TIUWRIIS",138,0)
 Q "~@"_$NA(@TIUVITAL)
"RTN","TIUWRIIS",139,0)
PROB(DFN) ; Get total active problem list for a patient
"RTN","TIUWRIIS",140,0)
 N CNT,CNT1,ROOT,NODE,STRING,TIUPOUT
"RTN","TIUWRIIS",141,0)
 K ^TMP($J,"TIUWRIIS","PROB")
"RTN","TIUWRIIS",142,0)
 S TIUPOUT="^TMP($J,""TIUWRIIS"",""PROB"")"
"RTN","TIUWRIIS",143,0)
 S CNT1=1
"RTN","TIUWRIIS",144,0)
 D LIST^GMPLUTL2(.ROOT,+DFN,"A")
"RTN","TIUWRIIS",145,0)
 I '$D(ROOT) Q "No Active Problem Found"
"RTN","TIUWRIIS",146,0)
 S @TIUPOUT@(CNT1,0)=$$LJ^XLFSTR("Code",10)_$$LJ^XLFSTR("Description",63) S CNT1=CNT1+1
"RTN","TIUWRIIS",147,0)
 S CNT=0 F  S CNT=$O(ROOT(CNT)) Q:'CNT  D
"RTN","TIUWRIIS",148,0)
 . S NODE=$G(ROOT(CNT)) Q:$P($G(NODE),U,10)["$"!($P($G(NODE),U,3)="")
"RTN","TIUWRIIS",149,0)
 . S STRING=$$LJ^XLFSTR($P($G(NODE),U,4),10)_$P($G(NODE),U,3)
"RTN","TIUWRIIS",150,0)
 . S @TIUPOUT@(CNT1,0)=STRING
"RTN","TIUWRIIS",151,0)
 . S CNT1=CNT1+1
"RTN","TIUWRIIS",152,0)
 Q "~@"_$NA(@TIUPOUT)
"VER")
8.0^22.0
**END**
**END**
