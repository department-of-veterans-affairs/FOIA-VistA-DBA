Released SD*5.3*371 SEQ #303
Extracted from mail message
**KIDS**:SD*5.3*371^

**INSTALL NAME**
SD*5.3*371
"BLD",5231,0)
SD*5.3*371^SCHEDULING^0^3040713^y
"BLD",5231,1,0)
^^10^10^3040621^
"BLD",5231,1,1,0)
Inclusion of additional fields for HL7 message transmissions to AAC. 
"BLD",5231,1,2,0)
The routine SDPMHLS, responsible for creating the structure of the HL7 
"BLD",5231,1,3,0)
message, has been modified to allow inclusion of data for 
"BLD",5231,1,4,0)
progress notes pending signatures and encounters without progress notes.
"BLD",5231,1,5,0)
 
"BLD",5231,1,6,0)
Totals for unique encounter providers and unique stop codes at the 
"BLD",5231,1,7,0)
division level should also now match the sum of the totals for these 
"BLD",5231,1,8,0)
values of each facility in that division.
"BLD",5231,1,9,0)
 
"BLD",5231,1,10,0)
Also removes reference to 'DSS' in mail group SD PM NOTIFICATION TIU.
"BLD",5231,4,0)
^9.64PA^^
"BLD",5231,"ABPKG")
n
"BLD",5231,"INID")
^y
"BLD",5231,"INIT")
SD53371P
"BLD",5231,"KRN",0)
^9.67PA^8989.52^19
"BLD",5231,"KRN",.4,0)
.4
"BLD",5231,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5231,"KRN",.401,0)
.401
"BLD",5231,"KRN",.402,0)
.402
"BLD",5231,"KRN",.403,0)
.403
"BLD",5231,"KRN",.5,0)
.5
"BLD",5231,"KRN",.5,"NM",0)
^9.68A^^
"BLD",5231,"KRN",.84,0)
.84
"BLD",5231,"KRN",.84,"NM",0)
^9.68A^^
"BLD",5231,"KRN",3.6,0)
3.6
"BLD",5231,"KRN",3.6,"NM",0)
^9.68A^^
"BLD",5231,"KRN",3.8,0)
3.8
"BLD",5231,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",5231,"KRN",3.8,"NM",1,0)
SD PM NOTIFICATION TIU^^0
"BLD",5231,"KRN",3.8,"NM","B","SD PM NOTIFICATION TIU",1)
 
"BLD",5231,"KRN",9.2,0)
9.2
"BLD",5231,"KRN",9.8,0)
9.8
"BLD",5231,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",5231,"KRN",9.8,"NM",1,0)
SDPMHLS^^0^B34446475
"BLD",5231,"KRN",9.8,"NM",2,0)
SDPMUT1^^0^B48095671
"BLD",5231,"KRN",9.8,"NM","B","SDPMHLS",1)
 
"BLD",5231,"KRN",9.8,"NM","B","SDPMUT1",2)

"BLD",5231,"KRN",19,0)
19
"BLD",5231,"KRN",19,"NM",0)
^9.68A^^
"BLD",5231,"KRN",19.1,0)
19.1
"BLD",5231,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5231,"KRN",101,0)
101
"BLD",5231,"KRN",101,"NM",0)
^9.68A^^
"BLD",5231,"KRN",409.61,0)
409.61
"BLD",5231,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",5231,"KRN",771,0)
771
"BLD",5231,"KRN",771,"NM",0)
^9.68A^^
"BLD",5231,"KRN",870,0)
870
"BLD",5231,"KRN",870,"NM",0)
^9.68A^^0
"BLD",5231,"KRN",8989.51,0)
8989.51
"BLD",5231,"KRN",8989.52,0)
8989.52
"BLD",5231,"KRN",8994,0)
8994
"BLD",5231,"KRN","B",.4,.4)
 
"BLD",5231,"KRN","B",.401,.401)
 
"BLD",5231,"KRN","B",.402,.402)
 
"BLD",5231,"KRN","B",.403,.403)
 
"BLD",5231,"KRN","B",.5,.5)
 
"BLD",5231,"KRN","B",.84,.84)
 
"BLD",5231,"KRN","B",3.6,3.6)
 
"BLD",5231,"KRN","B",3.8,3.8)
 
"BLD",5231,"KRN","B",9.2,9.2)
 
"BLD",5231,"KRN","B",9.8,9.8)
 
"BLD",5231,"KRN","B",19,19)
 
"BLD",5231,"KRN","B",19.1,19.1)
 
"BLD",5231,"KRN","B",101,101)
 
"BLD",5231,"KRN","B",409.61,409.61)
 
"BLD",5231,"KRN","B",771,771)
 
"BLD",5231,"KRN","B",870,870)
 
"BLD",5231,"KRN","B",8989.51,8989.51)
 
"BLD",5231,"KRN","B",8989.52,8989.52)
 
"BLD",5231,"KRN","B",8994,8994)
 
"BLD",5231,"QUES",0)
^9.62^^
"BLD",5231,"REQB",0)
^9.611^2^2
"BLD",5231,"REQB",1,0)
SD*5.3*313^2
"BLD",5231,"REQB",2,0)
SD*5.3*335^2
"BLD",5231,"REQB","B","SD*5.3*313",1)
 
"BLD",5231,"REQB","B","SD*5.3*335",2)

"INIT")
SD53371P
"KRN",3.8,7228,-1)
0^1
"KRN",3.8,7228,0)
SD PM NOTIFICATION TIU^PU^n^^^^
"KRN",3.8,7228,2,0)
^^8^8^3040512^
"KRN",3.8,7228,2,1,0)
This mail group is used to notify local staff of completion for the
"KRN",3.8,7228,2,2,0)
extraction and transmission of the Additional Performance Monitor (TIU)
"KRN",3.8,7228,2,3,0)
National Rollup to Austin Automation Center (AAC) for National Reporting.
"KRN",3.8,7228,2,4,0)
This process is queued to run on the 15th of each month and transmits data
"KRN",3.8,7228,2,5,0)
for the previous month starting with the first day and ending with the
"KRN",3.8,7228,2,6,0)
last day of the month. The menu option used to run this option is
"KRN",3.8,7228,2,7,0)
'Schedule APM Performance Monitor TasK' [SCRPW APM TASK JOB] and it is
"KRN",3.8,7228,2,8,0)
scheduled via TASKMAN.
"KRN",3.8,7228,3)

"KRN",3.8,7228,5,0)
^3.811P
"KRN",3.8,7228,6,0)
^3.812^^0
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"PKG",22,-1)
1^1
"PKG",22,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",22,20,0)
^9.402P^^
"PKG",22,22,0)
^9.49I^1^1
"PKG",22,22,1,0)
5.3^2930813^2931003
"PKG",22,22,1,"PAH",1,0)
371^3040713^33363
"PKG",22,22,1,"PAH",1,1,0)
^^10^10^3040713
"PKG",22,22,1,"PAH",1,1,1,0)
Inclusion of additional fields for HL7 message transmissions to AAC. 
"PKG",22,22,1,"PAH",1,1,2,0)
The routine SDPMHLS, responsible for creating the structure of the HL7 
"PKG",22,22,1,"PAH",1,1,3,0)
message, has been modified to allow inclusion of data for 
"PKG",22,22,1,"PAH",1,1,4,0)
progress notes pending signatures and encounters without progress notes.
"PKG",22,22,1,"PAH",1,1,5,0)
 
"PKG",22,22,1,"PAH",1,1,6,0)
Totals for unique encounter providers and unique stop codes at the 
"PKG",22,22,1,"PAH",1,1,7,0)
division level should also now match the sum of the totals for these 
"PKG",22,22,1,"PAH",1,1,8,0)
values of each facility in that division.
"PKG",22,22,1,"PAH",1,1,9,0)
 
"PKG",22,22,1,"PAH",1,1,10,0)
Also removes reference to 'DSS' in mail group SD PM NOTIFICATION TIU.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SD53371P")
0^^B2147119
"RTN","SD53371P",1,0)
SD53371P ;BPFO/JRC -Update SDPM HL7 Logical Link and set to Autostart; 4/2/04 7:12am [5/28/04 2:04pm]
"RTN","SD53371P",2,0)
 ;;5.3;Scheduling;**371**;AUG 13, 1993
"RTN","SD53371P",3,0)
 ;
"RTN","SD53371P",4,0)
EN ;Entry point
"RTN","SD53371P",5,0)
 ;
"RTN","SD53371P",6,0)
 ;Declare variables
"RTN","SD53371P",7,0)
 N REC,AUTO
"RTN","SD53371P",8,0)
 S (REC,AUTO)=""
"RTN","SD53371P",9,0)
 ;Find SDPM HL7 Logical Link ien
"RTN","SD53371P",10,0)
 D BMES^XPDUTL("Looking for SDPM Logical Link")
"RTN","SD53371P",11,0)
 S REC=$O(^HLCS(870,"B","SDPM",REC))
"RTN","SD53371P",12,0)
 ;If SDPM does not exist ask user to conatct NHD
"RTN","SD53371P",13,0)
 I 'REC D  Q
"RTN","SD53371P",14,0)
 . D BMES^XPDUTL("SDPM Logical Link was not found, please contact the National Help Desk")
"RTN","SD53371P",15,0)
 I REC D BMES^XPDUTL("HL Logical Link SDPM found ")
"RTN","SD53371P",16,0)
 ;Retrieve autostart flag
"RTN","SD53371P",17,0)
 D BMES^XPDUTL("Checking SDPM's Logical Link autostart flag")
"RTN","SD53371P",18,0)
 S AUTO=$P(^HLCS(870,REC,0),U,6)
"RTN","SD53371P",19,0)
 I AUTO D BMES^XPDUTL("SDPM's Logical Link autostart flag is ok")
"RTN","SD53371P",20,0)
 ;Autostart flag not set
"RTN","SD53371P",21,0)
 I 'AUTO D
"RTN","SD53371P",22,0)
 . D BMES^XPDUTL("SDPM's Logical Link autostart flag not set")
"RTN","SD53371P",23,0)
 . S $P(^HLCS(870,REC,0),U,6)=1
"RTN","SD53371P",24,0)
 . D BMES^XPDUTL("SDPM's Logical Link autostart flag changed to 1")
"RTN","SD53371P",25,0)
 Q
"RTN","SDPMHLS")
0^1^B34446475
"RTN","SDPMHLS",1,0)
SDPMHLS ;BPFO/JRC -Build ROU-R01 HL7 message for 'SD ENC PERF MON' application ; 4/2/04 7:12am [5/12/04 10:29am]
"RTN","SDPMHLS",2,0)
 ;;5.3;Scheduling;**313,371**;AUG 13, 1993
"RTN","SDPMHLS",3,0)
 ;
"RTN","SDPMHLS",4,0)
QUE ;Queue retroactive XMIT job
"RTN","SDPMHLS",5,0)
 ;Declare variables
"RTN","SDPMHLS",6,0)
 S (STDT,EDT,Y,X)=""
"RTN","SDPMHLS",7,0)
 ;Prompt user for month and year
"RTN","SDPMHLS",8,0)
 S %DT("A")="Please select MONTH and YEAR for TIU's National Rollup to transmit: "
"RTN","SDPMHLS",9,0)
 S %DT="AEM"
"RTN","SDPMHLS",10,0)
 ;Set %DT not to allow current and future months
"RTN","SDPMHLS",11,0)
 S %DT(0)=-($$FMADD^XLFDT($$NOW^XLFDT(),-32))
"RTN","SDPMHLS",12,0)
 D ^%DT
"RTN","SDPMHLS",13,0)
 ;Check date input if (-1) quit else continue
"RTN","SDPMHLS",14,0)
 I Y<0 Q
"RTN","SDPMHLS",15,0)
 ;Set STDT = user selected month and year and add 1 day
"RTN","SDPMHLS",16,0)
 S STDT=Y+01
"RTN","SDPMHLS",17,0)
 ;Add 32 days to STDT
"RTN","SDPMHLS",18,0)
 S X=$$FMADD^XLFDT(STDT,32)
"RTN","SDPMHLS",19,0)
 ;Subtract number of days that overlap into the following month
"RTN","SDPMHLS",20,0)
 S EDT=$$FMADD^XLFDT(X,-($E(X,6,7)))
"RTN","SDPMHLS",21,0)
 ;Set task variables
"RTN","SDPMHLS",22,0)
 S ZTIO=""
"RTN","SDPMHLS",23,0)
 S ZTDESC="Performance Indicator National Rollup"
"RTN","SDPMHLS",24,0)
 S ZTRTN="EN^SDPMHLS"
"RTN","SDPMHLS",25,0)
 S ZTSAVE("STDT")=""
"RTN","SDPMHLS",26,0)
 S ZTSAVE("EDT")=""
"RTN","SDPMHLS",27,0)
 D ^%ZTLOAD W:$D(ZTSK) "   (Task: ",ZTSK,")"
"RTN","SDPMHLS",28,0)
 K STDT,EDT,X,Y
"RTN","SDPMHLS",29,0)
 Q
"RTN","SDPMHLS",30,0)
EN ;Entry point
"RTN","SDPMHLS",31,0)
 ;Note: Retroactive reports use variables STDT and EDT to pass dates
"RTN","SDPMHLS",32,0)
 ;   STDT - start date, first day of the month for selected month
"RTN","SDPMHLS",33,0)
 ;   EDT - ending date, last day of the month for selected month
"RTN","SDPMHLS",34,0)
 ;Declare variables
"RTN","SDPMHLS",35,0)
 N STDATE,ENDDATE
"RTN","SDPMHLS",36,0)
 N XMTARRY,SCRNARR,SORTARR,OUTARR,X,RDATE
"RTN","SDPMHLS",37,0)
 S SCRNARR="^TMP(""SCRPW"",$J,""SCRNARR"")"
"RTN","SDPMHLS",38,0)
 S SORTARR="^TMP(""SCRPW"",$J,""SORTARR"")"
"RTN","SDPMHLS",39,0)
 S OUTARR="^TMP(""SCRPW"",$J,""OUTARR"")"
"RTN","SDPMHLS",40,0)
 S XMTARRY="^TMP(""HLS"","_$J_")"
"RTN","SDPMHLS",41,0)
 S (STDATE,ENDDATE)=""
"RTN","SDPMHLS",42,0)
 ;Set national screen/sort
"RTN","SDPMHLS",43,0)
 D ROLLUP^SCRPW303(SCRNARR,SORTARR)
"RTN","SDPMHLS",44,0)
 ;Call module to build scratch global
"RTN","SDPMHLS",45,0)
 D GETINFO
"RTN","SDPMHLS",46,0)
 ;Build HL7 Message
"RTN","SDPMHLS",47,0)
 D BLDMSG(OUTARR,XMTARRY)
"RTN","SDPMHLS",48,0)
 ;Send HL7 Message
"RTN","SDPMHLS",49,0)
 I +$O(@XMTARRY@(""))>0 D
"RTN","SDPMHLS",50,0)
 .S J=$$SENDMSG(.XMTARRY)
"RTN","SDPMHLS",51,0)
 ;Send XMIT notifications
"RTN","SDPMHLS",52,0)
 D MSG
"RTN","SDPMHLS",53,0)
 ;Cleanup an quit
"RTN","SDPMHLS",54,0)
 D EXIT
"RTN","SDPMHLS",55,0)
 Q
"RTN","SDPMHLS",56,0)
BLDMSG(OUTARR,XMTARRY) ;Build OBR segment
"RTN","SDPMHLS",57,0)
 ;Input : OUTARR - Ouptut array 
"RTN","SDPMHLS",58,0)
 ;Output: XMTARRY - HL7 temporary array
"RTN","SDPMHLS",59,0)
 ;Declare variables
"RTN","SDPMHLS",60,0)
 N HL,HLFS,HLECH,HLQ,SNODE,PNODE,DIVHL,TYPE,COUNT
"RTN","SDPMHLS",61,0)
 D INIT^HLFNC2("SD ENC PERF MON ORU-R01 SERVER",.HL)
"RTN","SDPMHLS",62,0)
 Q:$O(HL(""))=""
"RTN","SDPMHLS",63,0)
 N VAFEVN,VAFSTR,CNT,MAKE,VAFOBR,VAFOBX,I,XCNT,INFO,DIV,DIVHL
"RTN","SDPMHLS",64,0)
 S CNT=1,XCNT=0
"RTN","SDPMHLS",65,0)
 S MAKE(1)="1"
"RTN","SDPMHLS",66,0)
 S MAKE(4,1,1)="01"
"RTN","SDPMHLS",67,0)
 S MAKE(4,1,2)="VA ENC PERF MONITOR"
"RTN","SDPMHLS",68,0)
 S MAKE(7)=$$HLDATE^HLFNC(RDATE)
"RTN","SDPMHLS",69,0)
 S MAKE(25)="F"
"RTN","SDPMHLS",70,0)
 S MAKE(27,1,4)=$$HLDATE^HLFNC(STDATE,"DT")
"RTN","SDPMHLS",71,0)
 S MAKE(27,1,5)=$$HLDATE^HLFNC(ENDDATE,"DT")
"RTN","SDPMHLS",72,0)
 K VAFOBR
"RTN","SDPMHLS",73,0)
 D MAKEIT^VAFHLU("OBR",.MAKE,.VAFOBR,.VAFOBR)
"RTN","SDPMHLS",74,0)
 M @XMTARRY@(CNT)=VAFOBR
"RTN","SDPMHLS",75,0)
 S XCNT=XCNT+1,CNT=CNT+1
"RTN","SDPMHLS",76,0)
 ;Build OBX segment for facility
"RTN","SDPMHLS",77,0)
 S SNODE=$G(@OUTARR@("SUMMARY"))
"RTN","SDPMHLS",78,0)
 S PNODE=$G(@OUTARR@("SUMMARY","PI"))
"RTN","SDPMHLS",79,0)
 S DIVHL=$P($$SITE^VASITE,"^",3)
"RTN","SDPMHLS",80,0)
 D MAKEOBX
"RTN","SDPMHLS",81,0)
 ;Build OBX segment for division(s)
"RTN","SDPMHLS",82,0)
 S DIV="" F  S DIV=$O(@OUTARR@("SUBTOTAL",DIV)) Q:DIV=""  D
"RTN","SDPMHLS",83,0)
 .N SNODE,PNODE
"RTN","SDPMHLS",84,0)
 .S SNODE=$G(@OUTARR@("SUBTOTAL",DIV))
"RTN","SDPMHLS",85,0)
 .S PNODE=$G(@OUTARR@("SUBTOTAL",DIV,"PI"))
"RTN","SDPMHLS",86,0)
 .S DIVHL=$P(DIV,"^",2)
"RTN","SDPMHLS",87,0)
 .D MAKEOBX
"RTN","SDPMHLS",88,0)
 .Q
"RTN","SDPMHLS",89,0)
 Q
"RTN","SDPMHLS",90,0)
MAKEOBX ;Set type and count for total encounters to bld OBX
"RTN","SDPMHLS",91,0)
 ;Input : SNODE - Temporary counter node for summary
"RTN","SDPMHLS",92,0)
 ;        PNODE - Temporary counter node for PI
"RTN","SDPMHLS",93,0)
 ;        DIVHL - Division and Suffix
"RTN","SDPMHLS",94,0)
 ;        CNT - Temporary array subscript count
"RTN","SDPMHLS",95,0)
 ;        XCNT  - OBX segment counter
"RTN","SDPMHLS",96,0)
 ;        XMTARRY - Temporary HL array ^TMP("HLS",$J)
"RTN","SDPMHLS",97,0)
 S TYPE="CD",COUNT=$P($G(SNODE),U,1),OBID=1 D BLDOBX
"RTN","SDPMHLS",98,0)
 ;Set type and count for counters for ET in days F0 - F10 to bld OBX
"RTN","SDPMHLS",99,0)
 F M4=0:1:10 D
"RTN","SDPMHLS",100,0)
 .S OBID=2
"RTN","SDPMHLS",101,0)
 .S TYPE="F"_M4
"RTN","SDPMHLS",102,0)
 .S COUNT=$P($G(PNODE),U,(M4+1))
"RTN","SDPMHLS",103,0)
 .D BLDOBX
"RTN","SDPMHLS",104,0)
 ;Set type and count for scanned notes and Uniques to bld OBX
"RTN","SDPMHLS",105,0)
 S TYPE="FSPN",OBID=2,COUNT=$P($G(SNODE),U,7) D BLDOBX
"RTN","SDPMHLS",106,0)
 S TYPE="FEP",OBID=2,COUNT=$P($G(SNODE),U,4) D BLDOBX
"RTN","SDPMHLS",107,0)
 S TYPE="FDSS",OBID=2,COUNT=$P($G(SNODE),U,5) D BLDOBX
"RTN","SDPMHLS",108,0)
 ;Set types and count for encounters w/o progress notes and
"RTN","SDPMHLS",109,0)
 ;encounters w/progress notes pending signatures
"RTN","SDPMHLS",110,0)
 S TYPE="FNPN",OBID=2,COUNT=+$P(SNODE,U,1)-(+($P(SNODE,U,2)))-(+($P(SNODE,U,9)))-(+($P(SNODE,U,7)))-(+($P(PNODE,U,11))) D BLDOBX
"RTN","SDPMHLS",111,0)
 S TYPE="FNPS",OBID=2,COUNT=$P($G(SNODE),U,9) D BLDOBX
"RTN","SDPMHLS",112,0)
 Q
"RTN","SDPMHLS",113,0)
BLDOBX ;Build OBX
"RTN","SDPMHLS",114,0)
 ;Ouput : @XMTARRY = Temporary HL array
"RTN","SDPMHLS",115,0)
 ;Set variables
"RTN","SDPMHLS",116,0)
 N MAKE,VAFOBX
"RTN","SDPMHLS",117,0)
 S MAKE(1)=XCNT
"RTN","SDPMHLS",118,0)
 S MAKE(2)="NM"
"RTN","SDPMHLS",119,0)
 S MAKE(3,1,1)=OBID
"RTN","SDPMHLS",120,0)
 S MAKE(3,1,4)=TYPE
"RTN","SDPMHLS",121,0)
 S MAKE(5)=COUNT
"RTN","SDPMHLS",122,0)
 S MAKE(11)="F"
"RTN","SDPMHLS",123,0)
 S MAKE(15)=DIVHL
"RTN","SDPMHLS",124,0)
 K VAFOBX
"RTN","SDPMHLS",125,0)
 D MAKEIT^VAFHLU("OBX",.MAKE,.VAFOBX,.VAFOBX)
"RTN","SDPMHLS",126,0)
 M @XMTARRY@(CNT)=VAFOBX
"RTN","SDPMHLS",127,0)
 S XCNT=XCNT+1,CNT=CNT+1
"RTN","SDPMHLS",128,0)
 Q
"RTN","SDPMHLS",129,0)
SENDMSG(XMTARRY) ;Send HL7 message
"RTN","SDPMHLS",130,0)
 ;Input - @XMTARRY
"RTN","SDPMHLS",131,0)
 ;Output - ARRY4HL7
"RTN","SDPMHLS",132,0)
 N ARRY4HL7,KILLARRY,HL,HLRESLT,HLFS,HLECH,HLQ,HLP
"RTN","SDPMHLS",133,0)
 S XMTARRY=$G(XMTARRY)
"RTN","SDPMHLS",134,0)
 S:'(XMTARRY]"") XMTARRY="^TMP(""HLS"","_$J_")"
"RTN","SDPMHLS",135,0)
 Q:($O(@XMTARRY@(""))="") "-1^Can not send empty message"
"RTN","SDPMHLS",136,0)
 S ARRY4HL7="TMP(""HLS"","_$J_")"
"RTN","SDPMHLS",137,0)
 ;Initialize HL7 variables
"RTN","SDPMHLS",138,0)
 D INIT^HLFNC2("SD ENC PERF MON ORU-R01 SERVER",.HL)
"RTN","SDPMHLS",139,0)
 Q:($O(HL(""))="") "-1^Unable to initialize HL7 variables"
"RTN","SDPMHLS",140,0)
 ;Check if XMTARRY is ^TMP("HLS",$J)
"RTN","SDPMHLS",141,0)
 S KILLARRY=0
"RTN","SDPMHLS",142,0)
 I $NA(@XMTARRY)'=$NA(@ARRY4HL7) D
"RTN","SDPMHLS",143,0)
 .K @ARRY4HL7
"RTN","SDPMHLS",144,0)
 .M @ARRY4HL7=@XMTARRY
"RTN","SDPMHLS",145,0)
 .S KILLARRY=1
"RTN","SDPMHLS",146,0)
 ;Broadcast message
"RTN","SDPMHLS",147,0)
 D GENERATE^HLMA("SD ENC PERF MON ORU-R01 SERVER","GM",1,.HLRESLT,"",.HLP)
"RTN","SDPMHLS",148,0)
 S:('HLRESLT) HLRESLT=$P(HLRESLT,"^",2,3)
"RTN","SDPMHLS",149,0)
 ;Delete ^TMP("HLS",$J) if XMTARRY was different
"RTN","SDPMHLS",150,0)
 K:(KILLARRY) @ARRY4HL7
"RTN","SDPMHLS",151,0)
 Q $G(HLRESLT)
"RTN","SDPMHLS",152,0)
GETINFO ;Get performance monitor data
"RTN","SDPMHLS",153,0)
 ;Input:
"RTN","SDPMHLS",154,0)
 ;    @SCRNARR - Screen array full global reference
"RTN","SDPMHLS",155,0)
 ;    @SORTARR - Sort array full global reference
"RTN","SDPMHLS",156,0)
 ;Output:
"RTN","SDPMHLS",157,0)
 ;    @OUTARR - Ouput array full global reference 
"RTN","SDPMHLS",158,0)
 ;Remember starting time
"RTN","SDPMHLS",159,0)
 S RDATE=$$NOW^XLFDT()
"RTN","SDPMHLS",160,0)
 ;Check STDT and EDT, if 1 set STDATE and ENDDATE
"RTN","SDPMHLS",161,0)
 I $D(STDT)&$D(EDT) S STDATE=STDT,ENDDATE=EDT
"RTN","SDPMHLS",162,0)
 I STDATE="" D
"RTN","SDPMHLS",163,0)
 .;Set start date = 1st day of previous month
"RTN","SDPMHLS",164,0)
 .S STDATE=$E(RDATE,1,3)_$E(RDATE,4,5)-1_"01"
"RTN","SDPMHLS",165,0)
 .;Set end date = start date + 32 minus number of days into next month
"RTN","SDPMHLS",166,0)
 .S X=$$FMADD^XLFDT(STDATE,32)
"RTN","SDPMHLS",167,0)
 .S ENDDATE=$$FMADD^XLFDT(X,-($E(X,6,7)))
"RTN","SDPMHLS",168,0)
 .Q
"RTN","SDPMHLS",169,0)
 ;Set date range in screen array
"RTN","SDPMHLS",170,0)
 S @SCRNARR@("RANGE")=STDATE_"^"_ENDDATE
"RTN","SDPMHLS",171,0)
 ;Get data
"RTN","SDPMHLS",172,0)
 D GETDATA^SDPMUT1(SCRNARR,SORTARR,OUTARR)
"RTN","SDPMHLS",173,0)
 Q
"RTN","SDPMHLS",174,0)
MSG ;Build bulletin and send
"RTN","SDPMHLS",175,0)
 ;Input:
"RTN","SDPMHLS",176,0)
 ;     RDATE - report starting time
"RTN","SDPMHLS",177,0)
 ;Output: 
"RTN","SDPMHLS",178,0)
 ;   Notificaion bulletin to SD ENC PERF MON mail group
"RTN","SDPMHLS",179,0)
 N MSGTEXT,XMTEXT,XMSUB,XMY,XMCHAN,XMZ,XMDUZ
"RTN","SDPMHLS",180,0)
 S MSGTEXT(1)=" "
"RTN","SDPMHLS",181,0)
 S MSGTEXT(2)="Performance Indicator National Rollup was started on "_$$FMTE^XLFDT(RDATE,1)
"RTN","SDPMHLS",182,0)
 S MSGTEXT(3)="Encounter date range: "_$$FMTE^XLFDT(STDATE,1)_" to "_$$FMTE^XLFDT(ENDDATE,1)
"RTN","SDPMHLS",183,0)
 S MSGTEXT(3)="Extraction of data and sending of data completed "_$$FMTE^XLFDT($$NOW^XLFDT(),1)
"RTN","SDPMHLS",184,0)
 S MSGTEXT(4)=" "
"RTN","SDPMHLS",185,0)
 ;Send completion bulletin to current user
"RTN","SDPMHLS",186,0)
 S XMSUB="Performance Indicator National Rollup"
"RTN","SDPMHLS",187,0)
 S XMTEXT="MSGTEXT("
"RTN","SDPMHLS",188,0)
 S XMY("G.SD PM NOTIFICATION TIU")=""
"RTN","SDPMHLS",189,0)
 S XMCHAN=1
"RTN","SDPMHLS",190,0)
 S XMDUZ="Performance Indicator"
"RTN","SDPMHLS",191,0)
 D ^XMD
"RTN","SDPMHLS",192,0)
 Q
"RTN","SDPMHLS",193,0)
EXIT ;Done
"RTN","SDPMHLS",194,0)
 K @SCRNARR,@SORTARR,@OUTARR,@XMTARRY
"RTN","SDPMHLS",195,0)
 Q
"RTN","SDPMUT1")
0^2^B48095671
"RTN","SDPMUT1",1,0)
SDPMUT1 ; BPFO/JRC - Performance Monitors Utilities; 6-19-2003 ; 12/22/03 11:32am [6/21/04 3:26pm]
"RTN","SDPMUT1",2,0)
 ;;5.3;SCHEDULING;**292,335,371**;AUGUST 13, 1993
"RTN","SDPMUT1",3,0)
 ;
"RTN","SDPMUT1",4,0)
GETDATA(SCRNARR,SORTARR,OUTARR) ;Get progress note compliance information
"RTN","SDPMUT1",5,0)
 ;Input  : SCRNARR - Screening array full global reference
"RTN","SDPMUT1",6,0)
 ;         SORTARR - Sort array full global reference
"RTN","SDPMUT1",7,0)
 ;         OUTARR  - Output array full global reference
"RTN","SDPMUT1",8,0)
 ;Output : None
"RTN","SDPMUT1",9,0)
 ;         @OUTARR@("SUMMARY") = Enc^Comply^ ^Prov^Stop^ET^Scan^Signed
"RTN","SDPMUT1",10,0)
 ;           Enc    - Number of encounters checked for compliance
"RTN","SDPMUT1",11,0)
 ;           Comply - Compliant encounters (note signed w/in time limit)
"RTN","SDPMUT1",12,0)
 ;           Prov   - Unique primary encounter providers
"RTN","SDPMUT1",13,0)
 ;           Stop   - Unique primary stop codes
"RTN","SDPMUT1",14,0)
 ;           ET     - Total elapsed time (days) to sign PN
"RTN","SDPMUT1",15,0)
 ;           Scan   - Encounters with scanned notes
"RTN","SDPMUT1",16,0)
 ;           Signed - Encounters with signed notes
"RTN","SDPMUT1",17,0)
 ;         @OUTARR@("SUBTOTAL",SUB1) = SUMMARY node for sort level 1
"RTN","SDPMUT1",18,0)
 ;         @OUTARR@("SUMMARY","PI") = F0^F1^F2^F3^F4^F5^F6^F7^F8^F9^F10^F11
"RTN","SDPMUT1",19,0)
 ;           Fx  - Notes signed in x to X+1 days
"RTN","SDPMUT1",20,0)
 ;           F11 - Notes signed in 10 or more days
"RTN","SDPMUT1",21,0)
 ;         @OUTARR@("SUBTOTAL",SUB1,"PI") = PI node for sort level 1
"RTN","SDPMUT1",22,0)
 ;         @OUTARR@("DETAIL",SUB1,SUB2,DFN,PtrEnc) = Prov^DT^ET
"RTN","SDPMUT1",23,0)
 ;           Prov - TIU Provider
"RTN","SDPMUT1",24,0)
 ;           DT   - Date Provider signed progress note
"RTN","SDPMUT1",25,0)
 ;           ET   - Number of days that elpased before signing PN
"RTN","SDPMUT1",26,0)
 ;Note   : OUTARR is initialized (i.e. KILLed) on input
"RTN","SDPMUT1",27,0)
 ;       : When division is used as a sorting subscript,
"RTN","SDPMUT1",28,0)
 ;         DivisionName^DivisionNumber is used as the subscript
"RTN","SDPMUT1",29,0)
 ;       : Time is stripped from the encounter date when used as a
"RTN","SDPMUT1",30,0)
 ;         sorting subscript
"RTN","SDPMUT1",31,0)
 ;
"RTN","SDPMUT1",32,0)
 ;Declare variables
"RTN","SDPMUT1",33,0)
 N PTRENC,DATE,ENDDATE,UNQARR,STOP,LOOP
"RTN","SDPMUT1",34,0)
 ;Get begin and end dates for scan
"RTN","SDPMUT1",35,0)
 S DATE=$G(@SCRNARR@("RANGE"))
"RTN","SDPMUT1",36,0)
 S ENDDATE=$P(DATE,U,2)
"RTN","SDPMUT1",37,0)
 S DATE=$P(DATE,U,1)
"RTN","SDPMUT1",38,0)
 Q:('DATE)!('ENDDATE)
"RTN","SDPMUT1",39,0)
 S DATE=$P(DATE,".",1)-.000001
"RTN","SDPMUT1",40,0)
 S $P(ENDDATE,".",2)=999999
"RTN","SDPMUT1",41,0)
 ;Initialize output and array used to track uniques
"RTN","SDPMUT1",42,0)
 S UNQARR=$NA(^TMP("SDPMUT1-UNIQUE",$J))
"RTN","SDPMUT1",43,0)
 K @UNQARR,@OUTARR
"RTN","SDPMUT1",44,0)
 ;Scan
"RTN","SDPMUT1",45,0)
 S STOP=0
"RTN","SDPMUT1",46,0)
 F LOOP=1:1 S DATE=+$O(^SCE("B",DATE)) Q:('DATE)!(DATE>ENDDATE)  D  Q:STOP
"RTN","SDPMUT1",47,0)
 .S PTRENC=0
"RTN","SDPMUT1",48,0)
 .F  S PTRENC=+$O(^SCE("B",DATE,PTRENC)) Q:'PTRENC  D  Q:STOP
"RTN","SDPMUT1",49,0)
 ..;Task asked to stop
"RTN","SDPMUT1",50,0)
 ..I '(LOOP#100) S STOP=$$S^%ZTLOAD()  Q:STOP
"RTN","SDPMUT1",51,0)
 ..;Screen out encounter
"RTN","SDPMUT1",52,0)
 ..Q:$$SCREEN^SDPMUT2(PTRENC,SCRNARR)
"RTN","SDPMUT1",53,0)
 ..;Set output array
"RTN","SDPMUT1",54,0)
 ..D GET
"RTN","SDPMUT1",55,0)
 ;Cleanup and quit
"RTN","SDPMUT1",56,0)
 K @UNQARR
"RTN","SDPMUT1",57,0)
 Q
"RTN","SDPMUT1",58,0)
GET ;Get info & establish output array for GETDATA
"RTN","SDPMUT1",59,0)
 ;Input  : PTRENC - Pointer to Outpatient Encounter file
"RTN","SDPMUT1",60,0)
 ;         UNQARR - Array to use for unique calculations
"RTN","SDPMUT1",61,0)
 ;         Input parameters for GETDATA (SCRNARR, SORTARR, and OUTARR)
"RTN","SDPMUT1",62,0)
 ;Ouput  : See GETDATA for format of nodes set into OUTARR
"RTN","SDPMUT1",63,0)
 ;         Unique Stop Codes
"RTN","SDPMUT1",64,0)
 ;           @UNQARR@("SUMMARY","STOP",SUB1,PtrStopCode)
"RTN","SDPMUT1",65,0)
 ;           @UNQARR@("SUBTOTAL","STOP",SUB1,PtrStopCode)
"RTN","SDPMUT1",66,0)
 ;         Unique Primary Encounter Providers
"RTN","SDPMUT1",67,0)
 ;           @UNQARR@("SUMMARY","PROV",SUB1,PtrProvider)
"RTN","SDPMUT1",68,0)
 ;           @UNQARR@("SUBTOTAL","PROV",SUB1,PtrProvider)
"RTN","SDPMUT1",69,0)
 ;Declare variables
"RTN","SDPMUT1",70,0)
 N DFN,DIV,CLINIC,NODE,NOTEINFO,PROV,ENCDT,SUB1,SUB2,TIUPROV
"RTN","SDPMUT1",71,0)
 N TIUDT,TIUET,SUMNODE,SUBNODE,ESUB1,ESUB2,SCODE,X
"RTN","SDPMUT1",72,0)
 S NODE=^SCE(PTRENC,0)
"RTN","SDPMUT1",73,0)
 S DFN=+$P(NODE,U,2),DIV=+$P(NODE,U,11),CLINIC=+$P(NODE,U,4)
"RTN","SDPMUT1",74,0)
 S SCODE=+$P(NODE,U,3),ENCDT=+NODE
"RTN","SDPMUT1",75,0)
 ;Get primary encounter provider
"RTN","SDPMUT1",76,0)
 S PROV=$$ENCPROV^SDPMUT2(PTRENC)
"RTN","SDPMUT1",77,0)
 ;Set sorting subscripts (ESUB1 & ESUB2)
"RTN","SDPMUT1",78,0)
 ;  If SUBx = 1 Set sorting criteria to division
"RTN","SDPMUT1",79,0)
 ;  If SUBx = 2 Set soring criteria to clinic
"RTN","SDPMUT1",80,0)
 ;  If SUBx = 3 Set sorting criteria to Provider
"RTN","SDPMUT1",81,0)
 ;  If SUBx = 4 Set sorting criteria to Stop Code
"RTN","SDPMUT1",82,0)
 ;  If SUBx = 5 Set sorting criteria to Encounter Date
"RTN","SDPMUT1",83,0)
 ;  If SUBx = 6 Set sorting criteria to Patient
"RTN","SDPMUT1",84,0)
 S NODE=@SORTARR
"RTN","SDPMUT1",85,0)
 S SUB1=$P(NODE,"^",1)
"RTN","SDPMUT1",86,0)
 S SUB2=$P(NODE,"^",2)
"RTN","SDPMUT1",87,0)
 F NODE="SUB1","SUB2" D  I @("E"_NODE)="" S @("E"_NODE)="UNKNOWN"
"RTN","SDPMUT1",88,0)
 .I @NODE=1 D  Q
"RTN","SDPMUT1",89,0)
 ..S X=$G(^DG(40.8,DIV,0))
"RTN","SDPMUT1",90,0)
 ..S @("E"_NODE)=$P(X,U,1)_"^"_$P(X,U,2)
"RTN","SDPMUT1",91,0)
 .I @NODE=2 D  Q
"RTN","SDPMUT1",92,0)
 ..S @("E"_NODE)=$P($G(^SC(CLINIC,0)),U,1)
"RTN","SDPMUT1",93,0)
 .I @NODE=3 D  Q
"RTN","SDPMUT1",94,0)
 ..S @("E"_NODE)=$P($G(^VA(200,PROV,0)),U,1)
"RTN","SDPMUT1",95,0)
 .I @NODE=4 D  Q
"RTN","SDPMUT1",96,0)
 ..S @("E"_NODE)=$P($G(^DIC(40.7,SCODE,0)),U,1)
"RTN","SDPMUT1",97,0)
 .I @NODE=5 D  Q
"RTN","SDPMUT1",98,0)
 ..S @("E"_NODE)=$P(ENCDT,".",1)
"RTN","SDPMUT1",99,0)
 .I @NODE=6 D  Q
"RTN","SDPMUT1",100,0)
 ..S @("E"_NODE)=$P($G(^DPT(DFN,0)),U,1)
"RTN","SDPMUT1",101,0)
 .S @("E"_NODE)="UNKNOWN"
"RTN","SDPMUT1",102,0)
 ;Increment Encounters for hospital and sort level 1
"RTN","SDPMUT1",103,0)
 S $P(@OUTARR@("SUMMARY"),U,1)=$P($G(@OUTARR@("SUMMARY")),U,1)+1
"RTN","SDPMUT1",104,0)
 S $P(@OUTARR@("SUBTOTAL",ESUB1),U,1)=$P($G(@OUTARR@("SUBTOTAL",ESUB1)),U,1)+1
"RTN","SDPMUT1",105,0)
 ;Get TIU information
"RTN","SDPMUT1",106,0)
 S NOTEINFO=$$NOTEINF^SDPMUT2(PTRENC)
"RTN","SDPMUT1",107,0)
 S (TIUPROV,TIUDT,TIUET)=""
"RTN","SDPMUT1",108,0)
 ;Only update performance indicators for note status of B
"RTN","SDPMUT1",109,0)
 I $P((NOTEINFO),U,2)="B" D
"RTN","SDPMUT1",110,0)
 .S TIUPROV=$P((NOTEINFO),U,5)
"RTN","SDPMUT1",111,0)
 .S TIUDT=$P((NOTEINFO),U,6)
"RTN","SDPMUT1",112,0)
 .I 'TIUPROV D
"RTN","SDPMUT1",113,0)
 ..S TIUPROV=$P((NOTEINFO),U,3)
"RTN","SDPMUT1",114,0)
 ..S TIUDT=$P((NOTEINFO),U,4)
"RTN","SDPMUT1",115,0)
 .S TIUET=$$FMDIFF^XLFDT(TIUDT,ENCDT)
"RTN","SDPMUT1",116,0)
 .I TIUET<0 Q
"RTN","SDPMUT1",117,0)
 .;Increment Compliant Notes for hospital and sort level 1
"RTN","SDPMUT1",118,0)
 .I TIUET'>@SCRNARR@("TLMT") D
"RTN","SDPMUT1",119,0)
 ..S $P(@OUTARR@("SUMMARY"),U,2)=$P($G(@OUTARR@("SUMMARY")),U,2)+1
"RTN","SDPMUT1",120,0)
 ..S $P(@OUTARR@("SUBTOTAL",ESUB1),U,2)=$P($G(@OUTARR@("SUBTOTAL",ESUB1)),U,2)+1
"RTN","SDPMUT1",121,0)
 .;Increment Total Elapsed Time for hospital and sort level 1
"RTN","SDPMUT1",122,0)
 .S $P(@OUTARR@("SUMMARY"),U,6)=$P($G(@OUTARR@("SUMMARY")),U,6)+TIUET
"RTN","SDPMUT1",123,0)
 .S $P(@OUTARR@("SUBTOTAL",ESUB1),U,6)=$P($G(@OUTARR@("SUBTOTAL",ESUB1)),U,6)+TIUET
"RTN","SDPMUT1",124,0)
 .;Increment Total Signed Notes for hospital and sort level 1
"RTN","SDPMUT1",125,0)
 .S $P(@OUTARR@("SUMMARY"),U,8)=$P($G(@OUTARR@("SUMMARY")),U,8)+1
"RTN","SDPMUT1",126,0)
 .S $P(@OUTARR@("SUBTOTAL",ESUB1),U,8)=$P($G(@OUTARR@("SUBTOTAL",ESUB1)),U,8)+1
"RTN","SDPMUT1",127,0)
 .;Update performance indicator node for hospital and sort level 1
"RTN","SDPMUT1",128,0)
 .S SUMNODE=$G(@OUTARR@("SUMMARY","PI"))
"RTN","SDPMUT1",129,0)
 .S SUBNODE=$G(@OUTARR@("SUBTOTAL",ESUB1,"PI"))
"RTN","SDPMUT1",130,0)
 .I TIUET'<0&(TIUET'>1) D
"RTN","SDPMUT1",131,0)
 ..S $P(SUMNODE,U,1)=$P($G(SUMNODE),U,1)+1
"RTN","SDPMUT1",132,0)
 ..S $P(SUBNODE,U,1)=$P($G(SUBNODE),U,1)+1
"RTN","SDPMUT1",133,0)
 .I TIUET>1&(TIUET'>2) D
"RTN","SDPMUT1",134,0)
 ..S $P(SUMNODE,U,2)=$P($G(SUMNODE),U,2)+1
"RTN","SDPMUT1",135,0)
 ..S $P(SUBNODE,U,2)=$P($G(SUBNODE),U,2)+1
"RTN","SDPMUT1",136,0)
 .I TIUET>2&(TIUET'>3) D
"RTN","SDPMUT1",137,0)
 ..S $P(SUMNODE,U,3)=$P($G(SUMNODE),U,3)+1
"RTN","SDPMUT1",138,0)
 ..S $P(SUBNODE,U,3)=$P($G(SUBNODE),U,3)+1
"RTN","SDPMUT1",139,0)
 .I TIUET>3&(TIUET'>4) D
"RTN","SDPMUT1",140,0)
 ..S $P(SUMNODE,U,4)=$P($G(SUMNODE),U,4)+1
"RTN","SDPMUT1",141,0)
 ..S $P(SUBNODE,U,4)=$P($G(SUBNODE),U,4)+1
"RTN","SDPMUT1",142,0)
 .I TIUET>4&(TIUET'>5) D
"RTN","SDPMUT1",143,0)
 ..S $P(SUMNODE,U,5)=$P($G(SUMNODE),U,5)+1
"RTN","SDPMUT1",144,0)
 ..S $P(SUBNODE,U,5)=$P($G(SUBNODE),U,5)+1
"RTN","SDPMUT1",145,0)
 .I TIUET>5&(TIUET'>6) D
"RTN","SDPMUT1",146,0)
 ..S $P(SUMNODE,U,6)=$P($G(SUMNODE),U,6)+1
"RTN","SDPMUT1",147,0)
 ..S $P(SUBNODE,U,6)=$P($G(SUBNODE),U,6)+1
"RTN","SDPMUT1",148,0)
 .I TIUET>6&(TIUET'>7) D
"RTN","SDPMUT1",149,0)
 ..S $P(SUMNODE,U,7)=$P($G(SUMNODE),U,7)+1
"RTN","SDPMUT1",150,0)
 ..S $P(SUBNODE,U,7)=$P($G(SUBNODE),U,7)+1
"RTN","SDPMUT1",151,0)
 .I TIUET>7&(TIUET'>8) D
"RTN","SDPMUT1",152,0)
 ..S $P(SUMNODE,U,8)=$P($G(SUMNODE),U,8)+1
"RTN","SDPMUT1",153,0)
 ..S $P(SUBNODE,U,8)=$P($G(SUBNODE),U,8)+1
"RTN","SDPMUT1",154,0)
 .I TIUET>8&(TIUET'>9) D
"RTN","SDPMUT1",155,0)
 ..S $P(SUMNODE,U,9)=$P($G(SUMNODE),U,9)+1
"RTN","SDPMUT1",156,0)
 ..S $P(SUBNODE,U,9)=$P($G(SUBNODE),U,9)+1
"RTN","SDPMUT1",157,0)
 .I TIUET>9&(TIUET'>10) D
"RTN","SDPMUT1",158,0)
 ..S $P(SUMNODE,U,10)=$P($G(SUMNODE),U,10)+1
"RTN","SDPMUT1",159,0)
 ..S $P(SUBNODE,U,10)=$P($G(SUBNODE),U,10)+1
"RTN","SDPMUT1",160,0)
 .I TIUET>10 D
"RTN","SDPMUT1",161,0)
 ..S $P(SUMNODE,U,11)=$P($G(SUMNODE),U,11)+1
"RTN","SDPMUT1",162,0)
 ..S $P(SUBNODE,U,11)=$P($G(SUBNODE),U,11)+1
"RTN","SDPMUT1",163,0)
 .S @OUTARR@("SUMMARY","PI")=SUMNODE
"RTN","SDPMUT1",164,0)
 .S @OUTARR@("SUBTOTAL",ESUB1,"PI")=SUBNODE
"RTN","SDPMUT1",165,0)
 .Q
"RTN","SDPMUT1",166,0)
 ;Increment Scanned Notes for hospital and sort level 1 (if required)
"RTN","SDPMUT1",167,0)
 I @SCRNARR@("SCANNED")&($P(NOTEINFO,U,2)["D") D
"RTN","SDPMUT1",168,0)
 .S $P(@OUTARR@("SUMMARY"),U,7)=$P($G(@OUTARR@("SUMMARY")),U,7)+1
"RTN","SDPMUT1",169,0)
 .S $P(@OUTARR@("SUBTOTAL",ESUB1),U,7)=$P($G(@OUTARR@("SUBTOTAL",ESUB1)),U,7)+1
"RTN","SDPMUT1",170,0)
 .Q
"RTN","SDPMUT1",171,0)
 ;Only update performance indicators for note status of A
"RTN","SDPMUT1",172,0)
 I $P((NOTEINFO),U,2)="A" D
"RTN","SDPMUT1",173,0)
 .S $P(@OUTARR@("SUMMARY"),U,9)=$P($G(@OUTARR@("SUMMARY")),U,9)+1
"RTN","SDPMUT1",174,0)
 .S $P(@OUTARR@("SUBTOTAL",ESUB1),U,9)=$P($G(@OUTARR@("SUBTOTAL",ESUB1)),U,9)+1
"RTN","SDPMUT1",175,0)
 .Q
"RTN","SDPMUT1",176,0)
 ;Increment unique Stop Codes for hospital and sort level 1
"RTN","SDPMUT1",177,0)
 I SCODE D
"RTN","SDPMUT1",178,0)
 .I '($D(@UNQARR@("SUMMARY","STOP",ESUB1,SCODE))#2) D
"RTN","SDPMUT1",179,0)
 ..S $P(@OUTARR@("SUMMARY"),U,5)=$P($G(@OUTARR@("SUMMARY")),U,5)+1
"RTN","SDPMUT1",180,0)
 ..S @UNQARR@("SUMMARY","STOP",ESUB1,SCODE)=""
"RTN","SDPMUT1",181,0)
 ..Q
"RTN","SDPMUT1",182,0)
 .I '($D(@UNQARR@("SUBTOTAL","STOP",ESUB1,SCODE))#2) D
"RTN","SDPMUT1",183,0)
 ..S $P(@OUTARR@("SUBTOTAL",ESUB1),U,5)=$P($G(@OUTARR@("SUBTOTAL",ESUB1)),U,5)+1
"RTN","SDPMUT1",184,0)
 ..S @UNQARR@("SUBTOTAL","STOP",ESUB1,SCODE)=""
"RTN","SDPMUT1",185,0)
 ..Q
"RTN","SDPMUT1",186,0)
 .Q
"RTN","SDPMUT1",187,0)
 ;Increment unique Providers for hospital and sort level 1
"RTN","SDPMUT1",188,0)
 I PROV D
"RTN","SDPMUT1",189,0)
 .I '($D(@UNQARR@("SUMMARY","PROV",ESUB1,PROV))#2) D
"RTN","SDPMUT1",190,0)
 ..S $P(@OUTARR@("SUMMARY"),U,4)=$P($G(@OUTARR@("SUMMARY")),U,4)+1
"RTN","SDPMUT1",191,0)
 ..S @UNQARR@("SUMMARY","PROV",ESUB1,PROV)=""
"RTN","SDPMUT1",192,0)
 ..Q
"RTN","SDPMUT1",193,0)
 .I '($D(@UNQARR@("SUBTOTAL","PROV",ESUB1,PROV))#2) D
"RTN","SDPMUT1",194,0)
 ..S $P(@OUTARR@("SUBTOTAL",ESUB1),U,4)=$P($G(@OUTARR@("SUBTOTAL",ESUB1)),U,4)+1
"RTN","SDPMUT1",195,0)
 ..S @UNQARR@("SUBTOTAL","PROV",ESUB1,PROV)=""
"RTN","SDPMUT1",196,0)
 ..Q
"RTN","SDPMUT1",197,0)
 .Q
"RTN","SDPMUT1",198,0)
 ;Set detailed node
"RTN","SDPMUT1",199,0)
 S @OUTARR@("DETAIL",ESUB1,ESUB2,DFN,PTRENC)=TIUPROV_"^"_TIUDT_"^"_TIUET
"RTN","SDPMUT1",200,0)
 Q
"VER")
8.0^22.0
**END**
**END**
