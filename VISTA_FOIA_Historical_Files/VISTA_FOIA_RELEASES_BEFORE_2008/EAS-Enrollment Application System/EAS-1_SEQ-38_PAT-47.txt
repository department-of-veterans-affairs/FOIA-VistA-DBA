
=============================================================================
Run Date: JAN 28, 2004                     Designation: EAS*1*47
Package : EAS - ENROLLMENT APPLICATION SYSTEM Priority: EMERGENCY
Version : 1        SEQ #38                      Status: Released
                  Compliance Date: JAN 30, 2004
=============================================================================

Associated patches: (v)EAS*1*23    <<= must be installed BEFORE `EAS*1*47'
                    (v)EAS*1*33    <<= must be installed BEFORE `EAS*1*47'

Subject: FIX INCOME YEAR ISSUE W/Z09 BUILDER

Category: 
  - Routine

Description:
============

 **  This patch is classified as an emergency because billing is not 
 **  currently being reported accurately per Fiscal Year.
  
  
 The two patches (EAS*1*47 and IVM*2*96) will change the way IVM
 Billing/Collection Data Transmission (ORU~Z09) HL7 messages are 
 sent to the HEC and to the EDB (new Enrollment database).
  
 The Current process creates one Z09 per Veteran.  This Z09 will contain
 one Income Year segment and may contain multiple billing segments 
 that span multiple Income Years.  This had an undesireable effect of 
 associating different years billing information with a single Income
 Year.
  
 This patch will now sort the billing transactions by Income Year of 
 the Primary Completed Mean Test in force for that transaction.  The 
 billing transaction field BILL FROM (#.05) from the IVM BILLING 
 TRANSMISSION file (#301.61), will be used to associate this transaction
 with the proper Means Test.
  
 A veteran may now have a separate Z09 for each Income Year represented by
 the billing transactions being sent to the HEC or EDB.
  
  
 This patch addresses the following E3R(s):
 ------------------------------------------
 There are no E3Rs associated with this patch
  
  
 This patch addresses the following NOIS message(s):
  
 ---------------------------------------------------
 There are no NOIS's associated with this patch
  
  
 SOFTWARE RETRIEVAL
 ==================
 The software for this patch is being distributed in a host file.  The
 host file will contain two KIDS builds.
  
      Host file name: EAS_1_47.KID
  
              Builds:  EAS*1.0*47
                       IVM*2.0*96
  
 Sites may retrieve the software directly using FTP from the 
 ANONYMOUS.SOFTWARE directory at the following OI Field Offices:
  
         Albany:  ftp.fo-albany.med.va.gov
          Hines:  ftp.fo-hines.med.va.gov
 Salt Lake City:  ftp.fo-slc.med.va.gov 
  
 First available: download.vista.med.va.gov
  
 * Note: Use ASCII mode when transferring the .KID file. 
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
     This patch can be installed with users on the system. Installation
     will take less than 15 minutes.  To avoid conflicts the following menu
     options should be disabled prior to installing this patch:
  
  [IVM BACKGROUND JOB]            IVM BACKGROUND JOB
  [IB MT NIGHT COMP]              Queue Means Test Compilation of Charges
  [IB MT REV PEND CHARGES]        Release Charges 'Pending Review'
  [IB MT RELEASE CHARGES]         Release Charges 'On Hold'
  [IB MT REL HELD (RATE) CHARGES]   Release Charges Awaiting New Copay Rate
  
   1. DOWNLOAD HOST KIDS FILE
      -----------------------
      Download the KIDS file EAS_1_47.KID from the ANONYMOUS.SOFTWARE
      directory of either Albany, Hines, or the Salt Lake CIOFO to the
      appropriate directory on your system.
  
  
   2. LOAD DISTRIBUTION
      -----------------
      Use the 'LOAD A DISTRIBUTION' option on the KIDS INSTALLATION
      menu, and enter:  EAS_1_47.KID
  
   3.   DISABLE ROUTINE MAPPING   (DSM for Open VMS sites only)
        -----------------------
        Disable routine mapping on all systems for the routines listed in
  
        the step below.
  
        NOTE:  If the routines included in this patch are not currently in
               your mapped routine set, please skip this step.
  
   4.   COMPONENTS SENT WITH PATCH
        --------------------------
  
  ROUTINE SUMMARY:
  ================
  The following is a list of the routine(s) included in this patch.  The
  second line of each of these routine(s) will look like:
  
      <tab>;;1.0;ENROLLMENT APPLICATION SYSTEM;**[patch list]**; 21-OCT-94
  
                             CHECK^XTSUMBLD results
  Routine name      Before Patch          After Patch         Patch List
  ============      ============          ===========         ==========
  EASPTRN1               4965674              5007778          30,33,47
  EASPTRN5               5600704              5846484          23,33,47
  EASUFNC3               4763108              5219130            23,47
  
        Total number of routines:  3
  
   5.   START UP KIDS
        -------------
        Start up the Kernel Installation and Distribution System Menu
         [XPD MAIN]:
  
             Edits and Distribution ...
             Utilities ...
             Installation ...
  
   Select Kernel Installation & Distribution System Option: INStallation
                                                            ---
             Load a Distribution
             Print Transport Global
             Compare Transport Global to Current System
             Verify Checksums in Transport Global
             Install Package(s)
             Restart Install of Package(s)
             Unload a Distribution
             Backup a Transport Global
  
   Select Installation Option:
  
   6.   Select Installation Option:
        --------------------------
        NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
               NAME, enter EAS*1.0*47):
  
        a.  Backup a Transport Global - This option will create a backup
            message of any routines exported with this patch and the
            associated patch of IVM*2.0*96. It will not backup any other
            changes such as DD's or templates.
        b.  Compare Transport Global to Current System - This option will
            allow you to view all changes that will be made when this patch
            is installed.  It compares all components of this patch
            (routines, DD's, templates, etc.).
        c.  Verify Checksums in Transport Global - This option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
  
   7.   Select Installation Option: Install Package(s)
                                    ----------------
        **This is the step to start the installation of this KIDS patch:
  
        a. Choose the Install Package(s) option to start the patch install.
        b. When prompted 'Want KIDS to INHIBIT LOGONs during the install?
           YES//' answer NO (unless otherwise indicated)
        c. When prompted 'Want to DISABLE Scheduled Options, Menu Options,
           and Protocols? YES//' answer YES  (unless otherwise indicated)
        d.  When prompted 'Enter options you wish to mark as 'Out Of
            Order':'  Enter the following options:
  
  [IVM BACKGROUND JOB]            IVM BACKGROUND JOB
  [IB MT NIGHT COMP]              Queue Means Test Compilation of Charges
  [IB MT REV PEND CHARGES]        Release Charges 'Pending Review'
  [IB MT RELEASE CHARGES]         Release Charges 'On Hold'
  [IB MT REL HELD (RATE) CHARGES]   Release Charges Awaiting New Copay Rate
  
        e.  When prompted 'Enter protocols you wish to mark as 'Out Of
            Order':' press <return>.
  
   8.   REBUILD MAPPED ROUTINE(S)  (DSM for Open VMS sites only)
        -------------------------
        Optional - Include the routines distributed with this patch
        in the mapped routine set.
  
        NOTE: This step is only necessary if you performed step 3 or
              if you wish to include the routines in your mapped set.

Routine Information:
====================

Routine Name:
  - EASPTRN1

 This routine was modified to insert the Income Year into the $O loops of 
 the "ATR" cross reference.
  
  
 EASPTRN1
 --------
  
 old code:
 =========
  
 ***1***
 10  DELMT   ; send delete mt transaction if pt no longer meets IVM
 criteria
  
  
 ***2***
 100       ;Determine if Z09 should be sent to EDB or HEC legacy
 101       ; Input:  DFN
  
 ***3***
 106  WHERETO(DFN)    N COM,DATE,FOUND,FRMDATE,IEN,MIEN,ONODE,MTD,TYPE
 ,Z06COM
 107       S FOUND=0
 108       S Z06COM="Z06 MT via Edb"
 109       S IEN=$O(^IVM(301.61,"ATR",DFN,0)) I IEN="" Q FOUND
 110       S FRMDATE=$P($G(^IVM(301.61,IEN,0)),"^",5) I FRMDATE="" Q FOUND
  
  
 new code:
 =========
  
 ***1***
 10        ;EAS*1*47 - break up Z09's by Income year, via new "ATR" xref
 11        ;
 12        ;
 13  DELMT   ; send delete mt transaction if pt no longer meets IVM
 criteria
  
 ***2***
 103       ;Determine if Z09 should be sent to EDB or HEC legacy  ;EAS*1*47
 104       ; Input:  DFN
  
 ***3***
 109  WHERETO(ICYR,DFN)       N COM,DATE,FOUND,FRMDATE,IEN,MIEN,ONODE,MTD,T
 YPE,Z06CO
 110       S FOUND=0
 111       S Z06COM="Z06 MT via Edb"
 112       S IEN=$O(^IVM(301.61,"ATR",ICYR,DFN,0)) I IEN="" Q FOUND
 113       S FRMDATE=$P($G(^IVM(301.61,IEN,0)),"^",5) I FRMDATE="" Q FOUND

Routine Checksum:

Routine Name:
  - EASPTRN5

 This routine has been modified to insert a $O level in front of the 
 existing $O loops. to the ATR cross reference based on Income Year.
  
 EASPTRN5
 --------
  
 old code:
 =========
 ***1***
 16        N HL,HLDT,HLDT1,HLEID,HLMID,MID,MTIEN,RESULT
 17        S HLEID="EAS EDB ORU-Z09 SERVER"
  
 ***2***
 22        S DFN=0 F  S DFN=$O(^IVM(301.61,"ATR",DFN)) Q:'DFN  D
 23        .I '$$WHERETO^EASPTRN1(DFN) Q      ;Do not send legacy Z09's
 24        .I IVMCT=0,$G(IVMGTOT) D FILE^HLTF
  
 ***3***
 54        .S IVMTDA=$O(^IVM(301.61,"ATR",DFN,0))
 55        .S IVMMTDT=$S(IVMTDA:$P($G(^IVM(301.61,IVMTDA,0)),"^",5),1:DT)
  
 ***4***
 62        .S IVMTDA=0 F  S IVMTDA=$O(^IVM(301.61,"ATR",DFN,IVMTDA)) Q:'IVM
 TDA  D
 63        ..S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$FT1^EASUFNC3(IVMTDA)
  
 ***5***
 88        D FILE^IVMPTRN3
 89        K DFN,IVMPID,IVMTDA,IVMMTDT,IVMN,IVMSTOP,IVMEVENT,IVMHZIC,VAFPID
 ,DGREL
 90        D CLEAN^IVMUFNC
 91        Q
  
  
 new code:
 =========
 ***1***
 18        N HL,HLDT,HLDT1,HLEID,HLMID,MID,MTIEN,RESULT,ICYR
 19        S HLEID="EAS EDB ORU-Z09 SERVER"
  
 ***2***
 24        S ICYR=0                                         ;EAS*1*47
 25        F  S ICYR=$O(^IVM(301.61,"ATR",ICYR)) Q:'ICYR  D
 26        . D BLDZ09(ICYR)
 27        D FILE^IVMPTRN3
 28        K DFN,IVMPID,IVMTDA,IVMMTDT,IVMN,IVMSTOP,IVMEVENT,IVMHZIC,VAFPID
 ,DGREL,
 29        D CLEAN^IVMUFNC
 30        Q
 31        ;
 32  BLDZ09(ICYR)    ;create the Z09 per DFN
 33        S DFN=0
 34        F  S DFN=$O(^IVM(301.61,"ATR",ICYR,DFN)) Q:'DFN  D
 35        .I '$$WHERETO^EASPTRN1(ICYR,DFN) Q     ;Do not send legacy Z09's
 36        .I IVMCT=0,$G(IVMGTOT) D FILE^HLTF
  
 ***3***
 66        .S IVMTDA=$O(^IVM(301.61,"ATR",ICYR,DFN,0))
 67        .S IVMMTDT=$S(IVMTDA:$P($G(^IVM(301.61,IVMTDA,0)),"^",5),1:DT)
  
 ***4***
 74        .S IVMTDA=0 F  S IVMTDA=$O(^IVM(301.61,"ATR",ICYR,DFN,IVMTDA)) Q
 :'IVMTD
 75        ..S IVMCT=IVMCT+1,^TMP("HLS",$J,IVMCT)=$$FT1^EASUFNC3(IVMTDA)
  
 ***5***
 100       Q

Routine Checksum:

Routine Name:
  - EASUFNC3

 This routine was modified and two new TAGs were added which contain Mumps
 style cross reference API's to support the Data Dictionary changes.
  
 EASUFNC3
 --------
  
 new code:
 =========
 78        ;
 79  SETATR(DA,DFN)  ; Mumps cross reference add logic
 80        Q:'DFN
 81        N ICYR,TSTDT
 82        S TSTDT=$P($G(^IVM(301.61,DA,0)),"^",5)
 83        Q:TSTDT'>0
 84        ;find last MT date via Billing From Date
 85        S ICYR=$P($$LST^DGMTU(DFN,TSTDT,1),"^",2)
 86        ;calculate income year
 87        S ICYR=$E(ICYR,1,3)-1_"0000"
 88        Q:ICYR'>0
 89        ;set if xmit is Yes
 90        S:$P($G(^IVM(301.61,DA,0)),"^",12) ^IVM(301.61,"ATR",ICYR,DFN
 ,DA)=""
 91        Q
 92  KILLATR(DA,DFN) ; Mumps cross reference kill logic                   
 93        Q:'DFN
 94        N ICYR,TSTDT
 95        S TSTDT=$P($G(^IVM(301.61,DA,0)),"^",5)
 96        ;find last MT date for Billing From Date
 97        S ICYR=$P($$LST^DGMTU(DFN,TSTDT,1),"^",2)
 98        ;calculate income year
 99        S ICYR=$E(ICYR,1,3)-1_"0000"
 100       K ^IVM(301.61,"ATR",ICYR,DFN,DA)
 101       Q

Routine Checksum:

=============================================================================
User Information:
Entered By  : MULLER,RICHARD                Date Entered  : DEC 10, 2003
Completed By: NAPOLIELLO,GREG               Date Completed: JAN 26, 2004
Released By : GROOMS,ANTHONY E              Date Released : JAN 28, 2004
=============================================================================


Packman Mail Message:
=====================

No routines included
