Released SR*3*151 SEQ #143
Extracted from mail message
**KIDS**:SR*3.0*151^

**INSTALL NAME**
SR*3.0*151
"BLD",5519,0)
SR*3.0*151^SURGERY^0^3051215^y
"BLD",5519,1,0)
^^10^10^3051215^
"BLD",5519,1,1,0)
As existing pharmacy software modules are being re-engineered through
"BLD",5519,1,2,0)
new development and the purchase of commercial off-the-shelf products
"BLD",5519,1,3,0)
(COTS). Transition to the new Pharmacy Re-Engineered system eliminates the
"BLD",5519,1,4,0)
VistA Pharmacy files currently referenced. Therefore, all Surgery existing
"BLD",5519,1,5,0)
references (direct global reads/writes, VA FileMan reads/writes) to all
"BLD",5519,1,6,0)
pharmacy application files must be replaced with Application Programmer
"BLD",5519,1,7,0)
Interfaces (APIs).
"BLD",5519,1,8,0)
 
"BLD",5519,1,9,0)
This enhancement does not entail any user functionality change, only a
"BLD",5519,1,10,0)
'behind-the-scenes' process to enable exchange of medication data.
"BLD",5519,4,0)
^9.64PA^130^1
"BLD",5519,4,130,0)
130
"BLD",5519,4,130,2,0)
^9.641^130.33^1
"BLD",5519,4,130,2,130.33,0)
MEDICATIONS  (sub-file)
"BLD",5519,4,130,2,130.33,1,0)
^9.6411^.01^1
"BLD",5519,4,130,2,130.33,1,.01,0)
MEDICATIONS
"BLD",5519,4,130,222)
y^y^p^^^^n^^n
"BLD",5519,4,130,224)

"BLD",5519,4,"APDD",130,130.33)

"BLD",5519,4,"APDD",130,130.33,.01)

"BLD",5519,4,"B",130,130)

"BLD",5519,6)
1^
"BLD",5519,"KRN",0)
^9.67PA^8989.52^19
"BLD",5519,"KRN",.4,0)
.4
"BLD",5519,"KRN",.401,0)
.401
"BLD",5519,"KRN",.402,0)
.402
"BLD",5519,"KRN",.403,0)
.403
"BLD",5519,"KRN",.5,0)
.5
"BLD",5519,"KRN",.84,0)
.84
"BLD",5519,"KRN",3.6,0)
3.6
"BLD",5519,"KRN",3.8,0)
3.8
"BLD",5519,"KRN",9.2,0)
9.2
"BLD",5519,"KRN",9.8,0)
9.8
"BLD",5519,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",5519,"KRN",9.8,"NM",1,0)
SRHLUO3^^0^B25089400
"BLD",5519,"KRN",9.8,"NM",2,0)
SROADOC1^^0^B18744705
"BLD",5519,"KRN",9.8,"NM",3,0)
SROANP^^0^B15991170
"BLD",5519,"KRN",9.8,"NM",4,0)
SROCODE^^0^B6616214
"BLD",5519,"KRN",9.8,"NM",5,0)
SROINQ^^0^B18402832
"BLD",5519,"KRN",9.8,"NM",6,0)
SROMED^^0^B19949445
"BLD",5519,"KRN",9.8,"NM","B","SRHLUO3",1)

"BLD",5519,"KRN",9.8,"NM","B","SROADOC1",2)

"BLD",5519,"KRN",9.8,"NM","B","SROANP",3)

"BLD",5519,"KRN",9.8,"NM","B","SROCODE",4)

"BLD",5519,"KRN",9.8,"NM","B","SROINQ",5)

"BLD",5519,"KRN",9.8,"NM","B","SROMED",6)

"BLD",5519,"KRN",19,0)
19
"BLD",5519,"KRN",19.1,0)
19.1
"BLD",5519,"KRN",101,0)
101
"BLD",5519,"KRN",409.61,0)
409.61
"BLD",5519,"KRN",771,0)
771
"BLD",5519,"KRN",870,0)
870
"BLD",5519,"KRN",8989.51,0)
8989.51
"BLD",5519,"KRN",8989.52,0)
8989.52
"BLD",5519,"KRN",8994,0)
8994
"BLD",5519,"KRN","B",.4,.4)

"BLD",5519,"KRN","B",.401,.401)

"BLD",5519,"KRN","B",.402,.402)

"BLD",5519,"KRN","B",.403,.403)

"BLD",5519,"KRN","B",.5,.5)

"BLD",5519,"KRN","B",.84,.84)

"BLD",5519,"KRN","B",3.6,3.6)

"BLD",5519,"KRN","B",3.8,3.8)

"BLD",5519,"KRN","B",9.2,9.2)

"BLD",5519,"KRN","B",9.8,9.8)

"BLD",5519,"KRN","B",19,19)

"BLD",5519,"KRN","B",19.1,19.1)

"BLD",5519,"KRN","B",101,101)

"BLD",5519,"KRN","B",409.61,409.61)

"BLD",5519,"KRN","B",771,771)

"BLD",5519,"KRN","B",870,870)

"BLD",5519,"KRN","B",8989.51,8989.51)

"BLD",5519,"KRN","B",8989.52,8989.52)

"BLD",5519,"KRN","B",8994,8994)

"BLD",5519,"QUES",0)
^9.62^^
"BLD",5519,"REQB",0)
^9.611^2^2
"BLD",5519,"REQB",1,0)
SR*3.0*127^2
"BLD",5519,"REQB",2,0)
SR*3.0*129^2
"BLD",5519,"REQB","B","SR*3.0*127",1)

"BLD",5519,"REQB","B","SR*3.0*129",2)

"FIA",130)
SURGERY
"FIA",130,0)
^SRF(
"FIA",130,0,0)
130IP
"FIA",130,0,1)
y^y^p^^^^n^^n
"FIA",130,0,10)

"FIA",130,0,11)

"FIA",130,0,"RLRO")

"FIA",130,0,"VR")
3.0^SR
"FIA",130,130)
1
"FIA",130,130,.375)

"FIA",130,130.33)
1
"FIA",130,130.33,.01)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2930624^2930811
"PKG",167,22,1,"PAH",1,0)
151^3051215^517
"PKG",167,22,1,"PAH",1,1,0)
^^10^10^3051215
"PKG",167,22,1,"PAH",1,1,1,0)
As existing pharmacy software modules are being re-engineered through
"PKG",167,22,1,"PAH",1,1,2,0)
new development and the purchase of commercial off-the-shelf products
"PKG",167,22,1,"PAH",1,1,3,0)
(COTS). Transition to the new Pharmacy Re-Engineered system eliminates the
"PKG",167,22,1,"PAH",1,1,4,0)
VistA Pharmacy files currently referenced. Therefore, all Surgery existing
"PKG",167,22,1,"PAH",1,1,5,0)
references (direct global reads/writes, VA FileMan reads/writes) to all
"PKG",167,22,1,"PAH",1,1,6,0)
pharmacy application files must be replaced with Application Programmer
"PKG",167,22,1,"PAH",1,1,7,0)
Interfaces (APIs).
"PKG",167,22,1,"PAH",1,1,8,0)
 
"PKG",167,22,1,"PAH",1,1,9,0)
This enhancement does not entail any user functionality change, only a
"PKG",167,22,1,"PAH",1,1,10,0)
'behind-the-scenes' process to enable exchange of medication data.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","SRHLUO3")
0^1^B25089400
"RTN","SRHLUO3",1,0)
SRHLUO3 ;BIR/DLR - Surgery Interface (Cont.) Utilities for building Outgoing HL7 Segments ; [ 05/20/99   7:14 AM ]
"RTN","SRHLUO3",2,0)
 ;;3.0; Surgery ;**41,88,127,151**;24 Jun 93
"RTN","SRHLUO3",3,0)
 ; Per VHA Directive 10-93-142, this routine SHOULD NOT be modified.
"RTN","SRHLUO3",4,0)
 ;
"RTN","SRHLUO3",5,0)
 ; Reference to ^PSS50 supported by DBIA #4533
"RTN","SRHLUO3",6,0)
 ;
"RTN","SRHLUO3",7,0)
 ;INIT^HLTRANS MUST BE called before calling this routine.
"RTN","SRHLUO3",8,0)
 ;Mandatory variables
"RTN","SRHLUO3",9,0)
 ;I    - IEN of the entry to be processed
"RTN","SRHLUO3",10,0)
 ;SRI  - next available number in ^TMP(SRENT... global
"RTN","SRHLUO3",11,0)
MFE(SRI,REC,FILE,FIELD,SRENT) ;Master File Entry segment
"RTN","SRHLUO3",12,0)
 N I,ID,SRX,SRY,X,SRRX
"RTN","SRHLUO3",13,0)
 ;event point processing
"RTN","SRHLUO3",14,0)
 I $G(SRENT)'="" S I=$P(SRENT,U),ID=$P(SRENT,U,2) D SMFE
"RTN","SRHLUO3",15,0)
 ;set of codes
"RTN","SRHLUO3",16,0)
 I $G(SRENT)="",$G(FIELD)'="" S Y="",C=$P(^DD(FILE,FIELD,0),U,2) D Y^DIQ F X=2:1:$L(C,";")-1 S I=X-1,ID=$P($P(C,";",X),":",2) D SMFE
"RTN","SRHLUO3",17,0)
 ;files
"RTN","SRHLUO3",18,0)
 I $G(SRENT)="",$G(FIELD)="" D
"RTN","SRHLUO3",19,0)
 .I FILE=50 S SDT=$$FMADD^XLFDT(DT,-366) F  S SDT=$O(^SRF("AC",SDT)) Q:'SDT!(SDT>DT)  S XIEN=0 F  S XIEN=$O(^SRF("AC",SDT,XIEN)) Q:'XIEN  D
"RTN","SRHLUO3",20,0)
 ..I $D(^SRF(XIEN,22,0)) S X2=0 F  S X2=$O(^SRF(XIEN,22,X2)) Q:'X2  I $D(^(X2,0)) S I=$P(^(0),U) D DATA^PSS50(I,,,,,"SRRX") S ^TMP("SRHL",$J,"MED",I)=HLCOMP_$P($G(^TMP($J,"SRRX",I,.01)),"^")_HLCOMP
"RTN","SRHLUO3",21,0)
 ..K ^TMP($J,"SRRX",I)
"RTN","SRHLUO3",22,0)
 ..S X2=0 F  S X2=$O(^TMP("SRHL",$J,"MED",X2)) Q:'X2  S ID=^(X2) D SMFE,ZRX
"RTN","SRHLUO3",23,0)
 ..K ^TMP("SRHL",$J,"MED")
"RTN","SRHLUO3",24,0)
 .I FILE=44 S I=0 F  S I=$O(^SC(I)) Q:'I  S ID=$P(^(I,0),U)_HLCOMP_HLCOMP D SMFE
"RTN","SRHLUO3",25,0)
 .I FILE=80 S I=0 F  S I=$O(^ICD9(I)) Q:'I  S ID=$P(^(I,0),U)_HLCOMP_HLCOMP D SMFE,ZI9
"RTN","SRHLUO3",26,0)
 .I FILE=81 S I=0 F  S I=$O(^ICPT("B",I)) Q:I=""  S ID=I_HLCOMP_HLCOMP D SMFE,ZC4
"RTN","SRHLUO3",27,0)
 .I FILE=133.4 S I=0 F  S I=$O(^SRO(133.4,I)) Q:'I  S ID=HLCOMP_$P(^(I,0),U)_HLCOMP D SMFE,ZMN
"RTN","SRHLUO3",28,0)
 .I FILE=133.7 S I=0 F  S I=$O(^SRO(133.7,I)) Q:'I  S ID=HLCOMP_$P(^(I,0),U)_HLCOMP D SMFE,ZRF
"RTN","SRHLUO3",29,0)
 .I FILE=200 S SDT=$$FMADD^XLFDT(DT,-366) F  S SDT=$O(^SRF("AC",SDT)) Q:'SDT!(SDT>DT)  S XIEN=0 F  S XIEN=$O(^SRF("AC",SDT,XIEN)) Q:'XIEN  D
"RTN","SRHLUO3",30,0)
 ..;4-surgeon,5-first asst.,6-second asst.,13-attend surgeon
"RTN","SRHLUO3",31,0)
 ..I $D(^SRF(XIEN,.1)) F XF=4,5,6,13 S I=$P(^SRF(XIEN,.1),U,XF),ROLE=$S(XF=4:"SURGEON",XF=5:"1ST ASST.",XF=6:"2ND ASST.",XF=13:"ATT. SURGEON") D:I'="" XPER
"RTN","SRHLUO3",32,0)
 ..;1-prin. anes.,2-relief anes.,3-asst. anes.,4-anes. super.
"RTN","SRHLUO3",33,0)
 ..I $D(^SRF(XIEN,.3)) F XF=1,2,3,4 S I=$P(^SRF(XIEN,.3),U,XF),ROLE=$S(XF=1:"PRIN. ANES.",XF=2:"RELIEF ANESTHETIST",XF=3:"ASSISTANT ANESTHETIST",XF=4:"ANES. SUPER.") D:I'="" XPER
"RTN","SRHLUO3",34,0)
 ..;tourniquet applied by
"RTN","SRHLUO3",35,0)
 ..I $D(^SRF(XIEN,2,0)) S X2=0 F  S X2=$O(^SRF(XIEN,2,X2)) Q:'X2  S I=$P(^(X2,0),U,3),ROLE="TOURNIQUET APPLIED BY" D:I'="" XPER
"RTN","SRHLUO3",36,0)
 ..;monitor applied by
"RTN","SRHLUO3",37,0)
 ..I $D(^SRF(XIEN,27,0)) S X2=0 F  S X2=$O(^SRF(XIEN,27,X2)) Q:'X2  S I=$P(^(X2,0),U,4),ROLE="MONITOR APPLIED BY" D:I'="" XPER
"RTN","SRHLUO3",38,0)
 ..;extubated by
"RTN","SRHLUO3",39,0)
 ..I $D(^SRF(XIEN,6,0)) S X2=0 F  S X2=$O(^SRF(XIEN,6,X2)) Q:'X2  I $D(^(X2,6)) S I=$P(^(6),U),ROLE="EXTUBATED BY" D:I'="" XPER
"RTN","SRHLUO3",40,0)
 ..;medications administered by, ordered by
"RTN","SRHLUO3",41,0)
 ..I $D(^SRF(XIEN,22,0)) S X2=0 F  S X2=$O(^SRF(XIEN,22,X2)) Q:'X2  I $D(^(X2,0)) F XF=3,4 S I=$P(^(0),U,XF),ROLE=$S(XF=3:"MEDICATION ORDERED BY",XF=4:"MEDICATION ADM BY") D:I'="" XPER
"RTN","SRHLUO3",42,0)
 .S I=0 F  S I=$O(^TMP("SRHL",$J,"PER",I)) Q:'I  S ID=^(I) D SMFE,STF
"RTN","SRHLUO3",43,0)
 .K ^TMP("SRHL",$J,"PER")
"RTN","SRHLUO3",44,0)
 Q
"RTN","SRHLUO3",45,0)
SMFE ;
"RTN","SRHLUO3",46,0)
 S ^TMP("HLS",$J,SRI)="MFE"_HL("FS")_REC_HL("FS")_I_HL("FS")_$E(DT,1,8)_HL("FS")_ID,SRI=SRI+1
"RTN","SRHLUO3",47,0)
 Q
"RTN","SRHLUO3",48,0)
MFI(SRI,ID,FEC,FILE,SRENT) ;Master File Identification segment
"RTN","SRHLUO3",49,0)
 I '$D(ID)!'$D(FEC) W !!,"Invalid Master File Identifier or Event Code.",!! Q
"RTN","SRHLUO3",50,0)
 S ^TMP("HLS",$J,SRI)="MFI"_HL("FS")_HLCOMP_ID_HLCOMP_$S(FILE=80:"I9",FILE=81:"C4",$E(FILE,1,3)'=130:"99VA"_FILE,1:"L")_HL("FS")_HL("FS")_FEC_HL("FS")_HL("FS")_HL("FS")_"AL",SRI=SRI+1
"RTN","SRHLUO3",51,0)
 Q
"RTN","SRHLUO3",52,0)
STF ;staff master file
"RTN","SRHLUO3",53,0)
 S ^TMP("HLS",$J,SRI)="STF"_HL("FS")_$P($G(^VA(200,I,1)),U,9)_HLCOMP_HLCOMP_HL("FS")_HL("FS")_$P($$HNAME^SRHLU(I),HLCOMP,2,3),SRI=SRI+1
"RTN","SRHLUO3",54,0)
 Q
"RTN","SRHLUO3",55,0)
ZI9 ;master file update to ICD-9 (File #80)
"RTN","SRHLUO3",56,0)
 S SRY=$$ICDDX^ICDCODE(I),^TMP("HLS",$J,SRI)="ZI9"_HL("FS")_$P(SRY,U,2)_HLCOMP_$P(SRY,U,4)_HLCOMP_HL("FS")_$S($P(SRY,U,10)'="":$P(SRY,U,10),1:0),SRI=SRI+1
"RTN","SRHLUO3",57,0)
 Q
"RTN","SRHLUO3",58,0)
ZC4 ;master file update to CPT-4 (File #81)
"RTN","SRHLUO3",59,0)
 S SRX=$$CPT^ICPTCOD(I),^TMP("HLS",$J,SRI)="ZC4"_HL("FS")_$P(SRX,U,2)_HLCOMP_$P(SRX,U,3)_HLCOMP_HL("FS")_$S($P(SRX,U,7)'="":$P(SRX,U,7),1:0),SRI=SRI+1
"RTN","SRHLUO3",60,0)
 Q
"RTN","SRHLUO3",61,0)
ZRX ;master file update to MEDICATION (File #50)
"RTN","SRHLUO3",62,0)
 D DATA^PSS50(I,,,,,"SRRX") S ^TMP("HLS",$J,SRI)="ZRX"_HL("FS")_HLCOMP_$P($G(^TMP($J,"SRRX",I,.01)),"^")_HLCOMP_HL("FS")_$P($G(^("I")),U)_HL("FS")_$S($P($G(^(2)),U,3)["S":1,1:0),SRI=SRI+1
"RTN","SRHLUO3",63,0)
 K ^TMP($J,"SRRX",I)
"RTN","SRHLUO3",64,0)
 Q
"RTN","SRHLUO3",65,0)
ZMN ;master file update to MONITOR (File #133.2)
"RTN","SRHLUO3",66,0)
 S ^TMP("HLS",$J,SRI)="ZMN"_HL("FS")_HLCOMP_$P(^SRO(133.4,I,0),U)_HLCOMP_HL("FS")_$S($P(^(0),U,2)'="":$P(^(0),U,2),1:0),SRI=SRI+1
"RTN","SRHLUO3",67,0)
 Q
"RTN","SRHLUO3",68,0)
ZRF ;master file update to REPLACEMENT FLUIDS (File #133.7)
"RTN","SRHLUO3",69,0)
 S ^TMP("HLS",$J,SRI)="ZRF"_HL("FS")_HLCOMP_$P(^SRO(133.7,I,0),U)_HLCOMP_HL("FS")_$S($P(^(0),U,2)'="":$P(^(0),U,2),1:0),SRI=SRI+1
"RTN","SRHLUO3",70,0)
 Q
"RTN","SRHLUO3",71,0)
 ;cpt4,icd9,medication,monitor,personnel,replacement fluid
"RTN","SRHLUO3",72,0)
 I SRTYP'=3,(SRTYP'=5) D MSG^SRHLMFN(SRTBL,FEC,REC,SRENT)
"RTN","SRHLUO3",73,0)
 Q
"RTN","SRHLUO3",74,0)
XPER ;personnel information extract (SSN) from file 200
"RTN","SRHLUO3",75,0)
 S ^TMP("SRHL",$J,"PER",I)=$$HNAME^SRHLU(I)_"^"_ROLE
"RTN","SRHLUO3",76,0)
 Q
"RTN","SROADOC1")
0^2^B18744705
"RTN","SROADOC1",1,0)
SROADOC1 ;B'HAM ISC/MAM - ANESTHESIA PROV REPORT (CONT); [ 09/07/00  11:24 AM ]
"RTN","SROADOC1",2,0)
 ;;3.0; Surgery ;**38,39,53,50,95,151**;24 Jun 93
"RTN","SROADOC1",3,0)
 ;
"RTN","SROADOC1",4,0)
 ; Reference to ^PSS50 supported by DBIA #4533
"RTN","SROADOC1",5,0)
 ;
"RTN","SROADOC1",6,0)
SET ; set and print results
"RTN","SROADOC1",7,0)
 S S(0)=^SRF(SRTN,0),S(.3)=^SRF(SRTN,.3)
"RTN","SROADOC1",8,0)
 S DFN=$P(S(0),"^") D DEM^VADPT S SRDPT=VADM(1),SRSSN=VA("PID"),SRSDATE=$P(S(0),"^",9),SRREL=$P(S(.3),"^",2),SRSUP=$P(S(.3),"^",4),SRASS=$P(S(.3),"^",3),SRCODE=$P(S(.3),"^",6)
"RTN","SROADOC1",9,0)
 S:SRCODE'="" SRCODE=$P(^SRO(132.95,SRCODE,0),"^",2)
"RTN","SROADOC1",10,0)
 S SRANT="" I $D(^SRF(SRTN,.2)) S SRANE1=$P(^(.2),"^"),SRANE2=$P(^(.2),"^",4) I SRANE1,SRANE2 S X1=SRANE2,X=SRANE1 D MINS^SRSUTL2 S SRANT=X
"RTN","SROADOC1",11,0)
 S:SRREL'="" SRREL=$P(^VA(200,SRREL,0),"^") S:$L(SRREL)>15 SRREL=$P(SRREL,",")_","_$E($P(SRREL,",",2)) S:SRSUP'="" SRSUP=$P(^VA(200,SRSUP,0),"^") S:$L(SRSUP)>15 SRSUP=$P(SRSUP,",")_","_$E($P(SRSUP,",",2))
"RTN","SROADOC1",12,0)
 S:SRASS'="" SRASS=$P(^VA(200,SRASS,0),"^") I $L(SRASS)>15 S SRASS=$P(SRASS,",")_","_$E($P(SRASS,",",2))
"RTN","SROADOC1",13,0)
 S SRSDT=$E(SRSDATE,4,5)_"/"_$E(SRSDATE,6,7)
"RTN","SROADOC1",14,0)
TECH D TECH^SROPRIN S SRAGNT="" I $D(SRZ) D AGENT
"RTN","SROADOC1",15,0)
ASA S Y=$P($G(^SRF(SRTN,1.1)),"^",3),C=$P(^DD(130,1.13,0),"^",2) D:Y'="" Y^DIQ S SRASA=$P(Y,"-",2,3)
"RTN","SROADOC1",16,0)
OPS K SROPERS S SROPER=$P(^SRF(SRTN,"OP"),"^"),OPER=0 F  S OPER=$O(^SRF(SRTN,13,OPER)) Q:OPER=""  D OTHER
"RTN","SROADOC1",17,0)
 K SROPS,MM,MMM S:$L(SROPER)<50 SROPS(1)=SROPER I $L(SROPER)>49 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROADOC1",18,0)
PRINT ; print results
"RTN","SROADOC1",19,0)
 Q:SRF  I $Y+10>IOSL D CODES^SROADOC,PAGE Q:SRF
"RTN","SROADOC1",20,0)
 W !,$E(SRSDATE,4,5)_"/"_$E(SRSDATE,6,7)_"/"_$E(SRSDATE,2,3),?10,$P(SRDPT,",")_", "_$E($P(SRDPT,",",2)),?26,SROPS(1),?76,SRSUP,?93,SRASA,?124,SRCODE
"RTN","SROADOC1",21,0)
 W !,SRTN,?10,VA("PID") W:$D(SROPS(2)) ?26,SROPS(2) W ?76,SRREL,?93,$E(SRTECH,1,20),?120,SRANT_$S(SRANT:" MINS.",1:"")
"RTN","SROADOC1",22,0)
 W ! W:$P($G(^SRF(SRTN,"NON")),"^")="Y" "NON-O.R." W:$D(SROPS(3)) ?26,SROPS(3) W ?76,SRASS,?93,SRAGNT,!
"RTN","SROADOC1",23,0)
 I $D(SROPS(4)) W ?26,SROPS(4),! W:$D(SROPS(5)) ?26,SROPS(5),! I $D(SROPS(6)) W ?26,SROPS(6),!
"RTN","SROADOC1",24,0)
 Q
"RTN","SROADOC1",25,0)
HDR I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRF=1 Q
"RTN","SROADOC1",26,0)
 W:$Y @IOF W !,?(132-$L(SRINST)\2),SRINST,?120,"PAGE: "_PAGE,!,?58,"SURGICAL SERVICE",?100,"REVIEWED BY:",!,?53,"ANESTHESIA PROVIDER REPORT",?100,"DATE REVIEWED:"
"RTN","SROADOC1",27,0)
 W !,?(132-$L(SRFRTO)\2),SRFRTO,?100,"DATE PRINTED: "_SRPRINT
"RTN","SROADOC1",28,0)
 W !!,"DATE",?10,"PATIENT",?26,"PROCEDURE(S)",?77,"SUPERVISOR",?96,"ASA CLASS",?111,"LEVEL OF SUPERVISION",!,"CASE #",?12,"ID#",?76,"RELIEF ANESTH",?92,"PRINCIPAL TECHNIQUE",?113,"ELAPSED ANES TIME",!,?76,"ASST ANESTH"
"RTN","SROADOC1",29,0)
 W ?93,"ANESTHESIA AGENT",! F LINE=1:1:132 W "="
"RTN","SROADOC1",30,0)
 S PAGE=PAGE+1 I $D(PRIN) W !!,?2,"***** "_PRIN_" *****",!
"RTN","SROADOC1",31,0)
 Q
"RTN","SROADOC1",32,0)
PAGE I $E(IOST)'="P" W !!,"Press RETURN to continue, '^' to quit  " R ASK:DTIME I '$T!(ASK="^") S SRF=1 Q
"RTN","SROADOC1",33,0)
 D HDR Q
"RTN","SROADOC1",34,0)
END I $E(IOST)'="P",'SRF W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SROADOC1",35,0)
 W:$E(IOST)="P" @IOF I $D(ZTQUEUED) K ^TMP("SR",$J) Q:$G(ZTSTOP)  S ZTREQ="@" Q
"RTN","SROADOC1",36,0)
 D ^SRSKILL K SRTN D ^%ZISC W @IOF
"RTN","SROADOC1",37,0)
 Q
"RTN","SROADOC1",38,0)
OTHER ; other operations
"RTN","SROADOC1",39,0)
 S SRLONG=1 I $L(SROPER)+$L($P(^SRF(SRTN,13,OPER,0),"^"))>250 S SRLONG=0,OPER=999,SROPERS=" ..."
"RTN","SROADOC1",40,0)
 I SRLONG S SROPERS=$P(^SRF(SRTN,13,OPER,0),"^")
"RTN","SROADOC1",41,0)
 S SROPER=SROPER_$S(SROPERS=" ...":SROPERS,1:", "_SROPERS)
"RTN","SROADOC1",42,0)
 Q
"RTN","SROADOC1",43,0)
AGENT S SRAGNT=$O(^SRF(SRTN,6,SRT,1,0)) Q:SRAGNT=""  S SRAGNT=$P(^SRF(SRTN,6,SRT,1,SRAGNT,0),"^") D
"RTN","SROADOC1",44,0)
 .D DATA^PSS50(SRAGNT,,,,,"SRRX") S SRAGNT=$P($G(^TMP($J,"SRRX",I,.01)),"^") K ^TMP($J,"SRRX",I)
"RTN","SROADOC1",45,0)
 Q
"RTN","SROADOC1",46,0)
PR S SRSOUT=0 D HDR G END:SRSOUT S PRIN=0
"RTN","SROADOC1",47,0)
 F  S PRIN=$O(^TMP("SR",$J,PRIN)) Q:PRIN=""!(SRF)  W:$Y+10'>IOSL !!,?2,"***** "_PRIN_" *****",! S DATE=0 F  S DATE=$O(^TMP("SR",$J,PRIN,DATE)) Q:'DATE!(SRF)  S SRTN=0 F  S SRTN=$O(^TMP("SR",$J,PRIN,DATE,SRTN)) Q:'SRTN!(SRF)  D SET
"RTN","SROADOC1",48,0)
 I '$D(^TMP("SR",$J)) W $$NODATA^SROUTL0()
"RTN","SROADOC1",49,0)
 F I=$Y:1:(IOSL-8) W !
"RTN","SROADOC1",50,0)
 I 'SRF D CODES^SROADOC
"RTN","SROADOC1",51,0)
 G END
"RTN","SROADOC1",52,0)
LOOP ; break procedure name if greater than 50 characters
"RTN","SROADOC1",53,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<50  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROADOC1",54,0)
 Q
"RTN","SROANP")
0^3^B15991170
"RTN","SROANP",1,0)
SROANP ;B'HAM ISC/MAM - LIST OF ANESTHETIC PROCEDURES ; [ 09/07/00  11:27 AM ]
"RTN","SROANP",2,0)
 ;;3.0; Surgery ;**38,53,50,95,151**;24 Jun 93
"RTN","SROANP",3,0)
 ;
"RTN","SROANP",4,0)
 ;Reference to ^PSS50 supported by DBIA #4533
"RTN","SROANP",5,0)
 ;
"RTN","SROANP",6,0)
SET ; set and print information for a case
"RTN","SROANP",7,0)
 S SRNON=0 I $P($G(^SRF(SRTN,"NON")),"^")="Y" S SRNON=1
"RTN","SROANP",8,0)
 I SRFLG=1!(SRFLG=3&('SRNON)) Q:$P($G(^SRF(SRTN,.2)),"^",12)=""
"RTN","SROANP",9,0)
 I SRFLG=2 Q:'SRNON
"RTN","SROANP",10,0)
 K S(.2),SRAGNT,SRTECH,SRPRIN,SRANE3
"RTN","SROANP",11,0)
 S S(0)=^SRF(SRTN,0),DFN=+S(0) D DEM^VADPT S SRDPT=VADM(1),SRSSN=VA("PID"),SRDATE=$P(S(0),"^",9),Y=SRDATE,SRDT=$E(SRDATE,4,5)_"/"_$E(SRDATE,6,7)_"/"_$E(SRDATE,2,3)
"RTN","SROANP",12,0)
 D D^DIQ S SRFIND=$F(Y,":") S SRDATE=$S(SRFIND:SRDT_" "_$E(Y,SRFIND-3,SRFIND+1),1:SRDT)
"RTN","SROANP",13,0)
 S:SRDPT>18 SRDPT=$P(SRDPT,",")_", "_$E($P(SRDPT,",",2))
"RTN","SROANP",14,0)
 I 'SRNON S SRICD=$S($D(^SRF(SRTN,34)):$P(^(34),"^"),$D(^SRF(SRTN,33)):$P(^(33),"^"),1:"")
"RTN","SROANP",15,0)
 I SRNON S SRICD=$P($G(^SRF(SRTN,33)),"^",2)
"RTN","SROANP",16,0)
OPS S SROPER=$P(^SRF(SRTN,"OP"),"^"),OPER=0 F  S OPER=$O(^SRF(SRTN,13,OPER)) Q:OPER=""  D OTHER
"RTN","SROANP",17,0)
 K SROPS,MM,MMM S:$L(SROPER)<50 SROPS(1)=SROPER I $L(SROPER)>49 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROANP",18,0)
 S SRPRIN=$S($D(^SRF(SRTN,.3)):$P(^(.3),"^"),1:"") I SRPRIN'="" S SRPRIN=$P(^VA(200,SRPRIN,0),"^")
"RTN","SROANP",19,0)
 S Y=$P($G(^SRF(SRTN,1.1)),"^",3),C=$P(^DD(130,1.13,0),"^",2) D:Y'="" Y^DIQ S SRASA=$P(Y,"-",2,3)
"RTN","SROANP",20,0)
 K SRTECH S (SRT,SRZ)=0 F  S SRT=$O(^SRF(SRTN,6,SRT)) Q:SRT=""!(SRZ)  D ^SROPRIN I SRZ D AGENT
"RTN","SROANP",21,0)
 I '$D(SRTECH) S (SRTECH,SRAGNT)=""
"RTN","SROANP",22,0)
 S:'$D(SRAGNT) SRAGNT=""
"RTN","SROANP",23,0)
 I SRTECH'="" S Y=SRTECH,C=$P(^DD(130.06,.01,0),"^",2) D Y^DIQ S SRTECH=Y
"RTN","SROANP",24,0)
 I $D(^SRF(SRTN,.2)) S S(.2)=^(.2),SRANE1=$P(S(.2),"^",1),SRANE2=$P(S(.2),"^",4) S X1=SRANE2,X=SRANE1 I X1,X D MINS^SRSUTL2 S SRANE3=X
"RTN","SROANP",25,0)
 S:'$D(SRANE3) SRANE3="" I '$D(S(.2)) S (SRANE1,SRANE2)=""
"RTN","SROANP",26,0)
 I SRANE1 S Y=SRANE1 D D^DIQ S SRFIND=$F(Y,":"),SRANE1=$S(SRFIND:$E(Y,SRFIND-3,SRFIND+1),1:"")
"RTN","SROANP",27,0)
 I SRANE2 S Y=SRANE2 D D^DIQ S SRFIND=$F(Y,":"),SRANE2=$S(SRFIND:$E(Y,SRFIND-3,SRFIND+1),1:"")
"RTN","SROANP",28,0)
PRINT ; print results
"RTN","SROANP",29,0)
 I $Y+7>IOSL D PAGE
"RTN","SROANP",30,0)
 Q:SRF  W !,SRDATE,?16,SRDPT,?40,SRICD,?97,$E(SRPRIN,1,15),?118,SRANE1,!,SRTN,?16,VA("PID"),?40,SROPS(1),?97,$E(SRTECH,1,20),?118,SRANE2
"RTN","SROANP",31,0)
 W ! W:SRFLG=3&(SRNON) "NON-O.R." W ?16,SRASA W:$D(SROPS(2)) ?40,SROPS(2) W ?97,$E(SRAGNT,1,20),?118,SRANE3,!
"RTN","SROANP",32,0)
 I $D(SROPS(3)) W ?40,SROPS(3),! I $D(SROPS(4)) W ?40,SROPS(4),! I $D(SROPS(5)) W ?40,SROPS(5),! I $D(SROPS(6)) W ?40,SROPS(6),!
"RTN","SROANP",33,0)
 Q
"RTN","SROANP",34,0)
OTHER ; other operations
"RTN","SROANP",35,0)
 S SRLONG=1 I $L(SROPER)+$L($P(^SRF(SRTN,13,OPER,0),"^"))>250 S SRLONG=0,OPER=999,SROPERS=" ..."
"RTN","SROANP",36,0)
 I SRLONG S SROPERS=$P(^SRF(SRTN,13,OPER,0),"^")
"RTN","SROANP",37,0)
 S SROPER=SROPER_$S(SROPERS=" ...":SROPERS,1:", "_SROPERS)
"RTN","SROANP",38,0)
 Q
"RTN","SROANP",39,0)
LOOP ; break procedure name if greater than 50 characters
"RTN","SROANP",40,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<50  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROANP",41,0)
 Q
"RTN","SROANP",42,0)
AGENT S SRAGNT=$O(^SRF(SRTN,6,SRT,1,0)) Q:SRAGNT=""  S SRAGNT=$P(^SRF(SRTN,6,SRT,1,SRAGNT,0),"^") D
"RTN","SROANP",43,0)
 .D DATA^PSS50(SRAGNT,,,,,"SRRX") S SRAGNT=$P($G(^TMP($J,"SRRX",SRAGNT,.01)),"^") K ^TMP($J,"SRRX",SRAGNT)
"RTN","SROANP",44,0)
 Q
"RTN","SROANP",45,0)
BEG ;
"RTN","SROANP",46,0)
 U IO N SRFRTO S SRED1=SRED_.9999,SRF=0,PAGE=1,Y=DT X ^DD("DD") S SRPRINT="DATE PRINTED: "_Y S Y=SRSD X ^DD("DD") S SRFRTO="FROM: "_Y_"  TO: ",Y=SRED X ^DD("DD") S SRFRTO=SRFRTO_Y
"RTN","SROANP",47,0)
 S SRINST=SRSITE("SITE"),SRINSTP=SRSITE("DIV") D HDR^SROANP1 Q:SRF
"RTN","SROANP",48,0)
 S DATE=SRSD-.0009 F  S DATE=$O(^SRF("AC",DATE)) Q:DATE>SRED1!(DATE="")!SRF  S SRTN=0 F  S SRTN=$O(^SRF("AC",DATE,SRTN)) Q:SRTN=""!SRF  I $D(^SRF(SRTN,0)),$$DIV^SROUTL0(SRTN) D SET
"RTN","SROANP",49,0)
 Q
"RTN","SROANP",50,0)
PAGE I $E(IOST)'="P" W !!,"Press RETURN to continue, '^' to quit  " R ASK:DTIME I '$T!(ASK="^") S SRF=1 Q
"RTN","SROANP",51,0)
 D HDR^SROANP1 Q
"RTN","SROCODE")
0^4^B6616214
"RTN","SROCODE",1,0)
SROCODE ;B'HAM ISC/MAM - SET UP FLAG FOR ANESTHESIA AGENTS ; [ 05/06/98   7:14 AM ]
"RTN","SROCODE",2,0)
 ;;3.0; Surgery ;**72,41,114,151**;24 Jun 93
"RTN","SROCODE",3,0)
 ;
"RTN","SROCODE",4,0)
 ; Reference to ENS^PSSGIU supported by DBIA #895
"RTN","SROCODE",5,0)
 ; Reference to ^PSS50 supported by DBIA #4533
"RTN","SROCODE",6,0)
 ;
"RTN","SROCODE",7,0)
1 W !! K DIR S DIR(0)="P^50:QEAM",DIR("A")="Enter the name of the drug you wish to flag" D ^DIR G:Y<1 DONE S SROIUDA=+Y,SROIRX=$P(Y,"^",2),SROIUX="S^SURGERY" D SROIU
"RTN","SROCODE",8,0)
 G 1
"RTN","SROCODE",9,0)
SROIU Q:'$D(SROIUDA)!'$D(SROIUX)  Q:SROIUX'?1E1"^"1.E
"RTN","SROCODE",10,0)
 N SRRX D DATA^PSS50(SROIUDA,,,,,"SRRX") S SRRX=$G(^TMP($J,"SRRX",SROIUDA,63)) D
"RTN","SROCODE",11,0)
 .S SROIUY=$S($D(SRRX):SRRX,1:""),SROIUT=$P(SROIUX,"^",2),SROIUT=$E("N","AEIOU"[$E(SROIUT))_" "_SROIUT K ^TMP($J,"SRRX",SROIUDA)
"RTN","SROCODE",12,0)
 I SROIUY["S" W !!,"This drug is already flagged for SURGERY." K DIR S DIR("A")="Do you want to remove the flag (Y/N)",DIR(0)="Y" D ^DIR D:Y OFF D DONE Q
"RTN","SROCODE",13,0)
 W !! K DIR S DIR("A")="Do you want to flag this drug for SURGERY (Y/N)",DIR(0)="Y" D ^DIR D:Y FLAG
"RTN","SROCODE",14,0)
DONE W @IOF K SROIRX D ^SRSKILL
"RTN","SROCODE",15,0)
 Q
"RTN","SROCODE",16,0)
FLAG S PSIUDA=SROIUDA,PSIUX=SROIUX_"^1"
"RTN","SROCODE",17,0)
 S X="PSSGIU" X ^%ZOSF("TEST") I $T D ENS^PSSGIU
"RTN","SROCODE",18,0)
 ;HL7 master file update (addition) to anesthesia agent list
"RTN","SROCODE",19,0)
 N SRTBL,SRENT,FEC,REC S SRTBL="ANESTHESIA AGENT^50^.01",FEC="UPD",REC="MAD",SRENT=SROIUDA_U_SROIRX D MSG^SRHLMFN(SRTBL,FEC,REC,SRENT)
"RTN","SROCODE",20,0)
 ;A call to PDM to possibly generate an HL7 outgoing drug message
"RTN","SROCODE",21,0)
 S X="PSSHUIDG" X ^%ZOSF("TEST") I $T D DRG^PSSHUIDG(PSIUDA)
"RTN","SROCODE",22,0)
 K PSIUDA,PSIUX
"RTN","SROCODE",23,0)
 Q
"RTN","SROCODE",24,0)
OFF S PSIUDA=SROIUDA,PSIUX=SROIUX_"^1"
"RTN","SROCODE",25,0)
 S X="PSSGIU" X ^%ZOSF("TEST") I $T D END^PSSGIU
"RTN","SROCODE",26,0)
 ;HL7 master file update (deletion) to anesthesia agent list
"RTN","SROCODE",27,0)
 N SRTBL,SRENT,FEC,REC S SRTBL="ANESTHESIA AGENT^50^.01",FEC="UPD",REC="MDL" D DATA^PSS50(SROIUDA,,,,,"SRRX")
"RTN","SROCODE",28,0)
 S SRENT=SROIUDA_U_$P($G(^TMP($J,"SRRX",SROIUDA,.01)),"^") K ^TMP($J,"SRRX",SROIUDA) D MSG^SRHLMFN(SRTBL,FEC,REC,SRENT)
"RTN","SROCODE",29,0)
 ;A call to PDM to possibly generate an HL7 outgoing drug message
"RTN","SROCODE",30,0)
 S X="PSSHUIDG" X ^%ZOSF("TEST") I $T D DRG^PSSHUIDG(PSIUDA)
"RTN","SROCODE",31,0)
 K PSIUDA,PSIUX
"RTN","SROCODE",32,0)
 Q
"RTN","SROINQ")
0^5^B18402832
"RTN","SROINQ",1,0)
SROINQ ;B'HAM ISC/MAM  - OPERATION INQUIRY ; [ 07/20/04  12:44 PM ]
"RTN","SROINQ",2,0)
 ;;3.0; Surgery ;**38,48,129,151**;24 Jun 93
"RTN","SROINQ",3,0)
 ;
"RTN","SROINQ",4,0)
 ; Reference to ^PSS50 supported by DBIA #4533
"RTN","SROINQ",5,0)
 ;
"RTN","SROINQ",6,0)
 I '$D(SRTN) W !!,"OPERATION NOT SELECTED !",! Q
"RTN","SROINQ",7,0)
 S S(0)=^SRF(SRTN,0),DFN=$P(S(0),"^") D DEM^VADPT S SRTNM=VADM(1),SSN=VA("PID"),SRTNM=SRTNM_" ("_VA("PID")_")"
"RTN","SROINQ",8,0)
 S SRLINE="" F I=0:1:79 S SRLINE=SRLINE_"-"
"RTN","SROINQ",9,0)
 S SRTMAJ=$S($P(S(0),"^",3)="J":"MAJOR",$P(S(0),"^",3)="N":"MINOR",1:""),SRTCC=$P($G(^SRF(SRTN,"1.0")),"^",8),S(.1)=$S($D(^SRF(SRTN,.1)):^(.1),1:"")
"RTN","SROINQ",10,0)
 S SRTSP=$S($P(S(0),"^",4):$P(^SRO(137.45,$P(S(0),"^",4),0),"^"),1:"")
"RTN","SROINQ",11,0)
 S Y=SRTCC,C=$P(^DD(130,1.09,0),"^",2) D:Y'="" Y^DIQ S SRTCC=Y S SRSUR=$P(S(.1),"^",4),SRATT=$P(S(.1),"^",13),SRANE=$P($G(^SRF(SRTN,.3)),"^") S:SRSUR]"" SRSUR=$P(^VA(200,SRSUR,0),"^") S:SRATT]"" SRATT=$P(^VA(200,SRATT,0),"^")
"RTN","SROINQ",12,0)
 S:SRANE SRANE=$P(^VA(200,SRANE,0),"^")
"RTN","SROINQ",13,0)
 S SRATCD="",Y=$P($G(^SRF(SRTN,.1)),"^",10) I Y S C=$P(^DD(130,.166,0),"^",2) D Y^DIQ S SRATCD=Y
"RTN","SROINQ",14,0)
 I SRATCD="" S SRATCD="ATTENDING CODE NOT ENTERED"
"RTN","SROINQ",15,0)
 ;S X=$P(S(.1),"^",16),SRTACD=$S(X=0:"0. STAFF",X=1:"1. ATTENDING IN O.R.",X=2:"2. ATTENDING IN O.R. SUITE",X=3:"3. ATTENDING NOT PRESENT, BUT AVAILABLE",1:"")
"RTN","SROINQ",16,0)
 I $L(SRANE)>18 S SRANE=$P(SRANE,",")_","_$E($P(SRANE,",",2),1)_"."
"RTN","SROINQ",17,0)
 S SRTCMP=$S($O(^SRF(SRTN,10,0)):"YES",1:"NO"),SRTCMP1=$S($O(^SRF(SRTN,16,0)):"YES",1:"NO")
"RTN","SROINQ",18,0)
 S Y=$P(^SRF(SRTN,0),"^",9) D D^DIQ S SRSDATE=Y
"RTN","SROINQ",19,0)
 S:'$D(SRICD("*")) SRICD("*")="NOT ENTERED"
"RTN","SROINQ",20,0)
ANES I $D(^SRF(SRTN,6,0)) S I=0 F J=0:0 S I=$O(^SRF(SRTN,6,I)) Q:'I  S SRANE(I)=$P(^(I,0),U) D AGENT
"RTN","SROINQ",21,0)
TIME S S(.2)=$G(^SRF(SRTN,.2)),(X1,SRTDG)=$P(S(.2),"^",3),X=$P(S(.2),"^",2) D MINS^SRSUTL2 S SRTIME=X S SRTBL=$P(S(.2),"^",5)
"RTN","SROINQ",22,0)
 S:'$D(SRTIME) SRTIME="" S:'$D(SRTBL) SRTBL=""
"RTN","SROINQ",23,0)
OPS S SROPER=$P(^SRF(SRTN,"OP"),"^"),OPER=0 F I=0:0 S OPER=$O(^SRF(SRTN,13,OPER)) Q:OPER=""  D OTHER
"RTN","SROINQ",24,0)
 K SROPS,MM,MMM S:$L(SROPER)<75 SROPS(1)=SROPER I $L(SROPER)>74 S SROPER=SROPER_"  " F M=1:1 D LOOP Q:MMM=""
"RTN","SROINQ",25,0)
ICD9 S:'$D(SRTDG) SRTDG="" S SRTDG=$S(+SRTDG:15,1:14),SRTDG1=$S(SRTDG=15:3,1:1),SRTDG2=$S(SRTDG=15:33,1:34)
"RTN","SROINQ",26,0)
 S SRICD=0 S:$D(^SRF(SRTN,SRTDG2)) SRICD("*")=$P(^SRF(SRTN,SRTDG2),"^") F I=0:0 S SRICD=$O(^SRF(SRTN,SRTDG,SRICD)) Q:'SRICD  S SRICD(SRICD)=$P(^SRF(SRTN,SRTDG,SRICD,0),"^")
"RTN","SROINQ",27,0)
 S:'$D(SRTDG("*")) SRTDG("*")=""
"RTN","SROINQ",28,0)
PRINT ; print inquiry
"RTN","SROINQ",29,0)
 W @IOF,!,SRLINE,!,"Patient: "_SRTNM,?50,"Operation Date: "_$P(SRSDATE,"@"),!,"Surgeon: "_SRSUR,?50,"Major/Minor:   "_SRTMAJ
"RTN","SROINQ",30,0)
 W !,"Attending Surgeon: "_SRATT,?50,"Operation Time: "_SRTIME I SRTIME W " Minutes",!,"Attending Code: "_SRATCD,!,SRLINE
"RTN","SROINQ",31,0)
 W !,"Operation(s): ",!,SROPS(1) I $D(SROPS(2)) W !,SROPS(2) I $D(SROPS(3)) W !,SROPS(3) I $D(SROPS(4)) W !,SROPS(4) I $D(SROPS(5)) W !,SROPS(5)
"RTN","SROINQ",32,0)
 W !,SRLINE,!,$S(SRTDG2=33:"Postop",1:"Preop")," Diagnosis:",?47,"Intraop Occurrences: ",SRTCMP,!,"* ",SRICD("*"),?47,"Postop Occurrences:  ",SRTCMP1 F I=0:0 S I=$O(SRICD(I)) Q:'I  W !,?4,SRICD(I)
"RTN","SROINQ",33,0)
 W !,SRLINE,!,"Anesthesia Technique: ",?47,"Anesthetist: ",SRANE F I=0:0 S I=$O(SRANE(I)) Q:'I  W !,?4 S Y=$P(SRANE(I),"^"),C=$P(^DD(130.06,.01,0),"^",2) D:Y'="" Y^DIQ W:Y]"" Y D AGT
"RTN","SROINQ",34,0)
 W !,SRLINE,!,"Wound Classification:      ",SRTCC,!,"Intraoperative Blood Loss: ",SRTBL,$S(SRTBL]"":" CC'S",1:""),!,SRLINE
"RTN","SROINQ",35,0)
 W !!!,"Press RETURN to continue  " R ANS:DTIME
"RTN","SROINQ",36,0)
END D ^SRSKILL W @IOF
"RTN","SROINQ",37,0)
 Q
"RTN","SROINQ",38,0)
OTHER ; other operations
"RTN","SROINQ",39,0)
 S SRLONG=1 I $L(SROPER)+$L($P(^SRF(SRTN,13,OPER,0),"^"))>250 S SRLONG=0,OPER=999,SROPERS=" ..."
"RTN","SROINQ",40,0)
 I SRLONG S SROPERS=$P(^SRF(SRTN,13,OPER,0),"^")
"RTN","SROINQ",41,0)
 S SROPER=SROPER_$S(SROPERS=" ...":SROPERS,1:", "_SROPERS)
"RTN","SROINQ",42,0)
 Q
"RTN","SROINQ",43,0)
LOOP ; break procedure if greater than 75 characters
"RTN","SROINQ",44,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<75  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROINQ",45,0)
 Q
"RTN","SROINQ",46,0)
AGT F T=0:0 S T=$O(SRANE(I,T)) Q:'T  W !,?6,SRANE(I,T)
"RTN","SROINQ",47,0)
 Q
"RTN","SROINQ",48,0)
AGENT ; anesthesia agents
"RTN","SROINQ",49,0)
 S Q=0 F T=0:0 S Q=$O(^SRF(SRTN,6,I,1,Q)) Q:'Q  S Z=$P(^(Q,0),U) D
"RTN","SROINQ",50,0)
 .D DATA^PSS50(Z,,,,,"SRRX") S SRANE(I,Q)=$P($G(^TMP($J,"SRRX",Z,.01)),"^") K ^TMP($J,"SRRX",Z)
"RTN","SROMED")
0^6^B19949445
"RTN","SROMED",1,0)
SROMED ;B'HAM ISC/MAM - ENTER/EDIT MEDICATIONS ; [ 01/30/01  12:22 AM ]
"RTN","SROMED",2,0)
 ;;3.0; Surgery ;**21,44,79,100,151**;24 Jun 93
"RTN","SROMED",3,0)
 ;
"RTN","SROMED",4,0)
 ; Reference to ^PSDRUG supported by DBIA #221
"RTN","SROMED",5,0)
 ;
"RTN","SROMED",6,0)
 I '$D(^XUSEC("SROEDIT",DUZ))&'$D(^XUSEC("SROANES",DUZ)) W !!!,$C(7),"You must hold the SROEDIT key or the SROANES key to use this option !",! Q
"RTN","SROMED",7,0)
 D ^SROLOCK G:SROLOCK END Q:'$D(SRTN)
"RTN","SROMED",8,0)
 N SRLCK S SRLCK=$$LOCK^SROUTL(SRTN) I 'SRLCK G END
"RTN","SROMED",9,0)
START S SRQ=0,SRSMED=1 G:SRTN<1 END W @IOF S SRF=0 R !!,"ENTER MEDICATION/DOSE(MG)/ROUTE/TIME: ",M:DTIME S:'$T M="^" G:M=""!(M="^") END S SRM=$P(M,"/",1),SRD=$P(M,"/",2),SRR=$P(M,"/",3),SRT=$P(M,"/",4) W !!
"RTN","SROMED",10,0)
 I M="?" W !!,"Enter the medication, dose, route and time, separated by slashes (/).",!,"The Medication and time MUST be included, however the route and dose",!,"can be omitted.  i.e. 'MEDICATION/DOSE//TIME' will omit the route."
"RTN","SROMED",11,0)
 I M="?" W !!,"Enter '??' to get a list of available drugs.",! D RET G:SRQ END G START
"RTN","SROMED",12,0)
 I M?.E1C.E W !!,"Your answer has a control character in it, please re-type it.",! D RET G:SRQ END G START
"RTN","SROMED",13,0)
 S (X,SRMM)=SRM D
"RTN","SROMED",14,0)
 .I $L($T(SCREEN^PSSDI)) N SRTEST S SRTEST=50,SRTEST(0)="EQSZ" D DIC^PSSDI(50,"SR",.SRTEST,X,,DT) Q  ;call PSSDI if PSS*1*104 is released
"RTN","SROMED",15,0)
 .S DIC="^PSDRUG(",DIC(0)="QEZM",DIC("S")="I $S('$G(^PSDRUG(Y,""I"")):1,DT'>^(""I""):1,1:0)" D ^DIC K DIC
"RTN","SROMED",16,0)
 S SRM=$S(Y<0:"",1:$P(Y,"^",2))
"RTN","SROMED",17,0)
 I SRM="",SRMM'["?" W !!,"The Drug '",SRMM,"' does not exist in your Drug file.  Please re-enter. " D RET G:SRQ END G START
"RTN","SROMED",18,0)
 I SRMM="??" D RET G:SRQ END G START
"RTN","SROMED",19,0)
 D TIME G:'$D(SRT) FLAG S X=SRT D FIELD^DID(130,.204,"","INPUT TRANSFORM","SRX") S SRX=SRX("INPUT TRANSFORM") X:SRT'="" SRX S SRT=$S(X="":SRT,1:X) D ROUTE G:'$D(SRR) FLAG D DOSE G:'$D(SRD) FLAG
"RTN","SROMED",20,0)
FLAG S SRF=$S('$D(SRT)!('$D(SRD))!('$D(SRR)):0,1:1) I 'SRF W !!!,"NO ACTION TAKEN",! H 2 G END
"RTN","SROMED",21,0)
DIE S DA=SRTN,DIE=130,DR=".375///"_SRM,DR(2,130.33)="1///"_SRT,DR(3,130.34)="1///"_SRD_";4///"_SRR D ^DIE W !!!,"MEDICATION ENTERED ...." K DR H 2
"RTN","SROMED",22,0)
 G START
"RTN","SROMED",23,0)
END W @IOF D ^SRSKILL D:$G(SRLCK) UNLOCK^SROUTL(SRTN)
"RTN","SROMED",24,0)
 Q
"RTN","SROMED",25,0)
RET R !!,"Press RETURN to Continue.   ",Z:DTIME S:'$T Z="^" S:Z="^" SRQ=1 Q
"RTN","SROMED",26,0)
 Q
"RTN","SROMED",27,0)
ROUTE ; check for route of administration
"RTN","SROMED",28,0)
 Q:SRR=""  N SRHELP,SRVALUE D CHK^DIE(130.34,4,"E",SRR,.SRVALUE) I SRVALUE'="^" S SRR=SRVALUE Q
"RTN","SROMED",29,0)
 D HELP^DIE(130.34,"",4,"S","SRHELP(1)")
"RTN","SROMED",30,0)
 W !!,"Route entered is not one of the available choices.",!,"Please enter medication route again.",!!
"RTN","SROMED",31,0)
 I $G(SRHELP(1,"DIHELP")) F I=1:1:SRHELP(1,"DIHELP") W SRHELP(1,"DIHELP",I),!
"RTN","SROMED",32,0)
 S DIR("A")="Enter ROUTE",DIR(0)="130.34,4O" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRR="" Q
"RTN","SROMED",33,0)
 S SRR=$P(Y,"^")
"RTN","SROMED",34,0)
 Q
"RTN","SROMED",35,0)
TIME ; check for time
"RTN","SROMED",36,0)
 K %DT S X=SRT,%DT="R" D ^%DT I Y>0 Q
"RTN","SROMED",37,0)
  W:SRT="" !!,"A time MUST be entered !"
"RTN","SROMED",38,0)
 I '(SRT?1N!(SRT?2N&(SRT<13))!(SRT?4N)!(SRT?3N)!(SRT?2N1":"2N)!(SRT?1N1":"2N))!(+SRT>2400)!(SRT="") S SRF=1
"RTN","SROMED",39,0)
 I SRF W !!,?5,"Enter the time in one of the following formats:",!,?9,"7:45, 0745, 745, 07:45, Date@Time, or NOW",!!,?5,"Time is required."
"RTN","SROMED",40,0)
T1 S:SRT="" SRF=1 Q:SRF=0  R !!,"Enter Time: ",SRT:DTIME S:'$T!(SRT="") SRT="^" G:SRT["^" END W:SRT["?" !!,"Enter a time in the format above, or RETURN to bypass.  An '^' will exit this option." G:SRT["?" T1 S SRF=0 G TIME
"RTN","SROMED",41,0)
 Q
"RTN","SROMED",42,0)
DOSE ; check dosage
"RTN","SROMED",43,0)
 Q:SRD=""  I $L(SRD)>15!($L(SRD)<1) W !!,"Dosage entered incorrectly." S SRF=1
"RTN","SROMED",44,0)
 I SRD="?" W !!,"Dosage must be 1 to 15 characters in length, i.e. 15 mg." S SRF=1
"RTN","SROMED",45,0)
D1 I SRF=1 R !!,"ENTER DOSE: ",SRD1:DTIME S:'$T SRD1="^" K:SRD1["^" SRD Q:SRD1["^"  W:SRD1["?" !!,"Dosage must be 1 to 15 characters in length" G:SRD1["?" D1 S SRD=SRD1,SRF=0 G DOSE
"RTN","SROMED",46,0)
 Q
"UP",130,130.33,-1)
130^22
"UP",130,130.33,0)
130.33
"VER")
8.0^22.0
"^DD",130,130,.375,0)
MEDICATIONS^130.33PA^^22;0
"^DD",130,130,.375,.1)
Medications
"^DD",130,130,.375,21,0)
^^1^1^2900105^
"^DD",130,130,.375,21,1,0)
This is information about medication for this case.
"^DD",130,130.33,0)
MEDICATIONS SUB-FIELD^NL^1^2
"^DD",130,130.33,0,"NM","MEDICATIONS")

"^DD",130,130.33,.01,0)
MEDICATIONS^*P50'^PSDRUG(^0;1^S DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",130,130.33,.01,.1)
Medications
"^DD",130,130.33,.01,3)
Answer must be 4-20 characters in length
"^DD",130,130.33,.01,4)

"^DD",130,130.33,.01,12)
Inactive Drugs are not selectable.
"^DD",130,130.33,.01,12.1)
S DIC("S")="I $S('$D(^(""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0)"
"^DD",130,130.33,.01,21,0)
^^3^3^2900709^^^^
"^DD",130,130.33,.01,21,1,0)
This is the name of the medication (generic or proprietary).
"^DD",130,130.33,.01,21,2,0)
More than one medication may be entered for each case.
"^DD",130,130.33,.01,21,3,0)
 
"^DD",130,130.33,.01,"DEL",.01,0)
I $D(^SRF(DA(1),"CON")),$P(^("CON"),"^") D ^SROCOND I 0
"^DD",130,130.33,.01,"DT")
3051121
"BLD",5519,6)
^143
**END**
**END**
