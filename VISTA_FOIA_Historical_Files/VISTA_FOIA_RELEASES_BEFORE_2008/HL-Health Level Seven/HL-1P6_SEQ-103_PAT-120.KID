Released HL*1.6*120 SEQ #103
Extracted from mail message
**KIDS**:HL*1.6*120^

**INSTALL NAME**
HL*1.6*120
"BLD",926,0)
HL*1.6*120^HEALTH LEVEL SEVEN^0^3060307^y
"BLD",926,4,0)
^9.64PA^779.004^1
"BLD",926,4,779.004,0)
779.004
"BLD",926,4,779.004,222)
y^n^f^^y^^y^r^n
"BLD",926,4,"B",779.004,779.004)

"BLD",926,6.3)
12
"BLD",926,"INI")
PRE^HLPAT120
"BLD",926,"INID")
^y
"BLD",926,"INIT")
POST^HLPAT120
"BLD",926,"KRN",0)
^9.67PA^8989.52^19
"BLD",926,"KRN",.4,0)
.4
"BLD",926,"KRN",.401,0)
.401
"BLD",926,"KRN",.402,0)
.402
"BLD",926,"KRN",.403,0)
.403
"BLD",926,"KRN",.5,0)
.5
"BLD",926,"KRN",.84,0)
.84
"BLD",926,"KRN",3.6,0)
3.6
"BLD",926,"KRN",3.8,0)
3.8
"BLD",926,"KRN",9.2,0)
9.2
"BLD",926,"KRN",9.8,0)
9.8
"BLD",926,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",926,"KRN",9.8,"NM",1,0)
HLPAT120^^0^B4889907
"BLD",926,"KRN",9.8,"NM",2,0)
HLCSHDR1^^0^B53997699
"BLD",926,"KRN",9.8,"NM",3,0)
HLMA2^^0^B40932802
"BLD",926,"KRN",9.8,"NM",4,0)
HLCSAS^^0^B12656721
"BLD",926,"KRN",9.8,"NM",5,0)
HLTPCK1^^0^B31754890
"BLD",926,"KRN",9.8,"NM",6,0)
HLTPCK2^^0^B34416614
"BLD",926,"KRN",9.8,"NM",7,0)
HLUTIL2^^0^B29544975
"BLD",926,"KRN",9.8,"NM",8,0)
HLTF^^0^B49703549
"BLD",926,"KRN",9.8,"NM",9,0)
HLTP3^^0^B72235579
"BLD",926,"KRN",9.8,"NM",10,0)
HLTP31^^0^B13120490
"BLD",926,"KRN",9.8,"NM",11,0)
HLTP4^^0^B45154182
"BLD",926,"KRN",9.8,"NM",12,0)
HLTPCK2A^^0^B27212258
"BLD",926,"KRN",9.8,"NM",13,0)
HLTPCK2B^^0^B63390233
"BLD",926,"KRN",9.8,"NM","B","HLCSAS",4)

"BLD",926,"KRN",9.8,"NM","B","HLCSHDR1",2)

"BLD",926,"KRN",9.8,"NM","B","HLMA2",3)

"BLD",926,"KRN",9.8,"NM","B","HLPAT120",1)

"BLD",926,"KRN",9.8,"NM","B","HLTF",8)

"BLD",926,"KRN",9.8,"NM","B","HLTP3",9)

"BLD",926,"KRN",9.8,"NM","B","HLTP31",10)

"BLD",926,"KRN",9.8,"NM","B","HLTP4",11)

"BLD",926,"KRN",9.8,"NM","B","HLTPCK1",5)

"BLD",926,"KRN",9.8,"NM","B","HLTPCK2",6)

"BLD",926,"KRN",9.8,"NM","B","HLTPCK2A",12)

"BLD",926,"KRN",9.8,"NM","B","HLTPCK2B",13)

"BLD",926,"KRN",9.8,"NM","B","HLUTIL2",7)

"BLD",926,"KRN",19,0)
19
"BLD",926,"KRN",19.1,0)
19.1
"BLD",926,"KRN",101,0)
101
"BLD",926,"KRN",409.61,0)
409.61
"BLD",926,"KRN",771,0)
771
"BLD",926,"KRN",870,0)
870
"BLD",926,"KRN",8989.51,0)
8989.51
"BLD",926,"KRN",8989.52,0)
8989.52
"BLD",926,"KRN",8994,0)
8994
"BLD",926,"KRN","B",.4,.4)

"BLD",926,"KRN","B",.401,.401)

"BLD",926,"KRN","B",.402,.402)

"BLD",926,"KRN","B",.403,.403)

"BLD",926,"KRN","B",.5,.5)

"BLD",926,"KRN","B",.84,.84)

"BLD",926,"KRN","B",3.6,3.6)

"BLD",926,"KRN","B",3.8,3.8)

"BLD",926,"KRN","B",9.2,9.2)

"BLD",926,"KRN","B",9.8,9.8)

"BLD",926,"KRN","B",19,19)

"BLD",926,"KRN","B",19.1,19.1)

"BLD",926,"KRN","B",101,101)

"BLD",926,"KRN","B",409.61,409.61)

"BLD",926,"KRN","B",771,771)

"BLD",926,"KRN","B",870,870)

"BLD",926,"KRN","B",8989.51,8989.51)

"BLD",926,"KRN","B",8989.52,8989.52)

"BLD",926,"KRN","B",8994,8994)

"BLD",926,"QUES",0)
^9.62^^
"BLD",926,"REQB",0)
^9.611^5^5
"BLD",926,"REQB",1,0)
HL*1.6*89^0
"BLD",926,"REQB",2,0)
HL*1.6*93^2
"BLD",926,"REQB",3,0)
HL*1.6*109^2
"BLD",926,"REQB",4,0)
HL*1.6*125^2
"BLD",926,"REQB",5,0)
HL*1.6*108^2
"BLD",926,"REQB","B","HL*1.6*108",5)

"BLD",926,"REQB","B","HL*1.6*109",3)

"BLD",926,"REQB","B","HL*1.6*125",4)

"BLD",926,"REQB","B","HL*1.6*89",1)

"BLD",926,"REQB","B","HL*1.6*93",2)

"DATA",779.004,2,0)
USA^United States
"DATA",779.004,2,1,0)
^779.00401P^2^4
"DATA",779.004,2,"SDS")
840^US^UNITED STATES
"DATA",779.004,2,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,2,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,2,"VUID")
1006840^1
"DATA",779.004,4,0)
AFG^Afghanistan
"DATA",779.004,4,"SDS")
004^AF^AFGHANISTAN
"DATA",779.004,4,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,4,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,4,"VUID")
1006004^1
"DATA",779.004,5,0)
ALB^Albania
"DATA",779.004,5,"SDS")
008^AL^ALBANIA
"DATA",779.004,5,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,5,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,5,"VUID")
1006008^1
"DATA",779.004,6,0)
ATA^Antarctica
"DATA",779.004,6,"SDS")
010^AY^<NULL>
"DATA",779.004,6,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,6,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,6,"VUID")
1006010^1
"DATA",779.004,7,0)
DZA^Algeria
"DATA",779.004,7,"SDS")
012^AG^ALGERIA
"DATA",779.004,7,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,7,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,7,"VUID")
1006012^1
"DATA",779.004,8,0)
AND^Andorra
"DATA",779.004,8,"SDS")
020^AN^ANDORRA
"DATA",779.004,8,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,8,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,8,"VUID")
1006020^1
"DATA",779.004,9,0)
AGO^Angola
"DATA",779.004,9,"SDS")
024^AO^ANGOLA
"DATA",779.004,9,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,9,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,9,"VUID")
1006024^1
"DATA",779.004,10,0)
ATG^Antigua and Barbuda
"DATA",779.004,10,"SDS")
028^AC^ANTIGUA AND BARBUDA
"DATA",779.004,10,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,10,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,10,"VUID")
1006028^1
"DATA",779.004,11,0)
AZE^Azerbaijan
"DATA",779.004,11,"SDS")
031^AJ^AZERBAIJAN
"DATA",779.004,11,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,11,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,11,"VUID")
1006031^1
"DATA",779.004,12,0)
ARG^Argentina
"DATA",779.004,12,"SDS")
032^AR^ARGENTINA
"DATA",779.004,12,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,12,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,12,"VUID")
1006032^1
"DATA",779.004,13,0)
AUS^Australia
"DATA",779.004,13,"SDS")
036^AS^AUSTRALIA
"DATA",779.004,13,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,13,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,13,"VUID")
1006036^1
"DATA",779.004,14,0)
AUT^Austria
"DATA",779.004,14,"SDS")
040^AU^AUSTRIA
"DATA",779.004,14,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,14,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,14,"VUID")
1006040^1
"DATA",779.004,15,0)
BHS^Bahamas
"DATA",779.004,15,"SDS")
044^BF^BAHAMAS
"DATA",779.004,15,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,15,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,15,"VUID")
1006044^1
"DATA",779.004,16,0)
BHR^Bahrain
"DATA",779.004,16,"SDS")
048^BA^BAHRAIN
"DATA",779.004,16,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,16,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,16,"VUID")
1006048^1
"DATA",779.004,17,0)
BGD^Bangladesh
"DATA",779.004,17,"SDS")
050^BG^BANGLADESH
"DATA",779.004,17,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,17,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,17,"VUID")
1006050^1
"DATA",779.004,18,0)
ARM^Armenia
"DATA",779.004,18,"SDS")
051^AM^ARMENIA
"DATA",779.004,18,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,18,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,18,"VUID")
1006051^1
"DATA",779.004,19,0)
BRB^Barbados
"DATA",779.004,19,"SDS")
052^BB^BARBADOS
"DATA",779.004,19,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,19,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,19,"VUID")
1006052^1
"DATA",779.004,20,0)
BEL^Belgium
"DATA",779.004,20,"SDS")
056^BE^BELGIUM
"DATA",779.004,20,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,20,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,20,"VUID")
1006056^1
"DATA",779.004,21,0)
BMU^Bermuda
"DATA",779.004,21,"SDS")
060^BD^BERMUDA
"DATA",779.004,21,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,21,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,21,"VUID")
1006060^1
"DATA",779.004,22,0)
BTN^Bhutan
"DATA",779.004,22,"SDS")
064^BT^BHUTAN
"DATA",779.004,22,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,22,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,22,"VUID")
1006064^1
"DATA",779.004,23,0)
BOL^Bolivia
"DATA",779.004,23,"SDS")
068^BL^BOLIVIA
"DATA",779.004,23,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,23,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,23,"VUID")
1006068^1
"DATA",779.004,24,0)
BIH^Bosnia and Herzegovina
"DATA",779.004,24,"SDS")
070^BK^BOSNIA-HERZOGOVINA
"DATA",779.004,24,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,24,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,24,"VUID")
1006070^1
"DATA",779.004,25,0)
BWA^Botswana
"DATA",779.004,25,"SDS")
072^BC^BOTSWANA
"DATA",779.004,25,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,25,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,25,"VUID")
1006072^1
"DATA",779.004,26,0)
BVT^Bouvet Island
"DATA",779.004,26,"SDS")
074^BV^<NULL>
"DATA",779.004,26,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,26,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,26,"VUID")
1006074^1
"DATA",779.004,27,0)
BRA^Brazil
"DATA",779.004,27,"SDS")
076^BR^BRAZIL
"DATA",779.004,27,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,27,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,27,"VUID")
1006076^1
"DATA",779.004,28,0)
BLZ^Belize
"DATA",779.004,28,"SDS")
084^BH^BELIZE
"DATA",779.004,28,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,28,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,28,"VUID")
1006084^1
"DATA",779.004,29,0)
IOT^British Indian Ocean Territory
"DATA",779.004,29,"SDS")
086^IO^<NULL>
"DATA",779.004,29,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,29,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,29,"VUID")
1006086^1
"DATA",779.004,30,0)
SLB^Solomon Islands
"DATA",779.004,30,"SDS")
090^BP^SOLOMON ISLANDS
"DATA",779.004,30,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,30,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,30,"VUID")
1006090^1
"DATA",779.004,31,0)
VGB^Virgin Islands, British
"DATA",779.004,31,"SDS")
092^VI^BRITISH VIRGIN ISLANDS
"DATA",779.004,31,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,31,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,31,"VUID")
1006092^1
"DATA",779.004,32,0)
BRN^Brunei Darussalam
"DATA",779.004,32,"SDS")
096^BX^BRUNEI DARUSSALAM
"DATA",779.004,32,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,32,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,32,"VUID")
1006096^1
"DATA",779.004,33,0)
BGR^Bulgaria
"DATA",779.004,33,"SDS")
100^BU^BULGARIA
"DATA",779.004,33,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,33,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,33,"VUID")
1006100^1
"DATA",779.004,34,0)
MMR^Myanmar
"DATA",779.004,34,"SDS")
104^BM^BURMA
"DATA",779.004,34,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,34,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,34,"VUID")
1006104^1
"DATA",779.004,35,0)
BDI^Burundi
"DATA",779.004,35,"SDS")
108^BY^BURUNDI
"DATA",779.004,35,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,35,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,35,"VUID")
1006108^1
"DATA",779.004,36,0)
BLR^Belarus
"DATA",779.004,36,"SDS")
112^BO^BELARUS
"DATA",779.004,36,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,36,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,36,"VUID")
1006112^1
"DATA",779.004,37,0)
KHM^Cambodia
"DATA",779.004,37,"SDS")
116^CB^CAMBODIA
"DATA",779.004,37,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,37,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,37,"VUID")
1006116^1
"DATA",779.004,38,0)
CMR^Cameroon
"DATA",779.004,38,"SDS")
120^CM^CAMEROON
"DATA",779.004,38,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,38,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,38,"VUID")
1006120^1
"DATA",779.004,39,0)
CAN^Canada
"DATA",779.004,39,"SDS")
124^CA^CANADA
"DATA",779.004,39,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,39,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,39,"VUID")
1006124^1
"DATA",779.004,40,0)
CPV^Cape Verde
"DATA",779.004,40,"SDS")
132^CV^CAPE VERDE
"DATA",779.004,40,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,40,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,40,"VUID")
1006132^1
"DATA",779.004,41,0)
CYM^Cayman Islands
"DATA",779.004,41,"SDS")
136^CJ^CAYMAN ISLANDS
"DATA",779.004,41,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,41,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,41,"VUID")
1006136^1
"DATA",779.004,42,0)
CAF^Central African Republic
"DATA",779.004,42,"SDS")
140^CT^CENTRAL AFRICAN REPUBLIC
"DATA",779.004,42,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,42,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,42,"VUID")
1006140^1
"DATA",779.004,43,0)
LKA^Sri Lanka
"DATA",779.004,43,"SDS")
144^CE^SRI LANKA
"DATA",779.004,43,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,43,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,43,"VUID")
1006144^1
"DATA",779.004,44,0)
TCD^Chad
"DATA",779.004,44,"SDS")
148^CD^CHAD
"DATA",779.004,44,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,44,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,44,"VUID")
1006148^1
"DATA",779.004,45,0)
CHL^Chile
"DATA",779.004,45,"SDS")
152^CI^CHILE
"DATA",779.004,45,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,45,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,45,"VUID")
1006152^1
"DATA",779.004,46,0)
CHN^China
"DATA",779.004,46,"SDS")
156^CH^CHINA
"DATA",779.004,46,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,46,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,46,"VUID")
1006156^1
"DATA",779.004,47,0)
TWN^Taiwan
"DATA",779.004,47,"SDS")
158^TW^TAIWAN
"DATA",779.004,47,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,47,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,47,"VUID")
1006158^1
"DATA",779.004,48,0)
CXR^Christmas Island
"DATA",779.004,48,"SDS")
162^KT^<NULL>
"DATA",779.004,48,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,48,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,48,"VUID")
1006162^1
"DATA",779.004,49,0)
CCK^Cocos (Keeling) Islands
"DATA",779.004,49,"SDS")
166^CK^<NULL>
"DATA",779.004,49,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,49,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,49,"VUID")
1006166^1
"DATA",779.004,50,0)
COL^Colombia
"DATA",779.004,50,"SDS")
170^CO^COLOMBIA
"DATA",779.004,50,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,50,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,50,"VUID")
1006170^1
"DATA",779.004,51,0)
COM^Comoros
"DATA",779.004,51,"SDS")
174^CN^COMOROS
"DATA",779.004,51,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,51,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,51,"VUID")
1006174^1
"DATA",779.004,52,0)
MYT^Mayotte
"DATA",779.004,52,"SDS")
175^MF^FRANCE
"DATA",779.004,52,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,52,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,52,"VUID")
1006175^1
"DATA",779.004,53,0)
COG^Congo (Brazzaville)
"DATA",779.004,53,"SDS")
178^CF^REPUBLIC OF THE CONGO (BRAZZAVILLE)
"DATA",779.004,53,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,53,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,53,"VUID")
1006178^1
"DATA",779.004,54,0)
COD^Congo (Kinshasa)
"DATA",779.004,54,"SDS")
180^CG^DEMOCRATIC REPUBLIC OF THE CONGO
"DATA",779.004,54,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,54,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,54,"VUID")
1006180^1
"DATA",779.004,55,0)
COK^Cook Islands
"DATA",779.004,55,"SDS")
184^CW^<NULL>
"DATA",779.004,55,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,55,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,55,"VUID")
1006184^1
"DATA",779.004,56,0)
CRI^Costa Rica
"DATA",779.004,56,"SDS")
188^CS^COSTA RICA
"DATA",779.004,56,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,56,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,56,"VUID")
1006188^1
"DATA",779.004,57,0)
HRV^Croatia
"DATA",779.004,57,"SDS")
191^HR^CROATIA
"DATA",779.004,57,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,57,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,57,"VUID")
1006191^1
"DATA",779.004,58,0)
CUB^Cuba
"DATA",779.004,58,"SDS")
192^CU^CUBA
"DATA",779.004,58,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,58,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,58,"VUID")
1006192^1
"DATA",779.004,59,0)
CYP^Cyprus
"DATA",779.004,59,"SDS")
196^CY^CYPRUS
"DATA",779.004,59,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,59,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,59,"VUID")
1006196^1
"DATA",779.004,60,0)
CZE^Czech Republic
"DATA",779.004,60,"SDS")
203^EZ^CZECH REPUBLIC
"DATA",779.004,60,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,60,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,60,"VUID")
1006203^1
"DATA",779.004,61,0)
BEN^Benin
"DATA",779.004,61,"SDS")
204^BN^BENIN
"DATA",779.004,61,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,61,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,61,"VUID")
1006204^1
"DATA",779.004,62,0)
DNK^Denmark
"DATA",779.004,62,"SDS")
208^DA^DENMARK
"DATA",779.004,62,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,62,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,62,"VUID")
1006208^1
"DATA",779.004,63,0)
DMA^Dominica
"DATA",779.004,63,"SDS")
212^DO^DOMINICA
"DATA",779.004,63,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,63,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,63,"VUID")
1006212^1
"DATA",779.004,64,0)
DOM^Dominican Republic
"DATA",779.004,64,"SDS")
214^DR^DOMINICAN REPUBLIC
"DATA",779.004,64,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,64,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,64,"VUID")
1006214^1
"DATA",779.004,65,0)
ECU^Ecuador
"DATA",779.004,65,"SDS")
218^EC^ECUADOR
"DATA",779.004,65,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,65,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,65,"VUID")
1006218^1
"DATA",779.004,66,0)
SLV^El Salvador
"DATA",779.004,66,"SDS")
222^ES^EL SALVADOR
"DATA",779.004,66,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,66,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,66,"VUID")
1006222^1
"DATA",779.004,67,0)
GNQ^Equatorial Guinea
"DATA",779.004,67,"SDS")
226^EK^EQUATORIAL GUINEA
"DATA",779.004,67,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,67,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,67,"VUID")
1006226^1
"DATA",779.004,68,0)
ETH^Ethiopia
"DATA",779.004,68,"SDS")
231^ET^ETHIOPIA
"DATA",779.004,68,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,68,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,68,"VUID")
1006231^1
"DATA",779.004,69,0)
ERI^Eritrea
"DATA",779.004,69,"SDS")
232^ER^ERITREA
"DATA",779.004,69,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,69,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,69,"VUID")
1006232^1
"DATA",779.004,70,0)
EST^Estonia
"DATA",779.004,70,"SDS")
233^EN^ESTONIA
"DATA",779.004,70,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,70,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,70,"VUID")
1006233^1
"DATA",779.004,71,0)
FRO^Faroe Islands
"DATA",779.004,71,"SDS")
234^FO^FAROE ISLANDS
"DATA",779.004,71,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,71,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,71,"VUID")
1006234^1
"DATA",779.004,72,0)
FLK^Falkland Islands
"DATA",779.004,72,"SDS")
238^FK^FALKLAND ISLANDS
"DATA",779.004,72,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,72,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,72,"VUID")
1006238^1
"DATA",779.004,73,0)
SGS^South Georgia and South Sandwich Islands
"DATA",779.004,73,"SDS")
239^SX^FALKLAND ISLANDS
"DATA",779.004,73,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,73,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,73,"VUID")
1006239^1
"DATA",779.004,74,0)
FJI^Fiji
"DATA",779.004,74,"SDS")
242^FJ^FIJI
"DATA",779.004,74,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,74,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,74,"VUID")
1006242^1
"DATA",779.004,75,0)
FIN^Finland
"DATA",779.004,75,"SDS")
246^FI^FINLAND
"DATA",779.004,75,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,75,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,75,"VUID")
1006246^1
"DATA",779.004,76,0)
FRA^France
"DATA",779.004,76,"SDS")
250^FR^FRANCE
"DATA",779.004,76,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,76,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,76,"VUID")
1006250^1
"DATA",779.004,77,0)
GUF^French Guiana
"DATA",779.004,77,"SDS")
254^FG^FRENCH GUIANA
"DATA",779.004,77,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,77,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,77,"VUID")
1006254^1
"DATA",779.004,78,0)
PYF^French Polynesia
"DATA",779.004,78,"SDS")
258^FP^FRENCH POLYNESIA
"DATA",779.004,78,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,78,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,78,"VUID")
1006258^1
"DATA",779.004,79,0)
ATF^French Southern Territories
"DATA",779.004,79,"SDS")
260^FS^<NULL>
"DATA",779.004,79,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,79,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,79,"VUID")
1006260^1
"DATA",779.004,80,0)
DJI^Djibouti
"DATA",779.004,80,"SDS")
262^DJ^DJIBOUTI
"DATA",779.004,80,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,80,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,80,"VUID")
1006262^1
"DATA",779.004,81,0)
GAB^Gabon
"DATA",779.004,81,"SDS")
266^GB^GABON
"DATA",779.004,81,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,81,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,81,"VUID")
1006266^1
"DATA",779.004,82,0)
GEO^Georgia
"DATA",779.004,82,"SDS")
268^GG^REPUBLIC OF GEORGIA
"DATA",779.004,82,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,82,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,82,"VUID")
1006268^1
"DATA",779.004,83,0)
GMB^Gambia
"DATA",779.004,83,"SDS")
270^GA^GAMBIA
"DATA",779.004,83,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,83,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,83,"VUID")
1006270^1
"DATA",779.004,84,0)
DEU^Germany
"DATA",779.004,84,"SDS")
276^GM^GERMANY
"DATA",779.004,84,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,84,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,84,"VUID")
1006276^1
"DATA",779.004,85,0)
GHA^Ghana
"DATA",779.004,85,"SDS")
288^GH^GHANA
"DATA",779.004,85,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,85,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,85,"VUID")
1006288^1
"DATA",779.004,86,0)
GIB^Gibraltar
"DATA",779.004,86,"SDS")
292^GI^GIBRALTAR
"DATA",779.004,86,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,86,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,86,"VUID")
1006292^1
"DATA",779.004,87,0)
KIR^Kiribati
"DATA",779.004,87,"SDS")
296^KR^KIRIBATI
"DATA",779.004,87,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,87,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,87,"VUID")
1006296^1
"DATA",779.004,88,0)
GRC^Greece
"DATA",779.004,88,"SDS")
300^GR^GREECE
"DATA",779.004,88,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,88,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,88,"VUID")
1006300^1
"DATA",779.004,89,0)
GRL^Greenland
"DATA",779.004,89,"SDS")
304^GL^GREENLAND
"DATA",779.004,89,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,89,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,89,"VUID")
1006304^1
"DATA",779.004,90,0)
GRD^Grenada
"DATA",779.004,90,"SDS")
308^GJ^GRENADA
"DATA",779.004,90,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,90,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,90,"VUID")
1006308^1
"DATA",779.004,91,0)
GLP^Guadeloupe
"DATA",779.004,91,"SDS")
312^GP^GUADELOUPE
"DATA",779.004,91,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,91,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,91,"VUID")
1006312^1
"DATA",779.004,92,0)
GTM^Guatemala
"DATA",779.004,92,"SDS")
320^GT^GUATEMALA
"DATA",779.004,92,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,92,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,92,"VUID")
1006320^1
"DATA",779.004,93,0)
GIN^Guinea
"DATA",779.004,93,"SDS")
324^GV^GUINEA
"DATA",779.004,93,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,93,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,93,"VUID")
1006324^1
"DATA",779.004,94,0)
GUY^Guyana
"DATA",779.004,94,"SDS")
328^GY^GUYANA
"DATA",779.004,94,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,94,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,94,"VUID")
1006328^1
"DATA",779.004,95,0)
HTI^Haiti
"DATA",779.004,95,"SDS")
332^HA^HAITI
"DATA",779.004,95,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,95,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,95,"VUID")
1006332^1
"DATA",779.004,96,0)
HMD^Heard and McDonald Islands
"DATA",779.004,96,"SDS")
334^HM^<NULL>
"DATA",779.004,96,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,96,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,96,"VUID")
1006334^1
"DATA",779.004,97,0)
VAT^Vatican City
"DATA",779.004,97,"SDS")
336^VT^VATICAN CITY
"DATA",779.004,97,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,97,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,97,"VUID")
1006336^1
"DATA",779.004,98,0)
HND^Honduras
"DATA",779.004,98,"SDS")
340^HO^HONDURAS
"DATA",779.004,98,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,98,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,98,"VUID")
1006340^1
"DATA",779.004,99,0)
HKG^Hong Kong
"DATA",779.004,99,"SDS")
344^HK^HONG KONG
"DATA",779.004,99,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,99,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,99,"VUID")
1006344^1
"DATA",779.004,100,0)
HUN^Hungary
"DATA",779.004,100,"SDS")
348^HU^HUNGARY
"DATA",779.004,100,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,100,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,100,"VUID")
1006348^1
"DATA",779.004,101,0)
ISL^Iceland
"DATA",779.004,101,"SDS")
352^IC^ICELAND
"DATA",779.004,101,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,101,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,101,"VUID")
1006352^1
"DATA",779.004,102,0)
IND^India
"DATA",779.004,102,"SDS")
356^IN^INDIA
"DATA",779.004,102,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,102,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,102,"VUID")
1006356^1
"DATA",779.004,103,0)
IDN^Indonesia
"DATA",779.004,103,"SDS")
360^ID^INDONESIA
"DATA",779.004,103,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,103,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,103,"VUID")
1006360^1
"DATA",779.004,104,0)
IRN^Iran
"DATA",779.004,104,"SDS")
364^IR^IRAN
"DATA",779.004,104,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,104,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,104,"VUID")
1006364^1
"DATA",779.004,105,0)
IRQ^Iraq
"DATA",779.004,105,"SDS")
368^IZ^IRAQ
"DATA",779.004,105,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,105,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,105,"VUID")
1006368^1
"DATA",779.004,106,0)
IRL^Ireland
"DATA",779.004,106,"SDS")
372^EI^IRELAND (EIRE)
"DATA",779.004,106,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,106,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,106,"VUID")
1006372^1
"DATA",779.004,107,0)
ISR^Israel
"DATA",779.004,107,"SDS")
376^IS^ISRAEL
"DATA",779.004,107,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,107,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,107,"VUID")
1006376^1
"DATA",779.004,108,0)
ITA^Italy
"DATA",779.004,108,"SDS")
380^IT^ITALY
"DATA",779.004,108,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,108,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,108,"VUID")
1006380^1
"DATA",779.004,109,0)
CIV^Côte d'Ivoire
"DATA",779.004,109,"SDS")
384^IV^CÔTE D'IVOIRE
"DATA",779.004,109,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,109,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,109,"VUID")
1006384^1
"DATA",779.004,110,0)
JAM^Jamaica
"DATA",779.004,110,"SDS")
388^JM^JAMAICA
"DATA",779.004,110,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,110,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,110,"VUID")
1006388^1
"DATA",779.004,111,0)
JPN^Japan
"DATA",779.004,111,"SDS")
392^JA^JAPAN
"DATA",779.004,111,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,111,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,111,"VUID")
1006392^1
"DATA",779.004,112,0)
KAZ^Kazakhstan
"DATA",779.004,112,"SDS")
398^KZ^KAZAKHSTAN
"DATA",779.004,112,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,112,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,112,"VUID")
1006398^1
"DATA",779.004,113,0)
JOR^Jordan
"DATA",779.004,113,"SDS")
400^JO^JORDAN
"DATA",779.004,113,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,113,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,113,"VUID")
1006400^1
"DATA",779.004,114,0)
KEN^Kenya
"DATA",779.004,114,"SDS")
404^KE^KENYA
"DATA",779.004,114,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,114,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,114,"VUID")
1006404^1
"DATA",779.004,115,0)
PRK^Korea, North
"DATA",779.004,115,"SDS")
408^KN^DEMOCRATIC PEOPLE'S REPUBLIC OF KOREA (NORTH KOREA)
"DATA",779.004,115,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,115,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,115,"VUID")
1006408^1
"DATA",779.004,116,0)
KOR^Korea, South
"DATA",779.004,116,"SDS")
410^KS^REPUBLIC OF KOREA (SOUTH KOREA)
"DATA",779.004,116,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,116,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,116,"VUID")
1006410^1
"DATA",779.004,117,0)
KWT^Kuwait
"DATA",779.004,117,"SDS")
414^KU^KUWAIT
"DATA",779.004,117,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,117,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,117,"VUID")
1006414^1
"DATA",779.004,118,0)
KGZ^Kyrgyzstan
"DATA",779.004,118,"SDS")
417^KG^KYRGYZSTAN
"DATA",779.004,118,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,118,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,118,"VUID")
1006417^1
"DATA",779.004,119,0)
LAO^Laos
"DATA",779.004,119,"SDS")
418^LA^LAOS
"DATA",779.004,119,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,119,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,119,"VUID")
1006418^1
"DATA",779.004,120,0)
LBN^Lebanon
"DATA",779.004,120,"SDS")
422^LE^LEBANON
"DATA",779.004,120,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,120,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,120,"VUID")
1006422^1
"DATA",779.004,121,0)
LSO^Lesotho
"DATA",779.004,121,"SDS")
426^LT^LESOTHO
"DATA",779.004,121,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,121,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,121,"VUID")
1006426^1
"DATA",779.004,122,0)
LVA^Latvia
"DATA",779.004,122,"SDS")
428^LG^LATVIA
"DATA",779.004,122,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,122,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,122,"VUID")
1006428^1
"DATA",779.004,123,0)
LBR^Liberia
"DATA",779.004,123,"SDS")
430^LI^LIBERIA
"DATA",779.004,123,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,123,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,123,"VUID")
1006430^1
"DATA",779.004,124,0)
LBY^Libya
"DATA",779.004,124,"SDS")
434^LY^LIBYA
"DATA",779.004,124,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,124,"TERMSTATUS",1,0)
3060119.165006^1
"DATA",779.004,124,"VUID")
1006434^1
"DATA",779.004,125,0)
LIE^Liechtenstein
"DATA",779.004,125,"SDS")
438^LS^LIECHTENSTEIN
"DATA",779.004,125,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,125,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,125,"VUID")
1006438^1
"DATA",779.004,126,0)
LTU^Lithuania
"DATA",779.004,126,"SDS")
440^LH^LITHUANIA
"DATA",779.004,126,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,126,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,126,"VUID")
1006440^1
"DATA",779.004,127,0)
LUX^Luxembourg
"DATA",779.004,127,"SDS")
442^LU^LUXEMBOURG
"DATA",779.004,127,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,127,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,127,"VUID")
1006442^1
"DATA",779.004,128,0)
MAC^Macao
"DATA",779.004,128,"SDS")
446^MC^MACAO
"DATA",779.004,128,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,128,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,128,"VUID")
1006446^1
"DATA",779.004,129,0)
MDG^Madagascar
"DATA",779.004,129,"SDS")
450^MA^MADAGASCAR
"DATA",779.004,129,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,129,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,129,"VUID")
1006450^1
"DATA",779.004,130,0)
MWI^Malawi
"DATA",779.004,130,"SDS")
454^MI^MALAWI
"DATA",779.004,130,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,130,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,130,"VUID")
1006454^1
"DATA",779.004,131,0)
MYS^Malaysia
"DATA",779.004,131,"SDS")
458^MY^MALAYSIA
"DATA",779.004,131,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,131,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,131,"VUID")
1006458^1
"DATA",779.004,132,0)
MDV^Maldives
"DATA",779.004,132,"SDS")
462^MV^MALDIVES
"DATA",779.004,132,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,132,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,132,"VUID")
1006462^1
"DATA",779.004,133,0)
MLI^Mali
"DATA",779.004,133,"SDS")
466^ML^MALI
"DATA",779.004,133,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,133,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,133,"VUID")
1006466^1
"DATA",779.004,134,0)
MLT^Malta
"DATA",779.004,134,"SDS")
470^MT^MALTA
"DATA",779.004,134,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,134,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,134,"VUID")
1006470^1
"DATA",779.004,135,0)
MTQ^Martinique
"DATA",779.004,135,"SDS")
474^MB^MARTINIQUE
"DATA",779.004,135,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,135,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,135,"VUID")
1006474^1
"DATA",779.004,136,0)
MRT^Mauritania
"DATA",779.004,136,"SDS")
478^MR^MAURITANIA
"DATA",779.004,136,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,136,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,136,"VUID")
1006478^1
"DATA",779.004,137,0)
MUS^Mauritius
"DATA",779.004,137,"SDS")
480^MP^MAURITIUS
"DATA",779.004,137,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,137,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,137,"VUID")
1006480^1
"DATA",779.004,138,0)
MEX^Mexico
"DATA",779.004,138,"SDS")
484^MX^MEXICO
"DATA",779.004,138,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,138,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,138,"VUID")
1006484^1
"DATA",779.004,139,0)
MCO^Monaco
"DATA",779.004,139,"SDS")
492^MN^FRANCE
"DATA",779.004,139,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,139,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,139,"VUID")
1006492^1
"DATA",779.004,140,0)
MNG^Mongolia
"DATA",779.004,140,"SDS")
496^MG^MONGOLIA
"DATA",779.004,140,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,140,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,140,"VUID")
1006496^1
"DATA",779.004,141,0)
MDA^Moldova
"DATA",779.004,141,"SDS")
498^MD^MOLDOVA
"DATA",779.004,141,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,141,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,141,"VUID")
1006498^1
"DATA",779.004,142,0)
MSR^Montserrat
"DATA",779.004,142,"SDS")
500^MH^MONTSERRAT
"DATA",779.004,142,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,142,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,142,"VUID")
1006500^1
"DATA",779.004,143,0)
MAR^Morocco
"DATA",779.004,143,"SDS")
504^MO^MOROCCO
"DATA",779.004,143,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,143,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,143,"VUID")
1006504^1
"DATA",779.004,144,0)
MOZ^Mozambique
"DATA",779.004,144,"SDS")
508^MZ^MOZAMBIQUE
"DATA",779.004,144,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,144,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,144,"VUID")
1006508^1
"DATA",779.004,145,0)
OMN^Oman
"DATA",779.004,145,"SDS")
512^MU^OMAN
"DATA",779.004,145,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,145,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,145,"VUID")
1006512^1
"DATA",779.004,146,0)
NAM^Namibia
"DATA",779.004,146,"SDS")
516^WA^NAMIBIA
"DATA",779.004,146,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,146,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,146,"VUID")
1006516^1
"DATA",779.004,147,0)
NRU^Nauru
"DATA",779.004,147,"SDS")
520^NR^NAURU
"DATA",779.004,147,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,147,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,147,"VUID")
1006520^1
"DATA",779.004,148,0)
NPL^Nepal
"DATA",779.004,148,"SDS")
524^NP^NEPAL
"DATA",779.004,148,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,148,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,148,"VUID")
1006524^1
"DATA",779.004,149,0)
NLD^Netherlands
"DATA",779.004,149,"SDS")
528^NL^NETHERLANDS
"DATA",779.004,149,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,149,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,149,"VUID")
1006528^1
"DATA",779.004,150,0)
ANT^Netherlands Antilles
"DATA",779.004,150,"SDS")
530^NT^NETHERLANDS ANTILLES
"DATA",779.004,150,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,150,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,150,"VUID")
1006530^1
"DATA",779.004,151,0)
ABW^Aruba
"DATA",779.004,151,"SDS")
533^AA^ARUBA
"DATA",779.004,151,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,151,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,151,"VUID")
1006533^1
"DATA",779.004,152,0)
NCL^New Caledonia
"DATA",779.004,152,"SDS")
540^NC^NEW CALEDONIA
"DATA",779.004,152,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,152,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,152,"VUID")
1006540^1
"DATA",779.004,153,0)
VUT^Vanuatu
"DATA",779.004,153,"SDS")
548^NH^VANUATU
"DATA",779.004,153,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,153,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,153,"VUID")
1006548^1
"DATA",779.004,154,0)
NZL^New Zealand
"DATA",779.004,154,"SDS")
554^NZ^NEW ZEALAND
"DATA",779.004,154,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,154,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,154,"VUID")
1006554^1
"DATA",779.004,155,0)
NIC^Nicaragua
"DATA",779.004,155,"SDS")
558^NU^NICARAGUA
"DATA",779.004,155,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,155,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,155,"VUID")
1006558^1
"DATA",779.004,156,0)
NER^Niger
"DATA",779.004,156,"SDS")
562^NG^NIGER
"DATA",779.004,156,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,156,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,156,"VUID")
1006562^1
"DATA",779.004,157,0)
NGA^Nigeria
"DATA",779.004,157,"SDS")
566^NI^NIGERIA
"DATA",779.004,157,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,157,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,157,"VUID")
1006566^1
"DATA",779.004,158,0)
NIU^Niue
"DATA",779.004,158,"SDS")
570^NE^NEW ZEALAND
"DATA",779.004,158,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,158,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,158,"VUID")
1006570^1
"DATA",779.004,159,0)
NFK^Norfolk Island
"DATA",779.004,159,"SDS")
574^NF^AUSTRALIA
"DATA",779.004,159,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,159,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,159,"VUID")
1006574^1
"DATA",779.004,160,0)
NOR^Norway
"DATA",779.004,160,"SDS")
578^NO^NORWAY
"DATA",779.004,160,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,160,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,160,"VUID")
1006578^1
"DATA",779.004,161,0)
FSM^Micronesia
"DATA",779.004,161,"SDS")
583^FM^FEDERATED STATES OF MICRONESIA
"DATA",779.004,161,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,161,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,161,"VUID")
1006583^1
"DATA",779.004,162,0)
PAK^Pakistan
"DATA",779.004,162,"SDS")
586^PK^PAKISTAN
"DATA",779.004,162,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,162,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,162,"VUID")
1006586^1
"DATA",779.004,163,0)
PAN^Panama
"DATA",779.004,163,"SDS")
591^PM^PANAMA
"DATA",779.004,163,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,163,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,163,"VUID")
1006591^1
"DATA",779.004,164,0)
PNG^Papua New Guinea
"DATA",779.004,164,"SDS")
598^PP^PAPUA NEW GUINEA
"DATA",779.004,164,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,164,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,164,"VUID")
1006598^1
"DATA",779.004,165,0)
PRY^Paraguay
"DATA",779.004,165,"SDS")
600^PA^PARAGUAY
"DATA",779.004,165,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,165,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,165,"VUID")
1006600^1
"DATA",779.004,166,0)
PER^Peru
"DATA",779.004,166,"SDS")
604^PE^PERU
"DATA",779.004,166,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,166,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,166,"VUID")
1006604^1
"DATA",779.004,167,0)
PHL^Philippines
"DATA",779.004,167,"SDS")
608^RP^PHILIPPINES
"DATA",779.004,167,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,167,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,167,"VUID")
1006608^1
"DATA",779.004,168,0)
PCN^Pitcairn
"DATA",779.004,168,"SDS")
612^PC^PITCAIRN ISLAND
"DATA",779.004,168,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,168,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,168,"VUID")
1006612^1
"DATA",779.004,169,0)
POL^Poland
"DATA",779.004,169,"SDS")
616^PL^POLAND
"DATA",779.004,169,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,169,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,169,"VUID")
1006616^1
"DATA",779.004,170,0)
PRT^Portugal
"DATA",779.004,170,"SDS")
620^PO^PORTUGAL
"DATA",779.004,170,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,170,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,170,"VUID")
1006620^1
"DATA",779.004,171,0)
GNB^Guinea-Bissau
"DATA",779.004,171,"SDS")
624^PU^GUINEA-BISSAU
"DATA",779.004,171,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,171,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,171,"VUID")
1006624^1
"DATA",779.004,172,0)
TLS^Timor-Leste
"DATA",779.004,172,"SDS")
626^TT^INDONESIA
"DATA",779.004,172,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,172,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,172,"VUID")
1006626^1
"DATA",779.004,173,0)
QAT^Qatar
"DATA",779.004,173,"SDS")
634^QA^QATAR
"DATA",779.004,173,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,173,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,173,"VUID")
1006634^1
"DATA",779.004,174,0)
REU^Réunion
"DATA",779.004,174,"SDS")
638^RE^RÉUNION
"DATA",779.004,174,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,174,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,174,"VUID")
1006638^1
"DATA",779.004,175,0)
ROU^Romania
"DATA",779.004,175,"SDS")
642^RO^ROMANIA
"DATA",779.004,175,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,175,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,175,"VUID")
1006642^1
"DATA",779.004,176,0)
RUS^Russian Federation
"DATA",779.004,176,"SDS")
643^RS^RUSSIA
"DATA",779.004,176,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,176,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,176,"VUID")
1006643^1
"DATA",779.004,177,0)
RWA^Rwanda
"DATA",779.004,177,"SDS")
646^RW^RWANDA
"DATA",779.004,177,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,177,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,177,"VUID")
1006646^1
"DATA",779.004,178,0)
SHN^Saint Helena
"DATA",779.004,178,"SDS")
654^SH^SAINT HELENA
"DATA",779.004,178,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,178,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,178,"VUID")
1006654^1
"DATA",779.004,179,0)
KNA^Saint Kitts and Nevis
"DATA",779.004,179,"SDS")
659^SC^SAINT CHRISTOPHER (ST. KITTS) AND NEVIS
"DATA",779.004,179,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,179,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,179,"VUID")
1006659^1
"DATA",779.004,180,0)
AIA^Anguilla
"DATA",779.004,180,"SDS")
660^AV^ANGUILLA
"DATA",779.004,180,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,180,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,180,"VUID")
1006660^1
"DATA",779.004,181,0)
LCA^Saint Lucia
"DATA",779.004,181,"SDS")
662^ST^SAINT LUCIA
"DATA",779.004,181,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,181,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,181,"VUID")
1006662^1
"DATA",779.004,182,0)
SPM^Saint Pierre and Miquelon
"DATA",779.004,182,"SDS")
666^SB^SAINT PIERRE AND MIQUELON
"DATA",779.004,182,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,182,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,182,"VUID")
1006666^1
"DATA",779.004,183,0)
VCT^Saint Vincent and the Grenadines
"DATA",779.004,183,"SDS")
670^VC^SAINT VINCENT AND THE GRENADINES
"DATA",779.004,183,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,183,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,183,"VUID")
1006670^1
"DATA",779.004,184,0)
SMR^San Marino
"DATA",779.004,184,"SDS")
674^SM^SAN MARINO
"DATA",779.004,184,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,184,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,184,"VUID")
1006674^1
"DATA",779.004,185,0)
STP^Sao Tome and Principe
"DATA",779.004,185,"SDS")
678^TP^SAO TOME AND PRINCIPE
"DATA",779.004,185,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,185,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,185,"VUID")
1006678^1
"DATA",779.004,186,0)
SAU^Saudi Arabia
"DATA",779.004,186,"SDS")
682^SA^SAUDI ARABIA
"DATA",779.004,186,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,186,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,186,"VUID")
1006682^1
"DATA",779.004,187,0)
SEN^Senegal
"DATA",779.004,187,"SDS")
686^SG^SENEGAL
"DATA",779.004,187,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,187,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,187,"VUID")
1006686^1
"DATA",779.004,188,0)
SYC^Seychelles
"DATA",779.004,188,"SDS")
690^SE^SEYCHELLES
"DATA",779.004,188,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,188,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,188,"VUID")
1006690^1
"DATA",779.004,189,0)
SLE^Sierra Leone
"DATA",779.004,189,"SDS")
694^SL^SIERRA LEONE
"DATA",779.004,189,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,189,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,189,"VUID")
1006694^1
"DATA",779.004,190,0)
SGP^Singapore
"DATA",779.004,190,"SDS")
702^SN^SINGAPORE
"DATA",779.004,190,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,190,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,190,"VUID")
1006702^1
"DATA",779.004,191,0)
SVK^Slovakia
"DATA",779.004,191,"SDS")
703^LO^SLOVAK REPUBLIC
"DATA",779.004,191,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,191,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,191,"VUID")
1006703^1
"DATA",779.004,192,0)
VNM^Viet Nam
"DATA",779.004,192,"SDS")
704^VM^VIETNAM
"DATA",779.004,192,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,192,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,192,"VUID")
1006704^1
"DATA",779.004,193,0)
SVN^Slovenia
"DATA",779.004,193,"SDS")
705^SI^SLOVENIA
"DATA",779.004,193,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,193,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,193,"VUID")
1006705^1
"DATA",779.004,194,0)
SOM^Somalia
"DATA",779.004,194,"SDS")
706^SO^<NULL>
"DATA",779.004,194,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,194,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,194,"VUID")
1006706^1
"DATA",779.004,195,0)
ZAF^South Africa
"DATA",779.004,195,"SDS")
710^SF^SOUTH AFRICA
"DATA",779.004,195,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,195,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,195,"VUID")
1006710^1
"DATA",779.004,196,0)
ZWE^Zimbabwe
"DATA",779.004,196,"SDS")
716^ZI^ZIMBABWE
"DATA",779.004,196,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,196,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,196,"VUID")
1006716^1
"DATA",779.004,197,0)
ESP^Spain
"DATA",779.004,197,"SDS")
724^SP^SPAIN
"DATA",779.004,197,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,197,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,197,"VUID")
1006724^1
"DATA",779.004,198,0)
ESH^Western Sahara
"DATA",779.004,198,"SDS")
732^WI^<NULL>
"DATA",779.004,198,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,198,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,198,"VUID")
1006732^1
"DATA",779.004,199,0)
SDN^Sudan
"DATA",779.004,199,"SDS")
736^SU^SUDAN
"DATA",779.004,199,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,199,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,199,"VUID")
1006736^1
"DATA",779.004,200,0)
SUR^Suriname
"DATA",779.004,200,"SDS")
740^NS^SURINAME
"DATA",779.004,200,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,200,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,200,"VUID")
1006740^1
"DATA",779.004,201,0)
SWZ^Swaziland
"DATA",779.004,201,"SDS")
748^WZ^SWAZILAND
"DATA",779.004,201,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,201,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,201,"VUID")
1006748^1
"DATA",779.004,202,0)
SWE^Sweden
"DATA",779.004,202,"SDS")
752^SW^SWEDEN
"DATA",779.004,202,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,202,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,202,"VUID")
1006752^1
"DATA",779.004,203,0)
CHE^Switzerland
"DATA",779.004,203,"SDS")
756^SZ^SWITZERLAND
"DATA",779.004,203,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,203,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,203,"VUID")
1006756^1
"DATA",779.004,204,0)
SYR^Syrian Arab Republic
"DATA",779.004,204,"SDS")
760^SY^SYRIAN ARAB REPUBLIC
"DATA",779.004,204,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,204,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,204,"VUID")
1006760^1
"DATA",779.004,205,0)
TJK^Tajikistan
"DATA",779.004,205,"SDS")
762^TI^TAJIKISTAN
"DATA",779.004,205,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,205,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,205,"VUID")
1006762^1
"DATA",779.004,206,0)
THA^Thailand
"DATA",779.004,206,"SDS")
764^TH^THAILAND
"DATA",779.004,206,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,206,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,206,"VUID")
1006764^1
"DATA",779.004,207,0)
TGO^Togo
"DATA",779.004,207,"SDS")
768^TO^TOGO
"DATA",779.004,207,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,207,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,207,"VUID")
1006768^1
"DATA",779.004,208,0)
TKL^Tokelau
"DATA",779.004,208,"SDS")
772^TL^WESTERN SAMOA
"DATA",779.004,208,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,208,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,208,"VUID")
1006772^1
"DATA",779.004,209,0)
TON^Tonga
"DATA",779.004,209,"SDS")
776^TN^TONGA
"DATA",779.004,209,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,209,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,209,"VUID")
1006776^1
"DATA",779.004,210,0)
TTO^Trinidad and Tobago
"DATA",779.004,210,"SDS")
780^TD^TRINIDAD AND TOBAGO
"DATA",779.004,210,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,210,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,210,"VUID")
1006780^1
"DATA",779.004,211,0)
ARE^United Arab Emirates
"DATA",779.004,211,"SDS")
784^AE^UNITED ARAB EMIRATES
"DATA",779.004,211,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,211,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,211,"VUID")
1006784^1
"DATA",779.004,212,0)
TUN^Tunisia
"DATA",779.004,212,"SDS")
788^TS^TUNISIA
"DATA",779.004,212,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,212,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,212,"VUID")
1006788^1
"DATA",779.004,213,0)
TUR^Turkey
"DATA",779.004,213,"SDS")
792^TU^TURKEY
"DATA",779.004,213,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,213,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,213,"VUID")
1006792^1
"DATA",779.004,214,0)
TKM^Turkmenistan
"DATA",779.004,214,"SDS")
795^TX^TURKMENISTAN
"DATA",779.004,214,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,214,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,214,"VUID")
1006795^1
"DATA",779.004,215,0)
TCA^Turks and Caicos Islands
"DATA",779.004,215,"SDS")
796^TK^TURKS AND CAICOS ISLANDS
"DATA",779.004,215,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,215,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,215,"VUID")
1006796^1
"DATA",779.004,216,0)
TUV^Tuvalu
"DATA",779.004,216,"SDS")
798^TV^TUVALU
"DATA",779.004,216,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,216,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,216,"VUID")
1006798^1
"DATA",779.004,217,0)
UGA^Uganda
"DATA",779.004,217,"SDS")
800^UG^UGANDA
"DATA",779.004,217,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,217,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,217,"VUID")
1006800^1
"DATA",779.004,218,0)
UKR^Ukraine
"DATA",779.004,218,"SDS")
804^UP^UKRAINE
"DATA",779.004,218,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,218,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,218,"VUID")
1006804^1
"DATA",779.004,219,0)
MKD^Macedonia
"DATA",779.004,219,"SDS")
807^MK^REPUBLIC OF MACEDONIA
"DATA",779.004,219,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,219,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,219,"VUID")
1006807^1
"DATA",779.004,220,0)
EGY^Egypt
"DATA",779.004,220,"SDS")
818^EG^EGYPT
"DATA",779.004,220,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,220,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,220,"VUID")
1006818^1
"DATA",779.004,221,0)
GBR^United Kingdom
"DATA",779.004,221,"SDS")
826^UK^UNITED KINGDOM
"DATA",779.004,221,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,221,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,221,"VUID")
1006826^1
"DATA",779.004,222,0)
TZA^Tanzania
"DATA",779.004,222,"SDS")
834^TZ^TANZANIA
"DATA",779.004,222,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,222,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,222,"VUID")
1006834^1
"DATA",779.004,223,0)
BFA^Burkina Faso
"DATA",779.004,223,"SDS")
854^UV^BURKINA FASO
"DATA",779.004,223,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,223,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,223,"VUID")
1006854^1
"DATA",779.004,224,0)
URY^Uruguay
"DATA",779.004,224,"SDS")
858^UY^URUGUAY
"DATA",779.004,224,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,224,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,224,"VUID")
1006858^1
"DATA",779.004,225,0)
UZB^Uzbekistan
"DATA",779.004,225,"SDS")
860^UZ^UZBEKISTAN
"DATA",779.004,225,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,225,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,225,"VUID")
1006860^1
"DATA",779.004,226,0)
VEN^Venezuela
"DATA",779.004,226,"SDS")
862^VE^VENEZUELA
"DATA",779.004,226,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,226,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,226,"VUID")
1006862^1
"DATA",779.004,227,0)
WLF^Wallis and Futuna Islands
"DATA",779.004,227,"SDS")
876^WF^WALLIS AND FUTUNA ISLANDS
"DATA",779.004,227,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,227,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,227,"VUID")
1006876^1
"DATA",779.004,228,0)
YEM^Yemen
"DATA",779.004,228,"SDS")
887^YM^YEMEN
"DATA",779.004,228,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,228,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,228,"VUID")
1006887^1
"DATA",779.004,229,0)
SCG^Serbia and Montenegro
"DATA",779.004,229,"SDS")
891^YI^SERBIA-MONTENEGRO
"DATA",779.004,229,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,229,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,229,"VUID")
1006891^1
"DATA",779.004,230,0)
ZMB^Zambia
"DATA",779.004,230,"SDS")
894^ZA^ZAMBIA
"DATA",779.004,230,"TERMSTATUS",0)
^779.00409DA^1^1
"DATA",779.004,230,"TERMSTATUS",1,0)
3060119.165007^1
"DATA",779.004,230,"VUID")
1006894^1
"FIA",779.004)
COUNTRY CODE
"FIA",779.004,0)
^HL(779.004,
"FIA",779.004,0,0)
779.004I
"FIA",779.004,0,1)
y^n^f^^y^^y^r^n
"FIA",779.004,0,10)

"FIA",779.004,0,11)

"FIA",779.004,0,"RLRO")

"FIA",779.004,0,"VR")
1.6^HL
"FIA",779.004,779.004)
0
"FIA",779.004,779.00401)
0
"FIA",779.004,779.00409)
0
"INI")
PRE^HLPAT120
"INIT")
POST^HLPAT120
"IX",779.004,779.004,"AMASTERVUID",0)
779.004^AMASTERVUID^This cross-reference identifies the Master entry for a VUID.^R^^R^IR^I^779.004^^^^^S
"IX",779.004,779.004,"AMASTERVUID",.1,0)
^^3^3^3060111
"IX",779.004,779.004,"AMASTERVUID",.1,1,0)
If multiple entries have the same VUID in the file, this cross-refernce 
"IX",779.004,779.004,"AMASTERVUID",.1,2,0)
can be used to identify the Master entry for a VUID associated with a 
"IX",779.004,779.004,"AMASTERVUID",.1,3,0)
Term/Concept.
"IX",779.004,779.004,"AMASTERVUID",1)
S ^HL(779.004,"AMASTERVUID",$E(X(1),1,30),X(2),DA)=""
"IX",779.004,779.004,"AMASTERVUID",2)
K ^HL(779.004,"AMASTERVUID",$E(X(1),1,30),X(2),DA)
"IX",779.004,779.004,"AMASTERVUID",2.5)
K ^HL(779.004,"AMASTERVUID")
"IX",779.004,779.004,"AMASTERVUID",11.1,0)
^.114IA^2^2
"IX",779.004,779.004,"AMASTERVUID",11.1,1,0)
1^F^779.004^99.99^30^1^F
"IX",779.004,779.004,"AMASTERVUID",11.1,2,0)
2^F^779.004^99.98^^2^F
"MBREQ")
0
"PKG",9,-1)
1^1
"PKG",9,0)
HEALTH LEVEL SEVEN^HL^DHCP IMPLEMENTATION OF HEALTH LEVEL SEVEN^
"PKG",9,20,0)
^9.402P^^
"PKG",9,22,0)
^9.49I^1^1
"PKG",9,22,1,0)
1.6^2980130^2980130^6
"PKG",9,22,1,"PAH",1,0)
120^3060307
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","HLCSAS")
0^4^B12656721^B11637057
"RTN","HLCSAS",1,0)
HLCSAS ;ISCSF/RWF - MPI direct connect server ;09/23/2005  14:36
"RTN","HLCSAS",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**43,89,120**;Oct 13,1995;Build 12
"RTN","HLCSAS",3,0)
 Q
"RTN","HLCSAS",4,0)
 ;HLCS is used to pass data around.
"RTN","HLCSAS",5,0)
 ; 5500 is the standard VA port for the MPI_direct connect
"RTN","HLCSAS",6,0)
LISTEN ;only for OpenM
"RTN","HLCSAS",7,0)
 S $ETRAP="D ^%ZTER H"
"RTN","HLCSAS",8,0)
 D LISTEN^%ZISTCPS(5500,"ONT^HLCSAS")
"RTN","HLCSAS",9,0)
 Q
"RTN","HLCSAS",10,0)
DSM ;%=device^HLDP
"RTN","HLCSAS",11,0)
 S IO=$P(%,"^"),HLDP=$P(%,"^",2)
"RTN","HLCSAS",12,0)
 O IO:(SHARE) U IO ;Setup TCP port
"RTN","HLCSAS",13,0)
 S IO(0)="_NLA0:" O IO(0) ;Setup null device
"RTN","HLCSAS",14,0)
 D SVR
"RTN","HLCSAS",15,0)
 Q
"RTN","HLCSAS",16,0)
CACHE ;%=device^HLDP
"RTN","HLCSAS",17,0)
 S (IO,IO(0))="SYS$NET"
"RTN","HLCSAS",18,0)
 S HLDP=$ZF("GETSYM","HLDP")
"RTN","HLCSAS",19,0)
 O IO U IO:(::"-M")  ;Setup TCP port
"RTN","HLCSAS",20,0)
 S IO(0)="_NLA0:" O IO(0) ;Setup null device
"RTN","HLCSAS",21,0)
 D SVR
"RTN","HLCSAS",22,0)
 Q
"RTN","HLCSAS",23,0)
MSM ;Entry point from MSERVER
"RTN","HLCSAS",24,0)
 ;S HLDP=ien
"RTN","HLCSAS",25,0)
 S IO=56,IO(0)=46
"RTN","HLCSAS",26,0)
 O 46 ;Null device
"RTN","HLCSAS",27,0)
 D SVR C IO
"RTN","HLCSAS",28,0)
 Q
"RTN","HLCSAS",29,0)
ONT ;Cache/OpenM
"RTN","HLCSAS",30,0)
 ;S HLDP=ien
"RTN","HLCSAS",31,0)
 S IO=$I,IO(0)="//./nul"
"RTN","HLCSAS",32,0)
 O IO(0)
"RTN","HLCSAS",33,0)
 D SVR
"RTN","HLCSAS",34,0)
 Q
"RTN","HLCSAS",35,0)
 ;
"RTN","HLCSAS",36,0)
SVR ;Entry point when we have a connect
"RTN","HLCSAS",37,0)
 ;See that IO=TCP device, and IO(0) is Null device and Open.
"RTN","HLCSAS",38,0)
 ;HLDP=ien of Logical Link
"RTN","HLCSAS",39,0)
 N HCSA1,HCSER,HCSEXIT,HCSCMD,HCSDAT
"RTN","HLCSAS",40,0)
 D SETUP Q:HCSER
"RTN","HLCSAS",41,0)
 N $ESTACK,$ETRAP S $ETRAP="D ^%ZTER H"
"RTN","HLCSAS",42,0)
 D UPDT^HLCSTCP(1)
"RTN","HLCSAS",43,0)
 F  D CREAD Q:HCSEXIT  D  Q:HCSEXIT
"RTN","HLCSAS",44,0)
 . I HCSCMD="" S HCSA1("TCNT")=$G(HCSA1("TCNT"))+1 S:$$STOP^HLCSTCP!(HCSA1("TCNT")>10) HCSEXIT=1 Q
"RTN","HLCSAS",45,0)
 . I HCSCMD'?4A D SEND("500 Bad CMD: "_$E(HCSCMD,1,20)) Q
"RTN","HLCSAS",46,0)
 . I $T(@HCSCMD)="" D SEND("500 ") Q
"RTN","HLCSAS",47,0)
 . S HCSA1("TCNT")=0
"RTN","HLCSAS",48,0)
 . D @HCSCMD I $G(HCSER) D TRACE("ERROR: "_HCSER)
"RTN","HLCSAS",49,0)
 . Q
"RTN","HLCSAS",50,0)
 S:HCSEXIT IO("C")=1
"RTN","HLCSAS",51,0)
 D TRACE("Exit"),UPDT^HLCSTCP(0)
"RTN","HLCSAS",52,0)
 Q
"RTN","HLCSAS",53,0)
HELO ;Process HELO
"RTN","HLCSAS",54,0)
 S HCSA1("SITE")=$P(HCSDAT," ")
"RTN","HLCSAS",55,0)
 ;Do any check on who is sending
"RTN","HLCSAS",56,0)
 D SEND("220 "_$$KSP^XUPARAM("WHERE")_" Ready for "_HCSDAT)
"RTN","HLCSAS",57,0)
 Q
"RTN","HLCSAS",58,0)
 ;
"RTN","HLCSAS",59,0)
NOOP ;
"RTN","HLCSAS",60,0)
 D SEND("250 OK")
"RTN","HLCSAS",61,0)
 Q
"RTN","HLCSAS",62,0)
 ;
"RTN","HLCSAS",63,0)
DATA ;Process DATA
"RTN","HLCSAS",64,0)
 ; The DATA cmd can pass some parameters as well, this could be passed
"RTN","HLCSAS",65,0)
 ; to the processing routine also.
"RTN","HLCSAS",66,0)
 N P,I,DUZ,HLMID,HLTIEN,HLDT
"RTN","HLCSAS",67,0)
 ;S DUZ=0,DUZ(0)="@"
"RTN","HLCSAS",68,0)
 D TRACE("Get Data")
"RTN","HLCSAS",69,0)
 S HCSA1("DATA")=HCSDAT,HCSIN=$NA(TMP("HCSI",$J)),HCSOUT=$NA(^TMP("HCSO",$J))
"RTN","HLCSAS",70,0)
 K @HCSOUT
"RTN","HLCSAS",71,0)
 D DATA^HLCSAS1(HCSIN,.HCSA1) QUIT:$G(HCSER)
"RTN","HLCSAS",72,0)
 S P="" F I=1:1 Q:'$D(HCSA1("P"_I))  S P=P_"P"_I_"="_HCSA1("P"_I)_", "
"RTN","HLCSAS",73,0)
 D TRACE("PARAM "_P)
"RTN","HLCSAS",74,0)
 ;Use the Null Device
"RTN","HLCSAS",75,0)
 U IO(0)
"RTN","HLCSAS",76,0)
 ;Now call soneone to process the data
"RTN","HLCSAS",77,0)
 I HCSA1("P1")="MPI" D ^MPIDIRQ(HCSIN,HCSOUT)
"RTN","HLCSAS",78,0)
 I HCSA1("P1")="PING" M @HCSOUT=@HCSIN
"RTN","HLCSAS",79,0)
 U IO ;Back to the TCP device
"RTN","HLCSAS",80,0)
 D LLCNT^HLCSTCP(HLDP,2)
"RTN","HLCSAS",81,0)
 Q
"RTN","HLCSAS",82,0)
TURN ;Turn and send responce
"RTN","HLCSAS",83,0)
 D SEND("220 OK")
"RTN","HLCSAS",84,0)
 D SDATA^HLCSAS1(HCSOUT,HCSA1("P1"))
"RTN","HLCSAS",85,0)
 D CREAD,TRACE("Data Sent ") ;Look for 220 ok
"RTN","HLCSAS",86,0)
 Q
"RTN","HLCSAS",87,0)
QUIT ;Process QUIT
"RTN","HLCSAS",88,0)
 D TRACE("QUIT")
"RTN","HLCSAS",89,0)
 S HCSMSG="",HCSEXIT=1
"RTN","HLCSAS",90,0)
 Q
"RTN","HLCSAS",91,0)
 ;
"RTN","HLCSAS",92,0)
CREAD ;Read a string
"RTN","HLCSAS",93,0)
 N $ETRAP S $ETRAP="S $EC="""" G CREX"
"RTN","HLCSAS",94,0)
 N I S (Y,HCSDAT,HCSCMD)="",HCSER=0
"RTN","HLCSAS",95,0)
 F I=0:1:255 R X#1:HLDREAD S:'$T HCSER=1 Q:X=$C(10)!HCSER  S Y=Y_X
"RTN","HLCSAS",96,0)
 S Y=$TR(Y,$C(13,10)),HCSCMD=$P(Y," "),HCSDAT=$P(Y," ",2,99)
"RTN","HLCSAS",97,0)
 D TRACE("Cmd Read "_Y)
"RTN","HLCSAS",98,0)
 Q
"RTN","HLCSAS",99,0)
CREX S HCSEXIT=1,HCSER="1 Error"
"RTN","HLCSAS",100,0)
 Q
"RTN","HLCSAS",101,0)
 ;
"RTN","HLCSAS",102,0)
SEND(MSG) ;Send a cmd MSG
"RTN","HLCSAS",103,0)
 N $ETRAP S $ETRAP="S $EC="""" D CREX"
"RTN","HLCSAS",104,0)
 D TRACE("Cmd Send "_MSG)
"RTN","HLCSAS",105,0)
 W MSG,$C(13,10),!
"RTN","HLCSAS",106,0)
 Q
"RTN","HLCSAS",107,0)
 ;
"RTN","HLCSAS",108,0)
SETUP ;Setup needed variables
"RTN","HLCSAS",109,0)
 K IO("C")
"RTN","HLCSAS",110,0)
 S X=$$INIT^HLCSTCP
"RTN","HLCSAS",111,0)
 I 'X D ^%ZTER S HCSER=1 Q
"RTN","HLCSAS",112,0)
 S (HCSER,HCSEXIT)=0,HCSTRACE="S: ",HCSA1("P1")="TEXT"
"RTN","HLCSAS",113,0)
 D TRACE(-1),TRACE("Server Setup")
"RTN","HLCSAS",114,0)
 Q
"RTN","HLCSAS",115,0)
 ;
"RTN","HLCSAS",116,0)
TRACE(S1) ;
"RTN","HLCSAS",117,0)
 Q
"RTN","HLCSAS",118,0)
 N H,%
"RTN","HLCSAS",119,0)
 I S1=-1 K ^TMP("HCSA",$J) Q
"RTN","HLCSAS",120,0)
 S H=$P($H,",",2),H=(H\3600)_":"_(H#3600\60)_":"_(H#60)_" "
"RTN","HLCSAS",121,0)
 L +^TMP("HCSA",$J) S %=$G(^TMP("HCSA",$J,0))+1,^(0)=%,^(%)=H_$G(HCSTRACE)_S1 L -^TMP("HCSA",$J)
"RTN","HLCSAS",122,0)
 Q
"RTN","HLCSAS",123,0)
 ;
"RTN","HLCSHDR1")
0^2^B53997699^B24058167
"RTN","HLCSHDR1",1,0)
HLCSHDR1 ;SFIRMFO/RSD - Make HL7 header for TCP ;03/07/2006  09:23
"RTN","HLCSHDR1",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,57,59,72,80,93,120**;Oct 13, 1995;Build 12
"RTN","HLCSHDR1",3,0)
HEADER(IEN,CLIENT,HLERROR) ; Create an HL7 MSH segment
"RTN","HLCSHDR1",4,0)
 ;
"RTN","HLCSHDR1",5,0)
 ;Input  : IEN - Pointer to entry in Message Administration file (#773)
"RTN","HLCSHDR1",6,0)
 ;               that HL7 MSH segment is being built for
"RTN","HLCSHDR1",7,0)
 ;         CLIENT - IEN of the receiving application
"RTN","HLCSHDR1",8,0)
 ;         HLERROR - Variable to return possible error text in
"RTN","HLCSHDR1",9,0)
 ;                   (pass by reference - only used when needed)
"RTN","HLCSHDR1",10,0)
 ;
"RTN","HLCSHDR1",11,0)
 ;Output : HLHDR(1) - HL7 MSH segment
"RTN","HLCSHDR1",12,0)
 ;         HLHDR(2) - Continuation of HL7 MSH segment (if needed)
"RTN","HLCSHDR1",13,0)
 ;         HLHDR(3) - Continuation of HL7 MSH segment (if needed)
"RTN","HLCSHDR1",14,0)
 ;
"RTN","HLCSHDR1",15,0)
 ;Notes  : HLERROR will only be defined [on output] if an error occurs
"RTN","HLCSHDR1",16,0)
 ;       : HLHDR() will not be defined [on output] if an error occurs
"RTN","HLCSHDR1",17,0)
 ;       : HLHDR(2) & HLHDR(3) are continuation [or roll-over] nodes
"RTN","HLCSHDR1",18,0)
 ;         and will only be used/defined when needed
"RTN","HLCSHDR1",19,0)
 ;
"RTN","HLCSHDR1",20,0)
 N ACKTO,ACCACK,APPACK,CHILD,CLNTAPP,CLNTFAC,CNTRY,EC,EVNTYPE,FS,HLDATE,HLHDRI,HLHDRL,HLID,HLPID,MSGTYPE,PROT,PROTS,SECURITY,SEND,SERAPP,SERFAC,TXTP,TXTP0,X,MSGEVN
"RTN","HLCSHDR1",21,0)
 N COMFLAG ; patch HL*1.6*120
"RTN","HLCSHDR1",22,0)
 S HLPARAM=$$PARAM^HLCS2
"RTN","HLCSHDR1",23,0)
 D VAR Q:$G(HLERROR)]""
"RTN","HLCSHDR1",24,0)
 ; The following line commented by HL*1.6*72
"RTN","HLCSHDR1",25,0)
 ;I $D(^HLMA(IEN)) S $P(^HLMA(IEN,0),U,13)=MSGTYPE,$P(^HLMA(IEN,0),U,14)=$G(EVNTYPE)
"RTN","HLCSHDR1",26,0)
 ;Append event type
"RTN","HLCSHDR1",27,0)
 I $G(EVNTYPE)]"" S MSGTYPE=MSGTYPE_$E(EC,1)_EVNTYPE
"RTN","HLCSHDR1",28,0)
 ;Append message structure component
"RTN","HLCSHDR1",29,0)
 I $G(EVNTYPE)]"",$G(MSGEVN)]"" S MSGTYPE=MSGTYPE_$E(EC,1)_MSGEVN
"RTN","HLCSHDR1",30,0)
 ;Build MSH array
"RTN","HLCSHDR1",31,0)
 D RESET^HLCSHDR3 ;HL*1.6*93
"RTN","HLCSHDR1",32,0)
 ;
"RTN","HLCSHDR1",33,0)
 ; patch HL*1.6*120 start
"RTN","HLCSHDR1",34,0)
 ; escape delimiters for SERAPP and CLNTAPP
"RTN","HLCSHDR1",35,0)
 ; escape component separator if the field is not consisted
"RTN","HLCSHDR1",36,0)
 ; of 3 components
"RTN","HLCSHDR1",37,0)
 S EC(1)=$E(EC,1)
"RTN","HLCSHDR1",38,0)
 S EC(2)=$E(EC,2)
"RTN","HLCSHDR1",39,0)
 S EC(3)=$E(EC,3)
"RTN","HLCSHDR1",40,0)
 S EC(4)=$E(EC,4)
"RTN","HLCSHDR1",41,0)
 S COMFLAG=1
"RTN","HLCSHDR1",42,0)
 I $L(SERAPP,$E(EC,1))=3 S COMFLAG=0
"RTN","HLCSHDR1",43,0)
 I (SERAPP[FS)!(SERAPP[EC(1))!(SERAPP[EC(2))!(SERAPP[EC(3))!(SERAPP[EC(4)) D
"RTN","HLCSHDR1",44,0)
 . S SERAPP=$$ESCAPE(SERAPP,COMFLAG)
"RTN","HLCSHDR1",45,0)
 S COMFLAG=1
"RTN","HLCSHDR1",46,0)
 I $L(CLNTAPP,$E(EC,1))=3 S COMFLAG=0
"RTN","HLCSHDR1",47,0)
 I (CLNTAPP[FS)!(CLNTAPP[EC(1))!(CLNTAPP[EC(2))!(CLNTAPP[EC(3))!(CLNTAPP[EC(4)) D
"RTN","HLCSHDR1",48,0)
 . S CLNTAPP=$$ESCAPE(CLNTAPP,COMFLAG)
"RTN","HLCSHDR1",49,0)
 ; patch HL*1.6*120 end
"RTN","HLCSHDR1",50,0)
 ;
"RTN","HLCSHDR1",51,0)
 S HLHDRI=1,HLHDR(1)="MSH"_FS_EC_FS_SERAPP,HLHDRL=$L(HLHDR(1))
"RTN","HLCSHDR1",52,0)
 F X=SERFAC,CLNTAPP,CLNTFAC,HLDATE,SECURITY,MSGTYPE,HLID,HLPID,$P(PROT,U,9),"",$G(^HL(772,TXTP,1)),ACCACK,APPACK,CNTRY D MSH(X)
"RTN","HLCSHDR1",53,0)
 ;in preceeding line, "" is for sequence number - not supported
"RTN","HLCSHDR1",54,0)
 Q
"RTN","HLCSHDR1",55,0)
 ;
"RTN","HLCSHDR1",56,0)
MSH(X) ;add X to HLHDR
"RTN","HLCSHDR1",57,0)
 S:HLHDRL+$L(X)>245 HLHDRI=HLHDRI+1,HLHDR(HLHDRI)=""
"RTN","HLCSHDR1",58,0)
 S HLHDR(HLHDRI)=HLHDR(HLHDRI)_FS_X,HLHDRL=$L(HLHDR(HLHDRI))
"RTN","HLCSHDR1",59,0)
 Q
"RTN","HLCSHDR1",60,0)
BHSHDR(IEN,CLIENT,HLERROR) ; Create Batch Header Segment
"RTN","HLCSHDR1",61,0)
 ; The BHS has 12 segments, of which 4 are blank.
"RTN","HLCSHDR1",62,0)
 ; INPUT: IEN - IEN of entry in file #772
"RTN","HLCSHDR1",63,0)
 ; OUTPUT: HLHDR(1) and HLHDR(2) - the two lines with the 12 segs.
"RTN","HLCSHDR1",64,0)
 ;   ready for adding to a message directly.
"RTN","HLCSHDR1",65,0)
 N ACKTO,ACCACK,ACKMID,APPACK,BNAME,BSTATUS,BTACK,CHILD,CLNTAPP ;HL*1.6*80
"RTN","HLCSHDR1",66,0)
 N CLNTFAC,CNTRY,EC,EVNTYPE,FS,HLDATE,HLHDRI,HLHDRL,HLID,HLPID ;HL*1.6*80 - added HLPID
"RTN","HLCSHDR1",67,0)
 N PROT,PROTS,SECURITY,SEND,SERAPP,SERFAC,TXTP,TXTP0,X ;HL*1.6*80
"RTN","HLCSHDR1",68,0)
 N COMFLAG ; patch HL*1.6*120
"RTN","HLCSHDR1",69,0)
 ;
"RTN","HLCSHDR1",70,0)
 S HLPARAM=$$PARAM^HLCS2
"RTN","HLCSHDR1",71,0)
 D VAR Q:$G(HLERROR)]""
"RTN","HLCSHDR1",72,0)
 ; The following line commented by HL*1.6*72
"RTN","HLCSHDR1",73,0)
 ;I $D(^HLMA(IEN)) S $P(^HLMA(IEN,0),U,13)=MSGTYPE,$P(^HLMA(IEN,0),U,14)=$G(EVNTYPE)
"RTN","HLCSHDR1",74,0)
 ;
"RTN","HLCSHDR1",75,0)
 ;Append event type
"RTN","HLCSHDR1",76,0)
 I $G(EVNTYPE)]"" S MSGTYPE=MSGTYPE_$E(EC,2)_EVNTYPE,(ACKMID,BTACK)=""
"RTN","HLCSHDR1",77,0)
 ;batch/name/id/type(#9)=null~process ID~msg type|evnt type~version~CA~AA
"RTN","HLCSHDR1",78,0)
 S BNAME=$E(EC,1)_HLPID_$E(EC,1)_MSGTYPE_$E(EC,1)_$P(PROT,U,9)_$E(EC,1)_ACCACK_$E(EC,1)_APPACK ;HL*1.6*80
"RTN","HLCSHDR1",79,0)
 ;for batch ACK
"RTN","HLCSHDR1",80,0)
 I ACKTO D  S BTACK=X_$E(EC,1)_$P(BSTATUS,U,3)
"RTN","HLCSHDR1",81,0)
 . ;get msg id and status of message that is being ACKed
"RTN","HLCSHDR1",82,0)
 . S ACKMID=$P($G(^HLMA(ACKTO,0)),U,2),BSTATUS=$G(^HLMA(ACKTO,"P")) ;HL*1.6*80
"RTN","HLCSHDR1",83,0)
 . ;set type of ACK based on status
"RTN","HLCSHDR1",84,0)
 . S X=$S(ACKMID="":"AR",(BSTATUS>3)&(BSTATUS<8):"AE",1:"AA")
"RTN","HLCSHDR1",85,0)
 ;
"RTN","HLCSHDR1",86,0)
 D RESET^HLCSHDR3 ;HL*1.6*93
"RTN","HLCSHDR1",87,0)
 ;
"RTN","HLCSHDR1",88,0)
 ; patch HL*1.6*120 start
"RTN","HLCSHDR1",89,0)
 ; escape delimiters for SERAPP and CLNTAPP
"RTN","HLCSHDR1",90,0)
 ; escape component separator if the field is not consisted
"RTN","HLCSHDR1",91,0)
 ; of 3 components
"RTN","HLCSHDR1",92,0)
 S EC(1)=$E(EC,1)
"RTN","HLCSHDR1",93,0)
 S EC(2)=$E(EC,2)
"RTN","HLCSHDR1",94,0)
 S EC(3)=$E(EC,3)
"RTN","HLCSHDR1",95,0)
 S EC(4)=$E(EC,4)
"RTN","HLCSHDR1",96,0)
 S COMFLAG=1
"RTN","HLCSHDR1",97,0)
 I $L(SERAPP,$E(EC,1))=3 S COMFLAG=0
"RTN","HLCSHDR1",98,0)
 I (SERAPP[FS)!(SERAPP[EC(1))!(SERAPP[EC(2))!(SERAPP[EC(3))!(SERAPP[EC(4)) D
"RTN","HLCSHDR1",99,0)
 . S SERAPP=$$ESCAPE(SERAPP,COMFLAG)
"RTN","HLCSHDR1",100,0)
 S COMFLAG=1
"RTN","HLCSHDR1",101,0)
 I $L(CLNTAPP,$E(EC,1))=3 S COMFLAG=0
"RTN","HLCSHDR1",102,0)
 I (CLNTAPP[FS)!(CLNTAPP[EC(1))!(CLNTAPP[EC(2))!(CLNTAPP[EC(3))!(CLNTAPP[EC(4)) D
"RTN","HLCSHDR1",103,0)
 . S CLNTAPP=$$ESCAPE(CLNTAPP,COMFLAG)
"RTN","HLCSHDR1",104,0)
 ; patch HL*1.6*120 end
"RTN","HLCSHDR1",105,0)
 ;
"RTN","HLCSHDR1",106,0)
 S HLHDRI=1,HLHDR(1)="BHS"_FS_EC_FS_SERAPP,HLHDRL=$L(HLHDR(1))
"RTN","HLCSHDR1",107,0)
 F X=SERFAC,CLNTAPP,CLNTFAC,HLDATE,SECURITY,BNAME,BTACK,HLID,ACKMID D MSH(X)
"RTN","HLCSHDR1",108,0)
 Q
"RTN","HLCSHDR1",109,0)
VAR ;Check input
"RTN","HLCSHDR1",110,0)
 N APPPRM,HLPROTS,HLPROT
"RTN","HLCSHDR1",111,0)
 S IEN=+$G(IEN)
"RTN","HLCSHDR1",112,0)
 I '$G(^HLMA(IEN,0)) S HLERROR="Valid pointer to Message Administration file (#772) not passed" Q
"RTN","HLCSHDR1",113,0)
 I '$G(CLIENT) S HLERROR="Could not determine receiving application" Q
"RTN","HLCSHDR1",114,0)
 ;Get child, text pointer,text entry, and sending app.
"RTN","HLCSHDR1",115,0)
 S CHILD=$G(^HLMA(IEN,0)),SEND=+$P($G(^(0)),U,11),TXTP=+CHILD,TXTP0=$G(^HL(772,TXTP,0))
"RTN","HLCSHDR1",116,0)
 I ('SEND) S HLERROR="Could not determine sending application" Q
"RTN","HLCSHDR1",117,0)
 ;Get info for sending & receiving applications
"RTN","HLCSHDR1",118,0)
 D APPPRM^HLUTIL2(CLIENT),APPPRM^HLUTIL2(SEND)
"RTN","HLCSHDR1",119,0)
 ;Get name of sending application, facility, and country
"RTN","HLCSHDR1",120,0)
 S SERAPP=$P(APPPRM(SEND,0),U),SERFAC=$P(APPPRM(SEND,0),U,2),CNTRY=$P(APPPRM(SEND,0),U,3)
"RTN","HLCSHDR1",121,0)
 ;Get name of receiving application and facility
"RTN","HLCSHDR1",122,0)
 S CLNTAPP=$P(APPPRM(CLIENT,0),U),CLNTFAC=$P(APPPRM(CLIENT,0),U,2)
"RTN","HLCSHDR1",123,0)
 ;
"RTN","HLCSHDR1",124,0)
 ; patch HL*1.6*120
"RTN","HLCSHDR1",125,0)
 ; for dynamic addressing, overide the receiving facility from the
"RTN","HLCSHDR1",126,0)
 ; 3rd component of HLL("LINKS") array
"RTN","HLCSHDR1",127,0)
 I $G(HLP("REC-FACILITY"))]"" S CLNTFAC=HLP("REC-FACILITY")
"RTN","HLCSHDR1",128,0)
 ;
"RTN","HLCSHDR1",129,0)
 ;Get field separator & encoding characters
"RTN","HLCSHDR1",130,0)
 S FS=APPPRM(SEND,"FS"),EC=APPPRM(SEND,"EC")
"RTN","HLCSHDR1",131,0)
 S:(EC="") EC="~|\&" S:(FS="") FS="^"
"RTN","HLCSHDR1",132,0)
 ;Determine if it's a response/ACK to another message
"RTN","HLCSHDR1",133,0)
 S ACKTO=+$P(CHILD,U,10)
"RTN","HLCSHDR1",134,0)
 ;subscriber protocol is from child (file 773)
"RTN","HLCSHDR1",135,0)
 ;If response, get MType from subscriber
"RTN","HLCSHDR1",136,0)
 S HLPROTS=+$P(CHILD,U,8)
"RTN","HLCSHDR1",137,0)
 S PROTS=$$TYPE^HLUTIL2(HLPROTS)
"RTN","HLCSHDR1",138,0)
 I ACKTO S MSGTYPE=$P(PROTS,U,10),EVNTYPE=$P(PROTS,U,3),MSGEVN=$P(PROTS,U,4)
"RTN","HLCSHDR1",139,0)
 ;Get accept ack & application ack type (based on server protocol) it
"RTN","HLCSHDR1",140,0)
 ; is always in file 772, TXPT0
"RTN","HLCSHDR1",141,0)
 ;If original message, get MT from Event Driver Protocol
"RTN","HLCSHDR1",142,0)
 S HLPROT=+$P(TXTP0,U,10)
"RTN","HLCSHDR1",143,0)
 S PROT=$$TYPE^HLUTIL2(HLPROT)
"RTN","HLCSHDR1",144,0)
 S:'ACKTO MSGTYPE=$P(PROT,U,2),EVNTYPE=$P(PROT,U,3),MSGEVN=$P(PROT,U,4)
"RTN","HLCSHDR1",145,0)
 S ACCACK=$P(PROT,U,7),APPACK=$P(PROT,U,8)
"RTN","HLCSHDR1",146,0)
PID ;Processing ID
"RTN","HLCSHDR1",147,0)
 ;I PID not 'debug' get from site params
"RTN","HLCSHDR1",148,0)
 ;If event driver set to 'debug' get from protocol
"RTN","HLCSHDR1",149,0)
 ;'production' or 'training' comes from site params
"RTN","HLCSHDR1",150,0)
 S HLPID=$P(PROT,U,5)
"RTN","HLCSHDR1",151,0)
 I $G(HLPID)'="D" S HLPID=$P(HLPARAM,U,3)
"RTN","HLCSHDR1",152,0)
 ;
"RTN","HLCSHDR1",153,0)
 ; patch HL*1.6*120: to include processing mode
"RTN","HLCSHDR1",154,0)
 I $G(HLP("PMOD"))]"",($G(HLTYPE)="M") D
"RTN","HLCSHDR1",155,0)
 . S HLPID=HLPID_$E($G(EC),1)_HLP("PMOD")
"RTN","HLCSHDR1",156,0)
 ;
"RTN","HLCSHDR1",157,0)
 I $G(HLPID)="" S HLERROR="Missing processing ID Site parameter."
"RTN","HLCSHDR1",158,0)
 ;acknowledgements have no application ack, link open no commit ack
"RTN","HLCSHDR1",159,0)
 I ACKTO S:APPACK]"" APPACK="NE" S:ACCACK]""&$G(HLTCPO) ACCACK="NE"
"RTN","HLCSHDR1",160,0)
 ;Get date/time, Message ID, and security
"RTN","HLCSHDR1",161,0)
 S HLDATE=+TXTP0,HLDATE=$$FMTHL7^XLFDT(HLDATE),HLID=$P(CHILD,U,2),SECURITY=$P(CHILD,U,9)
"RTN","HLCSHDR1",162,0)
HDR23 ;generate extended facility field info based on 'facility required'
"RTN","HLCSHDR1",163,0)
 ;default format is INSTITUTION_HLCS_DOMAIN_HLCS_'DNS'
"RTN","HLCSHDR1",164,0)
 ;application parameter entry overrides default
"RTN","HLCSHDR1",165,0)
 N HLEP773,HLS773
"RTN","HLCSHDR1",166,0)
 S SERFAC=$G(SERFAC),CLNTFAC=$G(CLNTFAC)
"RTN","HLCSHDR1",167,0)
 S HLEP773=+$G(^ORD(101,HLPROTS,773))
"RTN","HLCSHDR1",168,0)
 S HLS773=+$P($G(^ORD(101,HLPROTS,773)),U,2)
"RTN","HLCSHDR1",169,0)
 Q:'HLEP773&('HLS773)
"RTN","HLCSHDR1",170,0)
 D GEN^HLCSHDR2
"RTN","HLCSHDR1",171,0)
 I ACKTO D  Q
"RTN","HLCSHDR1",172,0)
 .;Find original message
"RTN","HLCSHDR1",173,0)
 .S X=$G(^HLMA(ACKTO,"MSH",1,0)) ;Find header in TCP nodes
"RTN","HLCSHDR1",174,0)
 .I X["MSH" D
"RTN","HLCSHDR1",175,0)
 ..;
"RTN","HLCSHDR1",176,0)
 ..; patch HL*1.6*120 start
"RTN","HLCSHDR1",177,0)
 .. N HLEC
"RTN","HLCSHDR1",178,0)
 ..S HLFS=$E(X,4),HLEC=$E(X,5)
"RTN","HLCSHDR1",179,0)
 ..S SENDFAC=$P(X,HLFS,4),RECFAC=$P(X,HLFS,6) ;from original msg
"RTN","HLCSHDR1",180,0)
 ..S CLNTFAC=SENDFAC,SERFAC=RECFAC ;reverse facility info
"RTN","HLCSHDR1",181,0)
 ..S EC("COMPONENT")=$E($G(EC),1)
"RTN","HLCSHDR1",182,0)
 ..I $L(EC("COMPONENT"))=1,$L(HLEC)=1,EC("COMPONENT")'=HLEC D
"RTN","HLCSHDR1",183,0)
 ... ; change the the component separator in the sending and
"RTN","HLCSHDR1",184,0)
 ... ; receiving facilities for the outgoing message
"RTN","HLCSHDR1",185,0)
 ... S CLNTFAC=$TR(CLNTFAC,HLEC,EC("COMPONENT"))
"RTN","HLCSHDR1",186,0)
 ... S SERFAC=$TR(SERFAC,HLEC,EC("COMPONENT"))
"RTN","HLCSHDR1",187,0)
 ; patch HL*1.6*120 end
"RTN","HLCSHDR1",188,0)
 ;
"RTN","HLCSHDR1",189,0)
 I HLEP773,SERFAC="" D EP^HLCSHDR2
"RTN","HLCSHDR1",190,0)
 I HLS773,CLNTFAC="" D S^HLCSHDR2
"RTN","HLCSHDR1",191,0)
 Q
"RTN","HLCSHDR1",192,0)
 ;
"RTN","HLCSHDR1",193,0)
ESCAPE(INPUT,COMPONET) ;
"RTN","HLCSHDR1",194,0)
 ; patch HL*1.6*120 - escape delimiters:
"RTN","HLCSHDR1",195,0)
 ; - field separator
"RTN","HLCSHDR1",196,0)
 ; - component separator
"RTN","HLCSHDR1",197,0)
 ; - repetition separator
"RTN","HLCSHDR1",198,0)
 ; - escape character
"RTN","HLCSHDR1",199,0)
 ; - subcomponent separator
"RTN","HLCSHDR1",200,0)
 ;
"RTN","HLCSHDR1",201,0)
 ; input: 
"RTN","HLCSHDR1",202,0)
 ;     INPUT - string data to be escaped
"RTN","HLCSHDR1",203,0)
 ;  COMPONET - if 1, escape component separator
"RTN","HLCSHDR1",204,0)
 ;             if 0, do not escape component separator
"RTN","HLCSHDR1",205,0)
 ;        FS - field separator character
"RTN","HLCSHDR1",206,0)
 ;        EC - encoding 4 characters 
"RTN","HLCSHDR1",207,0)
 ; result: return the escaped string
"RTN","HLCSHDR1",208,0)
 ;
"RTN","HLCSHDR1",209,0)
 N HLDATA,HLESCAPE,HLI,HLCHAR,HLEN,HLOUT,COMFLAG
"RTN","HLCSHDR1",210,0)
 S HLDATA=$G(INPUT)
"RTN","HLCSHDR1",211,0)
 S COMFLAG=$G(COMPONET)
"RTN","HLCSHDR1",212,0)
 Q:$L($G(FS))'=1 HLDATA
"RTN","HLCSHDR1",213,0)
 Q:$L($G(EC))'=4 HLDATA
"RTN","HLCSHDR1",214,0)
 Q:HLDATA']"" HLDATA
"RTN","HLCSHDR1",215,0)
 ;
"RTN","HLCSHDR1",216,0)
 S HLESCAPE=FS_EC
"RTN","HLCSHDR1",217,0)
 S HLESCAPE("F")=FS
"RTN","HLCSHDR1",218,0)
 S HLESCAPE("S")=$E(EC,1)
"RTN","HLCSHDR1",219,0)
 S HLESCAPE("R")=$E(EC,2)
"RTN","HLCSHDR1",220,0)
 S HLESCAPE("E")=$E(EC,3)
"RTN","HLCSHDR1",221,0)
 S HLESCAPE("T")=$E(EC,4)
"RTN","HLCSHDR1",222,0)
 S HLEN=$L(HLDATA)
"RTN","HLCSHDR1",223,0)
 S HLOUT=""
"RTN","HLCSHDR1",224,0)
 F HLI=1:1:HLEN D
"RTN","HLCSHDR1",225,0)
 . S HLCHAR=$E(HLDATA,HLI)
"RTN","HLCSHDR1",226,0)
 . I HLESCAPE[HLCHAR D  Q
"RTN","HLCSHDR1",227,0)
 .. I HLCHAR=HLESCAPE("F") S HLOUT=HLOUT_"\F\" Q
"RTN","HLCSHDR1",228,0)
 .. I HLCHAR=HLESCAPE("S") D  Q
"RTN","HLCSHDR1",229,0)
 ... I COMFLAG=1 S HLOUT=HLOUT_"\S\" Q
"RTN","HLCSHDR1",230,0)
 ... S HLOUT=HLOUT_HLCHAR
"RTN","HLCSHDR1",231,0)
 .. I HLCHAR=HLESCAPE("R") S HLOUT=HLOUT_"\R\" Q
"RTN","HLCSHDR1",232,0)
 .. I HLCHAR=HLESCAPE("E") S HLOUT=HLOUT_"\E\" Q
"RTN","HLCSHDR1",233,0)
 .. I HLCHAR=HLESCAPE("T") S HLOUT=HLOUT_"\T\" Q
"RTN","HLCSHDR1",234,0)
 . ;
"RTN","HLCSHDR1",235,0)
 . S HLOUT=HLOUT_HLCHAR
"RTN","HLCSHDR1",236,0)
 Q HLOUT
"RTN","HLMA2")
0^3^B40932802^B37613049
"RTN","HLMA2",1,0)
HLMA2 ;AISC/SAW-Message Administration Module ;09/23/2005  17:45
"RTN","HLMA2",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,43,57,58,64,65,76,82,91,94,109,120**;Oct 13, 1995;Build 12
"RTN","HLMA2",3,0)
 ; References to ^ORD(101) supported by IA# 1373.
"RTN","HLMA2",4,0)
 ;
"RTN","HLMA2",5,0)
SEND(EIDS,MTIEN,CLIENT,PRIORITY,MTIENS,LOGLINK) ;
"RTN","HLMA2",6,0)
 ;Entry point to create
"RTN","HLMA2",7,0)
 ;an entry in the Message Administrator and Message Text
"RTN","HLMA2",8,0)
 ;files for a message that is about to be sent to a recipient
"RTN","HLMA2",9,0)
 ;
"RTN","HLMA2",10,0)
 ;This is a subroutine call with parameter passing.  It returns a value
"RTN","HLMA2",11,0)
 ;in the variable MTIENS with 1 to 3 pieces separated by uparrows
"RTN","HLMA2",12,0)
 ;as follows:  MTIENS^error code^error description
"RTN","HLMA2",13,0)
 ;If no error occurs, only the first piece is returned equal to the IEN
"RTN","HLMA2",14,0)
 ;the entry created in the Message Text or Administration file.
"RTN","HLMA2",15,0)
 ;Otherwise, three pieces are returned with the first piece equal to 0
"RTN","HLMA2",16,0)
 ;
"RTN","HLMA2",17,0)
 ;All the following input parameters are required
"RTN","HLMA2",18,0)
 ;    EIDS = The IEN from the Protocol file of the subscriber event
"RTN","HLMA2",19,0)
 ;   MTIEN = The IEN from the Message Text file created when the
"RTN","HLMA2",20,0)
 ;           GENERATE^HLMA or GENACK^HLMA1 entry points were invoked
"RTN","HLMA2",21,0)
 ;  CLIENT = The IEN of the client (subscriber) application from
"RTN","HLMA2",22,0)
 ;             the Application Parameter file
"RTN","HLMA2",23,0)
 ;PRIORITY = I for immediate or D for deferred
"RTN","HLMA2",24,0)
 ;  MTIENS = The variable that will be returned to the calling
"RTN","HLMA2",25,0)
 ;             application as described above
"RTN","HLMA2",26,0)
 ;Optional parameter
"RTN","HLMA2",27,0)
 ; LOGLINK = The IEN of the logical link from the Logical Link file
"RTN","HLMA2",28,0)
 ;
"RTN","HLMA2",29,0)
 ;     ACK = 1 or 0 to indicate if original message or response-passed
"RTN","HLMA2",30,0)
 ;             by ^HLCS
"RTN","HLMA2",31,0)
 ;
"RTN","HLMA2",32,0)
 ; Save passed parameters for restore... HL*1.6*94
"RTN","HLMA2",33,0)
 N HL94P
"RTN","HLMA2",34,0)
 ;
"RTN","HLMA2",35,0)
 ; patch HL*1.6*120 start
"RTN","HLMA2",36,0)
 ; save the receiving facility from HLSUP("S") variable in routine ADD^HLCS2
"RTN","HLMA2",37,0)
 I $G(MTIENS("REC-FACILITY"))]"" D
"RTN","HLMA2",38,0)
 . S HLP("REC-FACILITY")=MTIENS("REC-FACILITY")
"RTN","HLMA2",39,0)
 ; F HL94P="CONTPTR","NAMESPACE","SECURITY","SUBSCRIBER" D
"RTN","HLMA2",40,0)
 F HL94P="CONTPTR","NAMESPACE","SECURITY","SUBSCRIBER","PMOD","REC-FACILITY" D
"RTN","HLMA2",41,0)
 .  QUIT:'$D(HLP(HL94P))  ;->
"RTN","HLMA2",42,0)
 .  MERGE HL94P(HL94P)=HLP(HL94P)
"RTN","HLMA2",43,0)
 ; patch HL*1.6*120 end
"RTN","HLMA2",44,0)
 ;
"RTN","HLMA2",45,0)
 ;Check for required parameters
"RTN","HLMA2",46,0)
 S MTIENS=""
"RTN","HLMA2",47,0)
 I '$G(EIDS)!('$G(MTIEN))!('$G(CLIENT))!("ID"'[$E($G(PRIORITY))) S MTIENS="0^7^"_$G(^HL(771.7,7,0))_" at SEND^HLMA entry point" G EXIT
"RTN","HLMA2",48,0)
 ;Get message ID and Message Text IEN
"RTN","HLMA2",49,0)
 N HLJ,HLHDRBLD,HLMIDS,HLDTS,HLDT1S,HLP,REPLYTO,SERVER,X
"RTN","HLMA2",50,0)
 ;
"RTN","HLMA2",51,0)
 ; Restore parameters if needed... HL*1.6*94
"RTN","HLMA2",52,0)
 S HL94P=""
"RTN","HLMA2",53,0)
 F  S HL94P=$O(HL94P(HL94P)) Q:HL94P']""  D
"RTN","HLMA2",54,0)
 .  MERGE HLP(HL94P)=HL94P(HL94P)
"RTN","HLMA2",55,0)
 ;
"RTN","HLMA2",56,0)
 ;check if LL is TCP
"RTN","HLMA2",57,0)
 I $G(LOGLINK) D  Q:MTIENS!($G(HLERROR)]"")
"RTN","HLMA2",58,0)
 . ;quit if it is not TCP
"RTN","HLMA2",59,0)
 . Q:$P(^HLCS(870,LOGLINK,0),U,3)'=4
"RTN","HLMA2",60,0)
 . ;create client in 773, MTIENS=ien in 773
"RTN","HLMA2",61,0)
 . S (MTIENS,HLTCP)=$$MA^HLTF(MTIEN,.HLMIDS)
"RTN","HLMA2",62,0)
 .;
"RTN","HLMA2",63,0)
 .;**109
"RTN","HLMA2",64,0)
 .; F  L +^HLMA(MTIENS):1 Q:$T  H 1
"RTN","HLMA2",65,0)
 .;
"RTN","HLMA2",66,0)
 . D MIDAR(HLMIDS)
"RTN","HLMA2",67,0)
 . ;get info from parent (772)
"RTN","HLMA2",68,0)
 . S X=^HL(772,MTIEN,0),HLTYPE=$P(X,U,14),SERVER=$P(X,U,2),REPLYTO=$P(X,U,7)
"RTN","HLMA2",69,0)
 . ;get ack timeout override
"RTN","HLMA2",70,0)
 . S:$P($G(^HL(772,MTIEN,"P")),U,7) HLP("ACKTIME")=+$P(^("P"),U,7)
"RTN","HLMA2",71,0)
 . ;get message type and event type from protocol
"RTN","HLMA2",72,0)
 . S X=$G(^ORD(101,EIDS,770)),HLP("MTYPE")=$P(X,U,11),HLP("EVENT")=$P(X,U,4),HLP("HLTCPI")=MTIENS
"RTN","HLMA2",73,0)
 . S:$P(X,U,5) HLP("MTYPE_EVENT")=$P(X,U,5)
"RTN","HLMA2",74,0)
 . ;update date in client (773)
"RTN","HLMA2",75,0)
 . D UPDATE^HLTF0(MTIENS,"","O",EIDS,CLIENT,SERVER,"D",REPLYTO,"",.HLP)
"RTN","HLMA2",76,0)
 . ;create header for message in 773
"RTN","HLMA2",77,0)
 . I (HLTYPE="M") D HEADER^HLCSHDR1(MTIENS,CLIENT,.HLERROR)
"RTN","HLMA2",78,0)
 . I (HLTYPE'="M") D BHSHDR^HLCSHDR1(MTIENS,CLIENT,.HLERROR)
"RTN","HLMA2",79,0)
 . ;if error set status to ERROR DURING TRANSMISSION
"RTN","HLMA2",80,0)
 . I ($G(HLERROR)'="") D  Q
"RTN","HLMA2",81,0)
 ..;**109**
"RTN","HLMA2",82,0)
 ..; D STATUS^HLTF0(MTIENS,4,12,HLERROR) L -^HLMA(MTIENS)
"RTN","HLMA2",83,0)
 .. D STATUS^HLTF0(MTIENS,4,12,HLERROR)
"RTN","HLMA2",84,0)
 ..;
"RTN","HLMA2",85,0)
 .. S MTIENS="0^12^"_$G(^HL(771.7,12,0))_" in HLCSHDR1"
"RTN","HLMA2",86,0)
 .. Q
"RTN","HLMA2",87,0)
 . ;do we still need MTIEN=ien of file 772
"RTN","HLMA2",88,0)
 . S MTIEN=""
"RTN","HLMA2",89,0)
 . ;update status of 773 to PENDING TRANSMISSION
"RTN","HLMA2",90,0)
 . D STATUS^HLTF0(MTIENS,1)
"RTN","HLMA2",91,0)
 . ;set header, HLHDR and Logical Link in 773
"RTN","HLMA2",92,0)
 . K HLJ
"RTN","HLMA2",93,0)
 . S X=MTIENS_",",HLJ(773,X,7)=LOGLINK,HLJ(773,X,200)="HLHDR"
"RTN","HLMA2",94,0)
 . D FILE^HLDIE("","HLJ","","SEND","HLMA2") ;HL*1.6*109
"RTN","HLMA2",95,0)
 .D ENQUE^HLCSREP(LOGLINK,"O",MTIENS)
"RTN","HLMA2",96,0)
 .;
"RTN","HLMA2",97,0)
 .;**109
"RTN","HLMA2",98,0)
 .; L -^HLMA(MTIENS)
"RTN","HLMA2",99,0)
 ;
"RTN","HLMA2",100,0)
 ;if not TCP get msg. ID
"RTN","HLMA2",101,0)
 S HLMIDS=$P($G(^HL(772,MTIEN,0)),"^",6)
"RTN","HLMA2",102,0)
 ;create child message
"RTN","HLMA2",103,0)
 D CREATE^HLTF(.HLMIDS,.MTIENS,.HLDTS,.HLDT1S),MIDAR(HLMIDS)
"RTN","HLMA2",104,0)
 ;Link new Message Text file entry to MTIENG entry and update fields
"RTN","HLMA2",105,0)
 ;on zero node
"RTN","HLMA2",106,0)
 D UPDATE^HLTF0(MTIENS,MTIEN,"O",EIDS,CLIENT,"",PRIORITY,"",$S($G(LOGLINK):LOGLINK,1:""))
"RTN","HLMA2",107,0)
EXIT Q
"RTN","HLMA2",108,0)
 ;
"RTN","HLMA2",109,0)
MIDAR(X) ;update HLMIDAR array with X=message id
"RTN","HLMA2",110,0)
 Q:$G(X)=""
"RTN","HLMA2",111,0)
 I 'HLMIDAR S HLMIDAR("N")=1,HLMIDAR=X Q
"RTN","HLMA2",112,0)
 S HLMIDAR(HLMIDAR("N"))=X,HLMIDAR("N")=HLMIDAR("N")+1
"RTN","HLMA2",113,0)
 Q
"RTN","HLMA2",114,0)
 ;
"RTN","HLMA2",115,0)
DC ;direct connect
"RTN","HLMA2",116,0)
 N CLIENT,EIDS,HLMIDS,LOGLINK,MTIEN,MTIENS,POP,HLHDR,HLHDRO,HLMSA,REPLYTO,SERVER,X,HLTCPI
"RTN","HLMA2",117,0)
 N HLCSOUT,HLDBACK,HLDBSIZE,HLDP,HLDREAD,HLDRETR,HLDWAIT,HLMSG,HLOS,HLPORT,HLTCPADD,HLTCPCS,HLTCPLNK,HLTCPO,HLTCPORT,HLRESP,HLTYPE,HLRETRA,HLRETRY,HLTCPRET
"RTN","HLMA2",118,0)
 S (EIDS,LOGLINK)="",MTIEN=HLMTIEN
"RTN","HLMA2",119,0)
 I $D(HLL("LINKS")) D
"RTN","HLMA2",120,0)
 . S EIDS=$P(HLL("LINKS",1),U),LOGLINK=$P(HLL("LINKS",1),U,2)
"RTN","HLMA2",121,0)
 . K HLL("LINKS")
"RTN","HLMA2",122,0)
 . Q:EIDS=""  I EIDS<1 S EIDS=$O(^ORD(101,"B",EIDS,0))
"RTN","HLMA2",123,0)
 . Q:LOGLINK=""  I LOGLINK<1 S LOGLINK=$O(^HLCS(870,"B",LOGLINK,0))
"RTN","HLMA2",124,0)
 . S CLIENT=+$$PTR^HLUTIL2(EIDS)
"RTN","HLMA2",125,0)
 I 'LOGLINK!'EIDS D
"RTN","HLMA2",126,0)
 . S EIDS=+$O(^ORD(101,HLEID,775,0)) Q:'EIDS  S EIDS=$P($G(^(EIDS,0)),U)
"RTN","HLMA2",127,0)
 . S X=$$PTR^HLUTIL2(EIDS),CLIENT=$P(X,U),LOGLINK=$P(X,U,2)
"RTN","HLMA2",128,0)
 I 'EIDS S HLERROR="15^Invalid Subscriber for Immediate connection" Q
"RTN","HLMA2",129,0)
 I 'LOGLINK S HLERROR="15^Invalid Logical Link for Immediate connection" Q
"RTN","HLMA2",130,0)
 I CLIENT<0 S HLERROR="15^Invalid Subscriber Protocol for Immediate connection" Q
"RTN","HLMA2",131,0)
 ;open connection
"RTN","HLMA2",132,0)
 I '$$DCOPEN^HLCSTCP(LOGLINK) S HLERROR="15^Connection Failed" Q
"RTN","HLMA2",133,0)
 ;create client in 773
"RTN","HLMA2",134,0)
 S HLDP=LOGLINK,(MTIENS,HLTCP,HLTCPI,HLMSG)=$$MA^HLTF(MTIEN,.HLMIDS)
"RTN","HLMA2",135,0)
 ;
"RTN","HLMA2",136,0)
 ; patch HL*1.6*120 start
"RTN","HLMA2",137,0)
 S HLMIDAR("HLMID")=$G(HLMIDS)
"RTN","HLMA2",138,0)
 S HLMIDAR("IEN773")=MTIENS
"RTN","HLMA2",139,0)
 ; patch HL*1.6*120 end
"RTN","HLMA2",140,0)
 ;
"RTN","HLMA2",141,0)
 ;**109**
"RTN","HLMA2",142,0)
 ;F  L +^HLMA(MTIENS):1 Q:$T  H 1
"RTN","HLMA2",143,0)
 ;
"RTN","HLMA2",144,0)
 ;get info from parent (772)
"RTN","HLMA2",145,0)
 S X=^HL(772,MTIEN,0),HLTYPE=$P(X,U,14),SERVER=$P(X,U,2),REPLYTO=$P(X,U,7)
"RTN","HLMA2",146,0)
 ;get ack timeout override
"RTN","HLMA2",147,0)
 S:$P($G(^HL(772,MTIEN,"P")),U,7) HLP("ACKTIME")=+$P(^("P"),U,7)
"RTN","HLMA2",148,0)
 ;get message type and event type from protocol
"RTN","HLMA2",149,0)
 S X=$G(^ORD(101,EIDS,770)),HLP("MTYPE")=$P(X,U,11),HLP("EVENT")=$P(X,U,4),HLP("HLTCPI")=MTIENS
"RTN","HLMA2",150,0)
 S:$P(X,U,5) HLP("MTYPE_EVENT")=$P(X,U,5)
"RTN","HLMA2",151,0)
 ;update date in client (773)
"RTN","HLMA2",152,0)
 D UPDATE^HLTF0(MTIENS,"","O",EIDS,CLIENT,SERVER,"I",REPLYTO,"",.HLP)
"RTN","HLMA2",153,0)
 ;create header for message in 773
"RTN","HLMA2",154,0)
 I (HLTYPE="M") D HEADER^HLCSHDR1(MTIENS,CLIENT,.HLERROR)
"RTN","HLMA2",155,0)
 I (HLTYPE'="M") D BHSHDR^HLCSHDR1(MTIENS,CLIENT,.HLERROR)
"RTN","HLMA2",156,0)
 ;if error set status to ERROR DURING TRANSMISSION
"RTN","HLMA2",157,0)
 I ($G(HLERROR)'="") D  Q
"RTN","HLMA2",158,0)
 .;
"RTN","HLMA2",159,0)
 .;**109**
"RTN","HLMA2",160,0)
 .; D STATUS^HLTF0(MTIENS,4,12,HLERROR) L -^HLMA(MTIENS)
"RTN","HLMA2",161,0)
 . D STATUS^HLTF0(MTIENS,4,12,HLERROR)
"RTN","HLMA2",162,0)
 .;
"RTN","HLMA2",163,0)
 . S MTIENS="0^12^"_$G(^HL(771.7,12,0))_" in HLCSHDR1"
"RTN","HLMA2",164,0)
 .;
"RTN","HLMA2",165,0)
 .;**109**
"RTN","HLMA2",166,0)
 .; L -^HLMA(HLMSG) D MON^HLCSTCP("Idle")
"RTN","HLMA2",167,0)
 . D MON^HLCSTCP("Idle")
"RTN","HLMA2",168,0)
 .;
"RTN","HLMA2",169,0)
 . Q
"RTN","HLMA2",170,0)
 ;set header, HLHDR and Logical Link in 773
"RTN","HLMA2",171,0)
 K HLJ S X=MTIENS_",",HLJ(773,X,7)=LOGLINK,HLJ(773,X,200)="HLHDR"
"RTN","HLMA2",172,0)
 ;
"RTN","HLMA2",173,0)
 D FILE^HLDIE("","HLJ","","DC","HLMA2") ; HL*1.6*109
"RTN","HLMA2",174,0)
 ;
"RTN","HLMA2",175,0)
 ;**109**
"RTN","HLMA2",176,0)
 D LLCNT^HLCSTCP(LOGLINK,3)
"RTN","HLMA2",177,0)
 ;
"RTN","HLMA2",178,0)
 D DCSEND^HLCSTCP2
"RTN","HLMA2",179,0)
 G EXIT2:'$G(HLRESP)
"RTN","HLMA2",180,0)
 ;X=ien in 773^ien in 772 for response
"RTN","HLMA2",181,0)
 S X=HLRESP D INIT^HLTP3A  ;patch HL*1.6*109 - hltp3 routine split
"RTN","HLMA2",182,0)
 D:'$G(HL) STATUS^HLTF0(HLMTIENS,3,,,1)
"RTN","HLMA2",183,0)
 S HLMTIENR=HLMTIEN
"RTN","HLMA2",184,0)
 D EXIT^HLTP3
"RTN","HLMA2",185,0)
EXIT2 ;
"RTN","HLMA2",186,0)
 ;**109**
"RTN","HLMA2",187,0)
 ;L -^HLMA(HLMSG)
"RTN","HLMA2",188,0)
 Q
"RTN","HLPAT120")
0^1^B4889907
"RTN","HLPAT120",1,0)
HLPAT120 ;OIFO-OAKLAND/RAM & RJH - HL7 PATCH 120 PRE&POST-INIT ;01/19/06  11:07
"RTN","HLPAT120",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**120**;Oct 13, 1995;Build 12
"RTN","HLPAT120",3,0)
 ;
"RTN","HLPAT120",4,0)
 Q
"RTN","HLPAT120",5,0)
PRE ;
"RTN","HLPAT120",6,0)
 ; disable identifier for file #779.004 to prevent from duplicate
"RTN","HLPAT120",7,0)
 ; caused by field #2 (Description)
"RTN","HLPAT120",8,0)
 K ^DD(779.004,0,"ID")
"RTN","HLPAT120",9,0)
 ;
"RTN","HLPAT120",10,0)
 N HLCCARY,HLAPPARY
"RTN","HLPAT120",11,0)
 D CC
"RTN","HLPAT120",12,0)
 D APP771
"RTN","HLPAT120",13,0)
 Q:'$D(HLCCARY)
"RTN","HLPAT120",14,0)
 ;
"RTN","HLPAT120",15,0)
 I $D(^XTMP("HLPAT120")) K ^XTMP("HLPAT120")
"RTN","HLPAT120",16,0)
 M ^XTMP("HLPAT120","CC")=HLCCARY
"RTN","HLPAT120",17,0)
 S ^XTMP("HLPAT120",0)=$$FMADD^XLFDT(DT,90)_U_DT
"RTN","HLPAT120",18,0)
 Q:'$D(HLAPPARY)
"RTN","HLPAT120",19,0)
 ;
"RTN","HLPAT120",20,0)
 M ^XTMP("HLPAT120","APP")=HLAPPARY
"RTN","HLPAT120",21,0)
 Q
"RTN","HLPAT120",22,0)
CC ;
"RTN","HLPAT120",23,0)
 ; find entries US" and "USA" in file #779.004
"RTN","HLPAT120",24,0)
 N HLIEN,HLCC
"RTN","HLPAT120",25,0)
 S HLIEN=0
"RTN","HLPAT120",26,0)
 F  S HLIEN=$O(^HL(779.004,HLIEN)) Q:'HLIEN  D
"RTN","HLPAT120",27,0)
 . I $D(^HL(779.004,HLIEN,0)) D
"RTN","HLPAT120",28,0)
 .. S HLCC=$P(^HL(779.004,HLIEN,0),"^")
"RTN","HLPAT120",29,0)
 .. I (HLCC="US")!(HLCC="USA") D
"RTN","HLPAT120",30,0)
 ... ; no duplicate country code is assumed
"RTN","HLPAT120",31,0)
 ... S HLCCARY(HLCC)=HLIEN
"RTN","HLPAT120",32,0)
 Q
"RTN","HLPAT120",33,0)
APP771 ;
"RTN","HLPAT120",34,0)
 ; find pointer in file #771, pointing to entries US" in file #779.004
"RTN","HLPAT120",35,0)
 N HLIEN,HLCCPTR,HLCCPNEW
"RTN","HLPAT120",36,0)
 S HLIEN=0
"RTN","HLPAT120",37,0)
 Q:'$G(HLCCARY("US"))
"RTN","HLPAT120",38,0)
 Q:'$G(HLCCARY("USA"))
"RTN","HLPAT120",39,0)
 ;
"RTN","HLPAT120",40,0)
 F  S HLIEN=$O(^HL(771,HLIEN)) Q:'HLIEN  D
"RTN","HLPAT120",41,0)
 . I $D(^HL(771,HLIEN,0)) D
"RTN","HLPAT120",42,0)
 .. S HLCCPTR=$P(^HL(771,HLIEN,0),"^",7)
"RTN","HLPAT120",43,0)
 .. S HLCCPNEW=0
"RTN","HLPAT120",44,0)
 .. I HLCCPTR>0,HLCCPTR=HLCCARY("US") D
"RTN","HLPAT120",45,0)
 ... ;
"RTN","HLPAT120",46,0)
 ... ; redirect pointer for field #771,7
"RTN","HLPAT120",47,0)
 ... S $P(^HL(771,HLIEN,0),"^",7)=HLCCARY("USA")
"RTN","HLPAT120",48,0)
 ... S HLAPPARY(HLIEN,HLCCARY("US"))=HLCCARY("USA")
"RTN","HLPAT120",49,0)
 ;
"RTN","HLPAT120",50,0)
 ; delete entry "US" from file #779.004
"RTN","HLPAT120",51,0)
 N DA,DIK
"RTN","HLPAT120",52,0)
 S DIK="^HL(779.004,"
"RTN","HLPAT120",53,0)
 S DA=HLCCARY("US")
"RTN","HLPAT120",54,0)
 D ^DIK
"RTN","HLPAT120",55,0)
 Q
"RTN","HLPAT120",56,0)
POST ;
"RTN","HLPAT120",57,0)
 ; enable identifier for file  #779.004
"RTN","HLPAT120",58,0)
 S ^DD(779.004,0,"ID",2)="W "_""""_"   "_""""_",$P(^(0),U,2)"
"RTN","HLPAT120",59,0)
 ;
"RTN","HLPAT120",60,0)
 N FDA,IEN,IENS,VUID,IFN
"RTN","HLPAT120",61,0)
 ;
"RTN","HLPAT120",62,0)
 S IFN=779.00409
"RTN","HLPAT120",63,0)
 K FDA
"RTN","HLPAT120",64,0)
 ;
"RTN","HLPAT120",65,0)
 S VUID=0
"RTN","HLPAT120",66,0)
 F  S VUID=$O(^HL(779.004,"AMASTERVUID",VUID)) Q:'VUID  D
"RTN","HLPAT120",67,0)
 .S IEN=$O(^HL(779.004,"AMASTERVUID",VUID,1,0)) Q:'IEN
"RTN","HLPAT120",68,0)
 .K ^HL(779.004,IEN,"TERMSTATUS")
"RTN","HLPAT120",69,0)
 .S IENS=IEN_","
"RTN","HLPAT120",70,0)
 .K FDA
"RTN","HLPAT120",71,0)
 .S FDA(IFN,"?+1,"_IENS,.01)=$$NOW^XLFDT
"RTN","HLPAT120",72,0)
 .S FDA(IFN,"?+1,"_IENS,.02)=1
"RTN","HLPAT120",73,0)
 .D UPDATE^DIE(,"FDA")
"RTN","HLPAT120",74,0)
 ;
"RTN","HLPAT120",75,0)
 Q
"RTN","HLPAT120",76,0)
 ;
"RTN","HLTF")
0^8^B49703549^B49383239
"RTN","HLTF",1,0)
HLTF ;AISC/SAW,JRP-Create/Process Message Text File Entries ;01/23/06  12:56
"RTN","HLTF",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**1,19,43,55,109,120**;Oct 13, 1995;Build 12
"RTN","HLTF",3,0)
FILE ;Create Entries in files 772 and 773 for Version 1.5 Interface Only
"RTN","HLTF",4,0)
 D CREATE(,.HLDA,.HLDT,.HLDT1)
"RTN","HLTF",5,0)
 Q
"RTN","HLTF",6,0)
CREATE(HLMID,MTIEN,HLDT,HLDT1) ;Create entries in Message Text (#772)
"RTN","HLTF",7,0)
 ;
"RTN","HLTF",8,0)
 ;Input  : HLMID = Variable in which value of message ID will be
"RTN","HLTF",9,0)
 ;                 returned (pass by reference)
"RTN","HLTF",10,0)
 ;         MTIEN = Variable in which IEN of Message Text file entry
"RTN","HLTF",11,0)
 ;                 will be returned (pass by reference)
"RTN","HLTF",12,0)
 ;         HLDT = Variable in which current date/time in FM internal
"RTN","HLTF",13,0)
 ;                format will be returned (pass by reference)
"RTN","HLTF",14,0)
 ;         HLDT1 = Variable in which current date/time in HL7 format
"RTN","HLTF",15,0)
 ;                 will be returned (pass by reference)
"RTN","HLTF",16,0)
 ;
"RTN","HLTF",17,0)
 ;Output : See above
"RTN","HLTF",18,0)
 ;
"RTN","HLTF",19,0)
 ;Notes  : If HLDT has a value [upon entry], the created entries will
"RTN","HLTF",20,0)
 ;         be given that value for their date/time (value of .01)
"RTN","HLTF",21,0)
 ;       : Current date/time used if HLDT is not passed or invalid
"RTN","HLTF",22,0)
 ;
"RTN","HLTF",23,0)
 ;Make entry in Message Administration file
"RTN","HLTF",24,0)
 N Y
"RTN","HLTF",25,0)
 S HLDT=$G(HLDT)
"RTN","HLTF",26,0)
 D MT(.HLDT)
"RTN","HLTF",27,0)
 S Y=$$CHNGMID(MTIEN,.HLMID),HLDT1=$$HLDATE^HLFNC(HLDT)
"RTN","HLTF",28,0)
 Q
"RTN","HLTF",29,0)
TCP(HLMID,MTIEN,HLDT) ;create new message in 772 & 773 entries
"RTN","HLTF",30,0)
 ;used for incoming messages and outgoing responses
"RTN","HLTF",31,0)
 ;Input  : HLMID = Variable in which value of message ID will be
"RTN","HLTF",32,0)
 ;                 returned (pass by reference)
"RTN","HLTF",33,0)
 ;         MTIEN = Variable in which IEN of file 773 entry
"RTN","HLTF",34,0)
 ;                 will be returned (pass by reference)
"RTN","HLTF",35,0)
 ;         HLDT = Variable in which current date/time in FM internal
"RTN","HLTF",36,0)
 ;                format will be returned (pass by reference)
"RTN","HLTF",37,0)
 ;
"RTN","HLTF",38,0)
 S HLDT=$G(HLDT),HLMID=$G(HLMID)
"RTN","HLTF",39,0)
 D MT(.HLDT)
"RTN","HLTF",40,0)
 S MTIEN=$$MA(MTIEN,.HLMID)
"RTN","HLTF",41,0)
 Q
"RTN","HLTF",42,0)
 ;
"RTN","HLTF",43,0)
MT(HLX) ;Create entry in Message Text file (#772)
"RTN","HLTF",44,0)
 ;
"RTN","HLTF",45,0)
 ;Input  : HLX = Date/time entry in file should be given (value of .01)
"RTN","HLTF",46,0)
 ;               Defaults to current date/time
"RTN","HLTF",47,0)
 ;
"RTN","HLTF",48,0)
 ;Output : HLDT = Date/time of created entry (value of .01)
"RTN","HLTF",49,0)
 ;       : HLDT1 = HLDT in HL7 format
"RTN","HLTF",50,0)
 ;
"RTN","HLTF",51,0)
 ;Notes  : HLX must be in FileMan format (default value used if not)
"RTN","HLTF",52,0)
 ;       : HLDT will be in FileMan format
"RTN","HLTF",53,0)
 ;       : MTIEN is ien in file 772
"RTN","HLTF",54,0)
 ;
"RTN","HLTF",55,0)
 ;Check for input
"RTN","HLTF",56,0)
 S HLX=$G(HLX)
"RTN","HLTF",57,0)
 ;Declare variables
"RTN","HLTF",58,0)
 N DIC,DD,DO,HLCNT,HLJ,X,Y
"RTN","HLTF",59,0)
 F HLCNT=0:1 D  Q:Y>0  H HLCNT
"RTN","HLTF",60,0)
 . I (HLX'?7N.1".".6N) S HLX=$$NOW^XLFDT
"RTN","HLTF",61,0)
 . S DIC="^HL(772,",DIC(0)="L",(HLDT,X)=HLX
"RTN","HLTF",62,0)
 . S Y=$$STUB772(X) ; This call substituted for D FILE^DICN by HL*1.6*109
"RTN","HLTF",63,0)
 . ;Entry not created - try again
"RTN","HLTF",64,0)
 . I Y<0 S HLX="" Q
"RTN","HLTF",65,0)
 . S MTIEN=+Y
"RTN","HLTF",66,0)
 ;***If we didn't get a record in 772, need to do something
"RTN","HLTF",67,0)
 I Y<0 Q
"RTN","HLTF",68,0)
 S HLDT1=$$HLDATE^HLFNC(HLDT)
"RTN","HLTF",69,0)
 Q
"RTN","HLTF",70,0)
 ;add to Message Admin file #773
"RTN","HLTF",71,0)
MA(X,HLMID) ;X=ien in file 772, HLMID=msg. id (passed by ref.)
"RTN","HLTF",72,0)
 ;return ien in file 773
"RTN","HLTF",73,0)
 Q:'$G(^HL(772,X,0)) 0
"RTN","HLTF",74,0)
 N DA,DD,DO,DIC,DIE,DR,HLDA,HLCNT,HLJ,Y
"RTN","HLTF",75,0)
 S DIC="^HLMA(",DIC(0)="L"
"RTN","HLTF",76,0)
 F HLCNT=0:1 D  Q:Y>0  H HLCNT
"RTN","HLTF",77,0)
 . S Y=$$STUB773(X) ; This call substituted for D FILE^DICN by HL*1.6*109
"RTN","HLTF",78,0)
 ;***If we didn't get a record in 773, need to do something
"RTN","HLTF",79,0)
 I Y<0 Q 0
"RTN","HLTF",80,0)
 S HLDA=+Y,HLMID=$$MAID(HLDA,$G(HLMID))
"RTN","HLTF",81,0)
 Q HLDA
"RTN","HLTF",82,0)
 ;
"RTN","HLTF",83,0)
MAID(Y,HLMID) ;Determine message ID (if needed) & store message ID
"RTN","HLTF",84,0)
 ;Y=ien in 773, HLMID=id,  Output message id
"RTN","HLTF",85,0)
 N HLJ
"RTN","HLTF",86,0)
 ;need to have id contain institution number to make unique
"RTN","HLTF",87,0)
 S:$G(HLMID)="" HLMID=+$P($$PARAM^HLCS2,U,6)_Y
"RTN","HLTF",88,0)
 S HLJ(773,Y_",",2)=HLMID
"RTN","HLTF",89,0)
 D FILE^HLDIE("","HLJ","","MAID","HLTF") ;HL*1.6*109
"RTN","HLTF",90,0)
 Q HLMID
"RTN","HLTF",91,0)
 ;
"RTN","HLTF",92,0)
CHNGMID(PTRMT,NEWID) ;Change message ID for entry in Message Text file
"RTN","HLTF",93,0)
 ;Input  : PTRMT - Pointer to entry in Message Text file (#772)
"RTN","HLTF",94,0)
 ;         NEWID - New message ID
"RTN","HLTF",95,0)
 ;Output : 0 = Success
"RTN","HLTF",96,0)
 ;         -1^ErrorText = Error/Bad input
"RTN","HLTF",97,0)
 ;
"RTN","HLTF",98,0)
 ;Check input
"RTN","HLTF",99,0)
 S PTRMT=+$G(PTRMT)
"RTN","HLTF",100,0)
 S NEWID=$G(NEWID)
"RTN","HLTF",101,0)
 Q:('$D(^HL(772,PTRMT,0))) "-1^Did not pass valid pointer to Message Text file (#772)"
"RTN","HLTF",102,0)
 N HLJ
"RTN","HLTF",103,0)
 I $G(NEWID)="" S NEWID=+$P($$PARAM^HLCS2,U,6)_PTRMT
"RTN","HLTF",104,0)
 S HLJ(772,PTRMT_",",6)=NEWID
"RTN","HLTF",105,0)
 D FILE^HLDIE("","HLJ","","CHNGMID","HLTF") ; HL*1.6*109
"RTN","HLTF",106,0)
 Q 0
"RTN","HLTF",107,0)
 ;
"RTN","HLTF",108,0)
OUT(HLDA,HLMID,HLMTN) ;File Data in Message Text File for Outgoing Message
"RTN","HLTF",109,0)
 ;Version 1.5 Interface Only
"RTN","HLTF",110,0)
 Q:'$D(HLFS)
"RTN","HLTF",111,0)
 ;
"RTN","HLTF",112,0)
 I HLMTN="ACK"!(HLMTN="MCF")!(HLMTN="ORR") Q:'$D(HLMSA)  D ACK(HLMSA,"I") Q
"RTN","HLTF",113,0)
 ;
"RTN","HLTF",114,0)
 ;-- if message contained MSA find inbound message
"RTN","HLTF",115,0)
 I $D(HLMSA),$D(HLNDAP),$P(HLMSA,HLFS,3)]"" D
"RTN","HLTF",116,0)
 . N HLDAI
"RTN","HLTF",117,0)
 . S HLDAI=0
"RTN","HLTF",118,0)
 . F  S HLDAI=$O(^HL(772,"AH",+$P($G(HLNDAP0),U,12),$P(HLMSA,HLFS,3),HLDAI)) Q:'HLDAI!($P($G(^HL(772,+HLDAI,0)),U,4)="I")
"RTN","HLTF",119,0)
 . I 'HLDAI K HLDAI
"RTN","HLTF",120,0)
 ;
"RTN","HLTF",121,0)
 D STUFF^HLTF0("O")
"RTN","HLTF",122,0)
 ;
"RTN","HLTF",123,0)
 N HLAC S HLAC=$S($D(HLERR):4,'$P(HLNDAP0,"^",10):1,1:2) D STATUS^HLTF0(HLDA,HLAC,$G(HLMSG))
"RTN","HLTF",124,0)
 D:$D(HLCHAR) STATS^HLTF0(HLDA,HLCHAR,$G(HLEVN))
"RTN","HLTF",125,0)
 ;
"RTN","HLTF",126,0)
 ;-- update status if MSA and found inbound message
"RTN","HLTF",127,0)
 I $D(HLMSA),$D(HLDAI) D
"RTN","HLTF",128,0)
 .N HLERR,HLMSG I $P(HLMSA,HLFS,4)]"" S HLERR=$P(HLMSA,HLFS,4)
"RTN","HLTF",129,0)
 .S HLAC=$P(HLMSA,HLFS,2)
"RTN","HLTF",130,0)
 .I HLAC'="AA" S HLMSG=$S(HLAC="AR":"Application Reject",HLAC="AE":"Application Error",1:"")_" - "_HLERR
"RTN","HLTF",131,0)
 .S HLAC=$S(HLAC'="AA":4,1:3) D STATUS^HLTF0(HLDAI,HLAC,$G(HLMSG))
"RTN","HLTF",132,0)
 Q
"RTN","HLTF",133,0)
 ;
"RTN","HLTF",134,0)
IN(HLMTN,HLMID,HLTIME) ;File Data in Message Text File for Incoming Message
"RTN","HLTF",135,0)
 ;Version 1.5 Interface Only
"RTN","HLTF",136,0)
 Q:'$D(HLFS)
"RTN","HLTF",137,0)
 I HLMTN="ACK"!(HLMTN="MCF")!(HLMTN="ORR") Q:'$D(HLMSA)  D ACK(HLMSA,"O",$G(HLDA)) Q
"RTN","HLTF",138,0)
 ;
"RTN","HLTF",139,0)
 N HLDAI S HLDA=0
"RTN","HLTF",140,0)
 I $D(HLNDAP),HLMID]"" D
"RTN","HLTF",141,0)
 .F  S HLDA=+$O(^HL(772,"AH",+$P($G(HLNDAP0),U,12),HLMID,HLDA)) Q:'HLDA!($P($G(^HL(772,+HLDA,0)),U,4)="I")
"RTN","HLTF",142,0)
 .I HLDA D
"RTN","HLTF",143,0)
 ..S HLDT=+$P($G(^HL(772,HLDA,0)),"^"),HLDT1=$$HLDATE^HLFNC(HLDT)
"RTN","HLTF",144,0)
 ..K ^HL(772,HLDA,"IN")
"RTN","HLTF",145,0)
 .I $D(HLMSA),$P(HLMSA,HLFS,3)]"" D
"RTN","HLTF",146,0)
 ..S HLDAI=0
"RTN","HLTF",147,0)
 ..F  S HLDAI=$O(^HL(772,"AH",+$P($G(HLNDAP0),U,12),$P(HLMSA,HLFS,3),HLDAI)) Q:'HLDAI!($P($G(^HL(772,+HLDAI,0)),U,4)="O")
"RTN","HLTF",148,0)
 ..I 'HLDAI K HLDAI
"RTN","HLTF",149,0)
 ;
"RTN","HLTF",150,0)
 I 'HLDA D CREATE(.HLMID,.HLDA,.HLDT,.HLDT1) K HLZ
"RTN","HLTF",151,0)
 ;
"RTN","HLTF",152,0)
 D STUFF^HLTF0("I")
"RTN","HLTF",153,0)
 N HLAC S HLAC=$S($D(HLERR):4,1:1) D STATUS^HLTF0(HLDA,HLAC,$G(HLMSG))
"RTN","HLTF",154,0)
 ;
"RTN","HLTF",155,0)
 D MERGE15^HLTF1("G",HLDA,"HLR",HLTIME)
"RTN","HLTF",156,0)
 ;
"RTN","HLTF",157,0)
 I '$D(HLERR),$D(HLMSA),$D(HLDAI) D
"RTN","HLTF",158,0)
 .N HLAC,HLERR,HLMSG I $P(HLMSA,HLFS,4)]"" S HLERR=$P(HLMSA,HLFS,4)
"RTN","HLTF",159,0)
 .S HLAC=$P(HLMSA,HLFS,2) I HLAC'="AA" S HLMSG=$S(HLAC="AR":"Application Reject",1:"Application Error")_" - "_HLERR
"RTN","HLTF",160,0)
 .S HLAC=$S(HLAC'="AA":4,1:3) D STATUS^HLTF0(HLDAI,HLAC,$G(HLMSG))
"RTN","HLTF",161,0)
 Q
"RTN","HLTF",162,0)
 ;
"RTN","HLTF",163,0)
ACK(HLMSA,HLIO,HLDA) ;Process 'ACK' Message Type - Version 1.5 Interface Only
"RTN","HLTF",164,0)
 ; To determine the correct message to link the ACK, HLIO is used.
"RTN","HLTF",165,0)
 ; For an ack from DHCP (original message from remote system) then
"RTN","HLTF",166,0)
 ; HLIO should be "I" so that the correct inbound message is ack-ed. For
"RTN","HLTF",167,0)
 ; an inbound ack (original message outbound from DHCP) HLIO should be
"RTN","HLTF",168,0)
 ; "O". This distinction must be made due to the possible duplicate
"RTN","HLTF",169,0)
 ; message ids from a bi-direction interface.
"RTN","HLTF",170,0)
 ;
"RTN","HLTF",171,0)
 ; Input : MSA - MSA from ACK message.
"RTN","HLTF",172,0)
 ;         HLIO - Either "I" or "O" : See note above.
"RTN","HLTF",173,0)
 ;Output : None
"RTN","HLTF",174,0)
 ;
"RTN","HLTF",175,0)
 N HLAC,HLMIDI
"RTN","HLTF",176,0)
 ;-- set up required vars
"RTN","HLTF",177,0)
 S HLAC=$P(HLMSA,HLFS,2),HLMIDI=$P(HLMSA,HLFS,3)
"RTN","HLTF",178,0)
 ;-- quit
"RTN","HLTF",179,0)
 Q:HLMIDI']""!(HLAC']"")!('$D(HLNDAP))
"RTN","HLTF",180,0)
 ;-- find message to ack
"RTN","HLTF",181,0)
 I '$G(HLDA) S HLDA=0 D
"RTN","HLTF",182,0)
 . F  S HLDA=+$O(^HL(772,"AH",+$P($G(HLNDAP0),U,12),HLMIDI,HLDA)) Q:'HLDA!($P($G(^HL(772,+HLDA,0)),U,4)=HLIO)
"RTN","HLTF",183,0)
 ;-- quit if no message
"RTN","HLTF",184,0)
 Q:'$D(^HL(772,+HLDA,0))
"RTN","HLTF",185,0)
 ;-- check for error
"RTN","HLTF",186,0)
 I $P(HLMSA,HLFS,4)]"" N HLERR S HLERR=$P(HLMSA,HLFS,4)
"RTN","HLTF",187,0)
 I $D(HLERR),'$D(HLMSG) N HLMSG S HLMSG="Error During Receipt of Acknowledgement Message"_$S(HLAC="AR":" - Application Reject",HLAC="AE":" - Application Error",1:"")_" - "_HLERR
"RTN","HLTF",188,0)
 ;-- update status
"RTN","HLTF",189,0)
 S HLAC=$S(HLMTN="MCF":2,HLAC'="AA":4,1:3)
"RTN","HLTF",190,0)
 D STATUS^HLTF0(HLDA,HLAC,$G(HLMSG))
"RTN","HLTF",191,0)
 Q
"RTN","HLTF",192,0)
 ;
"RTN","HLTF",193,0)
STUB772(FLD01,OS) ;
"RTN","HLTF",194,0)
 ;This function creates a new stub record in file 772. The Stub record may consist of only the 0 node with a value of "^". If a value is passed in for the .01 field it will be included in the 0 node and its "B" x-ref set.
"RTN","HLTF",195,0)
 ;Inputs:
"RTN","HLTF",196,0)
 ;  OS (optional), the value of ^%ZOSF("OS")
"RTN","HLTF",197,0)
 ;  FLD01 (optional), the value for the .01 field
"RTN","HLTF",198,0)
 ;Output - the function returns the ien of the newly created record
"RTN","HLTF",199,0)
 ;
"RTN","HLTF",200,0)
 N IEN
"RTN","HLTF",201,0)
 I '$L($G(OS)) N OS S OS=$G(^%ZOSF("OS"))
"RTN","HLTF",202,0)
 ;
"RTN","HLTF",203,0)
 ; patch HL*1.6*120, protect Else command
"RTN","HLTF",204,0)
 ; I OS'["DSM",OS'["OpenM" D
"RTN","HLTF",205,0)
 I OS'["DSM",OS'["OpenM" D  I 1
"RTN","HLTF",206,0)
 .F  L +^HLCS(869.3,1,772):10 S IEN=+$G(^HLCS(869.3,1,772))+1,^HLCS(869.3,1,772)=IEN S:$D(^HL(772,IEN)) IEN=0,^HLCS(869.3,1,772)=($O(^HL(772,":"),-1)\1) L -^HLCS(869.3,1,772) Q:IEN
"RTN","HLTF",207,0)
 E  D
"RTN","HLTF",208,0)
 .F  S IEN=$I(^HLCS(869.3,1,772),1) S:$D(^HL(772,IEN)) IEN=0,^HLCS(869.3,1,772)=($O(^HL(772,":"),-1)\1) Q:IEN
"RTN","HLTF",209,0)
 S ^HL(772,IEN,0)=$G(FLD01)_"^"
"RTN","HLTF",210,0)
 I $L($G(FLD01)) S ^HL(772,"B",FLD01,IEN)=""
"RTN","HLTF",211,0)
 Q IEN
"RTN","HLTF",212,0)
 ;
"RTN","HLTF",213,0)
STUB773(FLD01,OS) ;
"RTN","HLTF",214,0)
 ;This function creates a new stub record in file 772. The Stub record may consist of only the 0 node with a value of "^". If a value is passed in for the .01 field it will be included in the 0 node and its "B" x-ref set.
"RTN","HLTF",215,0)
 ;Inputs:
"RTN","HLTF",216,0)
 ;  OS (optional), the value of ^%ZOSF("OS")
"RTN","HLTF",217,0)
 ;  FLD01 (optional), the value for the .01 field
"RTN","HLTF",218,0)
 ;Output - the function returns the ien of the newly created record
"RTN","HLTF",219,0)
 ;
"RTN","HLTF",220,0)
 N IEN
"RTN","HLTF",221,0)
 I '$L($G(OS)) N OS S OS=$G(^%ZOSF("OS"))
"RTN","HLTF",222,0)
 ;
"RTN","HLTF",223,0)
 ; patch HL*1.6*120, protect Else command
"RTN","HLTF",224,0)
 ; I OS'["DSM",OS'["OpenM" D
"RTN","HLTF",225,0)
 I OS'["DSM",OS'["OpenM" D  I 1
"RTN","HLTF",226,0)
 .F  L +^HLCS(869.3,1,773):10 S IEN=+$G(^HLCS(869.3,1,773))+1,^HLCS(869.3,1,773)=IEN S:$D(^HLMA(IEN)) IEN=0,^HLCS(869.3,1,773)=($O(^HLMA(":"),-1)\1) L -^HLCS(869.3,1,773) Q:IEN
"RTN","HLTF",227,0)
 E  D
"RTN","HLTF",228,0)
 .F  S IEN=$I(^HLCS(869.3,1,773),1) S:$D(^HLMA(IEN)) IEN=0,^HLCS(869.3,1,773)=($O(^HLMA(":"),-1)\1) Q:IEN
"RTN","HLTF",229,0)
 S ^HLMA(IEN,0)=$G(FLD01)_"^"
"RTN","HLTF",230,0)
 I $L($G(FLD01)) S ^HLMA("B",FLD01,IEN)=""
"RTN","HLTF",231,0)
 Q IEN
"RTN","HLTP3")
0^9^B72235579^B58207834
"RTN","HLTP3",1,0)
HLTP3 ;SFIRMFO/RSD - Transaction Processor for TCP ;03/02/2006  13:29
"RTN","HLTP3",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,43,57,58,59,66,69,109,115,108,116,117,125,120**;Oct 13, 1995;Build 12
"RTN","HLTP3",3,0)
 ;
"RTN","HLTP3",4,0)
 Q
"RTN","HLTP3",5,0)
NEW(X) ;process new msg. ien in 773^msg. ien in 772
"RTN","HLTP3",6,0)
 ;HLMTIENS=ien in #773, msg header; HLMTIEN=ien in #772, msg text
"RTN","HLTP3",7,0)
 ;HLHDRO=original header;  HLHDR=response header
"RTN","HLTP3",8,0)
 ;set error trap
"RTN","HLTP3",9,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERROR^HLTP3"
"RTN","HLTP3",10,0)
 N HL,HLEID,HLEIDS,HLERR,HLHDR,HLHDRO,HLMTIEN,HLMTIENS,HLJ,HLMSA,HLQUIT,HLNODE,HLNEXT,HLRESLTA,HLDONE1,HLASTRSP
"RTN","HLTP3",11,0)
 D INIT^HLTP3A
"RTN","HLTP3",12,0)
 ;error with header, return commit/app reject
"RTN","HLTP3",13,0)
 I $G(HLRESLT) D  Q
"RTN","HLTP3",14,0)
 . ;set status & unlock record
"RTN","HLTP3",15,0)
 . D STATUS^HLTF0(HLMTIENS,4,,,1),EXIT
"RTN","HLTP3",16,0)
 . ;quit if no commit or app ack
"RTN","HLTP3",17,0)
 . I $G(HL("ACAT"))="NE",$G(HL("APAT"))="NE" Q
"RTN","HLTP3",18,0)
 . S X=$S($G(HL("ACAT"))="AL":"CR",1:"AR")
"RTN","HLTP3",19,0)
 . ;HLTCP=ien of acknowledgment msg. from ACK^HLTP4
"RTN","HLTP3",20,0)
 . D ACK^HLTP4(X,$P(HLRESLT,U,2)) Q:'$G(HLTCP)
"RTN","HLTP3",21,0)
 . ;write ack back over connection
"RTN","HLTP3",22,0)
 . S X=$$WRITE^HLCSTCP2(HLTCP)
"RTN","HLTP3",23,0)
 . ;update counter to sent
"RTN","HLTP3",24,0)
 . D LLCNT^HLCSTCP(HLDP,4)
"RTN","HLTP3",25,0)
 . ;update status of ack to complete
"RTN","HLTP3",26,0)
 . D STATUS^HLTF0(HLTCP,3,,,1)
"RTN","HLTP3",27,0)
 ;
"RTN","HLTP3",28,0)
 ;check for duplicate msg., use rec. app and msg. id x-ref
"RTN","HLTP3",29,0)
 ; patch HL*1.6*120
"RTN","HLTP3",30,0)
 ; I $L($G(HL("MID"))),$G(HL("RAP")) S X=$O(^HLMA("AH",HL("RAP"),HL("MID"),0)) D  Q:'$D(HLMTIENS)
"RTN","HLTP3",31,0)
 I $G(HL("MID"))]"",$G(HL("RAP")) S X=$O(^HLMA("AH",HL("RAP"),HL("MID"),0)) D  Q:'$D(HLMTIENS)
"RTN","HLTP3",32,0)
 . ;HLASTMSG=last ien received during this connection
"RTN","HLTP3",33,0)
 . ;if no duplicate, save msg. ien and quit
"RTN","HLTP3",34,0)
 . I X=HLMTIENS!'X S HLASTMSG=HLMTIENS Q
"RTN","HLTP3",35,0)
 . N MSH,OIENS
"RTN","HLTP3",36,0)
 . S (OIENS,Y)=X D  S Y=HLMTIENS D
"RTN","HLTP3",37,0)
 .. ;combine MSH into single string
"RTN","HLTP3",38,0)
 .. S MSH(Y)="",I=0 F  S I=$O(^HLMA(Y,"MSH",I)) Q:'I  S MSH(Y)=MSH(Y)_$G(^(I,0))
"RTN","HLTP3",39,0)
 .; patch 117 & 125, check if identical
"RTN","HLTP3",40,0)
 .I MSH(HLMTIENS)'=MSH(OIENS) S HLASTMSG=HLMTIENS Q
"RTN","HLTP3",41,0)
 .;
"RTN","HLTP3",42,0)
 . ;msg is duplicate, set status as duplicate
"RTN","HLTP3",43,0)
 . D STATUS^HLTF0(HLMTIENS,4,109,"Duplicate with ien "_OIENS,1),EXIT
"RTN","HLTP3",44,0)
 . ;msg was resent during this connection, ignore it.
"RTN","HLTP3",45,0)
 . I HLASTMSG=HLMTIENS K HLMTIENS Q
"RTN","HLTP3",46,0)
 . ;find original response and send back
"RTN","HLTP3",47,0)
 . S HLASTRSP=$O(^HLMA("AF",OIENS,OIENS))
"RTN","HLTP3",48,0)
 ;
"RTN","HLTP3",49,0)
 ;Quit if this is acknowledgment to acknowledgement message
"RTN","HLTP3",50,0)
 I $G(HL("ACK")) D  Q
"RTN","HLTP3",51,0)
 . ;Update status of original acknowledgment message to successfully
"RTN","HLTP3",52,0)
 . D STATUS^HLTF0(HL("MTIENS"),3,,,1),STATUS^HLTF0(HLMTIENS,3,,,1)
"RTN","HLTP3",53,0)
 . ;unlock record
"RTN","HLTP3",54,0)
 . D EXIT
"RTN","HLTP3",55,0)
 ;
"RTN","HLTP3",56,0)
 ;enhance ack., send commit, quit if not an ack, msg will be processed by filer
"RTN","HLTP3",57,0)
 I $G(HL("ACAT"))="AL" D  Q:'$G(HL("MTIENS"))
"RTN","HLTP3",58,0)
 . ;msg is a resend, HLASTRSP=ien of original response
"RTN","HLTP3",59,0)
 .I $G(HLASTRSP) D
"RTN","HLTP3",60,0)
 ..S HLTCP=HLASTRSP
"RTN","HLTP3",61,0)
 ..D LLCNT^HLCSTCP(HLDP,3)
"RTN","HLTP3",62,0)
 . E  D  Q:'$G(HLTCP)
"RTN","HLTP3",63,0)
 ..D ACK^HLTP4("CA") ;**109** LLCNT^HLCSTCP(HLDP,3) called in ACK^HLTP4
"RTN","HLTP3",64,0)
 . S X=$$WRITE^HLCSTCP2(HLTCP)
"RTN","HLTP3",65,0)
 . D LLCNT^HLCSTCP(HLDP,4),STATUS^HLTF0(HLTCP,3,,,1):'$G(HLASTRSP)
"RTN","HLTP3",66,0)
 . S HLTCP=""
"RTN","HLTP3",67,0)
 . ;if not an ack, set status to awaiting processing **109** and put on in queue
"RTN","HLTP3",68,0)
 . I '$G(HL("MTIENS")),'$G(HLASTRSP) D STATUS^HLTF0(HLMTIENS,9),EXIT,SETINQUE^HLTP31
"RTN","HLTP3",69,0)
 ;
"RTN","HLTP3",70,0)
 ;enhance ack., no commit & no app ack
"RTN","HLTP3",71,0)
 I $G(HL("ACAT"))="NE",$G(HL("APAT"))="NE" D  Q
"RTN","HLTP3",72,0)
 . ;set status to awaiting processing, **109** and put on in queue
"RTN","HLTP3",73,0)
 . I '$G(HLASTRSP) D STATUS^HLTF0(HLMTIENS,9),EXIT,SETINQUE^HLTP31
"RTN","HLTP3",74,0)
 ;
"RTN","HLTP3",75,0)
 ; patch HL*1.6*120 start
"RTN","HLTP3",76,0)
 ;resending old response, msg is a resend
"RTN","HLTP3",77,0)
 ; I $G(HLASTRSP) S HLTCP=HLASTRSP G ACK
"RTN","HLTP3",78,0)
 ; do not re-send duplicate message when $G(HL("ACAT"))="AL"
"RTN","HLTP3",79,0)
 I $G(HLASTRSP),$G(HL("ACAT"))'="AL" S HLTCP=HLASTRSP G ACK
"RTN","HLTP3",80,0)
 ; quit if duplicate
"RTN","HLTP3",81,0)
 Q:$G(HLASTRSP)
"RTN","HLTP3",82,0)
 ; patch HL*1.6*120 end
"RTN","HLTP3",83,0)
 ;
"RTN","HLTP3",84,0)
CONT ;continue processing an enhance ack msg. called from DEFACK
"RTN","HLTP3",85,0)
 ;Set special HL variables for processing rtn
"RTN","HLTP3",86,0)
 S HLQUIT=0,HLNODE="",HLNEXT="D HLNEXT^HLCSUTL"
"RTN","HLTP3",87,0)
 ;
"RTN","HLTP3",88,0)
 ; message is an acknowledgement, HLMSA=ack code^id^text
"RTN","HLTP3",89,0)
 I ($G(HLMSA)]"") D  Q
"RTN","HLTP3",90,0)
 . ;X=1 if ack ok, 0=reject of error
"RTN","HLTP3",91,0)
 . S X=$E(HLMSA,2)="A"
"RTN","HLTP3",92,0)
 . ;Update status of original subscriber message and remove it from the out-going queue
"RTN","HLTP3",93,0)
 . D STATUS^HLTF0(HL("MTIENS"),$S(X:3,1:4),"",$S(X:"",1:$P(HLMSA,HL("FS"),3)),1)
"RTN","HLTP3",94,0)
 . D DEQUE^HLCSREP($P($G(^HLMA(HL("MTIENS"),0)),"^",7),"O",HL("MTIENS"))
"RTN","HLTP3",95,0)
 . D
"RTN","HLTP3",96,0)
 .. N HLTCP ;New variable to update status in file #772.
"RTN","HLTP3",97,0)
 ..;
"RTN","HLTP3",98,0)
 ..;**108**
"RTN","HLTP3",99,0)
 .. N TEMP
"RTN","HLTP3",100,0)
 .. S TEMP=HLMTIENS
"RTN","HLTP3",101,0)
 .. N HLMTIENS
"RTN","HLTP3",102,0)
 .. S HLMTIENS=TEMP
"RTN","HLTP3",103,0)
 ..;**END 108**
"RTN","HLTP3",104,0)
 ..;
"RTN","HLTP3",105,0)
 .. D PROCACK^HLTP2(HLMTIEN,HL("EID"),.HLRESLT,.HL)
"RTN","HLTP3",106,0)
 . ;update status of incoming to complete & unlock
"RTN","HLTP3",107,0)
 . D STATUS^HLTF0(HLMTIENS,$S($G(HLRESLT):4,1:3),$S($G(HLRESLT):+$G(HLRESLT),1:""),$S($G(HLRESLT):$P(HLRESLT,U,2),1:""),1),EXIT
"RTN","HLTP3",108,0)
 ;
"RTN","HLTP3",109,0)
 ;get entry action, exit action and processing routine
"RTN","HLTP3",110,0)
 K HLHDR,HLLD0,HLLD1,HLMSA
"RTN","HLTP3",111,0)
 I HL("EIDS")="",$G(HLEIDS)]"" S HL("EIDS")=HLEIDS ;**CIRN**
"RTN","HLTP3",112,0)
 D EVENT^HLUTIL1(HL("EIDS"),"15,20,771",.HLN)
"RTN","HLTP3",113,0)
 S HLENROU=$G(HLN(20)),HLEXROU=$G(HLN(15)),HLPROU=$G(HLN(771))
"RTN","HLTP3",114,0)
 ;quit if no processing routine,update status and quit
"RTN","HLTP3",115,0)
 I HLPROU']"" S HLRESLT="10^"_$G(^HL(771.7,10,0)) D STATUS^HLTF0(HLMTIENS,3,,,1),EXIT Q
"RTN","HLTP3",116,0)
 ;HLORNOD=subscriber protocol for Fileman auditing, ien;global ref
"RTN","HLTP3",117,0)
 N HLORNODD S HLORNOD=HL("EIDS")_";ORD(101,"
"RTN","HLTP3",118,0)
 ;Execute entry action of client protocol
"RTN","HLTP3",119,0)
 X:HLENROU]"" HLENROU K HLENROU,HLDONE1
"RTN","HLTP3",120,0)
 ;
"RTN","HLTP3",121,0)
 ;Execute processing routine
"RTN","HLTP3",122,0)
 X HLPROU S HLRESLT=0 S:($D(HLERR)) HLRESLT="9^"_HLERR
"RTN","HLTP3",123,0)
 ;update status of incoming to complete & unlock
"RTN","HLTP3",124,0)
 D STATUS^HLTF0(HLMTIENS,$S(HLRESLT:4,1:3),$S(HLRESLT:+HLRESLT,1:""),$S(HLRESLT:$P(HLRESLT,U,2),1:""),1,$S($G(HLERR("SKIP_EVENT"))=1:1,1:0)),EXIT
"RTN","HLTP3",125,0)
 ;HLTCPO=link open, HLTCP=ien of acknowledgment msg. from GENACK
"RTN","HLTP3",126,0)
ACK I $G(HLTCPO),$G(HLTCP) D  Q
"RTN","HLTP3",127,0)
 . D LLCNT^HLCSTCP(HLDP,3)
"RTN","HLTP3",128,0)
 . ;write ack back over open tcp link
"RTN","HLTP3",129,0)
 . S X=$$WRITE^HLCSTCP2(HLTCP)
"RTN","HLTP3",130,0)
 . ;update status of ack to complete
"RTN","HLTP3",131,0)
 . D:'$G(HLASTRSP) STATUS^HLTF0(HLTCP,3,,,1)
"RTN","HLTP3",132,0)
 . D LLCNT^HLCSTCP(HLDP,4)
"RTN","HLTP3",133,0)
 Q
"RTN","HLTP3",134,0)
 ;
"RTN","HLTP3",135,0)
DEFACK(HLDP,X) ;process the deferred application ack, called from HLCSIN
"RTN","HLTP3",136,0)
 ;HLDP=logical link, X=ien in file 773
"RTN","HLTP3",137,0)
 ;
"RTN","HLTP3",138,0)
 ; patch HL*1.6*120 start
"RTN","HLTP3",139,0)
 ; clean variables except Kernel related variables
"RTN","HLTP3",140,0)
 D
"RTN","HLTP3",141,0)
 . ; protect variables defined in STARTIN^HLCSIN
"RTN","HLTP3",142,0)
 . N HLFLG,HLEXIT,HLPTRFLR
"RTN","HLTP3",143,0)
 . ; protect variables defined in DEFACK^HLCSIN
"RTN","HLTP3",144,0)
 . N HLXX,HLD0,HLPCT
"RTN","HLTP3",145,0)
 . ; protect input parameters of this sub-routine
"RTN","HLTP3",146,0)
 . N HLDP,X
"RTN","HLTP3",147,0)
 . D KILL^XUSCLEAN
"RTN","HLTP3",148,0)
 ; patch HL*1.6*120 end
"RTN","HLTP3",149,0)
 ;
"RTN","HLTP3",150,0)
 ;set error trap
"RTN","HLTP3",151,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERROR^HLTP3"
"RTN","HLTP3",152,0)
 N HLERR     ;patch HL*1.6*109
"RTN","HLTP3",153,0)
 Q:'$G(HLDP)!'$G(X)  Q:'$G(^HLMA(X,0))
"RTN","HLTP3",154,0)
 ;**109 START**
"RTN","HLTP3",155,0)
 Q:'$D(^HLMA("AC","I",HLDP,X))
"RTN","HLTP3",156,0)
 ;**109 END**
"RTN","HLTP3",157,0)
 ;
"RTN","HLTP3",158,0)
 N HL,HLA,HLD0,HLEID,HLEIDS,HLHDR,HLHDRO,HLMTIEN,HLMTIENS,HLJ,HLMSA,HLN,HLQUIT,HLNODE,HLNEXT,HLRESLT,HLRESLTA,HLTCP,HLXX,Z,HLDONE1
"RTN","HLTP3",159,0)
 ;setup variables
"RTN","HLTP3",160,0)
 S HLMTIENS=X,X=^HLMA(HLMTIENS,0),HLMTIEN=+$P(X,U),HL("MID")=$P(X,U,2),HL("MTIENS")=$P(X,U,10),HL("LL")=$P(X,U,7),HLTCP="",HL("Q")=""""""
"RTN","HLTP3",161,0)
 S HL("EIDS")=$P(X,U,8),HL("SAP")=$P(X,U,11),HL("RAP")=$P(X,U,12),HL("MTP")=$P(X,U,13),HL("ETP")=$P(X,U,14)
"RTN","HLTP3",162,0)
 S:$P(X,U,15) HL("MTP_ETP")=$P(X,U,15)
"RTN","HLTP3",163,0)
 S:HL("SAP") HL("SAN")=$P($G(^HL(771,HL("SAP"),0)),U) S:HL("RAP") HL("RAN")=$P($G(^HL(771,HL("RAP"),0)),U)
"RTN","HLTP3",164,0)
 S:HL("MTP") HL("MTN")=$P($G(^HL(771.2,HL("MTP"),0)),U) S:HL("ETP") HL("ETN")=$P($G(^HL(779.001,HL("ETP"),0)),U)
"RTN","HLTP3",165,0)
 S:$G(HL("MTP_ETP")) HL("MTN_ETN")=$P($G(^HL(779.005,HL("MTP_ETP"),0)),U)
"RTN","HLTP3",166,0)
 S HL("EID")=$P($G(^HL(772,HLMTIEN,0)),U,10)
"RTN","HLTP3",167,0)
 M HLHDRO=^HLMA(HLMTIENS,"MSH")
"RTN","HLTP3",168,0)
 ; if no header quit
"RTN","HLTP3",169,0)
 ;**109**
"RTN","HLTP3",170,0)
 ;I '$O(HLHDRO(0)) L -^HLMA(HLMTIENS) Q
"RTN","HLTP3",171,0)
 Q:'$O(HLHDRO(0))
"RTN","HLTP3",172,0)
 ;
"RTN","HLTP3",173,0)
 S HL("FS")=$E(HLHDRO(1,0),4),HL("ECH")=$$P^HLTPCK2(.HLHDRO,2),HL("SFN")=$$P^HLTPCK2(.HLHDRO,4),HL("RFN")=$$P^HLTPCK2(.HLHDRO,6),HL("DTM")=$$P^HLTPCK2(.HLHDRO,7)
"RTN","HLTP3",174,0)
 ;
"RTN","HLTP3",175,0)
 ; patch HL*1.6*109 start
"RTN","HLTP3",176,0)
 ; quit if ien of #772 is not defined
"RTN","HLTP3",177,0)
 Q:'HLMTIEN
"RTN","HLTP3",178,0)
 ; quit if field separator is not defined
"RTN","HLTP3",179,0)
 Q:HL("FS")=""
"RTN","HLTP3",180,0)
 ; patch HL*1.6*109 end
"RTN","HLTP3",181,0)
 ;
"RTN","HLTP3",182,0)
 S X=$$P^HLTPCK2(.HLHDRO,1)
"RTN","HLTP3",183,0)
 ;
"RTN","HLTP3",184,0)
 ; patch HL*1.6*120 start
"RTN","HLTP3",185,0)
 I X="MSH" D
"RTN","HLTP3",186,0)
 . S HL("PID")=$$P^HLTPCK2(.HLHDRO,11),HL("VER")=$$P^HLTPCK2(.HLHDRO,12),HL("APAT")=$$P^HLTPCK2(.HLHDRO,16),HL("CC")=$$P^HLTPCK2(.HLHDRO,17)
"RTN","HLTP3",187,0)
 . ;
"RTN","HLTP3",188,0)
 . ; 2nd component is Processing mode
"RTN","HLTP3",189,0)
 . S HL("PMOD")=$P(HL("PID"),$E(HL("ECH"),1),2)
"RTN","HLTP3",190,0)
 . ; first component is Processing id
"RTN","HLTP3",191,0)
 . S HL("PID")=$P(HL("PID"),$E(HL("ECH"),1))
"RTN","HLTP3",192,0)
 ;
"RTN","HLTP3",193,0)
 I X'="MSH" D
"RTN","HLTP3",194,0)
 . S X=$$P^HLTPCK2(.HLHDRO,9),Z=$E(HL("ECH")),HL("PID")=$P(X,Z,2),HL("VER")=$P(X,Z,4)
"RTN","HLTP3",195,0)
 . ;
"RTN","HLTP3",196,0)
 . ; original implementation incorrectly treats repetition separator as
"RTN","HLTP3",197,0)
 . ; subcomponent separator
"RTN","HLTP3",198,0)
 . I X[$E(HL("ECH"),2) S HL("SUB-COMPONENT")=$E(HL("ECH"),2)
"RTN","HLTP3",199,0)
 . ; if subcomponent separator is correctly applied
"RTN","HLTP3",200,0)
 . I X[$E(HL("ECH"),4) S HL("SUB-COMPONENT")=$E(HL("ECH"),4)
"RTN","HLTP3",201,0)
 . ;
"RTN","HLTP3",202,0)
 . I $D(HL("SUB-COMPONENT")),HL("PID")[HL("SUB-COMPONENT") D
"RTN","HLTP3",203,0)
 .. ; 2nd sub-component is Processing mode
"RTN","HLTP3",204,0)
 .. S HL("PMOD")=$P(HL("PID"),HL("SUB-COMPONENT"),2)
"RTN","HLTP3",205,0)
 .. ; first sub-component is Processing id
"RTN","HLTP3",206,0)
 .. S HL("PID")=$P(HL("PID"),HL("SUB-COMPONENT"))
"RTN","HLTP3",207,0)
 . ; patch HL*1.6*120 end
"RTN","HLTP3",208,0)
 . ;
"RTN","HLTP3",209,0)
 . Q:$$P^HLTPCK2(.HLHDRO,10)=""
"RTN","HLTP3",210,0)
 . ;HLMSA=ack code^id^text
"RTN","HLTP3",211,0)
 . S HLMSA=$P($$P^HLTPCK2(.HLHDRO,10),$E(HL("ECH")),1),$P(HLMSA,HL("FS"),2)=$$P^HLTPCK2(.HLHDRO,12),$P(HLMSA,HL("FS"),3)=$P($$P^HLTPCK2(.HLHDRO,10),$E(HL("ECH")),2),HL("MSAID")=$P(HLMSA,HL("FS"),2)
"RTN","HLTP3",212,0)
 ;
"RTN","HLTP3",213,0)
 ; HL*1.6*108
"RTN","HLTP3",214,0)
 ; quit if this is a commit ack
"RTN","HLTP3",215,0)
 I $P($G(^HL(772,HLMTIEN,"IN",1,0)),HL("FS"),1)="MSA",$E($P($G(^HL(772,HLMTIEN,"IN",1,0)),HL("FS"),2))="C" Q
"RTN","HLTP3",216,0)
 ; ** 
"RTN","HLTP3",217,0)
 ;
"RTN","HLTP3",218,0)
 ;**  HL*1.6*117 **
"RTN","HLTP3",219,0)
 K HLL("SET FOR APP ACK"),HLL("LINKS")
"RTN","HLTP3",220,0)
 ;** END HL*1.6*117 **
"RTN","HLTP3",221,0)
 ;
"RTN","HLTP3",222,0)
 D CONT
"RTN","HLTP3",223,0)
 Q
"RTN","HLTP3",224,0)
 ;
"RTN","HLTP3",225,0)
MSA(Y) ;Y=ien in 772, returns MSA segment
"RTN","HLTP3",226,0)
 ;ack code^msg being ack id^text
"RTN","HLTP3",227,0)
 N X
"RTN","HLTP3",228,0)
 S X=$G(^HL(772,Y,"IN",1,0)),X=$S($E(X,1,3)="MSA":$E(X,5,999),1:"")
"RTN","HLTP3",229,0)
 Q X
"RTN","HLTP3",230,0)
 ;
"RTN","HLTP3",231,0)
ERROR ;error trap
"RTN","HLTP3",232,0)
 D ^%ZTER
"RTN","HLTP3",233,0)
 I $G(HLMTIENS),$D(^HLMA(HLMTIENS,0)) D STATUS^HLTF0(HLMTIENS,4,,,1),EXIT
"RTN","HLTP3",234,0)
 ;*109* release all locks created by inbound filer
"RTN","HLTP3",235,0)
 L -^HLMA("AC","I",+$G(HLXX))
"RTN","HLTP3",236,0)
 G UNWIND^%ZTER
"RTN","HLTP3",237,0)
 ;
"RTN","HLTP3",238,0)
 ;
"RTN","HLTP3",239,0)
EXIT ;unlock
"RTN","HLTP3",240,0)
 I $G(HLMTIENS) L -^HLMA(HLMTIENS)
"RTN","HLTP3",241,0)
 Q
"RTN","HLTP3",242,0)
 ;
"RTN","HLTP3",243,0)
ONAC(IEN773) ;
"RTN","HLTP3",244,0)
 ;Returns 1 if the message is on the "AC","I" xref
"RTN","HLTP3",245,0)
 ;Returns 0 otherwise
"RTN","HLTP3",246,0)
 ;
"RTN","HLTP3",247,0)
 N LINK
"RTN","HLTP3",248,0)
 S LINK=$P($G(^HLMA(IEN773,0)),"^",17)
"RTN","HLTP3",249,0)
 Q:'LINK 0
"RTN","HLTP3",250,0)
 Q $D(^HLMA("AC","I",LINK,IEN773))
"RTN","HLTP31")
0^10^B13120490^B7900636
"RTN","HLTP31",1,0)
HLTP31 ;SFIRMFO/RSD - Cont. Transaction Processor for TCP ;01/26/2006  15:50
"RTN","HLTP31",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**57,58,66,109,120**;Oct 13, 1995;Build 12
"RTN","HLTP31",3,0)
 ;
"RTN","HLTP31",4,0)
 Q
"RTN","HLTP31",5,0)
RSP(X,HLN) ;process response msg. X=ien in 773^msg. ien in 772
"RTN","HLTP31",6,0)
 ;HLN=HL array for original message
"RTN","HLTP31",7,0)
 ;HLMTIEN=ien in 772,  HLMTIENS=ien in 773
"RTN","HLTP31",8,0)
 ;returns - 0=resend msg, 1=commit ack, 3=app ack success, 4=error
"RTN","HLTP31",9,0)
 ;set error trap
"RTN","HLTP31",10,0)
 N $ETRAP,$ESTACK S $ETRAP="D ERROR^HLTP3"
"RTN","HLTP31",11,0)
 N HLERR,HLHDR,HLMSA,HLMTIEN,HLMTIENS,HLQUIT,HLNODE,HLNEXT,HLRESLTA
"RTN","HLTP31",12,0)
 D INIT^HLTP3A  ;patch HL*1.6*109: hltp3 routine split
"RTN","HLTP31",13,0)
 ;Quit processing if error with header
"RTN","HLTP31",14,0)
 I $G(HLRESLT) D EXIT Q 0
"RTN","HLTP31",15,0)
 ;must have MSA segment
"RTN","HLTP31",16,0)
 I '$L(HLMSA) D RSPER(4,108,"Missing MSA segment") Q 0
"RTN","HLTP31",17,0)
 ;msg. id in MSA must match original msg. id, if not reject
"RTN","HLTP31",18,0)
 I $P(HLMSA,HL("FS"),2)'=HLN("MID") D RSPER(4,108,"Incorrect msg. Id") Q 0
"RTN","HLTP31",19,0)
 ;rec. app. must match sending app. of original message.
"RTN","HLTP31",20,0)
 I HL("RAN")'=HLN("SAN") D RSPER(4,108,"Incorrect sending app.") Q 0
"RTN","HLTP31",21,0)
 ;get ack code
"RTN","HLTP31",22,0)
 S HL("ACKCD")=$P(HLMSA,HL("FS"))
"RTN","HLTP31",23,0)
 ;update LL, rec. 1 msg
"RTN","HLTP31",24,0)
 D LLCNT^HLCSTCP(HLDP,1)
"RTN","HLTP31",25,0)
 ;commit ack
"RTN","HLTP31",26,0)
 I $E(HL("ACKCD"))="C" D  Q X
"RTN","HLTP31",27,0)
 . ;update LL, processed 1 msg
"RTN","HLTP31",28,0)
 . D LLCNT^HLCSTCP(HLDP,2)
"RTN","HLTP31",29,0)
 . ;received an error ack, return NAK
"RTN","HLTP31",30,0)
 . S:$E(HL("ACKCD"),2)'="A" HLRESLT=102_U_$P(HLMSA,HL("FS"),3)
"RTN","HLTP31",31,0)
 . D RSPER(3) S X=$S($E(HL("ACKCD"),2)="A":1,1:4)
"RTN","HLTP31",32,0)
 ;app. ack, received an error ack, NAK
"RTN","HLTP31",33,0)
 S:$E(HL("ACKCD"),2)'="A" HLRESLT=102_U_$P(HLMSA,HL("FS"),3)
"RTN","HLTP31",34,0)
 ;Set special HL variables
"RTN","HLTP31",35,0)
 S HLQUIT=0,HLNODE="",HLNEXT="D HLNEXT^HLCSUTL"
"RTN","HLTP31",36,0)
 ;HLORNOD=subscriber protocol for Fileman auditing, ien;global ref
"RTN","HLTP31",37,0)
 N HLORNODD S HLORNOD=HL("EIDS")_";ORD(101,"
"RTN","HLTP31",38,0)
 ;process ack
"RTN","HLTP31",39,0)
 D
"RTN","HLTP31",40,0)
 . N HLTCP ;Newed variable to update status in 772.
"RTN","HLTP31",41,0)
 . D PROCACK^HLTP2(HLMTIEN,HL("EID"),.HLRESLT,.HL)
"RTN","HLTP31",42,0)
 ;update LL, processed 1 msg
"RTN","HLTP31",43,0)
 D LLCNT^HLCSTCP(HLDP,2)
"RTN","HLTP31",44,0)
 ;process ack successfully
"RTN","HLTP31",45,0)
 D RSPER(3)
"RTN","HLTP31",46,0)
 ;HLRESELT is defined for errors
"RTN","HLTP31",47,0)
 Q $S($G(HLRESLT):4,1:3)
"RTN","HLTP31",48,0)
 ;
"RTN","HLTP31",49,0)
RSPER(HLST,HLER,HLERM) ;HLST=status, HLER=error type, HLERM=error msg.
"RTN","HLTP31",50,0)
 D STATUS^HLTF0(HLMTIENS,HLST,$G(HLER),$G(HLERM),1)
"RTN","HLTP31",51,0)
 S:$G(HLER) HLRESLT=HLER_U_HLERM
"RTN","HLTP31",52,0)
 D EXIT
"RTN","HLTP31",53,0)
 Q
"RTN","HLTP31",54,0)
EXIT ;unlock
"RTN","HLTP31",55,0)
 ;**109**
"RTN","HLTP31",56,0)
 ;I $G(HLMTIENS) L -^HLMA(HLMTIENS)
"RTN","HLTP31",57,0)
 Q
"RTN","HLTP31",58,0)
 ;
"RTN","HLTP31",59,0)
SETINQUE ;
"RTN","HLTP31",60,0)
 ;**HL*1.6*109***
"RTN","HLTP31",61,0)
 ;Called from HLTP3 for message that utilize enhanced mode - NOT original mode
"RTN","HLTP31",62,0)
 ;Sets the incoming message on the in queue.
"RTN","HLTP31",63,0)
 ;Does not use the listener, instead, arranges multiple in-queues
"RTN","HLTP31",64,0)
 ;by using the sending link.
"RTN","HLTP31",65,0)
 ;
"RTN","HLTP31",66,0)
 N HLI,HLINST,HLDOMAIN,HLLINK
"RTN","HLTP31",67,0)
 ;
"RTN","HLTP31",68,0)
 ;Override value of logical link based on sending facility to create
"RTN","HLTP31",69,0)
 ;a queue (^HLMA("AC","I",llnk ien,msg ien)) different than that of the 
"RTN","HLTP31",70,0)
 ;listener
"RTN","HLTP31",71,0)
 S HLINST=$P(HL("SFN"),$E(HL("ECH")))
"RTN","HLTP31",72,0)
 S HLDOMAIN=$P(HL("SFN"),$E(HL("ECH")),2)
"RTN","HLTP31",73,0)
 ;
"RTN","HLTP31",74,0)
 ; patch HL*1.6*120 start
"RTN","HLTP31",75,0)
 ; assume the format is <domain>:<port #>
"RTN","HLTP31",76,0)
 I HLDOMAIN[":" S HL("PORT")=$P(HLDOMAIN,":",2)
"RTN","HLTP31",77,0)
 S HLDOMAIN=$P(HLDOMAIN,":")
"RTN","HLTP31",78,0)
 S HL("DOMAIN")=HLDOMAIN
"RTN","HLTP31",79,0)
 ; change from lower case to upper case
"RTN","HLTP31",80,0)
 S HLDOMAIN=$$UP^XLFSTR(HLDOMAIN)
"RTN","HLTP31",81,0)
 ; if first piece of domain is "HL7." or "MPI.", remove it
"RTN","HLTP31",82,0)
 I ($E(HLDOMAIN,1,4)="HL7.")!($E(HLDOMAIN,1,4)="MPI.") D
"RTN","HLTP31",83,0)
 . S HLDOMAIN=$P(HLDOMAIN,".",2,99)
"RTN","HLTP31",84,0)
 ; patch HL*1.6*120 end
"RTN","HLTP31",85,0)
 ;
"RTN","HLTP31",86,0)
 I HLDOMAIN]"" D    ;logical link lookup by domain
"RTN","HLTP31",87,0)
 . D LINK^HLUTIL3(HLDOMAIN,.HLI,"D")
"RTN","HLTP31",88,0)
 . S HLLINK=$O(HLI(0)) ;client link for sending facility
"RTN","HLTP31",89,0)
 ;logical link lookup by station number
"RTN","HLTP31",90,0)
 I $G(HLLINK)']"",HLINST]"" D
"RTN","HLTP31",91,0)
 . D LINK^HLUTIL3(HLINST,.HLI,"I")
"RTN","HLTP31",92,0)
 . S HLLINK=$O(HLI(0)) ;client link for sending facility
"RTN","HLTP31",93,0)
 ;
"RTN","HLTP31",94,0)
 ; patch HL*1.6*120 start
"RTN","HLTP31",95,0)
 ;logical link lookup by DNS domain
"RTN","HLTP31",96,0)
 I $G(HLLINK)']"",HL("DOMAIN")]"" D
"RTN","HLTP31",97,0)
 . I $D(^HLCS(870,"DNS",HL("DOMAIN"))) D  Q
"RTN","HLTP31",98,0)
 .. S HLLINK=+$O(^HLCS(870,"DNS",HL("DOMAIN"),0))
"RTN","HLTP31",99,0)
 . I $D(^HLCS(870,"DNS",$$UP^XLFSTR(HL("DOMAIN")))) D  Q
"RTN","HLTP31",100,0)
 .. S HLLINK=+$O(^HLCS(870,"DNS",$$UP^XLFSTR(HL("DOMAIN")),0))
"RTN","HLTP31",101,0)
 . I $D(^HLCS(870,"DNS",$$LOW^XLFSTR(HL("DOMAIN")))) D
"RTN","HLTP31",102,0)
 .. S HLLINK=+$O(^HLCS(870,"DNS",$$LOW^XLFSTR(HL("DOMAIN")),0))
"RTN","HLTP31",103,0)
 ;
"RTN","HLTP31",104,0)
 ;logical link lookup by ip address
"RTN","HLTP31",105,0)
 I $G(HLLINK)']"",HL("DOMAIN") D
"RTN","HLTP31",106,0)
 . S HLLINK=$O(^HLCS(870,"IP",HL("DOMAIN"),0))
"RTN","HLTP31",107,0)
 ; patch HL*1.6*120 end
"RTN","HLTP31",108,0)
 ;
"RTN","HLTP31",109,0)
 ; find the logical link of the subscriber protocol
"RTN","HLTP31",110,0)
 ; then set the link field of this message to the link
"RTN","HLTP31",111,0)
 I $G(HL("EIDS")),$P(^ORD(101,HL("EIDS"),770),"^",7) S HLLINK=$P(^ORD(101,HL("EIDS"),770),"^",7)
"RTN","HLTP31",112,0)
 ;
"RTN","HLTP31",113,0)
 I $L($G(HLLINK)) D
"RTN","HLTP31",114,0)
 .D ENQUE^HLCSREP(HLLINK,"I",HLMTIENS)
"RTN","HLTP31",115,0)
 E  D
"RTN","HLTP31",116,0)
 .D ENQUE^HLCSREP(HLDP,"I",HLMTIENS)
"RTN","HLTP31",117,0)
 Q
"RTN","HLTP4")
0^11^B45154182^B32742130
"RTN","HLTP4",1,0)
HLTP4 ;SFIRMFO/RSD - Transaction Processor for TCP ;01/26/2006  14:06
"RTN","HLTP4",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,57,59,91,109,116,117,125,120**;Oct 13, 1995;Build 12
"RTN","HLTP4",3,0)
GENACK ;called from HLMA1
"RTN","HLTP4",4,0)
 ;Entry point to generate an acknowledgement message
"RTN","HLTP4",5,0)
 ;for TCP
"RTN","HLTP4",6,0)
 ;INPUT:
"RTN","HLTP4",7,0)
 ;   HLMTIENS=original msg. ien #773
"RTN","HLTP4",8,0)
 ;   HLEID=original msg. event protocol
"RTN","HLTP4",9,0)
 ;   HLEIDS=original msg. subscriber protocol
"RTN","HLTP4",10,0)
 ;   HLMTIENA=ien of ack in 772, for batch only
"RTN","HLTP4",11,0)
 ;   Note:  if the HLP(...) array exists, it will be "honored" by
"RTN","HLTP4",12,0)
 ;          UPDATE^HLTF0 below. This includes the HLP("NAMESPACE")
"RTN","HLTP4",13,0)
 ;          variable. - HL*1.6*91
"RTN","HLTP4",14,0)
 ;
"RTN","HLTP4",15,0)
 ;OUTPUT: HLTCP=ien of response
"RTN","HLTP4",16,0)
 N HLDT,HLDT1,HLQ,HLOGLINK,HLMIDA,HLMTIEN,HLREC,HLSAN,HLTYPE,X
"RTN","HLTP4",17,0)
 ;Extract data from original message and store in separate variables
"RTN","HLTP4",18,0)
 ;reverse sending and receiving application from original msg.
"RTN","HLTP4",19,0)
 S X=$G(^HLMA(HLMTIENS,0)),HLREC=$P(X,U,11),HLSAN=$P(X,U,12),HLOGLINK=$G(HLTCPO)
"RTN","HLTP4",20,0)
 ;HLMTIENA defined, create msg in 773
"RTN","HLTP4",21,0)
 I $G(HLMTIENA) S HLDT=+$G(^HL(772,HLMTIENA,0)),HLMTIENA=$$MA^HLTF(HLMTIENA,.HLMIDA)
"RTN","HLTP4",22,0)
 ;create message in 772 & 773, HLMTIENA=new msg ien #773
"RTN","HLTP4",23,0)
 I '$G(HLMTIENA) D TCP^HLTF(.HLMIDA,.HLMTIENA,.HLDT)
"RTN","HLTP4",24,0)
 ;
"RTN","HLTP4",25,0)
 ;**109**
"RTN","HLTP4",26,0)
 ;lock new record
"RTN","HLTP4",27,0)
 ;F  L +^HLMA(HLMTIENA):1 Q:$T  H 1
"RTN","HLTP4",28,0)
 ;
"RTN","HLTP4",29,0)
 ;HLMTIEN=ien in 772
"RTN","HLTP4",30,0)
 S HLTCP=HLMTIENA,HLMTIEN=+^HLMA(HLMTIENA,0),HLDT1=$$HLDATE^HLFNC(HLDT),(HLTYPE,HLP("MSGTYPE"))=$E(HLARYTYP,2)
"RTN","HLTP4",31,0)
 ;
"RTN","HLTP4",32,0)
 ;**** HL*1.6*116 ****
"RTN","HLTP4",33,0)
 ;no open link, check dynamic routing of ack
"RTN","HLTP4",34,0)
 S X=$G(^ORD(101,HLEIDS,770)),HLP("MTYPE")=$P(X,U,11),HLP("EVENT")=$P(X,U,4)
"RTN","HLTP4",35,0)
 ;
"RTN","HLTP4",36,0)
 ; patch HL*1.6*125- change from $G to $D
"RTN","HLTP4",37,0)
 I '$D(HLL("SET FOR APP ACK")) D  Q:'HLOGLINK
"RTN","HLTP4",38,0)
 .K HLL("LINKS")
"RTN","HLTP4",39,0)
 .I 'HLOGLINK D
"RTN","HLTP4",40,0)
 .. S HLOGLINK=$P(X,U,7)
"RTN","HLTP4",41,0)
 .. Q:HLOGLINK
"RTN","HLTP4",42,0)
 .. N DOMAIN,SFAC,MSH,FS,CS,HLI,INST
"RTN","HLTP4",43,0)
 .. S MSH=$G(^HLMA(HLMTIENS,"MSH",1,0))
"RTN","HLTP4",44,0)
 .. Q:'$L(MSH)
"RTN","HLTP4",45,0)
 .. S FS=$E(MSH,4)
"RTN","HLTP4",46,0)
 .. Q:'$L(FS)
"RTN","HLTP4",47,0)
 .. S CS=$E(MSH,5)
"RTN","HLTP4",48,0)
 .. Q:'$L(CS)
"RTN","HLTP4",49,0)
 .. S DOMAIN=$P($P(MSH,FS,4),CS,2)
"RTN","HLTP4",50,0)
 .. ;
"RTN","HLTP4",51,0)
 .. ; patch HL*1.6*120 start
"RTN","HLTP4",52,0)
 .. ; assume the format is <domain>:<port #>
"RTN","HLTP4",53,0)
 .. I DOMAIN[":" S HLP("PORT")=$P(DOMAIN,":",2)
"RTN","HLTP4",54,0)
 .. S DOMAIN=$P(DOMAIN,":")
"RTN","HLTP4",55,0)
 .. S HLP("DNS-DOMAIN")=DOMAIN
"RTN","HLTP4",56,0)
 .. ;
"RTN","HLTP4",57,0)
 .. ; if first piece of domain is "HL7." or "MPI.", remove it
"RTN","HLTP4",58,0)
 .. I ($E(DOMAIN,1,4)="HL7.")!($E(DOMAIN,1,4)="MPI.") D
"RTN","HLTP4",59,0)
 ... S DOMAIN=$P(DOMAIN,".",2,99)
"RTN","HLTP4",60,0)
 .. ;
"RTN","HLTP4",61,0)
 .. ; lookup Mailman domain
"RTN","HLTP4",62,0)
 .. I $L(DOMAIN) D
"RTN","HLTP4",63,0)
 ... D LINK^HLUTIL3(DOMAIN,.HLI,"D")
"RTN","HLTP4",64,0)
 ... S HLOGLINK=$O(HLI(0))
"RTN","HLTP4",65,0)
 .. Q:HLOGLINK
"RTN","HLTP4",66,0)
 .. S INST=$P($P(MSH,FS,4),CS,1)
"RTN","HLTP4",67,0)
 .. I $L(INST) D
"RTN","HLTP4",68,0)
 .. .D LINK^HLUTIL3(INST,.HLI,"I")
"RTN","HLTP4",69,0)
 ... S HLOGLINK=$O(HLI(0))
"RTN","HLTP4",70,0)
 .. Q:HLOGLINK
"RTN","HLTP4",71,0)
 .. ;
"RTN","HLTP4",72,0)
 .. ; check DNS domain and ip address
"RTN","HLTP4",73,0)
 .. I $L(HLP("DNS-DOMAIN")) D
"RTN","HLTP4",74,0)
 ... ;
"RTN","HLTP4",75,0)
 ... ; match DNS domain
"RTN","HLTP4",76,0)
 ... I $D(^HLCS(870,"DNS",HLP("DNS-DOMAIN"))) D
"RTN","HLTP4",77,0)
 .... S HLOGLINK=+$O(^HLCS(870,"DNS",HLP("DNS-DOMAIN"),0))
"RTN","HLTP4",78,0)
 ... Q:HLOGLINK
"RTN","HLTP4",79,0)
 ... ;
"RTN","HLTP4",80,0)
 ... I $D(^HLCS(870,"DNS",$$UP^XLFSTR(HLP("DNS-DOMAIN")))) D
"RTN","HLTP4",81,0)
 .... S HLOGLINK=+$O(^HLCS(870,"DNS",$$UP^XLFSTR(HLP("DNS-DOMAIN")),0))
"RTN","HLTP4",82,0)
 ... Q:HLOGLINK
"RTN","HLTP4",83,0)
 ... ;
"RTN","HLTP4",84,0)
 ... I $D(^HLCS(870,"DNS",$$LOW^XLFSTR(HLP("DNS-DOMAIN")))) D
"RTN","HLTP4",85,0)
 .... S HLOGLINK=+$O(^HLCS(870,"DNS",$$LOW^XLFSTR(HLP("DNS-DOMAIN")),0))
"RTN","HLTP4",86,0)
 ... Q:HLOGLINK
"RTN","HLTP4",87,0)
 ... ;
"RTN","HLTP4",88,0)
 ... ; match ip address
"RTN","HLTP4",89,0)
 ... I $D(^HLCS(870,"IP",HLP("DNS-DOMAIN"))) D
"RTN","HLTP4",90,0)
 .... S HLOGLINK=+$O(^HLCS(870,"IP",HLP("DNS-DOMAIN"),0))
"RTN","HLTP4",91,0)
 .. ;
"RTN","HLTP4",92,0)
 ; patch HL*1.6*116 and patch HL*1.6*120 end
"RTN","HLTP4",93,0)
 ;
"RTN","HLTP4",94,0)
 ;** HL*1.6*117 **
"RTN","HLTP4",95,0)
 ; patch HL*1.6*125- change from $G to $D
"RTN","HLTP4",96,0)
 I $D(HLL("SET FOR APP ACK")) D  Q:'HLOGLINK
"RTN","HLTP4",97,0)
 .N I
"RTN","HLTP4",98,0)
 .S I=$O(HLL("LINKS",0))
"RTN","HLTP4",99,0)
 .I 'I S HLOGLINK="" Q
"RTN","HLTP4",100,0)
 .S HLOGLINK=$P(HLL("LINKS",I),"^",2) Q:HLOGLINK=""
"RTN","HLTP4",101,0)
 .I +HLOGLINK'=HLOGLINK S HLOGLINK=$O(^HLCS(870,"B",HLOGLINK,0))
"RTN","HLTP4",102,0)
 ;**END HL*1.6*117 **
"RTN","HLTP4",103,0)
 ;
"RTN","HLTP4",104,0)
 S:$P(X,U,5) HLP("MTYPE_EVENT")=$P(X,U,5)
"RTN","HLTP4",105,0)
 ;HLTCPI=initial message
"RTN","HLTP4",106,0)
 S:$G(HLTCPI) HLP("HLTCPI")=HLTCPI
"RTN","HLTP4",107,0)
 ;Update zero node of Message Admin file #773
"RTN","HLTP4",108,0)
 D UPDATE^HLTF0(HLTCP,,"O",HLEIDS,HLREC,HLSAN,"I",HLMTIENS,HLOGLINK,.HLP)
"RTN","HLTP4",109,0)
 ;
"RTN","HLTP4",110,0)
 ;Update status to Being Generated
"RTN","HLTP4",111,0)
 D STATUS^HLTF0(HLTCP,8)
"RTN","HLTP4",112,0)
 ;
"RTN","HLTP4",113,0)
 ;**109**
"RTN","HLTP4",114,0)
 ;tcp link is open, don't need x-ref, msg will be sent over link
"RTN","HLTP4",115,0)
 ;I $G(HLTCPO) K ^HLMA("AC","O",HLOGLINK,HLTCP)
"RTN","HLTP4",116,0)
 ;
"RTN","HLTP4",117,0)
 ;update zero node of Message Text file #772
"RTN","HLTP4",118,0)
 D
"RTN","HLTP4",119,0)
 . N HLTCP D UPDATE^HLTF0(HLMTIEN,,"O",HLEID)
"RTN","HLTP4",120,0)
 ;
"RTN","HLTP4",121,0)
 ;Execute entry action for subscriber protocol
"RTN","HLTP4",122,0)
 I HLENROU]"" X HLENROU
"RTN","HLTP4",123,0)
 S HLQ=""""
"RTN","HLTP4",124,0)
 ;Check that local/global array exists and store in Message Text file
"RTN","HLTP4",125,0)
 ; if pre-compiled
"RTN","HLTP4",126,0)
 I HLFORMAT D  I (+$G(HLRESLTA)) D STATUS^HLTF0(HLMTIENA,4,+HLRESLTA) G ERR
"RTN","HLTP4",127,0)
 . I $E(HLARYTYP)="G" D
"RTN","HLTP4",128,0)
 .. I $O(^TMP("HLA",$J,0))']"" S HLRESLTA="8^"_$G(^HL(771.7,8,0)) Q
"RTN","HLTP4",129,0)
 .. D MERGE^HLTF1("G",HLMTIEN,"HLA")
"RTN","HLTP4",130,0)
 . I $E(HLARYTYP)="L" D
"RTN","HLTP4",131,0)
 .. I $O(HLA("HLA",0))']"" S HLRESLTA="8^"_$G(^HL(771.7,8,0)) Q
"RTN","HLTP4",132,0)
 .. D MERGE^HLTF1("L",HLMTIEN,"HLA")
"RTN","HLTP4",133,0)
 ;If array is not pre-compiled, call message generation routine
"RTN","HLTP4",134,0)
 I 'HLFORMAT N HLERR D  I $D(HLERR) S HLRESLTA="9^"_HLERR D STATUS^HLTF0(HLMTIENA,4,9,HLERR) G ERR
"RTN","HLTP4",135,0)
 .S HLP("GROUTINE")=HLP("GROUTINE")_"("_HLMIDA_","_HLMTIENA_","_HLQ_HLARYTYP_HLQ_","_HLSAN_","_$P($G(^HL(771.2,$P(HLN(770),"^",3),0)),"^")_","_$P($G(^HL(779.001,$P(HLN(770),"^",4),0)),"^")_","_HLQ_$TR($P(HLN(770),"^",6),"id","ID")_HLQ_")"
"RTN","HLTP4",136,0)
 .X HLP("GROUTINE")
"RTN","HLTP4",137,0)
 ;
"RTN","HLTP4",138,0)
 ;create header for message in 773
"RTN","HLTP4",139,0)
 I (HLTYPE="M") D HEADER^HLCSHDR1(HLTCP,HLREC,.HLRESLT)
"RTN","HLTP4",140,0)
 I (HLTYPE'="M") D BHSHDR^HLCSHDR1(HLTCP,HLREC,.HLRESLT)
"RTN","HLTP4",141,0)
 ;if error set status to ERROR DURING TRANSMISSION
"RTN","HLTP4",142,0)
 I ($G(HLRESLT)'="") D STATUS^HLTF0(HLTCP,4,12,HLRESLT) G ERR
"RTN","HLTP4",143,0)
 ;set header, HLHDR in 773
"RTN","HLTP4",144,0)
 K HLQ S X=HLTCP_",",HLQ(773,X,200)="HLHDR"
"RTN","HLTP4",145,0)
 D FILE^HLDIE("","HLQ","","GENACK","HLTP4") ;HL*1.6*109
"RTN","HLTP4",146,0)
 ;D FILE^DIE("","HLQ")
"RTN","HLTP4",147,0)
 ;update status of 773 to PENDING TRANSMISSION
"RTN","HLTP4",148,0)
 D STATUS^HLTF0(HLTCP,1)
"RTN","HLTP4",149,0)
 ;Execute exit action for subscriber protocol
"RTN","HLTP4",150,0)
 X:HLEXROU]"" HLEXROU
"RTN","HLTP4",151,0)
 ;
"RTN","HLTP4",152,0)
 ;**109**
"RTN","HLTP4",153,0)
 ;tcp link is NOT open, need x-ref
"RTN","HLTP4",154,0)
 I '$G(HLTCPO) D ENQUE^HLCSREP(HLOGLINK,"O",HLTCP)
"RTN","HLTP4",155,0)
 ;
"RTN","HLTP4",156,0)
EXIT ;**109**
"RTN","HLTP4",157,0)
 ;L -^HLMA(HLMTIENA)
"RTN","HLTP4",158,0)
 Q
"RTN","HLTP4",159,0)
ERR D EXIT S HLTCP=""
"RTN","HLTP4",160,0)
 S:$G(HLRESLT) HLRESLTA=$G(HLRESLTA)_"^"_HLRESLT
"RTN","HLTP4",161,0)
 Q
"RTN","HLTP4",162,0)
ACK(HLTACK,HLMG) ;build response based on original msg header
"RTN","HLTP4",163,0)
 ;for Bi-directional TCP
"RTN","HLTP4",164,0)
 ;INPUT:
"RTN","HLTP4",165,0)
 ;   HLTACK=type of ack. CA,CR, or AR
"RTN","HLTP4",166,0)
 ;   HLMG=text for MSA segment
"RTN","HLTP4",167,0)
 ;   HLMTIENS=original msg. ien #773
"RTN","HLTP4",168,0)
 ;   HL(array) from original header
"RTN","HLTP4",169,0)
 ;RETURNS:  HLTCP=ien of response msg. in 773
"RTN","HLTP4",170,0)
 N HLDT,HLDT1,HLQ,HLFS,HLHDR,HLMIDA,HLMTIEN,HLMTIENA,HLP,HLREC,HLSAN,X
"RTN","HLTP4",171,0)
 ;quit if we don't have enough to make a msg.
"RTN","HLTP4",172,0)
 I $G(HL("ECH"))=""!($G(HL("FS"))="")!($G(HL("TYPE"))="") Q
"RTN","HLTP4",173,0)
 ;Extract data from original message and store in separate variables
"RTN","HLTP4",174,0)
 ;reverse sending and receiving application from original msg.
"RTN","HLTP4",175,0)
 S HLFS=HL("FS"),HLREC=$G(HL("SAN")),HLSAN=$G(HL("RAN"))
"RTN","HLTP4",176,0)
 ;create message in 772 & 773, HLMTIENA=new msg ien #773
"RTN","HLTP4",177,0)
 D TCP^HLTF(.HLMIDA,.HLMTIENA,.HLDT)
"RTN","HLTP4",178,0)
 ;lock new record
"RTN","HLTP4",179,0)
 ;**109**
"RTN","HLTP4",180,0)
 ;F  L +^HLMA(HLMTIENA):1 Q:$T  H 1
"RTN","HLTP4",181,0)
 ;
"RTN","HLTP4",182,0)
 ;HLMTIEN=ien in 772
"RTN","HLTP4",183,0)
 S HLTCP=HLMTIENA,HLMTIEN=+^HLMA(HLMTIENA,0),HLDT1=$$FMTHL7^XLFDT(HLDT)
"RTN","HLTP4",184,0)
 ;get 'msgtype'=B or M, message type and event type
"RTN","HLTP4",185,0)
 S HLP("MSGTYPE")=$E(HL("TYPE")),HLP("MTYPE")=$G(HL("MTP")),HLP("EVENT")=$G(HL("ETP")),HLP("HLTCPI")=HLMTIENS
"RTN","HLTP4",186,0)
 S:$G(HL("MTP_ETP")) HLP("MTYPE_EVENT")=$G(HL("MTP_ETP"))
"RTN","HLTP4",187,0)
 ; HL*1.6*117 start
"RTN","HLTP4",188,0)
 ; change the order of when updates are done on file 773
"RTN","HLTP4",189,0)
 ;Update zero node of Message Admin file #773
"RTN","HLTP4",190,0)
 ;D UPDATE^HLTF0(HLTCP,,"O",,HLREC,HLSAN,"I",HLMTIENS,HLDP,.HLP)
"RTN","HLTP4",191,0)
 ;
"RTN","HLTP4",192,0)
 ;don't need x-ref, msg will be sent back over open tcp link
"RTN","HLTP4",193,0)
 ;**109**
"RTN","HLTP4",194,0)
 ;D LLCNT^HLCSTCP(HLDP,3)
"RTN","HLTP4",195,0)
 ;K ^HLMA("AC","O",HLDP,HLTCP)
"RTN","HLTP4",196,0)
 ;
"RTN","HLTP4",197,0)
 ;Update status to Being Generated
"RTN","HLTP4",198,0)
 ;D STATUS^HLTF0(HLTCP,8)
"RTN","HLTP4",199,0)
 ; HL*1.6*117 end
"RTN","HLTP4",200,0)
 ;update zero node of Message Text file #772
"RTN","HLTP4",201,0)
 D
"RTN","HLTP4",202,0)
 . N HLTCP D UPDATE^HLTF0(HLMTIEN,,"O")
"RTN","HLTP4",203,0)
 ;
"RTN","HLTP4",204,0)
 ;build MSA segment
"RTN","HLTP4",205,0)
 K HLA
"RTN","HLTP4",206,0)
 S HLA("HLS",1)="MSA"_HLFS_HLTACK_HLFS_$G(HL("MID"))
"RTN","HLTP4",207,0)
 S:$G(HLMG)]"" HLA("HLS",1)=HLA("HLS",1)_HLFS_HLMG
"RTN","HLTP4",208,0)
 ;update file 772 with msg text
"RTN","HLTP4",209,0)
 D MERGE^HLTF1("L",HLMTIEN,"HLS")
"RTN","HLTP4",210,0)
 D HDR
"RTN","HLTP4",211,0)
 ;update file 773 with msg header
"RTN","HLTP4",212,0)
 K HLQ S HLQ(773,HLTCP_",",200)="HLHDR"
"RTN","HLTP4",213,0)
 D FILE^HLDIE("","HLQ","","ACK","HLTP4") ; HL*1.6*109
"RTN","HLTP4",214,0)
 ;D FILE^DIE("","HLQ")
"RTN","HLTP4",215,0)
 ; HL*1.6*117 start
"RTN","HLTP4",216,0)
 ; finally commit updates to 773 that will affect behavior of messaging
"RTN","HLTP4",217,0)
 ;Update status to Being Generated
"RTN","HLTP4",218,0)
 D STATUS^HLTF0(HLTCP,8)
"RTN","HLTP4",219,0)
 ;Update zero node of Message Admin file #773
"RTN","HLTP4",220,0)
 D UPDATE^HLTF0(HLTCP,,"O",,HLREC,HLSAN,"I",HLMTIENS,HLDP,.HLP)
"RTN","HLTP4",221,0)
 ; update message sent count
"RTN","HLTP4",222,0)
 D LLCNT^HLCSTCP(HLDP,3)
"RTN","HLTP4",223,0)
 ; HL*1.6*117 end
"RTN","HLTP4",224,0)
 G EXIT
"RTN","HLTP4",225,0)
 ;
"RTN","HLTP4",226,0)
HDR ; build header for commit ack
"RTN","HLTP4",227,0)
 K HLHDR
"RTN","HLTP4",228,0)
 S HLHDR(1)=HL("TYPE")_HLFS_HL("ECH")_HLFS_HLSAN_HLFS_$G(HL("RFN"))_HLFS_HLREC_HLFS_$G(HL("SFN"))_HLFS_HLDT1_HLFS_HLFS
"RTN","HLTP4",229,0)
 I HLP("MSGTYPE")="M" S HLHDR(1)=HLHDR(1)_"ACK"_HLFS_HLMIDA_HLFS_$G(HL("PID"))_HLFS_$G(HL("VER")) Q
"RTN","HLTP4",230,0)
 ;batch
"RTN","HLTP4",231,0)
 S X=$E(HL("ECH"))
"RTN","HLTP4",232,0)
 S HLHDR(1)=HLHDR(1)_X_$G(HL("PID"))_X_"ACK"_HLFS_HLTACK_HLFS_HLMIDA_HLFS_$G(HL("MID"))
"RTN","HLTP4",233,0)
 Q
"RTN","HLTPCK1")
0^5^B31754890^B7916664
"RTN","HLTPCK1",1,0)
HLTPCK1 ;AISC/SAW-Header Validation Routine (non-TCP link) ;07/19/2005  15:38
"RTN","HLTPCK1",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**8,36,59,120**;Oct 13, 1995;Build 12
"RTN","HLTPCK1",3,0)
CHK(HDR,ARY,MSA) ;Validate Data in Header Segment (MSH, BHS or FHS) of
"RTN","HLTPCK1",4,0)
 ;an HL7 Message through non-TCP link
"RTN","HLTPCK1",5,0)
 ;
"RTN","HLTPCK1",6,0)
 ;This entry point is a subroutine call with parameter passing that
"RTN","HLTPCK1",7,0)
 ;will return an array (ARY()) consisting of values extracted from
"RTN","HLTPCK1",8,0)
 ;the message header segment subscripted by the mnemonics for each of
"RTN","HLTPCK1",9,0)
 ;the message header fields and components
"RTN","HLTPCK1",10,0)
 ;If an error is encountered during validation, the array parameter
"RTN","HLTPCK1",11,0)
 ;(ARY) will be set equal to two pieces, error #^error text
"RTN","HLTPCK1",12,0)
 ;
"RTN","HLTPCK1",13,0)
 ;Required input parameters:
"RTN","HLTPCK1",14,0)
 ;  HDR = Message header segment
"RTN","HLTPCK1",15,0)
 ;
"RTN","HLTPCK1",16,0)
 ;  ARY = The array in which the message header values will be
"RTN","HLTPCK1",17,0)
 ;          returned
"RTN","HLTPCK1",18,0)
 ;  Note:  The ARY parameter must be passed by reference
"RTN","HLTPCK1",19,0)
 ;
"RTN","HLTPCK1",20,0)
 ;Optional input parameter:
"RTN","HLTPCK1",21,0)
 ;  MSA = A variable which contains the message acknowledgement values:
"RTN","HLTPCK1",22,0)
 ;          acknowledgement code^message control ID^text message
"RTN","HLTPCK1",23,0)
 ;
"RTN","HLTPCK1",24,0)
 ;Check for required parameters
"RTN","HLTPCK1",25,0)
 N ERR S ERR=""
"RTN","HLTPCK1",26,0)
 I $G(HDR)']"" S ERR="7^"_$G(^HL(771.7,7,0))_" at CHK^HLTPCK1 entry point" G EXIT
"RTN","HLTPCK1",27,0)
 N ECH,HLN,FS,X,X1,X2
"RTN","HLTPCK1",28,0)
 S ARY="",ARY("Q")=""""""
"RTN","HLTPCK1",29,0)
 ;
"RTN","HLTPCK1",30,0)
 ;Validate field separator and encoding characters
"RTN","HLTPCK1",31,0)
 S (ARY("FS"),FS)=$E(HDR,4)
"RTN","HLTPCK1",32,0)
 I FS']"" S ERR="Field Separator Missing" G EXIT
"RTN","HLTPCK1",33,0)
 I FS?.C S ERR="Invalid Field Separator" G EXIT
"RTN","HLTPCK1",34,0)
 S (ARY("ECH"),ECH)=$P(HDR,FS,2)
"RTN","HLTPCK1",35,0)
 I ECH']"" S ERR="Encoding Characters Missing" G EXIT
"RTN","HLTPCK1",36,0)
 I ECH?.C S ERR="Invalid Encoding Characters" G EXIT
"RTN","HLTPCK1",37,0)
 ;
"RTN","HLTPCK1",38,0)
 ; patch HL*1.6*120 start
"RTN","HLTPCK1",39,0)
 I $L(ECH)'=4 S ERR="Invalid Encoding Characters" G EXIT
"RTN","HLTPCK1",40,0)
 S ECH(1)=$E(ECH)
"RTN","HLTPCK1",41,0)
 S ECH(2)=$E(ECH,2)
"RTN","HLTPCK1",42,0)
 S ECH(4)=$E(ECH,4)
"RTN","HLTPCK1",43,0)
 S ARY("HDR")=HDR
"RTN","HLTPCK1",44,0)
 S ARY("HDR-1")=$E(HDR,1,3)
"RTN","HLTPCK1",45,0)
 ;
"RTN","HLTPCK1",46,0)
 ;Validate Message Header Type
"RTN","HLTPCK1",47,0)
 ; I "FHS,BHS,MSH"'[$E(HDR,1,3) S ERR="Invalid Message Header Segment" G EXIT
"RTN","HLTPCK1",48,0)
 I "FHS,BHS,MSH"'[ARY("HDR-1") S ERR="Invalid Message Header" G EXIT
"RTN","HLTPCK1",49,0)
 ;
"RTN","HLTPCK1",50,0)
 ;Extract data from message header segment
"RTN","HLTPCK1",51,0)
 ; I $E(HDR,1,3)="BHS"!($E(HDR,1,3)="FHS") D
"RTN","HLTPCK1",52,0)
 I ARY("HDR-1")="BHS"!(ARY("HDR-1")="FHS") D
"RTN","HLTPCK1",53,0)
 . ;S ARY("DTM")=$P(HDR,FS,7),ARY("MID")=$P(HDR,FS,11),X=$P(HDR,FS,9),ARY("PID")=$P(X,$E(ECH),2),ARY("MTN")=$P($P(X,$E(ECH),3),$E(ECH,2)),ARY("ETN")=$P($P(X,$E(ECH),3),$E(ECH,2),2),ARY("VER")=$P(X,$E(ECH),4)
"RTN","HLTPCK1",54,0)
 . S ARY("DTM")=$P(HDR,FS,7)
"RTN","HLTPCK1",55,0)
 . S ARY("MID")=$P(HDR,FS,11)
"RTN","HLTPCK1",56,0)
 . S ARY("PID")=""
"RTN","HLTPCK1",57,0)
 . S ARY("MTN")=""
"RTN","HLTPCK1",58,0)
 . S ARY("ETN")=""
"RTN","HLTPCK1",59,0)
 . S ARY("VER")=""
"RTN","HLTPCK1",60,0)
 . ;
"RTN","HLTPCK1",61,0)
 . ; BHS-9, Batch name/ID/type:
"RTN","HLTPCK1",62,0)
 . ; 2nd component: Processing id <sub> Processing mode
"RTN","HLTPCK1",63,0)
 . ; 3rd component: message type <sub> event type
"RTN","HLTPCK1",64,0)
 . ; 4th component: version
"RTN","HLTPCK1",65,0)
 . S X=$P(HDR,FS,9)
"RTN","HLTPCK1",66,0)
 . I X]"" D
"RTN","HLTPCK1",67,0)
 .. S ARY("HDR-9")=X
"RTN","HLTPCK1",68,0)
 .. ; original implementation incorrectly treats repetition separator as
"RTN","HLTPCK1",69,0)
 .. ; subcomponent separator
"RTN","HLTPCK1",70,0)
 .. S ECH("SUB-COMPONENT")=ECH(2)
"RTN","HLTPCK1",71,0)
 .. ; if subcomponent separator is correctly applied
"RTN","HLTPCK1",72,0)
 .. I X[ECH(4) S ECH("SUB-COMPONENT")=ECH(4)
"RTN","HLTPCK1",73,0)
 .. ;
"RTN","HLTPCK1",74,0)
 .. S ARY("PID")=$P(X,ECH(1),2)
"RTN","HLTPCK1",75,0)
 .. I ARY("PID")[ECH("SUB-COMPONENT") D
"RTN","HLTPCK1",76,0)
 ... ; 2nd sub-component is Processing mode
"RTN","HLTPCK1",77,0)
 ... S ARY("PMOD")=$P(ARY("PID"),ECH("SUB-COMPONENT"),2)
"RTN","HLTPCK1",78,0)
 ... ; first sub-component is Processing id
"RTN","HLTPCK1",79,0)
 ... S ARY("PID")=$P(ARY("PID"),ECH("SUB-COMPONENT"))
"RTN","HLTPCK1",80,0)
 .. ;
"RTN","HLTPCK1",81,0)
 .. S ARY("MTN")=$P(X,ECH(1),3)
"RTN","HLTPCK1",82,0)
 .. ; 2nd sub-component is event type
"RTN","HLTPCK1",83,0)
 .. S ARY("ETN")=$P(ARY("MTN"),ECH("SUB-COMPONENT"),2)
"RTN","HLTPCK1",84,0)
 .. ; 1st sub-component is message type
"RTN","HLTPCK1",85,0)
 .. S ARY("MTN")=$P(ARY("MTN"),ECH("SUB-COMPONENT"))
"RTN","HLTPCK1",86,0)
 .. S ARY("VER")=$P(X,ECH(1),4)
"RTN","HLTPCK1",87,0)
 . ;
"RTN","HLTPCK1",88,0)
 . ; BHS-10, batch comment
"RTN","HLTPCK1",89,0)
 . ; S:$P(HDR,FS,10)]"" MSA=$P($P(HDR,FS,10),$E(ECH),1),$P(MSA,FS,2)=$P(HDR,FS,12),$P(MSA,FS,3)=$P($P(HDR,FS,10),$E(ECH),2)
"RTN","HLTPCK1",90,0)
 . ; first component: MSA-1, acknowledgment code
"RTN","HLTPCK1",91,0)
 . ; 2nd component: MSA-3, text message
"RTN","HLTPCK1",92,0)
 . ;
"RTN","HLTPCK1",93,0)
 . S X=$P(HDR,FS,10)
"RTN","HLTPCK1",94,0)
 . I X]"" D
"RTN","HLTPCK1",95,0)
 .. S ARY("HDR-10")=X
"RTN","HLTPCK1",96,0)
 .. ; MSA-1, acknowledgment code: AA,AE,AR,CA,CE,CR
"RTN","HLTPCK1",97,0)
 .. S MSA=$P(X,ECH(1),1)
"RTN","HLTPCK1",98,0)
 .. ; MSA-2 and BHS-12, reference batch control id
"RTN","HLTPCK1",99,0)
 .. S $P(MSA,FS,2)=$P(HDR,FS,12)
"RTN","HLTPCK1",100,0)
 .. ; MSA-3, text message
"RTN","HLTPCK1",101,0)
 .. S $P(MSA,FS,3)=$P(X,ECH(1),2)
"RTN","HLTPCK1",102,0)
 . ; Reference Batch Control ID
"RTN","HLTPCK1",103,0)
 . S:$P(HDR,FS,12)]"" ARY("HDR-12")=$P(HDR,FS,12)
"RTN","HLTPCK1",104,0)
 ;
"RTN","HLTPCK1",105,0)
 ; I $E(HDR,1,3)="MSH" D
"RTN","HLTPCK1",106,0)
 I ARY("HDR-1")="MSH" D
"RTN","HLTPCK1",107,0)
 . ;S ARY("DTM")=$P(HDR,FS,7),ARY("MID")=$P(HDR,FS,10),ARY("PID")=$P(HDR,FS,11),ARY("MTN")=$P($P(HDR,FS,9),$E(ECH)),ARY("ETN")=$P($P(HDR,FS,9),$E(ECH),2),ARY("VER")=$P(HDR,FS,12)
"RTN","HLTPCK1",108,0)
 . S ARY("DTM")=$P(HDR,FS,7)
"RTN","HLTPCK1",109,0)
 . S ARY("MID")=$P(HDR,FS,10)
"RTN","HLTPCK1",110,0)
 . S ARY("PID")=$P(HDR,FS,11)
"RTN","HLTPCK1",111,0)
 . S ARY("MTN")=$P($P(HDR,FS,9),ECH(1))
"RTN","HLTPCK1",112,0)
 . S ARY("ETN")=$P($P(HDR,FS,9),ECH(1),2)
"RTN","HLTPCK1",113,0)
 . S ARY("VER")=$P(HDR,FS,12)
"RTN","HLTPCK1",114,0)
 . ;
"RTN","HLTPCK1",115,0)
 . ; 2nd sub-component is Processing mode
"RTN","HLTPCK1",116,0)
 . I ARY("PID")[ECH(1) D
"RTN","HLTPCK1",117,0)
 .. S ARY("PMOD")=$P(ARY("PID"),ECH(1),2)
"RTN","HLTPCK1",118,0)
 .. ; first sub-component is Processing id
"RTN","HLTPCK1",119,0)
 .. S ARY("PID")=$P(ARY("PID"),ECH(1))
"RTN","HLTPCK1",120,0)
 . ;
"RTN","HLTPCK1",121,0)
 . ; S:$P($P(HDR,FS,9),$E(ECH),3)]"" ARY("MTN_ETN")=$P($P(HDR,FS,9),$E(ECH),3)
"RTN","HLTPCK1",122,0)
 .I $P($P(HDR,FS,9),ECH(1),3)]"" D
"RTN","HLTPCK1",123,0)
 .. S ARY("MTN_ETN")=$P($P(HDR,FS,9),ECH(1),3)
"RTN","HLTPCK1",124,0)
 . ;
"RTN","HLTPCK1",125,0)
 . ; fields 13 and 14
"RTN","HLTPCK1",126,0)
 . S:$P(HDR,FS,13)]"" ARY("MSH-13")=$P(HDR,FS,13)
"RTN","HLTPCK1",127,0)
 . S:$P(HDR,FS,14)]"" ARY("MSH-14")=$P(HDR,FS,14)
"RTN","HLTPCK1",128,0)
 . ;
"RTN","HLTPCK1",129,0)
 . ; S:$P(HDR,FS,15)]"" ARY("ACAT")=$P(HDR,FS,15) S:$P(HDR,FS,16)]"" ARY("APAT")=$P(HDR,FS,16) S:$P(HDR,FS,17)]"" ARY("CC")=$P(HDR,FS,17)
"RTN","HLTPCK1",130,0)
 . S:$P(HDR,FS,15)]"" ARY("ACAT")=$P(HDR,FS,15)
"RTN","HLTPCK1",131,0)
 . S:$P(HDR,FS,16)]"" ARY("APAT")=$P(HDR,FS,16)
"RTN","HLTPCK1",132,0)
 . S:$P(HDR,FS,17)]"" ARY("CC")=$P(HDR,FS,17)
"RTN","HLTPCK1",133,0)
 . ;
"RTN","HLTPCK1",134,0)
 . ; fields 18,19,20 and 21
"RTN","HLTPCK1",135,0)
 . S:$P(HDR,FS,18)]"" ARY("MSH-18")=$P(HDR,FS,18)
"RTN","HLTPCK1",136,0)
 . S:$P(HDR,FS,19)]"" ARY("MSH-19")=$P(HDR,FS,19)
"RTN","HLTPCK1",137,0)
 . S:$P(HDR,FS,20)]"" ARY("MSH-20")=$P(HDR,FS,20)
"RTN","HLTPCK1",138,0)
 . S:$P(HDR,FS,21)]"" ARY("MSH-21")=$P(HDR,FS,21)
"RTN","HLTPCK1",139,0)
 K:$G(MSA)']"" MSA
"RTN","HLTPCK1",140,0)
 ;
"RTN","HLTPCK1",141,0)
 S ARY("RAF")=$P(HDR,FS,6)  ; receiving facility
"RTN","HLTPCK1",142,0)
 S ARY("SAF")=$P(HDR,FS,4)  ; sending facility
"RTN","HLTPCK1",143,0)
 ;
"RTN","HLTPCK1",144,0)
 ;Invoke continuation routine to perform remaining validation checks
"RTN","HLTPCK1",145,0)
 D ^HLTPCK1A
"RTN","HLTPCK1",146,0)
 ;
"RTN","HLTPCK1",147,0)
EXIT ;
"RTN","HLTPCK1",148,0)
 ; the maximum length of field #772,22 (Error Message) is 200
"RTN","HLTPCK1",149,0)
 I ERR]"" D
"RTN","HLTPCK1",150,0)
 . S ERR=$E(ERR,1,200)
"RTN","HLTPCK1",151,0)
 . S ARY=$S('ERR:"13^"_ERR,1:ERR)
"RTN","HLTPCK1",152,0)
 ; patch HL*1.6*120 end
"RTN","HLTPCK1",153,0)
 Q
"RTN","HLTPCK2")
0^6^B34416614^B8648558
"RTN","HLTPCK2",1,0)
HLTPCK2 ;SF/RSD - Message Header Validation (TCP Link) ;07/21/2005  17:12
"RTN","HLTPCK2",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,59,120**;Oct 13, 1995;Build 12
"RTN","HLTPCK2",3,0)
CHK(HDR,ARY,MSA) ;
"RTN","HLTPCK2",4,0)
 ;Validate Data in Header Segment (MSH, BHS or FHS) of an HL7 Message
"RTN","HLTPCK2",5,0)
 ; through TCP link.
"RTN","HLTPCK2",6,0)
 ;
"RTN","HLTPCK2",7,0)
 ;This entry point is a subroutine call with parameter passing that
"RTN","HLTPCK2",8,0)
 ;will return an array (ARY()) consisting of values extracted from
"RTN","HLTPCK2",9,0)
 ;the message header segment subscripted by the mnemonics for each of
"RTN","HLTPCK2",10,0)
 ;the message header fields and components.
"RTN","HLTPCK2",11,0)
 ;The message header can be multiple line longer than 255 characters.
"RTN","HLTPCK2",12,0)
 ;HDR is an array that is passed by reference.
"RTN","HLTPCK2",13,0)
 ;If an error is encountered during validation, the array parameter
"RTN","HLTPCK2",14,0)
 ;(ARY) will be set equal to two pieces, error #^error text.
"RTN","HLTPCK2",15,0)
 ;
"RTN","HLTPCK2",16,0)
 ;Required input parameters
"RTN","HLTPCK2",17,0)
 ;  HDR = Message header array, HDR(1,0)=segment (passed by reference)
"RTN","HLTPCK2",18,0)
 ;
"RTN","HLTPCK2",19,0)
 ;  ARY = The array in which the message header values will be
"RTN","HLTPCK2",20,0)
 ;          returned (passed by reference)
"RTN","HLTPCK2",21,0)
 ;
"RTN","HLTPCK2",22,0)
 ;Optional input parameter
"RTN","HLTPCK2",23,0)
 ;  MSA = A variable which contains the message acknowledgement values:
"RTN","HLTPCK2",24,0)
 ;          acknowledgement code^message control ID^text message. Passed
"RTN","HLTPCK2",25,0)
 ;          by reference so that Batch msg. can set this here.
"RTN","HLTPCK2",26,0)
 ;
"RTN","HLTPCK2",27,0)
 ;Check for required parameters
"RTN","HLTPCK2",28,0)
 N ERR S ERR=""
"RTN","HLTPCK2",29,0)
 I $D(HDR)<10 S ERR="7^"_$G(^HL(771.7,7,0))_" at CHK^HLTPCK2" G EXIT
"RTN","HLTPCK2",30,0)
 N ECH,HLN,FS,X,X1,X2
"RTN","HLTPCK2",31,0)
 S ARY="",ARY("Q")=""""""
"RTN","HLTPCK2",32,0)
 ;
"RTN","HLTPCK2",33,0)
 ;Validate field separator and encoding characters
"RTN","HLTPCK2",34,0)
 S (ARY("FS"),FS)=$E(HDR(1,0),4)
"RTN","HLTPCK2",35,0)
 I FS']"" S ERR="Field Separator Missing" G EXIT
"RTN","HLTPCK2",36,0)
 I FS?.C S ERR="Invalid Field Separator" G EXIT
"RTN","HLTPCK2",37,0)
 S (ARY("ECH"),ECH)=$$P(.HDR,2)
"RTN","HLTPCK2",38,0)
 I ECH']"" S ERR="Encoding Characters Missing" G EXIT
"RTN","HLTPCK2",39,0)
 I ECH?.C S ERR="Invalid Encoding Characters" G EXIT
"RTN","HLTPCK2",40,0)
 ;
"RTN","HLTPCK2",41,0)
 ; patch HL*1.6*120 start
"RTN","HLTPCK2",42,0)
 I $L(ECH)'=4 S ERR="Invalid Encoding Characters" G EXIT
"RTN","HLTPCK2",43,0)
 S ECH(1)=$E(ECH)
"RTN","HLTPCK2",44,0)
 S ECH(2)=$E(ECH,2)
"RTN","HLTPCK2",45,0)
 S ECH(4)=$E(ECH,4)
"RTN","HLTPCK2",46,0)
 M ARY("HDR")=HDR
"RTN","HLTPCK2",47,0)
 ;
"RTN","HLTPCK2",48,0)
 ;Validate Message Header Type
"RTN","HLTPCK2",49,0)
 S (ARY("TYPE"),X)=$$P(.HDR,1)
"RTN","HLTPCK2",50,0)
 S ARY("HDR-1")=X
"RTN","HLTPCK2",51,0)
 I X=""!("FHS,BHS,MSH"'[X) S ERR="Invalid Message Header" G EXIT
"RTN","HLTPCK2",52,0)
 ;
"RTN","HLTPCK2",53,0)
 ;Extract data from message header segment
"RTN","HLTPCK2",54,0)
 ; S ARY("SAN")=$$P(.HDR,3),ARY("SFN")=$$P(.HDR,4),ARY("RAN")=$$P(.HDR,5),ARY("RFN")=$$P(.HDR,6),ARY("DTM")=$$P(.HDR,7)
"RTN","HLTPCK2",55,0)
 S ARY("SAN")=$$P(.HDR,3)
"RTN","HLTPCK2",56,0)
 S ARY("SFN")=$$P(.HDR,4)
"RTN","HLTPCK2",57,0)
 S ARY("RAN")=$$P(.HDR,5)
"RTN","HLTPCK2",58,0)
 S ARY("RFN")=$$P(.HDR,6)
"RTN","HLTPCK2",59,0)
 S ARY("DTM")=$$P(.HDR,7)
"RTN","HLTPCK2",60,0)
 ;
"RTN","HLTPCK2",61,0)
 I X="BHS"!(X="FHS") D
"RTN","HLTPCK2",62,0)
 . ; S ARY("MID")=$$P(.HDR,11),X=$$P(.HDR,9),ARY("PID")=$P(X,$E(ECH),2)
"RTN","HLTPCK2",63,0)
 . ;
"RTN","HLTPCK2",64,0)
 . S ARY("MID")=$$P(.HDR,11)
"RTN","HLTPCK2",65,0)
 . ;
"RTN","HLTPCK2",66,0)
 . ; BHS-9, Batch name/ID/Type:
"RTN","HLTPCK2",67,0)
 . ; 2nd component: Processing ID <sub> Processing Mode
"RTN","HLTPCK2",68,0)
 . ; 3rd component: Message Type <sub> Event Type
"RTN","HLTPCK2",69,0)
 . ; 4th component: Version ID
"RTN","HLTPCK2",70,0)
 . ; 5th component: Accept Acknowledgment Type
"RTN","HLTPCK2",71,0)
 . ; 6th component: Application Acknowledgment Type
"RTN","HLTPCK2",72,0)
 . S X=$$P(.HDR,9)
"RTN","HLTPCK2",73,0)
 . S:X]"" ARY("HDR-9")=X
"RTN","HLTPCK2",74,0)
 . ; original implementation incorrectly treats repetition separator as
"RTN","HLTPCK2",75,0)
 . ; subcomponent separator
"RTN","HLTPCK2",76,0)
 . S ECH("SUB-COMPONENT")=ECH(2)
"RTN","HLTPCK2",77,0)
 . ; if subcomponent separator is correctly applied
"RTN","HLTPCK2",78,0)
 . I X[ECH(4) S ECH("SUB-COMPONENT")=ECH(4)
"RTN","HLTPCK2",79,0)
 . ;
"RTN","HLTPCK2",80,0)
 . S ARY("PID")=$P(X,ECH(1),2)
"RTN","HLTPCK2",81,0)
 . I ARY("PID")[ECH("SUB-COMPONENT") D
"RTN","HLTPCK2",82,0)
 .. ; 2nd sub-component is Processing mode
"RTN","HLTPCK2",83,0)
 .. S ARY("PMOD")=$P(ARY("PID"),ECH("SUB-COMPONENT"),2)
"RTN","HLTPCK2",84,0)
 .. ; first sub-component is Processing id
"RTN","HLTPCK2",85,0)
 .. S ARY("PID")=$P(ARY("PID"),ECH("SUB-COMPONENT"))
"RTN","HLTPCK2",86,0)
 . ;
"RTN","HLTPCK2",87,0)
 . ; S ARY("MTN")=$P($P(X,$E(ECH),3),$E(ECH,2)),ARY("ETN")=$P($P(X,$E(ECH),3),$E(ECH,2),2)
"RTN","HLTPCK2",88,0)
 . ;
"RTN","HLTPCK2",89,0)
 . S ARY("MTN")=$P(X,ECH(1),3)
"RTN","HLTPCK2",90,0)
 . ; 2nd sub-component is event type
"RTN","HLTPCK2",91,0)
 . S ARY("ETN")=$P(ARY("MTN"),ECH("SUB-COMPONENT"),2)
"RTN","HLTPCK2",92,0)
 . ; 1st sub-component is message type
"RTN","HLTPCK2",93,0)
 . S ARY("MTN")=$P(ARY("MTN"),ECH("SUB-COMPONENT"))
"RTN","HLTPCK2",94,0)
 . ;
"RTN","HLTPCK2",95,0)
 . ; S ARY("VER")=$P(X,$E(ECH),4),ARY("ACAT")=$P(X,$E(ECH),5),ARY("APAT")=$P(X,$E(ECH),6)
"RTN","HLTPCK2",96,0)
 . S ARY("VER")=$P(X,ECH(1),4)
"RTN","HLTPCK2",97,0)
 . S:$P(X,ECH(1),5)]"" ARY("ACAT")=$P(X,ECH(1),5)
"RTN","HLTPCK2",98,0)
 . S:$P(X,ECH(1),6)]"" ARY("APAT")=$P(X,ECH(1),6)
"RTN","HLTPCK2",99,0)
 . ;
"RTN","HLTPCK2",100,0)
 . ; BHS-10, batch comment
"RTN","HLTPCK2",101,0)
 . ; first component: MSA-1, acknowledgment code
"RTN","HLTPCK2",102,0)
 . ; 2nd component: MSA-3, text message
"RTN","HLTPCK2",103,0)
 . ; S:$$P(.HDR,10)]"" MSA=$P($$P(.HDR,10),$E(ECH),1),$P(MSA,FS,2)=$$P(.HDR,12),$P(MSA,FS,3)=$P($$P(.HDR,10),$E(ECH),2)
"RTN","HLTPCK2",104,0)
 . ;
"RTN","HLTPCK2",105,0)
 . S X=$$P(.HDR,10)
"RTN","HLTPCK2",106,0)
 . I X]"" D
"RTN","HLTPCK2",107,0)
 .. S ARY("HDR-10")=X
"RTN","HLTPCK2",108,0)
 .. ; MSA-1, acknowledgment code: AA,AE,AR,CA,CE,or CR
"RTN","HLTPCK2",109,0)
 .. S MSA=$P(X,ECH(1),1)
"RTN","HLTPCK2",110,0)
 .. ; MSA-2 and BHS-12, reference batch control id
"RTN","HLTPCK2",111,0)
 .. S $P(MSA,FS,2)=$$P(.HDR,12)
"RTN","HLTPCK2",112,0)
 .. ; MSA-3, text message
"RTN","HLTPCK2",113,0)
 .. S $P(MSA,FS,3)=$P(X,ECH(1),2)
"RTN","HLTPCK2",114,0)
 . ;
"RTN","HLTPCK2",115,0)
 . ; Reference Batch Control ID
"RTN","HLTPCK2",116,0)
 . S:$$P(.HDR,12)]"" ARY("HDR-12")=$$P(.HDR,12)
"RTN","HLTPCK2",117,0)
 ;
"RTN","HLTPCK2",118,0)
 ; I $$P(.HDR,1)="MSH" D
"RTN","HLTPCK2",119,0)
 I ARY("HDR-1")="MSH" D
"RTN","HLTPCK2",120,0)
 . ; S ARY("MID")=$$P(.HDR,10),ARY("PID")=$$P(.HDR,11),ARY("MTN")=$P($$P(.HDR,9),$E(ECH)),ARY("ETN")=$P($$P(.HDR,9),$E(ECH),2),ARY("VER")=$$P(.HDR,12)
"RTN","HLTPCK2",121,0)
 . S ARY("MID")=$$P(.HDR,10)
"RTN","HLTPCK2",122,0)
 . S ARY("PID")=$$P(.HDR,11)
"RTN","HLTPCK2",123,0)
 . S X=$$P(.HDR,9)
"RTN","HLTPCK2",124,0)
 . S ARY("MTN")=$P(X,ECH(1))
"RTN","HLTPCK2",125,0)
 . S ARY("ETN")=$P(X,ECH(1),2)
"RTN","HLTPCK2",126,0)
 . ;
"RTN","HLTPCK2",127,0)
 . ; S:$P($$P(.HDR,9),$E(ECH),3)'="" ARY("MTN_ETN")=$P($$P(.HDR,9),$E(ECH),3)
"RTN","HLTPCK2",128,0)
 . S:$P(X,ECH(1),3)]"" ARY("MTN_ETN")=$P(X,ECH(1),3)
"RTN","HLTPCK2",129,0)
 . ;
"RTN","HLTPCK2",130,0)
 . I ARY("PID")[ECH(1) D
"RTN","HLTPCK2",131,0)
 .. ; 2nd component is Processing mode
"RTN","HLTPCK2",132,0)
 .. S ARY("PMOD")=$P(ARY("PID"),ECH(1),2)
"RTN","HLTPCK2",133,0)
 .. ; first component is Processing id
"RTN","HLTPCK2",134,0)
 .. S ARY("PID")=$P(ARY("PID"),ECH(1))
"RTN","HLTPCK2",135,0)
 . ;
"RTN","HLTPCK2",136,0)
 . S ARY("VER")=$$P(.HDR,12)
"RTN","HLTPCK2",137,0)
 . ;
"RTN","HLTPCK2",138,0)
 . ; fields 13 and 14
"RTN","HLTPCK2",139,0)
 . S:$$P(.HDR,13)]"" ARY("MSH-13")=$$P(.HDR,13)
"RTN","HLTPCK2",140,0)
 . S:$$P(.HDR,14)]"" ARY("MSH-14")=$$P(.HDR,14)
"RTN","HLTPCK2",141,0)
 . ;
"RTN","HLTPCK2",142,0)
 . ; S:$$P(.HDR,15)]"" ARY("ACAT")=$$P(.HDR,15) S:$$P(.HDR,16)]"" ARY("APAT")=$$P(.HDR,16) S:$$P(.HDR,17)]"" ARY("CC")=$$P(.HDR,17)
"RTN","HLTPCK2",143,0)
 . S:$$P(.HDR,15)]"" ARY("ACAT")=$$P(.HDR,15)
"RTN","HLTPCK2",144,0)
 . S:$$P(.HDR,16)]"" ARY("APAT")=$$P(.HDR,16)
"RTN","HLTPCK2",145,0)
 . S:$$P(.HDR,17)]"" ARY("CC")=$$P(.HDR,17)
"RTN","HLTPCK2",146,0)
 . ;
"RTN","HLTPCK2",147,0)
 . ; fields 18,19,20 and 21
"RTN","HLTPCK2",148,0)
 . S:$$P(.HDR,18)]"" ARY("MSH-18")=$$P(.HDR,18)
"RTN","HLTPCK2",149,0)
 . S:$$P(.HDR,19)]"" ARY("MSH-19")=$$P(.HDR,19)
"RTN","HLTPCK2",150,0)
 . S:$$P(.HDR,20)]"" ARY("MSH-20")=$$P(.HDR,20)
"RTN","HLTPCK2",151,0)
 . S:$$P(.HDR,21)]"" ARY("MSH-21")=$$P(.HDR,21)
"RTN","HLTPCK2",152,0)
 ;
"RTN","HLTPCK2",153,0)
 ;Invoke continuation routine to perform remaining validation checks
"RTN","HLTPCK2",154,0)
 D ^HLTPCK2A
"RTN","HLTPCK2",155,0)
EXIT ;
"RTN","HLTPCK2",156,0)
 ; patch HL*1.6*120
"RTN","HLTPCK2",157,0)
 ; the maximum length of field #773,22 (Error Message) is 200
"RTN","HLTPCK2",158,0)
 I ERR]"" D
"RTN","HLTPCK2",159,0)
 . S ERR=$E(ERR,1,200)
"RTN","HLTPCK2",160,0)
 . S ARY=$S('ERR:"13^"_ERR,1:ERR)
"RTN","HLTPCK2",161,0)
 ; patch HL*1.6*120 end
"RTN","HLTPCK2",162,0)
 Q
"RTN","HLTPCK2",163,0)
 ;
"RTN","HLTPCK2",164,0)
P(MSH,P) ;get piece P from MSH array (passed by ref.)
"RTN","HLTPCK2",165,0)
 N FS,I,L,L1,L2,X,Y
"RTN","HLTPCK2",166,0)
 S FS=$E(MSH(1,0),4),(L2,Y)=0,X=""
"RTN","HLTPCK2",167,0)
 F I=1:1 S L1=$L($G(MSH(I,0)),FS),L=L1+Y-1 D  Q:$L(X)!'$D(MSH(I,0))
"RTN","HLTPCK2",168,0)
 . S:L1=1 L=L+1
"RTN","HLTPCK2",169,0)
 . S:P'>L X=$P($G(MSH(I-1,0)),FS,P-L2)_$P($G(MSH(I,0)),FS,(P-Y))
"RTN","HLTPCK2",170,0)
 . S L2=Y,Y=L
"RTN","HLTPCK2",171,0)
 Q X
"RTN","HLTPCK2",172,0)
 ;
"RTN","HLTPCK2A")
0^12^B27212258^B64758614
"RTN","HLTPCK2A",1,0)
HLTPCK2A ;SF/RSD - Message Header Validation (Con't) ;03/07/2006  13:15
"RTN","HLTPCK2A",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,57,59,66,108,120**;Oct 13, 1995;Build 12
"RTN","HLTPCK2A",3,0)
 S ERR=""
"RTN","HLTPCK2A",4,0)
 S HLPARAM=$$PARAM^HLCS2,HLDOM=$P(HLPARAM,U,2),HLINSTN=$P(HLPARAM,U,6)
"RTN","HLTPCK2A",5,0)
MT ;Validate message type
"RTN","HLTPCK2A",6,0)
 I (ARY("MTN")="") S:(ERR="") ERR="Invalid Message Type" Q
"RTN","HLTPCK2A",7,0)
 S ARY("MTP")=0
"RTN","HLTPCK2A",8,0)
 S:(ARY("MTN")'="") ARY("MTP")=+$O(^HL(771.2,"B",ARY("MTN"),0))
"RTN","HLTPCK2A",9,0)
 I ('ARY("MTP")) S:(ERR="") ERR="Invalid Message Type" Q
"RTN","HLTPCK2A",10,0)
 ;
"RTN","HLTPCK2A",11,0)
AT ;Determine if message is an acknowledgement type
"RTN","HLTPCK2A",12,0)
 I (("ACK,ADR,MCF,MFK,MFR,ORF,ORR,RRA,RRD,RRE,RRG,TBR"[ARY("MTN"))&($G(MSA)="")) S:(ERR="") ERR="MSA Segment Missing" Q
"RTN","HLTPCK2A",13,0)
 ;commit ack, quit
"RTN","HLTPCK2A",14,0)
 I $E($G(MSA))="C" D  Q
"RTN","HLTPCK2A",15,0)
 . ;find original msg.
"RTN","HLTPCK2A",16,0)
 . S ARY("MSAID")=$P(MSA,FS,2),ARY("MTIENS")=0
"RTN","HLTPCK2A",17,0)
 . I ARY("MSAID")="" S:(ERR="") ERR="Invalid Message Control ID in MSA Segment" Q
"RTN","HLTPCK2A",18,0)
 . F  S ARY("MTIENS")=+$O(^HLMA("C",ARY("MSAID"),ARY("MTIENS"))) Q:'ARY("MTIENS")!($P($G(^HLMA(ARY("MTIENS"),0)),U,3)="O")
"RTN","HLTPCK2A",19,0)
 . I 'ARY("MTIENS") S:(ERR="") ERR="Invalid Message Control ID in MSA Segment" Q
"RTN","HLTPCK2A",20,0)
 . Q
"RTN","HLTPCK2A",21,0)
AAT ;Validate accept ack type and application ack type
"RTN","HLTPCK2A",22,0)
 I ($G(ARY("ACAT"))'="") I ("AL,NE,ER,SU"'[ARY("ACAT")) S:(ERR="") ERR="Invalid accept ack type" Q
"RTN","HLTPCK2A",23,0)
 I ($G(ARY("APAT"))'="") I ("AL,NE,ER,SU"'[ARY("APAT")) S:(ERR="") ERR="Invalid application ack type" Q
"RTN","HLTPCK2A",24,0)
 ;
"RTN","HLTPCK2A",25,0)
 ;
"RTN","HLTPCK2A",26,0)
RA ;Validate receiving application
"RTN","HLTPCK2A",27,0)
 I (ARY("RAN")']"") S:(ERR="") ERR="Invalid Receiving Application" Q
"RTN","HLTPCK2A",28,0)
 S ARY("RAP")=0
"RTN","HLTPCK2A",29,0)
 S:ARY("RAN")]"" ARY("RAP")=+$O(^HL(771,"B",$E(ARY("RAN"),1,30),0))
"RTN","HLTPCK2A",30,0)
 I 'ARY("RAP"),ARY("RAN")'="" D
"RTN","HLTPCK2A",31,0)
 .S X=$$UPPER^HLFNC(ARY("RAN"))
"RTN","HLTPCK2A",32,0)
 .S ARY("RAP")=+$O(^HL(771,"B",$E(ARY("RAN"),1,30),0))
"RTN","HLTPCK2A",33,0)
 ;
"RTN","HLTPCK2A",34,0)
 ; patch HL*1.6*120 start
"RTN","HLTPCK2A",35,0)
 I ($L(ARY("RAN"),ECH(1))>1) D
"RTN","HLTPCK2A",36,0)
 . S ARY("RAN-SUB1")=$P(ARY("RAN"),ECH(1))
"RTN","HLTPCK2A",37,0)
 . S ARY("RAN-SUB2")=$P(ARY("RAN"),ECH(1),2)
"RTN","HLTPCK2A",38,0)
 . S ARY("RAN-SUB3")=$P(ARY("RAN"),ECH(1),3)
"RTN","HLTPCK2A",39,0)
 . I 'ARY("RAP"),ARY("RAN-SUB1")]"" D
"RTN","HLTPCK2A",40,0)
 .. S ARY("RAP")=+$O(^HL(771,"B",$E(ARY("RAN-SUB1"),1,30),0))
"RTN","HLTPCK2A",41,0)
 . I ARY("RAN-SUB1")["\" D
"RTN","HLTPCK2A",42,0)
 .. S ARY("RAN-SUB1-DEESCAPE")=$$DEESCAPE(ARY("RAN-SUB1"))
"RTN","HLTPCK2A",43,0)
 . I ARY("RAN-SUB2")["\" D
"RTN","HLTPCK2A",44,0)
 .. S ARY("RAN-SUB2-DEESCAPE")=$$DEESCAPE(ARY("RAN-SUB2"))
"RTN","HLTPCK2A",45,0)
 . I ARY("RAN-SUB3")["\" D
"RTN","HLTPCK2A",46,0)
 .. S ARY("RAN-SUB3-DEESCAPE")=$$DEESCAPE(ARY("RAN-SUB3"))
"RTN","HLTPCK2A",47,0)
 . I 'ARY("RAP"),$G(ARY("RAN-SUB1-DEESCAPE"))]"" D
"RTN","HLTPCK2A",48,0)
 .. S ARY("RAP")=+$O(^HL(771,"B",$E(ARY("RAN-SUB1-DEESCAPE"),1,30),0))
"RTN","HLTPCK2A",49,0)
 I ARY("RAN")["\" D
"RTN","HLTPCK2A",50,0)
 . S ARY("RAN-DEESCAPE")=$$DEESCAPE(ARY("RAN"))
"RTN","HLTPCK2A",51,0)
 I 'ARY("RAP"),$G(ARY("RAN-DEESCAPE"))]"" D
"RTN","HLTPCK2A",52,0)
 . S ARY("RAP")=+$O(^HL(771,"B",$E(ARY("RAN-DEESCAPE"),1,30),0))
"RTN","HLTPCK2A",53,0)
 ; patch HL*1.6*120 end
"RTN","HLTPCK2A",54,0)
 ;
"RTN","HLTPCK2A",55,0)
 I ('ARY("RAP")) S:(ERR="") ERR="Invalid Receiving Application" Q
"RTN","HLTPCK2A",56,0)
 S X2=$G(^HL(771,ARY("RAP"),0))
"RTN","HLTPCK2A",57,0)
 I (X2="") S:(ERR="") ERR="Invalid Receiving Application" Q
"RTN","HLTPCK2A",58,0)
 I ($P(X2,"^",2)'="a") S:(ERR="") ERR="Receiving Application is Inactive" Q
"RTN","HLTPCK2A",59,0)
 ;
"RTN","HLTPCK2A",60,0)
SA ;Validate sending application
"RTN","HLTPCK2A",61,0)
 I (ARY("SAN")']"") S:(ERR="") ERR="Invalid Sending Application" Q
"RTN","HLTPCK2A",62,0)
 S ARY("SAP")=0
"RTN","HLTPCK2A",63,0)
 S:(ARY("SAN")]"") ARY("SAP")=+$O(^HL(771,"B",$E(ARY("SAN"),1,30),0))
"RTN","HLTPCK2A",64,0)
 I (('ARY("SAP"))&(ARY("SAN")'="")) D
"RTN","HLTPCK2A",65,0)
 .S X=$$UPPER^HLFNC(ARY("SAN"))
"RTN","HLTPCK2A",66,0)
 .S ARY("SAP")=+$O(^HL(771,"B",$E(ARY("SAN"),1,30),0))
"RTN","HLTPCK2A",67,0)
 ;
"RTN","HLTPCK2A",68,0)
 ; patch HL*1.6*120 start
"RTN","HLTPCK2A",69,0)
 I ($L(ARY("SAN"),ECH(1))>1) D
"RTN","HLTPCK2A",70,0)
 . S ARY("SAN-SUB1")=$P(ARY("SAN"),ECH(1))
"RTN","HLTPCK2A",71,0)
 . S ARY("SAN-SUB2")=$P(ARY("SAN"),ECH(1),2)
"RTN","HLTPCK2A",72,0)
 . S ARY("SAN-SUB3")=$P(ARY("SAN"),ECH(1),3)
"RTN","HLTPCK2A",73,0)
 . I 'ARY("SAP"),ARY("SAN-SUB1")]"" D
"RTN","HLTPCK2A",74,0)
 .. S ARY("SAP")=+$O(^HL(771,"B",$E(ARY("SAN-SUB1"),1,30),0))
"RTN","HLTPCK2A",75,0)
 . I ARY("SAN-SUB1")["\" D
"RTN","HLTPCK2A",76,0)
 .. S ARY("SAN-SUB1-DEESCAPE")=$$DEESCAPE(ARY("SAN-SUB1"))
"RTN","HLTPCK2A",77,0)
 . I ARY("SAN-SUB2")["\" D
"RTN","HLTPCK2A",78,0)
 .. S ARY("SAN-SUB2-DEESCAPE")=$$DEESCAPE(ARY("SAN-SUB2"))
"RTN","HLTPCK2A",79,0)
 . I ARY("SAN-SUB3")["\" D
"RTN","HLTPCK2A",80,0)
 .. S ARY("SAN-SUB3-DEESCAPE")=$$DEESCAPE(ARY("SAN-SUB3"))
"RTN","HLTPCK2A",81,0)
 . I 'ARY("SAP"),$G(ARY("SAN-SUB1-DEESCAPE"))]"" D
"RTN","HLTPCK2A",82,0)
 .. S ARY("SAP")=+$O(^HL(771,"B",$E(ARY("SAN-SUB1-DEESCAPE"),1,30),0))
"RTN","HLTPCK2A",83,0)
 I ARY("SAN")["\" D
"RTN","HLTPCK2A",84,0)
 . S ARY("SAN-DEESCAPE")=$$DEESCAPE(ARY("SAN"))
"RTN","HLTPCK2A",85,0)
 I 'ARY("SAP"),$G(ARY("SAN-DEESCAPE"))]"" D
"RTN","HLTPCK2A",86,0)
 . S ARY("SAP")=+$O(^HL(771,"B",$E(ARY("SAN-DEESCAPE"),1,30),0))
"RTN","HLTPCK2A",87,0)
 ; patch HL*1.6*120 end
"RTN","HLTPCK2A",88,0)
 ;
"RTN","HLTPCK2A",89,0)
 I ('ARY("SAP")) S:(ERR="") ERR="Invalid Sending Application" Q
"RTN","HLTPCK2A",90,0)
 ;
"RTN","HLTPCK2A",91,0)
VN ;Validate version number
"RTN","HLTPCK2A",92,0)
 I (ARY("VER")="") S:(ERR="") ERR="Missing HL7 Version" Q
"RTN","HLTPCK2A",93,0)
 S X=0
"RTN","HLTPCK2A",94,0)
 S:(ARY("VER")'="") X=+$O(^HL(771.5,"B",ARY("VER"),0))
"RTN","HLTPCK2A",95,0)
 S ARY("VEP")=X
"RTN","HLTPCK2A",96,0)
 I ('X) S:(ERR="") ERR="Invalid HL7 Version" Q
"RTN","HLTPCK2A",97,0)
 ;I (X'=$P($G(HLN(770)),"^",10)) S:(ERR="") ERR="Invalid HL7 Version for Receiving Application" Q
"RTN","HLTPCK2A",98,0)
 ;
"RTN","HLTPCK2A",99,0)
ET ;Event Type Checks
"RTN","HLTPCK2A",100,0)
 ;
"RTN","HLTPCK2A",101,0)
 ;I ARY("ETN")="",ARY("VER")>2.1,$G(MSA)'="" D
"RTN","HLTPCK2A",102,0)
 ;. ;N Z,ZEP,ZP
"RTN","HLTPCK2A",103,0)
 ;. ;S Z=0 I $P(MSA,FS,2)]"" S Z=+$O(^HLMA("C",$P(MSA,FS,2),0))
"RTN","HLTPCK2A",104,0)
 ;. ;I '$G(^HLMA(Z,0)) S:(ERR="") ERR="Original Outgoing Message not found" Q
"RTN","HLTPCK2A",105,0)
 ;. ;S ZEP=$P(^HLMA(Z,0),U,8)
"RTN","HLTPCK2A",106,0)
 ;. ;I 'ZEP S:(ERR="") ERR="Event Protocol pointer (field #773,8) missing" Q
"RTN","HLTPCK2A",107,0)
 ;. ;S ZP=$G(^ORD(101,ZEP,770)),ARY("ETN")=$P($G(^HL(779.001,+$P(ZP,U,4),0)),U)
"RTN","HLTPCK2A",108,0)
 ;
"RTN","HLTPCK2A",109,0)
 ;Validate event type
"RTN","HLTPCK2A",110,0)
 I (ARY("ETN")=""),ARY("VER")>2.1,$G(MSA)="" S ERR="Event Type Required" Q
"RTN","HLTPCK2A",111,0)
 S ARY("ETP")=0
"RTN","HLTPCK2A",112,0)
 S:(ARY("ETN")'="") ARY("ETP")=+$O(^HL(779.001,"B",ARY("ETN"),0))
"RTN","HLTPCK2A",113,0)
 I $G(MSA)="",ARY("VER")>2.1,('ARY("ETP")) S ERR="Invalid Event Type" Q
"RTN","HLTPCK2A",114,0)
 ;
"RTN","HLTPCK2A",115,0)
 D ^HLTPCK2B
"RTN","HLTPCK2A",116,0)
 Q
"RTN","HLTPCK2A",117,0)
DEESCAPE(INPUT) ;
"RTN","HLTPCK2A",118,0)
 ; patch HL*1.6*120 - de-escape delimiters:
"RTN","HLTPCK2A",119,0)
 ; - field separator (de-escape from \F\)
"RTN","HLTPCK2A",120,0)
 ; - component separator (de-escape from \S\)
"RTN","HLTPCK2A",121,0)
 ; - repetition separator (de-escape from \R\)
"RTN","HLTPCK2A",122,0)
 ; - escape character (de-escape from \E\)
"RTN","HLTPCK2A",123,0)
 ; - subcomponent separator (de-escape from \T\)
"RTN","HLTPCK2A",124,0)
 ; \F\ will be de-escaped only if the length of FS is 1.
"RTN","HLTPCK2A",125,0)
 ; \S\,\R\,\E\,and \T\ will be de-escaped only if the length
"RTN","HLTPCK2A",126,0)
 ; of ECH is 4.
"RTN","HLTPCK2A",127,0)
 ;
"RTN","HLTPCK2A",128,0)
 ; input:
"RTN","HLTPCK2A",129,0)
 ; INPUT - input string to be de-escaped
"RTN","HLTPCK2A",130,0)
 ; FS - field separator
"RTN","HLTPCK2A",131,0)
 ; ECH - encoding 4 characters
"RTN","HLTPCK2A",132,0)
 ; 
"RTN","HLTPCK2A",133,0)
 ; output: de-escaped string
"RTN","HLTPCK2A",134,0)
 ;
"RTN","HLTPCK2A",135,0)
 N HLDATA,HLESCAPE,HLI,HLCHAR,HLCHAR23,HLEN,HLOUT
"RTN","HLTPCK2A",136,0)
 S HLDATA=$G(INPUT)
"RTN","HLTPCK2A",137,0)
 I $L($G(ECH))=4 D
"RTN","HLTPCK2A",138,0)
 . S ECH(1)=$E(ECH,1)
"RTN","HLTPCK2A",139,0)
 . S ECH(2)=$E(ECH,2)
"RTN","HLTPCK2A",140,0)
 . S ECH(3)=$E(ECH,3)
"RTN","HLTPCK2A",141,0)
 . S ECH(4)=$E(ECH,4)
"RTN","HLTPCK2A",142,0)
 Q:HLDATA']"" HLDATA
"RTN","HLTPCK2A",143,0)
 ;
"RTN","HLTPCK2A",144,0)
 S HLEN=$L(HLDATA)
"RTN","HLTPCK2A",145,0)
 S HLOUT=""
"RTN","HLTPCK2A",146,0)
 F HLI=1:1:HLEN D
"RTN","HLTPCK2A",147,0)
 . S HLCHAR=$E(HLDATA,HLI)
"RTN","HLTPCK2A",148,0)
 . I HLCHAR="\" D
"RTN","HLTPCK2A",149,0)
 . S HLCHAR23=$E(HLDATA,HLI+1,HLI+2)
"RTN","HLTPCK2A",150,0)
 . I $L($G(FS))=1,(HLCHAR23="F\") D  Q
"RTN","HLTPCK2A",151,0)
 .. S HLOUT=HLOUT_FS
"RTN","HLTPCK2A",152,0)
 .. S HLI=HLI+2
"RTN","HLTPCK2A",153,0)
 . I $L($G(ECH))=4,(HLCHAR23="S\") D  Q
"RTN","HLTPCK2A",154,0)
 .. S HLOUT=HLOUT_ECH(1)
"RTN","HLTPCK2A",155,0)
 .. S HLI=HLI+2
"RTN","HLTPCK2A",156,0)
 . I $L($G(ECH))=4,(HLCHAR23="R\") D  Q
"RTN","HLTPCK2A",157,0)
 .. S HLOUT=HLOUT_ECH(2)
"RTN","HLTPCK2A",158,0)
 .. S HLI=HLI+2
"RTN","HLTPCK2A",159,0)
 . I $L($G(ECH))=4,(HLCHAR23="E\") D  Q
"RTN","HLTPCK2A",160,0)
 .. S HLOUT=HLOUT_ECH(3)
"RTN","HLTPCK2A",161,0)
 .. S HLI=HLI+2
"RTN","HLTPCK2A",162,0)
 . I $L($G(ECH))=4,(HLCHAR23="T\") D  Q
"RTN","HLTPCK2A",163,0)
 .. S HLOUT=HLOUT_ECH(4)
"RTN","HLTPCK2A",164,0)
 .. S HLI=HLI+2
"RTN","HLTPCK2A",165,0)
 . S HLOUT=HLOUT_HLCHAR
"RTN","HLTPCK2A",166,0)
 ;
"RTN","HLTPCK2A",167,0)
 Q HLOUT
"RTN","HLTPCK2B")
0^13^B63390233
"RTN","HLTPCK2B",1,0)
HLTPCK2B ;OIFO-O/RJH - Message Header Validation (Con't) ;03/06/2006  15:48
"RTN","HLTPCK2B",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**120**;Oct 13, 1995;Build 12
"RTN","HLTPCK2B",3,0)
 ;
"RTN","HLTPCK2B",4,0)
 ; splitted from HLTPCK2A
"RTN","HLTPCK2B",5,0)
 ; to be called from HLTPCK2A
"RTN","HLTPCK2B",6,0)
 ;
"RTN","HLTPCK2B",7,0)
MS ;Check for Message Structure Code
"RTN","HLTPCK2B",8,0)
 I $G(ARY("MTN_ETN"))'="" D
"RTN","HLTPCK2B",9,0)
 . S ARY("MTP_ETP")=0
"RTN","HLTPCK2B",10,0)
 . S ARY("MTP_ETP")=+$O(^HL(779.005,"B",ARY("MTN_ETN"),0))
"RTN","HLTPCK2B",11,0)
 . I ('ARY("MTP_ETP")) S:(ERR="") ERR="Invalid Message Structure Code" Q
"RTN","HLTPCK2B",12,0)
 ;
"RTN","HLTPCK2B",13,0)
 ;Get server and client Protocols
"RTN","HLTPCK2B",14,0)
MSA ;if ack, then get information and quit, we don't need to respond
"RTN","HLTPCK2B",15,0)
 I $G(MSA)]"" D  Q
"RTN","HLTPCK2B",16,0)
 . ;Message is an acknowledgement, find original message
"RTN","HLTPCK2B",17,0)
 . S ARY("MSAID")=$P(MSA,FS,2),ARY("MTIENS")=0
"RTN","HLTPCK2B",18,0)
 . I ARY("MSAID")="" S:(ERR="") ERR="Invalid Message Control ID in MSA Segment " Q
"RTN","HLTPCK2B",19,0)
 . F  S ARY("MTIENS")=+$O(^HLMA("AH",ARY("SAP"),ARY("MSAID"),ARY("MTIENS"))) Q:'ARY("MTIENS")!($P($G(^HLMA(ARY("MTIENS"),0)),U,3)="O")
"RTN","HLTPCK2B",20,0)
 . I 'ARY("MTIENS") S:(ERR="") ERR="Invalid Message Control ID in MSA Segment" Q
"RTN","HLTPCK2B",21,0)
 . ;get subscriber protocol and ack. to (show if this is an ack to an ack)
"RTN","HLTPCK2B",22,0)
 . S X=$G(^HLMA(ARY("MTIENS"),0)),ARY("EIDS")=$P(X,U,8),ARY("ACK")=$P(X,U,10)
"RTN","HLTPCK2B",23,0)
 . ;if no subscriber protocol then response msg. is invalid
"RTN","HLTPCK2B",24,0)
 . I ('ARY("EIDS")) S:(ERR="") ERR="Invalid Message Control ID in MSA Segment" Q
"RTN","HLTPCK2B",25,0)
 . ;get message text ien in file 772 and server protocol, 'EID'
"RTN","HLTPCK2B",26,0)
 . S ARY("MTIEN")=+X,X=$G(^HL(772,+X,0)),ARY("EID")=$P(X,U,10)
"RTN","HLTPCK2B",27,0)
 . I ('ARY("EID")) S:(ERR="") ERR="Event Protocol not found" Q
"RTN","HLTPCK2B",28,0)
 . D EVENT^HLUTIL1(ARY("EIDS"),"770,773",.HLN)
"RTN","HLTPCK2B",29,0)
 ;
"RTN","HLTPCK2B",30,0)
 ;Find Server Protocol - based on sending application, message type,
"RTN","HLTPCK2B",31,0)
 ;event type and version ID
"RTN","HLTPCK2B",32,0)
 I ARY("ETP") S ARY("EID")=+$O(^ORD(101,"AHL1",ARY("SAP"),ARY("MTP"),ARY("ETP"),ARY("VEP"),0))
"RTN","HLTPCK2B",33,0)
 ;
"RTN","HLTPCK2B",34,0)
 ;Find Server Protocol - based on sending application, message type,
"RTN","HLTPCK2B",35,0)
 ;and version ID
"RTN","HLTPCK2B",36,0)
 I 'ARY("ETP") S ARY("EID")=+$O(^ORD(101,"AHL21",ARY("SAP"),ARY("MTP"),ARY("VEP"),0))
"RTN","HLTPCK2B",37,0)
 ;
"RTN","HLTPCK2B",38,0)
 I ('ARY("EID")) S:(ERR="") ERR="Event Protocol not found" Q
"RTN","HLTPCK2B",39,0)
 ;Find Client Protocol - in ITEM multiple of Server Protocol
"RTN","HLTPCK2B",40,0)
 S ARY("EIDS")=0
"RTN","HLTPCK2B",41,0)
 F  S ARY("EIDS")=+$O(^ORD(101,ARY("EID"),775,"B",ARY("EIDS"))) Q:'ARY("EIDS")!($P($G(^ORD(101,ARY("EIDS"),770)),U,2)=ARY("RAP"))
"RTN","HLTPCK2B",42,0)
 I 'ARY("EIDS") S ERR="Invalid Receiving Application for this Event" Q
"RTN","HLTPCK2B",43,0)
 D EVENT^HLUTIL1(ARY("EIDS"),"770,773",.HLN)
"RTN","HLTPCK2B",44,0)
 ;
"RTN","HLTPCK2B",45,0)
LLP ;Get logical link pointer
"RTN","HLTPCK2B",46,0)
 S ARY("LL")=$P($G(HLN(770)),"^",7)
"RTN","HLTPCK2B",47,0)
 ;
"RTN","HLTPCK2B",48,0)
FAC ;Get sending/rec facility, validate if necessary
"RTN","HLTPCK2B",49,0)
 ;
"RTN","HLTPCK2B",50,0)
 S HLCS=$E(ECH,1) ;Get component separator
"RTN","HLTPCK2B",51,0)
 S ARY("RAF")=$$P^HLTPCK2(.HDR,6) ;Receiving Facility
"RTN","HLTPCK2B",52,0)
 S ARY("SAF")=$$P^HLTPCK2(.HDR,4) ;Sending Facility
"RTN","HLTPCK2B",53,0)
 ;Get sending/receiving facility from Application Parameter file(771)
"RTN","HLTPCK2B",54,0)
 S HL771SF=$P($G(^HL(771,ARY("SAP"),0)),U,3)
"RTN","HLTPCK2B",55,0)
 S HL771RF=$P($G(^HL(771,ARY("RAP"),0)),U,3)
"RTN","HLTPCK2B",56,0)
 ;Sending/Receiving facility required?
"RTN","HLTPCK2B",57,0)
 S X=$G(^ORD(101,ARY("EIDS"),773))
"RTN","HLTPCK2B",58,0)
 S HLSFREQ=+X,HLRFREQ=+$P(X,U,2)
"RTN","HLTPCK2B",59,0)
RF ;Validate Receiving Facility
"RTN","HLTPCK2B",60,0)
 I HLRFREQ D
"RTN","HLTPCK2B",61,0)
 .I ARY("RAF")="" S:ERR="" ERR="Missing required receiving facility"
"RTN","HLTPCK2B",62,0)
 .I HL771RF]"" D  Q
"RTN","HLTPCK2B",63,0)
 ..;Facility data in 771 overrides data in site paramter file
"RTN","HLTPCK2B",64,0)
 ..Q
"RTN","HLTPCK2B",65,0)
 .;Check against local default value (site parameters)
"RTN","HLTPCK2B",66,0)
 .Q:ARY("RAF")=(HLINSTN_HLCS_HLDOM_HLCS_"DNS")
"RTN","HLTPCK2B",67,0)
 .;
"RTN","HLTPCK2B",68,0)
 .; patch HL*1.6*120 start
"RTN","HLTPCK2B",69,0)
 .; I $P(ARY("RAF"),HLCS)=HLINSTN,$P(ARY("RAF"),HLCS,3)="DNS" D  Q
"RTN","HLTPCK2B",70,0)
 . I $P(ARY("RAF"),HLCS,3)="DNS" D  Q
"RTN","HLTPCK2B",71,0)
 .. N ERROR,HLDOMP1,HLDOMP2
"RTN","HLTPCK2B",72,0)
 .. ; S HLDOMP1=$P(ARY("RAF"),HLCS,2),HLDOMP1=$$FIND1^DIC(4.2,"","BMX",HLDOMP1,"B^C","","ERROR")
"RTN","HLTPCK2B",73,0)
 .. S HLDOMP1=$P(ARY("RAF"),HLCS,2)
"RTN","HLTPCK2B",74,0)
 .. ;
"RTN","HLTPCK2B",75,0)
 .. ; assume the format is <domain>:<port #>
"RTN","HLTPCK2B",76,0)
 .. I HLDOMP1[":" S ARY("RAF-PORT")=$P(HLDOMP1,":",2)
"RTN","HLTPCK2B",77,0)
 .. S HLDOMP1=$P(HLDOMP1,":")
"RTN","HLTPCK2B",78,0)
 .. S ARY("RAF-DOMAIN")=HLDOMP1
"RTN","HLTPCK2B",79,0)
 .. ;
"RTN","HLTPCK2B",80,0)
 .. ; if first piece of domain is "HL7." or "MPI.", remove it
"RTN","HLTPCK2B",81,0)
 .. I ($E(HLDOMP1,1,4)="HL7.")!($E(HLDOMP1,1,4)="MPI.") D
"RTN","HLTPCK2B",82,0)
 ... S HLDOMP1=$P(HLDOMP1,".",2,99)
"RTN","HLTPCK2B",83,0)
 .. S HLDOMP1=$$FIND1^DIC(4.2,"","BMX",HLDOMP1,"B^C","","ERROR")
"RTN","HLTPCK2B",84,0)
 .. S HLDOMP2=HLDOM,HLDOMP2=$$FIND1^DIC(4.2,"","BMX",HLDOMP2,"B^C","","ERROR")
"RTN","HLTPCK2B",85,0)
 .. I HLDOMP1&HLDOMP2&(HLDOMP1=HLDOMP2) Q
"RTN","HLTPCK2B",86,0)
 .. ;
"RTN","HLTPCK2B",87,0)
 .. ; check DNS domain and ip address
"RTN","HLTPCK2B",88,0)
 .. ;initialize variable, HLDOMP("FLAG")
"RTN","HLTPCK2B",89,0)
 .. S HLDOMP("FLAG")=0
"RTN","HLTPCK2B",90,0)
 .. I ARY("RAF-DOMAIN")]"" D
"RTN","HLTPCK2B",91,0)
 ... ;
"RTN","HLTPCK2B",92,0)
 ... ; match DNS domain
"RTN","HLTPCK2B",93,0)
 ... I $D(^HLCS(870,"DNS",ARY("RAF-DOMAIN"))) D  Q
"RTN","HLTPCK2B",94,0)
 .... S HLDOMP("FLAG")=1
"RTN","HLTPCK2B",95,0)
 .... S ARY("RAF-LL")=+$O(^HLCS(870,"DNS",ARY("RAF-DOMAIN"),0))
"RTN","HLTPCK2B",96,0)
 ... I $D(^HLCS(870,"DNS",$$UP^XLFSTR(ARY("RAF-DOMAIN")))) D  Q
"RTN","HLTPCK2B",97,0)
 .... S HLDOMP("FLAG")=1
"RTN","HLTPCK2B",98,0)
 .... S ARY("RAF-LL")=+$O(^HLCS(870,"DNS",$$UP^XLFSTR(ARY("RAF-DOMAIN")),0))
"RTN","HLTPCK2B",99,0)
 ... I $D(^HLCS(870,"DNS",$$LOW^XLFSTR(ARY("RAF-DOMAIN")))) D  Q
"RTN","HLTPCK2B",100,0)
 .... S HLDOMP("FLAG")=1
"RTN","HLTPCK2B",101,0)
 .... S ARY("RAF-LL")=+$O(^HLCS(870,"DNS",$$LOW^XLFSTR(ARY("RAF-DOMAIN")),0))
"RTN","HLTPCK2B",102,0)
 ... ;
"RTN","HLTPCK2B",103,0)
 ... ; match ip address
"RTN","HLTPCK2B",104,0)
 ... I $D(^HLCS(870,"IP",ARY("RAF-DOMAIN"))) D  Q
"RTN","HLTPCK2B",105,0)
 .... S HLDOMP("FLAG")=1
"RTN","HLTPCK2B",106,0)
 .... S ARY("RAF-LL")=+$O(^HLCS(870,"IP",ARY("RAF-DOMAIN"),0))
"RTN","HLTPCK2B",107,0)
 .. Q:HLDOMP("FLAG")=1
"RTN","HLTPCK2B",108,0)
 .. I $P(ARY("RAF"),HLCS)=HLINSTN Q
"RTN","HLTPCK2B",109,0)
 .. ;
"RTN","HLTPCK2B",110,0)
 .. S:ERR="" ERR="Receiving Facility mismatch."
"RTN","HLTPCK2B",111,0)
 . I $P(ARY("RAF"),HLCS)=HLINSTN Q
"RTN","HLTPCK2B",112,0)
 . S:ERR="" ERR="Receiving Facility mismatch."
"RTN","HLTPCK2B",113,0)
 ; patch HL*1.6*120 end
"RTN","HLTPCK2B",114,0)
 ;
"RTN","HLTPCK2B",115,0)
SF ;Validate Sending Facility
"RTN","HLTPCK2B",116,0)
 I HLSFREQ D
"RTN","HLTPCK2B",117,0)
 .I ARY("SAF")="" S:ERR="" ERR="Missing required sending facility"
"RTN","HLTPCK2B",118,0)
 .I HL771SF]"" D  Q
"RTN","HLTPCK2B",119,0)
 ..;Check for facility data in 771
"RTN","HLTPCK2B",120,0)
 ..Q
"RTN","HLTPCK2B",121,0)
 .;If default value was sent, validate that DOMAIN RESOLVES TO LOGICAL LINK
"RTN","HLTPCK2B",122,0)
 .;If so, use this instead of Protocol definition for return path
"RTN","HLTPCK2B",123,0)
 .;
"RTN","HLTPCK2B",124,0)
 .; patch HL*1.6*120 start
"RTN","HLTPCK2B",125,0)
 . N HLDOMP
"RTN","HLTPCK2B",126,0)
 . ; S HLDOMP=$P(ARY("SAF"),HLCS,2),HLDOMP=$$FIND1^DIC(4.2,"","BMX",HLDOMP,"B^C","","ERROR")
"RTN","HLTPCK2B",127,0)
 . S HLDOMP=$P(ARY("SAF"),HLCS,2)
"RTN","HLTPCK2B",128,0)
 . ;
"RTN","HLTPCK2B",129,0)
 . ; assume the format is <domain>:<port #>
"RTN","HLTPCK2B",130,0)
 . I HLDOMP[":" S ARY("SAF-PORT")=$P(HLDOMP,":",2)
"RTN","HLTPCK2B",131,0)
 . S HLDOMP=$P(HLDOMP,":")
"RTN","HLTPCK2B",132,0)
 . S ARY("SAF-DOMAIN")=HLDOMP
"RTN","HLTPCK2B",133,0)
 . ;
"RTN","HLTPCK2B",134,0)
 . ; if first piece of domain is "HL7." or "MPI.", remove it
"RTN","HLTPCK2B",135,0)
 . I ($E(HLDOMP,1,4)="HL7.")!($E(HLDOMP,1,4)="MPI.") D
"RTN","HLTPCK2B",136,0)
 .. S HLDOMP=$P(HLDOMP,".",2,99)
"RTN","HLTPCK2B",137,0)
 . S HLDOMP=$$FIND1^DIC(4.2,"","BMX",HLDOMP,"B^C","","ERROR")
"RTN","HLTPCK2B",138,0)
 .;Note: This expects a unique domain in domain file. Multiple entries will fail
"RTN","HLTPCK2B",139,0)
 . ; I 'HLDOMP S:ERR="" ERR="Unrecognized/ambiguous domain in sending facility"
"RTN","HLTPCK2B",140,0)
 . ;
"RTN","HLTPCK2B",141,0)
 . ; check DNS domain and ip address
"RTN","HLTPCK2B",142,0)
 . I 'HLDOMP D
"RTN","HLTPCK2B",143,0)
 .. ;
"RTN","HLTPCK2B",144,0)
 .. ;initialize variable, HLDOMP("FLAG")
"RTN","HLTPCK2B",145,0)
 .. S HLDOMP("FLAG")=0
"RTN","HLTPCK2B",146,0)
 .. I ARY("SAF-DOMAIN")]"" D
"RTN","HLTPCK2B",147,0)
 ... ;
"RTN","HLTPCK2B",148,0)
 ... ; match DNS domain
"RTN","HLTPCK2B",149,0)
 ... I $D(^HLCS(870,"DNS",ARY("SAF-DOMAIN"))) D  Q
"RTN","HLTPCK2B",150,0)
 .... S HLDOMP("FLAG")=1
"RTN","HLTPCK2B",151,0)
 .... S ARY("SAF-LL")=+$O(^HLCS(870,"DNS",ARY("SAF-DOMAIN"),0))
"RTN","HLTPCK2B",152,0)
 ... I $D(^HLCS(870,"DNS",$$UP^XLFSTR(ARY("SAF-DOMAIN")))) D  Q
"RTN","HLTPCK2B",153,0)
 .... S HLDOMP("FLAG")=1
"RTN","HLTPCK2B",154,0)
 .... S ARY("SAF-LL")=+$O(^HLCS(870,"DNS",$$UP^XLFSTR(ARY("SAF-DOMAIN")),0))
"RTN","HLTPCK2B",155,0)
 ... I $D(^HLCS(870,"DNS",$$LOW^XLFSTR(ARY("SAF-DOMAIN")))) D  Q
"RTN","HLTPCK2B",156,0)
 .... S HLDOMP("FLAG")=1
"RTN","HLTPCK2B",157,0)
 .... S ARY("SAF-LL")=+$O(^HLCS(870,"DNS",$$LOW^XLFSTR(ARY("SAF-DOMAIN")),0))
"RTN","HLTPCK2B",158,0)
 ... ;
"RTN","HLTPCK2B",159,0)
 ... ; match ip address
"RTN","HLTPCK2B",160,0)
 ... I $D(^HLCS(870,"IP",ARY("SAF-DOMAIN"))) D  Q
"RTN","HLTPCK2B",161,0)
 .... S HLDOMP("FLAG")=1
"RTN","HLTPCK2B",162,0)
 .... S ARY("SAF-LL")=+$O(^HLCS(870,"IP",ARY("SAF-DOMAIN"),0))
"RTN","HLTPCK2B",163,0)
 .. Q:HLDOMP("FLAG")=1
"RTN","HLTPCK2B",164,0)
 .. ; quit if 1st component defined
"RTN","HLTPCK2B",165,0)
 .. S ARY("SAF-COMPONENT1")=$P(ARY("SAF"),HLCS,1)
"RTN","HLTPCK2B",166,0)
 .. Q:ARY("SAF-COMPONENT1")]""
"RTN","HLTPCK2B",167,0)
 .. S:ERR="" ERR="Receiving Facility mismatch."
"RTN","HLTPCK2B",168,0)
 . ; patch HL*1.6*120 end
"RTN","HLTPCK2B",169,0)
 . ;
"RTN","HLTPCK2B",170,0)
 .Q:HLDOMP=$P(HLPARAM,U)  ;This is local app to app
"RTN","HLTPCK2B",171,0)
 .I HLDOMP N HLNK S HLNK=+$O(^HLCS(870,"D",HLDOMP,0))
"RTN","HLTPCK2B",172,0)
 .I $G(HLNK) S ARY("LL")=HLNK
"RTN","HLTPCK2B",173,0)
 ;
"RTN","HLTPCK2B",174,0)
PID ;Validate processing ID
"RTN","HLTPCK2B",175,0)
 I ("DTP"'[ARY("PID")) S:(ERR="") ERR="Invalid HL7 Processing ID"
"RTN","HLTPCK2B",176,0)
 S HLPID=$P(HLPARAM,U,3) ;site param
"RTN","HLTPCK2B",177,0)
 S X=$G(^ORD(101,ARY("EID"),770)),X=$P(X,U,6) ;event driver
"RTN","HLTPCK2B",178,0)
 ;If message is 'debug' then event driver must be 'debug.'
"RTN","HLTPCK2B",179,0)
 ;If message is 'test' or 'production', then site param must match
"RTN","HLTPCK2B",180,0)
 I ARY("PID")="D"&(X'="D") S:ERR="" ERR="Processing ID Mismatch with Event Driver"
"RTN","HLTPCK2B",181,0)
 I ARY("PID")'="D"&(HLPID'=ARY("PID")) S:ERR="" ERR="Processing ID Mismatch with Site Parameters"
"RTN","HLTPCK2B",182,0)
 ;
"RTN","HLTPCK2B",183,0)
SEC ;Validate security field - access code and electronic signature
"RTN","HLTPCK2B",184,0)
 I ($P($G(HLN(773)),"^",3)) D
"RTN","HLTPCK2B",185,0)
 .S X=$P($$P^HLTPCK2(.HDR,8),$E(ECH))
"RTN","HLTPCK2B",186,0)
 .S X=$$UPPER^HLFNC(X)
"RTN","HLTPCK2B",187,0)
 .D ^XUSHSH
"RTN","HLTPCK2B",188,0)
 .I X="",(MSA="") S:(ERR="") ERR="Invalid access code" Q
"RTN","HLTPCK2B",189,0)
 .S ARY("DUZ")=0
"RTN","HLTPCK2B",190,0)
 .S:(X'="") ARY("DUZ")=+$O(^VA(200,"A",X,0))
"RTN","HLTPCK2B",191,0)
 .I ('ARY("DUZ")) S:(ERR="") ERR="Invalid access code" Q
"RTN","HLTPCK2B",192,0)
 .I (($P($G(^VA(200,ARY("DUZ"),.1)),"^")="")&('$D(MSA))) S ARY("DUZ")=0 S:(ERR="") ERR="Invalid access code" Q
"RTN","HLTPCK2B",193,0)
 .S X=$P($$P^HLTPCK2(.HDR,8),$E(ECH),3) I (X'="") D
"RTN","HLTPCK2B",194,0)
 ..S X1=$G(^VA(200,ARY("DUZ"),20))
"RTN","HLTPCK2B",195,0)
 ..I (X1="") S:(ERR="") ERR="No Signature Code on File" Q
"RTN","HLTPCK2B",196,0)
 ..S X=$$UPPER^HLFNC(X)
"RTN","HLTPCK2B",197,0)
 ..D HASH^XUSHSHP
"RTN","HLTPCK2B",198,0)
 ..I ((X'=$P(X1,"^",4))!($P(X1,"^",2)="")) S:(ERR="") ERR="Invalid Electronic Signature Code" Q
"RTN","HLTPCK2B",199,0)
 ..S ARY("ESIG")=$P(X1,"^",2)
"RTN","HLTPCK2B",200,0)
 I $D(ARY) M HLREC=ARY
"RTN","HLTPCK2B",201,0)
 Q
"RTN","HLUTIL2")
0^7^B29544975^B29017820
"RTN","HLUTIL2",1,0)
HLUTIL2 ;ALB/MFK/MTC/JC - VARIOUS HL7 UTILITIES ;01/13/2006  16:06
"RTN","HLUTIL2",2,0)
 ;;1.6;HEALTH LEVEL SEVEN;**19,43,57,59,120**;;Build 12
"RTN","HLUTIL2",3,0)
ITEM(IEN,ROUTINE) ; Return data from ITEM multiple in protocol file
"RTN","HLUTIL2",4,0)
 ; INPUT : IEN - Internal Entry Number for 101 (Protocol) file.
"RTN","HLUTIL2",5,0)
 ;         ROUTINE - name of a routine to run (either PTR or TYPE)
"RTN","HLUTIL2",6,0)
 ;OUTPUT : HLARY - Array of IENs from ITEM multiple
"RTN","HLUTIL2",7,0)
 ;  HLARY is of the form:
"RTN","HLUTIL2",8,0)
 ; HLARY(0)=Total number of items found
"RTN","HLUTIL2",9,0)
 ; HLARY(IEN)=Results from function
"RTN","HLUTIL2",10,0)
 N ITEM,LINE,MSG,PTR
"RTN","HLUTIL2",11,0)
 S IEN=$G(IEN)
"RTN","HLUTIL2",12,0)
 Q:(IEN="")
"RTN","HLUTIL2",13,0)
 S ROUTINE=$G(ROUTINE)
"RTN","HLUTIL2",14,0)
 S ROUTINE=$S(ROUTINE="PTR":1,ROUTINE="TYPE":2,ROUTINE=1:1,ROUTINE=2:2,1:"")
"RTN","HLUTIL2",15,0)
 Q:(ROUTINE="")
"RTN","HLUTIL2",16,0)
 S ITEM="",MSG=0
"RTN","HLUTIL2",17,0)
 ;  Loop through IENs within Subscriber multiple
"RTN","HLUTIL2",18,0)
 F  S ITEM=$O(^ORD(101,IEN,775,ITEM)) Q:(ITEM="")  D
"RTN","HLUTIL2",19,0)
 .S PTR=$P($G(^ORD(101,IEN,775,ITEM,0)),"^",1)
"RTN","HLUTIL2",20,0)
 .;  Call type to get info on that item
"RTN","HLUTIL2",21,0)
 .S:(ROUTINE=1) LINE=$$PTR(PTR)
"RTN","HLUTIL2",22,0)
 .S:(ROUTINE=2) LINE=$$TYPE(PTR)
"RTN","HLUTIL2",23,0)
 .;  Make sure LINE isn't error code
"RTN","HLUTIL2",24,0)
 .I ((+LINE)>(-1)) S MSG=MSG+1 S HLARY(PTR)=LINE
"RTN","HLUTIL2",25,0)
 S HLARY(0)=MSG
"RTN","HLUTIL2",26,0)
 K ROUTINE
"RTN","HLUTIL2",27,0)
 Q
"RTN","HLUTIL2",28,0)
PTR(IEN) ;  Return pointer information if subscriber
"RTN","HLUTIL2",29,0)
 ; INPUT - IEN: IEN of protocol file
"RTN","HLUTIL2",30,0)
 ;OUTPUT - Line from ^ORD(101,IEN,770):
"RTN","HLUTIL2",31,0)
 ; CLIENT^LOGICAL_LINK (both pointers)
"RTN","HLUTIL2",32,0)
 N RETURN,LINE,TYPE
"RTN","HLUTIL2",33,0)
 S IEN=$G(IEN)
"RTN","HLUTIL2",34,0)
 Q:(IEN="") "-1"
"RTN","HLUTIL2",35,0)
 ;  Make sure this is a subscriber type
"RTN","HLUTIL2",36,0)
 S TYPE=$P($G(^ORD(101,IEN,0)),"^",4)
"RTN","HLUTIL2",37,0)
 Q:(TYPE'="S") "-2"
"RTN","HLUTIL2",38,0)
 S LINE=$G(^ORD(101,IEN,770))
"RTN","HLUTIL2",39,0)
 S RETURN=$P(LINE,"^",2)_"^"_$P(LINE,"^",7)
"RTN","HLUTIL2",40,0)
 Q RETURN
"RTN","HLUTIL2",41,0)
TYPE(IEN) ;  Return portions of protocol file
"RTN","HLUTIL2",42,0)
 ; INPUT - IEN: IEN of protocol file
"RTN","HLUTIL2",43,0)
 ;OUTPUT - Line containing the following information from the protocol
"RTN","HLUTIL2",44,0)
 ;         file (#101)
"RTN","HLUTIL2",45,0)
 ;
"RTN","HLUTIL2",46,0)
 ; Client ^ Message Type Received ^ Event Type ^ Message Structure ^
"RTN","HLUTIL2",47,0)
 ;  Processing ID ^ Logical Link Pointer ^ Accept Ack ^
"RTN","HLUTIL2",48,0)
 ;  Application Ack ^ Version ^ Message Type Generated
"RTN","HLUTIL2",49,0)
 ;
"RTN","HLUTIL2",50,0)
 N RETURN,CLP,MTPR,ETP,LINE,TYPE,CLIENT,EVENT,MTPEVP
"RTN","HLUTIL2",51,0)
 N ACCACK,APPACK,VERID,VERIDP,ACKP,ACKTYP,MTPG,MTNEVN
"RTN","HLUTIL2",52,0)
 ;-- check if ien was passed in
"RTN","HLUTIL2",53,0)
 S IEN=$G(IEN)
"RTN","HLUTIL2",54,0)
 Q:(IEN="") "-1"
"RTN","HLUTIL2",55,0)
 ;
"RTN","HLUTIL2",56,0)
 ;  Null any variables in case they don't exist
"RTN","HLUTIL2",57,0)
 S (CLIENT,TYPE,EVENT,ACCACK,APPACK,VERID,MTPG,MTNEVN)=""
"RTN","HLUTIL2",58,0)
 ;  Get line from protocol file
"RTN","HLUTIL2",59,0)
 S LINE=$G(^ORD(101,IEN,770))
"RTN","HLUTIL2",60,0)
 ;
"RTN","HLUTIL2",61,0)
 ;-- get client (application that will receive the message
"RTN","HLUTIL2",62,0)
 S CLP=$P(LINE,U,2)
"RTN","HLUTIL2",63,0)
 S:(CLP) CLIENT=$P($G(^HL(771,CLP,0)),U,1)
"RTN","HLUTIL2",64,0)
 ;
"RTN","HLUTIL2",65,0)
 ;-- get message type received & generated
"RTN","HLUTIL2",66,0)
 S MTPR=$P(LINE,U,3)
"RTN","HLUTIL2",67,0)
 S MTPG=$P(LINE,U,11)
"RTN","HLUTIL2",68,0)
 S:(MTPR) MTPR=$P($G(^HL(771.2,MTPR,0)),U,1)
"RTN","HLUTIL2",69,0)
 S:(MTPG) MTPG=$P($G(^HL(771.2,MTPG,0)),U,1)
"RTN","HLUTIL2",70,0)
 ;
"RTN","HLUTIL2",71,0)
 ;-- get event type
"RTN","HLUTIL2",72,0)
 S ETP=$P(LINE,U,4)
"RTN","HLUTIL2",73,0)
 S:(ETP) EVENT=$P($G(^HL(779.001,ETP,0)),U,1)
"RTN","HLUTIL2",74,0)
 ;
"RTN","HLUTIL2",75,0)
 ;-- get message structure code
"RTN","HLUTIL2",76,0)
 S MTPEVP=$P(LINE,U,5)
"RTN","HLUTIL2",77,0)
 S:(MTPEVP) MTNEVN=$P($G(^HL(779.005,MTPEVP,0)),U,1)
"RTN","HLUTIL2",78,0)
 ;
"RTN","HLUTIL2",79,0)
 ;-- accept acknowledgement
"RTN","HLUTIL2",80,0)
 S ACKP=$P(LINE,U,8)
"RTN","HLUTIL2",81,0)
 S:(ACKP) ACCACK=$P($G(^HL(779.003,ACKP,0)),U,1)
"RTN","HLUTIL2",82,0)
 ;
"RTN","HLUTIL2",83,0)
 ;-- application acknowledgement
"RTN","HLUTIL2",84,0)
 S ACKTYP=$P(LINE,U,9)
"RTN","HLUTIL2",85,0)
 S:(ACKTYP) APPACK=$P($G(^HL(779.003,ACKTYP,0)),U,1)
"RTN","HLUTIL2",86,0)
 ;
"RTN","HLUTIL2",87,0)
 ;-- version of HL7
"RTN","HLUTIL2",88,0)
 S VERIDP=$P(LINE,U,10)
"RTN","HLUTIL2",89,0)
 S:(VERIDP) VERID=$P($G(^HL(771.5,VERIDP,0)),U,1)
"RTN","HLUTIL2",90,0)
 ;
"RTN","HLUTIL2",91,0)
 ;-- build return string
"RTN","HLUTIL2",92,0)
 S RETURN=CLIENT_U_MTPR_U_EVENT
"RTN","HLUTIL2",93,0)
 ;-- 6 processing id, 7 logical link pointer
"RTN","HLUTIL2",94,0)
 S RETURN=RETURN_U_MTNEVN_U_$P(LINE,U,6)_U_$P(LINE,U,7)
"RTN","HLUTIL2",95,0)
 S RETURN=RETURN_U_ACCACK_U_APPACK_U_VERID_U_MTPG
"RTN","HLUTIL2",96,0)
 Q RETURN
"RTN","HLUTIL2",97,0)
 ;
"RTN","HLUTIL2",98,0)
MSGADM(IEN) ; RETURN DATE/TIME ENTERED AND MSGID FROM FILE 773
"RTN","HLUTIL2",99,0)
 N X
"RTN","HLUTIL2",100,0)
 Q:'$G(^HLMA(+$G(IEN),0)) "-1"  S X=^(0)
"RTN","HLUTIL2",101,0)
 Q $P($G(^HL(772,+X,0)),"^")_"^"_$P(X,"^",2)
"RTN","HLUTIL2",102,0)
 ;
"RTN","HLUTIL2",103,0)
APPPRM(IEN) ; RETURN DATA FROM THE APPLICATION PARAMETER FILE
"RTN","HLUTIL2",104,0)
 N LINE,COUNTRYP,COUNTRY
"RTN","HLUTIL2",105,0)
 S IEN=$G(IEN)
"RTN","HLUTIL2",106,0)
 Q:(IEN="")
"RTN","HLUTIL2",107,0)
 S LINE=$G(^HL(771,IEN,0))
"RTN","HLUTIL2",108,0)
 S COUNTRYP=$P(LINE,"^",7),COUNTRY=""
"RTN","HLUTIL2",109,0)
 ;
"RTN","HLUTIL2",110,0)
 ; patch HL*1.6*120 - for deleting "US" entry from #779.004
"RTN","HLUTIL2",111,0)
 ; I COUNTRYP]"" S COUNTRY=$P(^HL(779.004,COUNTRYP,0),"^",1)
"RTN","HLUTIL2",112,0)
 I COUNTRYP]"" S COUNTRY=$P($G(^HL(779.004,COUNTRYP,0)),"^",1)
"RTN","HLUTIL2",113,0)
 ;
"RTN","HLUTIL2",114,0)
 S APPPRM(IEN,0)=$P(LINE,"^",1)_"^"_$P(LINE,"^",3)_"^"_COUNTRY
"RTN","HLUTIL2",115,0)
 S APPPRM(IEN,"EC")=$G(^HL(771,IEN,"EC"))
"RTN","HLUTIL2",116,0)
 S:(APPPRM(IEN,"EC")="") APPPRM(IEN,"EC")="~|\&"
"RTN","HLUTIL2",117,0)
 S APPPRM(IEN,"FS")=$G(^HL(771,IEN,"FS"))
"RTN","HLUTIL2",118,0)
 S:(APPPRM(IEN,"FS")="") APPPRM(IEN,"FS")="^"
"RTN","HLUTIL2",119,0)
 Q
"RTN","HLUTIL2",120,0)
CLRQUE ; Clear a queue by menu option
"RTN","HLUTIL2",121,0)
 N DIC,DIR,DIRUT,HLDIR,HLERR,HLIEN,HLL,HLLTC,X,Y
"RTN","HLUTIL2",122,0)
 S DIC="^HLCS(870,",DIC(0)="AEQMZ"
"RTN","HLUTIL2",123,0)
 D ^DIC Q:Y<0
"RTN","HLUTIL2",124,0)
 K DIC S HLIEN=+Y,HLL=$P(Y(0),U,3)
"RTN","HLUTIL2",125,0)
 L +^HLCS(870,HLIEN):1 E  W !!,"Couldn't Lock Record, Try later.",! Q
"RTN","HLUTIL2",126,0)
 S DIR(0)="S^B:BOTH QUEUES;I:IN QUEUE;O:OUT QUEUE",DIR("?")="Select the queue (in, out, or both) you would like cleared"
"RTN","HLUTIL2",127,0)
 S DIR("A")="Enter which queue to clear",DIR("B")="B"
"RTN","HLUTIL2",128,0)
 D ^DIR K DIR
"RTN","HLUTIL2",129,0)
 S HLDIR=$S(Y="I":"IN",Y="O":"OUT",Y="B":"BOTH",1:1)
"RTN","HLUTIL2",130,0)
 I HLDIR=1!$D(DIRUT) L -^HLCS(870,HLIEN) Q
"RTN","HLUTIL2",131,0)
 ;HLLTC= TCP service type
"RTN","HLUTIL2",132,0)
 S:HLL HLLTC=$P($G(^HLCS(870,HLIEN,400)),U,3)
"RTN","HLUTIL2",133,0)
 ;TCP link
"RTN","HLUTIL2",134,0)
 I $G(HLLTC)]"" D  L -^HLCS(870,HLIEN) Q
"RTN","HLUTIL2",135,0)
 . ;multiple server, set STATE and SHUTDOWN LLP?
"RTN","HLUTIL2",136,0)
 . S:HLLTC="M" X=^HLCS(870,HLIEN,0),$P(X,U,5)="0 server",$P(X,U,15)=0,^(0)=X
"RTN","HLUTIL2",137,0)
 . I HLDIR="BOTH" D  Q
"RTN","HLUTIL2",138,0)
 .. F X="IN","OUT" D CLRQUET(X)
"RTN","HLUTIL2",139,0)
 . ;do one que
"RTN","HLUTIL2",140,0)
 . D CLRQUET(HLDIR)
"RTN","HLUTIL2",141,0)
 ;
"RTN","HLUTIL2",142,0)
 I HLDIR="BOTH" D
"RTN","HLUTIL2",143,0)
 . S HLERR=$$CLEARQUE^HLCSQUE(HLIEN,"OUT")
"RTN","HLUTIL2",144,0)
 . I HLERR W !,"Error in clearing out queue:",$P(HLERR,"^",2)
"RTN","HLUTIL2",145,0)
 . S HLERR=$$CLEARQUE^HLCSQUE(HLIEN,"IN")
"RTN","HLUTIL2",146,0)
 . I HLERR W !,"Error in clearing in queue:",$P(HLERR,"^",2)
"RTN","HLUTIL2",147,0)
 I HLDIR'="BOTH" S HLERR=$$CLEARQUE^HLCSQUE(HLIEN,HLDIR)
"RTN","HLUTIL2",148,0)
 L -^HLCS(870,HLIEN)
"RTN","HLUTIL2",149,0)
 Q
"RTN","HLUTIL2",150,0)
CLRQUET(Y) ;subroutine for TCP links, Y=IN or OUT
"RTN","HLUTIL2",151,0)
 Q:Y'="IN"&(Y'="OUT")
"RTN","HLUTIL2",152,0)
 N C,N,X
"RTN","HLUTIL2",153,0)
 S N=$E(Y),X=0
"RTN","HLUTIL2",154,0)
 ;get count of what is pending
"RTN","HLUTIL2",155,0)
 F C=0:1 S X=$O(^HLMA("AC",N,HLIEN,X)) Q:'X
"RTN","HLUTIL2",156,0)
 ;reset counters for messages
"RTN","HLUTIL2",157,0)
 S ^HLCS(870,HLIEN,Y_" QUEUE BACK POINTER")=C,^(Y_" QUEUE FRONT POINTER")=0
"RTN","HLUTIL2",158,0)
 Q
"RTN","HLUTIL2",159,0)
 ;
"RTN","HLUTIL2",160,0)
SHGLLP ; Show Gross LLP Error
"RTN","HLUTIL2",161,0)
 N DIC,IEN,ERR
"RTN","HLUTIL2",162,0)
 S DIC="^HLCS(870,"
"RTN","HLUTIL2",163,0)
 S DIC(0)="AEQM"
"RTN","HLUTIL2",164,0)
 D ^DIC K DIC
"RTN","HLUTIL2",165,0)
 S IEN=$P(Y,"^",1)
"RTN","HLUTIL2",166,0)
 S ERR=$P($G(^HLCS(870,IEN,0)),"^",19)
"RTN","HLUTIL2",167,0)
 W:(ERR'="") !,"Error: "_$P($G(^HL(771.7,ERR,0)),"^",1),!
"RTN","HLUTIL2",168,0)
 W:(ERR="") !,"No Gross LLP error found",!
"RTN","HLUTIL2",169,0)
 Q
"RTN","HLUTIL2",170,0)
CLGLLP ; Clear Gross LLP error
"RTN","HLUTIL2",171,0)
 N DIC,IEN,ERR,DA,DR
"RTN","HLUTIL2",172,0)
 S DIC="^HLCS(870,"
"RTN","HLUTIL2",173,0)
 S DIC(0)="AEQM"
"RTN","HLUTIL2",174,0)
 D ^DIC K DIC
"RTN","HLUTIL2",175,0)
 S IEN=$P(Y,"^",1)
"RTN","HLUTIL2",176,0)
 Q:(IEN<0)
"RTN","HLUTIL2",177,0)
 S DIE="^HLCS(870,"
"RTN","HLUTIL2",178,0)
 S DA=IEN
"RTN","HLUTIL2",179,0)
 S DR="18///@"
"RTN","HLUTIL2",180,0)
 D ^DIE K DIE
"RTN","HLUTIL2",181,0)
 Q
"VER")
8.0^22.0
"^DD",779.004,779.004,0)
FIELD^^100^9
"^DD",779.004,779.004,0,"DDA")
N
"^DD",779.004,779.004,0,"DT")
3060111
"^DD",779.004,779.004,0,"IX","AVUID",779.004,99.99)

"^DD",779.004,779.004,0,"IX","B",779.004,.01)

"^DD",779.004,779.004,0,"IX","C",779.004,1.3)

"^DD",779.004,779.004,0,"IX","D",779.004,2)

"^DD",779.004,779.004,0,"NM","COUNTRY CODE")

"^DD",779.004,779.004,0,"PT",771,7)

"^DD",779.004,779.004,0,"PT",775,17)

"^DD",779.004,779.004,0,"VRPK")
HL
"^DD",779.004,779.004,.01,0)
CODE^RF^^0;1^K:$L(X)>3!($L(X)<1)!'(X'?1P.E) X
"^DD",779.004,779.004,.01,1,0)
^.1
"^DD",779.004,779.004,.01,1,1,0)
779.004^B
"^DD",779.004,779.004,.01,1,1,1)
S ^HL(779.004,"B",$E(X,1,30),DA)=""
"^DD",779.004,779.004,.01,1,1,2)
K ^HL(779.004,"B",$E(X,1,30),DA)
"^DD",779.004,779.004,.01,3)
The code for the country.  Answer must be 1-3 characters in length.
"^DD",779.004,779.004,.01,7.5)
I $G(DIC(0))["L",'$D(XUMF) K X D EN^DDIOL("Entries must be edited via the Master File Server (MFS).","","!?5,$C(7)")
"^DD",779.004,779.004,.01,9)
^
"^DD",779.004,779.004,.01,21,0)
^^3^3^3060222^
"^DD",779.004,779.004,.01,21,1,0)
The three-character alpha identifying code.
"^DD",779.004,779.004,.01,21,2,0)
 
"^DD",779.004,779.004,.01,21,3,0)
The alpha 3 code for the USA is "USA".
"^DD",779.004,779.004,.01,"DEL",1,0)
D:'$D(XUMF) EN^DDIOL("Entries must be inactivated via the Master File Server (MFS).","","!?5,$C(7)") I $D(XUMF)
"^DD",779.004,779.004,.01,"DT")
3060111
"^DD",779.004,779.004,.01,"LAYGO",1,0)
D:'$D(XUMF) EN^DDIOL("Entries must be added via the Master File Server (MFS).","","!?5,$C(7)") I $D(XUMF)
"^DD",779.004,779.004,1.1,0)
NUMERIC CODE^RF^^SDS;1^K:$L(X)>3!($L(X)<3)!'(X?3N) X
"^DD",779.004,779.004,1.1,3)
Answer must be 3 numeric digits.
"^DD",779.004,779.004,1.1,21,0)
^.001^3^3^3060111^^
"^DD",779.004,779.004,1.1,21,1,0)
The three-digit numeric identifying code.
"^DD",779.004,779.004,1.1,21,2,0)
 
"^DD",779.004,779.004,1.1,21,3,0)
The numeric code for the USA is "840".
"^DD",779.004,779.004,1.1,"DT")
3060111
"^DD",779.004,779.004,1.2,0)
FIPS CODE^RF^^SDS;2^K:$L(X)>2!($L(X)<2)!'(X?2A) X
"^DD",779.004,779.004,1.2,3)
Answer must be 2 characters in length.
"^DD",779.004,779.004,1.2,21,0)
^^3^3^3060111^
"^DD",779.004,779.004,1.2,21,1,0)
The code assigned to this nation by US Government standard FIPS 10-4.
"^DD",779.004,779.004,1.2,21,2,0)
 
"^DD",779.004,779.004,1.2,21,3,0)
The FIPS code for the USA is "US".
"^DD",779.004,779.004,1.2,"DT")
3060111
"^DD",779.004,779.004,1.3,0)
POSTAL NAME^F^^SDS;3^K:$L(X)>100!($L(X)<3) X
"^DD",779.004,779.004,1.3,1,0)
^.1
"^DD",779.004,779.004,1.3,1,1,0)
779.004^C
"^DD",779.004,779.004,1.3,1,1,1)
S ^HL(779.004,"C",$E(X,1,30),DA)=""
"^DD",779.004,779.004,1.3,1,1,2)
K ^HL(779.004,"C",$E(X,1,30),DA)
"^DD",779.004,779.004,1.3,1,1,"DT")
3060126
"^DD",779.004,779.004,1.3,3)
Answer must be 3-100 characters in length.
"^DD",779.004,779.004,1.3,21,0)
^.001^2^2^3060126^^
"^DD",779.004,779.004,1.3,21,1,0)
The name used as the destination country for mail sent from the United
"^DD",779.004,779.004,1.3,21,2,0)
States to this country.
"^DD",779.004,779.004,1.3,"DT")
3060126
"^DD",779.004,779.004,2,0)
DESCRIPTION^RF^^0;2^K:$L(X)>100!($L(X)<1) X
"^DD",779.004,779.004,2,1,0)
^.1
"^DD",779.004,779.004,2,1,1,0)
779.004^D^MUMPS
"^DD",779.004,779.004,2,1,1,1)
S ^HL(779.004,"D",$E($$UP^XLFSTR(X),1,30),DA)=""
"^DD",779.004,779.004,2,1,1,2)
K ^HL(779.004,"D",$E($$UP^XLFSTR(X),1,30),DA)
"^DD",779.004,779.004,2,1,1,"DT")
3060228
"^DD",779.004,779.004,2,3)
The name of the country.  Answer must be 1-100 characters in length.
"^DD",779.004,779.004,2,9)
^
"^DD",779.004,779.004,2,"DT")
3060228
"^DD",779.004,779.004,99.98,0)
MASTER ENTRY FOR VUID^RSI^0:NO;1:YES;^VUID;2^Q
"^DD",779.004,779.004,99.98,9)
^
"^DD",779.004,779.004,99.98,21,0)
^^2^2^3050210^
"^DD",779.004,779.004,99.98,21,1,0)
This field identifies the Master entry for a VUID associated with a 
"^DD",779.004,779.004,99.98,21,2,0)
Term/Concept.
"^DD",779.004,779.004,99.98,"DT")
3060111
"^DD",779.004,779.004,99.99,0)
VUID^RFXI^^VUID;1^S X=+X K:$L(X)>20!($L(X)<1)!'(X?1.20N) X
"^DD",779.004,779.004,99.99,1,0)
^.1
"^DD",779.004,779.004,99.99,1,1,0)
779.004^AVUID
"^DD",779.004,779.004,99.99,1,1,1)
S ^HL(779.004,"AVUID",$E(X,1,30),DA)=""
"^DD",779.004,779.004,99.99,1,1,2)
K ^HL(779.004,"AVUID",$E(X,1,30),DA)
"^DD",779.004,779.004,99.99,1,1,3)
This cross-reference is by VUID.
"^DD",779.004,779.004,99.99,1,1,"%D",0)
^^1^1^3051026^
"^DD",779.004,779.004,99.99,1,1,"%D",1,0)
This cross-reference is by VUID.
"^DD",779.004,779.004,99.99,1,1,"DT")
3041223
"^DD",779.004,779.004,99.99,3)
Answer must be 1-20 digits in length.
"^DD",779.004,779.004,99.99,9)
^
"^DD",779.004,779.004,99.99,21,0)
^.001^2^2^3050210^^
"^DD",779.004,779.004,99.99,21,1,0)
VHA Unique ID (VUID). A unique meaningless integer assigned to reference
"^DD",779.004,779.004,99.99,21,2,0)
terms VHA wide.
"^DD",779.004,779.004,99.99,"DT")
3060111
"^DD",779.004,779.004,99.991,0)
EFFECTIVE DATE/TIME^779.00409DA^^TERMSTATUS;0
"^DD",779.004,779.004,99.991,9)
^
"^DD",779.004,779.004,99.991,21,0)
^^1^1^3050201^
"^DD",779.004,779.004,99.991,21,1,0)
Describes the pair Status and Effective Date/Time for each reference term.
"^DD",779.004,779.004,99.991,"DT")
3060111
"^DD",779.004,779.004,100,0)
VERSION^779.00401P^^1;0
"^DD",779.004,779.004,100,9)
^
"^DD",779.004,779.00401,0)
VERSION SUB-FIELD^^.01^1
"^DD",779.004,779.00401,0,"DT")
2940928
"^DD",779.004,779.00401,0,"IX","B",779.00401,.01)

"^DD",779.004,779.00401,0,"NM","VERSION")

"^DD",779.004,779.00401,0,"UP")
779.004
"^DD",779.004,779.00401,.01,0)
VERSION^RP771.5'^HL(771.5,^0;1^Q
"^DD",779.004,779.00401,.01,1,0)
^.1
"^DD",779.004,779.00401,.01,1,1,0)
779.00401^B
"^DD",779.004,779.00401,.01,1,1,1)
S ^HL(779.004,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",779.004,779.00401,.01,1,1,2)
K ^HL(779.004,DA(1),1,"B",$E(X,1,30),DA)
"^DD",779.004,779.00401,.01,3)
The version(s) of the standard in which this country code is used.
"^DD",779.004,779.00401,.01,9)
^
"^DD",779.004,779.00401,.01,"DT")
2940928
"^DD",779.004,779.00409,0)
EFFECTIVE DATE/TIME SUB-FIELD^^.02^2
"^DD",779.004,779.00409,0,"DT")
3050201
"^DD",779.004,779.00409,0,"IX","B",779.00409,.01)

"^DD",779.004,779.00409,0,"NM","EFFECTIVE DATE/TIME")
 
"^DD",779.004,779.00409,0,"UP")
779.004
"^DD",779.004,779.00409,.01,0)
EFFECTIVE DATE/TIME^RDI^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",779.004,779.00409,.01,1,0)
^.1
"^DD",779.004,779.00409,.01,1,1,0)
779.00409^B
"^DD",779.004,779.00409,.01,1,1,1)
S ^HL(779.004,DA(1),"TERMSTATUS","B",$E(X,1,30),DA)=""
"^DD",779.004,779.00409,.01,1,1,2)
K ^HL(779.004,DA(1),"TERMSTATUS","B",$E(X,1,30),DA)
"^DD",779.004,779.00409,.01,1,1,"%D",0)
^^1^1^3050201^
"^DD",779.004,779.00409,.01,1,1,"%D",1,0)
This cross-reference is by Effective Date/Time.
"^DD",779.004,779.00409,.01,9)
^
"^DD",779.004,779.00409,.01,21,0)
^^2^2^3050201^
"^DD",779.004,779.00409,.01,21,1,0)
This is the date/time when the Status of the reference term was 
"^DD",779.004,779.00409,.01,21,2,0)
established.
"^DD",779.004,779.00409,.01,"DT")
3060111
"^DD",779.004,779.00409,.02,0)
STATUS^RSI^1:ACTIVE;0:INACTIVE;^0;2^Q
"^DD",779.004,779.00409,.02,9)
^
"^DD",779.004,779.00409,.02,21,0)
^^4^4^3050201^
"^DD",779.004,779.00409,.02,21,1,0)
The Status of a reference term is either 'ACTIVE' or 'INACTIVE'. If 
"^DD",779.004,779.00409,.02,21,2,0)
'ACTIVE', then the term will be accessible by end-users to document a 
"^DD",779.004,779.00409,.02,21,3,0)
particular patient event. If 'INACTIVE', then the term will only be 
"^DD",779.004,779.00409,.02,21,4,0)
accessible by the application to display legacy data.
"^DD",779.004,779.00409,.02,"DT")
3060111
"^DIC",779.004,779.004,0)
COUNTRY CODE^779.004I
"^DIC",779.004,779.004,0,"GL")
^HL(779.004,
"^DIC",779.004,779.004,"%D",0)
^^13^13^3060111
"^DIC",779.004,779.004,"%D",1,0)
Per VHA Directive 2005-044, this file has been "locked down" by Data 
"^DIC",779.004,779.004,"%D",2,0)
Standardization (DS).  The file definition (i.e. data dictionary) shall 
"^DIC",779.004,779.004,"%D",3,0)
not be modified.  All additions, changes and deletions to entries in the 
"^DIC",779.004,779.004,"%D",4,0)
file shall be done by Enterprise Reference Terminology (ERT) using the 
"^DIC",779.004,779.004,"%D",5,0)
Master File Server (MFS), provided by Common Services (CS).  Creating 
"^DIC",779.004,779.004,"%D",6,0)
and/or editing locally defined fields in the file are not permitted.  Use 
"^DIC",779.004,779.004,"%D",7,0)
of locally defined fields that were created prior to the VHA Directive's 
"^DIC",779.004,779.004,"%D",8,0)
2005-044 effective date shall not be supported.
"^DIC",779.004,779.004,"%D",9,0)

"^DIC",779.004,779.004,"%D",10,0)
This file is a table of country codes that are used by the Messaging
"^DIC",779.004,779.004,"%D",11,0)
System when building message header segments.
"^DIC",779.004,779.004,"%D",12,0)
 
"^DIC",779.004,779.004,"%D",13,0)
This file should not be modified locally.
"^DIC",779.004,"B","COUNTRY CODE",779.004)

"BLD",926,6)
^103
**END**
**END**
