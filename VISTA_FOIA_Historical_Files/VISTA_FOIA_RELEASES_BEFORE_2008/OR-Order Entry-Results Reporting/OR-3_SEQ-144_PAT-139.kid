Released OR*3*139 SEQ #144
Extracted from mail message
**KIDS**:OR*3.0*139^

**INSTALL NAME**
OR*3.0*139
"BLD",3521,0)
OR*3.0*139^ORDER ENTRY/RESULTS REPORTING^0^3020730^y
"BLD",3521,4,0)
^9.64PA^8989.51^1
"BLD",3521,4,8989.51,0)
8989.51
"BLD",3521,4,8989.51,222)
n^n^f^^y^^y^r^n
"BLD",3521,4,8989.51,224)
I $P(^XTV(8989.51,+Y,0),"^")="ORB FORWARD BACKUP REVIEWER"
"BLD",3521,4,"B",8989.51,8989.51)

"BLD",3521,"ABPKG")
n
"BLD",3521,"INID")
^y
"BLD",3521,"INIT")
ORY139
"BLD",3521,"KRN",0)
^9.67PA^8989.52^19
"BLD",3521,"KRN",.4,0)
.4
"BLD",3521,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",3521,"KRN",.401,0)
.401
"BLD",3521,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",3521,"KRN",.402,0)
.402
"BLD",3521,"KRN",.403,0)
.403
"BLD",3521,"KRN",.5,0)
.5
"BLD",3521,"KRN",.84,0)
.84
"BLD",3521,"KRN",3.6,0)
3.6
"BLD",3521,"KRN",3.8,0)
3.8
"BLD",3521,"KRN",9.2,0)
9.2
"BLD",3521,"KRN",9.8,0)
9.8
"BLD",3521,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",3521,"KRN",9.8,"NM",1,0)
ORB3^^0^B85241039
"BLD",3521,"KRN",9.8,"NM",2,0)
ORB31^^0^B23907397
"BLD",3521,"KRN",9.8,"NM",3,0)
ORB3F1^^0^B4553805
"BLD",3521,"KRN",9.8,"NM",4,0)
ORB3FUP1^^0^B48602965
"BLD",3521,"KRN",9.8,"NM",5,0)
ORQPTQ1^^0^B54400639
"BLD",3521,"KRN",9.8,"NM",6,0)
ORB3REG^^0^B23676221
"BLD",3521,"KRN",9.8,"NM",7,0)
ORB3SPEC^^0^B31279317
"BLD",3521,"KRN",9.8,"NM",8,0)
ORB3USER^^0^B73357675
"BLD",3521,"KRN",9.8,"NM",9,0)
ORY139^^0^B39723853
"BLD",3521,"KRN",9.8,"NM",10,0)
ORB3MGR1^^0^B58432414
"BLD",3521,"KRN",9.8,"NM","B","ORB3",1)

"BLD",3521,"KRN",9.8,"NM","B","ORB31",2)

"BLD",3521,"KRN",9.8,"NM","B","ORB3F1",3)

"BLD",3521,"KRN",9.8,"NM","B","ORB3FUP1",4)

"BLD",3521,"KRN",9.8,"NM","B","ORB3MGR1",10)

"BLD",3521,"KRN",9.8,"NM","B","ORB3REG",6)

"BLD",3521,"KRN",9.8,"NM","B","ORB3SPEC",7)

"BLD",3521,"KRN",9.8,"NM","B","ORB3USER",8)

"BLD",3521,"KRN",9.8,"NM","B","ORQPTQ1",5)

"BLD",3521,"KRN",9.8,"NM","B","ORY139",9)

"BLD",3521,"KRN",19,0)
19
"BLD",3521,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",3521,"KRN",19,"NM",1,0)
ORB3 FORWARD BACKUP REVIEWER^^0
"BLD",3521,"KRN",19,"NM",2,0)
ORB3 FORWARD NOTIFS MENU^^0
"BLD",3521,"KRN",19,"NM",3,0)
ORB3 FORWARD SUPERVISOR^^4^
"BLD",3521,"KRN",19,"NM",4,0)
ORB3 FORWARD SURROGATES^^4^
"BLD",3521,"KRN",19,"NM","B","ORB3 FORWARD BACKUP REVIEWER",1)

"BLD",3521,"KRN",19,"NM","B","ORB3 FORWARD NOTIFS MENU",2)

"BLD",3521,"KRN",19,"NM","B","ORB3 FORWARD SUPERVISOR",3)

"BLD",3521,"KRN",19,"NM","B","ORB3 FORWARD SURROGATES",4)

"BLD",3521,"KRN",19.1,0)
19.1
"BLD",3521,"KRN",101,0)
101
"BLD",3521,"KRN",409.61,0)
409.61
"BLD",3521,"KRN",771,0)
771
"BLD",3521,"KRN",870,0)
870
"BLD",3521,"KRN",8989.51,0)
8989.51
"BLD",3521,"KRN",8989.52,0)
8989.52
"BLD",3521,"KRN",8994,0)
8994
"BLD",3521,"KRN","B",.4,.4)

"BLD",3521,"KRN","B",.401,.401)

"BLD",3521,"KRN","B",.402,.402)

"BLD",3521,"KRN","B",.403,.403)

"BLD",3521,"KRN","B",.5,.5)

"BLD",3521,"KRN","B",.84,.84)

"BLD",3521,"KRN","B",3.6,3.6)

"BLD",3521,"KRN","B",3.8,3.8)

"BLD",3521,"KRN","B",9.2,9.2)

"BLD",3521,"KRN","B",9.8,9.8)

"BLD",3521,"KRN","B",19,19)

"BLD",3521,"KRN","B",19.1,19.1)

"BLD",3521,"KRN","B",101,101)

"BLD",3521,"KRN","B",409.61,409.61)

"BLD",3521,"KRN","B",771,771)

"BLD",3521,"KRN","B",870,870)

"BLD",3521,"KRN","B",8989.51,8989.51)

"BLD",3521,"KRN","B",8989.52,8989.52)

"BLD",3521,"KRN","B",8994,8994)

"BLD",3521,"QUES",0)
^9.62^^
"BLD",3521,"REQB",0)
^9.611^5^4
"BLD",3521,"REQB",1,0)
OR*3.0*85^2
"BLD",3521,"REQB",2,0)
OR*3.0*105^2
"BLD",3521,"REQB",4,0)
XU*8.0*174^2
"BLD",3521,"REQB",5,0)
OR*3.0*112^2
"BLD",3521,"REQB","B","OR*3.0*105",2)

"BLD",3521,"REQB","B","OR*3.0*112",5)

"BLD",3521,"REQB","B","OR*3.0*85",1)

"BLD",3521,"REQB","B","XU*8.0*174",4)

"DATA",8989.51,4752,0)
ORB FORWARD BACKUP REVIEWER^Holds Days before Forward to Backup^1^Notification
"DATA",8989.51,4752,1)
N^0:30:0^Number of days to hold notif. before fwding to recipient's backup reviewer.
"DATA",8989.51,4752,6)
P^100.9^The notification related to this forwarding period.
"DATA",8989.51,4752,20,0)
^^10^10^3020307^
"DATA",8989.51,4752,20,1,0)
The number of days before a notification is forwarded to a recipient's
"DATA",8989.51,4752,20,2,0)
backup alert reviewer. The maximum is 30 days.  If not indicated or zero,
"DATA",8989.51,4752,20,3,0)
the notification will not be forwarded.  For example, if a notification
"DATA",8989.51,4752,20,4,0)
has a value of 14 for this parameter, it will be forwarded to the backup
"DATA",8989.51,4752,20,5,0)
reviewer of each recipient who hasn't processed the notification after 14
"DATA",8989.51,4752,20,6,0)
days. Determination of recipients who have not processed the notification
"DATA",8989.51,4752,20,7,0)
and their backup alert reviewer is made by the Kernel Alert Utility.  It
"DATA",8989.51,4752,20,8,0)
will not be forwarded to backup reviewers of recipients who have
"DATA",8989.51,4752,20,9,0)
processed the alert within 14 days.  If the value of this parameter is
"DATA",8989.51,4752,20,10,0)
zero or non-existent, the  alert/notification will never be forwarded.
"DATA",8989.51,4752,30,0)
^8989.513I^3^3
"DATA",8989.51,4752,30,1,0)
1^4
"DATA",8989.51,4752,30,2,0)
2^4.2
"DATA",8989.51,4752,30,3,0)
3^9.4
"FIA",8989.51)
PARAMETER DEFINITION
"FIA",8989.51,0)
^XTV(8989.51,
"FIA",8989.51,0,0)
8989.51I
"FIA",8989.51,0,1)
n^n^f^^y^^y^r^n
"FIA",8989.51,0,10)

"FIA",8989.51,0,11)
I $P(^XTV(8989.51,+Y,0),"^")="ORB FORWARD BACKUP REVIEWER"
"FIA",8989.51,0,"RLRO")

"FIA",8989.51,0,"VR")
3.0^OR
"FIA",8989.51,8989.51)
0
"FIA",8989.51,8989.512)
0
"FIA",8989.51,8989.513)
0
"INIT")
ORY139
"KRN",19,5212,-1)
4^3
"KRN",19,5212,0)
ORB3 FORWARD SUPERVISOR
"KRN",19,5213,-1)
4^4
"KRN",19,5213,0)
ORB3 FORWARD SURROGATES
"KRN",19,6936,-1)
0^2
"KRN",19,6936,0)
ORB3 FORWARD NOTIFS MENU^Forward Notifications^^M^^^^^^^^
"KRN",19,6936,1,0)
^19.06^2^2^3020408^^
"KRN",19,6936,1,1,0)
This menu option is used to access options which set up parameters for
"KRN",19,6936,1,2,0)
forwarding notifications/alerts.
"KRN",19,6936,10,0)
^19.01IP^3^3
"KRN",19,6936,10,1,0)
5212^1
"KRN",19,6936,10,1,"^")
ORB3 FORWARD SUPERVISOR
"KRN",19,6936,10,2,0)
5213^2
"KRN",19,6936,10,2,"^")
ORB3 FORWARD SURROGATES
"KRN",19,6936,10,3,0)
8862^3^
"KRN",19,6936,10,3,"^")
ORB3 FORWARD BACKUP REVIEWER
"KRN",19,6936,10.1)
Forward Notifications
"KRN",19,6936,99)
58902,58064
"KRN",19,6936,"U")
FORWARD NOTIFICATIONS
"KRN",19,8862,-1)
0^1
"KRN",19,8862,0)
ORB3 FORWARD BACKUP REVIEWER^Forward Unprocessed Notification to Bkup Reviewer^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",19,8862,1,0)
^^11^11^3020408^
"KRN",19,8862,1,1,0)
The number of days to hold a notification before it is forwarded to a
"KRN",19,8862,1,2,0)
recipient's backup reviewer. The maximum is 30 days.  If not indicated or
"KRN",19,8862,1,3,0)
zero, the notification will not be forwarded.  For example, if a
"KRN",19,8862,1,4,0)
notification has a value of 14 for this parameter, it will be forwarded to
"KRN",19,8862,1,5,0)
the backup reviewer of each recipient who hasn't processed the
"KRN",19,8862,1,6,0)
notification after 14 days.  Determination of recipients who have not
"KRN",19,8862,1,7,0)
processed the notification and who their supervisors are is made by the
"KRN",19,8862,1,8,0)
Kernel Alert Utility.  It will not be forwarded to the backup reviewer of
"KRN",19,8862,1,9,0)
recipients who have processed the alert within 14 days.  If the value of
"KRN",19,8862,1,10,0)
this parameter is zero or non-existent, the alert/notification will never
"KRN",19,8862,1,11,0)
be forwarded to the backup reviewer.
"KRN",19,8862,25)
FREVIEW^ORB3MGR1
"KRN",19,8862,"U")
FORWARD UNPROCESSED NOTIFICATI
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
139^3020730
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","ORB3")
0^1^B85241039
"RTN","ORB3",1,0)
ORB3 ; slc/CLA - Main routine for OE/RR 3 notifications ;6/6/01  10:46
"RTN","ORB3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**31,74,91,105,139**;Dec 17, 1997
"RTN","ORB3",3,0)
EN(ORN,ORBDFN,ORNUM,ORBADUZ,ORBPMSG,ORBPDATA) ;
"RTN","ORB3",4,0)
 ;
"RTN","ORB3",5,0)
 N ORBENT
"RTN","ORB3",6,0)
 S ORBENT=$$ENTITY^ORB31(ORNUM,DUZ)
"RTN","ORB3",7,0)
 ;
"RTN","ORB3",8,0)
 Q:$$GET^XPAR(ORBENT,"ORB SYSTEM ENABLE/DISABLE",1,"I")="D"
"RTN","ORB3",9,0)
 Q:'$L($G(^ORD(100.9,ORN,0)))
"RTN","ORB3",10,0)
 Q:+$$ONOFF^ORB3FN(ORN)=0
"RTN","ORB3",11,0)
 ;
"RTN","ORB3",12,0)
 S ORBPMSG=$E($G(ORBPMSG),1,51)
"RTN","ORB3",13,0)
 ;
"RTN","ORB3",14,0)
 ;if msg from notif file or oc notif (#54), quit if dup w/in past 1 min:
"RTN","ORB3",15,0)
 N ORBDUP,ORBN
"RTN","ORB3",16,0)
 S ORBN=^ORD(100.9,ORN,0)
"RTN","ORB3",17,0)
 I ($P(ORBN,"^",4)="NOT")!(ORN=54) D
"RTN","ORB3",18,0)
 .S ORBDUP=$$DUP^ORB31(ORN,ORBDFN,ORBPMSG,ORNUM)
"RTN","ORB3",19,0)
 Q:+$G(ORBDUP)=1
"RTN","ORB3",20,0)
 ;
"RTN","ORB3",21,0)
 N ORBDESC
"RTN","ORB3",22,0)
 S ORBDESC=" Send Alert Notification ("_(+ORN)_") "_$P($G(^ORD(100.9,+ORN,0)),U,1)_"  "
"RTN","ORB3",23,0)
 ;
"RTN","ORB3",24,0)
 D QUEUE^ORB31(ORN,ORBDFN,$G(ORNUM),.ORBADUZ,$G(ORBPMSG),$G(ORBPDATA),$H,ORBDESC,$G(DGPMA))
"RTN","ORB3",25,0)
 Q
"RTN","ORB3",26,0)
ZTSK ;
"RTN","ORB3",27,0)
 D START
"RTN","ORB3",28,0)
 S ZTREQ="@"
"RTN","ORB3",29,0)
 Q
"RTN","ORB3",30,0)
UTL(ORBU,ORN,ORBDFN,ORNUM,ORBADUZ,ORBPMSG,ORBPDATA) ;
"RTN","ORB3",31,0)
 Q:$G(ORBU)'=1
"RTN","ORB3",32,0)
START Q:$G(ORN)=""!($G(ORBDFN)="")
"RTN","ORB3",33,0)
 Q:'$L($G(^ORD(100.9,ORN,0)))
"RTN","ORB3",34,0)
 N ORBNOW,ORBID,ORBLOCK,ORBDESC
"RTN","ORB3",35,0)
 S ORBNOW=$$NOW^XLFDT
"RTN","ORB3",36,0)
 S ORBLOCK=0
"RTN","ORB3",37,0)
 ;
"RTN","ORB3",38,0)
 ;lock to prevent concurrent processing by other resource slots:
"RTN","ORB3",39,0)
 I '$D(ORBU) D
"RTN","ORB3",40,0)
 .S ^XTMP("ORBLOCK",0)=$$FMADD^XLFDT(ORBNOW,1,"","","")_"^"_ORBNOW
"RTN","ORB3",41,0)
 .S ORBID=$P($P($G(ORBPDATA),"|",2),"@")  ;get unique data id
"RTN","ORB3",42,0)
 .I $L(ORBID) D
"RTN","ORB3",43,0)
 ..LOCK +^XTMP("ORBLOCK",ORBDFN,ORN,ORBID):60 E  D  Q
"RTN","ORB3",44,0)
 ...S ORBDESC=" Requeue Alert Notification ("_(+ORN)_") "_$P($G(^ORD(100.9,+ORN,0)),U,1)_"  "
"RTN","ORB3",45,0)
 ...D QUEUE^ORB31(ORN,ORBDFN,$G(ORNUM),.ORBADUZ,$G(ORBPMSG),$G(ORBPDATA),$$HADD^XLFDT($H,"","",5,""),ORBDESC,$G(DGPMA)) ;requeue in 5 min.
"RTN","ORB3",46,0)
 ...S ORBLOCK=1
"RTN","ORB3",47,0)
 .;
"RTN","ORB3",48,0)
 .I '$L(ORBID) D
"RTN","ORB3",49,0)
 ..LOCK +^XTMP("ORBLOCK",ORBDFN,ORN):60 E  D  Q
"RTN","ORB3",50,0)
 ...S ORBDESC=" Requeue Alert Notification ("_(+ORN)_") "_$P($G(^ORD(100.9,+ORN,0)),U,1)_"  "
"RTN","ORB3",51,0)
 ...D QUEUE^ORB31(ORN,ORBDFN,$G(ORNUM),.ORBADUZ,$G(ORBPMSG),$G(ORBPDATA),$$HADD^XLFDT($H,"","",5,""),ORBDESC,$G(DGPMA)) ;requeue in 5 min.
"RTN","ORB3",52,0)
 ...S ORBLOCK=1
"RTN","ORB3",53,0)
 .;
"RTN","ORB3",54,0)
 I ORBLOCK=1 D QUIT Q
"RTN","ORB3",55,0)
 ;
"RTN","ORB3",56,0)
 N ORBDUZ,ORBN,ORBXQAID,ORPTNAM,ORBPRIM,ORBATTD,ORBDEV,ORBENT
"RTN","ORB3",57,0)
 N ORBUI,ORBASPEC,ORBSMSG,ORBADT,ORBSDEV,ORBDEL,ORBDI,ORBTDEV,ORY
"RTN","ORB3",58,0)
 S ORBUI=1,ORBADT=0
"RTN","ORB3",59,0)
 S:'$L($G(ORBPMSG)) ORBPMSG=""
"RTN","ORB3",60,0)
 I '$L(ORBPDATA),(+$G(ORNUM)>0) S ORBPDATA=+$G(ORNUM)_"@"
"RTN","ORB3",61,0)
 S ORBN=^ORD(100.9,ORN,0)
"RTN","ORB3",62,0)
 ;
"RTN","ORB3",63,0)
 S ORBENT=$$ENTITY^ORB31(ORNUM,DUZ)
"RTN","ORB3",64,0)
 ;
"RTN","ORB3",65,0)
 N DFN S DFN=ORBDFN,VA200="" D OERR^VADPT
"RTN","ORB3",66,0)
 I ('$L($G(VA("BID"))))!('$L($G(VADM(1)))) D QUIT Q
"RTN","ORB3",67,0)
 I (ORN=18)!(ORN=20)!(ORN=35) S ORBADT=1 ;A/D/T notif
"RTN","ORB3",68,0)
 ;if not an A/D/T notif, get primary & attending from OERR^VADPT:
"RTN","ORB3",69,0)
 I ORBADT=0 S ORBPRIM=+$P(VAIN(2),U),ORBATTD=+$P(VAIN(11),U)
"RTN","ORB3",70,0)
 I ORBADT=1 D ADT^ORB31(ORN,ORBDFN,.ORBPRIM,.ORBATTD,$G(ORDGPMA)) ;A/D/T notif
"RTN","ORB3",71,0)
 I $D(ORBU) D  ;create debug msg
"RTN","ORB3",72,0)
 .S ORBU(ORBUI)="Processing notification: "_$P(ORBN,U),ORBUI=ORBUI+1
"RTN","ORB3",73,0)
 .S ORBU(ORBUI)="            for patient: "_VADM(1),ORBUI=ORBUI+1
"RTN","ORB3",74,0)
 .I $G(ORNUM)>0 S ORBU(ORBUI)="              for order: "_ORNUM,ORBUI=ORBUI+1
"RTN","ORB3",75,0)
 D REGULAR^ORB3REG(ORN,.XQA,.ORBU,.ORBUI,.ORBDEV,ORBDFN)
"RTN","ORB3",76,0)
 D SPECIAL^ORB3SPEC(ORN,.ORBASPEC,.ORBU,.ORBUI,$G(ORNUM),ORBDFN,$G(ORBPDATA),.ORBSMSG,$G(ORBPMSG),.ORBSDEV)
"RTN","ORB3",77,0)
 I $L($G(ORBSMSG)) S ORBPMSG=$E(ORBSMSG,1,51)
"RTN","ORB3",78,0)
 I $D(ORBASPEC)>1 D SPECDUZS ;special recips
"RTN","ORB3",79,0)
 I $D(ORBADUZ)>1 D PKGDUZS ;pkg-supplied recips
"RTN","ORB3",80,0)
 D TITLE ;provider recips
"RTN","ORB3",81,0)
 S ORBXQAID=$P(ORBN,"^",2)_","_ORBDFN_","_ORN
"RTN","ORB3",82,0)
 ;
"RTN","ORB3",83,0)
 I ($D(XQA)>1)!($D(ORBDEV)>1)!($D(ORBSDEV)>1) D  ;recips found
"RTN","ORB3",84,0)
 .S XQAFLG=$P(ORBN,"^",5)
"RTN","ORB3",85,0)
 .I XQAFLG="R" S XQAROU=$P(ORBN,"^",6)_"^"_$P(ORBN,"^",7)
"RTN","ORB3",86,0)
 .I $G(ORBPDATA)'="" S XQADATA=ORBPDATA
"RTN","ORB3",87,0)
 .S ORPTNAM=$E(VADM(1)_"         ",1,9)
"RTN","ORB3",88,0)
 .S XQAMSG=ORPTNAM_" "_"("_$E(ORPTNAM)_$E(VA("BID"),1,4)_")"_": "
"RTN","ORB3",89,0)
 .S XQAMSG=XQAMSG_$S(ORBPMSG'="":ORBPMSG,1:$P(ORBN,"^",3))
"RTN","ORB3",90,0)
 .S XQAARCH=$$GET^XPAR(ORBENT,"ORB ARCHIVE PERIOD",ORN,"I")
"RTN","ORB3",91,0)
 .S XQASUPV=$$GET^XPAR(ORBENT,"ORB FORWARD SUPERVISOR",ORN,"I")
"RTN","ORB3",92,0)
 .S XQASURO=$$GET^XPAR(ORBENT,"ORB FORWARD SURROGATES",ORN,"I")
"RTN","ORB3",93,0)
 .S XQAREVUE=$$GET^XPAR(ORBENT,"ORB FORWARD BACKUP REVIEWER",ORN,"I")
"RTN","ORB3",94,0)
 .I $D(ORBDEV)>1 D REGDEV^ORB31(.ORBDEV)
"RTN","ORB3",95,0)
 .I $D(ORBSDEV)>1 D REGDEV^ORB31(.ORBSDEV)
"RTN","ORB3",96,0)
 .I $D(ORBTDEV)>1 D REGDEV^ORB31(.ORBTDEV)
"RTN","ORB3",97,0)
 .S XQAID=ORBXQAID
"RTN","ORB3",98,0)
 .I $D(XQA) D SETUP^XQALERT  ;if no [new] recips don't send alert
"RTN","ORB3",99,0)
QUIT ;
"RTN","ORB3",100,0)
 K VA,VA200,VADM,VAERR,VAIN,XQA,XQADATA,XQAID,XQAFLG,XQAMSG,XQAROU,XQAARCH,XQASUPV,XQASURO
"RTN","ORB3",101,0)
 K ^XTMP("ORBUSER",$J)
"RTN","ORB3",102,0)
 I '$D(ORBU) D
"RTN","ORB3",103,0)
 .I $L(ORBID) LOCK -^XTMP("ORBLOCK",ORBDFN,ORN,ORBID)
"RTN","ORB3",104,0)
 .E  LOCK -^XTMP("ORBLOCK",ORBDFN,ORN)
"RTN","ORB3",105,0)
 Q
"RTN","ORB3",106,0)
PKGDUZS ;get DUZs from pkg-passed ORBADUZ() array
"RTN","ORB3",107,0)
 N ORBPDUZ
"RTN","ORB3",108,0)
 I $D(ORBU) D
"RTN","ORB3",109,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3",110,0)
 .I ORN=68 S ORBU(ORBUI)="Recipients with Lab Threshold Exceeded:",ORBUI=ORBUI+1
"RTN","ORB3",111,0)
 .E  S ORBU(ORBUI)="Recipients defined when notif was triggered:",ORBUI=ORBUI+1
"RTN","ORB3",112,0)
 S ORBPDUZ=""
"RTN","ORB3",113,0)
 F  S ORBPDUZ=$O(ORBADUZ(ORBPDUZ)) Q:ORBPDUZ=""  S ORBDUZ=ORBPDUZ D USER
"RTN","ORB3",114,0)
 Q
"RTN","ORB3",115,0)
SPECDUZS ;get DUZs rtn by SPECIAL^ORB3SPEC
"RTN","ORB3",116,0)
 N ORBSDUZ
"RTN","ORB3",117,0)
 I $D(ORBU) D
"RTN","ORB3",118,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3",119,0)
 .S ORBU(ORBUI)="Special recipients associated with the notification:",ORBUI=ORBUI+1
"RTN","ORB3",120,0)
 S ORBSDUZ=""
"RTN","ORB3",121,0)
 F  S ORBSDUZ=$O(ORBASPEC(ORBSDUZ)) Q:ORBSDUZ=""  S ORBDUZ=ORBSDUZ D USER
"RTN","ORB3",122,0)
 Q
"RTN","ORB3",123,0)
TITLE ;get provider recips
"RTN","ORB3",124,0)
 N TITLES
"RTN","ORB3",125,0)
 I $D(ORBU) D
"RTN","ORB3",126,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3",127,0)
 .S ORBU(ORBUI)="Recipients determined by Provider Recipient parameter:",ORBUI=ORBUI+1
"RTN","ORB3",128,0)
 ;
"RTN","ORB3",129,0)
 S TITLES=$$GET^XPAR(ORBENT,"ORB PROVIDER RECIPIENTS",ORN,"I")
"RTN","ORB3",130,0)
 I TITLES["P" D PRIMARY
"RTN","ORB3",131,0)
 I TITLES["A" D ATTEND
"RTN","ORB3",132,0)
 I TITLES["T" D TEAMS
"RTN","ORB3",133,0)
 I TITLES["O" D ORDERER
"RTN","ORB3",134,0)
 I TITLES["E" D ENTERBY
"RTN","ORB3",135,0)
 I TITLES["R" D PCMMPRIM
"RTN","ORB3",136,0)
 I TITLES["S" D PCMMASSC
"RTN","ORB3",137,0)
 I TITLES["M" D PCMMTEAM
"RTN","ORB3",138,0)
 Q
"RTN","ORB3",139,0)
PRIMARY ;
"RTN","ORB3",140,0)
 I $D(ORBU),ORBADT=0 S ORBU(ORBUI)=" Inpt primary provider:",ORBUI=ORBUI+1
"RTN","ORB3",141,0)
 I $D(ORBU),ORBADT=1 S ORBU(ORBUI)=" Inpt primary provider: option cannot determine without A/D/T event data.",ORBUI=ORBUI+1
"RTN","ORB3",142,0)
 I +$G(ORBPRIM)>0 S ORBDUZ=ORBPRIM D USER
"RTN","ORB3",143,0)
 Q
"RTN","ORB3",144,0)
ATTEND ;
"RTN","ORB3",145,0)
 I $D(ORBU),ORBADT=0 S ORBU(ORBUI)=" Attending physician:",ORBUI=ORBUI+1
"RTN","ORB3",146,0)
 I $D(ORBU),ORBADT=1 S ORBU(ORBUI)=" Attending physician: option cannot determine without A/D/T event data.",ORBUI=ORBUI+1
"RTN","ORB3",147,0)
 I +$G(ORBATTD)>0 S ORBDUZ=ORBATTD D USER
"RTN","ORB3",148,0)
 Q
"RTN","ORB3",149,0)
TEAMS ;
"RTN","ORB3",150,0)
 I $D(ORBU) S ORBU(ORBUI)=" Teams/Personal Lists related to patient:",ORBUI=ORBUI+1
"RTN","ORB3",151,0)
 N ORBLST,ORBI,ORBJ,ORBTM,ORBTNAME,ORBTTYPE,ORBTD
"RTN","ORB3",152,0)
 D TMSPT^ORQPTQ1(.ORBLST,ORBDFN)
"RTN","ORB3",153,0)
 Q:+$G(ORBLST(1))<1
"RTN","ORB3",154,0)
 S ORBI="" F  S ORBI=$O(ORBLST(ORBI)) Q:ORBI=""  D
"RTN","ORB3",155,0)
 .S ORBTM=$P(ORBLST(ORBI),U),ORBTNAME=$P(ORBLST(ORBI),U,2)
"RTN","ORB3",156,0)
 .S ORBTTYPE=$P(ORBLST(ORBI),U,3)
"RTN","ORB3",157,0)
 .I $D(ORBU) D
"RTN","ORB3",158,0)
 ..S ORBU(ORBUI)="  Patient list "_ORBTNAME_" ["_ORBTTYPE_"]:",ORBUI=ORBUI+1
"RTN","ORB3",159,0)
 .N ORBLST2 D TEAMPROV^ORQPTQ1(.ORBLST2,ORBTM)
"RTN","ORB3",160,0)
 .Q:+$G(ORBLST2(1))<1
"RTN","ORB3",161,0)
 .S ORBJ="" F  S ORBJ=$O(ORBLST2(ORBJ)) Q:ORBJ=""  D
"RTN","ORB3",162,0)
 ..S ORBDUZ=$P(ORBLST2(ORBJ),U)_U_ORBTM I +$G(ORBDUZ)>0 D USER
"RTN","ORB3",163,0)
 .;
"RTN","ORB3",164,0)
 .S ORBTD=$P($$TMDEV^ORB31(ORBTM),U,2)  ;Team's device
"RTN","ORB3",165,0)
 .I $L(ORBTD) D
"RTN","ORB3",166,0)
 ..S ORBTDEV(ORBTD)=""
"RTN","ORB3",167,0)
 ..I $D(ORBU) D
"RTN","ORB3",168,0)
 ...S ORBU(ORBUI)="   Team's Device "_ORBTD_" is a recipient",ORBUI=ORBUI+1
"RTN","ORB3",169,0)
 Q
"RTN","ORB3",170,0)
ORDERER ;
"RTN","ORB3",171,0)
 I $D(ORBU) S ORBU(ORBUI)=" Ordering provider:",ORBUI=ORBUI+1
"RTN","ORB3",172,0)
 N ORBLST,ORBI,ORBTM,ORBJ,ORBTNAME,ORBPLST,ORBPI,ORBPTM,ORBTTYPE
"RTN","ORB3",173,0)
 Q:+$G(ORNUM)<1
"RTN","ORB3",174,0)
 S ORBDUZ=$S(ORN=12:+$$UNSIGNOR^ORQOR2(ORNUM),1:$$ORDERER^ORQOR2(ORNUM))
"RTN","ORB3",175,0)
 I +$G(ORBDUZ)>0 D
"RTN","ORB3",176,0)
 .D USER
"RTN","ORB3",177,0)
 .;if notif = Order Req E/S (#12) or Order Req Co-sign (#37) and
"RTN","ORB3",178,0)
 .;user doesn't have ES authority, send to fellow team members w/ES:
"RTN","ORB3",179,0)
 .I ((ORN=12)!(ORN=37)),('$D(^XUSEC("ORES",ORBDUZ))) D
"RTN","ORB3",180,0)
 ..I $D(ORBU) S ORBU(ORBUI)=" Orderer can't elec sign, getting teams orderer belongs to:",ORBUI=ORBUI+1
"RTN","ORB3",181,0)
 ..D TEAMPR^ORQPTQ1(.ORBLST,ORBDUZ)  ;get orderer's tms
"RTN","ORB3",182,0)
 ..Q:+$G(ORBLST(1))<1
"RTN","ORB3",183,0)
 ..D TMSPT^ORQPTQ1(.ORBPLST,ORBDFN)  ;get pt's tms
"RTN","ORB3",184,0)
 ..Q:+$G(ORBPLST(1))<1
"RTN","ORB3",185,0)
 ..S ORBI="" F  S ORBI=$O(ORBLST(ORBI)) Q:ORBI=""  D
"RTN","ORB3",186,0)
 ...S ORBPI="" F  S ORBPI=$O(ORBPLST(ORBPI)) Q:ORBPI=""  D
"RTN","ORB3",187,0)
 ....S ORBTM=$P(ORBLST(ORBI),U),ORBPTM=$P(ORBPLST(ORBPI),U)
"RTN","ORB3",188,0)
 ....I ORBTM=ORBPTM D  ;if pt is on provider's team
"RTN","ORB3",189,0)
 .....I +$G(ORBPTM)>0 D
"RTN","ORB3",190,0)
 ......S ORBTNAME=$P(ORBPLST(ORBPI),U,2)
"RTN","ORB3",191,0)
 ......S ORBTTYPE=$P(ORBPLST(ORBPI),U,3)
"RTN","ORB3",192,0)
 ......I $D(ORBU) S ORBU(ORBUI)="  Orderer's pt list "_ORBTNAME_" ["_ORBTTYPE_"] recipients: ",ORBUI=ORBUI+1
"RTN","ORB3",193,0)
 ......N ORBLST2 D TEAMPROV^ORQPTQ1(.ORBLST2,ORBPTM)
"RTN","ORB3",194,0)
 ......Q:+$G(ORBLST2(1))<1
"RTN","ORB3",195,0)
 ......S ORBJ="" F  S ORBJ=$O(ORBLST2(ORBJ)) Q:ORBJ=""  D
"RTN","ORB3",196,0)
 .......S ORBDUZ=$P(ORBLST2(ORBJ),U)_U_ORBPTM I +$G(ORBDUZ)>0,($D(^XUSEC("ORES",+ORBDUZ))) D USER
"RTN","ORB3",197,0)
 Q
"RTN","ORB3",198,0)
ENTERBY ;
"RTN","ORB3",199,0)
 I $D(ORBU) S ORBU(ORBUI)=" User entering order's most recent activity:",ORBUI=ORBUI+1
"RTN","ORB3",200,0)
 Q:+$G(ORNUM)<1
"RTN","ORB3",201,0)
 I $D(^OR(100,ORNUM,8,0)) D
"RTN","ORB3",202,0)
 .S ORBDUZ=$P(^OR(100,ORNUM,8,$P(^OR(100,ORNUM,8,0),U,3),0),U,13)
"RTN","ORB3",203,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORB3",204,0)
 Q
"RTN","ORB3",205,0)
PCMMPRIM ;
"RTN","ORB3",206,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Primary Care Practitioner:",ORBUI=ORBUI+1
"RTN","ORB3",207,0)
 S ORBDUZ=+$$OUTPTPR^SDUTL3(ORBDFN,$$NOW^XLFDT,1)  ;DBIA #1252
"RTN","ORB3",208,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORB3",209,0)
 Q
"RTN","ORB3",210,0)
PCMMASSC ;
"RTN","ORB3",211,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Associate Provider:",ORBUI=ORBUI+1
"RTN","ORB3",212,0)
 S ORBDUZ=+$$OUTPTAP^SDUTL3(ORBDFN,$$NOW^XLFDT)  ;DBIA #1252
"RTN","ORB3",213,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORB3",214,0)
 Q
"RTN","ORB3",215,0)
PCMMTEAM ;
"RTN","ORB3",216,0)
 N ORPCMM,ORPCMMDZ
"RTN","ORB3",217,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Team Position Assignments:",ORBUI=ORBUI+1
"RTN","ORB3",218,0)
 S ORPCMM=$$PRPT^SCAPMC(ORBDFN,,,,,,"^TMP(""ORPCMM"",$J)",)  ;DBIA #1916
"RTN","ORB3",219,0)
 S ORPCMMDZ=0
"RTN","ORB3",220,0)
 F  S ORPCMMDZ=$O(^TMP("ORPCMM",$J,"SCPR",ORPCMMDZ)) Q:'ORPCMMDZ  D
"RTN","ORB3",221,0)
 .S ORBDUZ=ORPCMMDZ D USER
"RTN","ORB3",222,0)
 K ^TMP("ORPCMM",$J)
"RTN","ORB3",223,0)
 Q
"RTN","ORB3",224,0)
USER ;should USER (ORBDUZ) be a recip
"RTN","ORB3",225,0)
 D USER^ORB3USER(.XQA,ORBDUZ,ORN,.ORBU,.ORBUI,ORBDFN)
"RTN","ORB3",226,0)
 Q
"RTN","ORB31")
0^2^B23907397
"RTN","ORB31",1,0)
ORB31 ; slc/CLA - Routine to support OE/RR 3 notifications ;6/28/00  12:00 [ 04/02/97  11:12 AM ]
"RTN","ORB31",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,31,88,105,139**;Dec 17, 1997
"RTN","ORB31",3,0)
QUEUE(ORN,ORBDFN,ORNUM,ORBADUZ,ORBPMSG,ORBPDATA,ORBH,ORBD,ORDGPMA) ;
"RTN","ORB31",4,0)
 ;queue up notif for Taskman processing
"RTN","ORB31",5,0)
 ;ORN       notification ien from file 100.9
"RTN","ORB31",6,0)
 ;ORBDFN    patient dfn from file 2
"RTN","ORB31",7,0)
 ;ORNUM     order number from file 100
"RTN","ORB31",8,0)
 ;ORBADUZ   array of potential user recipients (iens from file 100)
"RTN","ORB31",9,0)
 ;ORBPMSG   alert message from triggering process
"RTN","ORB31",10,0)
 ;ORBPDATA  data potentially used in alert follow-up action
"RTN","ORB31",11,0)
 ;ORBH      $H formatted time to begin Taskman process
"RTN","ORB31",12,0)
 ;ORBD      process description for Taskman
"RTN","ORB31",13,0)
 ;ORDGPMA   DGPMA if alert triggered by A/D/T event
"RTN","ORB31",14,0)
 ;
"RTN","ORB31",15,0)
 N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTREQ,ZTRTN,ZTSAVE,ZTSK,ZTUCI,X,Y,DIC
"RTN","ORB31",16,0)
 ;
"RTN","ORB31",17,0)
 S DIC="3.5",X="ORB NOTIFICATION RESOURCE",DIC(0)="X" D ^DIC
"RTN","ORB31",18,0)
 I (Y) S ZTIO=$P(Y,U,2)
"RTN","ORB31",19,0)
 E  S ZTIO=""
"RTN","ORB31",20,0)
 S ZTDTH=ORBH,ZTRTN="ZTSK^ORB3"
"RTN","ORB31",21,0)
 S ZTDESC=ORBD
"RTN","ORB31",22,0)
 S ZTDESC=ZTDESC_"for ("_ORBDFN_") "_$P($G(^DPT(+ORBDFN,0)),U,1)
"RTN","ORB31",23,0)
 K ZTSAVE,ZTCPU,ZTUCI,ZTPRI,ZTPAR,ZTPRE,DIC,Y,DTOUT,DUOUT
"RTN","ORB31",24,0)
 ;
"RTN","ORB31",25,0)
 S ZTSAVE("ORN")=""
"RTN","ORB31",26,0)
 S ZTSAVE("ORBDFN")=""
"RTN","ORB31",27,0)
 S ZTSAVE("ORNUM")=""
"RTN","ORB31",28,0)
 S ZTSAVE("ORBADUZ(")=""
"RTN","ORB31",29,0)
 S ZTSAVE("ORBPMSG")=""
"RTN","ORB31",30,0)
 S ZTSAVE("ORBPDATA")=""
"RTN","ORB31",31,0)
 S ZTSAVE("ORDGPMA")=""
"RTN","ORB31",32,0)
 D ^%ZTLOAD
"RTN","ORB31",33,0)
 Q
"RTN","ORB31",34,0)
DUP(ORN,ORBDFN,ORBPMSG,ORNUM) ;ext funct return "1" if a duplicate notif w/in 1 min.
"RTN","ORB31",35,0)
 N ORBDUP,ORBNOW,ORBLAST,ORLNUM,ORSAMEP
"RTN","ORB31",36,0)
 S ORBDUP=0
"RTN","ORB31",37,0)
 S ORSAMEP=0
"RTN","ORB31",38,0)
 S ORBNOW=$$NOW^XLFDT
"RTN","ORB31",39,0)
 S ^XTMP("ORBDUP",0)=$$FMADD^XLFDT(ORBNOW,1,"","","")_"^"_ORBNOW
"RTN","ORB31",40,0)
 I '$L($G(^XTMP("ORBDUP",ORBDFN_";"_ORN_";"_ORBPMSG))) S ^XTMP("ORBDUP",ORBDFN_";"_ORN_";"_ORBPMSG)=ORBNOW_"^"_$G(ORNUM)
"RTN","ORB31",41,0)
 E  D
"RTN","ORB31",42,0)
 .S ORBLAST=$G(^XTMP("ORBDUP",ORBDFN_";"_ORN_";"_ORBPMSG))
"RTN","ORB31",43,0)
 .S ORLNUM=$P(ORBLAST,"^",2)
"RTN","ORB31",44,0)
 .S ORBLAST=$P(ORBLAST,"^")
"RTN","ORB31",45,0)
 .I $L($G(ORNUM)),$L($G(ORLNUM)),($$ORDERER^ORQOR2(ORNUM)=$$ORDERER^ORQOR2(ORLNUM)) S ORSAMEP=1 ;same provider as last order that triggered this notif
"RTN","ORB31",46,0)
 .;if last occurrence of this "NOT" notif was w/in past 1 min, its a dup
"RTN","ORB31",47,0)
 .I ORBNOW<$$FMADD^XLFDT(ORBLAST,"","",1,""),ORSAMEP=1 S ORBDUP=1  ;dup
"RTN","ORB31",48,0)
 .E  S ^XTMP("ORBDUP",ORBDFN_";"_ORN_";"_ORBPMSG)=ORBNOW_"^"_ORNUM  ;refresh last pt/noti occ.
"RTN","ORB31",49,0)
 D DUPCLN(ORBNOW)  ;clean up old ^XTMP("ORBUP") entries
"RTN","ORB31",50,0)
 Q ORBDUP
"RTN","ORB31",51,0)
REGDEV(ORBDA) ;send to regular recipient devices
"RTN","ORB31",52,0)
 N ORBDT,ORBD
"RTN","ORB31",53,0)
 S ORBD=""
"RTN","ORB31",54,0)
 S ORBDT=$$NOW^XLFDT
"RTN","ORB31",55,0)
 F   S ORBD=$O(ORBDA(ORBD)) Q:ORBD=""  D
"RTN","ORB31",56,0)
 .S ZTRTN="PRINTD^ORB31",ZTDESC="Print Notification to Device",ZTDTH=$H
"RTN","ORB31",57,0)
 .S ZTIO=ORBD,ZTSAVE("XQAMSG")="",ZTSAVE("ORBDT")=""
"RTN","ORB31",58,0)
 .D ^%ZTLOAD
"RTN","ORB31",59,0)
 Q
"RTN","ORB31",60,0)
PRINTD ;print queued notification to device - setup via REGDEV^ORB3
"RTN","ORB31",61,0)
 I $G(ZTSK) D KILL^%ZTLOAD
"RTN","ORB31",62,0)
 I IOT="HFS" W XQAMSG Q  ;write msg to a file then quit
"RTN","ORB31",63,0)
 W !!!,"          ***** NOTIFICATION PROCESSED *****",!!
"RTN","ORB31",64,0)
 W $$FMTE^XLFDT(ORBDT),"   "
"RTN","ORB31",65,0)
 W XQAMSG
"RTN","ORB31",66,0)
 I $E(IOST,1,2)'="C-" W @IOF
"RTN","ORB31",67,0)
 Q
"RTN","ORB31",68,0)
FWD(ORY,ORBLST,ORBTYPE,ORBCOMNT,ORBRECIP) ; forward a notification
"RTN","ORB31",69,0)
 S ORBLST(1)=ORBLST
"RTN","ORB31",70,0)
 D FORWARD^XQALFWD(.ORBLST,.ORBRECIP,ORBTYPE,ORBCOMNT)
"RTN","ORB31",71,0)
 S ORY=1
"RTN","ORB31",72,0)
 Q
"RTN","ORB31",73,0)
TERMLKUP(OCXARR,OCXTERM) ; extrinsic function returns the local terms
"RTN","ORB31",74,0)
 ; linked to the nat'l OCX term in an array and the file where those
"RTN","ORB31",75,0)
 ; array terms can be found. The value of the extrinsic function is the
"RTN","ORB31",76,0)
 ; file pointed to for the local terms.
"RTN","ORB31",77,0)
 ;
"RTN","ORB31",78,0)
 ; OCXARR  - Array of local terms
"RTN","ORB31",79,0)
 ; OCXTERM - OCX nat'l term from file ^OCXS(860.9
"RTN","ORB31",80,0)
 ;
"RTN","ORB31",81,0)
 N OCXI,OCXJ,FILE,I
"RTN","ORB31",82,0)
 S OCXI="",OCXJ=0,FILE="",I=1
"RTN","ORB31",83,0)
 S OCXI=$O(^OCXS(860.9,"B",OCXTERM,OCXI))
"RTN","ORB31",84,0)
 I +$G(OCXI)>0 D
"RTN","ORB31",85,0)
 .S FILE=$P(^OCXS(860.9,OCXI,0),U,2)
"RTN","ORB31",86,0)
 .F  S OCXJ=$O(^OCXS(860.9,OCXI,1,OCXJ)) Q:+OCXJ<1  D
"RTN","ORB31",87,0)
 ..S OCXARR(I)=$P(^OCXS(860.9,OCXI,1,OCXJ,0),U,2)_U_$P(^(0),U)
"RTN","ORB31",88,0)
 ..S OCXARR=I,I=I+1
"RTN","ORB31",89,0)
 Q FILE
"RTN","ORB31",90,0)
DUPCLN(ORBNOW) ;clean up old entires in ^XTMP("ORBDUP")
"RTN","ORB31",91,0)
 N ORBX,ORBDT,ORNDT
"RTN","ORB31",92,0)
 S ORNDT=$$FMADD^XLFDT(ORBNOW,"","",-5,"")  ;entries older than 5 minutes
"RTN","ORB31",93,0)
 S ORBX=0
"RTN","ORB31",94,0)
 F  S ORBX=$O(^XTMP("ORBDUP",ORBX)) Q:ORBX=""  D
"RTN","ORB31",95,0)
 .S ORBDT=+$G(^XTMP("ORBDUP",ORBX))
"RTN","ORB31",96,0)
 .I $L(ORBDT),(ORBDT<ORNDT) K ^XTMP("ORBDUP",ORBX)
"RTN","ORB31",97,0)
 Q
"RTN","ORB31",98,0)
TMDEV(ORBTM) ;returns Device for a team in format device ien^device name
"RTN","ORB31",99,0)
 N ORBTDEV,ORBTDEVN
"RTN","ORB31",100,0)
 S ORBTDEVN=""
"RTN","ORB31",101,0)
 Q:'$L($G(ORBTM)) ""
"RTN","ORB31",102,0)
 Q:'$D(^OR(100.21,ORBTM,0)) ""
"RTN","ORB31",103,0)
 S ORBTDEV=$P(^OR(100.21,ORBTM,0),U,4)  ;get Team's device
"RTN","ORB31",104,0)
 Q:+$G(ORBTDEV)<1 ""
"RTN","ORB31",105,0)
 S X="`"_ORBTDEV,DIC=3.5,DIC(0)="" D ^DIC  ;DBIA #10114
"RTN","ORB31",106,0)
 Q:+Y<1 ""
"RTN","ORB31",107,0)
 S ORBTDEVN=$P(Y,U,2)
"RTN","ORB31",108,0)
 K DIC,Y,X
"RTN","ORB31",109,0)
 Q ORBTDEV_U_ORBTDEVN
"RTN","ORB31",110,0)
ENTITY(ORNUM,ENTDUZ) ;ext funct. rtns entity for parameter use
"RTN","ORB31",111,0)
 N ORBENT
"RTN","ORB31",112,0)
 S ORBENT="DIV^SYS^PKG"
"RTN","ORB31",113,0)
 ;use orderer's DUZ if notif triggered by ORMTIME:
"RTN","ORB31",114,0)
 I +$G(ENTDUZ)<1 S ORBENT="SYS^PKG" D
"RTN","ORB31",115,0)
 .I $L($G(ORNUM)) D  ;if order number use orderer's division
"RTN","ORB31",116,0)
 ..N ORNDUZ,ORDIV
"RTN","ORB31",117,0)
 ..S ORNDUZ=$$ORDERER^ORQOR2(ORNUM)
"RTN","ORB31",118,0)
 ..Q:'$L($G(ORNDUZ))
"RTN","ORB31",119,0)
 ..S ORDIV=0,ORDIV=$O(^VA(200,ORNDUZ,2,ORDIV))
"RTN","ORB31",120,0)
 ..I +$G(ORDIV)>0 S ORBENT=ORDIV_";DIC(4,^SYS^PKG"
"RTN","ORB31",121,0)
 Q ORBENT
"RTN","ORB31",122,0)
 ;
"RTN","ORB31",123,0)
ADT(ORN,ORBDFN,ORBPRIM,ORBATTD,ORDGPMA) ;get inpt primary and attending for ADT notifs
"RTN","ORB31",124,0)
 N ORBADTDT,VAINDT
"RTN","ORB31",125,0)
 ;if notif is deceased or discharge use prev visit d/t:
"RTN","ORB31",126,0)
 I (ORN=20)!(ORN=35) D
"RTN","ORB31",127,0)
 .S ORBADTDT=$S($D(ORDGPMA):$P(ORDGPMA,U),1:$P($G(^DPT(ORBDFN,.35)),U))
"RTN","ORB31",128,0)
 .I $L(ORBADTDT) S VAINDT=$$FMADD^XLFDT(ORBADTDT,"","","","-1")
"RTN","ORB31",129,0)
 ;
"RTN","ORB31",130,0)
 I ORN=18 S VAINDT=$P($G(ORDGPMA),U)  ;if admission use this visit d/t
"RTN","ORB31",131,0)
 ;
"RTN","ORB31",132,0)
 I $L($G(VAINDT)) D
"RTN","ORB31",133,0)
 .D INP^VADPT  ;get new VAIN array for appropriate visit
"RTN","ORB31",134,0)
 .S ORBPRIM=+$P(VAIN(2),U),ORBATTD=+$P(VAIN(11),U)
"RTN","ORB31",135,0)
 Q
"RTN","ORB3F1")
0^3^B4553805
"RTN","ORB3F1",1,0)
ORB3F1 ; slc/CLA - Extrinsic functions to support OE/RR 3 notifications ;5/8/95  15:16
"RTN","ORB3F1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,74,139**;Dec 17, 1997
"RTN","ORB3F1",3,0)
 ;
"RTN","ORB3F1",4,0)
XQAKILL(ORN) ;extrinsic function to return the delete mechanism for the notification based on definition in PARAM DEF file
"RTN","ORB3F1",5,0)
 N ORBKILL S ORBKILL=1
"RTN","ORB3F1",6,0)
 Q:$G(ORN)="" ORBKILL
"RTN","ORB3F1",7,0)
 S ORBKILL=$$GET^XPAR("DIV^SYS^PKG","ORB DELETE MECHANISM",ORN,"I")
"RTN","ORB3F1",8,0)
 I ORBKILL="A" S ORBKILL=0  ;delete for all recipients
"RTN","ORB3F1",9,0)
 E  S ORBKILL=1  ;default for delete mechanism is 1 (delete only for this recipient)
"RTN","ORB3F1",10,0)
 Q ORBKILL
"RTN","ORB3F1",11,0)
SITEORD(ORNUM,IOPT) ;Extrinsic function returns 1 (Yes) if the site has flagged the
"RTN","ORB3F1",12,0)
 ; orderable item (determined from the order number ORNUM) to trigger a
"RTN","ORB3F1",13,0)
 ; notification when ordered
"RTN","ORB3F1",14,0)
 N ORBFLAG,OI,ORBLST,ORBERR,ORBI,ORBE
"RTN","ORB3F1",15,0)
 S ORBFLAG=0,OI="",ORBE=""
"RTN","ORB3F1",16,0)
 Q:+$G(ORNUM)<1 ORBFLAG
"RTN","ORB3F1",17,0)
 S OI=$$OI^ORQOR2(ORNUM)
"RTN","ORB3F1",18,0)
 Q:+$G(OI)<1 ORBFLAG
"RTN","ORB3F1",19,0)
 I IOPT="I" D ENVAL^XPAR(.ORBLST,"ORB OI ORDERED - INPT","`"_OI,.ORBERR)
"RTN","ORB3F1",20,0)
 I IOPT="O" D ENVAL^XPAR(.ORBLST,"ORB OI ORDERED - OUTPT","`"_OI,.ORBERR)
"RTN","ORB3F1",21,0)
 I 'ORBERR,$G(ORBLST)>0 D
"RTN","ORB3F1",22,0)
 .F ORBI=1:1:ORBLST Q:ORBFLAG=1  D
"RTN","ORB3F1",23,0)
 ..S ORBE=$O(ORBLST(ORBE))
"RTN","ORB3F1",24,0)
 ..I $D(ORBLST(ORBE,OI)) S ORBFLAG=1
"RTN","ORB3F1",25,0)
 Q ORBFLAG
"RTN","ORB3F1",26,0)
SITERES(ORNUM,IOPT) ;Extrinsic function returns 1 (Yes) if the site has flagged the
"RTN","ORB3F1",27,0)
 ; orderable item (determined from the order number ORNUM) to trigger a
"RTN","ORB3F1",28,0)
 ; notification when resulted
"RTN","ORB3F1",29,0)
 N ORBFLAG,OI,ORBLST,ORBERR,ORBI,ORBE
"RTN","ORB3F1",30,0)
 S ORBFLAG=0,OI="",ORBE=""
"RTN","ORB3F1",31,0)
 Q:+$G(ORNUM)<1 ORBFLAG
"RTN","ORB3F1",32,0)
 S OI=$$OI^ORQOR2(ORNUM)
"RTN","ORB3F1",33,0)
 Q:+$G(OI)<1 ORBFLAG
"RTN","ORB3F1",34,0)
 I IOPT="I" D ENVAL^XPAR(.ORBLST,"ORB OI RESULTS - INPT","`"_OI,.ORBERR)
"RTN","ORB3F1",35,0)
 I IOPT="O" D ENVAL^XPAR(.ORBLST,"ORB OI RESULTS - OUTPT","`"_OI,.ORBERR)
"RTN","ORB3F1",36,0)
 I 'ORBERR,$G(ORBLST)>0 D
"RTN","ORB3F1",37,0)
 .F ORBI=1:1:ORBLST Q:ORBFLAG=1  D
"RTN","ORB3F1",38,0)
 ..S ORBE=$O(ORBLST(ORBE))
"RTN","ORB3F1",39,0)
 ..I $D(ORBLST(ORBE,OI)) S ORBFLAG=1
"RTN","ORB3F1",40,0)
 Q ORBFLAG
"RTN","ORB3F1",41,0)
LRRAD(OI) ;Extrinsic function returns 1 (true) if Orderable Item is a
"RTN","ORB3F1",42,0)
 ;Chemistry Lab ("S.CH") or Imaging ("S.XRAY") proc or Consult ("S.CSLT")
"RTN","ORB3F1",43,0)
 N OITEXT,ORBFLAG
"RTN","ORB3F1",44,0)
 S ORBFLAG=""
"RTN","ORB3F1",45,0)
 Q:+$G(OI)<1 ORBFLAG
"RTN","ORB3F1",46,0)
 Q:'$L($G(^ORD(101.43,OI,0))) ORBFLAG
"RTN","ORB3F1",47,0)
 S OITEXT=$P(^ORD(101.43,OI,0),U)
"RTN","ORB3F1",48,0)
 S OITEXT=$$UP^XLFSTR(OITEXT)
"RTN","ORB3F1",49,0)
 Q:$D(^ORD(101.43,"S.CH",OITEXT)) 1
"RTN","ORB3F1",50,0)
 Q:$D(^ORD(101.43,"S.XRAY",OITEXT)) 1
"RTN","ORB3F1",51,0)
 Q:$D(^ORD(101.43,"S.CSLT",OITEXT)) 1
"RTN","ORB3F1",52,0)
 Q ORBFLAG
"RTN","ORB3FUP1")
0^4^B48602965
"RTN","ORB3FUP1",1,0)
ORB3FUP1 ; slc/CLA - Routine to support notification follow-up actions ;7/15/95  17:23
"RTN","ORB3FUP1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,64,74,105,139**;Dec 17, 1997
"RTN","ORB3FUP1",3,0)
 Q
"RTN","ORB3FUP1",4,0)
TYPE(ORBY,ORXQAID) ; return notif follow-up action type
"RTN","ORB3FUP1",5,0)
 N NIEN
"RTN","ORB3FUP1",6,0)
 S NIEN=$P($P(ORXQAID,";"),",",3)
"RTN","ORB3FUP1",7,0)
 S ORBY=$G(^ORD(100.9,NIEN,3))
"RTN","ORB3FUP1",8,0)
 I ORBY="" S ORBY="INFO^"
"RTN","ORB3FUP1",9,0)
 E  S ORBY=$P(ORBY,U,2)
"RTN","ORB3FUP1",10,0)
 Q
"RTN","ORB3FUP1",11,0)
GUI(ORBY,ORXQAID) ; Notification follow-up for GUI called via API: ORB FOLLOW-UP
"RTN","ORB3FUP1",12,0)
 ; called by ORB FOLLOW-UP api:
"RTN","ORB3FUP1",13,0)
 S ORENVIR="GUI"
"RTN","ORB3FUP1",14,0)
 D PROCESS
"RTN","ORB3FUP1",15,0)
 Q
"RTN","ORB3FUP1",16,0)
PROCESS ; main process for notification follow-up
"RTN","ORB3FUP1",17,0)
 ;ORXQAID = OR,dfn,nien;
"RTN","ORB3FUP1",18,0)
 ;XQADATA = placer num^placer id;filler num^filler id
"RTN","ORB3FUP1",19,0)
 ;XQAKILL = value of parameter ORB DELETE MECHANISM for notif in 101.9
"RTN","ORB3FUP1",20,0)
 N ORPDIEN,ORN,ORDFN,ORSITE,ORFID,ORFIEN,ORKILL
"RTN","ORB3FUP1",21,0)
 D GETACT^XQALERT(ORXQAID)  ;return follow-up action info
"RTN","ORB3FUP1",22,0)
 ;Q:'($D(XQADATA))  Q:'($D(XQAID))
"RTN","ORB3FUP1",23,0)
 ;Q:($P(XQAID,",")'="OR")
"RTN","ORB3FUP1",24,0)
 ;call function rpc stored in xqarou with params from xqadata
"RTN","ORB3FUP1",25,0)
 D @XQAROU
"RTN","ORB3FUP1",26,0)
 K ORENVIR
"RTN","ORB3FUP1",27,0)
 Q
"RTN","ORB3FUP1",28,0)
MSG ; display msg re: alert being processed for non-GUI follow-up actions
"RTN","ORB3FUP1",29,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP1",30,0)
 .I $L($G(XQX)) W !!,"Processing alert: ",$P(XQX,U,3) H 1.5
"RTN","ORB3FUP1",31,0)
 Q
"RTN","ORB3FUP1",32,0)
DEL(ORBY,XQAID,ORKILL) ; delete an alert
"RTN","ORB3FUP1",33,0)
 N ORN
"RTN","ORB3FUP1",34,0)
 S ORN=$P($P(XQAID,";"),",",3)
"RTN","ORB3FUP1",35,0)
 I $G(ORKILL)=1!($G(ORKILL)=0) S XQAKILL=ORKILL
"RTN","ORB3FUP1",36,0)
 I $G(XQAKILL)="" S XQAKILL=$$XQAKILL^ORB3F1(ORN)
"RTN","ORB3FUP1",37,0)
 I $G(XQAKILL)="" S XQAKILL=1
"RTN","ORB3FUP1",38,0)
 S ORBY="FALSE"
"RTN","ORB3FUP1",39,0)
 I $L($G(XQAID)) D DELETE^XQALERT S ORBY="TRUE"
"RTN","ORB3FUP1",40,0)
 K XQAKILL
"RTN","ORB3FUP1",41,0)
 Q
"RTN","ORB3FUP1",42,0)
CSORD ;co-sign order(s) follow-up
"RTN","ORB3FUP1",43,0)
 K XQAKILL
"RTN","ORB3FUP1",44,0)
 N ORPT,ORDG,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP1",45,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",46,0)
 ;the FLG code for orders requiring CO-SIGNATURE in ORQ1 is 'to be determined when ASU is available'
"RTN","ORB3FUP1",47,0)
 D DEL(.ORY,XQAID)  ;until ASU is implemented, delete the alert and quit
"RTN","ORB3FUP1",48,0)
 Q  ;quit until ASU is implemented
"RTN","ORB3FUP1",49,0)
 ;I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",???,"","")
"RTN","ORB3FUP1",50,0)
 ;I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",51,0)
 ;.D MSG
"RTN","ORB3FUP1",52,0)
 ;.S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",53,0)
 ;.D EN^ORCB(ORPT,???,ORDG,???)
"RTN","ORB3FUP1",54,0)
 ;.K ^TMP("ORR",$J)
"RTN","ORB3FUP1",55,0)
 ;.D EN^ORQ1(ORPT_";DPT(",ORDG,???,"","","",0,0)
"RTN","ORB3FUP1",56,0)
 ;.S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP1",57,0)
 ;..D DEL(.ORY,ORBXQAID)  ;if no more orders req. co-sign, delete the alert
"RTN","ORB3FUP1",58,0)
 ;.K ^TMP("ORR",$J)
"RTN","ORB3FUP1",59,0)
 Q
"RTN","ORB3FUP1",60,0)
EXDNR ;expiring dnr follow-up
"RTN","ORB3FUP1",61,0)
 K XQAKILL
"RTN","ORB3FUP1",62,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP1",63,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",64,0)
 N DNRORD,DNRY S DNRORD=$P(XQADATA,"@")
"RTN","ORB3FUP1",65,0)
 I $G(ORENVIR)="GUI" D
"RTN","ORB3FUP1",66,0)
 .S ORBY(1)=DNRY
"RTN","ORB3FUP1",67,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP1",68,0)
 .D MSG
"RTN","ORB3FUP1",69,0)
 .D EN1^ORCB(DNRORD,"RENEW")  ;display order, allow renewing, then delete
"RTN","ORB3FUP1",70,0)
 .D DEL(.ORY,ORBXQAID)
"RTN","ORB3FUP1",71,0)
 Q
"RTN","ORB3FUP1",72,0)
UNLINKED ;unlinked provider follow-up
"RTN","ORB3FUP1",73,0)
 K XQAKILL
"RTN","ORB3FUP1",74,0)
 N ORPT,ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP1",75,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",76,0)
 N ORNUM,ORUNY S ORNUM=$P(XQADATA,"@")
"RTN","ORB3FUP1",77,0)
 I $G(ORENVIR)="GUI" D 
"RTN","ORB3FUP1",78,0)
 .S ORBY(1)=ORUNY
"RTN","ORB3FUP1",79,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP1",80,0)
 .D MSG
"RTN","ORB3FUP1",81,0)
 .D EN1^ORCB(ORNUM,"REPLACE")  ;display order, allow replace, then delete
"RTN","ORB3FUP1",82,0)
 .D DEL(.ORY,ORBXQAID)
"RTN","ORB3FUP1",83,0)
 Q
"RTN","ORB3FUP1",84,0)
FLORD ;flagged order(s) follow-up
"RTN","ORB3FUP1",85,0)
 K XQAKILL
"RTN","ORB3FUP1",86,0)
 N ORPT,ORDG,X,ORBXQAID,ORY,ORBLMDEL
"RTN","ORB3FUP1",87,0)
 S ORBXQAID=XQAID
"RTN","ORB3FUP1",88,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",89,0)
 ;the FLG code for "FLAGGED" in ORQ1 is '12'
"RTN","ORB3FUP1",90,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",12,"","")
"RTN","ORB3FUP1",91,0)
 I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",92,0)
 .D MSG
"RTN","ORB3FUP1",93,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",94,0)
 .D EN^ORCB(ORPT,12,ORDG,.ORBLMDEL)
"RTN","ORB3FUP1",95,0)
 .K ^TMP("ORR",$J)
"RTN","ORB3FUP1",96,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP1",97,0)
 .D EN^ORQ1(ORPT_";DPT(",ORDG,12,"","","",0,0)
"RTN","ORB3FUP1",98,0)
 .S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP1",99,0)
 ..D DEL(.ORY,ORBXQAID)  ;if no more flagged orders found, delete alert
"RTN","ORB3FUP1",100,0)
 .K ^TMP("ORR",$J)
"RTN","ORB3FUP1",101,0)
 Q
"RTN","ORB3FUP1",102,0)
NEWORD ;new order(s) follow-up
"RTN","ORB3FUP1",103,0)
 K XQAKILL
"RTN","ORB3FUP1",104,0)
 N ORPT,ORDG,ORSDT,OREDT,ENT,X,ORBXQAID,ORY,ORBLMDEL
"RTN","ORB3FUP1",105,0)
 S ORSDT="",OREDT="",ENT="USR",ORBXQAID=XQAID
"RTN","ORB3FUP1",106,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",107,0)
 ;the FLG code for NEW orders since last reviewed orders in ORQ1 is '6'
"RTN","ORB3FUP1",108,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",6,"","")
"RTN","ORB3FUP1",109,0)
 I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",110,0)
 .D MSG
"RTN","ORB3FUP1",111,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",112,0)
 .D EN^ORCB(ORPT,6,ORDG,.ORBLMDEL)
"RTN","ORB3FUP1",113,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP1",114,0)
 .D DEL(.ORY,ORBXQAID) ;delete the alert
"RTN","ORB3FUP1",115,0)
 Q
"RTN","ORB3FUP1",116,0)
DCORD ;DC order(s) follow-up
"RTN","ORB3FUP1",117,0)
 K XQAKILL
"RTN","ORB3FUP1",118,0)
 N ORPT,ORDG,ORSDT,OREDT,ENT,X,ORBXQAID,ORY,ORBLMDEL
"RTN","ORB3FUP1",119,0)
 S ORSDT="",OREDT="",ENT="USR",ORBXQAID=XQAID
"RTN","ORB3FUP1",120,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",121,0)
 ;the FLG code for DC orders is '3'
"RTN","ORB3FUP1",122,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",6,"","")
"RTN","ORB3FUP1",123,0)
 I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",124,0)
 .D MSG
"RTN","ORB3FUP1",125,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",126,0)
 .D EN^ORCB(ORPT,6,ORDG,.ORBLMDEL)
"RTN","ORB3FUP1",127,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP1",128,0)
 .D DEL(.ORY,ORBXQAID) ;delete the alert
"RTN","ORB3FUP1",129,0)
 Q
"RTN","ORB3FUP1",130,0)
NUMORD ;detailed order display follow-up - return order number
"RTN","ORB3FUP1",131,0)
 K XQAKILL
"RTN","ORB3FUP1",132,0)
 N ORBXQAID,ORY S ORBXQAID=XQAID
"RTN","ORB3FUP1",133,0)
 S ORNUM=$P(XQADATA,"@")
"RTN","ORB3FUP1",134,0)
 I $G(ORENVIR)="GUI" D
"RTN","ORB3FUP1",135,0)
 .Q
"RTN","ORB3FUP1",136,0)
 I $G(ORENVIR)'="GUI" D
"RTN","ORB3FUP1",137,0)
 .D MSG
"RTN","ORB3FUP1",138,0)
 .D EN1^ORCB(+ORNUM,"NEW")  ;display order, allow new order then delete
"RTN","ORB3FUP1",139,0)
 .D DEL(.ORY,ORBXQAID)
"RTN","ORB3FUP1",140,0)
 Q
"RTN","ORB3FUP1",141,0)
ESORD ;order(s) requiring electronic signature follow-up
"RTN","ORB3FUP1",142,0)
 K XQAKILL
"RTN","ORB3FUP1",143,0)
 N ORPT,ORDG,ORBXQAID,ORY,ORX,ORZ,ORDERS,ORDNUM,ORQUIT,ORBLMDEL
"RTN","ORB3FUP1",144,0)
 S ORBXQAID=XQAID,ORDERS=0,ORQUIT=0
"RTN","ORB3FUP1",145,0)
 S ORPT=$P($P(XQAID,";"),",",2)  ;get pt dfn from xqaid
"RTN","ORB3FUP1",146,0)
 ;the FLG code for UNSIGNED orders in ORQ1 is '11'
"RTN","ORB3FUP1",147,0)
 I $G(ORENVIR)="GUI" D LIST^ORQOR1(.ORBY,ORPT,"ALL",11,"","")
"RTN","ORB3FUP1",148,0)
 I $G(ORENVIR)'="GUI" D 
"RTN","ORB3FUP1",149,0)
 .D MSG
"RTN","ORB3FUP1",150,0)
 .S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",151,0)
 .D EN^ORCB(ORPT,11,ORDG,.ORBLMDEL)
"RTN","ORB3FUP1",152,0)
 .K ^TMP("ORR",$J)  ;clean up array
"RTN","ORB3FUP1",153,0)
 .Q:$G(ORBLMDEL)=1  ;if EN^ORCB rtns ORBLMDEL=1, alert was removed in LM
"RTN","ORB3FUP1",154,0)
 .I $L($G(XQAID)) D  ;EN^ORCB may kill XQAID in its follow-up
"RTN","ORB3FUP1",155,0)
 ..;
"RTN","ORB3FUP1",156,0)
 ..;get unsigned orders - if none exist, delete alert then quit:
"RTN","ORB3FUP1",157,0)
 ..D EN^ORQ1(ORPT_";DPT(",ORDG,11,"","","",0,0)
"RTN","ORB3FUP1",158,0)
 ..S ORX="",ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""  I +$G(^TMP("ORR",$J,ORX,"TOT"))<1 D DEL(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORB3FUP1",159,0)
 ..;
"RTN","ORB3FUP1",160,0)
 ..;user does not have ORES key, delete user's alert:
"RTN","ORB3FUP1",161,0)
 ..I '$D(^XUSEC("ORES",DUZ)) S XQAKILL=1 D DEL(.ORY,ORBXQAID) K ^TMP("ORR",$J) Q
"RTN","ORB3FUP1",162,0)
 ..;
"RTN","ORB3FUP1",163,0)
 ..;if prov is NOT linked to pt via attending, primary, teams or PCMM:
"RTN","ORB3FUP1",164,0)
 ..I $$PPLINK^ORQPTQ1(DUZ,ORPT)=0 D
"RTN","ORB3FUP1",165,0)
 ...S ORX="" F  S ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""!(ORDERS=1)  D
"RTN","ORB3FUP1",166,0)
 ....S ORZ="" F  S ORZ=$O(^TMP("ORR",$J,ORX,ORZ)) Q:ORZ=""!(ORDERS=1)  D
"RTN","ORB3FUP1",167,0)
 .....S ORDNUM=^TMP("ORR",$J,ORX,ORZ)
"RTN","ORB3FUP1",168,0)
 .....;quit if this unsigned order's last action was made by the user
"RTN","ORB3FUP1",169,0)
 .....I DUZ=+$$UNSIGNOR^ORQOR2(ORDNUM) S ORDERS=1
"RTN","ORB3FUP1",170,0)
 ...I ORDERS'=1 D  ;provider has no outstanding unsiged orders for pt
"RTN","ORB3FUP1",171,0)
 ....S XQAKILL=1 D DEL(.ORY,ORBXQAID) ;delete alert for this user
"RTN","ORB3FUP1",172,0)
 ..K ^TMP("ORR",$J)
"RTN","ORB3FUP1",173,0)
 Q
"RTN","ORB3FUP1",174,0)
UNFLAG(ORPT) ;order unflagged - delete alert if no more flagged orders
"RTN","ORB3FUP1",175,0)
 N ORDG
"RTN","ORB3FUP1",176,0)
 S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORB3FUP1",177,0)
 K ^TMP("ORR",$J)
"RTN","ORB3FUP1",178,0)
 D EN^ORQ1(ORPT_";DPT(",ORDG,12,"","","",0,0)
"RTN","ORB3FUP1",179,0)
 S X="",X=$O(^TMP("ORR",$J,X)) Q:X=""  I +$G(^TMP("ORR",$J,X,"TOT"))<1 D
"RTN","ORB3FUP1",180,0)
 .;if no more flagged orders found, delete alert:
"RTN","ORB3FUP1",181,0)
 .S XQAKILL=$$XQAKILL^ORB3F1(6)
"RTN","ORB3FUP1",182,0)
 .I $G(XQAKILL)="" S XQAKILL=1
"RTN","ORB3FUP1",183,0)
 .S XQAID="OR,"_ORPT_",6" D DELETEA^XQALERT K XQAID,XQAKILL
"RTN","ORB3FUP1",184,0)
 K ^TMP("ORR",$J)
"RTN","ORB3FUP1",185,0)
 Q
"RTN","ORB3MGR1")
0^10^B58432414
"RTN","ORB3MGR1",1,0)
ORB3MGR1 ; SLC/AEB - Manager Options - Notifications Parameters ;9/22/97
"RTN","ORB3MGR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**31,74,85,88,105,139**;Dec 17, 1997
"RTN","ORB3MGR1",3,0)
 ;
"RTN","ORB3MGR1",4,0)
 ;Calls to Add/Change/Delete Parameters
"RTN","ORB3MGR1",5,0)
 ;
"RTN","ORB3MGR1",6,0)
URG ; Notification Urgency - By Entity
"RTN","ORB3MGR1",7,0)
 ;
"RTN","ORB3MGR1",8,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",9,0)
 S ORBT="Set URGENCY Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",10,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB URGENCY",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",11,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",12,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",13,0)
 Q
"RTN","ORB3MGR1",14,0)
 ;
"RTN","ORB3MGR1",15,0)
DEL ;
"RTN","ORB3MGR1",16,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",17,0)
 S ORBT="Set DELETE MECHANISM Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",18,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB DELETE MECHANISM",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",19,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",20,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",21,0)
 Q
"RTN","ORB3MGR1",22,0)
 ;
"RTN","ORB3MGR1",23,0)
REGR ;
"RTN","ORB3MGR1",24,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",25,0)
 S ORBT="Set REGULAR (DEFAULT) RECIPIENTS Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",26,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB DEFAULT RECIPIENTS",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",27,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",28,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",29,0)
 Q
"RTN","ORB3MGR1",30,0)
 ;
"RTN","ORB3MGR1",31,0)
REGDEV ;
"RTN","ORB3MGR1",32,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",33,0)
 S ORBT="Set REGULAR (DEFAULT) RECIPIENT DEVICES Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",34,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB DEFAULT RECIPIENT DEVICES",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",35,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",36,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",37,0)
 Q
"RTN","ORB3MGR1",38,0)
 ;
"RTN","ORB3MGR1",39,0)
TITLR ;
"RTN","ORB3MGR1",40,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",41,0)
 S ORBT="Set PROVIDER RECIPIENTS Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",42,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB PROVIDER RECIPIENTS",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",43,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",44,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",45,0)
 Q
"RTN","ORB3MGR1",46,0)
 ;
"RTN","ORB3MGR1",47,0)
PFLAG ;
"RTN","ORB3MGR1",48,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",49,0)
 S ORBT="Set PROCESSING FLAG Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",50,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB PROCESSING FLAG",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",51,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",52,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",53,0)
 Q
"RTN","ORB3MGR1",54,0)
 ;
"RTN","ORB3MGR1",55,0)
ERASE ;
"RTN","ORB3MGR1",56,0)
 N ORBT,ORBX,ORBPAR,ORBER,DUOUT,DIRUT
"RTN","ORB3MGR1",57,0)
 S ORBT="Erase Notifications"
"RTN","ORB3MGR1",58,0)
 S ORBER=0
"RTN","ORB3MGR1",59,0)
 Q:$D(DUOUT)!(ORBER="")
"RTN","ORB3MGR1",60,0)
 D TITLE(ORBT)
"RTN","ORB3MGR1",61,0)
 W !!!,?5,"1.  Erase all notifications for a User "
"RTN","ORB3MGR1",62,0)
 W !!,?5,"2.  Erase all notifications for a Patient "
"RTN","ORB3MGR1",63,0)
 W !!,?5,"3.  Erase all instances of a notification (regardless of Patient or User) "
"RTN","ORB3MGR1",64,0)
 W !!,?5,"4.  Erase specific notifications for a User "
"RTN","ORB3MGR1",65,0)
 W !!,?5,"5.  Edit Erase All Notifications parameter for a User ",!!
"RTN","ORB3MGR1",66,0)
 K DIR S DIR(0)="NAO^1:5",DIR("A")="Select Erase option:  "
"RTN","ORB3MGR1",67,0)
 D ^DIR S ORBER=Y K DIR Q:$D(DIRUT)
"RTN","ORB3MGR1",68,0)
 K Y,X,DTOUT,DUOUT,DIRUT
"RTN","ORB3MGR1",69,0)
 I (ORBER=1) D RECIPURG^ORB3MGR2
"RTN","ORB3MGR1",70,0)
 I (ORBER=2) D PTPURG^ORB3MGR2
"RTN","ORB3MGR1",71,0)
 I (ORBER=3) D NOTIPURG^ORB3MGR2
"RTN","ORB3MGR1",72,0)
 I (ORBER=4) D USERDEL^ORB3MGR2
"RTN","ORB3MGR1",73,0)
 I (ORBER=5) D ERASEALL^ORB3MGR2
"RTN","ORB3MGR1",74,0)
 D ERASE
"RTN","ORB3MGR1",75,0)
 Q
"RTN","ORB3MGR1",76,0)
 ;
"RTN","ORB3MGR1",77,0)
FLGOI ;
"RTN","ORB3MGR1",78,0)
 N ORBT,ORBOI,DIRUT,DUOUT,Y
"RTN","ORB3MGR1",79,0)
 S ORBT="Flag ORDERABLE ITEMS to send Notifications"
"RTN","ORB3MGR1",80,0)
 F  D  Q:$D(DUOUT)!(Y="")
"RTN","ORB3MGR1",81,0)
 .S Y=0
"RTN","ORB3MGR1",82,0)
 .D TITLE(ORBT)
"RTN","ORB3MGR1",83,0)
 .W !!,"1.  Flag INPATIENT orders/results/expiring orders."
"RTN","ORB3MGR1",84,0)
 .W !,"2.  Flag OUTPATIENT orders/results/expiring orders."
"RTN","ORB3MGR1",85,0)
 .W !,"3.  Flag Lab tests for Threshold Exceeded alerts.",!
"RTN","ORB3MGR1",86,0)
 .K DIR S DIR(0)="NAO^1:3",DIR("A")="Select ""1"" to flag INPT orders/results, ""2"" to flag OUTPT orders/results, ""3"" to set Lab Thresholds: "
"RTN","ORB3MGR1",87,0)
 .D ^DIR S ORBOI=Y K DIR Q:$D(DIRUT)
"RTN","ORB3MGR1",88,0)
 .K X,DTOUT,DUOUT,DIRUT
"RTN","ORB3MGR1",89,0)
 .I ORBOI=1 D INPTOI
"RTN","ORB3MGR1",90,0)
 .I ORBOI=2 D OUTPTOI
"RTN","ORB3MGR1",91,0)
 .I ORBOI=3 D LABTHRES^ORB3MGR2
"RTN","ORB3MGR1",92,0)
 Q
"RTN","ORB3MGR1",93,0)
INPTOI ;
"RTN","ORB3MGR1",94,0)
 N ORBT,ORBPAR,ORBOI,DIRUT,DUOUT,PIEN,Y
"RTN","ORB3MGR1",95,0)
 S ORBT="Flag INPATIENT orderable items to send Notifications/Alerts"
"RTN","ORB3MGR1",96,0)
 F  D  Q:$D(DUOUT)!(Y="")
"RTN","ORB3MGR1",97,0)
 .D TITLE(ORBT)
"RTN","ORB3MGR1",98,0)
 .W !!,"1.  Flag Inpatient ORDERS."
"RTN","ORB3MGR1",99,0)
 .W !,"2.  Flag Inpatient RESULTS."
"RTN","ORB3MGR1",100,0)
 .W !,"3.  Flag Inpatient EXPIRING orders.",!
"RTN","ORB3MGR1",101,0)
 .S PIEN=0,Y=0
"RTN","ORB3MGR1",102,0)
 .K DIR S DIR(0)="NAO^1:3",DIR("A")="Select ""1"" to flag inpt ORDERS, ""2"" to flag inpt RESULTS, ""3"" to flag inpt EXPIRING orders: "
"RTN","ORB3MGR1",103,0)
 .D ^DIR S ORBOI=Y K DIR Q:$D(DIRUT)
"RTN","ORB3MGR1",104,0)
 .K X,DTOUT,DUOUT,DIRUT
"RTN","ORB3MGR1",105,0)
 .I ORBOI=1 D
"RTN","ORB3MGR1",106,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI ORDERED - INPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",107,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",108,0)
 .I ORBOI=2 D
"RTN","ORB3MGR1",109,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI RESULTS - INPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",110,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",111,0)
 .I ORBOI=3 D
"RTN","ORB3MGR1",112,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI EXPIRING - INPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",113,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",114,0)
 .D PROC(ORBPAR)
"RTN","ORB3MGR1",115,0)
 Q
"RTN","ORB3MGR1",116,0)
 ;
"RTN","ORB3MGR1",117,0)
OUTPTOI ;
"RTN","ORB3MGR1",118,0)
 N ORBT,ORBPAR,ORBOI,DIRUT,DUOUT,PIEN,Y
"RTN","ORB3MGR1",119,0)
 S ORBT="Flag OUTPATIENT orderable items to send Notifications"
"RTN","ORB3MGR1",120,0)
 F  D  Q:$D(DUOUT)!(Y="")
"RTN","ORB3MGR1",121,0)
 .D TITLE(ORBT)
"RTN","ORB3MGR1",122,0)
 .W !!,"1.  Flag Outpatient ORDERS."
"RTN","ORB3MGR1",123,0)
 .W !,"2.  Flag Outpatient RESULTS."
"RTN","ORB3MGR1",124,0)
 .W !,"3.  Flag Outpatient EXPIRING orders.",!
"RTN","ORB3MGR1",125,0)
 .S PIEN=0,Y=0
"RTN","ORB3MGR1",126,0)
 .K DIR S DIR(0)="NAO^1:3",DIR("A")="Select ""1"" to flag outpt ORDERS, ""2"" to flag outpt RESULTS, ""3"" to flag outpt EXPIRING orders: "
"RTN","ORB3MGR1",127,0)
 .D ^DIR S ORBOI=Y K DIR Q:$D(DIRUT)
"RTN","ORB3MGR1",128,0)
 .K X,DTOUT,DUOUT,DIRUT
"RTN","ORB3MGR1",129,0)
 .I ORBOI=1 D
"RTN","ORB3MGR1",130,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI ORDERED - OUTPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",131,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",132,0)
 .I ORBOI=2 D
"RTN","ORB3MGR1",133,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI RESULTS - OUTPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",134,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",135,0)
 .I ORBOI=3 D
"RTN","ORB3MGR1",136,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI EXPIRING - OUTPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",137,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",138,0)
 .D PROC(ORBPAR)
"RTN","ORB3MGR1",139,0)
 Q
"RTN","ORB3MGR1",140,0)
 ;
"RTN","ORB3MGR1",141,0)
ARC ;
"RTN","ORB3MGR1",142,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",143,0)
 S ORBT="Set ARCHIVE PERIOD Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",144,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB ARCHIVE PERIOD",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",145,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",146,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",147,0)
 Q
"RTN","ORB3MGR1",148,0)
 ;
"RTN","ORB3MGR1",149,0)
FSUPER ;
"RTN","ORB3MGR1",150,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",151,0)
 S ORBT="Set FORWARD SUPERVISOR Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",152,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB FORWARD SUPERVISOR",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",153,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",154,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",155,0)
 Q
"RTN","ORB3MGR1",156,0)
 ;
"RTN","ORB3MGR1",157,0)
FSURR ;
"RTN","ORB3MGR1",158,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",159,0)
 S ORBT="Set FORWARD SURROGATES Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",160,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB FORWARD SURROGATES",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",161,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",162,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",163,0)
 Q
"RTN","ORB3MGR1",164,0)
 ;
"RTN","ORB3MGR1",165,0)
FREVIEW ;
"RTN","ORB3MGR1",166,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",167,0)
 S ORBT="Set FORWARD BACKUP REVIEWER Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",168,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB FORWARD BACKUP REVIEWER",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",169,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",170,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",171,0)
 Q
"RTN","ORB3MGR1",172,0)
 ;
"RTN","ORB3MGR1",173,0)
SORT ;
"RTN","ORB3MGR1",174,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",175,0)
 S ORBT="Set SORT METHOD Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",176,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB SORT METHOD",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",177,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",178,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",179,0)
 Q
"RTN","ORB3MGR1",180,0)
 ;
"RTN","ORB3MGR1",181,0)
FLGOB ;
"RTN","ORB3MGR1",182,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",183,0)
 S ORBT="Set FLAGGED ORDERS BULLETIN Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",184,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB FLAGGED ORDERS BULLETIN",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",185,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",186,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",187,0)
 Q
"RTN","ORB3MGR1",188,0)
 ;
"RTN","ORB3MGR1",189,0)
SYSEN ;
"RTN","ORB3MGR1",190,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",191,0)
 S ORBT="Enable or Disable Notification System",PIEN=0
"RTN","ORB3MGR1",192,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB SYSTEM ENABLE/DISABLE",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",193,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",194,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",195,0)
 Q
"RTN","ORB3MGR1",196,0)
 ;
"RTN","ORB3MGR1",197,0)
UVMED ;
"RTN","ORB3MGR1",198,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",199,0)
 S ORBT="Set Delay for Unverified Medication Orders",PIEN=0
"RTN","ORB3MGR1",200,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB UNVERIFIED MED ORDER",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",201,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",202,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",203,0)
 Q
"RTN","ORB3MGR1",204,0)
 ;
"RTN","ORB3MGR1",205,0)
UNVER ;
"RTN","ORB3MGR1",206,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",207,0)
 S ORBT="Set Delay for All Unverified Orders",PIEN=0
"RTN","ORB3MGR1",208,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB UNVERIFIED ORDER",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",209,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",210,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",211,0)
 Q
"RTN","ORB3MGR1",212,0)
 ;
"RTN","ORB3MGR1",213,0)
TITLE(ORBT)  ;
"RTN","ORB3MGR1",214,0)
 ; Center and write title - Parameter to be set
"RTN","ORB3MGR1",215,0)
 S IOP=0 D ^%ZIS K IOP W @IOF
"RTN","ORB3MGR1",216,0)
 W !,?(80-$L(ORBT)-1/2),ORBT
"RTN","ORB3MGR1",217,0)
 Q
"RTN","ORB3MGR1",218,0)
 ;
"RTN","ORB3MGR1",219,0)
PROC(ORBPAR) ; Process Parameter Settings
"RTN","ORB3MGR1",220,0)
 D EDITPAR^XPAREDIT(ORBPAR)
"RTN","ORB3MGR1",221,0)
 Q
"RTN","ORB3REG")
0^6^B23676221
"RTN","ORB3REG",1,0)
ORB3REG ; slc/CLA - Support routine for ORB3 ;6/28/00  12:00 [ 04/02/97  2:16 PM ]
"RTN","ORB3REG",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**31,74,88,105,139**;Dec 17, 1997
"RTN","ORB3REG",3,0)
REGULAR(ORN,XQA,ORBU,ORBUI,ORBDEV,ORBDFN) ;get recips who always get notif
"RTN","ORB3REG",4,0)
 ; ORN: notif ien
"RTN","ORB3REG",5,0)
 ; XQA: DUZ array
"RTN","ORB3REG",6,0)
 ; ORBU: recip debug array
"RTN","ORB3REG",7,0)
 ; ORBUI: ORBU cntr
"RTN","ORB3REG",8,0)
 ; ORBDEV: device recips array
"RTN","ORB3REG",9,0)
 ; ORBDFN: patient ien
"RTN","ORB3REG",10,0)
 ;
"RTN","ORB3REG",11,0)
 N ORBX,ORLST,ORERR,ORBZ,ORBE,ORBDUZ,ORBDIV,ORBDIVX,ORBSUR,ORBACT
"RTN","ORB3REG",12,0)
 I $D(ORBU) D
"RTN","ORB3REG",13,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",14,0)
 .S ORBU(ORBUI)="Default recipient users and teams:",ORBUI=ORBUI+1
"RTN","ORB3REG",15,0)
 S ORBE=0,ORBX=0
"RTN","ORB3REG",16,0)
 ;
"RTN","ORB3REG",17,0)
 ;process default recip users & teams:
"RTN","ORB3REG",18,0)
 D ENVAL^XPAR(.ORLST,"ORB DEFAULT RECIPIENTS",ORN,.ORERR)
"RTN","ORB3REG",19,0)
 I 'ORERR,$G(ORLST)>0 D
"RTN","ORB3REG",20,0)
 .F ORBX=1:1:ORLST S ORBE=$O(ORLST(ORBE)) I ORLST(ORBE,ORN)=1 D
"RTN","ORB3REG",21,0)
 ..S ORBZ=$P(ORBE,";",2)
"RTN","ORB3REG",22,0)
 ..I ORBZ="VA(200," S ORBDUZ=$P(ORBE,";") I $L($G(ORBDUZ)) D
"RTN","ORB3REG",23,0)
 ...S ORBACT=+$$ACTIVE^XUSER(ORBDUZ)  ;active user?
"RTN","ORB3REG",24,0)
 ...;
"RTN","ORB3REG",25,0)
 ...I '$D(ORBU),(ORBACT=1) D
"RTN","ORB3REG",26,0)
 ....D PREALERT^ORB3USER(ORBDUZ,ORN,ORBDFN)
"RTN","ORB3REG",27,0)
 ....S XQA(ORBDUZ)=""
"RTN","ORB3REG",28,0)
 ...;
"RTN","ORB3REG",29,0)
 ...I $D(ORBU) N NODE S NODE=$G(^VA(200,ORBDUZ,0)) I $L($G(NODE)) D
"RTN","ORB3REG",30,0)
 ....I ORBACT=1 D
"RTN","ORB3REG",31,0)
 .....S ORBU(ORBUI)="   "_$P(NODE,U)_": ON because",ORBUI=ORBUI+1
"RTN","ORB3REG",32,0)
 .....S ORBU(ORBUI)="     Default Recipient (USER) parameter set to Yes.",ORBUI=ORBUI+1
"RTN","ORB3REG",33,0)
 ....;
"RTN","ORB3REG",34,0)
 ....I ORBACT=0 D
"RTN","ORB3REG",35,0)
 .....S ORBU(ORBUI)="   "_$P(NODE,U)_": OFF because",ORBUI=ORBUI+1
"RTN","ORB3REG",36,0)
 .....S ORBU(ORBUI)="     User's access to system has been terminated.",ORBUI=ORBUI+1
"RTN","ORB3REG",37,0)
 ....;
"RTN","ORB3REG",38,0)
 ....S ORBSUR=$$CURRSURO^XQALSURO(ORBDUZ)  ;DBIA #2790
"RTN","ORB3REG",39,0)
 ....I +$G(ORBSUR)>0,(+$$ACTIVE^XUSER(ORBSUR)=1) D
"RTN","ORB3REG",40,0)
 .....S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" will receive alert for user]",ORBUI=ORBUI+1
"RTN","ORB3REG",41,0)
 ....I +$G(ORBSUR)>0,(+$$ACTIVE^XUSER(ORBSUR)=0) D
"RTN","ORB3REG",42,0)
 .....S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" is INACTIVE - neither will receive alert]",ORBUI=ORBUI+1
"RTN","ORB3REG",43,0)
 ..;
"RTN","ORB3REG",44,0)
 ..I ORBZ="OR(100.21," D REGTEAM(ORBE)
"RTN","ORB3REG",45,0)
 ;
"RTN","ORB3REG",46,0)
 ;process SYSTEM default devices:
"RTN","ORB3REG",47,0)
 S ORBZ=$$GET^XPAR("SYS","ORB DEFAULT RECIPIENT DEVICES",ORN,"E")
"RTN","ORB3REG",48,0)
 I $L($G(ORBZ)) D
"RTN","ORB3REG",49,0)
 .I '$D(ORBU) S ORBDEV(ORBZ)=""
"RTN","ORB3REG",50,0)
 .I $D(ORBU) D
"RTN","ORB3REG",51,0)
 ..S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",52,0)
 ..S ORBU(ORBUI)="Default device: "_ORBZ_" because",ORBUI=ORBUI+1
"RTN","ORB3REG",53,0)
 ..S ORBU(ORBUI)="  Default System Device parameter set to Yes.",ORBUI=ORBUI+1
"RTN","ORB3REG",54,0)
 ;
"RTN","ORB3REG",55,0)
 ;process DIVISION default devices:
"RTN","ORB3REG",56,0)
 I +$G(DUZ)>1,($L($G(DUZ(2)))) S ORBDIV($G(DUZ(2)))=$G(DUZ(2))
"RTN","ORB3REG",57,0)
 E  D DIVS(.ORBDIV)
"RTN","ORB3REG",58,0)
 S ORBDIVX="" F  S ORBDIVX=$O(ORBDIV(ORBDIVX)) Q:'ORBDIVX  D
"RTN","ORB3REG",59,0)
 .S ORBZ=$$GET^XPAR("DIV.`"_ORBDIVX,"ORB DEFAULT RECIPIENT DEVICES",ORN,"E")
"RTN","ORB3REG",60,0)
 .I $L($G(ORBZ)) D
"RTN","ORB3REG",61,0)
 ..I '$D(ORBU) S ORBDEV(ORBZ)=""
"RTN","ORB3REG",62,0)
 ..I $D(ORBU) D
"RTN","ORB3REG",63,0)
 ...S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",64,0)
 ...S ORBU(ORBUI)="Default device: "_ORBZ_" because",ORBUI=ORBUI+1
"RTN","ORB3REG",65,0)
 ...S ORBU(ORBUI)="  Default Division Device parameter set to Yes.",ORBUI=ORBUI+1
"RTN","ORB3REG",66,0)
 Q
"RTN","ORB3REG",67,0)
REGTEAM(ORBE) ;get team recips
"RTN","ORB3REG",68,0)
 N ORBLST,IJ,ORBACT,ORBTD,ORBSUR
"RTN","ORB3REG",69,0)
 D TEAMPROV^ORQPTQ1(.ORBLST,$P(ORBE,";"))
"RTN","ORB3REG",70,0)
 I $D(ORBU) N TNODE S TNODE=$G(^OR(100.21,$P(ORBE,";"),0)) I $L($G(TNODE)) D
"RTN","ORB3REG",71,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",72,0)
 .S ORBU(ORBUI)="  Default team recipients from team "_$P(TNODE,U)_":",ORBUI=ORBUI+1
"RTN","ORB3REG",73,0)
 I +$G(ORBLST(1))>0 S IJ="" F  S IJ=$O(ORBLST(IJ)) Q:IJ=""  D
"RTN","ORB3REG",74,0)
 .S ORBDUZ=$P(ORBLST(IJ),U) I $L($G(ORBDUZ)) D
"RTN","ORB3REG",75,0)
 ..S ORBACT=+$$ACTIVE^XUSER(ORBDUZ)  ;active user?
"RTN","ORB3REG",76,0)
 ..I '$D(ORBU),(ORBACT=1) D
"RTN","ORB3REG",77,0)
 ...D PREALERT^ORB3USER(ORBDUZ,ORN,ORBDFN)
"RTN","ORB3REG",78,0)
 ...S XQA(ORBDUZ)=""
"RTN","ORB3REG",79,0)
 ..I $D(ORBU) N NODE S NODE=$G(^VA(200,ORBDUZ,0)) I $L($G(NODE)) D
"RTN","ORB3REG",80,0)
 ...I ORBACT=1 D
"RTN","ORB3REG",81,0)
 ....S ORBU(ORBUI)="   "_$P(NODE,U)_": ON because",ORBUI=ORBUI+1
"RTN","ORB3REG",82,0)
 ....S ORBU(ORBUI)="     Default Recipient (TEAM) parameter set to Yes.",ORBUI=ORBUI+1
"RTN","ORB3REG",83,0)
 ....S ORBSUR=$$CURRSURO^XQALSURO(ORBDUZ)  ;DBIA #2790
"RTN","ORB3REG",84,0)
 ....I +$G(ORBSUR)>0,(+$$ACTIVE^XUSER(ORBSUR)=1) D
"RTN","ORB3REG",85,0)
 .....S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" will receive alert for user]",ORBUI=ORBUI+1
"RTN","ORB3REG",86,0)
 ....I +$G(ORBSUR)>0,(+$$ACTIVE^XUSER(ORBSUR)=0) D
"RTN","ORB3REG",87,0)
 .....S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" is INACTIVE - neither will receive alert]",ORBUI=ORBUI+1
"RTN","ORB3REG",88,0)
 ...I ORBACT=0 D
"RTN","ORB3REG",89,0)
 ....S ORBU(ORBUI)="   "_$P(NODE,U)_": OFF because",ORBUI=ORBUI+1
"RTN","ORB3REG",90,0)
 ....S ORBU(ORBUI)="     User's system access is terminated.",ORBUI=ORBUI+1
"RTN","ORB3REG",91,0)
 ;
"RTN","ORB3REG",92,0)
 S ORBTD=$P($$TMDEV^ORB31($P(ORBE,";")),U,2)  ;tm device
"RTN","ORB3REG",93,0)
 I $L(ORBTD) D
"RTN","ORB3REG",94,0)
 .S ORBDEV(ORBTD)=""
"RTN","ORB3REG",95,0)
 .I $D(ORBU) D
"RTN","ORB3REG",96,0)
 ..S ORBU(ORBUI)="   Team's Device "_ORBTD_" is a recipient",ORBUI=ORBUI+1
"RTN","ORB3REG",97,0)
 ;
"RTN","ORB3REG",98,0)
 I $D(ORBU) S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3REG",99,0)
 Q
"RTN","ORB3REG",100,0)
DIVS(DIVS) ;get all possible divisions
"RTN","ORB3REG",101,0)
 ; DIVS - rtn array in format:
"RTN","ORB3REG",102,0)
 ; DIVS(div #)=div #
"RTN","ORB3REG",103,0)
 ;
"RTN","ORB3REG",104,0)
 N DIV
"RTN","ORB3REG",105,0)
 S DIV=0 F  S DIV=$O(^DG(40.8,"AD",DIV)) Q:'DIV  D
"RTN","ORB3REG",106,0)
 .S DIVS(DIV)=DIV
"RTN","ORB3REG",107,0)
 Q
"RTN","ORB3SPEC")
0^7^B31279317
"RTN","ORB3SPEC",1,0)
ORB3SPEC ; slc/CLA - Support routine for ORB3 ;4/4/02  14:40
"RTN","ORB3SPEC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**139**;Dec 17, 1997
"RTN","ORB3SPEC",3,0)
SPECIAL(ORN,ORBASPEC,ORBU,ORBUI,ORNUM,ORDFN,ORDATA,ORBSMSG,ORBMSG,ORBSDEV) ;
"RTN","ORB3SPEC",4,0)
 ;process special notifs to get recips (users,teams,devices)
"RTN","ORB3SPEC",5,0)
 ; ORN: notif ien
"RTN","ORB3SPEC",6,0)
 ; ORBASPEC: recip DUZ array
"RTN","ORB3SPEC",7,0)
 ; ORBU: recip debug array
"RTN","ORB3SPEC",8,0)
 ; ORBUI: ORBU cntr
"RTN","ORB3SPEC",9,0)
 ; ORNUM: order no
"RTN","ORB3SPEC",10,0)
 ; ORDFN: pt id
"RTN","ORB3SPEC",11,0)
 ; ORDATA: pkg data
"RTN","ORB3SPEC",12,0)
 ; ORBSMSG: special notif msg rtn by SPECIAL
"RTN","ORB3SPEC",13,0)
 ; ORBMSG: original notif msg
"RTN","ORB3SPEC",14,0)
 ; ORBSDEV: array of recip devices
"RTN","ORB3SPEC",15,0)
 ;
"RTN","ORB3SPEC",16,0)
 N ORPAR,ORPTLOC
"RTN","ORB3SPEC",17,0)
 S ORPTLOC=$S($L($G(^DPT(ORDFN,.1))):"I",1:"O")  ;DBIA #10035
"RTN","ORB3SPEC",18,0)
 ;
"RTN","ORB3SPEC",19,0)
 I ORPTLOC="I" D  ;inpt flagged OI notifs
"RTN","ORB3SPEC",20,0)
 .I ORN=32 S ORPAR="ORB OI RESULTS - INPT" D OI
"RTN","ORB3SPEC",21,0)
 .I ORN=41 S ORPAR="ORB OI ORDERED - INPT" D OI
"RTN","ORB3SPEC",22,0)
 .I ORN=64 S ORPAR="ORB OI EXPIRING - INPT" D OI
"RTN","ORB3SPEC",23,0)
 ;
"RTN","ORB3SPEC",24,0)
 I ORPTLOC="O" D  ;outpt flagged OI notifs
"RTN","ORB3SPEC",25,0)
 .I ORN=60 S ORPAR="ORB OI RESULTS - OUTPT" D OI
"RTN","ORB3SPEC",26,0)
 .I ORN=61 S ORPAR="ORB OI ORDERED - OUTPT" D OI
"RTN","ORB3SPEC",27,0)
 .I ORN=65 S ORPAR="ORB OI EXPIRING - OUTPT" D OI
"RTN","ORB3SPEC",28,0)
 ;
"RTN","ORB3SPEC",29,0)
 I ORN=3!(ORN=14)!(ORN=44)!(ORN=57) D  ;lab results notifs
"RTN","ORB3SPEC",30,0)
 .D LRALRTS(ORN,ORDFN,ORDATA,.ORBSMSG,ORBMSG)
"RTN","ORB3SPEC",31,0)
 ;
"RTN","ORB3SPEC",32,0)
 I ORN=33 D  ;requested results notif
"RTN","ORB3SPEC",33,0)
 .I $D(ORBU) D
"RTN","ORB3SPEC",34,0)
 ..S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3SPEC",35,0)
 ..S ORBU(ORBUI)="Potential Orderer-flagged Results recipient: ",ORBUI=ORBUI+1
"RTN","ORB3SPEC",36,0)
 .N RECIP
"RTN","ORB3SPEC",37,0)
 .S RECIP=$$RSLTFLG^ORQOR2(ORNUM)
"RTN","ORB3SPEC",38,0)
 .I +$G(RECIP)>0 D
"RTN","ORB3SPEC",39,0)
 ..S ORBASPEC(+$G(RECIP))=""
"RTN","ORB3SPEC",40,0)
 ..I $D(ORBU) N NODE S NODE=$G(^VA(200,+$G(RECIP),0)) I $L(NODE) D
"RTN","ORB3SPEC",41,0)
 ...S ORBU(ORBUI)="   "_$P(NODE,U)_" is a potential recipient.",ORBUI=ORBUI+1
"RTN","ORB3SPEC",42,0)
 Q
"RTN","ORB3SPEC",43,0)
OI ;get potential recips for OI-flagged notifs
"RTN","ORB3SPEC",44,0)
 N OROI,ORLST,ORERR,ORBX,ORBZ,ORBE,ORBDUZ,ORBDEV,ORBUF
"RTN","ORB3SPEC",45,0)
 S OROI=+$G(^OR(100,+$G(ORNUM),.1,1,0))  ;get oi
"RTN","ORB3SPEC",46,0)
 Q:+$G(OROI)<0
"RTN","ORB3SPEC",47,0)
 I $D(ORBU) D
"RTN","ORB3SPEC",48,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3SPEC",49,0)
 .S ORBU(ORBUI)="Special potential recipients from parameter: "_ORPAR,ORBUI=ORBUI+1
"RTN","ORB3SPEC",50,0)
 S ORBE=0,ORBX=0
"RTN","ORB3SPEC",51,0)
 ;
"RTN","ORB3SPEC",52,0)
 ;process special recip users, teams and devices:
"RTN","ORB3SPEC",53,0)
 D ENVAL^XPAR(.ORLST,ORPAR,"`"_OROI,.ORERR)
"RTN","ORB3SPEC",54,0)
 I 'ORERR,$G(ORLST)>0 D
"RTN","ORB3SPEC",55,0)
 .F ORBX=1:1:ORLST S ORBE=$O(ORLST(ORBE)),ORBZ=$P(ORBE,";",2),ORBUF=0 D
"RTN","ORB3SPEC",56,0)
 ..;
"RTN","ORB3SPEC",57,0)
 ..; process USERS:
"RTN","ORB3SPEC",58,0)
 ..I ORBZ="VA(200," S ORBDUZ=$P(ORBE,";") I $L(ORBDUZ) D
"RTN","ORB3SPEC",59,0)
 ...I ORLST(ORBE,OROI)=1 S ORBASPEC(ORBDUZ)="",ORBUF=1
"RTN","ORB3SPEC",60,0)
 ...I ORLST(ORBE,OROI)=0,$$PPLINK^ORQPTQ1(ORBDUZ,ORDFN) S ORBASPEC(ORBDUZ)="",ORBUF=1
"RTN","ORB3SPEC",61,0)
 ...I $D(ORBU),ORBUF=1 N NODE S NODE=$G(^VA(200,ORBDUZ,0)) I $L(NODE) D
"RTN","ORB3SPEC",62,0)
 ....S ORBU(ORBUI)="   "_$P(NODE,U)_" is a potential recipient.",ORBUI=ORBUI+1
"RTN","ORB3SPEC",63,0)
 ..;
"RTN","ORB3SPEC",64,0)
 ..; process DEVICES:
"RTN","ORB3SPEC",65,0)
 ..I ORBZ="%ZIS(1," S ORBDEV=$P(ORBE,";") I $L(ORBDEV) D
"RTN","ORB3SPEC",66,0)
 ...S ORBDEV=$G(^%ZIS(1,ORBDEV,0)) I $D(ORBDEV) D
"RTN","ORB3SPEC",67,0)
 ....I ORLST(ORBE,OROI)=1 S ORBSDEV($P(ORBDEV,U))="",ORBUF=1
"RTN","ORB3SPEC",68,0)
 ....I ORLST(ORBE,OROI)=0,$$PDLINK^ORQPTQ1(ORBDEV,ORDFN) S ORBSDEV($P(ORBDEV,U))="",ORBUF=1
"RTN","ORB3SPEC",69,0)
 ....I $D(ORBU),ORBUF=1 D
"RTN","ORB3SPEC",70,0)
 .....S ORBU(ORBUI)="   "_$P(ORBDEV,U)_" is a device recipient.",ORBUI=ORBUI+1
"RTN","ORB3SPEC",71,0)
 ..;
"RTN","ORB3SPEC",72,0)
 ..; process TEAMS:
"RTN","ORB3SPEC",73,0)
 ..I ORBZ="OR(100.21," D SPECTEAM(ORBE)
"RTN","ORB3SPEC",74,0)
 Q
"RTN","ORB3SPEC",75,0)
SPECTEAM(ORBE) ;get special team recips
"RTN","ORB3SPEC",76,0)
 N ORBLST,IJ,ORBTM
"RTN","ORB3SPEC",77,0)
 S ORBTM=$P(ORBE,";")
"RTN","ORB3SPEC",78,0)
 D TEAMPROV^ORQPTQ1(.ORBLST,ORBTM)
"RTN","ORB3SPEC",79,0)
 I $D(ORBU) N TNODE S TNODE=$G(^OR(100.21,ORBTM,0)) I $L(TNODE) D
"RTN","ORB3SPEC",80,0)
 .S ORBU(ORBUI)="   Team potential recipients from team "_$P(TNODE,U)_":",ORBUI=ORBUI+1
"RTN","ORB3SPEC",81,0)
 I +$G(ORBLST(1))>0 S IJ="" F  S IJ=$O(ORBLST(IJ)) Q:IJ=""  D
"RTN","ORB3SPEC",82,0)
 .S ORBDUZ=$P(ORBLST(IJ),U),ORBUF=0 I $L(ORBDUZ) D
"RTN","ORB3SPEC",83,0)
 ..I ORLST(ORBE,OROI)=1 S ORBASPEC(ORBDUZ_U_ORBTM)="",ORBUF=1
"RTN","ORB3SPEC",84,0)
 ..I ORLST(ORBE,OROI)=0,$D(^OR(100.21,ORBTM,10,"B",ORDFN_";DPT(")) S ORBASPEC(ORBDUZ_U_ORBTM)="",ORBUF=1
"RTN","ORB3SPEC",85,0)
 ..I $D(ORBU),ORBUF=1 N NODE S NODE=$G(^VA(200,ORBDUZ,0)) I $L(NODE) D
"RTN","ORB3SPEC",86,0)
 ...S ORBU(ORBUI)="     "_$P(NODE,U),ORBUI=ORBUI+1
"RTN","ORB3SPEC",87,0)
 ;
"RTN","ORB3SPEC",88,0)
 S ORBTD=$P($$TMDEV^ORB31(ORBTM),U,2)  ;tm's device
"RTN","ORB3SPEC",89,0)
 I $L(ORBTD) D
"RTN","ORB3SPEC",90,0)
 .S ORBSDEV(ORBTD)=""
"RTN","ORB3SPEC",91,0)
 .I $D(ORBU) D
"RTN","ORB3SPEC",92,0)
 ..S ORBU(ORBUI)="   Team's Device "_ORBTD_" is a recipient",ORBUI=ORBUI+1
"RTN","ORB3SPEC",93,0)
 Q
"RTN","ORB3SPEC",94,0)
LRALRTS(ORN,ORDFN,ORDATA,ORBSMSG,ORBMSG) ;find & delete matching alerts and gather recips
"RTN","ORB3SPEC",95,0)
 ; ORN: notif ien
"RTN","ORB3SPEC",96,0)
 ; ORDFN: pt id
"RTN","ORB3SPEC",97,0)
 ; ORDATA: pkg data
"RTN","ORB3SPEC",98,0)
 ; ORBSMSG: special notif msg rtn by LRALRTS
"RTN","ORB3SPEC",99,0)
 ; ORBMSG: original notif msg
"RTN","ORB3SPEC",100,0)
 ;
"RTN","ORB3SPEC",101,0)
 Q:+$G(ORN)<1
"RTN","ORB3SPEC",102,0)
 Q:+$G(ORDFN)<1
"RTN","ORB3SPEC",103,0)
 Q:+$G(ORDATA)<1
"RTN","ORB3SPEC",104,0)
 N LRID,ORY,I,J,XQAID,XQ0,XQ1,ORNE,RECIP,ORDATAE,LRIDE,STDATE
"RTN","ORB3SPEC",105,0)
 N ORTST,ORBMSGE,ORBMSGX,TXQAID,XQF,ORBHX,ORX,ORBI
"RTN","ORB3SPEC",106,0)
 ;
"RTN","ORB3SPEC",107,0)
 S LRID=$P($P(ORDATA,"|",2),"@")  ;get lab unique results id (OE IDE)
"RTN","ORB3SPEC",108,0)
 Q:+$G(LRID)<1
"RTN","ORB3SPEC",109,0)
 ;
"RTN","ORB3SPEC",110,0)
 ;get pt's alerts within 24 hours:
"RTN","ORB3SPEC",111,0)
 S STDATE=$$FMADD^XLFDT($$NOW^XLFDT,"","-24","","")
"RTN","ORB3SPEC",112,0)
 D PATIENT^XQALERT("ORY",ORDFN,STDATE,"") ;get pt's alerts
"RTN","ORB3SPEC",113,0)
 ;
"RTN","ORB3SPEC",114,0)
 ;look for pt's alerts with same notif ien and unique lab results id:
"RTN","ORB3SPEC",115,0)
 F I=1:1:ORY D
"RTN","ORB3SPEC",116,0)
 .S XQAID=$P(ORY(I),U,2)
"RTN","ORB3SPEC",117,0)
 .S ORBMSGX=$P(ORY(I),U)
"RTN","ORB3SPEC",118,0)
 .S ORNE=$P($P(XQAID,";"),",",3)  ;get notif ien
"RTN","ORB3SPEC",119,0)
 .Q:ORNE'=ORN
"RTN","ORB3SPEC",120,0)
 .;
"RTN","ORB3SPEC",121,0)
 .;find matching alert:
"RTN","ORB3SPEC",122,0)
 .D AHISTORY^XQALBUTL(XQAID,"ORBHX")
"RTN","ORB3SPEC",123,0)
 .S ORDATAE=$G(ORBHX(2))
"RTN","ORB3SPEC",124,0)
 .Q:'$L(ORDATAE)
"RTN","ORB3SPEC",125,0)
 .S LRIDE=$P($P(ORDATAE,"|",2),"@")  ;get lab rslts id from existng alert
"RTN","ORB3SPEC",126,0)
 .Q:LRIDE'=LRID
"RTN","ORB3SPEC",127,0)
 .;
"RTN","ORB3SPEC",128,0)
 .S:ORBMSG["[" ORTST=$P($P(ORBMSG,"[",2),"]")
"RTN","ORB3SPEC",129,0)
 .I ORBMSG'["[" D
"RTN","ORB3SPEC",130,0)
 ..S:ORBMSG["labs: " ORTST=$P(ORBMSG,"labs: ",2)
"RTN","ORB3SPEC",131,0)
 ..S:ORBMSG["results: " ORTST=$P(ORBMSG,"results: ",2)
"RTN","ORB3SPEC",132,0)
 .;
"RTN","ORB3SPEC",133,0)
 .S ORBMSGE=$P(ORBMSGX,"): ",2)
"RTN","ORB3SPEC",134,0)
 .;
"RTN","ORB3SPEC",135,0)
 .S ORX=0
"RTN","ORB3SPEC",136,0)
 .;if alert has recips, get recips from existing alert:
"RTN","ORB3SPEC",137,0)
 .S:$L($G(ORBHX(20,0))) ORX=$P(ORBHX(20,0),U,4)
"RTN","ORB3SPEC",138,0)
 .F ORBI=1:1:ORX D
"RTN","ORB3SPEC",139,0)
 ..S RECIP=+ORBHX(20,ORBI,0)
"RTN","ORB3SPEC",140,0)
 ..S ORBASPEC(RECIP)=""  ;add recip to new alert recip list
"RTN","ORB3SPEC",141,0)
 .;
"RTN","ORB3SPEC",142,0)
 .;delete existing alert:
"RTN","ORB3SPEC",143,0)
 .S XQAKILL=0  ;delete for all recips
"RTN","ORB3SPEC",144,0)
 .D DELETE^XQALERT
"RTN","ORB3SPEC",145,0)
 .K XQAKILL,XQAID
"RTN","ORB3SPEC",146,0)
 ;
"RTN","ORB3SPEC",147,0)
 ;if NO prev alert msg for this pt, notif, lab unique id:
"RTN","ORB3SPEC",148,0)
 I '$L($G(ORBMSGE)) S ORBSMSG=ORBMSG
"RTN","ORB3SPEC",149,0)
 ;
"RTN","ORB3SPEC",150,0)
 ;if prev alert msg for this pt, notif, lab unique id:
"RTN","ORB3SPEC",151,0)
 I $L($G(ORBMSGE)) D
"RTN","ORB3SPEC",152,0)
 .S:ORBMSGE["[" ORBSMSG=$P(ORBMSGE,"]")_", "_ORTST_"]"
"RTN","ORB3SPEC",153,0)
 .S:ORBMSGE'["[" ORBSMSG=ORBMSGE_", "_ORTST
"RTN","ORB3SPEC",154,0)
 ;
"RTN","ORB3SPEC",155,0)
 Q
"RTN","ORB3USER")
0^8^B73357675
"RTN","ORB3USER",1,0)
ORB3USER ; slc/CLA - Alert recipient algorithms for OE/RR 3 notifications; 1/19/00 14:45
"RTN","ORB3USER",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**74,91,105,139**;Dec 17, 1997
"RTN","ORB3USER",3,0)
USER(XQA,ORBDUZ,ORN,ORBU,ORBUI,ORBDFN) ;called from ORB3
"RTN","ORB3USER",4,0)
 ;check to see if potential recip (ORBDUZ) should be an alert recip
"RTN","ORB3USER",5,0)
 ;XQA     array of alert recips passed to Kernel Alert Utility
"RTN","ORB3USER",6,0)
 ;ORBDUZ  duz of current potential alert recipient
"RTN","ORB3USER",7,0)
 ;ORN     notif ien from file 100.9
"RTN","ORB3USER",8,0)
 ;ORBU    array of info for utility displaying recip who and why
"RTN","ORB3USER",9,0)
 ;ORBUI   counter for utility array
"RTN","ORB3USER",10,0)
 ;ORBDFN  patient ien from Patient file [#2]
"RTN","ORB3USER",11,0)
 ;
"RTN","ORB3USER",12,0)
 N ORBNODE,ORBSUR,ORBACT,ORBTM,ORBTMF,ORBTEAM,ORBON,ORBDUP
"RTN","ORB3USER",13,0)
 I $G(ORBDUZ)["G." S XQA(ORBDUZ)="" Q
"RTN","ORB3USER",14,0)
 Q:+$G(ORBDUZ)<.5
"RTN","ORB3USER",15,0)
 ;
"RTN","ORB3USER",16,0)
 S ORBTM=$P(ORBDUZ,U,2) I $L(ORBTM) D  ;if user recip via team
"RTN","ORB3USER",17,0)
 .S ORBTMF=$$GET^XPAR(ORBTM_";OR(100.21,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",18,0)
 .S ORBTEAM=ORBTMF_U_$P(^OR(100.21,ORBTM,0),U)
"RTN","ORB3USER",19,0)
 .I $D(ORBU) D
"RTN","ORB3USER",20,0)
 ..S ORBU(ORBUI)="   User "_$P(^VA(200,+ORBDUZ,0),U)_" is a potential recipient via team "_$P(ORBTEAM,U,2),ORBUI=ORBUI+1
"RTN","ORB3USER",21,0)
 ;
"RTN","ORB3USER",22,0)
 I '$D(ORBU) D
"RTN","ORB3USER",23,0)
 .I $L($G(ORBTMF))=0 D
"RTN","ORB3USER",24,0)
 ..S:$D(^XTMP("ORBUSER",$J,+ORBDUZ)) ORBDUP=1
"RTN","ORB3USER",25,0)
 ..S ^XTMP("ORBUSER",$J,+ORBDUZ)=""
"RTN","ORB3USER",26,0)
 Q:$G(ORBDUP)=1  ;quit if user already processed and no team param value
"RTN","ORB3USER",27,0)
 ;
"RTN","ORB3USER",28,0)
 S ORBDUZ=$P(ORBDUZ,U)
"RTN","ORB3USER",29,0)
 ;
"RTN","ORB3USER",30,0)
 ; determine if user is active (not terminated from system):
"RTN","ORB3USER",31,0)
 S ORBACT=+$$ACTIVE^XUSER(ORBDUZ)
"RTN","ORB3USER",32,0)
 I $D(ORBU),(ORBACT=0) D  ;if user is terminated on system:
"RTN","ORB3USER",33,0)
 .S ORBNODE=$G(^VA(200,ORBDUZ,0)) I $L($G(ORBNODE)) D
"RTN","ORB3USER",34,0)
 ..S ORBU(ORBUI)="   "_$P(ORBNODE,U)_": OFF because",ORBUI=ORBUI+1
"RTN","ORB3USER",35,0)
 ..S ORBU(ORBUI)="     User's system access is terminated.",ORBUI=ORBUI+1
"RTN","ORB3USER",36,0)
 ;
"RTN","ORB3USER",37,0)
 S:$G(ORBTEAM)="" ORBTEAM="^"
"RTN","ORB3USER",38,0)
 S ORBON=$$ONOFF(ORN,ORBDUZ,ORBDFN,ORBTEAM)
"RTN","ORB3USER",39,0)
 I $D(ORBU),(ORBACT=1) D  ;if user is active on system:
"RTN","ORB3USER",40,0)
 .S ORBNODE=$G(^VA(200,ORBDUZ,0)) I $L($G(ORBNODE)) D
"RTN","ORB3USER",41,0)
 ..S ORBU(ORBUI)="   "_$P(ORBNODE,U)_": "_$P(ORBON,U)_" because ",ORBUI=ORBUI+1
"RTN","ORB3USER",42,0)
 ..S ORBU(ORBUI)="     "_$P(ORBON,U,2),ORBUI=ORBUI+1
"RTN","ORB3USER",43,0)
 I $D(ORBU),($P(ORBON,U)="ON"),($G(ORBDUZ)'["G.") D
"RTN","ORB3USER",44,0)
 .S ORBSUR=$$CURRSURO^XQALSURO(ORBDUZ)  ;DBIA 2790 Alert surrogate
"RTN","ORB3USER",45,0)
 .I +$G(ORBSUR)>0,(+$$ACTIVE^XUSER(ORBSUR)=1) D
"RTN","ORB3USER",46,0)
 ..S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" will receive alert for user]",ORBUI=ORBUI+1
"RTN","ORB3USER",47,0)
 .I +$G(ORBSUR)>0,(+$$ACTIVE^XUSER(ORBSUR)=0) D
"RTN","ORB3USER",48,0)
 ..S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" is INACTIVE - neither will receive alert]",ORBUI=ORBUI+1
"RTN","ORB3USER",49,0)
 Q:$P(ORBON,U)="OFF"  ;quit if user is disabled for this notif
"RTN","ORB3USER",50,0)
 Q:$D(ORBU)           ;quit if entered rtn via UTL (do not sent alert)
"RTN","ORB3USER",51,0)
 I ORBACT=1 D  ;if user is active
"RTN","ORB3USER",52,0)
 .D PREALERT(ORBDUZ,ORN,ORBDFN)  ;if user has undel prev alert, delete it
"RTN","ORB3USER",53,0)
 .S XQA(ORBDUZ)=""  ;if user is active, send them the alert
"RTN","ORB3USER",54,0)
 Q
"RTN","ORB3USER",55,0)
 ;
"RTN","ORB3USER",56,0)
PREALERT(ORBDUZ,ORN,ORBDFN) ;if user (ORBDUZ) has an undeleted previous
"RTN","ORB3USER",57,0)
 ;version of this alert (ORN) for patient (ORBDFN), delete it
"RTN","ORB3USER",58,0)
 ;
"RTN","ORB3USER",59,0)
 Q:$P(^ORD(100.9,ORN,0),U,4)'="NOT"  ;quit if not a "NOT" notif/alert
"RTN","ORB3USER",60,0)
 N XQAID,XQAKILL,XQAUSER,ORBDT
"RTN","ORB3USER",61,0)
 S XQAID="OR,"_ORBDFN_","_ORN
"RTN","ORB3USER",62,0)
 I $D(^XTV(8992,"AXQAN",XQAID,ORBDUZ)) D  ;DBIA# 2689
"RTN","ORB3USER",63,0)
 .S ORBDT=0,ORBDT=$O(^XTV(8992,"AXQAN",XQAID,ORBDUZ,ORBDT))
"RTN","ORB3USER",64,0)
 .I $G(ORBDT)>0 D
"RTN","ORB3USER",65,0)
 ..S XQAUSER=ORBDUZ
"RTN","ORB3USER",66,0)
 ..S XQAKILL=1
"RTN","ORB3USER",67,0)
 ..D DELETEA^XQALERT
"RTN","ORB3USER",68,0)
 Q
"RTN","ORB3USER",69,0)
 ;
"RTN","ORB3USER",70,0)
ONOFF(ORN,ORBUSR,ORBPT,ORBTEAM) ;Extrinsic function to check param file
"RTN","ORB3USER",71,0)
 ;determines if user ORBUSR should receive notification ORN for patient
"RTN","ORB3USER",72,0)
 ;patient ORBPT. If ORBUSR was derived via teams, ORBTEAM may be used.
"RTN","ORB3USER",73,0)
 ;ORN      notification ien from file 100.9 (req'd)
"RTN","ORB3USER",74,0)
 ;ORBUSR   user ien from file 200 (req'd)
"RTN","ORB3USER",75,0)
 ;ORBPT    patient ien from file 2 (not req'd)
"RTN","ORB3USER",76,0)
 ;ORBTEAM  processing flag^name for team assoc. w/ORBUSR (not req'd)
"RTN","ORB3USER",77,0)
 N NODE,ORBPTN,ORBNOTN,ORBUSRF,ORBUSRN,ORBLOC,ORBLOCF,ORBLOCN
"RTN","ORB3USER",78,0)
 S (ORBPTN,ORBNOTN,ORBUSRF,ORBUSRN,ORBLOC,ORBLOCF,ORBLOCN)=""
"RTN","ORB3USER",79,0)
 N ORBSRV,ORBSRVF,ORBSRVN,ORBTEA,ORBTEAF,ORBTEAN,ORBTEAD,ORBTEAE
"RTN","ORB3USER",80,0)
 S (ORBSRV,ORBSRVF,ORBSRVN,ORBTEA,ORBTEAF,ORBTEAN,ORBTEAD,ORBTEAE)=""
"RTN","ORB3USER",81,0)
 N ORBCLS,ORBCLSF,ORBCLSN,ORBLST,ORBI
"RTN","ORB3USER",82,0)
 S (ORBCLS,ORBCLSF,ORBCLSN)=""
"RTN","ORB3USER",83,0)
 N ORBDIV,ORBDIVF,ORBDIVN,ORBSYSF,ORBPKGF
"RTN","ORB3USER",84,0)
 S (ORBDIV,ORBDIVF,ORBDIVN,ORBSYSF,ORBPKGF)=""
"RTN","ORB3USER",85,0)
 ;
"RTN","ORB3USER",86,0)
 ;get notification name:
"RTN","ORB3USER",87,0)
 S NODE=$G(^ORD(100.9,ORN,0)) S:$L($G(NODE)) ORBNOTN=$P(NODE,U)
"RTN","ORB3USER",88,0)
 ;
"RTN","ORB3USER",89,0)
 ;get user name:
"RTN","ORB3USER",90,0)
 S NODE=$G(^VA(200,ORBUSR,0)) S:$L($G(NODE)) ORBUSRN=$P(NODE,U)
"RTN","ORB3USER",91,0)
 ;
"RTN","ORB3USER",92,0)
 ;get patient name:
"RTN","ORB3USER",93,0)
 S:$L($G(ORBPT)) NODE=$G(^DPT(ORBPT,0)) S:$L($G(NODE)) ORBPTN=$P(NODE,U)
"RTN","ORB3USER",94,0)
 ;
"RTN","ORB3USER",95,0)
 ;get division flag and name:
"RTN","ORB3USER",96,0)
 S ORBDIV=$$DIVF(ORBUSR,ORN)
"RTN","ORB3USER",97,0)
 I $L(ORBDIV) D
"RTN","ORB3USER",98,0)
 .S ORBDIVF=$P(ORBDIV,U,2),ORBDIV=$P(ORBDIV,U),NODE=$G(^DIC(4,ORBDIV,0))
"RTN","ORB3USER",99,0)
 .S:$L($G(NODE)) ORBDIVN=$P(NODE,U)
"RTN","ORB3USER",100,0)
 ;
"RTN","ORB3USER",101,0)
 ;get system flag:
"RTN","ORB3USER",102,0)
 S ORBSYSF=$$GET^XPAR("SYS","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",103,0)
 ;
"RTN","ORB3USER",104,0)
 ;get OE/RR package-export flag:
"RTN","ORB3USER",105,0)
 S ORBPKGF=$$GET^XPAR("PKG","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",106,0)
 ;
"RTN","ORB3USER",107,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","ORB3USER",108,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","ORB3USER",109,0)
 I +$G(ORBPT)>0 D
"RTN","ORB3USER",110,0)
 .N DFN S DFN=ORBPT,VA200="" D OERR^VADPT
"RTN","ORB3USER",111,0)
 .S ORBLOC=+$G(^DIC(42,+VAIN(4),44)) I +$G(ORBLOC)>0 D
"RTN","ORB3USER",112,0)
 ..S ORBLOCN=$P(^SC(+ORBLOC,0),U)
"RTN","ORB3USER",113,0)
 ..S ORBLOCF=$$GET^XPAR(+$G(ORBLOC)_";SC(","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",114,0)
 K VA200,VAIN
"RTN","ORB3USER",115,0)
 ;
"RTN","ORB3USER",116,0)
 ;get user's service/section flag:
"RTN","ORB3USER",117,0)
 S ORBSRV=$G(^VA(200,ORBUSR,5)) I +ORBSRV>0 S ORBSRV=$P(ORBSRV,U) D
"RTN","ORB3USER",118,0)
 .S NODE=$G(^DIC(49,ORBSRV,0)) S:$L($G(NODE)) ORBSRVN=$P(NODE,U)
"RTN","ORB3USER",119,0)
 .S:+$G(ORBSRV)>0 ORBSRVF=$$GET^XPAR(ORBSRV_";DIC(49,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",120,0)
 ;
"RTN","ORB3USER",121,0)
 ;get user's team flag:
"RTN","ORB3USER",122,0)
 I $L($G(ORBTEAM)) S ORBTEAF=$P(ORBTEAM,U),ORBTEAN=$P(ORBTEAM,U,2)
"RTN","ORB3USER",123,0)
 ;
"RTN","ORB3USER",124,0)
 ;get class flag for the user's most recently active ASU class
"RTN","ORB3USER",125,0)
 ;S ORBCLS=$$RECENT(ORBUSR) I $L($G(ORBCLS))>0 D
"RTN","ORB3USER",126,0)
 ;.S ORBCLSN=$P(ORBCLS,U,2),ORBCLS=$P(ORBCLS,U)
"RTN","ORB3USER",127,0)
 ;.S:+$G(ORBCLS)>0 ORBCLSF=$$GET^XPAR(ORBCLS_";USR(8930,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",128,0)
 ;
"RTN","ORB3USER",129,0)
 ;get user's flag:
"RTN","ORB3USER",130,0)
 S ORBUSRF=$$GET^XPAR(ORBUSR_";VA(200,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",131,0)
 ;
"RTN","ORB3USER",132,0)
 ;determine overall flag:
"RTN","ORB3USER",133,0)
 I $G(ORBUSRF)="M" Q "ON^User "_ORBUSRN_" is Mandatory.^User value is Mandatory"
"RTN","ORB3USER",134,0)
 I $G(ORBUSRF)="E" Q "ON^User "_ORBUSRN_" is Enabled.^User value is Enabled"
"RTN","ORB3USER",135,0)
 ;I $G(ORBCLSF)="M" Q "ON^User's class "_ORBCLSN_" is Mandatory.^User's class "_ORBCLSN_" value is Mandatory"
"RTN","ORB3USER",136,0)
 I $G(ORBTEAF)="M" Q "ON^User's team "_ORBTEAN_" is Mandatory.^User's team "_ORBTEAN_" value is Mandatory"
"RTN","ORB3USER",137,0)
 I $G(ORBTEAF)="D" Q "OFF^User's team "_ORBTEAN_" is Disabled.^User's team "_ORBTEAN_" value is Disabled"
"RTN","ORB3USER",138,0)
 I $G(ORBSRVF)="M" Q "ON^User's service "_ORBSRVN_" is Mandatory.^User's service "_ORBSRVN_" value is Mandatory"
"RTN","ORB3USER",139,0)
 I $G(ORBLOCF)="M" Q "ON^Patient's location "_ORBLOCN_" is Mandatory.^Pt's location "_ORBLOCN_" value is Mandatory"
"RTN","ORB3USER",140,0)
 I $G(ORBLOCF)="D" Q "OFF^Patient's location "_ORBLOCN_" is Disabled.^Pt's location "_ORBLOCN_" value is Disabled"
"RTN","ORB3USER",141,0)
 I $G(ORBDIVF)="M",($G(ORBLOCF)="") Q "ON^Division "_ORBDIVN_" is Mandatory, no Pt Location value.^Division "_ORBDIVN_" value is Mandatory"
"RTN","ORB3USER",142,0)
 I $G(ORBSYSF)="M",($G(ORBDIVF)=""),($G(ORBLOCF)="") Q "ON^System default is Mandatory, no Division or Pt Location values.^System value is Mandatory"
"RTN","ORB3USER",143,0)
 I $G(ORBPKGF)="M",($G(ORBSYSF)=""),($G(ORBDIVF)=""),($G(ORBLOCF)="") Q "ON^OERR default is Mandatory, no Division, System, or Pt Location values.^OERR value is Mandatory"
"RTN","ORB3USER",144,0)
 I $G(ORBUSRF)="D" Q "OFF^User "_ORBUSRN_" is Disabled - no Mandatory values found.^User value is Disabled"
"RTN","ORB3USER",145,0)
 ;I $G(ORBCLSF)="D" Q "OFF^User's class "_ORBCLSN_" is Disabled - no Mandatory values found.^User's class "_ORBCLSN_" value is Disabled""
"RTN","ORB3USER",146,0)
 I $G(ORBTEAF)="E" Q "ON^User's team "_ORBTEAN_" is Enabled.^User's team "_ORBTEAN_" value is Enabled"
"RTN","ORB3USER",147,0)
 I $G(ORBSRVF)="D" Q "OFF^User's service "_ORBSRVN_" is Disabled.^User's service "_ORBSRVN_" value is Disabled"
"RTN","ORB3USER",148,0)
 I $G(ORBSRVF)="E" Q "ON^User's service "_ORBSRVN_" is Enabled.^User's service "_ORBSRVN_" value is Enabled"
"RTN","ORB3USER",149,0)
 I $G(ORBLOCF)="E" Q "ON^Patient's location "_ORBLOCN_" is Enabled.^Pt's location "_ORBLOCN_" value is Enabled"
"RTN","ORB3USER",150,0)
 I $G(ORBDIVF)="D" Q "OFF^Division "_ORBDIVN_" is Disabled.^Division "_ORBDIVN_" value is Disabled"
"RTN","ORB3USER",151,0)
 I $G(ORBDIVF)="E" Q "ON^Division "_ORBDIVN_" is Enabled.^Division "_ORBDIVN_" value is Enabled"
"RTN","ORB3USER",152,0)
 I $G(ORBSYSF)="D" Q "OFF^System default is Disabled.^System value is Disabled"
"RTN","ORB3USER",153,0)
 I $G(ORBSYSF)="E" Q "ON^System default is Enabled.^System value is Enabled"
"RTN","ORB3USER",154,0)
 I $G(ORBPKGF)="D" Q "OFF^OERR default is Disabled.^OERR value is Disabled"
"RTN","ORB3USER",155,0)
 I $G(ORBPKGF)="E" Q "ON^OERR default is Enabled.^OERR value is Enabled"
"RTN","ORB3USER",156,0)
 Q "OFF^No Mandatory, Disabled or Enabled values found.^No Mandatory/Disabled/Enabled values"
"RTN","ORB3USER",157,0)
 ;
"RTN","ORB3USER",158,0)
RECENT(USER) ;ext funct rtns a user's most recent, active user class
"RTN","ORB3USER",159,0)
 Q:+$G(USER)<1 "^Error: User not identified."
"RTN","ORB3USER",160,0)
 N CLS,CLASS,INACT,ACT,ORX,INVDT,RESULT
"RTN","ORB3USER",161,0)
 ;call api to determine user's class(es)
"RTN","ORB3USER",162,0)
 Q:'$L($G(CLS(0))) "^No user classes found."
"RTN","ORB3USER",163,0)
 D NOW^%DTC
"RTN","ORB3USER",164,0)
 S CLASS="" F  S CLASS=$O(CLS(CLASS)) Q:CLASS=""  D
"RTN","ORB3USER",165,0)
 .S INACT=$P(CLS(CLASS),U,5),ACT=$P(CLS(CLASS),U,4)
"RTN","ORB3USER",166,0)
 .I INACT,(INACT<%) Q  ;quit if class has an inactive date before now
"RTN","ORB3USER",167,0)
 .Q:'ACT     ;quit if class has no active date
"RTN","ORB3USER",168,0)
 .S ORX("DT",9999999-ACT)=$P(CLS(CLASS),U)_U_CLASS
"RTN","ORB3USER",169,0)
 S INVDT="",INVDT=$O(ORX("DT",INVDT))
"RTN","ORB3USER",170,0)
 I INVDT S RESULT=ORX("DT",INVDT)
"RTN","ORB3USER",171,0)
 E  S RESULT="^No user classes found."
"RTN","ORB3USER",172,0)
 K %
"RTN","ORB3USER",173,0)
 Q RESULT
"RTN","ORB3USER",174,0)
DIVF(USER,ORN) ;ext funct rtns user's division value for ORB PROCESSING FLAG
"RTN","ORB3USER",175,0)
 N DIV,DIVF,MDIVF,EDIVF,DDIVF
"RTN","ORB3USER",176,0)
 S DIV=0,(DIVF,MDIVF,EDIVF,DDIVF)=""
"RTN","ORB3USER",177,0)
 F  S DIV=$O(^VA(200,USER,2,"B",DIV)) Q:+$G(DIV)<1!(DIVF="M")  D
"RTN","ORB3USER",178,0)
 .S DIVF=$$GET^XPAR(DIV_";DIC(4,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",179,0)
 .I DIVF="M" S MDIVF=DIV_U_DIVF
"RTN","ORB3USER",180,0)
 .I DIVF="E" S EDIVF=DIV_U_DIVF
"RTN","ORB3USER",181,0)
 .I DIVF="D" S DDIVF=DIV_U_DIVF
"RTN","ORB3USER",182,0)
 Q:$L(MDIVF) MDIVF
"RTN","ORB3USER",183,0)
 Q:$L(EDIVF) EDIVF
"RTN","ORB3USER",184,0)
 Q:$L(DDIVF) DDIVF
"RTN","ORB3USER",185,0)
 Q ""
"RTN","ORQPTQ1")
0^5^B54400639
"RTN","ORQPTQ1",1,0)
ORQPTQ1 ; SLC/CLA - Functs which return OR patient lists and sources pt 1 ;12/15/97 [ 04/02/97  3:32 PM ] [6/6/01 11:34am]
"RTN","ORQPTQ1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,74,63,91,85,139**;Dec 17, 1997
"RTN","ORQPTQ1",3,0)
VAMCPTS(Y) ; RETURN LIST OF PATIENTS IN VAMC: DFN^NAME
"RTN","ORQPTQ1",4,0)
 N I,J,V
"RTN","ORQPTQ1",5,0)
 S I=1
"RTN","ORQPTQ1",6,0)
 S J=0 F  S J=$O(^DPT("B",J)) Q:J=""  S V=0,V=$O(^DPT("B",J,V))  S Y(I)=V_"^"_J,I=I+1
"RTN","ORQPTQ1",7,0)
 Q
"RTN","ORQPTQ1",8,0)
VAMCLONG(Y,DIR,FROM) ; return a bolus of patients in VAMC: DFN^NAME
"RTN","ORQPTQ1",9,0)
 N I,IEN,CNT S CNT=44
"RTN","ORQPTQ1",10,0)
 I DIR=0 D  ; Forward direction
"RTN","ORQPTQ1",11,0)
 . F I=1:1:CNT S FROM=$O(^DPT("B",FROM)) Q:FROM=""  D
"RTN","ORQPTQ1",12,0)
 . . S Y(I)=$O(^DPT("B",FROM,0))_"^"_FROM
"RTN","ORQPTQ1",13,0)
 . I +$G(Y(CNT))="" S Y(I)=""
"RTN","ORQPTQ1",14,0)
 I DIR=1 D  ; Reverse direction
"RTN","ORQPTQ1",15,0)
 . F I=1:1:CNT S FROM=$O(^DPT("B",FROM),-1) Q:FROM=""  D
"RTN","ORQPTQ1",16,0)
 . . S Y(I)=$O(^DPT("B",FROM,0))_"^"_FROM
"RTN","ORQPTQ1",17,0)
 Q 
"RTN","ORQPTQ1",18,0)
DEFTM(ORY) ; return current user's default team list
"RTN","ORQPTQ1",19,0)
 Q:'$D(DUZ)
"RTN","ORQPTQ1",20,0)
 N ORSRV S ORSRV=$G(^VA(200,DUZ,5)) I +ORSRV>0 S ORSRV=$P(ORSRV,U)
"RTN","ORQPTQ1",21,0)
 S ORY=$$GET^XPAR("USR^SRV.`"_+$G(ORSRV),"ORLP DEFAULT TEAM",1,"B")
"RTN","ORQPTQ1",22,0)
 Q
"RTN","ORQPTQ1",23,0)
TEAMS(ORY) ; return list of teams for a system
"RTN","ORQPTQ1",24,0)
 ; Also called under DBIA # 2692.
"RTN","ORQPTQ1",25,0)
 N ORTM,I,ORTMN
"RTN","ORQPTQ1",26,0)
 S ORTMN="",I=1
"RTN","ORQPTQ1",27,0)
 F  S ORTMN=$O(^OR(100.21,"B",ORTMN)) Q:ORTMN=""  D
"RTN","ORQPTQ1",28,0)
 .S ORTM="",ORTM=$O(^OR(100.21,"B",ORTMN,ORTM)) Q:ORTM=""
"RTN","ORQPTQ1",29,0)
 .S ORY(I)=ORTM_U_ORTMN,I=I+1
"RTN","ORQPTQ1",30,0)
 S:+$G(ORY(1))<1 ORY(1)="^No teams found."
"RTN","ORQPTQ1",31,0)
 Q
"RTN","ORQPTQ1",32,0)
TEAMPTS(ORY,TEAM,TMPFLAG) ; RETURN LIST OF PATIENTS IN A TEAM
"RTN","ORQPTQ1",33,0)
 ; Also called under DBIA # 2692.
"RTN","ORQPTQ1",34,0)
 ; If TMPFLAG passed and = TRUE, code expects a "^TMP(xxx"
"RTN","ORQPTQ1",35,0)
 ;    global root string passed in ORY, and builds the returned 
"RTN","ORQPTQ1",36,0)
 ;    list in that global instead of to a memory array.
"RTN","ORQPTQ1",37,0)
 N DOTMP,NEWTMP
"RTN","ORQPTQ1",38,0)
 S DOTMP=0
"RTN","ORQPTQ1",39,0)
 I $G(TMPFLAG) D             ; Was value passed?
"RTN","ORQPTQ1",40,0)
 .I TMPFLAG S DOTMP=1        ; Is value TRUE?
"RTN","ORQPTQ1",41,0)
 I +$G(TEAM)<1 D
"RTN","ORQPTQ1",42,0)
 .I DOTMP S NEWTMP=ORY_1_")",@NEWTMP="^No team identified" Q
"RTN","ORQPTQ1",43,0)
 .I 'DOTMP S ORY(1)="^No team identified" Q
"RTN","ORQPTQ1",44,0)
 N ORI,ORPT,I
"RTN","ORQPTQ1",45,0)
 S I=0
"RTN","ORQPTQ1",46,0)
 S ORI=0 F  S ORI=$O(^OR(100.21,+TEAM,10,ORI)) Q:ORI<1  D
"RTN","ORQPTQ1",47,0)
 .S ORPT=^OR(100.21,+TEAM,10,ORI,0)
"RTN","ORQPTQ1",48,0)
 .I DOTMP D
"RTN","ORQPTQ1",49,0)
 ..S I=I+1,NEWTMP=ORY_+I_")"
"RTN","ORQPTQ1",50,0)
 ..S @NEWTMP=+ORPT_U_$P(^DPT(+ORPT,0),U)
"RTN","ORQPTQ1",51,0)
 .I 'DOTMP S I=I+1,ORY(I)=+ORPT_U_$P(^DPT(+ORPT,0),U)
"RTN","ORQPTQ1",52,0)
 I DOTMP S:I<1 NEWTMP=ORY_1_")",@NEWTMP="^No patients found."
"RTN","ORQPTQ1",53,0)
 I 'DOTMP S:I<1 ORY(1)="^No patients found."
"RTN","ORQPTQ1",54,0)
 Q
"RTN","ORQPTQ1",55,0)
TEAMPR(ORY,PROV) ; return list of teams linked to a provider
"RTN","ORQPTQ1",56,0)
 I +$G(PROV)<1 S ORY(1)="^No provider identified" Q 
"RTN","ORQPTQ1",57,0)
 N ORTM,I,ORTMN
"RTN","ORQPTQ1",58,0)
 S ORTM="",I=1
"RTN","ORQPTQ1",59,0)
 F  S ORTM=$O(^OR(100.21,"C",+PROV,ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",60,0)
 .S ORTMN=$P(^OR(100.21,ORTM,0),U)
"RTN","ORQPTQ1",61,0)
 .S ORY(I)=ORTM_U_ORTMN,I=I+1
"RTN","ORQPTQ1",62,0)
 S:+$G(ORY(1))<1 ORY(1)="^No teams found."
"RTN","ORQPTQ1",63,0)
 Q
"RTN","ORQPTQ1",64,0)
TEAMPR2(ORY,PROV) ; return list of teams linked to a provider
"RTN","ORQPTQ1",65,0)
 ; This tag added by PKS/slc - 8/1999.
"RTN","ORQPTQ1",66,0)
 I +$G(PROV)<1 S ORY(1)="^No provider identified" Q
"RTN","ORQPTQ1",67,0)
 N ORTM,ORDATA,ORTMN,ORTYPE,I
"RTN","ORQPTQ1",68,0)
 S ORTM="",I=1
"RTN","ORQPTQ1",69,0)
 F  S ORTM=$O(^OR(100.21,"C",+PROV,ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",70,0)
 .S ORDATA=^OR(100.21,ORTM,0) ; Get value.
"RTN","ORQPTQ1",71,0)
 .S ORTMN=$P(ORDATA,U)        ; Team List name.
"RTN","ORQPTQ1",72,0)
 .S ORTYPE=$P(ORDATA,U,2)     ; Team List type.
"RTN","ORQPTQ1",73,0)
 .S ORY(I)=ORTM_U_ORTMN_U_ORTYPE,I=I+1
"RTN","ORQPTQ1",74,0)
 S:+$G(ORY(1))<1 ORY(1)="^No teams found."
"RTN","ORQPTQ1",75,0)
 Q
"RTN","ORQPTQ1",76,0)
TEAMPROV(ORY,TEAM) ; return list of providers linked to a team
"RTN","ORQPTQ1",77,0)
 I +$G(TEAM)<1 S ORY(1)="^No team identified"
"RTN","ORQPTQ1",78,0)
 N PROV,I,SEQ
"RTN","ORQPTQ1",79,0)
 S I=1
"RTN","ORQPTQ1",80,0)
 S SEQ=0 F  S SEQ=$O(^OR(100.21,+TEAM,1,SEQ)) Q:SEQ<1  D
"RTN","ORQPTQ1",81,0)
 .S PROV=^OR(100.21,+TEAM,1,SEQ,0) I $L(PROV) D
"RTN","ORQPTQ1",82,0)
 ..S ORY(I)=+PROV_U_$P(^VA(200,+PROV,0),U),I=I+1
"RTN","ORQPTQ1",83,0)
 S:+$G(ORY(1))<1 ORY(1)="^No providers found."
"RTN","ORQPTQ1",84,0)
 Q
"RTN","ORQPTQ1",85,0)
TPROVPT(PROV) ;return list of patients linked to a provider via teams
"RTN","ORQPTQ1",86,0)
 ; Modified by PKS: 8/1999.
"RTN","ORQPTQ1",87,0)
 I +$G(PROV)<1 S ^TMP("ORLPUPT",$J,"^No provider identified")=""
"RTN","ORQPTQ1",88,0)
 N ORTM,ORTMN,ORI,ORPT
"RTN","ORQPTQ1",89,0)
 S ORTM=""
"RTN","ORQPTQ1",90,0)
 F  S ORTM=$O(^OR(100.21,"C",+PROV,ORTM)) Q:+$G(ORTM)<1  D  ; Teams.
"RTN","ORQPTQ1",91,0)
 .S ORTMN=$P(^OR(100.21,+ORTM,0),U,1) ; Get name of Team List.
"RTN","ORQPTQ1",92,0)
 .S ORI=0 F  S ORI=$O(^OR(100.21,+ORTM,10,ORI)) Q:ORI<1  D
"RTN","ORQPTQ1",93,0)
 ..S ORPT=^OR(100.21,+ORTM,10,ORI,0)
"RTN","ORQPTQ1",94,0)
 ..S ^TMP("ORLPUPT",$J,+ORPT_U_$P(^DPT(+ORPT,0),U))=""
"RTN","ORQPTQ1",95,0)
 ..; Next line added by PKS:
"RTN","ORQPTQ1",96,0)
 ..S ^TMP("ORLPUPT",$J,"B",ORTMN,$P(^DPT(+ORPT,0),U)_U_+ORPT)=""
"RTN","ORQPTQ1",97,0)
 I '$D(^TMP("ORLPUPT",$J)) S ^TMP("ORLPUPT",$J,"^No patients found.")=""
"RTN","ORQPTQ1",98,0)
 Q
"RTN","ORQPTQ1",99,0)
TMSPT(ORY,PT) ;return list of teams linked to a patient (patient is active)
"RTN","ORQPTQ1",100,0)
 I +$G(PT)<1 S ORY(1)="^No patient identified" Q
"RTN","ORQPTQ1",101,0)
 N ORTM,I,ORTMN,ORTMTYP
"RTN","ORQPTQ1",102,0)
 S ORTM="",I=1
"RTN","ORQPTQ1",103,0)
 F  S ORTM=$O(^OR(100.21,"AB",+PT_";DPT(",ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",104,0)
 .S ORTMN=$P(^OR(100.21,ORTM,0),U)
"RTN","ORQPTQ1",105,0)
 .S ORTMTYP=$P(^OR(100.21,ORTM,0),U,2) I $L(ORTMTYP) D
"RTN","ORQPTQ1",106,0)
 ..S ORTMTYP=$$EXTERNAL^DILFD(100.21,1,"",ORTMTYP,"")
"RTN","ORQPTQ1",107,0)
 .S ORY(I)=ORTM_U_ORTMN_U_$S($L(ORTMTYP):ORTMTYP,1:"no type"),I=I+1
"RTN","ORQPTQ1",108,0)
 S:+$G(ORY(1))<1 ORY(1)="^No teams found."
"RTN","ORQPTQ1",109,0)
 Q
"RTN","ORQPTQ1",110,0)
TPTPR(ORY,PT) ;return list of providers linked to a patient via teams
"RTN","ORQPTQ1",111,0)
 I +$G(PT)<1 S ORY(1)="^No patient identified" Q
"RTN","ORQPTQ1",112,0)
 N ORTM,PROV,SEQ
"RTN","ORQPTQ1",113,0)
 S ORTM=""
"RTN","ORQPTQ1",114,0)
 F  S ORTM=$O(^OR(100.21,"AB",+PT_";DPT(",ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",115,0)
 .S SEQ=0 F  S SEQ=$O(^OR(100.21,+ORTM,1,SEQ)) Q:SEQ<1  D
"RTN","ORQPTQ1",116,0)
 ..S PROV=^OR(100.21,+ORTM,1,SEQ,0) I $L(PROV) D
"RTN","ORQPTQ1",117,0)
 ...S ORY(+PROV)=+PROV_U_$P(^VA(200,+PROV,0),U)
"RTN","ORQPTQ1",118,0)
 S:'$D(ORY) ORY(1)="^No providers found."
"RTN","ORQPTQ1",119,0)
 Q
"RTN","ORQPTQ1",120,0)
PERSPR(ORY) ; return list of personal lists linked to current user
"RTN","ORQPTQ1",121,0)
 N ORTM,I,ORTMN
"RTN","ORQPTQ1",122,0)
 S ORTM="",I=1
"RTN","ORQPTQ1",123,0)
 F  S ORTM=$O(^OR(100.21,"C",DUZ,ORTM)) Q:+$G(ORTM)<1  D
"RTN","ORQPTQ1",124,0)
 .Q:$P(^OR(100.21,ORTM,0),U,2)'="P"  ;quit if not a personal list
"RTN","ORQPTQ1",125,0)
 .S ORTMN=$P(^OR(100.21,ORTM,0),U)
"RTN","ORQPTQ1",126,0)
 .S ORY(I)=ORTM_U_ORTMN,I=I+1
"RTN","ORQPTQ1",127,0)
 S:+$G(ORY(1))<1 ORY(1)="^No personal lists found."
"RTN","ORQPTQ1",128,0)
 Q
"RTN","ORQPTQ1",129,0)
PRIMPT(ORY,ORPT) ; return patient's PCMM primary care team
"RTN","ORQPTQ1",130,0)
 I +$G(ORPT)<1 S ORY(1)="^No patient identified"
"RTN","ORQPTQ1",131,0)
 N ORQPUR,ORQERROR,ORQLST,ORQERR,ORQDT,ORIDT,ORADT,ORX
"RTN","ORQPTQ1",132,0)
 S ORQPUR(2)=""  ;"2" is the ien for purpose "primary care" [^SD(403.47]
"RTN","ORQPTQ1",133,0)
 D NOW^%DTC S ORQDT("BEGIN")=%-.0001,ORQDT("END")=%+.0001,ORQDT("INCL")=0
"RTN","ORQPTQ1",134,0)
 S ORQERROR=$$TMPT^SCAPMC(.ORPT,"ORQDT","ORQPUR","ORQLST","ORQERR")
"RTN","ORQPTQ1",135,0)
 I ORQERROR=0 S ORY="^Error in search for primary care team."
"RTN","ORQPTQ1",136,0)
 I +$G(ORQLST(1))>0 D
"RTN","ORQPTQ1",137,0)
 .S ORX=ORQLST(1),ORADT=$P(ORX,U,4),ORIDT=$P(ORX,U,5)
"RTN","ORQPTQ1",138,0)
 .I ($G(ORADT)>$G(ORIDT)) S ORY=$P(ORX,U)_U_$P(ORX,U,2)
"RTN","ORQPTQ1",139,0)
 S:+$G(ORY)<1 ORY="^No primary care team found."
"RTN","ORQPTQ1",140,0)
 K %
"RTN","ORQPTQ1",141,0)
 Q
"RTN","ORQPTQ1",142,0)
PROVPT(ORY,ORPT) ; return PCMM primary provider for a patient
"RTN","ORQPTQ1",143,0)
 I +$G(ORPT)<1 S ORY(1)="^No patient identified"
"RTN","ORQPTQ1",144,0)
 S ORY(1)=$$OUTPTPR^SDUTL3(ORPT,$$NOW^XLFDT,1)
"RTN","ORQPTQ1",145,0)
 Q
"RTN","ORQPTQ1",146,0)
PPLINK(ORPROV,ORPT) ; returns '1' if patient is linked to provider
"RTN","ORQPTQ1",147,0)
 N ORX,ORPP
"RTN","ORQPTQ1",148,0)
 S ORX="",ORPP=0
"RTN","ORQPTQ1",149,0)
 I (+$G(ORPT)<1)!(+$G(ORPROV)<1) Q 0
"RTN","ORQPTQ1",150,0)
 I $D(^DPT("APR",ORPROV,ORPT)) Q "1^PRIM"  ;provider is patient's primary
"RTN","ORQPTQ1",151,0)
 I $D(^DPT("AAP",ORPROV,ORPT)) Q "1^ATTD"  ;provider is patient's attending
"RTN","ORQPTQ1",152,0)
 ;is provider and patient on the same team:
"RTN","ORQPTQ1",153,0)
 D TPROVPT(ORPROV)
"RTN","ORQPTQ1",154,0)
 F  S ORX=$O(^TMP("ORLPUPT",$J,ORX)) Q:ORX=""  D
"RTN","ORQPTQ1",155,0)
 .I +ORX=ORPT S ORPP="1^OERRTM" Q
"RTN","ORQPTQ1",156,0)
 K ^TMP("ORLPUPT",$J)
"RTN","ORQPTQ1",157,0)
 ;
"RTN","ORQPTQ1",158,0)
 ;If not linked already, see if linked via PCMM:
"RTN","ORQPTQ1",159,0)
 I ORPP=0 S ORPP=$$PCMMLINK(ORPROV,ORPT)
"RTN","ORQPTQ1",160,0)
 ;
"RTN","ORQPTQ1",161,0)
 Q ORPP
"RTN","ORQPTQ1",162,0)
PDLINK(ORDEV,ORPT) ; returns '1' if patient is linked to device via team
"RTN","ORQPTQ1",163,0)
 ;ORDEV can be either ien or device name
"RTN","ORQPTQ1",164,0)
 N ORY,ORX,ORTM,ORDP,ORTMDEV,ORDEVIEN
"RTN","ORQPTQ1",165,0)
 S ORDP=0
"RTN","ORQPTQ1",166,0)
 I (+$G(ORPT)<1)!($L($G(ORDEV))<1) Q 0
"RTN","ORQPTQ1",167,0)
 ; Are device and patient on the same team?:
"RTN","ORQPTQ1",168,0)
 I '$D(^%ZIS(1,ORDEV,0)) D  ;ORDEV is not an ien
"RTN","ORQPTQ1",169,0)
 .S ORDEVIEN=0,ORDEVIEN=$O(^%ZIS(1,"B",$P(ORDEV,U),ORDEVIEN))
"RTN","ORQPTQ1",170,0)
 .S ORDEV=ORDEVIEN
"RTN","ORQPTQ1",171,0)
 Q:+$G(ORDEV)<1 0
"RTN","ORQPTQ1",172,0)
 D TMSPT(.ORY,ORPT)
"RTN","ORQPTQ1",173,0)
 S ORX="" F  S ORX=$O(ORY(ORX)) Q:ORX=""  D
"RTN","ORQPTQ1",174,0)
 .S ORTM=ORY(ORX)
"RTN","ORQPTQ1",175,0)
 .I $D(^OR(100.21,+ORTM,0)),$P(^(0),U,4)=ORDEV S ORDP=1 Q
"RTN","ORQPTQ1",176,0)
 Q ORDP
"RTN","ORQPTQ1",177,0)
PCMMLINK(ORPROV,ORPT) ;returns '1' if patient is linked to provider via PCMM
"RTN","ORQPTQ1",178,0)
 N ORPP,ORPCMM,ORPCP
"RTN","ORQPTQ1",179,0)
 S ORPP=0
"RTN","ORQPTQ1",180,0)
 I (+$G(ORPT)<1)!(+$G(ORPROV)<1) Q 0
"RTN","ORQPTQ1",181,0)
 ;
"RTN","ORQPTQ1",182,0)
 ;provider is patient's PCMM primary care practitioner:
"RTN","ORQPTQ1",183,0)
 I ORPROV=+$$OUTPTPR^SDUTL3(ORPT,$$NOW^XLFDT,1) Q "1^PCP"   ;DBIA #1252
"RTN","ORQPTQ1",184,0)
 ;
"RTN","ORQPTQ1",185,0)
 ;provider is patient's PCMM associate provider:
"RTN","ORQPTQ1",186,0)
 I ORPROV=+$$OUTPTAP^SDUTL3(ORPT,$$NOW^XLFDT) Q "1^AP"      ;DBIA #1252
"RTN","ORQPTQ1",187,0)
 ;
"RTN","ORQPTQ1",188,0)
 ;provider is linked to patient via PCMM team position assignment:
"RTN","ORQPTQ1",189,0)
 S ORPCMM=$$PRPT^SCAPMC(ORPT,,,,,,"^TMP(""ORPCMMLK"",$J)",)  ;DBIA #1916
"RTN","ORQPTQ1",190,0)
 S ORPCP=0
"RTN","ORQPTQ1",191,0)
 F  S ORPCP=$O(^TMP("ORPCMMLK",$J,"SCPR",ORPCP)) Q:'ORPCP!ORPP=1  D
"RTN","ORQPTQ1",192,0)
 .I ORPROV=ORPCP S ORPP="1^PCMMTM"
"RTN","ORQPTQ1",193,0)
 K ^TMP("ORPCMMLK",$J)
"RTN","ORQPTQ1",194,0)
 ;
"RTN","ORQPTQ1",195,0)
 Q ORPP
"RTN","ORQPTQ1",196,0)
PUNSIGN(ORY,ORBDFN) ;rtns array of providers with unsigned orders for pt
"RTN","ORQPTQ1",197,0)
 N ORDG,ORX,ORZ,ORDNUM
"RTN","ORQPTQ1",198,0)
 S ORDG=$$DG^ORQOR1("ALL")  ;get Display Group ien
"RTN","ORQPTQ1",199,0)
 K ^TMP("ORR",$J)
"RTN","ORQPTQ1",200,0)
 ;get unsigned orders:
"RTN","ORQPTQ1",201,0)
 D EN^ORQ1(ORBDFN_";DPT(",ORDG,11,"","","",0,0)
"RTN","ORQPTQ1",202,0)
 S ORX="",ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""
"RTN","ORQPTQ1",203,0)
 I +$G(^TMP("ORR",$J,ORX,"TOT"))>0 D
"RTN","ORQPTQ1",204,0)
 .S ORX="" F  S ORX=$O(^TMP("ORR",$J,ORX)) Q:ORX=""  D
"RTN","ORQPTQ1",205,0)
 ..S ORZ="" F  S ORZ=$O(^TMP("ORR",$J,ORX,ORZ)) Q:+$G(ORZ)<1  D
"RTN","ORQPTQ1",206,0)
 ...S ORDNUM=^TMP("ORR",$J,ORX,ORZ)
"RTN","ORQPTQ1",207,0)
 ...S ORY(+$$UNSIGNOR^ORQOR2(+ORDNUM))=""
"RTN","ORQPTQ1",208,0)
 K ^TMP("ORR",$J)
"RTN","ORQPTQ1",209,0)
 Q
"RTN","ORY139")
0^9^B39723853
"RTN","ORY139",1,0)
ORY139 ; slc/CLA - Export Package Level Parameters ; Apr 08, 2002@16:33:25
"RTN","ORY139",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**139**;Dec 17, 1997
"RTN","ORY139",3,0)
MAIN ; main (initial) parameter transport routine
"RTN","ORY139",4,0)
 K ^TMP($J,"XPARRSTR")
"RTN","ORY139",5,0)
 N ENT,IDX,ROOT,REF,VAL,I
"RTN","ORY139",6,0)
 S ROOT=$NAME(^TMP($J,"XPARRSTR")),ROOT=$E(ROOT,1,$L(ROOT)-1)_","
"RTN","ORY139",7,0)
 D LOAD
"RTN","ORY139",8,0)
XX2 S IDX=0,ENT="PKG."_"ORDER ENTRY/RESULTS REPORTING"
"RTN","ORY139",9,0)
 F  S IDX=$O(^TMP($J,"XPARRSTR",IDX)) Q:'IDX  D
"RTN","ORY139",10,0)
 . N PAR,INST,VAL,ERR
"RTN","ORY139",11,0)
 . S PAR=$P(^TMP($J,"XPARRSTR",IDX,"KEY"),U),INST=$P(^("KEY"),U,2)
"RTN","ORY139",12,0)
 . M VAL=^TMP($J,"XPARRSTR",IDX,"VAL")
"RTN","ORY139",13,0)
 . D EN^XPAR(ENT,PAR,INST,.VAL,.ERR)
"RTN","ORY139",14,0)
 K ^TMP($J,"XPARRSTR")
"RTN","ORY139",15,0)
 W !!,"Cleaning up ^XTMP(ORBDUP..."
"RTN","ORY139",16,0)
 D DUPCLN^ORB31($$NOW^XLFDT)
"RTN","ORY139",17,0)
 Q
"RTN","ORY139",18,0)
LOAD ; load data into ^TMP (expects ROOT to be defined)
"RTN","ORY139",19,0)
 S I=1 F  S REF=$T(DATA+I) Q:REF=""  S VAL=$T(DATA+I+1) D
"RTN","ORY139",20,0)
 . S I=I+2,REF=$P(REF,";",3,999),VAL=$P(VAL,";",3,999)
"RTN","ORY139",21,0)
 . S @(ROOT_REF)=VAL
"RTN","ORY139",22,0)
 Q
"RTN","ORY139",23,0)
DATA ; parameter data
"RTN","ORY139",24,0)
 ;;9819,"KEY")
"RTN","ORY139",25,0)
 ;;ORB FORWARD BACKUP REVIEWER^LAB RESULTS
"RTN","ORY139",26,0)
 ;;9819,"VAL")
"RTN","ORY139",27,0)
 ;;0
"RTN","ORY139",28,0)
 ;;9820,"KEY")
"RTN","ORY139",29,0)
 ;;ORB FORWARD BACKUP REVIEWER^ORDER REQUIRES CHART SIGNATURE
"RTN","ORY139",30,0)
 ;;9820,"VAL")
"RTN","ORY139",31,0)
 ;;0
"RTN","ORY139",32,0)
 ;;9821,"KEY")
"RTN","ORY139",33,0)
 ;;ORB FORWARD BACKUP REVIEWER^FLAG ORDER FOR CLARIFICATION
"RTN","ORY139",34,0)
 ;;9821,"VAL")
"RTN","ORY139",35,0)
 ;;0
"RTN","ORY139",36,0)
 ;;9822,"KEY")
"RTN","ORY139",37,0)
 ;;ORB FORWARD BACKUP REVIEWER^ORDER REQUIRES ELEC SIGNATURE
"RTN","ORY139",38,0)
 ;;9822,"VAL")
"RTN","ORY139",39,0)
 ;;0
"RTN","ORY139",40,0)
 ;;9823,"KEY")
"RTN","ORY139",41,0)
 ;;ORB FORWARD BACKUP REVIEWER^ABNORMAL LAB RESULTS (ACTION)
"RTN","ORY139",42,0)
 ;;9823,"VAL")
"RTN","ORY139",43,0)
 ;;0
"RTN","ORY139",44,0)
 ;;9824,"KEY")
"RTN","ORY139",45,0)
 ;;ORB FORWARD BACKUP REVIEWER^ADMISSION
"RTN","ORY139",46,0)
 ;;9824,"VAL")
"RTN","ORY139",47,0)
 ;;0
"RTN","ORY139",48,0)
 ;;9825,"KEY")
"RTN","ORY139",49,0)
 ;;ORB FORWARD BACKUP REVIEWER^UNSCHEDULED VISIT
"RTN","ORY139",50,0)
 ;;9825,"VAL")
"RTN","ORY139",51,0)
 ;;0
"RTN","ORY139",52,0)
 ;;9826,"KEY")
"RTN","ORY139",53,0)
 ;;ORB FORWARD BACKUP REVIEWER^DECEASED PATIENT
"RTN","ORY139",54,0)
 ;;9826,"VAL")
"RTN","ORY139",55,0)
 ;;0
"RTN","ORY139",56,0)
 ;;9827,"KEY")
"RTN","ORY139",57,0)
 ;;ORB FORWARD BACKUP REVIEWER^IMAGING PATIENT EXAMINED
"RTN","ORY139",58,0)
 ;;9827,"VAL")
"RTN","ORY139",59,0)
 ;;0
"RTN","ORY139",60,0)
 ;;9828,"KEY")
"RTN","ORY139",61,0)
 ;;ORB FORWARD BACKUP REVIEWER^IMAGING RESULTS
"RTN","ORY139",62,0)
 ;;9828,"VAL")
"RTN","ORY139",63,0)
 ;;0
"RTN","ORY139",64,0)
 ;;9829,"KEY")
"RTN","ORY139",65,0)
 ;;ORB FORWARD BACKUP REVIEWER^CONSULT/REQUEST RESOLUTION
"RTN","ORY139",66,0)
 ;;9829,"VAL")
"RTN","ORY139",67,0)
 ;;0
"RTN","ORY139",68,0)
 ;;9830,"KEY")
"RTN","ORY139",69,0)
 ;;ORB FORWARD BACKUP REVIEWER^CRITICAL LAB RESULT (INFO)
"RTN","ORY139",70,0)
 ;;9830,"VAL")
"RTN","ORY139",71,0)
 ;;0
"RTN","ORY139",72,0)
 ;;9831,"KEY")
"RTN","ORY139",73,0)
 ;;ORB FORWARD BACKUP REVIEWER^ABNORMAL IMAGING RESULTS
"RTN","ORY139",74,0)
 ;;9831,"VAL")
"RTN","ORY139",75,0)
 ;;0
"RTN","ORY139",76,0)
 ;;9832,"KEY")
"RTN","ORY139",77,0)
 ;;ORB FORWARD BACKUP REVIEWER^IMAGING REQUEST CANCEL/HELD
"RTN","ORY139",78,0)
 ;;9832,"VAL")
"RTN","ORY139",79,0)
 ;;0
"RTN","ORY139",80,0)
 ;;9833,"KEY")
"RTN","ORY139",81,0)
 ;;ORB FORWARD BACKUP REVIEWER^NEW SERVICE CONSULT/REQUEST
"RTN","ORY139",82,0)
 ;;9833,"VAL")
"RTN","ORY139",83,0)
 ;;0
"RTN","ORY139",84,0)
 ;;9834,"KEY")
"RTN","ORY139",85,0)
 ;;ORB FORWARD BACKUP REVIEWER^SERVICE ORDER REQ CHART SIGN
"RTN","ORY139",86,0)
 ;;9834,"VAL")
"RTN","ORY139",87,0)
 ;;0
"RTN","ORY139",88,0)
 ;;9835,"KEY")
"RTN","ORY139",89,0)
 ;;ORB FORWARD BACKUP REVIEWER^CONSULT/REQUEST CANCEL/HOLD
"RTN","ORY139",90,0)
 ;;9835,"VAL")
"RTN","ORY139",91,0)
 ;;0
"RTN","ORY139",92,0)
 ;;9836,"KEY")
"RTN","ORY139",93,0)
 ;;ORB FORWARD BACKUP REVIEWER^NPO DIET MORE THAN 72 HRS
"RTN","ORY139",94,0)
 ;;9836,"VAL")
"RTN","ORY139",95,0)
 ;;0
"RTN","ORY139",96,0)
 ;;9837,"KEY")
"RTN","ORY139",97,0)
 ;;ORB FORWARD BACKUP REVIEWER^FLAGGED OI RESULTS - INPT
"RTN","ORY139",98,0)
 ;;9837,"VAL")
"RTN","ORY139",99,0)
 ;;0
"RTN","ORY139",100,0)
 ;;9838,"KEY")
"RTN","ORY139",101,0)
 ;;ORB FORWARD BACKUP REVIEWER^ORDERER-FLAGGED RESULTS
"RTN","ORY139",102,0)
 ;;9838,"VAL")
"RTN","ORY139",103,0)
 ;;0
"RTN","ORY139",104,0)
 ;;9839,"KEY")
"RTN","ORY139",105,0)
 ;;ORB FORWARD BACKUP REVIEWER^DISCHARGE
"RTN","ORY139",106,0)
 ;;9839,"VAL")
"RTN","ORY139",107,0)
 ;;0
"RTN","ORY139",108,0)
 ;;9840,"KEY")
"RTN","ORY139",109,0)
 ;;ORB FORWARD BACKUP REVIEWER^TRANSFER FROM PSYCHIATRY
"RTN","ORY139",110,0)
 ;;9840,"VAL")
"RTN","ORY139",111,0)
 ;;0
"RTN","ORY139",112,0)
 ;;9841,"KEY")
"RTN","ORY139",113,0)
 ;;ORB FORWARD BACKUP REVIEWER^ORDER REQUIRES CO-SIGNATURE
"RTN","ORY139",114,0)
 ;;9841,"VAL")
"RTN","ORY139",115,0)
 ;;0
"RTN","ORY139",116,0)
 ;;9842,"KEY")
"RTN","ORY139",117,0)
 ;;ORB FORWARD BACKUP REVIEWER^FLAGGED OI ORDER - INPT
"RTN","ORY139",118,0)
 ;;9842,"VAL")
"RTN","ORY139",119,0)
 ;;0
"RTN","ORY139",120,0)
 ;;9843,"KEY")
"RTN","ORY139",121,0)
 ;;ORB FORWARD BACKUP REVIEWER^LAB ORDER CANCELED
"RTN","ORY139",122,0)
 ;;9843,"VAL")
"RTN","ORY139",123,0)
 ;;0
"RTN","ORY139",124,0)
 ;;9844,"KEY")
"RTN","ORY139",125,0)
 ;;ORB FORWARD BACKUP REVIEWER^STAT ORDER
"RTN","ORY139",126,0)
 ;;9844,"VAL")
"RTN","ORY139",127,0)
 ;;0
"RTN","ORY139",128,0)
 ;;9845,"KEY")
"RTN","ORY139",129,0)
 ;;ORB FORWARD BACKUP REVIEWER^STAT RESULTS
"RTN","ORY139",130,0)
 ;;9845,"VAL")
"RTN","ORY139",131,0)
 ;;0
"RTN","ORY139",132,0)
 ;;9846,"KEY")
"RTN","ORY139",133,0)
 ;;ORB FORWARD BACKUP REVIEWER^DNR EXPIRING
"RTN","ORY139",134,0)
 ;;9846,"VAL")
"RTN","ORY139",135,0)
 ;;0
"RTN","ORY139",136,0)
 ;;9847,"KEY")
"RTN","ORY139",137,0)
 ;;ORB FORWARD BACKUP REVIEWER^FREE TEXT
"RTN","ORY139",138,0)
 ;;9847,"VAL")
"RTN","ORY139",139,0)
 ;;0
"RTN","ORY139",140,0)
 ;;9848,"KEY")
"RTN","ORY139",141,0)
 ;;ORB FORWARD BACKUP REVIEWER^MEDICATIONS EXPIRING
"RTN","ORY139",142,0)
 ;;9848,"VAL")
"RTN","ORY139",143,0)
 ;;0
"RTN","ORY139",144,0)
 ;;9849,"KEY")
"RTN","ORY139",145,0)
 ;;ORB FORWARD BACKUP REVIEWER^UNVERIFIED MEDICATION ORDER
"RTN","ORY139",146,0)
 ;;9849,"VAL")
"RTN","ORY139",147,0)
 ;;0
"RTN","ORY139",148,0)
 ;;9850,"KEY")
"RTN","ORY139",149,0)
 ;;ORB FORWARD BACKUP REVIEWER^NEW ORDER
"RTN","ORY139",150,0)
 ;;9850,"VAL")
"RTN","ORY139",151,0)
 ;;0
"RTN","ORY139",152,0)
 ;;9851,"KEY")
"RTN","ORY139",153,0)
 ;;ORB FORWARD BACKUP REVIEWER^STAT IMAGING REQUEST
"RTN","ORY139",154,0)
 ;;9851,"VAL")
"RTN","ORY139",155,0)
 ;;0
"RTN","ORY139",156,0)
 ;;9852,"KEY")
"RTN","ORY139",157,0)
 ;;ORB FORWARD BACKUP REVIEWER^URGENT IMAGING REQUEST
"RTN","ORY139",158,0)
 ;;9852,"VAL")
"RTN","ORY139",159,0)
 ;;0
"RTN","ORY139",160,0)
 ;;9853,"KEY")
"RTN","ORY139",161,0)
 ;;ORB FORWARD BACKUP REVIEWER^IMAGING RESULTS AMENDED
"RTN","ORY139",162,0)
 ;;9853,"VAL")
"RTN","ORY139",163,0)
 ;;0
"RTN","ORY139",164,0)
 ;;9854,"KEY")
"RTN","ORY139",165,0)
 ;;ORB FORWARD BACKUP REVIEWER^ORDER CHECK
"RTN","ORY139",166,0)
 ;;9854,"VAL")
"RTN","ORY139",167,0)
 ;;0
"RTN","ORY139",168,0)
 ;;9855,"KEY")
"RTN","ORY139",169,0)
 ;;ORB FORWARD BACKUP REVIEWER^FOOD/DRUG INTERACTION
"RTN","ORY139",170,0)
 ;;9855,"VAL")
"RTN","ORY139",171,0)
 ;;0
"RTN","ORY139",172,0)
 ;;9856,"KEY")
"RTN","ORY139",173,0)
 ;;ORB FORWARD BACKUP REVIEWER^ERROR MESSAGE
"RTN","ORY139",174,0)
 ;;9856,"VAL")
"RTN","ORY139",175,0)
 ;;0
"RTN","ORY139",176,0)
 ;;9857,"KEY")
"RTN","ORY139",177,0)
 ;;ORB FORWARD BACKUP REVIEWER^CRITICAL LAB RESULTS (ACTION)
"RTN","ORY139",178,0)
 ;;9857,"VAL")
"RTN","ORY139",179,0)
 ;;0
"RTN","ORY139",180,0)
 ;;9858,"KEY")
"RTN","ORY139",181,0)
 ;;ORB FORWARD BACKUP REVIEWER^ABNORMAL LAB RESULT (INFO)
"RTN","ORY139",182,0)
 ;;9858,"VAL")
"RTN","ORY139",183,0)
 ;;0
"RTN","ORY139",184,0)
 ;;9859,"KEY")
"RTN","ORY139",185,0)
 ;;ORB FORWARD BACKUP REVIEWER^UNVERIFIED ORDER
"RTN","ORY139",186,0)
 ;;9859,"VAL")
"RTN","ORY139",187,0)
 ;;0
"RTN","ORY139",188,0)
 ;;9860,"KEY")
"RTN","ORY139",189,0)
 ;;ORB FORWARD BACKUP REVIEWER^FLAGGED OI RESULTS - OUTPT
"RTN","ORY139",190,0)
 ;;9860,"VAL")
"RTN","ORY139",191,0)
 ;;0
"RTN","ORY139",192,0)
 ;;9861,"KEY")
"RTN","ORY139",193,0)
 ;;ORB FORWARD BACKUP REVIEWER^FLAGGED OI ORDER - OUTPT
"RTN","ORY139",194,0)
 ;;9861,"VAL")
"RTN","ORY139",195,0)
 ;;0
"RTN","ORY139",196,0)
 ;;9862,"KEY")
"RTN","ORY139",197,0)
 ;;ORB FORWARD BACKUP REVIEWER^DC ORDER
"RTN","ORY139",198,0)
 ;;9862,"VAL")
"RTN","ORY139",199,0)
 ;;0
"RTN","ORY139",200,0)
 ;;9863,"KEY")
"RTN","ORY139",201,0)
 ;;ORB FORWARD BACKUP REVIEWER^CONSULT/REQUEST UPDATED
"RTN","ORY139",202,0)
 ;;9863,"VAL")
"RTN","ORY139",203,0)
 ;;0
"RTN","ORY139",204,0)
 ;;9864,"KEY")
"RTN","ORY139",205,0)
 ;;ORB FORWARD BACKUP REVIEWER^FLAGGED OI EXPIRING - INPT
"RTN","ORY139",206,0)
 ;;9864,"VAL")
"RTN","ORY139",207,0)
 ;;0
"RTN","ORY139",208,0)
 ;;9865,"KEY")
"RTN","ORY139",209,0)
 ;;ORB FORWARD BACKUP REVIEWER^FLAGGED OI EXPIRING - OUTPT
"RTN","ORY139",210,0)
 ;;9865,"VAL")
"RTN","ORY139",211,0)
 ;;0
"RTN","ORY139",212,0)
 ;;9866,"KEY")
"RTN","ORY139",213,0)
 ;;ORB FORWARD BACKUP REVIEWER^CONSULT/PROC INTERPRETATION
"RTN","ORY139",214,0)
 ;;9866,"VAL")
"RTN","ORY139",215,0)
 ;;0
"RTN","ORY139",216,0)
 ;;9867,"KEY")
"RTN","ORY139",217,0)
 ;;ORB FORWARD BACKUP REVIEWER^IMAGING REQUEST CHANGED
"RTN","ORY139",218,0)
 ;;9867,"VAL")
"RTN","ORY139",219,0)
 ;;0
"RTN","ORY139",220,0)
 ;;9868,"KEY")
"RTN","ORY139",221,0)
 ;;ORB FORWARD BACKUP REVIEWER^LAB THRESHOLD EXCEEDED
"RTN","ORY139",222,0)
 ;;9868,"VAL")
"RTN","ORY139",223,0)
 ;;0
"VER")
8.0^22.0
"^DD",8989.51,8989.51,0)
FIELD^^30^18
"^DD",8989.51,8989.51,0,"DDA")
N
"^DD",8989.51,8989.51,0,"DT")
2970621
"^DD",8989.51,8989.51,0,"ID","WRITE")
N X S X=^(0) D EN^DDIOL($P(X,U,2),"","?36")
"^DD",8989.51,8989.51,0,"IX","AG",8989.513,.02)

"^DD",8989.51,8989.51,0,"IX","B",8989.51,.01)

"^DD",8989.51,8989.51,0,"IX","C",8989.51,.02)

"^DD",8989.51,8989.51,0,"IX","D",8989.51,.01)

"^DD",8989.51,8989.51,0,"NM","PARAMETER DEFINITION")

"^DD",8989.51,8989.51,0,"PT",8989.5,.02)

"^DD",8989.51,8989.51,0,"PT",8989.52,.04)

"^DD",8989.51,8989.51,0,"PT",8989.521,.02)

"^DD",8989.51,8989.51,0,"VRPK")
CLINICAL PROCEDURES
"^DD",8989.51,8989.51,.01,0)
NAME^RFX^^0;1^D VALID01^XPARDD1
"^DD",8989.51,8989.51,.01,1,0)
^.1
"^DD",8989.51,8989.51,.01,1,1,0)
8989.51^B
"^DD",8989.51,8989.51,.01,1,1,1)
S ^XTV(8989.51,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.51,.01,1,1,2)
K ^XTV(8989.51,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.51,.01,1,2,0)
8989.51^D^KWIC
"^DD",8989.51,8989.51,.01,1,2,1)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2,^DD("KWIC")'[I S ^XTV(8989.51,"D",I,DA)=""
"^DD",8989.51,8989.51,.01,1,2,2)
S %1=1 F %=1:1:$L(X)+1 S I=$E(X,%) I "(,.?! '-/&:;)"[I S I=$E($E(X,%1,%-1),1,30),%1=%+1 I $L(I)>2 K ^XTV(8989.51,"D",I,DA)
"^DD",8989.51,8989.51,.01,1,2,"DT")
3000225
"^DD",8989.51,8989.51,.01,3)
Answer must be 3-30 characters in length.  Name must be unique.
"^DD",8989.51,8989.51,.01,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,.01,21,1,0)
This is the name of the parameter.  It should be namespaced according to the 
"^DD",8989.51,8989.51,.01,21,2,0)
package from which the parameter originated.
"^DD",8989.51,8989.51,.01,"DT")
2960207
"^DD",8989.51,8989.51,.02,0)
DISPLAY TEXT^F^^0;2^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.02,1,0)
^.1
"^DD",8989.51,8989.51,.02,1,1,0)
8989.51^C^MUMPS
"^DD",8989.51,8989.51,.02,1,1,1)
S ^XTV(8989.51,"C",$$UPPER^XPARDD1(X),DA)=""
"^DD",8989.51,8989.51,.02,1,1,2)
K ^XTV(8989.51,"C",$$UPPER^XPARDD1(X),DA)
"^DD",8989.51,8989.51,.02,1,1,"%D",0)
^^2^2^2970606^
"^DD",8989.51,8989.51,.02,1,1,"%D",1,0)
Cross references display text for lookup.  Display text is put in upper
"^DD",8989.51,8989.51,.02,1,1,"%D",2,0)
case so lookup will be case insensitive.
"^DD",8989.51,8989.51,.02,1,1,"DT")
2960409
"^DD",8989.51,8989.51,.02,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.02,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,.02,21,1,0)
This is the displayable name for the parameter (allows mixed case, 
"^DD",8989.51,8989.51,.02,21,2,0)
non-namespaced names).
"^DD",8989.51,8989.51,.02,"DT")
2960409
"^DD",8989.51,8989.51,.03,0)
MULTIPLE VALUED^S^1:Yes;0:No;^0;3^Q
"^DD",8989.51,8989.51,.03,3)
Enter 'Yes' if multiple instances of the parameter are allowed for any single entity.
"^DD",8989.51,8989.51,.03,21,0)
^^3^3^2980705^
"^DD",8989.51,8989.51,.03,21,1,0)
If this field is set to 'Yes', multiple instances of the parameter will be 
"^DD",8989.51,8989.51,.03,21,2,0)
allowed for a single entity.  Otherwise, the value of the instance field
"^DD",8989.51,8989.51,.03,21,3,0)
for a given Entity-Parameter combination will always be '1'.
"^DD",8989.51,8989.51,.03,"DT")
2960207
"^DD",8989.51,8989.51,.04,0)
INSTANCE TERM^F^^0;4^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.04,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.04,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,.04,21,1,0)
This is a free text term that can be used when prompting for a new instance of 
"^DD",8989.51,8989.51,.04,21,2,0)
the parameter (in the case where the parameter in multiple valued).  If not 
"^DD",8989.51,8989.51,.04,21,3,0)
entered, the word "Instance" will be used.
"^DD",8989.51,8989.51,.04,"DT")
2960207
"^DD",8989.51,8989.51,.05,0)
VALUE TERM^F^^0;5^K:$L(X)>40!($L(X)<1) X
"^DD",8989.51,8989.51,.05,3)
Answer must be 1-40 characters in length.
"^DD",8989.51,8989.51,.05,21,0)
^^2^2^2970626^
"^DD",8989.51,8989.51,.05,21,1,0)
This contains text that is issued as a prompt for the value.  If nothing
"^DD",8989.51,8989.51,.05,21,2,0)
is here, the prompt will be the word 'Value:'.
"^DD",8989.51,8989.51,.05,"DT")
2960612
"^DD",8989.51,8989.51,.06,0)
PROHIBIT EDITING^S^1:Yes;0:No;^0;6^Q
"^DD",8989.51,8989.51,.06,3)
Choose 'Disallow Editing' if editing of this field should not be allowed.
"^DD",8989.51,8989.51,.06,21,0)
^^2^2^2970306^
"^DD",8989.51,8989.51,.06,21,1,0)
This field prevents the parameter value from being edited with Fileman or
"^DD",8989.51,8989.51,.06,21,2,0)
any Parameters tools.
"^DD",8989.51,8989.51,.06,"DT")
2970317
"^DD",8989.51,8989.51,1.1,0)
VALUE DATA TYPE^S^D:date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;W:word processing;M:M code;C:constant;^1;1^Q
"^DD",8989.51,8989.51,1.1,3)
Enter the type of data this parameter will contain.
"^DD",8989.51,8989.51,1.1,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,1.1,21,1,0)
This is the type of data this parameter will contain.  This field is used to 
"^DD",8989.51,8989.51,1.1,21,2,0)
define a call to the reader (^DIR) in most cases.
"^DD",8989.51,8989.51,1.1,"DT")
2960528
"^DD",8989.51,8989.51,1.2,0)
VALUE DOMAIN^F^^1;2^K:$L(X)>100!($L(X)<1) X
"^DD",8989.51,8989.51,1.2,3)
Enter up to 100 characters to further define the data type (used by ^DIR).
"^DD",8989.51,8989.51,1.2,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,1.2,21,1,0)
This is a string that may be used to further specify the data type.  The 
"^DD",8989.51,8989.51,1.2,21,2,0)
string stored here should be appropriate for the second ^-piece of DIR(0) 
"^DD",8989.51,8989.51,1.2,21,3,0)
when used with the data type field.
"^DD",8989.51,8989.51,1.2,"DT")
2960207
"^DD",8989.51,8989.51,1.3,0)
VALUE HELP^F^^1;3^K:$L(X)>80!($L(X)<1) X
"^DD",8989.51,8989.51,1.3,3)
Enter a line of help text to be displayed when entering a parameter value.
"^DD",8989.51,8989.51,1.3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,1.3,21,1,0)
This field contains a line of help text that is displayed when the user 
"^DD",8989.51,8989.51,1.3,21,2,0)
requests help or encounters an error while entering the VALUE field in the 
"^DD",8989.51,8989.51,1.3,21,3,0)
PARAMETERS file.
"^DD",8989.51,8989.51,1.3,"DT")
2960207
"^DD",8989.51,8989.51,2,0)
VALUE VALIDATION CODE^K^^2;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,2,3)
This is M code used by DIR (3rd piece of DIR(0)).
"^DD",8989.51,8989.51,2,9)
@
"^DD",8989.51,8989.51,2,21,0)
^^2^2^2980705^
"^DD",8989.51,8989.51,2,21,1,0)
This field contains the M code that is placed in the third piece of DIR(0)
"^DD",8989.51,8989.51,2,21,2,0)
when validating a value in the PARAMETERS file.
"^DD",8989.51,8989.51,2,"DT")
2960207
"^DD",8989.51,8989.51,3,0)
VALUE SCREEN CODE^K^^3;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,3,3)
This is M code placed in DIR("S").
"^DD",8989.51,8989.51,3,9)
@
"^DD",8989.51,8989.51,3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,3,21,1,0)
This field contains M code that is used to screen allowable entries for the 
"^DD",8989.51,8989.51,3,21,2,0)
VALUE field in the PARAMETERS file.  The code is placed in DIR("S") when 
"^DD",8989.51,8989.51,3,21,3,0)
validating the entry.
"^DD",8989.51,8989.51,3,"DT")
2960207
"^DD",8989.51,8989.51,6.1,0)
INSTANCE DATA TYPE^S^D:date/time;F:free text;N:numeric;S:set of codes;Y:yes/no;P:pointer;^6;1^Q
"^DD",8989.51,8989.51,6.1,3)
Enter the type of data allowed for the INSTANCE field of the parameter.
"^DD",8989.51,8989.51,6.1,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.1,21,1,0)
This is the type of data that is contained in the INSTANCE field of the 
"^DD",8989.51,8989.51,6.1,21,2,0)
PARAMETERS file, if multiple parameter instances per entity are allowed.  
"^DD",8989.51,8989.51,6.1,21,3,0)
This field is used to define a call to the reader.
"^DD",8989.51,8989.51,6.1,"DT")
2960207
"^DD",8989.51,8989.51,6.2,0)
INSTANCE DOMAIN^F^^6;2^K:$L(X)>100!($L(X)<1) X
"^DD",8989.51,8989.51,6.2,3)
Enter up to 100 characters to further define the data type (used by ^DIR).
"^DD",8989.51,8989.51,6.2,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.2,21,1,0)
This may be used to further define the data type for the INSTANCE field of 
"^DD",8989.51,8989.51,6.2,21,2,0)
the parameter.  The string stored here should be appropriate for the second 
"^DD",8989.51,8989.51,6.2,21,3,0)
^-piece of DIR(0) when used with the data type field.
"^DD",8989.51,8989.51,6.2,"DT")
2960207
"^DD",8989.51,8989.51,6.3,0)
INSTANCE HELP^F^^6;3^K:$L(X)>80!($L(X)<1) X
"^DD",8989.51,8989.51,6.3,3)
Enter a line of help text to be displayed when entering the parameter instance.
"^DD",8989.51,8989.51,6.3,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,6.3,21,1,0)
This field contains a line of help text that is displayed when the user 
"^DD",8989.51,8989.51,6.3,21,2,0)
requests help or encounters an error while entering the INSTANCE field of 
"^DD",8989.51,8989.51,6.3,21,3,0)
the PARAMETERS file.
"^DD",8989.51,8989.51,6.3,"DT")
2960207
"^DD",8989.51,8989.51,7,0)
INSTANCE VALIDATION CODE^K^^7;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,7,3)
This is M code used by DIR (3rd piece of DIR(0)).
"^DD",8989.51,8989.51,7,9)
@
"^DD",8989.51,8989.51,7,21,0)
^^2^2^2960207^
"^DD",8989.51,8989.51,7,21,1,0)
This field contains M code that is placed in the third piece of DIR(0) when 
"^DD",8989.51,8989.51,7,21,2,0)
validating the INSTANCE field in the PARAMETERS file.
"^DD",8989.51,8989.51,7,"DT")
2960207
"^DD",8989.51,8989.51,8,0)
INSTANCE SCREEN CODE^K^^8;E1,245^K:$L(X)>245 X D:$D(X) ^DIM
"^DD",8989.51,8989.51,8,3)
This is M code placed in DIR("S").
"^DD",8989.51,8989.51,8,9)
@
"^DD",8989.51,8989.51,8,21,0)
^^3^3^2960207^
"^DD",8989.51,8989.51,8,21,1,0)
This field contains M code that is used to screen allowable entries for the 
"^DD",8989.51,8989.51,8,21,2,0)
INSTANCE field in the PARAMETERS file.  The code is placed in DIR("S") when 
"^DD",8989.51,8989.51,8,21,3,0)
validating the entry.
"^DD",8989.51,8989.51,8,"DT")
2960207
"^DD",8989.51,8989.51,20,0)
DESCRIPTION^8989.512^^20;0
"^DD",8989.51,8989.51,20,21,0)
^^1^1^2970626^
"^DD",8989.51,8989.51,20,21,1,0)
A description of the parameter may be entered here.
"^DD",8989.51,8989.51,30,0)
ALLOWABLE ENTITIES^8989.513I^^30;0
"^DD",8989.51,8989.51,30,21,0)
^^2^2^2960213^^
"^DD",8989.51,8989.51,30,21,1,0)
This multiple contains a list of entities (pointers to files) for which the 
"^DD",8989.51,8989.51,30,21,2,0)
parameter may be validly set.
"^DD",8989.51,8989.512,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",8989.51,8989.512,0,"DT")
2960207
"^DD",8989.51,8989.512,0,"NM","DESCRIPTION")

"^DD",8989.51,8989.512,0,"UP")
8989.51
"^DD",8989.51,8989.512,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",8989.51,8989.512,.01,3)
Enter a description of the parameter and how it is used.
"^DD",8989.51,8989.512,.01,21,0)
^^1^1^2960207^
"^DD",8989.51,8989.512,.01,21,1,0)
This is text that describes the purpose and use of the parameter.
"^DD",8989.51,8989.512,.01,"DT")
2960207
"^DD",8989.51,8989.513,0)
ALLOWABLE ENTITIES SUB-FIELD^^.02^2
"^DD",8989.51,8989.513,0,"DT")
2970621
"^DD",8989.51,8989.513,0,"ID",.02)
S %I=Y,Y=$S('$D(^(0)):"",$D(^DIC(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(1,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",8989.51,8989.513,0,"IX","B",8989.513,.01)

"^DD",8989.51,8989.513,0,"NM","ALLOWABLE ENTITIES")

"^DD",8989.51,8989.513,0,"UP")
8989.51
"^DD",8989.51,8989.513,.01,0)
PRECEDENCE^MRNJ6,2^^0;1^K:+X'=X!(X>999.99)!(X<0)!(X?.E1"."3N.N) X
"^DD",8989.51,8989.513,.01,1,0)
^.1
"^DD",8989.51,8989.513,.01,1,1,0)
8989.513^B
"^DD",8989.51,8989.513,.01,1,1,1)
S ^XTV(8989.51,DA(1),30,"B",$E(X,1,30),DA)=""
"^DD",8989.51,8989.513,.01,1,1,2)
K ^XTV(8989.51,DA(1),30,"B",$E(X,1,30),DA)
"^DD",8989.51,8989.513,.01,3)
Type a Number between 0 and 999.99, 2 Decimal Digits
"^DD",8989.51,8989.513,.01,21,0)
^^6^6^2960213^^^
"^DD",8989.51,8989.513,.01,21,1,0)
A single parameter may be set for several different types of entities.  This 
"^DD",8989.51,8989.513,.01,21,2,0)
lists the order in which entities are searched for a defined value.  For 
"^DD",8989.51,8989.513,.01,21,3,0)
example, if a parameter may be set for a package, a location, and a user, 
"^DD",8989.51,8989.513,.01,21,4,0)
and the respective precedents are 3, 2, 1, the value of the user parameter 
"^DD",8989.51,8989.513,.01,21,5,0)
would be returned.  If it did not exist, the value of the location 
"^DD",8989.51,8989.513,.01,21,6,0)
parameter.  If that did not exist, then the value of the package parameter.
"^DD",8989.51,8989.513,.01,"DT")
2960213
"^DD",8989.51,8989.513,.02,0)
ENTITY FILE^RP8989.518'^XTV(8989.518,^0;2^Q
"^DD",8989.51,8989.513,.02,1,0)
^.1
"^DD",8989.51,8989.513,.02,1,1,0)
8989.51^AG^MUMPS
"^DD",8989.51,8989.513,.02,1,1,1)
D AGS^XPARDD1
"^DD",8989.51,8989.513,.02,1,1,2)
D AGK^XPARDD1
"^DD",8989.51,8989.513,.02,1,1,"%D",0)
^^5^5^2980422^
"^DD",8989.51,8989.513,.02,1,1,"%D",1,0)
The AG x-ref has the format ^XTV(8989.51,PARAM,30,"AG",GLOBAL REF,DA)="".
"^DD",8989.51,8989.513,.02,1,1,"%D",2,0)
 
"^DD",8989.51,8989.513,.02,1,1,"%D",3,0)
It is used to screen the parameters that may be selected for a given entity 
"^DD",8989.51,8989.513,.02,1,1,"%D",4,0)
in the PARAMETERS file.  The global root is used because the entity is a 
"^DD",8989.51,8989.513,.02,1,1,"%D",5,0)
variable pointer.
"^DD",8989.51,8989.513,.02,1,1,"DT")
2960207
"^DD",8989.51,8989.513,.02,3)
Choose a file from which entities for this parameter are identified.
"^DD",8989.51,8989.513,.02,21,0)
^^3^3^2980422^
"^DD",8989.51,8989.513,.02,21,1,0)
This identifies an entity for which the parameter can be legally entered.  
"^DD",8989.51,8989.513,.02,21,2,0)
Entities are simply variable pointers.  The files which are eligible to be
"^DD",8989.51,8989.513,.02,21,3,0)
entities are listed in the PARAMETER ENTITY file.
"^DD",8989.51,8989.513,.02,"DT")
2970621
"^DIC",8989.51,8989.51,0)
PARAMETER DEFINITION^8989.51
"^DIC",8989.51,8989.51,0,"GL")
^XTV(8989.51,
"^DIC",8989.51,8989.51,"%D",0)
^^3^3^2980920^
"^DIC",8989.51,8989.51,"%D",1,0)
This file contains the characteristics of parameters.  Entries in this
"^DIC",8989.51,8989.51,"%D",2,0)
file must be namespaced and they are exported by the package which owns
"^DIC",8989.51,8989.51,"%D",3,0)
them.
"^DIC",8989.51,"B","PARAMETER DEFINITION",8989.51)

**END**
**END**
