Released TIU*1*162 SEQ #157
Extracted from mail message
**KIDS**:TIU*1.0*162^

**INSTALL NAME**
TIU*1.0*162
"BLD",4313,0)
TIU*1.0*162^TEXT INTEGRATION UTILITIES^0^3030415^y
"BLD",4313,1,0)
^^2^2^3030415^
"BLD",4313,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",4313,1,2,0)
under patch TIU*1*162.
"BLD",4313,4,0)
^9.64PA^^
"BLD",4313,"KRN",0)
^9.67PA^8989.52^19
"BLD",4313,"KRN",.4,0)
.4
"BLD",4313,"KRN",.401,0)
.401
"BLD",4313,"KRN",.402,0)
.402
"BLD",4313,"KRN",.403,0)
.403
"BLD",4313,"KRN",.5,0)
.5
"BLD",4313,"KRN",.84,0)
.84
"BLD",4313,"KRN",3.6,0)
3.6
"BLD",4313,"KRN",3.8,0)
3.8
"BLD",4313,"KRN",9.2,0)
9.2
"BLD",4313,"KRN",9.8,0)
9.8
"BLD",4313,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",4313,"KRN",9.8,"NM",1,0)
TIUBR^^0^B36575722
"BLD",4313,"KRN",9.8,"NM",2,0)
TIUPRPN1^^0^B41957058
"BLD",4313,"KRN",9.8,"NM",3,0)
TIUPRDS1^^0^B15965116
"BLD",4313,"KRN",9.8,"NM",4,0)
TIUSRVR2^^0^B30785703
"BLD",4313,"KRN",9.8,"NM",5,0)
TIULF^^0^B4217238
"BLD",4313,"KRN",9.8,"NM","B","TIUBR",1)

"BLD",4313,"KRN",9.8,"NM","B","TIULF",5)

"BLD",4313,"KRN",9.8,"NM","B","TIUPRDS1",3)

"BLD",4313,"KRN",9.8,"NM","B","TIUPRPN1",2)

"BLD",4313,"KRN",9.8,"NM","B","TIUSRVR2",4)

"BLD",4313,"KRN",19,0)
19
"BLD",4313,"KRN",19.1,0)
19.1
"BLD",4313,"KRN",101,0)
101
"BLD",4313,"KRN",409.61,0)
409.61
"BLD",4313,"KRN",771,0)
771
"BLD",4313,"KRN",870,0)
870
"BLD",4313,"KRN",8989.51,0)
8989.51
"BLD",4313,"KRN",8989.52,0)
8989.52
"BLD",4313,"KRN",8994,0)
8994
"BLD",4313,"KRN","B",.4,.4)

"BLD",4313,"KRN","B",.401,.401)

"BLD",4313,"KRN","B",.402,.402)

"BLD",4313,"KRN","B",.403,.403)

"BLD",4313,"KRN","B",.5,.5)

"BLD",4313,"KRN","B",.84,.84)

"BLD",4313,"KRN","B",3.6,3.6)

"BLD",4313,"KRN","B",3.8,3.8)

"BLD",4313,"KRN","B",9.2,9.2)

"BLD",4313,"KRN","B",9.8,9.8)

"BLD",4313,"KRN","B",19,19)

"BLD",4313,"KRN","B",19.1,19.1)

"BLD",4313,"KRN","B",101,101)

"BLD",4313,"KRN","B",409.61,409.61)

"BLD",4313,"KRN","B",771,771)

"BLD",4313,"KRN","B",870,870)

"BLD",4313,"KRN","B",8989.51,8989.51)

"BLD",4313,"KRN","B",8989.52,8989.52)

"BLD",4313,"KRN","B",8994,8994)

"BLD",4313,"QUES",0)
^9.62^^
"BLD",4313,"REQB",0)
^9.611^1^1
"BLD",4313,"REQB",1,0)
TIU*1.0*109^2
"BLD",4313,"REQB","B","TIU*1.0*109",1)

"MBREQ")
0
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
162^3030415
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3030415
"PKG",193,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under patch TIU*1*162.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","TIUBR")
0^1^B36575722
"RTN","TIUBR",1,0)
TIUBR ; SLC/JER - Browse Action Subroutines ;4/15/03
"RTN","TIUBR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**32,87,93,58,100,162**;Jun 20, 1997
"RTN","TIUBR",3,0)
 ; Move LOADSIG, XTRASIG, LOADFOR, LOADREC to TIUBR1.
"RTN","TIUBR",4,0)
EN ; Entry code for LM templates TIU BROWSE
"RTN","TIUBR",5,0)
 N TIUY
"RTN","TIUBR",6,0)
 ;Kill TIUGDATA in CLEAN; don't new it here
"RTN","TIUBR",7,0)
 ; -- Set TIUGDATA, which describes the note originally
"RTN","TIUBR",8,0)
 ;    selected to be browsed. --
"RTN","TIUBR",9,0)
 ; TIUGDATA = 0 or
"RTN","TIUBR",10,0)
 ;          = TIUDA^HASIDKID^TIUD21^PRMSORT, where
"RTN","TIUBR",11,0)
 ;            PRMSORT = "TITLE" or "REFDT".  See 8925.95, fld .18
"RTN","TIUBR",12,0)
 S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUBR",13,0)
 D BLDTMP(TIUDA)
"RTN","TIUBR",14,0)
 Q
"RTN","TIUBR",15,0)
HDR ; Build Header
"RTN","TIUBR",16,0)
 N TIUDTYP,DFN
"RTN","TIUBR",17,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIUBR",18,0)
 D:$D(TIU)'>9 GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUBR",19,0)
 S VALMHDR(1)=$$CENTER^TIULS($P($G(TIU("DOCTYP")),U,2))
"RTN","TIUBR",20,0)
 ;  Docmt header line Patname, SSN, [Location, Visit]:
"RTN","TIUBR",21,0)
 S VALMHDR(2)=$$SETREC(TIUGDATA)
"RTN","TIUBR",22,0)
 Q
"RTN","TIUBR",23,0)
BLDTMP(TIUDA) ; Build ^TMP("TIUVIEW",$J,
"RTN","TIUBR",24,0)
 ; Requires TIUDA = IFN of note selected to be browsed.
"RTN","TIUBR",25,0)
 ; Needs TIUGDATA, set in EN
"RTN","TIUBR",26,0)
 N TIUI,TIUL,TIUREC,TIUDADD S (TIUDADD,TIUI)=0
"RTN","TIUBR",27,0)
 N TIUNAME K ^TMP("TIUVIEW",$J),^TMP("TIU FOCUS",$J)
"RTN","TIUBR",28,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUBR",29,0)
 S ^TMP("TIU FOCUS",$J)=TIUDA
"RTN","TIUBR",30,0)
 D INQUIRE^TIUGBR(TIUDA,.TIUREC)
"RTN","TIUBR",31,0)
 I $D(TIUREC)>9 W !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUBR",32,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUBR",33,0)
 D LOADTOP(.TIUREC,TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",34,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUBR",35,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA)
"RTN","TIUBR",36,0)
 K ^TMP("TIU FOCUS",$J)
"RTN","TIUBR",37,0)
 S ^TMP("TIUVIEW",$J,0)=$G(^TIU(8925,+TIUDA,"TEXT",0))
"RTN","TIUBR",38,0)
 S $P(^TMP("TIUVIEW",$J,0),U,3,4)=$G(TIUL)_U_$G(TIUL),VALMCNT=+$G(TIUL)
"RTN","TIUBR",39,0)
 Q
"RTN","TIUBR",40,0)
LOADTOP(TIUREC,TIUDA,TIUL,TIUGDATA) ; Load dictation, transcription data, etc.
"RTN","TIUBR",41,0)
 ; Requires array TIUREC, TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",42,0)
 N TIUY,SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT
"RTN","TIUBR",43,0)
 ; ---- For ID note, include Title, [Location, & Visit] with each
"RTN","TIUBR",44,0)
 ;      entry, since they vary by entry.
"RTN","TIUBR",45,0)
 ; ---- Follow with Date, Author, etc.
"RTN","TIUBR",46,0)
 ; ---- For ID children in whole note display, shorten top info:
"RTN","TIUBR",47,0)
 ;      Instead of Title, Location, Visit, Date, Author, etc.,
"RTN","TIUBR",48,0)
 ;      use just Title, followed by just Date and Status:
"RTN","TIUBR",49,0)
 S (SHORT,CURCHLD,CURPRNT,SELCHLD,SELPRNT)=0
"RTN","TIUBR",50,0)
 I $P(TIUGDATA,U,3) S SELCHLD=1 ; Selected record was IDchild
"RTN","TIUBR",51,0)
 I $P(TIUGDATA,U,2) S SELPRNT=1
"RTN","TIUBR",52,0)
 I SELCHLD,TIUDA'=$P(TIUGDATA,U,3) S CURCHLD=1 ; Current rec is IDchild
"RTN","TIUBR",53,0)
 I SELCHLD,TIUDA=$P(TIUGDATA,U,3) S CURPRNT=1
"RTN","TIUBR",54,0)
 I SELPRNT,TIUDA=+TIUGDATA S CURPRNT=1
"RTN","TIUBR",55,0)
 I SELPRNT,TIUDA'=+TIUGDATA S CURCHLD=1
"RTN","TIUBR",56,0)
 I SELPRNT,CURCHLD S SHORT=1 ;Child in whole note: shorten top info
"RTN","TIUBR",57,0)
 I SELCHLD,CURCHLD,$G(TIUGWHOL) S SHORT=1
"RTN","TIUBR",58,0)
 I SELCHLD!SELPRNT D
"RTN","TIUBR",59,0)
 . D IDTOP^TIUGBR(TIUDA,.TIUL,SHORT,CURPRNT)
"RTN","TIUBR",60,0)
 S TIUL=+$G(TIUL)+1,TIUY=""
"RTN","TIUBR",61,0)
 I SHORT D
"RTN","TIUBR",62,0)
 . S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",63,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",64,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",65,0)
 I 'SHORT D
"RTN","TIUBR",66,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",67,0)
 . . S TIUY=$$SETSTR^VALM1("DICT DATE: "_TIUREC(8925,+TIUDA,1307),$G(TIUY),4,39)
"RTN","TIUBR",68,0)
 . E  S TIUY=$$SETSTR^VALM1("DATE OF NOTE: "_TIUREC(8925,+TIUDA,1301),$G(TIUY),1,39)
"RTN","TIUBR",69,0)
 . S TIUY=$$SETSTR^VALM1("ENTRY DATE: "_TIUREC(8925,+TIUDA,1201),$G(TIUY),38,39)
"RTN","TIUBR",70,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",71,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",72,0)
 . I $L(TIUREC(8925,+TIUDA,1307)) D  I 1
"RTN","TIUBR",73,0)
 . . S TIUY=$$SETSTR^VALM1("DICTATED BY: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),2,32)
"RTN","TIUBR",74,0)
 . E  S TIUY=$$SETSTR^VALM1("AUTHOR: "_TIUREC(8925,+TIUDA,1202),$G(TIUY),7,32)
"RTN","TIUBR",75,0)
 . I $L(TIUREC(8925,+TIUDA,1209)) D  I 1
"RTN","TIUBR",76,0)
 . . S TIUY=$$SETSTR^VALM1("ATTENDING: "_TIUREC(8925,+TIUDA,1209),$G(TIUY),39,40)
"RTN","TIUBR",77,0)
 . E  S TIUY=$$SETSTR^VALM1("EXP COSIGNER: "_TIUREC(8925,+TIUDA,1208),$G(TIUY),36,40)
"RTN","TIUBR",78,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",79,0)
 . S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",80,0)
 . S TIUY=$$SETSTR^VALM1("URGENCY: "_TIUREC(8925,+TIUDA,.09),$G(TIUY),6,36)
"RTN","TIUBR",81,0)
 . S TIUY=$$SETSTR^VALM1("STATUS: "_TIUREC(8925,+TIUDA,.05),$G(TIUY),42,38)
"RTN","TIUBR",82,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",83,0)
 S TIUL=TIUL+1,TIUY=""
"RTN","TIUBR",84,0)
 I '$L($G(^TIU(8925,+TIUDA,17))) S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",85,0)
 E  D
"RTN","TIUBR",86,0)
 . S TIUY=$$SETSTR^VALM1("SUBJECT: "_$G(^TIU(8925,+TIUDA,17)),$G(TIUY),6,74)
"RTN","TIUBR",87,0)
 . S @VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",88,0)
 . S TIUL=TIUL+1,TIUY="",@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",89,0)
 I +$$HASADDEN^TIULC1(TIUDA) D
"RTN","TIUBR",90,0)
 . S TIUY="   *** "_$$PNAME^TIULC1(+$G(^TIU(8925,TIUDA,0)))_" Has ADDENDA ***"
"RTN","TIUBR",91,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=TIUY
"RTN","TIUBR",92,0)
 . S TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=""
"RTN","TIUBR",93,0)
 Q
"RTN","TIUBR",94,0)
 ;
"RTN","TIUBR",95,0)
LOADKIDS(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID kids of TIUDA
"RTN","TIUBR",96,0)
 ; Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUBR",97,0)
 N TIUK,PRMSORT,KIDDA,TIUD0,TIUD21
"RTN","TIUBR",98,0)
 I $G(^TMP("TIUR",$J,"IDDATA",TIUDA)) S PRMSORT=$P(^TMP("TIUR",$J,"IDDATA",TIUDA),U,4)
"RTN","TIUBR",99,0)
 E  S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD21=$G(^TIU(8925,TIUDA,21)),PRMSORT=$P($$IDDATA^TIURECL1(TIUDA,TIUD0,TIUD21),U,4)
"RTN","TIUBR",100,0)
 D GETIDKID^TIURECL2(TIUDA,PRMSORT) ; sets array ^TMP("TIUIDKID",$J,
"RTN","TIUBR",101,0)
 S TIUK=0
"RTN","TIUBR",102,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:+TIUK'>0  D
"RTN","TIUBR",103,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIUBR",104,0)
 . D LOADID^TIUGBR(KIDDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUBR",105,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIUBR",106,0)
 Q
"RTN","TIUBR",107,0)
 ;
"RTN","TIUBR",108,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUBR",109,0)
 N TIUY,TIUTYP
"RTN","TIUBR",110,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUBR",111,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUBR",112,0)
 Q TIUY
"RTN","TIUBR",113,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUBR",114,0)
 N TIUDADT,TIUJ,CANSEE
"RTN","TIUBR",115,0)
 S CANSEE=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUBR",116,0)
 S TIUJ=0,TIUL=+$G(TIUL)+1,@VALMAR@(TIUL,0)=" "
"RTN","TIUBR",117,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/CCYY")
"RTN","TIUBR",118,0)
 S TIUL=TIUL+1,@VALMAR@(TIUL,0)=TIUDADT_" ADDENDUM"_"                      STATUS: "_$$STATUS^TIULF(TIUDADD) ;P162
"RTN","TIUBR",119,0)
 I +CANSEE'>0 D  Q
"RTN","TIUBR",120,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",121,0)
 . S @VALMAR@(TIUL,0)=$P(CANSEE,U,2)
"RTN","TIUBR",122,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUBR",123,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUBR",124,0)
 . S @VALMAR@(TIUL,0)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUBR",125,0)
 D LOADSIG^TIUBR1(TIUDADD,.TIUL)
"RTN","TIUBR",126,0)
 Q
"RTN","TIUBR",127,0)
 ;
"RTN","TIUBR",128,0)
SETREC(TIUGDATA) ; Sets docmt header line Patname, SSN, [Location, Visit]
"RTN","TIUBR",129,0)
 ; Requires TIUGDATA
"RTN","TIUBR",130,0)
 N Y
"RTN","TIUBR",131,0)
 S Y=$$SETSTR^VALM1($$NAME^TIULS($G(TIU("PNM")),"LAST,FI MI"),$G(Y),1,15)
"RTN","TIUBR",132,0)
 S Y=$$SETSTR^VALM1($G(TIU("SSN")),$G(Y),16,12)
"RTN","TIUBR",133,0)
 ; ---- If TIUDA is an ID entry, write ID, ADDENDED? in header
"RTN","TIUBR",134,0)
 ;      and leave out entry-specific info (Location, Visit)
"RTN","TIUBR",135,0)
 ;      since that goes with each individual entry: ----
"RTN","TIUBR",136,0)
 I $P(TIUGDATA,U,2)!$P(TIUGDATA,U,3) D  G SETRX
"RTN","TIUBR",137,0)
 . S Y=$$SETSTR^VALM1("Interdisciplinary "_$S($P(TIUGDATA,U,2):"Note",1:"Entry"),$G(Y),29,23)
"RTN","TIUBR",138,0)
 . I $P(TIUGDATA,U,2) S Y=$$SETSTR^VALM1("ADDENDED?"_$S($$HASADDEN^TIULC1(+TIUDA,1):" Yes",1:" No"),$G(Y),66,13)
"RTN","TIUBR",139,0)
 S Y=$$SETSTR^VALM1($P($G(TIU("LOC")),U,2),$G(Y),30,17)
"RTN","TIUBR",140,0)
 I $L($G(TIU("WARD"))) D
"RTN","TIUBR",141,0)
 . S Y=$$SETSTR^VALM1("Adm: "_$$DATE^TIULS(+TIU("EDT"),"MM/DD/CCYY"),$G(Y),48,15)
"RTN","TIUBR",142,0)
 . S Y=$$SETSTR^VALM1("Dis: "_$$DATE^TIULS(+TIU("LDT"),"MM/DD/CCYY"),$G(Y),65,15)
"RTN","TIUBR",143,0)
 I '$L($G(TIU("WARD"))) D
"RTN","TIUBR",144,0)
 . S Y=$$SETSTR^VALM1("Visit Date: "_$$DATE^TIULS(+$G(TIU("EDT")),"MM/DD/CCYY HR:MIN"),$G(Y),51,28)
"RTN","TIUBR",145,0)
SETRX Q Y
"RTN","TIUBR",146,0)
 ;
"RTN","TIUBR",147,0)
CLEAN ; Die, filthy spawn!!!
"RTN","TIUBR",148,0)
 D CLEAN^VALM10 K VALMHDR,TIU,TIUPRM0,TIUPRM1,TIUGDATA
"RTN","TIUBR",149,0)
 Q
"RTN","TIULF")
0^5^B4217238
"RTN","TIULF",1,0)
TIULF ; SLC/JER - More computational functions ; 4/2/03
"RTN","TIULF",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**162**;Jun 20, 1997
"RTN","TIULF",3,0)
 ;
"RTN","TIULF",4,0)
STATUS(TIUDA) ; Returns external status for document TIUDA
"RTN","TIULF",5,0)
 Q $$GET1^DIQ(8925,TIUDA_",",.05)
"RTN","TIULF",6,0)
 ;
"RTN","TIULF",7,0)
EMPTYDOC(DA) ;Checks to see if text for DCS is blank
"RTN","TIULF",8,0)
 ; returns a 1 if empty
"RTN","TIULF",9,0)
 ; returns a 0 if contains data
"RTN","TIULF",10,0)
 N TIULINE,TIUQUIT,TIUSTART,TIUX,TIUY,TIUCHAR,TIUDATA
"RTN","TIULF",11,0)
 S TIUY=1
"RTN","TIULF",12,0)
 I +$O(^TIU(8925,+DA,"TEXT",0))'>0,+$O(^TIU(8925,"DAD",+DA,0))'>0 G EMPTYX ;Text not entered
"RTN","TIULF",13,0)
 S TIULINE=0 F  S TIULINE=$O(^TIU(8925,+DA,"TEXT",TIULINE)) Q:TIULINE'>0!(TIUY=0)  D  Q:TIUY=0
"RTN","TIULF",14,0)
 . S TIUDATA=$G(^TIU(8925,+DA,"TEXT",TIULINE,0)),TIUQUIT=$L(TIUDATA)
"RTN","TIULF",15,0)
 . I TIUQUIT>0 S TIUSTART=1 D  ;Line contains data
"RTN","TIULF",16,0)
 . . ;Checks a char at a time for valid data. If found, TIUY set to 0
"RTN","TIULF",17,0)
 . . ;Data between two | indicates format command and not valid data 
"RTN","TIULF",18,0)
 . . F TIUSTART=TIUSTART:1:TIUQUIT S TIUCHAR=$E(TIUDATA,TIUSTART) D  Q:(TIUY=0)
"RTN","TIULF",19,0)
 . . . ;Char is not a control char or | char
"RTN","TIULF",20,0)
 . . . I $A(TIUCHAR)'<33&($A(TIUCHAR)'>123)!($A(TIUCHAR)=125) S TIUY=0 Q
"RTN","TIULF",21,0)
 . . . I $A(TIUCHAR)=124 D  ;Char is a |
"RTN","TIULF",22,0)
 . . . . S TIUX=$F(TIUDATA,"|",TIUSTART+1) ;Find second |
"RTN","TIULF",23,0)
 . . . . I TIUX>TIUSTART S TIUSTART=TIUX-1 ;Making sure there is a second |
"RTN","TIULF",24,0)
 I +TIUY,$O(^TIU(8925,"DAD",+DA,0)) D
"RTN","TIULF",25,0)
 . N TIUC S TIUC=0
"RTN","TIULF",26,0)
 . F TIUC=$O(^TIU(8925,"DAD",+DA,TIUC)) Q:+TIUC'>0  D  Q:+TIUY=0
"RTN","TIULF",27,0)
 . . S TIUY=$$EMPTYDOC(TIUC)
"RTN","TIULF",28,0)
EMPTYX ; EXIT
"RTN","TIULF",29,0)
 Q TIUY
"RTN","TIULF",30,0)
DOCTYPE(TIUDA) ; Evaluates Definition of a Document
"RTN","TIULF",31,0)
 N TYPE S TYPE=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIULF",32,0)
 S TYPE=$P($G(^TIU(8925.1,+TYPE,0)),U,4)_U_$$PNAME^TIULC1(+TYPE)
"RTN","TIULF",33,0)
 Q TYPE
"RTN","TIUPRDS1")
0^3^B15965116
"RTN","TIUPRDS1",1,0)
TIUPRDS1 ; SLC/SBW,JER - Print DS Form 10-1000 ; 4/14/03
"RTN","TIUPRDS1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**55,52,162**;Jun 20, 1997
"RTN","TIUPRDS1",3,0)
PRINT(TIUDA,TIUFLAG) ; Print Summary
"RTN","TIUPRDS1",4,0)
 ; TIUCONT=1 for Continue, 0 for Exit, NULL for Timeout.
"RTN","TIUPRDS1",5,0)
 ; Returned from $$Stop
"RTN","TIUPRDS1",6,0)
 N TIUADD,TIUPAGE,TIUCOPY,TIUSTAT,TIUCONT,TIUY,TIU
"RTN","TIUPRDS1",7,0)
 S TIUPAGE=1 D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUPRDS1",8,0)
 I +$G(TIU("LDT")),+$G(TIU("AD#")) D  I 1
"RTN","TIUPRDS1",9,0)
 . N DGPMIFN S DGPMIFN=+$G(TIU("AD#")) D ^DGPMLOS S TIU("DAYS")=X
"RTN","TIUPRDS1",10,0)
 E  S TIU("WARD")=""
"RTN","TIUPRDS1",11,0)
 I $E(IOST)="P",+$G(TIUFLAG) S TIUCOPY=$S(+TIUFLAG=2:"ELECTRONICALLY SIGNED CHART COPY",1:"C H A R T   C O P Y")
"RTN","TIUPRDS1",12,0)
 E  S TIUSTAT=$$STATUS^TIULC(TIUDA),TIUCOPY=$S(TIUSTAT="completed":"C O P Y",1:"D R A F T")
"RTN","TIUPRDS1",13,0)
 W:$E(IOST)="C" @IOF D HEADER^TIUPRDS2(TIUDA,.TIU,TIUFLAG,.TIUPAGE)
"RTN","TIUPRDS1",14,0)
 W !,"DICTATION DATE: ",$P(^TMP("TIULQ",$J,TIUDA,1307,"E"),"@"),?40,"TRANSCRIPTION DATE: ",$P(^TMP("TIULQ",$J,TIUDA,1201,"E"),"@")
"RTN","TIUPRDS1",15,0)
 W !,"TRANSCRIPTIONIST: ",^TMP("TIULQ",$J,TIUDA,1302,"E")
"RTN","TIUPRDS1",16,0)
 W:$E(IOST)'="C" !!
"RTN","TIUPRDS1",17,0)
REPORT ; Report Text
"RTN","TIUPRDS1",18,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,TIUI,X,Z K ^UTILITY($J,"W")
"RTN","TIUPRDS1",19,0)
 S TIUI=0,TIUCONT=1,TIUY=6,DIWF="WN",DIWL=1,DIWR=79
"RTN","TIUPRDS1",20,0)
 F  S TIUI=$O(^TMP("TIULQ",$J,TIUDA,"TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT
"RTN","TIUPRDS1",21,0)
 . D SETCONT() Q:'TIUCONT
"RTN","TIUPRDS1",22,0)
 . S X=^TMP("TIULQ",$J,TIUDA,"TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRDS1",23,0)
 D ^DIWW K ^UTILITY($J,"W")
"RTN","TIUPRDS1",24,0)
 Q:'TIUCONT
"RTN","TIUPRDS1",25,0)
AMENDMNT ;If DCS has been amended, next lines are printed.
"RTN","TIUPRDS1",26,0)
 S TIUY=9 D SETCONT() Q:'TIUCONT
"RTN","TIUPRDS1",27,0)
 I +$G(^TMP("TIULQ",$J,TIUDA,1601,"I")) D
"RTN","TIUPRDS1",28,0)
 . W !!,^TMP("TIULQ",$J,TIUDA,1601,"E"),?23,"AMENDMENT FILED:"
"RTN","TIUPRDS1",29,0)
 . I $G(^TMP("TIULQ",$J,TIUDA,1603,"E"))']"" W !!?23 F TIUI=1:1:40 W "_"
"RTN","TIUPRDS1",30,0)
 . I $G(^TMP("TIULQ",$J,TIUDA,1604,"E"))]"" D
"RTN","TIUPRDS1",31,0)
 . . W !?17,"/es/",?23,^TMP("TIULQ",$J,TIUDA,1604,"E")
"RTN","TIUPRDS1",32,0)
 . . W !?23,$G(^TMP("TIULQ",$J,TIUDA,1605,"E"))
"RTN","TIUPRDS1",33,0)
RPTSIG ; Signature should be on bottom of form, Addenda on Subsequent pages
"RTN","TIUPRDS1",34,0)
 N TIULINE,TIUSBLK,EXPSGNR,ATTNDNG
"RTN","TIUPRDS1",35,0)
 S EXPSGNR=+$G(^TMP("TIULQ",$J,TIUDA,1204,"I"))
"RTN","TIUPRDS1",36,0)
 S ATTNDNG=+$G(^TMP("TIULQ",$J,TIUDA,1209,"I"))
"RTN","TIUPRDS1",37,0)
 D LOADSIG^TIULS1(.TIUSBLK,$NA(^TMP("TIULQ",$J,TIUDA)))
"RTN","TIUPRDS1",38,0)
 S $P(TIULINE,"-",IOM)=""
"RTN","TIUPRDS1",39,0)
 S TIUY=TIUSBLK+8 D SETCONT() Q:'TIUCONT
"RTN","TIUPRDS1",40,0)
 I (IOT'="HFS")!(IOSL<250) F  Q:$Y+TIUY>IOSL  W ! ;move SIG to pg Bottom
"RTN","TIUPRDS1",41,0)
 I +$G(TIUFLAG) W !,TIULINE
"RTN","TIUPRDS1",42,0)
 E  W !,"WORK COPY =========== UNOFFICIAL - NOT FOR MEDICAL RECORD ========== DO NOT FILE"
"RTN","TIUPRDS1",43,0)
 I EXPSGNR'=ATTNDNG W !,"SIGNATURE PHYSICIAN/DENTIST",?39,"SIGNATURE APPROVING PHYSICIAN/DENTIST"
"RTN","TIUPRDS1",44,0)
 E  W !?39,"SIGNATURE APPROVING PHYSICIAN/DENTIST"
"RTN","TIUPRDS1",45,0)
 W ! S TIUI=0 F  S TIUI=$O(TIUSBLK(TIUI)) Q:+TIUI'>0  W !,TIUSBLK(TIUI)
"RTN","TIUPRDS1",46,0)
 I +$G(TIUFLAG) W !,TIULINE
"RTN","TIUPRDS1",47,0)
 E  W !,"=========================== CONFIDENTIAL INFORMATION ==========================="
"RTN","TIUPRDS1",48,0)
ADDENDA ; Discharge Summary Addenda
"RTN","TIUPRDS1",49,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,X,Z K ^UTILITY($J,"W")
"RTN","TIUPRDS1",50,0)
 S TIUADD=0,DIWF="WN",DIWL=1,DIWR=79
"RTN","TIUPRDS1",51,0)
 F  S TIUADD=$O(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD)) Q:TIUADD'>0  D  Q:'TIUCONT
"RTN","TIUPRDS1",52,0)
 . S TIUY=6 D SETCONT() Q:'TIUCONT
"RTN","TIUPRDS1",53,0)
 . W !!,$G(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD,1201,"E")),?23,"ADDENDUM" ;P162
"RTN","TIUPRDS1",54,0)
 . W ?39,"STATUS: ",$G(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD,.05,"E")) ;P162
"RTN","TIUPRDS1",55,0)
 . S TIUI=0
"RTN","TIUPRDS1",56,0)
 . F  S TIUI=$O(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD,"TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT
"RTN","TIUPRDS1",57,0)
 . . D SETCONT() Q:'TIUCONT
"RTN","TIUPRDS1",58,0)
 . . S X=^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD,"TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRDS1",59,0)
 . D ^DIWW
"RTN","TIUPRDS1",60,0)
 . D:TIUCONT ADDENSIG
"RTN","TIUPRDS1",61,0)
 ; Next line moves footer to bottom of page/screen
"RTN","TIUPRDS1",62,0)
 I TIUCONT,((IOT'="HFS")!(IOSL<250)) S TIUY=6 F  Q:$Y+TIUY>IOSL  W !
"RTN","TIUPRDS1",63,0)
 I  D SETCONT(1)
"RTN","TIUPRDS1",64,0)
 K ^UTILITY($J,"W")
"RTN","TIUPRDS1",65,0)
 Q
"RTN","TIUPRDS1",66,0)
ADDENSIG ;
"RTN","TIUPRDS1",67,0)
 N TIUSBLK,EXPSGNR,ATTNDNG
"RTN","TIUPRDS1",68,0)
 D LOADSIG^TIULS1(.TIUSBLK,$NA(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD)))
"RTN","TIUPRDS1",69,0)
 S $P(TIULINE,"-",80)=""
"RTN","TIUPRDS1",70,0)
 S EXPSGNR=$G(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD,1204,"I"))
"RTN","TIUPRDS1",71,0)
 S ATTNDNG=$G(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD,1209,"I"))
"RTN","TIUPRDS1",72,0)
 S TIUY=12 D SETCONT() Q:'TIUCONT
"RTN","TIUPRDS1",73,0)
 I EXPSGNR'=ATTNDNG W !,"SIGNATURE PHYSICIAN/DENTIST",?39,"SIGNATURE APPROVING PHYSICIAN/DENTIST"
"RTN","TIUPRDS1",74,0)
 E  W !?39,"SIGNATURE APPROVING PHYSICIAN/DENTIST"
"RTN","TIUPRDS1",75,0)
 W ! S TIUI=0 F  S TIUI=$O(TIUSBLK(TIUI)) Q:+TIUI'>0  W !,TIUSBLK(TIUI)
"RTN","TIUPRDS1",76,0)
 Q
"RTN","TIUPRDS1",77,0)
SETCONT(TIUHEAD) ;Does footer and sets TIUCONT
"RTN","TIUPRDS1",78,0)
 S TIUCONT=$$FOOTER^TIUPRDS2(TIUDA,.TIU,TIUFLAG,.TIUPAGE,TIUCOPY,$G(TIUHEAD))
"RTN","TIUPRDS1",79,0)
 Q
"RTN","TIUPRPN1")
0^2^B41957058
"RTN","TIUPRPN1",1,0)
TIUPRPN1 ;SLC/JER - Print SF 509-Progress Notes ;4/14/03
"RTN","TIUPRPN1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**45,52,87,100,162**;Jun 20, 1997
"RTN","TIUPRPN1",3,0)
PRINT(TIUFLAG,TIUSPG) ; Print Document
"RTN","TIUPRPN1",4,0)
 ; ^TMP("TIUPR",$J) is array of records to be printed
"RTN","TIUPRPN1",5,0)
 ; TIUFLAG=1 --> Chart Copy     TIUSPG=1 --> Contiguous
"RTN","TIUPRPN1",6,0)
 ; TIUFLAG=0 --> Work Copy      TIUSPG=0 --> Fresh Page- each note
"RTN","TIUPRPN1",7,0)
 ; TIUCONT=1 --> Continue printing
"RTN","TIUPRPN1",8,0)
 ; TIUCONT1=1 --> Write "Continue to next/from previous-page" msgs
"RTN","TIUPRPN1",9,0)
 ; TIUPFNBR ---> Print Form # like vice 509
"RTN","TIUPRPN1",10,0)
 ; TIUMISC=TIUFLAG_U_TIUPFNBR_U_TIUDA
"RTN","TIUPRPN1",11,0)
 N TIUI,TIUJ,TIUPAGE,TIUFOOT,TIUK,TIUDA,TIUCONT,TIUPGRP,TIUTYP
"RTN","TIUPRPN1",12,0)
 N TIUPFHDR,TIUPFNBR,TIUMISC,TIUCONT1,TIUIDONE,TMP
"RTN","TIUPRPN1",13,0)
 S TIUFLAG=+$G(TIUFLAG),TIUSPG=+$G(TIUSPG)
"RTN","TIUPRPN1",14,0)
 S TIUCONT=1,TIUCONT1=0
"RTN","TIUPRPN1",15,0)
 S TIUI=0 F  S TIUI=$O(^TMP("TIUPR",$J,TIUI)) Q:TIUI=""  D  Q:'TIUCONT
"RTN","TIUPRPN1",16,0)
 . N DFN,TIU
"RTN","TIUPRPN1",17,0)
 . I TIUI["$" S TIUPGRP=$P(TIUI,"$"),TIUPFHDR=$P($P(TIUI,";"),"$",2)
"RTN","TIUPRPN1",18,0)
 . E  S TIUPFHDR="Progress Notes"
"RTN","TIUPRPN1",19,0)
 . I $G(TIUPGRP)>2 S TIUSPG=0
"RTN","TIUPRPN1",20,0)
 . S DFN=$P(TIUI,";",2)
"RTN","TIUPRPN1",21,0)
 . D PATPN^TIULV(.TIUFOOT,DFN)
"RTN","TIUPRPN1",22,0)
 . I +$G(TIUSPG) D HEADER^TIUPRPN2(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1)
"RTN","TIUPRPN1",23,0)
 . ; Use TIUJ="" (not TIUJ=0), to print "complete" notes w/o sigdt:
"RTN","TIUPRPN1",24,0)
 . S TIUJ="" F  S TIUJ=$O(^TMP("TIUPR",$J,TIUI,TIUJ)) Q:TIUJ=""  D  Q:'TIUCONT
"RTN","TIUPRPN1",25,0)
 . . S TIUK=0 F  S TIUK=$O(^TMP("TIUPR",$J,TIUI,TIUJ,TIUK)) Q:'TIUK  D  Q:'TIUCONT
"RTN","TIUPRPN1",26,0)
 . . . S TIUCONT1=0 S TIUPFNBR=^TMP("TIUPR",$J,TIUI,TIUJ,TIUK)
"RTN","TIUPRPN1",27,0)
 . . . ; If the document has been deleted, QUIT
"RTN","TIUPRPN1",28,0)
 . . . I '$D(^TIU(8925,+TIUK,0)) S TIUCONT=1 Q
"RTN","TIUPRPN1",29,0)
 . . . N TIUROOT
"RTN","TIUPRPN1",30,0)
 . . . I '+$G(TIUSPG) D HEADER^TIUPRPN2(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1)
"RTN","TIUPRPN1",31,0)
 . . . S TIUDA=TIUK
"RTN","TIUPRPN1",32,0)
 . . . S TIUMISC=TIUFLAG_U_TIUPFNBR_U_TIUDA
"RTN","TIUPRPN1",33,0)
 . . . K ^TMP("TIULQ",$J)
"RTN","TIUPRPN1",34,0)
 . . . D EXTRACT^TIULQ(+TIUDA,"^TMP(""TIULQ"",$J)",.TIUERR,"","",1)
"RTN","TIUPRPN1",35,0)
 . . . I +$G(TIUERR) W !,$P(TIUERR,U,2) Q
"RTN","TIUPRPN1",36,0)
 . . . Q:'$D(^TMP("TIULQ",$J))
"RTN","TIUPRPN1",37,0)
 . . . S TIUROOT="^TMP(""TIULQ"",$J,"_TIUDA_")"
"RTN","TIUPRPN1",38,0)
 . . . D REPORT(TIUROOT,.TIUFOOT,TIUMISC,.TIUCONT) Q:'TIUCONT
"RTN","TIUPRPN1",39,0)
 . . . D IDKIDS(TIUROOT,.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT) Q:'TIUCONT
"RTN","TIUPRPN1",40,0)
 . . . I '+$G(TIUSPG) S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",41,0)
 . Q:'TIUCONT
"RTN","TIUPRPN1",42,0)
 . I $E(IOST)="C" S TIUCONT=$$STOP^TIUPRPN2() Q:'TIUCONT
"RTN","TIUPRPN1",43,0)
 . I +$G(TIUSPG),$E(IOST)'="C" S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",44,0)
 Q
"RTN","TIUPRPN1",45,0)
 ;
"RTN","TIUPRPN1",46,0)
REPORT(TIUROOT,TIUFOOT,TIUMISC,TIUCONT,TIUIDEND) ; Report Text
"RTN","TIUPRPN1",47,0)
 ; Requires array TIUFOOT, vars TIUMISC, TIUCONT
"RTN","TIUPRPN1",48,0)
 ; Requires TIUROOT =
"RTN","TIUPRPN1",49,0)
 ; ^TMP("TIULQ",$J,NOTEIFN) for parent/stand-alone note, or
"RTN","TIUPRPN1",50,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZADD",ADDMIFN) for addendum, or
"RTN","TIUPRPN1",51,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZZID",KIDSEQ#,IDKIDIFN) for ID kid, or
"RTN","TIUPRPN1",52,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZZID",KIDSEQ#,IDKIDIFN,"ZADD",KIDADDMIFN)
"RTN","TIUPRPN1",53,0)
 ;       for ID kid addm.
"RTN","TIUPRPN1",54,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,TIUERR,TIU,TIUI,X,Z,LOC
"RTN","TIUPRPN1",55,0)
 N REFDT,TITLE,ADT,HLOC,SUBJ
"RTN","TIUPRPN1",56,0)
 N TIUDA,TIUCONT1,HASIDKID,HASIDDAD
"RTN","TIUPRPN1",57,0)
 S TIUDA=$P(TIUMISC,U,3),TIUCONT1=0
"RTN","TIUPRPN1",58,0)
 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",59,0)
 S HASIDKID=$G(^TMP("TIULQ",$J,TIUDA,"ZZID",0)) ;how many ID kids
"RTN","TIUPRPN1",60,0)
 S HASIDDAD=$S(TIUROOT["ZZID":1,1:0)
"RTN","TIUPRPN1",61,0)
 I HASIDKID W "<< Interdisciplinary Note - Begin >>",!
"RTN","TIUPRPN1",62,0)
 I HASIDDAD W "<< Interdisciplinary Note - Cont. >>",!
"RTN","TIUPRPN1",63,0)
 W $S('HASIDKID&'HASIDDAD:"NOTE DATED: ",1:"ENTRY DATED: ")
"RTN","TIUPRPN1",64,0)
 S REFDT=@TIUROOT@(1301,"I")
"RTN","TIUPRPN1",65,0)
 W $$DATE^TIULS(REFDT,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN1",66,0)
 S TITLE=@TIUROOT@(.01,"E")
"RTN","TIUPRPN1",67,0)
 W ?30,$$UP^XLFSTR(TITLE),!
"RTN","TIUPRPN1",68,0)
 S LOC=$G(@TIUROOT@(1205,"I"))
"RTN","TIUPRPN1",69,0)
 I +LOC D
"RTN","TIUPRPN1",70,0)
 . W $S($P(^SC(LOC,0),U,3)="W":"ADMITTED: ",1:"VISIT: ")
"RTN","TIUPRPN1",71,0)
 . S ADT=$G(@TIUROOT@(.07,"I"))
"RTN","TIUPRPN1",72,0)
 . W $$DATE^TIULS(ADT,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN1",73,0)
 . S HLOC=$G(@TIUROOT@(1205,"E"))
"RTN","TIUPRPN1",74,0)
 . W " ",HLOC
"RTN","TIUPRPN1",75,0)
 S SUBJ=$G(@TIUROOT@(1701,"E"))
"RTN","TIUPRPN1",76,0)
 I SUBJ]"" W !,"SUBJECT: ",^("E"),!
"RTN","TIUPRPN1",77,0)
 S TIUCONT1=1
"RTN","TIUPRPN1",78,0)
 I $D(@TIUROOT@("PROBLEM")) D  Q:'TIUCONT
"RTN","TIUPRPN1",79,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",80,0)
 . W !,"ASSOCIATED PROBLEMS:"
"RTN","TIUPRPN1",81,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN1",82,0)
 . F  S TIUI=$O(@TIUROOT@("PROBLEM",TIUI)) Q:'TIUI  D  Q:'TIUCONT
"RTN","TIUPRPN1",83,0)
 ..W !,^(TIUI,0)
"RTN","TIUPRPN1",84,0)
 ..S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",85,0)
 W !
"RTN","TIUPRPN1",86,0)
 S TIUI=0,DIWF="WN",DIWL=1,DIWR=79 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",87,0)
 F  S TIUI=$O(@TIUROOT@("TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT  ; D ^DIWW
"RTN","TIUPRPN1",88,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",89,0)
 . S X=@TIUROOT@("TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRPN1",90,0)
 D ^DIWW K ^UTILITY($J,"W")
"RTN","TIUPRPN1",91,0)
 Q:'TIUCONT
"RTN","TIUPRPN1",92,0)
 D GETSIG(TIUROOT,.TIUSIG)
"RTN","TIUPRPN1",93,0)
 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",94,0)
 W !
"RTN","TIUPRPN1",95,0)
 D SIGBLK^TIUPRPN8(.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT,.TIUSIG,TIUROOT)
"RTN","TIUPRPN1",96,0)
 Q:'TIUCONT
"RTN","TIUPRPN1",97,0)
ADDENDA ; Fall through and do Addenda of docmt TIUDA
"RTN","TIUPRPN1",98,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,X,Z,TIUI,TIUADD,ADDMRDT
"RTN","TIUPRPN1",99,0)
 S TIUADD=0,DIWF="WN",DIWL=1,DIWR=79 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",100,0)
 F  S TIUADD=$O(@TIUROOT@("ZADD",TIUADD)) Q:TIUADD'>0  D  Q:'TIUCONT
"RTN","TIUPRPN1",101,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",102,0)
 . S ADDMRDT=@TIUROOT@("ZADD",TIUADD,1301,"I")
"RTN","TIUPRPN1",103,0)
 . W !!,$$DATE^TIULS(ADDMRDT,"MM/DD/CCYY HR:MIN"),?21,"ADDENDUM"
"RTN","TIUPRPN1",104,0)
 . W ?39,"STATUS: ",@TIUROOT@("ZADD",TIUADD,.05,"E") ;P162
"RTN","TIUPRPN1",105,0)
 . S TIUI=0
"RTN","TIUPRPN1",106,0)
 . F  S TIUI=$O(@TIUROOT@("ZADD",TIUADD,"TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT
"RTN","TIUPRPN1",107,0)
 . . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",108,0)
 . . S X=@TIUROOT@("ZADD",TIUADD,"TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRPN1",109,0)
 . D ^DIWW
"RTN","TIUPRPN1",110,0)
 . Q:'TIUCONT
"RTN","TIUPRPN1",111,0)
 . N TIUADRT
"RTN","TIUPRPN1",112,0)
 . S TIUADRT=$P(TIUROOT,")")_",""ZADD"","_TIUADD_")"
"RTN","TIUPRPN1",113,0)
 . D GETSIG(TIUADRT,.TIUSIG)
"RTN","TIUPRPN1",114,0)
 . D SIGBLK^TIUPRPN8(.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT,.TIUSIG,TIUADRT)
"RTN","TIUPRPN1",115,0)
 ; Need ! in front for amended notes:
"RTN","TIUPRPN1",116,0)
 I $G(TIUIDEND) W !,"<< Interdisciplinary Note - End >>",!
"RTN","TIUPRPN1",117,0)
 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",118,0)
 ; Write 2 linefeeds between records
"RTN","TIUPRPN1",119,0)
 W:TIUCONT !!
"RTN","TIUPRPN1",120,0)
 Q
"RTN","TIUPRPN1",121,0)
 ;
"RTN","TIUPRPN1",122,0)
IDKIDS(TIUROOT,TIUFOOT,TIUMISC,TIUCONT1,TIUCONT) ; Print ID kids
"RTN","TIUPRPN1",123,0)
 ;of docmt TIUDA (each kid does its own addenda)
"RTN","TIUPRPN1",124,0)
 N TIUL,KIDDA,TIUDA,TIUSORT,TIUIDRT,TIUIDEND
"RTN","TIUPRPN1",125,0)
 S TIUDA=$P(TIUMISC,U,3),TIUIDEND=0
"RTN","TIUPRPN1",126,0)
 S TIUL=0
"RTN","TIUPRPN1",127,0)
 F  S TIUL=$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL)) Q:'TIUL  D  Q:'TIUCONT
"RTN","TIUPRPN1",128,0)
 . S KIDDA=$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL,0))
"RTN","TIUPRPN1",129,0)
 . S TIUMISC=TIUFLAG_U_TIUPFNBR_U_KIDDA
"RTN","TIUPRPN1",130,0)
 . S TIUIDRT="^TMP(""TIULQ"",$J,"_TIUDA_",""ZZID"","_TIUL_","_KIDDA_")"
"RTN","TIUPRPN1",131,0)
 . I '$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL)) S TIUIDEND=1
"RTN","TIUPRPN1",132,0)
 . D REPORT(TIUIDRT,.TIUFOOT,TIUMISC,.TIUCONT,TIUIDEND)
"RTN","TIUPRPN1",133,0)
 Q
"RTN","TIUPRPN1",134,0)
 ;
"RTN","TIUPRPN1",135,0)
GETSIG(TIUROOT,TIUSIG) ; Get signature info from TIULQ global;
"RTN","TIUPRPN1",136,0)
 ; Set info into TIUSIG array **100**
"RTN","TIUPRPN1",137,0)
 ; Requires array name TIUROOT; passes back array TIUSIG
"RTN","TIUPRPN1",138,0)
 ; TIUROOT = ^TMP("TIULQ",$J,NOTEIFN) for parent note, or
"RTN","TIUPRPN1",139,0)
 ;           ^TMP("TIULQ",$J,NOTEIFN,"ZADD",ADDMIFN) for addendum, or
"RTN","TIUPRPN1",140,0)
 ;           ^TMP("TIULQ",$J,NOTEIFN,"ZZID",IDKIDIFN) for ID kid.
"RTN","TIUPRPN1",141,0)
 ; Signature should be on bottom of form, Addenda on Subsequent pages
"RTN","TIUPRPN1",142,0)
 N TIULINE S $P(TIULINE,"-",81)=""
"RTN","TIUPRPN1",143,0)
 S TIUSIG("AUTHOR")=$G(@TIUROOT@(1202,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",144,0)
 S TIUSIG("EXPSIGNR")=$G(@TIUROOT@(1204,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",145,0)
 S TIUSIG("EXPCOSNR")=$G(@TIUROOT@(1208,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",146,0)
 S TIUSIG("SIGNDATE")=$G(@TIUROOT@(1501,"I"))
"RTN","TIUPRPN1",147,0)
 S TIUSIG("SIGNEDBY")=$G(@TIUROOT@(1502,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",148,0)
 S TIUSIG("SIGNNAME")=$G(@TIUROOT@(1503,"E"))
"RTN","TIUPRPN1",149,0)
 S TIUSIG("SIGTITL")=$G(@TIUROOT@(1504,"E"))
"RTN","TIUPRPN1",150,0)
 S TIUSIG("SIGNMODE")=$G(@TIUROOT@(1505,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",151,0)
 S TIUSIG("COSGDATE")=$G(@TIUROOT@(1507,"I"))
"RTN","TIUPRPN1",152,0)
 S TIUSIG("COSGEDBY")=$G(@TIUROOT@(1508,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",153,0)
 S TIUSIG("COSGNAME")=$G(@TIUROOT@(1509,"E"))
"RTN","TIUPRPN1",154,0)
 S TIUSIG("COSGTITL")=$G(@TIUROOT@(1510,"E"))
"RTN","TIUPRPN1",155,0)
 S TIUSIG("COSGMODE")=$G(@TIUROOT@(1511,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",156,0)
 S TIUSIG("SIGCHRT")=$G(@TIUROOT@(1512,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",157,0)
 S TIUSIG("COSCHRT")=$G(@TIUROOT@(1513,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",158,0)
 Q
"RTN","TIUPRPN1",159,0)
 ;
"RTN","TIUPRPN1",160,0)
SETCONT(TIUFOOT,TIUMISC,TIUCONT1,TIUHEAD,TIUROOT) ;Does footer
"RTN","TIUPRPN1",161,0)
 ;and returns TIUCONT
"RTN","TIUPRPN1",162,0)
 ; Requires array TIUFOOT, vars TIUMISC,TIUCONT1; optional TIUHEAD
"RTN","TIUPRPN1",163,0)
 ; Optional TIUROOT
"RTN","TIUPRPN1",164,0)
 Q $$FOOTER^TIUPRPN2(.TIUFOOT,TIUMISC,TIUCONT1,TIUHEAD,$G(TIUROOT))
"RTN","TIUSRVR2")
0^4^B30785703
"RTN","TIUSRVR2",1,0)
TIUSRVR2 ; SLC/JER - RPC for record-wise GET ; 4/14/03
"RTN","TIUSRVR2",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,109,162**;Jun 20, 1997
"RTN","TIUSRVR2",3,0)
 ; 4/12/01 Moved signature modules to new rtn TIUSRVR3
"RTN","TIUSRVR2",4,0)
LOADREC(TIUDA,TIUL,TIUGDATA,TIUGWHOL,ACTION) ; Load ^TMP
"RTN","TIUSRVR2",5,0)
 ;Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUSRVR2",6,0)
 ;optional TIUGWHOL = 1 if we're mid-load for browse, and we're already
"RTN","TIUSRVR2",7,0)
 ;                    loading the whole note after the original entry,
"RTN","TIUSRVR2",8,0)
 ;                    so DON'T load the whole note again.
"RTN","TIUSRVR2",9,0)
 N TIUKID,TIUDADT,TIUI,CANSEE
"RTN","TIUSRVR2",10,0)
 N TIUPARNT,TIUPNAME,TIUPDATE
"RTN","TIUSRVR2",11,0)
 N TIUGPRNT,TIUGPNM,TIUGPDT,TIUPDATA,TIUHASKD
"RTN","TIUSRVR2",12,0)
 S ACTION=$G(ACTION,"VIEW")
"RTN","TIUSRVR2",13,0)
 ; ---- If user cannot view, say so and quit: ----
"RTN","TIUSRVR2",14,0)
 ;      TIU*1*100
"RTN","TIUSRVR2",15,0)
 S CANSEE=$S(+$$ISCOMP^TIUSRVR1(TIUDA)>0:1,1:$$CANDO^TIULP(+TIUDA,ACTION))
"RTN","TIUSRVR2",16,0)
 I +CANSEE'>0 D  Q
"RTN","TIUSRVR2",17,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P(CANSEE,U,2)
"RTN","TIUSRVR2",18,0)
 ; ---- Load text of TIUDA: ----
"RTN","TIUSRVR2",19,0)
 S TIUI=0
"RTN","TIUSRVR2",20,0)
 F  S TIUI=$O(^TIU(8925,+TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVR2",21,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(^TIU(8925,+TIUDA,"TEXT",+TIUI,0))
"RTN","TIUSRVR2",22,0)
 ; ---- if TIUDA is a COMPONENT, QUIT
"RTN","TIUSRVR2",23,0)
 Q:+$$ISCOMP^TIUSRVR1(TIUDA)
"RTN","TIUSRVR2",24,0)
 ; ---- If TIUDA **IS** an addendum, load addm signature,
"RTN","TIUSRVR2",25,0)
 ;         load original document, quit: ----
"RTN","TIUSRVR2",26,0)
 I +$$ISADDNDM^TIULC1(+TIUDA) D  Q
"RTN","TIUSRVR2",27,0)
 . N TIULINE,TIUPARNT S $P(TIULINE,"=",79)=""
"RTN","TIUSRVR2",28,0)
 . D LOADSIG^TIUSRVR3(TIUDA,.TIUL)
"RTN","TIUSRVR2",29,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",30,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIULINE
"RTN","TIUSRVR2",31,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",32,0)
 . S TIUPARNT=+$P(^TIU(8925,+TIUDA,0),U,6)
"RTN","TIUSRVR2",33,0)
 . S TIUPNAME=$$PNAME^TIULC1(+^TIU(8925,TIUPARNT,0))
"RTN","TIUSRVR2",34,0)
 . S TIUPDATE=+$G(^TIU(8925,TIUPARNT,13))
"RTN","TIUSRVR2",35,0)
 . S TIUPDATE=$$DATE^TIULS(TIUPDATE,"MM/DD/YY")
"RTN","TIUSRVR2",36,0)
 . S TIUPDATA=$$IDDATA^TIURECL1(TIUPARNT)
"RTN","TIUSRVR2",37,0)
 . S TIUHASKD=$P(TIUPDATA,U,2),TIUGPRNT=+$P(TIUPDATA,U,3)
"RTN","TIUSRVR2",38,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",39,0)
 . I TIUHASKD D
"RTN","TIUSRVR2",40,0)
 . . S @TIUARR@(TIUL)=" --- Original Addended Interdisciplinary Entry ---"
"RTN","TIUSRVR2",41,0)
 . I TIUGPRNT D
"RTN","TIUSRVR2",42,0)
 . . S @TIUARR@(TIUL)=" --- Original Addended Interdisciplinary Entry ---"
"RTN","TIUSRVR2",43,0)
 . . S TIUGPNM=$$PNAME^TIULC1(+^TIU(8925,TIUGPRNT,0))
"RTN","TIUSRVR2",44,0)
 . . S TIUGPDT=+$G(^TIU(8925,TIUGPRNT,13))
"RTN","TIUSRVR2",45,0)
 . . S TIUGPDT=$$DATE^TIULS(TIUGPDT,"MM/DD/YY")
"RTN","TIUSRVR2",46,0)
 . I 'TIUHASKD,'TIUGPRNT S @TIUARR@(TIUL)=" --- Original Document ---"
"RTN","TIUSRVR2",47,0)
 . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",48,0)
 . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",49,0)
 . I TIUHASKD D
"RTN","TIUSRVR2",50,0)
 . . S @TIUARR@(TIUL)="                    << Addended Interdisciplinary Entry >>"
"RTN","TIUSRVR2",51,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",52,0)
 . . S @TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",53,0)
 . I TIUGPRNT D
"RTN","TIUSRVR2",54,0)
 . . S @TIUARR@(TIUL)="                         << Interdisciplinary Note >>"
"RTN","TIUSRVR2",55,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",56,0)
 . . S @TIUARR@(TIUL)=TIUGPDT_" "_TIUGPNM
"RTN","TIUSRVR2",57,0)
 . . S TIUL=+$G(TIUL)+1
"RTN","TIUSRVR2",58,0)
 . . S @TIUARR@(TIUL)="                    << Addended Interdisciplinary Entry >>"
"RTN","TIUSRVR2",59,0)
 . . S TIUL=+$G(TIUL)+1,@TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",60,0)
 . I 'TIUHASKD,'TIUGPRNT D
"RTN","TIUSRVR2",61,0)
 . . S @TIUARR@(TIUL)=TIUPDATE_" "_TIUPNAME_":"
"RTN","TIUSRVR2",62,0)
 . D LOADREC(TIUPARNT,.TIUL,TIUGDATA)
"RTN","TIUSRVR2",63,0)
 ; ---- Load components of TIUDA: ----
"RTN","TIUSRVR2",64,0)
 S TIUKID=0
"RTN","TIUSRVR2",65,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVR2",66,0)
 . I +$$ISADDNDM^TIULC1(TIUKID)'>0 D LOADREC(TIUKID,.TIUL,$G(TIUGDATA))
"RTN","TIUSRVR2",67,0)
 ; ---- Load signature of TIUDA if TIUDA is not addm
"RTN","TIUSRVR2",68,0)
 ;           or comp: ----
"RTN","TIUSRVR2",69,0)
 I '$$ISCOMP^TIUSRVR1(TIUDA) D LOADSIG^TIUSRVR3(TIUDA,.TIUL)
"RTN","TIUSRVR2",70,0)
 ; ---- Load addenda of TIUDA: ----
"RTN","TIUSRVR2",71,0)
 S TIUKID=0
"RTN","TIUSRVR2",72,0)
 F  S TIUKID=$O(^TIU(8925,"DAD",+TIUDA,TIUKID)) Q:+TIUKID'>0  D
"RTN","TIUSRVR2",73,0)
 . ; If acting on an addendum, don't show it again.
"RTN","TIUSRVR2",74,0)
 . I +TIUKID=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUSRVR2",75,0)
 . I +$$ISADDNDM^TIULC1(TIUKID) D LOADADD(TIUKID,.TIUL)
"RTN","TIUSRVR2",76,0)
 N IDDAD
"RTN","TIUSRVR2",77,0)
 S IDDAD=+$P(TIUGDATA,U,3)
"RTN","TIUSRVR2",78,0)
 ; ---- If Browsed Record is an ID Note, & this cycle has
"RTN","TIUSRVR2",79,0)
 ;      just loaded the parent entry, then load ID kids
"RTN","TIUSRVR2",80,0)
 ;      and quit: **100** ----
"RTN","TIUSRVR2",81,0)
 I $P(TIUGDATA,U,2),TIUDA=+TIUGDATA D LOADKIDS(TIUDA,.TIUL,TIUGDATA) Q
"RTN","TIUSRVR2",82,0)
 ; ---- If Browsed Record is an ID Entry, & this cycle hasn't begun
"RTN","TIUSRVR2",83,0)
 ;      loading the whole note, then load the whole ID Note after
"RTN","TIUSRVR2",84,0)
 ;      the browsed entry and quit: ----
"RTN","TIUSRVR2",85,0)
 I IDDAD,'$G(TIUGWHOL) D  Q
"RTN","TIUSRVR2",86,0)
 . S TIUGWHOL=1
"RTN","TIUSRVR2",87,0)
 . N TIULINE S $P(TIULINE,"=",79)=""
"RTN","TIUSRVR2",88,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",89,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=TIULINE
"RTN","TIUSRVR2",90,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",91,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=" --- Interdisciplinary Note ---"
"RTN","TIUSRVR2",92,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",93,0)
 . D LOADID(IDDAD,.TIUL,TIUGDATA,TIUGWHOL)
"RTN","TIUSRVR2",94,0)
 ; ---- If Browsed Record is an ID Entry, & this cycle has begun
"RTN","TIUSRVR2",95,0)
 ;      loading the whole ID note, and is currently loading the first
"RTN","TIUSRVR2",96,0)
 ;      entry of the whole note, then load kids and quit: ----
"RTN","TIUSRVR2",97,0)
 I IDDAD,$G(TIUGWHOL),TIUDA=IDDAD D LOADKIDS(TIUDA,.TIUL,TIUGDATA,TIUGWHOL) K TIUGWHOL
"RTN","TIUSRVR2",98,0)
 Q
"RTN","TIUSRVR2",99,0)
 ;
"RTN","TIUSRVR2",100,0)
LOADKIDS(TIUDA,TIUL,TIUGDATA,TIUGWHOL) ; Load ID kids of TIUDA
"RTN","TIUSRVR2",101,0)
 ; Requires TIUDA, array TIUL, TIUGDATA
"RTN","TIUSRVR2",102,0)
 N TIUK,PRMSORT,KIDDA,TIUD0,TIUD21
"RTN","TIUSRVR2",103,0)
 I $G(^TMP("TIUR",$J,"IDDATA",TIUDA)) S PRMSORT=$P(^TMP("TIUR",$J,"IDDATA",TIUDA),U,4)
"RTN","TIUSRVR2",104,0)
 E  S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD21=$G(^TIU(8925,TIUDA,21)),PRMSORT=$P($$IDDATA^TIURECL1(TIUDA,TIUD0,TIUD21),U,4)
"RTN","TIUSRVR2",105,0)
 D GETIDKID^TIURECL2(TIUDA,PRMSORT) ; sets array ^TMP("TIUIDKID",$J,
"RTN","TIUSRVR2",106,0)
 S TIUK=0
"RTN","TIUSRVR2",107,0)
 F  S TIUK=$O(^TMP("TIUIDKID",$J,TIUDA,TIUK)) Q:+TIUK'>0  D
"RTN","TIUSRVR2",108,0)
 . S KIDDA=^TMP("TIUIDKID",$J,TIUDA,TIUK)
"RTN","TIUSRVR2",109,0)
 . D LOADID(KIDDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUSRVR2",110,0)
 K ^TMP("TIUIDKID",$J)
"RTN","TIUSRVR2",111,0)
 Q
"RTN","TIUSRVR2",112,0)
 ;
"RTN","TIUSRVR2",113,0)
LOADID(TIUDA,TIUL,TIUGDATA,TIUWHOL) ; Load ID note for browse
"RTN","TIUSRVR2",114,0)
 N TIUREC,TIU
"RTN","TIUSRVR2",115,0)
 I '$D(^TIU(8925,+TIUDA,0)) Q
"RTN","TIUSRVR2",116,0)
 ; ---- If ID Kid has focus, don't show it again ----
"RTN","TIUSRVR2",117,0)
 ; I TIUDA=+$G(^TMP("TIU FOCUS",$J)) Q
"RTN","TIUSRVR2",118,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",119,0)
 D GETTIU^TIULD(.TIU,+TIUDA)
"RTN","TIUSRVR2",120,0)
 D INQUIRE(TIUDA,.TIUREC)
"RTN","TIUSRVR2",121,0)
 ; ---- Load info missing from header since this is ID note entry: ----
"RTN","TIUSRVR2",122,0)
 ; ---- Load dictation, transcription data, etc.: ----
"RTN","TIUSRVR2",123,0)
 D LOADTOP^TIUSRVR1(.TIUREC,TIUDA,.TIUL,$G(TIUGDATA))
"RTN","TIUSRVR2",124,0)
 ; ---- Load the remainder of the record: ----
"RTN","TIUSRVR2",125,0)
 D LOADREC(TIUDA,.TIUL,$G(TIUGDATA),$G(TIUWHOL))
"RTN","TIUSRVR2",126,0)
 Q
"RTN","TIUSRVR2",127,0)
 ;
"RTN","TIUSRVR2",128,0)
INQUIRE(TIUDA,TIUREC,TIUCPF) ; Inquire to document TIUDA and set TIUREC
"RTN","TIUSRVR2",129,0)
 N DA,DIC,DIQ,DR
"RTN","TIUSRVR2",130,0)
 S DA=TIUDA,DIC=8925,DIQ="TIUREC("
"RTN","TIUSRVR2",131,0)
 S DR=".01;.02;.05;.09;1201;1202;1208;1209;1301;1307;1501;1502;1505;1506"
"RTN","TIUSRVR2",132,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRVR2",133,0)
 ;Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRVR2",134,0)
 I $G(TIUCPF) S DR=DR_";70201;70202"
"RTN","TIUSRVR2",135,0)
 D EN^DIQ1
"RTN","TIUSRVR2",136,0)
 Q
"RTN","TIUSRVR2",137,0)
LOADADD(TIUDADD,TIUL) ; Load addenda
"RTN","TIUSRVR2",138,0)
 N TIUDAUTH,TIUDATT,TIUJ,TIUSIG,TIUCSIG,TIUVIEW
"RTN","TIUSRVR2",139,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=""
"RTN","TIUSRVR2",140,0)
 S TIUDADT=$$DATE^TIULS($P($G(^TIU(8925,+TIUDADD,13)),U),"MM/DD/CCYY")
"RTN","TIUSRVR2",141,0)
 S TIUL=TIUL+1,@TIUARR@(TIUL)=TIUDADT_" ADDENDUM"_"                      STATUS: "_$$STATUS^TIULF(TIUDADD) ;P162
"RTN","TIUSRVR2",142,0)
 S TIUVIEW=$$CANDO^TIULP(+TIUDADD,"VIEW")
"RTN","TIUSRVR2",143,0)
 I '+TIUVIEW D  Q
"RTN","TIUSRVR2",144,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$P(TIUVIEW,U,2)
"RTN","TIUSRVR2",145,0)
 S TIUJ=0
"RTN","TIUSRVR2",146,0)
 F  S TIUJ=$O(^TIU(8925,+TIUDADD,"TEXT",TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUSRVR2",147,0)
 . S TIUL=TIUL+1,@TIUARR@(TIUL)=$G(^TIU(8925,+TIUDADD,"TEXT",TIUJ,0))
"RTN","TIUSRVR2",148,0)
 D LOADSIG^TIUSRVR3(TIUDADD,.TIUL)
"RTN","TIUSRVR2",149,0)
 Q
"VER")
8.0^22.0
**END**
**END**
