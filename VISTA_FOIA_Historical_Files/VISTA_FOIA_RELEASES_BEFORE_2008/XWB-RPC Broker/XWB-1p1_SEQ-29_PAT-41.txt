$TXT Created by MENDOZA,RAUL at PAT-XWB.FO-OAKLAND.MED.VA.GOV  (KIDS) on Tuesday, 04/27/04 at 13:06
=============================================================================
Run Date: APR 27, 2004                     Designation: XWB*1.1*41
Package : XWB - RPC BROKER                    Priority: Mandatory
Version : 1.1        SEQ #29                    Status: Released
                  Compliance Date: MAY 28, 2004
=============================================================================


Subject: M2M Infinite Loop

Category: 
  - Routine

Description:
============

 There are two fixes included in this patch:
  
 1)  The server-side code of the M2M Broker was not using the error 
 trapping correctly.  The special variable $ETRAP is NEWed when it should 
 not be (in routine XWBVLL).  As a result the error logger can get into an
 infinite loop.  The error is caused when the socket between the client and
 the server gets "broken".  To resolve this issue $ETRAP is removed from 
 the list of NEWed variables in this instance.
  
 2) A new TCP/IP entry point to start the M2M listener on a Cache/VMS 
 system in now available.  The entry point is CACHEVMS^XWBVLL.  This entry 
 should replace the entry point "UCX^XWBVLL" in the VMS-command file 
 (refer to patch XWB*1.1*28 for more information on the VMS-command file 
 and TCP/IP service to support the M2M listener).  
  
 For Cache/VMS sites:     
 $ccontrol session "<configname>" "-U" "<namespace>" "CACHEVMS^XWBVLL"
  
 Notice above, that "configname" is the name of the configuration in the 
 Configuration manager that you start from the Cache cube.  It is 
 recommended to enclose configname with double quotes (").  For example: 
 $ccontrol session "ISFVA1" "-U" "VAH" "CACHEVMS^XWBVLL"
  
 There are various ways to accomplish this for multiple nodes in a 
 cluster, depending on how your site is set up.  Here are two 
 possibilities:
 a.  You can have different .com files for each node with each file 
 containing its specific configname.
  
 b.  Write some code so you can use the same .com file for all nodes.  For 
 example: 
 $ NODE=F$EDIT(F$GETSYI("SCSNODE"),"COLLAPSE,TRIM")
 $ assign  'f$trnlnm("SYS$NET")' SYS$NET
 $ ccontrol session "''NODE'" "-U" "VAH" "CACHEVMS^XWBVLL"
  
 Note:  The NODE is enclosed with a double quotes ("), two single quotes 
 (') then ending with one single quote (') and a double quote (").
  
 This is assuming that the namespace is standard in the production nodes.  
 For test nodes that have a different namespace, it is recommended to use 
 it's own .com file.  
  
  
 Patch Tracking #: #37876991
  
  
 Documentation for M-to-M Broker update, Patch XWB*1.1*41, is provided in 
 this patch description. In addition to this, the complete documentation 
 supplement for the M-to-M Broker, Patch XWB*1.1*28, can be found in the 
 VistA Anonymous directories and on the VistA Documentation Library (VDL) 
 in the following two formats:
  
     XWB1_1P28SP.PDF                    XWB1_1P28SP.DOC
  
 The preferred retrieval method to download the documentation for Patch 
 XWB*1.1*28 is to FTP from the ANONYMOUS.SOFTWARE directory at: 
  
    DOWNLOAD.VISTA.MED.VA.GOV.
  
 This transmits the file from the first available FTP server. Sites may 
 also elect to retrieve software directly from one of the following 
 servers.
    
    OI Field Office         FTP Address                  Directory
    ------------------------------------------------------------------
    Albany             ftp.fo-albany.med.va.gov     ANONYMOUS.SOFTWARE
    Hines              ftp.fo-hines.med.va.gov      ANONYMOUS.SOFTWARE
    Salt Lake City     ftp.fo-slc.med.va.gov        ANONYMOUS.SOFTWARE
    
  Note:  These files must be transferred in binary or IMAGE, not
         ASCII, mode.  The VistA Documentation Library (VDL) contains
         all end-user manuals.
  
 The Web address for the VistA Documentation Library (VDL), where you can 
 also obtain the documentation for M-to-M Broker, Patch XWB*1.1*28, is as 
 follows:
  
    http://www.va.gov/vdl/Infrastructure.asp?appID=128
  
  
  
  
 List of Test Sites
 ==================
 VISTA Imaging System Team, Washington Office of Information Field Office 
 (OIFO)
  
 Routine Summary
 The following routines are included in this patch.  The second line of 
 each of these routines now looks like:
  ;;1.1;RPC BROKER;**[Patch List]**;Mar 28, 1997
  
 Checksums:
 Sites should use CHECK^XTSUMBLD to verify checksums
  
 Routine Name    Before Patch    After Patch    Patch List
 ============    ============    ===========    ==========
 XWBVLL          3018372         3252550        28,41
  
  
 Installation Instructions
 =========================
 >>>Users may remain on the system.
 >>>TaskMan does *not* need to be stopped.
  
    1.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
        option will load the KIDS package onto your system.
  
    2.  DSM sites - These routines should not be in any mapping.
  
    3.  The patch has now been loaded into a Transport global on your
        system. Now you need to use KIDS to install the Transport global.
        On the KIDS menu, under the 'Installation' menu, use the following
        options:
  
           Verify Checksums in Transport Global
           Print Transport Global
           Compare Transport Global to Current System
           Backup a Transport Global
                  
    4.  Users can remain on the system. This patch can be loaded any
        non-peak time.
        TaskMan can remain running.
  
    5.  Installation will take less than 2 minutes.
        On the KIDS menu, under the 'Installation' menu, use the following
        option:
         Install Package(s)  'XWB*1.1*41'
                              ==========
  
        Want KIDS to Rebuild Menu Trees Upon Completion of Install? YES//NO
        Want KIDS to INHIBIT LOGONs during the install? YES// NO
        Want to DISABLE Scheduled Options, Menu Options, and Protocols? NO
  
    6.  For Cache/VMS sites ONLY - Update the VMS command file with this 
        new entry for Cache/VMS. The following should be all on one line:  
        $ccontrol session <configname> "-U" "<namespace>" "CACHEVMS^XWBVLL"

Routine Information:
====================

Routine Name:
  - XWBVLL


Routine Checksum:

=============================================================================
User Information:
Entered By  : MENDOZA,RAUL E.               Date Entered  : FEB 10, 2004
Completed By: SINGH,GURBIR                  Date Completed: APR 27, 2004
Released By : PALMER,MICHAEL                Date Released : APR 27, 2004
=============================================================================


Packman Mail Message:
=====================

$END TXT
