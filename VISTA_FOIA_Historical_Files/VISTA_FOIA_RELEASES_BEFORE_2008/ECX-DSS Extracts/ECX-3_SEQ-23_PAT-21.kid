Released ECX*3*21 SEQ #23
Extracted from mail message
**KIDS**:ECX*3.0*21^

**INSTALL NAME**
ECX*3.0*21
"BLD",1802,0)
ECX*3.0*21^DSS EXTRACTS^0^2990504^y
"BLD",1802,4,0)
^9.64PA^^
"BLD",1802,"INIT")
ECX321PT
"BLD",1802,"KRN",0)
^9.67PA^19^18
"BLD",1802,"KRN",.4,0)
.4
"BLD",1802,"KRN",.4,"NM",0)
^9.68A^^
"BLD",1802,"KRN",.401,0)
.401
"BLD",1802,"KRN",.402,0)
.402
"BLD",1802,"KRN",.403,0)
.403
"BLD",1802,"KRN",.5,0)
.5
"BLD",1802,"KRN",.84,0)
.84
"BLD",1802,"KRN",3.6,0)
3.6
"BLD",1802,"KRN",3.8,0)
3.8
"BLD",1802,"KRN",9.2,0)
9.2
"BLD",1802,"KRN",9.8,0)
9.8
"BLD",1802,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",1802,"KRN",9.8,"NM",1,0)
ECXAPRO^^0^B43185996
"BLD",1802,"KRN",9.8,"NM",2,0)
ECXAPRO1^^0^B14438659
"BLD",1802,"KRN",9.8,"NM",3,0)
ECXAPRO2^^0^B19152837
"BLD",1802,"KRN",9.8,"NM",4,0)
ECXAPRO3^^0^B11552568
"BLD",1802,"KRN",9.8,"NM",5,0)
ECXCPRO^^0^B31486510
"BLD",1802,"KRN",9.8,"NM",6,0)
ECXCPRO1^^0^B12622997
"BLD",1802,"KRN",9.8,"NM",7,0)
ECXKILL^^0^B12786818
"BLD",1802,"KRN",9.8,"NM",8,0)
ECXLPRO^^0^B25353447
"BLD",1802,"KRN",9.8,"NM",9,0)
ECXLPRO1^^0^B8521926
"BLD",1802,"KRN",9.8,"NM",10,0)
ECX321PT^^0^B78502161
"BLD",1802,"KRN",9.8,"NM",11,0)
ECXPRO^^0^B16794443
"BLD",1802,"KRN",9.8,"NM",12,0)
ECXPRO1^^0^B30600871
"BLD",1802,"KRN",9.8,"NM",13,0)
ECXPRO2^^0^B11746664
"BLD",1802,"KRN",9.8,"NM","B","ECX321PT",10)

"BLD",1802,"KRN",9.8,"NM","B","ECXAPRO",1)

"BLD",1802,"KRN",9.8,"NM","B","ECXAPRO1",2)

"BLD",1802,"KRN",9.8,"NM","B","ECXAPRO2",3)

"BLD",1802,"KRN",9.8,"NM","B","ECXAPRO3",4)

"BLD",1802,"KRN",9.8,"NM","B","ECXCPRO",5)

"BLD",1802,"KRN",9.8,"NM","B","ECXCPRO1",6)

"BLD",1802,"KRN",9.8,"NM","B","ECXKILL",7)

"BLD",1802,"KRN",9.8,"NM","B","ECXLPRO",8)

"BLD",1802,"KRN",9.8,"NM","B","ECXLPRO1",9)

"BLD",1802,"KRN",9.8,"NM","B","ECXPRO",11)

"BLD",1802,"KRN",9.8,"NM","B","ECXPRO1",12)

"BLD",1802,"KRN",9.8,"NM","B","ECXPRO2",13)

"BLD",1802,"KRN",19,0)
19
"BLD",1802,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",1802,"KRN",19,"NM",1,0)
ECX PRO SOURCE AUDIT^^0
"BLD",1802,"KRN",19,"NM",2,0)
ECX MAINTENANCE^^2
"BLD",1802,"KRN",19,"NM",3,0)
ECX PRO YTD REPORT^^0
"BLD",1802,"KRN",19,"NM",4,0)
ECX PRO LAB REPORT^^0
"BLD",1802,"KRN",19,"NM","B","ECX MAINTENANCE",2)

"BLD",1802,"KRN",19,"NM","B","ECX PRO LAB REPORT",4)

"BLD",1802,"KRN",19,"NM","B","ECX PRO SOURCE AUDIT",1)

"BLD",1802,"KRN",19,"NM","B","ECX PRO YTD REPORT",3)

"BLD",1802,"KRN",19.1,0)
19.1
"BLD",1802,"KRN",101,0)
101
"BLD",1802,"KRN",409.61,0)
409.61
"BLD",1802,"KRN",771,0)
771
"BLD",1802,"KRN",869.2,0)
869.2
"BLD",1802,"KRN",870,0)
870
"BLD",1802,"KRN",8994,0)
8994
"BLD",1802,"KRN","B",.4,.4)

"BLD",1802,"KRN","B",.401,.401)

"BLD",1802,"KRN","B",.402,.402)

"BLD",1802,"KRN","B",.403,.403)

"BLD",1802,"KRN","B",.5,.5)

"BLD",1802,"KRN","B",.84,.84)

"BLD",1802,"KRN","B",3.6,3.6)

"BLD",1802,"KRN","B",3.8,3.8)

"BLD",1802,"KRN","B",9.2,9.2)

"BLD",1802,"KRN","B",9.8,9.8)

"BLD",1802,"KRN","B",19,19)

"BLD",1802,"KRN","B",19.1,19.1)

"BLD",1802,"KRN","B",101,101)

"BLD",1802,"KRN","B",409.61,409.61)

"BLD",1802,"KRN","B",771,771)

"BLD",1802,"KRN","B",869.2,869.2)

"BLD",1802,"KRN","B",870,870)

"BLD",1802,"KRN","B",8994,8994)

"BLD",1802,"QUES",0)
^9.62^^
"BLD",1802,"REQB",0)
^9.611^3^2
"BLD",1802,"REQB",2,0)
ECX*3.0*8^2
"BLD",1802,"REQB",3,0)
ECX*3.0*15^2
"BLD",1802,"REQB","B","ECX*3.0*15",3)

"BLD",1802,"REQB","B","ECX*3.0*8",2)

"INIT")
ECX321PT
"KRN",19,10161,-1)
2^2
"KRN",19,10161,0)
ECX MAINTENANCE^Maintenance^^M^11714^ECXMGR^^^^^^513
"KRN",19,10161,10,0)
^19.01PI^11^11
"KRN",19,10161,10,10,0)
11176^9^50
"KRN",19,10161,10,10,"^")
ECX PRO YTD REPORT
"KRN",19,10161,10,11,0)
11237^10^55
"KRN",19,10161,10,11,"^")
ECX PRO LAB REPORT
"KRN",19,10161,"U")
MAINTENANCE
"KRN",19,10855,-1)
0^1
"KRN",19,10855,0)
ECX PRO SOURCE AUDIT^Prosthetics (PRO) Extract Audit^^R^^^^^^^^DSS EXTRACTS
"KRN",19,10855,1,0)
^^2^2^2980715^
"KRN",19,10855,1,1,0)
This option will generate an audit report of the prosthetics information
"KRN",19,10855,1,2,0)
that has been extracted.
"KRN",19,10855,10.1)
PRO Extract Audit
"KRN",19,10855,25)
EN^ECXAPRO
"KRN",19,10855,"U")
PROSTHETICS (PRO) EXTRACT AUDI
"KRN",19,11176,-1)
0^3
"KRN",19,11176,0)
ECX PRO YTD REPORT^Prosthetics (PRO) YTD HCPCS Report^^R^^^^^^^^DSS EXTRACTS
"KRN",19,11176,1,0)
^^11^11^2990303^^
"KRN",19,11176,1,1,0)
This report option will list PRO extract data by HCPCS code.  Data is
"KRN",19,11176,1,2,0)
accumulated from all extract records for extracts dated within the
"KRN",19,11176,1,3,0)
beginning and end of a fiscal year.  
"KRN",19,11176,1,4,0)
 
"KRN",19,11176,1,5,0)
If the site is non-divisional, data is reported under the facility
"KRN",19,11176,1,6,0)
Station Number.
"KRN",19,11176,1,7,0)
 
"KRN",19,11176,1,8,0)
If the site is multi-divisional (for Prosthetics), data can be
"KRN",19,11176,1,9,0)
reported for any one division, or for all divisions belonging to
"KRN",19,11176,1,10,0)
the same primary station/division.  If data is from all divisions, 
"KRN",19,11176,1,11,0)
then data is reported under the Station Number of the Primary Division.
"KRN",19,11176,10.1)
PRO YTD Report
"KRN",19,11176,25)
EN^ECXCPRO
"KRN",19,11176,"U")
PROSTHETICS (PRO) YTD HCPCS RE
"KRN",19,11237,-1)
0^4
"KRN",19,11237,0)
ECX PRO LAB REPORT^Prosthetics (PRO) YTD Laboratory Report^^R^^^^^^^^
"KRN",19,11237,1,0)
^^10^10^2990324^^^
"KRN",19,11237,1,1,0)
This report option will list PRO extract data by HCPCS code for items 
"KRN",19,11237,1,2,0)
produced within the Prosthetics laboratories of the facilty.  Data is
"KRN",19,11237,1,3,0)
accumulated from all extract records for extracts dated within the 
"KRN",19,11237,1,4,0)
beginning and end of a fiscal year.  
"KRN",19,11237,1,5,0)
  
"KRN",19,11237,1,6,0)
If the site is non-divisional, data is reported under the facility Station
"KRN",19,11237,1,7,0)
Number.
"KRN",19,11237,1,8,0)
  
"KRN",19,11237,1,9,0)
If the site is multi-divisional (for Prosthetics), data is reported for
"KRN",19,11237,1,10,0)
for all divisions belonging to the same primary station/division.
"KRN",19,11237,25)
EN^ECXLPRO
"KRN",19,11237,"U")
PROSTHETICS (PRO) YTD LABORATO
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",513,-1)
1^1
"PKG",513,0)
DSS EXTRACTS^ECX^Decision Support System. (DSS)
"PKG",513,20,0)
^9.402P^^
"PKG",513,22,0)
^9.49I^1^1
"PKG",513,22,1,0)
3.0^2971222^2980112^11714
"PKG",513,22,1,"PAH",1,0)
21^2990504^11724
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","ECX321PT")
0^10^B78502161
"RTN","ECX321PT",1,0)
ECX321PT ;ALB/JAP - PATCH ECX*3*21 Post-Install ; February 26, 1999
"RTN","ECX321PT",2,0)
 ;;3.0;DSS EXTRACTS;**21**;Dec 22, 1997
"RTN","ECX321PT",3,0)
 ;
"RTN","ECX321PT",4,0)
POST ;Entry point
"RTN","ECX321PT",5,0)
 ;place PRO audit report option back in service
"RTN","ECX321PT",6,0)
 N A,DIC,DIE,DA,DR,X,Y,IENS,ECX,ECXX
"RTN","ECX321PT",7,0)
 K ^TMP($J,"WP")
"RTN","ECX321PT",8,0)
 D MES^XPDUTL(" ")
"RTN","ECX321PT",9,0)
 D MES^XPDUTL(" ")
"RTN","ECX321PT",10,0)
 D MES^XPDUTL("Removing 'Out of order' flag from")
"RTN","ECX321PT",11,0)
 D MES^XPDUTL("[ECX PRO SOURCE AUDIT] option.")
"RTN","ECX321PT",12,0)
 D MES^XPDUTL(" ")
"RTN","ECX321PT",13,0)
 S DIC="^DIC(19,",DIC(0)="X",X="ECX PRO SOURCE AUDIT"
"RTN","ECX321PT",14,0)
 D ^DIC
"RTN","ECX321PT",15,0)
 Q:Y=-1
"RTN","ECX321PT",16,0)
 S A="",DA=+Y,DIE=DIC,DR="2///@"
"RTN","ECX321PT",17,0)
 D ^DIE
"RTN","ECX321PT",18,0)
 ;update audit description in PRO extract definition record
"RTN","ECX321PT",19,0)
 K Y S DIC="^ECX(727.1,",DIC(0)="X",X="PROSTHETICS"
"RTN","ECX321PT",20,0)
 D ^DIC
"RTN","ECX321PT",21,0)
 I Y=-1 D  Q
"RTN","ECX321PT",22,0)
 .D MES^XPDUTL(" ")
"RTN","ECX321PT",23,0)
 .D MES^XPDUTL(" ")
"RTN","ECX321PT",24,0)
 .D MES^XPDUTL("Can't find PROSTHETICS in EXTRACT DEFINITIONS file")
"RTN","ECX321PT",25,0)
 .D MES^XPDUTL("(#727.1) -- AUDIT DESCRIPTION not updated.")
"RTN","ECX321PT",26,0)
 .D MES^XPDUTL(" ")
"RTN","ECX321PT",27,0)
 .D MES^XPDUTL(" ")
"RTN","ECX321PT",28,0)
 F ECX=1:1 S ECXX=$P($T(TEXT+ECX),";;",2) Q:ECXX="QUIT"  S ^TMP($J,"WP",ECX,0)=ECXX
"RTN","ECX321PT",29,0)
 S IENS=+Y_","
"RTN","ECX321PT",30,0)
 D WP^DIE(727.1,IENS,10,"","^TMP($J,""WP"")","ERR")
"RTN","ECX321PT",31,0)
 D MES^XPDUTL(" ")
"RTN","ECX321PT",32,0)
 D MES^XPDUTL(" ")
"RTN","ECX321PT",33,0)
 D MES^XPDUTL("PROSTHETICS record in EXTRACT DEFINITIONS file")
"RTN","ECX321PT",34,0)
 D MES^XPDUTL("(#727.1) has been successfully updated.")
"RTN","ECX321PT",35,0)
 D MES^XPDUTL(" ")
"RTN","ECX321PT",36,0)
 D MES^XPDUTL(" ")
"RTN","ECX321PT",37,0)
 K ^TMP($J,"WP")
"RTN","ECX321PT",38,0)
 Q
"RTN","ECX321PT",39,0)
 ;
"RTN","ECX321PT",40,0)
TEXT ;
"RTN","ECX321PT",41,0)
 ;; The following PROSTHETICS package options may be used to verify the PRO
"RTN","ECX321PT",42,0)
 ;; extract audit report.
"RTN","ECX321PT",43,0)
 ;;  
"RTN","ECX321PT",44,0)
 ;; RMPR NPPD PRT          Print NPPD Worksheets
"RTN","ECX321PT",45,0)
 ;; RMPR NPPD PRL L        Print NPPD Single Line Detail
"RTN","ECX321PT",46,0)
 ;;   
"RTN","ECX321PT",47,0)
 ;; Please note, however, that these Prosthetics package options organize
"RTN","ECX321PT",48,0)
 ;; and display data by the ENTRY DATE field (#.01) of the Prosthetics 
"RTN","ECX321PT",49,0)
 ;; items in its RECORD OF PROS APPLIANCE/REPAIR file (#660).  The PRO
"RTN","ECX321PT",50,0)
 ;; extract record does not use the ENTRY DATE.  Instead, it uses the
"RTN","ECX321PT",51,0)
 ;; DELIVERY DATE (field #10) of the Prosthetic item.  Therefore, the PRO
"RTN","ECX321PT",52,0)
 ;; extract audit report organizes and displays data by DELIVERY DATE.
"RTN","ECX321PT",53,0)
 ;;  
"RTN","ECX321PT",54,0)
 ;; Because of this date difference, the user may see many discrepancies 
"RTN","ECX321PT",55,0)
 ;; between the PRO extract audit report and the PROSTHETICS package NPPD
"RTN","ECX321PT",56,0)
 ;; reports.  This will be particularly true for large, high cost items 
"RTN","ECX321PT",57,0)
 ;; which are ordered far in advance of actual delivery date.  The DSS 
"RTN","ECX321PT",58,0)
 ;; program office has requested that PROSTHETICS provide an NPPD report 
"RTN","ECX321PT",59,0)
 ;; which is sorted by DELIVERY DATE rather than ENTRY DATE to facilitate 
"RTN","ECX321PT",60,0)
 ;; this validation process.
"RTN","ECX321PT",61,0)
 ;;  
"RTN","ECX321PT",62,0)
 ;; A PRO extract audit report can be printed in SUMMARY or in DETAIL.
"RTN","ECX321PT",63,0)
 ;; The SUMMARY report displays data by NPPD line item, while the DETAIL
"RTN","ECX321PT",64,0)
 ;; report shows a breakout of data contained in a specific line item. 
"RTN","ECX321PT",65,0)
 ;; The following shows each NPPD category and the line items it contains:
"RTN","ECX321PT",66,0)
 ;;   
"RTN","ECX321PT",67,0)
 ;; 1.   WHEELCHAIRS AND ACCESSORIES
"RTN","ECX321PT",68,0)
 ;;  
"RTN","ECX321PT",69,0)
 ;;      100 A   MOTORIZED
"RTN","ECX321PT",70,0)
 ;;      100 A1  SCOOTERS
"RTN","ECX321PT",71,0)
 ;;      100 B   MANUAL CUSTOM
"RTN","ECX321PT",72,0)
 ;;      100 C   MANUAL A/O
"RTN","ECX321PT",73,0)
 ;;      100 D   ACCESSORIES
"RTN","ECX321PT",74,0)
 ;;      100 E   CUSHION FOAM
"RTN","ECX321PT",75,0)
 ;;      100 F   CUSHION SPEC
"RTN","ECX321PT",76,0)
 ;;   
"RTN","ECX321PT",77,0)
 ;; 2.   ARTIFICAL LEGS
"RTN","ECX321PT",78,0)
 ;;  
"RTN","ECX321PT",79,0)
 ;;      200 A   LEG IPOP
"RTN","ECX321PT",80,0)
 ;;      200 B   LEG TEM
"RTN","ECX321PT",81,0)
 ;;      200 C   LEG PART FOOT
"RTN","ECX321PT",82,0)
 ;;      200 E   LEG SYMES
"RTN","ECX321PT",83,0)
 ;;      200 F   LEG B/K
"RTN","ECX321PT",84,0)
 ;;      200 G   LEG A/O
"RTN","ECX321PT",85,0)
 ;;      200 H   LEG A/K
"RTN","ECX321PT",86,0)
 ;;  
"RTN","ECX321PT",87,0)
 ;; 3.   ARTIFICAL ARMS AND TERMINAL DEVICES
"RTN","ECX321PT",88,0)
 ;;  
"RTN","ECX321PT",89,0)
 ;;      300 A   ARM B/E
"RTN","ECX321PT",90,0)
 ;;      300 B   ARM, A/E
"RTN","ECX321PT",91,0)
 ;;      300 C   COSMETIC GLOVES
"RTN","ECX321PT",92,0)
 ;;      300 D   ARM, A/O
"RTN","ECX321PT",93,0)
 ;;      300 E   TERMINAL DEVICES
"RTN","ECX321PT",94,0)
 ;;      300 F   EXT. POWERED,ARM
"RTN","ECX321PT",95,0)
 ;;  
"RTN","ECX321PT",96,0)
 ;; 4.   BRACES AND ORTHOTICS
"RTN","ECX321PT",97,0)
 ;;  
"RTN","ECX321PT",98,0)
 ;;      400 A   BRACE ANKLE
"RTN","ECX321PT",99,0)
 ;;      400 B   BRACE LEG AK
"RTN","ECX321PT",100,0)
 ;;      400 C   BRACE, SPINAL
"RTN","ECX321PT",101,0)
 ;;      400 D   BRACE AL/OTH
"RTN","ECX321PT",102,0)
 ;;      400 E   ELAS HOSE, EA
"RTN","ECX321PT",103,0)
 ;;      400 F   BRACES, KNEE
"RTN","ECX321PT",104,0)
 ;;      400 G   CORSET/BELT
"RTN","ECX321PT",105,0)
 ;;  
"RTN","ECX321PT",106,0)
 ;; 5.   SHOES/ORTHOTICS
"RTN","ECX321PT",107,0)
 ;;  
"RTN","ECX321PT",108,0)
 ;;      500 A   ARCH SUPT, EA
"RTN","ECX321PT",109,0)
 ;;      500 B   SHOE INLAY, EA
"RTN","ECX321PT",110,0)
 ;;      500 C   SHOE MOLDED, EA
"RTN","ECX321PT",111,0)
 ;;      500 D   SHOE ORTH OTH
"RTN","ECX321PT",112,0)
 ;;      500 E   INSERTS, SHOE
"RTN","ECX321PT",113,0)
 ;;      500 F   SHOES A/O, EA
"RTN","ECX321PT",114,0)
 ;;  
"RTN","ECX321PT",115,0)
 ;; 6.   NEUROSENSORY AIDS
"RTN","ECX321PT",116,0)
 ;;   
"RTN","ECX321PT",117,0)
 ;;      600 1   EYEGLASSES PR
"RTN","ECX321PT",118,0)
 ;;      600 A   SP OVER 2,500
"RTN","ECX321PT",119,0)
 ;;      600 B   HEARING AIDS
"RTN","ECX321PT",120,0)
 ;;      600 C   AID FOR BLIND
"RTN","ECX321PT",121,0)
 ;;      600 D   CONT LENS, EA.
"RTN","ECX321PT",122,0)
 ;;      600 E   EAR INSERT
"RTN","ECX321PT",123,0)
 ;;  
"RTN","ECX321PT",124,0)
 ;; 7.   RESTORATIONS
"RTN","ECX321PT",125,0)
 ;;  
"RTN","ECX321PT",126,0)
 ;;      700 A   EYE
"RTN","ECX321PT",127,0)
 ;;      700 B   FACIAL
"RTN","ECX321PT",128,0)
 ;;      700 C   BODY, OTHER
"RTN","ECX321PT",129,0)
 ;;  
"RTN","ECX321PT",130,0)
 ;; 8.   OXYGEN AND RESPIRATIORY
"RTN","ECX321PT",131,0)
 ;;  
"RTN","ECX321PT",132,0)
 ;;      800 A   OXYGEN EQP
"RTN","ECX321PT",133,0)
 ;;      800 B   OXYGEN CONCEN
"RTN","ECX321PT",134,0)
 ;;      800 C   OXYGEN GAS
"RTN","ECX321PT",135,0)
 ;;      800 D   OXYGEN, SUPPLIES
"RTN","ECX321PT",136,0)
 ;;      800 E   OXYGEN LIQUID
"RTN","ECX321PT",137,0)
 ;;      800 F   VENTILATOR, A/O
"RTN","ECX321PT",138,0)
 ;;  
"RTN","ECX321PT",139,0)
 ;; 9.   MEDICAL EQUIPMENT, MISC., ALL OTHER NEW
"RTN","ECX321PT",140,0)
 ;;  
"RTN","ECX321PT",141,0)
 ;;      900 A   WALKING AIDS
"RTN","ECX321PT",142,0)
 ;;      900 B   INVALID LIFT
"RTN","ECX321PT",143,0)
 ;;      900 C   BED HOSP STD
"RTN","ECX321PT",144,0)
 ;;      900 D   BED HOSP SPEC
"RTN","ECX321PT",145,0)
 ;;      900 E   MATTRESS STAN
"RTN","ECX321PT",146,0)
 ;;      900 F   MATTRESS SPEC
"RTN","ECX321PT",147,0)
 ;;      900 G   BED, ACCESSORIES
"RTN","ECX321PT",148,0)
 ;;      900 H   ENVIRON CONTR
"RTN","ECX321PT",149,0)
 ;;      900 I   SPEC HOME EQP (SAFETY)
"RTN","ECX321PT",150,0)
 ;;      900 J   TENS UNIT
"RTN","ECX321PT",151,0)
 ;;      900 K   MED EQP AL/OTH
"RTN","ECX321PT",152,0)
 ;;      900 L   EQP RENTAL
"RTN","ECX321PT",153,0)
 ;;      910 A   MED SUP AL/OTH
"RTN","ECX321PT",154,0)
 ;;      920 A   HOME DIAL EQP
"RTN","ECX321PT",155,0)
 ;;      920 B   HOME DIAL SUP
"RTN","ECX321PT",156,0)
 ;;      930 A   MOD VANS
"RTN","ECX321PT",157,0)
 ;;      930 B   ADAPT EQP AL/OTH
"RTN","ECX321PT",158,0)
 ;;      999 A   AL/OTH ITEMS
"RTN","ECX321PT",159,0)
 ;;      999 X   HCPCS NOT GRP
"RTN","ECX321PT",160,0)
 ;;      999 Z   NO HCPCS
"RTN","ECX321PT",161,0)
 ;;  
"RTN","ECX321PT",162,0)
 ;; 10.  REPAIR
"RTN","ECX321PT",163,0)
 ;;  
"RTN","ECX321PT",164,0)
 ;;      R10     WHEELCHAIR
"RTN","ECX321PT",165,0)
 ;;      R20 A   LEG A/K
"RTN","ECX321PT",166,0)
 ;;      R20 B   LEG B/K, PTB
"RTN","ECX321PT",167,0)
 ;;      R20 C   LEG B/K, STD
"RTN","ECX321PT",168,0)
 ;;      R20 D   LEG ALL OTHER
"RTN","ECX321PT",169,0)
 ;;      R30     ART ARM,TOTAL
"RTN","ECX321PT",170,0)
 ;;      R40     BRACE TOTAL
"RTN","ECX321PT",171,0)
 ;;      R50 A   ORTH SHOE ALL
"RTN","ECX321PT",172,0)
 ;;      R50 B   SHOE MOD
"RTN","ECX321PT",173,0)
 ;;      R50 C   A/O ITEM SERV
"RTN","ECX321PT",174,0)
 ;;      R60 A   AID FOR BLIND
"RTN","ECX321PT",175,0)
 ;;      R60 B   EYEGLASS RPR
"RTN","ECX321PT",176,0)
 ;;      R60 C   HEARING AID
"RTN","ECX321PT",177,0)
 ;;      R70     HOME DIAL EQU
"RTN","ECX321PT",178,0)
 ;;      R80 A   INVALID LIFTS
"RTN","ECX321PT",179,0)
 ;;      R80 B   REPAIR TO ECU
"RTN","ECX321PT",180,0)
 ;;      R80 C   MED EQUIP A/O
"RTN","ECX321PT",181,0)
 ;;      R90     ALL OTHER
"RTN","ECX321PT",182,0)
 ;;      R90 A   SHIPPING
"RTN","ECX321PT",183,0)
 ;;      R99 X   HCPCS NOT GRP
"RTN","ECX321PT",184,0)
 ;;      R99 Z   NO HCPCS
"RTN","ECX321PT",185,0)
 ;;   
"RTN","ECX321PT",186,0)
 ;; Compare a SUMMARY report to the Print NPPD Worksheets report of the
"RTN","ECX321PT",187,0)
 ;; PROSTHETICS package.  Compare a DETAIL report to the Print NPPD Single
"RTN","ECX321PT",188,0)
 ;; Line Detail report of the PROSTHETICS package.  In spite of the date
"RTN","ECX321PT",189,0)
 ;; problem indicated above, the user should usually specify the same date
"RTN","ECX321PT",190,0)
 ;; range for both the PRO extract audit report and its related NPPD 
"RTN","ECX321PT",191,0)
 ;; report.  This date range will generally be a one month period which
"RTN","ECX321PT",192,0)
 ;; covers the first day through the last day of a given month.
"RTN","ECX321PT",193,0)
 ;;   
"RTN","ECX321PT",194,0)
 ;; However, it may be useful under certain conditions to vary the date 
"RTN","ECX321PT",195,0)
 ;; range when comparing DETAIL from the PRO extract audit report with an
"RTN","ECX321PT",196,0)
 ;; NPPD single line report.  For example, if it is known that for some
"RTN","ECX321PT",197,0)
 ;; complex Prosthetics items (e.g., artificial limbs) the order date 
"RTN","ECX321PT",198,0)
 ;; normally precedes delivery date by about 90 days, and if you wish to
"RTN","ECX321PT",199,0)
 ;; verify January PRO extract data, then --
"RTN","ECX321PT",200,0)
 ;;  
"RTN","ECX321PT",201,0)
 ;; (a) generate a DETAIL display for the appropriate NPPD line item
"RTN","ECX321PT",202,0)
 ;;     category (e.g., 200 A, LEG IPOP) from a PRO extract audit report 
"RTN","ECX321PT",203,0)
 ;;     which covers a date range of January 1 through January 31;
"RTN","ECX321PT",204,0)
 ;;  
"RTN","ECX321PT",205,0)
 ;; (b) generate an NPPD single line detail report for that same line
"RTN","ECX321PT",206,0)
 ;;     item for a date range of October 1 through October 31.
"RTN","ECX321PT",207,0)
 ;;   
"RTN","ECX321PT",208,0)
 ;; The NPPD single line report for October may coincide quite well
"RTN","ECX321PT",209,0)
 ;; with the PRO extract audit report DETAIL for January. 
"RTN","ECX321PT",210,0)
 ;;  
"RTN","ECX321PT",211,0)
 ;; A further note for sites that are multi-divisional for PROSTHETICS.
"RTN","ECX321PT",212,0)
 ;; ===================================================================
"RTN","ECX321PT",213,0)
 ;;  
"RTN","ECX321PT",214,0)
 ;;    A multi-divisional Prosthetics site can print NPPD data reports
"RTN","ECX321PT",215,0)
 ;;    for only ONE division at a time.  The PRO extract audit report
"RTN","ECX321PT",216,0)
 ;;    may be printed for a single division or for an entire facility.
"RTN","ECX321PT",217,0)
 ;;  
"RTN","ECX321PT",218,0)
 ;;    To compare the PRO extract audit report with the PROSTHETICS 
"RTN","ECX321PT",219,0)
 ;;    package NPPD report, the user must select the same division for
"RTN","ECX321PT",220,0)
 ;;    both reports.  Or the user may generate a PRO extract audit
"RTN","ECX321PT",221,0)
 ;;    report for the entire facility and compare its data to the sum
"RTN","ECX321PT",222,0)
 ;;    of the data from each of the single division NPPD reports.
"RTN","ECX321PT",223,0)
 ;;QUIT
"RTN","ECXAPRO")
0^1^B43185996
"RTN","ECXAPRO",1,0)
ECXAPRO ;ALB/JAP - PRO Extract Audit Report ; Nov 16, 1998
"RTN","ECXAPRO",2,0)
 ;;3.0;DSS EXTRACTS;**9,21**;Dec 22, 1997
"RTN","ECXAPRO",3,0)
 ;
"RTN","ECXAPRO",4,0)
EN ;entry point for PRO extract audit report
"RTN","ECXAPRO",5,0)
 N %X,%Y,DIV,X,Y,DIC,DA,DR,DIQ,DIR,DIRUT,DTOUT,DUOUT
"RTN","ECXAPRO",6,0)
 S ECXERR=0
"RTN","ECXAPRO",7,0)
 ;ecxaud=0 for 'extract' audit
"RTN","ECXAPRO",8,0)
 S ECXHEAD="PRO",ECXAUD=0
"RTN","ECXAPRO",9,0)
 W !!,"Setup for ",ECXHEAD," Extract Audit Report --",!!
"RTN","ECXAPRO",10,0)
 ;determine primary division
"RTN","ECXAPRO",11,0)
 S ECXPRIME=$$PDIV^ECXPUTL
"RTN","ECXAPRO",12,0)
 I ECXPRIME=0 D ^ECXKILL Q
"RTN","ECXAPRO",13,0)
 S DA=ECXPRIME,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99" D EN^DIQ1
"RTN","ECXAPRO",14,0)
 S ECXPRIME=ECXPRIME_U_$G(ECXDIC(4,DA,99,"I"))_U_$G(ECXDIC(4,DA,.01,"I"))
"RTN","ECXAPRO",15,0)
 ;select 1 or more prosthetics divisions for report
"RTN","ECXAPRO",16,0)
 D PRO^ECXDVSN2(DUZ,ECXPRIME,.ECXDIV,.ECXALL,.ECXERR)
"RTN","ECXAPRO",17,0)
 I ECXERR D  Q
"RTN","ECXAPRO",18,0)
 .D ^ECXKILL W !!,?5,"Try again later... exiting.",!
"RTN","ECXAPRO",19,0)
 ;select extract
"RTN","ECXAPRO",20,0)
 D AUDIT^ECXUTLA(ECXHEAD,.ECXERR,.ECXARRAY,ECXAUD)
"RTN","ECXAPRO",21,0)
 I ECXERR=1 D  Q
"RTN","ECXAPRO",22,0)
 .W !!,?5,"Try again later... exiting.",!
"RTN","ECXAPRO",23,0)
 .D AUDIT^ECXKILL
"RTN","ECXAPRO",24,0)
 ;if user's selected division doesn't match extract's division, then quit
"RTN","ECXAPRO",25,0)
 I +ECXPRIME'=ECXARRAY("DIV") D  Q
"RTN","ECXAPRO",26,0)
 .S DIV=+ECXARRAY("DIV") S:$D(^DIC(4,DIV,0)) DIV=$P(^(0),U,1)
"RTN","ECXAPRO",27,0)
 .W !!,?5,"Your primary division ("_$P(ECXPRIME,U,3)_") does not match the"
"RTN","ECXAPRO",28,0)
 .W !,?5,"division ("_DIV_") associated with Extract #"_ECXARRAY("EXTRACT")_"."
"RTN","ECXAPRO",29,0)
 .W !!,?5,"Try again... exiting.",!
"RTN","ECXAPRO",30,0)
 .I $E(IOST)="C" D
"RTN","ECXAPRO",31,0)
 ..S SS=20-$Y F JJ=1:1:SS W !
"RTN","ECXAPRO",32,0)
 ..S DIR(0)="E" W ! D ^DIR K DIR
"RTN","ECXAPRO",33,0)
 ..W @IOF
"RTN","ECXAPRO",34,0)
 ;select summary or detail
"RTN","ECXAPRO",35,0)
 K DIR S DIR(0)="S^D:DETAIL;S:SUMMARY",DIR("A")="Type of Report",DIR("B")="SUMMARY"
"RTN","ECXAPRO",36,0)
 D ^DIR K DIR
"RTN","ECXAPRO",37,0)
 I $D(DIRUT)!($D(DTOUT)) D  Q
"RTN","ECXAPRO",38,0)
 .W !!,?5,"Try again later... exiting.",!
"RTN","ECXAPRO",39,0)
 .D AUDIT^ECXKILL
"RTN","ECXAPRO",40,0)
 S ECXREPT=Y
"RTN","ECXAPRO",41,0)
 ;continue with detail report
"RTN","ECXAPRO",42,0)
 I ECXREPT="D" D
"RTN","ECXAPRO",43,0)
 .F  D ASK2^ECXAPRO2 Q:$D(DIRUT)!($D(DTOUT))
"RTN","ECXAPRO",44,0)
 ;continue with summary report
"RTN","ECXAPRO",45,0)
 I ECXREPT="S" D
"RTN","ECXAPRO",46,0)
 .S ECXPGM="TASK^ECXAPRO",ECXDESC="PRO Extract Audit Report"
"RTN","ECXAPRO",47,0)
 .S ECXSAVE("ECXHEAD")="",ECXSAVE("ECXDIV(")="",ECXSAVE("ECXARRAY(")="",ECXSAVE("ECXREPT")="",ECXSAVE("ECXPRIME")="",ECXSAVE("ECXALL")=""
"RTN","ECXAPRO",48,0)
 .W !
"RTN","ECXAPRO",49,0)
 .;determine output device and queue if requested
"RTN","ECXAPRO",50,0)
 .D DEVICE^ECXUTLA(ECXPGM,ECXDESC,.ECXSAVE) I ECXSAVE("POP")=1 D  Q
"RTN","ECXAPRO",51,0)
 ..W !!,?5,"Try again later... exiting.",!
"RTN","ECXAPRO",52,0)
 ..D AUDIT^ECXKILL
"RTN","ECXAPRO",53,0)
 .I ECXSAVE("ZTSK")=0 D
"RTN","ECXAPRO",54,0)
 ..K ECXSAVE,ECXPGM,ECXDESC
"RTN","ECXAPRO",55,0)
 ..D PROCESS,DISP^ECXAPRO1
"RTN","ECXAPRO",56,0)
 ..;allow user to get details
"RTN","ECXAPRO",57,0)
 ..D ASK^ECXAPRO2
"RTN","ECXAPRO",58,0)
 ;clean-up and close
"RTN","ECXAPRO",59,0)
 I IO'=IO(0) D ^%ZISC
"RTN","ECXAPRO",60,0)
 D HOME^%ZIS
"RTN","ECXAPRO",61,0)
 D AUDIT^ECXKILL
"RTN","ECXAPRO",62,0)
 Q
"RTN","ECXAPRO",63,0)
 ;
"RTN","ECXAPRO",64,0)
TASK ;entry point from taskmanager
"RTN","ECXAPRO",65,0)
 D PROCESS
"RTN","ECXAPRO",66,0)
 I ECXREPT="S" D DISP^ECXAPRO1
"RTN","ECXAPRO",67,0)
 I ECXREPT="D" D DISP^ECXAPRO2
"RTN","ECXAPRO",68,0)
 D AUDIT^ECXKILL
"RTN","ECXAPRO",69,0)
 Q
"RTN","ECXAPRO",70,0)
 ;
"RTN","ECXAPRO",71,0)
PROCESS ;process the data in file #727.826
"RTN","ECXAPRO",72,0)
 N J,CNT,CODE,COST,CPTNM,DATE,DESC,FLG,GN,IEN,KEY,LOC,LABLC,LABMC,NODE,PTNAM,PSASNM,QTY,QFLG,QQFLG,RD,SSN,STN,SRCE,TYPE
"RTN","ECXAPRO",73,0)
 K ^TMP($J)
"RTN","ECXAPRO",74,0)
 S (CNT,QQFLG)=0
"RTN","ECXAPRO",75,0)
 S ECXEXT=ECXARRAY("EXTRACT"),ECXDEF=ECXARRAY("DEF")
"RTN","ECXAPRO",76,0)
 S X=ECXARRAY("START") D ^%DT S ECXSTART=Y S X=ECXARRAY("END") D ^%DT S ECXEND=Y
"RTN","ECXAPRO",77,0)
 D NOW^%DTC S Y=$E(%,1,12) D DD^%DT S ECXRUN=Y
"RTN","ECXAPRO",78,0)
 I ECXALL=0 S J=$O(ECXDIV(99),-1),ECXDIV=ECXDIV(J)
"RTN","ECXAPRO",79,0)
 I ECXALL=1 S ECXDIV=ECXPRIME
"RTN","ECXAPRO",80,0)
 S STN=$P(ECXDIV,U,2)
"RTN","ECXAPRO",81,0)
 ;initialize the prosthetics tmp global for cumulative data
"RTN","ECXAPRO",82,0)
 D CODE^ECXAPRO1
"RTN","ECXAPRO",83,0)
 ;gather extract data and sort by grouper number, calc flag, and nppd code
"RTN","ECXAPRO",84,0)
 S IEN="" F  S IEN=$O(^ECX(727.826,"AC",ECXEXT,IEN)) Q:IEN=""  D  Q:QQFLG
"RTN","ECXAPRO",85,0)
 .S ECXPRO=^ECX(727.826,IEN,0)_U_$P(^ECX(727.826,IEN,1),U,4)
"RTN","ECXAPRO",86,0)
 .S DATE=$P(ECXPRO,U,9)
"RTN","ECXAPRO",87,0)
 .S $E(DATE,1,2)=$E(DATE,1,2)-17
"RTN","ECXAPRO",88,0)
 .Q:$L(DATE)<7  Q:(DATE<ECXSTART)  Q:(DATE>ECXEND)
"RTN","ECXAPRO",89,0)
 .S DATE=$E(DATE,4,5)_"/"_$E(DATE,6,7)
"RTN","ECXAPRO",90,0)
 .S PTNAM=$P(ECXPRO,U,7),SSN=$E($P(ECXPRO,U,6),6,9)
"RTN","ECXAPRO",91,0)
 .S LOC=$P(ECXPRO,U,10),KEY=$P(ECXPRO,U,11),QTY=$P(ECXPRO,U,12),COST=$P(ECXPRO,U,21),LABLC=$P(ECXPRO,U,22),LABMC=$P(ECXPRO,U,23),GN=$P(ECXPRO,U,30)
"RTN","ECXAPRO",92,0)
 .;don't double count lab items
"RTN","ECXAPRO",93,0)
 .Q:LOC["LAB"
"RTN","ECXAPRO",94,0)
 .;duplicate the logic in sort^rmprn6 that sets cost=0 if form=4
"RTN","ECXAPRO",95,0)
 .I LOC["ORD" S COST=0
"RTN","ECXAPRO",96,0)
 .S LOC=$S(LOC["ORD":$P(LOC,"ORD",1),1:$P(LOC,"NONL",1))
"RTN","ECXAPRO",97,0)
 .;quit if feeder location isn't for division selected for report
"RTN","ECXAPRO",98,0)
 .I ECXALL=1,LOC'[STN Q
"RTN","ECXAPRO",99,0)
 .I ECXALL=0,LOC'=STN Q
"RTN","ECXAPRO",100,0)
 .S TYPE=$E(KEY,6),SRCE=$E(KEY,7)
"RTN","ECXAPRO",101,0)
 .S CPTNM=$P(ECXPRO,U,15),PSASNM=$P(ECXPRO,U,29)
"RTN","ECXAPRO",102,0)
 .D GETCODE(PSASNM,.NODE)
"RTN","ECXAPRO",103,0)
 .Q:NODE=""
"RTN","ECXAPRO",104,0)
 .S CODE=$S(TYPE="X":$P(NODE,U,3),1:$P(NODE,U,4))
"RTN","ECXAPRO",105,0)
 .S FLG=$P(NODE,U,2),DESC=$P(NODE,U,5)
"RTN","ECXAPRO",106,0)
 .S ^TMP($J,"RMPRGN",STN,GN,FLG,CODE,IEN)=TYPE_U_SRCE_U_QTY_U_COST_U_LABLC_U_LABMC_U_PSASNM_U_DESC_U_PTNAM_U_SSN_U_DATE_U_LOC
"RTN","ECXAPRO",107,0)
 ;accumulate summary & detail data
"RTN","ECXAPRO",108,0)
 S GN=""
"RTN","ECXAPRO",109,0)
 F  S GN=$O(^TMP($J,"RMPRGN",STN,GN)) Q:GN=""  D
"RTN","ECXAPRO",110,0)
 .S FLG=0
"RTN","ECXAPRO",111,0)
 .F  S FLG=$O(^TMP($J,"RMPRGN",STN,GN,FLG)) Q:FLG'>0  D
"RTN","ECXAPRO",112,0)
 ..I FLG=1 D GROUP S FLG=2 Q
"RTN","ECXAPRO",113,0)
 ..S CODE=0
"RTN","ECXAPRO",114,0)
 ..F  S CODE=$O(^TMP($J,"RMPRGN",STN,GN,FLG,CODE)) Q:CODE=""  D
"RTN","ECXAPRO",115,0)
 ...S RD=0
"RTN","ECXAPRO",116,0)
 ...F  S RD=$O(^TMP($J,"RMPRGN",STN,GN,FLG,CODE,RD)) Q:RD'>0  D
"RTN","ECXAPRO",117,0)
 ....S TYPE=$P(^TMP($J,"RMPRGN",STN,GN,FLG,CODE,RD),U,1),SRCE=$P(^(RD),U,2),QTY=$P(^(RD),U,3),COST=$P(^(RD),U,4)
"RTN","ECXAPRO",118,0)
 ....S ^TMP($J,CODE,RD)=^TMP($J,"RMPRGN",STN,GN,FLG,CODE,RD)
"RTN","ECXAPRO",119,0)
 ....I TYPE="X" D REP(CODE)
"RTN","ECXAPRO",120,0)
 ....I TYPE="N" D NEW(CODE)
"RTN","ECXAPRO",121,0)
 Q
"RTN","ECXAPRO",122,0)
 ;
"RTN","ECXAPRO",123,0)
GETCODE(PSAS,NODE) ;find the appropriate nppd code using psas hcpcs
"RTN","ECXAPRO",124,0)
 N DIC,X,Y,DESC,FLG,NU,REP
"RTN","ECXAPRO",125,0)
 S NODE=""
"RTN","ECXAPRO",126,0)
 S DIC="^RMPR(661.1,",DIC(0)="XZ",X=PSAS D ^DIC
"RTN","ECXAPRO",127,0)
 I Y=-1 S NODE=U_"2"_U_"R99 Z"_U_"999 Z"_U_"NO HCPCS" Q
"RTN","ECXAPRO",128,0)
 S DESC=$E($P(Y(0),U,2),1,20)
"RTN","ECXAPRO",129,0)
 S FLG=$P(Y(0),U,8) S:FLG="" FLG=2
"RTN","ECXAPRO",130,0)
 ;make sure each code at least 4 characters; group codes are 3 characters in tmp($j,rmprcode)
"RTN","ECXAPRO",131,0)
 S REP=$P(Y(0),U,6) S:$L(REP)=3 REP=REP_" " S:REP="" REP="R99 X"
"RTN","ECXAPRO",132,0)
 S NU=$P(Y(0),U,7) S:$L(NU)=3 NU=NU_" " S:NU="" NU="999 X"
"RTN","ECXAPRO",133,0)
 S NODE=U_FLG_U_REP_U_NU_U_DESC
"RTN","ECXAPRO",134,0)
 Q
"RTN","ECXAPRO",135,0)
 ;
"RTN","ECXAPRO",136,0)
GROUP ;total grouper to main key
"RTN","ECXAPRO",137,0)
 N BF,BL,BR,BCOST,BTCOST,COST,QTY,TYPE,SRCE
"RTN","ECXAPRO",138,0)
 S BF=0,BTCOST=0
"RTN","ECXAPRO",139,0)
 F  S BF=$O(^TMP($J,"RMPRGN",STN,GN,BF)) Q:BF'>0  D
"RTN","ECXAPRO",140,0)
 .S BL=0
"RTN","ECXAPRO",141,0)
 .F  S BL=$O(^TMP($J,"RMPRGN",STN,GN,BF,BL)) Q:BL=""  D
"RTN","ECXAPRO",142,0)
 ..S BR=0
"RTN","ECXAPRO",143,0)
 ..F  S BR=$O(^TMP($J,"RMPRGN",STN,GN,BF,BL,BR)) Q:BR'>0  D
"RTN","ECXAPRO",144,0)
 ...S BCOST=$P(^TMP($J,"RMPRGN",STN,GN,BF,BL,BR),U,4)
"RTN","ECXAPRO",145,0)
 ...S BTCOST=BTCOST+BCOST
"RTN","ECXAPRO",146,0)
 S BL=$O(^TMP($J,"RMPRGN",STN,GN,1,"")),BR=$O(^TMP($J,"RMPRGN",STN,GN,1,BL,""))
"RTN","ECXAPRO",147,0)
 ;calculate based on primary
"RTN","ECXAPRO",148,0)
 S TYPE=$P(^TMP($J,"RMPRGN",STN,GN,1,BL,BR),U,1),SRCE=$P(^(BR),U,2),QTY=$P(^(BR),U,3)
"RTN","ECXAPRO",149,0)
 S COST=BTCOST
"RTN","ECXAPRO",150,0)
 S ^TMP($J,BL,BR)=^TMP($J,"RMPRGN",STN,GN,1,BL,BR),$P(^TMP($J,BL,BR),U,4)=COST
"RTN","ECXAPRO",151,0)
 I TYPE="X" D REP(BL)
"RTN","ECXAPRO",152,0)
 I TYPE="N" D NEW(BL)
"RTN","ECXAPRO",153,0)
 Q
"RTN","ECXAPRO",154,0)
 ;
"RTN","ECXAPRO",155,0)
REP(C) ;calculate repair cost
"RTN","ECXAPRO",156,0)
 N LINE
"RTN","ECXAPRO",157,0)
 S LINE=C
"RTN","ECXAPRO",158,0)
 I LINE="R90 A" S SRCE="C",QTY=1
"RTN","ECXAPRO",159,0)
 I $G(^TMP($J,"R",STN,LINE))="" S ^TMP($J,"R",STN,LINE)=""
"RTN","ECXAPRO",160,0)
 I SRCE["V" S $P(^TMP($J,"R",STN,LINE),U,1)=$P(^TMP($J,"R",STN,LINE),U,1)+QTY
"RTN","ECXAPRO",161,0)
 I SRCE["C" S $P(^TMP($J,"R",STN,LINE),U,2)=$P(^TMP($J,"R",STN,LINE),U,2)+QTY
"RTN","ECXAPRO",162,0)
 S $P(^TMP($J,"R",STN,LINE),U,3)=$P(^TMP($J,"R",STN,LINE),U,3)+COST
"RTN","ECXAPRO",163,0)
 Q
"RTN","ECXAPRO",164,0)
 ;
"RTN","ECXAPRO",165,0)
NEW(C) ;calculate new costs
"RTN","ECXAPRO",166,0)
 N LINE
"RTN","ECXAPRO",167,0)
 S LINE=C
"RTN","ECXAPRO",168,0)
 I $G(^TMP($J,"N",STN,LINE))="" S ^TMP($J,"N",STN,LINE)=""
"RTN","ECXAPRO",169,0)
 I SRCE["V" S $P(^TMP($J,"N",STN,LINE),U,1)=$P(^TMP($J,"N",STN,LINE),U,1)+QTY
"RTN","ECXAPRO",170,0)
 I SRCE["C" S $P(^TMP($J,"N",STN,LINE),U,2)=$P(^TMP($J,"N",STN,LINE),U,2)+QTY
"RTN","ECXAPRO",171,0)
 S $P(^TMP($J,"N",STN,LINE),U,3)=$P(^TMP($J,"N",STN,LINE),U,3)+COST
"RTN","ECXAPRO",172,0)
 Q
"RTN","ECXAPRO1")
0^2^B14438659
"RTN","ECXAPRO1",1,0)
ECXAPRO1 ;ALB/JAP - PRO Extract Audit Report (cont) ; Nov 16, 1998
"RTN","ECXAPRO1",2,0)
 ;;3.0;DSS EXTRACTS;**9,21**;Dec 22, 1997
"RTN","ECXAPRO1",3,0)
 ;
"RTN","ECXAPRO1",4,0)
DISP ;entry point
"RTN","ECXAPRO1",5,0)
 N DIC,DA,DR,DIRUT,DTOUT,DUOUT,JJ,SS,LN,PG,QFLG,STN,TYPE
"RTN","ECXAPRO1",6,0)
 N A1,A2,A3,CA,CB,CC,GCA,GCB,GCC,GRP,GRPHEAD,LINE,LINEP
"RTN","ECXAPRO1",7,0)
 U IO
"RTN","ECXAPRO1",8,0)
 S (QFLG,PG)=0,$P(LN,"-",80)=""
"RTN","ECXAPRO1",9,0)
 F TYPE="N","R" S STN="",STN=$O(^TMP($J,TYPE,STN)) D  Q:QFLG
"RTN","ECXAPRO1",10,0)
 .D HEADER
"RTN","ECXAPRO1",11,0)
 .D CDATA Q:QFLG
"RTN","ECXAPRO1",12,0)
 I $E(IOST)'="C" D
"RTN","ECXAPRO1",13,0)
 .W @IOF S PG=PG+1
"RTN","ECXAPRO1",14,0)
 .W !,ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report"
"RTN","ECXAPRO1",15,0)
 .W !,"DSS Extract Log #:       "_ECXEXT
"RTN","ECXAPRO1",16,0)
 .W !,"Date Range of Audit:     "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXAPRO1",17,0)
 .W !,"Report Run Date/Time:    "_ECXRUN,?68,"Page: ",PG
"RTN","ECXAPRO1",18,0)
 .W !!,LN,!!
"RTN","ECXAPRO1",19,0)
 .S DIC="^ECX(727.1,",DA=ECXARRAY("DEF"),DR="1" D EN^DIQ
"RTN","ECXAPRO1",20,0)
 .W @IOF
"RTN","ECXAPRO1",21,0)
 I $D(IO(0)) I IO(0)'=IO D ^%ZISC
"RTN","ECXAPRO1",22,0)
 D HOME^%ZIS
"RTN","ECXAPRO1",23,0)
 Q
"RTN","ECXAPRO1",24,0)
 ;
"RTN","ECXAPRO1",25,0)
CDATA ;accummulate data within each nppd group
"RTN","ECXAPRO1",26,0)
 S (LINE,LINEP)=""
"RTN","ECXAPRO1",27,0)
 S (GCA,GCB,GCC)=0
"RTN","ECXAPRO1",28,0)
 S (CA,CB,CC)=0
"RTN","ECXAPRO1",29,0)
 I '$D(^TMP($J,TYPE)) D  Q
"RTN","ECXAPRO1",30,0)
 .W !,?26,"No data available.",!
"RTN","ECXAPRO1",31,0)
 .I $E(IOST)="C",'QFLG D
"RTN","ECXAPRO1",32,0)
 ..S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXAPRO1",33,0)
 ..S DIR(0)="E" D ^DIR K DIR
"RTN","ECXAPRO1",34,0)
 F  S LINE=$O(^TMP($J,TYPE,STN,LINE)) Q:LINE=""  D  Q:QFLG
"RTN","ECXAPRO1",35,0)
 .S GRP=$E(LINE,1,3) D  Q:QFLG
"RTN","ECXAPRO1",36,0)
 ..I TYPE="R",GRP["R9" S GRP="R90"
"RTN","ECXAPRO1",37,0)
 ..S GRPHEAD=^TMP($J,"RMPRCODE",GRP)
"RTN","ECXAPRO1",38,0)
 ..I LINEP="" D
"RTN","ECXAPRO1",39,0)
 ...D:($Y+5>IOSL) HEADER Q:QFLG
"RTN","ECXAPRO1",40,0)
 ...W !,GRPHEAD
"RTN","ECXAPRO1",41,0)
 .I $E(LINE,0,3)'=$E(LINEP,0,3),LINEP'="" D  Q:QFLG
"RTN","ECXAPRO1",42,0)
 ..D:($Y+5>IOSL) HEADER Q:QFLG 
"RTN","ECXAPRO1",43,0)
 ..W !,LN,!
"RTN","ECXAPRO1",44,0)
 ..W ?26,$J(CA,5,0),?34,$J(CB,5,0),?42,$J((CA+CB),5,0),?51,$J(CC,7,0),!
"RTN","ECXAPRO1",45,0)
 ..S (CA,CB,CC)=0
"RTN","ECXAPRO1",46,0)
 ..D:($Y+5>IOSL) HEADER Q:QFLG 
"RTN","ECXAPRO1",47,0)
 ..W:LINE'["R99" !,GRPHEAD
"RTN","ECXAPRO1",48,0)
 .D:($Y+3>IOSL) HEADER Q:QFLG 
"RTN","ECXAPRO1",49,0)
 .W !,LINE,?6,$E($P(^TMP($J,TYPE,STN,LINE),U,15),1,15)
"RTN","ECXAPRO1",50,0)
 .S A1=+$P(^TMP($J,TYPE,STN,LINE),U,1),A2=+$P(^(LINE),U,2),A3=+$P(^(LINE),U,3)
"RTN","ECXAPRO1",51,0)
 .W ?26,$J(A1,5,0) S CA=CA+A1,GCA=GCA+A1
"RTN","ECXAPRO1",52,0)
 .W ?34,$J(A2,5,0) S CB=CB+A2,GCB=GCB+A2
"RTN","ECXAPRO1",53,0)
 .W ?42,$J(A1+A2,5,0)
"RTN","ECXAPRO1",54,0)
 .W ?51,$J(A3,7,0) S CC=CC+A3,GCC=GCC+A3
"RTN","ECXAPRO1",55,0)
 .W:A2>0 ?61,$J(A3/A2,6,0)
"RTN","ECXAPRO1",56,0)
 .S LINEP=LINE
"RTN","ECXAPRO1",57,0)
 Q:QFLG
"RTN","ECXAPRO1",58,0)
 D SUM
"RTN","ECXAPRO1",59,0)
 Q
"RTN","ECXAPRO1",60,0)
 ;
"RTN","ECXAPRO1",61,0)
SUM ;print summary for type
"RTN","ECXAPRO1",62,0)
 D:($Y+7>IOSL) HEADER Q:QFLG 
"RTN","ECXAPRO1",63,0)
 W:TYPE="N" !!!,"STATION SUMMARY (NEW)"
"RTN","ECXAPRO1",64,0)
 W:TYPE="R" !!!,"STATION SUMMARY (REPAIR)"
"RTN","ECXAPRO1",65,0)
 W !,?28,"VA",?36,"Com",?44,"Total",?54,"Cost ($)"
"RTN","ECXAPRO1",66,0)
 W !,LN
"RTN","ECXAPRO1",67,0)
 W !,?26,$J(GCA,5,0),?34,$J(GCB,5,0),?42,$J((GCA+GCB),5,0),?51,$J(GCC,7,0)
"RTN","ECXAPRO1",68,0)
 W !,LN
"RTN","ECXAPRO1",69,0)
 Q
"RTN","ECXAPRO1",70,0)
 ;
"RTN","ECXAPRO1",71,0)
HEADER ;header and page control
"RTN","ECXAPRO1",72,0)
 I $E(IOST)="C" D
"RTN","ECXAPRO1",73,0)
 .S SS=20-$Y F JJ=1:1:SS W !
"RTN","ECXAPRO1",74,0)
 .I PG>0 S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXAPRO1",75,0)
 Q:QFLG
"RTN","ECXAPRO1",76,0)
 W:$Y!($E(IOST)="C") @IOF S PG=PG+1
"RTN","ECXAPRO1",77,0)
 W ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report",?64,"Page "_PG
"RTN","ECXAPRO1",78,0)
 W !,"DSS Extract Log #:       "_ECXEXT
"RTN","ECXAPRO1",79,0)
 W !,"Date Range of Audit:     "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXAPRO1",80,0)
 W !,"Station (#):             "_$P(ECXDIV,U,2)_" ("_$P(ECXDIV,U,3)_")"
"RTN","ECXAPRO1",81,0)
 W !,"Report Run Date/Time:    "_ECXRUN
"RTN","ECXAPRO1",82,0)
 W:TYPE="N" !!,"REPORT OF NEW PROSTHETICS ACTIVITIES"
"RTN","ECXAPRO1",83,0)
 W:TYPE="R" !!,"REPORT OF REPAIR PROSTHETICS ACTIVITIES"
"RTN","ECXAPRO1",84,0)
 W !,"Line",?6,"Item",?28,"VA",?36,"Com",?44,"Total",?54,"Cost ($)",?64,"Ave Com ($)"
"RTN","ECXAPRO1",85,0)
 W !,LN,!
"RTN","ECXAPRO1",86,0)
 Q
"RTN","ECXAPRO1",87,0)
 ;
"RTN","ECXAPRO1",88,0)
CODE ;setup nppd codes
"RTN","ECXAPRO1",89,0)
 ;intended to duplicate code^rmprn63
"RTN","ECXAPRO1",90,0)
 N NULINE
"RTN","ECXAPRO1",91,0)
 F I=1:1 S NULINE=$P($T(TEXT+I^ECXAPRO3),";;",2) Q:NULINE["QUIT"  D
"RTN","ECXAPRO1",92,0)
 .I $L($P(NULINE,";",1))>3,STN]"" D
"RTN","ECXAPRO1",93,0)
 ..I $E(NULINE,0,1)'="R" S:$D(^TMP($J,"N",STN,$P(NULINE,";",1))) $P(^TMP($J,"N",STN,$P(NULINE,";",1)),U,15)=$P(NULINE,";",2)
"RTN","ECXAPRO1",94,0)
 ..I $E(NULINE,0,1)="R" S:$D(^TMP($J,"R",STN,$P(NULINE,";",1))) $P(^TMP($J,"R",STN,$P(NULINE,";",1)),U,15)=$P(NULINE,";",2)
"RTN","ECXAPRO1",95,0)
 .S ^TMP($J,"RMPRCODE",$P(NULINE,";",1))=$P(NULINE,";",2)
"RTN","ECXAPRO1",96,0)
 Q
"RTN","ECXAPRO2")
0^3^B19152837
"RTN","ECXAPRO2",1,0)
ECXAPRO2 ;ALB/JAP - PRO Extract Audit Report (cont) ; Nov 16, 1998
"RTN","ECXAPRO2",2,0)
 ;;3.0;DSS EXTRACTS;**9,21**;Dec 22, 1997
"RTN","ECXAPRO2",3,0)
 ;
"RTN","ECXAPRO2",4,0)
ASK ;further detail needed?
"RTN","ECXAPRO2",5,0)
 K X,Y
"RTN","ECXAPRO2",6,0)
 W !
"RTN","ECXAPRO2",7,0)
 S DIR(0)="Y",DIR("A")="Do you want to see details on this audit report",DIR("B")="NO"
"RTN","ECXAPRO2",8,0)
 D ^DIR K DIR
"RTN","ECXAPRO2",9,0)
 Q:($G(Y)=0)!$D(DUOUT)!($D(DTOUT))
"RTN","ECXAPRO2",10,0)
 ;allow user to expand as many lines as needed
"RTN","ECXAPRO2",11,0)
 F  D ASK2 Q:$D(DUOUT)!($D(DTOUT))
"RTN","ECXAPRO2",12,0)
 Q
"RTN","ECXAPRO2",13,0)
 ;
"RTN","ECXAPRO2",14,0)
ASK2 ;select nppd group to be expanded
"RTN","ECXAPRO2",15,0)
 D CODE
"RTN","ECXAPRO2",16,0)
 W @IOF,!
"RTN","ECXAPRO2",17,0)
 W !,?5,"1.   WHEELCHAIRS AND ACCESSORIES"
"RTN","ECXAPRO2",18,0)
 W !,?5,"2.   ARTIFICAL LEGS"
"RTN","ECXAPRO2",19,0)
 W !,?5,"3.   ARTIFICAL ARMS AND TERMINAL DEVICES"
"RTN","ECXAPRO2",20,0)
 W !,?5,"4.   BRACES AND ORTHOTICS"
"RTN","ECXAPRO2",21,0)
 W !,?5,"5.   SHOES/ORTHOTICS"
"RTN","ECXAPRO2",22,0)
 W !,?5,"6.   NEUROSENSORY AIDS"
"RTN","ECXAPRO2",23,0)
 W !,?5,"7.   RESTORATIONS"
"RTN","ECXAPRO2",24,0)
 W !,?5,"8.   OXYGEN AND RESPIRATIORY"
"RTN","ECXAPRO2",25,0)
 W !,?5,"9.   MEDICAL EQUIPMENT, MISC., ALL OTHER NEW"
"RTN","ECXAPRO2",26,0)
 W !,?5,"10.  REPAIR",!!
"RTN","ECXAPRO2",27,0)
 S DIR(0)="N^1:10:0"
"RTN","ECXAPRO2",28,0)
 S DIR("A")="Select NPPD Group "
"RTN","ECXAPRO2",29,0)
 D ^DIR K DIR
"RTN","ECXAPRO2",30,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","ECXAPRO2",31,0)
 D ASK3(Y)
"RTN","ECXAPRO2",32,0)
 Q:$D(DTOUT)
"RTN","ECXAPRO2",33,0)
 K DIRUT,DTOUT,DUOUT
"RTN","ECXAPRO2",34,0)
 G ASK2
"RTN","ECXAPRO2",35,0)
 Q
"RTN","ECXAPRO2",36,0)
 ;
"RTN","ECXAPRO2",37,0)
ASK3(ECXY) ;select nppd line item
"RTN","ECXAPRO2",38,0)
 N BR,BRC,CODE
"RTN","ECXAPRO2",39,0)
 S BR=0,BRC=0 K CODE W @IOF
"RTN","ECXAPRO2",40,0)
 F  S BR=$O(^TMP($J,"RMPRCODE",BR)) Q:BR=""  I $L(BR)>3 D
"RTN","ECXAPRO2",41,0)
 .I $E(BR,1,1)=ECXY S BRC=BRC+1 W !?5,BRC_".",?10,BR,?18,^TMP($J,"RMPRCODE",BR) S CODE(BRC,BR)=""
"RTN","ECXAPRO2",42,0)
 .I ($E(BR,1,1)="R")&(ECXY=10) S BRC=BRC+1 W !?5,BRC_".",?10,BR,?18,^TMP($J,"RMPRCODE",BR) S CODE(BRC,BR)=""
"RTN","ECXAPRO2",43,0)
 W !
"RTN","ECXAPRO2",44,0)
 S DIR(0)="N^1:"_BRC_":0"
"RTN","ECXAPRO2",45,0)
 S DIR("A")="Select NPPD Line "
"RTN","ECXAPRO2",46,0)
 D ^DIR K DIR
"RTN","ECXAPRO2",47,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","ECXAPRO2",48,0)
 S ECXCODE="",ECXCODE=$O(CODE(Y,ECXCODE))
"RTN","ECXAPRO2",49,0)
 S ECXPGM="TASK^ECXAPRO",ECXDESC="PRO Extract Audit Detail"
"RTN","ECXAPRO2",50,0)
 S ECXSAVE("ECXHEAD")="",ECXSAVE("ECXDIV(")="",ECXSAVE("ECXARRAY(")="",ECXSAVE("ECXREPT")="",ECXSAVE("ECXPRIME")="",ECXSAVE("ECXALL")="",ECXSAVE("ECXCODE")=""
"RTN","ECXAPRO2",51,0)
 W !
"RTN","ECXAPRO2",52,0)
 ;determine output device and queue if requested
"RTN","ECXAPRO2",53,0)
 D DEVICE^ECXUTLA(ECXPGM,ECXDESC,.ECXSAVE) I ECXSAVE("POP")=1 D  Q
"RTN","ECXAPRO2",54,0)
 .W !!,?5,"Try again later... exiting.",!
"RTN","ECXAPRO2",55,0)
 I ECXSAVE("ZTSK")=0 D
"RTN","ECXAPRO2",56,0)
 .K ECXSAVE,ECXPGM,ECXDESC
"RTN","ECXAPRO2",57,0)
 .I '$D(^TMP($J,"RMPRGN")) D PROCESS^ECXAPRO
"RTN","ECXAPRO2",58,0)
 .D DISP
"RTN","ECXAPRO2",59,0)
 I $D(IO(0)) I IO(0)'=IO D ^%ZISC
"RTN","ECXAPRO2",60,0)
 D HOME^%ZIS
"RTN","ECXAPRO2",61,0)
 Q
"RTN","ECXAPRO2",62,0)
 ;
"RTN","ECXAPRO2",63,0)
CODE ;setup nppd codes
"RTN","ECXAPRO2",64,0)
 ;intended to duplicate code^rmprn63
"RTN","ECXAPRO2",65,0)
 N NULINE
"RTN","ECXAPRO2",66,0)
 Q:$D(^TMP($J,"RMPRCODE"))
"RTN","ECXAPRO2",67,0)
 F I=1:1 S NULINE=$P($T(TEXT+I^ECXAPRO3),";;",2) Q:NULINE["QUIT"  D
"RTN","ECXAPRO2",68,0)
 .S ^TMP($J,"RMPRCODE",$P(NULINE,";",1))=$P(NULINE,";",2)
"RTN","ECXAPRO2",69,0)
 Q
"RTN","ECXAPRO2",70,0)
 ;
"RTN","ECXAPRO2",71,0)
DISP ;display all records within nppd code group
"RTN","ECXAPRO2",72,0)
 ;based on desp^rmprn6pl
"RTN","ECXAPRO2",73,0)
 N JJ,SS,LN,PG,COST,DATE,DESC,HCPCS,LOC,PTNAM,QFLG,QTY,RDX,RDXX,SSN,TYPE,DIR,DIRUT,DTOUT,DUOUT
"RTN","ECXAPRO2",74,0)
 U IO
"RTN","ECXAPRO2",75,0)
 S (QFLG,PG)=0,$P(LN,"-",80)=""
"RTN","ECXAPRO2",76,0)
 D HEADER
"RTN","ECXAPRO2",77,0)
 I '$D(^TMP($J,ECXCODE)) D  Q
"RTN","ECXAPRO2",78,0)
 .W !,?14,"No data available.",!
"RTN","ECXAPRO2",79,0)
 .I $E(IOST)="C",'QFLG D
"RTN","ECXAPRO2",80,0)
 ..S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXAPRO2",81,0)
 ..S DIR(0)="E" D ^DIR K DIR
"RTN","ECXAPRO2",82,0)
 S RDX=0
"RTN","ECXAPRO2",83,0)
 F  S RDX=$O(^TMP($J,ECXCODE,RDX)) Q:RDX'>0  Q:QFLG  D
"RTN","ECXAPRO2",84,0)
 .S RDXX=^TMP($J,ECXCODE,RDX)
"RTN","ECXAPRO2",85,0)
 .S PTNAM=$P(RDXX,U,9),SSN=$P(RDXX,U,10)
"RTN","ECXAPRO2",86,0)
 .D:($Y+3>IOSL) HEADER Q:QFLG
"RTN","ECXAPRO2",87,0)
 .S TYPE=$P(RDXX,U,1),TYPE=$S(TYPE="X":"R",1:"I")_" "_$P(RDXX,U,2)
"RTN","ECXAPRO2",88,0)
 .S QTY=$P(RDXX,U,3),COST=$P(RDXX,U,4),HCPCS=$P(RDXX,U,7),DESC=$P(RDXX,U,8),DATE=$P(RDXX,U,11),LOC=$P(RDXX,U,12)
"RTN","ECXAPRO2",89,0)
 .W !,PTNAM,?6,SSN,?14,HCPCS,?21,QTY,?27,TYPE,?33,COST,?42,DATE,?50,DESC,?72,LOC
"RTN","ECXAPRO2",90,0)
 I $E(IOST)="C",'QFLG D
"RTN","ECXAPRO2",91,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXAPRO2",92,0)
 .S DIR(0)="E" D ^DIR K DIR
"RTN","ECXAPRO2",93,0)
 Q
"RTN","ECXAPRO2",94,0)
 ;
"RTN","ECXAPRO2",95,0)
HEADER ;header and page control
"RTN","ECXAPRO2",96,0)
 I $E(IOST)="C" D
"RTN","ECXAPRO2",97,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXAPRO2",98,0)
 .I PG>0 S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXAPRO2",99,0)
 Q:QFLG
"RTN","ECXAPRO2",100,0)
 W:$Y!($E(IOST)="C") @IOF S PG=PG+1
"RTN","ECXAPRO2",101,0)
 W !,ECXARRAY("TYPE")_" ("_ECXHEAD_") Extract Audit Report Detail",?72,"Page ",PG
"RTN","ECXAPRO2",102,0)
 W !,"DSS Extract Log #:       "_ECXEXT
"RTN","ECXAPRO2",103,0)
 W !,"Date Range of Audit:     "_ECXARRAY("START")_" to "_ECXARRAY("END")
"RTN","ECXAPRO2",104,0)
 I ECXALL=1 W !,"Station:                 "_$P(ECXDIV,U,2)_" ("_$P(ECXDIV,U,3)_")"
"RTN","ECXAPRO2",105,0)
 I ECXALL=0 W !,"Division:                "_$P(ECXDIV,U,2)_" ("_$P(ECXDIV,U,3)_")"
"RTN","ECXAPRO2",106,0)
 W !,"Report Run Date/Time:    "_ECXRUN
"RTN","ECXAPRO2",107,0)
 W !,LN,!,ECXCODE," -- ",^TMP($J,"RMPRCODE",ECXCODE)
"RTN","ECXAPRO2",108,0)
 W !,"NAME",?6,"SSN",?14,"HCPCS",?21,"QTY",?27,"TYPE",?33,"COST",?42,"DATE",?50,"HCPCS DESC",?72,"STN #"
"RTN","ECXAPRO2",109,0)
 W !,LN,!
"RTN","ECXAPRO2",110,0)
 Q
"RTN","ECXAPRO3")
0^4^B11552568
"RTN","ECXAPRO3",1,0)
ECXAPRO3 ;ALB/JAP - PRO Extract Audit Report (cont) ; Nov 16, 1998
"RTN","ECXAPRO3",2,0)
 ;;3.0;DSS EXTRACTS;**21**;Dec 22, 1997
"RTN","ECXAPRO3",3,0)
 ;
"RTN","ECXAPRO3",4,0)
TEXT ;description of line numbers as in des^rmprn62 plus summary headers
"RTN","ECXAPRO3",5,0)
 ;;100;WHEELCHAIRS AND ACCESSORIES
"RTN","ECXAPRO3",6,0)
 ;;100 A;MOTORIZED
"RTN","ECXAPRO3",7,0)
 ;;100 A1;SCOOTERS
"RTN","ECXAPRO3",8,0)
 ;;100 B;MANUAL CUSTOM
"RTN","ECXAPRO3",9,0)
 ;;100 C;MANUAL A/O
"RTN","ECXAPRO3",10,0)
 ;;100 D;ACCESSORIES
"RTN","ECXAPRO3",11,0)
 ;;100 E;CUSHION FOAM
"RTN","ECXAPRO3",12,0)
 ;;100 F;CUSHION SPEC
"RTN","ECXAPRO3",13,0)
 ;;200;ARTIFICIAL LEGS
"RTN","ECXAPRO3",14,0)
 ;;200 A;LEG IPOP
"RTN","ECXAPRO3",15,0)
 ;;200 B;LEG TEM
"RTN","ECXAPRO3",16,0)
 ;;200 C;LEG PART FOOT
"RTN","ECXAPRO3",17,0)
 ;;200 E;LEG SYMES
"RTN","ECXAPRO3",18,0)
 ;;200 F;LEG B/K
"RTN","ECXAPRO3",19,0)
 ;;200 G;LEG A/O
"RTN","ECXAPRO3",20,0)
 ;;200 H;LEG A/K
"RTN","ECXAPRO3",21,0)
 ;;300;ARTIFICIAL ARMS AND TERMINAL DEVICES
"RTN","ECXAPRO3",22,0)
 ;;300 A;ARM B/E
"RTN","ECXAPRO3",23,0)
 ;;300 B;ARM, A/E
"RTN","ECXAPRO3",24,0)
 ;;300 C;COSMETIC GLOVES
"RTN","ECXAPRO3",25,0)
 ;;300 D;ARM, A/O
"RTN","ECXAPRO3",26,0)
 ;;300 E;TERMINAL DEVICES
"RTN","ECXAPRO3",27,0)
 ;;300 F;EXT. POWERED,ARM
"RTN","ECXAPRO3",28,0)
 ;;400;BRACES AND ORTHOTICS
"RTN","ECXAPRO3",29,0)
 ;;400 A;BRACE ANKLE
"RTN","ECXAPRO3",30,0)
 ;;400 B;BRACE LEG AK
"RTN","ECXAPRO3",31,0)
 ;;400 C;BRACE, SPINAL
"RTN","ECXAPRO3",32,0)
 ;;400 D;BRACE AL/OTH
"RTN","ECXAPRO3",33,0)
 ;;400 E;ELAS HOSE, EA
"RTN","ECXAPRO3",34,0)
 ;;400 F;BRACES, KNEE
"RTN","ECXAPRO3",35,0)
 ;;400 G;CORSET/BELT
"RTN","ECXAPRO3",36,0)
 ;;500;SHOES/ORTHOTICS
"RTN","ECXAPRO3",37,0)
 ;;500 A;ARCH SUPT, EA
"RTN","ECXAPRO3",38,0)
 ;;500 B;SHOE INLAY, EA
"RTN","ECXAPRO3",39,0)
 ;;500 C;SHOE MOLDED, EA
"RTN","ECXAPRO3",40,0)
 ;;500 D;SHOE ORTH OTH
"RTN","ECXAPRO3",41,0)
 ;;500 E;INSERTS, SHOE
"RTN","ECXAPRO3",42,0)
 ;;500 F;SHOES A/O, EA
"RTN","ECXAPRO3",43,0)
 ;;600;NEUROSENSORY AIDS
"RTN","ECXAPRO3",44,0)
 ;;600 1;EYEGLASSES PR
"RTN","ECXAPRO3",45,0)
 ;;600 A;SP OVER 2,500
"RTN","ECXAPRO3",46,0)
 ;;600 B;HEARING AIDS
"RTN","ECXAPRO3",47,0)
 ;;600 C;AID FOR BLIND
"RTN","ECXAPRO3",48,0)
 ;;600 D;CONT LENS, EA.
"RTN","ECXAPRO3",49,0)
 ;;600 E;EAR INSERT
"RTN","ECXAPRO3",50,0)
 ;;700;RESTORATIONS
"RTN","ECXAPRO3",51,0)
 ;;700 A;EYE
"RTN","ECXAPRO3",52,0)
 ;;700 B;FACIAL
"RTN","ECXAPRO3",53,0)
 ;;700 C;BODY, OTHER
"RTN","ECXAPRO3",54,0)
 ;;800;OXYGEN AND RESPIRATORY
"RTN","ECXAPRO3",55,0)
 ;;800 A;OXYGEN EQP
"RTN","ECXAPRO3",56,0)
 ;;800 B;OXYGEN CONCEN
"RTN","ECXAPRO3",57,0)
 ;;800 C;OXYGEN GAS
"RTN","ECXAPRO3",58,0)
 ;;800 D;OXYGEN, SUPPLIES
"RTN","ECXAPRO3",59,0)
 ;;800 E;OXYGEN LIQUID
"RTN","ECXAPRO3",60,0)
 ;;800 F;VENTILATOR, A/O
"RTN","ECXAPRO3",61,0)
 ;;900;MEDICAL EQUIPMENT
"RTN","ECXAPRO3",62,0)
 ;;900 A;WALKING AIDS
"RTN","ECXAPRO3",63,0)
 ;;900 B;INVALID LIFT
"RTN","ECXAPRO3",64,0)
 ;;900 C;BED HOSP STD
"RTN","ECXAPRO3",65,0)
 ;;900 D;BED HOSP SPEC
"RTN","ECXAPRO3",66,0)
 ;;900 E;MATTRESS STAN
"RTN","ECXAPRO3",67,0)
 ;;900 F;MATTRESS SPEC
"RTN","ECXAPRO3",68,0)
 ;;900 G;BED, ACCESSORIES
"RTN","ECXAPRO3",69,0)
 ;;900 H;ENVIRON CONTR
"RTN","ECXAPRO3",70,0)
 ;;900 I;SPEC HOME EQP (SAFETY)
"RTN","ECXAPRO3",71,0)
 ;;900 J;TENS UNIT
"RTN","ECXAPRO3",72,0)
 ;;900 K;MED EQP AL/OTH
"RTN","ECXAPRO3",73,0)
 ;;900 L;EQP RENTAL
"RTN","ECXAPRO3",74,0)
 ;;910;ALL OTHER SUPPLIES AND EQUIPMENT
"RTN","ECXAPRO3",75,0)
 ;;910 A;MED SUP AL/OTH
"RTN","ECXAPRO3",76,0)
 ;;920;HOME DIALYSIS PROGRAM
"RTN","ECXAPRO3",77,0)
 ;;920 A;HOME DIAL EQP
"RTN","ECXAPRO3",78,0)
 ;;920 B;HOME DIAL SUP
"RTN","ECXAPRO3",79,0)
 ;;930;ADAPTIVE EQUIPMENT
"RTN","ECXAPRO3",80,0)
 ;;930 A;MOD VANS
"RTN","ECXAPRO3",81,0)
 ;;930 B;ADAPT EQP AL/OTH
"RTN","ECXAPRO3",82,0)
 ;;999;MISC
"RTN","ECXAPRO3",83,0)
 ;;999 A;AL/OTH ITEMS
"RTN","ECXAPRO3",84,0)
 ;;999 X;HCPCS NOT GRP
"RTN","ECXAPRO3",85,0)
 ;;999 Z;NO HCPCS
"RTN","ECXAPRO3",86,0)
 ;;R07;HEARING AID, LOCAL REPAIRS
"RTN","ECXAPRO3",87,0)
 ;;R10;WHEELCHAIRS AND ACCESSORIES
"RTN","ECXAPRO3",88,0)
 ;;R10 ;WHEELCHAIR
"RTN","ECXAPRO3",89,0)
 ;;R20;ARTIFICIAL LEGS
"RTN","ECXAPRO3",90,0)
 ;;R20 A;LEG A/K
"RTN","ECXAPRO3",91,0)
 ;;R20 B;LEG B/K, PTB
"RTN","ECXAPRO3",92,0)
 ;;R20 C;LEG B/K, STD
"RTN","ECXAPRO3",93,0)
 ;;R20 D;LEG ALL OTHER
"RTN","ECXAPRO3",94,0)
 ;;R30;ARTIFICIAL ARMS AND TERMINAL DEVICES
"RTN","ECXAPRO3",95,0)
 ;;R30 ;ART ARM,TOTAL
"RTN","ECXAPRO3",96,0)
 ;;R40;BRACES AND ORTHOTICS
"RTN","ECXAPRO3",97,0)
 ;;R40 ;BRACE TOTAL
"RTN","ECXAPRO3",98,0)
 ;;R50;SHOES/ORTHOTICS
"RTN","ECXAPRO3",99,0)
 ;;R50 A;ORTH SHOE ALL
"RTN","ECXAPRO3",100,0)
 ;;R50 B;SHOE MOD
"RTN","ECXAPRO3",101,0)
 ;;R50 C;A/O ITEM SERV
"RTN","ECXAPRO3",102,0)
 ;;R60;NEUROSENSORY AIDS
"RTN","ECXAPRO3",103,0)
 ;;R60 A;AID FOR BLIND
"RTN","ECXAPRO3",104,0)
 ;;R60 B;EYEGLASS RPR
"RTN","ECXAPRO3",105,0)
 ;;R60 C;HEARING AID
"RTN","ECXAPRO3",106,0)
 ;;R70;HOME DIALYSIS EQUIPMENT
"RTN","ECXAPRO3",107,0)
 ;;R70 ;HOME DIAL EQU
"RTN","ECXAPRO3",108,0)
 ;;R80;MEDICAL EQUIPMENT
"RTN","ECXAPRO3",109,0)
 ;;R80 A;INVALID LIFTS
"RTN","ECXAPRO3",110,0)
 ;;R80 B;REPAIR TO ECU
"RTN","ECXAPRO3",111,0)
 ;;R80 C;MED EQUIP A/O
"RTN","ECXAPRO3",112,0)
 ;;R90;ALL OTHER
"RTN","ECXAPRO3",113,0)
 ;;R90 ;ALL OTHER
"RTN","ECXAPRO3",114,0)
 ;;R90 A;SHIPPING
"RTN","ECXAPRO3",115,0)
 ;;R99 X;HCPCS NOT GRP
"RTN","ECXAPRO3",116,0)
 ;;R99 Z;NO HCPCS
"RTN","ECXAPRO3",117,0)
 ;;QUIT
"RTN","ECXCPRO")
0^5^B31486510
"RTN","ECXCPRO",1,0)
ECXCPRO ;ALB/JAP - PRO Extract YTD Report ; Dec 20, 1998
"RTN","ECXCPRO",2,0)
 ;;3.0;DSS EXTRACTS;**21**;Dec 22, 1997
"RTN","ECXCPRO",3,0)
 ;accumulates extract data by hcpcs code for all extracts in fiscal year date range
"RTN","ECXCPRO",4,0)
 ;if an extract has been purged, then totals will be falsely low
"RTN","ECXCPRO",5,0)
 ;if more than 1 extract exists for a particular month, then totals will be falsely high
"RTN","ECXCPRO",6,0)
 ;if site is multidivisional, then user can generate report for
"RTN","ECXCPRO",7,0)
 ;  any one division - data stored under divisional station# (e.g., 326 or 326AB)
"RTN","ECXCPRO",8,0)
 ;  or for entire facility - data stored under primary station# (e.g., 326) but includes data from all subdivisions
"RTN","ECXCPRO",9,0)
 ;if site is non-divisional, then data stored under facility station#
"RTN","ECXCPRO",10,0)
 ;
"RTN","ECXCPRO",11,0)
 ;
"RTN","ECXCPRO",12,0)
EN ;setup & queue
"RTN","ECXCPRO",13,0)
 N DIC,DA,DR,DIQ,DIR,DIRUT,DTOUT,DUOUT,DIV,LAST,OUT
"RTN","ECXCPRO",14,0)
 S ECXERR=0
"RTN","ECXCPRO",15,0)
 S ECXHEAD="PRO"
"RTN","ECXCPRO",16,0)
 W !!,"Setup for PRO Extract YTD HCPCS Report --",!
"RTN","ECXCPRO",17,0)
 ;determine primary division
"RTN","ECXCPRO",18,0)
 W !,"If you belong to more than one Primary Division, you must"
"RTN","ECXCPRO",19,0)
 W !,"select a Primary Division for the report.",!
"RTN","ECXCPRO",20,0)
 S ECXPRIME=$$PDIV^ECXPUTL
"RTN","ECXCPRO",21,0)
 I ECXPRIME=0 D ^ECXKILL Q
"RTN","ECXCPRO",22,0)
 S DA=ECXPRIME,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99" D EN^DIQ1
"RTN","ECXCPRO",23,0)
 S ECXPRIME=ECXPRIME_U_$G(ECXDIC(4,DA,99,"I"))_U_$G(ECXDIC(4,DA,.01,"I"))
"RTN","ECXCPRO",24,0)
 ;select 1 or more prosthetics divisions for report
"RTN","ECXCPRO",25,0)
 D PRO^ECXDVSN2(DUZ,ECXPRIME,.ECXDIV,.ECXALL,.ECXERR)
"RTN","ECXCPRO",26,0)
 I ECXERR D  Q
"RTN","ECXCPRO",27,0)
 .D ^ECXKILL W !!,?5,"Try again later... exiting.",!
"RTN","ECXCPRO",28,0)
 ;determine fiscal year of report
"RTN","ECXCPRO",29,0)
 S DIR(0)="SMBA^C:CURRENT;P:PREVIOUS",DIR("A")="Select C(urrent) or P(revious) Fiscal Year: ",DIR("B")="CURRENT"
"RTN","ECXCPRO",30,0)
 W ! K X,Y D ^DIR K DIR
"RTN","ECXCPRO",31,0)
 I $D(DUOUT)!($D(DTOUT)) D  Q
"RTN","ECXCPRO",32,0)
 .D ^ECXKILL W !!,?5,"Try again later... exiting.",!
"RTN","ECXCPRO",33,0)
 I Y="C" D
"RTN","ECXCPRO",34,0)
 .S X=$$CYFY^ECXUTL1(DT),ECXARRAY("START")=$P(X,U,3),ECXARRAY("END")=$P(X,U,4)
"RTN","ECXCPRO",35,0)
 I Y="P" D
"RTN","ECXCPRO",36,0)
 .S C=$E(DT,1),YR=$E(DT,2,3),MON=$E(DT,4,5) S:+MON<10 YR=YR-1 S X1=C_YR_"0930"
"RTN","ECXCPRO",37,0)
 .S X=$$CYFY^ECXUTL1(X1),ECXARRAY("START")=$P(X,U,3),ECXARRAY("END")=$P(X,U,4)
"RTN","ECXCPRO",38,0)
 .K C,MON,YR,X1
"RTN","ECXCPRO",39,0)
 ;setup variables for taskmanager
"RTN","ECXCPRO",40,0)
 S ECXPGM="PROCESS^ECXCPRO",ECXDESC="PRO Extract YTD Lab Report"
"RTN","ECXCPRO",41,0)
 S ECXSAVE("ECXHEAD")="",ECXSAVE("ECXDIV(")="",ECXSAVE("ECXARRAY(")="",ECXSAVE("ECXPRIME")="",ECXSAVE("ECXALL")=""
"RTN","ECXCPRO",42,0)
 ;determine output device and queue if requested
"RTN","ECXCPRO",43,0)
 W !!,"Please note: The PRO Extract YTD HCPCS Report requires 132 columns."
"RTN","ECXCPRO",44,0)
 W !,"             Select an appropriate device for output."
"RTN","ECXCPRO",45,0)
 W ! D DEVICE^ECXUTLA(ECXPGM,ECXDESC,.ECXSAVE)
"RTN","ECXCPRO",46,0)
 I ECXSAVE("POP")=1 W ! D ^ECXKILL Q
"RTN","ECXCPRO",47,0)
 I ECXSAVE("ZTSK")=0 D
"RTN","ECXCPRO",48,0)
 .K ECXSAVE,ECXPGM,ECXDESC
"RTN","ECXCPRO",49,0)
 .D PROCESS
"RTN","ECXCPRO",50,0)
 ;clean-up and close
"RTN","ECXCPRO",51,0)
 I IO'=IO(0) D ^%ZISC
"RTN","ECXCPRO",52,0)
 D HOME^%ZIS
"RTN","ECXCPRO",53,0)
 Q
"RTN","ECXCPRO",54,0)
 ;
"RTN","ECXCPRO",55,0)
PROCESS ;begin processing
"RTN","ECXCPRO",56,0)
 N DIVISION,E,EXTRACT,REC,NODE0,NODE1,LASTDAY
"RTN","ECXCPRO",57,0)
 K ^TMP($J,"ECXP") S LASTDAY=""
"RTN","ECXCPRO",58,0)
 ;determine which extracts contain data for report
"RTN","ECXCPRO",59,0)
 S (EXTRACT,E)=0
"RTN","ECXCPRO",60,0)
 F  S E=$O(^ECX(727,"E",ECXHEAD,E)) Q:'E  D
"RTN","ECXCPRO",61,0)
 .Q:'$D(^ECX(727,E,0))
"RTN","ECXCPRO",62,0)
 .Q:$P($G(^ECX(727,E,0)),U,4)<ECXARRAY("START")
"RTN","ECXCPRO",63,0)
 .Q:$P($G(^ECX(727,E,0)),U,4)>ECXARRAY("END")
"RTN","ECXCPRO",64,0)
 .Q:$G(^ECX(727,E,"DIV"))'=+ECXPRIME
"RTN","ECXCPRO",65,0)
 .S EXTRACT(E)=^ECX(727,E,0)
"RTN","ECXCPRO",66,0)
 .I $P(EXTRACT(E),U,5)>LASTDAY S LASTDAY=$P(EXTRACT(E),U,5)
"RTN","ECXCPRO",67,0)
 ;setup array of station numbers included in report
"RTN","ECXCPRO",68,0)
 F DIV=0:0 S DIV=$O(ECXDIV(DIV)) Q:'DIV  S ECXSTAT=$P(ECXDIV(DIV),U,2),DIVISION(ECXSTAT)=ECXDIV(DIV)
"RTN","ECXCPRO",69,0)
 ;get the extract data
"RTN","ECXCPRO",70,0)
 S E=0 F  S E=$O(EXTRACT(E)) Q:'E  S REC=0 I $D(^ECX(727.826,"AC",E)) F  S REC=$O(^ECX(727.826,"AC",E,REC)) Q:'REC  D
"RTN","ECXCPRO",71,0)
 .S NODE0=$G(^ECX(727.826,REC,0)),NODE1=$G(^ECX(727.826,REC,1)) Q:NODE0=""
"RTN","ECXCPRO",72,0)
 .S (ECXCTAMT,ECXLLC,ECXLMC)=0
"RTN","ECXCPRO",73,0)
 .S ECXFELOC=$P(NODE0,U,10),ECXFEKEY=$P(NODE0,U,11)
"RTN","ECXCPRO",74,0)
 .S ECXHCPC=$E(ECXFEKEY,1,5),ECXTYPE=$E(ECXFEKEY,6),ECXSRCE=$E(ECXFEKEY,7)
"RTN","ECXCPRO",75,0)
 .S ECXQTY=$P(NODE0,U,12),ECXCTAMT=$P(NODE0,U,21),ECXGRPR=$P(NODE1,U,4)
"RTN","ECXCPRO",76,0)
 .I ECXFELOC["NONL" S ECXSTAT=$P(ECXFELOC,"NONL",1),ECXFORM="NONL"
"RTN","ECXCPRO",77,0)
 .;if this station is lab requesting station, then count lab transaction
"RTN","ECXCPRO",78,0)
 .I ECXFELOC["ORD" D
"RTN","ECXCPRO",79,0)
 ..S ECXSTAT=$P(ECXFELOC,"ORD",1),ECXFORM="ORD"
"RTN","ECXCPRO",80,0)
 ..S ECXLLC=$P(NODE0,U,22),ECXLMC=$P(NODE0,U,23)
"RTN","ECXCPRO",81,0)
 .;ignore record for receiving station feeder location
"RTN","ECXCPRO",82,0)
 .Q:ECXFELOC["LAB"
"RTN","ECXCPRO",83,0)
 .;ignore record if division not included in this report
"RTN","ECXCPRO",84,0)
 .Q:ECXSTAT=""  Q:'$D(DIVISION(ECXSTAT))
"RTN","ECXCPRO",85,0)
 .;if combining data from all subdivisions, then set in ^tmp using primary station#
"RTN","ECXCPRO",86,0)
 .I ECXALL=1 S ECXSTAT=$P(ECXPRIME,U,2)
"RTN","ECXCPRO",87,0)
 .;be sure there's no padding on cost variables
"RTN","ECXCPRO",88,0)
 .S ECXCTAMT=+$TR(ECXCTAMT," ",0),ECXLLC=+$TR(ECXLLC," ",0),ECXLMC=+$TR(ECXLMC," ",0)
"RTN","ECXCPRO",89,0)
 .;tmp global holds - com qty^com cost^va nonlab qty^va nonlab cost^lab qty^lab labor cost^lab matrl cost
"RTN","ECXCPRO",90,0)
 .I '$D(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC)) S ^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC)="0^0^0^0^0^0^0"
"RTN","ECXCPRO",91,0)
 .I ECXSRCE="C",ECXFORM="NONL" D
"RTN","ECXCPRO",92,0)
 ..S $P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,1)=$P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,1)+ECXQTY
"RTN","ECXCPRO",93,0)
 ..S $P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,2)=$P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,2)+ECXCTAMT
"RTN","ECXCPRO",94,0)
 .I ECXSRCE="V",ECXFORM="NONL" D
"RTN","ECXCPRO",95,0)
 ..S $P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,3)=$P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,3)+ECXQTY
"RTN","ECXCPRO",96,0)
 ..S $P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,4)=$P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,4)+ECXCTAMT
"RTN","ECXCPRO",97,0)
 .I ECXFORM="ORD" D
"RTN","ECXCPRO",98,0)
 ..S $P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,5)=$P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,5)+ECXQTY
"RTN","ECXCPRO",99,0)
 ..S $P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,6)=$P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,6)+ECXLLC
"RTN","ECXCPRO",100,0)
 ..S $P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,7)=$P(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC),U,7)+ECXLMC
"RTN","ECXCPRO",101,0)
 ;setup hcpcs descriptions
"RTN","ECXCPRO",102,0)
 D HCPCS
"RTN","ECXCPRO",103,0)
 ;print report
"RTN","ECXCPRO",104,0)
 D PRINT^ECXCPRO1
"RTN","ECXCPRO",105,0)
 ;cleanup
"RTN","ECXCPRO",106,0)
 D AUDIT^ECXKILL
"RTN","ECXCPRO",107,0)
 Q
"RTN","ECXCPRO",108,0)
 ;
"RTN","ECXCPRO",109,0)
HCPCS ;setup hcpcs cross-reference
"RTN","ECXCPRO",110,0)
 N H,CPT,CPTNM,DESC
"RTN","ECXCPRO",111,0)
 S H=0
"RTN","ECXCPRO",112,0)
 F  S H=$O(^RMPR(661.1,H)) Q:+H<1  D
"RTN","ECXCPRO",113,0)
 .;don't skip inactive hcpcs in case doing previous fy
"RTN","ECXCPRO",114,0)
 .S CPTNM="",CPT=$P(^RMPR(661.1,H,0),U,4)
"RTN","ECXCPRO",115,0)
 .I +CPT>0 S CPTNM=$P(^ICPT(CPT,0),U,1),DESC=$E($P(^ICPT(CPT,0),U,2),1,26)
"RTN","ECXCPRO",116,0)
 .Q:CPTNM=""
"RTN","ECXCPRO",117,0)
 .S ^TMP($J,"HCPCS",CPTNM)=DESC
"RTN","ECXCPRO",118,0)
 Q
"RTN","ECXCPRO1")
0^6^B12622997
"RTN","ECXCPRO1",1,0)
ECXCPRO1 ;ALB/JAP - PRO Extract YTD Report (cont) ; Dec 22, 1998
"RTN","ECXCPRO1",2,0)
 ;;3.0;DSS EXTRACTS;**21**;Dec 22, 1997
"RTN","ECXCPRO1",3,0)
 ;
"RTN","ECXCPRO1",4,0)
PRINT ;print report
"RTN","ECXCPRO1",5,0)
 N PG,LN,QFLG,NODE,DESC,AVE,JJ,SS,TOTAL,TOT,TQTY
"RTN","ECXCPRO1",6,0)
 U IO
"RTN","ECXCPRO1",7,0)
 S QFLG=0,$P(LN,"-",132)=""
"RTN","ECXCPRO1",8,0)
 S Y=ECXARRAY("START") D DD^%DT S ECXSTART=Y
"RTN","ECXCPRO1",9,0)
 S Y=$S(LASTDAY:LASTDAY,ECXARRAY("END")>DT:DT,1:ECXARRAY("END")) D DD^%DT S ECXEND=Y
"RTN","ECXCPRO1",10,0)
 D NOW^%DTC S Y=$E(%,1,12) D DD^%DT S ECXRUN=Y
"RTN","ECXCPRO1",11,0)
 ;if ecxall=0, then only one subdivision of multidivision facility
"RTN","ECXCPRO1",12,0)
 ;if ecxall=1, then either entire facility (i.e., non-divisional), or all subdivisions combined under primary station#
"RTN","ECXCPRO1",13,0)
 ;but it's possible that no extract data was found
"RTN","ECXCPRO1",14,0)
 S ECXSTAT="",ECXSTAT=$O(^TMP($J,"ECXP",ECXSTAT)) I ECXSTAT="" D  Q
"RTN","ECXCPRO1",15,0)
 .I ECXALL=0 S ECXSTAT=$O(DIVISION(""))
"RTN","ECXCPRO1",16,0)
 .F ECXTYPE="N","X" D  Q:QFLG
"RTN","ECXCPRO1",17,0)
 ..S PG=0 D HEADER
"RTN","ECXCPRO1",18,0)
 ..W !!,?36,"No extract data available."
"RTN","ECXCPRO1",19,0)
 ..I $E(IOST)="C" D  Q:QFLG
"RTN","ECXCPRO1",20,0)
 ...S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXCPRO1",21,0)
 ...S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXCPRO1",22,0)
 F ECXTYPE="N","X" D  Q:QFLG
"RTN","ECXCPRO1",23,0)
 .S PG=0 D HEADER
"RTN","ECXCPRO1",24,0)
 .S ECXHCPC=""
"RTN","ECXCPRO1",25,0)
 .I '$D(^TMP($J,"ECXP",ECXSTAT,ECXTYPE)) D  Q
"RTN","ECXCPRO1",26,0)
 ..W !!,?36,"No extract data available."
"RTN","ECXCPRO1",27,0)
 ..I $E(IOST)="C" D  Q:QFLG
"RTN","ECXCPRO1",28,0)
 ...S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXCPRO1",29,0)
 ...S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXCPRO1",30,0)
 .F  S ECXHCPC=$O(^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC)) Q:ECXHCPC=""  D  Q:QFLG
"RTN","ECXCPRO1",31,0)
 ..S DESC=$G(^TMP($J,"HCPCS",ECXHCPC)) S:DESC="" DESC="(Unknown)" S DESC=ECXHCPC_" "_DESC
"RTN","ECXCPRO1",32,0)
 ..S NODE=^TMP($J,"ECXP",ECXSTAT,ECXTYPE,ECXHCPC)
"RTN","ECXCPRO1",33,0)
 ..;node holds - com qty^com cost^va nonlab qty^va nonlab cost^lab qty^lab labor cost^lab matrl cost
"RTN","ECXCPRO1",34,0)
 ..F I=1:1:7 S X(I)=+$P(NODE,U,I)
"RTN","ECXCPRO1",35,0)
 ..S AVE("C")=0,AVE("V")=0,AVE("L")=0,AVE("ALL")=0,TOT("L")=0,TOTAL=0,TQTY=0
"RTN","ECXCPRO1",36,0)
 ..S:X(1)>0 AVE("C")=X(2)/X(1) S:X(3)>0 AVE("V")=X(4)/X(3) S TOT("L")=X(6)+X(7) S:X(5)>0 AVE("L")=TOT("L")/X(5)
"RTN","ECXCPRO1",37,0)
 ..S TQTY=X(1)+X(3)+X(5),TOTAL=X(2)+X(4)+TOT("L")
"RTN","ECXCPRO1",38,0)
 ..S:TQTY>0 AVE("ALL")=TOTAL/TQTY
"RTN","ECXCPRO1",39,0)
 ..D:($Y+3>IOSL) HEADER Q:QFLG
"RTN","ECXCPRO1",40,0)
 ..W !,DESC,?33,$J(X(1),8,0),?43,$J(X(2),8,0),?53,$J(AVE("C"),8,2),?63,$J(X(3),8,0),?73,$J(X(4),8,0),?83,$J(AVE("V"),8,2),?93,$J(X(5),8,0),?103,$J(TOT("L"),8,0),?113,$J(AVE("L"),8,2),?123,$J(AVE("ALL"),8,2)
"RTN","ECXCPRO1",41,0)
 .I 'QFLG,$E(IOST)="C" D
"RTN","ECXCPRO1",42,0)
 ..S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXCPRO1",43,0)
 ..S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXCPRO1",44,0)
 W @IOF
"RTN","ECXCPRO1",45,0)
 Q
"RTN","ECXCPRO1",46,0)
 ;
"RTN","ECXCPRO1",47,0)
HEADER ;header & page control
"RTN","ECXCPRO1",48,0)
 I $E(IOST)="C" D
"RTN","ECXCPRO1",49,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXCPRO1",50,0)
 .I PG>0 S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXCPRO1",51,0)
 Q:QFLG
"RTN","ECXCPRO1",52,0)
 W:$Y!($E(IOST)="C") @IOF S PG=PG+1
"RTN","ECXCPRO1",53,0)
 W "Prosthetics (PRO) Extract YTD HCPCS Report",?122,"Page "_PG
"RTN","ECXCPRO1",54,0)
 W !,"FY Date Range: "_ECXSTART_" to "_ECXEND
"RTN","ECXCPRO1",55,0)
 I ECXALL=0 W !,"Division:      "_$P(DIVISION(ECXSTAT),U,3)_" ("_$P(DIVISION(ECXSTAT),U,2)_")"
"RTN","ECXCPRO1",56,0)
 I ECXALL=1 W !,"Facility:      "_$P(ECXPRIME,U,3)_" ("_$P(ECXPRIME,U,2)_")"
"RTN","ECXCPRO1",57,0)
 W !,"Run Date/Time: "_ECXRUN
"RTN","ECXCPRO1",58,0)
 W:ECXTYPE="N" !!,"REPORT OF NEW PROSTHETICS ACTIVITIES (Initial, Replacement, or Spare)"
"RTN","ECXCPRO1",59,0)
 W:ECXTYPE="X" !!,"REPORT OF REPAIR PROSTHETICS ACTIVITIES"
"RTN","ECXCPRO1",60,0)
 W !,?36,"Qty.",?44,"Total $",?55,"Ave. $",?67,"Qty.",?74,"Total $",?85,"Ave. $",?97,"Qty.",?104,"Total $",?114,"Ave. $",?125,"Ave. $"
"RTN","ECXCPRO1",61,0)
 W !,"HCPCS (CPT)",?35,"-Comm-",?44,"-Comm-",?55,"-Comm-",?67,"-VA-",?75,"-VA-",?85,"-VA-",?96,"-Lab-",?105,"-Lab-",?114,"-Lab-",?125,"-All-"
"RTN","ECXCPRO1",62,0)
 W !,LN,!
"RTN","ECXCPRO1",63,0)
 Q
"RTN","ECXKILL")
0^7^B12786818
"RTN","ECXKILL",1,0)
ECXKILL ;BIR/DMA,PTD-Kill Local Variables ; 02/06/97 10:25 [ 03/27/97  12:43 PM ]
"RTN","ECXKILL",2,0)
 ;;3.0;DSS EXTRACTS;**9,8,21**;Dec 22, 1997
"RTN","ECXKILL",3,0)
 K %,%DT,%Y,%ZIS,A,A1,A2,ABR,B,BY,D,D0,D1,DA,DAT,DATA,DATA1,DATA2,DATA6,DATAOP,DD,DFN,DHDH,DIC,DIE,DIK,DINUM,DIQ
"RTN","ECXKILL",4,0)
 K DIR,DIRUT,DO,DOB,DR,DTOUT,DUOUT,EC,EC0,EC1,EC10,EC11,EC16,EC2,EC23,EC2NODE,EC3,EC42,EC50,EC6,EC7,ECA,ECAC,ECACA,ECAD,ECADM,ECALL
"RTN","ECXKILL",5,0)
 K ECANE,ECAO,ECARG,ECAS,ECAT,ECATSV,ECB,ECC,ECCA,ECCAN,ECCAT,ECCH,ECCN,ECCNT,ECCS,ECCSC,ECD,ECD0,ECD1,ECDA,ECDAL,ECDAT
"RTN","ECXKILL",6,0)
 K ECDATA,ECDATA1,ECDATE,ECDEN,ECDEX,ECDF,ECDFN,ECDFN0,ECDI,ECDIA,ECDIF,ECDIV,ECDL,ECDN,ECDNEW,ECDO,ECDOC,ECDR,ECDRG,ECDS,ECDSSU,ECDT,ECDTTM
"RTN","ECXKILL",7,0)
 K ECDU,ECEC0,ECED,ECED1,ECEDN,ECEDNEW,ECF,ECF1,ECFD,ECFDT,ECFILE,ECFK,ECFL,ECFR,ECGRP,ECH,ECHD,ECHEAD,ECI,ECID,ECIEN,ECIFN,ECIN
"RTN","ECXKILL",8,0)
 K ECINST,ECINV,ECIV,ECJ,ECK,ECL,ECL1,ECLAN,ECLAST,ECLDT,ECLINK,ECLIST,ECLL,ECLN,ECLOC,ECLRN,ECLX,ECLY,ECM,ECMAX,ECMIN
"RTN","ECXKILL",9,0)
 K ECXMISS,ECMN,ECMOD,ECMODS,ECMORE,ECMS,ECMSG,ECMSN,ECMT,ECMW,ECMY,ECN,ECNA,ECNDC,ECNDF,ECNFC,ECNL,ECNO,ECNODE,ECNOGO
"RTN","ECXKILL",10,0)
 K ECNT,ECO,ECO0,ECO1,ECO2,ECOB,ECODE,ECODE0,ECODE1,ECOLD,ECONE,ECOPAY,ECOPAYT,ECORTY,ECOS,ECP,ECPACK,ECPCE,ECPCE1,ECPCE2,ECPCE3,ECPCE4,ECPCE5,ECPCE6,ECPCE7,ECPIECE,ECPN,ECPRC,ECPRO
"RTN","ECXKILL",11,0)
 K ECPROF,ECPT,ECPTF,ECPTPR,ECPTTM,ECQ,ECQT,ECQTY,ECRD,ECRE,ECRED,ECREF,ECRFL,ECRN,ECROU,ECRR,ECRS,ECRSD,ECRTN,ECRX,ECS,ECSA,ECSC
"RTN","ECXKILL",12,0)
 K ECSD,ECSD1,ECSDN,ECSN,ECSR,ECSS,ECST,ECSTOP,ECSU,ECT,ECT1,ECTD,ECTD1,ECTEMP,ECTM,ECTNTL,ECTOTAL,ECTREAT,ECTRT,ECTS,ECTY,ECU,ECU2,ECU2A
"RTN","ECXKILL",13,0)
 K ECU3,ECU3A,ECUD,ECUI,ECUN,ECUN1,ECUNIT,ECURG,ECUT,ECUT2,ECUT3,ECV,ECW,ECWC,ECWD,ECX,ECXB,ECXLNCNT,ECXMDA,ECXMDT,ECXNOW,ECXQUEUE,ECXS,ECXSTART
"RTN","ECXKILL",14,0)
 K ECY,ECYM,ECZ,ECZNODE,ELIG,ENL,FAC,FLDS,FR,I,ID,IOP,J,K,L,LOC,LOS,LRDFN,NAM,OPC,P,P1,P11,P2,P3,POP,Q,RACE,RD,RESP,QFLG
"RTN","ECXKILL",15,0)
 K SC,SRDA,SRNM,SSN,STC,SU,TEN,TES,TIME,TO,TOT,VAERR,VAIP,VET,W,WTO,X,X1,X2,XMDUZ,XMER,XMFROM,XMREC,XMRG,XMSER,XMSUB
"RTN","ECXKILL",16,0)
 K XMTEXT,XMY,XMZ,XQMSG,XQSOP,XQSUB,XX,Y,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK,ECSTA,ECCTY,STATE,COUNTY,ECVER
"RTN","ECXKILL",17,0)
 K ECCPT,ECEKG,ECICD,ECPROV,ECREC,ECVAL,ECVIS,NCNTR,PTADT,STOP,ECIVRM,ECOR,ECWK,ECWKLD,LREDT,LRSDT,FD,ECHL,ECARSC
"RTN","ECXKILL",18,0)
 K ECDTST,ECLTST,ECODE2,ECORDT,ECORTM,ECRDDT,ECRDTM,ECRES,ECWCDA,ECXINST,ECX2TME
"RTN","ECXKILL",19,0)
 K ECXATT,ECXATTL,ECXATTN,ECXLOS,ECXLOSA,ECXLOSP,ECXPRV,ECXPRVL,ECXPRVN,ECXTRT,ECXTRTL,ECXTRTN,ECXSPC,ECXSPCL,ECXSPCN
"RTN","ECXKILL",20,0)
 K ECCSC,ECXSC,ECXP1,ECXP2,ECXP3,ECXDSSI,ECXYM,ECXDIV,ECXDAY,ECXSSN
"RTN","ECXKILL",21,0)
 ;
"RTN","ECXKILL",22,0)
AUDIT ;kill audit report variables, close slave printer
"RTN","ECXKILL",23,0)
 I IO=IO(0),IOST'="C" D ^%ZISC
"RTN","ECXKILL",24,0)
 K ECX,ECXARRAY,ECXACC,ECXALL,ECXAUD,ECXCODE,ECXD,ECXDEF,ECXDESC,ECXDIV
"RTN","ECXKILL",25,0)
 K ECXEND,ECXERR,ECXEXT,ECXHEAD,ECXLOC,ECXPGM,ECXPHCPC,ECXPRIME,ECXPRO,ECXREPT,ECXRUN,ECXSAVE,ECXSTART,ECXSRCE
"RTN","ECXKILL",26,0)
 K ECXCTAMT,ECXFEKEY,ECXFELOC,ECXFORM,ECXGRPR,ECXHCPC,ECXLAB,ECXLLC,ECXLMC,ECXQTY,ECXREQ,ECXSTAT,ECXTYPE
"RTN","ECXKILL",27,0)
 K IO("Q"),POP,DIR,DIC,DIE,DA,DR,DO,DIRUT,DUOUT,DTOUT
"RTN","ECXKILL",28,0)
 K ^TMP($J)
"RTN","ECXKILL",29,0)
 Q
"RTN","ECXLPRO")
0^8^B25353447
"RTN","ECXLPRO",1,0)
ECXLPRO ;ALB/JAP - PRO Extract YTD Lab Report ; Feb 17, 1999
"RTN","ECXLPRO",2,0)
 ;;3.0;DSS EXTRACTS;**21**;Dec 22, 1997
"RTN","ECXLPRO",3,0)
 ;for data associated with prosthetic items produced by facility laboratory
"RTN","ECXLPRO",4,0)
 ;accumulates extract data by hcpcs code for all extracts in fiscal year date range
"RTN","ECXLPRO",5,0)
 ;if an extract has been purged, then totals will be falsely low
"RTN","ECXLPRO",6,0)
 ;if more than 1 extract exists for a particular month, then totals will be falsely high
"RTN","ECXLPRO",7,0)
 ;if site is multidivisional, then user can generate report for
"RTN","ECXLPRO",8,0)
 ;  any one division - data stored under divisional station# (e.g., 326 or 326AB)
"RTN","ECXLPRO",9,0)
 ;  or for entire facility - data stored under primary station# (e.g., 326) but includes data from all subdivisions
"RTN","ECXLPRO",10,0)
 ;if site is non-divisional, then data stored under facility station#
"RTN","ECXLPRO",11,0)
 ;
"RTN","ECXLPRO",12,0)
EN ;setup & queue
"RTN","ECXLPRO",13,0)
 N DIC,DA,DR,DIQ,DIR,DIRUT,DTOUT,DUOUT,DIV,LAST,OUT
"RTN","ECXLPRO",14,0)
 S ECXERR=0
"RTN","ECXLPRO",15,0)
 S ECXHEAD="PRO"
"RTN","ECXLPRO",16,0)
 W !!,"Setup for PRO Extract YTD Laboratory Report --",!
"RTN","ECXLPRO",17,0)
 ;determine primary division
"RTN","ECXLPRO",18,0)
 W !,"If you belong to more than one Primary Division, you must"
"RTN","ECXLPRO",19,0)
 W !,"select a Primary Division for the report.",!
"RTN","ECXLPRO",20,0)
 S ECXPRIME=$$PDIV^ECXPUTL
"RTN","ECXLPRO",21,0)
 I ECXPRIME=0 D ^ECXKILL Q
"RTN","ECXLPRO",22,0)
 S DA=ECXPRIME,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99" D EN^DIQ1
"RTN","ECXLPRO",23,0)
 S ECXPRIME=ECXPRIME_U_$G(ECXDIC(4,DA,99,"I"))_U_$G(ECXDIC(4,DA,.01,"I"))
"RTN","ECXLPRO",24,0)
 ;get all prosthetics divisions for report
"RTN","ECXLPRO",25,0)
 S ECXALL=1
"RTN","ECXLPRO",26,0)
 D PDIV3^ECXPUTL(DUZ,ECXPRIME,.ECXDIV)
"RTN","ECXLPRO",27,0)
 I ECXERR D  Q
"RTN","ECXLPRO",28,0)
 .D ^ECXKILL W !!,?5,"Try again later... exiting.",!
"RTN","ECXLPRO",29,0)
 ;determine fiscal year of report
"RTN","ECXLPRO",30,0)
 S DIR(0)="SMBA^C:CURRENT;P:PREVIOUS",DIR("A")="Select C(urrent) or P(revious) Fiscal Year: ",DIR("B")="CURRENT"
"RTN","ECXLPRO",31,0)
 W ! K X,Y D ^DIR K DIR
"RTN","ECXLPRO",32,0)
 I $D(DUOUT)!($D(DTOUT)) D  Q
"RTN","ECXLPRO",33,0)
 .D ^ECXKILL W !!,?5,"Try again later... exiting.",!
"RTN","ECXLPRO",34,0)
 I Y="C" D
"RTN","ECXLPRO",35,0)
 .S X=$$CYFY^ECXUTL1(DT),ECXARRAY("START")=$P(X,U,3),ECXARRAY("END")=$P(X,U,4)
"RTN","ECXLPRO",36,0)
 I Y="P" D
"RTN","ECXLPRO",37,0)
 .S C=$E(DT,1),YR=$E(DT,2,3),MON=$E(DT,4,5) S:+MON<10 YR=YR-1 S X1=C_YR_"0930"
"RTN","ECXLPRO",38,0)
 .S X=$$CYFY^ECXUTL1(X1),ECXARRAY("START")=$P(X,U,3),ECXARRAY("END")=$P(X,U,4)
"RTN","ECXLPRO",39,0)
 .K C,MON,YR,X1
"RTN","ECXLPRO",40,0)
 ;setup variables for taskmanager
"RTN","ECXLPRO",41,0)
 S ECXPGM="PROCESS^ECXLPRO",ECXDESC="PRO Extract YTD HCPCS Report"
"RTN","ECXLPRO",42,0)
 S ECXSAVE("ECXHEAD")="",ECXSAVE("ECXDIV(")="",ECXSAVE("ECXARRAY(")="",ECXSAVE("ECXPRIME")="",ECXSAVE("ECXALL")=""
"RTN","ECXLPRO",43,0)
 ;determine output device and queue if requested
"RTN","ECXLPRO",44,0)
 W !!,"Please note: The PRO Extract YTD Laboratory Report requires 132 columns."
"RTN","ECXLPRO",45,0)
 W !,"             Select an appropriate device for output."
"RTN","ECXLPRO",46,0)
 W ! D DEVICE^ECXUTLA(ECXPGM,ECXDESC,.ECXSAVE)
"RTN","ECXLPRO",47,0)
 I ECXSAVE("POP")=1 W ! D ^ECXKILL Q
"RTN","ECXLPRO",48,0)
 I ECXSAVE("ZTSK")=0 D
"RTN","ECXLPRO",49,0)
 .K ECXSAVE,ECXPGM,ECXDESC
"RTN","ECXLPRO",50,0)
 .D PROCESS
"RTN","ECXLPRO",51,0)
 ;clean-up and close
"RTN","ECXLPRO",52,0)
 I IO'=IO(0) D ^%ZISC
"RTN","ECXLPRO",53,0)
 D HOME^%ZIS
"RTN","ECXLPRO",54,0)
 Q
"RTN","ECXLPRO",55,0)
 ;
"RTN","ECXLPRO",56,0)
PROCESS ;begin processing
"RTN","ECXLPRO",57,0)
 N DIVISION,E,EXTRACT,REC,NODE0,NODE1,LASTDAY
"RTN","ECXLPRO",58,0)
 K ^TMP($J,"ECXP") S LASTDAY=""
"RTN","ECXLPRO",59,0)
 ;determine which extracts contain data for report
"RTN","ECXLPRO",60,0)
 S (EXTRACT,E)=0
"RTN","ECXLPRO",61,0)
 F  S E=$O(^ECX(727,"E",ECXHEAD,E)) Q:'E  D
"RTN","ECXLPRO",62,0)
 .Q:'$D(^ECX(727,E,0))
"RTN","ECXLPRO",63,0)
 .Q:$P($G(^ECX(727,E,0)),U,4)<ECXARRAY("START")
"RTN","ECXLPRO",64,0)
 .Q:$P($G(^ECX(727,E,0)),U,4)>ECXARRAY("END")
"RTN","ECXLPRO",65,0)
 .Q:$G(^ECX(727,E,"DIV"))'=+ECXPRIME
"RTN","ECXLPRO",66,0)
 .S EXTRACT(E)=^ECX(727,E,0)
"RTN","ECXLPRO",67,0)
 .I $P(EXTRACT(E),U,5)>LASTDAY S LASTDAY=$P(EXTRACT(E),U,5)
"RTN","ECXLPRO",68,0)
 ;setup array of station numbers included in report
"RTN","ECXLPRO",69,0)
 F DIV=0:0 S DIV=$O(ECXDIV(DIV)) Q:'DIV  S ECXSTAT=$P(ECXDIV(DIV),U,2),DIVISION(ECXSTAT)=ECXDIV(DIV)
"RTN","ECXLPRO",70,0)
 ;get the extract data
"RTN","ECXLPRO",71,0)
 S E=0 F  S E=$O(EXTRACT(E)) Q:'E  S REC=0 I $D(^ECX(727.826,"AC",E)) F  S REC=$O(^ECX(727.826,"AC",E,REC)) Q:'REC  D
"RTN","ECXLPRO",72,0)
 .S NODE0=$G(^ECX(727.826,REC,0)),NODE1=$G(^ECX(727.826,REC,1)) Q:NODE0=""
"RTN","ECXLPRO",73,0)
 .S (ECXCTAMT,ECXLLC,ECXLMC)=0
"RTN","ECXLPRO",74,0)
 .S ECXFELOC=$P(NODE0,U,10),ECXFEKEY=$P(NODE0,U,11)
"RTN","ECXLPRO",75,0)
 .;ignore any record which isn't for lab receiving station
"RTN","ECXLPRO",76,0)
 .Q:ECXFELOC'["LAB"
"RTN","ECXLPRO",77,0)
 .S ECXHCPC=$E(ECXFEKEY,1,5),ECXTYPE=$E(ECXFEKEY,6),ECXREQ=$P($E(ECXFEKEY,8,99),"REQ",1)
"RTN","ECXLPRO",78,0)
 .S ECXQTY=$P(NODE0,U,12),ECXCTAMT=$P(NODE0,U,21),ECXGRPR=$P(NODE1,U,4)
"RTN","ECXLPRO",79,0)
 .S ECXSTAT=$P(ECXFELOC,"LAB",1),ECXFORM="LAB"
"RTN","ECXLPRO",80,0)
 .S ECXLLC=$P(NODE0,U,22),ECXLMC=$P(NODE0,U,23)
"RTN","ECXLPRO",81,0)
 .;ignore record if division not included in this report
"RTN","ECXLPRO",82,0)
 .Q:ECXSTAT=""  Q:'$D(DIVISION(ECXSTAT))
"RTN","ECXLPRO",83,0)
 .;set in ^tmp using primary station#; determine if requesting station is same as or part of this station
"RTN","ECXLPRO",84,0)
 .S ECXLAB="",ECXSTAT=+ECXSTAT,ECXLAB=$S(ECXREQ'[ECXSTAT:"OTHER",1:"SAME")
"RTN","ECXLPRO",85,0)
 .;be sure there's no padding on cost variables
"RTN","ECXLPRO",86,0)
 .S ECXCTAMT=+$TR(ECXCTAMT," ",0),ECXLLC=+$TR(ECXLLC," ",0),ECXLMC=+$TR(ECXLMC," ",0)
"RTN","ECXLPRO",87,0)
 .;tmp global holds - lab qty^lab labor cost^lab matrl cost
"RTN","ECXLPRO",88,0)
 .I '$D(^TMP($J,"ECXP",ECXTYPE,ECXHCPC)) S ^TMP($J,"ECXP",ECXTYPE,ECXHCPC,"SAME")="0^0^0",^TMP($J,"ECXP",ECXTYPE,ECXHCPC,"OTHER")="0^0^0"
"RTN","ECXLPRO",89,0)
 .S $P(^TMP($J,"ECXP",ECXTYPE,ECXHCPC,ECXLAB),U,1)=$P(^TMP($J,"ECXP",ECXTYPE,ECXHCPC,ECXLAB),U,1)+ECXQTY
"RTN","ECXLPRO",90,0)
 .S $P(^TMP($J,"ECXP",ECXTYPE,ECXHCPC,ECXLAB),U,2)=$P(^TMP($J,"ECXP",ECXTYPE,ECXHCPC,ECXLAB),U,2)+ECXLLC
"RTN","ECXLPRO",91,0)
 .S $P(^TMP($J,"ECXP",ECXTYPE,ECXHCPC,ECXLAB),U,3)=$P(^TMP($J,"ECXP",ECXTYPE,ECXHCPC,ECXLAB),U,3)+ECXLMC
"RTN","ECXLPRO",92,0)
 ;setup hcpcs descriptions
"RTN","ECXLPRO",93,0)
 D HCPCS
"RTN","ECXLPRO",94,0)
 ;print report
"RTN","ECXLPRO",95,0)
 D PRINT^ECXLPRO1
"RTN","ECXLPRO",96,0)
 ;cleanup
"RTN","ECXLPRO",97,0)
 D AUDIT^ECXKILL
"RTN","ECXLPRO",98,0)
 Q
"RTN","ECXLPRO",99,0)
 ;
"RTN","ECXLPRO",100,0)
HCPCS ;setup hcpcs cross-reference
"RTN","ECXLPRO",101,0)
 N H,CPT,CPTNM,DESC
"RTN","ECXLPRO",102,0)
 S H=0
"RTN","ECXLPRO",103,0)
 F  S H=$O(^RMPR(661.1,H)) Q:+H<1  D
"RTN","ECXLPRO",104,0)
 .;don't skip inactive hcpcs in case doing previous fy
"RTN","ECXLPRO",105,0)
 .S CPTNM="",CPT=$P(^RMPR(661.1,H,0),U,4)
"RTN","ECXLPRO",106,0)
 .I +CPT>0 S CPTNM=$P(^ICPT(CPT,0),U,1),DESC=$E($P(^ICPT(CPT,0),U,2),1,26)
"RTN","ECXLPRO",107,0)
 .Q:CPTNM=""
"RTN","ECXLPRO",108,0)
 .S ^TMP($J,"HCPCS",CPTNM)=DESC
"RTN","ECXLPRO",109,0)
 Q
"RTN","ECXLPRO1")
0^9^B8521926
"RTN","ECXLPRO1",1,0)
ECXLPRO1 ;ALB/JAP - PRO Extract YTD Lab Report (cont) ; Feb 17, 1999
"RTN","ECXLPRO1",2,0)
 ;;3.0;DSS EXTRACTS;**21**;Dec 22, 1997
"RTN","ECXLPRO1",3,0)
 ;
"RTN","ECXLPRO1",4,0)
PRINT ;print report
"RTN","ECXLPRO1",5,0)
 N PG,LN,QFLG,NODE1,NODE2,DESC,AVE,JJ,SS,X1,X2
"RTN","ECXLPRO1",6,0)
 U IO
"RTN","ECXLPRO1",7,0)
 S QFLG=0,$P(LN,"-",132)=""
"RTN","ECXLPRO1",8,0)
 S Y=ECXARRAY("START") D DD^%DT S ECXSTART=Y
"RTN","ECXLPRO1",9,0)
 S Y=$S(LASTDAY:LASTDAY,ECXARRAY("END")>DT:DT,1:ECXARRAY("END")) D DD^%DT S ECXEND=Y
"RTN","ECXLPRO1",10,0)
 D NOW^%DTC S Y=$E(%,1,12) D DD^%DT S ECXRUN=Y
"RTN","ECXLPRO1",11,0)
 F ECXTYPE="N","X" D  Q:QFLG
"RTN","ECXLPRO1",12,0)
 .S PG=0 D HEADER
"RTN","ECXLPRO1",13,0)
 .S ECXHCPC=""
"RTN","ECXLPRO1",14,0)
 .;it's possible that no extract data was found
"RTN","ECXLPRO1",15,0)
 .I '$D(^TMP($J,"ECXP",ECXTYPE)) D  Q
"RTN","ECXLPRO1",16,0)
 ..W !!,?37,"No extract data available."
"RTN","ECXLPRO1",17,0)
 ..I $E(IOST)="C" D  Q:QFLG
"RTN","ECXLPRO1",18,0)
 ...S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXLPRO1",19,0)
 ...S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXLPRO1",20,0)
 .F  S ECXHCPC=$O(^TMP($J,"ECXP",ECXTYPE,ECXHCPC)) Q:ECXHCPC=""  D  Q:QFLG
"RTN","ECXLPRO1",21,0)
 ..S DESC=$G(^TMP($J,"HCPCS",ECXHCPC)) S:DESC="" DESC="(Unknown)" S DESC=ECXHCPC_" "_DESC
"RTN","ECXLPRO1",22,0)
 ..S NODE1=^TMP($J,"ECXP",ECXTYPE,ECXHCPC,"SAME"),NODE2=^TMP($J,"ECXP",ECXTYPE,ECXHCPC,"OTHER")
"RTN","ECXLPRO1",23,0)
 ..;node holds - lab qty^lab labor cost^lab matrl cost
"RTN","ECXLPRO1",24,0)
 ..F I=1:1:3 S X1(I)=+$P(NODE1,U,I),X2(I)=+$P(NODE2,U,I)
"RTN","ECXLPRO1",25,0)
 ..S AVE("O")=0,AVE("S")=0,TOT("O")=0,TOT("S")=0
"RTN","ECXLPRO1",26,0)
 ..S TOT("S")=X1(2)+X1(3),TOT("O")=X2(2)+X2(3)
"RTN","ECXLPRO1",27,0)
 ..S:X1(1)>0 AVE("S")=TOT("S")/X1(1) S:X2(1)>0 AVE("O")=TOT("O")/X2(1)
"RTN","ECXLPRO1",28,0)
 ..D:($Y+3>IOSL) HEADER Q:QFLG
"RTN","ECXLPRO1",29,0)
 ..W !,DESC,?33,$J(X1(1),8,0),?43,$J(X1(2),8,0),?54,$J(X1(3),8,0),?65,$J(AVE("S"),8,2),?82,$J(X2(1),8,0),?93,$J(X2(2),8,0),?104,$J(X2(3),8,0),?115,$J(AVE("O"),8,2)
"RTN","ECXLPRO1",30,0)
 .I 'QFLG,$E(IOST)="C" D
"RTN","ECXLPRO1",31,0)
 ..S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXLPRO1",32,0)
 ..S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXLPRO1",33,0)
 W @IOF
"RTN","ECXLPRO1",34,0)
 Q
"RTN","ECXLPRO1",35,0)
 ;
"RTN","ECXLPRO1",36,0)
HEADER ;header & page control
"RTN","ECXLPRO1",37,0)
 I $E(IOST)="C" D
"RTN","ECXLPRO1",38,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","ECXLPRO1",39,0)
 .I PG>0 S DIR(0)="E" D ^DIR K DIR S:'Y QFLG=1
"RTN","ECXLPRO1",40,0)
 Q:QFLG
"RTN","ECXLPRO1",41,0)
 W:$Y!($E(IOST)="C") @IOF S PG=PG+1
"RTN","ECXLPRO1",42,0)
 W "Prosthetics (PRO) Extract YTD Laboratory Report",?122,"Page "_PG
"RTN","ECXLPRO1",43,0)
 W !,"FY Date Range: "_ECXSTART_" to "_ECXEND
"RTN","ECXLPRO1",44,0)
 W !,"Facility:      "_$P(ECXPRIME,U,3)_" ("_$P(ECXPRIME,U,2)_")"
"RTN","ECXLPRO1",45,0)
 W !,"Run Date/Time: "_ECXRUN
"RTN","ECXLPRO1",46,0)
 W:ECXTYPE="N" !!,"REPORT OF NEW PROSTHETICS ACTIVITIES (Initial, Replacement, or Spare)",!
"RTN","ECXLPRO1",47,0)
 W:ECXTYPE="X" !!,"REPORT OF REPAIR PROSTHETICS ACTIVITIES",!
"RTN","ECXLPRO1",48,0)
 W !,?37,"Produced for Station #"_$P(ECXPRIME,U,2),?86,"Produced for all other stations"
"RTN","ECXLPRO1",49,0)
 W !,"HCPCS (CPT)",?37,"Qty.",?44,"Labor $",?55,"Mat'l $",?67,"Ave. $",?86,"Qty.",?94,"Labor $",?105,"Mat'l $",?117,"Ave. $"
"RTN","ECXLPRO1",50,0)
 W !,LN,!
"RTN","ECXLPRO1",51,0)
 Q
"RTN","ECXPRO")
0^11^B16794443
"RTN","ECXPRO",1,0)
ECXPRO ;ALB/GTS - Prosthetics Extract for DSS ; July 16, 1998
"RTN","ECXPRO",2,0)
 ;;3.0;DSS EXTRACTS;**9,13,15,21**;Dec 22, 1997
"RTN","ECXPRO",3,0)
BEG ;entry point from option
"RTN","ECXPRO",4,0)
 D SETUP
"RTN","ECXPRO",5,0)
 I +ECINST>0 D ^ECXTRAC
"RTN","ECXPRO",6,0)
 D ^ECXKILL
"RTN","ECXPRO",7,0)
 Q
"RTN","ECXPRO",8,0)
 ;
"RTN","ECXPRO",9,0)
START ;start package specific extract
"RTN","ECXPRO",10,0)
 ;
"RTN","ECXPRO",11,0)
 ; Input
"RTN","ECXPRO",12,0)
 ;  ECSD1   - FM formated Beginning Date (Set by ECXTRAC)
"RTN","ECXPRO",13,0)
 ;  ECED    - FM formated End Date (Set by ECXTRAC)
"RTN","ECXPRO",14,0)
 ;  ECSDN   - Externally formated Start Date (Set by ECXTRAC)
"RTN","ECXPRO",15,0)
 ;  ECEDN   - Externally formated End Date (Set by ECXTRAC)
"RTN","ECXPRO",16,0)
 ;  EC      - IEN from file #727 (Set by ECXTRAC)
"RTN","ECXPRO",17,0)
 ;  ECXYM   - Year and Month of extract (YYYYMM)
"RTN","ECXPRO",18,0)
 ;  ECXINST - IEN for division in file #4
"RTN","ECXPRO",19,0)
 ;  ECINST  - Station number of selected division
"RTN","ECXPRO",20,0)
 ;
"RTN","ECXPRO",21,0)
 N ECXLNE,ECXCT,ECXDACT,ECX0,ECXLB,ECXED1,ECINSTSV,ECXLNSTR,ECXP,DIC,DR,DA,DIQ
"RTN","ECXPRO",22,0)
 D ECXBUL^ECXPRO2(.ECXLNE,ECSDN,ECEDN,EC)
"RTN","ECXPRO",23,0)
 S ECXLNSTR=ECXLNE
"RTN","ECXPRO",24,0)
 S ECXED1=ECED+.9999
"RTN","ECXPRO",25,0)
 S ECXCT=ECSD1
"RTN","ECXPRO",26,0)
 F  S ECXCT=$O(^RMPR(660,"CT",ECXCT)) Q:(ECXCT>ECXED1)  Q:(+ECXCT=0)  Q:(QFLG=1)  D
"RTN","ECXPRO",27,0)
 .S ECXDACT=0
"RTN","ECXPRO",28,0)
 .F  S ECXDACT=$O(^RMPR(660,"CT",ECXCT,ECXDACT)) Q:(+ECXDACT=0)  Q:(QFLG=1)  D
"RTN","ECXPRO",29,0)
 ..;* Reinitialize variables
"RTN","ECXPRO",30,0)
 ..S (DFN,ECXNA,ECXSSN,ECXSTAT,ECXDTSVC,ECXTYPE,ECXSRCE,ECXHCPCS,ECXRQST)=""
"RTN","ECXPRO",31,0)
 ..S (ECXRCST,ECXFORM,ECXCTAMT,ECXLLC,ECXLMC,ECXGRPR,ECXBILST,ECXQTY,ECODE)=""
"RTN","ECXPRO",32,0)
 ..S (ECXFELOC,ECXFEKEY,ECODE1,ECXSEX)=""
"RTN","ECXPRO",33,0)
 ..S (ECXIOPT,ECXPCT,ECXPCP,ECXAO,ECXRE,ECXEC,ECXELIG,ECXVET,ECXZIP,ECXDOB)=""
"RTN","ECXPRO",34,0)
 ..S ECX0=$G(^RMPR(660,ECXDACT,0))
"RTN","ECXPRO",35,0)
 ..S ECXLB=$G(^RMPR(660,ECXDACT,"LB"))
"RTN","ECXPRO",36,0)
 ..K ECXP S DIC="^RMPR(660,",DR="11",DA=ECXDACT,DIQ(0)="EI",DIQ="ECXP" D EN^DIQ1 S ECXFORM=$G(ECXP(660,ECXDACT,11,"E"))_U_$G(ECXP(660,ECXDACT,11,"I"))
"RTN","ECXPRO",37,0)
 ..Q:'$$NTEG^ECXPRO1(.ECXLNE,ECXDACT,ECX0,ECXLB,ECINST,ECXFORM)
"RTN","ECXPRO",38,0)
 ..D PROSINFO^ECXPRO1(ECXDACT,ECXLB,ECX0,ECXFORM)
"RTN","ECXPRO",39,0)
 ..D PATINFO^ECXPRO1(ECXCT)
"RTN","ECXPRO",40,0)
 ..S ECXNA=$$PAD^ECXUTL1(ECXNA,4,"B"," ")
"RTN","ECXPRO",41,0)
 ..S ECXDTSVC=$$ECXDATE^ECXUTL(ECXDTSVC,ECXYM)
"RTN","ECXPRO",42,0)
 ..S ECXDOB=$$ECXDOB^ECXUTL(ECXDOB)
"RTN","ECXPRO",43,0)
 ..I ECXFORM["-3" F ECXLAB="LAB","ORD" D
"RTN","ECXPRO",44,0)
 ...D FEEDINFO^ECXPRO2(ECXSRCE,ECXHCPCS,ECXTYPE,ECXSTAT,ECXRQST,ECXRCST,ECXLAB)
"RTN","ECXPRO",45,0)
 ...Q:ECXFELOC=""
"RTN","ECXPRO",46,0)
 ...D FILE
"RTN","ECXPRO",47,0)
 ..I ECXFORM'["-3" S ECXLAB="NONL" D
"RTN","ECXPRO",48,0)
 ...D FEEDINFO^ECXPRO2(ECXSRCE,ECXHCPCS,ECXTYPE,ECXSTAT,ECXRQST,ECXRCST,ECXLAB)
"RTN","ECXPRO",49,0)
 ...Q:ECXFELOC=""
"RTN","ECXPRO",50,0)
 ...D FILE
"RTN","ECXPRO",51,0)
 ;* Send the Exception message
"RTN","ECXPRO",52,0)
 I ECXLNSTR<ECXLNE DO
"RTN","ECXPRO",53,0)
 .K XMY S XMY("G.DSS-"_ECGRP_"@"_^XMB("NETNAME"))=""
"RTN","ECXPRO",54,0)
 .S XMDUZ=.5
"RTN","ECXPRO",55,0)
 .S XMSUB=ECINST_" - Prosthetics DSS Exception Message",XMN=0
"RTN","ECXPRO",56,0)
 .S XMTEXT="^TMP(""ECX-PRO EXC"",$J,"
"RTN","ECXPRO",57,0)
 .D ^XMD
"RTN","ECXPRO",58,0)
 K ^TMP("ECX-PRO EXC",$J),XMDUZ,XMSUB,XMTEXT,XMY
"RTN","ECXPRO",59,0)
 ;* Cleanup variables
"RTN","ECXPRO",60,0)
 K DFN,ECXNA,ECXSSN,ECXSTAT,ECXDTSVC,ECXTYPE,ECXSRCE,ECXHCPCS,ECXRQST,ECCLAS
"RTN","ECXPRO",61,0)
 K ECXRCST,ECXFORM,ECXCTAMT,ECXLLC,ECXLMC,ECXGRPR,ECXBILST,ECXQTY
"RTN","ECXPRO",62,0)
 K ECXFELOC,ECXFEKEY,ECODE1,ECXICD9,ECXPCHD1,ECXMPI,ECXPCNPI,ECXDEPT,DFN
"RTN","ECXPRO",63,0)
 K ECXIOPT,ECXPCT,ECXPCP,ECXAO,ECXRE,ECXEC,ECXELIG,ECXVET,ECXZIP,ECXDOB,ECXSEX
"RTN","ECXPRO",64,0)
 Q
"RTN","ECXPRO",65,0)
 ;
"RTN","ECXPRO",66,0)
FILE ;file extract record
"RTN","ECXPRO",67,0)
 ;node0
"RTN","ECXPRO",68,0)
 ;facility^dfn^ssn^name^in/out^day^feeder location^feeder key^qty^pc team^pc provider^hcpcs^icd9^
"RTN","ECXPRO",69,0)
 ;agent orange^radiation^env contam^eligibility^cost^lab labor cost^lab matl cost^
"RTN","ECXPRO",70,0)
 ;billing status^vet^transacton type^req station^rec station^file#661.1 ien
"RTN","ECXPRO",71,0)
 ;node1
"RTN","ECXPRO",72,0)
 ;zip^dob^sex^amis grouper^pc prov npi^mpi^dss dept^pc prov person class
"RTN","ECXPRO",73,0)
 N DA,DIK
"RTN","ECXPRO",74,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXPRO",75,0)
 S ECODE=EC7_U_EC23
"RTN","ECXPRO",76,0)
 ;* Set the Placeholder variables
"RTN","ECXPRO",77,0)
 S (ECXICD9,ECXPCHD1,ECXMPI,ECXPCNPI,ECXDEPT)=""
"RTN","ECXPRO",78,0)
 S ECODE=ECODE_U_ECINST_U_DFN_U_ECXSSN_U_ECXNA_U_ECXIOPT_U_ECXDTSVC_U_ECXFELOC_U
"RTN","ECXPRO",79,0)
 S ECODE=ECODE_ECXFEKEY_U_ECXQTY_U_ECXPCT_U_ECXPCP_U_ECXHCPCS_U_ECXICD9_U
"RTN","ECXPRO",80,0)
 S ECODE=ECODE_ECXAO_U_ECXRE_U_ECXEC_U_ECXELIG_U_ECXCTAMT_U_ECXLLC_U_ECXLMC_U
"RTN","ECXPRO",81,0)
 S ECODE=ECODE_ECXBILST_U_ECXVET_U_ECXTYPE_U_ECXRQST_U_ECXRCST_U_ECXPHCPC
"RTN","ECXPRO",82,0)
 S ECODE1=ECXZIP_U_ECXDOB_U_ECXSEX_U_ECXGRPR_U_ECXPCNPI_U_ECXMPI_U_ECXDEPT_U_ECCLAS
"RTN","ECXPRO",83,0)
 S ^ECX(ECFILE,EC7,0)=ECODE
"RTN","ECXPRO",84,0)
 S ^ECX(ECFILE,EC7,1)=ECODE1
"RTN","ECXPRO",85,0)
 S ECRN=ECRN+1
"RTN","ECXPRO",86,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXPRO",87,0)
 I $D(ZTQUEUED),(ECRN>499),'(ECRN#500),$$S^%ZTLOAD S QFLG=1
"RTN","ECXPRO",88,0)
 Q
"RTN","ECXPRO",89,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXPRO",90,0)
 S ECHEAD="PRO"
"RTN","ECXPRO",91,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXPRO",92,0)
 S ECINST=$$PDIV^ECXPUTL
"RTN","ECXPRO",93,0)
 Q
"RTN","ECXPRO",94,0)
 ;
"RTN","ECXPRO",95,0)
 ;**Note: LOCAL and QUE are carry over from protocols set by other
"RTN","ECXPRO",96,0)
 ;        routines.
"RTN","ECXPRO",97,0)
LOCAL ;to extract nightly for local use not to be transmitted to TSI
"RTN","ECXPRO",98,0)
 ;QUEUE with 1D frequency
"RTN","ECXPRO",99,0)
 D SETUP,^ECXTLOCL,^ECXKILL Q
"RTN","ECXPRO",100,0)
 ;
"RTN","ECXPRO",101,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXPRO",102,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"RTN","ECXPRO1")
0^12^B30600871
"RTN","ECXPRO1",1,0)
ECXPRO1 ;ALB/GTS - Prosthetics Extract for DSS (Continued) ; July 16, 1998
"RTN","ECXPRO1",2,0)
 ;;3.0;DSS EXTRACTS;**9,11,13,15,21**;Dec 22, 1997
"RTN","ECXPRO1",3,0)
 ;
"RTN","ECXPRO1",4,0)
NTEG(ECXLNE,ECXPIEN,ECXN0,ECXNLB,ECINST,ECXFORM) ;** Check for required fields
"RTN","ECXPRO1",5,0)
 ;
"RTN","ECXPRO1",6,0)
 ;   Input
"RTN","ECXPRO1",7,0)
 ;    ECXLNE   - The line number variable (passed by reference)
"RTN","ECXPRO1",8,0)
 ;    ECXPIEN  - The IEN for the Prosthetics record
"RTN","ECXPRO1",9,0)
 ;    ECXN0    - The zero node of the Prosthetics record
"RTN","ECXPRO1",10,0)
 ;    ECXNLB   - The LB node of the Prosthetics record
"RTN","ECXPRO1",11,0)
 ;    ECINST   - The Station number being extracted
"RTN","ECXPRO1",12,0)
 ;    ECXFORM  - The Form Requested On
"RTN","ECXPRO1",13,0)
 ;
"RTN","ECXPRO1",14,0)
 ;   Output (to be KILLed by calling routine)
"RTN","ECXPRO1",15,0)
 ;    ^TMP("ECX-PRO EXC",$J) - Array for the exception message       
"RTN","ECXPRO1",16,0)
 ;    ECXLNE                 - The number of the next line in the msg
"RTN","ECXPRO1",17,0)
 ;    DFN                    - Patient's IEN in the Patient file
"RTN","ECXPRO1",18,0)
 ;    ECXNA                  - 1st four character of patient's last name
"RTN","ECXPRO1",19,0)
 ;    ECXSSN                 - Patients Social Security number
"RTN","ECXPRO1",20,0)
 ;    ECXSTAT                - Patient Station Number
"RTN","ECXPRO1",21,0)
 ;    ECXDTSVC               - Delivery Date of Prosthesis
"RTN","ECXPRO1",22,0)
 ;    ECXTYPE                - Type of Transaction work performed
"RTN","ECXPRO1",23,0)
 ;    ECXSRCE                - Source of prosthesis
"RTN","ECXPRO1",24,0)
 ;    ECXHCPCS               - CPT/HCPCS code for prosthesis
"RTN","ECXPRO1",25,0)
 ;    ECXRQST                - Requesting Station
"RTN","ECXPRO1",26,0)
 ;    ECXRCST                - Receiving Station
"RTN","ECXPRO1",27,0)
 ;    ECXPHCPC               - PSAS HCPCS code; if 'unknown', then use CPT/HCPCS code 
"RTN","ECXPRO1",28,0)
 ;
"RTN","ECXPRO1",29,0)
 ;   Output (KILLed by NTEG)
"RTN","ECXPRO1",30,0)
 ;    ECXMIS                 - 1 indicates missing information
"RTN","ECXPRO1",31,0)
 ;
"RTN","ECXPRO1",32,0)
 N ECXGOOD,ECXMISS
"RTN","ECXPRO1",33,0)
 S (ECXRCST,ECXRQST)=""
"RTN","ECXPRO1",34,0)
 S ECXMISS=""
"RTN","ECXPRO1",35,0)
 S ECXGOOD=1
"RTN","ECXPRO1",36,0)
 ;
"RTN","ECXPRO1",37,0)
 ;* Get Facility Station Number
"RTN","ECXPRO1",38,0)
 S ECXSTAT=$P(ECXN0,U,10)
"RTN","ECXPRO1",39,0)
 I ECXSTAT]"" DO
"RTN","ECXPRO1",40,0)
 .K ECXDIC S DA=ECXSTAT,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXPRO1",41,0)
 .D EN^DIQ1 S ECXSTAT=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXPRO1",42,0)
 ;
"RTN","ECXPRO1",43,0)
 ;** Screen out records
"RTN","ECXPRO1",44,0)
 S:($P(ECXN0,U,17)'="") ECXGOOD=0 ;*SHIP/DEL is not NULL
"RTN","ECXPRO1",45,0)
 S:($P(ECXN0,U,26)'="") ECXGOOD=0 ;*PICKUP/DEL is not NULL
"RTN","ECXPRO1",46,0)
 S:(+($P($G(^RMPR(660,ECXPIEN,"AM")),U,2))=1) ECXGOOD=0 ;*NO ADMIN CT=1
"RTN","ECXPRO1",47,0)
 S:(($P(ECXN0,U,15))'="") ECXGOOD=0 ;*HISTORICAL DATA is not NULL
"RTN","ECXPRO1",48,0)
 ;
"RTN","ECXPRO1",49,0)
 S DFN=$P(ECXN0,U,2)
"RTN","ECXPRO1",50,0)
 S ECXSSN=$P($G(^DPT(+DFN,0)),U,9)
"RTN","ECXPRO1",51,0)
 S ECXNA=$E($P($P($G(^DPT(+DFN,0)),U),",")_"    ",1,4)
"RTN","ECXPRO1",52,0)
 S ECXDTSVC=$P(ECXN0,U,12)
"RTN","ECXPRO1",53,0)
 S ECXTYPE=$P(ECXN0,U,4)
"RTN","ECXPRO1",54,0)
 S ECXSRCE=$P(ECXN0,U,14)
"RTN","ECXPRO1",55,0)
 S ECXHCPCS=$P($G(^ICPT(+$P(ECXN0,U,22),0)),U,1)
"RTN","ECXPRO1",56,0)
 ;get psas hcpcs code from file #661.1
"RTN","ECXPRO1",57,0)
 S ECXPHCPC=$P($G(^RMPR(660,ECXPIEN,1)),U,4) D
"RTN","ECXPRO1",58,0)
 .I +ECXPHCPC S ECXPHCPC=$P($G(^RMPR(661.1,ECXPHCPC,0)),U,1)
"RTN","ECXPRO1",59,0)
 .I ECXPHCPC="UNKNOWN" S ECXPHCPC=ECXHCPCS
"RTN","ECXPRO1",60,0)
 ;
"RTN","ECXPRO1",61,0)
 ;* Get Requesting Station Number
"RTN","ECXPRO1",62,0)
 I ECXFORM["-3" DO
"RTN","ECXPRO1",63,0)
 .S ECXRQST=$P(ECXNLB,U,1)
"RTN","ECXPRO1",64,0)
 .I ECXRQST]"" DO
"RTN","ECXPRO1",65,0)
 ..S DA=ECXRQST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXPRO1",66,0)
 ..D EN^DIQ1 S ECXRQST=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXPRO1",67,0)
 S:(ECXFORM'["-3") ECXRQST=""
"RTN","ECXPRO1",68,0)
 ;
"RTN","ECXPRO1",69,0)
 ;* Screen out records
"RTN","ECXPRO1",70,0)
 S:(+$P(ECXFORM,U,2)=13) ECXGOOD=0 ;*FORM REQUESTED ON = 13
"RTN","ECXPRO1",71,0)
 ;
"RTN","ECXPRO1",72,0)
 ;* Get Receiving Station Number
"RTN","ECXPRO1",73,0)
 I ECXFORM["-3" DO
"RTN","ECXPRO1",74,0)
 .S ECXRCST=$P(ECXNLB,U,4)
"RTN","ECXPRO1",75,0)
 .I ECXRCST]"" DO
"RTN","ECXPRO1",76,0)
 ..S DA=ECXRCST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXPRO1",77,0)
 ..D EN^DIQ1 S ECXRCST=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXPRO1",78,0)
 S:(ECXFORM'["-3") ECXRCST=""
"RTN","ECXPRO1",79,0)
 ;
"RTN","ECXPRO1",80,0)
 ;** Check for integrity and set up the problem variable if right DIV
"RTN","ECXPRO1",81,0)
 I ECXGOOD DO
"RTN","ECXPRO1",82,0)
 .I ECXSTAT']"" DO
"RTN","ECXPRO1",83,0)
 ..S ECXMISS="1"
"RTN","ECXPRO1",84,0)
 ..D CHK ;* Set ECXGOOD
"RTN","ECXPRO1",85,0)
 .I ECXSTAT]"" DO
"RTN","ECXPRO1",86,0)
 ..S:(ECINST'=$E(ECXSTAT,1,3)) ECXGOOD=0 ;*Screen for incorrect Station
"RTN","ECXPRO1",87,0)
 ..D:(ECXGOOD=1) CHK ;* Set ECXGOOD
"RTN","ECXPRO1",88,0)
 Q ECXGOOD
"RTN","ECXPRO1",89,0)
 ;
"RTN","ECXPRO1",90,0)
CHK ;*Check variables
"RTN","ECXPRO1",91,0)
 ;
"RTN","ECXPRO1",92,0)
 ; Input
"RTN","ECXPRO1",93,0)
 ;  Variables set in and Output from NTEG^ECXPRO1
"RTN","ECXPRO1",94,0)
 ;
"RTN","ECXPRO1",95,0)
 ; Output
"RTN","ECXPRO1",96,0)
 ;  ^TMP("ECX-PRO EXC",$J,   - Global of records with integrity problems
"RTN","ECXPRO1",97,0)
 ;
"RTN","ECXPRO1",98,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",99,0)
 I DFN']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",100,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",101,0)
 I ECXSSN']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",102,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",103,0)
 I ECXNA="    " S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",104,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",105,0)
 I ECXDTSVC']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",106,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",107,0)
 I ECXTYPE']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",108,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",109,0)
 I ECXSRCE']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",110,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",111,0)
 I ECXHCPCS']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",112,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",113,0)
 I ECXFORM["-3" D
"RTN","ECXPRO1",114,0)
 .I ECXRQST']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",115,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",116,0)
 I ECXFORM']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",117,0)
 S ECXMISS=ECXMISS_U
"RTN","ECXPRO1",118,0)
 I ECXFORM["-3" DO
"RTN","ECXPRO1",119,0)
 .I ECXRCST']"" S ECXMISS=ECXMISS_"1"
"RTN","ECXPRO1",120,0)
 I ECXMISS'="^^^^^^^^^^" DO
"RTN","ECXPRO1",121,0)
 .S ECXGOOD=0
"RTN","ECXPRO1",122,0)
 .D ECXMISLN^ECXPRO2(ECXMISS,.ECXLNE,ECXPIEN)
"RTN","ECXPRO1",123,0)
 Q
"RTN","ECXPRO1",124,0)
 ;
"RTN","ECXPRO1",125,0)
PROSINFO(ECXDA,ECXLB,ECX0,ECXFORM) ;*Get Prosthetics Information
"RTN","ECXPRO1",126,0)
 ;
"RTN","ECXPRO1",127,0)
 ;  Input
"RTN","ECXPRO1",128,0)
 ;    ECDA    - The IEN for the Prosthetics record
"RTN","ECXPRO1",129,0)
 ;    ECX0    - The zero node of the Prosthetics record
"RTN","ECXPRO1",130,0)
 ;    ECXLB   - The LB node of the Prosthetics record
"RTN","ECXPRO1",131,0)
 ;    ECXFORM - The Form Requested On (to determine Lab transactions)
"RTN","ECXPRO1",132,0)
 ;
"RTN","ECXPRO1",133,0)
 ;  Output (to be KILLed by calling routine)
"RTN","ECXPRO1",134,0)
 ;    ECXCTAMT   - The Cost of Transaction
"RTN","ECXPRO1",135,0)
 ;    ECXLLC     - The Lab Labor Cost
"RTN","ECXPRO1",136,0)
 ;    ECXLMC     - The Lab Material Cost
"RTN","ECXPRO1",137,0)
 ;    ECXGRPR    - The AMIS Grouper number
"RTN","ECXPRO1",138,0)
 ;    ECXBILST   - The Billing Status
"RTN","ECXPRO1",139,0)
 ;    ECXQTY     - The Quantity
"RTN","ECXPRO1",140,0)
 ;
"RTN","ECXPRO1",141,0)
 N FRAC
"RTN","ECXPRO1",142,0)
 S (ECXLLC,ECXLMC,ECXCTAMT)=""
"RTN","ECXPRO1",143,0)
 S ECXBILST=$P($G(^RMPR(660,ECXDA,"AM")),U,3)
"RTN","ECXPRO1",144,0)
 S ECXQTY=$P(ECX0,U,7)
"RTN","ECXPRO1",145,0)
 S:(+ECXQTY=0) ECXQTY=1
"RTN","ECXPRO1",146,0)
 S ECXGRPR=$P($G(^RMPR(660,ECXDA,"AMS")),U,1)
"RTN","ECXPRO1",147,0)
 S ECXCTAMT=$P(ECX0,U,16)
"RTN","ECXPRO1",148,0)
 I ECXFORM["-3" D
"RTN","ECXPRO1",149,0)
 .S ECXCTAMT=$P(ECXLB,U,9)
"RTN","ECXPRO1",150,0)
 .S ECXLLC=$P(ECXLB,U,7)
"RTN","ECXPRO1",151,0)
 .S ECXLMC=$P(ECXLB,U,8)
"RTN","ECXPRO1",152,0)
 S:ECXCTAMT="" ECXCTAMT=0 S:ECXCTAMT>999999 ECXCTAMT=999999
"RTN","ECXPRO1",153,0)
 S:ECXLLC="" ECXLLC=0 S:ECXLLC>999999 ECXLLC=999999
"RTN","ECXPRO1",154,0)
 S:ECXLMC="" ECXLMC=0 S:ECXLMC>999999 ECXLMC=999999
"RTN","ECXPRO1",155,0)
 S FRAC=+$P(ECXCTAMT,".",2),ECXCTAMT=$P(ECXCTAMT,"."),FRAC=FRAC/50 S:FRAC>1 ECXCTAMT=ECXCTAMT+1
"RTN","ECXPRO1",156,0)
 S FRAC=+$P(ECXLLC,".",2),ECXLLC=$P(ECXLLC,"."),FRAC=FRAC/50 S:FRAC>1 ECXLLC=ECXLLC+1
"RTN","ECXPRO1",157,0)
 S FRAC=+$P(ECXLMC,".",2),ECXLMC=$P(ECXLMC,"."),FRAC=FRAC/50 S:FRAC>1 ECXLMC=ECXLMC+1
"RTN","ECXPRO1",158,0)
 Q
"RTN","ECXPRO1",159,0)
 ;
"RTN","ECXPRO1",160,0)
PATINFO(ECXDELDT) ;* Get Patient Information
"RTN","ECXPRO1",161,0)
 ;
"RTN","ECXPRO1",162,0)
 ;  Input
"RTN","ECXPRO1",163,0)
 ;    ECXDELDT - The Delivery of the Prosthesis
"RTN","ECXPRO1",164,0)
 ;
"RTN","ECXPRO1",165,0)
 ;  Output (to be KILLed by calling routine)
"RTN","ECXPRO1",166,0)
 ;    ECXIOPT    - The In/Outpatient indicator
"RTN","ECXPRO1",167,0)
 ;    ECXPCT     - The Primary Care Team
"RTN","ECXPRO1",168,0)
 ;    ECXPCP     - The Primary Care Providor
"RTN","ECXPRO1",169,0)
 ;    ECXAO      - The Agent Orange indicator
"RTN","ECXPRO1",170,0)
 ;    ECXRE      - The Radiation Exposure indicator
"RTN","ECXPRO1",171,0)
 ;    ECXEC      - The Environmental Contaminants indicator
"RTN","ECXPRO1",172,0)
 ;    ECXELIG    - The veteran's eligibility
"RTN","ECXPRO1",173,0)
 ;    ECXVET     - The Vet/Non-Vet status
"RTN","ECXPRO1",174,0)
 ;    ECXZIP     - ZIP or ZIP+4
"RTN","ECXPRO1",175,0)
 ;    ECXDOB     - The patient's birth date
"RTN","ECXPRO1",176,0)
 ;    ECXSEX     - The Patient's Gender
"RTN","ECXPRO1",177,0)
 ;
"RTN","ECXPRO1",178,0)
 ;* Determine the In/Outpatient status
"RTN","ECXPRO1",179,0)
 S ECXDELDT=$P(ECXDELDT,".",1)
"RTN","ECXPRO1",180,0)
 S ECXIOPT=1
"RTN","ECXPRO1",181,0)
 K VAIP
"RTN","ECXPRO1",182,0)
 S VAIP("D")=ECXDELDT
"RTN","ECXPRO1",183,0)
 D IN5^VADPT
"RTN","ECXPRO1",184,0)
 I +VAIP(1)>0 S ECXIOPT=3
"RTN","ECXPRO1",185,0)
 K VAIP,VAERR
"RTN","ECXPRO1",186,0)
 ;
"RTN","ECXPRO1",187,0)
 ;* Determine primary care team/provider and eligibility
"RTN","ECXPRO1",188,0)
 S X=$$PRIMARY^ECXUTL2(DFN,ECXDELDT,2),ECXPCT=$P(X,U,1),ECXPCP=$P(X,U,2),ECCLAS=$P(X,U,3)
"RTN","ECXPRO1",189,0)
 S ECXELIG=$P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),U,9)
"RTN","ECXPRO1",190,0)
 I ECXELIG S ECXELIG=$C(ECXELIG+64)
"RTN","ECXPRO1",191,0)
 ;
"RTN","ECXPRO1",192,0)
 ;* Determine Agent Orange, Radiation Exposure and Environment Contmnts
"RTN","ECXPRO1",193,0)
 S ECXAO=$P($G(^DPT(DFN,.321)),U,2)
"RTN","ECXPRO1",194,0)
 S ECXRE=$P($G(^DPT(DFN,.321)),U,3)
"RTN","ECXPRO1",195,0)
 S ECXEC=$P($G(^DPT(DFN,.322)),U,13)
"RTN","ECXPRO1",196,0)
 ;
"RTN","ECXPRO1",197,0)
 ;* Get patient's Sex, Date of Birth, Zip Code and Vet/Non-Vet status
"RTN","ECXPRO1",198,0)
 S ECXSEX=$P(^DPT(DFN,0),U,2)
"RTN","ECXPRO1",199,0)
 S:ECXSEX="" ECXSEX="U"
"RTN","ECXPRO1",200,0)
 S ECXDOB=$P(^DPT(DFN,0),U,3)
"RTN","ECXPRO1",201,0)
 S ECXVET=$P($G(^DPT(DFN,"VET")),U,1)
"RTN","ECXPRO1",202,0)
 S VAPA("P")=""
"RTN","ECXPRO1",203,0)
 D ADD^VADPT
"RTN","ECXPRO1",204,0)
 S ECXZIP=$P($G(VAPA(11)),U,2)
"RTN","ECXPRO1",205,0)
 K VAPA
"RTN","ECXPRO1",206,0)
 Q
"RTN","ECXPRO2")
0^13^B11746664
"RTN","ECXPRO2",1,0)
ECXPRO2 ;ALB/GTS - Prosthetics Extract for DSS (Continued) ; July 16, 1998
"RTN","ECXPRO2",2,0)
 ;;3.0;DSS EXTRACTS;**9,15,21**;Dec 22, 1997
"RTN","ECXPRO2",3,0)
 ;
"RTN","ECXPRO2",4,0)
ECXBUL(ECXLNE,ECXEBDT,ECXEEDT,ECNUM) ;* Set up the header for the exception msg
"RTN","ECXPRO2",5,0)
 ;
"RTN","ECXPRO2",6,0)
 ;   Input
"RTN","ECXPRO2",7,0)
 ;    ECXLNE  - The line number variable (passed by reference)
"RTN","ECXPRO2",8,0)
 ;    ECXEBDT - The Externally formated beginning date
"RTN","ECXPRO2",9,0)
 ;    ECXEEDT - The Externally formated ending date
"RTN","ECXPRO2",10,0)
 ;    ECNUM   - The Extract reference number
"RTN","ECXPRO2",11,0)
 ;
"RTN","ECXPRO2",12,0)
 ;   Output
"RTN","ECXPRO2",13,0)
 ;    ^TMP("ECX-PRO EXC",$J) - Array for the exception message
"RTN","ECXPRO2",14,0)
 ;    ECXLNE                 - The number of the next line in the msg
"RTN","ECXPRO2",15,0)
 ;
"RTN","ECXPRO2",16,0)
 S ^TMP("ECX-PRO EXC",$J,1)=" "
"RTN","ECXPRO2",17,0)
 S ^TMP("ECX-PRO EXC",$J,2)="The DSS-Prosthetic Extract #"_ECNUM_" for "_ECXEBDT_" through "_ECXEEDT
"RTN","ECXPRO2",18,0)
 S ^TMP("ECX-PRO EXC",$J,3)="has completed.  The following is a list of Prosthetics records that were NOT"
"RTN","ECXPRO2",19,0)
 S ^TMP("ECX-PRO EXC",$J,4)="extracted due to missing information in the Record of Pros Appliance/Repair"
"RTN","ECXPRO2",20,0)
 S ^TMP("ECX-PRO EXC",$J,5)="file (#660).  The Prosthetics record may be reviewed and the missing"
"RTN","ECXPRO2",21,0)
 S ^TMP("ECX-PRO EXC",$J,6)="information completed.  Once the missing information has been entered, it"
"RTN","ECXPRO2",22,0)
 S ^TMP("ECX-PRO EXC",$J,7)="will be necessary to re-generate the Prosthetics Extract for the above noted"
"RTN","ECXPRO2",23,0)
 S ^TMP("ECX-PRO EXC",$J,8)="date range."
"RTN","ECXPRO2",24,0)
 S ^TMP("ECX-PRO EXC",$J,9)=" "
"RTN","ECXPRO2",25,0)
 S ^TMP("ECX-PRO EXC",$J,10)="If you do not intend to transmit Prosthetics Extract #"_ECNUM_", then please"
"RTN","ECXPRO2",26,0)
 S ^TMP("ECX-PRO EXC",$J,11)="purge it before generating a new extract for the same date range."
"RTN","ECXPRO2",27,0)
 S ^TMP("ECX-PRO EXC",$J,12)=" "
"RTN","ECXPRO2",28,0)
 S ^TMP("ECX-PRO EXC",$J,13)=" "
"RTN","ECXPRO2",29,0)
 S ^TMP("ECX-PRO EXC",$J,14)=" PROSTHETICS FILE (#660)         MISSING DATA"
"RTN","ECXPRO2",30,0)
 S ^TMP("ECX-PRO EXC",$J,15)="       IEN                         ELEMENTS"
"RTN","ECXPRO2",31,0)
 S ^TMP("ECX-PRO EXC",$J,16)=" "
"RTN","ECXPRO2",32,0)
 S ECXLNE=15
"RTN","ECXPRO2",33,0)
 Q
"RTN","ECXPRO2",34,0)
 ;
"RTN","ECXPRO2",35,0)
ECXMISLN(ECXMISS,ECXLNE,ECXPIEN) ;** Report Missing Lines
"RTN","ECXPRO2",36,0)
 N ECXPCE,ECXFIRST,ECXFIELD
"RTN","ECXPRO2",37,0)
 S ECXFIRST=1
"RTN","ECXPRO2",38,0)
 F ECXPCE=1:1:11 DO
"RTN","ECXPRO2",39,0)
 .I +$P(ECXMISS,"^",ECXPCE) DO
"RTN","ECXPRO2",40,0)
 ..S ECXFIELD=$P($T(ECXFLD+ECXPCE),";;",2)
"RTN","ECXPRO2",41,0)
 ..I 'ECXFIRST S ^TMP("ECX-PRO EXC",$J,ECXLNE)="                                   "_ECXFIELD
"RTN","ECXPRO2",42,0)
 ..I ECXFIRST DO
"RTN","ECXPRO2",43,0)
 ...S ^TMP("ECX-PRO EXC",$J,ECXLNE)="       "_ECXPIEN_"                          "_ECXFIELD
"RTN","ECXPRO2",44,0)
 ...S ECXFIRST=0
"RTN","ECXPRO2",45,0)
 ..S ECXLNE=ECXLNE+1
"RTN","ECXPRO2",46,0)
 S ^TMP("ECX-PRO EXC",$J,ECXLNE)=" "
"RTN","ECXPRO2",47,0)
 S ECXLNE=ECXLNE+1
"RTN","ECXPRO2",48,0)
 Q
"RTN","ECXPRO2",49,0)
 ;
"RTN","ECXPRO2",50,0)
ECXFLD ;* Missing Required fields
"RTN","ECXPRO2",51,0)
 ;;STATION
"RTN","ECXPRO2",52,0)
 ;;PATIENT NAME (In Prosthetics)
"RTN","ECXPRO2",53,0)
 ;;SSN
"RTN","ECXPRO2",54,0)
 ;;NAME (In Patient file - #2)
"RTN","ECXPRO2",55,0)
 ;;DELIVERY DATE
"RTN","ECXPRO2",56,0)
 ;;TYPE OF TRANSACTION
"RTN","ECXPRO2",57,0)
 ;;SOURCE
"RTN","ECXPRO2",58,0)
 ;;HCPCS
"RTN","ECXPRO2",59,0)
 ;;REQUESTING STATION
"RTN","ECXPRO2",60,0)
 ;;FORM REQUESTED ON
"RTN","ECXPRO2",61,0)
 ;;RECEIVING STATION
"RTN","ECXPRO2",62,0)
 Q
"RTN","ECXPRO2",63,0)
 ;
"RTN","ECXPRO2",64,0)
FEEDINFO(ECXSRCE,ECXHCPCS,ECXTYPE,ECXSTAT,ECXRQST,ECXRCST,ECXLAB) ;Get Feeder Key and Feeder Location
"RTN","ECXPRO2",65,0)
 ;   Input
"RTN","ECXPRO2",66,0)
 ;    ECXSTAT   - Station Number for extract
"RTN","ECXPRO2",67,0)
 ;    ECXTYPE   - Type of Transaction work performed
"RTN","ECXPRO2",68,0)
 ;    ECXSRCE   - Source of prosthesis
"RTN","ECXPRO2",69,0)
 ;    ECXHCPCS  - HCPCS code for prosthesis
"RTN","ECXPRO2",70,0)
 ;    ECXRQST   - Requesting Station
"RTN","ECXPRO2",71,0)
 ;    ECXRCST   - Receiving Station
"RTN","ECXPRO2",72,0)
 ;    ECXLAB    - Lab or non-Lab 
"RTN","ECXPRO2",73,0)
 ;   Output (to be KILLed by calling routine)
"RTN","ECXPRO2",74,0)
 ;    ECXFELOC  - Feeder Location
"RTN","ECXPRO2",75,0)
 ;    ECXFEKEY  - Feeder Key
"RTN","ECXPRO2",76,0)
 ;
"RTN","ECXPRO2",77,0)
 ;* NOTE: If a Station # <> Requesting Station
"RTN","ECXPRO2",78,0)
 ;*         AND
"RTN","ECXPRO2",79,0)
 ;*       Station # <> Receiving Station,
"RTN","ECXPRO2",80,0)
 ;*       then Feeder Location will be NULL.  
"RTN","ECXPRO2",81,0)
 ;
"RTN","ECXPRO2",82,0)
 S ECXFELOC=""
"RTN","ECXPRO2",83,0)
 S ECXFEKEY=ECXHCPCS_$S(ECXTYPE="X":"X",1:"N")_ECXSRCE
"RTN","ECXPRO2",84,0)
 ;
"RTN","ECXPRO2",85,0)
 ;* If processing a Non-Lab Transaction
"RTN","ECXPRO2",86,0)
 I ECXLAB="NONL" D  Q
"RTN","ECXPRO2",87,0)
 .S ECXFELOC=ECXSTAT_"NONL"
"RTN","ECXPRO2",88,0)
 ;
"RTN","ECXPRO2",89,0)
 ;* If processing a Lab Transaction
"RTN","ECXPRO2",90,0)
 I ECXLAB="LAB" D  Q
"RTN","ECXPRO2",91,0)
 .I ECXSTAT=ECXRCST D
"RTN","ECXPRO2",92,0)
 ..S ECXFELOC=ECXRCST_"LAB"
"RTN","ECXPRO2",93,0)
 ..S ECXFEKEY=ECXFEKEY_ECXRQST_"REQ"
"RTN","ECXPRO2",94,0)
 I ECXLAB="ORD" D  Q
"RTN","ECXPRO2",95,0)
 .I ECXSTAT=ECXRQST D
"RTN","ECXPRO2",96,0)
 ..S ECXFELOC=ECXRQST_"ORD"
"RTN","ECXPRO2",97,0)
 ..S ECXFEKEY=ECXFEKEY_ECXRCST_"REC"
"RTN","ECXPRO2",98,0)
 ;
"RTN","ECXPRO2",99,0)
 Q
"VER")
8.0^21.0
**END**
**END**
