KIDS Distribution saved on Jul 23, 2003@09:08:05
LTC COPAYMENTS PHASE III (7/23/03)
**KIDS**:EAS*1.0*34^DG*5.3*518^

**INSTALL NAME**
EAS*1.0*34
"BLD",4271,0)
EAS*1.0*34^ENROLLMENT APPLICATION SYSTEM^0^3030723^y
"BLD",4271,1,0)
^^1^1^3030623^^
"BLD",4271,1,1,0)
LTC Copayments Phase III
"BLD",4271,4,0)
^9.64PA^^
"BLD",4271,"ABPKG")
n
"BLD",4271,"KRN",0)
^9.67PA^8989.52^19
"BLD",4271,"KRN",.4,0)
.4
"BLD",4271,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4271,"KRN",.401,0)
.401
"BLD",4271,"KRN",.402,0)
.402
"BLD",4271,"KRN",.402,"NM",0)
^9.68A^2^2
"BLD",4271,"KRN",.402,"NM",1,0)
EASEC ENTER/EDIT EXPENSES    FILE #408.21^408.21^0
"BLD",4271,"KRN",.402,"NM",2,0)
EASEC COMPLETE LTC CO-PAY TEST    FILE #408.31^408.31^0
"BLD",4271,"KRN",.402,"NM","B","EASEC COMPLETE LTC CO-PAY TEST    FILE #408.31",2)

"BLD",4271,"KRN",.402,"NM","B","EASEC ENTER/EDIT EXPENSES    FILE #408.21",1)

"BLD",4271,"KRN",.403,0)
.403
"BLD",4271,"KRN",.5,0)
.5
"BLD",4271,"KRN",.84,0)
.84
"BLD",4271,"KRN",3.6,0)
3.6
"BLD",4271,"KRN",3.8,0)
3.8
"BLD",4271,"KRN",9.2,0)
9.2
"BLD",4271,"KRN",9.8,0)
9.8
"BLD",4271,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",4271,"KRN",9.8,"NM",1,0)
EASECSC6^^0^B8990995
"BLD",4271,"KRN",9.8,"NM",2,0)
EASECSCC^^0^B33823822
"BLD",4271,"KRN",9.8,"NM",3,0)
EASECPC^^0^B88710821
"BLD",4271,"KRN",9.8,"NM",4,0)
EASECE^^0^B13582040
"BLD",4271,"KRN",9.8,"NM",5,0)
EASECU^^0^B6834400
"BLD",4271,"KRN",9.8,"NM",6,0)
EASECU23^^0^B10484457
"BLD",4271,"KRN",9.8,"NM",7,0)
EASECDEL^^0^B10132377
"BLD",4271,"KRN",9.8,"NM",8,0)
EASECA^^0^B10759492
"BLD",4271,"KRN",9.8,"NM",9,0)
EASECDD^^0^B38859301
"BLD",4271,"KRN",9.8,"NM",10,0)
EASECCAL^^0^B14038379
"BLD",4271,"KRN",9.8,"NM","B","EASECA",8)

"BLD",4271,"KRN",9.8,"NM","B","EASECCAL",10)

"BLD",4271,"KRN",9.8,"NM","B","EASECDD",9)

"BLD",4271,"KRN",9.8,"NM","B","EASECDEL",7)

"BLD",4271,"KRN",9.8,"NM","B","EASECE",4)

"BLD",4271,"KRN",9.8,"NM","B","EASECPC",3)

"BLD",4271,"KRN",9.8,"NM","B","EASECSC6",1)

"BLD",4271,"KRN",9.8,"NM","B","EASECSCC",2)

"BLD",4271,"KRN",9.8,"NM","B","EASECU",5)

"BLD",4271,"KRN",9.8,"NM","B","EASECU23",6)

"BLD",4271,"KRN",19,0)
19
"BLD",4271,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",4271,"KRN",19,"NM",1,0)
EASEC LTC COPAY TEST DELETE^^0
"BLD",4271,"KRN",19,"NM",2,0)
EASEC LTC COPAY MENU^^2
"BLD",4271,"KRN",19,"NM","B","EASEC LTC COPAY MENU",2)

"BLD",4271,"KRN",19,"NM","B","EASEC LTC COPAY TEST DELETE",1)

"BLD",4271,"KRN",19.1,0)
19.1
"BLD",4271,"KRN",101,0)
101
"BLD",4271,"KRN",409.61,0)
409.61
"BLD",4271,"KRN",771,0)
771
"BLD",4271,"KRN",870,0)
870
"BLD",4271,"KRN",8989.51,0)
8989.51
"BLD",4271,"KRN",8989.52,0)
8989.52
"BLD",4271,"KRN",8994,0)
8994
"BLD",4271,"KRN","B",.4,.4)

"BLD",4271,"KRN","B",.401,.401)

"BLD",4271,"KRN","B",.402,.402)

"BLD",4271,"KRN","B",.403,.403)

"BLD",4271,"KRN","B",.5,.5)

"BLD",4271,"KRN","B",.84,.84)

"BLD",4271,"KRN","B",3.6,3.6)

"BLD",4271,"KRN","B",3.8,3.8)

"BLD",4271,"KRN","B",9.2,9.2)

"BLD",4271,"KRN","B",9.8,9.8)

"BLD",4271,"KRN","B",19,19)

"BLD",4271,"KRN","B",19.1,19.1)

"BLD",4271,"KRN","B",101,101)

"BLD",4271,"KRN","B",409.61,409.61)

"BLD",4271,"KRN","B",771,771)

"BLD",4271,"KRN","B",870,870)

"BLD",4271,"KRN","B",8989.51,8989.51)

"BLD",4271,"KRN","B",8989.52,8989.52)

"BLD",4271,"KRN","B",8994,8994)

"BLD",4271,"QUES",0)
^9.62^^
"BLD",4271,"REQB",0)
^9.611^2^2
"BLD",4271,"REQB",1,0)
EAS*1.0*7^2
"BLD",4271,"REQB",2,0)
EAS*1.0*24^2
"BLD",4271,"REQB","B","EAS*1.0*24",2)

"BLD",4271,"REQB","B","EAS*1.0*7",1)

"KRN",.402,2610,-1)
0^1
"KRN",.402,2610,0)
EASEC ENTER/EDIT EXPENSES^3030521.1731^@^408.21^^@^3030704
"KRN",.402,2610,"DIAB",5,0,408.21,0)
1.03;"EDUCATION"
"KRN",.402,2610,"DIAB",8,0,408.21,0)
1.02;"FUNERAL AND BURIAL"
"KRN",.402,2610,"DIAB",10,0,408.21,1)
1.01;"NON-REIMBURSED MEDICAL EXPENSES"
"KRN",.402,2610,"DR",1,408.21)
K DGFIN;I '$D(DGDR) W !,*7,"Variable DGDR must be defined!" S Y="@999";S:DGDR'["101" Y="@102";@101;1.03EDUCATION~;@102;S:DGDR'["102" Y="@103";1.02FUNERAL AND BURIAL~;@103;S:DGDR'["103" Y="@104";1.04;@104;S:DGDR'["104" Y="@105";
"KRN",.402,2610,"DR",1,408.21,1)
1.05;@105;S:DGDR'["105" Y="@106";1.06;@106;S:DGDR'["106" Y="@107";1.07;@107;S:DGDR'["107" Y="@108";1.01NON-REIMBURSED MEDICAL EXPENSES~;@108;S:DGDR'["108" Y="@109";1.08;@109;S:DGDR'["109" Y="@110";1.09;@110;S:DGDR'["110" Y="@998";
"KRN",.402,2610,"DR",1,408.21,2)
1.1;@998;S DGFIN="";@999;
"KRN",.402,2612,-1)
0^2
"KRN",.402,2612,0)
EASEC COMPLETE LTC CO-PAY TEST^3030522.0903^@^408.31^^@^3030708
"KRN",.402,2612,"DIAB",2,0,408.31,3)
.07;REQ
"KRN",.402,2612,"DIAB",4,0,408.31,3)
50;"Comments"
"KRN",.402,2612,"DR",1,408.31)
K DGFIN;I '$D(DGMTS)!('$D(DGINT))!('$D(DGDET))!('$D(DGNWT)) W !,*7,"Variables DGMTS, DGINT, DGDET, and DGNWT must be defined!" S Y="@999";S:$P(^DGMT(408.31,DA,0),U,14)=0&('$D(DGREF)) Y="@20";.14///^S X=$S($D(DGREF):1,1:0);@20;
"KRN",.402,2612,"DR",1,408.31,1)
.03////^S X=DGMTS;2.07////^S X=$S(DGMTS=12:$G(DGRE),1:"@");2.08////^S X=$P($$GETLTC4^EASECMT(DFN,DGMTDT),U,1);.04////^S X=$S('$D(DGREF):DGINT,1:"@");.15////^S X=$S('$D(DGREF):DGDET,1:"@");.05////^S X=$S('$D(DGREF):DGNWT,1:"@");
"KRN",.402,2612,"DR",1,408.31,2)
.18////^S X=$G(DGND);.06////^S X=DUZ;S:$P(^DGMT(408.31,DA,0),U,7) Y="@30";.07///^S X=$S(DGMTDT=DT:"NOW",1:DGMTDT);2.05////^S X=$$GETSITE^DGMTU4(.DUZ);@30;2.02///^S X="NOW";.11////^S X=$S($D(DGAGR):DGAGR,1:"@");
"KRN",.402,2612,"DR",1,408.31,3)
S:DGMTDT'<DT Y="@998";.07R~;@998;50Comments~;S DGFIN="";@999;
"KRN",19,11069,-1)
2^2
"KRN",19,11069,0)
EASEC LTC COPAY MENU^LTC Copayments Menu^^M^12540^^^^^^^^y
"KRN",19,11069,10,0)
^19.01IP^7^7
"KRN",19,11069,10,7,0)
11445
"KRN",19,11069,10,7,"^")
EASEC LTC COPAY TEST DELETE
"KRN",19,11069,"U")
LTC COPAYMENTS MENU
"KRN",19,11445,-1)
0^1
"KRN",19,11445,0)
EASEC LTC COPAY TEST DELETE^Delete a LTC Copayment Test (10-10EC)^^R^^DG MTDELETE^^^^^^ENROLLMENT APPLICATION SYSTEM^^
"KRN",19,11445,1,0)
^19.06^2^2^3030604^^
"KRN",19,11445,1,1,0)
This option is used to delete a Long Term Care Copayment Test (10-10EC) 
"KRN",19,11445,1,2,0)
which may have been inadvertently entered.
"KRN",19,11445,20)

"KRN",19,11445,25)
EN^EASECDEL
"KRN",19,11445,"U")
DELETE A LTC COPAYMENT TEST (1
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",551,-1)
1^1
"PKG",551,0)
ENROLLMENT APPLICATION SYSTEM^EAS^ENROLLMENT
"PKG",551,20,0)
^9.402P^1^1
"PKG",551,20,1,0)
2^^EASXDR
"PKG",551,20,1,1)
 
"PKG",551,20,"B",2,1)

"PKG",551,22,0)
^9.49I^1^1
"PKG",551,22,1,0)
1.0^3010315^3010523^66481
"PKG",551,22,1,"PAH",1,0)
34^3030723
"PKG",551,22,1,"PAH",1,1,0)
^^1^1^3030723
"PKG",551,22,1,"PAH",1,1,1,0)
LTC Copayments Phase III
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","EASECA")
0^8^B10759492
"RTN","EASECA",1,0)
EASECA ;ALB/PHH,LBD - Add a New LTC Co-Pay Test ;10 AUG 2001
"RTN","EASECA",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,34**;Mar 15, 2001
"RTN","EASECA",3,0)
 ;
"RTN","EASECA",4,0)
EN ;Entry point to add a new LTC Co-Pay test
"RTN","EASECA",5,0)
 N DGMDOD S DGMDOD=""
"RTN","EASECA",6,0)
 S DGMTYPT=3
"RTN","EASECA",7,0)
 I $D(DGMTDFN)#2 K DGMTDFN
"RTN","EASECA",8,0)
 S DIC="^DPT(",DIC(0)="AEMQ" W !! D ^DIC K DIC G Q:Y<0 S (DFN,DGMTDFN)=+Y
"RTN","EASECA",9,0)
 I $P($G(^DPT(DFN,.35)),U)'="" S DGMDOD=$P(^DPT(DFN,.35),U)
"RTN","EASECA",10,0)
 I $G(DGMDOD) W !!,"Patient died on: ",$$FMTE^XLFDT(DGMDOD,"1D") Q
"RTN","EASECA",11,0)
 ; Is patient a veteran?  Added for LTC III (EAS*1*34)
"RTN","EASECA",12,0)
 I $P($G(^DPT(DFN,"VET")),U)'="Y" W !!,"Patient is not a Veteran." Q
"RTN","EASECA",13,0)
 ;
"RTN","EASECA",14,0)
 S DGLDT=$$LST^EASECU(DFN,"",DGMTYPT),DGLD=$P(DGLDT,U,2),DGLDYR=$E(DGLD,1,3)_"1231"
"RTN","EASECA",15,0)
 ;
"RTN","EASECA",16,0)
DT S %DT("A")="DATE OF LTC COPAY TEST: ",%DT="AEX",%DT(0)="-NOW",%DT("B")="NOW" W ! D ^%DT K %DT G Q:Y<0 S DGMTDT=Y
"RTN","EASECA",17,0)
 I DGLD,DGMTDT'>DGLD W !?3,*7,"The date of test must be after the date of the last test on " S Y=DGLD X ^DD("DD") W Y,"." G DT
"RTN","EASECA",18,0)
 ; LTC III (EAS*1*34) - change to allow multiple tests within a year
"RTN","EASECA",19,0)
 I DGLD S X1=DGMTDT,X2=DGLD D ^%DTC I X<365 D  G EN:$G(Y)'=1
"RTN","EASECA",20,0)
 .W !?3,*7,"An LTC Copay Test already exists on " S Y=DGLD X ^DD("DD") W Y,"."
"RTN","EASECA",21,0)
 .S DIR(0)="Y",DIR("A")="Are you sure you want to add a new test",DIR("B")="NO" D ^DIR K DIR
"RTN","EASECA",22,0)
 .;S DGTTYP="LTC COPAY "
"RTN","EASECA",23,0)
 .;W !,$S($P($G(^DG(408.34,+$P($G(^DGMT(408.31,+DGLDT,0)),U,23),0)),U)="VAMC":"   Use the 'EASEC "_DGTTYP_"TEST EDIT' Option.",1:"   Use the 'EASEC "_DGTTYP_"TEST VIEW' Option.")
"RTN","EASECA",24,0)
 ;
"RTN","EASECA",25,0)
 D ADD G EN:DGMTI<0
"RTN","EASECA",26,0)
 ; Is veteran exempt from LTC copayments?
"RTN","EASECA",27,0)
 W !!,"... checking if veteran is exempt from LTC copayments ...",!
"RTN","EASECA",28,0)
 S DGEXMPT=$$EXMPT^EASECU(DFN)
"RTN","EASECA",29,0)
 I DGEXMPT D EXMPT^EASECSCC(DFN,DGMTI,DGEXMPT) D Q G EN
"RTN","EASECA",30,0)
 ; Check if veteran's income is below the pension threshold
"RTN","EASECA",31,0)
 D EN^EASECMT I $G(DGOUT) D DEL,Q G EN
"RTN","EASECA",32,0)
 I DGEXMPT D EXMPT^EASECSCC(DFN,DGMTI,2) D Q G EN
"RTN","EASECA",33,0)
 W !! F I=1:1:80 W "="
"RTN","EASECA",34,0)
 W !!,?10,"Veteran is NOT EXEMPT from Long Term Care copayments and"
"RTN","EASECA",35,0)
 W !,?10,"must complete a 10-10EC form."
"RTN","EASECA",36,0)
 W !! F I=1:1:80 W "="
"RTN","EASECA",37,0)
 ; Does veteran decline to provide income information?
"RTN","EASECA",38,0)
 W !!
"RTN","EASECA",39,0)
 D REF^EASECSCC I $D(DTOUT)!($D(DUOUT)) D Q G EN
"RTN","EASECA",40,0)
 I $D(DGREF) D  D Q G EN
"RTN","EASECA",41,0)
 .; Ask if veteran agrees to pay copayments; complete LTC copay test
"RTN","EASECA",42,0)
 .D AGREE^EASECSCC Q:$D(DTOUT)!($D(DUOUT))
"RTN","EASECA",43,0)
 .S DGSTA="NON-EXEMPT",DGCAT="T" D STA^DGMTSCU2 S (DGINT,DGDET,DGNWT)=""
"RTN","EASECA",44,0)
 .D UPD^EASECSCC
"RTN","EASECA",45,0)
 ; Go to LTC co-pay test (1010-EC) input screens
"RTN","EASECA",46,0)
 S DGMTACT="ADD",DGMTROU="EN^EASECA" G EN^EASECSC
"RTN","EASECA",47,0)
 ;
"RTN","EASECA",48,0)
Q K DA,DFN,DGADDF,DGBL,DGCAT,DGEXMPT,DGFL,DGFLD,DGIRO,DGLD,DGLDT,DGLDYR
"RTN","EASECA",49,0)
 K DGMTACT,DGMTCOR,DGMTDT,DGMTI,DGMTROU,DGMTYPT,DGOUT,DGREQF,DGSTA
"RTN","EASECA",50,0)
 K DGTTYP,DGVI,DGVO,DTOUT,DUOUT,X,X1,X2,Y
"RTN","EASECA",51,0)
 Q
"RTN","EASECA",52,0)
 ;
"RTN","EASECA",53,0)
ADD ;Add LTC Copay test
"RTN","EASECA",54,0)
 ; Input  -- DFN     Patient IEN
"RTN","EASECA",55,0)
 ;           DGMTDT  Date
"RTN","EASECA",56,0)
 ;           DGMTYPT Type of Test 3 = LTC Copay
"RTN","EASECA",57,0)
 ; Output -- DGMTI   Annual LTC Copay Test IEN
"RTN","EASECA",58,0)
 N DA,DD,DIC,DIK,DINUM,DLAYGO,DO,DS,X,D0,DGSITE
"RTN","EASECA",59,0)
 ;
"RTN","EASECA",60,0)
 S X=DGMTDT,(DIC,DIK)="^DGMT(408.31,",DIC(0)="L",DLAYGO=408.31
"RTN","EASECA",61,0)
 S DGSITE=$$GETSITE^DGMTU4(.DUZ)
"RTN","EASECA",62,0)
 S DIC("DR")=".02////"_DFN_";.019////"_DGMTYPT_";.23////1;2.05////"_DGSITE
"RTN","EASECA",63,0)
 K DD,D0
"RTN","EASECA",64,0)
 D FILE^DICN S DGMTI=+Y
"RTN","EASECA",65,0)
ADDQ Q
"RTN","EASECA",66,0)
 ;
"RTN","EASECA",67,0)
DEL ;Delete incomplete LTC Copay test
"RTN","EASECA",68,0)
 ; Input   -- DGMTI  LTC Copay test IEN
"RTN","EASECA",69,0)
 N DA,DIK
"RTN","EASECA",70,0)
 Q:'$G(DGMTI)  Q:$P($G(^DGMT(408.31,DGMTI,0)),U,19)'=3
"RTN","EASECA",71,0)
 S DA=DGMTI,DIK="^DGMT(408.31,"
"RTN","EASECA",72,0)
 D ^DIK
"RTN","EASECA",73,0)
 Q
"RTN","EASECCAL")
0^10^B14038379
"RTN","EASECCAL",1,0)
EASECCAL ;ALB/LBD - Calculate LTC copayment ;27 AUG 2001
"RTN","EASECCAL",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,19,34**;Mar 15, 2001
"RTN","EASECCAL",3,0)
 ;
"RTN","EASECCAL",4,0)
 ; Input --   DFN    Patient IEN
"RTN","EASECCAL",5,0)
 ;            MNTH   Last day of month for the LTC copay calculation
"RTN","EASECCAL",6,0)
 ;                    in FM format (e.g. 3020131)
"RTN","EASECCAL",7,0)
 ;            LOS    (Length of stay) The number of days in the patient's
"RTN","EASECCAL",8,0)
 ;                    LTC episode
"RTN","EASECCAL",9,0)
 ; Output --  COPAY  String containing copayment calculation
"RTN","EASECCAL",10,0)
 ;                    = 0: no completed LTC copay test on file
"RTN","EASECCAL",11,0)
 ;                    piece 1: LTC copay test status
"RTN","EASECCAL",12,0)
 ;                               (1=Exempt; 2=Non-Exempt)
"RTN","EASECCAL",13,0)
 ;                          2: If Exempt, Reason for Exemption
"RTN","EASECCAL",14,0)
 ;                               (IEN to file #714.1)
"RTN","EASECCAL",15,0)
 ;                          3: Calculated LTC copayment for IP 
"RTN","EASECCAL",16,0)
 ;                               (1-180 days)
"RTN","EASECCAL",17,0)
 ;                          4: Calculated LTC copayment for IP
"RTN","EASECCAL",18,0)
 ;                               (181+ days)
"RTN","EASECCAL",19,0)
 ;                          5: Calculated LTC copayment for OP
"RTN","EASECCAL",20,0)
 ;
"RTN","EASECCAL",21,0)
COPAY(DFN,MNTH,LOS) ;
"RTN","EASECCAL",22,0)
 N COPAY,DAYS,MX,IPDR,OPDR,IPMAX,OPMAX,LST,DGMT,DGMTI,DGMTDT,DGSTA,DGEXR,ERR,X1,X2
"RTN","EASECCAL",23,0)
 S COPAY=0
"RTN","EASECCAL",24,0)
 I 'DFN!('MNTH) G Q
"RTN","EASECCAL",25,0)
 S LOS=+$G(LOS),DAYS=$E(MNTH,6,7)
"RTN","EASECCAL",26,0)
 ; Get maximum daily rate for LTC copayments
"RTN","EASECCAL",27,0)
 ; DBIA #3717
"RTN","EASECCAL",28,0)
 S MX=$$MAXRATE^IBAECU(MNTH),OPDR=$P(MX,U),IPDR=$P(MX,U,2) I 'OPDR!('IPDR) G Q
"RTN","EASECCAL",29,0)
 ; Calculate maximum copayment for the month
"RTN","EASECCAL",30,0)
 S OPMAX=DAYS*OPDR,IPMAX=DAYS*IPDR
"RTN","EASECCAL",31,0)
 ; Get last completed LTC copay test
"RTN","EASECCAL",32,0)
 S LST=$$LST^EASECU(DFN,MNTH,3) I +LST=0 G Q
"RTN","EASECCAL",33,0)
 S DGMTI=$P(LST,U),DGMT(0)=$G(^DGMT(408.31,DGMTI,0)) I 'DGMT(0) G Q
"RTN","EASECCAL",34,0)
 S DGMTDT=+DGMT(0),DGSTA=$P($G(^DG(408.32,+$P(DGMT(0),U,3),0)),U,1)
"RTN","EASECCAL",35,0)
 S DGEXR=$P($G(^DGMT(408.31,DGMTI,2)),U,7)
"RTN","EASECCAL",36,0)
 ; If LTC copay test status is neither NON-EXEMPT nor EXEMPT, quit
"RTN","EASECCAL",37,0)
 I DGSTA'="NON-EXEMPT",DGSTA'="EXEMPT" G Q
"RTN","EASECCAL",38,0)
 ; If LTC copay test is more than a year old and the veteran does
"RTN","EASECCAL",39,0)
 ; not have an exemption for eligibility (Compensable SC) or LTC
"RTN","EASECCAL",40,0)
 ; before 11/30/99, quit  (Added for LTC Phase III - EAS*1*34)
"RTN","EASECCAL",41,0)
 S X1=MNTH,X2=DGMTDT D ^%DTC I X>365,"^1^4^"'[(U_DGEXR_U) G Q
"RTN","EASECCAL",42,0)
 S COPAY=$S(DGSTA="EXEMPT":1,1:2)_U
"RTN","EASECCAL",43,0)
 ; If test status = 'EXEMPT', get Reason for Exemption
"RTN","EASECCAL",44,0)
 I DGSTA="EXEMPT" S COPAY=COPAY_DGEXR
"RTN","EASECCAL",45,0)
 ; If veteran declined to give financial info, copay = max monthly copay
"RTN","EASECCAL",46,0)
 I $P(DGMT(0),U,14) S COPAY=COPAY_U_IPMAX_U_IPMAX_U_OPMAX G Q
"RTN","EASECCAL",47,0)
 ; Get total income, assets and expenses for veteran (and spouse)
"RTN","EASECCAL",48,0)
 D FINTOT I $G(ERR) D  G Q
"RTN","EASECCAL",49,0)
 .I +COPAY=1 Q
"RTN","EASECCAL",50,0)
 .;no financial data but veteran agreed to pay copayments, copay = max
"RTN","EASECCAL",51,0)
 .I $P(DGMT(0),U,11) S COPAY=COPAY_U_IPMAX_U_IPMAX_U_OPMAX Q
"RTN","EASECCAL",52,0)
 .S COPAY=0
"RTN","EASECCAL",53,0)
 ; Calculate copayments
"RTN","EASECCAL",54,0)
 D CALC
"RTN","EASECCAL",55,0)
Q ; Quit and return COPAY
"RTN","EASECCAL",56,0)
 Q COPAY
"RTN","EASECCAL",57,0)
 ;
"RTN","EASECCAL",58,0)
FINTOT ; Get total income, assets and expenses for veteran (and spouse)
"RTN","EASECCAL",59,0)
 N DGDC,DGDEP,DGDET,DGERR,DGIN0,DGIN1,DGIN2,DGINI,DGINT,DGINTF,DGIRI
"RTN","EASECCAL",60,0)
 N DGNC,DGND,DGNWT,DGNWTF,DGPRI,DGVINI,DGVIR0,DGVIRI
"RTN","EASECCAL",61,0)
 S ERR=0
"RTN","EASECCAL",62,0)
 S DGPRI=$O(^DGPR(408.12,"C",DFN_";DPT(",0)) I 'DGPRI S ERR=1 Q
"RTN","EASECCAL",63,0)
 D GETIENS^EASECU2(DFN,DGPRI,DGMTDT) I '$G(DGIRI),'$G(DGINI) S ERR=1 Q
"RTN","EASECCAL",64,0)
 S DGVIRI=DGIRI,DGVINI=DGINI
"RTN","EASECCAL",65,0)
 D DEP^EASECSU3
"RTN","EASECCAL",66,0)
 D INC^EASECSU3
"RTN","EASECCAL",67,0)
 I DGINT=0,DGDET=0,DGNWT=0 S ERR=1 Q
"RTN","EASECCAL",68,0)
 ; Does spouse reside in community?  Does spouse live with patient?
"RTN","EASECCAL",69,0)
 S SRIC=$P(DGVIR0,U,16),SLIV=$P(DGVIR0,U,15)
"RTN","EASECCAL",70,0)
 ; Divide income and expense totals by 12 to get monthly amounts
"RTN","EASECCAL",71,0)
 S INC=DGINT/12,EXP=DGDET/12,AST=DGNWT
"RTN","EASECCAL",72,0)
 ; Calculate total monthly allowance:
"RTN","EASECCAL",73,0)
 ; 20*number of days in month*(veteran+spouse(if married and spouse
"RTN","EASECCAL",74,0)
 ;   resides in the community))
"RTN","EASECCAL",75,0)
 S ALLOW=20*DAYS*(1+SRIC)
"RTN","EASECCAL",76,0)
 Q
"RTN","EASECCAL",77,0)
 ;
"RTN","EASECCAL",78,0)
CALC ; Calculate copayments
"RTN","EASECCAL",79,0)
 ; Calculation for IP services up to 180 days and OP services:
"RTN","EASECCAL",80,0)
 ;   Income-Allowance-Expenses
"RTN","EASECCAL",81,0)
 S CCPY=INC-ALLOW-EXP
"RTN","EASECCAL",82,0)
 S (OPCPY,IPCPY1)=$S(CCPY>0:(CCPY+.5)\1,1:0)
"RTN","EASECCAL",83,0)
 ; Calculation for IP services 181+ days, add in assets
"RTN","EASECCAL",84,0)
 S IPCPY2=0 I LOS>180 D
"RTN","EASECCAL",85,0)
 . S TEXP=0 I DGSP,SRIC S TEXP=TEXP+EXP
"RTN","EASECCAL",86,0)
 . ; number of months to spend down assets
"RTN","EASECCAL",87,0)
 . S SD=(LOS-180)/30,SD=((SD+.5)\1)-1
"RTN","EASECCAL",88,0)
 . ; get month to start spend down
"RTN","EASECCAL",89,0)
 . S M=+$E(MNTH,4,5)-SD I M<1 F  S M=12-M Q:M>0
"RTN","EASECCAL",90,0)
 . ; calculate asset spend down
"RTN","EASECCAL",91,0)
 . I SD>0 F I=1:1:SD D
"RTN","EASECCAL",92,0)
 . . S DAYS=$S("^4^6^9^11^"[("^"_M_"^"):30,M=2:28,1:31)
"RTN","EASECCAL",93,0)
 . . ;get total expenses + allowance
"RTN","EASECCAL",94,0)
 . . S TEXALL=TEXP+(20*DAYS*(1+SRIC))
"RTN","EASECCAL",95,0)
 . . S IPMAX=IPDR*DAYS
"RTN","EASECCAL",96,0)
 . . I (INC-TEXALL)'>IPMAX S AST=AST-(IPMAX-(INC-TEXALL)) S:AST<0 AST=0
"RTN","EASECCAL",97,0)
 . . S M=M+1 S:M=13 M=1
"RTN","EASECCAL",98,0)
 . S CCPY=CCPY+AST
"RTN","EASECCAL",99,0)
 . ;If veteran is single or spouse does not reside in the community,
"RTN","EASECCAL",100,0)
 . ;add expenses back in
"RTN","EASECCAL",101,0)
 . I 'DGSP!('SRIC) S CCPY=CCPY+EXP
"RTN","EASECCAL",102,0)
 . S IPCPY2=(CCPY+.5)\1 I IPCPY2<0 S IPCPY2=0
"RTN","EASECCAL",103,0)
 S COPAY=COPAY_U_IPCPY1_U_IPCPY2_U_OPCPY
"RTN","EASECCAL",104,0)
 K CCPY,INC,ALLOW,EXP,AST,OPCPY,IPCPY1,IPCPY2,DGSP,M,SD,SRIC,SLIV,TEXP,TEXALL
"RTN","EASECCAL",105,0)
 Q
"RTN","EASECDD")
0^9^B38859301
"RTN","EASECDD",1,0)
EASECDD ;ALB/LBD - Executable help for fields in file #408.21  ;4 SEP 2001
"RTN","EASECDD",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,34**;Mar 15, 2001
"RTN","EASECDD",3,0)
 ;
"RTN","EASECDD",4,0)
8 ; Social Security
"RTN","EASECDD",5,0)
 W !,?8,"Enter in this field the annual amount of Social Security"
"RTN","EASECDD",6,0)
 W !,?8,"received during the current calendar year."
"RTN","EASECDD",7,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",8,0)
 S X="?"
"RTN","EASECDD",9,0)
 Q
"RTN","EASECDD",10,0)
9 ; US Civil Service
"RTN","EASECDD",11,0)
 W !,?8,"Enter in this field the annual amount of U.S. Civil Service"
"RTN","EASECDD",12,0)
 W !,?8,"received during the current calendar year."
"RTN","EASECDD",13,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",14,0)
 S X="?"
"RTN","EASECDD",15,0)
 Q
"RTN","EASECDD",16,0)
10 ; US Railroad Retirement
"RTN","EASECDD",17,0)
 W !,?8,"Enter in this field the annual amount of U.S. Railroad Retirement"
"RTN","EASECDD",18,0)
 W !,?8,"received during the current calendar year."
"RTN","EASECDD",19,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",20,0)
 S X="?"
"RTN","EASECDD",21,0)
 Q
"RTN","EASECDD",22,0)
11 ; Military Retirement
"RTN","EASECDD",23,0)
 W !,?8,"Enter in this field the annual amount of Military Retirement"
"RTN","EASECDD",24,0)
 W !,?8,"received during the current calendar year."
"RTN","EASECDD",25,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",26,0)
 S X="?"
"RTN","EASECDD",27,0)
 Q
"RTN","EASECDD",28,0)
12 ; Unemployment Compensation
"RTN","EASECDD",29,0)
 W !,?8,"Enter in this field the annual amount of Unemployment Compensation"
"RTN","EASECDD",30,0)
 W !,?8,"received during the current calendar year."
"RTN","EASECDD",31,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",32,0)
 S X="?"
"RTN","EASECDD",33,0)
 Q
"RTN","EASECDD",34,0)
13 ; Other Retirement
"RTN","EASECDD",35,0)
 W !,?8,"Enter in this field the annual amount of Other Retirement received"
"RTN","EASECDD",36,0)
 W !,?8,"during the current calendar year.  This includes company, state,"
"RTN","EASECDD",37,0)
 W !,?8,"local, etc."
"RTN","EASECDD",38,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",39,0)
 S X="?"
"RTN","EASECDD",40,0)
 Q
"RTN","EASECDD",41,0)
14 ; Total Income from Employment
"RTN","EASECDD",42,0)
 W !,?8,"Enter in this field the annual amount of Gross Income received during"
"RTN","EASECDD",43,0)
 W !,?8,"the current year.  This includes, but is not limited to, wages and"
"RTN","EASECDD",44,0)
 W !,?8,"income from a business, bonuses, tips, severance pay, accrued"
"RTN","EASECDD",45,0)
 W !,?8,"benefits, cash gifts."
"RTN","EASECDD",46,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",47,0)
 S X="?"
"RTN","EASECDD",48,0)
 Q
"RTN","EASECDD",49,0)
15 ; Interest, Dividend or Annuity
"RTN","EASECDD",50,0)
 W !,?8,"Enter in this field the annual amount of Interest and Dividend"
"RTN","EASECDD",51,0)
 W !,?8,"Income received during the current calendar year (i.e., interest"
"RTN","EASECDD",52,0)
 W !,?8,"income, standard dividend income from non tax deferred annuities)."
"RTN","EASECDD",53,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",54,0)
 S X="?"
"RTN","EASECDD",55,0)
 Q
"RTN","EASECDD",56,0)
16 ; Workers Comp or Black Lung
"RTN","EASECDD",57,0)
 W !,?8,"Enter in this field the annual amount of Workers Compensation or"
"RTN","EASECDD",58,0)
 W !,?8,"Black Lung Benefits received during the current calendar year."
"RTN","EASECDD",59,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",60,0)
 S X="?"
"RTN","EASECDD",61,0)
 Q
"RTN","EASECDD",62,0)
17 ; All Other Income
"RTN","EASECDD",63,0)
 W !,?8,"Enter in this field the annual amount of All Other Income"
"RTN","EASECDD",64,0)
 W !,?8,"received during the current calendar year (i.e., inheritance amounts,"
"RTN","EASECDD",65,0)
 W !,?8,"tort settlement payments)."
"RTN","EASECDD",66,0)
 W !!,?8,"A monthly amount can be entered with an '*' after it.",!
"RTN","EASECDD",67,0)
 S X="?"
"RTN","EASECDD",68,0)
 Q
"RTN","EASECDD",69,0)
101 ; Medical Expenses
"RTN","EASECDD",70,0)
 W !,?8,"Enter in this field the total amount of unreimbursed medical expenses"
"RTN","EASECDD",71,0)
 W !,?8,"paid by the veteran during the current calendar year.  The expenses"
"RTN","EASECDD",72,0)
 W !,?8,"can be for the veteran or for members of the veteran's family."
"RTN","EASECDD",73,0)
 W !,?8,"Reportable medical expenses include amounts paid for the following:"
"RTN","EASECDD",74,0)
 W !,?8,"fees of physicians, dentists, and other providers of health services;"
"RTN","EASECDD",75,0)
 W !,?8,"hospital and nursing home fees; medical insurance premiums (including"
"RTN","EASECDD",76,0)
 W !,?8,"the Medicare premium); drugs and medicines; eyeglasses; any other"
"RTN","EASECDD",77,0)
 W !,?8,"expenses that are reasonable related to medical care.  The expenses"
"RTN","EASECDD",78,0)
 W !,?8,"must actually have been paid by the veteran.  Do not list expenses"
"RTN","EASECDD",79,0)
 W !,?8,"which have not been paid or which have been paid by someone other"
"RTN","EASECDD",80,0)
 W !,?8,"than the veteran.  Do not list expenses which the veteran has paid if"
"RTN","EASECDD",81,0)
 W !,?8,"the veteran expects to receive reimbursement from insurance or some"
"RTN","EASECDD",82,0)
 W !,?8,"other source."
"RTN","EASECDD",83,0)
 W !
"RTN","EASECDD",84,0)
 W !,?8,"A monthly amount can be entered with an '*' after it."
"RTN","EASECDD",85,0)
 S X="?"
"RTN","EASECDD",86,0)
 Q
"RTN","EASECDD",87,0)
102 ; Funeral and Burial Expenses
"RTN","EASECDD",88,0)
 ;   Modified wording for LTC Phase III (EAS*1*34)
"RTN","EASECDD",89,0)
 W !,?8,"Enter in this field amounts paid by the veteran during the current"
"RTN","EASECDD",90,0)
 W !,?8,"calendar year for funeral or burial expenses of the veteran's"
"RTN","EASECDD",91,0)
 W !,?8,"spouse or child, or pre-paid arrangements for the veteran."
"RTN","EASECDD",92,0)
 W !,?8,"Do not report amounts paid for funeral or burial expenses of other"
"RTN","EASECDD",93,0)
 W !,?8,"relatives such as parents, siblings, etc."
"RTN","EASECDD",94,0)
 W !
"RTN","EASECDD",95,0)
 W !,?8,"A monthly amount can be entered with an '*' after it."
"RTN","EASECDD",96,0)
 S X="?"
"RTN","EASECDD",97,0)
 Q
"RTN","EASECDD",98,0)
103 ; Educational Expenses
"RTN","EASECDD",99,0)
 W !,?8,"Enter in this field the total amount paid by the veteran for"
"RTN","EASECDD",100,0)
 W !,?8,"educational expenses during the current calendar year.  This"
"RTN","EASECDD",101,0)
 W !,?8,"includes educational expenses for the veteran, spouse and children."
"RTN","EASECDD",102,0)
 W !,?8,"Educational expenses are tuition, fees, and books if enrolled in a"
"RTN","EASECDD",103,0)
 W !,?8,"program of education."
"RTN","EASECDD",104,0)
 W !
"RTN","EASECDD",105,0)
 W !,?8,"A monthly amount can be entered with an '*' after it."
"RTN","EASECDD",106,0)
 S X="?"
"RTN","EASECDD",107,0)
 Q
"RTN","EASECDD",108,0)
201 ; Cash
"RTN","EASECDD",109,0)
 W !,?8,"Enter in this field cash and amounts in bank accounts.  This"
"RTN","EASECDD",110,0)
 W !,?8,"includes checking accounts, savings accounts, money markets,"
"RTN","EASECDD",111,0)
 W !,?8,"interest, dividends from IRA, 401K's, and other tax deferred"
"RTN","EASECDD",112,0)
 W !,?8,"annuities."
"RTN","EASECDD",113,0)
 S X="?"
"RTN","EASECDD",114,0)
 Q
"RTN","EASECDD",115,0)
202 ; Stock, bonds, mutual funds
"RTN","EASECDD",116,0)
 W !,?8,"Enter in this field the current value of stocks, bonds, mutual"
"RTN","EASECDD",117,0)
 W !,?8,"funds, SEP's, and other retirement accounts (e.g., IRA, 401K,"
"RTN","EASECDD",118,0)
 W !,?8,"annuities, self-employed person)."
"RTN","EASECDD",119,0)
 S X="?"
"RTN","EASECDD",120,0)
 Q
"RTN","EASECDEL")
0^7^B10132377
"RTN","EASECDEL",1,0)
EASECDEL ;ALB/LBD - Delete a LTC Copay Test;  2 JUN 2003
"RTN","EASECDEL",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**34**;Mar 15, 2001
"RTN","EASECDEL",3,0)
 ;
"RTN","EASECDEL",4,0)
EN ; Entry point to delete a LTC copay test
"RTN","EASECDEL",5,0)
 I '$D(^XUSEC("DG MTDELETE",+DUZ)) W !!,"ACCESS TO THIS OPTION IS RESTRICTED!!",*7 G EXIT
"RTN","EASECDEL",6,0)
 ;
"RTN","EASECDEL",7,0)
LKP ; Patient lookup
"RTN","EASECDEL",8,0)
 N DIC,DTOUT,DUOUT,DGMTYPT,DGNAM,DGDOB,VA,Y
"RTN","EASECDEL",9,0)
 S DGMTYPT=3
"RTN","EASECDEL",10,0)
 D HOME^%ZIS S DIC="^DPT(",DIC(0)="AEQMZ" W ! D ^DIC G:$D(DTOUT)!($D(DUOUT))!(+Y<0) EXIT
"RTN","EASECDEL",11,0)
 I '$O(^DGMT(408.31,"AD",DGMTYPT,+Y,0)) W !?5,$P(Y(0),U)," has no LTC copay (10-10EC) tests on file." G LKP
"RTN","EASECDEL",12,0)
 S DFN=+Y,DGNAM=$P(Y(0),U),DGDOB=$P(Y(0),U,3)
"RTN","EASECDEL",13,0)
 D HD
"RTN","EASECDEL",14,0)
 ;
"RTN","EASECDEL",15,0)
LKT ; LTC Copay Test lookup
"RTN","EASECDEL",16,0)
 N D,DIC,DGMTI,DGMTDT,DIR,X,Y
"RTN","EASECDEL",17,0)
 S DIC("W")="D ID^EASECDEL",DIC("S")="I $P(^(0),U,2)=DFN,$P(^(0),U,19)=DGMTYPT"
"RTN","EASECDEL",18,0)
 W ! S DIC="^DGMT(408.31,",DIC(0)="EQZ",X=DFN,D="C" D IX^DIC K DIC
"RTN","EASECDEL",19,0)
 I $D(DTOUT)!($D(DUOUT))!(+Y<0) G LKP
"RTN","EASECDEL",20,0)
 I '$P($G(^DG(408.34,+$P(Y(0),U,23),0)),U,2) W !,?5,"This LTC Copay Test (10-10EC) is uneditable and cannot be deleted." G LKP
"RTN","EASECDEL",21,0)
 S DGMTI=+Y,DGMTDT=$P(Y(0),U)
"RTN","EASECDEL",22,0)
 S DIR(0)="Y",DIR("A")="Display test",DIR("B")="YES"
"RTN","EASECDEL",23,0)
 D ^DIR K DIR I Y D HD,DISPLAY^EASECU23(DGMTI,DGMTYPT)
"RTN","EASECDEL",24,0)
 S DIR(0)="Y",DIR("A")="Are you sure you want to delete the "_$$FMTE^XLFDT(DGMTDT,1)_" test",DIR("B")="NO"
"RTN","EASECDEL",25,0)
 W ! D ^DIR K DIR I Y'=1 W !,"    <OK, nothing deleted!>" G LKP
"RTN","EASECDEL",26,0)
 D DEL(DGMTI,DFN) W !,"  <LTC Copay Test deleted.>"
"RTN","EASECDEL",27,0)
 G LKP
"RTN","EASECDEL",28,0)
EXIT Q
"RTN","EASECDEL",29,0)
 ;
"RTN","EASECDEL",30,0)
DEL(DGMTI,DFN) ; Delete selected LTC Copay Test from Annual Means Test file
"RTN","EASECDEL",31,0)
 ; #408.31 and all entries that point to it in the Individual Annual
"RTN","EASECDEL",32,0)
 ; Income file #408.21 and the Income Relations file #408.22.
"RTN","EASECDEL",33,0)
 ; INPUT - DGMTI  IEN of LTC Copay Test to delete from file #408.31
"RTN","EASECDEL",34,0)
 ;         DFN  IEN of Patient file #2
"RTN","EASECDEL",35,0)
 ; OUTPUT - none
"RTN","EASECDEL",36,0)
 N DIK,DA,DGX,DGY,LTC4
"RTN","EASECDEL",37,0)
 S LTC4=$P($G(^DGMT(408.31,DGMTI,2)),U,8)
"RTN","EASECDEL",38,0)
 S DA=DGMTI,DIK="^DGMT(408.31," D ^DIK K DIK
"RTN","EASECDEL",39,0)
 S DIK="^DGMT(408.22,",DGY=0
"RTN","EASECDEL",40,0)
 F  S DGY=$O(^DGMT(408.22,"AMT",DGMTI,DFN,DGY)) Q:'DGY  S DGX=0 F  S DGX=$O(^DGMT(408.22,"AMT",DGMTI,DFN,DGY,DGX)) Q:'DGX  S DA=DGX D ^DIK
"RTN","EASECDEL",41,0)
 S DGX=0
"RTN","EASECDEL",42,0)
 F  S DGX=$O(^DGMT(408.21,"AM",DGMTI,DGX)) Q:'DGX  S DIK="^DGMT(408.21,",DA=DGX D ^DIK D
"RTN","EASECDEL",43,0)
 .S DGY=0 F  S DGY=$O(^DGMT(408.22,"AIND",DGX,DGY)) Q:'DGY  S DIK="^DGMT(408.22,",DA=DGY D ^DIK
"RTN","EASECDEL",44,0)
 ; Delete associated LTC Copay Exemption test (type 4) if it's
"RTN","EASECDEL",45,0)
 ; not associated with any other LTC Copay test.
"RTN","EASECDEL",46,0)
 Q:'LTC4  Q:$O(^DGMT(408.31,"AT",LTC4,""))
"RTN","EASECDEL",47,0)
 D DEL4(LTC4)
"RTN","EASECDEL",48,0)
 Q
"RTN","EASECDEL",49,0)
 ;
"RTN","EASECDEL",50,0)
DEL4(LTC4) ; Delete LTC Copay Exemption Test (type 4) associated with
"RTN","EASECDEL",51,0)
 ; LTC Copay Test. Update IVM Patient file to send deletion to HEC.
"RTN","EASECDEL",52,0)
 ; INPUT - LTC4   IEN of LTC Copay Exemption Test to delete from #408.31
"RTN","EASECDEL",53,0)
 N DGMTDT,DGMTI,DGMTP,DGMTA,DGMTINF,DGMTACT,DGMTYPT
"RTN","EASECDEL",54,0)
 S DGMTI=$G(LTC4) Q:'DGMTI
"RTN","EASECDEL",55,0)
 S DGMTDT=$P($G(^DGMT(408.31,DGMTI,0)),U) Q:'DGMTDT
"RTN","EASECDEL",56,0)
 S DGMTP=$G(^DGMT(408.31,DGMTI,0))
"RTN","EASECDEL",57,0)
 D DELETE^IVMPLOG(DFN,DGMTDT,,,,4)
"RTN","EASECDEL",58,0)
 S DA=DGMTI,DIK="^DGMT(408.31," D ^DIK
"RTN","EASECDEL",59,0)
 S DGMTACT="DEL" D AFTER^DGMTEVT
"RTN","EASECDEL",60,0)
 S DGMTYPT=4,DGMTINF=1 D EN^DGMTAUD
"RTN","EASECDEL",61,0)
 D ^IVMPMTE
"RTN","EASECDEL",62,0)
 Q
"RTN","EASECDEL",63,0)
HD ; Writes patient header to the screen
"RTN","EASECDEL",64,0)
 W @IOF,"Name: ",DGNAM,?40,"DOB: ",$$FMTE^XLFDT(DGDOB),?65,"Pat ID: ",$$PID(DFN),!!!
"RTN","EASECDEL",65,0)
 Q
"RTN","EASECDEL",66,0)
 ;
"RTN","EASECDEL",67,0)
PID(DFN) ; Return PID
"RTN","EASECDEL",68,0)
 ; INPUT  - DFN
"RTN","EASECDEL",69,0)
 ; OUTPUT - PID or 'UNKNOWN'
"RTN","EASECDEL",70,0)
 D PID^VADPT6
"RTN","EASECDEL",71,0)
 Q $S(VA("PID")]"":VA("PID"),1:"UNKNOWN")
"RTN","EASECDEL",72,0)
 ;
"RTN","EASECDEL",73,0)
ID ; Write identifiers for test lookup
"RTN","EASECDEL",74,0)
 N DGI,DGN
"RTN","EASECDEL",75,0)
 S DGI=Y,DGN=$G(^DGMT(408.31,DGI,0))
"RTN","EASECDEL",76,0)
 W "  LTC Copay Test Date   Status: ",$$S^DGMTAUD1($P(^(0),U,3))
"RTN","EASECDEL",77,0)
 W !?36,"Source: ",$$SR^DGMTAUD1(DGN)
"RTN","EASECDEL",78,0)
 Q
"RTN","EASECE")
0^4^B13582040
"RTN","EASECE",1,0)
EASECE ;ALB/PHH,LBD - Edit an Existing LTC Co-Pay Test ;17 AUG 2001
"RTN","EASECE",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,34**;Mar 15, 2001
"RTN","EASECE",3,0)
 ;
"RTN","EASECE",4,0)
EN ;Entry point to edit an existing LTC co-pay test
"RTN","EASECE",5,0)
 N DGMDOD S DGMDOD="",DGMTYPT=3
"RTN","EASECE",6,0)
 S DIC("S")="I $D(^DGMT(408.31,""AID"",DGMTYPT,+Y))"
"RTN","EASECE",7,0)
 I $D(DGMTDFN)#2 K DGMTDFN
"RTN","EASECE",8,0)
 S DIC="^DPT(",DIC(0)="AEMQ" W ! D ^DIC K DIC G Q:Y<0 S (DFN,DGMTDFN)=+Y
"RTN","EASECE",9,0)
 I $P($G(^DPT(DFN,.35)),U)'="" S DGMDOD=$P(^DPT(DFN,.35),U)
"RTN","EASECE",10,0)
 I $G(DGMDOD) W !,"Patient died on: ",$$FMTE^XLFDT(DGMDOD,"1D") Q
"RTN","EASECE",11,0)
 ;
"RTN","EASECE",12,0)
DT S DIC("A")="Select DATE OF LTC COPAY TEST: "
"RTN","EASECE",13,0)
 I $D(^DGMT(408.31,+$$LST^EASECU(DFN,"",DGMTYPT),0)) S DIC("B")=$P(^(0),"^")
"RTN","EASECE",14,0)
 S DIC("S")="I $P(^(0),U,2)=DFN,$P(^(0),U,19)=DGMTYPT"
"RTN","EASECE",15,0)
 S DIC="^DGMT(408.31,",DIC(0)="EQZ" W ! D EN^DGMTLK K DIC G Q:Y<0
"RTN","EASECE",16,0)
 S DGMTI=+Y,DGMTDT=$P(Y,"^",2),DGMT0=Y(0)
"RTN","EASECE",17,0)
 ;
"RTN","EASECE",18,0)
 ;If test is uneditable, print error message and allow user to view test
"RTN","EASECE",19,0)
 ;or print 10/10EC
"RTN","EASECE",20,0)
 ;
"RTN","EASECE",21,0)
 I '$P($G(^DG(408.34,+$P(Y(0),U,23),0)),U,2) D  D:$G(DGMTERR) VIEWPRT G EN
"RTN","EASECE",22,0)
 .W !!?3,*7,"Warning: Uneditable LTC Copay test.  The source of this test is "_$S($$SR^DGMTAUD1(Y(0))]"":$$SR^DGMTAUD1(Y(0)),1:"UNKNOWN")
"RTN","EASECE",23,0)
 .W !?12,"which has been flagged as an uneditable source.",!
"RTN","EASECE",24,0)
 .S DIR("A")="Would you like to view the LTC Copay test or print the 10-10EC",DIR("B")="NO",DIR(0)="Y"
"RTN","EASECE",25,0)
 .D ^DIR K DIR S DGMTERR=Y I $D(DTOUT)!($D(DUOUT)) K DGMTERR,DTOUT,DUOUT
"RTN","EASECE",26,0)
 ;
"RTN","EASECE",27,0)
 ; If user holds DG MTDELETE security key, allow test date to be edited.
"RTN","EASECE",28,0)
 ; LTC III (EAS*1*34)
"RTN","EASECE",29,0)
 I $D(^XUSEC("DG MTDELETE",+$G(DUZ))) D
"RTN","EASECE",30,0)
 .N DIR,DA,DR,DIE,X,Y,DTOUT,DUOUT,DIROUT,DIRUT,DGNEWDT
"RTN","EASECE",31,0)
 .S DIR(0)="D^:DT:EX",DIR("A")="DATE OF TEST",DIR("B")=$$FMTE^XLFDT(DGMTDT,1)
"RTN","EASECE",32,0)
 .S DIR("?")="Enter a date that is less than or equal to today."
"RTN","EASECE",33,0)
 .S DIR("?",1)="Enter the date of the LTC Copay Test."
"RTN","EASECE",34,0)
 .D ^DIR K DIR Q:'Y!(Y=DGMTDT)  S DGNEWDT=Y
"RTN","EASECE",35,0)
 .S DIR(0)="Y",DIR("A")="Are you sure you want to change the date of the LTC Copay Test",DIR("B")="NO" D ^DIR Q:'Y
"RTN","EASECE",36,0)
 .S DIE="^DGMT(408.31,",DA=DGMTI,DR=".01////"_DGNEWDT_";2.02///NOW"
"RTN","EASECE",37,0)
 .D ^DIE
"RTN","EASECE",38,0)
 ;
"RTN","EASECE",39,0)
 ;Is veteran exempt?
"RTN","EASECE",40,0)
 S DGEXMPT=$$EXMPT^EASECU(DFN)
"RTN","EASECE",41,0)
 I DGEXMPT D EXMPT^EASECSCC(DFN,DGMTI,DGEXMPT) D Q G EN
"RTN","EASECE",42,0)
 ;
"RTN","EASECE",43,0)
 D DISPLAY^EASECU23(DGMTI,DGMTYPT),PAUSE I $D(DTOUT)!($D(DUOUT)) K DTOUT,DUOUT G EN
"RTN","EASECE",44,0)
 ;
"RTN","EASECE",45,0)
 ; Check if veteran's income is below the pension threshold
"RTN","EASECE",46,0)
 D EN^EASECMT I $G(DGOUT) D Q G EN
"RTN","EASECE",47,0)
 I DGEXMPT D EXMPT^EASECSCC(DFN,DGMTI,2) D Q G EN
"RTN","EASECE",48,0)
 S DGMT0=$G(^DGMT(408.31,DGMTI,0)) F I=4,5,15 I $P(DGMT0,U,I) G EDT
"RTN","EASECE",49,0)
 ; Display message for vets who declined to provide income info
"RTN","EASECE",50,0)
 ; LTC III (EAS*1*34)
"RTN","EASECE",51,0)
 I $P(DGMT0,U,14)=1 D
"RTN","EASECE",52,0)
 .W !! F I=1:1:80 W "="
"RTN","EASECE",53,0)
 .W !!,?10,"Veteran is NOT EXEMPT from Long Term Care copayments and"
"RTN","EASECE",54,0)
 .W !,?10,"must complete a 10-10EC form."
"RTN","EASECE",55,0)
 .W !! F I=1:1:80 W "="
"RTN","EASECE",56,0)
 ; Does veteran decline to provide income information?
"RTN","EASECE",57,0)
 W !!
"RTN","EASECE",58,0)
 D REF^EASECSCC I $D(DTOUT)!($D(DUOUT)) D Q G EN
"RTN","EASECE",59,0)
 I $D(DGREF) D  D Q G EN
"RTN","EASECE",60,0)
 .; Ask if veteran agrees to pay copayments; complete LTC copay test
"RTN","EASECE",61,0)
 .D AGREE^EASECSCC Q:$D(DTOUT)!($D(DUOUT))
"RTN","EASECE",62,0)
 .S DGSTA="NON-EXEMPT",DGCAT="T" D STA^DGMTSCU2 S (DGINT,DGDET,DGNWT)=""
"RTN","EASECE",63,0)
 .D UPD^EASECSCC
"RTN","EASECE",64,0)
 ;
"RTN","EASECE",65,0)
EDT S DGMTACT="EDT",DGMTROU="EN^EASECE" G EN^EASECSC
"RTN","EASECE",66,0)
 ;
"RTN","EASECE",67,0)
Q K DFN,DGEXMPT,DGMTACT,DGMTDT,DGMTERR,DGMT0,DGMTI,DGMTROU,DGMTYPT,DGMTX,DGOUT,DTOUT,DUOUT,X,Y
"RTN","EASECE",68,0)
 K DGREF,DGSTA,DGCAT,DGINT,DGDET,DGNWT,I
"RTN","EASECE",69,0)
 Q
"RTN","EASECE",70,0)
 ;
"RTN","EASECE",71,0)
PAUSE S DIR(0)="E" D ^DIR
"RTN","EASECE",72,0)
 Q
"RTN","EASECE",73,0)
 ;
"RTN","EASECE",74,0)
VIEWPRT ; Select 1 to view an uneditable means test or 2 to print a 10/10EC
"RTN","EASECE",75,0)
 ;
"RTN","EASECE",76,0)
 S DIR(0)="S^1:View LTC Copay Test;2:Print LTC Copay Test 10-10EC",DIR("A")="Select Choice"
"RTN","EASECE",77,0)
 D ^DIR S DGMTANS=Y G:$D(DTOUT)!($D(DUOUT)) VIEWPRTQ
"RTN","EASECE",78,0)
 I DGMTANS=1 D EN1^EASECV
"RTN","EASECE",79,0)
 I DGMTANS=2 D OEN^EASEC10E
"RTN","EASECE",80,0)
VIEWPRTQ ;
"RTN","EASECE",81,0)
 K DGMTANS,DIR,DTOUT,DUOUT,Y
"RTN","EASECE",82,0)
 Q
"RTN","EASECE",83,0)
 ;
"RTN","EASECPC")
0^3^B88710821
"RTN","EASECPC",1,0)
EASECPC ;ALB/PHH,LBD,CKN - LTC Co-Payment Report; 29-AUG-2001
"RTN","EASECPC",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,19,24,34**;Mar 15, 2001
"RTN","EASECPC",3,0)
 ;
"RTN","EASECPC",4,0)
 ; This routine produces a calculated LTC Co-Payment for a veteran.
"RTN","EASECPC",5,0)
 ;
"RTN","EASECPC",6,0)
EN N PAGE,DFN,DGMTI,DGMTDT,DGSTA,MODE,MARIT,MAXRT
"RTN","EASECPC",7,0)
 N DGDC,DGERR,DGINI,DGINTF,DGIRI,DGMTPAR,DGNC,DGND,DGSP,DGVIR0
"RTN","EASECPC",8,0)
 S DTIME=$G(DTIME,300),PAGE=0,(DFN,DGMTI,DGMTDT,DGSTA,MARIT)="",MODE=1
"RTN","EASECPC",9,0)
 Q:$$GETDFN
"RTN","EASECPC",10,0)
 Q:$$GETSDATE
"RTN","EASECPC",11,0)
 Q:$$EXEMPT
"RTN","EASECPC",12,0)
 S MARIT=$$MARIT
"RTN","EASECPC",13,0)
 ; Get the maximum daily copay rate for outpatient and inpatient LTC
"RTN","EASECPC",14,0)
 ; DBIA #3717
"RTN","EASECPC",15,0)
 S MAXRT=$$MAXRATE^IBAECU(DGMTDT)
"RTN","EASECPC",16,0)
 I '$P(MAXRT,U)!('$P(MAXRT,U,2)) W !!,"Copayment rates for LTC are not available at this time.",!! Q
"RTN","EASECPC",17,0)
 D QUEUE
"RTN","EASECPC",18,0)
 Q
"RTN","EASECPC",19,0)
GETDFN() ; Get the veteran's DFN
"RTN","EASECPC",20,0)
 N DIC,DTOUT,DUOUT,X,Y
"RTN","EASECPC",21,0)
 W !
"RTN","EASECPC",22,0)
 S DIC="^DPT(",DIC(0)="AEMZQ",DIC("S")="I $D(^DGMT(408.31,""AID"",3,+Y))"
"RTN","EASECPC",23,0)
 D ^DIC
"RTN","EASECPC",24,0)
 Q:$D(DTOUT)!($D(DUOUT)) 1
"RTN","EASECPC",25,0)
 Q:Y<0 1
"RTN","EASECPC",26,0)
 S DFN=+Y
"RTN","EASECPC",27,0)
 Q 0
"RTN","EASECPC",28,0)
GETSDATE() ; Get the Start Date
"RTN","EASECPC",29,0)
 N LST,DIC,DTOUT,DUOUT,X,Y
"RTN","EASECPC",30,0)
 W !
"RTN","EASECPC",31,0)
 S LST=$$LST^EASECU(DFN,"",3)
"RTN","EASECPC",32,0)
 S DIC("A")="Select DATE OF TEST: "
"RTN","EASECPC",33,0)
 I $D(^DGMT(408.31,+LST,0)) S DIC("B")=$P(^DGMT(408.31,+LST,0),"^")
"RTN","EASECPC",34,0)
 S DIC("S")="I $P(^(0),U,2)=DFN,$P(^(0),U,19)=3"
"RTN","EASECPC",35,0)
 S DIC="^DGMT(408.31,",DIC(0)="EQZ"
"RTN","EASECPC",36,0)
 D EN^DGMTLK
"RTN","EASECPC",37,0)
 Q:$D(DTOUT)!($D(DUOUT)) 1
"RTN","EASECPC",38,0)
 Q:Y<0 1
"RTN","EASECPC",39,0)
 S DGMTI=+Y,DGMTDT=$P(Y,U,2)
"RTN","EASECPC",40,0)
 S DGSTA=$$MTS^EASECU($P(^DGMT(408.31,DGMTI,0),U,3))
"RTN","EASECPC",41,0)
 S DGSTA=$P(DGSTA,"^")
"RTN","EASECPC",42,0)
 Q 0
"RTN","EASECPC",43,0)
EXEMPT() ; Check for Test Status
"RTN","EASECPC",44,0)
 N LTCTS,ESTAT
"RTN","EASECPC",45,0)
 S LTCTS=$P($G(^DGMT(408.31,DGMTI,0)),U,3)
"RTN","EASECPC",46,0)
 I LTCTS="" D  Q 1
"RTN","EASECPC",47,0)
 .W !!,"This LTC Copayment Test has not yet been completed for this veteran!"
"RTN","EASECPC",48,0)
 S ESTAT=$P($G(^DG(408.32,LTCTS,0)),U)
"RTN","EASECPC",49,0)
 I ESTAT="EXEMPT" D  Q 1
"RTN","EASECPC",50,0)
 .W !!,"This veteran is ",ESTAT," from LTC Copayments!"
"RTN","EASECPC",51,0)
 I ESTAT'="NON-EXEMPT" D  Q 1
"RTN","EASECPC",52,0)
 .W !!,"This LTC Copay Test record contains an invalid test status!"
"RTN","EASECPC",53,0)
 .W !,"DFN: ",DGMTI,!,"Test Status: ",LTCTS
"RTN","EASECPC",54,0)
 Q 0
"RTN","EASECPC",55,0)
MARIT() ; Define Marital Status
"RTN","EASECPC",56,0)
 N DGPRI,DGVIRI,SRIC
"RTN","EASECPC",57,0)
 S DGPRI=$O(^DGPR(408.12,"C",DFN_";DPT(",0))
"RTN","EASECPC",58,0)
 D GETIENS^EASECU2(DFN,DGPRI,DGMTDT)
"RTN","EASECPC",59,0)
 S DGVIRI=DGIRI
"RTN","EASECPC",60,0)
 D DEP^EASECSU3
"RTN","EASECPC",61,0)
 S SRIC=$P(DGVIR0,U,16)
"RTN","EASECPC",62,0)
 Q DGSP_"^"_SRIC
"RTN","EASECPC",63,0)
QUEUE ; Get report device. Queue report if requested.
"RTN","EASECPC",64,0)
 N MSG
"RTN","EASECPC",65,0)
 S MSG(1)=""
"RTN","EASECPC",66,0)
 S MSG(2)="This report may take a long time to generate.  It is recommended that the report"
"RTN","EASECPC",67,0)
 S MSG(3)="be queued to print."
"RTN","EASECPC",68,0)
 S MSG(4)=""
"RTN","EASECPC",69,0)
 D BMES^XPDUTL(.MSG)
"RTN","EASECPC",70,0)
 K IOP,%ZIS
"RTN","EASECPC",71,0)
 S %ZIS="MQ"
"RTN","EASECPC",72,0)
 D ^%ZIS I POP W !!,"Report Cancelled!" Q
"RTN","EASECPC",73,0)
 I $D(IO("Q")) D  Q
"RTN","EASECPC",74,0)
 .S ZTRTN="START^EASECPC"
"RTN","EASECPC",75,0)
 .S ZTDESC="LTC Copay Calculation Report"
"RTN","EASECPC",76,0)
 .S (ZTSAVE("DFN"),ZTSAVE("DGMTI"),ZTSAVE("DGMTDT"),ZTSAVE("DGSTA"))=""
"RTN","EASECPC",77,0)
 .S (ZTSAVE("MODE"),ZTSAVE("PAGE"),ZTSAVE("MARIT"),ZTSAVE("MAXRT"))=""
"RTN","EASECPC",78,0)
 .D ^%ZTLOAD
"RTN","EASECPC",79,0)
 .W !!,"Report "_$S($D(ZTSK):"Queued!",1:"Cancelled!")
"RTN","EASECPC",80,0)
 .D HOME^%ZIS
"RTN","EASECPC",81,0)
 D START,^%ZISC
"RTN","EASECPC",82,0)
 Q
"RTN","EASECPC",83,0)
INITHDR ; Initialize the Report Header
"RTN","EASECPC",84,0)
 N %,%H,%I,X,CDATE
"RTN","EASECPC",85,0)
 D NOW^%DTC
"RTN","EASECPC",86,0)
 S CDATE=X
"RTN","EASECPC",87,0)
 S HDR(1)=$$FMTE^XLFDT(CDATE)
"RTN","EASECPC",88,0)
 S HDR(2)=""
"RTN","EASECPC",89,0)
 I MODE S HDR(3)="        LONG TERM CARE ESTIMATED COPAYMENTS FOR INSTITUTIONAL SERVICES"
"RTN","EASECPC",90,0)
 I 'MODE S HDR(3)="      LONG TERM CARE ESTIMATED COPAYMENTS FOR NON-INSTITUTIONAL SERVICES"
"RTN","EASECPC",91,0)
 S HDR(4)=""
"RTN","EASECPC",92,0)
 S HDR(5)=""
"RTN","EASECPC",93,0)
 Q
"RTN","EASECPC",94,0)
HEADER ; Print the header
"RTN","EASECPC",95,0)
 N LTCIDX,PGHDR
"RTN","EASECPC",96,0)
 S PAGE=$G(PAGE,0),PAGE=PAGE+1,PGHDR="Page: "_$J(PAGE,3)
"RTN","EASECPC",97,0)
 W #
"RTN","EASECPC",98,0)
 S LTCIDX="",LTCIDX=$O(HDR(LTCIDX))
"RTN","EASECPC",99,0)
 W HDR(LTCIDX),?71,PGHDR
"RTN","EASECPC",100,0)
 F  S LTCIDX=$O(HDR(LTCIDX)) Q:LTCIDX=""  D
"RTN","EASECPC",101,0)
 .W !,HDR(LTCIDX)
"RTN","EASECPC",102,0)
 Q
"RTN","EASECPC",103,0)
START ; Generate Report
"RTN","EASECPC",104,0)
 N CRT,HDR
"RTN","EASECPC",105,0)
 S CRT=$S($E(IOST,1,2)="C-":1,1:0)
"RTN","EASECPC",106,0)
 S MODE=1 U IO W ! D PRINT W !     ; Institutional
"RTN","EASECPC",107,0)
 I CRT Q:$$PAUSE(0)
"RTN","EASECPC",108,0)
 D:'CRT NOTETXT
"RTN","EASECPC",109,0)
 S MODE=0 U IO W ! D PRINT W !     ; Non-institutional
"RTN","EASECPC",110,0)
 I CRT Q:$$PAUSE(0)
"RTN","EASECPC",111,0)
 D:'CRT NOTETXT
"RTN","EASECPC",112,0)
 I CRT D  Q:$$PAUSE(0)
"RTN","EASECPC",113,0)
 .K HDR(3),HDR(4),HDR(5)
"RTN","EASECPC",114,0)
 .D HEADER,NOTETXT
"RTN","EASECPC",115,0)
 D EN^EASECPC1
"RTN","EASECPC",116,0)
 U 0
"RTN","EASECPC",117,0)
 I $G(ZTSK) S ZTREQ="@"
"RTN","EASECPC",118,0)
 Q
"RTN","EASECPC",119,0)
PRINT ; Print the Report
"RTN","EASECPC",120,0)
 N PAT0,NAME,SSN,DOB,ARRY,HDTEXT,IDX,SIDX,EIDX,MNTH,CPYFLG,DECINF,AGRPAY
"RTN","EASECPC",121,0)
 D INITHDR
"RTN","EASECPC",122,0)
 S PAT0=$G(^DPT(DFN,0)),NAME=$P(PAT0,"^"),SSN=$P(PAT0,"^",9),DOB=$P(PAT0,"^",3)
"RTN","EASECPC",123,0)
 ;
"RTN","EASECPC",124,0)
 D BLDTBL(DGMTDT,.ARRY)
"RTN","EASECPC",125,0)
 D DETFIG(.ARRY)
"RTN","EASECPC",126,0)
 S HDTEXT="TOTAL INCOME - TOTAL EXPENSES - TOTAL ALLOWANCE"
"RTN","EASECPC",127,0)
 D HEADER
"RTN","EASECPC",128,0)
 W NAME,?35,SSN,?62,"DOB: ",$$FMTE^XLFDT(DOB)
"RTN","EASECPC",129,0)
 W !,$S(+MARIT:"MARRIED",1:"SINGLE")
"RTN","EASECPC",130,0)
 I +MARIT,$P(MARIT,"^",2) W ?15,"SPOUSE RESIDING IN THE COMMUNITY"
"RTN","EASECPC",131,0)
 I DECINF,AGRPAY W !,"*** DECLINED TO PROVIDE INCOME INFORMATION -- AGREED TO PAY COPAYMENTS ***"
"RTN","EASECPC",132,0)
 I AGRPAY=0 W !,"*** VETERAN IS INELIGIBLE FOR LTC SERVICES -- REFUSED TO SIGN 10-10EC ***"
"RTN","EASECPC",133,0)
 W !,"LTC COPAY REPORT START DATE: ",$$FMTE^XLFDT(DGMTDT)
"RTN","EASECPC",134,0)
 W !!!,"LTC COPAYMENTS FOR DAYS 1-180",!,"COPAY CALC: ",HDTEXT
"RTN","EASECPC",135,0)
 S SIDX=1,EIDX=6
"RTN","EASECPC",136,0)
 W ! D PRINTROW("TOT INCOME    ",SIDX,EIDX,3)
"RTN","EASECPC",137,0)
 D PRINTROW("TOT EXPENSES  ",SIDX,EIDX,4)
"RTN","EASECPC",138,0)
 D PRINTROW("TOT ALLOWANCE ",SIDX,EIDX,5)
"RTN","EASECPC",139,0)
 W ! D PRINTROW("CALC COPAY    ",SIDX,EIDX,6)
"RTN","EASECPC",140,0)
 D PRINTROW("MAX COPAY     ",SIDX,EIDX,7)
"RTN","EASECPC",141,0)
 D PRINTROW("VET MAX COPAY ",SIDX,EIDX,8)
"RTN","EASECPC",142,0)
 W !,"              "
"RTN","EASECPC",143,0)
 F MNTH=1:1:6 W $J($P(ARRY(MNTH),"^"),11)
"RTN","EASECPC",144,0)
 ;
"RTN","EASECPC",145,0)
 I MODE,'+MARIT S HDTEXT="(TOTAL ASSETS + TOTAL INCOME) - TOTAL ALLOWANCE"
"RTN","EASECPC",146,0)
 I MODE,+MARIT S HDTEXT="(TOTAL ASSETS + TOTAL INCOME) - TOTAL EXPENSES - TOTAL ALLOWANCE"
"RTN","EASECPC",147,0)
 W !!,"LTC COPAYMENTS FOR DAYS 181+"
"RTN","EASECPC",148,0)
 W !,"COPAY CALC: ",HDTEXT,!
"RTN","EASECPC",149,0)
 S SIDX=7,EIDX=12
"RTN","EASECPC",150,0)
 I MODE D PRINTROW("TOT ASSETS    ",SIDX,EIDX,9)
"RTN","EASECPC",151,0)
 D PRINTROW("TOT INCOME    ",SIDX,EIDX,3)
"RTN","EASECPC",152,0)
 I 'MODE!MARIT D PRINTROW("TOT EXPENSES  ",SIDX,EIDX,4)
"RTN","EASECPC",153,0)
 D PRINTROW("TOT ALLOWANCE ",SIDX,EIDX,5)
"RTN","EASECPC",154,0)
 W ! D PRINTROW("CALC COPAY    ",SIDX,EIDX,6)
"RTN","EASECPC",155,0)
 D PRINTROW("MAX COPAY     ",SIDX,EIDX,7)
"RTN","EASECPC",156,0)
 D PRINTROW("VET MAX COPAY ",SIDX,EIDX,8)
"RTN","EASECPC",157,0)
 W !,"              "
"RTN","EASECPC",158,0)
 F MNTH=7:1:12 W $J($P(ARRY(MNTH),"^"),11)
"RTN","EASECPC",159,0)
 Q
"RTN","EASECPC",160,0)
PRINTROW(TEXT,SIDX,EIDX,NODE) ; Print the Rows
"RTN","EASECPC",161,0)
 N MNTH
"RTN","EASECPC",162,0)
 W !,TEXT
"RTN","EASECPC",163,0)
 F MNTH=SIDX:1:EIDX W $J($S($P(ARRY(MNTH),"^",NODE)[".":$P($P(ARRY(MNTH),"^",NODE),"."),1:$P(ARRY(MNTH),"^",NODE)),11)
"RTN","EASECPC",164,0)
 Q
"RTN","EASECPC",165,0)
PAUSE(RESP) ; Prompt user for next page or quit
"RTN","EASECPC",166,0)
 N DIR,DIRUT,DUOUT,DTOUT,U,X,Y
"RTN","EASECPC",167,0)
 S DIR(0)="E"
"RTN","EASECPC",168,0)
 D ^DIR
"RTN","EASECPC",169,0)
 I 'Y S RESP=1
"RTN","EASECPC",170,0)
 Q RESP
"RTN","EASECPC",171,0)
BLDTBL(DATE,ARRY) ; Build the Month/Year Table
"RTN","EASECPC",172,0)
 N IDX,FMNYR
"RTN","EASECPC",173,0)
 K ARRY
"RTN","EASECPC",174,0)
 S DATE=$$FMTHL7^XLFDT(DGMTDT)
"RTN","EASECPC",175,0)
 S FMNYR=$E(DATE,1,6)_"00"
"RTN","EASECPC",176,0)
 F IDX=1:1:12 D
"RTN","EASECPC",177,0)
 .S ARRY(IDX)=$$UP^XLFSTR($$FMTE^XLFDT($$HL7TFM^XLFDT(FMNYR)))
"RTN","EASECPC",178,0)
 .S ARRY(IDX)=$P(ARRY(IDX)," ")_"'"_$E($P(ARRY(IDX)," ",2),3,4)
"RTN","EASECPC",179,0)
 .S $P(ARRY(IDX),"^",2)=$E(FMNYR,5,6)
"RTN","EASECPC",180,0)
 .S FMNYR=$E(FMNYR,1,4)_$E(FMNYR,5,6)+1_"00"
"RTN","EASECPC",181,0)
 .S:$E(FMNYR,5,6)=13 FMNYR=$E(FMNYR,1,4)+1_"0100"
"RTN","EASECPC",182,0)
 Q
"RTN","EASECPC",183,0)
DETFIG(ARRY) ; Determine Figures
"RTN","EASECPC",184,0)
 ; Variables:  Marit:     0 = Single         1 = Married
"RTN","EASECPC",185,0)
 ;             Mode:      0 = Out-Patient    1 = In-Patient
"RTN","EASECPC",186,0)
 ;             FLAG180:   0 = 180 or Less    1 = 181+
"RTN","EASECPC",187,0)
 ;             SRIC:      0 = Not in Com.    1 = Reside in Com.
"RTN","EASECPC",188,0)
 ;             LWP:       0 = Not live w/    1 = Living w/ Pat.
"RTN","EASECPC",189,0)
 ;
"RTN","EASECPC",190,0)
 N DGDC,DGDEP,DGERR,DGFL,DGIN0,DGIN1,DGIN2,DGDET,DGINT,DGNWT
"RTN","EASECPC",191,0)
 N DGMTSC,DGNC,DGND,DGNWTF,DGSP,DGVINI,DGVIR0,DGVIRI,DGVPRI
"RTN","EASECPC",192,0)
 N IDX,INC,FLAG180,FXAST,LQAST,EXP,TAST,TINC,TEXP
"RTN","EASECPC",193,0)
 N ALLOW,CALCCPY,DAYS,LWP,MAXCPY,SRIC,VETMAX,IPDR,OPDR
"RTN","EASECPC",194,0)
 ;
"RTN","EASECPC",195,0)
 D SETUP^EASECSCU,DEP^EASECSU3,INC^EASECSU3
"RTN","EASECPC",196,0)
 S CPYFLG=0
"RTN","EASECPC",197,0)
 S DECINF=$P($G(^DGMT(408.31,DGMTI,0)),"^",14)
"RTN","EASECPC",198,0)
 S AGRPAY=$P($G(^DGMT(408.31,DGMTI,0)),"^",11)
"RTN","EASECPC",199,0)
 I DECINF=1!(AGRPAY=0) S CPYFLG=1
"RTN","EASECPC",200,0)
 S SRIC=$P(MARIT,U,2)
"RTN","EASECPC",201,0)
 S LWP=+$P(DGVIR0,U,15)
"RTN","EASECPC",202,0)
 S INC=DGINT,EXP=DGDET
"RTN","EASECPC",203,0)
 S OPDR=$P(MAXRT,U),IPDR=$P(MAXRT,U,2)
"RTN","EASECPC",204,0)
 ;
"RTN","EASECPC",205,0)
 F FLAG180=0,1 D
"RTN","EASECPC",206,0)
 .I 'MODE S TAST=0
"RTN","EASECPC",207,0)
 .I MODE D
"RTN","EASECPC",208,0)
 ..S TAST=$S(FLAG180:DGNWT,1:0)
"RTN","EASECPC",209,0)
 ..I 'MARIT,FLAG180 S EXP=0
"RTN","EASECPC",210,0)
 .S TINC=INC/12,TEXP=EXP/12
"RTN","EASECPC",211,0)
 .;
"RTN","EASECPC",212,0)
 .; Build both tables: 1-180 days and 181+ days
"RTN","EASECPC",213,0)
 .F IDX=$S(FLAG180:7,1:1):1:$S(FLAG180:12,1:6) D
"RTN","EASECPC",214,0)
 ..S DAYS=$$DOM($P(ARRY(IDX),"^",2))
"RTN","EASECPC",215,0)
 ..S ALLOW=20*DAYS*(1+SRIC) S:CPYFLG ALLOW=0
"RTN","EASECPC",216,0)
 ..S CALCCPY=$$CALCCPY
"RTN","EASECPC",217,0)
 ..S MAXCPY=$$CALCMAX(DAYS)
"RTN","EASECPC",218,0)
 ..S VETMAX=$$VETMAX(CALCCPY,MAXCPY)
"RTN","EASECPC",219,0)
 ..S $P(ARRY(IDX),"^",3)=TINC
"RTN","EASECPC",220,0)
 ..S $P(ARRY(IDX),"^",4)=TEXP
"RTN","EASECPC",221,0)
 ..S $P(ARRY(IDX),"^",5)=ALLOW
"RTN","EASECPC",222,0)
 ..S $P(ARRY(IDX),"^",6)=CALCCPY
"RTN","EASECPC",223,0)
 ..S $P(ARRY(IDX),"^",7)=MAXCPY
"RTN","EASECPC",224,0)
 ..S $P(ARRY(IDX),"^",8)=VETMAX
"RTN","EASECPC",225,0)
 ..S:FLAG180 $P(ARRY(IDX),"^",9)=TAST
"RTN","EASECPC",226,0)
 ..I FLAG180,MODE S TAST=$$ASTSPD
"RTN","EASECPC",227,0)
 Q
"RTN","EASECPC",228,0)
 ;
"RTN","EASECPC",229,0)
ASTSPD() ;Asset Spend down for 180+ days
"RTN","EASECPC",230,0)
 Q:CPYFLG TAST
"RTN","EASECPC",231,0)
 I (TINC-TEXP-ALLOW)'>VETMAX D
"RTN","EASECPC",232,0)
 . I MARIT S TAST=TAST-(VETMAX-(TINC-TEXP-ALLOW))
"RTN","EASECPC",233,0)
 . I 'MARIT S TAST=TAST-(VETMAX-(TINC-ALLOW))
"RTN","EASECPC",234,0)
 . S:TAST<0 TAST=0
"RTN","EASECPC",235,0)
 Q TAST
"RTN","EASECPC",236,0)
 ;
"RTN","EASECPC",237,0)
CALCCPY() ; Calculate the Co-Pay Amount
"RTN","EASECPC",238,0)
 ;
"RTN","EASECPC",239,0)
 Q:CPYFLG 0
"RTN","EASECPC",240,0)
 Q TAST+TINC-ALLOW-TEXP
"RTN","EASECPC",241,0)
DOM(MNTH) ; Days in Month
"RTN","EASECPC",242,0)
 ; Returns: number of days in a month
"RTN","EASECPC",243,0)
 N DAYS,HL7DATE
"RTN","EASECPC",244,0)
 I "04060911"[MNTH S DAYS=30 Q DAYS
"RTN","EASECPC",245,0)
 I MNTH="02" D  Q DAYS
"RTN","EASECPC",246,0)
 .S DAYS=28
"RTN","EASECPC",247,0)
 .S HL7DATE=$$FMTHL7^XLFDT(DGMTDT)
"RTN","EASECPC",248,0)
 .S:$E(HL7DATE,1,4)#4=0 DAYS=29
"RTN","EASECPC",249,0)
 S DAYS=31
"RTN","EASECPC",250,0)
 Q DAYS
"RTN","EASECPC",251,0)
CALCMAX(DAYS) ; Calculate the Maximum Co-Pay Amount
"RTN","EASECPC",252,0)
 ;
"RTN","EASECPC",253,0)
 Q $S(MODE:IPDR,1:OPDR)*DAYS
"RTN","EASECPC",254,0)
VETMAX(CALCCPY,MAXCPY) ; Calculate the Veteran Maximum Co-Pay Amount
"RTN","EASECPC",255,0)
 ;
"RTN","EASECPC",256,0)
 Q:CPYFLG MAXCPY
"RTN","EASECPC",257,0)
 Q:CALCCPY<0 0
"RTN","EASECPC",258,0)
 Q:CALCCPY<MAXCPY CALCCPY
"RTN","EASECPC",259,0)
 Q MAXCPY
"RTN","EASECPC",260,0)
NOTETXT ; Write the Note message
"RTN","EASECPC",261,0)
 W !!,"IMPORTANT NOTICE: The copayment amounts shown in this report are"
"RTN","EASECPC",262,0)
 W " estimates",!,"based on calculations of the copayment amount for "
"RTN","EASECPC",263,0)
 W "an entire month. The",!,"copayment amounts will be adjusted to "
"RTN","EASECPC",264,0)
 W "reflect the actual start date of LTC",!,"services and the "
"RTN","EASECPC",265,0)
 W "copayment exemption for the first 21 days of service. The VET",!
"RTN","EASECPC",266,0)
 W "MAX COPAY amount is based on the assumption that the veteran "
"RTN","EASECPC",267,0)
 W "will be",!,"responsible to pay the lesser of EITHER the calculated"
"RTN","EASECPC",268,0)
 W " copayment (CALC COPAY) OR",!,"the maximum copayment (MAX COPAY).  "
"RTN","EASECPC",269,0)
 W "In the event that the calculated copayment",!,"(CALC COPAY) is a "
"RTN","EASECPC",270,0)
 W "negative figure, the veteran maximum copayment (VET MAX COPAY)",!
"RTN","EASECPC",271,0)
 W "will be adjusted to zero (0). If the veteran declined to provide"
"RTN","EASECPC",272,0)
 W " income",!,"information, the veteran will be obligated to pay the"
"RTN","EASECPC",273,0)
 W " maximum copayment."
"RTN","EASECPC",274,0)
 Q
"RTN","EASECSC6")
0^1^B8990995
"RTN","EASECSC6",1,0)
EASECSC6 ;ALB/PHH,LBD - LTC Co-Pay Test Screen Deductible Expense ;13 AUG 2001
"RTN","EASECSC6",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,34**;Mar 15, 2001
"RTN","EASECSC6",3,0)
 ;
"RTN","EASECSC6",4,0)
 ; Input  -- DFN      Patient IEN
"RTN","EASECSC6",5,0)
 ;           DGMTDT   Date of Test
"RTN","EASECSC6",6,0)
 ;           DGVINI   Veteran Individual Annual Income IEN
"RTN","EASECSC6",7,0)
 ;           DGVIRI   Veteran Income Relation IEN
"RTN","EASECSC6",8,0)
 ;           DGVPRI   Veteran Patient Relation IEN
"RTN","EASECSC6",9,0)
 ;           DGMTI    LTC Co-Pay Test IEN
"RTN","EASECSC6",10,0)
 ; Output -- None
"RTN","EASECSC6",11,0)
 ;
"RTN","EASECSC6",12,0)
EN ;Entry point for expense screen
"RTN","EASECSC6",13,0)
 S DGMTSCI=6 D HD^EASECSCU
"RTN","EASECSC6",14,0)
 D DIS
"RTN","EASECSC6",15,0)
 S DGRNG="1-10" G EN^EASECSCR
"RTN","EASECSC6",16,0)
 ;
"RTN","EASECSC6",17,0)
EN1 ;Entry point for read processor return
"RTN","EASECSC6",18,0)
 D ALL^EASECU21(DFN,"CS",DGMTDT,"IPR",$S($G(DGMTI):DGMTI,1:""))
"RTN","EASECSC6",19,0)
 I DGX!($G(DGSELTY)["V") S DGPRI=DGVPRI,DGPRTY="V" D EDT
"RTN","EASECSC6",20,0)
Q K DGCNT,DGDEP,DGDR,DGMTOUT,DGPRI,DGPRTY,DGREL,DGSEL,DGSELTY,DGX,DGY,DTOUT,DUOUT,Y
"RTN","EASECSC6",21,0)
 G EN
"RTN","EASECSC6",22,0)
 ;
"RTN","EASECSC6",23,0)
DIS ;Display deductible expenses
"RTN","EASECSC6",24,0)
 N DGDC,DGDET,DGIN0,DGIN1,DGIN2,DGINT,DGINTF,DGNC,DGND,DGNWT,DGNWTF,DGSP,DGVIR0,DGCNT
"RTN","EASECSC6",25,0)
 D DEP^EASECSU3,INC^EASECSU3 S DGCNT=1
"RTN","EASECSC6",26,0)
 W !!?39,"Veteran" W:DGSP " and Spouse" W ?73,"Total"
"RTN","EASECSC6",27,0)
 W !?36,"------------------------------------------"
"RTN","EASECSC6",28,0)
 D HIGH^DGMTSCU1(1,DGMTACT),FLD(.DGIN1,3,"Education")
"RTN","EASECSC6",29,0)
 D HIGH^DGMTSCU1(2,DGMTACT),FLD(.DGIN1,2,"Funeral and Burial")
"RTN","EASECSC6",30,0)
 D HIGH^DGMTSCU1(3,DGMTACT),FLD(.DGIN1,4,"Rent/Mortgage")
"RTN","EASECSC6",31,0)
 D HIGH^DGMTSCU1(4,DGMTACT),FLD(.DGIN1,5,"Utilities")
"RTN","EASECSC6",32,0)
 D HIGH^DGMTSCU1(5,DGMTACT),FLD(.DGIN1,6,"Car Payment Only")
"RTN","EASECSC6",33,0)
 D HIGH^DGMTSCU1(6,DGMTACT),FLD(.DGIN1,7,"Food")
"RTN","EASECSC6",34,0)
 D HIGH^DGMTSCU1(7,DGMTACT),FLD(.DGIN1,1,"Non-reimbursed Medical Expenses")
"RTN","EASECSC6",35,0)
 D HIGH^DGMTSCU1(8,DGMTACT),FLD(.DGIN1,8,"Court-ordered Payments")
"RTN","EASECSC6",36,0)
 D HIGH^DGMTSCU1(9,DGMTACT),FLD(.DGIN1,9,"Insurance")
"RTN","EASECSC6",37,0)
 D HIGH^DGMTSCU1(10,DGMTACT),FLD(.DGIN1,10,"Taxes")
"RTN","EASECSC6",38,0)
 W !?56,"Total -->",?66,$J($$AMT^DGMTSCU1(DGDET),12)
"RTN","EASECSC6",39,0)
 Q
"RTN","EASECSC6",40,0)
 ;
"RTN","EASECSC6",41,0)
FLD(DGIN,DGPCE,DGTXT) ;Display income fields
"RTN","EASECSC6",42,0)
 ;
"RTN","EASECSC6",43,0)
 ;    Input -- DGIN as Individual Annual Income 0 node for vet,
"RTN","EASECSC6",44,0)
 ;                  spouse, and dependents
"RTN","EASECSC6",45,0)
 ;             DGPCE as piece position wanted
"RTN","EASECSC6",46,0)
 ;             DGTXT as income description
"RTN","EASECSC6",47,0)
 ;
"RTN","EASECSC6",48,0)
 ;             Also keeps running total if DGGTOT is defined (grand
"RTN","EASECSC6",49,0)
 ;                  total)
"RTN","EASECSC6",50,0)
 ;
"RTN","EASECSC6",51,0)
 N DGTOT,I,AMT
"RTN","EASECSC6",52,0)
 I '$D(DGBL) S $P(DGBL," ",26)=""
"RTN","EASECSC6",53,0)
 W:DGCNT<10 " "
"RTN","EASECSC6",54,0)
 W " ",$E(DGTXT_DGBL,1,26)
"RTN","EASECSC6",55,0)
 S AMT=$$AMT^DGMTSCU1($P(DGIN("V"),U,DGPCE))
"RTN","EASECSC6",56,0)
 W $J(AMT,15)
"RTN","EASECSC6",57,0)
 W "                  "
"RTN","EASECSC6",58,0)
 S DGTOT="",I="" F  S I=$O(DGIN(I)) Q:I=""  I $P(DGIN(I),"^",DGPCE)]"" S DGTOT=DGTOT+$P(DGIN(I),"^",DGPCE)
"RTN","EASECSC6",59,0)
 W "  ",$J($$AMT^DGMTSCU1(DGTOT),12)
"RTN","EASECSC6",60,0)
 S DGCNT=DGCNT+1
"RTN","EASECSC6",61,0)
 Q
"RTN","EASECSC6",62,0)
 ;
"RTN","EASECSC6",63,0)
EDT ;Edit income fields
"RTN","EASECSC6",64,0)
 N DA,DGERR,DGFIN,DGINI,DGIN0,DGIRI,DGVIR0,DIE,DR
"RTN","EASECSC6",65,0)
 D GETIENS^EASECU2(DFN,DGPRI,DGMTDT) G EDTQ:DGERR
"RTN","EASECSC6",66,0)
 I $G(DGSEL)]"" W !!,"NAME: ",$$NAME^DGMTU1(DGPRI)
"RTN","EASECSC6",67,0)
 S DGVIR0=$G(^DGMT(408.22,DGVIRI,0))
"RTN","EASECSC6",68,0)
 S DGIN1=$G(^DGMT(408.21,DGINI,1))
"RTN","EASECSC6",69,0)
 S DA=DGINI,DIE="^DGMT(408.21,",DR="[EASEC ENTER/EDIT EXPENSES]" D ^DIE S:'$D(DGFIN) DGMTOUT=1
"RTN","EASECSC6",70,0)
 I DGIN1'=$G(^DGMT(408.21,DGINI,1)) D
"RTN","EASECSC6",71,0)
 .S DR="103////^S X=DUZ;104///^S X=""NOW"""
"RTN","EASECSC6",72,0)
 .I '$G(^DGMT(408.21,DGINI,"MT")) S DR=DR_";31////^S X=$G(DGMTI)"
"RTN","EASECSC6",73,0)
 .D ^DIE
"RTN","EASECSC6",74,0)
EDTQ Q
"RTN","EASECSCC")
0^2^B33823822
"RTN","EASECSCC",1,0)
EASECSCC ;ALB/LBD - LTC Co-Pay Test Screen Completion;13 AUG 2001 ; 3/20/03 2:24pm
"RTN","EASECSCC",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,34**;Mar 15, 2001
"RTN","EASECSCC",3,0)
 ;
"RTN","EASECSCC",4,0)
 ;NOTE: This routine was modified from DGMTSCC for LTC Co-pay
"RTN","EASECSCC",5,0)
 ; Input  -- DFN      Patient IEN
"RTN","EASECSCC",6,0)
 ;           DGMTACT  Menu Action
"RTN","EASECSCC",7,0)
 ;           DGMTDT   Date of Test
"RTN","EASECSCC",8,0)
 ;           DGMTYPT  Type of Test 3=LTC COPAY
"RTN","EASECSCC",9,0)
 ;           DGMTPAR  Annual Means Test Parameters
"RTN","EASECSCC",10,0)
 ;           DGMTI    Annual Means Test IEN
"RTN","EASECSCC",11,0)
 ;           DGVINI   Veteran Individual Annual Income IEN
"RTN","EASECSCC",12,0)
 ;           DGVIRI   Veteran Income Relation IEN
"RTN","EASECSCC",13,0)
 ;           DGVPRI   Veteran Patient Relation IEN
"RTN","EASECSCC",14,0)
 ; Output -- DGERR    1=INCOMPLETE and 0=COMPLETE
"RTN","EASECSCC",15,0)
 ;
"RTN","EASECSCC",16,0)
EN N DGCAT,DGCOMF,DGDC,DGDET,DGIN0,DGIN1,DGIN2,DGINT,DGINTF,DGMTS,DGNC,DGND,DGNWT,DGNWTF,DGREF1,DGSP,DGTYC,DGTHA,DGTHB,DGVIR0,DGCOPS,DGCOST,DGRE,DGSTA,DGAGR
"RTN","EASECSCC",17,0)
 S DGERR=0
"RTN","EASECSCC",18,0)
 S DGCOMF=1 D DEP^EASECSU3,INC^EASECSU3
"RTN","EASECSCC",19,0)
 ; If veteran's income is below the threshold then exempt from LTC copay
"RTN","EASECSCC",20,0)
 ;   LTC III (EAS*1*34)  modified to make vet with $0 income exempt 
"RTN","EASECSCC",21,0)
 I DGINT'>+$$THRES^IBARXEU1(DGMTDT,1,0) D  G Q
"RTN","EASECSCC",22,0)
 .D EXMPT(DFN,DGMTI,12)
"RTN","EASECSCC",23,0)
 .D PRT
"RTN","EASECSCC",24,0)
 ; Check if test can be completed
"RTN","EASECSCC",25,0)
 D CHK I DGERR W !?3,*7,"LTC copay test cannot be completed." G Q
"RTN","EASECSCC",26,0)
 ; Did vet refuse to give income info
"RTN","EASECSCC",27,0)
 I 'DGINTF,'DGNWTF S DGREF1="" D  G Q:$D(DTOUT)!($D(DUOUT))
"RTN","EASECSCC",28,0)
 .D REF
"RTN","EASECSCC",29,0)
 .I $D(DGREF) S DGSTA="NON-EXEMPT"
"RTN","EASECSCC",30,0)
 ; Get test status (Exempt or Non-Exempt)
"RTN","EASECSCC",31,0)
 D STA G Q:$D(DTOUT)!($D(DUOUT))
"RTN","EASECSCC",32,0)
 ; Does vet agree to pay co-payments
"RTN","EASECSCC",33,0)
 I $G(DGSTA)="NON-EXEMPT" D AGREE G Q:$D(DTOUT)!($D(DUOUT))
"RTN","EASECSCC",34,0)
UPD S DA=DGMTI,DIE="^DGMT(408.31,",DIE("NO^")="",DR="[EASEC COMPLETE LTC CO-PAY TEST]" D ^DIE K DA,DIE,DR I '$D(DGFIN) S DGERR=1 G Q
"RTN","EASECSCC",35,0)
 W !?3,"...The LTC copay test has been completed with a status of ",DGSTA,"..."
"RTN","EASECSCC",36,0)
 D PRT
"RTN","EASECSCC",37,0)
 ;
"RTN","EASECSCC",38,0)
Q K DGFIN,DGREF,DTOUT,DUOUT,Y
"RTN","EASECSCC",39,0)
 Q
"RTN","EASECSCC",40,0)
 ;
"RTN","EASECSCC",41,0)
COM ;Check if user wants to complete the LTC co-pay test
"RTN","EASECSCC",42,0)
 N DIR
"RTN","EASECSCC",43,0)
 S DIR("A")="Do you wish to complete the LTC copay test"
"RTN","EASECSCC",44,0)
 S DIR("B")="YES",DIR(0)="Y" D ^DIR
"RTN","EASECSCC",45,0)
 Q
"RTN","EASECSCC",46,0)
 ;
"RTN","EASECSCC",47,0)
REF ;Check if patient declines to provide income information
"RTN","EASECSCC",48,0)
 N DIR,Y
"RTN","EASECSCC",49,0)
 S DIR("A")="Does veteran decline to give income information"
"RTN","EASECSCC",50,0)
 I $P($G(^DGMT(408.31,DGMTI,0)),"^",14)]"" S DIR("B")=$$YN^DGMTSCU1($P(^(0),"^",14))
"RTN","EASECSCC",51,0)
 S:'$D(DIR("B")) DIR("B")="NO"
"RTN","EASECSCC",52,0)
 S DIR("?")="Answer 'Y' or 'N'."
"RTN","EASECSCC",53,0)
 S DIR("?",1)="Enter whether the veteran declines to provide current income information."
"RTN","EASECSCC",54,0)
 S DIR(0)="Y" D ^DIR K DIR G REFQ:$D(DTOUT)!($D(DUOUT))
"RTN","EASECSCC",55,0)
 S:Y DGREF=""
"RTN","EASECSCC",56,0)
REFQ Q
"RTN","EASECSCC",57,0)
 ;
"RTN","EASECSCC",58,0)
CHK ;Check if LTC copay test can be completed
"RTN","EASECSCC",59,0)
 ;   For LTC III (EAS*1*34) removed check if expenses greater than income
"RTN","EASECSCC",60,0)
 N DGA,DGD,DGDEP,DGREL,DGL,DGM,I
"RTN","EASECSCC",61,0)
 D GETREL^DGMTU11(DFN,"CS",$E(DGMTDT,1,3)_"0000",$S($G(DGMTI):DGMTI,1:""))
"RTN","EASECSCC",62,0)
 S DGM=$P(DGVIR0,"^",14),DGL=$P(DGVIR0,"^",15),DGD=$P(DGVIR0,"^",8)
"RTN","EASECSCC",63,0)
 I DGM']""!(DGM&(DGL']"")) W !?3,"Marital section must be completed." S DGERR=1
"RTN","EASECSCC",64,0)
 I DGM,'$D(DGREL("S")) W !?3,"Married is 'YES'.  An active spouse for this LTC copay test does not exist." S DGERR=1
"RTN","EASECSCC",65,0)
 I 'DGM,$D(DGREL("S")) W !?3,"An active spouse exists for this LTC copay test. Married should be 'YES'." S DGERR=1
"RTN","EASECSCC",66,0)
 I DGD']"" W !?3,"Dependent Children section must be completed." S DGERR=1
"RTN","EASECSCC",67,0)
 I DGD,'$D(DGREL("C")) W !?3,"Dependent Children is 'YES'.  No active children exist." S DGERR=1
"RTN","EASECSCC",68,0)
 I 'DGD,$D(DGREL("C")) W !?3,"Active children exist.  Dependent Children should be 'YES'." S DGERR=1
"RTN","EASECSCC",69,0)
 Q:$G(DGERR)
"RTN","EASECSCC",70,0)
 N CNT,ACT,DGDEP,FLAG,DGINCP
"RTN","EASECSCC",71,0)
 D INIT^EASECDEP S CNT=0 D
"RTN","EASECSCC",72,0)
 .F  S CNT=$O(DGDEP(CNT)) Q:'CNT  I $P(DGDEP(CNT),U,2)="SPOUSE" D  Q:$G(DGERR)
"RTN","EASECSCC",73,0)
 ..D GETIENS^EASECU2(DFN,$P(DGDEP(CNT),U,20),DGMTDT)
"RTN","EASECSCC",74,0)
 ..S DGINCP=$G(^DGMT(408.22,+DGIRI,"MT")) S:DGINCP FLAG=$G(FLAG)+1
"RTN","EASECSCC",75,0)
 ..I $G(FLAG)>1 W !?3,"Patient has more than one spouse for this LTC copay test." S DGERR=1
"RTN","EASECSCC",76,0)
 Q
"RTN","EASECSCC",77,0)
 ;
"RTN","EASECSCC",78,0)
STA ;Ask test status
"RTN","EASECSCC",79,0)
 N DIR,Y
"RTN","EASECSCC",80,0)
 S DGMTS=$P($G(^DGMT(408.31,DGMTI,0)),U,3)
"RTN","EASECSCC",81,0)
 S DGRE=$P($G(^DGMT(408.31,DGMTI,2)),U,7)
"RTN","EASECSCC",82,0)
 I DGMTS S DGSTA=$P($G(^DG(408.32,DGMTS,0)),U)
"RTN","EASECSCC",83,0)
 I '$D(DGSTA) S DGSTA="NON-EXEMPT"
"RTN","EASECSCC",84,0)
 I DGSTA="EXEMPT",("12"[DGRE),$G(DGINT)>+$$THRES^IBARXEU1(DGMTDT,1,0) S DGSTA="NON-EXEMPT"
"RTN","EASECSCC",85,0)
 S DIR("A")="LTC Copay Test Status" S DIR("B")=DGSTA
"RTN","EASECSCC",86,0)
 S DIR(0)="P^408.32:EM",DIR("S")="I $P(^(0),U,19)=3"
"RTN","EASECSCC",87,0)
 D ^DIR K DIR Q:'Y!($D(DTOUT))!($D(DUOUT))
"RTN","EASECSCC",88,0)
 S DGMTS=+Y,DGSTA=$P(Y,U,2) Q:DGSTA="NON-EXEMPT"
"RTN","EASECSCC",89,0)
 ;If Exempt, ask reason for exemption
"RTN","EASECSCC",90,0)
 S DIR("A")="REASON FOR EXEMPTION"
"RTN","EASECSCC",91,0)
 I DGRE S DIR("B")=$P($G(^EAS(714.1,DGRE,0)),U)
"RTN","EASECSCC",92,0)
 S DIR("S")="I $P(^(0),U,2)"
"RTN","EASECSCC",93,0)
 S DIR(0)="P^714.1:EM" D ^DIR K DIR I 'Y!($D(DTOUT))!($D(DUOUT)) D  G STA
"RTN","EASECSCC",94,0)
 .W !!,"A reason for exemption must be entered for an Exempt status.",!
"RTN","EASECSCC",95,0)
 S DGRE=+Y
"RTN","EASECSCC",96,0)
 Q
"RTN","EASECSCC",97,0)
AGREE ;Ask if vet agrees to pay co-payment
"RTN","EASECSCC",98,0)
 N DIR,Y
"RTN","EASECSCC",99,0)
 S DIR("A")="Does the veteran agree to pay copayments"
"RTN","EASECSCC",100,0)
 I $P($G(^DGMT(408.31,DGMTI,0)),U,11)]"" S DIR("B")=$$YN^DGMTSCU1($P(^(0),U,11))
"RTN","EASECSCC",101,0)
 S:'$D(DIR("B")) DIR("B")="YES"
"RTN","EASECSCC",102,0)
 S DIR("?")="Answer 'Y' or 'N'."
"RTN","EASECSCC",103,0)
 S DIR("?",1)="Enter in this field whether the veteran agrees to pay the"
"RTN","EASECSCC",104,0)
 S DIR("?",2)="LTC copayments.  The veteran must also sign the 1010-EC form"
"RTN","EASECSCC",105,0)
 S DIR("?",3)="agreeing to pay the copayments. If the veteran does not agree"
"RTN","EASECSCC",106,0)
 S DIR("?",4)="to pay the copayments, the veteran becomes ineligible to"
"RTN","EASECSCC",107,0)
 S DIR("?",5)="receive extended care services."
"RTN","EASECSCC",108,0)
 S DIR(0)="Y" D ^DIR K DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","EASECSCC",109,0)
 S DGAGR=Y
"RTN","EASECSCC",110,0)
 Q
"RTN","EASECSCC",111,0)
PRT ;Print Extended Care Services test (1010EC)
"RTN","EASECSCC",112,0)
 N DIR,Y,X,ZTSK
"RTN","EASECSCC",113,0)
 S DIR("A")="PRINT 10-10EC"
"RTN","EASECSCC",114,0)
 S DIR("B")="YES",DIR(0)="Y" D ^DIR G PRTQ:'Y!($D(DTOUT))!($D(DUOUT))
"RTN","EASECSCC",115,0)
 S ZTSK=$$QUE^EASEC10E(DFN,DGMTI)
"RTN","EASECSCC",116,0)
PRTQ Q
"RTN","EASECSCC",117,0)
 ;
"RTN","EASECSCC",118,0)
EXMPT(DFN,DGMTI,EX) ; Veteran is exempt from LTC co-payments
"RTN","EASECSCC",119,0)
 ; Complete LTC co-pay test in Annual Means Test file (#408.31)
"RTN","EASECSCC",120,0)
 ; Input -- DFN     Patient IEN
"RTN","EASECSCC",121,0)
 ;          DGMTI   Annual Means Test IEN
"RTN","EASECSCC",122,0)
 ;          EX      Copay exemption code
"RTN","EASECSCC",123,0)
 ;                  1 = SC compensable disability
"RTN","EASECSCC",124,0)
 ;                  2 = NSC, single, receiving VA pension (no A&A, HB)
"RTN","EASECSCC",125,0)
 ;                         or
"RTN","EASECSCC",126,0)
 ;                      Income (last year) is below single pension threshold
"RTN","EASECSCC",127,0)
 ;                 12 = Income (current year) is below single pension threshold 
"RTN","EASECSCC",128,0)
 Q:'DGMTI  Q:'EX
"RTN","EASECSCC",129,0)
 N DATA,I
"RTN","EASECSCC",130,0)
 W !! F I=1:1:80 W "="
"RTN","EASECSCC",131,0)
 W !!,?10,"Veteran is EXEMPT from Long Term Care copayments."
"RTN","EASECSCC",132,0)
 W !,?10,"Reason for Exemption: ",$P($G(^EAS(714.1,EX,0)),U)
"RTN","EASECSCC",133,0)
 W !! F I=1:1:80 W "="
"RTN","EASECSCC",134,0)
 W !!
"RTN","EASECSCC",135,0)
 S DATA(.03)=$O(^DG(408.32,"C","X","")),DATA(2.07)=EX,DATA(.06)=DUZ
"RTN","EASECSCC",136,0)
 S (DATA(.07),DATA(2.02))=$$NOW^XLFDT
"RTN","EASECSCC",137,0)
 S DATA(.04)=$G(DGINT),DATA(.05)=$G(DGNWT),DATA(.15)=$G(DGDET)
"RTN","EASECSCC",138,0)
 S DATA(.18)=$G(DGND),DATA(2.08)=$P($$GETLTC4^EASECMT(DFN),U,1)
"RTN","EASECSCC",139,0)
 S DATA(.14)=$S($D(DGREF):1,1:0)     ;LTC III (EAS*1*34)
"RTN","EASECSCC",140,0)
 I $$UPD^DGENDBS(408.31,DGMTI,.DATA) Q
"RTN","EASECSCC",141,0)
 W !,"ERROR:  COULD NOT UPDATE LTC COPAY TEST",!!
"RTN","EASECSCC",142,0)
 Q
"RTN","EASECU")
0^5^B6834400
"RTN","EASECU",1,0)
EASECU ;ALB/PHH,LBD - LTC Co-Pay Test Utilities ; 22 AUG 2001
"RTN","EASECU",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,34**;Mar 15, 2001
"RTN","EASECU",3,0)
 ;
"RTN","EASECU",4,0)
LST(DFN,DGDT,DGMTYPT) ;Last LTC Co-Pay test for a patient
"RTN","EASECU",5,0)
 ;         Input  -- DFN   Patient IEN
"RTN","EASECU",6,0)
 ;                   DGDT  Date/Time  (Optional- default today@2359)
"RTN","EASECU",7,0)
 ;                DGMTYPT  Type of Test (Optional - if not defined 
"RTN","EASECU",8,0)
 ;                                       LTC Co-Pay will be assumed)
"RTN","EASECU",9,0)
 ;         Output -- LTC Co-Pay Test IEN^Date of Test
"RTN","EASECU",10,0)
 ;                   ^Status Name^Status Code^Source of Test
"RTN","EASECU",11,0)
 N DGIDT,DGMTFL1,DGMTI,DGNOD,Y I '$D(DGMTYPT) S DGMTYPT=3
"RTN","EASECU",12,0)
 S DGIDT=$S($G(DGDT)>0:-DGDT,1:-DT) S:'$P(DGIDT,".",2) DGIDT=DGIDT_.2359
"RTN","EASECU",13,0)
 F  S DGIDT=+$O(^DGMT(408.31,"AID",DGMTYPT,DFN,DGIDT)) Q:'DGIDT!$G(DGMTFL1)  D
"RTN","EASECU",14,0)
 .F DGMTI=0:0 S DGMTI=+$O(^DGMT(408.31,"AID",DGMTYPT,DFN,DGIDT,DGMTI)) Q:'DGMTI!$G(DGMTFL1)  D
"RTN","EASECU",15,0)
 ..S DGNOD=$G(^DGMT(408.31,DGMTI,0)) I DGNOD S DGMTFL1=1,Y=DGMTI_"^"_$P(^(0),"^")_"^"_$$MTS(+$P(^(0),"^",3))_"^"_$P(DGNOD,"^",23)
"RTN","EASECU",16,0)
 Q $G(Y)
"RTN","EASECU",17,0)
 ;
"RTN","EASECU",18,0)
MTS(DGMTS) ;LTC Co-Pay test status -- default current
"RTN","EASECU",19,0)
 ;         Input  -- DGMTS  LTC Co-Pay Test Status IEN
"RTN","EASECU",20,0)
 ;         Output -- Status Name^Status Code
"RTN","EASECU",21,0)
 N Y
"RTN","EASECU",22,0)
 I $G(DGMTS) S Y=$P($G(^DG(408.32,DGMTS,0)),"^",1,2)
"RTN","EASECU",23,0)
 Q $G(Y)
"RTN","EASECU",24,0)
 ;
"RTN","EASECU",25,0)
EXMPT(DFN) ;Check if veteran is exempt from LTC co-payments:
"RTN","EASECU",26,0)
 ; If the veteran has a compensable SC disability, OR
"RTN","EASECU",27,0)
 ; If the veteran is a single, NSC pensioner not in receipt of A&A
"RTN","EASECU",28,0)
 ; and HB benefits
"RTN","EASECU",29,0)
 ;   Input   -- DFN  Patient IEN
"RTN","EASECU",30,0)
 ;   Output  -- 0 = veteran not exempt
"RTN","EASECU",31,0)
 ;              1 = veteran has compensable SC disability
"RTN","EASECU",32,0)
 ;              2 = veteran is single NSC pensioner (no A&A, HB)
"RTN","EASECU",33,0)
 N X,Y,ELG
"RTN","EASECU",34,0)
 S Y=0
"RTN","EASECU",35,0)
 ; if service connected percentage is greater than 10% OR service
"RTN","EASECU",36,0)
 ; connected percentage is less than 10% and annual VA
"RTN","EASECU",37,0)
 ; check amount is greater than 0, then exempt type 1
"RTN","EASECU",38,0)
 S X=$G(^DPT(DFN,.36)),ELG=$P($G(^DIC(8,+X,0)),U,9)
"RTN","EASECU",39,0)
 I ELG=1!($P($G(^DPT(DFN,.3)),U,2)'<10) S Y=1 G EXMPTQ
"RTN","EASECU",40,0)
 I ELG=3,$P($G(^DPT(DFN,.3)),U,2)<10,$P($G(^DPT(DFN,.362)),U,20)>0 S Y=1 G EXMPTQ
"RTN","EASECU",41,0)
 ; if Service Connected quit
"RTN","EASECU",42,0)
 I $P($G(^DPT(DFN,.3)),U)="Y" G EXMPTQ
"RTN","EASECU",43,0)
 ; if Marital Status = 'Married' or 'Separated' quit
"RTN","EASECU",44,0)
 S X=$P($G(^DIC(11,+$P($G(^DPT(DFN,0)),U,5),0)),U,3)
"RTN","EASECU",45,0)
 I "^M^S^"[("^"_X_"^") G EXMPTQ
"RTN","EASECU",46,0)
 ; if not receiving VA pension quit
"RTN","EASECU",47,0)
 S X=$G(^DPT(DFN,.362)) I $P(X,U,14)'="Y" G EXMPTQ
"RTN","EASECU",48,0)
 ; if receiving A&A or HP benefits quit
"RTN","EASECU",49,0)
 I $P(X,U,12)="Y"!($P(X,U,13)="Y") G EXMPTQ
"RTN","EASECU",50,0)
 S Y=2
"RTN","EASECU",51,0)
EXMPTQ Q Y
"RTN","EASECU",52,0)
 ;
"RTN","EASECU",53,0)
DIS(DFN) ;Display patient's current LTC Copay Test status and test date
"RTN","EASECU",54,0)
 ; Input --  DFN   IEN of Patient file
"RTN","EASECU",55,0)
 ; Output -- None
"RTN","EASECU",56,0)
 N DGX,DGMTI,DGMTDT,DGMTS
"RTN","EASECU",57,0)
 Q:'$G(DFN)
"RTN","EASECU",58,0)
 S DGX=$$LST(DFN) Q:'DGX
"RTN","EASECU",59,0)
 S DGMTI=+DGX,DGMTDT=$P(DGX,U,2),DGMTS=$P(DGX,U,3) S:DGMTS="" DGMTS="UNKNOWN"
"RTN","EASECU",60,0)
 W !,"LTC Copayment Status: ",DGMTS,"   Last Test: " S Y=DGMTDT X ^DD("DD") W Y
"RTN","EASECU",61,0)
 ; If last test is over a year old and patient is not deceased or not
"RTN","EASECU",62,0)
 ; exempt due to eligibility (compensable SC) or LTC before 11/30/99
"RTN","EASECU",63,0)
 ; display message that a new test is required
"RTN","EASECU",64,0)
 I $$FMDIFF^XLFDT(DT,DGMTDT)>364 D
"RTN","EASECU",65,0)
 .I $P($G(^DPT(DFN,.35)),U) Q
"RTN","EASECU",66,0)
 .I "^1^4^"[(U_$P($G(^DGMT(408.31,DGMTI,2)),U,7)_U) Q
"RTN","EASECU",67,0)
 .W " **NEW TEST REQUIRED**"
"RTN","EASECU",68,0)
 I $P($G(^DGMT(408.31,DGMTI,0)),U,11)=0 W !,"Patient INELIGIBLE to Receive LTC Services -- Did Not Agree to Pay Copayments"
"RTN","EASECU",69,0)
 Q
"RTN","EASECU23")
0^6^B10484457
"RTN","EASECU23",1,0)
EASECU23 ;ALB/PHH,LBD - Display LTC Co-Pay test information; 17 AUG 2001
"RTN","EASECU23",2,0)
 ;;1.0;ENROLLMENT APPLICATION SYSTEM;**5,7,34**;Mar 15, 2001
"RTN","EASECU23",3,0)
 ;
"RTN","EASECU23",4,0)
DISPLAY(DGMTI,DGMTYPT) ;Display LTC Co-Pay test data
"RTN","EASECU23",5,0)
 ;          Input:  DGMTI - IEN of LTC Co-Pay
"RTN","EASECU23",6,0)
 ;                  DGMTYPT - Type of Test
"RTN","EASECU23",7,0)
 ;         Output:  None
"RTN","EASECU23",8,0)
 N DGFCOL,DGSCOL,DGMTDIS,DGMTWP,WP,X,X1,Y,Z,DGSOURCE
"RTN","EASECU23",9,0)
 S (DGMTWP,WP)=0,DGFCOL=24,DGSCOL=65
"RTN","EASECU23",10,0)
 S DGMTDIS=^DGMT(408.31,DGMTI,0) I $D(^("C")) F  S DGMTWP=$O(^DGMT(408.31,DGMTI,"C",DGMTWP)) Q:'DGMTWP  S DGMTDIS(DGMTWP)=^(DGMTWP,0)
"RTN","EASECU23",11,0)
 S X="",X=$$SETSTR^VALM1("Patient:",X,15,8)
"RTN","EASECU23",12,0)
 S X=$$SETSTR^VALM1($P(^DPT($P(DGMTDIS,U,2),0),U),X,DGFCOL,25)
"RTN","EASECU23",13,0)
 S X=$$SETSTR^VALM1("Date of Test:",X,51,13)
"RTN","EASECU23",14,0)
 S X=$$SETSTR^VALM1($$FTIME^DGMTUTL($P(DGMTDIS,U)),X,DGSCOL,15)
"RTN","EASECU23",15,0)
 W !!,X
"RTN","EASECU23",16,0)
 S X="",X=$$SETSTR^VALM1("Total Dependents:",X,6,17)
"RTN","EASECU23",17,0)
 S X=$$SETSTR^VALM1($P(DGMTDIS,U,18),X,DGFCOL,25)
"RTN","EASECU23",18,0)
 S X=$$SETSTR^VALM1("Type Of Test:",X,51,13)
"RTN","EASECU23",19,0)
 S X=$$SETSTR^VALM1($P($G(^DG(408.33,+$P(DGMTDIS,U,19),0)),U),X,DGSCOL,15)
"RTN","EASECU23",20,0)
 W !,X
"RTN","EASECU23",21,0)
 S X="",X=$$SETSTR^VALM1("Status:",X,16,7)
"RTN","EASECU23",22,0)
 S X=$$SETSTR^VALM1($S($P(DGMTDIS,U,3)'="":$P(^DG(408.32,$P(DGMTDIS,U,3),0),U),1:"In Process"),X,DGFCOL,25)
"RTN","EASECU23",23,0)
 S X=$$SETSTR^VALM1("Date/Time Completed:",X,44,20)
"RTN","EASECU23",24,0)
 S X=$$SETSTR^VALM1($S($P(DGMTDIS,U,7)'="":$$FTIME^DGMTUTL($P(DGMTDIS,U,7)),1:""),X,DGSCOL,15)
"RTN","EASECU23",25,0)
 W !,X
"RTN","EASECU23",26,0)
 I $P(DGMTDIS,U,3)=12 D
"RTN","EASECU23",27,0)
 .N EXERSN
"RTN","EASECU23",28,0)
 .S X="",X=$$SETSTR^VALM1("Reason:",X,16,7),EXERSN=$P($G(^DGMT(408.31,DGMTI,2)),U,7)
"RTN","EASECU23",29,0)
 .S X=$$SETSTR^VALM1($S(EXERSN'="":$P(^EAS(714.1,EXERSN,0),"^"),1:""),X,DGFCOL,56)
"RTN","EASECU23",30,0)
 .W !,X
"RTN","EASECU23",31,0)
 S X="",X=$$SETSTR^VALM1("Source Of Test:",X,49,15)
"RTN","EASECU23",32,0)
 S DGSOURCE=$$SR^DGMTAUD1(DGMTDIS)
"RTN","EASECU23",33,0)
 I DGSOURCE="OTHER FACILITY" S DGSOURCE=$P($G(^DGMT(408.31,DGMTI,2)),"^",5)
"RTN","EASECU23",34,0)
 S X=$$SETSTR^VALM1(DGSOURCE,X,DGSCOL,15)
"RTN","EASECU23",35,0)
 W !,X
"RTN","EASECU23",36,0)
 S X="",X=$$SETSTR^VALM1("Income:",X,16,7)
"RTN","EASECU23",37,0)
 S X=$$SETSTR^VALM1($S($P(DGMTDIS,U,4)'="":"$"_$P(DGMTDIS,U,4),1:""),X,DGFCOL,25)
"RTN","EASECU23",38,0)
 S X=$$SETSTR^VALM1("Completed By:",X,51,13)
"RTN","EASECU23",39,0)
 S X=$$SETSTR^VALM1($P($G(^VA(200,+$P(DGMTDIS,U,6),0)),U),X,DGSCOL,15)
"RTN","EASECU23",40,0)
 W !,X
"RTN","EASECU23",41,0)
 S X="",X=$$SETSTR^VALM1("Assets:",X,16,7)
"RTN","EASECU23",42,0)
 S X=$$SETSTR^VALM1($S($P(DGMTDIS,U,5)'="":"$"_$P(DGMTDIS,U,5),1:""),X,DGFCOL,25)
"RTN","EASECU23",43,0)
 W !,X
"RTN","EASECU23",44,0)
 S X="",X=$$SETSTR^VALM1("Deductible Expenses:",X,3,20)
"RTN","EASECU23",45,0)
 S X=$$SETSTR^VALM1($S($P(DGMTDIS,U,15)'="":"$"_$P(DGMTDIS,U,15),1:""),X,DGFCOL,25)
"RTN","EASECU23",46,0)
 W !,X
"RTN","EASECU23",47,0)
 S X=""
"RTN","EASECU23",48,0)
 S X=$$SETSTR^VALM1("Declines Income Info:",X,2,21)
"RTN","EASECU23",49,0)
 S X=$$SETSTR^VALM1($S($P(DGMTDIS,U,14)=1:"YES",$P(DGMTDIS,U,14)=0:"NO",1:""),X,DGFCOL,25)
"RTN","EASECU23",50,0)
 S X=$$SETSTR^VALM1("Agrees to Pay Copayments:",X,39,25)
"RTN","EASECU23",51,0)
 S X=$$SETSTR^VALM1($S($P(DGMTDIS,U,11)=1:"YES",$P(DGMTDIS,U,11)=0:"NO *INELIGIBLE*",1:""),X,DGSCOL,15)
"RTN","EASECU23",52,0)
 W !,X
"RTN","EASECU23",53,0)
 S (X,Y)=""
"RTN","EASECU23",54,0)
 I $G(^DGMT(408.31,DGMTI,"PURGE"))'="" D
"RTN","EASECU23",55,0)
 .S X=$$SETSTR^VALM1("Income Data Purged:",X,45,19)
"RTN","EASECU23",56,0)
 .S X1=^DGMT(408.31,DGMTI,"PURGE")
"RTN","EASECU23",57,0)
 .S X=$$SETSTR^VALM1($$FTIME^DGMTUTL(X1),X,DGSCOL,15)
"RTN","EASECU23",58,0)
 W !,X
"RTN","EASECU23",59,0)
 ;
"RTN","EASECU23",60,0)
 S (X,Y,Z)=""
"RTN","EASECU23",61,0)
 W !,"Comment(s):" F  S WP=$O(DGMTDIS(WP)) Q:'WP  D
"RTN","EASECU23",62,0)
 .W !,DGMTDIS(WP)
"RTN","EASECU23",63,0)
 W !
"RTN","EASECU23",64,0)
 Q
"VER")
8.0^22
**INSTALL NAME**
DG*5.3*518
"BLD",4284,0)
DG*5.3*518^REGISTRATION^0^3030723^y
"BLD",4284,1,0)
^^1^1^3030623^
"BLD",4284,1,1,0)
LTC Copayment Phase III
"BLD",4284,4,0)
^9.64PA^^
"BLD",4284,"ABPKG")
n
"BLD",4284,"KRN",0)
^9.67PA^8989.52^19
"BLD",4284,"KRN",.4,0)
.4
"BLD",4284,"KRN",.401,0)
.401
"BLD",4284,"KRN",.402,0)
.402
"BLD",4284,"KRN",.403,0)
.403
"BLD",4284,"KRN",.5,0)
.5
"BLD",4284,"KRN",.84,0)
.84
"BLD",4284,"KRN",3.6,0)
3.6
"BLD",4284,"KRN",3.8,0)
3.8
"BLD",4284,"KRN",9.2,0)
9.2
"BLD",4284,"KRN",9.8,0)
9.8
"BLD",4284,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",4284,"KRN",9.8,"NM",1,0)
DGRPD^^0^B52296876
"BLD",4284,"KRN",9.8,"NM",2,0)
DGMTU3^^0^B10190383
"BLD",4284,"KRN",9.8,"NM",3,0)
DGMTDD2^^0^B27411825
"BLD",4284,"KRN",9.8,"NM",4,0)
DGMTDEL1^^0^B14061297
"BLD",4284,"KRN",9.8,"NM","B","DGMTDD2",3)

"BLD",4284,"KRN",9.8,"NM","B","DGMTDEL1",4)

"BLD",4284,"KRN",9.8,"NM","B","DGMTU3",2)

"BLD",4284,"KRN",9.8,"NM","B","DGRPD",1)

"BLD",4284,"KRN",19,0)
19
"BLD",4284,"KRN",19.1,0)
19.1
"BLD",4284,"KRN",101,0)
101
"BLD",4284,"KRN",409.61,0)
409.61
"BLD",4284,"KRN",771,0)
771
"BLD",4284,"KRN",870,0)
870
"BLD",4284,"KRN",8989.51,0)
8989.51
"BLD",4284,"KRN",8989.52,0)
8989.52
"BLD",4284,"KRN",8994,0)
8994
"BLD",4284,"KRN","B",.4,.4)

"BLD",4284,"KRN","B",.401,.401)

"BLD",4284,"KRN","B",.402,.402)

"BLD",4284,"KRN","B",.403,.403)

"BLD",4284,"KRN","B",.5,.5)

"BLD",4284,"KRN","B",.84,.84)

"BLD",4284,"KRN","B",3.6,3.6)

"BLD",4284,"KRN","B",3.8,3.8)

"BLD",4284,"KRN","B",9.2,9.2)

"BLD",4284,"KRN","B",9.8,9.8)

"BLD",4284,"KRN","B",19,19)

"BLD",4284,"KRN","B",19.1,19.1)

"BLD",4284,"KRN","B",101,101)

"BLD",4284,"KRN","B",409.61,409.61)

"BLD",4284,"KRN","B",771,771)

"BLD",4284,"KRN","B",870,870)

"BLD",4284,"KRN","B",8989.51,8989.51)

"BLD",4284,"KRN","B",8989.52,8989.52)

"BLD",4284,"KRN","B",8994,8994)

"BLD",4284,"QUES",0)
^9.62^^
"BLD",4284,"REQB",0)
^9.611^2^2
"BLD",4284,"REQB",1,0)
DG*5.3*513^2
"BLD",4284,"REQB",2,0)
DG*5.3*499^2
"BLD",4284,"REQB","B","DG*5.3*499",2)

"BLD",4284,"REQB","B","DG*5.3*513",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
518^3030723
"PKG",5,22,1,"PAH",1,1,0)
^^1^1^3030723
"PKG",5,22,1,"PAH",1,1,1,0)
LTC Copayment Phase III
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","DGMTDD2")
0^3^B27411825
"RTN","DGMTDD2",1,0)
DGMTDD2 ;ALB/RMO,LBD - Income Relation file (#408.22) Data Dictionary Calls ;13 MAR 1992 3:00 pm
"RTN","DGMTDD2",2,0)
 ;;5.3;Registration;**33,45,518**;Aug 13, 1993
"RTN","DGMTDD2",3,0)
 ;
"RTN","DGMTDD2",4,0)
ID ;Identifier for Income Relation file
"RTN","DGMTDD2",5,0)
 N DGIN0,DGPRI,Y
"RTN","DGMTDD2",6,0)
 S DGIN0=$G(^DGMT(408.21,+$P($G(^(0)),U,2),0))
"RTN","DGMTDD2",7,0)
 S DGPRI=+$P(DGIN0,U,2),Y=+DGIN0 X ^DD("DD")
"RTN","DGMTDD2",8,0)
 W "  ",Y W:$P($G(^DGPR(408.12,DGPRI,0)),U,2)'=1 "    Relation: ",$$NAME^DGMTU1(DGPRI),"  (",$$REL^DGMTU1(DGPRI),")" W !
"RTN","DGMTDD2",9,0)
 Q
"RTN","DGMTDD2",10,0)
 ;
"RTN","DGMTDD2",11,0)
FUN ;"Trigger" Cross-reference on the Married field (#.05) and
"RTN","DGMTDD2",12,0)
 ;Dependent Children field (#.08) to delete funeral and burial
"RTN","DGMTDD2",13,0)
 ;expenses
"RTN","DGMTDD2",14,0)
 ;  If the test is a LTC Copay test do not delete the funeral and
"RTN","DGMTDD2",15,0)
 ;  burial expenses.  Added for LTC Phase III (DG*5.3*518)
"RTN","DGMTDD2",16,0)
 N DGFLD,DGIN0,DGINI,DGVAL,DGMT
"RTN","DGMTDD2",17,0)
 S DGINI=+$P($G(^DGMT(408.22,DA,0)),U,2),DGIN1=$G(^DGMT(408.21,DGINI,1))
"RTN","DGMTDD2",18,0)
 S DGMT=+$G(^DGMT(408.21,DGINI,"MT"))
"RTN","DGMTDD2",19,0)
 I DGMT,$P($G(^DGMT(408.31,DGMT,0)),U,19)=3 Q
"RTN","DGMTDD2",20,0)
 S DGFLD=1.02,DGVAL=$P(DGIN1,U,2)
"RTN","DGMTDD2",21,0)
 I DGVAL]"" D KILL S $P(^DGMT(408.21,DGINI,1),U,2)=""
"RTN","DGMTDD2",22,0)
 Q
"RTN","DGMTDD2",23,0)
 ;
"RTN","DGMTDD2",24,0)
SP ;"Trigger" Cross-reference on the Amount Contributed to Spouse field
"RTN","DGMTDD2",25,0)
 ;(#.07) to delete net worth on file for a spouse
"RTN","DGMTDD2",26,0)
 N DFN,DGIN2,DGINI,DGLY,DGREL,DGVAL
"RTN","DGMTDD2",27,0)
 S DGIR0=$G(^DGMT(408.22,DA,0))
"RTN","DGMTDD2",28,0)
 S DFN=+DGIR0,DGLY=+$G(^DGMT(408.21,+$P(DGIR0,U,2),0)) D
"RTN","DGMTDD2",29,0)
 .N DA,X
"RTN","DGMTDD2",30,0)
 .D GETREL^DGMTU11(DFN,"S",DGLY,$S($G(DGMTI):DGMTI,1:""))
"RTN","DGMTDD2",31,0)
 S DGINI=+$$IAI^DGMTU3(+$G(DGREL("S")),DGLY)
"RTN","DGMTDD2",32,0)
 S DGIN2=$G(^DGMT(408.21,DGINI,2))
"RTN","DGMTDD2",33,0)
 F DGFLD=2.01:.01:2.05 S DGVAL=$P(DGIN2,U,(DGFLD-2)/.01) I DGVAL]"" D
"RTN","DGMTDD2",34,0)
 .D KILL
"RTN","DGMTDD2",35,0)
 .S $P(^DGMT(408.21,DGINI,2),U,(DGFLD-2)/.01)=""
"RTN","DGMTDD2",36,0)
 Q
"RTN","DGMTDD2",37,0)
 ;
"RTN","DGMTDD2",38,0)
INC ;"Trigger" Cross-reference on the Child Had Income field (#.11) and
"RTN","DGMTDD2",39,0)
 ;Income Available To You field (#.12) to delete educational expenses
"RTN","DGMTDD2",40,0)
 ;on file for a child
"RTN","DGMTDD2",41,0)
 N DGINI
"RTN","DGMTDD2",42,0)
 S DGINI=+$P($G(^DGMT(408.22,DA,0)),U,2)
"RTN","DGMTDD2",43,0)
 I $P($G(^DGMT(408.21,DGINI,0)),U,14)]"" D
"RTN","DGMTDD2",44,0)
 .N DGFLD,DGVAL
"RTN","DGMTDD2",45,0)
 .I $P($G(^DGMT(408.21,DGINI,1)),U,3)]"" S DGVAL=$P(^(1),U,3),DGFLD=1.03 D KILL S $P(^DGMT(408.21,DGINI,1),U,3)=""
"RTN","DGMTDD2",46,0)
 Q
"RTN","DGMTDD2",47,0)
KILL ;Kill Cross-Reference
"RTN","DGMTDD2",48,0)
 N DA,DGIX,X
"RTN","DGMTDD2",49,0)
 S DA=DGINI,X=DGVAL,DGIX=0
"RTN","DGMTDD2",50,0)
 F  S DGIX=$O(^DD(408.21,DGFLD,1,DGIX)) Q:'DGIX  X ^(DGIX,2) S X=DGVAL
"RTN","DGMTDD2",51,0)
 Q
"RTN","DGMTDD2",52,0)
 ;
"RTN","DGMTDD2",53,0)
MAR ;Input Transform check for the Married field (#.05)
"RTN","DGMTDD2",54,0)
 ;for an active spouse
"RTN","DGMTDD2",55,0)
 N DFN,DGIR0,DGLY,DGREL
"RTN","DGMTDD2",56,0)
 S DGIR0=$G(^DGMT(408.22,DA,0))
"RTN","DGMTDD2",57,0)
 S DFN=+DGIR0,DGLY=+$G(^DGMT(408.21,+$P(DGIR0,U,2),0)) D
"RTN","DGMTDD2",58,0)
 .N DA,X
"RTN","DGMTDD2",59,0)
 .D GETREL^DGMTU11(DFN,"S",DGLY,$S($G(DGMTI):DGMTI,1:""))
"RTN","DGMTDD2",60,0)
 I $D(DGREL("S")) W !?5,"An active spouse exists.  Married cannot be 'NO'.",!?5,"You have to use the 'Expand Dependent' action and inactive first." K X
"RTN","DGMTDD2",61,0)
 Q
"RTN","DGMTDD2",62,0)
 ;
"RTN","DGMTDD2",63,0)
DEP ;Input Transform check for the Dependent Children field (#.08)
"RTN","DGMTDD2",64,0)
 ;for active children
"RTN","DGMTDD2",65,0)
 N DFN,DGDEP,DGIR0,DGLY,DGREL
"RTN","DGMTDD2",66,0)
 S DGIR0=$G(^DGMT(408.22,DA,0))
"RTN","DGMTDD2",67,0)
 S DFN=+DGIR0,DGLY=+$G(^DGMT(408.21,+$P(DGIR0,U,2),0)) D
"RTN","DGMTDD2",68,0)
 .N DA,X
"RTN","DGMTDD2",69,0)
 .D GETREL^DGMTU11(DFN,"C",DGLY,$S($G(DGMTI):DGMTI,1:""))
"RTN","DGMTDD2",70,0)
 I $D(DGREL("C")) W !?5,"Active children exist.  Dependent Children cannot be 'NO'." K X
"RTN","DGMTDD2",71,0)
 Q
"RTN","DGMTDD2",72,0)
 ;
"RTN","DGMTDD2",73,0)
LIV ;Input Transform check for Lived With Patient field (#.06)
"RTN","DGMTDD2",74,0)
 N DGIR0,DGPRI
"RTN","DGMTDD2",75,0)
 S DGIR0=$G(^DGMT(408.22,DA,0)),DGPRI=+$P($G(^DGMT(408.21,+$P(DGIR0,U,2),0)),U,2)
"RTN","DGMTDD2",76,0)
 I $P($G(^DGPR(408.12,DGPRI,0)),U,2)=1,'$P(DGIR0,U,5) W !?5,"This field does not need to be filled in unless the patient is married." K X
"RTN","DGMTDD2",77,0)
 Q
"RTN","DGMTDD2",78,0)
 ;
"RTN","DGMTDD2",79,0)
AMT ;Input Transform check for Amount Contributed To Spouse field (#.07)
"RTN","DGMTDD2",80,0)
 N DGIR0,DGPRI
"RTN","DGMTDD2",81,0)
 S DGIR0=$G(^DGMT(408.22,DA,0)),DGPRI=+$P($G(^DGMT(408.21,+$P(DGIR0,U,2),0)),U,2)
"RTN","DGMTDD2",82,0)
 I $P($G(^DGPR(408.12,DGPRI,0)),U,2)=1,('$P(DGIR0,U,5)!($P(DGIR0,U,6)'=0)) W !?5,"This field does not need to be filled in unless the patient was married",!?5,"and did not live with his or her spouse." K X
"RTN","DGMTDD2",83,0)
 Q
"RTN","DGMTDD2",84,0)
 ;
"RTN","DGMTDD2",85,0)
CON ;Input Transform check for Contributed To Support field (#.1)
"RTN","DGMTDD2",86,0)
 N DGIR0,DGPRI
"RTN","DGMTDD2",87,0)
 S DGIR0=$G(^DGMT(408.22,DA,0)),DGPRI=+$P($G(^DGMT(408.21,+$P(DGIR0,U,2),0)),U,2)
"RTN","DGMTDD2",88,0)
 I "^3^4^5^6^"[(U_$P($G(^DGPR(408.12,DGPRI,0)),U,2)_U),$P(DGIR0,U,6)'=0 W !?5,"This field does not need to be filled in unless the child did not",!?5,"live with the patient." K X
"RTN","DGMTDD2",89,0)
 Q
"RTN","DGMTDD2",90,0)
 ;
"RTN","DGMTDD2",91,0)
AVL ;Input Transform check for Income Available To You field (#.12)
"RTN","DGMTDD2",92,0)
 I '$P($G(^DGMT(408.22,DA,0)),U,11) W !?5,"This field does not need to be filled in unless the child has income." K X
"RTN","DGMTDD2",93,0)
 Q
"RTN","DGMTDD2",94,0)
 ;
"RTN","DGMTDD2",95,0)
NAM ;Output Transform for Individual Annual Income field (#.02)
"RTN","DGMTDD2",96,0)
 N DGIN0,DGPRI
"RTN","DGMTDD2",97,0)
 S DGIN0=$G(^DGMT(408.21,Y,0)),DGPRI=+$P(DGIN0,U,2),Y=+DGIN0 X ^DD("DD")
"RTN","DGMTDD2",98,0)
 S Y=Y_"  "_$$NAME^DGMTU1(DGPRI)
"RTN","DGMTDD2",99,0)
 Q
"RTN","DGMTDD2",100,0)
 ;
"RTN","DGMTDD2",101,0)
LIVHLP ;Help for Lived With Patient field (#.06)
"RTN","DGMTDD2",102,0)
 N DGIR0,DGPRI
"RTN","DGMTDD2",103,0)
 S DGIR0=$G(^DGMT(408.22,DA,0)),DGPRI=+$P($G(^DGMT(408.21,+$P(DGIR0,U,2),0)),U,2)
"RTN","DGMTDD2",104,0)
 I $P($G(^DGPR(408.12,DGPRI,0)),U,2)=1 W !?5,"Enter in this field whether the veteran resided with his or her spouse",!?5,"last calendar year.  If they were living apart because one was",!?5,"hospitalized or in a nursing home, enter 'YES'."
"RTN","DGMTDD2",105,0)
 I "^3^4^5^6^"[(U_$P($G(^DGPR(408.12,DGPRI,0)),U,2)_U) W !?5,"Enter in this field whether the child resided with the veteran last",!?5,"calendar year."
"RTN","DGMTDD2",106,0)
 W !
"RTN","DGMTDD2",107,0)
 Q
"RTN","DGMTDEL1")
0^4^B14061297
"RTN","DGMTDEL1",1,0)
DGMTDEL1 ;ALB/CAW,LBD - Delete MT for a Patient (con't) ;12/6/94
"RTN","DGMTDEL1",2,0)
 ;;5.3;Registration;**45,166,182,433,518**;Aug 13, 1993
"RTN","DGMTDEL1",3,0)
 ;
"RTN","DGMTDEL1",4,0)
ID ;write identifiers
"RTN","DGMTDEL1",5,0)
 S DGI=Y,DGN=$G(^DGMT(408.31,DGI,0))
"RTN","DGMTDEL1",6,0)
 W ?21,$S(DGMTYPT=1:"MEANS",DGMTYPT=2:"COPAY",DGMTYPT=4:"LTC Copay Exemption",1:"")_" TEST DATE"
"RTN","DGMTDEL1",7,0)
 S DGMTSRC=$$SR^DGMTAUD1(DGN)
"RTN","DGMTDEL1",8,0)
 I DGMTSRC="" S DGMTSRC="UNKNOWN"
"RTN","DGMTDEL1",9,0)
 W ?40,"SOURCE: ",$S($L(DGMTSRC)>10:$E(DGMTSRC,1,10),1:DGMTSRC),?60,"PRIMARY TEST: ",$S($G(^DGMT(408.31,DGI,"PRIM"))=1:"YES",1:"NO")
"RTN","DGMTDEL1",10,0)
 W !?14,"STATUS: ",$$S^DGMTAUD1($P(^(0),U,3)),?45,"COMPLETED: ",$S($P(^DGMT(408.31,DGI,0),U,7)']"":"-----",1:$$DATE($P(^(0),U,7)))
"RTN","DGMTDEL1",11,0)
 Q
"RTN","DGMTDEL1",12,0)
 ;
"RTN","DGMTDEL1",13,0)
DEL ;delete
"RTN","DGMTDEL1",14,0)
 ;
"RTN","DGMTDEL1",15,0)
 ;add entry in IVM PATIENT file used to notify HEC that a Means Test
"RTN","DGMTDEL1",16,0)
 ;or Copay, or LTC Copay Exemption Test has been deleted.
"RTN","DGMTDEL1",17,0)
 ;
"RTN","DGMTDEL1",18,0)
 D DELETE^IVMPLOG(DFN,DGMTD,$S(DGMTYPT=1:1,1:""),$S(DGMTYPT=2:2,1:""),,$S(DGMTYPT=4:4,1:""))
"RTN","DGMTDEL1",19,0)
 ;
"RTN","DGMTDEL1",20,0)
 D DELLNK  ;Deletion of Linked Tests
"RTN","DGMTDEL1",21,0)
 S DGMTACT="DEL",DIK="^DGMT(408.31," D ^DIK
"RTN","DGMTDEL1",22,0)
 S DGMTY=0 F  S DGMTY=$O(^DGMT(408.22,"AMT",DGMTI,DFN,DGMTY)) Q:'DGMTY  S DGMTX=0 F  S DGMTX=$O(^DGMT(408.22,"AMT",DGMTI,DFN,DGMTY,DGMTX)) Q:'DGMTX  D
"RTN","DGMTDEL1",23,0)
 .S DA=DGMTX
"RTN","DGMTDEL1",24,0)
 .I DA S DR="31///@",DIE="^DGMT(408.22," D ^DIE
"RTN","DGMTDEL1",25,0)
 .K DE,DQ,DR,DIK
"RTN","DGMTDEL1",26,0)
 D AFTER^DGMTEVT S DGMTINF=0
"RTN","DGMTDEL1",27,0)
 I DGMTYPT=1!(DGMTYPT=2) D EN^DGMTEVT
"RTN","DGMTDEL1",28,0)
 I DGMTYPT=4 D
"RTN","DGMTDEL1",29,0)
 . D EN^DGMTAUD
"RTN","DGMTDEL1",30,0)
 . D ^IVMPMTE
"RTN","DGMTDEL1",31,0)
 Q
"RTN","DGMTDEL1",32,0)
VAR ;set variables
"RTN","DGMTDEL1",33,0)
 S DA=DGMTI,(DGP,DGMTP)=DGMT0,DGMTD=$P(DGMT0,U),DGCAT=$$MTS^DGMTU(DFN,$P(DGMTP,U,3)),DGMTYPT=$P(^DGMT(408.31,DGMTI,0),U,19)
"RTN","DGMTDEL1",34,0)
 Q
"RTN","DGMTDEL1",35,0)
LOOP ;loop through all means test for patient and delete
"RTN","DGMTDEL1",36,0)
 S (DGCT,DGI)=0 F  S DGI=$O(^DGMT(408.31,"C",DFN,DGI)) G:'DGI LKP^DGMTDEL S DGMTI=DGI,DGMT0=+$G(^DGMT(408.31,DGMTI,0)) D VAR,DEL S DGMTP=DGP,DGCT=DGCT+1
"RTN","DGMTDEL1",37,0)
 W !?10,DGCT,$S(DGMTYPT=1:" Means Test",DGMTYPT=2:" Copay Test",DGMTYPT=4:" LTC Copay Exemption Test",1:"")_$S(DGCT'=1:"s",1:"")_" deleted!"
"RTN","DGMTDEL1",38,0)
 Q
"RTN","DGMTDEL1",39,0)
DATE(X) ;function to return date in external format
"RTN","DGMTDEL1",40,0)
 ;INPUT -  FM internal date format
"RTN","DGMTDEL1",41,0)
 ;OUTPUT - external date format
"RTN","DGMTDEL1",42,0)
 Q $$FMTE^XLFDT($E(X,1,12),1)
"RTN","DGMTDEL1",43,0)
 ;
"RTN","DGMTDEL1",44,0)
PID(X) ;function to return pid
"RTN","DGMTDEL1",45,0)
 ;INPUT -  DFN
"RTN","DGMTDEL1",46,0)
 ;OUTPUT - PID or UNKNOWN
"RTN","DGMTDEL1",47,0)
 D PID^VADPT6
"RTN","DGMTDEL1",48,0)
 Q $S(VA("PID")]"":VA("PID"),1:"UNKNOWN")
"RTN","DGMTDEL1",49,0)
DELLNK ;Deletion of Linked tests
"RTN","DGMTDEL1",50,0)
 N IEN4,GIEN,DA,DIK,DIE,DR,LTCDT
"RTN","DGMTDEL1",51,0)
 I DGMTYPT=1!(DGMTYPT=2) D
"RTN","DGMTDEL1",52,0)
 .;check to see if test type 4 is linked with type 1 or 2
"RTN","DGMTDEL1",53,0)
 . S IEN4=$O(^DGMT(408.31,"AT",DGMTI,"")) Q:IEN4=""  ;Test type 4
"RTN","DGMTDEL1",54,0)
 . S LTCDT=$P($G(^DGMT(408.31,IEN4,0)),"^",1)  ;Date of Test
"RTN","DGMTDEL1",55,0)
 .;Check to see if test type 3 is linked with type 4
"RTN","DGMTDEL1",56,0)
 .;if linked, remove pointer value from test type 3
"RTN","DGMTDEL1",57,0)
 .;  Added FOR loop for LTC Phase III to support multiple type 3 tests
"RTN","DGMTDEL1",58,0)
 . S GIEN="" F  S GIEN=$O(^DGMT(408.31,"AT",IEN4,GIEN)) Q:GIEN=""  D
"RTN","DGMTDEL1",59,0)
 . . S DA=GIEN,DR="2.08///@",DIE="^DGMT(408.31," D ^DIE
"RTN","DGMTDEL1",60,0)
 .;remove linked test type 4 record.
"RTN","DGMTDEL1",61,0)
 . D DELETE^IVMPLOG(DFN,LTCDT,,,,4)
"RTN","DGMTDEL1",62,0)
 . N DGMTI,DGMTP,DGMTA,DGMTINF,DGMTACT,DGMTYPT
"RTN","DGMTDEL1",63,0)
 . S DGMTI=IEN4,DGMTP=$G(^DGMT(408.31,DGMTI,0))
"RTN","DGMTDEL1",64,0)
 . S DA=DGMTI,DIK="^DGMT(408.31," D ^DIK
"RTN","DGMTDEL1",65,0)
 . S DGMTACT="DEL" D AFTER^DGMTEVT S DGMTINF=0
"RTN","DGMTDEL1",66,0)
 . S DGMTYPT=4 D EN^DGMTAUD
"RTN","DGMTDEL1",67,0)
 I DGMTYPT=4 D
"RTN","DGMTDEL1",68,0)
 .;Check to see if test type 3 is linked with type 4
"RTN","DGMTDEL1",69,0)
 .;if linked, remove pointer value from test type 3
"RTN","DGMTDEL1",70,0)
 .;  Added FOR loop for LTC Phase III to support multiple type 3 tests
"RTN","DGMTDEL1",71,0)
 . S GIEN="" F  S GIEN=$O(^DGMT(408.31,"AT",DGMTI,GIEN)) Q:GIEN=""  D
"RTN","DGMTDEL1",72,0)
 . . S DA=GIEN,DR="2.08///@",DIE="^DGMT(408.31," D ^DIE
"RTN","DGMTDEL1",73,0)
 Q
"RTN","DGMTU3")
0^2^B10190383
"RTN","DGMTU3",1,0)
DGMTU3 ;ALB/MLI/GN/LBD - Internal Entry Number Utility Calls ; 2/20/03 8:45am
"RTN","DGMTU3",2,0)
 ;;5.3;Registration;**33,45,137,182,300,433,499,518**;Aug 13, 1993
"RTN","DGMTU3",3,0)
 ;
"RTN","DGMTU3",4,0)
 ; This routine will return the IENs for the primary income
"RTN","DGMTU3",5,0)
 ; test from various files.
"RTN","DGMTU3",6,0)
 ;
"RTN","DGMTU3",7,0)
MTIEN(TYPE,DFN,INVDT) ; get last primary income test for date
"RTN","DGMTU3",8,0)
 ;
"RTN","DGMTU3",9,0)
 ; Input  -- TYPE as 1 for means test, 2 for copay test
"RTN","DGMTU3",10,0)
 ;           DFN as Patient IEN
"RTN","DGMTU3",11,0)
 ;           INVDT as inverse date for search
"RTN","DGMTU3",12,0)
 ; Output -- Record IEN
"RTN","DGMTU3",13,0)
 ;
"RTN","DGMTU3",14,0)
 N I
"RTN","DGMTU3",15,0)
 F I=0:0 S I=$O(^DGMT(408.31,"AID",TYPE,DFN,INVDT,I)) Q:'I  I +$G(^DGMT(408.31,I,"PRIM")) Q
"RTN","DGMTU3",16,0)
 Q I
"RTN","DGMTU3",17,0)
 ;
"RTN","DGMTU3",18,0)
 ;
"RTN","DGMTU3",19,0)
IAI(REL,YEAR,DGMTYPT) ; get individual annual income IEN for primary income test/pt relation
"RTN","DGMTU3",20,0)
 ;
"RTN","DGMTU3",21,0)
 ; Input  -- REL as IEN of PATIENT RELATION file
"RTN","DGMTU3",22,0)
 ;           YEAR as income year in question
"RTN","DGMTU3",23,0)
 ;           DGMTYPT as type of test (optional if not defined means test
"RTN","DGMTU3",24,0)
 ;                   will be assumed)
"RTN","DGMTU3",25,0)
 ; Output -- Record IEN
"RTN","DGMTU3",26,0)
 ;
"RTN","DGMTU3",27,0)
 N DFN,I,IEN,INR,MTIEN,LAST,DGDT,LTCIEN
"RTN","DGMTU3",28,0)
 S DFN=+$G(^DGPR(408.12,+REL,0)) I 'DFN G IAIQ
"RTN","DGMTU3",29,0)
 ;
"RTN","DGMTU3",30,0)
 ;DG*5.3*499, change to if structure and check for presence of DGMTI
"RTN","DGMTU3",31,0)
 ; it is not defined when coming from Bene travel menus
"RTN","DGMTU3",32,0)
 ;LTC Phase III (DG*5.3*518) - add setting of LTCIEN
"RTN","DGMTU3",33,0)
 ;
"RTN","DGMTU3",34,0)
 ; if user selects view option & DGMTI exists, set IEN=DGMTI
"RTN","DGMTU3",35,0)
 I $G(DGMTACT)="VEW",$G(DGMTI) D
"RTN","DGMTU3",36,0)
 . S (MTIEN,LTCIEN)=DGMTI
"RTN","DGMTU3",37,0)
 E  D
"RTN","DGMTU3",38,0)
 . S DGDT=$E(YEAR,1,3)+1_"1231.99"
"RTN","DGMTU3",39,0)
 . S MTIEN=$$LST^DGMTU(DFN,DGDT,$S($G(DGMTYPT):DGMTYPT,1:1))
"RTN","DGMTU3",40,0)
 . S LTCIEN=$S($G(DGMTI):DGMTI,1:$$LST^EASECU(DFN,(YEAR+1231.99),3))
"RTN","DGMTU3",41,0)
 ;
"RTN","DGMTU3",42,0)
 I MTIEN S LAST=0 D
"RTN","DGMTU3",43,0)
 . F I=0:0 S I=$O(^DGMT(408.21,"AI",+REL,-YEAR,I)) Q:'I  S LAST=I,INR=$O(^DGMT(408.22,"AIND",I,"")) I +$G(^DGMT(408.22,+INR,"MT"))=+MTIEN Q
"RTN","DGMTU3",44,0)
 . S IEN=LAST
"RTN","DGMTU3",45,0)
 . ; The following was added for LTC Copay Phase II (DG*5.3*433)
"RTN","DGMTU3",46,0)
 . ; If the IAI record is associated with a LTC Copay Test (type 3),
"RTN","DGMTU3",47,0)
 . ; don't return it if DGMTYPT is not type 3.
"RTN","DGMTU3",48,0)
 . Q:'$G(^DGMT(408.21,IEN,"MT"))
"RTN","DGMTU3",49,0)
 . I $P($G(^DGMT(408.31,+^DGMT(408.21,IEN,"MT"),0)),U,19)=3,$G(DGMTYPT)'=3 S IEN=""
"RTN","DGMTU3",50,0)
 . ; If DGMTYPT=3 make sure the IAI record is associated with the
"RTN","DGMTU3",51,0)
 . ; correct LTC Copay test. Added for LTC Phase III (DG*5.3*518)
"RTN","DGMTU3",52,0)
 . I $G(DGMTYPT)=3,+^DGMT(408.21,IEN,"MT")'=+LTCIEN S IEN=""
"RTN","DGMTU3",53,0)
 ;
"RTN","DGMTU3",54,0)
 ; if veteran doesn't have a mt
"RTN","DGMTU3",55,0)
 I 'MTIEN D
"RTN","DGMTU3",56,0)
 . ; The following was added for LTC Copay Phase II (DG*5.3*433)
"RTN","DGMTU3",57,0)
 . ; If the IAI record is associated with a LTC Copay Test (type 3),
"RTN","DGMTU3",58,0)
 . ; don't return it if DGMTYPT is not type 3.
"RTN","DGMTU3",59,0)
 . S IEN="" F I=0:0 S I=$O(^DGMT(408.21,"AI",+REL,-YEAR,I)) Q:'I  S IEN=I Q:'$G(^DGMT(408.21,IEN,"MT"))  D  Q:IEN
"RTN","DGMTU3",60,0)
 .. I $P($G(^DGMT(408.31,+^DGMT(408.21,IEN,"MT"),0)),U,19)=3,$G(DGMTYPT)'=3 S IEN=""
"RTN","DGMTU3",61,0)
 .. ; If DGMTYPT=3 make sure the IAI record is associated with the
"RTN","DGMTU3",62,0)
 .. ; correct LTC Copay test. Added for LTC Phase III (DG*5.3*518)
"RTN","DGMTU3",63,0)
 .. I $G(DGMTYPT)=3,+^DGMT(408.21,IEN,"MT")'=+LTCIEN S IEN=""
"RTN","DGMTU3",64,0)
IAIQ Q $G(IEN)
"RTN","DGMTU3",65,0)
 ;
"RTN","DGMTU3",66,0)
 ;
"RTN","DGMTU3",67,0)
MTIENLT(TYPE,DFN,INVDTL) ; get last primary income test on or before date
"RTN","DGMTU3",68,0)
 ;
"RTN","DGMTU3",69,0)
 ; Input  -- TYPE as 1 for means test, 2 for copay test
"RTN","DGMTU3",70,0)
 ;           DFN as Patient IEN
"RTN","DGMTU3",71,0)
 ;           INVDTL as inverse date for search
"RTN","DGMTU3",72,0)
 ; Output -- Record IEN
"RTN","DGMTU3",73,0)
 ;
"RTN","DGMTU3",74,0)
 N K
"RTN","DGMTU3",75,0)
 S K=""
"RTN","DGMTU3",76,0)
 F  S INVDTL=$O(^DGMT(408.31,"AID",TYPE,DFN,INVDTL)) Q:'INVDTL  S K=$$MTIEN(TYPE,DFN,INVDTL) Q:K
"RTN","DGMTU3",77,0)
 Q K
"RTN","DGRPD")
0^1^B52296876
"RTN","DGRPD",1,0)
DGRPD ;ALB/MRL/MLR/JAN/LBD-PATIENT INQUIRY (NEW) ; 05/12/2003 4:05pm
"RTN","DGRPD",2,0)
 ;;5.3;Registration;**109,124,121,57,161,149,286,358,436,445,489,498,506,513,518**;Aug 13, 1993
"RTN","DGRPD",3,0)
 ;  *286*  Newing variables X,Y in OKLINE subroutine
"RTN","DGRPD",4,0)
 ;  *358*  If a patient is on a domiciliary ward, don't display MEANS
"RTN","DGRPD",5,0)
 ;         TEST required/Medication Copayment Exemption messages
"RTN","DGRPD",6,0)
 ;  *436*  If an inpatient is not on a domiciliary ward, don't display
"RTN","DGRPD",7,0)
 ;         Medication Copayment Exemption message
"RTN","DGRPD",8,0)
 ;
"RTN","DGRPD",9,0)
SEL K DFN,DGRPOUT W ! S DIC="^DPT(",DIC(0)="AEQMZ" D ^DIC G Q:Y'>0 S DFN=+Y N Y W ! S DIR(0)="E" D ^DIR G SEL:$D(DTOUT)!($D(DUOUT)) D EN G SEL
"RTN","DGRPD",10,0)
 ;
"RTN","DGRPD",11,0)
EN ;call to display patient inquiry - input DFN
"RTN","DGRPD",12,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",13,0)
 S DGCMOR="UNSPECIFIED",DGMPI=$G(^DPT(+DFN,"MPI"))
"RTN","DGRPD",14,0)
 S DGLOCATN=$$FIND1^DIC(4,"","MX","`"_+$P(DGMPI,U,3)),DGLOCATN=$S(+DGLOCATN>0:$P($$NS^XUAF4(DGLOCATN),U),1:"NOT LISTED")
"RTN","DGRPD",15,0)
 I $D(DGMPI),$D(DGLOCATN) S DGCMOR=$P(DGLOCATN,"^")
"RTN","DGRPD",16,0)
 ;END MPI/PD CHANGE
"RTN","DGRPD",17,0)
 K DGRPOUT,DGHOW S DGABBRV=$S($D(^DG(43,1,0)):+$P(^(0),"^",38),1:0),DGRPU="UNSPECIFIED" D DEM^VADPT,HDR F I=0,.11,.13,.121,.31,.32,.36,.361,.141 S DGRP(I)=$S($D(^DPT(DFN,I)):^(I),1:"")
"RTN","DGRPD",18,0)
 S DGAD=.11,(DGA1,DGA2)=1 D A^DGRPU S DGTMPAD=0 I $P(DGRP(.121),"^",9)="Y" S DGTMPAD=$S('$P(DGRP(.121),"^",8):1,$P(DGRP(.121),"^",8)'<DT:1,1:0) I DGTMPAD S DGAD=.121,DGA1=1,DGA2=2 D A^DGRPU
"RTN","DGRPD",19,0)
 W ?1,"Address: ",$S($D(DGA(1)):DGA(1),1:"NONE ON FILE"),?40,"Temporary: ",$S($D(DGA(2)):DGA(2),1:"NO TEMPORARY ADDRESS")
"RTN","DGRPD",20,0)
 S I=2 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>50) !?10 W:'(I#2) ?51 W DGA(I)
"RTN","DGRPD",21,0)
 S DGCC=+$P(DGRP(.11),U,7),DGST=+$P(DGRP(.11),U,5),DGCC=$S($D(^DIC(5,DGST,1,DGCC,0)):$E($P(^(0),U,1),1,20)_$S($P(^(0),U,3)]"":" ("_$P(^(0),U,3)_")",1:""),1:DGRPU) W !?2,"County: ",DGCC
"RTN","DGRPD",22,0)
 S X="NOT APPLICABLE" I DGTMPAD S Y=$P(DGRP(.121),U,7) X:Y]"" ^DD("DD") S X=$S(Y]"":Y,1:DGRPU)_"-",Y=$P(DGRP(.121),U,8) X:Y]"" ^DD("DD") S X=X_$S(Y]"":Y,1:DGRPU)
"RTN","DGRPD",23,0)
 W ?42,"From/To: ",X,!?3,"Phone: ",$S($P(DGRP(.13),U,1)]"":$P(DGRP(.13),U,1),1:DGRPU),?44,"Phone: ",$S('DGTMPAD:X,$P(DGRP(.121),U,10)]"":$P(DGRP(.121),U,10),1:DGRPU) K DGTMPAD
"RTN","DGRPD",24,0)
 W !?2,"Office: ",$S($P(DGRP(.13),U,2)]"":$P(DGRP(.13),U,2),1:DGRPU)
"RTN","DGRPD",25,0)
 W !,"Bad Addr: ",$$EXTERNAL^DILFD(2,.121,"",$$BADADR^DGUTL3(+DFN))
"RTN","DGRPD",26,0)
 D CA
"RTN","DGRPD",27,0)
 I 'DGABBRV W !!?4,"POS: ",$S($D(^DIC(21,+$P(DGRP(.32),"^",3),0)):$P(^(0),"^",1),1:DGRPU),?42,"Claim #: ",$S($P(DGRP(.31),"^",3)]"":$P(DGRP(.31),"^",3),1:"UNSPECIFIED")
"RTN","DGRPD",28,0)
 I 'DGABBRV W !?2,"Relig: ",$S($D(^DIC(13,+$P(DGRP(0),"^",8),0)):$P(^(0),"^",1),1:DGRPU),?46,"Sex: ",$S($P(VADM(5),"^",2)]"":$P(VADM(5),"^",2),1:"UNSPECIFIED")
"RTN","DGRPD",29,0)
 I 'DGABBRV W ! D
"RTN","DGRPD",30,0)
 .N RACE,ETHNIC,PTR,VAL,X,DIWL,DIWR,DIWF
"RTN","DGRPD",31,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",32,0)
 .S PTR=0 F  S PTR=+$O(^DPT(DFN,.02,PTR)) Q:'PTR  D
"RTN","DGRPD",33,0)
 ..S VAL=+$G(^DPT(DFN,.02,PTR,0))
"RTN","DGRPD",34,0)
 ..Q:$$INACTIVE^DGUTL4(VAL,1)
"RTN","DGRPD",35,0)
 ..S VAL=$$PTR2TEXT^DGUTL4(VAL,1) S:+$O(^DPT(DFN,.02,PTR)) VAL=VAL_", "
"RTN","DGRPD",36,0)
 ..S X=VAL,DIWL=0,DIWR=30,DIWF="" D ^DIWP
"RTN","DGRPD",37,0)
 .M RACE=^UTILITY($J,"W",0) S:$G(RACE(1,0))="" RACE(1,0)="UNANSWERED"
"RTN","DGRPD",38,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",39,0)
 .S PTR=0 F  S PTR=+$O(^DPT(DFN,.06,PTR)) Q:'PTR  D
"RTN","DGRPD",40,0)
 ..S VAL=+$G(^DPT(DFN,.06,PTR,0))
"RTN","DGRPD",41,0)
 ..Q:$$INACTIVE^DGUTL4(VAL,2)
"RTN","DGRPD",42,0)
 ..S VAL=$$PTR2TEXT^DGUTL4(VAL,2) S:+$O(^DPT(DFN,.06,PTR)) VAL=VAL_", "
"RTN","DGRPD",43,0)
 ..S X=VAL,DIWL=0,DIWR=30,DIWF="" D ^DIWP
"RTN","DGRPD",44,0)
 .M ETHNIC=^UTILITY($J,"W",0) S:$G(ETHNIC(1,0))="" ETHNIC(1,0)="UNANSWERED"
"RTN","DGRPD",45,0)
 .K ^UTILITY($J,"W")
"RTN","DGRPD",46,0)
 .W ?3,"Race: ",RACE(1,0),?40,"Ethnicity: ",ETHNIC(1,0)
"RTN","DGRPD",47,0)
 .F X=2:1 Q:'$D(RACE(X,0))&'$D(ETHNIC(X,0))  W !,?9,$G(RACE(X,0)),?51,$G(ETHNIC(X,0))
"RTN","DGRPD",48,0)
 I '$$OKLINE(16) G Q
"RTN","DGRPD",49,0)
 S X1=DGRP(.36),X=$P(DGRP(.361),"^",1) W !!,"Primary Eligibility: ",$S($D(^DIC(8,+X1,0)):$P(^(0),"^",1)_" ("_$S(X="V":"VERIFIED",X="P":"PENDING VERIFICATION",X="R":"PENDING REVERIFICATION",1:"NOT VERIFIED")_")",1:DGRPU)
"RTN","DGRPD",50,0)
 W !,"Other Eligibilities: " F I=0:0 S I=$O(^DIC(8,I)) Q:'I  I $D(^DIC(8,I,0)),I'=+X1 S X=$P(^(0),"^",1)_", " I $D(^DPT("AEL",DFN,I)) W:$X+$L(X)>79 !?21 W X
"RTN","DGRPD",51,0)
 ;
"RTN","DGRPD",52,0)
 ;display the catastrophic disability review date if there is one
"RTN","DGRPD",53,0)
 D CATDIS
"RTN","DGRPD",54,0)
 ;
"RTN","DGRPD",55,0)
 I $G(DGPRFLG)=1 G Q:'$$OKLINE(19) D
"RTN","DGRPD",56,0)
 . N DGPDT,DGPTM
"RTN","DGRPD",57,0)
 . W !,$$REPEAT^XLFSTR("-",78)
"RTN","DGRPD",58,0)
 . S DGPDT="",DGPDT=$O(^DGS(41.41,"ADC",DFN,DGPDT),-1)
"RTN","DGRPD",59,0)
 . W !,"[PRE-REGISTER DATE:]  "_$S(DGPDT]"":$$FMTE^XLFDT(DGPDT,"1D"),1:"NONE ON FILE")
"RTN","DGRPD",60,0)
 . S DGPTM=$$OUTPTTM^SDUTL3(DFN)
"RTN","DGRPD",61,0)
 . I $P(DGPTM,U,2)]"" W !,"[PRIMARY CARE TEAM:] "_$P(DGPTM,U,2)
"RTN","DGRPD",62,0)
 . W !,$$REPEAT^XLFSTR("-",78)
"RTN","DGRPD",63,0)
 ; Check if patient is an inpatient and on a DOM ward
"RTN","DGRPD",64,0)
 ; If inpatient is on a DOM ward, don't display MT or CP messages
"RTN","DGRPD",65,0)
 ; If inpatient is NOT on a DOM ward, don't display CP message
"RTN","DGRPD",66,0)
 N DGDOM,DGDOM1,VAHOW,VAROOT,VAINDT,VAIP,VAERR
"RTN","DGRPD",67,0)
 G Q:'$$OKLINE(14)
"RTN","DGRPD",68,0)
 D DOM^DGMTR
"RTN","DGRPD",69,0)
 I '$G(DGDOM) D
"RTN","DGRPD",70,0)
 .D DIS^DGMTU(DFN)
"RTN","DGRPD",71,0)
 .D IN5^VADPT
"RTN","DGRPD",72,0)
 .I $G(VAIP(1))="" D DISP^IBARXEU(DFN,DT,3,1)
"RTN","DGRPD",73,0)
 .D DIS^EASECU(DFN)   ;Added for LTC III (DG*5.3*518)
"RTN","DGRPD",74,0)
 ;I 'DGABBRV,$E(IOST,1,2)="C-" F I=$Y:1:20 W !
"RTN","DGRPD",75,0)
 S VAIP("L")=""
"RTN","DGRPD",76,0)
 I $$OKLINE(14) D INP
"RTN","DGRPD",77,0)
 I '$G(DGRPOUT),($$OKLINE(17)) D SA
"RTN","DGRPD",78,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",79,0)
Q D KVA^VADPT K %DT,D0,D1,DGA,DGA1,DGA2,DGABBRV,DGAD,DGCC,DGCMOR,DGDOM,DGLOCATN,DGMPI,DGRP,DGRPU,DGS,DGST,DGXFR0,DIC,DIR,DTOUT,DUOUT,DIRUT,DIROUT,I,I1,L,LDM,POP,SDCT,VA,X,X1,Y Q
"RTN","DGRPD",80,0)
CA ;Confidential Address
"RTN","DGRPD",81,0)
 W !!?1,"Confidential Address:  ",?44,"Confidential Address Categories:"
"RTN","DGRPD",82,0)
 N DGCABEG,DGCAEND,DGA,DGARRAY,DGERROR
"RTN","DGRPD",83,0)
 S DGCABEG=$P(DGRP(.141),U,7),DGCAEND=$P(DGRP(.141),U,8)
"RTN","DGRPD",84,0)
 I 'DGCABEG!(DGCABEG>DT)!(DGCAEND&(DGCAEND<DT)) D  Q
"RTN","DGRPD",85,0)
 .W !?9,"NO CONFIDENTIAL ADDRESS"
"RTN","DGRPD",86,0)
 .W !?1,"From/To: NOT APPLICABLE"
"RTN","DGRPD",87,0)
 S DGAD=.141,(DGA1,DGA2)=1
"RTN","DGRPD",88,0)
 D AL^DGRPU(30)
"RTN","DGRPD",89,0)
 D GETS^DIQ(2,DFN,".141*,","E","DGARRAY","DGERROR")
"RTN","DGRPD",90,0)
 ;Format Confidential Address categories
"RTN","DGRPD",91,0)
 N DGIEN,DGCAST
"RTN","DGRPD",92,0)
 S DGIEN=0
"RTN","DGRPD",93,0)
 S DGA2=2
"RTN","DGRPD",94,0)
 F  S DGIEN=$O(DGARRAY(2.141,DGIEN)) Q:'DGIEN  D
"RTN","DGRPD",95,0)
 .S DGA(DGA2)=DGARRAY(2.141,DGIEN,.01,"E")
"RTN","DGRPD",96,0)
 .S DGCAST=DGARRAY(2.141,DGIEN,1,"E")
"RTN","DGRPD",97,0)
 .S DGA(DGA2)=DGA(DGA2)_"("_$S(DGCAST="YES":"Active",1:"Inactive")_")"
"RTN","DGRPD",98,0)
 .S DGA2=DGA2+2
"RTN","DGRPD",99,0)
 S I=0 F I1=0:0 S I=$O(DGA(I)) Q:I=""  W:(I#2)!($X>43) !?9 W:'(I#2) ?44 W DGA(I)
"RTN","DGRPD",100,0)
 W !?1,"From/To:  ",$$FMTE^XLFDT(DGCABEG)_"-"_$S(DGCAEND'="":$$FMTE^XLFDT(DGCAEND),1:"UNANSWERED")
"RTN","DGRPD",101,0)
 Q
"RTN","DGRPD",102,0)
HDR I '$D(IOF) S IOP="HOME" D ^%ZIS K IOP
"RTN","DGRPD",103,0)
 ;MPI/PD CHANGE
"RTN","DGRPD",104,0)
 W @IOF,!,$P(VADM(1),"^",1),?40,$P(VADM(2),"^",2),?65,$P(VADM(3),"^",2) S X="",$P(X,"=",78)="" W !,X,!?15,"COORDINATING MASTER OF RECORD: ",DGCMOR,! Q
"RTN","DGRPD",105,0)
 ;END MPI/PD CHANGE
"RTN","DGRPD",106,0)
INP S VAIP("D")="L" D INP^DGPMV10
"RTN","DGRPD",107,0)
 S DGPMT=0
"RTN","DGRPD",108,0)
 D CS^DGPMV10 K DGPMT,DGPMIFN K:'$D(DGSWITCH) DGPMVI,DGPMDCD Q
"RTN","DGRPD",109,0)
SA F I=0:0 S I=$O(^DGS(41.1,"B",DFN,I)) G CL:'I S X=^DGS(41.1,I,0) I $P(X,"^",2)>(DT-1),$P(X,"^",13)']"",'$P(X,"^",17) S L=$P(X,"^",2) D:$$OKLINE(17) SAA Q:$G(DGRPOUT)
"RTN","DGRPD",110,0)
 Q
"RTN","DGRPD",111,0)
SAA ;Scheduled Admit Data
"RTN","DGRPD",112,0)
 W !!?14,"Scheduled Admit"
"RTN","DGRPD",113,0)
 W:$D(^DIC(42,+$P(X,U,8),0)) " on ward "_$P(^(0),U)
"RTN","DGRPD",114,0)
 W:$D(^DIC(45.7,+$P(X,U,9),0)) " for treating specialty "_$P(^(0),U)
"RTN","DGRPD",115,0)
 W " on "_$$FMTE^XLFDT(L,"5DZ")
"RTN","DGRPD",116,0)
 Q  ;SAA
"RTN","DGRPD",117,0)
 ;
"RTN","DGRPD",118,0)
CL G FA:$O(^DPT(DFN,"DE",0))="" S SDCT=0 F I=0:0 S I=$O(^DPT(DFN,"DE",I)) Q:'I  I $D(^(I,0)),$P(^(0),"^",2)'="I",$O(^(0)) S SDCT=SDCT+1 W:SDCT=1 !!,"Currently enrolled in " W:$X>50 !?22 W $S($D(^SC(+^(0),0)):$P(^(0),"^",1)_", ",1:"")
"RTN","DGRPD",119,0)
 ;
"RTN","DGRPD",120,0)
FA G:'$$OKLINE(20) RMK
"RTN","DGRPD",121,0)
 S CT=0 W !!,"Future Appointments: " I $O(^DPT(DFN,"S",DT))'>0 W "NONE" G RMK
"RTN","DGRPD",122,0)
 W ?22,"Date",?33,"Time",?39,"Clinic",!?22 F I=22:1:75 W "="
"RTN","DGRPD",123,0)
 F FA=DT:0 S FA=$O(^DPT(DFN,"S",FA)) G RMK:'FA S L=^(FA,0),C=+L I $P(L,"^",2)'["C" D COV D  Q:CT>5
"RTN","DGRPD",124,0)
 .N DGAPPT
"RTN","DGRPD",125,0)
 .S DGAPPT=$$FMTE^XLFDT($E(FA,1,12),"5Z")
"RTN","DGRPD",126,0)
 .W !?22,$P(DGAPPT,"@")
"RTN","DGRPD",127,0)
 .W ?33,$P(DGAPPT,"@",2)
"RTN","DGRPD",128,0)
 .W ?39,$P($S($D(^SC(C,0)):^(0),1:""),"^")," ",COV
"RTN","DGRPD",129,0)
 .Q
"RTN","DGRPD",130,0)
 I $O(^DPT(DFN,"S",FA))>0 W !,"See Scheduling options for additional appointments."
"RTN","DGRPD",131,0)
RMK I '$G(DGRPOUT),($$OKLINE(21)) W !!,"Remarks: ",$P(^DPT(DFN,0),"^",10)
"RTN","DGRPD",132,0)
 K ADM,L,TRN,DIS,SSN,FA,C,COV,NOW,CT,DGD,DGD1,I ;Y killed after dghinqky 
"RTN","DGRPD",133,0)
 Q
"RTN","DGRPD",134,0)
COV S COV=$S($P(L,"^",7)=7:" (Collateral) ",1:""),COV=COV_$S($P(L,"^",2)["NT":" * NO ACTION TAKEN *",$P(L,"^",2)["N":" * NO-SHOW *",1:""),CT=CT+1 Q
"RTN","DGRPD",135,0)
 Q
"RTN","DGRPD",136,0)
 ;
"RTN","DGRPD",137,0)
OREN S XQORQUIT=1 Q:'$D(ORVP)  S DFN=+ORVP D EN R !!,"Press RETURN to CONTINUE: ",X:DTIME
"RTN","DGRPD",138,0)
 Q
"RTN","DGRPD",139,0)
OKLINE(DGLINE) ;DOES PAUSE/HEADER IF $Y EXCEEDS DGLINE
"RTN","DGRPD",140,0)
 ;
"RTN","DGRPD",141,0)
 ;IN:   DGLINE --MAX LINE COUNT W/O PAUSE
"RTN","DGRPD",142,0)
 ;OUT:  DGLINE[RETURNED] -- 0 IF TIMEOUT/UP ARROW
"RTN","DGRPD",143,0)
 ;      DGRPOUT[SET]     -- 1 IF "
"RTN","DGRPD",144,0)
 N X,Y  ;**286** MLR 09/25/00  Newing X & Y variables prior to ^DIR
"RTN","DGRPD",145,0)
 I $G(IOST)["P-" Q DGLINE ; if printer, quit
"RTN","DGRPD",146,0)
 I $Y>DGLINE N DIR S DIR(0)="E" D ^DIR D:Y HDR I 'Y S DGRPOUT=1,DGLINE=0
"RTN","DGRPD",147,0)
 Q DGLINE
"RTN","DGRPD",148,0)
 ;
"RTN","DGRPD",149,0)
CATDIS ;
"RTN","DGRPD",150,0)
 ;displays catastrophic disabity review date if there is one
"RTN","DGRPD",151,0)
 N DGCDIS
"RTN","DGRPD",152,0)
 I $$GET^DGENCDA(DFN,.DGCDIS) D
"RTN","DGRPD",153,0)
 .Q:'DGCDIS("REVDTE")
"RTN","DGRPD",154,0)
 .W !!,"Catastrophically Disabled Review Date: ",$$FMTE^XLFDT(DGCDIS("REVDTE"),1)
"RTN","DGRPD",155,0)
 Q
"RTN","DGRPD",156,0)
 ;
"VER")
8.0^22
**END**
**END**
