$TXT Created by BECKWITH,RALPH at MNTVBB.FO-ALBANY.MED.VA.GOV  (KIDS) on Friday, 06/18/04 at 09:30
=============================================================================
Run Date: JUN 30, 2004                     Designation: ES*1*35
Package : ES - POLICE & SECURITY              Priority: Mandatory
Version : 1        SEQ #37                      Status: Released
                  Compliance Date: JUL 31, 2004
=============================================================================

Associated patches: (v)ES*1*4     <<= must be installed BEFORE `ES*1*35'
                    (v)ES*1*27     <<= must be installed BEFORE `ES*1*35'
                    (v)ES*1*33     <<= must be installed BEFORE `ES*1*35'

Subject: UNDEFINED ERROR WHEN GENERATING CRIME STAT REPORT

Category: 
  - Routine
  - Data Dictionary

Description:
============

 Numerous errors when printing ESP FACILITY REPORTS.
  
 ASSOCIATED NOIS:
 ================
  
 1)NTH-0703-71232  Numerous errors when printing ESP FACILITY REPORTS
     Duplicate:
        CPH-0104-42202  Crime report stats are not correct
        CPH-0204-40385  <UNDEFINED> VIO+7-ESPUCF
     Duplicates (but previously closed):
        UNY-0900-10774
        WCO-1101-51858
        TNV-1000-30280
        GRJ-0202-50950
        MEM-0103-71774
  
 ASSOCIATED E3RS:
 ================
  
 N/A
  
 PARTICIPATING TEST SITES:
 =========================
 Big Springs,Tx
 Central Plains HCS
 Dayton,OH
 White City,OR
  
 NOIS OVERVIEW
 =============
  
 1) NTH-0703-71232  Numerous errors when printing ESP FACILITY REPORTS
  
        Problem:
        --------
  
        1) When exercising the option:
         
        FACILITY REPORTS AND OPTIONS
            Generate Crime Stat by Facility 
         and
            Print Facility Crime Report
  
  
        An error occured when accumulating violation charges into the 
        ESP CRIME DATA FILE (#912.3). No records were created, because the 
        program was reading LOCATION field (#.07) in ESP VIOLATIONS FILE   
        (#914) that was defined in the data dictionary as a pointer and not
        a floating (address) field. The ESPUCF routine read the LOCATION 
        field (#.07) as null.
  
        Also, the reporting breakout had no facility to use for the 
        violation stat generation.
  
  
        
        Resolution:
        -----------
  
        1)  Added a new question to the violation option for FACILITY  
            associated with the violation to allow for statistical
            breakout for violations as well as offenses. Routine 
            modified was ESPUVN.
  
        2)  Changed the routine ESPUCF to read the ESP VIOLATIONS FILE
            (#914) FACILITY field (#.1) for facility associated with a
            violation.
  
        3)  Modified routine ESPUCFP to use a facility lookup to select
            certain facility stats or "ALL".  When selecting "ALL" the
            report will print each facility with activity and then a 
            summary section reflecting a total of all divisions reported.
  
         ********************* N O T E ************************
        
         This patch will only correctly report violation stats from
         the day the patch is installed forward.  Old violation data
         entries do not have the facility link needed for needed
         facility compilation.
         ******************************************************   
     
  
  ROUTINE SUMMARY:
  ================
  The following is a list of the routine(s) included in this patch.  The
  second line of each of these routine(s) will look like:
  
      <tab>;;1.0;POLICE & SECURITY;**[patch list]**;Mar 31, 1994
  
                             CHECK^XTSUMBLD results
  Routine name      Before Patch          After Patch         Patch List
  ============      ============          ===========         ==========
  ESPUCF                 7300822              10933152         27,33,35
  ESPUCFP                3010110               4676537            27,35
  ESPUCFP3              11311788              11296264            27,35
  ESPUVN                11176610              11698121             4,35
  
  
 DATA DICTIONARY CHANGES:
 FILE# 914 (ESP VIOLATION)
  
 Added:  
  
 914,.1        FACILITY           0;10 POINTER TO MEDICAL CENTER DIVISION
                                                      FILE (#40.8) (Required)
    
               LAST EDITED:      MAR 01, 2004 
               HELP-PROMPT:    Enter the Facility associated with this 
                                           violation. 
  
  
 INSTALLATION INSTRUCTIONS
 =========================
 This patch can be loaded with users on the system. Installation will
 take less than 1 minute. 
  
  1.  Choose the PackMan message containing this patch and invoke the 
      INSTALL/CHECK MESSAGE PackMan option.
  
  2.  (DSM for Open VMS sites only) Disable routine mapping on all systems
      for the routines listed in the Routine Summary.
   
      NOTE:  If the routines included in this patch are not currently
      in your mapped routine set, please skip this step.
   
  3.  Start up the Kernel Installation and Distribution System Menu 
      [XPD MAIN]: 
    
           Edits and Distribution ...  
           Utilities ...  
           Installation ...  
    
      Select Kernel Installation & Distribution System Option: INStallation
                                    
                                                                
           Load a Distribution 
           Print Transport Global 
           Compare Transport Global to Current System 
           Verify Checksums in Transport Global 
           Install Package(s) 
           Restart Install of Package(s) 
           Unload a Distribution 
           Backup a Transport Global  
  
  4.  From this menu, you may elect to use the following options
      (when prompted for the INSTALL NAME, enter ES*1.0*35):
  
      a.  Backup a Transport Global - This option will create a backup
          message of any routines exported with this patch. It will not
          backup any other changes such as DD's or templates.
      b.  Compare Transport Global to Current System - This option will
          allow you to view all changes that will be made when this patch
          is installed.  It compares all components of this patch
          (routines, DD's, templates, etc.).
      c.  Verify Checksums in Transport Global - This option will allow
          you to ensure the integrity of the routines that are in the
          transport global.
  
  5.  Use the Install Package(s) option and select the package ES*1.0*35.
  
      a.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
          YES//', answer NO (unless otherwise indicated).
      b.  When prompted 'Want to DISABLE Scheduled Options, Menu Options,
          and Protocols? YES//', answer NO.
  
  6.  (DSM for Open VMS sites only) Optional - Include the routines
      distributed with this patch in the mapped routine set.
     
      NOTE: This step is only necessary if you performed step 2 or if
      you wish to include the routines in your mapped set.

Routine Information:
====================

Routine Name:
  - ESPUCF

 ADDED @ COUNT+7:
         ..S DIC="40.8",DR="1",DA=+ESPINS,DIQ="STA",DIQ(0)="I" D EN^DIQ1
         ..S STN=$G(STA(40.8,DA,DR,"I"))
         ..K DA,DIC,DR,DIQ,STA
  
 BEFORE @ COUNT+8:
          ...S ^ESP(912.3,ESPIEN,1,ESPINS,0)=ESPINS
  
 AFTER @ COUNT+11:
          ...S ^ESP(912.3,ESPIEN,1,ESPINS,0)=ESPINS_"^"_STN
  
 BEFORE @ VIO+5:
          ..  S ESPINS=$P(^ESP(914,ESPOFN,0),U,7) Q:+ESPINS'>0
  
 AFTER @ VIO+5-7:
         ..  S ESPINS=$P($G(^ESP(914,ESPOFN,0)),U,10) S:ESPINS="" 
                ESPINS=$O(^DG(40.8,"C",$P($G(^ESP(914,ESPOFN,5)),U,
                1),"")) Q:ESPINS=""
         ..  S DIC=40.8,DR="1",DA=+ESPINS,DIQ="STA",DIQ(0)="I" D 
                EN^DIQ1 S STN=$G(STA(40.8,DA,DR,"I")) K DA,DIC,DR,
                DIQ,STA
         ..  I '$D(^ESP(912.3,ESPIEN,1,ESPINS)) S ^ESP(912.3,ESPIEN,
                1,ESPINS,0)=ESPINS_"^"_STN
  
 BEFORE @ VIO+7-23:
          ..  S ^(171)=^ESP(912.3,ESPIEN,1,ESPINS,171)+1
          ..  I ESPTYPE="C" S ^(172)=^ESP(912.3,ESPIEN,1,ESPINS,172)+1 D
          ...  I ESPCL'="M",ESPCL'="P" S 
                 ^(173)=^ESP(912.3,ESPIEN,1,ESPINS,173)+1
          ...  I ESPCL="M" S ^(174)=^ESP(912.3,ESPIEN,1,ESPINS,174)+1
          ...  I ESPCL="P" S ^(175)=^ESP(912.3,ESPIEN,1,ESPINS,175)+1
          ...  I ESPCAT="E"!(ESPCAT="PO") S 
                 ^(176)=^ESP(912.3,ESPIEN,1,ESPINS,176)+1
          ...  I ESPCAT="O"!(ESPCAT="") S 
                 ^(177)=^ESP(912.3,ESPIEN,1,ESPINS,177)+1
          ...  I ESPCAT="P" S ^(178)=^ESP(912.3,ESPIEN,1,ESPINS,178)+1
          ...  I ESPCAT="V" S ^(179)=^ESP(912.3,ESPIEN,1,ESPINS,179)+1
          ..  I ESPTYPE="V" S ^(180)=^ESP(912.3,ESPIEN,1,ESPINS,180)+1 D
          ...  I ESPCL'="M",ESPCL'="P" S 
                 ^(181)=^ESP(912.3,ESPIEN,1,ESPINS,181)+1
          ...  I ESPCL="M" S ^(182)=^ESP(912.3,ESPIEN,1,ESPINS,182)+1
          ...  I ESPCL="P" S ^(183)=^ESP(912.3,ESPIEN,1,ESPINS,183)+1
          ...  I ESPCAT="E"!(ESPCAT="PO") S 
                 ^(184)=^ESP(912.3,ESPIEN,1,ESPINS,184)+1
          ...  I ESPCAT="O"!(ESPCAT="") S 
                 ^(185)=^ESP(912.3,ESPIEN,1,ESPINS,185)+1
          ...  I ESPCAT="P" S ^(186)=^ESP(912.3,ESPIEN,1,ESPINS,186)+1
          ...  I ESPCAT="V" S ^(187)=^ESP(912.3,ESPIEN,1,ESPINS,187)+1
  
 AFTER @ VIO+10-26:
         ..  S ^ESP(912.3,ESPIEN,1,ESPINS,171)=$G(^ESP(912.3,
                  ESPIEN,1,ESPINS,171))+1
         ..  I ESPTYPE="C" S ^ESP(912.3,ESPIEN,1,ESPINS,172)
                  =$G(^ESP(912.3,ESPIEN,1,ESPINS,172))+1 D
         ...  I ESPCL'="M",ESPCL'="P" S ^ESP(912.3,ESPIEN,1,
                   ESPINS,173)=$G(^ESP(912.3,ESPIEN,1,ESPINS,
                   173))+1
         ...  I ESPCL="M" S ^ESP(912.3,ESPIEN,1,ESPINS,174)
                   =$G(^ESP(912.3,ESPIEN,1,ESPINS,174))+1
         ...  I ESPCL="P" S ^ESP(912.3,ESPIEN,1,ESPINS,175)
                   =$G(^ESP(912.3,ESPIEN,1,ESPINS,175))+1
         ...  I ESPCAT="E"!(ESPCAT="PO") S ^ESP(912.3,ESPIEN
                   ,1,ESPINS,176)=$G(^ESP(912.3,ESPIEN,1,ESPINS
                   ,176))+1
         ...  I ESPCAT="O"!(ESPCAT="") S ^ESP(912.3,ESPIEN,1,
                   ESPINS,177)=$G(^ESP(912.3,ESPIEN,1,ESPINS,
                   177))+1
         ...  I ESPCAT="P" S ^ESP(912.3,ESPIEN,1,ESPINS,178)
                   =$G(^ESP(912.3,ESPIEN,1,ESPINS,178))+1
         ...  I ESPCAT="V" S ^ESP(912.3,ESPIEN,1,ESPINS,179)
                   =$G(^ESP(912.3,ESPIEN,1,ESPINS,179))+1
         ..  I ESPTYPE="V" S ^ESP(912.3,ESPIEN,1,ESPINS,180)
                   =$G(^ESP(912.3,ESPIEN,1,ESPINS,180))+1 D
         ...  I ESPCL'="M",ESPCL'="P" S ^ESP(912.3,ESPIEN,1,
                   ESPINS,181) =$G(^ESP(912.3,ESPIEN,1,ESPINS
                   ,181))+1
         ...  I ESPCL="M" S ^ESP(912.3,ESPIEN,1,ESPINS,182)=
                   $G(^ESP(912.3,ESPIEN,1,ESPINS,182))+1
         ...  I ESPCL="P" S ^ESP(912.3,ESPIEN,1,ESPINS,183)=
                   $G(^ESP( 912.3,ESPIEN,1,ESPINS,183))+1
         ...  I ESPCAT="E"!(ESPCAT="PO") S ^ESP(912.3,ESPIEN,
                   1,ESPINS,184)=$G(^ESP(912.3,ESPIEN,1,ESPINS,
                   184))+1
         ...  I ESPCAT="O"!(ESPCAT="") S ^ESP(912.3,ESPIEN,1
                   ,ESPINS,185)=$G(^ESP(912.3,ESPIEN,1,ESPINS,
                   185))+1
         ...  I ESPCAT="P" S ^ESP(912.3,ESPIEN,1,ESPINS,186)=
                   $G(^ESP(912.3,ESPIEN,1,ESPINS,186))+1
         ...  I ESPCAT="V" S ^ESP(912.3,ESPIEN,1,ESPINS,187)=
                   $G(^ESP( 912.3,ESPIEN,1,ESPINS,187))+1

Routine Checksum:
10933152

Routine Name:
  - ESPUVN

 ADDED after tag TYPE+4:
 FAC     K DIC S DIC("A")="Select Facility: ",DIC(0)="QAEMZ", 
           DIC="^DG(40.8," D ^DIC
         G:$D(DTOUT)!$D(DUOUT)!(+Y'>0) EXIT
         S ESPFAC=+Y
  
 BEFORE @ DTO+2:
         D ^DIR K DIR G:$D(DIRUT) EXIT S ESPD(.02)=Y
  
 AFTER @ DTO+2:
         D ^DIR K DIR G:$D(DIRUT) EXIT S ESPD(.02)=Y,ESPD(.1)=ESPFAC
  
 BEFORE @ STUFF+4:
         S ^ESP(914,ESPVIO,0)=ESPVIO_"^"_ESPD(.02)_"^V^"_ESPD(.04)_"^"_
 ESPD(.05)_"^"_ESPD(.06)_"^"_ESPD(.07)_"^"_ESPD(.08)_"^"_ESPFN
  
 AFTER @ STUFF+4:
         S ^ESP(914,ESPVIO,0)=ESPVIO_"^"_ESPD(.02)_"^V^"_ESPD(.04)_"^"_
 ESPD(.05)_"^"_ESPD(.06)_"^"_ESPD(.07)_"^"_ESPD(.08)_"^"_ESPFN_"^"_ESPD(.1)
  
 BEFORE @ C+1:
         S ^ESP(914,ESPVIO,0)=ESPVIO_"^"_ESPD(.02)_"^C^"_ESPD(.04)_"^^"
 _ESPD(.06)_"^"_ESPD(.07)_"^"_ESPD(.08)_"^"_ESPFN
  
 AFTER @ C+1:
         S ^ESP(914,ESPVIO,0)=ESPVIO_"^"_ESPD(.02)_"^C^"_ESPD(.04)_"^^"
 _ESPD(.06)_"^"_ESPD(.07)_"^"_ESPD(.08)_"^"_ESPFN_"^"_ESPD(.1)
  
 BEFORE @ EXIT:
 EXIT    K ESPD,ESPFN,ESPTYPE,ESPVIO,ESPX,^TMP($J)
  
 AFTER @ EXIT:
 EXIT    K ESPFAC,ESPD,ESPFN,ESPTYPE,ESPVIO,ESPX,^TMP($J)

Routine Checksum:
11698121

Routine Name:
  - ESPUCFP

 ADDED @ DIV+1:
         I VAUTD=1 K ^ESP(912.3,ESPIEN,1,9999) S ^ESP(912.3,ESPIEN,1,
             "B",9999,9999)="",^ESP(912.3,ESPIEN,1,9999,0)=9999 D
         .  F ESPN=0:0 S ESPN=$O(^ESP(912.3,ESPIEN,1,ESPN)) Q:+ESPN
              =0!(ESPN=9999) D
         ..   F CTR=0:0 S CTR=$O(^ESP(912.3,ESPIEN,1,ESPN,CTR)) 
               Q:CTR=""  D
         ...    S CAMT=$G(^ESP(912.3,ESPIEN,1,ESPN,CTR))
         ...    S ^ESP(912.3,ESPIEN,1,9999,CTR)=$G(^ESP(912.3,ESPIEN,
                   1,9999,CTR))+CAMT
         K:VAUTD=1 CAMT,CTR
  
 ADDED @ PRT+1:
         S HOF=0,TFAC=0
  
 BEFORE @ START+3:
          F ESPN=0:0 S ESPN=$O(^ESP(912.3,ESPIEN,1,ESPN)) Q:ESPN'>0!  
            (END) D
  
 AFTER @ START+3:
         F ESPN=0:0 S ESPN=$O(^ESP(912.3,ESPIEN,1,ESPN)) 
            Q:ESPN=""!(END)!(+ESPN=0)  D
  
 ADDED @ START+5:
         .I TFAC=1,ESPN=9999 Q
         .S TFAC=TFAC+1
  
 BEFORE @ EX+1:
          K %ZIS,BEGDATE,DA,DIC,DIQ,DR,END,ESPIEN,ESPN,PAGE,TOT,X,Y,
             ^UTILITY("DIQ1",$J)
  
 AFTER @ EX+1:
         K %ZIS,BEGDATE,DA,DIC,DIQ,DR,END,ESPIEN,ESPN,HOF,PAGE,TFAC,
             TOT,X,Y,^UTILITY("DIQ1",$J)
  
 BEFORE @ HDR+2:
          S PAGE=PAGE+1 W @IOF,!?25,"DEPARTMENT OF VETERANS AFFAIRS",
               ?70,"PAGE ",$J(PAGE,3)
  
 AFTER @ HDR+2:
         S PAGE=PAGE+1 W:HOF=1 @IOF W !?25,"DEPARTMENT OF VETERANS 
              AFFAIRS",?70,"PAGE ",$J(PAGE,3)
 BEFORE @ HDR+3/4:
          S ESPFACI=$P(^ESP(912.3,ESPIEN,1,ESPN,0),U)
          S ESPFACI=$P($G(^DG(40.8,ESPFACI,0)),U,1)
  
 AFTER @ HDR+3/4:
         S:ESPN=9999 ESPFACI="*** ALL DIVISIONS ***"
         S:ESPN'=9999 ESPFACI=$P(^ESP(912.3,ESPIEN,1,ESPN,0),U),ESPFACI=
             $P($G(^DG(40.8,ESPFACI,0)),U)_" ("_$P($G(^ESP(912.3,ESPIEN,1,
             ESPN,0)),U,2)_")"
  
 ADDED @ HDR+10:
         S HOF=1

Routine Checksum:
4676537

Routine Name:
  - ESPUCFP3

 Before:
         I ESPBEG>2970930.2359 D
         . W ?40,"$1000 & Above                :  ",$G(^UTILITY("DIQ1",
               $J,912.31,DA,133.1,"E"))
  
 After:
         I ESPBEG>2970930.2359 D
         . W ?40,"$1000 & Above               :  ",$G(^UTILITY("DIQ1",
               $J,912.31,DA,133.1,"E"))
  
 Before:
         . W !?40,"< $1000                      :  ",$G(^UTILITY("DIQ1",
               $J,912.31,DA,134.1,"E"))
  
 After:
         . W !?40,"< $1000                     :  ",$G(^UTILITY("DIQ1",
               $J,912.31,DA,134.1,"E"))
  
 Before:
         I ESPBEG>2970930.2359 D
         . W ?40,"$1000 & Above                :  ",$G(^UTILITY("DIQ1",
               $J,912.31,DA,138.1,"E"))
  
 After:
         I ESPBEG>2970930.2359 D
         . W ?40,"$1000 & Above               :  ",$G(^UTILITY("DIQ1",
               $J,912.31,DA,138.1,"E"))
  
 Before:
         . W !?40,"< $1000                      :  ",$G(^UTILITY("DIQ1",
               $J,912.31,DA,139.1,"E"))
  
 After:
         . W !?40,"< $1000                     :  ",$G(^UTILITY("DIQ1",
               $J,912.31,DA,139.1,"E"))

Routine Checksum:
11296264

=============================================================================
User Information:
Entered By  : ROSSON,JERRY                  Date Entered  : DEC 31, 2002
Completed By: ILUSTRISIMO,LUCY              Date Completed: JUN 30, 2004
Released By : HUTCHINSON,PATRICIA ANN       Date Released : JUN 30, 2004
=============================================================================


Packman Mail Message:
=====================

$END TXT
