EMERGENCY Released HBH*1*12 SEQ #11
Extracted from mail message
**KIDS**:HBH*1.0*12^

**INSTALL NAME**
HBH*1.0*12
"BLD",1330,0)
HBH*1.0*12^HOSPITAL BASED HOME CARE^0^2980821^y
"BLD",1330,1,0)
^^5^5^2980909^^^^
"BLD",1330,1,1,0)
This patch will delete & re-create all FY98 visit information in HBHC VISIT
"BLD",1330,1,2,0)
(632) file from Outpatient Encounter (409.68) data.  Corresponding old file
"BLD",1330,1,3,0)
information is also cleaned up in files:  Transmit (634), Transmit History
"BLD",1330,1,4,0)
(634.6), Admission Errors (634.1), Visit Errors (634.2), Discharge Errors
"BLD",1330,1,5,0)
(634.3).
"BLD",1330,4,0)
^9.64PA^^0
"BLD",1330,"ABPKG")
n
"BLD",1330,"INIT")
HBHCPS12
"BLD",1330,"KRN",0)
^9.67PA^19^18
"BLD",1330,"KRN",.4,0)
.4
"BLD",1330,"KRN",.401,0)
.401
"BLD",1330,"KRN",.402,0)
.402
"BLD",1330,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",1330,"KRN",.403,0)
.403
"BLD",1330,"KRN",.5,0)
.5
"BLD",1330,"KRN",.84,0)
.84
"BLD",1330,"KRN",3.6,0)
3.6
"BLD",1330,"KRN",3.8,0)
3.8
"BLD",1330,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",1330,"KRN",9.2,0)
9.2
"BLD",1330,"KRN",9.8,0)
9.8
"BLD",1330,"KRN",9.8,"NM",0)
^9.68A^34^3
"BLD",1330,"KRN",9.8,"NM",2,0)
HBHCAPPT^^0^B25984397
"BLD",1330,"KRN",9.8,"NM",33,0)
HBHCXMV^^0^B28508729
"BLD",1330,"KRN",9.8,"NM",34,0)
HBHCPS12^^0^B23405667
"BLD",1330,"KRN",9.8,"NM","B","HBHCAPPT",2)

"BLD",1330,"KRN",9.8,"NM","B","HBHCPS12",34)

"BLD",1330,"KRN",9.8,"NM","B","HBHCXMV",33)

"BLD",1330,"KRN",19,0)
19
"BLD",1330,"KRN",19,"NM",0)
^9.68A^^0
"BLD",1330,"KRN",19.1,0)
19.1
"BLD",1330,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",1330,"KRN",101,0)
101
"BLD",1330,"KRN",101,"NM",0)
^9.68A^^
"BLD",1330,"KRN",409.61,0)
409.61
"BLD",1330,"KRN",771,0)
771
"BLD",1330,"KRN",869.2,0)
869.2
"BLD",1330,"KRN",870,0)
870
"BLD",1330,"KRN",8994,0)
8994
"BLD",1330,"KRN","B",.4,.4)

"BLD",1330,"KRN","B",.401,.401)

"BLD",1330,"KRN","B",.402,.402)

"BLD",1330,"KRN","B",.403,.403)

"BLD",1330,"KRN","B",.5,.5)

"BLD",1330,"KRN","B",.84,.84)

"BLD",1330,"KRN","B",3.6,3.6)

"BLD",1330,"KRN","B",3.8,3.8)

"BLD",1330,"KRN","B",9.2,9.2)

"BLD",1330,"KRN","B",9.8,9.8)

"BLD",1330,"KRN","B",19,19)

"BLD",1330,"KRN","B",19.1,19.1)

"BLD",1330,"KRN","B",101,101)

"BLD",1330,"KRN","B",409.61,409.61)

"BLD",1330,"KRN","B",771,771)

"BLD",1330,"KRN","B",869.2,869.2)

"BLD",1330,"KRN","B",870,870)

"BLD",1330,"KRN","B",8994,8994)

"BLD",1330,"QUES",0)
^9.62^^
"BLD",1330,"REQB",0)
^9.611^^
"INIT")
HBHCPS12
"PKG",216,-1)
1^1
"PKG",216,0)
HOSPITAL BASED HOME CARE^HBH^Hospital Based Home Care
"PKG",216,20,0)
^9.402P^^
"PKG",216,22,0)
^9.49I^1^1
"PKG",216,22,1,0)
1.0^2931101^2940314
"PKG",216,22,1,"PAH",1,0)
12^2980821^3779
"PKG",216,22,1,"PAH",1,1,0)
^^5^5^2980909
"PKG",216,22,1,"PAH",1,1,1,0)
This patch will delete & re-create all FY98 visit information in HBHC VISIT
"PKG",216,22,1,"PAH",1,1,2,0)
(632) file from Outpatient Encounter (409.68) data.  Corresponding old file
"PKG",216,22,1,"PAH",1,1,3,0)
information is also cleaned up in files:  Transmit (634), Transmit History
"PKG",216,22,1,"PAH",1,1,4,0)
(634.6), Admission Errors (634.1), Visit Errors (634.2), Discharge Errors
"PKG",216,22,1,"PAH",1,1,5,0)
(634.3).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","HBHCAPPT")
0^2^B25984397
"RTN","HBHCAPPT",1,0)
HBHCAPPT ; LR VAMC(IRMS)/MJT-HBHC batch job to create ^HBHC(632) (visit) nodes from PCE module info => patient, appointment date/time, hospital location (clinic), provider, diagnosis code(s), & CPT code(s), calls ^HBHCCAN ;9803
"RTN","HBHCAPPT",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**6,8,10,12**;NOV 01, 1993
"RTN","HBHCAPPT",3,0)
 ; Daily auto-queued option, also called from ^HBHCFILE, HBHCLSDT, last date to include in transmit set up in ^HBHCFILE
"RTN","HBHCAPPT",4,0)
 D START^HBHCAPP1
"RTN","HBHCAPPT",5,0)
SCAN ; Scan
"RTN","HBHCAPPT",6,0)
 N HBHCQRY
"RTN","HBHCAPPT",7,0)
 D OPEN^SDQ(.HBHCQRY)
"RTN","HBHCAPPT",8,0)
 D INDEX^SDQ(.HBHCQRY,"DATE/TIME","SET")
"RTN","HBHCAPPT",9,0)
 D DATE^SDQ(.HBHCQRY,HBHCBGDT,HBHCLSDT,"SET")
"RTN","HBHCAPPT",10,0)
 D SCANCB^SDQ(.HBHCQRY,"D CB^HBHCAPPT(Y,Y0,.SDSTOP)","SET")
"RTN","HBHCAPPT",11,0)
 D ACTIVE^SDQ(.HBHCQRY,"TRUE","SET")
"RTN","HBHCAPPT",12,0)
 D SCAN^SDQ(.HBHCQRY,"FORWARD")
"RTN","HBHCAPPT",13,0)
 D CLOSE^SDQ(.HBHCQRY)
"RTN","HBHCAPPT",14,0)
 I ($D(^HBHC(634.1,"B")))!($D(^HBHC(634.2,"B")))!($D(^HBHC(634.3,"B")))!($D(^HBHC(634.5,"B"))) D MAIL^HBHCAPP1
"RTN","HBHCAPPT",15,0)
 ; Delete File Update in Progress Flag
"RTN","HBHCAPPT",16,0)
 S $P(^HBHC(631.9,1,0),U,8)=""
"RTN","HBHCAPPT",17,0)
EXIT ; Exit module
"RTN","HBHCAPPT",18,0)
 D EXIT^HBHCAPP1
"RTN","HBHCAPPT",19,0)
 Q
"RTN","HBHCAPPT",20,0)
CB(HBHCOEP,HBHCSCE0,HBHCSTOP) ;
"RTN","HBHCAPPT",21,0)
 ; Omit Child encounter, (child if Parent Encounter field contains data)
"RTN","HBHCAPPT",22,0)
 Q:$P(HBHCSCE0,U,6)]""
"RTN","HBHCAPPT",23,0)
 ; Quit if invalid status for HBHC purposes
"RTN","HBHCAPPT",24,0)
 Q:($P(HBHCSCE0,U,12)=4)!($P(HBHCSCE0,U,12)=5)!($P(HBHCSCE0,U,12)=6)!($P(HBHCSCE0,U,12)=7)!($P(HBHCSCE0,U,12)=9)!($P(HBHCSCE0,U,12)=10)!($P(HBHCSCE0,U,12)=11)!($P(HBHCSCE0,U,12)=13)
"RTN","HBHCAPPT",25,0)
 ; Clinic missing
"RTN","HBHCAPPT",26,0)
 Q:$P(HBHCSCE0,U,4)=""
"RTN","HBHCAPPT",27,0)
 ; Include only HBHC clinics
"RTN","HBHCAPPT",28,0)
 Q:'$D(^HBHC(631.6,"B",$P(HBHCSCE0,U,4)))
"RTN","HBHCAPPT",29,0)
 S HBHCCLN=$P(HBHCSCE0,U,4)
"RTN","HBHCAPPT",30,0)
 D VERIFY I 'HBHCFLG D PROCESS D:$D(HBHCMSG) ERROR^HBHCAPP1
"RTN","HBHCAPPT",31,0)
 Q
"RTN","HBHCAPPT",32,0)
VERIFY ; Verify node doesn't already exist in ^HBHC(632) file
"RTN","HBHCAPPT",33,0)
 S HBHCFLG=0,HBHCDPT=$P(HBHCSCE0,U,2),HBHCAPDT=$P(HBHCSCE0,U)
"RTN","HBHCAPPT",34,0)
 I HBHCDPT="" S HBHCFLG=1 Q
"RTN","HBHCAPPT",35,0)
 S HBHCBXRF=0 F  S HBHCBXRF=$O(^HBHC(632,"B",HBHCDPT,HBHCBXRF)) Q:(HBHCBXRF'>0)!(HBHCFLG)  S:(HBHCAPDT=$P(^HBHC(632,HBHCBXRF,0),U,2))&('$D(^HBHC(632,"AC","C",HBHCBXRF))) HBHCFLG=1
"RTN","HBHCAPPT",36,0)
 Q
"RTN","HBHCAPPT",37,0)
PROCESS ; Process provider, diagnosis (Dx) (limit: 5), & CPT code (limit: 10) data
"RTN","HBHCAPPT",38,0)
 ; Dx
"RTN","HBHCAPPT",39,0)
 K HBHCDXL
"RTN","HBHCAPPT",40,0)
 F HBHCI=1:1:5 S HBHCDX(HBHCI)="",HBHCCNT=1
"RTN","HBHCAPPT",41,0)
 D GETDX^SDOE(HBHCOEP,"HBHCDXL")
"RTN","HBHCAPPT",42,0)
 S HBHCDFN=0 F  S HBHCDFN=$O(HBHCDXL(HBHCDFN)) Q:(HBHCDFN'>0)!(HBHCCNT>5)  S:$P(HBHCDXL(HBHCDFN),U,12)="P" HBHCDX(1)=$P(HBHCDXL(HBHCDFN),U) S:$P(HBHCDXL(HBHCDFN),U,12)="S" HBHCCNT=HBHCCNT+1,HBHCDX(HBHCCNT)=$P(HBHCDXL(HBHCDFN),U)
"RTN","HBHCAPPT",43,0)
 ; Dx missing
"RTN","HBHCAPPT",44,0)
 I (+$G(HBHCDXL)'>0) S HBHCMSG=3 Q
"RTN","HBHCAPPT",45,0)
 ; Dx > 5
"RTN","HBHCAPPT",46,0)
 I (+$G(HBHCDXL)>5) S HBHCMSG=6 Q
"RTN","HBHCAPPT",47,0)
 ; provider, use Encounter Provider (field 1204, file 9000010.18) or V Provider (9000010.06) (if encounter provider doesn't exist), each provider within encounter will become a separate HBHC Visit record
"RTN","HBHCAPPT",48,0)
 K HBHCPRV1,HBHCPRVL
"RTN","HBHCAPPT",49,0)
 D GETPRV^SDOE(HBHCOEP,"HBHCPRVL")
"RTN","HBHCAPPT",50,0)
 S (HBHCPCNT,HBHCDFN,HBHCONE)=0 F  S HBHCDFN=$O(HBHCPRVL(HBHCDFN)) Q:HBHCDFN'>0  S HBHCPRV=$P(HBHCPRVL(HBHCDFN),U) D CHECK S:HBHCONE=1 HBHCPCNT=HBHCPCNT+1,HBHCPRV1(HBHCPRV)=""
"RTN","HBHCAPPT",51,0)
 ; Provider missing
"RTN","HBHCAPPT",52,0)
 I (+$G(HBHCPRVL)'>0) S HBHCMSG=2 Q
"RTN","HBHCAPPT",53,0)
 ; HBHC provider missing
"RTN","HBHCAPPT",54,0)
 I HBHCONE=0 S HBHCMSG=11 Q
"RTN","HBHCAPPT",55,0)
 ; Provider > 10
"RTN","HBHCAPPT",56,0)
 I (+$G(HBHCPRVL)>10) S HBHCMSG=10 Q
"RTN","HBHCAPPT",57,0)
 ; Multiple HBHC provider numbers
"RTN","HBHCAPPT",58,0)
 I HBHCONE>1 S HBHCMSG=12 Q
"RTN","HBHCAPPT",59,0)
 ; CPT Code 
"RTN","HBHCAPPT",60,0)
 K HBHCCPTL,HBHCPRV
"RTN","HBHCAPPT",61,0)
 D GETCPT^SDOE(HBHCOEP,"HBHCCPTL")
"RTN","HBHCAPPT",62,0)
 S (HBHCTOT,HBHCDFN,HBHCONE)=0 F  S HBHCDFN=$O(HBHCCPTL(HBHCDFN)) Q:(HBHCDFN'>0)!(HBHCTOT>10)  S HBHCPRV=$P($G(^AUPNVCPT(HBHCDFN,12)),U,4) D:HBHCPRV]"" CHECK S HBHCNBR=$P(HBHCCPTL(HBHCDFN),U,16),HBHCTOT=HBHCTOT+HBHCNBR D:HBHCTOT<11 PROV
"RTN","HBHCAPPT",63,0)
 ; Provider ambiguous
"RTN","HBHCAPPT",64,0)
 I $D(HBHCPRV("ZZ")) S HBHCMSG=5 Q
"RTN","HBHCAPPT",65,0)
 ; CPT Code missing
"RTN","HBHCAPPT",66,0)
 I HBHCTOT=0 S HBHCMSG=4 Q
"RTN","HBHCAPPT",67,0)
 ; CPT Code > 10
"RTN","HBHCAPPT",68,0)
 I HBHCTOT>10 S HBHCMSG=7 Q
"RTN","HBHCAPPT",69,0)
 ; outpatient encounter must have 'checked-out' status (2) to ensure provider, Dx, & CPT data exist, or inpatient status (8)
"RTN","HBHCAPPT",70,0)
 I ($P(HBHCSCE0,U,12)'=2)&($P(HBHCSCE0,U,12)'=8) S HBHCMSG=1 Q
"RTN","HBHCAPPT",71,0)
SET ; Set node, call ^DIK to set cross-refs in ^HBHC(632) (visit) file
"RTN","HBHCAPPT",72,0)
 S HBHCPRV="" F  S HBHCPRV=$O(HBHCPRV(HBHCPRV)) Q:HBHCPRV=""  D SETLOOP
"RTN","HBHCAPPT",73,0)
 Q
"RTN","HBHCAPPT",74,0)
SETLOOP ; Set loop
"RTN","HBHCAPPT",75,0)
 S (HBHCINFO,HBHCCPT)="" F  S HBHCCPT=$O(HBHCPRV(HBHCPRV,HBHCCPT)) Q:HBHCCPT=""  S HBHCNBR="" F  S HBHCNBR=$O(HBHCPRV(HBHCPRV,HBHCCPT,HBHCNBR)) Q:HBHCNBR=""  S:HBHCINFO]"" HBHCINFO=HBHCINFO_U_HBHCCPT S:HBHCINFO="" HBHCINFO=HBHCCPT
"RTN","HBHCAPPT",76,0)
 S HBHC="",HBHC=$O(^HBHC(631.4,"C",HBHCPRV,HBHC))
"RTN","HBHCAPPT",77,0)
 L +^HBHC(632,0) F  S HBHCDFN=$P(^HBHC(632,0),U,3)+1,$P(^HBHC(632,0),U,3)=HBHCDFN Q:'$D(^HBHC(632,HBHCDFN,0))
"RTN","HBHCAPPT",78,0)
 S $P(^HBHC(632,0),U,4)=$P(^HBHC(632,0),U,4)+1 L -^HBHC(632,0)
"RTN","HBHCAPPT",79,0)
 L +^HBHC(632,HBHCDFN,1) S ^HBHC(632,HBHCDFN,1)=HBHCINFO L -^HBHC(632,HBHCDFN,1)
"RTN","HBHCAPPT",80,0)
 L +^HBHC(632,HBHCDFN,0) S ^HBHC(632,HBHCDFN,0)=HBHCDPT_U_HBHCAPDT_U_HBHCCLN_U_HBHC_U_U_U_U_"N"_U_U_U_U_U_U_U_U_U_HBHCDX(1)_U_HBHCDX(2)_U_HBHCDX(3)_U_HBHCDX(4)_U_HBHCDX(5)_U_HBHCOEP L -^HBHC(632,HBHCDFN,0)
"RTN","HBHCAPPT",81,0)
 K DIK S DIK="^HBHC(632,",DA=HBHCDFN D IX^DIK K DIK
"RTN","HBHCAPPT",82,0)
 Q
"RTN","HBHCAPPT",83,0)
PROV ; encounter provider & CPT code processing
"RTN","HBHCAPPT",84,0)
 S:HBHCPCNT=1 HBHCTXT="",HBHCTXT=$O(HBHCPRV1(HBHCTXT))
"RTN","HBHCAPPT",85,0)
 F HBHCJ=1:1:HBHCNBR S:HBHCPRV="" HBHCPRV($S(HBHCPCNT=1:HBHCTXT,1:"ZZ"),$P(HBHCCPTL(HBHCDFN),U),HBHCJ)="" I HBHCPRV]"" S:HBHCONE=1 HBHCPRV(HBHCPRV,$P(HBHCCPTL(HBHCDFN),U),HBHCJ)=""
"RTN","HBHCAPPT",86,0)
 Q
"RTN","HBHCAPPT",87,0)
CHECK ; Check to ensure provider only has 1 HBHC Provider Number (631.4) or if > 1, has others flagged as Inactive Provider Numbers
"RTN","HBHCAPPT",88,0)
 S (HBHCONE,HBHCIEN)=0 F  S HBHCIEN=$O(^HBHC(631.4,"C",HBHCPRV,HBHCIEN)) Q:(HBHCIEN'>0)!(HBHCONE>1)  S:'$D(^HBHC(631.4,"AC",1,HBHCIEN)) HBHCONE=HBHCONE+1
"RTN","HBHCAPPT",89,0)
 Q
"RTN","HBHCPS12")
0^34^B23405667
"RTN","HBHCPS12",1,0)
HBHCPS12 ; LR VAMC(IRMS)/MJT-HBHC POST initialization routine, re-create visits for FY98 in HBHC(632 file, cleanup corresponding files, send IRM message when complete ;9808
"RTN","HBHCPS12",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**12**;NOV 01, 1993
"RTN","HBHCPS12",3,0)
 ; Modeles copied from HBHCFILE routine:  POP, EXIT1 (EXIT renamed EXIT1), MAIL
"RTN","HBHCPS12",4,0)
 S HBHCDUZ=DUZ
"RTN","HBHCPS12",5,0)
6314 ; Retain IENs w/Inactive Provider Number (field 6, file 631.4) in HBHC Provider
"RTN","HBHCPS12",6,0)
 ; Count number of provider numbers per provider, create local array
"RTN","HBHCPS12",7,0)
 S HBHCPRV=0 F  S HBHCPRV=$O(^HBHC(631.4,"C",HBHCPRV)) Q:HBHCPRV'>0  S HBHCIEN=0 F  S HBHCIEN=$O(^HBHC(631.4,"C",HBHCPRV,HBHCIEN)) Q:HBHCIEN'>0  D ARRAY
"RTN","HBHCPS12",8,0)
 ; Check to see whether provider has unique 'Active' provider number (HBHCFLAG = 1 if yes)
"RTN","HBHCPS12",9,0)
 S HBHCPRV=0 F  S HBHCPRV=$O(HBHC6314(HBHCPRV)) Q:HBHCPRV'>0  D LOOP2 K HBHC6314(HBHCPRV) S:HBHCFLAG=0 HBHC6314(HBHCPRV)=1,HBHC6314(HBHCPRV,HBHCLAST)=""
"RTN","HBHCPS12",10,0)
 ; Delete 'Active' & Unique provider number entries from local array, leaving local array of records to be processed (delete Inactive)
"RTN","HBHCPS12",11,0)
 S HBHCPRV=0 F  S HBHCPRV=$O(HBHC6314(HBHCPRV)) Q:HBHCPRV'>0  S HBHCIEN=0 F  S HBHCIEN=$O(HBHC6314(HBHCPRV,HBHCIEN)) Q:HBHCIEN'>0  S $P(^HBHC(631.4,HBHCIEN,0),U,7)="" K ^HBHC(631.4,"AC",1,HBHCIEN)
"RTN","HBHCPS12",12,0)
PARAM ; Retain/Set Number of Visit Days to Scan (field 3, file 631.9) System Parameter 
"RTN","HBHCPS12",13,0)
 S HBHCMJ=$P(^HBHC(631.9,1,0),U,4)
"RTN","HBHCPS12",14,0)
 S $P(^HBHC(631.9,1,0),U,4)=365
"RTN","HBHCPS12",15,0)
 ; Variable needed by HBHCFILE routine
"RTN","HBHCPS12",16,0)
 S HBHCLSDT=$S($E(DT,4,5)>9:2980930.9999,1:2980831.9999)
"RTN","HBHCPS12",17,0)
 ; Variable needed by HBHCAPPT routine
"RTN","HBHCPS12",18,0)
 S HBHCFLAG=1
"RTN","HBHCPS12",19,0)
 S ZTIO="",ZTDTH=$H,ZTRTN="DQ^HBHCPS12",ZTSAVE("HBHC*")="",ZTDESC="HBHC Patch 12 Post Install" D ^%ZTLOAD
"RTN","HBHCPS12",20,0)
 W $C(7),!!,"HBHC Patch 12 Post Install processing has been queued.  Task number:  ",ZTSK H 3
"RTN","HBHCPS12",21,0)
 G EXIT
"RTN","HBHCPS12",22,0)
DQ ; De-queue entry point
"RTN","HBHCPS12",23,0)
632 ; Delete FY98 entries from 632 (Visit) file
"RTN","HBHCPS12",24,0)
 S DIK="^HBHC(632,",HBHCDAT=2970930.9999999 F  S HBHCDAT=$O(^HBHC(632,"C",HBHCDAT)) Q:HBHCDAT'>0  S DA=0 F  S DA=$O(^HBHC(632,"C",HBHCDAT,DA)) Q:DA'>0  D ^DIK
"RTN","HBHCPS12",25,0)
634 ; Delete entries from 634 (Transmit) file
"RTN","HBHCPS12",26,0)
 K ^HBHC(634) S ^HBHC(634,0)="HBHC TRANSMIT^634"
"RTN","HBHCPS12",27,0)
6341 ; Delete entries from 634.1 (Admission Errors) file 
"RTN","HBHCPS12",28,0)
 K ^HBHC(634.1) S ^HBHC(634.1,0)="HBHC EVALUATION/ADMISSION ERROR(S)^634.1"
"RTN","HBHCPS12",29,0)
6342 ; Delete entries from 634.2 (Visit Errors) file 
"RTN","HBHCPS12",30,0)
 K ^HBHC(634.2) S ^HBHC(634.2,0)="HBHC VISIT ERROR(S)^634.2P"
"RTN","HBHCPS12",31,0)
6343 ; Delete entries from 634.3 (Discharge Errors) file 
"RTN","HBHCPS12",32,0)
 K ^HBHC(634.3) S ^HBHC(634.3,0)="HBHC DISCHARGE ERROR(S)^634.3"
"RTN","HBHCPS12",33,0)
6346 ; Delete FY98 entries from 634.6 (Transmit History) file
"RTN","HBHCPS12",34,0)
 S DIK="^HBHC(634.6,",HBHCDAT=2970930 F  S HBHCDAT=$O(^HBHC(634.6,"C",HBHCDAT)) Q:HBHCDAT'>0  S DA=0 F  S DA=$O(^HBHC(634.6,"C",HBHCDAT,DA)) Q:DA'>0  D ^DIK
"RTN","HBHCPS12",35,0)
CREATE ; Re-create visits for FY98 from Outpatient Encounter (409.68) file data, update Transmit (634) file &/or error files (634.1 thru 634.3)
"RTN","HBHCPS12",36,0)
POP ; Populate ^HBHC(634) or ^HBHC(634.1/634.2/634.3/634.5 Error files
"RTN","HBHCPS12",37,0)
 D ^HBHCAPPT,^HBHCXMC,^HBHCXMA,^HBHCXMV,^HBHCXMD
"RTN","HBHCPS12",38,0)
 ; Send mail message
"RTN","HBHCPS12",39,0)
 D:('$D(^HBHC(634.1,"B")))&('$D(^HBHC(634.2,"B")))&('$D(^HBHC(634.3,"B")))&('$D(^HBHC(634.5,"B"))) MAIL
"RTN","HBHCPS12",40,0)
EXIT1 ; Exit module
"RTN","HBHCPS12",41,0)
 L -^HBHC(634.5,0)
"RTN","HBHCPS12",42,0)
 K DA,DIE,DIR,DIRUT,DR,DTOUT,DUOUT,HBHCAPDT,HBHCCKDT,HBHCDAT,HBHCDAYS,HBHCDTE,HBHCDIR,HBHCFLAG,HBHCLEAP,HBHCLSDT,HBHCNOW,HBHCSTDT,HBHCYEAR,%,TMP,X,X1,X2,Y
"RTN","HBHCPS12",43,0)
 ; Reset Inactive Provider Number (field 6, file 631.4) in HBHC Provider
"RTN","HBHCPS12",44,0)
 S HBHCPRV=0 F  S HBHCPRV=$O(HBHC6314(HBHCPRV)) Q:HBHCPRV'>0  S HBHCIEN=0 F  S HBHCIEN=$O(HBHC6314(HBHCPRV,HBHCIEN)) Q:HBHCIEN'>0  S $P(^HBHC(631.4,HBHCIEN,0),U,7)=1 S ^HBHC(631.4,"AC",1,HBHCIEN)=""
"RTN","HBHCPS12",45,0)
 ; Reset Number of Visit Days to Scan (field 3, file 631.9) System Parameter 
"RTN","HBHCPS12",46,0)
 S $P(^HBHC(631.9,1,0),U,4)=HBHCMJ
"RTN","HBHCPS12",47,0)
MAILIRM ; Send mail message to IRM
"RTN","HBHCPS12",48,0)
 S TMP(1)="HBH*1*12 post installation is complete.  Please inform HBPC Users.",XMDUZ="HBHC Post Install",XMSUB="HBH*1*12 Post Install Complete",XMY(HBHCDUZ)="",XMTEXT="TMP("
"RTN","HBHCPS12",49,0)
 N DIFROM
"RTN","HBHCPS12",50,0)
 D ^XMD
"RTN","HBHCPS12",51,0)
EXIT ; Exit module
"RTN","HBHCPS12",52,0)
 K HBHCDAT,HBHCDTE,HBHCDUZ,HBHCIEN,HBHCFLAG,HBHCLAST,HBHCLSDT,HBHCMJ,HBHCNOW,HBHCPRV,HBHC6314
"RTN","HBHCPS12",53,0)
 Q
"RTN","HBHCPS12",54,0)
ARRAY ; Set HBHC6314 array
"RTN","HBHCPS12",55,0)
 S:$D(HBHC6314(HBHCPRV)) HBHC6314(HBHCPRV)=HBHC6314(HBHCPRV)+1
"RTN","HBHCPS12",56,0)
 S:'$D(HBHC6314(HBHCPRV)) HBHC6314(HBHCPRV)=1
"RTN","HBHCPS12",57,0)
 S HBHC6314(HBHCPRV,HBHCIEN)=""
"RTN","HBHCPS12",58,0)
 Q
"RTN","HBHCPS12",59,0)
LOOP2 ; Loop 2, determine whether record is Inactive or has Unique provider number
"RTN","HBHCPS12",60,0)
 S (HBHCFLAG,HBHCIEN)=0 F  S HBHCIEN=$O(HBHC6314(HBHCPRV,HBHCIEN)) Q:(HBHCIEN'>0)!(HBHCFLAG=1)  S HBHCLAST=HBHCIEN S:$P(^HBHC(631.4,HBHCIEN,0),U,7)="" HBHCFLAG=1
"RTN","HBHCPS12",61,0)
 Q
"RTN","HBHCPS12",62,0)
MAIL ; Send completed mail message
"RTN","HBHCPS12",63,0)
 S TMP(1)=$P(HBHCDAT,"@")_" HBHC Build Transmit File is complete with no errors found.",TMP(2)="",TMP(3)="   Number of Visit Days to Scan system parameter:  "_$P(^HBHC(631.9,1,0),U,4),TMP(4)=""
"RTN","HBHCPS12",64,0)
 S Y=$P($P(HBHCDTE,U),"@") X ^DD("DD") S HBHCINFO=Y,Y=$P($P(HBHCDTE,U,2),"@") X ^DD("DD") S TMP(5)="   Date range:  "_$P(HBHCINFO,"@")_"  thru  "_$P(Y,"@"),TMP(6)=""
"RTN","HBHCPS12",65,0)
 D NOW^%DTC S Y=% X ^DD("DD")
"RTN","HBHCPS12",66,0)
 S TMP(7)="   Start time:  "_$P(HBHCDAT,"@",2)_"   End time:  "_$P(Y,"@",2)_"   Elapsed minutes:  "_($E(%_"000",9,10)-$E(HBHCNOW_"000",9,10)*60+$E(%_"00000",11,12)-$E(HBHCNOW_"00000",11,12)),TMP(8)=""
"RTN","HBHCPS12",67,0)
 S TMP(9)="*****   Reminder:  Please run Transmit File to Austin option.   *****"
"RTN","HBHCPS12",68,0)
 S XMDUZ="HBHC Build Transmit File Mail Group",XMSUB=$P(HBHCDAT,"@")_" HBHC Build Transmit File",XMY(DUZ)="",XMTEXT="TMP("
"RTN","HBHCPS12",69,0)
 N DIFROM
"RTN","HBHCPS12",70,0)
 D ^XMD
"RTN","HBHCPS12",71,0)
 Q
"RTN","HBHCXMV")
0^33^B28508729
"RTN","HBHCXMV",1,0)
HBHCXMV ; LR VAMC(IRMS)/MJT-HBHC populate ^HBHC(634 with Visit Data, or ^HBHC(634.5, file of recs in ^HBHC(632 w/pseudo SSNs, called by ^HBHCFILE, calls HBHCXMV1 ;2/5/98  15:20
"RTN","HBHCXMV",2,0)
 ;;1.0;HOSPITAL BASED HOME CARE;**2,5,6,9,12**;NOV 01, 1993
"RTN","HBHCXMV",3,0)
 D START^HBHCXMV1
"RTN","HBHCXMV",4,0)
LOOP ; Loop thru ^HBHC(632) "AC","N" cross-ref to create nodes in ^HBHC(634) => transmit
"RTN","HBHCXMV",5,0)
 S HBHCDFN="" F  S HBHCDFN=$O(^HBHC(632,"AC","N",HBHCDFN)) Q:HBHCDFN=""  D SETNODE
"RTN","HBHCXMV",6,0)
EXIT ; Exit module
"RTN","HBHCXMV",7,0)
 D EXIT^HBHCXMV1
"RTN","HBHCXMV",8,0)
 Q
"RTN","HBHCXMV",9,0)
SETNODE ; Set node in ^HBHC(634) (Transmit)
"RTN","HBHCXMV",10,0)
 S HBHCINFO=^HBHC(632,HBHCDFN,0),HBHCXMT4=$P(HBHCINFO,U,8),HBHCAPDT=$P(HBHCINFO,U,2),HBHCSSN=$P(^DPT($P(HBHCINFO,U),0),U,9)
"RTN","HBHCXMV",11,0)
 Q:$P(HBHCINFO,U,7)]""  ; cancelled/no show appointment
"RTN","HBHCXMV",12,0)
 Q:HBHCAPDT>HBHCLSDT  ; Visit appointment date > HBHCLSDT (last date to include in transmit set up in ^HBHCFILE)
"RTN","HBHCXMV",13,0)
 I HBHCAPDT<2961001 D PCE^HBHCXMV1 Q
"RTN","HBHCXMV",14,0)
 I HBHCSSN'?9N D PSSN^HBHCXMV1 Q
"RTN","HBHCXMV",15,0)
 S HBHCPRV=+^HBHC(631.4,$P(HBHCINFO,U,4),0) S:$L(HBHCPRV)'=4 HBHCPRV=HBHCPRV_HBHCSP1
"RTN","HBHCXMV",16,0)
 S HBHCTIME=$P(HBHCAPDT,".",2) S:$L(HBHCTIME)<4 HBHCTIME=HBHCTIME_$E(HBHCZRO4,1,(4-($L(HBHCTIME)))) S:$L(HBHCTIME)>4 HBHCTIME=$E(HBHCTIME,1,4)
"RTN","HBHCXMV",17,0)
 S HBHCDATE=$E(HBHCAPDT,4,5)_$E(HBHCAPDT,6,7)_(1700+$E(HBHCAPDT,1,3))_HBHCTIME
"RTN","HBHCXMV",18,0)
 S HBHCLNME=$P($P(^DPT($P(HBHCINFO,U),0),U),",") S:$L(HBHCLNME)'=11 HBHCLNME=$S($L(HBHCLNME)<11:HBHCLNME_$E(HBHCSP10,1,11-$L(HBHCLNME)),1:$E(HBHCLNME,1,11))
"RTN","HBHCXMV",19,0)
 S HBHCQAI=$S(($L($P(HBHCINFO,U,16))=1)&($E(HBHCINFO,U,16)=""):HBHCSP1_$P(HBHCINFO,U,16),($L($P(HBHCINFO,U,16))=1)&($E(HBHCINFO,U,16)]""):$P(HBHCINFO,U,16)_HBHCSP1,$L($P(HBHCINFO,U,16))=2:$P(HBHCINFO,U,16),1:HBHCSP2)
"RTN","HBHCXMV",20,0)
 ; Dx
"RTN","HBHCXMV",21,0)
 S HBHCDX1=$S($P(HBHCINFO,U,17)]"":$P($P($G(^ICD9($P(HBHCINFO,U,17),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,17),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX1)'=6 HBHCDX1=HBHCDX1_$E(HBHCSP6,1,6-$L(HBHCDX1))
"RTN","HBHCXMV",22,0)
 S HBHCDX2=$S($P(HBHCINFO,U,18)]"":$P($P($G(^ICD9($P(HBHCINFO,U,18),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,18),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX2)'=6 HBHCDX2=HBHCDX2_$E(HBHCSP6,1,6-$L(HBHCDX2))
"RTN","HBHCXMV",23,0)
 S HBHCDX3=$S($P(HBHCINFO,U,19)]"":$P($P($G(^ICD9($P(HBHCINFO,U,19),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,19),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX3)'=6 HBHCDX3=HBHCDX3_$E(HBHCSP6,1,6-$L(HBHCDX3))
"RTN","HBHCXMV",24,0)
 S HBHCDX4=$S($P(HBHCINFO,U,20)]"":$P($P($G(^ICD9($P(HBHCINFO,U,20),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,20),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX4)'=6 HBHCDX4=HBHCDX4_$E(HBHCSP6,1,6-$L(HBHCDX4))
"RTN","HBHCXMV",25,0)
 S HBHCDX5=$S($P(HBHCINFO,U,21)]"":$P($P($G(^ICD9($P(HBHCINFO,U,21),0)),U),".")_$P($P($G(^ICD9($P(HBHCINFO,U,21),0)),U),".",2),1:HBHCSP6) S:$L(HBHCDX5)'=6 HBHCDX5=HBHCDX5_$E(HBHCSP6,1,6-$L(HBHCDX5))
"RTN","HBHCXMV",26,0)
 ; CPT Codes
"RTN","HBHCXMV",27,0)
 S HBHCNOD1=$G(^HBHC(632,HBHCDFN,1))
"RTN","HBHCXMV",28,0)
 S HBHCCPT1=$S($P(HBHCNOD1,U)]"":$E($P($G(^ICPT($P(HBHCNOD1,U),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT1)'=5 HBHCCPT1=HBHCCPT1_$E(HBHCSP5,1,5-$L(HBHCCPT1))
"RTN","HBHCXMV",29,0)
 S HBHCCPT2=$S($P(HBHCNOD1,U,2)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,2),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT2)'=5 HBHCCPT2=HBHCCPT2_$E(HBHCSP5,1,5-$L(HBHCCPT2))
"RTN","HBHCXMV",30,0)
 S HBHCCPT3=$S($P(HBHCNOD1,U,3)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,3),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT3)'=5 HBHCCPT3=HBHCCPT3_$E(HBHCSP5,1,5-$L(HBHCCPT3))
"RTN","HBHCXMV",31,0)
 S HBHCCPT4=$S($P(HBHCNOD1,U,4)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,4),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT4)'=5 HBHCCPT4=HBHCCPT4_$E(HBHCSP5,1,5-$L(HBHCCPT4))
"RTN","HBHCXMV",32,0)
 S HBHCCPT5=$S($P(HBHCNOD1,U,5)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,5),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT5)'=5 HBHCCPT5=HBHCCPT5_$E(HBHCSP5,1,5-$L(HBHCCPT5))
"RTN","HBHCXMV",33,0)
 S HBHCCPT6=$S($P(HBHCNOD1,U,6)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,6),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT6)'=5 HBHCCPT6=HBHCCPT6_$E(HBHCSP5,1,5-$L(HBHCCPT6))
"RTN","HBHCXMV",34,0)
 S HBHCCPT7=$S($P(HBHCNOD1,U,7)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,7),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT7)'=5 HBHCCPT7=HBHCCPT7_$E(HBHCSP5,1,5-$L(HBHCCPT7))
"RTN","HBHCXMV",35,0)
 S HBHCCPT8=$S($P(HBHCNOD1,U,8)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,8),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT8)'=5 HBHCCPT8=HBHCCPT8_$E(HBHCSP5,1,5-$L(HBHCCPT8))
"RTN","HBHCXMV",36,0)
 S HBHCCPT9=$S($P(HBHCNOD1,U,9)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,9),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCPT9)'=5 HBHCCPT9=HBHCCPT9_$E(HBHCSP5,1,5-$L(HBHCCPT9))
"RTN","HBHCXMV",37,0)
 S HBHCCP10=$S($P(HBHCNOD1,U,10)]"":$E($P($G(^ICPT($P(HBHCNOD1,U,10),0)),U),1,5),1:HBHCSP5) S:$L(HBHCCP10)'=5 HBHCCP10=HBHCCP10_$E(HBHCSP5,1,5-$L(HBHCCP10))
"RTN","HBHCXMV",38,0)
 ; Record to transmit
"RTN","HBHCXMV",39,0)
 L +^HBHC(634,0) S HBHCNDX1=$P(^HBHC(634,0),U,3)+1 F  Q:'$D(^HBHC(634,HBHCNDX1))  S HBHCNDX1=HBHCNDX1+1
"RTN","HBHCXMV",40,0)
 S $P(^HBHC(634,0),U,3)=HBHCNDX1,$P(^HBHC(634,0),U,4)=$P(^HBHC(634,0),U,4)+1 L -^HBHC(634,0)
"RTN","HBHCXMV",41,0)
 S HBHCREC=HBHCFORM_HBHCHOSP_HBHCSSN_HBHCDATE_HBHCPRV_HBHCLNME_HBHCQAI_HBHCDX1_HBHCDX2_HBHCDX3_HBHCDX4_HBHCDX5_HBHCCPT1_HBHCCPT2_HBHCCPT3_HBHCCPT4_HBHCCPT5_HBHCCPT6_HBHCCPT7_HBHCCPT8_HBHCCPT9_HBHCCP10_HBHCSP4
"RTN","HBHCXMV",42,0)
 S ^HBHC(634,HBHCNDX1,0)=HBHCREC,^HBHC(634,"B",$E(HBHCREC,1,30),HBHCNDX1)=""
"RTN","HBHCXMV",43,0)
 ; Flag record as filed
"RTN","HBHCXMV",44,0)
 L +^HBHC(632,HBHCDFN,0) K:HBHCXMT4]"" ^HBHC(632,"AC",HBHCXMT4,HBHCDFN) S $P(^HBHC(632,HBHCDFN,0),U,8)="F",^HBHC(632,"AC","F",HBHCDFN)="",$P(^HBHC(632,HBHCDFN,0),U,9)=HBHCTDY L -^HBHC(632,HBHCDFN,0)
"RTN","HBHCXMV",45,0)
 Q
"VER")
8.0^21.0
**END**
**END**
