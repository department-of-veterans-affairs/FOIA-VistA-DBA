Released IBQ*1*4 SEQ #4
Extracted from mail message
**KIDS**:IBQ*1.0*4^

**INSTALL NAME**
IBQ*1.0*4
"BLD",6380,0)
IBQ*1.0*4^UTILIZATION MANAGEMENT ROLLUP^0^3050914^y
"BLD",6380,1,0)
^^3^3^3050914^
"BLD",6380,1,1,0)
This patch removes an inactive option in the Utilization Management Rollup
"BLD",6380,1,2,0)
package and addresses the problem of sites not receiving data in their IBQ
"BLD",6380,1,3,0)
Site File after running the National Rollup report.
"BLD",6380,4,0)
^9.64PA^^
"BLD",6380,"KRN",0)
^9.67PA^8989.52^19
"BLD",6380,"KRN",.4,0)
.4
"BLD",6380,"KRN",.401,0)
.401
"BLD",6380,"KRN",.402,0)
.402
"BLD",6380,"KRN",.403,0)
.403
"BLD",6380,"KRN",.5,0)
.5
"BLD",6380,"KRN",.84,0)
.84
"BLD",6380,"KRN",3.6,0)
3.6
"BLD",6380,"KRN",3.8,0)
3.8
"BLD",6380,"KRN",9.2,0)
9.2
"BLD",6380,"KRN",9.8,0)
9.8
"BLD",6380,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6380,"KRN",9.8,"NM",1,0)
IBQLLD1^^0^B6614088
"BLD",6380,"KRN",9.8,"NM",2,0)
IBQL356^^0^B16794079
"BLD",6380,"KRN",9.8,"NM","B","IBQL356",2)

"BLD",6380,"KRN",9.8,"NM","B","IBQLLD1",1)

"BLD",6380,"KRN",19,0)
19
"BLD",6380,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",6380,"KRN",19,"NM",1,0)
IBQL TRANSMIT DATA^^1^
"BLD",6380,"KRN",19,"NM","B","IBQL TRANSMIT DATA",1)

"BLD",6380,"KRN",19.1,0)
19.1
"BLD",6380,"KRN",101,0)
101
"BLD",6380,"KRN",409.61,0)
409.61
"BLD",6380,"KRN",771,0)
771
"BLD",6380,"KRN",870,0)
870
"BLD",6380,"KRN",8989.51,0)
8989.51
"BLD",6380,"KRN",8989.52,0)
8989.52
"BLD",6380,"KRN",8994,0)
8994
"BLD",6380,"KRN","B",.4,.4)

"BLD",6380,"KRN","B",.401,.401)

"BLD",6380,"KRN","B",.402,.402)

"BLD",6380,"KRN","B",.403,.403)

"BLD",6380,"KRN","B",.5,.5)

"BLD",6380,"KRN","B",.84,.84)

"BLD",6380,"KRN","B",3.6,3.6)

"BLD",6380,"KRN","B",3.8,3.8)

"BLD",6380,"KRN","B",9.2,9.2)

"BLD",6380,"KRN","B",9.8,9.8)

"BLD",6380,"KRN","B",19,19)

"BLD",6380,"KRN","B",19.1,19.1)

"BLD",6380,"KRN","B",101,101)

"BLD",6380,"KRN","B",409.61,409.61)

"BLD",6380,"KRN","B",771,771)

"BLD",6380,"KRN","B",870,870)

"BLD",6380,"KRN","B",8989.51,8989.51)

"BLD",6380,"KRN","B",8989.52,8989.52)

"BLD",6380,"KRN","B",8994,8994)

"BLD",6380,"QUES",0)
^9.62^^
"BLD",6380,"REQB",0)
^9.611^^
"KRN",19,12790,-1)
1^1
"KRN",19,12790,0)
IBQL TRANSMIT DATA
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",544,-1)
1^1
"PKG",544,0)
UTILIZATION MANAGEMENT ROLLUP^IBQ^Rollup from Hospital Review and Claims Tracking files.
"PKG",544,22,0)
^9.49I^1^1
"PKG",544,22,1,0)
1.0^2951001^2951108
"PKG",544,22,1,"PAH",1,0)
4^3050914
"PKG",544,22,1,"PAH",1,1,0)
^^3^3^3050914
"PKG",544,22,1,"PAH",1,1,1,0)
This patch removes an inactive option in the Utilization Management Rollup
"PKG",544,22,1,"PAH",1,1,2,0)
package and addresses the problem of sites not receiving data in their IBQ
"PKG",544,22,1,"PAH",1,1,3,0)
Site File after running the National Rollup report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","IBQL356")
0^2^B16794079
"RTN","IBQL356",1,0)
IBQL356 ;LEB/MRY - UM ROLLUP - IBT DATA EXTRACTS ; 6-JUN-95
"RTN","IBQL356",2,0)
 ;;1.0;UTILIZATION MGMT ROLLUP LOCAL;**4**;Oct 01, 1995
"RTN","IBQL356",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBQL356",4,0)
 ;
"RTN","IBQL356",5,0)
 Q
"RTN","IBQL356",6,0)
CLAIMS ; -- Extract Claims Tracking, Inpatient Provider, and Movement info.
"RTN","IBQL356",7,0)
 ; -- input:  IBTRN from ^IBT(356,IBTRN...
"RTN","IBQL356",8,0)
 ; -- output: IB(array)=data from RESETC
"RTN","IBQL356",9,0)
 D RESETC^IBQL356A S IBTRND=$G(^IBT(356,IBTRN,0)) I 'IBTRND S IBQUIT=1 Q
"RTN","IBQL356",10,0)
 ; -- get site and discharge date.
"RTN","IBQL356",11,0)
 S IB(.02)=$P($$SITE^VASITE,"^",3),IB(.1)=$P($G(^IBT(356,IBTRN,1)),"^",9)
"RTN","IBQL356",12,0)
 ;-- get claims tracking data, entry id, admission, enrollement code
"RTN","IBQL356",13,0)
 S IB(.01)=$P(IBTRND,"^"),DFN=$P(IBTRND,"^",2),IBNAM=$P($G(^DPT(DFN,0)),"^"),IB(.03)=$P($G(^DPT(DFN,0)),"^",9)
"RTN","IBQL356",14,0)
 S IBR=$P(IBTRND,"^",25),IBD=$P(IBTRND,"^",26),IBL=$P(IBTRND,"^",27)
"RTN","IBQL356",15,0)
 S IB(.05)=IBR_"-"_IBD_"-"_IBL I '(+IBR+IBD+IBL) S IB(.05)=""
"RTN","IBQL356",16,0)
 S IB(1.06)=$S((+IBR+IBD)&(+IBL):"B",(+IBR+IBD):"N",(+IBL):"L",1:"")
"RTN","IBQL356",17,0)
 S DGPM=$P(IBTRND,"^",5) I DGPM D
"RTN","IBQL356",18,0)
 .S IB(.09)=$P($G(^DGPM(DGPM,0)),"^")
"RTN","IBQL356",19,0)
 .; -- get inpatient provider data, admitting, attending, and resident physician
"RTN","IBQL356",20,0)
 .S I="" F  S I=$O(^IBT(356.94,"C",DGPM,I)) Q:'I  S X=$G(^IBT(356.94,I,0)),IBTY=$P(X,"^",4),IB($S(IBTY=1:.07,IBTY=2:.08,IBTY=3:.06,1:"ERR"))=$P(X,"^",3)
"RTN","IBQL356",21,0)
 .; - get patient movement data, treating specialty, ward, admitting diagnosis
"RTN","IBQL356",22,0)
 .;S VAINDT=IB(.09) D INP^VADPT S IB(.12)=$P(VAIN(3),"^",2),IB(.11)=$P(VAIN(4),"^",2)
"RTN","IBQL356",23,0)
 .;S IB(1.07)=$P($G(^DIC(42.4,+$P($G(^DIC(45.7,+$P($G(VAIN(3)),"^"),0)),"^",2),0)),"^",3)
"RTN","IBQL356",24,0)
 .S X=+$O(^IBT(356.9,"ADG",DGPM,0)) S:X IB(.04)=$P(^ICD9(X,0),"^")
"RTN","IBQL356",25,0)
 Q
"RTN","IBQL356",26,0)
 ;
"RTN","IBQL356",27,0)
ADMIT ; -- Extract Hospital Review Admission information
"RTN","IBQL356",28,0)
 ; -- input:  IBTRV from ^IBT(356.1,IBTRN...
"RTN","IBQL356",29,0)
 ; -- output: IB(array)=data from RESETA
"RTN","IBQL356",30,0)
 D RESETA^IBQL356A S IBTRVD=$G(^IBT(356.1,IBTRV,0)) I 'IBTRVD S IBQUIT=1 Q
"RTN","IBQL356",31,0)
 ; -- get hospital review admission data, acute adm?, si, is, reasons
"RTN","IBQL356",32,0)
 ;    admission review
"RTN","IBQL356",33,0)
 S IB(.13)=$P(IBTRVD,"^",6)!0,IB(1.01)=$P(IBTRVD,"^",4),IB(1.02)=$P(IBTRVD,"^",5),IB(1.04)=$P(IBTRVD,"^",10)!0,IB(1.05)=$P(IBTRVD,"^",11)!0
"RTN","IBQL356",34,0)
 F I=1:1:3 Q:'$D(^IBT(356.1,IBTRV,12,I,0))  S X=+^(0),IB(1.03)=IB(1.03)_$P($G(^IBE(356.4,X,0)),"^",2)_" "
"RTN","IBQL356",35,0)
 ; -- if local and no si/is's and no reasons, try specialized units
"RTN","IBQL356",36,0)
 I IBL,'IB(1.01),'IB(1.02),'IB(1.03) S IB(1.01)=$P(IBTRVD,"^",8),IB(1.02)=$P(IBTRVD,"^",9)
"RTN","IBQL356",37,0)
 S:IB(1.01) IB(1.01)=$P(^IBE(356.3,IB(1.01),0),"^",3) S:IB(1.02) IB(1.02)=$P(^IBE(356.3,IB(1.02),0),"^",3)
"RTN","IBQL356",38,0)
 ; -- acute 
"RTN","IBQL356",39,0)
 I 'IB(1.03)!IB(.13) S IB("ACUTE ADMISSION")=1
"RTN","IBQL356",40,0)
 S IB(.12)=$P($G(^DIC(45.7,+$P(IBTRVD,"^",7),0)),"^") I IB(.12)'="" S IB(1.07)=$P($G(^DIC(42.4,+$P($G(^DIC(45.7,+$P(IBTRVD,"^",7),0)),"^",2),0)),"^",3)
"RTN","IBQL356",41,0)
 S VAINDT=$$VNDT^IBTRV(IBTRV) D INP^VADPT S:IB(.12)="" IB(.12)=$P(VAIN(3),"^",2),IB(1.07)=$P($G(^DIC(42.4,+$P($G(^DIC(45.7,+$P($G(VAIN(3)),"^"),0)),"^",2),0)),"^",3) S IB(.11)=$P(VAIN(4),"^",2)
"RTN","IBQL356",42,0)
 Q
"RTN","IBQL356",43,0)
 ;
"RTN","IBQL356",44,0)
STAY ; -- Extract Continued Stay Review information
"RTN","IBQL356",45,0)
 ; -- input:  IBTRN, IBTRV from ^IBT356,IBTRN...
"RTN","IBQL356",46,0)
 ; -- output: IB(array)=data from RESETS
"RTN","IBQL356",47,0)
 D RESETS^IBQL356A S IBTRVD=$G(^IBT(356.1,IBTRV,0)) I 'IBTRVD S IBQUIT=1 Q
"RTN","IBQL356",48,0)
 ; -- get hospital review continued stay reviews, is, si, d/s, interviewed?, reasons
"RTN","IBQL356",49,0)
 ;   continued stay reviews
"RTN","IBQL356",50,0)
 S IB(13.01)=$P(IBTRVD,"^",3)
"RTN","IBQL356",51,0)
 S IB(13.07)=$P($G(^DIC(45.7,+$P(IBTRVD,"^",7),0)),"^") I IB(13.07)'="" S IB(13.08)=$P($G(^DIC(42.4,+$P($G(^DIC(45.7,+$P(IBTRVD,"^",7),0)),"^",2),0)),"^",3)
"RTN","IBQL356",52,0)
 I IB(13.07)="" S VAINDT=$$VNDT^IBTRV(IBTRV) D INP^VADPT S IB(13.07)=$P(VAIN(3),"^",2),IB(13.08)=$P($G(^DIC(42.4,+$P($G(^DIC(45.7,+$P($G(VAIN(3)),"^"),0)),"^",2),0)),"^",3)
"RTN","IBQL356",53,0)
 S IB(13.03)=$P(IBTRVD,"^",4),IB(13.02)=$P(IBTRVD,"^",5),IB(13.04)=$P(IBTRVD,"^",12),IB(13.05)=$P(IBTRVD,"^",10)!0
"RTN","IBQL356",54,0)
 S I=0,IBCNT=0 F  S I=$O(^IBT(356.1,IBTRV,13,I)) Q:'I!(IBCNT>2)  S IBCNT=IBCNT+1,X=+^IBT(356.1,IBTRV,13,I,0),IB(13.06)=IB(13.06)_$P($G(^IBE(356.4,X,0)),"^",2)_" "
"RTN","IBQL356",55,0)
 ; -- if local and no si/is's and no reasons, try specialized units
"RTN","IBQL356",56,0)
 I IBL,'IB(13.03),'IB(13.02),'IB(13.06) S IB(13.03)=$P(IBTRVD,"^",8),IB(13.02)=$P(IBTRVD,"^",9)
"RTN","IBQL356",57,0)
 S:IB(13.03) IB(13.03)=$P($G(^IBE(356.3,IB(13.03),0)),"^",3) S:IB(13.02) IB(13.02)=$P($G(^IBE(356.3,IB(13.02),0)),"^",3) S:IB(13.04) IB(13.04)=$P($G(^IBE(356.3,IB(13.04),0)),"^",3)
"RTN","IBQL356",58,0)
 ; -- if no d/c, no is, and no reasons, try 24 Hour Rule
"RTN","IBQL356",59,0)
 I 'IB(13.04),'IB(13.02),'IB(13.06),IBPIS S IB(13.02)="24??"
"RTN","IBQL356",60,0)
 ; -- for 24 Hour Rule save previous Intensity of Service
"RTN","IBQL356",61,0)
 S IBPIS=IB(13.02) S:IBPIS="24??" IBPIS=""
"RTN","IBQL356",62,0)
 ; acute stay
"RTN","IBQL356",63,0)
 I 'IB(13.06) S IB("ACUTE STAY")=1
"RTN","IBQL356",64,0)
 Q
"RTN","IBQLLD1")
0^1^B6614088
"RTN","IBQLLD1",1,0)
IBQLLD1 ;LEB/MRY - LOAD UMR FILE ; 31-MAR-95
"RTN","IBQLLD1",2,0)
 ;;1.0;UTILIZATION MGMT ROLLUP LOCAL;**2,3,4**;Oct 01, 1995
"RTN","IBQLLD1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBQLLD1",4,0)
 ;
"RTN","IBQLLD1",5,0)
LOAD ;  -- edit, or add .01 field and admission review data
"RTN","IBQLLD1",6,0)
 N IBDAY,DIC,DIE,DA,IBDAY,X,Y,J
"RTN","IBQLLD1",7,0)
 S IBDATA=IBDATA(0),X=$P($P(IBDATA,"^"),":",2),DIC="^IBQ(538,",DIC(0)="L",DLAYGO=538 D ^DIC I Y>0 D
"RTN","IBQLLD1",8,0)
 .; -- fill 0.n fields.
"RTN","IBQLLD1",9,0)
 .S DA=$P(Y,"^"),DIE=DIC D GETDR,^DIE
"RTN","IBQLLD1",10,0)
 .; -- fill 1.n fields.
"RTN","IBQLLD1",11,0)
 .S IBDATA=IBDATA(1) D GETDR1,^DIE
"RTN","IBQLLD1",12,0)
 .; -- fill multiple continued stay fields
"RTN","IBQLLD1",13,0)
 .D MULTI
"RTN","IBQLLD1",14,0)
 Q
"RTN","IBQLLD1",15,0)
 ;
"RTN","IBQLLD1",16,0)
MULTI ; -- edit, or add .01 field and continued stay data
"RTN","IBQLLD1",17,0)
 S DA(1)=DA,DIC=DIC_DA(1)_",13,"
"RTN","IBQLLD1",18,0)
 S IBDAY=1 F  S IBDAY=$O(IBDATA(IBDAY)) Q:'IBDAY  S IBDATA=IBDATA(IBDAY) D
"RTN","IBQLLD1",19,0)
 .S X=$P($P(IBDATA,"^"),":",2),DIC(0)="L",DIC("P")=$P(^DD(538,13,0),"^",2)
"RTN","IBQLLD1",20,0)
 .D ^DIC I Y>0 S DA=+Y,DIE=DIC D GETDR,^DIE
"RTN","IBQLLD1",21,0)
 Q
"RTN","IBQLLD1",22,0)
 ;
"RTN","IBQLLD1",23,0)
GETDR ; -- data string
"RTN","IBQLLD1",24,0)
 S DR="" F J=1:1:$L(IBDATA,"^")-1 S DR=DR_$P($P(IBDATA,"^",J+1),":")_"////"_$P($P(IBDATA,"^",J+1),":",2)_";"
"RTN","IBQLLD1",25,0)
 Q
"RTN","IBQLLD1",26,0)
GETDR1 ; -- data string with no initial call to ^DIE.
"RTN","IBQLLD1",27,0)
 S DR="" F J=1:1:$L(IBDATA,"^") S DR=DR_$P($P(IBDATA,"^",J),":")_"////"_$P($P(IBDATA,"^",J),":",2)_";"
"RTN","IBQLLD1",28,0)
 Q
"RTN","IBQLLD1",29,0)
 ;
"RTN","IBQLLD1",30,0)
TRANSMIT ;  
"RTN","IBQLLD1",31,0)
 ; -- transmit local message
"RTN","IBQLLD1",32,0)
 K ^TMP("IBQLLD",$J),XMY
"RTN","IBQLLD1",33,0)
 S XMY("G.IBQ ROLLUP")="",XMDUZ="IBQ MONITOR",XMSUB="National Rollup File loaded"
"RTN","IBQLLD1",34,0)
 ;
"RTN","IBQLLD1",35,0)
 S ^TMP("IBQLLD",$J,1,0)="The Utilization Management Rollup has completed"_$S($G(IBQNLD)="L":".",1:" and is ready to transmit.")
"RTN","IBQLLD1",36,0)
 S ^TMP("IBQLLD",$J,2,0)=" "
"RTN","IBQLLD1",37,0)
 S ^TMP("IBQLLD",$J,3,0)="                    Site: "_$P($$SITE^VASITE,"^",3)
"RTN","IBQLLD1",38,0)
 S ^TMP("IBQLLD",$J,4,0)="Number of Records loaded: "_IBREC
"RTN","IBQLLD1",39,0)
 S Y=IBBDT X ^DD("DD") S IBBDT1=Y S Y=IBEDT X ^DD("DD") S IBEDT1=Y
"RTN","IBQLLD1",40,0)
 S ^TMP("IBQLLD",$J,5,0)="           Rollup Period: "_IBBDT1_" - "_IBEDT1
"RTN","IBQLLD1",41,0)
 S Y=$S('$D(IBDNLD):"UNKNOWN",IBDNLD="N":"NATIONAL",IBDNLD="A":"ALL",IBDNLD="L":"LOCAL",1:"RANDOM & DISEASE")
"RTN","IBQLLD1",42,0)
 S ^TMP("IBQLLD",$J,6,0)="             Rollup Type: "_Y_" CASES"
"RTN","IBQLLD1",43,0)
 S XMTEXT="^TMP(""IBQLLD"",$J," D ^XMD
"RTN","IBQLLD1",44,0)
 ;
"RTN","IBQLLD1",45,0)
 K IBBDT1,IBEDT1,Y
"RTN","IBQLLD1",46,0)
 Q
"VER")
8.0^22.0
"BLD",6380,6)
^4
**END**
**END**
