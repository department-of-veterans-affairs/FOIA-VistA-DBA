Released DG*5.3*582 SEQ #538
Extracted from mail message
**KIDS**:DG*5.3*582^

**INSTALL NAME**
DG*5.3*582
"BLD",5367,0)
DG*5.3*582^REGISTRATION^0^3041118^y
"BLD",5367,1,0)
^^4^4^3041118^
"BLD",5367,1,1,0)
1. Due to sites experiencing performance issues, modifications were made 
"BLD",5367,1,2,0)
   to have tasks removed from Taskman after completion.
"BLD",5367,1,3,0)
2. Modification to prevent duplicate ISO bulletins and log entries 
"BLD",5367,1,4,0)
   created during the addition of a spouse or dependant.
"BLD",5367,4,0)
^9.64PA^^0
"BLD",5367,"ABPKG")
n
"BLD",5367,"INI")

"BLD",5367,"INID")
^^
"BLD",5367,"INIT")

"BLD",5367,"KRN",0)
^9.67PA^8989.52^19
"BLD",5367,"KRN",.4,0)
.4
"BLD",5367,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5367,"KRN",.401,0)
.401
"BLD",5367,"KRN",.402,0)
.402
"BLD",5367,"KRN",.403,0)
.403
"BLD",5367,"KRN",.5,0)
.5
"BLD",5367,"KRN",.84,0)
.84
"BLD",5367,"KRN",3.6,0)
3.6
"BLD",5367,"KRN",3.8,0)
3.8
"BLD",5367,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",5367,"KRN",9.2,0)
9.2
"BLD",5367,"KRN",9.8,0)
9.8
"BLD",5367,"KRN",9.8,"NM",0)
^9.68A^5^3
"BLD",5367,"KRN",9.8,"NM",3,0)
VAFCCCAP^^0^B20880857
"BLD",5367,"KRN",9.8,"NM",4,0)
VAFHCCAP^^0^B16728009
"BLD",5367,"KRN",9.8,"NM",5,0)
DGSEC^^0^B41818093
"BLD",5367,"KRN",9.8,"NM","B","DGSEC",5)

"BLD",5367,"KRN",9.8,"NM","B","VAFCCCAP",3)

"BLD",5367,"KRN",9.8,"NM","B","VAFHCCAP",4)

"BLD",5367,"KRN",19,0)
19
"BLD",5367,"KRN",19.1,0)
19.1
"BLD",5367,"KRN",101,0)
101
"BLD",5367,"KRN",409.61,0)
409.61
"BLD",5367,"KRN",771,0)
771
"BLD",5367,"KRN",870,0)
870
"BLD",5367,"KRN",8989.51,0)
8989.51
"BLD",5367,"KRN",8989.52,0)
8989.52
"BLD",5367,"KRN",8994,0)
8994
"BLD",5367,"KRN","B",.4,.4)

"BLD",5367,"KRN","B",.401,.401)

"BLD",5367,"KRN","B",.402,.402)

"BLD",5367,"KRN","B",.403,.403)

"BLD",5367,"KRN","B",.5,.5)

"BLD",5367,"KRN","B",.84,.84)

"BLD",5367,"KRN","B",3.6,3.6)

"BLD",5367,"KRN","B",3.8,3.8)

"BLD",5367,"KRN","B",9.2,9.2)

"BLD",5367,"KRN","B",9.8,9.8)

"BLD",5367,"KRN","B",19,19)

"BLD",5367,"KRN","B",19.1,19.1)

"BLD",5367,"KRN","B",101,101)

"BLD",5367,"KRN","B",409.61,409.61)

"BLD",5367,"KRN","B",771,771)

"BLD",5367,"KRN","B",870,870)

"BLD",5367,"KRN","B",8989.51,8989.51)

"BLD",5367,"KRN","B",8989.52,8989.52)

"BLD",5367,"KRN","B",8994,8994)

"BLD",5367,"PRE")

"BLD",5367,"QUES",0)
^9.62^^
"BLD",5367,"REQB",0)
^9.611^3^3
"BLD",5367,"REQB",1,0)
DG*5.3*553^2
"BLD",5367,"REQB",2,0)
DG*5.3*91^2
"BLD",5367,"REQB",3,0)
DG*5.3*425^2
"BLD",5367,"REQB","B","DG*5.3*425",3)

"BLD",5367,"REQB","B","DG*5.3*553",1)

"BLD",5367,"REQB","B","DG*5.3*91",2)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
582^3041118^100850
"PKG",5,22,1,"PAH",1,1,0)
^^4^4^3041118
"PKG",5,22,1,"PAH",1,1,1,0)
1. Due to sites experiencing performance issues, modifications were made 
"PKG",5,22,1,"PAH",1,1,2,0)
   to have tasks removed from Taskman after completion.
"PKG",5,22,1,"PAH",1,1,3,0)
2. Modification to prevent duplicate ISO bulletins and log entries 
"PKG",5,22,1,"PAH",1,1,4,0)
   created during the addition of a spouse or dependant.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DGSEC")
0^5^B41818093
"RTN","DGSEC",1,0)
DGSEC ;ALB/RMO - MAS Patient Look-up Security Check ; 3/24/04 7:53pm
"RTN","DGSEC",2,0)
 ;;5.3;Registration;**32,46,197,214,249,281,352,391,425,582**;Aug 13, 1993
"RTN","DGSEC",3,0)
 ;
"RTN","DGSEC",4,0)
 ;Entry point from DPTLK
"RTN","DGSEC",5,0)
 N DFN,DGANS,DGMSG,DGOPT,DGPTSSN,DGREC,DGSENS,DGY,DX,DY,%,DG1
"RTN","DGSEC",6,0)
 ;Y=Patient file DFN
"RTN","DGSEC",7,0)
 S DGY=Y
"RTN","DGSEC",8,0)
 ;OWNREC^DGSEC4 parameters: 
"RTN","DGSEC",9,0)
 ;  DGREC = output array passed by reference
"RTN","DGSEC",10,0)
 ;  DGY = Patient file DFN
"RTN","DGSEC",11,0)
 ;  DUZ = New Person file IEN
"RTN","DGSEC",12,0)
 ;  1=generate error msg
"RTN","DGSEC",13,0)
 ;  DGNEWPT - set to 1 in DPTLK2 when adding new Patient (#2) file entry
"RTN","DGSEC",14,0)
 ;  DGPTSSN - set to patient's SSN when adding new Patient file entry
"RTN","DGSEC",15,0)
 ;  X=Patient's SSN from DPTLK2
"RTN","DGSEC",16,0)
 I $G(DGNEWPT)=1 S DGPTSSN=X
"RTN","DGSEC",17,0)
 D OWNREC^DGSEC4(.DGREC,+DGY,DUZ,1,$G(DGNEWPT),$G(DGPTSSN))
"RTN","DGSEC",18,0)
 S Y=DGY
"RTN","DGSEC",19,0)
 I DGREC(1)=1!(DGREC(1)=2) D  G Q
"RTN","DGSEC",20,0)
 .S Y=-1
"RTN","DGSEC",21,0)
 .D DISP(.DGREC)
"RTN","DGSEC",22,0)
 .I $D(DDS) R !,"Please enter any key to continue.",DGANS:DTIME
"RTN","DGSEC",23,0)
 ;SENS^DGSEC4 parameters: 
"RTN","DGSEC",24,0)
 ;  DGSENS = output array passed by reference
"RTN","DGSEC",25,0)
 ;  Y = Patient fileDFN
"RTN","DGSEC",26,0)
 ;  DUZ = New Person file IEN
"RTN","DGSEC",27,0)
 ;  DDS - Screenman variable
"RTN","DGSEC",28,0)
 ;  DGSENFLG - If defined, patient record sensitivity not checked
"RTN","DGSEC",29,0)
 D SENS^DGSEC4(.DGSENS,+Y,DUZ,$G(DDS),.DGSENFLG)
"RTN","DGSEC",30,0)
 ;DUZ must be defined to access a sensitive record
"RTN","DGSEC",31,0)
 I DGSENS(1)=-1 D  G Q
"RTN","DGSEC",32,0)
 .S Y=-1
"RTN","DGSEC",33,0)
 .D DISP(.DGSENS)
"RTN","DGSEC",34,0)
 I DGSENS(1)=0 G Q
"RTN","DGSEC",35,0)
 ;Get option name for DG Security Log file and bulletin
"RTN","DGSEC",36,0)
 D OP^XQCHK S DGOPT=$S(+XQOPT<0:"^UNKNOWN",1:$P(XQOPT,U)_U_$P(XQOPT,U,2))
"RTN","DGSEC",37,0)
 I DGSENS(1)=1 D
"RTN","DGSEC",38,0)
 .I DIC(0)["E" D
"RTN","DGSEC",39,0)
 ..W $C(7)
"RTN","DGSEC",40,0)
 ..D DISP(.DGSENS)
"RTN","DGSEC",41,0)
 .I Y>0 D
"RTN","DGSEC",42,0)
 ..;Parameters: DFN,DUZ,,Option name^Menu text
"RTN","DGSEC",43,0)
 ..D SETLOG1(+Y,DUZ,,DGOPT)
"RTN","DGSEC",44,0)
 I DGSENS(1)=2 D
"RTN","DGSEC",45,0)
 .I DIC(0)["E" D
"RTN","DGSEC",46,0)
 ..W $C(7)
"RTN","DGSEC",47,0)
 ..D DISP(.DGSENS)
"RTN","DGSEC",48,0)
 ..D NOTCE1
"RTN","DGSEC",49,0)
 .I Y>0 D
"RTN","DGSEC",50,0)
 ..D SETLOG1(+Y,DUZ,,DGOPT)
"RTN","DGSEC",51,0)
 ..;Parameters: DFN,DUZ,Option name^Menu text,message array
"RTN","DGSEC",52,0)
 ..D BULTIN1(+Y,DUZ,DGOPT,.DGMSG)
"RTN","DGSEC",53,0)
 ..I $D(DGSM),DIC(0)["E" D DISP(.DGMSG)
"RTN","DGSEC",54,0)
 D Q
"RTN","DGSEC",55,0)
 Q
"RTN","DGSEC",56,0)
 ;
"RTN","DGSEC",57,0)
REC ;DPTLK2 entry point when adding new Patient file record
"RTN","DGSEC",58,0)
 ;Input: X=Patient's SSN
"RTN","DGSEC",59,0)
 ;Output: DGREC=1 (adding own record or SSN not defined) or 0
"RTN","DGSEC",60,0)
 ;
"RTN","DGSEC",61,0)
 ;Parameters: DGREC=output array
"RTN","DGSEC",62,0)
 ;            DUZ
"RTN","DGSEC",63,0)
 ;            1 - generate error msg
"RTN","DGSEC",64,0)
 ;            DGNEWPT = 1 (adding new Patient (#2) file record
"RTN","DGSEC",65,0)
 ;            DGPTSSN = X (Patient's SSN)
"RTN","DGSEC",66,0)
 N DGPTSSN
"RTN","DGSEC",67,0)
 S DGPTSSN=X
"RTN","DGSEC",68,0)
 D OWNREC^DGSEC4(.DGREC,,DUZ,1,$G(DGNEWPT),$G(DGPTSSN))
"RTN","DGSEC",69,0)
 I DGREC(1)=1!(DGREC(1)=2) D
"RTN","DGSEC",70,0)
 .D DISP(.DGREC)
"RTN","DGSEC",71,0)
 .I $D(DDS) R !,"Please enter any key to continue.",DGANS:DTIME
"RTN","DGSEC",72,0)
 S DGREC=+DGREC(1)
"RTN","DGSEC",73,0)
 I DGREC=2 S DGREC=1
"RTN","DGSEC",74,0)
 Q
"RTN","DGSEC",75,0)
SETLOG ;Entry point for DBIA #2242
"RTN","DGSEC",76,0)
 ;Input variables: Y=DFN,DUZ,DG1=Inpatient/outpatient indicator,DGOPT=Option name^Menu text
"RTN","DGSEC",77,0)
 D SETLOG1(Y,DUZ,DG1,DGOPT)
"RTN","DGSEC",78,0)
 D Q
"RTN","DGSEC",79,0)
 Q
"RTN","DGSEC",80,0)
BULTIN ;Entry point for DBIA #2242
"RTN","DGSEC",81,0)
 ;Input variables: Y=DFN,DUZ,DGOPT=Option name^Menu text
"RTN","DGSEC",82,0)
 D BULTIN1(Y,DUZ,DGOPT)
"RTN","DGSEC",83,0)
 Q
"RTN","DGSEC",84,0)
SETLOG1(DFN,DGDUZ,DG1,DGOPT) ;Adds/updates entry in DG Security Log file (38.1)
"RTN","DGSEC",85,0)
 ;Input:
"RTN","DGSEC",86,0)
 ;  DFN   - Patient (#2) file DFN (Required)
"RTN","DGSEC",87,0)
 ;  DGDUZ - New Person (#200) file IEN
"RTN","DGSEC",88,0)
 ;  DG1   - Inpatient or Outpatient (Optional)
"RTN","DGSEC",89,0)
 ;  DGOPT - Option (#19) file Name (#.01)^Menu text (Optional)
"RTN","DGSEC",90,0)
 ;
"RTN","DGSEC",91,0)
 N DGA1,DGDATE,DGDTE,DGT,DGTIME,XQOPT
"RTN","DGSEC",92,0)
 ;DG/582
"RTN","DGSEC",93,0)
 I $G(VALM("TITLE"))="Dependents Module" Q
"RTN","DGSEC",94,0)
 ;Lock global
"RTN","DGSEC",95,0)
LOCK L +^DGSL(38.1,+DFN):1 G:'$T LOCK
"RTN","DGSEC",96,0)
 ;Add new entry for patient if not found
"RTN","DGSEC",97,0)
 I '$D(^DGSL(38.1,+DFN,0)) D
"RTN","DGSEC",98,0)
 .S ^DGSL(38.1,+DFN,0)=+DFN
"RTN","DGSEC",99,0)
 .S ^DGSL(38.1,"B",+DFN,+DFN)=""
"RTN","DGSEC",100,0)
 .S $P(^DGSL(38.1,0),U,3)=+DFN
"RTN","DGSEC",101,0)
 .S $P(^DGSL(38.1,0),U,4)=$P(^DGSL(38.1,0),U,4)+1
"RTN","DGSEC",102,0)
 .;Determine if entry is automatically sensitive
"RTN","DGSEC",103,0)
 .N ELIG,FLAG,X
"RTN","DGSEC",104,0)
 .S FLAG=0
"RTN","DGSEC",105,0)
 .S X=$S($D(^DPT(+DFN,"TYPE")):+^("TYPE"),1:"")
"RTN","DGSEC",106,0)
 .I $D(^DG(391,+X,0)),$P(^(0),"^",4) S FLAG=1
"RTN","DGSEC",107,0)
 .I 'FLAG S ELIG=0 F  S ELIG=$O(^DPT(+DFN,"E",ELIG)) Q:'ELIG  D  Q:FLAG
"RTN","DGSEC",108,0)
 ..S X=$G(^DIC(8,ELIG,0))
"RTN","DGSEC",109,0)
 ..I $P(X,"^",12) S FLAG=1
"RTN","DGSEC",110,0)
 .S $P(^DGSL(38.1,+DFN,0),"^",2)=FLAG
"RTN","DGSEC",111,0)
 .;Date/time sensitivity was set
"RTN","DGSEC",112,0)
 .S $P(^DGSL(38.1,+DFN,0),"^",4)=$$NOW^XLFDT()
"RTN","DGSEC",113,0)
 ;determine if an inpatient
"RTN","DGSEC",114,0)
 D H^DGUTL
"RTN","DGSEC",115,0)
 S DGT=DGTIME
"RTN","DGSEC",116,0)
 I $G(DG1)="" D ^DGPMSTAT
"RTN","DGSEC",117,0)
 ;get option name
"RTN","DGSEC",118,0)
 I $G(DGOPT)="" D OP^XQCHK S DGOPT=$S(+XQOPT<0:"^UNKNOWN",1:$P(XQOPT,U)_U_$P(XQOPT,U,2))
"RTN","DGSEC",119,0)
SETUSR S DGDTE=9999999.9999-DGTIME I $D(^DGSL(38.1,+DFN,"D",DGDTE,0)) S DGTIME=DGTIME+.00001 G SETUSR
"RTN","DGSEC",120,0)
 S:'$D(^DGSL(38.1,+DFN,"D",0)) ^(0)="^38.11DA^^" S ^DGSL(38.1,+DFN,"D",DGDTE,0)=DGTIME_U_DGDUZ_U_$P(DGOPT,U,2)_U_$S(DG1:"y",1:"n"),$P(^(0),U,3,4)=DGDTE_U_($P(^DGSL(38.1,+DFN,"D",0),U,4)+1)
"RTN","DGSEC",121,0)
 S ^DGSL(38.1,"AD",DGDTE,+DFN)=""
"RTN","DGSEC",122,0)
 S ^DGSL(38.1,"AU",+DFN,DGDUZ,DGDTE)=""
"RTN","DGSEC",123,0)
 L -^DGSL(38.1,+DFN)
"RTN","DGSEC",124,0)
 Q
"RTN","DGSEC",125,0)
Q K DG1,DGDATE,DGDTE,DGLNE,DGMSG,DGOPT,DGSEN,DGTIME,DGY,XQOPT
"RTN","DGSEC",126,0)
 N DGTEST S DGTEST=^%ZOSF("TEST")
"RTN","DGSEC",127,0)
 I DIC(0)["E",Y>0 D
"RTN","DGSEC",128,0)
 .S X="DGPFAPI" X DGTEST I $T D  ;Patient Record Flags check/display
"RTN","DGSEC",129,0)
 ..N DGPFSAVY S DGPFSAVY=Y
"RTN","DGSEC",130,0)
 ..D DISPPRF^DGPFAPI(Y) S Y=DGPFSAVY K DGPFSAVY
"RTN","DGSEC",131,0)
 .S X="A7RDPACT" X DGTEST I $T D ^A7RDPACT ;NDBI
"RTN","DGSEC",132,0)
 .S X="GMRPNCW" X DGTEST I $T S DPTSAVY=Y D ENPAT^GMRPNCW S Y=DPTSAVY K DPTSAVY ; CWAD
"RTN","DGSEC",133,0)
 .S X="MPRCHK" X DGTEST I $T D EN^MPRCHK(Y) ; MPR
"RTN","DGSEC",134,0)
 Q
"RTN","DGSEC",135,0)
 ;
"RTN","DGSEC",136,0)
BULTIN1(DFN,DGDUZ,DGOPT,DGMSG) ;Generate sensitive record access bulletin
"RTN","DGSEC",137,0)
 ;
"RTN","DGSEC",138,0)
 ;Input:  DFN = Patient file IEN
"RTN","DGSEC",139,0)
 ;        DGDUZ = New Person (#200) file IEN
"RTN","DGSEC",140,0)
 ;        DGOPT = Option (#19) file Name (#.01)^Menu text
"RTN","DGSEC",141,0)
 ;        DGMSG = Message array (Optional)
"RTN","DGSEC",142,0)
 ;
"RTN","DGSEC",143,0)
 N DGEMPLEE,XMSUB,XQOPT
"RTN","DGSEC",144,0)
 ;DG/582
"RTN","DGSEC",145,0)
 I $G(VALM("TITLE"))="Dependents Module" Q
"RTN","DGSEC",146,0)
 K DGB I $D(^DG(43,1,"NOT")),+$P(^("NOT"),U,10) S DGB=10
"RTN","DGSEC",147,0)
 Q:'$D(DGB)  S XMSUB="RESTRICTED PATIENT RECORD ACCESSED"
"RTN","DGSEC",148,0)
 S DGB=+$P($G(^DG(43,1,"NOT")),U,DGB) Q:'DGB
"RTN","DGSEC",149,0)
 S DGB=$P($G(^XMB(3.8,DGB,0)),U) Q:'$L(DGB)
"RTN","DGSEC",150,0)
 I $G(DGOPT)="" D OP^XQCHK S DGOPT=$S(+XQOPT<0:"^UNKNOWN",1:$P(XQOPT,U)_U_$P(XQOPT,U,2))
"RTN","DGSEC",151,0)
 N XMB,XMY,XMY0,XMZ
"RTN","DGSEC",152,0)
 S XMB="DG SENSITIVITY",XMB(1)=$P(^DPT(+DFN,0),U)
"RTN","DGSEC",153,0)
 S DGEMPLEE=$$EMPL^DGSEC4(+DFN)
"RTN","DGSEC",154,0)
 I DGEMPLEE=1 S XMB(1)=XMB(1)_"  (Employee)"
"RTN","DGSEC",155,0)
 S XMB(2)=$P(^DPT(+DFN,0),U,9),XMB(3)=$P(DGOPT,U,2),XMY("G."_DGB)=""
"RTN","DGSEC",156,0)
 N Y S Y=$$NOW^XLFDT() X ^DD("DD") S XMB(4)=Y
"RTN","DGSEC",157,0)
 D SEND(.XMB,.XMY)
"RTN","DGSEC",158,0)
 S DGMSG(1)="NOTE: A bulletin will now be sent to your station security officer."
"RTN","DGSEC",159,0)
 Q
"RTN","DGSEC",160,0)
 ;
"RTN","DGSEC",161,0)
SEND(XMB,XMY) ;Queue mail bulletin
"RTN","DGSEC",162,0)
 ;Input: XMB,XMY=Mailman bulletin parameters
"RTN","DGSEC",163,0)
 ;
"RTN","DGSEC",164,0)
 D ^XMB
"RTN","DGSEC",165,0)
 Q
"RTN","DGSEC",166,0)
 ;
"RTN","DGSEC",167,0)
DISP(ARRAY) ;Display message text to screen
"RTN","DGSEC",168,0)
 ;Input:  Array containg message text
"RTN","DGSEC",169,0)
 ;
"RTN","DGSEC",170,0)
 I '$D(ARRAY) Q
"RTN","DGSEC",171,0)
 I DIC(0)'["E" Q
"RTN","DGSEC",172,0)
 I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY S X=0 X ^%ZOSF("RM")
"RTN","DGSEC",173,0)
 N DGI,DGWHERE
"RTN","DGSEC",174,0)
 I '$D(DDS) W !!
"RTN","DGSEC",175,0)
 F DGI=1:0 S DGI=$O(ARRAY(DGI)) Q:'DGI  D
"RTN","DGSEC",176,0)
 .S DGWHERE=(80-$L(ARRAY(DGI)))\2
"RTN","DGSEC",177,0)
 .W ?DGWHERE,ARRAY(DGI),!
"RTN","DGSEC",178,0)
 Q
"RTN","DGSEC",179,0)
 ;
"RTN","DGSEC",180,0)
NOTCE1 W:'$D(DDS) !! W "Do you want to continue processing this patient record" S %=2 D YN^DICN S:%<0!(%=2) Y=-1 I '% D  W:'$D(DDS) !! W "Enter 'YES' to continue processing, or 'NO' to quit processing this record." W:$D(DDS) ! G NOTCE1
"RTN","DGSEC",181,0)
 .I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DGSEC",182,0)
 Q
"RTN","DGSEC",183,0)
 ;
"RTN","DGSEC",184,0)
LOADXMY() ;this adds the contents of field #509 of File #43 to the XMY array
"RTN","DGSEC",185,0)
 ;PDX plans to use this - remember to NEW DIC before ^XMD call
"RTN","DGSEC",186,0)
 ;  Input  - None
"RTN","DGSEC",187,0)
 ;  Output - XMY("G.mailgroupname")="" if field #509 is defined
"RTN","DGSEC",188,0)
 ;                where mailgroupname is text value of mail group
"RTN","DGSEC",189,0)
 ;          Returns: 0              - Ok
"RTN","DGSEC",190,0)
 ;                   -1^errortext   - if can't find mail group
"RTN","DGSEC",191,0)
 ;
"RTN","DGSEC",192,0)
 N DGB,DGERR
"RTN","DGSEC",193,0)
 S DGERR=0
"RTN","DGSEC",194,0)
 S DGB=+$P($G(^DG(43,1,"NOT")),"^",10)
"RTN","DGSEC",195,0)
 I '$D(^XMB(3.8,DGB,0))#2 S DGERR="-1^No/Bad Field #509 entry in File #43" G QTLOADX
"RTN","DGSEC",196,0)
 S XMY("G."_$P($G(^XMB(3.8,DGB,0)),"^",1))="" ; pass mailgroup
"RTN","DGSEC",197,0)
QTLOADX Q DGERR
"RTN","VAFCCCAP")
0^3^B20880857
"RTN","VAFCCCAP",1,0)
VAFCCCAP ;ALB/CMM,PKE OUTPATIENT CAPTURE TEST ;4/12/95
"RTN","VAFCCCAP",2,0)
 ;;5.3;Registration;**91,179,553,582**;Jun 06, 1996
"RTN","VAFCCCAP",3,0)
 ;
"RTN","VAFCCCAP",4,0)
 ;
"RTN","VAFCCCAP",5,0)
CAP ;Only fire if check-in,check-out, add/edit add, add/edit change
"RTN","VAFCCCAP",6,0)
 I ($G(SDAMEVT)<4)!($G(SDAMEVT)>7) Q
"RTN","VAFCCCAP",7,0)
 ;quit if no change
"RTN","VAFCCCAP",8,0)
 I +$G(SDATA("BEFORE","STATUS"))=3,+$G(SDATA("AFTER","STATUS"))=3
"RTN","VAFCCCAP",9,0)
 IF  I $P($G(SDATA("AFTER","STATUS")),"^",3)'="ACTION REQ/CHECKED IN"
"RTN","VAFCCCAP",10,0)
 IF  I $P($G(SDATA("BEFORE","STATUS")),"^",3)'="NO ACTION TAKEN/TODAY" Q
"RTN","VAFCCCAP",11,0)
 ;check to see if sending is on or off
"RTN","VAFCCCAP",12,0)
 I '$P($$SEND^VAFHUTL(),"^",2) Q
"RTN","VAFCCCAP",13,0)
 ;check if protocol disabled or no clients
"RTN","VAFCCCAP",14,0)
 I $$PROTOCHK("VAFC ADT-A08-SDAM SERVER") Q
"RTN","VAFCCCAP",15,0)
 ;Queue to run NOW, returns control back to outpatient event driver
"RTN","VAFCCCAP",16,0)
 S ZTRTN="EN^VAFCCCAP",ZTDESC="PIMS Outpatient HL7 v2.3 Capture"
"RTN","VAFCCCAP",17,0)
 S ZTSAVE("SDHDL")="",ZTSAVE("SDAMEVT")="",ZTSAVE("SDATA")="",ZTSAVE("^TMP(""SDEVT"",$J,")="",ZTIO="",ZTDTH=$H
"RTN","VAFCCCAP",18,0)
 D ^%ZTLOAD
"RTN","VAFCCCAP",19,0)
 ;W !?3,$G(ZTSK)
"RTN","VAFCCCAP",20,0)
 Q
"RTN","VAFCCCAP",21,0)
 ;
"RTN","VAFCCCAP",22,0)
EN ;
"RTN","VAFCCCAP",23,0)
 N DFN,HLD,EVDT,CHK,ERR,SEND,NEW,EVENT,HOSP,THLD,PTR,REM,HPTR
"RTN","VAFCCCAP",24,0)
 ;
"RTN","VAFCCCAP",25,0)
 ;Appointments
"RTN","VAFCCCAP",26,0)
 ;
"RTN","VAFCCCAP",27,0)
 I SDAMEVT=4!(SDAMEVT=5) D
"RTN","VAFCCCAP",28,0)
 .S DFN=$P(SDATA,"^",2),EVDT=$P(SDATA,"^",3),PTR=$$GETPTR^VAFHCUTL(1),PTR=PTR_";SCE(",(CHK,UP,REM)=""
"RTN","VAFCCCAP",29,0)
 .I SDAMEVT=4 S PTR=DFN_";DPT(" ;check-in or unscheduled visit check-in
"RTN","VAFCCCAP",30,0)
 .;Need to check if deleting check-out
"RTN","VAFCCCAP",31,0)
 .;if deleting check-out and no pivot file entry exists don't send
"RTN","VAFCCCAP",32,0)
 .I +$G(SDATA("AFTER","STATUS"))=3&(+$G(SDATA("BEFORE","STATUS"))=2) S CHK=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR),PTR=$$UPPTR(DFN,EVDT) S:PTR="@" REM=1 S:+CHK>0 UP=$$UPDATE^VAFHUTL(+CHK,EVDT,PTR,REM) S:+CHK<0!(+UP<0) SEND="N"
"RTN","VAFCCCAP",33,0)
 .;set send to N if deleting and not in pivot file
"RTN","VAFCCCAP",34,0)
 .I '$D(SEND) D
"RTN","VAFCCCAP",35,0)
 ..S HLD=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",36,0)
 ..I +HLD=-1 S HPTR=DFN_";DPT(",HLD=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,HPTR) I +HLD'=-1 S UP=$$UPDATE^VAFHUTL(+HLD,EVDT,PTR,"")
"RTN","VAFCCCAP",37,0)
 ..I +HLD=-1 S HLD=$$PIVNW^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",38,0)
 ..;S EVENT=$P(HLD,":"),ERR=$$OA08^VAFHCA08(DFN,EVENT,EVDT,PTR,"2,3,4,5,6,7,8,9,11,12,13,14,16,19","2,3,4,5,6,7,8,9,10,11,12,13,14,15","A","A")
"RTN","VAFCCCAP",39,0)
 ..;set up call to vafcmsg for out-patient
"RTN","VAFCCCAP",40,0)
 ..D SETUP
"RTN","VAFCCCAP",41,0)
 ;
"RTN","VAFCCCAP",42,0)
 ;Stop codes, Add/Edits
"RTN","VAFCCCAP",43,0)
 I SDAMEVT=6!(SDAMEVT=7) D
"RTN","VAFCCCAP",44,0)
 .N HLD,STOP,THLD,REMOVE,UP
"RTN","VAFCCCAP",45,0)
 .S HLD="",STOP="N",ERR=""
"RTN","VAFCCCAP",46,0)
 .F  K EVENT S REMOVE="N",HLD=$O(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD)) Q:HLD=""!(STOP="Y")  D
"RTN","VAFCCCAP",47,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")'=""&($P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^",6)'="") S STOP="Y" Q
"RTN","VAFCCCAP",48,0)
 ..;If STOP="Y" stop code was not stand alone
"RTN","VAFCCCAP",49,0)
 ..;If STOP="N" stop code is stand alone
"RTN","VAFCCCAP",50,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")="" D
"RTN","VAFCCCAP",51,0)
 ...S REMOVE="Y",DFN=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"BEFORE"),"^",2),EVDT=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"BEFORE"),"^"),PTR=HLD_";SCE("
"RTN","VAFCCCAP",52,0)
 ...S EVENT=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFCCCAP",53,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")'="" D
"RTN","VAFCCCAP",54,0)
 ...S DFN=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^",2),EVDT=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^"),PTR=HLD_";SCE("
"RTN","VAFCCCAP",55,0)
 ..I '$D(EVENT) S THLD=$$PIVNW^VAFHPIVT(DFN,EVDT,2,PTR),EVENT=$P(THLD,":")
"RTN","VAFCCCAP",56,0)
 ..I REMOVE="Y" S PTR="@",UP=$$UPDATE^VAFHUTL(+EVENT,EVDT,PTR,1)
"RTN","VAFCCCAP",57,0)
 ..;I +EVENT>0 S ERR=$$OA08^VAFHCA08(DFN,EVENT,EVDT,PTR,"2,3,4,5,6,7,8,9,11,12,13,14,16,19","2,3,4,5,6,7,8,9,10,11,12,13,14,15","A","A")
"RTN","VAFCCCAP",58,0)
 ..;set up call to vafcmsg for out-patient
"RTN","VAFCCCAP",59,0)
 ..I +EVENT>0 D SETUP
"RTN","VAFCCCAP",60,0)
 ;
"RTN","VAFCCCAP",61,0)
EXIT ;
"RTN","VAFCCCAP",62,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","VAFCCCAP",63,0)
 I +ERR<0 D ERROR(ERR,DFN)
"RTN","VAFCCCAP",64,0)
 D KILL^HLTRANS
"RTN","VAFCCCAP",65,0)
 Q
"RTN","VAFCCCAP",66,0)
 ;
"RTN","VAFCCCAP",67,0)
ERROR(PNUM,DFN) ;
"RTN","VAFCCCAP",68,0)
 ;Error message unable to generate A08 Message
"RTN","VAFCCCAP",69,0)
 N GBL S GBL="^TMP($J,""ERR"")"
"RTN","VAFCCCAP",70,0)
 I +PNUM<0 S @GBL@(0)="ERROR",@GBL@(1)=$P(PNUM,"^",2)_", unable to generate A08 Message" D EBULL^VAFHUTL2(DFN,"","",$P(GBL,")")_",")
"RTN","VAFCCCAP",71,0)
 Q
"RTN","VAFCCCAP",72,0)
 ;
"RTN","VAFCCCAP",73,0)
UPPTR(DFN,ADATE) ;
"RTN","VAFCCCAP",74,0)
 ;Have deleted checkout, update variable pointer
"RTN","VAFCCCAP",75,0)
 N PTR S PTR="@"
"RTN","VAFCCCAP",76,0)
 I $D(^DPT(DFN,"S",ADATE,0)) S PTR=DFN_";DPT("
"RTN","VAFCCCAP",77,0)
 Q PTR
"RTN","VAFCCCAP",78,0)
 ;
"RTN","VAFCCCAP",79,0)
SETUP ;
"RTN","VAFCCCAP",80,0)
 N PIVOTPTR
"RTN","VAFCCCAP",81,0)
 S EVENT=$P(HLD,":")
"RTN","VAFCCCAP",82,0)
 S EVNTINFO="^TMP(""VAFCMSG"",""EVNTINFO"","_$J_")"
"RTN","VAFCCCAP",83,0)
 K @EVNTINFO
"RTN","VAFCCCAP",84,0)
 S PIVOTPTR=+$O(^VAT(391.71,"D",EVENT,0))
"RTN","VAFCCCAP",85,0)
 I ('PIVOTPTR) S ERR="-1^Unable to create entry in ADT/HL7 PIVOT FILE" Q
"RTN","VAFCCCAP",86,0)
 S @EVNTINFO@("PIVOT")=PIVOTPTR
"RTN","VAFCCCAP",87,0)
 S @EVNTINFO@("SERVER PROTOCOL")="VAFC ADT-A08-SDAM SERVER"
"RTN","VAFCCCAP",88,0)
 S @EVNTINFO@("VAR-PTR")=PTR
"RTN","VAFCCCAP",89,0)
 S @EVNTINFO@("EVENT-NUM")=EVENT
"RTN","VAFCCCAP",90,0)
 S ERR=$$BCSTADT^VAFCMSG0(DFN,"A08",EVDT,EVNTINFO)
"RTN","VAFCCCAP",91,0)
 K @EVNTINFO
"RTN","VAFCCCAP",92,0)
 Q
"RTN","VAFCCCAP",93,0)
PROTOCHK(SPROTO) ;
"RTN","VAFCCCAP",94,0)
 ; input   server protocol
"RTN","VAFCCCAP",95,0)
 ;output   1 if disabled or has no clients
"RTN","VAFCCCAP",96,0)
 N HL
"RTN","VAFCCCAP",97,0)
 D INIT^HLFNC2(SPROTO,.HL,1)
"RTN","VAFCCCAP",98,0)
 K HLQ,HLECH,HLFS
"RTN","VAFCCCAP",99,0)
 Q $D(HL)#2
"RTN","VAFHCCAP")
0^4^B16728009
"RTN","VAFHCCAP",1,0)
VAFHCCAP ;ALB/CMM OUTPATIENT CAPTURE TEST ;4/12/95
"RTN","VAFHCCAP",2,0)
 ;;5.3;Registration;**91,582**;Jun 06, 1996
"RTN","VAFHCCAP",3,0)
 ;
"RTN","VAFHCCAP",4,0)
CAP ;
"RTN","VAFHCCAP",5,0)
 ;Only fire if check-in,check-out, add/edit add, add/edit change
"RTN","VAFHCCAP",6,0)
 I ($G(SDAMEVT)<4)!($G(SDAMEVT)>7) Q
"RTN","VAFHCCAP",7,0)
 ;quit if no action
"RTN","VAFHCCAP",8,0)
 I +$G(SDATA("BEFORE","STATUS"))=3,+$G(SDATA("AFTER","STATUS"))=3
"RTN","VAFHCCAP",9,0)
 IF  I $P($G(SDATA("AFTER","STATUS")),"^",3)'="ACTION REQ/CHECKED IN"
"RTN","VAFHCCAP",10,0)
 IF  I $P($G(SDATA("BEFORE","STATUS")),"^",3)'="NO ACTION TAKEN/TODAY" Q
"RTN","VAFHCCAP",11,0)
 ;check to see if sending is on or off
"RTN","VAFHCCAP",12,0)
 I '$$SEND^VAFHUTL() Q
"RTN","VAFHCCAP",13,0)
 ;
"RTN","VAFHCCAP",14,0)
 ;S ^TMP($J,"VAFHCCAP")=""
"RTN","VAFHCCAP",15,0)
 ;I $D(^TMP($J,"VAFHCCAP")) G EN ;for debug
"RTN","VAFHCCAP",16,0)
 ;
"RTN","VAFHCCAP",17,0)
 ;Queue to run NOW, returns control back to outpatient event driver
"RTN","VAFHCCAP",18,0)
 S ZTRTN="EN^VAFHCCAP",ZTDESC="PIMS Outpatient HL7 Capture"
"RTN","VAFHCCAP",19,0)
 S ZTSAVE("SDHDL")="",ZTSAVE("SDAMEVT")="",ZTSAVE("SDATA")=""
"RTN","VAFHCCAP",20,0)
 S ZTSAVE("^TMP(""SDEVT"",$J,")="",ZTIO="",ZTDTH=$H
"RTN","VAFHCCAP",21,0)
 D ^%ZTLOAD
"RTN","VAFHCCAP",22,0)
 ;W !?3,$G(ZTSK)
"RTN","VAFHCCAP",23,0)
 Q
"RTN","VAFHCCAP",24,0)
 ;
"RTN","VAFHCCAP",25,0)
EN ;
"RTN","VAFHCCAP",26,0)
 N DFN,HLD,EVDT,CHK,ERR,SEND,NEW,EVENT,HOSP,THLD,PTR,REM,HPTR
"RTN","VAFHCCAP",27,0)
 ;Only fire if check-in,check-out, add/edit add, add/edit change
"RTN","VAFHCCAP",28,0)
 I SDAMEVT<4!(SDAMEVT>7) Q
"RTN","VAFHCCAP",29,0)
 ;
"RTN","VAFHCCAP",30,0)
 ;Appointments
"RTN","VAFHCCAP",31,0)
 I SDAMEVT=4!(SDAMEVT=5) D
"RTN","VAFHCCAP",32,0)
 .S DFN=$P(SDATA,"^",2),EVDT=$P(SDATA,"^",3),PTR=$$GETPTR^VAFHCUTL(1),PTR=PTR_";SCE(",(CHK,UP,REM)=""
"RTN","VAFHCCAP",33,0)
 .I SDAMEVT=4 S PTR=DFN_";DPT(" ;check-in or unscheduled visit check-in
"RTN","VAFHCCAP",34,0)
 .;Need to check if deleting check-out
"RTN","VAFHCCAP",35,0)
 .;if deleting check-out and no pivot file entry exists don't send
"RTN","VAFHCCAP",36,0)
 .I +$G(SDATA("AFTER","STATUS"))=3&(+$G(SDATA("BEFORE","STATUS"))=2) S CHK=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR),PTR=$$UPPTR(DFN,EVDT) S:PTR="@" REM=1 S:+CHK>0 UP=$$UPDATE^VAFHUTL(+CHK,EVDT,PTR,REM) S:+CHK<0!(+UP<0) SEND="N"
"RTN","VAFHCCAP",37,0)
 .;set send to N if deleting and not in pivot file
"RTN","VAFHCCAP",38,0)
 .I '$D(SEND) D
"RTN","VAFHCCAP",39,0)
 ..S HLD=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFHCCAP",40,0)
 ..I +HLD=-1 S HPTR=DFN_";DPT(",HLD=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,HPTR) I +HLD'=-1 S UP=$$UPDATE^VAFHUTL(+HLD,EVDT,PTR,"")
"RTN","VAFHCCAP",41,0)
 ..I +HLD=-1 S HLD=$$PIVNW^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFHCCAP",42,0)
 ..S EVENT=$P(HLD,":"),ERR=$$OA08^VAFHCA08(DFN,EVENT,EVDT,PTR,"2,3,4,5,6,7,8,9,11,12,13,14,16,19","2,3,4,5,6,7,8,9,10,11,12,13,14,15","A","A")
"RTN","VAFHCCAP",43,0)
 ;
"RTN","VAFHCCAP",44,0)
 ;Stop codes, Add/Edits
"RTN","VAFHCCAP",45,0)
 I SDAMEVT=6!(SDAMEVT=7) D
"RTN","VAFHCCAP",46,0)
 .N HLD,STOP,THLD,REMOVE,UP
"RTN","VAFHCCAP",47,0)
 .S HLD="",STOP="N",ERR=""
"RTN","VAFHCCAP",48,0)
 .F  K EVENT S REMOVE="N",HLD=$O(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD)) Q:HLD=""!(STOP="Y")  D
"RTN","VAFHCCAP",49,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")'=""&($P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^",6)'="") S STOP="Y" Q
"RTN","VAFHCCAP",50,0)
 ..;If STOP="Y" stop code was not stand alone
"RTN","VAFHCCAP",51,0)
 ..;If STOP="N" stop code is stand alone
"RTN","VAFHCCAP",52,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")="" D
"RTN","VAFHCCAP",53,0)
 ...S REMOVE="Y",DFN=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"BEFORE"),"^",2),EVDT=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"BEFORE"),"^"),PTR=HLD_";SCE("
"RTN","VAFHCCAP",54,0)
 ...S EVENT=$$PIVCHK^VAFHPIVT(DFN,EVDT,2,PTR)
"RTN","VAFHCCAP",55,0)
 ..I ^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER")'="" D
"RTN","VAFHCCAP",56,0)
 ...S DFN=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^",2),EVDT=$P(^TMP("SDEVT",$J,SDHDL,2,"SDOE",HLD,0,"AFTER"),"^"),PTR=HLD_";SCE("
"RTN","VAFHCCAP",57,0)
 ..I '$D(EVENT) S THLD=$$PIVNW^VAFHPIVT(DFN,EVDT,2,PTR),EVENT=$P(THLD,":")
"RTN","VAFHCCAP",58,0)
 ..I REMOVE="Y" S PTR="@",UP=$$UPDATE^VAFHUTL(+EVENT,EVDT,PTR,1)
"RTN","VAFHCCAP",59,0)
 ..I +EVENT>0 S ERR=$$OA08^VAFHCA08(DFN,EVENT,EVDT,PTR,"2,3,4,5,6,7,8,9,11,12,13,14,16,19","2,3,4,5,6,7,8,9,10,11,12,13,14,15","A","A")
"RTN","VAFHCCAP",60,0)
EXIT ;
"RTN","VAFHCCAP",61,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","VAFHCCAP",62,0)
 I +ERR<0 D ERROR(ERR,DFN)
"RTN","VAFHCCAP",63,0)
 D KILL^HLTRANS
"RTN","VAFHCCAP",64,0)
 Q
"RTN","VAFHCCAP",65,0)
 ;
"RTN","VAFHCCAP",66,0)
ERROR(PNUM,DFN) ;
"RTN","VAFHCCAP",67,0)
 ;Error message unable to generate A08 Message
"RTN","VAFHCCAP",68,0)
 N GBL S GBL="^TMP($J,""ERR"")"
"RTN","VAFHCCAP",69,0)
 I +PNUM<0 S @GBL@(0)="ERROR",@GBL@(1)=$P(PNUM,"^",2)_", unable to generate A08 Message" D EBULL^VAFHUTL2(DFN,"","",$P(GBL,")")_",")
"RTN","VAFHCCAP",70,0)
 Q
"RTN","VAFHCCAP",71,0)
 ;
"RTN","VAFHCCAP",72,0)
UPPTR(DFN,ADATE) ;
"RTN","VAFHCCAP",73,0)
 ;Have deleted checkout, update variable pointer
"RTN","VAFHCCAP",74,0)
 N PTR S PTR="@"
"RTN","VAFHCCAP",75,0)
 I $D(^DPT(DFN,"S",ADATE,0)) S PTR=DFN_";DPT("
"RTN","VAFHCCAP",76,0)
 Q PTR
"VER")
8.0^22
**END**
**END**
