EMERGENCY Released XT*7.3*73 SEQ #61
Extracted from mail message
**KIDS**:XT*7.3*73^

**INSTALL NAME**
XT*7.3*73
"BLD",674,0)
XT*7.3*73^TOOLKIT^0^3030603^y
"BLD",674,4,0)
^9.64PA^^
"BLD",674,"KRN",0)
^9.67PA^8989.52^19
"BLD",674,"KRN",.4,0)
.4
"BLD",674,"KRN",.401,0)
.401
"BLD",674,"KRN",.402,0)
.402
"BLD",674,"KRN",.403,0)
.403
"BLD",674,"KRN",.5,0)
.5
"BLD",674,"KRN",.84,0)
.84
"BLD",674,"KRN",3.6,0)
3.6
"BLD",674,"KRN",3.8,0)
3.8
"BLD",674,"KRN",9.2,0)
9.2
"BLD",674,"KRN",9.8,0)
9.8
"BLD",674,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",674,"KRN",9.8,"NM",1,0)
XDRMERG^^0^B74148658
"BLD",674,"KRN",9.8,"NM","B","XDRMERG",1)

"BLD",674,"KRN",19,0)
19
"BLD",674,"KRN",19.1,0)
19.1
"BLD",674,"KRN",101,0)
101
"BLD",674,"KRN",409.61,0)
409.61
"BLD",674,"KRN",771,0)
771
"BLD",674,"KRN",870,0)
870
"BLD",674,"KRN",8989.51,0)
8989.51
"BLD",674,"KRN",8989.52,0)
8989.52
"BLD",674,"KRN",8994,0)
8994
"BLD",674,"KRN","B",.4,.4)

"BLD",674,"KRN","B",.401,.401)

"BLD",674,"KRN","B",.402,.402)

"BLD",674,"KRN","B",.403,.403)

"BLD",674,"KRN","B",.5,.5)

"BLD",674,"KRN","B",.84,.84)

"BLD",674,"KRN","B",3.6,3.6)

"BLD",674,"KRN","B",3.8,3.8)

"BLD",674,"KRN","B",9.2,9.2)

"BLD",674,"KRN","B",9.8,9.8)

"BLD",674,"KRN","B",19,19)

"BLD",674,"KRN","B",19.1,19.1)

"BLD",674,"KRN","B",101,101)

"BLD",674,"KRN","B",409.61,409.61)

"BLD",674,"KRN","B",771,771)

"BLD",674,"KRN","B",870,870)

"BLD",674,"KRN","B",8989.51,8989.51)

"BLD",674,"KRN","B",8989.52,8989.52)

"BLD",674,"KRN","B",8994,8994)

"BLD",674,"QUES",0)
^9.62^^
"BLD",674,"REQB",0)
^9.611^1^1
"BLD",674,"REQB",1,0)
XT*7.3*54^1
"BLD",674,"REQB","B","XT*7.3*54",1)

"MBREQ")
0
"PKG",6,-1)
1^1
"PKG",6,0)
TOOLKIT^XT^PROGRAMMERS OPTIONS, MULTI. TERM LOOKUP^
"PKG",6,20,0)
^9.402P^^
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.3^2961029^2970513^2
"PKG",6,22,1,"PAH",1,0)
73^3030603
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XDRMERG")
0^1^B74148658
"RTN","XDRMERG",1,0)
XDRMERG ;SF-IRMFO.SEA/JLI - TENATIVE UPDATE POINTER NODES ;04/26/2001  08:17
"RTN","XDRMERG",2,0)
 ;;7.3;TOOLKIT;**23,34,38,44,45,49,54,73**;Apr 25, 1995
"RTN","XDRMERG",3,0)
 ;;
"RTN","XDRMERG",4,0)
 Q
"RTN","XDRMERG",5,0)
 ;
"RTN","XDRMERG",6,0)
 ; FILE is the file NUMBER of the file in which the pointed to fields
"RTN","XDRMERG",7,0)
 ;        are being merged (e.g., 2 or 200)
"RTN","XDRMERG",8,0)
 ; FROM is a root under which paired arrays of FROM and TO ien values
"RTN","XDRMERG",9,0)
 ;        may be found.  If internal entry number 275 were being merged
"RTN","XDRMERG",10,0)
 ;        merged into ien 75, and the array name to be used was XX,
"RTN","XDRMERG",11,0)
 ;        the data would be stored as ARRYNAME(FROMIEN,TOIEN) OR
"RTN","XDRMERG",12,0)
 ;        XX(275,75).  The call would be
"RTN","XDRMERG",13,0)
 ;
"RTN","XDRMERG",14,0)
 ;          D ENTRY^XDRMERG(2,"XX")
"RTN","XDRMERG",15,0)
 ;
"RTN","XDRMERG",16,0)
 ;    Any number of pairs may be in the From/To array, and the higher
"RTN","XDRMERG",17,0)
 ;    this number, the more efficient the conversion will be.
"RTN","XDRMERG",18,0)
 ;
"RTN","XDRMERG",19,0)
EN(FILE,FROM) ;
"RTN","XDRMERG",20,0)
 D RESTART(FILE,FROM)
"RTN","XDRMERG",21,0)
 Q
"RTN","XDRMERG",22,0)
 ;
"RTN","XDRMERG",23,0)
 ; The restart entry point permits the user to specify locations for
"RTN","XDRMERG",24,0)
 ; continuation of a previously interrupted merge process.  The
"RTN","XDRMERG",25,0)
 ; first two arguments are as indicated above for the EN entry point.
"RTN","XDRMERG",26,0)
 ; The next three arguments are optional, and should only be set for
"RTN","XDRMERG",27,0)
 ;    a restart of a merge which was interrupted in progress.  Even
"RTN","XDRMERG",28,0)
 ;    then these values could be omitted with minimal impact on the
"RTN","XDRMERG",29,0)
 ;    first two phases of the merge operation.
"RTN","XDRMERG",30,0)
 ;
"RTN","XDRMERG",31,0)
 ; XDRTYPE is an indicator of the phase of the merge process
"RTN","XDRMERG",32,0)
 ;
"RTN","XDRMERG",33,0)
 ; SFILE indicates the pointer file number from which processing
"RTN","XDRMERG",34,0)
 ;    should be continued.
"RTN","XDRMERG",35,0)
 ;
"RTN","XDRMERG",36,0)
 ; SENTRY indicates the internal entry number within SFILE from which
"RTN","XDRMERG",37,0)
 ;    processing should be continued
"RTN","XDRMERG",38,0)
 ;
"RTN","XDRMERG",39,0)
RESTART(FILE,FROM,XDRTYPE,SFILE,SENTRY) ;
"RTN","XDRMERG",40,0)
 ;
"RTN","XDRMERG",41,0)
 N XBASIS,CURRTYPE,CURRFIL,XBASE,X,XDRXT,XDRH1,XDRH2,XDRH3,XTYPE
"RTN","XDRMERG",42,0)
 N XDRFGLOB,VAFCA08,XDRDVALF,XDRFILE,DIQUIET,RGRSICN
"RTN","XDRMERG",43,0)
 S VAFCA08=1,XDRDVALF=1,DIQUIET=1,RGRSICN=1
"RTN","XDRMERG",44,0)
 ;
"RTN","XDRMERG",45,0)
 S XDRFGLOB=$G(^DIC(FILE,0,"GL")) Q:XDRFGLOB=""
"RTN","XDRMERG",46,0)
 ;
"RTN","XDRMERG",47,0)
 I $G(XDRTYPE)<2 D CHKFROM^XDRMERG2(FROM,FILE) ; check for self-pointers, circular, etc.
"RTN","XDRMERG",48,0)
 ;
"RTN","XDRMERG",49,0)
 S XDRGID=$O(@FROM@("")) I XDRGID="" Q
"RTN","XDRMERG",50,0)
 S XDRGID=FILE_U_XDRGID_U_$O(@FROM@(XDRGID,""))
"RTN","XDRMERG",51,0)
 S ^XTMP("XDRSTAT",0)=$$FMADD^XLFDT(DT,30)_U_DT
"RTN","XDRMERG",52,0)
 S ^XTMP("XDRSTAT",XDRGID,"START",$J)=$$NOW^XLFDT()
"RTN","XDRMERG",53,0)
 ;
"RTN","XDRMERG",54,0)
 I $G(XDRTYPE)<2 D
"RTN","XDRMERG",55,0)
 . S XDRTYPE=1
"RTN","XDRMERG",56,0)
 . D DOMAIN^XDRMERG2(FILE,FROM)
"RTN","XDRMERG",57,0)
 . S XDRTYPE=2
"RTN","XDRMERG",58,0)
 I $D(ZTSTOP) Q
"RTN","XDRMERG",59,0)
 ;
"RTN","XDRMERG",60,0)
LOOP ;
"RTN","XDRMERG",61,0)
 I $G(SFILE)="" S SFILE=0
"RTN","XDRMERG",62,0)
 I $G(SENTRY)="" S SENTRY=0
"RTN","XDRMERG",63,0)
 S CURRTYPE=XDRTYPE
"RTN","XDRMERG",64,0)
 ;
"RTN","XDRMERG",65,0)
 D SETUP(XDRTYPE) ; identify files and fields to be processed
"RTN","XDRMERG",66,0)
 ;
"RTN","XDRMERG",67,0)
 F CURRFIL=SFILE-.0000001:0 Q:$D(ZTSTOP)  S CURRFIL=$O(^TMP($J,"XFIL",CURRFIL)) Q:CURRFIL'>0  D
"RTN","XDRMERG",68,0)
 . I CURRFIL=1 Q
"RTN","XDRMERG",69,0)
 . I CURRFIL=15!(CURRFIL=15.4) Q
"RTN","XDRMERG",70,0)
 . I FILE=63,CURRFIL=2 Q
"RTN","XDRMERG",71,0)
 . ;
"RTN","XDRMERG",72,0)
 . I $D(XDRTHRED)>1,'$D(XDRTHRED(CURRFIL)) Q
"RTN","XDRMERG",73,0)
 . ;
"RTN","XDRMERG",74,0)
 . ;
"RTN","XDRMERG",75,0)
 . S XBASIS=^TMP($J,"XFIL",CURRFIL)
"RTN","XDRMERG",76,0)
 . I '$D(^TMP($J,"XGLOB",XBASIS)) D  I X'[XBASIS Q
"RTN","XDRMERG",77,0)
 . . S X=$O(^TMP($J,"XGLOB",XBASIS))
"RTN","XDRMERG",78,0)
 . S XDRXT=$$NOW^XLFDT()
"RTN","XDRMERG",79,0)
 . I $D(XDRFDA) D  I 1
"RTN","XDRMERG",80,0)
 . . S ^VA(15.2,XDRFDA,3,XDRFDA1,1)=XDRXT_U_CURRTYPE_U_CURRFIL_U
"RTN","XDRMERG",81,0)
 . E  D
"RTN","XDRMERG",82,0)
 . . S ^XTMP("XDRSTAT",XDRGID,"TIME",$J)=XDRXT_U_CURRTYPE_U_CURRFIL_U
"RTN","XDRMERG",83,0)
 . S XDRH1=XDRXT
"RTN","XDRMERG",84,0)
 . S ^XTMP("XDRSTAT",XDRGID,"FIL",XDRTYPE,CURRFIL)=XDRH1
"RTN","XDRMERG",85,0)
 . S XTYPE=$$TYPE^XDRMERG1(XBASIS),XBAS=XBASIS D  Q:$D(ZTSTOP)
"RTN","XDRMERG",86,0)
 . . I XDRTYPE=2 D  Q
"RTN","XDRMERG",87,0)
LOOP2 . . . I XTYPE="DINUM" D DINUM^XDRMERG2(XBAS,XBAS,"")
"RTN","XDRMERG",88,0)
 . . . I XTYPE'="" D XREFS^XDRMERG2(XBAS,XBAS,"")  ; LET DINUM IN TO CHECK FOR ANY OTHER XREFS UNDER XBAS
"RTN","XDRMERG",89,0)
 . . . S XBAS=$O(^TMP($J,"XGLOB",XBAS)) I XBAS[XBASIS S XTYPE=$$TYPE^XDRMERG1(XBAS) G LOOP2
"RTN","XDRMERG",90,0)
 . . . Q
"RTN","XDRMERG",91,0)
 . . D CHASE^XDRMERG1(XBASIS,XBASIS,"")
"RTN","XDRMERG",92,0)
 . S XDRH2=$$NOW^XLFDT()
"RTN","XDRMERG",93,0)
 . S XDRH3=$$FMDIFF^XLFDT(XDRH2,XDRH1,2)
"RTN","XDRMERG",94,0)
 . S ^XTMP("XDRSTAT",XDRGID,"FIL",XDRTYPE,CURRFIL)=XDRH1_U_XDRH2_U_XDRH3
"RTN","XDRMERG",95,0)
 ;
"RTN","XDRMERG",96,0)
 ;   hook to stop special xref clean-up after phase II
"RTN","XDRMERG",97,0)
 I $D(XDRFDA),$P(^VA(15.2,XDRFDA,0),U)="FIX XREF PROCESS" Q
"RTN","XDRMERG",98,0)
 I '$D(ZTSTOP),XDRTYPE=2  D  G LOOP ; NOW DO THE ONES WE HAVE TO HUNT
"RTN","XDRMERG",99,0)
 . S XDRTYPE=3
"RTN","XDRMERG",100,0)
 . S (SFILE,SENTRY)=0
"RTN","XDRMERG",101,0)
 . K XDRTHRD
"RTN","XDRMERG",102,0)
 . N I,MAXTHRED,THREADS S MAXTHRED=$P($G(^VA(15.1,FILE,1)),U),THREADS=$P($G(^(1)),U,2) S:'$D(XDRFDA) MAXTHRED=1 Q:MAXTHRED'>1  D SETUP(XDRTYPE)
"RTN","XDRMERG",103,0)
 . F I=1:1:MAXTHRED S XDRTHRD=$P(THREADS,";",I) Q:XDRTHRD'>0  D
"RTN","XDRMERG",104,0)
 . . S XDRTHRD(I,XDRTHRD)="" K ^TMP($J,"XFIL",XDRTHRD)
"RTN","XDRMERG",105,0)
 . S XDRTHRD=0 F  S I=$S(I'<MAXTHRED:1,1:I+1) S XDRTHRD=$O(^TMP($J,"XFIL",XDRTHRD)) Q:XDRTHRD'>0  S XDRTHRD(I,XDRTHRD)="" K ^TMP($J,"XFIL",XDRTHRD)
"RTN","XDRMERG",106,0)
 . F XDRTHRD=2:1:MAXTHRED,1 D
"RTN","XDRMERG",107,0)
 . . K XDRTHRED M XDRTHRED=XDRTHRD(XDRTHRD) S XDRTHRED=XDRTHRD
"RTN","XDRMERG",108,0)
 . . I XDRTHRD=1 D  Q
"RTN","XDRMERG",109,0)
 . . . F XDRTHRED=0:0 S XDRTHRED=$O(XDRTHRED(XDRTHRED)) Q:XDRTHRED'>0  S ^VA(15.2,XDRFDA,3,XDRFDA1,2,XDRTHRED,0)=XDRTHRED
"RTN","XDRMERG",110,0)
 . . S ZTRTN="DQTHREAD^XDRMERG0",ZTIO="",ZTDTH=$$NOW^XLFDT()
"RTN","XDRMERG",111,0)
 . . S ZTDESC="MERGE THREAD FOR "_XDRTHRD,ZTSAVE("XDRFDA")=""
"RTN","XDRMERG",112,0)
 . . S ZTSAVE("XDRTHRED")="",ZTSAVE("XDRTHRED(")="",ZTSAVE("XDRFILE")=FILE
"RTN","XDRMERG",113,0)
 . . D ^%ZTLOAD
"RTN","XDRMERG",114,0)
 . S XDRTHRED=""
"RTN","XDRMERG",115,0)
 ;
"RTN","XDRMERG",116,0)
 I $D(ZTSTOP) S ^XTMP("XDRSTAT",XDRGID,"HALT",$J)=$$NOW^XLFDT()
"RTN","XDRMERG",117,0)
 E  I '$D(XDRFDA) D
"RTN","XDRMERG",118,0)
 . D CLOSEIT
"RTN","XDRMERG",119,0)
 . S ^XTMP("XDRSTAT",XDRGID,"DONE",$J)=$$NOW^XLFDT()
"RTN","XDRMERG",120,0)
 Q
"RTN","XDRMERG",121,0)
CLOSEIT ;
"RTN","XDRMERG",122,0)
 I $D(XDRXFLG) Q  ; DON'T CLOSE IF JUST CHECKING
"RTN","XDRMERG",123,0)
 S:'$D(FILE) FILE=XDRFILE
"RTN","XDRMERG",124,0)
 S:'$D(FROM) FROM=$NA(^TMP("XDRFROM",$J)) ;FROM="XDRZZZ"
"RTN","XDRMERG",125,0)
 D SETUP(2)
"RTN","XDRMERG",126,0)
 S I="" F  S I=$O(^TMP($J,"XGLOB",I)) Q:I=""  D
"RTN","XDRMERG",127,0)
 . I I'["DA,",$P($G(^TMP($J,"XGLOB",I,0,1)),U,3)="DINUM" D
"RTN","XDRMERG",128,0)
 . . F XDRFR=0:0 S XDRFR=$O(@FROM@(XDRFR)) Q:XDRFR'>0  D
"RTN","XDRMERG",129,0)
 . . . K @(I_XDRFR_")")
"RTN","XDRMERG",130,0)
 I FILE'=2 D
"RTN","XDRMERG",131,0)
 . S I=^DIC(FILE,0,"GL")
"RTN","XDRMERG",132,0)
 . F XDRFR=0:0 S XDRFR=$O(@FROM@(XDRFR)) Q:XDRFR'>0  D
"RTN","XDRMERG",133,0)
 . . K @(I_XDRFR_")")
"RTN","XDRMERG",134,0)
 Q
"RTN","XDRMERG",135,0)
 ;
"RTN","XDRMERG",136,0)
SETUP(XDRTYPE) ; XDRTYPE=3 DOES NON-.01 FIELDS (AND .01 WITH NO DINUM OR X-REF)
"RTN","XDRMERG",137,0)
 N PFILE,PUFILE,PXFILE,PGLOB,PUFLD,PFLD,PNODE,PUNODE,NODE,PIECE,XREF,XGLOB,N,I,XREFFLAG,CHECK,STANDARD
"RTN","XDRMERG",138,0)
 ;
"RTN","XDRMERG",139,0)
 K ^TMP($J,"XGLO"),^TMP($J,"XGLOB"),^TMP($J,"XFIL")
"RTN","XDRMERG",140,0)
 N XDRDINUM S XDRDINUM(FILE)=""
"RTN","XDRMERG",141,0)
 N FILE
"RTN","XDRMERG",142,0)
 S FILE=""
"RTN","XDRMERG",143,0)
 F  S FILE=$O(XDRDINUM(FILE)) Q:FILE=""  D
"RTN","XDRMERG",144,0)
 . F PFILE=0:0 S PFILE=$O(^DD(FILE,0,"PT",PFILE)) Q:PFILE'>0  D
"RTN","XDRMERG",145,0)
 . . ;   skip Imaging files
"RTN","XDRMERG",146,0)
 . . Q:PFILE=2006.55
"RTN","XDRMERG",147,0)
 . . Q:PFILE=2006.552
"RTN","XDRMERG",148,0)
 . . S PUFILE=PFILE,N=0
"RTN","XDRMERG",149,0)
 . . F  Q:$D(^DIC(PUFILE,0,"GL"))  D  Q:PXFILE=""
"RTN","XDRMERG",150,0)
 . . . S PXFILE=$G(^DD(PUFILE,0,"UP")) I PXFILE="" Q
"RTN","XDRMERG",151,0)
 . . . S PUFLD=$O(^DD(PXFILE,"SB",PUFILE,0)) I PUFLD'>0 S PXFILE="" Q
"RTN","XDRMERG",152,0)
 . . . S PUNODE=$P($P(^DD(PXFILE,PUFLD,0),U,4),";")
"RTN","XDRMERG",153,0)
 . . . I PUNODE'=+PUNODE S PUNODE=""""_PUNODE_""""
"RTN","XDRMERG",154,0)
 . . . S N=N+1
"RTN","XDRMERG",155,0)
 . . . S PNODE(N)=PUNODE
"RTN","XDRMERG",156,0)
 . . . S PUFILE=PXFILE
"RTN","XDRMERG",157,0)
 . . I '$D(^DIC(PUFILE,0,"GL")) Q
"RTN","XDRMERG",158,0)
 . . K PGLOB
"RTN","XDRMERG",159,0)
 . . S PGLOB(0)=^DIC(PUFILE,0,"GL")
"RTN","XDRMERG",160,0)
 . . S ^TMP($J,"XFIL",PUFILE)=PGLOB(0)
"RTN","XDRMERG",161,0)
 . . S XGLOB=PGLOB(0)
"RTN","XDRMERG",162,0)
 . . F I=1:1 Q:N=0  D
"RTN","XDRMERG",163,0)
 . . . S PGLOB(I)=PGLOB(I-1)_"DA,"_PNODE(N)_","
"RTN","XDRMERG",164,0)
 . . . S N=N-1
"RTN","XDRMERG",165,0)
 . . . S ^TMP($J,"XGLO",PGLOB(I))=""
"RTN","XDRMERG",166,0)
 . . . S XGLOB=PGLOB(I)
"RTN","XDRMERG",167,0)
 . . F PFLD=0:0 S PFLD=$O(^DD(FILE,0,"PT",PFILE,PFLD)) Q:PFLD'>0  D
"RTN","XDRMERG",168,0)
 . . . I '$D(^DD(PFILE,PFLD,0)) Q
"RTN","XDRMERG",169,0)
 . . . I $P(^DD(PFILE,PFLD,0),U,2)'["V",$P(^(0),U,3)'=$E(^DIC(FILE,0,"GL"),2,200),PFILE'=53.51 Q  ; MAKE SURE POINTER IS 'REALLY' POINTING TO FILE (E.G., FIELD 400 IN FILE 60)
"RTN","XDRMERG",170,0)
 . . . S NODE=$P($G(^DD(PFILE,PFLD,0)),U,4)
"RTN","XDRMERG",171,0)
 . . . I NODE="" Q
"RTN","XDRMERG",172,0)
 . . . S PIECE=$P(NODE,";",2)
"RTN","XDRMERG",173,0)
 . . . S NODE=$P(NODE,";")
"RTN","XDRMERG",174,0)
 . . . I NODE'=+NODE S NODE=""""_NODE_""""
"RTN","XDRMERG",175,0)
 . . . S XREF=""
"RTN","XDRMERG",176,0)
 . . . I PFLD=.01,$D(^DIC(PFILE,0)) D  ; MODIFIED 03/24/99 - JLI USE DINUM ONLY AT TOP OF FILE
"RTN","XDRMERG",177,0)
 . . . . I ^DD(PFILE,PFLD,0)["DINUM" D
"RTN","XDRMERG",178,0)
 . . . . . S XREF="DINUM"
"RTN","XDRMERG",179,0)
 . . . . . S XDRDINUM(PFILE)=""
"RTN","XDRMERG",180,0)
 . . . ;
"RTN","XDRMERG",181,0)
 . . . ; the following section of code was modified to identify any pointer value reachable with
"RTN","XDRMERG",182,0)
 . . . ; a cross-reference whether top level or in a subfile.  The x-reference is checked for
"RTN","XDRMERG",183,0)
 . . . ; the expected value for at least ten entries before being considered valid
"RTN","XDRMERG",184,0)
 . . . ; 03/24/99 - JLI
"RTN","XDRMERG",185,0)
 . . . ;
"RTN","XDRMERG",186,0)
 . . . I XREF="" D
"RTN","XDRMERG",187,0)
 . . . . N J,K,L,X1,NMAX,GLOBPCS,YGLOB,KN,KI,NCNT
"RTN","XDRMERG",188,0)
 . . . . S NMAX=$L(XGLOB,"DA,") F J=1:1:NMAX S GLOBPCS(J)=$P(XGLOB,"DA,",J)
"RTN","XDRMERG",189,0)
 . . . . F J=0:0 Q:XREF'=""  S J=$O(^DD(PFILE,PFLD,1,J)) Q:J'>0  D
"RTN","XDRMERG",190,0)
 . . . . . S X1=$P($G(^DD(PFILE,PFLD,1,J,0)),U,2)
"RTN","XDRMERG",191,0)
 . . . . . Q:X1=""
"RTN","XDRMERG",192,0)
 . . . . . I X1'=+X1 S X1=""""_X1_""""
"RTN","XDRMERG",193,0)
 . . . . . S K="" F KN=1:1 S K=$O(@(GLOBPCS(1)_X1_","_$S(K'=+K:""""_K_"""",1:K)_")")) Q:K=""!(XREF'="")  D  S:KN>10&(XREF="") XREF=X1_U_J I KN>10 Q  ; global value used as naked global on next line
"RTN","XDRMERG",194,0)
 . . . . . . S YGLOB=GLOBPCS(1),L=K,NCNT=0 F KI=1:1:NMAX S L=$O(^(L,"")) Q:L'>0!(L'=+L)  S NCNT=NCNT+1,YGLOB=YGLOB_L_","_$S(NCNT<NMAX:GLOBPCS(KI+1),1:"") ; naked global used on above line and within loop (descending subscripts)
"RTN","XDRMERG",195,0)
 . . . . . . I NCNT'=NMAX S XREF=-1 Q
"RTN","XDRMERG",196,0)
 . . . . . . I $E($P($G(@(YGLOB_NODE_")")),U,PIECE),1,30)'=K S XREF=-1 ; MODIFIED 3/19/99 JLI
"RTN","XDRMERG",197,0)
 . . . . . I XREF=-1 S XREF=""
"RTN","XDRMERG",198,0)
 . . . I XREF'="",(XREF'="DINUM") D  ;modified 3/6/2003 JDS XT*7.3*73
"RTN","XDRMERG",199,0)
 . . . . S CHECK=^DD(PFILE,PFLD,1,$P(XREF,U,2),1)
"RTN","XDRMERG",200,0)
 . . . . S STANDARD="S "_PGLOB(0)_$P(XREF,U)_",$E(X,1,30),DA"
"RTN","XDRMERG",201,0)
 . . . . I CHECK'[STANDARD S XREF=""
"RTN","XDRMERG",202,0)
 . . . I XREF'=""&(XDRTYPE'=3) S ^TMP($J,"XGLOB",XGLOB,NODE,PIECE)=PFILE_U_PFLD_U_XREF
"RTN","XDRMERG",203,0)
 . . . I (XREF=""&(XDRTYPE=3)) S ^TMP($J,"XGLOB",XGLOB,NODE,PIECE)=$S(XDRTYPE'=3:PFILE_U_PFLD_U_XREF,$O(^DD(PFILE,PFLD,1,0))>0:PFILE_U_PFLD,1:"")
"RTN","XDRMERG",204,0)
 . . . ; END OF CHANGES 03/24/99 - JLI
"RTN","XDRMERG",205,0)
 Q
"VER")
8.0^22.0
**END**
**END**
