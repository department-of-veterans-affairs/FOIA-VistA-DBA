Released PSJ*5*136 SEQ #124
Extracted from mail message
**KIDS**:PSJ*5.0*136^

**INSTALL NAME**
PSJ*5.0*136
"BLD",5284,0)
PSJ*5.0*136^INPATIENT MEDICATIONS^0^3050411^y
"BLD",5284,1,0)
^^32^32^3050222^
"BLD",5284,1,1,0)
 PSI-04-061: Expected First Dose
"BLD",5284,1,2,0)
 -------------------------------
"BLD",5284,1,3,0)
 During order entry in CPRS the provider is presented with the "Expected 
"BLD",5284,1,4,0)
 First Dose" for the order.  The Pharmacist's have requested that the 
"BLD",5284,1,5,0)
 "Expected First Dose" be displayed in Backdoor pharmacy when Start Date, 
"BLD",5284,1,6,0)
 Stop Date and Admin Times are entered or edited.
"BLD",5284,1,7,0)
 
"BLD",5284,1,8,0)
 This change will require the "Expected First Dose" to be displayed after 
"BLD",5284,1,9,0)
 the Stop Date is entered in New or Renewed orders as well as when the 
"BLD",5284,1,10,0)
 Start Date, Stop Date and/or Admin Times fields are edited.  During the 
"BLD",5284,1,11,0)
 edit process it is possible to edit one or all of these fields in any 
"BLD",5284,1,12,0)
 order.  This could cause the "Expected First Dose" to be displayed 
"BLD",5284,1,13,0)
 multiple times.  This will be handled by determining the last field
"BLD",5284,1,14,0)
 that was edited and displaying the "Expected first dose" only after that
"BLD",5284,1,15,0)
 field.
"BLD",5284,1,16,0)
 
"BLD",5284,1,17,0)
 
"BLD",5284,1,18,0)
 PSI-04-071: Provider Comments Display
"BLD",5284,1,19,0)
 -------------------------------------
"BLD",5284,1,20,0)
 When the pharmacist is presented with the question to "Copy provider 
"BLD",5284,1,21,0)
 comments", the provider comments do not appear on the screen.  A change
"BLD",5284,1,22,0)
 will be made to display the provider comments prior to asking the  
"BLD",5284,1,23,0)
 question "Copy the Provider Comments into Special Instructions?".
"BLD",5284,1,24,0)
 
"BLD",5284,1,25,0)
 
"BLD",5284,1,26,0)
 PSI-05-005: Administration Time being over written on child orders
"BLD",5284,1,27,0)
 ------------------------------------------------------------------
"BLD",5284,1,28,0)
 When finishing a renewed complex order from Inpatient Order Entry [PSJ 
"BLD",5284,1,29,0)
 OE] option, the administration times for the second and subsequent child 
"BLD",5284,1,30,0)
 orders in the series are changed to the administration time of the first 
"BLD",5284,1,31,0)
 order in the series. A change will be made to preserve the 
"BLD",5284,1,32,0)
 administration time for all orders within a complex order.
"BLD",5284,4,0)
^9.64PA^^
"BLD",5284,"KRN",0)
^9.67PA^8989.52^19
"BLD",5284,"KRN",.4,0)
.4
"BLD",5284,"KRN",.401,0)
.401
"BLD",5284,"KRN",.402,0)
.402
"BLD",5284,"KRN",.403,0)
.403
"BLD",5284,"KRN",.5,0)
.5
"BLD",5284,"KRN",.84,0)
.84
"BLD",5284,"KRN",3.6,0)
3.6
"BLD",5284,"KRN",3.8,0)
3.8
"BLD",5284,"KRN",9.2,0)
9.2
"BLD",5284,"KRN",9.8,0)
9.8
"BLD",5284,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",5284,"KRN",9.8,"NM",1,0)
PSGOE41^^0^B15025855
"BLD",5284,"KRN",9.8,"NM",2,0)
PSGOE81^^0^B21221443
"BLD",5284,"KRN",9.8,"NM",3,0)
PSGOE91^^0^B24153403
"BLD",5284,"KRN",9.8,"NM",4,0)
PSGOER0^^0^B21577841
"BLD",5284,"KRN",9.8,"NM",5,0)
PSJCOMR^^0^B76222009
"BLD",5284,"KRN",9.8,"NM",6,0)
PSJUTL^^0^B55612120
"BLD",5284,"KRN",9.8,"NM","B","PSGOE41",1)

"BLD",5284,"KRN",9.8,"NM","B","PSGOE81",2)

"BLD",5284,"KRN",9.8,"NM","B","PSGOE91",3)

"BLD",5284,"KRN",9.8,"NM","B","PSGOER0",4)

"BLD",5284,"KRN",9.8,"NM","B","PSJCOMR",5)

"BLD",5284,"KRN",9.8,"NM","B","PSJUTL",6)

"BLD",5284,"KRN",19,0)
19
"BLD",5284,"KRN",19.1,0)
19.1
"BLD",5284,"KRN",101,0)
101
"BLD",5284,"KRN",409.61,0)
409.61
"BLD",5284,"KRN",771,0)
771
"BLD",5284,"KRN",870,0)
870
"BLD",5284,"KRN",8989.51,0)
8989.51
"BLD",5284,"KRN",8989.52,0)
8989.52
"BLD",5284,"KRN",8994,0)
8994
"BLD",5284,"KRN","B",.4,.4)

"BLD",5284,"KRN","B",.401,.401)

"BLD",5284,"KRN","B",.402,.402)

"BLD",5284,"KRN","B",.403,.403)

"BLD",5284,"KRN","B",.5,.5)

"BLD",5284,"KRN","B",.84,.84)

"BLD",5284,"KRN","B",3.6,3.6)

"BLD",5284,"KRN","B",3.8,3.8)

"BLD",5284,"KRN","B",9.2,9.2)

"BLD",5284,"KRN","B",9.8,9.8)

"BLD",5284,"KRN","B",19,19)

"BLD",5284,"KRN","B",19.1,19.1)

"BLD",5284,"KRN","B",101,101)

"BLD",5284,"KRN","B",409.61,409.61)

"BLD",5284,"KRN","B",771,771)

"BLD",5284,"KRN","B",870,870)

"BLD",5284,"KRN","B",8989.51,8989.51)

"BLD",5284,"KRN","B",8989.52,8989.52)

"BLD",5284,"KRN","B",8994,8994)

"BLD",5284,"QUES",0)
^9.62^^
"BLD",5284,"REQB",0)
^9.611^3^2
"BLD",5284,"REQB",2,0)
PSJ*5.0*111^2
"BLD",5284,"REQB",3,0)
PSJ*5.0*127^2
"BLD",5284,"REQB","B","PSJ*5.0*111",2)

"BLD",5284,"REQB","B","PSJ*5.0*127",3)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
136^3050411
"PKG",197,22,1,"PAH",1,1,0)
^^32^32^3050411
"PKG",197,22,1,"PAH",1,1,1,0)
 PSI-04-061: Expected First Dose
"PKG",197,22,1,"PAH",1,1,2,0)
 -------------------------------
"PKG",197,22,1,"PAH",1,1,3,0)
 During order entry in CPRS the provider is presented with the "Expected 
"PKG",197,22,1,"PAH",1,1,4,0)
 First Dose" for the order.  The Pharmacist's have requested that the 
"PKG",197,22,1,"PAH",1,1,5,0)
 "Expected First Dose" be displayed in Backdoor pharmacy when Start Date, 
"PKG",197,22,1,"PAH",1,1,6,0)
 Stop Date and Admin Times are entered or edited.
"PKG",197,22,1,"PAH",1,1,7,0)
 
"PKG",197,22,1,"PAH",1,1,8,0)
 This change will require the "Expected First Dose" to be displayed after 
"PKG",197,22,1,"PAH",1,1,9,0)
 the Stop Date is entered in New or Renewed orders as well as when the 
"PKG",197,22,1,"PAH",1,1,10,0)
 Start Date, Stop Date and/or Admin Times fields are edited.  During the 
"PKG",197,22,1,"PAH",1,1,11,0)
 edit process it is possible to edit one or all of these fields in any 
"PKG",197,22,1,"PAH",1,1,12,0)
 order.  This could cause the "Expected First Dose" to be displayed 
"PKG",197,22,1,"PAH",1,1,13,0)
 multiple times.  This will be handled by determining the last field
"PKG",197,22,1,"PAH",1,1,14,0)
 that was edited and displaying the "Expected first dose" only after that
"PKG",197,22,1,"PAH",1,1,15,0)
 field.
"PKG",197,22,1,"PAH",1,1,16,0)
 
"PKG",197,22,1,"PAH",1,1,17,0)
 
"PKG",197,22,1,"PAH",1,1,18,0)
 PSI-04-071: Provider Comments Display
"PKG",197,22,1,"PAH",1,1,19,0)
 -------------------------------------
"PKG",197,22,1,"PAH",1,1,20,0)
 When the pharmacist is presented with the question to "Copy provider 
"PKG",197,22,1,"PAH",1,1,21,0)
 comments", the provider comments do not appear on the screen.  A change
"PKG",197,22,1,"PAH",1,1,22,0)
 will be made to display the provider comments prior to asking the  
"PKG",197,22,1,"PAH",1,1,23,0)
 question "Copy the Provider Comments into Special Instructions?".
"PKG",197,22,1,"PAH",1,1,24,0)
 
"PKG",197,22,1,"PAH",1,1,25,0)
 
"PKG",197,22,1,"PAH",1,1,26,0)
 PSI-05-005: Administration Time being over written on child orders
"PKG",197,22,1,"PAH",1,1,27,0)
 ------------------------------------------------------------------
"PKG",197,22,1,"PAH",1,1,28,0)
 When finishing a renewed complex order from Inpatient Order Entry [PSJ 
"PKG",197,22,1,"PAH",1,1,29,0)
 OE] option, the administration times for the second and subsequent child 
"PKG",197,22,1,"PAH",1,1,30,0)
 orders in the series are changed to the administration time of the first 
"PKG",197,22,1,"PAH",1,1,31,0)
 order in the series. A change will be made to preserve the 
"PKG",197,22,1,"PAH",1,1,32,0)
 administration time for all orders within a complex order.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PSGOE41")
0^1^B15025855
"RTN","PSGOE41",1,0)
PSGOE41 ;BIR/CML3-REGULAR ORDER ENTRY (CONT.) ;09 JAN 97 / 9:13 AM 
"RTN","PSGOE41",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,63,64,69,58,111,136**;16 DEC 97
"RTN","PSGOE41",3,0)
 ;
"RTN","PSGOE41",4,0)
 ; Reference to %DT is supported by DBIA 10003.
"RTN","PSGOE41",5,0)
 ; Reference to %DTC is supported by DBIA 10000.
"RTN","PSGOE41",6,0)
 ; Reference to ^DICN is supported by DBIA 10009.
"RTN","PSGOE41",7,0)
 ;
"RTN","PSGOE41",8,0)
39 ; admin times
"RTN","PSGOE41",9,0)
 G:$P(PSGNEDFD,"^",3)="P" 8
"RTN","PSGOE41",10,0)
 I $$ODD^PSGS0(PSGS0XT) G 8
"RTN","PSGOE41",11,0)
 W !,"ADMIN TIMES: "_$S(PSGS0Y:PSGS0Y_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",12,0)
 I X="",($G(PSGS0XT)'="D") S PSGFOK(39)="" G 8
"RTN","PSGOE41",13,0)
 I X="",$G(PSGS0XT)="D" I $L(PSGSCH,"@")=2,$P(PSGSCH,"@",2) S (PSGAT,PSGS0Y)=$P(PSGSCH,"@",2) G 8
"RTN","PSGOE41",14,0)
 S PSGF2=39 I $E(X)="^" D FF G:Y>0 @Y G 39
"RTN","PSGOE41",15,0)
 I (PSGS0XT="D")&('$G(X)!(X["@"&($P($G(X),"@",2)))) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G 39
"RTN","PSGOE41",16,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE41",17,0)
 ;I X="@",'PSGS0Y!(PSGS0XT="D")!(PSGSCH["@") W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",18,0)
 I X="@" D DEL G:%'=1 39 S (PSGFOK(39),PSGS0Y)="" G 8
"RTN","PSGOE41",19,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",20,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,39) G 39
"RTN","PSGOE41",21,0)
 S (PSGAT,PSGS0Y)=X,PSGFOK(39)=""
"RTN","PSGOE41",22,0)
 ;
"RTN","PSGOE41",23,0)
8 ; special instructions
"RTN","PSGOE41",24,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":$P(PSGSI,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",25,0)
 I X="" S X=PSGSI I X="" S PSGFOK(8)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",26,0)
 S PSGF2=8 I $E(X)="^" D FF G:Y>0 @Y G 8
"RTN","PSGOE41",27,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",28,0)
 I X="@" D DEL G:%'=1 8 S (PSGFOK(8),PSGSI)="" G:'$G(PSGOE3) 10
"RTN","PSGOE41",29,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",30,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G 8
"RTN","PSGOE41",31,0)
 S PSGSI=X I PSGSI]"" S PSGSI=$$ENBCMA^PSJUTL("U"),PSGFOK(8)=""
"RTN","PSGOE41",32,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",33,0)
 ;
"RTN","PSGOE41",34,0)
10 ; start date/time
"RTN","PSGOE41",35,0)
 D ^PSGNE3
"RTN","PSGOE41",36,0)
 S:'$D(PSGNESDO) PSGNESDO=$$ENDD^PSGMI(PSGNESD) S PSGSD=PSGNESDO
"RTN","PSGOE41",37,0)
A10 W !,"START DATE/TIME: "_PSGSD_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",38,0)
 I X="",PSGNESD W "  "_PSGSD G O25
"RTN","PSGOE41",39,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGNESD=+X,PSGSD=$$ENDD^PSGMI(+X) W "  ",PSGSD G O25
"RTN","PSGOE41",40,0)
 S PSGF2=10 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE41",41,0)
 I $E(X)="^" D FF G:Y>0 @Y G A10
"RTN","PSGOE41",42,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE41",43,0)
 S PSGNESD=+Y,PSGSD=$$ENDD^PSGMI(+Y),(PSGNEFD,PSGFD)=""
"RTN","PSGOE41",44,0)
 ;
"RTN","PSGOE41",45,0)
O25 ;
"RTN","PSGOE41",46,0)
 S PSGFOK(10)="" I $P(PSGNEDFD,"^",3)="O" S PSGNEFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGNESD,PSGP) I PSGNEFD]"" S PSGFD=$$ENDD^PSGMI(PSGNEFD)
"RTN","PSGOE41",47,0)
 ;
"RTN","PSGOE41",48,0)
25 ; stop date
"RTN","PSGOE41",49,0)
 Q:$G(PSGOE3)
"RTN","PSGOE41",50,0)
 I 'PSGNEFD D ENFD^PSGNE3(PSGDT) S PSGFD=PSGNEFDO
"RTN","PSGOE41",51,0)
A25 W !,"STOP DATE/TIME: "_$S(PSGFD]"":PSGFD_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOROE1=1 G DONE
"RTN","PSGOE41",52,0)
 I X="",PSGNEFD W "   "_PSGFD S PSGFOK(25)=""  G W25
"RTN","PSGOE41",53,0)
 S PSGF2=25 I $E(X)="^" D FF G:Y>0 @Y G A25
"RTN","PSGOE41",54,0)
 ;I X=+X,(X'>0) S X="?"
"RTN","PSGOE41",55,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE41",56,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D EN1^PSGDL
"RTN","PSGOE41",57,0)
 K %DT S %DT="ERTX",%DT(0)=PSGNESD D ^%DT K %DT G:Y'>0 A25 S PSGNEFD=+Y,PSGFD=$$ENDD^PSGMI(+Y),PSGFOK(25)=""
"RTN","PSGOE41",58,0)
W25 I PSGNEFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOE41",59,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE41",60,0)
 D EFDNEW^PSJUTL
"RTN","PSGOE41",61,0)
 ;
"RTN","PSGOE41",62,0)
NEXT ;
"RTN","PSGOE41",63,0)
 ;G:$S($D(PSJOERR):0,+PSJSYSU=3:1,1:'$P(PSJSYSU,";",2)) 1^PSGOE42 G:$P(PSJSYSW0,"^",24) 5^PSGOE42 G:PSGOEORF&'$P(PSJSYSU,";",2) 106^PSGOE42
"RTN","PSGOE41",64,0)
 G 1^PSGOE42
"RTN","PSGOE41",65,0)
 ;
"RTN","PSGOE41",66,0)
DONE ;
"RTN","PSGOE41",67,0)
 I PSGOROE1 K Y W $C(7),"  ...order not entered..."
"RTN","PSGOE41",68,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE41",69,0)
 ;
"RTN","PSGOE41",70,0)
FF ; up-arrow to another field
"RTN","PSGOE41",71,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE4"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:$P(Y,U)=2 FB=PSGF2_"^PSGOE41"
"RTN","PSGOE41",72,0)
 Q
"RTN","PSGOE41",73,0)
 ;
"RTN","PSGOE41",74,0)
DEL ; delete entry
"RTN","PSGOE41",75,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE41",76,0)
 Q
"RTN","PSGOE81")
0^2^B21221443
"RTN","PSGOE81",1,0)
PSGOE81 ;BIR/CML3-NON-VERIFIED ORDER EDIT (CONT.) ;10 Mar 99 / 10:55 AM
"RTN","PSGOE81",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**26,50,64,58,82,110,111,136**;16 DEC 97
"RTN","PSGOE81",3,0)
 ;
"RTN","PSGOE81",4,0)
39 ; admin times
"RTN","PSGOE81",5,0)
 S MSG=0,PSGF2=39 S:PSGOEEF(PSGF2) BACK="39^PSGOE81"
"RTN","PSGOE81",6,0)
A39 I $$ODD^PSGS0(PSGS0XT) G DONE
"RTN","PSGOE81",7,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",8,0)
 I X="" S:(($G(PSGS0XT)="D")&'PSGS0Y) PSGOEE=0 G DONE
"RTN","PSGOE81",9,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A39
"RTN","PSGOE81",10,0)
 I PSGS0XT="D"&'$G(X) I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A39
"RTN","PSGOE81",11,0)
 .W $C(7),"  ??" S X="?" W !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(53.1,39)
"RTN","PSGOE81",12,0)
 I X="@" D DEL G:%'=1 A39 S PSGAT="" G DONE
"RTN","PSGOE81",13,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",14,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,39) G A39
"RTN","PSGOE81",15,0)
 S (PSGS0Y,PSGAT)=X,PSGS0Y=PSGAT G DONE
"RTN","PSGOE81",16,0)
 ;
"RTN","PSGOE81",17,0)
8 ; special instructions
"RTN","PSGOE81",18,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE81"
"RTN","PSGOE81",19,0)
A8 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(53.1,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE81",20,0)
 I $E(X)=U D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",21,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",22,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE81",23,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE81",24,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE81",25,0)
 Q
"RTN","PSGOE81",26,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",27,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE81",28,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A8
"RTN","PSGOE81",29,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",30,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE81",31,0)
 I X?1."?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",32,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(53.1,8) G A8
"RTN","PSGOE81",33,0)
 S PSGSI=X G DONE
"RTN","PSGOE81",34,0)
 ;
"RTN","PSGOE81",35,0)
10 ; start date/time
"RTN","PSGOE81",36,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE81"
"RTN","PSGOE81",37,0)
A10 ;
"RTN","PSGOE81",38,0)
 K PSGSDX N DUR,DURMIN,TMPFD
"RTN","PSGOE81",39,0)
 I $G(PSGORD)["P",$G(PSGP) I $$LASTREN^PSJLMPRI(PSGP,PSGORD) D  Q
"RTN","PSGOE81",40,0)
 . W !?5,"Start Date may not be edited at this point. " D PAUSE^VALM1
"RTN","PSGOE81",41,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",42,0)
 I X="",PSGSD W "  "_$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",43,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE81",44,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,10)
"RTN","PSGOE81",45,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A10
"RTN","PSGOE81",46,0)
 NEW TMPX S TMPX=X,X1=+$G(PSGLI),X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(53.1,10) G A10
"RTN","PSGOE81",47,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE81",48,0)
 S (PSGSDX,PSGSD,PSGNESD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD)
"RTN","PSGOE81",49,0)
 I $G(PSGORD)["P",$G(PSGP) S DUR=$$GETDUR^PSJLIVMD(PSGP,+PSGORD,"P",1) I DUR]"" S DURMIN=$$DURMIN^PSJLIVMD(DUR) I DURMIN D
"RTN","PSGOE81",50,0)
 . S TMPFD=$$FMADD^XLFDT(PSGSD,,,DURMIN) K:(TMPFD<PSGSD) TMPFD I $G(TMPFD) S PSGFD=TMPFD,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE81",51,0)
 G DONE
"RTN","PSGOE81",52,0)
 ;
"RTN","PSGOE81",53,0)
25 ; stop date
"RTN","PSGOE81",54,0)
 S MSG=0,PSGF2=25 S:PSGOEEF(PSGF2) BACK="25^PSGOE81"
"RTN","PSGOE81",55,0)
A25 ;
"RTN","PSGOE81",56,0)
 K PSGFDX
"RTN","PSGOE81",57,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE81",58,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W25
"RTN","PSGOE81",59,0)
 I $E(X)="^" D ENFF^PSGOE82 G:Y>0 @Y G A25
"RTN","PSGOE81",60,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(53.1,25)
"RTN","PSGOE81",61,0)
 I X=+X,(X>0),(X'>2000000) G A25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE81",62,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A25 S (PSGFDX,PSGFD,PSGNEFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD) ; I $P(PSGNEDFD,"^",3)="O",PSGNESD'=PSGNEFD S PSGNESD=PSGNEFD,PSGSD=PSGFD
"RTN","PSGOE81",63,0)
W25 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE81",64,0)
 ;
"RTN","PSGOE81",65,0)
 ;
"RTN","PSGOE81",66,0)
DONE ;
"RTN","PSGOE81",67,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE81",68,0)
 D EFDNV^PSJUTL
"RTN","PSGOE81",69,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE81",70,0)
 Q
"RTN","PSGOE81",71,0)
 ;
"RTN","PSGOE81",72,0)
FF ; up-arrow to another field
"RTN","PSGOE81",73,0)
 D ENFF^PSGOEM I Y>0,Y'=39,Y'=8,Y'=10,Y'=25 S Y=Y_"^PSGOE8"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE81"
"RTN","PSGOE81",74,0)
 Q
"RTN","PSGOE81",75,0)
 ;
"RTN","PSGOE81",76,0)
DEL ; delete entry
"RTN","PSGOE81",77,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE81",78,0)
 Q
"RTN","PSGOE91")
0^3^B24153403
"RTN","PSGOE91",1,0)
PSGOE91 ;BIR/CML3-ACTIVE ORDER EDIT (CONT.) ;10 JUL 96 / 7:54 AM
"RTN","PSGOE91",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**50,64,58,110,111,136**;16 DEC 97
"RTN","PSGOE91",3,0)
 ;
"RTN","PSGOE91",4,0)
 ;Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOE91",5,0)
 ;
"RTN","PSGOE91",6,0)
41 ; admin times
"RTN","PSGOE91",7,0)
 S MSG=0,PSGF2=41 S:PSGOEEF(PSGF2) BACK="41^PSGOE91"
"RTN","PSGOE91",8,0)
 I $$ODD^PSGS0(PSGS0XT) G DONE
"RTN","PSGOE91",9,0)
A41 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",10,0)
 . W !!?5,"ADMIN TIMES may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",11,0)
 W !,"ADMIN TIMES: "_$S(PSGAT:PSGAT_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",12,0)
 I X="" G DONE
"RTN","PSGOE91",13,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A41
"RTN","PSGOE91",14,0)
 I X="@",'PSGAT!(PSGS0XT="D")!(PSGSCH["@") I ((",P,R,")'[(","_$G(PSGST)_",")) D  G A41
"RTN","PSGOE91",15,0)
 .W $C(7),"  ??" S X="?" W:PSGS0XT="D"!(PSGSCH["@") !,"This is a 'DAY OF THE WEEK' schedule and MUST have admin times." D ENHLP^PSGOEM(55.06,41)
"RTN","PSGOE91",16,0)
 I X="@" D DEL G:%'=1 A41 S PSGAT="" G DONE
"RTN","PSGOE91",17,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",18,0)
 D ENCHK^PSGS0 I '$D(X) W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,41) G A41
"RTN","PSGOE91",19,0)
 S (PSGS0Y,PSGAT)=X G DONE
"RTN","PSGOE91",20,0)
 ;
"RTN","PSGOE91",21,0)
8 ; special instructions
"RTN","PSGOE91",22,0)
 S MSG=0,PSGF2=8 S:PSGOEEF(PSGF2) BACK="8^PSGOE91"
"RTN","PSGOE91",23,0)
A8 I $G(PSGP),$G(PSGORD) I $$COMPLEX^PSJOE(PSGP,PSGORD) D
"RTN","PSGOE91",24,0)
 . N X,Y,PARENT,P2ND S P2ND=$S(PSGORD["U":$G(^PS(55,PSGP,5,+PSGORD,.2)),1:$G(^PS(53.1,+PSGORD,.2))),PARENT=$P(P2ND,"^",8)
"RTN","PSGOE91",25,0)
 . I PARENT D FULL^VALM1 W !!?5,"This order is part of a complex order. Please review the following ",!?5,"associated orders before changing this order." D CMPLX^PSJCOM1(PSGP,PARENT,PSGORD)
"RTN","PSGOE91",26,0)
 N DIR S DIR(0)="FO^1:180^D ^PSGSICHK",DIR("A")="SPECIAL INSTRUCTIONS",DIR("??")="^D ENHLP^PSGOEM(55.06,8)" S:$G(PSGSI)]"" DIR("B")=$P(PSGSI,"^") D ^DIR I $D(DUOUT)!$D(DTOUT) S PSGOEE=0 G DONE
"RTN","PSGOE91",27,0)
 I $E(X)=U D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",28,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",29,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",30,0)
 I Y="",PSGSI="" G DONE
"RTN","PSGOE91",31,0)
 S PSGSI=$S(Y]"":Y,1:PSGSI),PSGSI=$$ENBCMA^PSJUTL("U") G DONE
"RTN","PSGOE91",32,0)
 Q
"RTN","PSGOE91",33,0)
 W !,"SPECIAL INSTRUCTIONS: "_$S(PSGSI]"":PSGSI_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",34,0)
 I X="" S X=PSGSI I X="" G DONE
"RTN","PSGOE91",35,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A8
"RTN","PSGOE91",36,0)
 I X="@",PSGSI="" W $C(7),"  ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",37,0)
 I X="@" D DEL G:%'=1 A8 S PSGSI="" G DONE
"RTN","PSGOE91",38,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",39,0)
 D ^PSGSICHK I '$D(X) W $C(7)," ??" S X="?" D ENHLP^PSGOEM(55.06,8) G A8
"RTN","PSGOE91",40,0)
 S PSGSI=X G DONE
"RTN","PSGOE91",41,0)
 ;
"RTN","PSGOE91",42,0)
10 ; start date/time
"RTN","PSGOE91",43,0)
 S MSG=0,PSGF2=10 S:PSGOEEF(PSGF2) BACK="10^PSGOE91"
"RTN","PSGOE91",44,0)
A10 ;
"RTN","PSGOE91",45,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",46,0)
 . W !!?5,"Start Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",47,0)
 K PSGSDX
"RTN","PSGOE91",48,0)
 W !,"START DATE/TIME: "_$S($P(PSGSDN,"^")]"":$P(PSGSDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",49,0)
 I X="",PSGSD W "  "_PSGSDN G DONE
"RTN","PSGOE91",50,0)
 I X="P" D ENPREV^PSGDL W:'$D(X) $C(7) G:'$D(X) A10 S PSGSD=+X,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) W "  ",$P(PSGSDN,"^") G DONE
"RTN","PSGOE91",51,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,10)
"RTN","PSGOE91",52,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A10
"RTN","PSGOE91",53,0)
 NEW TMPX S TMPX=X,X1=PSGDT,X2=-7 D C^%DTC K %DT S %DT="ERTX",%DT(0)=X,X=TMPX D ^%DT K %DT I Y'>0 D ENHLP^PSGOEM(55.06,10) G A10
"RTN","PSGOE91",54,0)
 I PSGFD<Y W $C(7),!?5,"*** THE START DATE CANNOT BE AFTER THE STOP DATE! ***",! S MSG=1 G A10
"RTN","PSGOE91",55,0)
 S (PSGSDX,PSGSD)=+Y,PSGSDN=$$ENDD^PSGMI(PSGSD)_"^"_$$ENDTC^PSGMI(PSGSD) G DONE
"RTN","PSGOE91",56,0)
 ;
"RTN","PSGOE91",57,0)
34 ; stop date
"RTN","PSGOE91",58,0)
 S MSG=0,PSGF2=34 S:PSGOEEF(PSGF2) BACK="34^PSGOE91"
"RTN","PSGOE91",59,0)
A34 ;
"RTN","PSGOE91",60,0)
 K PSGFDX
"RTN","PSGOE91",61,0)
 I $G(PSJORD),$G(PSGP) I $$COMPLEX^PSJOE(PSGP,PSJORD) S PSGOEE=0 D  G DONE
"RTN","PSGOE91",62,0)
 . W !!?5,"Stop Date/Time may not be edited for active complex orders." D PAUSE^VALM1
"RTN","PSGOE91",63,0)
 W !,"STOP DATE/TIME: "_$S($P(PSGFDN,"^")]"":$P(PSGFDN,"^")_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S PSGOEE=0 G DONE
"RTN","PSGOE91",64,0)
 I X="",PSGFD W "   "_$P(PSGFDN,"^") G W34
"RTN","PSGOE91",65,0)
 I $E(X)="^" D ENFF^PSGOE92 G:Y>0 @Y G A34
"RTN","PSGOE91",66,0)
 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,34)
"RTN","PSGOE91",67,0)
 I X=+X,(X>0),(X'>2000000) G A34:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X W " ...dose limit..." D ENE^PSGDL
"RTN","PSGOE91",68,0)
 K %DT S %DT="ERTX",%DT(0)=PSGSD D ^%DT K %DT G:Y'>0 A34 S (PSGFDX,PSGFD)=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)_"^"_$$ENDTC^PSGMI(PSGFD)
"RTN","PSGOE91",69,0)
W34 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",! S MSG=1
"RTN","PSGOE91",70,0)
 ;
"RTN","PSGOE91",71,0)
 ;
"RTN","PSGOE91",72,0)
DONE ;
"RTN","PSGOE91",73,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOE91",74,0)
 D EFDACT^PSJUTL
"RTN","PSGOE91",75,0)
 I PSGOEE G:'PSGOEEF(PSGF2) @BACK S PSGOEE=PSGOEEF(PSGF2)
"RTN","PSGOE91",76,0)
 K F,F0,F1,PSGF2,F3,PSG,SDT Q
"RTN","PSGOE91",77,0)
 ;
"RTN","PSGOE91",78,0)
FF ; up-arrow to another field
"RTN","PSGOE91",79,0)
 D ENFF^PSGOEM I Y>0,Y'=41,Y'=8,Y'=10,Y'=34 S Y=Y_"^PSGOE9"_$S("^109^13^3^7^26^"[("^"_Y_"^"):"",1:2) S:Y=2 FB=PSGF2_"^PSGOE91"
"RTN","PSGOE91",80,0)
 Q
"RTN","PSGOE91",81,0)
 ;
"RTN","PSGOE91",82,0)
DEL ; delete entry
"RTN","PSGOE91",83,0)
 W !?3,"SURE YOU WANT TO DELETE" S %=0 D YN^DICN I %'=1 W $C(7),"  <NOTHING DELETED>"
"RTN","PSGOE91",84,0)
 Q
"RTN","PSGOER0")
0^4^B21577841
"RTN","PSGOER0",1,0)
PSGOER0 ;BIR/CML3-EDIT FIELDS FOR RENEWAL ;05 May 98 / 10:58 AM
"RTN","PSGOER0",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**11,45,47,50,63,64,70,69,58,80,110,127,136**;16 DEC 97
"RTN","PSGOER0",3,0)
 ;
"RTN","PSGOER0",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGOER0",5,0)
 ; Reference to ^VA(200 is supported by DBIA 10060.
"RTN","PSGOER0",6,0)
 ; Reference to ^DD(55.06 is supported by DBIA 2253.
"RTN","PSGOER0",7,0)
 ; Reference to ^%DT is supported by DBIA 10003.
"RTN","PSGOER0",8,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSGOER0",9,0)
 ;
"RTN","PSGOER0",10,0)
DATE(PSGP,PSGORD,PSGDT) ;
"RTN","PSGOER0",11,0)
 K PSGFOK,PSJNOO S F1=55.06,PSGWLL=+$G(^PS(55,PSGP,5.1)),PSGOER0=$G(^PS(55,PSGP,5,+PSGORD,0)),PSGPDRG=+$G(^(.2)),PSGOER2=$G(^(2))
"RTN","PSGOER0",12,0)
 NEW XX S XX=$$ACTIVE^PSJORREN(PSGP,PSGORD) S:+XX=2 PSGPDRG=$P(XX,U,2)
"RTN","PSGOER0",13,0)
 I '+XX W !,"No active Orderable Item was found.",! G DONE
"RTN","PSGOER0",14,0)
 S (PSGNEDFD,PSGOERDP)=$P($$GTNEDFD^PSGOE7("U",PSGPDRG),U)
"RTN","PSGOER0",15,0)
 S PSGSCH=$P(PSGOER2,"^"),PSGST=$P(PSGOER0,"^",7),PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6)
"RTN","PSGOER0",16,0)
 S PSGOEPR=+$P(PSGOER0,"^",2),(PSGOPR,PSGPR)=$S($P(PSJSYSU,";",2):DUZ,1:+PSGOEPR)
"RTN","PSGOER0",17,0)
 I $G(PSJSPEED) S PSGPR=$S($P(ND,"^",2):$P(ND,"^",2),1:+PSGOEPR)
"RTN","PSGOER0",18,0)
 S PSGOSD=+$P(PSGOER2,"^",2) S PSGOFD=+$P(PSGOER2,"^",4),PSGPRN=$P($G(^VA(200,PSGPR,0)),"^"),PSGPRI=$S($P(PSJSYSU,";",2):0,1:$P($G(^("PS")),"^",4)),PSGRO=0 S:PSGPRI PSGPRI=PSGPRI'>DT I PSGPRI S (PSGOPR,PSGPR,PSGPRN)=""
"RTN","PSGOER0",19,0)
 S PSGRNSD=$S($G(PSGLI):PSGLI,1:$G(PSGDT))
"RTN","PSGOER0",20,0)
 S PSGSD=$G(PSGOSD)
"RTN","PSGOER0",21,0)
 I PSGSD="" S PSJREN=1,PSGSD=$$ENSD^PSGNE3($S(PSGST["P":"PRN",1:$P(PSGOER2,U)),PSGS0Y,PSGDT,PSGOSD) S:PSGOSD>PSGSD PSGSD=PSGOSD K PSJREN
"RTN","PSGOER0",22,0)
 S PSGSDN=$$ENDD^PSGMI(PSGSD)
"RTN","PSGOER0",23,0)
10 ;
"RTN","PSGOER0",24,0)
 ;W !,"START DATE/TIME: "_PSGSDN
"RTN","PSGOER0",25,0)
O25 ;
"RTN","PSGOER0",26,0)
 N PSGSD,PSGNEFD S PSGSD=PSGDT
"RTN","PSGOER0",27,0)
 D ENWALL^PSGNE3(PSGSD,0,PSGP)
"RTN","PSGOER0",28,0)
 S:'$G(PSGDT) PSGDT=$$DATE2^PSJUTL2($$NOW^XLFDT)
"RTN","PSGOER0",29,0)
 N PSGNESD S PSGNESD=PSGDT D ENFD^PSGNE3(PSGNESD) I $G(PSGNEFD) S (Y,PSGFD)=PSGNEFD
"RTN","PSGOER0",30,0)
 S PSGFOK(10)="" I PSGST="O" S PSGFD=$$ENOSD^PSJDCU(PSJSYSW0,PSGRNSD,PSGP) I PSGFD]"" S Y=PSGRNSD,X=0 G 1
"RTN","PSGOER0",31,0)
D25 K DUR,DURMIN N PKGFLG S PKGFLG=$S(PSGORD["U":5,PSGORD["V":"IV",PSGORD["P":"P",1:"") I PKGFLG]"" S DUR=$$GETDUR^PSJLIVMD(PSGP,+$G(PSGORD),PKGFLG,1) I DUR]"" D
"RTN","PSGOER0",32,0)
 .S DURMIN=($$DURMIN^PSJLIVMD(DUR)\1) I DURMIN>1 S Y=$$FMADD^XLFDT(PSGRNSD,,,DURMIN) I Y>PSGRNSD S PSGFD=Y,X=0
"RTN","PSGOER0",33,0)
 I $P($G(PSGOER2),"^",4)>PSGFD S Y=$P(PSGOER2,"^",4)
"RTN","PSGOER0",34,0)
 I $G(DUR)]"",($G(PSGORD)'["P") S DURMIN=$$DURMIN^PSJLIVMD(DUR)\1 S Y=$$FMADD^XLFDT(PSGDT,,,DURMIN)
"RTN","PSGOER0",35,0)
 S:X&$P(PSJSYSW0,"^",7) $P(Y,".",2)=$P(PSJSYSW0,"^",7) S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",36,0)
25 W !,"STOP DATE/TIME: "_PSGFDN_"// " R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",37,0)
 I X="" W "   "_PSGFDN G W25
"RTN","PSGOER0",38,0)
 I $E(X)="^" D FF G:Y>0 @Y G 25
"RTN","PSGOER0",39,0)
 S PSGF2=25 I X="@"!(X?1."?") W:X="@" $C(7),"  (Required)" S:X="@" X="?" D ENHLP^PSGOEM(55.06,25)
"RTN","PSGOER0",40,0)
 I X=+X,X>0,X'>2000000 G 25:'$$ENDL^PSGDL(PSGSCH,X) K PSGDLS S PSGDL=X,ND2=PSGOER2,$P(ND2,"^",2)=PSGRNSD W " ...dose limit..." D ENGO^PSGDL
"RTN","PSGOER0",41,0)
 K %DT S %DT="ERTX" D ^%DT K %DT G:Y'>0 25 S PSGFD=+Y,PSGFDN=$$ENDD^PSGMI(PSGFD)
"RTN","PSGOER0",42,0)
W25 I PSGFD<PSGDT W $C(7),!!?13,"*** WARNING! THE STOP DATE ENTERED IS IN THE PAST! ***",!
"RTN","PSGOER0",43,0)
 I PSGFD<PSGSD W $C(7),!!?3,"*** The STOP date must be AFTER the START date. ***" G 25
"RTN","PSGOER0",44,0)
 S PSGFOK(25)=""
"RTN","PSGOER0",45,0)
 ;Display Expected First Dose;BHW;PSJ*5*136
"RTN","PSGOER0",46,0)
 D EFDNEW^PSJUTL
"RTN","PSGOER0",47,0)
 I $G(PSGONF),(+$G(PSGODDD(1))'<+$G(PSGONF)) S PSGFOK(1)="" Q
"RTN","PSGOER0",48,0)
1 ; provider
"RTN","PSGOER0",49,0)
 G:+PSJSYSU<3&$P(PSJSYSU,";",2) CHKDD S PSGF2=1
"RTN","PSGOER0",50,0)
A1 ;
"RTN","PSGOER0",51,0)
 W !,"PROVIDER: ",$S(PSGPR:PSGPRN_"// ",1:"") R X:DTIME I X="^"!'$T W:'$T $C(7) S:'$T X="^" S PSGRO=1,COMQUIT=1 G DONE
"RTN","PSGOER0",52,0)
 I $S(X="":'PSGPR,1:X="@") W $C(7),"  (Required)" S X="?" D ENHLP^PSGOEM(55.06,1) G A1
"RTN","PSGOER0",53,0)
 I X="",PSGPR S X=PSGPRN I PSGPR'=PSGPRN,$D(^VA(200,PSGPR,"PS")) W "    "_$P(^("PS"),"^",2)_"    "_$P(^("PS"),"^",3) S PSGFOK(1)="" G CHKDD
"RTN","PSGOER0",54,0)
 I X?1."?" D ENHLP^PSGOEM(55.06,1)
"RTN","PSGOER0",55,0)
 I $E(X)="^" D FF G:Y>0 @Y G A1
"RTN","PSGOER0",56,0)
 K DIC S DIC="^VA(200,",DIC(0)="EMQZ",DIC("S")="S X(1)=$G(^(""PS"")) I X(1),$S('$P((X(1)),""^"",4):1,1:DT<$P((X(1)),""^"",4))" D ^DIC K DIC I Y'>0 G A1
"RTN","PSGOER0",57,0)
 S PSGPR=+Y,PSGPRN=$P(Y(0,0),"^"),PSGFOK(1)=""
"RTN","PSGOER0",58,0)
CHKDD ;
"RTN","PSGOER0",59,0)
 G:$G(PSGRENEW) 106
"RTN","PSGOER0",60,0)
 I PSGORD["P"!$$DDOK^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",1,",PSGPDRG) G 106
"RTN","PSGOER0",61,0)
 ;I PSGORD["P"!'$$CHKDD^PSGOE2("^PS(55,"_PSGP_",5,"_+PSGORD_",") G 106
"RTN","PSGOER0",62,0)
 I $P(PSJSYSU,";")'=3,'$P(PSJSYSP0,U,2) W !!,"This order's dispense drug is invalid, a pharmacist must renew this order." Q
"RTN","PSGOER0",63,0)
 K ^PS(53.45,PSJSYSP,1),^(2)
"RTN","PSGOER0",64,0)
 W !!,"THE DISPENSE DRUG IS MISSING FROM THIS ORDER."
"RTN","PSGOER0",65,0)
 D ENDRG^PSGOEF1(+^PS(55,PSGP,5,+PSGORD,.2),0)
"RTN","PSGOER0",66,0)
 I $G(DUOUT)!'$G(DRG) S COMQUIT=1 Q
"RTN","PSGOER0",67,0)
106 ; nature of order
"RTN","PSGOER0",68,0)
 S PSJNOO=$$ENNOO^PSJUTL5("R") S:PSJNOO<0 COMQUIT=1
"RTN","PSGOER0",69,0)
 S:PSJNOO'<0 PSGFOK(106)=""
"RTN","PSGOER0",70,0)
DONE ;
"RTN","PSGOER0",71,0)
 K F,F0,F1,PSGF2,F3,ND2,PSGDL,PSGDLS,PSGOROE1,PSGRO,SDT Q
"RTN","PSGOER0",72,0)
FF ; "^" to another field
"RTN","PSGOER0",73,0)
 K DIC S DIC="^DD(55.06,",DIC(0)="EQ",DIC("S")="I $D(PSGFOK(+Y))",X=$E(X,2,255) D ^DIC K DIC
"RTN","PSGOER0",74,0)
 S Y=+Y Q
"RTN","PSJCOMR")
0^5^B76222009
"RTN","PSJCOMR",1,0)
PSJCOMR ;BIR/CML3-RENEW A COMPLEX ORDER SERIES ;07 MAR 96 / 1:23 PM
"RTN","PSJCOMR",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**110,127,136**;16 DEC 97
"RTN","PSJCOMR",3,0)
 ;
"RTN","PSJCOMR",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSJCOMR",5,0)
 ; Reference to ^PSSLOCK is supported by DBIA 2789.
"RTN","PSJCOMR",6,0)
 ; Reference to NOW^%DTC is supported by DBIA 10000.
"RTN","PSJCOMR",7,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJCOMR",8,0)
 ;
"RTN","PSJCOMR",9,0)
 ; renew a complex order series
"RTN","PSJCOMR",10,0)
 Q:'PSJCOM  K COMQUIT
"RTN","PSJCOMR",11,0)
 W !!,"This order is part of a complex order. If you "_$S($P(PSJSYSP0,"^",3):"RENEW",1:"MARK")_" this order the",!,"following orders will be "_$S($P(PSJSYSP0,"^",3):"RENEWED",1:"MARKED")_" too." D CMPLX^PSJCOM1(PSGP,PSJCOM,PSGORD)
"RTN","PSJCOMR",12,0)
 W !! K DIR S DIR(0)="Y",DIR("A")=$S($P(PSJSYSP0,"^",3):"RENEW THIS COMPLEX ORDER SERIES",1:"MARK THIS COMPLEX ORDER SERIES FOR RENEWAL"),DIR("B")="YES"
"RTN","PSJCOMR",13,0)
 S DIR("?")="Answer 'YES' to "_$S($P(PSJSYSP0,"^",3):"renew this complex order series",1:"mark this complex order series for renewal")_".  Answer 'NO' (or '^') to stop now." D ^DIR K DIR
"RTN","PSJCOMR",14,0)
 I 'Y N DIR D ABORT G DONE
"RTN","PSJCOMR",15,0)
 I '$D(DIRUT),Y D NEW S PSGCANFL=1 D DONE Q
"RTN","PSJCOMR",16,0)
 I '$D(DIRUT),PSJSYSU I $P(PSGND4,"^",15),$P(PSGND4,"^",16) D UNMARK,DONE Q
"RTN","PSJCOMR",17,0)
 D DONE,ABORT^PSGOEE
"RTN","PSJCOMR",18,0)
 Q
"RTN","PSJCOMR",19,0)
 ;
"RTN","PSJCOMR",20,0)
UNMARK ;  
"RTN","PSJCOMR",21,0)
 W !!,"THIS COMPLEX ORDER SERIES HAS BEEN 'MARKED FOR RENEWAL'.",! K DIR S DIR(0)="Y",DIR("A")="DO YOU WANT TO 'UNMARK IT'",DIR("B")="NO"
"RTN","PSJCOMR",22,0)
 S DIR("?",1)="  Answer 'YES' to unmark this complex order series.  Answer 'NO' (or '^') to leave the complex",DIR("?")="order series marked.  (An answer is required.)" D ^DIR
"RTN","PSJCOMR",23,0)
 I 'Y N DIR D ABORT^PSGOEE G DONE
"RTN","PSJCOMR",24,0)
 N PSGORD,XX,X S XX=0,X="" F  S XX=$O(^PS(55,"ACX",PSJCOM,XX)) Q:'XX  F  S X=$O(^PS(55,"ACX",PSJCOM,XX,X)) Q:X=""  S PSGORD=X D
"RTN","PSJCOMR",25,0)
 .S PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4))
"RTN","PSJCOMR",26,0)
 .S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=21180+PSJSYSU D ^PSGAL5 S $P(PSGND4,"^",15,17)="^^",^PS(55,PSGP,5,DA,4)=PSGND4 W "...DONE!"
"RTN","PSJCOMR",27,0)
 ;
"RTN","PSJCOMR",28,0)
DONE ;
"RTN","PSJCOMR",29,0)
 K %DT,DA,DIE,DIR,DR,FDSD,PSGAL,PSGALR,PSGDL,PSGDLS,PSGFD,PSGFOK,PSGND4,PSGOEE,PSGOER0,PSGOER1,PSGOER2,PSGOERDP,PSGOPR,PSGOSD,PSGPOSA,PSGPOSD,PSGPR,PSGPX,PSGRD,PSGSD,PSGTOL,PSGTOO,PSGUOW,PSGWLL,RF Q
"RTN","PSJCOMR",30,0)
 ;
"RTN","PSJCOMR",31,0)
NEW ; get info, write record
"RTN","PSJCOMR",32,0)
 K ^TMP("PSJCOMR",$J)
"RTN","PSJCOMR",33,0)
 N DUOUT,PSGORD,TMPP,TMPO,PS55ACX,TMPDUZ,TMPOE,COMQUIT S TMPP=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",34,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP!$G(COMQUIT)  D
"RTN","PSJCOMR",35,0)
 . S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""!$G(COMQUIT)  S PSGORD=TMPO D:PSGORD["U" NEWUD  I PSGORD["V" D NEWIV
"RTN","PSJCOMR",36,0)
 I $G(COMQUIT)!$G(DUOUT)  W !!,"By not verifying all the orders, none of the orders will be verified." D PAUSE^VALM1 Q
"RTN","PSJCOMR",37,0)
 I '$G(COMQUIT)&'$G(DUOUT) S TMPOE=0 F  S TMPOE=$O(^PS(55,"ACX",PSJCOM,TMPOE)) Q:TMPOE=""  S TMPO=0 F  S TMPO=$O(^PS(55,"ACX",PSJCOM,TMPOE,TMPO)) Q:'TMPO!$G(COMQUIT)  S PSGORD=TMPO D
"RTN","PSJCOMR",38,0)
 . K VSTRING S VSTRING=$G(^TMP("PSJCOMR",$J,PSJCOM,TMPO)) I PSGORD'=$P(VSTRING,"^",2) S COMQUIT=1 Q
"RTN","PSJCOMR",39,0)
 . S PSGP=$P(VSTRING,"^"),PSGDT=$P(VSTRING,"^",3),PSGOEPR=$P(VSTRING,"^",4),PSGOFD=$P(VSTRING,"^",5),PSGFD=$P(VSTRING,"^",6),PSJNOO=$P(VSTRING,"^",7),TMPDUZ=$P(VSTRING,"^",8)
"RTN","PSJCOMR",40,0)
 . D:PSGORD["U" FILEUD D:PSGORD["V" FILEIV
"RTN","PSJCOMR",41,0)
 K ^TMP("PSJCOMR",$J),VSTRING
"RTN","PSJCOMR",42,0)
 Q
"RTN","PSJCOMR",43,0)
NEWUD N PSJABT,PSGDRG,PSJREN,X,XX,PSGORDP,UDSTRING S PSGDRG=$P($G(^PS(55,PSGP,5,+PSGORD,1,1,0)),"^"),PSJREN=1
"RTN","PSJCOMR",44,0)
 D OC55
"RTN","PSJCOMR",45,0)
 Q:$D(PSGORQF)  ; quit if not to continue
"RTN","PSJCOMR",46,0)
 D NOW^%DTC S PSGDT=%,PSGND4=$G(^PS(55,PSGP,5,+PSGORD,4)) I '$P(PSJSYSP0,"^",3) D MARK Q
"RTN","PSJCOMR",47,0)
 S PSGWLL=$S('$P(PSJSYSW0,"^",4):0,1:+$G(^PS(55,PSGP,5.1))),PSGOEE="R" K PSGOEOS
"RTN","PSJCOMR",48,0)
 K ^PS(53.45,PSJSYSP,1),^(2) D MOVE(3,1),MOVE(1,2)
"RTN","PSJCOMR",49,0)
 D DATE^PSGOER0(PSGP,PSGORD,PSGDT) I '$D(PSGFOK(106)) D DONE,ABORT^PSGOEE S VALMBCK="R" Q
"RTN","PSJCOMR",50,0)
 W !!,"...updating order..." N PSGOEAV S PSGOEAV=+PSJSYSU,PSGOORD=PSGORD,PSGOER1=$G(^PS(55,PSGP,5,+PSGORD,.2)),PSGSI=$G(^(6)) W "."
"RTN","PSJCOMR",51,0)
 S PSGMR=$P(PSGOER0,"^",3),PSGSM=$P(PSGOER0,"^",5),PSGHSM=$P(PSGOER0,"^",6)
"RTN","PSJCOMR",52,0)
 S PSGMRN=$$ENMRN^PSGMI(PSGMR),PSGPDRGN=$$ENPDN^PSGMI(PSGPDRG),PSGDO=$P(PSGOER1,"^",2),PSGSCH=$P(PSGOER2,"^")
"RTN","PSJCOMR",53,0)
 S PSGS0Y=$P(PSGOER2,"^",5),PSGS0XT=$P(PSGOER2,"^",6),PSGNESD=PSGSD,PSGNEFD=PSGFD
"RTN","PSJCOMR",54,0)
 S:PSJPWD'=$P(PSGOER2,U,10) PSGS0Y=$$ENRNAT^PSGOU($P(PSGOER2,U,10),+PSJPWD,PSGSCH,PSGS0Y)
"RTN","PSJCOMR",55,0)
 S UDSTRING=PSGP_"^"_PSGORD_"^"_PSGDT_"^"_PSGOEPR_"^"_PSGOFD_"^"_PSGFD_"^"_PSJNOO F II=1:1:$L(UDSTRING,"^") I $P(UDSTRING,"^",II)="" K UDSTRING
"RTN","PSJCOMR",56,0)
 I '$D(UDSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",57,0)
 S:$G(DUZ) UDSTRING=UDSTRING_"^"_DUZ D TEMP(UDSTRING)
"RTN","PSJCOMR",58,0)
 Q
"RTN","PSJCOMR",59,0)
 ;
"RTN","PSJCOMR",60,0)
FILEUD ;
"RTN","PSJCOMR",61,0)
 ;Changed the reference to the type "O" for order numbers previously in v4.5
"RTN","PSJCOMR",62,0)
 N X,PSJORD,PSGOERDP,PSGOREAS,PSGRZERO S PSJORD=PSGORD K PSJPREX
"RTN","PSJCOMR",63,0)
 ;Make sure Admin times for parent don't carry to children;BHW;PSJ*5*136
"RTN","PSJCOMR",64,0)
 S X=$$LS^PSSLOCK(PSGP,PSGORD)  S PSGRTWO=^PS(55,+$G(PSGP),5,+PSGORD,2) S PSGRZERO="^PS(55,"_PSGP_",5,"_+PSGORD_",0)",PSGOREAS=$P(@(PSGRZERO),"^",24) D
"RTN","PSJCOMR",65,0)
 . S (PSGAT,PSGS0Y)=$P(PSGRTWO,"^",5)
"RTN","PSJCOMR",66,0)
 . S $P(@PSGRZERO,"^",24)="R" D UPDREN^PSGOER(PSGORD,PSGDT,PSGOEPR,PSGOFD,PSJNOO,$G(TMPDUZ)),UPDRENOE^PSGOER(PSGP,PSGORD) S $P(@PSGRZERO,"^",24)=PSGOREAS
"RTN","PSJCOMR",67,0)
 I +$G(PSJSYSU)=3,$G(PSJCOM) D CMPLX2^PSJCOM1(PSGP,PSJCOM,PSGORD) I $G(PSGPXN) S PSJPREX=1
"RTN","PSJCOMR",68,0)
 W !!,"...updating order..." K DA S DA(1)=PSGP,DA=+PSGORD,PSGAL("C")=PSJSYSU*10+18000 D ^PSGAL5 W "."
"RTN","PSJCOMR",69,0)
 I '$G(PSGOERDP),$P(PSJSYSW0,"^",4) I $G(PSGFD),$G(PSGWLL),(PSGFD'<PSGWLL) S $P(^PS(55,PSGP,5.1),"^")=+PSGFD
"RTN","PSJCOMR",70,0)
 D UNL^PSSLOCK(PSGP,PSGORD)
"RTN","PSJCOMR",71,0)
 W ".DONE!" S VALMBCK="Q"
"RTN","PSJCOMR",72,0)
 Q
"RTN","PSJCOMR",73,0)
 ;
"RTN","PSJCOMR",74,0)
MARK ;
"RTN","PSJCOMR",75,0)
 I $P(PSGND4,"^",15),$P(PSGND4,"^",16) W $C(7),!!?3,"...THIS ORDER IS ALREADY MARKED FOR RENEWAL!..." Q
"RTN","PSJCOMR",76,0)
 K DA S $P(PSGND4,"^",15,17)="1^"_DUZ_"^"_PSGDT,^PS(55,PSGP,5,+PSGORD,4)=PSGND4,PSGAL("C")=13180,DA(1)=PSGP,DA=+PSGORD W "." D ^PSGAL5
"RTN","PSJCOMR",77,0)
 I $D(PSJSYSO) S PSGORD=+PSGORD_"A",PSGPOSA="R",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSJCOMR",78,0)
 Q
"RTN","PSJCOMR",79,0)
MOVE(X,Y) ; Move comments/dispense drugs from 55 to 53.45.
"RTN","PSJCOMR",80,0)
 S Q=0 F  S Q=$O(^PS(55,PSGP,5,+PSGORD,X,Q)) Q:'Q  S ^PS(53.45,PSJSYSP,Y,Q,0)=$G(^(Q,0))
"RTN","PSJCOMR",81,0)
 S:Q ^PS(53.45,Y,0)="^53.450"_Y_"P^"_Q_U_Q
"RTN","PSJCOMR",82,0)
 Q
"RTN","PSJCOMR",83,0)
OC55 ;* Order checks for Speed finish and regular finish
"RTN","PSJCOMR",84,0)
 N INTERVEN,PSJDDI,PSJIREQ,PSJRXREQ,PSJPDRG
"RTN","PSJCOMR",85,0)
 S Y=1,(PSJIREQ,PSJRXREQ,INTERVEN,X)=""
"RTN","PSJCOMR",86,0)
 K PSGORQF D ENDDC^PSGSICHK(PSGP,+$G(^PS(55,PSGP,5,+PSGORD,1,1,0)))
"RTN","PSJCOMR",87,0)
 I '$D(PSGORQF) K PSGORQF,^TMP($J,"DI") D
"RTN","PSJCOMR",88,0)
 . F PSGDDI=1:0 S PSGDDI=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDDI)) Q:'PSGDDI  S PSJDD=+$G(^PS(55,PSGP,5,+PSGORD,1,PSGDDI,0)) K PSJPDRG D IVSOL^PSGSICHK
"RTN","PSJCOMR",89,0)
 Q
"RTN","PSJCOMR",90,0)
 ;
"RTN","PSJCOMR",91,0)
RIV ; Renew order.
"RTN","PSJCOMR",92,0)
 Q:'PSJCOM  N PSGORD,TMPP,TMPO S (TMPP,TMPO)=0 K PS55ACX M PS55ACX(55,"ACX",PSJCOM)=^PS(55,"ACX",PSJCOM)
"RTN","PSJCOMR",93,0)
 F  S TMPP=$O(PS55ACX(55,"ACX",PSJCOM,TMPP)) Q:'TMPP  S TMPO=0 F  S TMPO=$O(PS55ACX(55,"ACX",PSJCOM,TMPP,TMPO)) Q:TMPO=""  D
"RTN","PSJCOMR",94,0)
 . S PSGORD=TMPO D:PSGORD["U" NEWUD  D:PSGORD["V" NEWIV
"RTN","PSJCOMR",95,0)
 Q
"RTN","PSJCOMR",96,0)
NEWIV ;Renew complex IV orders
"RTN","PSJCOMR",97,0)
 N X,XX
"RTN","PSJCOMR",98,0)
 I P(17)="D",P(12) N ERR D RI W:$G(ERR)=1 $C(7),"  Order unchanged." Q:$G(ERR)<2
"RTN","PSJCOMR",99,0)
 NEW PSGORQF S PSIVRNFG=1 D ORDCHK^PSJLIFN K PSIVRNFG Q:$G(PSGORQF)  W !
"RTN","PSJCOMR",100,0)
 I $G(PSGORD)["V" S ON55=PSGORD S P("OLDON")=$P(^PS(55,DFN,"IV",+PSGORD,2),"^",5) S:'P("OLDON") P("OLDON")=ON55
"RTN","PSJCOMR",101,0)
 ;
"RTN","PSJCOMR",102,0)
R1 N PSIVND0,PSIVND2,PSIVREAS,PSIVOFD,IVSTRING,P2,PSJBKDR S PSJBKDR=1
"RTN","PSJCOMR",103,0)
 S P("NEWON")=ON55,(PSIVOK,EDIT)="25^1",P2=P(2) S P(2)=$$DATE^PSJUTL2 D EDIT^PSIVEDT S P(2)=P2 I X="^" D RD Q
"RTN","PSJCOMR",104,0)
 S:+VAIN(4)'=$P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10) P(11)=$$ENRNAT^PSGOU($P($G(^PS(55,DFN,"IV",+P("OLDON"),2)),U,10),+VAIN(4),P(9),P(11))
"RTN","PSJCOMR",105,0)
 S PSIVCHG=2
"RTN","PSJCOMR",106,0)
 D OK G:X["N" R1 I X=U D RD Q
"RTN","PSJCOMR",107,0)
 S P(17)="A",P("RES")="R",P("FRES")="" D:'$D(PSJIVORF) ORPARM^PSIVOREN I PSJIVORF D  Q:'$D(P("NAT"))
"RTN","PSJCOMR",108,0)
 .D NATURE^PSIVOREN I '$D(P("NAT")) D RD S COMQUIT=1 Q
"RTN","PSJCOMR",109,0)
 .S ON=ON55 ;D SET^PSIVORFE
"RTN","PSJCOMR",110,0)
 S P(16)="",PSJORIFN="",PSIVACT=1,P("21FLG")="",PSIVOFD=$P($G(^PS(55,DFN,"IV",+PSGORD,0)),"^",3)
"RTN","PSJCOMR",111,0)
 S IVSTRING=DFN_"^"_ON55_"^"_$$DATE^PSJUTL2()_"^"_+$G(P(6))_"^"_PSIVOFD_"^"_P(3)_"^"_P("NAT") F II=1:1:$L(IVSTRING,"^") I $P(IVSTRING,"^",II)="" K IVSTRING
"RTN","PSJCOMR",112,0)
 I '$D(IVSTRING) S COMQUIT=1 Q
"RTN","PSJCOMR",113,0)
 S:$G(DUZ) IVSTRING=IVSTRING_"^"_DUZ D TEMP(IVSTRING)
"RTN","PSJCOMR",114,0)
 Q
"RTN","PSJCOMR",115,0)
 ;
"RTN","PSJCOMR",116,0)
FILEIV ;
"RTN","PSJCOMR",117,0)
 N X,ON,ON55,PSJORD,P,PSIVTMP,PSIVZERO,OREAS
"RTN","PSJCOMR",118,0)
 S X=$$LS^PSSLOCK(DFN,+PSGORD_"V") S PSIVZERO="^PS(55,"_DFN_",""IV"","_+PSGORD_",0)" S PSIVTMP0=$G(@PSIVZERO) Q:'PSIVTMP0
"RTN","PSJCOMR",119,0)
 S PSIVTMP2="^PS(55,"_DFN_",""IV"","_+PSGORD_",2)",OREAS=$P(PSIVTMP2,"^",8),$P(@PSIVTMP2,"^",8)="R"
"RTN","PSJCOMR",120,0)
 F I=1:1:$L(PSIVTMP0,"^") S P(I)=$P(PSIVTMP0,"^",I)
"RTN","PSJCOMR",121,0)
 S (ON,ON55,PSJORD)=PSGORD,P(3)=PSGFD,P(6)=PSGOEPR,P("NAT")=PSJNOO,PSIVOFD=PSGOFD D RUPDATE^PSIVOREN(DFN,ON55,P(2))
"RTN","PSJCOMR",122,0)
 Q:'PSJIVORF
"RTN","PSJCOMR",123,0)
 D EN1^PSJHL2(DFN,"SN",+ON55_"V","ORDER RENEWED")
"RTN","PSJCOMR",124,0)
 S OD=P(2) D EN^PSIVORE
"RTN","PSJCOMR",125,0)
 D VF1^PSJLIACT("","",0),UNL^PSSLOCK(DFN,+ON55_"V") S $P(@PSIVTMP2,"^",8)=OREAS
"RTN","PSJCOMR",126,0)
 D ENLBL^PSIVOPT(2,DUZ,DFN,3,+ON55,"R")
"RTN","PSJCOMR",127,0)
 Q
"RTN","PSJCOMR",128,0)
 ;
"RTN","PSJCOMR",129,0)
TEMP(VARS) ;
"RTN","PSJCOMR",130,0)
 Q:'PSJCOM  S ^TMP("PSJCOMR",$J,PSJCOM,PSGORD)=VARS
"RTN","PSJCOMR",131,0)
 Q
"RTN","PSJCOMR",132,0)
 ;
"RTN","PSJCOMR",133,0)
RD ; Delete for renew.
"RTN","PSJCOMR",134,0)
 D DEL55^PSIVORE2 S (ON55,P("PON"))=P("OLDON") D GT55^PSIVORFB
"RTN","PSJCOMR",135,0)
 Q
"RTN","PSJCOMR",136,0)
 ;
"RTN","PSJCOMR",137,0)
OK ;Print example label, run order through checker, ask if it is ok.
"RTN","PSJCOMR",138,0)
 S P16=0,PSIVEXAM=1,(PSIVNOL,PSIVCT)=1 D GTOT^PSIVUTL(P(4)) I ($G(P("PD"))="") D GTPD^PSIVORE2
"RTN","PSJCOMR",139,0)
 D ^PSIVCHK I $D(DUOUT) S X="^" Q
"RTN","PSJCOMR",140,0)
 I ERR=1 S X="N" Q
"RTN","PSJCOMR",141,0)
 W ! D ^PSIVORLB K PSIVEXAM S Y=P(2) W !,"Start date: " X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),?30," Stop date: " S Y=P(3) X ^DD("DD") W $P(Y,"@")," ",$P(Y,"@",2),!
"RTN","PSJCOMR",142,0)
 S X="Is this O.K.: ^"_$S(ERR:"N",1:"Y")_"^^NO"_$S(ERR'=1:",YES",1:"") D ENQ^PSIV I X["?" S HELP="OK" D ^PSIVHLP G OK
"RTN","PSJCOMR",143,0)
 Q
"RTN","PSJCOMR",144,0)
 ;
"RTN","PSJCOMR",145,0)
RI ; Reinstate Auto-DC'ed order.
"RTN","PSJCOMR",146,0)
 N DA,DIE,DIR,DIU,DR,PSIVACT,PSIVALT,PSIVALCK,PSIVREA W !!,$C(7),"This order has been Auto-DC'ed."
"RTN","PSJCOMR",147,0)
 S DIR(0)="Y",DIR("A")="Reinstate this order" D ^DIR K DIR I 'Y S ERR=1 Q
"RTN","PSJCOMR",148,0)
 D NOW^%DTC I %>$P($G(^PS(55,DFN,"IV",+ON55,2)),U,7) D
"RTN","PSJCOMR",149,0)
 .K DIR S ERR=1,DIR(0)="Y",DIR("A",1)="The original stop date of this order has past.",DIR("A")="Do you wish to renew this order" D ^DIR K DIR S ERR=$S(Y:2,1:1)
"RTN","PSJCOMR",150,0)
 Q:$G(ERR)  S X=$G(^VA(200,+P(6),"PS")) I $S('X:1,'$P(X,U,4):0,DT<$P(X,U,4):0,1:1) S ERR=1
"RTN","PSJCOMR",151,0)
 I $G(ERR) W !!,$C(7),"This order's provider is no longer valid. Please enter a valid provider." S (EDIT,PSIVOK)=1 D EDIT^PSIVEDT I $G(DONE) W $C(7),"Order unchanged." S ERR=1 Q
"RTN","PSJCOMR",152,0)
 N PSGALO S PSGALO=18530 D ENARI^PSIVOPT(DFN,ON,DUZ,PSGALO)
"RTN","PSJCOMR",153,0)
 Q
"RTN","PSJCOMR",154,0)
 ;
"RTN","PSJCOMR",155,0)
ABORT ; No changes
"RTN","PSJCOMR",156,0)
 W !!,$C(7),"No changes made to this order." D PAUSE^VALM1 K PSGOEEF S PSGOEEF=0
"RTN","PSJCOMR",157,0)
 Q
"RTN","PSJUTL")
0^6^B55612120
"RTN","PSJUTL",1,0)
PSJUTL ;BIR/MLM-MISC. INPATIENT UTILITIES ;17 Mar 98 / 11:05 AM
"RTN","PSJUTL",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**9,47,58,80,110,136**;16 DEC 97
"RTN","PSJUTL",3,0)
 ;
"RTN","PSJUTL",4,0)
 ; Reference to ^DIC(42 is supported by DBIA 10039.
"RTN","PSJUTL",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSJUTL",6,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSJUTL",7,0)
 ; Reference to ^DIC is supported by DBIA 10006.
"RTN","PSJUTL",8,0)
 ; Reference to ^DIC1 is supported by DBIA 10007.
"RTN","PSJUTL",9,0)
 ; Reference to ^DIR is supported by DBIA 10026.
"RTN","PSJUTL",10,0)
 ; Reference to ^VALM1 is supported by DBIA 10116.
"RTN","PSJUTL",11,0)
 ;
"RTN","PSJUTL",12,0)
ENDL ; device look-up
"RTN","PSJUTL",13,0)
 N DA,DIC,DIE,DIX,DO,DR
"RTN","PSJUTL",14,0)
 S DIC="^%ZIS(1,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",15,0)
 S X=Y(0,0)
"RTN","PSJUTL",16,0)
 Q
"RTN","PSJUTL",17,0)
 ;
"RTN","PSJUTL",18,0)
ENDH(X) ; device help
"RTN","PSJUTL",19,0)
 N D,XQH,DA,DIC,DIE,DO,DR,DZ
"RTN","PSJUTL",20,0)
 S DIC="^%ZIS(1,",DIC(0)="EIM" D DO^DIC1,^DIC
"RTN","PSJUTL",21,0)
 Q
"RTN","PSJUTL",22,0)
 ;
"RTN","PSJUTL",23,0)
READ ; hold screen
"RTN","PSJUTL",24,0)
 I $D(IOST) Q:$E(IOST)'="C"
"RTN","PSJUTL",25,0)
 W ! I $D(IOSL),$Y<(IOSL-4) G READ
"RTN","PSJUTL",26,0)
 W !?5,"Press return to continue  " R X:$S($D(DTIME):DTIME,1:300)
"RTN","PSJUTL",27,0)
 Q
"RTN","PSJUTL",28,0)
 ;
"RTN","PSJUTL",29,0)
ENOISC(PSJOI,USAGE)          ;Set DIC("S") so that only Orderable Items with at 
"RTN","PSJUTL",30,0)
 ;least 1 active dispense drug for the specified usage.
"RTN","PSJUTL",31,0)
 ;Input:  PSJOI IEN of Orderable Item selected
"RTN","PSJUTL",32,0)
 ;        USAGE - Type of drugs (UD,IV,etc) to be selected
"RTN","PSJUTL",33,0)
 ;Output: 1-At least one dispense drug found
"RTN","PSJUTL",34,0)
 ;        0-None found
"RTN","PSJUTL",35,0)
 N FOUND,PSJ
"RTN","PSJUTL",36,0)
 S PSJ=$P($G(^PS(50.7,+PSJOI,0)),U,4),FOUND=$S('PSJ:1,PSJ>DT:1,1:0)
"RTN","PSJUTL",37,0)
 I FOUND S FOUND=0 F PSJ=0:0 S PSJ=$O(^PSDRUG("ASP",PSJOI,PSJ)) Q:FOUND!'PSJ  I $P($G(^PSDRUG(PSJ,2)),U,3)[USAGE,'$G(^("I"))!($G(^("I"))'<DT) S FOUND=1
"RTN","PSJUTL",38,0)
 Q FOUND
"RTN","PSJUTL",39,0)
 ;
"RTN","PSJUTL",40,0)
AADR ; display allergies and adverse reactions
"RTN","PSJUTL",41,0)
 D ATS^PSJMUTL(60,50,1) N A,B
"RTN","PSJUTL",42,0)
 I (PSGALG=0)&(PSGADR=0) W !!,"No allergies or ADRs on file."
"RTN","PSJUTL",43,0)
 I PSGALG'=0 W !!,"Allergies: " S B="PSGALG" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",44,0)
 I PSGADR'=0 W !,"      ADR: " S B="PSGADR" F  S A=$Q(@B) Q:A=""  W ?12,$G(@A),! S B=A
"RTN","PSJUTL",45,0)
 D READ K PSGALG,PSGADR Q
"RTN","PSJUTL",46,0)
 ;
"RTN","PSJUTL",47,0)
ENALU ; application look-up
"RTN","PSJUTL",48,0)
 N PSJ S PSJ=DA(1) N DA,DIC,DIE,DIX,DO,DR S DIC="^PS(50.35,",DIC(0)="EIMZ" D DO^DIC1,^DIC I Y'>0 K X Q
"RTN","PSJUTL",49,0)
 S X=$P(Y(0),"^",2) K:$S(X="":1,1:$D(^PS(50.3,PSJ,1,"B",X))) X
"RTN","PSJUTL",50,0)
 Q
"RTN","PSJUTL",51,0)
 ;
"RTN","PSJUTL",52,0)
ENAQ ; application query
"RTN","PSJUTL",53,0)
 S X=DZ N D,DA,DIC,DIE,DO,DR,DZ,XQH S DIC="^PS(50.35,",DIC(0)="EIMQ" D DO^DIC1,^DIC
"RTN","PSJUTL",54,0)
 Q
"RTN","PSJUTL",55,0)
 ;
"RTN","PSJUTL",56,0)
ENPC(PSJTYP,PSJSYSP,LEN,TEXT) ; Copy Provider Comments -> Special Instructions.
"RTN","PSJUTL",57,0)
 Q:'$D(^PS(53.1,+$G(PSJORD),12,1,0)) ""
"RTN","PSJUTL",58,0)
 N DIR,PSGSI,PSGOEE,X,Y
"RTN","PSJUTL",59,0)
 S Y="" F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  S Y=Y_^(X,0)_" " Q:$L(Y)>LEN
"RTN","PSJUTL",60,0)
 S:$G(PSJTYP)'="V" Y=$$ENSET^PSGSICHK(Y) S:$G(PSJTYP)="V" Y=$E(Y,1,$L(Y)-1)
"RTN","PSJUTL",61,0)
 I $L(Y)'<LEN S PSGOEE=0 D REDISP Q PSGSI
"RTN","PSJUTL",62,0)
 ;Display Provider Comments Prior to Asking the Copy Provider Comments Question;BHW;PSJ*5*136
"RTN","PSJUTL",63,0)
 N PSJTMP S PSJTMP=0
"RTN","PSJUTL",64,0)
 W !,"PROVIDER COMMENTS:"
"RTN","PSJUTL",65,0)
 F  S PSJTMP=$O(^PS(53.1,+$G(PSJORD),12,PSJTMP)) Q:'PSJTMP  W !,^PS(53.1,+$G(PSJORD),12,PSJTMP,0)
"RTN","PSJUTL",66,0)
 S PSGSI=Y W ! S DIR(0)="S^Y:Yes;N:No;!:Copy and flag for display in a BCMA Message Box",DIR("A")="Copy the Provider Comments into "_$$ENFIELD(PSJTYP)_" (Yes/No/!)",DIR("??")="^D ENPCHLP1^PSJUTL(PSJTYP)" D ^DIR
"RTN","PSJUTL",67,0)
 Q:Y="Y" PSGSI
"RTN","PSJUTL",68,0)
 Q:Y="!" PSGSI_"^1"
"RTN","PSJUTL",69,0)
 Q ""
"RTN","PSJUTL",70,0)
 ;
"RTN","PSJUTL",71,0)
REDISP ; Redisplay Provider Comments and allow entry of Spec. Instructions.
"RTN","PSJUTL",72,0)
 D CLEAR^VALM1 F X=0:0 S X=$O(^PS(53.1,+$G(PSJORD),12,X)) Q:'X  W ^(X,0),!
"RTN","PSJUTL",73,0)
 W !! S PSGSI=""
"RTN","PSJUTL",74,0)
 D:PSJTYP'="V" 8^PSGOE81
"RTN","PSJUTL",75,0)
 I PSJTYP="V" D 64^PSIVEDT1 S PSGSI=P("OPI")
"RTN","PSJUTL",76,0)
 Q
"RTN","PSJUTL",77,0)
 ;
"RTN","PSJUTL",78,0)
ENPCHLP1(Y) ; Display help messages for Provider Comment copy.
"RTN","PSJUTL",79,0)
 W !,"Enter ""YES"" to copy Provider Comments into the ",$$ENFIELD(Y)," field",!,"or ""NO"" to bypass",!,"or ""!"" to copy the Provider Comments into the ",$$ENFIELD(PSJTYP)," field",!,"and flag them for display in a BCMA Message Box",!!
"RTN","PSJUTL",80,0)
 Q
"RTN","PSJUTL",81,0)
ENPCHLP2(Y,X) ;
"RTN","PSJUTL",82,0)
 W !,"The Provider Comments entered for this order are longer than the space available",!,"in the ",$$ENFIELD(Y)," field.",!!,"Enter ""YES"" to copy the first ",X-3," characters into the ",$$ENFIELD(Y),!,"field, or ""NO"" to continue.",!!
"RTN","PSJUTL",83,0)
 Q
"RTN","PSJUTL",84,0)
ENBCMA(PSJTYP)  ;
"RTN","PSJUTL",85,0)
 N DIR,X,Y
"RTN","PSJUTL",86,0)
 W !!,"Would you like to flag the ",$$ENFIELD(PSJTYP)," field for display in a BCMA",!,"Message box?"
"RTN","PSJUTL",87,0)
 W ! S DIR(0)="S^Y:Yes;N:No",DIR("A")="Flag the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",88,0)
 K PSJCOMSI I $G(PSJCOM),$G(PSJORD)'["P" N TEXT S TEXT=$S(PSJTYP="U":$G(PSGSI),1:$G(P("OPI"))) S PSJCOMSI=$$COMSI(PSJCOM,TEXT)
"RTN","PSJUTL",89,0)
 Q:Y="Y" $S($G(PSJTYP)="U":$P(PSGSI,"^")_"^1",1:$P(P("OPI"),"^")_"^1")
"RTN","PSJUTL",90,0)
 Q $S(PSJTYP="U":$P(PSGSI,"^"),1:$P($G(P("OPI")),"^"))
"RTN","PSJUTL",91,0)
ENFIELD(Y) ;
"RTN","PSJUTL",92,0)
 Q $S(Y="V":"Other Print Info",1:"Special Instructions")
"RTN","PSJUTL",93,0)
 ;
"RTN","PSJUTL",94,0)
COMSI(PARENT,INSTR) ;
"RTN","PSJUTL",95,0)
 N DIR,X,Y
"RTN","PSJUTL",96,0)
 W !!!!?15,"** WARNING **",!?5,"This order is part of a complex order."
"RTN","PSJUTL",97,0)
 W !!,"Would you like to copy the ",$$ENFIELD(PSJTYP)
"RTN","PSJUTL",98,0)
 W !,"to the other orders in the complex order?"
"RTN","PSJUTL",99,0)
 S DIR(0)="S^Y:Yes;N:No",DIR("A")="     Copy the "_$$ENFIELD(PSJTYP)_" (Yes/No)" D ^DIR
"RTN","PSJUTL",100,0)
 Q:Y="Y" 1
"RTN","PSJUTL",101,0)
 Q 0
"RTN","PSJUTL",102,0)
 ;
"RTN","PSJUTL",103,0)
ENORL(X) ; Return patient's location as variable ptr.
"RTN","PSJUTL",104,0)
 Q $S(+$G(^DIC(42,+X,44)):+$G(^(44))_";SC(",$D(^DIC(42,+X,0)):+X_";DIC(42,",1:"")
"RTN","PSJUTL",105,0)
 ;
"RTN","PSJUTL",106,0)
ENMARD() ; validate MAR SELECTION DEFAULT string in WARD PARMS file.
"RTN","PSJUTL",107,0)
 N PSJANS,PSJX1,PSJX2,RANGE,Q
"RTN","PSJUTL",108,0)
 S RANGE="1:6" F PSJX1=1:1:6 S RANGE(PSJX1)=""
"RTN","PSJUTL",109,0)
 S:$E(X)="-" X=+RANGE_X S:$E($L(X))="-" X=X_$P(RANGE,":",2)
"RTN","PSJUTL",110,0)
 S PSJANS="" F Q=1:1:$L(X,",") S PSJX1=$P(X,",",Q) D FS Q:'$D(PSJANS)
"RTN","PSJUTL",111,0)
 Q:'$G(PSJANS) 0
"RTN","PSJUTL",112,0)
 S PSJANS=$E(PSJANS,1,$L(PSJANS)-1) F Q=1:1:$L(PSJANS,",") D  Q:'$D(PSJANS)
"RTN","PSJUTL",113,0)
 .I $P(PSJANS,",",Q)=1,$L(PSJANS,",")>1 W !!,"All Medications (1) may not be selected in combination with other types." K PSJANS Q
"RTN","PSJUTL",114,0)
 .W ?47,$P(PSJANS,",",Q)," - ",$P($T(@$P(PSJANS,",",Q)),";;",2),!
"RTN","PSJUTL",115,0)
 S:$G(PSJANS) X=PSJANS Q $G(PSJANS)
"RTN","PSJUTL",116,0)
 ;
"RTN","PSJUTL",117,0)
FS ;
"RTN","PSJUTL",118,0)
 I $S(PSJX1?1.N1"-"1.N:0,PSJX1'?1.N:1,'$D(RANGE(PSJX1)):1,1:","_PSJANS[PSJX1) K PSJANS Q
"RTN","PSJUTL",119,0)
 I PSJX1'["-" S PSJANS=PSJANS_PSJX1_"," Q
"RTN","PSJUTL",120,0)
 S PSJX2=+PSJX1,PSJANS=PSJANS_PSJX2_","
"RTN","PSJUTL",121,0)
 F  S PSJX2=$O(RANGE(PSJX2)) K:$S(X="":1,","_PSJANS[PSJX2:1,1:PSJX2>$P(PSJX1,"-",2)) PSJANS Q:'$D(PSJANS)  S PSJANS=PSJANS_PSJX2_"," Q:PSJX2=$P(PSJX1,"-",2)
"RTN","PSJUTL",122,0)
 Q
"RTN","PSJUTL",123,0)
 ;
"RTN","PSJUTL",124,0)
ENMARDH ;Help text for MAR default answer.
"RTN","PSJUTL",125,0)
 W !!?2,"Enter the number corresponding to the type of orders to be included on MARs",!,"printed for this ward. Multiple types (except 1) may be selected using ""-""",!,"or "","" as delimiters.",!!,"Choose from: ",!
"RTN","PSJUTL",126,0)
 N X F X=1:1:6 W !?13,X," - ",$P($T(@X),";;",2)
"RTN","PSJUTL",127,0)
 W !
"RTN","PSJUTL",128,0)
 Q
"RTN","PSJUTL",129,0)
1 ;;All Medications
"RTN","PSJUTL",130,0)
2 ;;Non-IV Medications only
"RTN","PSJUTL",131,0)
3 ;;IV Piggybacks
"RTN","PSJUTL",132,0)
4 ;;LVPs
"RTN","PSJUTL",133,0)
5 ;;TPNs
"RTN","PSJUTL",134,0)
6 ;;Chemotherapy Medications (IV)
"RTN","PSJUTL",135,0)
 ;
"RTN","PSJUTL",136,0)
EFD ;The following EFD Tags are used to Calculate the Expected First Dose for backdoor
"RTN","PSJUTL",137,0)
 ;orders.  The call to $$ENQ^PSJORP2 is used to actually perform the calculation.
"RTN","PSJUTL",138,0)
 ;The program $$ENQ^PSJORP2 requires the variable INFO to equal the following:
"RTN","PSJUTL",139,0)
 ;BHW;PSJ*5*136
"RTN","PSJUTL",140,0)
 ; INFO (piece 1) = START DATE/TIME      ;PSGNESD (NEW ORDER)
"RTN","PSJUTL",141,0)
 ; INFO (piece 2) = STOP DATE/TIME       ;PSGNEFD (NEW ORDER)
"RTN","PSJUTL",142,0)
 ; INFO (piece 3) = SCHEDULE             ;PSGSCH  (NEW ORDER)
"RTN","PSJUTL",143,0)
 ; INFO (piece 4) = SCHEDULE TYPE        ;PSGST   (NEW ORDER)
"RTN","PSJUTL",144,0)
 ; INFO (piece 5) = ORDERABLE ITEM       ;PSGDRG  (NEW ORDER)
"RTN","PSJUTL",145,0)
 ; INFO (piece 6) = ADMIN TIMES          ;PSGS0Y  (NEW ORDER)
"RTN","PSJUTL",146,0)
 ; 
"RTN","PSJUTL",147,0)
EFDNEW ;Call Here if NEW or RENEWED Order
"RTN","PSJUTL",148,0)
 N INFO
"RTN","PSJUTL",149,0)
 S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",150,0)
 D EFDDISP
"RTN","PSJUTL",151,0)
 QUIT
"RTN","PSJUTL",152,0)
EFDACT ;Call here if Editing Fields for an ACTIVE order
"RTN","PSJUTL",153,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",154,0)
 ; Field 34 = Stop Date
"RTN","PSJUTL",155,0)
 ; Field 41 = Admin Times
"RTN","PSJUTL",156,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",157,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",158,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^34^41"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",159,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",160,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",161,0)
 ;Only display EFD once, so Quit if this call is not for the Last field in the Edit
"RTN","PSJUTL",162,0)
 S LAST=ORDER(LAST)
"RTN","PSJUTL",163,0)
 I LAST'=PSGF2 Q
"RTN","PSJUTL",164,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",165,0)
 D EFDDISP
"RTN","PSJUTL",166,0)
 QUIT
"RTN","PSJUTL",167,0)
EFDNV ;Call here if Editing Fields for a NON-VERIFIED order
"RTN","PSJUTL",168,0)
 ; Field 10 = Start Date
"RTN","PSJUTL",169,0)
 ; Field 25 = Stop Date
"RTN","PSJUTL",170,0)
 ; Field 39 = Admin Times
"RTN","PSJUTL",171,0)
 N INFO,KEY,ORDER,LAST
"RTN","PSJUTL",172,0)
 ;Check if called during finish process
"RTN","PSJUTL",173,0)
 I '$D(PSGOEER) D  D EFDDISP Q
"RTN","PSJUTL",174,0)
 . S INFO=($G(PSGNESD))_U_($G(PSGNEFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",175,0)
 . Q
"RTN","PSJUTL",176,0)
 ;Loop Fields to be edited, in order, and determine when to Display expected first dose message
"RTN","PSJUTL",177,0)
 F KEY=1:1 S ORDER=$P(PSGOEER,";",KEY) Q:'$L(ORDER)  I "10^25^39"[$P(ORDER,U,1) S ORDER(KEY)=$P(ORDER,U,1)
"RTN","PSJUTL",178,0)
 ;If there are no entries in ORDER, then were Not Editing Start/Stop or Admin Times
"RTN","PSJUTL",179,0)
 S LAST=$O(ORDER(99),-1) Q:'LAST
"RTN","PSJUTL",180,0)
 ;Only display EFD once, so Quit if this call is not for the Last field in the Edit
"RTN","PSJUTL",181,0)
 S LAST=ORDER(LAST)
"RTN","PSJUTL",182,0)
 I LAST'=PSGF2 Q
"RTN","PSJUTL",183,0)
 S INFO=($G(PSGSD))_U_($G(PSGFD))_U_($G(PSGSCH))_U_($G(PSGST))_U_($G(PSGPDRG))_U_($G(PSGS0Y))
"RTN","PSJUTL",184,0)
 D EFDDISP
"RTN","PSJUTL",185,0)
 QUIT
"RTN","PSJUTL",186,0)
EFDDISP ;Display Expected First Dose
"RTN","PSJUTL",187,0)
 N Y
"RTN","PSJUTL",188,0)
 I '$L($G(PSGP)) N PSGP S PSGP=""
"RTN","PSJUTL",189,0)
 ;
"RTN","PSJUTL",190,0)
 S Y=$$ENQ^PSJORP2(PSGP,INFO)
"RTN","PSJUTL",191,0)
 I 'Y S Y="Unable to Calculate"
"RTN","PSJUTL",192,0)
 X ^DD("DD")
"RTN","PSJUTL",193,0)
 W !,"Expected First Dose: ",Y H 2
"RTN","PSJUTL",194,0)
 Q
"VER")
8.0^22.0
**END**
**END**
