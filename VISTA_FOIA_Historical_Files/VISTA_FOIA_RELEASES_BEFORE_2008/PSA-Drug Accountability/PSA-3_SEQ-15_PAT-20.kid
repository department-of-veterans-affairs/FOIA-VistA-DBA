Released PSA*3*20 SEQ #15
Extracted from mail message
**KIDS**:PSA*3.0*20^

**INSTALL NAME**
PSA*3.0*20
"BLD",775,0)
PSA*3.0*20^DRUG ACCOUNTABILITY^0^2990907^y
"BLD",775,1,0)
^^3^3^2990907^^
"BLD",775,1,1,0)
 When the user tries to print a report of invoices that were uploaded, 
"BLD",775,1,2,0)
 an undefined error could occur at HAVDEDRG+1 of the PSAUP4 routine if
"BLD",775,1,3,0)
 the 2 node was missing from the DRUG file (#50).
"BLD",775,"KRN",0)
^9.67PA^^
"BLD",775,"KRN",.4,0)
.4
"BLD",775,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",775,"KRN",.401,0)
.401
"BLD",775,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",775,"KRN",.402,0)
.402
"BLD",775,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",775,"KRN",.403,0)
.403
"BLD",775,"KRN",.5,0)
.5
"BLD",775,"KRN",.84,0)
.84
"BLD",775,"KRN",3.6,0)
3.6
"BLD",775,"KRN",3.8,0)
3.8
"BLD",775,"KRN",9.2,0)
9.2
"BLD",775,"KRN",9.8,0)
9.8
"BLD",775,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",775,"KRN",9.8,"NM",1,0)
PSAUP4^^0^B71359136
"BLD",775,"KRN",9.8,"NM","B","PSAUP4",1)

"BLD",775,"KRN",19,0)
19
"BLD",775,"KRN",19.1,0)
19.1
"BLD",775,"KRN",101,0)
101
"BLD",775,"KRN",409.61,0)
409.61
"BLD",775,"KRN",771,0)
771
"BLD",775,"KRN",869.2,0)
869.2
"BLD",775,"KRN",870,0)
870
"BLD",775,"KRN",8994,0)
8994
"BLD",775,"KRN","B",.4,.4)

"BLD",775,"KRN","B",.401,.401)

"BLD",775,"KRN","B",.402,.402)

"BLD",775,"KRN","B",.403,.403)

"BLD",775,"KRN","B",.5,.5)

"BLD",775,"KRN","B",.84,.84)

"BLD",775,"KRN","B",3.6,3.6)

"BLD",775,"KRN","B",3.8,3.8)

"BLD",775,"KRN","B",9.2,9.2)

"BLD",775,"KRN","B",9.8,9.8)

"BLD",775,"KRN","B",19,19)

"BLD",775,"KRN","B",19.1,19.1)

"BLD",775,"KRN","B",101,101)

"BLD",775,"KRN","B",409.61,409.61)

"BLD",775,"KRN","B",771,771)

"BLD",775,"KRN","B",869.2,869.2)

"BLD",775,"KRN","B",870,870)

"BLD",775,"KRN","B",8994,8994)

"BLD",775,"QUES",0)
^9.62^^
"BLD",775,"REQB",0)
^9.611^1^1
"BLD",775,"REQB",1,0)
PSA*3.0*12^1
"BLD",775,"REQB","B","PSA*3.0*12",1)

"BLD",775,"REQG",0)
^9.611^^
"PKG",182,-1)
1^1
"PKG",182,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability/Inventory Interface^
"PKG",182,20,0)
^9.402P^^0
"PKG",182,22,0)
^9.49I^1^1
"PKG",182,22,1,0)
3.0^2990610^2970912^531
"PKG",182,22,1,"PAH",1,0)
20^2990907^543
"PKG",182,22,1,"PAH",1,1,0)
^^3^3^2991021
"PKG",182,22,1,"PAH",1,1,1,0)
 When the user tries to print a report of invoices that were uploaded, 
"PKG",182,22,1,"PAH",1,1,2,0)
 an undefined error could occur at HAVDEDRG+1 of the PSAUP4 routine if
"PKG",182,22,1,"PAH",1,1,3,0)
 the 2 node was missing from the DRUG file (#50).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSAUP4")
0^1^B71359136
"RTN","PSAUP4",1,0)
PSAUP4 ;BIR/JMB-Upload and Process Prime Vendor Invoice Data - CONT'D ;9/19/97
"RTN","PSAUP4",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**3,12,20**; 10/24/97
"RTN","PSAUP4",3,0)
 ;This routine prints invoices from the ^XTMP global on the screen or
"RTN","PSAUP4",4,0)
 ;to a printer.
"RTN","PSAUP4",5,0)
 ;
"RTN","PSAUP4",6,0)
 ;References to ^PSDRUG( are covered by IA #2095
"RTN","PSAUP4",7,0)
 ;References to ^DIC(51.5( are covered by IA #1931
"RTN","PSAUP4",8,0)
 ;
"RTN","PSAUP4",9,0)
 W !!,"Enter the device which will be used to print",!,"the invoices with all items, errors, and adjustments.",!
"RTN","PSAUP4",10,0)
 S %ZIS="Q" D ^%ZIS I POP S PSAOUT=1 Q
"RTN","PSAUP4",11,0)
 I $D(IO("Q")) S ZTDESC="Drug Acct. - Prime Vendor Invoice Upload Report",ZTRTN="DQ^PSAUP4" D ^%ZTLOAD Q
"RTN","PSAUP4",12,0)
 ;
"RTN","PSAUP4",13,0)
DQ ;queue starts here
"RTN","PSAUP4",14,0)
 S IOM=80
"RTN","PSAUP4",15,0)
 D NOW^%DTC S Y=% D DD^%DT S PSARUN=$E(Y,1,18),$P(PSASLN,"-",80)="",$P(PSADLN,"=",80)="",(PSADJDRG,PSADJSUP,PSAOUT)=0,PSAFPG=1
"RTN","PSAUP4",16,0)
 U IO
"RTN","PSAUP4",17,0)
 S PSACTRL=0 F  S PSACTRL=$O(^XTMP("PSAPV",PSACTRL)) Q:PSACTRL=""!(PSAOUT)  D START
"RTN","PSAUP4",18,0)
 W @IOF D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@" K IO("Q")
"RTN","PSAUP4",19,0)
 ;
"RTN","PSAUP4",20,0)
EXIT ;Kills printing variables only
"RTN","PSAUP4",21,0)
 K %,%ZIS,DIR,DIRUT,PSAAECST,PSABY,PSACS,PSACTRL,PSADATA,PSADATE,PSADEC,PSADRG,PSADJDRG,PSADJORD,PSADJQTY,PSADJSUP,PSADLN,PSADS,PSAECOST,PSAEND,PSAFPG,PSAICOST,PSAIECST
"RTN","PSAUP4",22,0)
 K PSAIN,PSALINE,PSANDC,PSAODT,PSAODUZ,PSAOREA,PSAOUT,PSAPAGE,PSAPHARM,PSAQDT,PSAQDUZ,PSAQREA,PSAMV,PSARUN,PSAS,PSASLN,PSASS,PSAST,PSASTA,PSATOT,Y,ZTDESC,ZTRTN,ZTSK
"RTN","PSAUP4",23,0)
 Q
"RTN","PSAUP4",24,0)
 ;
"RTN","PSAUP4",25,0)
START S PSAPAGE=1,PSAEND=0 D HEADER S PSAIN=$G(^XTMP("PSAPV",PSACTRL,"IN"))
"RTN","PSAUP4",26,0)
 S (PSADJDRG,PSADJSUP,PSAIECST,PSAAECST)=0,PSAPHARM=$P(PSAIN,"^",7),PSAMV=$P(PSAIN,"^",12)
"RTN","PSAUP4",27,0)
 W !,"PRIME VENDOR : ",$S($P($G(^XTMP("PSAPV",PSACTRL,"DS")),"^")'="":$P($G(^("DS")),"^"),1:"UNKNOWN")
"RTN","PSAUP4",28,0)
 W !!,"ORDER#  : "_$P(PSAIN,"^",4),?40,"ORDER DATE  : "_$$DATE($P(PSAIN,"^",3))
"RTN","PSAUP4",29,0)
 W !,"INVOICE#: "_$P(PSAIN,"^",2),?40,"INVOICE DATE: "_$$DATE(+PSAIN)
"RTN","PSAUP4",30,0)
 S PSASTA=$P(PSAIN,"^",8)
"RTN","PSAUP4",31,0)
 W !,"STATUS  : "_$S(PSASTA="":"UPLOADED WITH ERRORS",PSASTA="OK":"UPLOADED WITHOUT ERRORS",PSASTA="P":"PROCESSED",1:"UNKNOWN")_$S($P(PSAIN,"^",13)="SUP":" (SUPPLY INVOICE)",1:"")
"RTN","PSAUP4",32,0)
 I $Y+8>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",33,0)
 I $E(IOST,1,2)="C-" D LINE Q
"RTN","PSAUP4",34,0)
 W !!,"DELIVERY DATE REQUESTED: ",$$DATE($P(PSAIN,"^",5))
"RTN","PSAUP4",35,0)
 W !,"DATE RECEIVED          : "_$S(+$P(PSAIN,"^",11)&($$DATE(+$P(PSAIN,"^",11))):" ("_$$DATE($P(PSAIN,"^",6))_")",1:$$DATE($P(PSAIN,"^",6)))
"RTN","PSAUP4",36,0)
 I $Y+8>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:$G(PSAOUT)  D HEADER
"RTN","PSAUP4",37,0)
 ;
"RTN","PSAUP4",38,0)
BUYSHIP W !!,"BUYER INFORMATION:",?40,"SHIPPING INFORMATION:"
"RTN","PSAUP4",39,0)
 S PSABY=$G(^XTMP("PSAPV",PSACTRL,"BY"))
"RTN","PSAUP4",40,0)
 S PSAST=$G(^XTMP("PSAPV",PSACTRL,"ST"))
"RTN","PSAUP4",41,0)
 W !?2,$P(PSABY,"^"),?42,$P(PSAST,"^")
"RTN","PSAUP4",42,0)
 I $P(PSABY,"^",2)'=""!($P(PSAST,"^",2)'="") W ! W:$P(PSABY,"^",2)'="" ?2,$P(PSABY,"^",2) W:$P(PSAST,"^",2)'="" ?42,$P(PSAST,"^",2)
"RTN","PSAUP4",43,0)
 I $P(PSABY,"^",3)'=""!($P(PSAST,"^",3)'="") W ! W:$P(PSABY,"^",3)'="" ?2,$P(PSABY,"^",3) W:$P(PSAST,"^",3)'="" ?42,$P(PSAST,"^",3)
"RTN","PSAUP4",44,0)
 W !?2,$P(PSABY,"^",4)_" "_$P(PSABY,"^",5)_"  ",$P(PSABY,"^",6)
"RTN","PSAUP4",45,0)
 W ?42,$P(PSAST,"^",4)_" "_$P(PSAST,"^",5)_"  ",$P(PSAST,"^",6)
"RTN","PSAUP4",46,0)
 I $Y+8>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",47,0)
 ;
"RTN","PSAUP4",48,0)
DISTRIB W !!,"DISTRIBUTOR INFORMATION:"
"RTN","PSAUP4",49,0)
 S PSADS=$G(^XTMP("PSAPV",PSACTRL,"DS"))
"RTN","PSAUP4",50,0)
 W !?2,$P(PSADS,"^")
"RTN","PSAUP4",51,0)
 W:$P(PSADS,"^",2)'="" !?2,$P(PSADS,"^",2)
"RTN","PSAUP4",52,0)
 W:$P(PSADS,"^",3)'="" !?2,$P(PSADS,"^",3)
"RTN","PSAUP4",53,0)
 W !?2,$P(PSADS,"^",4)_" "_$P(PSADS,"^",5)_"  ",$P(PSADS,"^",6)
"RTN","PSAUP4",54,0)
 I $Y+8>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",55,0)
 D LINE
"RTN","PSAUP4",56,0)
 Q
"RTN","PSAUP4",57,0)
 ;
"RTN","PSAUP4",58,0)
DATE(PSADATE)         ;convert date
"RTN","PSAUP4",59,0)
 S %=$E(PSADATE,4,5)_"/"_$E(PSADATE,6,7)_"/"_$E(PSADATE,2,3)
"RTN","PSAUP4",60,0)
 I $TR(%,"/")="" S %="UNKNOWN"
"RTN","PSAUP4",61,0)
 Q %
"RTN","PSAUP4",62,0)
 ;
"RTN","PSAUP4",63,0)
LINE ;print line items
"RTN","PSAUP4",64,0)
 D LINEHDR
"RTN","PSAUP4",65,0)
 S (PSAICOST,PSALINE,PSATOT)=0 F  S PSALINE=$O(^XTMP("PSAPV",PSACTRL,"IT",PSALINE)) Q:'PSALINE!(PSAOUT)  S PSADATA=^(PSALINE),PSADRG=0 D  Q:PSAOUT
"RTN","PSAUP4",66,0)
 .I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAUP4",67,0)
 .K PSADJQTY,PSAQDUZ,PSAQDT,PSAQREA,PSADJORD,PSAODUZ,PSAODT,PSAOREA
"RTN","PSAUP4",68,0)
 .W !,PSALINE
"RTN","PSAUP4",69,0)
DRUG .;Drug
"RTN","PSAUP4",70,0)
 .I +$P(PSADATA,"^",15) S PSADRG=+$P(PSADATA,"^",15) W ?8,"*"_$P($G(^PSDRUG(+$P(PSADATA,"^",15),0)),"^")_$S(+$P(PSADATA,"^",6)&($P($G(^PSDRUG(+$P(PSADATA,"^",6),0)),"^")'=""):" ("_$P(^PSDRUG(+$P(PSADATA,"^",6),0),"^")_")",1:"") S PSADJDRG=1
"RTN","PSAUP4",71,0)
 .I PSADRG,$D(^PSDRUG(PSADRG,"I")) W !,?5,"** INACTIVE IN DRUG FILE **"
"RTN","PSAUP4",72,0)
 .I '+$P(PSADATA,"^",15) D
"RTN","PSAUP4",73,0)
 ..I +$P(PSADATA,"^",6),$P($G(^PSDRUG(+$P(PSADATA,"^",6),0)),"^")'="" W ?9,$P(^PSDRUG(+$P(PSADATA,"^",6),0),"^") S PSADRG=+$P(PSADATA,"^",6) Q
"RTN","PSAUP4",74,0)
 ..I $P($G(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP")),"^",3)'="" W ?7,"**"_$P(^XTMP("PSAPV",PSACTRL,"IT",PSALINE,"SUP"),"^",3)  S PSADJSUP=1,PSADRG=0 Q
"RTN","PSAUP4",75,0)
 ..W ?9,"DRUG UNKNOWN"
"RTN","PSAUP4",76,0)
 .I $P(PSADATA,"^",19)="CS" W " (CONTROLLED SUBS)" I $P($G(^PSD(58.8,+$P(PSAIN,"^",12),1,PSADRG,0)),"^",14),$P($G(^(0)),"^",14)'>DT  W !?5,"*** INACTIVE IN MASTER VAULT"
"RTN","PSAUP4",77,0)
 .E  I PSADRG,$P($G(^PSD(58.8,+$P(PSAIN,"^",7),1,PSADRG,0)),"^",14),$P($G(^(0)),"^",14)'>DT W !?5,"*** INACTIVE IN PHARMACY LOCATION"
"RTN","PSAUP4",78,0)
 .;UPC
"RTN","PSAUP4",79,0)
 .I $P($P(PSADATA,"^",26),"~")'="" W !?9,"UPC: "_$P($P(PSADATA,"^",26),"~")
"RTN","PSAUP4",80,0)
 .;NDC
"RTN","PSAUP4",81,0)
 .S PSANDC=$P($P(PSADATA,"^",4),"~")
"RTN","PSAUP4",82,0)
 .I $E(PSANDC)'="S" D
"RTN","PSAUP4",83,0)
 ..W !?9 I PSANDC?12N W $E(PSANDC,1,6)_"-"_$E(PSANDC,7,10)_"-"_$E(PSANDC,11,12) Q
"RTN","PSAUP4",84,0)
 ..I PSANDC'="" W PSANDC Q
"RTN","PSAUP4",85,0)
 ..W "NDC UNKNOWN"
"RTN","PSAUP4",86,0)
 .;
"RTN","PSAUP4",87,0)
 .;VSN
"RTN","PSAUP4",88,0)
 .W ?25,$S($P($P(PSADATA,"^",5),"~")'="":$E($P($P(PSADATA,"^",5),"~"),1,14),1:"VSN UNKNOWN")
"RTN","PSAUP4",89,0)
 .;
"RTN","PSAUP4",90,0)
 .;QTY
"RTN","PSAUP4",91,0)
 .;No Adjusted Qty
"RTN","PSAUP4",92,0)
 .S PSAIECST=PSAIECST+($P(PSADATA,"^")*$P(PSADATA,"^",3))
"RTN","PSAUP4",93,0)
 .I $P(PSADATA,"^",8)="" W ?40,$J($P(PSADATA,"^"),6) S PSAECOST=$P(PSADATA,"^")*$P(PSADATA,"^",3),PSAAECST=PSAAECST+PSAECOST
"RTN","PSAUP4",94,0)
 .;Adj. Qty (P)
"RTN","PSAUP4",95,0)
 .I $P(PSADATA,"^",8)'="" D
"RTN","PSAUP4",96,0)
 ..S PSADJQTY=$P(PSADATA,"^",8),PSAQDUZ=$P(PSADATA,"^",9),PSAQDT=$P(PSADATA,"^",10),PSAQREA=$P(PSADATA,"^",11)
"RTN","PSAUP4",97,0)
 ..S PSAECOST=PSADJQTY*$P(PSADATA,"^",3),PSAAECST=PSAAECST+PSAECOST
"RTN","PSAUP4",98,0)
 ..W ?40,$J($P(PSADATA,"^",8),6)_"("_$P(PSADATA,"^")_")"
"RTN","PSAUP4",99,0)
 .;
"RTN","PSAUP4",100,0)
 .;Order Unit
"RTN","PSAUP4",101,0)
 .I '+$P(PSADATA,"^",12) D
"RTN","PSAUP4",102,0)
 ..I +$P($P(PSADATA,"^",2),"~",2),$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",2),0)),"^")'="" W ?53,$P($G(^DIC(51.5,+$P($P(PSADATA,"^",2),"~",2),0)),"^") Q
"RTN","PSAUP4",103,0)
 ..I $P($P(PSADATA,"^",2),"~")="" D ^PSAHELP
"RTN","PSAUP4",104,0)
 .;Adj. OU (P)
"RTN","PSAUP4",105,0)
 .I +$P(PSADATA,"^",12) S PSADJORD=$P(PSADATA,"^",12),PSAODUZ=$P(PSADATA,"^",13),PSAODT=$P(PSADATA,"^",14) W ?53,$P($G(^DIC(51.5,+$P(PSADATA,"^",12),0)),"^")_"("_$P($P(PSADATA,"^",2),"~")_")"
"RTN","PSAUP4",106,0)
 .;Unit price
"RTN","PSAUP4",107,0)
 .S PSADEC=$S($L($P($P(PSADATA,"^",3),".",2))>1:$L($P($P(PSADATA,"^",3),".",2)),1:2)
"RTN","PSAUP4",108,0)
 .W ?59,$J($P(PSADATA,"^",3),7,PSADEC)
"RTN","PSAUP4",109,0)
 .;Extended cost
"RTN","PSAUP4",110,0)
 .W ?67,$J(PSAECOST,12,2)
"RTN","PSAUP4",111,0)
 .I $Y+9>IOSL,+$P(PSADATA,"^",21),+$P(PSADATA,"^",27) D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAUP4",112,0)
 .I $G(PSADRG) D HAVEDRG
"RTN","PSAUP4",113,0)
 .I '$G(PSADRG) W !?9,"STOCK LEVEL  : ",!?9,"REORDER LEVEL: "_$P(PSADATA,"^",21),!?9,"DISPENSE UNITS/ORDER UNIT: "
"RTN","PSAUP4",114,0)
 .;
"RTN","PSAUP4",115,0)
 .;Print Adj Qty
"RTN","PSAUP4",116,0)
 .I $G(PSADJQTY)'="" D
"RTN","PSAUP4",117,0)
 ..I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAUP4",118,0)
 ..W !!?9,"ADJUSTED QUANTITY: "_PSADJQTY,!?9,$$DATE(PSAQDT)_" "_$P($G(^VA(200,+PSAQDUZ,0)),"^"),!?11,PSAQREA
"RTN","PSAUP4",119,0)
 .;Print Adj OU
"RTN","PSAUP4",120,0)
 .I +$G(PSADJORD) D
"RTN","PSAUP4",121,0)
 ..I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER,LINEHDR
"RTN","PSAUP4",122,0)
 ..W !!,?9,"ADJUSTED ORDER UNIT: "_$P($G(^DIC(51.5,+PSADJORD,0)),"^")
"RTN","PSAUP4",123,0)
 ..W !?9,$$DATE(PSAODT)_" "_$P($G(^VA(200,+PSAODUZ,0)),"^")_" - "_$P($G(^DIC(51.5,PSADJORD,0)),"^")
"RTN","PSAUP4",124,0)
 .W !
"RTN","PSAUP4",125,0)
 Q:PSAOUT
"RTN","PSAUP4",126,0)
 I $Y+6>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",127,0)
 W !,PSASLN
"RTN","PSAUP4",128,0)
 W:$G(PSAAECST)'=$G(PSAIECST) !?48,"TOTAL ADUSTED COST",?67,$J(PSAAECST,12,2),!
"RTN","PSAUP4",129,0)
 W !?48,"TOTAL INVOICED COST",?67,$J(PSAIECST,12,2)
"RTN","PSAUP4",130,0)
 S PSAEND=1
"RTN","PSAUP4",131,0)
 I $Y+5>IOSL D:$E(IOST,1,2)="C-" SCREEN Q:PSAOUT  D HEADER
"RTN","PSAUP4",132,0)
 I PSADJDRG,$E(IOST)'="C" W !!,"* THE DRUG WAS MATCHED TO THE DRUG FILE."
"RTN","PSAUP4",133,0)
 I PSADJSUP,$E(IOST)'="C" W !!,"* THE ITEM IS A SUPPLY ITEM."
"RTN","PSAUP4",134,0)
 D:$E(IOST,1,2)="C-" SCREEN
"RTN","PSAUP4",135,0)
 Q
"RTN","PSAUP4",136,0)
 ;
"RTN","PSAUP4",137,0)
LINEHDR ;item header
"RTN","PSAUP4",138,0)
 W !?50,"ORDER",?62,"COST/",?71,"EXTENDED"
"RTN","PSAUP4",139,0)
 W !,"LINE#",?9,"NDC",?25,"VSN",?43,"QTY",?51,"UNIT",?62,"UNIT",?75,"COST",!,PSADLN,!
"RTN","PSAUP4",140,0)
 Q
"RTN","PSAUP4",141,0)
 ;
"RTN","PSAUP4",142,0)
HEADER ;Page header
"RTN","PSAUP4",143,0)
 I PSAFPG&($E(IOST,1,2)="C-") W @IOF G HDR1
"RTN","PSAUP4",144,0)
 S PSAFPG=0
"RTN","PSAUP4",145,0)
 W:'PSAFPG @IOF
"RTN","PSAUP4",146,0)
HDR1 W !?20,"DRUG ACCOUNTABILITY/INVENTORY INTERFACE"
"RTN","PSAUP4",147,0)
 W !?26,"PRIME VENDOR UPLOAD REPORT",!
"RTN","PSAUP4",148,0)
 W:PSAPAGE'=1 !,"ORDER#: "_$P(PSAIN,"^",4)_"  INVOICE#: "_$P(PSAIN,"^",2)
"RTN","PSAUP4",149,0)
 I $E(IOST,1,2)="C-" W ?(74-$L(PSAPAGE)),"PAGE "_PSAPAGE,!,PSADLN
"RTN","PSAUP4",150,0)
 I $E(IOST)'="C" W !,"RUN: "_PSARUN,?(74-$L(PSAPAGE)),"PAGE "_PSAPAGE,!,PSADLN
"RTN","PSAUP4",151,0)
 S PSAPAGE=PSAPAGE+1
"RTN","PSAUP4",152,0)
 Q
"RTN","PSAUP4",153,0)
SCREEN ;Hold on screen
"RTN","PSAUP4",154,0)
 S PSAS=20-$Y I PSAS F PSASS=1:1:PSAS W !
"RTN","PSAUP4",155,0)
 I PSADJDRG,PSAEND W !," * THE DRUG WAS MATCHED TO THE DRUG FILE."
"RTN","PSAUP4",156,0)
 I PSADJSUP,PSAEND W !,"** THE ITEM IS A SUPPLY ITEM."
"RTN","PSAUP4",157,0)
 S DIR(0)="E" D ^DIR K DIR I $G(DIRUT) S PSAOUT=1
"RTN","PSAUP4",158,0)
 Q
"RTN","PSAUP4",159,0)
 ;
"RTN","PSAUP4",160,0)
HAVEDRG ;Display data if drug is found.
"RTN","PSAUP4",161,0)
 ;DAVE B (PSA*3*20) 7SEP99 ADDED $G TO NEXT LINE
"RTN","PSAUP4",162,0)
 S PSACS=$S($P($G(^PSDRUG(PSADRG,2)),"^",3)["N":1,1:0)
"RTN","PSAUP4",163,0)
 I PSACS D
"RTN","PSAUP4",164,0)
 .I PSAMV,+$P($G(^PSD(58.8,PSAMV,0)),"^",14) D  Q
"RTN","PSAUP4",165,0)
 ..W !?9,"STOCK LEVEL  : "_$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),1:+$P($G(^PSD(58.8,PSAMV,1,PSADRG,0)),"^",3))
"RTN","PSAUP4",166,0)
 ..W !?9,"REORDER LEVEL: "_$S(+$P(PSADATA,"^",21):+$P(PSADATA,"^",21),1:+$P($G(^PSD(58.8,PSAMV,1,PSADRG,0)),"^",5))
"RTN","PSAUP4",167,0)
 .I 'PSAMV W !?9,"STOCK LEVEL  : "_$P(PSADATA,"^",27),!?9,"REORDER LEVEL: "_$P(PSADATA,"^",21)
"RTN","PSAUP4",168,0)
 I 'PSACS D
"RTN","PSAUP4",169,0)
 .I PSAPHARM,+$P($G(^PSD(58.8,PSAPHARM,0)),"^",14) D
"RTN","PSAUP4",170,0)
 ..W !?9,"STOCK LEVEL  : "_$S(+$P(PSADATA,"^",27):+$P(PSADATA,"^",27),1:+$P($G(^PSD(58.8,PSAPHARM,1,PSADRG,0)),"^",3))
"RTN","PSAUP4",171,0)
 ..W !?9,"REORDER LEVEL: "_$S(+$P(PSADATA,"^",21):+$P(PSADATA,"^",21),1:+$P($G(^PSD(58.8,PSAPHARM,1,PSADRG,0)),"^",5))
"RTN","PSAUP4",172,0)
 .I 'PSAPHARM W !?9,"STOCK LEVEL  : "_$P(PSADATA,"^",27),!?9,"REORDER LEVEL: "_$P(PSADATA,"^",21)
"RTN","PSAUP4",173,0)
 W !?9,"DISPENSE UNITS/ORDER UNIT: "
"RTN","PSAUP4",174,0)
 W $S(+$P(PSADATA,"^",20):+$P(PSADATA,"^",20),+$P($G(^PSDRUG(PSADRG,1,+$P(PSADATA,"^",7),0)),"^",7):+$P($G(^PSDRUG(PSADRG,1,+$P(PSADATA,"^",7),0)),"^",7),1:"")
"RTN","PSAUP4",175,0)
 Q
"VER")
8.0^22.0
**END**
**END**
