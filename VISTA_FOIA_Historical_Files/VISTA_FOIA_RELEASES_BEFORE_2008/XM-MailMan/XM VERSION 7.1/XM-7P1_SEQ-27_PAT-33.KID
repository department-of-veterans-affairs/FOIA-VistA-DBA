Released XM*7.1*33 SEQ #27
Extracted from mail message
**KIDS**:XM*7.1*33^

**INSTALL NAME**
XM*7.1*33
"BLD",15,0)
XM*7.1*33^MAILMAN^0^2960828^n
"BLD",15,1,0)
^^46^46^2960828^^
"BLD",15,1,1,0)
 This patch changes the way KIDS secures a Packman Message. The prompt:
"BLD",15,1,2,0)
    'Enter the scramble hint:' 
"BLD",15,1,3,0)
 has been removed.  A new prompt:
"BLD",15,1,4,0)
    'Do you wish to secure this message? No//'
"BLD",15,1,5,0)
 will be asked after you enter the text for a message. This correct the
"BLD",15,1,6,0)
 problem that was identified by Nois CLE-0696-40353.
"BLD",15,1,7,0)
 This patch is the same as Kernel patch XU*8*40. Both patches contain
"BLD",15,1,8,0)
 the same MailMan and Kernel routines.
"BLD",15,1,9,0)
===========================================================================
"BLD",15,1,10,0)

"BLD",15,1,11,0)
This patch should be installed during off-peak hours. Users can be on the
"BLD",15,1,12,0)
system, but no user should be using KIDS during the install of this patch.
"BLD",15,1,13,0)
===========================================================================
"BLD",15,1,14,0)
  
"BLD",15,1,15,0)
INSTALLATION:
"BLD",15,1,16,0)
  1.  These routines are usually mapped on systems that allow mapping,
"BLD",15,1,17,0)
      so you will need to disable mapping for the effected routines.
"BLD",15,1,18,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"BLD",15,1,19,0)
      option will load the KIDS package onto your system.
"BLD",15,1,20,0)
  3.  The patch has now been loaded into a Transport global on your
"BLD",15,1,21,0)
      system. You now need to use KIDS to install the Transport global.
"BLD",15,1,22,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"BLD",15,1,23,0)
      options:
"BLD",15,1,24,0)
         Print Transport Global
"BLD",15,1,25,0)
         Compare Transport Global to Current System
"BLD",15,1,26,0)
         Verify Checksums in Transport Global
"BLD",15,1,27,0)
         Backup a Transport Global
"BLD",15,1,28,0)
         Install Package(s)
"BLD",15,1,29,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"BLD",15,1,30,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"BLD",15,1,31,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"BLD",15,1,32,0)
 ===========================================================================
"BLD",15,1,33,0)
  
"BLD",15,1,34,0)
 ROUTINES:
"BLD",15,1,35,0)
   The second line of the routine now looks like:
"BLD",15,1,36,0)
       ;;7.1;MailMan;**33**;Jun 02, 1994
"BLD",15,1,37,0)
 
"BLD",15,1,38,0)
 Name           Checksum        Patch List
"BLD",15,1,39,0)
 -----------------------------------------------------------
"BLD",15,1,40,0)
 XMASEC         4454626         33
"BLD",15,1,41,0)
 XMD            4879878         33
"BLD",15,1,42,0)

"BLD",15,1,43,0)
       ;;8.0;KERNEL;**[patch list]**;Jul 10, 1995
"BLD",15,1,44,0)

"BLD",15,1,45,0)
 XPDTP          2358145         21,40
"BLD",15,1,46,0)
 ============================================================================
"BLD",15,4,0)
^9.64PA^^
"BLD",15,"KRN",0)
^9.67PA^19^12
"BLD",15,"KRN",.4,0)
.4
"BLD",15,"KRN",.401,0)
.401
"BLD",15,"KRN",.402,0)
.402
"BLD",15,"KRN",.403,0)
.403
"BLD",15,"KRN",.5,0)
.5
"BLD",15,"KRN",.84,0)
.84
"BLD",15,"KRN",3.6,0)
3.6
"BLD",15,"KRN",3.8,0)
3.8
"BLD",15,"KRN",9.2,0)
9.2
"BLD",15,"KRN",9.8,0)
9.8
"BLD",15,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",15,"KRN",9.8,"NM",1,0)
XMASEC^^0^B8241992
"BLD",15,"KRN",9.8,"NM",2,0)
XMD^^0^B11636233
"BLD",15,"KRN",9.8,"NM",3,0)
XPDTP^^0^B3174483
"BLD",15,"KRN",9.8,"NM","B","XMASEC",1)

"BLD",15,"KRN",9.8,"NM","B","XMD",2)

"BLD",15,"KRN",9.8,"NM","B","XPDTP",3)

"BLD",15,"KRN",19,0)
19
"BLD",15,"KRN",19.1,0)
19.1
"BLD",15,"KRN","B",.4,.4)

"BLD",15,"KRN","B",.401,.401)

"BLD",15,"KRN","B",.402,.402)

"BLD",15,"KRN","B",.403,.403)

"BLD",15,"KRN","B",.5,.5)

"BLD",15,"KRN","B",.84,.84)

"BLD",15,"KRN","B",3.6,3.6)

"BLD",15,"KRN","B",3.8,3.8)

"BLD",15,"KRN","B",9.2,9.2)

"BLD",15,"KRN","B",9.8,9.8)

"BLD",15,"KRN","B",19,19)

"BLD",15,"KRN","B",19.1,19.1)

"PKG",6,-1)
1^1
"PKG",6,0)
MAILMAN^XM^Electronic Mail, both local and networked
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.1^2940602^2950925
"PKG",6,22,1,"PAH",1,0)
33^2960828
"PKG",6,22,1,"PAH",1,1,0)
^^46^46^2960828
"PKG",6,22,1,"PAH",1,1,1,0)
 This patch changes the way KIDS secures a Packman Message. The prompt:
"PKG",6,22,1,"PAH",1,1,2,0)
    'Enter the scramble hint:' 
"PKG",6,22,1,"PAH",1,1,3,0)
 has been removed.  A new prompt:
"PKG",6,22,1,"PAH",1,1,4,0)
    'Do you wish to secure this message? No//'
"PKG",6,22,1,"PAH",1,1,5,0)
 will be asked after you enter the text for a message. This correct the
"PKG",6,22,1,"PAH",1,1,6,0)
 problem that was identified by Nois CLE-0696-40353.
"PKG",6,22,1,"PAH",1,1,7,0)
 This patch is the same as Kernel patch XU*8*40. Both patches contain
"PKG",6,22,1,"PAH",1,1,8,0)
 the same MailMan and Kernel routines.
"PKG",6,22,1,"PAH",1,1,9,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,10,0)

"PKG",6,22,1,"PAH",1,1,11,0)
This patch should be installed during off-peak hours. Users can be on the
"PKG",6,22,1,"PAH",1,1,12,0)
system, but no user should be using KIDS during the install of this patch.
"PKG",6,22,1,"PAH",1,1,13,0)
===========================================================================
"PKG",6,22,1,"PAH",1,1,14,0)
  
"PKG",6,22,1,"PAH",1,1,15,0)
INSTALLATION:
"PKG",6,22,1,"PAH",1,1,16,0)
  1.  These routines are usually mapped on systems that allow mapping,
"PKG",6,22,1,"PAH",1,1,17,0)
      so you will need to disable mapping for the effected routines.
"PKG",6,22,1,"PAH",1,1,18,0)
  2.  Use the 'INSTALL/CHECK MESSAGE' option on the PackMan menu. This
"PKG",6,22,1,"PAH",1,1,19,0)
      option will load the KIDS package onto your system.
"PKG",6,22,1,"PAH",1,1,20,0)
  3.  The patch has now been loaded into a Transport global on your
"PKG",6,22,1,"PAH",1,1,21,0)
      system. You now need to use KIDS to install the Transport global.
"PKG",6,22,1,"PAH",1,1,22,0)
  4.  On the KIDS menu, under the 'Installation' menu, use the following
"PKG",6,22,1,"PAH",1,1,23,0)
      options:
"PKG",6,22,1,"PAH",1,1,24,0)
         Print Transport Global
"PKG",6,22,1,"PAH",1,1,25,0)
         Compare Transport Global to Current System
"PKG",6,22,1,"PAH",1,1,26,0)
         Verify Checksums in Transport Global
"PKG",6,22,1,"PAH",1,1,27,0)
         Backup a Transport Global
"PKG",6,22,1,"PAH",1,1,28,0)
         Install Package(s)
"PKG",6,22,1,"PAH",1,1,29,0)
  5.  MSM Sites - Answer YES to the question 'Want to MOVE routines to
"PKG",6,22,1,"PAH",1,1,30,0)
      other CPUs?'. Enter the names of your Compute and Print server(s).
"PKG",6,22,1,"PAH",1,1,31,0)
  6.  AXP Sites, after patch has installed, rebuild your map set.
"PKG",6,22,1,"PAH",1,1,32,0)
 ===========================================================================
"PKG",6,22,1,"PAH",1,1,33,0)
  
"PKG",6,22,1,"PAH",1,1,34,0)
 ROUTINES:
"PKG",6,22,1,"PAH",1,1,35,0)
   The second line of the routine now looks like:
"PKG",6,22,1,"PAH",1,1,36,0)
       ;;7.1;MailMan;**33**;Jun 02, 1994
"PKG",6,22,1,"PAH",1,1,37,0)
 
"PKG",6,22,1,"PAH",1,1,38,0)
 Name           Checksum        Patch List
"PKG",6,22,1,"PAH",1,1,39,0)
 -----------------------------------------------------------
"PKG",6,22,1,"PAH",1,1,40,0)
 XMASEC         4454626         33
"PKG",6,22,1,"PAH",1,1,41,0)
 XMD            4879878         33
"PKG",6,22,1,"PAH",1,1,42,0)

"PKG",6,22,1,"PAH",1,1,43,0)
       ;;8.0;KERNEL;**[patch list]**;Jul 10, 1995
"PKG",6,22,1,"PAH",1,1,44,0)

"PKG",6,22,1,"PAH",1,1,45,0)
 XPDTP          2358145         21,40
"PKG",6,22,1,"PAH",1,1,46,0)
 ============================================================================
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","XMASEC")
0^1^B8241992
"RTN","XMASEC",1,0)
XMASEC ;(WASH ISC)/GM-SECURE PACKMAN MESSAGE ;07/18/96  13:17
"RTN","XMASEC",2,0)
 ;;7.1;MailMan;**33**;Jun 02, 1994
"RTN","XMASEC",3,0)
 D INIT
"RTN","XMASEC",4,0)
YN W !,"Do you wish to secure this message" S %=2 D YN^DICN
"RTN","XMASEC",5,0)
 I %<0 S Y=-1 G Q
"RTN","XMASEC",6,0)
 G Q:%=2 I %=0 S X="XM-SECURE-MESSAGE",XMHLP="HELP" D HLP G YN
"RTN","XMASEC",7,0)
 D HINT
"RTN","XMASEC",8,0)
EN ;
"RTN","XMASEC",9,0)
 I '$D(XMKEY) G C1:$D(DIFROM) Q
"RTN","XMASEC",10,0)
 S DIE="^XMB(3.9,",DA=XMZ,DR="1.8///"_XMHINT_" " D ^DIE
"RTN","XMASEC",11,0)
 W !!,"Securing the message, now.  This may take a while !!!",!
"RTN","XMASEC",12,0)
 D SKEY^XME S ^XMB(3.9,XMZ,"K")=1_XMKEY,X="$SEC^3" D ENC
"RTN","XMASEC",13,0)
 S X=$O(^XMB(3.9,XMZ,2,.999)),X=^(X,0),%=$P(X,"on",2),X=$P(X,"on")_"at"_$P(%,"at",2)_" on"_$P(%,"at"),$P(X,U,2)=Y,^(0)=X,%=0,%2=0
"RTN","XMASEC",14,0)
C S %=$O(^XMB(3.9,XMZ,2,%)) G C1:%=""
"RTN","XMASEC",15,0)
 G C:'$D(^(%,0)) S X=^(0) G C0:$E(X)="$"
"RTN","XMASEC",16,0)
 S %0=0 F %1=1:1:$L(X) S %0=$A(X,%1)*%1+%0
"RTN","XMASEC",17,0)
 S %2=%2+%0+$L(X)
"RTN","XMASEC",18,0)
C0 G C:$E(X)'="$"
"RTN","XMASEC",19,0)
 I $E(X,1,4)="$ROU" W:$X>70 ! W $J($P(X," ",2),10) I $P(X," ",2)?.AN1"NTEG" D INTEG G C
"RTN","XMASEC",20,0)
 I $E(X,1,4)'="$END" S %2=0,$P(^XMB(3.9,XMZ,2,%,0)," ",2)=$S($E(X,1,4)'="$KID":U,1:"")_$P(X," ",2) G C
"RTN","XMASEC",21,0)
 S X="$SEC"_U_(%2+XMRW) D ENC S $P(^XMB(3.9,XMZ,2,%,0),U,2)=Y
"RTN","XMASEC",22,0)
 G C
"RTN","XMASEC",23,0)
C1 S Y=^XMB(3.9,XMZ,2,0),X=$P(Y,U,3)+1,$P(Y,U,3,4)=X_U_($P(Y,U,4)+1),^(0)=Y,^(X,0)="$END "_"MESSAGE",(X,Y)=1
"RTN","XMASEC",24,0)
Q S:Y<0 X=U
"RTN","XMASEC",25,0)
 K %,%0,%1,%2,XMHLP,XMKEY,XMHINT,XQH,XMRW,XMCL,XMSEC Q
"RTN","XMASEC",26,0)
QUES ;
"RTN","XMASEC",27,0)
 D INIT
"RTN","XMASEC",28,0)
HINT R !,"Enter the scramble hint: ",XMHINT:$S($D(DTIME):DTIME,1:300)
"RTN","XMASEC",29,0)
 I '$T S DTOUT=1,Y=-1 G Q
"RTN","XMASEC",30,0)
 I "^"[XMHINT S:XMHINT'=""&$D(DIFROM) DUOUT=1 S Y=-1 G Q
"RTN","XMASEC",31,0)
 I XMHINT["?" S X="XMS-TRANS-SCR-HINT",XMHLP="Q3^XME" D HLP G HINT
"RTN","XMASEC",32,0)
 I $L(XMHINT)>39 W !,"Must be less than 40 characters.",! G HINT
"RTN","XMASEC",33,0)
P X ^%ZOSF("EOFF") R !,"Enter scramble password: ",X:DTIME X ^%ZOSF("EON")
"RTN","XMASEC",34,0)
 I '$T S Y=-1 S:$D(DIFROM) DTOUT=1 Q
"RTN","XMASEC",35,0)
 I U[X S:X'=""&$D(DIFROM) DUOUT=1 S Y=-1 G Q
"RTN","XMASEC",36,0)
 I X="",'$D(DIFROM) S Y=-1 G Q
"RTN","XMASEC",37,0)
 I X["?" S X="XMS-TRANS-SCR-HINT",XMHLP="Q1^XME" D HLP G P
"RTN","XMASEC",38,0)
 I X?.E1L.E S XMKEY=$$UP^XLFSTR(X)
"RTN","XMASEC",39,0)
 E  S XMKEY=X
"RTN","XMASEC",40,0)
 K %,XQH,XMHLP
"RTN","XMASEC",41,0)
 Q
"RTN","XMASEC",42,0)
INIT S Y=1,DIC="^DIC(9.2,",DIC(0)="M" Q
"RTN","XMASEC",43,0)
HLP D ^DIC S:+Y>0 XQH=X D @($S(+Y<0:XMHLP,1:"EN^XQH")) S Y=1 Q
"RTN","XMASEC",44,0)
HELP W !!,"If you answer yes, this message will be secured to insure that"
"RTN","XMASEC",45,0)
 W !,"what you send is what is actually received." Q
"RTN","XMASEC",46,0)
ENC I '$D(XMSEC) D ENT^XME1
"RTN","XMASEC",47,0)
 S Y="" F %0=1:1:$L(X) S Y=Y_$C($F(XMSEC(%0#XMCL+1),$E(X,%0))+30)
"RTN","XMASEC",48,0)
 Q
"RTN","XMASEC",49,0)
INTEG S $P(^XMB(3.9,XMZ,2,%,0)," ",2)=U_$P(X," ",2)
"RTN","XMASEC",50,0)
I S %=$O(^XMB(3.9,XMZ,2,%)) Q:%=""  S X=^(%,0) Q:"$END"[$E(X_" ",1,4)
"RTN","XMASEC",51,0)
 I X?.UN1" ;;".N S X=$P(X,";",3)+XMRW D ENC S $P(^XMB(3.9,XMZ,2,%,0),";",3)=Y
"RTN","XMASEC",52,0)
 G I
"RTN","XMD")
0^2^B11636233
"RTN","XMD",1,0)
XMD ;(WASH ISC)/THM/CAP-ENTRY POINTS FOR MESSAGE SENDING ;07/18/96  13:18
"RTN","XMD",2,0)
 ;;7.1;MailMan;**33**;Jun 02, 1994
"RTN","XMD",3,0)
 ;XMDF=FLAG that programmer interface is in use.  Set & killed here only.
"RTN","XMD",4,0)
 ;     Therefore do not check for Security Keys on domains.
"RTN","XMD",5,0)
 ;XMSUB=HEADER
"RTN","XMD",6,0)
 ;XMTEXT=@LOCATION OF MESSAGE
"RTN","XMD",7,0)
 ;XMSTRIP=CHARACTERS THAT USER WANTS STRIPPED FROM TEXT OF MESSAGE
"RTN","XMD",8,0)
 ;XMDTEST=Testing Flag / in test mode if $G(XMDTEST)=1
"RTN","XMD",9,0)
 ;XMDUZ=SENDER #
"RTN","XMD",10,0)
 ;I $D(XMMG),'$D(XMY) XMMG WILL BE THE DEFAULT FOR THE FIRST SEND TO:
"RTN","XMD",11,0)
 ;XMY I '$D(XMY) RECIPIENTS WILL BE PROMPTED FOR
"RTN","XMD",12,0)
 ;
"RTN","XMD",13,0)
 S XMDR=0 G T
"RTN","XMD",14,0)
0 K XMDR I '$D(XMSUB) S XMDR=1,XMMG="Error = No subject !" Q
"RTN","XMD",15,0)
 I '$D(XMTEXT) S XMDR=1,XMMG="Error = No message text !" Q
"RTN","XMD",16,0)
 I $G(XMDTEST)=1,$L(XMSUB)<3!($L(XMSUB)>65) S XMDR=1,XMMG="Error = Message subject too long or too short" Q
"RTN","XMD",17,0)
 I $G(XMDTEST)=1 S I=$O(@(XMTEXT_"0)")) I 'I S XMDR=1,XMMG="Error = No message text" Q
"RTN","XMD",18,0)
 I '$D(DIFROM) S XMDF=1,XMN=0
"RTN","XMD",19,0)
 S:'$D(XMDUZ) XMDUZ=DUZ D QQ
"RTN","XMD",20,0)
 S XMSUB=$$ENCODEUP^XMCU1(XMSUB)
"RTN","XMD",21,0)
XMZ D GET^XMA2 G OK:XMZ>0 I $D(ZTQUEUED) H 1 G XMZ
"RTN","XMD",22,0)
 W !!,"Waiting for access to the Message File",*7,! F %=1:1:10 H 1 W "."
"RTN","XMD",23,0)
 G XMZ
"RTN","XMD",24,0)
OK S XMQF=""
"RTN","XMD",25,0)
 ;
"RTN","XMD",26,0)
 ;Add BLOBS to message
"RTN","XMD",27,0)
 I $D(XMYBLOB)>9 S X=$$MULTI^XMBBLOB(XMZ) I X D KILL^XMA3 K XMZ G Q
"RTN","XMD",28,0)
 ;
"RTN","XMD",29,0)
EN1 S X=0
"RTN","XMD",30,0)
 I $D(XMROU)>9,'$O(^XMB(3.9,XMZ,2,0)) D NEW^XMP S X=1
"RTN","XMD",31,0)
EN2 S I=0,Y=XMTEXT_"0)" I '$D(XMSTRIP) S XMSTRIP=""
"RTN","XMD",32,0)
E0 S I=$O(@Y) G EA:'I S Y=XMTEXT_I_",0)"
"RTN","XMD",33,0)
 I '$D(@Y) S Y=XMTEXT_I_")" G EQ:'$D(@Y)
"RTN","XMD",34,0)
 S Y=@Y I Y?.E1C.E F J=1:1:$L(Y) I $E(Y,J)?1C S Y=$E(Y,1,J-1)_$E(Y,J+1,$L(Y)),J=J-1 Q:Y'?.E1C.E
"RTN","XMD",35,0)
 I $D(XMSTRIP) S %=XMSTRIP F  Q:'$L(%)  S A=$E(%),%=$E(%,2,99) I $L(A) S Y=$TR(Y,A,"")
"RTN","XMD",36,0)
 S X=X+1,^XMB(3.9,XMZ,2,X,0)=Y
"RTN","XMD",37,0)
EQ S Y=XMTEXT_I_")" G E0
"RTN","XMD",38,0)
EA S ^XMB(3.9,XMZ,2,0)="^3.92A^"_X_U_X,XCNP=X K XMSTRIP
"RTN","XMD",39,0)
 I $D(DIFROM)!$D(XMDSTOP) Q
"RTN","XMD",40,0)
 I $D(XMROU)>9 D XMROU^XMPH,^XMASEC
"RTN","XMD",41,0)
 K XMTEXT
"RTN","XMD",42,0)
EN3 ;called from XPDTP
"RTN","XMD",43,0)
 I $S($D(XMY)'<9:0,$D(^TMP("XMY",$J))'<9:0,1:1) D DESXM^XMA21 G QUIT:$S($D(XMY)'<9:0,$D(^TMP("XMY",$J))'<9:0,1:1)
"RTN","XMD",44,0)
 D REDO^XMA21,ENT1^XMAD1 G QUIT
"RTN","XMD",45,0)
EN ;ENTRY POINT FOR FILEGRAM PROCESS
"RTN","XMD",46,0)
 S XMFG=1 D SEND^XMA2 K XMFG Q
"RTN","XMD",47,0)
 ;
"RTN","XMD",48,0)
ENT ;ENTRY FOR OUTSIDE USERS
"RTN","XMD",49,0)
 I '$D(DUZ) W "  User ID needed (DUZ) !!" Q
"RTN","XMD",50,0)
 D EN^XM,SEND^XMA2
"RTN","XMD",51,0)
QUIT K XMDF,XMQF,XMN,%,%H,%I,A,C,ER,I,K,X,X1,X2,Y S Y=-1
"RTN","XMD",52,0)
 I $D(XMZ),XMZ>0,$D(^XMB(3.9,XMZ)) S Y=XMZ,Y(0)=^(XMZ,0)
"RTN","XMD",53,0)
 N XMKS,XMKN D ^XMAK S XMZ=Y G QQ
"RTN","XMD",54,0)
INIT ;FROM DIFROM
"RTN","XMD",55,0)
 D XMZ^XMA2 Q:XMZ<1  S $P(^XMB(3.9,XMZ,0),U,7)="X" D NEW^XMP Q
"RTN","XMD",56,0)
ENT1 ;FORWARD (NEED XMY, DUZ or XMDUZ,XMDUN,XMZ)
"RTN","XMD",57,0)
 N XMCHAN S XMCHAN=1,XMDF=1,XMQF=1
"RTN","XMD",58,0)
 D QQ,XMR,REDO^XMA21,D2X^XMA2 K XMDF G Q
"RTN","XMD",59,0)
ENT2 ;FORWARD MESSAGE / ASK RCPTS
"RTN","XMD",60,0)
 D QQ,XMR,DESXM^XMA21,REDO^XMA21,D2X^XMA2:$S($L($O(XMY(0))):1,$L($O(^TMP("XMY",$J,0))):1,1:0)
"RTN","XMD",61,0)
 G Q
"RTN","XMD",62,0)
 ;Get Message Zero Node
"RTN","XMD",63,0)
XMR S XMR=^XMB(3.9,XMZ,0) I '$D(XMDUZ) S XMDUZ=DUZ
"RTN","XMD",64,0)
 I $S('$D(XMDUN):1,$L(XMDUN)<3:1,$L(XMDUN)>30:1,XMDUN?1.N:1,1:0) S XMDUN=$P(^VA(200,$S(XMDUZ:XMDUZ,DUZ:DUZ,1:.5),0),U)
"RTN","XMD",65,0)
 Q
"RTN","XMD",66,0)
Q K Y,%,%0,%1,I,J,K,X1,X2,X3,X9
"RTN","XMD",67,0)
 K XMDUZ,XMF0,XMQ,XMANS,XMLOC,XMA0,XMDUN,XMN,XMR,XMY,XMY0,XMYBLOB
"RTN","XMD",68,0)
 I '$G(XMDR) K XMMG,XMDR
"RTN","XMD",69,0)
QQ K ^TMP("XMY",$J),^TMP("XMY0",$J)
"RTN","XMD",70,0)
 Q
"RTN","XMD",71,0)
ENX ;FROM MAILMAN
"RTN","XMD",72,0)
 S %=XMDUZ N XMDUZ,XMK S XMDUZ=% D XMD K % Q
"RTN","XMD",73,0)
 ;Binary Large OBjectss
"RTN","XMD",74,0)
ENL ;Add line(s)
"RTN","XMD",75,0)
 S XMDR="L" G T
"RTN","XMD",76,0)
L N XMDSTOP S X=$P($G(^XMB(3.9,XMZ,2,0)),U,3),XMDSTOP=1
"RTN","XMD",77,0)
 G EN2
"RTN","XMD",78,0)
T ;Save Text
"RTN","XMD",79,0)
 G TQ:$E(XMTEXT,2)'="("!'$D(XMTEXT)
"RTN","XMD",80,0)
 S %X=XMTEXT,(%Y,XMTEXT)="XMTEXT(" D %XY^%RCR
"RTN","XMD",81,0)
TQ N %,A,B,C,D,DA,DIC,DIE,DR,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,V,W,X,Y,Z
"RTN","XMD",82,0)
 G @XMDR
"RTN","XPDTP")
0^3^B3174483
"RTN","XPDTP",1,0)
XPDTP ;SFISC/RSD - Transport using a Packman Message ;08/23/96  11:01
"RTN","XPDTP",2,0)
 ;;8.0;KERNEL;**21,40**;Jul 05, 1995
"RTN","XPDTP",3,0)
 N DIFROM,DIR,DIRUT,DWPK,DWLW,DIC,I,J,XCN,XCNP,XMDISPI,XMDUN,XMDUZ,XMKEY,XMSCR,XMSUB,XMY,XMZ,X,Y,%
"RTN","XPDTP",4,0)
 S DIFROM=1,DIR(0)="F^3:65",DIR("A")="Subject",DIR("?")="Enter the subject for this Packman Message"
"RTN","XPDTP",5,0)
 D ^DIR Q:$D(DIRUT)
"RTN","XPDTP",6,0)
 S XMSUB=Y,XMDUZ=+DUZ
"RTN","XPDTP",7,0)
 K ^TMP("XMP",$J)
"RTN","XPDTP",8,0)
 W !,"Please enter description of Packman Message",!
"RTN","XPDTP",9,0)
 S DWPK=1,DWLW=75,DIC="^TMP(""XMP"",$J," D EN^DIWE
"RTN","XPDTP",10,0)
 D KIDS^XMP
"RTN","XPDTP",11,0)
 S XCNP=XCNP+1,^XMB(3.9,XMZ,2,XCNP,0)="$KID "_XPDNM,XCNP=XCNP+1
"RTN","XPDTP",12,0)
 ;for multiple packages, this would be a for loop
"RTN","XPDTP",13,0)
 D GS K ^XTMP("XPDT",XPDA)
"RTN","XPDTP",14,0)
 S $P(^XMB(3.9,XMZ,2,0),U,3,4)=XCNP_U_XCNP
"RTN","XPDTP",15,0)
 ;secure message & then send
"RTN","XPDTP",16,0)
 D ^XMASEC Q:$D(DTOUT)!$D(DUOUT)  D EN3^XMD
"RTN","XPDTP",17,0)
 K ^TMP("XMP",$J)
"RTN","XPDTP",18,0)
 Q
"RTN","XPDTP",19,0)
GS N GR,GCK,GL
"RTN","XPDTP",20,0)
 S GCK="^XTMP(""XPDT"","_XPDA,GR=GCK_")",GCK=GCK_",",GL=$L(GCK)
"RTN","XPDTP",21,0)
 ;INSTALL NAME line will mark the begining of global for all lines until
"RTN","XPDTP",22,0)
 ;the next INSTALL NAME
"RTN","XPDTP",23,0)
 S ^XMB(3.9,XMZ,2,XCNP,0)="**INSTALL NAME**",XCNP=XCNP+1,^XMB(3.9,XMZ,2,XCNP,0)=XPDNM,XCNP=XCNP+1
"RTN","XPDTP",24,0)
 F  S GR=$Q(@GR) Q:GR=""!($E(GR,1,GL)'=GCK)  S ^XMB(3.9,XMZ,2,XCNP,0)=$P(GR,GCK,2),XCNP=XCNP+1,^XMB(3.9,XMZ,2,XCNP,0)=@GR,XCNP=XCNP+1
"RTN","XPDTP",25,0)
**END**
**END**
