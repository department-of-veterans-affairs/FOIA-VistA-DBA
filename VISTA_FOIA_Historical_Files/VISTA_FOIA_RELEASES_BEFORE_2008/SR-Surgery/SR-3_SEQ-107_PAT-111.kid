Released SR*3*111 SEQ #107
Extracted from mail message
**KIDS**:SR*3.0*111^

**INSTALL NAME**
SR*3.0*111
"BLD",3843,0)
SR*3.0*111^SURGERY^0^3021018^y
"BLD",3843,1,0)
^^22^22^3021004^
"BLD",3843,1,1,0)
This patch contains modifications to the Surgery package to include new
"BLD",3843,1,2,0)
Ethnicity and multiple Race fields in four Surgery options as listed 
"BLD",3843,1,3,0)
below. The new fields comply with the new Race and Ethnicity Standards as
"BLD",3843,1,4,0)
set forth by the Office of Management and Budget.
"BLD",3843,1,5,0)
 
"BLD",3843,1,6,0)
1.  Tissue Examination Report [SROTRPT].  Ethnicity and multiple Races 
"BLD",3843,1,7,0)
    appear in the report footer.
"BLD",3843,1,8,0)
 
"BLD",3843,1,9,0)
2.  Non-Cardiac Assessment Information (Enter/Edit) [SROA ENTER/EDIT].
"BLD",3843,1,10,0)
    Ethnicity and multiple Races display on the report.  These fields are 
"BLD",3843,1,11,0)
    not editable through the Surgery package options.
"BLD",3843,1,12,0)
 
"BLD",3843,1,13,0)
3.  Print a Surgery Risk Assessment [SROA PRINT ASSESSMENT].  Ethnicity 
"BLD",3843,1,14,0)
    and multiple races appear on the report.
"BLD",3843,1,15,0)
 
"BLD",3843,1,16,0)
4.  Queue Assessment Transmissions [SROA TRANSMIT ASSESSMENTS].
"BLD",3843,1,17,0)
        a.  Non-Cardiac Risk Assessment transmission.  Old Race 
"BLD",3843,1,18,0)
            information is retained on node 7.  New Ethnicity and multiple
"BLD",3843,1,19,0)
            Races are transmitted on node 13.
"BLD",3843,1,20,0)
        b.  Cardiac Risk Assessment transmission.  Old Race information is
"BLD",3843,1,21,0)
            retained on node 24.  New Ethnicity and multiple Races 
"BLD",3843,1,22,0)
            are transmitted on node 6.
"BLD",3843,4,0)
^9.64PA^^
"BLD",3843,"KRN",0)
^9.67PA^8989.52^19
"BLD",3843,"KRN",.4,0)
.4
"BLD",3843,"KRN",.401,0)
.401
"BLD",3843,"KRN",.402,0)
.402
"BLD",3843,"KRN",.403,0)
.403
"BLD",3843,"KRN",.5,0)
.5
"BLD",3843,"KRN",.84,0)
.84
"BLD",3843,"KRN",3.6,0)
3.6
"BLD",3843,"KRN",3.8,0)
3.8
"BLD",3843,"KRN",9.2,0)
9.2
"BLD",3843,"KRN",9.8,0)
9.8
"BLD",3843,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",3843,"KRN",9.8,"NM",1,0)
SROAPAS^^0^B26865516
"BLD",3843,"KRN",9.8,"NM",2,0)
SROAPM^^0^B37665691
"BLD",3843,"KRN",9.8,"NM",3,0)
SROATCM1^^0^B46493190
"BLD",3843,"KRN",9.8,"NM",4,0)
SROATM3^^0^B19136385
"BLD",3843,"KRN",9.8,"NM",5,0)
SROTRPT^^0^B8501059
"BLD",3843,"KRN",9.8,"NM","B","SROAPAS",1)

"BLD",3843,"KRN",9.8,"NM","B","SROAPM",2)

"BLD",3843,"KRN",9.8,"NM","B","SROATCM1",3)

"BLD",3843,"KRN",9.8,"NM","B","SROATM3",4)

"BLD",3843,"KRN",9.8,"NM","B","SROTRPT",5)

"BLD",3843,"KRN",19,0)
19
"BLD",3843,"KRN",19,"NM",0)
^9.68A^^
"BLD",3843,"KRN",19.1,0)
19.1
"BLD",3843,"KRN",101,0)
101
"BLD",3843,"KRN",409.61,0)
409.61
"BLD",3843,"KRN",771,0)
771
"BLD",3843,"KRN",870,0)
870
"BLD",3843,"KRN",8989.51,0)
8989.51
"BLD",3843,"KRN",8989.52,0)
8989.52
"BLD",3843,"KRN",8994,0)
8994
"BLD",3843,"KRN","B",.4,.4)

"BLD",3843,"KRN","B",.401,.401)

"BLD",3843,"KRN","B",.402,.402)

"BLD",3843,"KRN","B",.403,.403)

"BLD",3843,"KRN","B",.5,.5)

"BLD",3843,"KRN","B",.84,.84)

"BLD",3843,"KRN","B",3.6,3.6)

"BLD",3843,"KRN","B",3.8,3.8)

"BLD",3843,"KRN","B",9.2,9.2)

"BLD",3843,"KRN","B",9.8,9.8)

"BLD",3843,"KRN","B",19,19)

"BLD",3843,"KRN","B",19.1,19.1)

"BLD",3843,"KRN","B",101,101)

"BLD",3843,"KRN","B",409.61,409.61)

"BLD",3843,"KRN","B",771,771)

"BLD",3843,"KRN","B",870,870)

"BLD",3843,"KRN","B",8989.51,8989.51)

"BLD",3843,"KRN","B",8989.52,8989.52)

"BLD",3843,"KRN","B",8994,8994)

"BLD",3843,"QUES",0)
^9.62^^
"BLD",3843,"REQB",0)
^9.611^6^6
"BLD",3843,"REQB",1,0)
SR*3.0*81^2
"BLD",3843,"REQB",2,0)
SR*3.0*88^2
"BLD",3843,"REQB",3,0)
SR*3.0*97^2
"BLD",3843,"REQB",4,0)
SR*3.0*95^2
"BLD",3843,"REQB",5,0)
DG*5.3*415^2
"BLD",3843,"REQB",6,0)
SD*5.3*254^2
"BLD",3843,"REQB","B","DG*5.3*415",5)

"BLD",3843,"REQB","B","SD*5.3*254",6)

"BLD",3843,"REQB","B","SR*3.0*81",1)

"BLD",3843,"REQB","B","SR*3.0*88",2)

"BLD",3843,"REQB","B","SR*3.0*95",4)

"BLD",3843,"REQB","B","SR*3.0*97",3)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2930624^2930811
"PKG",167,22,1,"PAH",1,0)
111^3021018
"PKG",167,22,1,"PAH",1,1,0)
^^22^22^3021018
"PKG",167,22,1,"PAH",1,1,1,0)
This patch contains modifications to the Surgery package to include new
"PKG",167,22,1,"PAH",1,1,2,0)
Ethnicity and multiple Race fields in four Surgery options as listed 
"PKG",167,22,1,"PAH",1,1,3,0)
below. The new fields comply with the new Race and Ethnicity Standards as
"PKG",167,22,1,"PAH",1,1,4,0)
set forth by the Office of Management and Budget.
"PKG",167,22,1,"PAH",1,1,5,0)
 
"PKG",167,22,1,"PAH",1,1,6,0)
1.  Tissue Examination Report [SROTRPT].  Ethnicity and multiple Races 
"PKG",167,22,1,"PAH",1,1,7,0)
    appear in the report footer.
"PKG",167,22,1,"PAH",1,1,8,0)
 
"PKG",167,22,1,"PAH",1,1,9,0)
2.  Non-Cardiac Assessment Information (Enter/Edit) [SROA ENTER/EDIT].
"PKG",167,22,1,"PAH",1,1,10,0)
    Ethnicity and multiple Races display on the report.  These fields are 
"PKG",167,22,1,"PAH",1,1,11,0)
    not editable through the Surgery package options.
"PKG",167,22,1,"PAH",1,1,12,0)
 
"PKG",167,22,1,"PAH",1,1,13,0)
3.  Print a Surgery Risk Assessment [SROA PRINT ASSESSMENT].  Ethnicity 
"PKG",167,22,1,"PAH",1,1,14,0)
    and multiple races appear on the report.
"PKG",167,22,1,"PAH",1,1,15,0)
 
"PKG",167,22,1,"PAH",1,1,16,0)
4.  Queue Assessment Transmissions [SROA TRANSMIT ASSESSMENTS].
"PKG",167,22,1,"PAH",1,1,17,0)
        a.  Non-Cardiac Risk Assessment transmission.  Old Race 
"PKG",167,22,1,"PAH",1,1,18,0)
            information is retained on node 7.  New Ethnicity and multiple
"PKG",167,22,1,"PAH",1,1,19,0)
            Races are transmitted on node 13.
"PKG",167,22,1,"PAH",1,1,20,0)
        b.  Cardiac Risk Assessment transmission.  Old Race information is
"PKG",167,22,1,"PAH",1,1,21,0)
            retained on node 24.  New Ethnicity and multiple Races 
"PKG",167,22,1,"PAH",1,1,22,0)
            are transmitted on node 6.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","SROAPAS")
0^1^B26865516
"RTN","SROAPAS",1,0)
SROAPAS ;BIR/MAM - PRINT A COMPLETE ASSESSMENT ; [ 05/26/99  12:54 PM ]
"RTN","SROAPAS",2,0)
 ;;3.0; Surgery ;**38,47,81,88,111**;24 Jun 93
"RTN","SROAPAS",3,0)
 S SRSOUT=0,SRPG=0,SR("RA")=$G(^SRF(SRTN,"RA")),SRATYPE=$P(SR("RA"),"^",2) F I=200:1:208 S SRA(I)=$G(^SRF(SRTN,I))
"RTN","SROAPAS",4,0)
 S SRA("OP")=^SRF(SRTN,"OP"),SRA("CON")=$G(^SRF(SRTN,"CON"))
"RTN","SROAPAS",5,0)
 S SR(0)=^SRF(SRTN,0),DFN=$P(SR(0),"^"),SRSDATE=$P(SR(0),"^",9) D DEM^VADPT S SRANM=VADM(1)_"  "_VA("PID"),Z=$P(VADM(3),"^"),Y=$E(SRSDATE,1,7),AGE=$E(Y,1,3)-$E(Z,1,3)-($E(Y,4,7)<$E(Z,4,7))
"RTN","SROAPAS",6,0)
 I $P(SR("RA"),"^",2)="C" D ^SROAPCA G END
"RTN","SROAPAS",7,0)
 W:$E(IOST)'="P" @IOF D HDR G:SRSOUT END
"RTN","SROAPAS",8,0)
 W !,"Medical Center: "_SRSITE("SITE")
"RTN","SROAPAS",9,0)
 W !,"Age: ",?16,AGE S Y=SRSDATE D D^DIQ W ?40,"Operation Date: ",?59,$P(Y,"@")
"RTN","SROAPAS",10,0)
 S Y=$P($G(^SRF(SRTN,208)),"^",10),C=$P(^DD(130,417,0),"^",2) D Y^DIQ S X=$S(Y'="":Y,1:"NOT ENTERED")
"RTN","SROAPAS",11,0)
 ;
"RTN","SROAPAS",12,0)
 D DEM^VADPT
"RTN","SROAPAS",13,0)
 ;Find patient's ethnicity
"RTN","SROAPAS",14,0)
 S SROETH=""
"RTN","SROAPAS",15,0)
 I $G(VADM(11)) S SROETH=$P(VADM(11,1),U,2)
"RTN","SROAPAS",16,0)
 I '$G(VADM(11)) S SROETH="UNANSWERED"
"RTN","SROAPAS",17,0)
 ;
"RTN","SROAPAS",18,0)
 ;Find all race entries and place into a string with commas inbetween
"RTN","SROAPAS",19,0)
 S SRORC=0,C=1,SRORACE="",SROLINE="",N=1,SROL=""
"RTN","SROAPAS",20,0)
 F  S SRORC=$O(VADM(12,SRORC)) Q:SRORC=""  Q:C=11  D
"RTN","SROAPAS",21,0)
 .I $G(VADM(12,SRORC)) S SRORACE(C)=$P(VADM(12,SRORC),U,2)
"RTN","SROAPAS",22,0)
 .I SROLINE'="" S SROLINE=SROLINE_", "_SRORACE(C)
"RTN","SROAPAS",23,0)
 .I SROLINE="" S SROLINE=SRORACE(C)
"RTN","SROAPAS",24,0)
 .S C=C+1
"RTN","SROAPAS",25,0)
 ;
"RTN","SROAPAS",26,0)
 ;Find total length of 'race' string and wrap the text if necessary
"RTN","SROAPAS",27,0)
 I $L(SROLINE)=29!$L(SROLINE)<29 S SROL(N)=SROLINE,SRNUM1=2
"RTN","SROAPAS",28,0)
 I $L(SROLINE)>29 D WRAP
"RTN","SROAPAS",29,0)
 ;
"RTN","SROAPAS",30,0)
 W !,"Sex: ",?16,$P(VADM(5),"^",2),?40,"Ethnicity:",?51,SROETH
"RTN","SROAPAS",31,0)
 W !,?40,"Race:"
"RTN","SROAPAS",32,0)
 I $G(VADM(12)) F D=1:1:SRNUM1-1 D
"RTN","SROAPAS",33,0)
 .W:D=1 ?51,SROL(D)
"RTN","SROAPAS",34,0)
 .W:D'=1 !,?51,SROL(D)
"RTN","SROAPAS",35,0)
 I '$G(VADM(12)) W ?51,"UNANSWERED"
"RTN","SROAPAS",36,0)
 ;
"RTN","SROAPAS",37,0)
 K SROL,SROLINE,SRORC,SRORACE,SROLN,SROLN1,SROWRAP,SRNUM1
"RTN","SROAPAS",38,0)
 ;
"RTN","SROAPAS",39,0)
 S Y=$P($G(^SRF(SRTN,208)),"^",11),C=$P(^DD(130,413,0),"^",2) D Y^DIQ S X=$S(Y'="":Y,1:"NOT ENTERED") W !,"Transfer Status: ",X
"RTN","SROAPAS",40,0)
 F J=1,2,3 S Y=$P($G(^SRF(SRTN,208.1)),"^",J) D
"RTN","SROAPAS",41,0)
 .I J'=3 X:Y ^DD("DD") S Z=$P(Y,"@")_"  "_$E($P(Y,"@",2),1,5)
"RTN","SROAPAS",42,0)
 .I J=3 S C=$P(^DD(130,454,0),"^",2) D Y^DIQ S Z=Y
"RTN","SROAPAS",43,0)
 .W !,"Observation "_$S(J=1:"Admission Date:",J=2:"Discharge Date:",1:"Treating Specialty:"),?47,Z
"RTN","SROAPAS",44,0)
 F J=14:1:17 S Y=$P($G(^SRF(SRTN,208)),"^",J) X ^DD("DD") S SRPTMODT(J)=Y
"RTN","SROAPAS",45,0)
 S (X,Z)=SRPTMODT(14) S:X'="" Z=$P(X,"@")_"  "_$E($P(X,"@",2),1,5) W !,"Hospital Admission Date:",?47,Z
"RTN","SROAPAS",46,0)
 S (X,Z)=SRPTMODT(15) S:X'="" Z=$P(X,"@")_"  "_$E($P(X,"@",2),1,5) W !,"Hospital Discharge Date:",?47,Z
"RTN","SROAPAS",47,0)
 S (X,Z)=SRPTMODT(16) S:X'="" Z=$P(X,"@")_"  "_$E($P(X,"@",2),1,5) W !,"Admitted/Transferred to Surgical Service:",?47,Z
"RTN","SROAPAS",48,0)
 S (X,Z)=SRPTMODT(17) S:X'="" Z=$P(X,"@")_"  "_$E($P(X,"@",2),1,5) W !,"Discharged/Transferred to Chronic Care:",?47,Z
"RTN","SROAPAS",49,0)
 W !,"In/Out-Patient Status:",?47,$S($P($G(^SRF(SRTN,0)),"^",12)="I":"INPATIENT",$P($G(^SRF(SRTN,0)),"^",12)="O":"OUTPATIENT",1:"")
"RTN","SROAPAS",50,0)
 I $E(IOST)="P" W ! F MOE=1:1:80 W "-"
"RTN","SROAPAS",51,0)
 I $E(IOST)'="P" D PAGE I SRSOUT G END
"RTN","SROAPAS",52,0)
 D ^SROAPRT1 G:SRSOUT END I $Y+20>IOSL D PAGE I SRSOUT G END
"RTN","SROAPAS",53,0)
 D ^SROAPRT2 G:SRSOUT END I $E(IOST)'="P" D PAGE I SRSOUT G END
"RTN","SROAPAS",54,0)
 D OPTIMES^SROAPRT3 D PAGE I SRSOUT G END
"RTN","SROAPAS",55,0)
 D ^SROAPRT3 G:SRSOUT END I $Y+24>IOSL D PAGE I SRSOUT G END
"RTN","SROAPAS",56,0)
 D ^SROAPRT4 G:SRSOUT END I $Y+20>IOSL D PAGE I SRSOUT G END
"RTN","SROAPAS",57,0)
 D ^SROAPRT5 G:SRSOUT END I $Y+20>IOSL D PAGE I SRSOUT G END
"RTN","SROAPAS",58,0)
 D ^SROAPRT6
"RTN","SROAPAS",59,0)
END Q:$D(SRABATCH)  I 'SRSOUT,$E(IOST)'="P" W !!,"Press <RET> to continue  " R X:DTIME
"RTN","SROAPAS",60,0)
 W:$E(IOST)="P" @IOF I $D(ZTQUEUED) Q:$G(ZTSTOP)  S ZTREQ="@" Q
"RTN","SROAPAS",61,0)
 D ^%ZISC K SRTN W @IOF D ^SRSKILL
"RTN","SROAPAS",62,0)
 Q
"RTN","SROAPAS",63,0)
 ;
"RTN","SROAPAS",64,0)
WRAP ;Wrap multiple race entries so that wrapped line
"RTN","SROAPAS",65,0)
 ;does not break in the middle of a word
"RTN","SROAPAS",66,0)
 ;
"RTN","SROAPAS",67,0)
 S SROLNGTH=$L(SROLINE),E=29,SROWRAP="",SROLN="",SROLN1="",SROL=""
"RTN","SROAPAS",68,0)
 F I=1:29:SROLNGTH S SROLN(I)=SROWRAP_$E(SROLINE,I,E) D
"RTN","SROAPAS",69,0)
 .F K=29:-1:1 I $E(SROLN(I),K)[" " D  Q    ;Break lines at space
"RTN","SROAPAS",70,0)
 ..S SROLN1(I)=$E(SROLN(I),1,K-1)
"RTN","SROAPAS",71,0)
 ..S SROWRAP=$E(SROLN(I),K+1,E)
"RTN","SROAPAS",72,0)
 .S E=E+29
"RTN","SROAPAS",73,0)
 I $L(SROLN1(I))+$L(SROWRAP)>28 S SROLN1(I+1)=SROWRAP   ;Last line
"RTN","SROAPAS",74,0)
 I $L(SROLN1(I))+$L(SROWRAP)'>28 S SROLN1(I)=SROLN1(I)_" "_SROWRAP
"RTN","SROAPAS",75,0)
 ;
"RTN","SROAPAS",76,0)
 ;Renumber the SROLN1 array to be in numeric order
"RTN","SROAPAS",77,0)
 S SRNUM=0,SRNUM1=1
"RTN","SROAPAS",78,0)
 F  S SRNUM=$O(SROLN1(SRNUM)) Q:SRNUM=""  D
"RTN","SROAPAS",79,0)
 .S SROL(SRNUM1)=SROLN1(SRNUM)
"RTN","SROAPAS",80,0)
 .S SRNUM1=SRNUM1+1
"RTN","SROAPAS",81,0)
 Q
"RTN","SROAPAS",82,0)
 ;
"RTN","SROAPAS",83,0)
LOOP ; break procedures
"RTN","SROAPAS",84,0)
 S SROPS(M)="" F LOOP=1:1 S MM=$P(SROPER," "),MMM=$P(SROPER," ",2,200) Q:MMM=""  Q:$L(SROPS(M))+$L(MM)'<55  S SROPS(M)=SROPS(M)_MM_" ",SROPER=MMM
"RTN","SROAPAS",85,0)
 Q
"RTN","SROAPAS",86,0)
PAGE I $E(IOST)'="P" W !!,"Press <RET> to continue, or '^' to quit  " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SROAPAS",87,0)
 I X["?" W !!,"Enter <RET> to continue printing the remaining pages of this assessment, or",!,"'^' to exit this option." G PAGE
"RTN","SROAPAS",88,0)
 W @IOF
"RTN","SROAPAS",89,0)
HDR ; print heading
"RTN","SROAPAS",90,0)
 I $D(ZTQUEUED) D ^SROSTOP I SRHALT S SRSOUT=1 Q
"RTN","SROAPAS",91,0)
 S SRPG=SRPG+1
"RTN","SROAPAS",92,0)
 I $Y'=0 W @IOF
"RTN","SROAPAS",93,0)
 I SRATYPE="C" W !,"VA CARDIAC RISK ASSESSMENT",?70,"PAGE "_SRPG
"RTN","SROAPAS",94,0)
 I SRATYPE="N" W !,"VA NON-CARDIAC RISK ASSESSMENT             Assessment: "_SRTN,?69,"PAGE "_SRPG
"RTN","SROAPAS",95,0)
 W !,"FOR "_SRANM S X=$P(SR("RA"),"^") W " ("_$S(X="I":"INCOMPLETE",X="C":"COMPLETED",X="T":"TRANSMITTED",1:"NO ASSESSMENT") I X="T" S Y=$P(SR("RA"),"^",4) W " "_$E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)
"RTN","SROAPAS",96,0)
 W ")",! F LINE=1:1:80 W "="
"RTN","SROAPAS",97,0)
 W !
"RTN","SROAPAS",98,0)
 Q
"RTN","SROAPAS",99,0)
CODE ; print CPT Code
"RTN","SROAPAS",100,0)
 S X=$P(^SRF(SRTN,13,SR,0),"^",2) I X W "  ("_$P($$CPT^ICPTCOD(X),"^",2)_")"
"RTN","SROAPAS",101,0)
 Q
"RTN","SROAPM")
0^2^B37665691
"RTN","SROAPM",1,0)
SROAPM ;B'HAM ISC/ADM - PATIENT DEMOGRAPHIC INFO ; [ 07/16/98   2:53 PM ]
"RTN","SROAPM",2,0)
 ;;3.0; Surgery ;**47,81,111**;24 Jun 93
"RTN","SROAPM",3,0)
 I '$D(SRTN) W !!,"A Surgery Risk Assessment must be selected prior to using this option.",!!,"Press <RET> to continue  " R X:DTIME G END
"RTN","SROAPM",4,0)
 S SRSOUT=0 D ^SROAUTL
"RTN","SROAPM",5,0)
START G:SRSOUT END D HDR^SROAUTL
"RTN","SROAPM",6,0)
 S DIR("A",1)="Enter/Edit Patient Demographic Information",DIR("A",2)=" ",DIR("A",3)="1. Capture Information from PIMS Records",DIR("A",4)="2. Enter, Edit, or Review Information",DIR("A",5)=" "
"RTN","SROAPM",7,0)
 S DIR("?",1)="Enter '1' if you want to capture patient movement information from PIMS",DIR("?",2)="records.  Enter '2' if you want to enter, edit, or review patient",DIR("?")="movement and other information on this screen."
"RTN","SROAPM",8,0)
 S DIR("A")="Select Number",DIR(0)="NO^1:2" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT)!'Y S SRSOUT=1 G END
"RTN","SROAPM",9,0)
 I Y=1 D PIMS G START
"RTN","SROAPM",10,0)
EDIT S SRR=0 D HDR^SROAUTL K DR S SRQ=0,(DR,SRDR)="413;452;453;454;418;419;420;421;247;.011"
"RTN","SROAPM",11,0)
 K DA,DIC,DIQ,SRY S DIC="^SRF(",DA=SRTN,DIQ="SRY",DIQ(0)="E",DR=SRDR D EN^DIQ1 K DA,DIC,DIQ,DR
"RTN","SROAPM",12,0)
 K SRX S SRX=0 F M=1:1 S I=$P(SRDR,";",M)  Q:'I  D
"RTN","SROAPM",13,0)
 .D TR,GET
"RTN","SROAPM",14,0)
 .S SRX=SRX+1,Y=$P(X,";;",2),SRFLD=$P(Y,"^"),(Z,SRX(SRX))=$P(Y,"^",2)_"^"_SRFLD,SREXT=SRY(130,SRTN,SRFLD,"E")
"RTN","SROAPM",15,0)
 .W !,$S($L(SRX)<2:" "_SRX,1:SRX)_". "_$P(Z,"^")_":" D EXT
"RTN","SROAPM",16,0)
 ;
"RTN","SROAPM",17,0)
 D DEM^VADPT
"RTN","SROAPM",18,0)
 ;Find patient's ethnicity and list it on the display
"RTN","SROAPM",19,0)
 W !,"11. Patient's Ethnicity:" D
"RTN","SROAPM",20,0)
 .I $G(VADM(11)) W ?40,$P(VADM(11,1),U,2)
"RTN","SROAPM",21,0)
 .I '$G(VADM(11)) W ?40,"UNANSWERED"
"RTN","SROAPM",22,0)
 ;
"RTN","SROAPM",23,0)
 ;Find all race entries and place into a string with commas inbetween
"RTN","SROAPM",24,0)
 S SRORC=0,C=1,SRORACE="",SROLINE="",N=1,SROL=""
"RTN","SROAPM",25,0)
 F  S SRORC=$O(VADM(12,SRORC)) Q:SRORC=""  Q:C=11  D
"RTN","SROAPM",26,0)
 .I $G(VADM(12,SRORC)) S SRORACE(C)=$P(VADM(12,SRORC),U,2)
"RTN","SROAPM",27,0)
 .I SROLINE'="" S SROLINE=SROLINE_", "_SRORACE(C)
"RTN","SROAPM",28,0)
 .I SROLINE="" S SROLINE=SRORACE(C)
"RTN","SROAPM",29,0)
 .S C=C+1
"RTN","SROAPM",30,0)
 ;
"RTN","SROAPM",31,0)
 ;Find total length of 'race' string and wrap the text if necessary
"RTN","SROAPM",32,0)
 I $L(SROLINE)=40!$L(SROLINE)<40 S SROL(N)=SROLINE,SRNUM1=2
"RTN","SROAPM",33,0)
 I $L(SROLINE)>40 D WRAP
"RTN","SROAPM",34,0)
 ;
"RTN","SROAPM",35,0)
 W !,"12. Patient's Race:"
"RTN","SROAPM",36,0)
 I $G(VADM(12)) F D=1:1:SRNUM1-1 D
"RTN","SROAPM",37,0)
 .W:D=1 ?40,SROL(D)
"RTN","SROAPM",38,0)
 .W:D'=1 !,?40,SROL(D)
"RTN","SROAPM",39,0)
 ;
"RTN","SROAPM",40,0)
 I '$G(VADM(12)) W ?40,"UNANSWERED"
"RTN","SROAPM",41,0)
 ;
"RTN","SROAPM",42,0)
 K SROL,SROLINE,SRORC,SRORACE,SROLN,SROLN1,SROWRAP,SRNUM1
"RTN","SROAPM",43,0)
 ;
"RTN","SROAPM",44,0)
 W !! F K=1:1:80 W "-"
"RTN","SROAPM",45,0)
 D SEL G:SRR=1 EDIT
"RTN","SROAPM",46,0)
 G START
"RTN","SROAPM",47,0)
 Q
"RTN","SROAPM",48,0)
 ;
"RTN","SROAPM",49,0)
WRAP ;Wrap multiple race entries so that wrapped line
"RTN","SROAPM",50,0)
 ;does not break in the middle of a word
"RTN","SROAPM",51,0)
 ;
"RTN","SROAPM",52,0)
 S SROLNGTH=$L(SROLINE),E=40,SROWRAP="",SROLN="",SROLN1="",SROL=""
"RTN","SROAPM",53,0)
 F I=1:40:SROLNGTH S SROLN(I)=SROWRAP_$E(SROLINE,I,E) D
"RTN","SROAPM",54,0)
 .F K=40:-1:1 I $E(SROLN(I),K)[" " D  Q    ;Break lines at space
"RTN","SROAPM",55,0)
 ..S SROLN1(I)=$E(SROLN(I),1,K-1)
"RTN","SROAPM",56,0)
 ..S SROWRAP=$E(SROLN(I),K+1,E)
"RTN","SROAPM",57,0)
 .S E=E+40
"RTN","SROAPM",58,0)
 I $L(SROLN1(I))+$L(SROWRAP)>39 S SROLN1(I+1)=SROWRAP   ;Last line 
"RTN","SROAPM",59,0)
 I $L(SROLN1(I))+$L(SROWRAP)'>39 S SROLN1(I)=SROLN1(I)_" "_SROWRAP
"RTN","SROAPM",60,0)
 ;
"RTN","SROAPM",61,0)
 ;Renumber the SROLN1 array to be in numeric order
"RTN","SROAPM",62,0)
 S SRNUM=0,SRNUM1=1
"RTN","SROAPM",63,0)
 F  S SRNUM=$O(SROLN1(SRNUM)) Q:SRNUM=""  D
"RTN","SROAPM",64,0)
 .S SROL(SRNUM1)=SROLN1(SRNUM)
"RTN","SROAPM",65,0)
 .S SRNUM1=SRNUM1+1
"RTN","SROAPM",66,0)
 Q
"RTN","SROAPM",67,0)
 ;
"RTN","SROAPM",68,0)
EXT I $L(SREXT)<40 W ?40,SREXT W:SRFLD=247 $S(SREXT="":"",SREXT=1:" Day",SREXT=0:" Days",SREXT>1:" Days",1:"") Q
"RTN","SROAPM",69,0)
 N I,J,X,Y S X=SREXT F  D  W:$L(X) ! I $L(X)<40!(X'[" ") W ?40,X Q
"RTN","SROAPM",70,0)
 .F I=0:1:38 S J=39-I,Y=$E(X,J) I Y=" " W ?40,$E(X,1,J-1) S X=$E(X,J+1,$L(X)) Q
"RTN","SROAPM",71,0)
 Q
"RTN","SROAPM",72,0)
SEL W !!,"Select number of item to edit: " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SROAPM",73,0)
 I (X=11)!(X=12) S SRR=1 W !!,"The Patient's Race and Ethnicity information cannot be updated through the" D  Q
"RTN","SROAPM",74,0)
 .W !,"Surgery package options."
"RTN","SROAPM",75,0)
 .W !!,"Press RETURN to continue " R X:DTIME
"RTN","SROAPM",76,0)
 Q:X=""  S:X="a" X="A" I '$D(SRFLG),'$D(SRX(X)),(X'?1.2N1":"1.2N),X'="A" D HELP S SRR=1 Q
"RTN","SROAPM",77,0)
 I X?1.2N1":"1.2N S Y=$P(X,":"),Z=$P(X,":",2) I Y<1!(Z>SRX)!(Y>Z) D HELP S SRR=1 Q
"RTN","SROAPM",78,0)
 I X="A" S X="1:"_SRX
"RTN","SROAPM",79,0)
 I X?1.2N1":"1.2N D RANGE S SRR=1 Q
"RTN","SROAPM",80,0)
 I $D(SRX(X)),+X=X S EMILY=X D ONE S SRR=1
"RTN","SROAPM",81,0)
 Q
"RTN","SROAPM",82,0)
PIMS ; get update from PIMS records
"RTN","SROAPM",83,0)
 W ! K DIR S DIR("A")="Are you sure you want to retrieve information from PIMS records ? ",DIR("B")="YES",DIR(0)="YOA" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT)!'Y Q
"RTN","SROAPM",84,0)
 W ! D WAIT^DICD D ^SROAPIMS
"RTN","SROAPM",85,0)
 Q
"RTN","SROAPM",86,0)
HELP W @IOF,!!!!,"Enter the number or range of numbers you want to edit.  Examples of proper",!,"responses are listed below.",!!,"NOTE: Items 11 and 12 cannot be updated through the surgery package options."
"RTN","SROAPM",87,0)
 W !!,"1. Enter 'A' to update items 1 through 10.",!!,"2. Enter a number (1-"_SRX_") to update an individual item.  (For example,",!,"   enter '1' to update "_$P(SRX(1),"^")_")"
"RTN","SROAPM",88,0)
 W !!,"3. Enter a range of numbers (1-"_SRX_") separated by a ':' to enter a range",!,"   of items.  (For example, enter '1:4' to update items 1, 2, 3 and 4.)",!
"RTN","SROAPM",89,0)
 I $D(SRFLG) W !,"4. Enter 'N' or 'NO' to enter negative response for all items.",!!,"5. Enter '@' to delete information from all items.",!
"RTN","SROAPM",90,0)
PRESS W ! K DIR S DIR("A")="Press the return key to continue or '^' to exit: ",DIR(0)="FOA" D ^DIR K DIR I $D(DTOUT)!$D(DUOUT) S SRSOUT=1
"RTN","SROAPM",91,0)
 Q
"RTN","SROAPM",92,0)
RANGE ; range of numbers
"RTN","SROAPM",93,0)
 S SHEMP=$P(X,":"),CURLEY=$P(X,":",2) F EMILY=SHEMP:1:CURLEY Q:SRSOUT  D ONE
"RTN","SROAPM",94,0)
 Q
"RTN","SROAPM",95,0)
ONE ; edit one item
"RTN","SROAPM",96,0)
 K DR,DA,DIE S DR=$P(SRX(EMILY),"^",2)_"T",DA=SRTN,DIE=130,SRDT=$P(SRX(EMILY),"^",3) S:SRDT DR=DR_";"_SRDT_"T" D ^DIE K DR,DA I $D(Y) S SRSOUT=1
"RTN","SROAPM",97,0)
 Q
"RTN","SROAPM",98,0)
TR S J=I,J=$TR(J,"1234567890.","ABCDEFGHIJP")
"RTN","SROAPM",99,0)
 Q
"RTN","SROAPM",100,0)
GET S X=$T(@J)
"RTN","SROAPM",101,0)
 Q
"RTN","SROAPM",102,0)
END W @IOF D ^SRSKILL
"RTN","SROAPM",103,0)
 Q
"RTN","SROAPM",104,0)
PJAA ;;.011^In/Out-Patient Status
"RTN","SROAPM",105,0)
BDG ;;247^Length of Postop Hospital Stay
"RTN","SROAPM",106,0)
DAC ;;413^Transfer Status
"RTN","SROAPM",107,0)
DAG ;;417^Patient's Race
"RTN","SROAPM",108,0)
DAH ;;418^Hospital Admission Date
"RTN","SROAPM",109,0)
DAI ;;419^Hospital Discharge Date
"RTN","SROAPM",110,0)
DBJ ;;420^Admit/Transfer to Surgical Svc.
"RTN","SROAPM",111,0)
DBA ;;421^Discharge/Transfer to Chronic Care
"RTN","SROAPM",112,0)
DEB ;;452^Observation Admission Date/Time
"RTN","SROAPM",113,0)
DEC ;;453^Observation Discharge Date/Time
"RTN","SROAPM",114,0)
DED ;;454^Observation Treating Specialty
"RTN","SROATCM1")
0^3^B46493190
"RTN","SROATCM1",1,0)
SROATCM1 ;BIR/MAM - STUFF TRANMISSION IN ^TMP ; [ 04/20/00  01:14 PM ]
"RTN","SROATCM1",2,0)
 ;;3.0; Surgery ;**38,71,79,90,88,93,95,111**;24 Jun 93
"RTN","SROATCM1",3,0)
 K SRA F I=0,.2,200,201,202,205:1:208,207.1 S SRA(I)=$G(^SRF(SRTN,I))
"RTN","SROATCM1",4,0)
 S DFN=$P(SRA(0),"^") N I D DEM^VADPT S SRANAME=VADM(1),SEX=$P(VADM(5),"^"),Z=$P(VADM(3),"^"),SRSDATE=$P(SRA(0),"^",9),Y=$E(SRSDATE,1,7),AGE=$E(Y,1,3)-$E(Z,1,3)-($E(Y,4,7)<$E(Z,4,7))
"RTN","SROATCM1",5,0)
 S SHEMP=">"_$J(SRASITE,3)_$J(SRTN,7)_" 1 "_DT_$J(AGE,3)_$J(SEX,1)_$J(SRSDATE,12,4)_VA("PID")
"RTN","SROATCM1",6,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 2 ",SRACNT=SRACNT+1
"RTN","SROATCM1",7,0)
 S SRHD=$P(SRA(206),"^")
"RTN","SROATCM1",8,0)
 I SRHD["C" S SRH="C",SRHD=$E(SRHD,1,$L(SRHD)-1)
"RTN","SROATCM1",9,0)
 E  S SRH=" "
"RTN","SROATCM1",10,0)
 S SRWD=$P(SRA(206),"^",2)
"RTN","SROATCM1",11,0)
 I SRWD["K" S SRW="K",SRWD=$E(SRWD,1,$L(SRWD)-1)
"RTN","SROATCM1",12,0)
 E  S SRW=" "
"RTN","SROATCM1",13,0)
 S SHEMP=SHEMP_$J(SRHD,3)_SRH_$J(SRWD,3)_SRW_$J($P(SRA(200),"^",2),2)_$J($P(SRA(200),"^",11),2)_$J($P(SRA(206),"^",5),3)_$J($P(SRA(206),"^",6),2)_$J($P(SRA(206),"^",7),2)
"RTN","SROATCM1",14,0)
 S SRCT=$P($G(^SRF(SRTN,201)),"^",4) S:SRCT["NS" SRCT=""
"RTN","SROATCM1",15,0)
 S SHEMP=SHEMP_$J($P(SRA(200),"^",3),2)_$J(SRCT,4)_$J($P(SRA(206),"^",10),2)_$J($P(SRA(206),"^",11),2)_$J($P(SRA(200),"^",8),2)_$J($P(SRA(206),"^",13),2)_$J($P(SRA(206),"^",14),2)_$J($P(SRA(206),"^",15),2)
"RTN","SROATCM1",16,0)
 S SHEMP=SHEMP_$J($P(SRA(206),"^",16),2)_$J($P(SRA(206),"^",17),2)_$J($P(SRA(206),"^",18),3)_$J($P(SRA(206),"^",19),3)_$J($P(SRA(206),"^",20),2)_$J($P(SRA(206),"^",21),2)_$J($P(SRA(206),"^",22),2)_$J($P(SRA(206),"^",23),2)
"RTN","SROATCM1",17,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 3 ",SRACNT=SRACNT+1
"RTN","SROATCM1",18,0)
 S SHEMP=SHEMP_$J($P(SRA(206),"^",24),2)_$J($P(SRA(206),"^",25),3)_$J($P(SRA(206),"^",26),3)_$J($P(SRA(206),"^",27),3)
"RTN","SROATCM1",19,0)
 ; Left Main (node 3 pos 26-28), LAD (node 3 pos 29-31), Right Coronary (node 3 pos 32-34) & Circumflex Stenosis (node 3 pos 35-37)
"RTN","SROATCM1",20,0)
 S SHEMP=SHEMP_$J($P(SRA(206),"^",28),3)_$J($P($G(SRA(206)),"^",33),3)_$J($P($G(SRA(206)),"^",34),3)_$J($P($G(SRA(206)),"^",35),3)
"RTN","SROATCM1",21,0)
 ; LV Cont Grade (node 3 pos 39-40) & Mitral Regurgitation(node 3 pos 41-42)
"RTN","SROATCM1",22,0)
 N SROLV S SROLV=$P(SRA(206),"^",30)
"RTN","SROATCM1",23,0)
 S SHEMP=SHEMP_$J($S(SROLV="IIIa":"3A",SROLV="IIIb":"3B",1:SROLV),3)_$J($P($G(SRA(206)),"^",9),2)
"RTN","SROATCM1",24,0)
 ; Estimate of Mortality and ASA Class are changed to not transmit "NS"
"RTN","SROATCM1",25,0)
 S SREMDATE=$P($G(SRA(206)),"^",32)
"RTN","SROATCM1",26,0)
 S SREMO=$P($G(^SRF(SRTN,206)),"^",31) S:SREMO["NS" SREMDATE=""
"RTN","SROATCM1",27,0)
 ; Estimate of Mortality (node 3 pos 43-45) & date (node 3 pos 46-57)
"RTN","SROATCM1",28,0)
 S SHEMP=SHEMP_$J(SREMO,3)
"RTN","SROATCM1",29,0)
 S SHEMP=SHEMP_$S(SREMDATE="":$J(SREMDATE,12),1:$J(SREMDATE,12,4))
"RTN","SROATCM1",30,0)
 S X="",Y=$P($G(^SRF(SRTN,1.1)),"^",3) S:Y X=$P($P($G(^SRO(132.8,Y,0)),"^"),"-") S X=$E(X) S:X["N" X=""
"RTN","SROATCM1",31,0)
 S SHEMP=SHEMP_$J(X,1)
"RTN","SROATCM1",32,0)
 ; Cardiac Est. of Surg. Priority(node 3 pos 59) & date(node 3 pos 60-71)
"RTN","SROATCM1",33,0)
 S SHEMP=SHEMP_$J($P($G(SRA(208)),"^",12),1)
"RTN","SROATCM1",34,0)
 S SREMSPDT=$P($G(SRA(208)),"^",13)
"RTN","SROATCM1",35,0)
 S SHEMP=SHEMP_$S(SREMSPDT="":$J(SREMSPDT,12),1:$J(SREMSPDT,12,4))
"RTN","SROATCM1",36,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 4 ",SRACNT=SRACNT+1
"RTN","SROATCM1",37,0)
 S SHEMP=SHEMP_$J($P(SRA(207),"^"),2)_$J($P(SRA(207),"^",2),2)_$J($P(SRA(207),"^",3),2)_$J($P(SRA(207),"^",4),2)_$J($P(SRA(207),"^",5),2)_$J($P(SRA(207),"^",6),2)_$J($P(SRA(207),"^",7),2)
"RTN","SROATCM1",38,0)
 S SHEMP=SHEMP_$J($P(SRA(207),"^",8),2)_$J($P(SRA(207),"^",9),2)_$J($P(SRA(207),"^",10),2)_$J($P(SRA(207),"^",12),2)_$J($P(SRA(207),"^",13),2)_$J($P(SRA(207),"^",14),2)_$J($P(SRA(207),"^",15),2)
"RTN","SROATCM1",39,0)
 S SHEMP=SHEMP_$J($P(SRA(207),"^",16),2)_$J($P(SRA(207),"^",17),2)_$J($P(SRA(207),"^",18),2)_$J($P(SRA(207),"^",19),2)
"RTN","SROATCM1",40,0)
 S SRDEATH=$P($G(SRA(208)),"^"),SRDDATE=$E($P($G(^DPT(DFN,.35)),"^"),1,7)
"RTN","SROATCM1",41,0)
 S SHEMP=SHEMP_$J(SRDEATH,2)_$J(SRDDATE,7)
"RTN","SROATCM1",42,0)
 S SHEMP=SHEMP_$P(SRA(207),"^",20)
"RTN","SROATCM1",43,0)
 ; Other procedures node 5
"RTN","SROATCM1",44,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 5 ",SRACNT=SRACNT+1
"RTN","SROATCM1",45,0)
 S SHEMP=SHEMP_$E($G(SRA(207.1)),1,65)
"RTN","SROATCM1",46,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 6 ",SRACNT=SRACNT+1
"RTN","SROATCM1",47,0)
 S SHEMP=SHEMP_$J($P(SRA(208),"^",2),2)_$J($P(SRA(208),"^",3),2)_$J($P(SRA(205),"^",17),2)_$J($P(SRA(208),"^",4),2)_$J($P(SRA(208),"^",5),2)_$J($P(SRA(205),"^",28),2)_$J($P(SRA(208),"^",6),2)
"RTN","SROATCM1",48,0)
 S SHEMP=SHEMP_$J($P(SRA(205),"^",13),2)_$J($P(SRA(208),"^",7),2)_$J($P(SRA(205),"^",22),2)_$J($P(SRA(205),"^",21),2)_$J($P(SRA(205),"^",26),2)
"RTN","SROATCM1",49,0)
 ;
"RTN","SROATCM1",50,0)
 ;Ethnicity contained in VADM(11)
"RTN","SROATCM1",51,0)
 S SROETCD="",SROPTF=""
"RTN","SROATCM1",52,0)
 S SROETCD=$P($G(VADM(11,1)),U,1)            ;Ethnicity code
"RTN","SROATCM1",53,0)
 S SROPTF=$$PTR2CODE^DGUTL4(SROETCD,2,4)     ;PTF Ethnicity code
"RTN","SROATCM1",54,0)
 S SHEMP=SHEMP_$J($G(SROPTF),1)   ;Ethnicity
"RTN","SROATCM1",55,0)
 ;
"RTN","SROATCM1",56,0)
 ;Multiple races contained in VADM(12)
"RTN","SROATCM1",57,0)
 S SRORCE=0,SRORAC="",SRORACE="",SRORCD=""
"RTN","SROATCM1",58,0)
 F  S SRORCE=$O(VADM(12,SRORCE)) Q:SRORCE=""  D
"RTN","SROATCM1",59,0)
 .S SRORAC=$P($G(VADM(12,SRORCE)),U,1)        ;Race code
"RTN","SROATCM1",60,0)
 .S SRORCD=$$PTR2CODE^DGUTL4(SRORAC,1,4)     ;PTF race code
"RTN","SROATCM1",61,0)
 .S SRORACE=SRORACE_$J(SRORCD,1)
"RTN","SROATCM1",62,0)
 ;
"RTN","SROATCM1",63,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP_SRORACE  ;Eth, race added
"RTN","SROATCM1",64,0)
 ;
"RTN","SROATCM1",65,0)
 S SHEMP=$E(SHEMP,1,11)_" 7 ",SRACNT=SRACNT+1
"RTN","SROATCM1",66,0)
 S SHEMP=SHEMP_$TR(SRANAME,","," ")
"RTN","SROATCM1",67,0)
 I $P($G(^SRF(SRTN,"RA")),"^",3)=1 S SHEMP=SHEMP_$J("***RE-TRANSMISSION",38)
"RTN","SROATCM1",68,0)
 ; zip code, employ status, hemoglobin, hemo date, serum albumin, albumin date, creatitine date, total ischemic time, min invasive, total cpb time, total pre,post ICU & step down unit LOS,
"RTN","SROATCM1",69,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 8 ",SRACNT=SRACNT+1
"RTN","SROATCM1",70,0)
 K VADM D ADD^VADPT S X=$S($P(VAPA(11),"^",2)'="":$P(VAPA(11),"^",2),1:VAPA(6))
"RTN","SROATCM1",71,0)
 S SHEMP=SHEMP_$J(X,10)_$J($P(SRA(208),"^",18),1)_$J($P(SRA(201),"^",20),7)_$J($P(SRA(202),"^",20),7)_$J($P(SRA(201),"^",8),4)_$J($P(SRA(202),"^",8),7)_$J($P(SRA(202),"^",4),7)_$J($P(SRA(206),"^",36),4)
"RTN","SROATCM1",72,0)
 S SHEMP=SHEMP_$J($P(SRA(207),"^",22),1)_$J($P(SRA(206),"^",37),4)_$J($P(SRA(207),"^",23),2)
"RTN","SROATCM1",73,0)
 ; cpt codes
"RTN","SROATCM1",74,0)
NODE9 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 9 ",SRACNT=SRACNT+1
"RTN","SROATCM1",75,0)
 S SRPMOD="",SR10SP="          ",CPT=$P(^SRF(SRTN,"OP"),"^",2) D
"RTN","SROATCM1",76,0)
 .I CPT S CPT=$P($$CPT^ICPTCOD(CPT),"^",2),SRCASE=SRTN D MOD^SROATM3 S SRPMOD=SRM
"RTN","SROATCM1",77,0)
 .S SHEMP=SHEMP_$J(CPT,5),SRPMOD=SRPMOD_SR10SP
"RTN","SROATCM1",78,0)
 K CPT F I=1:1:10 S (CPT(I),SRMOD(I))=""
"RTN","SROATCM1",79,0)
 S (OPS,CNT)=0 F  S OPS=$O(^SRF(SRTN,13,OPS)) Q:'OPS!(CNT=10)  S CNT=CNT+1,X=$P($G(^SRF(SRTN,13,OPS,2)),"^") I X S CPT(CNT)=$P($$CPT^ICPTCOD(X),"^",2) D OTH^SROATM3
"RTN","SROATCM1",80,0)
 S SHEMP=SHEMP_$J(CPT(1),5)_$J(CPT(2),5)_$J(CPT(3),5)_$J(CPT(4),5)_$J(CPT(5),5)_$J(CPT(6),5)_$J(CPT(7),5)_$J(CPT(8),5)_$J(CPT(9),5)_$J(CPT(10),5)
"RTN","SROATCM1",81,0)
 ; card cath date, admission date/time, hospital discharge date/time, anesthesia start & end date/times
"RTN","SROATCM1",82,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 10",SRACNT=SRACNT+1
"RTN","SROATCM1",83,0)
 I $P(SRA(207),"^",21)'="" D
"RTN","SROATCM1",84,0)
 .I $E($P(SRA(207),"^",21),8)="." Q
"RTN","SROATCM1",85,0)
 .E  S $P(SRA(207),"^",21)=$P(SRA(207),"^",21)_"."
"RTN","SROATCM1",86,0)
 S $P(SRA(207),"^",21)=$$LJ^XLFSTR($P(SRA(207),"^",21),12,0)
"RTN","SROATCM1",87,0)
 S SHEMP=SHEMP_$J($E($P(SRA(207),"^",21),1,12),12)
"RTN","SROATCM1",88,0)
 S (SRDATE,SRI)="" F SRI=14,15 S SRDATE=$E($P($G(SRA(208)),"^",SRI),1,12) S SRDATE=$$LJ^XLFSTR(SRDATE,12,0) S SHEMP=SHEMP_SRDATE
"RTN","SROATCM1",89,0)
 S (SRDATE,SRI)="" F SRI=1,4 S SRDATE=$P(SRA(.2),"^",SRI) S SRDATE=$$LJ^XLFSTR(SRDATE,12,0) S SHEMP=SHEMP_SRDATE
"RTN","SROATCM1",90,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 11",SRACNT=SRACNT+1
"RTN","SROATCM1",91,0)
 S (SRDATE,SRI)="" F SRI=10,12,2,3 S SRDATE=$P(SRA(.2),"^",SRI),SRDATE=$$LJ^XLFSTR(SRDATE,12,0) S SHEMP=SHEMP_SRDATE
"RTN","SROATCM1",92,0)
 ; preop risk factors comments
"RTN","SROATCM1",93,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 12",SRACNT=SRACNT+1 S SHEMP=SHEMP_$TR($E($G(^SRF(SRTN,206.1)),1,65),",","^")
"RTN","SROATCM1",94,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 13",SRACNT=SRACNT+1 S SHEMP=SHEMP_$TR($E($G(^SRF(SRTN,206.1)),66,130),",","^")
"RTN","SROATCM1",95,0)
 ; resource data comments
"RTN","SROATCM1",96,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 14",SRACNT=SRACNT+1 S SHEMP=SHEMP_$TR($E($G(^SRF(SRTN,206.2)),1,65),",","^")
"RTN","SROATCM1",97,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 15",SRACNT=SRACNT+1 S SHEMP=SHEMP_$TR($E($G(^SRF(SRTN,206.2)),66,130),",","^")
"RTN","SROATCM1",98,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SRACNT=SRACNT+1,SHEMP=$E(SHEMP,1,11)_" 16"_$E(SRPMOD,1,10) F I=1:1:5 S SHEMP=SHEMP_$E(SRMOD(I)_SR10SP,1,10)
"RTN","SROATCM1",99,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SRACNT=SRACNT+1,SHEMP=$E(SHEMP,1,11)_" 17" F I=6:1:10 S SHEMP=SHEMP_$E(SRMOD(I)_SR10SP,1,10)
"RTN","SROATCM1",100,0)
 S X=$$SITE^SROUTL0(SRTN),SRDIV=$S(X:$P(^SRO(133,X,0),"^"),1:""),SRDIV=$S(SRDIV:$$GET1^DIQ(4,SRDIV,99),1:SRASITE),SHEMP=SHEMP_$J(SRDIV,6)
"RTN","SROATCM1",101,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SRACNT=SRACNT+1
"RTN","SROATCM1",102,0)
 Q
"RTN","SROATM3")
0^4^B19136385
"RTN","SROATM3",1,0)
SROATM3 ;BIR/MAM - NON CARDIAC TRANSMISSION (CONT) ; [ 06/28/99  01:49 PM ]
"RTN","SROATM3",2,0)
 ;;3.0; Surgery ;**27,38,62,88,97,111**;24 Jun 93
"RTN","SROATM3",3,0)
 N SRCONMOD,SRMOD,SRPMOD,SR10SP
"RTN","SROATM3",4,0)
 S SHEMP=SHEMP_$J($P(SRA(201),"^",16),5)_$J($P(SRA(202),"^",16),7)_$J($P(SRA(201),"^",17),4)_$J($P(SRA(202),"^",17),7)_$J($P(SRA(203),"^"),5)_$J($P(SRA(204),"^"),7)_$J($P(SRA(203),"^",2),5)_$J($P(SRA(204),"^",2),7)
"RTN","SROATM3",5,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 10",SRACNT=SRACNT+1
"RTN","SROATM3",6,0)
 S SHEMP=SHEMP_$J($P(SRA(203),"^",3),3)_$J($P(SRA(204),"^",3),7)_$J($P(SRA(203),"^",4),3)_$J($P(SRA(204),"^",4),7)_$J($P(SRA(203),"^",6),4)_$J($P(SRA(204),"^",6),7)
"RTN","SROATM3",7,0)
 S SHEMP=SHEMP_$J($P(SRA(203),"^",7),6)_$J($P(SRA(204),"^",7),7)
"RTN","SROATM3",8,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 11",SRACNT=SRACNT+1
"RTN","SROATM3",9,0)
 S SHEMP=SHEMP_$J($P(SRA(203),"^",8),4)_$J($P(SRA(204),"^",8),7)_$J($P(SRA(203),"^",9),5)_$J($P(SRA(204),"^",9),7)_$J($P(SRA(203),"^",10),4)_$J($P(SRA(204),"^",10),7)
"RTN","SROATM3",10,0)
 S SHEMP=SHEMP_$J($P(SRA(203),"^",12),4)_$J($P(SRA(204),"^",12),7)_$J($P(SRA(203),"^",13),5)_$J($P(SRA(204),"^",13),7)_$J($P(SRA(203),"^",14),5)_$J($P(SRA(204),"^",14),7)
"RTN","SROATM3",11,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" 12",SRACNT=SRACNT+1
"RTN","SROATM3",12,0)
 S (SRPMOD,SRCONMOD)="",SR10SP="          " F I="OP","CON" S SRA(I)=$G(^SRF(SRTN,I))
"RTN","SROATM3",13,0)
 S CPT=$P(SRA("OP"),"^",2) D
"RTN","SROATM3",14,0)
 .I SRA("CON"),$P($G(^SRF(SRA("CON"),30)),"^")!($P($G(^SRF(SRA("CON"),31)),"^",8)) S SRA("CON")=""
"RTN","SROATM3",15,0)
 .I CPT S CPT=$P($$CPT^ICPTCOD(CPT),"^",2),SRCASE=SRTN D MOD S SRPMOD=SRM
"RTN","SROATM3",16,0)
 .S SHEMP=SHEMP_$J(CPT,5),SRPMOD=SRPMOD_SR10SP
"RTN","SROATM3",17,0)
 S CPT="",CON=$P(SRA("CON"),"^") S:CON CPT=$P(^SRF(CON,"OP"),"^",2) D
"RTN","SROATM3",18,0)
 .I CPT S CPT=$P($$CPT^ICPTCOD(CPT),"^",2),SRCASE=CON D MOD S SRCONMOD=SRM
"RTN","SROATM3",19,0)
 .S SHEMP=SHEMP_$J(CPT,5),SRCONMOD=SRCONMOD_SR10SP
"RTN","SROATM3",20,0)
 S CPT="",SHEMP=SHEMP_$J(CPT,5)
"RTN","SROATM3",21,0)
 K CPT F I=1:1:10 S (CPT(I),SRMOD(I))=""
"RTN","SROATM3",22,0)
 S (OPS,CNT)=0 F  S OPS=$O(^SRF(SRTN,13,OPS)) Q:'OPS!(CNT=10)  S CNT=CNT+1,X=$P($G(^SRF(SRTN,13,OPS,2)),"^") I X S CPT(CNT)=$P($$CPT^ICPTCOD(X),"^",2) D OTH
"RTN","SROATM3",23,0)
 S SHEMP=SHEMP_$J(CPT(1),5)_$J(CPT(2),5)_$J(CPT(3),5)_$J(CPT(4),5)_$J(CPT(5),5)_$J(CPT(6),5)_$J(CPT(7),5)_$J(CPT(8),5)_$J(CPT(9),5)_$J(CPT(10),5)
"RTN","SROATM3",24,0)
 S SHEMP=SHEMP_$E(SRPMOD,1,10)_$E(SRCONMOD,1,10) F I=1:1:10 S SHEMP=SHEMP_$E(SRMOD(I)_SR10SP,1,10)
"RTN","SROATM3",25,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SRACNT=SRACNT+1
"RTN","SROATM3",26,0)
 ;
"RTN","SROATM3",27,0)
 ;Ethnicity contained in VADM(11)
"RTN","SROATM3",28,0)
 S SHEMP=$E(SHEMP,1,11)_" 13"
"RTN","SROATM3",29,0)
 S SROETCD="",SROPTF=""
"RTN","SROATM3",30,0)
 S SROETCD=$P($G(VADM(11,1)),U,1)            ;Ethnicity code
"RTN","SROATM3",31,0)
 S SROPTF=$$PTR2CODE^DGUTL4(SROETCD,2,4)     ;PTF Ethnicity code
"RTN","SROATM3",32,0)
 S SHEMP=SHEMP_$J($G(SROPTF),1)   ;Ethnicity
"RTN","SROATM3",33,0)
 ;
"RTN","SROATM3",34,0)
 ;Multiple races contained in VADM(12)
"RTN","SROATM3",35,0)
 S SRORCE=0,SRORAC="",SRORACE="",SRORCD=""
"RTN","SROATM3",36,0)
 F  S SRORCE=$O(VADM(12,SRORCE)) Q:SRORCE=""  D
"RTN","SROATM3",37,0)
 .S SRORAC=$P($G(VADM(12,SRORCE)),U,1)       ;Race code
"RTN","SROATM3",38,0)
 .S SRORCD=$$PTR2CODE^DGUTL4(SRORAC,1,4)     ;PTF race code
"RTN","SROATM3",39,0)
 .S SRORACE=SRORACE_$J(SRORCD,1)
"RTN","SROATM3",40,0)
 ;
"RTN","SROATM3",41,0)
 S ^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP_SRORACE   ;Line 13
"RTN","SROATM3",42,0)
 S SRACNT=SRACNT+1
"RTN","SROATM3",43,0)
 ;
"RTN","SROATM3",44,0)
 S SHEMP=$E(SHEMP,1,11)_" A1"
"RTN","SROATM3",45,0)
 S SHEMP=SHEMP_SRANAME,^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" A2",SRACNT=SRACNT+1
"RTN","SROATM3",46,0)
 S SRA(0)=^SRF(SRTN,0),DFN=$P(SRA(0),"^") K SRA,VADM D ADD^VADPT
"RTN","SROATM3",47,0)
 S SHEMP=SHEMP_VAPA(1),^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" A3",SRACNT=SRACNT+1
"RTN","SROATM3",48,0)
 S SHEMP=SHEMP_VAPA(2),^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" A4",SRACNT=SRACNT+1
"RTN","SROATM3",49,0)
 S SHEMP=SHEMP_VAPA(3),^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" A5",SRACNT=SRACNT+1
"RTN","SROATM3",50,0)
 S SHEMP=SHEMP_VAPA(4),^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" A6",SRACNT=SRACNT+1
"RTN","SROATM3",51,0)
 S SHEMP=SHEMP_$P(VAPA(5),"^",2),^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" A7",SRACNT=SRACNT+1
"RTN","SROATM3",52,0)
 S SHEMP=SHEMP_VAPA(6),^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SHEMP=$E(SHEMP,1,11)_" A8",SRACNT=SRACNT+1
"RTN","SROATM3",53,0)
 S SHEMP=SHEMP_VAPA(8),^TMP("SRA",$J,SRAMNUM,SRACNT,0)=SHEMP,SRACNT=SRACNT+1
"RTN","SROATM3",54,0)
 Q
"RTN","SROATM3",55,0)
MOD ; get principal CPT modifiers
"RTN","SROATM3",56,0)
 S SRI=0,SRCNT=1,SRM="" F  S SRI=$O(^SRF(SRCASE,"OPMOD",SRI)) Q:'SRI  D  Q:SRCNT>5
"RTN","SROATM3",57,0)
 .S X=$P(^SRF(SRCASE,"OPMOD",SRI,0),"^"),Y=$P($$MOD^ICPTMOD(X,"I"),"^",2)
"RTN","SROATM3",58,0)
 .I Y S SRM=SRM_Y,SRCNT=SRCNT+1
"RTN","SROATM3",59,0)
 Q
"RTN","SROATM3",60,0)
OTH ; get other procedure CPT modifiers
"RTN","SROATM3",61,0)
 S SRI=0,SRCNT=1 F  S SRI=$O(^SRF(SRTN,13,OPS,"MOD",SRI)) Q:'SRI  D  Q:SRCNT>5
"RTN","SROATM3",62,0)
 .S X=$P(^SRF(SRTN,13,OPS,"MOD",SRI,0),"^"),Y=$P($$MOD^ICPTMOD(X,"I"),"^",2)
"RTN","SROATM3",63,0)
 .I Y S SRMOD(CNT)=SRMOD(CNT)_Y,SRCNT=SRCNT+1
"RTN","SROATM3",64,0)
 Q
"RTN","SROTRPT")
0^5^B8501059
"RTN","SROTRPT",1,0)
SROTRPT ;B'HAM ISC/MAM - TISSUE EXAM REPORT ; 16 JULY 1990  10:00
"RTN","SROTRPT",2,0)
 ;;3.0; Surgery ;**31,111**;24 Jun 93
"RTN","SROTRPT",3,0)
 S SRSOUT=0
"RTN","SROTRPT",4,0)
 I '$D(SRSITE) D ^SROVAR S SRSITE("KILL")=1
"RTN","SROTRPT",5,0)
 I '$D(SRTN) K SRNEWOP D ^SROPS I '$D(SRTN) S SRSOUT=1 G END
"RTN","SROTRPT",6,0)
 K %ZIS,IOP,POP,IO("Q") S %ZIS="Q" D ^%ZIS I POP S SRSOUT=1 G END
"RTN","SROTRPT",7,0)
 I $D(IO("Q")) K IO("Q") S ZTDESC="TISSUE EXAM REPORT",ZTRTN="RPT^SROTRPT",(ZTSAVE("SRSITE*"),ZTSAVE("SRTN"))="",ZTSAVE("SRT")="UL" D ^%ZTLOAD S SRSOUT=1 G END
"RTN","SROTRPT",8,0)
RPT ; entry when queued
"RTN","SROTRPT",9,0)
 S SRSOUT=0 I '$D(ZTQUEUED) S SRT=$S($E(IOST)="P":"UL",1:"Q")
"RTN","SROTRPT",10,0)
 D ^SROTRPT0,FOOT
"RTN","SROTRPT",11,0)
END I $E(IOST)'="P",'SRSOUT W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SROTRPT",12,0)
 W:$E(IOST)="P" @IOF I $D(ZTQUEUED) Q:$G(ZTSTOP)  S ZTREQ="@" Q
"RTN","SROTRPT",13,0)
 D ^%ZISC W @IOF D ^SRSKILL
"RTN","SROTRPT",14,0)
 Q
"RTN","SROTRPT",15,0)
FOOT ; print footer
"RTN","SROTRPT",16,0)
 ;
"RTN","SROTRPT",17,0)
 ;Find ethnicity entry
"RTN","SROTRPT",18,0)
 S SROETH=""
"RTN","SROTRPT",19,0)
 I $G(VADM(11,1)) S SROETH=$P(VADM(11,1),U,2)
"RTN","SROTRPT",20,0)
 I '$G(VADM(11,1)) S SROETH="UNANSWERED"
"RTN","SROTRPT",21,0)
 ;
"RTN","SROTRPT",22,0)
 ;Find all race entries and place into a string with commas inbetween
"RTN","SROTRPT",23,0)
 S SRORC=0,C=1,SRORACE="",SROLINE="",N=1,SROL=""
"RTN","SROTRPT",24,0)
 F  S SRORC=$O(VADM(12,SRORC)) Q:SRORC=""  Q:C=11  D
"RTN","SROTRPT",25,0)
 .I $G(VADM(12,SRORC)) S SRORACE(C)=$P(VADM(12,SRORC),U,2)
"RTN","SROTRPT",26,0)
 .I SROLINE'="" S SROLINE=SROLINE_", "_SRORACE(C)
"RTN","SROTRPT",27,0)
 .I SROLINE="" S SROLINE=SRORACE(C)
"RTN","SROTRPT",28,0)
 .S C=C+1
"RTN","SROTRPT",29,0)
 ;
"RTN","SROTRPT",30,0)
 ;Find total length of 'race' string and wrap the text if necessary
"RTN","SROTRPT",31,0)
 I $L(SROLINE)=72!$L(SROLINE)<72 S SROL(N)=SROLINE,SRNUM1=2
"RTN","SROTRPT",32,0)
 I $L(SROLINE)>72 D WRAP
"RTN","SROTRPT",33,0)
 ;
"RTN","SROTRPT",34,0)
 Q:SRSOUT  F X=1:1 Q:$Y>(IOSL-13)  W !
"RTN","SROTRPT",35,0)
 W !,?30,"(Continue on reverse side)",! F SRLINE=1:1:80 W "-"
"RTN","SROTRPT",36,0)
 W !,"PATHOLOGIST'S SIGNATURE",?58,"DATE: ",! F SRLINE=1:1:80 W "-"
"RTN","SROTRPT",37,0)
 W !,VADM(1),?30,"AGE: "_VADM(4),?40,"SEX: "_$P(VADM(5),"^",2),?58,"ID # "_VA("PID"),!,"ETHNICITY: "_SROETH
"RTN","SROTRPT",38,0)
 W ?58,"REGISTER NO. "
"RTN","SROTRPT",39,0)
 W !,"RACE: "
"RTN","SROTRPT",40,0)
 I $G(VADM(12)) F D=1:1:SRNUM1-1 D
"RTN","SROTRPT",41,0)
 .W:D=1 ?7,SROL(D)
"RTN","SROTRPT",42,0)
 .W:D'=1 !,?7,SROL(D)
"RTN","SROTRPT",43,0)
 I '$G(VADM(12)) W ?7,"UNANSWERED"
"RTN","SROTRPT",44,0)
 ;
"RTN","SROTRPT",45,0)
 K SROL,SROLINE,SRORC,SRORACE,SROLN,SROLN1,SROWRAP,SRNUM1
"RTN","SROTRPT",46,0)
 ;
"RTN","SROTRPT",47,0)
 W !,"WARD: "_SRWARD,?30,"ROOM-BED: "_SROOM
"RTN","SROTRPT",48,0)
 W ! F SRLINE=1:1:80 W "-"
"RTN","SROTRPT",49,0)
 W !,SRINST,?58,"REPLACEMENT FORM 515"
"RTN","SROTRPT",50,0)
 Q
"RTN","SROTRPT",51,0)
 ;
"RTN","SROTRPT",52,0)
WRAP ;Wrap multiple race entries so that wrapped line
"RTN","SROTRPT",53,0)
 ;does not break in the middle of a word
"RTN","SROTRPT",54,0)
 ;
"RTN","SROTRPT",55,0)
 S SROLNGTH=$L(SROLINE),E=72,SROWRAP="",SROLN="",SROLN1="",SROL=""
"RTN","SROTRPT",56,0)
 F I=1:72:SROLNGTH S SROLN(I)=SROWRAP_$E(SROLINE,I,E) D
"RTN","SROTRPT",57,0)
 .F K=72:-1:1 I $E(SROLN(I),K)[" " D  Q    ;Break lines at space
"RTN","SROTRPT",58,0)
 ..S SROLN1(I)=$E(SROLN(I),1,K-1)
"RTN","SROTRPT",59,0)
 ..S SROWRAP=$E(SROLN(I),K+1,E)
"RTN","SROTRPT",60,0)
 .S E=E+72
"RTN","SROTRPT",61,0)
 I $L(SROLN1(I))+$L(SROWRAP)>71 S SROLN1(I+1)=SROWRAP   ;Last line
"RTN","SROTRPT",62,0)
 I $L(SROLN1(I))+$L(SROWRAP)'>71 S SROLN1(I)=SROLN1(I)_" "_SROWRAP
"RTN","SROTRPT",63,0)
 ;
"RTN","SROTRPT",64,0)
 ;Renumber the SROLN1 array to be in numeric order
"RTN","SROTRPT",65,0)
 S SRNUM=0,SRNUM1=1
"RTN","SROTRPT",66,0)
 F  S SRNUM=$O(SROLN1(SRNUM)) Q:SRNUM=""  D
"RTN","SROTRPT",67,0)
 .S SROL(SRNUM1)=SROLN1(SRNUM)
"RTN","SROTRPT",68,0)
 .S SRNUM1=SRNUM1+1
"RTN","SROTRPT",69,0)
 Q
"VER")
8.0^22.0
**END**
**END**
