Released PRC*5.1*91 SEQ #81
Extracted from mail message
**KIDS**:PRC*5.1*91^

**INSTALL NAME**
PRC*5.1*91
"BLD",4938,0)
PRC*5.1*91^IFCAP^0^3051201^y
"BLD",4938,1,0)
^^3^3^3051201^
"BLD",4938,1,1,0)
This patch corrects a Null Subscript error that can occur when a user 
"BLD",4938,1,2,0)
processes multiple Purchase Order amendments without exiting the option 
"BLD",4938,1,3,0)
prior to each amendment.
"BLD",4938,4,0)
^9.64PA^^
"BLD",4938,"INID")

"BLD",4938,"KRN",0)
^9.67PA^8989.52^19
"BLD",4938,"KRN",.4,0)
.4
"BLD",4938,"KRN",.401,0)
.401
"BLD",4938,"KRN",.402,0)
.402
"BLD",4938,"KRN",.403,0)
.403
"BLD",4938,"KRN",.5,0)
.5
"BLD",4938,"KRN",.84,0)
.84
"BLD",4938,"KRN",3.6,0)
3.6
"BLD",4938,"KRN",3.8,0)
3.8
"BLD",4938,"KRN",9.2,0)
9.2
"BLD",4938,"KRN",9.8,0)
9.8
"BLD",4938,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",4938,"KRN",9.8,"NM",1,0)
PRCHAMYC^^0^B12214344
"BLD",4938,"KRN",9.8,"NM","B","PRCHAMYC",1)

"BLD",4938,"KRN",19,0)
19
"BLD",4938,"KRN",19,"NM",0)
^9.68A^^
"BLD",4938,"KRN",19.1,0)
19.1
"BLD",4938,"KRN",101,0)
101
"BLD",4938,"KRN",409.61,0)
409.61
"BLD",4938,"KRN",771,0)
771
"BLD",4938,"KRN",870,0)
870
"BLD",4938,"KRN",8989.51,0)
8989.51
"BLD",4938,"KRN",8989.52,0)
8989.52
"BLD",4938,"KRN",8994,0)
8994
"BLD",4938,"KRN","B",.4,.4)

"BLD",4938,"KRN","B",.401,.401)

"BLD",4938,"KRN","B",.402,.402)

"BLD",4938,"KRN","B",.403,.403)

"BLD",4938,"KRN","B",.5,.5)

"BLD",4938,"KRN","B",.84,.84)

"BLD",4938,"KRN","B",3.6,3.6)

"BLD",4938,"KRN","B",3.8,3.8)

"BLD",4938,"KRN","B",9.2,9.2)

"BLD",4938,"KRN","B",9.8,9.8)

"BLD",4938,"KRN","B",19,19)

"BLD",4938,"KRN","B",19.1,19.1)

"BLD",4938,"KRN","B",101,101)

"BLD",4938,"KRN","B",409.61,409.61)

"BLD",4938,"KRN","B",771,771)

"BLD",4938,"KRN","B",870,870)

"BLD",4938,"KRN","B",8989.51,8989.51)

"BLD",4938,"KRN","B",8989.52,8989.52)

"BLD",4938,"KRN","B",8994,8994)

"BLD",4938,"PRE")

"BLD",4938,"QUES",0)
^9.62^^
"BLD",4938,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1^3001012^3001019^68
"PKG",455,22,1,"PAH",1,0)
91^3051201
"PKG",455,22,1,"PAH",1,1,0)
^^3^3^3051201
"PKG",455,22,1,"PAH",1,1,1,0)
This patch corrects a Null Subscript error that can occur when a user 
"PKG",455,22,1,"PAH",1,1,2,0)
processes multiple Purchase Order amendments without exiting the option 
"PKG",455,22,1,"PAH",1,1,3,0)
prior to each amendment.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PRCHAMYC")
0^1^B12214344^B11941638
"RTN","PRCHAMYC",1,0)
PRCHAMYC ;WISC/DJM-UPDATING THE LINE ITEM DISCOUNTS ON THE AMENDED 442 RECORD ;2/17/95  11:00 AM
"RTN","PRCHAMYC",2,0)
V ;;5.1;IFCAP;**91**;Oct 20, 2000
"RTN","PRCHAMYC",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCHAMYC",4,0)
 ;GO THROUGH ALL LINE ITEMS AND CREATE 'PRCH("AM",PRCHCN)' ARRAY
"RTN","PRCHAMYC",5,0)
 ;PRCHCN CAN BE A 'CONTRACT NUMBER' OR '.OM'.
"RTN","PRCHAMYC",6,0)
 ;PRCH("AM",PRCHCN) HAS 3 "^" PARTS.
"RTN","PRCHAMYC",7,0)
 ;    PART 1 = NUMBER OF LINE ITEMS IN THIS ARRAY ELEMENT.
"RTN","PRCHAMYC",8,0)
 ;    PART 2 = TOTAL $AMOUNT OF ALL LINE ITEMS IN ARRAY ELEMENT.
"RTN","PRCHAMYC",9,0)
 ;    PART 3 = LISTING OF ALL LINE NUMBERS IN THIS ARRAY ELEMENT.
"RTN","PRCHAMYC",10,0)
 ;THE LISTING IS SAVED IN THE FORMAT NEEDED TO USE WITHIN A MUMPS
"RTN","PRCHAMYC",11,0)
 ;'FOR' COMMAND.  FOR EXAMPLE: 1:1:2,4,6,8:11,
"RTN","PRCHAMYC",12,0)
 ;
"RTN","PRCHAMYC",13,0)
 ;kill existing PRCH("AM") array data
"RTN","PRCHAMYC",14,0)
 K PRCH("AM")
"RTN","PRCHAMYC",15,0)
 ;LOOP THROUGH ALL LINE ITEM ENTRIES AND ADD/UPDATE THE 'PRCH("AM",PRCHCN)' ARRAY.
"RTN","PRCHAMYC",16,0)
 S (PRCH,PRCHEC)=0 F I=1:1 S PRCH=$O(^PRC(442,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D
"RTN","PRCHAMYC",17,0)
 .S PRCHAMX=$G(^PRC(442,PRCHPO,2,PRCH,2))
"RTN","PRCHAMYC",18,0)
 .S $P(PRCHAMX,U,6)="",^PRC(442,PRCHPO,2,PRCH,2)=PRCHAMX
"RTN","PRCHAMYC",19,0)
 .S PRCHCN=$P(PRCHAMX,U,2),PRCHAMX=$P(PRCHAMX,U),PRCHLI=I
"RTN","PRCHAMYC",20,0)
 .D CN:PRCHCN]"",OM:PRCHCN=""
"RTN","PRCHAMYC",21,0)
 .Q
"RTN","PRCHAMYC",22,0)
 S PRCHLCNT=I-1 S:$D(^PRC(442,PRCHPO,2,0)) $P(^(0),U,3,4)="1^"_PRCHLCNT
"RTN","PRCHAMYC",23,0)
 G UP
"RTN","PRCHAMYC",24,0)
 ;
"RTN","PRCHAMYC",25,0)
LI ;CREAT THE ENTRY FOR THE 3rd "^" PIECE OF PRCH("AM",PRCHCN) HERE.
"RTN","PRCHAMYC",26,0)
 S PRCHL0=$P(PRCH("AM",PRCHL3),U,3) Q:PRCHL0=""  F J=1:1 S PRCHL1=$E(PRCHL0,$L(PRCHL0)-J) Q:PRCHL1'=+PRCHL1
"RTN","PRCHAMYC",27,0)
 S PRCHL2=$E(PRCHL0,$L(PRCHL0)-J+1,$L(PRCHL0)-1),PRCHL2=PRCHL2+1 I PRCHL2'=PRCHLI S PRCHLI=PRCHL0_PRCHLI Q
"RTN","PRCHAMYC",28,0)
 I PRCHL1=":" S PRCHLI=$E(PRCHL0,1,$L(PRCHL0)-J)_PRCHLI Q
"RTN","PRCHAMYC",29,0)
 S PRCHLI=$E(PRCHL0,1,$L(PRCHL0)-1)_":1:"_PRCHLI
"RTN","PRCHAMYC",30,0)
 Q
"RTN","PRCHAMYC",31,0)
 ;
"RTN","PRCHAMYC",32,0)
CN ;CREATE THE 'PRCH("AM",PRCHCN)' ARRAY ELEMENT HERE, ALL THREE PARTS, FOR LINE ITEMS WITH A CONTRACT NUMBER.
"RTN","PRCHAMYC",33,0)
 S:'$D(PRCH("AM",PRCHCN)) PRCH("AM",PRCHCN)="",PRCHEC=PRCHEC+1 S PRCHL3=PRCHCN
"RTN","PRCHAMYC",34,0)
 D LI S PRCH("AM",PRCHCN)=($P(PRCH("AM",PRCHCN),U,1)+1)_U_($P(PRCH("AM",PRCHCN),U,2)+PRCHAMX)_U_PRCHLI_",",^PRC(442,PRCHPO,2,"AC",$E(PRCHCN,1,30),PRCH)=""
"RTN","PRCHAMYC",35,0)
 Q
"RTN","PRCHAMYC",36,0)
 ;
"RTN","PRCHAMYC",37,0)
OM ;CREATE THE 'PRCH("AM",PRCHCN)' ARRAY ELEMENT HERE, ALL THREE PARTS, FOR LINE ITEMS WITHOUT A CONTRACT NUMBER.
"RTN","PRCHAMYC",38,0)
 S:'$D(PRCH("AM",".OM")) PRCH("AM",".OM")="",PRCHEC=PRCHEC+1 S PRCHL3=".OM" D LI S PRCH("AM",".OM")=($P(PRCH("AM",".OM"),U,1)+1)_U_($P(PRCH("AM",".OM"),U,2)+PRCHAMX)_U_PRCHLI_","
"RTN","PRCHAMYC",39,0)
 Q
"RTN","PRCHAMYC",40,0)
 ;
"RTN","PRCHAMYC",41,0)
UP ;NOW LETS DO THE ACTUAL UPDATING OF THE DISCOUNT FOR EACH LINE ITEM.
"RTN","PRCHAMYC",42,0)
 ;
"RTN","PRCHAMYC",43,0)
 S PRCH=0
"RTN","PRCHAMYC",44,0)
 F I=1:1 S PRCH=$O(^PRC(442,PRCHPO,3,PRCH)) Q:PRCH=""!(PRCH'>0)  S PRCHCN=$S($P(^(PRCH,0),U,5)]"":$P(^(0),U,5),1:".OM"),PRCHAC=$P(^(0),U,1),PRCHACT=$P(^(0),U,4),PRCHP=$P(^(0),U,2) D SET
"RTN","PRCHAMYC",45,0)
 Q
"RTN","PRCHAMYC",46,0)
 ;
"RTN","PRCHAMYC",47,0)
SET ;DECIDE THE LINE ITEM NUMBERS TO DO THE DISCOUNT ADJUSTMENT.
"RTN","PRCHAMYC",48,0)
 G:PRCHAC="Q" PCTQ
"RTN","PRCHAMYC",49,0)
 I PRCHAC[":" S PRCHAC=$P(PRCHAC,":",1)_":1:"_$P(PRCHAC,":",2)
"RTN","PRCHAMYC",50,0)
 ;
"RTN","PRCHAMYC",51,0)
PCT ;FOR EACH 'LINE ITEM NUMBER' WITH A DISCOUNT DO IT HERE.
"RTN","PRCHAMYC",52,0)
 S PRCHAMT=0,Y="F J="_PRCHAC_" S PRCHN=J D PCT1 G:$D(PRCHER) Q" X Y
"RTN","PRCHAMYC",53,0)
 S PRCHAMT=PRCHAMT*100+.5\1/100,$P(PRCH("AM",PRCHCN),U,2)=$P(PRCH("AM",PRCHCN),U,2)-PRCHAMT
"RTN","PRCHAMYC",54,0)
 S $P(^PRC(442,PRCHPO,3,PRCH,0),U,3)=PRCHAMT,$P(^(0),U,6)=I+PRCHLCNT
"RTN","PRCHAMYC",55,0)
 Q
"RTN","PRCHAMYC",56,0)
 ;
"RTN","PRCHAMYC",57,0)
PCT1 S PRCHN=$O(^PRC(442,PRCHPO,2,"B",PRCHN,0)),PRCHD=+$P($G(^PRC(442,PRCHPO,2,PRCHN,2)),U,1)
"RTN","PRCHAMYC",58,0)
 I $E(PRCHP,1)="$" S PRCHDA=$P(PRCHP,"$",2)/PRCHACT
"RTN","PRCHAMYC",59,0)
 E  S PRCHDA=$J(PRCHD*(PRCHP/100),0,2)
"RTN","PRCHAMYC",60,0)
 S PRCHAMT=PRCHAMT+PRCHDA,$P(^PRC(442,PRCHPO,2,PRCHN,2),U,6)=PRCHDA
"RTN","PRCHAMYC",61,0)
 Q
"RTN","PRCHAMYC",62,0)
 ;
"RTN","PRCHAMYC",63,0)
PCTQ ;COME HERE IF THE USER SELECTED A 'QUANTITY' DISCOUNT.
"RTN","PRCHAMYC",64,0)
 ;
"RTN","PRCHAMYC",65,0)
 S (PRCHAMT,PRCHCN,PRCHX)=0,PRCHACT=PRCHLCNT F K=0:0 S PRCHCN=$O(PRCH("AM",PRCHCN)) Q:PRCHCN=""  S PRCHAC=$E($P(PRCH("AM",PRCHCN),U,3),1,$L($P(PRCH("AM",PRCHCN),U,3))-1) D PCT S PRCHX=PRCHX+PRCHAMT
"RTN","PRCHAMYC",66,0)
 S $P(^PRC(442,PRCHPO,3,PRCH,0),U,3)=PRCHX
"RTN","PRCHAMYC",67,0)
 Q
"RTN","PRCHAMYC",68,0)
 ;
"VER")
8.0^22.0
"BLD",4938,6)
^81
**END**
**END**
