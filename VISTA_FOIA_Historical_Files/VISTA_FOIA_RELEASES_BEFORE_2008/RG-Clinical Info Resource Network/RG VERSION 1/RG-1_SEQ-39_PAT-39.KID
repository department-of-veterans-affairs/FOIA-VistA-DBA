Released RG*1*39 SEQ #39
Extracted from mail message
**KIDS**:RG*1.0*39^

**INSTALL NAME**
RG*1.0*39
"BLD",2172,0)
RG*1.0*39^CLINICAL INFO RESOURCE NETWORK^0^3050324^y
"BLD",2172,1,0)
^^1^1^3050207^
"BLD",2172,1,1,0)
Add Exception Text to Exception Handler display.
"BLD",2172,4,0)
^9.64PA^^
"BLD",2172,"KRN",0)
^9.67PA^8989.52^19
"BLD",2172,"KRN",.4,0)
.4
"BLD",2172,"KRN",.401,0)
.401
"BLD",2172,"KRN",.402,0)
.402
"BLD",2172,"KRN",.403,0)
.403
"BLD",2172,"KRN",.5,0)
.5
"BLD",2172,"KRN",.84,0)
.84
"BLD",2172,"KRN",3.6,0)
3.6
"BLD",2172,"KRN",3.8,0)
3.8
"BLD",2172,"KRN",9.2,0)
9.2
"BLD",2172,"KRN",9.8,0)
9.8
"BLD",2172,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",2172,"KRN",9.8,"NM",1,0)
RGEX03^^0^B87308320
"BLD",2172,"KRN",9.8,"NM","B","RGEX03",1)

"BLD",2172,"KRN",19,0)
19
"BLD",2172,"KRN",19.1,0)
19.1
"BLD",2172,"KRN",101,0)
101
"BLD",2172,"KRN",409.61,0)
409.61
"BLD",2172,"KRN",771,0)
771
"BLD",2172,"KRN",870,0)
870
"BLD",2172,"KRN",8989.51,0)
8989.51
"BLD",2172,"KRN",8989.52,0)
8989.52
"BLD",2172,"KRN",8994,0)
8994
"BLD",2172,"KRN","B",.4,.4)

"BLD",2172,"KRN","B",.401,.401)

"BLD",2172,"KRN","B",.402,.402)

"BLD",2172,"KRN","B",.403,.403)

"BLD",2172,"KRN","B",.5,.5)

"BLD",2172,"KRN","B",.84,.84)

"BLD",2172,"KRN","B",3.6,3.6)

"BLD",2172,"KRN","B",3.8,3.8)

"BLD",2172,"KRN","B",9.2,9.2)

"BLD",2172,"KRN","B",9.8,9.8)

"BLD",2172,"KRN","B",19,19)

"BLD",2172,"KRN","B",19.1,19.1)

"BLD",2172,"KRN","B",101,101)

"BLD",2172,"KRN","B",409.61,409.61)

"BLD",2172,"KRN","B",771,771)

"BLD",2172,"KRN","B",870,870)

"BLD",2172,"KRN","B",8989.51,8989.51)

"BLD",2172,"KRN","B",8989.52,8989.52)

"BLD",2172,"KRN","B",8994,8994)

"BLD",2172,"QUES",0)
^9.62^^
"BLD",2172,"REQB",0)
^9.611^1^1
"BLD",2172,"REQB",1,0)
RG*1.0*38^2
"BLD",2172,"REQB","B","RG*1.0*38",1)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
39^3050324
"PKG",272,22,1,"PAH",1,1,0)
^^1^1^3050324
"PKG",272,22,1,"PAH",1,1,1,0)
Add Exception Text to Exception Handler display.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RGEX03")
0^1^B87308320
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23,27,30,38,39**;30 Apr 99
"RTN","RGEX03",3,0)
 ;
"RTN","RGEX03",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX03",5,0)
 ;Reference to ^DIA(2 supported by IA #2097
"RTN","RGEX03",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGEX03",7,0)
 ;Reference to HINQ^DG10 supported by IA #2076
"RTN","RGEX03",8,0)
 ;Reference to CIRNEXC^MPIFQ0 supported by IA #2942
"RTN","RGEX03",9,0)
 ;Reference to VTQ^MPIFSAQ supported by IA #2941
"RTN","RGEX03",10,0)
 ;Reference to NOTICE^DGSEC4 and PTSEC^DGSEC4 supported by IA#3027
"RTN","RGEX03",11,0)
 ;
"RTN","RGEX03",12,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",13,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",14,0)
 Q
"RTN","RGEX03",15,0)
 ;
"RTN","RGEX03",16,0)
HDR ; -- header code
"RTN","RGEX03",17,0)
 S VALMHDR(1)="MPI/PD EXCEPTION HANDLING ACTIONS."
"RTN","RGEX03",18,0)
 S VALMHDR(2)=""
"RTN","RGEX03",19,0)
 Q
"RTN","RGEX03",20,0)
 ;
"RTN","RGEX03",21,0)
INIT ; -- init variables and list array
"RTN","RGEX03",22,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",23,0)
 K @VALMAR
"RTN","RGEX03",24,0)
 I DATA="" Q
"RTN","RGEX03",25,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN=""
"RTN","RGEX03",26,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6)
"RTN","RGEX03",28,0)
 S STR=$$SETSTR^VALM1(NAME,STR,14,30)
"RTN","RGEX03",29,0)
 D ADDTMP
"RTN","RGEX03",30,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6)
"RTN","RGEX03",31,0)
 S STR=$$SETSTR^VALM1(SSN,STR,14,12)
"RTN","RGEX03",32,0)
 D ADDTMP
"RTN","RGEX03",33,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6)
"RTN","RGEX03",34,0)
 S STR=$$SETSTR^VALM1(DOB,STR,14,20)
"RTN","RGEX03",35,0)
 D ADDTMP
"RTN","RGEX03",36,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6)
"RTN","RGEX03",37,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",5),STR,14,12)
"RTN","RGEX03",38,0)
 D ADDTMP
"RTN","RGEX03",39,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6)
"RTN","RGEX03",40,0)
 S ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",41,0)
 S STR=$$SETSTR^VALM1(ICN,STR,14,15)
"RTN","RGEX03",42,0)
 D ADDTMP
"RTN","RGEX03",43,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20)
"RTN","RGEX03",44,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20)
"RTN","RGEX03",45,0)
 D ADDTMP
"RTN","RGEX03",46,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20)
"RTN","RGEX03",47,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50)
"RTN","RGEX03",48,0)
 D ADDTMP
"RTN","RGEX03",49,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20)
"RTN","RGEX03",50,0)
 S STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30)
"RTN","RGEX03",51,0)
 D ADDTMP
"RTN","RGEX03",52,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",53,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",54,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",55,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20)
"RTN","RGEX03",56,0)
 S STR=$$SETSTR^VALM1(STATUS,STR,26,15)
"RTN","RGEX03",57,0)
 D ADDTMP
"RTN","RGEX03",58,0)
 ;Added Exception Text to Exception Handler, patch 39
"RTN","RGEX03",59,0)
 N IEN,IEN2,X
"RTN","RGEX03",60,0)
 K ^UTILITY($J,"W")
"RTN","RGEX03",61,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",62,0)
 I IEN'=""!(IEN2'="") D
"RTN","RGEX03",63,0)
 . S EXCTEXT=$P($G(^RGHL7(991.1,IEN,1,IEN2,10)),"^",1) Q:EXCTEXT=""
"RTN","RGEX03",64,0)
 . S STR=$$SETSTR^VALM1("Exception Text:",STR,6,20)
"RTN","RGEX03",65,0)
 . S X=EXCTEXT,DIWL=1,DIWR=50,DIWF="|" D ^DIWP
"RTN","RGEX03",66,0)
 . F N=1:1:$P($G(^UTILITY($J,"W",1)),1) D  Q:'N
"RTN","RGEX03",67,0)
 .. S STR=$$SETSTR^VALM1(^UTILITY($J,"W",1,(N),0),STR,26,76)
"RTN","RGEX03",68,0)
 .. D ADDTMP
"RTN","RGEX03",69,0)
ADDNOTE ;Display Exception Notes, Word Processing field
"RTN","RGEX03",70,0)
 S STR=$$SETSTR^VALM1("Exception Notes:",STR,6,20)
"RTN","RGEX03",71,0)
 D ADDTMP
"RTN","RGEX03",72,0)
 N IEN,IEN2,IENS,N,NOTE
"RTN","RGEX03",73,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",74,0)
 S IENS=IEN2_","_IEN_","
"RTN","RGEX03",75,0)
 S N=$$GET1^DIQ(991.12,IENS,11,"","NT")
"RTN","RGEX03",76,0)
 S L=0 F  S L=$O(NT(L)) Q:'L  D
"RTN","RGEX03",77,0)
 . S NOTE=NT(L)
"RTN","RGEX03",78,0)
 . S STR=$$SETSTR^VALM1(NOTE,STR,6,74)
"RTN","RGEX03",79,0)
 . D ADDTMP
"RTN","RGEX03",80,0)
 S VALMCNT=LIN-1
"RTN","RGEX03",81,0)
 S DFN=$P(DATA,"^",5)
"RTN","RGEX03",82,0)
 S VAFCDFN=DFN
"RTN","RGEX03",83,0)
 K L,NT
"RTN","RGEX03",84,0)
 Q
"RTN","RGEX03",85,0)
ADDTMP ;
"RTN","RGEX03",86,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR
"RTN","RGEX03",87,0)
 S ^TMP("RGEXC2",$J,"IDX",LIN,LIN)=""
"RTN","RGEX03",88,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX03",89,0)
 Q
"RTN","RGEX03",90,0)
 ;
"RTN","RGEX03",91,0)
UPD ;
"RTN","RGEX03",92,0)
 W !,"This option updates the exception status to PROCESSED."
"RTN","RGEX03",93,0)
 W !,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",94,0)
 S DIR("A")="Are you sure you want to change the status?"
"RTN","RGEX03",95,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",96,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",97,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",98,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",99,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",100,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",101,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",102,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",103,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",104,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",105,0)
 . D INIT
"RTN","RGEX03",106,0)
 K DIR,DIRUT
"RTN","RGEX03",107,0)
 S VALMBCK="R"
"RTN","RGEX03",108,0)
 Q
"RTN","RGEX03",109,0)
PA ;Patient Audit
"RTN","RGEX03",110,0)
 S PDFN=DFN
"RTN","RGEX03",111,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",112,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",113,0)
 S DFN=PDFN
"RTN","RGEX03",114,0)
 K QFLG,PDFN
"RTN","RGEX03",115,0)
PAQ Q
"RTN","RGEX03",116,0)
HI ;Hinq Inquiry
"RTN","RGEX03",117,0)
 S VALMBCK=""
"RTN","RGEX03",118,0)
 D HINQ^DG10
"RTN","RGEX03",119,0)
 D PAUSE^VALM1
"RTN","RGEX03",120,0)
 S VALMBCK="R"
"RTN","RGEX03",121,0)
 Q
"RTN","RGEX03",122,0)
DISP ; Display Only Query
"RTN","RGEX03",123,0)
 S VALMBCK=""
"RTN","RGEX03",124,0)
 D FULL^VALM1
"RTN","RGEX03",125,0)
 S MPIVAR("DFN")=DFN
"RTN","RGEX03",126,0)
 S MPIVAR("SSN")=SSN
"RTN","RGEX03",127,0)
 S MPIVAR("NM")=NAME
"RTN","RGEX03",128,0)
 S MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",129,0)
 D VTQ^MPIFSAQ(.MPIVAR)
"RTN","RGEX03",130,0)
 D PAUSE^VALM1
"RTN","RGEX03",131,0)
 S VALMBCK="R"
"RTN","RGEX03",132,0)
 K MPIVAR
"RTN","RGEX03",133,0)
 Q
"RTN","RGEX03",134,0)
INTL ; Single Patient Initialization to MPI
"RTN","RGEX03",135,0)
 S VALMBCK="",MPIFRES="",MPIFINT=""
"RTN","RGEX03",136,0)
 D FULL^VALM1
"RTN","RGEX03",137,0)
 D CIRNEXC^MPIFQ0
"RTN","RGEX03",138,0)
 D PAUSE^VALM1
"RTN","RGEX03",139,0)
 K MPIFRES,MPIFINT
"RTN","RGEX03",140,0)
 S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX03",141,0)
 S $P(DATA,"^",6)=$G(ICN)
"RTN","RGEX03",142,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEX03",143,0)
 ; If patient has a nation ICN, change status to processed
"RTN","RGEX03",144,0)
 I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX03",145,0)
 . S IEN="",IEN2=""
"RTN","RGEX03",146,0)
 . S IEN=$P(DATA,"^",10)
"RTN","RGEX03",147,0)
 . S IEN2=$P(DATA,"^",11)
"RTN","RGEX03",148,0)
 . L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",149,0)
 . S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX03",150,0)
 . D ^DIE K DIE,DA,DR
"RTN","RGEX03",151,0)
 . L -^RGHL7(991.1,IEN)
"RTN","RGEX03",152,0)
 . S $P(DATA,"^",9)=1
"RTN","RGEX03",153,0)
 D INIT
"RTN","RGEX03",154,0)
 S VALMBCK="R"
"RTN","RGEX03",155,0)
 Q
"RTN","RGEX03",156,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified
"RTN","RGEX03",157,0)
 ; check for DG ELIGIBILITY key for user
"RTN","RGEX03",158,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",159,0)
 D FULL^VALM1
"RTN","RGEX03",160,0)
 D ELIG^VADPT
"RTN","RGEX03",161,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",162,0)
 . I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",163,0)
 .. W !!,"Eligibility has been verified for this patient."
"RTN","RGEX03",164,0)
 .. W !!,"You do not have access to edit the Name, Date of "
"RTN","RGEX03",165,0)
 .. W !,"Birth or Social Security Number for this patient."
"RTN","RGEX03",166,0)
 .. D PAUSE^VALM1
"RTN","RGEX03",167,0)
 .. S VALMBCK="R"
"RTN","RGEX03",168,0)
 . E  D SENS
"RTN","RGEX03",169,0)
 E  D SENS
"RTN","RGEX03",170,0)
 Q
"RTN","RGEX03",171,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",172,0)
 N RESULT,RGSEN
"RTN","RGEX03",173,0)
 D PTSEC^DGSEC4(.RESULT,DFN,0,"RG EXCEPTION HANDLING^MPI/PD Exception Handling")
"RTN","RGEX03",174,0)
 I RESULT(1)=-1 W !!,"Access denied: Required parameters not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",175,0)
 I RESULT(1)>0 W !!?15,"***PATIENT MARKED SENSITIVE***"
"RTN","RGEX03",176,0)
 I RESULT(1)=3 W !!?15,"Access not allowed on your own PATIENT (#2) file entry" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",177,0)
 I RESULT(1)=4 W !!?15,"Access denied: Your SSN is not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",178,0)
 I RESULT(1)<3 D
"RTN","RGEX03",179,0)
 . I RESULT(1)=1 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",2)
"RTN","RGEX03",180,0)
 . I RESULT(1)=2 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",3)
"RTN","RGEX03",181,0)
 D EDIT
"RTN","RGEX03",182,0)
 Q
"RTN","RGEX03",183,0)
EDIT ; edit patient data
"RTN","RGEX03",184,0)
 S ACCESS=0
"RTN","RGEX03",185,0)
 D REC
"RTN","RGEX03",186,0)
 Q:ACCESS=0
"RTN","RGEX03",187,0)
 S DIE="^DPT(",DA=DFN
"RTN","RGEX03",188,0)
 S DR=".01///^S X=$$NCEDIT^DPTNAME(DA);.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",189,0)
 L +^DPT(DFN):10
"RTN","RGEX03",190,0)
 D ^DIE K DIE,DA,DR
"RTN","RGEX03",191,0)
 L -^DPT(DFN)
"RTN","RGEX03",192,0)
 S DATAOLD=DATA
"RTN","RGEX03",193,0)
 D DEATH
"RTN","RGEX03",194,0)
 D DEM^VADPT
"RTN","RGEX03",195,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",196,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",197,0)
 D INIT
"RTN","RGEX03",198,0)
 S VALMBCK="R"
"RTN","RGEX03",199,0)
 K DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",200,0)
QUIT Q
"RTN","RGEX03",201,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",202,0)
 ; check for security key
"RTN","RGEX03",203,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",204,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",205,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",206,0)
 . W !!,"Your SSN is missing from the NEW PERSON file."
"RTN","RGEX03",207,0)
 . W !,"Contact your ADP Coordinator."
"RTN","RGEX03",208,0)
 . D PAUSE^VALM1
"RTN","RGEX03",209,0)
 . S VALMBCK="R"
"RTN","RGEX03",210,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",211,0)
 . W !!,"Security regulations prohibit computer access to your"
"RTN","RGEX03",212,0)
 . W !,"own medical record."
"RTN","RGEX03",213,0)
 . D PAUSE^VALM1
"RTN","RGEX03",214,0)
 . S VALMBCK="R"
"RTN","RGEX03",215,0)
 E  S ACCESS=1
"RTN","RGEX03",216,0)
 Q
"RTN","RGEX03",217,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",218,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",219,0)
 . K VADM,DIE,DA,DR
"RTN","RGEX03",220,0)
 . S DOD=""
"RTN","RGEX03",221,0)
 . D DEM^VADPT S DOD=$P($G(VADM(6)),"^",2)
"RTN","RGEX03",222,0)
 . S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD"
"RTN","RGEX03",223,0)
 . L +^DPT(DFN):10
"RTN","RGEX03",224,0)
 . D ^DIE
"RTN","RGEX03",225,0)
 . L -^DPT(DFN)
"RTN","RGEX03",226,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",227,0)
 K VADM,DIE,DA,DR,DOD
"RTN","RGEX03",228,0)
 Q
"RTN","RGEX03",229,0)
INQ ; Patient Inquiry
"RTN","RGEX03",230,0)
 S VALMBCK=""
"RTN","RGEX03",231,0)
 D FULL^VALM1
"RTN","RGEX03",232,0)
 D EN^DGRPD
"RTN","RGEX03",233,0)
 D PAUSE^VALM1
"RTN","RGEX03",234,0)
 D CLEAN^VALM10
"RTN","RGEX03",235,0)
 D INIT
"RTN","RGEX03",236,0)
 S VALMBCK="R"
"RTN","RGEX03",237,0)
 Q
"RTN","RGEX03",238,0)
EDTNOT ; Edit Exception Notes
"RTN","RGEX03",239,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",240,0)
 L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",241,0)
 S DIE="^RGHL7(991.1,"_IEN_",1,",DA(1)=IEN,DA=IEN2,DR="11"
"RTN","RGEX03",242,0)
 D ^DIE
"RTN","RGEX03",243,0)
 L -^RGHL7(991.1,IEN)
"RTN","RGEX03",244,0)
 K DIE,DA,DR,IEN,IEN2
"RTN","RGEX03",245,0)
 D INIT
"RTN","RGEX03",246,0)
 S VALMBCK="R"
"RTN","RGEX03",247,0)
 Q
"RTN","RGEX03",248,0)
PDAT S VALMBCK="",PICN="",PSSN=""
"RTN","RGEX03",249,0)
 I $D(SSN) S PSSN=SSN
"RTN","RGEX03",250,0)
 S ARRAY="^TMP(""RGXHFS"","_$J_")",TYPE="I",REP=1
"RTN","RGEX03",251,0)
 S RGXDIR=$$GET^XPAR("SYS","RGX HFS SCRATCH")
"RTN","RGEX03",252,0)
 S RGXFILE="RGX"_DUZ_".DAT"
"RTN","RGEX03",253,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","RGEX03",254,0)
 D OPEN^%ZISH("RGX",RGXDIR,RGXFILE,"W") Q:POP
"RTN","RGEX03",255,0)
 U IO
"RTN","RGEX03",256,0)
 I ICN'="" S PICN=ICN D START^VAFCPDAT
"RTN","RGEX03",257,0)
 N RGXDEL
"RTN","RGEX03",258,0)
 D CLOSE^%ZISH("RGX")
"RTN","RGEX03",259,0)
 K ^TMP("RGPDAT",$J)
"RTN","RGEX03",260,0)
 S RGXDEL(RGXFILE)=""
"RTN","RGEX03",261,0)
 S X=$$FTG^%ZISH(RGXDIR,RGXFILE,$NAME(^TMP("RGPDAT",$J,1)),3)
"RTN","RGEX03",262,0)
 S X=$$DEL^%ZISH(RGXDIR,$NA(RGXDEL))
"RTN","RGEX03",263,0)
 I $D(^TMP("RGPDAT",$J)) D EN^RGEX04
"RTN","RGEX03",264,0)
 S ICN=PICN,SSN=PSSN
"RTN","RGEX03",265,0)
 D INIT
"RTN","RGEX03",266,0)
 S VALMBCK="R"
"RTN","RGEX03",267,0)
 K PICN,PSSN,ARRAY,REP,RGXDIR,RGXFILE,TYPE
"RTN","RGEX03",268,0)
 Q
"RTN","RGEX03",269,0)
GETEX(RETURN,DFN) ; Get array of pending exceptions for a patient
"RTN","RGEX03",270,0)
 K RETURN
"RTN","RGEX03",271,0)
 S CNT=0,RETURN(0)="0^No Pending Exceptions",TYP=""
"RTN","RGEX03",272,0)
 I 'DFN S RETURN(0)="-1^DFN not passed" G QGET
"RTN","RGEX03",273,0)
 F  S TYP=$O(^RGHL7(991.1,"ADFN",TYP)) Q:'TYP  D
"RTN","RGEX03",274,0)
 . I $D(^RGHL7(991.1,"ADFN",TYP,DFN)) D
"RTN","RGEX03",275,0)
 .. S IEN="" F  S IEN=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEX03",276,0)
 ... S IEN2="",ETYP="" F  S IEN2=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX03",277,0)
 .... I $P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)<1 D
"RTN","RGEX03",278,0)
 ..... S CNT=CNT+1,ETYP=$P(^RGHL7(991.11,TYP,10),"^",1)
"RTN","RGEX03",279,0)
 ..... S RETURN(CNT)=ETYP_"^"_IEN_"^"_IEN2
"RTN","RGEX03",280,0)
 I CNT>0 S RETURN(0)=CNT_"^Pending Exception(s)"
"RTN","RGEX03",281,0)
QGET ;
"RTN","RGEX03",282,0)
 K TYP,ETYP,IEN,IEN2,CNT
"RTN","RGEX03",283,0)
 Q
"RTN","RGEX03",284,0)
HELP ; -- help code
"RTN","RGEX03",285,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",286,0)
 Q
"RTN","RGEX03",287,0)
 ;
"RTN","RGEX03",288,0)
EXIT ; -- exit code
"RTN","RGEX03",289,0)
 S VALMBCK=""
"RTN","RGEX03",290,0)
 K ^TMP("RGEXC2",$J),DFN,DIR,EXCTEXT,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",291,0)
 S VALMBCK="R",RGBG=1
"RTN","RGEX03",292,0)
 Q
"RTN","RGEX03",293,0)
 ;
"RTN","RGEX03",294,0)
EXPND ; -- expand code
"RTN","RGEX03",295,0)
 Q
"RTN","RGEX03",296,0)
 ;
"VER")
8.0^22.0
**END**
**END**
