Released ECX*3*70 SEQ #64
Extracted from mail message
**KIDS**:ECX*3.0*70^

**INSTALL NAME**
ECX*3.0*70
"BLD",5441,0)
ECX*3.0*70^DSS EXTRACTS^0^3040310^y
"BLD",5441,1,0)
^^1^1^3040310^
"BLD",5441,1,1,0)
Fix for duplicate observation encounters in the Laboratory Extract.
"BLD",5441,4,0)
^9.64PA^^
"BLD",5441,"KRN",0)
^9.67PA^8989.52^19
"BLD",5441,"KRN",.4,0)
.4
"BLD",5441,"KRN",.401,0)
.401
"BLD",5441,"KRN",.402,0)
.402
"BLD",5441,"KRN",.403,0)
.403
"BLD",5441,"KRN",.5,0)
.5
"BLD",5441,"KRN",.84,0)
.84
"BLD",5441,"KRN",3.6,0)
3.6
"BLD",5441,"KRN",3.8,0)
3.8
"BLD",5441,"KRN",9.2,0)
9.2
"BLD",5441,"KRN",9.8,0)
9.8
"BLD",5441,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",5441,"KRN",9.8,"NM",1,0)
ECXLABN^^0^B24304071
"BLD",5441,"KRN",9.8,"NM","B","ECXLABN",1)

"BLD",5441,"KRN",19,0)
19
"BLD",5441,"KRN",19.1,0)
19.1
"BLD",5441,"KRN",101,0)
101
"BLD",5441,"KRN",409.61,0)
409.61
"BLD",5441,"KRN",771,0)
771
"BLD",5441,"KRN",870,0)
870
"BLD",5441,"KRN",8989.51,0)
8989.51
"BLD",5441,"KRN",8989.52,0)
8989.52
"BLD",5441,"KRN",8994,0)
8994
"BLD",5441,"KRN","B",.4,.4)

"BLD",5441,"KRN","B",.401,.401)

"BLD",5441,"KRN","B",.402,.402)

"BLD",5441,"KRN","B",.403,.403)

"BLD",5441,"KRN","B",.5,.5)

"BLD",5441,"KRN","B",.84,.84)

"BLD",5441,"KRN","B",3.6,3.6)

"BLD",5441,"KRN","B",3.8,3.8)

"BLD",5441,"KRN","B",9.2,9.2)

"BLD",5441,"KRN","B",9.8,9.8)

"BLD",5441,"KRN","B",19,19)

"BLD",5441,"KRN","B",19.1,19.1)

"BLD",5441,"KRN","B",101,101)

"BLD",5441,"KRN","B",409.61,409.61)

"BLD",5441,"KRN","B",771,771)

"BLD",5441,"KRN","B",870,870)

"BLD",5441,"KRN","B",8989.51,8989.51)

"BLD",5441,"KRN","B",8989.52,8989.52)

"BLD",5441,"KRN","B",8994,8994)

"BLD",5441,"QUES",0)
^9.62^^
"BLD",5441,"REQB",0)
^9.611^1^1
"BLD",5441,"REQB",1,0)
ECX*3.0*46^2
"BLD",5441,"REQB","B","ECX*3.0*46",1)

"MBREQ")
0
"PKG",535,-1)
1^1
"PKG",535,0)
DSS EXTRACTS^ECX
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^2971222^3000224^66481
"PKG",535,22,1,"PAH",1,0)
70^3040310
"PKG",535,22,1,"PAH",1,1,0)
^^1^1^3040310
"PKG",535,22,1,"PAH",1,1,1,0)
Fix for duplicate observation encounters in the Laboratory Extract.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECXLABN")
0^1^B24304071
"RTN","ECXLABN",1,0)
ECXLABN ;ALB/JAP,BIR/CML-Lab Extract for DSS (New Format - With LMIP Codes) ; 3/10/04 11:47am
"RTN","ECXLABN",2,0)
 ;;3.0;DSS EXTRACTS;**1,11,8,13,28,24,30,31,32,33,39,42,46,70**;Dec 22, 1997
"RTN","ECXLABN",3,0)
BEG ;entry point
"RTN","ECXLABN",4,0)
 D SETUP I ECFILE="" Q
"RTN","ECXLABN",5,0)
 D ^ECXTRAC,^ECXKILL
"RTN","ECXLABN",6,0)
 Q
"RTN","ECXLABN",7,0)
 ;
"RTN","ECXLABN",8,0)
START ; entry when queued
"RTN","ECXLABN",9,0)
 K ^LRO(64.03),^TMP($J,"ECXP")
"RTN","ECXLABN",10,0)
 S LRSDT=ECSD,LREDT=ECED,QFLG=0
"RTN","ECXLABN",11,0)
 D ^LRCAPDSS
"RTN","ECXLABN",12,0)
 ;quit if no completion date for API compile
"RTN","ECXLABN",13,0)
 I '$P($G(^LRO(64.03,1,1,1,0)),U,4) Q
"RTN","ECXLABN",14,0)
 ;quit if tasked and user sends stop request
"RTN","ECXLABN",15,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD D  Q
"RTN","ECXLABN",16,0)
 .S QFLG=1
"RTN","ECXLABN",17,0)
 .K ^LRO(64.03) S ^LRO(64.03,0)="WKLD LOG FILE^64.03^"
"RTN","ECXLABN",18,0)
 ;otherwise, continue
"RTN","ECXLABN",19,0)
 K ECXDD D FIELD^DID(64.03,1,,"SPECIFIER","ECXDD")
"RTN","ECXLABN",20,0)
 S ECPROF=$E(+$P(ECXDD("SPECIFIER"),"P",2)),ECLRN=1 K ECXDD
"RTN","ECXLABN",21,0)
 F  S ECLRN=$O(^LRO(64.03,ECLRN)) Q:'ECLRN  D  Q:QFLG
"RTN","ECXLABN",22,0)
 .Q:'$D(^LRO(64.03,ECLRN,0))
"RTN","ECXLABN",23,0)
 .S EC1=^LRO(64.03,ECLRN,0),ECDOC=ECPROF_$P(EC1,U,2),ECDOCNPI=""
"RTN","ECXLABN",24,0)
 .S ECLOC=$P(EC1,U,15),EC=$P(EC1,U,3)
"RTN","ECXLABN",25,0)
 .I EC]"" D GET
"RTN","ECXLABN",26,0)
 K ^LRO(64.03),^TMP($J,"ECXP") S ^LRO(64.03,0)="WKLD LOG FILE^64.03^"
"RTN","ECXLABN",27,0)
 K ECDOCNPI,ECXAGC,ECXL1,ECXL2
"RTN","ECXLABN",28,0)
 Q
"RTN","ECXLABN",29,0)
 ;
"RTN","ECXLABN",30,0)
GET ;get data
"RTN","ECXLABN",31,0)
 N X,ECXSTN
"RTN","ECXLABN",32,0)
 S ECF=$S($P(EC,";",2)="DPT(":2,$P(EC,";",2)="LRT(67,":67,1:0) Q:'ECF
"RTN","ECXLABN",33,0)
 S ECIFN=$P(EC,";")
"RTN","ECXLABN",34,0)
 ;resolve ecloc
"RTN","ECXLABN",35,0)
 S ECXL1=+$P(ECLOC,";",1),ECXL2=$P(ECLOC,";",2)
"RTN","ECXLABN",36,0)
 I ECF=2 S ECLOC=$S(ECXL1>0:ECXL1,1:"") I ECXL2]"",ECXL2'="SC(" S ECLOC=""
"RTN","ECXLABN",37,0)
 I ECF=67 D  S ECLOC=ECXSTN
"RTN","ECXLABN",38,0)
 .S (ECXSTN,ECXAGC)=""
"RTN","ECXLABN",39,0)
 .I (ECXL2'="DIC(4,")!('$D(^DIC(4,ECXL1))) S ECXSTN="XXXXX",ECXAGC="XX" Q
"RTN","ECXLABN",40,0)
 .S ECXSTN=$P(^DIC(4,ECXL1,"99"),U,1),ECXAGC=$E($P(^(99),U,5),1,2)
"RTN","ECXLABN",41,0)
 .S:ECXSTN="" ECXSTN="ZZZZZ" S:ECXAGC="" ECXAGC="ZZ"
"RTN","ECXLABN",42,0)
 S ECDT=$P(EC1,U,13),ECD=$P(ECDT,"."),ECTM=$$ECXTIME^ECXUTL(ECDT)
"RTN","ECXLABN",43,0)
 S ECWKLD=$P(EC1,U,11),ECWK="" I $D(^LAM(ECWKLD,0)) S ECWK=$P(^(0),U,2)
"RTN","ECXLABN",44,0)
 S (ECXADMDT,ECTREAT,ECNA,ECSN,ECMN,ECPTTM,ECPTPR,ECCLAS)="",ECA="O",ECXERR=0
"RTN","ECXLABN",45,0)
 S (ECPTNPI,ECASPR,ECCLAS2,ECASNPI)=""
"RTN","ECXLABN",46,0)
 ;get the patient data if record is in file #2
"RTN","ECXLABN",47,0)
 I ECF=2 D PAT(ECIFN,ECDT,.ECXERR)
"RTN","ECXLABN",48,0)
 Q:ECXERR
"RTN","ECXLABN",49,0)
 ;get patient data if record is in file #67
"RTN","ECXLABN",50,0)
 I ECF=67 S ECSN="000123456",ECNA="RFRL" I $D(^LRT(67,ECIFN,0)) D
"RTN","ECXLABN",51,0)
 .S ECXMPI="",EC0=^LRT(67,ECIFN,0),ECNA=$E($P($P(EC0,U),",")_"    ",1,4)
"RTN","ECXLABN",52,0)
 .S ECSN=$P(EC0,U,9) D
"RTN","ECXLABN",53,0)
 ..S ECNA=$TR(ECNA,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ECXLABN",54,0)
 ..I ECSN="" S ECSN="000123456" Q
"RTN","ECXLABN",55,0)
 ..S ECSN=$TR(ECSN," "),ECSN=$TR(ECSN,"-")
"RTN","ECXLABN",56,0)
 ..I ($L(ECSN)<9)!($L(ECSN)>10) S ECSN="000123456" Q
"RTN","ECXLABN",57,0)
 ..I $L(ECSN)=9,ECSN'?9N S ECSN="000123456" Q
"RTN","ECXLABN",58,0)
 ..I $L(ECSN)=10,ECSN'?9N1"P" S ECSN="000123456"
"RTN","ECXLABN",59,0)
 ;
"RTN","ECXLABN",60,0)
 ;- Only set treating spec (TS) to TS in file #64.03 if it does not exist
"RTN","ECXLABN",61,0)
 I ECA="I",ECTREAT="" S ECTREAT=$P($G(^DIC(45.7,+$P(EC1,U,10),0)),U,2)
"RTN","ECXLABN",62,0)
 S (ECXDOM,ECXDSSD)=""
"RTN","ECXLABN",63,0)
 S X=$G(^ECX(727.831,+ECTREAT,0)) S:X'="" ECXDOM=$P(X,U,2)
"RTN","ECXLABN",64,0)
 ;
"RTN","ECXLABN",65,0)
 ;- Get ordering stop code and ordering date
"RTN","ECXLABN",66,0)
 S ECXORDST=+$P(EC1,U,15),ECXORDST=$S(ECXORDST:$P($G(^ECX(728.44,ECXORDST,0)),U,2),1:"")
"RTN","ECXLABN",67,0)
 S ECXORDDT=$S($P(EC1,U,14):$$ECXDATE^ECXUTL($P(EC1,U,14),ECXYM),1:"")
"RTN","ECXLABN",68,0)
 ;
"RTN","ECXLABN",69,0)
 ;- Get Production Division
"RTN","ECXLABN",70,0)
 N ECXPDIV S ECXPDIV=$$RADDIV^ECXDEPT(ECINST) ;p-46
"RTN","ECXLABN",71,0)
 ;
"RTN","ECXLABN",72,0)
 ;- Observation patient indicator (YES/NO)
"RTN","ECXLABN",73,0)
 S ECXOBS=$$OBSPAT^ECXUTL4(ECA,ECTREAT)
"RTN","ECXLABN",74,0)
 ;
"RTN","ECXLABN",75,0)
 ;- If no encounter number don't file record
"RTN","ECXLABN",76,0)
 S ECXENC=$$ENCNUM^ECXUTL4(ECA,ECSN,ECXADMDT,ECD,ECTREAT,ECXOBS,ECHEAD,,) Q:ECXENC=""
"RTN","ECXLABN",77,0)
 ;create extract record only if patient name and accession area exist
"RTN","ECXLABN",78,0)
 I ECNA]"" S ECT=$P(EC1,U,8),ECURG=$P(EC1,U,9),EC=+$P(EC1,U,7) I EC D
"RTN","ECXLABN",79,0)
 .S:ECF=2 ECACA=EC_U_$P($G(^LRO(68,EC,0)),U,11)
"RTN","ECXLABN",80,0)
 .S:ECF=67 ECACA=ECXAGC_U_$P($G(^LRO(68,EC,0)),U,11)
"RTN","ECXLABN",81,0)
 .D FILE
"RTN","ECXLABN",82,0)
 Q
"RTN","ECXLABN",83,0)
 ;
"RTN","ECXLABN",84,0)
PAT(ECXDFN,ECXDATE,ECXERR) ;get/set patient data
"RTN","ECXLABN",85,0)
 N X,OK,PT
"RTN","ECXLABN",86,0)
 ;get data
"RTN","ECXLABN",87,0)
 I $D(^TMP($J,"ECXP",ECXDFN)) D
"RTN","ECXLABN",88,0)
 .S PT=^TMP($J,"ECXP",ECXDFN),ECNA=$P(PT,U)
"RTN","ECXLABN",89,0)
 .S ECSN=$P(PT,U,2),ECXMPI=$P(PT,U,3)
"RTN","ECXLABN",90,0)
 ;set data and save for later
"RTN","ECXLABN",91,0)
 I '$D(^TMP($J,"ECXP",ECXDFN)) D  Q:'OK
"RTN","ECXLABN",92,0)
 .K ECXPAT S OK=$$PAT^ECXUTL3(ECXDFN,$P(ECSD,"."),"1;",.ECXPAT)
"RTN","ECXLABN",93,0)
 .I 'OK S ECXERR=1 Q
"RTN","ECXLABN",94,0)
 .S ECNA=ECXPAT("NAME"),ECSN=ECXPAT("SSN"),ECXMPI=ECXPAT("MPI")
"RTN","ECXLABN",95,0)
 .S ^TMP($J,"ECXP",ECXDFN)=ECNA_U_ECSN_U_ECXMPI
"RTN","ECXLABN",96,0)
 ;get date specific data
"RTN","ECXLABN",97,0)
 S X=$$INP^ECXUTL2(ECXDFN,ECXDATE),ECA=$P(X,U),ECMN=$P(X,U,2),ECTREAT=$P(X,U,3),ECXADMDT=$P(X,U,4)
"RTN","ECXLABN",98,0)
 S X=$$PRIMARY^ECXUTL2(ECXDFN,$P(ECXDATE,"."),ECPROF)
"RTN","ECXLABN",99,0)
 S ECPTTM=$P(X,U,1),ECPTPR=$P(X,U,2),ECCLAS=$P(X,U,3),ECPTNPI=$P(X,U,4)
"RTN","ECXLABN",100,0)
 S ECASPR=$P(X,U,5),ECCLAS2=$P(X,U,6),ECASNPI=$P(X,U,7)
"RTN","ECXLABN",101,0)
 Q
"RTN","ECXLABN",102,0)
 ;
"RTN","ECXLABN",103,0)
FILE ;file record
"RTN","ECXLABN",104,0)
 ;node0
"RTN","ECXLABN",105,0)
 ;facility^patient number^SSN (or equivalent)^name^in/out ECA^
"RTN","ECXLABN",106,0)
 ;day^accession area^abbreviation^test^urgency^treating spec^
"RTN","ECXLABN",107,0)
 ;location^provider and file^
"RTN","ECXLABN",108,0)
 ;movement number^file^time^workload code^primary care team^
"RTN","ECXLABN",109,0)
 ;primary care provider
"RTN","ECXLABN",110,0)
 ;node1
"RTN","ECXLABN",111,0)
 ;mpi^dss dept^provider npi^pc provider npi^pc prov person class^
"RTN","ECXLABN",112,0)
 ;assoc pc prov^assoc pc prov person class^assoc pc prov npi^
"RTN","ECXLABN",113,0)
 ;dom ECXDOM^observ pat ind ECXOBS^encounter num ECXENC^
"RTN","ECXLABN",114,0)
 ;ord stop code ECXORDST^ord date ECXORDDT^production division ECXPDIV
"RTN","ECXLABN",115,0)
 N DA,DIK
"RTN","ECXLABN",116,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXLABN",117,0)
 S ECODE=EC7_U_EC23_U_ECINST_U_ECIFN_U_ECSN_U_ECNA_U_ECA_U
"RTN","ECXLABN",118,0)
 S ECODE=ECODE_$$ECXDATE^ECXUTL(ECD,ECXYM)_U_ECACA_U_ECT_U_ECURG_U
"RTN","ECXLABN",119,0)
 S ECODE=ECODE_ECTREAT_U_ECLOC_U_ECDOC_U_ECMN_U_ECF_U_ECTM_U_ECWK_U
"RTN","ECXLABN",120,0)
 S ECODE=ECODE_ECPTTM_U_ECPTPR_U
"RTN","ECXLABN",121,0)
 ;(ECACA=acc area^abbreviation)
"RTN","ECXLABN",122,0)
 S ECODE1=ECXMPI_U_ECXDSSD_U_ECDOCNPI_U_ECPTNPI_U_ECCLAS_U_ECASPR_U
"RTN","ECXLABN",123,0)
 S ECODE1=ECODE1_ECCLAS2_U_ECASNPI_U_ECXDOM_U_ECXOBS_U_ECXENC_U
"RTN","ECXLABN",124,0)
 S ECODE1=ECODE1_ECXORDST_U_ECXORDDT_U_ECXPDIV
"RTN","ECXLABN",125,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1,ECRN=ECRN+1
"RTN","ECXLABN",126,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX1^DIK K DIK,DA
"RTN","ECXLABN",127,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S QFLG=1
"RTN","ECXLABN",128,0)
 Q
"RTN","ECXLABN",129,0)
 ;
"RTN","ECXLABN",130,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXLABN",131,0)
 S ECHEAD="LAB"
"RTN","ECXLABN",132,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXLABN",133,0)
 Q
"RTN","ECXLABN",134,0)
 ;
"RTN","ECXLABN",135,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXLABN",136,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"VER")
8.0^22
**END**
**END**
