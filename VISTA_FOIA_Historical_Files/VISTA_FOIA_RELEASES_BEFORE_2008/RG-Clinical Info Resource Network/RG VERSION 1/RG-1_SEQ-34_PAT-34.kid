Released RG*1*34 SEQ #34
Extracted from mail message
**KIDS**:RG*1.0*34^

**INSTALL NAME**
RG*1.0*34
"BLD",1945,0)
RG*1.0*34^CLINICAL INFO RESOURCE NETWORK^0^3040419^y
"BLD",1945,1,0)
^^3^3^3040121^
"BLD",1945,1,1,0)
This patch addresses NOIS HAM-1203-22022 'User name backwards on MPI 
"BLD",1945,1,2,0)
bulletin'.  The Remote Sensitivity Indicated bulletin was displaying the 
"BLD",1945,1,3,0)
<first name,last name> instead of <last name,first name>.
"BLD",1945,4,0)
^9.64PA^^
"BLD",1945,"KRN",0)
^9.67PA^8989.52^19
"BLD",1945,"KRN",.4,0)
.4
"BLD",1945,"KRN",.401,0)
.401
"BLD",1945,"KRN",.402,0)
.402
"BLD",1945,"KRN",.403,0)
.403
"BLD",1945,"KRN",.5,0)
.5
"BLD",1945,"KRN",.84,0)
.84
"BLD",1945,"KRN",3.6,0)
3.6
"BLD",1945,"KRN",3.8,0)
3.8
"BLD",1945,"KRN",9.2,0)
9.2
"BLD",1945,"KRN",9.8,0)
9.8
"BLD",1945,"KRN",9.8,"NM",0)
^9.68A^7^7
"BLD",1945,"KRN",9.8,"NM",1,0)
RGADTP^^0^B42630647
"BLD",1945,"KRN",9.8,"NM",2,0)
RGRSWPT^^1^
"BLD",1945,"KRN",9.8,"NM",3,0)
RGRSWRPT^^1^
"BLD",1945,"KRN",9.8,"NM",4,0)
RGVCCMR2^^0^B37731665
"BLD",1945,"KRN",9.8,"NM",5,0)
RGPRSSN^^0^B28848862
"BLD",1945,"KRN",9.8,"NM",6,0)
RGMTMONT^^0^B37393019
"BLD",1945,"KRN",9.8,"NM",7,0)
RGADT1^^0^B40790172
"BLD",1945,"KRN",9.8,"NM","B","RGADT1",7)

"BLD",1945,"KRN",9.8,"NM","B","RGADTP",1)

"BLD",1945,"KRN",9.8,"NM","B","RGMTMONT",6)

"BLD",1945,"KRN",9.8,"NM","B","RGPRSSN",5)

"BLD",1945,"KRN",9.8,"NM","B","RGRSWPT",2)

"BLD",1945,"KRN",9.8,"NM","B","RGRSWRPT",3)

"BLD",1945,"KRN",9.8,"NM","B","RGVCCMR2",4)

"BLD",1945,"KRN",19,0)
19
"BLD",1945,"KRN",19.1,0)
19.1
"BLD",1945,"KRN",101,0)
101
"BLD",1945,"KRN",409.61,0)
409.61
"BLD",1945,"KRN",771,0)
771
"BLD",1945,"KRN",870,0)
870
"BLD",1945,"KRN",8989.51,0)
8989.51
"BLD",1945,"KRN",8989.52,0)
8989.52
"BLD",1945,"KRN",8994,0)
8994
"BLD",1945,"KRN","B",.4,.4)

"BLD",1945,"KRN","B",.401,.401)

"BLD",1945,"KRN","B",.402,.402)

"BLD",1945,"KRN","B",.403,.403)

"BLD",1945,"KRN","B",.5,.5)

"BLD",1945,"KRN","B",.84,.84)

"BLD",1945,"KRN","B",3.6,3.6)

"BLD",1945,"KRN","B",3.8,3.8)

"BLD",1945,"KRN","B",9.2,9.2)

"BLD",1945,"KRN","B",9.8,9.8)

"BLD",1945,"KRN","B",19,19)

"BLD",1945,"KRN","B",19.1,19.1)

"BLD",1945,"KRN","B",101,101)

"BLD",1945,"KRN","B",409.61,409.61)

"BLD",1945,"KRN","B",771,771)

"BLD",1945,"KRN","B",870,870)

"BLD",1945,"KRN","B",8989.51,8989.51)

"BLD",1945,"KRN","B",8989.52,8989.52)

"BLD",1945,"KRN","B",8994,8994)

"BLD",1945,"QUES",0)
^9.62^^
"BLD",1945,"REQB",0)
^9.611^3^3
"BLD",1945,"REQB",1,0)
RG*1.0*20^2
"BLD",1945,"REQB",2,0)
RG*1.0*19^2
"BLD",1945,"REQB",3,0)
RG*1.0*31^2
"BLD",1945,"REQB","B","RG*1.0*19",2)

"BLD",1945,"REQB","B","RG*1.0*20",1)

"BLD",1945,"REQB","B","RG*1.0*31",3)

"MBREQ")
0
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
34^3040419
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3040419
"PKG",272,22,1,"PAH",1,1,1,0)
This patch addresses NOIS HAM-1203-22022 'User name backwards on MPI 
"PKG",272,22,1,"PAH",1,1,2,0)
bulletin'.  The Remote Sensitivity Indicated bulletin was displaying the 
"PKG",272,22,1,"PAH",1,1,3,0)
<first name,last name> instead of <last name,first name>.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
7
"RTN","RGADT1")
0^7^B40790172
"RTN","RGADT1",1,0)
RGADT1 ;HIRMFO/GJC-BUILD ADT MESSAGES (A01/A03) ;09/21/99
"RTN","RGADT1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**4,14,17,27,28,31,34**;30 Apr 99
"RTN","RGADT1",3,0)
 Q  ; quit if called from the top
"RTN","RGADT1",4,0)
 ;
"RTN","RGADT1",5,0)
EN ; entry point to build/transmit ADT messages
"RTN","RGADT1",6,0)
 ; Messages built by this software are fired off by server protocols:
"RTN","RGADT1",7,0)
 ; RG ADT-A01 SERVER -or- RG ADT-A03 SERVER
"RTN","RGADT1",8,0)
 ;
"RTN","RGADT1",9,0)
 ; This code is called from the RG ADT INPATIENT ENCOUNTER DRIVER &
"RTN","RGADT1",10,0)
 ; RG ADT OUTPATIENT ENCOUNTER DRIVER protocols.
"RTN","RGADT1",11,0)
 ;
"RTN","RGADT1",12,0)
 ; RG ADT OUTPATIENT ENCOUNTER DRIVER is an item protocol under the
"RTN","RGADT1",13,0)
 ; SDAM APPOINTMENTS EVENTS protocol & RG ADT INPATIENT ENCOUNTER DRIVER
"RTN","RGADT1",14,0)
 ; hangs off of the DGPM MOVEMENT EVENTS protocol.
"RTN","RGADT1",15,0)
 ;
"RTN","RGADT1",16,0)
 ; RG ADT OUTPATIENT ENCOUNTER DRIVER hangs off of SDAM APPOINTMENTS
"RTN","RGADT1",17,0)
 ; EVENTS because of DBIA: 1320; RG ADT INPATIENT ENCOUNTER DRIVER
"RTN","RGADT1",18,0)
 ; hangs off of DGPM MOVEMENT EVENTS because of DBIA: 1181.
"RTN","RGADT1",19,0)
 ;
"RTN","RGADT1",20,0)
 ; Integration Agreements (IAs) utilized in this application:
"RTN","RGADT1",21,0)
 ; #1181-subscribers for the DGPM MOVEMENT EVENTS event driver
"RTN","RGADT1",22,0)
 ; #1320-subscribers for the SDAM APPOINTMENT EVENTS event driver
"RTN","RGADT1",23,0)
 ; #2070-check for a national ICN 1st piece, "MPI" node (global read)
"RTN","RGADT1",24,0)
 ; #2161-INIT^HLFNC2
"RTN","RGADT1",25,0)
 ; #2164-GENERATE^HLMA
"RTN","RGADT1",26,0)
 ; #2171-$$WHAT^XUAF4 (Name_"^"_Station Number, we're after Station #)
"RTN","RGADT1",27,0)
 ; #2541-$$KSP^XUPARAM (facility ien, file 4)
"RTN","RGADT1",28,0)
 ; #2624-$$SEND^VAFHUTL()
"RTN","RGADT1",29,0)
 ; #3015-PID segment generation (CIRN PD)
"RTN","RGADT1",30,0)
 ; #3016-EVN segment generation (CIRN PD)
"RTN","RGADT1",31,0)
 ; #3017-PD1 segment generator (CIRN PD)
"RTN","RGADT1",32,0)
 ; #3018-PV1 segment generator (CIRN PD)
"RTN","RGADT1",33,0)
 ; #3072-assign a local ICN to a patient
"RTN","RGADT1",34,0)
 ; #3630-BLDEVN^VAFCQRY, BLDPD1^VAFCQRY & BLDPID^VAFCQRY
"RTN","RGADT1",35,0)
 ; #2988-FILE^VAFCTFU
"RTN","RGADT1",36,0)
 ;
"RTN","RGADT1",37,0)
 ; I $D(RGDG101) then we know we've dropped into this software
"RTN","RGADT1",38,0)
 ; from the DGPM MOVEMENT EVENTS protocol (RG ADT INPATIENT
"RTN","RGADT1",39,0)
 ; ENCOUNTER DRIVER)
"RTN","RGADT1",40,0)
 ;
"RTN","RGADT1",41,0)
 ; Note: DFN is a supported variable in the case of admissions and
"RTN","RGADT1",42,0)
 ; discharges within the Registration package. (part of the discovery
"RTN","RGADT1",43,0)
 ; in the development of RG*1.0*14)
"RTN","RGADT1",44,0)
 ;
"RTN","RGADT1",45,0)
 ; first check if HL7 2.3 messaging has been disabled.  DBIA: 2624
"RTN","RGADT1",46,0)
 I '$P($$SEND^VAFHUTL(),"^",2) Q
"RTN","RGADT1",47,0)
 S RGOK=0,RGDATE=""
"RTN","RGADT1",48,0)
 I $D(RGDG101) D
"RTN","RGADT1",49,0)
 . I $G(DFN)'=+$G(DFN) Q  ; DFN must be valid
"RTN","RGADT1",50,0)
 .; if an national ICN is missing, assign a local then quit
"RTN","RGADT1",51,0)
 . I '$P($G(^DPT(DFN,"MPI")),"^") S RGLOCAL=$$ICNLC^MPIF001(DFN) Q
"RTN","RGADT1",52,0)
 . Q:$$IFLOCAL^MPIF001(DFN)  ; IA 2701, patient has local icn, quit
"RTN","RGADT1",53,0)
 . N %,VAERR,VAIP
"RTN","RGADT1",54,0)
 . S VAIP("D")="LAST" D IN5^VADPT ; dfn should be defined at this point
"RTN","RGADT1",55,0)
 . S RGTYPE=+$G(VAIP(2)) ; RGTYPE=movement type
"RTN","RGADT1",56,0)
 . I RGTYPE'=1&(RGTYPE'=3) Q  ; admission or discharges only
"RTN","RGADT1",57,0)
 . S RGENVR=$S(RGTYPE=1:"A1",1:"A2") ; A1=admission, A2=discharge
"RTN","RGADT1",58,0)
 . S RGDATE=$P($G(VAIP(3)),"^"),RGMOV=$G(VAIP(1))
"RTN","RGADT1",59,0)
 . ; RGDATE=movement date/time, RGMOV=ien #405
"RTN","RGADT1",60,0)
 . S:RGDATE]"" RGOK=1
"RTN","RGADT1",61,0)
 . Q
"RTN","RGADT1",62,0)
 ;
"RTN","RGADT1",63,0)
 ; I $D(RGSD101) then we know we've dropped into this software
"RTN","RGADT1",64,0)
 ; from the SDAM APPOINTMENT EVENTS protocol (RG ADT OUTPATIENT
"RTN","RGADT1",65,0)
 ; ENCOUNTER DRIVER)
"RTN","RGADT1",66,0)
 ;
"RTN","RGADT1",67,0)
 ; Check SDAMEVT for values between five and nine inclusive.  See if
"RTN","RGADT1",68,0)
 ; this particular outpatient encounter has a status of CHECKED OUT.
"RTN","RGADT1",69,0)
 ; gjc@Hines OI for patch 14
"RTN","RGADT1",70,0)
 ;
"RTN","RGADT1",71,0)
 ; Note: DFN is not a supported variable in the case of clinic
"RTN","RGADT1",72,0)
 ; appointments and workload crediting for count clinics within the
"RTN","RGADT1",73,0)
 ; Scheduling package. (part of the discovery in the development of
"RTN","RGADT1",74,0)
 ; RG*1.0*14)
"RTN","RGADT1",75,0)
 ;
"RTN","RGADT1",76,0)
 ; check-out, stop code add/edit, disp add/edit?
"RTN","RGADT1",77,0)
 N I
"RTN","RGADT1",78,0)
 I $D(RGSD101),($D(SDAMEVT))#2 N DFN D
"RTN","RGADT1",79,0)
 . ; Note: DFN is unstable; it's up to us to define it...
"RTN","RGADT1",80,0)
 . ;chk-out, stop code add, stop code change, disp add & disp change
"RTN","RGADT1",81,0)
 . I SDAMEVT<5!(SDAMEVT>9) Q
"RTN","RGADT1",82,0)
 . S RGTYPE=SDAMEVT,RGENVR="A3"
"RTN","RGADT1",83,0)
 . N RGSDOE,RGPARSE,RGPROC,RGTMP S RGPROC=0
"RTN","RGADT1",84,0)
 . F  S RGPROC=$O(^TMP("SDEVT",$J,SDHDL,RGPROC)) Q:'RGPROC  D
"RTN","RGADT1",85,0)
 .. S RGSDOE=0
"RTN","RGADT1",86,0)
 .. F  S RGSDOE=$O(^TMP("SDEVT",$J,SDHDL,RGPROC,"SDOE",RGSDOE)) Q:'RGSDOE  D
"RTN","RGADT1",87,0)
 ... S RGSDOE(0)=$G(^TMP("SDEVT",$J,SDHDL,RGPROC,"SDOE",RGSDOE,0,"AFTER"))
"RTN","RGADT1",88,0)
 ... ; Note: RGSDOE(0)=zero node of 409.68, DFN is the second piece 
"RTN","RGADT1",89,0)
 ... S DFN=$P(RGSDOE(0),"^",2) Q:'DFN  ; DFN must exist
"RTN","RGADT1",90,0)
 ... ; ignore current inpatients
"RTN","RGADT1",91,0)
 ... Q:$L($G(^DPT(DFN,.1)))  ; ward location check IA: 10035
"RTN","RGADT1",92,0)
 ...; if an national ICN is missing, assign a local then quit
"RTN","RGADT1",93,0)
 ... I '$P($G(^DPT(DFN,"MPI")),"^") S RGLOCAL=$$ICNLC^MPIF001(DFN) Q
"RTN","RGADT1",94,0)
 ... Q:$$IFLOCAL^MPIF001(DFN)  ; IA 2701, patient has local icn, quit
"RTN","RGADT1",95,0)
 ... K RGPARSE D PARSE^SDOE(.RGSDOE,"EXTERNAL","RGPARSE")
"RTN","RGADT1",96,0)
 ... I $G(RGPARSE(.12))="CHECKED OUT" S RGTMP=$P(RGSDOE(0),U)
"RTN","RGADT1",97,0)
 ... S:$G(RGTMP)>RGDATE RGDATE=RGTMP
"RTN","RGADT1",98,0)
 ... Q
"RTN","RGADT1",99,0)
 .. Q
"RTN","RGADT1",100,0)
 . S:$G(RGDATE)]"" RGOK=1
"RTN","RGADT1",101,0)
 . Q
"RTN","RGADT1",102,0)
 ; S ^TMP("RGTRACE",$J)=1
"RTN","RGADT1",103,0)
 I 'RGOK K RGLOCAL,RGTYPE,RGMOV,RGDATE,RGENVR,RGOK Q  ; quit if not A01 or A03
"RTN","RGADT1",104,0)
 I '($G(DGQUIET)) S:$D(^TMP("RGTRACE",$J)) RGTRACE=1
"RTN","RGADT1",105,0)
 N RGSITE S RGSITE=+$$SITE^VASITE
"RTN","RGADT1",106,0)
 ;before updating and broadcasting check to see if the date and/or event changed
"RTN","RGADT1",107,0)
 N LIST,X,OUT,RGCHNG,RGDLT,RGEVN D TFL^VAFCTFU1(.LIST,DFN) S (RGCHNG,OUT,X)=0 F  S X=$O(LIST(X)) Q:'X!(OUT=1)  D
"RTN","RGADT1",108,0)
 . S RGDATE=$P(RGDATE,"."),RGDLT=$P(LIST(X),"^",3),RGDLT=$P(RGDLT,"."),RGEVN=$P(LIST(X),"^",4)
"RTN","RGADT1",109,0)
 . I $P(LIST(X),"^")=$P($$SITE^VASITE,"^",3) S OUT=1 D
"RTN","RGADT1",110,0)
 .. I RGDATE'=RGDLT D  Q
"RTN","RGADT1",111,0)
 ... I RGDATE>RGDLT S RGCHNG=1
"RTN","RGADT1",112,0)
 .. I RGDATE=RGDLT D
"RTN","RGADT1",113,0)
 .. I $E(RGENVR,2)'=RGEVN D
"RTN","RGADT1",114,0)
 ... I RGENVR="A3" S RGCHNG=0
"RTN","RGADT1",115,0)
 ... I RGENVR="A1" S RGCHNG=1
"RTN","RGADT1",116,0)
 ... I RGENVR="A2" S RGCHNG=1
"RTN","RGADT1",117,0)
 ;if no change in DLT or Event Reason quit
"RTN","RGADT1",118,0)
 Q:RGCHNG=0
"RTN","RGADT1",119,0)
 D FILE^VAFCTFU(DFN,RGSITE_"^"_$G(RGDATE)_"^"_$G(RGENVR),1)
"RTN","RGADT1",120,0)
 ;do FILE^VAFCTFU to update DLT and event reason
"RTN","RGADT1",121,0)
 I $D(RGTRACE) D EVENT,EXIT Q
"RTN","RGADT1",122,0)
 N ZTDESC,ZTRTN,ZTSAVE,ZTIO,ZTDTH
"RTN","RGADT1",123,0)
 S ZTDESC="CIRN HL7 ADT-"_$S(RGTYPE=1:"A01",1:"A03")_" Messaging"
"RTN","RGADT1",124,0)
 S ZTRTN="EVENT^RGADT1",ZTIO="",ZTDTH=$H
"RTN","RGADT1",125,0)
 F I="DFN","RGDATE","RGTYPE","RGENVR" S ZTSAVE(I)=""
"RTN","RGADT1",126,0)
 ; check for $D of RGDG101 & RGSD101 need to know protocol executed
"RTN","RGADT1",127,0)
 S:$D(RGDG101) ZTSAVE("RGDG101")="" S:$D(RGSD101) ZTSAVE("RGSD101")=""
"RTN","RGADT1",128,0)
 S:$D(RGMOV) ZTSAVE("RGMOV")="" ; defined for admissions & discharges
"RTN","RGADT1",129,0)
 S:$D(SDOE) ZTSAVE("SDOE")="" ; file ien: 409.68, clinic check out
"RTN","RGADT1",130,0)
 D ^%ZTLOAD,EXIT
"RTN","RGADT1",131,0)
 K DGQUIET
"RTN","RGADT1",132,0)
 Q
"RTN","RGADT1",133,0)
 ;
"RTN","RGADT1",134,0)
EVENT ; build the HL7 message
"RTN","RGADT1",135,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGADT1",136,0)
 S RGEVT=$S(RGTYPE=1:"A01",1:"A03") K HL
"RTN","RGADT1",137,0)
 D INIT^HLFNC2("RG ADT-"_RGEVT_" 2.4 SERVER",.HL)
"RTN","RGADT1",138,0)
 I $G(HL) Q  ; error
"RTN","RGADT1",139,0)
 D BUILD
"RTN","RGADT1",140,0)
 D GENERATE^HLMA("RG ADT-"_RGEVT_" 2.4 SERVER","LM",1,.RGRSLT,"",.HL)
"RTN","RGADT1",141,0)
 D KILL^HLTRANS
"RTN","RGADT1",142,0)
 K HLA("HLS"),RGDATE,RGDG101,RGENVR,RGEVT,RGSD101,RGTYPE
"RTN","RGADT1",143,0)
 Q
"RTN","RGADT1",144,0)
EXIT ; kill and quit
"RTN","RGADT1",145,0)
 K ^TMP("RGTRACE",$J),RGDATE,RGENVR,RGEVT,RGOK,RGLOCAL,RGMOV,RGPAT
"RTN","RGADT1",146,0)
 K RGRSLT,RGFSTR,RGTRACE,RGTYPE
"RTN","RGADT1",147,0)
 Q
"RTN","RGADT1",148,0)
BUILD ; build the ADT message
"RTN","RGADT1",149,0)
 ; EVN segment
"RTN","RGADT1",150,0)
 N CNT,ERR,EVN,RGCNT,SEQ
"RTN","RGADT1",151,0)
 S RGCNT=1
"RTN","RGADT1",152,0)
 D BLDEVN^VAFCQRY(DFN,"1,2,4,5,6,7",.EVN,.HL,$G(HL("ETN")))
"RTN","RGADT1",153,0)
 S HLA("HLS",RGCNT)=$G(EVN(1)) S RGCNT=RGCNT+1
"RTN","RGADT1",154,0)
 N PID S SEQ="ALL" D BLDPID^VAFCQRY(DFN,1,.SEQ,.PID,.HL,.ERR) S HLA("HLS",RGCNT)=PID(1) S X=1,CNT=1 F  S X=$O(PID(X)) Q:'X  I $D(PID(X)) S HLA("HLS",RGCNT,CNT)=PID(X),CNT=CNT+1
"RTN","RGADT1",155,0)
 S RGCNT=RGCNT+1
"RTN","RGADT1",156,0)
 ; PD1 segment
"RTN","RGADT1",157,0)
 N PD1
"RTN","RGADT1",158,0)
 S SEQ="3" D BLDPD1^VAFCQRY(DFN,.SEQ,.PD1,.HL,.ERR) S HLA("HLS",RGCNT)=PD1(1)
"RTN","RGADT1",159,0)
 S RGCNT=RGCNT+1
"RTN","RGADT1",160,0)
 ; PV1 segment
"RTN","RGADT1",161,0)
 S RGFSTR="2,3,4,5,"_$$COMMANUM(7,45)
"RTN","RGADT1",162,0)
 ;for admission/discharges (registration)
"RTN","RGADT1",163,0)
 I RGTYPE=1!(RGTYPE=3) S HLA("HLS",4)=$$IN^VAFHLPV1(DFN,RGDATE,RGFSTR,RGMOV,"","")
"RTN","RGADT1",164,0)
 ;for scheduling events: checkout
"RTN","RGADT1",165,0)
 I RGTYPE'=1&(RGTYPE'=3) S HLA("HLS",4)=$$EN^VAFHLPV1("",,RGFSTR,,HL("Q"),HL("FS"))
"RTN","RGADT1",166,0)
 S HLA("HLS",4)=$$FAC(HLA("HLS",4))
"RTN","RGADT1",167,0)
 ; adding ZPD segment for POW Status - patch P
"RTN","RGADT1",168,0)
 S HLA("HLS",5)=$$EN^VAFHLZPD(DFN,17)
"RTN","RGADT1",169,0)
 Q
"RTN","RGADT1",170,0)
COMMANUM(FROM,TO) ;Build comma seperated list of numbers
"RTN","RGADT1",171,0)
 ;Input  : FROM - Starting number (default = 1)
"RTN","RGADT1",172,0)
 ;                   TO - Ending number (default = FROM)
"RTN","RGADT1",173,0)
 ;Output : Comma separated list of numbers between FROM and TO
"RTN","RGADT1",174,0)
 ;             (Ex: 1,2,3)
"RTN","RGADT1",175,0)
 ;Notes  : Call assumes FROM <= TO
"RTN","RGADT1",176,0)
 ;             copied from COMMANUM^VAFCADT2
"RTN","RGADT1",177,0)
 ;
"RTN","RGADT1",178,0)
 S FROM=$G(FROM) S:(FROM="") FROM=1
"RTN","RGADT1",179,0)
 S TO=$G(TO) S:(TO="") TO=FROM
"RTN","RGADT1",180,0)
 N OUTPUT,X
"RTN","RGADT1",181,0)
 S OUTPUT=FROM
"RTN","RGADT1",182,0)
 F X=(FROM+1):1:TO S OUTPUT=(OUTPUT_","_X)
"RTN","RGADT1",183,0)
 Q OUTPUT
"RTN","RGADT1",184,0)
 ;
"RTN","RGADT1",185,0)
FAC(X) ; set facility information, in the form of the Station Number, into
"RTN","RGADT1",186,0)
 ; PV1(3).
"RTN","RGADT1",187,0)
 ; input: the entire PV1 segment
"RTN","RGADT1",188,0)
 ; yield: updated PV1 segment; PV1(3) has facility information (Sta. #)
"RTN","RGADT1",189,0)
 N Y0,Y1 S Y0=$E(HL("ECH"),$L(HL("ECH")))_$$WHAT^XUAF4(+$$KSP^XUPARAM("INST"),99)
"RTN","RGADT1",190,0)
 S Y1=$P(X,HL("FS"),4),$P(Y1,$E(HL("ECH")),4)=Y0,$P(X,HL("FS"),4)=Y1
"RTN","RGADT1",191,0)
 Q X
"RTN","RGADTP")
0^1^B42630647
"RTN","RGADTP",1,0)
RGADTP ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS ;5/28/02
"RTN","RGADTP",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**26,27,20,34**;30 Apr 99
"RTN","RGADTP",3,0)
 ;
"RTN","RGADTP",4,0)
 ;Reference to BLDEVN^VAFCQRY and BLDPID^VAFCQRY supported by IA #3630
"RTN","RGADTP",5,0)
 ;Reference to $$SEND2^VAFCUTL1 supported by IA #2779
"RTN","RGADTP",6,0)
 ;
"RTN","RGADTP",7,0)
INIT ;
"RTN","RGADTP",8,0)
 N RGER,RGSITE,ARRAY,MSH,RGLOCAL,RGEVNT,REP,DIC,DR,DIE,DA,DLAYGO
"RTN","RGADTP",9,0)
 S RGER=""
"RTN","RGADTP",10,0)
 D IN
"RTN","RGADTP",11,0)
 D PROCIN
"RTN","RGADTP",12,0)
 D GENACK
"RTN","RGADTP",13,0)
 Q
"RTN","RGADTP",14,0)
PROC ;processing entry point
"RTN","RGADTP",15,0)
 N HLA,RGADT,PV1,DIC,ARRAY,RGEVNT,RGLOCAL,REP,ICN,RGSITE
"RTN","RGADTP",16,0)
 S RGEVNT=HL("ETN")
"RTN","RGADTP",17,0)
 I $G(HL("MID"))'="" S RGADT=HL("MID")
"RTN","RGADTP",18,0)
 I $G(HL("MID"))="" S RGADT=999
"RTN","RGADTP",19,0)
 Q:+$$SEND2^VAFCUTL1(DFN,"T")
"RTN","RGADTP",20,0)
 D IN
"RTN","RGADTP",21,0)
 S ICN=$G(ARRAY("ICN"))
"RTN","RGADTP",22,0)
 ;S ICN=$$GETICN^MPIF001(DFN)
"RTN","RGADTP",23,0)
 I +$G(ICN)<1 Q  ;quit if no ICN
"RTN","RGADTP",24,0)
 I $E($G(ICN),1,3)=$P($$SITE^VASITE,"^",3) Q  ;quit if ICN is a local
"RTN","RGADTP",25,0)
 S ZTSAVE("DFN")="",ZTSAVE("RGEVNT")="",ZTSAVE("HLA(""HLS"",")="",ZTRTN="SEND^RGADTPC",ZTDESC="Sending HL7 Patient Update...",ZTIO="RG QUEUE",ZTDTH=$H D ^%ZTLOAD
"RTN","RGADTP",26,0)
 K ZTSAVE,ZTRTN,ZTDESC,ZTIO,ZTDTH
"RTN","RGADTP",27,0)
 Q
"RTN","RGADTP",28,0)
IN ;Process in the ADT A04/A08 (routing logic)
"RTN","RGADTP",29,0)
 N RGI,MSG,RG,SG,DFN,EVN,SITE,RGC,RGJ,DIC,PV1,PID,COMP
"RTN","RGADTP",30,0)
 ;set local flag to indicate the processing of an outbound for reformating
"RTN","RGADTP",31,0)
 S REP=$E(HL("ECH"),2)
"RTN","RGADTP",32,0)
 S COMP=$E(HL("ECH"),1)
"RTN","RGADTP",33,0)
 I $P($G(HL("SAF")),COMP)=$P($$SITE^VASITE,"^",3) S RGLOCAL=1
"RTN","RGADTP",34,0)
 I $P($G(HL("SAF")),COMP)'=$P($$SITE^VASITE,"^",3) S RGLOCAL=0
"RTN","RGADTP",35,0)
 S RGC=$E($G(HL("ECH")),1)
"RTN","RGADTP",36,0)
 F RGI=1:1 X HLNEXT Q:HLQUIT'>0  S MSG=HLNODE,SG=$E(HLNODE,1,3) D
"RTN","RGADTP",37,0)
 . S RGJ=0 F  S RGJ=$O(HLNODE(RGJ)) Q:'RGJ  S MSG(RGJ)=HLNODE(RGJ)
"RTN","RGADTP",38,0)
 . D:SG?2A1(1A,1N) PICK
"RTN","RGADTP",39,0)
 ;if message MSH sending facility matches the PID assigning authority update
"RTN","RGADTP",40,0)
QUIT Q
"RTN","RGADTP",41,0)
ROUTE ;
"RTN","RGADTP",42,0)
 N RGERR
"RTN","RGADTP",43,0)
 I $G(RGEVNT)="" S RGEVNT=$G(HL("ETN"))
"RTN","RGADTP",44,0)
 N MPI S MPI=$$MPILINK^MPIFAPI() D
"RTN","RGADTP",45,0)
 . I $P($G(MPI),U)'=-1 S HLL("LINKS",1)="RG ADT-"_HL("ETN")_" 2.4 CLIENT^"_MPI
"RTN","RGADTP",46,0)
 . I $P($G(MPI),U)=-1 D
"RTN","RGADTP",47,0)
 .. N RGLOG,RGMTXT
"RTN","RGADTP",48,0)
 .. D START^RGHLLOG(HLMTIEN,"","")
"RTN","RGADTP",49,0)
 .. S RGMTXT="for DFN#"_$G(DFN)
"RTN","RGADTP",50,0)
 .. D EXC^RGHLLOG(224,"No MPI link identified"_RGMTXT,$G(DFN)) S RGERR=1
"RTN","RGADTP",51,0)
 I $G(RGERR)'=1 S ^XTMP("RG"_HL("ETN")_"%"_DFN,0)=$$FMADD^XLFDT(DT,5)_"^"_DT_"^"_"RG"_HL("ETN")_" msg to MPI for DFN "_DFN S ^XTMP("RG"_HL("ETN")_"%"_DFN,"MPI",0)="A"
"RTN","RGADTP",52,0)
 Q
"RTN","RGADTP",53,0)
RESP ;
"RTN","RGADTP",54,0)
 N RGER,RGSITE,ARRAY,MSH,RGLOCAL,RGEVNT
"RTN","RGADTP",55,0)
 N RGI,MSG,RG,SG,DFN,EVN,SITE,RGC,RGJ,DIC,PV1,PID
"RTN","RGADTP",56,0)
 D IN
"RTN","RGADTP",57,0)
 Q
"RTN","RGADTP",58,0)
PICK ;check routine for segment entry point
"RTN","RGADTP",59,0)
 I $T(@SG)]"" D @SG
"RTN","RGADTP",60,0)
 I $T(@SG)="" Q
"RTN","RGADTP",61,0)
 Q
"RTN","RGADTP",62,0)
MSA ;;
"RTN","RGADTP",63,0)
 ;process the MSA segment
"RTN","RGADTP",64,0)
 N ARRAY,CNT,DFN,EXIT,HLCOMP,RGAA,RGERR,RGEVNT,RGMSG,RETURN,RGX,RGY
"RTN","RGADTP",65,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",66,0)
 S RGAA=MSG
"RTN","RGADTP",67,0)
 S EXIT=0
"RTN","RGADTP",68,0)
 S RGMSG=$P(RGAA,HL("FS"),3)
"RTN","RGADTP",69,0)
 S RGERR=$P(RGAA,HL("FS"),4)
"RTN","RGADTP",70,0)
 S RGMSG=$$MSG^HLCSUTL(RGMSG,"RETURN(1)")
"RTN","RGADTP",71,0)
 K RGMSG
"RTN","RGADTP",72,0)
 S CNT=1,RGX=0 F  S RGX=$O(RETURN(1,RGX)) Q:'RGX!(EXIT=1)  D
"RTN","RGADTP",73,0)
 . I RETURN(1,RGX)'="" D
"RTN","RGADTP",74,0)
 .. I $D(RGMSG) S RGMSG(CNT)=RETURN(1,RGX),CNT=CNT+1
"RTN","RGADTP",75,0)
 .. I '$D(RGMSG) S RGMSG=RETURN(1,RGX),RGY=RGX
"RTN","RGADTP",76,0)
 . I RETURN(1,RGX)="" D  S CNT=1 K RGMSG
"RTN","RGADTP",77,0)
 .. I $E(RETURN(1,RGY),1,3)="MSH" D MSH
"RTN","RGADTP",78,0)
 .. I $E(RETURN(1,RGY),1,3)="PID" D PIDP^RGADTP1(.RGMSG,.ARRAY,.HL) S EXIT=1
"RTN","RGADTP",79,0)
 S DFN=$G(ARRAY("DFN"))
"RTN","RGADTP",80,0)
 I $D(^XTMP("RG"_HL("ETN")_"%"_DFN,0)) K ^XTMP("RG"_HL("ETN")_"%"_DFN)
"RTN","RGADTP",81,0)
 Q
"RTN","RGADTP",82,0)
MSH ;;
"RTN","RGADTP",83,0)
 S MSH=1
"RTN","RGADTP",84,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",85,0)
 I 'RGLOCAL S RGC=$E(HL("ECH"),1)
"RTN","RGADTP",86,0)
 S RGSITE=$P($P(MSG,HL("FS"),4),RGC)
"RTN","RGADTP",87,0)
 S RGEVNT=$P($P(MSG,HL("FS"),9),RGC,2)
"RTN","RGADTP",88,0)
 Q
"RTN","RGADTP",89,0)
EVN ;;
"RTN","RGADTP",90,0)
 N CNT,ERR
"RTN","RGADTP",91,0)
 S EVN=RGI
"RTN","RGADTP",92,0)
 I RGLOCAL S (EVN(1),HLA("HLS",RGI))=MSG
"RTN","RGADTP",93,0)
 I 'RGLOCAL D
"RTN","RGADTP",94,0)
 .S ARRAY("EVR")=$P(MSG,HL("FS"),2)
"RTN","RGADTP",95,0)
 .S ARRAY("DLT")=$$FMDATE^HLFNC($P(MSG,HL("FS"),3))
"RTN","RGADTP",96,0)
 .S ARRAY("EVNAME")=$$FMNAME^XLFNAME($P(MSG,HL("FS"),2),"",$E(HL("ECH"),1))
"RTN","RGADTP",97,0)
 .S ARRAY("SENDING SITE")=$P(MSG,HL("FS"),8)
"RTN","RGADTP",98,0)
 Q
"RTN","RGADTP",99,0)
EVNP ;
"RTN","RGADTP",100,0)
 N EVNX
"RTN","RGADTP",101,0)
 I $G(DFN)'="" D BLDEVN^VAFCQRY(DFN,"1,2,4,5,6,7",.EVN,.HL,$G(HL("ETN")),.ERR) S CNT=0,EVNX=0 F  S EVNX=$O(EVN(EVNX)) Q:'EVNX  D
"RTN","RGADTP",102,0)
 . I CNT>0 S HLA("HLS",EVN,CNT)=EVN(EVNX),CNT=CNT+1
"RTN","RGADTP",103,0)
 . I CNT'>0 S HLA("HLS",EVN)=EVN(EVNX),CNT=CNT+1
"RTN","RGADTP",104,0)
 Q
"RTN","RGADTP",105,0)
PID ;;
"RTN","RGADTP",106,0)
 N CNT,PIDX
"RTN","RGADTP",107,0)
 I RGLOCAL D
"RTN","RGADTP",108,0)
 .N HLCOMP S HLCOMP=$E(HL("ECH"),1)
"RTN","RGADTP",109,0)
 .S HLA("HLS",RGI)=MSG
"RTN","RGADTP",110,0)
 .S DFN=+$P(MSG,HL("FS"),4)
"RTN","RGADTP",111,0)
 .D EVNP
"RTN","RGADTP",112,0)
 .D BLDPID^VAFCQRY(DFN,1,"ALL",.PID,.HL)
"RTN","RGADTP",113,0)
 .;get Primary ICN value in the PID segment
"RTN","RGADTP",114,0)
 .S ARRAY("ICN")=+$P($P(PID(1),HL("FS"),4),HLCOMP)
"RTN","RGADTP",115,0)
 .S CNT=0,PIDX=0 F  S PIDX=$O(PID(PIDX)) Q:'PIDX  D
"RTN","RGADTP",116,0)
 .. I CNT>0 S HLA("HLS",RGI,CNT)=PID(PIDX),CNT=CNT+1
"RTN","RGADTP",117,0)
 .. I CNT'>0 S HLA("HLS",RGI)=PID(PIDX),CNT=CNT+1
"RTN","RGADTP",118,0)
 I 'RGLOCAL D PIDP^RGADTP1(.MSG,.ARRAY,.HL)
"RTN","RGADTP",119,0)
 Q
"RTN","RGADTP",120,0)
PD1 ;;
"RTN","RGADTP",121,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",122,0)
 I 'RGLOCAL S (ARRAY(991.03),ARRAY("CMOR"))=$P($P(MSG,HL("FS"),4),RGC)
"RTN","RGADTP",123,0)
 Q
"RTN","RGADTP",124,0)
PV1 ;;
"RTN","RGADTP",125,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",126,0)
 Q
"RTN","RGADTP",127,0)
OBX ;;
"RTN","RGADTP",128,0)
 N COMP S COMP=$E(HL("ECH"),1)
"RTN","RGADTP",129,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",130,0)
 I 'RGLOCAL D:$$FREE^RGRSPARS($P($P(MSG,HL("FS"),4),RGC,2))="SECURITY LEVEL"
"RTN","RGADTP",131,0)
 . S ARRAY("SENSITIVITY")=$$SENSTIVE^RGRSPARS($P(MSG,HL("FS"),6),COMP)
"RTN","RGADTP",132,0)
 . S ARRAY("SENSITIVITY USER")=$$FREE^RGRSPARS($P($P(MSG,HL("FS"),17),RGC,2))_","_$$FREE^RGRSPARS($P($P(MSG,HL("FS"),17),RGC,3))
"RTN","RGADTP",133,0)
 . S ARRAY("SENSITIVITY DATE")=$$FREE^RGRSPARS($$FMDATE^HLFNC($P(MSG,HL("FS"),15)))
"RTN","RGADTP",134,0)
 Q
"RTN","RGADTP",135,0)
ZPD ;;
"RTN","RGADTP",136,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",137,0)
 ;I 'RGLOCAL S ARRAY(.351)=$$FREE^RGRSPARS($P(MSG,HL("FS"),5))
"RTN","RGADTP",138,0)
 Q
"RTN","RGADTP",139,0)
ZSP ;;
"RTN","RGADTP",140,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",141,0)
 I 'RGLOCAL D
"RTN","RGADTP",142,0)
 . S ARRAY(.301)=$$YESNO^RGRSPARS($P(MSG,HL("FS"),3))
"RTN","RGADTP",143,0)
 . S ARRAY(.302)=$$FREE^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",144,0)
 . S ARRAY(.323)=$$POS^RGRSPARS($P(MSG,HL("FS"),5))
"RTN","RGADTP",145,0)
 Q
"RTN","RGADTP",146,0)
ZEL ;;
"RTN","RGADTP",147,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",148,0)
 I 'RGLOCAL D
"RTN","RGADTP",149,0)
 . S ARRAY(.361)=$$ELIG^RGRSPARS($P(MSG,HL("FS"),3))
"RTN","RGADTP",150,0)
 . S ARRAY(.3612)=$$FREE^RGRSPARS($P(MSG,HL("FS"),12))
"RTN","RGADTP",151,0)
 . S ARRAY(.3615)=$$FREE^RGRSPARS($P(MSG,HL("FS"),14))
"RTN","RGADTP",152,0)
 . S ARRAY(391)=$$TYPE^RGRSPARS($P(MSG,HL("FS"),10))
"RTN","RGADTP",153,0)
 . S ARRAY(1901)=$$VETERAN^RGRSPARS($P(MSG,HL("FS"),9))
"RTN","RGADTP",154,0)
 Q
"RTN","RGADTP",155,0)
ZCT ;;
"RTN","RGADTP",156,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",157,0)
 I 'RGLOCAL D
"RTN","RGADTP",158,0)
 . S ARRAY(.211)=$$FREE^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",159,0)
 . S ARRAY(.219)=$$FREE^RGRSPARS($P(MSG,HL("FS"),7))
"RTN","RGADTP",160,0)
 Q
"RTN","RGADTP",161,0)
ZEM ;;
"RTN","RGADTP",162,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",163,0)
 I 'RGLOCAL D
"RTN","RGADTP",164,0)
 . S ARRAY(.31115)=$$EMP^RGRSPARS($P(MSG,HL("FS"),4))
"RTN","RGADTP",165,0)
 Q
"RTN","RGADTP",166,0)
ZFF ;;
"RTN","RGADTP",167,0)
 I RGLOCAL S HLA("HLS",RGI)=MSG
"RTN","RGADTP",168,0)
 I 'RGLOCAL S ARRAY("FLD")=$P(MSG,HL("FS"),3)
"RTN","RGADTP",169,0)
 Q
"RTN","RGADTP",170,0)
PROCIN ;
"RTN","RGADTP",171,0)
 D PROCIN^RGADTP2(.ARRAY,.RGLOCAL,.RGER,.DFN,.HL)
"RTN","RGADTP",172,0)
 Q
"RTN","RGADTP",173,0)
GENACK ;
"RTN","RGADTP",174,0)
 N RGCNT,IEN,RG
"RTN","RGADTP",175,0)
 I $G(ARRAY("DFN"))'>0 S RGER="-1^Unknown ICN#"_$G(ARRAY("ICN"))_" and SSN#"_$G(ARRAY(.09))
"RTN","RGADTP",176,0)
 S RGCNT=1
"RTN","RGADTP",177,0)
 S HLA("HLA",RGCNT)="MSA"_HL("FS")_"AA"_HL("FS")_HL("MID")_HL("FS")_$S(+$G(RGER)<0:$P(RGER,"^",2,3),1:""),RGCNT=RGCNT+1
"RTN","RGADTP",178,0)
 S RGSITE=$$LKUP^XUAF4(RGSITE)
"RTN","RGADTP",179,0)
 D LINK^HLUTIL3(RGSITE,.RG) S IEN=$O(RG(0)) S HLL("LINKS",1)="^"_RG(IEN)
"RTN","RGADTP",180,0)
 D GENACK^HLMA1(HL("EID"),HLMTIENS,HL("EIDS"),"LM",1,.HLRESLTA,"",.HL)
"RTN","RGADTP",181,0)
 K HLA
"RTN","RGADTP",182,0)
 Q
"RTN","RGADTP",183,0)
RSP ;
"RTN","RGADTP",184,0)
 Q
"RTN","RGMTMONT")
0^6^B37393019
"RTN","RGMTMONT",1,0)
RGMTMONT ;BIR/CML,PTD-MPI/PD Monitor HL7 Messaging/Filers and Setups ;07/30/02
"RTN","RGMTMONT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20,30,31,34**;30 Apr 99
"RTN","RGMTMONT",3,0)
 ;
"RTN","RGMTMONT",4,0)
 ;Reference to OPTION SCHEDULING (#19.2) file supported by IA #3599
"RTN","RGMTMONT",5,0)
 ;Reference to ^DPT("AICNL" supported by IA #2070
"RTN","RGMTMONT",6,0)
 ;Reference to $$SEND^VAFHUTL for file DG(43 supported by IA #2624
"RTN","RGMTMONT",7,0)
 ;Reference to ^HLCS(870 supported by IA #3335
"RTN","RGMTMONT",8,0)
 ;Reference to $$STAT^HLCSLM supported by IA #3574
"RTN","RGMTMONT",9,0)
 ;Reference to ^DIA(2 and data derived from the AUDIT file (#1.1)
"RTN","RGMTMONT",10,0)
 ;supported by IA #2097 and #2602.
"RTN","RGMTMONT",11,0)
 ;
"RTN","RGMTMONT",12,0)
EN1 ;Call this routine from the top to do extended checks that include:
"RTN","RGMTMONT",13,0)
 ;- D HLMA1^RGMTUT98
"RTN","RGMTMONT",14,0)
 ;- D EN2^RGMTMONT
"RTN","RGMTMONT",15,0)
 ;- D ^RGMTMONX
"RTN","RGMTMONT",16,0)
 ;
"RTN","RGMTMONT",17,0)
 I $D(RGHLMQ) Q
"RTN","RGMTMONT",18,0)
 ;
"RTN","RGMTMONT",19,0)
 S DEV=0,EN=1 G START
"RTN","RGMTMONT",20,0)
 ;
"RTN","RGMTMONT",21,0)
DEV ;call used by developers to display ^RGMTMONX call
"RTN","RGMTMONT",22,0)
 S DEV=1,EN=2
"RTN","RGMTMONT",23,0)
 ;
"RTN","RGMTMONT",24,0)
START ;
"RTN","RGMTMONT",25,0)
 S CLUP=1
"RTN","RGMTMONT",26,0)
 W @IOF,"Logical Link Monitor:",!,"=====================",!
"RTN","RGMTMONT",27,0)
 D HLMA1^RGMTUT98
"RTN","RGMTMONT",28,0)
 S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTMONT",29,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTMONT",30,0)
 I $D(DIRUT) G QUIT
"RTN","RGMTMONT",31,0)
 ;
"RTN","RGMTMONT",32,0)
 D EN2
"RTN","RGMTMONT",33,0)
 S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGMTMONT",34,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","RGMTMONT",35,0)
 I $D(DIRUT) G QUIT
"RTN","RGMTMONT",36,0)
 ;
"RTN","RGMTMONT",37,0)
 I $G(EN)'=1 D ^RGMTMONX
"RTN","RGMTMONT",38,0)
 ;
"RTN","RGMTMONT",39,0)
 K EN,DEV G QUIT
"RTN","RGMTMONT",40,0)
 ;
"RTN","RGMTMONT",41,0)
EN2 ;Monitor Background Job - VAFC BATCH UPDATE
"RTN","RGMTMONT",42,0)
 ;Monitor Background Job - MPIF LOC/MIS ICN RES
"RTN","RGMTMONT",43,0)
 ;Check MAS PARAMETER file, field SEND PIMS HL7 V2.3 MESSAGES
"RTN","RGMTMONT",44,0)
 ;if call is being made from HL7 query, variable RGHLMQ will be defined
"RTN","RGMTMONT",45,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_$$NOW^XLFDT_"^MPI/PD Maintenance Data"
"RTN","RGMTMONT",46,0)
 K ^XTMP("RGMT","HLMQMONT")
"RTN","RGMTMONT",47,0)
 I '$D(DEV) S DEV=0
"RTN","RGMTMONT",48,0)
 S LOCSITE=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTMONT",49,0)
 I $D(RGHLMQ) D
"RTN","RGMTMONT",50,0)
 .D NOW^%DTC
"RTN","RGMTMONT",51,0)
 .S ^XTMP("RGMT","HLMQMONT",LOCSITE,"@@ RUNDATE")=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTMONT",52,0)
 I '$D(RGHLMQ) W @IOF,"MPI/PD Process Monitor:",!,"======================="
"RTN","RGMTMONT",53,0)
 S TXTCNT=0
"RTN","RGMTMONT",54,0)
 N BKDA,CUR,MSG,SCHDA,SEND,TIME
"RTN","RGMTMONT",55,0)
CHK1 ;
"RTN","RGMTMONT",56,0)
 S TXT="Checking VAFC BATCH UPDATE background job..." D TXT
"RTN","RGMTMONT",57,0)
 D PIV^RGMTUT98
"RTN","RGMTMONT",58,0)
 S TXTCNT=3
"RTN","RGMTMONT",59,0)
 ;
"RTN","RGMTMONT",60,0)
 S DIC="^DIC(19,",X="VAFC BATCH UPDATE" D ^DIC K DIC S BKDA=+Y
"RTN","RGMTMONT",61,0)
 I BKDA<0 S TXT="=> VAFC BATCH UPDATE does not exist in OPTION file." D TXT K BKDA G CHK2
"RTN","RGMTMONT",62,0)
 S TXT="=> VAFC BATCH UPDATE is not currently scheduled to run."
"RTN","RGMTMONT",63,0)
 S DIC="^DIC(19.2,",X="VAFC BATCH UPDATE" D ^DIC K DIC S SCHDA=+Y
"RTN","RGMTMONT",64,0)
 I SCHDA<0 D TXT K BKDA,TXT,SCHDA G CHK2
"RTN","RGMTMONT",65,0)
 S TIME=$$GET1^DIQ(19.2,SCHDA_",",2)
"RTN","RGMTMONT",66,0)
 I TIME="" D TXT K BKDA,TXT,SCHDA,TIME G CHK2
"RTN","RGMTMONT",67,0)
 S TXT="=> VAFC BATCH UPDATE scheduled to run "_$$FMTE^XLFDT(TIME)_"."
"RTN","RGMTMONT",68,0)
 D TXT
"RTN","RGMTMONT",69,0)
 D NOW^%DTC
"RTN","RGMTMONT",70,0)
 S DAY=$E(%,1,7)
"RTN","RGMTMONT",71,0)
 ;
"RTN","RGMTMONT",72,0)
CHK2 ;
"RTN","RGMTMONT",73,0)
 S TXT="" D TXT
"RTN","RGMTMONT",74,0)
 ;
"RTN","RGMTMONT",75,0)
 S ICN=0,CNT=0
"RTN","RGMTMONT",76,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGMTMONT",77,0)
 S TXT="Checking MPIF LOC/MIS ICN RES background job...  (Total Local ICNs = "_CNT_")"
"RTN","RGMTMONT",78,0)
 D TXT
"RTN","RGMTMONT",79,0)
 ;
"RTN","RGMTMONT",80,0)
 S DIC="^DIC(19,",X="MPIF LOC/MIS ICN RES" D ^DIC K DIC S BKDA=+Y
"RTN","RGMTMONT",81,0)
 I BKDA<0 S TXT="=> MPIF LOC/MIS ICN RES does not exist in OPTION file." D TXT K BKDA G CHK2A
"RTN","RGMTMONT",82,0)
 S TXT="=> MPIF LOC/MIS ICN RES is not currently scheduled to run."
"RTN","RGMTMONT",83,0)
 S DIC="^DIC(19.2,",X="MPIF LOC/MIS ICN RES" D ^DIC K DIC S SCHDA=+Y
"RTN","RGMTMONT",84,0)
 I SCHDA<0 D TXT K BKDA,SCHDA G CHK2A
"RTN","RGMTMONT",85,0)
 S TIME=$$GET1^DIQ(19.2,SCHDA_",",2)
"RTN","RGMTMONT",86,0)
 I TIME="" D TXT K BKDA,SCHDA,TIME G CHK2A
"RTN","RGMTMONT",87,0)
 S TXT="=> MPIF LOC/MIS ICN RES is scheduled to run "_$$FMTE^XLFDT(TIME)_"."
"RTN","RGMTMONT",88,0)
 D TXT
"RTN","RGMTMONT",89,0)
 ;
"RTN","RGMTMONT",90,0)
CHK2A ;check for time local/missing job was last run
"RTN","RGMTMONT",91,0)
 S TIME=$P($G(^RGSITE(991.8,1,0)),"^",4) I TIME'="" D
"RTN","RGMTMONT",92,0)
 .S TIME=$$FMTE^XLFDT(TIME)
"RTN","RGMTMONT",93,0)
 .S TXT="=> MPIF LOC/MIS ICN RES was last run "_TIME_"."
"RTN","RGMTMONT",94,0)
 .D TXT
"RTN","RGMTMONT",95,0)
 ;
"RTN","RGMTMONT",96,0)
CHK3 ;Check to see if .01 field in patient file has auditing turned on
"RTN","RGMTMONT",97,0)
 S TXT="" D TXT
"RTN","RGMTMONT",98,0)
 D FIELD^DID(2,.01,"","AUDIT","PATAUD")
"RTN","RGMTMONT",99,0)
 S PATAUD=$G(PATAUD("AUDIT")) I PATAUD="" S PATAUD="NOT SET"
"RTN","RGMTMONT",100,0)
 S PATAUD="<<"_PATAUD_">>"
"RTN","RGMTMONT",101,0)
 S TXT="=> Audit on NAME (#.01) field of PATIENT (#2) file set to "_PATAUD
"RTN","RGMTMONT",102,0)
 D TXT
"RTN","RGMTMONT",103,0)
 K PATAUD
"RTN","RGMTMONT",104,0)
 ;
"RTN","RGMTMONT",105,0)
CHK5 ;
"RTN","RGMTMONT",106,0)
 S TXT="" D TXT
"RTN","RGMTMONT",107,0)
 ;
"RTN","RGMTMONT",108,0)
 S TXT="Checking SEND Parameters for HL7 messaging..."
"RTN","RGMTMONT",109,0)
 D TXT
"RTN","RGMTMONT",110,0)
 ;
"RTN","RGMTMONT",111,0)
 S SEND=$P($$SEND^VAFHUTL,"^",2)
"RTN","RGMTMONT",112,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGMTMONT",113,0)
 S TXT="=> SEND PIMS HL7 V2.3 MESSAGES currently set to << "_CUR_" >>."
"RTN","RGMTMONT",114,0)
 D TXT
"RTN","RGMTMONT",115,0)
 ;
"RTN","RGMTMONT",116,0)
 S TXT="=> STOP MPI/PD MESSAGING currently set to "
"RTN","RGMTMONT",117,0)
 S SEND=$P($G(^RGSITE(991.8,1,1)),"^",6)
"RTN","RGMTMONT",118,0)
 S CUR=$S(SEND=1:"SEND MESSAGES",SEND=0:"STOP MESSAGES",SEND=2:"SUSPEND MESSAGES",1:"NULL")
"RTN","RGMTMONT",119,0)
 S TXT="=> STOP MPI/PD MESSAGING currently set to << "_CUR_" >>."
"RTN","RGMTMONT",120,0)
 D TXT
"RTN","RGMTMONT",121,0)
 ;
"RTN","RGMTMONT",122,0)
CHK6 ;
"RTN","RGMTMONT",123,0)
 K RGMT
"RTN","RGMTMONT",124,0)
 S LOC=$P($$SITE^VASITE(),"^")
"RTN","RGMTMONT",125,0)
 D LINK^HLUTIL3(LOC,.RGMT)
"RTN","RGMTMONT",126,0)
 S LOCIEN=$O(RGMT(0))
"RTN","RGMTMONT",127,0)
 I 'LOCIEN D  G QUIT
"RTN","RGMTMONT",128,0)
 .S TXT="^DIC(4,""AC"" xref problem.  Check ^DIC(4,""AC"",,"_LOC
"RTN","RGMTMONT",129,0)
 .D TXT
"RTN","RGMTMONT",130,0)
 S LOCLINK=RGMT(LOCIEN)
"RTN","RGMTMONT",131,0)
 ;
"RTN","RGMTMONT",132,0)
 S TXT="" D TXT
"RTN","RGMTMONT",133,0)
 ;
"RTN","RGMTMONT",134,0)
 S TXT="Checking SHUTDOWN LLP? field and TCP/IP SERVICE TYPE for "_LOCLINK_"..."
"RTN","RGMTMONT",135,0)
 D TXT
"RTN","RGMTMONT",136,0)
 ;
"RTN","RGMTMONT",137,0)
 S CUR=$$GET1^DIQ(870,LOCIEN_",",14)
"RTN","RGMTMONT",138,0)
 S TXT="=> SHUTDOWN LLP? currently set to << "_CUR_" >>."
"RTN","RGMTMONT",139,0)
 D TXT
"RTN","RGMTMONT",140,0)
 ;
"RTN","RGMTMONT",141,0)
 S CUR=$$GET1^DIQ(870,LOCIEN_",",400.03)
"RTN","RGMTMONT",142,0)
 S TXT="=> TCP/IP SERVICE TYPE currently set to << "_CUR_" >>."
"RTN","RGMTMONT",143,0)
 D TXT
"RTN","RGMTMONT",144,0)
 ;
"RTN","RGMTMONT",145,0)
 ;check MPIVA for LLP TYPE
"RTN","RGMTMONT",146,0)
 S DIC="^HLCS(870,",X="MPIVA" D ^DIC K DIC S MPILL=+Y
"RTN","RGMTMONT",147,0)
 S CUR=$$GET1^DIQ(870,MPILL_",",2)
"RTN","RGMTMONT",148,0)
 S TXT="=> Logical Link MPIVA currently set to << "_CUR_" >>."
"RTN","RGMTMONT",149,0)
 D TXT
"RTN","RGMTMONT",150,0)
 ;
"RTN","RGMTMONT",151,0)
 ;check to see if Link Manager is running
"RTN","RGMTMONT",152,0)
 S LMSTAT=$$STAT^HLCSLM
"RTN","RGMTMONT",153,0)
 S CUR=$S('LMSTAT:"NOT RUNNING",1:"RUNNING")
"RTN","RGMTMONT",154,0)
 S TXT="=> HL LINK MANAGER is currently << "_CUR_" >>."
"RTN","RGMTMONT",155,0)
 D TXT
"RTN","RGMTMONT",156,0)
 ;
"RTN","RGMTMONT",157,0)
FLDLIST ;capture fields being audited
"RTN","RGMTMONT",158,0)
 I $D(RGHLMQ) D
"RTN","RGMTMONT",159,0)
 .S AUDCNT=0
"RTN","RGMTMONT",160,0)
 .S ^XTMP("RGMT","HLMQMONT",LOCSITE,"AUDIT",0)="Compiled: "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","RGMTMONT",161,0)
 .S FLDLP=0 F  S FLDLP=$O(^DD(2,"AUDIT",FLDLP)) Q:'FLDLP  D
"RTN","RGMTMONT",162,0)
 ..S AUDCNT=AUDCNT+1
"RTN","RGMTMONT",163,0)
 ..K RGARR D FIELD^DID(2,FLDLP,"","LABEL","RGARR")
"RTN","RGMTMONT",164,0)
 ..S FLDNM=$G(RGARR("LABEL")) Q:FLDNM=""
"RTN","RGMTMONT",165,0)
 ..S ^XTMP("RGMT","HLMQMONT",LOCSITE,"AUDIT",AUDCNT)=FLDLP_"^"_FLDNM
"RTN","RGMTMONT",166,0)
 ;
"RTN","RGMTMONT",167,0)
 I $D(CLUP),$D(DIRUT) Q
"RTN","RGMTMONT",168,0)
 ;
"RTN","RGMTMONT",169,0)
QUIT ;
"RTN","RGMTMONT",170,0)
 K %,BKDA,CLUP,CNT,CUR,DAY,DIR,DIRUT,ICN,JJ,LMSTAT,LOC,LOCIEN,LOCLINK
"RTN","RGMTMONT",171,0)
 K LOCSITE,MPILL,MSG,PATAUD,RGHLMQ,RGMT,SCHDA,SEND,SS,TIME,TXT,TXTCNT,X,Y
"RTN","RGMTMONT",172,0)
 K AUDCNT,FLDLP,RGARR,FLDNM
"RTN","RGMTMONT",173,0)
 Q
"RTN","RGMTMONT",174,0)
 ;
"RTN","RGMTMONT",175,0)
TXT ;
"RTN","RGMTMONT",176,0)
 S TXTCNT=TXTCNT+1
"RTN","RGMTMONT",177,0)
 I '$D(RGHLMQ) W !,TXT
"RTN","RGMTMONT",178,0)
 I $D(RGHLMQ) S ^XTMP("RGMT","HLMQMONT",LOCSITE,TXTCNT)=TXT
"RTN","RGMTMONT",179,0)
 Q
"RTN","RGPRSSN")
0^5^B28848862
"RTN","RGPRSSN",1,0)
RGPRSSN ;WAS/FHM-MPI/PD PSEUDO/MISSING SSN REPORT ;6/25/98
"RTN","RGPRSSN",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19,34**;30 Apr 99
"RTN","RGPRSSN",3,0)
 ;
"RTN","RGPRSSN",4,0)
 ;Reference to ^DIC(8 supported by IA #427
"RTN","RGPRSSN",5,0)
 ;Reference to ^DGPM( supported by IA #966
"RTN","RGPRSSN",6,0)
 ;Reference to ^SCE( supported by IA #2443
"RTN","RGPRSSN",7,0)
 ;Reference to ADM^VADPT2 supported by IA #325
"RTN","RGPRSSN",8,0)
 ;
"RTN","RGPRSSN",9,0)
 ;EXTRACT BAD SSN AND SORTS THEM BY CLASSIFICATION
"RTN","RGPRSSN",10,0)
 W !,"This report will provide a list of:"
"RTN","RGPRSSN",11,0)
 W !,"(1) any B Cross-references (there is no 'zero' node but a B x-ref)"
"RTN","RGPRSSN",12,0)
 W !,"    on the patient file,"
"RTN","RGPRSSN",13,0)
 W !,"(2) patients with Pseudo SSNs who have not had activity within the past 3 years,"
"RTN","RGPRSSN",14,0)
 W !,"(3) patients with Pseudo SSNs who have had activity within the past 3 years.",!
"RTN","RGPRSSN",15,0)
 W !,"The Reports are sorted by Primary Eligibility Code. The report can"
"RTN","RGPRSSN",16,0)
 W !,"be queued if desired."
"RTN","RGPRSSN",17,0)
 W !,!,"For MPI/PD purposes, general advice is to concentrate first on"
"RTN","RGPRSSN",18,0)
 W !,"getting correct SSNs for the patients who HAVE had activity within"
"RTN","RGPRSSN",19,0)
 W !,"the past 3 years.",!
"RTN","RGPRSSN",20,0)
 S %ZIS="QM" D ^%ZIS G EXIT:POP
"RTN","RGPRSSN",21,0)
 K ^TMP($J)
"RTN","RGPRSSN",22,0)
 I $D(IO("Q")) D  Q
"RTN","RGPRSSN",23,0)
   .S ZTRTN="DQ^RGPRSSN",ZTDESC="MPI/PD SSN VALIDATION"
"RTN","RGPRSSN",24,0)
   .D ^%ZTLOAD D HOME^%ZIS K IO("Q")
"RTN","RGPRSSN",25,0)
DQ N DTOUT,DUOUT S RGFS=1,PRNTCODE="",RGPRNTCO=""
"RTN","RGPRSSN",26,0)
 U IO W @IOF,!,"MPI/PD Report of Pseudo, missing & potentially false SSNs "
"RTN","RGPRSSN",27,0)
 D NOW^%DTC D YX^%DTC
"RTN","RGPRSSN",28,0)
 W ?55,Y,!
"RTN","RGPRSSN",29,0)
 W !,"Bad B Cross References Report"
"RTN","RGPRSSN",30,0)
 W !,"Please contact IRM for assistance with bad B Cross references."
"RTN","RGPRSSN",31,0)
 W !,"----------------------------------------------------------------------------"
"RTN","RGPRSSN",32,0)
 S BREF=0
"RTN","RGPRSSN",33,0)
 S NAME=""
"RTN","RGPRSSN",34,0)
 F  S NAME=$O(^DPT("B",NAME)) Q:NAME=""  D
"RTN","RGPRSSN",35,0)
   .S REFNO=0
"RTN","RGPRSSN",36,0)
   .S REFNO=$O(^DPT("B",NAME,REFNO)) Q:REFNO=""
"RTN","RGPRSSN",37,0)
   .IF $D(^DPT(REFNO,0)) S NODE=^DPT(REFNO,0),RGSSN=$P(NODE,"^",9)
"RTN","RGPRSSN",38,0)
   .E  S BREF=1 W !,"B Cross Reference with no 0 Node in DPT: DFN= ",REFNO Q
"RTN","RGPRSSN",39,0)
   .IF RGSSN="" S RGSSN="None"
"RTN","RGPRSSN",40,0)
   .IF RGSSN'?9N S SCRATCH=$$SETGBL
"RTN","RGPRSSN",41,0)
   .IF RGSSN="123456789" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",42,0)
   .IF RGSSN="000000000" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",43,0)
   .IF RGSSN="111111111" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",44,0)
   .IF RGSSN="222222222" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",45,0)
   .IF RGSSN="333333333" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",46,0)
   .IF RGSSN="444444444" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",47,0)
   .IF RGSSN="555555555" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",48,0)
   .IF RGSSN="666666666" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",49,0)
   .IF RGSSN="777777777" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",50,0)
   .IF RGSSN="888888888" S SCRATCH=$$SETGBL
"RTN","RGPRSSN",51,0)
   .IF RGSSN?1"9"8N S SCRATCH=$$SETGBL
"RTN","RGPRSSN",52,0)
   .QUIT
"RTN","RGPRSSN",53,0)
 IF BREF=0 W !,"*** No Bad B Cross References Found in your account.***"
"RTN","RGPRSSN",54,0)
LST S (ACTIV1,ECODE1,NAME1,REFNO1)=""
"RTN","RGPRSSN",55,0)
LST1 S ACTIV1=$O(^TMP($J,ACTIV1)) G EXIT:ACTIV1="" D HEADER G EXIT:$D(DUOUT)!($D(DTOUT))
"RTN","RGPRSSN",56,0)
LST2 S ECODE1=$O(^TMP($J,ACTIV1,ECODE1))  G LST1:ECODE1="" D:$Y>(IOSL-4) HEADER,HEAD2 G:$D(DUOUT)!($D(DTOUT)) EXIT W ! S SCRATCH=$$GETECODE
"RTN","RGPRSSN",57,0)
LST3 S NAME1=$O(^TMP($J,ACTIV1,ECODE1,NAME1))  G LST2:NAME1="" D:$Y>(IOSL-4) HEADER,HEAD2 G:$D(DUOUT)!($D(DTOUT)) EXIT
"RTN","RGPRSSN",58,0)
 S REFNO1=^TMP($J,ACTIV1,ECODE1,NAME1)
"RTN","RGPRSSN",59,0)
 S (PHONE,RGSSN,ECODE)="None"
"RTN","RGPRSSN",60,0)
 ;Using VADPT for PHONE# , SSN     ,eligibility code, and Name  
"RTN","RGPRSSN",61,0)
 K VAPTYP,VAHOW,VAROOT,VADM,VAEL,VAPA,VATEST S DFN=REFNO1 D ADD^VADPT,DEM^VADPT,ELIG^VADPT S NAME=VADM(1),RGSSN=$P(VADM(2),U),PHONE=VAPA(8),ECODE=$P(VAEL(1),U)
"RTN","RGPRSSN",62,0)
 K VAPTYP,VAHOW,VAROOT,VADM,VAEL,VAPA,VATEST
"RTN","RGPRSSN",63,0)
 S ACTIVITY=$$ACTIVE(REFNO1)
"RTN","RGPRSSN",64,0)
 W !,?10,ECODE,?20,NAME1,?54,RGSSN,?65,PHONE
"RTN","RGPRSSN",65,0)
 GOTO LST3
"RTN","RGPRSSN",66,0)
EXIT D ^%ZISC
"RTN","RGPRSSN",67,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGPRSSN",68,0)
 K ^TMP($J)
"RTN","RGPRSSN",69,0)
 K ACTIV1,ACTIVITY,BREF,ECODE,ECODE1,NAME,NAME1,NODE,NODE2,NODE3
"RTN","RGPRSSN",70,0)
 K NODE4,PHONE,PRNTCODE,REFNO,REFNO1,RGFS,RGPRNTCO,SCRATCH,RGSSN,ZTREQ,%ZIS,NODE1,POP,ZTDESC,ZTRTN
"RTN","RGPRSSN",71,0)
 QUIT
"RTN","RGPRSSN",72,0)
SETGBL()        ;SETS GLOBAL
"RTN","RGPRSSN",73,0)
 S ECODE=""
"RTN","RGPRSSN",74,0)
 K VAEL S DFN=REFNO D ELIG^VADPT S ECODE=$P(VAEL(1),U)
"RTN","RGPRSSN",75,0)
 IF ECODE="" S ECODE="None"
"RTN","RGPRSSN",76,0)
 S ACTIVITY=$$ACTIVE(REFNO)
"RTN","RGPRSSN",77,0)
 S ^TMP($J,ACTIVITY,ECODE,NAME)=REFNO
"RTN","RGPRSSN",78,0)
 QUIT 1
"RTN","RGPRSSN",79,0)
GETECODE()      ;
"RTN","RGPRSSN",80,0)
 S PRNTCODE="None"
"RTN","RGPRSSN",81,0)
 IF $D(^DIC(8,ECODE1,0)) S NODE4=^DIC(8,ECODE1,0),PRNTCODE=$P(NODE4,"^",1)
"RTN","RGPRSSN",82,0)
 W !,PRNTCODE S RGFS=0
"RTN","RGPRSSN",83,0)
 QUIT 1
"RTN","RGPRSSN",84,0)
LTD(DFN)        ;
"RTN","RGPRSSN",85,0)
 ;FIND LAST TREATMENT DATE
"RTN","RGPRSSN",86,0)
 ;INPUT: DFN
"RTN","RGPRSSN",87,0)
 ;OUTPUT: LTD LAST TREATMENT DATE
"RTN","RGPRSSN",88,0)
 ;
"RTN","RGPRSSN",89,0)
 ;
"RTN","RGPRSSN",90,0)
 N LTD,X
"RTN","RGPRSSN",91,0)
 ;
"RTN","RGPRSSN",92,0)
 ; - NEED A PATIENT
"RTN","RGPRSSN",93,0)
 I '$G(DFN) S LTD=0 G LTDQ
"RTN","RGPRSSN",94,0)
 ;
"RTN","RGPRSSN",95,0)
 ; - IF CURRENT INPATIENT, SET LTD = TODAY AND QUIT
"RTN","RGPRSSN",96,0)
 ;Current admission movement from ADM^VAPDT2
"RTN","RGPRSSN",97,0)
 K VADMVT,VAINDT D ADM^VADPT2 I $L(VADMVT) S LTD=DT K VADMVT,VAERR,VAINDT G LTDQ
"RTN","RGPRSSN",98,0)
 K VADMVT,VAERR,VAINDT
"RTN","RGPRSSN",99,0)
 ;
"RTN","RGPRSSN",100,0)
 ; - GET THE LAST DISCHARGE DATE
"RTN","RGPRSSN",101,0)
 S LTD=+$O(^DGPM("ATID3",DFN,"")) S:LTD LTD=9999999.9999999-LTD\1 S:LTD>DT LTD=DT
"RTN","RGPRSSN",102,0)
 ;
"RTN","RGPRSSN",103,0)
 ; - GET THE LAST REGISTRATION DATE AND COMPARE IT TO LTD
"RTN","RGPRSSN",104,0)
 K VAROOT,VARP,^UTILITY("VARP",$J) S VARP("F")=2000101 D REG^VADPT I $D(^UTILITY("VARP",$J,1,"I")) S X=$P(^("I"),U) I X S X=X\1 S:X>LTD LTD=X
"RTN","RGPRSSN",105,0)
 K ^UTILITY("VARP",$J),VARP,VAERR
"RTN","RGPRSSN",106,0)
 ;
"RTN","RGPRSSN",107,0)
 ; - GET THE LAST STOP AND COMPARE TO LTD
"RTN","RGPRSSN",108,0)
 ; Look at Outpatient Encounter, ^SDV is going away
"RTN","RGPRSSN",109,0)
 ; Use an API instead of ordering through global
"RTN","RGPRSSN",110,0)
 N OPIEN S OPIEN=$$GETLAST^SDOE(DFN,2000101,"C")
"RTN","RGPRSSN",111,0)
 I $G(^SCE(+OPIEN,0)) S LTD=$P(^SCE(OPIEN,0),"^",1)\1
"RTN","RGPRSSN",112,0)
 ;
"RTN","RGPRSSN",113,0)
LTDQ ;
"RTN","RGPRSSN",114,0)
 Q $S(LTD:LTD,1:0)
"RTN","RGPRSSN",115,0)
 ;
"RTN","RGPRSSN",116,0)
ACTIVE(DFN) ;
"RTN","RGPRSSN",117,0)
 N LTD,TODAY,DIFF
"RTN","RGPRSSN",118,0)
 S LTD=$$LTD(DFN)
"RTN","RGPRSSN",119,0)
 Q:LTD'>0 "NO"
"RTN","RGPRSSN",120,0)
 Q:$L(LTD)'=7 1_"^"_LTD_"^"_"ZERO"
"RTN","RGPRSSN",121,0)
 S TODAY=$$NOW^XLFDT\1
"RTN","RGPRSSN",122,0)
 S DIFF=$$FMDIFF^XLFDT(TODAY,LTD)
"RTN","RGPRSSN",123,0)
 ; if difference is > 1096 days or 3 years
"RTN","RGPRSSN",124,0)
 I DIFF>1096 Q "NO"
"RTN","RGPRSSN",125,0)
 Q "YES"
"RTN","RGPRSSN",126,0)
HEADER ;PRINT REPORT HEADER
"RTN","RGPRSSN",127,0)
 I ($E(IOST,1,2)="C-")&(IO=IO(0)) D
"RTN","RGPRSSN",128,0)
 . S DIR(0)="E"
"RTN","RGPRSSN",129,0)
 . D ^DIR K DIR
"RTN","RGPRSSN",130,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","RGPRSSN",131,0)
 ;;;W:$D(IOF) @IOF
"RTN","RGPRSSN",132,0)
 W @IOF,!,"MPI/PD Report of Pseudo, missing & potentially false SSNs "
"RTN","RGPRSSN",133,0)
 D NOW^%DTC D YX^%DTC
"RTN","RGPRSSN",134,0)
 W ?55,Y,! K Y
"RTN","RGPRSSN",135,0)
 W !,?20,"Patient activity within past 3 years = ",$G(ACTIV1)
"RTN","RGPRSSN",136,0)
 W !,?1,"Primary"
"RTN","RGPRSSN",137,0)
 W !,?1,"Elig Code"
"RTN","RGPRSSN",138,0)
 W !,?10,"Elig.",?20,"Name",?54,"SSN",?65,"Home Phone"
"RTN","RGPRSSN",139,0)
 W !,"-----------------------------------------------------------------------------"
"RTN","RGPRSSN",140,0)
 Q
"RTN","RGPRSSN",141,0)
HEAD2 ;SUB HEADER
"RTN","RGPRSSN",142,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","RGPRSSN",143,0)
 I RGFS=0,PRNTCODE=RGPRNTCO W !,PRNTCODE
"RTN","RGPRSSN",144,0)
 E  I RGFS=0 W !,PRNTCODE S RGPRNTCO=PRNTCODE
"RTN","RGPRSSN",145,0)
 Q
"RTN","RGRSWPT")
1^2
"RTN","RGRSWRPT")
1^3
"RTN","RGVCCMR2")
0^4^B37731665
"RTN","RGVCCMR2",1,0)
RGVCCMR2 ;GAI/TMG,ALS-CMOR ACTIVITY SCORE GENERATOR (PART 2) ;10-6-1997
"RTN","RGVCCMR2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**19,34**;30 Apr 99
"RTN","RGVCCMR2",3,0)
 ;Reference to ^DGPT( and ^DGPT("B" supported by IA #92
"RTN","RGVCCMR2",4,0)
 ;Reference to ^DIC(40.7 supported by IA #2501
"RTN","RGVCCMR2",5,0)
 ;Reference to ^LR( supported by IA #2466
"RTN","RGVCCMR2",6,0)
 ;Reference to ^PS(55 supported by IA #2470
"RTN","RGVCCMR2",7,0)
 ;Reference to ^PSRX( supported by IA #2471
"RTN","RGVCCMR2",8,0)
 ;Reference to ^RARPT( and ^RARPT("C" supported by IA #2442
"RTN","RGVCCMR2",9,0)
 ;Reference to ^SCE( and ^SCE("C" supported by IA #2443
"RTN","RGVCCMR2",10,0)
 ;
"RTN","RGVCCMR2",11,0)
EN S U="^"
"RTN","RGVCCMR2",12,0)
 I '$D(RUNTYPE) I '$D(RGDFN) S RUNTYPE="I",RGDFN=0 K ^XTMP("RGVCCMR")
"RTN","RGVCCMR2",13,0)
 I RUNTYPE'="I",($G(RGDFN)'=0) D NOW^%DTC S ^XTMP("RGVCCMR","@@@@","RESTARTED")=% G BATCH
"RTN","RGVCCMR2",14,0)
 I RUNTYPE="I"!($G(RGDFN)=0) K ^XTMP("RGVCCMR")
"RTN","RGVCCMR2",15,0)
 D NOW^%DTC
"RTN","RGVCCMR2",16,0)
 ;set purge date of XTMP = 30 days
"RTN","RGVCCMR2",17,0)
 S ^XTMP("RGVCCMR",0)=$$FMADD^XLFDT($$NOW^XLFDT,30)_U_$$NOW^XLFDT_U_"CMOR CALCULATION DATA"
"RTN","RGVCCMR2",18,0)
BATCH I '$D(DT) S X="T",%DT="" D ^%DT S DT=Y
"RTN","RGVCCMR2",19,0)
 D NOW^%DTC
"RTN","RGVCCMR2",20,0)
 I $G(RGDFN)=0!(RUNTYPE="I") S ^XTMP("RGVCCMR","@@@@","STARTED")=%,$P(^RGSITE(991.8,1,"CMOR"),U,2)=%
"RTN","RGVCCMR2",21,0)
 S $P(^RGSITE(991.8,1,"CMOR"),U,8)=RUNTYPE
"RTN","RGVCCMR2",22,0)
 S:'$D(^XTMP("RGVCCMR","@@@@","BIG")) ^XTMP("RGVCCMR","@@@@","BIG")=0
"RTN","RGVCCMR2",23,0)
ALLPTS S ^XTMP("RGVCCMR","@@@@","SECTION")="ALL"
"RTN","RGVCCMR2",24,0)
 S $P(^RGSITE(991.8,1,"CMOR"),U,7)="R"
"RTN","RGVCCMR2",25,0)
 S:'$D(^XTMP("RGVCCMR","@@@@","DFNCOUNT")) ^XTMP("RGVCCMR","@@@@","DFNCOUNT")=0
"RTN","RGVCCMR2",26,0)
 F  S RGDFN=$O(^DPT(+RGDFN)) Q:+RGDFN'>0  I $D(^DPT(+RGDFN,0)) S DPT0=^(0) G:$P($G(^RGSITE(991.8,1,"CMOR")),U,4)="Y" STOP D
"RTN","RGVCCMR2",27,0)
 .S QUIT=0 D CKPT I QUIT Q
"RTN","RGVCCMR2",28,0)
 .S FILEFLG=0
"RTN","RGVCCMR2",29,0)
 .D CALCI S ^XTMP("RGVCCMR","@@@@","CURR DFN")=RGDFN S $P(^RGSITE(991.8,1,"CMOR"),U)=RGDFN
"RTN","RGVCCMR2",30,0)
 .I FILEFLG=1 D
"RTN","RGVCCMR2",31,0)
 ..I SCORE>^XTMP("RGVCCMR","@@@@","BIG") S ^XTMP("RGVCCMR","@@@@","BIG")=SCORE
"RTN","RGVCCMR2",32,0)
 ..S RATING=SCORE\100 S:'$D(^XTMP("RGVCCMR","@@@@","RATING",RATING)) ^XTMP("RGVCCMR","@@@@","RATING",RATING)=0
"RTN","RGVCCMR2",33,0)
 ..S ^XTMP("RGVCCMR","@@@@","RATING",RATING)=^XTMP("RGVCCMR","@@@@","RATING",RATING)+1
"RTN","RGVCCMR2",34,0)
STOP I $P($G(^RGSITE(991.8,1,"CMOR")),U,4)="Y" S $P(^RGSITE(991.8,1,"CMOR"),U,7)="SM",$P(^RGSITE(991.8,1,"CMOR"),U,4)=""
"RTN","RGVCCMR2",35,0)
 E  S $P(^RGSITE(991.8,1,"CMOR"),U,7)="SN"
"RTN","RGVCCMR2",36,0)
 D NOW^%DTC
"RTN","RGVCCMR2",37,0)
 S ^XTMP("RGVCCMR","@@@@","STOPPED")=%
"RTN","RGVCCMR2",38,0)
 S $P(^RGSITE(991.8,1,"CMOR"),U,3)=%
"RTN","RGVCCMR2",39,0)
 D COUNT,KILL
"RTN","RGVCCMR2",40,0)
 Q
"RTN","RGVCCMR2",41,0)
CALC ;API ENTRY POINT DBIA #2710
"RTN","RGVCCMR2",42,0)
 ;VARIABLES:  Input
"RTN","RGVCCMR2",43,0)
 ;              RGDFN - IEN of the patient in the Patient
"RTN","RGVCCMR2",44,0)
 ;                      file (#2).  RGDFN is not passed as a
"RTN","RGVCCMR2",45,0)
 ;                      formal parameter, but is defined before
"RTN","RGVCCMR2",46,0)
 ;                      calling CALC.
"RTN","RGVCCMR2",47,0)
 ;
"RTN","RGVCCMR2",48,0)
 ;            Output:  None  (result sets score into PATIENT (#2))
"RTN","RGVCCMR2",49,0)
 ;
"RTN","RGVCCMR2",50,0)
 N SCORE,X,STDT,%DT,APSTDT,YR,NXPC,PCCODE,XRCODE,LRCODE,NXSCE,SCED,VISIT,NXPTF,PTFD,ADM,NXXR,RARPTD,XRAY,NXRX,PSOVER,RXDT,RXIEN,RX,RGRXST,LRSCORE,LRDFN,LRSTDT,TEST,NXLR,FILEFLG,DIE,DR,DA
"RTN","RGVCCMR2",51,0)
CALCI S SCORE=0,X="T-1065",%DT="" D ^%DT S STDT=Y,X="T",%DT="" D ^%DT
"RTN","RGVCCMR2",52,0)
 S APSTDT=Y,YR=$E(DT,1,3)
"RTN","RGVCCMR2",53,0)
 ; Remove call to RGRSWPT, routine being deleted.
"RTN","RGVCCMR2",54,0)
 ; Remove call to FBUTL for Fee Basis redesign.
"RTN","RGVCCMR2",55,0)
 ;I '+$$ACTIVE^RGRSWPT(RGDFN) D  Q
"RTN","RGVCCMR2",56,0)
 ;.I '$$AUTH^FBUTL(RGDFN,"2961001") Q
"RTN","RGVCCMR2",57,0)
 ;.D FILE
"RTN","RGVCCMR2",58,0)
 I '$D(DT) D NOW^%DTC S DT=%\1
"RTN","RGVCCMR2",59,0)
OPT ;  outpatient visit section
"RTN","RGVCCMR2",60,0)
 ;  each visit valued as follows:    current fy = 30 pts.
"RTN","RGVCCMR2",61,0)
 ;                                           fy - 1 = 20 pts
"RTN","RGVCCMR2",62,0)
 ;                                           fy - 2 = 10 pts
"RTN","RGVCCMR2",63,0)
 ;  primary care visits (based on the PCCODE array) = 50 pts each in
"RTN","RGVCCMR2",64,0)
 ;  addition to the visit value
"RTN","RGVCCMR2",65,0)
 ;  XRCODE = ien of xray stop code  LRCODE = ien of lab stop code 
"RTN","RGVCCMR2",66,0)
 ;  encounters with a stop code for lab or xray are not counted to
"RTN","RGVCCMR2",67,0)
 ;  avoid duplication since lab & xray are counted separately 
"RTN","RGVCCMR2",68,0)
 ;  in the XR & LR sections
"RTN","RGVCCMR2",69,0)
 K PCCODE S NXPC=0 F  S NXPC=$O(^RGSITE(991.8,1,"PC",NXPC)) Q:+NXPC'>0  I $D(^DIC(40.7,+$P($G(^RGSITE(991.8,1,"PC",NXPC,0)),U),0)) S PCCODE($P($G(^RGSITE(991.8,1,"PC",NXPC,0)),U))=""
"RTN","RGVCCMR2",70,0)
 I '$D(PCCODE) S PCCODE=""
"RTN","RGVCCMR2",71,0)
 S XRCODE=0 I $D(^DIC(40.7,"C",105)) S XRCODE=$O(^DIC(40.7,"C",105,0))
"RTN","RGVCCMR2",72,0)
 S LRCODE=0 I $D(^DIC(40.7,"C",108)) S LRCODE=$O(^DIC(40.7,"C",108,0))
"RTN","RGVCCMR2",73,0)
 K VISIT S NXSCE=0 F  S NXSCE=$O(^SCE("C",+RGDFN,NXSCE)) Q:+NXSCE'>0  I $D(^SCE(+NXSCE,0)) S SCE0=^(0) D
"RTN","RGVCCMR2",74,0)
 .I $P(SCE0,U,3)=XRCODE!($P(SCE0,U,3))=LRCODE Q
"RTN","RGVCCMR2",75,0)
 .I $P(SCE0,U)>STDT I '$D(VISIT(+$P(SCE0,U)\1)) S VISIT(+$P(SCE0,U)\1)=30+(($E($P(SCE0,U),1,3)-YR)*10) S SCORE=SCORE+30+(($E($P(SCE0,U),1,3)-YR)*10)
"RTN","RGVCCMR2",76,0)
 .I $D(PCCODE(+$P(SCE0,U,3))) I '$D(VISIT($P(SCE0,U)\1)) S VISIT(+$P(SCE0,U)\1)=50 S SCORE=SCORE+50
"RTN","RGVCCMR2",77,0)
 .I $D(PCCODE(+$P(SCE0,U,3))) I $D(VISIT($P(SCE0,U)\1)) S VISIT(+$P(SCE0,U)\1)=VISIT(+$P(SCE0,U)\1)+50 S SCORE=SCORE+50
"RTN","RGVCCMR2",78,0)
ADM ;  past admission section
"RTN","RGVCCMR2",79,0)
 ;  each admission valued as follows:  current fy = 50 pts
"RTN","RGVCCMR2",80,0)
 ;                                             fy - 1 = 40 pts
"RTN","RGVCCMR2",81,0)
 ;                                             fy - 2 = 30 pts
"RTN","RGVCCMR2",82,0)
 K ADM S NXPTF=0 F  S NXPTF=$O(^DGPT("B",+RGDFN,NXPTF)) Q:+NXPTF'>0  I $D(^DGPT(NXPTF,0)) S PTF0=^(0) D
"RTN","RGVCCMR2",83,0)
 .I $P(PTF0,U,2)>STDT I '$D(ADM($P(PTF0,U,2)\1)) S ADM(+$P(PTF0,U,2)\1)=50+(($E($P(PTF0,U,2),1,3)-YR)*10) S SCORE=SCORE+50+(($E($P(PTF0,U,2),1,3)-YR)*10)
"RTN","RGVCCMR2",84,0)
 .I $D(ADM(+$P(PTF0,U,2)\1)) I $O(^DGPT(+NXPTF,"S",0)) S ADM($P(PTF0,U,2)\1)=ADM($P(PTF0,U,2)\1)+10 S SCORE=SCORE+10
"RTN","RGVCCMR2",85,0)
XRAY ; radiololgy section - each radiology exam valued at 20 pts
"RTN","RGVCCMR2",86,0)
 ;
"RTN","RGVCCMR2",87,0)
 S X="T-365",%DT="" D ^%DT S XRSTDT=Y
"RTN","RGVCCMR2",88,0)
 K XRAY S NXXR=0 F  S NXXR=$O(^RARPT("C",+RGDFN,NXXR)) Q:+NXXR'>0  I $D(^RARPT(+NXXR,0)),$P(^(0),U,3)>XRSTDT S RARPT0=^(0) D
"RTN","RGVCCMR2",89,0)
 .I '$D(XRAY($P(RARPT0,U,3)\1)) S XRAY($P(RARPT0,U,3)\1)=20 S SCORE=SCORE+20
"RTN","RGVCCMR2",90,0)
RX ;  prescription section 
"RTN","RGVCCMR2",91,0)
 ;
"RTN","RGVCCMR2",92,0)
 ;  currently active prescriptions valued at 20 pts
"RTN","RGVCCMR2",93,0)
 K RX,^TMP("PSOR",$J) S NXRX=0
"RTN","RGVCCMR2",94,0)
 ;check for version of Outpatient Pharmacy used
"RTN","RGVCCMR2",95,0)
 ;if under 7.0 use direct global access, else use api PSOORDER
"RTN","RGVCCMR2",96,0)
 S PSOVER=$$VERSION^XPDUTL("PSO")
"RTN","RGVCCMR2",97,0)
 S RXDT=$$FMADD^XLFDT(DT,-121) F  S RXDT=$O(^PS(55,RGDFN,"P","A",RXDT)) Q:RXDT'>0  S RXIEN=0 F  S RXIEN=$O(^PS(55,RGDFN,"P","A",RXDT,RXIEN)) Q:RXIEN'>0  D
"RTN","RGVCCMR2",98,0)
 . I PSOVER<7 DO  ;
"RTN","RGVCCMR2",99,0)
 .. I $D(^PSRX(+RXIEN,0)),$P(^(0),U,15)=0 S RX(NXRX)=20 S SCORE=SCORE+20
"RTN","RGVCCMR2",100,0)
 . I PSOVER'<7 D EN^PSOORDER(RGDFN,RXIEN) I $D(^TMP("PSOR",$J,RXIEN)) D
"RTN","RGVCCMR2",101,0)
 .. S RGRXST=$P($P(^TMP("PSOR",$J,RXIEN,0),"^",4),";") I RGRXST="A"!(RGRXST="S")!(RGRXST="H") S RX(NXRX)=20 K RGRXST S SCORE=SCORE+20
"RTN","RGVCCMR2",102,0)
 K ^TMP("PSOR",$J)
"RTN","RGVCCMR2",103,0)
LR ;  laboratory section
"RTN","RGVCCMR2",104,0)
 ;  "CH" = chemistry; "CY" = cytotology; "EM" = electron microscopy;
"RTN","RGVCCMR2",105,0)
 ;  "MI = microbiology; "SP" = surgical pathology
"RTN","RGVCCMR2",106,0)
 ; each lab test done in the past year is valued at 10 points
"RTN","RGVCCMR2",107,0)
 ;
"RTN","RGVCCMR2",108,0)
 S LRSCORE=0 I $D(^DPT(+RGDFN,"LR")) S LRDFN=^DPT(+RGDFN,"LR") I $D(^LR(+LRDFN)) S X="T-365",%DT="" D ^%DT S LRSTDT=Y-.0001 F TEST="CH","CY","EM","MI","SP" D
"RTN","RGVCCMR2",109,0)
 .S NXLR=0 F  S NXLR=$O(^LR(+LRDFN,TEST,NXLR)) Q:+NXLR'>0  I $D(^(NXLR,0)),$P(^(0),U)>LRSTDT S LRSCORE=LRSCORE+10
"RTN","RGVCCMR2",110,0)
 S SCORE=SCORE+LRSCORE
"RTN","RGVCCMR2",111,0)
FILE ;  file score & date calculated in appropriate locations in the
"RTN","RGVCCMR2",112,0)
 ;  PATIENT file 'MPI' node
"RTN","RGVCCMR2",113,0)
 ;  scores are filed even if zero
"RTN","RGVCCMR2",114,0)
 ;  FILEFLG variable used to illiminate unnecessary statistcal processing
"RTN","RGVCCMR2",115,0)
 S FILEFLG=1
"RTN","RGVCCMR2",116,0)
 S DIE="^DPT(",DA=RGDFN,DR="991.06///^S X=SCORE;991.07///TODAY" D ^DIE
"RTN","RGVCCMR2",117,0)
 I $D(^XTMP("RGVCCMR","@@@@","DFNCOUNT")) S ^XTMP("RGVCCMR","@@@@","DFNCOUNT")=^XTMP("RGVCCMR","@@@@","DFNCOUNT")+1
"RTN","RGVCCMR2",118,0)
 Q
"RTN","RGVCCMR2",119,0)
KILL K ADM,APSTDT,DA,DIE,DIC,RGDFN,DGS0,DPT0,DR,LRCODE,LRDFN,LRSCORE,LRSTDT
"RTN","RGVCCMR2",120,0)
 K NUM,NXLR,NXPTF,NXRX,NXSCE,NXXR,PCCODE,PTF0,PTNAM
"RTN","RGVCCMR2",121,0)
 K QUIT,RARPT0,RATE,RATING,RX,RXDT,RXIEN,SCE0,SCORE,SSN,STDT,TEST,VISIT,X
"RTN","RGVCCMR2",122,0)
 K XRAY,XRCODE,XRSTDT,Y,YR,%,%DT,NXPC,PSOVER,RUNTYPE,FILEFLG
"RTN","RGVCCMR2",123,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","RGVCCMR2",124,0)
 Q
"RTN","RGVCCMR2",125,0)
CKPT S PTNAM=$P(DPT0,U),SSN=$P(DPT0,U,9)
"RTN","RGVCCMR2",126,0)
 I PTNAM?1"ZZ".E S QUIT=1
"RTN","RGVCCMR2",127,0)
 I SSN?1"00000".E S QUIT=1
"RTN","RGVCCMR2",128,0)
 Q
"RTN","RGVCCMR2",129,0)
COUNT S ^XTMP("RGVCCMR","@@@@","RATING","TCOUNT")=0,RATE="" F  S RATE=$O(^XTMP("RGVCCMR","@@@@","RATING",RATE)) Q:RATE'?.N  D
"RTN","RGVCCMR2",130,0)
 .;.W !,RATE
"RTN","RGVCCMR2",131,0)
 .S ^XTMP("RGVCCMR","@@@@","RATING","TCOUNT")=^XTMP("RGVCCMR","@@@@","RATING","TCOUNT")+^XTMP("RGVCCMR","@@@@","RATING",RATE)
"RTN","RGVCCMR2",132,0)
 Q
"VER")
8.0^22.0
**END**
**END**
