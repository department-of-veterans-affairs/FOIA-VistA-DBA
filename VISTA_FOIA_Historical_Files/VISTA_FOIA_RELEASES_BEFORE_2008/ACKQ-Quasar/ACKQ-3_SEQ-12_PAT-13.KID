Released ACKQ*3*13 SEQ #12
Extracted from mail message
**KIDS**:ACKQ*3.0*13^

**INSTALL NAME**
ACKQ*3.0*13
"BLD",6476,0)
ACKQ*3.0*13^QUASAR^0^3070509^y
"BLD",6476,1,0)
^^1^1^3070509^
"BLD",6476,1,1,0)
Interface of Medical Devices with QUASAR and the DALC.
"BLD",6476,4,0)
^9.64PA^509850.9^1
"BLD",6476,4,509850.9,0)
509850.9
"BLD",6476,4,509850.9,2,0)
^9.641^509850.9^1
"BLD",6476,4,509850.9,2,509850.9,0)
AUDIOMETRIC EXAM DATA  (File-top level)
"BLD",6476,4,509850.9,2,509850.9,1,0)
^9.6411^115.2^12
"BLD",6476,4,509850.9,2,509850.9,1,110.28,0)
LIST R-1
"BLD",6476,4,509850.9,2,509850.9,1,110.29,0)
LIST R-2
"BLD",6476,4,509850.9,2,509850.9,1,110.3,0)
LIST R-3
"BLD",6476,4,509850.9,2,509850.9,1,110.31,0)
LIST R-4
"BLD",6476,4,509850.9,2,509850.9,1,110.32,0)
LIST R-5
"BLD",6476,4,509850.9,2,509850.9,1,111.28,0)
LIST L-1
"BLD",6476,4,509850.9,2,509850.9,1,111.29,0)
LIST L-2
"BLD",6476,4,509850.9,2,509850.9,1,111.3,0)
LIST L-3
"BLD",6476,4,509850.9,2,509850.9,1,111.31,0)
LIST L-4
"BLD",6476,4,509850.9,2,509850.9,1,111.32,0)
LIST L-5
"BLD",6476,4,509850.9,2,509850.9,1,115.19,0)
APPLIED MAX R
"BLD",6476,4,509850.9,2,509850.9,1,115.2,0)
APPLIED MAX L
"BLD",6476,4,509850.9,222)
y^n^p^^^^n^^n
"BLD",6476,4,509850.9,224)
 
"BLD",6476,4,"APDD",509850.9,509850.9)
 
"BLD",6476,4,"APDD",509850.9,509850.9,110.28)
 
"BLD",6476,4,"APDD",509850.9,509850.9,110.29)
 
"BLD",6476,4,"APDD",509850.9,509850.9,110.3)
 
"BLD",6476,4,"APDD",509850.9,509850.9,110.31)
 
"BLD",6476,4,"APDD",509850.9,509850.9,110.32)
 
"BLD",6476,4,"APDD",509850.9,509850.9,111.28)
 
"BLD",6476,4,"APDD",509850.9,509850.9,111.29)
 
"BLD",6476,4,"APDD",509850.9,509850.9,111.3)
 
"BLD",6476,4,"APDD",509850.9,509850.9,111.31)
 
"BLD",6476,4,"APDD",509850.9,509850.9,111.32)
 
"BLD",6476,4,"APDD",509850.9,509850.9,115.19)
 
"BLD",6476,4,"APDD",509850.9,509850.9,115.2)
 
"BLD",6476,4,"B",509850.9,509850.9)
 
"BLD",6476,6)
3^
"BLD",6476,6.3)
24
"BLD",6476,"ABPKG")
n
"BLD",6476,"KRN",0)
^9.67PA^8989.52^19
"BLD",6476,"KRN",.4,0)
.4
"BLD",6476,"KRN",.4,"NM",0)
^9.68A^^
"BLD",6476,"KRN",.401,0)
.401
"BLD",6476,"KRN",.402,0)
.402
"BLD",6476,"KRN",.403,0)
.403
"BLD",6476,"KRN",.5,0)
.5
"BLD",6476,"KRN",.84,0)
.84
"BLD",6476,"KRN",3.6,0)
3.6
"BLD",6476,"KRN",3.8,0)
3.8
"BLD",6476,"KRN",9.2,0)
9.2
"BLD",6476,"KRN",9.8,0)
9.8
"BLD",6476,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",6476,"KRN",9.8,"NM",1,0)
ACKQAG03^^0^B10428742
"BLD",6476,"KRN",9.8,"NM",2,0)
ACKQAG05^^0^B20304579
"BLD",6476,"KRN",9.8,"NM","B","ACKQAG03",1)
 
"BLD",6476,"KRN",9.8,"NM","B","ACKQAG05",2)
 
"BLD",6476,"KRN",19,0)
19
"BLD",6476,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",6476,"KRN",19,"NM",1,0)
ACKQROES3E^^0
"BLD",6476,"KRN",19,"NM","B","ACKQROES3E",1)
 
"BLD",6476,"KRN",19.1,0)
19.1
"BLD",6476,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6476,"KRN",101,0)
101
"BLD",6476,"KRN",409.61,0)
409.61
"BLD",6476,"KRN",771,0)
771
"BLD",6476,"KRN",870,0)
870
"BLD",6476,"KRN",8989.51,0)
8989.51
"BLD",6476,"KRN",8989.52,0)
8989.52
"BLD",6476,"KRN",8994,0)
8994
"BLD",6476,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",6476,"KRN",8994,"NM",1,0)
ACKQAUD1^^0
"BLD",6476,"KRN",8994,"NM","B","ACKQAUD1",1)

"BLD",6476,"KRN","B",.4,.4)
 
"BLD",6476,"KRN","B",.401,.401)
 
"BLD",6476,"KRN","B",.402,.402)
 
"BLD",6476,"KRN","B",.403,.403)
 
"BLD",6476,"KRN","B",.5,.5)
 
"BLD",6476,"KRN","B",.84,.84)
 
"BLD",6476,"KRN","B",3.6,3.6)
 
"BLD",6476,"KRN","B",3.8,3.8)
 
"BLD",6476,"KRN","B",9.2,9.2)
 
"BLD",6476,"KRN","B",9.8,9.8)
 
"BLD",6476,"KRN","B",19,19)
 
"BLD",6476,"KRN","B",19.1,19.1)
 
"BLD",6476,"KRN","B",101,101)
 
"BLD",6476,"KRN","B",409.61,409.61)
 
"BLD",6476,"KRN","B",771,771)
 
"BLD",6476,"KRN","B",870,870)
 
"BLD",6476,"KRN","B",8989.51,8989.51)
 
"BLD",6476,"KRN","B",8989.52,8989.52)
 
"BLD",6476,"KRN","B",8994,8994)
 
"BLD",6476,"QUES",0)
^9.62^^
"BLD",6476,"REQB",0)
^9.611^1^1
"BLD",6476,"REQB",1,0)
ACKQ*3.0*12^1
"BLD",6476,"REQB","B","ACKQ*3.0*12",1)
 
"FIA",509850.9)
AUDIOMETRIC EXAM DATA
"FIA",509850.9,0)
^ACK(509850.9,
"FIA",509850.9,0,0)
509850.9D
"FIA",509850.9,0,1)
y^n^p^^^^n^^n
"FIA",509850.9,0,10)

"FIA",509850.9,0,11)
 
"FIA",509850.9,0,"RLRO")

"FIA",509850.9,0,"VR")
3.0^ACKQ
"FIA",509850.9,509850.9)
1
"FIA",509850.9,509850.9,110.28)
 
"FIA",509850.9,509850.9,110.29)
 
"FIA",509850.9,509850.9,110.3)
 
"FIA",509850.9,509850.9,110.31)
 
"FIA",509850.9,509850.9,110.32)
 
"FIA",509850.9,509850.9,111.28)
 
"FIA",509850.9,509850.9,111.29)
 
"FIA",509850.9,509850.9,111.3)
 
"FIA",509850.9,509850.9,111.31)
 
"FIA",509850.9,509850.9,111.32)
 
"FIA",509850.9,509850.9,115.19)
 
"FIA",509850.9,509850.9,115.2)
 
"KRN",19,11621,-1)
0^1
"KRN",19,11621,0)
ACKQROES3E^Audiogram Data Edit^^B^^^^^^^^QUASAR
"KRN",19,11621,1,0)
^19.06^2^2^3070321^^^^
"KRN",19,11621,1,1,0)
This is the menu item to establish the connection for
"KRN",19,11621,1,2,0)
the Audiometric Data file Enter Edit program executable.
"KRN",19,11621,99.1)
59084,32701
"KRN",19,11621,"RPC",0)
^19.05P^20^20
"KRN",19,11621,"RPC",1,0)
ACKQROES
"KRN",19,11621,"RPC",2,0)
ACKQAUD2
"KRN",19,11621,"RPC",4,0)
XWB IS RPC AVAILABLE
"KRN",19,11621,"RPC",5,0)
DDR FILER
"KRN",19,11621,"RPC",6,0)
DDR GETS ENTRY DATA
"KRN",19,11621,"RPC",7,0)
DDR GET DD HELP
"KRN",19,11621,"RPC",8,0)
DDR LISTER
"KRN",19,11621,"RPC",9,0)
DDR VALIDATOR
"KRN",19,11621,"RPC",10,0)
DDR DELETE ENTRY
"KRN",19,11621,"RPC",11,0)
DDR FIND1
"KRN",19,11621,"RPC",12,0)
DDR FINDER
"KRN",19,11621,"RPC",14,0)
XUS SIGNON SETUP
"KRN",19,11621,"RPC",16,0)
XWB ARE RPCS AVAILABLE
"KRN",19,11621,"RPC",19,0)
ACKQROESD
"KRN",19,11621,"RPC",20,0)
ACKQAUD1
"KRN",19,11621,"U")
AUDIOGRAM DATA EDIT
"KRN",8994,1682,-1)
0^1
"KRN",8994,1682,0)
ACKQAUD1^START^ACKQAG01^2^R^^^0
"KRN",8994,1682,1,0)
^8994.01^4^4^3060828^^
"KRN",8994,1682,1,1,0)
This RPC gets the audiogram data for the selected entry
"KRN",8994,1682,1,2,0)
in the Audiometric Exam Data file 509850.9 and returns
"KRN",8994,1682,1,3,0)
it to the calling program in the array ACKQARR()
"KRN",8994,1682,1,4,0)
This is for the Audiometric Display only.
"KRN",8994,1682,2,0)
^8994.02A^2^2
"KRN",8994,1682,2,1,0)
DFN^1^^1^1
"KRN",8994,1682,2,1,1,0)
^^1^1^3050726^
"KRN",8994,1682,2,1,1,1,0)
The internal number in the PATIENT file (#2).
"KRN",8994,1682,2,2,0)
IEN^1^^0^2
"KRN",8994,1682,2,2,1,0)
^^1^1^3050726^
"KRN",8994,1682,2,2,1,1,0)
Internal number in the AUDIOMETRIC EXAM DATA file (#509850.9).
"KRN",8994,1682,2,"B","DFN",1)

"KRN",8994,1682,2,"B","IEN",2)

"KRN",8994,1682,2,"PARAMSEQ",1,1)

"KRN",8994,1682,2,"PARAMSEQ",2,2)

"KRN",8994,1682,3,0)
^^1^1^3050726^
"KRN",8994,1682,3,1,0)
See routine ACKQAG01 for a complete description of the return array.
"KRN",8994,1682,3,2,0)
1=# audiograms[0-2]
"KRN",8994,1682,3,3,0)
2=name of patient
"KRN",8994,1682,3,4,0)
3=first audiogram date seen
"KRN",8994,1682,3,5,0)
4=first tester name
"KRN",8994,1682,3,6,0)
5=age of patient at first test
"KRN",8994,1682,3,7,0)
6=title of tester for first audiogram
"KRN",8994,1682,3,8,0)
7=SSN of patient
"KRN",8994,1682,3,9,0)
8=second audiogram date(or error message if an error exists)
"KRN",8994,1682,3,10,0)
9=tester name for second audiogram
"KRN",8994,1682,3,11,0)
10=age of patient at second audiogram
"KRN",8994,1682,3,12,0)
11=title of tester for second audiogram
"KRN",8994,1682,3,13,0)
ACKQARR(ctr) pieces for each all X values
"KRN",8994,1682,3,14,0)
1=X Value(Hz) being tested
"KRN",8994,1682,3,15,0)
2=ACKQI - internal record number in 509850.9
"KRN",8994,1682,3,16,0)
3=ear[L,R]
"KRN",8994,1682,3,17,0)
4=air Y(dB) val
"KRN",8994,1682,3,18,0)
5=airMask[0-6]
"KRN",8994,1682,3,19,0)
6=airMaskLevel
"KRN",8994,1682,3,20,0)
7=bone Y(dB) value
"KRN",8994,1682,3,21,0)
8=boneMask[0-6]
"KRN",8994,1682,3,22,0)
9=boneMaskLevel
"KRN",8994,1682,3,23,0)
10=IAR
"KRN",8994,1682,3,24,0)
11=CAR
"KRN",8994,1682,3,25,0)
;;Will return to Delphi app as subscripted array
"KRN",8994,1682,3,26,0)
;;RETURN() subscripted values
"KRN",8994,1682,3,27,0)
;; 1-12(1st audiogram R ear)
"KRN",8994,1682,3,28,0)
;; 13-24(1st audiogram L ear)
"KRN",8994,1682,3,29,0)
;; 25 is speech recog 1st audiogram
"KRN",8994,1682,3,30,0)
;; 26 is the 120/121 nodes for 1st audiogram
"KRN",8994,1682,3,31,0)
;; 27-38(2nd audiogram R ear)
"KRN",8994,1682,3,32,0)
;; 39-50(2nd audiogram L ear)
"KRN",8994,1682,3,33,0)
;;51 is the speech recog for the 2nd audiogram
"KRN",8994,1682,3,34,0)
52 is the 120/121 nodes for the 2nd audiogram
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",322,-1)
1^1
"PKG",322,0)
QUASAR^ACKQ^Quality: Audiology and Speech Pathology Audit and Review
"PKG",322,20,0)
^9.402P^^
"PKG",322,22,0)
^9.49I^1^1
"PKG",322,22,1,0)
3.0^3000211^3000317^2178
"PKG",322,22,1,"PAH",1,0)
13^3070509^4628
"PKG",322,22,1,"PAH",1,1,0)
^^1^1^3070509
"PKG",322,22,1,"PAH",1,1,1,0)
Interface of Medical Devices with QUASAR and the DALC.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","ACKQAG03")
0^1^B10428742^B11560534
"RTN","ACKQAG03",1,0)
ACKQAG03        ;DALC/PJU - SEND AUDIOGRAM DATA TO DALC ;2/09/07
"RTN","ACKQAG03",2,0)
 ;;3.0;QUASAR AUDIOMETRIC MODULE;**3,12,13**;11/01/02;Build 24
"RTN","ACKQAG03",3,0)
 ;  IA# 10018 [Supported] call to ^DIE to enter date sent & msg # into 509850.9 
"RTN","ACKQAG03",4,0)
 ;  IA# 2701  [Supported] call to GETICN^MPIF001 - to get the ICN
"RTN","ACKQAG03",5,0)
 ;  IA# 10070 [Supported] call to EN1^XMD - add message text & send
"RTN","ACKQAG03",6,0)
 ;  IA# 2732  [Supported] call to CHKLINES^XMXSEC1 check message length
"RTN","ACKQAG03",7,0)
 ;  IA# 2240  [Supported] call to ENCRYP^XUSRB1 to encrypt SSN
"RTN","ACKQAG03",8,0)
 ;   
"RTN","ACKQAG03",9,0)
START(RESULT,DFN,IEN,ACKQSTNU,ACKQUSNM,ACKQUSSR) ;  
"RTN","ACKQAG03",10,0)
 ;(DFN & IEN are required)
"RTN","ACKQAG03",11,0)
 N ACKQER,ACKQERR,ACKQFA,ACKQHSSN,ACKQMSG,ACKQRMI,ACKQVT,SSN,ST,ICN
"RTN","ACKQAG03",12,0)
 K ACKQARR S ACKQARR(0)=""
"RTN","ACKQAG03",13,0)
 N XMTEXT,XMDUZ,XMRESTR,XMY,XMSUB
"RTN","ACKQAG03",14,0)
 ;check for existence and get
"RTN","ACKQAG03",15,0)
 S ACKQFA=$$ACKEXIST^ACKQAG05()
"RTN","ACKQAG03",16,0)
 I 'ACKQFA S ACKQER=$$ERRTEXT(1) G END
"RTN","ACKQAG03",17,0)
 S ACKQRMI=$$DFNIN^ACKQAG05(DFN)
"RTN","ACKQAG03",18,0)
 I 'ACKQRMI S ACKQER=$$ERRTEXT(2) G END
"RTN","ACKQAG03",19,0)
 I $G(IEN),(ACKQRMI'=IEN),'$D(^ACK(509850.9,IEN,0)) D  G END
"RTN","ACKQAG03",20,0)
 .S ACKQER=$$ERRTEXT(8)
"RTN","ACKQAG03",21,0)
 S ST=$G(^ACK(509850.9,IEN,0))
"RTN","ACKQAG03",22,0)
 I $G(IEN),$P(ST,U,2)'=DFN S ACKQER=$$ERRTEXT(9) G END
"RTN","ACKQAG03",23,0)
 I $G(IEN),(ACKQRMI'=IEN) S ACKQRMI=IEN
"RTN","ACKQAG03",24,0)
 ;create stub and address to S.RMROES3@DDC.VA.GOV
"RTN","ACKQAG03",25,0)
 S (ACKQMSG,XMZ)=$$NEWMSG^ACKQAG05()
"RTN","ACKQAG03",26,0)
 D EN^ACKQAG04(.ACKQARR,ACKQRMI,DFN) ;load data into array
"RTN","ACKQAG03",27,0)
C S SSN=$P($G(ACKQARR(1)),U,4)
"RTN","ACKQAG03",28,0)
 S ACKQHSSN=$$ENCRYP^XUSRB1(SSN)
"RTN","ACKQAG03",29,0)
 S $P(ACKQARR(1),U,4)=ACKQHSSN ;send encrypted SSN
"RTN","ACKQAG03",30,0)
 S ACKQVT=$P($G(ACKQARR(1)),U,11),ACKQVT=$E(ACKQVT,1,25) ;DFN type
"RTN","ACKQAG03",31,0)
 S X="MPIF001" X ^%ZOSF("TEST")
"RTN","ACKQAG03",32,0)
 I  S ICN=$$GETICN^MPIF001(DFN),ICN=$E(ICN,1,10)
"RTN","ACKQAG03",33,0)
 E  S ICN=""
"RTN","ACKQAG03",34,0)
 S I=$O(ACKQARR("A"),-1),I=I+1 ;ADD AFTER LAST SUBSCRIPT
"RTN","ACKQAG03",35,0)
 S ACKQARR(I)="DDCINFO"_U_$G(ACKQSTNU)_U_$G(ACKQUSNM)_U_$G(ACKQUSSR)_U
"RTN","ACKQAG03",36,0)
 S ACKQARR(I)=ACKQARR(I)_$G(ACKQRMI)_U_$G(ACKQHSSN)_U_U_$G(ACKQVT)_U
"RTN","ACKQAG03",37,0)
 S ACKQARR(I)=ACKQARR(I)_$G(ICN)_U_$P(^ACK(509850.9,IEN,0),U,7) ;7/27/05
"RTN","ACKQAG03",38,0)
 S XMTEXT="ACKQARR(",XMDUZ=DUZ,XQDATE=DT,XMSUB="AUDIOGRAM DATA"
"RTN","ACKQAG03",39,0)
 D CHKLINES^XMXSEC1(XMDUZ,XMZ,.XMRESTR)
"RTN","ACKQAG03",40,0)
 I $D(XMRESTR("NONET")) D  G END
"RTN","ACKQAG03",41,0)
 .S ACKQER="Message too long for network. Limit "_XMRESTR("NONET")
"RTN","ACKQAG03",42,0)
 D EN1^XMD ;add text and send
"RTN","ACKQAG03",43,0)
 ;notify user with tracking details
"RTN","ACKQAG03",44,0)
 ;S XMSUB="AUDIOGRAM DATA SENT"
"RTN","ACKQAG03",45,0)
 ;S XMY(DUZ)="",XMDUZ="AUDIOGRAM PKG"
"RTN","ACKQAG03",46,0)
 ;D XMZ^XMA2 ;gets XMZ
"RTN","ACKQAG03",47,0)
 ;K ACKQARR
"RTN","ACKQAG03",48,0)
 ;S ACKQARR(1)="Message sent to DDC is number: "_ACKQMSG
"RTN","ACKQAG03",49,0)
 ;S ACKQARR(2)="Sent on: "_$$FMTE^XLFDT(DT)_" for patient:"_$P($G(^DPT(DFN,0)),U,1)
"RTN","ACKQAG03",50,0)
 ;S ACKQARR(3)="Data sent is from AUDIOMETRIC EXAM file entry number: "_ACKQRMI
"RTN","ACKQAG03",51,0)
 ;S XMTEXT="ACKQARR("
"RTN","ACKQAG03",52,0)
 ;D EN1^XMD ;add text and send
"RTN","ACKQAG03",53,0)
 ;put the date sent to DALC and the msg number into the Audiogram Data file
"RTN","ACKQAG03",54,0)
 S DIE="^ACK(509850.9,",DA=ACKQRMI
"RTN","ACKQAG03",55,0)
 I $P($G(^ACK(509850.9,ACKQRMI,0)),U,12) D  ;already sent 1 time
"RTN","ACKQAG03",56,0)
 .S DR=".15////"_DT_";.13////"_ACKQMSG_";.16////"_DUZ
"RTN","ACKQAG03",57,0)
 E  S DR=".12////"_DT_";.13////"_ACKQMSG
"RTN","ACKQAG03",58,0)
 D ^DIE K DIE,DR,DA
"RTN","ACKQAG03",59,0)
END D:$G(ACKQER) WRITEER K ACKQARR,I
"RTN","ACKQAG03",60,0)
 ;XMMG is the failure msg if there is one
"RTN","ACKQAG03",61,0)
 S RESULT=$G(XMZ)_U_$G(ACKQMSG)_U_$G(ACKQER)_U_$G(XMMG)
"RTN","ACKQAG03",62,0)
 Q
"RTN","ACKQAG03",63,0)
ERRTEXT(ACKQERR) ;error msg's, input error #
"RTN","ACKQAG03",64,0)
 N ACKQER1 ;ERROR TEXT
"RTN","ACKQAG03",65,0)
 S ACKQER1=$P($T(@(ACKQERR_"^ACKQAG03")),";",3) G ENDE
"RTN","ACKQAG03",66,0)
1 ;;THE AUDIOMETRIC DATA FILE CANNOT BE ACCESSED
"RTN","ACKQAG03",67,0)
2 ;;THERE IS NOT A VALID ENTRY FOR THIS PATIENT
"RTN","ACKQAG03",68,0)
3 ;;THE MESSAGE COULD NOT BE SET UP
"RTN","ACKQAG03",69,0)
4 ;;THE ADDRESS COULD NOT BE SET UP
"RTN","ACKQAG03",70,0)
5 ;;THERE HAS BEEN AN ERROR IN COLLECTING THE AUDIOMETRIC DATA
"RTN","ACKQAG03",71,0)
6 ;;ONE OF THE MESSAGE LINES WAS TOO LONG
"RTN","ACKQAG03",72,0)
7 ;;AN ERROR OCCURRED WHILE PLACING THE DATA INTO THE TRANSMISSION
"RTN","ACKQAG03",73,0)
8 ;;THE ENTRY FOUND IS NOT THE SAME ENTRY THAT IS BEING EDITED
"RTN","ACKQAG03",74,0)
9 ;;THERE IS A CONFLICT BETWEEN THE PATIENT AND THE FILE ENTRY
"RTN","ACKQAG03",75,0)
 ;;
"RTN","ACKQAG03",76,0)
ENDE Q ACKQER1
"RTN","ACKQAG03",77,0)
 ;
"RTN","ACKQAG03",78,0)
WRITEER ;W !!,"*****",ACKQER,"*****" ;for testing
"RTN","ACKQAG03",79,0)
 ;S:$L($G(XMMG)) ACKQER="MSG FAILURE"
"RTN","ACKQAG03",80,0)
 S ACKQER="*****"_ACKQER_"*****"
"RTN","ACKQAG03",81,0)
 Q
"RTN","ACKQAG05")
0^2^B20304579^B19012760
"RTN","ACKQAG05",1,0)
ACKQAG05        ;DALC/PJU - UTILITY FOR TRANSMISSION ;02/09/07
"RTN","ACKQAG05",2,0)
 ;;3.0;QUASAR AUDIOMETRIC MODULE;**3,12,13**;11/01/02;Build 24
"RTN","ACKQAG05",3,0)
    ;;ALSO CALLED FROM ACKQAG03
"RTN","ACKQAG05",4,0)
 ; IA# 10103 [Supported] call to FMTE^XLFDT - change date
"RTN","ACKQAG05",5,0)
 ; IA# 10066 [Supported] call to XMZ^XMA2 - new message stub
"RTN","ACKQAG05",6,0)
 ; IA# 2701  [Supported] call to GETICN^MPIF001 - get ICN
"RTN","ACKQAG05",7,0)
 ; IA# 10070 [Supported] call to EN1^XMD - add message text & send
"RTN","ACKQAG05",8,0)
 ; IA# 2732  [Supported] call to CHKLINES^XMXSEC1 - check message length
"RTN","ACKQAG05",9,0)
 ; IA# 2240  [Supported] call to ENCRYP^XUSRB1 - encrypt SSN
"RTN","ACKQAG05",10,0)
ACKEXIST()      ;returns 1 if 509850.9 exists, else 0
"RTN","ACKQAG05",11,0)
 N ACKQANS
"RTN","ACKQAG05",12,0)
 I $D(^ACK(509850.9)),$O(^ACK(509850.9,0)) S ACKQANS=1
"RTN","ACKQAG05",13,0)
 E  S ACKQANS=0
"RTN","ACKQAG05",14,0)
ENDA Q ACKQANS
"RTN","ACKQAG05",15,0)
 ;
"RTN","ACKQAG05",16,0)
DFNIN(DFN)      ;input DFN of patient
"RTN","ACKQAG05",17,0)
 ;return last entry in 509850.9 for DFN or 0 if none
"RTN","ACKQAG05",18,0)
 N ACKQANS,ACKQI,ACKQL
"RTN","ACKQAG05",19,0)
 S ACKQANS=0
"RTN","ACKQAG05",20,0)
 I $D(^ACK(509850.9,"DFN",DFN)) D
"RTN","ACKQAG05",21,0)
 .S ACKQL="A"
"RTN","ACKQAG05",22,0)
 .S ACKQL=$O(^ACK(509850.9,"DFN",DFN,ACKQL),-1) Q:'ACKQL  ;last date
"RTN","ACKQAG05",23,0)
 .S ACKQI=0
"RTN","ACKQAG05",24,0)
 .S ACKQI=$O(^ACK(509850.9,"DFN",DFN,ACKQL,ACKQI)) Q:'ACKQI  ;entry
"RTN","ACKQAG05",25,0)
 .I ACKQI>0 I $G(^ACK(509850.9,ACKQI,0))'="" S ACKQANS=ACKQI
"RTN","ACKQAG05",26,0)
ENDD    Q ACKQANS
"RTN","ACKQAG05",27,0)
 ;
"RTN","ACKQAG05",28,0)
NEWMSG()  ;return entry in ^XMB(3.9
"RTN","ACKQAG05",29,0)
 ; requires DUZ, sets up XMDUZ, XMSUB
"RTN","ACKQAG05",30,0)
 ;outputs XMZ
"RTN","ACKQAG05",31,0)
 S XMSUB="AUDIOGRAM DATA TRANSMISSION",XMDUZ=DUZ
"RTN","ACKQAG05",32,0)
 S XMY("S.RMROES3@DDC.VA.GOV")=""
"RTN","ACKQAG05",33,0)
 ;S XMY("S.RMROES3@DDCTRN.VA.GOV")="" ;for testing
"RTN","ACKQAG05",34,0)
 D XMZ^XMA2 ;returns XMZ
"RTN","ACKQAG05",35,0)
 Q XMZ
"RTN","ACKQAG05",36,0)
 ;
"RTN","ACKQAG05",37,0)
DFNCT(RESULT,DFN) ;Return number of entries in 509850.9 file
"RTN","ACKQAG05",38,0)
 ;outputs a number based on the DFN2 xref on DFN only
"RTN","ACKQAG05",39,0)
 ;Called by RPC ACKQAUD4
"RTN","ACKQAG05",40,0)
 N CT,I S (RESULT,CT,I)=0
"RTN","ACKQAG05",41,0)
 ;G:'$D(^ACK(509850.9,"DFN2",DFN)) ENDC
"RTN","ACKQAG05",42,0)
 ;F  S I=$O(^ACK(509850.9,"DFN2",DFN,I)) Q:'I  S CT=CT+1
"RTN","ACKQAG05",43,0)
 ;S RESULT=CT
"RTN","ACKQAG05",44,0)
 S RESULT(0)=CT_U_$P($G(^DPT(DFN,0)),U,1)
"RTN","ACKQAG05",45,0)
 F  S I=$O(^ACK(509850.9,"DFN2",DFN,I)) Q:'I  D
"RTN","ACKQAG05",46,0)
 .S CT=CT+1
"RTN","ACKQAG05",47,0)
 .S RESULT(CT)=I,$P(RESULT(0),U,1)=CT
"RTN","ACKQAG05",48,0)
ENDC Q RESULT
"RTN","ACKQAG05",49,0)
 ;
"RTN","ACKQAG05",50,0)
 ;STARTD(RESULT,DFN,IEN,RMUSER)
"RTN","ACKQAG05",51,0)
STARTD(RESULT,DFN,IEN,ACKQSTNU,ACKQUSNM,ACKQUSSR) ;
"RTN","ACKQAG05",52,0)
 ;Deletion message for RPC ACKQROESD (DFN & IEN are required)
"RTN","ACKQAG05",53,0)
 ;N ACKQER,ACKQERR,ACKQFA,ACKQHSSN,ACKQMSG,DFNNAME,SSN,ST
"RTN","ACKQAG05",54,0)
 N ACKQER,ACKQERR,ACKQFA,ACKQHSSN,ACKQMSG,ACKQRMI,ACKQVT,SSN,ST,ICN
"RTN","ACKQAG05",55,0)
 K ACKQARR S ACKQARR(0)="",ACKQMSG="",XMZ="",ACKQER="",XMMG=""
"RTN","ACKQAG05",56,0)
 N XMTEXT,XMDUZ,XMRESTR,XMY,XMSUB
"RTN","ACKQAG05",57,0)
 ;check for existance and get entry
"RTN","ACKQAG05",58,0)
 S ACKQFA=$$ACKEXIST() ;ck if file exist
"RTN","ACKQAG05",59,0)
 I 'ACKQFA S ACKQER=$$ERRTEXT(1) G ENDS ;file not exist
"RTN","ACKQAG05",60,0)
 I $G(IEN),$D(^ACK(509850.9,IEN,0)) D  G ENDS ;local IEN not deleted
"RTN","ACKQAG05",61,0)
 .S ACKQER=$$ERRTEXT(10)
"RTN","ACKQAG05",62,0)
 S ACKQRMI=IEN ;10/5/05
"RTN","ACKQAG05",63,0)
 ;create stub and address to S.RMROES3@DDC.VA.GOV
"RTN","ACKQAG05",64,0)
 S (ACKQMSG,XMZ)=$$NEWMSG() ;returns XMZ addressed to S.RMROES3@DDC.VA.GOV
"RTN","ACKQAG05",65,0)
 ;get data into array ACKQARR
"RTN","ACKQAG05",66,0)
 ;ACKQARR(1)=BGN^IEN^DFNNAME^DFNssn^err^bd^tester^Signdt^ex dt^vet^type^age^tt^cl#^retran dt^"D"
"RTN","ACKQAG05",67,0)
 S DFNNAME=$P($G(^DPT(DFN,0)),U,1)
"RTN","ACKQAG05",68,0)
 S SSN=$P($G(^DPT(DFN,0)),U,9)
"RTN","ACKQAG05",69,0)
 S ACKQHSSN=$$ENCRYP^XUSRB1(SSN)
"RTN","ACKQAG05",70,0)
 S ACKQARR(1)="BGN^"_ACKQRMI_"^"_DFNNAME_"^"_ACKQHSSN_"^^^^^^^^^^^" ;send encrypted SSN
"RTN","ACKQAG05",71,0)
 S ACKQARR(1)=ACKQARR(1)_DT_"^"_"D"  ;tran date & delete flag
"RTN","ACKQAG05",72,0)
 S X="MPIF001" X ^%ZOSF("TEST")
"RTN","ACKQAG05",73,0)
 I  S ICN=$$GETICN^MPIF001(DFN),ICN=$E(ICN,1,10)
"RTN","ACKQAG05",74,0)
 E  S ICN=""
"RTN","ACKQAG05",75,0)
 S ACKQARR(2)="DDCINFO"_U_$G(ACKQSTNU)_U_$G(ACKQUSNM)_U_$G(ACKQUSSR)_U
"RTN","ACKQAG05",76,0)
 S ACKQARR(2)=ACKQARR(2)_$G(ACKQRMI)_U_$G(ACKQHSSN)_U_U_U_$G(ICN)
"RTN","ACKQAG05",77,0)
 S XMTEXT="ACKQARR(",XMDUZ=DUZ,XQDATE=DT,XMSUB="AUIDOGRAM DATA TRANSMISSION"
"RTN","ACKQAG05",78,0)
 D CHKLINES^XMXSEC1(XMDUZ,XMZ,.XMRESTR)
"RTN","ACKQAG05",79,0)
 I $D(XMRESTR("NONET")) D  G ENDS
"RTN","ACKQAG05",80,0)
 .S ACKQER="Message too long for network. Limit "_XMRESTR("NONET")
"RTN","ACKQAG05",81,0)
 D EN1^XMD ;add text and send
"RTN","ACKQAG05",82,0)
 ;notify user
"RTN","ACKQAG05",83,0)
 S XMSUB="AUDIOGRAM DELETION SENT"
"RTN","ACKQAG05",84,0)
 S XMY(DUZ)="",XMDUZ="AUDIOGRAM PKG"
"RTN","ACKQAG05",85,0)
 D XMZ^XMA2 ;returns XMZ
"RTN","ACKQAG05",86,0)
 K ACKQARR
"RTN","ACKQAG05",87,0)
 S ACKQARR(1)="Deletion Message to DALC for "_DFNNAME_" is MSG number:"_ACKQMSG
"RTN","ACKQAG05",88,0)
 S ACKQARR(2)="Sent on: "_$$FMTE^XLFDT(DT)
"RTN","ACKQAG05",89,0)
 S ACKQARR(3)="AUDIOMETRIC EXAM file entry number: "_ACKQRMI
"RTN","ACKQAG05",90,0)
 S XMTEXT="ACKQARR(",XMSUB="AUDIOGRAM DELETION"
"RTN","ACKQAG05",91,0)
 D EN1^XMD ;add text and send
"RTN","ACKQAG05",92,0)
ENDS D:$L($G(ACKQER)) WRITEER K ACKQARR,I
"RTN","ACKQAG05",93,0)
 ;XMMG is the failure msg if there is one
"RTN","ACKQAG05",94,0)
 S RESULT=$G(XMZ)_U_$G(ACKQMSG)_U_$G(ACKQER)_U_$G(XMMG)
"RTN","ACKQAG05",95,0)
 Q
"RTN","ACKQAG05",96,0)
 ;
"RTN","ACKQAG05",97,0)
ERRTEXT(ACKQERR) ;error msg's, input error #
"RTN","ACKQAG05",98,0)
 N ACKQER1 ;ERROR TEXT
"RTN","ACKQAG05",99,0)
 S ACKQER1=$P($T(@(ACKQERR_"^ACKQAG05")),";",3) G ENDE
"RTN","ACKQAG05",100,0)
1 ;;THE AUDIOMETRIC DATA FILE CANNOT BE ACCESSED
"RTN","ACKQAG05",101,0)
2 ;;THERE IS NOT A VALID ENTRY FOR THIS PATIENT
"RTN","ACKQAG05",102,0)
3 ;;THE MESSAGE COULD NOT BE SET UP
"RTN","ACKQAG05",103,0)
4 ;;THE ADDRESS COULD NOT BE SET UP
"RTN","ACKQAG05",104,0)
5 ;;THERE HAS BEEN AN ERROR IN COLLECTING THE AUDIOMETRIC DATA
"RTN","ACKQAG05",105,0)
6 ;;ONE OF THE MESSAGE LINES WAS TOO LONG
"RTN","ACKQAG05",106,0)
7   ;;AN ERROR OCCURRED WHILE PLACING THE DATA INTO THE TRANSMISSION
"RTN","ACKQAG05",107,0)
8 ;;THE ENTRY FOUND IS NOT THE SAME ENTRY THAT IS BEING EDITED
"RTN","ACKQAG05",108,0)
9 ;;THERE IS A CONFLICT BETWEEN THE PATIENT AND THE FILE ENTRY
"RTN","ACKQAG05",109,0)
10 ;;THE RECORD SELECTED HAS NOT BEEN LOCALLY DELETED
"RTN","ACKQAG05",110,0)
ENDE Q ACKQER1
"RTN","ACKQAG05",111,0)
 ;
"RTN","ACKQAG05",112,0)
WRITEER ;W !!,"*****",ACKQER,"*****" ;for testing
"RTN","ACKQAG05",113,0)
 ;S:$L($G(XMMG)) ACKQER="MSG FAILURE"
"RTN","ACKQAG05",114,0)
 S ACKQER="*****"_ACKQER_"*****"
"RTN","ACKQAG05",115,0)
 Q
"VER")
8.0^22.0
"^DD",509850.9,509850.9,110.28,0)
LIST R-1^F^^110;28^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,110.28,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,110.28,21,0)
^.001^1^1^3070126^^^
"^DD",509850.9,509850.9,110.28,21,1,0)
Word list used for Test 1 of the Right ear.
"^DD",509850.9,509850.9,110.28,"DT")
3070130
"^DD",509850.9,509850.9,110.29,0)
LIST R-2^F^^110;29^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,110.29,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,110.29,21,0)
^^1^1^3050726^
"^DD",509850.9,509850.9,110.29,21,1,0)
Word list used for Test 2 of the Right ear.
"^DD",509850.9,509850.9,110.29,"DT")
3070126
"^DD",509850.9,509850.9,110.3,0)
LIST R-3^F^^110;30^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,110.3,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,110.3,21,0)
^^1^1^3050726^
"^DD",509850.9,509850.9,110.3,21,1,0)
Word list used for Test 3 of the Right ear.
"^DD",509850.9,509850.9,110.3,"DT")
3070126
"^DD",509850.9,509850.9,110.31,0)
LIST R-4^F^^110;31^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,110.31,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,110.31,21,0)
^^1^1^3050726^
"^DD",509850.9,509850.9,110.31,21,1,0)
Word list used for Test 4 of the Right ear.
"^DD",509850.9,509850.9,110.31,"DT")
3070126
"^DD",509850.9,509850.9,110.32,0)
LIST R-5^F^^110;32^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,110.32,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,110.32,21,0)
^^1^1^3050726^
"^DD",509850.9,509850.9,110.32,21,1,0)
Word list used for Test 5 of the Right ear.
"^DD",509850.9,509850.9,110.32,"DT")
3070126
"^DD",509850.9,509850.9,111.28,0)
LIST L-1^F^^111;28^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,111.28,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,111.28,21,0)
^.001^1^1^3050802^^
"^DD",509850.9,509850.9,111.28,21,1,0)
Word list used for Test 1 of the Left ear.
"^DD",509850.9,509850.9,111.28,"DT")
3070126
"^DD",509850.9,509850.9,111.29,0)
LIST L-2^F^^111;29^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,111.29,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,111.29,21,0)
^^1^1^3050726^
"^DD",509850.9,509850.9,111.29,21,1,0)
Word list used for Test 2 of the Left ear.
"^DD",509850.9,509850.9,111.29,"DT")
3070126
"^DD",509850.9,509850.9,111.3,0)
LIST L-3^F^^111;30^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,111.3,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,111.3,21,0)
^^1^1^3050726^
"^DD",509850.9,509850.9,111.3,21,1,0)
Word list used for Test 3 of the Left ear.
"^DD",509850.9,509850.9,111.3,"DT")
3070126
"^DD",509850.9,509850.9,111.31,0)
LIST L-4^F^^111;31^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,111.31,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,111.31,21,0)
^^1^1^3050726^
"^DD",509850.9,509850.9,111.31,21,1,0)
Word list used for Test 4 of the Left ear.
"^DD",509850.9,509850.9,111.31,"DT")
3070126
"^DD",509850.9,509850.9,111.32,0)
LIST L-5^F^^111;32^K:$L(X)>4!($L(X)<1) X
"^DD",509850.9,509850.9,111.32,3)
Answer must be 1-4 characters in length.
"^DD",509850.9,509850.9,111.32,21,0)
^^1^1^3050726^
"^DD",509850.9,509850.9,111.32,21,1,0)
Word list used for Test 5 of the Left ear.
"^DD",509850.9,509850.9,111.32,"DT")
3070126
"^DD",509850.9,509850.9,115.19,0)
APPLIED MAX R^NJ1,0^^115;19^K:+X'=X!(X>5)!(X<0)!(X?.E1"."1N.N) X
"^DD",509850.9,509850.9,115.19,3)
Type a Number between 0 and 5, 0 Decimal Digits
"^DD",509850.9,509850.9,115.19,21,0)
^^2^2^3070207^
"^DD",509850.9,509850.9,115.19,21,1,0)
This field contains the test to use for PB Max. It will be manually
"^DD",509850.9,509850.9,115.19,21,2,0)
selected from the GUI if it is anything other than the default.
"^DD",509850.9,509850.9,115.19,"DT")
3061130
"^DD",509850.9,509850.9,115.2,0)
APPLIED MAX L^NJ1,0^^115;20^K:+X'=X!(X>5)!(X<0)!(X?.E1"."1N.N) X
"^DD",509850.9,509850.9,115.2,3)
Type a Number between 0 and 5, 0 Decimal Digits
"^DD",509850.9,509850.9,115.2,21,0)
^^2^2^3070207^
"^DD",509850.9,509850.9,115.2,21,1,0)
This field contains the test to use for PB Max. It will be manually
"^DD",509850.9,509850.9,115.2,21,2,0)
selected from the GUI if it is anything other than the default.
"^DD",509850.9,509850.9,115.2,"DT")
3061130
"BLD",6476,6)
^12
**END**
**END**
