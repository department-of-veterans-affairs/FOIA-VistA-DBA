Released MPIF*1*36 SEQ #34
Extracted from mail message
**KIDS**:MPIF*1.0*36^

**INSTALL NAME**
MPIF*1.0*36
"BLD",2027,0)
MPIF*1.0*36^MASTER PATIENT INDEX VISTA^0^3040823^y
"BLD",2027,1,0)
^^3^3^3040823^
"BLD",2027,1,1,0)
RPC to PUSH CMOR from MPI and Remote Sync of Data
"BLD",2027,1,2,0)
Refer to patch MPIF*1*36 in the FORUM Patch Module for a complete
"BLD",2027,1,3,0)
description.
"BLD",2027,4,0)
^9.64PA^^
"BLD",2027,"ABNS",0)
^9.66A^^
"BLD",2027,"ABPKG")
n^n^
"BLD",2027,"KRN",0)
^9.67PA^8989.52^19
"BLD",2027,"KRN",.4,0)
.4
"BLD",2027,"KRN",.401,0)
.401
"BLD",2027,"KRN",.402,0)
.402
"BLD",2027,"KRN",.403,0)
.403
"BLD",2027,"KRN",.5,0)
.5
"BLD",2027,"KRN",.84,0)
.84
"BLD",2027,"KRN",3.6,0)
3.6
"BLD",2027,"KRN",3.8,0)
3.8
"BLD",2027,"KRN",9.2,0)
9.2
"BLD",2027,"KRN",9.8,0)
9.8
"BLD",2027,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",2027,"KRN",9.8,"NM",1,0)
MPIFRCMP^^0^B11707572
"BLD",2027,"KRN",9.8,"NM","B","MPIFRCMP",1)
 
"BLD",2027,"KRN",19,0)
19
"BLD",2027,"KRN",19.1,0)
19.1
"BLD",2027,"KRN",101,0)
101
"BLD",2027,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",2027,"KRN",101,"NM",1,0)
MPIF ADT-A31 CLIENT^^0
"BLD",2027,"KRN",101,"NM",2,0)
MPIF ADT-A31 SERVER^^0
"BLD",2027,"KRN",101,"NM","B","MPIF ADT-A31 CLIENT",1)
 
"BLD",2027,"KRN",101,"NM","B","MPIF ADT-A31 SERVER",2)
 
"BLD",2027,"KRN",409.61,0)
409.61
"BLD",2027,"KRN",771,0)
771
"BLD",2027,"KRN",870,0)
870
"BLD",2027,"KRN",8989.51,0)
8989.51
"BLD",2027,"KRN",8989.52,0)
8989.52
"BLD",2027,"KRN",8994,0)
8994
"BLD",2027,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",2027,"KRN",8994,"NM",1,0)
MPIF CMOR PUSH REMOTE^^0
"BLD",2027,"KRN",8994,"NM","B","MPIF CMOR PUSH REMOTE",1)
 
"BLD",2027,"KRN","B",.4,.4)
 
"BLD",2027,"KRN","B",.401,.401)
 
"BLD",2027,"KRN","B",.402,.402)
 
"BLD",2027,"KRN","B",.403,.403)
 
"BLD",2027,"KRN","B",.5,.5)
 
"BLD",2027,"KRN","B",.84,.84)
 
"BLD",2027,"KRN","B",3.6,3.6)
 
"BLD",2027,"KRN","B",3.8,3.8)
 
"BLD",2027,"KRN","B",9.2,9.2)
 
"BLD",2027,"KRN","B",9.8,9.8)
 
"BLD",2027,"KRN","B",19,19)
 
"BLD",2027,"KRN","B",19.1,19.1)
 
"BLD",2027,"KRN","B",101,101)
 
"BLD",2027,"KRN","B",409.61,409.61)
 
"BLD",2027,"KRN","B",771,771)
 
"BLD",2027,"KRN","B",870,870)
 
"BLD",2027,"KRN","B",8989.51,8989.51)
 
"BLD",2027,"KRN","B",8989.52,8989.52)
 
"BLD",2027,"KRN","B",8994,8994)
 
"BLD",2027,"QUES",0)
^9.62^^
"BLD",2027,"REQB",0)
^9.611^^
"KRN",101,1865,-1)
0^2
"KRN",101,1865,0)
MPIF ADT-A31 SERVER^ADT-A31 SERVER^^E^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",101,1865,1,0)
^^3^3^3020724^
"KRN",101,1865,1,1,0)
This protocol is used to send an HL7 v2.4 ADT-A31 (update 
"KRN",101,1865,1,2,0)
patient information) message from VistA to the MPI.  The event will result
"KRN",101,1865,1,3,0)
in the updating of patient data on the MPI for that ICN.
"KRN",101,1865,99)
58843,33653
"KRN",101,1865,770)
MPIF TRIGGER^^ADT^A31^^^^AL^AL^2.4^
"KRN",101,1865,772)
D RES^MPIFA31B
"KRN",101,1865,775,0)
^101.0775PA^1^1
"KRN",101,1865,775,1,0)
1866
"KRN",101,1865,775,1,"^")
MPIF ADT-A31 CLIENT
"KRN",101,1866,-1)
0^1
"KRN",101,1866,0)
MPIF ADT-A31 CLIENT^ADT-A31 CLIENT^^S^^^^^^^^MASTER PATIENT INDEX VISTA
"KRN",101,1866,1,0)
^101.06^3^3^3020724^^
"KRN",101,1866,1,1,0)
This protocol is used to send an HL7 v2.4 ADT-A31 (update 
"KRN",101,1866,1,2,0)
patient information) message from VistA to the MPI.  The event will result
"KRN",101,1866,1,3,0)
in the updating of patient data on the MPI for that ICN.
"KRN",101,1866,99)
59009,36892
"KRN",101,1866,770)
^MPIF TRIGGER^^A31^^^^^^^ACK
"KRN",101,1866,771)
D INIT^RGADTP
"KRN",101,1866,773)
1^1
"KRN",101,1866,774)
Q
"KRN",8994,190,-1)
0^1
"KRN",8994,190,0)
MPIF CMOR PUSH REMOTE^EN^MPIFRCMP^1^S^^^^1
"KRN",8994,190,1,0)
^8994.01^2^2^3040624^
"KRN",8994,190,1,1,0)
This remote procedure call (RPC) allows the DQ team to remotely create a 
"KRN",8994,190,1,2,0)
change of CMOR push.
"KRN",8994,190,2,0)
^8994.02A^2^2
"KRN",8994,190,2,1,0)
ICN^1^10^1^2
"KRN",8994,190,2,1,1,0)
^^1^1^3040624^
"KRN",8994,190,2,1,1,1,0)
ICN - not including the checksum
"KRN",8994,190,2,2,0)
NCMOR^1^3^1^3
"KRN",8994,190,2,2,1,0)
^8994.021^1^1^3040624^^
"KRN",8994,190,2,2,1,1,0)
The station number of the site that is to become the CMOR.
"KRN",8994,190,2,"B","ICN",1)
 
"KRN",8994,190,2,"B","NCMOR",2)
 
"KRN",8994,190,2,"PARAMSEQ",2,1)
 
"KRN",8994,190,2,"PARAMSEQ",3,2)
 
"KRN",8994,190,3,0)
^^2^2^3040624^
"KRN",8994,190,3,1,0)
1 if successfully requested PUSH of CMOR to site NCMOR.
"KRN",8994,190,3,2,0)
-1^error messag if unable to make the request.
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",282,-1)
1^1
"PKG",282,0)
MASTER PATIENT INDEX VISTA^MPIF^Master Patient Index VistA side
"PKG",282,20,0)
^9.402P^^
"PKG",282,22,0)
^9.49I^1^1
"PKG",282,22,1,0)
1.0^2990428
"PKG",282,22,1,"PAH",1,0)
36^3040823
"PKG",282,22,1,"PAH",1,1,0)
^^3^3^3040823
"PKG",282,22,1,"PAH",1,1,1,0)
RPC to PUSH CMOR from MPI and Remote Sync of Data
"PKG",282,22,1,"PAH",1,1,2,0)
Refer to patch MPIF*1*36 in the FORUM Patch Module for a complete
"PKG",282,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","MPIFRCMP")
0^1^B11707572
"RTN","MPIFRCMP",1,0)
MPIFRCMP ;BPCIO/CMC-PUSHING CMOR TO ANOTHER SITE REMOTELY ;JUNE 23, 2004
"RTN","MPIFRCMP",2,0)
 ;;1.0; MASTER PATIENT INDEX VISTA ;**36**;30 Apr 99
"RTN","MPIFRCMP",3,0)
 ;
"RTN","MPIFRCMP",4,0)
 ; Integration Agreements Utilized:
"RTN","MPIFRCMP",5,0)
 ;
"RTN","MPIFRCMP",6,0)
 ; ^DGCN(391.91   IA #2751
"RTN","MPIFRCMP",7,0)
 ; AVAFC^VAFCDD01 IA #3493
"RTN","MPIFRCMP",8,0)
 ;
"RTN","MPIFRCMP",9,0)
 ; Create a new request to change CMOR when your site is the CMOR VIA
"RTN","MPIFRCMP",10,0)
 ; Remote RPC from the MPI
"RTN","MPIFRCMP",11,0)
 ;
"RTN","MPIFRCMP",12,0)
EN(RETURN,ICN,NCMOR) ;
"RTN","MPIFRCMP",13,0)
 ; RETURN - Array to return the value 1 if successfully created request
"RTN","MPIFRCMP",14,0)
 ; or -1^error message
"RTN","MPIFRCMP",15,0)
 ; ICN - ICN for the patient that the CMOR is being changed for
"RTN","MPIFRCMP",16,0)
 ; NCMOR - Which site should be the new CMOR - Station #
"RTN","MPIFRCMP",17,0)
 ;
"RTN","MPIFRCMP",18,0)
 N DFN
"RTN","MPIFRCMP",19,0)
 S DFN=$$GETDFN^MPIF001(+ICN)
"RTN","MPIFRCMP",20,0)
 I +DFN<1 S RETURN="-1^No such ICN at site" Q
"RTN","MPIFRCMP",21,0)
 I $$GETVCCI^MPIF001(DFN)<0 S RETURN="-1^Patient doesn't have a CMOR" Q
"RTN","MPIFRCMP",22,0)
 I $$GETVCCI^MPIF001(DFN)'=$P($$SITE^VASITE(),"^",3) S RETURN="-1^This site is NOT the CMOR, can't push the CMOR somewhere else." Q
"RTN","MPIFRCMP",23,0)
 N TMP,TCNT,TF
"RTN","MPIFRCMP",24,0)
 S TF=0
"RTN","MPIFRCMP",25,0)
 S TMP=$O(^DGCN(391.91,"APAT",DFN,"")) I $O(^DGCN(391.91,"APAT",DFN,TMP))="" S RETURN="-1^Patient isn't SHARED - CAN'T change CMOR" Q
"RTN","MPIFRCMP",26,0)
 ;Pt is shared, but are they shared with another VAMC?
"RTN","MPIFRCMP",27,0)
 S TMP="",TCNT=0 F  S TMP=$O(^DGCN(391.91,"APAT",DFN,TMP)) Q:TMP=""  D
"RTN","MPIFRCMP",28,0)
 .N TP S TP=$$GET1^DIQ(4,TMP_",",13)
"RTN","MPIFRCMP",29,0)
 .Q:TP'="VAMC"&(TP'="OC")&(TP'="M&ROC")&(TP'="RO-OC")
"RTN","MPIFRCMP",30,0)
 .; ^ only valid types of TFs that can be a CMOR 
"RTN","MPIFRCMP",31,0)
 .S TCNT=TCNT+1
"RTN","MPIFRCMP",32,0)
 .I $$STA^XUAF4(TMP)=NCMOR S TF=1
"RTN","MPIFRCMP",33,0)
 I TCNT<2 S RETURN="-1^Patient isn't SHARED with another VAMC - CAN'T change CMOR" Q
"RTN","MPIFRCMP",34,0)
 I TF=0 S RETURN="-1^Site to be new CMOR is NOT a TF - Can't change CMOR" Q
"RTN","MPIFRCMP",35,0)
 ; CHECK IF ALREADY OPEN/PENDING REQUEST
"RTN","MPIFRCMP",36,0)
 N ENT,STOP,MPIFNM,REQNM
"RTN","MPIFRCMP",37,0)
 S ENT=0,STOP=0 F  S ENT=$O(^MPIF(984.9,"C",DFN,ENT)) Q:ENT=""!(STOP)  D
"RTN","MPIFRCMP",38,0)
 .I $P($G(^MPIF(984.9,ENT,0)),"^",6)<4 S STOP=1
"RTN","MPIFRCMP",39,0)
 I STOP S RETURN="-1^There is already an open CMOR request for this patient" Q
"RTN","MPIFRCMP",40,0)
 N DA,DIE,DR,DIK,Y,DIRUT,REQ,TDA,XX,WHO,PHONE
"RTN","MPIFRCMP",41,0)
 S DA=$$ADD^MPIFNEW(),TDA=DA,PHONE=""
"RTN","MPIFRCMP",42,0)
 S DIE="^MPIF(984.9,",DR=".04///`"_DFN D ^DIE
"RTN","MPIFRCMP",43,0)
 S REQ=$P($G(^MPIF(984.9,DA,0)),"^")
"RTN","MPIFRCMP",44,0)
 S XX="CMOR Push by MPI Data Quality Team",WHO=.5,PHONE="MPI DQ Team"
"RTN","MPIFRCMP",45,0)
 S DIE="^MPIF(984.9,",DR="1.02///"_XX_";.02///`"_WHO_";.05///"_PHONE D ^DIE
"RTN","MPIFRCMP",46,0)
 N TSITE S TSITE=$$IEN^XUAF4(NCMOR)
"RTN","MPIFRCMP",47,0)
 S DIE="^MPIF(984.9,",DR=".07///`"_TSITE_";1.03///3;.09///`"_TSITE D ^DIE
"RTN","MPIFRCMP",48,0)
 ;update site, type of action and cmor after approval
"RTN","MPIFRCMP",49,0)
 ;
"RTN","MPIFRCMP",50,0)
 I $$CHK^MPIFEDIT(DA) S RETURN="-1^This request is missing required data." Q
"RTN","MPIFRCMP",51,0)
 ;
"RTN","MPIFRCMP",52,0)
 S DR=".08////^S X=2;.06////^S X=2",DIE="^MPIF(984.9," D ^DIE S RETURN=1
"RTN","MPIFRCMP",53,0)
 ; removed event queue due to delivery issues - this msg must be sent first followed by the actual change cmor msg.
"RTN","MPIFRCMP",54,0)
 N ERR,MPIFHL7 S ERR="ERRS",MPIFHL7=""
"RTN","MPIFRCMP",55,0)
 D EN^MPIFREQ("CMOR CHANGE REQUEST",DA,.ERR,MPIFHL7)
"RTN","MPIFRCMP",56,0)
 ;
"RTN","MPIFRCMP",57,0)
 ;NOW CHANGE CMOR AND SEND CHANGE CMOR MESSAGE
"RTN","MPIFRCMP",58,0)
 N TEXT,DIR,DR,CMOR,TMP,ERROR
"RTN","MPIFRCMP",59,0)
 S TEXT="Auto change - pushed CMOR",ERROR=0
"RTN","MPIFRCMP",60,0)
 S DIE="^MPIF(984.9,",DA=TDA,DR=".06///^S X=4;3.01///^S X=TEXT"
"RTN","MPIFRCMP",61,0)
 D ^DIE
"RTN","MPIFRCMP",62,0)
 S CMOR=$P($G(^MPIF(984.9,TDA,0)),"^",7)
"RTN","MPIFRCMP",63,0)
 I CMOR="" D  Q
"RTN","MPIFRCMP",64,0)
 .S RETURN="-1^New CMOR Not Defined, PROBLEM WITH REQUEST"
"RTN","MPIFRCMP",65,0)
 S TMP=$$CHANGE^MPIF001(DFN,CMOR)
"RTN","MPIFRCMP",66,0)
 I +TMP<0 S ^DIE="^MPIF(984.9,",DA=TDA,DR=".06///^S X=1" D ^DIE Q
"RTN","MPIFRCMP",67,0)
 D BROAD^MPIFCMOR(DA,.ERROR)
"RTN","MPIFRCMP",68,0)
 Q
"RTN","MPIFRCMP",69,0)
SYNC(RETURN,ICN) ;
"RTN","MPIFRCMP",70,0)
 N DFN
"RTN","MPIFRCMP",71,0)
 S DFN=$$GETDFN^MPIF001(ICN)
"RTN","MPIFRCMP",72,0)
 I +DFN<0 S RETURN(1)="-1^ICN doesn't exist at this site" Q
"RTN","MPIFRCMP",73,0)
 D AVAFC^VAFCDD01(DFN) ; trigger A08 msg
"RTN","MPIFRCMP",74,0)
 S RETURN(1)=1
"RTN","MPIFRCMP",75,0)
 Q
"VER")
8.0^22.0
**END**
**END**
