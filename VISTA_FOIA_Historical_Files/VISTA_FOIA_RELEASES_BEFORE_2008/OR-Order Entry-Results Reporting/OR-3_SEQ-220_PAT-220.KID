Released OR*3*220 SEQ #220
Extracted from mail message
**KIDS**:OR*3.0*220^

**INSTALL NAME**
OR*3.0*220
"BLD",5065,0)
OR*3.0*220^ORDER ENTRY/RESULTS REPORTING^0^3050816^y
"BLD",5065,4,0)
^9.64PA^^
"BLD",5065,"INID")
^n
"BLD",5065,"INIT")

"BLD",5065,"KRN",0)
^9.67PA^8989.52^19
"BLD",5065,"KRN",.4,0)
.4
"BLD",5065,"KRN",.4,"NM",0)
^9.68A^^
"BLD",5065,"KRN",.401,0)
.401
"BLD",5065,"KRN",.402,0)
.402
"BLD",5065,"KRN",.403,0)
.403
"BLD",5065,"KRN",.5,0)
.5
"BLD",5065,"KRN",.84,0)
.84
"BLD",5065,"KRN",3.6,0)
3.6
"BLD",5065,"KRN",3.8,0)
3.8
"BLD",5065,"KRN",9.2,0)
9.2
"BLD",5065,"KRN",9.8,0)
9.8
"BLD",5065,"KRN",9.8,"NM",0)
^9.68A^23^8
"BLD",5065,"KRN",9.8,"NM",1,0)
ORB3SPEC^^0^B80431397
"BLD",5065,"KRN",9.8,"NM",17,0)
ORB3^^0^B87608247
"BLD",5065,"KRN",9.8,"NM",18,0)
ORB31^^0^B31696153
"BLD",5065,"KRN",9.8,"NM",19,0)
ORB3U1^^0^B62203040
"BLD",5065,"KRN",9.8,"NM",20,0)
ORB3MGR1^^0^B70181169
"BLD",5065,"KRN",9.8,"NM",21,0)
ORB3F1^^0^B10770422
"BLD",5065,"KRN",9.8,"NM",22,0)
ORQ12^^0^B29707523
"BLD",5065,"KRN",9.8,"NM",23,0)
ORB3USER^^0^B69213741
"BLD",5065,"KRN",9.8,"NM","B","ORB3",17)

"BLD",5065,"KRN",9.8,"NM","B","ORB31",18)

"BLD",5065,"KRN",9.8,"NM","B","ORB3F1",21)

"BLD",5065,"KRN",9.8,"NM","B","ORB3MGR1",20)

"BLD",5065,"KRN",9.8,"NM","B","ORB3SPEC",1)

"BLD",5065,"KRN",9.8,"NM","B","ORB3U1",19)

"BLD",5065,"KRN",9.8,"NM","B","ORB3USER",23)

"BLD",5065,"KRN",9.8,"NM","B","ORQ12",22)

"BLD",5065,"KRN",19,0)
19
"BLD",5065,"KRN",19.1,0)
19.1
"BLD",5065,"KRN",101,0)
101
"BLD",5065,"KRN",409.61,0)
409.61
"BLD",5065,"KRN",771,0)
771
"BLD",5065,"KRN",870,0)
870
"BLD",5065,"KRN",8989.51,0)
8989.51
"BLD",5065,"KRN",8989.51,"NM",0)
^9.68A^9^8
"BLD",5065,"KRN",8989.51,"NM",2,0)
ORB OI EXPIRING - OUTPT PR^^0
"BLD",5065,"KRN",8989.51,"NM",3,0)
ORB OI EXPIRING - INPT PR^^0
"BLD",5065,"KRN",8989.51,"NM",4,0)
ORB OI ORDERED - OUTPT PR^^0
"BLD",5065,"KRN",8989.51,"NM",5,0)
ORB OI ORDERED - INPT PR^^0
"BLD",5065,"KRN",8989.51,"NM",6,0)
ORB OI RESULTS - OUTPT PR^^0
"BLD",5065,"KRN",8989.51,"NM",7,0)
ORB OI RESULTS - INPT PR^^0
"BLD",5065,"KRN",8989.51,"NM",8,0)
ORB LAB < THRESHOLD^^0
"BLD",5065,"KRN",8989.51,"NM",9,0)
ORB LAB > THRESHOLD^^0
"BLD",5065,"KRN",8989.51,"NM","B","ORB LAB < THRESHOLD",8)

"BLD",5065,"KRN",8989.51,"NM","B","ORB LAB > THRESHOLD",9)

"BLD",5065,"KRN",8989.51,"NM","B","ORB OI EXPIRING - INPT PR",3)

"BLD",5065,"KRN",8989.51,"NM","B","ORB OI EXPIRING - OUTPT PR",2)

"BLD",5065,"KRN",8989.51,"NM","B","ORB OI ORDERED - INPT PR",5)

"BLD",5065,"KRN",8989.51,"NM","B","ORB OI ORDERED - OUTPT PR",4)

"BLD",5065,"KRN",8989.51,"NM","B","ORB OI RESULTS - INPT PR",7)

"BLD",5065,"KRN",8989.51,"NM","B","ORB OI RESULTS - OUTPT PR",6)

"BLD",5065,"KRN",8989.52,0)
8989.52
"BLD",5065,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",5065,"KRN",8994,0)
8994
"BLD",5065,"KRN","B",.4,.4)

"BLD",5065,"KRN","B",.401,.401)

"BLD",5065,"KRN","B",.402,.402)

"BLD",5065,"KRN","B",.403,.403)

"BLD",5065,"KRN","B",.5,.5)

"BLD",5065,"KRN","B",.84,.84)

"BLD",5065,"KRN","B",3.6,3.6)

"BLD",5065,"KRN","B",3.8,3.8)

"BLD",5065,"KRN","B",9.2,9.2)

"BLD",5065,"KRN","B",9.8,9.8)

"BLD",5065,"KRN","B",19,19)

"BLD",5065,"KRN","B",19.1,19.1)

"BLD",5065,"KRN","B",101,101)

"BLD",5065,"KRN","B",409.61,409.61)

"BLD",5065,"KRN","B",771,771)

"BLD",5065,"KRN","B",870,870)

"BLD",5065,"KRN","B",8989.51,8989.51)

"BLD",5065,"KRN","B",8989.52,8989.52)

"BLD",5065,"KRN","B",8994,8994)

"BLD",5065,"QUES",0)
^9.62^^
"BLD",5065,"REQB",0)
^9.611^4^4
"BLD",5065,"REQB",1,0)
OR*3.0*173^2
"BLD",5065,"REQB",2,0)
OR*3.0*179^2
"BLD",5065,"REQB",3,0)
OR*3.0*190^2
"BLD",5065,"REQB",4,0)
XU*8.0*285^2
"BLD",5065,"REQB","B","OR*3.0*173",1)

"BLD",5065,"REQB","B","OR*3.0*179",2)

"BLD",5065,"REQB","B","OR*3.0*190",3)

"BLD",5065,"REQB","B","XU*8.0*285",4)

"KRN",8989.51,360,-1)
0^5
"KRN",8989.51,360,0)
ORB OI ORDERED - INPT PR^Flag Items for INPT ORDER Providr Recip^1^Orderable Item^Provider Recipients
"KRN",8989.51,360,1)
F^0:8^Any one or combination of 'P', 'A', 'T' 'O', 'M', 'E', 'R', 'S'.
"KRN",8989.51,360,2)
K:$L($TR(X,"PATOMERS","")) X
"KRN",8989.51,360,6)
P^101.43^Enter the orderable item to trigger a notification.
"KRN",8989.51,360,20,0)
^^22^22^3040106^
"KRN",8989.51,360,20,1,0)
This parameter is used to trigger a notification/alert when a specific
"KRN",8989.51,360,20,2,0)
orderable item is ordered for an inpatient.  The notification is 
"KRN",8989.51,360,20,3,0)
delivered to a user based upon that user's relationship to the inpatient 
"KRN",8989.51,360,20,4,0)
as defined by the following codes.  Orderable Items can be set up with any
"KRN",8989.51,360,20,5,0)
or all of the following codes:
"KRN",8989.51,360,20,6,0)
  
"KRN",8989.51,360,20,7,0)
P (Primary Provider): deliver notification to the patient's Primary
"KRN",8989.51,360,20,8,0)
Provider.  
"KRN",8989.51,360,20,9,0)
A (Attending Physician): deliver notification to the patient's 
"KRN",8989.51,360,20,10,0)
Attending Physician.
"KRN",8989.51,360,20,11,0)
T (Patient Care Team): deliver notification to the patient's  primary
"KRN",8989.51,360,20,12,0)
care Team.
"KRN",8989.51,360,20,13,0)
O (Ordering Provider): deliver notification to the provider
"KRN",8989.51,360,20,14,0)
who placed the order which trigger the notification.
"KRN",8989.51,360,20,15,0)
M (PCMM Team): deliver notification to users/providers linked to the
"KRN",8989.51,360,20,16,0)
patient via PCMM Team Position assignments.
"KRN",8989.51,360,20,17,0)
E (Entering User): deliver notification to the user/provider who 
"KRN",8989.51,360,20,18,0)
entered the order's most recent activity.
"KRN",8989.51,360,20,19,0)
R (PCMM Primary Care Practitioner): deliver notification to the
"KRN",8989.51,360,20,20,0)
patient's PCMM Primary Care Practitioner.
"KRN",8989.51,360,20,21,0)
S (PCMM Associate Provider): deliver notification to the patient's PCMM
"KRN",8989.51,360,20,22,0)
Associate Provider.
"KRN",8989.51,360,30,0)
^8989.513I^2^2
"KRN",8989.51,360,30,1,0)
1^4
"KRN",8989.51,360,30,2,0)
2^4.2
"KRN",8989.51,361,-1)
0^4
"KRN",8989.51,361,0)
ORB OI ORDERED - OUTPT PR^Flag Items for OUTPT ORDER Providr Recip^1^Orderable Item^Provider Recipients
"KRN",8989.51,361,1)
F^0:8^Any one or combination of 'P', 'A', 'T', 'O', 'M', 'E', 'R', 'S'.
"KRN",8989.51,361,2)
K:$L($TR(X,"PATOMERS","")) X
"KRN",8989.51,361,6)
P^101.43^Enter the orderable item to trigger a notification.
"KRN",8989.51,361,20,0)
^^22^22^3040106^
"KRN",8989.51,361,20,1,0)
This parameter is used to trigger a notification/alert when a specific
"KRN",8989.51,361,20,2,0)
orderable item is ordered for an outpatient.  The notification is 
"KRN",8989.51,361,20,3,0)
delivered to a user based upon that user's relationship to the outpatient 
"KRN",8989.51,361,20,4,0)
as defined by the following codes.  Orderable Items can be set up with any
"KRN",8989.51,361,20,5,0)
or all of the following codes:
"KRN",8989.51,361,20,6,0)
   
"KRN",8989.51,361,20,7,0)
P (Primary Provider): deliver notification to the patient's Primary
"KRN",8989.51,361,20,8,0)
Provider.  
"KRN",8989.51,361,20,9,0)
A (Attending Physician): deliver notification to the patient's 
"KRN",8989.51,361,20,10,0)
Attending Physician.
"KRN",8989.51,361,20,11,0)
T (Patient Care Team): deliver notification to the patient's  primary
"KRN",8989.51,361,20,12,0)
care Team.
"KRN",8989.51,361,20,13,0)
O (Ordering Provider): deliver notification to the provider
"KRN",8989.51,361,20,14,0)
who placed the order which trigger the notification.
"KRN",8989.51,361,20,15,0)
M (PCMM Team): deliver notification to users/providers linked to the
"KRN",8989.51,361,20,16,0)
patient via PCMM Team Position assignments.
"KRN",8989.51,361,20,17,0)
E (Entering User): deliver notification to the user/provider who 
"KRN",8989.51,361,20,18,0)
entered the order's most recent activity.
"KRN",8989.51,361,20,19,0)
R (PCMM Primary Care Practitioner): deliver notification to the
"KRN",8989.51,361,20,20,0)
patient's PCMM Primary Care Practitioner.
"KRN",8989.51,361,20,21,0)
S (PCMM Associate Provider): deliver notification to the patient's PCMM
"KRN",8989.51,361,20,22,0)
Associate Provider.
"KRN",8989.51,361,30,0)
^8989.513I^2^2
"KRN",8989.51,361,30,1,0)
1^4
"KRN",8989.51,361,30,2,0)
2^4.2
"KRN",8989.51,362,-1)
0^7
"KRN",8989.51,362,0)
ORB OI RESULTS - INPT PR^Flag Items for INPT RESULT Provid Recip^1^Orderable Item^Provider Recipients
"KRN",8989.51,362,1)
F^0:8^Any one or combination of 'P', 'A', 'T', 'O', 'M', 'E', 'R', 'S'.
"KRN",8989.51,362,2)
K:$L($TR(X,"PATOMERS","")) X
"KRN",8989.51,362,6)
P^101.43^Enter the orderable item to trigger a notification.
"KRN",8989.51,362,8)
I $$LRRAD^ORB3F1(+Y)
"KRN",8989.51,362,20,0)
^^24^24^3040106^
"KRN",8989.51,362,20,1,0)
This parameter is used to trigger a notification/alert when a specific
"KRN",8989.51,362,20,2,0)
orderable item is resulted for an inpatient.  Results only apply to orders
"KRN",8989.51,362,20,3,0)
which can be resulted (lab, imaging, consults.)
"KRN",8989.51,362,20,4,0)
 
"KRN",8989.51,362,20,5,0)
The notification is delivered to a user based upon that user's
"KRN",8989.51,362,20,6,0)
relationship to the inpatient as defined by the following codes.
"KRN",8989.51,362,20,7,0)
Orderable Items can be set up with any or all of the following codes:
"KRN",8989.51,362,20,8,0)
   
"KRN",8989.51,362,20,9,0)
P (Primary Provider): deliver notification to the patient's Primary
"KRN",8989.51,362,20,10,0)
Provider.  
"KRN",8989.51,362,20,11,0)
A (Attending Physician): deliver notification to the patient's Attending
"KRN",8989.51,362,20,12,0)
Physician.
"KRN",8989.51,362,20,13,0)
T (Patient Care Team): deliver notification to the patient's  primary
"KRN",8989.51,362,20,14,0)
care Team.
"KRN",8989.51,362,20,15,0)
O (Ordering Provider): deliver notification to the provider who placed the
"KRN",8989.51,362,20,16,0)
order which trigger the notification.
"KRN",8989.51,362,20,17,0)
M (PCMM Team): deliver notification to users/providers linked to the
"KRN",8989.51,362,20,18,0)
patient via PCMM Team Position assignments.
"KRN",8989.51,362,20,19,0)
E (Entering User): deliver notification to the user/provider who 
"KRN",8989.51,362,20,20,0)
entered the order's most recent activity.
"KRN",8989.51,362,20,21,0)
R (PCMM Primary Care Practitioner): deliver notification to the
"KRN",8989.51,362,20,22,0)
patient's PCMM Primary Care Practitioner.
"KRN",8989.51,362,20,23,0)
S (PCMM Associate Provider): deliver notification to the patient's PCMM
"KRN",8989.51,362,20,24,0)
Associate Provider.
"KRN",8989.51,362,30,0)
^8989.513I^2^2
"KRN",8989.51,362,30,1,0)
1^4
"KRN",8989.51,362,30,2,0)
2^4.2
"KRN",8989.51,363,-1)
0^6
"KRN",8989.51,363,0)
ORB OI RESULTS - OUTPT PR^Flag Items for OUTPT RESULT Provid Recip^1^Orderable Item^Provider Recipients
"KRN",8989.51,363,1)
F^0:8^Any one or combination of 'P', 'A', 'T', 'O', 'M', 'E', 'R', 'S'.
"KRN",8989.51,363,2)
K:$L($TR(X,"PATOMERS","")) X
"KRN",8989.51,363,6)
P^101.43^Enter the orderable item to trigger a notification.
"KRN",8989.51,363,8)
I $$LRRAD^ORB3F1(+Y)
"KRN",8989.51,363,20,0)
^^24^24^3040106^
"KRN",8989.51,363,20,1,0)
This parameter is used to trigger a notification/alert when a specific
"KRN",8989.51,363,20,2,0)
orderable item is resulted for an outpatient.  Results only apply to 
"KRN",8989.51,363,20,3,0)
orders which can be resulted (lab, imaging, consults.)
"KRN",8989.51,363,20,4,0)
  
"KRN",8989.51,363,20,5,0)
The notification is delivered to a user based upon that user's
"KRN",8989.51,363,20,6,0)
relationship to the outpatient as defined by the following codes.
"KRN",8989.51,363,20,7,0)
An Orderable Item can be set up with any or all of the following codes:
"KRN",8989.51,363,20,8,0)
    
"KRN",8989.51,363,20,9,0)
P (Primary Provider): deliver notification to the patient's Primary
"KRN",8989.51,363,20,10,0)
Provider.  
"KRN",8989.51,363,20,11,0)
A (Attending Physician): deliver notification to the patient's Attending
"KRN",8989.51,363,20,12,0)
Physician.
"KRN",8989.51,363,20,13,0)
T (Patient Care Team): deliver notification to the patient's  primary
"KRN",8989.51,363,20,14,0)
care Team.
"KRN",8989.51,363,20,15,0)
O (Ordering Provider): deliver notification to the provider who placed 
"KRN",8989.51,363,20,16,0)
the order which trigger the notification.
"KRN",8989.51,363,20,17,0)
M (PCMM Team): deliver notification to users/providers linked to the
"KRN",8989.51,363,20,18,0)
patient via PCMM Team Position assignments.
"KRN",8989.51,363,20,19,0)
E (Entering User): deliver notification to the user/provider who 
"KRN",8989.51,363,20,20,0)
entered the order's most recent activity.
"KRN",8989.51,363,20,21,0)
R (PCMM Primary Care Practitioner): deliver notification to the
"KRN",8989.51,363,20,22,0)
patient's PCMM Primary Care Practitioner.
"KRN",8989.51,363,20,23,0)
S (PCMM Associate Provider): deliver notification to the patient's PCMM
"KRN",8989.51,363,20,24,0)
Associate Provider.
"KRN",8989.51,363,30,0)
^8989.513I^2^2
"KRN",8989.51,363,30,1,0)
1^4
"KRN",8989.51,363,30,2,0)
2^4.2
"KRN",8989.51,364,-1)
0^3
"KRN",8989.51,364,0)
ORB OI EXPIRING - INPT PR^Flag Items for INPT EXPIRING Prov Recip^1^Orderable Item^Provider Recipients
"KRN",8989.51,364,1)
F^0:8^Any one or combination of 'P', 'A', 'T', 'O', 'M', 'E', 'R', 'S'.
"KRN",8989.51,364,2)
K:$L($TR(X,"PATOMERS","")) X
"KRN",8989.51,364,6)
P^101.43^Enter the orderable item to trigger a notification.
"KRN",8989.51,364,20,0)
^^22^22^3040106^
"KRN",8989.51,364,20,1,0)
This parameter is used to trigger a notification/alert when a specific
"KRN",8989.51,364,20,2,0)
orderable item is expiring for an inpatient.  The notification is 
"KRN",8989.51,364,20,3,0)
delivered to a user based upon that user's relationship to the inpatient 
"KRN",8989.51,364,20,4,0)
as defined by the following codes.  Orderable Items can be set up with any
"KRN",8989.51,364,20,5,0)
or all of the following codes:
"KRN",8989.51,364,20,6,0)
   
"KRN",8989.51,364,20,7,0)
P (Primary Provider): deliver notification to the patient's Primary
"KRN",8989.51,364,20,8,0)
Provider.  
"KRN",8989.51,364,20,9,0)
A (Attending Physician): deliver notification to the patient's 
"KRN",8989.51,364,20,10,0)
Attending Physician.
"KRN",8989.51,364,20,11,0)
T (Patient Care Team): deliver notification to the patient's  primary
"KRN",8989.51,364,20,12,0)
care Team.
"KRN",8989.51,364,20,13,0)
O (Ordering Provider): deliver notification to the provider
"KRN",8989.51,364,20,14,0)
who placed the order which trigger the notification.
"KRN",8989.51,364,20,15,0)
M (PCMM Team): deliver notification to users/providers linked to the
"KRN",8989.51,364,20,16,0)
patient via PCMM Team Position assignments.
"KRN",8989.51,364,20,17,0)
E (Entering User): deliver notification to the user/provider who 
"KRN",8989.51,364,20,18,0)
entered the order's most recent activity.
"KRN",8989.51,364,20,19,0)
R (PCMM Primary Care Practitioner): deliver notification to the
"KRN",8989.51,364,20,20,0)
patient's PCMM Primary Care Practitioner.
"KRN",8989.51,364,20,21,0)
S (PCMM Associate Provider): deliver notification to the patient's PCMM
"KRN",8989.51,364,20,22,0)
Associate Provider.
"KRN",8989.51,364,30,0)
^8989.513I^2^2
"KRN",8989.51,364,30,1,0)
1^4
"KRN",8989.51,364,30,2,0)
2^4.2
"KRN",8989.51,365,-1)
0^2
"KRN",8989.51,365,0)
ORB OI EXPIRING - OUTPT PR^Flag Items for OUTPT EXPIRING Prov Recip^1^Orderable Item^Provider Recipients
"KRN",8989.51,365,1)
F^0:8^Any one or combination of 'P', 'A', 'T', 'O', 'M', 'E', 'R', 'S'.
"KRN",8989.51,365,2)
K:$L($TR(X,"PATOMERS","")) X
"KRN",8989.51,365,6)
P^101.43^Enter the orderable item to trigger a notification.
"KRN",8989.51,365,20,0)
^^22^22^3040106^
"KRN",8989.51,365,20,1,0)
This parameter is used to trigger a notification/alert when a specific
"KRN",8989.51,365,20,2,0)
orderable item is expiring for an outpatient.  The notification is 
"KRN",8989.51,365,20,3,0)
delivered to a user based upon that user's relationship to the outpatient
"KRN",8989.51,365,20,4,0)
as defined by the following codes.  Orderable Items can be set up with
"KRN",8989.51,365,20,5,0)
any or all of the following codes:
"KRN",8989.51,365,20,6,0)
    
"KRN",8989.51,365,20,7,0)
P (Primary Provider): deliver notification to the patient's Primary
"KRN",8989.51,365,20,8,0)
Provider.  
"KRN",8989.51,365,20,9,0)
A (Attending Physician): deliver notification to the patient's 
"KRN",8989.51,365,20,10,0)
Attending Physician.
"KRN",8989.51,365,20,11,0)
T (Patient Care Team): deliver notification to the patient's  primary
"KRN",8989.51,365,20,12,0)
care Team.
"KRN",8989.51,365,20,13,0)
O (Ordering Provider): deliver notification to the provider
"KRN",8989.51,365,20,14,0)
who placed the order which trigger the notification.
"KRN",8989.51,365,20,15,0)
M (PCMM Team): deliver notification to users/providers linked to the
"KRN",8989.51,365,20,16,0)
patient via PCMM Team Position assignments.
"KRN",8989.51,365,20,17,0)
E (Entering User): deliver notification to the user/provider who 
"KRN",8989.51,365,20,18,0)
entered the order's most recent activity.
"KRN",8989.51,365,20,19,0)
R (PCMM Primary Care Practitioner): deliver notification to the
"KRN",8989.51,365,20,20,0)
patient's PCMM Primary Care Practitioner.
"KRN",8989.51,365,20,21,0)
S (PCMM Associate Provider): deliver notification to the patient's PCMM
"KRN",8989.51,365,20,22,0)
Associate Provider.
"KRN",8989.51,365,30,0)
^8989.513I^2^2
"KRN",8989.51,365,30,1,0)
1^4
"KRN",8989.51,365,30,2,0)
2^4.2
"KRN",8989.51,4736,-1)
0^9
"KRN",8989.51,4736,0)
ORB LAB > THRESHOLD^Lab > Threshold Value for Alerts^1^Lab Test;Specimen^Threshold
"KRN",8989.51,4736,1)
N^::2^Enter the lab threshold value.
"KRN",8989.51,4736,2)

"KRN",8989.51,4736,6)
F^3:30^Lab test;Specimen sends alert above threshold.
"KRN",8989.51,4736,7)
K:X'?1.N1";"1.N X
"KRN",8989.51,4736,20,0)
^8989.512^9^9^3040726^^^^
"KRN",8989.51,4736,20,1,0)
This parameter permits users to set Lab test result threshold values that
"KRN",8989.51,4736,20,2,0)
determine if an alert is sent to them. If a lab test's result is greater
"KRN",8989.51,4736,20,3,0)
than the threshold value, the Lab Threshold Exceeded notification/alert is
"KRN",8989.51,4736,20,4,0)
triggered.
"KRN",8989.51,4736,20,5,0)
 
"KRN",8989.51,4736,20,6,0)
The Instance (Lab Test;Specimen) must be entered in the format
"KRN",8989.51,4736,20,7,0)
Lab Test #;Specimen #.   Lab Test # is the internal entry number from
"KRN",8989.51,4736,20,8,0)
the LABORATORY TEST file [#60]. Specimen # is the internal entry number
"KRN",8989.51,4736,20,9,0)
from the TOPOGRAPHY FIELD file [#61].
"KRN",8989.51,4736,30,0)
^8989.513I^1^1
"KRN",8989.51,4736,30,1,0)
1^200
"KRN",8989.51,4742,-1)
0^8
"KRN",8989.51,4742,0)
ORB LAB < THRESHOLD^Lab < Threshold Value for Alerts^1^Lab Test;Specimen^Threshold^
"KRN",8989.51,4742,1)
N^::2^Enter the lab threshold value.
"KRN",8989.51,4742,6)
F^3:30^Lab test:Specimen sends alert below threshold.
"KRN",8989.51,4742,7)
K:X'?1.N1";"1.N X
"KRN",8989.51,4742,20,0)
^8989.512^9^9^3040521^^^
"KRN",8989.51,4742,20,1,0)
This parameter permits users to set Lab test result threshold values that
"KRN",8989.51,4742,20,2,0)
determine if an alert is sent to them. If a lab test's result is less
"KRN",8989.51,4742,20,3,0)
than the threshold value, the Lab Threshold Exceeded notification/alert is
"KRN",8989.51,4742,20,4,0)
triggered.
"KRN",8989.51,4742,20,5,0)
  
"KRN",8989.51,4742,20,6,0)
The Instance (Lab Test;Specimen) must be entered in the format
"KRN",8989.51,4742,20,7,0)
Lab Test #;Specimen #.   Lab Test # is the internal entry number from
"KRN",8989.51,4742,20,8,0)
the LABORATORY TEST file [#60]. Specimen # is the internal entry number
"KRN",8989.51,4742,20,9,0)
from the TOPOGRAPHY FIELD file [#61].
"KRN",8989.51,4742,30,0)
^8989.513I^1^1
"KRN",8989.51,4742,30,1,0)
1^200
"MBREQ")
0
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
220^3050816
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","ORB3")
0^17^B87608247
"RTN","ORB3",1,0)
ORB3 ; slc/CLA - Main routine for OE/RR 3 notifications ;6/6/01  10:46 [8/16/05 5:33am]
"RTN","ORB3",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**31,74,91,105,139,190,220**;Dec 17, 1997
"RTN","ORB3",3,0)
EN(ORN,ORBDFN,ORNUM,ORBADUZ,ORBPMSG,ORBPDATA) ;
"RTN","ORB3",4,0)
 ;
"RTN","ORB3",5,0)
 N ORBENT
"RTN","ORB3",6,0)
 S ORBENT=$$ENTITY^ORB31(ORNUM)
"RTN","ORB3",7,0)
 ;
"RTN","ORB3",8,0)
 Q:$$GET^XPAR(ORBENT,"ORB SYSTEM ENABLE/DISABLE",1,"I")="D"
"RTN","ORB3",9,0)
 Q:'$L($G(^ORD(100.9,ORN,0)))
"RTN","ORB3",10,0)
 Q:+$$ONOFF^ORB3FN(ORN)=0
"RTN","ORB3",11,0)
 ;
"RTN","ORB3",12,0)
 S ORBPMSG=$E($G(ORBPMSG),1,51)
"RTN","ORB3",13,0)
 ;
"RTN","ORB3",14,0)
 ;if msg from notif file or oc notif (#54), quit if dup w/in past 1 min:
"RTN","ORB3",15,0)
 N ORBDUP,ORBN
"RTN","ORB3",16,0)
 S ORBN=^ORD(100.9,ORN,0)
"RTN","ORB3",17,0)
 I ($P(ORBN,"^",4)="NOT")!(ORN=54) D
"RTN","ORB3",18,0)
 .S ORBDUP=$$DUP^ORB31(ORN,ORBDFN,ORBPMSG,ORNUM)
"RTN","ORB3",19,0)
 Q:+$G(ORBDUP)=1
"RTN","ORB3",20,0)
 ;
"RTN","ORB3",21,0)
 N ORBDESC
"RTN","ORB3",22,0)
 S ORBDESC=" Send Alert Notification ("_(+ORN)_") "_$P($G(^ORD(100.9,+ORN,0)),U,1)_"  "
"RTN","ORB3",23,0)
 ;
"RTN","ORB3",24,0)
 D QUEUE^ORB31(ORN,ORBDFN,$G(ORNUM),.ORBADUZ,$G(ORBPMSG),$G(ORBPDATA),$H,ORBDESC,$G(DGPMA))
"RTN","ORB3",25,0)
 Q
"RTN","ORB3",26,0)
ZTSK ;
"RTN","ORB3",27,0)
 D START
"RTN","ORB3",28,0)
 S ZTREQ="@"
"RTN","ORB3",29,0)
 Q
"RTN","ORB3",30,0)
UTL(ORBU,ORN,ORBDFN,ORNUM,ORBADUZ,ORBPMSG,ORBPDATA) ;
"RTN","ORB3",31,0)
 Q:$G(ORBU)'=1
"RTN","ORB3",32,0)
START Q:$G(ORN)=""!($G(ORBDFN)="")
"RTN","ORB3",33,0)
 Q:'$L($G(^ORD(100.9,ORN,0)))
"RTN","ORB3",34,0)
 N ORBNOW,ORBID,ORBLOCK,ORBDESC
"RTN","ORB3",35,0)
 S ORBNOW=$$NOW^XLFDT
"RTN","ORB3",36,0)
 S ORBLOCK=0
"RTN","ORB3",37,0)
 ;
"RTN","ORB3",38,0)
 ;lock to prevent concurrent processing by other resource slots:
"RTN","ORB3",39,0)
 I '$D(ORBU) D
"RTN","ORB3",40,0)
 .S ^XTMP("ORBLOCK",0)=$$FMADD^XLFDT(ORBNOW,1,"","","")_"^"_ORBNOW
"RTN","ORB3",41,0)
 .S ORBID=$P($P($G(ORBPDATA),"|",2),"@")  ;get unique data id
"RTN","ORB3",42,0)
 .I $L(ORBID) D
"RTN","ORB3",43,0)
 ..LOCK +^XTMP("ORBLOCK",ORBDFN,ORN,ORBID):60 E  D  Q
"RTN","ORB3",44,0)
 ...S ORBDESC=" Requeue Alert Notification ("_(+ORN)_") "_$P($G(^ORD(100.9,+ORN,0)),U,1)_"  "
"RTN","ORB3",45,0)
 ...D QUEUE^ORB31(ORN,ORBDFN,$G(ORNUM),.ORBADUZ,$G(ORBPMSG),$G(ORBPDATA),$$HADD^XLFDT($H,"","",5,""),ORBDESC,$G(DGPMA)) ;requeue in 5 min.
"RTN","ORB3",46,0)
 ...S ORBLOCK=1
"RTN","ORB3",47,0)
 .;
"RTN","ORB3",48,0)
 .I '$L(ORBID) D
"RTN","ORB3",49,0)
 ..LOCK +^XTMP("ORBLOCK",ORBDFN,ORN):60 E  D  Q
"RTN","ORB3",50,0)
 ...S ORBDESC=" Requeue Alert Notification ("_(+ORN)_") "_$P($G(^ORD(100.9,+ORN,0)),U,1)_"  "
"RTN","ORB3",51,0)
 ...D QUEUE^ORB31(ORN,ORBDFN,$G(ORNUM),.ORBADUZ,$G(ORBPMSG),$G(ORBPDATA),$$HADD^XLFDT($H,"","",5,""),ORBDESC,$G(DGPMA)) ;requeue in 5 min.
"RTN","ORB3",52,0)
 ...S ORBLOCK=1
"RTN","ORB3",53,0)
 .;
"RTN","ORB3",54,0)
 I ORBLOCK=1 D QUIT Q
"RTN","ORB3",55,0)
 ;
"RTN","ORB3",56,0)
 N ORBDUZ,ORBN,ORBXQAID,ORPTNAM,ORBPRIM,ORBATTD,ORBDEV,ORBENT
"RTN","ORB3",57,0)
 N ORBUI,ORBASPEC,ORBSMSG,ORBADT,ORBSDEV,ORBDEL,ORBDI,ORBTDEV,ORY
"RTN","ORB3",58,0)
 S ORBUI=1,ORBADT=0
"RTN","ORB3",59,0)
 S:'$L($G(ORBPMSG)) ORBPMSG=""
"RTN","ORB3",60,0)
 I '$L(ORBPDATA),(+$G(ORNUM)>0) S ORBPDATA=+$G(ORNUM)_"@"
"RTN","ORB3",61,0)
 S ORBN=^ORD(100.9,ORN,0)
"RTN","ORB3",62,0)
 ;
"RTN","ORB3",63,0)
 S ORBENT=$$ENTITY^ORB31(ORNUM)
"RTN","ORB3",64,0)
 ;
"RTN","ORB3",65,0)
 N DFN S DFN=ORBDFN,VA200="" D OERR^VADPT
"RTN","ORB3",66,0)
 I ('$L($G(VA("BID"))))!('$L($G(VADM(1)))) D QUIT Q
"RTN","ORB3",67,0)
 I (ORN=18)!(ORN=20)!(ORN=35) S ORBADT=1 ;A/D/T notif
"RTN","ORB3",68,0)
 ;if not an A/D/T notif, get primary & attending from OERR^VADPT:
"RTN","ORB3",69,0)
 I ORBADT=0 S ORBPRIM=+$P(VAIN(2),U),ORBATTD=+$P(VAIN(11),U)
"RTN","ORB3",70,0)
 I ORBADT=1 D ADT^ORB31(ORN,ORBDFN,.ORBPRIM,.ORBATTD,$G(ORDGPMA)) ;A/D/T notif
"RTN","ORB3",71,0)
 I $D(ORBU) D  ;create debug msg
"RTN","ORB3",72,0)
 .S ORBU(ORBUI)="Processing notification: "_$P(ORBN,U),ORBUI=ORBUI+1
"RTN","ORB3",73,0)
 .S ORBU(ORBUI)="            for patient: "_VADM(1),ORBUI=ORBUI+1
"RTN","ORB3",74,0)
 .I $G(ORNUM)>0 S ORBU(ORBUI)="              for order: "_ORNUM,ORBUI=ORBUI+1
"RTN","ORB3",75,0)
 D REGULAR^ORB3REG(ORN,.XQA,.ORBU,.ORBUI,.ORBDEV,ORBDFN)
"RTN","ORB3",76,0)
 D SPECIAL^ORB3SPEC(ORN,.ORBASPEC,.ORBU,.ORBUI,$G(ORNUM),ORBDFN,$G(ORBPDATA),.ORBSMSG,$G(ORBPMSG),.ORBSDEV,$G(ORBPRIM),$G(ORBATTD))
"RTN","ORB3",77,0)
 I $L($G(ORBSMSG)) S ORBPMSG=$E(ORBSMSG,1,51)
"RTN","ORB3",78,0)
 I $D(ORBASPEC)>1 D SPECDUZS ;special recips
"RTN","ORB3",79,0)
 I $D(ORBADUZ)>1 D PKGDUZS ;pkg-supplied recips
"RTN","ORB3",80,0)
 D TITLE ;provider recips
"RTN","ORB3",81,0)
 S ORBXQAID=$P(ORBN,"^",2)_","_ORBDFN_","_ORN
"RTN","ORB3",82,0)
 ;
"RTN","ORB3",83,0)
 I ($D(XQA)>1)!($D(ORBDEV)>1)!($D(ORBSDEV)>1) D  ;recips found
"RTN","ORB3",84,0)
 .S XQAFLG=$P(ORBN,"^",5)
"RTN","ORB3",85,0)
 .S XQADFN=ORBDFN
"RTN","ORB3",86,0)
 .I XQAFLG="R" S XQAROU=$P(ORBN,"^",6)_"^"_$P(ORBN,"^",7)
"RTN","ORB3",87,0)
 .I $G(ORBPDATA)'="" S XQADATA=ORBPDATA
"RTN","ORB3",88,0)
 .S ORPTNAM=$E(VADM(1)_"         ",1,9)
"RTN","ORB3",89,0)
 .S XQAMSG=ORPTNAM_" "_"("_$E(ORPTNAM)_$E(VA("BID"),1,4)_")"_": "
"RTN","ORB3",90,0)
 .S XQAMSG=XQAMSG_$S(ORBPMSG'="":ORBPMSG,1:$P(ORBN,"^",3))
"RTN","ORB3",91,0)
 .S XQAARCH=$$GET^XPAR(ORBENT,"ORB ARCHIVE PERIOD",ORN,"I")
"RTN","ORB3",92,0)
 .S XQASUPV=$$GET^XPAR(ORBENT,"ORB FORWARD SUPERVISOR",ORN,"I")
"RTN","ORB3",93,0)
 .S XQASURO=$$GET^XPAR(ORBENT,"ORB FORWARD SURROGATES",ORN,"I")
"RTN","ORB3",94,0)
 .S XQAREVUE=$$GET^XPAR(ORBENT,"ORB FORWARD BACKUP REVIEWER",ORN,"I")
"RTN","ORB3",95,0)
 .S XQACNDEL=$$GET^XPAR(ORBENT,"ORB REMOVE",ORN,"I")
"RTN","ORB3",96,0)
 .S XQACNDEL=$S(XQACNDEL=1:1,1:"")
"RTN","ORB3",97,0)
 .I $D(ORBDEV)>1 D REGDEV^ORB31(.ORBDEV)
"RTN","ORB3",98,0)
 .I $D(ORBSDEV)>1 D REGDEV^ORB31(.ORBSDEV)
"RTN","ORB3",99,0)
 .I $D(ORBTDEV)>1 D REGDEV^ORB31(.ORBTDEV)
"RTN","ORB3",100,0)
 .S XQAID=ORBXQAID
"RTN","ORB3",101,0)
 .I $D(XQA) D SETUP^XQALERT  ;if no [new] recips don't send alert
"RTN","ORB3",102,0)
QUIT ;
"RTN","ORB3",103,0)
 K VA,VA200,VADM,VAERR,VAIN,XQA,XQADATA,XQAID,XQAFLG,XQAMSG,XQAROU,XQAARCH,XQASUPV,XQASURO,XQADFN
"RTN","ORB3",104,0)
 K ^XTMP("ORBUSER",$J)
"RTN","ORB3",105,0)
 I '$D(ORBU) D
"RTN","ORB3",106,0)
 .I $L(ORBID) LOCK -^XTMP("ORBLOCK",ORBDFN,ORN,ORBID)
"RTN","ORB3",107,0)
 .E  LOCK -^XTMP("ORBLOCK",ORBDFN,ORN)
"RTN","ORB3",108,0)
 Q
"RTN","ORB3",109,0)
PKGDUZS ;get DUZs from pkg-passed ORBADUZ() array
"RTN","ORB3",110,0)
 N ORBPDUZ
"RTN","ORB3",111,0)
 I $D(ORBU) D
"RTN","ORB3",112,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3",113,0)
 .I ORN=68 S ORBU(ORBUI)="Recipients with Lab Threshold Exceeded:",ORBUI=ORBUI+1
"RTN","ORB3",114,0)
 .E  S ORBU(ORBUI)="Recipients defined when notif was triggered:",ORBUI=ORBUI+1
"RTN","ORB3",115,0)
 S ORBPDUZ=""
"RTN","ORB3",116,0)
 F  S ORBPDUZ=$O(ORBADUZ(ORBPDUZ)) Q:ORBPDUZ=""  S ORBDUZ=ORBPDUZ D USER
"RTN","ORB3",117,0)
 Q
"RTN","ORB3",118,0)
SPECDUZS ;get DUZs rtn by SPECIAL^ORB3SPEC
"RTN","ORB3",119,0)
 N ORBSDUZ
"RTN","ORB3",120,0)
 I $D(ORBU) D
"RTN","ORB3",121,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3",122,0)
 .S ORBU(ORBUI)="Special recipients associated with the notification:",ORBUI=ORBUI+1
"RTN","ORB3",123,0)
 S ORBSDUZ=""
"RTN","ORB3",124,0)
 F  S ORBSDUZ=$O(ORBASPEC(ORBSDUZ)) Q:ORBSDUZ=""  S ORBDUZ=ORBSDUZ D USER
"RTN","ORB3",125,0)
 Q
"RTN","ORB3",126,0)
TITLE ;get provider recips
"RTN","ORB3",127,0)
 N TITLES
"RTN","ORB3",128,0)
 I $D(ORBU) D
"RTN","ORB3",129,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3",130,0)
 .S ORBU(ORBUI)="Recipients determined by Provider Recipient parameter:",ORBUI=ORBUI+1
"RTN","ORB3",131,0)
 ;
"RTN","ORB3",132,0)
 S TITLES=$$GET^XPAR(ORBENT,"ORB PROVIDER RECIPIENTS",ORN,"I")
"RTN","ORB3",133,0)
 I TITLES["P" D PRIMARY
"RTN","ORB3",134,0)
 I TITLES["A" D ATTEND
"RTN","ORB3",135,0)
 I TITLES["T" D TEAMS
"RTN","ORB3",136,0)
 I TITLES["O" D ORDERER
"RTN","ORB3",137,0)
 I TITLES["E" D ENTERBY
"RTN","ORB3",138,0)
 I TITLES["R" D PCMMPRIM
"RTN","ORB3",139,0)
 I TITLES["S" D PCMMASSC
"RTN","ORB3",140,0)
 I TITLES["M" D PCMMTEAM
"RTN","ORB3",141,0)
 Q
"RTN","ORB3",142,0)
PRIMARY ;
"RTN","ORB3",143,0)
 I $D(ORBU),ORBADT=0 S ORBU(ORBUI)=" Inpt primary provider:",ORBUI=ORBUI+1
"RTN","ORB3",144,0)
 I $D(ORBU),ORBADT=1 S ORBU(ORBUI)=" Inpt primary provider: option cannot determine without A/D/T event data.",ORBUI=ORBUI+1
"RTN","ORB3",145,0)
 I +$G(ORBPRIM)>0 S ORBDUZ=ORBPRIM D USER
"RTN","ORB3",146,0)
 Q
"RTN","ORB3",147,0)
ATTEND ;
"RTN","ORB3",148,0)
 I $D(ORBU),ORBADT=0 S ORBU(ORBUI)=" Attending physician:",ORBUI=ORBUI+1
"RTN","ORB3",149,0)
 I $D(ORBU),ORBADT=1 S ORBU(ORBUI)=" Attending physician: option cannot determine without A/D/T event data.",ORBUI=ORBUI+1
"RTN","ORB3",150,0)
 I +$G(ORBATTD)>0 S ORBDUZ=ORBATTD D USER
"RTN","ORB3",151,0)
 Q
"RTN","ORB3",152,0)
TEAMS ;
"RTN","ORB3",153,0)
 I $D(ORBU) S ORBU(ORBUI)=" Teams/Personal Lists related to patient:",ORBUI=ORBUI+1
"RTN","ORB3",154,0)
 N ORBLST,ORBI,ORBJ,ORBTM,ORBTNAME,ORBTTYPE,ORBTD
"RTN","ORB3",155,0)
 D TMSPT^ORQPTQ1(.ORBLST,ORBDFN)
"RTN","ORB3",156,0)
 Q:+$G(ORBLST(1))<1
"RTN","ORB3",157,0)
 S ORBI="" F  S ORBI=$O(ORBLST(ORBI)) Q:ORBI=""  D
"RTN","ORB3",158,0)
 .S ORBTM=$P(ORBLST(ORBI),U),ORBTNAME=$P(ORBLST(ORBI),U,2)
"RTN","ORB3",159,0)
 .S ORBTTYPE=$P(ORBLST(ORBI),U,3)
"RTN","ORB3",160,0)
 .I $D(ORBU) D
"RTN","ORB3",161,0)
 ..S ORBU(ORBUI)="  Patient list "_ORBTNAME_" ["_ORBTTYPE_"]:",ORBUI=ORBUI+1
"RTN","ORB3",162,0)
 .N ORBLST2 D TEAMPROV^ORQPTQ1(.ORBLST2,ORBTM)
"RTN","ORB3",163,0)
 .Q:+$G(ORBLST2(1))<1
"RTN","ORB3",164,0)
 .S ORBJ="" F  S ORBJ=$O(ORBLST2(ORBJ)) Q:ORBJ=""  D
"RTN","ORB3",165,0)
 ..S ORBDUZ=$P(ORBLST2(ORBJ),U)_U_ORBTM I +$G(ORBDUZ)>0 D USER
"RTN","ORB3",166,0)
 .;
"RTN","ORB3",167,0)
 .S ORBTD=$P($$TMDEV^ORB31(ORBTM),U,2)  ;Team's device
"RTN","ORB3",168,0)
 .I $L(ORBTD) D
"RTN","ORB3",169,0)
 ..S ORBTDEV(ORBTD)=""
"RTN","ORB3",170,0)
 ..I $D(ORBU) D
"RTN","ORB3",171,0)
 ...S ORBU(ORBUI)="   Team's Device "_ORBTD_" is a recipient",ORBUI=ORBUI+1
"RTN","ORB3",172,0)
 Q
"RTN","ORB3",173,0)
ORDERER ;
"RTN","ORB3",174,0)
 Q:+$G(ORNUM)<1
"RTN","ORB3",175,0)
 I $D(ORBU) S ORBU(ORBUI)=" Ordering provider:",ORBUI=ORBUI+1
"RTN","ORB3",176,0)
 N ORBLST,ORBI,ORBTM,ORBJ,ORBTNAME,ORBPLST,ORBPI,ORBPTM,ORBTTYPE
"RTN","ORB3",177,0)
 S ORBDUZ=$S(ORN=12:+$$UNSIGNOR^ORQOR2(ORNUM),1:$$ORDERER^ORQOR2(ORNUM))
"RTN","ORB3",178,0)
 I +$G(ORBDUZ)>0 D
"RTN","ORB3",179,0)
 .D USER
"RTN","ORB3",180,0)
 .;if notif = Order Req E/S (#12) or Order Req Co-sign (#37) and
"RTN","ORB3",181,0)
 .;user doesn't have ES authority, send to fellow team members w/ES:
"RTN","ORB3",182,0)
 .I ((ORN=12)!(ORN=37)),('$D(^XUSEC("ORES",ORBDUZ))) D
"RTN","ORB3",183,0)
 ..I $D(ORBU) S ORBU(ORBUI)=" Orderer can't elec sign, getting teams orderer belongs to:",ORBUI=ORBUI+1
"RTN","ORB3",184,0)
 ..D TEAMPR^ORQPTQ1(.ORBLST,ORBDUZ)  ;get orderer's tms
"RTN","ORB3",185,0)
 ..Q:+$G(ORBLST(1))<1
"RTN","ORB3",186,0)
 ..D TMSPT^ORQPTQ1(.ORBPLST,ORBDFN)  ;get pt's tms
"RTN","ORB3",187,0)
 ..Q:+$G(ORBPLST(1))<1
"RTN","ORB3",188,0)
 ..S ORBI="" F  S ORBI=$O(ORBLST(ORBI)) Q:ORBI=""  D
"RTN","ORB3",189,0)
 ...S ORBPI="" F  S ORBPI=$O(ORBPLST(ORBPI)) Q:ORBPI=""  D
"RTN","ORB3",190,0)
 ....S ORBTM=$P(ORBLST(ORBI),U),ORBPTM=$P(ORBPLST(ORBPI),U)
"RTN","ORB3",191,0)
 ....I ORBTM=ORBPTM D  ;if pt is on provider's team
"RTN","ORB3",192,0)
 .....I +$G(ORBPTM)>0 D
"RTN","ORB3",193,0)
 ......S ORBTNAME=$P(ORBPLST(ORBPI),U,2)
"RTN","ORB3",194,0)
 ......S ORBTTYPE=$P(ORBPLST(ORBPI),U,3)
"RTN","ORB3",195,0)
 ......I $D(ORBU) S ORBU(ORBUI)="  Orderer's pt list "_ORBTNAME_" ["_ORBTTYPE_"] recipients: ",ORBUI=ORBUI+1
"RTN","ORB3",196,0)
 ......N ORBLST2 D TEAMPROV^ORQPTQ1(.ORBLST2,ORBPTM)
"RTN","ORB3",197,0)
 ......Q:+$G(ORBLST2(1))<1
"RTN","ORB3",198,0)
 ......S ORBJ="" F  S ORBJ=$O(ORBLST2(ORBJ)) Q:ORBJ=""  D
"RTN","ORB3",199,0)
 .......S ORBDUZ=$P(ORBLST2(ORBJ),U)_U_ORBPTM I +$G(ORBDUZ)>0,($D(^XUSEC("ORES",+ORBDUZ))) D USER
"RTN","ORB3",200,0)
 Q
"RTN","ORB3",201,0)
ENTERBY ;
"RTN","ORB3",202,0)
 I $D(ORBU) S ORBU(ORBUI)=" User entering order's most recent activity:",ORBUI=ORBUI+1
"RTN","ORB3",203,0)
 Q:+$G(ORNUM)<1
"RTN","ORB3",204,0)
 I $D(^OR(100,ORNUM,8,0)) D
"RTN","ORB3",205,0)
 .S ORBDUZ=$P(^OR(100,ORNUM,8,$P(^OR(100,ORNUM,8,0),U,3),0),U,13)
"RTN","ORB3",206,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORB3",207,0)
 Q
"RTN","ORB3",208,0)
PCMMPRIM ;
"RTN","ORB3",209,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Primary Care Practitioner:",ORBUI=ORBUI+1
"RTN","ORB3",210,0)
 S ORBDUZ=+$$OUTPTPR^SDUTL3(ORBDFN,$$NOW^XLFDT,1)  ;DBIA #1252
"RTN","ORB3",211,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORB3",212,0)
 Q
"RTN","ORB3",213,0)
PCMMASSC ;
"RTN","ORB3",214,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Associate Provider:",ORBUI=ORBUI+1
"RTN","ORB3",215,0)
 S ORBDUZ=+$$OUTPTAP^SDUTL3(ORBDFN,$$NOW^XLFDT)  ;DBIA #1252
"RTN","ORB3",216,0)
 I +$G(ORBDUZ)>0 D USER
"RTN","ORB3",217,0)
 Q
"RTN","ORB3",218,0)
PCMMTEAM ;
"RTN","ORB3",219,0)
 N ORPCMM,ORPCMMDZ
"RTN","ORB3",220,0)
 I $D(ORBU) S ORBU(ORBUI)=" PCMM Team Position Assignments:",ORBUI=ORBUI+1
"RTN","ORB3",221,0)
 S ORPCMM=$$PRPT^SCAPMC(ORBDFN,,,,,,"^TMP(""ORPCMM"",$J)",)  ;DBIA #1916
"RTN","ORB3",222,0)
 S ORPCMMDZ=0
"RTN","ORB3",223,0)
 F  S ORPCMMDZ=$O(^TMP("ORPCMM",$J,"SCPR",ORPCMMDZ)) Q:'ORPCMMDZ  D
"RTN","ORB3",224,0)
 .S ORBDUZ=ORPCMMDZ D USER
"RTN","ORB3",225,0)
 K ^TMP("ORPCMM",$J)
"RTN","ORB3",226,0)
 Q
"RTN","ORB3",227,0)
USER ;should USER (ORBDUZ) be a recip
"RTN","ORB3",228,0)
 D USER^ORB3USER(.XQA,ORBDUZ,ORN,.ORBU,.ORBUI,ORBDFN,+$G(ORNUM))
"RTN","ORB3",229,0)
 Q
"RTN","ORB31")
0^18^B31696153
"RTN","ORB31",1,0)
ORB31 ; slc/CLA - Routine to support OE/RR 3 notifications ;6/28/00  12:00 [ 04/02/97  11:12 AM ]
"RTN","ORB31",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**6,31,88,105,139,173,220**;Dec 17, 1997
"RTN","ORB31",3,0)
QUEUE(ORN,ORBDFN,ORNUM,ORBADUZ,ORBPMSG,ORBPDATA,ORBH,ORBD,ORDGPMA) ;
"RTN","ORB31",4,0)
 ;queue up notif for Taskman processing
"RTN","ORB31",5,0)
 ;ORN       notification ien from file 100.9
"RTN","ORB31",6,0)
 ;ORBDFN    patient dfn from file 2
"RTN","ORB31",7,0)
 ;ORNUM     order number from file 100
"RTN","ORB31",8,0)
 ;ORBADUZ   array of potential user recipients (iens from file 100)
"RTN","ORB31",9,0)
 ;ORBPMSG   alert message from triggering process
"RTN","ORB31",10,0)
 ;ORBPDATA  data potentially used in alert follow-up action
"RTN","ORB31",11,0)
 ;ORBH      $H formatted time to begin Taskman process
"RTN","ORB31",12,0)
 ;ORBD      process description for Taskman
"RTN","ORB31",13,0)
 ;ORDGPMA   DGPMA if alert triggered by A/D/T event
"RTN","ORB31",14,0)
 ;
"RTN","ORB31",15,0)
 N ZTCPU,ZTDESC,ZTDTH,ZTIO,ZTPAR,ZTPRE,ZTPRI,ZTREQ,ZTRTN,ZTSAVE,ZTSK,ZTUCI,X,Y,DIC
"RTN","ORB31",16,0)
 ;
"RTN","ORB31",17,0)
 S DIC="3.5",X="ORB NOTIFICATION RESOURCE",DIC(0)="X" D ^DIC
"RTN","ORB31",18,0)
 I (Y) S ZTIO=$P(Y,U,2)
"RTN","ORB31",19,0)
 E  S ZTIO=""
"RTN","ORB31",20,0)
 S ZTDTH=ORBH,ZTRTN="ZTSK^ORB3"
"RTN","ORB31",21,0)
 S ZTDESC=ORBD
"RTN","ORB31",22,0)
 S ZTDESC=ZTDESC_"for ("_ORBDFN_") "_$P($G(^DPT(+ORBDFN,0)),U,1)
"RTN","ORB31",23,0)
 K ZTSAVE,ZTCPU,ZTUCI,ZTPRI,ZTPAR,ZTPRE,DIC,Y,DTOUT,DUOUT
"RTN","ORB31",24,0)
 ;
"RTN","ORB31",25,0)
 S ZTSAVE("ORN")=""
"RTN","ORB31",26,0)
 S ZTSAVE("ORBDFN")=""
"RTN","ORB31",27,0)
 S ZTSAVE("ORNUM")=""
"RTN","ORB31",28,0)
 S ZTSAVE("ORBADUZ(")=""
"RTN","ORB31",29,0)
 S ZTSAVE("ORBPMSG")=""
"RTN","ORB31",30,0)
 S ZTSAVE("ORBPDATA")=""
"RTN","ORB31",31,0)
 S ZTSAVE("ORDGPMA")=""
"RTN","ORB31",32,0)
 D ^%ZTLOAD
"RTN","ORB31",33,0)
 Q
"RTN","ORB31",34,0)
DUP(ORN,ORBDFN,ORBPMSG,ORNUM) ;ext funct return "1" if a duplicate notif w/in 1 min.
"RTN","ORB31",35,0)
 N ORBDUP,ORBNOW,ORBLAST,ORLNUM,ORSAMEP
"RTN","ORB31",36,0)
 S ORBDUP=0
"RTN","ORB31",37,0)
 S ORSAMEP=0
"RTN","ORB31",38,0)
 S ORBNOW=$$NOW^XLFDT
"RTN","ORB31",39,0)
 S ^XTMP("ORBDUP",0)=$$FMADD^XLFDT(ORBNOW,1,"","","")_"^"_ORBNOW
"RTN","ORB31",40,0)
 I '$L($G(^XTMP("ORBDUP",ORBDFN_";"_ORN_";"_ORBPMSG))) S ^XTMP("ORBDUP",ORBDFN_";"_ORN_";"_ORBPMSG)=ORBNOW_"^"_$G(ORNUM)
"RTN","ORB31",41,0)
 E  D
"RTN","ORB31",42,0)
 .S ORBLAST=$G(^XTMP("ORBDUP",ORBDFN_";"_ORN_";"_ORBPMSG))
"RTN","ORB31",43,0)
 .S ORLNUM=$P(ORBLAST,"^",2)
"RTN","ORB31",44,0)
 .S ORBLAST=$P(ORBLAST,"^")
"RTN","ORB31",45,0)
 .I $L($G(ORNUM)),$L($G(ORLNUM)),($$ORDERER^ORQOR2(ORNUM)=$$ORDERER^ORQOR2(ORLNUM)) S ORSAMEP=1 ;same provider as last order that triggered this notif
"RTN","ORB31",46,0)
 .;if last occurrence of this "NOT" notif was w/in past 1 min, its a dup
"RTN","ORB31",47,0)
 .I ORBNOW<$$FMADD^XLFDT(ORBLAST,"","",1,""),ORSAMEP=1 S ORBDUP=1  ;dup
"RTN","ORB31",48,0)
 .E  S ^XTMP("ORBDUP",ORBDFN_";"_ORN_";"_ORBPMSG)=ORBNOW_"^"_ORNUM  ;refresh last pt/noti occ.
"RTN","ORB31",49,0)
 D DUPCLN(ORBNOW)  ;clean up old ^XTMP("ORBUP") entries
"RTN","ORB31",50,0)
 Q ORBDUP
"RTN","ORB31",51,0)
REGDEV(ORBDA) ;send to regular recipient devices
"RTN","ORB31",52,0)
 N ORBDT,ORBD
"RTN","ORB31",53,0)
 S ORBD=""
"RTN","ORB31",54,0)
 S ORBDT=$$NOW^XLFDT
"RTN","ORB31",55,0)
 F   S ORBD=$O(ORBDA(ORBD)) Q:ORBD=""  D
"RTN","ORB31",56,0)
 .S ZTRTN="PRINTD^ORB31",ZTDESC="Print Notification to Device",ZTDTH=$H
"RTN","ORB31",57,0)
 .S ZTIO=ORBD,ZTSAVE("XQAMSG")="",ZTSAVE("ORBDT")=""
"RTN","ORB31",58,0)
 .D ^%ZTLOAD
"RTN","ORB31",59,0)
 Q
"RTN","ORB31",60,0)
PRINTD ;print queued notification to device - setup via REGDEV^ORB3
"RTN","ORB31",61,0)
 I $G(ZTSK) D KILL^%ZTLOAD
"RTN","ORB31",62,0)
 I IOT="HFS" W XQAMSG Q  ;write msg to a file then quit
"RTN","ORB31",63,0)
 W !!!,"          ***** NOTIFICATION PROCESSED *****",!!
"RTN","ORB31",64,0)
 W $$FMTE^XLFDT(ORBDT),"   "
"RTN","ORB31",65,0)
 W XQAMSG
"RTN","ORB31",66,0)
 I $E(IOST,1,2)'="C-" W @IOF
"RTN","ORB31",67,0)
 Q
"RTN","ORB31",68,0)
FWD(ORY,ORBLST,ORBRECIP,ORBTYPE,ORBCOMNT) ; forward a notification
"RTN","ORB31",69,0)
 S ORBLST(1)=ORBLST
"RTN","ORB31",70,0)
 D FORWARD^XQALFWD(.ORBLST,.ORBRECIP,ORBTYPE,ORBCOMNT)
"RTN","ORB31",71,0)
 S ORY=1
"RTN","ORB31",72,0)
 Q
"RTN","ORB31",73,0)
RENEW(ORY,XQAID) ; renew/restore an alert/notification
"RTN","ORB31",74,0)
 Q:$L($G(XQAID))<1
"RTN","ORB31",75,0)
 K XQAKILL
"RTN","ORB31",76,0)
 I '$D(^XTV(8992,"AXQA",XQAID,DUZ)) D RESTORE^XQALERT1 ;DBIA #4100
"RTN","ORB31",77,0)
 S ORY=1
"RTN","ORB31",78,0)
 Q
"RTN","ORB31",79,0)
TERMLKUP(OCXARR,OCXTERM) ; extrinsic function returns the local terms
"RTN","ORB31",80,0)
 ; linked to the nat'l OCX term in an array and the file where those
"RTN","ORB31",81,0)
 ; array terms can be found. The value of the extrinsic function is the
"RTN","ORB31",82,0)
 ; file pointed to for the local terms.
"RTN","ORB31",83,0)
 ;
"RTN","ORB31",84,0)
 ; OCXARR  - Array of local terms
"RTN","ORB31",85,0)
 ; OCXTERM - OCX nat'l term from file ^OCXS(860.9
"RTN","ORB31",86,0)
 ;
"RTN","ORB31",87,0)
 N OCXI,OCXJ,FILE,I
"RTN","ORB31",88,0)
 S OCXI="",OCXJ=0,FILE="",I=1
"RTN","ORB31",89,0)
 S OCXI=$O(^OCXS(860.9,"B",OCXTERM,OCXI))
"RTN","ORB31",90,0)
 I +$G(OCXI)>0 D
"RTN","ORB31",91,0)
 .S FILE=$P(^OCXS(860.9,OCXI,0),U,2)
"RTN","ORB31",92,0)
 .F  S OCXJ=$O(^OCXS(860.9,OCXI,1,OCXJ)) Q:+OCXJ<1  D
"RTN","ORB31",93,0)
 ..S OCXARR(I)=$P(^OCXS(860.9,OCXI,1,OCXJ,0),U,2)_U_$P(^(0),U)
"RTN","ORB31",94,0)
 ..S OCXARR=I,I=I+1
"RTN","ORB31",95,0)
 Q FILE
"RTN","ORB31",96,0)
DUPCLN(ORBNOW) ;clean up old entires in ^XTMP("ORBDUP")
"RTN","ORB31",97,0)
 N ORBX,ORBDT,ORNDT
"RTN","ORB31",98,0)
 S ORNDT=$$FMADD^XLFDT(ORBNOW,"","",-5,"")  ;entries older than 5 minutes
"RTN","ORB31",99,0)
 S ORBX=0
"RTN","ORB31",100,0)
 F  S ORBX=$O(^XTMP("ORBDUP",ORBX)) Q:ORBX=""  D
"RTN","ORB31",101,0)
 .S ORBDT=+$G(^XTMP("ORBDUP",ORBX))
"RTN","ORB31",102,0)
 .I $L(ORBDT),(ORBDT<ORNDT) K ^XTMP("ORBDUP",ORBX)
"RTN","ORB31",103,0)
 Q
"RTN","ORB31",104,0)
TMDEV(ORBTM) ;returns Device for a team in format device ien^device name
"RTN","ORB31",105,0)
 N ORBTDEV,ORBTDEVN
"RTN","ORB31",106,0)
 S ORBTDEVN=""
"RTN","ORB31",107,0)
 Q:'$L($G(ORBTM)) ""
"RTN","ORB31",108,0)
 Q:'$D(^OR(100.21,ORBTM,0)) ""
"RTN","ORB31",109,0)
 S ORBTDEV=$P(^OR(100.21,ORBTM,0),U,4)  ;get Team's device
"RTN","ORB31",110,0)
 Q:+$G(ORBTDEV)<1 ""
"RTN","ORB31",111,0)
 S X="`"_ORBTDEV,DIC=3.5,DIC(0)="" D ^DIC  ;DBIA #10114
"RTN","ORB31",112,0)
 Q:+Y<1 ""
"RTN","ORB31",113,0)
 S ORBTDEVN=$P(Y,U,2)
"RTN","ORB31",114,0)
 K DIC,Y,X
"RTN","ORB31",115,0)
 Q ORBTDEV_U_ORBTDEVN
"RTN","ORB31",116,0)
ENTITY(ORNUM) ;ext funct. rtns entity for parameter use
"RTN","ORB31",117,0)
 N ORBENT
"RTN","ORB31",118,0)
 S ORBENT="DIV^SYS^PKG"
"RTN","ORB31",119,0)
 I $L($G(ORNUM)) D  ;if order number use pt's location division
"RTN","ORB31",120,0)
 .N ORDIV
"RTN","ORB31",121,0)
 .S ORDIV=0,ORDIV=$$ORDIV(ORNUM)
"RTN","ORB31",122,0)
 .I +$G(ORDIV)>0 S ORBENT=ORDIV_";DIC(4,^SYS^PKG"
"RTN","ORB31",123,0)
 Q ORBENT
"RTN","ORB31",124,0)
 ;
"RTN","ORB31",125,0)
ADT(ORN,ORBDFN,ORBPRIM,ORBATTD,ORDGPMA) ;get inpt primary and attending for ADT notifs
"RTN","ORB31",126,0)
 N ORBADTDT,VAINDT
"RTN","ORB31",127,0)
 ;if notif is deceased or discharge use prev visit d/t:
"RTN","ORB31",128,0)
 I (ORN=20)!(ORN=35) D
"RTN","ORB31",129,0)
 .S ORBADTDT=$S($D(ORDGPMA):$P(ORDGPMA,U),1:$P($G(^DPT(ORBDFN,.35)),U))
"RTN","ORB31",130,0)
 .I $L(ORBADTDT) S VAINDT=$$FMADD^XLFDT(ORBADTDT,"","","","-1")
"RTN","ORB31",131,0)
 ;
"RTN","ORB31",132,0)
 I ORN=18 S VAINDT=$P($G(ORDGPMA),U)  ;if admission use this visit d/t
"RTN","ORB31",133,0)
 ;
"RTN","ORB31",134,0)
 I $L($G(VAINDT)) D
"RTN","ORB31",135,0)
 .D INP^VADPT  ;get new VAIN array for appropriate visit
"RTN","ORB31",136,0)
 .S ORBPRIM=+$P(VAIN(2),U),ORBATTD=+$P(VAIN(11),U)
"RTN","ORB31",137,0)
 Q
"RTN","ORB31",138,0)
 ;
"RTN","ORB31",139,0)
DEFDIV(ORDUZ) ; Return user's default division, if specified.
"RTN","ORB31",140,0)
 ;
"RTN","ORB31",141,0)
 N ORDD,ORDIV,ORGOOD,ORZ,ORZERR
"RTN","ORB31",142,0)
 ;
"RTN","ORB31",143,0)
 S ORDIV=""
"RTN","ORB31",144,0)
 S Y=0,(ORDD,ORGOOD)=0             ; Initialize variables.
"RTN","ORB31",145,0)
 ;
"RTN","ORB31",146,0)
 ; Get list of divisions from NEW PERSON file multiple:
"RTN","ORB31",147,0)
 D LIST^DIC(200.02,","_ORDUZ_",","@;.01;1","QP","","","","","","","ORZ","ORZERR")
"RTN","ORB31",148,0)
 I $P(ORZ("DILIST",0),U)=0 Q       ; No Divisions listed.
"RTN","ORB31",149,0)
 ;
"RTN","ORB31",150,0)
 F  S ORDD=$O(ORZ("DILIST",ORDD)) Q:+ORDD=0!'($L(ORDD))  D  Q:ORGOOD
"RTN","ORB31",151,0)
 .; See if current entry being processed is "Default" (done if so):
"RTN","ORB31",152,0)
 .I $P(ORZ("DILIST",ORDD,0),U,3)["Y" S ORDIV=$P(ORZ("DILIST",ORDD,0),U,1,2),ORGOOD=1
"RTN","ORB31",153,0)
 Q ORDIV
"RTN","ORB31",154,0)
 ;
"RTN","ORB31",155,0)
ORDIV(ORNUM) ; Return order's division based upon patient's location when order was placed
"RTN","ORB31",156,0)
 ;
"RTN","ORB31",157,0)
 Q:+$G(ORNUM)<1 ""
"RTN","ORB31",158,0)
 Q:'$D(^OR(100,ORNUM,0)) ""
"RTN","ORB31",159,0)
 N ORDIV,PTLOC
"RTN","ORB31",160,0)
 S ORDIV=""
"RTN","ORB31",161,0)
 S PTLOC=+$P(^OR(100,ORNUM,0),U,10)
"RTN","ORB31",162,0)
 Q:$G(PTLOC)<1 ""
"RTN","ORB31",163,0)
 S ORDIV=$P(^SC(PTLOC,0),U,4)  ;DBIA #10040
"RTN","ORB31",164,0)
 Q ORDIV
"RTN","ORB3F1")
0^21^B10770422
"RTN","ORB3F1",1,0)
ORB3F1 ; slc/CLA - Extrinsic functions to support OE/RR 3 notifications ;5/8/95  15:16 [2/24/05 1:23pm]
"RTN","ORB3F1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,74,139,190,220**;Dec 17, 1997
"RTN","ORB3F1",3,0)
 ;
"RTN","ORB3F1",4,0)
XQAKILL(ORN) ;extrinsic function to return the delete mechanism for the notification based on definition in PARAM DEF file
"RTN","ORB3F1",5,0)
 N ORBKILL S ORBKILL=1
"RTN","ORB3F1",6,0)
 Q:$G(ORN)="" ORBKILL
"RTN","ORB3F1",7,0)
 S ORBKILL=$$GET^XPAR("DIV^SYS^PKG","ORB DELETE MECHANISM",ORN,"I")
"RTN","ORB3F1",8,0)
 I ORBKILL="A" S ORBKILL=0  ;delete for all recipients
"RTN","ORB3F1",9,0)
 E  S ORBKILL=1  ;default for delete mechanism is 1 (delete only for this recipient)
"RTN","ORB3F1",10,0)
 Q ORBKILL
"RTN","ORB3F1",11,0)
SITEORD(ORNUM,IOPT) ;Extrinsic function returns 1 (Yes) if the site has flagged the
"RTN","ORB3F1",12,0)
 ; orderable item (determined from the order number ORNUM) to trigger a
"RTN","ORB3F1",13,0)
 ; notification when ordered
"RTN","ORB3F1",14,0)
 N ORBFLAG,OI,ORBLST,ORBERR,ORBI,ORBE
"RTN","ORB3F1",15,0)
 S ORBFLAG=0,OI="",ORBE="",ORBERR=""
"RTN","ORB3F1",16,0)
 Q:+$G(ORNUM)<1 ORBFLAG
"RTN","ORB3F1",17,0)
 S OI=$$OI^ORQOR2(ORNUM)
"RTN","ORB3F1",18,0)
 Q:+$G(OI)<1 ORBFLAG
"RTN","ORB3F1",19,0)
 I IOPT="I" D
"RTN","ORB3F1",20,0)
 .D ENVAL^XPAR(.ORBLST,"ORB OI ORDERED - INPT","`"_OI,.ORBERR)
"RTN","ORB3F1",21,0)
 .Q:$G(ORBLST)>0
"RTN","ORB3F1",22,0)
 .D ENVAL^XPAR(.ORBLST,"ORB OI ORDERED - INPT PR","`"_OI,.ORBERR)
"RTN","ORB3F1",23,0)
 I IOPT="O" D
"RTN","ORB3F1",24,0)
 .D ENVAL^XPAR(.ORBLST,"ORB OI ORDERED - OUTPT","`"_OI,.ORBERR)
"RTN","ORB3F1",25,0)
 .Q:$G(ORBLST)>0
"RTN","ORB3F1",26,0)
 .D ENVAL^XPAR(.ORBLST,"ORB OI ORDERED - OUTPT PR","`"_OI,.ORBERR)
"RTN","ORB3F1",27,0)
 I 'ORBERR,$G(ORBLST)>0 D
"RTN","ORB3F1",28,0)
 .F ORBI=1:1:ORBLST Q:ORBFLAG=1  D
"RTN","ORB3F1",29,0)
 ..S ORBE=$O(ORBLST(ORBE))
"RTN","ORB3F1",30,0)
 ..I $D(ORBLST(ORBE,OI)) S ORBFLAG=1
"RTN","ORB3F1",31,0)
 Q ORBFLAG
"RTN","ORB3F1",32,0)
SITERES(ORNUM,IOPT) ;Extrinsic function returns 1 (Yes) if the site has flagged the
"RTN","ORB3F1",33,0)
 ; orderable item (determined from the order number ORNUM) to trigger a
"RTN","ORB3F1",34,0)
 ; notification when resulted
"RTN","ORB3F1",35,0)
 N ORBFLAG,OI,ORBLST,ORBERR,ORBI,ORBE
"RTN","ORB3F1",36,0)
 S ORBFLAG=0,OI="",ORBE="",ORBERR=""
"RTN","ORB3F1",37,0)
 Q:+$G(ORNUM)<1 ORBFLAG
"RTN","ORB3F1",38,0)
 S OI=$$OI^ORQOR2(ORNUM)
"RTN","ORB3F1",39,0)
 Q:+$G(OI)<1 ORBFLAG
"RTN","ORB3F1",40,0)
 I IOPT="I" D ENVAL^XPAR(.ORBLST,"ORB OI RESULTS - INPT","`"_OI,.ORBERR)
"RTN","ORB3F1",41,0)
 I IOPT="O" D ENVAL^XPAR(.ORBLST,"ORB OI RESULTS - OUTPT","`"_OI,.ORBERR)
"RTN","ORB3F1",42,0)
 I 'ORBERR,$G(ORBLST)>0 D
"RTN","ORB3F1",43,0)
 .F ORBI=1:1:ORBLST Q:ORBFLAG=1  D
"RTN","ORB3F1",44,0)
 ..S ORBE=$O(ORBLST(ORBE))
"RTN","ORB3F1",45,0)
 ..I $D(ORBLST(ORBE,OI)) S ORBFLAG=1
"RTN","ORB3F1",46,0)
 Q ORBFLAG
"RTN","ORB3F1",47,0)
LRRAD(OI) ;Extrinsic function returns 1 (true) if Orderable Item is a
"RTN","ORB3F1",48,0)
 ;Chemistry Lab ("S.CH") or Imaging ("S.XRAY") proc or Consult ("S.CSLT")
"RTN","ORB3F1",49,0)
 N OITEXT,ORBFLAG
"RTN","ORB3F1",50,0)
 S ORBFLAG=""
"RTN","ORB3F1",51,0)
 Q:+$G(OI)<1 ORBFLAG
"RTN","ORB3F1",52,0)
 Q:'$L($G(^ORD(101.43,OI,0))) ORBFLAG
"RTN","ORB3F1",53,0)
 S OITEXT=$P(^ORD(101.43,OI,0),U)
"RTN","ORB3F1",54,0)
 S OITEXT=$$UP^XLFSTR(OITEXT)
"RTN","ORB3F1",55,0)
 Q:$D(^ORD(101.43,"S.CH",OITEXT)) 1
"RTN","ORB3F1",56,0)
 Q:$D(^ORD(101.43,"S.XRAY",OITEXT)) 1
"RTN","ORB3F1",57,0)
 Q:$D(^ORD(101.43,"S.CSLT",OITEXT)) 1
"RTN","ORB3F1",58,0)
 Q ORBFLAG
"RTN","ORB3F1",59,0)
 ;
"RTN","ORB3F1",60,0)
EXP(ORDT,ORNUM) ;set up ^XTMP("ORAE" to store expired orders
"RTN","ORB3F1",61,0)
 N ORNOW,X0
"RTN","ORB3F1",62,0)
 S ORNOW=$$NOW^XLFDT
"RTN","ORB3F1",63,0)
 S ^XTMP("ORAE",0)=$$FMADD^XLFDT(ORNOW,30,"","","")_U_ORNOW
"RTN","ORB3F1",64,0)
 S X0=^OR(100,ORNUM,0)
"RTN","ORB3F1",65,0)
 S ^XTMP("ORAE",$P(X0,U,2),$P(X0,U,11),ORDT,ORNUM)=""
"RTN","ORB3F1",66,0)
 Q
"RTN","ORB3F1",67,0)
 ;
"RTN","ORB3F1",68,0)
DELEXP ; delete ^XTMP("ORAE" entries older than param value + 48 hours 
"RTN","ORB3F1",69,0)
 ; or have been replaced by another order
"RTN","ORB3F1",70,0)
 N ORNOW,OREXDT,OREXPAR,ORDELDT,ORPT,ORDG,ORN,ORREP
"RTN","ORB3F1",71,0)
 S ORNOW=$$NOW^XLFDT
"RTN","ORB3F1",72,0)
 S OREXPAR=$$GET^XPAR("ALL","ORWOR EXPIRED ORDERS",1,"I")
"RTN","ORB3F1",73,0)
 S OREXPAR=$S($G(OREXPAR):OREXPAR,1:72)
"RTN","ORB3F1",74,0)
 S ORDELDT=$$FMADD^XLFDT(ORNOW,"",-(OREXPAR+48),"","")
"RTN","ORB3F1",75,0)
 S ORPT=0 F  S ORPT=$O(^XTMP("ORAE",ORPT)) Q:'ORPT  D
"RTN","ORB3F1",76,0)
 .S ORDG=0 F  S ORDG=$O(^XTMP("ORAE",ORPT,ORDG)) Q:'ORDG  D
"RTN","ORB3F1",77,0)
 ..S OREXDT=0 F  S OREXDT=$O(^XTMP("ORAE",ORPT,ORDG,OREXDT)) Q:'OREXDT  D
"RTN","ORB3F1",78,0)
 ...I OREXDT<ORDELDT K ^XTMP("ORAE",ORPT,ORDG,OREXDT) Q
"RTN","ORB3F1",79,0)
 ...S ORN=0 F  S ORN=$O(^XTMP("ORAE",ORPT,ORDG,OREXDT,ORN)) Q:'ORN  D
"RTN","ORB3F1",80,0)
 ....Q:'$D(^OR(100,ORN,3))
"RTN","ORB3F1",81,0)
 ....S ORREP=$P(^OR(100,ORN,3),U,6)
"RTN","ORB3F1",82,0)
 ....I +$G(ORREP)>0 K ^XTMP("ORAE",ORPT,ORDG,OREXDT,ORN)
"RTN","ORB3F1",83,0)
 Q
"RTN","ORB3MGR1")
0^20^B70181169
"RTN","ORB3MGR1",1,0)
ORB3MGR1 ; SLC/AEB - Manager Options - Notifications Parameters ;9/22/97
"RTN","ORB3MGR1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**31,74,85,88,105,139,173,220**;Dec 17, 1997
"RTN","ORB3MGR1",3,0)
 ;
"RTN","ORB3MGR1",4,0)
 ;Calls to Add/Change/Delete Parameters
"RTN","ORB3MGR1",5,0)
 ;
"RTN","ORB3MGR1",6,0)
URG ; Notification Urgency - By Entity
"RTN","ORB3MGR1",7,0)
 ;
"RTN","ORB3MGR1",8,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",9,0)
 S ORBT="Set URGENCY Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",10,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB URGENCY",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",11,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",12,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",13,0)
 Q
"RTN","ORB3MGR1",14,0)
 ;
"RTN","ORB3MGR1",15,0)
DEL ;
"RTN","ORB3MGR1",16,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",17,0)
 S ORBT="Set DELETE MECHANISM Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",18,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB DELETE MECHANISM",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",19,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",20,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",21,0)
 Q
"RTN","ORB3MGR1",22,0)
 ;
"RTN","ORB3MGR1",23,0)
REGR ;
"RTN","ORB3MGR1",24,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",25,0)
 S ORBT="Set REGULAR (DEFAULT) RECIPIENTS Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",26,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB DEFAULT RECIPIENTS",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",27,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",28,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",29,0)
 Q
"RTN","ORB3MGR1",30,0)
 ;
"RTN","ORB3MGR1",31,0)
REGDEV ;
"RTN","ORB3MGR1",32,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",33,0)
 S ORBT="Set REGULAR (DEFAULT) RECIPIENT DEVICES Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",34,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB DEFAULT RECIPIENT DEVICES",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",35,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",36,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",37,0)
 Q
"RTN","ORB3MGR1",38,0)
 ;
"RTN","ORB3MGR1",39,0)
TITLR ;
"RTN","ORB3MGR1",40,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",41,0)
 S ORBT="Set PROVIDER RECIPIENTS Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",42,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB PROVIDER RECIPIENTS",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",43,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",44,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",45,0)
 Q
"RTN","ORB3MGR1",46,0)
 ;
"RTN","ORB3MGR1",47,0)
PFLAG ;
"RTN","ORB3MGR1",48,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",49,0)
 S ORBT="Set PROCESSING FLAG Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",50,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB PROCESSING FLAG",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",51,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",52,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",53,0)
 Q
"RTN","ORB3MGR1",54,0)
 ;
"RTN","ORB3MGR1",55,0)
ERASE ;
"RTN","ORB3MGR1",56,0)
 N ORBT,ORBX,ORBPAR,ORBER,DUOUT,DIRUT
"RTN","ORB3MGR1",57,0)
 S ORBT="Erase Notifications"
"RTN","ORB3MGR1",58,0)
 S ORBER=0
"RTN","ORB3MGR1",59,0)
 Q:$D(DUOUT)!(ORBER="")
"RTN","ORB3MGR1",60,0)
 D TITLE(ORBT)
"RTN","ORB3MGR1",61,0)
 W !!!,?5,"1.  Erase all notifications for a User "
"RTN","ORB3MGR1",62,0)
 W !!,?5,"2.  Erase all notifications for a Patient "
"RTN","ORB3MGR1",63,0)
 W !!,?5,"3.  Erase all instances of a notification (regardless of Patient or User) "
"RTN","ORB3MGR1",64,0)
 W !!,?5,"4.  Erase specific notifications for a User "
"RTN","ORB3MGR1",65,0)
 W !!,?5,"5.  Edit Erase All Notifications parameter for a User ",!!
"RTN","ORB3MGR1",66,0)
 K DIR S DIR(0)="NAO^1:5",DIR("A")="Select Erase option:  "
"RTN","ORB3MGR1",67,0)
 D ^DIR S ORBER=Y K DIR Q:$D(DIRUT)
"RTN","ORB3MGR1",68,0)
 K Y,X,DTOUT,DUOUT,DIRUT
"RTN","ORB3MGR1",69,0)
 I (ORBER=1) D RECIPURG^ORB3MGR2
"RTN","ORB3MGR1",70,0)
 I (ORBER=2) D PTPURG^ORB3MGR2
"RTN","ORB3MGR1",71,0)
 I (ORBER=3) D NOTIPURG^ORB3MGR2
"RTN","ORB3MGR1",72,0)
 I (ORBER=4) D USERDEL^ORB3MGR2
"RTN","ORB3MGR1",73,0)
 I (ORBER=5) D ERASEALL^ORB3MGR2
"RTN","ORB3MGR1",74,0)
 D ERASE
"RTN","ORB3MGR1",75,0)
 Q
"RTN","ORB3MGR1",76,0)
 ;
"RTN","ORB3MGR1",77,0)
FLGOI ;
"RTN","ORB3MGR1",78,0)
 N ORBT,ORBOI,DIRUT,DUOUT,Y
"RTN","ORB3MGR1",79,0)
 S ORBT="Flag ORDERABLE ITEMS to send Notifications"
"RTN","ORB3MGR1",80,0)
 F  D  Q:$D(DUOUT)!(Y="")
"RTN","ORB3MGR1",81,0)
 .S Y=0
"RTN","ORB3MGR1",82,0)
 .D TITLE(ORBT)
"RTN","ORB3MGR1",83,0)
 .W !!,"1.  Flag INPATIENT orders/results/expiring orders."
"RTN","ORB3MGR1",84,0)
 .W !,"2.  Flag OUTPATIENT orders/results/expiring orders."
"RTN","ORB3MGR1",85,0)
 .W !,"3.  Flag Lab tests for Threshold Exceeded alerts.",!
"RTN","ORB3MGR1",86,0)
 .K DIR S DIR(0)="NAO^1:3",DIR("A")="Select ""1"" to flag INPT orders/results, ""2"" to flag OUTPT orders/results, ""3"" to set Lab Thresholds: "
"RTN","ORB3MGR1",87,0)
 .D ^DIR S ORBOI=Y K DIR Q:$D(DIRUT)
"RTN","ORB3MGR1",88,0)
 .K X,DTOUT,DUOUT,DIRUT
"RTN","ORB3MGR1",89,0)
 .I ORBOI=1 D INPTOI
"RTN","ORB3MGR1",90,0)
 .I ORBOI=2 D OUTPTOI
"RTN","ORB3MGR1",91,0)
 .I ORBOI=3 D LABTHRES^ORB3MGR2
"RTN","ORB3MGR1",92,0)
 Q
"RTN","ORB3MGR1",93,0)
INPTOI ;
"RTN","ORB3MGR1",94,0)
 N ORBT,ORBPAR,ORBOI,DIRUT,DUOUT,PIEN,Y
"RTN","ORB3MGR1",95,0)
 S ORBT="Flag INPATIENT orderable items to send Notifications/Alerts"
"RTN","ORB3MGR1",96,0)
 F  D  Q:$D(DUOUT)!(Y="")
"RTN","ORB3MGR1",97,0)
 .D TITLE(ORBT)
"RTN","ORB3MGR1",98,0)
 .W !!,"1.  Flag Inpatient ORDERS."
"RTN","ORB3MGR1",99,0)
 .W !,"2.  Flag Inpatient ORDERS for PROVIDER RECIPIENTS."
"RTN","ORB3MGR1",100,0)
 .W !,"3.  Flag Inpatient RESULTS."
"RTN","ORB3MGR1",101,0)
 .W !,"4.  Flag Inpatient RESULTS for PROVIDER RECIPIENTS."
"RTN","ORB3MGR1",102,0)
 .W !,"5.  Flag Inpatient EXPIRING orders."
"RTN","ORB3MGR1",103,0)
 .W !,"6.  Flag Inpatient EXPIRING orders for PROVIDER RECIPIENTS.",!
"RTN","ORB3MGR1",104,0)
 .S PIEN=0,Y=0
"RTN","ORB3MGR1",105,0)
 .K DIR S DIR(0)="NAO^1:6",DIR("A")="Select ""1 or 2"" to flag inpt ORDERS, ""3 or 4"" to flag inpt RESULTS, ""5 or 6"" to flag inpt EXPIRING orders: "
"RTN","ORB3MGR1",106,0)
 .D ^DIR S ORBOI=Y K DIR Q:$D(DIRUT)
"RTN","ORB3MGR1",107,0)
 .K X,DTOUT,DUOUT,DIRUT
"RTN","ORB3MGR1",108,0)
 .I ORBOI=1 D
"RTN","ORB3MGR1",109,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI ORDERED - INPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",110,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",111,0)
 .I ORBOI=2 D
"RTN","ORB3MGR1",112,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI ORDERED - INPT PR",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",113,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",114,0)
 .I ORBOI=3 D
"RTN","ORB3MGR1",115,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI RESULTS - INPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",116,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",117,0)
 .I ORBOI=4 D
"RTN","ORB3MGR1",118,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI RESULTS - INPT PR",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",119,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",120,0)
 .I ORBOI=5 D
"RTN","ORB3MGR1",121,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI EXPIRING - INPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",122,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",123,0)
 .I ORBOI=6 D
"RTN","ORB3MGR1",124,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI EXPIRING - INPT PR",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",125,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",126,0)
 .D PROC(ORBPAR)
"RTN","ORB3MGR1",127,0)
 Q
"RTN","ORB3MGR1",128,0)
 ;
"RTN","ORB3MGR1",129,0)
OUTPTOI ;
"RTN","ORB3MGR1",130,0)
 N ORBT,ORBPAR,ORBOI,DIRUT,DUOUT,PIEN,Y
"RTN","ORB3MGR1",131,0)
 S ORBT="Flag OUTPATIENT orderable items to send Notifications"
"RTN","ORB3MGR1",132,0)
 F  D  Q:$D(DUOUT)!(Y="")
"RTN","ORB3MGR1",133,0)
 .D TITLE(ORBT)
"RTN","ORB3MGR1",134,0)
 .W !!,"1.  Flag Outpatient ORDERS."
"RTN","ORB3MGR1",135,0)
 .W !,"2.  Flag Outpatient ORDERS for PROVIDER RECIPIENTS."
"RTN","ORB3MGR1",136,0)
 .W !,"3.  Flag Outpatient RESULTS."
"RTN","ORB3MGR1",137,0)
 .W !,"4.  Flag Outpatient RESULTS for PROVIDER RECIPIENTS."
"RTN","ORB3MGR1",138,0)
 .W !,"5.  Flag Outpatient EXPIRING orders."
"RTN","ORB3MGR1",139,0)
 .W !,"6.  Flag Outpatient EXPIRING orders for PROVIDER RECIPIENTS.",!
"RTN","ORB3MGR1",140,0)
 .S PIEN=0,Y=0
"RTN","ORB3MGR1",141,0)
 .K DIR S DIR(0)="NAO^1:6",DIR("A")="Select ""1 or 2"" to flag outpt ORDERS, ""3 or 4"" to flag outpt RESULTS, ""5 or 6"" to flag outpt EXPIRING orders: "
"RTN","ORB3MGR1",142,0)
 .D ^DIR S ORBOI=Y K DIR Q:$D(DIRUT)
"RTN","ORB3MGR1",143,0)
 .K X,DTOUT,DUOUT,DIRUT
"RTN","ORB3MGR1",144,0)
 .I ORBOI=1 D
"RTN","ORB3MGR1",145,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI ORDERED - OUTPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",146,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",147,0)
 .I ORBOI=2 D
"RTN","ORB3MGR1",148,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI ORDERED - OUTPT PR",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",149,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",150,0)
 .I ORBOI=3 D
"RTN","ORB3MGR1",151,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI RESULTS - OUTPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",152,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",153,0)
 .I ORBOI=4 D
"RTN","ORB3MGR1",154,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI RESULTS - OUTPT PR",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",155,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",156,0)
 .I ORBOI=5 D
"RTN","ORB3MGR1",157,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI EXPIRING - OUTPT",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",158,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",159,0)
 .I ORBOI=6 D
"RTN","ORB3MGR1",160,0)
 ..S PIEN=$O(^XTV(8989.51,"B","ORB OI EXPIRING - OUTPT PR",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",161,0)
 ..S ORBPAR=PIEN
"RTN","ORB3MGR1",162,0)
 .D PROC(ORBPAR)
"RTN","ORB3MGR1",163,0)
 Q
"RTN","ORB3MGR1",164,0)
 ;
"RTN","ORB3MGR1",165,0)
ARC ;
"RTN","ORB3MGR1",166,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",167,0)
 S ORBT="Set ARCHIVE PERIOD Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",168,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB ARCHIVE PERIOD",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",169,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",170,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",171,0)
 Q
"RTN","ORB3MGR1",172,0)
 ;
"RTN","ORB3MGR1",173,0)
FSUPER ;
"RTN","ORB3MGR1",174,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",175,0)
 S ORBT="Set FORWARD SUPERVISOR Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",176,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB FORWARD SUPERVISOR",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",177,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",178,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",179,0)
 Q
"RTN","ORB3MGR1",180,0)
 ;
"RTN","ORB3MGR1",181,0)
FSURR ;
"RTN","ORB3MGR1",182,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",183,0)
 S ORBT="Set FORWARD SURROGATES Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",184,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB FORWARD SURROGATES",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",185,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",186,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",187,0)
 Q
"RTN","ORB3MGR1",188,0)
 ;
"RTN","ORB3MGR1",189,0)
FREVIEW ;
"RTN","ORB3MGR1",190,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",191,0)
 S ORBT="Set FORWARD BACKUP REVIEWER Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",192,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB FORWARD BACKUP REVIEWER",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",193,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",194,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",195,0)
 Q
"RTN","ORB3MGR1",196,0)
 ;
"RTN","ORB3MGR1",197,0)
FLGOB ;
"RTN","ORB3MGR1",198,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",199,0)
 S ORBT="Set FLAGGED ORDERS BULLETIN Parameters for Notifications",PIEN=0
"RTN","ORB3MGR1",200,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB FLAGGED ORDERS BULLETIN",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",201,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",202,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",203,0)
 Q
"RTN","ORB3MGR1",204,0)
 ;
"RTN","ORB3MGR1",205,0)
SYSEN ;
"RTN","ORB3MGR1",206,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",207,0)
 S ORBT="Enable or Disable Notification System",PIEN=0
"RTN","ORB3MGR1",208,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB SYSTEM ENABLE/DISABLE",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",209,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",210,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",211,0)
 Q
"RTN","ORB3MGR1",212,0)
 ;
"RTN","ORB3MGR1",213,0)
UVMED ;
"RTN","ORB3MGR1",214,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",215,0)
 S ORBT="Set Delay for Unverified Medication Orders",PIEN=0
"RTN","ORB3MGR1",216,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB UNVERIFIED MED ORDER",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",217,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",218,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",219,0)
 Q
"RTN","ORB3MGR1",220,0)
 ;
"RTN","ORB3MGR1",221,0)
UNVER ;
"RTN","ORB3MGR1",222,0)
 N ORBT,ORBPAR,PIEN
"RTN","ORB3MGR1",223,0)
 S ORBT="Set Delay for All Unverified Orders",PIEN=0
"RTN","ORB3MGR1",224,0)
 S PIEN=$O(^XTV(8989.51,"B","ORB UNVERIFIED ORDER",PIEN)) Q:PIEN=""
"RTN","ORB3MGR1",225,0)
 S ORBPAR=PIEN
"RTN","ORB3MGR1",226,0)
 D TITLE(ORBT) D PROC(ORBPAR)
"RTN","ORB3MGR1",227,0)
 Q
"RTN","ORB3MGR1",228,0)
 ;
"RTN","ORB3MGR1",229,0)
TITLE(ORBT)  ;
"RTN","ORB3MGR1",230,0)
 ; Center and write title - Parameter to be set
"RTN","ORB3MGR1",231,0)
 S IOP=0 D ^%ZIS K IOP W @IOF
"RTN","ORB3MGR1",232,0)
 W !,?(80-$L(ORBT)-1/2),ORBT
"RTN","ORB3MGR1",233,0)
 Q
"RTN","ORB3MGR1",234,0)
 ;
"RTN","ORB3MGR1",235,0)
PROC(ORBPAR) ; Process Parameter Settings
"RTN","ORB3MGR1",236,0)
 D EDITPAR^XPAREDIT(ORBPAR)
"RTN","ORB3MGR1",237,0)
 Q
"RTN","ORB3SPEC")
0^1^B80431397
"RTN","ORB3SPEC",1,0)
ORB3SPEC ; slc/CLA - Support routine for ORB3 ;4/4/02  14:40
"RTN","ORB3SPEC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**139,220**;Dec 17, 1997
"RTN","ORB3SPEC",3,0)
SPECIAL(ORN,ORBASPEC,ORBU,ORBUI,ORNUM,ORDFN,ORDATA,ORBSMSG,ORBMSG,ORBSDEV,ORBPRIM,ORBATTD) ;
"RTN","ORB3SPEC",4,0)
 ;process special notifs to get recips (users,teams,devices)
"RTN","ORB3SPEC",5,0)
 ; ORN: notif ien
"RTN","ORB3SPEC",6,0)
 ; ORBASPEC: recip DUZ array
"RTN","ORB3SPEC",7,0)
 ; ORBU: recip debug array
"RTN","ORB3SPEC",8,0)
 ; ORBUI: ORBU cntr
"RTN","ORB3SPEC",9,0)
 ; ORNUM: order no
"RTN","ORB3SPEC",10,0)
 ; ORDFN: pt id
"RTN","ORB3SPEC",11,0)
 ; ORDATA: pkg data
"RTN","ORB3SPEC",12,0)
 ; ORBSMSG: special notif msg rtn by SPECIAL
"RTN","ORB3SPEC",13,0)
 ; ORBMSG: original notif msg
"RTN","ORB3SPEC",14,0)
 ; ORBSDEV: array of recip devices
"RTN","ORB3SPEC",15,0)
 ; ORBPRIM: pt's inpt primary care provider
"RTN","ORB3SPEC",16,0)
 ; ORBATTD: pt's attending physician
"RTN","ORB3SPEC",17,0)
 ;
"RTN","ORB3SPEC",18,0)
 N ORPAR,ORPTLOC
"RTN","ORB3SPEC",19,0)
 S ORPTLOC=$S($L($G(^DPT(ORDFN,.1))):"I",1:"O")  ;DBIA #10035
"RTN","ORB3SPEC",20,0)
 ;
"RTN","ORB3SPEC",21,0)
 I ORPTLOC="I" D  ;inpt flagged OI notifs
"RTN","ORB3SPEC",22,0)
 .I ORN=32 S ORPAR="ORB OI RESULTS - INPT" D OI
"RTN","ORB3SPEC",23,0)
 .I ORN=41 S ORPAR="ORB OI ORDERED - INPT" D OI
"RTN","ORB3SPEC",24,0)
 .I ORN=64 S ORPAR="ORB OI EXPIRING - INPT" D OI
"RTN","ORB3SPEC",25,0)
 ;
"RTN","ORB3SPEC",26,0)
 I ORPTLOC="O" D  ;outpt flagged OI notifs
"RTN","ORB3SPEC",27,0)
 .I ORN=60 S ORPAR="ORB OI RESULTS - OUTPT" D OI
"RTN","ORB3SPEC",28,0)
 .I ORN=61 S ORPAR="ORB OI ORDERED - OUTPT" D OI
"RTN","ORB3SPEC",29,0)
 .I ORN=65 S ORPAR="ORB OI EXPIRING - OUTPT" D OI
"RTN","ORB3SPEC",30,0)
 ;
"RTN","ORB3SPEC",31,0)
 I ORN=3!(ORN=14)!(ORN=44)!(ORN=57) D  ;lab results notifs
"RTN","ORB3SPEC",32,0)
 .D LRALRTS(ORN,ORDFN,ORDATA,.ORBSMSG,ORBMSG)
"RTN","ORB3SPEC",33,0)
 ;
"RTN","ORB3SPEC",34,0)
 I ORN=33 D  ;requested results notif
"RTN","ORB3SPEC",35,0)
 .I $D(ORBU) D
"RTN","ORB3SPEC",36,0)
 ..S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3SPEC",37,0)
 ..S ORBU(ORBUI)="Potential Orderer-flagged Results recipient: ",ORBUI=ORBUI+1
"RTN","ORB3SPEC",38,0)
 .N RECIP
"RTN","ORB3SPEC",39,0)
 .S RECIP=$$RSLTFLG^ORQOR2(ORNUM)
"RTN","ORB3SPEC",40,0)
 .I +$G(RECIP)>0 D
"RTN","ORB3SPEC",41,0)
 ..S ORBASPEC(+$G(RECIP))=""
"RTN","ORB3SPEC",42,0)
 ..I $D(ORBU) N NODE S NODE=$G(^VA(200,+$G(RECIP),0)) I $L(NODE) D
"RTN","ORB3SPEC",43,0)
 ...S ORBU(ORBUI)="   "_$P(NODE,U)_" is a potential recipient.",ORBUI=ORBUI+1
"RTN","ORB3SPEC",44,0)
 Q
"RTN","ORB3SPEC",45,0)
OI ;get potential recips for OI-flagged notifs
"RTN","ORB3SPEC",46,0)
 N OROI,ORLST,ORERR,ORBX,ORBZ,ORBE,ORBDUZ,ORBDEV,ORBUF
"RTN","ORB3SPEC",47,0)
 S OROI=+$G(^OR(100,+$G(ORNUM),.1,1,0))  ;get oi
"RTN","ORB3SPEC",48,0)
 Q:+$G(OROI)<0
"RTN","ORB3SPEC",49,0)
 I $D(ORBU) D
"RTN","ORB3SPEC",50,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3SPEC",51,0)
 .S ORBU(ORBUI)="Special potential recipients from parameter: "_ORPAR,ORBUI=ORBUI+1
"RTN","ORB3SPEC",52,0)
 S ORBE=0,ORBX=0
"RTN","ORB3SPEC",53,0)
 ;
"RTN","ORB3SPEC",54,0)
 ;process special recip users, teams and devices:
"RTN","ORB3SPEC",55,0)
 D ENVAL^XPAR(.ORLST,ORPAR,"`"_OROI,.ORERR)
"RTN","ORB3SPEC",56,0)
 I 'ORERR,$G(ORLST)>0 D
"RTN","ORB3SPEC",57,0)
 .F ORBX=1:1:ORLST S ORBE=$O(ORLST(ORBE)),ORBZ=$P(ORBE,";",2),ORBUF=0 D
"RTN","ORB3SPEC",58,0)
 ..;
"RTN","ORB3SPEC",59,0)
 ..; process USERS:
"RTN","ORB3SPEC",60,0)
 ..I ORBZ="VA(200," S ORBDUZ=$P(ORBE,";") I $L(ORBDUZ) D
"RTN","ORB3SPEC",61,0)
 ...I ORLST(ORBE,OROI)=1 S ORBASPEC(ORBDUZ)="",ORBUF=1
"RTN","ORB3SPEC",62,0)
 ...I ORLST(ORBE,OROI)=0,$$PPLINK^ORQPTQ1(ORBDUZ,ORDFN) S ORBASPEC(ORBDUZ)="",ORBUF=1
"RTN","ORB3SPEC",63,0)
 ...I $D(ORBU),ORBUF=1 N NODE S NODE=$G(^VA(200,ORBDUZ,0)) I $L(NODE) D
"RTN","ORB3SPEC",64,0)
 ....S ORBU(ORBUI)="   "_$P(NODE,U)_" is a potential recipient.",ORBUI=ORBUI+1
"RTN","ORB3SPEC",65,0)
 ..;
"RTN","ORB3SPEC",66,0)
 ..; process DEVICES:
"RTN","ORB3SPEC",67,0)
 ..I ORBZ="%ZIS(1," S ORBDEV=$P(ORBE,";") I $L(ORBDEV) D
"RTN","ORB3SPEC",68,0)
 ...S ORBDEV=$G(^%ZIS(1,ORBDEV,0)) I $D(ORBDEV) D
"RTN","ORB3SPEC",69,0)
 ....I ORLST(ORBE,OROI)=1 S ORBSDEV($P(ORBDEV,U))="",ORBUF=1
"RTN","ORB3SPEC",70,0)
 ....I ORLST(ORBE,OROI)=0,$$PDLINK^ORQPTQ1(ORBDEV,ORDFN) S ORBSDEV($P(ORBDEV,U))="",ORBUF=1
"RTN","ORB3SPEC",71,0)
 ....I $D(ORBU),ORBUF=1 D
"RTN","ORB3SPEC",72,0)
 .....S ORBU(ORBUI)="   "_$P(ORBDEV,U)_" is a device recipient.",ORBUI=ORBUI+1
"RTN","ORB3SPEC",73,0)
 ..;
"RTN","ORB3SPEC",74,0)
 ..; process TEAMS:
"RTN","ORB3SPEC",75,0)
 ..I ORBZ="OR(100.21," D SPECTEAM(ORBE)
"RTN","ORB3SPEC",76,0)
 D TITLE(OROI,ORPAR)
"RTN","ORB3SPEC",77,0)
 Q
"RTN","ORB3SPEC",78,0)
SPECTEAM(ORBE) ;get special team recips
"RTN","ORB3SPEC",79,0)
 N ORBLST,IJ,ORBTM
"RTN","ORB3SPEC",80,0)
 S ORBTM=$P(ORBE,";")
"RTN","ORB3SPEC",81,0)
 D TEAMPROV^ORQPTQ1(.ORBLST,ORBTM)
"RTN","ORB3SPEC",82,0)
 I $D(ORBU) N TNODE S TNODE=$G(^OR(100.21,ORBTM,0)) I $L(TNODE) D
"RTN","ORB3SPEC",83,0)
 .S ORBU(ORBUI)="   Team potential recipients from team "_$P(TNODE,U)_":",ORBUI=ORBUI+1
"RTN","ORB3SPEC",84,0)
 I +$G(ORBLST(1))>0 S IJ="" F  S IJ=$O(ORBLST(IJ)) Q:IJ=""  D
"RTN","ORB3SPEC",85,0)
 .S ORBDUZ=$P(ORBLST(IJ),U),ORBUF=0 I $L(ORBDUZ) D
"RTN","ORB3SPEC",86,0)
 ..I ORLST(ORBE,OROI)=1 S ORBASPEC(ORBDUZ_U_ORBTM)="",ORBUF=1
"RTN","ORB3SPEC",87,0)
 ..I ORLST(ORBE,OROI)=0,$D(^OR(100.21,ORBTM,10,"B",ORDFN_";DPT(")) S ORBASPEC(ORBDUZ_U_ORBTM)="",ORBUF=1
"RTN","ORB3SPEC",88,0)
 ..I $D(ORBU),ORBUF=1 N NODE S NODE=$G(^VA(200,ORBDUZ,0)) I $L(NODE) D
"RTN","ORB3SPEC",89,0)
 ...S ORBU(ORBUI)="     "_$P(NODE,U),ORBUI=ORBUI+1
"RTN","ORB3SPEC",90,0)
 ;
"RTN","ORB3SPEC",91,0)
 S ORBTD=$P($$TMDEV^ORB31(ORBTM),U,2)  ;tm's device
"RTN","ORB3SPEC",92,0)
 I $L(ORBTD) D
"RTN","ORB3SPEC",93,0)
 .S ORBSDEV(ORBTD)=""
"RTN","ORB3SPEC",94,0)
 .I $D(ORBU) D
"RTN","ORB3SPEC",95,0)
 ..S ORBU(ORBUI)="   Team's Device "_ORBTD_" is a recipient",ORBUI=ORBUI+1
"RTN","ORB3SPEC",96,0)
 Q
"RTN","ORB3SPEC",97,0)
LRALRTS(ORN,ORDFN,ORDATA,ORBSMSG,ORBMSG) ;find & delete matching alerts and gather recips
"RTN","ORB3SPEC",98,0)
 ; ORN: notif ien
"RTN","ORB3SPEC",99,0)
 ; ORDFN: pt id
"RTN","ORB3SPEC",100,0)
 ; ORDATA: pkg data
"RTN","ORB3SPEC",101,0)
 ; ORBSMSG: special notif msg rtn by LRALRTS
"RTN","ORB3SPEC",102,0)
 ; ORBMSG: original notif msg
"RTN","ORB3SPEC",103,0)
 ;
"RTN","ORB3SPEC",104,0)
 Q:+$G(ORN)<1
"RTN","ORB3SPEC",105,0)
 Q:+$G(ORDFN)<1
"RTN","ORB3SPEC",106,0)
 Q:+$G(ORDATA)<1
"RTN","ORB3SPEC",107,0)
 N LRID,ORY,I,J,XQAID,XQ0,XQ1,ORNE,RECIP,ORDATAE,LRIDE,STDATE
"RTN","ORB3SPEC",108,0)
 N ORTST,ORBMSGE,ORBMSGX,TXQAID,XQF,ORBHX,ORX,ORBI
"RTN","ORB3SPEC",109,0)
 ;
"RTN","ORB3SPEC",110,0)
 S LRID=$P($P(ORDATA,"|",2),"@")  ;get lab unique results id (OE IDE)
"RTN","ORB3SPEC",111,0)
 Q:+$G(LRID)<1
"RTN","ORB3SPEC",112,0)
 ;
"RTN","ORB3SPEC",113,0)
 ;get pt's alerts within 24 hours:
"RTN","ORB3SPEC",114,0)
 S STDATE=$$FMADD^XLFDT($$NOW^XLFDT,"","-24","","")
"RTN","ORB3SPEC",115,0)
 D PATIENT^XQALERT("ORY",ORDFN,STDATE,"") ;get pt's alerts
"RTN","ORB3SPEC",116,0)
 ;
"RTN","ORB3SPEC",117,0)
 ;look for pt's alerts with same notif ien and unique lab results id:
"RTN","ORB3SPEC",118,0)
 F I=1:1:ORY D
"RTN","ORB3SPEC",119,0)
 .S XQAID=$P(ORY(I),U,2)
"RTN","ORB3SPEC",120,0)
 .S ORBMSGX=$P(ORY(I),U)
"RTN","ORB3SPEC",121,0)
 .S ORNE=$P($P(XQAID,";"),",",3)  ;get notif ien
"RTN","ORB3SPEC",122,0)
 .Q:ORNE'=ORN
"RTN","ORB3SPEC",123,0)
 .;
"RTN","ORB3SPEC",124,0)
 .;find matching alert:
"RTN","ORB3SPEC",125,0)
 .D AHISTORY^XQALBUTL(XQAID,"ORBHX")
"RTN","ORB3SPEC",126,0)
 .S ORDATAE=$G(ORBHX(2))
"RTN","ORB3SPEC",127,0)
 .Q:'$L(ORDATAE)
"RTN","ORB3SPEC",128,0)
 .S LRIDE=$P($P(ORDATAE,"|",2),"@")  ;get lab rslts id from existng alert
"RTN","ORB3SPEC",129,0)
 .Q:LRIDE'=LRID
"RTN","ORB3SPEC",130,0)
 .;
"RTN","ORB3SPEC",131,0)
 .S:ORBMSG["[" ORTST=$P($P(ORBMSG,"[",2),"]")
"RTN","ORB3SPEC",132,0)
 .I ORBMSG'["[" D
"RTN","ORB3SPEC",133,0)
 ..S:ORBMSG["labs: " ORTST=$P(ORBMSG,"labs: ",2)
"RTN","ORB3SPEC",134,0)
 ..S:ORBMSG["results: " ORTST=$P(ORBMSG,"results: ",2)
"RTN","ORB3SPEC",135,0)
 .;
"RTN","ORB3SPEC",136,0)
 .S ORBMSGE=$P(ORBMSGX,"): ",2)
"RTN","ORB3SPEC",137,0)
 .;
"RTN","ORB3SPEC",138,0)
 .S ORX=0
"RTN","ORB3SPEC",139,0)
 .;if alert has recips, get recips from existing alert:
"RTN","ORB3SPEC",140,0)
 .S:$L($G(ORBHX(20,0))) ORX=$P(ORBHX(20,0),U,4)
"RTN","ORB3SPEC",141,0)
 .F ORBI=1:1:ORX D
"RTN","ORB3SPEC",142,0)
 ..S RECIP=+ORBHX(20,ORBI,0)
"RTN","ORB3SPEC",143,0)
 ..S ORBASPEC(RECIP)=""  ;add recip to new alert recip list
"RTN","ORB3SPEC",144,0)
 .;
"RTN","ORB3SPEC",145,0)
 .;delete existing alert:
"RTN","ORB3SPEC",146,0)
 .S XQAKILL=0  ;delete for all recips
"RTN","ORB3SPEC",147,0)
 .D DELETE^XQALERT
"RTN","ORB3SPEC",148,0)
 .K XQAKILL,XQAID
"RTN","ORB3SPEC",149,0)
 ;
"RTN","ORB3SPEC",150,0)
 ;if NO prev alert msg for this pt, notif, lab unique id:
"RTN","ORB3SPEC",151,0)
 I '$L($G(ORBMSGE)) S ORBSMSG=ORBMSG
"RTN","ORB3SPEC",152,0)
 ;
"RTN","ORB3SPEC",153,0)
 ;if prev alert msg for this pt, notif, lab unique id:
"RTN","ORB3SPEC",154,0)
 I $L($G(ORBMSGE)) D
"RTN","ORB3SPEC",155,0)
 .S:ORBMSGE["[" ORBSMSG=$P(ORBMSGE,"]")_", "_ORTST_"]"
"RTN","ORB3SPEC",156,0)
 .S:ORBMSGE'["[" ORBSMSG=ORBMSGE_", "_ORTST
"RTN","ORB3SPEC",157,0)
 ;
"RTN","ORB3SPEC",158,0)
 Q
"RTN","ORB3SPEC",159,0)
 ;
"RTN","ORB3SPEC",160,0)
TITLE(OROI,ORPAR) ;get provider recips
"RTN","ORB3SPEC",161,0)
 N ORTIT
"RTN","ORB3SPEC",162,0)
 I $D(ORBU) D
"RTN","ORB3SPEC",163,0)
 .S ORBU(ORBUI)=" ",ORBUI=ORBUI+1
"RTN","ORB3SPEC",164,0)
 .S ORBU(ORBUI)="Special potential recipients from parameter: "_ORPAR_" PR",ORBUI=ORBUI+1
"RTN","ORB3SPEC",165,0)
 ;
"RTN","ORB3SPEC",166,0)
 ;process special recip users, teams and devices for Provider Recipients
"RTN","ORB3SPEC",167,0)
 S ORTIT=$$GET^XPAR("ALL",ORPAR_" PR","`"_OROI,"E")
"RTN","ORB3SPEC",168,0)
 Q:'$L(ORTIT)
"RTN","ORB3SPEC",169,0)
 I ORTIT["P" D PRIMARY
"RTN","ORB3SPEC",170,0)
 I ORTIT["A" D ATTEND
"RTN","ORB3SPEC",171,0)
 I ORTIT["T" D TEAMS
"RTN","ORB3SPEC",172,0)
 I ORTIT["O" D ORDERER
"RTN","ORB3SPEC",173,0)
 I ORTIT["E" D ENTERBY
"RTN","ORB3SPEC",174,0)
 I ORTIT["R" D PCMMPRIM
"RTN","ORB3SPEC",175,0)
 I ORTIT["S" D PCMMASSC
"RTN","ORB3SPEC",176,0)
 I ORTIT["M" D PCMMTEAM
"RTN","ORB3SPEC",177,0)
 Q
"RTN","ORB3SPEC",178,0)
PRIMARY ;
"RTN","ORB3SPEC",179,0)
 I $D(ORBU),+$G(ORBPRIM)>0 S ORBU(ORBUI)=" Flagged OI Inpt primary provider:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",180,0)
 I $D(ORBU),+$G(ORBPRIM)<1 S ORBU(ORBUI)=" Flagged OI Inpt primary provider: option cannot determine without A/D/T event data.",ORBUI=ORBUI+1
"RTN","ORB3SPEC",181,0)
 I +$G(ORBPRIM)>0 S ORBASPEC(ORBPRIM)=""
"RTN","ORB3SPEC",182,0)
 Q
"RTN","ORB3SPEC",183,0)
ATTEND ;
"RTN","ORB3SPEC",184,0)
 I $D(ORBU),+$G(ORBATTD)>0 S ORBU(ORBUI)=" Flagged OI Attending physician:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",185,0)
 I $D(ORBU),+$G(ORBATTD)<1 S ORBU(ORBUI)=" Flagged OI Attending physician: option cannot determine without A/D/T event data.",ORBUI=ORBUI+1
"RTN","ORB3SPEC",186,0)
 I +$G(ORBATTD)>0 S ORBASPEC(ORBATTD)=""
"RTN","ORB3SPEC",187,0)
 Q
"RTN","ORB3SPEC",188,0)
TEAMS ;
"RTN","ORB3SPEC",189,0)
 N ORBLST,ORBI,ORBJ,ORBTM,ORBTNAME,ORBTTYPE,ORBTD
"RTN","ORB3SPEC",190,0)
 I $D(ORBU) S ORBU(ORBUI)=" Flagged OI Teams/Personal Lists related to patient:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",191,0)
 D TMSPT^ORQPTQ1(.ORBLST,ORDFN)
"RTN","ORB3SPEC",192,0)
 Q:+$G(ORBLST(1))<1
"RTN","ORB3SPEC",193,0)
 S ORBI="" F  S ORBI=$O(ORBLST(ORBI)) Q:ORBI=""  D
"RTN","ORB3SPEC",194,0)
 .S ORBTM=$P(ORBLST(ORBI),U),ORBTNAME=$P(ORBLST(ORBI),U,2)
"RTN","ORB3SPEC",195,0)
 .S ORBTTYPE=$P(ORBLST(ORBI),U,3)
"RTN","ORB3SPEC",196,0)
 .I $D(ORBU) D
"RTN","ORB3SPEC",197,0)
 ..S ORBU(ORBUI)="  Patient list "_ORBTNAME_" ["_ORBTTYPE_"]:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",198,0)
 .N ORBLST2 D TEAMPROV^ORQPTQ1(.ORBLST2,ORBTM)
"RTN","ORB3SPEC",199,0)
 .Q:+$G(ORBLST2(1))<1
"RTN","ORB3SPEC",200,0)
 .S ORBJ="" F  S ORBJ=$O(ORBLST2(ORBJ)) Q:ORBJ=""  D
"RTN","ORB3SPEC",201,0)
 ..S ORBDUZ=$P(ORBLST2(ORBJ),U)_U_ORBTM I +$G(ORBDUZ)>0 S ORBASPEC(ORBDUZ)=""
"RTN","ORB3SPEC",202,0)
 .S ORBTD=$P($$TMDEV^ORB31(ORBTM),U,2)  ;tm's device
"RTN","ORB3SPEC",203,0)
 .I $L(ORBTD) D
"RTN","ORB3SPEC",204,0)
 ..S ORBSDEV(ORBTD)=""
"RTN","ORB3SPEC",205,0)
 ..I $D(ORBU) D
"RTN","ORB3SPEC",206,0)
 ...S ORBU(ORBUI)="   Team's Device "_ORBTD_" is a recipient",ORBUI=ORBUI+1
"RTN","ORB3SPEC",207,0)
 Q
"RTN","ORB3SPEC",208,0)
ORDERER ;
"RTN","ORB3SPEC",209,0)
 N ORBDUZ
"RTN","ORB3SPEC",210,0)
 I $D(ORBU) S ORBU(ORBUI)=" Flagged OI Ordering provider:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",211,0)
 Q:+$G(ORNUM)<1
"RTN","ORB3SPEC",212,0)
 S ORBDUZ=$$ORDERER^ORQOR2(ORNUM)
"RTN","ORB3SPEC",213,0)
 I +$G(ORBDUZ)>0 D
"RTN","ORB3SPEC",214,0)
 .S ORBASPEC(ORBDUZ)=""
"RTN","ORB3SPEC",215,0)
 Q
"RTN","ORB3SPEC",216,0)
ENTERBY ;
"RTN","ORB3SPEC",217,0)
 N ORBDUZ
"RTN","ORB3SPEC",218,0)
 I $D(ORBU) S ORBU(ORBUI)=" Flagged OI User entering order's most recent activity:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",219,0)
 Q:+$G(ORNUM)<1
"RTN","ORB3SPEC",220,0)
 I $D(^OR(100,ORNUM,8,0)) D
"RTN","ORB3SPEC",221,0)
 .S ORBDUZ=$P(^OR(100,ORNUM,8,$P(^OR(100,ORNUM,8,0),U,3),0),U,13)
"RTN","ORB3SPEC",222,0)
 I +$G(ORBDUZ)>0 S ORBASPEC(ORBDUZ)=""
"RTN","ORB3SPEC",223,0)
 Q
"RTN","ORB3SPEC",224,0)
PCMMPRIM ;
"RTN","ORB3SPEC",225,0)
 N ORBDUZ
"RTN","ORB3SPEC",226,0)
 I $D(ORBU) S ORBU(ORBUI)=" Flagged OI PCMM Primary Care Practitioner:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",227,0)
 S ORBDUZ=+$$OUTPTPR^SDUTL3(ORDFN,$$NOW^XLFDT,1)  ;DBIA #1252
"RTN","ORB3SPEC",228,0)
 I +$G(ORBDUZ)>0 S ORBASPEC(ORBDUZ)=""
"RTN","ORB3SPEC",229,0)
 Q
"RTN","ORB3SPEC",230,0)
PCMMASSC ;
"RTN","ORB3SPEC",231,0)
 N ORBDUZ
"RTN","ORB3SPEC",232,0)
 I $D(ORBU) S ORBU(ORBUI)=" Flagged OI PCMM Associate Provider:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",233,0)
 S ORBDUZ=+$$OUTPTAP^SDUTL3(ORDFN,$$NOW^XLFDT)  ;DBIA #1252
"RTN","ORB3SPEC",234,0)
 I +$G(ORBDUZ)>0 S ORBASPEC(ORBDUZ)=""
"RTN","ORB3SPEC",235,0)
 Q
"RTN","ORB3SPEC",236,0)
PCMMTEAM ;
"RTN","ORB3SPEC",237,0)
 N ORPCMM,ORPCMMDZ,ORBDUZ
"RTN","ORB3SPEC",238,0)
 I $D(ORBU) S ORBU(ORBUI)=" Flagged OI PCMM Team Position Assignments:",ORBUI=ORBUI+1
"RTN","ORB3SPEC",239,0)
 S ORPCMM=$$PRPT^SCAPMC(ORDFN,,,,,,"^TMP(""ORPCMM"",$J)",)  ;DBIA #1916
"RTN","ORB3SPEC",240,0)
 S ORPCMMDZ=0
"RTN","ORB3SPEC",241,0)
 F  S ORPCMMDZ=$O(^TMP("ORPCMM",$J,"SCPR",ORPCMMDZ)) Q:'ORPCMMDZ  D
"RTN","ORB3SPEC",242,0)
 .S ORBDUZ=ORPCMMDZ S ORBASPEC(ORBDUZ)=""
"RTN","ORB3SPEC",243,0)
 K ^TMP("ORPCMM",$J)
"RTN","ORB3SPEC",244,0)
 Q
"RTN","ORB3U1")
0^19^B62203040
"RTN","ORB3U1",1,0)
ORB3U1 ; slc/CLA - Utilities which support OE/RR 3 Notifications ;12/15/97
"RTN","ORB3U1",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**9,74,88,91,105,179,220**;Dec 17, 1997
"RTN","ORB3U1",3,0)
 Q
"RTN","ORB3U1",4,0)
LIST(Y) ;return list of notifications from Notification File [#100.9]
"RTN","ORB3U1",5,0)
 ; RETURN IEN^NAME^URGENCY
"RTN","ORB3U1",6,0)
 N I,J,V
"RTN","ORB3U1",7,0)
 S I=1
"RTN","ORB3U1",8,0)
 S J=0 F  S J=$O(^ORD(100.9,"B",J)) Q:J=""  S V=0,V=$O(^ORD(100.9,"B",J,V)) S Y(I)=V_"^"_J_"^"_^ORD(100.9,V,3),I=I+1
"RTN","ORB3U1",9,0)
 Q
"RTN","ORB3U1",10,0)
 ;
"RTN","ORB3U1",11,0)
ALRTHX ;report the recipients for an alert, when received, action taken
"RTN","ORB3U1",12,0)
 N ORBDFN,ORBSDT,ORBEDT
"RTN","ORB3U1",13,0)
 ;prompt for patient (required):
"RTN","ORB3U1",14,0)
 K DIC S DIC="^DPT(",DIC("A")="PATIENT (req'd): ",DIC(0)="AEQNM" D ^DIC
"RTN","ORB3U1",15,0)
 I Y<1 K DIC,Y Q
"RTN","ORB3U1",16,0)
 S ORBDFN=+Y,ORBPT=$P(Y,U,2)
"RTN","ORB3U1",17,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",18,0)
 ;
"RTN","ORB3U1",19,0)
 S %DT="AET",%DT("A")="Start Date/Time (req'd): ",%DT("B")="T-30" D ^%DT
"RTN","ORB3U1",20,0)
 I Y<1 K %DT,Y Q
"RTN","ORB3U1",21,0)
 S ORBSDT=Y
"RTN","ORB3U1",22,0)
 ;
"RTN","ORB3U1",23,0)
 S %DT="AET",%DT("A")="End Date/Time (req'd): ",%DT("B")="NOW" D ^%DT
"RTN","ORB3U1",24,0)
 I Y<1 K %DT,Y Q
"RTN","ORB3U1",25,0)
 S ORBEDT=Y
"RTN","ORB3U1",26,0)
 ;
"RTN","ORB3U1",27,0)
 ;get alerts for this patient from the alert tracking file:
"RTN","ORB3U1",28,0)
 D PATIENT^XQALERT("^TMP(""ORB"",$J)",ORBDFN,ORBSDT,ORBEDT)
"RTN","ORB3U1",29,0)
 W !!,"Processing..."
"RTN","ORB3U1",30,0)
 ;
"RTN","ORB3U1",31,0)
 D EN^VALM("OR PATIENT ALERTS")
"RTN","ORB3U1",32,0)
 Q
"RTN","ORB3U1",33,0)
SELECT ;if one or more alerts selected, display/print recipient data:
"RTN","ORB3U1",34,0)
 N ORN,ORNUMS,ORI,ORJ,ORBAL,ORBAID,ORBSMSG,ORY,DESC,HDR
"RTN","ORB3U1",35,0)
 S ORNUMS=$P(XQORNOD(0),"=",2)
"RTN","ORB3U1",36,0)
 Q:'$L(ORNUMS)
"RTN","ORB3U1",37,0)
 D FULL^VALM1
"RTN","ORB3U1",38,0)
 ;
"RTN","ORB3U1",39,0)
 S ORJ=1
"RTN","ORB3U1",40,0)
 F ORI=1:1:$L(ORNUMS,",")-1 D
"RTN","ORB3U1",41,0)
 .S ORN=$P(ORNUMS,",",ORI)
"RTN","ORB3U1",42,0)
 .S ORBAL=$G(^TMP("OR",$J,"ALERTS","IDX",ORN)) I $L(ORBAL) D
"RTN","ORB3U1",43,0)
 ..S ORBAID=$P(ORBAL,U)
"RTN","ORB3U1",44,0)
 ..S ORBSMSG=$P(ORBAL,U,2)
"RTN","ORB3U1",45,0)
 ..S ORY(ORJ)="RECIPIENTS OF ALERT: "_ORBSMSG,ORJ=ORJ+1
"RTN","ORB3U1",46,0)
 ..D GETRECS(ORBAID)  ;get recipient data
"RTN","ORB3U1",47,0)
 ..S ORJ=ORJ+1,ORY(ORJ)="",ORJ=ORJ+1,ORY(ORJ)="",ORJ=ORJ+1
"RTN","ORB3U1",48,0)
 S DESC="Recipients of a Kernel Alert"
"RTN","ORB3U1",49,0)
 S HDR="RECIPIENTS OF ALERTS FOR PATIENT: "_ORBPT
"RTN","ORB3U1",50,0)
 D OUTPUT(.ORY,DESC,HDR)
"RTN","ORB3U1",51,0)
 S VALMBCK="R"
"RTN","ORB3U1",52,0)
 Q
"RTN","ORB3U1",53,0)
LMHDR ; header for ListMgr display
"RTN","ORB3U1",54,0)
 S VALMHDR(1)="Alerts for "_ORBPT
"RTN","ORB3U1",55,0)
 Q
"RTN","ORB3U1",56,0)
LMHELP ; help for List Mgr display
"RTN","ORB3U1",57,0)
 N X
"RTN","ORB3U1",58,0)
 D FULL^VALM1 S VALMBCK="R"
"RTN","ORB3U1",59,0)
 W !!,"Enter the display number of the alert whose recipients you wish to review in detail."
"RTN","ORB3U1",60,0)
 W !!,"Press <return> to continue ..."
"RTN","ORB3U1",61,0)
 R X:DTIME
"RTN","ORB3U1",62,0)
 Q
"RTN","ORB3U1",63,0)
LMEXIT ; exit code for List Mgr display
"RTN","ORB3U1",64,0)
 D CLEAR^VALM1
"RTN","ORB3U1",65,0)
 K ORBPT,^TMP("OR",$J,"ALERTS"),XQORM("ALT"),^TMP("ORB",$J)
"RTN","ORB3U1",66,0)
 Q
"RTN","ORB3U1",67,0)
LMALT ; alternative selection code
"RTN","ORB3U1",68,0)
 D FULL^VALM1
"RTN","ORB3U1",69,0)
 S VALMBCK="R"
"RTN","ORB3U1",70,0)
 Q
"RTN","ORB3U1",71,0)
LMENTRY ; entry code for List Mgr display
"RTN","ORB3U1",72,0)
 N ORBA,ORBAID,ORBDT,ORBMSG,ORBX,ORNUM,ORDATA,ORAD,LCNT,NUM
"RTN","ORB3U1",73,0)
 N ORX,ORY
"RTN","ORB3U1",74,0)
 ;
"RTN","ORB3U1",75,0)
 D CLEAN^VALM10
"RTN","ORB3U1",76,0)
 ;
"RTN","ORB3U1",77,0)
 S ORBA="" F  S ORBA=$O(^TMP("ORB",$J,ORBA)) Q:ORBA=""  D
"RTN","ORB3U1",78,0)
 .S ORBX=$G(^TMP("ORB",$J,ORBA)) I $L(ORBX) D
"RTN","ORB3U1",79,0)
 ..S ORBAID=$P(ORBX,U,2)
"RTN","ORB3U1",80,0)
 ..Q:$P(ORBAID,",")'="OR"  ;quit if not "OR" (OE/RR Notifications) alert
"RTN","ORB3U1",81,0)
 ..W "."
"RTN","ORB3U1",82,0)
 ..;
"RTN","ORB3U1",83,0)
 ..;get alert details:
"RTN","ORB3U1",84,0)
 ..D ALERTDAT^XQALBUTL(ORBAID,"ORAD")
"RTN","ORB3U1",85,0)
 ..S ORBMSG=ORAD(1.01) I $L(ORBMSG) D
"RTN","ORB3U1",86,0)
 ...S ORBDT=$P(ORAD(.02),U)
"RTN","ORB3U1",87,0)
 ...S ORDATA=$G(ORAD(2))
"RTN","ORB3U1",88,0)
 ...S ORNUM=""
"RTN","ORB3U1",89,0)
 ...I ORDATA["@" S ORNUM=$P(ORDATA,"@")
"RTN","ORB3U1",90,0)
 ...S ORNUM=$S(+$G(ORNUM)>0:"["_+ORNUM_"]",1:"")
"RTN","ORB3U1",91,0)
 ...S ORBMSG=$P(ORBMSG,"): ",2)
"RTN","ORB3U1",92,0)
 ...S ORBMSG=$E(ORBMSG_$S($L(ORNUM):" "_$G(ORNUM),1:"")_U_"                                                            ",1,60)
"RTN","ORB3U1",93,0)
 ...S ^TMP("OR",$J,"ALERTS","B",9999999-ORBDT_ORBAID)=ORBAID_U_$P(ORBMSG,U)_U_$$FMTE^XLFDT($E(ORBDT,1,12),"2")
"RTN","ORB3U1",94,0)
 ;
"RTN","ORB3U1",95,0)
 S (LCNT,NUM)=0
"RTN","ORB3U1",96,0)
 S ORX="" F  S ORX=$O(^TMP("OR",$J,"ALERTS","B",ORX)) Q:ORX=""  D
"RTN","ORB3U1",97,0)
 .S ORY=^TMP("OR",$J,"ALERTS","B",ORX)
"RTN","ORB3U1",98,0)
 .S ORBMSG=$P(ORY,U,2)
"RTN","ORB3U1",99,0)
 .S ORBDT=$P(ORY,U,3)
"RTN","ORB3U1",100,0)
 .S LCNT=LCNT+1,NUM=NUM+1
"RTN","ORB3U1",101,0)
 .S ^TMP("OR",$J,"ALERTS","IDX",NUM)=ORY   ;alert id^text^date/time
"RTN","ORB3U1",102,0)
 .S ^TMP("OR",$J,"ALERTS",LCNT,0)=$$LJ^XLFSTR(NUM,4)_$$LJ^XLFSTR(ORBMSG,61)_$$LJ^XLFSTR(ORBDT,15)
"RTN","ORB3U1",103,0)
 .D CNTRL^VALM10(LCNT,1,5,IOINHI,IOINORM)
"RTN","ORB3U1",104,0)
 ;
"RTN","ORB3U1",105,0)
 S ^TMP("OR",$J,"ALERTS",0)=LCNT_U_NUM_U_"Patient Alerts"
"RTN","ORB3U1",106,0)
 S ^TMP("OR",$J,"ALERTS","#")=$O(^ORD(101,"B","OR SELECT ALERTS",0))_"^1:"_NUM
"RTN","ORB3U1",107,0)
 K VALMHDR
"RTN","ORB3U1",108,0)
 S VALMCNT=LCNT,VALMBG=1,VALMBCK="R"
"RTN","ORB3U1",109,0)
 Q
"RTN","ORB3U1",110,0)
GETRECS(ORBAID)  ;get recipient data for an alert
"RTN","ORB3U1",111,0)
 N ORX,ORBI,ORBR,ORBHX
"RTN","ORB3U1",112,0)
 D AHISTORY^XQALBUTL(ORBAID,"ORBHX")
"RTN","ORB3U1",113,0)
 S:$L($G(ORBHX(20,0))) ORX=$P(ORBHX(20,0),U,4)
"RTN","ORB3U1",114,0)
 F ORBI=1:1:ORX D
"RTN","ORB3U1",115,0)
 .S ORBR=ORBHX(20,ORBI,0)
"RTN","ORB3U1",116,0)
 .S ORY(ORJ)="",ORJ=ORJ+1
"RTN","ORB3U1",117,0)
 .S ORY(ORJ)=$P(^VA(200,$P(ORBR,U),0),U),ORJ=ORJ+1
"RTN","ORB3U1",118,0)
 .S ORY(ORJ)="  1st displayed to recipient: "_$$FMTE^XLFDT($P(ORBR,U,2),"1"),ORJ=ORJ+1
"RTN","ORB3U1",119,0)
 .S ORY(ORJ)="  1st selected by recipient:  "_$$FMTE^XLFDT($P(ORBR,U,3),"1"),ORJ=ORJ+1
"RTN","ORB3U1",120,0)
 .S ORY(ORJ)="  Processed by recipient:     "_$$FMTE^XLFDT($P(ORBR,U,4),"1"),ORJ=ORJ+1
"RTN","ORB3U1",121,0)
 .S ORY(ORJ)="  Deleted:                    "_$$FMTE^XLFDT($P(ORBR,U,5),"1"),ORJ=ORJ+1
"RTN","ORB3U1",122,0)
 .S ORY(ORJ)="  Auto deleted:               "_$$FMTE^XLFDT($P(ORBR,U,6),"1"),ORJ=ORJ+1
"RTN","ORB3U1",123,0)
 .S ORY(ORJ)="  Forwarded by:               "_$S($P(ORBR,U,7):$P(^VA(200,$P(ORBR,U,7),0),U),1:""),ORJ=ORJ+1
"RTN","ORB3U1",124,0)
 .S ORY(ORJ)="  Forwarded to recipient:     "_$$FMTE^XLFDT($P(ORBR,U,8),"1"),ORJ=ORJ+1
"RTN","ORB3U1",125,0)
 .S ORY(ORJ)="  Non-process deletion by:    "_$S($P(ORBR,U,9):$P(^VA(200,$P(ORBR,U,9),0),U),1:""),ORJ=ORJ+1
"RTN","ORB3U1",126,0)
 Q
"RTN","ORB3U1",127,0)
RECIPS ;determine/report the list of recipients for a notification
"RTN","ORB3U1",128,0)
 N ORY,ORN,ORBDFN,ORNUM,ORBADUZ,DESC,HDR,ORBPR,ORDIV
"RTN","ORB3U1",129,0)
 ;prompt for patient (required):
"RTN","ORB3U1",130,0)
 K DIC S DIC="^DPT(",DIC("A")="PATIENT (req'd): ",DIC(0)="AEQNM" D ^DIC Q:Y<1
"RTN","ORB3U1",131,0)
 S ORBDFN=+Y
"RTN","ORB3U1",132,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",133,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",134,0)
 ;
"RTN","ORB3U1",135,0)
 ;prompt for notification (required):
"RTN","ORB3U1",136,0)
 S DIC="^ORD(100.9,",DIC("A")="NOTIFICATION (req'd): ",DIC(0)="AEQN" D ^DIC Q:Y<1
"RTN","ORB3U1",137,0)
 S ORN=+Y
"RTN","ORB3U1",138,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",139,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",140,0)
 ;
"RTN","ORB3U1",141,0)
 S ORBPR=$$GET^XPAR("DIV^SYS^PKG","ORB PROVIDER RECIPIENTS",ORN,"I")
"RTN","ORB3U1",142,0)
 ;
"RTN","ORB3U1",143,0)
 ;prompt for order num if notif processes order num or is a flagged oi:
"RTN","ORB3U1",144,0)
 I (ORN=32)!(ORN=41)!(ORN=60)!(ORN=61)!(ORN=64)!(ORN=65)!(ORBPR["O")!(ORBPR["E") D
"RTN","ORB3U1",145,0)
 .K DIR S DIR(0)="NAO^::2",DIR("A")="ORDER NUMBER: "
"RTN","ORB3U1",146,0)
 .S DIR("?",1)="This notification uses order number to help determine alert recipients."
"RTN","ORB3U1",147,0)
 .S DIR("?",2)="Enter the order number associated with the alert for most accurate results."
"RTN","ORB3U1",148,0)
 .S DIR("?",3)="Order number must be entered as a whole number (e.g. 458829)."
"RTN","ORB3U1",149,0)
 .;
"RTN","ORB3U1",150,0)
 .S DIR("?")=" "
"RTN","ORB3U1",151,0)
 .D ^DIR
"RTN","ORB3U1",152,0)
 .S ORNUM=+Y
"RTN","ORB3U1",153,0)
 .I +$G(ORNUM)>0 D
"RTN","ORB3U1",154,0)
 ..S ORDIV=$$ORDIV^ORB31(ORNUM)
"RTN","ORB3U1",155,0)
 ..S:+$G(ORDIV)>0 ORBPR=$$GET^XPAR(ORDIV_";DIV(4,^SYS^PKG","ORB PROVIDER RECIPIENTS",ORN,"I")
"RTN","ORB3U1",156,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",157,0)
 K DIR,Y,X,DTOUT,DUOUT,DIRUT
"RTN","ORB3U1",158,0)
 ;
"RTN","ORB3U1",159,0)
 ; get recipients for Lab Threshold notif:
"RTN","ORB3U1",160,0)
 I ORN=68 D LABTHR^ORB3U2(.ORBADUZ,ORBDFN,$G(ORNUM))
"RTN","ORB3U1",161,0)
 ;
"RTN","ORB3U1",162,0)
 ;prompt for pkg-defined recips if normally occurs with notif:
"RTN","ORB3U1",163,0)
 I (ORN=21)!(ORN=22)!(ORN=23)!(ORN=27)!(ORN=30)!(ORN=51)!(ORN=52)!(ORN=53)!(ORN=63) D
"RTN","ORB3U1",164,0)
 .F  K DIC,Y S DIC="^VA(200,",DIC(0)="AEQN",DIC("A")="RECIPIENT(S) FROM PACKAGE WHEN NOTIF WAS TRIGGERED: " D ^DIC Q:Y<1  S ORBADUZ(+Y)=""
"RTN","ORB3U1",165,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",166,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",167,0)
 ;
"RTN","ORB3U1",168,0)
 ;prompt for recips entered at special GUI recipients prompts:
"RTN","ORB3U1",169,0)
 I (ORN=6)!(ORN=33) D
"RTN","ORB3U1",170,0)
 .F  K DIC,Y S DIC="^VA(200,",DIC(0)="AEQN",DIC("A")="RECIPIENT(S) ENTERED AT GUI PROMPTS: " D ^DIC Q:Y<1  S ORBADUZ(+Y)=""
"RTN","ORB3U1",171,0)
 Q:$D(DUOUT)
"RTN","ORB3U1",172,0)
 K DIC,Y,DUOUT,DTOUT
"RTN","ORB3U1",173,0)
 ;
"RTN","ORB3U1",174,0)
 W !,"Processing, please stand by..."
"RTN","ORB3U1",175,0)
 ;determine recipients and why:
"RTN","ORB3U1",176,0)
 S ORY="1"
"RTN","ORB3U1",177,0)
 D UTL^ORB3(.ORY,ORN,ORBDFN,$G(ORNUM),.ORBADUZ,"","")
"RTN","ORB3U1",178,0)
 S DESC="Determine Notification Recipients Report"
"RTN","ORB3U1",179,0)
 S HDR="DETERMINE NOTIFICATION RECIPIENTS REPORT"
"RTN","ORB3U1",180,0)
 D OUTPUT(.ORY,DESC,HDR)
"RTN","ORB3U1",181,0)
 Q
"RTN","ORB3U1",182,0)
OUTPUT(ORY,ORBDESC,ORBHDR) ;prompt for device and send report
"RTN","ORB3U1",183,0)
 N POP
"RTN","ORB3U1",184,0)
 ;prompt for device:
"RTN","ORB3U1",185,0)
 S %ZIS="Q"  ;prompt for Queueing
"RTN","ORB3U1",186,0)
 D ^%ZIS
"RTN","ORB3U1",187,0)
 Q:$G(POP)>0
"RTN","ORB3U1",188,0)
 I $D(IO("Q")) D  ;queue the report
"RTN","ORB3U1",189,0)
 .S ZTRTN="PRINT^ORB3U1"
"RTN","ORB3U1",190,0)
 .S ZTSAVE("ORY(")="",ZTSAVE("ORBHDR")=""
"RTN","ORB3U1",191,0)
 .S ZTDESC=ORBDESC
"RTN","ORB3U1",192,0)
 .D ^%ZTLOAD
"RTN","ORB3U1",193,0)
 .K ZTDESC,ZTRTN,ZTSAVE
"RTN","ORB3U1",194,0)
 .I $D(ZTSK)[0 W !!?5,"Report canceled!"
"RTN","ORB3U1",195,0)
 .E  W !!?5,"Report queued."
"RTN","ORB3U1",196,0)
 .D HOME^%ZIS
"RTN","ORB3U1",197,0)
 K %ZIS
"RTN","ORB3U1",198,0)
 I $D(IO("Q")) K IO("Q") Q
"RTN","ORB3U1",199,0)
PRINT ;print body of Determine Notification Recipients Report
"RTN","ORB3U1",200,0)
 N END,PAGE,X
"RTN","ORB3U1",201,0)
 S (END,PAGE,I)=0
"RTN","ORB3U1",202,0)
 U IO
"RTN","ORB3U1",203,0)
 D @("HDR"_(2-($E(IOST,1,2)="C-")))
"RTN","ORB3U1",204,0)
 F  S I=$O(ORY(I)) Q:I=""!(END=1)  D
"RTN","ORB3U1",205,0)
 .D HDR:$Y+5>IOSL
"RTN","ORB3U1",206,0)
 .Q:END=1
"RTN","ORB3U1",207,0)
 .W !,ORY(I)
"RTN","ORB3U1",208,0)
 I END=1 W !!,"           - Report Interrupted -",!
"RTN","ORB3U1",209,0)
 E  W !!!,"           - End of Report -",!
"RTN","ORB3U1",210,0)
 I ($E(IOST,1,2)="C-") W !,"Press RETURN to continue: " R X:DTIME
"RTN","ORB3U1",211,0)
 D ^%ZISC
"RTN","ORB3U1",212,0)
 D:$G(ZTSK) KILL^%ZTLOAD
"RTN","ORB3U1",213,0)
 Q
"RTN","ORB3U1",214,0)
HDR ;print header of report
"RTN","ORB3U1",215,0)
 I PAGE,($E(IOST,1,2)="C-") D
"RTN","ORB3U1",216,0)
 .W !,"Press RETURN to continue or '^' to exit: "
"RTN","ORB3U1",217,0)
 .R X:DTIME S END='$T!(X="^")
"RTN","ORB3U1",218,0)
 Q:END=1
"RTN","ORB3U1",219,0)
HDR1 W:'($E(IOST,1,2)='"C-"&'PAGE) @IOF
"RTN","ORB3U1",220,0)
HDR2 S PAGE=PAGE+1 W ?20,ORBHDR
"RTN","ORB3U1",221,0)
 W ?(IOM-10),"Page: ",$J(PAGE,3),!!
"RTN","ORB3U1",222,0)
 Q
"RTN","ORB3USER")
0^23^B69213741
"RTN","ORB3USER",1,0)
ORB3USER ; slc/CLA - Alert recipient algorithms for OE/RR 3 notifications; 1/19/00 14:45 [8/16/05 9:53am]
"RTN","ORB3USER",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**74,91,105,139,200,220**;Dec 17, 1997
"RTN","ORB3USER",3,0)
USER(XQA,ORBDUZ,ORN,ORBU,ORBUI,ORBDFN,ORNUM) ;called from ORB3
"RTN","ORB3USER",4,0)
 ;check to see if potential recip (ORBDUZ) should be an alert recip
"RTN","ORB3USER",5,0)
 ;XQA     array of alert recips passed to Kernel Alert Utility
"RTN","ORB3USER",6,0)
 ;ORBDUZ  duz of current potential alert recipient
"RTN","ORB3USER",7,0)
 ;ORN     notif ien from file 100.9
"RTN","ORB3USER",8,0)
 ;ORBU    array of info for utility displaying recip who and why
"RTN","ORB3USER",9,0)
 ;ORBUI   counter for utility array
"RTN","ORB3USER",10,0)
 ;ORBDFN  patient ien from Patient file [#2]
"RTN","ORB3USER",11,0)
 ;ORNUM   order number to base division params on[optional]
"RTN","ORB3USER",12,0)
 ;
"RTN","ORB3USER",13,0)
 N ORBNODE,ORBSUR,ORBTM,ORBTMF,ORBTEAM,ORBON,ORBDUP
"RTN","ORB3USER",14,0)
 I $G(ORBDUZ)["G." S XQA(ORBDUZ)="" Q
"RTN","ORB3USER",15,0)
 Q:+$G(ORBDUZ)<.5
"RTN","ORB3USER",16,0)
 ;
"RTN","ORB3USER",17,0)
 S ORBTM=$P(ORBDUZ,U,2) I $L(ORBTM) D  ;if user recip via team
"RTN","ORB3USER",18,0)
 .S ORBTMF=$$GET^XPAR(ORBTM_";OR(100.21,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",19,0)
 .S ORBTEAM=ORBTMF_U_$P(^OR(100.21,ORBTM,0),U)
"RTN","ORB3USER",20,0)
 .I $D(ORBU) D
"RTN","ORB3USER",21,0)
 ..S ORBU(ORBUI)="   User "_$P(^VA(200,+ORBDUZ,0),U)_" is a potential recipient via team "_$P(ORBTEAM,U,2),ORBUI=ORBUI+1
"RTN","ORB3USER",22,0)
 ;
"RTN","ORB3USER",23,0)
 I '$D(ORBU) D
"RTN","ORB3USER",24,0)
 .I $L($G(ORBTMF))=0 D
"RTN","ORB3USER",25,0)
 ..S:$D(^XTMP("ORBUSER",$J,+ORBDUZ)) ORBDUP=1
"RTN","ORB3USER",26,0)
 ..S ^XTMP("ORBUSER",$J,+ORBDUZ)=""
"RTN","ORB3USER",27,0)
 Q:$G(ORBDUP)=1  ;quit if user already processed and no team param value
"RTN","ORB3USER",28,0)
 ;
"RTN","ORB3USER",29,0)
 S ORBDUZ=$P(ORBDUZ,U)
"RTN","ORB3USER",30,0)
 ;
"RTN","ORB3USER",31,0)
 S:$G(ORBTEAM)="" ORBTEAM="^"
"RTN","ORB3USER",32,0)
 S ORBON=$$ONOFF(ORN,ORBDUZ,ORBDFN,ORBTEAM,$G(ORNUM))
"RTN","ORB3USER",33,0)
 I $D(ORBU) D
"RTN","ORB3USER",34,0)
 .S ORBNODE=$G(^VA(200,ORBDUZ,0)) I $L($G(ORBNODE)) D
"RTN","ORB3USER",35,0)
 ..S ORBU(ORBUI)="   "_$P(ORBNODE,U)_": "_$P(ORBON,U)_" because ",ORBUI=ORBUI+1
"RTN","ORB3USER",36,0)
 ..S ORBU(ORBUI)="     "_$P(ORBON,U,2),ORBUI=ORBUI+1
"RTN","ORB3USER",37,0)
 I $D(ORBU),($P(ORBON,U)="ON"),($G(ORBDUZ)'["G.") D
"RTN","ORB3USER",38,0)
 .S ORBSUR=$$ACTVSURO^XQALSURO(ORBDUZ)  ;DBIA 2790 Alert surrogate
"RTN","ORB3USER",39,0)
 .I +$G(ORBSUR)>0 D
"RTN","ORB3USER",40,0)
 ..S ORBU(ORBUI)="     [Surrogate "_$$GET1^DIQ(200,ORBSUR_",",.01)_" will receive alert for user]",ORBUI=ORBUI+1
"RTN","ORB3USER",41,0)
 Q:$P(ORBON,U)="OFF"  ;quit if user is disabled for this notif
"RTN","ORB3USER",42,0)
 Q:$D(ORBU)           ;quit if entered rtn via UTL (do not sent alert)
"RTN","ORB3USER",43,0)
 D PREALERT(ORBDUZ,ORN,ORBDFN)  ;if user has undel prev alert, delete it
"RTN","ORB3USER",44,0)
 S XQA(ORBDUZ)=""  ;send alert to the user
"RTN","ORB3USER",45,0)
 Q
"RTN","ORB3USER",46,0)
 ;
"RTN","ORB3USER",47,0)
PREALERT(ORBDUZ,ORN,ORBDFN) ;if user (ORBDUZ) has an undeleted previous
"RTN","ORB3USER",48,0)
 ;version of this alert (ORN) for patient (ORBDFN), delete it
"RTN","ORB3USER",49,0)
 ;
"RTN","ORB3USER",50,0)
 Q:$P(^ORD(100.9,ORN,0),U,4)'="NOT"  ;quit if not a "NOT" notif/alert
"RTN","ORB3USER",51,0)
 N XQAID,XQAKILL,XQAUSER,ORBDT
"RTN","ORB3USER",52,0)
 S XQAID="OR,"_ORBDFN_","_ORN
"RTN","ORB3USER",53,0)
 I $D(^XTV(8992,"AXQAN",XQAID,ORBDUZ)) D  ;DBIA# 2689
"RTN","ORB3USER",54,0)
 .S ORBDT=0,ORBDT=$O(^XTV(8992,"AXQAN",XQAID,ORBDUZ,ORBDT))
"RTN","ORB3USER",55,0)
 .I $G(ORBDT)>0 D
"RTN","ORB3USER",56,0)
 ..S XQAUSER=ORBDUZ
"RTN","ORB3USER",57,0)
 ..S XQAKILL=1
"RTN","ORB3USER",58,0)
 ..D DELETEA^XQALERT
"RTN","ORB3USER",59,0)
 Q
"RTN","ORB3USER",60,0)
 ;
"RTN","ORB3USER",61,0)
ONOFF(ORN,ORBUSR,ORBPT,ORBTEAM,ORNUM) ;Extrinsic function to check param file
"RTN","ORB3USER",62,0)
 ;determines if user ORBUSR should receive notification ORN for patient
"RTN","ORB3USER",63,0)
 ;patient ORBPT. If ORBUSR was derived via teams, ORBTEAM may be used.
"RTN","ORB3USER",64,0)
 ;ORN      notification ien from file 100.9 (req'd)
"RTN","ORB3USER",65,0)
 ;ORBUSR   user ien from file 200 (req'd)
"RTN","ORB3USER",66,0)
 ;ORBPT    patient ien from file 2 (not req'd)
"RTN","ORB3USER",67,0)
 ;ORBTEAM  processing flag^name for team assoc. w/ORBUSR (not req'd)
"RTN","ORB3USER",68,0)
 ;ORNUM    order number to base division params on (not req'd)
"RTN","ORB3USER",69,0)
 N NODE,ORBPTN,ORBNOTN,ORBUSRF,ORBUSRN,ORBLOC,ORBLOCF,ORBLOCN
"RTN","ORB3USER",70,0)
 S (ORBPTN,ORBNOTN,ORBUSRF,ORBUSRN,ORBLOC,ORBLOCF,ORBLOCN)=""
"RTN","ORB3USER",71,0)
 N ORBSRV,ORBSRVF,ORBSRVN,ORBTEA,ORBTEAF,ORBTEAN,ORBTEAD,ORBTEAE
"RTN","ORB3USER",72,0)
 S (ORBSRV,ORBSRVF,ORBSRVN,ORBTEA,ORBTEAF,ORBTEAN,ORBTEAD,ORBTEAE)=""
"RTN","ORB3USER",73,0)
 N ORBCLS,ORBCLSF,ORBCLSN,ORBLST,ORBI
"RTN","ORB3USER",74,0)
 S (ORBCLS,ORBCLSF,ORBCLSN)=""
"RTN","ORB3USER",75,0)
 N ORBDIV,ORBDIVF,ORBDIVN,ORBSYSF,ORBPKGF
"RTN","ORB3USER",76,0)
 S (ORBDIV,ORBDIVF,ORBDIVN,ORBSYSF,ORBPKGF)=""
"RTN","ORB3USER",77,0)
 ;
"RTN","ORB3USER",78,0)
 ;get notification name:
"RTN","ORB3USER",79,0)
 S NODE=$G(^ORD(100.9,ORN,0)) S:$L($G(NODE)) ORBNOTN=$P(NODE,U)
"RTN","ORB3USER",80,0)
 ;
"RTN","ORB3USER",81,0)
 ;get user name:
"RTN","ORB3USER",82,0)
 S NODE=$G(^VA(200,ORBUSR,0)) S:$L($G(NODE)) ORBUSRN=$P(NODE,U)
"RTN","ORB3USER",83,0)
 ;
"RTN","ORB3USER",84,0)
 ;get patient name:
"RTN","ORB3USER",85,0)
 S:$L($G(ORBPT)) NODE=$G(^DPT(ORBPT,0)) S:$L($G(NODE)) ORBPTN=$P(NODE,U)
"RTN","ORB3USER",86,0)
 ;
"RTN","ORB3USER",87,0)
 ;get division flag and name:
"RTN","ORB3USER",88,0)
 S ORBDIV=$$DIVF(ORBUSR,ORN,$G(ORNUM))
"RTN","ORB3USER",89,0)
 I $L(ORBDIV) D
"RTN","ORB3USER",90,0)
 .S ORBDIVF=$P(ORBDIV,U,2),ORBDIV=$P(ORBDIV,U),NODE=$G(^DIC(4,ORBDIV,0))
"RTN","ORB3USER",91,0)
 .S:$L($G(NODE)) ORBDIVN=$P(NODE,U)
"RTN","ORB3USER",92,0)
 ;
"RTN","ORB3USER",93,0)
 ;get system flag:
"RTN","ORB3USER",94,0)
 S ORBSYSF=$$GET^XPAR("SYS","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",95,0)
 ;
"RTN","ORB3USER",96,0)
 ;get OE/RR package-export flag:
"RTN","ORB3USER",97,0)
 S ORBPKGF=$$GET^XPAR("PKG","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",98,0)
 ;
"RTN","ORB3USER",99,0)
 ;get patient's location flag (INPATIENT ONLY - outpt locations cannot be
"RTN","ORB3USER",100,0)
 ;reliably determined, and many simultaneous outpt locations can occur):
"RTN","ORB3USER",101,0)
 I +$G(ORBPT)>0 D
"RTN","ORB3USER",102,0)
 .N DFN S DFN=ORBPT,VA200="" D OERR^VADPT
"RTN","ORB3USER",103,0)
 .S ORBLOC=+$G(^DIC(42,+VAIN(4),44)) I +$G(ORBLOC)>0 D
"RTN","ORB3USER",104,0)
 ..S ORBLOCN=$P(^SC(+ORBLOC,0),U)
"RTN","ORB3USER",105,0)
 ..S ORBLOCF=$$GET^XPAR(+$G(ORBLOC)_";SC(","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",106,0)
 K VA200,VAIN
"RTN","ORB3USER",107,0)
 ;
"RTN","ORB3USER",108,0)
 ;get user's service/section flag:
"RTN","ORB3USER",109,0)
 S ORBSRV=$G(^VA(200,ORBUSR,5)) I +ORBSRV>0 S ORBSRV=$P(ORBSRV,U) D
"RTN","ORB3USER",110,0)
 .S NODE=$G(^DIC(49,ORBSRV,0)) S:$L($G(NODE)) ORBSRVN=$P(NODE,U)
"RTN","ORB3USER",111,0)
 .S:+$G(ORBSRV)>0 ORBSRVF=$$GET^XPAR(ORBSRV_";DIC(49,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",112,0)
 ;
"RTN","ORB3USER",113,0)
 ;get user's team flag:
"RTN","ORB3USER",114,0)
 I $L($G(ORBTEAM)) S ORBTEAF=$P(ORBTEAM,U),ORBTEAN=$P(ORBTEAM,U,2)
"RTN","ORB3USER",115,0)
 ;
"RTN","ORB3USER",116,0)
 ;get class flag for the user's most recently active ASU class
"RTN","ORB3USER",117,0)
 ;S ORBCLS=$$RECENT(ORBUSR) I $L($G(ORBCLS))>0 D
"RTN","ORB3USER",118,0)
 ;.S ORBCLSN=$P(ORBCLS,U,2),ORBCLS=$P(ORBCLS,U)
"RTN","ORB3USER",119,0)
 ;.S:+$G(ORBCLS)>0 ORBCLSF=$$GET^XPAR(ORBCLS_";USR(8930,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",120,0)
 ;
"RTN","ORB3USER",121,0)
 ;get user's flag:
"RTN","ORB3USER",122,0)
 S ORBUSRF=$$GET^XPAR(ORBUSR_";VA(200,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",123,0)
 ;
"RTN","ORB3USER",124,0)
 ;determine overall flag:
"RTN","ORB3USER",125,0)
 I $G(ORBUSRF)="M" Q "ON^User "_ORBUSRN_" is Mandatory.^User value is Mandatory"
"RTN","ORB3USER",126,0)
 I $G(ORBUSRF)="E" Q "ON^User "_ORBUSRN_" is Enabled.^User value is Enabled"
"RTN","ORB3USER",127,0)
 ;I $G(ORBCLSF)="M" Q "ON^User's class "_ORBCLSN_" is Mandatory.^User's class "_ORBCLSN_" value is Mandatory"
"RTN","ORB3USER",128,0)
 I $G(ORBTEAF)="M" Q "ON^User's team "_ORBTEAN_" is Mandatory.^User's team "_ORBTEAN_" value is Mandatory"
"RTN","ORB3USER",129,0)
 I $G(ORBTEAF)="D" Q "OFF^User's team "_ORBTEAN_" is Disabled.^User's team "_ORBTEAN_" value is Disabled"
"RTN","ORB3USER",130,0)
 I $G(ORBSRVF)="M" Q "ON^User's service "_ORBSRVN_" is Mandatory.^User's service "_ORBSRVN_" value is Mandatory"
"RTN","ORB3USER",131,0)
 I $G(ORBLOCF)="M" Q "ON^Patient's location "_ORBLOCN_" is Mandatory.^Pt's location "_ORBLOCN_" value is Mandatory"
"RTN","ORB3USER",132,0)
 I $G(ORBLOCF)="D" Q "OFF^Patient's location "_ORBLOCN_" is Disabled.^Pt's location "_ORBLOCN_" value is Disabled"
"RTN","ORB3USER",133,0)
 I $G(ORBDIVF)="M",($G(ORBLOCF)="") Q "ON^Division "_ORBDIVN_" is Mandatory, no Pt Location value.^Division "_ORBDIVN_" value is Mandatory"
"RTN","ORB3USER",134,0)
 I $G(ORBSYSF)="M",($G(ORBDIVF)=""),($G(ORBLOCF)="") Q "ON^System default is Mandatory, no Division or Pt Location values.^System value is Mandatory"
"RTN","ORB3USER",135,0)
 I $G(ORBPKGF)="M",($G(ORBSYSF)=""),($G(ORBDIVF)=""),($G(ORBLOCF)="") Q "ON^OERR default is Mandatory, no Division, System, or Pt Location values.^OERR value is Mandatory"
"RTN","ORB3USER",136,0)
 I $G(ORBUSRF)="D" Q "OFF^User "_ORBUSRN_" is Disabled - no Mandatory values found.^User value is Disabled"
"RTN","ORB3USER",137,0)
 ;I $G(ORBCLSF)="D" Q "OFF^User's class "_ORBCLSN_" is Disabled - no Mandatory values found.^User's class "_ORBCLSN_" value is Disabled""
"RTN","ORB3USER",138,0)
 I $G(ORBTEAF)="E" Q "ON^User's team "_ORBTEAN_" is Enabled.^User's team "_ORBTEAN_" value is Enabled"
"RTN","ORB3USER",139,0)
 I $G(ORBSRVF)="D" Q "OFF^User's service "_ORBSRVN_" is Disabled.^User's service "_ORBSRVN_" value is Disabled"
"RTN","ORB3USER",140,0)
 I $G(ORBSRVF)="E" Q "ON^User's service "_ORBSRVN_" is Enabled.^User's service "_ORBSRVN_" value is Enabled"
"RTN","ORB3USER",141,0)
 I $G(ORBLOCF)="E" Q "ON^Patient's location "_ORBLOCN_" is Enabled.^Pt's location "_ORBLOCN_" value is Enabled"
"RTN","ORB3USER",142,0)
 I $G(ORBDIVF)="D" Q "OFF^Division "_ORBDIVN_" is Disabled.^Division "_ORBDIVN_" value is Disabled"
"RTN","ORB3USER",143,0)
 I $G(ORBDIVF)="E" Q "ON^Division "_ORBDIVN_" is Enabled.^Division "_ORBDIVN_" value is Enabled"
"RTN","ORB3USER",144,0)
 I $G(ORBSYSF)="D" Q "OFF^System default is Disabled.^System value is Disabled"
"RTN","ORB3USER",145,0)
 I $G(ORBSYSF)="E" Q "ON^System default is Enabled.^System value is Enabled"
"RTN","ORB3USER",146,0)
 I $G(ORBPKGF)="D" Q "OFF^OERR default is Disabled.^OERR value is Disabled"
"RTN","ORB3USER",147,0)
 I $G(ORBPKGF)="E" Q "ON^OERR default is Enabled.^OERR value is Enabled"
"RTN","ORB3USER",148,0)
 Q "OFF^No Mandatory, Disabled or Enabled values found.^No Mandatory/Disabled/Enabled values"
"RTN","ORB3USER",149,0)
 ;
"RTN","ORB3USER",150,0)
RECENT(USER) ;ext funct rtns a user's most recent, active user class
"RTN","ORB3USER",151,0)
 Q:+$G(USER)<1 "^Error: User not identified."
"RTN","ORB3USER",152,0)
 N CLS,CLASS,INACT,ACT,ORX,INVDT,RESULT
"RTN","ORB3USER",153,0)
 ;call api to determine user's class(es)
"RTN","ORB3USER",154,0)
 Q:'$L($G(CLS(0))) "^No user classes found."
"RTN","ORB3USER",155,0)
 D NOW^%DTC
"RTN","ORB3USER",156,0)
 S CLASS="" F  S CLASS=$O(CLS(CLASS)) Q:CLASS=""  D
"RTN","ORB3USER",157,0)
 .S INACT=$P(CLS(CLASS),U,5),ACT=$P(CLS(CLASS),U,4)
"RTN","ORB3USER",158,0)
 .I INACT,(INACT<%) Q  ;quit if class has an inactive date before now
"RTN","ORB3USER",159,0)
 .Q:'ACT     ;quit if class has no active date
"RTN","ORB3USER",160,0)
 .S ORX("DT",9999999-ACT)=$P(CLS(CLASS),U)_U_CLASS
"RTN","ORB3USER",161,0)
 S INVDT="",INVDT=$O(ORX("DT",INVDT))
"RTN","ORB3USER",162,0)
 I INVDT S RESULT=ORX("DT",INVDT)
"RTN","ORB3USER",163,0)
 E  S RESULT="^No user classes found."
"RTN","ORB3USER",164,0)
 K %
"RTN","ORB3USER",165,0)
 Q RESULT
"RTN","ORB3USER",166,0)
DIVF(USER,ORN,ORNUM) ;ext funct rtns user's division value for ORB PROCESSING FLAG
"RTN","ORB3USER",167,0)
 N DIV,DIVF,MDIVF,EDIVF,DDIVF
"RTN","ORB3USER",168,0)
 I +$G(ORNUM) D  Q DIVF
"RTN","ORB3USER",169,0)
 .S DIVF=""
"RTN","ORB3USER",170,0)
 .S DIV=$$ORDIV^ORB31(ORNUM)
"RTN","ORB3USER",171,0)
 .I +$G(DIV)'>0 Q
"RTN","ORB3USER",172,0)
 .S DIVF=$$GET^XPAR(DIV_";DIC(4,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",173,0)
 .I $L(DIVF) S DIVF=DIV_U_DIVF
"RTN","ORB3USER",174,0)
 S DIV=0,(DIVF,MDIVF,EDIVF,DDIVF)=""
"RTN","ORB3USER",175,0)
 F  S DIV=$O(^VA(200,USER,2,"B",DIV)) Q:+$G(DIV)<1!(DIVF="M")  D
"RTN","ORB3USER",176,0)
 .S DIVF=$$GET^XPAR(DIV_";DIC(4,","ORB PROCESSING FLAG",ORN,"I")
"RTN","ORB3USER",177,0)
 .I DIVF="M" S MDIVF=DIV_U_DIVF
"RTN","ORB3USER",178,0)
 .I DIVF="E" S EDIVF=DIV_U_DIVF
"RTN","ORB3USER",179,0)
 .I DIVF="D" S DDIVF=DIV_U_DIVF
"RTN","ORB3USER",180,0)
 Q:$L(MDIVF) MDIVF
"RTN","ORB3USER",181,0)
 Q:$L(EDIVF) EDIVF
"RTN","ORB3USER",182,0)
 Q:$L(DDIVF) DDIVF
"RTN","ORB3USER",183,0)
 Q ""
"RTN","ORQ12")
0^22^B29707523
"RTN","ORQ12",1,0)
ORQ12 ; slc/dcm - Get patient orders in context ;10/24/00  10:49
"RTN","ORQ12",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**12,27,78,92,116,190,220**;Dec 17, 1997
"RTN","ORQ12",3,0)
GET(IFN,NEWD,DETAIL,ACTOR) ; -- Setup TMP array
"RTN","ORQ12",4,0)
 ; IFN=ifn of order
"RTN","ORQ12",5,0)
 ; NEWD=3rd subscript in ^TMP("ORR",$J, node (ORLIST)
"RTN","ORQ12",6,0)
 ; DETAIL=see description in ^ORQ1
"RTN","ORQ12",7,0)
 ;
"RTN","ORQ12",8,0)
 N X0,X3,X4,X6,TXT,STAT,START,DG,STOP,ENTERD
"RTN","ORQ12",9,0)
 S ORLST=ORLST+1,^TMP("ORGOTIT",$J,IFN,+$G(ACTOR))=""
"RTN","ORQ12",10,0)
 I '$G(DETAIL) S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"") Q
"RTN","ORQ12",11,0)
 S X0=^OR(100,IFN,0),X3=$G(^(3)),X4=$G(^(4)),X6=$G(^(6))
"RTN","ORQ12",12,0)
 S DG=$P(X0,U,11),DG=$P($G(^ORD(100.98,+DG,0)),U,3)
"RTN","ORQ12",13,0)
 S STAT=$S($P(X3,U,3):$P(^ORD(100.01,$P(X3,U,3),0),U,1,2),1:"") ;.01^abbr
"RTN","ORQ12",14,0)
 S ENTERD=$P(X0,U,7),START=$P(X0,U,8),STOP=$P(X0,U,9)
"RTN","ORQ12",15,0)
 ; S FLAGREA=$P(X6,U,7)
"RTN","ORQ12",16,0)
 S ^TMP("ORR",$J,NEWD,ORLST)=IFN_$S($G(ACTOR):";"_ACTOR,1:"")_U_DG_U_ENTERD_U_START_U_STOP_U_STAT
"RTN","ORQ12",17,0)
 D TEXT(.TXT,IFN) M ^TMP("ORR",$J,NEWD,ORLST,"TX")=TXT
"RTN","ORQ12",18,0)
 Q
"RTN","ORQ12",19,0)
 ;
"RTN","ORQ12",20,0)
TEXT(ORTX,ORIFN,WIDTH) ; -- Returns text of order ORIFN in ORTX(#)
"RTN","ORQ12",21,0)
 N OR0,OR3,OR6,X,Y,FIRST,ORI,ORJ,DLG,ORX,ORACT,ORTA
"RTN","ORQ12",22,0)
 K ORTX S:'$G(WIDTH) WIDTH=244
"RTN","ORQ12",23,0)
 S ORACT=+$P(ORIFN,";",2),ORIFN=+ORIFN
"RTN","ORQ12",24,0)
 I ORACT<1 S ORACT=+$P($G(^OR(100,ORIFN,3)),U,7) S:'ORACT ORACT=1
"RTN","ORQ12",25,0)
 ;D:$O(^OR(100,ORIFN,1,0)) CNV^ORY92(ORIFN) ;convert text otf
"RTN","ORQ12",26,0)
 S OR0=$G(^OR(100,ORIFN,0)),OR3=$G(^(3)),OR6=$G(^(6)),ORX=$G(^(8,ORACT,0))
"RTN","ORQ12",27,0)
 S ORTX=1,ORTX(1)=""
"RTN","ORQ12",28,0)
 I $L(OR0),($P(^ORD(100.98,$P(OR0,U,11),0),U)="NON-VA MEDICATIONS") S X="Non-VA" D ADD
"RTN","ORQ12",29,0)
 G:$G(ORIGVIEW)>1 T1
"RTN","ORQ12",30,0)
 S:$P(OR0,U,14)=$O(^DIC(9.4,"C","OR",0)) ORTX(1)=">>" ;generic
"RTN","ORQ12",31,0)
 S X=$$ACTION($P(ORX,U,2)) D:$L(X) ADD
"RTN","ORQ12",32,0)
 I $P(ORX,U,2)="NW",$P(OR3,U,11),'$G(ORIGVIEW) D  ; Changed or Renewed
"RTN","ORQ12",33,0)
 . I $P(OR3,U,11)=2 S X="Renew" D ADD Q
"RTN","ORQ12",34,0)
 . N ORIG,ORIGTA S ORIG=+$P(OR3,U,5) Q:'ORIG  Q:$P(OR3,U,11)'=1
"RTN","ORQ12",35,0)
 . S X="Change" D ADD S ORI=0
"RTN","ORQ12",36,0)
 . S ORIGTA=$$LASTXT(ORIG) ;D:$O(^OR(100,ORIG,1,0)) CNV^ORY92(ORIG)
"RTN","ORQ12",37,0)
 . F  S ORI=$O(^OR(100,ORIG,8,ORIGTA,.1,ORI)) Q:ORI'>0  S X=$G(^(ORI,0)) S:$E(X,1,3)=">> " X=$E(X,4,999) D ADD
"RTN","ORQ12",38,0)
 . S X=" to" D ADD
"RTN","ORQ12",39,0)
T1 S ORTA=+$P(ORX,U,14),FIRST=+$O(^OR(100,ORIFN,8,ORTA,.1,0))
"RTN","ORQ12",40,0)
 S ORI=0 F  S ORI=$O(^OR(100,ORIFN,8,ORTA,.1,ORI)) Q:ORI'>0  S X=$G(^(ORI,0)) S:(FIRST=ORI)&($E(X,1,3)=">> ") X=$E(X,4,999) D:$L(X) ADD
"RTN","ORQ12",41,0)
 Q:$G(ORIGVIEW)>1  ;contents of global only
"RTN","ORQ12",42,0)
 S DLG=$P(OR0,U,5) K Y I DLG,$P(DLG,";",2)["101.41",$D(^ORD(101.41,+DLG,9)) X ^(9) I $L($G(Y)) S X=Y D ADD ; additional text
"RTN","ORQ12",43,0)
 ; I $P(OR3,U,11)=2 S X="(Renewal)" D ADD
"RTN","ORQ12",44,0)
 I $P(ORX,U,4)=2 S X="*UNSIGNED*" D ADD
"RTN","ORQ12",45,0)
 I $P(ORX,U,2)="DC"!("^1^13^"[(U_$P(OR3,U,3)_U)),$L(OR6) S X=" <"_$S($L($P(OR6,U,5)):$P(OR6,U,5),$P(OR6,U,4):$P($G(^ORD(100.03,+$P(OR6,U,4),0)),U),1:"")_">" D:$L(X)>3 ADD ; DC Reason
"RTN","ORQ12",46,0)
 I $D(XQAID),$G(ORFLG)=12 S ORX=$G(^OR(100,ORIFN,8,ORACT,3)) I $P(ORX,U) S X=" Flagged "_$$DATETIME($P(ORX,U,3))_$S($P(ORX,U,4):" by "_$$NAME($P(ORX,U,4)),1:"")_": "_$P(ORX,U,5) D ADD ; Flagged - show in FUP
"RTN","ORQ12",47,0)
 Q
"RTN","ORQ12",48,0)
 ;
"RTN","ORQ12",49,0)
LASTXT(IFN)     ; -- Returns action with latest text for order IFN
"RTN","ORQ12",50,0)
 N I,Y S Y=1
"RTN","ORQ12",51,0)
 S I=0 F  S I=$O(^OR(100,IFN,8,I)) Q:I'>0  S:$O(^(I,.1,0)) Y=I
"RTN","ORQ12",52,0)
 Q Y
"RTN","ORQ12",53,0)
 ;
"RTN","ORQ12",54,0)
LAST(CODE) ; -- Return DA of last occurence of CODE action
"RTN","ORQ12",55,0)
 N DA
"RTN","ORQ12",56,0)
 I '$L($G(CODE)) S DA=$O(^OR(100,ORIFN,8,"A"),-1) ; last entry
"RTN","ORQ12",57,0)
 E  S DA=$O(^OR(100,ORIFN,8,"C",CODE,"?"),-1) ; last CODE entry
"RTN","ORQ12",58,0)
 Q DA
"RTN","ORQ12",59,0)
 ;
"RTN","ORQ12",60,0)
ACTION(X) ; -- Returns text of action X
"RTN","ORQ12",61,0)
 N Y
"RTN","ORQ12",62,0)
 S Y=$S(X="DC":"Discontinue",X="HD":"Hold",X="RL"&'$G(ORIGVIEW):"Release Hold of",X="FL":"Flag",X="UF":"Unflag",X="RN"&'$G(ORIGVIEW):"Renew",1:"")
"RTN","ORQ12",63,0)
 Q Y
"RTN","ORQ12",64,0)
 ;
"RTN","ORQ12",65,0)
DATETIME(X) ; -- Returns date/time in format 00/00/00@00:00am
"RTN","ORQ12",66,0)
 N Y,D,T,T1,Z
"RTN","ORQ12",67,0)
 S D=$P(X,"."),T=$E($P(X,".",2)_"0000",1,4),T1=$E(T,1,2),Z="AM"
"RTN","ORQ12",68,0)
 S:T1>12 T1=T1-12,Z="PM"
"RTN","ORQ12",69,0)
 S Y=$E(D,4,5)_"/"_$E(D,6,7)_"/"_(1700+$E(D,1,3))_"@"_T1_":"_$E(T,3,4)_Z
"RTN","ORQ12",70,0)
 Q Y
"RTN","ORQ12",71,0)
 ;
"RTN","ORQ12",72,0)
NAME(X) ; -- Returns name as Lname,F
"RTN","ORQ12",73,0)
 N Y,Z S Z=$P($G(^VA(200,+X,0)),U) Q:Z="" ""
"RTN","ORQ12",74,0)
 S Y=$P(Z,",")_"," F I=$F(Z,","):1:$L(Z) I $E(Z,I)'=" " S Y=Y_$E(Z,I) Q
"RTN","ORQ12",75,0)
 S Y=$$LOWER^VALM1(Y) ; mixed case
"RTN","ORQ12",76,0)
 Q Y
"RTN","ORQ12",77,0)
 ;
"RTN","ORQ12",78,0)
ADD ; -- Add text X to ORTX()
"RTN","ORQ12",79,0)
 N I,Y S Y=$L(ORTX(ORTX)) S:Y Y=Y+1 ;allow for space
"RTN","ORQ12",80,0)
 I $E(X)=" ",Y S ORTX=ORTX+1,ORTX(ORTX)="",Y=0,X=$E(X,2,999) ;new line
"RTN","ORQ12",81,0)
 I Y+$L(X)'>WIDTH S ORTX(ORTX)=ORTX(ORTX)_$S(Y:" ",1:"")_X Q
"RTN","ORQ12",82,0)
 F I=1:1:$L(X," ") S Z=$P(X," ",I) D:(Y+$L(Z))>WIDTH  S ORTX(ORTX)=$G(ORTX(ORTX))_$S(Y:" ",1:"")_Z,Y=$L(ORTX(ORTX)) S:Y Y=Y+1
"RTN","ORQ12",83,0)
 . I $L(Z)>WIDTH F  S ORTX(ORTX)=$G(ORTX(ORTX))_$S(Y:" ",1:"")_$E(Z,1,WIDTH-Y),Z=$E(Z,WIDTH-Y+1,999) Q:$L(Z)'>WIDTH  S ORTX=ORTX+1,Y=0
"RTN","ORQ12",84,0)
 . S ORTX=ORTX+1,Y=0
"RTN","ORQ12",85,0)
 Q
"RTN","ORQ12",86,0)
 ;
"RTN","ORQ12",87,0)
EXPD ; -- loop through ^XTMP("ORAE" to get expired orders
"RTN","ORQ12",88,0)
 K ^TMP("ORGOTIT",$J),^TMP("ORSORT",$J)
"RTN","ORQ12",89,0)
 N TM,TO,IFN,X0,X3,X7,X8,USTS,NOW,ACTOR,X,ORREP
"RTN","ORQ12",90,0)
 S NOW=+$E($$NOW^XLFDT,1,12),TO=0,SDATE=9999999-SDATE,EDATE=9999999-EDATE
"RTN","ORQ12",91,0)
 F  S TO=$O(^XTMP("ORAE",PAT,TO)) Q:'TO  I $D(ORGRP(TO)) S TM=EDATE F  S TM=$O(^XTMP("ORAE",PAT,TO,TM)) Q:'TM!(TM>SDATE)!(+TM<EDATE)  D
"RTN","ORQ12",92,0)
 . S IFN=0 F  S IFN=$O(^XTMP("ORAE",PAT,TO,TM,IFN)) Q:'IFN  I ('$D(^TMP("ORGOTIT",$J,IFN))!MULT) D
"RTN","ORQ12",93,0)
 .. S USTS=$P(^OR(100,IFN,3),U,3)
"RTN","ORQ12",94,0)
 .. Q:+$G(USTS)'=7  ;quit if order no longer expired
"RTN","ORQ12",95,0)
 .. S ORREP=$P(^OR(100,IFN,3),U,6)
"RTN","ORQ12",96,0)
 .. Q:+$G(ORREP)>0  ;quit if order has been replaced
"RTN","ORQ12",97,0)
 .. S ^TMP("ORSORT",$J,9999999-TM,TO,IFN)=""
"RTN","ORQ12",98,0)
 S TM=0 F  S TM=$O(^TMP("ORSORT",$J,TM)) Q:'TM  S TO=0 F  S TO=$O(^TMP("ORSORT",$J,TM,TO)) Q:'TO  D
"RTN","ORQ12",99,0)
 . S IFN=0 F  S IFN=$O(^TMP("ORSORT",$J,TM,TO,IFN)) Q:'IFN  I $D(^OR(100,IFN,0)),$D(^(3)) S X0=^(0),X3=^(3) D 
"RTN","ORQ12",100,0)
 .. S ACTOR=0 F  S ACTOR=$O(^OR(100,"ACT",PAT,9999999-$P(X0,U,7),TO,IFN,ACTOR)) Q:ACTOR<1  I '$D(^TMP("ORGOTIT",$J,IFN,ACTOR)),$D(^OR(100,IFN,8,ACTOR,0)),$P(^(0),U,15)'=13 S X8=^(0),X7=$G(^(7)) D LP1^ORQ11
"RTN","ORQ12",101,0)
 S ^TMP("ORR",$J,ORLIST,"TOT")=ORLST
"RTN","ORQ12",102,0)
 K ^TMP("ORSORT",$J),^TMP("ORGOTIT",$J)
"RTN","ORQ12",103,0)
 Q
"VER")
8.0^22.0
"BLD",5065,6)
^SEQ #220
**END**
**END**
