Released ECX*3*96 SEQ #88
Extracted from mail message
**KIDS**:ECX*3.0*96^

**INSTALL NAME**
ECX*3.0*96
"BLD",6815,0)
ECX*3.0*96^DSS EXTRACTS^0^3060822^y
"BLD",6815,1,0)
^^1^1^3060627^
"BLD",6815,1,1,0)
Ths patch provides a fix to the IV Extract.
"BLD",6815,4,0)
^9.64PA^^
"BLD",6815,"KRN",0)
^9.67PA^8989.52^19
"BLD",6815,"KRN",.4,0)
.4
"BLD",6815,"KRN",.401,0)
.401
"BLD",6815,"KRN",.402,0)
.402
"BLD",6815,"KRN",.403,0)
.403
"BLD",6815,"KRN",.5,0)
.5
"BLD",6815,"KRN",.84,0)
.84
"BLD",6815,"KRN",3.6,0)
3.6
"BLD",6815,"KRN",3.8,0)
3.8
"BLD",6815,"KRN",9.2,0)
9.2
"BLD",6815,"KRN",9.8,0)
9.8
"BLD",6815,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6815,"KRN",9.8,"NM",1,0)
ECXPIVDN^^0^B64318986
"BLD",6815,"KRN",9.8,"NM","B","ECXPIVDN",1)

"BLD",6815,"KRN",19,0)
19
"BLD",6815,"KRN",19.1,0)
19.1
"BLD",6815,"KRN",101,0)
101
"BLD",6815,"KRN",409.61,0)
409.61
"BLD",6815,"KRN",771,0)
771
"BLD",6815,"KRN",870,0)
870
"BLD",6815,"KRN",8989.51,0)
8989.51
"BLD",6815,"KRN",8989.52,0)
8989.52
"BLD",6815,"KRN",8994,0)
8994
"BLD",6815,"KRN","B",.4,.4)

"BLD",6815,"KRN","B",.401,.401)

"BLD",6815,"KRN","B",.402,.402)

"BLD",6815,"KRN","B",.403,.403)

"BLD",6815,"KRN","B",.5,.5)

"BLD",6815,"KRN","B",.84,.84)

"BLD",6815,"KRN","B",3.6,3.6)

"BLD",6815,"KRN","B",3.8,3.8)

"BLD",6815,"KRN","B",9.2,9.2)

"BLD",6815,"KRN","B",9.8,9.8)

"BLD",6815,"KRN","B",19,19)

"BLD",6815,"KRN","B",19.1,19.1)

"BLD",6815,"KRN","B",101,101)

"BLD",6815,"KRN","B",409.61,409.61)

"BLD",6815,"KRN","B",771,771)

"BLD",6815,"KRN","B",870,870)

"BLD",6815,"KRN","B",8989.51,8989.51)

"BLD",6815,"KRN","B",8989.52,8989.52)

"BLD",6815,"KRN","B",8994,8994)

"BLD",6815,"QUES",0)
^9.62^^
"BLD",6815,"REQB",0)
^9.611^1^1
"BLD",6815,"REQB",1,0)
ECX*3.0*84^2
"BLD",6815,"REQB","B","ECX*3.0*84",1)

"MBREQ")
0
"PKG",535,-1)
1^1
"PKG",535,0)
DSS EXTRACTS^ECX
"PKG",535,20,0)
^9.402P^^
"PKG",535,22,0)
^9.49I^1^1
"PKG",535,22,1,0)
3.0^2971222^3000224^66481
"PKG",535,22,1,"PAH",1,0)
96^3060822
"PKG",535,22,1,"PAH",1,1,0)
^^1^1^3060822
"PKG",535,22,1,"PAH",1,1,1,0)
Ths patch provides a fix to the IV Extract.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECXPIVDN")
0^1^B64318986^B62713375
"RTN","ECXPIVDN",1,0)
ECXPIVDN ;ALB/JAP,BIR/DMA,CML,PTD-Extract from IV EXTRACT DATA File (#728.113) ; 10/19/05 9:06am
"RTN","ECXPIVDN",2,0)
 ;;3.0;DSS EXTRACTS;**10,11,8,13,24,33,39,46,49,71,84,96**;Dec 22, 1997
"RTN","ECXPIVDN",3,0)
START ; start package specific extract
"RTN","ECXPIVDN",4,0)
 N DIC,DA,DR,DIQ,DFN,ECXNPRFI,ECXPHA
"RTN","ECXPIVDN",5,0)
 S QFLG=0
"RTN","ECXPIVDN",6,0)
 I '$D(ECINST) D
"RTN","ECXPIVDN",7,0)
 .S ECINST=+$P(^ECX(728,1,0),U) K ECXDIC S DA=ECINST,DIC="^DIC(4,",DIQ(0)="I",DIQ="ECXDIC",DR=".01;99"
"RTN","ECXPIVDN",8,0)
 .D EN^DIQ1 S ECINST=$G(ECXDIC(4,DA,99,"I")) K DIC,DIQ,DA,DR,ECXDIC
"RTN","ECXPIVDN",9,0)
 S ECED=ECED+.3
"RTN","ECXPIVDN",10,0)
 K ^TMP($J,"A"),^TMP($J,"S")
"RTN","ECXPIVDN",11,0)
 S ECD=ECSD1
"RTN","ECXPIVDN",12,0)
 F  S ECD=$O(^ECX(728.113,"A",ECD)),DFN=0 Q:'ECD  Q:ECD>ECED  Q:QFLG  F  S DFN=$O(^ECX(728.113,"A",ECD,DFN)),ON=0  Q:'DFN  F  S ON=$O(^ECX(728.113,"A",ECD,DFN,ON)),DA=0 Q:'ON  K ^TMP($J,"A"),^TMP($J,"S") S ECVOL=0 D  Q:QFLG
"RTN","ECXPIVDN",13,0)
 .S ECXERR=0 D PAT(DFN,ECD,.ECXERR)
"RTN","ECXPIVDN",14,0)
 .Q:ECXERR
"RTN","ECXPIVDN",15,0)
 .F  S DA=$O(^ECX(728.113,"A",ECD,DFN,ON,DA)) Q:'DA  Q:QFLG  I $D(^ECX(728.113,DA,0)) S EC=^(0) D  Q:QFLG
"RTN","ECXPIVDN",16,0)
 ..S DRG=$P(EC,U,4) I $P(EC,U,8)]"" D
"RTN","ECXPIVDN",17,0)
 ...I '$D(^TMP($J,"A",DRG)) S ^(DRG)=$P(EC,U,7,8),^(DRG,1)=0,^(2)=$P(EC,U,12)
"RTN","ECXPIVDN",18,0)
 ...S ^(1)=^TMP($J,"A",DRG,1)+$S($P(EC,U,6)=1:1,$P(EC,U,6)=4:0,1:-1)
"RTN","ECXPIVDN",19,0)
 ..I $P(EC,U,9) D
"RTN","ECXPIVDN",20,0)
 ...I '$D(^TMP($J,"S",DRG)) S ^(DRG)=$P(EC,U,9)_"^ML",^(DRG,1)=0,^(2)=$P(EC,U,12),ECVOL=$P(EC,U,9)+ECVOL
"RTN","ECXPIVDN",21,0)
 ...S ^(1)=^TMP($J,"S",DRG,1)+$S($P(EC,U,6)=1:1,$P(EC,U,6)=4:0,1:-1)
"RTN","ECXPIVDN",22,0)
 ..S ECTYP=$P(EC,U,11),ECTOTC=0,ECDTTM=$$ECXTIME^ECXUTL($P(EC,U,5))
"RTN","ECXPIVDN",23,0)
 .;looped thru all DAs for this order - now put it together
"RTN","ECXPIVDN",24,0)
 .;leave the next line in case the decision is made to send volume designations
"RTN","ECXPIVDN",25,0)
 .;I ECTYP="H" S ECTYP=ECTYP_$S(ECVOL'>1000:1,ECVOL'>2000:2,1:3)
"RTN","ECXPIVDN",26,0)
 .S ECXDSSI=""
"RTN","ECXPIVDN",27,0)
 .;loop thru tmp global and call pharmacy drug file (#50) api
"RTN","ECXPIVDN",28,0)
 .F SA="S","A" S DRG="" F  S DRG=$O(^TMP($J,SA,DRG)) Q:DRG=""  S ECXPHA="",ECXPHA=$$PHAAPI^ECXUTL5(DRG) I $P(ECXPHA,U)'="" D STUFF Q:QFLG
"RTN","ECXPIVDN",29,0)
 K ^TMP($J),CLIN,DA,DFN,DIC,DIK,DRG,ON,SA,X,Y,P1,P3
"RTN","ECXPIVDN",30,0)
 Q
"RTN","ECXPIVDN",31,0)
STUFF ;get data
"RTN","ECXPIVDN",32,0)
 N ECORDST
"RTN","ECXPIVDN",33,0)
 S ECST=^TMP($J,SA,DRG),ECXCNT=^(DRG,1),ECXCOST=^(2),ECXCOST=ECXCOST*ECXCNT,ECORDST=""
"RTN","ECXPIVDN",34,0)
 S ECVACL=$P(ECXPHA,U,2)
"RTN","ECXPIVDN",35,0)
 ;if outpatient get division from iv rm; get dss identifier for clinic
"RTN","ECXPIVDN",36,0)
 I ECXA="O" D
"RTN","ECXPIVDN",37,0)
 .;- Only set ward to .5 if outpatient (but NOT observation patient)
"RTN","ECXPIVDN",38,0)
 .I $G(ECXW)="" S ECXW=.5
"RTN","ECXPIVDN",39,0)
 .I $P(EC,U,15) S ECIVRM=$P(EC,U,15),ECXDIV=$P(^PS(59.5,ECIVRM,0),U,4)
"RTN","ECXPIVDN",40,0)
 .S CLIN=+$P(EC,U,13),(ECXP1,ECXP2)="000"
"RTN","ECXPIVDN",41,0)
 .S ECXCL=$G(^ECX(728.44,CLIN,0)) Q:ECXCL=""
"RTN","ECXPIVDN",42,0)
 .S ECSC=$P(ECXCL,U,4),ECCSC=$P(ECXCL,U,5)
"RTN","ECXPIVDN",43,0)
 .I ECSC="" S ECSC=$P(ECXCL,U,2),ECCSC=$P(ECXCL,U,3)
"RTN","ECXPIVDN",44,0)
 .I ECSC S ECXP1=$$RJ^XLFSTR(ECSC,3,0),ECXP2=$$RJ^XLFSTR(ECCSC,3,0)
"RTN","ECXPIVDN",45,0)
 .I ECSC="" S ECSC=$P($G(^SC(ECXCL,0)),U,7),ECCSC=$P($G(^SC(ECXCL,0)),U,18) I ECSC D
"RTN","ECXPIVDN",46,0)
 ..S ECXP1=$P($G(^DIC(40.7,ECSC,0)),U,2) S:ECCSC]"" ECXP2=$P($G(^DIC(40.7,ECCSC,0)),U,2)
"RTN","ECXPIVDN",47,0)
 ..S ECXP1=$$RJ^XLFSTR(ECXP1,3,0),ECXP2=$$RJ^XLFSTR(ECXP2,3,0)
"RTN","ECXPIVDN",48,0)
 .S ECXDSSI=ECXP1_ECXP2
"RTN","ECXPIVDN",49,0)
 .I ECXLOGIC>2003 D
"RTN","ECXPIVDN",50,0)
 ..I "^18^23^24^36^41^65^94^"[("^"_ECXTS_"^") S ECXDSSI=$$TSMAP^ECXUTL4(ECXTS)
"RTN","ECXPIVDN",51,0)
 S ECINV=$P(ECXPHA,U,4),ECINV=$S(ECINV["I":"I",1:"")
"RTN","ECXPIVDN",52,0)
 S ECST=ECXCNT*ECST_" "_$P(ECST,U,2)
"RTN","ECXPIVDN",53,0)
 S ECNDC=$P(ECXPHA,U,3),ECNFC=$$RJ^XLFSTR($P(ECNDC,"-"),6,0)_$$RJ^XLFSTR($P(ECNDC,"-",2),4,0)_$$RJ^XLFSTR($P(ECNDC,"-",3),2,0),ECNFC=$TR(ECNFC,"*",0)
"RTN","ECXPIVDN",54,0)
 S P1=$P(ECXPHA,U,5),P3=$P(ECXPHA,U,6)
"RTN","ECXPIVDN",55,0)
 S X="PSNAPIS" X ^%ZOSF("TEST") I $T S ECNFC=$$DSS^PSNAPIS(P1,P3,ECXYM)_ECNFC
"RTN","ECXPIVDN",56,0)
 I $L(ECNFC)=12 S ECNFC=$$RJ^XLFSTR(P1,4,0)_$$RJ^XLFSTR(P3,3,0)_ECNFC
"RTN","ECXPIVDN",57,0)
 ;
"RTN","ECXPIVDN",58,0)
 ;- Ordering provider ("2"_provider)
"RTN","ECXPIVDN",59,0)
 S ECXORDPR=$S(+$P(EC,U,10):"2"_$P(EC,U,10),1:"")
"RTN","ECXPIVDN",60,0)
 S ECXOPNPI=""
"RTN","ECXPIVDN",61,0)
 ;- Ordering date
"RTN","ECXPIVDN",62,0)
 S ECXORDDT=$P(EC,U,16)
"RTN","ECXPIVDN",63,0)
 ;- Requesting physician (null for FY2002)
"RTN","ECXPIVDN",64,0)
 S ECXRPHY=""
"RTN","ECXPIVDN",65,0)
 ;- Department and National Prod Division
"RTN","ECXPIVDN",66,0)
 S ECXDSSD="" ;dss department use postponed $$IVP^ECXDEPT(ECXDIV)
"RTN","ECXPIVDN",67,0)
 N ECXPDIV S ECXPDIV=$$GETDIV^ECXDEPT(ECXDIV)
"RTN","ECXPIVDN",68,0)
 ;- Observation patient indicator (yes/no)
"RTN","ECXPIVDN",69,0)
 S ECXOBS=$$OBSPAT^ECXUTL4(ECXA,ECXTS,ECXDSSI)
"RTN","ECXPIVDN",70,0)
 ; - Ordering Date, Ordering Stop Code
"RTN","ECXPIVDN",71,0)
 S ECXORDST=""
"RTN","ECXPIVDN",72,0)
 I ECXA="O" D
"RTN","ECXPIVDN",73,0)
 .S ECXORDST=$$DOIVPO^ECXUTL5(DFN,ON)
"RTN","ECXPIVDN",74,0)
 .I ECXOBS="NO" S ECORDST="160"
"RTN","ECXPIVDN",75,0)
 .I ECXOBS="YES" S ECORDST=$P($G(^ECX(727.831,+ECXTS,0)),U,6)
"RTN","ECXPIVDN",76,0)
 ;- If no encounter number don't file record
"RTN","ECXPIVDN",77,0)
 S ECXENC=$$ENCNUM^ECXUTL4(ECXA,ECXSSN,ECXADM,ECD,ECXTS,ECXOBS,ECHEAD,ECORDST,)
"RTN","ECXPIVDN",78,0)
 ;get BCMA data
"RTN","ECXPIVDN",79,0)
 S (ECXBCDD,ECXBCDG,ECXBCUA,ECXBCIF)=""
"RTN","ECXPIVDN",80,0)
 ;
"RTN","ECXPIVDN",81,0)
 ;get ordering provider person class
"RTN","ECXPIVDN",82,0)
 S ECXOPPC=$$PRVCLASS^ECXUTL($E(ECXORDPR,2,999),ECXORDDT)
"RTN","ECXPIVDN",83,0)
 ;
"RTN","ECXPIVDN",84,0)
 ;set national patient record flag if exist
"RTN","ECXPIVDN",85,0)
 S ECXDFN=DFN D NPRF^ECXUTL5 K ECXDFN
"RTN","ECXPIVDN",86,0)
 ;
"RTN","ECXPIVDN",87,0)
 D:ECXENC'="" FILE K P1,P3
"RTN","ECXPIVDN",88,0)
 Q
"RTN","ECXPIVDN",89,0)
 ;
"RTN","ECXPIVDN",90,0)
PAT(ECXDFN,ECXDATE,ECXERR) ;get patient demographics, primary care, and inpatient data
"RTN","ECXPIVDN",91,0)
 N X
"RTN","ECXPIVDN",92,0)
 ;init variables
"RTN","ECXPIVDN",93,0)
 S (ECXCAT,ECXSTAT,ECXPRIOR,ECXSBGRP)=""
"RTN","ECXPIVDN",94,0)
 ;get patient data if saved
"RTN","ECXPIVDN",95,0)
 I $D(^TMP($J,"ECXP",ECXDFN)) D
"RTN","ECXPIVDN",96,0)
 .S PT=^TMP($J,"ECXP",ECXDFN)
"RTN","ECXPIVDN",97,0)
 .S ECXPNM=$P(PT,U),ECXSSN=$P(PT,U,2),ECXMPI=$P(PT,U,3)
"RTN","ECXPIVDN",98,0)
 .S ECXDOB=$P(PT,U,4),ECXELIG=$P(PT,U,5),ECXSEX=$P(PT,U,6)
"RTN","ECXPIVDN",99,0)
 .S ECXSTATE=$P(PT,U,7),ECXCNTY=$P(PT,U,8),ECXZIP=$P(PT,U,9)
"RTN","ECXPIVDN",100,0)
 .S ECXVET=$P(PT,U,10),ECXPOS=$P(PT,U,11),ECXPST=$P(PT,U,12)
"RTN","ECXPIVDN",101,0)
 .S ECXPLOC=$P(PT,U,13),ECXRST=$P(PT,U,14),ECXAST=$P(PT,U,15)
"RTN","ECXPIVDN",102,0)
 .S ECXAOL=$P(PT,U,16),ECXPHI=$P(PT,U,17),ECXMST=$P(PT,U,18)
"RTN","ECXPIVDN",103,0)
 .S ECXENRL=$P(PT,U,19),ECXCNHU=$P(PT,U,20),ECXCAT=$P(PT,U,21)
"RTN","ECXPIVDN",104,0)
 .S ECXSTAT=$P(PT,U,22),ECXPRIOR=$P(PT,U,23),ECXHNCI=$P(PT,U,24)
"RTN","ECXPIVDN",105,0)
 .S ECXETH=$P(PT,U,25),ECXRC1=$P(PT,U,26),ECXMTST=$P(PT,U,27)
"RTN","ECXPIVDN",106,0)
 .I $$ENROLLM^ECXUTL2(ECXDFN)
"RTN","ECXPIVDN",107,0)
 ;set patient data
"RTN","ECXPIVDN",108,0)
 I '$D(^TMP($J,"ECXP",ECXDFN)) D  Q:'OK
"RTN","ECXPIVDN",109,0)
 .K ECXPAT S OK=$$PAT^ECXUTL3(ECXDFN,$P(ECXDATE,"."),"1;2;3;5",.ECXPAT)
"RTN","ECXPIVDN",110,0)
 .I 'OK K ECXPAT S ECXERR=1 Q
"RTN","ECXPIVDN",111,0)
 .S ECXPNM=ECXPAT("NAME"),ECXSSN=ECXPAT("SSN"),ECXMPI=ECXPAT("MPI")
"RTN","ECXPIVDN",112,0)
 .S ECXDOB=ECXPAT("DOB"),ECXELIG=ECXPAT("ELIG"),ECXSEX=ECXPAT("SEX")
"RTN","ECXPIVDN",113,0)
 .S ECXSTATE=ECXPAT("STATE"),ECXCNTY=ECXPAT("COUNTY")
"RTN","ECXPIVDN",114,0)
 .S ECXZIP=ECXPAT("ZIP"),ECXVET=ECXPAT("VET")
"RTN","ECXPIVDN",115,0)
 .S ECXPOS=ECXPAT("POS"),ECXPST=ECXPAT("POW STAT")
"RTN","ECXPIVDN",116,0)
 .S ECXPLOC=ECXPAT("POW LOC"),ECXRST=ECXPAT("IR STAT")
"RTN","ECXPIVDN",117,0)
 .S ECXAST=ECXPAT("AO STAT"),ECXAOL=ECXPAT("AOL")
"RTN","ECXPIVDN",118,0)
 .S ECXPHI=ECXPAT("PHI"),ECXMST=ECXPAT("MST STAT")
"RTN","ECXPIVDN",119,0)
 .S ECXENRL=ECXPAT("ENROLL LOC"),ECXMTST=ECXPAT("MEANS")
"RTN","ECXPIVDN",120,0)
 .;get CNHU status
"RTN","ECXPIVDN",121,0)
 .S ECXCNHU=$$CNHSTAT^ECXUTL4(ECXDFN)
"RTN","ECXPIVDN",122,0)
 .;get enrollment data (category, status and priority)
"RTN","ECXPIVDN",123,0)
 .I $$ENROLLM^ECXUTL2(ECXDFN)
"RTN","ECXPIVDN",124,0)
 .; - Head and Neck Cancer Indicator
"RTN","ECXPIVDN",125,0)
 .S ECXHNCI=$$HNCI^ECXUTL4(ECXDFN)
"RTN","ECXPIVDN",126,0)
 .; - Race and Ethnicity
"RTN","ECXPIVDN",127,0)
 .S ECXETH=ECXPAT("ETHNIC")
"RTN","ECXPIVDN",128,0)
 .S ECXRC1=ECXPAT("RACE1")
"RTN","ECXPIVDN",129,0)
 .;save for later
"RTN","ECXPIVDN",130,0)
 .S ^TMP($J,"ECXP",ECXDFN)=ECXPNM_U_ECXSSN_U_ECXMPI_U_ECXDOB_U_ECXELIG_U_ECXSEX_U_ECXSTATE_U_ECXCNTY_U_ECXZIP_U_ECXVET_U_ECXPOS_U_ECXPST_U_ECXPLOC_U_ECXRST_U_ECXAST
"RTN","ECXPIVDN",131,0)
 .S ^TMP($J,"ECXP",ECXDFN)=^TMP($J,"ECXP",ECXDFN)_U_ECXAOL_U_ECXPHI_U_ECXMST_U_ECXENRL_U_ECXCNHU_U_ECXCAT_U_ECXSTAT_U_ECXPRIOR_U_ECXHNCI_U_ECXETH_U_ECXRC1_U_ECXMTST
"RTN","ECXPIVDN",132,0)
 ;get primary care data
"RTN","ECXPIVDN",133,0)
 S X=$$PRIMARY^ECXUTL2(ECXDFN,$P(ECXDATE,"."))
"RTN","ECXPIVDN",134,0)
 S ECPTTM=$P(X,U,1),ECPTPR=$P(X,U,2),ECCLAS=$P(X,U,3),ECPTNPI=$P(X,U,4)
"RTN","ECXPIVDN",135,0)
 S ECASPR=$P(X,U,5),ECCLAS2=$P(X,U,6),ECASNPI=$P(X,U,7)
"RTN","ECXPIVDN",136,0)
 ;get inpatient data
"RTN","ECXPIVDN",137,0)
 S (ECXA,ECXMN,ECXADM,ECXTS,ECXW,ECXDIV)=""
"RTN","ECXPIVDN",138,0)
 S X=$$INP^ECXUTL2(ECXDFN,ECXDATE)
"RTN","ECXPIVDN",139,0)
 S ECXA=$P(X,U),ECXMN=$P(X,U,2),ECXTS=$P(X,U,3),ECXADM=$P(X,U,4)
"RTN","ECXPIVDN",140,0)
 S W=$P(X,U,9),ECXDOM=$P(X,U,10),ECXW=$P(W,";"),ECXDIV=$P(W,";",2)
"RTN","ECXPIVDN",141,0)
 Q
"RTN","ECXPIVDN",142,0)
FILE ;file record
"RTN","ECXPIVDN",143,0)
 ;node0
"RTN","ECXPIVDN",144,0)
 ;fac^dfn^ssn^name^i/o^day^va class^qty^ward^cost^movement #^treat spec^ndc^investigational^iv dispensing fee^new feeder key^total doses^
"RTN","ECXPIVDN",145,0)
 ;primary care team^primary care provider^ivp time^adm date^adm time^dss identifier
"RTN","ECXPIVDN",146,0)
 ;node1
"RTN","ECXPIVDN",147,0)
 ;mpi^dss dept^pc provider npi^pc prov person class^assoc pc provider^assoc pc prov person class^assoc pc prov npi^dom^obs pat ind^enc num^
"RTN","ECXPIVDN",148,0)
 ;ord pr^ord dt^req phys^nat prod division^means tst^elig^dob^sex^state^county^zip+4^vet^period of svc^pow stat^pow loc^ir stat^ao stat^
"RTN","ECXPIVDN",149,0)
 ;ao loc^purple heart ind.^mst stat^enrollment loc^enrollment cat^enrollment stat^enrollment prior^cnh/sh stat^ord pr npi
"RTN","ECXPIVDN",150,0)
 ;node2
"RTN","ECXPIVDN",151,0)
 ;head & neck cancer ind.^ethnicity^race1^bcma drug dispensed^
"RTN","ECXPIVDN",152,0)
 ;bcma dose given^bcma unit of administration^bcma ICU flag^
"RTN","ECXPIVDN",153,0)
 ;ordering provider person class^^user
"RTN","ECXPIVDN",154,0)
 ;enrollee ECXUESTA^patient type ECXPTYPE^combat vet elig
"RTN","ECXPIVDN",155,0)
 ;ECXCVE^combat vet elig end date ECXCVEDT^enc cv eligible ECXCVENC^
"RTN","ECXPIVDN",156,0)
 ;national patient record flag ECXNPRFI,ordering stop code ECXIVPO
"RTN","ECXPIVDN",157,0)
 N DA,DIK
"RTN","ECXPIVDN",158,0)
 S EC7=$O(^ECX(ECFILE,999999999),-1),EC7=EC7+1
"RTN","ECXPIVDN",159,0)
 S ECODE=EC7_U_EC23_U_ECXDIV_U_DFN_U_ECXSSN_U_ECXPNM_U_ECXA_U
"RTN","ECXPIVDN",160,0)
 S ECODE=ECODE_$$ECXDATE^ECXUTL(ECD,ECXYM)_U_ECVACL_U_ECXCNT_U_ECXW_U
"RTN","ECXPIVDN",161,0)
 S ECODE=ECODE_ECXCOST_U_ECXMN_U_ECXTS_U_ECNDC_U_ECINV_U_ECTYP_U_ECNFC_U
"RTN","ECXPIVDN",162,0)
 S ECODE=ECODE_ECST_U_ECPTTM_U_ECPTPR_U_ECDTTM_U
"RTN","ECXPIVDN",163,0)
 S ECODE=ECODE_$$ECXDATE^ECXUTL(ECXADM,ECXYM)_U
"RTN","ECXPIVDN",164,0)
 S ECODE=ECODE_$$ECXTIME^ECXUTL(ECXADM)_U_ECXDSSI_U
"RTN","ECXPIVDN",165,0)
 ;if outpat and not observ patient, admit date="" and admit time="000000"
"RTN","ECXPIVDN",166,0)
 I ECXA="O",(ECXOBS="NO") S $P(ECODE,U,24)="",$P(ECODE,U,25)="000000"
"RTN","ECXPIVDN",167,0)
 S ECODE1=ECXMPI_U_ECXDSSD_U_ECPTNPI_U_ECCLAS_U_ECASPR_U_ECCLAS2_U
"RTN","ECXPIVDN",168,0)
 S ECODE1=ECODE1_ECASNPI_U_ECXDOM_U_ECXOBS_U_ECXENC_U_ECXORDPR_U
"RTN","ECXPIVDN",169,0)
 S ECODE1=ECODE1_ECXORDST_U_$$ECXDATE^ECXUTL(ECXORDDT,ECXYM)_U
"RTN","ECXPIVDN",170,0)
 S ECODE1=ECODE1_ECXRPHY_U_ECXPDIV_U_ECXMTST_U_ECXELIG_U_ECXDOB_U
"RTN","ECXPIVDN",171,0)
 S ECODE1=ECODE1_ECXSEX_U_ECXSTATE_U_ECXCNTY_U_ECXZIP_U_ECXVET_U
"RTN","ECXPIVDN",172,0)
 S ECODE1=ECODE1_ECXPOS_U_ECXPST_U_ECXPLOC_U_ECXRST_U_ECXAST_U
"RTN","ECXPIVDN",173,0)
 S ECODE1=ECODE1_ECXAOL_U_ECXPHI_U_ECXMST_U_ECXENRL_U_ECXCAT_U
"RTN","ECXPIVDN",174,0)
 S ECODE1=ECODE1_ECXSTAT_U_$S(ECXLOGIC<2005:ECXPRIOR,1:"")_U_ECXCNHU_U_ECXOPNPI_U
"RTN","ECXPIVDN",175,0)
 S ECODE2=ECXHNCI_U_ECXETH_U_ECXRC1
"RTN","ECXPIVDN",176,0)
 I ECXLOGIC>2003 D
"RTN","ECXPIVDN",177,0)
 .S ECODE2=ECODE2_U_ECXBCDD_U_ECXBCDG_U_ECXBCUA_U_ECXBCIF_U_ECXOPPC
"RTN","ECXPIVDN",178,0)
 I ECXLOGIC>2004 S ECODE2=ECODE2_U_U_ECXPRIOR_ECXSBGRP_U_ECXUESTA_U_ECXPTYPE_U_ECXCVE_U_ECXCVEDT_U_ECXCVENC_U_ECXNPRFI
"RTN","ECXPIVDN",179,0)
 S ^ECX(ECFILE,EC7,0)=ECODE,^ECX(ECFILE,EC7,1)=ECODE1
"RTN","ECXPIVDN",180,0)
 S ^ECX(ECFILE,EC7,2)=ECODE2,ECRN=ECRN+1
"RTN","ECXPIVDN",181,0)
 S DA=EC7,DIK="^ECX("_ECFILE_"," D IX^DIK K DIK,DA
"RTN","ECXPIVDN",182,0)
 I $D(ZTQUEUED),$$S^%ZTLOAD S QFLG=1
"RTN","ECXPIVDN",183,0)
 Q
"RTN","ECXPIVDN",184,0)
SETUP ;Set required input for ECXTRAC
"RTN","ECXPIVDN",185,0)
 S ECHEAD="IVP"
"RTN","ECXPIVDN",186,0)
 D ECXDEF^ECXUTL2(ECHEAD,.ECPACK,.ECGRP,.ECFILE,.ECRTN,.ECPIECE,.ECVER)
"RTN","ECXPIVDN",187,0)
 ;variables ecver and ecrtn will be reset in routine ecxtrac if appropriate
"RTN","ECXPIVDN",188,0)
 S ECVER=7
"RTN","ECXPIVDN",189,0)
 Q
"RTN","ECXPIVDN",190,0)
QUE ; entry point for the background requeuing handled by ECXTAUTO
"RTN","ECXPIVDN",191,0)
 D SETUP,QUE^ECXTAUTO,^ECXKILL Q
"VER")
8.0^22.0
"BLD",6815,6)
^88
**END**
**END**
