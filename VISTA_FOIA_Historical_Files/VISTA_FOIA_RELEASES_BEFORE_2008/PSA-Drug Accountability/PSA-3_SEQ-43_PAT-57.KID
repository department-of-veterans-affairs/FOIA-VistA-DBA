Released PSA*3*57 SEQ #43
Extracted from mail message
**KIDS**:PSA*3.0*57^

**INSTALL NAME**
PSA*3.0*57
"BLD",6608,0)
PSA*3.0*57^DRUG ACCOUNTABILITY^0^3060207^y
"BLD",6608,1,0)
^^2^2^3060207^
"BLD",6608,1,1,0)
This patch will correct the problem of the Post Verify e-mail
"BLD",6608,1,2,0)
not sent when changes are made to the invoice.
"BLD",6608,4,0)
^9.64PA^^
"BLD",6608,"ABPKG")
n
"BLD",6608,"KRN",0)
^9.67PA^8989.52^19
"BLD",6608,"KRN",.4,0)
.4
"BLD",6608,"KRN",.401,0)
.401
"BLD",6608,"KRN",.402,0)
.402
"BLD",6608,"KRN",.403,0)
.403
"BLD",6608,"KRN",.5,0)
.5
"BLD",6608,"KRN",.84,0)
.84
"BLD",6608,"KRN",3.6,0)
3.6
"BLD",6608,"KRN",3.8,0)
3.8
"BLD",6608,"KRN",9.2,0)
9.2
"BLD",6608,"KRN",9.8,0)
9.8
"BLD",6608,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6608,"KRN",9.8,"NM",1,0)
PSAVER6^^0^B56721641
"BLD",6608,"KRN",9.8,"NM","B","PSAVER6",1)
 
"BLD",6608,"KRN",19,0)
19
"BLD",6608,"KRN",19.1,0)
19.1
"BLD",6608,"KRN",101,0)
101
"BLD",6608,"KRN",409.61,0)
409.61
"BLD",6608,"KRN",771,0)
771
"BLD",6608,"KRN",870,0)
870
"BLD",6608,"KRN",8989.51,0)
8989.51
"BLD",6608,"KRN",8989.52,0)
8989.52
"BLD",6608,"KRN",8994,0)
8994
"BLD",6608,"KRN","B",.4,.4)
 
"BLD",6608,"KRN","B",.401,.401)
 
"BLD",6608,"KRN","B",.402,.402)
 
"BLD",6608,"KRN","B",.403,.403)
 
"BLD",6608,"KRN","B",.5,.5)
 
"BLD",6608,"KRN","B",.84,.84)
 
"BLD",6608,"KRN","B",3.6,3.6)
 
"BLD",6608,"KRN","B",3.8,3.8)
 
"BLD",6608,"KRN","B",9.2,9.2)
 
"BLD",6608,"KRN","B",9.8,9.8)
 
"BLD",6608,"KRN","B",19,19)
 
"BLD",6608,"KRN","B",19.1,19.1)
 
"BLD",6608,"KRN","B",101,101)
 
"BLD",6608,"KRN","B",409.61,409.61)
 
"BLD",6608,"KRN","B",771,771)
 
"BLD",6608,"KRN","B",870,870)
 
"BLD",6608,"KRN","B",8989.51,8989.51)
 
"BLD",6608,"KRN","B",8989.52,8989.52)
 
"BLD",6608,"KRN","B",8994,8994)
 
"BLD",6608,"QUES",0)
^9.62^^
"BLD",6608,"REQB",0)
^9.611^1^1
"BLD",6608,"REQB",1,0)
PSA*3.0*53^1
"BLD",6608,"REQB","B","PSA*3.0*53",1)
 
"MBREQ")
0
"PKG",487,-1)
1^1
"PKG",487,0)
DRUG ACCOUNTABILITY^PSA^Drug Accountability Inventory and Tracking module.
"PKG",487,20,0)
^9.402P^^
"PKG",487,22,0)
^9.49I^1^1
"PKG",487,22,1,0)
3.0^2971024^2981028^66481
"PKG",487,22,1,"PAH",1,0)
57^3060207
"PKG",487,22,1,"PAH",1,1,0)
^^2^2^3060207
"PKG",487,22,1,"PAH",1,1,1,0)
This patch will correct the problem of the Post Verify e-mail
"PKG",487,22,1,"PAH",1,1,2,0)
not sent when changes are made to the invoice.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSAVER6")
0^1^B56721641^B55845889
"RTN","PSAVER6",1,0)
PSAVER6 ;BIR/JMB-Verify Invoices - CONT'D ;10/3/97
"RTN","PSAVER6",2,0)
 ;;3.0; DRUG ACCOUNTABILITY/INVENTORY INTERFACE;**1,3,21,42,53,57**; 10/24/97
"RTN","PSAVER6",3,0)
 ;Background Job:
"RTN","PSAVER6",4,0)
 ;References to ^PSDRUG( are covered by IA #2095
"RTN","PSAVER6",5,0)
 ;This routine increments pharmacy location and master vault balances
"RTN","PSAVER6",6,0)
 ;in 58.8 after invoices have been verified.
"RTN","PSAVER6",7,0)
 ;
"RTN","PSAVER6",8,0)
START ;|=> *42 add Post Verify variance report
"RTN","PSAVER6",9,0)
 K ^TMP($J,"PSADD")
"RTN","PSAVER6",10,0)
 K DIC,DA,DR,DIE  ;|=> *52 MOVE POST VERIFY E-MAIL LOGIC FROM START+17
"RTN","PSAVER6",11,0)
 S PSAIEN=0  F  S PSAIEN=+$O(PSAVBKG(PSAIEN)) Q:'PSAIEN  D
"RTN","PSAVER6",12,0)
 .Q:'$D(^PSD(58.811,PSAIEN,0))
"RTN","PSAVER6",13,0)
 .S PSAORD=$P(^PSD(58.811,PSAIEN,0),"^"),PSAVEND=$P(^(0),"^",2),PSAIEN1=0
"RTN","PSAVER6",14,0)
 .F  S PSAIEN1=+$O(PSAVBKG(PSAIEN,PSAIEN1)) Q:'PSAIEN1  D
"RTN","PSAVER6",15,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))
"RTN","PSAVER6",16,0)
 ..D SCANDIF  ; *57 <=|
"RTN","PSAVER6",17,0)
 S PSAIEN=0  F  S PSAIEN=+$O(PSAVBKG(PSAIEN)) Q:'PSAIEN  D
"RTN","PSAVER6",18,0)
 .Q:'$D(^PSD(58.811,PSAIEN,0))
"RTN","PSAVER6",19,0)
 .S PSAORD=$P(^PSD(58.811,PSAIEN,0),"^"),PSAVEND=$P(^(0),"^",2),PSAIEN1=0
"RTN","PSAVER6",20,0)
 .F  S PSAIEN1=+$O(PSAVBKG(PSAIEN,PSAIEN1)) Q:'PSAIEN1  D
"RTN","PSAVER6",21,0)
 ..Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,0))
"RTN","PSAVER6",22,0)
 ..S PSAIN=^PSD(58.811,PSAIEN,1,PSAIEN1,0)
"RTN","PSAVER6",23,0)
 ..K DIC,DA,DR,DIE
"RTN","PSAVER6",24,0)
 ..I +$P(PSAIN,"^",13) K DA S DIE="^PSD(58.811,"_PSAIEN_",1,",DA(1)=PSAIEN,DA=PSAIEN1,DR="2////C" D ^DIE K DIE,DA,DR Q
"RTN","PSAVER6",25,0)
 ..S PSAINV=$P(PSAIN,"^"),PSAINVDT=$P(PSAIN,"^",2),PSALINE=0
"RTN","PSAVER6",26,0)
 ..F  S PSALINE=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE)) Q:'PSALINE  D
"RTN","PSAVER6",27,0)
 ...Q:'$D(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0))
"RTN","PSAVER6",28,0)
 ...S PSADATA=^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,0) D GETDATA I 'PSASUP,'$D(PSA0QTY) D FILE ;PSA*3*42
"RTN","PSAVER6",29,0)
 ..K DIC,DA,DR,DIE
"RTN","PSAVER6",30,0)
 ..K DA S DIE="^PSD(58.811,"_PSAIEN_",1,",DA(1)=PSAIEN,DA=PSAIEN1,DR="2////C" D ^DIE K DIE,DA,DR
"RTN","PSAVER6",31,0)
 ;;*57 => START+17 THRU START+22 MOVED TO START+3 <=|
"RTN","PSAVER6",32,0)
 ; *42 <=|
"RTN","PSAVER6",33,0)
EXIT ;Kills variables
"RTN","PSAVER6",34,0)
 K %,DA,DD,DIC,DIE,DINUM,DLAYGO,DO,PSA,PSAA,PSABAL,PSACBAL,PSACNT,PSACNT,PSACOD,PSACOST,PSACS,PSADASH,PSADATA,PSADJ,PSADJD,PSADJO,PSADJP,PSADJQ
"RTN","PSAVER6",35,0)
 K PSADRG,PSADT,PSADUOU,PSADUQTY,PSADUREC,PSAIEN,PSAIEN1,PSAIN,PSAINV,PSAINVDT,PSALEN,PSALINE,PSALOC,PSAMSG,PSANDC,PSANODE,PSANPDU,PSANPOU
"RTN","PSAVER6",36,0)
 K PSAODASH,PSAONDC,PSAORD,PSAOU,PSAPDU,PSAPOU,PSAQTY,PSAREORD,PSASET,PSASTOCK,PSASUP,PSAT,PSATDRG,PSATEMP,PSAVBKG,PSAVDUZ,PSAVEND,PSAVSN,X,XMDUZ,XMSUB,XMTEXT,XMY,XMZ,Y
"RTN","PSAVER6",37,0)
 K PSA0QTY
"RTN","PSAVER6",38,0)
 Q
"RTN","PSAVER6",39,0)
 ;
"RTN","PSAVER6",40,0)
GETDATA ;Gets invoice data to help file the data
"RTN","PSAVER6",41,0)
 S PSAVDUZ=$P(PSADATA,"^",9),PSASUP=0
"RTN","PSAVER6",42,0)
 S PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","D",0))
"RTN","PSAVER6",43,0)
 I '$G(PSADJ) S PSADRG=$S(+$P(PSADATA,"^",2):+$P(PSADATA,"^",2),1:0) G CS
"RTN","PSAVER6",44,0)
 I $G(PSADJ) D
"RTN","PSAVER6",45,0)
 .S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0))
"RTN","PSAVER6",46,0)
 .S PSADJD=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAVER6",47,0)
 .I PSADJD'?1.N S PSASUP=1
"RTN","PSAVER6",48,0)
 .S PSADRG=$S(PSADJ&('PSASUP):+PSADJD,PSADJ&(PSASUP):0,1:+$P(PSADATA,"^",2))
"RTN","PSAVER6",49,0)
 .I +PSADJD,$L(PSADJD)=+$L(PSADJD),$P($G(^PSDRUG(+PSADJD,0)),"^")'="" S PSADRG=+PSADJD Q
"RTN","PSAVER6",50,0)
 .I +PSADJD,$L(PSADJD)=+$L(PSADJD),$P($G(^PSDRUG(+PSADJD,0)),"^")="" S (PSADJ,PSADRG)=0 Q
"RTN","PSAVER6",51,0)
CS Q:PSASUP!('PSADRG)
"RTN","PSAVER6",52,0)
 S PSACS=$S(+$P(PSADATA,"^",10):1,1:0)
"RTN","PSAVER6",53,0)
 S PSADJQ=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","Q",0))
"RTN","PSAVER6",54,0)
 I $G(PSADJ) S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJQ=$S($P(PSANODE,"^",6)'="":+$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAVER6",55,0)
 ;
"RTN","PSAVER6",56,0)
 ;PSA*3*1  (DAVE B)
"RTN","PSAVER6",57,0)
 S PSAQTY=$S(($G(PSADJQ)'=""&(+PSADJ)):PSADJQ,1:+$P(PSADATA,"^",3))
"RTN","PSAVER6",58,0)
 S PSAOU=$S(+$P(PSADATA,"^",4):+$P(PSADATA,"^",4),1:"")
"RTN","PSAVER6",59,0)
 ;
"RTN","PSAVER6",60,0)
 ;DAVE B (PSA*3*3)
"RTN","PSAVER6",61,0)
 ;I +$P($P($G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2)),"^",5),"~",2) S PSAOU=$P($P($G(^(2)),"^",5),"~",2)
"RTN","PSAVER6",62,0)
 ;
"RTN","PSAVER6",63,0)
 S PSADJO=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","O",0))
"RTN","PSAVER6",64,0)
 I $G(PSADJ) S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJO=$S($P(PSANODE,"^",6)'="":$P(PSANODE,"^",6),1:$P(PSANODE,"^",2))
"RTN","PSAVER6",65,0)
 S:$G(PSADJO) PSAOU=$G(PSADJO)
"RTN","PSAVER6",66,0)
 S PSANDC=$P(PSADATA,"^",11) D PSANDC1^PSAHELP S PSADASH=PSANDCX K PSANDCX
"RTN","PSAVER6",67,0)
 S PSADJP=0,PSADJ=+$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,"B","P",0))
"RTN","PSAVER6",68,0)
 I $G(PSADJ) S PSANODE=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,1,PSADJ,0)),PSADJP=$S(+$P(PSANODE,"^",6):+$P(PSANODE,"^",6),1:+$P(PSANODE,"^",2))
"RTN","PSAVER6",69,0)
 S (PSAPOU,PSANPOU)=$S($G(PSADJP):PSADJP,1:+$P(PSADATA,"^",5)),PSALEN=$L($P(PSANPOU,".")),(PSAPOU,PSANPOU)=$J(PSANPOU,PSALEN,2)
"RTN","PSAVER6",70,0)
 S PSAVSN=$P(PSADATA,"^",12)
"RTN","PSAVER6",71,0)
 S PSALOC=$S(+PSACS:+$P(PSAIN,"^",12),1:+$P(PSAIN,"^",5))
"RTN","PSAVER6",72,0)
TEMP S PSATEMP=$G(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE,2))
"RTN","PSAVER6",73,0)
 S PSADUOU=+$P(PSATEMP,"^"),PSAREORD=+$P(PSATEMP,"^",2),PSASUB=+$P(PSATEMP,"^",3),PSASTOCK=+$P(PSATEMP,"^",4)
"RTN","PSAVER6",74,0)
 S PSADUOU=$S(+PSADUOU:+PSADUOU,+PSASUB&(+$P($G(^PSDRUG(PSADRG,1,PSASUB,0)),"^",7)):+$P($G(^PSDRUG(PSADRG,1,PSASUB,0)),"^",7),1:1)
"RTN","PSAVER6",75,0)
 S PSADUREC=$S(PSADUOU:PSAQTY*PSADUOU,1:0)
"RTN","PSAVER6",76,0)
 ;
"RTN","PSAVER6",77,0)
 ;DAVE B (18NOV98)
"RTN","PSAVER6",78,0)
 I PSADUREC=0,$D(PSAQTY),$P($G(^PSDRUG(PSADRG,660)),"^",5)'="" S PSADUREC=(PSAQTY*($P(^PSDRUG(PSADRG,660),"^",5)))
"RTN","PSAVER6",79,0)
 Q:'+$P($G(^PSD(58.8,PSALOC,0)),"^",14)
"RTN","PSAVER6",80,0)
 S PSAREORD=$S(+PSAREORD:+PSAREORD,+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",5):+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",5),1:0)
"RTN","PSAVER6",81,0)
 S PSASTOCK=$S(+PSASTOCK:+PSASTOCK,+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",3):+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",3),1:0)
"RTN","PSAVER6",82,0)
 K PSA0QTY I '$G(PSAQTY),'$G(PSADJQ) S PSA0QTY=1 Q  ;PSA*3*42 (0 QTY)
"RTN","PSAVER6",83,0)
 Q
"RTN","PSAVER6",84,0)
 ;
"RTN","PSAVER6",85,0)
FILE ;File data in 58.8
"RTN","PSAVER6",86,0)
 I $D(PSADUREC),PSADUREC'>0 S PSADUREC=$S($D(PSADJQ):PSADJQ,$D(PSAQTY):PSAQTY,1:0)
"RTN","PSAVER6",87,0)
 D NOW^%DTC S PSADT=+$E(%,1,14)
"RTN","PSAVER6",88,0)
 I '$D(^PSD(58.8,PSALOC,1,PSADRG,0)) D
"RTN","PSAVER6",89,0)
 .K DIC,DA,DR,DIE
"RTN","PSAVER6",90,0)
 .S:'$D(^PSD(58.8,PSALOC,1,0)) DIC("P")=$P(^DD(58.8,10,0),"^",2)
"RTN","PSAVER6",91,0)
 .S DA(1)=PSALOC,DIC="^PSD(58.8,"_DA(1)_",1,",(DA,DINUM,X)=PSADRG,DIC(0)="L",DLAYGO=58.8
"RTN","PSAVER6",92,0)
 .F  L +^PSD(58.8,PSALOC,0):0 I  Q
"RTN","PSAVER6",93,0)
 .D FILE^DICN L -^PSD(58.8,PSALOC,0) K DIC,DA,DLAYGO
"RTN","PSAVER6",94,0)
 .D MM ;*42 send mailmessage
"RTN","PSAVER6",95,0)
 F  L +^PSD(58.8,PSALOC,1,PSADRG,0):0 I  Q
"RTN","PSAVER6",96,0)
 S PSABAL=+$P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",4)
"RTN","PSAVER6",97,0)
 ;
"RTN","PSAVER6",98,0)
 ;DAVE B (PSA*3*3)
"RTN","PSAVER6",99,0)
 I $P($G(^PSD(58.8,PSALOC,1,PSADRG,0)),"^",1)'=PSADRG S $P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",1)=PSADRG
"RTN","PSAVER6",100,0)
 S $P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",4)=PSADUREC+PSABAL
"RTN","PSAVER6",101,0)
 I +$P($G(^PSD(58.8,PSALOC,0)),"^",14) D
"RTN","PSAVER6",102,0)
 .I PSASTOCK'=$P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",3) S $P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",3)=PSASTOCK
"RTN","PSAVER6",103,0)
 .I PSAREORD'=$P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",5) S $P(^PSD(58.8,PSALOC,1,PSADRG,0),"^",5)=PSAREORD
"RTN","PSAVER6",104,0)
 S:'$D(^PSD(58.8,PSALOC,1,PSADRG,5,0)) DIC("P")=$P(^DD(58.8001,20,0),"^",2)
"RTN","PSAVER6",105,0)
 I '$D(^PSD(58.8,PSALOC,1,PSADRG,5,$E(DT,1,5)*100,0)) D
"RTN","PSAVER6",106,0)
 .K DIC,DA,DR,DIE
"RTN","PSAVER6",107,0)
 .S DIC="^PSD(58.8,"_PSALOC_",1,"_PSADRG_",5,",DIC(0)="L",DIC("DR")="1////^S X=$G(PSABAL)"
"RTN","PSAVER6",108,0)
 .S (X,DINUM)=$E(DT,1,5)*100,DA(2)=PSALOC,DA(1)=PSADRG,DLAYGO=58.8 D ^DIC K DIC("DR")
"RTN","PSAVER6",109,0)
 .S X="T-1M" D ^%DT S (X,DINUM)=$E(Y,1,5)*100,DA=PSADRG D ^DIC K DIC,DLAYGO
"RTN","PSAVER6",110,0)
 .K DIC,DA,DR,DIE
"RTN","PSAVER6",111,0)
 .S DA=+Y,DA(2)=PSALOC,DA(1)=PSADRG,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",5,",DR="3////^S X=$G(PSABAL)" D ^DIE K DIE
"RTN","PSAVER6",112,0)
 K DIC,DA,DR,DIE
"RTN","PSAVER6",113,0)
 S DA=$E(DT,1,5)*100
"RTN","PSAVER6",114,0)
 S DA(2)=PSALOC,DA(1)=PSADRG,DIE="^PSD(58.8,"_DA(2)_",1,"_DA(1)_",5,",DA=$E(DT,1,5)*100,DR="3////^S X=($G(PSABAL)+$G(PSADUREC));5////^S X="_($P($G(^(0)),"^",3)+PSADUREC) D ^DIE K DIE
"RTN","PSAVER6",115,0)
 L -^PSD(58.8,PSALOC,1,PSADRG,0)
"RTN","PSAVER6",116,0)
 G TR^PSAVER7
"RTN","PSAVER6",117,0)
MM ;
"RTN","PSAVER6",118,0)
 ;*42 Mail Message to holders of PSDMGR, PSAMGR key
"RTN","PSAVER6",119,0)
 ;*53 Consolidate messages
"RTN","PSAVER6",120,0)
 N PSACS S PSACS=$S($$GET1^DIQ(50,PSADRG,63)["N":" Controlled Substance ",1:"")
"RTN","PSAVER6",121,0)
 S ^TMP($J,"PSADD",$$GET1^DIQ(58.8,PSALOC,.01),$$GET1^DIQ(50,PSADRG,.01))=""
"RTN","PSAVER6",122,0)
 Q
"RTN","PSAVER6",123,0)
SCANDIF ;*42 inspect invoice for noted differences in OU,DUOU,PPDU,NDC
"RTN","PSAVER6",124,0)
 ;NEEDS PSAIEN, PSAIEN1
"RTN","PSAVER6",125,0)
 K ^TMP($J,"PSADIF"),PSADIFLC
"RTN","PSAVER6",126,0)
 S PSALINE=0 F  S PSALINE=$O(^PSD(58.811,PSAIEN,1,PSAIEN1,1,PSALINE)) Q:PSALINE'>0  D CHECK^PSAPROC7 ;checks and stores differences in ^TMP($J,
"RTN","PSAVER6",127,0)
 I $D(^TMP($J,"PSADD")) D ADDMM
"RTN","PSAVER6",128,0)
 I $D(^TMP($J,"PSADIF")) D MESSAGE
"RTN","PSAVER6",129,0)
 Q
"RTN","PSAVER6",130,0)
MESSAGE ;differences found, notify user and send message to g.PSA NDC UPDATES.
"RTN","PSAVER6",131,0)
 K DIR N IENS
"RTN","PSAVER6",132,0)
 S PSAORD=$$GET1^DIQ(58.811,PSAIEN,.01),IENS=PSAIEN1_","_PSAIEN
"RTN","PSAVER6",133,0)
 S PSAINV=$$GET1^DIQ(58.8112,IENS,.01)
"RTN","PSAVER6",134,0)
 S XMSUB="POST Verify  Variance Report Ord: "_PSAORD_" Inv: "_PSAINV ;*52
"RTN","PSAVER6",135,0)
 S ^TMP($J,"PSADIF",1,0)=XMSUB,^TMP($J,"PSADIF",2,0)=" "
"RTN","PSAVER6",136,0)
 S XMTEXT="^TMP($J,""PSADIF"",",XMY("G.PSA NDC UPDATES")=""
"RTN","PSAVER6",137,0)
 S XMDUZ="Price & NDC Updater"
"RTN","PSAVER6",138,0)
 D ^XMD
"RTN","PSAVER6",139,0)
 K PSADIFLC,^TMP($J,"PSADIF")
"RTN","PSAVER6",140,0)
 Q
"RTN","PSAVER6",141,0)
ADDMM ; SEND MESSAGE REGARDING DRUGS ADDED TO PHARMACY LOCATIONS
"RTN","PSAVER6",142,0)
 K ^TMP($J,"PSADDMM")
"RTN","PSAVER6",143,0)
 S XMSUB="New Drugs Added by Order: "_$G(PSAORD)_" Invoice: "_$G(PSAINV)
"RTN","PSAVER6",144,0)
 S XMDUZ="Verified by: "_$$GET1^DIQ(200,DUZ,.01)
"RTN","PSAVER6",145,0)
 S LC=0,X=XMSUB D MMLINE S X=XMDUZ D MMLINE
"RTN","PSAVER6",146,0)
 S X="Please use DA and CS menus to populate the balances, stock and re-order levels." D MMLINE
"RTN","PSAVER6",147,0)
 S PSALOC="" F  S PSALOC=$O(^TMP($J,"PSADD",PSALOC)) Q:PSALOC=""  D
"RTN","PSAVER6",148,0)
 . S X=PSALOC D MMLINE
"RTN","PSAVER6",149,0)
 . S PSADRG="" F  S PSADRG=$O(^TMP($J,"PSADD",PSALOC,PSADRG)) Q:PSADRG=""  S X="     "_PSADRG D MMLINE
"RTN","PSAVER6",150,0)
 S XMTEXT="^TMP($J,""PSADDMM"","
"RTN","PSAVER6",151,0)
 S XMY("G.PSA NDC UPDATES")=""
"RTN","PSAVER6",152,0)
 D ^XMD
"RTN","PSAVER6",153,0)
 K ^TMP($J,"PSADD"),^TMP($J,"PSADDMM"),LC
"RTN","PSAVER6",154,0)
 Q
"RTN","PSAVER6",155,0)
MMLINE S LC=LC+1,^TMP($J,"PSADDMM",LC,0)=X W !,X Q
"VER")
8.0^22.0
"BLD",6608,6)
^43
**END**
**END**
