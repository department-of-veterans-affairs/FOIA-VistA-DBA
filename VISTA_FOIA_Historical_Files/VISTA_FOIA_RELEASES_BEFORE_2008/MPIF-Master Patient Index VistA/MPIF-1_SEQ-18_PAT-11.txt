$TXT Created by CHESNEY,CHRISTINE M at VAB-RAD.ISC-SF.VA.GOV  (KIDS) on WEDNESDAY, 11/07/01 at 07:12
=============================================================================
Run Date: NOV 27, 2001                     Designation: MPIF*1*11
Package : MPIF - MASTER PATIENT INDEX VISTA Priority: Mandatory
Version : 1        SEQ #18                      Status: Released
=============================================================================

Associated patches: (v)MPIF*1*1    <<= must be installed BEFORE `MPIF*1*11'
                    (v)MPIF*1*3    <<= must be installed BEFORE `MPIF*1*11'
                    (v)MPIF*1*5    <<= must be installed BEFORE `MPIF*1*11'
                    (v)MPIF*1*6    <<= must be installed BEFORE `MPIF*1*11'

Subject: CMOR REQUEST FIXES

Category: 
  - Routine
  - Other

Description: 
============

  NOTE:  MPIF and RG patches should NOT be installed on Legacy systems to
  avoid issues with the legacy systems ending up as Coordinating Master
  of Records(CMORs), Treating Facilities or Subscribers.  
  
  
  NOTE: It is necessary for the CMOR Change Request functionality to work 
  properly between all facilities for a shared patient.  So, to make sure 
  that all sites stay in sync with the CMOR, this patch must also be 
  installed at the site you are requesting the CMOR change from, or 
  pushing the CMOR change to. DO NOT USE THESE OPTIONS until ALL SITES
  have INSTALLED THIS PATCH.  Sites will be notified by e-mail, when all
  sites have installed Patch MPIF*1*11.
  
  Post Init Note:
  --------------
  
  The post-init of this patch will remove all entries from the MPIF CMOR
  REQUEST file (#984.9).  Prior to installing this patch, run the 
  Sent Request Report [MPIF SENT REQUESTS] option.  This report will show
  all outstanding requests.  Due to the problems experienced with the 
  options related to the CMOR CHANGE REQUESTS, it is possible that the 
  CMOR has already been changed, but that the Request entry had not been 
  updated appropriately.  If the CMOR hasn't been changed, the request 
  will have to be entered again after the patch has been installed.
  
  
  Problem Scenarios and Patch Solutions:
  -------------------------------------
  
  ISSUE 1:  A typo has been corrected in the Exception message generated
  when a subscription is found to be missing during the change of CMOR 
  request process.  This was corrected in routine MPIFQUE4.  Several 
  exception messages have been enhanced to include Integration Control
  Number (ICN) and/or internal entry number (IEN) from the Patient file
  (#2).  Routine MPIFQUE5 was changed to pass HL("MID") as the Health
  Level Seven (HL7) message number instead of the IEN from the HL7 MESSAGE
  TEXT file (#772) when logging an exception.
  
  
  ISSUE 2:  Northern California and Augusta reported that when using 
  the Batch Review Requests [MPIF BATCH REVIEW] option, if the user 
  chose to review options by site, no sites were acceptable. Also, 
  when they entered a question mark (?) at the prompt, no sites were 
  displayed even though requests were listed as needing to be 
  reviewed. This was corrected in routine MPIFREV.
  
  
  ISSUE 3:  It was reported by Augusta, Dublin, Nashville, and Northern
  California that when the CMOR of a patient requests another site to be
  the CMOR, the "push" of CMOR change does not work.  A new option
  named Push CMOR Request [MPIF PUSH CMOR] has been created for "pushing"
  the CMOR change from the current CMOR to another site.  This option will
  allow the creation of a new CMOR change request as the New CMOR Change
  Request [MPIF NEW REQUEST] option currently does. It will also send out a
  Change CMOR message to all subscribers telling them of the change.
  For tracking purposes, the current CMOR will have an entry in its
  MPIF CMOR REQUEST file (#984.9) that is already marked as approved.  
  Existing messages will be used to accomplish this new type of CMOR 
  Change Request.  Routines MPIFEDIT, MPIFREQ, and MPIFCMRP have been
  modified to support this change.  The Input Template MPIF REQUEST 
  EDIT has been removed from this process and will be deleted at the 
  sites.
  
  
  ISSUE 4:  Resulting from the Users Meeting in Augusta, a request was
  made to auto-process Pending CMOR Change Requests when there has been
  no activity on the request for more than 14 days.  A new option named
  AUTO CHANGE CMOR NIGHT JOB [MPIF CMOR REQUEST AUTO JOB] has been created
  to run nightly via TaskMan.  A new routine named MPIFAREQ has been
  created for this option.
  
  
  ISSUE 5:  At the Users Meeting in Augusta, it was reported that when a
  site auto-accepted a change to the CMOR, (1) the approve/disapprove
  message was not received, and (2) the status was not updated in the MPIF
  CMOR REQUEST file (#984.9) at the site where the original request was
  sent from. This has been corrected in routine MPIFREQ.
  
  
  ISSUE 6:  Resulting from the Users Meeting in Augusta, a request was made
  for the approve/disapproved notice to contain the fields REVIEWER NAME 
  (#3.01), REVIEWER PHONE NUMBER (#2.03), and REVIEWER COMMENTS (#3.02). 
  This change has been added to the notice and included in routine 
  MPIFRESS.
  
  
  ISSUE 7:  When a request is processed automatically, the value of the 
  REVIEWER NAME field (#3.01) is not being populated at the requesting site
  in the MPIF CMOR REQUEST file (#984.9). In addition to this, "Automatic 
  Processing" will now be placed in the REVIEWER NAME field (#3.01) on the 
  site that made the request.  These changes have been included in routine 
  MPIFCMOR.
  
  
  ISSUE 8:  At the Augusta Users group, it was reported that when a 
  question mark (?) is entered after selecting a Request for Review,
  it was not being screened to only show the requests pending approval.
  This has been corrected in routine MPIFREV.
  
  
  ISSUE 9:  Resulting from the Augusta Users group meeting, modifications
  were made providing users with reports that are now easily identified 
  by the report's option name, and that have more specific sort/selection
  criteria.  The new report names are:
  
         (1) Report - Pending Received Requests [MPIF RECEIVED REQUESTS]
         (2) Report - Sent Requests Still Pending [MPIF SENT REQUESTS]
         (3) Report - CMOR Requests Disapproved [MPIF DISAPPROVE REPORT]
         (4) Report - CMOR Requests Approved [MPIF APPROVED REPORT]
  
  
  The changes to these reports have been included in routine MPIFNQ. 
  
  
  ISSUE 10:  At the Augusta Users group meeting, a request was made for 
  more user-friendly CMOR processing option names and/or descriptions. 
  So, the following options have been modified and rearranged on the CIRN 
  Master of Record (CMOR) Request [MPIF CMOR MGR] menu:
  
  
               Create a New CMOR Change Request [MPIF NEW REQUEST]
               Push CMOR Request [MPIF PUSH CMOR]
               Edit Open CMOR Change Request [MPIF EDIT REQUEST]
               Review Pending Change of CMOR Requests [MPIF REVIEW REQUEST]
               Batch Review of CMOR Change Requests [MPIF BATCH REVIEW]
               Display a CMOR Change Request [MPIF VIEW REQUEST]
    PEND       Report - Pending Received Requests [MPIF RECEIVED REQUESTS]
    SENT       Report - Sent Requests Still Pending [MPIF SENT REQUESTS]
    DIS        Report - CMOR Requests Disapproved [MPIF DISAPPROVE REPORT]
    APP        Report - CMOR Requests Approved [MPIF APPROVED REPORT]
  
  
  The CIRN Master of Record (CMOR) Request menu will also be changed, 
  replacing CIRN with Coordinating.
  
  
  ISSUE 11:  It was reported in NOIS MAD-0900-42526 that a null subscript
  can occur if a CMOR Change Request is deleted out of the MPIF CMOR
  REQUEST file (#984.9) and a response to that request is received.  This
  has been corrected in routine MPIFRESS.
  
  
  ISSUE 12:  The following options are being removed from the OPTION file 
  (#19) because they are no longer to be used.
  
    Begin CMOR Comparison                [MPIF CMOR COMP BATCH]
    CMOR Comparison Process Status       [MPIF CMOR COMP STATUS]
    Stop/Restart CMOR Comparison Process [MPIF CMOR COMP STOP/RESTART]
    CMOR Comparison Menu                 [MPIF COMP MAIN]
  
  
  ISSUE 13:  Input template MPIF PCMM REQUEST is a hold over from the
  initial testing and implementation of MPIF and it is not being used.
  This patch will remove the input template from all sites.
  
  
  ISSUE 14:  The following modifications have been made to the MPIF CMOR
  REQUEST file (#984.9) in this patch:
  
    1. The descriptions for the following fields: REQUESTED BY 
       (#.02), STATUS (#.06), REVIEWER NAME (#3.01), and REVIEWED 
       BY (#2.01) have been updated and/or enhanced.
  
    2. The name of the TYPE OF REQUEST field (#1.03) has been 
       changed to TYPE OF ACTION field (#1.03). This is because changes 
       to CMORs may not all be requests; some are Pushes. In 
       addition, the description of this field has been enhanced,  
       and it's set of codes modified.  The set of codes 
       are now:
  
        1 - REQUEST SENT TO
        2 - REQUEST RECEIVED FROM
        3 - PUSH SENT TO
        4 - PUSH RECEIVED FROM.  
  
       This change has been made to support the display of requests for 
       a patient. Now you can easily tell where the request was made from
       and if it was a regular request or a push to change the CMOR.
  
    3. The SITE field (#.07) has been modified to be the site that 
       will RECEIVE the request or push at the SENDING site.  At the 
       RECEIVING site, it will be  the site that SENT the 
       request or push.
  
    4. A new field named CMOR AFTER APPROVAL (#.09) has been added. 
       It will contain the site in which a request is asking to be the 
       new CMOR, or the push is making the new CMOR.
  
  
  ISSUE 15:  A new API will be provided, CCRDAT^MPIFUTL(DFN,ARR),  
  to return all data for each request or push for a given patient.  
  Also, returned will be a display line reflecting:
  
    1. The type of request.
    2. Who it was sent to/received from.
    3. Which site has been requested or pushed to be the new CMOR.
  
  In the API CCRDAT^MPIFUTL(DFN,ARR): 
  
    1. The DFN is the IEN of the patient in the PATIENT file (#2). 
    2. The ARR is the name of the array that will hold the data.  
       ARR(0) will equal the number of requests found or -1^error
       message. The format of the return array will be ARR(request 
       number,field number) and equal the value of that field.  
       ARR(request number, 999) will equal the display text.
  
  
  ISSUE 16:  Due to the issues with regard to the entries in the
  MPIF CMOR REQUEST file (#984.9), the post-init routine MPIF111P in
  this patch will delete all the entries in the file.  
  
  NOTE:  The post-init routine MPIF111P is deleted after the installation
  has successfully completed.
  
  
  ISSUE 17:  During the second developer review of this patch, it was 
  discovered that the "AS" cross-reference on fields STATUS (#.06) and SITE
  (#.07) had used the variable D0 instead of the variable DA.
  This is corrected in this patch.  
  
  
  ISSUE 18:  During the second developer review of this patch, it was 
  discovered that the input template MPIF REQUEST INCOMING from the 
  MPIF CMOR REQUEST file (#984.9) was doing a four-slash stuff on the SITE
  field (#.07) passing the wrong value. The station number was incorrectly
  being passed into the input template, in place of the IEN. (The IEN is
  what should be passed into the input template). The input template has
  been updated to correct this problem.
  
  
  ISSUE 19:  During the second developer review of this patch, it was 
  discovered that multiple requests to change the CMOR can be received for 
  the same patient from multiple sites, and that these requests can all be 
  approved. Once the first request is approved, this site is no longer the 
  CMOR and shouldn't be allowed to approve any additional changes to the
  CMOR. A change has been made to the approve/disapprove process in that,
  if the process is interactive, the user will be notified of the other
  sites requests for that same patient. In both interactive and
  non-interactive processes, once that patient's request has been approved,
  all other change of CMOR requests for that patient will be disapproved.
  Routines MPIFREV, MPIFNEW and MPIFAREQ have been modified to contain this
  change. 
  
  
  DOCUMENTATION:
  =============
  
   The Master Patient Index VistA User Manual and Technical Manual have 
   been updated to include all released patches up to and including
   MPIF*1.0*11.  A new manual has been added to the MPI VistA documentation
   suite, called the Programmers Manual.  The target audience for this new 
   manual are Office of Information Field Office (OIFO) developers.
  
   These manuals can be found on the VistA Documentation Library web site 
   at:  http://vista.med.va.gov/vdl/#App16.
  
   The documentation is also available on the ANONYMOUS.SOFTWARE directory.
   The files can be obtained via FTP.  The preferred method is to get the
   files from:  download.vista.med.va.gov. This transmits the files from
   the first available FTP server. Sites may also elect to retrieve
   software directly from one of the following servers.
      
    OI Field Office         FTP Address                  Directory
    ------------------------------------------------------------------
    Albany              ftp.fo-albany.med.va.gov       ANONYMOUS.SOFTWARE
    Hines               ftp.fo-hines.med.va.gov        ANONYMOUS.SOFTWARE
    Salt Lake City      ftp.fo-slc.med.va.gov          ANONYMOUS.SOFTWARE
  
   File Names:
  
   User Manual           MPIF_10UM.PDF
   Technical Manual      MPIF_10TM.PDF
   Programmer Manual     MPIF_10PM.PDF
  
  
  
  NOISes Logged about CMOR Change Request corrected by this patch:
  ===============================================================
  
   DEN-0301-51646
   MAD-1100-40596
   MAD-0900-42526
   OKL-0900-71648
  
  
   TEST SITES:
   ==========
  
   Augusta, GA
   Dublin, GA
   Prescott, AZ
   Tucson, AZ
  
   
  
   Routine Summary:
   ================
   The following is a list of the routine(s) included in this patch.  The
   second line of each of these routine(s) will look like:
    
   <TAB>;;1.0; MASTER PATIENT INDEX VISTA ;**[Patch List]**;30 Apr 99
   CHECK^XTSUMBLD results:
    
   Routine       Before Patch       After Patch       Patch List
   --------      ------------       ------------      ----------
   MPIF111P         N/A                550567             11 
   ** MPIF111P is deleted after install
   MPIFAREQ         N/A                1731189            11
   MPIFCMOR        3073281             3454167           1,6,11
   MPIFCMRP         N/A                8885059            11
   MPIFEDIT        2693703             6845813            11
   MPIFHL7         2438437              962044           1,6,11
   MPIFNEW         1804826             2373867            11   
   MPIFNQ          2253276             3813353            11
   MPIFQUE4       15181298            15678319           1,3,11
   MPIFQUE5        5714320             5882526           1,6,11
   MPIFREQ        10860224            12625162           1,6,11
   MPIFRESS        7359823             8781898           1,6,11
   MPIFREV         6834657             8230803            6,11
   MPIFUTL         4282147             4629450            11
  
   INSTALLATION INSTRUCTIONS:
   ==========================
  
    This patch should be loaded during non-peak hours to minimize
    disruption to the users.
   
    This patch will take less than 5 minutes to install.
  
    NOTE:  The post-init of this patch will remove all entries from the 
    CMOR CHANGE REQUEST (#984.9) file.  Prior to installing this patch, 
    run the Sent Request Report [MPIF SENT REQUESTS] option.  This report
    will show all outstanding requests.  Due to the problems experienced
    with the options related to the CMOR CHANGE REQUESTS, it is possible
    that the CMOR has already been changed but the Request entry had not
    been updated appropriately.   If the CMOR hasn't been changed, the 
    request will have to be entered again after the patch has been 
    installed.
  
    1.  Users are allowed on the system during patch installation.
   
    2.  Stop Inbound HL7 filer(s) via the Monitor, Start, Stop Filers [HL
        FILER MONITOR] option on the Filer and Link Management Options 
        [HL MENU FILER LINK MGT] which can be found on the HL7 Main Menu
        [HL7 MAIN MENU].
   
    3.  TaskMan does not need to be stopped or placed in a wait state. 
   
    4.  These routines are not usually mapped, so you will probably not
        have to disable mapping. 
  
    5.  Use the INSTALL/CHECK MESSAGE option on the PackMan menu. [Note:
        TEXT PRINT/DISPLAY option in the PackMan menu will display the
        patch text only.
  
    6.  From the Kernel Installation and Distribution System Menu, select
        the Installation menu.  
   
    7.  From this menu, you may elect to use the following options:
        a.  Backup a Transport Global - this option will create a backup
            message of any routines exported with the patch.  It will NOT
            backup any other changes such as DDs or templates.
        b.  Compare Transport Global to Current System  - this option will
            allow you to view all changes that will be made when the patch
            is installed.  It compares all components of the patch
            (routines, DDs, templates, etc.).
        c.  Verify Checksums in Transport Global - this option will allow
            you to ensure the integrity of the routines that are in the
            transport global.
        d.  Print Transport Global - this option will allow you to view the
            components of the KIDS build.
   
    8.  Use the Install Package(s) option and select the package
        MPIF*1.0*11.
   
    9.  When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of
        Install? YES//' answer NO
   
    10. When promopted 'Want KIDS to INHIBIT LOGONs during the install? 
        YES//' answer NO.
       
    11. When prompted 'Want to DISABLE Scheduled Options, Menu Options, and
        Protocols? YES//', respond Yes.  Please put the following options
        out of order:
   
         Batch Review Requests                   [MPIF BATCH REVIEW]
         Received Requests Report                [MPIF RECEIVED REQUESTS]
         Sent Request Report                     [MPIF SENT REQUESTS]
         Display CIRN Master of Record Request   [MPIF VIEW REQUEST]
         New CMOR Change Request                 [MPIF NEW REQUEST]
         CIRN Master of Record Request Review    [MPIF REVIEW REQUEST]
         Edit CMOR Change Request                [MPIF EDIT REQUEST]
          
    12.  Restart the HL7 Inbound filer(s) via the same options in step #2.
  
    13.  Schedule option AUTO CHANGE CMOR NIGHT JOB [MPIF CMOR REQUEST AUTO
         JOB] to run every evening after 10:00pm via TaskMan.
  
         *** NOTE:  Once this job is scheduled any requests pending review
         by your facility that are older than 14 days will be processed as
         approved for change.  ***
  
    14.  Note that MPIF111P is automatically deleted after the successful 
         install of this patch.

Routine Information:
====================

Routine Name:
  - MPIFQUE4


Routine Checksum:

Routine Name:
  - MPIFREV


Routine Checksum:

Routine Name:
  - MPIFAREQ


Routine Checksum:

Routine Name:
  - MPIFEDIT


Routine Checksum:

Routine Name:
  - MPIFCMOR


Routine Checksum:

Routine Name:
  - MPIFCMRP


Routine Checksum:

Routine Name:
  - MPIFNQ


Routine Checksum:

Routine Name:
  - MPIFRESS


Routine Checksum:

Routine Name:
  - MPIFREQ


Routine Checksum:

Routine Name:
  - MPIFUTL


Routine Checksum:

Routine Name:
  - MPIF111P


Routine Checksum:

Routine Name:
  - MPIFHL7


Routine Checksum:

Routine Name:
  - MPIFQUE5


Routine Checksum:

Routine Name:
  - MPIFNEW


Routine Checksum:

=============================================================================
User Information:                               
Entered By  : CHESNEY,CHRISTINE M           Date Entered : NOV 16, 2000
Completed By: HERREN,CATHRYN                Date Completed: NOV 27, 2001
Released By : BURTS,WANDA                   Date Released : NOV 27, 2001
=============================================================================


Packman Mail Message:
=====================

$END TXT
